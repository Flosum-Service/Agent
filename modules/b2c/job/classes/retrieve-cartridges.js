function a62_0x2c36(){const _0x3bcad1=['ParentId\x20IN\x20(:parentIdIds)','replace','../../constants','jpeg','Component__c\x20IN\x20(','splitOnChunks','Body','applyFlosumVariables','search','Attachment','forEach','__esModule','8VQTINJ','path','QueryBuilder','70737iNAuIT','otf','Name\x20IN\x20(:names)','exists','from','utf8','zip','DEFAULT_CARTRIDGES_FOLDER','execute','logger','substring','adm-zip','./utils','Name','1272fFzHTr','CartridgeFile','@flosum/salesforce','../../../git/internal/fs.internal','variables','\x20file(s).','FLOSUM_LIST_COMPONENTS_ATTACHMENT_NAME','eot','join','includes','woff','where','svg','Branch__c\x20=\x20:branchId','../../../../configs/path','74049qQuMhO','ttf','Component_History__c','log','tmpPath','toString','mkdir','getData','@flosum/utils','lastIndexOf','defineProperty','BulkV1QueryContentType','getEntries','Bulk1RetrieveData','256993wplUsQ','getSelectedComponentIds','namespace','axiosInstance','782660UtryIc','updateFile','5089ZxVeGv','andWhere','getIsDone','__importDefault','30nIaGRv','fs/promises','default','constructor','systemLogger','(((.+)+)+)+$','then','Id\x20IN\x20(:componentIds)','getComponentHistoryIds','Get\x20list\x20of\x20components.','push','Retrieved\x20','parse','1658472suPcwQ','apiVersion','gzip','woff2','jobPath','BodyLength','metadataLogId','1544139Uckzjx','jpg','writeFile','retrieveAttachments','build','4RQNjOL','apply','ArrayUtils','indexOf','branchId','png','isFlosumVariables','name','length'];a62_0x2c36=function(){return _0x3bcad1;};return a62_0x2c36();}const a62_0x390660=a62_0x3a75;(function(_0x38bc70,_0x7146c7){const _0x3546b8=a62_0x3a75,_0x36ffe1=_0x38bc70();while(!![]){try{const _0x13fd4c=parseInt(_0x3546b8(0x205))/0x1+-parseInt(_0x3546b8(0x1e5))/0x2*(parseInt(_0x3546b8(0x1e8))/0x3)+parseInt(_0x3546b8(0x1d0))/0x4*(-parseInt(_0x3546b8(0x217))/0x5)+parseInt(_0x3546b8(0x1f6))/0x6*(-parseInt(_0x3546b8(0x219))/0x7)+parseInt(_0x3546b8(0x1c4))/0x8+parseInt(_0x3546b8(0x1cb))/0x9+-parseInt(_0x3546b8(0x21d))/0xa*(-parseInt(_0x3546b8(0x213))/0xb);if(_0x13fd4c===_0x7146c7)break;else _0x36ffe1['push'](_0x36ffe1['shift']());}catch(_0x2227fa){_0x36ffe1['push'](_0x36ffe1['shift']());}}}(a62_0x2c36,0x1cd1e));const a62_0x19035c=(function(){let _0x5b90a7=!![];return function(_0x3bae7d,_0x2e362d){const _0x28659e=_0x5b90a7?function(){const _0x349e0a=a62_0x3a75;if(_0x2e362d){const _0x5c8d23=_0x2e362d[_0x349e0a(0x1d1)](_0x3bae7d,arguments);return _0x2e362d=null,_0x5c8d23;}}:function(){};return _0x5b90a7=![],_0x28659e;};}()),a62_0x113188=a62_0x19035c(this,function(){const _0x4f3aa0=a62_0x3a75;return a62_0x113188[_0x4f3aa0(0x20a)]()[_0x4f3aa0(0x1e1)]('(((.+)+)+)+$')[_0x4f3aa0(0x20a)]()[_0x4f3aa0(0x1ba)](a62_0x113188)[_0x4f3aa0(0x1e1)](_0x4f3aa0(0x1bc));});function a62_0x3a75(_0x185043,_0x4d4318){const _0x24f71d=a62_0x2c36();return a62_0x3a75=function(_0x113188,_0x19035c){_0x113188=_0x113188-0x1ba;let _0x2c3613=_0x24f71d[_0x113188];return _0x2c3613;},a62_0x3a75(_0x185043,_0x4d4318);}a62_0x113188();'use strict';var __importDefault=this&&this[a62_0x390660(0x21c)]||function(_0x389a11){const _0x10ef89=a62_0x390660;return _0x389a11&&_0x389a11[_0x10ef89(0x1e4)]?_0x389a11:{'default':_0x389a11};};Object[a62_0x390660(0x20f)](exports,a62_0x390660(0x1e4),{'value':!![]});const salesforce_1=require(a62_0x390660(0x1f8)),salesforce_2=require(a62_0x390660(0x1f8)),utils_1=require(a62_0x390660(0x1f4)),fs_internal_1=require(a62_0x390660(0x1f9)),path_1=require(a62_0x390660(0x204)),promises_1=require(a62_0x390660(0x21e)),constants_1=require(a62_0x390660(0x1db)),adm_zip_1=__importDefault(require(a62_0x390660(0x1f3))),path_2=__importDefault(require(a62_0x390660(0x1e6))),utils_2=require(a62_0x390660(0x20d)),chunkSize=0x1f4,B2C_CARTRIDGE_TYPE=a62_0x390660(0x1f7),BINARY_FIELDS=[a62_0x390660(0x1df)],EXCLUDED_TYPES=[a62_0x390660(0x1cc),a62_0x390660(0x202),a62_0x390660(0x1fd),a62_0x390660(0x1e9),a62_0x390660(0x1dc),a62_0x390660(0x1d5),a62_0x390660(0x200),a62_0x390660(0x1c7),a62_0x390660(0x206),'ico',a62_0x390660(0x1ee),'rar',a62_0x390660(0x1c6),'pdf'];class RetrieveCartridges{constructor(_0x341466,_0xe9ee3c,_0x55b60d,_0x410189,_0x3f29a3,_0x4d95b0,_0x178868,_0x1b4541,_0x4667b4){const _0x139506=a62_0x390660;this[_0x139506(0x1c8)]=_0x341466,this['axiosInstance']=_0xe9ee3c,this['apiVersion']=_0x55b60d,this[_0x139506(0x215)]=_0x410189,this[_0x139506(0x1d4)]=_0x3f29a3,this[_0x139506(0x1ca)]=_0x4d95b0,this[_0x139506(0x1f1)]=_0x178868,this[_0x139506(0x1bb)]=_0x1b4541,this[_0x139506(0x1fa)]=_0x4667b4,this[_0x139506(0x1d6)]=![],_0x4667b4&&(this[_0x139506(0x1d6)]=Object['keys'](_0x4667b4)[_0x139506(0x1d8)]>0x0);}async['retrieveAttachments'](_0x1262ea,_0x27694c){const _0x282cf4=a62_0x390660,_0x703eda=new salesforce_2[(_0x282cf4(0x1e7))]()['select'](_0x282cf4(0x1df),_0x282cf4(0x1f5),_0x282cf4(0x1c9))[_0x282cf4(0x1ec)](_0x282cf4(0x1e2))[_0x282cf4(0x201)](_0x282cf4(0x1d9),{'parentIdIds':_0x1262ea});_0x27694c&&_0x703eda[_0x282cf4(0x21a)](_0x282cf4(0x1ea),{'names':_0x27694c});!await fs_internal_1['FS'][_0x282cf4(0x1eb)](path_1['tmpPath'])&&await(0x0,promises_1[_0x282cf4(0x20b)])(path_1['tmpPath'],{'recursive':!![]});const _0x13c9d2=new salesforce_1[(_0x282cf4(0x212))]({'instance':this[_0x282cf4(0x216)],'api':this['apiVersion'],'pollInterval':0x1388,'queryBuilder':_0x703eda,'objectName':'Attachment','contentType':salesforce_1[_0x282cf4(0x210)]['APPLICATION_XML'],'jobOperation':salesforce_1['Bulk1JobOperation']['Query'],'tmpPath':path_1[_0x282cf4(0x209)]}),_0x146e7e=[];do{const _0x50f3c1=await _0x13c9d2[_0x282cf4(0x1f0)]();if(!_0x50f3c1)break;const _0x3c3501=new salesforce_2['BulkXmlStreamParser']({'binaryFields':BINARY_FIELDS});for await(const _0x51b532 of _0x50f3c1['pipe'](_0x3c3501)){_0x146e7e[_0x282cf4(0x1c1)](_0x51b532[_0x282cf4(0x1df)]);}}while(!_0x13c9d2[_0x282cf4(0x21b)]());return _0x146e7e;}async['applyFlosumVariables'](_0x57420c){const _0x865f7c=a62_0x390660,_0x32a612=_0x57420c[_0x865f7c(0x211)]();_0x32a612[_0x865f7c(0x1e3)](_0x1dec28=>{const _0x180b5d=_0x865f7c,_0x264a38=_0x1dec28[_0x180b5d(0x1d7)],_0x2562d9=_0x264a38[_0x180b5d(0x1f2)](_0x264a38[_0x180b5d(0x20e)]('.')+0x1);if(!EXCLUDED_TYPES[_0x180b5d(0x1ff)](_0x2562d9)){let _0x29d4e6=_0x1dec28[_0x180b5d(0x20c)]()[_0x180b5d(0x20a)](_0x180b5d(0x1ed)),_0x26d8a2=![];for(const _0xf245b8 in this[_0x180b5d(0x1fa)]){const _0x5f196e='%%'+_0xf245b8+'%%';if(_0x29d4e6[_0x180b5d(0x1d3)](_0x5f196e)!==-0x1){const _0x3980df=new RegExp(_0x5f196e,'ig');_0x29d4e6=_0x29d4e6[_0x180b5d(0x1da)](_0x3980df,this[_0x180b5d(0x1fa)][_0xf245b8]),_0x26d8a2=!![];}}_0x26d8a2&&_0x57420c[_0x180b5d(0x218)](_0x1dec28,Buffer['from'](_0x29d4e6,_0x180b5d(0x1ed)));}});}async['getComponentHistoryIds'](_0x21aaad){const _0x208eb3=a62_0x390660,_0x4e5062=[];for(const _0x348584 of utils_2[_0x208eb3(0x1d2)][_0x208eb3(0x1de)](_0x21aaad,chunkSize)){const _0x2e9bde=new salesforce_2[(_0x208eb3(0x1e7))]()['select']('Id')[_0x208eb3(0x1ec)](this[_0x208eb3(0x215)]+'Component__c')[_0x208eb3(0x201)](this['namespace']+_0x208eb3(0x203),{'branchId':this[_0x208eb3(0x1d4)]})[_0x208eb3(0x21a)](this['namespace']+'Component_Type__c\x20=\x20:type',{'type':B2C_CARTRIDGE_TYPE})['andWhere'](_0x208eb3(0x1be),{'componentIds':_0x348584})[_0x208eb3(0x1cf)](),_0x14a16a=new salesforce_2[(_0x208eb3(0x1e7))]()['select']('Id')['from'](this[_0x208eb3(0x215)]+_0x208eb3(0x207))[_0x208eb3(0x201)](this[_0x208eb3(0x215)]+_0x208eb3(0x1dd)+_0x2e9bde+')')[_0x208eb3(0x21a)](this[_0x208eb3(0x215)]+'isLastVersion__c\x20=\x20:isLastVersion',{'isLastVersion':!![]}),_0x55d55d=new salesforce_2['CompositeRetrieveData']({'api':this[_0x208eb3(0x1c5)],'queryBuilder':_0x14a16a,'instance':this[_0x208eb3(0x216)],'isTooling':![]});do{const _0x565b2f=await _0x55d55d[_0x208eb3(0x1f0)]()[_0x208eb3(0x1bd)](({records:_0x54d85f})=>_0x54d85f['map'](_0x2425cf=>_0x2425cf['Id']));_0x565b2f[_0x208eb3(0x1d8)]&&_0x4e5062[_0x208eb3(0x1c1)](_0x565b2f);}while(!_0x55d55d[_0x208eb3(0x21b)]());}return _0x4e5062;}async[a62_0x390660(0x214)](){const _0x134b21=a62_0x390660,_0x1e1927=path_2[_0x134b21(0x21f)][_0x134b21(0x1fe)](this[_0x134b21(0x1c8)],constants_1[_0x134b21(0x1ef)]);await(0x0,promises_1[_0x134b21(0x20b)])(_0x1e1927);const [_0x404dfc]=await this[_0x134b21(0x1ce)]([this[_0x134b21(0x1ca)]],[constants_1[_0x134b21(0x1fc)]]);if(!_0x404dfc)throw new Error('File\x20\x22'+constants_1[_0x134b21(0x1fc)]+'\x22\x20not\x20found.');return await(0x0,promises_1[_0x134b21(0x1cd)])(path_2[_0x134b21(0x21f)][_0x134b21(0x1fe)](_0x1e1927,constants_1[_0x134b21(0x1fc)]),_0x404dfc),JSON[_0x134b21(0x1c3)](_0x404dfc[_0x134b21(0x20a)]());}async[a62_0x390660(0x1f0)](){const _0x39de9a=a62_0x390660;await this[_0x39de9a(0x1f1)][_0x39de9a(0x208)](_0x39de9a(0x1c0));const _0x571ca9=await this['getSelectedComponentIds'](),_0x267df9=await this[_0x39de9a(0x1bf)](_0x571ca9);let _0x555940=0x0;for(const _0x7825a2 of utils_2['ArrayUtils'][_0x39de9a(0x1de)](_0x267df9,chunkSize)){for(const _0xfd26c3 of await this[_0x39de9a(0x1ce)](_0x7825a2)){const _0xffdded=new adm_zip_1[(_0x39de9a(0x21f))](_0xfd26c3);this['isFlosumVariables']&&await this[_0x39de9a(0x1e0)](_0xffdded),await(0x0,utils_1['extractAllToAsync'])(_0xffdded,this[_0x39de9a(0x1c8)]),_0x555940++;}}await this['logger'][_0x39de9a(0x208)](_0x39de9a(0x1c2)+_0x555940+_0x39de9a(0x1fb));}}exports['default']=RetrieveCartridges;