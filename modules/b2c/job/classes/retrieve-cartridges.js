const a62_0xd39d26=a62_0x1450;(function(_0x57b528,_0x2398f4){const _0x287e4e=a62_0x1450,_0x547f0d=_0x57b528();while(!![]){try{const _0x207805=-parseInt(_0x287e4e(0x1e9))/0x1+parseInt(_0x287e4e(0x1ee))/0x2+-parseInt(_0x287e4e(0x207))/0x3+-parseInt(_0x287e4e(0x1b9))/0x4*(-parseInt(_0x287e4e(0x1e1))/0x5)+-parseInt(_0x287e4e(0x1de))/0x6+parseInt(_0x287e4e(0x1ed))/0x7*(parseInt(_0x287e4e(0x1fa))/0x8)+parseInt(_0x287e4e(0x1e5))/0x9*(parseInt(_0x287e4e(0x1e8))/0xa);if(_0x207805===_0x2398f4)break;else _0x547f0d['push'](_0x547f0d['shift']());}catch(_0x3fad82){_0x547f0d['push'](_0x547f0d['shift']());}}}(a62_0x351a,0x9ced7));const a62_0x1482eb=(function(){let _0x143bab=!![];return function(_0x8f321f,_0x389dab){const _0x37083a=_0x143bab?function(){if(_0x389dab){const _0x502f1e=_0x389dab['apply'](_0x8f321f,arguments);return _0x389dab=null,_0x502f1e;}}:function(){};return _0x143bab=![],_0x37083a;};}()),a62_0x4356a4=a62_0x1482eb(this,function(){const _0x1e8301=a62_0x1450;return a62_0x4356a4[_0x1e8301(0x218)]()[_0x1e8301(0x1b3)]('(((.+)+)+)+$')[_0x1e8301(0x218)]()[_0x1e8301(0x210)](a62_0x4356a4)[_0x1e8301(0x1b3)](_0x1e8301(0x1cf));});a62_0x4356a4();function a62_0x351a(){const _0x45baff=['then','push','logger','build','utf8','getComponentHistoryIds','where','namespace','zip','8076080ZbOGEf','retrieveAttachments','join','CartridgeFile','length','apiVersion','BulkXmlStreamParser','includes','Id\x20IN\x20(:componentIds)','Body','pipe','mkdir','./utils','2797113twfSut','png','@flosum/utils','DEFAULT_CARTRIDGES_FOLDER','jpeg','eot','branchId','getIsDone','woff2','constructor','../../../../configs/path','select','getEntries','Retrieved\x20','axiosInstance','gzip','Component__c\x20IN\x20(','toString','woff','isFlosumVariables','search','isLastVersion__c\x20=\x20:isLastVersion','CompositeRetrieveData','Component_History__c','FLOSUM_LIST_COMPONENTS_ATTACHMENT_NAME','tmpPath','248mcBtpl','Name\x20IN\x20(:names)','Bulk1JobOperation','variables','updateFile','indexOf','exists','Bulk1RetrieveData','ParentId\x20IN\x20(:parentIdIds)','systemLogger','Name','jpg','name','getSelectedComponentIds','Attachment','metadataLogId','execute','lastIndexOf','\x22\x20not\x20found.','getData','ico','Component_Type__c\x20=\x20:type','(((.+)+)+)+$','__esModule','QueryBuilder','default','../../constants','defineProperty','Get\x20list\x20of\x20components.','replace','svg','rar','forEach','../../../git/internal/fs.internal','fs/promises','Query','splitOnChunks','4233852UGHnCx','ArrayUtils','keys','13445HGcqNJ','applyFlosumVariables','BodyLength','\x20file(s).','612lLNLFD','andWhere','File\x20\x22','89410POScZx','465026MOqQWk','Branch__c\x20=\x20:branchId','@flosum/salesforce','APPLICATION_XML','7mUAwhy','1923196hmMrOK','jobPath','Component__c'];a62_0x351a=function(){return _0x45baff;};return a62_0x351a();}function a62_0x1450(_0x64807b,_0x4ddb11){const _0x452084=a62_0x351a();return a62_0x1450=function(_0x4356a4,_0x1482eb){_0x4356a4=_0x4356a4-0x1b3;let _0x351aee=_0x452084[_0x4356a4];return _0x351aee;},a62_0x1450(_0x64807b,_0x4ddb11);}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x19c7a4){const _0x51474d=a62_0x1450;return _0x19c7a4&&_0x19c7a4[_0x51474d(0x1d0)]?_0x19c7a4:{'default':_0x19c7a4};};Object[a62_0xd39d26(0x1d4)](exports,a62_0xd39d26(0x1d0),{'value':!![]});const salesforce_1=require(a62_0xd39d26(0x1eb)),salesforce_2=require('@flosum/salesforce'),utils_1=require(a62_0xd39d26(0x206)),fs_internal_1=require(a62_0xd39d26(0x1da)),path_1=require(a62_0xd39d26(0x211)),promises_1=require(a62_0xd39d26(0x1db)),constants_1=require(a62_0xd39d26(0x1d3)),adm_zip_1=__importDefault(require('adm-zip')),path_2=__importDefault(require('path')),utils_2=require(a62_0xd39d26(0x209)),chunkSize=0x1f4,B2C_CARTRIDGE_TYPE=a62_0xd39d26(0x1fd),BINARY_FIELDS=['Body'],EXCLUDED_TYPES=[a62_0xd39d26(0x1c4),a62_0xd39d26(0x1d7),a62_0xd39d26(0x20c),'otf',a62_0xd39d26(0x20b),a62_0xd39d26(0x208),a62_0xd39d26(0x219),a62_0xd39d26(0x20f),'ttf',a62_0xd39d26(0x1cd),a62_0xd39d26(0x1f9),a62_0xd39d26(0x1d8),a62_0xd39d26(0x216),'pdf'];class RetrieveCartridges{constructor(_0x37aa20,_0x1358b8,_0x823101,_0xf7de06,_0x2f2d1e,_0x448de7,_0x1e5ccd,_0x52fa6f,_0x4e2da1){const _0x576e33=a62_0xd39d26;this['jobPath']=_0x37aa20,this[_0x576e33(0x215)]=_0x1358b8,this['apiVersion']=_0x823101,this[_0x576e33(0x1f8)]=_0xf7de06,this['branchId']=_0x2f2d1e,this[_0x576e33(0x1c8)]=_0x448de7,this[_0x576e33(0x1f3)]=_0x1e5ccd,this[_0x576e33(0x1c2)]=_0x52fa6f,this[_0x576e33(0x1bc)]=_0x4e2da1,this['isFlosumVariables']=![],_0x4e2da1&&(this[_0x576e33(0x21a)]=Object[_0x576e33(0x1e0)](_0x4e2da1)[_0x576e33(0x1fe)]>0x0);}async[a62_0xd39d26(0x1fb)](_0x444ca2,_0x29c5f5){const _0x5c89e0=a62_0xd39d26,_0x165d3c=new salesforce_2[(_0x5c89e0(0x1d1))]()['select'](_0x5c89e0(0x203),_0x5c89e0(0x1c3),_0x5c89e0(0x1e3))['from']('Attachment')[_0x5c89e0(0x1f7)](_0x5c89e0(0x1c1),{'parentIdIds':_0x444ca2});_0x29c5f5&&_0x165d3c[_0x5c89e0(0x1e6)](_0x5c89e0(0x1ba),{'names':_0x29c5f5});!await fs_internal_1['FS'][_0x5c89e0(0x1bf)](path_1[_0x5c89e0(0x1b8)])&&await(0x0,promises_1[_0x5c89e0(0x205)])(path_1[_0x5c89e0(0x1b8)],{'recursive':!![]});const _0x325984=new salesforce_1[(_0x5c89e0(0x1c0))]({'instance':this[_0x5c89e0(0x215)],'api':this[_0x5c89e0(0x1ff)],'pollInterval':0x1388,'queryBuilder':_0x165d3c,'objectName':_0x5c89e0(0x1c7),'contentType':salesforce_1['BulkV1QueryContentType'][_0x5c89e0(0x1ec)],'jobOperation':salesforce_1[_0x5c89e0(0x1bb)][_0x5c89e0(0x1dc)],'tmpPath':path_1[_0x5c89e0(0x1b8)]}),_0x44b484=[];do{const _0x187cb6=await _0x325984[_0x5c89e0(0x1c9)]();if(!_0x187cb6)break;const _0x28b93e=new salesforce_2[(_0x5c89e0(0x200))]({'binaryFields':BINARY_FIELDS});for await(const _0x42c4fe of _0x187cb6[_0x5c89e0(0x204)](_0x28b93e)){_0x44b484['push'](_0x42c4fe[_0x5c89e0(0x203)]);}}while(!_0x325984['getIsDone']());return _0x44b484;}async['applyFlosumVariables'](_0x6be043){const _0x3ae2e1=a62_0xd39d26,_0x2e7542=_0x6be043[_0x3ae2e1(0x213)]();_0x2e7542[_0x3ae2e1(0x1d9)](_0x2a13a8=>{const _0x22c771=_0x3ae2e1,_0x40aee6=_0x2a13a8[_0x22c771(0x1c5)],_0x25ae55=_0x40aee6['substring'](_0x40aee6[_0x22c771(0x1ca)]('.')+0x1);if(!EXCLUDED_TYPES[_0x22c771(0x201)](_0x25ae55)){let _0x3fc566=_0x2a13a8[_0x22c771(0x1cc)]()[_0x22c771(0x218)]('utf8'),_0x153236=![];for(const _0x4b3fe4 in this[_0x22c771(0x1bc)]){const _0x3855c4='%%'+_0x4b3fe4+'%%';if(_0x3fc566[_0x22c771(0x1be)](_0x3855c4)!==-0x1){const _0x2baf73=new RegExp(_0x3855c4,'ig');_0x3fc566=_0x3fc566[_0x22c771(0x1d6)](_0x2baf73,this[_0x22c771(0x1bc)][_0x4b3fe4]),_0x153236=!![];}}_0x153236&&_0x6be043[_0x22c771(0x1bd)](_0x2a13a8,Buffer['from'](_0x3fc566,_0x22c771(0x1f5)));}});}async['getComponentHistoryIds'](_0x3cd7eb){const _0x4caade=a62_0xd39d26,_0x36d1d9=[];for(const _0x15e98e of utils_2[_0x4caade(0x1df)][_0x4caade(0x1dd)](_0x3cd7eb,chunkSize)){const _0x937a54=new salesforce_2[(_0x4caade(0x1d1))]()[_0x4caade(0x212)]('Id')['from'](this[_0x4caade(0x1f8)]+_0x4caade(0x1f0))[_0x4caade(0x1f7)](this[_0x4caade(0x1f8)]+_0x4caade(0x1ea),{'branchId':this[_0x4caade(0x20d)]})[_0x4caade(0x1e6)](this[_0x4caade(0x1f8)]+_0x4caade(0x1ce),{'type':B2C_CARTRIDGE_TYPE})[_0x4caade(0x1e6)](_0x4caade(0x202),{'componentIds':_0x15e98e})[_0x4caade(0x1f4)](),_0x36546e=new salesforce_2[(_0x4caade(0x1d1))]()['select']('Id')['from'](this[_0x4caade(0x1f8)]+_0x4caade(0x1b6))[_0x4caade(0x1f7)](this[_0x4caade(0x1f8)]+_0x4caade(0x217)+_0x937a54+')')[_0x4caade(0x1e6)](this[_0x4caade(0x1f8)]+_0x4caade(0x1b4),{'isLastVersion':!![]}),_0x5678b5=new salesforce_2[(_0x4caade(0x1b5))]({'api':this[_0x4caade(0x1ff)],'queryBuilder':_0x36546e,'instance':this['axiosInstance'],'isTooling':![]});do{const _0x1f761d=await _0x5678b5[_0x4caade(0x1c9)]()[_0x4caade(0x1f1)](({records:_0x3eff51})=>_0x3eff51['map'](_0x42bd52=>_0x42bd52['Id']));_0x1f761d[_0x4caade(0x1fe)]&&_0x36d1d9[_0x4caade(0x1f2)](_0x1f761d);}while(!_0x5678b5[_0x4caade(0x20e)]());}return _0x36d1d9;}async[a62_0xd39d26(0x1c6)](){const _0x26b0d4=a62_0xd39d26,_0x483a61=path_2['default']['join'](this[_0x26b0d4(0x1ef)],constants_1[_0x26b0d4(0x20a)]);await(0x0,promises_1[_0x26b0d4(0x205)])(_0x483a61);const [_0x582c41]=await this[_0x26b0d4(0x1fb)]([this['metadataLogId']],[constants_1[_0x26b0d4(0x1b7)]]);if(!_0x582c41)throw new Error(_0x26b0d4(0x1e7)+constants_1[_0x26b0d4(0x1b7)]+_0x26b0d4(0x1cb));return await(0x0,promises_1['writeFile'])(path_2['default'][_0x26b0d4(0x1fc)](_0x483a61,constants_1[_0x26b0d4(0x1b7)]),_0x582c41),JSON['parse'](_0x582c41[_0x26b0d4(0x218)]());}async[a62_0xd39d26(0x1c9)](){const _0x15d188=a62_0xd39d26;await this[_0x15d188(0x1f3)]['log'](_0x15d188(0x1d5));const _0x595bec=await this['getSelectedComponentIds'](),_0x14b2fc=await this[_0x15d188(0x1f6)](_0x595bec);let _0x28612b=0x0;for(const _0x177552 of utils_2[_0x15d188(0x1df)][_0x15d188(0x1dd)](_0x14b2fc,chunkSize)){for(const _0x430a79 of await this['retrieveAttachments'](_0x177552)){const _0x3fbffd=new adm_zip_1[(_0x15d188(0x1d2))](_0x430a79);this['isFlosumVariables']&&await this[_0x15d188(0x1e2)](_0x3fbffd),await(0x0,utils_1['extractAllToAsync'])(_0x3fbffd,this[_0x15d188(0x1ef)]),_0x28612b++;}}await this[_0x15d188(0x1f3)]['log'](_0x15d188(0x214)+_0x28612b+_0x15d188(0x1e4));}}exports[a62_0xd39d26(0x1d2)]=RetrieveCartridges;