const a61_0x40d840=a61_0x51ce;(function(_0x53fba1,_0x18be76){const _0x2e3af2=a61_0x51ce,_0x28a9b0=_0x53fba1();while(!![]){try{const _0x43d62d=parseInt(_0x2e3af2(0xa7))/0x1*(-parseInt(_0x2e3af2(0x8a))/0x2)+-parseInt(_0x2e3af2(0x8e))/0x3*(parseInt(_0x2e3af2(0x85))/0x4)+parseInt(_0x2e3af2(0x9e))/0x5*(-parseInt(_0x2e3af2(0x97))/0x6)+-parseInt(_0x2e3af2(0xb9))/0x7*(parseInt(_0x2e3af2(0x9c))/0x8)+parseInt(_0x2e3af2(0xa8))/0x9*(-parseInt(_0x2e3af2(0xae))/0xa)+parseInt(_0x2e3af2(0xb6))/0xb+-parseInt(_0x2e3af2(0xc2))/0xc*(-parseInt(_0x2e3af2(0xa9))/0xd);if(_0x43d62d===_0x18be76)break;else _0x28a9b0['push'](_0x28a9b0['shift']());}catch(_0x38a668){_0x28a9b0['push'](_0x28a9b0['shift']());}}}(a61_0x2975,0x3b272));const a61_0x1079ad=(function(){let _0x5281bc=!![];return function(_0x21d5e3,_0x449116){const _0x4d41e8=_0x5281bc?function(){const _0x3d9b99=a61_0x51ce;if(_0x449116){const _0x5c4b14=_0x449116[_0x3d9b99(0x9b)](_0x21d5e3,arguments);return _0x449116=null,_0x5c4b14;}}:function(){};return _0x5281bc=![],_0x4d41e8;};}()),a61_0x282fc5=a61_0x1079ad(this,function(){const _0x2e3369=a61_0x51ce;return a61_0x282fc5[_0x2e3369(0xbd)]()[_0x2e3369(0x91)](_0x2e3369(0x98))[_0x2e3369(0xbd)]()[_0x2e3369(0xc1)](a61_0x282fc5)[_0x2e3369(0x91)](_0x2e3369(0x98));});a61_0x282fc5();'use strict';var __importDefault=this&&this[a61_0x40d840(0x9f)]||function(_0x26ca23){const _0x2972ff=a61_0x40d840;return _0x26ca23&&_0x26ca23[_0x2972ff(0xa0)]?_0x26ca23:{'default':_0x26ca23};};Object[a61_0x40d840(0xac)](exports,a61_0x40d840(0xa0),{'value':!![]});function a61_0x51ce(_0x2a9089,_0x3b75af){const _0x5b61f2=a61_0x2975();return a61_0x51ce=function(_0x282fc5,_0x1079ad){_0x282fc5=_0x282fc5-0x81;let _0x29753c=_0x5b61f2[_0x282fc5];return _0x29753c;},a61_0x51ce(_0x2a9089,_0x3b75af);}function a61_0x2975(){const _0x573a79=['./utils','ClauseBuilder','Component_History__c','name','join','1704016LJKNUh','Body','log','orWhere','../../constants','88kQdUPg','APPLICATION_XML','build','BodyLength','3lznYfL','isLastVersion__c\x20=\x20true','QueryService','search','\x20file(s).','andWhere','QueryBuilder','Name','default','6sBuBht','(((.+)+)+)+$','from','logger','apply','106448GOZtuy','codeVersion','296465EDNXzY','__importDefault','__esModule','Bulk1JobOperation','@flosum/salesforce','Query','select','branchId','Component__c\x20IN\x20(','4687ohlcCt','2781KZHmTZ','7157683RDhfiY','jobPath','Component_Name__c\x20LIKE\x20:componentName','defineProperty','BulkV1QueryContentType','2190tDWfgA','path','Retrieved\x20','SFRA_FOLDER_NAME','CartridgeFile','Bulk1RetrieveData','axiosInstance','execute','367004eBWJKm','where','length','70iuroEL','cartridges','getStreamAttachments','Component__c','toString','ParentId\x20IN\x20(:componentHistoryIds)','Branch__c\x20=\x20:branchId','apiVersion','constructor','24uzvayF','unzipAttachments','namespace'];a61_0x2975=function(){return _0x573a79;};return a61_0x2975();}const salesforce_1=require(a61_0x40d840(0xa2)),salesforce_2=require(a61_0x40d840(0xa2)),utils_1=require(a61_0x40d840(0xc5)),constants_1=require(a61_0x40d840(0x89)),path_1=__importDefault(require(a61_0x40d840(0xaf))),B2C_CARTRIDGE_METADATA_TYPE=a61_0x40d840(0xb2);class RetrieveCartridges{constructor(_0x41eb7f,_0x565a66,_0x13d916,_0x49293b,_0x2dd864,_0x15e8dd,_0x1cc083){const _0x4f941f=a61_0x40d840;this['jobPath']=_0x41eb7f,this[_0x4f941f(0xb4)]=_0x565a66,this[_0x4f941f(0xc0)]=_0x13d916,this['namespace']=_0x49293b,this[_0x4f941f(0xa5)]=_0x2dd864,this[_0x4f941f(0xba)]=_0x15e8dd,this[_0x4f941f(0x9a)]=_0x1cc083;}async[a61_0x40d840(0xb5)](){const _0x186873=a61_0x40d840;var _0x1a8ea2;if(!((_0x1a8ea2=this[_0x186873(0xba)])===null||_0x1a8ea2===void 0x0?void 0x0:_0x1a8ea2['length']))throw new Error('Cartridges\x20not\x20found.');const _0x10190a=new salesforce_2[(_0x186873(0x81))]();for(const _0xeff032 of this['cartridges']){const _0x27a992=_0xeff032[_0x186873(0x9d)]+'/'+_0xeff032[_0x186873(0x83)];_0x10190a[_0x186873(0x88)](this[_0x186873(0xc4)]+_0x186873(0xab),{'componentName':_0x27a992+'%'}),await this['logger'][_0x186873(0x87)]('Retrieving\x20=>\x20\x27'+_0x27a992+'\x27.');}const _0x22564b=new salesforce_2[(_0x186873(0x94))]()[_0x186873(0xa4)]('Id')['from'](this[_0x186873(0xc4)]+_0x186873(0xbc))['where'](this[_0x186873(0xc4)]+_0x186873(0xbf),{'branchId':this[_0x186873(0xa5)]})['andWhere'](this['namespace']+'Component_Type__c\x20=\x20:type',{'type':B2C_CARTRIDGE_METADATA_TYPE})[_0x186873(0x93)](_0x10190a)[_0x186873(0x8c)](),_0x1b6e05=new salesforce_2[(_0x186873(0x94))]()[_0x186873(0xa4)]('Id')[_0x186873(0x99)](this['namespace']+_0x186873(0x82))[_0x186873(0xb7)](this[_0x186873(0xc4)]+_0x186873(0xa6)+_0x22564b+')')[_0x186873(0x93)](this['namespace']+_0x186873(0x8f),{'isLastVersion':!![]})['build'](),{records:_0x8ba289}=await salesforce_2[_0x186873(0x90)][_0x186873(0xb5)](this[_0x186873(0xb4)],{},_0x1b6e05,![],this[_0x186873(0xc0)]);if(!_0x8ba289[_0x186873(0xb8)])throw new Error('Source\x20record\x20not\x20found.');const _0x2f16cd=_0x8ba289['map'](_0x572733=>_0x572733['Id']),_0x1f7b24=new salesforce_2[(_0x186873(0x94))]()[_0x186873(0xa4)](_0x186873(0x86),_0x186873(0x95),_0x186873(0x8d))['from']('Attachment')[_0x186873(0xb7)](_0x186873(0xbe),{'componentHistoryIds':_0x2f16cd}),_0x7a8ca7=new salesforce_1[(_0x186873(0xb3))]({'instance':this[_0x186873(0xb4)],'api':this[_0x186873(0xc0)],'pollInterval':0x1388,'queryBuilder':_0x1f7b24,'objectName':'Attachment','contentType':salesforce_1[_0x186873(0xad)][_0x186873(0x8b)],'jobOperation':salesforce_1[_0x186873(0xa1)][_0x186873(0xa3)]});await _0x7a8ca7[_0x186873(0xb5)]()['then'](async _0x4c6186=>{const _0x295d25=_0x186873;if(!_0x4c6186)throw new Error('Cartridges\x20files\x20not\x20found.');const _0x59c834=await(0x0,utils_1[_0x295d25(0xbb)])(_0x4c6186);if(_0x59c834[_0x295d25(0xb8)]){const _0x5d0515=path_1[_0x295d25(0x96)][_0x295d25(0x84)](this[_0x295d25(0xaa)],constants_1[_0x295d25(0xb1)]);await(0x0,utils_1[_0x295d25(0xc3)])(_0x59c834,_0x5d0515);}await this[_0x295d25(0x9a)][_0x295d25(0x87)](_0x295d25(0xb0)+_0x59c834[_0x295d25(0xb8)]+_0x295d25(0x92));});}}exports[a61_0x40d840(0x96)]=RetrieveCartridges;