const a62_0x3cb360=a62_0x1348;(function(_0xc9e836,_0x58f0cb){const _0x43cac=a62_0x1348,_0x1ee7bc=_0xc9e836();while(!![]){try{const _0x56f865=parseInt(_0x43cac(0x172))/0x1+parseInt(_0x43cac(0x1c8))/0x2*(parseInt(_0x43cac(0x18a))/0x3)+parseInt(_0x43cac(0x167))/0x4*(-parseInt(_0x43cac(0x1b6))/0x5)+parseInt(_0x43cac(0x1a2))/0x6*(parseInt(_0x43cac(0x1a1))/0x7)+parseInt(_0x43cac(0x176))/0x8*(-parseInt(_0x43cac(0x18d))/0x9)+parseInt(_0x43cac(0x170))/0xa*(-parseInt(_0x43cac(0x17e))/0xb)+parseInt(_0x43cac(0x1a6))/0xc;if(_0x56f865===_0x58f0cb)break;else _0x1ee7bc['push'](_0x1ee7bc['shift']());}catch(_0x48d6f1){_0x1ee7bc['push'](_0x1ee7bc['shift']());}}}(a62_0x32d9,0xb689f));const a62_0x540af5=(function(){let _0x298b67=!![];return function(_0x305151,_0x6d20a8){const _0x134dc3=_0x298b67?function(){if(_0x6d20a8){const _0x768418=_0x6d20a8['apply'](_0x305151,arguments);return _0x6d20a8=null,_0x768418;}}:function(){};return _0x298b67=![],_0x134dc3;};}()),a62_0x1ac670=a62_0x540af5(this,function(){const _0x17f434=a62_0x1348;return a62_0x1ac670[_0x17f434(0x1b4)]()[_0x17f434(0x1a3)]('(((.+)+)+)+$')['toString']()[_0x17f434(0x169)](a62_0x1ac670)['search'](_0x17f434(0x173));});a62_0x1ac670();'use strict';function a62_0x32d9(){const _0x166fda=['lastIndexOf','3735396AStcfA','branchId','where','BulkV1QueryContentType','Bulk1JobOperation','logger','select','apiVersion','eot','tmpPath','path','indexOf','Attachment','getEntries','toString','variables','475390oSIasq','FLOSUM_LIST_COMPONENTS_ATTACHMENT_NAME','./utils','Name\x20IN\x20(:names)','axiosInstance','Bulk1RetrieveData','Component__c','join','then','length','log','APPLICATION_XML','gzip','mkdir','BulkXmlStreamParser','Name','pdf','svg','76dojHJY','DEFAULT_CARTRIDGES_FOLDER','Id\x20IN\x20(:componentIds)','52tmEvUX','../../../git/internal/fs.internal','constructor','File\x20\x22','../../constants','andWhere','Component_Type__c\x20=\x20:type','build','otf','1678510fwWaJk','substring','780957OrfxOv','(((.+)+)+)+$','woff','ArrayUtils','11527048pBUaUO','png','applyFlosumVariables','../../../../configs/path','__esModule','adm-zip','rar','Branch__c\x20=\x20:branchId','22lPkESz','jobPath','extractAllToAsync','keys','replace','execute','metadataLogId','isFlosumVariables','getSelectedComponentIds','__importDefault','retrieveAttachments','name','114831oVeJFD','Component_History__c','ico','9hTOhhp','isLastVersion__c\x20=\x20:isLastVersion','zip','QueryBuilder','default','push','forEach','\x20file(s).','from','\x22\x20not\x20found.','exists','namespace','splitOnChunks','Query','BodyLength','woff2','parse','Body','writeFile','updateFile','7hKUdaQ','7281060mSEeBt','search','@flosum/salesforce'];a62_0x32d9=function(){return _0x166fda;};return a62_0x32d9();}var __importDefault=this&&this[a62_0x3cb360(0x187)]||function(_0x2b1981){const _0x8e2dac=a62_0x3cb360;return _0x2b1981&&_0x2b1981[_0x8e2dac(0x17a)]?_0x2b1981:{'default':_0x2b1981};};Object['defineProperty'](exports,a62_0x3cb360(0x17a),{'value':!![]});function a62_0x1348(_0x4e3b86,_0x47d519){const _0xa2cd43=a62_0x32d9();return a62_0x1348=function(_0x1ac670,_0x540af5){_0x1ac670=_0x1ac670-0x167;let _0x32d973=_0xa2cd43[_0x1ac670];return _0x32d973;},a62_0x1348(_0x4e3b86,_0x47d519);}const salesforce_1=require('@flosum/salesforce'),salesforce_2=require(a62_0x3cb360(0x1a4)),utils_1=require(a62_0x3cb360(0x1b8)),fs_internal_1=require(a62_0x3cb360(0x168)),path_1=require(a62_0x3cb360(0x179)),promises_1=require('fs/promises'),constants_1=require(a62_0x3cb360(0x16b)),adm_zip_1=__importDefault(require(a62_0x3cb360(0x17b))),path_2=__importDefault(require(a62_0x3cb360(0x1b0))),utils_2=require('@flosum/utils'),chunkSize=0x1f4,B2C_CARTRIDGE_TYPE='CartridgeFile',BINARY_FIELDS=['Body'],EXCLUDED_TYPES=['jpg',a62_0x3cb360(0x1c7),a62_0x3cb360(0x1ae),a62_0x3cb360(0x16f),'jpeg',a62_0x3cb360(0x177),a62_0x3cb360(0x174),a62_0x3cb360(0x19c),'ttf',a62_0x3cb360(0x18c),a62_0x3cb360(0x18f),a62_0x3cb360(0x17c),a62_0x3cb360(0x1c2),a62_0x3cb360(0x1c6)];class RetrieveCartridges{constructor(_0x2cb812,_0x493337,_0x285b8b,_0x462288,_0x1b47c8,_0x5b2f90,_0x35799a,_0x2e008b,_0x526b18){const _0x5beb99=a62_0x3cb360;this[_0x5beb99(0x17f)]=_0x2cb812,this[_0x5beb99(0x1ba)]=_0x493337,this[_0x5beb99(0x1ad)]=_0x285b8b,this[_0x5beb99(0x198)]=_0x462288,this[_0x5beb99(0x1a7)]=_0x1b47c8,this[_0x5beb99(0x184)]=_0x5b2f90,this[_0x5beb99(0x1ab)]=_0x35799a,this['systemLogger']=_0x2e008b,this[_0x5beb99(0x1b5)]=_0x526b18,this[_0x5beb99(0x185)]=![],_0x526b18&&(this[_0x5beb99(0x185)]=Object[_0x5beb99(0x181)](_0x526b18)[_0x5beb99(0x1bf)]>0x0);}async[a62_0x3cb360(0x188)](_0x423527,_0x2744aa){const _0x331548=a62_0x3cb360,_0x5999a3=new salesforce_2['QueryBuilder']()[_0x331548(0x1ac)]('Body',_0x331548(0x1c5),_0x331548(0x19b))[_0x331548(0x195)](_0x331548(0x1b2))[_0x331548(0x1a8)]('ParentId\x20IN\x20(:parentIdIds)',{'parentIdIds':_0x423527});_0x2744aa&&_0x5999a3[_0x331548(0x16c)](_0x331548(0x1b9),{'names':_0x2744aa});!await fs_internal_1['FS'][_0x331548(0x197)](path_1['tmpPath'])&&await(0x0,promises_1[_0x331548(0x1c3)])(path_1['tmpPath'],{'recursive':!![]});const _0x397348=new salesforce_1[(_0x331548(0x1bb))]({'instance':this[_0x331548(0x1ba)],'api':this[_0x331548(0x1ad)],'pollInterval':0x1388,'queryBuilder':_0x5999a3,'objectName':_0x331548(0x1b2),'contentType':salesforce_1[_0x331548(0x1a9)][_0x331548(0x1c1)],'jobOperation':salesforce_1[_0x331548(0x1aa)][_0x331548(0x19a)],'tmpPath':path_1[_0x331548(0x1af)]}),_0x1f2b57=[];do{const _0x5d1ae3=await _0x397348[_0x331548(0x183)]();if(!_0x5d1ae3)break;const _0x520eef=new salesforce_2[(_0x331548(0x1c4))]({'binaryFields':BINARY_FIELDS});for await(const _0x46c84a of _0x5d1ae3['pipe'](_0x520eef)){_0x1f2b57[_0x331548(0x192)](_0x46c84a[_0x331548(0x19e)]);}}while(!_0x397348['getIsDone']());return _0x1f2b57;}async[a62_0x3cb360(0x178)](_0x27ed27){const _0xe60273=a62_0x3cb360,_0x456239=_0x27ed27[_0xe60273(0x1b3)]();_0x456239[_0xe60273(0x193)](_0x4daacc=>{const _0x3a75ae=_0xe60273,_0x1b3680=_0x4daacc[_0x3a75ae(0x189)],_0xaf262f=_0x1b3680[_0x3a75ae(0x171)](_0x1b3680[_0x3a75ae(0x1a5)]('.')+0x1);if(!EXCLUDED_TYPES['includes'](_0xaf262f)){let _0x51625b=_0x4daacc['getData']()[_0x3a75ae(0x1b4)]('utf8'),_0x220876=![];for(const _0x35caff in this['variables']){const _0x3c80f7='%%'+_0x35caff+'%%';if(_0x51625b[_0x3a75ae(0x1b1)](_0x3c80f7)!==-0x1){const _0x5b7fea=new RegExp(_0x3c80f7,'ig');_0x51625b=_0x51625b[_0x3a75ae(0x182)](_0x5b7fea,this[_0x3a75ae(0x1b5)][_0x35caff]),_0x220876=!![];}}_0x220876&&_0x27ed27[_0x3a75ae(0x1a0)](_0x4daacc,Buffer[_0x3a75ae(0x195)](_0x51625b,'utf8'));}});}async['getComponentHistoryIds'](_0x61f71c){const _0x18137d=a62_0x3cb360,_0x1ec38a=[];for(const _0x19750f of utils_2[_0x18137d(0x175)][_0x18137d(0x199)](_0x61f71c,chunkSize)){const _0xc31fcb=new salesforce_2[(_0x18137d(0x190))]()[_0x18137d(0x1ac)]('Id')[_0x18137d(0x195)](this[_0x18137d(0x198)]+_0x18137d(0x1bc))[_0x18137d(0x1a8)](this[_0x18137d(0x198)]+_0x18137d(0x17d),{'branchId':this[_0x18137d(0x1a7)]})[_0x18137d(0x16c)](this[_0x18137d(0x198)]+_0x18137d(0x16d),{'type':B2C_CARTRIDGE_TYPE})[_0x18137d(0x16c)](_0x18137d(0x1ca),{'componentIds':_0x19750f})[_0x18137d(0x16e)](),_0x337a1c=new salesforce_2['QueryBuilder']()[_0x18137d(0x1ac)]('Id')[_0x18137d(0x195)](this['namespace']+_0x18137d(0x18b))['where'](this['namespace']+'Component__c\x20IN\x20('+_0xc31fcb+')')[_0x18137d(0x16c)](this[_0x18137d(0x198)]+_0x18137d(0x18e),{'isLastVersion':!![]}),_0x2b4895=new salesforce_2['CompositeRetrieveData']({'api':this[_0x18137d(0x1ad)],'queryBuilder':_0x337a1c,'instance':this['axiosInstance'],'isTooling':![]});do{const _0x4d003f=await _0x2b4895[_0x18137d(0x183)]()[_0x18137d(0x1be)](({records:_0x37e2ec})=>_0x37e2ec['map'](_0x13124c=>_0x13124c['Id']));_0x4d003f[_0x18137d(0x1bf)]&&_0x1ec38a['push'](_0x4d003f);}while(!_0x2b4895['getIsDone']());}return _0x1ec38a;}async[a62_0x3cb360(0x186)](){const _0x455486=a62_0x3cb360,_0x4d7ba4=path_2[_0x455486(0x191)][_0x455486(0x1bd)](this[_0x455486(0x17f)],constants_1[_0x455486(0x1c9)]);await(0x0,promises_1[_0x455486(0x1c3)])(_0x4d7ba4);const [_0x2ea62a]=await this[_0x455486(0x188)]([this['metadataLogId']],[constants_1[_0x455486(0x1b7)]]);if(!_0x2ea62a)throw new Error(_0x455486(0x16a)+constants_1[_0x455486(0x1b7)]+_0x455486(0x196));return await(0x0,promises_1[_0x455486(0x19f)])(path_2[_0x455486(0x191)][_0x455486(0x1bd)](_0x4d7ba4,constants_1[_0x455486(0x1b7)]),_0x2ea62a),JSON[_0x455486(0x19d)](_0x2ea62a['toString']());}async['execute'](){const _0x15a632=a62_0x3cb360;await this['logger']['log']('Get\x20list\x20of\x20components.');const _0x15f3ac=await this['getSelectedComponentIds'](),_0x1471a3=await this['getComponentHistoryIds'](_0x15f3ac);let _0x358c1d=0x0;for(const _0xdd74c9 of utils_2[_0x15a632(0x175)][_0x15a632(0x199)](_0x1471a3,chunkSize)){for(const _0x3bd7ee of await this['retrieveAttachments'](_0xdd74c9)){const _0x4cc6a6=new adm_zip_1['default'](_0x3bd7ee);this[_0x15a632(0x185)]&&await this[_0x15a632(0x178)](_0x4cc6a6),await(0x0,utils_1[_0x15a632(0x180)])(_0x4cc6a6,this[_0x15a632(0x17f)]),_0x358c1d++;}}await this[_0x15a632(0x1ab)][_0x15a632(0x1c0)]('Retrieved\x20'+_0x358c1d+_0x15a632(0x194));}}exports[a62_0x3cb360(0x191)]=RetrieveCartridges;