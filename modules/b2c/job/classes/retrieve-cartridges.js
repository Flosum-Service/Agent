const a61_0xa95c41=a61_0x5a1b;(function(_0x12f58a,_0xa4468e){const _0x5e2fce=a61_0x5a1b,_0x59b9a2=_0x12f58a();while(!![]){try{const _0x380fa4=-parseInt(_0x5e2fce(0x1c4))/0x1+-parseInt(_0x5e2fce(0x1aa))/0x2*(parseInt(_0x5e2fce(0x1c7))/0x3)+parseInt(_0x5e2fce(0x1dc))/0x4*(-parseInt(_0x5e2fce(0x1b5))/0x5)+-parseInt(_0x5e2fce(0x1d0))/0x6*(-parseInt(_0x5e2fce(0x1ae))/0x7)+parseInt(_0x5e2fce(0x1c6))/0x8*(parseInt(_0x5e2fce(0x1d3))/0x9)+parseInt(_0x5e2fce(0x1d4))/0xa*(-parseInt(_0x5e2fce(0x1da))/0xb)+parseInt(_0x5e2fce(0x1b7))/0xc*(parseInt(_0x5e2fce(0x1e9))/0xd);if(_0x380fa4===_0xa4468e)break;else _0x59b9a2['push'](_0x59b9a2['shift']());}catch(_0x874ed2){_0x59b9a2['push'](_0x59b9a2['shift']());}}}(a61_0x31be,0xe9a4e));const a61_0x20b2bc=(function(){let _0x2813fe=!![];return function(_0x2ac486,_0x171da9){const _0xa5253b=_0x2813fe?function(){const _0xfafc08=a61_0x5a1b;if(_0x171da9){const _0x2551d1=_0x171da9[_0xfafc08(0x1b6)](_0x2ac486,arguments);return _0x171da9=null,_0x2551d1;}}:function(){};return _0x2813fe=![],_0xa5253b;};}()),a61_0x4a7fb9=a61_0x20b2bc(this,function(){const _0x36f040=a61_0x5a1b;return a61_0x4a7fb9[_0x36f040(0x1b8)]()[_0x36f040(0x1bb)](_0x36f040(0x1cb))[_0x36f040(0x1b8)]()[_0x36f040(0x1b3)](a61_0x4a7fb9)['search']('(((.+)+)+)+$');});function a61_0x5a1b(_0x501fb6,_0x18e8ea){const _0x456e72=a61_0x31be();return a61_0x5a1b=function(_0x4a7fb9,_0x20b2bc){_0x4a7fb9=_0x4a7fb9-0x1a6;let _0x31be5b=_0x456e72[_0x4a7fb9];return _0x31be5b;},a61_0x5a1b(_0x501fb6,_0x18e8ea);}a61_0x4a7fb9();'use strict';var __importDefault=this&&this[a61_0xa95c41(0x1bf)]||function(_0x4eccbc){const _0x5e2d52=a61_0xa95c41;return _0x4eccbc&&_0x4eccbc[_0x5e2d52(0x1a6)]?_0x4eccbc:{'default':_0x4eccbc};};function a61_0x31be(){const _0x3f37db=['@flosum/salesforce','Branch__c\x20=\x20:branchId','logger','Component__c','execute','Component_Type__c\x20=\x20:type','codeVersion','join','map','./utils','getComponentHistoryRecords','log','60476tRvoXU','__esModule','getIsDone','Component_History__c','QueryBuilder','3518216oqdlmk','cartridges','BulkV1QueryContentType','isLastVersion__c\x20=\x20true','363027NfGNUm','SFRA_FOLDER_NAME','build','Cartridges\x20not\x20found.','andWhere','constructor','BodyLength','15YDKjpC','apply','9456zcUctF','toString','orWhere','from','search','ClauseBuilder','name','defineProperty','__importDefault','branchId','where','Component_Name__c\x20LIKE\x20:componentName','select','711375qoyKgt','jobPath','88dkfFyy','3NKtorH','APPLICATION_XML','../../constants','QueryService','(((.+)+)+)+$','Attachment','Bulk1PkRetrieveData','length','ParentId\x20IN\x20(:componentHistoryIds)','168iZbNDn','Component__c\x20IN\x20(','apiVersion','413811VFvvav','1211650wTmfcp','\x20file(s).','CartridgeFile','namespace','default','Body','121lUIQjw','Bulk1JobOperation','1151132pEJGGY'];a61_0x31be=function(){return _0x3f37db;};return a61_0x31be();}Object[a61_0xa95c41(0x1be)](exports,'__esModule',{'value':!![]});const salesforce_1=require(a61_0xa95c41(0x1dd)),salesforce_2=require(a61_0xa95c41(0x1dd)),constants_1=require(a61_0xa95c41(0x1c9)),utils_1=require(a61_0xa95c41(0x1e6)),path_1=__importDefault(require('path')),adm_zip_1=__importDefault(require('adm-zip')),B2C_CARTRIDGE_METADATA_TYPE=a61_0xa95c41(0x1d6),CHUNK_SIZE=0x7d0,BINARY_FIELDS=['Body'];class RetrieveCartridges{constructor(_0x1f5593,_0x3604f0,_0x53f396,_0x45811e,_0x192dc3,_0x44150f,_0xb5e17f){const _0x410fe1=a61_0xa95c41;this['jobPath']=_0x1f5593,this['axiosInstance']=_0x3604f0,this[_0x410fe1(0x1d2)]=_0x53f396,this[_0x410fe1(0x1d7)]=_0x45811e,this[_0x410fe1(0x1c0)]=_0x192dc3,this['cartridges']=_0x44150f,this[_0x410fe1(0x1df)]=_0xb5e17f;}async[a61_0xa95c41(0x1e1)](){const _0x21ec84=a61_0xa95c41;var _0x45b5a0;if(!((_0x45b5a0=this[_0x21ec84(0x1ab)])===null||_0x45b5a0===void 0x0?void 0x0:_0x45b5a0['length']))throw new Error(_0x21ec84(0x1b1));const _0x1f4e6a=await this[_0x21ec84(0x1e7)](),_0x3f52f1=_0x1f4e6a[_0x21ec84(0x1e5)](_0x46d013=>_0x46d013['Id']),_0x345bc7=new salesforce_2[(_0x21ec84(0x1a9))]()['select'](_0x21ec84(0x1d9),'Name',_0x21ec84(0x1b4))['from'](_0x21ec84(0x1cc))[_0x21ec84(0x1c1)](_0x21ec84(0x1cf),{'componentHistoryIds':_0x3f52f1}),_0x2deb3c=new salesforce_1[(_0x21ec84(0x1cd))]({'instance':this['axiosInstance'],'api':this[_0x21ec84(0x1d2)],'pollInterval':0x1388,'queryBuilder':_0x345bc7,'objectName':_0x21ec84(0x1cc),'contentType':salesforce_1[_0x21ec84(0x1ac)][_0x21ec84(0x1c8)],'jobOperation':salesforce_1[_0x21ec84(0x1db)]['Query'],'chunkSize':CHUNK_SIZE});let _0xed4bc9=0x0;do{const _0x33d07c=await _0x2deb3c[_0x21ec84(0x1e1)]();if(!_0x33d07c)break;const _0x2b3546=new salesforce_1['BulkXmlStreamParser']({'binaryFields':BINARY_FIELDS});for await(const _0x1b7720 of _0x33d07c['pipe'](_0x2b3546)){_0xed4bc9++;const _0x515fac=path_1[_0x21ec84(0x1d8)][_0x21ec84(0x1e4)](this[_0x21ec84(0x1c5)],constants_1[_0x21ec84(0x1af)]),_0x4ad0ed=new adm_zip_1[(_0x21ec84(0x1d8))](_0x1b7720[_0x21ec84(0x1d9)]);await(0x0,utils_1['extractAllToAsync'])(_0x4ad0ed,_0x515fac);}}while(!_0x2deb3c[_0x21ec84(0x1a7)]());await this[_0x21ec84(0x1df)][_0x21ec84(0x1e8)]('Retrieved\x20'+_0xed4bc9+_0x21ec84(0x1d5));}async[a61_0xa95c41(0x1e7)](){const _0x46cd14=a61_0xa95c41,_0x98eb2d=new salesforce_2[(_0x46cd14(0x1bc))]();for(const _0x25420d of this[_0x46cd14(0x1ab)]){const _0x428e27=_0x25420d[_0x46cd14(0x1e3)]+'/'+_0x25420d[_0x46cd14(0x1bd)];_0x98eb2d[_0x46cd14(0x1b9)](this[_0x46cd14(0x1d7)]+_0x46cd14(0x1c2),{'componentName':_0x428e27+'%'}),await this['logger'][_0x46cd14(0x1e8)]('Retrieving\x20=>\x20\x27'+_0x428e27+'\x27.');}const _0x318bde=new salesforce_2[(_0x46cd14(0x1a9))]()[_0x46cd14(0x1c3)]('Id')[_0x46cd14(0x1ba)](this[_0x46cd14(0x1d7)]+_0x46cd14(0x1e0))[_0x46cd14(0x1c1)](this[_0x46cd14(0x1d7)]+_0x46cd14(0x1de),{'branchId':this['branchId']})['andWhere'](this[_0x46cd14(0x1d7)]+_0x46cd14(0x1e2),{'type':B2C_CARTRIDGE_METADATA_TYPE})[_0x46cd14(0x1b2)](_0x98eb2d)[_0x46cd14(0x1b0)](),_0x5ee195=new salesforce_2[(_0x46cd14(0x1a9))]()[_0x46cd14(0x1c3)]('Id')[_0x46cd14(0x1ba)](this[_0x46cd14(0x1d7)]+_0x46cd14(0x1a8))[_0x46cd14(0x1c1)](this[_0x46cd14(0x1d7)]+_0x46cd14(0x1d1)+_0x318bde+')')[_0x46cd14(0x1b2)](this[_0x46cd14(0x1d7)]+_0x46cd14(0x1ad),{'isLastVersion':!![]})['build'](),{records:_0x51d88f}=await salesforce_2[_0x46cd14(0x1ca)][_0x46cd14(0x1e1)](this['axiosInstance'],{},_0x5ee195,![],this[_0x46cd14(0x1d2)]);if(!_0x51d88f[_0x46cd14(0x1ce)])throw new Error('Source\x20record\x20not\x20found.');return _0x51d88f;}}exports[a61_0xa95c41(0x1d8)]=RetrieveCartridges;