const a62_0x32c5d1=a62_0x5090;function a62_0x5090(_0x282864,_0x54ed53){const _0x4bfa79=a62_0x11f5();return a62_0x5090=function(_0x11eb25,_0x8c6a8b){_0x11eb25=_0x11eb25-0x90;let _0x11f544=_0x4bfa79[_0x11eb25];return _0x11f544;},a62_0x5090(_0x282864,_0x54ed53);}function a62_0x11f5(){const _0x55b6b2=['CompositeRetrieveData','defineProperty','373756uJAHkl','axiosInstance','getComponentHistoryIds','logger','eot','Component__c\x20IN\x20(','1301448MgLwDh','isFlosumVariables','select','gzip','Body','variables','adm-zip','Query','BodyLength','504882JKpvUU','jobPath','Component_Type__c\x20=\x20:type','Bulk1JobOperation','woff','execute','getIsDone','keys','(((.+)+)+)+$','utf8','\x20file(s).','woff2','apiVersion','apply','@flosum/salesforce','104412dSBCHu','BulkV1QueryContentType','29195FbjxXI','Branch__c\x20=\x20:branchId','Component__c','__importDefault','toString','pipe','Component_History__c','exists','ParentId\x20IN\x20(:componentHistoryIds)','constructor','../../../../configs/path','getEntries','CartridgeFile','pdf','name','Name','where','log','./utils','Bulk1RetrieveData','length','map','namespace','fs/promises','andWhere','indexOf','1330YteNDf','branchId','build','rar','from','svg','forEach','148240JpGMAC','ttf','mkdir','__esModule','114jqepvO','../../../git/internal/fs.internal','png','applyFlosumVariables','tmpPath','substring','search'];a62_0x11f5=function(){return _0x55b6b2;};return a62_0x11f5();}(function(_0x3e46d5,_0x1b973b){const _0x257cc7=a62_0x5090,_0x3e9d92=_0x3e46d5();while(!![]){try{const _0x235afd=parseInt(_0x257cc7(0xa8))/0x1+-parseInt(_0x257cc7(0xd8))/0x2+parseInt(_0x257cc7(0x99))/0x3+-parseInt(_0x257cc7(0xcb))/0x4+parseInt(_0x257cc7(0xaa))/0x5*(-parseInt(_0x257cc7(0xcf))/0x6)+-parseInt(_0x257cc7(0xc4))/0x7+parseInt(_0x257cc7(0x90))/0x8;if(_0x235afd===_0x1b973b)break;else _0x3e9d92['push'](_0x3e9d92['shift']());}catch(_0x1d7126){_0x3e9d92['push'](_0x3e9d92['shift']());}}}(a62_0x11f5,0x187de));const a62_0x8c6a8b=(function(){let _0x528ae5=!![];return function(_0x19a461,_0x4d6e73){const _0xea6014=_0x528ae5?function(){const _0x29e45b=a62_0x5090;if(_0x4d6e73){const _0x2639aa=_0x4d6e73[_0x29e45b(0xa6)](_0x19a461,arguments);return _0x4d6e73=null,_0x2639aa;}}:function(){};return _0x528ae5=![],_0xea6014;};}()),a62_0x11eb25=a62_0x8c6a8b(this,function(){const _0x530989=a62_0x5090;return a62_0x11eb25[_0x530989(0xae)]()['search'](_0x530989(0xa1))[_0x530989(0xae)]()[_0x530989(0xb3)](a62_0x11eb25)[_0x530989(0xd5)](_0x530989(0xa1));});a62_0x11eb25();'use strict';var __importDefault=this&&this[a62_0x32c5d1(0xad)]||function(_0x39559d){const _0x45cbea=a62_0x32c5d1;return _0x39559d&&_0x39559d[_0x45cbea(0xce)]?_0x39559d:{'default':_0x39559d};};Object[a62_0x32c5d1(0xd7)](exports,'__esModule',{'value':!![]});const salesforce_1=require(a62_0x32c5d1(0xa7)),salesforce_2=require(a62_0x32c5d1(0xa7)),utils_1=require(a62_0x32c5d1(0xbc)),promises_1=require(a62_0x32c5d1(0xc1)),fs_internal_1=require(a62_0x32c5d1(0xd0)),path_1=require(a62_0x32c5d1(0xb4)),adm_zip_1=__importDefault(require(a62_0x32c5d1(0x96))),B2C_CARTRIDGE_TYPE=a62_0x32c5d1(0xb6),BINARY_FIELDS=['Body'],EXCLUDED_TYPES=['jpg',a62_0x32c5d1(0xc9),a62_0x32c5d1(0xdc),'otf','jpeg',a62_0x32c5d1(0xd1),a62_0x32c5d1(0x9d),a62_0x32c5d1(0xa4),a62_0x32c5d1(0xcc),'ico','zip',a62_0x32c5d1(0xc7),a62_0x32c5d1(0x93),a62_0x32c5d1(0xb7)];class RetrieveCartridges{constructor(_0x22a32c,_0x3b7d2b,_0x9cd2f3,_0x330ba3,_0x825c82,_0x96c356,_0x1258d8){const _0x48c7dd=a62_0x32c5d1;this[_0x48c7dd(0x9a)]=_0x22a32c,this[_0x48c7dd(0xd9)]=_0x3b7d2b,this[_0x48c7dd(0xa5)]=_0x9cd2f3,this[_0x48c7dd(0xc0)]=_0x330ba3,this['branchId']=_0x825c82,this[_0x48c7dd(0x95)]=_0x96c356,this[_0x48c7dd(0xdb)]=_0x1258d8,this[_0x48c7dd(0x91)]=![],this[_0x48c7dd(0x91)]=Object[_0x48c7dd(0xa0)](this[_0x48c7dd(0x95)])[_0x48c7dd(0xbe)]>0x0;}async['retriveAttachments'](_0x320df8){const _0x20620d=a62_0x32c5d1,_0x171287=new salesforce_2['QueryBuilder']()[_0x20620d(0x92)](_0x20620d(0x94),_0x20620d(0xb9),_0x20620d(0x98))[_0x20620d(0xc8)]('Attachment')[_0x20620d(0xba)](_0x20620d(0xb2),{'componentHistoryIds':_0x320df8});!await fs_internal_1['FS'][_0x20620d(0xb1)](path_1[_0x20620d(0xd3)])&&await(0x0,promises_1[_0x20620d(0xcd)])(path_1['tmpPath'],{'recursive':!![]});const _0x2d93e3=new salesforce_1[(_0x20620d(0xbd))]({'instance':this[_0x20620d(0xd9)],'api':this[_0x20620d(0xa5)],'pollInterval':0x1388,'queryBuilder':_0x171287,'objectName':'Attachment','contentType':salesforce_1[_0x20620d(0xa9)]['APPLICATION_XML'],'jobOperation':salesforce_1[_0x20620d(0x9c)][_0x20620d(0x97)],'tmpPath':path_1[_0x20620d(0xd3)]});let _0x32fc0b=0x0;do{const _0x52b3df=await _0x2d93e3[_0x20620d(0x9e)]();if(!_0x52b3df)break;const _0x1f83bb=new salesforce_2['BulkXmlStreamParser']({'binaryFields':BINARY_FIELDS});for await(const _0x5e80d4 of _0x52b3df[_0x20620d(0xaf)](_0x1f83bb)){_0x32fc0b++;const _0x3e2035=new adm_zip_1['default'](_0x5e80d4['Body']);this[_0x20620d(0x91)]&&await this[_0x20620d(0xd2)](_0x3e2035),await(0x0,utils_1['extractAllToAsync'])(_0x3e2035,this['jobPath']);}}while(!_0x2d93e3[_0x20620d(0x9f)]());return _0x32fc0b;}async[a62_0x32c5d1(0xd2)](_0x518416){const _0x2abac0=a62_0x32c5d1,_0x5e3291=_0x518416[_0x2abac0(0xb5)]();_0x5e3291[_0x2abac0(0xca)](_0x1d5521=>{const _0x3afb81=_0x2abac0,_0x54f139=_0x1d5521[_0x3afb81(0xb8)],_0xde546b=_0x54f139[_0x3afb81(0xd4)](_0x54f139['lastIndexOf']('.')+0x1);if(!EXCLUDED_TYPES['includes'](_0xde546b)){let _0x37c4a4=_0x1d5521['getData']()['toString'](_0x3afb81(0xa2)),_0x5ef580=![];for(const _0x3d847b in this[_0x3afb81(0x95)]){const _0x1e1228='%%'+_0x3d847b+'%%';if(_0x37c4a4[_0x3afb81(0xc3)](_0x1e1228)!==-0x1){const _0x15046b=new RegExp(_0x1e1228,'ig');_0x37c4a4=_0x37c4a4['replace'](_0x15046b,this[_0x3afb81(0x95)][_0x3d847b]),_0x5ef580=!![];}}_0x5ef580&&_0x518416['updateFile'](_0x1d5521,Buffer[_0x3afb81(0xc8)](_0x37c4a4,_0x3afb81(0xa2)));}});}async[a62_0x32c5d1(0xda)](){const _0x1ebf65=a62_0x32c5d1,_0x3fb140=[],_0x5b922e=new salesforce_2['QueryBuilder']()[_0x1ebf65(0x92)]('Id')[_0x1ebf65(0xc8)](this['namespace']+_0x1ebf65(0xac))[_0x1ebf65(0xba)](this['namespace']+_0x1ebf65(0xab),{'branchId':this[_0x1ebf65(0xc5)]})['andWhere'](this[_0x1ebf65(0xc0)]+_0x1ebf65(0x9b),{'type':B2C_CARTRIDGE_TYPE})[_0x1ebf65(0xc6)](),_0x59a20c=new salesforce_2['QueryBuilder']()['select']('Id')[_0x1ebf65(0xc8)](this[_0x1ebf65(0xc0)]+_0x1ebf65(0xb0))['where'](this[_0x1ebf65(0xc0)]+_0x1ebf65(0xdd)+_0x5b922e+')')[_0x1ebf65(0xc2)](this[_0x1ebf65(0xc0)]+'isLastVersion__c\x20=\x20:isLastVersion',{'isLastVersion':!![]}),_0xdc8afa=new salesforce_2[(_0x1ebf65(0xd6))]({'api':this[_0x1ebf65(0xa5)],'queryBuilder':_0x59a20c,'instance':this[_0x1ebf65(0xd9)],'isTooling':![]});do{const _0x3c5ca2=await _0xdc8afa[_0x1ebf65(0x9e)]()['then'](({records:_0x50a42e})=>_0x50a42e[_0x1ebf65(0xbf)](_0x42dd98=>_0x42dd98['Id']));_0x3c5ca2['length']&&_0x3fb140['push'](_0x3c5ca2);}while(!_0xdc8afa[_0x1ebf65(0x9f)]());return _0x3fb140;}async[a62_0x32c5d1(0x9e)](){const _0x559c1b=a62_0x32c5d1,_0x40758f=await this['getComponentHistoryIds']();let _0xafa60=0x0;for(const _0x560b1c of _0x40758f){_0xafa60+=await this['retriveAttachments'](_0x560b1c);}await this[_0x559c1b(0xdb)][_0x559c1b(0xbb)]('Retrieved\x20'+_0xafa60+_0x559c1b(0xa3));}}exports['default']=RetrieveCartridges;