const a60_0x2377cb=a60_0x4651;(function(_0x547ac8,_0x2be97b){const _0x354a03=a60_0x4651,_0x476106=_0x547ac8();while(!![]){try{const _0x4dfdc9=parseInt(_0x354a03(0xb7))/0x1+parseInt(_0x354a03(0xf5))/0x2*(parseInt(_0x354a03(0xbb))/0x3)+-parseInt(_0x354a03(0xb2))/0x4*(-parseInt(_0x354a03(0xab))/0x5)+parseInt(_0x354a03(0xda))/0x6+parseInt(_0x354a03(0xc7))/0x7*(-parseInt(_0x354a03(0xcb))/0x8)+-parseInt(_0x354a03(0xe0))/0x9*(parseInt(_0x354a03(0xad))/0xa)+-parseInt(_0x354a03(0xe4))/0xb*(parseInt(_0x354a03(0xcf))/0xc);if(_0x4dfdc9===_0x2be97b)break;else _0x476106['push'](_0x476106['shift']());}catch(_0x176fa7){_0x476106['push'](_0x476106['shift']());}}}(a60_0x2a51,0xd9f6a));const a60_0xa5a674=(function(){let _0x125f8e=!![];return function(_0x495ca7,_0x464c9f){const _0x20a9e7=_0x125f8e?function(){const _0xb40d20=a60_0x4651;if(_0x464c9f){const _0x1e476a=_0x464c9f[_0xb40d20(0xd6)](_0x495ca7,arguments);return _0x464c9f=null,_0x1e476a;}}:function(){};return _0x125f8e=![],_0x20a9e7;};}()),a60_0x1d6550=a60_0xa5a674(this,function(){const _0x7c82bb=a60_0x4651;return a60_0x1d6550[_0x7c82bb(0xe6)]()[_0x7c82bb(0xf4)](_0x7c82bb(0xe3))[_0x7c82bb(0xe6)]()['constructor'](a60_0x1d6550)[_0x7c82bb(0xf4)]('(((.+)+)+)+$');});a60_0x1d6550();'use strict';function a60_0x4651(_0x2c9474,_0x27be87){const _0x63ddb8=a60_0x2a51();return a60_0x4651=function(_0x1d6550,_0xa5a674){_0x1d6550=_0x1d6550-0xaa;let _0x2a5144=_0x63ddb8[_0x1d6550];return _0x2a5144;},a60_0x4651(_0x2c9474,_0x27be87);}function a60_0x2a51(){const _0x4a9169=['5mFvxsX','otf','557490yhUOmc','\x20file(s).','png','applyFlosumVariables','ico','3578908vahzJz','axiosInstance','logger','Component_Type__c\x20=\x20:type','name','1012254kPDyjQ','pdf','apiVersion','Branch__c\x20=\x20:branchId','3TglNKO','isLastVersion__c\x20=\x20:isLastVersion','@flosum/salesforce','andWhere','gzip','Query','substring','jpg','jobPath','Attachment','namespace','indexOf','14GTlovX','APPLICATION_XML','CartridgeFile','getComponentHistoryIds','318616sbqCQB','Bulk1RetrieveData','defineProperty','Body','24996GvQrhT','where','variables','lastIndexOf','getData','execute','build','apply','CompositeRetrieveData','select','QueryBuilder','7544718OaVCGA','BulkXmlStreamParser','Bulk1JobOperation','BodyLength','__importDefault','utf8','36UzENYN','getIsDone','log','(((.+)+)+)+$','16830LkfkKr','Component__c','toString','__esModule','woff','./utils','includes','branchId','Retrieved\x20','pipe','retriveAttachments','ParentId\x20IN\x20(:componentHistoryIds)','extractAllToAsync','default','from','zip','search','2435968mwBlGa','forEach','length','isFlosumVariables'];a60_0x2a51=function(){return _0x4a9169;};return a60_0x2a51();}var __importDefault=this&&this[a60_0x2377cb(0xde)]||function(_0x11019a){const _0xba2d94=a60_0x2377cb;return _0x11019a&&_0x11019a[_0xba2d94(0xe7)]?_0x11019a:{'default':_0x11019a};};Object[a60_0x2377cb(0xcd)](exports,a60_0x2377cb(0xe7),{'value':!![]});const salesforce_1=require('@flosum/salesforce'),salesforce_2=require(a60_0x2377cb(0xbd)),utils_1=require(a60_0x2377cb(0xe9)),adm_zip_1=__importDefault(require('adm-zip')),B2C_CARTRIDGE_TYPE=a60_0x2377cb(0xc9),BINARY_FIELDS=[a60_0x2377cb(0xce)],EXCLUDED_TYPES=[a60_0x2377cb(0xc2),'svg','eot',a60_0x2377cb(0xac),'jpeg',a60_0x2377cb(0xaf),a60_0x2377cb(0xe8),'woff2','ttf',a60_0x2377cb(0xb1),a60_0x2377cb(0xf3),'rar',a60_0x2377cb(0xbf),a60_0x2377cb(0xb8)];class RetrieveCartridges{constructor(_0xb490b0,_0x340cd5,_0x240e9c,_0x4b7e68,_0x46f7df,_0x43b196,_0x1e9527){const _0x2fd527=a60_0x2377cb;this[_0x2fd527(0xc3)]=_0xb490b0,this['axiosInstance']=_0x340cd5,this[_0x2fd527(0xb9)]=_0x240e9c,this[_0x2fd527(0xc5)]=_0x4b7e68,this[_0x2fd527(0xeb)]=_0x46f7df,this['variables']=_0x43b196,this[_0x2fd527(0xb4)]=_0x1e9527,this[_0x2fd527(0xaa)]=![],this['isFlosumVariables']=Object['keys'](this['variables'])[_0x2fd527(0xf7)]>0x0;}async[a60_0x2377cb(0xee)](_0x172397){const _0x12b8b3=a60_0x2377cb,_0x1fe9f3=new salesforce_2[(_0x12b8b3(0xd9))]()[_0x12b8b3(0xd8)](_0x12b8b3(0xce),'Name',_0x12b8b3(0xdd))[_0x12b8b3(0xf2)](_0x12b8b3(0xc4))['where'](_0x12b8b3(0xef),{'componentHistoryIds':_0x172397}),_0x6ce41c=new salesforce_1[(_0x12b8b3(0xcc))]({'instance':this[_0x12b8b3(0xb3)],'api':this[_0x12b8b3(0xb9)],'pollInterval':0x1388,'queryBuilder':_0x1fe9f3,'objectName':_0x12b8b3(0xc4),'contentType':salesforce_1['BulkV1QueryContentType'][_0x12b8b3(0xc8)],'jobOperation':salesforce_1[_0x12b8b3(0xdc)][_0x12b8b3(0xc0)]});let _0x2a36e7=0x0;do{const _0x35ad4d=await _0x6ce41c[_0x12b8b3(0xd4)]();if(!_0x35ad4d)break;const _0x52762a=new salesforce_2[(_0x12b8b3(0xdb))]({'binaryFields':BINARY_FIELDS});for await(const _0x38e98b of _0x35ad4d[_0x12b8b3(0xed)](_0x52762a)){_0x2a36e7++;const _0x352fd0=new adm_zip_1[(_0x12b8b3(0xf1))](_0x38e98b[_0x12b8b3(0xce)]);this[_0x12b8b3(0xaa)]&&await this['applyFlosumVariables'](_0x352fd0),await(0x0,utils_1[_0x12b8b3(0xf0)])(_0x352fd0,this[_0x12b8b3(0xc3)]);}}while(!_0x6ce41c[_0x12b8b3(0xe1)]());return _0x2a36e7;}async[a60_0x2377cb(0xb0)](_0x23536c){const _0x2d1597=a60_0x2377cb,_0x4c897a=_0x23536c['getEntries']();_0x4c897a[_0x2d1597(0xf6)](_0x316c20=>{const _0x27422e=_0x2d1597,_0x578819=_0x316c20[_0x27422e(0xb6)],_0x2a3885=_0x578819[_0x27422e(0xc1)](_0x578819[_0x27422e(0xd2)]('.')+0x1);if(!EXCLUDED_TYPES[_0x27422e(0xea)](_0x2a3885)){let _0x47367a=_0x316c20[_0x27422e(0xd3)]()['toString']('utf8'),_0xc9d0f8=![];for(const _0x5c455c in this[_0x27422e(0xd1)]){const _0x4838af='%%'+_0x5c455c+'%%';if(_0x47367a[_0x27422e(0xc6)](_0x4838af)!==-0x1){const _0x33b8a7=new RegExp(_0x4838af,'ig');_0x47367a=_0x47367a['replace'](_0x33b8a7,this[_0x27422e(0xd1)][_0x5c455c]),_0xc9d0f8=!![];}}_0xc9d0f8&&_0x23536c['updateFile'](_0x316c20,Buffer[_0x27422e(0xf2)](_0x47367a,_0x27422e(0xdf)));}});}async[a60_0x2377cb(0xca)](){const _0x48f4e9=a60_0x2377cb,_0x3270b0=[],_0xd8c5bc=new salesforce_2[(_0x48f4e9(0xd9))]()[_0x48f4e9(0xd8)]('Id')[_0x48f4e9(0xf2)](this[_0x48f4e9(0xc5)]+_0x48f4e9(0xe5))[_0x48f4e9(0xd0)](this[_0x48f4e9(0xc5)]+_0x48f4e9(0xba),{'branchId':this['branchId']})['andWhere'](this[_0x48f4e9(0xc5)]+_0x48f4e9(0xb5),{'type':B2C_CARTRIDGE_TYPE})[_0x48f4e9(0xd5)](),_0x55d727=new salesforce_2[(_0x48f4e9(0xd9))]()[_0x48f4e9(0xd8)]('Id')[_0x48f4e9(0xf2)](this[_0x48f4e9(0xc5)]+'Component_History__c')[_0x48f4e9(0xd0)](this['namespace']+'Component__c\x20IN\x20('+_0xd8c5bc+')')[_0x48f4e9(0xbe)](this[_0x48f4e9(0xc5)]+_0x48f4e9(0xbc),{'isLastVersion':!![]}),_0x3ed728=new salesforce_2[(_0x48f4e9(0xd7))]({'api':this['apiVersion'],'queryBuilder':_0x55d727,'instance':this[_0x48f4e9(0xb3)],'isTooling':![]});do{const _0x372b75=await _0x3ed728['execute']()['then'](({records:_0xfc9a51})=>_0xfc9a51['map'](_0x3395aa=>_0x3395aa['Id']));_0x372b75[_0x48f4e9(0xf7)]&&_0x3270b0['push'](_0x372b75);}while(!_0x3ed728[_0x48f4e9(0xe1)]());return _0x3270b0;}async[a60_0x2377cb(0xd4)](){const _0xcd8cf9=a60_0x2377cb,_0x46dd49=await this['getComponentHistoryIds']();let _0x3f2c7e=0x0;for(const _0x9b8a3c of _0x46dd49){_0x3f2c7e+=await this[_0xcd8cf9(0xee)](_0x9b8a3c);}await this['logger'][_0xcd8cf9(0xe2)](_0xcd8cf9(0xec)+_0x3f2c7e+_0xcd8cf9(0xae));}}exports[a60_0x2377cb(0xf1)]=RetrieveCartridges;