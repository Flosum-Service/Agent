const a70_0x5d3e0c=a70_0x2fcc;(function(_0x26d336,_0x1b123b){const _0x4869f4=a70_0x2fcc,_0x772f6d=_0x26d336();while(!![]){try{const _0x369bb4=parseInt(_0x4869f4(0xa6))/0x1+parseInt(_0x4869f4(0x9c))/0x2*(parseInt(_0x4869f4(0x84))/0x3)+parseInt(_0x4869f4(0xa1))/0x4+parseInt(_0x4869f4(0x81))/0x5*(parseInt(_0x4869f4(0x7f))/0x6)+-parseInt(_0x4869f4(0x98))/0x7+-parseInt(_0x4869f4(0x93))/0x8+parseInt(_0x4869f4(0x94))/0x9*(-parseInt(_0x4869f4(0x7a))/0xa);if(_0x369bb4===_0x1b123b)break;else _0x772f6d['push'](_0x772f6d['shift']());}catch(_0x49c2a9){_0x772f6d['push'](_0x772f6d['shift']());}}}(a70_0x4501,0x94596));const a70_0x2ef596=(function(){let _0x3b07db=!![];return function(_0x36229,_0x37978c){const _0x62f402=_0x3b07db?function(){if(_0x37978c){const _0x95fc4d=_0x37978c['apply'](_0x36229,arguments);return _0x37978c=null,_0x95fc4d;}}:function(){};return _0x3b07db=![],_0x62f402;};}()),a70_0x347262=a70_0x2ef596(this,function(){const _0x339cfa=a70_0x2fcc;return a70_0x347262[_0x339cfa(0x9e)]()[_0x339cfa(0x8f)](_0x339cfa(0x80))['toString']()['constructor'](a70_0x347262)[_0x339cfa(0x8f)](_0x339cfa(0x80));});a70_0x347262();'use strict';function a70_0x4501(){const _0x127786=['join','parse','getJobs','generateJobId','getJobStatus','catch','readFile','dataPath','search','create','b2cFolder','isExistsPath','6951904pMgazD','750069UiTivb','../../../configs/path','getJobLog','init','6143221WudKhc','__esModule','setError','getJobState','120066KQXicT','sortJobsIds','toString','then','../../shared/utils/csv.utils','3006276yYldVi','FsUtils','finally','fs/promises','createJob','1036833cLGtjk','B2C_FOLDER_NAME','getJobsIds','NotFoundError','defineProperty','path','__importDefault','130zbJznk','slice','default','Job\x20log\x20not\x20found.','@flosum/utils','4492590sUwNTy','(((.+)+)+)+$','5RtNfRD','makeDir','utf-8','45WSyMZC','../../shared/managers/state-manger','push'];a70_0x4501=function(){return _0x127786;};return a70_0x4501();}var __importDefault=this&&this[a70_0x5d3e0c(0x79)]||function(_0x40fcf1){const _0x486f79=a70_0x5d3e0c;return _0x40fcf1&&_0x40fcf1[_0x486f79(0x99)]?_0x40fcf1:{'default':_0x40fcf1};};Object[a70_0x5d3e0c(0xaa)](exports,a70_0x5d3e0c(0x99),{'value':!![]});const promises_1=require(a70_0x5d3e0c(0xa4)),utils_1=require(a70_0x5d3e0c(0x7e)),not_found_error_1=require('../../../core/errors/not-found.error'),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require('../constants'),path_1=require(a70_0x5d3e0c(0x95)),job_1=require('../../../constants/job'),path_2=__importDefault(require(a70_0x5d3e0c(0xab))),manifest_manager_1=__importDefault(require('../job/classes/manifest-manager')),state_manger_1=__importDefault(require(a70_0x5d3e0c(0x85))),job_utils_1=__importDefault(require('../../shared/utils/job.utils')),csv_utils_1=__importDefault(require(a70_0x5d3e0c(0xa0)));function a70_0x2fcc(_0x833a7d,_0x54a10c){const _0x2602b8=a70_0x4501();return a70_0x2fcc=function(_0x347262,_0x2ef596){_0x347262=_0x347262-0x79;let _0x45015f=_0x2602b8[_0x347262];return _0x45015f;},a70_0x2fcc(_0x833a7d,_0x54a10c);}class B2CService{static async[a70_0x5d3e0c(0xa5)](_0x126cf4){const _0x27d7a0=a70_0x5d3e0c,_0x49f79c=job_utils_1[_0x27d7a0(0x7c)][_0x27d7a0(0x8a)](),_0x3b1ca2=path_2['default'][_0x27d7a0(0x87)](B2CService[_0x27d7a0(0x91)],_0x49f79c);await(0x0,fs_utils_1[_0x27d7a0(0x82)])(_0x3b1ca2),await manifest_manager_1[_0x27d7a0(0x7c)][_0x27d7a0(0x90)](_0x3b1ca2,_0x126cf4),await state_manger_1[_0x27d7a0(0x7c)][_0x27d7a0(0x90)](_0x3b1ca2,_0x49f79c);const _0x477cd7=path_2['default'][_0x27d7a0(0x87)](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x27d7a0(0x7c)]['runJob'](_0x477cd7,{'jobStorePath':_0x3b1ca2,'jobId':_0x49f79c})[_0x27d7a0(0x8c)](async _0x1dddd4=>{const _0x18b83e=_0x27d7a0,_0x58c735=new state_manger_1[(_0x18b83e(0x7c))](_0x3b1ca2);await _0x58c735[_0x18b83e(0x97)](),await _0x58c735[_0x18b83e(0x9a)](_0x1dddd4);})[_0x27d7a0(0xa3)](async()=>{const _0x3d09a5=_0x27d7a0,_0x10f1e4=path_2[_0x3d09a5(0x7c)]['join'](_0x3b1ca2,'cartridges');await(0x0,promises_1['rm'])(_0x10f1e4,{'recursive':!![],'force':!![]});}),{'jobId':_0x49f79c};}static async[a70_0x5d3e0c(0x89)](_0x3cca00,_0x30348e){const _0x3c521d=a70_0x5d3e0c,_0x513f23=await job_utils_1[_0x3c521d(0x7c)][_0x3c521d(0xa8)](B2CService[_0x3c521d(0x91)]),_0x389018=await job_utils_1[_0x3c521d(0x7c)][_0x3c521d(0x9d)](B2CService['b2cFolder'],_0x513f23),_0x1173d4=_0x389018[_0x3c521d(0x7b)](_0x30348e,_0x30348e+_0x3cca00),_0x2fe43e=[];for(const _0x14cd78 of _0x1173d4){const _0xf99231=await state_manger_1[_0x3c521d(0x7c)]['getJobState'](path_2['default'][_0x3c521d(0x87)](B2CService[_0x3c521d(0x91)],_0x14cd78));_0x2fe43e[_0x3c521d(0x86)](_0xf99231);}return _0x2fe43e;}static async[a70_0x5d3e0c(0x8b)](_0x1a48b0){const _0x1c9fd4=a70_0x5d3e0c;try{return state_manger_1[_0x1c9fd4(0x7c)][_0x1c9fd4(0x9b)](path_2[_0x1c9fd4(0x7c)][_0x1c9fd4(0x87)](B2CService[_0x1c9fd4(0x91)],_0x1a48b0));}catch(_0x480675){throw new not_found_error_1[(_0x1c9fd4(0xa9))](_0x480675);}}static async[a70_0x5d3e0c(0x96)](_0x18cd11){const _0x8068d3=a70_0x5d3e0c,_0x1bb733=path_2[_0x8068d3(0x7c)]['join'](B2CService[_0x8068d3(0x91)],_0x18cd11,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1[_0x8068d3(0xa2)][_0x8068d3(0x92)](_0x1bb733))return(0x0,promises_1[_0x8068d3(0x8d)])(_0x1bb733,{'encoding':_0x8068d3(0x83)})[_0x8068d3(0x9f)](_0xdd28c5=>csv_utils_1[_0x8068d3(0x7c)][_0x8068d3(0x88)](_0xdd28c5,{'columns':!![]}));throw new not_found_error_1[(_0x8068d3(0xa9))](_0x8068d3(0x7d));}}exports['default']=B2CService,B2CService['b2cFolder']=path_2[a70_0x5d3e0c(0x7c)][a70_0x5d3e0c(0x87)](path_1[a70_0x5d3e0c(0x8e)],constants_1[a70_0x5d3e0c(0xa7)]);