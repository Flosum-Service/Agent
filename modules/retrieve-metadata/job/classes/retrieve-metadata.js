const a315_0x3a059b=a315_0x42ab;(function(_0x42fcec,_0x1863e9){const _0x283f34=a315_0x42ab,_0x3a059a=_0x42fcec();while(!![]){try{const _0x566c04=-parseInt(_0x283f34(0xd9))/0x1+parseInt(_0x283f34(0xcc))/0x2+-parseInt(_0x283f34(0xe3))/0x3+parseInt(_0x283f34(0xd3))/0x4+parseInt(_0x283f34(0xef))/0x5*(parseInt(_0x283f34(0xec))/0x6)+-parseInt(_0x283f34(0xd8))/0x7*(parseInt(_0x283f34(0xee))/0x8)+-parseInt(_0x283f34(0xe0))/0x9;if(_0x566c04===_0x1863e9)break;else _0x3a059a['push'](_0x3a059a['shift']());}catch(_0x16e12b){_0x3a059a['push'](_0x3a059a['shift']());}}}(a315_0x22a9,0xadb53));const a315_0xa46fcd=(function(){let _0x20fe7a=!![];return function(_0x2e6495,_0x5c79eb){const _0x2f8f21=_0x20fe7a?function(){if(_0x5c79eb){const _0x463e54=_0x5c79eb['apply'](_0x2e6495,arguments);return _0x5c79eb=null,_0x463e54;}}:function(){};return _0x20fe7a=![],_0x2f8f21;};}()),a315_0x2b813e=a315_0xa46fcd(this,function(){const _0x55907c=a315_0x42ab;return a315_0x2b813e['toString']()[_0x55907c(0xc4)](_0x55907c(0xdc))['toString']()[_0x55907c(0xed)](a315_0x2b813e)[_0x55907c(0xc4)](_0x55907c(0xdc));});a315_0x2b813e();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2a756b){const _0xe1a792=a315_0x42ab;return _0x2a756b&&_0x2a756b[_0xe1a792(0xce)]?_0x2a756b:{'default':_0x2a756b};};Object[a315_0x3a059b(0xe6)](exports,a315_0x3a059b(0xce),{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require('./manifest-manger')),path_1=__importDefault(require(a315_0x3a059b(0xcd))),promises_1=require(a315_0x3a059b(0xd6)),fs_utils_1=require(a315_0x3a059b(0xca)),object_sizeof_1=__importDefault(require('object-sizeof')),retrieve_factory_1=__importDefault(require(a315_0x3a059b(0xc7))),auth_manager_1=require(a315_0x3a059b(0xd5)),constants_1=require('../../constants'),shortid_1=__importDefault(require('shortid')),jszip_1=__importDefault(require(a315_0x3a059b(0xcf)));class RetrieveMetadata{constructor(_0x297a43,_0x19c335,_0x2b39c1){const _0x39cb5a=a315_0x3a059b;this[_0x39cb5a(0xe5)]=_0x297a43,this[_0x39cb5a(0xc5)]=_0x19c335,this['stateManager']=_0x2b39c1,this['metadataFolder']=path_1[_0x39cb5a(0xea)][_0x39cb5a(0xc6)](this[_0x39cb5a(0xe5)],constants_1[_0x39cb5a(0xc2)]),this[_0x39cb5a(0xc8)]=path_1[_0x39cb5a(0xea)][_0x39cb5a(0xc6)](this[_0x39cb5a(0xe5)],constants_1[_0x39cb5a(0xeb)]);}async[a315_0x3a059b(0xde)](_0x161220){const _0x36fd0d=a315_0x3a059b,_0x1a4bdc=(0x0,shortid_1[_0x36fd0d(0xea)])();return await(0x0,promises_1[_0x36fd0d(0xd2)])(path_1['default'][_0x36fd0d(0xc6)](this['metadataFolder'],_0x1a4bdc+_0x36fd0d(0xe9)),JSON[_0x36fd0d(0xe4)](_0x161220)),_0x1a4bdc;}async[a315_0x3a059b(0xc9)](){const _0x5c3c87=a315_0x3a059b,{credentials:_0x528759,declarativeFilter:_0x4318f5,metadataTypes:_0x543a19,maxChunkSize:_0xc68b9f,maxChunkItems:_0x22ae06,apiVersion:_0x4912e3}=await new manifest_manger_1[(_0x5c3c87(0xea))](this[_0x5c3c87(0xe5)])[_0x5c3c87(0xda)](),_0x13fb40=await salesforce_1[_0x5c3c87(0xd1)][_0x5c3c87(0xd7)](new auth_manager_1['AuthManager'](_0x528759),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x4e9df3=await retrieve_factory_1[_0x5c3c87(0xea)][_0x5c3c87(0xd7)](_0x13fb40,this['logger'],_0x4318f5,_0x543a19,_0x4912e3)[_0x5c3c87(0xc9)]();await(0x0,fs_utils_1['makeDir'])(this[_0x5c3c87(0xd4)]);let _0x5ab9f1=[];const _0x12deb6=[];let _0x37c9b2=0x0;for(const _0x279d47 in _0x4e9df3[_0x5c3c87(0xe1)]){for(const {listMetadataItem:_0x2262aa,files:_0xe7b806}of _0x4e9df3[_0x5c3c87(0xe1)][_0x279d47][_0x5c3c87(0xdd)]){const _0x2820b3=new jszip_1[(_0x5c3c87(0xea))]();for(const _0x2a4209 in _0xe7b806){await _0x2820b3[_0x5c3c87(0xe2)](_0x2a4209,_0xe7b806[_0x2a4209]);}const _0x28e32f=await _0x2820b3[_0x5c3c87(0xdf)]({'type':_0x5c3c87(0xd0),'compression':_0x5c3c87(0xcb),'compressionOptions':{'level':0x9}}),_0x148963={..._0x2262aa,'zip':_0x28e32f},_0x5aa6ad=(0x0,object_sizeof_1[_0x5c3c87(0xea)])(_0x148963);if(_0x5aa6ad>_0xc68b9f){await this[_0x5c3c87(0xdb)]['addWarning']('Item\x20\x27'+_0x2262aa[_0x5c3c87(0xc3)]+'\x27\x20size\x20\x27'+_0x5aa6ad+_0x5c3c87(0xe8)+_0xc68b9f+'\x27');continue;}if(_0x37c9b2+_0x5aa6ad>_0xc68b9f||_0x5ab9f1['length']>=_0x22ae06){const _0x402177=await this[_0x5c3c87(0xde)](_0x5ab9f1);_0x12deb6['push'](_0x402177),_0x37c9b2=0x0,_0x5ab9f1=[];}_0x5ab9f1['push'](_0x148963),_0x37c9b2+=_0x5aa6ad;}}if(_0x5ab9f1['length']){const _0x580fef=await this[_0x5c3c87(0xde)](_0x5ab9f1);_0x12deb6[_0x5c3c87(0xe7)](_0x580fef);}await(0x0,promises_1[_0x5c3c87(0xd2)])(this[_0x5c3c87(0xc8)],JSON[_0x5c3c87(0xe4)](_0x12deb6));}}function a315_0x42ab(_0xc618f4,_0x201b5a){const _0x246348=a315_0x22a9();return a315_0x42ab=function(_0x2b813e,_0xa46fcd){_0x2b813e=_0x2b813e-0xc2;let _0x22a9b1=_0x246348[_0x2b813e];return _0x22a9b1;},a315_0x42ab(_0xc618f4,_0x201b5a);}exports[a315_0x3a059b(0xea)]=RetrieveMetadata;function a315_0x22a9(){const _0x147d94=['push','\x27\x20exceed\x20limit\x20\x27','.json','default','RETRIEVE_RESULTS_IDS_FILENAME','6wYnpMk','constructor','68888BkYHsY','1288505QtqKPf','RETRIEVE_RESULT_FOLDER_NAME','fileName','search','logger','join','./retrieve-factory','retrieveResultsPath','execute','../../../shared/utils/fs.utils','DEFLATE','2698958vIeGEb','path','__esModule','jszip','base64','AxiosInstanceUtils','writeFile','5603024oflvjC','metadataFolder','../../../shared/managers/auth.manager','fs/promises','create','371qAhjps','871305MwxdeG','init','stateManager','(((.+)+)+)+$','components','writeChunk','generateAsync','8541306WuEgxA','items','file','59121LIlUqd','stringify','jobStorePath','defineProperty'];a315_0x22a9=function(){return _0x147d94;};return a315_0x22a9();}