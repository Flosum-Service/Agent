const a316_0x13b31a=a316_0xd57f;(function(_0x5240da,_0x141136){const _0x6a3c2c=a316_0xd57f,_0x538e41=_0x5240da();while(!![]){try{const _0x4abf06=parseInt(_0x6a3c2c(0x1f9))/0x1*(-parseInt(_0x6a3c2c(0x207))/0x2)+parseInt(_0x6a3c2c(0x1ea))/0x3*(parseInt(_0x6a3c2c(0x203))/0x4)+parseInt(_0x6a3c2c(0x20e))/0x5*(parseInt(_0x6a3c2c(0x200))/0x6)+parseInt(_0x6a3c2c(0x1e2))/0x7*(-parseInt(_0x6a3c2c(0x1e3))/0x8)+-parseInt(_0x6a3c2c(0x1fc))/0x9*(parseInt(_0x6a3c2c(0x1ef))/0xa)+parseInt(_0x6a3c2c(0x20d))/0xb*(parseInt(_0x6a3c2c(0x1eb))/0xc)+parseInt(_0x6a3c2c(0x1df))/0xd*(parseInt(_0x6a3c2c(0x1e8))/0xe);if(_0x4abf06===_0x141136)break;else _0x538e41['push'](_0x538e41['shift']());}catch(_0x8c1756){_0x538e41['push'](_0x538e41['shift']());}}}(a316_0x5b48,0x48abc));const a316_0x567d2f=(function(){let _0x1544f1=!![];return function(_0x4ec50f,_0x358de8){const _0x19d5f2=_0x1544f1?function(){const _0x2cbdee=a316_0xd57f;if(_0x358de8){const _0x429c13=_0x358de8[_0x2cbdee(0x1e6)](_0x4ec50f,arguments);return _0x358de8=null,_0x429c13;}}:function(){};return _0x1544f1=![],_0x19d5f2;};}()),a316_0xe75f46=a316_0x567d2f(this,function(){const _0xd0605a=a316_0xd57f;return a316_0xe75f46['toString']()[_0xd0605a(0x20a)](_0xd0605a(0x1e1))['toString']()[_0xd0605a(0x1f2)](a316_0xe75f46)[_0xd0605a(0x20a)](_0xd0605a(0x1e1));});a316_0xe75f46();function a316_0x5b48(){const _0x4f4c5e=['1360ODVuxe','execute','logger','constructor','../../constants','../../../shared/utils/fs.utils','../../../shared/managers/auth.manager','fs/promises','components','makeDir','86feKYpD','RETRIEVE_RESULT_FOLDER_NAME','.json','13239gZcSog','metadataFolder','object-sizeof','base64','684pFDOzG','DEFLATE','items','8WwxWtF','__esModule','jobStorePath','addWarning','12248cWuRSY','length','RETRIEVE_RESULTS_IDS_FILENAME','search','fileName','join','33BVZxdG','11275iRIGYq','retrieveResultsPath','\x27\x20size\x20\x27','stringify','./manifest-manger','file','\x27\x20exceed\x20limit\x20\x27','481eozoRS','Item\x20\x27','(((.+)+)+)+$','29953JEPlVf','496JCFnba','push','writeFile','apply','writeChunk','134582VOcmXe','stateManager','566655gojrAC','1196628ULilhh','shortid','default','AuthManager'];a316_0x5b48=function(){return _0x4f4c5e;};return a316_0x5b48();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5b05c5){const _0x2c2704=a316_0xd57f;return _0x5b05c5&&_0x5b05c5[_0x2c2704(0x204)]?_0x5b05c5:{'default':_0x5b05c5};};function a316_0xd57f(_0x309e9e,_0x5ca40f){const _0x478a1c=a316_0x5b48();return a316_0xd57f=function(_0xe75f46,_0x567d2f){_0xe75f46=_0xe75f46-0x1da;let _0x5b48f4=_0x478a1c[_0xe75f46];return _0x5b48f4;},a316_0xd57f(_0x309e9e,_0x5ca40f);}Object['defineProperty'](exports,'__esModule',{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a316_0x13b31a(0x1dc))),path_1=__importDefault(require('path')),promises_1=require(a316_0x13b31a(0x1f6)),fs_utils_1=require(a316_0x13b31a(0x1f4)),object_sizeof_1=__importDefault(require(a316_0x13b31a(0x1fe))),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a316_0x13b31a(0x1f5)),constants_1=require(a316_0x13b31a(0x1f3)),shortid_1=__importDefault(require(a316_0x13b31a(0x1ec))),jszip_1=__importDefault(require('jszip'));class RetrieveMetadata{constructor(_0x45108f,_0x4b4304,_0x563c45){const _0x4f19c6=a316_0x13b31a;this[_0x4f19c6(0x205)]=_0x45108f,this[_0x4f19c6(0x1f1)]=_0x4b4304,this[_0x4f19c6(0x1e9)]=_0x563c45,this[_0x4f19c6(0x1fd)]=path_1[_0x4f19c6(0x1ed)]['join'](this[_0x4f19c6(0x205)],constants_1[_0x4f19c6(0x1fa)]),this['retrieveResultsPath']=path_1[_0x4f19c6(0x1ed)][_0x4f19c6(0x20c)](this['jobStorePath'],constants_1[_0x4f19c6(0x209)]);}async[a316_0x13b31a(0x1e7)](_0x37f80d){const _0x7865f4=a316_0x13b31a,_0x535b0c=(0x0,shortid_1[_0x7865f4(0x1ed)])();return await(0x0,promises_1['writeFile'])(path_1[_0x7865f4(0x1ed)][_0x7865f4(0x20c)](this[_0x7865f4(0x1fd)],_0x535b0c+_0x7865f4(0x1fb)),JSON[_0x7865f4(0x1db)](_0x37f80d)),_0x535b0c;}async[a316_0x13b31a(0x1f0)](){const _0x4d0dfd=a316_0x13b31a,{credentials:_0x266b25,declarativeFilter:_0x16ff10,metadataTypes:_0xcdcdcf,maxChunkSize:_0x463e34,maxChunkItems:_0x44d84f,apiVersion:_0x1456ee}=await new manifest_manger_1[(_0x4d0dfd(0x1ed))](this[_0x4d0dfd(0x205)])['init'](),_0x1c6240=await salesforce_1['AxiosInstanceUtils']['create'](new auth_manager_1[(_0x4d0dfd(0x1ee))](_0x266b25),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x196c66=await retrieve_factory_1[_0x4d0dfd(0x1ed)]['create'](_0x1c6240,this['logger'],_0x16ff10,_0xcdcdcf,_0x1456ee)['execute']();await(0x0,fs_utils_1[_0x4d0dfd(0x1f8)])(this[_0x4d0dfd(0x1fd)]);let _0x4ef237=[];const _0x205441=[];let _0x30f836=0x0;for(const _0x61e21a in _0x196c66['items']){for(const {listMetadataItem:_0x49eab4,files:_0x32e3ce}of _0x196c66[_0x4d0dfd(0x202)][_0x61e21a][_0x4d0dfd(0x1f7)]){const _0x2c6423=new jszip_1[(_0x4d0dfd(0x1ed))]();for(const _0x5dd208 in _0x32e3ce){await _0x2c6423[_0x4d0dfd(0x1dd)](_0x5dd208,_0x32e3ce[_0x5dd208]);}const _0x4e3a3f=await _0x2c6423['generateAsync']({'type':_0x4d0dfd(0x1ff),'compression':_0x4d0dfd(0x201),'compressionOptions':{'level':0x9}}),_0x4522cf={..._0x49eab4,'zip':_0x4e3a3f},_0x3354a5=(0x0,object_sizeof_1[_0x4d0dfd(0x1ed)])(_0x4522cf);if(_0x3354a5>_0x463e34){await this[_0x4d0dfd(0x1e9)][_0x4d0dfd(0x206)](_0x4d0dfd(0x1e0)+_0x49eab4[_0x4d0dfd(0x20b)]+_0x4d0dfd(0x1da)+_0x3354a5+_0x4d0dfd(0x1de)+_0x463e34+'\x27');continue;}if(_0x30f836+_0x3354a5>_0x463e34||_0x4ef237[_0x4d0dfd(0x208)]>=_0x44d84f){const _0x33c446=await this['writeChunk'](_0x4ef237);_0x205441[_0x4d0dfd(0x1e4)](_0x33c446),_0x30f836=0x0,_0x4ef237=[];}_0x4ef237[_0x4d0dfd(0x1e4)](_0x4522cf),_0x30f836+=_0x3354a5;}}if(_0x4ef237['length']){const _0x3dd769=await this[_0x4d0dfd(0x1e7)](_0x4ef237);_0x205441[_0x4d0dfd(0x1e4)](_0x3dd769);}await(0x0,promises_1[_0x4d0dfd(0x1e5)])(this[_0x4d0dfd(0x20f)],JSON['stringify'](_0x205441));}}exports[a316_0x13b31a(0x1ed)]=RetrieveMetadata;