const a267_0x5489ca=a267_0x4033;(function(_0x231d6c,_0xdbc2e5){const _0x53c27b=a267_0x4033,_0x5aae72=_0x231d6c();while(!![]){try{const _0x4426ee=parseInt(_0x53c27b(0xcd))/0x1+-parseInt(_0x53c27b(0xba))/0x2+parseInt(_0x53c27b(0xc0))/0x3+-parseInt(_0x53c27b(0xd7))/0x4*(parseInt(_0x53c27b(0xca))/0x5)+-parseInt(_0x53c27b(0xbf))/0x6*(parseInt(_0x53c27b(0xb5))/0x7)+-parseInt(_0x53c27b(0xce))/0x8*(-parseInt(_0x53c27b(0xe2))/0x9)+parseInt(_0x53c27b(0xe8))/0xa*(parseInt(_0x53c27b(0xdd))/0xb);if(_0x4426ee===_0xdbc2e5)break;else _0x5aae72['push'](_0x5aae72['shift']());}catch(_0x5f26c2){_0x5aae72['push'](_0x5aae72['shift']());}}}(a267_0x2f2e,0x372f0));function a267_0x2f2e(){const _0x234822=['../../../shared/managers/auth.manager','constructor','4020DomgOo','113460qFgcUG','apply','create','__esModule','defineProperty','AxiosInstanceUtils','writeChunk','default','toString','RETRIEVE_RESULTS_IDS_FILENAME','183385WhSufw','makeDir','__importDefault','281495OlaNcw','24mHGMcV','push','stateManager','join','Item\x20\x27','@flosum/salesforce','shortid','jobStorePath','length','40aXTwfB','retrieveResultsPath','metadataFolder','RETRIEVE_RESULT_FOLDER_NAME','./retrieve-factory','search','44BHCXJG','jszip','.json','execute','fileName','1121193fboPgK','../../constants','base64','fs/promises','writeFile','DEFLATE','788170mJRkSH','object-sizeof','stringify','(((.+)+)+)+$','addWarning','434jpRqEN','logger','./manifest-manger','\x27\x20exceed\x20limit\x20\x27','../../../shared/utils/fs.utils','747944BXvrUo','init','path'];a267_0x2f2e=function(){return _0x234822;};return a267_0x2f2e();}const a267_0x819ec7=(function(){let _0x57f161=!![];return function(_0x27b30f,_0x39874d){const _0xf38265=_0x57f161?function(){const _0x35aa69=a267_0x4033;if(_0x39874d){const _0xeb125e=_0x39874d[_0x35aa69(0xc1)](_0x27b30f,arguments);return _0x39874d=null,_0xeb125e;}}:function(){};return _0x57f161=![],_0xf38265;};}()),a267_0x358a92=a267_0x819ec7(this,function(){const _0x554205=a267_0x4033;return a267_0x358a92[_0x554205(0xc8)]()[_0x554205(0xdc)](_0x554205(0xb3))[_0x554205(0xc8)]()[_0x554205(0xbe)](a267_0x358a92)['search']('(((.+)+)+)+$');});a267_0x358a92();'use strict';var __importDefault=this&&this[a267_0x5489ca(0xcc)]||function(_0x383dae){const _0x16ad23=a267_0x5489ca;return _0x383dae&&_0x383dae[_0x16ad23(0xc3)]?_0x383dae:{'default':_0x383dae};};function a267_0x4033(_0x5baf8b,_0x909c82){const _0x4699e5=a267_0x2f2e();return a267_0x4033=function(_0x358a92,_0x819ec7){_0x358a92=_0x358a92-0xb2;let _0x2f2e97=_0x4699e5[_0x358a92];return _0x2f2e97;},a267_0x4033(_0x5baf8b,_0x909c82);}Object[a267_0x5489ca(0xc4)](exports,a267_0x5489ca(0xc3),{'value':!![]});const salesforce_1=require(a267_0x5489ca(0xd3)),manifest_manger_1=__importDefault(require(a267_0x5489ca(0xb7))),path_1=__importDefault(require(a267_0x5489ca(0xbc))),promises_1=require(a267_0x5489ca(0xe5)),fs_utils_1=require(a267_0x5489ca(0xb9)),object_sizeof_1=__importDefault(require(a267_0x5489ca(0xe9))),retrieve_factory_1=__importDefault(require(a267_0x5489ca(0xdb))),auth_manager_1=require(a267_0x5489ca(0xbd)),constants_1=require(a267_0x5489ca(0xe3)),shortid_1=__importDefault(require(a267_0x5489ca(0xd4))),jszip_1=__importDefault(require(a267_0x5489ca(0xde)));class RetrieveMetadata{constructor(_0xb8f92f,_0xcab987,_0x436c8c){const _0x474046=a267_0x5489ca;this[_0x474046(0xd5)]=_0xb8f92f,this[_0x474046(0xb6)]=_0xcab987,this[_0x474046(0xd0)]=_0x436c8c,this[_0x474046(0xd9)]=path_1['default']['join'](this[_0x474046(0xd5)],constants_1[_0x474046(0xda)]),this[_0x474046(0xd8)]=path_1['default'][_0x474046(0xd1)](this[_0x474046(0xd5)],constants_1[_0x474046(0xc9)]);}async[a267_0x5489ca(0xc6)](_0x3017f6){const _0x5dfdff=a267_0x5489ca,_0x22fad5=(0x0,shortid_1[_0x5dfdff(0xc7)])();return await(0x0,promises_1[_0x5dfdff(0xe6)])(path_1[_0x5dfdff(0xc7)][_0x5dfdff(0xd1)](this[_0x5dfdff(0xd9)],_0x22fad5+_0x5dfdff(0xdf)),JSON[_0x5dfdff(0xb2)](_0x3017f6)),_0x22fad5;}async[a267_0x5489ca(0xe0)](){const _0x536bec=a267_0x5489ca,{credentials:_0xbe0937,declarativeFilter:_0x49ac91,metadataTypes:_0xd4b586,maxChunkSize:_0x337a26,maxChunkItems:_0x347daa,apiVersion:_0x3f4df0}=await new manifest_manger_1[(_0x536bec(0xc7))](this[_0x536bec(0xd5)])[_0x536bec(0xbb)](),_0x11a1f4=await salesforce_1[_0x536bec(0xc5)][_0x536bec(0xc2)](new auth_manager_1['AuthManager'](_0xbe0937),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x25e338=await retrieve_factory_1['default']['create'](_0x11a1f4,this[_0x536bec(0xb6)],_0x49ac91,_0xd4b586,_0x3f4df0)['execute']();await(0x0,fs_utils_1[_0x536bec(0xcb)])(this['metadataFolder']);let _0x560404=[];const _0x276d7e=[];let _0x2a5e69=0x0;for(const _0x4644f4 in _0x25e338['items']){for(const {listMetadataItem:_0x3080ad,files:_0x47c200}of _0x25e338['items'][_0x4644f4]['components']){const _0xd62f64=new jszip_1[(_0x536bec(0xc7))]();for(const _0x41dbaf in _0x47c200){await _0xd62f64['file'](_0x41dbaf,_0x47c200[_0x41dbaf]);}const _0xdce162=await _0xd62f64['generateAsync']({'type':_0x536bec(0xe4),'compression':_0x536bec(0xe7),'compressionOptions':{'level':0x9}}),_0x1d3bdf={..._0x3080ad,'zip':_0xdce162},_0x4beaf8=(0x0,object_sizeof_1[_0x536bec(0xc7)])(_0x1d3bdf);if(_0x4beaf8>_0x337a26){await this[_0x536bec(0xd0)][_0x536bec(0xb4)](_0x536bec(0xd2)+_0x3080ad[_0x536bec(0xe1)]+'\x27\x20size\x20\x27'+_0x4beaf8+_0x536bec(0xb8)+_0x337a26+'\x27');continue;}if(_0x2a5e69+_0x4beaf8>_0x337a26||_0x560404[_0x536bec(0xd6)]>=_0x347daa){const _0x59d6d6=await this[_0x536bec(0xc6)](_0x560404);_0x276d7e['push'](_0x59d6d6),_0x2a5e69=0x0,_0x560404=[];}_0x560404['push'](_0x1d3bdf),_0x2a5e69+=_0x4beaf8;}}if(_0x560404['length']){const _0x5d07ca=await this[_0x536bec(0xc6)](_0x560404);_0x276d7e[_0x536bec(0xcf)](_0x5d07ca);}await(0x0,promises_1['writeFile'])(this['retrieveResultsPath'],JSON[_0x536bec(0xb2)](_0x276d7e));}}exports[a267_0x5489ca(0xc7)]=RetrieveMetadata;