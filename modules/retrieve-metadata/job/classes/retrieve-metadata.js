const a272_0x28795a=a272_0x1ba3;(function(_0x3520fb,_0xfff06a){const _0x426061=a272_0x1ba3,_0x434b28=_0x3520fb();while(!![]){try{const _0x1b644e=-parseInt(_0x426061(0xe4))/0x1+parseInt(_0x426061(0xec))/0x2+-parseInt(_0x426061(0xdd))/0x3*(-parseInt(_0x426061(0xe6))/0x4)+parseInt(_0x426061(0xf4))/0x5*(-parseInt(_0x426061(0xea))/0x6)+parseInt(_0x426061(0xfa))/0x7+-parseInt(_0x426061(0xeb))/0x8+-parseInt(_0x426061(0x104))/0x9*(parseInt(_0x426061(0xe9))/0xa);if(_0x1b644e===_0xfff06a)break;else _0x434b28['push'](_0x434b28['shift']());}catch(_0xdf5dc3){_0x434b28['push'](_0x434b28['shift']());}}}(a272_0x5561,0x618ab));const a272_0x13f694=(function(){let _0xe8b0ac=!![];return function(_0xafde7d,_0x28f5fa){const _0x55caa4=_0xe8b0ac?function(){const _0x3f7578=a272_0x1ba3;if(_0x28f5fa){const _0x3d48e8=_0x28f5fa[_0x3f7578(0x107)](_0xafde7d,arguments);return _0x28f5fa=null,_0x3d48e8;}}:function(){};return _0xe8b0ac=![],_0x55caa4;};}()),a272_0x3319f3=a272_0x13f694(this,function(){const _0x2a188b=a272_0x1ba3;return a272_0x3319f3[_0x2a188b(0xe5)]()[_0x2a188b(0xf7)]('(((.+)+)+)+$')['toString']()[_0x2a188b(0x103)](a272_0x3319f3)[_0x2a188b(0xf7)](_0x2a188b(0xe1));});a272_0x3319f3();'use strict';var __importDefault=this&&this[a272_0x28795a(0x10f)]||function(_0x49aac0){const _0x33dfac=a272_0x28795a;return _0x49aac0&&_0x49aac0[_0x33dfac(0xf0)]?_0x49aac0:{'default':_0x49aac0};};Object[a272_0x28795a(0xf9)](exports,a272_0x28795a(0xf0),{'value':!![]});const salesforce_1=require(a272_0x28795a(0xde)),manifest_manger_1=__importDefault(require('./manifest-manger')),path_1=__importDefault(require(a272_0x28795a(0x100))),promises_1=require(a272_0x28795a(0x10e)),fs_utils_1=require(a272_0x28795a(0xdf)),object_sizeof_1=__importDefault(require(a272_0x28795a(0xed))),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a272_0x28795a(0x101)),constants_1=require(a272_0x28795a(0xef)),shortid_1=__importDefault(require(a272_0x28795a(0xe3))),jszip_1=__importDefault(require(a272_0x28795a(0x10a)));function a272_0x5561(){const _0x3bd3dd=['push','default','create','stateManager','path','../../../shared/managers/auth.manager','RETRIEVE_RESULT_FOLDER_NAME','constructor','745281jQFEDv','jobStorePath','retrieveResultsPath','apply','join','makeDir','jszip','length','components','items','fs/promises','__importDefault','execute','3687YJehYP','@flosum/salesforce','../../../shared/utils/fs.utils','AxiosInstanceUtils','(((.+)+)+)+$','metadataFolder','shortid','92196NrXcOm','toString','428JRfqVj','writeFile','\x27\x20size\x20\x27','30SMsgtW','60mygkUh','110664XDyYQr','1184104MUpSSE','object-sizeof','.json','../../constants','__esModule','stringify','\x27\x20exceed\x20limit\x20\x27','addWarning','189355sQXjGM','base64','generateAsync','search','writeChunk','defineProperty','2863994TQESLq','logger'];a272_0x5561=function(){return _0x3bd3dd;};return a272_0x5561();}function a272_0x1ba3(_0x21df26,_0x27d80f){const _0x524dc8=a272_0x5561();return a272_0x1ba3=function(_0x3319f3,_0x13f694){_0x3319f3=_0x3319f3-0xdd;let _0x5561bb=_0x524dc8[_0x3319f3];return _0x5561bb;},a272_0x1ba3(_0x21df26,_0x27d80f);}class RetrieveMetadata{constructor(_0x2be909,_0x5e5be4,_0x30ba61){const _0x5eecac=a272_0x28795a;this[_0x5eecac(0x105)]=_0x2be909,this['logger']=_0x5e5be4,this[_0x5eecac(0xff)]=_0x30ba61,this['metadataFolder']=path_1['default'][_0x5eecac(0x108)](this[_0x5eecac(0x105)],constants_1[_0x5eecac(0x102)]),this['retrieveResultsPath']=path_1['default']['join'](this[_0x5eecac(0x105)],constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);}async[a272_0x28795a(0xf8)](_0x3093b7){const _0x526d9f=a272_0x28795a,_0x10201a=(0x0,shortid_1[_0x526d9f(0xfd)])();return await(0x0,promises_1['writeFile'])(path_1[_0x526d9f(0xfd)][_0x526d9f(0x108)](this[_0x526d9f(0xe2)],_0x10201a+_0x526d9f(0xee)),JSON[_0x526d9f(0xf1)](_0x3093b7)),_0x10201a;}async['execute'](){const _0x1f67e8=a272_0x28795a,{credentials:_0x179ffd,declarativeFilter:_0x5d4ec6,metadataTypes:_0x157402,maxChunkSize:_0x19eb97,maxChunkItems:_0x11b980,apiVersion:_0x1614c8}=await new manifest_manger_1['default'](this['jobStorePath'])['init'](),_0x388246=await salesforce_1[_0x1f67e8(0xe0)][_0x1f67e8(0xfe)](new auth_manager_1['AuthManager'](_0x179ffd),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x2c5d1f=await retrieve_factory_1['default']['create'](_0x388246,this[_0x1f67e8(0xfb)],_0x5d4ec6,_0x157402,_0x1614c8)[_0x1f67e8(0x110)]();await(0x0,fs_utils_1[_0x1f67e8(0x109)])(this[_0x1f67e8(0xe2)]);let _0x15d175=[];const _0x354b95=[];let _0x529d63=0x0;for(const _0x172835 in _0x2c5d1f[_0x1f67e8(0x10d)]){for(const {listMetadataItem:_0x179f4c,files:_0x318025}of _0x2c5d1f[_0x1f67e8(0x10d)][_0x172835][_0x1f67e8(0x10c)]){const _0x4191ae=new jszip_1[(_0x1f67e8(0xfd))]();for(const _0x4c3084 in _0x318025){await _0x4191ae['file'](_0x4c3084,_0x318025[_0x4c3084]);}const _0x1b5890=await _0x4191ae[_0x1f67e8(0xf6)]({'type':_0x1f67e8(0xf5),'compression':'DEFLATE','compressionOptions':{'level':0x9}}),_0x45db97={..._0x179f4c,'zip':_0x1b5890},_0x4668b3=(0x0,object_sizeof_1['default'])(_0x45db97);if(_0x4668b3>_0x19eb97){await this[_0x1f67e8(0xff)][_0x1f67e8(0xf3)]('Item\x20\x27'+_0x179f4c['fileName']+_0x1f67e8(0xe8)+_0x4668b3+_0x1f67e8(0xf2)+_0x19eb97+'\x27');continue;}if(_0x529d63+_0x4668b3>_0x19eb97||_0x15d175[_0x1f67e8(0x10b)]>=_0x11b980){const _0x2e9193=await this[_0x1f67e8(0xf8)](_0x15d175);_0x354b95['push'](_0x2e9193),_0x529d63=0x0,_0x15d175=[];}_0x15d175[_0x1f67e8(0xfc)](_0x45db97),_0x529d63+=_0x4668b3;}}if(_0x15d175[_0x1f67e8(0x10b)]){const _0xc03e21=await this[_0x1f67e8(0xf8)](_0x15d175);_0x354b95[_0x1f67e8(0xfc)](_0xc03e21);}await(0x0,promises_1[_0x1f67e8(0xe7)])(this[_0x1f67e8(0x106)],JSON[_0x1f67e8(0xf1)](_0x354b95));}}exports['default']=RetrieveMetadata;