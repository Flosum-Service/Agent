const a272_0x2f7e1f=a272_0xef02;(function(_0x16efd4,_0xfb50cc){const _0x2a5e2d=a272_0xef02,_0x4f28d5=_0x16efd4();while(!![]){try{const _0x26b950=-parseInt(_0x2a5e2d(0xb3))/0x1+parseInt(_0x2a5e2d(0xaf))/0x2*(parseInt(_0x2a5e2d(0xc0))/0x3)+-parseInt(_0x2a5e2d(0xae))/0x4*(parseInt(_0x2a5e2d(0xb2))/0x5)+parseInt(_0x2a5e2d(0xc3))/0x6+parseInt(_0x2a5e2d(0xaa))/0x7*(parseInt(_0x2a5e2d(0xcb))/0x8)+-parseInt(_0x2a5e2d(0xc4))/0x9*(-parseInt(_0x2a5e2d(0xd1))/0xa)+-parseInt(_0x2a5e2d(0xcd))/0xb*(parseInt(_0x2a5e2d(0xa3))/0xc);if(_0x26b950===_0xfb50cc)break;else _0x4f28d5['push'](_0x4f28d5['shift']());}catch(_0x1f4ab9){_0x4f28d5['push'](_0x4f28d5['shift']());}}}(a272_0x206f,0x583f6));const a272_0x3395ae=(function(){let _0x4cb42c=!![];return function(_0x1fb732,_0x2828fa){const _0x136763=_0x4cb42c?function(){const _0x31ee2c=a272_0xef02;if(_0x2828fa){const _0x592ff4=_0x2828fa[_0x31ee2c(0xd2)](_0x1fb732,arguments);return _0x2828fa=null,_0x592ff4;}}:function(){};return _0x4cb42c=![],_0x136763;};}()),a272_0x4961a8=a272_0x3395ae(this,function(){const _0x19d379=a272_0xef02;return a272_0x4961a8['toString']()[_0x19d379(0xca)](_0x19d379(0xc9))[_0x19d379(0x9f)]()[_0x19d379(0xa7)](a272_0x4961a8)[_0x19d379(0xca)](_0x19d379(0xc9));});a272_0x4961a8();'use strict';function a272_0x206f(){const _0x2d5ac0=['items','execute','toString','object-sizeof','init','addWarning','12XeXvkN','fs/promises','default','../../constants','constructor','defineProperty','logger','434FPkfou','\x27\x20size\x20\x27','length','../../../shared/managers/auth.manager','58992KsfBmy','2LwBiiC','jobStorePath','retrieveResultsPath','160NbXlOB','2733nrOmfs','__importDefault','generateAsync','Item\x20\x27','create','AuthManager','../../../shared/utils/fs.utils','makeDir','AxiosInstanceUtils','shortid','writeFile','RETRIEVE_RESULT_FOLDER_NAME','.json','2153586NTKoAi','push','metadataFolder','2434152tNiyaK','3216609dXShie','join','base64','writeChunk','stateManager','(((.+)+)+)+$','search','48536jCIcXz','components','15162169BnumwV','\x27\x20exceed\x20limit\x20\x27','DEFLATE','__esModule','20KTvwzR','apply'];a272_0x206f=function(){return _0x2d5ac0;};return a272_0x206f();}var __importDefault=this&&this[a272_0x2f7e1f(0xb4)]||function(_0x4b6bdd){const _0x241882=a272_0x2f7e1f;return _0x4b6bdd&&_0x4b6bdd[_0x241882(0xd0)]?_0x4b6bdd:{'default':_0x4b6bdd};};function a272_0xef02(_0x1c5fda,_0x4309ce){const _0x501fc8=a272_0x206f();return a272_0xef02=function(_0x4961a8,_0x3395ae){_0x4961a8=_0x4961a8-0x9f;let _0x206f03=_0x501fc8[_0x4961a8];return _0x206f03;},a272_0xef02(_0x1c5fda,_0x4309ce);}Object[a272_0x2f7e1f(0xa8)](exports,a272_0x2f7e1f(0xd0),{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require('./manifest-manger')),path_1=__importDefault(require('path')),promises_1=require(a272_0x2f7e1f(0xa4)),fs_utils_1=require(a272_0x2f7e1f(0xb9)),object_sizeof_1=__importDefault(require(a272_0x2f7e1f(0xa0))),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a272_0x2f7e1f(0xad)),constants_1=require(a272_0x2f7e1f(0xa6)),shortid_1=__importDefault(require(a272_0x2f7e1f(0xbc))),jszip_1=__importDefault(require('jszip'));class RetrieveMetadata{constructor(_0x185f81,_0x34e50a,_0x477f07){const _0x500f7f=a272_0x2f7e1f;this[_0x500f7f(0xb0)]=_0x185f81,this['logger']=_0x34e50a,this[_0x500f7f(0xc8)]=_0x477f07,this[_0x500f7f(0xc2)]=path_1['default']['join'](this['jobStorePath'],constants_1[_0x500f7f(0xbe)]),this[_0x500f7f(0xb1)]=path_1[_0x500f7f(0xa5)][_0x500f7f(0xc5)](this['jobStorePath'],constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);}async[a272_0x2f7e1f(0xc7)](_0x51f32e){const _0xa5c4b4=a272_0x2f7e1f,_0x59b14b=(0x0,shortid_1[_0xa5c4b4(0xa5)])();return await(0x0,promises_1['writeFile'])(path_1[_0xa5c4b4(0xa5)][_0xa5c4b4(0xc5)](this['metadataFolder'],_0x59b14b+_0xa5c4b4(0xbf)),JSON['stringify'](_0x51f32e)),_0x59b14b;}async[a272_0x2f7e1f(0xd4)](){const _0x43b177=a272_0x2f7e1f,{credentials:_0x33210e,declarativeFilter:_0x49bbbe,metadataTypes:_0x4c90ff,maxChunkSize:_0x5d2134,maxChunkItems:_0x5c406f,apiVersion:_0x3d04c6}=await new manifest_manger_1['default'](this[_0x43b177(0xb0)])[_0x43b177(0xa1)](),_0x3e814f=await salesforce_1[_0x43b177(0xbb)][_0x43b177(0xb7)](new auth_manager_1[(_0x43b177(0xb8))](_0x33210e),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x1985b2=await retrieve_factory_1['default'][_0x43b177(0xb7)](_0x3e814f,this[_0x43b177(0xa9)],_0x49bbbe,_0x4c90ff,_0x3d04c6)[_0x43b177(0xd4)]();await(0x0,fs_utils_1[_0x43b177(0xba)])(this[_0x43b177(0xc2)]);let _0x581b68=[];const _0x480d60=[];let _0x42eaae=0x0;for(const _0x3571d6 in _0x1985b2[_0x43b177(0xd3)]){for(const {listMetadataItem:_0x161f16,files:_0x53dfd6}of _0x1985b2['items'][_0x3571d6][_0x43b177(0xcc)]){const _0x59da09=new jszip_1[(_0x43b177(0xa5))]();for(const _0x5bf9b6 in _0x53dfd6){await _0x59da09['file'](_0x5bf9b6,_0x53dfd6[_0x5bf9b6]);}const _0x59178e=await _0x59da09[_0x43b177(0xb5)]({'type':_0x43b177(0xc6),'compression':_0x43b177(0xcf),'compressionOptions':{'level':0x9}}),_0x485176={..._0x161f16,'zip':_0x59178e},_0x298ec8=(0x0,object_sizeof_1['default'])(_0x485176);if(_0x298ec8>_0x5d2134){await this[_0x43b177(0xc8)][_0x43b177(0xa2)](_0x43b177(0xb6)+_0x161f16['fileName']+_0x43b177(0xab)+_0x298ec8+_0x43b177(0xce)+_0x5d2134+'\x27');continue;}if(_0x42eaae+_0x298ec8>_0x5d2134||_0x581b68[_0x43b177(0xac)]>=_0x5c406f){const _0x1cfd83=await this[_0x43b177(0xc7)](_0x581b68);_0x480d60[_0x43b177(0xc1)](_0x1cfd83),_0x42eaae=0x0,_0x581b68=[];}_0x581b68['push'](_0x485176),_0x42eaae+=_0x298ec8;}}if(_0x581b68[_0x43b177(0xac)]){const _0x4a1d4d=await this[_0x43b177(0xc7)](_0x581b68);_0x480d60['push'](_0x4a1d4d);}await(0x0,promises_1[_0x43b177(0xbd)])(this[_0x43b177(0xb1)],JSON['stringify'](_0x480d60));}}exports['default']=RetrieveMetadata;