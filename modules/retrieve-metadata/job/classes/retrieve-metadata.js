const a287_0x51b7a4=a287_0x2eb9;function a287_0x59b1(){const _0x50b738=['base64','push','Item\x20\x27','__esModule','DEFLATE','items','jszip','search','15sPYMxI','length','init','components','path','./retrieve-factory','__importDefault','(((.+)+)+)+$','writeFile','apply','@flosum/salesforce','generateAsync','constructor','16715310vrFyEL','101255VwgOsy','join','stateManager','retrieveResultsPath','writeChunk','toString','fileName','AxiosInstanceUtils','../../constants','2590704eiucbo','AuthManager','stringify','fs/promises','431966CkItbn','801524WdMRdk','jobStorePath','14962608pCFjsx','default','makeDir','3PJkCcu','../../../shared/utils/fs.utils','280xpZEFx','logger','244072xERcKi','object-sizeof','metadataFolder','execute'];a287_0x59b1=function(){return _0x50b738;};return a287_0x59b1();}(function(_0x318029,_0x30bcbb){const _0x5a17c0=a287_0x2eb9,_0x52195e=_0x318029();while(!![]){try{const _0x284184=-parseInt(_0x5a17c0(0x1fc))/0x1+parseInt(_0x5a17c0(0x1f2))/0x2+-parseInt(_0x5a17c0(0x1f8))/0x3*(-parseInt(_0x5a17c0(0x1f3))/0x4)+-parseInt(_0x5a17c0(0x208))/0x5*(-parseInt(_0x5a17c0(0x1ee))/0x6)+parseInt(_0x5a17c0(0x1e5))/0x7*(-parseInt(_0x5a17c0(0x1fa))/0x8)+-parseInt(_0x5a17c0(0x1f5))/0x9+parseInt(_0x5a17c0(0x1e4))/0xa;if(_0x284184===_0x30bcbb)break;else _0x52195e['push'](_0x52195e['shift']());}catch(_0x1e18e9){_0x52195e['push'](_0x52195e['shift']());}}}(a287_0x59b1,0xece94));const a287_0x355fd3=(function(){let _0x45637d=!![];return function(_0x51ff82,_0xeae094){const _0x11fec1=_0x45637d?function(){const _0x934b59=a287_0x2eb9;if(_0xeae094){const _0x2229e4=_0xeae094[_0x934b59(0x1e0)](_0x51ff82,arguments);return _0xeae094=null,_0x2229e4;}}:function(){};return _0x45637d=![],_0x11fec1;};}()),a287_0x418349=a287_0x355fd3(this,function(){const _0x4df5d4=a287_0x2eb9;return a287_0x418349[_0x4df5d4(0x1ea)]()[_0x4df5d4(0x207)](_0x4df5d4(0x20f))[_0x4df5d4(0x1ea)]()[_0x4df5d4(0x1e3)](a287_0x418349)[_0x4df5d4(0x207)](_0x4df5d4(0x20f));});a287_0x418349();function a287_0x2eb9(_0x1eef1f,_0x2474dd){const _0x468269=a287_0x59b1();return a287_0x2eb9=function(_0x418349,_0x355fd3){_0x418349=_0x418349-0x1e0;let _0x59b15a=_0x468269[_0x418349];return _0x59b15a;},a287_0x2eb9(_0x1eef1f,_0x2474dd);}'use strict';var __importDefault=this&&this[a287_0x51b7a4(0x20e)]||function(_0x464362){const _0x51d36f=a287_0x51b7a4;return _0x464362&&_0x464362[_0x51d36f(0x203)]?_0x464362:{'default':_0x464362};};Object['defineProperty'](exports,a287_0x51b7a4(0x203),{'value':!![]});const salesforce_1=require(a287_0x51b7a4(0x1e1)),manifest_manger_1=__importDefault(require('./manifest-manger')),path_1=__importDefault(require(a287_0x51b7a4(0x20c))),promises_1=require(a287_0x51b7a4(0x1f1)),fs_utils_1=require(a287_0x51b7a4(0x1f9)),object_sizeof_1=__importDefault(require(a287_0x51b7a4(0x1fd))),retrieve_factory_1=__importDefault(require(a287_0x51b7a4(0x20d))),auth_manager_1=require('../../../shared/managers/auth.manager'),constants_1=require(a287_0x51b7a4(0x1ed)),shortid_1=__importDefault(require('shortid')),jszip_1=__importDefault(require(a287_0x51b7a4(0x206)));class RetrieveMetadata{constructor(_0x18cc90,_0x5e0b16,_0x3f6e55){const _0x373dfa=a287_0x51b7a4;this[_0x373dfa(0x1f4)]=_0x18cc90,this[_0x373dfa(0x1fb)]=_0x5e0b16,this['stateManager']=_0x3f6e55,this[_0x373dfa(0x1fe)]=path_1[_0x373dfa(0x1f6)][_0x373dfa(0x1e6)](this[_0x373dfa(0x1f4)],constants_1['RETRIEVE_RESULT_FOLDER_NAME']),this[_0x373dfa(0x1e8)]=path_1[_0x373dfa(0x1f6)][_0x373dfa(0x1e6)](this['jobStorePath'],constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);}async['writeChunk'](_0xc30d18){const _0x4855f9=a287_0x51b7a4,_0x33f14d=(0x0,shortid_1[_0x4855f9(0x1f6)])();return await(0x0,promises_1[_0x4855f9(0x210)])(path_1[_0x4855f9(0x1f6)][_0x4855f9(0x1e6)](this[_0x4855f9(0x1fe)],_0x33f14d+'.json'),JSON[_0x4855f9(0x1f0)](_0xc30d18)),_0x33f14d;}async[a287_0x51b7a4(0x1ff)](){const _0x3598e8=a287_0x51b7a4,{credentials:_0x33490a,declarativeFilter:_0x5d8d5b,metadataTypes:_0x562e45,maxChunkSize:_0x384dc5,maxChunkItems:_0x560b5b,apiVersion:_0x2fff87}=await new manifest_manger_1[(_0x3598e8(0x1f6))](this[_0x3598e8(0x1f4)])[_0x3598e8(0x20a)](),_0x53411b=await salesforce_1[_0x3598e8(0x1ec)]['create'](new auth_manager_1[(_0x3598e8(0x1ef))](_0x33490a),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0xb2c3e2=await retrieve_factory_1[_0x3598e8(0x1f6)]['create'](_0x53411b,this['logger'],_0x5d8d5b,_0x562e45,_0x2fff87)['execute']();await(0x0,fs_utils_1[_0x3598e8(0x1f7)])(this[_0x3598e8(0x1fe)]);let _0xec6634=[];const _0x1597c3=[];let _0x139e0a=0x0;for(const _0x340954 in _0xb2c3e2[_0x3598e8(0x205)]){for(const {listMetadataItem:_0x142763,files:_0x1f3d49}of _0xb2c3e2[_0x3598e8(0x205)][_0x340954][_0x3598e8(0x20b)]){const _0x2e08c4=new jszip_1[(_0x3598e8(0x1f6))]();for(const _0x269cc1 in _0x1f3d49){await _0x2e08c4['file'](_0x269cc1,_0x1f3d49[_0x269cc1]);}const _0x389572=await _0x2e08c4[_0x3598e8(0x1e2)]({'type':_0x3598e8(0x200),'compression':_0x3598e8(0x204),'compressionOptions':{'level':0x9}}),_0x448923={..._0x142763,'zip':_0x389572},_0x1e2187=(0x0,object_sizeof_1[_0x3598e8(0x1f6)])(_0x448923);if(_0x1e2187>_0x384dc5){await this[_0x3598e8(0x1e7)]['addWarning'](_0x3598e8(0x202)+_0x142763[_0x3598e8(0x1eb)]+'\x27\x20size\x20\x27'+_0x1e2187+'\x27\x20exceed\x20limit\x20\x27'+_0x384dc5+'\x27');continue;}if(_0x139e0a+_0x1e2187>_0x384dc5||_0xec6634[_0x3598e8(0x209)]>=_0x560b5b){const _0x53a4fc=await this['writeChunk'](_0xec6634);_0x1597c3['push'](_0x53a4fc),_0x139e0a=0x0,_0xec6634=[];}_0xec6634[_0x3598e8(0x201)](_0x448923),_0x139e0a+=_0x1e2187;}}if(_0xec6634[_0x3598e8(0x209)]){const _0x14e333=await this[_0x3598e8(0x1e9)](_0xec6634);_0x1597c3[_0x3598e8(0x201)](_0x14e333);}await(0x0,promises_1[_0x3598e8(0x210)])(this[_0x3598e8(0x1e8)],JSON[_0x3598e8(0x1f0)](_0x1597c3));}}exports[a287_0x51b7a4(0x1f6)]=RetrieveMetadata;