const a266_0x1a4a71=a266_0x36ad;(function(_0x3d1899,_0x20fcb1){const _0x216499=a266_0x36ad,_0x3a1e67=_0x3d1899();while(!![]){try{const _0x44a435=-parseInt(_0x216499(0x1c1))/0x1+-parseInt(_0x216499(0x1d8))/0x2*(-parseInt(_0x216499(0x1d6))/0x3)+-parseInt(_0x216499(0x1db))/0x4+-parseInt(_0x216499(0x1eb))/0x5*(-parseInt(_0x216499(0x1c3))/0x6)+-parseInt(_0x216499(0x1c2))/0x7+-parseInt(_0x216499(0x1c4))/0x8*(parseInt(_0x216499(0x1e0))/0x9)+parseInt(_0x216499(0x1c9))/0xa;if(_0x44a435===_0x20fcb1)break;else _0x3a1e67['push'](_0x3a1e67['shift']());}catch(_0x7f880f){_0x3a1e67['push'](_0x3a1e67['shift']());}}}(a266_0x4eef,0x89ca7));const a266_0x1d1b9e=(function(){let _0x654d1=!![];return function(_0x4ce35b,_0x538660){const _0x5b041d=_0x654d1?function(){if(_0x538660){const _0x10b3bc=_0x538660['apply'](_0x4ce35b,arguments);return _0x538660=null,_0x10b3bc;}}:function(){};return _0x654d1=![],_0x5b041d;};}()),a266_0x43101d=a266_0x1d1b9e(this,function(){const _0x2fa4b1=a266_0x36ad;return a266_0x43101d['toString']()[_0x2fa4b1(0x1de)](_0x2fa4b1(0x1e5))[_0x2fa4b1(0x1bd)]()[_0x2fa4b1(0x1c7)](a266_0x43101d)['search'](_0x2fa4b1(0x1e5));});a266_0x43101d();'use strict';var __importDefault=this&&this[a266_0x1a4a71(0x1bf)]||function(_0x14e35c){const _0x5422ab=a266_0x1a4a71;return _0x14e35c&&_0x14e35c[_0x5422ab(0x1ea)]?_0x14e35c:{'default':_0x14e35c};};Object[a266_0x1a4a71(0x1cb)](exports,'__esModule',{'value':!![]});function a266_0x36ad(_0x176e84,_0x545b27){const _0x1fdb33=a266_0x4eef();return a266_0x36ad=function(_0x43101d,_0x1d1b9e){_0x43101d=_0x43101d-0x1bb;let _0x4eef1b=_0x1fdb33[_0x43101d];return _0x4eef1b;},a266_0x36ad(_0x176e84,_0x545b27);}const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a266_0x1a4a71(0x1df))),path_1=__importDefault(require(a266_0x1a4a71(0x1e2))),promises_1=require(a266_0x1a4a71(0x1e4)),fs_utils_1=require(a266_0x1a4a71(0x1ec)),object_sizeof_1=__importDefault(require('object-sizeof')),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a266_0x1a4a71(0x1c0)),constants_1=require(a266_0x1a4a71(0x1d4)),shortid_1=__importDefault(require('shortid')),jszip_1=__importDefault(require(a266_0x1a4a71(0x1e6)));function a266_0x4eef(){const _0x30607c=['retrieveResultsPath','fs/promises','(((.+)+)+)+$','jszip','generateAsync','writeChunk','DEFLATE','__esModule','5HjxEXc','../../../shared/utils/fs.utils','execute','components','toString','init','__importDefault','../../../shared/managers/auth.manager','1098354uInmzC','1765841MSBhvs','576666yUoPCU','28680vfGJIc','AxiosInstanceUtils','items','constructor','length','22135750cGfCeu','\x27\x20size\x20\x27','defineProperty','logger','Item\x20\x27','metadataFolder','stateManager','join','fileName','default','addWarning','../../constants','stringify','45PYAyuw','create','115572jpPKvT','base64','push','4228492WWNXnP','jobStorePath','file','search','./manifest-manger','513kyPlIk','RETRIEVE_RESULT_FOLDER_NAME','path'];a266_0x4eef=function(){return _0x30607c;};return a266_0x4eef();}class RetrieveMetadata{constructor(_0x5def81,_0x548b59,_0x4c2cd2){const _0x4e8b89=a266_0x1a4a71;this[_0x4e8b89(0x1dc)]=_0x5def81,this['logger']=_0x548b59,this[_0x4e8b89(0x1cf)]=_0x4c2cd2,this[_0x4e8b89(0x1ce)]=path_1[_0x4e8b89(0x1d2)][_0x4e8b89(0x1d0)](this[_0x4e8b89(0x1dc)],constants_1[_0x4e8b89(0x1e1)]),this[_0x4e8b89(0x1e3)]=path_1['default'][_0x4e8b89(0x1d0)](this[_0x4e8b89(0x1dc)],constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);}async['writeChunk'](_0x24f8b1){const _0x4ea8d3=a266_0x1a4a71,_0x1595d8=(0x0,shortid_1[_0x4ea8d3(0x1d2)])();return await(0x0,promises_1['writeFile'])(path_1[_0x4ea8d3(0x1d2)][_0x4ea8d3(0x1d0)](this[_0x4ea8d3(0x1ce)],_0x1595d8+'.json'),JSON[_0x4ea8d3(0x1d5)](_0x24f8b1)),_0x1595d8;}async['execute'](){const _0xbb4449=a266_0x1a4a71,{credentials:_0xc4c9f3,declarativeFilter:_0x525e4a,maxChunkSize:_0x5072ef,maxChunkItems:_0xa61868,apiVersion:_0x2877ef}=await new manifest_manger_1[(_0xbb4449(0x1d2))](this[_0xbb4449(0x1dc)])[_0xbb4449(0x1be)](),_0x40f7f8=await salesforce_1[_0xbb4449(0x1c5)][_0xbb4449(0x1d7)](new auth_manager_1['AuthManager'](_0xc4c9f3),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x524f79=await retrieve_factory_1[_0xbb4449(0x1d2)][_0xbb4449(0x1d7)](_0x40f7f8,this[_0xbb4449(0x1cc)],_0x525e4a,_0x2877ef)[_0xbb4449(0x1bb)]();await(0x0,fs_utils_1['makeDir'])(this[_0xbb4449(0x1ce)]);let _0x1c5054=[];const _0x2428d5=[];let _0x340969=0x0;for(const _0xc2cdb2 in _0x524f79[_0xbb4449(0x1c6)]){for(const {listMetadataItem:_0x2188ca,files:_0x19d149}of _0x524f79[_0xbb4449(0x1c6)][_0xc2cdb2][_0xbb4449(0x1bc)]){const _0x2fc628=new jszip_1[(_0xbb4449(0x1d2))]();for(const _0x56748f in _0x19d149){await _0x2fc628[_0xbb4449(0x1dd)](_0x56748f,_0x19d149[_0x56748f]);}const _0x43e69b=await _0x2fc628[_0xbb4449(0x1e7)]({'type':_0xbb4449(0x1d9),'compression':_0xbb4449(0x1e9),'compressionOptions':{'level':0x9}}),_0x2fb9d7={..._0x2188ca,'zip':_0x43e69b},_0x552c68=(0x0,object_sizeof_1[_0xbb4449(0x1d2)])(_0x2fb9d7);if(_0x552c68>_0x5072ef){await this[_0xbb4449(0x1cf)][_0xbb4449(0x1d3)](_0xbb4449(0x1cd)+_0x2188ca[_0xbb4449(0x1d1)]+_0xbb4449(0x1ca)+_0x552c68+'\x27\x20exceed\x20limit\x20\x27'+_0x5072ef+'\x27');continue;}if(_0x340969+_0x552c68>_0x5072ef||_0x1c5054[_0xbb4449(0x1c8)]>=_0xa61868){const _0x1a2ac8=await this['writeChunk'](_0x1c5054);_0x2428d5[_0xbb4449(0x1da)](_0x1a2ac8),_0x340969=0x0,_0x1c5054=[];}_0x1c5054[_0xbb4449(0x1da)](_0x2fb9d7),_0x340969+=_0x552c68;}}if(_0x1c5054[_0xbb4449(0x1c8)]){const _0x36142f=await this[_0xbb4449(0x1e8)](_0x1c5054);_0x2428d5[_0xbb4449(0x1da)](_0x36142f);}await(0x0,promises_1['writeFile'])(this[_0xbb4449(0x1e3)],JSON['stringify'](_0x2428d5));}}exports[a266_0x1a4a71(0x1d2)]=RetrieveMetadata;