const a316_0x29c97d=a316_0x693a;(function(_0x486a6f,_0x8368c1){const _0x781ff7=a316_0x693a,_0x586d08=_0x486a6f();while(!![]){try{const _0x11d86a=parseInt(_0x781ff7(0x149))/0x1*(parseInt(_0x781ff7(0x137))/0x2)+-parseInt(_0x781ff7(0x14c))/0x3+parseInt(_0x781ff7(0x150))/0x4*(-parseInt(_0x781ff7(0x136))/0x5)+parseInt(_0x781ff7(0x133))/0x6+parseInt(_0x781ff7(0x146))/0x7*(-parseInt(_0x781ff7(0x13b))/0x8)+-parseInt(_0x781ff7(0x123))/0x9*(-parseInt(_0x781ff7(0x13d))/0xa)+parseInt(_0x781ff7(0x124))/0xb;if(_0x11d86a===_0x8368c1)break;else _0x586d08['push'](_0x586d08['shift']());}catch(_0x251b0d){_0x586d08['push'](_0x586d08['shift']());}}}(a316_0x38ee,0x83155));const a316_0x1b2dfe=(function(){let _0x4e45b3=!![];return function(_0x40d955,_0x58ba43){const _0x5caa02=_0x4e45b3?function(){if(_0x58ba43){const _0x4b9a44=_0x58ba43['apply'](_0x40d955,arguments);return _0x58ba43=null,_0x4b9a44;}}:function(){};return _0x4e45b3=![],_0x5caa02;};}()),a316_0x43927d=a316_0x1b2dfe(this,function(){const _0x556cda=a316_0x693a;return a316_0x43927d[_0x556cda(0x14e)]()[_0x556cda(0x143)](_0x556cda(0x153))[_0x556cda(0x14e)]()[_0x556cda(0x127)](a316_0x43927d)[_0x556cda(0x143)](_0x556cda(0x153));});a316_0x43927d();function a316_0x38ee(){const _0x5c7e35=['./retrieve-factory','57527OnaxAv','fileName','default','298413QFPDjE','__esModule','toString','stateManager','8Dporzk','addWarning','\x27\x20size\x20\x27','(((.+)+)+)+$','./manifest-manger','components','retrieveResultsPath','129699xvCiwO','509762dyLthZ','object-sizeof','DEFLATE','constructor','stringify','.json','generateAsync','\x27\x20exceed\x20limit\x20\x27','base64','push','jobStorePath','create','path','../../../shared/utils/fs.utils','RETRIEVE_RESULTS_IDS_FILENAME','2755314zxinuu','join','AxiosInstanceUtils','1728460UccDHj','12KcWvUu','fs/promises','@flosum/salesforce','RETRIEVE_RESULT_FOLDER_NAME','1262224WrWwJK','Item\x20\x27','550STDPmL','metadataFolder','defineProperty','writeFile','writeChunk','logger','search','execute','../../constants','14JiGagw','length'];a316_0x38ee=function(){return _0x5c7e35;};return a316_0x38ee();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x58a1b9){return _0x58a1b9&&_0x58a1b9['__esModule']?_0x58a1b9:{'default':_0x58a1b9};};function a316_0x693a(_0x2401ac,_0x4fe5e1){const _0x33cd59=a316_0x38ee();return a316_0x693a=function(_0x43927d,_0x1b2dfe){_0x43927d=_0x43927d-0x121;let _0x38ee61=_0x33cd59[_0x43927d];return _0x38ee61;},a316_0x693a(_0x2401ac,_0x4fe5e1);}Object[a316_0x29c97d(0x13f)](exports,a316_0x29c97d(0x14d),{'value':!![]});const salesforce_1=require(a316_0x29c97d(0x139)),manifest_manger_1=__importDefault(require(a316_0x29c97d(0x154))),path_1=__importDefault(require(a316_0x29c97d(0x130))),promises_1=require(a316_0x29c97d(0x138)),fs_utils_1=require(a316_0x29c97d(0x131)),object_sizeof_1=__importDefault(require(a316_0x29c97d(0x125))),retrieve_factory_1=__importDefault(require(a316_0x29c97d(0x148))),auth_manager_1=require('../../../shared/managers/auth.manager'),constants_1=require(a316_0x29c97d(0x145)),shortid_1=__importDefault(require('shortid')),jszip_1=__importDefault(require('jszip'));class RetrieveMetadata{constructor(_0x583443,_0x4a1e58,_0x42e2ae){const _0x5a272f=a316_0x29c97d;this[_0x5a272f(0x12e)]=_0x583443,this[_0x5a272f(0x142)]=_0x4a1e58,this[_0x5a272f(0x14f)]=_0x42e2ae,this[_0x5a272f(0x13e)]=path_1[_0x5a272f(0x14b)][_0x5a272f(0x134)](this[_0x5a272f(0x12e)],constants_1[_0x5a272f(0x13a)]),this[_0x5a272f(0x122)]=path_1[_0x5a272f(0x14b)]['join'](this[_0x5a272f(0x12e)],constants_1[_0x5a272f(0x132)]);}async['writeChunk'](_0xa80c15){const _0x581c50=a316_0x29c97d,_0x1640d9=(0x0,shortid_1[_0x581c50(0x14b)])();return await(0x0,promises_1[_0x581c50(0x140)])(path_1['default'][_0x581c50(0x134)](this[_0x581c50(0x13e)],_0x1640d9+_0x581c50(0x129)),JSON['stringify'](_0xa80c15)),_0x1640d9;}async[a316_0x29c97d(0x144)](){const _0x4b5883=a316_0x29c97d,{credentials:_0x16a49e,declarativeFilter:_0x388006,metadataTypes:_0x447c74,maxChunkSize:_0x378d1e,maxChunkItems:_0x42c145,apiVersion:_0xa0af27}=await new manifest_manger_1[(_0x4b5883(0x14b))](this['jobStorePath'])['init'](),_0x264227=await salesforce_1[_0x4b5883(0x135)][_0x4b5883(0x12f)](new auth_manager_1['AuthManager'](_0x16a49e),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x23e24e=await retrieve_factory_1[_0x4b5883(0x14b)][_0x4b5883(0x12f)](_0x264227,this[_0x4b5883(0x142)],_0x388006,_0x447c74,_0xa0af27)[_0x4b5883(0x144)]();await(0x0,fs_utils_1['makeDir'])(this[_0x4b5883(0x13e)]);let _0x523a22=[];const _0x4a3fe8=[];let _0x227ab0=0x0;for(const _0x5e2fbc in _0x23e24e['items']){for(const {listMetadataItem:_0x5c9dd5,files:_0x2203da}of _0x23e24e['items'][_0x5e2fbc][_0x4b5883(0x121)]){const _0x5b80ab=new jszip_1['default']();for(const _0x5f4e02 in _0x2203da){await _0x5b80ab['file'](_0x5f4e02,_0x2203da[_0x5f4e02]);}const _0x5411b7=await _0x5b80ab[_0x4b5883(0x12a)]({'type':_0x4b5883(0x12c),'compression':_0x4b5883(0x126),'compressionOptions':{'level':0x9}}),_0x218de8={..._0x5c9dd5,'zip':_0x5411b7},_0x22248e=(0x0,object_sizeof_1[_0x4b5883(0x14b)])(_0x218de8);if(_0x22248e>_0x378d1e){await this[_0x4b5883(0x14f)][_0x4b5883(0x151)](_0x4b5883(0x13c)+_0x5c9dd5[_0x4b5883(0x14a)]+_0x4b5883(0x152)+_0x22248e+_0x4b5883(0x12b)+_0x378d1e+'\x27');continue;}if(_0x227ab0+_0x22248e>_0x378d1e||_0x523a22[_0x4b5883(0x147)]>=_0x42c145){const _0x4edfd2=await this[_0x4b5883(0x141)](_0x523a22);_0x4a3fe8[_0x4b5883(0x12d)](_0x4edfd2),_0x227ab0=0x0,_0x523a22=[];}_0x523a22[_0x4b5883(0x12d)](_0x218de8),_0x227ab0+=_0x22248e;}}if(_0x523a22[_0x4b5883(0x147)]){const _0x382fc6=await this[_0x4b5883(0x141)](_0x523a22);_0x4a3fe8[_0x4b5883(0x12d)](_0x382fc6);}await(0x0,promises_1['writeFile'])(this[_0x4b5883(0x122)],JSON[_0x4b5883(0x128)](_0x4a3fe8));}}exports[a316_0x29c97d(0x14b)]=RetrieveMetadata;