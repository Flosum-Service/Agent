const a267_0x5cbb8b=a267_0x5e73;function a267_0x1a93(){const _0x5562a9=['../../../shared/managers/auth.manager','3964100DUfUxe','../../../shared/utils/fs.utils','fileName','file','RETRIEVE_RESULTS_IDS_FILENAME','stringify','writeChunk','base64','constructor','2395302iMTpCA','object-sizeof','create','init','2780262VhSlwy','6477152rpjjpM','apply','length','2930704fmyBuZ','Item\x20\x27','metadataFolder','.json','logger','fs/promises','stateManager','toString','jobStorePath','makeDir','defineProperty','items','1726300iXEVsv','544172WwhfeW','./retrieve-factory','AxiosInstanceUtils','push','\x27\x20exceed\x20limit\x20\x27','__esModule','7vmjbVv','writeFile','execute','join','generateAsync','RETRIEVE_RESULT_FOLDER_NAME','(((.+)+)+)+$','search','jszip','DEFLATE','default'];a267_0x1a93=function(){return _0x5562a9;};return a267_0x1a93();}(function(_0x26592e,_0x4d4405){const _0x162b1f=a267_0x5e73,_0x7d61a4=_0x26592e();while(!![]){try{const _0x1c52c2=parseInt(_0x162b1f(0x15c))/0x1+parseInt(_0x162b1f(0x15b))/0x2+-parseInt(_0x162b1f(0x147))/0x3+parseInt(_0x162b1f(0x14f))/0x4+-parseInt(_0x162b1f(0x16e))/0x5+-parseInt(_0x162b1f(0x14b))/0x6*(parseInt(_0x162b1f(0x162))/0x7)+parseInt(_0x162b1f(0x14c))/0x8;if(_0x1c52c2===_0x4d4405)break;else _0x7d61a4['push'](_0x7d61a4['shift']());}catch(_0x1d6df8){_0x7d61a4['push'](_0x7d61a4['shift']());}}}(a267_0x1a93,0xda823));const a267_0x257ac0=(function(){let _0x32f355=!![];return function(_0x11200e,_0x4546e2){const _0x220da9=_0x32f355?function(){const _0x464e4b=a267_0x5e73;if(_0x4546e2){const _0x3d0eb9=_0x4546e2[_0x464e4b(0x14d)](_0x11200e,arguments);return _0x4546e2=null,_0x3d0eb9;}}:function(){};return _0x32f355=![],_0x220da9;};}()),a267_0x5b4456=a267_0x257ac0(this,function(){const _0x3ffeb3=a267_0x5e73;return a267_0x5b4456[_0x3ffeb3(0x156)]()[_0x3ffeb3(0x169)]('(((.+)+)+)+$')[_0x3ffeb3(0x156)]()[_0x3ffeb3(0x146)](a267_0x5b4456)[_0x3ffeb3(0x169)](_0x3ffeb3(0x168));});a267_0x5b4456();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3070fc){const _0x533014=a267_0x5e73;return _0x3070fc&&_0x3070fc[_0x533014(0x161)]?_0x3070fc:{'default':_0x3070fc};};Object[a267_0x5cbb8b(0x159)](exports,'__esModule',{'value':!![]});function a267_0x5e73(_0x31b437,_0x520df1){const _0x3a93cb=a267_0x1a93();return a267_0x5e73=function(_0x5b4456,_0x257ac0){_0x5b4456=_0x5b4456-0x142;let _0x1a9349=_0x3a93cb[_0x5b4456];return _0x1a9349;},a267_0x5e73(_0x31b437,_0x520df1);}const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require('./manifest-manger')),path_1=__importDefault(require('path')),promises_1=require(a267_0x5cbb8b(0x154)),fs_utils_1=require(a267_0x5cbb8b(0x16f)),object_sizeof_1=__importDefault(require(a267_0x5cbb8b(0x148))),retrieve_factory_1=__importDefault(require(a267_0x5cbb8b(0x15d))),auth_manager_1=require(a267_0x5cbb8b(0x16d)),constants_1=require('../../constants'),shortid_1=__importDefault(require('shortid')),jszip_1=__importDefault(require(a267_0x5cbb8b(0x16a)));class RetrieveMetadata{constructor(_0x32edb4,_0x1d799b,_0x5986bd){const _0x566f7b=a267_0x5cbb8b;this[_0x566f7b(0x157)]=_0x32edb4,this[_0x566f7b(0x153)]=_0x1d799b,this['stateManager']=_0x5986bd,this[_0x566f7b(0x151)]=path_1[_0x566f7b(0x16c)]['join'](this[_0x566f7b(0x157)],constants_1[_0x566f7b(0x167)]),this['retrieveResultsPath']=path_1['default'][_0x566f7b(0x165)](this[_0x566f7b(0x157)],constants_1[_0x566f7b(0x142)]);}async[a267_0x5cbb8b(0x144)](_0x3fada8){const _0x2d144c=a267_0x5cbb8b,_0x749c=(0x0,shortid_1[_0x2d144c(0x16c)])();return await(0x0,promises_1[_0x2d144c(0x163)])(path_1[_0x2d144c(0x16c)][_0x2d144c(0x165)](this[_0x2d144c(0x151)],_0x749c+_0x2d144c(0x152)),JSON[_0x2d144c(0x143)](_0x3fada8)),_0x749c;}async['execute'](){const _0x8316c5=a267_0x5cbb8b,{credentials:_0x518bb4,declarativeFilter:_0x3fe71d,metadataTypes:_0x102591,maxChunkSize:_0x24d66e,maxChunkItems:_0x3673e0,apiVersion:_0x4c3b73}=await new manifest_manger_1[(_0x8316c5(0x16c))](this[_0x8316c5(0x157)])[_0x8316c5(0x14a)](),_0x56dae7=await salesforce_1[_0x8316c5(0x15e)][_0x8316c5(0x149)](new auth_manager_1['AuthManager'](_0x518bb4),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x3a448b=await retrieve_factory_1[_0x8316c5(0x16c)][_0x8316c5(0x149)](_0x56dae7,this[_0x8316c5(0x153)],_0x3fe71d,_0x102591,_0x4c3b73)[_0x8316c5(0x164)]();await(0x0,fs_utils_1[_0x8316c5(0x158)])(this['metadataFolder']);let _0x57710a=[];const _0x2c37fd=[];let _0x238ed8=0x0;for(const _0x4d8423 in _0x3a448b[_0x8316c5(0x15a)]){for(const {listMetadataItem:_0x5171b7,files:_0x3f6ea6}of _0x3a448b[_0x8316c5(0x15a)][_0x4d8423]['components']){const _0x387131=new jszip_1[(_0x8316c5(0x16c))]();for(const _0x3badc3 in _0x3f6ea6){await _0x387131[_0x8316c5(0x171)](_0x3badc3,_0x3f6ea6[_0x3badc3]);}const _0x412269=await _0x387131[_0x8316c5(0x166)]({'type':_0x8316c5(0x145),'compression':_0x8316c5(0x16b),'compressionOptions':{'level':0x9}}),_0x253b35={..._0x5171b7,'zip':_0x412269},_0x51513c=(0x0,object_sizeof_1['default'])(_0x253b35);if(_0x51513c>_0x24d66e){await this[_0x8316c5(0x155)]['addWarning'](_0x8316c5(0x150)+_0x5171b7[_0x8316c5(0x170)]+'\x27\x20size\x20\x27'+_0x51513c+_0x8316c5(0x160)+_0x24d66e+'\x27');continue;}if(_0x238ed8+_0x51513c>_0x24d66e||_0x57710a[_0x8316c5(0x14e)]>=_0x3673e0){const _0xf30af7=await this[_0x8316c5(0x144)](_0x57710a);_0x2c37fd['push'](_0xf30af7),_0x238ed8=0x0,_0x57710a=[];}_0x57710a[_0x8316c5(0x15f)](_0x253b35),_0x238ed8+=_0x51513c;}}if(_0x57710a[_0x8316c5(0x14e)]){const _0x415fb2=await this[_0x8316c5(0x144)](_0x57710a);_0x2c37fd['push'](_0x415fb2);}await(0x0,promises_1[_0x8316c5(0x163)])(this['retrieveResultsPath'],JSON[_0x8316c5(0x143)](_0x2c37fd));}}exports[a267_0x5cbb8b(0x16c)]=RetrieveMetadata;