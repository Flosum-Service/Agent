const a315_0x3a632e=a315_0x9c0b;(function(_0x5003ad,_0x1de231){const _0x11f420=a315_0x9c0b,_0xc9a978=_0x5003ad();while(!![]){try{const _0x32d374=-parseInt(_0x11f420(0xec))/0x1*(parseInt(_0x11f420(0x109))/0x2)+parseInt(_0x11f420(0xf7))/0x3*(parseInt(_0x11f420(0x11a))/0x4)+parseInt(_0x11f420(0x100))/0x5*(-parseInt(_0x11f420(0xf4))/0x6)+-parseInt(_0x11f420(0xed))/0x7+-parseInt(_0x11f420(0x117))/0x8+parseInt(_0x11f420(0x114))/0x9+parseInt(_0x11f420(0xf8))/0xa;if(_0x32d374===_0x1de231)break;else _0xc9a978['push'](_0xc9a978['shift']());}catch(_0x14c79b){_0xc9a978['push'](_0xc9a978['shift']());}}}(a315_0x2dc8,0xb7c3c));const a315_0x5414ab=(function(){let _0x544334=!![];return function(_0x584e57,_0x4cbacc){const _0x3c4a5d=_0x544334?function(){if(_0x4cbacc){const _0x1ca300=_0x4cbacc['apply'](_0x584e57,arguments);return _0x4cbacc=null,_0x1ca300;}}:function(){};return _0x544334=![],_0x3c4a5d;};}()),a315_0x55d868=a315_0x5414ab(this,function(){const _0x1e2b23=a315_0x9c0b;return a315_0x55d868[_0x1e2b23(0xea)]()[_0x1e2b23(0x105)](_0x1e2b23(0x102))[_0x1e2b23(0xea)]()[_0x1e2b23(0x10d)](a315_0x55d868)['search']('(((.+)+)+)+$');});a315_0x55d868();'use strict';var __importDefault=this&&this[a315_0x3a632e(0x118)]||function(_0x25d910){const _0x418fe7=a315_0x3a632e;return _0x25d910&&_0x25d910[_0x418fe7(0x107)]?_0x25d910:{'default':_0x25d910};};Object[a315_0x3a632e(0x110)](exports,a315_0x3a632e(0x107),{'value':!![]});function a315_0x2dc8(){const _0x541536=['23706IePkpu','metadataFolder','writeChunk','4719wqpejp','28052030ivWWMp','retrieveResultsPath','DEFLATE','path','Item\x20\x27','makeDir','jobStorePath','generateAsync','1010OFGBfT','length','(((.+)+)+)+$','writeFile','\x27\x20exceed\x20limit\x20\x27','search','stringify','__esModule','AuthManager','26814whlQyH','create','base64','RETRIEVE_RESULT_FOLDER_NAME','constructor','jszip','join','defineProperty','default','\x27\x20size\x20\x27','stateManager','6117912kbZPZS','RETRIEVE_RESULTS_IDS_FILENAME','../../../shared/utils/fs.utils','11395792AlCNyf','__importDefault','items','524tpwCme','../../../shared/managers/auth.manager','shortid','toString','addWarning','22dYCZZI','2945628FwSWBp','.json','object-sizeof','../../constants','fileName','@flosum/salesforce','file'];a315_0x2dc8=function(){return _0x541536;};return a315_0x2dc8();}function a315_0x9c0b(_0xf93e16,_0x2e0f92){const _0x595c02=a315_0x2dc8();return a315_0x9c0b=function(_0x55d868,_0x5414ab){_0x55d868=_0x55d868-0xea;let _0x2dc89d=_0x595c02[_0x55d868];return _0x2dc89d;},a315_0x9c0b(_0xf93e16,_0x2e0f92);}const salesforce_1=require(a315_0x3a632e(0xf2)),manifest_manger_1=__importDefault(require('./manifest-manger')),path_1=__importDefault(require(a315_0x3a632e(0xfb))),promises_1=require('fs/promises'),fs_utils_1=require(a315_0x3a632e(0x116)),object_sizeof_1=__importDefault(require(a315_0x3a632e(0xef))),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a315_0x3a632e(0x11b)),constants_1=require(a315_0x3a632e(0xf0)),shortid_1=__importDefault(require(a315_0x3a632e(0x11c))),jszip_1=__importDefault(require(a315_0x3a632e(0x10e)));class RetrieveMetadata{constructor(_0x4ea93a,_0x22facc,_0x1655e3){const _0x15bda4=a315_0x3a632e;this[_0x15bda4(0xfe)]=_0x4ea93a,this['logger']=_0x22facc,this['stateManager']=_0x1655e3,this[_0x15bda4(0xf5)]=path_1[_0x15bda4(0x111)][_0x15bda4(0x10f)](this['jobStorePath'],constants_1[_0x15bda4(0x10c)]),this[_0x15bda4(0xf9)]=path_1[_0x15bda4(0x111)][_0x15bda4(0x10f)](this[_0x15bda4(0xfe)],constants_1[_0x15bda4(0x115)]);}async[a315_0x3a632e(0xf6)](_0x35f24f){const _0x1ea5c0=a315_0x3a632e,_0x3cddee=(0x0,shortid_1[_0x1ea5c0(0x111)])();return await(0x0,promises_1[_0x1ea5c0(0x103)])(path_1[_0x1ea5c0(0x111)]['join'](this[_0x1ea5c0(0xf5)],_0x3cddee+_0x1ea5c0(0xee)),JSON[_0x1ea5c0(0x106)](_0x35f24f)),_0x3cddee;}async['execute'](){const _0x9d3d1c=a315_0x3a632e,{credentials:_0x1b6780,declarativeFilter:_0xd14fae,metadataTypes:_0x21764d,maxChunkSize:_0x221949,maxChunkItems:_0x3f1ca1,apiVersion:_0x5af694}=await new manifest_manger_1[(_0x9d3d1c(0x111))](this['jobStorePath'])['init'](),_0x336dd5=await salesforce_1['AxiosInstanceUtils']['create'](new auth_manager_1[(_0x9d3d1c(0x108))](_0x1b6780),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x40272f=await retrieve_factory_1[_0x9d3d1c(0x111)][_0x9d3d1c(0x10a)](_0x336dd5,this['logger'],_0xd14fae,_0x21764d,_0x5af694)['execute']();await(0x0,fs_utils_1[_0x9d3d1c(0xfd)])(this['metadataFolder']);let _0x24e209=[];const _0x4808dc=[];let _0x42572c=0x0;for(const _0x1df33f in _0x40272f[_0x9d3d1c(0x119)]){for(const {listMetadataItem:_0x2098cf,files:_0x36d6e1}of _0x40272f['items'][_0x1df33f]['components']){const _0x559403=new jszip_1[(_0x9d3d1c(0x111))]();for(const _0x36746c in _0x36d6e1){await _0x559403[_0x9d3d1c(0xf3)](_0x36746c,_0x36d6e1[_0x36746c]);}const _0x52a8fc=await _0x559403[_0x9d3d1c(0xff)]({'type':_0x9d3d1c(0x10b),'compression':_0x9d3d1c(0xfa),'compressionOptions':{'level':0x9}}),_0x3e9849={..._0x2098cf,'zip':_0x52a8fc},_0x127ae2=(0x0,object_sizeof_1[_0x9d3d1c(0x111)])(_0x3e9849);if(_0x127ae2>_0x221949){await this[_0x9d3d1c(0x113)][_0x9d3d1c(0xeb)](_0x9d3d1c(0xfc)+_0x2098cf[_0x9d3d1c(0xf1)]+_0x9d3d1c(0x112)+_0x127ae2+_0x9d3d1c(0x104)+_0x221949+'\x27');continue;}if(_0x42572c+_0x127ae2>_0x221949||_0x24e209['length']>=_0x3f1ca1){const _0x4267b7=await this[_0x9d3d1c(0xf6)](_0x24e209);_0x4808dc['push'](_0x4267b7),_0x42572c=0x0,_0x24e209=[];}_0x24e209['push'](_0x3e9849),_0x42572c+=_0x127ae2;}}if(_0x24e209[_0x9d3d1c(0x101)]){const _0x3f202f=await this['writeChunk'](_0x24e209);_0x4808dc['push'](_0x3f202f);}await(0x0,promises_1['writeFile'])(this[_0x9d3d1c(0xf9)],JSON['stringify'](_0x4808dc));}}exports[a315_0x3a632e(0x111)]=RetrieveMetadata;