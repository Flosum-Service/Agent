const a267_0x3f6100=a267_0x5645;(function(_0x3f0328,_0x5cb74c){const _0x4af59d=a267_0x5645,_0x512600=_0x3f0328();while(!![]){try{const _0x54d9b2=parseInt(_0x4af59d(0x1e1))/0x1+parseInt(_0x4af59d(0x1d6))/0x2+parseInt(_0x4af59d(0x1d8))/0x3*(-parseInt(_0x4af59d(0x1e3))/0x4)+parseInt(_0x4af59d(0x1ed))/0x5+parseInt(_0x4af59d(0x1df))/0x6*(-parseInt(_0x4af59d(0x1c5))/0x7)+parseInt(_0x4af59d(0x1ea))/0x8*(-parseInt(_0x4af59d(0x1cb))/0x9)+-parseInt(_0x4af59d(0x1eb))/0xa;if(_0x54d9b2===_0x5cb74c)break;else _0x512600['push'](_0x512600['shift']());}catch(_0x5599a7){_0x512600['push'](_0x512600['shift']());}}}(a267_0x1007,0x53af2));const a267_0x4c154d=(function(){let _0x17b3bc=!![];return function(_0xb22933,_0x473387){const _0x2295bd=_0x17b3bc?function(){if(_0x473387){const _0x51c775=_0x473387['apply'](_0xb22933,arguments);return _0x473387=null,_0x51c775;}}:function(){};return _0x17b3bc=![],_0x2295bd;};}()),a267_0x3a083d=a267_0x4c154d(this,function(){const _0x27e12e=a267_0x5645;return a267_0x3a083d[_0x27e12e(0x1e8)]()['search']('(((.+)+)+)+$')[_0x27e12e(0x1e8)]()[_0x27e12e(0x1e7)](a267_0x3a083d)[_0x27e12e(0x1d0)]('(((.+)+)+)+$');});a267_0x3a083d();'use strict';var __importDefault=this&&this[a267_0x3f6100(0x1e5)]||function(_0x1f02c4){return _0x1f02c4&&_0x1f02c4['__esModule']?_0x1f02c4:{'default':_0x1f02c4};};function a267_0x5645(_0x532c8a,_0x2bf88c){const _0x304e65=a267_0x1007();return a267_0x5645=function(_0x3a083d,_0x4c154d){_0x3a083d=_0x3a083d-0x1c2;let _0x100731=_0x304e65[_0x3a083d];return _0x100731;},a267_0x5645(_0x532c8a,_0x2bf88c);}Object[a267_0x3f6100(0x1ce)](exports,a267_0x3f6100(0x1cc),{'value':!![]});function a267_0x1007(){const _0x519e3a=['__importDefault','items','constructor','toString','join','112oMBZvo','590920BXCyDM','../../constants','3232610sfhqKq','logger','create','RETRIEVE_RESULT_FOLDER_NAME','DEFLATE','215873DHFQGL','writeChunk','shortid','RETRIEVE_RESULTS_IDS_FILENAME','path','object-sizeof','18567JQBEFV','__esModule','AxiosInstanceUtils','defineProperty','push','search','jszip','stateManager','stringify','./retrieve-factory','\x27\x20exceed\x20limit\x20\x27','1080560Kdzonm','addWarning','1428321SqgNDj','default','fileName','file','writeFile','metadataFolder','AuthManager','84FKgwSG','execute','151795wIyWER','fs/promises','4iUnqid','jobStorePath'];a267_0x1007=function(){return _0x519e3a;};return a267_0x1007();}const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require('./manifest-manger')),path_1=__importDefault(require(a267_0x3f6100(0x1c9))),promises_1=require(a267_0x3f6100(0x1e2)),fs_utils_1=require('../../../shared/utils/fs.utils'),object_sizeof_1=__importDefault(require(a267_0x3f6100(0x1ca))),retrieve_factory_1=__importDefault(require(a267_0x3f6100(0x1d4))),auth_manager_1=require('../../../shared/managers/auth.manager'),constants_1=require(a267_0x3f6100(0x1ec)),shortid_1=__importDefault(require(a267_0x3f6100(0x1c7))),jszip_1=__importDefault(require(a267_0x3f6100(0x1d1)));class RetrieveMetadata{constructor(_0xfe92d4,_0x497092,_0x195613){const _0x46abcd=a267_0x3f6100;this[_0x46abcd(0x1e4)]=_0xfe92d4,this[_0x46abcd(0x1ee)]=_0x497092,this[_0x46abcd(0x1d2)]=_0x195613,this[_0x46abcd(0x1dd)]=path_1[_0x46abcd(0x1d9)][_0x46abcd(0x1e9)](this[_0x46abcd(0x1e4)],constants_1[_0x46abcd(0x1c3)]),this['retrieveResultsPath']=path_1[_0x46abcd(0x1d9)]['join'](this['jobStorePath'],constants_1[_0x46abcd(0x1c8)]);}async[a267_0x3f6100(0x1c6)](_0x1a01c8){const _0x3ad9d0=a267_0x3f6100,_0x426e4a=(0x0,shortid_1[_0x3ad9d0(0x1d9)])();return await(0x0,promises_1[_0x3ad9d0(0x1dc)])(path_1[_0x3ad9d0(0x1d9)][_0x3ad9d0(0x1e9)](this[_0x3ad9d0(0x1dd)],_0x426e4a+'.json'),JSON[_0x3ad9d0(0x1d3)](_0x1a01c8)),_0x426e4a;}async[a267_0x3f6100(0x1e0)](){const _0x55739b=a267_0x3f6100,{credentials:_0x55f30d,declarativeFilter:_0x3f0442,maxChunkSize:_0x29a920,maxChunkItems:_0x8cea3b,apiVersion:_0x4262d8}=await new manifest_manger_1[(_0x55739b(0x1d9))](this[_0x55739b(0x1e4)])['init'](),_0x2eb0be=await salesforce_1[_0x55739b(0x1cd)][_0x55739b(0x1c2)](new auth_manager_1[(_0x55739b(0x1de))](_0x55f30d),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x515ff3=await retrieve_factory_1[_0x55739b(0x1d9)][_0x55739b(0x1c2)](_0x2eb0be,this[_0x55739b(0x1ee)],_0x3f0442,_0x4262d8)[_0x55739b(0x1e0)]();await(0x0,fs_utils_1['makeDir'])(this[_0x55739b(0x1dd)]);let _0x20d7c6=[];const _0x4220a3=[];let _0x5ca1c4=0x0;for(const _0x380693 in _0x515ff3[_0x55739b(0x1e6)]){for(const {listMetadataItem:_0x5df968,files:_0x4d46e1}of _0x515ff3[_0x55739b(0x1e6)][_0x380693]['components']){const _0x959495=new jszip_1[(_0x55739b(0x1d9))]();for(const _0x1cd383 in _0x4d46e1){await _0x959495[_0x55739b(0x1db)](_0x1cd383,_0x4d46e1[_0x1cd383]);}const _0x1147a6=await _0x959495['generateAsync']({'type':'base64','compression':_0x55739b(0x1c4),'compressionOptions':{'level':0x9}}),_0x1e8075={..._0x5df968,'zip':_0x1147a6},_0x1eb7da=(0x0,object_sizeof_1[_0x55739b(0x1d9)])(_0x1e8075);if(_0x1eb7da>_0x29a920){await this['stateManager'][_0x55739b(0x1d7)]('Item\x20\x27'+_0x5df968[_0x55739b(0x1da)]+'\x27\x20size\x20\x27'+_0x1eb7da+_0x55739b(0x1d5)+_0x29a920+'\x27');continue;}if(_0x5ca1c4+_0x1eb7da>_0x29a920||_0x20d7c6['length']>=_0x8cea3b){const _0x29b756=await this[_0x55739b(0x1c6)](_0x20d7c6);_0x4220a3[_0x55739b(0x1cf)](_0x29b756),_0x5ca1c4=0x0,_0x20d7c6=[];}_0x20d7c6[_0x55739b(0x1cf)](_0x1e8075),_0x5ca1c4+=_0x1eb7da;}}if(_0x20d7c6['length']){const _0x27fd5d=await this['writeChunk'](_0x20d7c6);_0x4220a3['push'](_0x27fd5d);}await(0x0,promises_1['writeFile'])(this['retrieveResultsPath'],JSON[_0x55739b(0x1d3)](_0x4220a3));}}exports[a267_0x3f6100(0x1d9)]=RetrieveMetadata;