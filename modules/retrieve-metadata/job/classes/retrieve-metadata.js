const a316_0x2e2650=a316_0x44f6;(function(_0x44b1c3,_0x4ba00d){const _0x42b2ee=a316_0x44f6,_0x1e3bca=_0x44b1c3();while(!![]){try{const _0x550649=-parseInt(_0x42b2ee(0x8b))/0x1+parseInt(_0x42b2ee(0x82))/0x2+-parseInt(_0x42b2ee(0x6e))/0x3+parseInt(_0x42b2ee(0x84))/0x4+parseInt(_0x42b2ee(0x87))/0x5+-parseInt(_0x42b2ee(0x7a))/0x6*(parseInt(_0x42b2ee(0x9b))/0x7)+-parseInt(_0x42b2ee(0x78))/0x8*(-parseInt(_0x42b2ee(0x98))/0x9);if(_0x550649===_0x4ba00d)break;else _0x1e3bca['push'](_0x1e3bca['shift']());}catch(_0x5ecc8b){_0x1e3bca['push'](_0x1e3bca['shift']());}}}(a316_0x6098,0x1ede1));const a316_0x3ce795=(function(){let _0x434f23=!![];return function(_0x1b12fd,_0x253542){const _0x2b063e=_0x434f23?function(){if(_0x253542){const _0x353f78=_0x253542['apply'](_0x1b12fd,arguments);return _0x253542=null,_0x353f78;}}:function(){};return _0x434f23=![],_0x2b063e;};}()),a316_0xd5b03=a316_0x3ce795(this,function(){const _0x4c03f7=a316_0x44f6;return a316_0xd5b03[_0x4c03f7(0x90)]()[_0x4c03f7(0x71)]('(((.+)+)+)+$')[_0x4c03f7(0x90)]()[_0x4c03f7(0x74)](a316_0xd5b03)[_0x4c03f7(0x71)](_0x4c03f7(0x8a));});a316_0xd5b03();function a316_0x44f6(_0x1ca18f,_0x5168a1){const _0x121d27=a316_0x6098();return a316_0x44f6=function(_0xd5b03,_0x3ce795){_0xd5b03=_0xd5b03-0x6e;let _0x6098e3=_0x121d27[_0xd5b03];return _0x6098e3;},a316_0x44f6(_0x1ca18f,_0x5168a1);}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x20afec){const _0xcff18e=a316_0x44f6;return _0x20afec&&_0x20afec[_0xcff18e(0x77)]?_0x20afec:{'default':_0x20afec};};Object[a316_0x2e2650(0x83)](exports,'__esModule',{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a316_0x2e2650(0x99))),path_1=__importDefault(require(a316_0x2e2650(0x92))),promises_1=require('fs/promises'),fs_utils_1=require(a316_0x2e2650(0x70)),object_sizeof_1=__importDefault(require('object-sizeof')),retrieve_factory_1=__importDefault(require(a316_0x2e2650(0x89))),auth_manager_1=require('../../../shared/managers/auth.manager'),constants_1=require(a316_0x2e2650(0x9c)),shortid_1=__importDefault(require(a316_0x2e2650(0x79))),jszip_1=__importDefault(require(a316_0x2e2650(0x75)));class RetrieveMetadata{constructor(_0x2e8e32,_0x273361,_0x14fb97){const _0xb614f2=a316_0x2e2650;this[_0xb614f2(0x80)]=_0x2e8e32,this[_0xb614f2(0x96)]=_0x273361,this['stateManager']=_0x14fb97,this[_0xb614f2(0x94)]=path_1['default']['join'](this[_0xb614f2(0x80)],constants_1['RETRIEVE_RESULT_FOLDER_NAME']),this[_0xb614f2(0x7d)]=path_1['default'][_0xb614f2(0x93)](this[_0xb614f2(0x80)],constants_1[_0xb614f2(0x72)]);}async['writeChunk'](_0x5b0263){const _0x8cb1d9=a316_0x2e2650,_0x536d1f=(0x0,shortid_1[_0x8cb1d9(0x95)])();return await(0x0,promises_1[_0x8cb1d9(0x8c)])(path_1[_0x8cb1d9(0x95)][_0x8cb1d9(0x93)](this[_0x8cb1d9(0x94)],_0x536d1f+'.json'),JSON[_0x8cb1d9(0x7c)](_0x5b0263)),_0x536d1f;}async[a316_0x2e2650(0x9a)](){const _0x13f550=a316_0x2e2650,{credentials:_0x5c2f0a,declarativeFilter:_0x4063f3,metadataTypes:_0x376088,maxChunkSize:_0x5887b2,maxChunkItems:_0x4e664a,apiVersion:_0x1ce422}=await new manifest_manger_1[(_0x13f550(0x95))](this['jobStorePath'])[_0x13f550(0x85)](),_0x2dc780=await salesforce_1[_0x13f550(0x73)]['create'](new auth_manager_1[(_0x13f550(0x81))](_0x5c2f0a),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x3738f6=await retrieve_factory_1['default'][_0x13f550(0x6f)](_0x2dc780,this['logger'],_0x4063f3,_0x376088,_0x1ce422)[_0x13f550(0x9a)]();await(0x0,fs_utils_1[_0x13f550(0x7e)])(this[_0x13f550(0x94)]);let _0x4f2b73=[];const _0x2289af=[];let _0x32a6e9=0x0;for(const _0x14e0d5 in _0x3738f6['items']){for(const {listMetadataItem:_0x24e31e,files:_0x4ad0c9}of _0x3738f6[_0x13f550(0x88)][_0x14e0d5]['components']){const _0x496b30=new jszip_1[(_0x13f550(0x95))]();for(const _0x2d6462 in _0x4ad0c9){await _0x496b30[_0x13f550(0x8e)](_0x2d6462,_0x4ad0c9[_0x2d6462]);}const _0x31c4a4=await _0x496b30['generateAsync']({'type':_0x13f550(0x7b),'compression':'DEFLATE','compressionOptions':{'level':0x9}}),_0x1a837b={..._0x24e31e,'zip':_0x31c4a4},_0x17ce6c=(0x0,object_sizeof_1[_0x13f550(0x95)])(_0x1a837b);if(_0x17ce6c>_0x5887b2){await this[_0x13f550(0x9d)][_0x13f550(0x97)](_0x13f550(0x7f)+_0x24e31e['fileName']+_0x13f550(0x91)+_0x17ce6c+_0x13f550(0x8f)+_0x5887b2+'\x27');continue;}if(_0x32a6e9+_0x17ce6c>_0x5887b2||_0x4f2b73['length']>=_0x4e664a){const _0x3e69e8=await this['writeChunk'](_0x4f2b73);_0x2289af[_0x13f550(0x8d)](_0x3e69e8),_0x32a6e9=0x0,_0x4f2b73=[];}_0x4f2b73[_0x13f550(0x8d)](_0x1a837b),_0x32a6e9+=_0x17ce6c;}}if(_0x4f2b73[_0x13f550(0x76)]){const _0x113065=await this[_0x13f550(0x86)](_0x4f2b73);_0x2289af['push'](_0x113065);}await(0x0,promises_1[_0x13f550(0x8c)])(this[_0x13f550(0x7d)],JSON[_0x13f550(0x7c)](_0x2289af));}}exports[a316_0x2e2650(0x95)]=RetrieveMetadata;function a316_0x6098(){const _0x45684=['logger','addWarning','307773DzsqVw','./manifest-manger','execute','1558732lFcKYD','../../constants','stateManager','457812lckzKS','create','../../../shared/utils/fs.utils','search','RETRIEVE_RESULTS_IDS_FILENAME','AxiosInstanceUtils','constructor','jszip','length','__esModule','56wfgobL','shortid','6pRAleg','base64','stringify','retrieveResultsPath','makeDir','Item\x20\x27','jobStorePath','AuthManager','263408rkzNWy','defineProperty','459700wQWgQW','init','writeChunk','319965GrdIdT','items','./retrieve-factory','(((.+)+)+)+$','48288vYZBrF','writeFile','push','file','\x27\x20exceed\x20limit\x20\x27','toString','\x27\x20size\x20\x27','path','join','metadataFolder','default'];a316_0x6098=function(){return _0x45684;};return a316_0x6098();}