const a316_0x50c4be=a316_0x1393;(function(_0xd5cbd8,_0x5d6886){const _0x4f9810=a316_0x1393,_0x35eb6f=_0xd5cbd8();while(!![]){try{const _0x313db3=-parseInt(_0x4f9810(0x1d2))/0x1*(parseInt(_0x4f9810(0x1d4))/0x2)+parseInt(_0x4f9810(0x202))/0x3*(-parseInt(_0x4f9810(0x1e2))/0x4)+-parseInt(_0x4f9810(0x1f5))/0x5*(-parseInt(_0x4f9810(0x1f9))/0x6)+-parseInt(_0x4f9810(0x1f4))/0x7+-parseInt(_0x4f9810(0x1f6))/0x8+-parseInt(_0x4f9810(0x1de))/0x9*(-parseInt(_0x4f9810(0x1eb))/0xa)+parseInt(_0x4f9810(0x1fa))/0xb;if(_0x313db3===_0x5d6886)break;else _0x35eb6f['push'](_0x35eb6f['shift']());}catch(_0x2ced3a){_0x35eb6f['push'](_0x35eb6f['shift']());}}}(a316_0x2908,0xead87));const a316_0x131a9e=(function(){let _0x2b23f9=!![];return function(_0x537926,_0x2541e8){const _0x4bd654=_0x2b23f9?function(){const _0x2685cd=a316_0x1393;if(_0x2541e8){const _0x2212cd=_0x2541e8[_0x2685cd(0x1f3)](_0x537926,arguments);return _0x2541e8=null,_0x2212cd;}}:function(){};return _0x2b23f9=![],_0x4bd654;};}()),a316_0x3be595=a316_0x131a9e(this,function(){const _0x794bd6=a316_0x1393;return a316_0x3be595['toString']()[_0x794bd6(0x1ef)](_0x794bd6(0x1db))['toString']()[_0x794bd6(0x1e1)](a316_0x3be595)[_0x794bd6(0x1ef)](_0x794bd6(0x1db));});a316_0x3be595();'use strict';var __importDefault=this&&this[a316_0x50c4be(0x1f8)]||function(_0xbb81fc){return _0xbb81fc&&_0xbb81fc['__esModule']?_0xbb81fc:{'default':_0xbb81fc};};function a316_0x2908(){const _0x30b83b=['32238lfTyPN','jobStorePath','46uLWQiW','execute','default','init','Item\x20\x27','file','AuthManager','(((.+)+)+)+$','AxiosInstanceUtils','DEFLATE','71721zvxUhc','retrieveResultsPath','../../../shared/managers/auth.manager','constructor','12yVmulP','.json','\x27\x20exceed\x20limit\x20\x27','defineProperty','logger','@flosum/salesforce','../../constants','\x27\x20size\x20\x27','items','850ZIwNFA','length','jszip','push','search','stateManager','stringify','base64','apply','549990jAgCgf','10SloZgZ','14386680twHnDM','fileName','__importDefault','2885490CHyetW','31047720DgarsA','writeFile','shortid','object-sizeof','join','components','RETRIEVE_RESULTS_IDS_FILENAME','./retrieve-factory','881409Bqfbql','writeChunk','addWarning','makeDir'];a316_0x2908=function(){return _0x30b83b;};return a316_0x2908();}Object[a316_0x50c4be(0x1e5)](exports,'__esModule',{'value':!![]});const salesforce_1=require(a316_0x50c4be(0x1e7)),manifest_manger_1=__importDefault(require('./manifest-manger')),path_1=__importDefault(require('path')),promises_1=require('fs/promises'),fs_utils_1=require('../../../shared/utils/fs.utils'),object_sizeof_1=__importDefault(require(a316_0x50c4be(0x1fd))),retrieve_factory_1=__importDefault(require(a316_0x50c4be(0x201))),auth_manager_1=require(a316_0x50c4be(0x1e0)),constants_1=require(a316_0x50c4be(0x1e8)),shortid_1=__importDefault(require(a316_0x50c4be(0x1fc))),jszip_1=__importDefault(require(a316_0x50c4be(0x1ed)));class RetrieveMetadata{constructor(_0x37c4d5,_0x222752,_0x4e665a){const _0x4d4bb0=a316_0x50c4be;this[_0x4d4bb0(0x1d3)]=_0x37c4d5,this[_0x4d4bb0(0x1e6)]=_0x222752,this[_0x4d4bb0(0x1f0)]=_0x4e665a,this['metadataFolder']=path_1[_0x4d4bb0(0x1d6)][_0x4d4bb0(0x1fe)](this[_0x4d4bb0(0x1d3)],constants_1['RETRIEVE_RESULT_FOLDER_NAME']),this[_0x4d4bb0(0x1df)]=path_1[_0x4d4bb0(0x1d6)]['join'](this[_0x4d4bb0(0x1d3)],constants_1[_0x4d4bb0(0x200)]);}async[a316_0x50c4be(0x1cf)](_0x245267){const _0x40c8fb=a316_0x50c4be,_0x14412f=(0x0,shortid_1[_0x40c8fb(0x1d6)])();return await(0x0,promises_1[_0x40c8fb(0x1fb)])(path_1[_0x40c8fb(0x1d6)][_0x40c8fb(0x1fe)](this['metadataFolder'],_0x14412f+_0x40c8fb(0x1e3)),JSON[_0x40c8fb(0x1f1)](_0x245267)),_0x14412f;}async['execute'](){const _0x41c3cf=a316_0x50c4be,{credentials:_0x52e581,declarativeFilter:_0x5e1ef9,metadataTypes:_0x2ddea3,maxChunkSize:_0x56c36b,maxChunkItems:_0x4d73ba,apiVersion:_0x392bbf}=await new manifest_manger_1['default'](this['jobStorePath'])[_0x41c3cf(0x1d7)](),_0x245763=await salesforce_1[_0x41c3cf(0x1dc)]['create'](new auth_manager_1[(_0x41c3cf(0x1da))](_0x52e581),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x1a1927=await retrieve_factory_1[_0x41c3cf(0x1d6)]['create'](_0x245763,this[_0x41c3cf(0x1e6)],_0x5e1ef9,_0x2ddea3,_0x392bbf)[_0x41c3cf(0x1d5)]();await(0x0,fs_utils_1[_0x41c3cf(0x1d1)])(this['metadataFolder']);let _0x10679a=[];const _0x325605=[];let _0x4249ac=0x0;for(const _0x22de75 in _0x1a1927[_0x41c3cf(0x1ea)]){for(const {listMetadataItem:_0x11ab68,files:_0x5b7ae2}of _0x1a1927[_0x41c3cf(0x1ea)][_0x22de75][_0x41c3cf(0x1ff)]){const _0x50f0b2=new jszip_1[(_0x41c3cf(0x1d6))]();for(const _0x434e50 in _0x5b7ae2){await _0x50f0b2[_0x41c3cf(0x1d9)](_0x434e50,_0x5b7ae2[_0x434e50]);}const _0x59dfa0=await _0x50f0b2['generateAsync']({'type':_0x41c3cf(0x1f2),'compression':_0x41c3cf(0x1dd),'compressionOptions':{'level':0x9}}),_0x47020c={..._0x11ab68,'zip':_0x59dfa0},_0x13fd45=(0x0,object_sizeof_1[_0x41c3cf(0x1d6)])(_0x47020c);if(_0x13fd45>_0x56c36b){await this[_0x41c3cf(0x1f0)][_0x41c3cf(0x1d0)](_0x41c3cf(0x1d8)+_0x11ab68[_0x41c3cf(0x1f7)]+_0x41c3cf(0x1e9)+_0x13fd45+_0x41c3cf(0x1e4)+_0x56c36b+'\x27');continue;}if(_0x4249ac+_0x13fd45>_0x56c36b||_0x10679a[_0x41c3cf(0x1ec)]>=_0x4d73ba){const _0x2f90f8=await this['writeChunk'](_0x10679a);_0x325605[_0x41c3cf(0x1ee)](_0x2f90f8),_0x4249ac=0x0,_0x10679a=[];}_0x10679a['push'](_0x47020c),_0x4249ac+=_0x13fd45;}}if(_0x10679a[_0x41c3cf(0x1ec)]){const _0x13a9b7=await this['writeChunk'](_0x10679a);_0x325605[_0x41c3cf(0x1ee)](_0x13a9b7);}await(0x0,promises_1[_0x41c3cf(0x1fb)])(this[_0x41c3cf(0x1df)],JSON[_0x41c3cf(0x1f1)](_0x325605));}}function a316_0x1393(_0x410095,_0x3f54f4){const _0x475404=a316_0x2908();return a316_0x1393=function(_0x3be595,_0x131a9e){_0x3be595=_0x3be595-0x1cf;let _0x2908b0=_0x475404[_0x3be595];return _0x2908b0;},a316_0x1393(_0x410095,_0x3f54f4);}exports[a316_0x50c4be(0x1d6)]=RetrieveMetadata;