const a303_0x5ab3d9=a303_0xccba;(function(_0x43a37e,_0x204d9c){const _0x1b5032=a303_0xccba,_0x467b9b=_0x43a37e();while(!![]){try{const _0x7f17db=parseInt(_0x1b5032(0xf2))/0x1*(-parseInt(_0x1b5032(0x10f))/0x2)+parseInt(_0x1b5032(0xf4))/0x3*(-parseInt(_0x1b5032(0x10c))/0x4)+parseInt(_0x1b5032(0xe7))/0x5*(parseInt(_0x1b5032(0xe1))/0x6)+parseInt(_0x1b5032(0x110))/0x7+-parseInt(_0x1b5032(0xe5))/0x8*(-parseInt(_0x1b5032(0x106))/0x9)+parseInt(_0x1b5032(0xfa))/0xa*(-parseInt(_0x1b5032(0xf8))/0xb)+-parseInt(_0x1b5032(0xe0))/0xc*(-parseInt(_0x1b5032(0xff))/0xd);if(_0x7f17db===_0x204d9c)break;else _0x467b9b['push'](_0x467b9b['shift']());}catch(_0x46c4b7){_0x467b9b['push'](_0x467b9b['shift']());}}}(a303_0x144a,0xb8f05));function a303_0xccba(_0x59e30d,_0x375a50){const _0x4a4ec1=a303_0x144a();return a303_0xccba=function(_0xd534a0,_0x102b14){_0xd534a0=_0xd534a0-0xde;let _0x144a5d=_0x4a4ec1[_0xd534a0];return _0x144a5d;},a303_0xccba(_0x59e30d,_0x375a50);}function a303_0x144a(){const _0x5d13c4=['(((.+)+)+)+$','items','retrieveResultsPath','fs/promises','makeDir','Item\x20\x27','RETRIEVE_RESULTS_IDS_FILENAME','29508UOWGJx','254574IsLmzM','addWarning','\x27\x20size\x20\x27','create','8778184AQzDjs','search','50LPZFRJ','metadataFolder','object-sizeof','./retrieve-factory','push','execute','stateManager','defineProperty','shortid','file','../../../shared/managers/auth.manager','20FfhgJP','writeChunk','189hrjNDu','../../../shared/utils/fs.utils','join','jszip','264yjfeyL','logger','268050nJLIiL','apply','stringify','length','AuthManager','455SzSBBO','init','toString','fileName','__esModule','__importDefault','default','9PHlWGw','components','jobStorePath','base64','DEFLATE','\x27\x20exceed\x20limit\x20\x27','84884IPrtoS','generateAsync','RETRIEVE_RESULT_FOLDER_NAME','21348feCNai','9405228uZeUob'];a303_0x144a=function(){return _0x5d13c4;};return a303_0x144a();}const a303_0x102b14=(function(){let _0xa7b842=!![];return function(_0x25567d,_0x2f8464){const _0x1537e2=_0xa7b842?function(){const _0x32b6ae=a303_0xccba;if(_0x2f8464){const _0xcc33e9=_0x2f8464[_0x32b6ae(0xfb)](_0x25567d,arguments);return _0x2f8464=null,_0xcc33e9;}}:function(){};return _0xa7b842=![],_0x1537e2;};}()),a303_0xd534a0=a303_0x102b14(this,function(){const _0x277f43=a303_0xccba;return a303_0xd534a0[_0x277f43(0x101)]()[_0x277f43(0xe6)]('(((.+)+)+)+$')[_0x277f43(0x101)]()['constructor'](a303_0xd534a0)[_0x277f43(0xe6)](_0x277f43(0x111));});a303_0xd534a0();'use strict';var __importDefault=this&&this[a303_0x5ab3d9(0x104)]||function(_0x52b3bd){return _0x52b3bd&&_0x52b3bd['__esModule']?_0x52b3bd:{'default':_0x52b3bd};};Object[a303_0x5ab3d9(0xee)](exports,a303_0x5ab3d9(0x103),{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require('./manifest-manger')),path_1=__importDefault(require('path')),promises_1=require(a303_0x5ab3d9(0x114)),fs_utils_1=require(a303_0x5ab3d9(0xf5)),object_sizeof_1=__importDefault(require(a303_0x5ab3d9(0xe9))),retrieve_factory_1=__importDefault(require(a303_0x5ab3d9(0xea))),auth_manager_1=require(a303_0x5ab3d9(0xf1)),constants_1=require('../../constants'),shortid_1=__importDefault(require(a303_0x5ab3d9(0xef))),jszip_1=__importDefault(require(a303_0x5ab3d9(0xf7)));class RetrieveMetadata{constructor(_0x4b95d6,_0xa17cbc,_0x4d6bbe){const _0x26c629=a303_0x5ab3d9;this[_0x26c629(0x108)]=_0x4b95d6,this['logger']=_0xa17cbc,this[_0x26c629(0xed)]=_0x4d6bbe,this['metadataFolder']=path_1[_0x26c629(0x105)][_0x26c629(0xf6)](this[_0x26c629(0x108)],constants_1[_0x26c629(0x10e)]),this['retrieveResultsPath']=path_1[_0x26c629(0x105)][_0x26c629(0xf6)](this[_0x26c629(0x108)],constants_1[_0x26c629(0xdf)]);}async[a303_0x5ab3d9(0xf3)](_0x1c53a7){const _0x1c4699=a303_0x5ab3d9,_0x25f006=(0x0,shortid_1[_0x1c4699(0x105)])();return await(0x0,promises_1['writeFile'])(path_1['default'][_0x1c4699(0xf6)](this[_0x1c4699(0xe8)],_0x25f006+'.json'),JSON[_0x1c4699(0xfc)](_0x1c53a7)),_0x25f006;}async[a303_0x5ab3d9(0xec)](){const _0xd16ae1=a303_0x5ab3d9,{credentials:_0x54fcd8,declarativeFilter:_0xe100d7,metadataTypes:_0x85b77a,maxChunkSize:_0x187ead,maxChunkItems:_0x389411,apiVersion:_0x454a8d}=await new manifest_manger_1['default'](this[_0xd16ae1(0x108)])[_0xd16ae1(0x100)](),_0x16afde=await salesforce_1['AxiosInstanceUtils']['create'](new auth_manager_1[(_0xd16ae1(0xfe))](_0x54fcd8),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x1300cd=await retrieve_factory_1[_0xd16ae1(0x105)][_0xd16ae1(0xe4)](_0x16afde,this[_0xd16ae1(0xf9)],_0xe100d7,_0x85b77a,_0x454a8d)[_0xd16ae1(0xec)]();await(0x0,fs_utils_1[_0xd16ae1(0x115)])(this[_0xd16ae1(0xe8)]);let _0x58d99a=[];const _0xb6d7e2=[];let _0x5365ff=0x0;for(const _0x46991b in _0x1300cd[_0xd16ae1(0x112)]){for(const {listMetadataItem:_0x2d9fbb,files:_0xf5fc79}of _0x1300cd[_0xd16ae1(0x112)][_0x46991b][_0xd16ae1(0x107)]){const _0x53b89b=new jszip_1[(_0xd16ae1(0x105))]();for(const _0x593c74 in _0xf5fc79){await _0x53b89b[_0xd16ae1(0xf0)](_0x593c74,_0xf5fc79[_0x593c74]);}const _0x5518d1=await _0x53b89b[_0xd16ae1(0x10d)]({'type':_0xd16ae1(0x109),'compression':_0xd16ae1(0x10a),'compressionOptions':{'level':0x9}}),_0x1195ad={..._0x2d9fbb,'zip':_0x5518d1},_0x2f532d=(0x0,object_sizeof_1['default'])(_0x1195ad);if(_0x2f532d>_0x187ead){await this[_0xd16ae1(0xed)][_0xd16ae1(0xe2)](_0xd16ae1(0xde)+_0x2d9fbb[_0xd16ae1(0x102)]+_0xd16ae1(0xe3)+_0x2f532d+_0xd16ae1(0x10b)+_0x187ead+'\x27');continue;}if(_0x5365ff+_0x2f532d>_0x187ead||_0x58d99a[_0xd16ae1(0xfd)]>=_0x389411){const _0x15d1c6=await this[_0xd16ae1(0xf3)](_0x58d99a);_0xb6d7e2['push'](_0x15d1c6),_0x5365ff=0x0,_0x58d99a=[];}_0x58d99a[_0xd16ae1(0xeb)](_0x1195ad),_0x5365ff+=_0x2f532d;}}if(_0x58d99a['length']){const _0x52df93=await this[_0xd16ae1(0xf3)](_0x58d99a);_0xb6d7e2[_0xd16ae1(0xeb)](_0x52df93);}await(0x0,promises_1['writeFile'])(this[_0xd16ae1(0x113)],JSON[_0xd16ae1(0xfc)](_0xb6d7e2));}}exports[a303_0x5ab3d9(0x105)]=RetrieveMetadata;