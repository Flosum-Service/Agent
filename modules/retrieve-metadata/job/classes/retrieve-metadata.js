const a304_0x28357b=a304_0x59d9;(function(_0x32410e,_0x22f34d){const _0x8ff085=a304_0x59d9,_0x5d7fb6=_0x32410e();while(!![]){try{const _0x8f2f00=parseInt(_0x8ff085(0xe0))/0x1+-parseInt(_0x8ff085(0xd1))/0x2+parseInt(_0x8ff085(0xe1))/0x3*(-parseInt(_0x8ff085(0xb3))/0x4)+parseInt(_0x8ff085(0xbe))/0x5*(parseInt(_0x8ff085(0xbf))/0x6)+parseInt(_0x8ff085(0xb5))/0x7*(-parseInt(_0x8ff085(0xd8))/0x8)+parseInt(_0x8ff085(0xc8))/0x9+-parseInt(_0x8ff085(0xb8))/0xa*(-parseInt(_0x8ff085(0xd9))/0xb);if(_0x8f2f00===_0x22f34d)break;else _0x5d7fb6['push'](_0x5d7fb6['shift']());}catch(_0x3ffd05){_0x5d7fb6['push'](_0x5d7fb6['shift']());}}}(a304_0x4803,0xeeb83));function a304_0x4803(){const _0x4e0462=['../../../shared/managers/auth.manager','file','fs/promises','writeChunk','.json','(((.+)+)+)+$','6844UVNMoz','create','default','generateAsync','defineProperty','init','path','4586840XWCsiO','22fkGGWz','RETRIEVE_RESULT_FOLDER_NAME','../../../shared/utils/fs.utils','items','jszip','object-sizeof','stateManager','413768Dsrmro','3CFvTBo','metadataFolder','toString','AxiosInstanceUtils','__esModule','apply','retrieveResultsPath','2158580OXCrMJ','length','7GAwssy','jobStorePath','fileName','707450vpFBzD','\x27\x20size\x20\x27','\x27\x20exceed\x20limit\x20\x27','AuthManager','join','./manifest-manger','5Tsumuz','9090948CIoyuy','execute','shortid','../../constants','makeDir','logger','constructor','push','search','214209ZQVCAW','addWarning','base64'];a304_0x4803=function(){return _0x4e0462;};return a304_0x4803();}function a304_0x59d9(_0x3c5148,_0x201214){const _0x3b4de2=a304_0x4803();return a304_0x59d9=function(_0x16c0bf,_0xd3327f){_0x16c0bf=_0x16c0bf-0xb2;let _0x4803ff=_0x3b4de2[_0x16c0bf];return _0x4803ff;},a304_0x59d9(_0x3c5148,_0x201214);}const a304_0xd3327f=(function(){let _0x4f5d2f=!![];return function(_0x2c9018,_0x43a1ba){const _0x1756dd=_0x4f5d2f?function(){const _0x14c8a1=a304_0x59d9;if(_0x43a1ba){const _0x3dbc07=_0x43a1ba[_0x14c8a1(0xe6)](_0x2c9018,arguments);return _0x43a1ba=null,_0x3dbc07;}}:function(){};return _0x4f5d2f=![],_0x1756dd;};}()),a304_0x16c0bf=a304_0xd3327f(this,function(){const _0x3aa899=a304_0x59d9;return a304_0x16c0bf['toString']()[_0x3aa899(0xc7)](_0x3aa899(0xd0))[_0x3aa899(0xe3)]()[_0x3aa899(0xc5)](a304_0x16c0bf)[_0x3aa899(0xc7)](_0x3aa899(0xd0));});a304_0x16c0bf();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x42f0ca){const _0x1f834c=a304_0x59d9;return _0x42f0ca&&_0x42f0ca[_0x1f834c(0xe5)]?_0x42f0ca:{'default':_0x42f0ca};};Object[a304_0x28357b(0xd5)](exports,a304_0x28357b(0xe5),{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a304_0x28357b(0xbd))),path_1=__importDefault(require(a304_0x28357b(0xd7))),promises_1=require(a304_0x28357b(0xcd)),fs_utils_1=require(a304_0x28357b(0xdb)),object_sizeof_1=__importDefault(require(a304_0x28357b(0xde))),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a304_0x28357b(0xcb)),constants_1=require(a304_0x28357b(0xc2)),shortid_1=__importDefault(require(a304_0x28357b(0xc1))),jszip_1=__importDefault(require(a304_0x28357b(0xdd)));class RetrieveMetadata{constructor(_0x353139,_0x54da95,_0x6e5be2){const _0x43ca89=a304_0x28357b;this['jobStorePath']=_0x353139,this['logger']=_0x54da95,this[_0x43ca89(0xdf)]=_0x6e5be2,this[_0x43ca89(0xe2)]=path_1[_0x43ca89(0xd3)]['join'](this[_0x43ca89(0xb6)],constants_1[_0x43ca89(0xda)]),this[_0x43ca89(0xb2)]=path_1[_0x43ca89(0xd3)][_0x43ca89(0xbc)](this[_0x43ca89(0xb6)],constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);}async[a304_0x28357b(0xce)](_0x5a3295){const _0x33ddd6=a304_0x28357b,_0x49ba62=(0x0,shortid_1[_0x33ddd6(0xd3)])();return await(0x0,promises_1['writeFile'])(path_1[_0x33ddd6(0xd3)][_0x33ddd6(0xbc)](this[_0x33ddd6(0xe2)],_0x49ba62+_0x33ddd6(0xcf)),JSON['stringify'](_0x5a3295)),_0x49ba62;}async[a304_0x28357b(0xc0)](){const _0x4bf22f=a304_0x28357b,{credentials:_0x3746ad,declarativeFilter:_0x553585,metadataTypes:_0x35c4b7,maxChunkSize:_0x149309,maxChunkItems:_0x3687c6,apiVersion:_0x212dc1}=await new manifest_manger_1[(_0x4bf22f(0xd3))](this[_0x4bf22f(0xb6)])[_0x4bf22f(0xd6)](),_0x316734=await salesforce_1[_0x4bf22f(0xe4)][_0x4bf22f(0xd2)](new auth_manager_1[(_0x4bf22f(0xbb))](_0x3746ad),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x45e424=await retrieve_factory_1[_0x4bf22f(0xd3)][_0x4bf22f(0xd2)](_0x316734,this[_0x4bf22f(0xc4)],_0x553585,_0x35c4b7,_0x212dc1)['execute']();await(0x0,fs_utils_1[_0x4bf22f(0xc3)])(this[_0x4bf22f(0xe2)]);let _0x338ff0=[];const _0x45af15=[];let _0x28ae85=0x0;for(const _0x40407e in _0x45e424['items']){for(const {listMetadataItem:_0x3b30d8,files:_0x167b74}of _0x45e424[_0x4bf22f(0xdc)][_0x40407e]['components']){const _0x38f66e=new jszip_1[(_0x4bf22f(0xd3))]();for(const _0x3ad8b0 in _0x167b74){await _0x38f66e[_0x4bf22f(0xcc)](_0x3ad8b0,_0x167b74[_0x3ad8b0]);}const _0x1fd12a=await _0x38f66e[_0x4bf22f(0xd4)]({'type':_0x4bf22f(0xca),'compression':'DEFLATE','compressionOptions':{'level':0x9}}),_0x726084={..._0x3b30d8,'zip':_0x1fd12a},_0x51d395=(0x0,object_sizeof_1[_0x4bf22f(0xd3)])(_0x726084);if(_0x51d395>_0x149309){await this[_0x4bf22f(0xdf)][_0x4bf22f(0xc9)]('Item\x20\x27'+_0x3b30d8[_0x4bf22f(0xb7)]+_0x4bf22f(0xb9)+_0x51d395+_0x4bf22f(0xba)+_0x149309+'\x27');continue;}if(_0x28ae85+_0x51d395>_0x149309||_0x338ff0[_0x4bf22f(0xb4)]>=_0x3687c6){const _0x4da12e=await this[_0x4bf22f(0xce)](_0x338ff0);_0x45af15['push'](_0x4da12e),_0x28ae85=0x0,_0x338ff0=[];}_0x338ff0[_0x4bf22f(0xc6)](_0x726084),_0x28ae85+=_0x51d395;}}if(_0x338ff0['length']){const _0x19d618=await this[_0x4bf22f(0xce)](_0x338ff0);_0x45af15[_0x4bf22f(0xc6)](_0x19d618);}await(0x0,promises_1['writeFile'])(this[_0x4bf22f(0xb2)],JSON['stringify'](_0x45af15));}}exports['default']=RetrieveMetadata;