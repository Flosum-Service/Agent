const a267_0x443fd6=a267_0x4eda;(function(_0x3539bd,_0x53dc34){const _0x6ceb6f=a267_0x4eda,_0x49b106=_0x3539bd();while(!![]){try{const _0x230ca2=parseInt(_0x6ceb6f(0x201))/0x1+-parseInt(_0x6ceb6f(0x215))/0x2*(parseInt(_0x6ceb6f(0x205))/0x3)+parseInt(_0x6ceb6f(0x21f))/0x4*(parseInt(_0x6ceb6f(0x1fa))/0x5)+parseInt(_0x6ceb6f(0x1f7))/0x6+-parseInt(_0x6ceb6f(0x20a))/0x7+parseInt(_0x6ceb6f(0x200))/0x8*(-parseInt(_0x6ceb6f(0x1f0))/0x9)+-parseInt(_0x6ceb6f(0x21a))/0xa*(-parseInt(_0x6ceb6f(0x1fe))/0xb);if(_0x230ca2===_0x53dc34)break;else _0x49b106['push'](_0x49b106['shift']());}catch(_0x515ee6){_0x49b106['push'](_0x49b106['shift']());}}}(a267_0x5032,0x6ac51));const a267_0x4ff344=(function(){let _0x3dd82b=!![];return function(_0x5200f1,_0x37110b){const _0x4eff00=_0x3dd82b?function(){const _0x2019d8=a267_0x4eda;if(_0x37110b){const _0x40b6f9=_0x37110b[_0x2019d8(0x1f5)](_0x5200f1,arguments);return _0x37110b=null,_0x40b6f9;}}:function(){};return _0x3dd82b=![],_0x4eff00;};}()),a267_0x5656de=a267_0x4ff344(this,function(){const _0x25f47e=a267_0x4eda;return a267_0x5656de[_0x25f47e(0x20f)]()[_0x25f47e(0x20b)]('(((.+)+)+)+$')[_0x25f47e(0x20f)]()[_0x25f47e(0x206)](a267_0x5656de)[_0x25f47e(0x20b)](_0x25f47e(0x20e));});a267_0x5656de();'use strict';function a267_0x4eda(_0x2e8ff2,_0x5e346c){const _0x188d83=a267_0x5032();return a267_0x4eda=function(_0x5656de,_0x4ff344){_0x5656de=_0x5656de-0x1ed;let _0x50322a=_0x188d83[_0x5656de];return _0x50322a;},a267_0x4eda(_0x2e8ff2,_0x5e346c);}function a267_0x5032(){const _0x54a959=['4fQXoYP','../../constants','@flosum/salesforce','default','shortid','base64','3735SIrjfl','../../../shared/managers/auth.manager','stateManager','\x27\x20exceed\x20limit\x20\x27','fs/promises','apply','path','592248fUMqMi','writeFile','logger','554220pzqOFI','fileName','.json','__importDefault','55TQohFN','defineProperty','12088GVXaEg','788122FvIwaJ','object-sizeof','items','AuthManager','46908zXVMCX','constructor','execute','addWarning','jobStorePath','1132873dxKsBf','search','makeDir','push','(((.+)+)+)+$','toString','metadataFolder','jszip','join','\x27\x20size\x20\x27','writeChunk','32czGsSh','retrieveResultsPath','./manifest-manger','../../../shared/utils/fs.utils','Item\x20\x27','957470LTBJuh','stringify','__esModule','file','length'];a267_0x5032=function(){return _0x54a959;};return a267_0x5032();}var __importDefault=this&&this[a267_0x443fd6(0x1fd)]||function(_0xc90be2){const _0x57a5dc=a267_0x443fd6;return _0xc90be2&&_0xc90be2[_0x57a5dc(0x21c)]?_0xc90be2:{'default':_0xc90be2};};Object[a267_0x443fd6(0x1ff)](exports,a267_0x443fd6(0x21c),{'value':!![]});const salesforce_1=require(a267_0x443fd6(0x221)),manifest_manger_1=__importDefault(require(a267_0x443fd6(0x217))),path_1=__importDefault(require(a267_0x443fd6(0x1f6))),promises_1=require(a267_0x443fd6(0x1f4)),fs_utils_1=require(a267_0x443fd6(0x218)),object_sizeof_1=__importDefault(require(a267_0x443fd6(0x202))),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a267_0x443fd6(0x1f1)),constants_1=require(a267_0x443fd6(0x220)),shortid_1=__importDefault(require(a267_0x443fd6(0x1ee))),jszip_1=__importDefault(require(a267_0x443fd6(0x211)));class RetrieveMetadata{constructor(_0x2a3fbf,_0x527754,_0x3a76d9){const _0x2ef73f=a267_0x443fd6;this[_0x2ef73f(0x209)]=_0x2a3fbf,this['logger']=_0x527754,this[_0x2ef73f(0x1f2)]=_0x3a76d9,this[_0x2ef73f(0x210)]=path_1[_0x2ef73f(0x1ed)]['join'](this[_0x2ef73f(0x209)],constants_1['RETRIEVE_RESULT_FOLDER_NAME']),this[_0x2ef73f(0x216)]=path_1[_0x2ef73f(0x1ed)][_0x2ef73f(0x212)](this[_0x2ef73f(0x209)],constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);}async[a267_0x443fd6(0x214)](_0x413b3c){const _0x5bbde7=a267_0x443fd6,_0x5aa294=(0x0,shortid_1[_0x5bbde7(0x1ed)])();return await(0x0,promises_1[_0x5bbde7(0x1f8)])(path_1['default'][_0x5bbde7(0x212)](this['metadataFolder'],_0x5aa294+_0x5bbde7(0x1fc)),JSON[_0x5bbde7(0x21b)](_0x413b3c)),_0x5aa294;}async[a267_0x443fd6(0x207)](){const _0x14ce28=a267_0x443fd6,{credentials:_0xea5f3,declarativeFilter:_0x410f3f,metadataTypes:_0x5e6f0b,maxChunkSize:_0x45a19f,maxChunkItems:_0x503eb9,apiVersion:_0x580079}=await new manifest_manger_1[(_0x14ce28(0x1ed))](this[_0x14ce28(0x209)])['init'](),_0x144765=await salesforce_1['AxiosInstanceUtils']['create'](new auth_manager_1[(_0x14ce28(0x204))](_0xea5f3),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x9b54af=await retrieve_factory_1[_0x14ce28(0x1ed)]['create'](_0x144765,this[_0x14ce28(0x1f9)],_0x410f3f,_0x5e6f0b,_0x580079)['execute']();await(0x0,fs_utils_1[_0x14ce28(0x20c)])(this[_0x14ce28(0x210)]);let _0x1a2581=[];const _0x458ef9=[];let _0x2688c4=0x0;for(const _0x5dc6a9 in _0x9b54af[_0x14ce28(0x203)]){for(const {listMetadataItem:_0x5284f6,files:_0x156a93}of _0x9b54af[_0x14ce28(0x203)][_0x5dc6a9]['components']){const _0x2fe871=new jszip_1['default']();for(const _0x27f659 in _0x156a93){await _0x2fe871[_0x14ce28(0x21d)](_0x27f659,_0x156a93[_0x27f659]);}const _0x4f0235=await _0x2fe871['generateAsync']({'type':_0x14ce28(0x1ef),'compression':'DEFLATE','compressionOptions':{'level':0x9}}),_0x96cc2e={..._0x5284f6,'zip':_0x4f0235},_0x5334fe=(0x0,object_sizeof_1['default'])(_0x96cc2e);if(_0x5334fe>_0x45a19f){await this[_0x14ce28(0x1f2)][_0x14ce28(0x208)](_0x14ce28(0x219)+_0x5284f6[_0x14ce28(0x1fb)]+_0x14ce28(0x213)+_0x5334fe+_0x14ce28(0x1f3)+_0x45a19f+'\x27');continue;}if(_0x2688c4+_0x5334fe>_0x45a19f||_0x1a2581[_0x14ce28(0x21e)]>=_0x503eb9){const _0x4a6e8f=await this['writeChunk'](_0x1a2581);_0x458ef9['push'](_0x4a6e8f),_0x2688c4=0x0,_0x1a2581=[];}_0x1a2581['push'](_0x96cc2e),_0x2688c4+=_0x5334fe;}}if(_0x1a2581[_0x14ce28(0x21e)]){const _0x5e8fd2=await this[_0x14ce28(0x214)](_0x1a2581);_0x458ef9[_0x14ce28(0x20d)](_0x5e8fd2);}await(0x0,promises_1[_0x14ce28(0x1f8)])(this[_0x14ce28(0x216)],JSON[_0x14ce28(0x21b)](_0x458ef9));}}exports[a267_0x443fd6(0x1ed)]=RetrieveMetadata;