const a266_0x976a4d=a266_0x3523;function a266_0x27f2(){const _0x2ac3a1=['addWarning','stateManager','\x27\x20size\x20\x27','logger','2134880JmBgfi','push','9337563QZRrbE','retrieveResultsPath','218290VFuLHT','toString','2761240UtWGLx','length','writeChunk','jobStorePath','default','../../../shared/utils/fs.utils','18ZOlczB','generateAsync','.json','../../../shared/managers/auth.manager','base64','items','./retrieve-factory','components','file','apply','856mDgDgP','14RmcxOV','fileName','Item\x20\x27','7593hESeMh','stringify','(((.+)+)+)+$','fs/promises','search','execute','./manifest-manger','metadataFolder','join','DEFLATE','130CKXsbB','\x27\x20exceed\x20limit\x20\x27','__importDefault','4781032TlnKwU','defineProperty','43346ApfVHK','RETRIEVE_RESULTS_IDS_FILENAME','constructor','@flosum/salesforce','writeFile','AuthManager','makeDir','__esModule'];a266_0x27f2=function(){return _0x2ac3a1;};return a266_0x27f2();}(function(_0x489e18,_0x22c87c){const _0x251411=a266_0x3523,_0x316b71=_0x489e18();while(!![]){try{const _0x478505=-parseInt(_0x251411(0x206))/0x1+-parseInt(_0x251411(0x1f3))/0x2*(parseInt(_0x251411(0x1f7))/0x3)+-parseInt(_0x251411(0x218))/0x4+parseInt(_0x251411(0x216))/0x5*(parseInt(_0x251411(0x21e))/0x6)+parseInt(_0x251411(0x1f4))/0x7*(parseInt(_0x251411(0x204))/0x8)+-parseInt(_0x251411(0x214))/0x9+parseInt(_0x251411(0x201))/0xa*(parseInt(_0x251411(0x212))/0xb);if(_0x478505===_0x22c87c)break;else _0x316b71['push'](_0x316b71['shift']());}catch(_0x10ba72){_0x316b71['push'](_0x316b71['shift']());}}}(a266_0x27f2,0xf2e19));const a266_0x5240b0=(function(){let _0x25b3ae=!![];return function(_0x16b865,_0x5cf7d7){const _0x39a774=_0x25b3ae?function(){const _0xb848cc=a266_0x3523;if(_0x5cf7d7){const _0x4b9b41=_0x5cf7d7[_0xb848cc(0x1f2)](_0x16b865,arguments);return _0x5cf7d7=null,_0x4b9b41;}}:function(){};return _0x25b3ae=![],_0x39a774;};}()),a266_0x41bb7f=a266_0x5240b0(this,function(){const _0x3f003e=a266_0x3523;return a266_0x41bb7f['toString']()['search'](_0x3f003e(0x1f9))[_0x3f003e(0x217)]()[_0x3f003e(0x208)](a266_0x41bb7f)[_0x3f003e(0x1fb)]('(((.+)+)+)+$');});a266_0x41bb7f();'use strict';var __importDefault=this&&this[a266_0x976a4d(0x203)]||function(_0x5e1923){const _0x392eb3=a266_0x976a4d;return _0x5e1923&&_0x5e1923[_0x392eb3(0x20d)]?_0x5e1923:{'default':_0x5e1923};};function a266_0x3523(_0x451aba,_0x4d9f5f){const _0xaa7b99=a266_0x27f2();return a266_0x3523=function(_0x41bb7f,_0x5240b0){_0x41bb7f=_0x41bb7f-0x1eb;let _0x27f2cd=_0xaa7b99[_0x41bb7f];return _0x27f2cd;},a266_0x3523(_0x451aba,_0x4d9f5f);}Object[a266_0x976a4d(0x205)](exports,a266_0x976a4d(0x20d),{'value':!![]});const salesforce_1=require(a266_0x976a4d(0x209)),manifest_manger_1=__importDefault(require(a266_0x976a4d(0x1fd))),path_1=__importDefault(require('path')),promises_1=require(a266_0x976a4d(0x1fa)),fs_utils_1=require(a266_0x976a4d(0x21d)),object_sizeof_1=__importDefault(require('object-sizeof')),retrieve_factory_1=__importDefault(require(a266_0x976a4d(0x1ef))),auth_manager_1=require(a266_0x976a4d(0x1ec)),constants_1=require('../../constants'),shortid_1=__importDefault(require('shortid')),jszip_1=__importDefault(require('jszip'));class RetrieveMetadata{constructor(_0x516520,_0x29c207,_0x349015){const _0x49f397=a266_0x976a4d;this[_0x49f397(0x21b)]=_0x516520,this['logger']=_0x29c207,this['stateManager']=_0x349015,this[_0x49f397(0x1fe)]=path_1['default'][_0x49f397(0x1ff)](this[_0x49f397(0x21b)],constants_1['RETRIEVE_RESULT_FOLDER_NAME']),this[_0x49f397(0x215)]=path_1['default'][_0x49f397(0x1ff)](this[_0x49f397(0x21b)],constants_1[_0x49f397(0x207)]);}async[a266_0x976a4d(0x21a)](_0x7ae3e1){const _0x347ca7=a266_0x976a4d,_0x3f37c0=(0x0,shortid_1[_0x347ca7(0x21c)])();return await(0x0,promises_1['writeFile'])(path_1['default'][_0x347ca7(0x1ff)](this[_0x347ca7(0x1fe)],_0x3f37c0+_0x347ca7(0x1eb)),JSON['stringify'](_0x7ae3e1)),_0x3f37c0;}async['execute'](){const _0x96859a=a266_0x976a4d,{credentials:_0x523fbc,declarativeFilter:_0x44aaac,maxChunkSize:_0x4327c2,maxChunkItems:_0xe1499f,apiVersion:_0x3c94ea}=await new manifest_manger_1[(_0x96859a(0x21c))](this[_0x96859a(0x21b)])['init'](),_0x46a2de=await salesforce_1['AxiosInstanceUtils']['create'](new auth_manager_1[(_0x96859a(0x20b))](_0x523fbc),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x4ba847=await retrieve_factory_1['default']['create'](_0x46a2de,this[_0x96859a(0x211)],_0x44aaac,_0x3c94ea)[_0x96859a(0x1fc)]();await(0x0,fs_utils_1[_0x96859a(0x20c)])(this[_0x96859a(0x1fe)]);let _0xc59967=[];const _0x3d58b0=[];let _0x2067bc=0x0;for(const _0x163beb in _0x4ba847[_0x96859a(0x1ee)]){for(const {listMetadataItem:_0x4271e2,files:_0x3512b2}of _0x4ba847['items'][_0x163beb][_0x96859a(0x1f0)]){const _0x5c9d48=new jszip_1['default']();for(const _0x52cf8e in _0x3512b2){await _0x5c9d48[_0x96859a(0x1f1)](_0x52cf8e,_0x3512b2[_0x52cf8e]);}const _0x392710=await _0x5c9d48[_0x96859a(0x21f)]({'type':_0x96859a(0x1ed),'compression':_0x96859a(0x200),'compressionOptions':{'level':0x9}}),_0x228f6b={..._0x4271e2,'zip':_0x392710},_0x521266=(0x0,object_sizeof_1[_0x96859a(0x21c)])(_0x228f6b);if(_0x521266>_0x4327c2){await this[_0x96859a(0x20f)][_0x96859a(0x20e)](_0x96859a(0x1f6)+_0x4271e2[_0x96859a(0x1f5)]+_0x96859a(0x210)+_0x521266+_0x96859a(0x202)+_0x4327c2+'\x27');continue;}if(_0x2067bc+_0x521266>_0x4327c2||_0xc59967[_0x96859a(0x219)]>=_0xe1499f){const _0x228181=await this[_0x96859a(0x21a)](_0xc59967);_0x3d58b0[_0x96859a(0x213)](_0x228181),_0x2067bc=0x0,_0xc59967=[];}_0xc59967[_0x96859a(0x213)](_0x228f6b),_0x2067bc+=_0x521266;}}if(_0xc59967[_0x96859a(0x219)]){const _0x12ba0e=await this[_0x96859a(0x21a)](_0xc59967);_0x3d58b0[_0x96859a(0x213)](_0x12ba0e);}await(0x0,promises_1[_0x96859a(0x20a)])(this['retrieveResultsPath'],JSON[_0x96859a(0x1f8)](_0x3d58b0));}}exports['default']=RetrieveMetadata;