const a272_0x3e2b68=a272_0x1746;(function(_0x1caa04,_0x18d1ad){const _0x31b12d=a272_0x1746,_0x490c67=_0x1caa04();while(!![]){try{const _0x581749=parseInt(_0x31b12d(0x16a))/0x1+parseInt(_0x31b12d(0x171))/0x2+parseInt(_0x31b12d(0x168))/0x3+parseInt(_0x31b12d(0x16b))/0x4*(parseInt(_0x31b12d(0x182))/0x5)+parseInt(_0x31b12d(0x17e))/0x6*(-parseInt(_0x31b12d(0x16c))/0x7)+parseInt(_0x31b12d(0x18d))/0x8*(-parseInt(_0x31b12d(0x17c))/0x9)+-parseInt(_0x31b12d(0x187))/0xa;if(_0x581749===_0x18d1ad)break;else _0x490c67['push'](_0x490c67['shift']());}catch(_0xc93976){_0x490c67['push'](_0x490c67['shift']());}}}(a272_0x359f,0x253cd));const a272_0x3e555b=(function(){let _0x488f8b=!![];return function(_0x5cf5fa,_0xb936ca){const _0x1f4d1e=_0x488f8b?function(){if(_0xb936ca){const _0x3c5b4b=_0xb936ca['apply'](_0x5cf5fa,arguments);return _0xb936ca=null,_0x3c5b4b;}}:function(){};return _0x488f8b=![],_0x1f4d1e;};}()),a272_0xb1fbdd=a272_0x3e555b(this,function(){const _0x5c4b2f=a272_0x1746;return a272_0xb1fbdd['toString']()[_0x5c4b2f(0x16d)](_0x5c4b2f(0x180))[_0x5c4b2f(0x18e)]()['constructor'](a272_0xb1fbdd)[_0x5c4b2f(0x16d)]('(((.+)+)+)+$');});function a272_0x359f(){const _0x79be91=['retrieveResultsPath','@flosum/salesforce','shortid','file','9ZPoDEc','object-sizeof','516TGtKYd','items','(((.+)+)+)+$','logger','748530PtXZKD','push','Item\x20\x27','DEFLATE','makeDir','354480WqOoLA','AxiosInstanceUtils','base64','jobStorePath','writeFile','path','801352gjwdbu','toString','__importDefault','create','join','defineProperty','stateManager','RETRIEVE_RESULT_FOLDER_NAME','__esModule','generateAsync','metadataFolder','../../../shared/managers/auth.manager','./manifest-manger','349446rmvxHR','init','126293TRkhLL','8coIulA','22841yqbnZw','search','length','../../../shared/utils/fs.utils','execute','53146zONrqf','default','AuthManager','writeChunk','addWarning','components','RETRIEVE_RESULTS_IDS_FILENAME'];a272_0x359f=function(){return _0x79be91;};return a272_0x359f();}a272_0xb1fbdd();'use strict';var __importDefault=this&&this[a272_0x3e2b68(0x18f)]||function(_0x517c31){const _0x43d23c=a272_0x3e2b68;return _0x517c31&&_0x517c31[_0x43d23c(0x195)]?_0x517c31:{'default':_0x517c31};};Object[a272_0x3e2b68(0x192)](exports,a272_0x3e2b68(0x195),{'value':!![]});const salesforce_1=require(a272_0x3e2b68(0x179)),manifest_manger_1=__importDefault(require(a272_0x3e2b68(0x167))),path_1=__importDefault(require(a272_0x3e2b68(0x18c))),promises_1=require('fs/promises'),fs_utils_1=require(a272_0x3e2b68(0x16f)),object_sizeof_1=__importDefault(require(a272_0x3e2b68(0x17d))),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a272_0x3e2b68(0x166)),constants_1=require('../../constants'),shortid_1=__importDefault(require(a272_0x3e2b68(0x17a))),jszip_1=__importDefault(require('jszip'));class RetrieveMetadata{constructor(_0x320ac0,_0x32895e,_0x57b7de){const _0x1db554=a272_0x3e2b68;this['jobStorePath']=_0x320ac0,this[_0x1db554(0x181)]=_0x32895e,this[_0x1db554(0x193)]=_0x57b7de,this[_0x1db554(0x165)]=path_1[_0x1db554(0x172)]['join'](this[_0x1db554(0x18a)],constants_1[_0x1db554(0x194)]),this[_0x1db554(0x178)]=path_1['default'][_0x1db554(0x191)](this['jobStorePath'],constants_1[_0x1db554(0x177)]);}async[a272_0x3e2b68(0x174)](_0x389728){const _0x113fa2=a272_0x3e2b68,_0x24db31=(0x0,shortid_1[_0x113fa2(0x172)])();return await(0x0,promises_1['writeFile'])(path_1[_0x113fa2(0x172)][_0x113fa2(0x191)](this[_0x113fa2(0x165)],_0x24db31+'.json'),JSON['stringify'](_0x389728)),_0x24db31;}async[a272_0x3e2b68(0x170)](){const _0x21b7e3=a272_0x3e2b68,{credentials:_0x4b20ce,declarativeFilter:_0xbdb12b,metadataTypes:_0x2832e3,maxChunkSize:_0xf3ef3a,maxChunkItems:_0x262427,apiVersion:_0x3285f4}=await new manifest_manger_1[(_0x21b7e3(0x172))](this[_0x21b7e3(0x18a)])[_0x21b7e3(0x169)](),_0xf0e4e2=await salesforce_1[_0x21b7e3(0x188)][_0x21b7e3(0x190)](new auth_manager_1[(_0x21b7e3(0x173))](_0x4b20ce),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x242160=await retrieve_factory_1['default'][_0x21b7e3(0x190)](_0xf0e4e2,this['logger'],_0xbdb12b,_0x2832e3,_0x3285f4)[_0x21b7e3(0x170)]();await(0x0,fs_utils_1[_0x21b7e3(0x186)])(this['metadataFolder']);let _0xee44f8=[];const _0x45c109=[];let _0x550e4f=0x0;for(const _0x2b3b13 in _0x242160[_0x21b7e3(0x17f)]){for(const {listMetadataItem:_0x50c7fc,files:_0x507038}of _0x242160[_0x21b7e3(0x17f)][_0x2b3b13][_0x21b7e3(0x176)]){const _0x19bf8c=new jszip_1[(_0x21b7e3(0x172))]();for(const _0x1289fc in _0x507038){await _0x19bf8c[_0x21b7e3(0x17b)](_0x1289fc,_0x507038[_0x1289fc]);}const _0x3df464=await _0x19bf8c[_0x21b7e3(0x164)]({'type':_0x21b7e3(0x189),'compression':_0x21b7e3(0x185),'compressionOptions':{'level':0x9}}),_0x5ec985={..._0x50c7fc,'zip':_0x3df464},_0x59d80a=(0x0,object_sizeof_1[_0x21b7e3(0x172)])(_0x5ec985);if(_0x59d80a>_0xf3ef3a){await this['stateManager'][_0x21b7e3(0x175)](_0x21b7e3(0x184)+_0x50c7fc['fileName']+'\x27\x20size\x20\x27'+_0x59d80a+'\x27\x20exceed\x20limit\x20\x27'+_0xf3ef3a+'\x27');continue;}if(_0x550e4f+_0x59d80a>_0xf3ef3a||_0xee44f8['length']>=_0x262427){const _0x1bb8ed=await this[_0x21b7e3(0x174)](_0xee44f8);_0x45c109[_0x21b7e3(0x183)](_0x1bb8ed),_0x550e4f=0x0,_0xee44f8=[];}_0xee44f8['push'](_0x5ec985),_0x550e4f+=_0x59d80a;}}if(_0xee44f8[_0x21b7e3(0x16e)]){const _0x356d1e=await this['writeChunk'](_0xee44f8);_0x45c109['push'](_0x356d1e);}await(0x0,promises_1[_0x21b7e3(0x18b)])(this['retrieveResultsPath'],JSON['stringify'](_0x45c109));}}function a272_0x1746(_0x30cc91,_0x123003){const _0x5d0db6=a272_0x359f();return a272_0x1746=function(_0xb1fbdd,_0x3e555b){_0xb1fbdd=_0xb1fbdd-0x164;let _0x359f6c=_0x5d0db6[_0xb1fbdd];return _0x359f6c;},a272_0x1746(_0x30cc91,_0x123003);}exports[a272_0x3e2b68(0x172)]=RetrieveMetadata;