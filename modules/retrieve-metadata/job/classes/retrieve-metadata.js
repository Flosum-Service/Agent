const a314_0x36bdb9=a314_0x7776;(function(_0x49c34d,_0x2d5dc2){const _0x242b88=a314_0x7776,_0xf42b98=_0x49c34d();while(!![]){try{const _0xe607e4=-parseInt(_0x242b88(0x13f))/0x1*(parseInt(_0x242b88(0x158))/0x2)+parseInt(_0x242b88(0x140))/0x3+parseInt(_0x242b88(0x13a))/0x4*(parseInt(_0x242b88(0x135))/0x5)+-parseInt(_0x242b88(0x14c))/0x6+parseInt(_0x242b88(0x138))/0x7+-parseInt(_0x242b88(0x132))/0x8*(parseInt(_0x242b88(0x14e))/0x9)+-parseInt(_0x242b88(0x141))/0xa;if(_0xe607e4===_0x2d5dc2)break;else _0xf42b98['push'](_0xf42b98['shift']());}catch(_0x451d8a){_0xf42b98['push'](_0xf42b98['shift']());}}}(a314_0x13d5,0xa7f9a));const a314_0x4c8143=(function(){let _0x217032=!![];return function(_0x56f045,_0x187dbb){const _0x42c253=_0x217032?function(){if(_0x187dbb){const _0x337bf3=_0x187dbb['apply'](_0x56f045,arguments);return _0x187dbb=null,_0x337bf3;}}:function(){};return _0x217032=![],_0x42c253;};}()),a314_0x182a92=a314_0x4c8143(this,function(){const _0x17ea52=a314_0x7776;return a314_0x182a92[_0x17ea52(0x155)]()[_0x17ea52(0x148)](_0x17ea52(0x139))[_0x17ea52(0x155)]()[_0x17ea52(0x12f)](a314_0x182a92)['search'](_0x17ea52(0x139));});a314_0x182a92();'use strict';function a314_0x7776(_0x364c16,_0x1c34a0){const _0x48e29d=a314_0x13d5();return a314_0x7776=function(_0x182a92,_0x4c8143){_0x182a92=_0x182a92-0x12c;let _0x13d5bd=_0x48e29d[_0x182a92];return _0x13d5bd;},a314_0x7776(_0x364c16,_0x1c34a0);}var __importDefault=this&&this[a314_0x36bdb9(0x12d)]||function(_0x2d4d72){const _0x208158=a314_0x36bdb9;return _0x2d4d72&&_0x2d4d72[_0x208158(0x15c)]?_0x2d4d72:{'default':_0x2d4d72};};Object[a314_0x36bdb9(0x133)](exports,a314_0x36bdb9(0x15c),{'value':!![]});const salesforce_1=require(a314_0x36bdb9(0x146)),manifest_manger_1=__importDefault(require(a314_0x36bdb9(0x137))),path_1=__importDefault(require(a314_0x36bdb9(0x13e))),promises_1=require(a314_0x36bdb9(0x134)),fs_utils_1=require('../../../shared/utils/fs.utils'),object_sizeof_1=__importDefault(require(a314_0x36bdb9(0x149))),retrieve_factory_1=__importDefault(require(a314_0x36bdb9(0x157))),auth_manager_1=require(a314_0x36bdb9(0x12e)),constants_1=require('../../constants'),shortid_1=__importDefault(require(a314_0x36bdb9(0x13c))),jszip_1=__importDefault(require(a314_0x36bdb9(0x144)));function a314_0x13d5(){const _0x3b8dbc=['default','./retrieve-factory','36178rGqpxT','\x27\x20size\x20\x27','makeDir','stateManager','__esModule','push','__importDefault','../../../shared/managers/auth.manager','constructor','create','stringify','152oXxJES','defineProperty','fs/promises','3985UroMMq','execute','./manifest-manger','8745947bVkkWN','(((.+)+)+)+$','4748kVOlAI','items','shortid','logger','path','2kNeJIJ','2975613eedeeU','10892780vkDDLs','writeFile','writeChunk','jszip','.json','@flosum/salesforce','file','search','object-sizeof','RETRIEVE_RESULT_FOLDER_NAME','length','2522916grGRFF','base64','451593qKSkti','join','jobStorePath','init','generateAsync','metadataFolder','Item\x20\x27','toString'];a314_0x13d5=function(){return _0x3b8dbc;};return a314_0x13d5();}class RetrieveMetadata{constructor(_0x395c5d,_0x2d73ea,_0x41af7d){const _0xc2064=a314_0x36bdb9;this[_0xc2064(0x150)]=_0x395c5d,this[_0xc2064(0x13d)]=_0x2d73ea,this['stateManager']=_0x41af7d,this['metadataFolder']=path_1[_0xc2064(0x156)][_0xc2064(0x14f)](this[_0xc2064(0x150)],constants_1[_0xc2064(0x14a)]),this['retrieveResultsPath']=path_1[_0xc2064(0x156)][_0xc2064(0x14f)](this[_0xc2064(0x150)],constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);}async[a314_0x36bdb9(0x143)](_0x1c33ac){const _0x2207e8=a314_0x36bdb9,_0xe79971=(0x0,shortid_1['default'])();return await(0x0,promises_1[_0x2207e8(0x142)])(path_1[_0x2207e8(0x156)][_0x2207e8(0x14f)](this[_0x2207e8(0x153)],_0xe79971+_0x2207e8(0x145)),JSON[_0x2207e8(0x131)](_0x1c33ac)),_0xe79971;}async[a314_0x36bdb9(0x136)](){const _0x183146=a314_0x36bdb9,{credentials:_0x427df9,declarativeFilter:_0x34d685,metadataTypes:_0x2f068e,maxChunkSize:_0x2236d4,maxChunkItems:_0x3d3e46,apiVersion:_0x52e1e0}=await new manifest_manger_1[(_0x183146(0x156))](this[_0x183146(0x150)])[_0x183146(0x151)](),_0x3d5cbf=await salesforce_1['AxiosInstanceUtils'][_0x183146(0x130)](new auth_manager_1['AuthManager'](_0x427df9),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x50ed51=await retrieve_factory_1[_0x183146(0x156)][_0x183146(0x130)](_0x3d5cbf,this[_0x183146(0x13d)],_0x34d685,_0x2f068e,_0x52e1e0)['execute']();await(0x0,fs_utils_1[_0x183146(0x15a)])(this[_0x183146(0x153)]);let _0x9e68f8=[];const _0x2e8094=[];let _0x40210f=0x0;for(const _0x3bd654 in _0x50ed51[_0x183146(0x13b)]){for(const {listMetadataItem:_0x3a9534,files:_0x2cecdd}of _0x50ed51['items'][_0x3bd654]['components']){const _0x1a7a5f=new jszip_1[(_0x183146(0x156))]();for(const _0x287292 in _0x2cecdd){await _0x1a7a5f[_0x183146(0x147)](_0x287292,_0x2cecdd[_0x287292]);}const _0xce2e24=await _0x1a7a5f[_0x183146(0x152)]({'type':_0x183146(0x14d),'compression':'DEFLATE','compressionOptions':{'level':0x9}}),_0x4de704={..._0x3a9534,'zip':_0xce2e24},_0x9f9512=(0x0,object_sizeof_1['default'])(_0x4de704);if(_0x9f9512>_0x2236d4){await this[_0x183146(0x15b)]['addWarning'](_0x183146(0x154)+_0x3a9534['fileName']+_0x183146(0x159)+_0x9f9512+'\x27\x20exceed\x20limit\x20\x27'+_0x2236d4+'\x27');continue;}if(_0x40210f+_0x9f9512>_0x2236d4||_0x9e68f8[_0x183146(0x14b)]>=_0x3d3e46){const _0x21f0da=await this['writeChunk'](_0x9e68f8);_0x2e8094['push'](_0x21f0da),_0x40210f=0x0,_0x9e68f8=[];}_0x9e68f8['push'](_0x4de704),_0x40210f+=_0x9f9512;}}if(_0x9e68f8[_0x183146(0x14b)]){const _0x6be9a=await this[_0x183146(0x143)](_0x9e68f8);_0x2e8094[_0x183146(0x12c)](_0x6be9a);}await(0x0,promises_1['writeFile'])(this['retrieveResultsPath'],JSON[_0x183146(0x131)](_0x2e8094));}}exports['default']=RetrieveMetadata;