const a314_0x1d208e=a314_0x2367;(function(_0x11dbec,_0x1e808a){const _0x1967e7=a314_0x2367,_0x574ecb=_0x11dbec();while(!![]){try{const _0x17b7ef=-parseInt(_0x1967e7(0x10c))/0x1+-parseInt(_0x1967e7(0x115))/0x2*(-parseInt(_0x1967e7(0x127))/0x3)+-parseInt(_0x1967e7(0x10d))/0x4+parseInt(_0x1967e7(0x128))/0x5+-parseInt(_0x1967e7(0xf9))/0x6+-parseInt(_0x1967e7(0x10b))/0x7+parseInt(_0x1967e7(0xf8))/0x8;if(_0x17b7ef===_0x1e808a)break;else _0x574ecb['push'](_0x574ecb['shift']());}catch(_0x324ce7){_0x574ecb['push'](_0x574ecb['shift']());}}}(a314_0x1e2d,0x2aa60));const a314_0x429e1e=(function(){let _0x389313=!![];return function(_0x31a9a5,_0x4be2b7){const _0x122a48=_0x389313?function(){const _0x40f3ba=a314_0x2367;if(_0x4be2b7){const _0x4a906e=_0x4be2b7[_0x40f3ba(0xfd)](_0x31a9a5,arguments);return _0x4be2b7=null,_0x4a906e;}}:function(){};return _0x389313=![],_0x122a48;};}()),a314_0x4ae36d=a314_0x429e1e(this,function(){const _0x514594=a314_0x2367;return a314_0x4ae36d[_0x514594(0x11e)]()[_0x514594(0x103)](_0x514594(0x102))['toString']()[_0x514594(0xf7)](a314_0x4ae36d)[_0x514594(0x103)](_0x514594(0x102));});a314_0x4ae36d();'use strict';var __importDefault=this&&this[a314_0x1d208e(0x126)]||function(_0x1fdc5a){return _0x1fdc5a&&_0x1fdc5a['__esModule']?_0x1fdc5a:{'default':_0x1fdc5a};};function a314_0x1e2d(){const _0x2b0147=['join','.json','fs/promises','path','writeFile','logger','__importDefault','141BILluC','1128925XqldEH','file','metadataFolder','constructor','2671848bSCTOJ','1311948vBqBOZ','DEFLATE','\x27\x20exceed\x20limit\x20\x27','__esModule','apply','default','items','\x27\x20size\x20\x27','object-sizeof','(((.+)+)+)+$','search','../../constants','./manifest-manger','stringify','retrieveResultsPath','defineProperty','jobStorePath','create','453005LibWUx','45172AWAIbh','254144xwiKvQ','generateAsync','makeDir','push','stateManager','shortid','RETRIEVE_RESULT_FOLDER_NAME','RETRIEVE_RESULTS_IDS_FILENAME','298gOaCFV','fileName','base64','../../../shared/managers/auth.manager','AuthManager','AxiosInstanceUtils','jszip','writeChunk','length','toString','Item\x20\x27'];a314_0x1e2d=function(){return _0x2b0147;};return a314_0x1e2d();}function a314_0x2367(_0x4381d4,_0x40cb29){const _0x568451=a314_0x1e2d();return a314_0x2367=function(_0x4ae36d,_0x429e1e){_0x4ae36d=_0x4ae36d-0xf7;let _0x1e2dc3=_0x568451[_0x4ae36d];return _0x1e2dc3;},a314_0x2367(_0x4381d4,_0x40cb29);}Object[a314_0x1d208e(0x108)](exports,a314_0x1d208e(0xfc),{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a314_0x1d208e(0x105))),path_1=__importDefault(require(a314_0x1d208e(0x123))),promises_1=require(a314_0x1d208e(0x122)),fs_utils_1=require('../../../shared/utils/fs.utils'),object_sizeof_1=__importDefault(require(a314_0x1d208e(0x101))),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a314_0x1d208e(0x118)),constants_1=require(a314_0x1d208e(0x104)),shortid_1=__importDefault(require(a314_0x1d208e(0x112))),jszip_1=__importDefault(require(a314_0x1d208e(0x11b)));class RetrieveMetadata{constructor(_0x4933bc,_0x2d83f6,_0x30aab5){const _0x8fefb4=a314_0x1d208e;this[_0x8fefb4(0x109)]=_0x4933bc,this[_0x8fefb4(0x125)]=_0x2d83f6,this[_0x8fefb4(0x111)]=_0x30aab5,this[_0x8fefb4(0x12a)]=path_1[_0x8fefb4(0xfe)][_0x8fefb4(0x120)](this[_0x8fefb4(0x109)],constants_1[_0x8fefb4(0x113)]),this[_0x8fefb4(0x107)]=path_1[_0x8fefb4(0xfe)][_0x8fefb4(0x120)](this[_0x8fefb4(0x109)],constants_1[_0x8fefb4(0x114)]);}async[a314_0x1d208e(0x11c)](_0x34e3ae){const _0x50b375=a314_0x1d208e,_0x582b9e=(0x0,shortid_1[_0x50b375(0xfe)])();return await(0x0,promises_1['writeFile'])(path_1[_0x50b375(0xfe)][_0x50b375(0x120)](this[_0x50b375(0x12a)],_0x582b9e+_0x50b375(0x121)),JSON[_0x50b375(0x106)](_0x34e3ae)),_0x582b9e;}async['execute'](){const _0x20b851=a314_0x1d208e,{credentials:_0x599341,declarativeFilter:_0x3f1c66,metadataTypes:_0x48911c,maxChunkSize:_0x487b1a,maxChunkItems:_0x2df59a,apiVersion:_0x2d5f2f}=await new manifest_manger_1[(_0x20b851(0xfe))](this[_0x20b851(0x109)])['init'](),_0x201621=await salesforce_1[_0x20b851(0x11a)][_0x20b851(0x10a)](new auth_manager_1[(_0x20b851(0x119))](_0x599341),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x28da0d=await retrieve_factory_1['default'][_0x20b851(0x10a)](_0x201621,this[_0x20b851(0x125)],_0x3f1c66,_0x48911c,_0x2d5f2f)['execute']();await(0x0,fs_utils_1[_0x20b851(0x10f)])(this[_0x20b851(0x12a)]);let _0xf1ce85=[];const _0x10b2d3=[];let _0x3232b2=0x0;for(const _0x53000e in _0x28da0d[_0x20b851(0xff)]){for(const {listMetadataItem:_0x476614,files:_0x3deb69}of _0x28da0d[_0x20b851(0xff)][_0x53000e]['components']){const _0x532581=new jszip_1[(_0x20b851(0xfe))]();for(const _0x24725e in _0x3deb69){await _0x532581[_0x20b851(0x129)](_0x24725e,_0x3deb69[_0x24725e]);}const _0x30f4b5=await _0x532581[_0x20b851(0x10e)]({'type':_0x20b851(0x117),'compression':_0x20b851(0xfa),'compressionOptions':{'level':0x9}}),_0x2d0cde={..._0x476614,'zip':_0x30f4b5},_0x14221a=(0x0,object_sizeof_1[_0x20b851(0xfe)])(_0x2d0cde);if(_0x14221a>_0x487b1a){await this[_0x20b851(0x111)]['addWarning'](_0x20b851(0x11f)+_0x476614[_0x20b851(0x116)]+_0x20b851(0x100)+_0x14221a+_0x20b851(0xfb)+_0x487b1a+'\x27');continue;}if(_0x3232b2+_0x14221a>_0x487b1a||_0xf1ce85[_0x20b851(0x11d)]>=_0x2df59a){const _0x133152=await this[_0x20b851(0x11c)](_0xf1ce85);_0x10b2d3[_0x20b851(0x110)](_0x133152),_0x3232b2=0x0,_0xf1ce85=[];}_0xf1ce85[_0x20b851(0x110)](_0x2d0cde),_0x3232b2+=_0x14221a;}}if(_0xf1ce85[_0x20b851(0x11d)]){const _0x4a5dc3=await this[_0x20b851(0x11c)](_0xf1ce85);_0x10b2d3[_0x20b851(0x110)](_0x4a5dc3);}await(0x0,promises_1[_0x20b851(0x124)])(this[_0x20b851(0x107)],JSON[_0x20b851(0x106)](_0x10b2d3));}}exports[a314_0x1d208e(0xfe)]=RetrieveMetadata;