const a272_0x7d225e=a272_0x3893;(function(_0x1fce7d,_0x1a1b2d){const _0xd2547e=a272_0x3893,_0x93a2fa=_0x1fce7d();while(!![]){try{const _0x10b52c=parseInt(_0xd2547e(0x1f6))/0x1*(-parseInt(_0xd2547e(0x1fa))/0x2)+-parseInt(_0xd2547e(0x1f9))/0x3+-parseInt(_0xd2547e(0x1f1))/0x4*(-parseInt(_0xd2547e(0x1d7))/0x5)+parseInt(_0xd2547e(0x1df))/0x6*(parseInt(_0xd2547e(0x1d5))/0x7)+-parseInt(_0xd2547e(0x1dd))/0x8+parseInt(_0xd2547e(0x1ed))/0x9*(parseInt(_0xd2547e(0x1f5))/0xa)+parseInt(_0xd2547e(0x1fe))/0xb;if(_0x10b52c===_0x1a1b2d)break;else _0x93a2fa['push'](_0x93a2fa['shift']());}catch(_0x3263ab){_0x93a2fa['push'](_0x93a2fa['shift']());}}}(a272_0x2dfd,0x66b2a));const a272_0xc48f45=(function(){let _0x379a4b=!![];return function(_0x39bbfc,_0x371dbe){const _0x36133b=_0x379a4b?function(){if(_0x371dbe){const _0x3a7a5b=_0x371dbe['apply'](_0x39bbfc,arguments);return _0x371dbe=null,_0x3a7a5b;}}:function(){};return _0x379a4b=![],_0x36133b;};}()),a272_0x1f7e96=a272_0xc48f45(this,function(){const _0x34b3f3=a272_0x3893;return a272_0x1f7e96['toString']()['search'](_0x34b3f3(0x1f8))[_0x34b3f3(0x1d4)]()['constructor'](a272_0x1f7e96)[_0x34b3f3(0x1f3)](_0x34b3f3(0x1f8));});a272_0x1f7e96();'use strict';var __importDefault=this&&this[a272_0x7d225e(0x1ea)]||function(_0x7749a8){const _0x484681=a272_0x7d225e;return _0x7749a8&&_0x7749a8[_0x484681(0x1ee)]?_0x7749a8:{'default':_0x7749a8};};function a272_0x2dfd(){const _0x1761a7=['stateManager','create','./manifest-manger','toString','441PCAsOM','../../../shared/utils/fs.utils','5EWPSOK','RETRIEVE_RESULTS_IDS_FILENAME','path','items','makeDir','addWarning','2196704ymhjZk','./retrieve-factory','29424rVKSdl','length','init','fs/promises','../../../shared/managers/auth.manager','file','fileName','object-sizeof','retrieveResultsPath','AxiosInstanceUtils','\x27\x20size\x20\x27','__importDefault','join','base64','18sdVTKj','__esModule','\x27\x20exceed\x20limit\x20\x27','logger','228428TDUYqS','@flosum/salesforce','search','metadataFolder','1485230TpAdYG','22BCqRVk','writeChunk','(((.+)+)+)+$','618297rlugPE','73228iRGxms','jobStorePath','push','shortid','11481140ofcRkt','default','execute'];a272_0x2dfd=function(){return _0x1761a7;};return a272_0x2dfd();}Object['defineProperty'](exports,'__esModule',{'value':!![]});const salesforce_1=require(a272_0x7d225e(0x1f2)),manifest_manger_1=__importDefault(require(a272_0x7d225e(0x1d3))),path_1=__importDefault(require(a272_0x7d225e(0x1d9))),promises_1=require(a272_0x7d225e(0x1e2)),fs_utils_1=require(a272_0x7d225e(0x1d6)),object_sizeof_1=__importDefault(require(a272_0x7d225e(0x1e6))),retrieve_factory_1=__importDefault(require(a272_0x7d225e(0x1de))),auth_manager_1=require(a272_0x7d225e(0x1e3)),constants_1=require('../../constants'),shortid_1=__importDefault(require(a272_0x7d225e(0x1fd))),jszip_1=__importDefault(require('jszip'));class RetrieveMetadata{constructor(_0x463429,_0x5964cc,_0xa197cb){const _0x3f0255=a272_0x7d225e;this['jobStorePath']=_0x463429,this[_0x3f0255(0x1f0)]=_0x5964cc,this[_0x3f0255(0x1d1)]=_0xa197cb,this[_0x3f0255(0x1f4)]=path_1[_0x3f0255(0x1ff)][_0x3f0255(0x1eb)](this[_0x3f0255(0x1fb)],constants_1['RETRIEVE_RESULT_FOLDER_NAME']),this[_0x3f0255(0x1e7)]=path_1[_0x3f0255(0x1ff)][_0x3f0255(0x1eb)](this[_0x3f0255(0x1fb)],constants_1[_0x3f0255(0x1d8)]);}async[a272_0x7d225e(0x1f7)](_0x4f023d){const _0x58171c=a272_0x7d225e,_0xba714=(0x0,shortid_1[_0x58171c(0x1ff)])();return await(0x0,promises_1['writeFile'])(path_1['default'][_0x58171c(0x1eb)](this[_0x58171c(0x1f4)],_0xba714+'.json'),JSON['stringify'](_0x4f023d)),_0xba714;}async[a272_0x7d225e(0x1d0)](){const _0xdd589=a272_0x7d225e,{credentials:_0x46cfec,declarativeFilter:_0x2c273a,metadataTypes:_0x271db1,maxChunkSize:_0x39c50e,maxChunkItems:_0x28f70b,apiVersion:_0x4b286e}=await new manifest_manger_1[(_0xdd589(0x1ff))](this[_0xdd589(0x1fb)])[_0xdd589(0x1e1)](),_0x57f98f=await salesforce_1[_0xdd589(0x1e8)][_0xdd589(0x1d2)](new auth_manager_1['AuthManager'](_0x46cfec),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x20792a=await retrieve_factory_1['default'][_0xdd589(0x1d2)](_0x57f98f,this[_0xdd589(0x1f0)],_0x2c273a,_0x271db1,_0x4b286e)['execute']();await(0x0,fs_utils_1[_0xdd589(0x1db)])(this[_0xdd589(0x1f4)]);let _0x26e087=[];const _0x18d88b=[];let _0x1f4714=0x0;for(const _0x4e04e0 in _0x20792a['items']){for(const {listMetadataItem:_0x4945ae,files:_0x20a922}of _0x20792a[_0xdd589(0x1da)][_0x4e04e0]['components']){const _0x24059f=new jszip_1[(_0xdd589(0x1ff))]();for(const _0x21fded in _0x20a922){await _0x24059f[_0xdd589(0x1e4)](_0x21fded,_0x20a922[_0x21fded]);}const _0x321874=await _0x24059f['generateAsync']({'type':_0xdd589(0x1ec),'compression':'DEFLATE','compressionOptions':{'level':0x9}}),_0x2345fa={..._0x4945ae,'zip':_0x321874},_0x5e76e2=(0x0,object_sizeof_1[_0xdd589(0x1ff)])(_0x2345fa);if(_0x5e76e2>_0x39c50e){await this[_0xdd589(0x1d1)][_0xdd589(0x1dc)]('Item\x20\x27'+_0x4945ae[_0xdd589(0x1e5)]+_0xdd589(0x1e9)+_0x5e76e2+_0xdd589(0x1ef)+_0x39c50e+'\x27');continue;}if(_0x1f4714+_0x5e76e2>_0x39c50e||_0x26e087[_0xdd589(0x1e0)]>=_0x28f70b){const _0x11e84c=await this[_0xdd589(0x1f7)](_0x26e087);_0x18d88b[_0xdd589(0x1fc)](_0x11e84c),_0x1f4714=0x0,_0x26e087=[];}_0x26e087[_0xdd589(0x1fc)](_0x2345fa),_0x1f4714+=_0x5e76e2;}}if(_0x26e087[_0xdd589(0x1e0)]){const _0x1b5e47=await this[_0xdd589(0x1f7)](_0x26e087);_0x18d88b[_0xdd589(0x1fc)](_0x1b5e47);}await(0x0,promises_1['writeFile'])(this['retrieveResultsPath'],JSON['stringify'](_0x18d88b));}}function a272_0x3893(_0xb73b1e,_0x56b06e){const _0xe690e6=a272_0x2dfd();return a272_0x3893=function(_0x1f7e96,_0xc48f45){_0x1f7e96=_0x1f7e96-0x1d0;let _0x2dfd19=_0xe690e6[_0x1f7e96];return _0x2dfd19;},a272_0x3893(_0xb73b1e,_0x56b06e);}exports[a272_0x7d225e(0x1ff)]=RetrieveMetadata;