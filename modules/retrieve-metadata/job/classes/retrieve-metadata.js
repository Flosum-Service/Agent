const a272_0x2c3b57=a272_0x2ebf;(function(_0x5d22a4,_0x10b4c6){const _0x4322a7=a272_0x2ebf,_0x4ecdcb=_0x5d22a4();while(!![]){try{const _0x5c32eb=parseInt(_0x4322a7(0x100))/0x1+parseInt(_0x4322a7(0xeb))/0x2*(parseInt(_0x4322a7(0xf1))/0x3)+-parseInt(_0x4322a7(0xfe))/0x4*(parseInt(_0x4322a7(0xe3))/0x5)+parseInt(_0x4322a7(0x10c))/0x6+parseInt(_0x4322a7(0xfb))/0x7+parseInt(_0x4322a7(0xed))/0x8+-parseInt(_0x4322a7(0xe7))/0x9*(parseInt(_0x4322a7(0xe5))/0xa);if(_0x5c32eb===_0x10b4c6)break;else _0x4ecdcb['push'](_0x4ecdcb['shift']());}catch(_0x186cd2){_0x4ecdcb['push'](_0x4ecdcb['shift']());}}}(a272_0x4804,0x6f845));const a272_0x8825a9=(function(){let _0x8d2d93=!![];return function(_0xfee51,_0x106a2c){const _0xd96ee=_0x8d2d93?function(){const _0x414fa8=a272_0x2ebf;if(_0x106a2c){const _0x47ef4c=_0x106a2c[_0x414fa8(0xf8)](_0xfee51,arguments);return _0x106a2c=null,_0x47ef4c;}}:function(){};return _0x8d2d93=![],_0xd96ee;};}()),a272_0x21fe93=a272_0x8825a9(this,function(){const _0x4f30b6=a272_0x2ebf;return a272_0x21fe93[_0x4f30b6(0x105)]()[_0x4f30b6(0xe4)](_0x4f30b6(0x10d))[_0x4f30b6(0x105)]()[_0x4f30b6(0xde)](a272_0x21fe93)[_0x4f30b6(0xe4)](_0x4f30b6(0x10d));});function a272_0x2ebf(_0x38f8b5,_0x6b4981){const _0x1ac09d=a272_0x4804();return a272_0x2ebf=function(_0x21fe93,_0x8825a9){_0x21fe93=_0x21fe93-0xdd;let _0x48042d=_0x1ac09d[_0x21fe93];return _0x48042d;},a272_0x2ebf(_0x38f8b5,_0x6b4981);}a272_0x21fe93();'use strict';var __importDefault=this&&this[a272_0x2c3b57(0xfa)]||function(_0x1b1bcc){const _0x2feebe=a272_0x2c3b57;return _0x1b1bcc&&_0x1b1bcc[_0x2feebe(0xdf)]?_0x1b1bcc:{'default':_0x1b1bcc};};Object['defineProperty'](exports,a272_0x2c3b57(0xdf),{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a272_0x2c3b57(0x104))),path_1=__importDefault(require('path')),promises_1=require('fs/promises'),fs_utils_1=require(a272_0x2c3b57(0x10b)),object_sizeof_1=__importDefault(require(a272_0x2c3b57(0x102))),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a272_0x2c3b57(0x10a)),constants_1=require(a272_0x2c3b57(0xdd)),shortid_1=__importDefault(require(a272_0x2c3b57(0xea))),jszip_1=__importDefault(require(a272_0x2c3b57(0x109)));class RetrieveMetadata{constructor(_0x5c9858,_0x26f120,_0x7af39){const _0xd321c0=a272_0x2c3b57;this[_0xd321c0(0xf6)]=_0x5c9858,this[_0xd321c0(0xe9)]=_0x26f120,this['stateManager']=_0x7af39,this['metadataFolder']=path_1[_0xd321c0(0xf2)][_0xd321c0(0xe0)](this['jobStorePath'],constants_1[_0xd321c0(0xec)]),this['retrieveResultsPath']=path_1[_0xd321c0(0xf2)][_0xd321c0(0xe0)](this[_0xd321c0(0xf6)],constants_1[_0xd321c0(0xe6)]);}async['writeChunk'](_0x2f3ee){const _0x4a657a=a272_0x2c3b57,_0x33111d=(0x0,shortid_1[_0x4a657a(0xf2)])();return await(0x0,promises_1[_0x4a657a(0x10e)])(path_1[_0x4a657a(0xf2)]['join'](this['metadataFolder'],_0x33111d+'.json'),JSON[_0x4a657a(0x107)](_0x2f3ee)),_0x33111d;}async['execute'](){const _0x2c5b4d=a272_0x2c3b57,{credentials:_0x37ae29,declarativeFilter:_0x24161e,metadataTypes:_0x256445,maxChunkSize:_0x28eaf2,maxChunkItems:_0x48ec68,apiVersion:_0x133e4a}=await new manifest_manger_1[(_0x2c5b4d(0xf2))](this[_0x2c5b4d(0xf6)])[_0x2c5b4d(0xf9)](),_0x208f23=await salesforce_1[_0x2c5b4d(0xe8)]['create'](new auth_manager_1[(_0x2c5b4d(0x103))](_0x37ae29),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x257459=await retrieve_factory_1['default'][_0x2c5b4d(0xe1)](_0x208f23,this['logger'],_0x24161e,_0x256445,_0x133e4a)['execute']();await(0x0,fs_utils_1[_0x2c5b4d(0xf7)])(this[_0x2c5b4d(0x108)]);let _0x541d34=[];const _0x575dfa=[];let _0x2c2980=0x0;for(const _0x44fd50 in _0x257459[_0x2c5b4d(0xf3)]){for(const {listMetadataItem:_0x5a8f1a,files:_0xeced69}of _0x257459[_0x2c5b4d(0xf3)][_0x44fd50]['components']){const _0x6881cb=new jszip_1[(_0x2c5b4d(0xf2))]();for(const _0x3e4967 in _0xeced69){await _0x6881cb['file'](_0x3e4967,_0xeced69[_0x3e4967]);}const _0x14fbc9=await _0x6881cb[_0x2c5b4d(0xfd)]({'type':_0x2c5b4d(0xee),'compression':_0x2c5b4d(0xf0),'compressionOptions':{'level':0x9}}),_0x1dcfc1={..._0x5a8f1a,'zip':_0x14fbc9},_0x5727f8=(0x0,object_sizeof_1[_0x2c5b4d(0xf2)])(_0x1dcfc1);if(_0x5727f8>_0x28eaf2){await this[_0x2c5b4d(0xfc)][_0x2c5b4d(0x106)](_0x2c5b4d(0xe2)+_0x5a8f1a[_0x2c5b4d(0x101)]+_0x2c5b4d(0xf4)+_0x5727f8+'\x27\x20exceed\x20limit\x20\x27'+_0x28eaf2+'\x27');continue;}if(_0x2c2980+_0x5727f8>_0x28eaf2||_0x541d34[_0x2c5b4d(0xef)]>=_0x48ec68){const _0xd69ec=await this['writeChunk'](_0x541d34);_0x575dfa[_0x2c5b4d(0xff)](_0xd69ec),_0x2c2980=0x0,_0x541d34=[];}_0x541d34[_0x2c5b4d(0xff)](_0x1dcfc1),_0x2c2980+=_0x5727f8;}}if(_0x541d34[_0x2c5b4d(0xef)]){const _0x1513e0=await this['writeChunk'](_0x541d34);_0x575dfa[_0x2c5b4d(0xff)](_0x1513e0);}await(0x0,promises_1[_0x2c5b4d(0x10e)])(this[_0x2c5b4d(0xf5)],JSON[_0x2c5b4d(0x107)](_0x575dfa));}}exports[a272_0x2c3b57(0xf2)]=RetrieveMetadata;function a272_0x4804(){const _0x347fdc=['3930jQWBBz','search','10IdycJc','RETRIEVE_RESULTS_IDS_FILENAME','7490889ZDlnls','AxiosInstanceUtils','logger','shortid','8DIGaHV','RETRIEVE_RESULT_FOLDER_NAME','1189688QEeXJc','base64','length','DEFLATE','303225YuylRF','default','items','\x27\x20size\x20\x27','retrieveResultsPath','jobStorePath','makeDir','apply','init','__importDefault','3668063xkyHFF','stateManager','generateAsync','1048Srushl','push','92987vaGcWn','fileName','object-sizeof','AuthManager','./manifest-manger','toString','addWarning','stringify','metadataFolder','jszip','../../../shared/managers/auth.manager','../../../shared/utils/fs.utils','1950114vGjJyy','(((.+)+)+)+$','writeFile','../../constants','constructor','__esModule','join','create','Item\x20\x27'];a272_0x4804=function(){return _0x347fdc;};return a272_0x4804();}