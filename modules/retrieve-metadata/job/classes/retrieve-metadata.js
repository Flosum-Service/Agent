const a287_0x2dc603=a287_0x5347;(function(_0x15f08b,_0x2be27b){const _0x4aef6d=a287_0x5347,_0xa4875c=_0x15f08b();while(!![]){try{const _0x1f1be8=-parseInt(_0x4aef6d(0x138))/0x1+parseInt(_0x4aef6d(0x11e))/0x2*(-parseInt(_0x4aef6d(0x113))/0x3)+-parseInt(_0x4aef6d(0x13c))/0x4*(-parseInt(_0x4aef6d(0x13b))/0x5)+-parseInt(_0x4aef6d(0x11f))/0x6*(parseInt(_0x4aef6d(0x127))/0x7)+parseInt(_0x4aef6d(0x11d))/0x8*(-parseInt(_0x4aef6d(0x126))/0x9)+parseInt(_0x4aef6d(0x128))/0xa*(-parseInt(_0x4aef6d(0x11b))/0xb)+parseInt(_0x4aef6d(0x12f))/0xc*(parseInt(_0x4aef6d(0x12e))/0xd);if(_0x1f1be8===_0x2be27b)break;else _0xa4875c['push'](_0xa4875c['shift']());}catch(_0x2846a8){_0xa4875c['push'](_0xa4875c['shift']());}}}(a287_0x3e4f,0x34971));const a287_0x10f812=(function(){let _0x3c0b22=!![];return function(_0x1b53aa,_0x1285f1){const _0x40b45e=_0x3c0b22?function(){const _0x1f7bbe=a287_0x5347;if(_0x1285f1){const _0x271063=_0x1285f1[_0x1f7bbe(0x125)](_0x1b53aa,arguments);return _0x1285f1=null,_0x271063;}}:function(){};return _0x3c0b22=![],_0x40b45e;};}()),a287_0x188715=a287_0x10f812(this,function(){const _0x4f5c13=a287_0x5347;return a287_0x188715['toString']()[_0x4f5c13(0x136)](_0x4f5c13(0x12d))['toString']()[_0x4f5c13(0x120)](a287_0x188715)[_0x4f5c13(0x136)]('(((.+)+)+)+$');});a287_0x188715();'use strict';var __importDefault=this&&this[a287_0x2dc603(0x112)]||function(_0x32b93a){return _0x32b93a&&_0x32b93a['__esModule']?_0x32b93a:{'default':_0x32b93a};};function a287_0x3e4f(){const _0x526575=['12115YecXWZ','60ThkPls','stringify','fileName','default','DEFLATE','jszip','logger','makeDir','RETRIEVE_RESULTS_IDS_FILENAME','__importDefault','30OIXlEB','../../../shared/managers/auth.manager','../../constants','init','components','shortid','__esModule','join','11726bjMVXB','\x27\x20size\x20\x27','789496LkFrNO','53198JjVmKl','732HTTwvs','constructor','create','writeChunk','.json','writeFile','apply','36elAfUm','19964bfLWBB','960YDZwmr','object-sizeof','Item\x20\x27','length','AxiosInstanceUtils','(((.+)+)+)+$','65AABXDo','3971892VAqSJH','metadataFolder','push','./manifest-manger','retrieveResultsPath','base64','stateManager','search','addWarning','364873WRnnxu','jobStorePath','AuthManager'];a287_0x3e4f=function(){return _0x526575;};return a287_0x3e4f();}function a287_0x5347(_0x1efc0a,_0x3bd5f9){const _0x4f3a90=a287_0x3e4f();return a287_0x5347=function(_0x188715,_0x10f812){_0x188715=_0x188715-0x10d;let _0x3e4f37=_0x4f3a90[_0x188715];return _0x3e4f37;},a287_0x5347(_0x1efc0a,_0x3bd5f9);}Object['defineProperty'](exports,a287_0x2dc603(0x119),{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a287_0x2dc603(0x132))),path_1=__importDefault(require('path')),promises_1=require('fs/promises'),fs_utils_1=require('../../../shared/utils/fs.utils'),object_sizeof_1=__importDefault(require(a287_0x2dc603(0x129))),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a287_0x2dc603(0x114)),constants_1=require(a287_0x2dc603(0x115)),shortid_1=__importDefault(require(a287_0x2dc603(0x118))),jszip_1=__importDefault(require(a287_0x2dc603(0x10e)));class RetrieveMetadata{constructor(_0x4f754e,_0x4603a9,_0x376d2b){const _0x4fbc6d=a287_0x2dc603;this[_0x4fbc6d(0x139)]=_0x4f754e,this[_0x4fbc6d(0x10f)]=_0x4603a9,this[_0x4fbc6d(0x135)]=_0x376d2b,this[_0x4fbc6d(0x130)]=path_1['default'][_0x4fbc6d(0x11a)](this['jobStorePath'],constants_1['RETRIEVE_RESULT_FOLDER_NAME']),this[_0x4fbc6d(0x133)]=path_1[_0x4fbc6d(0x13f)][_0x4fbc6d(0x11a)](this[_0x4fbc6d(0x139)],constants_1[_0x4fbc6d(0x111)]);}async[a287_0x2dc603(0x122)](_0x5cbed3){const _0x4199eb=a287_0x2dc603,_0xb928f0=(0x0,shortid_1[_0x4199eb(0x13f)])();return await(0x0,promises_1[_0x4199eb(0x124)])(path_1[_0x4199eb(0x13f)]['join'](this[_0x4199eb(0x130)],_0xb928f0+_0x4199eb(0x123)),JSON[_0x4199eb(0x13d)](_0x5cbed3)),_0xb928f0;}async['execute'](){const _0x538002=a287_0x2dc603,{credentials:_0x3e2f6d,declarativeFilter:_0x269d48,metadataTypes:_0x36c2a0,maxChunkSize:_0x4c3187,maxChunkItems:_0x124445,apiVersion:_0x254f3c}=await new manifest_manger_1['default'](this[_0x538002(0x139)])[_0x538002(0x116)](),_0x482892=await salesforce_1[_0x538002(0x12c)][_0x538002(0x121)](new auth_manager_1[(_0x538002(0x13a))](_0x3e2f6d),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0xa12132=await retrieve_factory_1[_0x538002(0x13f)][_0x538002(0x121)](_0x482892,this['logger'],_0x269d48,_0x36c2a0,_0x254f3c)['execute']();await(0x0,fs_utils_1[_0x538002(0x110)])(this[_0x538002(0x130)]);let _0x1651e0=[];const _0x516123=[];let _0x128d7c=0x0;for(const _0x3c2866 in _0xa12132['items']){for(const {listMetadataItem:_0x2b8a0e,files:_0x5200ae}of _0xa12132['items'][_0x3c2866][_0x538002(0x117)]){const _0x29bcfe=new jszip_1['default']();for(const _0x162b61 in _0x5200ae){await _0x29bcfe['file'](_0x162b61,_0x5200ae[_0x162b61]);}const _0x2e8638=await _0x29bcfe['generateAsync']({'type':_0x538002(0x134),'compression':_0x538002(0x10d),'compressionOptions':{'level':0x9}}),_0x1e58b0={..._0x2b8a0e,'zip':_0x2e8638},_0x1576c1=(0x0,object_sizeof_1[_0x538002(0x13f)])(_0x1e58b0);if(_0x1576c1>_0x4c3187){await this[_0x538002(0x135)][_0x538002(0x137)](_0x538002(0x12a)+_0x2b8a0e[_0x538002(0x13e)]+_0x538002(0x11c)+_0x1576c1+'\x27\x20exceed\x20limit\x20\x27'+_0x4c3187+'\x27');continue;}if(_0x128d7c+_0x1576c1>_0x4c3187||_0x1651e0[_0x538002(0x12b)]>=_0x124445){const _0x71d646=await this[_0x538002(0x122)](_0x1651e0);_0x516123['push'](_0x71d646),_0x128d7c=0x0,_0x1651e0=[];}_0x1651e0[_0x538002(0x131)](_0x1e58b0),_0x128d7c+=_0x1576c1;}}if(_0x1651e0[_0x538002(0x12b)]){const _0x142790=await this[_0x538002(0x122)](_0x1651e0);_0x516123[_0x538002(0x131)](_0x142790);}await(0x0,promises_1['writeFile'])(this[_0x538002(0x133)],JSON[_0x538002(0x13d)](_0x516123));}}exports[a287_0x2dc603(0x13f)]=RetrieveMetadata;