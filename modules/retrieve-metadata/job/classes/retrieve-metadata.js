const a272_0xdbae2=a272_0x8043;function a272_0x10c1(){const _0x31700c=['./manifest-manger','AuthManager','919pZKPAz','./retrieve-factory','path','196XcABlq','82884fHQjvP','join','RETRIEVE_RESULT_FOLDER_NAME','1563605mkFwvz','666999aHnDkw','writeChunk','stringify','30doiEuo','jobStorePath','defineProperty','604cXxBzn','../../../shared/utils/fs.utils','logger','Item\x20\x27','metadataFolder','AxiosInstanceUtils','length','jszip','../../constants','search','addWarning','__esModule','toString','push','create','fileName','RETRIEVE_RESULTS_IDS_FILENAME','2706IZDCZf','../../../shared/managers/auth.manager','10kDYPne','.json','810439yiZseg','execute','shortid','default','(((.+)+)+)+$','1455YpWkbF','file','items','14093320wuKeXC','retrieveResultsPath'];a272_0x10c1=function(){return _0x31700c;};return a272_0x10c1();}(function(_0x4a92d9,_0xa7d29f){const _0x1253a3=a272_0x8043,_0x354ef8=_0x4a92d9();while(!![]){try{const _0x3c7bba=parseInt(_0x1253a3(0x18d))/0x1*(-parseInt(_0x1253a3(0x190))/0x2)+-parseInt(_0x1253a3(0x186))/0x3*(-parseInt(_0x1253a3(0x19b))/0x4)+parseInt(_0x1253a3(0x194))/0x5+-parseInt(_0x1253a3(0x198))/0x6*(-parseInt(_0x1253a3(0x1b0))/0x7)+-parseInt(_0x1253a3(0x189))/0x8+-parseInt(_0x1253a3(0x195))/0x9*(-parseInt(_0x1253a3(0x1ae))/0xa)+parseInt(_0x1253a3(0x1ac))/0xb*(parseInt(_0x1253a3(0x191))/0xc);if(_0x3c7bba===_0xa7d29f)break;else _0x354ef8['push'](_0x354ef8['shift']());}catch(_0x492f79){_0x354ef8['push'](_0x354ef8['shift']());}}}(a272_0x10c1,0xd864b));const a272_0x28bc93=(function(){let _0x44ab92=!![];return function(_0x37d236,_0x49111a){const _0x143780=_0x44ab92?function(){if(_0x49111a){const _0x785f48=_0x49111a['apply'](_0x37d236,arguments);return _0x49111a=null,_0x785f48;}}:function(){};return _0x44ab92=![],_0x143780;};}()),a272_0x1bdeb4=a272_0x28bc93(this,function(){const _0x510561=a272_0x8043;return a272_0x1bdeb4['toString']()['search'](_0x510561(0x185))[_0x510561(0x1a7)]()['constructor'](a272_0x1bdeb4)[_0x510561(0x1a4)](_0x510561(0x185));});a272_0x1bdeb4();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x52adbb){const _0x307063=a272_0x8043;return _0x52adbb&&_0x52adbb[_0x307063(0x1a6)]?_0x52adbb:{'default':_0x52adbb};};function a272_0x8043(_0x1fd683,_0x52c23a){const _0x4b2096=a272_0x10c1();return a272_0x8043=function(_0x1bdeb4,_0x28bc93){_0x1bdeb4=_0x1bdeb4-0x182;let _0x10c177=_0x4b2096[_0x1bdeb4];return _0x10c177;},a272_0x8043(_0x1fd683,_0x52c23a);}Object[a272_0xdbae2(0x19a)](exports,a272_0xdbae2(0x1a6),{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a272_0xdbae2(0x18b))),path_1=__importDefault(require(a272_0xdbae2(0x18f))),promises_1=require('fs/promises'),fs_utils_1=require(a272_0xdbae2(0x19c)),object_sizeof_1=__importDefault(require('object-sizeof')),retrieve_factory_1=__importDefault(require(a272_0xdbae2(0x18e))),auth_manager_1=require(a272_0xdbae2(0x1ad)),constants_1=require(a272_0xdbae2(0x1a3)),shortid_1=__importDefault(require(a272_0xdbae2(0x183))),jszip_1=__importDefault(require(a272_0xdbae2(0x1a2)));class RetrieveMetadata{constructor(_0x26be27,_0x7b1635,_0x2422da){const _0xe98b35=a272_0xdbae2;this[_0xe98b35(0x199)]=_0x26be27,this[_0xe98b35(0x19d)]=_0x7b1635,this['stateManager']=_0x2422da,this[_0xe98b35(0x19f)]=path_1['default'][_0xe98b35(0x192)](this['jobStorePath'],constants_1[_0xe98b35(0x193)]),this[_0xe98b35(0x18a)]=path_1[_0xe98b35(0x184)][_0xe98b35(0x192)](this[_0xe98b35(0x199)],constants_1[_0xe98b35(0x1ab)]);}async[a272_0xdbae2(0x196)](_0x1cb054){const _0x34ef7a=a272_0xdbae2,_0x53c363=(0x0,shortid_1[_0x34ef7a(0x184)])();return await(0x0,promises_1['writeFile'])(path_1[_0x34ef7a(0x184)]['join'](this['metadataFolder'],_0x53c363+_0x34ef7a(0x1af)),JSON['stringify'](_0x1cb054)),_0x53c363;}async[a272_0xdbae2(0x182)](){const _0x4d7129=a272_0xdbae2,{credentials:_0x3926fe,declarativeFilter:_0x22c586,metadataTypes:_0x2c1905,maxChunkSize:_0x7d6847,maxChunkItems:_0x40d618,apiVersion:_0x492eb5}=await new manifest_manger_1[(_0x4d7129(0x184))](this[_0x4d7129(0x199)])['init'](),_0x374b14=await salesforce_1[_0x4d7129(0x1a0)][_0x4d7129(0x1a9)](new auth_manager_1[(_0x4d7129(0x18c))](_0x3926fe),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x4aaeca=await retrieve_factory_1['default'][_0x4d7129(0x1a9)](_0x374b14,this['logger'],_0x22c586,_0x2c1905,_0x492eb5)['execute']();await(0x0,fs_utils_1['makeDir'])(this['metadataFolder']);let _0x2098f5=[];const _0x5f1106=[];let _0x5c232d=0x0;for(const _0x52a430 in _0x4aaeca[_0x4d7129(0x188)]){for(const {listMetadataItem:_0xa4480c,files:_0x117054}of _0x4aaeca[_0x4d7129(0x188)][_0x52a430]['components']){const _0x2d92c4=new jszip_1[(_0x4d7129(0x184))]();for(const _0x3cb531 in _0x117054){await _0x2d92c4[_0x4d7129(0x187)](_0x3cb531,_0x117054[_0x3cb531]);}const _0x339fbc=await _0x2d92c4['generateAsync']({'type':'base64','compression':'DEFLATE','compressionOptions':{'level':0x9}}),_0x1808c2={..._0xa4480c,'zip':_0x339fbc},_0x3d0f6e=(0x0,object_sizeof_1[_0x4d7129(0x184)])(_0x1808c2);if(_0x3d0f6e>_0x7d6847){await this['stateManager'][_0x4d7129(0x1a5)](_0x4d7129(0x19e)+_0xa4480c[_0x4d7129(0x1aa)]+'\x27\x20size\x20\x27'+_0x3d0f6e+'\x27\x20exceed\x20limit\x20\x27'+_0x7d6847+'\x27');continue;}if(_0x5c232d+_0x3d0f6e>_0x7d6847||_0x2098f5['length']>=_0x40d618){const _0x3d2641=await this['writeChunk'](_0x2098f5);_0x5f1106[_0x4d7129(0x1a8)](_0x3d2641),_0x5c232d=0x0,_0x2098f5=[];}_0x2098f5['push'](_0x1808c2),_0x5c232d+=_0x3d0f6e;}}if(_0x2098f5[_0x4d7129(0x1a1)]){const _0x2a4f71=await this['writeChunk'](_0x2098f5);_0x5f1106[_0x4d7129(0x1a8)](_0x2a4f71);}await(0x0,promises_1['writeFile'])(this[_0x4d7129(0x18a)],JSON[_0x4d7129(0x197)](_0x5f1106));}}exports[a272_0xdbae2(0x184)]=RetrieveMetadata;