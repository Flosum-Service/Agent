const a267_0x10f1a5=a267_0x2dc5;(function(_0x36550b,_0x1ffd4d){const _0x24591e=a267_0x2dc5,_0x4e81c1=_0x36550b();while(!![]){try{const _0xcb6ca3=parseInt(_0x24591e(0x120))/0x1+-parseInt(_0x24591e(0x125))/0x2+-parseInt(_0x24591e(0x13a))/0x3+-parseInt(_0x24591e(0x12f))/0x4*(parseInt(_0x24591e(0x133))/0x5)+-parseInt(_0x24591e(0x127))/0x6*(-parseInt(_0x24591e(0x115))/0x7)+-parseInt(_0x24591e(0x116))/0x8*(-parseInt(_0x24591e(0x129))/0x9)+parseInt(_0x24591e(0x128))/0xa;if(_0xcb6ca3===_0x1ffd4d)break;else _0x4e81c1['push'](_0x4e81c1['shift']());}catch(_0x2379f9){_0x4e81c1['push'](_0x4e81c1['shift']());}}}(a267_0x1af1,0x98688));function a267_0x2dc5(_0x489d85,_0x3c0697){const _0x3eff31=a267_0x1af1();return a267_0x2dc5=function(_0x371cd6,_0x462a84){_0x371cd6=_0x371cd6-0x112;let _0x1af1b5=_0x3eff31[_0x371cd6];return _0x1af1b5;},a267_0x2dc5(_0x489d85,_0x3c0697);}function a267_0x1af1(){const _0x52dc7e=['stringify','\x27\x20exceed\x20limit\x20\x27','\x27\x20size\x20\x27','components','init','logger','514746dzFYPF','writeChunk','fs/promises','(((.+)+)+)+$','defineProperty','787024yZlrRZ','stateManager','5246184znrSwp','520980NplmgR','1413fQsGoV','./manifest-manger','retrieveResultsPath','search','AuthManager','../../../shared/managers/auth.manager','836IPgjQZ','object-sizeof','jobStorePath','addWarning','11590syjpgG','execute','metadataFolder','push','AxiosInstanceUtils','toString','./retrieve-factory','1944417zwTcaV','__esModule','RETRIEVE_RESULTS_IDS_FILENAME','DEFLATE','create','shortid','writeFile','length','@flosum/salesforce','join','RETRIEVE_RESULT_FOLDER_NAME','../../constants','default','../../../shared/utils/fs.utils','7cuVnRy','36136HistiH','jszip','fileName','items'];a267_0x1af1=function(){return _0x52dc7e;};return a267_0x1af1();}const a267_0x462a84=(function(){let _0x1ec2f5=!![];return function(_0x3e4c9a,_0x26442e){const _0x51ff44=_0x1ec2f5?function(){if(_0x26442e){const _0x489c7a=_0x26442e['apply'](_0x3e4c9a,arguments);return _0x26442e=null,_0x489c7a;}}:function(){};return _0x1ec2f5=![],_0x51ff44;};}()),a267_0x371cd6=a267_0x462a84(this,function(){const _0x3e9814=a267_0x2dc5;return a267_0x371cd6['toString']()[_0x3e9814(0x12c)]('(((.+)+)+)+$')[_0x3e9814(0x138)]()['constructor'](a267_0x371cd6)[_0x3e9814(0x12c)](_0x3e9814(0x123));});a267_0x371cd6();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x25e296){return _0x25e296&&_0x25e296['__esModule']?_0x25e296:{'default':_0x25e296};};Object[a267_0x10f1a5(0x124)](exports,a267_0x10f1a5(0x13b),{'value':!![]});const salesforce_1=require(a267_0x10f1a5(0x142)),manifest_manger_1=__importDefault(require(a267_0x10f1a5(0x12a))),path_1=__importDefault(require('path')),promises_1=require(a267_0x10f1a5(0x122)),fs_utils_1=require(a267_0x10f1a5(0x114)),object_sizeof_1=__importDefault(require(a267_0x10f1a5(0x130))),retrieve_factory_1=__importDefault(require(a267_0x10f1a5(0x139))),auth_manager_1=require(a267_0x10f1a5(0x12e)),constants_1=require(a267_0x10f1a5(0x112)),shortid_1=__importDefault(require(a267_0x10f1a5(0x13f))),jszip_1=__importDefault(require(a267_0x10f1a5(0x117)));class RetrieveMetadata{constructor(_0x5cdd7,_0xd4dc57,_0x54ae96){const _0x50ffae=a267_0x10f1a5;this[_0x50ffae(0x131)]=_0x5cdd7,this[_0x50ffae(0x11f)]=_0xd4dc57,this[_0x50ffae(0x126)]=_0x54ae96,this['metadataFolder']=path_1[_0x50ffae(0x113)][_0x50ffae(0x143)](this[_0x50ffae(0x131)],constants_1[_0x50ffae(0x144)]),this[_0x50ffae(0x12b)]=path_1[_0x50ffae(0x113)][_0x50ffae(0x143)](this[_0x50ffae(0x131)],constants_1[_0x50ffae(0x13c)]);}async['writeChunk'](_0x465409){const _0x227a69=a267_0x10f1a5,_0x3dc8c1=(0x0,shortid_1[_0x227a69(0x113)])();return await(0x0,promises_1['writeFile'])(path_1['default'][_0x227a69(0x143)](this['metadataFolder'],_0x3dc8c1+'.json'),JSON[_0x227a69(0x11a)](_0x465409)),_0x3dc8c1;}async[a267_0x10f1a5(0x134)](){const _0x37e332=a267_0x10f1a5,{credentials:_0x142d54,declarativeFilter:_0x4411db,maxChunkSize:_0x3ed667,maxChunkItems:_0x23305e,apiVersion:_0x2c3804}=await new manifest_manger_1[(_0x37e332(0x113))](this[_0x37e332(0x131)])[_0x37e332(0x11e)](),_0x1b0203=await salesforce_1[_0x37e332(0x137)][_0x37e332(0x13e)](new auth_manager_1[(_0x37e332(0x12d))](_0x142d54),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x29be80=await retrieve_factory_1['default'][_0x37e332(0x13e)](_0x1b0203,this[_0x37e332(0x11f)],_0x4411db,_0x2c3804)[_0x37e332(0x134)]();await(0x0,fs_utils_1['makeDir'])(this[_0x37e332(0x135)]);let _0x1c1fef=[];const _0x409d9b=[];let _0x496e10=0x0;for(const _0x4d70ec in _0x29be80[_0x37e332(0x119)]){for(const {listMetadataItem:_0x2530f1,files:_0x3e21b9}of _0x29be80[_0x37e332(0x119)][_0x4d70ec][_0x37e332(0x11d)]){const _0x382d64=new jszip_1[(_0x37e332(0x113))]();for(const _0x124deb in _0x3e21b9){await _0x382d64['file'](_0x124deb,_0x3e21b9[_0x124deb]);}const _0x25006f=await _0x382d64['generateAsync']({'type':'base64','compression':_0x37e332(0x13d),'compressionOptions':{'level':0x9}}),_0x37c3b9={..._0x2530f1,'zip':_0x25006f},_0x160ad3=(0x0,object_sizeof_1[_0x37e332(0x113)])(_0x37c3b9);if(_0x160ad3>_0x3ed667){await this[_0x37e332(0x126)][_0x37e332(0x132)]('Item\x20\x27'+_0x2530f1[_0x37e332(0x118)]+_0x37e332(0x11c)+_0x160ad3+_0x37e332(0x11b)+_0x3ed667+'\x27');continue;}if(_0x496e10+_0x160ad3>_0x3ed667||_0x1c1fef[_0x37e332(0x141)]>=_0x23305e){const _0x369c2d=await this[_0x37e332(0x121)](_0x1c1fef);_0x409d9b[_0x37e332(0x136)](_0x369c2d),_0x496e10=0x0,_0x1c1fef=[];}_0x1c1fef['push'](_0x37c3b9),_0x496e10+=_0x160ad3;}}if(_0x1c1fef[_0x37e332(0x141)]){const _0x43204e=await this[_0x37e332(0x121)](_0x1c1fef);_0x409d9b[_0x37e332(0x136)](_0x43204e);}await(0x0,promises_1[_0x37e332(0x140)])(this[_0x37e332(0x12b)],JSON[_0x37e332(0x11a)](_0x409d9b));}}exports[a267_0x10f1a5(0x113)]=RetrieveMetadata;