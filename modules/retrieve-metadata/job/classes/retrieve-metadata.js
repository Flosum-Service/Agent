const a272_0x335119=a272_0x4d03;function a272_0x35f0(){const _0x2e8fec=['538502SrMbCR','66412VZMofx','2gpOnTi','111xCzBms','defineProperty','items','object-sizeof','64506SuoHbz','join','push','metadataFolder','fs/promises','execute','toString','length','create','constructor','retrieveResultsPath','generateAsync','4736168aaWyvt','components','AuthManager','writeFile','search','Item\x20\x27','file','@flosum/salesforce','./retrieve-factory','1439780IxWQYL','default','AxiosInstanceUtils','18544878MUVqKx','stringify','shortid','DEFLATE','writeChunk','__importDefault','apply','(((.+)+)+)+$','RETRIEVE_RESULT_FOLDER_NAME','stateManager','.json','jszip','../../../shared/utils/fs.utils','jobStorePath','fileName','logger','addWarning','2148433CEtavz','\x27\x20exceed\x20limit\x20\x27'];a272_0x35f0=function(){return _0x2e8fec;};return a272_0x35f0();}(function(_0x19575c,_0x30c04c){const _0x25d282=a272_0x4d03,_0xc2eace=_0x19575c();while(!![]){try{const _0x40613d=parseInt(_0x25d282(0x15b))/0x1*(-parseInt(_0x25d282(0x15d))/0x2)+parseInt(_0x25d282(0x15e))/0x3*(-parseInt(_0x25d282(0x15c))/0x4)+-parseInt(_0x25d282(0x177))/0x5+-parseInt(_0x25d282(0x162))/0x6+parseInt(_0x25d282(0x159))/0x7+-parseInt(_0x25d282(0x16e))/0x8+parseInt(_0x25d282(0x17a))/0x9;if(_0x40613d===_0x30c04c)break;else _0xc2eace['push'](_0xc2eace['shift']());}catch(_0x3aae62){_0xc2eace['push'](_0xc2eace['shift']());}}}(a272_0x35f0,0x4f150));const a272_0x4216e3=(function(){let _0x273aec=!![];return function(_0x384a79,_0x6f8fed){const _0xf11b32=_0x273aec?function(){const _0x3e45f9=a272_0x4d03;if(_0x6f8fed){const _0xca7092=_0x6f8fed[_0x3e45f9(0x180)](_0x384a79,arguments);return _0x6f8fed=null,_0xca7092;}}:function(){};return _0x273aec=![],_0xf11b32;};}()),a272_0x4bb497=a272_0x4216e3(this,function(){const _0x39516a=a272_0x4d03;return a272_0x4bb497[_0x39516a(0x168)]()[_0x39516a(0x172)](_0x39516a(0x181))[_0x39516a(0x168)]()[_0x39516a(0x16b)](a272_0x4bb497)[_0x39516a(0x172)](_0x39516a(0x181));});a272_0x4bb497();function a272_0x4d03(_0x5e5ed2,_0x55dce0){const _0x528f0f=a272_0x35f0();return a272_0x4d03=function(_0x4bb497,_0x4216e3){_0x4bb497=_0x4bb497-0x150;let _0x35f092=_0x528f0f[_0x4bb497];return _0x35f092;},a272_0x4d03(_0x5e5ed2,_0x55dce0);}'use strict';var __importDefault=this&&this[a272_0x335119(0x17f)]||function(_0x363e50){return _0x363e50&&_0x363e50['__esModule']?_0x363e50:{'default':_0x363e50};};Object[a272_0x335119(0x15f)](exports,'__esModule',{'value':!![]});const salesforce_1=require(a272_0x335119(0x175)),manifest_manger_1=__importDefault(require('./manifest-manger')),path_1=__importDefault(require('path')),promises_1=require(a272_0x335119(0x166)),fs_utils_1=require(a272_0x335119(0x154)),object_sizeof_1=__importDefault(require(a272_0x335119(0x161))),retrieve_factory_1=__importDefault(require(a272_0x335119(0x176))),auth_manager_1=require('../../../shared/managers/auth.manager'),constants_1=require('../../constants'),shortid_1=__importDefault(require(a272_0x335119(0x17c))),jszip_1=__importDefault(require(a272_0x335119(0x153)));class RetrieveMetadata{constructor(_0x1d615c,_0x5ed0c0,_0x3d5c68){const _0x4fb0dd=a272_0x335119;this[_0x4fb0dd(0x155)]=_0x1d615c,this[_0x4fb0dd(0x157)]=_0x5ed0c0,this[_0x4fb0dd(0x151)]=_0x3d5c68,this[_0x4fb0dd(0x165)]=path_1[_0x4fb0dd(0x178)][_0x4fb0dd(0x163)](this[_0x4fb0dd(0x155)],constants_1[_0x4fb0dd(0x150)]),this[_0x4fb0dd(0x16c)]=path_1['default'][_0x4fb0dd(0x163)](this[_0x4fb0dd(0x155)],constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);}async['writeChunk'](_0x4c501b){const _0x56df43=a272_0x335119,_0x425d1f=(0x0,shortid_1[_0x56df43(0x178)])();return await(0x0,promises_1[_0x56df43(0x171)])(path_1['default'][_0x56df43(0x163)](this[_0x56df43(0x165)],_0x425d1f+_0x56df43(0x152)),JSON[_0x56df43(0x17b)](_0x4c501b)),_0x425d1f;}async[a272_0x335119(0x167)](){const _0x2a56e3=a272_0x335119,{credentials:_0x2dccc7,declarativeFilter:_0x328ae0,metadataTypes:_0x1b402f,maxChunkSize:_0x4ded69,maxChunkItems:_0x3b0675,apiVersion:_0x35924e}=await new manifest_manger_1[(_0x2a56e3(0x178))](this['jobStorePath'])['init'](),_0x25b8d1=await salesforce_1[_0x2a56e3(0x179)][_0x2a56e3(0x16a)](new auth_manager_1[(_0x2a56e3(0x170))](_0x2dccc7),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x88ca18=await retrieve_factory_1[_0x2a56e3(0x178)][_0x2a56e3(0x16a)](_0x25b8d1,this[_0x2a56e3(0x157)],_0x328ae0,_0x1b402f,_0x35924e)[_0x2a56e3(0x167)]();await(0x0,fs_utils_1['makeDir'])(this[_0x2a56e3(0x165)]);let _0x53d381=[];const _0x2648ea=[];let _0x16f3c3=0x0;for(const _0x3237f0 in _0x88ca18[_0x2a56e3(0x160)]){for(const {listMetadataItem:_0xe3b42d,files:_0xecdde}of _0x88ca18[_0x2a56e3(0x160)][_0x3237f0][_0x2a56e3(0x16f)]){const _0x469be1=new jszip_1['default']();for(const _0x2e3add in _0xecdde){await _0x469be1[_0x2a56e3(0x174)](_0x2e3add,_0xecdde[_0x2e3add]);}const _0x20a20a=await _0x469be1[_0x2a56e3(0x16d)]({'type':'base64','compression':_0x2a56e3(0x17d),'compressionOptions':{'level':0x9}}),_0x41ed49={..._0xe3b42d,'zip':_0x20a20a},_0x4cae0d=(0x0,object_sizeof_1[_0x2a56e3(0x178)])(_0x41ed49);if(_0x4cae0d>_0x4ded69){await this[_0x2a56e3(0x151)][_0x2a56e3(0x158)](_0x2a56e3(0x173)+_0xe3b42d[_0x2a56e3(0x156)]+'\x27\x20size\x20\x27'+_0x4cae0d+_0x2a56e3(0x15a)+_0x4ded69+'\x27');continue;}if(_0x16f3c3+_0x4cae0d>_0x4ded69||_0x53d381[_0x2a56e3(0x169)]>=_0x3b0675){const _0x2f7288=await this[_0x2a56e3(0x17e)](_0x53d381);_0x2648ea['push'](_0x2f7288),_0x16f3c3=0x0,_0x53d381=[];}_0x53d381['push'](_0x41ed49),_0x16f3c3+=_0x4cae0d;}}if(_0x53d381['length']){const _0x620e6c=await this['writeChunk'](_0x53d381);_0x2648ea[_0x2a56e3(0x164)](_0x620e6c);}await(0x0,promises_1[_0x2a56e3(0x171)])(this[_0x2a56e3(0x16c)],JSON[_0x2a56e3(0x17b)](_0x2648ea));}}exports[a272_0x335119(0x178)]=RetrieveMetadata;