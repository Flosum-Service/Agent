const a272_0x31b89f=a272_0x1f2a;(function(_0x295372,_0x68339d){const _0x312dc7=a272_0x1f2a,_0xecd235=_0x295372();while(!![]){try{const _0x451350=-parseInt(_0x312dc7(0x12b))/0x1*(parseInt(_0x312dc7(0x146))/0x2)+parseInt(_0x312dc7(0x159))/0x3*(-parseInt(_0x312dc7(0x130))/0x4)+-parseInt(_0x312dc7(0x152))/0x5+-parseInt(_0x312dc7(0x133))/0x6*(parseInt(_0x312dc7(0x142))/0x7)+parseInt(_0x312dc7(0x138))/0x8+-parseInt(_0x312dc7(0x140))/0x9*(parseInt(_0x312dc7(0x15f))/0xa)+-parseInt(_0x312dc7(0x13e))/0xb*(-parseInt(_0x312dc7(0x148))/0xc);if(_0x451350===_0x68339d)break;else _0xecd235['push'](_0xecd235['shift']());}catch(_0x1c89c4){_0xecd235['push'](_0xecd235['shift']());}}}(a272_0x14fd,0xced9e));function a272_0x14fd(){const _0x2bdb60=['join','fileName','shortid','Item\x20\x27','\x27\x20size\x20\x27','99howZFp','stateManager','286542RnDGpH','path','1877029oBAhtw','push','retrieveResultsPath','length','3286yCqrJH','(((.+)+)+)+$','5814216AomWVi','logger','./retrieve-factory','defineProperty','search','writeChunk','RETRIEVE_RESULT_FOLDER_NAME','RETRIEVE_RESULTS_IDS_FILENAME','fs/promises','@flosum/salesforce','4566790SKCrqH','execute','components','\x27\x20exceed\x20limit\x20\x27','jobStorePath','.json','metadataFolder','1988313vwCzzi','apply','makeDir','constructor','../../../shared/utils/fs.utils','__esModule','430CRyOCM','stringify','509aUizpb','writeFile','file','DEFLATE','init','4lozgEK','create','jszip','12tAeZXp','toString','base64','../../constants','default','6434752jQQdEO'];a272_0x14fd=function(){return _0x2bdb60;};return a272_0x14fd();}const a272_0x5f3075=(function(){let _0x2876a1=!![];return function(_0x745f31,_0x3d380e){const _0x44f008=_0x2876a1?function(){const _0x4da2a0=a272_0x1f2a;if(_0x3d380e){const _0x5637dc=_0x3d380e[_0x4da2a0(0x15a)](_0x745f31,arguments);return _0x3d380e=null,_0x5637dc;}}:function(){};return _0x2876a1=![],_0x44f008;};}()),a272_0x27e596=a272_0x5f3075(this,function(){const _0x753f4=a272_0x1f2a;return a272_0x27e596[_0x753f4(0x134)]()['search'](_0x753f4(0x147))[_0x753f4(0x134)]()[_0x753f4(0x15c)](a272_0x27e596)[_0x753f4(0x14c)]('(((.+)+)+)+$');});a272_0x27e596();function a272_0x1f2a(_0x13ad15,_0x4bf44f){const _0x3c2829=a272_0x14fd();return a272_0x1f2a=function(_0x27e596,_0x5f3075){_0x27e596=_0x27e596-0x12a;let _0x14fd18=_0x3c2829[_0x27e596];return _0x14fd18;},a272_0x1f2a(_0x13ad15,_0x4bf44f);}'use strict';var __importDefault=this&&this['__importDefault']||function(_0xba8e9d){const _0x4db725=a272_0x1f2a;return _0xba8e9d&&_0xba8e9d[_0x4db725(0x15e)]?_0xba8e9d:{'default':_0xba8e9d};};Object[a272_0x31b89f(0x14b)](exports,a272_0x31b89f(0x15e),{'value':!![]});const salesforce_1=require(a272_0x31b89f(0x151)),manifest_manger_1=__importDefault(require('./manifest-manger')),path_1=__importDefault(require(a272_0x31b89f(0x141))),promises_1=require(a272_0x31b89f(0x150)),fs_utils_1=require(a272_0x31b89f(0x15d)),object_sizeof_1=__importDefault(require('object-sizeof')),retrieve_factory_1=__importDefault(require(a272_0x31b89f(0x14a))),auth_manager_1=require('../../../shared/managers/auth.manager'),constants_1=require(a272_0x31b89f(0x136)),shortid_1=__importDefault(require(a272_0x31b89f(0x13b))),jszip_1=__importDefault(require(a272_0x31b89f(0x132)));class RetrieveMetadata{constructor(_0xdc1c9e,_0x1aaad3,_0x17f7fc){const _0x2be979=a272_0x31b89f;this[_0x2be979(0x156)]=_0xdc1c9e,this[_0x2be979(0x149)]=_0x1aaad3,this[_0x2be979(0x13f)]=_0x17f7fc,this[_0x2be979(0x158)]=path_1[_0x2be979(0x137)][_0x2be979(0x139)](this[_0x2be979(0x156)],constants_1[_0x2be979(0x14e)]),this[_0x2be979(0x144)]=path_1['default'][_0x2be979(0x139)](this['jobStorePath'],constants_1[_0x2be979(0x14f)]);}async[a272_0x31b89f(0x14d)](_0x3f88cb){const _0x5f4213=a272_0x31b89f,_0x2711e8=(0x0,shortid_1[_0x5f4213(0x137)])();return await(0x0,promises_1[_0x5f4213(0x12c)])(path_1[_0x5f4213(0x137)][_0x5f4213(0x139)](this['metadataFolder'],_0x2711e8+_0x5f4213(0x157)),JSON['stringify'](_0x3f88cb)),_0x2711e8;}async[a272_0x31b89f(0x153)](){const _0x429167=a272_0x31b89f,{credentials:_0x11fa5a,declarativeFilter:_0xa3b8ec,metadataTypes:_0x5bda85,maxChunkSize:_0x149d1a,maxChunkItems:_0x288104,apiVersion:_0xfe8a32}=await new manifest_manger_1['default'](this[_0x429167(0x156)])[_0x429167(0x12f)](),_0x542579=await salesforce_1['AxiosInstanceUtils'][_0x429167(0x131)](new auth_manager_1['AuthManager'](_0x11fa5a),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x12d3ca=await retrieve_factory_1['default'][_0x429167(0x131)](_0x542579,this[_0x429167(0x149)],_0xa3b8ec,_0x5bda85,_0xfe8a32)[_0x429167(0x153)]();await(0x0,fs_utils_1[_0x429167(0x15b)])(this[_0x429167(0x158)]);let _0x265cc9=[];const _0x50a797=[];let _0x5dddcf=0x0;for(const _0x487290 in _0x12d3ca['items']){for(const {listMetadataItem:_0x49145f,files:_0x12cc08}of _0x12d3ca['items'][_0x487290][_0x429167(0x154)]){const _0x10c6fd=new jszip_1[(_0x429167(0x137))]();for(const _0x1ad9b7 in _0x12cc08){await _0x10c6fd[_0x429167(0x12d)](_0x1ad9b7,_0x12cc08[_0x1ad9b7]);}const _0x230167=await _0x10c6fd['generateAsync']({'type':_0x429167(0x135),'compression':_0x429167(0x12e),'compressionOptions':{'level':0x9}}),_0x3ce679={..._0x49145f,'zip':_0x230167},_0xf45a78=(0x0,object_sizeof_1[_0x429167(0x137)])(_0x3ce679);if(_0xf45a78>_0x149d1a){await this[_0x429167(0x13f)]['addWarning'](_0x429167(0x13c)+_0x49145f[_0x429167(0x13a)]+_0x429167(0x13d)+_0xf45a78+_0x429167(0x155)+_0x149d1a+'\x27');continue;}if(_0x5dddcf+_0xf45a78>_0x149d1a||_0x265cc9[_0x429167(0x145)]>=_0x288104){const _0x437a7f=await this['writeChunk'](_0x265cc9);_0x50a797[_0x429167(0x143)](_0x437a7f),_0x5dddcf=0x0,_0x265cc9=[];}_0x265cc9['push'](_0x3ce679),_0x5dddcf+=_0xf45a78;}}if(_0x265cc9[_0x429167(0x145)]){const _0x93258=await this[_0x429167(0x14d)](_0x265cc9);_0x50a797[_0x429167(0x143)](_0x93258);}await(0x0,promises_1['writeFile'])(this[_0x429167(0x144)],JSON[_0x429167(0x12a)](_0x50a797));}}exports[a272_0x31b89f(0x137)]=RetrieveMetadata;