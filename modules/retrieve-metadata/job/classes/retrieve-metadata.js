const a304_0x37ba0d=a304_0x1bab;function a304_0x1bab(_0x5e5c9c,_0x119b60){const _0x18b26e=a304_0xcb9a();return a304_0x1bab=function(_0x411555,_0x587340){_0x411555=_0x411555-0x1a5;let _0xcb9a13=_0x18b26e[_0x411555];return _0xcb9a13;},a304_0x1bab(_0x5e5c9c,_0x119b60);}(function(_0x36950d,_0x44ec3d){const _0x2c0a66=a304_0x1bab,_0x3c3617=_0x36950d();while(!![]){try{const _0x39e438=parseInt(_0x2c0a66(0x1d3))/0x1+parseInt(_0x2c0a66(0x1c1))/0x2*(parseInt(_0x2c0a66(0x1cb))/0x3)+-parseInt(_0x2c0a66(0x1a8))/0x4*(-parseInt(_0x2c0a66(0x1d1))/0x5)+parseInt(_0x2c0a66(0x1d5))/0x6*(parseInt(_0x2c0a66(0x1c2))/0x7)+-parseInt(_0x2c0a66(0x1c3))/0x8*(-parseInt(_0x2c0a66(0x1ce))/0x9)+-parseInt(_0x2c0a66(0x1b5))/0xa*(-parseInt(_0x2c0a66(0x1cf))/0xb)+-parseInt(_0x2c0a66(0x1b9))/0xc;if(_0x39e438===_0x44ec3d)break;else _0x3c3617['push'](_0x3c3617['shift']());}catch(_0x29704b){_0x3c3617['push'](_0x3c3617['shift']());}}}(a304_0xcb9a,0x203ff));const a304_0x587340=(function(){let _0x163d6b=!![];return function(_0x3f0b0f,_0x2d935b){const _0x1685a5=_0x163d6b?function(){const _0x2ac307=a304_0x1bab;if(_0x2d935b){const _0xbdc443=_0x2d935b[_0x2ac307(0x1ba)](_0x3f0b0f,arguments);return _0x2d935b=null,_0xbdc443;}}:function(){};return _0x163d6b=![],_0x1685a5;};}()),a304_0x411555=a304_0x587340(this,function(){const _0x5affba=a304_0x1bab;return a304_0x411555[_0x5affba(0x1bb)]()['search'](_0x5affba(0x1c8))[_0x5affba(0x1bb)]()['constructor'](a304_0x411555)[_0x5affba(0x1b1)](_0x5affba(0x1c8));});a304_0x411555();function a304_0xcb9a(){const _0x3b1cab=['stringify','logger','stateManager','\x27\x20exceed\x20limit\x20\x27','create','search','./manifest-manger','DEFLATE','metadataFolder','12720muiLcK','default','jobStorePath','@flosum/salesforce','7761264VaOZoJ','apply','toString','execute','jszip','AxiosInstanceUtils','items','join','4cfMwPc','1558956DHxouM','6056EwjIbr','file','path','defineProperty','addWarning','(((.+)+)+)+$','../../constants','\x27\x20size\x20\x27','146886wRgACA','__esModule','push','1512IhAADa','1892owMZHH','Item\x20\x27','14835qcLjIK','makeDir','38100hAwjsY','base64','6UEfPTX','fileName','generateAsync','writeFile','./retrieve-factory','retrieveResultsPath','writeChunk','shortid','init','100KgUNTf','components','length','__importDefault'];a304_0xcb9a=function(){return _0x3b1cab;};return a304_0xcb9a();}'use strict';var __importDefault=this&&this[a304_0x37ba0d(0x1ab)]||function(_0x57214e){return _0x57214e&&_0x57214e['__esModule']?_0x57214e:{'default':_0x57214e};};Object[a304_0x37ba0d(0x1c6)](exports,a304_0x37ba0d(0x1cc),{'value':!![]});const salesforce_1=require(a304_0x37ba0d(0x1b8)),manifest_manger_1=__importDefault(require(a304_0x37ba0d(0x1b2))),path_1=__importDefault(require(a304_0x37ba0d(0x1c5))),promises_1=require('fs/promises'),fs_utils_1=require('../../../shared/utils/fs.utils'),object_sizeof_1=__importDefault(require('object-sizeof')),retrieve_factory_1=__importDefault(require(a304_0x37ba0d(0x1d9))),auth_manager_1=require('../../../shared/managers/auth.manager'),constants_1=require(a304_0x37ba0d(0x1c9)),shortid_1=__importDefault(require(a304_0x37ba0d(0x1a6))),jszip_1=__importDefault(require(a304_0x37ba0d(0x1bd)));class RetrieveMetadata{constructor(_0x1a55c0,_0x11d4fb,_0x3ce6f9){const _0x57c242=a304_0x37ba0d;this['jobStorePath']=_0x1a55c0,this[_0x57c242(0x1ad)]=_0x11d4fb,this['stateManager']=_0x3ce6f9,this[_0x57c242(0x1b4)]=path_1[_0x57c242(0x1b6)][_0x57c242(0x1c0)](this[_0x57c242(0x1b7)],constants_1['RETRIEVE_RESULT_FOLDER_NAME']),this[_0x57c242(0x1da)]=path_1[_0x57c242(0x1b6)][_0x57c242(0x1c0)](this[_0x57c242(0x1b7)],constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);}async['writeChunk'](_0x42f494){const _0xa4ac80=a304_0x37ba0d,_0x47d5bb=(0x0,shortid_1[_0xa4ac80(0x1b6)])();return await(0x0,promises_1[_0xa4ac80(0x1d8)])(path_1[_0xa4ac80(0x1b6)][_0xa4ac80(0x1c0)](this[_0xa4ac80(0x1b4)],_0x47d5bb+'.json'),JSON[_0xa4ac80(0x1ac)](_0x42f494)),_0x47d5bb;}async['execute'](){const _0x79c82e=a304_0x37ba0d,{credentials:_0x57e5a0,declarativeFilter:_0x5776e2,metadataTypes:_0x5a1c4e,maxChunkSize:_0x79d133,maxChunkItems:_0x50e6c5,apiVersion:_0x676c81}=await new manifest_manger_1[(_0x79c82e(0x1b6))](this[_0x79c82e(0x1b7)])[_0x79c82e(0x1a7)](),_0x369dda=await salesforce_1[_0x79c82e(0x1be)][_0x79c82e(0x1b0)](new auth_manager_1['AuthManager'](_0x57e5a0),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x555753=await retrieve_factory_1['default']['create'](_0x369dda,this['logger'],_0x5776e2,_0x5a1c4e,_0x676c81)[_0x79c82e(0x1bc)]();await(0x0,fs_utils_1[_0x79c82e(0x1d2)])(this[_0x79c82e(0x1b4)]);let _0xac0ee2=[];const _0xe305f6=[];let _0x11203b=0x0;for(const _0x2f4a63 in _0x555753[_0x79c82e(0x1bf)]){for(const {listMetadataItem:_0x4c7cbe,files:_0x36994b}of _0x555753[_0x79c82e(0x1bf)][_0x2f4a63][_0x79c82e(0x1a9)]){const _0x17a4e3=new jszip_1[(_0x79c82e(0x1b6))]();for(const _0x3238ef in _0x36994b){await _0x17a4e3[_0x79c82e(0x1c4)](_0x3238ef,_0x36994b[_0x3238ef]);}const _0xe8179f=await _0x17a4e3[_0x79c82e(0x1d7)]({'type':_0x79c82e(0x1d4),'compression':_0x79c82e(0x1b3),'compressionOptions':{'level':0x9}}),_0x3de9ea={..._0x4c7cbe,'zip':_0xe8179f},_0x54030b=(0x0,object_sizeof_1['default'])(_0x3de9ea);if(_0x54030b>_0x79d133){await this[_0x79c82e(0x1ae)][_0x79c82e(0x1c7)](_0x79c82e(0x1d0)+_0x4c7cbe[_0x79c82e(0x1d6)]+_0x79c82e(0x1ca)+_0x54030b+_0x79c82e(0x1af)+_0x79d133+'\x27');continue;}if(_0x11203b+_0x54030b>_0x79d133||_0xac0ee2[_0x79c82e(0x1aa)]>=_0x50e6c5){const _0x1b6b75=await this[_0x79c82e(0x1a5)](_0xac0ee2);_0xe305f6[_0x79c82e(0x1cd)](_0x1b6b75),_0x11203b=0x0,_0xac0ee2=[];}_0xac0ee2[_0x79c82e(0x1cd)](_0x3de9ea),_0x11203b+=_0x54030b;}}if(_0xac0ee2['length']){const _0x475db4=await this[_0x79c82e(0x1a5)](_0xac0ee2);_0xe305f6[_0x79c82e(0x1cd)](_0x475db4);}await(0x0,promises_1[_0x79c82e(0x1d8)])(this['retrieveResultsPath'],JSON[_0x79c82e(0x1ac)](_0xe305f6));}}exports[a304_0x37ba0d(0x1b6)]=RetrieveMetadata;