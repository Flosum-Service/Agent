const a314_0x4da5b1=a314_0x4dda;(function(_0x2fe29e,_0x1a656e){const _0x46c16e=a314_0x4dda,_0x39e94e=_0x2fe29e();while(!![]){try{const _0x58080b=-parseInt(_0x46c16e(0x1a1))/0x1*(parseInt(_0x46c16e(0x1ab))/0x2)+parseInt(_0x46c16e(0x1a2))/0x3+parseInt(_0x46c16e(0x196))/0x4+parseInt(_0x46c16e(0x1c2))/0x5+parseInt(_0x46c16e(0x1ad))/0x6+-parseInt(_0x46c16e(0x1c4))/0x7+parseInt(_0x46c16e(0x199))/0x8*(-parseInt(_0x46c16e(0x1b0))/0x9);if(_0x58080b===_0x1a656e)break;else _0x39e94e['push'](_0x39e94e['shift']());}catch(_0x4682ed){_0x39e94e['push'](_0x39e94e['shift']());}}}(a314_0x5366,0x5be34));const a314_0x3f0e1a=(function(){let _0x32fc18=!![];return function(_0x371557,_0x1590d6){const _0x48d957=_0x32fc18?function(){const _0x462fa9=a314_0x4dda;if(_0x1590d6){const _0x2fe7da=_0x1590d6[_0x462fa9(0x197)](_0x371557,arguments);return _0x1590d6=null,_0x2fe7da;}}:function(){};return _0x32fc18=![],_0x48d957;};}()),a314_0x554cbd=a314_0x3f0e1a(this,function(){const _0x336bf3=a314_0x4dda;return a314_0x554cbd['toString']()[_0x336bf3(0x1c3)](_0x336bf3(0x1b1))[_0x336bf3(0x1b2)]()[_0x336bf3(0x1ba)](a314_0x554cbd)['search'](_0x336bf3(0x1b1));});a314_0x554cbd();function a314_0x5366(){const _0x2d5f18=['2576418rsSmRD','fileName','default','241731eHBKoS','(((.+)+)+)+$','toString','jobStorePath','base64','logger','../../../shared/managers/auth.manager','../../constants','\x27\x20size\x20\x27','create','constructor','length','__importDefault','makeDir','@flosum/salesforce','retrieveResultsPath','AxiosInstanceUtils','.json','2530325hOkltY','search','2046058kdGRrK','init','Item\x20\x27','execute','stringify','RETRIEVE_RESULT_FOLDER_NAME','1172876QeIGRu','apply','metadataFolder','192cFFgmG','../../../shared/utils/fs.utils','components','push','AuthManager','join','object-sizeof','./manifest-manger','462809dkILuh','1642212NtCleV','items','RETRIEVE_RESULTS_IDS_FILENAME','stateManager','generateAsync','__esModule','writeChunk','file','fs/promises','2MCkpyz','writeFile'];a314_0x5366=function(){return _0x2d5f18;};return a314_0x5366();}'use strict';var __importDefault=this&&this[a314_0x4da5b1(0x1bc)]||function(_0x4217b5){const _0x2f7ffc=a314_0x4da5b1;return _0x4217b5&&_0x4217b5[_0x2f7ffc(0x1a7)]?_0x4217b5:{'default':_0x4217b5};};Object['defineProperty'](exports,a314_0x4da5b1(0x1a7),{'value':!![]});function a314_0x4dda(_0x3060b3,_0x35ccdf){const _0x5a7d24=a314_0x5366();return a314_0x4dda=function(_0x554cbd,_0x3f0e1a){_0x554cbd=_0x554cbd-0x194;let _0x53660e=_0x5a7d24[_0x554cbd];return _0x53660e;},a314_0x4dda(_0x3060b3,_0x35ccdf);}const salesforce_1=require(a314_0x4da5b1(0x1be)),manifest_manger_1=__importDefault(require(a314_0x4da5b1(0x1a0))),path_1=__importDefault(require('path')),promises_1=require(a314_0x4da5b1(0x1aa)),fs_utils_1=require(a314_0x4da5b1(0x19a)),object_sizeof_1=__importDefault(require(a314_0x4da5b1(0x19f))),retrieve_factory_1=__importDefault(require('./retrieve-factory')),auth_manager_1=require(a314_0x4da5b1(0x1b6)),constants_1=require(a314_0x4da5b1(0x1b7)),shortid_1=__importDefault(require('shortid')),jszip_1=__importDefault(require('jszip'));class RetrieveMetadata{constructor(_0x4f5c9c,_0x521023,_0x1e0b4c){const _0x55c995=a314_0x4da5b1;this[_0x55c995(0x1b3)]=_0x4f5c9c,this[_0x55c995(0x1b5)]=_0x521023,this[_0x55c995(0x1a5)]=_0x1e0b4c,this['metadataFolder']=path_1[_0x55c995(0x1af)][_0x55c995(0x19e)](this[_0x55c995(0x1b3)],constants_1[_0x55c995(0x195)]),this['retrieveResultsPath']=path_1[_0x55c995(0x1af)][_0x55c995(0x19e)](this[_0x55c995(0x1b3)],constants_1[_0x55c995(0x1a4)]);}async['writeChunk'](_0x2d1a8f){const _0x2be6a3=a314_0x4da5b1,_0x1c23bf=(0x0,shortid_1['default'])();return await(0x0,promises_1['writeFile'])(path_1['default'][_0x2be6a3(0x19e)](this[_0x2be6a3(0x198)],_0x1c23bf+_0x2be6a3(0x1c1)),JSON[_0x2be6a3(0x194)](_0x2d1a8f)),_0x1c23bf;}async['execute'](){const _0x42d5dc=a314_0x4da5b1,{credentials:_0x2afc76,declarativeFilter:_0x4cbce2,metadataTypes:_0x5ebaaf,maxChunkSize:_0x42032e,maxChunkItems:_0x5dad1d,apiVersion:_0x37b5d8}=await new manifest_manger_1[(_0x42d5dc(0x1af))](this[_0x42d5dc(0x1b3)])[_0x42d5dc(0x1c5)](),_0x182475=await salesforce_1[_0x42d5dc(0x1c0)][_0x42d5dc(0x1b9)](new auth_manager_1[(_0x42d5dc(0x19d))](_0x2afc76),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x2a43b6=await retrieve_factory_1[_0x42d5dc(0x1af)][_0x42d5dc(0x1b9)](_0x182475,this[_0x42d5dc(0x1b5)],_0x4cbce2,_0x5ebaaf,_0x37b5d8)[_0x42d5dc(0x1c7)]();await(0x0,fs_utils_1[_0x42d5dc(0x1bd)])(this[_0x42d5dc(0x198)]);let _0x24efa6=[];const _0x3fae33=[];let _0x10d1ca=0x0;for(const _0xeae27c in _0x2a43b6[_0x42d5dc(0x1a3)]){for(const {listMetadataItem:_0x3c7ea9,files:_0x20ae81}of _0x2a43b6[_0x42d5dc(0x1a3)][_0xeae27c][_0x42d5dc(0x19b)]){const _0x52b074=new jszip_1[(_0x42d5dc(0x1af))]();for(const _0x495540 in _0x20ae81){await _0x52b074[_0x42d5dc(0x1a9)](_0x495540,_0x20ae81[_0x495540]);}const _0x3a64e1=await _0x52b074[_0x42d5dc(0x1a6)]({'type':_0x42d5dc(0x1b4),'compression':'DEFLATE','compressionOptions':{'level':0x9}}),_0x2f10e6={..._0x3c7ea9,'zip':_0x3a64e1},_0x27f6da=(0x0,object_sizeof_1[_0x42d5dc(0x1af)])(_0x2f10e6);if(_0x27f6da>_0x42032e){await this['stateManager']['addWarning'](_0x42d5dc(0x1c6)+_0x3c7ea9[_0x42d5dc(0x1ae)]+_0x42d5dc(0x1b8)+_0x27f6da+'\x27\x20exceed\x20limit\x20\x27'+_0x42032e+'\x27');continue;}if(_0x10d1ca+_0x27f6da>_0x42032e||_0x24efa6['length']>=_0x5dad1d){const _0x1618c2=await this[_0x42d5dc(0x1a8)](_0x24efa6);_0x3fae33[_0x42d5dc(0x19c)](_0x1618c2),_0x10d1ca=0x0,_0x24efa6=[];}_0x24efa6[_0x42d5dc(0x19c)](_0x2f10e6),_0x10d1ca+=_0x27f6da;}}if(_0x24efa6[_0x42d5dc(0x1bb)]){const _0x471865=await this[_0x42d5dc(0x1a8)](_0x24efa6);_0x3fae33['push'](_0x471865);}await(0x0,promises_1[_0x42d5dc(0x1ac)])(this[_0x42d5dc(0x1bf)],JSON[_0x42d5dc(0x194)](_0x3fae33));}}exports[a314_0x4da5b1(0x1af)]=RetrieveMetadata;