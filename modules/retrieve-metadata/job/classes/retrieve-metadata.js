const a272_0xd4ea2d=a272_0x348f;(function(_0x484414,_0x45e1ed){const _0x58c87d=a272_0x348f,_0xd18132=_0x484414();while(!![]){try{const _0x3629e3=parseInt(_0x58c87d(0x1ca))/0x1+-parseInt(_0x58c87d(0x1b0))/0x2*(-parseInt(_0x58c87d(0x1c4))/0x3)+parseInt(_0x58c87d(0x1b5))/0x4*(-parseInt(_0x58c87d(0x1c8))/0x5)+parseInt(_0x58c87d(0x1d2))/0x6+-parseInt(_0x58c87d(0x1cd))/0x7*(-parseInt(_0x58c87d(0x1da))/0x8)+parseInt(_0x58c87d(0x1cc))/0x9+-parseInt(_0x58c87d(0x1b4))/0xa;if(_0x3629e3===_0x45e1ed)break;else _0xd18132['push'](_0xd18132['shift']());}catch(_0x45f174){_0xd18132['push'](_0xd18132['shift']());}}}(a272_0x2ab5,0x7c76f));const a272_0x330411=(function(){let _0x10f1b4=!![];return function(_0x1fad27,_0x38f1ef){const _0x168326=_0x10f1b4?function(){const _0x2a9482=a272_0x348f;if(_0x38f1ef){const _0x31aa09=_0x38f1ef[_0x2a9482(0x1b1)](_0x1fad27,arguments);return _0x38f1ef=null,_0x31aa09;}}:function(){};return _0x10f1b4=![],_0x168326;};}()),a272_0xcb45e3=a272_0x330411(this,function(){const _0x440540=a272_0x348f;return a272_0xcb45e3[_0x440540(0x1c3)]()['search'](_0x440540(0x1df))['toString']()['constructor'](a272_0xcb45e3)[_0x440540(0x1cf)]('(((.+)+)+)+$');});a272_0xcb45e3();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x574679){const _0x373d0e=a272_0x348f;return _0x574679&&_0x574679[_0x373d0e(0x1e2)]?_0x574679:{'default':_0x574679};};Object[a272_0xd4ea2d(0x1c6)](exports,'__esModule',{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a272_0xd4ea2d(0x1ce))),path_1=__importDefault(require(a272_0xd4ea2d(0x1cb))),promises_1=require('fs/promises'),fs_utils_1=require(a272_0xd4ea2d(0x1c1)),object_sizeof_1=__importDefault(require(a272_0xd4ea2d(0x1bf))),retrieve_factory_1=__importDefault(require(a272_0xd4ea2d(0x1d5))),auth_manager_1=require(a272_0xd4ea2d(0x1b9)),constants_1=require(a272_0xd4ea2d(0x1c0)),shortid_1=__importDefault(require(a272_0xd4ea2d(0x1d1))),jszip_1=__importDefault(require(a272_0xd4ea2d(0x1b2)));class RetrieveMetadata{constructor(_0x48c2c3,_0x3f2e50,_0x1c4af0){const _0x64f176=a272_0xd4ea2d;this['jobStorePath']=_0x48c2c3,this[_0x64f176(0x1b7)]=_0x3f2e50,this[_0x64f176(0x1be)]=_0x1c4af0,this[_0x64f176(0x1ba)]=path_1[_0x64f176(0x1bc)][_0x64f176(0x1db)](this[_0x64f176(0x1d0)],constants_1[_0x64f176(0x1c7)]),this[_0x64f176(0x1bd)]=path_1['default'][_0x64f176(0x1db)](this[_0x64f176(0x1d0)],constants_1[_0x64f176(0x1d9)]);}async[a272_0xd4ea2d(0x1c9)](_0x5673c0){const _0x3fc46d=a272_0xd4ea2d,_0x3070f5=(0x0,shortid_1[_0x3fc46d(0x1bc)])();return await(0x0,promises_1[_0x3fc46d(0x1b6)])(path_1[_0x3fc46d(0x1bc)][_0x3fc46d(0x1db)](this[_0x3fc46d(0x1ba)],_0x3070f5+'.json'),JSON[_0x3fc46d(0x1d6)](_0x5673c0)),_0x3070f5;}async[a272_0xd4ea2d(0x1e1)](){const _0x1021c3=a272_0xd4ea2d,{credentials:_0x51af4d,declarativeFilter:_0x53f85d,metadataTypes:_0x512b5b,maxChunkSize:_0x573a17,maxChunkItems:_0x5803bd,apiVersion:_0xd833a1}=await new manifest_manger_1[(_0x1021c3(0x1bc))](this['jobStorePath'])['init'](),_0x4ed412=await salesforce_1['AxiosInstanceUtils'][_0x1021c3(0x1d8)](new auth_manager_1[(_0x1021c3(0x1d7))](_0x51af4d),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x153be4=await retrieve_factory_1[_0x1021c3(0x1bc)][_0x1021c3(0x1d8)](_0x4ed412,this['logger'],_0x53f85d,_0x512b5b,_0xd833a1)[_0x1021c3(0x1e1)]();await(0x0,fs_utils_1[_0x1021c3(0x1b3)])(this['metadataFolder']);let _0x44eaca=[];const _0x2c55f0=[];let _0x261f8d=0x0;for(const _0x588a9a in _0x153be4[_0x1021c3(0x1bb)]){for(const {listMetadataItem:_0x58573d,files:_0x559332}of _0x153be4[_0x1021c3(0x1bb)][_0x588a9a][_0x1021c3(0x1d4)]){const _0x19fd29=new jszip_1[(_0x1021c3(0x1bc))]();for(const _0x451219 in _0x559332){await _0x19fd29[_0x1021c3(0x1b8)](_0x451219,_0x559332[_0x451219]);}const _0x2fbefd=await _0x19fd29['generateAsync']({'type':_0x1021c3(0x1c5),'compression':_0x1021c3(0x1dd),'compressionOptions':{'level':0x9}}),_0x315920={..._0x58573d,'zip':_0x2fbefd},_0x152da9=(0x0,object_sizeof_1[_0x1021c3(0x1bc)])(_0x315920);if(_0x152da9>_0x573a17){await this['stateManager'][_0x1021c3(0x1c2)](_0x1021c3(0x1d3)+_0x58573d[_0x1021c3(0x1de)]+_0x1021c3(0x1e0)+_0x152da9+'\x27\x20exceed\x20limit\x20\x27'+_0x573a17+'\x27');continue;}if(_0x261f8d+_0x152da9>_0x573a17||_0x44eaca[_0x1021c3(0x1dc)]>=_0x5803bd){const _0x327b23=await this[_0x1021c3(0x1c9)](_0x44eaca);_0x2c55f0[_0x1021c3(0x1af)](_0x327b23),_0x261f8d=0x0,_0x44eaca=[];}_0x44eaca['push'](_0x315920),_0x261f8d+=_0x152da9;}}if(_0x44eaca[_0x1021c3(0x1dc)]){const _0x40095f=await this[_0x1021c3(0x1c9)](_0x44eaca);_0x2c55f0[_0x1021c3(0x1af)](_0x40095f);}await(0x0,promises_1[_0x1021c3(0x1b6)])(this[_0x1021c3(0x1bd)],JSON[_0x1021c3(0x1d6)](_0x2c55f0));}}function a272_0x2ab5(){const _0x53f38d=['../../../shared/managers/auth.manager','metadataFolder','items','default','retrieveResultsPath','stateManager','object-sizeof','../../constants','../../../shared/utils/fs.utils','addWarning','toString','114LYcVzq','base64','defineProperty','RETRIEVE_RESULT_FOLDER_NAME','16060pjLSsY','writeChunk','101117GTIsSI','path','7039935KUeqoJ','38871MPmvfb','./manifest-manger','search','jobStorePath','shortid','2031858BEWBJt','Item\x20\x27','components','./retrieve-factory','stringify','AuthManager','create','RETRIEVE_RESULTS_IDS_FILENAME','168FrzZVl','join','length','DEFLATE','fileName','(((.+)+)+)+$','\x27\x20size\x20\x27','execute','__esModule','push','28038GgyPes','apply','jszip','makeDir','6195310vlJzyY','924xWEcFB','writeFile','logger','file'];a272_0x2ab5=function(){return _0x53f38d;};return a272_0x2ab5();}function a272_0x348f(_0x4a4324,_0x20ccf9){const _0x3e4c1b=a272_0x2ab5();return a272_0x348f=function(_0xcb45e3,_0x330411){_0xcb45e3=_0xcb45e3-0x1af;let _0x2ab571=_0x3e4c1b[_0xcb45e3];return _0x2ab571;},a272_0x348f(_0x4a4324,_0x20ccf9);}exports['default']=RetrieveMetadata;