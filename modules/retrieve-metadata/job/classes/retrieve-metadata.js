const a272_0x39279f=a272_0x50ae;(function(_0x3b52e4,_0x2f3ec0){const _0x27f011=a272_0x50ae,_0x24a42a=_0x3b52e4();while(!![]){try{const _0x29e2a0=parseInt(_0x27f011(0xa0))/0x1+parseInt(_0x27f011(0x9b))/0x2*(-parseInt(_0x27f011(0x9a))/0x3)+-parseInt(_0x27f011(0xc0))/0x4+parseInt(_0x27f011(0xc4))/0x5*(parseInt(_0x27f011(0xb1))/0x6)+parseInt(_0x27f011(0x9c))/0x7*(parseInt(_0x27f011(0x97))/0x8)+-parseInt(_0x27f011(0x94))/0x9*(parseInt(_0x27f011(0xc2))/0xa)+-parseInt(_0x27f011(0xb4))/0xb;if(_0x29e2a0===_0x2f3ec0)break;else _0x24a42a['push'](_0x24a42a['shift']());}catch(_0x4aefab){_0x24a42a['push'](_0x24a42a['shift']());}}}(a272_0xb5b7,0x4557c));function a272_0xb5b7(){const _0x245a65=['\x27\x20exceed\x20limit\x20\x27','AuthManager','retrieveResultsPath','fileName','writeChunk','../../constants','RETRIEVE_RESULTS_IDS_FILENAME','items','138jFtNhA','search','fs/promises','7184496MYWnYv','components','init','path','join','writeFile','__importDefault','Item\x20\x27','logger','metadataFolder','toString','defineProperty','316156vgLdij','jobStorePath','2755550ROPIxz','jszip','121580HsmcDr','(((.+)+)+)+$','base64','makeDir','__esModule','9aNoyxy','stringify','../../../shared/utils/fs.utils','8Rtmykn','object-sizeof','./retrieve-factory','11538ArdDrd','40RvRGlP','1907661feqQGZ','DEFLATE','push','stateManager','536887bkTclX','default','execute','length','./manifest-manger','../../../shared/managers/auth.manager','create','AxiosInstanceUtils','apply'];a272_0xb5b7=function(){return _0x245a65;};return a272_0xb5b7();}const a272_0x1cddde=(function(){let _0x26ffd0=!![];return function(_0x5240de,_0x5e6f24){const _0x1e9515=_0x26ffd0?function(){const _0x2aa62a=a272_0x50ae;if(_0x5e6f24){const _0x5edeeb=_0x5e6f24[_0x2aa62a(0xa8)](_0x5240de,arguments);return _0x5e6f24=null,_0x5edeeb;}}:function(){};return _0x26ffd0=![],_0x1e9515;};}()),a272_0x54f20f=a272_0x1cddde(this,function(){const _0x563fa5=a272_0x50ae;return a272_0x54f20f['toString']()[_0x563fa5(0xb2)](_0x563fa5(0xc5))[_0x563fa5(0xbe)]()['constructor'](a272_0x54f20f)[_0x563fa5(0xb2)]('(((.+)+)+)+$');});a272_0x54f20f();'use strict';var __importDefault=this&&this[a272_0x39279f(0xba)]||function(_0x34d9bf){const _0x1bea85=a272_0x39279f;return _0x34d9bf&&_0x34d9bf[_0x1bea85(0x93)]?_0x34d9bf:{'default':_0x34d9bf};};Object[a272_0x39279f(0xbf)](exports,a272_0x39279f(0x93),{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a272_0x39279f(0xa4))),path_1=__importDefault(require(a272_0x39279f(0xb7))),promises_1=require(a272_0x39279f(0xb3)),fs_utils_1=require(a272_0x39279f(0x96)),object_sizeof_1=__importDefault(require(a272_0x39279f(0x98))),retrieve_factory_1=__importDefault(require(a272_0x39279f(0x99))),auth_manager_1=require(a272_0x39279f(0xa5)),constants_1=require(a272_0x39279f(0xae)),shortid_1=__importDefault(require('shortid')),jszip_1=__importDefault(require(a272_0x39279f(0xc3)));function a272_0x50ae(_0x3bde6b,_0x58a7dc){const _0x338770=a272_0xb5b7();return a272_0x50ae=function(_0x54f20f,_0x1cddde){_0x54f20f=_0x54f20f-0x92;let _0xb5b7e4=_0x338770[_0x54f20f];return _0xb5b7e4;},a272_0x50ae(_0x3bde6b,_0x58a7dc);}class RetrieveMetadata{constructor(_0x1fa5f9,_0x2409d3,_0x3c3751){const _0x464fda=a272_0x39279f;this[_0x464fda(0xc1)]=_0x1fa5f9,this['logger']=_0x2409d3,this['stateManager']=_0x3c3751,this[_0x464fda(0xbd)]=path_1[_0x464fda(0xa1)]['join'](this[_0x464fda(0xc1)],constants_1['RETRIEVE_RESULT_FOLDER_NAME']),this[_0x464fda(0xab)]=path_1[_0x464fda(0xa1)]['join'](this['jobStorePath'],constants_1[_0x464fda(0xaf)]);}async[a272_0x39279f(0xad)](_0xce3826){const _0x24fbe9=a272_0x39279f,_0x5b667a=(0x0,shortid_1[_0x24fbe9(0xa1)])();return await(0x0,promises_1[_0x24fbe9(0xb9)])(path_1[_0x24fbe9(0xa1)][_0x24fbe9(0xb8)](this[_0x24fbe9(0xbd)],_0x5b667a+'.json'),JSON[_0x24fbe9(0x95)](_0xce3826)),_0x5b667a;}async[a272_0x39279f(0xa2)](){const _0x44e0d5=a272_0x39279f,{credentials:_0x24526b,declarativeFilter:_0x3b8af9,metadataTypes:_0x2a5fef,maxChunkSize:_0x4eb05a,maxChunkItems:_0x3c698c,apiVersion:_0x2800e2}=await new manifest_manger_1['default'](this[_0x44e0d5(0xc1)])[_0x44e0d5(0xb6)](),_0x2622e7=await salesforce_1[_0x44e0d5(0xa7)]['create'](new auth_manager_1[(_0x44e0d5(0xaa))](_0x24526b),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x3e614b=await retrieve_factory_1['default'][_0x44e0d5(0xa6)](_0x2622e7,this[_0x44e0d5(0xbc)],_0x3b8af9,_0x2a5fef,_0x2800e2)['execute']();await(0x0,fs_utils_1[_0x44e0d5(0x92)])(this['metadataFolder']);let _0x14a100=[];const _0x246b0f=[];let _0x106a2d=0x0;for(const _0x57c779 in _0x3e614b['items']){for(const {listMetadataItem:_0x1ec74a,files:_0x378571}of _0x3e614b[_0x44e0d5(0xb0)][_0x57c779][_0x44e0d5(0xb5)]){const _0x461ffb=new jszip_1[(_0x44e0d5(0xa1))]();for(const _0x3632e3 in _0x378571){await _0x461ffb['file'](_0x3632e3,_0x378571[_0x3632e3]);}const _0x21efb4=await _0x461ffb['generateAsync']({'type':_0x44e0d5(0xc6),'compression':_0x44e0d5(0x9d),'compressionOptions':{'level':0x9}}),_0x43d742={..._0x1ec74a,'zip':_0x21efb4},_0x553e10=(0x0,object_sizeof_1[_0x44e0d5(0xa1)])(_0x43d742);if(_0x553e10>_0x4eb05a){await this[_0x44e0d5(0x9f)]['addWarning'](_0x44e0d5(0xbb)+_0x1ec74a[_0x44e0d5(0xac)]+'\x27\x20size\x20\x27'+_0x553e10+_0x44e0d5(0xa9)+_0x4eb05a+'\x27');continue;}if(_0x106a2d+_0x553e10>_0x4eb05a||_0x14a100[_0x44e0d5(0xa3)]>=_0x3c698c){const _0x48ec41=await this[_0x44e0d5(0xad)](_0x14a100);_0x246b0f[_0x44e0d5(0x9e)](_0x48ec41),_0x106a2d=0x0,_0x14a100=[];}_0x14a100[_0x44e0d5(0x9e)](_0x43d742),_0x106a2d+=_0x553e10;}}if(_0x14a100[_0x44e0d5(0xa3)]){const _0x1bcb0a=await this['writeChunk'](_0x14a100);_0x246b0f[_0x44e0d5(0x9e)](_0x1bcb0a);}await(0x0,promises_1[_0x44e0d5(0xb9)])(this[_0x44e0d5(0xab)],JSON[_0x44e0d5(0x95)](_0x246b0f));}}exports[a272_0x39279f(0xa1)]=RetrieveMetadata;