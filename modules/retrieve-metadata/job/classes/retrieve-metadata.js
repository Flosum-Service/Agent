const a314_0x184b87=a314_0x3907;(function(_0x29fc56,_0xcbc297){const _0x45c592=a314_0x3907,_0x4a9dee=_0x29fc56();while(!![]){try{const _0x4f1d3d=parseInt(_0x45c592(0x135))/0x1+-parseInt(_0x45c592(0x130))/0x2*(parseInt(_0x45c592(0x129))/0x3)+parseInt(_0x45c592(0x13e))/0x4+parseInt(_0x45c592(0x151))/0x5+-parseInt(_0x45c592(0x143))/0x6*(-parseInt(_0x45c592(0x148))/0x7)+parseInt(_0x45c592(0x147))/0x8*(-parseInt(_0x45c592(0x144))/0x9)+parseInt(_0x45c592(0x12f))/0xa*(-parseInt(_0x45c592(0x121))/0xb);if(_0x4f1d3d===_0xcbc297)break;else _0x4a9dee['push'](_0x4a9dee['shift']());}catch(_0x168112){_0x4a9dee['push'](_0x4a9dee['shift']());}}}(a314_0x3342,0x1a67a));const a314_0x555ae6=(function(){let _0x5a04b3=!![];return function(_0x1d2b0b,_0x11d756){const _0x322fa1=_0x5a04b3?function(){const _0x40b89e=a314_0x3907;if(_0x11d756){const _0x3eedca=_0x11d756[_0x40b89e(0x123)](_0x1d2b0b,arguments);return _0x11d756=null,_0x3eedca;}}:function(){};return _0x5a04b3=![],_0x322fa1;};}()),a314_0x3b5833=a314_0x555ae6(this,function(){const _0x156cb1=a314_0x3907;return a314_0x3b5833[_0x156cb1(0x12b)]()[_0x156cb1(0x133)](_0x156cb1(0x13d))[_0x156cb1(0x12b)]()[_0x156cb1(0x145)](a314_0x3b5833)['search'](_0x156cb1(0x13d));});a314_0x3b5833();function a314_0x3907(_0x592d99,_0xf0d34e){const _0x18b852=a314_0x3342();return a314_0x3907=function(_0x3b5833,_0x555ae6){_0x3b5833=_0x3b5833-0x11f;let _0x3342b0=_0x18b852[_0x3b5833];return _0x3342b0;},a314_0x3907(_0x592d99,_0xf0d34e);}'use strict';function a314_0x3342(){const _0x125c7e=['\x27\x20size\x20\x27','generateAsync','items','57370xudIpz','200evUhMi','path','metadataFolder','search','RETRIEVE_RESULT_FOLDER_NAME','23843FSMbjN','join','./manifest-manger','object-sizeof','length','writeFile','jszip','makeDir','(((.+)+)+)+$','460524fUIBjq','\x27\x20exceed\x20limit\x20\x27','__esModule','defineProperty','../../../shared/managers/auth.manager','6DpHZOc','153hRAOLm','constructor','push','1888KreMkE','966532NoGNuw','shortid','Item\x20\x27','default','addWarning','AxiosInstanceUtils','DEFLATE','logger','components','261375ZkwPBl','execute','init','jobStorePath','writeChunk','77QhXuJX','fileName','apply','stateManager','AuthManager','file','retrieveResultsPath','../../../shared/utils/fs.utils','5310CpPXuW','./retrieve-factory','toString'];a314_0x3342=function(){return _0x125c7e;};return a314_0x3342();}var __importDefault=this&&this['__importDefault']||function(_0x3049ee){const _0x428e00=a314_0x3907;return _0x3049ee&&_0x3049ee[_0x428e00(0x140)]?_0x3049ee:{'default':_0x3049ee};};Object[a314_0x184b87(0x141)](exports,'__esModule',{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a314_0x184b87(0x137))),path_1=__importDefault(require(a314_0x184b87(0x131))),promises_1=require('fs/promises'),fs_utils_1=require(a314_0x184b87(0x128)),object_sizeof_1=__importDefault(require(a314_0x184b87(0x138))),retrieve_factory_1=__importDefault(require(a314_0x184b87(0x12a))),auth_manager_1=require(a314_0x184b87(0x142)),constants_1=require('../../constants'),shortid_1=__importDefault(require(a314_0x184b87(0x149))),jszip_1=__importDefault(require(a314_0x184b87(0x13b)));class RetrieveMetadata{constructor(_0x4e1b85,_0x525502,_0x2c4bd6){const _0x351d1a=a314_0x184b87;this[_0x351d1a(0x11f)]=_0x4e1b85,this[_0x351d1a(0x14f)]=_0x525502,this[_0x351d1a(0x124)]=_0x2c4bd6,this[_0x351d1a(0x132)]=path_1[_0x351d1a(0x14b)]['join'](this['jobStorePath'],constants_1[_0x351d1a(0x134)]),this[_0x351d1a(0x127)]=path_1[_0x351d1a(0x14b)][_0x351d1a(0x136)](this[_0x351d1a(0x11f)],constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);}async[a314_0x184b87(0x120)](_0x2d878a){const _0x57b3f3=a314_0x184b87,_0x49be8c=(0x0,shortid_1['default'])();return await(0x0,promises_1[_0x57b3f3(0x13a)])(path_1[_0x57b3f3(0x14b)][_0x57b3f3(0x136)](this[_0x57b3f3(0x132)],_0x49be8c+'.json'),JSON['stringify'](_0x2d878a)),_0x49be8c;}async[a314_0x184b87(0x152)](){const _0x4028d8=a314_0x184b87,{credentials:_0x3ce584,declarativeFilter:_0x319da8,metadataTypes:_0x26bcc0,maxChunkSize:_0x5132cb,maxChunkItems:_0x12b648,apiVersion:_0x4d28fb}=await new manifest_manger_1[(_0x4028d8(0x14b))](this[_0x4028d8(0x11f)])[_0x4028d8(0x153)](),_0x21ad2d=await salesforce_1[_0x4028d8(0x14d)]['create'](new auth_manager_1[(_0x4028d8(0x125))](_0x3ce584),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x436ab5=await retrieve_factory_1['default']['create'](_0x21ad2d,this['logger'],_0x319da8,_0x26bcc0,_0x4d28fb)[_0x4028d8(0x152)]();await(0x0,fs_utils_1[_0x4028d8(0x13c)])(this['metadataFolder']);let _0x3aafa5=[];const _0x25828a=[];let _0x466ff8=0x0;for(const _0x549aa3 in _0x436ab5['items']){for(const {listMetadataItem:_0x337547,files:_0x5e60bd}of _0x436ab5[_0x4028d8(0x12e)][_0x549aa3][_0x4028d8(0x150)]){const _0x1d2d53=new jszip_1[(_0x4028d8(0x14b))]();for(const _0x246ac4 in _0x5e60bd){await _0x1d2d53[_0x4028d8(0x126)](_0x246ac4,_0x5e60bd[_0x246ac4]);}const _0x57baed=await _0x1d2d53[_0x4028d8(0x12d)]({'type':'base64','compression':_0x4028d8(0x14e),'compressionOptions':{'level':0x9}}),_0x42e866={..._0x337547,'zip':_0x57baed},_0x3035d4=(0x0,object_sizeof_1[_0x4028d8(0x14b)])(_0x42e866);if(_0x3035d4>_0x5132cb){await this['stateManager'][_0x4028d8(0x14c)](_0x4028d8(0x14a)+_0x337547[_0x4028d8(0x122)]+_0x4028d8(0x12c)+_0x3035d4+_0x4028d8(0x13f)+_0x5132cb+'\x27');continue;}if(_0x466ff8+_0x3035d4>_0x5132cb||_0x3aafa5[_0x4028d8(0x139)]>=_0x12b648){const _0xa1d9b6=await this[_0x4028d8(0x120)](_0x3aafa5);_0x25828a[_0x4028d8(0x146)](_0xa1d9b6),_0x466ff8=0x0,_0x3aafa5=[];}_0x3aafa5[_0x4028d8(0x146)](_0x42e866),_0x466ff8+=_0x3035d4;}}if(_0x3aafa5[_0x4028d8(0x139)]){const _0x37bcc3=await this[_0x4028d8(0x120)](_0x3aafa5);_0x25828a[_0x4028d8(0x146)](_0x37bcc3);}await(0x0,promises_1[_0x4028d8(0x13a)])(this['retrieveResultsPath'],JSON['stringify'](_0x25828a));}}exports['default']=RetrieveMetadata;