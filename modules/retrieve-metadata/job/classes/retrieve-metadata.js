const a267_0x15eb18=a267_0x4eec;(function(_0x312602,_0x97ed15){const _0x2b0b07=a267_0x4eec,_0x2f203f=_0x312602();while(!![]){try{const _0x324a78=parseInt(_0x2b0b07(0x19b))/0x1+parseInt(_0x2b0b07(0x192))/0x2+parseInt(_0x2b0b07(0x198))/0x3+-parseInt(_0x2b0b07(0x183))/0x4+parseInt(_0x2b0b07(0x18d))/0x5*(-parseInt(_0x2b0b07(0x193))/0x6)+parseInt(_0x2b0b07(0x1a1))/0x7+parseInt(_0x2b0b07(0x19d))/0x8*(-parseInt(_0x2b0b07(0x18c))/0x9);if(_0x324a78===_0x97ed15)break;else _0x2f203f['push'](_0x2f203f['shift']());}catch(_0x443043){_0x2f203f['push'](_0x2f203f['shift']());}}}(a267_0x29b7,0x5f5e1));function a267_0x4eec(_0x683625,_0x131677){const _0x1ced21=a267_0x29b7();return a267_0x4eec=function(_0x2fffa8,_0x53b367){_0x2fffa8=_0x2fffa8-0x182;let _0x29b7da=_0x1ced21[_0x2fffa8];return _0x29b7da;},a267_0x4eec(_0x683625,_0x131677);}const a267_0x53b367=(function(){let _0xab7cea=!![];return function(_0x5db794,_0x5af46c){const _0x29377c=_0xab7cea?function(){const _0x4e362b=a267_0x4eec;if(_0x5af46c){const _0x22868c=_0x5af46c[_0x4e362b(0x1ad)](_0x5db794,arguments);return _0x5af46c=null,_0x22868c;}}:function(){};return _0xab7cea=![],_0x29377c;};}()),a267_0x2fffa8=a267_0x53b367(this,function(){const _0x4af286=a267_0x4eec;return a267_0x2fffa8[_0x4af286(0x1a9)]()[_0x4af286(0x189)](_0x4af286(0x190))['toString']()['constructor'](a267_0x2fffa8)[_0x4af286(0x189)](_0x4af286(0x190));});a267_0x2fffa8();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x206783){const _0x584c16=a267_0x4eec;return _0x206783&&_0x206783[_0x584c16(0x184)]?_0x206783:{'default':_0x206783};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const salesforce_1=require('@flosum/salesforce'),manifest_manger_1=__importDefault(require(a267_0x15eb18(0x191))),path_1=__importDefault(require('path')),promises_1=require('fs/promises'),fs_utils_1=require(a267_0x15eb18(0x18a)),object_sizeof_1=__importDefault(require(a267_0x15eb18(0x188))),retrieve_factory_1=__importDefault(require(a267_0x15eb18(0x199))),auth_manager_1=require(a267_0x15eb18(0x197)),constants_1=require(a267_0x15eb18(0x19f)),shortid_1=__importDefault(require(a267_0x15eb18(0x1a2))),jszip_1=__importDefault(require(a267_0x15eb18(0x1a0)));class RetrieveMetadata{constructor(_0x5358de,_0x355bf2,_0x250b56){const _0x349859=a267_0x15eb18;this[_0x349859(0x1a8)]=_0x5358de,this['logger']=_0x355bf2,this[_0x349859(0x1a5)]=_0x250b56,this['metadataFolder']=path_1['default']['join'](this['jobStorePath'],constants_1['RETRIEVE_RESULT_FOLDER_NAME']),this['retrieveResultsPath']=path_1[_0x349859(0x185)]['join'](this['jobStorePath'],constants_1[_0x349859(0x1a3)]);}async[a267_0x15eb18(0x186)](_0x2d81ea){const _0x54da93=a267_0x15eb18,_0x3b3772=(0x0,shortid_1[_0x54da93(0x185)])();return await(0x0,promises_1[_0x54da93(0x194)])(path_1['default'][_0x54da93(0x1a7)](this[_0x54da93(0x1a4)],_0x3b3772+'.json'),JSON['stringify'](_0x2d81ea)),_0x3b3772;}async[a267_0x15eb18(0x1ac)](){const _0x104e8b=a267_0x15eb18,{credentials:_0x3fdda0,declarativeFilter:_0x47ea3f,metadataTypes:_0x39f5a9,maxChunkSize:_0xc2e223,maxChunkItems:_0x8efdb2,apiVersion:_0x5195b6}=await new manifest_manger_1[(_0x104e8b(0x185))](this[_0x104e8b(0x1a8)])[_0x104e8b(0x19e)](),_0x214897=await salesforce_1['AxiosInstanceUtils'][_0x104e8b(0x195)](new auth_manager_1[(_0x104e8b(0x19c))](_0x3fdda0),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),_0x52020b=await retrieve_factory_1[_0x104e8b(0x185)][_0x104e8b(0x195)](_0x214897,this['logger'],_0x47ea3f,_0x39f5a9,_0x5195b6)['execute']();await(0x0,fs_utils_1['makeDir'])(this[_0x104e8b(0x1a4)]);let _0x2993f6=[];const _0x31fb98=[];let _0x2e4a58=0x0;for(const _0x383d8c in _0x52020b[_0x104e8b(0x196)]){for(const {listMetadataItem:_0x4f8395,files:_0x208ef1}of _0x52020b[_0x104e8b(0x196)][_0x383d8c][_0x104e8b(0x182)]){const _0x3468c8=new jszip_1['default']();for(const _0x55a83f in _0x208ef1){await _0x3468c8[_0x104e8b(0x1aa)](_0x55a83f,_0x208ef1[_0x55a83f]);}const _0x43410d=await _0x3468c8[_0x104e8b(0x18e)]({'type':_0x104e8b(0x18f),'compression':_0x104e8b(0x187),'compressionOptions':{'level':0x9}}),_0x2ef615={..._0x4f8395,'zip':_0x43410d},_0x109431=(0x0,object_sizeof_1['default'])(_0x2ef615);if(_0x109431>_0xc2e223){await this[_0x104e8b(0x1a5)][_0x104e8b(0x1ab)]('Item\x20\x27'+_0x4f8395['fileName']+'\x27\x20size\x20\x27'+_0x109431+'\x27\x20exceed\x20limit\x20\x27'+_0xc2e223+'\x27');continue;}if(_0x2e4a58+_0x109431>_0xc2e223||_0x2993f6[_0x104e8b(0x19a)]>=_0x8efdb2){const _0x167fc3=await this['writeChunk'](_0x2993f6);_0x31fb98['push'](_0x167fc3),_0x2e4a58=0x0,_0x2993f6=[];}_0x2993f6['push'](_0x2ef615),_0x2e4a58+=_0x109431;}}if(_0x2993f6[_0x104e8b(0x19a)]){const _0x3751f2=await this[_0x104e8b(0x186)](_0x2993f6);_0x31fb98['push'](_0x3751f2);}await(0x0,promises_1[_0x104e8b(0x194)])(this[_0x104e8b(0x1a6)],JSON[_0x104e8b(0x18b)](_0x31fb98));}}exports[a267_0x15eb18(0x185)]=RetrieveMetadata;function a267_0x29b7(){const _0x31b0c2=['addWarning','execute','apply','components','339084ylEWfy','__esModule','default','writeChunk','DEFLATE','object-sizeof','search','../../../shared/utils/fs.utils','stringify','18TSgnaB','2929685VOaEZW','generateAsync','base64','(((.+)+)+)+$','./manifest-manger','997414ZpfXhX','6dvIuMa','writeFile','create','items','../../../shared/managers/auth.manager','2297040EUBRvT','./retrieve-factory','length','498811Jpqqio','AuthManager','3049784lrErSo','init','../../constants','jszip','424067FhuiBn','shortid','RETRIEVE_RESULTS_IDS_FILENAME','metadataFolder','stateManager','retrieveResultsPath','join','jobStorePath','toString','file'];a267_0x29b7=function(){return _0x31b0c2;};return a267_0x29b7();}