const a293_0x16734d=a293_0x59f0;(function(_0x275b35,_0x592d3c){const _0x4958f9=a293_0x59f0,_0x345b1c=_0x275b35();while(!![]){try{const _0x5ec14d=-parseInt(_0x4958f9(0xf2))/0x1*(-parseInt(_0x4958f9(0xe1))/0x2)+-parseInt(_0x4958f9(0xd0))/0x3*(parseInt(_0x4958f9(0xd6))/0x4)+parseInt(_0x4958f9(0xe6))/0x5*(parseInt(_0x4958f9(0xc4))/0x6)+parseInt(_0x4958f9(0xe7))/0x7*(-parseInt(_0x4958f9(0xce))/0x8)+-parseInt(_0x4958f9(0xde))/0x9*(-parseInt(_0x4958f9(0xc1))/0xa)+parseInt(_0x4958f9(0xeb))/0xb+parseInt(_0x4958f9(0xc9))/0xc*(-parseInt(_0x4958f9(0xd2))/0xd);if(_0x5ec14d===_0x592d3c)break;else _0x345b1c['push'](_0x345b1c['shift']());}catch(_0x24855e){_0x345b1c['push'](_0x345b1c['shift']());}}}(a293_0xeaac,0x8a7f3));function a293_0x59f0(_0x1c3a83,_0x4adf19){const _0x4931bd=a293_0xeaac();return a293_0x59f0=function(_0x11691b,_0x48a4a9){_0x11691b=_0x11691b-0xbe;let _0xeaac4a=_0x4931bd[_0x11691b];return _0xeaac4a;},a293_0x59f0(_0x1c3a83,_0x4adf19);}const a293_0x48a4a9=(function(){let _0x32c899=!![];return function(_0x5c5ec6,_0xe5822c){const _0x3f7192=_0x32c899?function(){const _0x51e043=a293_0x59f0;if(_0xe5822c){const _0x4d34bc=_0xe5822c[_0x51e043(0xe8)](_0x5c5ec6,arguments);return _0xe5822c=null,_0x4d34bc;}}:function(){};return _0x32c899=![],_0x3f7192;};}()),a293_0x11691b=a293_0x48a4a9(this,function(){const _0x555ce3=a293_0x59f0;return a293_0x11691b['toString']()[_0x555ce3(0xda)]('(((.+)+)+)+$')[_0x555ce3(0xdb)]()[_0x555ce3(0xf7)](a293_0x11691b)[_0x555ce3(0xda)]('(((.+)+)+)+$');});a293_0x11691b();'use strict';function a293_0xeaac(){const _0x204b31=['apply','.json','isExistsPath','9666118jbojev','runJob','getJobState','Job\x20not\x20completed.','generateJobId','slice','then','36737oBUVTR','dataPath','sortJobsIds','RETRIEVE_RESULT_FOLDER_NAME','setError','constructor','utf-8','NotFoundError','../../shared/managers/state-manger','getJobsIds','catch','810010fsmusG','JobStatus','retrieveMetadataFolder','1114878aHUAmy','getJobLogs','BadRequestError','readFile','data','24pBessW','FsUtils','parse','create','getResult','416fEQfQi','join','1296SCDVtO','../../../core/errors/not-found.error','9488726znZjMT','RETRIEVE_METADATA_FOLDER_NAME','makeDir','../../shared/enums/logger.enums','3660pxvCmz','__esModule','../constants','@flosum/utils','search','toString','getJobStatus','../../../configs/path','27JepIkC','path','../../../core/errors/bad-request.error','46nVyEkW','fs/promises','../../shared/utils/fs.utils','Job\x20log\x20not\x20found.','default','15kgwFXr','13699tyDXvY'];a293_0xeaac=function(){return _0x204b31;};return a293_0xeaac();}var __importDefault=this&&this['__importDefault']||function(_0x3a163e){const _0x5df875=a293_0x59f0;return _0x3a163e&&_0x3a163e[_0x5df875(0xd7)]?_0x3a163e:{'default':_0x3a163e};};Object['defineProperty'](exports,a293_0x16734d(0xd7),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a293_0x16734d(0xdf))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a293_0x16734d(0xbe))),promises_1=require(a293_0x16734d(0xe2)),utils_1=require(a293_0x16734d(0xd9)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a293_0x16734d(0xd1)),logger_enums_1=require(a293_0x16734d(0xd5)),bad_request_error_1=require(a293_0x16734d(0xe0)),job_1=require('../../../constants/job'),fs_utils_1=require(a293_0x16734d(0xe3)),constants_1=require(a293_0x16734d(0xd8)),path_2=require(a293_0x16734d(0xdd));class RetrieveMetadataService{static async['getJobs'](_0x4f59ed,_0x34b190){const _0x470e7d=a293_0x16734d,_0x107d73=await job_utils_1[_0x470e7d(0xe5)][_0x470e7d(0xbf)](RetrieveMetadataService[_0x470e7d(0xc3)]),_0x479edc=await job_utils_1['default'][_0x470e7d(0xf4)](RetrieveMetadataService['retrieveMetadataFolder'],_0x107d73),_0x4395e5=_0x479edc[_0x470e7d(0xf0)](_0x34b190,_0x34b190+_0x4f59ed),_0x2af60c=[];for(const _0x1810f6 of _0x4395e5){const _0x4750b1=await state_manger_1[_0x470e7d(0xe5)]['getJobState'](path_1[_0x470e7d(0xe5)][_0x470e7d(0xcf)](RetrieveMetadataService[_0x470e7d(0xc3)],_0x1810f6));_0x2af60c['push'](_0x4750b1);}return _0x2af60c;}static async['createRetrieveJob'](_0xe1de75){const _0xa659a2=a293_0x16734d,_0x578065=job_utils_1[_0xa659a2(0xe5)][_0xa659a2(0xef)](),_0x327847=path_1[_0xa659a2(0xe5)]['join'](RetrieveMetadataService[_0xa659a2(0xc3)],_0x578065);await(0x0,fs_utils_1[_0xa659a2(0xd4)])(_0x327847),await manifest_manger_1[_0xa659a2(0xe5)]['create'](_0x327847,_0xe1de75),await state_manger_1['default'][_0xa659a2(0xcc)](_0x327847,_0x578065);const _0x4550c6=path_1['default']['join'](__dirname,job_1['JOB_PATH']);return job_utils_1[_0xa659a2(0xe5)][_0xa659a2(0xec)](_0x4550c6,{'jobStorePath':_0x327847,'jobId':_0x578065})[_0xa659a2(0xc0)](async _0x240fa5=>{const _0x40ebd1=_0xa659a2,_0x1a8ad3=new state_manger_1['default'](_0x327847);await _0x1a8ad3['init'](),await _0x1a8ad3[_0x40ebd1(0xf6)](_0x240fa5);}),{'jobId':_0x578065};}static async[a293_0x16734d(0xcd)](_0x219f82){const _0x3efa3d=a293_0x16734d,{status:_0x586aef}=await RetrieveMetadataService['getJobStatus'](_0x219f82);if(_0x586aef===logger_enums_1[_0x3efa3d(0xc2)]['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError'](_0x3efa3d(0xee));const _0x46683e=path_1['default'][_0x3efa3d(0xcf)](RetrieveMetadataService[_0x3efa3d(0xc3)],_0x219f82,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x3efa3d(0xca)][_0x3efa3d(0xea)](_0x46683e))return(0x0,promises_1[_0x3efa3d(0xc7)])(_0x46683e,_0x3efa3d(0xf8))[_0x3efa3d(0xf1)](JSON[_0x3efa3d(0xcb)]);else throw new not_found_error_1[(_0x3efa3d(0xf9))]('Result\x20not\x20found.');}static async['getResultChunk'](_0x5df8a4,_0x3879fa){const _0x117df8=a293_0x16734d,{status:_0x22c941}=await RetrieveMetadataService[_0x117df8(0xdc)](_0x5df8a4);if(_0x22c941===logger_enums_1['JobStatus']['IN_PROGRESS'])throw new bad_request_error_1[(_0x117df8(0xc6))](_0x117df8(0xee));const _0x15b0da=path_1[_0x117df8(0xe5)][_0x117df8(0xcf)](RetrieveMetadataService[_0x117df8(0xc3)],_0x5df8a4,constants_1[_0x117df8(0xf5)]),_0x3961b1={'data':[]};if(await utils_1['FsUtils'][_0x117df8(0xea)](path_1['default'][_0x117df8(0xcf)](_0x15b0da,_0x3879fa+_0x117df8(0xe9))))_0x3961b1[_0x117df8(0xc8)]=await(0x0,promises_1[_0x117df8(0xc7)])(path_1[_0x117df8(0xe5)][_0x117df8(0xcf)](_0x15b0da,_0x3879fa+_0x117df8(0xe9)),'utf-8')[_0x117df8(0xf1)](JSON['parse']);else throw new not_found_error_1[(_0x117df8(0xf9))]('Chunk\x20not\x20found.');return _0x3961b1;}static async[a293_0x16734d(0xdc)](_0x4c3487){const _0xf0ece1=a293_0x16734d;try{return await state_manger_1[_0xf0ece1(0xe5)][_0xf0ece1(0xed)](path_1[_0xf0ece1(0xe5)][_0xf0ece1(0xcf)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4c3487));}catch(_0x2bbbde){throw new not_found_error_1['NotFoundError'](_0x2bbbde);}}static async[a293_0x16734d(0xc5)](_0x54eb9c){const _0x52ac6f=a293_0x16734d,_0x8272f0=path_1[_0x52ac6f(0xe5)][_0x52ac6f(0xcf)](RetrieveMetadataService[_0x52ac6f(0xc3)],_0x54eb9c,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1['FsUtils']['isExistsPath'](_0x8272f0))return(0x0,promises_1[_0x52ac6f(0xc7)])(_0x8272f0,_0x52ac6f(0xf8))['then'](_0x35666f=>csv_utils_1['default'][_0x52ac6f(0xcb)](_0x35666f,{'columns':!![]}));throw new not_found_error_1[(_0x52ac6f(0xf9))](_0x52ac6f(0xe4));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a293_0x16734d(0xe5)][a293_0x16734d(0xcf)](path_2[a293_0x16734d(0xf3)],constants_1[a293_0x16734d(0xd3)]);