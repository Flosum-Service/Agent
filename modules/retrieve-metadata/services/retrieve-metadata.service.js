function a319_0x2e91(_0x319de3,_0x2fc7ea){const _0x5bc0fd=a319_0x1458();return a319_0x2e91=function(_0x105194,_0xbf0dd1){_0x105194=_0x105194-0x11e;let _0x1458b2=_0x5bc0fd[_0x105194];return _0x1458b2;},a319_0x2e91(_0x319de3,_0x2fc7ea);}const a319_0x53fbd4=a319_0x2e91;(function(_0xe3dde3,_0x402946){const _0x3e2c26=a319_0x2e91,_0x8f2a45=_0xe3dde3();while(!![]){try{const _0x28872e=parseInt(_0x3e2c26(0x147))/0x1+-parseInt(_0x3e2c26(0x127))/0x2+-parseInt(_0x3e2c26(0x12a))/0x3*(parseInt(_0x3e2c26(0x12f))/0x4)+-parseInt(_0x3e2c26(0x154))/0x5*(parseInt(_0x3e2c26(0x139))/0x6)+parseInt(_0x3e2c26(0x123))/0x7+parseInt(_0x3e2c26(0x135))/0x8+-parseInt(_0x3e2c26(0x14e))/0x9;if(_0x28872e===_0x402946)break;else _0x8f2a45['push'](_0x8f2a45['shift']());}catch(_0x431366){_0x8f2a45['push'](_0x8f2a45['shift']());}}}(a319_0x1458,0x2ae7c));const a319_0xbf0dd1=(function(){let _0xa9a63=!![];return function(_0x20fe9a,_0x4ec9a8){const _0x11600a=_0xa9a63?function(){if(_0x4ec9a8){const _0xa3db0b=_0x4ec9a8['apply'](_0x20fe9a,arguments);return _0x4ec9a8=null,_0xa3db0b;}}:function(){};return _0xa9a63=![],_0x11600a;};}()),a319_0x105194=a319_0xbf0dd1(this,function(){const _0x4a2ddc=a319_0x2e91;return a319_0x105194[_0x4a2ddc(0x132)]()[_0x4a2ddc(0x14d)](_0x4a2ddc(0x14b))[_0x4a2ddc(0x132)]()[_0x4a2ddc(0x149)](a319_0x105194)[_0x4a2ddc(0x14d)]('(((.+)+)+)+$');});function a319_0x1458(){const _0x2882a8=['getJobStatus','getResult','sortJobsIds','JOB_PATH','../../shared/enums/logger.enums','RETRIEVE_METADATA_FOLDER_NAME','BadRequestError','1776446NGZTCJ','default','path','defineProperty','270516LwoJqW','runJob','join','12fkGytk','readFile','fs/promises','NotFoundError','../job/classes/manifest-manger','45512IvTeMp','../../../core/errors/not-found.error','FsUtils','toString','makeDir','../../shared/utils/csv.utils','2314984SDGlmn','getJobsIds','createRetrieveJob','IN_PROGRESS','777486xYnquX','isExistsPath','create','getJobLogs','Job\x20log\x20not\x20found.','Result\x20not\x20found.','retrieveMetadataFolder','setError','RETRIEVE_RESULT_FOLDER_NAME','../constants','slice','../../shared/utils/fs.utils','.json','JOB_LOG_DETAILS_FILENAME','3028nzTDMy','getJobState','constructor','utf-8','(((.+)+)+)+$','../../../constants/job','search','540792AywdSK','Job\x20not\x20completed.','generateJobId','then','../../shared/managers/state-manger','__importDefault','5OtRjGT','catch','__esModule','Chunk\x20not\x20found.','parse'];a319_0x1458=function(){return _0x2882a8;};return a319_0x1458();}a319_0x105194();'use strict';var __importDefault=this&&this[a319_0x53fbd4(0x153)]||function(_0x1ad8f7){const _0x5d5582=a319_0x53fbd4;return _0x1ad8f7&&_0x1ad8f7[_0x5d5582(0x156)]?_0x1ad8f7:{'default':_0x1ad8f7};};Object[a319_0x53fbd4(0x126)](exports,a319_0x53fbd4(0x156),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a319_0x53fbd4(0x125))),manifest_manger_1=__importDefault(require(a319_0x53fbd4(0x12e))),state_manger_1=__importDefault(require(a319_0x53fbd4(0x152))),promises_1=require(a319_0x53fbd4(0x12c)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a319_0x53fbd4(0x134))),not_found_error_1=require(a319_0x53fbd4(0x130)),logger_enums_1=require(a319_0x53fbd4(0x120)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require(a319_0x53fbd4(0x14c)),fs_utils_1=require(a319_0x53fbd4(0x144)),constants_1=require(a319_0x53fbd4(0x142)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async['getJobs'](_0x531c75,_0x4de094){const _0x24d405=a319_0x53fbd4,_0x5403d1=await job_utils_1[_0x24d405(0x124)][_0x24d405(0x136)](RetrieveMetadataService[_0x24d405(0x13f)]),_0x5d4d23=await job_utils_1[_0x24d405(0x124)][_0x24d405(0x11e)](RetrieveMetadataService[_0x24d405(0x13f)],_0x5403d1),_0x4b103a=_0x5d4d23[_0x24d405(0x143)](_0x4de094,_0x4de094+_0x531c75),_0x402f34=[];for(const _0x479192 of _0x4b103a){const _0x1a42b9=await state_manger_1[_0x24d405(0x124)][_0x24d405(0x148)](path_1[_0x24d405(0x124)]['join'](RetrieveMetadataService[_0x24d405(0x13f)],_0x479192));_0x402f34['push'](_0x1a42b9);}return _0x402f34;}static async[a319_0x53fbd4(0x137)](_0x485239){const _0xc97d7e=a319_0x53fbd4,_0x22f029=job_utils_1[_0xc97d7e(0x124)][_0xc97d7e(0x150)](),_0x4f2c73=path_1[_0xc97d7e(0x124)][_0xc97d7e(0x129)](RetrieveMetadataService[_0xc97d7e(0x13f)],_0x22f029);await(0x0,fs_utils_1[_0xc97d7e(0x133)])(_0x4f2c73),await manifest_manger_1[_0xc97d7e(0x124)][_0xc97d7e(0x13b)](_0x4f2c73,_0x485239),await state_manger_1[_0xc97d7e(0x124)][_0xc97d7e(0x13b)](_0x4f2c73,_0x22f029);const _0x334103=path_1[_0xc97d7e(0x124)][_0xc97d7e(0x129)](__dirname,job_1[_0xc97d7e(0x11f)]);return job_utils_1['default'][_0xc97d7e(0x128)](_0x334103,{'jobStorePath':_0x4f2c73,'jobId':_0x22f029})[_0xc97d7e(0x155)](async _0x55db49=>{const _0x4811e4=_0xc97d7e,_0x44d935=new state_manger_1['default'](_0x4f2c73);await _0x44d935['init'](),await _0x44d935[_0x4811e4(0x140)](_0x55db49);}),{'jobId':_0x22f029};}static async[a319_0x53fbd4(0x15a)](_0x2c0dfa){const _0x50fc3a=a319_0x53fbd4,{status:_0x587434}=await RetrieveMetadataService['getJobStatus'](_0x2c0dfa);if(_0x587434===logger_enums_1['JobStatus'][_0x50fc3a(0x138)])throw new bad_request_error_1[(_0x50fc3a(0x122))](_0x50fc3a(0x14f));const _0x5e915f=path_1[_0x50fc3a(0x124)]['join'](RetrieveMetadataService[_0x50fc3a(0x13f)],_0x2c0dfa,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x50fc3a(0x131)][_0x50fc3a(0x13a)](_0x5e915f))return(0x0,promises_1[_0x50fc3a(0x12b)])(_0x5e915f,_0x50fc3a(0x14a))[_0x50fc3a(0x151)](JSON[_0x50fc3a(0x158)]);else throw new not_found_error_1['NotFoundError'](_0x50fc3a(0x13e));}static async['getResultChunk'](_0x2d5160,_0x8afefe){const _0x1b0254=a319_0x53fbd4,{status:_0x4de6ad}=await RetrieveMetadataService['getJobStatus'](_0x2d5160);if(_0x4de6ad===logger_enums_1['JobStatus'][_0x1b0254(0x138)])throw new bad_request_error_1['BadRequestError'](_0x1b0254(0x14f));const _0x64deda=path_1[_0x1b0254(0x124)][_0x1b0254(0x129)](RetrieveMetadataService[_0x1b0254(0x13f)],_0x2d5160,constants_1[_0x1b0254(0x141)]),_0x4f010e={'data':[]};if(await utils_1['FsUtils'][_0x1b0254(0x13a)](path_1[_0x1b0254(0x124)]['join'](_0x64deda,_0x8afefe+_0x1b0254(0x145))))_0x4f010e['data']=await(0x0,promises_1[_0x1b0254(0x12b)])(path_1[_0x1b0254(0x124)][_0x1b0254(0x129)](_0x64deda,_0x8afefe+_0x1b0254(0x145)),'utf-8')[_0x1b0254(0x151)](JSON[_0x1b0254(0x158)]);else throw new not_found_error_1[(_0x1b0254(0x12d))](_0x1b0254(0x157));return _0x4f010e;}static async[a319_0x53fbd4(0x159)](_0x45f2a8){const _0x4e704a=a319_0x53fbd4;try{return await state_manger_1[_0x4e704a(0x124)][_0x4e704a(0x148)](path_1[_0x4e704a(0x124)][_0x4e704a(0x129)](RetrieveMetadataService[_0x4e704a(0x13f)],_0x45f2a8));}catch(_0x330c0a){throw new not_found_error_1['NotFoundError'](_0x330c0a);}}static async[a319_0x53fbd4(0x13c)](_0x95c283){const _0x3b3d80=a319_0x53fbd4,_0x25940d=path_1[_0x3b3d80(0x124)][_0x3b3d80(0x129)](RetrieveMetadataService[_0x3b3d80(0x13f)],_0x95c283,job_1[_0x3b3d80(0x146)]);if(await utils_1[_0x3b3d80(0x131)][_0x3b3d80(0x13a)](_0x25940d))return(0x0,promises_1[_0x3b3d80(0x12b)])(_0x25940d,_0x3b3d80(0x14a))['then'](_0x3da87c=>csv_utils_1[_0x3b3d80(0x124)]['parse'](_0x3da87c,{'columns':!![]}));throw new not_found_error_1[(_0x3b3d80(0x12d))](_0x3b3d80(0x13d));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a319_0x53fbd4(0x124)][a319_0x53fbd4(0x129)](path_2['dataPath'],constants_1[a319_0x53fbd4(0x121)]);