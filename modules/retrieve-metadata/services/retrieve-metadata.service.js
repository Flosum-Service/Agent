const a272_0x448490=a272_0x214d;(function(_0x132748,_0x2f6c1d){const _0x3f077e=a272_0x214d,_0x5e11b0=_0x132748();while(!![]){try{const _0x1f5ffa=-parseInt(_0x3f077e(0xaf))/0x1+-parseInt(_0x3f077e(0xb1))/0x2+parseInt(_0x3f077e(0xd5))/0x3+-parseInt(_0x3f077e(0xa7))/0x4+-parseInt(_0x3f077e(0xc5))/0x5*(parseInt(_0x3f077e(0xab))/0x6)+-parseInt(_0x3f077e(0xcb))/0x7*(parseInt(_0x3f077e(0xe4))/0x8)+parseInt(_0x3f077e(0xba))/0x9;if(_0x1f5ffa===_0x2f6c1d)break;else _0x5e11b0['push'](_0x5e11b0['shift']());}catch(_0x5e40cf){_0x5e11b0['push'](_0x5e11b0['shift']());}}}(a272_0x3567,0x95881));function a272_0x214d(_0x3e69f0,_0x62d604){const _0x592dff=a272_0x3567();return a272_0x214d=function(_0x49c037,_0x333e37){_0x49c037=_0x49c037-0xa2;let _0x356736=_0x592dff[_0x49c037];return _0x356736;},a272_0x214d(_0x3e69f0,_0x62d604);}const a272_0x333e37=(function(){let _0x2dbd8b=!![];return function(_0x2dacd8,_0x32ee9f){const _0x351e4a=_0x2dbd8b?function(){const _0x2b5a6c=a272_0x214d;if(_0x32ee9f){const _0x3ae76f=_0x32ee9f[_0x2b5a6c(0xb7)](_0x2dacd8,arguments);return _0x32ee9f=null,_0x3ae76f;}}:function(){};return _0x2dbd8b=![],_0x351e4a;};}()),a272_0x49c037=a272_0x333e37(this,function(){const _0x17bfa6=a272_0x214d;return a272_0x49c037['toString']()['search'](_0x17bfa6(0xc2))[_0x17bfa6(0xdd)]()[_0x17bfa6(0xb5)](a272_0x49c037)[_0x17bfa6(0xe2)]('(((.+)+)+)+$');});a272_0x49c037();'use strict';var __importDefault=this&&this[a272_0x448490(0xc1)]||function(_0x46c55f){const _0x5c74e9=a272_0x448490;return _0x46c55f&&_0x46c55f[_0x5c74e9(0xd0)]?_0x46c55f:{'default':_0x46c55f};};Object['defineProperty'](exports,a272_0x448490(0xd0),{'value':!![]});function a272_0x3567(){const _0x3a430e=['__importDefault','(((.+)+)+)+$','slice','data','460sPCJWq','setError','create','getJobState','then','../../../core/errors/bad-request.error','21fDmDCV','init','getJobs','RETRIEVE_RESULT_FOLDER_NAME','generateJobId','__esModule','@flosum/utils','Job\x20not\x20completed.','makeDir','default','180177pJOlkj','../../../core/errors/not-found.error','push','../constants','Chunk\x20not\x20found.','../../shared/utils/fs.utils','JobStatus','retrieveMetadataFolder','toString','path','../../shared/managers/state-manger','.json','Result\x20not\x20found.','search','getResult','1253048bRDHsq','getResultChunk','sortJobsIds','readFile','BadRequestError','createRetrieveJob','runJob','1635168PCwXaz','parse','FsUtils','dataPath','62904jnDfFE','NotFoundError','Job\x20log\x20not\x20found.','../../shared/enums/logger.enums','844537AliUGT','JOB_LOG_DETAILS_FILENAME','2093530dAvyWZ','../../../configs/path','utf-8','getJobStatus','constructor','isExistsPath','apply','../../shared/utils/csv.utils','RETRIEVE_RESULTS_IDS_FILENAME','38582433RXqTpk','../job/classes/manifest-manger','IN_PROGRESS','../../../constants/job','getJobLogs','catch','join'];a272_0x3567=function(){return _0x3a430e;};return a272_0x3567();}const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a272_0x448490(0xde))),manifest_manger_1=__importDefault(require(a272_0x448490(0xbb))),state_manger_1=__importDefault(require(a272_0x448490(0xdf))),promises_1=require('fs/promises'),utils_1=require(a272_0x448490(0xd1)),csv_utils_1=__importDefault(require(a272_0x448490(0xb8))),not_found_error_1=require(a272_0x448490(0xd6)),logger_enums_1=require(a272_0x448490(0xae)),bad_request_error_1=require(a272_0x448490(0xca)),job_1=require(a272_0x448490(0xbd)),fs_utils_1=require(a272_0x448490(0xda)),constants_1=require(a272_0x448490(0xd8)),path_2=require(a272_0x448490(0xb2));class RetrieveMetadataService{static async[a272_0x448490(0xcd)](_0x2e1069,_0x11ebe5){const _0x3a4b31=a272_0x448490,_0x59ebc8=await job_utils_1[_0x3a4b31(0xd4)]['getJobsIds'](RetrieveMetadataService[_0x3a4b31(0xdc)]),_0x27b0e8=await job_utils_1[_0x3a4b31(0xd4)][_0x3a4b31(0xa2)](RetrieveMetadataService[_0x3a4b31(0xdc)],_0x59ebc8),_0x89cf20=_0x27b0e8[_0x3a4b31(0xc3)](_0x11ebe5,_0x11ebe5+_0x2e1069),_0x3fded5=[];for(const _0x2c37e4 of _0x89cf20){const _0x6eb5a4=await state_manger_1[_0x3a4b31(0xd4)][_0x3a4b31(0xc8)](path_1['default'][_0x3a4b31(0xc0)](RetrieveMetadataService[_0x3a4b31(0xdc)],_0x2c37e4));_0x3fded5[_0x3a4b31(0xd7)](_0x6eb5a4);}return _0x3fded5;}static async[a272_0x448490(0xa5)](_0xcd48af){const _0x16e28e=a272_0x448490,_0x5a6913=job_utils_1[_0x16e28e(0xd4)][_0x16e28e(0xcf)](),_0x23f3b9=path_1[_0x16e28e(0xd4)][_0x16e28e(0xc0)](RetrieveMetadataService['retrieveMetadataFolder'],_0x5a6913);await(0x0,fs_utils_1[_0x16e28e(0xd3)])(_0x23f3b9),await manifest_manger_1[_0x16e28e(0xd4)]['create'](_0x23f3b9,_0xcd48af),await state_manger_1['default'][_0x16e28e(0xc7)](_0x23f3b9,_0x5a6913);const _0x2b472a=path_1[_0x16e28e(0xd4)]['join'](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x16e28e(0xd4)][_0x16e28e(0xa6)](_0x2b472a,{'jobStorePath':_0x23f3b9,'jobId':_0x5a6913})[_0x16e28e(0xbf)](async _0x1ed814=>{const _0x186f10=_0x16e28e,_0x4ed308=new state_manger_1['default'](_0x23f3b9);await _0x4ed308[_0x186f10(0xcc)](),await _0x4ed308[_0x186f10(0xc6)](_0x1ed814);}),{'jobId':_0x5a6913};}static async[a272_0x448490(0xe3)](_0x269a32){const _0x580b3a=a272_0x448490,{status:_0x18ac83}=await RetrieveMetadataService[_0x580b3a(0xb4)](_0x269a32);if(_0x18ac83===logger_enums_1[_0x580b3a(0xdb)][_0x580b3a(0xbc)])throw new bad_request_error_1[(_0x580b3a(0xa4))](_0x580b3a(0xd2));const _0x1d36a6=path_1[_0x580b3a(0xd4)][_0x580b3a(0xc0)](RetrieveMetadataService[_0x580b3a(0xdc)],_0x269a32,constants_1[_0x580b3a(0xb9)]);if(await utils_1[_0x580b3a(0xa9)][_0x580b3a(0xb6)](_0x1d36a6))return(0x0,promises_1['readFile'])(_0x1d36a6,_0x580b3a(0xb3))[_0x580b3a(0xc9)](JSON['parse']);else throw new not_found_error_1[(_0x580b3a(0xac))](_0x580b3a(0xe1));}static async[a272_0x448490(0xe5)](_0x4a5bb9,_0xf7b709){const _0x2dd8b1=a272_0x448490,{status:_0x43da71}=await RetrieveMetadataService[_0x2dd8b1(0xb4)](_0x4a5bb9);if(_0x43da71===logger_enums_1[_0x2dd8b1(0xdb)]['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError'](_0x2dd8b1(0xd2));const _0x124c5f=path_1[_0x2dd8b1(0xd4)]['join'](RetrieveMetadataService[_0x2dd8b1(0xdc)],_0x4a5bb9,constants_1[_0x2dd8b1(0xce)]),_0x10008c={'data':[]};if(await utils_1[_0x2dd8b1(0xa9)][_0x2dd8b1(0xb6)](path_1[_0x2dd8b1(0xd4)][_0x2dd8b1(0xc0)](_0x124c5f,_0xf7b709+_0x2dd8b1(0xe0))))_0x10008c[_0x2dd8b1(0xc4)]=await(0x0,promises_1[_0x2dd8b1(0xa3)])(path_1['default'][_0x2dd8b1(0xc0)](_0x124c5f,_0xf7b709+'.json'),_0x2dd8b1(0xb3))[_0x2dd8b1(0xc9)](JSON[_0x2dd8b1(0xa8)]);else throw new not_found_error_1[(_0x2dd8b1(0xac))](_0x2dd8b1(0xd9));return _0x10008c;}static async[a272_0x448490(0xb4)](_0x5766e6){const _0x5aa484=a272_0x448490;try{return await state_manger_1[_0x5aa484(0xd4)][_0x5aa484(0xc8)](path_1['default'][_0x5aa484(0xc0)](RetrieveMetadataService[_0x5aa484(0xdc)],_0x5766e6));}catch(_0x2e023b){throw new not_found_error_1[(_0x5aa484(0xac))](_0x2e023b);}}static async[a272_0x448490(0xbe)](_0x13327e){const _0x2e6bcc=a272_0x448490,_0x14ed2e=path_1[_0x2e6bcc(0xd4)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x13327e,job_1[_0x2e6bcc(0xb0)]);if(await utils_1[_0x2e6bcc(0xa9)]['isExistsPath'](_0x14ed2e))return(0x0,promises_1[_0x2e6bcc(0xa3)])(_0x14ed2e,_0x2e6bcc(0xb3))['then'](_0x4d5eb8=>csv_utils_1[_0x2e6bcc(0xd4)][_0x2e6bcc(0xa8)](_0x4d5eb8,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x2e6bcc(0xad));}}exports[a272_0x448490(0xd4)]=RetrieveMetadataService,RetrieveMetadataService[a272_0x448490(0xdc)]=path_1[a272_0x448490(0xd4)][a272_0x448490(0xc0)](path_2[a272_0x448490(0xaa)],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);