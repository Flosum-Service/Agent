const a320_0x1dcb4e=a320_0x11d6;(function(_0x5e472b,_0x21f141){const _0xec141=a320_0x11d6,_0x4c8900=_0x5e472b();while(!![]){try{const _0x47e0b3=-parseInt(_0xec141(0x20b))/0x1+parseInt(_0xec141(0x1fd))/0x2+-parseInt(_0xec141(0x203))/0x3+parseInt(_0xec141(0x219))/0x4+-parseInt(_0xec141(0x1ff))/0x5*(-parseInt(_0xec141(0x1e6))/0x6)+parseInt(_0xec141(0x201))/0x7*(-parseInt(_0xec141(0x1fc))/0x8)+parseInt(_0xec141(0x1f5))/0x9*(-parseInt(_0xec141(0x1ec))/0xa);if(_0x47e0b3===_0x21f141)break;else _0x4c8900['push'](_0x4c8900['shift']());}catch(_0x48c3ea){_0x4c8900['push'](_0x4c8900['shift']());}}}(a320_0xa011,0xceeb1));function a320_0xa011(){const _0x10b987=['path','search','IN_PROGRESS','.json','6611476qyruML','BadRequestError','../../../core/errors/not-found.error','createRetrieveJob','__esModule','toString','dataPath','../../shared/enums/logger.enums','default','defineProperty','Chunk\x20not\x20found.','getJobsIds','2771286MmepXs','data','@flosum/utils','fs/promises','getJobStatus','JobStatus','40QmREQP','../job/classes/manifest-manger','getJobs','getResultChunk','setError','(((.+)+)+)+$','Job\x20log\x20not\x20found.','JOB_PATH','isExistsPath','2025801SxkMGj','slice','JOB_LOG_DETAILS_FILENAME','parse','push','constructor','then','124008osUFXN','3186216ddVwBA','NotFoundError','10ngkaaq','../../shared/utils/csv.utils','609XDXhQZ','retrieveMetadataFolder','1633686YDtUQw','sortJobsIds','runJob','utf-8','catch','FsUtils','getJobLogs','getJobState','528697JhZzBq','../../shared/utils/job.utils','create','readFile','../../../core/errors/bad-request.error','init','join','Job\x20not\x20completed.','../constants','../../../constants/job'];a320_0xa011=function(){return _0x10b987;};return a320_0xa011();}const a320_0x16f0c4=(function(){let _0x1e744b=!![];return function(_0x436896,_0x29ef67){const _0x5ab3b0=_0x1e744b?function(){if(_0x29ef67){const _0x542c18=_0x29ef67['apply'](_0x436896,arguments);return _0x29ef67=null,_0x542c18;}}:function(){};return _0x1e744b=![],_0x5ab3b0;};}()),a320_0x5044bd=a320_0x16f0c4(this,function(){const _0x4272d3=a320_0x11d6;return a320_0x5044bd['toString']()['search'](_0x4272d3(0x1f1))[_0x4272d3(0x1df)]()[_0x4272d3(0x1fa)](a320_0x5044bd)[_0x4272d3(0x216)](_0x4272d3(0x1f1));});a320_0x5044bd();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x401876){const _0x5cd177=a320_0x11d6;return _0x401876&&_0x401876[_0x5cd177(0x1de)]?_0x401876:{'default':_0x401876};};function a320_0x11d6(_0x337e4a,_0x245fe7){const _0x107aa4=a320_0xa011();return a320_0x11d6=function(_0x5044bd,_0x16f0c4){_0x5044bd=_0x5044bd-0x1db;let _0xa0112a=_0x107aa4[_0x5044bd];return _0xa0112a;},a320_0x11d6(_0x337e4a,_0x245fe7);}Object[a320_0x1dcb4e(0x1e3)](exports,a320_0x1dcb4e(0x1de),{'value':!![]});const job_utils_1=__importDefault(require(a320_0x1dcb4e(0x20c))),path_1=__importDefault(require(a320_0x1dcb4e(0x215))),manifest_manger_1=__importDefault(require(a320_0x1dcb4e(0x1ed))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require(a320_0x1dcb4e(0x1e9)),utils_1=require(a320_0x1dcb4e(0x1e8)),csv_utils_1=__importDefault(require(a320_0x1dcb4e(0x200))),not_found_error_1=require(a320_0x1dcb4e(0x1dc)),logger_enums_1=require(a320_0x1dcb4e(0x1e1)),bad_request_error_1=require(a320_0x1dcb4e(0x20f)),job_1=require(a320_0x1dcb4e(0x214)),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a320_0x1dcb4e(0x213)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a320_0x1dcb4e(0x1ee)](_0x3bc63f,_0x572882){const _0x289bfc=a320_0x1dcb4e,_0x307204=await job_utils_1[_0x289bfc(0x1e2)][_0x289bfc(0x1e5)](RetrieveMetadataService[_0x289bfc(0x202)]),_0x3f3fab=await job_utils_1[_0x289bfc(0x1e2)][_0x289bfc(0x204)](RetrieveMetadataService['retrieveMetadataFolder'],_0x307204),_0x52168f=_0x3f3fab[_0x289bfc(0x1f6)](_0x572882,_0x572882+_0x3bc63f),_0x2029f9=[];for(const _0x2de8e4 of _0x52168f){const _0x4e258b=await state_manger_1[_0x289bfc(0x1e2)][_0x289bfc(0x20a)](path_1[_0x289bfc(0x1e2)][_0x289bfc(0x211)](RetrieveMetadataService[_0x289bfc(0x202)],_0x2de8e4));_0x2029f9[_0x289bfc(0x1f9)](_0x4e258b);}return _0x2029f9;}static async[a320_0x1dcb4e(0x1dd)](_0x1f8aff){const _0x55bd8e=a320_0x1dcb4e,_0x3a52bd=job_utils_1[_0x55bd8e(0x1e2)]['generateJobId'](),_0x326ed0=path_1[_0x55bd8e(0x1e2)]['join'](RetrieveMetadataService[_0x55bd8e(0x202)],_0x3a52bd);await(0x0,fs_utils_1['makeDir'])(_0x326ed0),await manifest_manger_1[_0x55bd8e(0x1e2)][_0x55bd8e(0x20d)](_0x326ed0,_0x1f8aff),await state_manger_1[_0x55bd8e(0x1e2)][_0x55bd8e(0x20d)](_0x326ed0,_0x3a52bd);const _0x456388=path_1[_0x55bd8e(0x1e2)][_0x55bd8e(0x211)](__dirname,job_1[_0x55bd8e(0x1f3)]);return job_utils_1[_0x55bd8e(0x1e2)][_0x55bd8e(0x205)](_0x456388,{'jobStorePath':_0x326ed0,'jobId':_0x3a52bd})[_0x55bd8e(0x207)](async _0x2cf00f=>{const _0x22560c=_0x55bd8e,_0x45f4a7=new state_manger_1[(_0x22560c(0x1e2))](_0x326ed0);await _0x45f4a7[_0x22560c(0x210)](),await _0x45f4a7[_0x22560c(0x1f0)](_0x2cf00f);}),{'jobId':_0x3a52bd};}static async['getResult'](_0x49dea2){const _0x2d80c2=a320_0x1dcb4e,{status:_0x47b747}=await RetrieveMetadataService[_0x2d80c2(0x1ea)](_0x49dea2);if(_0x47b747===logger_enums_1[_0x2d80c2(0x1eb)][_0x2d80c2(0x217)])throw new bad_request_error_1[(_0x2d80c2(0x1db))](_0x2d80c2(0x212));const _0x46c482=path_1[_0x2d80c2(0x1e2)][_0x2d80c2(0x211)](RetrieveMetadataService['retrieveMetadataFolder'],_0x49dea2,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x2d80c2(0x208)][_0x2d80c2(0x1f4)](_0x46c482))return(0x0,promises_1[_0x2d80c2(0x20e)])(_0x46c482,_0x2d80c2(0x206))['then'](JSON[_0x2d80c2(0x1f8)]);else throw new not_found_error_1['NotFoundError']('Result\x20not\x20found.');}static async[a320_0x1dcb4e(0x1ef)](_0x19a420,_0x107bc3){const _0x437792=a320_0x1dcb4e,{status:_0x2437d3}=await RetrieveMetadataService['getJobStatus'](_0x19a420);if(_0x2437d3===logger_enums_1[_0x437792(0x1eb)][_0x437792(0x217)])throw new bad_request_error_1[(_0x437792(0x1db))]('Job\x20not\x20completed.');const _0x463adc=path_1[_0x437792(0x1e2)][_0x437792(0x211)](RetrieveMetadataService[_0x437792(0x202)],_0x19a420,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x77f964={'data':[]};if(await utils_1[_0x437792(0x208)][_0x437792(0x1f4)](path_1[_0x437792(0x1e2)][_0x437792(0x211)](_0x463adc,_0x107bc3+_0x437792(0x218))))_0x77f964[_0x437792(0x1e7)]=await(0x0,promises_1[_0x437792(0x20e)])(path_1['default'][_0x437792(0x211)](_0x463adc,_0x107bc3+'.json'),'utf-8')[_0x437792(0x1fb)](JSON[_0x437792(0x1f8)]);else throw new not_found_error_1[(_0x437792(0x1fe))](_0x437792(0x1e4));return _0x77f964;}static async[a320_0x1dcb4e(0x1ea)](_0xc1cbb8){const _0x42387c=a320_0x1dcb4e;try{return await state_manger_1[_0x42387c(0x1e2)][_0x42387c(0x20a)](path_1[_0x42387c(0x1e2)][_0x42387c(0x211)](RetrieveMetadataService[_0x42387c(0x202)],_0xc1cbb8));}catch(_0x3f0b0e){throw new not_found_error_1['NotFoundError'](_0x3f0b0e);}}static async[a320_0x1dcb4e(0x209)](_0x18e4f7){const _0x229703=a320_0x1dcb4e,_0x51ad00=path_1[_0x229703(0x1e2)][_0x229703(0x211)](RetrieveMetadataService['retrieveMetadataFolder'],_0x18e4f7,job_1[_0x229703(0x1f7)]);if(await utils_1[_0x229703(0x208)][_0x229703(0x1f4)](_0x51ad00))return(0x0,promises_1[_0x229703(0x20e)])(_0x51ad00,_0x229703(0x206))['then'](_0x14f768=>csv_utils_1[_0x229703(0x1e2)][_0x229703(0x1f8)](_0x14f768,{'columns':!![]}));throw new not_found_error_1[(_0x229703(0x1fe))](_0x229703(0x1f2));}}exports[a320_0x1dcb4e(0x1e2)]=RetrieveMetadataService,RetrieveMetadataService[a320_0x1dcb4e(0x202)]=path_1[a320_0x1dcb4e(0x1e2)][a320_0x1dcb4e(0x211)](path_2[a320_0x1dcb4e(0x1e0)],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);