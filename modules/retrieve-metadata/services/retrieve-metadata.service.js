const a274_0x45341b=a274_0xbdc1;(function(_0x1b3c55,_0x5908b3){const _0x28fe68=a274_0xbdc1,_0x100acf=_0x1b3c55();while(!![]){try{const _0x2484b2=-parseInt(_0x28fe68(0x11d))/0x1+parseInt(_0x28fe68(0x118))/0x2+-parseInt(_0x28fe68(0x10f))/0x3+-parseInt(_0x28fe68(0x109))/0x4+-parseInt(_0x28fe68(0x121))/0x5*(parseInt(_0x28fe68(0x10a))/0x6)+-parseInt(_0x28fe68(0x10c))/0x7*(parseInt(_0x28fe68(0x11b))/0x8)+parseInt(_0x28fe68(0x12a))/0x9*(parseInt(_0x28fe68(0x115))/0xa);if(_0x2484b2===_0x5908b3)break;else _0x100acf['push'](_0x100acf['shift']());}catch(_0x14fcf4){_0x100acf['push'](_0x100acf['shift']());}}}(a274_0x22a8,0xba55c));const a274_0x436741=(function(){let _0x3ba83e=!![];return function(_0x5d1763,_0x3c10c4){const _0x29333e=_0x3ba83e?function(){const _0x24175c=a274_0xbdc1;if(_0x3c10c4){const _0x1c0b64=_0x3c10c4[_0x24175c(0x126)](_0x5d1763,arguments);return _0x3c10c4=null,_0x1c0b64;}}:function(){};return _0x3ba83e=![],_0x29333e;};}()),a274_0x4aa4c8=a274_0x436741(this,function(){const _0x47be23=a274_0xbdc1;return a274_0x4aa4c8[_0x47be23(0x11a)]()[_0x47be23(0x12f)](_0x47be23(0xfd))[_0x47be23(0x11a)]()[_0x47be23(0x124)](a274_0x4aa4c8)['search'](_0x47be23(0xfd));});function a274_0xbdc1(_0x23f437,_0xd15793){const _0xf16e42=a274_0x22a8();return a274_0xbdc1=function(_0x4aa4c8,_0x436741){_0x4aa4c8=_0x4aa4c8-0xf9;let _0x22a860=_0xf16e42[_0x4aa4c8];return _0x22a860;},a274_0xbdc1(_0x23f437,_0xd15793);}a274_0x4aa4c8();'use strict';var __importDefault=this&&this[a274_0x45341b(0x122)]||function(_0x3f8979){return _0x3f8979&&_0x3f8979['__esModule']?_0x3f8979:{'default':_0x3f8979};};Object[a274_0x45341b(0x11e)](exports,a274_0x45341b(0x100),{'value':!![]});const job_utils_1=__importDefault(require(a274_0x45341b(0xfa))),path_1=__importDefault(require(a274_0x45341b(0x101))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a274_0x45341b(0xfe))),promises_1=require(a274_0x45341b(0x131)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a274_0x45341b(0x11f))),not_found_error_1=require(a274_0x45341b(0x120)),logger_enums_1=require(a274_0x45341b(0x102)),bad_request_error_1=require(a274_0x45341b(0x119)),job_1=require(a274_0x45341b(0x12b)),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a274_0x45341b(0x127)),path_2=require('../../../configs/path');function a274_0x22a8(){const _0x2becae=['getResultChunk','JobStatus','readFile','.json','then','IN_PROGRESS','parse','BadRequestError','JOB_PATH','NotFoundError','generateJobId','../../shared/utils/job.utils','RETRIEVE_RESULT_FOLDER_NAME','Chunk\x20not\x20found.','(((.+)+)+)+$','../job/classes/state-manger','init','__esModule','path','../job/enums/logger.enums','createRetrieveJob','getResult','Job\x20log\x20not\x20found.','catch','utf-8','data','3884400AYjgPP','6PySnTC','getJobStatus','70NUaujF','getJobs','getJobsIds','4401192NVnakr','default','Job\x20not\x20completed.','join','RETRIEVE_RESULTS_IDS_FILENAME','retrieveMetadataFolder','30905390TiPIdf','JOB_LOG_DETAILS_FILENAME','FsUtils','56418ikxZph','../../../core/errors/bad-request.error','toString','831680QYXZYx','getJobState','1297986CEZKUS','defineProperty','../../shared/utils/csv.utils','../../../core/errors/not-found.error','3351545ClUlWy','__importDefault','RETRIEVE_METADATA_FOLDER_NAME','constructor','setError','apply','../constants','isExistsPath','slice','18HhwMhS','../../../constants/job','getJobLogs','runJob','sortJobsIds','search','makeDir','fs/promises','create','Result\x20not\x20found.'];a274_0x22a8=function(){return _0x2becae;};return a274_0x22a8();}class RetrieveMetadataService{static async[a274_0x45341b(0x10d)](_0x5ef2ee,_0x3e2532){const _0x41e38f=a274_0x45341b,_0x24deaa=await job_utils_1[_0x41e38f(0x110)][_0x41e38f(0x10e)](RetrieveMetadataService[_0x41e38f(0x114)]),_0x230e28=await job_utils_1[_0x41e38f(0x110)][_0x41e38f(0x12e)](RetrieveMetadataService['retrieveMetadataFolder'],_0x24deaa),_0x1804ac=_0x230e28[_0x41e38f(0x129)](_0x3e2532,_0x3e2532+_0x5ef2ee),_0x4c460d=[];for(const _0x5587eb of _0x1804ac){const _0x5c1791=await state_manger_1[_0x41e38f(0x110)][_0x41e38f(0x11c)](path_1[_0x41e38f(0x110)][_0x41e38f(0x112)](RetrieveMetadataService[_0x41e38f(0x114)],_0x5587eb));_0x4c460d['push'](_0x5c1791);}return _0x4c460d;}static async[a274_0x45341b(0x103)](_0x4fd141){const _0x1edb3e=a274_0x45341b,_0x44c544=job_utils_1['default'][_0x1edb3e(0xf9)](),_0x344e5a=path_1[_0x1edb3e(0x110)][_0x1edb3e(0x112)](RetrieveMetadataService[_0x1edb3e(0x114)],_0x44c544);await(0x0,fs_utils_1[_0x1edb3e(0x130)])(_0x344e5a),await manifest_manger_1['default'][_0x1edb3e(0x132)](_0x344e5a,_0x4fd141),await state_manger_1[_0x1edb3e(0x110)]['create'](_0x344e5a,_0x44c544);const _0x5884b7=path_1[_0x1edb3e(0x110)][_0x1edb3e(0x112)](__dirname,job_1[_0x1edb3e(0x13c)]);return job_utils_1[_0x1edb3e(0x110)][_0x1edb3e(0x12d)](_0x5884b7,{'jobStorePath':_0x344e5a,'jobId':_0x44c544})[_0x1edb3e(0x106)](async _0x193300=>{const _0x7331cc=_0x1edb3e,_0x4c42e1=new state_manger_1[(_0x7331cc(0x110))](_0x344e5a);await _0x4c42e1[_0x7331cc(0xff)](),await _0x4c42e1[_0x7331cc(0x125)](_0x193300);}),{'jobId':_0x44c544};}static async[a274_0x45341b(0x104)](_0x331554){const _0x294b0e=a274_0x45341b,{status:_0x103234}=await RetrieveMetadataService[_0x294b0e(0x10b)](_0x331554);if(_0x103234===logger_enums_1[_0x294b0e(0x135)][_0x294b0e(0x139)])throw new bad_request_error_1[(_0x294b0e(0x13b))](_0x294b0e(0x111));const _0x34471a=path_1[_0x294b0e(0x110)][_0x294b0e(0x112)](RetrieveMetadataService[_0x294b0e(0x114)],_0x331554,constants_1[_0x294b0e(0x113)]);if(await utils_1[_0x294b0e(0x117)]['isExistsPath'](_0x34471a))return(0x0,promises_1[_0x294b0e(0x136)])(_0x34471a,'utf-8')[_0x294b0e(0x138)](JSON['parse']);else throw new not_found_error_1[(_0x294b0e(0x13d))](_0x294b0e(0x133));}static async[a274_0x45341b(0x134)](_0x468221,_0x43f54c){const _0x5363cb=a274_0x45341b,{status:_0x2be4c9}=await RetrieveMetadataService[_0x5363cb(0x10b)](_0x468221);if(_0x2be4c9===logger_enums_1[_0x5363cb(0x135)][_0x5363cb(0x139)])throw new bad_request_error_1[(_0x5363cb(0x13b))](_0x5363cb(0x111));const _0x2837cd=path_1[_0x5363cb(0x110)][_0x5363cb(0x112)](RetrieveMetadataService['retrieveMetadataFolder'],_0x468221,constants_1[_0x5363cb(0xfb)]),_0x1067e4={'data':[]};if(await utils_1[_0x5363cb(0x117)]['isExistsPath'](path_1[_0x5363cb(0x110)][_0x5363cb(0x112)](_0x2837cd,_0x43f54c+'.json')))_0x1067e4[_0x5363cb(0x108)]=await(0x0,promises_1[_0x5363cb(0x136)])(path_1[_0x5363cb(0x110)][_0x5363cb(0x112)](_0x2837cd,_0x43f54c+_0x5363cb(0x137)),_0x5363cb(0x107))[_0x5363cb(0x138)](JSON[_0x5363cb(0x13a)]);else throw new not_found_error_1[(_0x5363cb(0x13d))](_0x5363cb(0xfc));return _0x1067e4;}static async[a274_0x45341b(0x10b)](_0xbccc8){const _0x473a2e=a274_0x45341b;try{return await state_manger_1['default'][_0x473a2e(0x11c)](path_1[_0x473a2e(0x110)]['join'](RetrieveMetadataService[_0x473a2e(0x114)],_0xbccc8));}catch(_0x3f3d0b){throw new not_found_error_1['NotFoundError'](_0x3f3d0b);}}static async[a274_0x45341b(0x12c)](_0xf7b8de){const _0x1fd2b8=a274_0x45341b,_0x4c815c=path_1[_0x1fd2b8(0x110)]['join'](RetrieveMetadataService[_0x1fd2b8(0x114)],_0xf7b8de,job_1[_0x1fd2b8(0x116)]);if(await utils_1['FsUtils'][_0x1fd2b8(0x128)](_0x4c815c))return(0x0,promises_1[_0x1fd2b8(0x136)])(_0x4c815c,'utf-8')[_0x1fd2b8(0x138)](_0x3390f9=>csv_utils_1[_0x1fd2b8(0x110)][_0x1fd2b8(0x13a)](_0x3390f9,{'columns':!![]}));throw new not_found_error_1[(_0x1fd2b8(0x13d))](_0x1fd2b8(0x105));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a274_0x45341b(0x110)][a274_0x45341b(0x112)](path_2['dataPath'],constants_1[a274_0x45341b(0x123)]);