const a277_0x1113fa=a277_0x3c9e;(function(_0xb8c2f5,_0x201458){const _0x301539=a277_0x3c9e,_0x45f7c7=_0xb8c2f5();while(!![]){try{const _0x26b271=parseInt(_0x301539(0x1a1))/0x1*(parseInt(_0x301539(0x1a0))/0x2)+parseInt(_0x301539(0x19a))/0x3+-parseInt(_0x301539(0x19c))/0x4*(parseInt(_0x301539(0x180))/0x5)+-parseInt(_0x301539(0x16e))/0x6*(-parseInt(_0x301539(0x193))/0x7)+parseInt(_0x301539(0x1a5))/0x8+-parseInt(_0x301539(0x17f))/0x9+parseInt(_0x301539(0x195))/0xa*(-parseInt(_0x301539(0x18e))/0xb);if(_0x26b271===_0x201458)break;else _0x45f7c7['push'](_0x45f7c7['shift']());}catch(_0x2aa79e){_0x45f7c7['push'](_0x45f7c7['shift']());}}}(a277_0x5021,0x8cf72));const a277_0x323055=(function(){let _0x284eaf=!![];return function(_0x14a621,_0x40a99d){const _0x4d8c1c=_0x284eaf?function(){const _0x238d1f=a277_0x3c9e;if(_0x40a99d){const _0x2be77c=_0x40a99d[_0x238d1f(0x191)](_0x14a621,arguments);return _0x40a99d=null,_0x2be77c;}}:function(){};return _0x284eaf=![],_0x4d8c1c;};}()),a277_0x326648=a277_0x323055(this,function(){const _0x349f45=a277_0x3c9e;return a277_0x326648[_0x349f45(0x1a6)]()['search']('(((.+)+)+)+$')['toString']()[_0x349f45(0x18f)](a277_0x326648)[_0x349f45(0x18d)](_0x349f45(0x19b));});a277_0x326648();'use strict';function a277_0x5021(){const _0x31134b=['generateJobId','Job\x20log\x20not\x20found.','path','.json','1232028PQEXEU','(((.+)+)+)+$','348RpKAtE','getJobState','sortJobsIds','Job\x20not\x20completed.','4nBUbvt','565146oFSJnN','create','getResultChunk','__importDefault','7658704jGZter','toString','getJobsIds','createRetrieveJob','then','../../../configs/path','join','default','getJobStatus','getResult','1937142VUhxAv','RETRIEVE_RESULTS_IDS_FILENAME','dataPath','../../../constants/job','@flosum/utils','readFile','Chunk\x20not\x20found.','runJob','../../shared/utils/csv.utils','init','fs/promises','isExistsPath','../constants','Result\x20not\x20found.','data','FsUtils','JobStatus','4385835cxbNQz','35035laePAq','RETRIEVE_RESULT_FOLDER_NAME','../../shared/utils/job.utils','BadRequestError','setError','../../shared/enums/logger.enums','NotFoundError','retrieveMetadataFolder','../../shared/utils/fs.utils','../../shared/managers/state-manger','../../../core/errors/not-found.error','JOB_PATH','makeDir','search','11CIatFi','constructor','__esModule','apply','utf-8','21mlWdVs','parse','17925590qXUZTB'];a277_0x5021=function(){return _0x31134b;};return a277_0x5021();}function a277_0x3c9e(_0x30e562,_0x7bac){const _0x46a7c6=a277_0x5021();return a277_0x3c9e=function(_0x326648,_0x323055){_0x326648=_0x326648-0x167;let _0x502168=_0x46a7c6[_0x326648];return _0x502168;},a277_0x3c9e(_0x30e562,_0x7bac);}var __importDefault=this&&this[a277_0x1113fa(0x1a4)]||function(_0x574b16){return _0x574b16&&_0x574b16['__esModule']?_0x574b16:{'default':_0x574b16};};Object['defineProperty'](exports,a277_0x1113fa(0x190),{'value':!![]});const job_utils_1=__importDefault(require(a277_0x1113fa(0x182))),path_1=__importDefault(require(a277_0x1113fa(0x198))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a277_0x1113fa(0x189))),promises_1=require(a277_0x1113fa(0x178)),utils_1=require(a277_0x1113fa(0x172)),csv_utils_1=__importDefault(require(a277_0x1113fa(0x176))),not_found_error_1=require(a277_0x1113fa(0x18a)),logger_enums_1=require(a277_0x1113fa(0x185)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require(a277_0x1113fa(0x171)),fs_utils_1=require(a277_0x1113fa(0x188)),constants_1=require(a277_0x1113fa(0x17a)),path_2=require(a277_0x1113fa(0x169));class RetrieveMetadataService{static async['getJobs'](_0x4fa982,_0x3a8bae){const _0x441030=a277_0x1113fa,_0x2ce063=await job_utils_1['default'][_0x441030(0x1a7)](RetrieveMetadataService[_0x441030(0x187)]),_0x1519d6=await job_utils_1['default'][_0x441030(0x19e)](RetrieveMetadataService[_0x441030(0x187)],_0x2ce063),_0x4cfb2f=_0x1519d6['slice'](_0x3a8bae,_0x3a8bae+_0x4fa982),_0xcb436f=[];for(const _0x2d8a78 of _0x4cfb2f){const _0x3926a8=await state_manger_1['default'][_0x441030(0x19d)](path_1[_0x441030(0x16b)][_0x441030(0x16a)](RetrieveMetadataService[_0x441030(0x187)],_0x2d8a78));_0xcb436f['push'](_0x3926a8);}return _0xcb436f;}static async[a277_0x1113fa(0x167)](_0x5127a1){const _0x12cb97=a277_0x1113fa,_0x5bc557=job_utils_1[_0x12cb97(0x16b)][_0x12cb97(0x196)](),_0x5799d8=path_1[_0x12cb97(0x16b)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x5bc557);await(0x0,fs_utils_1[_0x12cb97(0x18c)])(_0x5799d8),await manifest_manger_1[_0x12cb97(0x16b)][_0x12cb97(0x1a2)](_0x5799d8,_0x5127a1),await state_manger_1[_0x12cb97(0x16b)][_0x12cb97(0x1a2)](_0x5799d8,_0x5bc557);const _0x2fab27=path_1['default'][_0x12cb97(0x16a)](__dirname,job_1[_0x12cb97(0x18b)]);return job_utils_1['default'][_0x12cb97(0x175)](_0x2fab27,{'jobStorePath':_0x5799d8,'jobId':_0x5bc557})['catch'](async _0x222efc=>{const _0x16c29c=_0x12cb97,_0x4b8795=new state_manger_1[(_0x16c29c(0x16b))](_0x5799d8);await _0x4b8795[_0x16c29c(0x177)](),await _0x4b8795[_0x16c29c(0x184)](_0x222efc);}),{'jobId':_0x5bc557};}static async[a277_0x1113fa(0x16d)](_0x358336){const _0x1d1878=a277_0x1113fa,{status:_0x30c8eb}=await RetrieveMetadataService['getJobStatus'](_0x358336);if(_0x30c8eb===logger_enums_1['JobStatus']['IN_PROGRESS'])throw new bad_request_error_1[(_0x1d1878(0x183))](_0x1d1878(0x19f));const _0x639474=path_1[_0x1d1878(0x16b)][_0x1d1878(0x16a)](RetrieveMetadataService[_0x1d1878(0x187)],_0x358336,constants_1[_0x1d1878(0x16f)]);if(await utils_1[_0x1d1878(0x17d)][_0x1d1878(0x179)](_0x639474))return(0x0,promises_1[_0x1d1878(0x173)])(_0x639474,'utf-8')[_0x1d1878(0x168)](JSON[_0x1d1878(0x194)]);else throw new not_found_error_1[(_0x1d1878(0x186))](_0x1d1878(0x17b));}static async[a277_0x1113fa(0x1a3)](_0x42cb9b,_0x2f19e4){const _0x5e3aae=a277_0x1113fa,{status:_0x3aaa66}=await RetrieveMetadataService['getJobStatus'](_0x42cb9b);if(_0x3aaa66===logger_enums_1[_0x5e3aae(0x17e)]['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError'](_0x5e3aae(0x19f));const _0x4da86f=path_1['default']['join'](RetrieveMetadataService[_0x5e3aae(0x187)],_0x42cb9b,constants_1[_0x5e3aae(0x181)]),_0x15d00b={'data':[]};if(await utils_1[_0x5e3aae(0x17d)][_0x5e3aae(0x179)](path_1[_0x5e3aae(0x16b)][_0x5e3aae(0x16a)](_0x4da86f,_0x2f19e4+_0x5e3aae(0x199))))_0x15d00b[_0x5e3aae(0x17c)]=await(0x0,promises_1[_0x5e3aae(0x173)])(path_1[_0x5e3aae(0x16b)][_0x5e3aae(0x16a)](_0x4da86f,_0x2f19e4+'.json'),_0x5e3aae(0x192))['then'](JSON[_0x5e3aae(0x194)]);else throw new not_found_error_1[(_0x5e3aae(0x186))](_0x5e3aae(0x174));return _0x15d00b;}static async[a277_0x1113fa(0x16c)](_0x40d63e){const _0x1fcb4d=a277_0x1113fa;try{return await state_manger_1['default'][_0x1fcb4d(0x19d)](path_1['default'][_0x1fcb4d(0x16a)](RetrieveMetadataService[_0x1fcb4d(0x187)],_0x40d63e));}catch(_0x2250c6){throw new not_found_error_1['NotFoundError'](_0x2250c6);}}static async['getJobLogs'](_0x3ba23e){const _0x4f1058=a277_0x1113fa,_0x2193bd=path_1[_0x4f1058(0x16b)]['join'](RetrieveMetadataService[_0x4f1058(0x187)],_0x3ba23e,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1[_0x4f1058(0x17d)]['isExistsPath'](_0x2193bd))return(0x0,promises_1[_0x4f1058(0x173)])(_0x2193bd,_0x4f1058(0x192))[_0x4f1058(0x168)](_0x29d749=>csv_utils_1['default'][_0x4f1058(0x194)](_0x29d749,{'columns':!![]}));throw new not_found_error_1[(_0x4f1058(0x186))](_0x4f1058(0x197));}}exports[a277_0x1113fa(0x16b)]=RetrieveMetadataService,RetrieveMetadataService[a277_0x1113fa(0x187)]=path_1[a277_0x1113fa(0x16b)][a277_0x1113fa(0x16a)](path_2[a277_0x1113fa(0x170)],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);