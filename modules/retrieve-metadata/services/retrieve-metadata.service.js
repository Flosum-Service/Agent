const a274_0x540156=a274_0x19ef;(function(_0x978f45,_0x12c917){const _0x516478=a274_0x19ef,_0xa83b84=_0x978f45();while(!![]){try{const _0x44a418=-parseInt(_0x516478(0x9b))/0x1*(parseInt(_0x516478(0xc3))/0x2)+parseInt(_0x516478(0xb4))/0x3+-parseInt(_0x516478(0xbb))/0x4+-parseInt(_0x516478(0xc7))/0x5*(parseInt(_0x516478(0xae))/0x6)+-parseInt(_0x516478(0x9a))/0x7*(parseInt(_0x516478(0x97))/0x8)+-parseInt(_0x516478(0xcb))/0x9+parseInt(_0x516478(0xb0))/0xa*(parseInt(_0x516478(0xc4))/0xb);if(_0x44a418===_0x12c917)break;else _0xa83b84['push'](_0xa83b84['shift']());}catch(_0x3b9551){_0xa83b84['push'](_0xa83b84['shift']());}}}(a274_0x58f1,0xf3905));function a274_0x58f1(){const _0x1dddb4=['getResult','Job\x20not\x20completed.','Job\x20log\x20not\x20found.','../job/classes/manifest-manger','apply','toString','989962csIEIE','44bRJLaq','JobStatus','makeDir','15095MJdWGL','JOB_PATH','isExistsPath','FsUtils','100764TBZIKF','data','utf-8','__esModule','../../../core/errors/bad-request.error','then','push','8FeyeYh','../../../core/errors/not-found.error','default','13289969BXQqFn','1VHCCzP','getJobs','../job/enums/logger.enums','catch','IN_PROGRESS','RETRIEVE_RESULTS_IDS_FILENAME','../../shared/utils/fs.utils','@flosum/utils','../../../configs/path','getJobStatus','setError','sortJobsIds','Result\x20not\x20found.','getJobLogs','createRetrieveJob','JOB_LOG_DETAILS_FILENAME','RETRIEVE_METADATA_FOLDER_NAME','NotFoundError','../../shared/utils/csv.utils','1266vPQDBK','dataPath','8700720SmAGld','fs/promises','getResultChunk','retrieveMetadataFolder','3206367LIMWBF','parse','getJobState','readFile','BadRequestError','getJobsIds','join','2038748iitOwM','init'];a274_0x58f1=function(){return _0x1dddb4;};return a274_0x58f1();}const a274_0x39ff9a=(function(){let _0x23ab19=!![];return function(_0x458a8c,_0x11acb9){const _0x2f6f23=_0x23ab19?function(){const _0x246d1f=a274_0x19ef;if(_0x11acb9){const _0x252c23=_0x11acb9[_0x246d1f(0xc1)](_0x458a8c,arguments);return _0x11acb9=null,_0x252c23;}}:function(){};return _0x23ab19=![],_0x2f6f23;};}()),a274_0x554eaa=a274_0x39ff9a(this,function(){const _0x4f6547=a274_0x19ef;return a274_0x554eaa[_0x4f6547(0xc2)]()['search']('(((.+)+)+)+$')['toString']()['constructor'](a274_0x554eaa)['search']('(((.+)+)+)+$');});a274_0x554eaa();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x96e58a){const _0x2f77bd=a274_0x19ef;return _0x96e58a&&_0x96e58a[_0x2f77bd(0xce)]?_0x96e58a:{'default':_0x96e58a};};Object['defineProperty'](exports,a274_0x540156(0xce),{'value':!![]});function a274_0x19ef(_0x5bb713,_0x138ce3){const _0x4d8c07=a274_0x58f1();return a274_0x19ef=function(_0x554eaa,_0x39ff9a){_0x554eaa=_0x554eaa-0x95;let _0x58f10b=_0x4d8c07[_0x554eaa];return _0x58f10b;},a274_0x19ef(_0x5bb713,_0x138ce3);}const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require(a274_0x540156(0xc0))),state_manger_1=__importDefault(require('../job/classes/state-manger')),promises_1=require(a274_0x540156(0xb1)),utils_1=require(a274_0x540156(0xa2)),csv_utils_1=__importDefault(require(a274_0x540156(0xad))),not_found_error_1=require(a274_0x540156(0x98)),logger_enums_1=require(a274_0x540156(0x9d)),bad_request_error_1=require(a274_0x540156(0xcf)),job_1=require('../../../constants/job'),fs_utils_1=require(a274_0x540156(0xa1)),constants_1=require('../constants'),path_2=require(a274_0x540156(0xa3));class RetrieveMetadataService{static async[a274_0x540156(0x9c)](_0x538936,_0x50effd){const _0x3b200d=a274_0x540156,_0x24d6ec=await job_utils_1[_0x3b200d(0x99)][_0x3b200d(0xb9)](RetrieveMetadataService[_0x3b200d(0xb3)]),_0x27fc21=await job_utils_1[_0x3b200d(0x99)][_0x3b200d(0xa6)](RetrieveMetadataService[_0x3b200d(0xb3)],_0x24d6ec),_0x3e9fcd=_0x27fc21['slice'](_0x50effd,_0x50effd+_0x538936),_0x39889f=[];for(const _0x46e6cd of _0x3e9fcd){const _0x51ee6e=await state_manger_1[_0x3b200d(0x99)][_0x3b200d(0xb6)](path_1['default'][_0x3b200d(0xba)](RetrieveMetadataService['retrieveMetadataFolder'],_0x46e6cd));_0x39889f[_0x3b200d(0x96)](_0x51ee6e);}return _0x39889f;}static async[a274_0x540156(0xa9)](_0x2f0db7){const _0x34e848=a274_0x540156,_0x2021bb=job_utils_1['default']['generateJobId'](),_0x3bd806=path_1[_0x34e848(0x99)]['join'](RetrieveMetadataService[_0x34e848(0xb3)],_0x2021bb);await(0x0,fs_utils_1[_0x34e848(0xc6)])(_0x3bd806),await manifest_manger_1[_0x34e848(0x99)]['create'](_0x3bd806,_0x2f0db7),await state_manger_1[_0x34e848(0x99)]['create'](_0x3bd806,_0x2021bb);const _0x129602=path_1[_0x34e848(0x99)][_0x34e848(0xba)](__dirname,job_1[_0x34e848(0xc8)]);return job_utils_1[_0x34e848(0x99)]['runJob'](_0x129602,{'jobStorePath':_0x3bd806,'jobId':_0x2021bb})[_0x34e848(0x9e)](async _0x1766db=>{const _0xf607f2=_0x34e848,_0x4a0d30=new state_manger_1[(_0xf607f2(0x99))](_0x3bd806);await _0x4a0d30[_0xf607f2(0xbc)](),await _0x4a0d30[_0xf607f2(0xa5)](_0x1766db);}),{'jobId':_0x2021bb};}static async[a274_0x540156(0xbd)](_0x4ec36b){const _0x41a933=a274_0x540156,{status:_0x20af2b}=await RetrieveMetadataService['getJobStatus'](_0x4ec36b);if(_0x20af2b===logger_enums_1[_0x41a933(0xc5)][_0x41a933(0x9f)])throw new bad_request_error_1['BadRequestError'](_0x41a933(0xbe));const _0x33a1ce=path_1[_0x41a933(0x99)][_0x41a933(0xba)](RetrieveMetadataService[_0x41a933(0xb3)],_0x4ec36b,constants_1[_0x41a933(0xa0)]);if(await utils_1[_0x41a933(0xca)][_0x41a933(0xc9)](_0x33a1ce))return(0x0,promises_1[_0x41a933(0xb7)])(_0x33a1ce,_0x41a933(0xcd))[_0x41a933(0x95)](JSON[_0x41a933(0xb5)]);else throw new not_found_error_1['NotFoundError'](_0x41a933(0xa7));}static async[a274_0x540156(0xb2)](_0x38c678,_0x2c66f7){const _0x82b66=a274_0x540156,{status:_0x5d93b2}=await RetrieveMetadataService[_0x82b66(0xa4)](_0x38c678);if(_0x5d93b2===logger_enums_1[_0x82b66(0xc5)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x82b66(0xb8))](_0x82b66(0xbe));const _0x49bb15=path_1[_0x82b66(0x99)][_0x82b66(0xba)](RetrieveMetadataService[_0x82b66(0xb3)],_0x38c678,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x142782={'data':[]};if(await utils_1['FsUtils']['isExistsPath'](path_1[_0x82b66(0x99)][_0x82b66(0xba)](_0x49bb15,_0x2c66f7+'.json')))_0x142782[_0x82b66(0xcc)]=await(0x0,promises_1['readFile'])(path_1[_0x82b66(0x99)][_0x82b66(0xba)](_0x49bb15,_0x2c66f7+'.json'),'utf-8')['then'](JSON[_0x82b66(0xb5)]);else throw new not_found_error_1[(_0x82b66(0xac))]('Chunk\x20not\x20found.');return _0x142782;}static async[a274_0x540156(0xa4)](_0x276560){const _0x4bf828=a274_0x540156;try{return await state_manger_1[_0x4bf828(0x99)][_0x4bf828(0xb6)](path_1['default'][_0x4bf828(0xba)](RetrieveMetadataService[_0x4bf828(0xb3)],_0x276560));}catch(_0x4b0c73){throw new not_found_error_1[(_0x4bf828(0xac))](_0x4b0c73);}}static async[a274_0x540156(0xa8)](_0x2a72e2){const _0x2d70fd=a274_0x540156,_0x52673d=path_1[_0x2d70fd(0x99)]['join'](RetrieveMetadataService[_0x2d70fd(0xb3)],_0x2a72e2,job_1[_0x2d70fd(0xaa)]);if(await utils_1[_0x2d70fd(0xca)][_0x2d70fd(0xc9)](_0x52673d))return(0x0,promises_1[_0x2d70fd(0xb7)])(_0x52673d,_0x2d70fd(0xcd))['then'](_0x2d5ecd=>csv_utils_1[_0x2d70fd(0x99)][_0x2d70fd(0xb5)](_0x2d5ecd,{'columns':!![]}));throw new not_found_error_1[(_0x2d70fd(0xac))](_0x2d70fd(0xbf));}}exports[a274_0x540156(0x99)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1['default'][a274_0x540156(0xba)](path_2[a274_0x540156(0xaf)],constants_1[a274_0x540156(0xab)]);