const a277_0x30e291=a277_0x4567;function a277_0x166a(){const _0x304279=['parse','../../shared/managers/state-manger','isExistsPath','FsUtils','join','../constants','getJobStatus','../../shared/enums/logger.enums','61919WZZbIt','getJobState','__importDefault','@flosum/utils','BadRequestError','init','../../shared/utils/fs.utils','JobStatus','Job\x20log\x20not\x20found.','26118WvZZZI','JOB_LOG_DETAILS_FILENAME','IN_PROGRESS','constructor','path','../../shared/utils/job.utils','createRetrieveJob','getJobLogs','1929240hVZlsQ','readFile','generateJobId','../job/classes/manifest-manger','Result\x20not\x20found.','defineProperty','getResult','push','RETRIEVE_RESULTS_IDS_FILENAME','Job\x20not\x20completed.','runJob','catch','dataPath','slice','../../../configs/path','../../../core/errors/bad-request.error','../../../constants/job','create','145OLYcUM','__esModule','getJobsIds','retrieveMetadataFolder','2168210kGUVgH','RETRIEVE_METADATA_FOLDER_NAME','NotFoundError','toString','JOB_PATH','search','42elHkHm','default','10nrAHMe','(((.+)+)+)+$','1146698rLYRzI','../../../core/errors/not-found.error','66128UyTSXk','.json','../../shared/utils/csv.utils','utf-8','then','getResultChunk','2220624AHzYNA'];a277_0x166a=function(){return _0x304279;};return a277_0x166a();}(function(_0x1ba01f,_0x5496af){const _0x2be4eb=a277_0x4567,_0x3add52=_0x1ba01f();while(!![]){try{const _0x9cf14a=parseInt(_0x2be4eb(0x15c))/0x1*(-parseInt(_0x2be4eb(0x149))/0x2)+-parseInt(_0x2be4eb(0x147))/0x3*(-parseInt(_0x2be4eb(0x14d))/0x4)+parseInt(_0x2be4eb(0x13d))/0x5*(-parseInt(_0x2be4eb(0x165))/0x6)+parseInt(_0x2be4eb(0x14b))/0x7+-parseInt(_0x2be4eb(0x16d))/0x8+parseInt(_0x2be4eb(0x153))/0x9+parseInt(_0x2be4eb(0x141))/0xa;if(_0x9cf14a===_0x5496af)break;else _0x3add52['push'](_0x3add52['shift']());}catch(_0x4a30d9){_0x3add52['push'](_0x3add52['shift']());}}}(a277_0x166a,0x2c648));const a277_0x2c869b=(function(){let _0x472f61=!![];return function(_0x1ae5e0,_0x16b5fe){const _0x518197=_0x472f61?function(){if(_0x16b5fe){const _0x296f43=_0x16b5fe['apply'](_0x1ae5e0,arguments);return _0x16b5fe=null,_0x296f43;}}:function(){};return _0x472f61=![],_0x518197;};}()),a277_0x3af9e9=a277_0x2c869b(this,function(){const _0x19787b=a277_0x4567;return a277_0x3af9e9[_0x19787b(0x144)]()[_0x19787b(0x146)](_0x19787b(0x14a))['toString']()[_0x19787b(0x168)](a277_0x3af9e9)[_0x19787b(0x146)]('(((.+)+)+)+$');});a277_0x3af9e9();function a277_0x4567(_0x1a51d8,_0x4fd30f){const _0x5b8e2c=a277_0x166a();return a277_0x4567=function(_0x3af9e9,_0x2c869b){_0x3af9e9=_0x3af9e9-0x12f;let _0x166ae1=_0x5b8e2c[_0x3af9e9];return _0x166ae1;},a277_0x4567(_0x1a51d8,_0x4fd30f);}'use strict';var __importDefault=this&&this[a277_0x30e291(0x15e)]||function(_0x3592d7){const _0x3acecb=a277_0x30e291;return _0x3592d7&&_0x3592d7[_0x3acecb(0x13e)]?_0x3592d7:{'default':_0x3592d7};};Object[a277_0x30e291(0x130)](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a277_0x30e291(0x16a))),path_1=__importDefault(require(a277_0x30e291(0x169))),manifest_manger_1=__importDefault(require(a277_0x30e291(0x170))),state_manger_1=__importDefault(require(a277_0x30e291(0x155))),promises_1=require('fs/promises'),utils_1=require(a277_0x30e291(0x15f)),csv_utils_1=__importDefault(require(a277_0x30e291(0x14f))),not_found_error_1=require(a277_0x30e291(0x14c)),logger_enums_1=require(a277_0x30e291(0x15b)),bad_request_error_1=require(a277_0x30e291(0x13a)),job_1=require(a277_0x30e291(0x13b)),fs_utils_1=require(a277_0x30e291(0x162)),constants_1=require(a277_0x30e291(0x159)),path_2=require(a277_0x30e291(0x139));class RetrieveMetadataService{static async['getJobs'](_0x2b6d6a,_0x1ca6b6){const _0x1bdf5f=a277_0x30e291,_0x557253=await job_utils_1[_0x1bdf5f(0x148)][_0x1bdf5f(0x13f)](RetrieveMetadataService[_0x1bdf5f(0x140)]),_0x37e92c=await job_utils_1[_0x1bdf5f(0x148)]['sortJobsIds'](RetrieveMetadataService[_0x1bdf5f(0x140)],_0x557253),_0x31ac69=_0x37e92c[_0x1bdf5f(0x138)](_0x1ca6b6,_0x1ca6b6+_0x2b6d6a),_0x2c68b4=[];for(const _0xa470a2 of _0x31ac69){const _0x4b8474=await state_manger_1[_0x1bdf5f(0x148)]['getJobState'](path_1[_0x1bdf5f(0x148)]['join'](RetrieveMetadataService[_0x1bdf5f(0x140)],_0xa470a2));_0x2c68b4[_0x1bdf5f(0x132)](_0x4b8474);}return _0x2c68b4;}static async[a277_0x30e291(0x16b)](_0x548aed){const _0x4c4e5e=a277_0x30e291,_0x2226ea=job_utils_1[_0x4c4e5e(0x148)][_0x4c4e5e(0x16f)](),_0x4dbc3b=path_1[_0x4c4e5e(0x148)][_0x4c4e5e(0x158)](RetrieveMetadataService['retrieveMetadataFolder'],_0x2226ea);await(0x0,fs_utils_1['makeDir'])(_0x4dbc3b),await manifest_manger_1[_0x4c4e5e(0x148)]['create'](_0x4dbc3b,_0x548aed),await state_manger_1['default'][_0x4c4e5e(0x13c)](_0x4dbc3b,_0x2226ea);const _0x5f4d16=path_1[_0x4c4e5e(0x148)][_0x4c4e5e(0x158)](__dirname,job_1[_0x4c4e5e(0x145)]);return job_utils_1[_0x4c4e5e(0x148)][_0x4c4e5e(0x135)](_0x5f4d16,{'jobStorePath':_0x4dbc3b,'jobId':_0x2226ea})[_0x4c4e5e(0x136)](async _0x5894ea=>{const _0x2bcd10=_0x4c4e5e,_0x393414=new state_manger_1[(_0x2bcd10(0x148))](_0x4dbc3b);await _0x393414[_0x2bcd10(0x161)](),await _0x393414['setError'](_0x5894ea);}),{'jobId':_0x2226ea};}static async[a277_0x30e291(0x131)](_0x45ac69){const _0x1d3aae=a277_0x30e291,{status:_0x141b18}=await RetrieveMetadataService[_0x1d3aae(0x15a)](_0x45ac69);if(_0x141b18===logger_enums_1[_0x1d3aae(0x163)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x1d3aae(0x160))](_0x1d3aae(0x134));const _0x32e15c=path_1['default'][_0x1d3aae(0x158)](RetrieveMetadataService['retrieveMetadataFolder'],_0x45ac69,constants_1[_0x1d3aae(0x133)]);if(await utils_1[_0x1d3aae(0x157)][_0x1d3aae(0x156)](_0x32e15c))return(0x0,promises_1['readFile'])(_0x32e15c,_0x1d3aae(0x150))[_0x1d3aae(0x151)](JSON['parse']);else throw new not_found_error_1[(_0x1d3aae(0x143))](_0x1d3aae(0x12f));}static async[a277_0x30e291(0x152)](_0x4e5cbc,_0x43c3ec){const _0x90054d=a277_0x30e291,{status:_0x960489}=await RetrieveMetadataService['getJobStatus'](_0x4e5cbc);if(_0x960489===logger_enums_1[_0x90054d(0x163)][_0x90054d(0x167)])throw new bad_request_error_1[(_0x90054d(0x160))]('Job\x20not\x20completed.');const _0x56c70a=path_1[_0x90054d(0x148)][_0x90054d(0x158)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4e5cbc,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x2ee1e9={'data':[]};if(await utils_1[_0x90054d(0x157)][_0x90054d(0x156)](path_1[_0x90054d(0x148)][_0x90054d(0x158)](_0x56c70a,_0x43c3ec+_0x90054d(0x14e))))_0x2ee1e9['data']=await(0x0,promises_1['readFile'])(path_1[_0x90054d(0x148)][_0x90054d(0x158)](_0x56c70a,_0x43c3ec+_0x90054d(0x14e)),_0x90054d(0x150))[_0x90054d(0x151)](JSON[_0x90054d(0x154)]);else throw new not_found_error_1[(_0x90054d(0x143))]('Chunk\x20not\x20found.');return _0x2ee1e9;}static async[a277_0x30e291(0x15a)](_0x450dc1){const _0x21d38b=a277_0x30e291;try{return await state_manger_1[_0x21d38b(0x148)][_0x21d38b(0x15d)](path_1[_0x21d38b(0x148)][_0x21d38b(0x158)](RetrieveMetadataService[_0x21d38b(0x140)],_0x450dc1));}catch(_0x333f68){throw new not_found_error_1['NotFoundError'](_0x333f68);}}static async[a277_0x30e291(0x16c)](_0x1e427b){const _0x2c5c48=a277_0x30e291,_0x55ead9=path_1[_0x2c5c48(0x148)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x1e427b,job_1[_0x2c5c48(0x166)]);if(await utils_1[_0x2c5c48(0x157)][_0x2c5c48(0x156)](_0x55ead9))return(0x0,promises_1[_0x2c5c48(0x16e)])(_0x55ead9,_0x2c5c48(0x150))[_0x2c5c48(0x151)](_0x256c92=>csv_utils_1[_0x2c5c48(0x148)]['parse'](_0x256c92,{'columns':!![]}));throw new not_found_error_1[(_0x2c5c48(0x143))](_0x2c5c48(0x164));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a277_0x30e291(0x148)]['join'](path_2[a277_0x30e291(0x137)],constants_1[a277_0x30e291(0x142)]);