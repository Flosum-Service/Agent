const a274_0x28b816=a274_0x4b43;function a274_0x4b43(_0x113f78,_0x6e4554){const _0x3d49c9=a274_0x49ad();return a274_0x4b43=function(_0xdf57cb,_0x7789c0){_0xdf57cb=_0xdf57cb-0xed;let _0x49add1=_0x3d49c9[_0xdf57cb];return _0x49add1;},a274_0x4b43(_0x113f78,_0x6e4554);}(function(_0x1eecf4,_0x2117df){const _0xdbf1d4=a274_0x4b43,_0x557813=_0x1eecf4();while(!![]){try{const _0x2130a4=-parseInt(_0xdbf1d4(0x11c))/0x1+parseInt(_0xdbf1d4(0x123))/0x2*(parseInt(_0xdbf1d4(0x12b))/0x3)+parseInt(_0xdbf1d4(0xf9))/0x4*(-parseInt(_0xdbf1d4(0xf8))/0x5)+parseInt(_0xdbf1d4(0x11f))/0x6+parseInt(_0xdbf1d4(0x109))/0x7*(parseInt(_0xdbf1d4(0xf2))/0x8)+-parseInt(_0xdbf1d4(0xf0))/0x9+parseInt(_0xdbf1d4(0x10e))/0xa;if(_0x2130a4===_0x2117df)break;else _0x557813['push'](_0x557813['shift']());}catch(_0x2e10f4){_0x557813['push'](_0x557813['shift']());}}}(a274_0x49ad,0xd2787));const a274_0x7789c0=(function(){let _0x350246=!![];return function(_0x394e30,_0x4a804c){const _0x5d244b=_0x350246?function(){const _0x3c7cc0=a274_0x4b43;if(_0x4a804c){const _0x535f52=_0x4a804c[_0x3c7cc0(0x115)](_0x394e30,arguments);return _0x4a804c=null,_0x535f52;}}:function(){};return _0x350246=![],_0x5d244b;};}()),a274_0xdf57cb=a274_0x7789c0(this,function(){const _0x7aab35=a274_0x4b43;return a274_0xdf57cb[_0x7aab35(0xf4)]()[_0x7aab35(0xf7)](_0x7aab35(0xff))[_0x7aab35(0xf4)]()[_0x7aab35(0x128)](a274_0xdf57cb)[_0x7aab35(0xf7)](_0x7aab35(0xff));});a274_0xdf57cb();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2c8d29){const _0x4c2c82=a274_0x4b43;return _0x2c8d29&&_0x2c8d29[_0x4c2c82(0xfe)]?_0x2c8d29:{'default':_0x2c8d29};};Object[a274_0x28b816(0x129)](exports,a274_0x28b816(0xfe),{'value':!![]});function a274_0x49ad(){const _0x422392=['toString','utf-8','RETRIEVE_RESULTS_IDS_FILENAME','search','5115685gHZcWu','4nmPUaI','retrieveMetadataFolder','JOB_PATH','Job\x20not\x20completed.','Chunk\x20not\x20found.','__esModule','(((.+)+)+)+$','push','Result\x20not\x20found.','FsUtils','parse','dataPath','setError','../job/classes/state-manger','RETRIEVE_METADATA_FOLDER_NAME','then','2377095biNGFW','Job\x20log\x20not\x20found.','../../shared/utils/csv.utils','RETRIEVE_RESULT_FOLDER_NAME','catch','4591610gshwKt','slice','isExistsPath','JOB_LOG_DETAILS_FILENAME','getJobs','IN_PROGRESS','../../../core/errors/bad-request.error','apply','../../../core/errors/not-found.error','path','sortJobsIds','@flosum/utils','create','BadRequestError','386641yKRiui','readFile','../../../constants/job','7808868rkPpgA','fs/promises','init','default','8VFqLsQ','../../shared/utils/fs.utils','.json','createRetrieveJob','../constants','constructor','defineProperty','NotFoundError','463170FpqWLo','getJobStatus','generateJobId','runJob','getJobState','getResult','JobStatus','13182066lgKQuX','../job/enums/logger.enums','32fdchOo','join'];a274_0x49ad=function(){return _0x422392;};return a274_0x49ad();}const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a274_0x28b816(0x117))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a274_0x28b816(0x106))),promises_1=require(a274_0x28b816(0x120)),utils_1=require(a274_0x28b816(0x119)),csv_utils_1=__importDefault(require(a274_0x28b816(0x10b))),not_found_error_1=require(a274_0x28b816(0x116)),logger_enums_1=require(a274_0x28b816(0xf1)),bad_request_error_1=require(a274_0x28b816(0x114)),job_1=require(a274_0x28b816(0x11e)),fs_utils_1=require(a274_0x28b816(0x124)),constants_1=require(a274_0x28b816(0x127)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a274_0x28b816(0x112)](_0x3539e4,_0x3d0b40){const _0x4503d7=a274_0x28b816,_0x13ead1=await job_utils_1[_0x4503d7(0x122)]['getJobsIds'](RetrieveMetadataService[_0x4503d7(0xfa)]),_0x5bef9c=await job_utils_1['default'][_0x4503d7(0x118)](RetrieveMetadataService['retrieveMetadataFolder'],_0x13ead1),_0x363f05=_0x5bef9c[_0x4503d7(0x10f)](_0x3d0b40,_0x3d0b40+_0x3539e4),_0x15d84b=[];for(const _0x352877 of _0x363f05){const _0x110527=await state_manger_1[_0x4503d7(0x122)][_0x4503d7(0xed)](path_1['default'][_0x4503d7(0xf3)](RetrieveMetadataService['retrieveMetadataFolder'],_0x352877));_0x15d84b[_0x4503d7(0x100)](_0x110527);}return _0x15d84b;}static async[a274_0x28b816(0x126)](_0x4cd27f){const _0x447474=a274_0x28b816,_0x3eb433=job_utils_1[_0x447474(0x122)][_0x447474(0x12d)](),_0x17a666=path_1['default'][_0x447474(0xf3)](RetrieveMetadataService[_0x447474(0xfa)],_0x3eb433);await(0x0,fs_utils_1['makeDir'])(_0x17a666),await manifest_manger_1['default']['create'](_0x17a666,_0x4cd27f),await state_manger_1[_0x447474(0x122)][_0x447474(0x11a)](_0x17a666,_0x3eb433);const _0x2eba95=path_1[_0x447474(0x122)][_0x447474(0xf3)](__dirname,job_1[_0x447474(0xfb)]);return job_utils_1[_0x447474(0x122)][_0x447474(0x12e)](_0x2eba95,{'jobStorePath':_0x17a666,'jobId':_0x3eb433})[_0x447474(0x10d)](async _0x326d43=>{const _0x3122e8=_0x447474,_0x3e393c=new state_manger_1[(_0x3122e8(0x122))](_0x17a666);await _0x3e393c[_0x3122e8(0x121)](),await _0x3e393c[_0x3122e8(0x105)](_0x326d43);}),{'jobId':_0x3eb433};}static async[a274_0x28b816(0xee)](_0x33f466){const _0x290446=a274_0x28b816,{status:_0x2b59c7}=await RetrieveMetadataService[_0x290446(0x12c)](_0x33f466);if(_0x2b59c7===logger_enums_1[_0x290446(0xef)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x290446(0x11b))](_0x290446(0xfc));const _0x2fdbcc=path_1['default'][_0x290446(0xf3)](RetrieveMetadataService[_0x290446(0xfa)],_0x33f466,constants_1[_0x290446(0xf6)]);if(await utils_1[_0x290446(0x102)][_0x290446(0x110)](_0x2fdbcc))return(0x0,promises_1[_0x290446(0x11d)])(_0x2fdbcc,_0x290446(0xf5))[_0x290446(0x108)](JSON[_0x290446(0x103)]);else throw new not_found_error_1[(_0x290446(0x12a))](_0x290446(0x101));}static async['getResultChunk'](_0x4a41cb,_0x50e54f){const _0x10d039=a274_0x28b816,{status:_0x20451e}=await RetrieveMetadataService['getJobStatus'](_0x4a41cb);if(_0x20451e===logger_enums_1[_0x10d039(0xef)][_0x10d039(0x113)])throw new bad_request_error_1['BadRequestError'](_0x10d039(0xfc));const _0x3be58c=path_1[_0x10d039(0x122)][_0x10d039(0xf3)](RetrieveMetadataService[_0x10d039(0xfa)],_0x4a41cb,constants_1[_0x10d039(0x10c)]),_0x290514={'data':[]};if(await utils_1[_0x10d039(0x102)][_0x10d039(0x110)](path_1['default']['join'](_0x3be58c,_0x50e54f+'.json')))_0x290514['data']=await(0x0,promises_1[_0x10d039(0x11d)])(path_1[_0x10d039(0x122)][_0x10d039(0xf3)](_0x3be58c,_0x50e54f+_0x10d039(0x125)),_0x10d039(0xf5))[_0x10d039(0x108)](JSON[_0x10d039(0x103)]);else throw new not_found_error_1[(_0x10d039(0x12a))](_0x10d039(0xfd));return _0x290514;}static async[a274_0x28b816(0x12c)](_0x998db6){const _0x50044b=a274_0x28b816;try{return await state_manger_1['default'][_0x50044b(0xed)](path_1[_0x50044b(0x122)][_0x50044b(0xf3)](RetrieveMetadataService[_0x50044b(0xfa)],_0x998db6));}catch(_0x5b1205){throw new not_found_error_1[(_0x50044b(0x12a))](_0x5b1205);}}static async['getJobLogs'](_0x36c158){const _0x293a20=a274_0x28b816,_0x125b1e=path_1[_0x293a20(0x122)]['join'](RetrieveMetadataService[_0x293a20(0xfa)],_0x36c158,job_1[_0x293a20(0x111)]);if(await utils_1[_0x293a20(0x102)]['isExistsPath'](_0x125b1e))return(0x0,promises_1['readFile'])(_0x125b1e,'utf-8')[_0x293a20(0x108)](_0x430d9b=>csv_utils_1[_0x293a20(0x122)][_0x293a20(0x103)](_0x430d9b,{'columns':!![]}));throw new not_found_error_1[(_0x293a20(0x12a))](_0x293a20(0x10a));}}exports[a274_0x28b816(0x122)]=RetrieveMetadataService,RetrieveMetadataService[a274_0x28b816(0xfa)]=path_1['default']['join'](path_2[a274_0x28b816(0x104)],constants_1[a274_0x28b816(0x107)]);