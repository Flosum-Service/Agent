const a319_0x4282a7=a319_0x12e5;(function(_0xca6389,_0x2de5d4){const _0x47f923=a319_0x12e5,_0x4e87bf=_0xca6389();while(!![]){try{const _0x1b8d6e=parseInt(_0x47f923(0xfd))/0x1*(-parseInt(_0x47f923(0x10d))/0x2)+parseInt(_0x47f923(0xf6))/0x3*(parseInt(_0x47f923(0xf1))/0x4)+-parseInt(_0x47f923(0xfe))/0x5+-parseInt(_0x47f923(0xed))/0x6*(parseInt(_0x47f923(0x116))/0x7)+-parseInt(_0x47f923(0x10e))/0x8+-parseInt(_0x47f923(0x118))/0x9+parseInt(_0x47f923(0xe0))/0xa;if(_0x1b8d6e===_0x2de5d4)break;else _0x4e87bf['push'](_0x4e87bf['shift']());}catch(_0xf25702){_0x4e87bf['push'](_0x4e87bf['shift']());}}}(a319_0x2c07,0x7adb1));function a319_0x12e5(_0x153773,_0x37253c){const _0x2a196c=a319_0x2c07();return a319_0x12e5=function(_0x553b03,_0x257698){_0x553b03=_0x553b03-0xdf;let _0x2c07cf=_0x2a196c[_0x553b03];return _0x2c07cf;},a319_0x12e5(_0x153773,_0x37253c);}const a319_0x257698=(function(){let _0x2b8bec=!![];return function(_0xf5b63c,_0x4c5218){const _0x370111=_0x2b8bec?function(){const _0x196cd8=a319_0x12e5;if(_0x4c5218){const _0x4fe672=_0x4c5218[_0x196cd8(0xea)](_0xf5b63c,arguments);return _0x4c5218=null,_0x4fe672;}}:function(){};return _0x2b8bec=![],_0x370111;};}()),a319_0x553b03=a319_0x257698(this,function(){const _0x4fa6b8=a319_0x12e5;return a319_0x553b03[_0x4fa6b8(0xdf)]()[_0x4fa6b8(0x109)](_0x4fa6b8(0xf5))['toString']()['constructor'](a319_0x553b03)[_0x4fa6b8(0x109)](_0x4fa6b8(0xf5));});a319_0x553b03();'use strict';var __importDefault=this&&this['__importDefault']||function(_0xa263e1){return _0xa263e1&&_0xa263e1['__esModule']?_0xa263e1:{'default':_0xa263e1};};Object[a319_0x4282a7(0xe1)](exports,a319_0x4282a7(0xe6),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a319_0x4282a7(0xe3))),manifest_manger_1=__importDefault(require(a319_0x4282a7(0x11b))),state_manger_1=__importDefault(require(a319_0x4282a7(0x103))),promises_1=require(a319_0x4282a7(0x113)),utils_1=require(a319_0x4282a7(0x11c)),csv_utils_1=__importDefault(require(a319_0x4282a7(0x108))),not_found_error_1=require(a319_0x4282a7(0x107)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require(a319_0x4282a7(0x111)),fs_utils_1=require(a319_0x4282a7(0xe7)),constants_1=require('../constants'),path_2=require(a319_0x4282a7(0x115));function a319_0x2c07(){const _0x3cbd0c=['catch','BadRequestError','../../../constants/job','RETRIEVE_METADATA_FOLDER_NAME','fs/promises','data','../../../configs/path','43526vievOl','sortJobsIds','3314295rMyMeY','Job\x20not\x20completed.','then','../job/classes/manifest-manger','@flosum/utils','getJobStatus','dataPath','toString','25415220BRzEAZ','defineProperty','slice','path','parse','default','__esModule','../../shared/utils/fs.utils','makeDir','JobStatus','apply','getJobsIds','readFile','648JfVmRS','generateJobId','JOB_LOG_DETAILS_FILENAME','FsUtils','68ZOUapb','retrieveMetadataFolder','RETRIEVE_RESULT_FOLDER_NAME','Chunk\x20not\x20found.','(((.+)+)+)+$','78081bzntGu','Result\x20not\x20found.','init','.json','IN_PROGRESS','setError','getJobLogs','470219hRbHDD','145055LfJXuv','JOB_PATH','getJobs','NotFoundError','create','../../shared/managers/state-manger','Job\x20log\x20not\x20found.','isExistsPath','getJobState','../../../core/errors/not-found.error','../../shared/utils/csv.utils','search','runJob','join','utf-8','2HKewBC','7533880IDiIXJ'];a319_0x2c07=function(){return _0x3cbd0c;};return a319_0x2c07();}class RetrieveMetadataService{static async[a319_0x4282a7(0x100)](_0x4ddb80,_0x309fb7){const _0x34a6ca=a319_0x4282a7,_0x16bb20=await job_utils_1[_0x34a6ca(0xe5)][_0x34a6ca(0xeb)](RetrieveMetadataService[_0x34a6ca(0xf2)]),_0x17ca0=await job_utils_1['default'][_0x34a6ca(0x117)](RetrieveMetadataService['retrieveMetadataFolder'],_0x16bb20),_0x2d9b8b=_0x17ca0[_0x34a6ca(0xe2)](_0x309fb7,_0x309fb7+_0x4ddb80),_0x1623ad=[];for(const _0xb546bf of _0x2d9b8b){const _0x436375=await state_manger_1['default']['getJobState'](path_1[_0x34a6ca(0xe5)][_0x34a6ca(0x10b)](RetrieveMetadataService[_0x34a6ca(0xf2)],_0xb546bf));_0x1623ad['push'](_0x436375);}return _0x1623ad;}static async['createRetrieveJob'](_0x36f1a2){const _0x2fdf16=a319_0x4282a7,_0x420da2=job_utils_1[_0x2fdf16(0xe5)][_0x2fdf16(0xee)](),_0x526431=path_1['default'][_0x2fdf16(0x10b)](RetrieveMetadataService[_0x2fdf16(0xf2)],_0x420da2);await(0x0,fs_utils_1[_0x2fdf16(0xe8)])(_0x526431),await manifest_manger_1[_0x2fdf16(0xe5)][_0x2fdf16(0x102)](_0x526431,_0x36f1a2),await state_manger_1[_0x2fdf16(0xe5)]['create'](_0x526431,_0x420da2);const _0x10174d=path_1[_0x2fdf16(0xe5)][_0x2fdf16(0x10b)](__dirname,job_1[_0x2fdf16(0xff)]);return job_utils_1['default'][_0x2fdf16(0x10a)](_0x10174d,{'jobStorePath':_0x526431,'jobId':_0x420da2})[_0x2fdf16(0x10f)](async _0x3e1156=>{const _0x211c50=_0x2fdf16,_0x32b3c4=new state_manger_1[(_0x211c50(0xe5))](_0x526431);await _0x32b3c4[_0x211c50(0xf8)](),await _0x32b3c4[_0x211c50(0xfb)](_0x3e1156);}),{'jobId':_0x420da2};}static async['getResult'](_0x4e5b67){const _0x4f63d6=a319_0x4282a7,{status:_0x37d397}=await RetrieveMetadataService[_0x4f63d6(0x11d)](_0x4e5b67);if(_0x37d397===logger_enums_1[_0x4f63d6(0xe9)][_0x4f63d6(0xfa)])throw new bad_request_error_1[(_0x4f63d6(0x110))](_0x4f63d6(0x119));const _0x36ba70=path_1[_0x4f63d6(0xe5)]['join'](RetrieveMetadataService[_0x4f63d6(0xf2)],_0x4e5b67,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x4f63d6(0xf0)][_0x4f63d6(0x105)](_0x36ba70))return(0x0,promises_1[_0x4f63d6(0xec)])(_0x36ba70,_0x4f63d6(0x10c))[_0x4f63d6(0x11a)](JSON['parse']);else throw new not_found_error_1[(_0x4f63d6(0x101))](_0x4f63d6(0xf7));}static async['getResultChunk'](_0x1b3a64,_0x46cedd){const _0x385cfc=a319_0x4282a7,{status:_0x15beba}=await RetrieveMetadataService[_0x385cfc(0x11d)](_0x1b3a64);if(_0x15beba===logger_enums_1[_0x385cfc(0xe9)][_0x385cfc(0xfa)])throw new bad_request_error_1[(_0x385cfc(0x110))]('Job\x20not\x20completed.');const _0x4df32f=path_1[_0x385cfc(0xe5)][_0x385cfc(0x10b)](RetrieveMetadataService[_0x385cfc(0xf2)],_0x1b3a64,constants_1[_0x385cfc(0xf3)]),_0x3333da={'data':[]};if(await utils_1['FsUtils']['isExistsPath'](path_1[_0x385cfc(0xe5)]['join'](_0x4df32f,_0x46cedd+_0x385cfc(0xf9))))_0x3333da[_0x385cfc(0x114)]=await(0x0,promises_1[_0x385cfc(0xec)])(path_1['default'][_0x385cfc(0x10b)](_0x4df32f,_0x46cedd+_0x385cfc(0xf9)),_0x385cfc(0x10c))['then'](JSON['parse']);else throw new not_found_error_1[(_0x385cfc(0x101))](_0x385cfc(0xf4));return _0x3333da;}static async['getJobStatus'](_0x3faa86){const _0x181814=a319_0x4282a7;try{return await state_manger_1[_0x181814(0xe5)][_0x181814(0x106)](path_1[_0x181814(0xe5)][_0x181814(0x10b)](RetrieveMetadataService[_0x181814(0xf2)],_0x3faa86));}catch(_0x4149ee){throw new not_found_error_1['NotFoundError'](_0x4149ee);}}static async[a319_0x4282a7(0xfc)](_0x14a9ab){const _0x43904e=a319_0x4282a7,_0x5f162c=path_1[_0x43904e(0xe5)][_0x43904e(0x10b)](RetrieveMetadataService[_0x43904e(0xf2)],_0x14a9ab,job_1[_0x43904e(0xef)]);if(await utils_1['FsUtils']['isExistsPath'](_0x5f162c))return(0x0,promises_1[_0x43904e(0xec)])(_0x5f162c,_0x43904e(0x10c))[_0x43904e(0x11a)](_0x3c658f=>csv_utils_1['default'][_0x43904e(0xe4)](_0x3c658f,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x43904e(0x104));}}exports[a319_0x4282a7(0xe5)]=RetrieveMetadataService,RetrieveMetadataService[a319_0x4282a7(0xf2)]=path_1[a319_0x4282a7(0xe5)]['join'](path_2[a319_0x4282a7(0x11e)],constants_1[a319_0x4282a7(0x112)]);