const a274_0x53effa=a274_0x21c2;function a274_0xf0ef(){const _0x51044d=['RETRIEVE_METADATA_FOLDER_NAME','JOB_LOG_DETAILS_FILENAME','BadRequestError','fs/promises','constructor','498468gFUQOV','getJobsIds','2104624hzgFWt','setError','FsUtils','path','(((.+)+)+)+$','catch','../job/enums/logger.enums','4fXjzvT','search','getJobState','../job/classes/manifest-manger','RETRIEVE_RESULT_FOLDER_NAME','Chunk\x20not\x20found.','234674XUdsNb','825398BiYJIK','__esModule','apply','parse','../../shared/utils/job.utils','generateJobId','toString','retrieveMetadataFolder','1233ByGLCQ','Job\x20not\x20completed.','RETRIEVE_RESULTS_IDS_FILENAME','JobStatus','then','getResult','../../../core/errors/not-found.error','.json','isExistsPath','../../../constants/job','../../shared/utils/fs.utils','@flosum/utils','getJobStatus','join','data','create','slice','IN_PROGRESS','init','../../../core/errors/bad-request.error','7884789xKREvz','../job/classes/state-manger','getResultChunk','../../shared/utils/csv.utils','JOB_PATH','8770yVfMzJ','1ILIEKI','5CnHopD','makeDir','108609XStmaG','__importDefault','getJobLogs','dataPath','default','NotFoundError','Result\x20not\x20found.','readFile','getJobs','utf-8'];a274_0xf0ef=function(){return _0x51044d;};return a274_0xf0ef();}(function(_0x5e5f3d,_0x1a2f23){const _0x4e5f21=a274_0x21c2,_0x391d2e=_0x5e5f3d();while(!![]){try{const _0x314066=-parseInt(_0x4e5f21(0x1ae))/0x1*(parseInt(_0x4e5f21(0x18b))/0x2)+parseInt(_0x4e5f21(0x1b1))/0x3*(-parseInt(_0x4e5f21(0x185))/0x4)+parseInt(_0x4e5f21(0x1af))/0x5*(parseInt(_0x4e5f21(0x17c))/0x6)+-parseInt(_0x4e5f21(0x18c))/0x7+-parseInt(_0x4e5f21(0x17e))/0x8+-parseInt(_0x4e5f21(0x194))/0x9*(parseInt(_0x4e5f21(0x1ad))/0xa)+parseInt(_0x4e5f21(0x1a8))/0xb;if(_0x314066===_0x1a2f23)break;else _0x391d2e['push'](_0x391d2e['shift']());}catch(_0x477130){_0x391d2e['push'](_0x391d2e['shift']());}}}(a274_0xf0ef,0x2372c));function a274_0x21c2(_0x38a3c2,_0x3d63d4){const _0x567f90=a274_0xf0ef();return a274_0x21c2=function(_0x5180d8,_0x2588cf){_0x5180d8=_0x5180d8-0x171;let _0xf0ef14=_0x567f90[_0x5180d8];return _0xf0ef14;},a274_0x21c2(_0x38a3c2,_0x3d63d4);}const a274_0x2588cf=(function(){let _0x5919c3=!![];return function(_0x5b982e,_0x368d5a){const _0x1c2898=_0x5919c3?function(){const _0x51cdc4=a274_0x21c2;if(_0x368d5a){const _0x1ca419=_0x368d5a[_0x51cdc4(0x18e)](_0x5b982e,arguments);return _0x368d5a=null,_0x1ca419;}}:function(){};return _0x5919c3=![],_0x1c2898;};}()),a274_0x5180d8=a274_0x2588cf(this,function(){const _0x25a538=a274_0x21c2;return a274_0x5180d8[_0x25a538(0x192)]()[_0x25a538(0x186)]('(((.+)+)+)+$')[_0x25a538(0x192)]()[_0x25a538(0x17b)](a274_0x5180d8)[_0x25a538(0x186)](_0x25a538(0x182));});a274_0x5180d8();'use strict';var __importDefault=this&&this[a274_0x53effa(0x1b2)]||function(_0x1c86a9){return _0x1c86a9&&_0x1c86a9['__esModule']?_0x1c86a9:{'default':_0x1c86a9};};Object['defineProperty'](exports,a274_0x53effa(0x18d),{'value':!![]});const job_utils_1=__importDefault(require(a274_0x53effa(0x190))),path_1=__importDefault(require(a274_0x53effa(0x181))),manifest_manger_1=__importDefault(require(a274_0x53effa(0x188))),state_manger_1=__importDefault(require(a274_0x53effa(0x1a9))),promises_1=require(a274_0x53effa(0x17a)),utils_1=require(a274_0x53effa(0x19f)),csv_utils_1=__importDefault(require(a274_0x53effa(0x1ab))),not_found_error_1=require(a274_0x53effa(0x19a)),logger_enums_1=require(a274_0x53effa(0x184)),bad_request_error_1=require(a274_0x53effa(0x1a7)),job_1=require(a274_0x53effa(0x19d)),fs_utils_1=require(a274_0x53effa(0x19e)),constants_1=require('../constants'),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a274_0x53effa(0x175)](_0x5ad53c,_0x4bb0df){const _0xcb404e=a274_0x53effa,_0x35edec=await job_utils_1[_0xcb404e(0x171)][_0xcb404e(0x17d)](RetrieveMetadataService[_0xcb404e(0x193)]),_0xf9ceaa=await job_utils_1['default']['sortJobsIds'](RetrieveMetadataService[_0xcb404e(0x193)],_0x35edec),_0xaa9641=_0xf9ceaa[_0xcb404e(0x1a4)](_0x4bb0df,_0x4bb0df+_0x5ad53c),_0x53b95c=[];for(const _0x140b1c of _0xaa9641){const _0x2e5437=await state_manger_1[_0xcb404e(0x171)][_0xcb404e(0x187)](path_1[_0xcb404e(0x171)][_0xcb404e(0x1a1)](RetrieveMetadataService['retrieveMetadataFolder'],_0x140b1c));_0x53b95c['push'](_0x2e5437);}return _0x53b95c;}static async['createRetrieveJob'](_0x56ab8d){const _0x17bd8a=a274_0x53effa,_0x1551dc=job_utils_1[_0x17bd8a(0x171)][_0x17bd8a(0x191)](),_0x213af7=path_1[_0x17bd8a(0x171)][_0x17bd8a(0x1a1)](RetrieveMetadataService['retrieveMetadataFolder'],_0x1551dc);await(0x0,fs_utils_1[_0x17bd8a(0x1b0)])(_0x213af7),await manifest_manger_1['default'][_0x17bd8a(0x1a3)](_0x213af7,_0x56ab8d),await state_manger_1[_0x17bd8a(0x171)][_0x17bd8a(0x1a3)](_0x213af7,_0x1551dc);const _0x103693=path_1[_0x17bd8a(0x171)][_0x17bd8a(0x1a1)](__dirname,job_1[_0x17bd8a(0x1ac)]);return job_utils_1[_0x17bd8a(0x171)]['runJob'](_0x103693,{'jobStorePath':_0x213af7,'jobId':_0x1551dc})[_0x17bd8a(0x183)](async _0x8db18e=>{const _0x22d05e=_0x17bd8a,_0x2e0395=new state_manger_1['default'](_0x213af7);await _0x2e0395[_0x22d05e(0x1a6)](),await _0x2e0395[_0x22d05e(0x17f)](_0x8db18e);}),{'jobId':_0x1551dc};}static async[a274_0x53effa(0x199)](_0x41e2c1){const _0x1fe540=a274_0x53effa,{status:_0x11b263}=await RetrieveMetadataService['getJobStatus'](_0x41e2c1);if(_0x11b263===logger_enums_1[_0x1fe540(0x197)][_0x1fe540(0x1a5)])throw new bad_request_error_1[(_0x1fe540(0x179))](_0x1fe540(0x195));const _0x55f078=path_1[_0x1fe540(0x171)][_0x1fe540(0x1a1)](RetrieveMetadataService[_0x1fe540(0x193)],_0x41e2c1,constants_1[_0x1fe540(0x196)]);if(await utils_1[_0x1fe540(0x180)][_0x1fe540(0x19c)](_0x55f078))return(0x0,promises_1['readFile'])(_0x55f078,_0x1fe540(0x176))['then'](JSON[_0x1fe540(0x18f)]);else throw new not_found_error_1[(_0x1fe540(0x172))](_0x1fe540(0x173));}static async[a274_0x53effa(0x1aa)](_0x568d4f,_0x4ae8e8){const _0x5c97fb=a274_0x53effa,{status:_0x352abb}=await RetrieveMetadataService[_0x5c97fb(0x1a0)](_0x568d4f);if(_0x352abb===logger_enums_1[_0x5c97fb(0x197)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x5c97fb(0x179))](_0x5c97fb(0x195));const _0x29885e=path_1[_0x5c97fb(0x171)][_0x5c97fb(0x1a1)](RetrieveMetadataService[_0x5c97fb(0x193)],_0x568d4f,constants_1[_0x5c97fb(0x189)]),_0x3c4eb9={'data':[]};if(await utils_1['FsUtils'][_0x5c97fb(0x19c)](path_1['default']['join'](_0x29885e,_0x4ae8e8+_0x5c97fb(0x19b))))_0x3c4eb9[_0x5c97fb(0x1a2)]=await(0x0,promises_1[_0x5c97fb(0x174)])(path_1[_0x5c97fb(0x171)][_0x5c97fb(0x1a1)](_0x29885e,_0x4ae8e8+_0x5c97fb(0x19b)),_0x5c97fb(0x176))[_0x5c97fb(0x198)](JSON[_0x5c97fb(0x18f)]);else throw new not_found_error_1[(_0x5c97fb(0x172))](_0x5c97fb(0x18a));return _0x3c4eb9;}static async[a274_0x53effa(0x1a0)](_0x252d27){const _0x1afeed=a274_0x53effa;try{return await state_manger_1[_0x1afeed(0x171)][_0x1afeed(0x187)](path_1[_0x1afeed(0x171)][_0x1afeed(0x1a1)](RetrieveMetadataService[_0x1afeed(0x193)],_0x252d27));}catch(_0x4814da){throw new not_found_error_1['NotFoundError'](_0x4814da);}}static async[a274_0x53effa(0x1b3)](_0x2e1c40){const _0x10f193=a274_0x53effa,_0x2e30d4=path_1[_0x10f193(0x171)][_0x10f193(0x1a1)](RetrieveMetadataService[_0x10f193(0x193)],_0x2e1c40,job_1[_0x10f193(0x178)]);if(await utils_1[_0x10f193(0x180)][_0x10f193(0x19c)](_0x2e30d4))return(0x0,promises_1[_0x10f193(0x174)])(_0x2e30d4,_0x10f193(0x176))['then'](_0xd7938d=>csv_utils_1[_0x10f193(0x171)][_0x10f193(0x18f)](_0xd7938d,{'columns':!![]}));throw new not_found_error_1[(_0x10f193(0x172))]('Job\x20log\x20not\x20found.');}}exports[a274_0x53effa(0x171)]=RetrieveMetadataService,RetrieveMetadataService[a274_0x53effa(0x193)]=path_1[a274_0x53effa(0x171)]['join'](path_2[a274_0x53effa(0x1b4)],constants_1[a274_0x53effa(0x177)]);