const a277_0x25b15e=a277_0x41cf;(function(_0x25483a,_0x5f324e){const _0x3dfb42=a277_0x41cf,_0x5d10bd=_0x25483a();while(!![]){try{const _0x869e6f=-parseInt(_0x3dfb42(0xa3))/0x1+-parseInt(_0x3dfb42(0x83))/0x2*(-parseInt(_0x3dfb42(0xc0))/0x3)+parseInt(_0x3dfb42(0xba))/0x4*(parseInt(_0x3dfb42(0xc1))/0x5)+parseInt(_0x3dfb42(0xb9))/0x6*(-parseInt(_0x3dfb42(0x8b))/0x7)+parseInt(_0x3dfb42(0xa9))/0x8*(parseInt(_0x3dfb42(0xa2))/0x9)+-parseInt(_0x3dfb42(0xab))/0xa*(-parseInt(_0x3dfb42(0xbf))/0xb)+-parseInt(_0x3dfb42(0xae))/0xc;if(_0x869e6f===_0x5f324e)break;else _0x5d10bd['push'](_0x5d10bd['shift']());}catch(_0x4a25ab){_0x5d10bd['push'](_0x5d10bd['shift']());}}}(a277_0x290b,0xae754));function a277_0x41cf(_0x4b1fe4,_0x59102d){const _0x14e386=a277_0x290b();return a277_0x41cf=function(_0x4da718,_0x406e27){_0x4da718=_0x4da718-0x82;let _0x290bde=_0x14e386[_0x4da718];return _0x290bde;},a277_0x41cf(_0x4b1fe4,_0x59102d);}const a277_0x406e27=(function(){let _0x263d40=!![];return function(_0x2c9ddd,_0x5c0302){const _0x2367ee=_0x263d40?function(){const _0x3afbe0=a277_0x41cf;if(_0x5c0302){const _0x5b79d5=_0x5c0302[_0x3afbe0(0x9e)](_0x2c9ddd,arguments);return _0x5c0302=null,_0x5b79d5;}}:function(){};return _0x263d40=![],_0x2367ee;};}()),a277_0x4da718=a277_0x406e27(this,function(){const _0x5dfca7=a277_0x41cf;return a277_0x4da718[_0x5dfca7(0xb4)]()[_0x5dfca7(0x99)](_0x5dfca7(0x93))['toString']()[_0x5dfca7(0x9d)](a277_0x4da718)['search'](_0x5dfca7(0x93));});a277_0x4da718();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4075d1){const _0x5878b5=a277_0x41cf;return _0x4075d1&&_0x4075d1[_0x5878b5(0x8e)]?_0x4075d1:{'default':_0x4075d1};};Object[a277_0x25b15e(0x90)](exports,a277_0x25b15e(0x8e),{'value':!![]});function a277_0x290b(){const _0x4a62da=['Job\x20not\x20completed.','264gsSgCf','3gHeuBo','5TiPvqO','readFile','525892CUKHhe','isExistsPath','../job/classes/manifest-manger','Chunk\x20not\x20found.','slice','join','init','parse','20741yMSwCO','RETRIEVE_RESULTS_IDS_FILENAME','../../shared/managers/state-manger','__esModule','path','defineProperty','../../../configs/path','retrieveMetadataFolder','(((.+)+)+)+$','getResult','../../../core/errors/not-found.error','makeDir','default','setError','search','catch','BadRequestError','@flosum/utils','constructor','apply','JOB_PATH','runJob','NotFoundError','7333686wxMNEj','311634XXIhKu','then','IN_PROGRESS','Job\x20log\x20not\x20found.','getJobsIds','RETRIEVE_RESULT_FOLDER_NAME','8UDotAp','Result\x20not\x20found.','546370GgvXhV','getJobs','FsUtils','31680840AQgZms','../constants','JOB_LOG_DETAILS_FILENAME','getJobState','getJobStatus','JobStatus','toString','utf-8','getJobLogs','fs/promises','data','138VrSYou','5381380JwwnIb','sortJobsIds','getResultChunk','../../shared/utils/csv.utils'];a277_0x290b=function(){return _0x4a62da;};return a277_0x290b();}const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a277_0x25b15e(0x8f))),manifest_manger_1=__importDefault(require(a277_0x25b15e(0x85))),state_manger_1=__importDefault(require(a277_0x25b15e(0x8d))),promises_1=require(a277_0x25b15e(0xb7)),utils_1=require(a277_0x25b15e(0x9c)),csv_utils_1=__importDefault(require(a277_0x25b15e(0xbd))),not_found_error_1=require(a277_0x25b15e(0x95)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require('../../../constants/job'),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a277_0x25b15e(0xaf)),path_2=require(a277_0x25b15e(0x91));class RetrieveMetadataService{static async[a277_0x25b15e(0xac)](_0x1b00f8,_0x2447a7){const _0x5ebdee=a277_0x25b15e,_0x328dce=await job_utils_1[_0x5ebdee(0x97)][_0x5ebdee(0xa7)](RetrieveMetadataService[_0x5ebdee(0x92)]),_0x484e8f=await job_utils_1[_0x5ebdee(0x97)][_0x5ebdee(0xbb)](RetrieveMetadataService['retrieveMetadataFolder'],_0x328dce),_0x28f5ca=_0x484e8f[_0x5ebdee(0x87)](_0x2447a7,_0x2447a7+_0x1b00f8),_0xb0a536=[];for(const _0xc16301 of _0x28f5ca){const _0x4750e6=await state_manger_1['default'][_0x5ebdee(0xb1)](path_1[_0x5ebdee(0x97)][_0x5ebdee(0x88)](RetrieveMetadataService[_0x5ebdee(0x92)],_0xc16301));_0xb0a536['push'](_0x4750e6);}return _0xb0a536;}static async['createRetrieveJob'](_0x3c4f4a){const _0xe71b07=a277_0x25b15e,_0x10ef02=job_utils_1[_0xe71b07(0x97)]['generateJobId'](),_0x26aad8=path_1[_0xe71b07(0x97)][_0xe71b07(0x88)](RetrieveMetadataService[_0xe71b07(0x92)],_0x10ef02);await(0x0,fs_utils_1[_0xe71b07(0x96)])(_0x26aad8),await manifest_manger_1['default']['create'](_0x26aad8,_0x3c4f4a),await state_manger_1[_0xe71b07(0x97)]['create'](_0x26aad8,_0x10ef02);const _0x5d8e8f=path_1[_0xe71b07(0x97)][_0xe71b07(0x88)](__dirname,job_1[_0xe71b07(0x9f)]);return job_utils_1[_0xe71b07(0x97)][_0xe71b07(0xa0)](_0x5d8e8f,{'jobStorePath':_0x26aad8,'jobId':_0x10ef02})[_0xe71b07(0x9a)](async _0xb6663c=>{const _0x21dbb0=_0xe71b07,_0x3c1eb4=new state_manger_1['default'](_0x26aad8);await _0x3c1eb4[_0x21dbb0(0x89)](),await _0x3c1eb4[_0x21dbb0(0x98)](_0xb6663c);}),{'jobId':_0x10ef02};}static async[a277_0x25b15e(0x94)](_0x572276){const _0x8ca131=a277_0x25b15e,{status:_0x469fd1}=await RetrieveMetadataService['getJobStatus'](_0x572276);if(_0x469fd1===logger_enums_1['JobStatus'][_0x8ca131(0xa5)])throw new bad_request_error_1['BadRequestError']('Job\x20not\x20completed.');const _0x9ad64e=path_1[_0x8ca131(0x97)][_0x8ca131(0x88)](RetrieveMetadataService[_0x8ca131(0x92)],_0x572276,constants_1[_0x8ca131(0x8c)]);if(await utils_1[_0x8ca131(0xad)]['isExistsPath'](_0x9ad64e))return(0x0,promises_1[_0x8ca131(0x82)])(_0x9ad64e,'utf-8')['then'](JSON[_0x8ca131(0x8a)]);else throw new not_found_error_1[(_0x8ca131(0xa1))](_0x8ca131(0xaa));}static async[a277_0x25b15e(0xbc)](_0x4a7fd7,_0x1ecd62){const _0x4d09df=a277_0x25b15e,{status:_0x3a7373}=await RetrieveMetadataService[_0x4d09df(0xb2)](_0x4a7fd7);if(_0x3a7373===logger_enums_1[_0x4d09df(0xb3)][_0x4d09df(0xa5)])throw new bad_request_error_1[(_0x4d09df(0x9b))](_0x4d09df(0xbe));const _0x4bb2bc=path_1[_0x4d09df(0x97)][_0x4d09df(0x88)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4a7fd7,constants_1[_0x4d09df(0xa8)]),_0x13456f={'data':[]};if(await utils_1[_0x4d09df(0xad)][_0x4d09df(0x84)](path_1['default']['join'](_0x4bb2bc,_0x1ecd62+'.json')))_0x13456f[_0x4d09df(0xb8)]=await(0x0,promises_1[_0x4d09df(0x82)])(path_1[_0x4d09df(0x97)][_0x4d09df(0x88)](_0x4bb2bc,_0x1ecd62+'.json'),_0x4d09df(0xb5))[_0x4d09df(0xa4)](JSON[_0x4d09df(0x8a)]);else throw new not_found_error_1[(_0x4d09df(0xa1))](_0x4d09df(0x86));return _0x13456f;}static async[a277_0x25b15e(0xb2)](_0x2e0f2a){const _0x27c908=a277_0x25b15e;try{return await state_manger_1[_0x27c908(0x97)]['getJobState'](path_1[_0x27c908(0x97)][_0x27c908(0x88)](RetrieveMetadataService[_0x27c908(0x92)],_0x2e0f2a));}catch(_0x56241f){throw new not_found_error_1[(_0x27c908(0xa1))](_0x56241f);}}static async[a277_0x25b15e(0xb6)](_0x575251){const _0x386f10=a277_0x25b15e,_0x16a074=path_1[_0x386f10(0x97)][_0x386f10(0x88)](RetrieveMetadataService[_0x386f10(0x92)],_0x575251,job_1[_0x386f10(0xb0)]);if(await utils_1[_0x386f10(0xad)]['isExistsPath'](_0x16a074))return(0x0,promises_1[_0x386f10(0x82)])(_0x16a074,'utf-8')[_0x386f10(0xa4)](_0x5e607e=>csv_utils_1[_0x386f10(0x97)]['parse'](_0x5e607e,{'columns':!![]}));throw new not_found_error_1[(_0x386f10(0xa1))](_0x386f10(0xa6));}}exports[a277_0x25b15e(0x97)]=RetrieveMetadataService,RetrieveMetadataService[a277_0x25b15e(0x92)]=path_1['default'][a277_0x25b15e(0x88)](path_2['dataPath'],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);