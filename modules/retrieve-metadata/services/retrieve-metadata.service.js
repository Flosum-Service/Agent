const a274_0x648f66=a274_0x30e0;(function(_0x19dbee,_0x3848e9){const _0x4b396d=a274_0x30e0,_0x413de1=_0x19dbee();while(!![]){try{const _0x3a60b2=-parseInt(_0x4b396d(0xa1))/0x1+parseInt(_0x4b396d(0x83))/0x2*(-parseInt(_0x4b396d(0x78))/0x3)+parseInt(_0x4b396d(0x97))/0x4+parseInt(_0x4b396d(0x96))/0x5+-parseInt(_0x4b396d(0x8c))/0x6*(parseInt(_0x4b396d(0x75))/0x7)+-parseInt(_0x4b396d(0x9f))/0x8*(-parseInt(_0x4b396d(0x8b))/0x9)+-parseInt(_0x4b396d(0x88))/0xa*(-parseInt(_0x4b396d(0x72))/0xb);if(_0x3a60b2===_0x3848e9)break;else _0x413de1['push'](_0x413de1['shift']());}catch(_0x411df3){_0x413de1['push'](_0x413de1['shift']());}}}(a274_0xb277,0x2b451));function a274_0x30e0(_0xd6d82a,_0x2a0aa2){const _0x1737d5=a274_0xb277();return a274_0x30e0=function(_0xb32143,_0xce0225){_0xb32143=_0xb32143-0x6c;let _0xb27734=_0x1737d5[_0xb32143];return _0xb27734;},a274_0x30e0(_0xd6d82a,_0x2a0aa2);}const a274_0xce0225=(function(){let _0x6e3954=!![];return function(_0x27ac64,_0x90a728){const _0x16dd53=_0x6e3954?function(){const _0x44d7e3=a274_0x30e0;if(_0x90a728){const _0x34f930=_0x90a728[_0x44d7e3(0x8e)](_0x27ac64,arguments);return _0x90a728=null,_0x34f930;}}:function(){};return _0x6e3954=![],_0x16dd53;};}()),a274_0xb32143=a274_0xce0225(this,function(){const _0x4d6bea=a274_0x30e0;return a274_0xb32143[_0x4d6bea(0x7c)]()['search']('(((.+)+)+)+$')[_0x4d6bea(0x7c)]()['constructor'](a274_0xb32143)['search'](_0x4d6bea(0x73));});a274_0xb32143();'use strict';var __importDefault=this&&this[a274_0x648f66(0x8a)]||function(_0x57f908){const _0xe5d2c6=a274_0x648f66;return _0x57f908&&_0x57f908[_0xe5d2c6(0x71)]?_0x57f908:{'default':_0x57f908};};Object[a274_0x648f66(0x70)](exports,a274_0x648f66(0x71),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require(a274_0x648f66(0x79))),state_manger_1=__importDefault(require(a274_0x648f66(0x84))),promises_1=require(a274_0x648f66(0x81)),utils_1=require(a274_0x648f66(0x9b)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a274_0x648f66(0x7d)),logger_enums_1=require('../job/enums/logger.enums'),bad_request_error_1=require(a274_0x648f66(0x8d)),job_1=require('../../../constants/job'),fs_utils_1=require(a274_0x648f66(0xa7)),constants_1=require(a274_0x648f66(0x6f)),path_2=require('../../../configs/path');function a274_0xb277(){const _0x17c5d5=['Job\x20log\x20not\x20found.','IN_PROGRESS','.json','Result\x20not\x20found.','../constants','defineProperty','__esModule','331133WokoNe','(((.+)+)+)+$','catch','7HUJYnm','isExistsPath','JobStatus','33ySxfiT','../job/classes/manifest-manger','BadRequestError','runJob','toString','../../../core/errors/not-found.error','RETRIEVE_METADATA_FOLDER_NAME','makeDir','then','fs/promises','push','34172xYMOWJ','../job/classes/state-manger','Chunk\x20not\x20found.','generateJobId','setError','180XLupRR','getJobsIds','__importDefault','9SKIRgR','1857120RCayOy','../../../core/errors/bad-request.error','apply','Job\x20not\x20completed.','RETRIEVE_RESULTS_IDS_FILENAME','create','init','utf-8','NotFoundError','parse','82120cGyoeR','24468AfEKUl','FsUtils','getResultChunk','sortJobsIds','@flosum/utils','join','getJobs','retrieveMetadataFolder','2630192rnjPiv','default','218470sAlpMS','readFile','data','getJobState','dataPath','RETRIEVE_RESULT_FOLDER_NAME','../../shared/utils/fs.utils','getJobStatus'];a274_0xb277=function(){return _0x17c5d5;};return a274_0xb277();}class RetrieveMetadataService{static async[a274_0x648f66(0x9d)](_0xb2d7c1,_0x1148ea){const _0x486cdc=a274_0x648f66,_0x33b0cd=await job_utils_1[_0x486cdc(0xa0)][_0x486cdc(0x89)](RetrieveMetadataService[_0x486cdc(0x9e)]),_0x4c4a46=await job_utils_1[_0x486cdc(0xa0)][_0x486cdc(0x9a)](RetrieveMetadataService['retrieveMetadataFolder'],_0x33b0cd),_0x12b580=_0x4c4a46['slice'](_0x1148ea,_0x1148ea+_0xb2d7c1),_0x4106b1=[];for(const _0x43bc49 of _0x12b580){const _0x231810=await state_manger_1[_0x486cdc(0xa0)][_0x486cdc(0xa4)](path_1['default']['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x43bc49));_0x4106b1[_0x486cdc(0x82)](_0x231810);}return _0x4106b1;}static async['createRetrieveJob'](_0x39196b){const _0x30e92c=a274_0x648f66,_0x16785f=job_utils_1[_0x30e92c(0xa0)][_0x30e92c(0x86)](),_0x17847c=path_1[_0x30e92c(0xa0)]['join'](RetrieveMetadataService[_0x30e92c(0x9e)],_0x16785f);await(0x0,fs_utils_1[_0x30e92c(0x7f)])(_0x17847c),await manifest_manger_1[_0x30e92c(0xa0)][_0x30e92c(0x91)](_0x17847c,_0x39196b),await state_manger_1[_0x30e92c(0xa0)][_0x30e92c(0x91)](_0x17847c,_0x16785f);const _0x1edac5=path_1[_0x30e92c(0xa0)]['join'](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x30e92c(0xa0)][_0x30e92c(0x7b)](_0x1edac5,{'jobStorePath':_0x17847c,'jobId':_0x16785f})[_0x30e92c(0x74)](async _0x349bf5=>{const _0x538909=_0x30e92c,_0x5a67c3=new state_manger_1['default'](_0x17847c);await _0x5a67c3[_0x538909(0x92)](),await _0x5a67c3[_0x538909(0x87)](_0x349bf5);}),{'jobId':_0x16785f};}static async['getResult'](_0x11de24){const _0x34189c=a274_0x648f66,{status:_0x451c71}=await RetrieveMetadataService['getJobStatus'](_0x11de24);if(_0x451c71===logger_enums_1[_0x34189c(0x77)][_0x34189c(0x6c)])throw new bad_request_error_1[(_0x34189c(0x7a))](_0x34189c(0x8f));const _0x5d094e=path_1['default']['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x11de24,constants_1[_0x34189c(0x90)]);if(await utils_1[_0x34189c(0x98)][_0x34189c(0x76)](_0x5d094e))return(0x0,promises_1[_0x34189c(0xa2)])(_0x5d094e,_0x34189c(0x93))[_0x34189c(0x80)](JSON[_0x34189c(0x95)]);else throw new not_found_error_1[(_0x34189c(0x94))](_0x34189c(0x6e));}static async[a274_0x648f66(0x99)](_0x4cbafd,_0x34793c){const _0x5e4baf=a274_0x648f66,{status:_0x20277a}=await RetrieveMetadataService[_0x5e4baf(0xa8)](_0x4cbafd);if(_0x20277a===logger_enums_1[_0x5e4baf(0x77)][_0x5e4baf(0x6c)])throw new bad_request_error_1[(_0x5e4baf(0x7a))](_0x5e4baf(0x8f));const _0x465df0=path_1[_0x5e4baf(0xa0)][_0x5e4baf(0x9c)](RetrieveMetadataService[_0x5e4baf(0x9e)],_0x4cbafd,constants_1[_0x5e4baf(0xa6)]),_0x28b4d0={'data':[]};if(await utils_1[_0x5e4baf(0x98)][_0x5e4baf(0x76)](path_1[_0x5e4baf(0xa0)]['join'](_0x465df0,_0x34793c+'.json')))_0x28b4d0[_0x5e4baf(0xa3)]=await(0x0,promises_1['readFile'])(path_1[_0x5e4baf(0xa0)]['join'](_0x465df0,_0x34793c+_0x5e4baf(0x6d)),_0x5e4baf(0x93))['then'](JSON[_0x5e4baf(0x95)]);else throw new not_found_error_1[(_0x5e4baf(0x94))](_0x5e4baf(0x85));return _0x28b4d0;}static async['getJobStatus'](_0xe00f6a){const _0x3d1bfd=a274_0x648f66;try{return await state_manger_1[_0x3d1bfd(0xa0)]['getJobState'](path_1[_0x3d1bfd(0xa0)][_0x3d1bfd(0x9c)](RetrieveMetadataService[_0x3d1bfd(0x9e)],_0xe00f6a));}catch(_0x1a6330){throw new not_found_error_1['NotFoundError'](_0x1a6330);}}static async['getJobLogs'](_0x4e3011){const _0x9f650d=a274_0x648f66,_0x4d4373=path_1[_0x9f650d(0xa0)][_0x9f650d(0x9c)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4e3011,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1[_0x9f650d(0x98)][_0x9f650d(0x76)](_0x4d4373))return(0x0,promises_1['readFile'])(_0x4d4373,_0x9f650d(0x93))['then'](_0x3b6fd3=>csv_utils_1['default'][_0x9f650d(0x95)](_0x3b6fd3,{'columns':!![]}));throw new not_found_error_1[(_0x9f650d(0x94))](_0x9f650d(0xa9));}}exports[a274_0x648f66(0xa0)]=RetrieveMetadataService,RetrieveMetadataService[a274_0x648f66(0x9e)]=path_1[a274_0x648f66(0xa0)][a274_0x648f66(0x9c)](path_2[a274_0x648f66(0xa5)],constants_1[a274_0x648f66(0x7e)]);