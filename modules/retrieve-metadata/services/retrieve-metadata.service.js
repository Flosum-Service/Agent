const a277_0x37883b=a277_0x5199;(function(_0x372c11,_0x4f6988){const _0x4aaee5=a277_0x5199,_0x51a9d4=_0x372c11();while(!![]){try{const _0x518bb6=-parseInt(_0x4aaee5(0x1f3))/0x1+-parseInt(_0x4aaee5(0x213))/0x2+-parseInt(_0x4aaee5(0x205))/0x3+parseInt(_0x4aaee5(0x1ff))/0x4+-parseInt(_0x4aaee5(0x211))/0x5+parseInt(_0x4aaee5(0x20a))/0x6*(-parseInt(_0x4aaee5(0x1e9))/0x7)+parseInt(_0x4aaee5(0x21b))/0x8;if(_0x518bb6===_0x4f6988)break;else _0x51a9d4['push'](_0x51a9d4['shift']());}catch(_0x4c722b){_0x51a9d4['push'](_0x51a9d4['shift']());}}}(a277_0x2e5e,0xaebed));function a277_0x5199(_0x1670d6,_0x445359){const _0x42cc09=a277_0x2e5e();return a277_0x5199=function(_0x162ec9,_0x12fd1d){_0x162ec9=_0x162ec9-0x1e0;let _0x2e5e50=_0x42cc09[_0x162ec9];return _0x2e5e50;},a277_0x5199(_0x1670d6,_0x445359);}const a277_0x12fd1d=(function(){let _0x17b298=!![];return function(_0x950f59,_0x79a74f){const _0x26dd11=_0x17b298?function(){const _0x10bc3f=a277_0x5199;if(_0x79a74f){const _0x4b46b3=_0x79a74f[_0x10bc3f(0x212)](_0x950f59,arguments);return _0x79a74f=null,_0x4b46b3;}}:function(){};return _0x17b298=![],_0x26dd11;};}()),a277_0x162ec9=a277_0x12fd1d(this,function(){const _0x5eda08=a277_0x5199;return a277_0x162ec9[_0x5eda08(0x1fd)]()['search'](_0x5eda08(0x20b))[_0x5eda08(0x1fd)]()[_0x5eda08(0x200)](a277_0x162ec9)[_0x5eda08(0x1ea)](_0x5eda08(0x20b));});a277_0x162ec9();'use strict';var __importDefault=this&&this[a277_0x37883b(0x1f1)]||function(_0x5c4940){const _0x33f39f=a277_0x37883b;return _0x5c4940&&_0x5c4940[_0x33f39f(0x1e5)]?_0x5c4940:{'default':_0x5c4940};};Object['defineProperty'](exports,a277_0x37883b(0x1e5),{'value':!![]});const job_utils_1=__importDefault(require(a277_0x37883b(0x1fb))),path_1=__importDefault(require(a277_0x37883b(0x218))),manifest_manger_1=__importDefault(require(a277_0x37883b(0x1eb))),state_manger_1=__importDefault(require(a277_0x37883b(0x209))),promises_1=require(a277_0x37883b(0x216)),utils_1=require(a277_0x37883b(0x21a)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a277_0x37883b(0x1e3)),logger_enums_1=require(a277_0x37883b(0x1f2)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require(a277_0x37883b(0x203)),fs_utils_1=require(a277_0x37883b(0x1e4)),constants_1=require('../constants'),path_2=require('../../../configs/path');function a277_0x2e5e(){const _0x1f26db=['getJobStatus','../../shared/utils/job.utils','setError','toString','sortJobsIds','4488528msRUjR','constructor','Result\x20not\x20found.','slice','../../../constants/job','IN_PROGRESS','8670msTIIK','getJobs','BadRequestError','JobStatus','../../shared/managers/state-manger','12vrLAPo','(((.+)+)+)+$','parse','RETRIEVE_RESULTS_IDS_FILENAME','utf-8','catch','createRetrieveJob','2198370PKSPIH','apply','2035740ZOXpDV','FsUtils','Job\x20not\x20completed.','fs/promises','join','path','NotFoundError','@flosum/utils','22842168qjHWLf','runJob','readFile','init','create','retrieveMetadataFolder','../../../core/errors/not-found.error','../../shared/utils/fs.utils','__esModule','Job\x20log\x20not\x20found.','push','makeDir','1836877PeWMzW','search','../job/classes/manifest-manger','isExistsPath','Chunk\x20not\x20found.','then','generateJobId','JOB_LOG_DETAILS_FILENAME','__importDefault','../../shared/enums/logger.enums','1276390UxAcjM','getJobLogs','default','getResultChunk','getJobState','RETRIEVE_METADATA_FOLDER_NAME','dataPath'];a277_0x2e5e=function(){return _0x1f26db;};return a277_0x2e5e();}class RetrieveMetadataService{static async[a277_0x37883b(0x206)](_0x4557e3,_0x528f20){const _0x2546f1=a277_0x37883b,_0xe3a2c6=await job_utils_1[_0x2546f1(0x1f5)]['getJobsIds'](RetrieveMetadataService[_0x2546f1(0x1e2)]),_0xce9cfe=await job_utils_1[_0x2546f1(0x1f5)][_0x2546f1(0x1fe)](RetrieveMetadataService[_0x2546f1(0x1e2)],_0xe3a2c6),_0x573f95=_0xce9cfe[_0x2546f1(0x202)](_0x528f20,_0x528f20+_0x4557e3),_0x18dc4b=[];for(const _0x336a43 of _0x573f95){const _0x2b3ee6=await state_manger_1[_0x2546f1(0x1f5)][_0x2546f1(0x1f7)](path_1[_0x2546f1(0x1f5)]['join'](RetrieveMetadataService[_0x2546f1(0x1e2)],_0x336a43));_0x18dc4b[_0x2546f1(0x1e7)](_0x2b3ee6);}return _0x18dc4b;}static async[a277_0x37883b(0x210)](_0x5c9546){const _0x422a28=a277_0x37883b,_0x20ff1d=job_utils_1['default'][_0x422a28(0x1ef)](),_0x477f1d=path_1[_0x422a28(0x1f5)][_0x422a28(0x217)](RetrieveMetadataService[_0x422a28(0x1e2)],_0x20ff1d);await(0x0,fs_utils_1[_0x422a28(0x1e8)])(_0x477f1d),await manifest_manger_1[_0x422a28(0x1f5)][_0x422a28(0x1e1)](_0x477f1d,_0x5c9546),await state_manger_1[_0x422a28(0x1f5)][_0x422a28(0x1e1)](_0x477f1d,_0x20ff1d);const _0x5c279d=path_1[_0x422a28(0x1f5)][_0x422a28(0x217)](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x422a28(0x1f5)][_0x422a28(0x21c)](_0x5c279d,{'jobStorePath':_0x477f1d,'jobId':_0x20ff1d})[_0x422a28(0x20f)](async _0x868699=>{const _0x27f797=_0x422a28,_0x4f2282=new state_manger_1['default'](_0x477f1d);await _0x4f2282[_0x27f797(0x1e0)](),await _0x4f2282[_0x27f797(0x1fc)](_0x868699);}),{'jobId':_0x20ff1d};}static async['getResult'](_0x1e1679){const _0x4e3d56=a277_0x37883b,{status:_0x277737}=await RetrieveMetadataService[_0x4e3d56(0x1fa)](_0x1e1679);if(_0x277737===logger_enums_1[_0x4e3d56(0x208)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x4e3d56(0x207))](_0x4e3d56(0x215));const _0x267c2d=path_1[_0x4e3d56(0x1f5)][_0x4e3d56(0x217)](RetrieveMetadataService[_0x4e3d56(0x1e2)],_0x1e1679,constants_1[_0x4e3d56(0x20d)]);if(await utils_1[_0x4e3d56(0x214)]['isExistsPath'](_0x267c2d))return(0x0,promises_1[_0x4e3d56(0x21d)])(_0x267c2d,_0x4e3d56(0x20e))[_0x4e3d56(0x1ee)](JSON[_0x4e3d56(0x20c)]);else throw new not_found_error_1[(_0x4e3d56(0x219))](_0x4e3d56(0x201));}static async[a277_0x37883b(0x1f6)](_0x190137,_0x8ca5dd){const _0x487135=a277_0x37883b,{status:_0x45edb6}=await RetrieveMetadataService[_0x487135(0x1fa)](_0x190137);if(_0x45edb6===logger_enums_1[_0x487135(0x208)][_0x487135(0x204)])throw new bad_request_error_1['BadRequestError'](_0x487135(0x215));const _0x245c3c=path_1[_0x487135(0x1f5)]['join'](RetrieveMetadataService[_0x487135(0x1e2)],_0x190137,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x3a81e4={'data':[]};if(await utils_1[_0x487135(0x214)]['isExistsPath'](path_1['default']['join'](_0x245c3c,_0x8ca5dd+'.json')))_0x3a81e4['data']=await(0x0,promises_1[_0x487135(0x21d)])(path_1['default'][_0x487135(0x217)](_0x245c3c,_0x8ca5dd+'.json'),_0x487135(0x20e))[_0x487135(0x1ee)](JSON[_0x487135(0x20c)]);else throw new not_found_error_1[(_0x487135(0x219))](_0x487135(0x1ed));return _0x3a81e4;}static async[a277_0x37883b(0x1fa)](_0x17c6ee){const _0x4986d9=a277_0x37883b;try{return await state_manger_1[_0x4986d9(0x1f5)][_0x4986d9(0x1f7)](path_1['default'][_0x4986d9(0x217)](RetrieveMetadataService[_0x4986d9(0x1e2)],_0x17c6ee));}catch(_0x4a262a){throw new not_found_error_1['NotFoundError'](_0x4a262a);}}static async[a277_0x37883b(0x1f4)](_0x59df2a){const _0x4f9790=a277_0x37883b,_0x3df981=path_1[_0x4f9790(0x1f5)][_0x4f9790(0x217)](RetrieveMetadataService[_0x4f9790(0x1e2)],_0x59df2a,job_1[_0x4f9790(0x1f0)]);if(await utils_1['FsUtils'][_0x4f9790(0x1ec)](_0x3df981))return(0x0,promises_1['readFile'])(_0x3df981,_0x4f9790(0x20e))[_0x4f9790(0x1ee)](_0x2a1074=>csv_utils_1['default'][_0x4f9790(0x20c)](_0x2a1074,{'columns':!![]}));throw new not_found_error_1[(_0x4f9790(0x219))](_0x4f9790(0x1e6));}}exports[a277_0x37883b(0x1f5)]=RetrieveMetadataService,RetrieveMetadataService[a277_0x37883b(0x1e2)]=path_1[a277_0x37883b(0x1f5)]['join'](path_2[a277_0x37883b(0x1f9)],constants_1[a277_0x37883b(0x1f8)]);