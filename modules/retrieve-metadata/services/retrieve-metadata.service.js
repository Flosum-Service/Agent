function a321_0x2f06(_0x3cc6cf,_0x176235){const _0x467164=a321_0x4fd4();return a321_0x2f06=function(_0x2478f1,_0x322af4){_0x2478f1=_0x2478f1-0x143;let _0x4fd405=_0x467164[_0x2478f1];return _0x4fd405;},a321_0x2f06(_0x3cc6cf,_0x176235);}const a321_0x54e2c2=a321_0x2f06;(function(_0x4594d6,_0x47088f){const _0x5c771a=a321_0x2f06,_0x548354=_0x4594d6();while(!![]){try{const _0x1a94d7=parseInt(_0x5c771a(0x165))/0x1*(-parseInt(_0x5c771a(0x146))/0x2)+-parseInt(_0x5c771a(0x159))/0x3+parseInt(_0x5c771a(0x16f))/0x4+-parseInt(_0x5c771a(0x15a))/0x5*(-parseInt(_0x5c771a(0x181))/0x6)+parseInt(_0x5c771a(0x16e))/0x7+parseInt(_0x5c771a(0x167))/0x8*(-parseInt(_0x5c771a(0x157))/0x9)+parseInt(_0x5c771a(0x14e))/0xa;if(_0x1a94d7===_0x47088f)break;else _0x548354['push'](_0x548354['shift']());}catch(_0xfc25c5){_0x548354['push'](_0x548354['shift']());}}}(a321_0x4fd4,0x511b6));const a321_0x322af4=(function(){let _0x566939=!![];return function(_0x3f2bf7,_0x3d34b7){const _0x396a25=_0x566939?function(){if(_0x3d34b7){const _0x59b530=_0x3d34b7['apply'](_0x3f2bf7,arguments);return _0x3d34b7=null,_0x59b530;}}:function(){};return _0x566939=![],_0x396a25;};}()),a321_0x2478f1=a321_0x322af4(this,function(){const _0x44117e=a321_0x2f06;return a321_0x2478f1['toString']()[_0x44117e(0x155)]('(((.+)+)+)+$')[_0x44117e(0x151)]()[_0x44117e(0x175)](a321_0x2478f1)[_0x44117e(0x155)]('(((.+)+)+)+$');});function a321_0x4fd4(){const _0x250b1f=['@flosum/utils','Job\x20log\x20not\x20found.','../../shared/enums/logger.enums','runJob','../../../core/errors/bad-request.error','../../../constants/job','13038iqmbRE','getJobsIds','FsUtils','utf-8','10maBKqc','readFile','catch','getResultChunk','getResult','getJobState','Result\x20not\x20found.','../../../core/errors/not-found.error','2675210lhyBWo','fs/promises','__esModule','toString','defineProperty','generateJobId','retrieveMetadataFolder','search','push','3033APTkrA','setError','1270371uLzwzL','1145FixXhS','IN_PROGRESS','RETRIEVE_RESULTS_IDS_FILENAME','getJobStatus','Job\x20not\x20completed.','JOB_PATH','sortJobsIds','parse','create','makeDir','JOB_LOG_DETAILS_FILENAME','31903AmDjLK','JobStatus','10536MPMywV','../job/classes/manifest-manger','data','.json','NotFoundError','init','isExistsPath','3436272PurfGn','411924ArnSnu','join','RETRIEVE_METADATA_FOLDER_NAME','BadRequestError','../constants','default','constructor','../../shared/utils/job.utils','path','getJobs','RETRIEVE_RESULT_FOLDER_NAME','then'];a321_0x4fd4=function(){return _0x250b1f;};return a321_0x4fd4();}a321_0x2478f1();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x166fbe){const _0x1181c3=a321_0x2f06;return _0x166fbe&&_0x166fbe[_0x1181c3(0x150)]?_0x166fbe:{'default':_0x166fbe};};Object[a321_0x54e2c2(0x152)](exports,a321_0x54e2c2(0x150),{'value':!![]});const job_utils_1=__importDefault(require(a321_0x54e2c2(0x176))),path_1=__importDefault(require(a321_0x54e2c2(0x177))),manifest_manger_1=__importDefault(require(a321_0x54e2c2(0x168))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require(a321_0x54e2c2(0x14f)),utils_1=require(a321_0x54e2c2(0x17b)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a321_0x54e2c2(0x14d)),logger_enums_1=require(a321_0x54e2c2(0x17d)),bad_request_error_1=require(a321_0x54e2c2(0x17f)),job_1=require(a321_0x54e2c2(0x180)),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a321_0x54e2c2(0x173)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a321_0x54e2c2(0x178)](_0x473ef7,_0x5ecc14){const _0x595b79=a321_0x54e2c2,_0x29f55a=await job_utils_1[_0x595b79(0x174)][_0x595b79(0x143)](RetrieveMetadataService[_0x595b79(0x154)]),_0x21c870=await job_utils_1[_0x595b79(0x174)][_0x595b79(0x160)](RetrieveMetadataService[_0x595b79(0x154)],_0x29f55a),_0x3c1e95=_0x21c870['slice'](_0x5ecc14,_0x5ecc14+_0x473ef7),_0x176f1f=[];for(const _0x25378d of _0x3c1e95){const _0x15b5d0=await state_manger_1[_0x595b79(0x174)][_0x595b79(0x14b)](path_1['default'][_0x595b79(0x170)](RetrieveMetadataService['retrieveMetadataFolder'],_0x25378d));_0x176f1f[_0x595b79(0x156)](_0x15b5d0);}return _0x176f1f;}static async['createRetrieveJob'](_0x1be3bb){const _0x4dad0c=a321_0x54e2c2,_0x3c8484=job_utils_1[_0x4dad0c(0x174)][_0x4dad0c(0x153)](),_0x49567f=path_1[_0x4dad0c(0x174)][_0x4dad0c(0x170)](RetrieveMetadataService[_0x4dad0c(0x154)],_0x3c8484);await(0x0,fs_utils_1[_0x4dad0c(0x163)])(_0x49567f),await manifest_manger_1[_0x4dad0c(0x174)][_0x4dad0c(0x162)](_0x49567f,_0x1be3bb),await state_manger_1[_0x4dad0c(0x174)][_0x4dad0c(0x162)](_0x49567f,_0x3c8484);const _0x7b1af6=path_1[_0x4dad0c(0x174)]['join'](__dirname,job_1[_0x4dad0c(0x15f)]);return job_utils_1[_0x4dad0c(0x174)][_0x4dad0c(0x17e)](_0x7b1af6,{'jobStorePath':_0x49567f,'jobId':_0x3c8484})[_0x4dad0c(0x148)](async _0xe0251=>{const _0x580fdc=_0x4dad0c,_0x33188b=new state_manger_1[(_0x580fdc(0x174))](_0x49567f);await _0x33188b[_0x580fdc(0x16c)](),await _0x33188b[_0x580fdc(0x158)](_0xe0251);}),{'jobId':_0x3c8484};}static async[a321_0x54e2c2(0x14a)](_0x29face){const _0xd05990=a321_0x54e2c2,{status:_0x596f9f}=await RetrieveMetadataService[_0xd05990(0x15d)](_0x29face);if(_0x596f9f===logger_enums_1[_0xd05990(0x166)][_0xd05990(0x15b)])throw new bad_request_error_1[(_0xd05990(0x172))](_0xd05990(0x15e));const _0x5a6a37=path_1['default']['join'](RetrieveMetadataService[_0xd05990(0x154)],_0x29face,constants_1[_0xd05990(0x15c)]);if(await utils_1['FsUtils'][_0xd05990(0x16d)](_0x5a6a37))return(0x0,promises_1[_0xd05990(0x147)])(_0x5a6a37,_0xd05990(0x145))['then'](JSON[_0xd05990(0x161)]);else throw new not_found_error_1[(_0xd05990(0x16b))](_0xd05990(0x14c));}static async[a321_0x54e2c2(0x149)](_0x140bb1,_0x5c3d1b){const _0x28795a=a321_0x54e2c2,{status:_0x138909}=await RetrieveMetadataService[_0x28795a(0x15d)](_0x140bb1);if(_0x138909===logger_enums_1[_0x28795a(0x166)][_0x28795a(0x15b)])throw new bad_request_error_1[(_0x28795a(0x172))](_0x28795a(0x15e));const _0x359c74=path_1['default'][_0x28795a(0x170)](RetrieveMetadataService[_0x28795a(0x154)],_0x140bb1,constants_1[_0x28795a(0x179)]),_0x34f71f={'data':[]};if(await utils_1[_0x28795a(0x144)]['isExistsPath'](path_1[_0x28795a(0x174)][_0x28795a(0x170)](_0x359c74,_0x5c3d1b+_0x28795a(0x16a))))_0x34f71f[_0x28795a(0x169)]=await(0x0,promises_1[_0x28795a(0x147)])(path_1['default'][_0x28795a(0x170)](_0x359c74,_0x5c3d1b+'.json'),_0x28795a(0x145))[_0x28795a(0x17a)](JSON[_0x28795a(0x161)]);else throw new not_found_error_1[(_0x28795a(0x16b))]('Chunk\x20not\x20found.');return _0x34f71f;}static async[a321_0x54e2c2(0x15d)](_0x532369){const _0x500aab=a321_0x54e2c2;try{return await state_manger_1[_0x500aab(0x174)][_0x500aab(0x14b)](path_1['default'][_0x500aab(0x170)](RetrieveMetadataService[_0x500aab(0x154)],_0x532369));}catch(_0x8defea){throw new not_found_error_1[(_0x500aab(0x16b))](_0x8defea);}}static async['getJobLogs'](_0x10aab4){const _0x492ac6=a321_0x54e2c2,_0x40b71b=path_1[_0x492ac6(0x174)][_0x492ac6(0x170)](RetrieveMetadataService['retrieveMetadataFolder'],_0x10aab4,job_1[_0x492ac6(0x164)]);if(await utils_1[_0x492ac6(0x144)]['isExistsPath'](_0x40b71b))return(0x0,promises_1[_0x492ac6(0x147)])(_0x40b71b,_0x492ac6(0x145))['then'](_0x4a2309=>csv_utils_1[_0x492ac6(0x174)][_0x492ac6(0x161)](_0x4a2309,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x492ac6(0x17c));}}exports[a321_0x54e2c2(0x174)]=RetrieveMetadataService,RetrieveMetadataService[a321_0x54e2c2(0x154)]=path_1[a321_0x54e2c2(0x174)][a321_0x54e2c2(0x170)](path_2['dataPath'],constants_1[a321_0x54e2c2(0x171)]);