const a277_0x56ec93=a277_0x8186;(function(_0x6826cf,_0xe5d8c8){const _0x1adb3b=a277_0x8186,_0x1760d7=_0x6826cf();while(!![]){try{const _0xe20136=parseInt(_0x1adb3b(0x186))/0x1*(parseInt(_0x1adb3b(0x17c))/0x2)+parseInt(_0x1adb3b(0x16d))/0x3+-parseInt(_0x1adb3b(0x1a2))/0x4*(-parseInt(_0x1adb3b(0x16c))/0x5)+-parseInt(_0x1adb3b(0x172))/0x6*(parseInt(_0x1adb3b(0x183))/0x7)+parseInt(_0x1adb3b(0x196))/0x8*(parseInt(_0x1adb3b(0x18e))/0x9)+parseInt(_0x1adb3b(0x191))/0xa+-parseInt(_0x1adb3b(0x198))/0xb*(parseInt(_0x1adb3b(0x197))/0xc);if(_0xe20136===_0xe5d8c8)break;else _0x1760d7['push'](_0x1760d7['shift']());}catch(_0x2dd409){_0x1760d7['push'](_0x1760d7['shift']());}}}(a277_0x44bc,0x1d3e4));const a277_0x4b5b85=(function(){let _0x248306=!![];return function(_0x51a708,_0x43dcad){const _0x4dca0a=_0x248306?function(){const _0x4a8112=a277_0x8186;if(_0x43dcad){const _0xcfe20=_0x43dcad[_0x4a8112(0x168)](_0x51a708,arguments);return _0x43dcad=null,_0xcfe20;}}:function(){};return _0x248306=![],_0x4dca0a;};}()),a277_0xecad08=a277_0x4b5b85(this,function(){const _0x2d1fd8=a277_0x8186;return a277_0xecad08[_0x2d1fd8(0x195)]()[_0x2d1fd8(0x178)](_0x2d1fd8(0x179))[_0x2d1fd8(0x195)]()[_0x2d1fd8(0x18d)](a277_0xecad08)['search'](_0x2d1fd8(0x179));});function a277_0x44bc(){const _0x2d321a=['push','../../shared/utils/csv.utils','../../../constants/job','getJobsIds','11946OjPFFo','JOB_PATH','default','../../shared/utils/job.utils','../../shared/utils/fs.utils','IN_PROGRESS','search','(((.+)+)+)+$','runJob','__importDefault','6urTSsz','path','create','utf-8','FsUtils','getJobs','../../../configs/path','28XqLZRq','init','join','69313KDiCgw','getResult','Job\x20log\x20not\x20found.','BadRequestError','__esModule','catch','setError','constructor','437067dFQaxN','data','NotFoundError','241880nLDOsc','readFile','makeDir','isExistsPath','toString','24GiEbRW','804qgxhEL','64427yyZcnQ','JOB_LOG_DETAILS_FILENAME','RETRIEVE_RESULT_FOLDER_NAME','slice','retrieveMetadataFolder','../../shared/enums/logger.enums','Chunk\x20not\x20found.','../../../core/errors/not-found.error','../../../core/errors/bad-request.error','then','4EIcYYA','getJobLogs','Job\x20not\x20completed.','getJobStatus','parse','.json','apply','../constants','JobStatus','dataPath','441965HOcdhe','161862bddtTW'];a277_0x44bc=function(){return _0x2d321a;};return a277_0x44bc();}a277_0xecad08();'use strict';var __importDefault=this&&this[a277_0x56ec93(0x17b)]||function(_0x3e5683){const _0x41005c=a277_0x56ec93;return _0x3e5683&&_0x3e5683[_0x41005c(0x18a)]?_0x3e5683:{'default':_0x3e5683};};Object['defineProperty'](exports,a277_0x56ec93(0x18a),{'value':!![]});const job_utils_1=__importDefault(require(a277_0x56ec93(0x175))),path_1=__importDefault(require(a277_0x56ec93(0x17d))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require('fs/promises'),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a277_0x56ec93(0x16f))),not_found_error_1=require(a277_0x56ec93(0x19f)),logger_enums_1=require(a277_0x56ec93(0x19d)),bad_request_error_1=require(a277_0x56ec93(0x1a0)),job_1=require(a277_0x56ec93(0x170)),fs_utils_1=require(a277_0x56ec93(0x176)),constants_1=require(a277_0x56ec93(0x169)),path_2=require(a277_0x56ec93(0x182));class RetrieveMetadataService{static async[a277_0x56ec93(0x181)](_0x4bdf0e,_0x14300e){const _0x2e8d51=a277_0x56ec93,_0x39f33a=await job_utils_1[_0x2e8d51(0x174)][_0x2e8d51(0x171)](RetrieveMetadataService[_0x2e8d51(0x19c)]),_0x51754=await job_utils_1[_0x2e8d51(0x174)]['sortJobsIds'](RetrieveMetadataService[_0x2e8d51(0x19c)],_0x39f33a),_0x3e2554=_0x51754[_0x2e8d51(0x19b)](_0x14300e,_0x14300e+_0x4bdf0e),_0x1c8110=[];for(const _0x5738c2 of _0x3e2554){const _0x73a1a5=await state_manger_1[_0x2e8d51(0x174)]['getJobState'](path_1[_0x2e8d51(0x174)]['join'](RetrieveMetadataService[_0x2e8d51(0x19c)],_0x5738c2));_0x1c8110[_0x2e8d51(0x16e)](_0x73a1a5);}return _0x1c8110;}static async['createRetrieveJob'](_0xda38ef){const _0x22211c=a277_0x56ec93,_0x4f773a=job_utils_1['default']['generateJobId'](),_0x42e695=path_1[_0x22211c(0x174)][_0x22211c(0x185)](RetrieveMetadataService[_0x22211c(0x19c)],_0x4f773a);await(0x0,fs_utils_1[_0x22211c(0x193)])(_0x42e695),await manifest_manger_1[_0x22211c(0x174)][_0x22211c(0x17e)](_0x42e695,_0xda38ef),await state_manger_1[_0x22211c(0x174)][_0x22211c(0x17e)](_0x42e695,_0x4f773a);const _0x3b48a7=path_1[_0x22211c(0x174)][_0x22211c(0x185)](__dirname,job_1[_0x22211c(0x173)]);return job_utils_1['default'][_0x22211c(0x17a)](_0x3b48a7,{'jobStorePath':_0x42e695,'jobId':_0x4f773a})[_0x22211c(0x18b)](async _0x2c8052=>{const _0x15ee7c=_0x22211c,_0x266a26=new state_manger_1[(_0x15ee7c(0x174))](_0x42e695);await _0x266a26[_0x15ee7c(0x184)](),await _0x266a26[_0x15ee7c(0x18c)](_0x2c8052);}),{'jobId':_0x4f773a};}static async[a277_0x56ec93(0x187)](_0x4f8b18){const _0x266475=a277_0x56ec93,{status:_0x4571c6}=await RetrieveMetadataService[_0x266475(0x1a5)](_0x4f8b18);if(_0x4571c6===logger_enums_1[_0x266475(0x16a)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x266475(0x189))](_0x266475(0x1a4));const _0x328f5f=path_1[_0x266475(0x174)][_0x266475(0x185)](RetrieveMetadataService[_0x266475(0x19c)],_0x4f8b18,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x266475(0x180)][_0x266475(0x194)](_0x328f5f))return(0x0,promises_1[_0x266475(0x192)])(_0x328f5f,_0x266475(0x17f))[_0x266475(0x1a1)](JSON[_0x266475(0x1a6)]);else throw new not_found_error_1[(_0x266475(0x190))]('Result\x20not\x20found.');}static async['getResultChunk'](_0x37c996,_0x3c9abc){const _0x2b9b8b=a277_0x56ec93,{status:_0x25cd31}=await RetrieveMetadataService[_0x2b9b8b(0x1a5)](_0x37c996);if(_0x25cd31===logger_enums_1[_0x2b9b8b(0x16a)][_0x2b9b8b(0x177)])throw new bad_request_error_1['BadRequestError']('Job\x20not\x20completed.');const _0x4658be=path_1[_0x2b9b8b(0x174)]['join'](RetrieveMetadataService[_0x2b9b8b(0x19c)],_0x37c996,constants_1[_0x2b9b8b(0x19a)]),_0xb33db6={'data':[]};if(await utils_1['FsUtils'][_0x2b9b8b(0x194)](path_1[_0x2b9b8b(0x174)][_0x2b9b8b(0x185)](_0x4658be,_0x3c9abc+'.json')))_0xb33db6[_0x2b9b8b(0x18f)]=await(0x0,promises_1[_0x2b9b8b(0x192)])(path_1[_0x2b9b8b(0x174)][_0x2b9b8b(0x185)](_0x4658be,_0x3c9abc+_0x2b9b8b(0x1a7)),_0x2b9b8b(0x17f))[_0x2b9b8b(0x1a1)](JSON[_0x2b9b8b(0x1a6)]);else throw new not_found_error_1[(_0x2b9b8b(0x190))](_0x2b9b8b(0x19e));return _0xb33db6;}static async[a277_0x56ec93(0x1a5)](_0x3234fc){const _0x1ab88b=a277_0x56ec93;try{return await state_manger_1[_0x1ab88b(0x174)]['getJobState'](path_1[_0x1ab88b(0x174)][_0x1ab88b(0x185)](RetrieveMetadataService[_0x1ab88b(0x19c)],_0x3234fc));}catch(_0x1453a7){throw new not_found_error_1[(_0x1ab88b(0x190))](_0x1453a7);}}static async[a277_0x56ec93(0x1a3)](_0x5d0985){const _0x5928c2=a277_0x56ec93,_0x14296e=path_1['default'][_0x5928c2(0x185)](RetrieveMetadataService[_0x5928c2(0x19c)],_0x5d0985,job_1[_0x5928c2(0x199)]);if(await utils_1[_0x5928c2(0x180)][_0x5928c2(0x194)](_0x14296e))return(0x0,promises_1[_0x5928c2(0x192)])(_0x14296e,_0x5928c2(0x17f))[_0x5928c2(0x1a1)](_0xeade8a=>csv_utils_1[_0x5928c2(0x174)]['parse'](_0xeade8a,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x5928c2(0x188));}}function a277_0x8186(_0x1f6043,_0x1e1340){const _0x387b6e=a277_0x44bc();return a277_0x8186=function(_0xecad08,_0x4b5b85){_0xecad08=_0xecad08-0x168;let _0x44bce4=_0x387b6e[_0xecad08];return _0x44bce4;},a277_0x8186(_0x1f6043,_0x1e1340);}exports[a277_0x56ec93(0x174)]=RetrieveMetadataService,RetrieveMetadataService[a277_0x56ec93(0x19c)]=path_1[a277_0x56ec93(0x174)][a277_0x56ec93(0x185)](path_2[a277_0x56ec93(0x16b)],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);