const a277_0x131bc1=a277_0x4aa6;(function(_0x4ad017,_0x2cbb51){const _0x1b5613=a277_0x4aa6,_0x494c43=_0x4ad017();while(!![]){try{const _0x1c6e4d=-parseInt(_0x1b5613(0x206))/0x1+parseInt(_0x1b5613(0x21c))/0x2+parseInt(_0x1b5613(0x20d))/0x3+-parseInt(_0x1b5613(0x1f4))/0x4+parseInt(_0x1b5613(0x21b))/0x5+parseInt(_0x1b5613(0x229))/0x6*(parseInt(_0x1b5613(0x21d))/0x7)+-parseInt(_0x1b5613(0x22d))/0x8;if(_0x1c6e4d===_0x2cbb51)break;else _0x494c43['push'](_0x494c43['shift']());}catch(_0xffd14e){_0x494c43['push'](_0x494c43['shift']());}}}(a277_0xfd7d,0x5b9f7));const a277_0x5d62b8=(function(){let _0x4309ab=!![];return function(_0x50c5c4,_0x4bf140){const _0x2da1f9=_0x4309ab?function(){const _0x156bae=a277_0x4aa6;if(_0x4bf140){const _0x17d863=_0x4bf140[_0x156bae(0x1f9)](_0x50c5c4,arguments);return _0x4bf140=null,_0x17d863;}}:function(){};return _0x4309ab=![],_0x2da1f9;};}()),a277_0x1e2443=a277_0x5d62b8(this,function(){const _0x2a9634=a277_0x4aa6;return a277_0x1e2443[_0x2a9634(0x221)]()['search']('(((.+)+)+)+$')[_0x2a9634(0x221)]()['constructor'](a277_0x1e2443)['search'](_0x2a9634(0x210));});function a277_0x4aa6(_0x5c67b4,_0x3808c1){const _0xc2ff74=a277_0xfd7d();return a277_0x4aa6=function(_0x1e2443,_0x5d62b8){_0x1e2443=_0x1e2443-0x1f4;let _0xfd7df0=_0xc2ff74[_0x1e2443];return _0xfd7df0;},a277_0x4aa6(_0x5c67b4,_0x3808c1);}function a277_0xfd7d(){const _0x4c4f5a=['generateJobId','JobStatus','getJobStatus','default','256645GWOdws','1417084HWqqDc','262997qhMQFk','NotFoundError','getJobState','fs/promises','toString','Chunk\x20not\x20found.','sortJobsIds','getJobsIds','join','IN_PROGRESS','dataPath','setError','12miwmJJ','utf-8','runJob','../../shared/utils/job.utils','76824SAbCim','__importDefault','push','2139732gSllKN','JOB_PATH','RETRIEVE_RESULT_FOLDER_NAME','Result\x20not\x20found.','../../../configs/path','apply','Job\x20not\x20completed.','data','then','../constants','.json','Job\x20log\x20not\x20found.','JOB_LOG_DETAILS_FILENAME','RETRIEVE_METADATA_FOLDER_NAME','../../shared/utils/csv.utils','../../../constants/job','../../shared/managers/state-manger','__esModule','202019TRcpOe','readFile','retrieveMetadataFolder','catch','../../shared/enums/logger.enums','path','../../../core/errors/not-found.error','860487VkPNLg','../../../core/errors/bad-request.error','isExistsPath','(((.+)+)+)+$','RETRIEVE_RESULTS_IDS_FILENAME','create','FsUtils','slice','parse','BadRequestError'];a277_0xfd7d=function(){return _0x4c4f5a;};return a277_0xfd7d();}a277_0x1e2443();'use strict';var __importDefault=this&&this[a277_0x131bc1(0x22e)]||function(_0x3305b0){return _0x3305b0&&_0x3305b0['__esModule']?_0x3305b0:{'default':_0x3305b0};};Object['defineProperty'](exports,a277_0x131bc1(0x205),{'value':!![]});const job_utils_1=__importDefault(require(a277_0x131bc1(0x22c))),path_1=__importDefault(require(a277_0x131bc1(0x20b))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a277_0x131bc1(0x204))),promises_1=require(a277_0x131bc1(0x220)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a277_0x131bc1(0x202))),not_found_error_1=require(a277_0x131bc1(0x20c)),logger_enums_1=require(a277_0x131bc1(0x20a)),bad_request_error_1=require(a277_0x131bc1(0x20e)),job_1=require(a277_0x131bc1(0x203)),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a277_0x131bc1(0x1fd)),path_2=require(a277_0x131bc1(0x1f8));class RetrieveMetadataService{static async['getJobs'](_0x2fd158,_0x14d2a8){const _0x3a3661=a277_0x131bc1,_0x5294e6=await job_utils_1[_0x3a3661(0x21a)][_0x3a3661(0x224)](RetrieveMetadataService[_0x3a3661(0x208)]),_0x586dae=await job_utils_1[_0x3a3661(0x21a)][_0x3a3661(0x223)](RetrieveMetadataService[_0x3a3661(0x208)],_0x5294e6),_0xf25469=_0x586dae[_0x3a3661(0x214)](_0x14d2a8,_0x14d2a8+_0x2fd158),_0x5003e3=[];for(const _0x24efc4 of _0xf25469){const _0x2300dc=await state_manger_1['default']['getJobState'](path_1[_0x3a3661(0x21a)][_0x3a3661(0x225)](RetrieveMetadataService[_0x3a3661(0x208)],_0x24efc4));_0x5003e3[_0x3a3661(0x22f)](_0x2300dc);}return _0x5003e3;}static async['createRetrieveJob'](_0x34737d){const _0x5016bb=a277_0x131bc1,_0x3a5fa1=job_utils_1[_0x5016bb(0x21a)][_0x5016bb(0x217)](),_0x4ea0e7=path_1[_0x5016bb(0x21a)][_0x5016bb(0x225)](RetrieveMetadataService[_0x5016bb(0x208)],_0x3a5fa1);await(0x0,fs_utils_1['makeDir'])(_0x4ea0e7),await manifest_manger_1['default'][_0x5016bb(0x212)](_0x4ea0e7,_0x34737d),await state_manger_1[_0x5016bb(0x21a)][_0x5016bb(0x212)](_0x4ea0e7,_0x3a5fa1);const _0x5eb1a7=path_1[_0x5016bb(0x21a)]['join'](__dirname,job_1[_0x5016bb(0x1f5)]);return job_utils_1[_0x5016bb(0x21a)][_0x5016bb(0x22b)](_0x5eb1a7,{'jobStorePath':_0x4ea0e7,'jobId':_0x3a5fa1})[_0x5016bb(0x209)](async _0x3ed15b=>{const _0x2b6cd4=_0x5016bb,_0x315360=new state_manger_1[(_0x2b6cd4(0x21a))](_0x4ea0e7);await _0x315360['init'](),await _0x315360[_0x2b6cd4(0x228)](_0x3ed15b);}),{'jobId':_0x3a5fa1};}static async['getResult'](_0x16ca40){const _0x4de37a=a277_0x131bc1,{status:_0x3a0656}=await RetrieveMetadataService[_0x4de37a(0x219)](_0x16ca40);if(_0x3a0656===logger_enums_1[_0x4de37a(0x218)][_0x4de37a(0x226)])throw new bad_request_error_1[(_0x4de37a(0x216))](_0x4de37a(0x1fa));const _0x28e1fa=path_1[_0x4de37a(0x21a)][_0x4de37a(0x225)](RetrieveMetadataService[_0x4de37a(0x208)],_0x16ca40,constants_1[_0x4de37a(0x211)]);if(await utils_1[_0x4de37a(0x213)]['isExistsPath'](_0x28e1fa))return(0x0,promises_1[_0x4de37a(0x207)])(_0x28e1fa,'utf-8')[_0x4de37a(0x1fc)](JSON[_0x4de37a(0x215)]);else throw new not_found_error_1['NotFoundError'](_0x4de37a(0x1f7));}static async['getResultChunk'](_0x22d1e8,_0xf2c498){const _0x59b5e1=a277_0x131bc1,{status:_0x125523}=await RetrieveMetadataService[_0x59b5e1(0x219)](_0x22d1e8);if(_0x125523===logger_enums_1[_0x59b5e1(0x218)][_0x59b5e1(0x226)])throw new bad_request_error_1[(_0x59b5e1(0x216))](_0x59b5e1(0x1fa));const _0x55a93a=path_1[_0x59b5e1(0x21a)][_0x59b5e1(0x225)](RetrieveMetadataService['retrieveMetadataFolder'],_0x22d1e8,constants_1[_0x59b5e1(0x1f6)]),_0x5455db={'data':[]};if(await utils_1[_0x59b5e1(0x213)][_0x59b5e1(0x20f)](path_1[_0x59b5e1(0x21a)][_0x59b5e1(0x225)](_0x55a93a,_0xf2c498+'.json')))_0x5455db[_0x59b5e1(0x1fb)]=await(0x0,promises_1[_0x59b5e1(0x207)])(path_1['default']['join'](_0x55a93a,_0xf2c498+_0x59b5e1(0x1fe)),_0x59b5e1(0x22a))[_0x59b5e1(0x1fc)](JSON['parse']);else throw new not_found_error_1[(_0x59b5e1(0x21e))](_0x59b5e1(0x222));return _0x5455db;}static async[a277_0x131bc1(0x219)](_0x3a05cf){const _0xa982ba=a277_0x131bc1;try{return await state_manger_1[_0xa982ba(0x21a)][_0xa982ba(0x21f)](path_1[_0xa982ba(0x21a)][_0xa982ba(0x225)](RetrieveMetadataService[_0xa982ba(0x208)],_0x3a05cf));}catch(_0x27beeb){throw new not_found_error_1[(_0xa982ba(0x21e))](_0x27beeb);}}static async['getJobLogs'](_0x173000){const _0x1245c3=a277_0x131bc1,_0x3cae7a=path_1['default'][_0x1245c3(0x225)](RetrieveMetadataService[_0x1245c3(0x208)],_0x173000,job_1[_0x1245c3(0x200)]);if(await utils_1[_0x1245c3(0x213)][_0x1245c3(0x20f)](_0x3cae7a))return(0x0,promises_1['readFile'])(_0x3cae7a,_0x1245c3(0x22a))['then'](_0x37350b=>csv_utils_1['default'][_0x1245c3(0x215)](_0x37350b,{'columns':!![]}));throw new not_found_error_1[(_0x1245c3(0x21e))](_0x1245c3(0x1ff));}}exports[a277_0x131bc1(0x21a)]=RetrieveMetadataService,RetrieveMetadataService[a277_0x131bc1(0x208)]=path_1[a277_0x131bc1(0x21a)][a277_0x131bc1(0x225)](path_2[a277_0x131bc1(0x227)],constants_1[a277_0x131bc1(0x201)]);