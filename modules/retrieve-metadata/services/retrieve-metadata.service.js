const a274_0x4479d2=a274_0x10ab;function a274_0x34e8(){const _0x2ef3eb=['getJobsIds','setError','2wHixcI','isExistsPath','../../../configs/path','RETRIEVE_METADATA_FOLDER_NAME','FsUtils','getJobStatus','__esModule','90yIsELt','defineProperty','join','then','RETRIEVE_RESULT_FOLDER_NAME','default','2408650sdzVBS','1716AVcBsB','NotFoundError','__importDefault','parse','../../../core/errors/not-found.error','Job\x20log\x20not\x20found.','getJobs','../../shared/utils/job.utils','sortJobsIds','getResultChunk','(((.+)+)+)+$','../../../core/errors/bad-request.error','63GeyduZ','readFile','1892076SKLRHi','../constants','fs/promises','createRetrieveJob','57320lLFYsE','push','apply','data','getResult','getJobState','toString','init','IN_PROGRESS','slice','../../shared/utils/fs.utils','runJob','Job\x20not\x20completed.','makeDir','../../../constants/job','utf-8','BadRequestError','getJobLogs','1993008wqGSVJ','Chunk\x20not\x20found.','../job/classes/manifest-manger','constructor','search','RETRIEVE_RESULTS_IDS_FILENAME','../job/classes/state-manger','56867052jlOIUU','@flosum/utils','create','973UmgRuV','.json','JOB_LOG_DETAILS_FILENAME','path','1250174vDpWax','catch','retrieveMetadataFolder'];a274_0x34e8=function(){return _0x2ef3eb;};return a274_0x34e8();}function a274_0x10ab(_0x3f4d2d,_0x158520){const _0x134ecb=a274_0x34e8();return a274_0x10ab=function(_0x23b89c,_0x34d4a1){_0x23b89c=_0x23b89c-0x7a;let _0x34e81a=_0x134ecb[_0x23b89c];return _0x34e81a;},a274_0x10ab(_0x3f4d2d,_0x158520);}(function(_0x1a7261,_0x2e9e1c){const _0x99ae3c=a274_0x10ab,_0x30d7f3=_0x1a7261();while(!![]){try{const _0x2e7fb7=-parseInt(_0x99ae3c(0x94))/0x1+parseInt(_0x99ae3c(0x99))/0x2*(-parseInt(_0x99ae3c(0xb5))/0x3)+-parseInt(_0x99ae3c(0xa7))/0x4*(parseInt(_0x99ae3c(0xa0))/0x5)+parseInt(_0x99ae3c(0x86))/0x6+-parseInt(_0x99ae3c(0x90))/0x7*(parseInt(_0x99ae3c(0xb9))/0x8)+-parseInt(_0x99ae3c(0xb3))/0x9*(parseInt(_0x99ae3c(0xa6))/0xa)+parseInt(_0x99ae3c(0x8d))/0xb;if(_0x2e7fb7===_0x2e9e1c)break;else _0x30d7f3['push'](_0x30d7f3['shift']());}catch(_0x360a5c){_0x30d7f3['push'](_0x30d7f3['shift']());}}}(a274_0x34e8,0xe35fa));const a274_0x34d4a1=(function(){let _0x2f6b1b=!![];return function(_0x92ddb6,_0x122ec6){const _0x1b4137=_0x2f6b1b?function(){const _0x5756dc=a274_0x10ab;if(_0x122ec6){const _0x13c839=_0x122ec6[_0x5756dc(0xbb)](_0x92ddb6,arguments);return _0x122ec6=null,_0x13c839;}}:function(){};return _0x2f6b1b=![],_0x1b4137;};}()),a274_0x23b89c=a274_0x34d4a1(this,function(){const _0x14ad73=a274_0x10ab;return a274_0x23b89c['toString']()['search']('(((.+)+)+)+$')[_0x14ad73(0x7a)]()[_0x14ad73(0x89)](a274_0x23b89c)[_0x14ad73(0x8a)](_0x14ad73(0xb1));});a274_0x23b89c();'use strict';var __importDefault=this&&this[a274_0x4479d2(0xa9)]||function(_0x5c7b48){return _0x5c7b48&&_0x5c7b48['__esModule']?_0x5c7b48:{'default':_0x5c7b48};};Object[a274_0x4479d2(0xa1)](exports,a274_0x4479d2(0x9f),{'value':!![]});const job_utils_1=__importDefault(require(a274_0x4479d2(0xae))),path_1=__importDefault(require(a274_0x4479d2(0x93))),manifest_manger_1=__importDefault(require(a274_0x4479d2(0x88))),state_manger_1=__importDefault(require(a274_0x4479d2(0x8c))),promises_1=require(a274_0x4479d2(0xb7)),utils_1=require(a274_0x4479d2(0x8e)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a274_0x4479d2(0xab)),logger_enums_1=require('../job/enums/logger.enums'),bad_request_error_1=require(a274_0x4479d2(0xb2)),job_1=require(a274_0x4479d2(0x82)),fs_utils_1=require(a274_0x4479d2(0x7e)),constants_1=require(a274_0x4479d2(0xb6)),path_2=require(a274_0x4479d2(0x9b));class RetrieveMetadataService{static async[a274_0x4479d2(0xad)](_0x1ae8b5,_0x33e9ae){const _0x3d6f7b=a274_0x4479d2,_0x3a78c5=await job_utils_1['default'][_0x3d6f7b(0x97)](RetrieveMetadataService[_0x3d6f7b(0x96)]),_0x19969e=await job_utils_1[_0x3d6f7b(0xa5)][_0x3d6f7b(0xaf)](RetrieveMetadataService['retrieveMetadataFolder'],_0x3a78c5),_0x25328d=_0x19969e[_0x3d6f7b(0x7d)](_0x33e9ae,_0x33e9ae+_0x1ae8b5),_0x2c2d9d=[];for(const _0x4e8fb6 of _0x25328d){const _0x4efbf1=await state_manger_1[_0x3d6f7b(0xa5)][_0x3d6f7b(0xbe)](path_1[_0x3d6f7b(0xa5)]['join'](RetrieveMetadataService[_0x3d6f7b(0x96)],_0x4e8fb6));_0x2c2d9d[_0x3d6f7b(0xba)](_0x4efbf1);}return _0x2c2d9d;}static async[a274_0x4479d2(0xb8)](_0x34d117){const _0x42120d=a274_0x4479d2,_0x51fe4b=job_utils_1[_0x42120d(0xa5)]['generateJobId'](),_0x12cc67=path_1['default'][_0x42120d(0xa2)](RetrieveMetadataService['retrieveMetadataFolder'],_0x51fe4b);await(0x0,fs_utils_1[_0x42120d(0x81)])(_0x12cc67),await manifest_manger_1[_0x42120d(0xa5)][_0x42120d(0x8f)](_0x12cc67,_0x34d117),await state_manger_1[_0x42120d(0xa5)]['create'](_0x12cc67,_0x51fe4b);const _0x73ab89=path_1[_0x42120d(0xa5)][_0x42120d(0xa2)](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x42120d(0xa5)][_0x42120d(0x7f)](_0x73ab89,{'jobStorePath':_0x12cc67,'jobId':_0x51fe4b})[_0x42120d(0x95)](async _0x5b6717=>{const _0x1d197a=_0x42120d,_0xff5ee8=new state_manger_1[(_0x1d197a(0xa5))](_0x12cc67);await _0xff5ee8[_0x1d197a(0x7b)](),await _0xff5ee8[_0x1d197a(0x98)](_0x5b6717);}),{'jobId':_0x51fe4b};}static async[a274_0x4479d2(0xbd)](_0x258731){const _0x4b9d7a=a274_0x4479d2,{status:_0x42c6a8}=await RetrieveMetadataService[_0x4b9d7a(0x9e)](_0x258731);if(_0x42c6a8===logger_enums_1['JobStatus'][_0x4b9d7a(0x7c)])throw new bad_request_error_1['BadRequestError'](_0x4b9d7a(0x80));const _0x2e598c=path_1[_0x4b9d7a(0xa5)]['join'](RetrieveMetadataService[_0x4b9d7a(0x96)],_0x258731,constants_1[_0x4b9d7a(0x8b)]);if(await utils_1[_0x4b9d7a(0x9d)][_0x4b9d7a(0x9a)](_0x2e598c))return(0x0,promises_1[_0x4b9d7a(0xb4)])(_0x2e598c,'utf-8')[_0x4b9d7a(0xa3)](JSON[_0x4b9d7a(0xaa)]);else throw new not_found_error_1[(_0x4b9d7a(0xa8))]('Result\x20not\x20found.');}static async[a274_0x4479d2(0xb0)](_0x48ffbb,_0x1f0254){const _0x5568fd=a274_0x4479d2,{status:_0xc87802}=await RetrieveMetadataService['getJobStatus'](_0x48ffbb);if(_0xc87802===logger_enums_1['JobStatus']['IN_PROGRESS'])throw new bad_request_error_1[(_0x5568fd(0x84))](_0x5568fd(0x80));const _0x179827=path_1['default']['join'](RetrieveMetadataService[_0x5568fd(0x96)],_0x48ffbb,constants_1[_0x5568fd(0xa4)]),_0x25fc0a={'data':[]};if(await utils_1[_0x5568fd(0x9d)][_0x5568fd(0x9a)](path_1['default'][_0x5568fd(0xa2)](_0x179827,_0x1f0254+_0x5568fd(0x91))))_0x25fc0a[_0x5568fd(0xbc)]=await(0x0,promises_1['readFile'])(path_1[_0x5568fd(0xa5)][_0x5568fd(0xa2)](_0x179827,_0x1f0254+_0x5568fd(0x91)),_0x5568fd(0x83))[_0x5568fd(0xa3)](JSON[_0x5568fd(0xaa)]);else throw new not_found_error_1['NotFoundError'](_0x5568fd(0x87));return _0x25fc0a;}static async[a274_0x4479d2(0x9e)](_0x3657c5){const _0x92612=a274_0x4479d2;try{return await state_manger_1['default'][_0x92612(0xbe)](path_1[_0x92612(0xa5)][_0x92612(0xa2)](RetrieveMetadataService[_0x92612(0x96)],_0x3657c5));}catch(_0x2b6091){throw new not_found_error_1[(_0x92612(0xa8))](_0x2b6091);}}static async[a274_0x4479d2(0x85)](_0x1a54c7){const _0x55e501=a274_0x4479d2,_0xa98594=path_1[_0x55e501(0xa5)][_0x55e501(0xa2)](RetrieveMetadataService[_0x55e501(0x96)],_0x1a54c7,job_1[_0x55e501(0x92)]);if(await utils_1[_0x55e501(0x9d)][_0x55e501(0x9a)](_0xa98594))return(0x0,promises_1[_0x55e501(0xb4)])(_0xa98594,_0x55e501(0x83))[_0x55e501(0xa3)](_0x477e61=>csv_utils_1[_0x55e501(0xa5)][_0x55e501(0xaa)](_0x477e61,{'columns':!![]}));throw new not_found_error_1[(_0x55e501(0xa8))](_0x55e501(0xac));}}exports[a274_0x4479d2(0xa5)]=RetrieveMetadataService,RetrieveMetadataService[a274_0x4479d2(0x96)]=path_1[a274_0x4479d2(0xa5)][a274_0x4479d2(0xa2)](path_2['dataPath'],constants_1[a274_0x4479d2(0x9c)]);