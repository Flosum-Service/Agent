const a277_0x27abc0=a277_0xc955;(function(_0xe6372b,_0x1905b7){const _0x1d2d01=a277_0xc955,_0x239f1d=_0xe6372b();while(!![]){try{const _0x9e25e2=-parseInt(_0x1d2d01(0x134))/0x1*(-parseInt(_0x1d2d01(0x132))/0x2)+-parseInt(_0x1d2d01(0x13a))/0x3*(-parseInt(_0x1d2d01(0x159))/0x4)+parseInt(_0x1d2d01(0x165))/0x5*(parseInt(_0x1d2d01(0x13d))/0x6)+-parseInt(_0x1d2d01(0x12f))/0x7*(parseInt(_0x1d2d01(0x157))/0x8)+parseInt(_0x1d2d01(0x133))/0x9+parseInt(_0x1d2d01(0x163))/0xa+-parseInt(_0x1d2d01(0x153))/0xb*(parseInt(_0x1d2d01(0x15e))/0xc);if(_0x9e25e2===_0x1905b7)break;else _0x239f1d['push'](_0x239f1d['shift']());}catch(_0x1409af){_0x239f1d['push'](_0x239f1d['shift']());}}}(a277_0x15b4,0x90003));const a277_0x48f99a=(function(){let _0x27eff1=!![];return function(_0x130c0e,_0x28f204){const _0x5c43fa=_0x27eff1?function(){const _0x377057=a277_0xc955;if(_0x28f204){const _0x2353d8=_0x28f204[_0x377057(0x12a)](_0x130c0e,arguments);return _0x28f204=null,_0x2353d8;}}:function(){};return _0x27eff1=![],_0x5c43fa;};}()),a277_0x5b7794=a277_0x48f99a(this,function(){const _0x5a380e=a277_0xc955;return a277_0x5b7794[_0x5a380e(0x150)]()[_0x5a380e(0x14f)](_0x5a380e(0x14e))[_0x5a380e(0x150)]()[_0x5a380e(0x125)](a277_0x5b7794)[_0x5a380e(0x14f)](_0x5a380e(0x14e));});a277_0x5b7794();'use strict';var __importDefault=this&&this[a277_0x27abc0(0x147)]||function(_0x5bffe0){const _0x4a8716=a277_0x27abc0;return _0x5bffe0&&_0x5bffe0[_0x4a8716(0x12c)]?_0x5bffe0:{'default':_0x5bffe0};};Object['defineProperty'](exports,a277_0x27abc0(0x12c),{'value':!![]});const job_utils_1=__importDefault(require(a277_0x27abc0(0x13f))),path_1=__importDefault(require(a277_0x27abc0(0x137))),manifest_manger_1=__importDefault(require(a277_0x27abc0(0x160))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require(a277_0x27abc0(0x144)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a277_0x27abc0(0x162))),not_found_error_1=require(a277_0x27abc0(0x154)),logger_enums_1=require(a277_0x27abc0(0x152)),bad_request_error_1=require(a277_0x27abc0(0x14c)),job_1=require(a277_0x27abc0(0x145)),fs_utils_1=require(a277_0x27abc0(0x164)),constants_1=require(a277_0x27abc0(0x143)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a277_0x27abc0(0x15b)](_0x258275,_0x30dfb9){const _0x2eec3a=a277_0x27abc0,_0x4ecb43=await job_utils_1['default'][_0x2eec3a(0x126)](RetrieveMetadataService[_0x2eec3a(0x131)]),_0x572e23=await job_utils_1[_0x2eec3a(0x12e)][_0x2eec3a(0x158)](RetrieveMetadataService[_0x2eec3a(0x131)],_0x4ecb43),_0x4062e5=_0x572e23['slice'](_0x30dfb9,_0x30dfb9+_0x258275),_0x525f6a=[];for(const _0x2c66e3 of _0x4062e5){const _0x1d33d0=await state_manger_1['default'][_0x2eec3a(0x135)](path_1[_0x2eec3a(0x12e)][_0x2eec3a(0x141)](RetrieveMetadataService[_0x2eec3a(0x131)],_0x2c66e3));_0x525f6a['push'](_0x1d33d0);}return _0x525f6a;}static async['createRetrieveJob'](_0x998743){const _0x576b03=a277_0x27abc0,_0x4aba4f=job_utils_1[_0x576b03(0x12e)]['generateJobId'](),_0x1b2c7d=path_1['default']['join'](RetrieveMetadataService[_0x576b03(0x131)],_0x4aba4f);await(0x0,fs_utils_1['makeDir'])(_0x1b2c7d),await manifest_manger_1[_0x576b03(0x12e)][_0x576b03(0x138)](_0x1b2c7d,_0x998743),await state_manger_1[_0x576b03(0x12e)][_0x576b03(0x138)](_0x1b2c7d,_0x4aba4f);const _0x47c039=path_1[_0x576b03(0x12e)][_0x576b03(0x141)](__dirname,job_1[_0x576b03(0x136)]);return job_utils_1['default'][_0x576b03(0x139)](_0x47c039,{'jobStorePath':_0x1b2c7d,'jobId':_0x4aba4f})[_0x576b03(0x142)](async _0x779c0e=>{const _0x2bc5fb=_0x576b03,_0x1b5a40=new state_manger_1[(_0x2bc5fb(0x12e))](_0x1b2c7d);await _0x1b5a40[_0x2bc5fb(0x12b)](),await _0x1b5a40['setError'](_0x779c0e);}),{'jobId':_0x4aba4f};}static async[a277_0x27abc0(0x155)](_0x22d348){const _0x2e2b97=a277_0x27abc0,{status:_0x582550}=await RetrieveMetadataService['getJobStatus'](_0x22d348);if(_0x582550===logger_enums_1['JobStatus']['IN_PROGRESS'])throw new bad_request_error_1[(_0x2e2b97(0x15c))](_0x2e2b97(0x15a));const _0x125241=path_1[_0x2e2b97(0x12e)][_0x2e2b97(0x141)](RetrieveMetadataService[_0x2e2b97(0x131)],_0x22d348,constants_1[_0x2e2b97(0x14a)]);if(await utils_1[_0x2e2b97(0x129)][_0x2e2b97(0x13b)](_0x125241))return(0x0,promises_1[_0x2e2b97(0x15d)])(_0x125241,'utf-8')[_0x2e2b97(0x128)](JSON['parse']);else throw new not_found_error_1[(_0x2e2b97(0x151))](_0x2e2b97(0x15f));}static async[a277_0x27abc0(0x127)](_0xbdaa2a,_0x501f08){const _0xf6c880=a277_0x27abc0,{status:_0x24c1e8}=await RetrieveMetadataService[_0xf6c880(0x12d)](_0xbdaa2a);if(_0x24c1e8===logger_enums_1[_0xf6c880(0x13e)][_0xf6c880(0x130)])throw new bad_request_error_1[(_0xf6c880(0x15c))](_0xf6c880(0x15a));const _0x6b0a=path_1['default'][_0xf6c880(0x141)](RetrieveMetadataService['retrieveMetadataFolder'],_0xbdaa2a,constants_1[_0xf6c880(0x156)]),_0x26ff79={'data':[]};if(await utils_1['FsUtils']['isExistsPath'](path_1[_0xf6c880(0x12e)][_0xf6c880(0x141)](_0x6b0a,_0x501f08+_0xf6c880(0x148))))_0x26ff79[_0xf6c880(0x13c)]=await(0x0,promises_1[_0xf6c880(0x15d)])(path_1['default'][_0xf6c880(0x141)](_0x6b0a,_0x501f08+_0xf6c880(0x148)),'utf-8')[_0xf6c880(0x128)](JSON[_0xf6c880(0x161)]);else throw new not_found_error_1[(_0xf6c880(0x151))]('Chunk\x20not\x20found.');return _0x26ff79;}static async[a277_0x27abc0(0x12d)](_0x36eb30){const _0x59602a=a277_0x27abc0;try{return await state_manger_1[_0x59602a(0x12e)][_0x59602a(0x135)](path_1[_0x59602a(0x12e)][_0x59602a(0x141)](RetrieveMetadataService[_0x59602a(0x131)],_0x36eb30));}catch(_0x110024){throw new not_found_error_1[(_0x59602a(0x151))](_0x110024);}}static async[a277_0x27abc0(0x140)](_0xff6c99){const _0xe92102=a277_0x27abc0,_0x2d7d6f=path_1['default'][_0xe92102(0x141)](RetrieveMetadataService[_0xe92102(0x131)],_0xff6c99,job_1[_0xe92102(0x14b)]);if(await utils_1[_0xe92102(0x129)][_0xe92102(0x13b)](_0x2d7d6f))return(0x0,promises_1['readFile'])(_0x2d7d6f,_0xe92102(0x14d))[_0xe92102(0x128)](_0x2ce6ed=>csv_utils_1['default'][_0xe92102(0x161)](_0x2ce6ed,{'columns':!![]}));throw new not_found_error_1[(_0xe92102(0x151))](_0xe92102(0x146));}}exports[a277_0x27abc0(0x12e)]=RetrieveMetadataService,RetrieveMetadataService[a277_0x27abc0(0x131)]=path_1[a277_0x27abc0(0x12e)][a277_0x27abc0(0x141)](path_2[a277_0x27abc0(0x149)],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);function a277_0xc955(_0x2cac9d,_0x4b04e6){const _0x224b09=a277_0x15b4();return a277_0xc955=function(_0x5b7794,_0x48f99a){_0x5b7794=_0x5b7794-0x125;let _0x15b401=_0x224b09[_0x5b7794];return _0x15b401;},a277_0xc955(_0x2cac9d,_0x4b04e6);}function a277_0x15b4(){const _0x4da6df=['__esModule','getJobStatus','default','7cECDsM','IN_PROGRESS','retrieveMetadataFolder','396218NOwxhd','10381176VhDDim','1xKoUiW','getJobState','JOB_PATH','path','create','runJob','2359281ZoEQgk','isExistsPath','data','6spDjFg','JobStatus','../../shared/utils/job.utils','getJobLogs','join','catch','../constants','fs/promises','../../../constants/job','Job\x20log\x20not\x20found.','__importDefault','.json','dataPath','RETRIEVE_RESULTS_IDS_FILENAME','JOB_LOG_DETAILS_FILENAME','../../../core/errors/bad-request.error','utf-8','(((.+)+)+)+$','search','toString','NotFoundError','../../shared/enums/logger.enums','1017016NDTgVh','../../../core/errors/not-found.error','getResult','RETRIEVE_RESULT_FOLDER_NAME','7353192xDXWOD','sortJobsIds','4fgtWwg','Job\x20not\x20completed.','getJobs','BadRequestError','readFile','132tAmQbv','Result\x20not\x20found.','../job/classes/manifest-manger','parse','../../shared/utils/csv.utils','2320870brVHaY','../../shared/utils/fs.utils','779525WTJsao','constructor','getJobsIds','getResultChunk','then','FsUtils','apply','init'];a277_0x15b4=function(){return _0x4da6df;};return a277_0x15b4();}