const a292_0x35c157=a292_0x1541;(function(_0x283134,_0x2dfd82){const _0x2475de=a292_0x1541,_0x2b6af9=_0x283134();while(!![]){try{const _0xe02c95=-parseInt(_0x2475de(0x191))/0x1+-parseInt(_0x2475de(0x16b))/0x2*(-parseInt(_0x2475de(0x174))/0x3)+parseInt(_0x2475de(0x177))/0x4*(parseInt(_0x2475de(0x199))/0x5)+-parseInt(_0x2475de(0x180))/0x6+-parseInt(_0x2475de(0x161))/0x7*(-parseInt(_0x2475de(0x159))/0x8)+-parseInt(_0x2475de(0x198))/0x9*(-parseInt(_0x2475de(0x195))/0xa)+-parseInt(_0x2475de(0x171))/0xb*(parseInt(_0x2475de(0x190))/0xc);if(_0xe02c95===_0x2dfd82)break;else _0x2b6af9['push'](_0x2b6af9['shift']());}catch(_0x2cb8cb){_0x2b6af9['push'](_0x2b6af9['shift']());}}}(a292_0x28bf,0xa7817));const a292_0x2b2aed=(function(){let _0x517c80=!![];return function(_0x169c8e,_0x50593f){const _0x10958d=_0x517c80?function(){if(_0x50593f){const _0x14aa87=_0x50593f['apply'](_0x169c8e,arguments);return _0x50593f=null,_0x14aa87;}}:function(){};return _0x517c80=![],_0x10958d;};}()),a292_0x240c2b=a292_0x2b2aed(this,function(){const _0x35b371=a292_0x1541;return a292_0x240c2b['toString']()[_0x35b371(0x187)](_0x35b371(0x169))['toString']()[_0x35b371(0x15f)](a292_0x240c2b)[_0x35b371(0x187)]('(((.+)+)+)+$');});function a292_0x28bf(){const _0x3a291d=['create','FsUtils','1813314trvhHV','RETRIEVE_RESULT_FOLDER_NAME','dataPath','.json','runJob','then','Chunk\x20not\x20found.','search','readFile','RETRIEVE_METADATA_FOLDER_NAME','catch','init','NotFoundError','../../shared/managers/state-manger','getJobStatus','../../shared/enums/logger.enums','13020ISMQtD','471140zzBvIb','IN_PROGRESS','JOB_PATH','getJobState','10LaxbZG','getJobLogs','../constants','4332105brjZaf','173235RyXIYY','utf-8','Job\x20log\x20not\x20found.','../../../constants/job','359064KDzwgp','getResultChunk','@flosum/utils','JOB_LOG_DETAILS_FILENAME','default','../../shared/utils/fs.utils','constructor','isExistsPath','210RTitWC','JobStatus','../../../core/errors/not-found.error','retrieveMetadataFolder','slice','path','__esModule','defineProperty','(((.+)+)+)+$','createRetrieveJob','129602YPGhEF','../../shared/utils/csv.utils','getJobsIds','getJobs','RETRIEVE_RESULTS_IDS_FILENAME','BadRequestError','22891WFbdzc','fs/promises','../job/classes/manifest-manger','57QdDAUz','Result\x20not\x20found.','data','76rssUrQ','../../shared/utils/job.utils','join','parse','getResult','__importDefault','../../../core/errors/bad-request.error'];a292_0x28bf=function(){return _0x3a291d;};return a292_0x28bf();}a292_0x240c2b();function a292_0x1541(_0x21f3b7,_0xc8bc64){const _0xedcf90=a292_0x28bf();return a292_0x1541=function(_0x240c2b,_0x2b2aed){_0x240c2b=_0x240c2b-0x157;let _0x28bfba=_0xedcf90[_0x240c2b];return _0x28bfba;},a292_0x1541(_0x21f3b7,_0xc8bc64);}'use strict';var __importDefault=this&&this[a292_0x35c157(0x17c)]||function(_0x26957a){const _0x1f3cdb=a292_0x35c157;return _0x26957a&&_0x26957a[_0x1f3cdb(0x167)]?_0x26957a:{'default':_0x26957a};};Object[a292_0x35c157(0x168)](exports,a292_0x35c157(0x167),{'value':!![]});const job_utils_1=__importDefault(require(a292_0x35c157(0x178))),path_1=__importDefault(require(a292_0x35c157(0x166))),manifest_manger_1=__importDefault(require(a292_0x35c157(0x173))),state_manger_1=__importDefault(require(a292_0x35c157(0x18d))),promises_1=require(a292_0x35c157(0x172)),utils_1=require(a292_0x35c157(0x15b)),csv_utils_1=__importDefault(require(a292_0x35c157(0x16c))),not_found_error_1=require(a292_0x35c157(0x163)),logger_enums_1=require(a292_0x35c157(0x18f)),bad_request_error_1=require(a292_0x35c157(0x17d)),job_1=require(a292_0x35c157(0x158)),fs_utils_1=require(a292_0x35c157(0x15e)),constants_1=require(a292_0x35c157(0x197)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a292_0x35c157(0x16e)](_0x55f3d3,_0x1dbb65){const _0x16fbd0=a292_0x35c157,_0x5bc524=await job_utils_1[_0x16fbd0(0x15d)][_0x16fbd0(0x16d)](RetrieveMetadataService[_0x16fbd0(0x164)]),_0x3e5254=await job_utils_1[_0x16fbd0(0x15d)]['sortJobsIds'](RetrieveMetadataService[_0x16fbd0(0x164)],_0x5bc524),_0xb0abfb=_0x3e5254[_0x16fbd0(0x165)](_0x1dbb65,_0x1dbb65+_0x55f3d3),_0x5dc389=[];for(const _0x506647 of _0xb0abfb){const _0x51c6b5=await state_manger_1[_0x16fbd0(0x15d)][_0x16fbd0(0x194)](path_1[_0x16fbd0(0x15d)][_0x16fbd0(0x179)](RetrieveMetadataService[_0x16fbd0(0x164)],_0x506647));_0x5dc389['push'](_0x51c6b5);}return _0x5dc389;}static async[a292_0x35c157(0x16a)](_0x2f9bf8){const _0x2afdeb=a292_0x35c157,_0xd6d8ad=job_utils_1[_0x2afdeb(0x15d)]['generateJobId'](),_0x2bc4c9=path_1['default'][_0x2afdeb(0x179)](RetrieveMetadataService[_0x2afdeb(0x164)],_0xd6d8ad);await(0x0,fs_utils_1['makeDir'])(_0x2bc4c9),await manifest_manger_1[_0x2afdeb(0x15d)]['create'](_0x2bc4c9,_0x2f9bf8),await state_manger_1['default'][_0x2afdeb(0x17e)](_0x2bc4c9,_0xd6d8ad);const _0x20c5d7=path_1[_0x2afdeb(0x15d)][_0x2afdeb(0x179)](__dirname,job_1[_0x2afdeb(0x193)]);return job_utils_1[_0x2afdeb(0x15d)][_0x2afdeb(0x184)](_0x20c5d7,{'jobStorePath':_0x2bc4c9,'jobId':_0xd6d8ad})[_0x2afdeb(0x18a)](async _0x552ce6=>{const _0x27aadb=_0x2afdeb,_0x41e121=new state_manger_1['default'](_0x2bc4c9);await _0x41e121[_0x27aadb(0x18b)](),await _0x41e121['setError'](_0x552ce6);}),{'jobId':_0xd6d8ad};}static async[a292_0x35c157(0x17b)](_0x123fc3){const _0x35b173=a292_0x35c157,{status:_0x30e67c}=await RetrieveMetadataService[_0x35b173(0x18e)](_0x123fc3);if(_0x30e67c===logger_enums_1[_0x35b173(0x162)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x35b173(0x170))]('Job\x20not\x20completed.');const _0x5ddfc5=path_1[_0x35b173(0x15d)]['join'](RetrieveMetadataService[_0x35b173(0x164)],_0x123fc3,constants_1[_0x35b173(0x16f)]);if(await utils_1[_0x35b173(0x17f)][_0x35b173(0x160)](_0x5ddfc5))return(0x0,promises_1[_0x35b173(0x188)])(_0x5ddfc5,'utf-8')['then'](JSON[_0x35b173(0x17a)]);else throw new not_found_error_1[(_0x35b173(0x18c))](_0x35b173(0x175));}static async[a292_0x35c157(0x15a)](_0x23968f,_0xbc95c0){const _0x28b11a=a292_0x35c157,{status:_0x3a9571}=await RetrieveMetadataService[_0x28b11a(0x18e)](_0x23968f);if(_0x3a9571===logger_enums_1[_0x28b11a(0x162)][_0x28b11a(0x192)])throw new bad_request_error_1[(_0x28b11a(0x170))]('Job\x20not\x20completed.');const _0x448c86=path_1['default'][_0x28b11a(0x179)](RetrieveMetadataService['retrieveMetadataFolder'],_0x23968f,constants_1[_0x28b11a(0x181)]),_0xffea01={'data':[]};if(await utils_1[_0x28b11a(0x17f)][_0x28b11a(0x160)](path_1[_0x28b11a(0x15d)]['join'](_0x448c86,_0xbc95c0+_0x28b11a(0x183))))_0xffea01[_0x28b11a(0x176)]=await(0x0,promises_1['readFile'])(path_1[_0x28b11a(0x15d)]['join'](_0x448c86,_0xbc95c0+_0x28b11a(0x183)),_0x28b11a(0x19a))[_0x28b11a(0x185)](JSON[_0x28b11a(0x17a)]);else throw new not_found_error_1['NotFoundError'](_0x28b11a(0x186));return _0xffea01;}static async[a292_0x35c157(0x18e)](_0x2c579f){const _0x24fb1c=a292_0x35c157;try{return await state_manger_1[_0x24fb1c(0x15d)][_0x24fb1c(0x194)](path_1[_0x24fb1c(0x15d)][_0x24fb1c(0x179)](RetrieveMetadataService[_0x24fb1c(0x164)],_0x2c579f));}catch(_0x26b127){throw new not_found_error_1[(_0x24fb1c(0x18c))](_0x26b127);}}static async[a292_0x35c157(0x196)](_0x339725){const _0x325411=a292_0x35c157,_0x406a12=path_1[_0x325411(0x15d)][_0x325411(0x179)](RetrieveMetadataService[_0x325411(0x164)],_0x339725,job_1[_0x325411(0x15c)]);if(await utils_1[_0x325411(0x17f)][_0x325411(0x160)](_0x406a12))return(0x0,promises_1[_0x325411(0x188)])(_0x406a12,_0x325411(0x19a))[_0x325411(0x185)](_0x2c3f43=>csv_utils_1[_0x325411(0x15d)][_0x325411(0x17a)](_0x2c3f43,{'columns':!![]}));throw new not_found_error_1[(_0x325411(0x18c))](_0x325411(0x157));}}exports[a292_0x35c157(0x15d)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1['default'][a292_0x35c157(0x179)](path_2[a292_0x35c157(0x182)],constants_1[a292_0x35c157(0x189)]);