const a277_0x543623=a277_0x4c68;(function(_0x4f4796,_0x229201){const _0x597e85=a277_0x4c68,_0x48cb68=_0x4f4796();while(!![]){try{const _0x11bb49=parseInt(_0x597e85(0x1cd))/0x1+parseInt(_0x597e85(0x1ac))/0x2+parseInt(_0x597e85(0x1a7))/0x3+parseInt(_0x597e85(0x1b7))/0x4*(-parseInt(_0x597e85(0x1bb))/0x5)+-parseInt(_0x597e85(0x19e))/0x6+parseInt(_0x597e85(0x1ce))/0x7*(parseInt(_0x597e85(0x1b6))/0x8)+parseInt(_0x597e85(0x1c0))/0x9*(-parseInt(_0x597e85(0x1ae))/0xa);if(_0x11bb49===_0x229201)break;else _0x48cb68['push'](_0x48cb68['shift']());}catch(_0x5e53b0){_0x48cb68['push'](_0x48cb68['shift']());}}}(a277_0x2fec,0x2e25a));function a277_0x4c68(_0x9618dc,_0x2863eb){const _0x47dd7a=a277_0x2fec();return a277_0x4c68=function(_0x4e3b7b,_0x7216d6){_0x4e3b7b=_0x4e3b7b-0x19d;let _0x2fece5=_0x47dd7a[_0x4e3b7b];return _0x2fece5;},a277_0x4c68(_0x9618dc,_0x2863eb);}const a277_0x7216d6=(function(){let _0x5630b8=!![];return function(_0x2972c8,_0x5bcaa2){const _0x35f508=_0x5630b8?function(){const _0x1e6553=a277_0x4c68;if(_0x5bcaa2){const _0x4a38ef=_0x5bcaa2[_0x1e6553(0x1cf)](_0x2972c8,arguments);return _0x5bcaa2=null,_0x4a38ef;}}:function(){};return _0x5630b8=![],_0x35f508;};}()),a277_0x4e3b7b=a277_0x7216d6(this,function(){const _0x3589c3=a277_0x4c68;return a277_0x4e3b7b['toString']()[_0x3589c3(0x1d5)](_0x3589c3(0x1d7))['toString']()[_0x3589c3(0x1bd)](a277_0x4e3b7b)[_0x3589c3(0x1d5)](_0x3589c3(0x1d7));});a277_0x4e3b7b();'use strict';var __importDefault=this&&this[a277_0x543623(0x1a6)]||function(_0x547554){return _0x547554&&_0x547554['__esModule']?_0x547554:{'default':_0x547554};};Object['defineProperty'](exports,a277_0x543623(0x1b1),{'value':!![]});const job_utils_1=__importDefault(require(a277_0x543623(0x1d3))),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require(a277_0x543623(0x1a9))),state_manger_1=__importDefault(require(a277_0x543623(0x1d2))),promises_1=require(a277_0x543623(0x1a8)),utils_1=require(a277_0x543623(0x1c7)),csv_utils_1=__importDefault(require(a277_0x543623(0x19d))),not_found_error_1=require(a277_0x543623(0x1d0)),logger_enums_1=require(a277_0x543623(0x1ad)),bad_request_error_1=require(a277_0x543623(0x1d8)),job_1=require('../../../constants/job'),fs_utils_1=require(a277_0x543623(0x1a2)),constants_1=require(a277_0x543623(0x1c9)),path_2=require(a277_0x543623(0x1b8));function a277_0x2fec(){const _0x542970=['623540mmLUAz','data','Chunk\x20not\x20found.','__esModule','getJobLogs','BadRequestError','slice','createRetrieveJob','24KquDZu','4UaujIN','../../../configs/path','then','retrieveMetadataFolder','673400ynsHyv','parse','constructor','create','NotFoundError','45YkaEDf','setError','RETRIEVE_RESULT_FOLDER_NAME','FsUtils','Job\x20not\x20completed.','JobStatus','getJobStatus','@flosum/utils','default','../constants','readFile','utf-8','RETRIEVE_RESULTS_IDS_FILENAME','341880ZHwQON','797447jJyQlx','apply','../../../core/errors/not-found.error','getResult','../../shared/managers/state-manger','../../shared/utils/job.utils','getJobs','search','generateJobId','(((.+)+)+)+$','../../../core/errors/bad-request.error','../../shared/utils/csv.utils','2123436TUqTsp','runJob','Result\x20not\x20found.','isExistsPath','../../shared/utils/fs.utils','join','Job\x20log\x20not\x20found.','getJobState','__importDefault','565614HgmHRj','fs/promises','../job/classes/manifest-manger','.json','IN_PROGRESS','234386jngoVj','../../shared/enums/logger.enums'];a277_0x2fec=function(){return _0x542970;};return a277_0x2fec();}class RetrieveMetadataService{static async[a277_0x543623(0x1d4)](_0x152c67,_0x4984b5){const _0x26a44f=a277_0x543623,_0x1a05f9=await job_utils_1[_0x26a44f(0x1c8)]['getJobsIds'](RetrieveMetadataService[_0x26a44f(0x1ba)]),_0x5cd3fd=await job_utils_1['default']['sortJobsIds'](RetrieveMetadataService[_0x26a44f(0x1ba)],_0x1a05f9),_0x5e4318=_0x5cd3fd[_0x26a44f(0x1b4)](_0x4984b5,_0x4984b5+_0x152c67),_0x2c5271=[];for(const _0x60811f of _0x5e4318){const _0x3b2e81=await state_manger_1[_0x26a44f(0x1c8)][_0x26a44f(0x1a5)](path_1[_0x26a44f(0x1c8)][_0x26a44f(0x1a3)](RetrieveMetadataService[_0x26a44f(0x1ba)],_0x60811f));_0x2c5271['push'](_0x3b2e81);}return _0x2c5271;}static async[a277_0x543623(0x1b5)](_0x45d4ec){const _0x3b79a4=a277_0x543623,_0x4bd384=job_utils_1['default'][_0x3b79a4(0x1d6)](),_0x44fc53=path_1[_0x3b79a4(0x1c8)][_0x3b79a4(0x1a3)](RetrieveMetadataService[_0x3b79a4(0x1ba)],_0x4bd384);await(0x0,fs_utils_1['makeDir'])(_0x44fc53),await manifest_manger_1[_0x3b79a4(0x1c8)][_0x3b79a4(0x1be)](_0x44fc53,_0x45d4ec),await state_manger_1[_0x3b79a4(0x1c8)][_0x3b79a4(0x1be)](_0x44fc53,_0x4bd384);const _0xb5602f=path_1[_0x3b79a4(0x1c8)]['join'](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x3b79a4(0x1c8)][_0x3b79a4(0x19f)](_0xb5602f,{'jobStorePath':_0x44fc53,'jobId':_0x4bd384})['catch'](async _0x2c8ceb=>{const _0xf7e437=_0x3b79a4,_0x3304eb=new state_manger_1[(_0xf7e437(0x1c8))](_0x44fc53);await _0x3304eb['init'](),await _0x3304eb[_0xf7e437(0x1c1)](_0x2c8ceb);}),{'jobId':_0x4bd384};}static async[a277_0x543623(0x1d1)](_0x11f622){const _0x1a322c=a277_0x543623,{status:_0x28f2e8}=await RetrieveMetadataService[_0x1a322c(0x1c6)](_0x11f622);if(_0x28f2e8===logger_enums_1['JobStatus']['IN_PROGRESS'])throw new bad_request_error_1[(_0x1a322c(0x1b3))](_0x1a322c(0x1c4));const _0x583176=path_1['default'][_0x1a322c(0x1a3)](RetrieveMetadataService[_0x1a322c(0x1ba)],_0x11f622,constants_1[_0x1a322c(0x1cc)]);if(await utils_1['FsUtils']['isExistsPath'](_0x583176))return(0x0,promises_1[_0x1a322c(0x1ca)])(_0x583176,_0x1a322c(0x1cb))[_0x1a322c(0x1b9)](JSON[_0x1a322c(0x1bc)]);else throw new not_found_error_1['NotFoundError'](_0x1a322c(0x1a0));}static async['getResultChunk'](_0x2956b2,_0x296fc){const _0xcf1190=a277_0x543623,{status:_0x2ffc4a}=await RetrieveMetadataService['getJobStatus'](_0x2956b2);if(_0x2ffc4a===logger_enums_1[_0xcf1190(0x1c5)][_0xcf1190(0x1ab)])throw new bad_request_error_1[(_0xcf1190(0x1b3))]('Job\x20not\x20completed.');const _0x45ace6=path_1[_0xcf1190(0x1c8)]['join'](RetrieveMetadataService[_0xcf1190(0x1ba)],_0x2956b2,constants_1[_0xcf1190(0x1c2)]),_0x255ee0={'data':[]};if(await utils_1[_0xcf1190(0x1c3)][_0xcf1190(0x1a1)](path_1['default'][_0xcf1190(0x1a3)](_0x45ace6,_0x296fc+_0xcf1190(0x1aa))))_0x255ee0[_0xcf1190(0x1af)]=await(0x0,promises_1[_0xcf1190(0x1ca)])(path_1[_0xcf1190(0x1c8)][_0xcf1190(0x1a3)](_0x45ace6,_0x296fc+_0xcf1190(0x1aa)),_0xcf1190(0x1cb))[_0xcf1190(0x1b9)](JSON[_0xcf1190(0x1bc)]);else throw new not_found_error_1[(_0xcf1190(0x1bf))](_0xcf1190(0x1b0));return _0x255ee0;}static async[a277_0x543623(0x1c6)](_0x41a6f4){const _0x51ef2b=a277_0x543623;try{return await state_manger_1[_0x51ef2b(0x1c8)][_0x51ef2b(0x1a5)](path_1[_0x51ef2b(0x1c8)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x41a6f4));}catch(_0x419182){throw new not_found_error_1['NotFoundError'](_0x419182);}}static async[a277_0x543623(0x1b2)](_0x31b678){const _0x536096=a277_0x543623,_0x282ac8=path_1['default'][_0x536096(0x1a3)](RetrieveMetadataService[_0x536096(0x1ba)],_0x31b678,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1['FsUtils'][_0x536096(0x1a1)](_0x282ac8))return(0x0,promises_1['readFile'])(_0x282ac8,_0x536096(0x1cb))[_0x536096(0x1b9)](_0xd894e7=>csv_utils_1[_0x536096(0x1c8)][_0x536096(0x1bc)](_0xd894e7,{'columns':!![]}));throw new not_found_error_1[(_0x536096(0x1bf))](_0x536096(0x1a4));}}exports[a277_0x543623(0x1c8)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a277_0x543623(0x1c8)][a277_0x543623(0x1a3)](path_2['dataPath'],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);