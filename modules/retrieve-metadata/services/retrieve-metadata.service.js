const a321_0x76ab1e=a321_0x36c0;function a321_0x36c0(_0x605b83,_0x15859e){const _0x38593f=a321_0x5c95();return a321_0x36c0=function(_0x118f00,_0x3371e5){_0x118f00=_0x118f00-0x19c;let _0x5c9589=_0x38593f[_0x118f00];return _0x5c9589;},a321_0x36c0(_0x605b83,_0x15859e);}function a321_0x5c95(){const _0x4965b3=['../job/classes/manifest-manger','.json','619280nOOfTP','slice','JOB_LOG_DETAILS_FILENAME','503392sxqRNJ','then','IN_PROGRESS','../../shared/managers/state-manger','default','../../shared/enums/logger.enums','(((.+)+)+)+$','getJobsIds','getJobs','retrieveMetadataFolder','511czosSk','apply','utf-8','generateJobId','getJobState','16000yZUoyW','getJobStatus','4zBlwOA','getResult','setError','BadRequestError','create','constructor','Job\x20not\x20completed.','parse','join','JobStatus','Result\x20not\x20found.','search','@flosum/utils','656121NXNPXL','dataPath','makeDir','FsUtils','../constants','9585gZFFKr','__importDefault','2346832vRFMdZ','5256830KoeLIO','defineProperty','readFile','../../../core/errors/bad-request.error','Job\x20log\x20not\x20found.','NotFoundError','toString','RETRIEVE_RESULT_FOLDER_NAME','../../../constants/job','110886wZucJm','RETRIEVE_METADATA_FOLDER_NAME','../../../configs/path','path','../../shared/utils/fs.utils','__esModule','init','../../shared/utils/job.utils','isExistsPath'];a321_0x5c95=function(){return _0x4965b3;};return a321_0x5c95();}(function(_0x55f4e0,_0x4f8d0d){const _0x199ab9=a321_0x36c0,_0x4f0da4=_0x55f4e0();while(!![]){try{const _0x2467e4=parseInt(_0x199ab9(0x1a4))/0x1+parseInt(_0x199ab9(0x1a7))/0x2+parseInt(_0x199ab9(0x1c5))/0x3+-parseInt(_0x199ab9(0x1b8))/0x4*(parseInt(_0x199ab9(0x1cd))/0x5)+parseInt(_0x199ab9(0x1d6))/0x6*(-parseInt(_0x199ab9(0x1b1))/0x7)+parseInt(_0x199ab9(0x1cc))/0x8+-parseInt(_0x199ab9(0x1ca))/0x9*(-parseInt(_0x199ab9(0x1b6))/0xa);if(_0x2467e4===_0x4f8d0d)break;else _0x4f0da4['push'](_0x4f0da4['shift']());}catch(_0x5c33fa){_0x4f0da4['push'](_0x4f0da4['shift']());}}}(a321_0x5c95,0xa79de));const a321_0x3371e5=(function(){let _0x4eac7a=!![];return function(_0x791c42,_0x520a8d){const _0x36f5f7=_0x4eac7a?function(){const _0x1cf539=a321_0x36c0;if(_0x520a8d){const _0x1e73d5=_0x520a8d[_0x1cf539(0x1b2)](_0x791c42,arguments);return _0x520a8d=null,_0x1e73d5;}}:function(){};return _0x4eac7a=![],_0x36f5f7;};}()),a321_0x118f00=a321_0x3371e5(this,function(){const _0x589c99=a321_0x36c0;return a321_0x118f00[_0x589c99(0x1d3)]()[_0x589c99(0x1c3)]('(((.+)+)+)+$')[_0x589c99(0x1d3)]()[_0x589c99(0x1bd)](a321_0x118f00)[_0x589c99(0x1c3)](_0x589c99(0x1ad));});a321_0x118f00();'use strict';var __importDefault=this&&this[a321_0x76ab1e(0x1cb)]||function(_0x267972){const _0x24692e=a321_0x76ab1e;return _0x267972&&_0x267972[_0x24692e(0x19e)]?_0x267972:{'default':_0x267972};};Object[a321_0x76ab1e(0x1ce)](exports,a321_0x76ab1e(0x19e),{'value':!![]});const job_utils_1=__importDefault(require(a321_0x76ab1e(0x1a0))),path_1=__importDefault(require(a321_0x76ab1e(0x19c))),manifest_manger_1=__importDefault(require(a321_0x76ab1e(0x1a2))),state_manger_1=__importDefault(require(a321_0x76ab1e(0x1aa))),promises_1=require('fs/promises'),utils_1=require(a321_0x76ab1e(0x1c4)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require('../../../core/errors/not-found.error'),logger_enums_1=require(a321_0x76ab1e(0x1ac)),bad_request_error_1=require(a321_0x76ab1e(0x1d0)),job_1=require(a321_0x76ab1e(0x1d5)),fs_utils_1=require(a321_0x76ab1e(0x19d)),constants_1=require(a321_0x76ab1e(0x1c9)),path_2=require(a321_0x76ab1e(0x1d8));class RetrieveMetadataService{static async[a321_0x76ab1e(0x1af)](_0x46d44b,_0x35c3fd){const _0x1aabb5=a321_0x76ab1e,_0x2d37bc=await job_utils_1['default'][_0x1aabb5(0x1ae)](RetrieveMetadataService[_0x1aabb5(0x1b0)]),_0x200729=await job_utils_1[_0x1aabb5(0x1ab)]['sortJobsIds'](RetrieveMetadataService[_0x1aabb5(0x1b0)],_0x2d37bc),_0x262c60=_0x200729[_0x1aabb5(0x1a5)](_0x35c3fd,_0x35c3fd+_0x46d44b),_0x1e00df=[];for(const _0x19c4fd of _0x262c60){const _0x4d607e=await state_manger_1[_0x1aabb5(0x1ab)][_0x1aabb5(0x1b5)](path_1[_0x1aabb5(0x1ab)][_0x1aabb5(0x1c0)](RetrieveMetadataService['retrieveMetadataFolder'],_0x19c4fd));_0x1e00df['push'](_0x4d607e);}return _0x1e00df;}static async['createRetrieveJob'](_0x2a09ca){const _0x20c7e4=a321_0x76ab1e,_0x19f567=job_utils_1['default'][_0x20c7e4(0x1b4)](),_0x3a92bd=path_1['default'][_0x20c7e4(0x1c0)](RetrieveMetadataService[_0x20c7e4(0x1b0)],_0x19f567);await(0x0,fs_utils_1[_0x20c7e4(0x1c7)])(_0x3a92bd),await manifest_manger_1[_0x20c7e4(0x1ab)]['create'](_0x3a92bd,_0x2a09ca),await state_manger_1['default'][_0x20c7e4(0x1bc)](_0x3a92bd,_0x19f567);const _0xf3d1d=path_1[_0x20c7e4(0x1ab)][_0x20c7e4(0x1c0)](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x20c7e4(0x1ab)]['runJob'](_0xf3d1d,{'jobStorePath':_0x3a92bd,'jobId':_0x19f567})['catch'](async _0x1dfbe0=>{const _0x214123=_0x20c7e4,_0x18a063=new state_manger_1[(_0x214123(0x1ab))](_0x3a92bd);await _0x18a063[_0x214123(0x19f)](),await _0x18a063[_0x214123(0x1ba)](_0x1dfbe0);}),{'jobId':_0x19f567};}static async[a321_0x76ab1e(0x1b9)](_0x1ceaf4){const _0x14548f=a321_0x76ab1e,{status:_0x4d6b71}=await RetrieveMetadataService[_0x14548f(0x1b7)](_0x1ceaf4);if(_0x4d6b71===logger_enums_1[_0x14548f(0x1c1)][_0x14548f(0x1a9)])throw new bad_request_error_1['BadRequestError'](_0x14548f(0x1be));const _0x3eee94=path_1[_0x14548f(0x1ab)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x1ceaf4,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x14548f(0x1c8)][_0x14548f(0x1a1)](_0x3eee94))return(0x0,promises_1['readFile'])(_0x3eee94,_0x14548f(0x1b3))['then'](JSON[_0x14548f(0x1bf)]);else throw new not_found_error_1[(_0x14548f(0x1d2))](_0x14548f(0x1c2));}static async['getResultChunk'](_0x340e0a,_0x487533){const _0x3ee4b1=a321_0x76ab1e,{status:_0x301f74}=await RetrieveMetadataService[_0x3ee4b1(0x1b7)](_0x340e0a);if(_0x301f74===logger_enums_1[_0x3ee4b1(0x1c1)][_0x3ee4b1(0x1a9)])throw new bad_request_error_1[(_0x3ee4b1(0x1bb))](_0x3ee4b1(0x1be));const _0xd40dc4=path_1[_0x3ee4b1(0x1ab)]['join'](RetrieveMetadataService[_0x3ee4b1(0x1b0)],_0x340e0a,constants_1[_0x3ee4b1(0x1d4)]),_0x14c43a={'data':[]};if(await utils_1['FsUtils'][_0x3ee4b1(0x1a1)](path_1[_0x3ee4b1(0x1ab)]['join'](_0xd40dc4,_0x487533+'.json')))_0x14c43a['data']=await(0x0,promises_1[_0x3ee4b1(0x1cf)])(path_1[_0x3ee4b1(0x1ab)]['join'](_0xd40dc4,_0x487533+_0x3ee4b1(0x1a3)),_0x3ee4b1(0x1b3))[_0x3ee4b1(0x1a8)](JSON[_0x3ee4b1(0x1bf)]);else throw new not_found_error_1[(_0x3ee4b1(0x1d2))]('Chunk\x20not\x20found.');return _0x14c43a;}static async[a321_0x76ab1e(0x1b7)](_0x320eb9){const _0x1332a6=a321_0x76ab1e;try{return await state_manger_1[_0x1332a6(0x1ab)][_0x1332a6(0x1b5)](path_1[_0x1332a6(0x1ab)][_0x1332a6(0x1c0)](RetrieveMetadataService[_0x1332a6(0x1b0)],_0x320eb9));}catch(_0x4084c8){throw new not_found_error_1['NotFoundError'](_0x4084c8);}}static async['getJobLogs'](_0x476d38){const _0x58c50b=a321_0x76ab1e,_0x16727b=path_1[_0x58c50b(0x1ab)][_0x58c50b(0x1c0)](RetrieveMetadataService[_0x58c50b(0x1b0)],_0x476d38,job_1[_0x58c50b(0x1a6)]);if(await utils_1[_0x58c50b(0x1c8)][_0x58c50b(0x1a1)](_0x16727b))return(0x0,promises_1['readFile'])(_0x16727b,_0x58c50b(0x1b3))[_0x58c50b(0x1a8)](_0x54f496=>csv_utils_1[_0x58c50b(0x1ab)][_0x58c50b(0x1bf)](_0x54f496,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x58c50b(0x1d1));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService[a321_0x76ab1e(0x1b0)]=path_1[a321_0x76ab1e(0x1ab)][a321_0x76ab1e(0x1c0)](path_2[a321_0x76ab1e(0x1c6)],constants_1[a321_0x76ab1e(0x1d7)]);