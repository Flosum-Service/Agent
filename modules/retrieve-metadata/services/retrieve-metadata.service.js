const a309_0x28f450=a309_0x5c83;(function(_0x1dd7ea,_0x41823a){const _0x47b759=a309_0x5c83,_0x13d25e=_0x1dd7ea();while(!![]){try{const _0x2f9324=-parseInt(_0x47b759(0x139))/0x1*(parseInt(_0x47b759(0x137))/0x2)+-parseInt(_0x47b759(0x105))/0x3+-parseInt(_0x47b759(0x122))/0x4+-parseInt(_0x47b759(0x13b))/0x5+-parseInt(_0x47b759(0x118))/0x6+parseInt(_0x47b759(0x101))/0x7+parseInt(_0x47b759(0x10a))/0x8;if(_0x2f9324===_0x41823a)break;else _0x13d25e['push'](_0x13d25e['shift']());}catch(_0x4a24b2){_0x13d25e['push'](_0x13d25e['shift']());}}}(a309_0x3f01,0x66a93));function a309_0x3f01(){const _0x5e8cb0=['../constants','Chunk\x20not\x20found.','getJobStatus','NotFoundError','search','defineProperty','.json','../../../configs/path','BadRequestError','IN_PROGRESS','getJobLogs','getJobState','3361956ojYALk','fs/promises','join','parse','JobStatus','(((.+)+)+)+$','generateJobId','RETRIEVE_METADATA_FOLDER_NAME','retrieveMetadataFolder','FsUtils','412384DtuPzl','getJobs','__esModule','default','../../shared/utils/fs.utils','toString','makeDir','then','getJobsIds','../../shared/utils/csv.utils','apply','catch','sortJobsIds','push','getResultChunk','RETRIEVE_RESULTS_IDS_FILENAME','__importDefault','data','isExistsPath','setError','Job\x20log\x20not\x20found.','126cUmuhS','path','5974BPUfSz','readFile','382630ggfqNi','getResult','2205231cgszMG','../../shared/managers/state-manger','constructor','RETRIEVE_RESULT_FOLDER_NAME','2111931fAIXEa','utf-8','create','../../../core/errors/not-found.error','slice','15406024EnDphc','../../../constants/job'];a309_0x3f01=function(){return _0x5e8cb0;};return a309_0x3f01();}function a309_0x5c83(_0x2fe3a1,_0x4216eb){const _0x47aeef=a309_0x3f01();return a309_0x5c83=function(_0xa2584a,_0x482ed8){_0xa2584a=_0xa2584a-0x101;let _0x3f01c1=_0x47aeef[_0xa2584a];return _0x3f01c1;},a309_0x5c83(_0x2fe3a1,_0x4216eb);}const a309_0x482ed8=(function(){let _0xab2946=!![];return function(_0x1d17d3,_0x1e4da1){const _0x42c246=_0xab2946?function(){const _0x528f7f=a309_0x5c83;if(_0x1e4da1){const _0x3d54d2=_0x1e4da1[_0x528f7f(0x12c)](_0x1d17d3,arguments);return _0x1e4da1=null,_0x3d54d2;}}:function(){};return _0xab2946=![],_0x42c246;};}()),a309_0xa2584a=a309_0x482ed8(this,function(){const _0x514c21=a309_0x5c83;return a309_0xa2584a[_0x514c21(0x127)]()[_0x514c21(0x110)](_0x514c21(0x11d))['toString']()[_0x514c21(0x103)](a309_0xa2584a)[_0x514c21(0x110)](_0x514c21(0x11d));});a309_0xa2584a();'use strict';var __importDefault=this&&this[a309_0x28f450(0x132)]||function(_0x33b773){const _0x3f9d96=a309_0x28f450;return _0x33b773&&_0x33b773[_0x3f9d96(0x124)]?_0x33b773:{'default':_0x33b773};};Object[a309_0x28f450(0x111)](exports,a309_0x28f450(0x124),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a309_0x28f450(0x138))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a309_0x28f450(0x102))),promises_1=require(a309_0x28f450(0x119)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a309_0x28f450(0x12b))),not_found_error_1=require(a309_0x28f450(0x108)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require(a309_0x28f450(0x10b)),fs_utils_1=require(a309_0x28f450(0x126)),constants_1=require(a309_0x28f450(0x10c)),path_2=require(a309_0x28f450(0x113));class RetrieveMetadataService{static async[a309_0x28f450(0x123)](_0x30c699,_0x413256){const _0x54d239=a309_0x28f450,_0x55beb1=await job_utils_1[_0x54d239(0x125)][_0x54d239(0x12a)](RetrieveMetadataService['retrieveMetadataFolder']),_0x99381d=await job_utils_1['default'][_0x54d239(0x12e)](RetrieveMetadataService[_0x54d239(0x120)],_0x55beb1),_0x551697=_0x99381d[_0x54d239(0x109)](_0x413256,_0x413256+_0x30c699),_0x49108e=[];for(const _0x508307 of _0x551697){const _0x1ad52c=await state_manger_1[_0x54d239(0x125)][_0x54d239(0x117)](path_1[_0x54d239(0x125)][_0x54d239(0x11a)](RetrieveMetadataService['retrieveMetadataFolder'],_0x508307));_0x49108e[_0x54d239(0x12f)](_0x1ad52c);}return _0x49108e;}static async['createRetrieveJob'](_0x483ae0){const _0x4fb191=a309_0x28f450,_0x46f424=job_utils_1['default'][_0x4fb191(0x11e)](),_0x3aeb62=path_1[_0x4fb191(0x125)][_0x4fb191(0x11a)](RetrieveMetadataService[_0x4fb191(0x120)],_0x46f424);await(0x0,fs_utils_1[_0x4fb191(0x128)])(_0x3aeb62),await manifest_manger_1[_0x4fb191(0x125)][_0x4fb191(0x107)](_0x3aeb62,_0x483ae0),await state_manger_1[_0x4fb191(0x125)][_0x4fb191(0x107)](_0x3aeb62,_0x46f424);const _0x5e1cee=path_1[_0x4fb191(0x125)][_0x4fb191(0x11a)](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x4fb191(0x125)]['runJob'](_0x5e1cee,{'jobStorePath':_0x3aeb62,'jobId':_0x46f424})[_0x4fb191(0x12d)](async _0x394d55=>{const _0x23edbb=_0x4fb191,_0x4bb140=new state_manger_1[(_0x23edbb(0x125))](_0x3aeb62);await _0x4bb140['init'](),await _0x4bb140[_0x23edbb(0x135)](_0x394d55);}),{'jobId':_0x46f424};}static async[a309_0x28f450(0x13c)](_0xd6ecd5){const _0x3a992b=a309_0x28f450,{status:_0x2cccd1}=await RetrieveMetadataService[_0x3a992b(0x10e)](_0xd6ecd5);if(_0x2cccd1===logger_enums_1[_0x3a992b(0x11c)][_0x3a992b(0x115)])throw new bad_request_error_1[(_0x3a992b(0x114))]('Job\x20not\x20completed.');const _0x4a924d=path_1[_0x3a992b(0x125)][_0x3a992b(0x11a)](RetrieveMetadataService['retrieveMetadataFolder'],_0xd6ecd5,constants_1[_0x3a992b(0x131)]);if(await utils_1[_0x3a992b(0x121)]['isExistsPath'](_0x4a924d))return(0x0,promises_1[_0x3a992b(0x13a)])(_0x4a924d,'utf-8')[_0x3a992b(0x129)](JSON[_0x3a992b(0x11b)]);else throw new not_found_error_1[(_0x3a992b(0x10f))]('Result\x20not\x20found.');}static async[a309_0x28f450(0x130)](_0x2fce30,_0x2696a5){const _0x5ca655=a309_0x28f450,{status:_0xcf435e}=await RetrieveMetadataService[_0x5ca655(0x10e)](_0x2fce30);if(_0xcf435e===logger_enums_1[_0x5ca655(0x11c)][_0x5ca655(0x115)])throw new bad_request_error_1['BadRequestError']('Job\x20not\x20completed.');const _0x286d40=path_1[_0x5ca655(0x125)][_0x5ca655(0x11a)](RetrieveMetadataService[_0x5ca655(0x120)],_0x2fce30,constants_1[_0x5ca655(0x104)]),_0xcca0ae={'data':[]};if(await utils_1[_0x5ca655(0x121)]['isExistsPath'](path_1['default'][_0x5ca655(0x11a)](_0x286d40,_0x2696a5+'.json')))_0xcca0ae[_0x5ca655(0x133)]=await(0x0,promises_1[_0x5ca655(0x13a)])(path_1[_0x5ca655(0x125)][_0x5ca655(0x11a)](_0x286d40,_0x2696a5+_0x5ca655(0x112)),_0x5ca655(0x106))[_0x5ca655(0x129)](JSON[_0x5ca655(0x11b)]);else throw new not_found_error_1['NotFoundError'](_0x5ca655(0x10d));return _0xcca0ae;}static async[a309_0x28f450(0x10e)](_0x1292f3){const _0x5f039f=a309_0x28f450;try{return await state_manger_1[_0x5f039f(0x125)][_0x5f039f(0x117)](path_1[_0x5f039f(0x125)]['join'](RetrieveMetadataService[_0x5f039f(0x120)],_0x1292f3));}catch(_0x22d7f8){throw new not_found_error_1[(_0x5f039f(0x10f))](_0x22d7f8);}}static async[a309_0x28f450(0x116)](_0x2481de){const _0x11482f=a309_0x28f450,_0x458ec7=path_1[_0x11482f(0x125)][_0x11482f(0x11a)](RetrieveMetadataService[_0x11482f(0x120)],_0x2481de,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1['FsUtils'][_0x11482f(0x134)](_0x458ec7))return(0x0,promises_1['readFile'])(_0x458ec7,_0x11482f(0x106))['then'](_0x2c0c86=>csv_utils_1[_0x11482f(0x125)][_0x11482f(0x11b)](_0x2c0c86,{'columns':!![]}));throw new not_found_error_1[(_0x11482f(0x10f))](_0x11482f(0x136));}}exports[a309_0x28f450(0x125)]=RetrieveMetadataService,RetrieveMetadataService[a309_0x28f450(0x120)]=path_1[a309_0x28f450(0x125)][a309_0x28f450(0x11a)](path_2['dataPath'],constants_1[a309_0x28f450(0x11f)]);