const a274_0x178913=a274_0x1606;(function(_0x49b14f,_0x825b58){const _0x4734d4=a274_0x1606,_0xbd1f8d=_0x49b14f();while(!![]){try{const _0x1f095f=parseInt(_0x4734d4(0xe6))/0x1*(parseInt(_0x4734d4(0xd9))/0x2)+parseInt(_0x4734d4(0xeb))/0x3*(-parseInt(_0x4734d4(0xd4))/0x4)+parseInt(_0x4734d4(0xf0))/0x5*(-parseInt(_0x4734d4(0xef))/0x6)+parseInt(_0x4734d4(0xe3))/0x7+-parseInt(_0x4734d4(0xe2))/0x8+-parseInt(_0x4734d4(0xce))/0x9+-parseInt(_0x4734d4(0xec))/0xa*(-parseInt(_0x4734d4(0xda))/0xb);if(_0x1f095f===_0x825b58)break;else _0xbd1f8d['push'](_0xbd1f8d['shift']());}catch(_0x4861c2){_0xbd1f8d['push'](_0xbd1f8d['shift']());}}}(a274_0x2c5b,0x611bc));const a274_0xc43cb4=(function(){let _0x90a329=!![];return function(_0xfb60a8,_0x671a17){const _0x133d54=_0x90a329?function(){const _0xe665b0=a274_0x1606;if(_0x671a17){const _0x46d21e=_0x671a17[_0xe665b0(0xe7)](_0xfb60a8,arguments);return _0x671a17=null,_0x46d21e;}}:function(){};return _0x90a329=![],_0x133d54;};}()),a274_0x49ba14=a274_0xc43cb4(this,function(){const _0x172586=a274_0x1606;return a274_0x49ba14['toString']()[_0x172586(0xb8)](_0x172586(0xd6))[_0x172586(0xd3)]()['constructor'](a274_0x49ba14)[_0x172586(0xb8)](_0x172586(0xd6));});a274_0x49ba14();'use strict';var __importDefault=this&&this[a274_0x178913(0xe4)]||function(_0x301c8d){const _0x371321=a274_0x178913;return _0x301c8d&&_0x301c8d[_0x371321(0xdf)]?_0x301c8d:{'default':_0x301c8d};};Object[a274_0x178913(0xe0)](exports,a274_0x178913(0xdf),{'value':!![]});function a274_0x1606(_0x501996,_0x148af9){const _0x470851=a274_0x2c5b();return a274_0x1606=function(_0x49ba14,_0xc43cb4){_0x49ba14=_0x49ba14-0xb3;let _0x2c5b80=_0x470851[_0x49ba14];return _0x2c5b80;},a274_0x1606(_0x501996,_0x148af9);}const job_utils_1=__importDefault(require(a274_0x178913(0xed))),path_1=__importDefault(require(a274_0x178913(0xe8))),manifest_manger_1=__importDefault(require(a274_0x178913(0xde))),state_manger_1=__importDefault(require(a274_0x178913(0xc4))),promises_1=require(a274_0x178913(0xe9)),utils_1=require(a274_0x178913(0xc6)),csv_utils_1=__importDefault(require(a274_0x178913(0xdc))),not_found_error_1=require(a274_0x178913(0xf1)),logger_enums_1=require(a274_0x178913(0xb7)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require('../../../constants/job'),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require('../constants'),path_2=require(a274_0x178913(0xd0));class RetrieveMetadataService{static async['getJobs'](_0xeacf40,_0x5d75f6){const _0x51bfc2=a274_0x178913,_0x3140b8=await job_utils_1[_0x51bfc2(0xb3)]['getJobsIds'](RetrieveMetadataService[_0x51bfc2(0xd7)]),_0x2c92a8=await job_utils_1[_0x51bfc2(0xb3)][_0x51bfc2(0xc5)](RetrieveMetadataService['retrieveMetadataFolder'],_0x3140b8),_0x230469=_0x2c92a8[_0x51bfc2(0xd8)](_0x5d75f6,_0x5d75f6+_0xeacf40),_0x7127b9=[];for(const _0x2c395a of _0x230469){const _0x59e051=await state_manger_1[_0x51bfc2(0xb3)][_0x51bfc2(0xc9)](path_1[_0x51bfc2(0xb3)][_0x51bfc2(0xb5)](RetrieveMetadataService[_0x51bfc2(0xd7)],_0x2c395a));_0x7127b9[_0x51bfc2(0xe5)](_0x59e051);}return _0x7127b9;}static async[a274_0x178913(0xc7)](_0x4f24af){const _0x292494=a274_0x178913,_0x36f61f=job_utils_1[_0x292494(0xb3)][_0x292494(0xd1)](),_0x5d4455=path_1[_0x292494(0xb3)][_0x292494(0xb5)](RetrieveMetadataService['retrieveMetadataFolder'],_0x36f61f);await(0x0,fs_utils_1[_0x292494(0xe1)])(_0x5d4455),await manifest_manger_1['default'][_0x292494(0xc8)](_0x5d4455,_0x4f24af),await state_manger_1['default']['create'](_0x5d4455,_0x36f61f);const _0x5f211a=path_1[_0x292494(0xb3)][_0x292494(0xb5)](__dirname,job_1[_0x292494(0xca)]);return job_utils_1[_0x292494(0xb3)][_0x292494(0xf4)](_0x5f211a,{'jobStorePath':_0x5d4455,'jobId':_0x36f61f})['catch'](async _0x5a144c=>{const _0x23ff09=_0x292494,_0xa849c0=new state_manger_1[(_0x23ff09(0xb3))](_0x5d4455);await _0xa849c0[_0x23ff09(0xdd)](),await _0xa849c0[_0x23ff09(0xb9)](_0x5a144c);}),{'jobId':_0x36f61f};}static async[a274_0x178913(0xc3)](_0x24a90f){const _0x373769=a274_0x178913,{status:_0x1ce289}=await RetrieveMetadataService['getJobStatus'](_0x24a90f);if(_0x1ce289===logger_enums_1[_0x373769(0xcf)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x373769(0xcd))](_0x373769(0xf5));const _0x243007=path_1[_0x373769(0xb3)][_0x373769(0xb5)](RetrieveMetadataService[_0x373769(0xd7)],_0x24a90f,constants_1[_0x373769(0xbe)]);if(await utils_1[_0x373769(0xdb)][_0x373769(0xd5)](_0x243007))return(0x0,promises_1[_0x373769(0xbf)])(_0x243007,'utf-8')[_0x373769(0xf2)](JSON[_0x373769(0xea)]);else throw new not_found_error_1[(_0x373769(0xba))](_0x373769(0xbc));}static async[a274_0x178913(0xb6)](_0x169733,_0x133f5b){const _0x14458a=a274_0x178913,{status:_0x1dec74}=await RetrieveMetadataService[_0x14458a(0xd2)](_0x169733);if(_0x1dec74===logger_enums_1['JobStatus']['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError'](_0x14458a(0xf5));const _0x2eaa3c=path_1[_0x14458a(0xb3)][_0x14458a(0xb5)](RetrieveMetadataService[_0x14458a(0xd7)],_0x169733,constants_1[_0x14458a(0xee)]),_0x34ea60={'data':[]};if(await utils_1[_0x14458a(0xdb)]['isExistsPath'](path_1[_0x14458a(0xb3)][_0x14458a(0xb5)](_0x2eaa3c,_0x133f5b+'.json')))_0x34ea60[_0x14458a(0xc1)]=await(0x0,promises_1[_0x14458a(0xbf)])(path_1[_0x14458a(0xb3)][_0x14458a(0xb5)](_0x2eaa3c,_0x133f5b+_0x14458a(0xcc)),_0x14458a(0xcb))[_0x14458a(0xf2)](JSON[_0x14458a(0xea)]);else throw new not_found_error_1[(_0x14458a(0xba))](_0x14458a(0xc2));return _0x34ea60;}static async['getJobStatus'](_0x475f55){const _0x4ad3c9=a274_0x178913;try{return await state_manger_1[_0x4ad3c9(0xb3)][_0x4ad3c9(0xc9)](path_1[_0x4ad3c9(0xb3)][_0x4ad3c9(0xb5)](RetrieveMetadataService[_0x4ad3c9(0xd7)],_0x475f55));}catch(_0x4e1c34){throw new not_found_error_1['NotFoundError'](_0x4e1c34);}}static async[a274_0x178913(0xc0)](_0x65d9e0){const _0x3c04b9=a274_0x178913,_0x1f8857=path_1[_0x3c04b9(0xb3)][_0x3c04b9(0xb5)](RetrieveMetadataService[_0x3c04b9(0xd7)],_0x65d9e0,job_1[_0x3c04b9(0xbb)]);if(await utils_1[_0x3c04b9(0xdb)]['isExistsPath'](_0x1f8857))return(0x0,promises_1[_0x3c04b9(0xbf)])(_0x1f8857,_0x3c04b9(0xcb))['then'](_0xb49c5c=>csv_utils_1[_0x3c04b9(0xb3)][_0x3c04b9(0xea)](_0xb49c5c,{'columns':!![]}));throw new not_found_error_1[(_0x3c04b9(0xba))](_0x3c04b9(0xb4));}}exports[a274_0x178913(0xb3)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a274_0x178913(0xb3)]['join'](path_2[a274_0x178913(0xbd)],constants_1[a274_0x178913(0xf3)]);function a274_0x2c5b(){const _0x5e629f=['../../shared/utils/job.utils','RETRIEVE_RESULT_FOLDER_NAME','6dcAqll','1332440fJgLxU','../../../core/errors/not-found.error','then','RETRIEVE_METADATA_FOLDER_NAME','runJob','Job\x20not\x20completed.','default','Job\x20log\x20not\x20found.','join','getResultChunk','../job/enums/logger.enums','search','setError','NotFoundError','JOB_LOG_DETAILS_FILENAME','Result\x20not\x20found.','dataPath','RETRIEVE_RESULTS_IDS_FILENAME','readFile','getJobLogs','data','Chunk\x20not\x20found.','getResult','../job/classes/state-manger','sortJobsIds','@flosum/utils','createRetrieveJob','create','getJobState','JOB_PATH','utf-8','.json','BadRequestError','436419UbjCnc','JobStatus','../../../configs/path','generateJobId','getJobStatus','toString','18092TDHHpg','isExistsPath','(((.+)+)+)+$','retrieveMetadataFolder','slice','191514SFUpkc','6190184ETzIjV','FsUtils','../../shared/utils/csv.utils','init','../job/classes/manifest-manger','__esModule','defineProperty','makeDir','462120iGcpPx','232512jcQVhN','__importDefault','push','1SRAOyu','apply','path','fs/promises','parse','321ibEYGw','20GWUGZN'];a274_0x2c5b=function(){return _0x5e629f;};return a274_0x2c5b();}