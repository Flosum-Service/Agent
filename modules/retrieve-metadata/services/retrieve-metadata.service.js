const a273_0x41178e=a273_0x2171;function a273_0x2171(_0x79b2e9,_0x5d6645){const _0x588faa=a273_0xc7cf();return a273_0x2171=function(_0x54334d,_0xd46212){_0x54334d=_0x54334d-0x12c;let _0xc7cffe=_0x588faa[_0x54334d];return _0xc7cffe;},a273_0x2171(_0x79b2e9,_0x5d6645);}function a273_0xc7cf(){const _0x101cff=['FsUtils','1606968nYIVOf','fs/promises','RETRIEVE_METADATA_FOLDER_NAME','JobStatus','getJobState','NotFoundError','../job/classes/state-manger','getResultChunk','../../shared/utils/fs.utils','32351mMxsil','1526092fXwzsh','BadRequestError','data','catch','generateJobId','Result\x20not\x20found.','init','then','path','__importDefault','getResult','slice','1RKotYq','../../../configs/path','Job\x20not\x20completed.','retrieveMetadataFolder','search','toString','defineProperty','5052qMlYtW','1594362fYDkAm','../../shared/utils/job.utils','3fdjysH','parse','(((.+)+)+)+$','default','readFile','../../../core/errors/bad-request.error','sortJobsIds','../../shared/utils/csv.utils','155706ORltLt','setError','../../../core/errors/not-found.error','create','../constants','getJobStatus','85yCIGDe','JOB_LOG_DETAILS_FILENAME','isExistsPath','join','getJobLogs','__esModule','../job/classes/manifest-manger','RETRIEVE_RESULTS_IDS_FILENAME','.json','9HqPceP','utf-8','IN_PROGRESS','1368470NsXHih','596746PRvchQ','@flosum/utils'];a273_0xc7cf=function(){return _0x101cff;};return a273_0xc7cf();}(function(_0x318ae2,_0x593e8e){const _0x4e67e6=a273_0x2171,_0x51e0a7=_0x318ae2();while(!![]){try{const _0x39bab4=-parseInt(_0x4e67e6(0x13d))/0x1*(parseInt(_0x4e67e6(0x162))/0x2)+parseInt(_0x4e67e6(0x147))/0x3*(-parseInt(_0x4e67e6(0x131))/0x4)+parseInt(_0x4e67e6(0x155))/0x5*(-parseInt(_0x4e67e6(0x14f))/0x6)+-parseInt(_0x4e67e6(0x145))/0x7+parseInt(_0x4e67e6(0x165))/0x8*(parseInt(_0x4e67e6(0x15e))/0x9)+parseInt(_0x4e67e6(0x161))/0xa+-parseInt(_0x4e67e6(0x130))/0xb*(-parseInt(_0x4e67e6(0x144))/0xc);if(_0x39bab4===_0x593e8e)break;else _0x51e0a7['push'](_0x51e0a7['shift']());}catch(_0x310f8c){_0x51e0a7['push'](_0x51e0a7['shift']());}}}(a273_0xc7cf,0x376ea));const a273_0xd46212=(function(){let _0x3f876b=!![];return function(_0x4dbd47,_0x5dc3b1){const _0x28ee21=_0x3f876b?function(){if(_0x5dc3b1){const _0x152ae1=_0x5dc3b1['apply'](_0x4dbd47,arguments);return _0x5dc3b1=null,_0x152ae1;}}:function(){};return _0x3f876b=![],_0x28ee21;};}()),a273_0x54334d=a273_0xd46212(this,function(){const _0x183034=a273_0x2171;return a273_0x54334d[_0x183034(0x142)]()[_0x183034(0x141)](_0x183034(0x149))[_0x183034(0x142)]()['constructor'](a273_0x54334d)[_0x183034(0x141)](_0x183034(0x149));});a273_0x54334d();'use strict';var __importDefault=this&&this[a273_0x41178e(0x13a)]||function(_0x399cd1){const _0x5f2f9a=a273_0x41178e;return _0x399cd1&&_0x399cd1[_0x5f2f9a(0x15a)]?_0x399cd1:{'default':_0x399cd1};};Object[a273_0x41178e(0x143)](exports,a273_0x41178e(0x15a),{'value':!![]});const job_utils_1=__importDefault(require(a273_0x41178e(0x146))),path_1=__importDefault(require(a273_0x41178e(0x139))),manifest_manger_1=__importDefault(require(a273_0x41178e(0x15b))),state_manger_1=__importDefault(require(a273_0x41178e(0x12d))),promises_1=require(a273_0x41178e(0x166)),utils_1=require(a273_0x41178e(0x163)),csv_utils_1=__importDefault(require(a273_0x41178e(0x14e))),not_found_error_1=require(a273_0x41178e(0x151)),logger_enums_1=require('../job/enums/logger.enums'),bad_request_error_1=require(a273_0x41178e(0x14c)),job_1=require('../../../constants/job'),fs_utils_1=require(a273_0x41178e(0x12f)),constants_1=require(a273_0x41178e(0x153)),path_2=require(a273_0x41178e(0x13e));class RetrieveMetadataService{static async['getJobs'](_0x6be9f2,_0x21bc4b){const _0x241556=a273_0x41178e,_0x370484=await job_utils_1[_0x241556(0x14a)]['getJobsIds'](RetrieveMetadataService[_0x241556(0x140)]),_0x371788=await job_utils_1[_0x241556(0x14a)][_0x241556(0x14d)](RetrieveMetadataService[_0x241556(0x140)],_0x370484),_0x51028a=_0x371788[_0x241556(0x13c)](_0x21bc4b,_0x21bc4b+_0x6be9f2),_0x4ad844=[];for(const _0x2a6070 of _0x51028a){const _0x5a8807=await state_manger_1[_0x241556(0x14a)][_0x241556(0x169)](path_1[_0x241556(0x14a)]['join'](RetrieveMetadataService[_0x241556(0x140)],_0x2a6070));_0x4ad844['push'](_0x5a8807);}return _0x4ad844;}static async['createRetrieveJob'](_0x3b5214){const _0x33a87d=a273_0x41178e,_0x4e4b0b=job_utils_1[_0x33a87d(0x14a)][_0x33a87d(0x135)](),_0x4214c0=path_1[_0x33a87d(0x14a)][_0x33a87d(0x158)](RetrieveMetadataService[_0x33a87d(0x140)],_0x4e4b0b);await(0x0,fs_utils_1['makeDir'])(_0x4214c0),await manifest_manger_1[_0x33a87d(0x14a)]['create'](_0x4214c0,_0x3b5214),await state_manger_1[_0x33a87d(0x14a)][_0x33a87d(0x152)](_0x4214c0,_0x4e4b0b);const _0x2b30de=path_1[_0x33a87d(0x14a)]['join'](__dirname,job_1['JOB_PATH']);return job_utils_1['default']['runJob'](_0x2b30de,{'jobStorePath':_0x4214c0,'jobId':_0x4e4b0b})[_0x33a87d(0x134)](async _0x47a0e5=>{const _0x4921b1=_0x33a87d,_0xb25185=new state_manger_1[(_0x4921b1(0x14a))](_0x4214c0);await _0xb25185[_0x4921b1(0x137)](),await _0xb25185[_0x4921b1(0x150)](_0x47a0e5);}),{'jobId':_0x4e4b0b};}static async[a273_0x41178e(0x13b)](_0xa3836e){const _0x302b64=a273_0x41178e,{status:_0x115f72}=await RetrieveMetadataService['getJobStatus'](_0xa3836e);if(_0x115f72===logger_enums_1['JobStatus'][_0x302b64(0x160)])throw new bad_request_error_1[(_0x302b64(0x132))](_0x302b64(0x13f));const _0x2f9192=path_1[_0x302b64(0x14a)][_0x302b64(0x158)](RetrieveMetadataService[_0x302b64(0x140)],_0xa3836e,constants_1[_0x302b64(0x15c)]);if(await utils_1[_0x302b64(0x164)][_0x302b64(0x157)](_0x2f9192))return(0x0,promises_1[_0x302b64(0x14b)])(_0x2f9192,_0x302b64(0x15f))[_0x302b64(0x138)](JSON[_0x302b64(0x148)]);else throw new not_found_error_1[(_0x302b64(0x12c))](_0x302b64(0x136));}static async[a273_0x41178e(0x12e)](_0x31e991,_0x58e33b){const _0x4de859=a273_0x41178e,{status:_0x1fac0e}=await RetrieveMetadataService[_0x4de859(0x154)](_0x31e991);if(_0x1fac0e===logger_enums_1[_0x4de859(0x168)][_0x4de859(0x160)])throw new bad_request_error_1[(_0x4de859(0x132))]('Job\x20not\x20completed.');const _0x567bb7=path_1[_0x4de859(0x14a)][_0x4de859(0x158)](RetrieveMetadataService[_0x4de859(0x140)],_0x31e991,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x52db6a={'data':[]};if(await utils_1[_0x4de859(0x164)]['isExistsPath'](path_1[_0x4de859(0x14a)][_0x4de859(0x158)](_0x567bb7,_0x58e33b+'.json')))_0x52db6a[_0x4de859(0x133)]=await(0x0,promises_1['readFile'])(path_1[_0x4de859(0x14a)][_0x4de859(0x158)](_0x567bb7,_0x58e33b+_0x4de859(0x15d)),'utf-8')['then'](JSON[_0x4de859(0x148)]);else throw new not_found_error_1[(_0x4de859(0x12c))]('Chunk\x20not\x20found.');return _0x52db6a;}static async[a273_0x41178e(0x154)](_0x34714a){const _0x290908=a273_0x41178e;try{return await state_manger_1[_0x290908(0x14a)][_0x290908(0x169)](path_1[_0x290908(0x14a)][_0x290908(0x158)](RetrieveMetadataService['retrieveMetadataFolder'],_0x34714a));}catch(_0x296d2f){throw new not_found_error_1[(_0x290908(0x12c))](_0x296d2f);}}static async[a273_0x41178e(0x159)](_0x1ce062){const _0x4ed03b=a273_0x41178e,_0x328e6a=path_1['default'][_0x4ed03b(0x158)](RetrieveMetadataService[_0x4ed03b(0x140)],_0x1ce062,job_1[_0x4ed03b(0x156)]);if(await utils_1['FsUtils'][_0x4ed03b(0x157)](_0x328e6a))return(0x0,promises_1[_0x4ed03b(0x14b)])(_0x328e6a,_0x4ed03b(0x15f))['then'](_0x4fd599=>csv_utils_1[_0x4ed03b(0x14a)][_0x4ed03b(0x148)](_0x4fd599,{'columns':!![]}));throw new not_found_error_1[(_0x4ed03b(0x12c))]('Job\x20log\x20not\x20found.');}}exports[a273_0x41178e(0x14a)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a273_0x41178e(0x14a)]['join'](path_2['dataPath'],constants_1[a273_0x41178e(0x167)]);