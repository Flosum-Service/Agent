const a277_0x38019b=a277_0x3073;(function(_0x5eae61,_0x117eed){const _0x42cb36=a277_0x3073,_0x5ced27=_0x5eae61();while(!![]){try{const _0x3fcb02=-parseInt(_0x42cb36(0xa5))/0x1+parseInt(_0x42cb36(0x99))/0x2+parseInt(_0x42cb36(0x8e))/0x3*(-parseInt(_0x42cb36(0xc7))/0x4)+-parseInt(_0x42cb36(0x97))/0x5*(parseInt(_0x42cb36(0xb2))/0x6)+-parseInt(_0x42cb36(0xa0))/0x7*(parseInt(_0x42cb36(0x92))/0x8)+-parseInt(_0x42cb36(0x8d))/0x9+parseInt(_0x42cb36(0xa3))/0xa*(parseInt(_0x42cb36(0x94))/0xb);if(_0x3fcb02===_0x117eed)break;else _0x5ced27['push'](_0x5ced27['shift']());}catch(_0x29cfb1){_0x5ced27['push'](_0x5ced27['shift']());}}}(a277_0x4999,0x7f132));const a277_0x75e1bc=(function(){let _0x4c4829=!![];return function(_0x24f262,_0x45031a){const _0x57e877=_0x4c4829?function(){const _0x358181=a277_0x3073;if(_0x45031a){const _0x4941c2=_0x45031a[_0x358181(0xa2)](_0x24f262,arguments);return _0x45031a=null,_0x4941c2;}}:function(){};return _0x4c4829=![],_0x57e877;};}()),a277_0x41c66d=a277_0x75e1bc(this,function(){const _0x5f0c6b=a277_0x3073;return a277_0x41c66d[_0x5f0c6b(0xc0)]()['search'](_0x5f0c6b(0xc3))[_0x5f0c6b(0xc0)]()[_0x5f0c6b(0xb1)](a277_0x41c66d)[_0x5f0c6b(0x9b)](_0x5f0c6b(0xc3));});a277_0x41c66d();'use strict';function a277_0x3073(_0x52db9d,_0x2d7fa0){const _0x10b170=a277_0x4999();return a277_0x3073=function(_0x41c66d,_0x75e1bc){_0x41c66d=_0x41c66d-0x88;let _0x4999e7=_0x10b170[_0x41c66d];return _0x4999e7;},a277_0x3073(_0x52db9d,_0x2d7fa0);}var __importDefault=this&&this[a277_0x38019b(0xa8)]||function(_0x49a2f4){const _0x5d70a8=a277_0x38019b;return _0x49a2f4&&_0x49a2f4[_0x5d70a8(0xa6)]?_0x49a2f4:{'default':_0x49a2f4};};Object[a277_0x38019b(0x8c)](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a277_0x38019b(0xa1))),path_1=__importDefault(require(a277_0x38019b(0xba))),manifest_manger_1=__importDefault(require(a277_0x38019b(0x8a))),state_manger_1=__importDefault(require(a277_0x38019b(0x9d))),promises_1=require(a277_0x38019b(0x96)),utils_1=require(a277_0x38019b(0x90)),csv_utils_1=__importDefault(require(a277_0x38019b(0xca))),not_found_error_1=require(a277_0x38019b(0xc2)),logger_enums_1=require(a277_0x38019b(0x9f)),bad_request_error_1=require(a277_0x38019b(0xc5)),job_1=require(a277_0x38019b(0xad)),fs_utils_1=require(a277_0x38019b(0xb8)),constants_1=require(a277_0x38019b(0x9a)),path_2=require(a277_0x38019b(0xab));function a277_0x4999(){const _0x3479dc=['readFile','path','catch','JobStatus','slice','create','createRetrieveJob','toString','RETRIEVE_RESULT_FOLDER_NAME','../../../core/errors/not-found.error','(((.+)+)+)+$','sortJobsIds','../../../core/errors/bad-request.error','parse','4rmxLXj','retrieveMetadataFolder','join','../../shared/utils/csv.utils','Job\x20not\x20completed.','JOB_PATH','../job/classes/manifest-manger','BadRequestError','defineProperty','1733760iNKzRA','2062422WeeCtg','.json','@flosum/utils','init','387336RnHETC','getJobState','31420345cGLUML','RETRIEVE_RESULTS_IDS_FILENAME','fs/promises','969785xfaWOs','NotFoundError','1004268qjZwPq','../constants','search','generateJobId','../../shared/managers/state-manger','default','../../shared/enums/logger.enums','147KjGuYC','../../shared/utils/job.utils','apply','10lCfKNr','runJob','747203TmlAKz','__esModule','FsUtils','__importDefault','IN_PROGRESS','dataPath','../../../configs/path','then','../../../constants/job','getJobsIds','utf-8','Job\x20log\x20not\x20found.','constructor','6SvYJoj','Chunk\x20not\x20found.','getJobs','getJobStatus','isExistsPath','data','../../shared/utils/fs.utils'];a277_0x4999=function(){return _0x3479dc;};return a277_0x4999();}class RetrieveMetadataService{static async[a277_0x38019b(0xb4)](_0x30c701,_0x9b5de5){const _0x1e17ca=a277_0x38019b,_0x54c753=await job_utils_1[_0x1e17ca(0x9e)][_0x1e17ca(0xae)](RetrieveMetadataService[_0x1e17ca(0xc8)]),_0x4d8e41=await job_utils_1[_0x1e17ca(0x9e)][_0x1e17ca(0xc4)](RetrieveMetadataService[_0x1e17ca(0xc8)],_0x54c753),_0x38f586=_0x4d8e41[_0x1e17ca(0xbd)](_0x9b5de5,_0x9b5de5+_0x30c701),_0x374494=[];for(const _0x4dadd8 of _0x38f586){const _0x5e5bb1=await state_manger_1[_0x1e17ca(0x9e)][_0x1e17ca(0x93)](path_1[_0x1e17ca(0x9e)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x4dadd8));_0x374494['push'](_0x5e5bb1);}return _0x374494;}static async[a277_0x38019b(0xbf)](_0x4fa22e){const _0x491b84=a277_0x38019b,_0x22f262=job_utils_1[_0x491b84(0x9e)][_0x491b84(0x9c)](),_0x11685f=path_1[_0x491b84(0x9e)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x22f262);await(0x0,fs_utils_1['makeDir'])(_0x11685f),await manifest_manger_1['default'][_0x491b84(0xbe)](_0x11685f,_0x4fa22e),await state_manger_1[_0x491b84(0x9e)][_0x491b84(0xbe)](_0x11685f,_0x22f262);const _0x4f4f0c=path_1[_0x491b84(0x9e)][_0x491b84(0xc9)](__dirname,job_1[_0x491b84(0x89)]);return job_utils_1['default'][_0x491b84(0xa4)](_0x4f4f0c,{'jobStorePath':_0x11685f,'jobId':_0x22f262})[_0x491b84(0xbb)](async _0x49cc2e=>{const _0x246805=_0x491b84,_0x420a97=new state_manger_1[(_0x246805(0x9e))](_0x11685f);await _0x420a97[_0x246805(0x91)](),await _0x420a97['setError'](_0x49cc2e);}),{'jobId':_0x22f262};}static async['getResult'](_0x2f8574){const _0x1ae444=a277_0x38019b,{status:_0x590288}=await RetrieveMetadataService[_0x1ae444(0xb5)](_0x2f8574);if(_0x590288===logger_enums_1['JobStatus'][_0x1ae444(0xa9)])throw new bad_request_error_1[(_0x1ae444(0x8b))](_0x1ae444(0x88));const _0x1463c8=path_1[_0x1ae444(0x9e)]['join'](RetrieveMetadataService[_0x1ae444(0xc8)],_0x2f8574,constants_1[_0x1ae444(0x95)]);if(await utils_1[_0x1ae444(0xa7)][_0x1ae444(0xb6)](_0x1463c8))return(0x0,promises_1[_0x1ae444(0xb9)])(_0x1463c8,'utf-8')[_0x1ae444(0xac)](JSON['parse']);else throw new not_found_error_1[(_0x1ae444(0x98))]('Result\x20not\x20found.');}static async['getResultChunk'](_0x3ae8dd,_0x2c3daa){const _0x291a5c=a277_0x38019b,{status:_0x4afdeb}=await RetrieveMetadataService[_0x291a5c(0xb5)](_0x3ae8dd);if(_0x4afdeb===logger_enums_1[_0x291a5c(0xbc)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x291a5c(0x8b))](_0x291a5c(0x88));const _0x48899b=path_1[_0x291a5c(0x9e)][_0x291a5c(0xc9)](RetrieveMetadataService[_0x291a5c(0xc8)],_0x3ae8dd,constants_1[_0x291a5c(0xc1)]),_0x1ad444={'data':[]};if(await utils_1[_0x291a5c(0xa7)][_0x291a5c(0xb6)](path_1[_0x291a5c(0x9e)][_0x291a5c(0xc9)](_0x48899b,_0x2c3daa+_0x291a5c(0x8f))))_0x1ad444[_0x291a5c(0xb7)]=await(0x0,promises_1['readFile'])(path_1[_0x291a5c(0x9e)][_0x291a5c(0xc9)](_0x48899b,_0x2c3daa+_0x291a5c(0x8f)),'utf-8')['then'](JSON[_0x291a5c(0xc6)]);else throw new not_found_error_1[(_0x291a5c(0x98))](_0x291a5c(0xb3));return _0x1ad444;}static async[a277_0x38019b(0xb5)](_0x208bf2){const _0x5d463a=a277_0x38019b;try{return await state_manger_1[_0x5d463a(0x9e)][_0x5d463a(0x93)](path_1[_0x5d463a(0x9e)][_0x5d463a(0xc9)](RetrieveMetadataService[_0x5d463a(0xc8)],_0x208bf2));}catch(_0x232bcc){throw new not_found_error_1[(_0x5d463a(0x98))](_0x232bcc);}}static async['getJobLogs'](_0x521ab2){const _0x40c478=a277_0x38019b,_0x1c1e28=path_1[_0x40c478(0x9e)]['join'](RetrieveMetadataService[_0x40c478(0xc8)],_0x521ab2,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1[_0x40c478(0xa7)][_0x40c478(0xb6)](_0x1c1e28))return(0x0,promises_1[_0x40c478(0xb9)])(_0x1c1e28,_0x40c478(0xaf))[_0x40c478(0xac)](_0x5e113e=>csv_utils_1[_0x40c478(0x9e)][_0x40c478(0xc6)](_0x5e113e,{'columns':!![]}));throw new not_found_error_1[(_0x40c478(0x98))](_0x40c478(0xb0));}}exports[a277_0x38019b(0x9e)]=RetrieveMetadataService,RetrieveMetadataService[a277_0x38019b(0xc8)]=path_1[a277_0x38019b(0x9e)]['join'](path_2[a277_0x38019b(0xaa)],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);