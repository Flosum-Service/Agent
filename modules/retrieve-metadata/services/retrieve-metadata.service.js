const a309_0x34d3ad=a309_0x1947;(function(_0xd3a7f,_0x3e62ca){const _0x72ce22=a309_0x1947,_0x36ea3d=_0xd3a7f();while(!![]){try{const _0x369d72=parseInt(_0x72ce22(0xa9))/0x1*(-parseInt(_0x72ce22(0x87))/0x2)+parseInt(_0x72ce22(0x8a))/0x3*(-parseInt(_0x72ce22(0xb9))/0x4)+-parseInt(_0x72ce22(0x86))/0x5*(parseInt(_0x72ce22(0x89))/0x6)+-parseInt(_0x72ce22(0xb6))/0x7*(-parseInt(_0x72ce22(0x97))/0x8)+-parseInt(_0x72ce22(0xa5))/0x9+-parseInt(_0x72ce22(0x85))/0xa*(parseInt(_0x72ce22(0xa3))/0xb)+parseInt(_0x72ce22(0x7c))/0xc;if(_0x369d72===_0x3e62ca)break;else _0x36ea3d['push'](_0x36ea3d['shift']());}catch(_0x51c6f9){_0x36ea3d['push'](_0x36ea3d['shift']());}}}(a309_0x16db,0x1fa86));const a309_0x50cf23=(function(){let _0x22cb83=!![];return function(_0x351e9a,_0x15569a){const _0xf957f7=_0x22cb83?function(){const _0x1ddf5f=a309_0x1947;if(_0x15569a){const _0x297c4a=_0x15569a[_0x1ddf5f(0x8d)](_0x351e9a,arguments);return _0x15569a=null,_0x297c4a;}}:function(){};return _0x22cb83=![],_0xf957f7;};}()),a309_0x333f9d=a309_0x50cf23(this,function(){const _0x4dee48=a309_0x1947;return a309_0x333f9d[_0x4dee48(0x9b)]()[_0x4dee48(0x95)](_0x4dee48(0xb0))['toString']()[_0x4dee48(0xa1)](a309_0x333f9d)['search']('(((.+)+)+)+$');});a309_0x333f9d();function a309_0x16db(){const _0x2e5b4f=['path','__importDefault','../../../core/errors/not-found.error','readFile','7mSHcrS','join','fs/promises','336jKCIVn','getJobsIds','slice','../../../configs/path','data','init','getJobStatus','getResultChunk','11829192uwzzAD','NotFoundError','Job\x20not\x20completed.','JobStatus','runJob','../../shared/enums/logger.enums','createRetrieveJob','parse','RETRIEVE_RESULT_FOLDER_NAME','40dCPmwf','1195895BNSRCS','323870FZcPmV','JOB_PATH','6rrtiYW','6654YHTZjz','IN_PROGRESS','../../shared/utils/csv.utils','apply','then','push','generateJobId','utf-8','../job/classes/manifest-manger','isExistsPath','sortJobsIds','search','retrieveMetadataFolder','264376kxGSWi','makeDir','JOB_LOG_DETAILS_FILENAME','Result\x20not\x20found.','toString','setError','dataPath','BadRequestError','default','.json','constructor','getJobLogs','661837zxGalg','__esModule','549441uRSMij','getResult','create','../../shared/managers/state-manger','1sknbJt','../../shared/utils/fs.utils','getJobState','Job\x20log\x20not\x20found.','FsUtils','defineProperty','getJobs','(((.+)+)+)+$','@flosum/utils'];a309_0x16db=function(){return _0x2e5b4f;};return a309_0x16db();}'use strict';var __importDefault=this&&this[a309_0x34d3ad(0xb3)]||function(_0x1139d0){const _0x186056=a309_0x34d3ad;return _0x1139d0&&_0x1139d0[_0x186056(0xa4)]?_0x1139d0:{'default':_0x1139d0};};function a309_0x1947(_0x2e6fd1,_0x4c603b){const _0xd673ef=a309_0x16db();return a309_0x1947=function(_0x333f9d,_0x50cf23){_0x333f9d=_0x333f9d-0x78;let _0x16db96=_0xd673ef[_0x333f9d];return _0x16db96;},a309_0x1947(_0x2e6fd1,_0x4c603b);}Object[a309_0x34d3ad(0xae)](exports,a309_0x34d3ad(0xa4),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a309_0x34d3ad(0xb2))),manifest_manger_1=__importDefault(require(a309_0x34d3ad(0x92))),state_manger_1=__importDefault(require(a309_0x34d3ad(0xa8))),promises_1=require(a309_0x34d3ad(0xb8)),utils_1=require(a309_0x34d3ad(0xb1)),csv_utils_1=__importDefault(require(a309_0x34d3ad(0x8c))),not_found_error_1=require(a309_0x34d3ad(0xb4)),logger_enums_1=require(a309_0x34d3ad(0x81)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require('../../../constants/job'),fs_utils_1=require(a309_0x34d3ad(0xaa)),constants_1=require('../constants'),path_2=require(a309_0x34d3ad(0xbc));class RetrieveMetadataService{static async[a309_0x34d3ad(0xaf)](_0x585155,_0x34cb69){const _0x47ceb4=a309_0x34d3ad,_0x5709af=await job_utils_1[_0x47ceb4(0x9f)][_0x47ceb4(0xba)](RetrieveMetadataService['retrieveMetadataFolder']),_0x325725=await job_utils_1[_0x47ceb4(0x9f)][_0x47ceb4(0x94)](RetrieveMetadataService['retrieveMetadataFolder'],_0x5709af),_0x18aa2f=_0x325725[_0x47ceb4(0xbb)](_0x34cb69,_0x34cb69+_0x585155),_0x4e3e45=[];for(const _0x16dd40 of _0x18aa2f){const _0x2162a2=await state_manger_1[_0x47ceb4(0x9f)][_0x47ceb4(0xab)](path_1[_0x47ceb4(0x9f)][_0x47ceb4(0xb7)](RetrieveMetadataService['retrieveMetadataFolder'],_0x16dd40));_0x4e3e45[_0x47ceb4(0x8f)](_0x2162a2);}return _0x4e3e45;}static async[a309_0x34d3ad(0x82)](_0x4eaf13){const _0x14bf2d=a309_0x34d3ad,_0x204df3=job_utils_1['default'][_0x14bf2d(0x90)](),_0x5d307e=path_1[_0x14bf2d(0x9f)]['join'](RetrieveMetadataService[_0x14bf2d(0x96)],_0x204df3);await(0x0,fs_utils_1[_0x14bf2d(0x98)])(_0x5d307e),await manifest_manger_1[_0x14bf2d(0x9f)][_0x14bf2d(0xa7)](_0x5d307e,_0x4eaf13),await state_manger_1[_0x14bf2d(0x9f)][_0x14bf2d(0xa7)](_0x5d307e,_0x204df3);const _0x4e7387=path_1[_0x14bf2d(0x9f)][_0x14bf2d(0xb7)](__dirname,job_1[_0x14bf2d(0x88)]);return job_utils_1[_0x14bf2d(0x9f)][_0x14bf2d(0x80)](_0x4e7387,{'jobStorePath':_0x5d307e,'jobId':_0x204df3})['catch'](async _0x32ea44=>{const _0x15d4cb=_0x14bf2d,_0x5310bf=new state_manger_1[(_0x15d4cb(0x9f))](_0x5d307e);await _0x5310bf[_0x15d4cb(0x79)](),await _0x5310bf[_0x15d4cb(0x9c)](_0x32ea44);}),{'jobId':_0x204df3};}static async[a309_0x34d3ad(0xa6)](_0x279c3d){const _0x5a484f=a309_0x34d3ad,{status:_0x1ade45}=await RetrieveMetadataService[_0x5a484f(0x7a)](_0x279c3d);if(_0x1ade45===logger_enums_1[_0x5a484f(0x7f)][_0x5a484f(0x8b)])throw new bad_request_error_1[(_0x5a484f(0x9e))](_0x5a484f(0x7e));const _0x383231=path_1[_0x5a484f(0x9f)]['join'](RetrieveMetadataService[_0x5a484f(0x96)],_0x279c3d,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x5a484f(0xad)][_0x5a484f(0x93)](_0x383231))return(0x0,promises_1[_0x5a484f(0xb5)])(_0x383231,_0x5a484f(0x91))[_0x5a484f(0x8e)](JSON[_0x5a484f(0x83)]);else throw new not_found_error_1['NotFoundError'](_0x5a484f(0x9a));}static async[a309_0x34d3ad(0x7b)](_0x2a61df,_0x62c105){const _0x16aca2=a309_0x34d3ad,{status:_0x17b857}=await RetrieveMetadataService[_0x16aca2(0x7a)](_0x2a61df);if(_0x17b857===logger_enums_1[_0x16aca2(0x7f)][_0x16aca2(0x8b)])throw new bad_request_error_1[(_0x16aca2(0x9e))](_0x16aca2(0x7e));const _0x3fe8ed=path_1[_0x16aca2(0x9f)][_0x16aca2(0xb7)](RetrieveMetadataService[_0x16aca2(0x96)],_0x2a61df,constants_1[_0x16aca2(0x84)]),_0x35f1db={'data':[]};if(await utils_1[_0x16aca2(0xad)][_0x16aca2(0x93)](path_1[_0x16aca2(0x9f)][_0x16aca2(0xb7)](_0x3fe8ed,_0x62c105+'.json')))_0x35f1db[_0x16aca2(0x78)]=await(0x0,promises_1[_0x16aca2(0xb5)])(path_1[_0x16aca2(0x9f)][_0x16aca2(0xb7)](_0x3fe8ed,_0x62c105+_0x16aca2(0xa0)),'utf-8')[_0x16aca2(0x8e)](JSON[_0x16aca2(0x83)]);else throw new not_found_error_1[(_0x16aca2(0x7d))]('Chunk\x20not\x20found.');return _0x35f1db;}static async[a309_0x34d3ad(0x7a)](_0x464464){const _0x122abb=a309_0x34d3ad;try{return await state_manger_1['default'][_0x122abb(0xab)](path_1[_0x122abb(0x9f)]['join'](RetrieveMetadataService[_0x122abb(0x96)],_0x464464));}catch(_0x3e267a){throw new not_found_error_1[(_0x122abb(0x7d))](_0x3e267a);}}static async[a309_0x34d3ad(0xa2)](_0xf25e60){const _0x32d656=a309_0x34d3ad,_0x352c9b=path_1[_0x32d656(0x9f)][_0x32d656(0xb7)](RetrieveMetadataService[_0x32d656(0x96)],_0xf25e60,job_1[_0x32d656(0x99)]);if(await utils_1[_0x32d656(0xad)][_0x32d656(0x93)](_0x352c9b))return(0x0,promises_1[_0x32d656(0xb5)])(_0x352c9b,_0x32d656(0x91))[_0x32d656(0x8e)](_0x2f55bc=>csv_utils_1['default'][_0x32d656(0x83)](_0x2f55bc,{'columns':!![]}));throw new not_found_error_1[(_0x32d656(0x7d))](_0x32d656(0xac));}}exports[a309_0x34d3ad(0x9f)]=RetrieveMetadataService,RetrieveMetadataService[a309_0x34d3ad(0x96)]=path_1[a309_0x34d3ad(0x9f)]['join'](path_2[a309_0x34d3ad(0x9d)],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);