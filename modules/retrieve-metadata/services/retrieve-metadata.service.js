const a320_0x216c0b=a320_0x1ee4;(function(_0x1a963f,_0x5d4c6c){const _0x5cacec=a320_0x1ee4,_0x3655f3=_0x1a963f();while(!![]){try{const _0x1d0951=parseInt(_0x5cacec(0xda))/0x1*(parseInt(_0x5cacec(0xf7))/0x2)+-parseInt(_0x5cacec(0xd1))/0x3+parseInt(_0x5cacec(0xf2))/0x4+parseInt(_0x5cacec(0xe5))/0x5*(-parseInt(_0x5cacec(0xe6))/0x6)+parseInt(_0x5cacec(0xe8))/0x7*(-parseInt(_0x5cacec(0xec))/0x8)+-parseInt(_0x5cacec(0xcf))/0x9*(parseInt(_0x5cacec(0xfa))/0xa)+parseInt(_0x5cacec(0x105))/0xb*(-parseInt(_0x5cacec(0xd6))/0xc);if(_0x1d0951===_0x5d4c6c)break;else _0x3655f3['push'](_0x3655f3['shift']());}catch(_0xbeb559){_0x3655f3['push'](_0x3655f3['shift']());}}}(a320_0x5e04,0xa68c5));const a320_0x311255=(function(){let _0x3b09af=!![];return function(_0x248011,_0x5ad336){const _0xb9763e=_0x3b09af?function(){const _0x5c8799=a320_0x1ee4;if(_0x5ad336){const _0xe05a1f=_0x5ad336[_0x5c8799(0xd3)](_0x248011,arguments);return _0x5ad336=null,_0xe05a1f;}}:function(){};return _0x3b09af=![],_0xb9763e;};}()),a320_0x194d62=a320_0x311255(this,function(){const _0xe85d10=a320_0x1ee4;return a320_0x194d62[_0xe85d10(0x102)]()[_0xe85d10(0xdf)](_0xe85d10(0xfe))[_0xe85d10(0x102)]()['constructor'](a320_0x194d62)['search'](_0xe85d10(0xfe));});a320_0x194d62();function a320_0x1ee4(_0x300cb9,_0x638191){const _0x23a845=a320_0x5e04();return a320_0x1ee4=function(_0x194d62,_0x311255){_0x194d62=_0x194d62-0xc5;let _0x5e04e2=_0x23a845[_0x194d62];return _0x5e04e2;},a320_0x1ee4(_0x300cb9,_0x638191);}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3daa38){return _0x3daa38&&_0x3daa38['__esModule']?_0x3daa38:{'default':_0x3daa38};};Object[a320_0x216c0b(0xc5)](exports,a320_0x216c0b(0xd9),{'value':!![]});const job_utils_1=__importDefault(require(a320_0x216c0b(0xef))),path_1=__importDefault(require(a320_0x216c0b(0xe7))),manifest_manger_1=__importDefault(require(a320_0x216c0b(0xe0))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require(a320_0x216c0b(0xf8)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a320_0x216c0b(0xe3))),not_found_error_1=require(a320_0x216c0b(0xd4)),logger_enums_1=require(a320_0x216c0b(0xdb)),bad_request_error_1=require(a320_0x216c0b(0xe1)),job_1=require(a320_0x216c0b(0xd7)),fs_utils_1=require(a320_0x216c0b(0xd2)),constants_1=require(a320_0x216c0b(0x104)),path_2=require('../../../configs/path');function a320_0x5e04(){const _0x13eba3=['defineProperty','catch','generateJobId','NotFoundError','getResult','BadRequestError','getJobsIds','create','default','setError','18wKucwC','retrieveMetadataFolder','71763XHLnwr','../../shared/utils/fs.utils','apply','../../../core/errors/not-found.error','RETRIEVE_RESULT_FOLDER_NAME','4064748odmcvq','../../../constants/job','parse','__esModule','1bpXIZH','../../shared/enums/logger.enums','push','getJobs','JOB_PATH','search','../job/classes/manifest-manger','../../../core/errors/bad-request.error','join','../../shared/utils/csv.utils','utf-8','1012970rZpyeu','6UrYpzI','path','7fJuXlV','getJobLogs','Job\x20log\x20not\x20found.','sortJobsIds','1770712YoSrIk','.json','RETRIEVE_METADATA_FOLDER_NAME','../../shared/utils/job.utils','Result\x20not\x20found.','dataPath','3797812RxYmxY','Job\x20not\x20completed.','getResultChunk','JOB_LOG_DETAILS_FILENAME','FsUtils','2114094StalHp','fs/promises','isExistsPath','2688680MOopmI','getJobStatus','slice','init','(((.+)+)+)+$','IN_PROGRESS','readFile','JobStatus','toString','data','../constants','11WwxmPQ','createRetrieveJob','makeDir','then'];a320_0x5e04=function(){return _0x13eba3;};return a320_0x5e04();}class RetrieveMetadataService{static async[a320_0x216c0b(0xdd)](_0x1c0652,_0x2c12f6){const _0x3b5422=a320_0x216c0b,_0x3520e8=await job_utils_1[_0x3b5422(0xcd)][_0x3b5422(0xcb)](RetrieveMetadataService['retrieveMetadataFolder']),_0x1d62b8=await job_utils_1[_0x3b5422(0xcd)][_0x3b5422(0xeb)](RetrieveMetadataService['retrieveMetadataFolder'],_0x3520e8),_0x5a6ca6=_0x1d62b8[_0x3b5422(0xfc)](_0x2c12f6,_0x2c12f6+_0x1c0652),_0x1936e7=[];for(const _0x227774 of _0x5a6ca6){const _0x3c3bf7=await state_manger_1[_0x3b5422(0xcd)]['getJobState'](path_1['default'][_0x3b5422(0xe2)](RetrieveMetadataService[_0x3b5422(0xd0)],_0x227774));_0x1936e7[_0x3b5422(0xdc)](_0x3c3bf7);}return _0x1936e7;}static async[a320_0x216c0b(0x106)](_0x254731){const _0x54f294=a320_0x216c0b,_0x212ecc=job_utils_1[_0x54f294(0xcd)][_0x54f294(0xc7)](),_0x2c7c33=path_1[_0x54f294(0xcd)]['join'](RetrieveMetadataService[_0x54f294(0xd0)],_0x212ecc);await(0x0,fs_utils_1[_0x54f294(0x107)])(_0x2c7c33),await manifest_manger_1[_0x54f294(0xcd)][_0x54f294(0xcc)](_0x2c7c33,_0x254731),await state_manger_1['default'][_0x54f294(0xcc)](_0x2c7c33,_0x212ecc);const _0x1a5151=path_1[_0x54f294(0xcd)][_0x54f294(0xe2)](__dirname,job_1[_0x54f294(0xde)]);return job_utils_1[_0x54f294(0xcd)]['runJob'](_0x1a5151,{'jobStorePath':_0x2c7c33,'jobId':_0x212ecc})[_0x54f294(0xc6)](async _0x294210=>{const _0x1192ab=_0x54f294,_0x149eaa=new state_manger_1[(_0x1192ab(0xcd))](_0x2c7c33);await _0x149eaa[_0x1192ab(0xfd)](),await _0x149eaa[_0x1192ab(0xce)](_0x294210);}),{'jobId':_0x212ecc};}static async[a320_0x216c0b(0xc9)](_0x9f8987){const _0x3c6b0b=a320_0x216c0b,{status:_0x22a65e}=await RetrieveMetadataService['getJobStatus'](_0x9f8987);if(_0x22a65e===logger_enums_1[_0x3c6b0b(0x101)][_0x3c6b0b(0xff)])throw new bad_request_error_1[(_0x3c6b0b(0xca))](_0x3c6b0b(0xf3));const _0x431aec=path_1['default'][_0x3c6b0b(0xe2)](RetrieveMetadataService[_0x3c6b0b(0xd0)],_0x9f8987,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1['FsUtils'][_0x3c6b0b(0xf9)](_0x431aec))return(0x0,promises_1['readFile'])(_0x431aec,'utf-8')[_0x3c6b0b(0x108)](JSON['parse']);else throw new not_found_error_1[(_0x3c6b0b(0xc8))](_0x3c6b0b(0xf0));}static async[a320_0x216c0b(0xf4)](_0x3db1de,_0x33cfd9){const _0x21e9b8=a320_0x216c0b,{status:_0x44920d}=await RetrieveMetadataService[_0x21e9b8(0xfb)](_0x3db1de);if(_0x44920d===logger_enums_1[_0x21e9b8(0x101)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x21e9b8(0xca))](_0x21e9b8(0xf3));const _0x798d23=path_1['default'][_0x21e9b8(0xe2)](RetrieveMetadataService['retrieveMetadataFolder'],_0x3db1de,constants_1[_0x21e9b8(0xd5)]),_0x373b41={'data':[]};if(await utils_1[_0x21e9b8(0xf6)][_0x21e9b8(0xf9)](path_1[_0x21e9b8(0xcd)][_0x21e9b8(0xe2)](_0x798d23,_0x33cfd9+_0x21e9b8(0xed))))_0x373b41[_0x21e9b8(0x103)]=await(0x0,promises_1['readFile'])(path_1[_0x21e9b8(0xcd)]['join'](_0x798d23,_0x33cfd9+_0x21e9b8(0xed)),_0x21e9b8(0xe4))[_0x21e9b8(0x108)](JSON[_0x21e9b8(0xd8)]);else throw new not_found_error_1[(_0x21e9b8(0xc8))]('Chunk\x20not\x20found.');return _0x373b41;}static async[a320_0x216c0b(0xfb)](_0x439238){const _0x47666d=a320_0x216c0b;try{return await state_manger_1[_0x47666d(0xcd)]['getJobState'](path_1[_0x47666d(0xcd)][_0x47666d(0xe2)](RetrieveMetadataService[_0x47666d(0xd0)],_0x439238));}catch(_0x4350c3){throw new not_found_error_1[(_0x47666d(0xc8))](_0x4350c3);}}static async[a320_0x216c0b(0xe9)](_0x4640fb){const _0x358676=a320_0x216c0b,_0x5933f9=path_1[_0x358676(0xcd)][_0x358676(0xe2)](RetrieveMetadataService[_0x358676(0xd0)],_0x4640fb,job_1[_0x358676(0xf5)]);if(await utils_1[_0x358676(0xf6)][_0x358676(0xf9)](_0x5933f9))return(0x0,promises_1[_0x358676(0x100)])(_0x5933f9,_0x358676(0xe4))[_0x358676(0x108)](_0x1ac900=>csv_utils_1[_0x358676(0xcd)][_0x358676(0xd8)](_0x1ac900,{'columns':!![]}));throw new not_found_error_1[(_0x358676(0xc8))](_0x358676(0xea));}}exports[a320_0x216c0b(0xcd)]=RetrieveMetadataService,RetrieveMetadataService[a320_0x216c0b(0xd0)]=path_1[a320_0x216c0b(0xcd)]['join'](path_2[a320_0x216c0b(0xf1)],constants_1[a320_0x216c0b(0xee)]);