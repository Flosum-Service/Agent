const a321_0x774551=a321_0x408c;(function(_0xb0451d,_0x29e96c){const _0x35749a=a321_0x408c,_0x2b547c=_0xb0451d();while(!![]){try{const _0x59c18e=-parseInt(_0x35749a(0x182))/0x1*(parseInt(_0x35749a(0x1b7))/0x2)+-parseInt(_0x35749a(0x17c))/0x3+-parseInt(_0x35749a(0x1a2))/0x4+-parseInt(_0x35749a(0x1ac))/0x5*(parseInt(_0x35749a(0x1a8))/0x6)+-parseInt(_0x35749a(0x180))/0x7*(-parseInt(_0x35749a(0x195))/0x8)+-parseInt(_0x35749a(0x190))/0x9*(-parseInt(_0x35749a(0x1b9))/0xa)+parseInt(_0x35749a(0x1b5))/0xb;if(_0x59c18e===_0x29e96c)break;else _0x2b547c['push'](_0x2b547c['shift']());}catch(_0xd18404){_0x2b547c['push'](_0x2b547c['shift']());}}}(a321_0x2c93,0xd428e));function a321_0x408c(_0x2731ca,_0x1e8242){const _0x42b7e7=a321_0x2c93();return a321_0x408c=function(_0x504cf9,_0x225a80){_0x504cf9=_0x504cf9-0x17b;let _0x2c93a9=_0x42b7e7[_0x504cf9];return _0x2c93a9;},a321_0x408c(_0x2731ca,_0x1e8242);}const a321_0x225a80=(function(){let _0x46153c=!![];return function(_0x1341f3,_0x55002f){const _0x16f1e6=_0x46153c?function(){const _0x455336=a321_0x408c;if(_0x55002f){const _0x379faa=_0x55002f[_0x455336(0x1b0)](_0x1341f3,arguments);return _0x55002f=null,_0x379faa;}}:function(){};return _0x46153c=![],_0x16f1e6;};}()),a321_0x504cf9=a321_0x225a80(this,function(){const _0x1bab09=a321_0x408c;return a321_0x504cf9['toString']()[_0x1bab09(0x17d)](_0x1bab09(0x181))['toString']()[_0x1bab09(0x199)](a321_0x504cf9)[_0x1bab09(0x17d)](_0x1bab09(0x181));});a321_0x504cf9();'use strict';var __importDefault=this&&this[a321_0x774551(0x17b)]||function(_0x145a7e){const _0x2ea552=a321_0x774551;return _0x145a7e&&_0x145a7e[_0x2ea552(0x1a0)]?_0x145a7e:{'default':_0x145a7e};};Object[a321_0x774551(0x17f)](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a321_0x774551(0x183))),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require(a321_0x774551(0x1b2))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require(a321_0x774551(0x1a1)),utils_1=require(a321_0x774551(0x1b8)),csv_utils_1=__importDefault(require(a321_0x774551(0x1a9))),not_found_error_1=require(a321_0x774551(0x18d)),logger_enums_1=require(a321_0x774551(0x19d)),bad_request_error_1=require(a321_0x774551(0x1a7)),job_1=require(a321_0x774551(0x19c)),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a321_0x774551(0x189)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a321_0x774551(0x19b)](_0x380fcd,_0x238f8b){const _0x39c369=a321_0x774551,_0x2bfe5c=await job_utils_1[_0x39c369(0x1af)]['getJobsIds'](RetrieveMetadataService[_0x39c369(0x1a5)]),_0x52e276=await job_utils_1[_0x39c369(0x1af)][_0x39c369(0x186)](RetrieveMetadataService[_0x39c369(0x1a5)],_0x2bfe5c),_0x1dafc4=_0x52e276[_0x39c369(0x187)](_0x238f8b,_0x238f8b+_0x380fcd),_0x157da1=[];for(const _0xf0d0d4 of _0x1dafc4){const _0x1eb45b=await state_manger_1[_0x39c369(0x1af)]['getJobState'](path_1[_0x39c369(0x1af)][_0x39c369(0x1ab)](RetrieveMetadataService['retrieveMetadataFolder'],_0xf0d0d4));_0x157da1[_0x39c369(0x1b1)](_0x1eb45b);}return _0x157da1;}static async[a321_0x774551(0x19a)](_0x546394){const _0x183bae=a321_0x774551,_0x76a1bc=job_utils_1['default']['generateJobId'](),_0x2a59e1=path_1[_0x183bae(0x1af)][_0x183bae(0x1ab)](RetrieveMetadataService[_0x183bae(0x1a5)],_0x76a1bc);await(0x0,fs_utils_1[_0x183bae(0x192)])(_0x2a59e1),await manifest_manger_1[_0x183bae(0x1af)][_0x183bae(0x18a)](_0x2a59e1,_0x546394),await state_manger_1[_0x183bae(0x1af)][_0x183bae(0x18a)](_0x2a59e1,_0x76a1bc);const _0x2eb3fc=path_1[_0x183bae(0x1af)][_0x183bae(0x1ab)](__dirname,job_1[_0x183bae(0x19f)]);return job_utils_1['default'][_0x183bae(0x1ae)](_0x2eb3fc,{'jobStorePath':_0x2a59e1,'jobId':_0x76a1bc})[_0x183bae(0x18c)](async _0x1a5b8a=>{const _0x3a8193=_0x183bae,_0x253701=new state_manger_1[(_0x3a8193(0x1af))](_0x2a59e1);await _0x253701['init'](),await _0x253701['setError'](_0x1a5b8a);}),{'jobId':_0x76a1bc};}static async['getResult'](_0x85fdd6){const _0x615b4e=a321_0x774551,{status:_0x1b0166}=await RetrieveMetadataService[_0x615b4e(0x1aa)](_0x85fdd6);if(_0x1b0166===logger_enums_1['JobStatus'][_0x615b4e(0x18f)])throw new bad_request_error_1['BadRequestError'](_0x615b4e(0x1ba));const _0x1f69b5=path_1[_0x615b4e(0x1af)][_0x615b4e(0x1ab)](RetrieveMetadataService['retrieveMetadataFolder'],_0x85fdd6,constants_1[_0x615b4e(0x198)]);if(await utils_1[_0x615b4e(0x185)]['isExistsPath'](_0x1f69b5))return(0x0,promises_1['readFile'])(_0x1f69b5,_0x615b4e(0x188))[_0x615b4e(0x18e)](JSON[_0x615b4e(0x197)]);else throw new not_found_error_1[(_0x615b4e(0x1a4))](_0x615b4e(0x1ad));}static async[a321_0x774551(0x1a6)](_0x264e63,_0x22fdd1){const _0x5343aa=a321_0x774551,{status:_0x412702}=await RetrieveMetadataService[_0x5343aa(0x1aa)](_0x264e63);if(_0x412702===logger_enums_1[_0x5343aa(0x1b4)][_0x5343aa(0x18f)])throw new bad_request_error_1[(_0x5343aa(0x19e))]('Job\x20not\x20completed.');const _0x25ef08=path_1[_0x5343aa(0x1af)]['join'](RetrieveMetadataService[_0x5343aa(0x1a5)],_0x264e63,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x437839={'data':[]};if(await utils_1[_0x5343aa(0x185)][_0x5343aa(0x194)](path_1[_0x5343aa(0x1af)]['join'](_0x25ef08,_0x22fdd1+_0x5343aa(0x1b3))))_0x437839[_0x5343aa(0x193)]=await(0x0,promises_1['readFile'])(path_1[_0x5343aa(0x1af)]['join'](_0x25ef08,_0x22fdd1+_0x5343aa(0x1b3)),_0x5343aa(0x188))[_0x5343aa(0x18e)](JSON['parse']);else throw new not_found_error_1[(_0x5343aa(0x1a4))](_0x5343aa(0x196));return _0x437839;}static async['getJobStatus'](_0x1ec83a){const _0x40dd79=a321_0x774551;try{return await state_manger_1['default']['getJobState'](path_1[_0x40dd79(0x1af)][_0x40dd79(0x1ab)](RetrieveMetadataService[_0x40dd79(0x1a5)],_0x1ec83a));}catch(_0x11822b){throw new not_found_error_1[(_0x40dd79(0x1a4))](_0x11822b);}}static async[a321_0x774551(0x191)](_0x187cb0){const _0xa76f35=a321_0x774551,_0x592731=path_1[_0xa76f35(0x1af)]['join'](RetrieveMetadataService[_0xa76f35(0x1a5)],_0x187cb0,job_1[_0xa76f35(0x1a3)]);if(await utils_1[_0xa76f35(0x185)][_0xa76f35(0x194)](_0x592731))return(0x0,promises_1[_0xa76f35(0x184)])(_0x592731,_0xa76f35(0x188))[_0xa76f35(0x18e)](_0x487506=>csv_utils_1[_0xa76f35(0x1af)]['parse'](_0x487506,{'columns':!![]}));throw new not_found_error_1[(_0xa76f35(0x1a4))](_0xa76f35(0x18b));}}function a321_0x2c93(){const _0x372609=['create','Job\x20log\x20not\x20found.','catch','../../../core/errors/not-found.error','then','IN_PROGRESS','12360303DcXNVH','getJobLogs','makeDir','data','isExistsPath','319416vaafzv','Chunk\x20not\x20found.','parse','RETRIEVE_RESULTS_IDS_FILENAME','constructor','createRetrieveJob','getJobs','../../../constants/job','../../shared/enums/logger.enums','BadRequestError','JOB_PATH','__esModule','fs/promises','5321348ZbupYl','JOB_LOG_DETAILS_FILENAME','NotFoundError','retrieveMetadataFolder','getResultChunk','../../../core/errors/bad-request.error','234TNMffi','../../shared/utils/csv.utils','getJobStatus','join','4045bwdYmN','Result\x20not\x20found.','runJob','default','apply','push','../job/classes/manifest-manger','.json','JobStatus','23303753LWKbYb','dataPath','261746jRXouh','@flosum/utils','10oUjnod','Job\x20not\x20completed.','__importDefault','5140485BuKQuC','search','RETRIEVE_METADATA_FOLDER_NAME','defineProperty','217OrlKPA','(((.+)+)+)+$','6BxzadS','../../shared/utils/job.utils','readFile','FsUtils','sortJobsIds','slice','utf-8','../constants'];a321_0x2c93=function(){return _0x372609;};return a321_0x2c93();}exports['default']=RetrieveMetadataService,RetrieveMetadataService[a321_0x774551(0x1a5)]=path_1['default']['join'](path_2[a321_0x774551(0x1b6)],constants_1[a321_0x774551(0x17e)]);