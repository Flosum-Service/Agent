const a277_0x3d3c4d=a277_0x2ca3;(function(_0x18a743,_0x44381f){const _0x1eaafe=a277_0x2ca3,_0x2e3060=_0x18a743();while(!![]){try{const _0x49885b=-parseInt(_0x1eaafe(0xe4))/0x1+parseInt(_0x1eaafe(0xcc))/0x2+parseInt(_0x1eaafe(0xce))/0x3+-parseInt(_0x1eaafe(0x10d))/0x4+-parseInt(_0x1eaafe(0xf2))/0x5*(parseInt(_0x1eaafe(0xdb))/0x6)+parseInt(_0x1eaafe(0xd8))/0x7*(parseInt(_0x1eaafe(0xf1))/0x8)+parseInt(_0x1eaafe(0xd3))/0x9;if(_0x49885b===_0x44381f)break;else _0x2e3060['push'](_0x2e3060['shift']());}catch(_0x4c6ae0){_0x2e3060['push'](_0x2e3060['shift']());}}}(a277_0x4365,0x40fc9));function a277_0x4365(){const _0x18fc39=['catch','getJobState','getJobs','sortJobsIds','Chunk\x20not\x20found.','FsUtils','getResult','../../../core/errors/bad-request.error','create','RETRIEVE_RESULTS_IDS_FILENAME','Result\x20not\x20found.','@flosum/utils','RETRIEVE_METADATA_FOLDER_NAME','1495136nuAUFZ','Job\x20not\x20completed.','../../../constants/job','runJob','263932KKrscU','__esModule','1084572regGnl','BadRequestError','constructor','../../shared/utils/job.utils','RETRIEVE_RESULT_FOLDER_NAME','543690eyotDw','JOB_PATH','getJobStatus','data','join','12901qPEgpS','NotFoundError','apply','25218HrjAyG','getJobLogs','getResultChunk','JobStatus','makeDir','isExistsPath','../../shared/utils/csv.utils','createRetrieveJob','../../shared/utils/fs.utils','58197WaGnAW','default','../job/classes/manifest-manger','dataPath','utf-8','(((.+)+)+)+$','search','__importDefault','retrieveMetadataFolder','IN_PROGRESS','path','../../../configs/path','getJobsIds','2104bFxjbI','405FWPiQi','toString','push','.json','generateJobId','../constants','init','readFile','../../shared/managers/state-manger','setError','JOB_LOG_DETAILS_FILENAME','parse','then','fs/promises'];a277_0x4365=function(){return _0x18fc39;};return a277_0x4365();}const a277_0x1387a5=(function(){let _0x23bd60=!![];return function(_0x16e148,_0x56e3d8){const _0x54f6a8=_0x23bd60?function(){const _0x16a209=a277_0x2ca3;if(_0x56e3d8){const _0xe1eb57=_0x56e3d8[_0x16a209(0xda)](_0x16e148,arguments);return _0x56e3d8=null,_0xe1eb57;}}:function(){};return _0x23bd60=![],_0x54f6a8;};}()),a277_0x39c5fe=a277_0x1387a5(this,function(){const _0x115051=a277_0x2ca3;return a277_0x39c5fe[_0x115051(0xf3)]()[_0x115051(0xea)](_0x115051(0xe9))['toString']()[_0x115051(0xd0)](a277_0x39c5fe)[_0x115051(0xea)](_0x115051(0xe9));});a277_0x39c5fe();'use strict';var __importDefault=this&&this[a277_0x3d3c4d(0xeb)]||function(_0x57d935){const _0x2781ca=a277_0x3d3c4d;return _0x57d935&&_0x57d935[_0x2781ca(0xcd)]?_0x57d935:{'default':_0x57d935};};Object['defineProperty'](exports,a277_0x3d3c4d(0xcd),{'value':!![]});function a277_0x2ca3(_0x5e12d9,_0x1190f0){const _0x49961d=a277_0x4365();return a277_0x2ca3=function(_0x39c5fe,_0x1387a5){_0x39c5fe=_0x39c5fe-0xcb;let _0x4365ce=_0x49961d[_0x39c5fe];return _0x4365ce;},a277_0x2ca3(_0x5e12d9,_0x1190f0);}const job_utils_1=__importDefault(require(a277_0x3d3c4d(0xd1))),path_1=__importDefault(require(a277_0x3d3c4d(0xee))),manifest_manger_1=__importDefault(require(a277_0x3d3c4d(0xe6))),state_manger_1=__importDefault(require(a277_0x3d3c4d(0xfa))),promises_1=require(a277_0x3d3c4d(0xff)),utils_1=require(a277_0x3d3c4d(0x10b)),csv_utils_1=__importDefault(require(a277_0x3d3c4d(0xe1))),not_found_error_1=require('../../../core/errors/not-found.error'),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require(a277_0x3d3c4d(0x107)),job_1=require(a277_0x3d3c4d(0x10f)),fs_utils_1=require(a277_0x3d3c4d(0xe3)),constants_1=require(a277_0x3d3c4d(0xf7)),path_2=require(a277_0x3d3c4d(0xef));class RetrieveMetadataService{static async[a277_0x3d3c4d(0x102)](_0x22e104,_0x22685b){const _0x5d1574=a277_0x3d3c4d,_0x5a6204=await job_utils_1[_0x5d1574(0xe5)][_0x5d1574(0xf0)](RetrieveMetadataService[_0x5d1574(0xec)]),_0x5f44aa=await job_utils_1['default'][_0x5d1574(0x103)](RetrieveMetadataService[_0x5d1574(0xec)],_0x5a6204),_0x451d1d=_0x5f44aa['slice'](_0x22685b,_0x22685b+_0x22e104),_0x55e1e0=[];for(const _0x54ae0b of _0x451d1d){const _0x348e01=await state_manger_1[_0x5d1574(0xe5)][_0x5d1574(0x101)](path_1[_0x5d1574(0xe5)]['join'](RetrieveMetadataService[_0x5d1574(0xec)],_0x54ae0b));_0x55e1e0[_0x5d1574(0xf4)](_0x348e01);}return _0x55e1e0;}static async[a277_0x3d3c4d(0xe2)](_0x1a6cd8){const _0x9974f4=a277_0x3d3c4d,_0x43afa1=job_utils_1[_0x9974f4(0xe5)][_0x9974f4(0xf6)](),_0x2d8233=path_1[_0x9974f4(0xe5)]['join'](RetrieveMetadataService[_0x9974f4(0xec)],_0x43afa1);await(0x0,fs_utils_1[_0x9974f4(0xdf)])(_0x2d8233),await manifest_manger_1[_0x9974f4(0xe5)][_0x9974f4(0x108)](_0x2d8233,_0x1a6cd8),await state_manger_1[_0x9974f4(0xe5)][_0x9974f4(0x108)](_0x2d8233,_0x43afa1);const _0xb4842c=path_1[_0x9974f4(0xe5)][_0x9974f4(0xd7)](__dirname,job_1[_0x9974f4(0xd4)]);return job_utils_1[_0x9974f4(0xe5)][_0x9974f4(0xcb)](_0xb4842c,{'jobStorePath':_0x2d8233,'jobId':_0x43afa1})[_0x9974f4(0x100)](async _0x4c53d5=>{const _0xa60e30=_0x9974f4,_0x365e89=new state_manger_1[(_0xa60e30(0xe5))](_0x2d8233);await _0x365e89[_0xa60e30(0xf8)](),await _0x365e89[_0xa60e30(0xfb)](_0x4c53d5);}),{'jobId':_0x43afa1};}static async[a277_0x3d3c4d(0x106)](_0x4e930c){const _0x224875=a277_0x3d3c4d,{status:_0x558d85}=await RetrieveMetadataService[_0x224875(0xd5)](_0x4e930c);if(_0x558d85===logger_enums_1[_0x224875(0xde)][_0x224875(0xed)])throw new bad_request_error_1[(_0x224875(0xcf))]('Job\x20not\x20completed.');const _0xa2413b=path_1[_0x224875(0xe5)][_0x224875(0xd7)](RetrieveMetadataService[_0x224875(0xec)],_0x4e930c,constants_1[_0x224875(0x109)]);if(await utils_1[_0x224875(0x105)]['isExistsPath'](_0xa2413b))return(0x0,promises_1[_0x224875(0xf9)])(_0xa2413b,_0x224875(0xe8))[_0x224875(0xfe)](JSON[_0x224875(0xfd)]);else throw new not_found_error_1[(_0x224875(0xd9))](_0x224875(0x10a));}static async[a277_0x3d3c4d(0xdd)](_0x3de1de,_0x20ec12){const _0x5d3655=a277_0x3d3c4d,{status:_0x308221}=await RetrieveMetadataService[_0x5d3655(0xd5)](_0x3de1de);if(_0x308221===logger_enums_1['JobStatus'][_0x5d3655(0xed)])throw new bad_request_error_1[(_0x5d3655(0xcf))](_0x5d3655(0x10e));const _0x5a8186=path_1['default']['join'](RetrieveMetadataService[_0x5d3655(0xec)],_0x3de1de,constants_1[_0x5d3655(0xd2)]),_0x141d36={'data':[]};if(await utils_1[_0x5d3655(0x105)][_0x5d3655(0xe0)](path_1[_0x5d3655(0xe5)]['join'](_0x5a8186,_0x20ec12+'.json')))_0x141d36[_0x5d3655(0xd6)]=await(0x0,promises_1['readFile'])(path_1[_0x5d3655(0xe5)][_0x5d3655(0xd7)](_0x5a8186,_0x20ec12+_0x5d3655(0xf5)),_0x5d3655(0xe8))['then'](JSON['parse']);else throw new not_found_error_1[(_0x5d3655(0xd9))](_0x5d3655(0x104));return _0x141d36;}static async[a277_0x3d3c4d(0xd5)](_0x5e151f){const _0x11500e=a277_0x3d3c4d;try{return await state_manger_1[_0x11500e(0xe5)][_0x11500e(0x101)](path_1[_0x11500e(0xe5)][_0x11500e(0xd7)](RetrieveMetadataService['retrieveMetadataFolder'],_0x5e151f));}catch(_0x3ec12d){throw new not_found_error_1[(_0x11500e(0xd9))](_0x3ec12d);}}static async[a277_0x3d3c4d(0xdc)](_0x25eba5){const _0x5bdfe8=a277_0x3d3c4d,_0x2259f0=path_1['default'][_0x5bdfe8(0xd7)](RetrieveMetadataService['retrieveMetadataFolder'],_0x25eba5,job_1[_0x5bdfe8(0xfc)]);if(await utils_1[_0x5bdfe8(0x105)][_0x5bdfe8(0xe0)](_0x2259f0))return(0x0,promises_1[_0x5bdfe8(0xf9)])(_0x2259f0,_0x5bdfe8(0xe8))['then'](_0x573de0=>csv_utils_1[_0x5bdfe8(0xe5)]['parse'](_0x573de0,{'columns':!![]}));throw new not_found_error_1['NotFoundError']('Job\x20log\x20not\x20found.');}}exports[a277_0x3d3c4d(0xe5)]=RetrieveMetadataService,RetrieveMetadataService[a277_0x3d3c4d(0xec)]=path_1[a277_0x3d3c4d(0xe5)][a277_0x3d3c4d(0xd7)](path_2[a277_0x3d3c4d(0xe7)],constants_1[a277_0x3d3c4d(0x10c)]);