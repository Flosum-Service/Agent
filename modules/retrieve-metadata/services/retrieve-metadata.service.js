const a277_0x2c226c=a277_0x13b9;(function(_0x5f0127,_0x417f5b){const _0x3254ec=a277_0x13b9,_0x5f052e=_0x5f0127();while(!![]){try{const _0x6186cc=-parseInt(_0x3254ec(0xd0))/0x1*(parseInt(_0x3254ec(0xc8))/0x2)+parseInt(_0x3254ec(0xbe))/0x3+parseInt(_0x3254ec(0xd9))/0x4+-parseInt(_0x3254ec(0xbf))/0x5+-parseInt(_0x3254ec(0xc2))/0x6+parseInt(_0x3254ec(0xc1))/0x7*(-parseInt(_0x3254ec(0xc0))/0x8)+-parseInt(_0x3254ec(0xe7))/0x9*(-parseInt(_0x3254ec(0xe4))/0xa);if(_0x6186cc===_0x417f5b)break;else _0x5f052e['push'](_0x5f052e['shift']());}catch(_0x458f1e){_0x5f052e['push'](_0x5f052e['shift']());}}}(a277_0x52b3,0xf0a80));const a277_0x15be42=(function(){let _0x226525=!![];return function(_0x161a04,_0x2cba46){const _0x2d2e2c=_0x226525?function(){const _0x1313aa=a277_0x13b9;if(_0x2cba46){const _0x2995fe=_0x2cba46[_0x1313aa(0xef)](_0x161a04,arguments);return _0x2cba46=null,_0x2995fe;}}:function(){};return _0x226525=![],_0x2d2e2c;};}()),a277_0x4232e8=a277_0x15be42(this,function(){const _0x11b17c=a277_0x13b9;return a277_0x4232e8['toString']()['search'](_0x11b17c(0xee))['toString']()[_0x11b17c(0xbc)](a277_0x4232e8)['search'](_0x11b17c(0xee));});function a277_0x52b3(){const _0x379c17=['isExistsPath','default','../../shared/enums/logger.enums','../../../core/errors/not-found.error','JobStatus','JOB_PATH','23110970NrOUBg','generateJobId','RETRIEVE_RESULTS_IDS_FILENAME','18HCtCCL','NotFoundError','RETRIEVE_METADATA_FOLDER_NAME','getJobs','setError','Result\x20not\x20found.','getJobLogs','(((.+)+)+)+$','apply','fs/promises','getJobStatus','defineProperty','utf-8','getResult','BadRequestError','join','IN_PROGRESS','../../shared/managers/state-manger','../../../core/errors/bad-request.error','readFile','constructor','../job/classes/manifest-manger','960069IJujOv','6225865VMaCRJ','2848288IBRBfF','28JlMCPq','7354038qNQEtI','../../../constants/job','FsUtils','runJob','push','init','862226FayxZh','retrieveMetadataFolder','then','Chunk\x20not\x20found.','../../../configs/path','RETRIEVE_RESULT_FOLDER_NAME','__esModule','catch','2dSPVQI','slice','parse','.json','@flosum/utils','../constants','create','createRetrieveJob','../../shared/utils/job.utils','3202908oxGOKn','getJobState','Job\x20not\x20completed.','JOB_LOG_DETAILS_FILENAME','sortJobsIds'];a277_0x52b3=function(){return _0x379c17;};return a277_0x52b3();}a277_0x4232e8();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x35e227){const _0x256f26=a277_0x13b9;return _0x35e227&&_0x35e227[_0x256f26(0xce)]?_0x35e227:{'default':_0x35e227};};Object[a277_0x2c226c(0xb3)](exports,a277_0x2c226c(0xce),{'value':!![]});const job_utils_1=__importDefault(require(a277_0x2c226c(0xd8))),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require(a277_0x2c226c(0xbd))),state_manger_1=__importDefault(require(a277_0x2c226c(0xb9))),promises_1=require(a277_0x2c226c(0xb1)),utils_1=require(a277_0x2c226c(0xd4)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a277_0x2c226c(0xe1)),logger_enums_1=require(a277_0x2c226c(0xe0)),bad_request_error_1=require(a277_0x2c226c(0xba)),job_1=require(a277_0x2c226c(0xc3)),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a277_0x2c226c(0xd5)),path_2=require(a277_0x2c226c(0xcc));class RetrieveMetadataService{static async[a277_0x2c226c(0xea)](_0x21f801,_0x3c8660){const _0x87278f=a277_0x2c226c,_0x523ce8=await job_utils_1['default']['getJobsIds'](RetrieveMetadataService[_0x87278f(0xc9)]),_0x3e570e=await job_utils_1[_0x87278f(0xdf)][_0x87278f(0xdd)](RetrieveMetadataService[_0x87278f(0xc9)],_0x523ce8),_0xbf0593=_0x3e570e[_0x87278f(0xd1)](_0x3c8660,_0x3c8660+_0x21f801),_0x53d26e=[];for(const _0x59c387 of _0xbf0593){const _0x50ab5e=await state_manger_1['default'][_0x87278f(0xda)](path_1[_0x87278f(0xdf)]['join'](RetrieveMetadataService[_0x87278f(0xc9)],_0x59c387));_0x53d26e[_0x87278f(0xc6)](_0x50ab5e);}return _0x53d26e;}static async[a277_0x2c226c(0xd7)](_0x30d0f7){const _0x1a5b89=a277_0x2c226c,_0x3d6d0a=job_utils_1[_0x1a5b89(0xdf)][_0x1a5b89(0xe5)](),_0x3acd2d=path_1[_0x1a5b89(0xdf)][_0x1a5b89(0xb7)](RetrieveMetadataService['retrieveMetadataFolder'],_0x3d6d0a);await(0x0,fs_utils_1['makeDir'])(_0x3acd2d),await manifest_manger_1[_0x1a5b89(0xdf)][_0x1a5b89(0xd6)](_0x3acd2d,_0x30d0f7),await state_manger_1[_0x1a5b89(0xdf)][_0x1a5b89(0xd6)](_0x3acd2d,_0x3d6d0a);const _0xce362a=path_1['default'][_0x1a5b89(0xb7)](__dirname,job_1[_0x1a5b89(0xe3)]);return job_utils_1[_0x1a5b89(0xdf)][_0x1a5b89(0xc5)](_0xce362a,{'jobStorePath':_0x3acd2d,'jobId':_0x3d6d0a})[_0x1a5b89(0xcf)](async _0xa2327=>{const _0x391b39=_0x1a5b89,_0xc8b2c4=new state_manger_1[(_0x391b39(0xdf))](_0x3acd2d);await _0xc8b2c4[_0x391b39(0xc7)](),await _0xc8b2c4[_0x391b39(0xeb)](_0xa2327);}),{'jobId':_0x3d6d0a};}static async[a277_0x2c226c(0xb5)](_0x1f63b5){const _0xa2c234=a277_0x2c226c,{status:_0x1aaf99}=await RetrieveMetadataService[_0xa2c234(0xb2)](_0x1f63b5);if(_0x1aaf99===logger_enums_1[_0xa2c234(0xe2)][_0xa2c234(0xb8)])throw new bad_request_error_1['BadRequestError'](_0xa2c234(0xdb));const _0x275715=path_1[_0xa2c234(0xdf)][_0xa2c234(0xb7)](RetrieveMetadataService[_0xa2c234(0xc9)],_0x1f63b5,constants_1[_0xa2c234(0xe6)]);if(await utils_1[_0xa2c234(0xc4)][_0xa2c234(0xde)](_0x275715))return(0x0,promises_1[_0xa2c234(0xbb)])(_0x275715,_0xa2c234(0xb4))[_0xa2c234(0xca)](JSON[_0xa2c234(0xd2)]);else throw new not_found_error_1['NotFoundError'](_0xa2c234(0xec));}static async['getResultChunk'](_0x45cf9f,_0x5cfddf){const _0x586d60=a277_0x2c226c,{status:_0x3f85d0}=await RetrieveMetadataService[_0x586d60(0xb2)](_0x45cf9f);if(_0x3f85d0===logger_enums_1[_0x586d60(0xe2)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x586d60(0xb6))](_0x586d60(0xdb));const _0x4d10b7=path_1[_0x586d60(0xdf)]['join'](RetrieveMetadataService[_0x586d60(0xc9)],_0x45cf9f,constants_1[_0x586d60(0xcd)]),_0x1cfadf={'data':[]};if(await utils_1[_0x586d60(0xc4)][_0x586d60(0xde)](path_1[_0x586d60(0xdf)][_0x586d60(0xb7)](_0x4d10b7,_0x5cfddf+_0x586d60(0xd3))))_0x1cfadf['data']=await(0x0,promises_1[_0x586d60(0xbb)])(path_1[_0x586d60(0xdf)][_0x586d60(0xb7)](_0x4d10b7,_0x5cfddf+'.json'),_0x586d60(0xb4))[_0x586d60(0xca)](JSON[_0x586d60(0xd2)]);else throw new not_found_error_1[(_0x586d60(0xe8))](_0x586d60(0xcb));return _0x1cfadf;}static async[a277_0x2c226c(0xb2)](_0xf5cb0c){const _0x12a55c=a277_0x2c226c;try{return await state_manger_1[_0x12a55c(0xdf)][_0x12a55c(0xda)](path_1[_0x12a55c(0xdf)][_0x12a55c(0xb7)](RetrieveMetadataService['retrieveMetadataFolder'],_0xf5cb0c));}catch(_0x4de7a7){throw new not_found_error_1[(_0x12a55c(0xe8))](_0x4de7a7);}}static async[a277_0x2c226c(0xed)](_0x2654ea){const _0x17ac45=a277_0x2c226c,_0x3360a6=path_1[_0x17ac45(0xdf)]['join'](RetrieveMetadataService[_0x17ac45(0xc9)],_0x2654ea,job_1[_0x17ac45(0xdc)]);if(await utils_1['FsUtils']['isExistsPath'](_0x3360a6))return(0x0,promises_1['readFile'])(_0x3360a6,_0x17ac45(0xb4))[_0x17ac45(0xca)](_0x352bca=>csv_utils_1['default'][_0x17ac45(0xd2)](_0x352bca,{'columns':!![]}));throw new not_found_error_1[(_0x17ac45(0xe8))]('Job\x20log\x20not\x20found.');}}function a277_0x13b9(_0x2b613a,_0x864bba){const _0x17e2a8=a277_0x52b3();return a277_0x13b9=function(_0x4232e8,_0x15be42){_0x4232e8=_0x4232e8-0xb1;let _0x52b36b=_0x17e2a8[_0x4232e8];return _0x52b36b;},a277_0x13b9(_0x2b613a,_0x864bba);}exports[a277_0x2c226c(0xdf)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1['default'][a277_0x2c226c(0xb7)](path_2['dataPath'],constants_1[a277_0x2c226c(0xe9)]);