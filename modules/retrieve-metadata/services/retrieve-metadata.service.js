const a273_0x31c25d=a273_0x5c5f;(function(_0x509ac3,_0x225196){const _0xb15f32=a273_0x5c5f,_0x20de54=_0x509ac3();while(!![]){try{const _0x530a0c=parseInt(_0xb15f32(0x120))/0x1+-parseInt(_0xb15f32(0x133))/0x2*(parseInt(_0xb15f32(0x12b))/0x3)+parseInt(_0xb15f32(0x13b))/0x4+-parseInt(_0xb15f32(0x138))/0x5+-parseInt(_0xb15f32(0x14e))/0x6+-parseInt(_0xb15f32(0x121))/0x7*(parseInt(_0xb15f32(0x139))/0x8)+parseInt(_0xb15f32(0x145))/0x9;if(_0x530a0c===_0x225196)break;else _0x20de54['push'](_0x20de54['shift']());}catch(_0x343c3d){_0x20de54['push'](_0x20de54['shift']());}}}(a273_0x35e5,0x5e410));function a273_0x5c5f(_0x1d2579,_0x4a41c6){const _0x72ffdd=a273_0x35e5();return a273_0x5c5f=function(_0x1d99e2,_0x3b10f7){_0x1d99e2=_0x1d99e2-0x11e;let _0x35e545=_0x72ffdd[_0x1d99e2];return _0x35e545;},a273_0x5c5f(_0x1d2579,_0x4a41c6);}const a273_0x3b10f7=(function(){let _0x33f823=!![];return function(_0x50a15e,_0x29089e){const _0x8327c9=_0x33f823?function(){const _0x2dc2de=a273_0x5c5f;if(_0x29089e){const _0xa75037=_0x29089e[_0x2dc2de(0x12a)](_0x50a15e,arguments);return _0x29089e=null,_0xa75037;}}:function(){};return _0x33f823=![],_0x8327c9;};}()),a273_0x1d99e2=a273_0x3b10f7(this,function(){const _0x526b4e=a273_0x5c5f;return a273_0x1d99e2[_0x526b4e(0x134)]()[_0x526b4e(0x12f)](_0x526b4e(0x132))[_0x526b4e(0x134)]()[_0x526b4e(0x14b)](a273_0x1d99e2)[_0x526b4e(0x12f)](_0x526b4e(0x132));});function a273_0x35e5(){const _0x29fb8=['Job\x20log\x20not\x20found.','join','../../shared/utils/csv.utils','path','constructor','@flosum/utils','NotFoundError','3919668jGPZTy','readFile','utf-8','getJobsIds','.json','dataPath','getResultChunk','JobStatus','makeDir','IN_PROGRESS','getJobStatus','catch','474199Juxyng','7hqilEr','init','../../shared/utils/fs.utils','push','then','FsUtils','Chunk\x20not\x20found.','getJobState','runJob','apply','838818qhuZGw','../../shared/utils/job.utils','slice','isExistsPath','search','parse','../../../constants/job','(((.+)+)+)+$','4rMfaRx','toString','RETRIEVE_METADATA_FOLDER_NAME','retrieveMetadataFolder','sortJobsIds','3100070RlWpGs','576592xCDghh','JOB_LOG_DETAILS_FILENAME','1516764brlPey','generateJobId','default','../job/enums/logger.enums','Job\x20not\x20completed.','RETRIEVE_RESULT_FOLDER_NAME','Result\x20not\x20found.','getJobLogs','../constants','getJobs','12935268xtssLA','JOB_PATH'];a273_0x35e5=function(){return _0x29fb8;};return a273_0x35e5();}a273_0x1d99e2();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x84a0cd){return _0x84a0cd&&_0x84a0cd['__esModule']?_0x84a0cd:{'default':_0x84a0cd};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a273_0x31c25d(0x12c))),path_1=__importDefault(require(a273_0x31c25d(0x14a))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require('../job/classes/state-manger')),promises_1=require('fs/promises'),utils_1=require(a273_0x31c25d(0x14c)),csv_utils_1=__importDefault(require(a273_0x31c25d(0x149))),not_found_error_1=require('../../../core/errors/not-found.error'),logger_enums_1=require(a273_0x31c25d(0x13e)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require(a273_0x31c25d(0x131)),fs_utils_1=require(a273_0x31c25d(0x123)),constants_1=require(a273_0x31c25d(0x143)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a273_0x31c25d(0x144)](_0x28b434,_0x268514){const _0xc7ccdc=a273_0x31c25d,_0x3ffa4e=await job_utils_1[_0xc7ccdc(0x13d)][_0xc7ccdc(0x151)](RetrieveMetadataService[_0xc7ccdc(0x136)]),_0x990246=await job_utils_1[_0xc7ccdc(0x13d)][_0xc7ccdc(0x137)](RetrieveMetadataService[_0xc7ccdc(0x136)],_0x3ffa4e),_0xb9da5=_0x990246[_0xc7ccdc(0x12d)](_0x268514,_0x268514+_0x28b434),_0x3ed81d=[];for(const _0x3b3b18 of _0xb9da5){const _0x251b0f=await state_manger_1['default'][_0xc7ccdc(0x128)](path_1['default']['join'](RetrieveMetadataService[_0xc7ccdc(0x136)],_0x3b3b18));_0x3ed81d[_0xc7ccdc(0x124)](_0x251b0f);}return _0x3ed81d;}static async['createRetrieveJob'](_0x2b8b7f){const _0x5b7e39=a273_0x31c25d,_0x23ba23=job_utils_1[_0x5b7e39(0x13d)][_0x5b7e39(0x13c)](),_0x2a56b8=path_1[_0x5b7e39(0x13d)][_0x5b7e39(0x148)](RetrieveMetadataService[_0x5b7e39(0x136)],_0x23ba23);await(0x0,fs_utils_1[_0x5b7e39(0x156)])(_0x2a56b8),await manifest_manger_1[_0x5b7e39(0x13d)]['create'](_0x2a56b8,_0x2b8b7f),await state_manger_1[_0x5b7e39(0x13d)]['create'](_0x2a56b8,_0x23ba23);const _0x1c0122=path_1[_0x5b7e39(0x13d)][_0x5b7e39(0x148)](__dirname,job_1[_0x5b7e39(0x146)]);return job_utils_1[_0x5b7e39(0x13d)][_0x5b7e39(0x129)](_0x1c0122,{'jobStorePath':_0x2a56b8,'jobId':_0x23ba23})[_0x5b7e39(0x11f)](async _0x4597fc=>{const _0x4a926c=_0x5b7e39,_0xbc600b=new state_manger_1[(_0x4a926c(0x13d))](_0x2a56b8);await _0xbc600b[_0x4a926c(0x122)](),await _0xbc600b['setError'](_0x4597fc);}),{'jobId':_0x23ba23};}static async['getResult'](_0xa48e6f){const _0x256d98=a273_0x31c25d,{status:_0x273339}=await RetrieveMetadataService['getJobStatus'](_0xa48e6f);if(_0x273339===logger_enums_1[_0x256d98(0x155)][_0x256d98(0x157)])throw new bad_request_error_1['BadRequestError'](_0x256d98(0x13f));const _0x197d48=path_1['default']['join'](RetrieveMetadataService[_0x256d98(0x136)],_0xa48e6f,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1['FsUtils'][_0x256d98(0x12e)](_0x197d48))return(0x0,promises_1['readFile'])(_0x197d48,_0x256d98(0x150))['then'](JSON['parse']);else throw new not_found_error_1[(_0x256d98(0x14d))](_0x256d98(0x141));}static async[a273_0x31c25d(0x154)](_0x2ae72c,_0x11377f){const _0xee241b=a273_0x31c25d,{status:_0x24e73e}=await RetrieveMetadataService[_0xee241b(0x11e)](_0x2ae72c);if(_0x24e73e===logger_enums_1[_0xee241b(0x155)][_0xee241b(0x157)])throw new bad_request_error_1['BadRequestError']('Job\x20not\x20completed.');const _0x2db934=path_1[_0xee241b(0x13d)]['join'](RetrieveMetadataService[_0xee241b(0x136)],_0x2ae72c,constants_1[_0xee241b(0x140)]),_0x10a460={'data':[]};if(await utils_1[_0xee241b(0x126)][_0xee241b(0x12e)](path_1[_0xee241b(0x13d)]['join'](_0x2db934,_0x11377f+_0xee241b(0x152))))_0x10a460['data']=await(0x0,promises_1[_0xee241b(0x14f)])(path_1[_0xee241b(0x13d)][_0xee241b(0x148)](_0x2db934,_0x11377f+_0xee241b(0x152)),_0xee241b(0x150))['then'](JSON[_0xee241b(0x130)]);else throw new not_found_error_1[(_0xee241b(0x14d))](_0xee241b(0x127));return _0x10a460;}static async['getJobStatus'](_0x3ea3d5){const _0x52eb32=a273_0x31c25d;try{return await state_manger_1[_0x52eb32(0x13d)][_0x52eb32(0x128)](path_1['default']['join'](RetrieveMetadataService[_0x52eb32(0x136)],_0x3ea3d5));}catch(_0x20c221){throw new not_found_error_1[(_0x52eb32(0x14d))](_0x20c221);}}static async[a273_0x31c25d(0x142)](_0x4cc8b7){const _0x5a4d44=a273_0x31c25d,_0x30c61c=path_1['default'][_0x5a4d44(0x148)](RetrieveMetadataService[_0x5a4d44(0x136)],_0x4cc8b7,job_1[_0x5a4d44(0x13a)]);if(await utils_1[_0x5a4d44(0x126)][_0x5a4d44(0x12e)](_0x30c61c))return(0x0,promises_1[_0x5a4d44(0x14f)])(_0x30c61c,_0x5a4d44(0x150))[_0x5a4d44(0x125)](_0x537e72=>csv_utils_1[_0x5a4d44(0x13d)][_0x5a4d44(0x130)](_0x537e72,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x5a4d44(0x147));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a273_0x31c25d(0x13d)][a273_0x31c25d(0x148)](path_2[a273_0x31c25d(0x153)],constants_1[a273_0x31c25d(0x135)]);