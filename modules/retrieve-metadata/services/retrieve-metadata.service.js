const a319_0x59ab7d=a319_0x1a65;(function(_0x266733,_0x92da63){const _0x3edfb5=a319_0x1a65,_0x24854c=_0x266733();while(!![]){try{const _0x18ead9=parseInt(_0x3edfb5(0xc8))/0x1*(parseInt(_0x3edfb5(0xd5))/0x2)+parseInt(_0x3edfb5(0xb7))/0x3*(-parseInt(_0x3edfb5(0xd2))/0x4)+-parseInt(_0x3edfb5(0xd8))/0x5*(-parseInt(_0x3edfb5(0xcc))/0x6)+-parseInt(_0x3edfb5(0xd6))/0x7+parseInt(_0x3edfb5(0xa2))/0x8*(parseInt(_0x3edfb5(0xc7))/0x9)+parseInt(_0x3edfb5(0xa7))/0xa*(parseInt(_0x3edfb5(0xc1))/0xb)+-parseInt(_0x3edfb5(0xe0))/0xc*(parseInt(_0x3edfb5(0xa4))/0xd);if(_0x18ead9===_0x92da63)break;else _0x24854c['push'](_0x24854c['shift']());}catch(_0x3ad8cc){_0x24854c['push'](_0x24854c['shift']());}}}(a319_0x4e6f,0x265dd));function a319_0x4e6f(){const _0xa14d27=['6564ZzlgpI','IN_PROGRESS','runJob','../../shared/utils/job.utils','76128qyZReM','BadRequestError','7033HtfLNy','createRetrieveJob','Job\x20not\x20completed.','310ZUJfKz','getResult','toString','../../../configs/path','retrieveMetadataFolder','FsUtils','__importDefault','RETRIEVE_RESULTS_IDS_FILENAME','push','getJobLogs','NotFoundError','search','RETRIEVE_METADATA_FOLDER_NAME','parse','generateJobId','getResultChunk','6QwsBQe','path','join','../../shared/managers/state-manger','utf-8','../../../core/errors/bad-request.error','__esModule','default','getJobState','../../../core/errors/not-found.error','10549iLpGyc','RETRIEVE_RESULT_FOLDER_NAME','then','catch','Chunk\x20not\x20found.','makeDir','153WvUida','39763tMZcup','../../shared/utils/csv.utils','getJobs','sortJobsIds','1614yYjPUx','(((.+)+)+)+$','JOB_LOG_DETAILS_FILENAME','JobStatus','readFile','slice','48388fLONMB','@flosum/utils','../../shared/enums/logger.enums','10OkeADl','1076607jZIDbu','dataPath','4475XpTRMC','getJobStatus','create','../constants','isExistsPath','setError','../job/classes/manifest-manger','.json'];a319_0x4e6f=function(){return _0xa14d27;};return a319_0x4e6f();}const a319_0x4ea500=(function(){let _0xc2c49=!![];return function(_0x208f74,_0x3b4669){const _0x3a6408=_0xc2c49?function(){if(_0x3b4669){const _0x28224d=_0x3b4669['apply'](_0x208f74,arguments);return _0x3b4669=null,_0x28224d;}}:function(){};return _0xc2c49=![],_0x3a6408;};}()),a319_0x3ebdbf=a319_0x4ea500(this,function(){const _0x41af12=a319_0x1a65;return a319_0x3ebdbf['toString']()[_0x41af12(0xb2)](_0x41af12(0xcd))[_0x41af12(0xa9)]()['constructor'](a319_0x3ebdbf)[_0x41af12(0xb2)](_0x41af12(0xcd));});a319_0x3ebdbf();'use strict';function a319_0x1a65(_0x11791f,_0x243e38){const _0x5afd56=a319_0x4e6f();return a319_0x1a65=function(_0x3ebdbf,_0x4ea500){_0x3ebdbf=_0x3ebdbf-0x9f;let _0x4e6f58=_0x5afd56[_0x3ebdbf];return _0x4e6f58;},a319_0x1a65(_0x11791f,_0x243e38);}var __importDefault=this&&this[a319_0x59ab7d(0xad)]||function(_0x42883b){return _0x42883b&&_0x42883b['__esModule']?_0x42883b:{'default':_0x42883b};};Object['defineProperty'](exports,a319_0x59ab7d(0xbd),{'value':!![]});const job_utils_1=__importDefault(require(a319_0x59ab7d(0xa1))),path_1=__importDefault(require(a319_0x59ab7d(0xb8))),manifest_manger_1=__importDefault(require(a319_0x59ab7d(0xde))),state_manger_1=__importDefault(require(a319_0x59ab7d(0xba))),promises_1=require('fs/promises'),utils_1=require(a319_0x59ab7d(0xd3)),csv_utils_1=__importDefault(require(a319_0x59ab7d(0xc9))),not_found_error_1=require(a319_0x59ab7d(0xc0)),logger_enums_1=require(a319_0x59ab7d(0xd4)),bad_request_error_1=require(a319_0x59ab7d(0xbc)),job_1=require('../../../constants/job'),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a319_0x59ab7d(0xdb)),path_2=require(a319_0x59ab7d(0xaa));class RetrieveMetadataService{static async[a319_0x59ab7d(0xca)](_0x59f69e,_0x1f5b95){const _0x2f2af9=a319_0x59ab7d,_0xd56b3b=await job_utils_1[_0x2f2af9(0xbe)]['getJobsIds'](RetrieveMetadataService[_0x2f2af9(0xab)]),_0x5dab5a=await job_utils_1[_0x2f2af9(0xbe)][_0x2f2af9(0xcb)](RetrieveMetadataService[_0x2f2af9(0xab)],_0xd56b3b),_0x32d2b6=_0x5dab5a[_0x2f2af9(0xd1)](_0x1f5b95,_0x1f5b95+_0x59f69e),_0x1ea2c8=[];for(const _0x37d7bf of _0x32d2b6){const _0x1ca4fd=await state_manger_1[_0x2f2af9(0xbe)][_0x2f2af9(0xbf)](path_1[_0x2f2af9(0xbe)][_0x2f2af9(0xb9)](RetrieveMetadataService['retrieveMetadataFolder'],_0x37d7bf));_0x1ea2c8[_0x2f2af9(0xaf)](_0x1ca4fd);}return _0x1ea2c8;}static async[a319_0x59ab7d(0xa5)](_0x5755aa){const _0x1856bd=a319_0x59ab7d,_0x355daf=job_utils_1[_0x1856bd(0xbe)][_0x1856bd(0xb5)](),_0x31a9f2=path_1['default'][_0x1856bd(0xb9)](RetrieveMetadataService['retrieveMetadataFolder'],_0x355daf);await(0x0,fs_utils_1[_0x1856bd(0xc6)])(_0x31a9f2),await manifest_manger_1[_0x1856bd(0xbe)][_0x1856bd(0xda)](_0x31a9f2,_0x5755aa),await state_manger_1[_0x1856bd(0xbe)][_0x1856bd(0xda)](_0x31a9f2,_0x355daf);const _0x51676f=path_1[_0x1856bd(0xbe)][_0x1856bd(0xb9)](__dirname,job_1['JOB_PATH']);return job_utils_1['default'][_0x1856bd(0xa0)](_0x51676f,{'jobStorePath':_0x31a9f2,'jobId':_0x355daf})[_0x1856bd(0xc4)](async _0x578b79=>{const _0x495e8b=_0x1856bd,_0x460180=new state_manger_1[(_0x495e8b(0xbe))](_0x31a9f2);await _0x460180['init'](),await _0x460180[_0x495e8b(0xdd)](_0x578b79);}),{'jobId':_0x355daf};}static async[a319_0x59ab7d(0xa8)](_0x4a8dac){const _0x38dad4=a319_0x59ab7d,{status:_0x792ba2}=await RetrieveMetadataService[_0x38dad4(0xd9)](_0x4a8dac);if(_0x792ba2===logger_enums_1[_0x38dad4(0xcf)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x38dad4(0xa3))]('Job\x20not\x20completed.');const _0x13abdb=path_1[_0x38dad4(0xbe)][_0x38dad4(0xb9)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4a8dac,constants_1[_0x38dad4(0xae)]);if(await utils_1[_0x38dad4(0xac)][_0x38dad4(0xdc)](_0x13abdb))return(0x0,promises_1[_0x38dad4(0xd0)])(_0x13abdb,_0x38dad4(0xbb))['then'](JSON['parse']);else throw new not_found_error_1['NotFoundError']('Result\x20not\x20found.');}static async[a319_0x59ab7d(0xb6)](_0x1cab4d,_0x102c65){const _0x185f1a=a319_0x59ab7d,{status:_0xca654e}=await RetrieveMetadataService[_0x185f1a(0xd9)](_0x1cab4d);if(_0xca654e===logger_enums_1[_0x185f1a(0xcf)][_0x185f1a(0x9f)])throw new bad_request_error_1[(_0x185f1a(0xa3))](_0x185f1a(0xa6));const _0xd4324e=path_1[_0x185f1a(0xbe)]['join'](RetrieveMetadataService[_0x185f1a(0xab)],_0x1cab4d,constants_1[_0x185f1a(0xc2)]),_0xd62096={'data':[]};if(await utils_1[_0x185f1a(0xac)]['isExistsPath'](path_1[_0x185f1a(0xbe)]['join'](_0xd4324e,_0x102c65+_0x185f1a(0xdf))))_0xd62096['data']=await(0x0,promises_1[_0x185f1a(0xd0)])(path_1[_0x185f1a(0xbe)][_0x185f1a(0xb9)](_0xd4324e,_0x102c65+_0x185f1a(0xdf)),_0x185f1a(0xbb))[_0x185f1a(0xc3)](JSON['parse']);else throw new not_found_error_1[(_0x185f1a(0xb1))](_0x185f1a(0xc5));return _0xd62096;}static async[a319_0x59ab7d(0xd9)](_0x4de952){const _0x26a61f=a319_0x59ab7d;try{return await state_manger_1[_0x26a61f(0xbe)][_0x26a61f(0xbf)](path_1['default'][_0x26a61f(0xb9)](RetrieveMetadataService[_0x26a61f(0xab)],_0x4de952));}catch(_0x2a99d3){throw new not_found_error_1[(_0x26a61f(0xb1))](_0x2a99d3);}}static async[a319_0x59ab7d(0xb0)](_0x647ff8){const _0x33a472=a319_0x59ab7d,_0x5e84b6=path_1[_0x33a472(0xbe)][_0x33a472(0xb9)](RetrieveMetadataService['retrieveMetadataFolder'],_0x647ff8,job_1[_0x33a472(0xce)]);if(await utils_1[_0x33a472(0xac)]['isExistsPath'](_0x5e84b6))return(0x0,promises_1['readFile'])(_0x5e84b6,_0x33a472(0xbb))[_0x33a472(0xc3)](_0x4f97b8=>csv_utils_1['default'][_0x33a472(0xb4)](_0x4f97b8,{'columns':!![]}));throw new not_found_error_1['NotFoundError']('Job\x20log\x20not\x20found.');}}exports[a319_0x59ab7d(0xbe)]=RetrieveMetadataService,RetrieveMetadataService[a319_0x59ab7d(0xab)]=path_1[a319_0x59ab7d(0xbe)]['join'](path_2[a319_0x59ab7d(0xd7)],constants_1[a319_0x59ab7d(0xb3)]);