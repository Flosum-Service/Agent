const a274_0x10532d=a274_0x1298;(function(_0x1a8eba,_0x8cdc73){const _0xf9f423=a274_0x1298,_0x2671fe=_0x1a8eba();while(!![]){try{const _0x4a17a9=parseInt(_0xf9f423(0xf7))/0x1+-parseInt(_0xf9f423(0x102))/0x2*(parseInt(_0xf9f423(0x118))/0x3)+parseInt(_0xf9f423(0x12c))/0x4*(parseInt(_0xf9f423(0x115))/0x5)+-parseInt(_0xf9f423(0xf6))/0x6+-parseInt(_0xf9f423(0xf0))/0x7*(parseInt(_0xf9f423(0xf5))/0x8)+parseInt(_0xf9f423(0x113))/0x9*(-parseInt(_0xf9f423(0x10f))/0xa)+parseInt(_0xf9f423(0xeb))/0xb;if(_0x4a17a9===_0x8cdc73)break;else _0x2671fe['push'](_0x2671fe['shift']());}catch(_0x468d60){_0x2671fe['push'](_0x2671fe['shift']());}}}(a274_0x18c5,0x78726));const a274_0x2eddcf=(function(){let _0x5e4676=!![];return function(_0x371a00,_0x1e6986){const _0xb46265=_0x5e4676?function(){const _0x1fb510=a274_0x1298;if(_0x1e6986){const _0x162d3d=_0x1e6986[_0x1fb510(0xfb)](_0x371a00,arguments);return _0x1e6986=null,_0x162d3d;}}:function(){};return _0x5e4676=![],_0xb46265;};}()),a274_0x56ab5b=a274_0x2eddcf(this,function(){const _0x591078=a274_0x1298;return a274_0x56ab5b['toString']()[_0x591078(0x112)](_0x591078(0x117))['toString']()[_0x591078(0x11d)](a274_0x56ab5b)[_0x591078(0x112)](_0x591078(0x117));});a274_0x56ab5b();function a274_0x1298(_0x442418,_0x4a5189){const _0x3b8ba8=a274_0x18c5();return a274_0x1298=function(_0x56ab5b,_0x2eddcf){_0x56ab5b=_0x56ab5b-0xea;let _0x18c54a=_0x3b8ba8[_0x56ab5b];return _0x18c54a;},a274_0x1298(_0x442418,_0x4a5189);}'use strict';var __importDefault=this&&this[a274_0x10532d(0x101)]||function(_0x4ec403){const _0x40de9b=a274_0x10532d;return _0x4ec403&&_0x4ec403[_0x40de9b(0x125)]?_0x4ec403:{'default':_0x4ec403};};Object[a274_0x10532d(0x12b)](exports,a274_0x10532d(0x125),{'value':!![]});const job_utils_1=__importDefault(require(a274_0x10532d(0x10e))),path_1=__importDefault(require(a274_0x10532d(0x100))),manifest_manger_1=__importDefault(require(a274_0x10532d(0x121))),state_manger_1=__importDefault(require(a274_0x10532d(0x12d))),promises_1=require(a274_0x10532d(0x10c)),utils_1=require(a274_0x10532d(0x106)),csv_utils_1=__importDefault(require(a274_0x10532d(0xea))),not_found_error_1=require('../../../core/errors/not-found.error'),logger_enums_1=require(a274_0x10532d(0xf1)),bad_request_error_1=require(a274_0x10532d(0xef)),job_1=require(a274_0x10532d(0x107)),fs_utils_1=require(a274_0x10532d(0x126)),constants_1=require(a274_0x10532d(0x129)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a274_0x10532d(0x110)](_0x155c83,_0x5485f8){const _0x1909c3=a274_0x10532d,_0xe1735e=await job_utils_1[_0x1909c3(0xf2)][_0x1909c3(0x108)](RetrieveMetadataService[_0x1909c3(0x11e)]),_0xcbdcb2=await job_utils_1[_0x1909c3(0xf2)][_0x1909c3(0xfc)](RetrieveMetadataService[_0x1909c3(0x11e)],_0xe1735e),_0x25cb4c=_0xcbdcb2[_0x1909c3(0x11c)](_0x5485f8,_0x5485f8+_0x155c83),_0x229016=[];for(const _0x28a35d of _0x25cb4c){const _0x1b8fbc=await state_manger_1[_0x1909c3(0xf2)][_0x1909c3(0x103)](path_1['default'][_0x1909c3(0x127)](RetrieveMetadataService[_0x1909c3(0x11e)],_0x28a35d));_0x229016[_0x1909c3(0x10b)](_0x1b8fbc);}return _0x229016;}static async[a274_0x10532d(0x11b)](_0x2fb64c){const _0x392d23=a274_0x10532d,_0x39bbb7=job_utils_1[_0x392d23(0xf2)][_0x392d23(0xec)](),_0x4225a4=path_1[_0x392d23(0xf2)]['join'](RetrieveMetadataService[_0x392d23(0x11e)],_0x39bbb7);await(0x0,fs_utils_1[_0x392d23(0xfa)])(_0x4225a4),await manifest_manger_1['default'][_0x392d23(0xf3)](_0x4225a4,_0x2fb64c),await state_manger_1[_0x392d23(0xf2)][_0x392d23(0xf3)](_0x4225a4,_0x39bbb7);const _0x9decb8=path_1['default'][_0x392d23(0x127)](__dirname,job_1[_0x392d23(0xf4)]);return job_utils_1['default'][_0x392d23(0x10d)](_0x9decb8,{'jobStorePath':_0x4225a4,'jobId':_0x39bbb7})[_0x392d23(0xfe)](async _0x33309b=>{const _0x558937=_0x392d23,_0x1c5dc6=new state_manger_1[(_0x558937(0xf2))](_0x4225a4);await _0x1c5dc6[_0x558937(0x111)](),await _0x1c5dc6['setError'](_0x33309b);}),{'jobId':_0x39bbb7};}static async[a274_0x10532d(0x104)](_0x642717){const _0x76337e=a274_0x10532d,{status:_0x5cb591}=await RetrieveMetadataService['getJobStatus'](_0x642717);if(_0x5cb591===logger_enums_1[_0x76337e(0x12e)]['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError']('Job\x20not\x20completed.');const _0x432460=path_1[_0x76337e(0xf2)][_0x76337e(0x127)](RetrieveMetadataService['retrieveMetadataFolder'],_0x642717,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1['FsUtils'][_0x76337e(0x105)](_0x432460))return(0x0,promises_1[_0x76337e(0x128)])(_0x432460,_0x76337e(0x120))[_0x76337e(0x116)](JSON[_0x76337e(0x11f)]);else throw new not_found_error_1[(_0x76337e(0x114))](_0x76337e(0x122));}static async[a274_0x10532d(0xed)](_0x2581a7,_0x529331){const _0x2f7be2=a274_0x10532d,{status:_0x5ec92b}=await RetrieveMetadataService[_0x2f7be2(0x119)](_0x2581a7);if(_0x5ec92b===logger_enums_1[_0x2f7be2(0x12e)][_0x2f7be2(0x124)])throw new bad_request_error_1[(_0x2f7be2(0xf9))](_0x2f7be2(0xfd));const _0x12e4bd=path_1[_0x2f7be2(0xf2)][_0x2f7be2(0x127)](RetrieveMetadataService[_0x2f7be2(0x11e)],_0x2581a7,constants_1[_0x2f7be2(0x12a)]),_0xf93c37={'data':[]};if(await utils_1[_0x2f7be2(0x10a)][_0x2f7be2(0x105)](path_1[_0x2f7be2(0xf2)][_0x2f7be2(0x127)](_0x12e4bd,_0x529331+_0x2f7be2(0x11a))))_0xf93c37['data']=await(0x0,promises_1[_0x2f7be2(0x128)])(path_1[_0x2f7be2(0xf2)]['join'](_0x12e4bd,_0x529331+_0x2f7be2(0x11a)),'utf-8')[_0x2f7be2(0x116)](JSON[_0x2f7be2(0x11f)]);else throw new not_found_error_1[(_0x2f7be2(0x114))](_0x2f7be2(0xee));return _0xf93c37;}static async[a274_0x10532d(0x119)](_0x5cc318){const _0x1fbc6c=a274_0x10532d;try{return await state_manger_1['default'][_0x1fbc6c(0x103)](path_1[_0x1fbc6c(0xf2)][_0x1fbc6c(0x127)](RetrieveMetadataService[_0x1fbc6c(0x11e)],_0x5cc318));}catch(_0x810307){throw new not_found_error_1[(_0x1fbc6c(0x114))](_0x810307);}}static async['getJobLogs'](_0xc9b9f9){const _0x59b9f6=a274_0x10532d,_0x437269=path_1[_0x59b9f6(0xf2)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0xc9b9f9,job_1[_0x59b9f6(0x123)]);if(await utils_1[_0x59b9f6(0x10a)][_0x59b9f6(0x105)](_0x437269))return(0x0,promises_1[_0x59b9f6(0x128)])(_0x437269,_0x59b9f6(0x120))['then'](_0x5c9b1c=>csv_utils_1['default'][_0x59b9f6(0x11f)](_0x5c9b1c,{'columns':!![]}));throw new not_found_error_1[(_0x59b9f6(0x114))](_0x59b9f6(0xf8));}}exports[a274_0x10532d(0xf2)]=RetrieveMetadataService,RetrieveMetadataService[a274_0x10532d(0x11e)]=path_1['default']['join'](path_2[a274_0x10532d(0xff)],constants_1[a274_0x10532d(0x109)]);function a274_0x18c5(){const _0x33806e=['552VmVNWl','getJobStatus','.json','createRetrieveJob','slice','constructor','retrieveMetadataFolder','parse','utf-8','../job/classes/manifest-manger','Result\x20not\x20found.','JOB_LOG_DETAILS_FILENAME','IN_PROGRESS','__esModule','../../shared/utils/fs.utils','join','readFile','../constants','RETRIEVE_RESULT_FOLDER_NAME','defineProperty','40aGDeGK','../job/classes/state-manger','JobStatus','../../shared/utils/csv.utils','25230601EqJfHu','generateJobId','getResultChunk','Chunk\x20not\x20found.','../../../core/errors/bad-request.error','40187cQTnfH','../job/enums/logger.enums','default','create','JOB_PATH','1232DdqSCm','4804344nhXwdi','441079NQVLBQ','Job\x20log\x20not\x20found.','BadRequestError','makeDir','apply','sortJobsIds','Job\x20not\x20completed.','catch','dataPath','path','__importDefault','6838OqZRaR','getJobState','getResult','isExistsPath','@flosum/utils','../../../constants/job','getJobsIds','RETRIEVE_METADATA_FOLDER_NAME','FsUtils','push','fs/promises','runJob','../../shared/utils/job.utils','20cfFQFO','getJobs','init','search','1024767MzpDcq','NotFoundError','150120nhQARf','then','(((.+)+)+)+$'];a274_0x18c5=function(){return _0x33806e;};return a274_0x18c5();}