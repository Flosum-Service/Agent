const a320_0x52d689=a320_0x4df9;(function(_0x11bb3b,_0x3cfff1){const _0x2e2a75=a320_0x4df9,_0x449a68=_0x11bb3b();while(!![]){try{const _0x118d7c=parseInt(_0x2e2a75(0x1a0))/0x1*(parseInt(_0x2e2a75(0x188))/0x2)+parseInt(_0x2e2a75(0x182))/0x3+-parseInt(_0x2e2a75(0x17a))/0x4+-parseInt(_0x2e2a75(0x175))/0x5*(parseInt(_0x2e2a75(0x19f))/0x6)+parseInt(_0x2e2a75(0x193))/0x7*(parseInt(_0x2e2a75(0x17d))/0x8)+parseInt(_0x2e2a75(0x1a5))/0x9*(-parseInt(_0x2e2a75(0x19b))/0xa)+parseInt(_0x2e2a75(0x1a8))/0xb*(parseInt(_0x2e2a75(0x19e))/0xc);if(_0x118d7c===_0x3cfff1)break;else _0x449a68['push'](_0x449a68['shift']());}catch(_0x52164a){_0x449a68['push'](_0x449a68['shift']());}}}(a320_0x57d7,0xa587b));const a320_0x2dbc74=(function(){let _0x1758d8=!![];return function(_0x2d648e,_0x2cee2b){const _0x3b7fc4=_0x1758d8?function(){if(_0x2cee2b){const _0x2b8a38=_0x2cee2b['apply'](_0x2d648e,arguments);return _0x2cee2b=null,_0x2b8a38;}}:function(){};return _0x1758d8=![],_0x3b7fc4;};}()),a320_0x6b1301=a320_0x2dbc74(this,function(){const _0x4a5ef3=a320_0x4df9;return a320_0x6b1301['toString']()[_0x4a5ef3(0x176)](_0x4a5ef3(0x1a4))[_0x4a5ef3(0x18f)]()['constructor'](a320_0x6b1301)['search'](_0x4a5ef3(0x1a4));});a320_0x6b1301();'use strict';var __importDefault=this&&this[a320_0x52d689(0x177)]||function(_0x4a52fb){const _0x26fab4=a320_0x52d689;return _0x4a52fb&&_0x4a52fb[_0x26fab4(0x189)]?_0x4a52fb:{'default':_0x4a52fb};};function a320_0x4df9(_0xadadd,_0x4dce5a){const _0x472799=a320_0x57d7();return a320_0x4df9=function(_0x6b1301,_0x2dbc74){_0x6b1301=_0x6b1301-0x172;let _0x57d7ba=_0x472799[_0x6b1301];return _0x57d7ba;},a320_0x4df9(_0xadadd,_0x4dce5a);}Object['defineProperty'](exports,a320_0x52d689(0x189),{'value':!![]});const job_utils_1=__importDefault(require(a320_0x52d689(0x19c))),path_1=__importDefault(require(a320_0x52d689(0x18e))),manifest_manger_1=__importDefault(require(a320_0x52d689(0x180))),state_manger_1=__importDefault(require(a320_0x52d689(0x17e))),promises_1=require(a320_0x52d689(0x18d)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a320_0x52d689(0x186))),not_found_error_1=require(a320_0x52d689(0x1a6)),logger_enums_1=require(a320_0x52d689(0x178)),bad_request_error_1=require(a320_0x52d689(0x192)),job_1=require(a320_0x52d689(0x1ad)),fs_utils_1=require(a320_0x52d689(0x1ac)),constants_1=require(a320_0x52d689(0x174)),path_2=require('../../../configs/path');function a320_0x57d7(){const _0x2749a6=['search','__importDefault','../../shared/enums/logger.enums','getJobStatus','4760060cYLovv','RETRIEVE_RESULTS_IDS_FILENAME','dataPath','96112fBgMiI','../../shared/managers/state-manger','catch','../job/classes/manifest-manger','RETRIEVE_RESULT_FOLDER_NAME','2084112BhUyvk','setError','isExistsPath','Job\x20not\x20completed.','../../shared/utils/csv.utils','runJob','1930gEziOS','__esModule','Chunk\x20not\x20found.','RETRIEVE_METADATA_FOLDER_NAME','then','fs/promises','path','toString','JOB_PATH','BadRequestError','../../../core/errors/bad-request.error','357XdsPfx','parse','JOB_LOG_DETAILS_FILENAME','data','getJobs','createRetrieveJob','NotFoundError','JobStatus','10TbpvaW','../../shared/utils/job.utils','readFile','35832nSqOcL','3188514KtqqGs','821OtQWBp','Result\x20not\x20found.','retrieveMetadataFolder','.json','(((.+)+)+)+$','3403341xjIxjA','../../../core/errors/not-found.error','init','4455peimLr','create','join','FsUtils','../../shared/utils/fs.utils','../../../constants/job','generateJobId','IN_PROGRESS','push','default','Job\x20log\x20not\x20found.','getJobLogs','sortJobsIds','utf-8','../constants','10vkXMfa'];a320_0x57d7=function(){return _0x2749a6;};return a320_0x57d7();}class RetrieveMetadataService{static async[a320_0x52d689(0x197)](_0x278729,_0x1f7fd5){const _0x2a1e89=a320_0x52d689,_0x126eab=await job_utils_1[_0x2a1e89(0x1b1)]['getJobsIds'](RetrieveMetadataService[_0x2a1e89(0x1a2)]),_0x332ab3=await job_utils_1['default'][_0x2a1e89(0x172)](RetrieveMetadataService[_0x2a1e89(0x1a2)],_0x126eab),_0xe1541a=_0x332ab3['slice'](_0x1f7fd5,_0x1f7fd5+_0x278729),_0x4758d5=[];for(const _0x5a64b6 of _0xe1541a){const _0x799be3=await state_manger_1[_0x2a1e89(0x1b1)]['getJobState'](path_1['default'][_0x2a1e89(0x1aa)](RetrieveMetadataService[_0x2a1e89(0x1a2)],_0x5a64b6));_0x4758d5[_0x2a1e89(0x1b0)](_0x799be3);}return _0x4758d5;}static async[a320_0x52d689(0x198)](_0x4d683c){const _0x4da8f4=a320_0x52d689,_0x44e44c=job_utils_1[_0x4da8f4(0x1b1)][_0x4da8f4(0x1ae)](),_0x30c865=path_1[_0x4da8f4(0x1b1)][_0x4da8f4(0x1aa)](RetrieveMetadataService['retrieveMetadataFolder'],_0x44e44c);await(0x0,fs_utils_1['makeDir'])(_0x30c865),await manifest_manger_1[_0x4da8f4(0x1b1)]['create'](_0x30c865,_0x4d683c),await state_manger_1['default'][_0x4da8f4(0x1a9)](_0x30c865,_0x44e44c);const _0x567cc2=path_1[_0x4da8f4(0x1b1)][_0x4da8f4(0x1aa)](__dirname,job_1[_0x4da8f4(0x190)]);return job_utils_1[_0x4da8f4(0x1b1)][_0x4da8f4(0x187)](_0x567cc2,{'jobStorePath':_0x30c865,'jobId':_0x44e44c})[_0x4da8f4(0x17f)](async _0x3528f1=>{const _0xf4ad8b=_0x4da8f4,_0x3ceaa7=new state_manger_1[(_0xf4ad8b(0x1b1))](_0x30c865);await _0x3ceaa7[_0xf4ad8b(0x1a7)](),await _0x3ceaa7[_0xf4ad8b(0x183)](_0x3528f1);}),{'jobId':_0x44e44c};}static async['getResult'](_0x56bfa2){const _0x159b2a=a320_0x52d689,{status:_0xc9b18d}=await RetrieveMetadataService[_0x159b2a(0x179)](_0x56bfa2);if(_0xc9b18d===logger_enums_1[_0x159b2a(0x19a)][_0x159b2a(0x1af)])throw new bad_request_error_1[(_0x159b2a(0x191))](_0x159b2a(0x185));const _0x123319=path_1[_0x159b2a(0x1b1)]['join'](RetrieveMetadataService[_0x159b2a(0x1a2)],_0x56bfa2,constants_1[_0x159b2a(0x17b)]);if(await utils_1[_0x159b2a(0x1ab)][_0x159b2a(0x184)](_0x123319))return(0x0,promises_1['readFile'])(_0x123319,_0x159b2a(0x173))['then'](JSON[_0x159b2a(0x194)]);else throw new not_found_error_1[(_0x159b2a(0x199))](_0x159b2a(0x1a1));}static async['getResultChunk'](_0x4b6c3f,_0x28ffb8){const _0x5e31c9=a320_0x52d689,{status:_0x17fdc1}=await RetrieveMetadataService[_0x5e31c9(0x179)](_0x4b6c3f);if(_0x17fdc1===logger_enums_1['JobStatus'][_0x5e31c9(0x1af)])throw new bad_request_error_1[(_0x5e31c9(0x191))](_0x5e31c9(0x185));const _0x10c606=path_1[_0x5e31c9(0x1b1)][_0x5e31c9(0x1aa)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4b6c3f,constants_1[_0x5e31c9(0x181)]),_0x1177af={'data':[]};if(await utils_1[_0x5e31c9(0x1ab)][_0x5e31c9(0x184)](path_1['default'][_0x5e31c9(0x1aa)](_0x10c606,_0x28ffb8+_0x5e31c9(0x1a3))))_0x1177af[_0x5e31c9(0x196)]=await(0x0,promises_1[_0x5e31c9(0x19d)])(path_1['default']['join'](_0x10c606,_0x28ffb8+_0x5e31c9(0x1a3)),_0x5e31c9(0x173))[_0x5e31c9(0x18c)](JSON[_0x5e31c9(0x194)]);else throw new not_found_error_1[(_0x5e31c9(0x199))](_0x5e31c9(0x18a));return _0x1177af;}static async[a320_0x52d689(0x179)](_0x3f625e){const _0x517b3f=a320_0x52d689;try{return await state_manger_1[_0x517b3f(0x1b1)]['getJobState'](path_1['default'][_0x517b3f(0x1aa)](RetrieveMetadataService['retrieveMetadataFolder'],_0x3f625e));}catch(_0x556a8b){throw new not_found_error_1[(_0x517b3f(0x199))](_0x556a8b);}}static async[a320_0x52d689(0x1b3)](_0x59d25f){const _0x1ebfb3=a320_0x52d689,_0x212836=path_1[_0x1ebfb3(0x1b1)][_0x1ebfb3(0x1aa)](RetrieveMetadataService[_0x1ebfb3(0x1a2)],_0x59d25f,job_1[_0x1ebfb3(0x195)]);if(await utils_1[_0x1ebfb3(0x1ab)]['isExistsPath'](_0x212836))return(0x0,promises_1[_0x1ebfb3(0x19d)])(_0x212836,_0x1ebfb3(0x173))[_0x1ebfb3(0x18c)](_0xd1664e=>csv_utils_1['default'][_0x1ebfb3(0x194)](_0xd1664e,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x1ebfb3(0x1b2));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService[a320_0x52d689(0x1a2)]=path_1['default'][a320_0x52d689(0x1aa)](path_2[a320_0x52d689(0x17c)],constants_1[a320_0x52d689(0x18b)]);