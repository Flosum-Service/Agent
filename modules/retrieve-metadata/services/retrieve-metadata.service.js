function a277_0x2cdc(){const _0x326eb7=['push','readFile','1683368ozLQRU','toString','(((.+)+)+)+$','../../shared/utils/csv.utils','472146HdVDZk','then','603935lrLDkS','parse','RETRIEVE_RESULT_FOLDER_NAME','1720705aFCCor','utf-8','NotFoundError','Job\x20not\x20completed.','9mUstWx','BadRequestError','IN_PROGRESS','getJobState','getJobStatus','create','../job/classes/manifest-manger','FsUtils','@flosum/utils','RETRIEVE_METADATA_FOLDER_NAME','init','JobStatus','getJobsIds','RETRIEVE_RESULTS_IDS_FILENAME','30YyRvPV','45taCRsg','Job\x20log\x20not\x20found.','getResultChunk','getJobs','defineProperty','join','generateJobId','../../shared/utils/fs.utils','../../../core/errors/not-found.error','382450JzXcKh','apply','../constants','createRetrieveJob','100268MccZsJ','.json','dataPath','retrieveMetadataFolder','__esModule','search','63630VjfzlN','data','__importDefault','makeDir','default','../../shared/managers/state-manger','setError','path','isExistsPath','Chunk\x20not\x20found.','getJobLogs','slice','../../shared/utils/job.utils','../../../configs/path','../../../core/errors/bad-request.error'];a277_0x2cdc=function(){return _0x326eb7;};return a277_0x2cdc();}const a277_0x3c6100=a277_0x1243;(function(_0x52892f,_0x5b76d2){const _0x252f1f=a277_0x1243,_0xc9d79=_0x52892f();while(!![]){try{const _0x1b1cca=parseInt(_0x252f1f(0x130))/0x1+-parseInt(_0x252f1f(0x12e))/0x2+parseInt(_0x252f1f(0x106))/0x3*(parseInt(_0x252f1f(0x113))/0x4)+parseInt(_0x252f1f(0x105))/0x5*(parseInt(_0x252f1f(0x119))/0x6)+-parseInt(_0x252f1f(0x133))/0x7+-parseInt(_0x252f1f(0x12a))/0x8+parseInt(_0x252f1f(0xf7))/0x9*(parseInt(_0x252f1f(0x10f))/0xa);if(_0x1b1cca===_0x5b76d2)break;else _0xc9d79['push'](_0xc9d79['shift']());}catch(_0x3c7a99){_0xc9d79['push'](_0xc9d79['shift']());}}}(a277_0x2cdc,0x5f182));const a277_0x5c626e=(function(){let _0x3fb480=!![];return function(_0x2b7af3,_0x2ea7e0){const _0x487d37=_0x3fb480?function(){const _0x5aa374=a277_0x1243;if(_0x2ea7e0){const _0x3aed5d=_0x2ea7e0[_0x5aa374(0x110)](_0x2b7af3,arguments);return _0x2ea7e0=null,_0x3aed5d;}}:function(){};return _0x3fb480=![],_0x487d37;};}()),a277_0x4dedfc=a277_0x5c626e(this,function(){const _0x16a05d=a277_0x1243;return a277_0x4dedfc[_0x16a05d(0x12b)]()[_0x16a05d(0x118)](_0x16a05d(0x12c))[_0x16a05d(0x12b)]()['constructor'](a277_0x4dedfc)['search'](_0x16a05d(0x12c));});a277_0x4dedfc();function a277_0x1243(_0x3ca9fb,_0x3c0ca6){const _0x4cd63b=a277_0x2cdc();return a277_0x1243=function(_0x4dedfc,_0x5c626e){_0x4dedfc=_0x4dedfc-0xf7;let _0x2cdcdd=_0x4cd63b[_0x4dedfc];return _0x2cdcdd;},a277_0x1243(_0x3ca9fb,_0x3c0ca6);}'use strict';var __importDefault=this&&this[a277_0x3c6100(0x11b)]||function(_0x213f41){return _0x213f41&&_0x213f41['__esModule']?_0x213f41:{'default':_0x213f41};};Object[a277_0x3c6100(0x10a)](exports,a277_0x3c6100(0x117),{'value':!![]});const job_utils_1=__importDefault(require(a277_0x3c6100(0x125))),path_1=__importDefault(require(a277_0x3c6100(0x120))),manifest_manger_1=__importDefault(require(a277_0x3c6100(0xfd))),state_manger_1=__importDefault(require(a277_0x3c6100(0x11e))),promises_1=require('fs/promises'),utils_1=require(a277_0x3c6100(0xff)),csv_utils_1=__importDefault(require(a277_0x3c6100(0x12d))),not_found_error_1=require(a277_0x3c6100(0x10e)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require(a277_0x3c6100(0x127)),job_1=require('../../../constants/job'),fs_utils_1=require(a277_0x3c6100(0x10d)),constants_1=require(a277_0x3c6100(0x111)),path_2=require(a277_0x3c6100(0x126));class RetrieveMetadataService{static async[a277_0x3c6100(0x109)](_0x3ff6cd,_0x1c4460){const _0x40fc3a=a277_0x3c6100,_0x48a573=await job_utils_1['default'][_0x40fc3a(0x103)](RetrieveMetadataService[_0x40fc3a(0x116)]),_0x34dd0f=await job_utils_1[_0x40fc3a(0x11d)]['sortJobsIds'](RetrieveMetadataService[_0x40fc3a(0x116)],_0x48a573),_0x417925=_0x34dd0f[_0x40fc3a(0x124)](_0x1c4460,_0x1c4460+_0x3ff6cd),_0x5890db=[];for(const _0x88a37f of _0x417925){const _0x5b14e4=await state_manger_1[_0x40fc3a(0x11d)][_0x40fc3a(0xfa)](path_1[_0x40fc3a(0x11d)][_0x40fc3a(0x10b)](RetrieveMetadataService[_0x40fc3a(0x116)],_0x88a37f));_0x5890db[_0x40fc3a(0x128)](_0x5b14e4);}return _0x5890db;}static async[a277_0x3c6100(0x112)](_0x2a4499){const _0x17ed89=a277_0x3c6100,_0x4a458d=job_utils_1['default'][_0x17ed89(0x10c)](),_0x48d11f=path_1['default']['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x4a458d);await(0x0,fs_utils_1[_0x17ed89(0x11c)])(_0x48d11f),await manifest_manger_1[_0x17ed89(0x11d)]['create'](_0x48d11f,_0x2a4499),await state_manger_1[_0x17ed89(0x11d)][_0x17ed89(0xfc)](_0x48d11f,_0x4a458d);const _0x13ba87=path_1[_0x17ed89(0x11d)][_0x17ed89(0x10b)](__dirname,job_1['JOB_PATH']);return job_utils_1['default']['runJob'](_0x13ba87,{'jobStorePath':_0x48d11f,'jobId':_0x4a458d})['catch'](async _0x34cf83=>{const _0xb85faa=_0x17ed89,_0x5a8688=new state_manger_1[(_0xb85faa(0x11d))](_0x48d11f);await _0x5a8688[_0xb85faa(0x101)](),await _0x5a8688[_0xb85faa(0x11f)](_0x34cf83);}),{'jobId':_0x4a458d};}static async['getResult'](_0x144a56){const _0x1fcbc8=a277_0x3c6100,{status:_0x41d26a}=await RetrieveMetadataService[_0x1fcbc8(0xfb)](_0x144a56);if(_0x41d26a===logger_enums_1[_0x1fcbc8(0x102)][_0x1fcbc8(0xf9)])throw new bad_request_error_1[(_0x1fcbc8(0xf8))]('Job\x20not\x20completed.');const _0x5e5663=path_1[_0x1fcbc8(0x11d)][_0x1fcbc8(0x10b)](RetrieveMetadataService[_0x1fcbc8(0x116)],_0x144a56,constants_1[_0x1fcbc8(0x104)]);if(await utils_1['FsUtils'][_0x1fcbc8(0x121)](_0x5e5663))return(0x0,promises_1['readFile'])(_0x5e5663,_0x1fcbc8(0x134))[_0x1fcbc8(0x12f)](JSON[_0x1fcbc8(0x131)]);else throw new not_found_error_1[(_0x1fcbc8(0x135))]('Result\x20not\x20found.');}static async[a277_0x3c6100(0x108)](_0x3e1e90,_0x3007e1){const _0x37dd71=a277_0x3c6100,{status:_0x58d90e}=await RetrieveMetadataService[_0x37dd71(0xfb)](_0x3e1e90);if(_0x58d90e===logger_enums_1[_0x37dd71(0x102)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x37dd71(0xf8))](_0x37dd71(0x136));const _0x131be2=path_1[_0x37dd71(0x11d)][_0x37dd71(0x10b)](RetrieveMetadataService[_0x37dd71(0x116)],_0x3e1e90,constants_1[_0x37dd71(0x132)]),_0x55617b={'data':[]};if(await utils_1[_0x37dd71(0xfe)][_0x37dd71(0x121)](path_1[_0x37dd71(0x11d)][_0x37dd71(0x10b)](_0x131be2,_0x3007e1+_0x37dd71(0x114))))_0x55617b[_0x37dd71(0x11a)]=await(0x0,promises_1[_0x37dd71(0x129)])(path_1[_0x37dd71(0x11d)][_0x37dd71(0x10b)](_0x131be2,_0x3007e1+'.json'),_0x37dd71(0x134))[_0x37dd71(0x12f)](JSON[_0x37dd71(0x131)]);else throw new not_found_error_1['NotFoundError'](_0x37dd71(0x122));return _0x55617b;}static async['getJobStatus'](_0x222667){const _0x1418e6=a277_0x3c6100;try{return await state_manger_1[_0x1418e6(0x11d)]['getJobState'](path_1[_0x1418e6(0x11d)][_0x1418e6(0x10b)](RetrieveMetadataService[_0x1418e6(0x116)],_0x222667));}catch(_0x1a4d5c){throw new not_found_error_1['NotFoundError'](_0x1a4d5c);}}static async[a277_0x3c6100(0x123)](_0x3f1ef3){const _0x2fd343=a277_0x3c6100,_0x1740c9=path_1[_0x2fd343(0x11d)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x3f1ef3,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1[_0x2fd343(0xfe)][_0x2fd343(0x121)](_0x1740c9))return(0x0,promises_1[_0x2fd343(0x129)])(_0x1740c9,_0x2fd343(0x134))[_0x2fd343(0x12f)](_0x200d0f=>csv_utils_1['default'][_0x2fd343(0x131)](_0x200d0f,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x2fd343(0x107));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService[a277_0x3c6100(0x116)]=path_1[a277_0x3c6100(0x11d)][a277_0x3c6100(0x10b)](path_2[a277_0x3c6100(0x115)],constants_1[a277_0x3c6100(0x100)]);