const a309_0x5d6ec9=a309_0x410e;function a309_0x410e(_0x37a117,_0x53e0be){const _0x31b53b=a309_0x489d();return a309_0x410e=function(_0x17e244,_0x3a403d){_0x17e244=_0x17e244-0x11d;let _0x489d15=_0x31b53b[_0x17e244];return _0x489d15;},a309_0x410e(_0x37a117,_0x53e0be);}(function(_0x3a1324,_0x1fe628){const _0x22fddb=a309_0x410e,_0x53317c=_0x3a1324();while(!![]){try{const _0x55a506=-parseInt(_0x22fddb(0x132))/0x1+parseInt(_0x22fddb(0x134))/0x2+parseInt(_0x22fddb(0x146))/0x3+parseInt(_0x22fddb(0x159))/0x4+parseInt(_0x22fddb(0x14c))/0x5+-parseInt(_0x22fddb(0x131))/0x6*(parseInt(_0x22fddb(0x123))/0x7)+parseInt(_0x22fddb(0x13a))/0x8*(-parseInt(_0x22fddb(0x13e))/0x9);if(_0x55a506===_0x1fe628)break;else _0x53317c['push'](_0x53317c['shift']());}catch(_0x38d935){_0x53317c['push'](_0x53317c['shift']());}}}(a309_0x489d,0x526d2));const a309_0x3a403d=(function(){let _0x58d0f2=!![];return function(_0x47412d,_0xd1dbbf){const _0xef7a95=_0x58d0f2?function(){const _0x1cff09=a309_0x410e;if(_0xd1dbbf){const _0x3bf2cf=_0xd1dbbf[_0x1cff09(0x12d)](_0x47412d,arguments);return _0xd1dbbf=null,_0x3bf2cf;}}:function(){};return _0x58d0f2=![],_0xef7a95;};}()),a309_0x17e244=a309_0x3a403d(this,function(){const _0x19111a=a309_0x410e;return a309_0x17e244[_0x19111a(0x140)]()['search'](_0x19111a(0x135))[_0x19111a(0x140)]()[_0x19111a(0x13c)](a309_0x17e244)[_0x19111a(0x149)]('(((.+)+)+)+$');});a309_0x17e244();'use strict';var __importDefault=this&&this[a309_0x5d6ec9(0x144)]||function(_0x3c7d81){const _0x3c87d6=a309_0x5d6ec9;return _0x3c7d81&&_0x3c7d81[_0x3c87d6(0x120)]?_0x3c7d81:{'default':_0x3c7d81};};Object[a309_0x5d6ec9(0x126)](exports,a309_0x5d6ec9(0x120),{'value':!![]});const job_utils_1=__importDefault(require(a309_0x5d6ec9(0x145))),path_1=__importDefault(require(a309_0x5d6ec9(0x14f))),manifest_manger_1=__importDefault(require(a309_0x5d6ec9(0x14d))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require('fs/promises'),utils_1=require(a309_0x5d6ec9(0x152)),csv_utils_1=__importDefault(require(a309_0x5d6ec9(0x133))),not_found_error_1=require('../../../core/errors/not-found.error'),logger_enums_1=require(a309_0x5d6ec9(0x14e)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require(a309_0x5d6ec9(0x125)),fs_utils_1=require(a309_0x5d6ec9(0x11d)),constants_1=require('../constants'),path_2=require('../../../configs/path');function a309_0x489d(){const _0x2942da=['getResult','JOB_PATH','apply','slice','runJob','setError','6UvBKAo','605859PyEhYl','../../shared/utils/csv.utils','265948bdwTpH','(((.+)+)+)+$','NotFoundError','push','retrieveMetadataFolder','Job\x20not\x20completed.','27408LIJBap','default','constructor','getJobState','909pefBdq','makeDir','toString','init','getJobsIds','IN_PROGRESS','__importDefault','../../shared/utils/job.utils','1078011UsFNQP','catch','utf-8','search','create','isExistsPath','2489265lTPdqn','../job/classes/manifest-manger','../../shared/enums/logger.enums','path','Job\x20log\x20not\x20found.','sortJobsIds','@flosum/utils','Chunk\x20not\x20found.','Result\x20not\x20found.','join','readFile','RETRIEVE_METADATA_FOLDER_NAME','.json','2197704xhZglr','then','../../shared/utils/fs.utils','parse','JobStatus','__esModule','generateJobId','FsUtils','1750609ydchlp','BadRequestError','../../../constants/job','defineProperty','getJobStatus','RETRIEVE_RESULTS_IDS_FILENAME','getJobLogs','RETRIEVE_RESULT_FOLDER_NAME'];a309_0x489d=function(){return _0x2942da;};return a309_0x489d();}class RetrieveMetadataService{static async['getJobs'](_0x3609d3,_0x55eb09){const _0x5c46e1=a309_0x5d6ec9,_0x1e74d3=await job_utils_1['default'][_0x5c46e1(0x142)](RetrieveMetadataService[_0x5c46e1(0x138)]),_0x1b07a5=await job_utils_1['default'][_0x5c46e1(0x151)](RetrieveMetadataService[_0x5c46e1(0x138)],_0x1e74d3),_0x298159=_0x1b07a5[_0x5c46e1(0x12e)](_0x55eb09,_0x55eb09+_0x3609d3),_0xf1d205=[];for(const _0x206e6c of _0x298159){const _0x330aad=await state_manger_1[_0x5c46e1(0x13b)][_0x5c46e1(0x13d)](path_1['default'][_0x5c46e1(0x155)](RetrieveMetadataService[_0x5c46e1(0x138)],_0x206e6c));_0xf1d205[_0x5c46e1(0x137)](_0x330aad);}return _0xf1d205;}static async['createRetrieveJob'](_0x3ccdd2){const _0x2ed8a9=a309_0x5d6ec9,_0x377c58=job_utils_1['default'][_0x2ed8a9(0x121)](),_0x36988d=path_1['default'][_0x2ed8a9(0x155)](RetrieveMetadataService[_0x2ed8a9(0x138)],_0x377c58);await(0x0,fs_utils_1[_0x2ed8a9(0x13f)])(_0x36988d),await manifest_manger_1[_0x2ed8a9(0x13b)][_0x2ed8a9(0x14a)](_0x36988d,_0x3ccdd2),await state_manger_1[_0x2ed8a9(0x13b)][_0x2ed8a9(0x14a)](_0x36988d,_0x377c58);const _0x354b0d=path_1['default'][_0x2ed8a9(0x155)](__dirname,job_1[_0x2ed8a9(0x12c)]);return job_utils_1[_0x2ed8a9(0x13b)][_0x2ed8a9(0x12f)](_0x354b0d,{'jobStorePath':_0x36988d,'jobId':_0x377c58})[_0x2ed8a9(0x147)](async _0x53179e=>{const _0x123034=_0x2ed8a9,_0x5070d9=new state_manger_1[(_0x123034(0x13b))](_0x36988d);await _0x5070d9[_0x123034(0x141)](),await _0x5070d9[_0x123034(0x130)](_0x53179e);}),{'jobId':_0x377c58};}static async[a309_0x5d6ec9(0x12b)](_0xfa439f){const _0x10c896=a309_0x5d6ec9,{status:_0x1bcc13}=await RetrieveMetadataService[_0x10c896(0x127)](_0xfa439f);if(_0x1bcc13===logger_enums_1[_0x10c896(0x11f)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x10c896(0x124))](_0x10c896(0x139));const _0x4af060=path_1[_0x10c896(0x13b)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0xfa439f,constants_1[_0x10c896(0x128)]);if(await utils_1[_0x10c896(0x122)][_0x10c896(0x14b)](_0x4af060))return(0x0,promises_1[_0x10c896(0x156)])(_0x4af060,_0x10c896(0x148))[_0x10c896(0x15a)](JSON[_0x10c896(0x11e)]);else throw new not_found_error_1['NotFoundError'](_0x10c896(0x154));}static async['getResultChunk'](_0x4a82d9,_0x32c004){const _0x30c99a=a309_0x5d6ec9,{status:_0x4d1a79}=await RetrieveMetadataService[_0x30c99a(0x127)](_0x4a82d9);if(_0x4d1a79===logger_enums_1[_0x30c99a(0x11f)][_0x30c99a(0x143)])throw new bad_request_error_1[(_0x30c99a(0x124))]('Job\x20not\x20completed.');const _0x1678ab=path_1['default'][_0x30c99a(0x155)](RetrieveMetadataService[_0x30c99a(0x138)],_0x4a82d9,constants_1[_0x30c99a(0x12a)]),_0x280078={'data':[]};if(await utils_1['FsUtils']['isExistsPath'](path_1['default']['join'](_0x1678ab,_0x32c004+_0x30c99a(0x158))))_0x280078['data']=await(0x0,promises_1['readFile'])(path_1[_0x30c99a(0x13b)]['join'](_0x1678ab,_0x32c004+_0x30c99a(0x158)),'utf-8')['then'](JSON[_0x30c99a(0x11e)]);else throw new not_found_error_1['NotFoundError'](_0x30c99a(0x153));return _0x280078;}static async[a309_0x5d6ec9(0x127)](_0x30c409){const _0x44043d=a309_0x5d6ec9;try{return await state_manger_1['default']['getJobState'](path_1[_0x44043d(0x13b)][_0x44043d(0x155)](RetrieveMetadataService[_0x44043d(0x138)],_0x30c409));}catch(_0x3d2e1b){throw new not_found_error_1[(_0x44043d(0x136))](_0x3d2e1b);}}static async[a309_0x5d6ec9(0x129)](_0x1dc194){const _0x1200f2=a309_0x5d6ec9,_0x4b5337=path_1[_0x1200f2(0x13b)][_0x1200f2(0x155)](RetrieveMetadataService['retrieveMetadataFolder'],_0x1dc194,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1[_0x1200f2(0x122)][_0x1200f2(0x14b)](_0x4b5337))return(0x0,promises_1['readFile'])(_0x4b5337,_0x1200f2(0x148))[_0x1200f2(0x15a)](_0xa6c06d=>csv_utils_1[_0x1200f2(0x13b)][_0x1200f2(0x11e)](_0xa6c06d,{'columns':!![]}));throw new not_found_error_1[(_0x1200f2(0x136))](_0x1200f2(0x150));}}exports[a309_0x5d6ec9(0x13b)]=RetrieveMetadataService,RetrieveMetadataService[a309_0x5d6ec9(0x138)]=path_1['default'][a309_0x5d6ec9(0x155)](path_2['dataPath'],constants_1[a309_0x5d6ec9(0x157)]);