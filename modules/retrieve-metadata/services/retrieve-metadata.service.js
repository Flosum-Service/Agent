const a277_0x1b4560=a277_0x3d40;function a277_0x3d40(_0x245791,_0x5782c9){const _0x1c3fe5=a277_0x2487();return a277_0x3d40=function(_0x17a997,_0x2b114d){_0x17a997=_0x17a997-0xc6;let _0x248795=_0x1c3fe5[_0x17a997];return _0x248795;},a277_0x3d40(_0x245791,_0x5782c9);}(function(_0x976a5c,_0x4654a1){const _0x2f2d7e=a277_0x3d40,_0x231457=_0x976a5c();while(!![]){try{const _0x416d85=-parseInt(_0x2f2d7e(0xf5))/0x1+parseInt(_0x2f2d7e(0xff))/0x2+parseInt(_0x2f2d7e(0xfd))/0x3*(parseInt(_0x2f2d7e(0xe4))/0x4)+-parseInt(_0x2f2d7e(0xef))/0x5+-parseInt(_0x2f2d7e(0xcf))/0x6*(parseInt(_0x2f2d7e(0xc6))/0x7)+-parseInt(_0x2f2d7e(0x100))/0x8+parseInt(_0x2f2d7e(0xe6))/0x9;if(_0x416d85===_0x4654a1)break;else _0x231457['push'](_0x231457['shift']());}catch(_0x135c8a){_0x231457['push'](_0x231457['shift']());}}}(a277_0x2487,0x7162a));const a277_0x2b114d=(function(){let _0x2b3960=!![];return function(_0x35f0f1,_0xa8efb5){const _0x120ba8=_0x2b3960?function(){if(_0xa8efb5){const _0x558d81=_0xa8efb5['apply'](_0x35f0f1,arguments);return _0xa8efb5=null,_0x558d81;}}:function(){};return _0x2b3960=![],_0x120ba8;};}()),a277_0x17a997=a277_0x2b114d(this,function(){const _0x1f36d7=a277_0x3d40;return a277_0x17a997[_0x1f36d7(0x102)]()[_0x1f36d7(0xcb)](_0x1f36d7(0xd5))[_0x1f36d7(0x102)]()['constructor'](a277_0x17a997)['search'](_0x1f36d7(0xd5));});a277_0x17a997();'use strict';function a277_0x2487(){const _0x3a48ef=['data','Job\x20not\x20completed.','then','generateJobId','getJobs','setError','65932BTwqku','IN_PROGRESS','14564097cfnCja','../../../configs/path','RETRIEVE_RESULTS_IDS_FILENAME','../constants','JobStatus','Result\x20not\x20found.','default','../../../core/errors/not-found.error','../../../core/errors/bad-request.error','1762880BLVGaF','create','JOB_PATH','sortJobsIds','isExistsPath','runJob','703325jBvABc','getJobState','push','utf-8','parse','FsUtils','join','makeDir','39tZnRvv','slice','1624950dygYwt','3699064HxJiZi','retrieveMetadataFolder','toString','readFile','../../shared/utils/fs.utils','2303pSvQHp','Chunk\x20not\x20found.','getJobLogs','getJobStatus','JOB_LOG_DETAILS_FILENAME','search','NotFoundError','defineProperty','RETRIEVE_RESULT_FOLDER_NAME','12078aNUUVC','getJobsIds','__importDefault','__esModule','../../shared/utils/csv.utils','../job/classes/manifest-manger','(((.+)+)+)+$','BadRequestError','../../shared/managers/state-manger','.json','createRetrieveJob','RETRIEVE_METADATA_FOLDER_NAME','getResultChunk','dataPath','fs/promises'];a277_0x2487=function(){return _0x3a48ef;};return a277_0x2487();}var __importDefault=this&&this[a277_0x1b4560(0xd1)]||function(_0xde0fa5){const _0xc2c4be=a277_0x1b4560;return _0xde0fa5&&_0xde0fa5[_0xc2c4be(0xd2)]?_0xde0fa5:{'default':_0xde0fa5};};Object[a277_0x1b4560(0xcd)](exports,a277_0x1b4560(0xd2),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require(a277_0x1b4560(0xd4))),state_manger_1=__importDefault(require(a277_0x1b4560(0xd7))),promises_1=require(a277_0x1b4560(0xdd)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a277_0x1b4560(0xd3))),not_found_error_1=require(a277_0x1b4560(0xed)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require(a277_0x1b4560(0xee)),job_1=require('../../../constants/job'),fs_utils_1=require(a277_0x1b4560(0x104)),constants_1=require(a277_0x1b4560(0xe9)),path_2=require(a277_0x1b4560(0xe7));class RetrieveMetadataService{static async[a277_0x1b4560(0xe2)](_0x24054a,_0xe9263a){const _0x5f11ae=a277_0x1b4560,_0x3cb1f6=await job_utils_1['default'][_0x5f11ae(0xd0)](RetrieveMetadataService[_0x5f11ae(0x101)]),_0x46b118=await job_utils_1['default'][_0x5f11ae(0xf2)](RetrieveMetadataService['retrieveMetadataFolder'],_0x3cb1f6),_0x1e0bfd=_0x46b118[_0x5f11ae(0xfe)](_0xe9263a,_0xe9263a+_0x24054a),_0x4af74b=[];for(const _0x2deabd of _0x1e0bfd){const _0x7db4cc=await state_manger_1[_0x5f11ae(0xec)][_0x5f11ae(0xf6)](path_1[_0x5f11ae(0xec)][_0x5f11ae(0xfb)](RetrieveMetadataService[_0x5f11ae(0x101)],_0x2deabd));_0x4af74b[_0x5f11ae(0xf7)](_0x7db4cc);}return _0x4af74b;}static async[a277_0x1b4560(0xd9)](_0x59af77){const _0x456422=a277_0x1b4560,_0x406b66=job_utils_1[_0x456422(0xec)][_0x456422(0xe1)](),_0x37cc36=path_1['default'][_0x456422(0xfb)](RetrieveMetadataService[_0x456422(0x101)],_0x406b66);await(0x0,fs_utils_1[_0x456422(0xfc)])(_0x37cc36),await manifest_manger_1[_0x456422(0xec)][_0x456422(0xf0)](_0x37cc36,_0x59af77),await state_manger_1[_0x456422(0xec)][_0x456422(0xf0)](_0x37cc36,_0x406b66);const _0xc2f4da=path_1[_0x456422(0xec)][_0x456422(0xfb)](__dirname,job_1[_0x456422(0xf1)]);return job_utils_1[_0x456422(0xec)][_0x456422(0xf4)](_0xc2f4da,{'jobStorePath':_0x37cc36,'jobId':_0x406b66})['catch'](async _0x388e7c=>{const _0x3092f6=_0x456422,_0x59826a=new state_manger_1['default'](_0x37cc36);await _0x59826a['init'](),await _0x59826a[_0x3092f6(0xe3)](_0x388e7c);}),{'jobId':_0x406b66};}static async['getResult'](_0x7cd00){const _0x2c7d8f=a277_0x1b4560,{status:_0x544c80}=await RetrieveMetadataService[_0x2c7d8f(0xc9)](_0x7cd00);if(_0x544c80===logger_enums_1[_0x2c7d8f(0xea)][_0x2c7d8f(0xe5)])throw new bad_request_error_1['BadRequestError'](_0x2c7d8f(0xdf));const _0xd497c3=path_1[_0x2c7d8f(0xec)]['join'](RetrieveMetadataService[_0x2c7d8f(0x101)],_0x7cd00,constants_1[_0x2c7d8f(0xe8)]);if(await utils_1[_0x2c7d8f(0xfa)][_0x2c7d8f(0xf3)](_0xd497c3))return(0x0,promises_1[_0x2c7d8f(0x103)])(_0xd497c3,_0x2c7d8f(0xf8))['then'](JSON[_0x2c7d8f(0xf9)]);else throw new not_found_error_1[(_0x2c7d8f(0xcc))](_0x2c7d8f(0xeb));}static async[a277_0x1b4560(0xdb)](_0x4a5a04,_0x12c897){const _0x580b9d=a277_0x1b4560,{status:_0x57632d}=await RetrieveMetadataService[_0x580b9d(0xc9)](_0x4a5a04);if(_0x57632d===logger_enums_1[_0x580b9d(0xea)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x580b9d(0xd6))](_0x580b9d(0xdf));const _0x28988c=path_1[_0x580b9d(0xec)][_0x580b9d(0xfb)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4a5a04,constants_1[_0x580b9d(0xce)]),_0x5f58ee={'data':[]};if(await utils_1[_0x580b9d(0xfa)]['isExistsPath'](path_1['default'][_0x580b9d(0xfb)](_0x28988c,_0x12c897+_0x580b9d(0xd8))))_0x5f58ee[_0x580b9d(0xde)]=await(0x0,promises_1[_0x580b9d(0x103)])(path_1[_0x580b9d(0xec)][_0x580b9d(0xfb)](_0x28988c,_0x12c897+_0x580b9d(0xd8)),_0x580b9d(0xf8))[_0x580b9d(0xe0)](JSON[_0x580b9d(0xf9)]);else throw new not_found_error_1[(_0x580b9d(0xcc))](_0x580b9d(0xc7));return _0x5f58ee;}static async['getJobStatus'](_0x45d59b){const _0x239374=a277_0x1b4560;try{return await state_manger_1[_0x239374(0xec)]['getJobState'](path_1['default'][_0x239374(0xfb)](RetrieveMetadataService[_0x239374(0x101)],_0x45d59b));}catch(_0xb9494e){throw new not_found_error_1[(_0x239374(0xcc))](_0xb9494e);}}static async[a277_0x1b4560(0xc8)](_0x264348){const _0xbca22=a277_0x1b4560,_0x11c68e=path_1[_0xbca22(0xec)][_0xbca22(0xfb)](RetrieveMetadataService[_0xbca22(0x101)],_0x264348,job_1[_0xbca22(0xca)]);if(await utils_1[_0xbca22(0xfa)][_0xbca22(0xf3)](_0x11c68e))return(0x0,promises_1[_0xbca22(0x103)])(_0x11c68e,'utf-8')[_0xbca22(0xe0)](_0x331a75=>csv_utils_1[_0xbca22(0xec)][_0xbca22(0xf9)](_0x331a75,{'columns':!![]}));throw new not_found_error_1[(_0xbca22(0xcc))]('Job\x20log\x20not\x20found.');}}exports[a277_0x1b4560(0xec)]=RetrieveMetadataService,RetrieveMetadataService[a277_0x1b4560(0x101)]=path_1[a277_0x1b4560(0xec)][a277_0x1b4560(0xfb)](path_2[a277_0x1b4560(0xdc)],constants_1[a277_0x1b4560(0xda)]);