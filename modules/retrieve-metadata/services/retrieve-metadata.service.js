const a273_0x628376=a273_0x11c7;(function(_0x587503,_0x44a31b){const _0x56a74f=a273_0x11c7,_0x581606=_0x587503();while(!![]){try{const _0x52e1b1=-parseInt(_0x56a74f(0xe6))/0x1*(-parseInt(_0x56a74f(0xfb))/0x2)+parseInt(_0x56a74f(0xeb))/0x3*(parseInt(_0x56a74f(0xef))/0x4)+-parseInt(_0x56a74f(0xf5))/0x5*(-parseInt(_0x56a74f(0xfd))/0x6)+parseInt(_0x56a74f(0x10f))/0x7+parseInt(_0x56a74f(0xf8))/0x8+-parseInt(_0x56a74f(0x10e))/0x9+-parseInt(_0x56a74f(0x100))/0xa*(parseInt(_0x56a74f(0x11d))/0xb);if(_0x52e1b1===_0x44a31b)break;else _0x581606['push'](_0x581606['shift']());}catch(_0x118293){_0x581606['push'](_0x581606['shift']());}}}(a273_0x23c4,0x42071));const a273_0x1ba5f5=(function(){let _0x29909c=!![];return function(_0x62e15e,_0x2f24b4){const _0x2f0221=_0x29909c?function(){const _0x92d4db=a273_0x11c7;if(_0x2f24b4){const _0x1c7cd3=_0x2f24b4[_0x92d4db(0x118)](_0x62e15e,arguments);return _0x2f24b4=null,_0x1c7cd3;}}:function(){};return _0x29909c=![],_0x2f0221;};}()),a273_0x128600=a273_0x1ba5f5(this,function(){const _0x158cab=a273_0x11c7;return a273_0x128600[_0x158cab(0x104)]()[_0x158cab(0xf3)](_0x158cab(0x11b))[_0x158cab(0x104)]()['constructor'](a273_0x128600)[_0x158cab(0xf3)]('(((.+)+)+)+$');});a273_0x128600();'use strict';var __importDefault=this&&this[a273_0x628376(0x11c)]||function(_0x12ae74){const _0x1d4103=a273_0x628376;return _0x12ae74&&_0x12ae74[_0x1d4103(0x10d)]?_0x12ae74:{'default':_0x12ae74};};function a273_0x23c4(){const _0x446eae=['defineProperty','NotFoundError','generateJobId','BadRequestError','join','apply','catch','RETRIEVE_RESULT_FOLDER_NAME','(((.+)+)+)+$','__importDefault','1631597umJsop','slice','utf-8','create','getJobState','../../shared/utils/fs.utils','then','makeDir','../../../configs/path','46IEAqUK','RETRIEVE_METADATA_FOLDER_NAME','path','getJobLogs','IN_PROGRESS','573189VurSHO','parse','getResult','isExistsPath','4bmDhvW','../../shared/utils/job.utils','getJobs','JobStatus','search','@flosum/utils','8835AJIZBf','push','default','1351800LymXiU','retrieveMetadataFolder','../../../core/errors/not-found.error','19036ldADds','readFile','1182SDlaYE','setError','FsUtils','70tfiMZe','Result\x20not\x20found.','dataPath','getResultChunk','toString','init','Job\x20not\x20completed.','runJob','../job/classes/manifest-manger','getJobStatus','sortJobsIds','JOB_LOG_DETAILS_FILENAME','.json','__esModule','15066AWPRZz','1151129qMLwDH','getJobsIds','../job/enums/logger.enums','Job\x20log\x20not\x20found.'];a273_0x23c4=function(){return _0x446eae;};return a273_0x23c4();}function a273_0x11c7(_0x4d1868,_0x161bfd){const _0x17e459=a273_0x23c4();return a273_0x11c7=function(_0x128600,_0x1ba5f5){_0x128600=_0x128600-0xe2;let _0x23c4c8=_0x17e459[_0x128600];return _0x23c4c8;},a273_0x11c7(_0x4d1868,_0x161bfd);}Object[a273_0x628376(0x113)](exports,a273_0x628376(0x10d),{'value':!![]});const job_utils_1=__importDefault(require(a273_0x628376(0xf0))),path_1=__importDefault(require(a273_0x628376(0xe8))),manifest_manger_1=__importDefault(require(a273_0x628376(0x108))),state_manger_1=__importDefault(require('../job/classes/state-manger')),promises_1=require('fs/promises'),utils_1=require(a273_0x628376(0xf4)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a273_0x628376(0xfa)),logger_enums_1=require(a273_0x628376(0x111)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require('../../../constants/job'),fs_utils_1=require(a273_0x628376(0xe2)),constants_1=require('../constants'),path_2=require(a273_0x628376(0xe5));class RetrieveMetadataService{static async[a273_0x628376(0xf1)](_0x49c7c3,_0x2f21a7){const _0x3b5744=a273_0x628376,_0x9630eb=await job_utils_1['default'][_0x3b5744(0x110)](RetrieveMetadataService[_0x3b5744(0xf9)]),_0x30cc2f=await job_utils_1[_0x3b5744(0xf7)][_0x3b5744(0x10a)](RetrieveMetadataService[_0x3b5744(0xf9)],_0x9630eb),_0x441f4c=_0x30cc2f[_0x3b5744(0x11e)](_0x2f21a7,_0x2f21a7+_0x49c7c3),_0x1c89e7=[];for(const _0x28825a of _0x441f4c){const _0x120755=await state_manger_1['default'][_0x3b5744(0x121)](path_1[_0x3b5744(0xf7)][_0x3b5744(0x117)](RetrieveMetadataService[_0x3b5744(0xf9)],_0x28825a));_0x1c89e7[_0x3b5744(0xf6)](_0x120755);}return _0x1c89e7;}static async['createRetrieveJob'](_0x288a4a){const _0x319836=a273_0x628376,_0x33d5e7=job_utils_1[_0x319836(0xf7)][_0x319836(0x115)](),_0x5ef573=path_1[_0x319836(0xf7)][_0x319836(0x117)](RetrieveMetadataService[_0x319836(0xf9)],_0x33d5e7);await(0x0,fs_utils_1[_0x319836(0xe4)])(_0x5ef573),await manifest_manger_1[_0x319836(0xf7)][_0x319836(0x120)](_0x5ef573,_0x288a4a),await state_manger_1['default'][_0x319836(0x120)](_0x5ef573,_0x33d5e7);const _0x25d141=path_1['default']['join'](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x319836(0xf7)][_0x319836(0x107)](_0x25d141,{'jobStorePath':_0x5ef573,'jobId':_0x33d5e7})[_0x319836(0x119)](async _0x416f99=>{const _0x47661d=_0x319836,_0x4132d3=new state_manger_1[(_0x47661d(0xf7))](_0x5ef573);await _0x4132d3[_0x47661d(0x105)](),await _0x4132d3[_0x47661d(0xfe)](_0x416f99);}),{'jobId':_0x33d5e7};}static async[a273_0x628376(0xed)](_0x3d735a){const _0x567497=a273_0x628376,{status:_0x30e6e3}=await RetrieveMetadataService[_0x567497(0x109)](_0x3d735a);if(_0x30e6e3===logger_enums_1[_0x567497(0xf2)][_0x567497(0xea)])throw new bad_request_error_1[(_0x567497(0x116))]('Job\x20not\x20completed.');const _0x5e1c87=path_1[_0x567497(0xf7)]['join'](RetrieveMetadataService[_0x567497(0xf9)],_0x3d735a,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x567497(0xff)][_0x567497(0xee)](_0x5e1c87))return(0x0,promises_1[_0x567497(0xfc)])(_0x5e1c87,_0x567497(0x11f))[_0x567497(0xe3)](JSON[_0x567497(0xec)]);else throw new not_found_error_1[(_0x567497(0x114))](_0x567497(0x101));}static async[a273_0x628376(0x103)](_0x26e3b6,_0x3693cb){const _0x47935b=a273_0x628376,{status:_0x5529ff}=await RetrieveMetadataService[_0x47935b(0x109)](_0x26e3b6);if(_0x5529ff===logger_enums_1[_0x47935b(0xf2)][_0x47935b(0xea)])throw new bad_request_error_1[(_0x47935b(0x116))](_0x47935b(0x106));const _0x181050=path_1[_0x47935b(0xf7)][_0x47935b(0x117)](RetrieveMetadataService[_0x47935b(0xf9)],_0x26e3b6,constants_1[_0x47935b(0x11a)]),_0x8e9cfc={'data':[]};if(await utils_1[_0x47935b(0xff)][_0x47935b(0xee)](path_1[_0x47935b(0xf7)][_0x47935b(0x117)](_0x181050,_0x3693cb+_0x47935b(0x10c))))_0x8e9cfc['data']=await(0x0,promises_1[_0x47935b(0xfc)])(path_1[_0x47935b(0xf7)]['join'](_0x181050,_0x3693cb+_0x47935b(0x10c)),_0x47935b(0x11f))[_0x47935b(0xe3)](JSON['parse']);else throw new not_found_error_1[(_0x47935b(0x114))]('Chunk\x20not\x20found.');return _0x8e9cfc;}static async[a273_0x628376(0x109)](_0x27739c){const _0x354b3b=a273_0x628376;try{return await state_manger_1[_0x354b3b(0xf7)][_0x354b3b(0x121)](path_1[_0x354b3b(0xf7)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x27739c));}catch(_0xcaae6b){throw new not_found_error_1[(_0x354b3b(0x114))](_0xcaae6b);}}static async[a273_0x628376(0xe9)](_0x4245ee){const _0x25cfce=a273_0x628376,_0x4971df=path_1[_0x25cfce(0xf7)][_0x25cfce(0x117)](RetrieveMetadataService[_0x25cfce(0xf9)],_0x4245ee,job_1[_0x25cfce(0x10b)]);if(await utils_1['FsUtils'][_0x25cfce(0xee)](_0x4971df))return(0x0,promises_1[_0x25cfce(0xfc)])(_0x4971df,_0x25cfce(0x11f))[_0x25cfce(0xe3)](_0x1cd981=>csv_utils_1[_0x25cfce(0xf7)][_0x25cfce(0xec)](_0x1cd981,{'columns':!![]}));throw new not_found_error_1[(_0x25cfce(0x114))](_0x25cfce(0x112));}}exports[a273_0x628376(0xf7)]=RetrieveMetadataService,RetrieveMetadataService[a273_0x628376(0xf9)]=path_1[a273_0x628376(0xf7)][a273_0x628376(0x117)](path_2[a273_0x628376(0x102)],constants_1[a273_0x628376(0xe7)]);