const a277_0x16e418=a277_0x2c63;(function(_0x21459d,_0x4ff871){const _0x39da9d=a277_0x2c63,_0x3f9713=_0x21459d();while(!![]){try{const _0x5e557d=parseInt(_0x39da9d(0xba))/0x1+-parseInt(_0x39da9d(0xbf))/0x2+parseInt(_0x39da9d(0x9b))/0x3+parseInt(_0x39da9d(0x9c))/0x4+-parseInt(_0x39da9d(0xa2))/0x5*(parseInt(_0x39da9d(0x93))/0x6)+parseInt(_0x39da9d(0x94))/0x7+parseInt(_0x39da9d(0xc5))/0x8;if(_0x5e557d===_0x4ff871)break;else _0x3f9713['push'](_0x3f9713['shift']());}catch(_0x5a00ee){_0x3f9713['push'](_0x3f9713['shift']());}}}(a277_0xfc20,0x254c9));function a277_0xfc20(){const _0x39e600=['../../../constants/job','constructor','isExistsPath','377502DoNZfz','397244ExvqwX','JOB_PATH','(((.+)+)+)+$','getJobStatus','getJobsIds','IN_PROGRESS','5CEjivZ','default','join','getJobs','JobStatus','sortJobsIds','../../shared/utils/csv.utils','Job\x20log\x20not\x20found.','push','RETRIEVE_METADATA_FOLDER_NAME','@flosum/utils','Job\x20not\x20completed.','../../shared/utils/fs.utils','getResultChunk','getJobState','apply','data','init','../../shared/managers/state-manger','Result\x20not\x20found.','NotFoundError','dataPath','slice','.json','204420ElyZKY','FsUtils','JOB_LOG_DETAILS_FILENAME','catch','setError','522632czXpag','../../../configs/path','then','getJobLogs','readFile','../job/classes/manifest-manger','45048cqkVDF','RETRIEVE_RESULT_FOLDER_NAME','generateJobId','utf-8','makeDir','Chunk\x20not\x20found.','../../shared/enums/logger.enums','runJob','__esModule','defineProperty','create','parse','fs/promises','toString','996918gHKJJt','1015350Swnhna','createRetrieveJob','retrieveMetadataFolder','search'];a277_0xfc20=function(){return _0x39e600;};return a277_0xfc20();}function a277_0x2c63(_0x4fecae,_0x5ef5f0){const _0x13b9cb=a277_0xfc20();return a277_0x2c63=function(_0x18d32d,_0x19ca66){_0x18d32d=_0x18d32d-0x90;let _0xfc20cd=_0x13b9cb[_0x18d32d];return _0xfc20cd;},a277_0x2c63(_0x4fecae,_0x5ef5f0);}const a277_0x19ca66=(function(){let _0x141f51=!![];return function(_0x25acc0,_0x4cdcfe){const _0x106717=_0x141f51?function(){const _0x50cc4a=a277_0x2c63;if(_0x4cdcfe){const _0xbe1f7b=_0x4cdcfe[_0x50cc4a(0xb1)](_0x25acc0,arguments);return _0x4cdcfe=null,_0xbe1f7b;}}:function(){};return _0x141f51=![],_0x106717;};}()),a277_0x18d32d=a277_0x19ca66(this,function(){const _0x27da77=a277_0x2c63;return a277_0x18d32d[_0x27da77(0x92)]()[_0x27da77(0x97)]('(((.+)+)+)+$')[_0x27da77(0x92)]()[_0x27da77(0x99)](a277_0x18d32d)[_0x27da77(0x97)](_0x27da77(0x9e));});a277_0x18d32d();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x509c91){return _0x509c91&&_0x509c91['__esModule']?_0x509c91:{'default':_0x509c91};};Object[a277_0x16e418(0xce)](exports,a277_0x16e418(0xcd),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require(a277_0x16e418(0xc4))),state_manger_1=__importDefault(require(a277_0x16e418(0xb4))),promises_1=require(a277_0x16e418(0x91)),utils_1=require(a277_0x16e418(0xac)),csv_utils_1=__importDefault(require(a277_0x16e418(0xa8))),not_found_error_1=require('../../../core/errors/not-found.error'),logger_enums_1=require(a277_0x16e418(0xcb)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require(a277_0x16e418(0x98)),fs_utils_1=require(a277_0x16e418(0xae)),constants_1=require('../constants'),path_2=require(a277_0x16e418(0xc0));class RetrieveMetadataService{static async[a277_0x16e418(0xa5)](_0x1fa692,_0x390b9f){const _0x299aeb=a277_0x16e418,_0x379ffb=await job_utils_1[_0x299aeb(0xa3)][_0x299aeb(0xa0)](RetrieveMetadataService[_0x299aeb(0x96)]),_0x4cd5d7=await job_utils_1[_0x299aeb(0xa3)][_0x299aeb(0xa7)](RetrieveMetadataService[_0x299aeb(0x96)],_0x379ffb),_0x1b907e=_0x4cd5d7[_0x299aeb(0xb8)](_0x390b9f,_0x390b9f+_0x1fa692),_0xea7803=[];for(const _0x145c55 of _0x1b907e){const _0x4cbd15=await state_manger_1['default'][_0x299aeb(0xb0)](path_1[_0x299aeb(0xa3)][_0x299aeb(0xa4)](RetrieveMetadataService[_0x299aeb(0x96)],_0x145c55));_0xea7803[_0x299aeb(0xaa)](_0x4cbd15);}return _0xea7803;}static async[a277_0x16e418(0x95)](_0x8f181c){const _0x5b4dd7=a277_0x16e418,_0x300182=job_utils_1[_0x5b4dd7(0xa3)][_0x5b4dd7(0xc7)](),_0x2b0eda=path_1['default'][_0x5b4dd7(0xa4)](RetrieveMetadataService['retrieveMetadataFolder'],_0x300182);await(0x0,fs_utils_1[_0x5b4dd7(0xc9)])(_0x2b0eda),await manifest_manger_1[_0x5b4dd7(0xa3)]['create'](_0x2b0eda,_0x8f181c),await state_manger_1['default'][_0x5b4dd7(0xcf)](_0x2b0eda,_0x300182);const _0xf2fe0c=path_1[_0x5b4dd7(0xa3)][_0x5b4dd7(0xa4)](__dirname,job_1[_0x5b4dd7(0x9d)]);return job_utils_1[_0x5b4dd7(0xa3)][_0x5b4dd7(0xcc)](_0xf2fe0c,{'jobStorePath':_0x2b0eda,'jobId':_0x300182})[_0x5b4dd7(0xbd)](async _0x13502d=>{const _0x2dd1d6=_0x5b4dd7,_0x30ae9a=new state_manger_1['default'](_0x2b0eda);await _0x30ae9a[_0x2dd1d6(0xb3)](),await _0x30ae9a[_0x2dd1d6(0xbe)](_0x13502d);}),{'jobId':_0x300182};}static async['getResult'](_0xc2233b){const _0x1b6583=a277_0x16e418,{status:_0xec032c}=await RetrieveMetadataService[_0x1b6583(0x9f)](_0xc2233b);if(_0xec032c===logger_enums_1['JobStatus'][_0x1b6583(0xa1)])throw new bad_request_error_1['BadRequestError'](_0x1b6583(0xad));const _0x2bd21e=path_1[_0x1b6583(0xa3)][_0x1b6583(0xa4)](RetrieveMetadataService[_0x1b6583(0x96)],_0xc2233b,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x1b6583(0xbb)][_0x1b6583(0x9a)](_0x2bd21e))return(0x0,promises_1['readFile'])(_0x2bd21e,_0x1b6583(0xc8))[_0x1b6583(0xc1)](JSON[_0x1b6583(0x90)]);else throw new not_found_error_1[(_0x1b6583(0xb6))](_0x1b6583(0xb5));}static async[a277_0x16e418(0xaf)](_0x1a2678,_0x4f338b){const _0x4162ae=a277_0x16e418,{status:_0x3b1c29}=await RetrieveMetadataService[_0x4162ae(0x9f)](_0x1a2678);if(_0x3b1c29===logger_enums_1[_0x4162ae(0xa6)][_0x4162ae(0xa1)])throw new bad_request_error_1['BadRequestError'](_0x4162ae(0xad));const _0x1cbe73=path_1['default']['join'](RetrieveMetadataService[_0x4162ae(0x96)],_0x1a2678,constants_1[_0x4162ae(0xc6)]),_0x1b4a5d={'data':[]};if(await utils_1[_0x4162ae(0xbb)][_0x4162ae(0x9a)](path_1[_0x4162ae(0xa3)][_0x4162ae(0xa4)](_0x1cbe73,_0x4f338b+_0x4162ae(0xb9))))_0x1b4a5d[_0x4162ae(0xb2)]=await(0x0,promises_1['readFile'])(path_1[_0x4162ae(0xa3)]['join'](_0x1cbe73,_0x4f338b+_0x4162ae(0xb9)),_0x4162ae(0xc8))[_0x4162ae(0xc1)](JSON[_0x4162ae(0x90)]);else throw new not_found_error_1[(_0x4162ae(0xb6))](_0x4162ae(0xca));return _0x1b4a5d;}static async[a277_0x16e418(0x9f)](_0x68c24f){const _0x51ccea=a277_0x16e418;try{return await state_manger_1[_0x51ccea(0xa3)][_0x51ccea(0xb0)](path_1[_0x51ccea(0xa3)][_0x51ccea(0xa4)](RetrieveMetadataService[_0x51ccea(0x96)],_0x68c24f));}catch(_0x10d90f){throw new not_found_error_1['NotFoundError'](_0x10d90f);}}static async[a277_0x16e418(0xc2)](_0x13fcb3){const _0x19bf0b=a277_0x16e418,_0x2f46d2=path_1[_0x19bf0b(0xa3)][_0x19bf0b(0xa4)](RetrieveMetadataService[_0x19bf0b(0x96)],_0x13fcb3,job_1[_0x19bf0b(0xbc)]);if(await utils_1[_0x19bf0b(0xbb)][_0x19bf0b(0x9a)](_0x2f46d2))return(0x0,promises_1[_0x19bf0b(0xc3)])(_0x2f46d2,_0x19bf0b(0xc8))[_0x19bf0b(0xc1)](_0x2d60fe=>csv_utils_1['default'][_0x19bf0b(0x90)](_0x2d60fe,{'columns':!![]}));throw new not_found_error_1[(_0x19bf0b(0xb6))](_0x19bf0b(0xa9));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService[a277_0x16e418(0x96)]=path_1[a277_0x16e418(0xa3)][a277_0x16e418(0xa4)](path_2[a277_0x16e418(0xb7)],constants_1[a277_0x16e418(0xab)]);