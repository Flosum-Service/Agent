const a320_0x555947=a320_0x44a8;(function(_0x4ce9f5,_0x1c7d28){const _0x3c818a=a320_0x44a8,_0x9703c9=_0x4ce9f5();while(!![]){try{const _0x34a46d=parseInt(_0x3c818a(0x172))/0x1*(-parseInt(_0x3c818a(0x15c))/0x2)+parseInt(_0x3c818a(0x152))/0x3+parseInt(_0x3c818a(0x14d))/0x4+parseInt(_0x3c818a(0x15f))/0x5*(parseInt(_0x3c818a(0x141))/0x6)+parseInt(_0x3c818a(0x165))/0x7+-parseInt(_0x3c818a(0x174))/0x8*(parseInt(_0x3c818a(0x149))/0x9)+parseInt(_0x3c818a(0x137))/0xa*(-parseInt(_0x3c818a(0x16e))/0xb);if(_0x34a46d===_0x1c7d28)break;else _0x9703c9['push'](_0x9703c9['shift']());}catch(_0x14abd5){_0x9703c9['push'](_0x9703c9['shift']());}}}(a320_0x1c65,0x75edc));const a320_0x4c8c14=(function(){let _0x581c9c=!![];return function(_0x2c75e2,_0x4da9c9){const _0x51222d=_0x581c9c?function(){const _0x3a9e28=a320_0x44a8;if(_0x4da9c9){const _0x1ac1ce=_0x4da9c9[_0x3a9e28(0x14f)](_0x2c75e2,arguments);return _0x4da9c9=null,_0x1ac1ce;}}:function(){};return _0x581c9c=![],_0x51222d;};}()),a320_0x33171c=a320_0x4c8c14(this,function(){const _0x5beb0c=a320_0x44a8;return a320_0x33171c[_0x5beb0c(0x16f)]()['search'](_0x5beb0c(0x159))[_0x5beb0c(0x16f)]()[_0x5beb0c(0x16b)](a320_0x33171c)['search'](_0x5beb0c(0x159));});a320_0x33171c();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x250156){return _0x250156&&_0x250156['__esModule']?_0x250156:{'default':_0x250156};};Object[a320_0x555947(0x15a)](exports,a320_0x555947(0x15b),{'value':!![]});function a320_0x44a8(_0x23f28a,_0x4c7e12){const _0x15f226=a320_0x1c65();return a320_0x44a8=function(_0x33171c,_0x4c8c14){_0x33171c=_0x33171c-0x135;let _0x1c6587=_0x15f226[_0x33171c];return _0x1c6587;},a320_0x44a8(_0x23f28a,_0x4c7e12);}const job_utils_1=__importDefault(require(a320_0x555947(0x136))),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require(a320_0x555947(0x13e))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require(a320_0x555947(0x144)),utils_1=require(a320_0x555947(0x166)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a320_0x555947(0x148)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require(a320_0x555947(0x161)),job_1=require(a320_0x555947(0x147)),fs_utils_1=require(a320_0x555947(0x14c)),constants_1=require(a320_0x555947(0x177)),path_2=require(a320_0x555947(0x157));class RetrieveMetadataService{static async[a320_0x555947(0x162)](_0x50357f,_0x52f441){const _0x24da14=a320_0x555947,_0x3ced7a=await job_utils_1[_0x24da14(0x160)][_0x24da14(0x16a)](RetrieveMetadataService['retrieveMetadataFolder']),_0x315408=await job_utils_1[_0x24da14(0x160)][_0x24da14(0x142)](RetrieveMetadataService['retrieveMetadataFolder'],_0x3ced7a),_0xd2081d=_0x315408['slice'](_0x52f441,_0x52f441+_0x50357f),_0x17345b=[];for(const _0x21fb88 of _0xd2081d){const _0x36f756=await state_manger_1[_0x24da14(0x160)][_0x24da14(0x13b)](path_1[_0x24da14(0x160)][_0x24da14(0x14e)](RetrieveMetadataService[_0x24da14(0x153)],_0x21fb88));_0x17345b[_0x24da14(0x13a)](_0x36f756);}return _0x17345b;}static async[a320_0x555947(0x145)](_0x4a2d46){const _0x3b319c=a320_0x555947,_0x58b36f=job_utils_1[_0x3b319c(0x160)][_0x3b319c(0x173)](),_0x51ca20=path_1[_0x3b319c(0x160)]['join'](RetrieveMetadataService[_0x3b319c(0x153)],_0x58b36f);await(0x0,fs_utils_1[_0x3b319c(0x176)])(_0x51ca20),await manifest_manger_1[_0x3b319c(0x160)][_0x3b319c(0x143)](_0x51ca20,_0x4a2d46),await state_manger_1[_0x3b319c(0x160)]['create'](_0x51ca20,_0x58b36f);const _0x5d7156=path_1[_0x3b319c(0x160)][_0x3b319c(0x14e)](__dirname,job_1[_0x3b319c(0x138)]);return job_utils_1[_0x3b319c(0x160)][_0x3b319c(0x151)](_0x5d7156,{'jobStorePath':_0x51ca20,'jobId':_0x58b36f})[_0x3b319c(0x139)](async _0xaa5ba2=>{const _0x134791=_0x3b319c,_0x5d3966=new state_manger_1[(_0x134791(0x160))](_0x51ca20);await _0x5d3966[_0x134791(0x170)](),await _0x5d3966[_0x134791(0x13d)](_0xaa5ba2);}),{'jobId':_0x58b36f};}static async[a320_0x555947(0x16d)](_0x3d9e78){const _0xe62abc=a320_0x555947,{status:_0x2c278b}=await RetrieveMetadataService[_0xe62abc(0x158)](_0x3d9e78);if(_0x2c278b===logger_enums_1[_0xe62abc(0x168)]['IN_PROGRESS'])throw new bad_request_error_1[(_0xe62abc(0x146))](_0xe62abc(0x156));const _0x58178d=path_1[_0xe62abc(0x160)][_0xe62abc(0x14e)](RetrieveMetadataService[_0xe62abc(0x153)],_0x3d9e78,constants_1[_0xe62abc(0x16c)]);if(await utils_1['FsUtils'][_0xe62abc(0x155)](_0x58178d))return(0x0,promises_1[_0xe62abc(0x13f)])(_0x58178d,_0xe62abc(0x171))[_0xe62abc(0x14b)](JSON[_0xe62abc(0x15d)]);else throw new not_found_error_1[(_0xe62abc(0x169))](_0xe62abc(0x175));}static async[a320_0x555947(0x135)](_0x209be2,_0x3d6e90){const _0xe9a6be=a320_0x555947,{status:_0x2ae3d7}=await RetrieveMetadataService[_0xe9a6be(0x158)](_0x209be2);if(_0x2ae3d7===logger_enums_1[_0xe9a6be(0x168)][_0xe9a6be(0x13c)])throw new bad_request_error_1[(_0xe9a6be(0x146))](_0xe9a6be(0x156));const _0x4b0857=path_1['default']['join'](RetrieveMetadataService[_0xe9a6be(0x153)],_0x209be2,constants_1[_0xe9a6be(0x163)]),_0x1de46f={'data':[]};if(await utils_1[_0xe9a6be(0x14a)][_0xe9a6be(0x155)](path_1[_0xe9a6be(0x160)][_0xe9a6be(0x14e)](_0x4b0857,_0x3d6e90+_0xe9a6be(0x154))))_0x1de46f[_0xe9a6be(0x178)]=await(0x0,promises_1[_0xe9a6be(0x13f)])(path_1['default'][_0xe9a6be(0x14e)](_0x4b0857,_0x3d6e90+_0xe9a6be(0x154)),'utf-8')['then'](JSON[_0xe9a6be(0x15d)]);else throw new not_found_error_1[(_0xe9a6be(0x169))]('Chunk\x20not\x20found.');return _0x1de46f;}static async[a320_0x555947(0x158)](_0x5df60b){const _0x2a74a8=a320_0x555947;try{return await state_manger_1[_0x2a74a8(0x160)][_0x2a74a8(0x13b)](path_1[_0x2a74a8(0x160)][_0x2a74a8(0x14e)](RetrieveMetadataService[_0x2a74a8(0x153)],_0x5df60b));}catch(_0x32f0ab){throw new not_found_error_1[(_0x2a74a8(0x169))](_0x32f0ab);}}static async[a320_0x555947(0x164)](_0x48f63e){const _0x2b2a92=a320_0x555947,_0x5ba71e=path_1[_0x2b2a92(0x160)][_0x2b2a92(0x14e)](RetrieveMetadataService[_0x2b2a92(0x153)],_0x48f63e,job_1[_0x2b2a92(0x167)]);if(await utils_1[_0x2b2a92(0x14a)][_0x2b2a92(0x155)](_0x5ba71e))return(0x0,promises_1['readFile'])(_0x5ba71e,'utf-8')[_0x2b2a92(0x14b)](_0x91aa9e=>csv_utils_1[_0x2b2a92(0x160)][_0x2b2a92(0x15d)](_0x91aa9e,{'columns':!![]}));throw new not_found_error_1[(_0x2b2a92(0x169))](_0x2b2a92(0x140));}}function a320_0x1c65(){const _0x5587f4=['(((.+)+)+)+$','defineProperty','__esModule','65922rNuSEz','parse','RETRIEVE_METADATA_FOLDER_NAME','2873215SMfEvM','default','../../../core/errors/bad-request.error','getJobs','RETRIEVE_RESULT_FOLDER_NAME','getJobLogs','4732784hnfphz','@flosum/utils','JOB_LOG_DETAILS_FILENAME','JobStatus','NotFoundError','getJobsIds','constructor','RETRIEVE_RESULTS_IDS_FILENAME','getResult','537218dnaGBg','toString','init','utf-8','25zChKjo','generateJobId','16HOWrNp','Result\x20not\x20found.','makeDir','../constants','data','getResultChunk','../../shared/utils/job.utils','190wslaYF','JOB_PATH','catch','push','getJobState','IN_PROGRESS','setError','../job/classes/manifest-manger','readFile','Job\x20log\x20not\x20found.','6TtXkZQ','sortJobsIds','create','fs/promises','createRetrieveJob','BadRequestError','../../../constants/job','../../../core/errors/not-found.error','476163kLrLyY','FsUtils','then','../../shared/utils/fs.utils','704272tysqTv','join','apply','dataPath','runJob','2741922qDQyNi','retrieveMetadataFolder','.json','isExistsPath','Job\x20not\x20completed.','../../../configs/path','getJobStatus'];a320_0x1c65=function(){return _0x5587f4;};return a320_0x1c65();}exports[a320_0x555947(0x160)]=RetrieveMetadataService,RetrieveMetadataService[a320_0x555947(0x153)]=path_1[a320_0x555947(0x160)][a320_0x555947(0x14e)](path_2[a320_0x555947(0x150)],constants_1[a320_0x555947(0x15e)]);