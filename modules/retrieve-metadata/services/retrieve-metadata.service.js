const a277_0x127ec3=a277_0x4376;(function(_0xc49e0c,_0x48dc5a){const _0x509fe4=a277_0x4376,_0xce49e7=_0xc49e0c();while(!![]){try{const _0x5daf1e=parseInt(_0x509fe4(0xee))/0x1*(parseInt(_0x509fe4(0xed))/0x2)+-parseInt(_0x509fe4(0xf2))/0x3+parseInt(_0x509fe4(0x10e))/0x4*(parseInt(_0x509fe4(0xf0))/0x5)+-parseInt(_0x509fe4(0xe6))/0x6*(-parseInt(_0x509fe4(0x108))/0x7)+-parseInt(_0x509fe4(0xf8))/0x8*(-parseInt(_0x509fe4(0xe2))/0x9)+parseInt(_0x509fe4(0xf1))/0xa*(-parseInt(_0x509fe4(0xe4))/0xb)+parseInt(_0x509fe4(0x102))/0xc;if(_0x5daf1e===_0x48dc5a)break;else _0xce49e7['push'](_0xce49e7['shift']());}catch(_0xf07dd2){_0xce49e7['push'](_0xce49e7['shift']());}}}(a277_0x39fb,0x92bfd));const a277_0x15ff04=(function(){let _0x1b35b2=!![];return function(_0x278ce8,_0x277534){const _0x4cba24=_0x1b35b2?function(){const _0x220b22=a277_0x4376;if(_0x277534){const _0x3b04c6=_0x277534[_0x220b22(0xfa)](_0x278ce8,arguments);return _0x277534=null,_0x3b04c6;}}:function(){};return _0x1b35b2=![],_0x4cba24;};}()),a277_0xdccbed=a277_0x15ff04(this,function(){const _0x58cab3=a277_0x4376;return a277_0xdccbed[_0x58cab3(0x115)]()[_0x58cab3(0x10b)](_0x58cab3(0xec))['toString']()[_0x58cab3(0x10c)](a277_0xdccbed)[_0x58cab3(0x10b)](_0x58cab3(0xec));});a277_0xdccbed();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x50881b){const _0x49d816=a277_0x4376;return _0x50881b&&_0x50881b[_0x49d816(0x104)]?_0x50881b:{'default':_0x50881b};};function a277_0x39fb(){const _0x4d8bfe=['join','FsUtils','setError','default','retrieveMetadataFolder','(((.+)+)+)+$','45022jDxlos','11qgwgbo','RETRIEVE_RESULT_FOLDER_NAME','55Yggiet','4377640atGZHY','2027376cTRgRg','fs/promises','data','create','makeDir','createRetrieveJob','8819544XQTITq','Job\x20log\x20not\x20found.','apply','dataPath','sortJobsIds','../../../core/errors/not-found.error','../../shared/enums/logger.enums','getJobStatus','runJob','getResultChunk','460764qFSaGe','getJobState','__esModule','init','../../shared/utils/csv.utils','.json','665gcPLXP','../../../core/errors/bad-request.error','RETRIEVE_METADATA_FOLDER_NAME','search','constructor','../../shared/managers/state-manger','268436mrLumB','parse','BadRequestError','push','JOB_PATH','IN_PROGRESS','../../shared/utils/job.utils','toString','then','../../../configs/path','Job\x20not\x20completed.','slice','../../../constants/job','readFile','JOB_LOG_DETAILS_FILENAME','NotFoundError','utf-8','getResult','JobStatus','path','9zUdlSm','getJobsIds','22PCICJK','getJobs','1626pzzAuA'];a277_0x39fb=function(){return _0x4d8bfe;};return a277_0x39fb();}Object['defineProperty'](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a277_0x127ec3(0x114))),path_1=__importDefault(require(a277_0x127ec3(0x121))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a277_0x127ec3(0x10d))),promises_1=require(a277_0x127ec3(0xf3)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a277_0x127ec3(0x106))),not_found_error_1=require(a277_0x127ec3(0xfd)),logger_enums_1=require(a277_0x127ec3(0xfe)),bad_request_error_1=require(a277_0x127ec3(0x109)),job_1=require(a277_0x127ec3(0x11a)),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require('../constants'),path_2=require(a277_0x127ec3(0x117));function a277_0x4376(_0x5a4be7,_0x55eaa6){const _0x50a37=a277_0x39fb();return a277_0x4376=function(_0xdccbed,_0x15ff04){_0xdccbed=_0xdccbed-0xe2;let _0x39fb12=_0x50a37[_0xdccbed];return _0x39fb12;},a277_0x4376(_0x5a4be7,_0x55eaa6);}class RetrieveMetadataService{static async[a277_0x127ec3(0xe5)](_0x4d14fe,_0x999fe3){const _0x1e575a=a277_0x127ec3,_0x25b118=await job_utils_1[_0x1e575a(0xea)][_0x1e575a(0xe3)](RetrieveMetadataService[_0x1e575a(0xeb)]),_0x2b2751=await job_utils_1['default'][_0x1e575a(0xfc)](RetrieveMetadataService['retrieveMetadataFolder'],_0x25b118),_0x56ca71=_0x2b2751[_0x1e575a(0x119)](_0x999fe3,_0x999fe3+_0x4d14fe),_0x3abbf2=[];for(const _0x571ce5 of _0x56ca71){const _0x44af05=await state_manger_1[_0x1e575a(0xea)][_0x1e575a(0x103)](path_1[_0x1e575a(0xea)][_0x1e575a(0xe7)](RetrieveMetadataService['retrieveMetadataFolder'],_0x571ce5));_0x3abbf2[_0x1e575a(0x111)](_0x44af05);}return _0x3abbf2;}static async[a277_0x127ec3(0xf7)](_0x5da055){const _0x1d444d=a277_0x127ec3,_0x464fe0=job_utils_1[_0x1d444d(0xea)]['generateJobId'](),_0x280672=path_1[_0x1d444d(0xea)][_0x1d444d(0xe7)](RetrieveMetadataService[_0x1d444d(0xeb)],_0x464fe0);await(0x0,fs_utils_1[_0x1d444d(0xf6)])(_0x280672),await manifest_manger_1[_0x1d444d(0xea)][_0x1d444d(0xf5)](_0x280672,_0x5da055),await state_manger_1[_0x1d444d(0xea)]['create'](_0x280672,_0x464fe0);const _0x36615a=path_1[_0x1d444d(0xea)][_0x1d444d(0xe7)](__dirname,job_1[_0x1d444d(0x112)]);return job_utils_1[_0x1d444d(0xea)][_0x1d444d(0x100)](_0x36615a,{'jobStorePath':_0x280672,'jobId':_0x464fe0})['catch'](async _0x5bff0f=>{const _0x30c22a=_0x1d444d,_0x1a5c13=new state_manger_1[(_0x30c22a(0xea))](_0x280672);await _0x1a5c13[_0x30c22a(0x105)](),await _0x1a5c13[_0x30c22a(0xe9)](_0x5bff0f);}),{'jobId':_0x464fe0};}static async[a277_0x127ec3(0x11f)](_0x24372d){const _0x567ee3=a277_0x127ec3,{status:_0x18714c}=await RetrieveMetadataService['getJobStatus'](_0x24372d);if(_0x18714c===logger_enums_1[_0x567ee3(0x120)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x567ee3(0x110))]('Job\x20not\x20completed.');const _0x459ce2=path_1[_0x567ee3(0xea)][_0x567ee3(0xe7)](RetrieveMetadataService[_0x567ee3(0xeb)],_0x24372d,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x567ee3(0xe8)]['isExistsPath'](_0x459ce2))return(0x0,promises_1['readFile'])(_0x459ce2,_0x567ee3(0x11e))[_0x567ee3(0x116)](JSON[_0x567ee3(0x10f)]);else throw new not_found_error_1['NotFoundError']('Result\x20not\x20found.');}static async[a277_0x127ec3(0x101)](_0x4d83f1,_0x19f3ef){const _0x395661=a277_0x127ec3,{status:_0x498f17}=await RetrieveMetadataService[_0x395661(0xff)](_0x4d83f1);if(_0x498f17===logger_enums_1[_0x395661(0x120)][_0x395661(0x113)])throw new bad_request_error_1[(_0x395661(0x110))](_0x395661(0x118));const _0x180634=path_1[_0x395661(0xea)]['join'](RetrieveMetadataService[_0x395661(0xeb)],_0x4d83f1,constants_1[_0x395661(0xef)]),_0x5dafb3={'data':[]};if(await utils_1['FsUtils']['isExistsPath'](path_1['default'][_0x395661(0xe7)](_0x180634,_0x19f3ef+_0x395661(0x107))))_0x5dafb3[_0x395661(0xf4)]=await(0x0,promises_1[_0x395661(0x11b)])(path_1[_0x395661(0xea)][_0x395661(0xe7)](_0x180634,_0x19f3ef+_0x395661(0x107)),_0x395661(0x11e))[_0x395661(0x116)](JSON['parse']);else throw new not_found_error_1[(_0x395661(0x11d))]('Chunk\x20not\x20found.');return _0x5dafb3;}static async['getJobStatus'](_0x57c659){const _0x44515b=a277_0x127ec3;try{return await state_manger_1[_0x44515b(0xea)][_0x44515b(0x103)](path_1[_0x44515b(0xea)][_0x44515b(0xe7)](RetrieveMetadataService[_0x44515b(0xeb)],_0x57c659));}catch(_0x4a6e55){throw new not_found_error_1[(_0x44515b(0x11d))](_0x4a6e55);}}static async['getJobLogs'](_0x46662b){const _0x450a91=a277_0x127ec3,_0x147253=path_1[_0x450a91(0xea)]['join'](RetrieveMetadataService[_0x450a91(0xeb)],_0x46662b,job_1[_0x450a91(0x11c)]);if(await utils_1[_0x450a91(0xe8)]['isExistsPath'](_0x147253))return(0x0,promises_1[_0x450a91(0x11b)])(_0x147253,'utf-8')[_0x450a91(0x116)](_0x349a88=>csv_utils_1[_0x450a91(0xea)][_0x450a91(0x10f)](_0x349a88,{'columns':!![]}));throw new not_found_error_1[(_0x450a91(0x11d))](_0x450a91(0xf9));}}exports[a277_0x127ec3(0xea)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a277_0x127ec3(0xea)][a277_0x127ec3(0xe7)](path_2[a277_0x127ec3(0xfb)],constants_1[a277_0x127ec3(0x10a)]);