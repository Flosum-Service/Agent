const a319_0x15a91f=a319_0x3003;(function(_0x63260,_0x215b23){const _0x187727=a319_0x3003,_0x50f4bc=_0x63260();while(!![]){try{const _0x2c0d83=-parseInt(_0x187727(0x1f6))/0x1*(-parseInt(_0x187727(0x1c3))/0x2)+-parseInt(_0x187727(0x1f1))/0x3*(-parseInt(_0x187727(0x1f5))/0x4)+-parseInt(_0x187727(0x1d9))/0x5+parseInt(_0x187727(0x1fa))/0x6+-parseInt(_0x187727(0x1c6))/0x7+parseInt(_0x187727(0x1f8))/0x8*(parseInt(_0x187727(0x1e8))/0x9)+parseInt(_0x187727(0x1db))/0xa;if(_0x2c0d83===_0x215b23)break;else _0x50f4bc['push'](_0x50f4bc['shift']());}catch(_0x34eb20){_0x50f4bc['push'](_0x50f4bc['shift']());}}}(a319_0x3bcf,0xaf853));function a319_0x3003(_0x27744d,_0x9b7d68){const _0x48920c=a319_0x3bcf();return a319_0x3003=function(_0x226bfb,_0x4805e0){_0x226bfb=_0x226bfb-0x1c3;let _0x3bcfea=_0x48920c[_0x226bfb];return _0x3bcfea;},a319_0x3003(_0x27744d,_0x9b7d68);}const a319_0x4805e0=(function(){let _0x58ddb3=!![];return function(_0x398b40,_0x3c7c5a){const _0x1faf86=_0x58ddb3?function(){if(_0x3c7c5a){const _0x33f2ab=_0x3c7c5a['apply'](_0x398b40,arguments);return _0x3c7c5a=null,_0x33f2ab;}}:function(){};return _0x58ddb3=![],_0x1faf86;};}()),a319_0x226bfb=a319_0x4805e0(this,function(){const _0x33f256=a319_0x3003;return a319_0x226bfb[_0x33f256(0x1ee)]()['search'](_0x33f256(0x1e9))['toString']()['constructor'](a319_0x226bfb)[_0x33f256(0x1fd)]('(((.+)+)+)+$');});a319_0x226bfb();'use strict';function a319_0x3bcf(){const _0x476016=['makeDir','JOB_PATH','45195yBDfHs','setError','getJobStatus','IN_PROGRESS','148VZNLbV','1MOVWNd','RETRIEVE_RESULT_FOLDER_NAME','500344bIPfRr','getJobs','4501410qHsBKg','getJobsIds','readFile','search','466030NcWCxq','join','dataPath','7797209XBMhsg','../../shared/utils/fs.utils','RETRIEVE_METADATA_FOLDER_NAME','runJob','Result\x20not\x20found.','init','Job\x20not\x20completed.','Job\x20log\x20not\x20found.','push','../../../constants/job','.json','generateJobId','JobStatus','../constants','Chunk\x20not\x20found.','__importDefault','__esModule','isExistsPath','getJobState','5974945OWvKOS','createRetrieveJob','11744370MztZPk','BadRequestError','../../shared/utils/csv.utils','then','retrieveMetadataFolder','utf-8','../../../configs/path','parse','NotFoundError','../../shared/managers/state-manger','data','RETRIEVE_RESULTS_IDS_FILENAME','default','45jWfDYF','(((.+)+)+)+$','FsUtils','catch','create','fs/promises','toString'];a319_0x3bcf=function(){return _0x476016;};return a319_0x3bcf();}var __importDefault=this&&this[a319_0x15a91f(0x1d5)]||function(_0x1d7e25){const _0x344110=a319_0x15a91f;return _0x1d7e25&&_0x1d7e25[_0x344110(0x1d6)]?_0x1d7e25:{'default':_0x1d7e25};};Object['defineProperty'](exports,a319_0x15a91f(0x1d6),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a319_0x15a91f(0x1e4))),promises_1=require(a319_0x15a91f(0x1ed)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a319_0x15a91f(0x1dd))),not_found_error_1=require('../../../core/errors/not-found.error'),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require(a319_0x15a91f(0x1cf)),fs_utils_1=require(a319_0x15a91f(0x1c7)),constants_1=require(a319_0x15a91f(0x1d3)),path_2=require(a319_0x15a91f(0x1e1));class RetrieveMetadataService{static async[a319_0x15a91f(0x1f9)](_0x2b3352,_0xc64b33){const _0x1bdc3e=a319_0x15a91f,_0x46bd5b=await job_utils_1['default'][_0x1bdc3e(0x1fb)](RetrieveMetadataService['retrieveMetadataFolder']),_0x2ffebf=await job_utils_1[_0x1bdc3e(0x1e7)]['sortJobsIds'](RetrieveMetadataService['retrieveMetadataFolder'],_0x46bd5b),_0x2a5ce4=_0x2ffebf['slice'](_0xc64b33,_0xc64b33+_0x2b3352),_0x11e419=[];for(const _0x26560a of _0x2a5ce4){const _0x5cdcfc=await state_manger_1[_0x1bdc3e(0x1e7)]['getJobState'](path_1[_0x1bdc3e(0x1e7)][_0x1bdc3e(0x1c4)](RetrieveMetadataService[_0x1bdc3e(0x1df)],_0x26560a));_0x11e419[_0x1bdc3e(0x1ce)](_0x5cdcfc);}return _0x11e419;}static async[a319_0x15a91f(0x1da)](_0x22856b){const _0x107102=a319_0x15a91f,_0x700b4e=job_utils_1['default'][_0x107102(0x1d1)](),_0x592cab=path_1[_0x107102(0x1e7)][_0x107102(0x1c4)](RetrieveMetadataService[_0x107102(0x1df)],_0x700b4e);await(0x0,fs_utils_1[_0x107102(0x1ef)])(_0x592cab),await manifest_manger_1[_0x107102(0x1e7)]['create'](_0x592cab,_0x22856b),await state_manger_1[_0x107102(0x1e7)][_0x107102(0x1ec)](_0x592cab,_0x700b4e);const _0x51e995=path_1['default'][_0x107102(0x1c4)](__dirname,job_1[_0x107102(0x1f0)]);return job_utils_1[_0x107102(0x1e7)][_0x107102(0x1c9)](_0x51e995,{'jobStorePath':_0x592cab,'jobId':_0x700b4e})[_0x107102(0x1eb)](async _0x541ac8=>{const _0x37d404=_0x107102,_0x3196fa=new state_manger_1['default'](_0x592cab);await _0x3196fa[_0x37d404(0x1cb)](),await _0x3196fa[_0x37d404(0x1f2)](_0x541ac8);}),{'jobId':_0x700b4e};}static async['getResult'](_0x50f32e){const _0x1ff365=a319_0x15a91f,{status:_0x4c1079}=await RetrieveMetadataService[_0x1ff365(0x1f3)](_0x50f32e);if(_0x4c1079===logger_enums_1[_0x1ff365(0x1d2)][_0x1ff365(0x1f4)])throw new bad_request_error_1[(_0x1ff365(0x1dc))](_0x1ff365(0x1cc));const _0x5ad449=path_1[_0x1ff365(0x1e7)][_0x1ff365(0x1c4)](RetrieveMetadataService[_0x1ff365(0x1df)],_0x50f32e,constants_1[_0x1ff365(0x1e6)]);if(await utils_1[_0x1ff365(0x1ea)][_0x1ff365(0x1d7)](_0x5ad449))return(0x0,promises_1['readFile'])(_0x5ad449,_0x1ff365(0x1e0))[_0x1ff365(0x1de)](JSON[_0x1ff365(0x1e2)]);else throw new not_found_error_1['NotFoundError'](_0x1ff365(0x1ca));}static async['getResultChunk'](_0x567235,_0x56b779){const _0xf0a175=a319_0x15a91f,{status:_0x3377fd}=await RetrieveMetadataService[_0xf0a175(0x1f3)](_0x567235);if(_0x3377fd===logger_enums_1[_0xf0a175(0x1d2)]['IN_PROGRESS'])throw new bad_request_error_1[(_0xf0a175(0x1dc))](_0xf0a175(0x1cc));const _0x1e0cc1=path_1['default'][_0xf0a175(0x1c4)](RetrieveMetadataService['retrieveMetadataFolder'],_0x567235,constants_1[_0xf0a175(0x1f7)]),_0x56e1f4={'data':[]};if(await utils_1['FsUtils']['isExistsPath'](path_1[_0xf0a175(0x1e7)][_0xf0a175(0x1c4)](_0x1e0cc1,_0x56b779+_0xf0a175(0x1d0))))_0x56e1f4[_0xf0a175(0x1e5)]=await(0x0,promises_1['readFile'])(path_1[_0xf0a175(0x1e7)][_0xf0a175(0x1c4)](_0x1e0cc1,_0x56b779+_0xf0a175(0x1d0)),_0xf0a175(0x1e0))[_0xf0a175(0x1de)](JSON['parse']);else throw new not_found_error_1[(_0xf0a175(0x1e3))](_0xf0a175(0x1d4));return _0x56e1f4;}static async[a319_0x15a91f(0x1f3)](_0x397314){const _0xc21dc7=a319_0x15a91f;try{return await state_manger_1['default'][_0xc21dc7(0x1d8)](path_1[_0xc21dc7(0x1e7)]['join'](RetrieveMetadataService[_0xc21dc7(0x1df)],_0x397314));}catch(_0x4fd662){throw new not_found_error_1[(_0xc21dc7(0x1e3))](_0x4fd662);}}static async['getJobLogs'](_0x1f790e){const _0x313b9e=a319_0x15a91f,_0x333aed=path_1['default']['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x1f790e,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1['FsUtils'][_0x313b9e(0x1d7)](_0x333aed))return(0x0,promises_1[_0x313b9e(0x1fc)])(_0x333aed,_0x313b9e(0x1e0))[_0x313b9e(0x1de)](_0x295bcf=>csv_utils_1['default'][_0x313b9e(0x1e2)](_0x295bcf,{'columns':!![]}));throw new not_found_error_1[(_0x313b9e(0x1e3))](_0x313b9e(0x1cd));}}exports[a319_0x15a91f(0x1e7)]=RetrieveMetadataService,RetrieveMetadataService[a319_0x15a91f(0x1df)]=path_1[a319_0x15a91f(0x1e7)][a319_0x15a91f(0x1c4)](path_2[a319_0x15a91f(0x1c5)],constants_1[a319_0x15a91f(0x1c8)]);