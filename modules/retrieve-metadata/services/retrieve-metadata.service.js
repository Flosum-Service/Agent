const a319_0x4cb337=a319_0x294f;function a319_0x294f(_0x110c37,_0x166453){const _0x62a319=a319_0x1426();return a319_0x294f=function(_0x228ed2,_0x21e104){_0x228ed2=_0x228ed2-0x175;let _0x1426f0=_0x62a319[_0x228ed2];return _0x1426f0;},a319_0x294f(_0x110c37,_0x166453);}function a319_0x1426(){const _0x10b3e4=['RETRIEVE_RESULTS_IDS_FILENAME','getJobsIds','slice','init','getResultChunk','join','generateJobId','data','NotFoundError','__importDefault','438662lWCbnn','push','84RZXomA','Job\x20not\x20completed.','toString','catch','1242714nFcUIm','JOB_LOG_DETAILS_FILENAME','makeDir','1922608YKJMqn','create','isExistsPath','(((.+)+)+)+$','RETRIEVE_METADATA_FOLDER_NAME','retrieveMetadataFolder','sortJobsIds','__esModule','parse','utf-8','../../shared/managers/state-manger','getJobState','readFile','Result\x20not\x20found.','getJobStatus','RETRIEVE_RESULT_FOLDER_NAME','BadRequestError','Chunk\x20not\x20found.','../../../configs/path','getResult','52310YwBysB','123008xyPYGq','JobStatus','JOB_PATH','../../shared/utils/csv.utils','../../shared/enums/logger.enums','18045972dOXchG','apply','search','constructor','default','../../../constants/job','56QfkhFk','../../../core/errors/bad-request.error','createRetrieveJob','FsUtils','@flosum/utils','setError','dataPath','path','then','defineProperty','IN_PROGRESS','176656XKtzNw'];a319_0x1426=function(){return _0x10b3e4;};return a319_0x1426();}(function(_0x197a90,_0x3dd1a3){const _0x58a892=a319_0x294f,_0x5bb5ab=_0x197a90();while(!![]){try{const _0x52d974=-parseInt(_0x58a892(0x185))/0x1+-parseInt(_0x58a892(0x1ae))/0x2+-parseInt(_0x58a892(0x196))/0x3+-parseInt(_0x58a892(0x199))/0x4+parseInt(_0x58a892(0x1ad))/0x5*(-parseInt(_0x58a892(0x192))/0x6)+parseInt(_0x58a892(0x190))/0x7*(-parseInt(_0x58a892(0x17a))/0x8)+parseInt(_0x58a892(0x1b3))/0x9;if(_0x52d974===_0x3dd1a3)break;else _0x5bb5ab['push'](_0x5bb5ab['shift']());}catch(_0x27dd13){_0x5bb5ab['push'](_0x5bb5ab['shift']());}}}(a319_0x1426,0x460d0));const a319_0x21e104=(function(){let _0x1de0c9=!![];return function(_0x446db5,_0x254fe){const _0x1a5edb=_0x1de0c9?function(){const _0x2f7640=a319_0x294f;if(_0x254fe){const _0x56a0c7=_0x254fe[_0x2f7640(0x175)](_0x446db5,arguments);return _0x254fe=null,_0x56a0c7;}}:function(){};return _0x1de0c9=![],_0x1a5edb;};}()),a319_0x228ed2=a319_0x21e104(this,function(){const _0x14fbc9=a319_0x294f;return a319_0x228ed2['toString']()['search'](_0x14fbc9(0x19c))[_0x14fbc9(0x194)]()[_0x14fbc9(0x177)](a319_0x228ed2)[_0x14fbc9(0x176)](_0x14fbc9(0x19c));});a319_0x228ed2();'use strict';var __importDefault=this&&this[a319_0x4cb337(0x18f)]||function(_0x32c245){const _0x9b888d=a319_0x4cb337;return _0x32c245&&_0x32c245[_0x9b888d(0x1a0)]?_0x32c245:{'default':_0x32c245};};Object[a319_0x4cb337(0x183)](exports,a319_0x4cb337(0x1a0),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a319_0x4cb337(0x181))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a319_0x4cb337(0x1a3))),promises_1=require('fs/promises'),utils_1=require(a319_0x4cb337(0x17e)),csv_utils_1=__importDefault(require(a319_0x4cb337(0x1b1))),not_found_error_1=require('../../../core/errors/not-found.error'),logger_enums_1=require(a319_0x4cb337(0x1b2)),bad_request_error_1=require(a319_0x4cb337(0x17b)),job_1=require(a319_0x4cb337(0x179)),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require('../constants'),path_2=require(a319_0x4cb337(0x1ab));class RetrieveMetadataService{static async['getJobs'](_0x34901f,_0x4c43f2){const _0x4a2803=a319_0x4cb337,_0x5026de=await job_utils_1[_0x4a2803(0x178)][_0x4a2803(0x187)](RetrieveMetadataService['retrieveMetadataFolder']),_0x3641f5=await job_utils_1[_0x4a2803(0x178)][_0x4a2803(0x19f)](RetrieveMetadataService[_0x4a2803(0x19e)],_0x5026de),_0x4a23a3=_0x3641f5[_0x4a2803(0x188)](_0x4c43f2,_0x4c43f2+_0x34901f),_0x7309ac=[];for(const _0x52fdf9 of _0x4a23a3){const _0x2a4b97=await state_manger_1[_0x4a2803(0x178)][_0x4a2803(0x1a4)](path_1[_0x4a2803(0x178)][_0x4a2803(0x18b)](RetrieveMetadataService[_0x4a2803(0x19e)],_0x52fdf9));_0x7309ac[_0x4a2803(0x191)](_0x2a4b97);}return _0x7309ac;}static async[a319_0x4cb337(0x17c)](_0x3b41fe){const _0x2d3856=a319_0x4cb337,_0x45f385=job_utils_1[_0x2d3856(0x178)][_0x2d3856(0x18c)](),_0x191b69=path_1[_0x2d3856(0x178)][_0x2d3856(0x18b)](RetrieveMetadataService[_0x2d3856(0x19e)],_0x45f385);await(0x0,fs_utils_1[_0x2d3856(0x198)])(_0x191b69),await manifest_manger_1[_0x2d3856(0x178)][_0x2d3856(0x19a)](_0x191b69,_0x3b41fe),await state_manger_1[_0x2d3856(0x178)][_0x2d3856(0x19a)](_0x191b69,_0x45f385);const _0x1a638e=path_1[_0x2d3856(0x178)][_0x2d3856(0x18b)](__dirname,job_1[_0x2d3856(0x1b0)]);return job_utils_1[_0x2d3856(0x178)]['runJob'](_0x1a638e,{'jobStorePath':_0x191b69,'jobId':_0x45f385})[_0x2d3856(0x195)](async _0x281081=>{const _0xe9d42b=_0x2d3856,_0x19c748=new state_manger_1['default'](_0x191b69);await _0x19c748[_0xe9d42b(0x189)](),await _0x19c748[_0xe9d42b(0x17f)](_0x281081);}),{'jobId':_0x45f385};}static async[a319_0x4cb337(0x1ac)](_0x44dfee){const _0x3de12b=a319_0x4cb337,{status:_0x1812ec}=await RetrieveMetadataService[_0x3de12b(0x1a7)](_0x44dfee);if(_0x1812ec===logger_enums_1[_0x3de12b(0x1af)][_0x3de12b(0x184)])throw new bad_request_error_1[(_0x3de12b(0x1a9))](_0x3de12b(0x193));const _0x519169=path_1[_0x3de12b(0x178)]['join'](RetrieveMetadataService[_0x3de12b(0x19e)],_0x44dfee,constants_1[_0x3de12b(0x186)]);if(await utils_1[_0x3de12b(0x17d)]['isExistsPath'](_0x519169))return(0x0,promises_1['readFile'])(_0x519169,_0x3de12b(0x1a2))[_0x3de12b(0x182)](JSON[_0x3de12b(0x1a1)]);else throw new not_found_error_1['NotFoundError'](_0x3de12b(0x1a6));}static async[a319_0x4cb337(0x18a)](_0x26fb5f,_0x182722){const _0x197c27=a319_0x4cb337,{status:_0x26f2ec}=await RetrieveMetadataService['getJobStatus'](_0x26fb5f);if(_0x26f2ec===logger_enums_1[_0x197c27(0x1af)][_0x197c27(0x184)])throw new bad_request_error_1[(_0x197c27(0x1a9))](_0x197c27(0x193));const _0x3ad923=path_1['default'][_0x197c27(0x18b)](RetrieveMetadataService[_0x197c27(0x19e)],_0x26fb5f,constants_1[_0x197c27(0x1a8)]),_0x2ae5c9={'data':[]};if(await utils_1[_0x197c27(0x17d)][_0x197c27(0x19b)](path_1[_0x197c27(0x178)][_0x197c27(0x18b)](_0x3ad923,_0x182722+'.json')))_0x2ae5c9[_0x197c27(0x18d)]=await(0x0,promises_1[_0x197c27(0x1a5)])(path_1[_0x197c27(0x178)]['join'](_0x3ad923,_0x182722+'.json'),_0x197c27(0x1a2))[_0x197c27(0x182)](JSON['parse']);else throw new not_found_error_1[(_0x197c27(0x18e))](_0x197c27(0x1aa));return _0x2ae5c9;}static async[a319_0x4cb337(0x1a7)](_0x189563){const _0x3025a3=a319_0x4cb337;try{return await state_manger_1['default']['getJobState'](path_1[_0x3025a3(0x178)][_0x3025a3(0x18b)](RetrieveMetadataService[_0x3025a3(0x19e)],_0x189563));}catch(_0x242b78){throw new not_found_error_1[(_0x3025a3(0x18e))](_0x242b78);}}static async['getJobLogs'](_0x44b12e){const _0x56004c=a319_0x4cb337,_0x32e715=path_1[_0x56004c(0x178)][_0x56004c(0x18b)](RetrieveMetadataService[_0x56004c(0x19e)],_0x44b12e,job_1[_0x56004c(0x197)]);if(await utils_1[_0x56004c(0x17d)][_0x56004c(0x19b)](_0x32e715))return(0x0,promises_1[_0x56004c(0x1a5)])(_0x32e715,_0x56004c(0x1a2))[_0x56004c(0x182)](_0x7bc08c=>csv_utils_1[_0x56004c(0x178)]['parse'](_0x7bc08c,{'columns':!![]}));throw new not_found_error_1['NotFoundError']('Job\x20log\x20not\x20found.');}}exports['default']=RetrieveMetadataService,RetrieveMetadataService[a319_0x4cb337(0x19e)]=path_1[a319_0x4cb337(0x178)][a319_0x4cb337(0x18b)](path_2[a319_0x4cb337(0x180)],constants_1[a319_0x4cb337(0x19d)]);