const a308_0x520b19=a308_0x24fd;function a308_0x24fd(_0x4de7ef,_0x5b3041){const _0x57cce9=a308_0x3853();return a308_0x24fd=function(_0x2cfc3e,_0x5d066e){_0x2cfc3e=_0x2cfc3e-0x1a5;let _0x38535c=_0x57cce9[_0x2cfc3e];return _0x38535c;},a308_0x24fd(_0x4de7ef,_0x5b3041);}(function(_0x5bdcd0,_0x2ab1d7){const _0x28a560=a308_0x24fd,_0x4872d1=_0x5bdcd0();while(!![]){try{const _0xcc2c98=-parseInt(_0x28a560(0x1cc))/0x1+parseInt(_0x28a560(0x1a8))/0x2+-parseInt(_0x28a560(0x1be))/0x3*(parseInt(_0x28a560(0x1df))/0x4)+parseInt(_0x28a560(0x1d4))/0x5+parseInt(_0x28a560(0x1c9))/0x6+-parseInt(_0x28a560(0x1d3))/0x7*(parseInt(_0x28a560(0x1c0))/0x8)+parseInt(_0x28a560(0x1a7))/0x9;if(_0xcc2c98===_0x2ab1d7)break;else _0x4872d1['push'](_0x4872d1['shift']());}catch(_0xcbedb7){_0x4872d1['push'](_0x4872d1['shift']());}}}(a308_0x3853,0x7e0c7));const a308_0x5d066e=(function(){let _0x564139=!![];return function(_0x13876d,_0x5862e6){const _0x50c87a=_0x564139?function(){const _0x2f6281=a308_0x24fd;if(_0x5862e6){const _0x337f58=_0x5862e6[_0x2f6281(0x1bb)](_0x13876d,arguments);return _0x5862e6=null,_0x337f58;}}:function(){};return _0x564139=![],_0x50c87a;};}()),a308_0x2cfc3e=a308_0x5d066e(this,function(){const _0x136f5a=a308_0x24fd;return a308_0x2cfc3e[_0x136f5a(0x1c1)]()['search'](_0x136f5a(0x1af))['toString']()[_0x136f5a(0x1b7)](a308_0x2cfc3e)[_0x136f5a(0x1de)](_0x136f5a(0x1af));});a308_0x2cfc3e();'use strict';function a308_0x3853(){const _0x36b8fb=['1331432SenupA','init','.json','getJobsIds','@flosum/utils','BadRequestError','create','(((.+)+)+)+$','JobStatus','getJobState','FsUtils','default','makeDir','data','../../shared/utils/fs.utils','constructor','utf-8','NotFoundError','RETRIEVE_METADATA_FOLDER_NAME','apply','../../shared/utils/job.utils','readFile','3inClez','../job/classes/manifest-manger','8RwYTRZ','toString','RETRIEVE_RESULT_FOLDER_NAME','RETRIEVE_RESULTS_IDS_FILENAME','IN_PROGRESS','JOB_LOG_DETAILS_FILENAME','Chunk\x20not\x20found.','../../shared/utils/csv.utils','../../../configs/path','3752142XnkNie','getJobLogs','Result\x20not\x20found.','509970IaTzUn','join','../../../core/errors/bad-request.error','../../../core/errors/not-found.error','then','generateJobId','JOB_PATH','5407465AEBqoJ','591020PXtYqB','catch','../constants','isExistsPath','dataPath','retrieveMetadataFolder','Job\x20not\x20completed.','parse','getResult','slice','search','1633876qbhESW','getJobStatus','push','getResultChunk','7181568AZLqhu'];a308_0x3853=function(){return _0x36b8fb;};return a308_0x3853();}var __importDefault=this&&this['__importDefault']||function(_0x170ab2){return _0x170ab2&&_0x170ab2['__esModule']?_0x170ab2:{'default':_0x170ab2};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a308_0x520b19(0x1bc))),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require(a308_0x520b19(0x1bf))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require('fs/promises'),utils_1=require(a308_0x520b19(0x1ac)),csv_utils_1=__importDefault(require(a308_0x520b19(0x1c7))),not_found_error_1=require(a308_0x520b19(0x1cf)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require(a308_0x520b19(0x1ce)),job_1=require('../../../constants/job'),fs_utils_1=require(a308_0x520b19(0x1b6)),constants_1=require(a308_0x520b19(0x1d6)),path_2=require(a308_0x520b19(0x1c8));class RetrieveMetadataService{static async['getJobs'](_0xc3ba5f,_0x31c87d){const _0x12687e=a308_0x520b19,_0x628552=await job_utils_1[_0x12687e(0x1b3)][_0x12687e(0x1ab)](RetrieveMetadataService['retrieveMetadataFolder']),_0x4f2a69=await job_utils_1[_0x12687e(0x1b3)]['sortJobsIds'](RetrieveMetadataService[_0x12687e(0x1d9)],_0x628552),_0x5594a1=_0x4f2a69[_0x12687e(0x1dd)](_0x31c87d,_0x31c87d+_0xc3ba5f),_0x30df64=[];for(const _0x21cae0 of _0x5594a1){const _0x354bb2=await state_manger_1[_0x12687e(0x1b3)][_0x12687e(0x1b1)](path_1['default'][_0x12687e(0x1cd)](RetrieveMetadataService['retrieveMetadataFolder'],_0x21cae0));_0x30df64[_0x12687e(0x1a5)](_0x354bb2);}return _0x30df64;}static async['createRetrieveJob'](_0x5727db){const _0x27d633=a308_0x520b19,_0x35adbf=job_utils_1[_0x27d633(0x1b3)][_0x27d633(0x1d1)](),_0x2dc482=path_1[_0x27d633(0x1b3)][_0x27d633(0x1cd)](RetrieveMetadataService[_0x27d633(0x1d9)],_0x35adbf);await(0x0,fs_utils_1[_0x27d633(0x1b4)])(_0x2dc482),await manifest_manger_1['default'][_0x27d633(0x1ae)](_0x2dc482,_0x5727db),await state_manger_1[_0x27d633(0x1b3)][_0x27d633(0x1ae)](_0x2dc482,_0x35adbf);const _0x5c38c3=path_1['default'][_0x27d633(0x1cd)](__dirname,job_1[_0x27d633(0x1d2)]);return job_utils_1[_0x27d633(0x1b3)]['runJob'](_0x5c38c3,{'jobStorePath':_0x2dc482,'jobId':_0x35adbf})[_0x27d633(0x1d5)](async _0x3f0f0c=>{const _0x15836e=_0x27d633,_0x12105a=new state_manger_1[(_0x15836e(0x1b3))](_0x2dc482);await _0x12105a[_0x15836e(0x1a9)](),await _0x12105a['setError'](_0x3f0f0c);}),{'jobId':_0x35adbf};}static async[a308_0x520b19(0x1dc)](_0x31771f){const _0xc6e2f3=a308_0x520b19,{status:_0x18f1a3}=await RetrieveMetadataService['getJobStatus'](_0x31771f);if(_0x18f1a3===logger_enums_1[_0xc6e2f3(0x1b0)]['IN_PROGRESS'])throw new bad_request_error_1[(_0xc6e2f3(0x1ad))]('Job\x20not\x20completed.');const _0x4dabad=path_1[_0xc6e2f3(0x1b3)][_0xc6e2f3(0x1cd)](RetrieveMetadataService[_0xc6e2f3(0x1d9)],_0x31771f,constants_1[_0xc6e2f3(0x1c3)]);if(await utils_1[_0xc6e2f3(0x1b2)][_0xc6e2f3(0x1d7)](_0x4dabad))return(0x0,promises_1[_0xc6e2f3(0x1bd)])(_0x4dabad,_0xc6e2f3(0x1b8))[_0xc6e2f3(0x1d0)](JSON[_0xc6e2f3(0x1db)]);else throw new not_found_error_1[(_0xc6e2f3(0x1b9))](_0xc6e2f3(0x1cb));}static async[a308_0x520b19(0x1a6)](_0x4ac0c4,_0x5e5e81){const _0x3bca12=a308_0x520b19,{status:_0xa483b2}=await RetrieveMetadataService[_0x3bca12(0x1e0)](_0x4ac0c4);if(_0xa483b2===logger_enums_1[_0x3bca12(0x1b0)][_0x3bca12(0x1c4)])throw new bad_request_error_1[(_0x3bca12(0x1ad))](_0x3bca12(0x1da));const _0x8b9901=path_1['default'][_0x3bca12(0x1cd)](RetrieveMetadataService[_0x3bca12(0x1d9)],_0x4ac0c4,constants_1[_0x3bca12(0x1c2)]),_0x334683={'data':[]};if(await utils_1[_0x3bca12(0x1b2)][_0x3bca12(0x1d7)](path_1[_0x3bca12(0x1b3)][_0x3bca12(0x1cd)](_0x8b9901,_0x5e5e81+_0x3bca12(0x1aa))))_0x334683[_0x3bca12(0x1b5)]=await(0x0,promises_1[_0x3bca12(0x1bd)])(path_1[_0x3bca12(0x1b3)][_0x3bca12(0x1cd)](_0x8b9901,_0x5e5e81+'.json'),_0x3bca12(0x1b8))[_0x3bca12(0x1d0)](JSON[_0x3bca12(0x1db)]);else throw new not_found_error_1[(_0x3bca12(0x1b9))](_0x3bca12(0x1c6));return _0x334683;}static async[a308_0x520b19(0x1e0)](_0x1c526b){const _0x236005=a308_0x520b19;try{return await state_manger_1[_0x236005(0x1b3)]['getJobState'](path_1['default'][_0x236005(0x1cd)](RetrieveMetadataService[_0x236005(0x1d9)],_0x1c526b));}catch(_0x4a1b80){throw new not_found_error_1['NotFoundError'](_0x4a1b80);}}static async[a308_0x520b19(0x1ca)](_0x23c261){const _0x15a533=a308_0x520b19,_0x262a9a=path_1[_0x15a533(0x1b3)]['join'](RetrieveMetadataService[_0x15a533(0x1d9)],_0x23c261,job_1[_0x15a533(0x1c5)]);if(await utils_1[_0x15a533(0x1b2)][_0x15a533(0x1d7)](_0x262a9a))return(0x0,promises_1[_0x15a533(0x1bd)])(_0x262a9a,'utf-8')[_0x15a533(0x1d0)](_0x506043=>csv_utils_1[_0x15a533(0x1b3)][_0x15a533(0x1db)](_0x506043,{'columns':!![]}));throw new not_found_error_1[(_0x15a533(0x1b9))]('Job\x20log\x20not\x20found.');}}exports[a308_0x520b19(0x1b3)]=RetrieveMetadataService,RetrieveMetadataService[a308_0x520b19(0x1d9)]=path_1[a308_0x520b19(0x1b3)][a308_0x520b19(0x1cd)](path_2[a308_0x520b19(0x1d8)],constants_1[a308_0x520b19(0x1ba)]);