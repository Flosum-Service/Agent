const a273_0x397518=a273_0xb33d;(function(_0x51c17c,_0x339289){const _0x18aa15=a273_0xb33d,_0x166cc3=_0x51c17c();while(!![]){try{const _0x175d55=parseInt(_0x18aa15(0x18d))/0x1+-parseInt(_0x18aa15(0x19b))/0x2*(parseInt(_0x18aa15(0x198))/0x3)+-parseInt(_0x18aa15(0x16a))/0x4*(parseInt(_0x18aa15(0x16f))/0x5)+-parseInt(_0x18aa15(0x16e))/0x6*(-parseInt(_0x18aa15(0x193))/0x7)+parseInt(_0x18aa15(0x18c))/0x8+-parseInt(_0x18aa15(0x172))/0x9+parseInt(_0x18aa15(0x188))/0xa;if(_0x175d55===_0x339289)break;else _0x166cc3['push'](_0x166cc3['shift']());}catch(_0x1967ae){_0x166cc3['push'](_0x166cc3['shift']());}}}(a273_0x700f,0xaeed4));const a273_0x3d89a7=(function(){let _0x5ccf7b=!![];return function(_0x2f6df7,_0xac8f49){const _0x1bb28a=_0x5ccf7b?function(){if(_0xac8f49){const _0x52b580=_0xac8f49['apply'](_0x2f6df7,arguments);return _0xac8f49=null,_0x52b580;}}:function(){};return _0x5ccf7b=![],_0x1bb28a;};}()),a273_0x2ab706=a273_0x3d89a7(this,function(){const _0x179c62=a273_0xb33d;return a273_0x2ab706['toString']()['search'](_0x179c62(0x19c))['toString']()[_0x179c62(0x16c)](a273_0x2ab706)[_0x179c62(0x17d)](_0x179c62(0x19c));});a273_0x2ab706();'use strict';function a273_0x700f(){const _0x4c83b1=['(((.+)+)+)+$','RETRIEVE_RESULTS_IDS_FILENAME','getResult','readFile','../../shared/utils/fs.utils','getResultChunk','getJobStatus','../../../configs/path','Result\x20not\x20found.','../../shared/utils/csv.utils','utf-8','create','getJobState','path','defineProperty','FsUtils','default','slice','25120jRKWuf','../../../constants/job','constructor','fs/promises','1502892rDPAhQ','330YMpTIa','makeDir','generateJobId','2270349UoTaSy','createRetrieveJob','isExistsPath','../constants','__importDefault','JobStatus','push','../job/classes/manifest-manger','data','then','parse','search','IN_PROGRESS','join','../job/classes/state-manger','.json','setError','Job\x20log\x20not\x20found.','dataPath','NotFoundError','__esModule','../../../core/errors/not-found.error','949890MrUpvz','Job\x20not\x20completed.','sortJobsIds','RETRIEVE_RESULT_FOLDER_NAME','3360504hgXkiH','1146139YLVGOc','JOB_LOG_DETAILS_FILENAME','catch','BadRequestError','retrieveMetadataFolder','../../../core/errors/bad-request.error','21tYkTJr','@flosum/utils','runJob','RETRIEVE_METADATA_FOLDER_NAME','init','36Xyygqq','Chunk\x20not\x20found.','JOB_PATH','171566RUUfEL'];a273_0x700f=function(){return _0x4c83b1;};return a273_0x700f();}function a273_0xb33d(_0x3f0217,_0x5ce940){const _0x9fa0ae=a273_0x700f();return a273_0xb33d=function(_0x2ab706,_0x3d89a7){_0x2ab706=_0x2ab706-0x15e;let _0x700f29=_0x9fa0ae[_0x2ab706];return _0x700f29;},a273_0xb33d(_0x3f0217,_0x5ce940);}var __importDefault=this&&this[a273_0x397518(0x176)]||function(_0x368aab){const _0x3c2c6d=a273_0x397518;return _0x368aab&&_0x368aab[_0x3c2c6d(0x186)]?_0x368aab:{'default':_0x368aab};};Object[a273_0x397518(0x166)](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a273_0x397518(0x165))),manifest_manger_1=__importDefault(require(a273_0x397518(0x179))),state_manger_1=__importDefault(require(a273_0x397518(0x180))),promises_1=require(a273_0x397518(0x16d)),utils_1=require(a273_0x397518(0x194)),csv_utils_1=__importDefault(require(a273_0x397518(0x161))),not_found_error_1=require(a273_0x397518(0x187)),logger_enums_1=require('../job/enums/logger.enums'),bad_request_error_1=require(a273_0x397518(0x192)),job_1=require(a273_0x397518(0x16b)),fs_utils_1=require(a273_0x397518(0x1a0)),constants_1=require(a273_0x397518(0x175)),path_2=require(a273_0x397518(0x15f));class RetrieveMetadataService{static async['getJobs'](_0x2103d0,_0x5f15b2){const _0x1ccdf8=a273_0x397518,_0x1261b7=await job_utils_1[_0x1ccdf8(0x168)]['getJobsIds'](RetrieveMetadataService[_0x1ccdf8(0x191)]),_0x11ec00=await job_utils_1[_0x1ccdf8(0x168)][_0x1ccdf8(0x18a)](RetrieveMetadataService[_0x1ccdf8(0x191)],_0x1261b7),_0x41b4b8=_0x11ec00[_0x1ccdf8(0x169)](_0x5f15b2,_0x5f15b2+_0x2103d0),_0x29adce=[];for(const _0x5db73a of _0x41b4b8){const _0x3d563d=await state_manger_1[_0x1ccdf8(0x168)]['getJobState'](path_1[_0x1ccdf8(0x168)][_0x1ccdf8(0x17f)](RetrieveMetadataService[_0x1ccdf8(0x191)],_0x5db73a));_0x29adce[_0x1ccdf8(0x178)](_0x3d563d);}return _0x29adce;}static async[a273_0x397518(0x173)](_0x28e0f1){const _0x27b92e=a273_0x397518,_0x1d932a=job_utils_1[_0x27b92e(0x168)][_0x27b92e(0x171)](),_0x3eaab2=path_1[_0x27b92e(0x168)][_0x27b92e(0x17f)](RetrieveMetadataService[_0x27b92e(0x191)],_0x1d932a);await(0x0,fs_utils_1[_0x27b92e(0x170)])(_0x3eaab2),await manifest_manger_1['default'][_0x27b92e(0x163)](_0x3eaab2,_0x28e0f1),await state_manger_1[_0x27b92e(0x168)][_0x27b92e(0x163)](_0x3eaab2,_0x1d932a);const _0x439096=path_1[_0x27b92e(0x168)][_0x27b92e(0x17f)](__dirname,job_1[_0x27b92e(0x19a)]);return job_utils_1[_0x27b92e(0x168)][_0x27b92e(0x195)](_0x439096,{'jobStorePath':_0x3eaab2,'jobId':_0x1d932a})[_0x27b92e(0x18f)](async _0x34f11c=>{const _0x1a6db4=_0x27b92e,_0x5b9990=new state_manger_1[(_0x1a6db4(0x168))](_0x3eaab2);await _0x5b9990[_0x1a6db4(0x197)](),await _0x5b9990[_0x1a6db4(0x182)](_0x34f11c);}),{'jobId':_0x1d932a};}static async[a273_0x397518(0x19e)](_0x27b0c1){const _0x59cada=a273_0x397518,{status:_0x4dffe7}=await RetrieveMetadataService[_0x59cada(0x15e)](_0x27b0c1);if(_0x4dffe7===logger_enums_1[_0x59cada(0x177)][_0x59cada(0x17e)])throw new bad_request_error_1[(_0x59cada(0x190))](_0x59cada(0x189));const _0x18940f=path_1['default'][_0x59cada(0x17f)](RetrieveMetadataService['retrieveMetadataFolder'],_0x27b0c1,constants_1[_0x59cada(0x19d)]);if(await utils_1[_0x59cada(0x167)]['isExistsPath'](_0x18940f))return(0x0,promises_1[_0x59cada(0x19f)])(_0x18940f,_0x59cada(0x162))[_0x59cada(0x17b)](JSON['parse']);else throw new not_found_error_1[(_0x59cada(0x185))](_0x59cada(0x160));}static async[a273_0x397518(0x1a1)](_0x28bd5b,_0x2de392){const _0x41c199=a273_0x397518,{status:_0x41f086}=await RetrieveMetadataService['getJobStatus'](_0x28bd5b);if(_0x41f086===logger_enums_1[_0x41c199(0x177)][_0x41c199(0x17e)])throw new bad_request_error_1[(_0x41c199(0x190))](_0x41c199(0x189));const _0x276e63=path_1[_0x41c199(0x168)][_0x41c199(0x17f)](RetrieveMetadataService[_0x41c199(0x191)],_0x28bd5b,constants_1[_0x41c199(0x18b)]),_0x241cb4={'data':[]};if(await utils_1[_0x41c199(0x167)]['isExistsPath'](path_1[_0x41c199(0x168)][_0x41c199(0x17f)](_0x276e63,_0x2de392+_0x41c199(0x181))))_0x241cb4[_0x41c199(0x17a)]=await(0x0,promises_1[_0x41c199(0x19f)])(path_1['default'][_0x41c199(0x17f)](_0x276e63,_0x2de392+_0x41c199(0x181)),_0x41c199(0x162))[_0x41c199(0x17b)](JSON[_0x41c199(0x17c)]);else throw new not_found_error_1[(_0x41c199(0x185))](_0x41c199(0x199));return _0x241cb4;}static async[a273_0x397518(0x15e)](_0x28c726){const _0x2668db=a273_0x397518;try{return await state_manger_1[_0x2668db(0x168)][_0x2668db(0x164)](path_1[_0x2668db(0x168)][_0x2668db(0x17f)](RetrieveMetadataService['retrieveMetadataFolder'],_0x28c726));}catch(_0x5e98c8){throw new not_found_error_1['NotFoundError'](_0x5e98c8);}}static async['getJobLogs'](_0x53a9e9){const _0x1589e6=a273_0x397518,_0x389c1c=path_1['default']['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x53a9e9,job_1[_0x1589e6(0x18e)]);if(await utils_1[_0x1589e6(0x167)][_0x1589e6(0x174)](_0x389c1c))return(0x0,promises_1[_0x1589e6(0x19f)])(_0x389c1c,'utf-8')[_0x1589e6(0x17b)](_0x382b15=>csv_utils_1[_0x1589e6(0x168)][_0x1589e6(0x17c)](_0x382b15,{'columns':!![]}));throw new not_found_error_1[(_0x1589e6(0x185))](_0x1589e6(0x183));}}exports[a273_0x397518(0x168)]=RetrieveMetadataService,RetrieveMetadataService[a273_0x397518(0x191)]=path_1[a273_0x397518(0x168)][a273_0x397518(0x17f)](path_2[a273_0x397518(0x184)],constants_1[a273_0x397518(0x196)]);