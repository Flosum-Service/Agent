const a321_0x4c1f5c=a321_0x4735;(function(_0x7f0476,_0x56ea08){const _0x1a807a=a321_0x4735,_0x2c063d=_0x7f0476();while(!![]){try{const _0x1ff8c3=-parseInt(_0x1a807a(0x126))/0x1+-parseInt(_0x1a807a(0x142))/0x2+parseInt(_0x1a807a(0x148))/0x3*(parseInt(_0x1a807a(0x131))/0x4)+-parseInt(_0x1a807a(0x13d))/0x5+-parseInt(_0x1a807a(0x135))/0x6*(parseInt(_0x1a807a(0x13b))/0x7)+parseInt(_0x1a807a(0x132))/0x8+parseInt(_0x1a807a(0x13e))/0x9;if(_0x1ff8c3===_0x56ea08)break;else _0x2c063d['push'](_0x2c063d['shift']());}catch(_0x32ca85){_0x2c063d['push'](_0x2c063d['shift']());}}}(a321_0x4757,0xc001e));const a321_0x54f0e8=(function(){let _0x48950b=!![];return function(_0xcb3889,_0x421d01){const _0x31a976=_0x48950b?function(){const _0x237714=a321_0x4735;if(_0x421d01){const _0x443f9f=_0x421d01[_0x237714(0x151)](_0xcb3889,arguments);return _0x421d01=null,_0x443f9f;}}:function(){};return _0x48950b=![],_0x31a976;};}()),a321_0x1cd381=a321_0x54f0e8(this,function(){const _0x432e80=a321_0x4735;return a321_0x1cd381[_0x432e80(0x117)]()['search'](_0x432e80(0x118))['toString']()[_0x432e80(0x14a)](a321_0x1cd381)[_0x432e80(0x154)]('(((.+)+)+)+$');});a321_0x1cd381();'use strict';var __importDefault=this&&this[a321_0x4c1f5c(0x115)]||function(_0x363bdc){return _0x363bdc&&_0x363bdc['__esModule']?_0x363bdc:{'default':_0x363bdc};};function a321_0x4757(){const _0x22240d=['path','parse','getJobs','dataPath','RETRIEVE_RESULT_FOLDER_NAME','makeDir','../../shared/utils/fs.utils','IN_PROGRESS','NotFoundError','1523DljSeU','join','getResultChunk','Job\x20log\x20not\x20found.','generateJobId','JOB_PATH','getJobLogs','data','../../shared/enums/logger.enums','../../../core/errors/not-found.error','Result\x20not\x20found.','4572JotdTf','9228792tqaGop','runJob','setError','18lFvqzO','catch','readFile','isExistsPath','JobStatus','init','55391cEzasu','../constants','3031815ZDNrBi','9195111zItPyW','then','../../shared/utils/job.utils','@flosum/utils','2739678LHposm','getJobsIds','createRetrieveJob','getJobStatus','../../shared/managers/state-manger','Job\x20not\x20completed.','1608gyITxG','fs/promises','constructor','getResult','JOB_LOG_DETAILS_FILENAME','FsUtils','slice','../../shared/utils/csv.utils','default','apply','__esModule','.json','search','push','retrieveMetadataFolder','../../../constants/job','utf-8','__importDefault','getJobState','toString','(((.+)+)+)+$','RETRIEVE_RESULTS_IDS_FILENAME','BadRequestError','create','../../../core/errors/bad-request.error'];a321_0x4757=function(){return _0x22240d;};return a321_0x4757();}function a321_0x4735(_0x3f898b,_0x412d1e){const _0x2b9062=a321_0x4757();return a321_0x4735=function(_0x1cd381,_0x54f0e8){_0x1cd381=_0x1cd381-0x112;let _0x4757d3=_0x2b9062[_0x1cd381];return _0x4757d3;},a321_0x4735(_0x3f898b,_0x412d1e);}Object['defineProperty'](exports,a321_0x4c1f5c(0x152),{'value':!![]});const job_utils_1=__importDefault(require(a321_0x4c1f5c(0x140))),path_1=__importDefault(require(a321_0x4c1f5c(0x11d))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a321_0x4c1f5c(0x146))),promises_1=require(a321_0x4c1f5c(0x149)),utils_1=require(a321_0x4c1f5c(0x141)),csv_utils_1=__importDefault(require(a321_0x4c1f5c(0x14f))),not_found_error_1=require(a321_0x4c1f5c(0x12f)),logger_enums_1=require(a321_0x4c1f5c(0x12e)),bad_request_error_1=require(a321_0x4c1f5c(0x11c)),job_1=require(a321_0x4c1f5c(0x113)),fs_utils_1=require(a321_0x4c1f5c(0x123)),constants_1=require(a321_0x4c1f5c(0x13c)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a321_0x4c1f5c(0x11f)](_0x2f169a,_0x2630d9){const _0x1b57cf=a321_0x4c1f5c,_0x400c1d=await job_utils_1[_0x1b57cf(0x150)][_0x1b57cf(0x143)](RetrieveMetadataService[_0x1b57cf(0x112)]),_0x31dbb7=await job_utils_1[_0x1b57cf(0x150)]['sortJobsIds'](RetrieveMetadataService['retrieveMetadataFolder'],_0x400c1d),_0x4e6176=_0x31dbb7[_0x1b57cf(0x14e)](_0x2630d9,_0x2630d9+_0x2f169a),_0x16f97e=[];for(const _0x171bd8 of _0x4e6176){const _0x170f70=await state_manger_1[_0x1b57cf(0x150)][_0x1b57cf(0x116)](path_1[_0x1b57cf(0x150)][_0x1b57cf(0x127)](RetrieveMetadataService['retrieveMetadataFolder'],_0x171bd8));_0x16f97e[_0x1b57cf(0x155)](_0x170f70);}return _0x16f97e;}static async[a321_0x4c1f5c(0x144)](_0x5ba941){const _0x5196e3=a321_0x4c1f5c,_0x2722ee=job_utils_1[_0x5196e3(0x150)][_0x5196e3(0x12a)](),_0x3296a5=path_1[_0x5196e3(0x150)][_0x5196e3(0x127)](RetrieveMetadataService['retrieveMetadataFolder'],_0x2722ee);await(0x0,fs_utils_1[_0x5196e3(0x122)])(_0x3296a5),await manifest_manger_1['default']['create'](_0x3296a5,_0x5ba941),await state_manger_1[_0x5196e3(0x150)][_0x5196e3(0x11b)](_0x3296a5,_0x2722ee);const _0xfac1bd=path_1[_0x5196e3(0x150)]['join'](__dirname,job_1[_0x5196e3(0x12b)]);return job_utils_1[_0x5196e3(0x150)][_0x5196e3(0x133)](_0xfac1bd,{'jobStorePath':_0x3296a5,'jobId':_0x2722ee})[_0x5196e3(0x136)](async _0x4502d2=>{const _0x482b5f=_0x5196e3,_0x4472fb=new state_manger_1[(_0x482b5f(0x150))](_0x3296a5);await _0x4472fb[_0x482b5f(0x13a)](),await _0x4472fb[_0x482b5f(0x134)](_0x4502d2);}),{'jobId':_0x2722ee};}static async[a321_0x4c1f5c(0x14b)](_0x5c500d){const _0x5bc72c=a321_0x4c1f5c,{status:_0x42abbe}=await RetrieveMetadataService[_0x5bc72c(0x145)](_0x5c500d);if(_0x42abbe===logger_enums_1['JobStatus'][_0x5bc72c(0x124)])throw new bad_request_error_1[(_0x5bc72c(0x11a))](_0x5bc72c(0x147));const _0x1b3f87=path_1[_0x5bc72c(0x150)][_0x5bc72c(0x127)](RetrieveMetadataService[_0x5bc72c(0x112)],_0x5c500d,constants_1[_0x5bc72c(0x119)]);if(await utils_1[_0x5bc72c(0x14d)][_0x5bc72c(0x138)](_0x1b3f87))return(0x0,promises_1[_0x5bc72c(0x137)])(_0x1b3f87,_0x5bc72c(0x114))[_0x5bc72c(0x13f)](JSON[_0x5bc72c(0x11e)]);else throw new not_found_error_1[(_0x5bc72c(0x125))](_0x5bc72c(0x130));}static async[a321_0x4c1f5c(0x128)](_0x5e1cb5,_0x149cd4){const _0x2d698c=a321_0x4c1f5c,{status:_0x50c520}=await RetrieveMetadataService['getJobStatus'](_0x5e1cb5);if(_0x50c520===logger_enums_1[_0x2d698c(0x139)][_0x2d698c(0x124)])throw new bad_request_error_1['BadRequestError'](_0x2d698c(0x147));const _0x408465=path_1[_0x2d698c(0x150)][_0x2d698c(0x127)](RetrieveMetadataService['retrieveMetadataFolder'],_0x5e1cb5,constants_1[_0x2d698c(0x121)]),_0x3630bb={'data':[]};if(await utils_1[_0x2d698c(0x14d)][_0x2d698c(0x138)](path_1['default'][_0x2d698c(0x127)](_0x408465,_0x149cd4+_0x2d698c(0x153))))_0x3630bb[_0x2d698c(0x12d)]=await(0x0,promises_1[_0x2d698c(0x137)])(path_1['default'][_0x2d698c(0x127)](_0x408465,_0x149cd4+_0x2d698c(0x153)),_0x2d698c(0x114))[_0x2d698c(0x13f)](JSON[_0x2d698c(0x11e)]);else throw new not_found_error_1['NotFoundError']('Chunk\x20not\x20found.');return _0x3630bb;}static async['getJobStatus'](_0x3e6f82){const _0x55d9f0=a321_0x4c1f5c;try{return await state_manger_1[_0x55d9f0(0x150)][_0x55d9f0(0x116)](path_1[_0x55d9f0(0x150)][_0x55d9f0(0x127)](RetrieveMetadataService[_0x55d9f0(0x112)],_0x3e6f82));}catch(_0x83816){throw new not_found_error_1[(_0x55d9f0(0x125))](_0x83816);}}static async[a321_0x4c1f5c(0x12c)](_0x1feb48){const _0x33c768=a321_0x4c1f5c,_0x3b5df2=path_1[_0x33c768(0x150)][_0x33c768(0x127)](RetrieveMetadataService[_0x33c768(0x112)],_0x1feb48,job_1[_0x33c768(0x14c)]);if(await utils_1[_0x33c768(0x14d)][_0x33c768(0x138)](_0x3b5df2))return(0x0,promises_1[_0x33c768(0x137)])(_0x3b5df2,_0x33c768(0x114))['then'](_0x4466ed=>csv_utils_1[_0x33c768(0x150)]['parse'](_0x4466ed,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x33c768(0x129));}}exports[a321_0x4c1f5c(0x150)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1['default'][a321_0x4c1f5c(0x127)](path_2[a321_0x4c1f5c(0x120)],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);