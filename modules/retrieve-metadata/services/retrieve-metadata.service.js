const a321_0x4485e2=a321_0x4665;(function(_0x6282de,_0x4167e0){const _0x1a932b=a321_0x4665,_0x4316fd=_0x6282de();while(!![]){try{const _0x53d626=parseInt(_0x1a932b(0xba))/0x1+parseInt(_0x1a932b(0xb3))/0x2+parseInt(_0x1a932b(0xd9))/0x3*(parseInt(_0x1a932b(0xc8))/0x4)+parseInt(_0x1a932b(0xd8))/0x5*(parseInt(_0x1a932b(0xd6))/0x6)+-parseInt(_0x1a932b(0xcd))/0x7*(-parseInt(_0x1a932b(0xdf))/0x8)+-parseInt(_0x1a932b(0xe6))/0x9*(-parseInt(_0x1a932b(0xe4))/0xa)+parseInt(_0x1a932b(0xc0))/0xb*(-parseInt(_0x1a932b(0xbe))/0xc);if(_0x53d626===_0x4167e0)break;else _0x4316fd['push'](_0x4316fd['shift']());}catch(_0x225ce8){_0x4316fd['push'](_0x4316fd['shift']());}}}(a321_0xcb7d,0x7a056));const a321_0x55d367=(function(){let _0x12558b=!![];return function(_0x3a6d69,_0x1073d5){const _0x4df7db=_0x12558b?function(){const _0x3ba858=a321_0x4665;if(_0x1073d5){const _0x272db4=_0x1073d5[_0x3ba858(0xaa)](_0x3a6d69,arguments);return _0x1073d5=null,_0x272db4;}}:function(){};return _0x12558b=![],_0x4df7db;};}()),a321_0x2604ca=a321_0x55d367(this,function(){const _0x116180=a321_0x4665;return a321_0x2604ca[_0x116180(0xc4)]()['search'](_0x116180(0xae))[_0x116180(0xc4)]()[_0x116180(0xc1)](a321_0x2604ca)[_0x116180(0xaf)](_0x116180(0xae));});a321_0x2604ca();function a321_0xcb7d(){const _0x45078f=['../../shared/managers/state-manger','149052gnQYxg','../../shared/utils/job.utils','2134JuYrey','constructor','then','../job/classes/manifest-manger','toString','NotFoundError','getJobState','FsUtils','1728812hpgXxX','JobStatus','../../shared/utils/csv.utils','getResult','Chunk\x20not\x20found.','63zAbtXo','RETRIEVE_RESULTS_IDS_FILENAME','getJobStatus','../../../core/errors/bad-request.error','defineProperty','join','getResultChunk','retrieveMetadataFolder','BadRequestError','430188djPPGd','Result\x20not\x20found.','5exeWug','3qjWTLi','RETRIEVE_METADATA_FOLDER_NAME','../../../core/errors/not-found.error','parse','utf-8','../../../configs/path','279536ewPXOq','__importDefault','sortJobsIds','makeDir','default','20uAzOOe','fs/promises','2634345TlDHuI','IN_PROGRESS','.json','../constants','createRetrieveJob','__esModule','apply','../../shared/enums/logger.enums','isExistsPath','readFile','(((.+)+)+)+$','search','runJob','getJobLogs','create','1924252dxTlNM','generateJobId','getJobs','JOB_LOG_DETAILS_FILENAME','slice','push','path','543557hQOVHp','Job\x20not\x20completed.','@flosum/utils'];a321_0xcb7d=function(){return _0x45078f;};return a321_0xcb7d();}'use strict';var __importDefault=this&&this[a321_0x4485e2(0xe0)]||function(_0x492f47){const _0x19bb4b=a321_0x4485e2;return _0x492f47&&_0x492f47[_0x19bb4b(0xa9)]?_0x492f47:{'default':_0x492f47};};Object[a321_0x4485e2(0xd1)](exports,a321_0x4485e2(0xa9),{'value':!![]});const job_utils_1=__importDefault(require(a321_0x4485e2(0xbf))),path_1=__importDefault(require(a321_0x4485e2(0xb9))),manifest_manger_1=__importDefault(require(a321_0x4485e2(0xc3))),state_manger_1=__importDefault(require(a321_0x4485e2(0xbd))),promises_1=require(a321_0x4485e2(0xe5)),utils_1=require(a321_0x4485e2(0xbc)),csv_utils_1=__importDefault(require(a321_0x4485e2(0xca))),not_found_error_1=require(a321_0x4485e2(0xdb)),logger_enums_1=require(a321_0x4485e2(0xab)),bad_request_error_1=require(a321_0x4485e2(0xd0)),job_1=require('../../../constants/job'),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a321_0x4485e2(0xa7)),path_2=require(a321_0x4485e2(0xde));class RetrieveMetadataService{static async[a321_0x4485e2(0xb5)](_0x5b7600,_0x1dc301){const _0x456cec=a321_0x4485e2,_0x257e63=await job_utils_1[_0x456cec(0xe3)]['getJobsIds'](RetrieveMetadataService[_0x456cec(0xd4)]),_0x20b36c=await job_utils_1['default'][_0x456cec(0xe1)](RetrieveMetadataService[_0x456cec(0xd4)],_0x257e63),_0x36796d=_0x20b36c[_0x456cec(0xb7)](_0x1dc301,_0x1dc301+_0x5b7600),_0x5ad879=[];for(const _0x3be3ac of _0x36796d){const _0x546754=await state_manger_1[_0x456cec(0xe3)][_0x456cec(0xc6)](path_1[_0x456cec(0xe3)][_0x456cec(0xd2)](RetrieveMetadataService[_0x456cec(0xd4)],_0x3be3ac));_0x5ad879[_0x456cec(0xb8)](_0x546754);}return _0x5ad879;}static async[a321_0x4485e2(0xa8)](_0x5d3558){const _0x1aab19=a321_0x4485e2,_0x5056ff=job_utils_1['default'][_0x1aab19(0xb4)](),_0x309017=path_1['default'][_0x1aab19(0xd2)](RetrieveMetadataService['retrieveMetadataFolder'],_0x5056ff);await(0x0,fs_utils_1[_0x1aab19(0xe2)])(_0x309017),await manifest_manger_1['default'][_0x1aab19(0xb2)](_0x309017,_0x5d3558),await state_manger_1[_0x1aab19(0xe3)][_0x1aab19(0xb2)](_0x309017,_0x5056ff);const _0x7f382c=path_1['default'][_0x1aab19(0xd2)](__dirname,job_1['JOB_PATH']);return job_utils_1['default'][_0x1aab19(0xb0)](_0x7f382c,{'jobStorePath':_0x309017,'jobId':_0x5056ff})['catch'](async _0x2865dc=>{const _0x404c3e=new state_manger_1['default'](_0x309017);await _0x404c3e['init'](),await _0x404c3e['setError'](_0x2865dc);}),{'jobId':_0x5056ff};}static async[a321_0x4485e2(0xcb)](_0x3f81a7){const _0x5edabc=a321_0x4485e2,{status:_0x4ddad7}=await RetrieveMetadataService[_0x5edabc(0xcf)](_0x3f81a7);if(_0x4ddad7===logger_enums_1[_0x5edabc(0xc9)][_0x5edabc(0xa5)])throw new bad_request_error_1[(_0x5edabc(0xd5))]('Job\x20not\x20completed.');const _0x252db9=path_1[_0x5edabc(0xe3)][_0x5edabc(0xd2)](RetrieveMetadataService[_0x5edabc(0xd4)],_0x3f81a7,constants_1[_0x5edabc(0xce)]);if(await utils_1[_0x5edabc(0xc7)][_0x5edabc(0xac)](_0x252db9))return(0x0,promises_1[_0x5edabc(0xad)])(_0x252db9,_0x5edabc(0xdd))[_0x5edabc(0xc2)](JSON[_0x5edabc(0xdc)]);else throw new not_found_error_1[(_0x5edabc(0xc5))](_0x5edabc(0xd7));}static async[a321_0x4485e2(0xd3)](_0x58752a,_0x5e2de7){const _0x7745a2=a321_0x4485e2,{status:_0x3ba21f}=await RetrieveMetadataService['getJobStatus'](_0x58752a);if(_0x3ba21f===logger_enums_1[_0x7745a2(0xc9)][_0x7745a2(0xa5)])throw new bad_request_error_1[(_0x7745a2(0xd5))](_0x7745a2(0xbb));const _0x2412a9=path_1[_0x7745a2(0xe3)][_0x7745a2(0xd2)](RetrieveMetadataService[_0x7745a2(0xd4)],_0x58752a,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0xea9c2b={'data':[]};if(await utils_1['FsUtils'][_0x7745a2(0xac)](path_1[_0x7745a2(0xe3)][_0x7745a2(0xd2)](_0x2412a9,_0x5e2de7+_0x7745a2(0xa6))))_0xea9c2b['data']=await(0x0,promises_1[_0x7745a2(0xad)])(path_1[_0x7745a2(0xe3)][_0x7745a2(0xd2)](_0x2412a9,_0x5e2de7+'.json'),_0x7745a2(0xdd))['then'](JSON['parse']);else throw new not_found_error_1[(_0x7745a2(0xc5))](_0x7745a2(0xcc));return _0xea9c2b;}static async[a321_0x4485e2(0xcf)](_0x24d62e){const _0x41d058=a321_0x4485e2;try{return await state_manger_1['default']['getJobState'](path_1[_0x41d058(0xe3)][_0x41d058(0xd2)](RetrieveMetadataService[_0x41d058(0xd4)],_0x24d62e));}catch(_0x33b51a){throw new not_found_error_1['NotFoundError'](_0x33b51a);}}static async[a321_0x4485e2(0xb1)](_0x523fff){const _0x456545=a321_0x4485e2,_0x316fec=path_1[_0x456545(0xe3)]['join'](RetrieveMetadataService[_0x456545(0xd4)],_0x523fff,job_1[_0x456545(0xb6)]);if(await utils_1[_0x456545(0xc7)][_0x456545(0xac)](_0x316fec))return(0x0,promises_1['readFile'])(_0x316fec,_0x456545(0xdd))[_0x456545(0xc2)](_0x3328d8=>csv_utils_1[_0x456545(0xe3)][_0x456545(0xdc)](_0x3328d8,{'columns':!![]}));throw new not_found_error_1[(_0x456545(0xc5))]('Job\x20log\x20not\x20found.');}}function a321_0x4665(_0x3ead39,_0x5cc0be){const _0x386bbc=a321_0xcb7d();return a321_0x4665=function(_0x2604ca,_0x55d367){_0x2604ca=_0x2604ca-0xa5;let _0xcb7d00=_0x386bbc[_0x2604ca];return _0xcb7d00;},a321_0x4665(_0x3ead39,_0x5cc0be);}exports[a321_0x4485e2(0xe3)]=RetrieveMetadataService,RetrieveMetadataService[a321_0x4485e2(0xd4)]=path_1['default']['join'](path_2['dataPath'],constants_1[a321_0x4485e2(0xda)]);