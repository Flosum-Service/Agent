function a309_0x527d(_0x211e58,_0x2d7291){const _0x42bc8c=a309_0x1a49();return a309_0x527d=function(_0x454a8b,_0x4aabf2){_0x454a8b=_0x454a8b-0x66;let _0x1a49e6=_0x42bc8c[_0x454a8b];return _0x1a49e6;},a309_0x527d(_0x211e58,_0x2d7291);}const a309_0x5a7643=a309_0x527d;(function(_0x439533,_0x282b6b){const _0x1bde51=a309_0x527d,_0x423853=_0x439533();while(!![]){try{const _0x4713d1=parseInt(_0x1bde51(0x79))/0x1*(parseInt(_0x1bde51(0x7f))/0x2)+parseInt(_0x1bde51(0x6e))/0x3*(-parseInt(_0x1bde51(0x91))/0x4)+parseInt(_0x1bde51(0x98))/0x5+parseInt(_0x1bde51(0x69))/0x6*(-parseInt(_0x1bde51(0x9d))/0x7)+parseInt(_0x1bde51(0x73))/0x8+parseInt(_0x1bde51(0x97))/0x9+-parseInt(_0x1bde51(0x67))/0xa;if(_0x4713d1===_0x282b6b)break;else _0x423853['push'](_0x423853['shift']());}catch(_0x4acc25){_0x423853['push'](_0x423853['shift']());}}}(a309_0x1a49,0xa3ac7));const a309_0x4aabf2=(function(){let _0x4c1365=!![];return function(_0x1a3182,_0x486385){const _0x251216=_0x4c1365?function(){const _0x1c54e3=a309_0x527d;if(_0x486385){const _0x5b0134=_0x486385[_0x1c54e3(0x8c)](_0x1a3182,arguments);return _0x486385=null,_0x5b0134;}}:function(){};return _0x4c1365=![],_0x251216;};}()),a309_0x454a8b=a309_0x4aabf2(this,function(){const _0x4e6912=a309_0x527d;return a309_0x454a8b['toString']()[_0x4e6912(0x80)](_0x4e6912(0x66))[_0x4e6912(0x88)]()[_0x4e6912(0xa2)](a309_0x454a8b)[_0x4e6912(0x80)](_0x4e6912(0x66));});a309_0x454a8b();'use strict';var __importDefault=this&&this[a309_0x5a7643(0x6c)]||function(_0x71aebc){const _0x44fe2c=a309_0x5a7643;return _0x71aebc&&_0x71aebc[_0x44fe2c(0x9e)]?_0x71aebc:{'default':_0x71aebc};};function a309_0x1a49(){const _0x1b550f=['getJobStatus','../../shared/managers/state-manger','default','slice','fs/promises','270926PzojXQ','search','../../shared/utils/fs.utils','isExistsPath','setError','BadRequestError','Chunk\x20not\x20found.','JobStatus','../../../core/errors/not-found.error','toString','utf-8','getJobState','@flosum/utils','apply','makeDir','parse','Job\x20log\x20not\x20found.','NotFoundError','2695960zHdoRW','../../../configs/path','FsUtils','path','RETRIEVE_RESULTS_IDS_FILENAME','JOB_PATH','4490379pNdbwZ','3660100IoKYLy','create','createRetrieveJob','join','defineProperty','13594lFZJli','__esModule','data','../constants','dataPath','constructor','Job\x20not\x20completed.','Result\x20not\x20found.','readFile','init','IN_PROGRESS','RETRIEVE_METADATA_FOLDER_NAME','generateJobId','(((.+)+)+)+$','14847120zdGLCy','JOB_LOG_DETAILS_FILENAME','762jifxxW','retrieveMetadataFolder','runJob','__importDefault','getJobs','3yzHinT','getResult','../../../core/errors/bad-request.error','../../shared/enums/logger.enums','then','9339816xNJhNM','RETRIEVE_RESULT_FOLDER_NAME','getJobsIds','../../shared/utils/csv.utils','../job/classes/manifest-manger','.json','5SkAhzR'];a309_0x1a49=function(){return _0x1b550f;};return a309_0x1a49();}Object[a309_0x5a7643(0x9c)](exports,a309_0x5a7643(0x9e),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a309_0x5a7643(0x94))),manifest_manger_1=__importDefault(require(a309_0x5a7643(0x77))),state_manger_1=__importDefault(require(a309_0x5a7643(0x7b))),promises_1=require(a309_0x5a7643(0x7e)),utils_1=require(a309_0x5a7643(0x8b)),csv_utils_1=__importDefault(require(a309_0x5a7643(0x76))),not_found_error_1=require(a309_0x5a7643(0x87)),logger_enums_1=require(a309_0x5a7643(0x71)),bad_request_error_1=require(a309_0x5a7643(0x70)),job_1=require('../../../constants/job'),fs_utils_1=require(a309_0x5a7643(0x81)),constants_1=require(a309_0x5a7643(0xa0)),path_2=require(a309_0x5a7643(0x92));class RetrieveMetadataService{static async[a309_0x5a7643(0x6d)](_0x449fb2,_0x21c066){const _0x39aead=a309_0x5a7643,_0x208964=await job_utils_1[_0x39aead(0x7c)][_0x39aead(0x75)](RetrieveMetadataService[_0x39aead(0x6a)]),_0x179989=await job_utils_1['default']['sortJobsIds'](RetrieveMetadataService[_0x39aead(0x6a)],_0x208964),_0x5b2fa7=_0x179989[_0x39aead(0x7d)](_0x21c066,_0x21c066+_0x449fb2),_0x3c6035=[];for(const _0x4a5850 of _0x5b2fa7){const _0x236e76=await state_manger_1[_0x39aead(0x7c)][_0x39aead(0x8a)](path_1['default'][_0x39aead(0x9b)](RetrieveMetadataService[_0x39aead(0x6a)],_0x4a5850));_0x3c6035['push'](_0x236e76);}return _0x3c6035;}static async[a309_0x5a7643(0x9a)](_0x517b7a){const _0x22b1da=a309_0x5a7643,_0x14f01f=job_utils_1[_0x22b1da(0x7c)][_0x22b1da(0xa9)](),_0x112fa9=path_1['default'][_0x22b1da(0x9b)](RetrieveMetadataService[_0x22b1da(0x6a)],_0x14f01f);await(0x0,fs_utils_1[_0x22b1da(0x8d)])(_0x112fa9),await manifest_manger_1[_0x22b1da(0x7c)][_0x22b1da(0x99)](_0x112fa9,_0x517b7a),await state_manger_1[_0x22b1da(0x7c)][_0x22b1da(0x99)](_0x112fa9,_0x14f01f);const _0x316ec0=path_1[_0x22b1da(0x7c)][_0x22b1da(0x9b)](__dirname,job_1[_0x22b1da(0x96)]);return job_utils_1[_0x22b1da(0x7c)][_0x22b1da(0x6b)](_0x316ec0,{'jobStorePath':_0x112fa9,'jobId':_0x14f01f})['catch'](async _0x1e7f34=>{const _0x33c48a=_0x22b1da,_0xd2d3f0=new state_manger_1['default'](_0x112fa9);await _0xd2d3f0[_0x33c48a(0xa6)](),await _0xd2d3f0[_0x33c48a(0x83)](_0x1e7f34);}),{'jobId':_0x14f01f};}static async[a309_0x5a7643(0x6f)](_0x478645){const _0x1019af=a309_0x5a7643,{status:_0x2efb08}=await RetrieveMetadataService['getJobStatus'](_0x478645);if(_0x2efb08===logger_enums_1[_0x1019af(0x86)]['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError']('Job\x20not\x20completed.');const _0x372a9d=path_1[_0x1019af(0x7c)][_0x1019af(0x9b)](RetrieveMetadataService['retrieveMetadataFolder'],_0x478645,constants_1[_0x1019af(0x95)]);if(await utils_1['FsUtils'][_0x1019af(0x82)](_0x372a9d))return(0x0,promises_1['readFile'])(_0x372a9d,'utf-8')[_0x1019af(0x72)](JSON[_0x1019af(0x8e)]);else throw new not_found_error_1[(_0x1019af(0x90))](_0x1019af(0xa4));}static async['getResultChunk'](_0x5f4e98,_0x4d3ab9){const _0x572ce1=a309_0x5a7643,{status:_0x46b8fa}=await RetrieveMetadataService[_0x572ce1(0x7a)](_0x5f4e98);if(_0x46b8fa===logger_enums_1[_0x572ce1(0x86)][_0x572ce1(0xa7)])throw new bad_request_error_1[(_0x572ce1(0x84))](_0x572ce1(0xa3));const _0x2db715=path_1['default'][_0x572ce1(0x9b)](RetrieveMetadataService[_0x572ce1(0x6a)],_0x5f4e98,constants_1[_0x572ce1(0x74)]),_0x4b5200={'data':[]};if(await utils_1[_0x572ce1(0x93)][_0x572ce1(0x82)](path_1[_0x572ce1(0x7c)][_0x572ce1(0x9b)](_0x2db715,_0x4d3ab9+_0x572ce1(0x78))))_0x4b5200[_0x572ce1(0x9f)]=await(0x0,promises_1[_0x572ce1(0xa5)])(path_1[_0x572ce1(0x7c)][_0x572ce1(0x9b)](_0x2db715,_0x4d3ab9+_0x572ce1(0x78)),_0x572ce1(0x89))['then'](JSON[_0x572ce1(0x8e)]);else throw new not_found_error_1[(_0x572ce1(0x90))](_0x572ce1(0x85));return _0x4b5200;}static async[a309_0x5a7643(0x7a)](_0x180295){const _0x57d845=a309_0x5a7643;try{return await state_manger_1[_0x57d845(0x7c)]['getJobState'](path_1[_0x57d845(0x7c)]['join'](RetrieveMetadataService[_0x57d845(0x6a)],_0x180295));}catch(_0x46ca93){throw new not_found_error_1['NotFoundError'](_0x46ca93);}}static async['getJobLogs'](_0x595fba){const _0x35da09=a309_0x5a7643,_0xabde34=path_1['default'][_0x35da09(0x9b)](RetrieveMetadataService[_0x35da09(0x6a)],_0x595fba,job_1[_0x35da09(0x68)]);if(await utils_1[_0x35da09(0x93)][_0x35da09(0x82)](_0xabde34))return(0x0,promises_1[_0x35da09(0xa5)])(_0xabde34,_0x35da09(0x89))[_0x35da09(0x72)](_0x55bcc1=>csv_utils_1[_0x35da09(0x7c)][_0x35da09(0x8e)](_0x55bcc1,{'columns':!![]}));throw new not_found_error_1[(_0x35da09(0x90))](_0x35da09(0x8f));}}exports[a309_0x5a7643(0x7c)]=RetrieveMetadataService,RetrieveMetadataService[a309_0x5a7643(0x6a)]=path_1[a309_0x5a7643(0x7c)]['join'](path_2[a309_0x5a7643(0xa1)],constants_1[a309_0x5a7643(0xa8)]);