const a320_0x26d22d=a320_0x23a0;(function(_0x357a12,_0x632e1b){const _0xbcc52b=a320_0x23a0,_0x296950=_0x357a12();while(!![]){try{const _0x3f1be7=-parseInt(_0xbcc52b(0x1e1))/0x1+-parseInt(_0xbcc52b(0x1df))/0x2+parseInt(_0xbcc52b(0x1dd))/0x3+parseInt(_0xbcc52b(0x1d4))/0x4+parseInt(_0xbcc52b(0x1c6))/0x5*(parseInt(_0xbcc52b(0x1e7))/0x6)+-parseInt(_0xbcc52b(0x1e2))/0x7+-parseInt(_0xbcc52b(0x1d8))/0x8*(-parseInt(_0xbcc52b(0x1ec))/0x9);if(_0x3f1be7===_0x632e1b)break;else _0x296950['push'](_0x296950['shift']());}catch(_0x30f58b){_0x296950['push'](_0x296950['shift']());}}}(a320_0x162d,0x6d020));const a320_0x3e85dd=(function(){let _0x5532f2=!![];return function(_0x21c1e9,_0x5e5a84){const _0x1212b4=_0x5532f2?function(){const _0x443432=a320_0x23a0;if(_0x5e5a84){const _0x58adef=_0x5e5a84[_0x443432(0x1c7)](_0x21c1e9,arguments);return _0x5e5a84=null,_0x58adef;}}:function(){};return _0x5532f2=![],_0x1212b4;};}()),a320_0x48a13c=a320_0x3e85dd(this,function(){const _0x1e7bb8=a320_0x23a0;return a320_0x48a13c[_0x1e7bb8(0x1f0)]()['search'](_0x1e7bb8(0x1ed))[_0x1e7bb8(0x1f0)]()[_0x1e7bb8(0x1d3)](a320_0x48a13c)[_0x1e7bb8(0x1d2)]('(((.+)+)+)+$');});function a320_0x23a0(_0x2aecb0,_0x14fb02){const _0x5d71f4=a320_0x162d();return a320_0x23a0=function(_0x48a13c,_0x3e85dd){_0x48a13c=_0x48a13c-0x1b2;let _0x162db7=_0x5d71f4[_0x48a13c];return _0x162db7;},a320_0x23a0(_0x2aecb0,_0x14fb02);}a320_0x48a13c();'use strict';var __importDefault=this&&this[a320_0x26d22d(0x1e3)]||function(_0x1ca655){return _0x1ca655&&_0x1ca655['__esModule']?_0x1ca655:{'default':_0x1ca655};};Object[a320_0x26d22d(0x1bc)](exports,a320_0x26d22d(0x1cf),{'value':!![]});function a320_0x162d(){const _0x1fc3e8=['defineProperty','FsUtils','@flosum/utils','default','RETRIEVE_RESULTS_IDS_FILENAME','init','../constants','IN_PROGRESS','../../shared/managers/state-manger','../../shared/enums/logger.enums','4285vGJxrU','apply','Job\x20not\x20completed.','getJobsIds','join','BadRequestError','readFile','generateJobId','getJobState','__esModule','create','JOB_LOG_DETAILS_FILENAME','search','constructor','629404yhfgEX','getJobs','../../shared/utils/job.utils','getJobStatus','32680rsWvQI','runJob','retrieveMetadataFolder','setError','../../shared/utils/csv.utils','1667298Fwlivn','.json','53900AHEmCm','data','576731fksOiK','2423176PkttuL','__importDefault','JOB_PATH','then','RETRIEVE_RESULT_FOLDER_NAME','3954KCeBqx','RETRIEVE_METADATA_FOLDER_NAME','Job\x20log\x20not\x20found.','NotFoundError','slice','261LTPPKq','(((.+)+)+)+$','utf-8','isExistsPath','toString','Chunk\x20not\x20found.','parse','push','../../shared/utils/fs.utils','../../../configs/path','getResultChunk','createRetrieveJob','getJobLogs','dataPath','JobStatus','../../../core/errors/bad-request.error','path'];a320_0x162d=function(){return _0x1fc3e8;};return a320_0x162d();}const job_utils_1=__importDefault(require(a320_0x26d22d(0x1d6))),path_1=__importDefault(require(a320_0x26d22d(0x1bb))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a320_0x26d22d(0x1c4))),promises_1=require('fs/promises'),utils_1=require(a320_0x26d22d(0x1be)),csv_utils_1=__importDefault(require(a320_0x26d22d(0x1dc))),not_found_error_1=require('../../../core/errors/not-found.error'),logger_enums_1=require(a320_0x26d22d(0x1c5)),bad_request_error_1=require(a320_0x26d22d(0x1ba)),job_1=require('../../../constants/job'),fs_utils_1=require(a320_0x26d22d(0x1b3)),constants_1=require(a320_0x26d22d(0x1c2)),path_2=require(a320_0x26d22d(0x1b4));class RetrieveMetadataService{static async[a320_0x26d22d(0x1d5)](_0x47b0fe,_0x159418){const _0x5736e6=a320_0x26d22d,_0x526153=await job_utils_1['default'][_0x5736e6(0x1c9)](RetrieveMetadataService[_0x5736e6(0x1da)]),_0x418d34=await job_utils_1['default']['sortJobsIds'](RetrieveMetadataService[_0x5736e6(0x1da)],_0x526153),_0x45c6a0=_0x418d34[_0x5736e6(0x1eb)](_0x159418,_0x159418+_0x47b0fe),_0x4fc4cf=[];for(const _0x4b1e54 of _0x45c6a0){const _0x3725f7=await state_manger_1[_0x5736e6(0x1bf)][_0x5736e6(0x1ce)](path_1['default']['join'](RetrieveMetadataService[_0x5736e6(0x1da)],_0x4b1e54));_0x4fc4cf[_0x5736e6(0x1b2)](_0x3725f7);}return _0x4fc4cf;}static async[a320_0x26d22d(0x1b6)](_0x4bee91){const _0x2734a6=a320_0x26d22d,_0x58b667=job_utils_1[_0x2734a6(0x1bf)][_0x2734a6(0x1cd)](),_0x349aff=path_1[_0x2734a6(0x1bf)][_0x2734a6(0x1ca)](RetrieveMetadataService[_0x2734a6(0x1da)],_0x58b667);await(0x0,fs_utils_1['makeDir'])(_0x349aff),await manifest_manger_1[_0x2734a6(0x1bf)][_0x2734a6(0x1d0)](_0x349aff,_0x4bee91),await state_manger_1[_0x2734a6(0x1bf)]['create'](_0x349aff,_0x58b667);const _0x240511=path_1[_0x2734a6(0x1bf)][_0x2734a6(0x1ca)](__dirname,job_1[_0x2734a6(0x1e4)]);return job_utils_1[_0x2734a6(0x1bf)][_0x2734a6(0x1d9)](_0x240511,{'jobStorePath':_0x349aff,'jobId':_0x58b667})['catch'](async _0x405db3=>{const _0x16e827=_0x2734a6,_0x44231e=new state_manger_1[(_0x16e827(0x1bf))](_0x349aff);await _0x44231e[_0x16e827(0x1c1)](),await _0x44231e[_0x16e827(0x1db)](_0x405db3);}),{'jobId':_0x58b667};}static async['getResult'](_0x11618b){const _0x157584=a320_0x26d22d,{status:_0x5782d2}=await RetrieveMetadataService[_0x157584(0x1d7)](_0x11618b);if(_0x5782d2===logger_enums_1['JobStatus'][_0x157584(0x1c3)])throw new bad_request_error_1[(_0x157584(0x1cb))](_0x157584(0x1c8));const _0x3ac075=path_1[_0x157584(0x1bf)][_0x157584(0x1ca)](RetrieveMetadataService[_0x157584(0x1da)],_0x11618b,constants_1[_0x157584(0x1c0)]);if(await utils_1[_0x157584(0x1bd)][_0x157584(0x1ef)](_0x3ac075))return(0x0,promises_1[_0x157584(0x1cc)])(_0x3ac075,'utf-8')[_0x157584(0x1e5)](JSON[_0x157584(0x1f2)]);else throw new not_found_error_1[(_0x157584(0x1ea))]('Result\x20not\x20found.');}static async[a320_0x26d22d(0x1b5)](_0xf746d9,_0x275de1){const _0x15d90e=a320_0x26d22d,{status:_0x10f109}=await RetrieveMetadataService[_0x15d90e(0x1d7)](_0xf746d9);if(_0x10f109===logger_enums_1[_0x15d90e(0x1b9)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x15d90e(0x1cb))](_0x15d90e(0x1c8));const _0x5aacc9=path_1[_0x15d90e(0x1bf)]['join'](RetrieveMetadataService[_0x15d90e(0x1da)],_0xf746d9,constants_1[_0x15d90e(0x1e6)]),_0x5d660e={'data':[]};if(await utils_1[_0x15d90e(0x1bd)][_0x15d90e(0x1ef)](path_1[_0x15d90e(0x1bf)]['join'](_0x5aacc9,_0x275de1+_0x15d90e(0x1de))))_0x5d660e[_0x15d90e(0x1e0)]=await(0x0,promises_1[_0x15d90e(0x1cc)])(path_1[_0x15d90e(0x1bf)][_0x15d90e(0x1ca)](_0x5aacc9,_0x275de1+_0x15d90e(0x1de)),'utf-8')['then'](JSON[_0x15d90e(0x1f2)]);else throw new not_found_error_1[(_0x15d90e(0x1ea))](_0x15d90e(0x1f1));return _0x5d660e;}static async[a320_0x26d22d(0x1d7)](_0x5bddcd){const _0x23bf97=a320_0x26d22d;try{return await state_manger_1[_0x23bf97(0x1bf)]['getJobState'](path_1[_0x23bf97(0x1bf)][_0x23bf97(0x1ca)](RetrieveMetadataService[_0x23bf97(0x1da)],_0x5bddcd));}catch(_0x3ff11a){throw new not_found_error_1[(_0x23bf97(0x1ea))](_0x3ff11a);}}static async[a320_0x26d22d(0x1b7)](_0x746d54){const _0x560884=a320_0x26d22d,_0xb90d3d=path_1[_0x560884(0x1bf)][_0x560884(0x1ca)](RetrieveMetadataService[_0x560884(0x1da)],_0x746d54,job_1[_0x560884(0x1d1)]);if(await utils_1[_0x560884(0x1bd)][_0x560884(0x1ef)](_0xb90d3d))return(0x0,promises_1[_0x560884(0x1cc)])(_0xb90d3d,_0x560884(0x1ee))[_0x560884(0x1e5)](_0x358a2d=>csv_utils_1[_0x560884(0x1bf)][_0x560884(0x1f2)](_0x358a2d,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x560884(0x1e9));}}exports[a320_0x26d22d(0x1bf)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a320_0x26d22d(0x1bf)][a320_0x26d22d(0x1ca)](path_2[a320_0x26d22d(0x1b8)],constants_1[a320_0x26d22d(0x1e8)]);