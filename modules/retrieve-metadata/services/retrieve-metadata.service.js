function a292_0x59eb(_0x3221e1,_0x229d95){const _0x12e7bb=a292_0x1dbb();return a292_0x59eb=function(_0x1614a2,_0x54116b){_0x1614a2=_0x1614a2-0x15f;let _0x1dbb48=_0x12e7bb[_0x1614a2];return _0x1dbb48;},a292_0x59eb(_0x3221e1,_0x229d95);}const a292_0x314d43=a292_0x59eb;(function(_0x55b03d,_0xbcc17){const _0x419ce9=a292_0x59eb,_0x1e91b4=_0x55b03d();while(!![]){try{const _0x359737=-parseInt(_0x419ce9(0x167))/0x1+parseInt(_0x419ce9(0x17d))/0x2+parseInt(_0x419ce9(0x16d))/0x3*(parseInt(_0x419ce9(0x160))/0x4)+parseInt(_0x419ce9(0x168))/0x5*(-parseInt(_0x419ce9(0x173))/0x6)+parseInt(_0x419ce9(0x178))/0x7*(-parseInt(_0x419ce9(0x180))/0x8)+-parseInt(_0x419ce9(0x19e))/0x9+parseInt(_0x419ce9(0x197))/0xa;if(_0x359737===_0xbcc17)break;else _0x1e91b4['push'](_0x1e91b4['shift']());}catch(_0xcada1f){_0x1e91b4['push'](_0x1e91b4['shift']());}}}(a292_0x1dbb,0x43db1));const a292_0x54116b=(function(){let _0xc5a9c5=!![];return function(_0x198ae6,_0x1b734c){const _0x573428=_0xc5a9c5?function(){if(_0x1b734c){const _0x111e66=_0x1b734c['apply'](_0x198ae6,arguments);return _0x1b734c=null,_0x111e66;}}:function(){};return _0xc5a9c5=![],_0x573428;};}()),a292_0x1614a2=a292_0x54116b(this,function(){const _0x292929=a292_0x59eb;return a292_0x1614a2['toString']()[_0x292929(0x192)](_0x292929(0x184))[_0x292929(0x187)]()[_0x292929(0x177)](a292_0x1614a2)[_0x292929(0x192)](_0x292929(0x184));});a292_0x1614a2();'use strict';var __importDefault=this&&this[a292_0x314d43(0x161)]||function(_0x35af45){const _0x388cea=a292_0x314d43;return _0x35af45&&_0x35af45[_0x388cea(0x162)]?_0x35af45:{'default':_0x35af45};};function a292_0x1dbb(){const _0x58c0b1=['5HhlFjB','getResultChunk','data','join','NotFoundError','3831xJTDBt','fs/promises','getJobStatus','../../../configs/path','retrieveMetadataFolder','utf-8','767388qsWyEc','Job\x20log\x20not\x20found.','dataPath','slice','constructor','3563ttpsLw','parse','IN_PROGRESS','Job\x20not\x20completed.','makeDir','416972wlDaZS','../../shared/enums/logger.enums','getJobState','2432LCWUqL','generateJobId','isExistsPath','push','(((.+)+)+)+$','FsUtils','create','toString','JOB_PATH','readFile','../../../core/errors/bad-request.error','getJobs','JOB_LOG_DETAILS_FILENAME','Result\x20not\x20found.','default','then','init','JobStatus','search','Chunk\x20not\x20found.','getJobsIds','../job/classes/manifest-manger','../../shared/utils/job.utils','8061870FtkCwL','getResult','catch','../../../constants/job','defineProperty','path','.json','3487833COvtCL','../../../core/errors/not-found.error','312gIKRYT','__importDefault','__esModule','../../shared/utils/fs.utils','RETRIEVE_RESULT_FOLDER_NAME','@flosum/utils','runJob','166171cusCrP'];a292_0x1dbb=function(){return _0x58c0b1;};return a292_0x1dbb();}Object[a292_0x314d43(0x19b)](exports,a292_0x314d43(0x162),{'value':!![]});const job_utils_1=__importDefault(require(a292_0x314d43(0x196))),path_1=__importDefault(require(a292_0x314d43(0x19c))),manifest_manger_1=__importDefault(require(a292_0x314d43(0x195))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require(a292_0x314d43(0x16e)),utils_1=require(a292_0x314d43(0x165)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a292_0x314d43(0x15f)),logger_enums_1=require(a292_0x314d43(0x17e)),bad_request_error_1=require(a292_0x314d43(0x18a)),job_1=require(a292_0x314d43(0x19a)),fs_utils_1=require(a292_0x314d43(0x163)),constants_1=require('../constants'),path_2=require(a292_0x314d43(0x170));class RetrieveMetadataService{static async[a292_0x314d43(0x18b)](_0x308d00,_0x38b46b){const _0x3cd341=a292_0x314d43,_0x1e9241=await job_utils_1[_0x3cd341(0x18e)][_0x3cd341(0x194)](RetrieveMetadataService[_0x3cd341(0x171)]),_0x490d56=await job_utils_1[_0x3cd341(0x18e)]['sortJobsIds'](RetrieveMetadataService[_0x3cd341(0x171)],_0x1e9241),_0x8fdb28=_0x490d56[_0x3cd341(0x176)](_0x38b46b,_0x38b46b+_0x308d00),_0x406a72=[];for(const _0x2c93fe of _0x8fdb28){const _0x39e04a=await state_manger_1[_0x3cd341(0x18e)]['getJobState'](path_1[_0x3cd341(0x18e)][_0x3cd341(0x16b)](RetrieveMetadataService[_0x3cd341(0x171)],_0x2c93fe));_0x406a72[_0x3cd341(0x183)](_0x39e04a);}return _0x406a72;}static async['createRetrieveJob'](_0x1a8389){const _0x32a724=a292_0x314d43,_0x57d8cc=job_utils_1[_0x32a724(0x18e)][_0x32a724(0x181)](),_0x258501=path_1[_0x32a724(0x18e)][_0x32a724(0x16b)](RetrieveMetadataService[_0x32a724(0x171)],_0x57d8cc);await(0x0,fs_utils_1[_0x32a724(0x17c)])(_0x258501),await manifest_manger_1['default'][_0x32a724(0x186)](_0x258501,_0x1a8389),await state_manger_1[_0x32a724(0x18e)][_0x32a724(0x186)](_0x258501,_0x57d8cc);const _0x47f54a=path_1[_0x32a724(0x18e)][_0x32a724(0x16b)](__dirname,job_1[_0x32a724(0x188)]);return job_utils_1[_0x32a724(0x18e)][_0x32a724(0x166)](_0x47f54a,{'jobStorePath':_0x258501,'jobId':_0x57d8cc})[_0x32a724(0x199)](async _0x204dfe=>{const _0x28bb80=_0x32a724,_0x43b608=new state_manger_1[(_0x28bb80(0x18e))](_0x258501);await _0x43b608[_0x28bb80(0x190)](),await _0x43b608['setError'](_0x204dfe);}),{'jobId':_0x57d8cc};}static async[a292_0x314d43(0x198)](_0x5a5dfd){const _0xa87306=a292_0x314d43,{status:_0x2a2adb}=await RetrieveMetadataService[_0xa87306(0x16f)](_0x5a5dfd);if(_0x2a2adb===logger_enums_1['JobStatus'][_0xa87306(0x17a)])throw new bad_request_error_1['BadRequestError'](_0xa87306(0x17b));const _0xd01c0a=path_1[_0xa87306(0x18e)][_0xa87306(0x16b)](RetrieveMetadataService[_0xa87306(0x171)],_0x5a5dfd,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0xa87306(0x185)][_0xa87306(0x182)](_0xd01c0a))return(0x0,promises_1[_0xa87306(0x189)])(_0xd01c0a,_0xa87306(0x172))[_0xa87306(0x18f)](JSON['parse']);else throw new not_found_error_1['NotFoundError'](_0xa87306(0x18d));}static async[a292_0x314d43(0x169)](_0x21ce6a,_0x17cdd8){const _0x24b727=a292_0x314d43,{status:_0x5e8ce5}=await RetrieveMetadataService[_0x24b727(0x16f)](_0x21ce6a);if(_0x5e8ce5===logger_enums_1[_0x24b727(0x191)][_0x24b727(0x17a)])throw new bad_request_error_1['BadRequestError']('Job\x20not\x20completed.');const _0x5854bb=path_1['default'][_0x24b727(0x16b)](RetrieveMetadataService['retrieveMetadataFolder'],_0x21ce6a,constants_1[_0x24b727(0x164)]),_0x1bdcfc={'data':[]};if(await utils_1[_0x24b727(0x185)][_0x24b727(0x182)](path_1[_0x24b727(0x18e)][_0x24b727(0x16b)](_0x5854bb,_0x17cdd8+_0x24b727(0x19d))))_0x1bdcfc[_0x24b727(0x16a)]=await(0x0,promises_1[_0x24b727(0x189)])(path_1['default'][_0x24b727(0x16b)](_0x5854bb,_0x17cdd8+_0x24b727(0x19d)),'utf-8')[_0x24b727(0x18f)](JSON[_0x24b727(0x179)]);else throw new not_found_error_1['NotFoundError'](_0x24b727(0x193));return _0x1bdcfc;}static async[a292_0x314d43(0x16f)](_0x55424a){const _0x47e71b=a292_0x314d43;try{return await state_manger_1[_0x47e71b(0x18e)][_0x47e71b(0x17f)](path_1[_0x47e71b(0x18e)][_0x47e71b(0x16b)](RetrieveMetadataService['retrieveMetadataFolder'],_0x55424a));}catch(_0x313596){throw new not_found_error_1[(_0x47e71b(0x16c))](_0x313596);}}static async['getJobLogs'](_0x4b3fa2){const _0x18f94d=a292_0x314d43,_0x2c3fd4=path_1['default'][_0x18f94d(0x16b)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4b3fa2,job_1[_0x18f94d(0x18c)]);if(await utils_1['FsUtils'][_0x18f94d(0x182)](_0x2c3fd4))return(0x0,promises_1['readFile'])(_0x2c3fd4,_0x18f94d(0x172))[_0x18f94d(0x18f)](_0x190117=>csv_utils_1[_0x18f94d(0x18e)][_0x18f94d(0x179)](_0x190117,{'columns':!![]}));throw new not_found_error_1[(_0x18f94d(0x16c))](_0x18f94d(0x174));}}exports[a292_0x314d43(0x18e)]=RetrieveMetadataService,RetrieveMetadataService[a292_0x314d43(0x171)]=path_1['default'][a292_0x314d43(0x16b)](path_2[a292_0x314d43(0x175)],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);