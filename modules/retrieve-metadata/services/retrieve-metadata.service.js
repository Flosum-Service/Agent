const a319_0x14d9ed=a319_0x3401;(function(_0x2931ea,_0x1e9cab){const _0x213855=a319_0x3401,_0x25e533=_0x2931ea();while(!![]){try{const _0x520365=parseInt(_0x213855(0xda))/0x1+-parseInt(_0x213855(0xf1))/0x2+parseInt(_0x213855(0xdd))/0x3*(-parseInt(_0x213855(0xed))/0x4)+-parseInt(_0x213855(0xe0))/0x5+parseInt(_0x213855(0xd2))/0x6+-parseInt(_0x213855(0x102))/0x7*(parseInt(_0x213855(0xeb))/0x8)+parseInt(_0x213855(0x100))/0x9*(parseInt(_0x213855(0xd8))/0xa);if(_0x520365===_0x1e9cab)break;else _0x25e533['push'](_0x25e533['shift']());}catch(_0x5408ab){_0x25e533['push'](_0x25e533['shift']());}}}(a319_0x2e7e,0xbb210));const a319_0x1dd43e=(function(){let _0x41c318=!![];return function(_0x15d2bc,_0x26b1e2){const _0xe2a862=_0x41c318?function(){if(_0x26b1e2){const _0x141e29=_0x26b1e2['apply'](_0x15d2bc,arguments);return _0x26b1e2=null,_0x141e29;}}:function(){};return _0x41c318=![],_0xe2a862;};}()),a319_0x2835ac=a319_0x1dd43e(this,function(){const _0x5600a6=a319_0x3401;return a319_0x2835ac[_0x5600a6(0xcc)]()[_0x5600a6(0xec)](_0x5600a6(0xe6))[_0x5600a6(0xcc)]()['constructor'](a319_0x2835ac)[_0x5600a6(0xec)]('(((.+)+)+)+$');});a319_0x2835ac();'use strict';function a319_0x2e7e(){const _0x428d8e=['generateJobId','4027128pYWWwC','../../shared/utils/csv.utils','setError','parse','default','fs/promises','21290bkBaXv','../../shared/utils/fs.utils','1468525zBzhwV','JOB_PATH','getResult','3phegXR','../job/classes/manifest-manger','JOB_LOG_DETAILS_FILENAME','5801170wzMQJo','getJobsIds','IN_PROGRESS','../../../configs/path','../../../core/errors/not-found.error','getJobStatus','(((.+)+)+)+$','Job\x20not\x20completed.','getJobState','@flosum/utils','Result\x20not\x20found.','16JXCcWC','search','2737432KctYZL','readFile','NotFoundError','__importDefault','2367672IPsfIJ','getResultChunk','init','then','FsUtils','slice','RETRIEVE_METADATA_FOLDER_NAME','create','../../shared/managers/state-manger','catch','../../shared/enums/logger.enums','JobStatus','utf-8','join','BadRequestError','10521parULW','path','2917621yOFKuz','isExistsPath','RETRIEVE_RESULTS_IDS_FILENAME','retrieveMetadataFolder','runJob','toString','../constants','../../shared/utils/job.utils','.json','__esModule'];a319_0x2e7e=function(){return _0x428d8e;};return a319_0x2e7e();}var __importDefault=this&&this[a319_0x14d9ed(0xf0)]||function(_0x53d406){const _0x22bc70=a319_0x14d9ed;return _0x53d406&&_0x53d406[_0x22bc70(0xd0)]?_0x53d406:{'default':_0x53d406};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a319_0x14d9ed(0xce))),path_1=__importDefault(require(a319_0x14d9ed(0x101))),manifest_manger_1=__importDefault(require(a319_0x14d9ed(0xde))),state_manger_1=__importDefault(require(a319_0x14d9ed(0xf9))),promises_1=require(a319_0x14d9ed(0xd7)),utils_1=require(a319_0x14d9ed(0xe9)),csv_utils_1=__importDefault(require(a319_0x14d9ed(0xd3))),not_found_error_1=require(a319_0x14d9ed(0xe4)),logger_enums_1=require(a319_0x14d9ed(0xfb)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require('../../../constants/job'),fs_utils_1=require(a319_0x14d9ed(0xd9)),constants_1=require(a319_0x14d9ed(0xcd)),path_2=require(a319_0x14d9ed(0xe3));function a319_0x3401(_0x20e64b,_0x228998){const _0x520ea2=a319_0x2e7e();return a319_0x3401=function(_0x2835ac,_0x1dd43e){_0x2835ac=_0x2835ac-0xc9;let _0x2e7ead=_0x520ea2[_0x2835ac];return _0x2e7ead;},a319_0x3401(_0x20e64b,_0x228998);}class RetrieveMetadataService{static async['getJobs'](_0x1dddac,_0x461a9a){const _0x3b74ad=a319_0x14d9ed,_0x497f34=await job_utils_1[_0x3b74ad(0xd6)][_0x3b74ad(0xe1)](RetrieveMetadataService['retrieveMetadataFolder']),_0x2d943d=await job_utils_1[_0x3b74ad(0xd6)]['sortJobsIds'](RetrieveMetadataService[_0x3b74ad(0xca)],_0x497f34),_0x76664b=_0x2d943d[_0x3b74ad(0xf6)](_0x461a9a,_0x461a9a+_0x1dddac),_0x3f0294=[];for(const _0x4f78c of _0x76664b){const _0x5c1870=await state_manger_1[_0x3b74ad(0xd6)][_0x3b74ad(0xe8)](path_1[_0x3b74ad(0xd6)][_0x3b74ad(0xfe)](RetrieveMetadataService[_0x3b74ad(0xca)],_0x4f78c));_0x3f0294['push'](_0x5c1870);}return _0x3f0294;}static async['createRetrieveJob'](_0x408aa5){const _0x56560e=a319_0x14d9ed,_0x169052=job_utils_1[_0x56560e(0xd6)][_0x56560e(0xd1)](),_0x50d4fc=path_1['default'][_0x56560e(0xfe)](RetrieveMetadataService[_0x56560e(0xca)],_0x169052);await(0x0,fs_utils_1['makeDir'])(_0x50d4fc),await manifest_manger_1[_0x56560e(0xd6)][_0x56560e(0xf8)](_0x50d4fc,_0x408aa5),await state_manger_1[_0x56560e(0xd6)]['create'](_0x50d4fc,_0x169052);const _0x14be9e=path_1[_0x56560e(0xd6)]['join'](__dirname,job_1[_0x56560e(0xdb)]);return job_utils_1[_0x56560e(0xd6)][_0x56560e(0xcb)](_0x14be9e,{'jobStorePath':_0x50d4fc,'jobId':_0x169052})[_0x56560e(0xfa)](async _0x2632de=>{const _0xcbbbfd=_0x56560e,_0x5a1d6d=new state_manger_1[(_0xcbbbfd(0xd6))](_0x50d4fc);await _0x5a1d6d[_0xcbbbfd(0xf3)](),await _0x5a1d6d[_0xcbbbfd(0xd4)](_0x2632de);}),{'jobId':_0x169052};}static async[a319_0x14d9ed(0xdc)](_0x28c860){const _0x40ed4c=a319_0x14d9ed,{status:_0x2d5959}=await RetrieveMetadataService[_0x40ed4c(0xe5)](_0x28c860);if(_0x2d5959===logger_enums_1[_0x40ed4c(0xfc)]['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError'](_0x40ed4c(0xe7));const _0x6d3881=path_1['default'][_0x40ed4c(0xfe)](RetrieveMetadataService[_0x40ed4c(0xca)],_0x28c860,constants_1[_0x40ed4c(0xc9)]);if(await utils_1[_0x40ed4c(0xf5)][_0x40ed4c(0x103)](_0x6d3881))return(0x0,promises_1[_0x40ed4c(0xee)])(_0x6d3881,'utf-8')[_0x40ed4c(0xf4)](JSON[_0x40ed4c(0xd5)]);else throw new not_found_error_1['NotFoundError'](_0x40ed4c(0xea));}static async[a319_0x14d9ed(0xf2)](_0x130610,_0x4269a1){const _0x3d5480=a319_0x14d9ed,{status:_0x64d0e8}=await RetrieveMetadataService[_0x3d5480(0xe5)](_0x130610);if(_0x64d0e8===logger_enums_1[_0x3d5480(0xfc)][_0x3d5480(0xe2)])throw new bad_request_error_1[(_0x3d5480(0xff))]('Job\x20not\x20completed.');const _0x2bc658=path_1['default']['join'](RetrieveMetadataService[_0x3d5480(0xca)],_0x130610,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x2311f4={'data':[]};if(await utils_1[_0x3d5480(0xf5)][_0x3d5480(0x103)](path_1[_0x3d5480(0xd6)][_0x3d5480(0xfe)](_0x2bc658,_0x4269a1+_0x3d5480(0xcf))))_0x2311f4['data']=await(0x0,promises_1[_0x3d5480(0xee)])(path_1[_0x3d5480(0xd6)][_0x3d5480(0xfe)](_0x2bc658,_0x4269a1+'.json'),_0x3d5480(0xfd))[_0x3d5480(0xf4)](JSON[_0x3d5480(0xd5)]);else throw new not_found_error_1['NotFoundError']('Chunk\x20not\x20found.');return _0x2311f4;}static async['getJobStatus'](_0x2ebbb8){const _0x5282cb=a319_0x14d9ed;try{return await state_manger_1[_0x5282cb(0xd6)][_0x5282cb(0xe8)](path_1[_0x5282cb(0xd6)][_0x5282cb(0xfe)](RetrieveMetadataService[_0x5282cb(0xca)],_0x2ebbb8));}catch(_0x5184d4){throw new not_found_error_1[(_0x5282cb(0xef))](_0x5184d4);}}static async['getJobLogs'](_0x1f12d2){const _0xbfb519=a319_0x14d9ed,_0x1ec455=path_1[_0xbfb519(0xd6)][_0xbfb519(0xfe)](RetrieveMetadataService[_0xbfb519(0xca)],_0x1f12d2,job_1[_0xbfb519(0xdf)]);if(await utils_1[_0xbfb519(0xf5)][_0xbfb519(0x103)](_0x1ec455))return(0x0,promises_1['readFile'])(_0x1ec455,_0xbfb519(0xfd))['then'](_0x355d8d=>csv_utils_1[_0xbfb519(0xd6)]['parse'](_0x355d8d,{'columns':!![]}));throw new not_found_error_1[(_0xbfb519(0xef))]('Job\x20log\x20not\x20found.');}}exports[a319_0x14d9ed(0xd6)]=RetrieveMetadataService,RetrieveMetadataService[a319_0x14d9ed(0xca)]=path_1['default'][a319_0x14d9ed(0xfe)](path_2['dataPath'],constants_1[a319_0x14d9ed(0xf7)]);