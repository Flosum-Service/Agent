const a319_0xc2c430=a319_0x211e;(function(_0x3c7d4f,_0x3af78d){const _0xbcc127=a319_0x211e,_0xe48fb3=_0x3c7d4f();while(!![]){try{const _0x246fcc=parseInt(_0xbcc127(0x101))/0x1*(parseInt(_0xbcc127(0xfb))/0x2)+-parseInt(_0xbcc127(0xd3))/0x3*(parseInt(_0xbcc127(0xff))/0x4)+-parseInt(_0xbcc127(0xe8))/0x5*(-parseInt(_0xbcc127(0xd0))/0x6)+-parseInt(_0xbcc127(0xf9))/0x7*(-parseInt(_0xbcc127(0xe9))/0x8)+-parseInt(_0xbcc127(0xdc))/0x9*(parseInt(_0xbcc127(0xd9))/0xa)+-parseInt(_0xbcc127(0xe7))/0xb*(parseInt(_0xbcc127(0xc9))/0xc)+parseInt(_0xbcc127(0xdf))/0xd;if(_0x246fcc===_0x3af78d)break;else _0xe48fb3['push'](_0xe48fb3['shift']());}catch(_0x377912){_0xe48fb3['push'](_0xe48fb3['shift']());}}}(a319_0x5087,0x6262b));const a319_0x52e08e=(function(){let _0x511b84=!![];return function(_0x1875fd,_0x51964a){const _0x39c7ae=_0x511b84?function(){const _0xd5a8c7=a319_0x211e;if(_0x51964a){const _0x2e8ce4=_0x51964a[_0xd5a8c7(0xeb)](_0x1875fd,arguments);return _0x51964a=null,_0x2e8ce4;}}:function(){};return _0x511b84=![],_0x39c7ae;};}()),a319_0x3caa68=a319_0x52e08e(this,function(){const _0x2f7c22=a319_0x211e;return a319_0x3caa68[_0x2f7c22(0xcb)]()['search'](_0x2f7c22(0xe5))[_0x2f7c22(0xcb)]()[_0x2f7c22(0xd7)](a319_0x3caa68)[_0x2f7c22(0xea)]('(((.+)+)+)+$');});function a319_0x211e(_0x37f1bc,_0x2aa329){const _0x5c0122=a319_0x5087();return a319_0x211e=function(_0x3caa68,_0x52e08e){_0x3caa68=_0x3caa68-0xc7;let _0x50871f=_0x5c0122[_0x3caa68];return _0x50871f;},a319_0x211e(_0x37f1bc,_0x2aa329);}a319_0x3caa68();'use strict';var __importDefault=this&&this[a319_0xc2c430(0xef)]||function(_0x1b8d41){const _0x4f185a=a319_0xc2c430;return _0x1b8d41&&_0x1b8d41[_0x4f185a(0xcf)]?_0x1b8d41:{'default':_0x1b8d41};};function a319_0x5087(){const _0x370e65=['getJobStatus','isExistsPath','../../../core/errors/bad-request.error','12144RbQzbI','getJobState','toString','default','Result\x20not\x20found.','create','__esModule','630wQYmtN','getJobsIds','../constants','3963sZRkTb','NotFoundError','data','defineProperty','constructor','readFile','500HpMpKl','parse','FsUtils','130905GqeFUA','JOB_LOG_DETAILS_FILENAME','retrieveMetadataFolder','6301399xujaDR','catch','getJobs','BadRequestError','../../../constants/job','runJob','(((.+)+)+)+$','../../shared/enums/logger.enums','352muLNJB','18840mcEJcv','8HzuSdE','search','apply','fs/promises','then','RETRIEVE_METADATA_FOLDER_NAME','__importDefault','path','JobStatus','join','Job\x20not\x20completed.','../../../configs/path','getResultChunk','generateJobId','.json','../../shared/utils/fs.utils','1901851BdfIAs','init','12KXpqQg','RETRIEVE_RESULTS_IDS_FILENAME','IN_PROGRESS','utf-8','388cyENLX','../../../core/errors/not-found.error','23117nJpTex','../job/classes/manifest-manger'];a319_0x5087=function(){return _0x370e65;};return a319_0x5087();}Object[a319_0xc2c430(0xd6)](exports,a319_0xc2c430(0xcf),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a319_0xc2c430(0xf0))),manifest_manger_1=__importDefault(require(a319_0xc2c430(0x102))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require(a319_0xc2c430(0xec)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a319_0xc2c430(0x100)),logger_enums_1=require(a319_0xc2c430(0xe6)),bad_request_error_1=require(a319_0xc2c430(0xc8)),job_1=require(a319_0xc2c430(0xe3)),fs_utils_1=require(a319_0xc2c430(0xf8)),constants_1=require(a319_0xc2c430(0xd2)),path_2=require(a319_0xc2c430(0xf4));class RetrieveMetadataService{static async[a319_0xc2c430(0xe1)](_0x679edc,_0x457cd1){const _0x58dcc5=a319_0xc2c430,_0x2cf8f5=await job_utils_1[_0x58dcc5(0xcc)][_0x58dcc5(0xd1)](RetrieveMetadataService['retrieveMetadataFolder']),_0x547c98=await job_utils_1[_0x58dcc5(0xcc)]['sortJobsIds'](RetrieveMetadataService[_0x58dcc5(0xde)],_0x2cf8f5),_0xd08fac=_0x547c98['slice'](_0x457cd1,_0x457cd1+_0x679edc),_0x3721c4=[];for(const _0x468744 of _0xd08fac){const _0x3a9a75=await state_manger_1['default'][_0x58dcc5(0xca)](path_1[_0x58dcc5(0xcc)][_0x58dcc5(0xf2)](RetrieveMetadataService[_0x58dcc5(0xde)],_0x468744));_0x3721c4['push'](_0x3a9a75);}return _0x3721c4;}static async['createRetrieveJob'](_0x22c3a8){const _0x21e6d0=a319_0xc2c430,_0x160f4d=job_utils_1[_0x21e6d0(0xcc)][_0x21e6d0(0xf6)](),_0x4ec7ca=path_1[_0x21e6d0(0xcc)][_0x21e6d0(0xf2)](RetrieveMetadataService[_0x21e6d0(0xde)],_0x160f4d);await(0x0,fs_utils_1['makeDir'])(_0x4ec7ca),await manifest_manger_1[_0x21e6d0(0xcc)][_0x21e6d0(0xce)](_0x4ec7ca,_0x22c3a8),await state_manger_1[_0x21e6d0(0xcc)][_0x21e6d0(0xce)](_0x4ec7ca,_0x160f4d);const _0x4a4bc6=path_1[_0x21e6d0(0xcc)]['join'](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x21e6d0(0xcc)][_0x21e6d0(0xe4)](_0x4a4bc6,{'jobStorePath':_0x4ec7ca,'jobId':_0x160f4d})[_0x21e6d0(0xe0)](async _0x3c5213=>{const _0x39cc2f=_0x21e6d0,_0x3e3444=new state_manger_1[(_0x39cc2f(0xcc))](_0x4ec7ca);await _0x3e3444[_0x39cc2f(0xfa)](),await _0x3e3444['setError'](_0x3c5213);}),{'jobId':_0x160f4d};}static async['getResult'](_0x38114a){const _0x1043e7=a319_0xc2c430,{status:_0x147190}=await RetrieveMetadataService[_0x1043e7(0x103)](_0x38114a);if(_0x147190===logger_enums_1['JobStatus'][_0x1043e7(0xfd)])throw new bad_request_error_1['BadRequestError'](_0x1043e7(0xf3));const _0x2b442d=path_1[_0x1043e7(0xcc)]['join'](RetrieveMetadataService[_0x1043e7(0xde)],_0x38114a,constants_1[_0x1043e7(0xfc)]);if(await utils_1[_0x1043e7(0xdb)][_0x1043e7(0xc7)](_0x2b442d))return(0x0,promises_1[_0x1043e7(0xd8)])(_0x2b442d,_0x1043e7(0xfe))['then'](JSON['parse']);else throw new not_found_error_1[(_0x1043e7(0xd4))](_0x1043e7(0xcd));}static async[a319_0xc2c430(0xf5)](_0x182d0b,_0x41a90b){const _0x7adfc=a319_0xc2c430,{status:_0x3fe190}=await RetrieveMetadataService[_0x7adfc(0x103)](_0x182d0b);if(_0x3fe190===logger_enums_1[_0x7adfc(0xf1)][_0x7adfc(0xfd)])throw new bad_request_error_1[(_0x7adfc(0xe2))](_0x7adfc(0xf3));const _0x1baf82=path_1['default'][_0x7adfc(0xf2)](RetrieveMetadataService[_0x7adfc(0xde)],_0x182d0b,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x27d786={'data':[]};if(await utils_1[_0x7adfc(0xdb)][_0x7adfc(0xc7)](path_1['default'][_0x7adfc(0xf2)](_0x1baf82,_0x41a90b+'.json')))_0x27d786[_0x7adfc(0xd5)]=await(0x0,promises_1[_0x7adfc(0xd8)])(path_1['default']['join'](_0x1baf82,_0x41a90b+_0x7adfc(0xf7)),'utf-8')['then'](JSON['parse']);else throw new not_found_error_1[(_0x7adfc(0xd4))]('Chunk\x20not\x20found.');return _0x27d786;}static async['getJobStatus'](_0x2c4280){const _0x2310f1=a319_0xc2c430;try{return await state_manger_1[_0x2310f1(0xcc)][_0x2310f1(0xca)](path_1[_0x2310f1(0xcc)]['join'](RetrieveMetadataService[_0x2310f1(0xde)],_0x2c4280));}catch(_0x3c4993){throw new not_found_error_1[(_0x2310f1(0xd4))](_0x3c4993);}}static async['getJobLogs'](_0xc57a81){const _0x43390f=a319_0xc2c430,_0x94ada5=path_1[_0x43390f(0xcc)][_0x43390f(0xf2)](RetrieveMetadataService[_0x43390f(0xde)],_0xc57a81,job_1[_0x43390f(0xdd)]);if(await utils_1[_0x43390f(0xdb)][_0x43390f(0xc7)](_0x94ada5))return(0x0,promises_1['readFile'])(_0x94ada5,'utf-8')[_0x43390f(0xed)](_0x3cb86f=>csv_utils_1[_0x43390f(0xcc)][_0x43390f(0xda)](_0x3cb86f,{'columns':!![]}));throw new not_found_error_1[(_0x43390f(0xd4))]('Job\x20log\x20not\x20found.');}}exports[a319_0xc2c430(0xcc)]=RetrieveMetadataService,RetrieveMetadataService[a319_0xc2c430(0xde)]=path_1['default']['join'](path_2['dataPath'],constants_1[a319_0xc2c430(0xee)]);