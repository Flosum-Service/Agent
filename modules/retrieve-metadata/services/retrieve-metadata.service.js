const a277_0x35d6d6=a277_0x3941;(function(_0x9daedc,_0x210b0c){const _0x2cfedf=a277_0x3941,_0x419421=_0x9daedc();while(!![]){try{const _0x42453c=parseInt(_0x2cfedf(0x8a))/0x1*(parseInt(_0x2cfedf(0x9f))/0x2)+-parseInt(_0x2cfedf(0x85))/0x3+parseInt(_0x2cfedf(0x6b))/0x4+-parseInt(_0x2cfedf(0x8d))/0x5+parseInt(_0x2cfedf(0x7c))/0x6+-parseInt(_0x2cfedf(0x8e))/0x7*(-parseInt(_0x2cfedf(0xa5))/0x8)+-parseInt(_0x2cfedf(0x6d))/0x9*(parseInt(_0x2cfedf(0x95))/0xa);if(_0x42453c===_0x210b0c)break;else _0x419421['push'](_0x419421['shift']());}catch(_0x575833){_0x419421['push'](_0x419421['shift']());}}}(a277_0x2d9e,0x976a6));const a277_0x41ce3d=(function(){let _0x30e84d=!![];return function(_0x3c05f3,_0x3837c3){const _0x4eb67f=_0x30e84d?function(){const _0x1abe0f=a277_0x3941;if(_0x3837c3){const _0x3a702e=_0x3837c3[_0x1abe0f(0x70)](_0x3c05f3,arguments);return _0x3837c3=null,_0x3a702e;}}:function(){};return _0x30e84d=![],_0x4eb67f;};}()),a277_0x61387a=a277_0x41ce3d(this,function(){const _0xafd5a6=a277_0x3941;return a277_0x61387a[_0xafd5a6(0x84)]()[_0xafd5a6(0x67)]('(((.+)+)+)+$')[_0xafd5a6(0x84)]()[_0xafd5a6(0x7b)](a277_0x61387a)[_0xafd5a6(0x67)](_0xafd5a6(0x8f));});a277_0x61387a();'use strict';var __importDefault=this&&this[a277_0x35d6d6(0x9c)]||function(_0x560585){return _0x560585&&_0x560585['__esModule']?_0x560585:{'default':_0x560585};};Object['defineProperty'](exports,a277_0x35d6d6(0x79),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require(a277_0x35d6d6(0xa3))),state_manger_1=__importDefault(require(a277_0x35d6d6(0x98))),promises_1=require(a277_0x35d6d6(0x82)),utils_1=require(a277_0x35d6d6(0x92)),csv_utils_1=__importDefault(require(a277_0x35d6d6(0x6c))),not_found_error_1=require(a277_0x35d6d6(0x83)),logger_enums_1=require(a277_0x35d6d6(0x81)),bad_request_error_1=require(a277_0x35d6d6(0xa1)),job_1=require(a277_0x35d6d6(0x89)),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a277_0x35d6d6(0x7d)),path_2=require('../../../configs/path');function a277_0x3941(_0x20464f,_0x4be621){const _0x452628=a277_0x2d9e();return a277_0x3941=function(_0x61387a,_0x41ce3d){_0x61387a=_0x61387a-0x67;let _0x2d9e69=_0x452628[_0x61387a];return _0x2d9e69;},a277_0x3941(_0x20464f,_0x4be621);}class RetrieveMetadataService{static async[a277_0x35d6d6(0x9b)](_0x14e5f8,_0x444fb7){const _0x3a622c=a277_0x35d6d6,_0xd97ca5=await job_utils_1[_0x3a622c(0x73)][_0x3a622c(0x86)](RetrieveMetadataService[_0x3a622c(0x99)]),_0x400db0=await job_utils_1['default'][_0x3a622c(0x68)](RetrieveMetadataService['retrieveMetadataFolder'],_0xd97ca5),_0x398548=_0x400db0[_0x3a622c(0x9d)](_0x444fb7,_0x444fb7+_0x14e5f8),_0x4894a6=[];for(const _0x442d33 of _0x398548){const _0x36cccd=await state_manger_1[_0x3a622c(0x73)][_0x3a622c(0x88)](path_1['default'][_0x3a622c(0x6f)](RetrieveMetadataService[_0x3a622c(0x99)],_0x442d33));_0x4894a6[_0x3a622c(0x78)](_0x36cccd);}return _0x4894a6;}static async[a277_0x35d6d6(0x71)](_0x19b19e){const _0x39edb2=a277_0x35d6d6,_0x55fcac=job_utils_1[_0x39edb2(0x73)][_0x39edb2(0x96)](),_0x4b6d88=path_1[_0x39edb2(0x73)][_0x39edb2(0x6f)](RetrieveMetadataService[_0x39edb2(0x99)],_0x55fcac);await(0x0,fs_utils_1['makeDir'])(_0x4b6d88),await manifest_manger_1[_0x39edb2(0x73)]['create'](_0x4b6d88,_0x19b19e),await state_manger_1[_0x39edb2(0x73)]['create'](_0x4b6d88,_0x55fcac);const _0x3fe81b=path_1[_0x39edb2(0x73)][_0x39edb2(0x6f)](__dirname,job_1[_0x39edb2(0x87)]);return job_utils_1[_0x39edb2(0x73)][_0x39edb2(0x6e)](_0x3fe81b,{'jobStorePath':_0x4b6d88,'jobId':_0x55fcac})[_0x39edb2(0x97)](async _0x21a277=>{const _0x7dccd0=_0x39edb2,_0x4e7cb4=new state_manger_1['default'](_0x4b6d88);await _0x4e7cb4['init'](),await _0x4e7cb4[_0x7dccd0(0x91)](_0x21a277);}),{'jobId':_0x55fcac};}static async[a277_0x35d6d6(0x72)](_0xb369a7){const _0x29cf0a=a277_0x35d6d6,{status:_0x39d14f}=await RetrieveMetadataService[_0x29cf0a(0x93)](_0xb369a7);if(_0x39d14f===logger_enums_1[_0x29cf0a(0xa0)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x29cf0a(0x76))]('Job\x20not\x20completed.');const _0x57d415=path_1[_0x29cf0a(0x73)][_0x29cf0a(0x6f)](RetrieveMetadataService[_0x29cf0a(0x99)],_0xb369a7,constants_1[_0x29cf0a(0x7a)]);if(await utils_1[_0x29cf0a(0x75)][_0x29cf0a(0x94)](_0x57d415))return(0x0,promises_1[_0x29cf0a(0x7e)])(_0x57d415,_0x29cf0a(0x8b))[_0x29cf0a(0x77)](JSON['parse']);else throw new not_found_error_1[(_0x29cf0a(0x9e))](_0x29cf0a(0x90));}static async[a277_0x35d6d6(0xa6)](_0x4987ea,_0x4f1b4f){const _0x163485=a277_0x35d6d6,{status:_0x308f01}=await RetrieveMetadataService[_0x163485(0x93)](_0x4987ea);if(_0x308f01===logger_enums_1['JobStatus'][_0x163485(0xa2)])throw new bad_request_error_1[(_0x163485(0x76))]('Job\x20not\x20completed.');const _0x3537fc=path_1[_0x163485(0x73)][_0x163485(0x6f)](RetrieveMetadataService[_0x163485(0x99)],_0x4987ea,constants_1[_0x163485(0xa4)]),_0x10b727={'data':[]};if(await utils_1[_0x163485(0x75)]['isExistsPath'](path_1[_0x163485(0x73)][_0x163485(0x6f)](_0x3537fc,_0x4f1b4f+_0x163485(0x8c))))_0x10b727['data']=await(0x0,promises_1[_0x163485(0x7e)])(path_1['default'][_0x163485(0x6f)](_0x3537fc,_0x4f1b4f+_0x163485(0x8c)),_0x163485(0x8b))[_0x163485(0x77)](JSON[_0x163485(0x74)]);else throw new not_found_error_1[(_0x163485(0x9e))](_0x163485(0x80));return _0x10b727;}static async[a277_0x35d6d6(0x93)](_0xd58560){const _0x1f4712=a277_0x35d6d6;try{return await state_manger_1[_0x1f4712(0x73)][_0x1f4712(0x88)](path_1[_0x1f4712(0x73)][_0x1f4712(0x6f)](RetrieveMetadataService[_0x1f4712(0x99)],_0xd58560));}catch(_0x4f9f90){throw new not_found_error_1['NotFoundError'](_0x4f9f90);}}static async[a277_0x35d6d6(0x6a)](_0x91ff10){const _0x1a703d=a277_0x35d6d6,_0x50fcf0=path_1[_0x1a703d(0x73)][_0x1a703d(0x6f)](RetrieveMetadataService['retrieveMetadataFolder'],_0x91ff10,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1['FsUtils']['isExistsPath'](_0x50fcf0))return(0x0,promises_1[_0x1a703d(0x7e)])(_0x50fcf0,'utf-8')[_0x1a703d(0x77)](_0x2abdc5=>csv_utils_1[_0x1a703d(0x73)][_0x1a703d(0x74)](_0x2abdc5,{'columns':!![]}));throw new not_found_error_1[(_0x1a703d(0x9e))](_0x1a703d(0x69));}}function a277_0x2d9e(){const _0x26e148=['../constants','readFile','dataPath','Chunk\x20not\x20found.','../../shared/enums/logger.enums','fs/promises','../../../core/errors/not-found.error','toString','722691JbFDwG','getJobsIds','JOB_PATH','getJobState','../../../constants/job','4LPcKXE','utf-8','.json','5473260suwtrX','6880930EKFMui','(((.+)+)+)+$','Result\x20not\x20found.','setError','@flosum/utils','getJobStatus','isExistsPath','12658430LmScOP','generateJobId','catch','../../shared/managers/state-manger','retrieveMetadataFolder','RETRIEVE_METADATA_FOLDER_NAME','getJobs','__importDefault','slice','NotFoundError','449644hGXZtr','JobStatus','../../../core/errors/bad-request.error','IN_PROGRESS','../job/classes/manifest-manger','RETRIEVE_RESULT_FOLDER_NAME','8mQoxdk','getResultChunk','search','sortJobsIds','Job\x20log\x20not\x20found.','getJobLogs','2602072KtXniy','../../shared/utils/csv.utils','9DIJKOb','runJob','join','apply','createRetrieveJob','getResult','default','parse','FsUtils','BadRequestError','then','push','__esModule','RETRIEVE_RESULTS_IDS_FILENAME','constructor','4132764YtYJuY'];a277_0x2d9e=function(){return _0x26e148;};return a277_0x2d9e();}exports['default']=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a277_0x35d6d6(0x73)][a277_0x35d6d6(0x6f)](path_2[a277_0x35d6d6(0x7f)],constants_1[a277_0x35d6d6(0x9a)]);