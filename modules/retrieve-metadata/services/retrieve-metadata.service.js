const a273_0xdc729e=a273_0x1ffb;function a273_0x6540(){const _0x570c75=['NotFoundError','data','(((.+)+)+)+$','Result\x20not\x20found.','RETRIEVE_RESULT_FOLDER_NAME','24228260jIvbjb','getJobStatus','parse','then','118884lPovFU','makeDir','../job/classes/manifest-manger','280889mvfEbX','utf-8','../../../constants/job','fs/promises','RETRIEVE_RESULTS_IDS_FILENAME','search','isExistsPath','init','toString','../../shared/utils/fs.utils','createRetrieveJob','IN_PROGRESS','FsUtils','3276285MWcrBy','setError','path','readFile','10938mLFdVk','@flosum/utils','../../../core/errors/not-found.error','15524154jxMKBX','generateJobId','getJobLogs','create','dataPath','Job\x20not\x20completed.','BadRequestError','join','push','retrieveMetadataFolder','../../shared/utils/csv.utils','../../../core/errors/bad-request.error','4WYcgQn','RETRIEVE_METADATA_FOLDER_NAME','Chunk\x20not\x20found.','runJob','sortJobsIds','apply','defineProperty','6146QTraiU','../job/classes/state-manger','.json','../../shared/utils/job.utils','__esModule','default','JOB_PATH','getJobState','8203712dRpBRJ','../job/enums/logger.enums','catch','slice','getJobs','JobStatus','4doZYSz','../constants','getResult'];a273_0x6540=function(){return _0x570c75;};return a273_0x6540();}(function(_0x47ad98,_0x6dfe77){const _0x30acfb=a273_0x1ffb,_0xfeb30a=_0x47ad98();while(!![]){try{const _0x3a5897=parseInt(_0x30acfb(0x177))/0x1+-parseInt(_0x30acfb(0x1ac))/0x2*(parseInt(_0x30acfb(0x1b8))/0x3)+parseInt(_0x30acfb(0x197))/0x4*(parseInt(_0x30acfb(0x184))/0x5)+parseInt(_0x30acfb(0x188))/0x6*(-parseInt(_0x30acfb(0x19e))/0x7)+parseInt(_0x30acfb(0x1a6))/0x8+-parseInt(_0x30acfb(0x18b))/0x9+parseInt(_0x30acfb(0x1b4))/0xa;if(_0x3a5897===_0x6dfe77)break;else _0xfeb30a['push'](_0xfeb30a['shift']());}catch(_0x47e325){_0xfeb30a['push'](_0xfeb30a['shift']());}}}(a273_0x6540,0xef2e0));const a273_0x3041b2=(function(){let _0x2089e8=!![];return function(_0x59e7e5,_0x2551b3){const _0x2a0985=_0x2089e8?function(){const _0x28699a=a273_0x1ffb;if(_0x2551b3){const _0x2b1ce9=_0x2551b3[_0x28699a(0x19c)](_0x59e7e5,arguments);return _0x2551b3=null,_0x2b1ce9;}}:function(){};return _0x2089e8=![],_0x2a0985;};}()),a273_0x2075b7=a273_0x3041b2(this,function(){const _0x48f200=a273_0x1ffb;return a273_0x2075b7[_0x48f200(0x17f)]()[_0x48f200(0x17c)](_0x48f200(0x1b1))[_0x48f200(0x17f)]()['constructor'](a273_0x2075b7)[_0x48f200(0x17c)](_0x48f200(0x1b1));});a273_0x2075b7();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3c6b38){return _0x3c6b38&&_0x3c6b38['__esModule']?_0x3c6b38:{'default':_0x3c6b38};};Object[a273_0xdc729e(0x19d)](exports,a273_0xdc729e(0x1a2),{'value':!![]});function a273_0x1ffb(_0x45b25c,_0x1753ea){const _0x4ae484=a273_0x6540();return a273_0x1ffb=function(_0x2075b7,_0x3041b2){_0x2075b7=_0x2075b7-0x176;let _0x6540c3=_0x4ae484[_0x2075b7];return _0x6540c3;},a273_0x1ffb(_0x45b25c,_0x1753ea);}const job_utils_1=__importDefault(require(a273_0xdc729e(0x1a1))),path_1=__importDefault(require(a273_0xdc729e(0x186))),manifest_manger_1=__importDefault(require(a273_0xdc729e(0x176))),state_manger_1=__importDefault(require(a273_0xdc729e(0x19f))),promises_1=require(a273_0xdc729e(0x17a)),utils_1=require(a273_0xdc729e(0x189)),csv_utils_1=__importDefault(require(a273_0xdc729e(0x195))),not_found_error_1=require(a273_0xdc729e(0x18a)),logger_enums_1=require(a273_0xdc729e(0x1a7)),bad_request_error_1=require(a273_0xdc729e(0x196)),job_1=require(a273_0xdc729e(0x179)),fs_utils_1=require(a273_0xdc729e(0x180)),constants_1=require(a273_0xdc729e(0x1ad)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a273_0xdc729e(0x1aa)](_0x572b24,_0x1c1111){const _0x36886d=a273_0xdc729e,_0x2acdd9=await job_utils_1[_0x36886d(0x1a3)]['getJobsIds'](RetrieveMetadataService[_0x36886d(0x194)]),_0x127554=await job_utils_1[_0x36886d(0x1a3)][_0x36886d(0x19b)](RetrieveMetadataService['retrieveMetadataFolder'],_0x2acdd9),_0x2e4405=_0x127554[_0x36886d(0x1a9)](_0x1c1111,_0x1c1111+_0x572b24),_0x2214ce=[];for(const _0xa6f70f of _0x2e4405){const _0xe4c54d=await state_manger_1[_0x36886d(0x1a3)]['getJobState'](path_1['default'][_0x36886d(0x192)](RetrieveMetadataService[_0x36886d(0x194)],_0xa6f70f));_0x2214ce[_0x36886d(0x193)](_0xe4c54d);}return _0x2214ce;}static async[a273_0xdc729e(0x181)](_0x312460){const _0x59e514=a273_0xdc729e,_0x282cc7=job_utils_1[_0x59e514(0x1a3)][_0x59e514(0x18c)](),_0x4066af=path_1[_0x59e514(0x1a3)]['join'](RetrieveMetadataService[_0x59e514(0x194)],_0x282cc7);await(0x0,fs_utils_1[_0x59e514(0x1b9)])(_0x4066af),await manifest_manger_1[_0x59e514(0x1a3)][_0x59e514(0x18e)](_0x4066af,_0x312460),await state_manger_1[_0x59e514(0x1a3)][_0x59e514(0x18e)](_0x4066af,_0x282cc7);const _0x4df3f0=path_1[_0x59e514(0x1a3)][_0x59e514(0x192)](__dirname,job_1[_0x59e514(0x1a4)]);return job_utils_1[_0x59e514(0x1a3)][_0x59e514(0x19a)](_0x4df3f0,{'jobStorePath':_0x4066af,'jobId':_0x282cc7})[_0x59e514(0x1a8)](async _0x271055=>{const _0x2f1864=_0x59e514,_0x72fff8=new state_manger_1[(_0x2f1864(0x1a3))](_0x4066af);await _0x72fff8[_0x2f1864(0x17e)](),await _0x72fff8[_0x2f1864(0x185)](_0x271055);}),{'jobId':_0x282cc7};}static async[a273_0xdc729e(0x1ae)](_0x388ac8){const _0x3218c0=a273_0xdc729e,{status:_0x6b5131}=await RetrieveMetadataService[_0x3218c0(0x1b5)](_0x388ac8);if(_0x6b5131===logger_enums_1[_0x3218c0(0x1ab)][_0x3218c0(0x182)])throw new bad_request_error_1['BadRequestError'](_0x3218c0(0x190));const _0x5341c9=path_1[_0x3218c0(0x1a3)][_0x3218c0(0x192)](RetrieveMetadataService[_0x3218c0(0x194)],_0x388ac8,constants_1[_0x3218c0(0x17b)]);if(await utils_1[_0x3218c0(0x183)]['isExistsPath'](_0x5341c9))return(0x0,promises_1['readFile'])(_0x5341c9,_0x3218c0(0x178))[_0x3218c0(0x1b7)](JSON[_0x3218c0(0x1b6)]);else throw new not_found_error_1[(_0x3218c0(0x1af))](_0x3218c0(0x1b2));}static async['getResultChunk'](_0x247fb4,_0x5b4430){const _0x172718=a273_0xdc729e,{status:_0x3b7bee}=await RetrieveMetadataService[_0x172718(0x1b5)](_0x247fb4);if(_0x3b7bee===logger_enums_1['JobStatus'][_0x172718(0x182)])throw new bad_request_error_1[(_0x172718(0x191))](_0x172718(0x190));const _0x44cf27=path_1[_0x172718(0x1a3)][_0x172718(0x192)](RetrieveMetadataService[_0x172718(0x194)],_0x247fb4,constants_1[_0x172718(0x1b3)]),_0x3baa7b={'data':[]};if(await utils_1[_0x172718(0x183)][_0x172718(0x17d)](path_1['default']['join'](_0x44cf27,_0x5b4430+_0x172718(0x1a0))))_0x3baa7b[_0x172718(0x1b0)]=await(0x0,promises_1[_0x172718(0x187)])(path_1[_0x172718(0x1a3)][_0x172718(0x192)](_0x44cf27,_0x5b4430+'.json'),'utf-8')[_0x172718(0x1b7)](JSON[_0x172718(0x1b6)]);else throw new not_found_error_1[(_0x172718(0x1af))](_0x172718(0x199));return _0x3baa7b;}static async[a273_0xdc729e(0x1b5)](_0x41b1d5){const _0x234bac=a273_0xdc729e;try{return await state_manger_1[_0x234bac(0x1a3)][_0x234bac(0x1a5)](path_1[_0x234bac(0x1a3)][_0x234bac(0x192)](RetrieveMetadataService[_0x234bac(0x194)],_0x41b1d5));}catch(_0x94e713){throw new not_found_error_1[(_0x234bac(0x1af))](_0x94e713);}}static async[a273_0xdc729e(0x18d)](_0xdda32d){const _0x298f70=a273_0xdc729e,_0xc766c0=path_1[_0x298f70(0x1a3)]['join'](RetrieveMetadataService[_0x298f70(0x194)],_0xdda32d,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1[_0x298f70(0x183)][_0x298f70(0x17d)](_0xc766c0))return(0x0,promises_1[_0x298f70(0x187)])(_0xc766c0,'utf-8')[_0x298f70(0x1b7)](_0x3475f9=>csv_utils_1['default']['parse'](_0x3475f9,{'columns':!![]}));throw new not_found_error_1[(_0x298f70(0x1af))]('Job\x20log\x20not\x20found.');}}exports[a273_0xdc729e(0x1a3)]=RetrieveMetadataService,RetrieveMetadataService[a273_0xdc729e(0x194)]=path_1['default']['join'](path_2[a273_0xdc729e(0x18f)],constants_1[a273_0xdc729e(0x198)]);