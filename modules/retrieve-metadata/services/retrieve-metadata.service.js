const a309_0x26f91d=a309_0x3064;(function(_0x3cd03e,_0x93498b){const _0x3ed7be=a309_0x3064,_0x12d7b3=_0x3cd03e();while(!![]){try{const _0x462eba=parseInt(_0x3ed7be(0xe1))/0x1*(-parseInt(_0x3ed7be(0xf0))/0x2)+parseInt(_0x3ed7be(0xcd))/0x3*(parseInt(_0x3ed7be(0xec))/0x4)+parseInt(_0x3ed7be(0xe0))/0x5+-parseInt(_0x3ed7be(0xf6))/0x6+-parseInt(_0x3ed7be(0xf8))/0x7*(parseInt(_0x3ed7be(0xe9))/0x8)+-parseInt(_0x3ed7be(0xfe))/0x9+-parseInt(_0x3ed7be(0xfc))/0xa*(-parseInt(_0x3ed7be(0xde))/0xb);if(_0x462eba===_0x93498b)break;else _0x12d7b3['push'](_0x12d7b3['shift']());}catch(_0x30db31){_0x12d7b3['push'](_0x12d7b3['shift']());}}}(a309_0x2ead,0x96a7b));const a309_0x651fe9=(function(){let _0x224b35=!![];return function(_0x271efe,_0x5e1a4d){const _0x53bd64=_0x224b35?function(){const _0x12d091=a309_0x3064;if(_0x5e1a4d){const _0x38aa31=_0x5e1a4d[_0x12d091(0xc9)](_0x271efe,arguments);return _0x5e1a4d=null,_0x38aa31;}}:function(){};return _0x224b35=![],_0x53bd64;};}()),a309_0x3794a1=a309_0x651fe9(this,function(){const _0x1413e2=a309_0x3064;return a309_0x3794a1['toString']()[_0x1413e2(0xf7)](_0x1413e2(0xdf))[_0x1413e2(0xe6)]()['constructor'](a309_0x3794a1)[_0x1413e2(0xf7)](_0x1413e2(0xdf));});a309_0x3794a1();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4aee82){const _0xe91526=a309_0x3064;return _0x4aee82&&_0x4aee82[_0xe91526(0xd0)]?_0x4aee82:{'default':_0x4aee82};};function a309_0x3064(_0x4ef4e4,_0x4d4fc5){const _0x2c6b63=a309_0x2ead();return a309_0x3064=function(_0x3794a1,_0x651fe9){_0x3794a1=_0x3794a1-0xc6;let _0x2ead9b=_0x2c6b63[_0x3794a1];return _0x2ead9b;},a309_0x3064(_0x4ef4e4,_0x4d4fc5);}Object['defineProperty'](exports,a309_0x26f91d(0xd0),{'value':!![]});const job_utils_1=__importDefault(require(a309_0x26f91d(0xe4))),path_1=__importDefault(require(a309_0x26f91d(0xd2))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require(a309_0x26f91d(0xed)),utils_1=require(a309_0x26f91d(0xf2)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a309_0x26f91d(0xe3)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require(a309_0x26f91d(0xf5)),job_1=require('../../../constants/job'),fs_utils_1=require(a309_0x26f91d(0xdc)),constants_1=require(a309_0x26f91d(0xcf)),path_2=require(a309_0x26f91d(0xd9));class RetrieveMetadataService{static async[a309_0x26f91d(0xc8)](_0xe0389d,_0x2b95b1){const _0x44f442=a309_0x26f91d,_0x41593c=await job_utils_1['default'][_0x44f442(0xe2)](RetrieveMetadataService[_0x44f442(0xc7)]),_0x2bca05=await job_utils_1[_0x44f442(0xea)][_0x44f442(0xf3)](RetrieveMetadataService[_0x44f442(0xc7)],_0x41593c),_0x730ff2=_0x2bca05[_0x44f442(0xd7)](_0x2b95b1,_0x2b95b1+_0xe0389d),_0x3fbc8f=[];for(const _0x1eefe7 of _0x730ff2){const _0xbcc262=await state_manger_1[_0x44f442(0xea)][_0x44f442(0xff)](path_1['default']['join'](RetrieveMetadataService[_0x44f442(0xc7)],_0x1eefe7));_0x3fbc8f[_0x44f442(0x100)](_0xbcc262);}return _0x3fbc8f;}static async[a309_0x26f91d(0xfa)](_0x269398){const _0x58f335=a309_0x26f91d,_0x8e1774=job_utils_1['default'][_0x58f335(0xe7)](),_0x421fd2=path_1[_0x58f335(0xea)][_0x58f335(0xdd)](RetrieveMetadataService['retrieveMetadataFolder'],_0x8e1774);await(0x0,fs_utils_1['makeDir'])(_0x421fd2),await manifest_manger_1[_0x58f335(0xea)][_0x58f335(0xf4)](_0x421fd2,_0x269398),await state_manger_1[_0x58f335(0xea)][_0x58f335(0xf4)](_0x421fd2,_0x8e1774);const _0x77fea2=path_1[_0x58f335(0xea)][_0x58f335(0xdd)](__dirname,job_1[_0x58f335(0xe5)]);return job_utils_1[_0x58f335(0xea)][_0x58f335(0xfb)](_0x77fea2,{'jobStorePath':_0x421fd2,'jobId':_0x8e1774})['catch'](async _0x55d837=>{const _0x3e0137=_0x58f335,_0x1c01f6=new state_manger_1[(_0x3e0137(0xea))](_0x421fd2);await _0x1c01f6[_0x3e0137(0xef)](),await _0x1c01f6['setError'](_0x55d837);}),{'jobId':_0x8e1774};}static async[a309_0x26f91d(0xcb)](_0x4c8821){const _0x2fff95=a309_0x26f91d,{status:_0x3a4503}=await RetrieveMetadataService[_0x2fff95(0xc6)](_0x4c8821);if(_0x3a4503===logger_enums_1[_0x2fff95(0xf9)][_0x2fff95(0xd8)])throw new bad_request_error_1['BadRequestError']('Job\x20not\x20completed.');const _0x59ddeb=path_1[_0x2fff95(0xea)][_0x2fff95(0xdd)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4c8821,constants_1[_0x2fff95(0xf1)]);if(await utils_1[_0x2fff95(0xda)][_0x2fff95(0xca)](_0x59ddeb))return(0x0,promises_1['readFile'])(_0x59ddeb,'utf-8')['then'](JSON[_0x2fff95(0xfd)]);else throw new not_found_error_1[(_0x2fff95(0xd4))](_0x2fff95(0xdb));}static async['getResultChunk'](_0x5278be,_0x5b7830){const _0x316c64=a309_0x26f91d,{status:_0x5612eb}=await RetrieveMetadataService['getJobStatus'](_0x5278be);if(_0x5612eb===logger_enums_1[_0x316c64(0xf9)]['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError']('Job\x20not\x20completed.');const _0x1ac8c3=path_1[_0x316c64(0xea)][_0x316c64(0xdd)](RetrieveMetadataService[_0x316c64(0xc7)],_0x5278be,constants_1[_0x316c64(0x101)]),_0x1b8b55={'data':[]};if(await utils_1[_0x316c64(0xda)][_0x316c64(0xca)](path_1[_0x316c64(0xea)][_0x316c64(0xdd)](_0x1ac8c3,_0x5b7830+'.json')))_0x1b8b55['data']=await(0x0,promises_1[_0x316c64(0xd6)])(path_1[_0x316c64(0xea)][_0x316c64(0xdd)](_0x1ac8c3,_0x5b7830+_0x316c64(0xcc)),_0x316c64(0xeb))[_0x316c64(0xe8)](JSON[_0x316c64(0xfd)]);else throw new not_found_error_1[(_0x316c64(0xd4))](_0x316c64(0xd1));return _0x1b8b55;}static async[a309_0x26f91d(0xc6)](_0x27cb99){const _0xd970e1=a309_0x26f91d;try{return await state_manger_1[_0xd970e1(0xea)][_0xd970e1(0xff)](path_1['default'][_0xd970e1(0xdd)](RetrieveMetadataService['retrieveMetadataFolder'],_0x27cb99));}catch(_0x56f5da){throw new not_found_error_1[(_0xd970e1(0xd4))](_0x56f5da);}}static async[a309_0x26f91d(0xee)](_0x53d53a){const _0x1e4387=a309_0x26f91d,_0x29d067=path_1[_0x1e4387(0xea)][_0x1e4387(0xdd)](RetrieveMetadataService['retrieveMetadataFolder'],_0x53d53a,job_1[_0x1e4387(0xce)]);if(await utils_1['FsUtils'][_0x1e4387(0xca)](_0x29d067))return(0x0,promises_1[_0x1e4387(0xd6)])(_0x29d067,_0x1e4387(0xeb))[_0x1e4387(0xe8)](_0x1b7330=>csv_utils_1['default'][_0x1e4387(0xfd)](_0x1b7330,{'columns':!![]}));throw new not_found_error_1[(_0x1e4387(0xd4))](_0x1e4387(0xd5));}}function a309_0x2ead(){const _0x552447=['retrieveMetadataFolder','getJobs','apply','isExistsPath','getResult','.json','3461517AyElwV','JOB_LOG_DETAILS_FILENAME','../constants','__esModule','Chunk\x20not\x20found.','path','dataPath','NotFoundError','Job\x20log\x20not\x20found.','readFile','slice','IN_PROGRESS','../../../configs/path','FsUtils','Result\x20not\x20found.','../../shared/utils/fs.utils','join','394141rRXPmm','(((.+)+)+)+$','451530LpZITa','116719jjUIUM','getJobsIds','../../../core/errors/not-found.error','../../shared/utils/job.utils','JOB_PATH','toString','generateJobId','then','8tSBAyC','default','utf-8','4zdYIpc','fs/promises','getJobLogs','init','14GomfGh','RETRIEVE_RESULTS_IDS_FILENAME','@flosum/utils','sortJobsIds','create','../../../core/errors/bad-request.error','3162522vlyeOQ','search','6352157YOzFkv','JobStatus','createRetrieveJob','runJob','550FCQHax','parse','3115764qfDCCo','getJobState','push','RETRIEVE_RESULT_FOLDER_NAME','getJobStatus'];a309_0x2ead=function(){return _0x552447;};return a309_0x2ead();}exports[a309_0x26f91d(0xea)]=RetrieveMetadataService,RetrieveMetadataService[a309_0x26f91d(0xc7)]=path_1['default'][a309_0x26f91d(0xdd)](path_2[a309_0x26f91d(0xd3)],constants_1['RETRIEVE_METADATA_FOLDER_NAME']);