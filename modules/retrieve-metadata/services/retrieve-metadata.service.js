const a273_0x1e4d5a=a273_0x42ab;function a273_0x327f(){const _0x16489a=['Job\x20log\x20not\x20found.','create','setError','NotFoundError','then','__importDefault','utf-8','parse','../constants','RETRIEVE_METADATA_FOLDER_NAME','5309802xzbzgH','FsUtils','createRetrieveJob','@flosum/utils','constructor','(((.+)+)+)+$','../../shared/utils/fs.utils','136FFfttd','Chunk\x20not\x20found.','Job\x20not\x20completed.','isExistsPath','getJobState','../../../core/errors/bad-request.error','JOB_PATH','../../../constants/job','data','IN_PROGRESS','getJobsIds','RETRIEVE_RESULT_FOLDER_NAME','../../../core/errors/not-found.error','catch','makeDir','BadRequestError','135hDxSjc','__esModule','1609722sWpfTa','toString','82928LNavUy','readFile','apply','../../../configs/path','433468WIGKPd','retrieveMetadataFolder','1250088xStPGY','push','JOB_LOG_DETAILS_FILENAME','default','5176182XbdSBG','init','../job/enums/logger.enums','JobStatus','generateJobId','join','395339AkRnpM','.json','getJobs','path','getJobStatus','sortJobsIds','dataPath','search'];a273_0x327f=function(){return _0x16489a;};return a273_0x327f();}(function(_0x45478c,_0x45b67e){const _0x54d44b=a273_0x42ab,_0x591aae=_0x45478c();while(!![]){try{const _0x52c198=parseInt(_0x54d44b(0x12e))/0x1+-parseInt(_0x54d44b(0x124))/0x2+-parseInt(_0x54d44b(0x11c))/0x3+parseInt(_0x54d44b(0x11e))/0x4*(parseInt(_0x54d44b(0x11a))/0x5)+-parseInt(_0x54d44b(0x128))/0x6+parseInt(_0x54d44b(0x122))/0x7*(parseInt(_0x54d44b(0x10a))/0x8)+parseInt(_0x54d44b(0x103))/0x9;if(_0x52c198===_0x45b67e)break;else _0x591aae['push'](_0x591aae['shift']());}catch(_0x499061){_0x591aae['push'](_0x591aae['shift']());}}}(a273_0x327f,0x8c022));const a273_0xb61c4b=(function(){let _0x1889df=!![];return function(_0x6e82c3,_0x32c142){const _0x41274b=_0x1889df?function(){const _0x103ea3=a273_0x42ab;if(_0x32c142){const _0x484e80=_0x32c142[_0x103ea3(0x120)](_0x6e82c3,arguments);return _0x32c142=null,_0x484e80;}}:function(){};return _0x1889df=![],_0x41274b;};}()),a273_0x53c0c8=a273_0xb61c4b(this,function(){const _0x8e3172=a273_0x42ab;return a273_0x53c0c8[_0x8e3172(0x11d)]()[_0x8e3172(0xf8)](_0x8e3172(0x108))[_0x8e3172(0x11d)]()[_0x8e3172(0x107)](a273_0x53c0c8)[_0x8e3172(0xf8)](_0x8e3172(0x108));});a273_0x53c0c8();function a273_0x42ab(_0x1616d2,_0x114169){const _0x4ced9e=a273_0x327f();return a273_0x42ab=function(_0x53c0c8,_0xb61c4b){_0x53c0c8=_0x53c0c8-0xf5;let _0x327f51=_0x4ced9e[_0x53c0c8];return _0x327f51;},a273_0x42ab(_0x1616d2,_0x114169);}'use strict';var __importDefault=this&&this[a273_0x1e4d5a(0xfe)]||function(_0x121753){const _0xf1f4a8=a273_0x1e4d5a;return _0x121753&&_0x121753[_0xf1f4a8(0x11b)]?_0x121753:{'default':_0x121753};};Object['defineProperty'](exports,a273_0x1e4d5a(0x11b),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a273_0x1e4d5a(0x131))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require('../job/classes/state-manger')),promises_1=require('fs/promises'),utils_1=require(a273_0x1e4d5a(0x106)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a273_0x1e4d5a(0x116)),logger_enums_1=require(a273_0x1e4d5a(0x12a)),bad_request_error_1=require(a273_0x1e4d5a(0x10f)),job_1=require(a273_0x1e4d5a(0x111)),fs_utils_1=require(a273_0x1e4d5a(0x109)),constants_1=require(a273_0x1e4d5a(0x101)),path_2=require(a273_0x1e4d5a(0x121));class RetrieveMetadataService{static async[a273_0x1e4d5a(0x130)](_0xe90012,_0x567eeb){const _0x5622e3=a273_0x1e4d5a,_0xf74b50=await job_utils_1[_0x5622e3(0x127)][_0x5622e3(0x114)](RetrieveMetadataService[_0x5622e3(0x123)]),_0x1cf1ea=await job_utils_1[_0x5622e3(0x127)][_0x5622e3(0xf6)](RetrieveMetadataService[_0x5622e3(0x123)],_0xf74b50),_0x5de483=_0x1cf1ea['slice'](_0x567eeb,_0x567eeb+_0xe90012),_0x3e402f=[];for(const _0x26cd39 of _0x5de483){const _0x585ba2=await state_manger_1['default'][_0x5622e3(0x10e)](path_1[_0x5622e3(0x127)][_0x5622e3(0x12d)](RetrieveMetadataService[_0x5622e3(0x123)],_0x26cd39));_0x3e402f[_0x5622e3(0x125)](_0x585ba2);}return _0x3e402f;}static async[a273_0x1e4d5a(0x105)](_0x566f8e){const _0x1a5d75=a273_0x1e4d5a,_0x208be9=job_utils_1['default'][_0x1a5d75(0x12c)](),_0x31a410=path_1['default']['join'](RetrieveMetadataService[_0x1a5d75(0x123)],_0x208be9);await(0x0,fs_utils_1[_0x1a5d75(0x118)])(_0x31a410),await manifest_manger_1[_0x1a5d75(0x127)][_0x1a5d75(0xfa)](_0x31a410,_0x566f8e),await state_manger_1['default']['create'](_0x31a410,_0x208be9);const _0x5af1dc=path_1[_0x1a5d75(0x127)]['join'](__dirname,job_1[_0x1a5d75(0x110)]);return job_utils_1['default']['runJob'](_0x5af1dc,{'jobStorePath':_0x31a410,'jobId':_0x208be9})[_0x1a5d75(0x117)](async _0x37470a=>{const _0x50e4a9=_0x1a5d75,_0x496eb3=new state_manger_1[(_0x50e4a9(0x127))](_0x31a410);await _0x496eb3[_0x50e4a9(0x129)](),await _0x496eb3[_0x50e4a9(0xfb)](_0x37470a);}),{'jobId':_0x208be9};}static async['getResult'](_0x3095f2){const _0x167ea2=a273_0x1e4d5a,{status:_0x395093}=await RetrieveMetadataService[_0x167ea2(0xf5)](_0x3095f2);if(_0x395093===logger_enums_1[_0x167ea2(0x12b)][_0x167ea2(0x113)])throw new bad_request_error_1[(_0x167ea2(0x119))]('Job\x20not\x20completed.');const _0x23a00a=path_1[_0x167ea2(0x127)]['join'](RetrieveMetadataService[_0x167ea2(0x123)],_0x3095f2,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1['FsUtils'][_0x167ea2(0x10d)](_0x23a00a))return(0x0,promises_1[_0x167ea2(0x11f)])(_0x23a00a,_0x167ea2(0xff))[_0x167ea2(0xfd)](JSON[_0x167ea2(0x100)]);else throw new not_found_error_1['NotFoundError']('Result\x20not\x20found.');}static async['getResultChunk'](_0x56dd55,_0x287f62){const _0x5d59cc=a273_0x1e4d5a,{status:_0x259590}=await RetrieveMetadataService[_0x5d59cc(0xf5)](_0x56dd55);if(_0x259590===logger_enums_1['JobStatus'][_0x5d59cc(0x113)])throw new bad_request_error_1[(_0x5d59cc(0x119))](_0x5d59cc(0x10c));const _0x4eed9f=path_1[_0x5d59cc(0x127)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x56dd55,constants_1[_0x5d59cc(0x115)]),_0x8e83f3={'data':[]};if(await utils_1[_0x5d59cc(0x104)][_0x5d59cc(0x10d)](path_1[_0x5d59cc(0x127)][_0x5d59cc(0x12d)](_0x4eed9f,_0x287f62+_0x5d59cc(0x12f))))_0x8e83f3[_0x5d59cc(0x112)]=await(0x0,promises_1[_0x5d59cc(0x11f)])(path_1[_0x5d59cc(0x127)][_0x5d59cc(0x12d)](_0x4eed9f,_0x287f62+'.json'),_0x5d59cc(0xff))['then'](JSON['parse']);else throw new not_found_error_1[(_0x5d59cc(0xfc))](_0x5d59cc(0x10b));return _0x8e83f3;}static async[a273_0x1e4d5a(0xf5)](_0x50ba67){const _0x2c8b00=a273_0x1e4d5a;try{return await state_manger_1[_0x2c8b00(0x127)][_0x2c8b00(0x10e)](path_1[_0x2c8b00(0x127)][_0x2c8b00(0x12d)](RetrieveMetadataService[_0x2c8b00(0x123)],_0x50ba67));}catch(_0x209d27){throw new not_found_error_1['NotFoundError'](_0x209d27);}}static async['getJobLogs'](_0x1ba2be){const _0x2b6287=a273_0x1e4d5a,_0xd3b071=path_1['default'][_0x2b6287(0x12d)](RetrieveMetadataService[_0x2b6287(0x123)],_0x1ba2be,job_1[_0x2b6287(0x126)]);if(await utils_1[_0x2b6287(0x104)][_0x2b6287(0x10d)](_0xd3b071))return(0x0,promises_1[_0x2b6287(0x11f)])(_0xd3b071,_0x2b6287(0xff))[_0x2b6287(0xfd)](_0x4361a5=>csv_utils_1['default'][_0x2b6287(0x100)](_0x4361a5,{'columns':!![]}));throw new not_found_error_1[(_0x2b6287(0xfc))](_0x2b6287(0xf9));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a273_0x1e4d5a(0x127)][a273_0x1e4d5a(0x12d)](path_2[a273_0x1e4d5a(0xf7)],constants_1[a273_0x1e4d5a(0x102)]);