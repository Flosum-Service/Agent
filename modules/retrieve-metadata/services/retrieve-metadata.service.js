const a320_0x29a239=a320_0x3ee1;function a320_0x3ee1(_0x2a9e73,_0xb73b14){const _0x11c371=a320_0x105b();return a320_0x3ee1=function(_0x37bfd2,_0x5c7ae3){_0x37bfd2=_0x37bfd2-0x1df;let _0x105be5=_0x11c371[_0x37bfd2];return _0x105be5;},a320_0x3ee1(_0x2a9e73,_0xb73b14);}(function(_0x42971e,_0x16e013){const _0x240df3=a320_0x3ee1,_0x103a30=_0x42971e();while(!![]){try{const _0xd85aae=-parseInt(_0x240df3(0x200))/0x1+-parseInt(_0x240df3(0x1df))/0x2*(-parseInt(_0x240df3(0x1fe))/0x3)+parseInt(_0x240df3(0x213))/0x4+-parseInt(_0x240df3(0x204))/0x5*(parseInt(_0x240df3(0x1f1))/0x6)+-parseInt(_0x240df3(0x1f2))/0x7+parseInt(_0x240df3(0x20e))/0x8*(parseInt(_0x240df3(0x209))/0x9)+-parseInt(_0x240df3(0x1f5))/0xa*(-parseInt(_0x240df3(0x1ed))/0xb);if(_0xd85aae===_0x16e013)break;else _0x103a30['push'](_0x103a30['shift']());}catch(_0x54ccb0){_0x103a30['push'](_0x103a30['shift']());}}}(a320_0x105b,0x7a877));function a320_0x105b(){const _0x195159=['../../shared/utils/job.utils','join','1990265hvVqyO','search','getJobs','retrieveMetadataFolder','JOB_LOG_DETAILS_FILENAME','621BWDvTG','getResult','dataPath','JobStatus','getJobState','103528PzukZB','getJobsIds','readFile','apply','../../shared/utils/fs.utils','3192200xxfMPv','JOB_PATH','utf-8','RETRIEVE_RESULTS_IDS_FILENAME','data','Job\x20log\x20not\x20found.','../../shared/managers/state-manger','then','getJobStatus','../../../core/errors/not-found.error','1733846CyTFtM','sortJobsIds','isExistsPath','setError','../job/classes/manifest-manger','NotFoundError','default','fs/promises','getJobLogs','createRetrieveJob','create','catch','RETRIEVE_METADATA_FOLDER_NAME','../../shared/enums/logger.enums','594891phcoLP','../../../core/errors/bad-request.error','getResultChunk','toString','12OppaJP','6299307VvXoqC','RETRIEVE_RESULT_FOLDER_NAME','.json','10cFGXzv','makeDir','../../../configs/path','path','(((.+)+)+)+$','Job\x20not\x20completed.','FsUtils','../../shared/utils/csv.utils','push','3pLcJup','__importDefault','414097UyNLxx','parse'];a320_0x105b=function(){return _0x195159;};return a320_0x105b();}const a320_0x5c7ae3=(function(){let _0x74c519=!![];return function(_0x3a8652,_0x11e281){const _0xad5471=_0x74c519?function(){const _0x7c698e=a320_0x3ee1;if(_0x11e281){const _0x1fcc53=_0x11e281[_0x7c698e(0x211)](_0x3a8652,arguments);return _0x11e281=null,_0x1fcc53;}}:function(){};return _0x74c519=![],_0xad5471;};}()),a320_0x37bfd2=a320_0x5c7ae3(this,function(){const _0x3ecfac=a320_0x3ee1;return a320_0x37bfd2[_0x3ecfac(0x1f0)]()[_0x3ecfac(0x205)](_0x3ecfac(0x1f9))[_0x3ecfac(0x1f0)]()['constructor'](a320_0x37bfd2)[_0x3ecfac(0x205)]('(((.+)+)+)+$');});a320_0x37bfd2();'use strict';var __importDefault=this&&this[a320_0x29a239(0x1ff)]||function(_0x175a1d){return _0x175a1d&&_0x175a1d['__esModule']?_0x175a1d:{'default':_0x175a1d};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a320_0x29a239(0x202))),path_1=__importDefault(require(a320_0x29a239(0x1f8))),manifest_manger_1=__importDefault(require(a320_0x29a239(0x1e3))),state_manger_1=__importDefault(require(a320_0x29a239(0x219))),promises_1=require(a320_0x29a239(0x1e6)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a320_0x29a239(0x1fc))),not_found_error_1=require(a320_0x29a239(0x21c)),logger_enums_1=require(a320_0x29a239(0x1ec)),bad_request_error_1=require(a320_0x29a239(0x1ee)),job_1=require('../../../constants/job'),fs_utils_1=require(a320_0x29a239(0x212)),constants_1=require('../constants'),path_2=require(a320_0x29a239(0x1f7));class RetrieveMetadataService{static async[a320_0x29a239(0x206)](_0x3d033f,_0x50c6da){const _0x43add5=a320_0x29a239,_0x2609b7=await job_utils_1[_0x43add5(0x1e5)][_0x43add5(0x20f)](RetrieveMetadataService[_0x43add5(0x207)]),_0x4b67b7=await job_utils_1[_0x43add5(0x1e5)][_0x43add5(0x1e0)](RetrieveMetadataService[_0x43add5(0x207)],_0x2609b7),_0x49a465=_0x4b67b7['slice'](_0x50c6da,_0x50c6da+_0x3d033f),_0x677e80=[];for(const _0x25f7ec of _0x49a465){const _0x19cc89=await state_manger_1[_0x43add5(0x1e5)][_0x43add5(0x20d)](path_1['default']['join'](RetrieveMetadataService[_0x43add5(0x207)],_0x25f7ec));_0x677e80[_0x43add5(0x1fd)](_0x19cc89);}return _0x677e80;}static async[a320_0x29a239(0x1e8)](_0x422a82){const _0x2e1661=a320_0x29a239,_0x4e939a=job_utils_1['default']['generateJobId'](),_0x26ace1=path_1[_0x2e1661(0x1e5)][_0x2e1661(0x203)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4e939a);await(0x0,fs_utils_1[_0x2e1661(0x1f6)])(_0x26ace1),await manifest_manger_1['default']['create'](_0x26ace1,_0x422a82),await state_manger_1[_0x2e1661(0x1e5)][_0x2e1661(0x1e9)](_0x26ace1,_0x4e939a);const _0x58c91a=path_1[_0x2e1661(0x1e5)][_0x2e1661(0x203)](__dirname,job_1[_0x2e1661(0x214)]);return job_utils_1[_0x2e1661(0x1e5)]['runJob'](_0x58c91a,{'jobStorePath':_0x26ace1,'jobId':_0x4e939a})[_0x2e1661(0x1ea)](async _0x4cfe09=>{const _0x2e4af6=_0x2e1661,_0x3b73a9=new state_manger_1[(_0x2e4af6(0x1e5))](_0x26ace1);await _0x3b73a9['init'](),await _0x3b73a9[_0x2e4af6(0x1e2)](_0x4cfe09);}),{'jobId':_0x4e939a};}static async[a320_0x29a239(0x20a)](_0x3bc482){const _0xbfd162=a320_0x29a239,{status:_0x55d291}=await RetrieveMetadataService[_0xbfd162(0x21b)](_0x3bc482);if(_0x55d291===logger_enums_1['JobStatus']['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError'](_0xbfd162(0x1fa));const _0x5b1178=path_1[_0xbfd162(0x1e5)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x3bc482,constants_1[_0xbfd162(0x216)]);if(await utils_1[_0xbfd162(0x1fb)]['isExistsPath'](_0x5b1178))return(0x0,promises_1[_0xbfd162(0x210)])(_0x5b1178,_0xbfd162(0x215))['then'](JSON[_0xbfd162(0x201)]);else throw new not_found_error_1[(_0xbfd162(0x1e4))]('Result\x20not\x20found.');}static async[a320_0x29a239(0x1ef)](_0x39f066,_0xf0127f){const _0x4e9d74=a320_0x29a239,{status:_0x49f54f}=await RetrieveMetadataService[_0x4e9d74(0x21b)](_0x39f066);if(_0x49f54f===logger_enums_1[_0x4e9d74(0x20c)]['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError'](_0x4e9d74(0x1fa));const _0x432fb6=path_1[_0x4e9d74(0x1e5)][_0x4e9d74(0x203)](RetrieveMetadataService[_0x4e9d74(0x207)],_0x39f066,constants_1[_0x4e9d74(0x1f3)]),_0x444b4a={'data':[]};if(await utils_1['FsUtils'][_0x4e9d74(0x1e1)](path_1[_0x4e9d74(0x1e5)][_0x4e9d74(0x203)](_0x432fb6,_0xf0127f+'.json')))_0x444b4a[_0x4e9d74(0x217)]=await(0x0,promises_1[_0x4e9d74(0x210)])(path_1['default'][_0x4e9d74(0x203)](_0x432fb6,_0xf0127f+_0x4e9d74(0x1f4)),_0x4e9d74(0x215))[_0x4e9d74(0x21a)](JSON[_0x4e9d74(0x201)]);else throw new not_found_error_1[(_0x4e9d74(0x1e4))]('Chunk\x20not\x20found.');return _0x444b4a;}static async[a320_0x29a239(0x21b)](_0x1ae036){const _0x59c2b2=a320_0x29a239;try{return await state_manger_1[_0x59c2b2(0x1e5)]['getJobState'](path_1[_0x59c2b2(0x1e5)][_0x59c2b2(0x203)](RetrieveMetadataService[_0x59c2b2(0x207)],_0x1ae036));}catch(_0x3f00bc){throw new not_found_error_1['NotFoundError'](_0x3f00bc);}}static async[a320_0x29a239(0x1e7)](_0x7037b5){const _0x5915ac=a320_0x29a239,_0x15682b=path_1[_0x5915ac(0x1e5)]['join'](RetrieveMetadataService[_0x5915ac(0x207)],_0x7037b5,job_1[_0x5915ac(0x208)]);if(await utils_1[_0x5915ac(0x1fb)]['isExistsPath'](_0x15682b))return(0x0,promises_1[_0x5915ac(0x210)])(_0x15682b,_0x5915ac(0x215))[_0x5915ac(0x21a)](_0x28e71d=>csv_utils_1['default']['parse'](_0x28e71d,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x5915ac(0x218));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService[a320_0x29a239(0x207)]=path_1[a320_0x29a239(0x1e5)][a320_0x29a239(0x203)](path_2[a320_0x29a239(0x20b)],constants_1[a320_0x29a239(0x1eb)]);