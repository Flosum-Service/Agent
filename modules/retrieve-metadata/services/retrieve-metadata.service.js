const a272_0x53f4ae=a272_0x1b5c;function a272_0x1b5c(_0x519698,_0x27208d){const _0x16b9c7=a272_0x42ea();return a272_0x1b5c=function(_0x362b42,_0x2ca105){_0x362b42=_0x362b42-0x18f;let _0x42eaab=_0x16b9c7[_0x362b42];return _0x42eaab;},a272_0x1b5c(_0x519698,_0x27208d);}function a272_0x42ea(){const _0x58b951=['FsUtils','5nzVAot','../../shared/enums/logger.enums','makeDir','getJobStatus','../../../constants/job','join','IN_PROGRESS','generateJobId','getResult','readFile','__esModule','.json','RETRIEVE_METADATA_FOLDER_NAME','sortJobsIds','JobStatus','NotFoundError','27278210SrYUNH','getJobState','constructor','then','parse','@flosum/utils','2401904oUjKum','1178874BdblwR','toString','slice','4lmBSbj','Job\x20not\x20completed.','404162VTOeBw','../../../configs/path','3465402SbdVnL','getJobsIds','createRetrieveJob','BadRequestError','../../shared/managers/state-manger','10153485rWSqhN','../../shared/utils/fs.utils','setError','JOB_PATH','4382AftjLM','utf-8','catch','Chunk\x20not\x20found.','path','default','24NAnEJP','RETRIEVE_RESULT_FOLDER_NAME','getJobLogs','../constants','RETRIEVE_RESULTS_IDS_FILENAME','fs/promises','retrieveMetadataFolder','apply','dataPath','../../shared/utils/job.utils','init','isExistsPath','search','Result\x20not\x20found.','JOB_LOG_DETAILS_FILENAME','../../shared/utils/csv.utils','../../../core/errors/not-found.error','push','Job\x20log\x20not\x20found.','runJob'];a272_0x42ea=function(){return _0x58b951;};return a272_0x42ea();}(function(_0x47ae3a,_0x3e3bc2){const _0x50b93e=a272_0x1b5c,_0x49ec14=_0x47ae3a();while(!![]){try{const _0x43217d=-parseInt(_0x50b93e(0x1c0))/0x1+-parseInt(_0x50b93e(0x1ba))/0x2+-parseInt(_0x50b93e(0x1c2))/0x3*(-parseInt(_0x50b93e(0x1be))/0x4)+-parseInt(_0x50b93e(0x1a4))/0x5*(parseInt(_0x50b93e(0x1bb))/0x6)+parseInt(_0x50b93e(0x1cb))/0x7*(-parseInt(_0x50b93e(0x18f))/0x8)+-parseInt(_0x50b93e(0x1c7))/0x9+parseInt(_0x50b93e(0x1b4))/0xa;if(_0x43217d===_0x3e3bc2)break;else _0x49ec14['push'](_0x49ec14['shift']());}catch(_0x4769ee){_0x49ec14['push'](_0x49ec14['shift']());}}}(a272_0x42ea,0xe8417));const a272_0x2ca105=(function(){let _0x1e459d=!![];return function(_0x199d62,_0x1643f0){const _0x501b2a=_0x1e459d?function(){const _0x52cb33=a272_0x1b5c;if(_0x1643f0){const _0x3d8355=_0x1643f0[_0x52cb33(0x196)](_0x199d62,arguments);return _0x1643f0=null,_0x3d8355;}}:function(){};return _0x1e459d=![],_0x501b2a;};}()),a272_0x362b42=a272_0x2ca105(this,function(){const _0xc975d8=a272_0x1b5c;return a272_0x362b42[_0xc975d8(0x1bc)]()[_0xc975d8(0x19b)]('(((.+)+)+)+$')['toString']()[_0xc975d8(0x1b6)](a272_0x362b42)[_0xc975d8(0x19b)]('(((.+)+)+)+$');});a272_0x362b42();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3e041c){const _0x5ed763=a272_0x1b5c;return _0x3e041c&&_0x3e041c[_0x5ed763(0x1ae)]?_0x3e041c:{'default':_0x3e041c};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a272_0x53f4ae(0x198))),path_1=__importDefault(require(a272_0x53f4ae(0x1cf))),manifest_manger_1=__importDefault(require('../job/classes/manifest-manger')),state_manger_1=__importDefault(require(a272_0x53f4ae(0x1c6))),promises_1=require(a272_0x53f4ae(0x194)),utils_1=require(a272_0x53f4ae(0x1b9)),csv_utils_1=__importDefault(require(a272_0x53f4ae(0x19e))),not_found_error_1=require(a272_0x53f4ae(0x19f)),logger_enums_1=require(a272_0x53f4ae(0x1a5)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require(a272_0x53f4ae(0x1a8)),fs_utils_1=require(a272_0x53f4ae(0x1c8)),constants_1=require(a272_0x53f4ae(0x192)),path_2=require(a272_0x53f4ae(0x1c1));class RetrieveMetadataService{static async['getJobs'](_0x155c10,_0x36f6e5){const _0x4758a2=a272_0x53f4ae,_0x39fd84=await job_utils_1['default'][_0x4758a2(0x1c3)](RetrieveMetadataService[_0x4758a2(0x195)]),_0x40ed7b=await job_utils_1[_0x4758a2(0x1d0)][_0x4758a2(0x1b1)](RetrieveMetadataService[_0x4758a2(0x195)],_0x39fd84),_0x59f252=_0x40ed7b[_0x4758a2(0x1bd)](_0x36f6e5,_0x36f6e5+_0x155c10),_0x3a3041=[];for(const _0x3b44b1 of _0x59f252){const _0x4fd33c=await state_manger_1[_0x4758a2(0x1d0)][_0x4758a2(0x1b5)](path_1[_0x4758a2(0x1d0)][_0x4758a2(0x1a9)](RetrieveMetadataService['retrieveMetadataFolder'],_0x3b44b1));_0x3a3041[_0x4758a2(0x1a0)](_0x4fd33c);}return _0x3a3041;}static async[a272_0x53f4ae(0x1c4)](_0x324ddb){const _0x2deb4f=a272_0x53f4ae,_0x33bd57=job_utils_1[_0x2deb4f(0x1d0)][_0x2deb4f(0x1ab)](),_0x5052b9=path_1[_0x2deb4f(0x1d0)][_0x2deb4f(0x1a9)](RetrieveMetadataService[_0x2deb4f(0x195)],_0x33bd57);await(0x0,fs_utils_1[_0x2deb4f(0x1a6)])(_0x5052b9),await manifest_manger_1[_0x2deb4f(0x1d0)]['create'](_0x5052b9,_0x324ddb),await state_manger_1[_0x2deb4f(0x1d0)]['create'](_0x5052b9,_0x33bd57);const _0x40392f=path_1[_0x2deb4f(0x1d0)][_0x2deb4f(0x1a9)](__dirname,job_1[_0x2deb4f(0x1ca)]);return job_utils_1['default'][_0x2deb4f(0x1a2)](_0x40392f,{'jobStorePath':_0x5052b9,'jobId':_0x33bd57})[_0x2deb4f(0x1cd)](async _0x26904e=>{const _0x166a5a=_0x2deb4f,_0x5a7fe2=new state_manger_1[(_0x166a5a(0x1d0))](_0x5052b9);await _0x5a7fe2[_0x166a5a(0x199)](),await _0x5a7fe2[_0x166a5a(0x1c9)](_0x26904e);}),{'jobId':_0x33bd57};}static async[a272_0x53f4ae(0x1ac)](_0x29b1c0){const _0x34d3b2=a272_0x53f4ae,{status:_0x308522}=await RetrieveMetadataService[_0x34d3b2(0x1a7)](_0x29b1c0);if(_0x308522===logger_enums_1[_0x34d3b2(0x1b2)][_0x34d3b2(0x1aa)])throw new bad_request_error_1[(_0x34d3b2(0x1c5))](_0x34d3b2(0x1bf));const _0x2b0499=path_1[_0x34d3b2(0x1d0)]['join'](RetrieveMetadataService[_0x34d3b2(0x195)],_0x29b1c0,constants_1[_0x34d3b2(0x193)]);if(await utils_1[_0x34d3b2(0x1a3)][_0x34d3b2(0x19a)](_0x2b0499))return(0x0,promises_1[_0x34d3b2(0x1ad)])(_0x2b0499,'utf-8')['then'](JSON[_0x34d3b2(0x1b8)]);else throw new not_found_error_1['NotFoundError'](_0x34d3b2(0x19c));}static async['getResultChunk'](_0x27d2a8,_0x15c39b){const _0x2150e7=a272_0x53f4ae,{status:_0xe1a1c6}=await RetrieveMetadataService[_0x2150e7(0x1a7)](_0x27d2a8);if(_0xe1a1c6===logger_enums_1[_0x2150e7(0x1b2)][_0x2150e7(0x1aa)])throw new bad_request_error_1[(_0x2150e7(0x1c5))](_0x2150e7(0x1bf));const _0x4c7eb3=path_1[_0x2150e7(0x1d0)]['join'](RetrieveMetadataService[_0x2150e7(0x195)],_0x27d2a8,constants_1[_0x2150e7(0x190)]),_0x22911e={'data':[]};if(await utils_1[_0x2150e7(0x1a3)]['isExistsPath'](path_1[_0x2150e7(0x1d0)]['join'](_0x4c7eb3,_0x15c39b+_0x2150e7(0x1af))))_0x22911e['data']=await(0x0,promises_1[_0x2150e7(0x1ad)])(path_1[_0x2150e7(0x1d0)][_0x2150e7(0x1a9)](_0x4c7eb3,_0x15c39b+_0x2150e7(0x1af)),_0x2150e7(0x1cc))['then'](JSON['parse']);else throw new not_found_error_1[(_0x2150e7(0x1b3))](_0x2150e7(0x1ce));return _0x22911e;}static async[a272_0x53f4ae(0x1a7)](_0x2504bb){const _0x4676de=a272_0x53f4ae;try{return await state_manger_1[_0x4676de(0x1d0)]['getJobState'](path_1['default'][_0x4676de(0x1a9)](RetrieveMetadataService['retrieveMetadataFolder'],_0x2504bb));}catch(_0x4c2dcb){throw new not_found_error_1[(_0x4676de(0x1b3))](_0x4c2dcb);}}static async[a272_0x53f4ae(0x191)](_0x3b4b17){const _0x3f3af7=a272_0x53f4ae,_0xdc18ae=path_1[_0x3f3af7(0x1d0)]['join'](RetrieveMetadataService[_0x3f3af7(0x195)],_0x3b4b17,job_1[_0x3f3af7(0x19d)]);if(await utils_1[_0x3f3af7(0x1a3)][_0x3f3af7(0x19a)](_0xdc18ae))return(0x0,promises_1[_0x3f3af7(0x1ad)])(_0xdc18ae,_0x3f3af7(0x1cc))[_0x3f3af7(0x1b7)](_0x3ba2e7=>csv_utils_1[_0x3f3af7(0x1d0)]['parse'](_0x3ba2e7,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x3f3af7(0x1a1));}}exports[a272_0x53f4ae(0x1d0)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a272_0x53f4ae(0x1d0)][a272_0x53f4ae(0x1a9)](path_2[a272_0x53f4ae(0x197)],constants_1[a272_0x53f4ae(0x1b0)]);