function a320_0x576d(_0x4695a3,_0x2f3a0a){const _0x3280e4=a320_0x5971();return a320_0x576d=function(_0x5d30ca,_0x6c64dc){_0x5d30ca=_0x5d30ca-0x17d;let _0x5971e9=_0x3280e4[_0x5d30ca];return _0x5971e9;},a320_0x576d(_0x4695a3,_0x2f3a0a);}const a320_0x5dfe59=a320_0x576d;(function(_0xe05173,_0x7493e3){const _0x27e683=a320_0x576d,_0x360c9=_0xe05173();while(!![]){try{const _0x3bb599=-parseInt(_0x27e683(0x19b))/0x1*(parseInt(_0x27e683(0x195))/0x2)+parseInt(_0x27e683(0x1ab))/0x3*(parseInt(_0x27e683(0x188))/0x4)+-parseInt(_0x27e683(0x19e))/0x5*(-parseInt(_0x27e683(0x1a9))/0x6)+parseInt(_0x27e683(0x1aa))/0x7*(-parseInt(_0x27e683(0x192))/0x8)+-parseInt(_0x27e683(0x1be))/0x9*(parseInt(_0x27e683(0x18b))/0xa)+-parseInt(_0x27e683(0x194))/0xb+-parseInt(_0x27e683(0x1ba))/0xc*(-parseInt(_0x27e683(0x17f))/0xd);if(_0x3bb599===_0x7493e3)break;else _0x360c9['push'](_0x360c9['shift']());}catch(_0x494e97){_0x360c9['push'](_0x360c9['shift']());}}}(a320_0x5971,0x4aaac));const a320_0x6c64dc=(function(){let _0x17280e=!![];return function(_0x2f90f2,_0x308097){const _0x5026a4=_0x17280e?function(){const _0x1f5211=a320_0x576d;if(_0x308097){const _0x3a4d90=_0x308097[_0x1f5211(0x189)](_0x2f90f2,arguments);return _0x308097=null,_0x3a4d90;}}:function(){};return _0x17280e=![],_0x5026a4;};}()),a320_0x5d30ca=a320_0x6c64dc(this,function(){const _0x413995=a320_0x576d;return a320_0x5d30ca[_0x413995(0x1ac)]()['search'](_0x413995(0x1b4))['toString']()[_0x413995(0x196)](a320_0x5d30ca)[_0x413995(0x1a4)](_0x413995(0x1b4));});function a320_0x5971(){const _0x243d20=['readFile','@flosum/utils','getJobLogs','dataPath','5344bVVEGw','../../../configs/path','1760759YEjBcc','86enGTFI','constructor','runJob','sortJobsIds','../../../constants/job','retrieveMetadataFolder','2785VVsvBL','push','Job\x20not\x20completed.','3085TUjZjh','catch','create','JobStatus','IN_PROGRESS','init','search','__importDefault','getJobStatus','getResultChunk','makeDir','300wfCgDG','5537MVwSKr','60vPBZqR','toString','RETRIEVE_METADATA_FOLDER_NAME','Chunk\x20not\x20found.','data','join','then','FsUtils','createRetrieveJob','(((.+)+)+)+$','default','parse','../../../core/errors/bad-request.error','setError','path','18579432wYTUvX','isExistsPath','__esModule','JOB_LOG_DETAILS_FILENAME','36vCDSLF','RETRIEVE_RESULT_FOLDER_NAME','../../../core/errors/not-found.error','13sxWWKq','getJobState','utf-8','../../shared/enums/logger.enums','.json','getJobs','../job/classes/manifest-manger','generateJobId','getJobsIds','2416AjJgYv','apply','BadRequestError','1192920pnLRMo','../../shared/utils/job.utils','NotFoundError'];a320_0x5971=function(){return _0x243d20;};return a320_0x5971();}a320_0x5d30ca();'use strict';var __importDefault=this&&this[a320_0x5dfe59(0x1a5)]||function(_0x1d41dd){const _0x2ea913=a320_0x5dfe59;return _0x1d41dd&&_0x1d41dd[_0x2ea913(0x1bc)]?_0x1d41dd:{'default':_0x1d41dd};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a320_0x5dfe59(0x18c))),path_1=__importDefault(require(a320_0x5dfe59(0x1b9))),manifest_manger_1=__importDefault(require(a320_0x5dfe59(0x185))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require('fs/promises'),utils_1=require(a320_0x5dfe59(0x18f)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a320_0x5dfe59(0x17e)),logger_enums_1=require(a320_0x5dfe59(0x182)),bad_request_error_1=require(a320_0x5dfe59(0x1b7)),job_1=require(a320_0x5dfe59(0x199)),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require('../constants'),path_2=require(a320_0x5dfe59(0x193));class RetrieveMetadataService{static async[a320_0x5dfe59(0x184)](_0x41e91f,_0x5125c8){const _0xeac4ff=a320_0x5dfe59,_0x51280f=await job_utils_1[_0xeac4ff(0x1b5)][_0xeac4ff(0x187)](RetrieveMetadataService[_0xeac4ff(0x19a)]),_0x800038=await job_utils_1[_0xeac4ff(0x1b5)][_0xeac4ff(0x198)](RetrieveMetadataService[_0xeac4ff(0x19a)],_0x51280f),_0x1f12f9=_0x800038['slice'](_0x5125c8,_0x5125c8+_0x41e91f),_0x4d154b=[];for(const _0x446173 of _0x1f12f9){const _0x416743=await state_manger_1['default'][_0xeac4ff(0x180)](path_1[_0xeac4ff(0x1b5)]['join'](RetrieveMetadataService[_0xeac4ff(0x19a)],_0x446173));_0x4d154b[_0xeac4ff(0x19c)](_0x416743);}return _0x4d154b;}static async[a320_0x5dfe59(0x1b3)](_0x52b984){const _0x1233b6=a320_0x5dfe59,_0x5913cb=job_utils_1[_0x1233b6(0x1b5)][_0x1233b6(0x186)](),_0x311cd4=path_1[_0x1233b6(0x1b5)][_0x1233b6(0x1b0)](RetrieveMetadataService[_0x1233b6(0x19a)],_0x5913cb);await(0x0,fs_utils_1[_0x1233b6(0x1a8)])(_0x311cd4),await manifest_manger_1[_0x1233b6(0x1b5)][_0x1233b6(0x1a0)](_0x311cd4,_0x52b984),await state_manger_1[_0x1233b6(0x1b5)][_0x1233b6(0x1a0)](_0x311cd4,_0x5913cb);const _0x3fdb13=path_1['default'][_0x1233b6(0x1b0)](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x1233b6(0x1b5)][_0x1233b6(0x197)](_0x3fdb13,{'jobStorePath':_0x311cd4,'jobId':_0x5913cb})[_0x1233b6(0x19f)](async _0x295dad=>{const _0x198feb=_0x1233b6,_0x43fd7b=new state_manger_1[(_0x198feb(0x1b5))](_0x311cd4);await _0x43fd7b[_0x198feb(0x1a3)](),await _0x43fd7b[_0x198feb(0x1b8)](_0x295dad);}),{'jobId':_0x5913cb};}static async['getResult'](_0x5eae70){const _0x18aec5=a320_0x5dfe59,{status:_0x184816}=await RetrieveMetadataService['getJobStatus'](_0x5eae70);if(_0x184816===logger_enums_1[_0x18aec5(0x1a1)][_0x18aec5(0x1a2)])throw new bad_request_error_1['BadRequestError'](_0x18aec5(0x19d));const _0x4b2afb=path_1['default'][_0x18aec5(0x1b0)](RetrieveMetadataService[_0x18aec5(0x19a)],_0x5eae70,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x18aec5(0x1b2)]['isExistsPath'](_0x4b2afb))return(0x0,promises_1[_0x18aec5(0x18e)])(_0x4b2afb,_0x18aec5(0x181))[_0x18aec5(0x1b1)](JSON['parse']);else throw new not_found_error_1['NotFoundError']('Result\x20not\x20found.');}static async[a320_0x5dfe59(0x1a7)](_0x1a27e9,_0x2fba29){const _0x1cf55b=a320_0x5dfe59,{status:_0x209ddc}=await RetrieveMetadataService[_0x1cf55b(0x1a6)](_0x1a27e9);if(_0x209ddc===logger_enums_1['JobStatus'][_0x1cf55b(0x1a2)])throw new bad_request_error_1[(_0x1cf55b(0x18a))]('Job\x20not\x20completed.');const _0x3d56bd=path_1['default']['join'](RetrieveMetadataService[_0x1cf55b(0x19a)],_0x1a27e9,constants_1[_0x1cf55b(0x17d)]),_0x4a1d98={'data':[]};if(await utils_1[_0x1cf55b(0x1b2)][_0x1cf55b(0x1bb)](path_1[_0x1cf55b(0x1b5)][_0x1cf55b(0x1b0)](_0x3d56bd,_0x2fba29+'.json')))_0x4a1d98[_0x1cf55b(0x1af)]=await(0x0,promises_1['readFile'])(path_1[_0x1cf55b(0x1b5)][_0x1cf55b(0x1b0)](_0x3d56bd,_0x2fba29+_0x1cf55b(0x183)),'utf-8')['then'](JSON['parse']);else throw new not_found_error_1[(_0x1cf55b(0x18d))](_0x1cf55b(0x1ae));return _0x4a1d98;}static async[a320_0x5dfe59(0x1a6)](_0x4a8566){const _0x592516=a320_0x5dfe59;try{return await state_manger_1[_0x592516(0x1b5)]['getJobState'](path_1[_0x592516(0x1b5)][_0x592516(0x1b0)](RetrieveMetadataService[_0x592516(0x19a)],_0x4a8566));}catch(_0x2b0b47){throw new not_found_error_1[(_0x592516(0x18d))](_0x2b0b47);}}static async[a320_0x5dfe59(0x190)](_0x401f67){const _0x609293=a320_0x5dfe59,_0x5b891b=path_1[_0x609293(0x1b5)][_0x609293(0x1b0)](RetrieveMetadataService[_0x609293(0x19a)],_0x401f67,job_1[_0x609293(0x1bd)]);if(await utils_1[_0x609293(0x1b2)][_0x609293(0x1bb)](_0x5b891b))return(0x0,promises_1[_0x609293(0x18e)])(_0x5b891b,'utf-8')[_0x609293(0x1b1)](_0x578331=>csv_utils_1['default'][_0x609293(0x1b6)](_0x578331,{'columns':!![]}));throw new not_found_error_1['NotFoundError']('Job\x20log\x20not\x20found.');}}exports[a320_0x5dfe59(0x1b5)]=RetrieveMetadataService,RetrieveMetadataService[a320_0x5dfe59(0x19a)]=path_1[a320_0x5dfe59(0x1b5)][a320_0x5dfe59(0x1b0)](path_2[a320_0x5dfe59(0x191)],constants_1[a320_0x5dfe59(0x1ad)]);