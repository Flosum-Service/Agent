function a319_0x4401(_0x9d18c8,_0x5d4ae8){const _0x48d0b5=a319_0xae38();return a319_0x4401=function(_0x172af6,_0x1fb5e7){_0x172af6=_0x172af6-0x92;let _0xae38d8=_0x48d0b5[_0x172af6];return _0xae38d8;},a319_0x4401(_0x9d18c8,_0x5d4ae8);}const a319_0x157c56=a319_0x4401;(function(_0x9e02a1,_0x2d8cc7){const _0x1cb98e=a319_0x4401,_0x1aeee4=_0x9e02a1();while(!![]){try{const _0x56375e=-parseInt(_0x1cb98e(0x95))/0x1+-parseInt(_0x1cb98e(0x97))/0x2+parseInt(_0x1cb98e(0xc5))/0x3*(-parseInt(_0x1cb98e(0x99))/0x4)+parseInt(_0x1cb98e(0xd0))/0x5*(-parseInt(_0x1cb98e(0xa2))/0x6)+parseInt(_0x1cb98e(0xae))/0x7*(-parseInt(_0x1cb98e(0xa8))/0x8)+parseInt(_0x1cb98e(0x9a))/0x9+parseInt(_0x1cb98e(0xcd))/0xa;if(_0x56375e===_0x2d8cc7)break;else _0x1aeee4['push'](_0x1aeee4['shift']());}catch(_0x386286){_0x1aeee4['push'](_0x1aeee4['shift']());}}}(a319_0xae38,0x1ea6b));const a319_0x1fb5e7=(function(){let _0xd8cddf=!![];return function(_0x430853,_0x6969b1){const _0x7880bf=_0xd8cddf?function(){if(_0x6969b1){const _0x113d88=_0x6969b1['apply'](_0x430853,arguments);return _0x6969b1=null,_0x113d88;}}:function(){};return _0xd8cddf=![],_0x7880bf;};}()),a319_0x172af6=a319_0x1fb5e7(this,function(){const _0x4fa910=a319_0x4401;return a319_0x172af6['toString']()[_0x4fa910(0xcb)](_0x4fa910(0x92))[_0x4fa910(0x9b)]()['constructor'](a319_0x172af6)['search'](_0x4fa910(0x92));});function a319_0xae38(){const _0x9a621c=['init','18457HBdVSj','getJobStatus','440268BmeLxE','sortJobsIds','3932DtshMr','644166cCABkO','toString','../../shared/utils/fs.utils','JOB_PATH','RETRIEVE_RESULTS_IDS_FILENAME','BadRequestError','Chunk\x20not\x20found.','../job/classes/manifest-manger','396kuxhcQ','../../../configs/path','../../shared/utils/csv.utils','../../../core/errors/not-found.error','isExistsPath','getJobs','584864Uarpmq','JobStatus','createRetrieveJob','create','generateJobId','Job\x20not\x20completed.','7PDEDBq','defineProperty','getJobsIds','JOB_LOG_DETAILS_FILENAME','dataPath','join','.json','NotFoundError','retrieveMetadataFolder','getResult','push','parse','../../shared/utils/job.utils','__importDefault','path','then','../constants','RETRIEVE_RESULT_FOLDER_NAME','Result\x20not\x20found.','getJobState','runJob','makeDir','../../../core/errors/bad-request.error','555oUUKQQ','data','../../shared/enums/logger.enums','FsUtils','getResultChunk','@flosum/utils','search','default','7892850LntzRh','readFile','IN_PROGRESS','18315BNMMTM','RETRIEVE_METADATA_FOLDER_NAME','utf-8','(((.+)+)+)+$','slice'];a319_0xae38=function(){return _0x9a621c;};return a319_0xae38();}a319_0x172af6();'use strict';var __importDefault=this&&this[a319_0x157c56(0xbb)]||function(_0x2793a2){return _0x2793a2&&_0x2793a2['__esModule']?_0x2793a2:{'default':_0x2793a2};};Object[a319_0x157c56(0xaf)](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a319_0x157c56(0xba))),path_1=__importDefault(require(a319_0x157c56(0xbc))),manifest_manger_1=__importDefault(require(a319_0x157c56(0xa1))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require('fs/promises'),utils_1=require(a319_0x157c56(0xca)),csv_utils_1=__importDefault(require(a319_0x157c56(0xa4))),not_found_error_1=require(a319_0x157c56(0xa5)),logger_enums_1=require(a319_0x157c56(0xc7)),bad_request_error_1=require(a319_0x157c56(0xc4)),job_1=require('../../../constants/job'),fs_utils_1=require(a319_0x157c56(0x9c)),constants_1=require(a319_0x157c56(0xbe)),path_2=require(a319_0x157c56(0xa3));class RetrieveMetadataService{static async[a319_0x157c56(0xa7)](_0x435649,_0x32cb43){const _0x1f3922=a319_0x157c56,_0xeaf88f=await job_utils_1[_0x1f3922(0xcc)][_0x1f3922(0xb0)](RetrieveMetadataService['retrieveMetadataFolder']),_0x3341c5=await job_utils_1[_0x1f3922(0xcc)][_0x1f3922(0x98)](RetrieveMetadataService['retrieveMetadataFolder'],_0xeaf88f),_0x5c4564=_0x3341c5[_0x1f3922(0x93)](_0x32cb43,_0x32cb43+_0x435649),_0x5f4f4f=[];for(const _0x3d0fe0 of _0x5c4564){const _0x2048b4=await state_manger_1[_0x1f3922(0xcc)][_0x1f3922(0xc1)](path_1[_0x1f3922(0xcc)][_0x1f3922(0xb3)](RetrieveMetadataService['retrieveMetadataFolder'],_0x3d0fe0));_0x5f4f4f[_0x1f3922(0xb8)](_0x2048b4);}return _0x5f4f4f;}static async[a319_0x157c56(0xaa)](_0x4b979b){const _0x3fd577=a319_0x157c56,_0x2166dd=job_utils_1['default'][_0x3fd577(0xac)](),_0x2a902e=path_1[_0x3fd577(0xcc)][_0x3fd577(0xb3)](RetrieveMetadataService['retrieveMetadataFolder'],_0x2166dd);await(0x0,fs_utils_1[_0x3fd577(0xc3)])(_0x2a902e),await manifest_manger_1[_0x3fd577(0xcc)][_0x3fd577(0xab)](_0x2a902e,_0x4b979b),await state_manger_1['default'][_0x3fd577(0xab)](_0x2a902e,_0x2166dd);const _0x509a53=path_1['default']['join'](__dirname,job_1[_0x3fd577(0x9d)]);return job_utils_1['default'][_0x3fd577(0xc2)](_0x509a53,{'jobStorePath':_0x2a902e,'jobId':_0x2166dd})['catch'](async _0x3b0088=>{const _0x297f22=_0x3fd577,_0x563adb=new state_manger_1[(_0x297f22(0xcc))](_0x2a902e);await _0x563adb[_0x297f22(0x94)](),await _0x563adb['setError'](_0x3b0088);}),{'jobId':_0x2166dd};}static async[a319_0x157c56(0xb7)](_0x5776e9){const _0x3186db=a319_0x157c56,{status:_0x3c5514}=await RetrieveMetadataService['getJobStatus'](_0x5776e9);if(_0x3c5514===logger_enums_1['JobStatus'][_0x3186db(0xcf)])throw new bad_request_error_1[(_0x3186db(0x9f))](_0x3186db(0xad));const _0x4af5fb=path_1[_0x3186db(0xcc)][_0x3186db(0xb3)](RetrieveMetadataService[_0x3186db(0xb6)],_0x5776e9,constants_1[_0x3186db(0x9e)]);if(await utils_1[_0x3186db(0xc8)][_0x3186db(0xa6)](_0x4af5fb))return(0x0,promises_1[_0x3186db(0xce)])(_0x4af5fb,'utf-8')['then'](JSON['parse']);else throw new not_found_error_1['NotFoundError'](_0x3186db(0xc0));}static async[a319_0x157c56(0xc9)](_0x330940,_0x265c83){const _0x248b39=a319_0x157c56,{status:_0x3d9d98}=await RetrieveMetadataService[_0x248b39(0x96)](_0x330940);if(_0x3d9d98===logger_enums_1[_0x248b39(0xa9)][_0x248b39(0xcf)])throw new bad_request_error_1['BadRequestError'](_0x248b39(0xad));const _0x537b5f=path_1[_0x248b39(0xcc)][_0x248b39(0xb3)](RetrieveMetadataService['retrieveMetadataFolder'],_0x330940,constants_1[_0x248b39(0xbf)]),_0x2eecc7={'data':[]};if(await utils_1[_0x248b39(0xc8)][_0x248b39(0xa6)](path_1[_0x248b39(0xcc)]['join'](_0x537b5f,_0x265c83+_0x248b39(0xb4))))_0x2eecc7[_0x248b39(0xc6)]=await(0x0,promises_1[_0x248b39(0xce)])(path_1['default'][_0x248b39(0xb3)](_0x537b5f,_0x265c83+_0x248b39(0xb4)),_0x248b39(0xd2))[_0x248b39(0xbd)](JSON[_0x248b39(0xb9)]);else throw new not_found_error_1[(_0x248b39(0xb5))](_0x248b39(0xa0));return _0x2eecc7;}static async[a319_0x157c56(0x96)](_0x5a372a){const _0x1b9dc7=a319_0x157c56;try{return await state_manger_1[_0x1b9dc7(0xcc)][_0x1b9dc7(0xc1)](path_1[_0x1b9dc7(0xcc)]['join'](RetrieveMetadataService[_0x1b9dc7(0xb6)],_0x5a372a));}catch(_0x513fe6){throw new not_found_error_1[(_0x1b9dc7(0xb5))](_0x513fe6);}}static async['getJobLogs'](_0xc925e6){const _0x28e372=a319_0x157c56,_0x73943a=path_1[_0x28e372(0xcc)][_0x28e372(0xb3)](RetrieveMetadataService[_0x28e372(0xb6)],_0xc925e6,job_1[_0x28e372(0xb1)]);if(await utils_1['FsUtils'][_0x28e372(0xa6)](_0x73943a))return(0x0,promises_1[_0x28e372(0xce)])(_0x73943a,'utf-8')[_0x28e372(0xbd)](_0x2ebab3=>csv_utils_1[_0x28e372(0xcc)][_0x28e372(0xb9)](_0x2ebab3,{'columns':!![]}));throw new not_found_error_1[(_0x28e372(0xb5))]('Job\x20log\x20not\x20found.');}}exports['default']=RetrieveMetadataService,RetrieveMetadataService[a319_0x157c56(0xb6)]=path_1[a319_0x157c56(0xcc)][a319_0x157c56(0xb3)](path_2[a319_0x157c56(0xb2)],constants_1[a319_0x157c56(0xd1)]);