const a277_0xfdfe5a=a277_0x42dd;function a277_0x42dd(_0x3d25db,_0x375fa7){const _0xcd3f7d=a277_0x3647();return a277_0x42dd=function(_0x1d80ef,_0x203f5d){_0x1d80ef=_0x1d80ef-0xde;let _0x364722=_0xcd3f7d[_0x1d80ef];return _0x364722;},a277_0x42dd(_0x3d25db,_0x375fa7);}(function(_0x3832c9,_0x1ba797){const _0x33a719=a277_0x42dd,_0x5568a2=_0x3832c9();while(!![]){try{const _0x32228a=parseInt(_0x33a719(0x106))/0x1*(-parseInt(_0x33a719(0xdf))/0x2)+-parseInt(_0x33a719(0xe5))/0x3*(-parseInt(_0x33a719(0xee))/0x4)+-parseInt(_0x33a719(0xf8))/0x5*(parseInt(_0x33a719(0xf0))/0x6)+-parseInt(_0x33a719(0x11a))/0x7+-parseInt(_0x33a719(0xed))/0x8+-parseInt(_0x33a719(0x109))/0x9*(-parseInt(_0x33a719(0x110))/0xa)+parseInt(_0x33a719(0xfa))/0xb;if(_0x32228a===_0x1ba797)break;else _0x5568a2['push'](_0x5568a2['shift']());}catch(_0x115f2a){_0x5568a2['push'](_0x5568a2['shift']());}}}(a277_0x3647,0xb8632));const a277_0x203f5d=(function(){let _0x267db7=!![];return function(_0x2307c5,_0x27e8ad){const _0x4d91e9=_0x267db7?function(){const _0x6594fd=a277_0x42dd;if(_0x27e8ad){const _0x14a059=_0x27e8ad[_0x6594fd(0x113)](_0x2307c5,arguments);return _0x27e8ad=null,_0x14a059;}}:function(){};return _0x267db7=![],_0x4d91e9;};}()),a277_0x1d80ef=a277_0x203f5d(this,function(){const _0x518e31=a277_0x42dd;return a277_0x1d80ef['toString']()[_0x518e31(0x100)](_0x518e31(0x11d))[_0x518e31(0xef)]()[_0x518e31(0xe7)](a277_0x1d80ef)[_0x518e31(0x100)]('(((.+)+)+)+$');});a277_0x1d80ef();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x44c1ca){return _0x44c1ca&&_0x44c1ca['__esModule']?_0x44c1ca:{'default':_0x44c1ca};};Object[a277_0xfdfe5a(0xea)](exports,a277_0xfdfe5a(0xff),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a277_0xfdfe5a(0xe0))),manifest_manger_1=__importDefault(require(a277_0xfdfe5a(0xe8))),state_manger_1=__importDefault(require(a277_0xfdfe5a(0x115))),promises_1=require('fs/promises'),utils_1=require(a277_0xfdfe5a(0xeb)),csv_utils_1=__importDefault(require(a277_0xfdfe5a(0xf4))),not_found_error_1=require(a277_0xfdfe5a(0xfd)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require(a277_0xfdfe5a(0xe9)),job_1=require('../../../constants/job'),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require('../constants'),path_2=require(a277_0xfdfe5a(0x116));class RetrieveMetadataService{static async[a277_0xfdfe5a(0x102)](_0x12fd88,_0x5d2f80){const _0x56e82a=a277_0xfdfe5a,_0x248a8c=await job_utils_1['default']['getJobsIds'](RetrieveMetadataService[_0x56e82a(0xf5)]),_0x344595=await job_utils_1[_0x56e82a(0x11b)][_0x56e82a(0xf3)](RetrieveMetadataService['retrieveMetadataFolder'],_0x248a8c),_0x3fe32e=_0x344595[_0x56e82a(0xf6)](_0x5d2f80,_0x5d2f80+_0x12fd88),_0x8e4bea=[];for(const _0x4edda1 of _0x3fe32e){const _0x8dfe6b=await state_manger_1[_0x56e82a(0x11b)]['getJobState'](path_1['default']['join'](RetrieveMetadataService[_0x56e82a(0xf5)],_0x4edda1));_0x8e4bea[_0x56e82a(0x112)](_0x8dfe6b);}return _0x8e4bea;}static async[a277_0xfdfe5a(0xde)](_0x1dabaf){const _0x16735f=a277_0xfdfe5a,_0x4717f0=job_utils_1[_0x16735f(0x11b)][_0x16735f(0xfb)](),_0xdb582d=path_1['default']['join'](RetrieveMetadataService[_0x16735f(0xf5)],_0x4717f0);await(0x0,fs_utils_1['makeDir'])(_0xdb582d),await manifest_manger_1[_0x16735f(0x11b)][_0x16735f(0x119)](_0xdb582d,_0x1dabaf),await state_manger_1[_0x16735f(0x11b)][_0x16735f(0x119)](_0xdb582d,_0x4717f0);const _0x3d89fb=path_1['default'][_0x16735f(0xfc)](__dirname,job_1[_0x16735f(0x10c)]);return job_utils_1[_0x16735f(0x11b)]['runJob'](_0x3d89fb,{'jobStorePath':_0xdb582d,'jobId':_0x4717f0})[_0x16735f(0x118)](async _0x152532=>{const _0x40a1e1=_0x16735f,_0x4b17e6=new state_manger_1[(_0x40a1e1(0x11b))](_0xdb582d);await _0x4b17e6[_0x40a1e1(0xe6)](),await _0x4b17e6[_0x40a1e1(0xe4)](_0x152532);}),{'jobId':_0x4717f0};}static async[a277_0xfdfe5a(0x10d)](_0x298adb){const _0x105417=a277_0xfdfe5a,{status:_0x3a0a1d}=await RetrieveMetadataService[_0x105417(0xf1)](_0x298adb);if(_0x3a0a1d===logger_enums_1[_0x105417(0xfe)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x105417(0x10e))](_0x105417(0x10f));const _0x252458=path_1[_0x105417(0x11b)][_0x105417(0xfc)](RetrieveMetadataService[_0x105417(0xf5)],_0x298adb,constants_1[_0x105417(0x117)]);if(await utils_1[_0x105417(0xf9)][_0x105417(0x11c)](_0x252458))return(0x0,promises_1[_0x105417(0xe3)])(_0x252458,_0x105417(0x107))[_0x105417(0x105)](JSON['parse']);else throw new not_found_error_1[(_0x105417(0x10a))](_0x105417(0xf2));}static async[a277_0xfdfe5a(0x104)](_0x241bf1,_0x17b1bc){const _0x309d76=a277_0xfdfe5a,{status:_0x2bae5f}=await RetrieveMetadataService[_0x309d76(0xf1)](_0x241bf1);if(_0x2bae5f===logger_enums_1[_0x309d76(0xfe)][_0x309d76(0xec)])throw new bad_request_error_1['BadRequestError']('Job\x20not\x20completed.');const _0x3ef1b9=path_1['default'][_0x309d76(0xfc)](RetrieveMetadataService[_0x309d76(0xf5)],_0x241bf1,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x941ec4={'data':[]};if(await utils_1[_0x309d76(0xf9)][_0x309d76(0x11c)](path_1[_0x309d76(0x11b)][_0x309d76(0xfc)](_0x3ef1b9,_0x17b1bc+'.json')))_0x941ec4['data']=await(0x0,promises_1[_0x309d76(0xe3)])(path_1[_0x309d76(0x11b)][_0x309d76(0xfc)](_0x3ef1b9,_0x17b1bc+_0x309d76(0xe1)),_0x309d76(0x107))[_0x309d76(0x105)](JSON[_0x309d76(0x111)]);else throw new not_found_error_1[(_0x309d76(0x10a))](_0x309d76(0xf7));return _0x941ec4;}static async[a277_0xfdfe5a(0xf1)](_0x5ca759){const _0x42f246=a277_0xfdfe5a;try{return await state_manger_1[_0x42f246(0x11b)][_0x42f246(0x103)](path_1[_0x42f246(0x11b)][_0x42f246(0xfc)](RetrieveMetadataService[_0x42f246(0xf5)],_0x5ca759));}catch(_0x3b58a7){throw new not_found_error_1[(_0x42f246(0x10a))](_0x3b58a7);}}static async[a277_0xfdfe5a(0x108)](_0x23755b){const _0x3b173e=a277_0xfdfe5a,_0x5d6d0d=path_1['default'][_0x3b173e(0xfc)](RetrieveMetadataService['retrieveMetadataFolder'],_0x23755b,job_1[_0x3b173e(0x114)]);if(await utils_1[_0x3b173e(0xf9)][_0x3b173e(0x11c)](_0x5d6d0d))return(0x0,promises_1[_0x3b173e(0xe3)])(_0x5d6d0d,'utf-8')[_0x3b173e(0x105)](_0x25844e=>csv_utils_1[_0x3b173e(0x11b)][_0x3b173e(0x111)](_0x25844e,{'columns':!![]}));throw new not_found_error_1[(_0x3b173e(0x10a))](_0x3b173e(0x101));}}exports[a277_0xfdfe5a(0x11b)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1['default'][a277_0xfdfe5a(0xfc)](path_2[a277_0xfdfe5a(0x10b)],constants_1[a277_0xfdfe5a(0xe2)]);function a277_0x3647(){const _0x18968d=['../../../core/errors/bad-request.error','defineProperty','@flosum/utils','IN_PROGRESS','3526192yOGYMs','1372teyRml','toString','173934DvJOPN','getJobStatus','Result\x20not\x20found.','sortJobsIds','../../shared/utils/csv.utils','retrieveMetadataFolder','slice','Chunk\x20not\x20found.','75jHVGBp','FsUtils','35952070iQcqLj','generateJobId','join','../../../core/errors/not-found.error','JobStatus','__esModule','search','Job\x20log\x20not\x20found.','getJobs','getJobState','getResultChunk','then','1XeGDrf','utf-8','getJobLogs','774fuDCFX','NotFoundError','dataPath','JOB_PATH','getResult','BadRequestError','Job\x20not\x20completed.','122810ZuiEAQ','parse','push','apply','JOB_LOG_DETAILS_FILENAME','../../shared/managers/state-manger','../../../configs/path','RETRIEVE_RESULTS_IDS_FILENAME','catch','create','8968393YNHEXb','default','isExistsPath','(((.+)+)+)+$','createRetrieveJob','3011548PDFnLQ','path','.json','RETRIEVE_METADATA_FOLDER_NAME','readFile','setError','816tNeiDt','init','constructor','../job/classes/manifest-manger'];a277_0x3647=function(){return _0x18968d;};return a277_0x3647();}