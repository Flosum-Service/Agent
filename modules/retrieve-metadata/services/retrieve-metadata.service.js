const a273_0x2b0786=a273_0x2b9a;(function(_0x28d1d3,_0x307c08){const _0x292439=a273_0x2b9a,_0x37657b=_0x28d1d3();while(!![]){try{const _0x283408=-parseInt(_0x292439(0x1ed))/0x1*(parseInt(_0x292439(0x217))/0x2)+-parseInt(_0x292439(0x20a))/0x3+parseInt(_0x292439(0x1ea))/0x4*(-parseInt(_0x292439(0x1e5))/0x5)+parseInt(_0x292439(0x21f))/0x6*(parseInt(_0x292439(0x212))/0x7)+parseInt(_0x292439(0x215))/0x8+-parseInt(_0x292439(0x21e))/0x9+parseInt(_0x292439(0x213))/0xa;if(_0x283408===_0x307c08)break;else _0x37657b['push'](_0x37657b['shift']());}catch(_0x34e064){_0x37657b['push'](_0x37657b['shift']());}}}(a273_0xeaa5,0x53763));const a273_0x153ef4=(function(){let _0x4ce153=!![];return function(_0x643e4a,_0x497c57){const _0x48bd62=_0x4ce153?function(){if(_0x497c57){const _0x862873=_0x497c57['apply'](_0x643e4a,arguments);return _0x497c57=null,_0x862873;}}:function(){};return _0x4ce153=![],_0x48bd62;};}()),a273_0x1a78d8=a273_0x153ef4(this,function(){const _0x38661c=a273_0x2b9a;return a273_0x1a78d8[_0x38661c(0x1ec)]()[_0x38661c(0x216)](_0x38661c(0x1fa))[_0x38661c(0x1ec)]()[_0x38661c(0x203)](a273_0x1a78d8)[_0x38661c(0x216)]('(((.+)+)+)+$');});a273_0x1a78d8();'use strict';function a273_0x2b9a(_0x32a247,_0x1076e3){const _0x28a929=a273_0xeaa5();return a273_0x2b9a=function(_0x1a78d8,_0x153ef4){_0x1a78d8=_0x1a78d8-0x1df;let _0xeaa5=_0x28a929[_0x1a78d8];return _0xeaa5;},a273_0x2b9a(_0x32a247,_0x1076e3);}var __importDefault=this&&this[a273_0x2b0786(0x1eb)]||function(_0x1a6644){const _0x46a3c4=a273_0x2b0786;return _0x1a6644&&_0x1a6644[_0x46a3c4(0x207)]?_0x1a6644:{'default':_0x1a6644};};Object[a273_0x2b0786(0x209)](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a273_0x2b0786(0x1f9))),path_1=__importDefault(require(a273_0x2b0786(0x1e1))),manifest_manger_1=__importDefault(require(a273_0x2b0786(0x214))),state_manger_1=__importDefault(require(a273_0x2b0786(0x200))),promises_1=require('fs/promises'),utils_1=require(a273_0x2b0786(0x1f7)),csv_utils_1=__importDefault(require(a273_0x2b0786(0x1f8))),not_found_error_1=require(a273_0x2b0786(0x1e3)),logger_enums_1=require('../job/enums/logger.enums'),bad_request_error_1=require(a273_0x2b0786(0x204)),job_1=require(a273_0x2b0786(0x1fb)),fs_utils_1=require(a273_0x2b0786(0x218)),constants_1=require('../constants'),path_2=require(a273_0x2b0786(0x1ee));class RetrieveMetadataService{static async[a273_0x2b0786(0x1fc)](_0x2cc410,_0x5748c7){const _0xba320f=a273_0x2b0786,_0x109425=await job_utils_1[_0xba320f(0x21a)]['getJobsIds'](RetrieveMetadataService['retrieveMetadataFolder']),_0x3dd19c=await job_utils_1[_0xba320f(0x21a)]['sortJobsIds'](RetrieveMetadataService[_0xba320f(0x1e0)],_0x109425),_0x132d73=_0x3dd19c[_0xba320f(0x211)](_0x5748c7,_0x5748c7+_0x2cc410),_0x4d4cd3=[];for(const _0x1bfe12 of _0x132d73){const _0x11e1e3=await state_manger_1[_0xba320f(0x21a)][_0xba320f(0x1e4)](path_1['default']['join'](RetrieveMetadataService[_0xba320f(0x1e0)],_0x1bfe12));_0x4d4cd3[_0xba320f(0x1e9)](_0x11e1e3);}return _0x4d4cd3;}static async[a273_0x2b0786(0x1f6)](_0xf07069){const _0x1fdf74=a273_0x2b0786,_0x3dac96=job_utils_1['default'][_0x1fdf74(0x202)](),_0x13e013=path_1[_0x1fdf74(0x21a)]['join'](RetrieveMetadataService[_0x1fdf74(0x1e0)],_0x3dac96);await(0x0,fs_utils_1[_0x1fdf74(0x20d)])(_0x13e013),await manifest_manger_1['default'][_0x1fdf74(0x1f5)](_0x13e013,_0xf07069),await state_manger_1['default'][_0x1fdf74(0x1f5)](_0x13e013,_0x3dac96);const _0x8355da=path_1[_0x1fdf74(0x21a)][_0x1fdf74(0x1e7)](__dirname,job_1[_0x1fdf74(0x21b)]);return job_utils_1['default'][_0x1fdf74(0x1df)](_0x8355da,{'jobStorePath':_0x13e013,'jobId':_0x3dac96})[_0x1fdf74(0x205)](async _0x574bdc=>{const _0x111a7b=new state_manger_1['default'](_0x13e013);await _0x111a7b['init'](),await _0x111a7b['setError'](_0x574bdc);}),{'jobId':_0x3dac96};}static async[a273_0x2b0786(0x1f1)](_0x57b935){const _0xd6c3a6=a273_0x2b0786,{status:_0x130cf9}=await RetrieveMetadataService[_0xd6c3a6(0x219)](_0x57b935);if(_0x130cf9===logger_enums_1[_0xd6c3a6(0x210)][_0xd6c3a6(0x1fd)])throw new bad_request_error_1['BadRequestError']('Job\x20not\x20completed.');const _0x3f9ff6=path_1[_0xd6c3a6(0x21a)][_0xd6c3a6(0x1e7)](RetrieveMetadataService['retrieveMetadataFolder'],_0x57b935,constants_1[_0xd6c3a6(0x1e8)]);if(await utils_1[_0xd6c3a6(0x1f3)][_0xd6c3a6(0x1e6)](_0x3f9ff6))return(0x0,promises_1['readFile'])(_0x3f9ff6,'utf-8')[_0xd6c3a6(0x206)](JSON[_0xd6c3a6(0x20b)]);else throw new not_found_error_1[(_0xd6c3a6(0x1fe))](_0xd6c3a6(0x20e));}static async[a273_0x2b0786(0x1ef)](_0x3f71d1,_0x45f32c){const _0x1cb728=a273_0x2b0786,{status:_0x21eb19}=await RetrieveMetadataService[_0x1cb728(0x219)](_0x3f71d1);if(_0x21eb19===logger_enums_1[_0x1cb728(0x210)][_0x1cb728(0x1fd)])throw new bad_request_error_1[(_0x1cb728(0x1f4))]('Job\x20not\x20completed.');const _0x5b1e9b=path_1[_0x1cb728(0x21a)]['join'](RetrieveMetadataService[_0x1cb728(0x1e0)],_0x3f71d1,constants_1[_0x1cb728(0x1ff)]),_0x48d55={'data':[]};if(await utils_1[_0x1cb728(0x1f3)][_0x1cb728(0x1e6)](path_1['default'][_0x1cb728(0x1e7)](_0x5b1e9b,_0x45f32c+_0x1cb728(0x21d))))_0x48d55[_0x1cb728(0x20f)]=await(0x0,promises_1[_0x1cb728(0x1e2)])(path_1[_0x1cb728(0x21a)][_0x1cb728(0x1e7)](_0x5b1e9b,_0x45f32c+_0x1cb728(0x21d)),'utf-8')[_0x1cb728(0x206)](JSON[_0x1cb728(0x20b)]);else throw new not_found_error_1[(_0x1cb728(0x1fe))]('Chunk\x20not\x20found.');return _0x48d55;}static async[a273_0x2b0786(0x219)](_0x59b8dd){const _0xfa8f57=a273_0x2b0786;try{return await state_manger_1[_0xfa8f57(0x21a)]['getJobState'](path_1['default'][_0xfa8f57(0x1e7)](RetrieveMetadataService['retrieveMetadataFolder'],_0x59b8dd));}catch(_0x4dd085){throw new not_found_error_1['NotFoundError'](_0x4dd085);}}static async[a273_0x2b0786(0x208)](_0x32fab0){const _0x5cda1b=a273_0x2b0786,_0x25e22b=path_1[_0x5cda1b(0x21a)][_0x5cda1b(0x1e7)](RetrieveMetadataService[_0x5cda1b(0x1e0)],_0x32fab0,job_1[_0x5cda1b(0x1f0)]);if(await utils_1[_0x5cda1b(0x1f3)][_0x5cda1b(0x1e6)](_0x25e22b))return(0x0,promises_1[_0x5cda1b(0x1e2)])(_0x25e22b,_0x5cda1b(0x20c))['then'](_0x301223=>csv_utils_1[_0x5cda1b(0x21a)][_0x5cda1b(0x20b)](_0x301223,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x5cda1b(0x21c));}}function a273_0xeaa5(){const _0x37be6e=['parse','utf-8','makeDir','Result\x20not\x20found.','data','JobStatus','slice','621173MmqEzd','4633130rSXFMi','../job/classes/manifest-manger','4013888kJMxNX','search','2bboMzs','../../shared/utils/fs.utils','getJobStatus','default','JOB_PATH','Job\x20log\x20not\x20found.','.json','3266379EAPVFQ','6BymvIi','runJob','retrieveMetadataFolder','path','readFile','../../../core/errors/not-found.error','getJobState','5Eyvfrs','isExistsPath','join','RETRIEVE_RESULTS_IDS_FILENAME','push','690376NNgkUt','__importDefault','toString','8238sKHDgm','../../../configs/path','getResultChunk','JOB_LOG_DETAILS_FILENAME','getResult','dataPath','FsUtils','BadRequestError','create','createRetrieveJob','@flosum/utils','../../shared/utils/csv.utils','../../shared/utils/job.utils','(((.+)+)+)+$','../../../constants/job','getJobs','IN_PROGRESS','NotFoundError','RETRIEVE_RESULT_FOLDER_NAME','../job/classes/state-manger','RETRIEVE_METADATA_FOLDER_NAME','generateJobId','constructor','../../../core/errors/bad-request.error','catch','then','__esModule','getJobLogs','defineProperty','504498TVbSDR'];a273_0xeaa5=function(){return _0x37be6e;};return a273_0xeaa5();}exports['default']=RetrieveMetadataService,RetrieveMetadataService[a273_0x2b0786(0x1e0)]=path_1[a273_0x2b0786(0x21a)][a273_0x2b0786(0x1e7)](path_2[a273_0x2b0786(0x1f2)],constants_1[a273_0x2b0786(0x201)]);