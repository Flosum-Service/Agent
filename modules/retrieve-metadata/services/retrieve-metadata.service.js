function a273_0x3871(_0x16cbeb,_0x34c5f2){const _0x298f18=a273_0x5176();return a273_0x3871=function(_0x3056ba,_0x558ed9){_0x3056ba=_0x3056ba-0xd3;let _0x5176e4=_0x298f18[_0x3056ba];return _0x5176e4;},a273_0x3871(_0x16cbeb,_0x34c5f2);}const a273_0x3489ca=a273_0x3871;function a273_0x5176(){const _0x3d414a=['setError','join','createRetrieveJob','getResult','350798IjJPDn','1405515hqgUfl','../../../configs/path','retrieveMetadataFolder','36MQWykS','JobStatus','default','514656lcAiZZ','(((.+)+)+)+$','defineProperty','../../shared/utils/fs.utils','then','12aqnIqF','724984VGHAmJ','search','../job/classes/manifest-manger','../../../constants/job','isExistsPath','apply','data','parse','sortJobsIds','runJob','../../shared/utils/job.utils','Job\x20not\x20completed.','../../shared/utils/csv.utils','86628lfLvyr','../job/classes/state-manger','getJobs','create','FsUtils','__esModule','NotFoundError','getResultChunk','init','IN_PROGRESS','8448410iXrGbw','utf-8','16870WOsxdi','getJobState','toString','dataPath','Job\x20log\x20not\x20found.','getJobLogs','../../../core/errors/bad-request.error','.json','path','RETRIEVE_METADATA_FOLDER_NAME','slice','push','288fJPIuQ','readFile','@flosum/utils','getJobStatus','fs/promises','BadRequestError','Result\x20not\x20found.','RETRIEVE_RESULTS_IDS_FILENAME','makeDir'];a273_0x5176=function(){return _0x3d414a;};return a273_0x5176();}(function(_0x4cc400,_0x15cb56){const _0x5f030b=a273_0x3871,_0x342039=_0x4cc400();while(!![]){try{const _0x1c1223=parseInt(_0x5f030b(0xf9))/0x1+parseInt(_0x5f030b(0xd4))/0x2*(-parseInt(_0x5f030b(0x105))/0x3)+-parseInt(_0x5f030b(0x106))/0x4+-parseInt(_0x5f030b(0xfa))/0x5+parseInt(_0x5f030b(0xec))/0x6*(-parseInt(_0x5f030b(0xe0))/0x7)+-parseInt(_0x5f030b(0x100))/0x8*(parseInt(_0x5f030b(0xfd))/0x9)+parseInt(_0x5f030b(0xde))/0xa;if(_0x1c1223===_0x15cb56)break;else _0x342039['push'](_0x342039['shift']());}catch(_0x16b5e5){_0x342039['push'](_0x342039['shift']());}}}(a273_0x5176,0x2da92));const a273_0x558ed9=(function(){let _0x542648=!![];return function(_0x50f47a,_0x2e26cc){const _0x1aa73e=_0x542648?function(){const _0x33e1de=a273_0x3871;if(_0x2e26cc){const _0x3a2815=_0x2e26cc[_0x33e1de(0x10b)](_0x50f47a,arguments);return _0x2e26cc=null,_0x3a2815;}}:function(){};return _0x542648=![],_0x1aa73e;};}()),a273_0x3056ba=a273_0x558ed9(this,function(){const _0x6541cf=a273_0x3871;return a273_0x3056ba[_0x6541cf(0xe2)]()['search']('(((.+)+)+)+$')[_0x6541cf(0xe2)]()['constructor'](a273_0x3056ba)[_0x6541cf(0x107)](_0x6541cf(0x101));});a273_0x3056ba();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x74dc9a){return _0x74dc9a&&_0x74dc9a['__esModule']?_0x74dc9a:{'default':_0x74dc9a};};Object[a273_0x3489ca(0x102)](exports,a273_0x3489ca(0xd9),{'value':!![]});const job_utils_1=__importDefault(require(a273_0x3489ca(0x110))),path_1=__importDefault(require(a273_0x3489ca(0xe8))),manifest_manger_1=__importDefault(require(a273_0x3489ca(0x108))),state_manger_1=__importDefault(require(a273_0x3489ca(0xd5))),promises_1=require(a273_0x3489ca(0xf0)),utils_1=require(a273_0x3489ca(0xee)),csv_utils_1=__importDefault(require(a273_0x3489ca(0xd3))),not_found_error_1=require('../../../core/errors/not-found.error'),logger_enums_1=require('../job/enums/logger.enums'),bad_request_error_1=require(a273_0x3489ca(0xe6)),job_1=require(a273_0x3489ca(0x109)),fs_utils_1=require(a273_0x3489ca(0x103)),constants_1=require('../constants'),path_2=require(a273_0x3489ca(0xfb));class RetrieveMetadataService{static async[a273_0x3489ca(0xd6)](_0x15a6bd,_0x56591d){const _0xdfa75c=a273_0x3489ca,_0x32c41f=await job_utils_1[_0xdfa75c(0xff)]['getJobsIds'](RetrieveMetadataService[_0xdfa75c(0xfc)]),_0x3b1254=await job_utils_1[_0xdfa75c(0xff)][_0xdfa75c(0x10e)](RetrieveMetadataService[_0xdfa75c(0xfc)],_0x32c41f),_0x3e00d7=_0x3b1254[_0xdfa75c(0xea)](_0x56591d,_0x56591d+_0x15a6bd),_0x5dd308=[];for(const _0x3e6a91 of _0x3e00d7){const _0xd7e877=await state_manger_1[_0xdfa75c(0xff)][_0xdfa75c(0xe1)](path_1[_0xdfa75c(0xff)][_0xdfa75c(0xf6)](RetrieveMetadataService[_0xdfa75c(0xfc)],_0x3e6a91));_0x5dd308[_0xdfa75c(0xeb)](_0xd7e877);}return _0x5dd308;}static async[a273_0x3489ca(0xf7)](_0x5ce6d7){const _0x3927ee=a273_0x3489ca,_0x3b97a0=job_utils_1[_0x3927ee(0xff)]['generateJobId'](),_0x529026=path_1[_0x3927ee(0xff)][_0x3927ee(0xf6)](RetrieveMetadataService[_0x3927ee(0xfc)],_0x3b97a0);await(0x0,fs_utils_1[_0x3927ee(0xf4)])(_0x529026),await manifest_manger_1[_0x3927ee(0xff)][_0x3927ee(0xd7)](_0x529026,_0x5ce6d7),await state_manger_1[_0x3927ee(0xff)][_0x3927ee(0xd7)](_0x529026,_0x3b97a0);const _0x202237=path_1[_0x3927ee(0xff)][_0x3927ee(0xf6)](__dirname,job_1['JOB_PATH']);return job_utils_1[_0x3927ee(0xff)][_0x3927ee(0x10f)](_0x202237,{'jobStorePath':_0x529026,'jobId':_0x3b97a0})['catch'](async _0x5bd87e=>{const _0x2a2673=_0x3927ee,_0x58b3ab=new state_manger_1[(_0x2a2673(0xff))](_0x529026);await _0x58b3ab[_0x2a2673(0xdc)](),await _0x58b3ab[_0x2a2673(0xf5)](_0x5bd87e);}),{'jobId':_0x3b97a0};}static async[a273_0x3489ca(0xf8)](_0x34fc7c){const _0x6c5ba9=a273_0x3489ca,{status:_0x27bccd}=await RetrieveMetadataService['getJobStatus'](_0x34fc7c);if(_0x27bccd===logger_enums_1[_0x6c5ba9(0xfe)][_0x6c5ba9(0xdd)])throw new bad_request_error_1[(_0x6c5ba9(0xf1))](_0x6c5ba9(0x111));const _0x39dec8=path_1[_0x6c5ba9(0xff)][_0x6c5ba9(0xf6)](RetrieveMetadataService['retrieveMetadataFolder'],_0x34fc7c,constants_1[_0x6c5ba9(0xf3)]);if(await utils_1['FsUtils'][_0x6c5ba9(0x10a)](_0x39dec8))return(0x0,promises_1[_0x6c5ba9(0xed)])(_0x39dec8,_0x6c5ba9(0xdf))[_0x6c5ba9(0x104)](JSON['parse']);else throw new not_found_error_1['NotFoundError'](_0x6c5ba9(0xf2));}static async[a273_0x3489ca(0xdb)](_0x52d073,_0x59b6d5){const _0x189d49=a273_0x3489ca,{status:_0x45cc0b}=await RetrieveMetadataService[_0x189d49(0xef)](_0x52d073);if(_0x45cc0b===logger_enums_1[_0x189d49(0xfe)][_0x189d49(0xdd)])throw new bad_request_error_1[(_0x189d49(0xf1))]('Job\x20not\x20completed.');const _0x1dda00=path_1[_0x189d49(0xff)][_0x189d49(0xf6)](RetrieveMetadataService['retrieveMetadataFolder'],_0x52d073,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x126e19={'data':[]};if(await utils_1[_0x189d49(0xd8)]['isExistsPath'](path_1[_0x189d49(0xff)]['join'](_0x1dda00,_0x59b6d5+_0x189d49(0xe7))))_0x126e19[_0x189d49(0x10c)]=await(0x0,promises_1[_0x189d49(0xed)])(path_1[_0x189d49(0xff)][_0x189d49(0xf6)](_0x1dda00,_0x59b6d5+_0x189d49(0xe7)),_0x189d49(0xdf))[_0x189d49(0x104)](JSON['parse']);else throw new not_found_error_1[(_0x189d49(0xda))]('Chunk\x20not\x20found.');return _0x126e19;}static async['getJobStatus'](_0x1b9a4a){const _0x260f35=a273_0x3489ca;try{return await state_manger_1[_0x260f35(0xff)][_0x260f35(0xe1)](path_1[_0x260f35(0xff)]['join'](RetrieveMetadataService[_0x260f35(0xfc)],_0x1b9a4a));}catch(_0x785f38){throw new not_found_error_1[(_0x260f35(0xda))](_0x785f38);}}static async[a273_0x3489ca(0xe5)](_0x7f534){const _0x431087=a273_0x3489ca,_0x4d3c58=path_1[_0x431087(0xff)]['join'](RetrieveMetadataService[_0x431087(0xfc)],_0x7f534,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1[_0x431087(0xd8)][_0x431087(0x10a)](_0x4d3c58))return(0x0,promises_1['readFile'])(_0x4d3c58,'utf-8')[_0x431087(0x104)](_0x3e6ff7=>csv_utils_1['default'][_0x431087(0x10d)](_0x3e6ff7,{'columns':!![]}));throw new not_found_error_1[(_0x431087(0xda))](_0x431087(0xe4));}}exports[a273_0x3489ca(0xff)]=RetrieveMetadataService,RetrieveMetadataService[a273_0x3489ca(0xfc)]=path_1['default']['join'](path_2[a273_0x3489ca(0xe3)],constants_1[a273_0x3489ca(0xe9)]);