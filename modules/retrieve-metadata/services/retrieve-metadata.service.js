const a277_0x5d3fa5=a277_0x243f;(function(_0xe1f047,_0x2e7abf){const _0x19f8d4=a277_0x243f,_0x38196b=_0xe1f047();while(!![]){try{const _0x7184f=-parseInt(_0x19f8d4(0xb8))/0x1*(-parseInt(_0x19f8d4(0xad))/0x2)+parseInt(_0x19f8d4(0x91))/0x3*(-parseInt(_0x19f8d4(0xa2))/0x4)+-parseInt(_0x19f8d4(0xbb))/0x5*(parseInt(_0x19f8d4(0xb1))/0x6)+-parseInt(_0x19f8d4(0xb9))/0x7+parseInt(_0x19f8d4(0x8b))/0x8+-parseInt(_0x19f8d4(0x8a))/0x9+parseInt(_0x19f8d4(0xa7))/0xa;if(_0x7184f===_0x2e7abf)break;else _0x38196b['push'](_0x38196b['shift']());}catch(_0x4f0576){_0x38196b['push'](_0x38196b['shift']());}}}(a277_0x5068,0xafcc6));const a277_0x5af209=(function(){let _0x4ea63e=!![];return function(_0x18a3c2,_0x2f80a2){const _0x30a7fe=_0x4ea63e?function(){const _0x459f96=a277_0x243f;if(_0x2f80a2){const _0x36fa8e=_0x2f80a2[_0x459f96(0xa8)](_0x18a3c2,arguments);return _0x2f80a2=null,_0x36fa8e;}}:function(){};return _0x4ea63e=![],_0x30a7fe;};}()),a277_0x4a306e=a277_0x5af209(this,function(){const _0x101e8d=a277_0x243f;return a277_0x4a306e['toString']()[_0x101e8d(0x9c)](_0x101e8d(0xaf))[_0x101e8d(0x98)]()['constructor'](a277_0x4a306e)[_0x101e8d(0x9c)](_0x101e8d(0xaf));});a277_0x4a306e();'use strict';function a277_0x5068(){const _0x5d60e8=['defineProperty','getJobLogs','../../../core/errors/not-found.error','sortJobsIds','../../shared/utils/csv.utils','944xysYSH','9686439RVadzz','data','2276915MgLkLW','dataPath','Job\x20log\x20not\x20found.','generateJobId','FsUtils','../constants','../../../configs/path','IN_PROGRESS','retrieveMetadataFolder','4219803SiXXrV','6919296TbpeiP','.json','slice','getResultChunk','then','setError','11019jZcrfI','createRetrieveJob','isExistsPath','parse','fs/promises','path','NotFoundError','toString','../../shared/managers/state-manger','Result\x20not\x20found.','init','search','getJobStatus','../job/classes/manifest-manger','JOB_PATH','Job\x20not\x20completed.','readFile','984bTzZFp','create','utf-8','RETRIEVE_RESULT_FOLDER_NAME','BadRequestError','17508070JwRoOr','apply','RETRIEVE_METADATA_FOLDER_NAME','__importDefault','RETRIEVE_RESULTS_IDS_FILENAME','default','2788zDKvZD','join','(((.+)+)+)+$','../../shared/utils/fs.utils','6azYlmc','../../shared/enums/logger.enums'];a277_0x5068=function(){return _0x5d60e8;};return a277_0x5068();}var __importDefault=this&&this[a277_0x5d3fa5(0xaa)]||function(_0x6d868e){return _0x6d868e&&_0x6d868e['__esModule']?_0x6d868e:{'default':_0x6d868e};};Object[a277_0x5d3fa5(0xb3)](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require(a277_0x5d3fa5(0x96))),manifest_manger_1=__importDefault(require(a277_0x5d3fa5(0x9e))),state_manger_1=__importDefault(require(a277_0x5d3fa5(0x99))),promises_1=require(a277_0x5d3fa5(0x95)),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a277_0x5d3fa5(0xb7))),not_found_error_1=require(a277_0x5d3fa5(0xb5)),logger_enums_1=require(a277_0x5d3fa5(0xb2)),bad_request_error_1=require('../../../core/errors/bad-request.error'),job_1=require('../../../constants/job'),fs_utils_1=require(a277_0x5d3fa5(0xb0)),constants_1=require(a277_0x5d3fa5(0xc0)),path_2=require(a277_0x5d3fa5(0xc1));function a277_0x243f(_0x3216c6,_0x517331){const _0x5bf5c9=a277_0x5068();return a277_0x243f=function(_0x4a306e,_0x5af209){_0x4a306e=_0x4a306e-0x8a;let _0x50689c=_0x5bf5c9[_0x4a306e];return _0x50689c;},a277_0x243f(_0x3216c6,_0x517331);}class RetrieveMetadataService{static async['getJobs'](_0x2ecb37,_0x153a27){const _0x3bfe01=a277_0x5d3fa5,_0x3f7308=await job_utils_1[_0x3bfe01(0xac)]['getJobsIds'](RetrieveMetadataService[_0x3bfe01(0xc3)]),_0x10dd10=await job_utils_1[_0x3bfe01(0xac)][_0x3bfe01(0xb6)](RetrieveMetadataService[_0x3bfe01(0xc3)],_0x3f7308),_0x494d49=_0x10dd10[_0x3bfe01(0x8d)](_0x153a27,_0x153a27+_0x2ecb37),_0x5ad54d=[];for(const _0x1b8d61 of _0x494d49){const _0x443f4d=await state_manger_1[_0x3bfe01(0xac)]['getJobState'](path_1[_0x3bfe01(0xac)][_0x3bfe01(0xae)](RetrieveMetadataService[_0x3bfe01(0xc3)],_0x1b8d61));_0x5ad54d['push'](_0x443f4d);}return _0x5ad54d;}static async[a277_0x5d3fa5(0x92)](_0x552499){const _0x737cd7=a277_0x5d3fa5,_0x4d8683=job_utils_1[_0x737cd7(0xac)][_0x737cd7(0xbe)](),_0x1043c9=path_1[_0x737cd7(0xac)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x4d8683);await(0x0,fs_utils_1['makeDir'])(_0x1043c9),await manifest_manger_1[_0x737cd7(0xac)][_0x737cd7(0xa3)](_0x1043c9,_0x552499),await state_manger_1['default']['create'](_0x1043c9,_0x4d8683);const _0x2a66d5=path_1['default'][_0x737cd7(0xae)](__dirname,job_1[_0x737cd7(0x9f)]);return job_utils_1[_0x737cd7(0xac)]['runJob'](_0x2a66d5,{'jobStorePath':_0x1043c9,'jobId':_0x4d8683})['catch'](async _0x1ef035=>{const _0x5eb75a=_0x737cd7,_0x58ec60=new state_manger_1['default'](_0x1043c9);await _0x58ec60[_0x5eb75a(0x9b)](),await _0x58ec60[_0x5eb75a(0x90)](_0x1ef035);}),{'jobId':_0x4d8683};}static async['getResult'](_0x2fa304){const _0x1f330a=a277_0x5d3fa5,{status:_0x5a3e46}=await RetrieveMetadataService['getJobStatus'](_0x2fa304);if(_0x5a3e46===logger_enums_1['JobStatus'][_0x1f330a(0xc2)])throw new bad_request_error_1[(_0x1f330a(0xa6))](_0x1f330a(0xa0));const _0x21d56d=path_1[_0x1f330a(0xac)]['join'](RetrieveMetadataService[_0x1f330a(0xc3)],_0x2fa304,constants_1[_0x1f330a(0xab)]);if(await utils_1[_0x1f330a(0xbf)]['isExistsPath'](_0x21d56d))return(0x0,promises_1[_0x1f330a(0xa1)])(_0x21d56d,_0x1f330a(0xa4))[_0x1f330a(0x8f)](JSON[_0x1f330a(0x94)]);else throw new not_found_error_1['NotFoundError'](_0x1f330a(0x9a));}static async[a277_0x5d3fa5(0x8e)](_0x1319a8,_0x5c2256){const _0x406059=a277_0x5d3fa5,{status:_0x46a59d}=await RetrieveMetadataService[_0x406059(0x9d)](_0x1319a8);if(_0x46a59d===logger_enums_1['JobStatus'][_0x406059(0xc2)])throw new bad_request_error_1['BadRequestError'](_0x406059(0xa0));const _0x1a34c6=path_1[_0x406059(0xac)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x1319a8,constants_1[_0x406059(0xa5)]),_0x36879c={'data':[]};if(await utils_1[_0x406059(0xbf)][_0x406059(0x93)](path_1['default'][_0x406059(0xae)](_0x1a34c6,_0x5c2256+'.json')))_0x36879c[_0x406059(0xba)]=await(0x0,promises_1[_0x406059(0xa1)])(path_1[_0x406059(0xac)][_0x406059(0xae)](_0x1a34c6,_0x5c2256+_0x406059(0x8c)),_0x406059(0xa4))['then'](JSON[_0x406059(0x94)]);else throw new not_found_error_1[(_0x406059(0x97))]('Chunk\x20not\x20found.');return _0x36879c;}static async[a277_0x5d3fa5(0x9d)](_0x4e7ded){const _0x63795c=a277_0x5d3fa5;try{return await state_manger_1['default']['getJobState'](path_1[_0x63795c(0xac)][_0x63795c(0xae)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4e7ded));}catch(_0x18cee3){throw new not_found_error_1[(_0x63795c(0x97))](_0x18cee3);}}static async[a277_0x5d3fa5(0xb4)](_0x4577ac){const _0x1244bc=a277_0x5d3fa5,_0x70da5a=path_1[_0x1244bc(0xac)][_0x1244bc(0xae)](RetrieveMetadataService[_0x1244bc(0xc3)],_0x4577ac,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1[_0x1244bc(0xbf)][_0x1244bc(0x93)](_0x70da5a))return(0x0,promises_1[_0x1244bc(0xa1)])(_0x70da5a,_0x1244bc(0xa4))[_0x1244bc(0x8f)](_0x9d4e3f=>csv_utils_1[_0x1244bc(0xac)][_0x1244bc(0x94)](_0x9d4e3f,{'columns':!![]}));throw new not_found_error_1[(_0x1244bc(0x97))](_0x1244bc(0xbd));}}exports['default']=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1[a277_0x5d3fa5(0xac)][a277_0x5d3fa5(0xae)](path_2[a277_0x5d3fa5(0xbc)],constants_1[a277_0x5d3fa5(0xa9)]);