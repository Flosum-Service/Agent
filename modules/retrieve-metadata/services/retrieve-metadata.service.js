function a277_0x288c(){const _0x5d35c2=['../constants','JOB_LOG_DETAILS_FILENAME','toString','getJobStatus','RETRIEVE_METADATA_FOLDER_NAME','@flosum/utils','NotFoundError','(((.+)+)+)+$','IN_PROGRESS','JobStatus','data','runJob','FsUtils','isExistsPath','then','2018533UqsDLr','../../shared/enums/logger.enums','1959CCSSIs','getResultChunk','../../shared/managers/state-manger','1614trRiIj','search','../../shared/utils/csv.utils','../../../configs/path','getResult','BadRequestError','defineProperty','10ReTsPf','dataPath','2228988JKENbD','../../../core/errors/not-found.error','__importDefault','push','utf-8','generateJobId','fs/promises','3332466vSiBhX','JOB_PATH','setError','1632RJVrcR','retrieveMetadataFolder','constructor','../../../core/errors/bad-request.error','default','getJobLogs','path','.json','../../shared/utils/fs.utils','readFile','../../shared/utils/job.utils','create','Chunk\x20not\x20found.','getJobState','catch','RETRIEVE_RESULTS_IDS_FILENAME','sortJobsIds','2601285pKgEUV','getJobsIds','../job/classes/manifest-manger','Job\x20not\x20completed.','parse','join','getJobs','Result\x20not\x20found.','987dmRLgx','9755080NTjehd','3PLjyWC','__esModule'];a277_0x288c=function(){return _0x5d35c2;};return a277_0x288c();}function a277_0x2ead(_0x5e0965,_0x301c4c){const _0x10dd96=a277_0x288c();return a277_0x2ead=function(_0x4697b1,_0x113418){_0x4697b1=_0x4697b1-0x1f0;let _0x288c8f=_0x10dd96[_0x4697b1];return _0x288c8f;},a277_0x2ead(_0x5e0965,_0x301c4c);}const a277_0x21a0f6=a277_0x2ead;(function(_0x70fcf0,_0x4f91fa){const _0x38067f=a277_0x2ead,_0x346a6a=_0x70fcf0();while(!![]){try{const _0x28a8fb=parseInt(_0x38067f(0x212))/0x1*(parseInt(_0x38067f(0x215))/0x2)+-parseInt(_0x38067f(0x1ff))/0x3*(parseInt(_0x38067f(0x21e))/0x4)+parseInt(_0x38067f(0x1f5))/0x5+-parseInt(_0x38067f(0x228))/0x6*(parseInt(_0x38067f(0x1fd))/0x7)+-parseInt(_0x38067f(0x1fe))/0x8+parseInt(_0x38067f(0x225))/0x9+-parseInt(_0x38067f(0x21c))/0xa*(-parseInt(_0x38067f(0x210))/0xb);if(_0x28a8fb===_0x4f91fa)break;else _0x346a6a['push'](_0x346a6a['shift']());}catch(_0x4fedfb){_0x346a6a['push'](_0x346a6a['shift']());}}}(a277_0x288c,0xcd11b));const a277_0x113418=(function(){let _0xee8e8c=!![];return function(_0x1003a0,_0x658249){const _0x4b07a3=_0xee8e8c?function(){if(_0x658249){const _0x184c54=_0x658249['apply'](_0x1003a0,arguments);return _0x658249=null,_0x184c54;}}:function(){};return _0xee8e8c=![],_0x4b07a3;};}()),a277_0x4697b1=a277_0x113418(this,function(){const _0x5b9ff2=a277_0x2ead;return a277_0x4697b1['toString']()[_0x5b9ff2(0x216)]('(((.+)+)+)+$')[_0x5b9ff2(0x203)]()[_0x5b9ff2(0x22a)](a277_0x4697b1)[_0x5b9ff2(0x216)](_0x5b9ff2(0x208));});a277_0x4697b1();'use strict';var __importDefault=this&&this[a277_0x21a0f6(0x220)]||function(_0x4f0460){const _0x40fc7f=a277_0x21a0f6;return _0x4f0460&&_0x4f0460[_0x40fc7f(0x200)]?_0x4f0460:{'default':_0x4f0460};};Object[a277_0x21a0f6(0x21b)](exports,'__esModule',{'value':!![]});const job_utils_1=__importDefault(require(a277_0x21a0f6(0x232))),path_1=__importDefault(require(a277_0x21a0f6(0x22e))),manifest_manger_1=__importDefault(require(a277_0x21a0f6(0x1f7))),state_manger_1=__importDefault(require(a277_0x21a0f6(0x214))),promises_1=require(a277_0x21a0f6(0x224)),utils_1=require(a277_0x21a0f6(0x206)),csv_utils_1=__importDefault(require(a277_0x21a0f6(0x217))),not_found_error_1=require(a277_0x21a0f6(0x21f)),logger_enums_1=require(a277_0x21a0f6(0x211)),bad_request_error_1=require(a277_0x21a0f6(0x22b)),job_1=require('../../../constants/job'),fs_utils_1=require(a277_0x21a0f6(0x230)),constants_1=require(a277_0x21a0f6(0x201)),path_2=require(a277_0x21a0f6(0x218));class RetrieveMetadataService{static async[a277_0x21a0f6(0x1fb)](_0x561c51,_0x356c27){const _0x1f6d69=a277_0x21a0f6,_0x14d5c6=await job_utils_1[_0x1f6d69(0x22c)][_0x1f6d69(0x1f6)](RetrieveMetadataService['retrieveMetadataFolder']),_0x311563=await job_utils_1[_0x1f6d69(0x22c)][_0x1f6d69(0x1f4)](RetrieveMetadataService[_0x1f6d69(0x229)],_0x14d5c6),_0x5a1797=_0x311563['slice'](_0x356c27,_0x356c27+_0x561c51),_0x56d924=[];for(const _0x7d25b3 of _0x5a1797){const _0xf92d95=await state_manger_1[_0x1f6d69(0x22c)][_0x1f6d69(0x1f1)](path_1[_0x1f6d69(0x22c)]['join'](RetrieveMetadataService[_0x1f6d69(0x229)],_0x7d25b3));_0x56d924[_0x1f6d69(0x221)](_0xf92d95);}return _0x56d924;}static async['createRetrieveJob'](_0x263846){const _0x114a48=a277_0x21a0f6,_0x1efe76=job_utils_1[_0x114a48(0x22c)][_0x114a48(0x223)](),_0x460bfa=path_1[_0x114a48(0x22c)][_0x114a48(0x1fa)](RetrieveMetadataService['retrieveMetadataFolder'],_0x1efe76);await(0x0,fs_utils_1['makeDir'])(_0x460bfa),await manifest_manger_1['default'][_0x114a48(0x233)](_0x460bfa,_0x263846),await state_manger_1[_0x114a48(0x22c)][_0x114a48(0x233)](_0x460bfa,_0x1efe76);const _0x40e157=path_1[_0x114a48(0x22c)]['join'](__dirname,job_1[_0x114a48(0x226)]);return job_utils_1[_0x114a48(0x22c)][_0x114a48(0x20c)](_0x40e157,{'jobStorePath':_0x460bfa,'jobId':_0x1efe76})[_0x114a48(0x1f2)](async _0xb05949=>{const _0x3471a1=_0x114a48,_0x13ae34=new state_manger_1[(_0x3471a1(0x22c))](_0x460bfa);await _0x13ae34['init'](),await _0x13ae34[_0x3471a1(0x227)](_0xb05949);}),{'jobId':_0x1efe76};}static async[a277_0x21a0f6(0x219)](_0x436cbe){const _0x4ac7f1=a277_0x21a0f6,{status:_0x5cab8a}=await RetrieveMetadataService[_0x4ac7f1(0x204)](_0x436cbe);if(_0x5cab8a===logger_enums_1[_0x4ac7f1(0x20a)][_0x4ac7f1(0x209)])throw new bad_request_error_1[(_0x4ac7f1(0x21a))](_0x4ac7f1(0x1f8));const _0x364c8e=path_1[_0x4ac7f1(0x22c)][_0x4ac7f1(0x1fa)](RetrieveMetadataService[_0x4ac7f1(0x229)],_0x436cbe,constants_1[_0x4ac7f1(0x1f3)]);if(await utils_1['FsUtils'][_0x4ac7f1(0x20e)](_0x364c8e))return(0x0,promises_1[_0x4ac7f1(0x231)])(_0x364c8e,'utf-8')['then'](JSON[_0x4ac7f1(0x1f9)]);else throw new not_found_error_1[(_0x4ac7f1(0x207))](_0x4ac7f1(0x1fc));}static async[a277_0x21a0f6(0x213)](_0x5fbcfe,_0x109dea){const _0x454017=a277_0x21a0f6,{status:_0x351127}=await RetrieveMetadataService['getJobStatus'](_0x5fbcfe);if(_0x351127===logger_enums_1['JobStatus'][_0x454017(0x209)])throw new bad_request_error_1[(_0x454017(0x21a))](_0x454017(0x1f8));const _0x40a366=path_1[_0x454017(0x22c)][_0x454017(0x1fa)](RetrieveMetadataService[_0x454017(0x229)],_0x5fbcfe,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x482699={'data':[]};if(await utils_1[_0x454017(0x20d)][_0x454017(0x20e)](path_1[_0x454017(0x22c)]['join'](_0x40a366,_0x109dea+'.json')))_0x482699[_0x454017(0x20b)]=await(0x0,promises_1[_0x454017(0x231)])(path_1[_0x454017(0x22c)][_0x454017(0x1fa)](_0x40a366,_0x109dea+_0x454017(0x22f)),_0x454017(0x222))['then'](JSON[_0x454017(0x1f9)]);else throw new not_found_error_1[(_0x454017(0x207))](_0x454017(0x1f0));return _0x482699;}static async[a277_0x21a0f6(0x204)](_0x30f083){const _0x2fcb18=a277_0x21a0f6;try{return await state_manger_1[_0x2fcb18(0x22c)][_0x2fcb18(0x1f1)](path_1[_0x2fcb18(0x22c)][_0x2fcb18(0x1fa)](RetrieveMetadataService[_0x2fcb18(0x229)],_0x30f083));}catch(_0x29abdb){throw new not_found_error_1[(_0x2fcb18(0x207))](_0x29abdb);}}static async[a277_0x21a0f6(0x22d)](_0x16c407){const _0x8584e4=a277_0x21a0f6,_0x26d85c=path_1[_0x8584e4(0x22c)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x16c407,job_1[_0x8584e4(0x202)]);if(await utils_1[_0x8584e4(0x20d)]['isExistsPath'](_0x26d85c))return(0x0,promises_1[_0x8584e4(0x231)])(_0x26d85c,_0x8584e4(0x222))[_0x8584e4(0x20f)](_0x7221f8=>csv_utils_1[_0x8584e4(0x22c)][_0x8584e4(0x1f9)](_0x7221f8,{'columns':!![]}));throw new not_found_error_1[(_0x8584e4(0x207))]('Job\x20log\x20not\x20found.');}}exports[a277_0x21a0f6(0x22c)]=RetrieveMetadataService,RetrieveMetadataService['retrieveMetadataFolder']=path_1['default'][a277_0x21a0f6(0x1fa)](path_2[a277_0x21a0f6(0x21d)],constants_1[a277_0x21a0f6(0x205)]);