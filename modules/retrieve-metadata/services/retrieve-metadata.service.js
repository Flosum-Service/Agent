const a321_0x4ce813=a321_0x5d5c;(function(_0x44955f,_0x5cf11f){const _0x310ed8=a321_0x5d5c,_0x18ad28=_0x44955f();while(!![]){try{const _0x5860b1=parseInt(_0x310ed8(0x194))/0x1+parseInt(_0x310ed8(0x1b0))/0x2*(parseInt(_0x310ed8(0x198))/0x3)+-parseInt(_0x310ed8(0x1b4))/0x4+parseInt(_0x310ed8(0x1c9))/0x5+-parseInt(_0x310ed8(0x1ac))/0x6*(parseInt(_0x310ed8(0x1bc))/0x7)+parseInt(_0x310ed8(0x18b))/0x8*(parseInt(_0x310ed8(0x1a3))/0x9)+parseInt(_0x310ed8(0x1a7))/0xa*(-parseInt(_0x310ed8(0x19d))/0xb);if(_0x5860b1===_0x5cf11f)break;else _0x18ad28['push'](_0x18ad28['shift']());}catch(_0x460385){_0x18ad28['push'](_0x18ad28['shift']());}}}(a321_0x1fab,0xceff2));function a321_0x5d5c(_0x49f644,_0x2709c5){const _0x1c758=a321_0x1fab();return a321_0x5d5c=function(_0xda2351,_0x450eb0){_0xda2351=_0xda2351-0x186;let _0x1fabab=_0x1c758[_0xda2351];return _0x1fabab;},a321_0x5d5c(_0x49f644,_0x2709c5);}const a321_0x450eb0=(function(){let _0x30ca6e=!![];return function(_0x27df30,_0x10c931){const _0x1589cd=_0x30ca6e?function(){const _0x5e369e=a321_0x5d5c;if(_0x10c931){const _0x4efcee=_0x10c931[_0x5e369e(0x1c0)](_0x27df30,arguments);return _0x10c931=null,_0x4efcee;}}:function(){};return _0x30ca6e=![],_0x1589cd;};}()),a321_0xda2351=a321_0x450eb0(this,function(){const _0x2a00fd=a321_0x5d5c;return a321_0xda2351[_0x2a00fd(0x1b1)]()[_0x2a00fd(0x1cb)](_0x2a00fd(0x187))[_0x2a00fd(0x1b1)]()[_0x2a00fd(0x1b3)](a321_0xda2351)[_0x2a00fd(0x1cb)](_0x2a00fd(0x187));});a321_0xda2351();'use strict';var __importDefault=this&&this[a321_0x4ce813(0x193)]||function(_0x4e813a){return _0x4e813a&&_0x4e813a['__esModule']?_0x4e813a:{'default':_0x4e813a};};Object[a321_0x4ce813(0x188)](exports,a321_0x4ce813(0x1ad),{'value':!![]});function a321_0x1fab(){const _0xc85971=['parse','apply','RETRIEVE_METADATA_FOLDER_NAME','createRetrieveJob','getResult','create','path','getJobStatus','dataPath','JobStatus','1602380YTPvEH','getJobState','search','data','(((.+)+)+)+$','defineProperty','generateJobId','.json','7704LqPxUv','makeDir','../../../constants/job','default','../../../core/errors/bad-request.error','IN_PROGRESS','../../../configs/path','JOB_LOG_DETAILS_FILENAME','__importDefault','858214dLOiuX','utf-8','../job/classes/manifest-manger','readFile','39072PTnpBf','getResultChunk','Job\x20not\x20completed.','../constants','RETRIEVE_RESULTS_IDS_FILENAME','66biGykN','BadRequestError','JOB_PATH','getJobsIds','join','init','11853mdmaWF','NotFoundError','../../shared/utils/job.utils','then','1447990JHXCkx','Job\x20log\x20not\x20found.','catch','FsUtils','RETRIEVE_RESULT_FOLDER_NAME','24wpyeXl','__esModule','../../../core/errors/not-found.error','getJobLogs','156RxMuBO','toString','retrieveMetadataFolder','constructor','5589332fyIJgJ','getJobs','../../shared/utils/fs.utils','sortJobsIds','../../shared/managers/state-manger','runJob','../../shared/utils/csv.utils','isExistsPath','610484YcFOWh','Result\x20not\x20found.','push'];a321_0x1fab=function(){return _0xc85971;};return a321_0x1fab();}const job_utils_1=__importDefault(require(a321_0x4ce813(0x1a5))),path_1=__importDefault(require(a321_0x4ce813(0x1c5))),manifest_manger_1=__importDefault(require(a321_0x4ce813(0x196))),state_manger_1=__importDefault(require(a321_0x4ce813(0x1b8))),promises_1=require('fs/promises'),utils_1=require('@flosum/utils'),csv_utils_1=__importDefault(require(a321_0x4ce813(0x1ba))),not_found_error_1=require(a321_0x4ce813(0x1ae)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require(a321_0x4ce813(0x18f)),job_1=require(a321_0x4ce813(0x18d)),fs_utils_1=require(a321_0x4ce813(0x1b6)),constants_1=require(a321_0x4ce813(0x19b)),path_2=require(a321_0x4ce813(0x191));class RetrieveMetadataService{static async[a321_0x4ce813(0x1b5)](_0x15500d,_0xc7b781){const _0x3069c8=a321_0x4ce813,_0x51860b=await job_utils_1[_0x3069c8(0x18e)][_0x3069c8(0x1a0)](RetrieveMetadataService[_0x3069c8(0x1b2)]),_0x45a83e=await job_utils_1[_0x3069c8(0x18e)][_0x3069c8(0x1b7)](RetrieveMetadataService[_0x3069c8(0x1b2)],_0x51860b),_0x291948=_0x45a83e['slice'](_0xc7b781,_0xc7b781+_0x15500d),_0x4b3570=[];for(const _0x322009 of _0x291948){const _0xa6d766=await state_manger_1[_0x3069c8(0x18e)][_0x3069c8(0x1ca)](path_1[_0x3069c8(0x18e)]['join'](RetrieveMetadataService[_0x3069c8(0x1b2)],_0x322009));_0x4b3570[_0x3069c8(0x1be)](_0xa6d766);}return _0x4b3570;}static async[a321_0x4ce813(0x1c2)](_0x395e7b){const _0x38a74a=a321_0x4ce813,_0x27b7d7=job_utils_1[_0x38a74a(0x18e)][_0x38a74a(0x189)](),_0x4ac8ee=path_1['default'][_0x38a74a(0x1a1)](RetrieveMetadataService[_0x38a74a(0x1b2)],_0x27b7d7);await(0x0,fs_utils_1[_0x38a74a(0x18c)])(_0x4ac8ee),await manifest_manger_1['default'][_0x38a74a(0x1c4)](_0x4ac8ee,_0x395e7b),await state_manger_1[_0x38a74a(0x18e)][_0x38a74a(0x1c4)](_0x4ac8ee,_0x27b7d7);const _0x1c6332=path_1[_0x38a74a(0x18e)][_0x38a74a(0x1a1)](__dirname,job_1[_0x38a74a(0x19f)]);return job_utils_1[_0x38a74a(0x18e)][_0x38a74a(0x1b9)](_0x1c6332,{'jobStorePath':_0x4ac8ee,'jobId':_0x27b7d7})[_0x38a74a(0x1a9)](async _0x6ad4e3=>{const _0x1995cb=_0x38a74a,_0x127e9d=new state_manger_1[(_0x1995cb(0x18e))](_0x4ac8ee);await _0x127e9d[_0x1995cb(0x1a2)](),await _0x127e9d['setError'](_0x6ad4e3);}),{'jobId':_0x27b7d7};}static async[a321_0x4ce813(0x1c3)](_0x4bb7e1){const _0x2f0750=a321_0x4ce813,{status:_0x4fd070}=await RetrieveMetadataService[_0x2f0750(0x1c6)](_0x4bb7e1);if(_0x4fd070===logger_enums_1['JobStatus'][_0x2f0750(0x190)])throw new bad_request_error_1['BadRequestError'](_0x2f0750(0x19a));const _0x5384a5=path_1['default'][_0x2f0750(0x1a1)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4bb7e1,constants_1[_0x2f0750(0x19c)]);if(await utils_1['FsUtils'][_0x2f0750(0x1bb)](_0x5384a5))return(0x0,promises_1['readFile'])(_0x5384a5,'utf-8')[_0x2f0750(0x1a6)](JSON[_0x2f0750(0x1bf)]);else throw new not_found_error_1[(_0x2f0750(0x1a4))](_0x2f0750(0x1bd));}static async[a321_0x4ce813(0x199)](_0x15235a,_0x32dfc9){const _0x3e1bd5=a321_0x4ce813,{status:_0x100aa4}=await RetrieveMetadataService[_0x3e1bd5(0x1c6)](_0x15235a);if(_0x100aa4===logger_enums_1[_0x3e1bd5(0x1c8)][_0x3e1bd5(0x190)])throw new bad_request_error_1[(_0x3e1bd5(0x19e))](_0x3e1bd5(0x19a));const _0x5883a6=path_1[_0x3e1bd5(0x18e)]['join'](RetrieveMetadataService[_0x3e1bd5(0x1b2)],_0x15235a,constants_1[_0x3e1bd5(0x1ab)]),_0xff32a4={'data':[]};if(await utils_1[_0x3e1bd5(0x1aa)][_0x3e1bd5(0x1bb)](path_1[_0x3e1bd5(0x18e)]['join'](_0x5883a6,_0x32dfc9+_0x3e1bd5(0x18a))))_0xff32a4[_0x3e1bd5(0x186)]=await(0x0,promises_1[_0x3e1bd5(0x197)])(path_1[_0x3e1bd5(0x18e)][_0x3e1bd5(0x1a1)](_0x5883a6,_0x32dfc9+'.json'),_0x3e1bd5(0x195))[_0x3e1bd5(0x1a6)](JSON[_0x3e1bd5(0x1bf)]);else throw new not_found_error_1[(_0x3e1bd5(0x1a4))]('Chunk\x20not\x20found.');return _0xff32a4;}static async['getJobStatus'](_0xd177a9){const _0x34bf94=a321_0x4ce813;try{return await state_manger_1[_0x34bf94(0x18e)]['getJobState'](path_1[_0x34bf94(0x18e)][_0x34bf94(0x1a1)](RetrieveMetadataService['retrieveMetadataFolder'],_0xd177a9));}catch(_0x401504){throw new not_found_error_1['NotFoundError'](_0x401504);}}static async[a321_0x4ce813(0x1af)](_0x124df5){const _0x3ff129=a321_0x4ce813,_0x3ef74a=path_1[_0x3ff129(0x18e)][_0x3ff129(0x1a1)](RetrieveMetadataService[_0x3ff129(0x1b2)],_0x124df5,job_1[_0x3ff129(0x192)]);if(await utils_1['FsUtils']['isExistsPath'](_0x3ef74a))return(0x0,promises_1[_0x3ff129(0x197)])(_0x3ef74a,'utf-8')[_0x3ff129(0x1a6)](_0xd0ab81=>csv_utils_1[_0x3ff129(0x18e)][_0x3ff129(0x1bf)](_0xd0ab81,{'columns':!![]}));throw new not_found_error_1[(_0x3ff129(0x1a4))](_0x3ff129(0x1a8));}}exports[a321_0x4ce813(0x18e)]=RetrieveMetadataService,RetrieveMetadataService[a321_0x4ce813(0x1b2)]=path_1[a321_0x4ce813(0x18e)][a321_0x4ce813(0x1a1)](path_2[a321_0x4ce813(0x1c7)],constants_1[a321_0x4ce813(0x1c1)]);