function a273_0x26f3(_0x18ef09,_0x15b2b4){const _0x3eb262=a273_0x34c3();return a273_0x26f3=function(_0x31c82d,_0x5d2170){_0x31c82d=_0x31c82d-0x67;let _0x34c38c=_0x3eb262[_0x31c82d];return _0x34c38c;},a273_0x26f3(_0x18ef09,_0x15b2b4);}const a273_0x2c1642=a273_0x26f3;(function(_0xe43197,_0x324f46){const _0x407cb8=a273_0x26f3,_0x5685c7=_0xe43197();while(!![]){try{const _0x369e41=-parseInt(_0x407cb8(0x82))/0x1+parseInt(_0x407cb8(0x71))/0x2+parseInt(_0x407cb8(0xa0))/0x3*(-parseInt(_0x407cb8(0x7d))/0x4)+-parseInt(_0x407cb8(0x7b))/0x5+-parseInt(_0x407cb8(0x9c))/0x6+-parseInt(_0x407cb8(0x68))/0x7*(-parseInt(_0x407cb8(0x6c))/0x8)+-parseInt(_0x407cb8(0x81))/0x9*(-parseInt(_0x407cb8(0x97))/0xa);if(_0x369e41===_0x324f46)break;else _0x5685c7['push'](_0x5685c7['shift']());}catch(_0x2f5f43){_0x5685c7['push'](_0x5685c7['shift']());}}}(a273_0x34c3,0x5c5ce));const a273_0x5d2170=(function(){let _0x12f1de=!![];return function(_0x5363eb,_0x8372ce){const _0x227630=_0x12f1de?function(){const _0x3d05bf=a273_0x26f3;if(_0x8372ce){const _0x386bcc=_0x8372ce[_0x3d05bf(0x8a)](_0x5363eb,arguments);return _0x8372ce=null,_0x386bcc;}}:function(){};return _0x12f1de=![],_0x227630;};}()),a273_0x31c82d=a273_0x5d2170(this,function(){const _0x3151bb=a273_0x26f3;return a273_0x31c82d['toString']()[_0x3151bb(0xa7)]('(((.+)+)+)+$')[_0x3151bb(0x9b)]()[_0x3151bb(0x83)](a273_0x31c82d)[_0x3151bb(0xa7)](_0x3151bb(0x6a));});a273_0x31c82d();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2d3308){const _0x3b7892=a273_0x26f3;return _0x2d3308&&_0x2d3308[_0x3b7892(0xa1)]?_0x2d3308:{'default':_0x2d3308};};Object[a273_0x2c1642(0x6f)](exports,a273_0x2c1642(0xa1),{'value':!![]});const job_utils_1=__importDefault(require(a273_0x2c1642(0x96))),path_1=__importDefault(require(a273_0x2c1642(0x74))),manifest_manger_1=__importDefault(require(a273_0x2c1642(0x70))),state_manger_1=__importDefault(require(a273_0x2c1642(0x80))),promises_1=require(a273_0x2c1642(0xa5)),utils_1=require(a273_0x2c1642(0x9d)),csv_utils_1=__importDefault(require(a273_0x2c1642(0x8d))),not_found_error_1=require(a273_0x2c1642(0x88)),logger_enums_1=require(a273_0x2c1642(0x7c)),bad_request_error_1=require(a273_0x2c1642(0x89)),job_1=require('../../../constants/job'),fs_utils_1=require(a273_0x2c1642(0xa8)),constants_1=require('../constants'),path_2=require(a273_0x2c1642(0xa6));function a273_0x34c3(){const _0x190d3a=['init','utf-8','default','slice','RETRIEVE_METADATA_FOLDER_NAME','../../shared/utils/job.utils','10KDOvPg','runJob','push','JOB_PATH','toString','768396KzXSlV','@flosum/utils','getJobState','.json','236874nRaoLb','__esModule','then','JOB_LOG_DETAILS_FILENAME','create','fs/promises','../../../configs/path','search','../../shared/utils/fs.utils','catch','91HcGcaA','Job\x20not\x20completed.','(((.+)+)+)+$','getJobsIds','319032JRJbpw','isExistsPath','generateJobId','defineProperty','../job/classes/manifest-manger','582836RaTFxh','retrieveMetadataFolder','getJobStatus','path','createRetrieveJob','FsUtils','NotFoundError','IN_PROGRESS','Job\x20log\x20not\x20found.','RETRIEVE_RESULTS_IDS_FILENAME','3307380IHMzEA','../job/enums/logger.enums','32GwGKSu','JobStatus','Chunk\x20not\x20found.','../job/classes/state-manger','13135545tfSUJk','469826NnAWzf','constructor','parse','BadRequestError','setError','makeDir','../../../core/errors/not-found.error','../../../core/errors/bad-request.error','apply','dataPath','getJobLogs','../../shared/utils/csv.utils','join','Result\x20not\x20found.','readFile'];a273_0x34c3=function(){return _0x190d3a;};return a273_0x34c3();}class RetrieveMetadataService{static async['getJobs'](_0x51861b,_0x2df98d){const _0x2db54c=a273_0x2c1642,_0x23e57d=await job_utils_1[_0x2db54c(0x93)][_0x2db54c(0x6b)](RetrieveMetadataService[_0x2db54c(0x72)]),_0x47415e=await job_utils_1[_0x2db54c(0x93)]['sortJobsIds'](RetrieveMetadataService[_0x2db54c(0x72)],_0x23e57d),_0x3a79fc=_0x47415e[_0x2db54c(0x94)](_0x2df98d,_0x2df98d+_0x51861b),_0x4f48e9=[];for(const _0xaad94b of _0x3a79fc){const _0x48854a=await state_manger_1[_0x2db54c(0x93)][_0x2db54c(0x9e)](path_1[_0x2db54c(0x93)][_0x2db54c(0x8e)](RetrieveMetadataService[_0x2db54c(0x72)],_0xaad94b));_0x4f48e9[_0x2db54c(0x99)](_0x48854a);}return _0x4f48e9;}static async[a273_0x2c1642(0x75)](_0x5a87b5){const _0x5b1d83=a273_0x2c1642,_0x53933d=job_utils_1['default'][_0x5b1d83(0x6e)](),_0xc2dab7=path_1['default'][_0x5b1d83(0x8e)](RetrieveMetadataService[_0x5b1d83(0x72)],_0x53933d);await(0x0,fs_utils_1[_0x5b1d83(0x87)])(_0xc2dab7),await manifest_manger_1['default'][_0x5b1d83(0xa4)](_0xc2dab7,_0x5a87b5),await state_manger_1['default']['create'](_0xc2dab7,_0x53933d);const _0x486c37=path_1[_0x5b1d83(0x93)][_0x5b1d83(0x8e)](__dirname,job_1[_0x5b1d83(0x9a)]);return job_utils_1[_0x5b1d83(0x93)][_0x5b1d83(0x98)](_0x486c37,{'jobStorePath':_0xc2dab7,'jobId':_0x53933d})[_0x5b1d83(0x67)](async _0x2d1854=>{const _0x478598=_0x5b1d83,_0x3ac113=new state_manger_1['default'](_0xc2dab7);await _0x3ac113[_0x478598(0x91)](),await _0x3ac113[_0x478598(0x86)](_0x2d1854);}),{'jobId':_0x53933d};}static async['getResult'](_0x3619c4){const _0x36c544=a273_0x2c1642,{status:_0x2d433d}=await RetrieveMetadataService[_0x36c544(0x73)](_0x3619c4);if(_0x2d433d===logger_enums_1['JobStatus'][_0x36c544(0x78)])throw new bad_request_error_1[(_0x36c544(0x85))]('Job\x20not\x20completed.');const _0x36958a=path_1[_0x36c544(0x93)]['join'](RetrieveMetadataService[_0x36c544(0x72)],_0x3619c4,constants_1[_0x36c544(0x7a)]);if(await utils_1['FsUtils'][_0x36c544(0x6d)](_0x36958a))return(0x0,promises_1[_0x36c544(0x90)])(_0x36958a,'utf-8')[_0x36c544(0xa2)](JSON[_0x36c544(0x84)]);else throw new not_found_error_1['NotFoundError'](_0x36c544(0x8f));}static async['getResultChunk'](_0x18eddc,_0x2f16c2){const _0x385a1b=a273_0x2c1642,{status:_0x550276}=await RetrieveMetadataService[_0x385a1b(0x73)](_0x18eddc);if(_0x550276===logger_enums_1[_0x385a1b(0x7e)][_0x385a1b(0x78)])throw new bad_request_error_1[(_0x385a1b(0x85))](_0x385a1b(0x69));const _0x584cb2=path_1['default'][_0x385a1b(0x8e)](RetrieveMetadataService[_0x385a1b(0x72)],_0x18eddc,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x300ed3={'data':[]};if(await utils_1[_0x385a1b(0x76)]['isExistsPath'](path_1[_0x385a1b(0x93)]['join'](_0x584cb2,_0x2f16c2+_0x385a1b(0x9f))))_0x300ed3['data']=await(0x0,promises_1['readFile'])(path_1[_0x385a1b(0x93)][_0x385a1b(0x8e)](_0x584cb2,_0x2f16c2+_0x385a1b(0x9f)),'utf-8')[_0x385a1b(0xa2)](JSON[_0x385a1b(0x84)]);else throw new not_found_error_1['NotFoundError'](_0x385a1b(0x7f));return _0x300ed3;}static async['getJobStatus'](_0x2e7434){const _0x4cfb46=a273_0x2c1642;try{return await state_manger_1['default'][_0x4cfb46(0x9e)](path_1[_0x4cfb46(0x93)][_0x4cfb46(0x8e)](RetrieveMetadataService[_0x4cfb46(0x72)],_0x2e7434));}catch(_0x3011e6){throw new not_found_error_1['NotFoundError'](_0x3011e6);}}static async[a273_0x2c1642(0x8c)](_0x3f195a){const _0x3bf9ec=a273_0x2c1642,_0x47241e=path_1[_0x3bf9ec(0x93)]['join'](RetrieveMetadataService[_0x3bf9ec(0x72)],_0x3f195a,job_1[_0x3bf9ec(0xa3)]);if(await utils_1['FsUtils'][_0x3bf9ec(0x6d)](_0x47241e))return(0x0,promises_1['readFile'])(_0x47241e,_0x3bf9ec(0x92))[_0x3bf9ec(0xa2)](_0x4162c2=>csv_utils_1['default']['parse'](_0x4162c2,{'columns':!![]}));throw new not_found_error_1[(_0x3bf9ec(0x77))](_0x3bf9ec(0x79));}}exports[a273_0x2c1642(0x93)]=RetrieveMetadataService,RetrieveMetadataService[a273_0x2c1642(0x72)]=path_1[a273_0x2c1642(0x93)][a273_0x2c1642(0x8e)](path_2[a273_0x2c1642(0x8b)],constants_1[a273_0x2c1642(0x95)]);