const a292_0x4f7576=a292_0x3ef9;(function(_0xfa6829,_0x7d8552){const _0x572935=a292_0x3ef9,_0x51b92b=_0xfa6829();while(!![]){try{const _0x1d26f9=-parseInt(_0x572935(0x12f))/0x1+-parseInt(_0x572935(0x156))/0x2+-parseInt(_0x572935(0x164))/0x3*(parseInt(_0x572935(0x13a))/0x4)+-parseInt(_0x572935(0x143))/0x5+-parseInt(_0x572935(0x140))/0x6*(parseInt(_0x572935(0x13f))/0x7)+-parseInt(_0x572935(0x13b))/0x8*(-parseInt(_0x572935(0x126))/0x9)+parseInt(_0x572935(0x130))/0xa*(parseInt(_0x572935(0x128))/0xb);if(_0x1d26f9===_0x7d8552)break;else _0x51b92b['push'](_0x51b92b['shift']());}catch(_0x465bed){_0x51b92b['push'](_0x51b92b['shift']());}}}(a292_0x2296,0x40a84));const a292_0x2945b6=(function(){let _0x35e11f=!![];return function(_0x35b64d,_0x25fc82){const _0x522f35=_0x35e11f?function(){const _0x1e8e22=a292_0x3ef9;if(_0x25fc82){const _0x21c7e9=_0x25fc82[_0x1e8e22(0x152)](_0x35b64d,arguments);return _0x25fc82=null,_0x21c7e9;}}:function(){};return _0x35e11f=![],_0x522f35;};}()),a292_0x5c4bf5=a292_0x2945b6(this,function(){const _0x5a103a=a292_0x3ef9;return a292_0x5c4bf5[_0x5a103a(0x148)]()[_0x5a103a(0x15f)](_0x5a103a(0x15e))[_0x5a103a(0x148)]()['constructor'](a292_0x5c4bf5)[_0x5a103a(0x15f)](_0x5a103a(0x15e));});function a292_0x2296(){const _0x387598=['.json','runJob','join','apply','retrieveMetadataFolder','generateJobId','getJobLogs','710798nAwLJk','JobStatus','getResult','__esModule','../constants','create','Result\x20not\x20found.','readFile','(((.+)+)+)+$','search','../../shared/utils/job.utils','RETRIEVE_RESULTS_IDS_FILENAME','default','init','3uzKJmy','JOB_PATH','then','getResultChunk','isExistsPath','parse','151677kykXDi','slice','15036571fGGcRq','Job\x20log\x20not\x20found.','utf-8','../../../core/errors/bad-request.error','catch','data','NotFoundError','72730wGFQdM','10uNASxh','__importDefault','Job\x20not\x20completed.','Chunk\x20not\x20found.','sortJobsIds','setError','@flosum/utils','getJobState','defineProperty','getJobsIds','1866728mzWILF','88hchcKa','makeDir','FsUtils','path','1237222uvrBkz','6rrMwyo','../../shared/enums/logger.enums','../job/classes/manifest-manger','1079755kzBKtT','../../../core/errors/not-found.error','RETRIEVE_METADATA_FOLDER_NAME','../../shared/managers/state-manger','getJobStatus','toString','dataPath','RETRIEVE_RESULT_FOLDER_NAME','getJobs','BadRequestError','../../../configs/path','fs/promises'];a292_0x2296=function(){return _0x387598;};return a292_0x2296();}a292_0x5c4bf5();'use strict';var __importDefault=this&&this[a292_0x4f7576(0x131)]||function(_0x148344){const _0x329de3=a292_0x4f7576;return _0x148344&&_0x148344[_0x329de3(0x159)]?_0x148344:{'default':_0x148344};};Object[a292_0x4f7576(0x138)](exports,a292_0x4f7576(0x159),{'value':!![]});const job_utils_1=__importDefault(require(a292_0x4f7576(0x160))),path_1=__importDefault(require(a292_0x4f7576(0x13e))),manifest_manger_1=__importDefault(require(a292_0x4f7576(0x142))),state_manger_1=__importDefault(require(a292_0x4f7576(0x146))),promises_1=require(a292_0x4f7576(0x14e)),utils_1=require(a292_0x4f7576(0x136)),csv_utils_1=__importDefault(require('../../shared/utils/csv.utils')),not_found_error_1=require(a292_0x4f7576(0x144)),logger_enums_1=require(a292_0x4f7576(0x141)),bad_request_error_1=require(a292_0x4f7576(0x12b)),job_1=require('../../../constants/job'),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a292_0x4f7576(0x15a)),path_2=require(a292_0x4f7576(0x14d));class RetrieveMetadataService{static async[a292_0x4f7576(0x14b)](_0x534cc9,_0x42bfc4){const _0x4fd211=a292_0x4f7576,_0x26a434=await job_utils_1[_0x4fd211(0x162)][_0x4fd211(0x139)](RetrieveMetadataService[_0x4fd211(0x153)]),_0x3b907f=await job_utils_1['default'][_0x4fd211(0x134)](RetrieveMetadataService['retrieveMetadataFolder'],_0x26a434),_0x1ecbbd=_0x3b907f[_0x4fd211(0x127)](_0x42bfc4,_0x42bfc4+_0x534cc9),_0x844c21=[];for(const _0x301ef5 of _0x1ecbbd){const _0x4eb31b=await state_manger_1[_0x4fd211(0x162)]['getJobState'](path_1[_0x4fd211(0x162)][_0x4fd211(0x151)](RetrieveMetadataService[_0x4fd211(0x153)],_0x301ef5));_0x844c21['push'](_0x4eb31b);}return _0x844c21;}static async['createRetrieveJob'](_0x48d2b0){const _0x96594f=a292_0x4f7576,_0x596d90=job_utils_1[_0x96594f(0x162)][_0x96594f(0x154)](),_0x20973f=path_1[_0x96594f(0x162)][_0x96594f(0x151)](RetrieveMetadataService[_0x96594f(0x153)],_0x596d90);await(0x0,fs_utils_1[_0x96594f(0x13c)])(_0x20973f),await manifest_manger_1[_0x96594f(0x162)][_0x96594f(0x15b)](_0x20973f,_0x48d2b0),await state_manger_1[_0x96594f(0x162)][_0x96594f(0x15b)](_0x20973f,_0x596d90);const _0x20a097=path_1['default']['join'](__dirname,job_1[_0x96594f(0x165)]);return job_utils_1['default'][_0x96594f(0x150)](_0x20a097,{'jobStorePath':_0x20973f,'jobId':_0x596d90})[_0x96594f(0x12c)](async _0x2b5d71=>{const _0x4bb11a=_0x96594f,_0xe68962=new state_manger_1[(_0x4bb11a(0x162))](_0x20973f);await _0xe68962[_0x4bb11a(0x163)](),await _0xe68962[_0x4bb11a(0x135)](_0x2b5d71);}),{'jobId':_0x596d90};}static async[a292_0x4f7576(0x158)](_0x3aed4e){const _0x4dd1cf=a292_0x4f7576,{status:_0x1bd3c4}=await RetrieveMetadataService[_0x4dd1cf(0x147)](_0x3aed4e);if(_0x1bd3c4===logger_enums_1[_0x4dd1cf(0x157)]['IN_PROGRESS'])throw new bad_request_error_1[(_0x4dd1cf(0x14c))](_0x4dd1cf(0x132));const _0xbff6d6=path_1[_0x4dd1cf(0x162)][_0x4dd1cf(0x151)](RetrieveMetadataService['retrieveMetadataFolder'],_0x3aed4e,constants_1[_0x4dd1cf(0x161)]);if(await utils_1[_0x4dd1cf(0x13d)][_0x4dd1cf(0x124)](_0xbff6d6))return(0x0,promises_1['readFile'])(_0xbff6d6,_0x4dd1cf(0x12a))['then'](JSON['parse']);else throw new not_found_error_1[(_0x4dd1cf(0x12e))](_0x4dd1cf(0x15c));}static async[a292_0x4f7576(0x123)](_0x735695,_0x4595a1){const _0xb33aa9=a292_0x4f7576,{status:_0x34d8e0}=await RetrieveMetadataService[_0xb33aa9(0x147)](_0x735695);if(_0x34d8e0===logger_enums_1[_0xb33aa9(0x157)]['IN_PROGRESS'])throw new bad_request_error_1[(_0xb33aa9(0x14c))](_0xb33aa9(0x132));const _0x2a7067=path_1['default'][_0xb33aa9(0x151)](RetrieveMetadataService[_0xb33aa9(0x153)],_0x735695,constants_1[_0xb33aa9(0x14a)]),_0x167fa6={'data':[]};if(await utils_1[_0xb33aa9(0x13d)]['isExistsPath'](path_1[_0xb33aa9(0x162)][_0xb33aa9(0x151)](_0x2a7067,_0x4595a1+_0xb33aa9(0x14f))))_0x167fa6[_0xb33aa9(0x12d)]=await(0x0,promises_1[_0xb33aa9(0x15d)])(path_1[_0xb33aa9(0x162)][_0xb33aa9(0x151)](_0x2a7067,_0x4595a1+_0xb33aa9(0x14f)),_0xb33aa9(0x12a))[_0xb33aa9(0x166)](JSON[_0xb33aa9(0x125)]);else throw new not_found_error_1[(_0xb33aa9(0x12e))](_0xb33aa9(0x133));return _0x167fa6;}static async[a292_0x4f7576(0x147)](_0x114928){const _0x4d383f=a292_0x4f7576;try{return await state_manger_1[_0x4d383f(0x162)][_0x4d383f(0x137)](path_1['default']['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x114928));}catch(_0x23afc2){throw new not_found_error_1[(_0x4d383f(0x12e))](_0x23afc2);}}static async[a292_0x4f7576(0x155)](_0x25785b){const _0x3cd343=a292_0x4f7576,_0x42f4f4=path_1[_0x3cd343(0x162)][_0x3cd343(0x151)](RetrieveMetadataService[_0x3cd343(0x153)],_0x25785b,job_1['JOB_LOG_DETAILS_FILENAME']);if(await utils_1[_0x3cd343(0x13d)][_0x3cd343(0x124)](_0x42f4f4))return(0x0,promises_1[_0x3cd343(0x15d)])(_0x42f4f4,_0x3cd343(0x12a))[_0x3cd343(0x166)](_0x587c61=>csv_utils_1['default'][_0x3cd343(0x125)](_0x587c61,{'columns':!![]}));throw new not_found_error_1['NotFoundError'](_0x3cd343(0x129));}}function a292_0x3ef9(_0xa29b9a,_0x58dd60){const _0x21fe0a=a292_0x2296();return a292_0x3ef9=function(_0x5c4bf5,_0x2945b6){_0x5c4bf5=_0x5c4bf5-0x123;let _0x22963f=_0x21fe0a[_0x5c4bf5];return _0x22963f;},a292_0x3ef9(_0xa29b9a,_0x58dd60);}exports[a292_0x4f7576(0x162)]=RetrieveMetadataService,RetrieveMetadataService[a292_0x4f7576(0x153)]=path_1[a292_0x4f7576(0x162)][a292_0x4f7576(0x151)](path_2[a292_0x4f7576(0x149)],constants_1[a292_0x4f7576(0x145)]);