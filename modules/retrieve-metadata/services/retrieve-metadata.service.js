const a293_0x4d1204=a293_0x59f3;(function(_0x4bc9b4,_0x3d1995){const _0x330f53=a293_0x59f3,_0x2002c4=_0x4bc9b4();while(!![]){try{const _0x5189d7=-parseInt(_0x330f53(0x1e3))/0x1*(-parseInt(_0x330f53(0x1ed))/0x2)+parseInt(_0x330f53(0x1e7))/0x3+-parseInt(_0x330f53(0x1e9))/0x4*(-parseInt(_0x330f53(0x1cf))/0x5)+-parseInt(_0x330f53(0x1f2))/0x6*(-parseInt(_0x330f53(0x1c3))/0x7)+-parseInt(_0x330f53(0x1cb))/0x8*(parseInt(_0x330f53(0x1c2))/0x9)+parseInt(_0x330f53(0x1e2))/0xa+parseInt(_0x330f53(0x1eb))/0xb*(-parseInt(_0x330f53(0x1c1))/0xc);if(_0x5189d7===_0x3d1995)break;else _0x2002c4['push'](_0x2002c4['shift']());}catch(_0x6c53c){_0x2002c4['push'](_0x2002c4['shift']());}}}(a293_0x4e54,0xbd2f9));function a293_0x4e54(){const _0x2e0484=['2435838VUUQCV','retrieveMetadataFolder','308qLzvcB','__esModule','121IEDnex','join','184894dFJTxz','init','then','data','search','132wSQbBd','JobStatus','getResultChunk','parse','../../../constants/job','Result\x20not\x20found.','IN_PROGRESS','getJobStatus','RETRIEVE_METADATA_FOLDER_NAME','toString','constructor','JOB_LOG_DETAILS_FILENAME','defineProperty','getJobs','2462556zWnIkz','328725kzYTGE','299621ReEXHO','../../../core/errors/not-found.error','getJobState','readFile','BadRequestError','.json','getResult','NotFoundError','240gtnsAn','Job\x20not\x20completed.','Job\x20log\x20not\x20found.','../constants','38780wlwuzV','(((.+)+)+)+$','default','apply','create','utf-8','createRetrieveJob','generateJobId','FsUtils','../job/classes/manifest-manger','@flosum/utils','dataPath','../../../core/errors/bad-request.error','isExistsPath','push','JOB_PATH','getJobLogs','makeDir','setError','11300450hXkyFu','7GBpaMJ','../../shared/utils/fs.utils','../../shared/utils/csv.utils','../../../configs/path'];a293_0x4e54=function(){return _0x2e0484;};return a293_0x4e54();}const a293_0x26ffd3=(function(){let _0x1a171d=!![];return function(_0x1600df,_0x2b363e){const _0x47a493=_0x1a171d?function(){const _0x6607f9=a293_0x59f3;if(_0x2b363e){const _0x26582c=_0x2b363e[_0x6607f9(0x1d2)](_0x1600df,arguments);return _0x2b363e=null,_0x26582c;}}:function(){};return _0x1a171d=![],_0x47a493;};}()),a293_0x5059c1=a293_0x26ffd3(this,function(){const _0x37abe7=a293_0x59f3;return a293_0x5059c1[_0x37abe7(0x1fb)]()['search'](_0x37abe7(0x1d0))[_0x37abe7(0x1fb)]()[_0x37abe7(0x1fc)](a293_0x5059c1)[_0x37abe7(0x1f1)](_0x37abe7(0x1d0));});a293_0x5059c1();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x104f0f){const _0xc3b94f=a293_0x59f3;return _0x104f0f&&_0x104f0f[_0xc3b94f(0x1ea)]?_0x104f0f:{'default':_0x104f0f};};Object[a293_0x4d1204(0x1fe)](exports,a293_0x4d1204(0x1ea),{'value':!![]});const job_utils_1=__importDefault(require('../../shared/utils/job.utils')),path_1=__importDefault(require('path')),manifest_manger_1=__importDefault(require(a293_0x4d1204(0x1d8))),state_manger_1=__importDefault(require('../../shared/managers/state-manger')),promises_1=require('fs/promises'),utils_1=require(a293_0x4d1204(0x1d9)),csv_utils_1=__importDefault(require(a293_0x4d1204(0x1e5))),not_found_error_1=require(a293_0x4d1204(0x1c4)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require(a293_0x4d1204(0x1db)),job_1=require(a293_0x4d1204(0x1f6)),fs_utils_1=require(a293_0x4d1204(0x1e4)),constants_1=require(a293_0x4d1204(0x1ce)),path_2=require(a293_0x4d1204(0x1e6));class RetrieveMetadataService{static async[a293_0x4d1204(0x1c0)](_0x20d58f,_0x4d939d){const _0x543b2e=a293_0x4d1204,_0x542113=await job_utils_1[_0x543b2e(0x1d1)]['getJobsIds'](RetrieveMetadataService[_0x543b2e(0x1e8)]),_0x44f98e=await job_utils_1[_0x543b2e(0x1d1)]['sortJobsIds'](RetrieveMetadataService[_0x543b2e(0x1e8)],_0x542113),_0x2cebce=_0x44f98e['slice'](_0x4d939d,_0x4d939d+_0x20d58f),_0x1a2503=[];for(const _0x15f790 of _0x2cebce){const _0x6e910f=await state_manger_1['default'][_0x543b2e(0x1c5)](path_1[_0x543b2e(0x1d1)][_0x543b2e(0x1ec)](RetrieveMetadataService[_0x543b2e(0x1e8)],_0x15f790));_0x1a2503[_0x543b2e(0x1dd)](_0x6e910f);}return _0x1a2503;}static async[a293_0x4d1204(0x1d5)](_0x2233e9){const _0x5b6d46=a293_0x4d1204,_0x245f6a=job_utils_1['default'][_0x5b6d46(0x1d6)](),_0x2e9faa=path_1['default'][_0x5b6d46(0x1ec)](RetrieveMetadataService[_0x5b6d46(0x1e8)],_0x245f6a);await(0x0,fs_utils_1[_0x5b6d46(0x1e0)])(_0x2e9faa),await manifest_manger_1['default']['create'](_0x2e9faa,_0x2233e9),await state_manger_1[_0x5b6d46(0x1d1)][_0x5b6d46(0x1d3)](_0x2e9faa,_0x245f6a);const _0x58b5b5=path_1[_0x5b6d46(0x1d1)][_0x5b6d46(0x1ec)](__dirname,job_1[_0x5b6d46(0x1de)]);return job_utils_1[_0x5b6d46(0x1d1)]['runJob'](_0x58b5b5,{'jobStorePath':_0x2e9faa,'jobId':_0x245f6a})['catch'](async _0x2fa834=>{const _0xcdff3c=_0x5b6d46,_0x691f26=new state_manger_1[(_0xcdff3c(0x1d1))](_0x2e9faa);await _0x691f26[_0xcdff3c(0x1ee)](),await _0x691f26[_0xcdff3c(0x1e1)](_0x2fa834);}),{'jobId':_0x245f6a};}static async[a293_0x4d1204(0x1c9)](_0x151ae4){const _0x35d3b9=a293_0x4d1204,{status:_0xb4a07d}=await RetrieveMetadataService['getJobStatus'](_0x151ae4);if(_0xb4a07d===logger_enums_1[_0x35d3b9(0x1f3)]['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError'](_0x35d3b9(0x1cc));const _0x45bddc=path_1[_0x35d3b9(0x1d1)][_0x35d3b9(0x1ec)](RetrieveMetadataService[_0x35d3b9(0x1e8)],_0x151ae4,constants_1['RETRIEVE_RESULTS_IDS_FILENAME']);if(await utils_1[_0x35d3b9(0x1d7)][_0x35d3b9(0x1dc)](_0x45bddc))return(0x0,promises_1[_0x35d3b9(0x1c6)])(_0x45bddc,_0x35d3b9(0x1d4))[_0x35d3b9(0x1ef)](JSON['parse']);else throw new not_found_error_1[(_0x35d3b9(0x1ca))](_0x35d3b9(0x1f7));}static async[a293_0x4d1204(0x1f4)](_0x202518,_0x15c1f6){const _0x45f081=a293_0x4d1204,{status:_0x584e95}=await RetrieveMetadataService[_0x45f081(0x1f9)](_0x202518);if(_0x584e95===logger_enums_1[_0x45f081(0x1f3)][_0x45f081(0x1f8)])throw new bad_request_error_1[(_0x45f081(0x1c7))](_0x45f081(0x1cc));const _0x25c1cc=path_1[_0x45f081(0x1d1)][_0x45f081(0x1ec)](RetrieveMetadataService['retrieveMetadataFolder'],_0x202518,constants_1['RETRIEVE_RESULT_FOLDER_NAME']),_0x1f921b={'data':[]};if(await utils_1['FsUtils'][_0x45f081(0x1dc)](path_1['default'][_0x45f081(0x1ec)](_0x25c1cc,_0x15c1f6+_0x45f081(0x1c8))))_0x1f921b[_0x45f081(0x1f0)]=await(0x0,promises_1[_0x45f081(0x1c6)])(path_1[_0x45f081(0x1d1)][_0x45f081(0x1ec)](_0x25c1cc,_0x15c1f6+_0x45f081(0x1c8)),'utf-8')[_0x45f081(0x1ef)](JSON['parse']);else throw new not_found_error_1[(_0x45f081(0x1ca))]('Chunk\x20not\x20found.');return _0x1f921b;}static async[a293_0x4d1204(0x1f9)](_0x13de9d){const _0xcc2614=a293_0x4d1204;try{return await state_manger_1[_0xcc2614(0x1d1)]['getJobState'](path_1[_0xcc2614(0x1d1)][_0xcc2614(0x1ec)](RetrieveMetadataService['retrieveMetadataFolder'],_0x13de9d));}catch(_0x54e337){throw new not_found_error_1[(_0xcc2614(0x1ca))](_0x54e337);}}static async[a293_0x4d1204(0x1df)](_0x100db6){const _0x5b6293=a293_0x4d1204,_0x3a526c=path_1['default'][_0x5b6293(0x1ec)](RetrieveMetadataService[_0x5b6293(0x1e8)],_0x100db6,job_1[_0x5b6293(0x1fd)]);if(await utils_1['FsUtils']['isExistsPath'](_0x3a526c))return(0x0,promises_1[_0x5b6293(0x1c6)])(_0x3a526c,'utf-8')[_0x5b6293(0x1ef)](_0xd8ea43=>csv_utils_1[_0x5b6293(0x1d1)][_0x5b6293(0x1f5)](_0xd8ea43,{'columns':!![]}));throw new not_found_error_1[(_0x5b6293(0x1ca))](_0x5b6293(0x1cd));}}function a293_0x59f3(_0x19818a,_0x345eac){const _0x39064d=a293_0x4e54();return a293_0x59f3=function(_0x5059c1,_0x26ffd3){_0x5059c1=_0x5059c1-0x1c0;let _0x4e5462=_0x39064d[_0x5059c1];return _0x4e5462;},a293_0x59f3(_0x19818a,_0x345eac);}exports['default']=RetrieveMetadataService,RetrieveMetadataService[a293_0x4d1204(0x1e8)]=path_1[a293_0x4d1204(0x1d1)][a293_0x4d1204(0x1ec)](path_2[a293_0x4d1204(0x1da)],constants_1[a293_0x4d1204(0x1fa)]);