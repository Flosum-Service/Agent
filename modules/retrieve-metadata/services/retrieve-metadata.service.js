const a277_0x1d89b4=a277_0x2cfb;function a277_0x2cfb(_0x6105ba,_0x143523){const _0x1181b7=a277_0x2c67();return a277_0x2cfb=function(_0x34bae9,_0x1d5ca8){_0x34bae9=_0x34bae9-0x1f3;let _0x2c6702=_0x1181b7[_0x34bae9];return _0x2c6702;},a277_0x2cfb(_0x6105ba,_0x143523);}function a277_0x2c67(){const _0x1902cd=['RETRIEVE_RESULTS_IDS_FILENAME','slice','JOB_LOG_DETAILS_FILENAME','../job/classes/manifest-manger','search','NotFoundError','../../shared/utils/csv.utils','6oCxHfk','join','6985032XhiGhq','parse','then','path','../../shared/utils/job.utils','IN_PROGRESS','getResultChunk','isExistsPath','catch','generateJobId','1239384blnLYJ','makeDir','push','readFile','5091527WawbOt','../../../core/errors/not-found.error','7538320XtowHv','(((.+)+)+)+$','Chunk\x20not\x20found.','init','getJobStatus','.json','default','../../../constants/job','JOB_PATH','toString','16TATGWw','utf-8','getJobsIds','../constants','data','@flosum/utils','createRetrieveJob','getResult','RETRIEVE_RESULT_FOLDER_NAME','dataPath','1672658tDBsVq','JobStatus','BadRequestError','getJobState','../../shared/managers/state-manger','getJobs','defineProperty','constructor','850040bVmLDb','retrieveMetadataFolder','setError','fs/promises','Result\x20not\x20found.','FsUtils','../../../core/errors/bad-request.error','Job\x20not\x20completed.','create','RETRIEVE_METADATA_FOLDER_NAME','__esModule','18552618levLuz','Job\x20log\x20not\x20found.','__importDefault'];a277_0x2c67=function(){return _0x1902cd;};return a277_0x2c67();}(function(_0x2e32e0,_0x21211d){const _0x271385=a277_0x2cfb,_0x437f92=_0x2e32e0();while(!![]){try{const _0x518c8a=parseInt(_0x271385(0x218))/0x1+-parseInt(_0x271385(0x220))/0x2+-parseInt(_0x271385(0x1fe))/0x3+-parseInt(_0x271385(0x1f4))/0x4+-parseInt(_0x271385(0x204))/0x5+parseInt(_0x271385(0x235))/0x6*(-parseInt(_0x271385(0x202))/0x7)+parseInt(_0x271385(0x20e))/0x8*(parseInt(_0x271385(0x22b))/0x9);if(_0x518c8a===_0x21211d)break;else _0x437f92['push'](_0x437f92['shift']());}catch(_0x2b1c7b){_0x437f92['push'](_0x437f92['shift']());}}}(a277_0x2c67,0xee49f));const a277_0x1d5ca8=(function(){let _0x434427=!![];return function(_0x2e3755,_0x26e5fe){const _0x21b5b7=_0x434427?function(){if(_0x26e5fe){const _0x22106a=_0x26e5fe['apply'](_0x2e3755,arguments);return _0x26e5fe=null,_0x22106a;}}:function(){};return _0x434427=![],_0x21b5b7;};}()),a277_0x34bae9=a277_0x1d5ca8(this,function(){const _0x218511=a277_0x2cfb;return a277_0x34bae9['toString']()[_0x218511(0x232)](_0x218511(0x205))[_0x218511(0x20d)]()[_0x218511(0x21f)](a277_0x34bae9)['search']('(((.+)+)+)+$');});a277_0x34bae9();'use strict';var __importDefault=this&&this[a277_0x1d89b4(0x22d)]||function(_0x389ebf){return _0x389ebf&&_0x389ebf['__esModule']?_0x389ebf:{'default':_0x389ebf};};Object[a277_0x1d89b4(0x21e)](exports,a277_0x1d89b4(0x22a),{'value':!![]});const job_utils_1=__importDefault(require(a277_0x1d89b4(0x1f8))),path_1=__importDefault(require(a277_0x1d89b4(0x1f7))),manifest_manger_1=__importDefault(require(a277_0x1d89b4(0x231))),state_manger_1=__importDefault(require(a277_0x1d89b4(0x21c))),promises_1=require(a277_0x1d89b4(0x223)),utils_1=require(a277_0x1d89b4(0x213)),csv_utils_1=__importDefault(require(a277_0x1d89b4(0x234))),not_found_error_1=require(a277_0x1d89b4(0x203)),logger_enums_1=require('../../shared/enums/logger.enums'),bad_request_error_1=require(a277_0x1d89b4(0x226)),job_1=require(a277_0x1d89b4(0x20b)),fs_utils_1=require('../../shared/utils/fs.utils'),constants_1=require(a277_0x1d89b4(0x211)),path_2=require('../../../configs/path');class RetrieveMetadataService{static async[a277_0x1d89b4(0x21d)](_0x16555e,_0x5f55d2){const _0x890a35=a277_0x1d89b4,_0x3875b0=await job_utils_1[_0x890a35(0x20a)][_0x890a35(0x210)](RetrieveMetadataService[_0x890a35(0x221)]),_0xe1ca16=await job_utils_1['default']['sortJobsIds'](RetrieveMetadataService[_0x890a35(0x221)],_0x3875b0),_0x277987=_0xe1ca16[_0x890a35(0x22f)](_0x5f55d2,_0x5f55d2+_0x16555e),_0x23a8c3=[];for(const _0x827948 of _0x277987){const _0x295939=await state_manger_1[_0x890a35(0x20a)][_0x890a35(0x21b)](path_1[_0x890a35(0x20a)][_0x890a35(0x1f3)](RetrieveMetadataService[_0x890a35(0x221)],_0x827948));_0x23a8c3[_0x890a35(0x200)](_0x295939);}return _0x23a8c3;}static async[a277_0x1d89b4(0x214)](_0x3daece){const _0x10507f=a277_0x1d89b4,_0x4a8f09=job_utils_1[_0x10507f(0x20a)][_0x10507f(0x1fd)](),_0x145218=path_1[_0x10507f(0x20a)]['join'](RetrieveMetadataService['retrieveMetadataFolder'],_0x4a8f09);await(0x0,fs_utils_1[_0x10507f(0x1ff)])(_0x145218),await manifest_manger_1[_0x10507f(0x20a)][_0x10507f(0x228)](_0x145218,_0x3daece),await state_manger_1[_0x10507f(0x20a)][_0x10507f(0x228)](_0x145218,_0x4a8f09);const _0x22d8ed=path_1[_0x10507f(0x20a)][_0x10507f(0x1f3)](__dirname,job_1[_0x10507f(0x20c)]);return job_utils_1['default']['runJob'](_0x22d8ed,{'jobStorePath':_0x145218,'jobId':_0x4a8f09})[_0x10507f(0x1fc)](async _0x3c3469=>{const _0x22dd66=_0x10507f,_0x5a0e08=new state_manger_1[(_0x22dd66(0x20a))](_0x145218);await _0x5a0e08[_0x22dd66(0x207)](),await _0x5a0e08[_0x22dd66(0x222)](_0x3c3469);}),{'jobId':_0x4a8f09};}static async[a277_0x1d89b4(0x215)](_0xe4c2e0){const _0x26b6df=a277_0x1d89b4,{status:_0x1ca3a9}=await RetrieveMetadataService[_0x26b6df(0x208)](_0xe4c2e0);if(_0x1ca3a9===logger_enums_1[_0x26b6df(0x219)]['IN_PROGRESS'])throw new bad_request_error_1['BadRequestError'](_0x26b6df(0x227));const _0x20754b=path_1[_0x26b6df(0x20a)]['join'](RetrieveMetadataService[_0x26b6df(0x221)],_0xe4c2e0,constants_1[_0x26b6df(0x22e)]);if(await utils_1[_0x26b6df(0x225)][_0x26b6df(0x1fb)](_0x20754b))return(0x0,promises_1['readFile'])(_0x20754b,_0x26b6df(0x20f))[_0x26b6df(0x1f6)](JSON['parse']);else throw new not_found_error_1[(_0x26b6df(0x233))](_0x26b6df(0x224));}static async[a277_0x1d89b4(0x1fa)](_0x1f0e15,_0x4e93c2){const _0xfb9a45=a277_0x1d89b4,{status:_0x1f3c70}=await RetrieveMetadataService[_0xfb9a45(0x208)](_0x1f0e15);if(_0x1f3c70===logger_enums_1['JobStatus'][_0xfb9a45(0x1f9)])throw new bad_request_error_1[(_0xfb9a45(0x21a))](_0xfb9a45(0x227));const _0x462d4f=path_1[_0xfb9a45(0x20a)][_0xfb9a45(0x1f3)](RetrieveMetadataService[_0xfb9a45(0x221)],_0x1f0e15,constants_1[_0xfb9a45(0x216)]),_0x12f1ce={'data':[]};if(await utils_1['FsUtils'][_0xfb9a45(0x1fb)](path_1[_0xfb9a45(0x20a)][_0xfb9a45(0x1f3)](_0x462d4f,_0x4e93c2+_0xfb9a45(0x209))))_0x12f1ce[_0xfb9a45(0x212)]=await(0x0,promises_1[_0xfb9a45(0x201)])(path_1[_0xfb9a45(0x20a)]['join'](_0x462d4f,_0x4e93c2+_0xfb9a45(0x209)),_0xfb9a45(0x20f))[_0xfb9a45(0x1f6)](JSON['parse']);else throw new not_found_error_1[(_0xfb9a45(0x233))](_0xfb9a45(0x206));return _0x12f1ce;}static async[a277_0x1d89b4(0x208)](_0x59e112){const _0x175035=a277_0x1d89b4;try{return await state_manger_1[_0x175035(0x20a)][_0x175035(0x21b)](path_1['default'][_0x175035(0x1f3)](RetrieveMetadataService['retrieveMetadataFolder'],_0x59e112));}catch(_0x28df37){throw new not_found_error_1[(_0x175035(0x233))](_0x28df37);}}static async['getJobLogs'](_0x4b33f4){const _0x4f1347=a277_0x1d89b4,_0x3d3d53=path_1['default'][_0x4f1347(0x1f3)](RetrieveMetadataService['retrieveMetadataFolder'],_0x4b33f4,job_1[_0x4f1347(0x230)]);if(await utils_1['FsUtils'][_0x4f1347(0x1fb)](_0x3d3d53))return(0x0,promises_1['readFile'])(_0x3d3d53,_0x4f1347(0x20f))[_0x4f1347(0x1f6)](_0x15e8ae=>csv_utils_1[_0x4f1347(0x20a)][_0x4f1347(0x1f5)](_0x15e8ae,{'columns':!![]}));throw new not_found_error_1[(_0x4f1347(0x233))](_0x4f1347(0x22c));}}exports[a277_0x1d89b4(0x20a)]=RetrieveMetadataService,RetrieveMetadataService[a277_0x1d89b4(0x221)]=path_1[a277_0x1d89b4(0x20a)][a277_0x1d89b4(0x1f3)](path_2[a277_0x1d89b4(0x217)],constants_1[a277_0x1d89b4(0x229)]);