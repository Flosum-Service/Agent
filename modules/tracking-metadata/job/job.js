const a304_0x5cf7a2=a304_0x3156;(function(_0x3e4037,_0x233a02){const _0x150ac2=a304_0x3156,_0x28b3a4=_0x3e4037();while(!![]){try{const _0x37aaba=-parseInt(_0x150ac2(0x8b))/0x1*(-parseInt(_0x150ac2(0x93))/0x2)+-parseInt(_0x150ac2(0xcc))/0x3+-parseInt(_0x150ac2(0xb8))/0x4+parseInt(_0x150ac2(0xa8))/0x5*(parseInt(_0x150ac2(0xb9))/0x6)+parseInt(_0x150ac2(0xd0))/0x7+parseInt(_0x150ac2(0xbf))/0x8*(parseInt(_0x150ac2(0xb5))/0x9)+-parseInt(_0x150ac2(0xd5))/0xa;if(_0x37aaba===_0x233a02)break;else _0x28b3a4['push'](_0x28b3a4['shift']());}catch(_0x1f5c8d){_0x28b3a4['push'](_0x28b3a4['shift']());}}}(a304_0xf70c,0x3022c));const a304_0x399e87=(function(){let _0x1db607=!![];return function(_0x298d43,_0x33e1d7){const _0x2a4c57=_0x1db607?function(){const _0xfca95c=a304_0x3156;if(_0x33e1d7){const _0x2434da=_0x33e1d7[_0xfca95c(0xb3)](_0x298d43,arguments);return _0x33e1d7=null,_0x2434da;}}:function(){};return _0x1db607=![],_0x2a4c57;};}()),a304_0x20d317=a304_0x399e87(this,function(){const _0x2c3ce6=a304_0x3156;return a304_0x20d317[_0x2c3ce6(0x95)]()['search'](_0x2c3ce6(0xbe))[_0x2c3ce6(0x95)]()['constructor'](a304_0x20d317)['search'](_0x2c3ce6(0xbe));});a304_0x20d317();'use strict';var __importDefault=this&&this[a304_0x5cf7a2(0x8e)]||function(_0x363e10){const _0x5651a5=a304_0x5cf7a2;return _0x363e10&&_0x363e10[_0x5651a5(0x91)]?_0x363e10:{'default':_0x363e10};};function a304_0xf70c(){const _0x453eee=['init','getMetadataRetriever','initManifest','getTime','metadataLogger','metadataLogId','slice','apply','createTrackingSettingRecord','9iZEysV','../../../constants','logger','1398364WoRlXu','769086QxRWiV','lastRetrieveDate','default','update','then','(((.+)+)+)+$','401864LSUWQc','LogStatus','Tracking\x20setting\x20not\x20updated\x20\x0a\x20','Job\x20Error:\x20','error','FLOSUM_NAMESPACE','IN_PROGRESS','./classes/metadata-logger','targetOrgId','Is_Processed__c','stream/promises','Job','../../../constants/job','409308FWAZYl','flosumOrgCredentials','execute','utf-8','2031169krfMfl','exit','readFile','jobStorePath','status','3083700MpOSij','../constants','message','targetInstance','getComponentsDeployer','log','join','updateTrackingSetting','create','Tracking\x20components\x20job\x20has\x20been\x20completed','./classes/source-member.handler','argv','EXCEPTION','minimist','SourceMemberRetriever','1gOEboo','getSourceMemberRetriever','targetOrgCredentials','__importDefault','startDate','path','__esModule','trackingSettingId','533236OsieZx','apiVersion','toString','ComponentsDeployer','initMetadataLogger','RestSimpleDeployData','COMPLETED','jobId','Tracking_Setting__c','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','metadataTypes','Tracking\x20components\x20job\x20has\x20been\x20failed','./classes/source-member.retriever','flosumInstance','AuthManager','Tracking\x20setting\x20updated','initInstances','AxiosInstanceUtils','Logger','timeZone','@flosum/salesforce','15Inikyg','MetadataLogger','success','MANIFEST_FILENAME'];a304_0xf70c=function(){return _0x453eee;};return a304_0xf70c();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a304_0x5cf7a2(0xca)]=void 0x0;function a304_0x3156(_0x230aeb,_0x4c2678){const _0x4fb409=a304_0xf70c();return a304_0x3156=function(_0x20d317,_0x399e87){_0x20d317=_0x20d317-0x7e;let _0xf70ceb=_0x4fb409[_0x20d317];return _0xf70ceb;},a304_0x3156(_0x230aeb,_0x4c2678);}const minimist_1=__importDefault(require(a304_0x5cf7a2(0x89))),core_1=require('../../../core'),salesforce_1=require(a304_0x5cf7a2(0xa7)),auth_manager_1=require('../../shared/managers/auth.manager'),logger_1=require('./classes/logger/logger'),promises_1=require(a304_0x5cf7a2(0xc9)),promises_2=require('fs/promises'),path_1=__importDefault(require(a304_0x5cf7a2(0x90))),metadata_retriever_1=require('./classes/metadata.retriever'),components_deployer_1=require('./classes/components.deployer'),source_member_retriever_1=require(a304_0x5cf7a2(0x9f)),source_member_handler_1=require(a304_0x5cf7a2(0x86)),metadata_logger_1=require(a304_0x5cf7a2(0xc6)),job_1=require(a304_0x5cf7a2(0xcb)),constants_1=require(a304_0x5cf7a2(0xb6)),constants_2=require(a304_0x5cf7a2(0xd6)),{jobId,jobStorePath}=(0x0,minimist_1[a304_0x5cf7a2(0xbb)])(process[a304_0x5cf7a2(0x87)][a304_0x5cf7a2(0xb2)](0x2)),systemLogger=new core_1[(a304_0x5cf7a2(0xa5))](jobId);class Job{constructor(){const _0x479a8b=a304_0x5cf7a2;this[_0x479a8b(0xd3)]=jobStorePath,this['jobId']=jobId;}async[a304_0x5cf7a2(0xae)](){const _0x535f4d=a304_0x5cf7a2,_0x2d69f0=path_1['default'][_0x535f4d(0x82)](this[_0x535f4d(0xd3)],job_1[_0x535f4d(0xab)]),_0x5312dc=await(0x0,promises_2[_0x535f4d(0xd2)])(_0x2d69f0,{'encoding':_0x535f4d(0xcf)})[_0x535f4d(0xbd)](JSON['parse'])[_0x535f4d(0xbd)](({details:_0x2c79a1})=>_0x2c79a1);await(0x0,promises_2['rm'])(_0x2d69f0,{'recursive':!![],'force':!![]}),this[_0x535f4d(0x94)]=_0x5312dc[_0x535f4d(0x94)],this['flosumOrgCredentials']=_0x5312dc[_0x535f4d(0xcd)],this[_0x535f4d(0x8d)]=_0x5312dc[_0x535f4d(0x8d)],this[_0x535f4d(0xc7)]=_0x5312dc['targetOrgId'],this[_0x535f4d(0x92)]=_0x5312dc[_0x535f4d(0x92)],this[_0x535f4d(0xba)]=_0x5312dc[_0x535f4d(0xba)],this['metadataTypes']=_0x5312dc[_0x535f4d(0x9d)],this[_0x535f4d(0xa6)]=_0x5312dc[_0x535f4d(0xa6)];}async[a304_0x5cf7a2(0xa3)](){const _0x4a91ac=a304_0x5cf7a2;this['flosumInstance']=await salesforce_1[_0x4a91ac(0xa4)]['create'](new auth_manager_1[(_0x4a91ac(0xa1))](this[_0x4a91ac(0xcd)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this['targetInstance']=await salesforce_1['AxiosInstanceUtils'][_0x4a91ac(0x84)](new auth_manager_1[(_0x4a91ac(0xa1))](this[_0x4a91ac(0x8d)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async[a304_0x5cf7a2(0x97)](){const _0x4c719d=a304_0x5cf7a2;this[_0x4c719d(0xb0)]=new metadata_logger_1[(_0x4c719d(0xa9))]({'apiVersion':this[_0x4c719d(0x94)],'instance':this[_0x4c719d(0xa0)],'targetOrgId':this[_0x4c719d(0xc7)],'trackingSettingId':this[_0x4c719d(0x92)],'startDate':this[_0x4c719d(0x8f)]}),this[_0x4c719d(0xb1)]=await this[_0x4c719d(0xb0)][_0x4c719d(0xac)]();}['initLogger'](){const _0x3643bc=a304_0x5cf7a2;this['logger']=new logger_1[(_0x3643bc(0xa5))]({'systemLogger':systemLogger,'apiVersion':this[_0x3643bc(0x94)],'instance':this[_0x3643bc(0xa0)],'metadataLogId':this[_0x3643bc(0xb1)],'timeZone':this[_0x3643bc(0xa6)]});}[a304_0x5cf7a2(0x8c)](){const _0x59e579=a304_0x5cf7a2;return new source_member_retriever_1[(_0x59e579(0x8a))]({'apiVersion':this['apiVersion'],'instance':this[_0x59e579(0x7f)],'logger':this[_0x59e579(0xb7)],'lastRetrieveDate':this[_0x59e579(0xba)],'currentRetrieveDate':this['startDate'],'metadataTypes':this['metadataTypes']});}['getSourceMemberHandler'](){const _0x5f36b8=a304_0x5cf7a2;return new source_member_handler_1['SourceMemberHandler']({'instance':this[_0x5f36b8(0xa0)],'apiVersion':this[_0x5f36b8(0x94)],'logger':this[_0x5f36b8(0xb7)],'targetOrgId':this[_0x5f36b8(0xc7)]});}[a304_0x5cf7a2(0xad)](){const _0x194335=a304_0x5cf7a2;return new metadata_retriever_1['MetadataRetriever']({'instance':this[_0x194335(0x7f)],'apiVersion':this[_0x194335(0x94)],'logger':this['logger'],'metadataTypes':this[_0x194335(0x9d)]});}[a304_0x5cf7a2(0x80)](){const _0xcc1638=a304_0x5cf7a2;return new components_deployer_1[(_0xcc1638(0x96))]({'instance':this[_0xcc1638(0xa0)],'logger':this['logger'],'apiVersion':this['apiVersion'],'targetOrgId':this['targetOrgId'],'trackingSettingId':this[_0xcc1638(0x92)]});}[a304_0x5cf7a2(0xb4)](){const _0x48d952=a304_0x5cf7a2;return{'attributes':{'type':constants_1[_0x48d952(0xc4)]+_0x48d952(0x9b)},'Id':this[_0x48d952(0x92)],[constants_1[_0x48d952(0xc4)]+_0x48d952(0xc8)]:![],[constants_1[_0x48d952(0xc4)]+'Last_Start_Retrieval__c']:this[_0x48d952(0x8f)]};}async[a304_0x5cf7a2(0x83)](){const _0x2e55ce=a304_0x5cf7a2,_0x3e694c=this['createTrackingSettingRecord'](),_0x252513=new salesforce_1[(_0x2e55ce(0x98))]({'instance':this[_0x2e55ce(0xa0)],'objectName':constants_1[_0x2e55ce(0xc4)]+'Tracking_Setting__c','api':this[_0x2e55ce(0x94)],'allOrNone':![],'externalIdField':'Id'}),_0x38c288=await _0x252513['execute']({'records':[_0x3e694c]}),_0x562461=_0x38c288['at'](0x0);(_0x562461===null||_0x562461===void 0x0?void 0x0:_0x562461[_0x2e55ce(0xaa)])?this[_0x2e55ce(0xb7)]['log'](_0x2e55ce(0xa2)):this[_0x2e55ce(0xb7)][_0x2e55ce(0x81)](_0x2e55ce(0xc1)+(_0x562461===null||_0x562461===void 0x0?void 0x0:_0x562461['error']));}async[a304_0x5cf7a2(0xce)](){const _0x88c5f9=a304_0x5cf7a2;await this[_0x88c5f9(0xae)](),this[_0x88c5f9(0x8f)]=new Date()[_0x88c5f9(0xaf)]();try{await this[_0x88c5f9(0xa3)](),await this['initMetadataLogger'](),this['initLogger'](),this[_0x88c5f9(0xb7)][_0x88c5f9(0x81)](_0x88c5f9(0x9c)+this[_0x88c5f9(0x9a)]),this[_0x88c5f9(0xb0)][_0x88c5f9(0xd4)]=constants_2[_0x88c5f9(0xc0)][_0x88c5f9(0xc5)],await this[_0x88c5f9(0xb0)][_0x88c5f9(0xbc)](),await this[_0x88c5f9(0xb7)]['update']();const _0x3543d0=this[_0x88c5f9(0x8c)](),_0x4a33b9=this['getSourceMemberHandler'](),_0x42bea1=this['getMetadataRetriever'](),_0x1c4be8=this[_0x88c5f9(0x80)]();await(0x0,promises_1['pipeline'])(_0x3543d0,_0x4a33b9,_0x42bea1,_0x1c4be8),this[_0x88c5f9(0xb7)][_0x88c5f9(0x81)](_0x88c5f9(0x85)),this[_0x88c5f9(0xb0)]['status']=constants_2[_0x88c5f9(0xc0)][_0x88c5f9(0x99)];}catch(_0x3a30f8){this['logger'][_0x88c5f9(0xc3)](_0x88c5f9(0x9e)),this[_0x88c5f9(0xb7)][_0x88c5f9(0xc3)](_0x3a30f8['message']),this[_0x88c5f9(0xb0)][_0x88c5f9(0xd4)]=constants_2['LogStatus'][_0x88c5f9(0x88)];}finally{await this[_0x88c5f9(0x83)](),await this[_0x88c5f9(0xb7)][_0x88c5f9(0xbc)](),await this[_0x88c5f9(0xb0)]['update']();}}}exports[a304_0x5cf7a2(0xca)]=Job,new Job()['execute']()[a304_0x5cf7a2(0xbd)](()=>process[a304_0x5cf7a2(0xd1)](0x0))['catch'](_0x5677ca=>{const _0x2b154b=a304_0x5cf7a2;systemLogger['error'](_0x2b154b(0xc2)+_0x5677ca[_0x2b154b(0x7e)]),process[_0x2b154b(0xd1)](0x1);});