const a304_0x3c9d9e=a304_0x72f0;(function(_0x2c2969,_0x4a0508){const _0x4cdc8a=a304_0x72f0,_0x401679=_0x2c2969();while(!![]){try{const _0x4f9d25=-parseInt(_0x4cdc8a(0xf7))/0x1+-parseInt(_0x4cdc8a(0xe4))/0x2+parseInt(_0x4cdc8a(0xda))/0x3*(-parseInt(_0x4cdc8a(0x11b))/0x4)+parseInt(_0x4cdc8a(0xde))/0x5*(parseInt(_0x4cdc8a(0xed))/0x6)+parseInt(_0x4cdc8a(0x129))/0x7+parseInt(_0x4cdc8a(0x110))/0x8*(-parseInt(_0x4cdc8a(0xf1))/0x9)+parseInt(_0x4cdc8a(0xd9))/0xa;if(_0x4f9d25===_0x4a0508)break;else _0x401679['push'](_0x401679['shift']());}catch(_0x57b570){_0x401679['push'](_0x401679['shift']());}}}(a304_0x4395,0x52e5a));const a304_0x484d29=(function(){let _0x2d3ed2=!![];return function(_0x21b89,_0x26c6ba){const _0x47752a=_0x2d3ed2?function(){if(_0x26c6ba){const _0x57a0f3=_0x26c6ba['apply'](_0x21b89,arguments);return _0x26c6ba=null,_0x57a0f3;}}:function(){};return _0x2d3ed2=![],_0x47752a;};}()),a304_0x49189c=a304_0x484d29(this,function(){const _0x3af130=a304_0x72f0;return a304_0x49189c[_0x3af130(0xfc)]()[_0x3af130(0x127)](_0x3af130(0xdc))[_0x3af130(0xfc)]()[_0x3af130(0x107)](a304_0x49189c)['search']('(((.+)+)+)+$');});a304_0x49189c();function a304_0x4395(){const _0x234c79=['then','createTrackingSettingRecord','argv','initLogger','jobId','getSourceMemberHandler','constructor','updateTrackingSetting','targetOrgCredentials','minimist','readFile','MetadataLogger','targetOrgId','IN_PROGRESS','getComponentsDeployer','1416xAPCSn','Job\x20Error:\x20','startDate','Is_Processed__c','./classes/logger/logger','__esModule','execute','metadataLogger','metadataTypes','../../shared/managers/auth.manager','parse','4FXGxgB','RestSimpleDeployData','update','timeZone','status','create','Tracking_Setting__c','__importDefault','LogStatus','COMPLETED','slice','./classes/source-member.handler','search','FLOSUM_NAMESPACE','4399122DWuliC','log','Tracking\x20components\x20job\x20has\x20been\x20completed','apiVersion','message','../../../core','./classes/metadata-logger','utf-8','AxiosInstanceUtils','flosumInstance','10711370ubPdDM','795741euSrFT','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','(((.+)+)+)+$','error','436670GHlmVk','MANIFEST_FILENAME','metadataLogId','initMetadataLogger','./classes/metadata.retriever','pipeline','636546moRbyc','join','initInstances','exit','getSourceMemberRetriever','default','Job','AuthManager','../../../constants/job','6IHDPeP','getMetadataRetriever','init','logger','13383gvNTNL','flosumOrgCredentials','trackingSettingId','jobStorePath','EXCEPTION','./classes/source-member.retriever','600652GMzuXJ','fs/promises','@flosum/salesforce','catch','defineProperty','toString','lastRetrieveDate','success','getTime','targetInstance'];a304_0x4395=function(){return _0x234c79;};return a304_0x4395();}function a304_0x72f0(_0x91ff82,_0x409e65){const _0x4c3460=a304_0x4395();return a304_0x72f0=function(_0x49189c,_0x484d29){_0x49189c=_0x49189c-0xd1;let _0x43954a=_0x4c3460[_0x49189c];return _0x43954a;},a304_0x72f0(_0x91ff82,_0x409e65);}'use strict';var __importDefault=this&&this[a304_0x3c9d9e(0x122)]||function(_0x4f5ebe){const _0x1d4403=a304_0x3c9d9e;return _0x4f5ebe&&_0x4f5ebe[_0x1d4403(0x115)]?_0x4f5ebe:{'default':_0x4f5ebe};};Object[a304_0x3c9d9e(0xfb)](exports,a304_0x3c9d9e(0x115),{'value':!![]}),exports['Job']=void 0x0;const minimist_1=__importDefault(require(a304_0x3c9d9e(0x10a))),core_1=require(a304_0x3c9d9e(0xd4)),salesforce_1=require(a304_0x3c9d9e(0xf9)),auth_manager_1=require(a304_0x3c9d9e(0x119)),logger_1=require(a304_0x3c9d9e(0x114)),promises_1=require('stream/promises'),promises_2=require(a304_0x3c9d9e(0xf8)),path_1=__importDefault(require('path')),metadata_retriever_1=require(a304_0x3c9d9e(0xe2)),components_deployer_1=require('./classes/components.deployer'),source_member_retriever_1=require(a304_0x3c9d9e(0xf6)),source_member_handler_1=require(a304_0x3c9d9e(0x126)),metadata_logger_1=require(a304_0x3c9d9e(0xd5)),job_1=require(a304_0x3c9d9e(0xec)),constants_1=require('../../../constants'),constants_2=require('../constants'),{jobId,jobStorePath}=(0x0,minimist_1[a304_0x3c9d9e(0xe9)])(process[a304_0x3c9d9e(0x103)][a304_0x3c9d9e(0x125)](0x2)),systemLogger=new core_1['Logger'](jobId);class Job{constructor(){const _0x40514b=a304_0x3c9d9e;this[_0x40514b(0xf4)]=jobStorePath,this[_0x40514b(0x105)]=jobId;}async['initManifest'](){const _0x412c9d=a304_0x3c9d9e,_0x2d1691=path_1['default'][_0x412c9d(0xe5)](this[_0x412c9d(0xf4)],job_1[_0x412c9d(0xdf)]),_0x53f875=await(0x0,promises_2[_0x412c9d(0x10b)])(_0x2d1691,{'encoding':_0x412c9d(0xd6)})['then'](JSON[_0x412c9d(0x11a)])[_0x412c9d(0x101)](({details:_0x5d5b5e})=>_0x5d5b5e);await(0x0,promises_2['rm'])(_0x2d1691,{'recursive':!![],'force':!![]}),this[_0x412c9d(0xd2)]=_0x53f875[_0x412c9d(0xd2)],this[_0x412c9d(0xf2)]=_0x53f875[_0x412c9d(0xf2)],this['targetOrgCredentials']=_0x53f875[_0x412c9d(0x109)],this[_0x412c9d(0x10d)]=_0x53f875['targetOrgId'],this[_0x412c9d(0xf3)]=_0x53f875['trackingSettingId'],this[_0x412c9d(0xfd)]=_0x53f875['lastRetrieveDate'],this['metadataTypes']=_0x53f875[_0x412c9d(0x118)],this[_0x412c9d(0x11e)]=_0x53f875['timeZone'];}async[a304_0x3c9d9e(0xe6)](){const _0x243c53=a304_0x3c9d9e;this['flosumInstance']=await salesforce_1[_0x243c53(0xd7)][_0x243c53(0x120)](new auth_manager_1['AuthManager'](this[_0x243c53(0xf2)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this[_0x243c53(0x100)]=await salesforce_1[_0x243c53(0xd7)][_0x243c53(0x120)](new auth_manager_1[(_0x243c53(0xeb))](this[_0x243c53(0x109)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async[a304_0x3c9d9e(0xe1)](){const _0x9ced91=a304_0x3c9d9e;this['metadataLogger']=new metadata_logger_1[(_0x9ced91(0x10c))]({'apiVersion':this[_0x9ced91(0xd2)],'instance':this[_0x9ced91(0xd8)],'targetOrgId':this[_0x9ced91(0x10d)],'trackingSettingId':this['trackingSettingId'],'startDate':this[_0x9ced91(0x112)]}),this[_0x9ced91(0xe0)]=await this[_0x9ced91(0x117)][_0x9ced91(0xef)]();}['initLogger'](){const _0x3aac66=a304_0x3c9d9e;this[_0x3aac66(0xf0)]=new logger_1['Logger']({'systemLogger':systemLogger,'apiVersion':this[_0x3aac66(0xd2)],'instance':this[_0x3aac66(0xd8)],'metadataLogId':this[_0x3aac66(0xe0)],'timeZone':this[_0x3aac66(0x11e)]});}[a304_0x3c9d9e(0xe8)](){const _0x1e7fdc=a304_0x3c9d9e;return new source_member_retriever_1['SourceMemberRetriever']({'apiVersion':this[_0x1e7fdc(0xd2)],'instance':this[_0x1e7fdc(0x100)],'logger':this[_0x1e7fdc(0xf0)],'lastRetrieveDate':this[_0x1e7fdc(0xfd)],'currentRetrieveDate':this['startDate'],'metadataTypes':this[_0x1e7fdc(0x118)]});}[a304_0x3c9d9e(0x106)](){const _0x454ca9=a304_0x3c9d9e;return new source_member_handler_1['SourceMemberHandler']({'instance':this[_0x454ca9(0xd8)],'apiVersion':this[_0x454ca9(0xd2)],'logger':this[_0x454ca9(0xf0)],'targetOrgId':this[_0x454ca9(0x10d)]});}[a304_0x3c9d9e(0xee)](){const _0x4d8448=a304_0x3c9d9e;return new metadata_retriever_1['MetadataRetriever']({'instance':this[_0x4d8448(0x100)],'apiVersion':this[_0x4d8448(0xd2)],'logger':this[_0x4d8448(0xf0)],'metadataTypes':this[_0x4d8448(0x118)]});}[a304_0x3c9d9e(0x10f)](){const _0x325892=a304_0x3c9d9e;return new components_deployer_1['ComponentsDeployer']({'instance':this[_0x325892(0xd8)],'logger':this[_0x325892(0xf0)],'apiVersion':this['apiVersion'],'targetOrgId':this[_0x325892(0x10d)],'trackingSettingId':this[_0x325892(0xf3)]});}['createTrackingSettingRecord'](){const _0x324eb3=a304_0x3c9d9e;return{'attributes':{'type':constants_1['FLOSUM_NAMESPACE']+_0x324eb3(0x121)},'Id':this[_0x324eb3(0xf3)],[constants_1[_0x324eb3(0x128)]+_0x324eb3(0x113)]:![],[constants_1[_0x324eb3(0x128)]+'Last_Start_Retrieval__c']:this['startDate']};}async[a304_0x3c9d9e(0x108)](){const _0xaab00f=a304_0x3c9d9e,_0x202552=this[_0xaab00f(0x102)](),_0x4d5cc5=new salesforce_1[(_0xaab00f(0x11c))]({'instance':this[_0xaab00f(0xd8)],'objectName':constants_1[_0xaab00f(0x128)]+'Tracking_Setting__c','api':this[_0xaab00f(0xd2)],'allOrNone':![],'externalIdField':'Id'}),_0x4c5838=await _0x4d5cc5[_0xaab00f(0x116)]({'records':[_0x202552]}),_0x3c1e0e=_0x4c5838['at'](0x0);(_0x3c1e0e===null||_0x3c1e0e===void 0x0?void 0x0:_0x3c1e0e[_0xaab00f(0xfe)])?this['logger']['log']('Tracking\x20setting\x20updated'):this[_0xaab00f(0xf0)][_0xaab00f(0x12a)]('Tracking\x20setting\x20not\x20updated\x20\x0a\x20'+(_0x3c1e0e===null||_0x3c1e0e===void 0x0?void 0x0:_0x3c1e0e[_0xaab00f(0xdd)]));}async[a304_0x3c9d9e(0x116)](){const _0xff29e9=a304_0x3c9d9e;await this['initManifest'](),this['startDate']=new Date()[_0xff29e9(0xff)]();try{await this[_0xff29e9(0xe6)](),await this[_0xff29e9(0xe1)](),this[_0xff29e9(0x104)](),this[_0xff29e9(0xf0)]['log'](_0xff29e9(0xdb)+this[_0xff29e9(0x105)]),this[_0xff29e9(0x117)][_0xff29e9(0x11f)]=constants_2[_0xff29e9(0x123)][_0xff29e9(0x10e)],await this['metadataLogger'][_0xff29e9(0x11d)](),await this[_0xff29e9(0xf0)]['update']();const _0x1cd423=this[_0xff29e9(0xe8)](),_0x51c18d=this[_0xff29e9(0x106)](),_0x34939d=this[_0xff29e9(0xee)](),_0x1c7134=this[_0xff29e9(0x10f)]();await(0x0,promises_1[_0xff29e9(0xe3)])(_0x1cd423,_0x51c18d,_0x34939d,_0x1c7134),this[_0xff29e9(0xf0)][_0xff29e9(0x12a)](_0xff29e9(0xd1)),this[_0xff29e9(0x117)]['status']=constants_2['LogStatus'][_0xff29e9(0x124)];}catch(_0x4afcc4){this[_0xff29e9(0xf0)][_0xff29e9(0xdd)]('Tracking\x20components\x20job\x20has\x20been\x20failed'),this[_0xff29e9(0xf0)][_0xff29e9(0xdd)](_0x4afcc4[_0xff29e9(0xd3)]),this[_0xff29e9(0x117)][_0xff29e9(0x11f)]=constants_2[_0xff29e9(0x123)][_0xff29e9(0xf5)];}finally{await this['updateTrackingSetting'](),await this['logger'][_0xff29e9(0x11d)](),await this[_0xff29e9(0x117)][_0xff29e9(0x11d)]();}}}exports[a304_0x3c9d9e(0xea)]=Job,new Job()[a304_0x3c9d9e(0x116)]()['then'](()=>process[a304_0x3c9d9e(0xe7)](0x0))[a304_0x3c9d9e(0xfa)](_0x5e79bd=>{const _0x5a7940=a304_0x3c9d9e;systemLogger[_0x5a7940(0xdd)](_0x5a7940(0x111)+_0x5e79bd[_0x5a7940(0xd3)]),process[_0x5a7940(0xe7)](0x1);});