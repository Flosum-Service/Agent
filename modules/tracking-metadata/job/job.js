const a348_0x226f79=a348_0x1a07;(function(_0x31bdfd,_0x323d40){const _0x269bd5=a348_0x1a07,_0x4ae6f1=_0x31bdfd();while(!![]){try{const _0x4deead=-parseInt(_0x269bd5(0x1bf))/0x1+parseInt(_0x269bd5(0x1d4))/0x2+parseInt(_0x269bd5(0x1e3))/0x3+parseInt(_0x269bd5(0x1f3))/0x4+parseInt(_0x269bd5(0x1d1))/0x5+-parseInt(_0x269bd5(0x208))/0x6*(parseInt(_0x269bd5(0x1e7))/0x7)+-parseInt(_0x269bd5(0x1c1))/0x8*(parseInt(_0x269bd5(0x1c3))/0x9);if(_0x4deead===_0x323d40)break;else _0x4ae6f1['push'](_0x4ae6f1['shift']());}catch(_0x259cb2){_0x4ae6f1['push'](_0x4ae6f1['shift']());}}}(a348_0x3b16,0x818b4));const a348_0x1b3ea1=(function(){let _0x49ff81=!![];return function(_0x453954,_0x62af38){const _0x814f95=_0x49ff81?function(){const _0x121c18=a348_0x1a07;if(_0x62af38){const _0x363be9=_0x62af38[_0x121c18(0x1de)](_0x453954,arguments);return _0x62af38=null,_0x363be9;}}:function(){};return _0x49ff81=![],_0x814f95;};}()),a348_0xbaa7b1=a348_0x1b3ea1(this,function(){const _0x4011ea=a348_0x1a07;return a348_0xbaa7b1[_0x4011ea(0x1cb)]()['search'](_0x4011ea(0x1ea))[_0x4011ea(0x1cb)]()['constructor'](a348_0xbaa7b1)[_0x4011ea(0x1e6)](_0x4011ea(0x1ea));});function a348_0x1a07(_0x5576f6,_0x412ef6){const _0x29b685=a348_0x3b16();return a348_0x1a07=function(_0xbaa7b1,_0x1b3ea1){_0xbaa7b1=_0xbaa7b1-0x1b0;let _0x3b16c8=_0x29b685[_0xbaa7b1];return _0x3b16c8;},a348_0x1a07(_0x5576f6,_0x412ef6);}function a348_0x3b16(){const _0x4f6f58=['error','startDate','../constants','trackingSettingId','./classes/components.deployer','updateTrackingSetting','3947784yrWQnz','../../shared/managers/auth.manager','./classes/metadata.retriever','AuthManager','defineProperty','initMetadataLogger','exit','metadataTypes','metadataLogger','Tracking\x20setting\x20not\x20updated\x20\x0a\x20','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','pipeline','./classes/metadata-logger','FLOSUM_NAMESPACE','SourceMemberRetriever','initLogger','1043556YdZoTr','path','24nNIggZ','ComponentsDeployer','1048779lmXsoj','targetOrgCredentials','../../../constants','targetOrgId','./classes/source-member.retriever','RestSimpleDeployData','flosumInstance','update','toString','flosumOrgCredentials','../../../core','EXCEPTION','targetInstance','lastRetrieveDate','3008695FORkbA','AxiosInstanceUtils','log','438258cQUnXV','initManifest','__esModule','MetadataRetriever','init','parse','Last_Start_Retrieval__c','./classes/logger/logger','getSourceMemberHandler','jobId','apply','getSourceMemberRetriever','execute','message','success','2260023IhMNzR','minimist','getMetadataRetriever','search','7DzeoYK','status','LogStatus','(((.+)+)+)+$','getTime','Job','utf-8','readFile','@flosum/salesforce','argv','MetadataLogger','IN_PROGRESS','4030064ENIFxU','Tracking\x20components\x20job\x20has\x20been\x20completed','default','then','initInstances','create','createTrackingSettingRecord','MANIFEST_FILENAME','metadataLogId','Logger','Tracking_Setting__c','apiVersion','slice','COMPLETED','logger'];a348_0x3b16=function(){return _0x4f6f58;};return a348_0x3b16();}a348_0xbaa7b1();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5e4775){const _0x37ff70=a348_0x1a07;return _0x5e4775&&_0x5e4775[_0x37ff70(0x1d6)]?_0x5e4775:{'default':_0x5e4775};};Object[a348_0x226f79(0x1b3)](exports,a348_0x226f79(0x1d6),{'value':!![]}),exports['Job']=void 0x0;const minimist_1=__importDefault(require(a348_0x226f79(0x1e4))),core_1=require(a348_0x226f79(0x1cd)),salesforce_1=require(a348_0x226f79(0x1ef)),auth_manager_1=require(a348_0x226f79(0x1b0)),logger_1=require(a348_0x226f79(0x1db)),promises_1=require('stream/promises'),promises_2=require('fs/promises'),path_1=__importDefault(require(a348_0x226f79(0x1c0))),metadata_retriever_1=require(a348_0x226f79(0x1b1)),components_deployer_1=require(a348_0x226f79(0x206)),source_member_retriever_1=require(a348_0x226f79(0x1c7)),source_member_handler_1=require('./classes/source-member.handler'),metadata_logger_1=require(a348_0x226f79(0x1bb)),job_1=require('../../../constants/job'),constants_1=require(a348_0x226f79(0x1c5)),constants_2=require(a348_0x226f79(0x204)),{jobId,jobStorePath}=(0x0,minimist_1[a348_0x226f79(0x1f5)])(process[a348_0x226f79(0x1f0)][a348_0x226f79(0x1ff)](0x2)),systemLogger=new core_1['Logger'](jobId);class Job{constructor(){const _0x94a7a=a348_0x226f79;this['jobStorePath']=jobStorePath,this[_0x94a7a(0x1dd)]=jobId;}async[a348_0x226f79(0x1d5)](){const _0x19dba6=a348_0x226f79,_0x36f5cf=path_1[_0x19dba6(0x1f5)]['join'](this['jobStorePath'],job_1[_0x19dba6(0x1fa)]),_0x55d529=await(0x0,promises_2[_0x19dba6(0x1ee)])(_0x36f5cf,{'encoding':_0x19dba6(0x1ed)})['then'](JSON[_0x19dba6(0x1d9)])[_0x19dba6(0x1f6)](({details:_0x504963})=>_0x504963);await(0x0,promises_2['rm'])(_0x36f5cf,{'recursive':!![],'force':!![]}),this['apiVersion']=_0x55d529['apiVersion'],this[_0x19dba6(0x1cc)]=_0x55d529['flosumOrgCredentials'],this['targetOrgCredentials']=_0x55d529[_0x19dba6(0x1c4)],this[_0x19dba6(0x1c6)]=_0x55d529[_0x19dba6(0x1c6)],this[_0x19dba6(0x205)]=_0x55d529['trackingSettingId'],this['lastRetrieveDate']=_0x55d529[_0x19dba6(0x1d0)],this[_0x19dba6(0x1b6)]=_0x55d529[_0x19dba6(0x1b6)],this['timeZone']=_0x55d529['timeZone'];}async[a348_0x226f79(0x1f7)](){const _0xbce051=a348_0x226f79;this[_0xbce051(0x1c9)]=await salesforce_1[_0xbce051(0x1d2)][_0xbce051(0x1f8)](new auth_manager_1[(_0xbce051(0x1b2))](this[_0xbce051(0x1cc)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this['targetInstance']=await salesforce_1[_0xbce051(0x1d2)][_0xbce051(0x1f8)](new auth_manager_1[(_0xbce051(0x1b2))](this[_0xbce051(0x1c4)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async[a348_0x226f79(0x1b4)](){const _0x2985fd=a348_0x226f79;this['metadataLogger']=new metadata_logger_1[(_0x2985fd(0x1f1))]({'apiVersion':this[_0x2985fd(0x1fe)],'instance':this[_0x2985fd(0x1c9)],'targetOrgId':this[_0x2985fd(0x1c6)],'trackingSettingId':this[_0x2985fd(0x205)],'startDate':this['startDate']}),this[_0x2985fd(0x1fb)]=await this[_0x2985fd(0x1b7)][_0x2985fd(0x1d8)]();}[a348_0x226f79(0x1be)](){const _0x379ebc=a348_0x226f79;this[_0x379ebc(0x201)]=new logger_1[(_0x379ebc(0x1fc))]({'systemLogger':systemLogger,'apiVersion':this['apiVersion'],'instance':this[_0x379ebc(0x1c9)],'metadataLogId':this['metadataLogId'],'timeZone':this['timeZone']});}[a348_0x226f79(0x1df)](){const _0x5193c9=a348_0x226f79;return new source_member_retriever_1[(_0x5193c9(0x1bd))]({'apiVersion':this[_0x5193c9(0x1fe)],'instance':this[_0x5193c9(0x1cf)],'logger':this['logger'],'lastRetrieveDate':this[_0x5193c9(0x1d0)],'currentRetrieveDate':this[_0x5193c9(0x203)],'metadataTypes':this[_0x5193c9(0x1b6)]});}[a348_0x226f79(0x1dc)](){const _0x3533d6=a348_0x226f79;return new source_member_handler_1['SourceMemberHandler']({'instance':this['flosumInstance'],'apiVersion':this['apiVersion'],'logger':this[_0x3533d6(0x201)],'targetOrgId':this[_0x3533d6(0x1c6)]});}['getMetadataRetriever'](){const _0x31ee71=a348_0x226f79;return new metadata_retriever_1[(_0x31ee71(0x1d7))]({'instance':this[_0x31ee71(0x1cf)],'apiVersion':this[_0x31ee71(0x1fe)],'logger':this['logger'],'metadataTypes':this['metadataTypes']});}['getComponentsDeployer'](){const _0x4c6f2e=a348_0x226f79;return new components_deployer_1[(_0x4c6f2e(0x1c2))]({'instance':this[_0x4c6f2e(0x1c9)],'logger':this[_0x4c6f2e(0x201)],'apiVersion':this[_0x4c6f2e(0x1fe)],'targetOrgId':this['targetOrgId'],'trackingSettingId':this[_0x4c6f2e(0x205)]});}['createTrackingSettingRecord'](){const _0x54f7d3=a348_0x226f79;return{'attributes':{'type':constants_1['FLOSUM_NAMESPACE']+'Tracking_Setting__c'},'Id':this[_0x54f7d3(0x205)],[constants_1['FLOSUM_NAMESPACE']+'Is_Processed__c']:![],[constants_1[_0x54f7d3(0x1bc)]+_0x54f7d3(0x1da)]:this['startDate']};}async['updateTrackingSetting'](){const _0x5e1b80=a348_0x226f79,_0x314bed=this[_0x5e1b80(0x1f9)](),_0x5e2a2e=new salesforce_1[(_0x5e1b80(0x1c8))]({'instance':this['flosumInstance'],'objectName':constants_1['FLOSUM_NAMESPACE']+_0x5e1b80(0x1fd),'api':this[_0x5e1b80(0x1fe)],'allOrNone':![],'externalIdField':'Id'}),_0x52f7ed=await _0x5e2a2e[_0x5e1b80(0x1e0)]({'records':[_0x314bed]}),_0x36abc5=_0x52f7ed['at'](0x0);(_0x36abc5===null||_0x36abc5===void 0x0?void 0x0:_0x36abc5[_0x5e1b80(0x1e2)])?this['logger'][_0x5e1b80(0x1d3)]('Tracking\x20setting\x20updated'):this['logger'][_0x5e1b80(0x1d3)](_0x5e1b80(0x1b8)+(_0x36abc5===null||_0x36abc5===void 0x0?void 0x0:_0x36abc5[_0x5e1b80(0x202)]));}async[a348_0x226f79(0x1e0)](){const _0x27504b=a348_0x226f79;await this['initManifest'](),this[_0x27504b(0x203)]=new Date()[_0x27504b(0x1eb)]();try{await this[_0x27504b(0x1f7)](),await this['initMetadataLogger'](),this[_0x27504b(0x1be)](),this[_0x27504b(0x201)][_0x27504b(0x1d3)](_0x27504b(0x1b9)+this['jobId']),this[_0x27504b(0x1b7)][_0x27504b(0x1e8)]=constants_2[_0x27504b(0x1e9)][_0x27504b(0x1f2)],await this['metadataLogger'][_0x27504b(0x1ca)](),await this[_0x27504b(0x201)]['update']();const _0x552127=this[_0x27504b(0x1df)](),_0x5d38ef=this[_0x27504b(0x1dc)](),_0x1e62a9=this[_0x27504b(0x1e5)](),_0x2ba1ea=this['getComponentsDeployer']();await(0x0,promises_1[_0x27504b(0x1ba)])(_0x552127,_0x5d38ef,_0x1e62a9,_0x2ba1ea),this['logger'][_0x27504b(0x1d3)](_0x27504b(0x1f4)),this['metadataLogger']['status']=constants_2[_0x27504b(0x1e9)][_0x27504b(0x200)];}catch(_0x150fa2){this[_0x27504b(0x201)][_0x27504b(0x202)]('Tracking\x20components\x20job\x20has\x20been\x20failed'),this[_0x27504b(0x201)][_0x27504b(0x202)](_0x150fa2['message']),this['metadataLogger'][_0x27504b(0x1e8)]=constants_2[_0x27504b(0x1e9)][_0x27504b(0x1ce)];}finally{await this[_0x27504b(0x207)](),await this[_0x27504b(0x201)][_0x27504b(0x1ca)](),await this['metadataLogger'][_0x27504b(0x1ca)]();}}}exports[a348_0x226f79(0x1ec)]=Job,new Job()['execute']()[a348_0x226f79(0x1f6)](()=>process[a348_0x226f79(0x1b5)](0x0))['catch'](_0x1becb1=>{const _0x32c42b=a348_0x226f79;systemLogger['error']('Job\x20Error:\x20'+_0x1becb1[_0x32c42b(0x1e1)]),process[_0x32c42b(0x1b5)](0x1);});