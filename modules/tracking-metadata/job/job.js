const a347_0x30ef45=a347_0x5d8a;(function(_0x4ae433,_0x340659){const _0x58af09=a347_0x5d8a,_0x4495e7=_0x4ae433();while(!![]){try{const _0x59cbd3=parseInt(_0x58af09(0xc3))/0x1*(-parseInt(_0x58af09(0xbd))/0x2)+-parseInt(_0x58af09(0x79))/0x3+-parseInt(_0x58af09(0x7b))/0x4*(-parseInt(_0x58af09(0x77))/0x5)+parseInt(_0x58af09(0x9d))/0x6*(-parseInt(_0x58af09(0xb3))/0x7)+-parseInt(_0x58af09(0xb5))/0x8+parseInt(_0x58af09(0x68))/0x9*(-parseInt(_0x58af09(0xa8))/0xa)+parseInt(_0x58af09(0x8e))/0xb;if(_0x59cbd3===_0x340659)break;else _0x4495e7['push'](_0x4495e7['shift']());}catch(_0x1bde14){_0x4495e7['push'](_0x4495e7['shift']());}}}(a347_0x1279,0xb54ae));const a347_0x2b142f=(function(){let _0x4a1c2d=!![];return function(_0x27def8,_0x425a37){const _0x139a9c=_0x4a1c2d?function(){if(_0x425a37){const _0x41bdfe=_0x425a37['apply'](_0x27def8,arguments);return _0x425a37=null,_0x41bdfe;}}:function(){};return _0x4a1c2d=![],_0x139a9c;};}()),a347_0x44cd98=a347_0x2b142f(this,function(){const _0x56cc13=a347_0x5d8a;return a347_0x44cd98[_0x56cc13(0x98)]()[_0x56cc13(0x90)](_0x56cc13(0xc2))[_0x56cc13(0x98)]()['constructor'](a347_0x44cd98)[_0x56cc13(0x90)](_0x56cc13(0xc2));});a347_0x44cd98();function a347_0x1279(){const _0x4bb7ba=['getSourceMemberHandler','__esModule','apiVersion','(((.+)+)+)+$','2WZOmDt','63wKNOJD','logger','startDate','SourceMemberRetriever','join','jobId','jobStorePath','init','getMetadataRetriever','create','parse','exit','pipeline','lastRetrieveDate','message','7410wZrKrm','trackingSettingId','4108365KcBgrC','initLogger','940iXWWgk','getTime','default','COMPLETED','stream/promises','SourceMemberHandler','slice','__importDefault','./classes/components.deployer','./classes/source-member.handler','fs/promises','MetadataLogger','getComponentsDeployer','then','Job','../constants','createTrackingSettingRecord','timeZone','FLOSUM_NAMESPACE','57090275uOceCe','metadataLogId','search','Last_Start_Retrieval__c','RestSimpleDeployData','Logger','minimist','ComponentsDeployer','../../shared/managers/auth.manager','getSourceMemberRetriever','toString','targetOrgCredentials','defineProperty','update','execute','1512leEsaV','@flosum/salesforce','status','updateTrackingSetting','metadataLogger','Tracking_Setting__c','argv','LogStatus','initMetadataLogger','targetOrgId','initInstances','1397880odoDdP','catch','Job\x20Error:\x20','log','./classes/source-member.retriever','initManifest','AxiosInstanceUtils','MetadataRetriever','AuthManager','readFile','Tracking\x20setting\x20updated','33110lGzjKS','metadataTypes','6669776vBloyf','./classes/metadata.retriever','Tracking\x20components\x20job\x20has\x20been\x20completed','IN_PROGRESS','flosumInstance','Tracking\x20components\x20job\x20has\x20been\x20failed','error','targetInstance','422068NRZgjn','./classes/metadata-logger'];a347_0x1279=function(){return _0x4bb7ba;};return a347_0x1279();}'use strict';var __importDefault=this&&this[a347_0x30ef45(0x82)]||function(_0xf6d095){const _0x4cc81a=a347_0x30ef45;return _0xf6d095&&_0xf6d095[_0x4cc81a(0xc0)]?_0xf6d095:{'default':_0xf6d095};};Object[a347_0x30ef45(0x9a)](exports,a347_0x30ef45(0xc0),{'value':!![]}),exports[a347_0x30ef45(0x89)]=void 0x0;function a347_0x5d8a(_0x59b684,_0x1d9acf){const _0x2f803b=a347_0x1279();return a347_0x5d8a=function(_0x44cd98,_0x2b142f){_0x44cd98=_0x44cd98-0x68;let _0x1279af=_0x2f803b[_0x44cd98];return _0x1279af;},a347_0x5d8a(_0x59b684,_0x1d9acf);}const minimist_1=__importDefault(require(a347_0x30ef45(0x94))),core_1=require('../../../core'),salesforce_1=require(a347_0x30ef45(0x9e)),auth_manager_1=require(a347_0x30ef45(0x96)),logger_1=require('./classes/logger/logger'),promises_1=require(a347_0x30ef45(0x7f)),promises_2=require(a347_0x30ef45(0x85)),path_1=__importDefault(require('path')),metadata_retriever_1=require(a347_0x30ef45(0xb6)),components_deployer_1=require(a347_0x30ef45(0x83)),source_member_retriever_1=require(a347_0x30ef45(0xac)),source_member_handler_1=require(a347_0x30ef45(0x84)),metadata_logger_1=require(a347_0x30ef45(0xbe)),job_1=require('../../../constants/job'),constants_1=require('../../../constants'),constants_2=require(a347_0x30ef45(0x8a)),{jobId,jobStorePath}=(0x0,minimist_1['default'])(process[a347_0x30ef45(0xa3)][a347_0x30ef45(0x81)](0x2)),systemLogger=new core_1[(a347_0x30ef45(0x93))](jobId);class Job{constructor(){const _0x344767=a347_0x30ef45;this[_0x344767(0x6e)]=jobStorePath,this['jobId']=jobId;}async[a347_0x30ef45(0xad)](){const _0x5ba322=a347_0x30ef45,_0x553f18=path_1[_0x5ba322(0x7d)][_0x5ba322(0x6c)](this['jobStorePath'],job_1['MANIFEST_FILENAME']),_0x54e044=await(0x0,promises_2[_0x5ba322(0xb1)])(_0x553f18,{'encoding':'utf-8'})['then'](JSON[_0x5ba322(0x72)])[_0x5ba322(0x88)](({details:_0x2704c9})=>_0x2704c9);await(0x0,promises_2['rm'])(_0x553f18,{'recursive':!![],'force':!![]}),this[_0x5ba322(0xc1)]=_0x54e044[_0x5ba322(0xc1)],this['flosumOrgCredentials']=_0x54e044['flosumOrgCredentials'],this['targetOrgCredentials']=_0x54e044[_0x5ba322(0x99)],this[_0x5ba322(0xa6)]=_0x54e044[_0x5ba322(0xa6)],this[_0x5ba322(0x78)]=_0x54e044[_0x5ba322(0x78)],this[_0x5ba322(0x75)]=_0x54e044[_0x5ba322(0x75)],this[_0x5ba322(0xb4)]=_0x54e044[_0x5ba322(0xb4)],this[_0x5ba322(0x8c)]=_0x54e044['timeZone'];}async[a347_0x30ef45(0xa7)](){const _0x55d114=a347_0x30ef45;this['flosumInstance']=await salesforce_1[_0x55d114(0xae)]['create'](new auth_manager_1[(_0x55d114(0xb0))](this['flosumOrgCredentials']),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this['targetInstance']=await salesforce_1[_0x55d114(0xae)][_0x55d114(0x71)](new auth_manager_1[(_0x55d114(0xb0))](this[_0x55d114(0x99)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async[a347_0x30ef45(0xa5)](){const _0x2640e0=a347_0x30ef45;this[_0x2640e0(0xa1)]=new metadata_logger_1[(_0x2640e0(0x86))]({'apiVersion':this[_0x2640e0(0xc1)],'instance':this[_0x2640e0(0xb9)],'targetOrgId':this[_0x2640e0(0xa6)],'trackingSettingId':this[_0x2640e0(0x78)],'startDate':this[_0x2640e0(0x6a)]}),this[_0x2640e0(0x8f)]=await this[_0x2640e0(0xa1)][_0x2640e0(0x6f)]();}['initLogger'](){const _0x31e69b=a347_0x30ef45;this[_0x31e69b(0x69)]=new logger_1['Logger']({'systemLogger':systemLogger,'apiVersion':this[_0x31e69b(0xc1)],'instance':this[_0x31e69b(0xb9)],'metadataLogId':this['metadataLogId'],'timeZone':this['timeZone']});}[a347_0x30ef45(0x97)](){const _0x53efbf=a347_0x30ef45;return new source_member_retriever_1[(_0x53efbf(0x6b))]({'apiVersion':this[_0x53efbf(0xc1)],'instance':this[_0x53efbf(0xbc)],'logger':this[_0x53efbf(0x69)],'lastRetrieveDate':this['lastRetrieveDate'],'currentRetrieveDate':this['startDate'],'metadataTypes':this['metadataTypes']});}[a347_0x30ef45(0xbf)](){const _0x7d5e24=a347_0x30ef45;return new source_member_handler_1[(_0x7d5e24(0x80))]({'instance':this[_0x7d5e24(0xb9)],'apiVersion':this[_0x7d5e24(0xc1)],'logger':this['logger'],'targetOrgId':this[_0x7d5e24(0xa6)]});}['getMetadataRetriever'](){const _0x27d1d5=a347_0x30ef45;return new metadata_retriever_1[(_0x27d1d5(0xaf))]({'instance':this[_0x27d1d5(0xbc)],'apiVersion':this[_0x27d1d5(0xc1)],'logger':this['logger'],'metadataTypes':this[_0x27d1d5(0xb4)]});}[a347_0x30ef45(0x87)](){const _0x312fa1=a347_0x30ef45;return new components_deployer_1[(_0x312fa1(0x95))]({'instance':this[_0x312fa1(0xb9)],'logger':this['logger'],'apiVersion':this[_0x312fa1(0xc1)],'targetOrgId':this['targetOrgId'],'trackingSettingId':this['trackingSettingId']});}[a347_0x30ef45(0x8b)](){const _0x403470=a347_0x30ef45;return{'attributes':{'type':constants_1['FLOSUM_NAMESPACE']+_0x403470(0xa2)},'Id':this['trackingSettingId'],[constants_1[_0x403470(0x8d)]+'Is_Processed__c']:![],[constants_1['FLOSUM_NAMESPACE']+_0x403470(0x91)]:this['startDate']};}async[a347_0x30ef45(0xa0)](){const _0xf278bb=a347_0x30ef45,_0x1e70ea=this[_0xf278bb(0x8b)](),_0x182729=new salesforce_1[(_0xf278bb(0x92))]({'instance':this[_0xf278bb(0xb9)],'objectName':constants_1[_0xf278bb(0x8d)]+_0xf278bb(0xa2),'api':this[_0xf278bb(0xc1)],'allOrNone':![],'externalIdField':'Id'}),_0xab5019=await _0x182729[_0xf278bb(0x9c)]({'records':[_0x1e70ea]}),_0x2d540e=_0xab5019['at'](0x0);(_0x2d540e===null||_0x2d540e===void 0x0?void 0x0:_0x2d540e['success'])?this[_0xf278bb(0x69)][_0xf278bb(0xab)](_0xf278bb(0xb2)):this[_0xf278bb(0x69)]['log']('Tracking\x20setting\x20not\x20updated\x20\x0a\x20'+(_0x2d540e===null||_0x2d540e===void 0x0?void 0x0:_0x2d540e[_0xf278bb(0xbb)]));}async[a347_0x30ef45(0x9c)](){const _0x2f5937=a347_0x30ef45;await this[_0x2f5937(0xad)](),this[_0x2f5937(0x6a)]=new Date()[_0x2f5937(0x7c)]();try{await this[_0x2f5937(0xa7)](),await this[_0x2f5937(0xa5)](),this[_0x2f5937(0x7a)](),this[_0x2f5937(0x69)][_0x2f5937(0xab)]('Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20'+this[_0x2f5937(0x6d)]),this['metadataLogger'][_0x2f5937(0x9f)]=constants_2['LogStatus'][_0x2f5937(0xb8)],await this[_0x2f5937(0xa1)][_0x2f5937(0x9b)](),await this[_0x2f5937(0x69)][_0x2f5937(0x9b)]();const _0x31c40d=this['getSourceMemberRetriever'](),_0x1b6d43=this['getSourceMemberHandler'](),_0x2bc325=this[_0x2f5937(0x70)](),_0x33495d=this[_0x2f5937(0x87)]();await(0x0,promises_1[_0x2f5937(0x74)])(_0x31c40d,_0x1b6d43,_0x2bc325,_0x33495d),this[_0x2f5937(0x69)]['log'](_0x2f5937(0xb7)),this[_0x2f5937(0xa1)][_0x2f5937(0x9f)]=constants_2[_0x2f5937(0xa4)][_0x2f5937(0x7e)];}catch(_0x985614){this['logger'][_0x2f5937(0xbb)](_0x2f5937(0xba)),this['logger']['error'](_0x985614['message']),this[_0x2f5937(0xa1)][_0x2f5937(0x9f)]=constants_2[_0x2f5937(0xa4)]['EXCEPTION'];}finally{await this['updateTrackingSetting'](),await this[_0x2f5937(0x69)][_0x2f5937(0x9b)](),await this[_0x2f5937(0xa1)]['update']();}}}exports[a347_0x30ef45(0x89)]=Job,new Job()[a347_0x30ef45(0x9c)]()[a347_0x30ef45(0x88)](()=>process[a347_0x30ef45(0x73)](0x0))[a347_0x30ef45(0xa9)](_0x35e194=>{const _0x1594b1=a347_0x30ef45;systemLogger[_0x1594b1(0xbb)](_0x1594b1(0xaa)+_0x35e194[_0x1594b1(0x76)]),process[_0x1594b1(0x73)](0x1);});