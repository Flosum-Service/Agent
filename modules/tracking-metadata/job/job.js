const a320_0xa98c5e=a320_0x4e3d;function a320_0x4e3d(_0x571bce,_0x4a2408){const _0x3dab3c=a320_0x3279();return a320_0x4e3d=function(_0x12a6f7,_0x5af00d){_0x12a6f7=_0x12a6f7-0xb5;let _0x3279d0=_0x3dab3c[_0x12a6f7];return _0x3279d0;},a320_0x4e3d(_0x571bce,_0x4a2408);}(function(_0xdb39a9,_0x14f16e){const _0x264b64=a320_0x4e3d,_0x2078cc=_0xdb39a9();while(!![]){try{const _0x4d3afd=parseInt(_0x264b64(0xf5))/0x1+-parseInt(_0x264b64(0xe7))/0x2+parseInt(_0x264b64(0x109))/0x3+-parseInt(_0x264b64(0xec))/0x4+parseInt(_0x264b64(0xbd))/0x5+parseInt(_0x264b64(0xf8))/0x6+-parseInt(_0x264b64(0x102))/0x7;if(_0x4d3afd===_0x14f16e)break;else _0x2078cc['push'](_0x2078cc['shift']());}catch(_0x14dc00){_0x2078cc['push'](_0x2078cc['shift']());}}}(a320_0x3279,0x72e7b));const a320_0x5af00d=(function(){let _0x30b6c5=!![];return function(_0x294cfa,_0x3be614){const _0x54adf9=_0x30b6c5?function(){if(_0x3be614){const _0x3f8ee0=_0x3be614['apply'](_0x294cfa,arguments);return _0x3be614=null,_0x3f8ee0;}}:function(){};return _0x30b6c5=![],_0x54adf9;};}()),a320_0x12a6f7=a320_0x5af00d(this,function(){const _0x473942=a320_0x4e3d;return a320_0x12a6f7[_0x473942(0xc5)]()['search'](_0x473942(0xd5))['toString']()[_0x473942(0x108)](a320_0x12a6f7)[_0x473942(0xf0)](_0x473942(0xd5));});a320_0x12a6f7();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5e2b76){const _0x582b59=a320_0x4e3d;return _0x5e2b76&&_0x5e2b76[_0x582b59(0xf6)]?_0x5e2b76:{'default':_0x5e2b76};};function a320_0x3279(){const _0x56962f=['getSourceMemberRetriever','initMetadataLogger','Tracking\x20setting\x20not\x20updated\x20\x0a\x20','jobStorePath','slice','../constants','@flosum/salesforce','getComponentsDeployer','./classes/logger/logger','MetadataLogger','apiVersion','log','defineProperty','logger','Logger','(((.+)+)+)+$','stream/promises','pipeline','flosumInstance','argv','flosumOrgCredentials','./classes/metadata-logger','Tracking_Setting__c','initLogger','message','getMetadataRetriever','default','MANIFEST_FILENAME','SourceMemberRetriever','AuthManager','targetOrgCredentials','SourceMemberHandler','fs/promises','824566hEJHnp','EXCEPTION','createTrackingSettingRecord','getSourceMemberHandler','error','1967364pMcYpQ','targetOrgId','COMPLETED','targetInstance','search','AxiosInstanceUtils','LogStatus','lastRetrieveDate','Tracking\x20components\x20job\x20has\x20been\x20failed','699408SjJxCW','__esModule','Tracking\x20components\x20job\x20has\x20been\x20completed','5374518cxAxGg','./classes/source-member.retriever','../../shared/managers/auth.manager','Last_Start_Retrieval__c','../../../constants','../../../core','then','getTime','initManifest','join','8361045fkXHum','catch','startDate','Is_Processed__c','metadataLogId','execute','constructor','2337360UdRtWA','ComponentsDeployer','timeZone','exit','metadataLogger','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','RestSimpleDeployData','status','utf-8','FLOSUM_NAMESPACE','../../../constants/job','initInstances','create','974645smZhTt','update','./classes/components.deployer','Job\x20Error:\x20','trackingSettingId','./classes/metadata.retriever','metadataTypes','Job','toString'];a320_0x3279=function(){return _0x56962f;};return a320_0x3279();}Object[a320_0xa98c5e(0xd2)](exports,'__esModule',{'value':!![]}),exports[a320_0xa98c5e(0xc4)]=void 0x0;const minimist_1=__importDefault(require('minimist')),core_1=require(a320_0xa98c5e(0xfd)),salesforce_1=require(a320_0xa98c5e(0xcc)),auth_manager_1=require(a320_0xa98c5e(0xfa)),logger_1=require(a320_0xa98c5e(0xce)),promises_1=require(a320_0xa98c5e(0xd6)),promises_2=require(a320_0xa98c5e(0xe6)),path_1=__importDefault(require('path')),metadata_retriever_1=require(a320_0xa98c5e(0xc2)),components_deployer_1=require(a320_0xa98c5e(0xbf)),source_member_retriever_1=require(a320_0xa98c5e(0xf9)),source_member_handler_1=require('./classes/source-member.handler'),metadata_logger_1=require(a320_0xa98c5e(0xdb)),job_1=require(a320_0xa98c5e(0xba)),constants_1=require(a320_0xa98c5e(0xfc)),constants_2=require(a320_0xa98c5e(0xcb)),{jobId,jobStorePath}=(0x0,minimist_1[a320_0xa98c5e(0xe0)])(process[a320_0xa98c5e(0xd9)][a320_0xa98c5e(0xca)](0x2)),systemLogger=new core_1['Logger'](jobId);class Job{constructor(){const _0x4ed871=a320_0xa98c5e;this[_0x4ed871(0xc9)]=jobStorePath,this['jobId']=jobId;}async['initManifest'](){const _0x135103=a320_0xa98c5e,_0x1905fd=path_1[_0x135103(0xe0)][_0x135103(0x101)](this[_0x135103(0xc9)],job_1[_0x135103(0xe1)]),_0x1f4172=await(0x0,promises_2['readFile'])(_0x1905fd,{'encoding':_0x135103(0xb8)})[_0x135103(0xfe)](JSON['parse'])[_0x135103(0xfe)](({details:_0x2fba52})=>_0x2fba52);await(0x0,promises_2['rm'])(_0x1905fd,{'recursive':!![],'force':!![]}),this[_0x135103(0xd0)]=_0x1f4172[_0x135103(0xd0)],this[_0x135103(0xda)]=_0x1f4172[_0x135103(0xda)],this[_0x135103(0xe4)]=_0x1f4172['targetOrgCredentials'],this[_0x135103(0xed)]=_0x1f4172[_0x135103(0xed)],this[_0x135103(0xc1)]=_0x1f4172[_0x135103(0xc1)],this[_0x135103(0xf3)]=_0x1f4172[_0x135103(0xf3)],this[_0x135103(0xc3)]=_0x1f4172[_0x135103(0xc3)],this[_0x135103(0x10b)]=_0x1f4172[_0x135103(0x10b)];}async['initInstances'](){const _0x1e8f20=a320_0xa98c5e;this[_0x1e8f20(0xd8)]=await salesforce_1[_0x1e8f20(0xf1)][_0x1e8f20(0xbc)](new auth_manager_1[(_0x1e8f20(0xe3))](this[_0x1e8f20(0xda)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this[_0x1e8f20(0xef)]=await salesforce_1[_0x1e8f20(0xf1)]['create'](new auth_manager_1[(_0x1e8f20(0xe3))](this['targetOrgCredentials']),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async['initMetadataLogger'](){const _0x3059e6=a320_0xa98c5e;this[_0x3059e6(0x10d)]=new metadata_logger_1[(_0x3059e6(0xcf))]({'apiVersion':this['apiVersion'],'instance':this[_0x3059e6(0xd8)],'targetOrgId':this[_0x3059e6(0xed)],'trackingSettingId':this[_0x3059e6(0xc1)],'startDate':this[_0x3059e6(0x104)]}),this[_0x3059e6(0x106)]=await this[_0x3059e6(0x10d)]['init']();}[a320_0xa98c5e(0xdd)](){const _0x322ee8=a320_0xa98c5e;this[_0x322ee8(0xd3)]=new logger_1[(_0x322ee8(0xd4))]({'systemLogger':systemLogger,'apiVersion':this[_0x322ee8(0xd0)],'instance':this[_0x322ee8(0xd8)],'metadataLogId':this[_0x322ee8(0x106)],'timeZone':this['timeZone']});}['getSourceMemberRetriever'](){const _0x1102f0=a320_0xa98c5e;return new source_member_retriever_1[(_0x1102f0(0xe2))]({'apiVersion':this[_0x1102f0(0xd0)],'instance':this[_0x1102f0(0xef)],'logger':this[_0x1102f0(0xd3)],'lastRetrieveDate':this[_0x1102f0(0xf3)],'currentRetrieveDate':this[_0x1102f0(0x104)],'metadataTypes':this[_0x1102f0(0xc3)]});}[a320_0xa98c5e(0xea)](){const _0x25aeed=a320_0xa98c5e;return new source_member_handler_1[(_0x25aeed(0xe5))]({'instance':this['flosumInstance'],'apiVersion':this['apiVersion'],'logger':this[_0x25aeed(0xd3)],'targetOrgId':this[_0x25aeed(0xed)]});}[a320_0xa98c5e(0xdf)](){const _0x3d06b4=a320_0xa98c5e;return new metadata_retriever_1['MetadataRetriever']({'instance':this['targetInstance'],'apiVersion':this['apiVersion'],'logger':this['logger'],'metadataTypes':this[_0x3d06b4(0xc3)]});}[a320_0xa98c5e(0xcd)](){const _0x39530c=a320_0xa98c5e;return new components_deployer_1[(_0x39530c(0x10a))]({'instance':this[_0x39530c(0xd8)],'logger':this['logger'],'apiVersion':this[_0x39530c(0xd0)],'targetOrgId':this[_0x39530c(0xed)],'trackingSettingId':this[_0x39530c(0xc1)]});}[a320_0xa98c5e(0xe9)](){const _0x32ae89=a320_0xa98c5e;return{'attributes':{'type':constants_1[_0x32ae89(0xb9)]+_0x32ae89(0xdc)},'Id':this[_0x32ae89(0xc1)],[constants_1[_0x32ae89(0xb9)]+_0x32ae89(0x105)]:![],[constants_1[_0x32ae89(0xb9)]+_0x32ae89(0xfb)]:this[_0x32ae89(0x104)]};}async['updateTrackingSetting'](){const _0x47fe4d=a320_0xa98c5e,_0x50ea79=this[_0x47fe4d(0xe9)](),_0x786166=new salesforce_1[(_0x47fe4d(0xb6))]({'instance':this[_0x47fe4d(0xd8)],'objectName':constants_1['FLOSUM_NAMESPACE']+_0x47fe4d(0xdc),'api':this['apiVersion'],'allOrNone':![],'externalIdField':'Id'}),_0x823bab=await _0x786166[_0x47fe4d(0x107)]({'records':[_0x50ea79]}),_0x55da75=_0x823bab['at'](0x0);(_0x55da75===null||_0x55da75===void 0x0?void 0x0:_0x55da75['success'])?this[_0x47fe4d(0xd3)][_0x47fe4d(0xd1)]('Tracking\x20setting\x20updated'):this[_0x47fe4d(0xd3)][_0x47fe4d(0xd1)](_0x47fe4d(0xc8)+(_0x55da75===null||_0x55da75===void 0x0?void 0x0:_0x55da75[_0x47fe4d(0xeb)]));}async[a320_0xa98c5e(0x107)](){const _0x28b3ea=a320_0xa98c5e;await this[_0x28b3ea(0x100)](),this[_0x28b3ea(0x104)]=new Date()[_0x28b3ea(0xff)]();try{await this[_0x28b3ea(0xbb)](),await this[_0x28b3ea(0xc7)](),this[_0x28b3ea(0xdd)](),this[_0x28b3ea(0xd3)][_0x28b3ea(0xd1)](_0x28b3ea(0xb5)+this['jobId']),this[_0x28b3ea(0x10d)]['status']=constants_2['LogStatus']['IN_PROGRESS'],await this[_0x28b3ea(0x10d)][_0x28b3ea(0xbe)](),await this['logger'][_0x28b3ea(0xbe)]();const _0x19c208=this[_0x28b3ea(0xc6)](),_0x1ce0b0=this[_0x28b3ea(0xea)](),_0x484d41=this['getMetadataRetriever'](),_0x35a916=this['getComponentsDeployer']();await(0x0,promises_1[_0x28b3ea(0xd7)])(_0x19c208,_0x1ce0b0,_0x484d41,_0x35a916),this[_0x28b3ea(0xd3)][_0x28b3ea(0xd1)](_0x28b3ea(0xf7)),this[_0x28b3ea(0x10d)][_0x28b3ea(0xb7)]=constants_2[_0x28b3ea(0xf2)][_0x28b3ea(0xee)];}catch(_0x21b17c){this['logger'][_0x28b3ea(0xeb)](_0x28b3ea(0xf4)),this[_0x28b3ea(0xd3)][_0x28b3ea(0xeb)](_0x21b17c[_0x28b3ea(0xde)]),this[_0x28b3ea(0x10d)]['status']=constants_2[_0x28b3ea(0xf2)][_0x28b3ea(0xe8)];}finally{await this['updateTrackingSetting'](),await this['logger'][_0x28b3ea(0xbe)](),await this[_0x28b3ea(0x10d)][_0x28b3ea(0xbe)]();}}}exports['Job']=Job,new Job()[a320_0xa98c5e(0x107)]()[a320_0xa98c5e(0xfe)](()=>process[a320_0xa98c5e(0x10c)](0x0))[a320_0xa98c5e(0x103)](_0x477d02=>{const _0x1506e8=a320_0xa98c5e;systemLogger[_0x1506e8(0xeb)](_0x1506e8(0xc0)+_0x477d02[_0x1506e8(0xde)]),process['exit'](0x1);});