const a336_0x3cc4a1=a336_0x4675;(function(_0x5c5104,_0x51df6a){const _0xfc5b8a=a336_0x4675,_0x3a238d=_0x5c5104();while(!![]){try{const _0x149371=parseInt(_0xfc5b8a(0x1ee))/0x1*(parseInt(_0xfc5b8a(0x208))/0x2)+-parseInt(_0xfc5b8a(0x1f3))/0x3*(parseInt(_0xfc5b8a(0x1e9))/0x4)+-parseInt(_0xfc5b8a(0x1f2))/0x5*(parseInt(_0xfc5b8a(0x1da))/0x6)+-parseInt(_0xfc5b8a(0x1d7))/0x7*(parseInt(_0xfc5b8a(0x22a))/0x8)+-parseInt(_0xfc5b8a(0x202))/0x9*(-parseInt(_0xfc5b8a(0x1ef))/0xa)+parseInt(_0xfc5b8a(0x22b))/0xb+parseInt(_0xfc5b8a(0x21a))/0xc;if(_0x149371===_0x51df6a)break;else _0x3a238d['push'](_0x3a238d['shift']());}catch(_0x5a2a49){_0x3a238d['push'](_0x3a238d['shift']());}}}(a336_0x550c,0xdfe8b));const a336_0x153f3a=(function(){let _0x247057=!![];return function(_0x3d1ea4,_0x3b1052){const _0x19dee0=_0x247057?function(){const _0x8a9f13=a336_0x4675;if(_0x3b1052){const _0x4a8a02=_0x3b1052[_0x8a9f13(0x21e)](_0x3d1ea4,arguments);return _0x3b1052=null,_0x4a8a02;}}:function(){};return _0x247057=![],_0x19dee0;};}()),a336_0x40611e=a336_0x153f3a(this,function(){const _0x265785=a336_0x4675;return a336_0x40611e['toString']()[_0x265785(0x204)](_0x265785(0x206))[_0x265785(0x203)]()[_0x265785(0x1d3)](a336_0x40611e)[_0x265785(0x204)](_0x265785(0x206));});function a336_0x4675(_0x31abec,_0x17e7a8){const _0x1acf42=a336_0x550c();return a336_0x4675=function(_0x40611e,_0x153f3a){_0x40611e=_0x40611e-0x1d3;let _0x550c48=_0x1acf42[_0x40611e];return _0x550c48;},a336_0x4675(_0x31abec,_0x17e7a8);}function a336_0x550c(){const _0x34343e=['timeZone','targetOrgId','pipeline','catch','IN_PROGRESS','execute','./classes/components.deployer','MetadataLogger','24bUuYhv','createTrackingSettingRecord','./classes/source-member.retriever','SourceMemberHandler','exit','236476xLcArJ','20dutRyC','status','success','5057155Dsrvgt','683703jwhcyI','targetInstance','then','metadataTypes','Job\x20Error:\x20','AuthManager','MetadataRetriever','updateTrackingSetting','startDate','flosumInstance','SourceMemberRetriever','stream/promises','COMPLETED','default','getMetadataRetriever','567414vTGzGI','toString','search','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','(((.+)+)+)+$','path','4aqrMLx','initMetadataLogger','argv','Tracking\x20setting\x20updated','Tracking_Setting__c','getSourceMemberHandler','defineProperty','parse','Is_Processed__c','apiVersion','metadataLogger','join','initLogger','Tracking\x20components\x20job\x20has\x20been\x20failed','getComponentsDeployer','EXCEPTION','minimist','update','16209084alzLty','FLOSUM_NAMESPACE','initInstances','getSourceMemberRetriever','apply','RestSimpleDeployData','metadataLogId','create','LogStatus','__esModule','init','MANIFEST_FILENAME','logger','../../../core','ComponentsDeployer','targetOrgCredentials','40cLanDJ','19700472SgBUbi','readFile','message','initManifest','AxiosInstanceUtils','constructor','jobStorePath','__importDefault','Logger','622699nMTBvo','log','../constants','6mbArki','./classes/metadata.retriever','trackingSettingId','jobId','lastRetrieveDate','error','flosumOrgCredentials'];a336_0x550c=function(){return _0x34343e;};return a336_0x550c();}a336_0x40611e();'use strict';var __importDefault=this&&this[a336_0x3cc4a1(0x1d5)]||function(_0x4ca35b){const _0x5d3d26=a336_0x3cc4a1;return _0x4ca35b&&_0x4ca35b[_0x5d3d26(0x223)]?_0x4ca35b:{'default':_0x4ca35b};};Object[a336_0x3cc4a1(0x20e)](exports,a336_0x3cc4a1(0x223),{'value':!![]}),exports['Job']=void 0x0;const minimist_1=__importDefault(require(a336_0x3cc4a1(0x218))),core_1=require(a336_0x3cc4a1(0x227)),salesforce_1=require('@flosum/salesforce'),auth_manager_1=require('../../shared/managers/auth.manager'),logger_1=require('./classes/logger/logger'),promises_1=require(a336_0x3cc4a1(0x1fe)),promises_2=require('fs/promises'),path_1=__importDefault(require(a336_0x3cc4a1(0x207))),metadata_retriever_1=require(a336_0x3cc4a1(0x1db)),components_deployer_1=require(a336_0x3cc4a1(0x1e7)),source_member_retriever_1=require(a336_0x3cc4a1(0x1eb)),source_member_handler_1=require('./classes/source-member.handler'),metadata_logger_1=require('./classes/metadata-logger'),job_1=require('../../../constants/job'),constants_1=require('../../../constants'),constants_2=require(a336_0x3cc4a1(0x1d9)),{jobId,jobStorePath}=(0x0,minimist_1[a336_0x3cc4a1(0x200)])(process[a336_0x3cc4a1(0x20a)]['slice'](0x2)),systemLogger=new core_1['Logger'](jobId);class Job{constructor(){const _0x55012d=a336_0x3cc4a1;this[_0x55012d(0x1d4)]=jobStorePath,this['jobId']=jobId;}async[a336_0x3cc4a1(0x22e)](){const _0x5ee40e=a336_0x3cc4a1,_0x4d3b20=path_1[_0x5ee40e(0x200)][_0x5ee40e(0x213)](this[_0x5ee40e(0x1d4)],job_1[_0x5ee40e(0x225)]),_0x19c148=await(0x0,promises_2[_0x5ee40e(0x22c)])(_0x4d3b20,{'encoding':'utf-8'})[_0x5ee40e(0x1f5)](JSON[_0x5ee40e(0x20f)])[_0x5ee40e(0x1f5)](({details:_0x4c480d})=>_0x4c480d);await(0x0,promises_2['rm'])(_0x4d3b20,{'recursive':!![],'force':!![]}),this[_0x5ee40e(0x211)]=_0x19c148['apiVersion'],this['flosumOrgCredentials']=_0x19c148['flosumOrgCredentials'],this[_0x5ee40e(0x229)]=_0x19c148[_0x5ee40e(0x229)],this[_0x5ee40e(0x1e2)]=_0x19c148[_0x5ee40e(0x1e2)],this[_0x5ee40e(0x1dc)]=_0x19c148['trackingSettingId'],this['lastRetrieveDate']=_0x19c148[_0x5ee40e(0x1de)],this[_0x5ee40e(0x1f6)]=_0x19c148[_0x5ee40e(0x1f6)],this[_0x5ee40e(0x1e1)]=_0x19c148[_0x5ee40e(0x1e1)];}async[a336_0x3cc4a1(0x21c)](){const _0x4e936a=a336_0x3cc4a1;this[_0x4e936a(0x1fc)]=await salesforce_1[_0x4e936a(0x22f)][_0x4e936a(0x221)](new auth_manager_1[(_0x4e936a(0x1f8))](this[_0x4e936a(0x1e0)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this[_0x4e936a(0x1f4)]=await salesforce_1['AxiosInstanceUtils'][_0x4e936a(0x221)](new auth_manager_1[(_0x4e936a(0x1f8))](this[_0x4e936a(0x229)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async[a336_0x3cc4a1(0x209)](){const _0x3b82db=a336_0x3cc4a1;this[_0x3b82db(0x212)]=new metadata_logger_1[(_0x3b82db(0x1e8))]({'apiVersion':this[_0x3b82db(0x211)],'instance':this[_0x3b82db(0x1fc)],'targetOrgId':this[_0x3b82db(0x1e2)],'trackingSettingId':this[_0x3b82db(0x1dc)],'startDate':this[_0x3b82db(0x1fb)]}),this[_0x3b82db(0x220)]=await this[_0x3b82db(0x212)][_0x3b82db(0x224)]();}[a336_0x3cc4a1(0x214)](){const _0x2898a1=a336_0x3cc4a1;this[_0x2898a1(0x226)]=new logger_1[(_0x2898a1(0x1d6))]({'systemLogger':systemLogger,'apiVersion':this[_0x2898a1(0x211)],'instance':this[_0x2898a1(0x1fc)],'metadataLogId':this[_0x2898a1(0x220)],'timeZone':this['timeZone']});}[a336_0x3cc4a1(0x21d)](){const _0x5c16e8=a336_0x3cc4a1;return new source_member_retriever_1[(_0x5c16e8(0x1fd))]({'apiVersion':this[_0x5c16e8(0x211)],'instance':this[_0x5c16e8(0x1f4)],'logger':this[_0x5c16e8(0x226)],'lastRetrieveDate':this[_0x5c16e8(0x1de)],'currentRetrieveDate':this[_0x5c16e8(0x1fb)],'metadataTypes':this[_0x5c16e8(0x1f6)]});}[a336_0x3cc4a1(0x20d)](){const _0x49e3ca=a336_0x3cc4a1;return new source_member_handler_1[(_0x49e3ca(0x1ec))]({'instance':this[_0x49e3ca(0x1fc)],'apiVersion':this['apiVersion'],'logger':this[_0x49e3ca(0x226)],'targetOrgId':this['targetOrgId']});}[a336_0x3cc4a1(0x201)](){const _0x10a3cb=a336_0x3cc4a1;return new metadata_retriever_1[(_0x10a3cb(0x1f9))]({'instance':this[_0x10a3cb(0x1f4)],'apiVersion':this[_0x10a3cb(0x211)],'logger':this[_0x10a3cb(0x226)],'metadataTypes':this[_0x10a3cb(0x1f6)]});}['getComponentsDeployer'](){const _0x3d5130=a336_0x3cc4a1;return new components_deployer_1[(_0x3d5130(0x228))]({'instance':this['flosumInstance'],'logger':this[_0x3d5130(0x226)],'apiVersion':this[_0x3d5130(0x211)],'targetOrgId':this[_0x3d5130(0x1e2)],'trackingSettingId':this[_0x3d5130(0x1dc)]});}['createTrackingSettingRecord'](){const _0x210666=a336_0x3cc4a1;return{'attributes':{'type':constants_1[_0x210666(0x21b)]+'Tracking_Setting__c'},'Id':this[_0x210666(0x1dc)],[constants_1[_0x210666(0x21b)]+_0x210666(0x210)]:![],[constants_1[_0x210666(0x21b)]+'Last_Start_Retrieval__c']:this[_0x210666(0x1fb)]};}async['updateTrackingSetting'](){const _0x1cea6f=a336_0x3cc4a1,_0x3058e5=this[_0x1cea6f(0x1ea)](),_0x40efd7=new salesforce_1[(_0x1cea6f(0x21f))]({'instance':this[_0x1cea6f(0x1fc)],'objectName':constants_1[_0x1cea6f(0x21b)]+_0x1cea6f(0x20c),'api':this[_0x1cea6f(0x211)],'allOrNone':![],'externalIdField':'Id'}),_0x1bde0f=await _0x40efd7[_0x1cea6f(0x1e6)]({'records':[_0x3058e5]}),_0x25583f=_0x1bde0f['at'](0x0);(_0x25583f===null||_0x25583f===void 0x0?void 0x0:_0x25583f[_0x1cea6f(0x1f1)])?this['logger'][_0x1cea6f(0x1d8)](_0x1cea6f(0x20b)):this['logger']['log']('Tracking\x20setting\x20not\x20updated\x20\x0a\x20'+(_0x25583f===null||_0x25583f===void 0x0?void 0x0:_0x25583f[_0x1cea6f(0x1df)]));}async[a336_0x3cc4a1(0x1e6)](){const _0x531919=a336_0x3cc4a1;await this[_0x531919(0x22e)](),this[_0x531919(0x1fb)]=new Date()['getTime']();try{await this['initInstances'](),await this[_0x531919(0x209)](),this[_0x531919(0x214)](),this['logger'][_0x531919(0x1d8)](_0x531919(0x205)+this[_0x531919(0x1dd)]),this[_0x531919(0x212)][_0x531919(0x1f0)]=constants_2[_0x531919(0x222)][_0x531919(0x1e5)],await this['metadataLogger'][_0x531919(0x219)](),await this[_0x531919(0x226)]['update']();const _0x5d50e4=this['getSourceMemberRetriever'](),_0x6743cc=this[_0x531919(0x20d)](),_0x580155=this['getMetadataRetriever'](),_0xaf3b02=this[_0x531919(0x216)]();await(0x0,promises_1[_0x531919(0x1e3)])(_0x5d50e4,_0x6743cc,_0x580155,_0xaf3b02),this[_0x531919(0x226)][_0x531919(0x1d8)]('Tracking\x20components\x20job\x20has\x20been\x20completed'),this[_0x531919(0x212)][_0x531919(0x1f0)]=constants_2[_0x531919(0x222)][_0x531919(0x1ff)];}catch(_0x35627f){this['logger'][_0x531919(0x1df)](_0x531919(0x215)),this[_0x531919(0x226)][_0x531919(0x1df)](_0x35627f[_0x531919(0x22d)]),this[_0x531919(0x212)]['status']=constants_2[_0x531919(0x222)][_0x531919(0x217)];}finally{await this[_0x531919(0x1fa)](),await this[_0x531919(0x226)][_0x531919(0x219)](),await this[_0x531919(0x212)][_0x531919(0x219)]();}}}exports['Job']=Job,new Job()[a336_0x3cc4a1(0x1e6)]()[a336_0x3cc4a1(0x1f5)](()=>process[a336_0x3cc4a1(0x1ed)](0x0))[a336_0x3cc4a1(0x1e4)](_0x4687a9=>{const _0x1a4ccd=a336_0x3cc4a1;systemLogger[_0x1a4ccd(0x1df)](_0x1a4ccd(0x1f7)+_0x4687a9['message']),process[_0x1a4ccd(0x1ed)](0x1);});