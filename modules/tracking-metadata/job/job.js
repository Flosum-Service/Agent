const a347_0x1eb2ac=a347_0x3b00;(function(_0xddc0ff,_0x214c08){const _0x30fa40=a347_0x3b00,_0x15b6b6=_0xddc0ff();while(!![]){try{const _0x57d989=parseInt(_0x30fa40(0x17e))/0x1+parseInt(_0x30fa40(0x19e))/0x2+-parseInt(_0x30fa40(0x185))/0x3*(parseInt(_0x30fa40(0x1b0))/0x4)+parseInt(_0x30fa40(0x19c))/0x5*(-parseInt(_0x30fa40(0x1a1))/0x6)+-parseInt(_0x30fa40(0x15e))/0x7*(parseInt(_0x30fa40(0x16d))/0x8)+-parseInt(_0x30fa40(0x183))/0x9+parseInt(_0x30fa40(0x191))/0xa;if(_0x57d989===_0x214c08)break;else _0x15b6b6['push'](_0x15b6b6['shift']());}catch(_0x1c50b8){_0x15b6b6['push'](_0x15b6b6['shift']());}}}(a347_0x48aa,0x655d5));function a347_0x3b00(_0x289a18,_0x14a48e){const _0x474cd0=a347_0x48aa();return a347_0x3b00=function(_0x40cad2,_0x5526e4){_0x40cad2=_0x40cad2-0x15b;let _0x48aa38=_0x474cd0[_0x40cad2];return _0x48aa38;},a347_0x3b00(_0x289a18,_0x14a48e);}const a347_0x5526e4=(function(){let _0x126c50=!![];return function(_0x6c8be3,_0x2c9029){const _0x4985ea=_0x126c50?function(){const _0x3481fd=a347_0x3b00;if(_0x2c9029){const _0x4470a1=_0x2c9029[_0x3481fd(0x16b)](_0x6c8be3,arguments);return _0x2c9029=null,_0x4470a1;}}:function(){};return _0x126c50=![],_0x4985ea;};}()),a347_0x40cad2=a347_0x5526e4(this,function(){const _0x58c4e3=a347_0x3b00;return a347_0x40cad2['toString']()['search'](_0x58c4e3(0x177))[_0x58c4e3(0x189)]()['constructor'](a347_0x40cad2)['search'](_0x58c4e3(0x177));});a347_0x40cad2();'use strict';var __importDefault=this&&this[a347_0x1eb2ac(0x169)]||function(_0x5d2439){return _0x5d2439&&_0x5d2439['__esModule']?_0x5d2439:{'default':_0x5d2439};};function a347_0x48aa(){const _0xfc47f7=['456686TGkNrK','COMPLETED','exit','Is_Processed__c','AxiosInstanceUtils','5507397yssqXN','MetadataLogger','2649kbOxql','update','getMetadataRetriever','logger','toString','getComponentsDeployer','../../../core','SourceMemberHandler','FLOSUM_NAMESPACE','../constants','./classes/metadata-logger','LogStatus','6591350lkaDjZ','targetInstance','initLogger','argv','metadataLogger','path','targetOrgCredentials','AuthManager','createTrackingSettingRecord','utf-8','stream/promises','5dPQcbi','join','1022534wYdrrI','./classes/components.deployer','MetadataRetriever','1086852kCpsAT','Tracking_Setting__c','startDate','../../../constants','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','create','initManifest','getTime','initMetadataLogger','@flosum/salesforce','flosumInstance','default','error','Job','catch','1544gojgZp','minimist','success','getSourceMemberRetriever','272951deCuuN','metadataLogId','Logger','./classes/source-member.retriever','flosumOrgCredentials','metadataTypes','ComponentsDeployer','__esModule','initInstances','targetOrgId','Tracking\x20setting\x20updated','__importDefault','pipeline','apply','parse','16xeoBVb','lastRetrieveDate','defineProperty','jobId','execute','jobStorePath','trackingSettingId','log','EXCEPTION','status','(((.+)+)+)+$','../../../constants/job','fs/promises','./classes/metadata.retriever','apiVersion','Tracking\x20components\x20job\x20has\x20been\x20completed','Job\x20Error:\x20'];a347_0x48aa=function(){return _0xfc47f7;};return a347_0x48aa();}Object[a347_0x1eb2ac(0x16f)](exports,a347_0x1eb2ac(0x165),{'value':!![]}),exports[a347_0x1eb2ac(0x1ae)]=void 0x0;const minimist_1=__importDefault(require(a347_0x1eb2ac(0x15b))),core_1=require(a347_0x1eb2ac(0x18b)),salesforce_1=require(a347_0x1eb2ac(0x1aa)),auth_manager_1=require('../../shared/managers/auth.manager'),logger_1=require('./classes/logger/logger'),promises_1=require(a347_0x1eb2ac(0x19b)),promises_2=require(a347_0x1eb2ac(0x179)),path_1=__importDefault(require(a347_0x1eb2ac(0x196))),metadata_retriever_1=require(a347_0x1eb2ac(0x17a)),components_deployer_1=require(a347_0x1eb2ac(0x19f)),source_member_retriever_1=require(a347_0x1eb2ac(0x161)),source_member_handler_1=require('./classes/source-member.handler'),metadata_logger_1=require(a347_0x1eb2ac(0x18f)),job_1=require(a347_0x1eb2ac(0x178)),constants_1=require(a347_0x1eb2ac(0x1a4)),constants_2=require(a347_0x1eb2ac(0x18e)),{jobId,jobStorePath}=(0x0,minimist_1[a347_0x1eb2ac(0x1ac)])(process[a347_0x1eb2ac(0x194)]['slice'](0x2)),systemLogger=new core_1['Logger'](jobId);class Job{constructor(){const _0x130896=a347_0x1eb2ac;this[_0x130896(0x172)]=jobStorePath,this[_0x130896(0x170)]=jobId;}async[a347_0x1eb2ac(0x1a7)](){const _0xf4f56c=a347_0x1eb2ac,_0x2e851c=path_1[_0xf4f56c(0x1ac)][_0xf4f56c(0x19d)](this['jobStorePath'],job_1['MANIFEST_FILENAME']),_0x25c40e=await(0x0,promises_2['readFile'])(_0x2e851c,{'encoding':_0xf4f56c(0x19a)})['then'](JSON[_0xf4f56c(0x16c)])['then'](({details:_0x496854})=>_0x496854);await(0x0,promises_2['rm'])(_0x2e851c,{'recursive':!![],'force':!![]}),this[_0xf4f56c(0x17b)]=_0x25c40e[_0xf4f56c(0x17b)],this['flosumOrgCredentials']=_0x25c40e[_0xf4f56c(0x162)],this['targetOrgCredentials']=_0x25c40e[_0xf4f56c(0x197)],this[_0xf4f56c(0x167)]=_0x25c40e['targetOrgId'],this[_0xf4f56c(0x173)]=_0x25c40e[_0xf4f56c(0x173)],this[_0xf4f56c(0x16e)]=_0x25c40e[_0xf4f56c(0x16e)],this[_0xf4f56c(0x163)]=_0x25c40e[_0xf4f56c(0x163)],this['timeZone']=_0x25c40e['timeZone'];}async[a347_0x1eb2ac(0x166)](){const _0xf911af=a347_0x1eb2ac;this[_0xf911af(0x1ab)]=await salesforce_1['AxiosInstanceUtils'][_0xf911af(0x1a6)](new auth_manager_1[(_0xf911af(0x198))](this[_0xf911af(0x162)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this[_0xf911af(0x192)]=await salesforce_1[_0xf911af(0x182)][_0xf911af(0x1a6)](new auth_manager_1['AuthManager'](this[_0xf911af(0x197)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async[a347_0x1eb2ac(0x1a9)](){const _0x6da08c=a347_0x1eb2ac;this[_0x6da08c(0x195)]=new metadata_logger_1[(_0x6da08c(0x184))]({'apiVersion':this[_0x6da08c(0x17b)],'instance':this[_0x6da08c(0x1ab)],'targetOrgId':this[_0x6da08c(0x167)],'trackingSettingId':this['trackingSettingId'],'startDate':this[_0x6da08c(0x1a3)]}),this[_0x6da08c(0x15f)]=await this[_0x6da08c(0x195)]['init']();}['initLogger'](){const _0x422e62=a347_0x1eb2ac;this[_0x422e62(0x188)]=new logger_1[(_0x422e62(0x160))]({'systemLogger':systemLogger,'apiVersion':this['apiVersion'],'instance':this[_0x422e62(0x1ab)],'metadataLogId':this['metadataLogId'],'timeZone':this['timeZone']});}[a347_0x1eb2ac(0x15d)](){const _0x5ddf48=a347_0x1eb2ac;return new source_member_retriever_1['SourceMemberRetriever']({'apiVersion':this[_0x5ddf48(0x17b)],'instance':this['targetInstance'],'logger':this[_0x5ddf48(0x188)],'lastRetrieveDate':this[_0x5ddf48(0x16e)],'currentRetrieveDate':this[_0x5ddf48(0x1a3)],'metadataTypes':this[_0x5ddf48(0x163)]});}['getSourceMemberHandler'](){const _0x2c01c8=a347_0x1eb2ac;return new source_member_handler_1[(_0x2c01c8(0x18c))]({'instance':this[_0x2c01c8(0x1ab)],'apiVersion':this[_0x2c01c8(0x17b)],'logger':this['logger'],'targetOrgId':this[_0x2c01c8(0x167)]});}[a347_0x1eb2ac(0x187)](){const _0x29ba88=a347_0x1eb2ac;return new metadata_retriever_1[(_0x29ba88(0x1a0))]({'instance':this[_0x29ba88(0x192)],'apiVersion':this[_0x29ba88(0x17b)],'logger':this[_0x29ba88(0x188)],'metadataTypes':this[_0x29ba88(0x163)]});}[a347_0x1eb2ac(0x18a)](){const _0x4e24d5=a347_0x1eb2ac;return new components_deployer_1[(_0x4e24d5(0x164))]({'instance':this[_0x4e24d5(0x1ab)],'logger':this[_0x4e24d5(0x188)],'apiVersion':this[_0x4e24d5(0x17b)],'targetOrgId':this[_0x4e24d5(0x167)],'trackingSettingId':this[_0x4e24d5(0x173)]});}[a347_0x1eb2ac(0x199)](){const _0x36d3fe=a347_0x1eb2ac;return{'attributes':{'type':constants_1[_0x36d3fe(0x18d)]+_0x36d3fe(0x1a2)},'Id':this[_0x36d3fe(0x173)],[constants_1['FLOSUM_NAMESPACE']+_0x36d3fe(0x181)]:![],[constants_1['FLOSUM_NAMESPACE']+'Last_Start_Retrieval__c']:this[_0x36d3fe(0x1a3)]};}async['updateTrackingSetting'](){const _0x415f1f=a347_0x1eb2ac,_0x28073e=this[_0x415f1f(0x199)](),_0x1a8133=new salesforce_1['RestSimpleDeployData']({'instance':this[_0x415f1f(0x1ab)],'objectName':constants_1['FLOSUM_NAMESPACE']+_0x415f1f(0x1a2),'api':this['apiVersion'],'allOrNone':![],'externalIdField':'Id'}),_0xb9ec52=await _0x1a8133[_0x415f1f(0x171)]({'records':[_0x28073e]}),_0x594a45=_0xb9ec52['at'](0x0);(_0x594a45===null||_0x594a45===void 0x0?void 0x0:_0x594a45[_0x415f1f(0x15c)])?this[_0x415f1f(0x188)][_0x415f1f(0x174)](_0x415f1f(0x168)):this[_0x415f1f(0x188)][_0x415f1f(0x174)]('Tracking\x20setting\x20not\x20updated\x20\x0a\x20'+(_0x594a45===null||_0x594a45===void 0x0?void 0x0:_0x594a45[_0x415f1f(0x1ad)]));}async[a347_0x1eb2ac(0x171)](){const _0x4bbf72=a347_0x1eb2ac;await this[_0x4bbf72(0x1a7)](),this[_0x4bbf72(0x1a3)]=new Date()[_0x4bbf72(0x1a8)]();try{await this['initInstances'](),await this[_0x4bbf72(0x1a9)](),this[_0x4bbf72(0x193)](),this[_0x4bbf72(0x188)][_0x4bbf72(0x174)](_0x4bbf72(0x1a5)+this[_0x4bbf72(0x170)]),this['metadataLogger'][_0x4bbf72(0x176)]=constants_2[_0x4bbf72(0x190)]['IN_PROGRESS'],await this[_0x4bbf72(0x195)][_0x4bbf72(0x186)](),await this['logger'][_0x4bbf72(0x186)]();const _0x183f70=this[_0x4bbf72(0x15d)](),_0x352259=this['getSourceMemberHandler'](),_0x4d562d=this['getMetadataRetriever'](),_0x1809d2=this['getComponentsDeployer']();await(0x0,promises_1[_0x4bbf72(0x16a)])(_0x183f70,_0x352259,_0x4d562d,_0x1809d2),this['logger'][_0x4bbf72(0x174)](_0x4bbf72(0x17c)),this[_0x4bbf72(0x195)][_0x4bbf72(0x176)]=constants_2[_0x4bbf72(0x190)][_0x4bbf72(0x17f)];}catch(_0x5a2de5){this[_0x4bbf72(0x188)][_0x4bbf72(0x1ad)]('Tracking\x20components\x20job\x20has\x20been\x20failed'),this[_0x4bbf72(0x188)][_0x4bbf72(0x1ad)](_0x5a2de5['message']),this[_0x4bbf72(0x195)]['status']=constants_2[_0x4bbf72(0x190)][_0x4bbf72(0x175)];}finally{await this['updateTrackingSetting'](),await this[_0x4bbf72(0x188)][_0x4bbf72(0x186)](),await this['metadataLogger'][_0x4bbf72(0x186)]();}}}exports[a347_0x1eb2ac(0x1ae)]=Job,new Job()[a347_0x1eb2ac(0x171)]()['then'](()=>process['exit'](0x0))[a347_0x1eb2ac(0x1af)](_0x15a1a8=>{const _0x5c7b04=a347_0x1eb2ac;systemLogger[_0x5c7b04(0x1ad)](_0x5c7b04(0x17d)+_0x15a1a8['message']),process[_0x5c7b04(0x180)](0x1);});