const a304_0x233259=a304_0x5b98;(function(_0x136c87,_0x31cb50){const _0x5c40ba=a304_0x5b98,_0x13d672=_0x136c87();while(!![]){try{const _0x4aa3cd=parseInt(_0x5c40ba(0x135))/0x1+parseInt(_0x5c40ba(0x116))/0x2+parseInt(_0x5c40ba(0x10f))/0x3+parseInt(_0x5c40ba(0x11d))/0x4+parseInt(_0x5c40ba(0x131))/0x5+parseInt(_0x5c40ba(0x143))/0x6*(-parseInt(_0x5c40ba(0x14d))/0x7)+-parseInt(_0x5c40ba(0x10b))/0x8*(parseInt(_0x5c40ba(0x117))/0x9);if(_0x4aa3cd===_0x31cb50)break;else _0x13d672['push'](_0x13d672['shift']());}catch(_0x1a96c6){_0x13d672['push'](_0x13d672['shift']());}}}(a304_0x254a,0x7d355));const a304_0xac0cf6=(function(){let _0x216de7=!![];return function(_0x5ed7bd,_0x17592d){const _0x4653ca=_0x216de7?function(){const _0x48d26c=a304_0x5b98;if(_0x17592d){const _0x34a38d=_0x17592d[_0x48d26c(0x125)](_0x5ed7bd,arguments);return _0x17592d=null,_0x34a38d;}}:function(){};return _0x216de7=![],_0x4653ca;};}()),a304_0x518f75=a304_0xac0cf6(this,function(){const _0x270cc5=a304_0x5b98;return a304_0x518f75[_0x270cc5(0x13a)]()[_0x270cc5(0x108)](_0x270cc5(0xfe))[_0x270cc5(0x13a)]()['constructor'](a304_0x518f75)['search'](_0x270cc5(0xfe));});a304_0x518f75();'use strict';function a304_0x5b98(_0x435c59,_0x3c176f){const _0x17b4d1=a304_0x254a();return a304_0x5b98=function(_0x518f75,_0xac0cf6){_0x518f75=_0x518f75-0xfe;let _0x254a52=_0x17b4d1[_0x518f75];return _0x254a52;},a304_0x5b98(_0x435c59,_0x3c176f);}var __importDefault=this&&this['__importDefault']||function(_0x298838){const _0x4513a2=a304_0x5b98;return _0x298838&&_0x298838[_0x4513a2(0x112)]?_0x298838:{'default':_0x298838};};Object[a304_0x233259(0x138)](exports,a304_0x233259(0x112),{'value':!![]}),exports[a304_0x233259(0x124)]=void 0x0;function a304_0x254a(){const _0x55adf1=['apply','default','../../shared/managers/auth.manager','Tracking\x20setting\x20updated','SourceMemberHandler','create','../constants','pipeline','IN_PROGRESS','fs/promises','apiVersion','./classes/components.deployer','3754390mVEBkB','error','getTime','then','242388rIMMSi','metadataTypes','startDate','defineProperty','initLogger','toString','execute','Logger','getSourceMemberHandler','timeZone','../../../constants','Tracking_Setting__c','metadataLogId','ComponentsDeployer','6AOBTKC','jobId','createTrackingSettingRecord','log','getSourceMemberRetriever','catch','AuthManager','argv','initInstances','SourceMemberRetriever','6378827mleOmW','./classes/metadata.retriever','targetInstance','path','logger','Tracking\x20components\x20job\x20has\x20been\x20failed','(((.+)+)+)+$','message','LogStatus','updateTrackingSetting','flosumInstance','metadataLogger','trackingSettingId','update','Job\x20Error:\x20','Last_Start_Retrieval__c','search','./classes/source-member.retriever','stream/promises','4059424yFdJXu','targetOrgCredentials','getComponentsDeployer','readFile','972231xBvrSW','init','flosumOrgCredentials','__esModule','MetadataRetriever','Is_Processed__c','./classes/source-member.handler','855246lnUcwA','9hJOvaD','initManifest','AxiosInstanceUtils','lastRetrieveDate','exit','status','746304KjmMTd','EXCEPTION','targetOrgId','minimist','initMetadataLogger','getMetadataRetriever','FLOSUM_NAMESPACE','Job'];a304_0x254a=function(){return _0x55adf1;};return a304_0x254a();}const minimist_1=__importDefault(require(a304_0x233259(0x120))),core_1=require('../../../core'),salesforce_1=require('@flosum/salesforce'),auth_manager_1=require(a304_0x233259(0x127)),logger_1=require('./classes/logger/logger'),promises_1=require(a304_0x233259(0x10a)),promises_2=require(a304_0x233259(0x12e)),path_1=__importDefault(require(a304_0x233259(0x150))),metadata_retriever_1=require(a304_0x233259(0x14e)),components_deployer_1=require(a304_0x233259(0x130)),source_member_retriever_1=require(a304_0x233259(0x109)),source_member_handler_1=require(a304_0x233259(0x115)),metadata_logger_1=require('./classes/metadata-logger'),job_1=require('../../../constants/job'),constants_1=require(a304_0x233259(0x13f)),constants_2=require(a304_0x233259(0x12b)),{jobId,jobStorePath}=(0x0,minimist_1[a304_0x233259(0x126)])(process[a304_0x233259(0x14a)]['slice'](0x2)),systemLogger=new core_1[(a304_0x233259(0x13c))](jobId);class Job{constructor(){const _0x485e39=a304_0x233259;this['jobStorePath']=jobStorePath,this[_0x485e39(0x144)]=jobId;}async[a304_0x233259(0x118)](){const _0x24513d=a304_0x233259,_0x9c3299=path_1[_0x24513d(0x126)]['join'](this['jobStorePath'],job_1['MANIFEST_FILENAME']),_0x551f74=await(0x0,promises_2[_0x24513d(0x10e)])(_0x9c3299,{'encoding':'utf-8'})[_0x24513d(0x134)](JSON['parse'])[_0x24513d(0x134)](({details:_0x3de9fb})=>_0x3de9fb);await(0x0,promises_2['rm'])(_0x9c3299,{'recursive':!![],'force':!![]}),this[_0x24513d(0x12f)]=_0x551f74[_0x24513d(0x12f)],this['flosumOrgCredentials']=_0x551f74[_0x24513d(0x111)],this[_0x24513d(0x10c)]=_0x551f74[_0x24513d(0x10c)],this[_0x24513d(0x11f)]=_0x551f74[_0x24513d(0x11f)],this[_0x24513d(0x104)]=_0x551f74[_0x24513d(0x104)],this[_0x24513d(0x11a)]=_0x551f74['lastRetrieveDate'],this[_0x24513d(0x136)]=_0x551f74['metadataTypes'],this[_0x24513d(0x13e)]=_0x551f74[_0x24513d(0x13e)];}async[a304_0x233259(0x14b)](){const _0xfd85e9=a304_0x233259;this[_0xfd85e9(0x102)]=await salesforce_1[_0xfd85e9(0x119)][_0xfd85e9(0x12a)](new auth_manager_1[(_0xfd85e9(0x149))](this[_0xfd85e9(0x111)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this[_0xfd85e9(0x14f)]=await salesforce_1[_0xfd85e9(0x119)][_0xfd85e9(0x12a)](new auth_manager_1['AuthManager'](this[_0xfd85e9(0x10c)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async[a304_0x233259(0x121)](){const _0x1cb34a=a304_0x233259;this[_0x1cb34a(0x103)]=new metadata_logger_1['MetadataLogger']({'apiVersion':this['apiVersion'],'instance':this[_0x1cb34a(0x102)],'targetOrgId':this[_0x1cb34a(0x11f)],'trackingSettingId':this[_0x1cb34a(0x104)],'startDate':this[_0x1cb34a(0x137)]}),this[_0x1cb34a(0x141)]=await this['metadataLogger'][_0x1cb34a(0x110)]();}[a304_0x233259(0x139)](){const _0x3e648d=a304_0x233259;this[_0x3e648d(0x151)]=new logger_1['Logger']({'systemLogger':systemLogger,'apiVersion':this[_0x3e648d(0x12f)],'instance':this[_0x3e648d(0x102)],'metadataLogId':this[_0x3e648d(0x141)],'timeZone':this['timeZone']});}[a304_0x233259(0x147)](){const _0x1d1249=a304_0x233259;return new source_member_retriever_1[(_0x1d1249(0x14c))]({'apiVersion':this[_0x1d1249(0x12f)],'instance':this['targetInstance'],'logger':this[_0x1d1249(0x151)],'lastRetrieveDate':this[_0x1d1249(0x11a)],'currentRetrieveDate':this[_0x1d1249(0x137)],'metadataTypes':this[_0x1d1249(0x136)]});}[a304_0x233259(0x13d)](){const _0x57b823=a304_0x233259;return new source_member_handler_1[(_0x57b823(0x129))]({'instance':this[_0x57b823(0x102)],'apiVersion':this[_0x57b823(0x12f)],'logger':this[_0x57b823(0x151)],'targetOrgId':this['targetOrgId']});}[a304_0x233259(0x122)](){const _0xc226d5=a304_0x233259;return new metadata_retriever_1[(_0xc226d5(0x113))]({'instance':this[_0xc226d5(0x14f)],'apiVersion':this['apiVersion'],'logger':this[_0xc226d5(0x151)],'metadataTypes':this[_0xc226d5(0x136)]});}[a304_0x233259(0x10d)](){const _0x43bade=a304_0x233259;return new components_deployer_1[(_0x43bade(0x142))]({'instance':this['flosumInstance'],'logger':this['logger'],'apiVersion':this['apiVersion'],'targetOrgId':this['targetOrgId'],'trackingSettingId':this[_0x43bade(0x104)]});}[a304_0x233259(0x145)](){const _0x298b92=a304_0x233259;return{'attributes':{'type':constants_1[_0x298b92(0x123)]+_0x298b92(0x140)},'Id':this['trackingSettingId'],[constants_1['FLOSUM_NAMESPACE']+_0x298b92(0x114)]:![],[constants_1['FLOSUM_NAMESPACE']+_0x298b92(0x107)]:this[_0x298b92(0x137)]};}async[a304_0x233259(0x101)](){const _0x359a4c=a304_0x233259,_0x3c6ed5=this[_0x359a4c(0x145)](),_0x3ebc4f=new salesforce_1['RestSimpleDeployData']({'instance':this[_0x359a4c(0x102)],'objectName':constants_1['FLOSUM_NAMESPACE']+'Tracking_Setting__c','api':this[_0x359a4c(0x12f)],'allOrNone':![],'externalIdField':'Id'}),_0x1e27a2=await _0x3ebc4f[_0x359a4c(0x13b)]({'records':[_0x3c6ed5]}),_0x2e7082=_0x1e27a2['at'](0x0);(_0x2e7082===null||_0x2e7082===void 0x0?void 0x0:_0x2e7082['success'])?this[_0x359a4c(0x151)][_0x359a4c(0x146)](_0x359a4c(0x128)):this[_0x359a4c(0x151)][_0x359a4c(0x146)]('Tracking\x20setting\x20not\x20updated\x20\x0a\x20'+(_0x2e7082===null||_0x2e7082===void 0x0?void 0x0:_0x2e7082['error']));}async[a304_0x233259(0x13b)](){const _0x2a6535=a304_0x233259;await this[_0x2a6535(0x118)](),this[_0x2a6535(0x137)]=new Date()[_0x2a6535(0x133)]();try{await this[_0x2a6535(0x14b)](),await this['initMetadataLogger'](),this[_0x2a6535(0x139)](),this[_0x2a6535(0x151)][_0x2a6535(0x146)]('Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20'+this[_0x2a6535(0x144)]),this[_0x2a6535(0x103)]['status']=constants_2[_0x2a6535(0x100)][_0x2a6535(0x12d)],await this[_0x2a6535(0x103)][_0x2a6535(0x105)](),await this[_0x2a6535(0x151)]['update']();const _0x3ebb9f=this[_0x2a6535(0x147)](),_0x1e321d=this['getSourceMemberHandler'](),_0x45894e=this[_0x2a6535(0x122)](),_0x32957a=this[_0x2a6535(0x10d)]();await(0x0,promises_1[_0x2a6535(0x12c)])(_0x3ebb9f,_0x1e321d,_0x45894e,_0x32957a),this[_0x2a6535(0x151)][_0x2a6535(0x146)]('Tracking\x20components\x20job\x20has\x20been\x20completed'),this[_0x2a6535(0x103)][_0x2a6535(0x11c)]=constants_2[_0x2a6535(0x100)]['COMPLETED'];}catch(_0x520ede){this[_0x2a6535(0x151)][_0x2a6535(0x132)](_0x2a6535(0x152)),this[_0x2a6535(0x151)][_0x2a6535(0x132)](_0x520ede[_0x2a6535(0xff)]),this['metadataLogger'][_0x2a6535(0x11c)]=constants_2[_0x2a6535(0x100)][_0x2a6535(0x11e)];}finally{await this[_0x2a6535(0x101)](),await this[_0x2a6535(0x151)][_0x2a6535(0x105)](),await this[_0x2a6535(0x103)][_0x2a6535(0x105)]();}}}exports[a304_0x233259(0x124)]=Job,new Job()[a304_0x233259(0x13b)]()['then'](()=>process[a304_0x233259(0x11b)](0x0))[a304_0x233259(0x148)](_0x2ea5f3=>{const _0x467114=a304_0x233259;systemLogger['error'](_0x467114(0x106)+_0x2ea5f3[_0x467114(0xff)]),process[_0x467114(0x11b)](0x1);});