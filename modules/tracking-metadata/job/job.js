const a304_0x5b13b5=a304_0x5b72;function a304_0x57ed(){const _0x5c22d2=['execute','EXCEPTION','SourceMemberHandler','createTrackingSettingRecord','parse','apiVersion','MANIFEST_FILENAME','getComponentsDeployer','log','error','initLogger','RestSimpleDeployData','logger','1954911ryLXHH','6951312kEmQYw','targetOrgId','updateTrackingSetting','apply','toString','getSourceMemberHandler','Tracking\x20components\x20job\x20has\x20been\x20failed','(((.+)+)+)+$','111896eCPonb','../constants','targetOrgCredentials','jobId','AuthManager','../../shared/managers/auth.manager','trackingSettingId','flosumOrgCredentials','flosumInstance','defineProperty','@flosum/salesforce','24AqLGCW','minimist','Tracking\x20components\x20job\x20has\x20been\x20completed','Job','argv','Last_Start_Retrieval__c','1358xWVmcT','metadataLogger','../../../core','message','./classes/metadata.retriever','startDate','./classes/components.deployer','FLOSUM_NAMESPACE','timeZone','IN_PROGRESS','targetInstance','status','33byxIBU','initInstances','Logger','metadataTypes','getSourceMemberRetriever','slice','639yjPUCk','init','7803257WahIvx','ComponentsDeployer','constructor','446zSQVnf','initManifest','./classes/source-member.handler','success','LogStatus','AxiosInstanceUtils','fs/promises','join','799595bDedRz','default','update','./classes/metadata-logger','exit','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','getMetadataRetriever','getTime','metadataLogId','COMPLETED','then','Tracking_Setting__c','8570410WXFpwE','initMetadataLogger','Tracking\x20setting\x20not\x20updated\x20\x0a\x20','jobStorePath','lastRetrieveDate','search'];a304_0x57ed=function(){return _0x5c22d2;};return a304_0x57ed();}(function(_0x12f05e,_0x4dc0a7){const _0x5ecad6=a304_0x5b72,_0x307778=_0x12f05e();while(!![]){try{const _0x47126a=-parseInt(_0x5ecad6(0x1df))/0x1*(-parseInt(_0x5ecad6(0x1c8))/0x2)+parseInt(_0x5ecad6(0x1ae))/0x3+-parseInt(_0x5ecad6(0x1c2))/0x4*(-parseInt(_0x5ecad6(0x1e7))/0x5)+parseInt(_0x5ecad6(0x1af))/0x6+parseInt(_0x5ecad6(0x1dc))/0x7+parseInt(_0x5ecad6(0x1b7))/0x8*(-parseInt(_0x5ecad6(0x1da))/0x9)+parseInt(_0x5ecad6(0x19b))/0xa*(-parseInt(_0x5ecad6(0x1d4))/0xb);if(_0x47126a===_0x4dc0a7)break;else _0x307778['push'](_0x307778['shift']());}catch(_0x33952a){_0x307778['push'](_0x307778['shift']());}}}(a304_0x57ed,0x981f0));const a304_0x4c8de7=(function(){let _0x10b702=!![];return function(_0x137a22,_0x344e8c){const _0x532d80=_0x10b702?function(){const _0x37758e=a304_0x5b72;if(_0x344e8c){const _0x5c6be0=_0x344e8c[_0x37758e(0x1b2)](_0x137a22,arguments);return _0x344e8c=null,_0x5c6be0;}}:function(){};return _0x10b702=![],_0x532d80;};}()),a304_0x1313ee=a304_0x4c8de7(this,function(){const _0x29c06f=a304_0x5b72;return a304_0x1313ee['toString']()[_0x29c06f(0x1a0)](_0x29c06f(0x1b6))[_0x29c06f(0x1b3)]()[_0x29c06f(0x1de)](a304_0x1313ee)['search'](_0x29c06f(0x1b6));});a304_0x1313ee();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x115e7c){return _0x115e7c&&_0x115e7c['__esModule']?_0x115e7c:{'default':_0x115e7c};};Object[a304_0x5b13b5(0x1c0)](exports,'__esModule',{'value':!![]}),exports['Job']=void 0x0;const minimist_1=__importDefault(require(a304_0x5b13b5(0x1c3))),core_1=require(a304_0x5b13b5(0x1ca)),salesforce_1=require(a304_0x5b13b5(0x1c1)),auth_manager_1=require(a304_0x5b13b5(0x1bc)),logger_1=require('./classes/logger/logger'),promises_1=require('stream/promises'),promises_2=require(a304_0x5b13b5(0x1e5)),path_1=__importDefault(require('path')),metadata_retriever_1=require(a304_0x5b13b5(0x1cc)),components_deployer_1=require(a304_0x5b13b5(0x1ce)),source_member_retriever_1=require('./classes/source-member.retriever'),source_member_handler_1=require(a304_0x5b13b5(0x1e1)),metadata_logger_1=require(a304_0x5b13b5(0x1ea)),job_1=require('../../../constants/job'),constants_1=require('../../../constants'),constants_2=require(a304_0x5b13b5(0x1b8)),{jobId,jobStorePath}=(0x0,minimist_1[a304_0x5b13b5(0x1e8)])(process[a304_0x5b13b5(0x1c6)][a304_0x5b13b5(0x1d9)](0x2)),systemLogger=new core_1[(a304_0x5b13b5(0x1d6))](jobId);class Job{constructor(){const _0x62226f=a304_0x5b13b5;this['jobStorePath']=jobStorePath,this[_0x62226f(0x1ba)]=jobId;}async[a304_0x5b13b5(0x1e0)](){const _0x20a22d=a304_0x5b13b5,_0x3681b3=path_1[_0x20a22d(0x1e8)][_0x20a22d(0x1e6)](this[_0x20a22d(0x19e)],job_1[_0x20a22d(0x1a7)]),_0x4819f6=await(0x0,promises_2['readFile'])(_0x3681b3,{'encoding':'utf-8'})[_0x20a22d(0x1f1)](JSON[_0x20a22d(0x1a5)])[_0x20a22d(0x1f1)](({details:_0x1b07ef})=>_0x1b07ef);await(0x0,promises_2['rm'])(_0x3681b3,{'recursive':!![],'force':!![]}),this['apiVersion']=_0x4819f6[_0x20a22d(0x1a6)],this[_0x20a22d(0x1be)]=_0x4819f6[_0x20a22d(0x1be)],this['targetOrgCredentials']=_0x4819f6[_0x20a22d(0x1b9)],this[_0x20a22d(0x1b0)]=_0x4819f6[_0x20a22d(0x1b0)],this[_0x20a22d(0x1bd)]=_0x4819f6['trackingSettingId'],this[_0x20a22d(0x19f)]=_0x4819f6[_0x20a22d(0x19f)],this['metadataTypes']=_0x4819f6[_0x20a22d(0x1d7)],this[_0x20a22d(0x1d0)]=_0x4819f6[_0x20a22d(0x1d0)];}async[a304_0x5b13b5(0x1d5)](){const _0x585168=a304_0x5b13b5;this[_0x585168(0x1bf)]=await salesforce_1[_0x585168(0x1e4)]['create'](new auth_manager_1['AuthManager'](this['flosumOrgCredentials']),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this[_0x585168(0x1d2)]=await salesforce_1[_0x585168(0x1e4)]['create'](new auth_manager_1[(_0x585168(0x1bb))](this[_0x585168(0x1b9)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async[a304_0x5b13b5(0x19c)](){const _0x26ca30=a304_0x5b13b5;this[_0x26ca30(0x1c9)]=new metadata_logger_1['MetadataLogger']({'apiVersion':this[_0x26ca30(0x1a6)],'instance':this[_0x26ca30(0x1bf)],'targetOrgId':this[_0x26ca30(0x1b0)],'trackingSettingId':this['trackingSettingId'],'startDate':this['startDate']}),this[_0x26ca30(0x1ef)]=await this['metadataLogger'][_0x26ca30(0x1db)]();}[a304_0x5b13b5(0x1ab)](){const _0xb16682=a304_0x5b13b5;this[_0xb16682(0x1ad)]=new logger_1['Logger']({'systemLogger':systemLogger,'apiVersion':this[_0xb16682(0x1a6)],'instance':this[_0xb16682(0x1bf)],'metadataLogId':this['metadataLogId'],'timeZone':this['timeZone']});}[a304_0x5b13b5(0x1d8)](){const _0x53e7ca=a304_0x5b13b5;return new source_member_retriever_1['SourceMemberRetriever']({'apiVersion':this[_0x53e7ca(0x1a6)],'instance':this['targetInstance'],'logger':this[_0x53e7ca(0x1ad)],'lastRetrieveDate':this['lastRetrieveDate'],'currentRetrieveDate':this[_0x53e7ca(0x1cd)],'metadataTypes':this['metadataTypes']});}[a304_0x5b13b5(0x1b4)](){const _0x465bdb=a304_0x5b13b5;return new source_member_handler_1[(_0x465bdb(0x1a3))]({'instance':this['flosumInstance'],'apiVersion':this[_0x465bdb(0x1a6)],'logger':this[_0x465bdb(0x1ad)],'targetOrgId':this[_0x465bdb(0x1b0)]});}[a304_0x5b13b5(0x1ed)](){const _0x3e6c90=a304_0x5b13b5;return new metadata_retriever_1['MetadataRetriever']({'instance':this[_0x3e6c90(0x1d2)],'apiVersion':this[_0x3e6c90(0x1a6)],'logger':this['logger'],'metadataTypes':this[_0x3e6c90(0x1d7)]});}[a304_0x5b13b5(0x1a8)](){const _0x147cb0=a304_0x5b13b5;return new components_deployer_1[(_0x147cb0(0x1dd))]({'instance':this['flosumInstance'],'logger':this[_0x147cb0(0x1ad)],'apiVersion':this['apiVersion'],'targetOrgId':this['targetOrgId'],'trackingSettingId':this['trackingSettingId']});}['createTrackingSettingRecord'](){const _0x5cd8a6=a304_0x5b13b5;return{'attributes':{'type':constants_1[_0x5cd8a6(0x1cf)]+'Tracking_Setting__c'},'Id':this[_0x5cd8a6(0x1bd)],[constants_1['FLOSUM_NAMESPACE']+'Is_Processed__c']:![],[constants_1[_0x5cd8a6(0x1cf)]+_0x5cd8a6(0x1c7)]:this['startDate']};}async[a304_0x5b13b5(0x1b1)](){const _0x362c0c=a304_0x5b13b5,_0x39cc63=this[_0x362c0c(0x1a4)](),_0x335f03=new salesforce_1[(_0x362c0c(0x1ac))]({'instance':this[_0x362c0c(0x1bf)],'objectName':constants_1[_0x362c0c(0x1cf)]+_0x362c0c(0x1f2),'api':this[_0x362c0c(0x1a6)],'allOrNone':![],'externalIdField':'Id'}),_0x11e26a=await _0x335f03[_0x362c0c(0x1a1)]({'records':[_0x39cc63]}),_0x1014f9=_0x11e26a['at'](0x0);(_0x1014f9===null||_0x1014f9===void 0x0?void 0x0:_0x1014f9[_0x362c0c(0x1e2)])?this[_0x362c0c(0x1ad)][_0x362c0c(0x1a9)]('Tracking\x20setting\x20updated'):this[_0x362c0c(0x1ad)][_0x362c0c(0x1a9)](_0x362c0c(0x19d)+(_0x1014f9===null||_0x1014f9===void 0x0?void 0x0:_0x1014f9[_0x362c0c(0x1aa)]));}async[a304_0x5b13b5(0x1a1)](){const _0x5a3dac=a304_0x5b13b5;await this[_0x5a3dac(0x1e0)](),this[_0x5a3dac(0x1cd)]=new Date()[_0x5a3dac(0x1ee)]();try{await this[_0x5a3dac(0x1d5)](),await this[_0x5a3dac(0x19c)](),this['initLogger'](),this[_0x5a3dac(0x1ad)][_0x5a3dac(0x1a9)](_0x5a3dac(0x1ec)+this[_0x5a3dac(0x1ba)]),this[_0x5a3dac(0x1c9)][_0x5a3dac(0x1d3)]=constants_2[_0x5a3dac(0x1e3)][_0x5a3dac(0x1d1)],await this[_0x5a3dac(0x1c9)][_0x5a3dac(0x1e9)](),await this[_0x5a3dac(0x1ad)][_0x5a3dac(0x1e9)]();const _0x95246f=this[_0x5a3dac(0x1d8)](),_0x343037=this['getSourceMemberHandler'](),_0x425355=this['getMetadataRetriever'](),_0x89c9c4=this[_0x5a3dac(0x1a8)]();await(0x0,promises_1['pipeline'])(_0x95246f,_0x343037,_0x425355,_0x89c9c4),this[_0x5a3dac(0x1ad)][_0x5a3dac(0x1a9)](_0x5a3dac(0x1c4)),this[_0x5a3dac(0x1c9)]['status']=constants_2['LogStatus'][_0x5a3dac(0x1f0)];}catch(_0x3b2f65){this[_0x5a3dac(0x1ad)][_0x5a3dac(0x1aa)](_0x5a3dac(0x1b5)),this[_0x5a3dac(0x1ad)][_0x5a3dac(0x1aa)](_0x3b2f65[_0x5a3dac(0x1cb)]),this[_0x5a3dac(0x1c9)][_0x5a3dac(0x1d3)]=constants_2[_0x5a3dac(0x1e3)][_0x5a3dac(0x1a2)];}finally{await this[_0x5a3dac(0x1b1)](),await this[_0x5a3dac(0x1ad)][_0x5a3dac(0x1e9)](),await this[_0x5a3dac(0x1c9)]['update']();}}}function a304_0x5b72(_0x517f27,_0x328e05){const _0x53d6da=a304_0x57ed();return a304_0x5b72=function(_0x1313ee,_0x4c8de7){_0x1313ee=_0x1313ee-0x19b;let _0x57edba=_0x53d6da[_0x1313ee];return _0x57edba;},a304_0x5b72(_0x517f27,_0x328e05);}exports[a304_0x5b13b5(0x1c5)]=Job,new Job()[a304_0x5b13b5(0x1a1)]()['then'](()=>process[a304_0x5b13b5(0x1eb)](0x0))['catch'](_0xdf35e5=>{const _0xb0c091=a304_0x5b13b5;systemLogger[_0xb0c091(0x1aa)]('Job\x20Error:\x20'+_0xdf35e5[_0xb0c091(0x1cb)]),process[_0xb0c091(0x1eb)](0x1);});