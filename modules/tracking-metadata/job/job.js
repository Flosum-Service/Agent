const a347_0x5a5028=a347_0xc107;function a347_0x2ec6(){const _0x2abad9=['trackingSettingId','RestSimpleDeployData','argv','Tracking\x20components\x20job\x20has\x20been\x20failed','join','logger','../../../constants/job','COMPLETED','getComponentsDeployer','initMetadataLogger','jobId','lastRetrieveDate','66525TCYwYr','create','Tracking\x20setting\x20not\x20updated\x20\x0a\x20','getTime','IN_PROGRESS','flosumOrgCredentials','flosumInstance','Job\x20Error:\x20','execute','metadataTypes','SourceMemberRetriever','parse','LogStatus','Logger','metadataLogId','Tracking\x20setting\x20updated','Job','defineProperty','../../../core','(((.+)+)+)+$','fs/promises','AxiosInstanceUtils','path','metadataLogger','startDate','jobStorePath','targetInstance','status','Tracking\x20components\x20job\x20has\x20been\x20completed','constructor','114zQZodW','error','__esModule','targetOrgCredentials','8585CUbYjy','4hUwbJy','322308yJKzIO','getSourceMemberRetriever','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','initLogger','Last_Start_Retrieval__c','Tracking_Setting__c','__importDefault','AuthManager','then','ComponentsDeployer','message','1712672hbsqZv','default','apply','apiVersion','../../../constants','exit','updateTrackingSetting','Is_Processed__c','initInstances','success','getSourceMemberHandler','MANIFEST_FILENAME','update','./classes/metadata.retriever','timeZone','getMetadataRetriever','createTrackingSettingRecord','targetOrgId','slice','84511DdZrxZ','pipeline','toString','384460BKKeev','FLOSUM_NAMESPACE','67049bOePiK','search','initManifest','log','./classes/logger/logger','readFile','SourceMemberHandler'];a347_0x2ec6=function(){return _0x2abad9;};return a347_0x2ec6();}(function(_0x268b71,_0x142fcb){const _0x4df138=a347_0xc107,_0x4ac0aa=_0x268b71();while(!![]){try{const _0x4cb74c=-parseInt(_0x4df138(0xa5))/0x1+parseInt(_0x4df138(0xa3))/0x2+parseInt(_0x4df138(0xb8))/0x3+-parseInt(_0x4df138(0x81))/0x4*(parseInt(_0x4df138(0x80))/0x5)+-parseInt(_0x4df138(0x7c))/0x6*(-parseInt(_0x4df138(0xa0))/0x7)+-parseInt(_0x4df138(0x8d))/0x8+-parseInt(_0x4df138(0x82))/0x9;if(_0x4cb74c===_0x142fcb)break;else _0x4ac0aa['push'](_0x4ac0aa['shift']());}catch(_0x1cfa8d){_0x4ac0aa['push'](_0x4ac0aa['shift']());}}}(a347_0x2ec6,0x1e8ca));function a347_0xc107(_0x462b66,_0x21214d){const _0x4a5193=a347_0x2ec6();return a347_0xc107=function(_0x2555c1,_0x16ee45){_0x2555c1=_0x2555c1-0x65;let _0x2ec6b6=_0x4a5193[_0x2555c1];return _0x2ec6b6;},a347_0xc107(_0x462b66,_0x21214d);}const a347_0x16ee45=(function(){let _0x451cc5=!![];return function(_0x3a5824,_0x576b4f){const _0x21e5db=_0x451cc5?function(){const _0x4a5f5a=a347_0xc107;if(_0x576b4f){const _0x6bec2a=_0x576b4f[_0x4a5f5a(0x8f)](_0x3a5824,arguments);return _0x576b4f=null,_0x6bec2a;}}:function(){};return _0x451cc5=![],_0x21e5db;};}()),a347_0x2555c1=a347_0x16ee45(this,function(){const _0x524eed=a347_0xc107;return a347_0x2555c1[_0x524eed(0xa2)]()[_0x524eed(0xa6)](_0x524eed(0x71))[_0x524eed(0xa2)]()[_0x524eed(0x7b)](a347_0x2555c1)[_0x524eed(0xa6)](_0x524eed(0x71));});a347_0x2555c1();'use strict';var __importDefault=this&&this[a347_0x5a5028(0x88)]||function(_0x4236f8){return _0x4236f8&&_0x4236f8['__esModule']?_0x4236f8:{'default':_0x4236f8};};Object[a347_0x5a5028(0x6f)](exports,a347_0x5a5028(0x7e),{'value':!![]}),exports[a347_0x5a5028(0x6e)]=void 0x0;const minimist_1=__importDefault(require('minimist')),core_1=require(a347_0x5a5028(0x70)),salesforce_1=require('@flosum/salesforce'),auth_manager_1=require('../../shared/managers/auth.manager'),logger_1=require(a347_0x5a5028(0xa9)),promises_1=require('stream/promises'),promises_2=require(a347_0x5a5028(0x72)),path_1=__importDefault(require(a347_0x5a5028(0x74))),metadata_retriever_1=require(a347_0x5a5028(0x9a)),components_deployer_1=require('./classes/components.deployer'),source_member_retriever_1=require('./classes/source-member.retriever'),source_member_handler_1=require('./classes/source-member.handler'),metadata_logger_1=require('./classes/metadata-logger'),job_1=require(a347_0x5a5028(0xb2)),constants_1=require(a347_0x5a5028(0x91)),constants_2=require('../constants'),{jobId,jobStorePath}=(0x0,minimist_1['default'])(process[a347_0x5a5028(0xae)][a347_0x5a5028(0x9f)](0x2)),systemLogger=new core_1[(a347_0x5a5028(0x6b))](jobId);class Job{constructor(){this['jobStorePath']=jobStorePath,this['jobId']=jobId;}async[a347_0x5a5028(0xa7)](){const _0x1ee9ab=a347_0x5a5028,_0x2e4471=path_1[_0x1ee9ab(0x8e)][_0x1ee9ab(0xb0)](this[_0x1ee9ab(0x77)],job_1[_0x1ee9ab(0x98)]),_0x307209=await(0x0,promises_2[_0x1ee9ab(0xaa)])(_0x2e4471,{'encoding':'utf-8'})[_0x1ee9ab(0x8a)](JSON[_0x1ee9ab(0x69)])[_0x1ee9ab(0x8a)](({details:_0x31bdca})=>_0x31bdca);await(0x0,promises_2['rm'])(_0x2e4471,{'recursive':!![],'force':!![]}),this[_0x1ee9ab(0x90)]=_0x307209[_0x1ee9ab(0x90)],this[_0x1ee9ab(0xbd)]=_0x307209['flosumOrgCredentials'],this['targetOrgCredentials']=_0x307209['targetOrgCredentials'],this[_0x1ee9ab(0x9e)]=_0x307209['targetOrgId'],this[_0x1ee9ab(0xac)]=_0x307209[_0x1ee9ab(0xac)],this[_0x1ee9ab(0xb7)]=_0x307209['lastRetrieveDate'],this[_0x1ee9ab(0x67)]=_0x307209[_0x1ee9ab(0x67)],this[_0x1ee9ab(0x9b)]=_0x307209[_0x1ee9ab(0x9b)];}async[a347_0x5a5028(0x95)](){const _0x110a51=a347_0x5a5028;this[_0x110a51(0xbe)]=await salesforce_1['AxiosInstanceUtils'][_0x110a51(0xb9)](new auth_manager_1['AuthManager'](this['flosumOrgCredentials']),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this['targetInstance']=await salesforce_1[_0x110a51(0x73)][_0x110a51(0xb9)](new auth_manager_1[(_0x110a51(0x89))](this[_0x110a51(0x7f)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async['initMetadataLogger'](){const _0x79277b=a347_0x5a5028;this[_0x79277b(0x75)]=new metadata_logger_1['MetadataLogger']({'apiVersion':this[_0x79277b(0x90)],'instance':this[_0x79277b(0xbe)],'targetOrgId':this['targetOrgId'],'trackingSettingId':this[_0x79277b(0xac)],'startDate':this[_0x79277b(0x76)]}),this['metadataLogId']=await this[_0x79277b(0x75)]['init']();}[a347_0x5a5028(0x85)](){const _0x14cdc3=a347_0x5a5028;this[_0x14cdc3(0xb1)]=new logger_1['Logger']({'systemLogger':systemLogger,'apiVersion':this[_0x14cdc3(0x90)],'instance':this['flosumInstance'],'metadataLogId':this[_0x14cdc3(0x6c)],'timeZone':this[_0x14cdc3(0x9b)]});}[a347_0x5a5028(0x83)](){const _0x551f4e=a347_0x5a5028;return new source_member_retriever_1[(_0x551f4e(0x68))]({'apiVersion':this[_0x551f4e(0x90)],'instance':this[_0x551f4e(0x78)],'logger':this[_0x551f4e(0xb1)],'lastRetrieveDate':this[_0x551f4e(0xb7)],'currentRetrieveDate':this[_0x551f4e(0x76)],'metadataTypes':this[_0x551f4e(0x67)]});}[a347_0x5a5028(0x97)](){const _0x274f29=a347_0x5a5028;return new source_member_handler_1[(_0x274f29(0xab))]({'instance':this['flosumInstance'],'apiVersion':this[_0x274f29(0x90)],'logger':this[_0x274f29(0xb1)],'targetOrgId':this['targetOrgId']});}[a347_0x5a5028(0x9c)](){const _0x13a2c4=a347_0x5a5028;return new metadata_retriever_1['MetadataRetriever']({'instance':this[_0x13a2c4(0x78)],'apiVersion':this['apiVersion'],'logger':this[_0x13a2c4(0xb1)],'metadataTypes':this[_0x13a2c4(0x67)]});}[a347_0x5a5028(0xb4)](){const _0x3c95c5=a347_0x5a5028;return new components_deployer_1[(_0x3c95c5(0x8b))]({'instance':this[_0x3c95c5(0xbe)],'logger':this[_0x3c95c5(0xb1)],'apiVersion':this[_0x3c95c5(0x90)],'targetOrgId':this[_0x3c95c5(0x9e)],'trackingSettingId':this[_0x3c95c5(0xac)]});}[a347_0x5a5028(0x9d)](){const _0x289d1b=a347_0x5a5028;return{'attributes':{'type':constants_1['FLOSUM_NAMESPACE']+'Tracking_Setting__c'},'Id':this[_0x289d1b(0xac)],[constants_1['FLOSUM_NAMESPACE']+_0x289d1b(0x94)]:![],[constants_1['FLOSUM_NAMESPACE']+_0x289d1b(0x86)]:this[_0x289d1b(0x76)]};}async[a347_0x5a5028(0x93)](){const _0x4e8806=a347_0x5a5028,_0x2ddcaa=this[_0x4e8806(0x9d)](),_0x15dabf=new salesforce_1[(_0x4e8806(0xad))]({'instance':this[_0x4e8806(0xbe)],'objectName':constants_1[_0x4e8806(0xa4)]+_0x4e8806(0x87),'api':this[_0x4e8806(0x90)],'allOrNone':![],'externalIdField':'Id'}),_0x14ac7d=await _0x15dabf[_0x4e8806(0x66)]({'records':[_0x2ddcaa]}),_0x128367=_0x14ac7d['at'](0x0);(_0x128367===null||_0x128367===void 0x0?void 0x0:_0x128367[_0x4e8806(0x96)])?this[_0x4e8806(0xb1)]['log'](_0x4e8806(0x6d)):this[_0x4e8806(0xb1)][_0x4e8806(0xa8)](_0x4e8806(0xba)+(_0x128367===null||_0x128367===void 0x0?void 0x0:_0x128367[_0x4e8806(0x7d)]));}async['execute'](){const _0x128440=a347_0x5a5028;await this[_0x128440(0xa7)](),this['startDate']=new Date()[_0x128440(0xbb)]();try{await this[_0x128440(0x95)](),await this[_0x128440(0xb5)](),this[_0x128440(0x85)](),this[_0x128440(0xb1)]['log'](_0x128440(0x84)+this[_0x128440(0xb6)]),this[_0x128440(0x75)]['status']=constants_2[_0x128440(0x6a)][_0x128440(0xbc)],await this[_0x128440(0x75)]['update'](),await this[_0x128440(0xb1)][_0x128440(0x99)]();const _0x5664c9=this[_0x128440(0x83)](),_0x9fd7b6=this[_0x128440(0x97)](),_0x18bac6=this[_0x128440(0x9c)](),_0x242980=this[_0x128440(0xb4)]();await(0x0,promises_1[_0x128440(0xa1)])(_0x5664c9,_0x9fd7b6,_0x18bac6,_0x242980),this[_0x128440(0xb1)][_0x128440(0xa8)](_0x128440(0x7a)),this[_0x128440(0x75)][_0x128440(0x79)]=constants_2['LogStatus'][_0x128440(0xb3)];}catch(_0x4cd095){this[_0x128440(0xb1)][_0x128440(0x7d)](_0x128440(0xaf)),this[_0x128440(0xb1)]['error'](_0x4cd095[_0x128440(0x8c)]),this[_0x128440(0x75)][_0x128440(0x79)]=constants_2[_0x128440(0x6a)]['EXCEPTION'];}finally{await this['updateTrackingSetting'](),await this[_0x128440(0xb1)][_0x128440(0x99)](),await this[_0x128440(0x75)][_0x128440(0x99)]();}}}exports['Job']=Job,new Job()[a347_0x5a5028(0x66)]()[a347_0x5a5028(0x8a)](()=>process[a347_0x5a5028(0x92)](0x0))['catch'](_0x7de0a0=>{const _0x100bfc=a347_0x5a5028;systemLogger['error'](_0x100bfc(0x65)+_0x7de0a0[_0x100bfc(0x8c)]),process['exit'](0x1);});