const a299_0x5f591d=a299_0x48b2;(function(_0x56450f,_0x4bafea){const _0x3f445a=a299_0x48b2,_0x56f386=_0x56450f();while(!![]){try{const _0x24fc8f=-parseInt(_0x3f445a(0xc2))/0x1+parseInt(_0x3f445a(0xbd))/0x2+-parseInt(_0x3f445a(0xa9))/0x3+parseInt(_0x3f445a(0xef))/0x4+-parseInt(_0x3f445a(0xa8))/0x5*(-parseInt(_0x3f445a(0xcf))/0x6)+-parseInt(_0x3f445a(0xac))/0x7+-parseInt(_0x3f445a(0xee))/0x8;if(_0x24fc8f===_0x4bafea)break;else _0x56f386['push'](_0x56f386['shift']());}catch(_0x274c4a){_0x56f386['push'](_0x56f386['shift']());}}}(a299_0x1d0b,0x8407e));const a299_0x5dffb8=(function(){let _0x596074=!![];return function(_0x7d4c67,_0x65ccd1){const _0x1aa587=_0x596074?function(){const _0x84e8fa=a299_0x48b2;if(_0x65ccd1){const _0x271d60=_0x65ccd1[_0x84e8fa(0xe3)](_0x7d4c67,arguments);return _0x65ccd1=null,_0x271d60;}}:function(){};return _0x596074=![],_0x1aa587;};}()),a299_0x477050=a299_0x5dffb8(this,function(){const _0x8396de=a299_0x48b2;return a299_0x477050[_0x8396de(0xb6)]()[_0x8396de(0xb8)](_0x8396de(0xf4))['toString']()['constructor'](a299_0x477050)['search'](_0x8396de(0xf4));});a299_0x477050();function a299_0x48b2(_0x18354a,_0x58ab3c){const _0x358c4b=a299_0x1d0b();return a299_0x48b2=function(_0x477050,_0x5dffb8){_0x477050=_0x477050-0xa6;let _0x1d0bf1=_0x358c4b[_0x477050];return _0x1d0bf1;},a299_0x48b2(_0x18354a,_0x58ab3c);}'use strict';function a299_0x1d0b(){const _0x5d1d57=['AxiosInstanceUtils','targetOrgCredentials','initMetadataLogger','Job\x20Error:\x20','./classes/source-member.handler','exit','Last_Start_Retrieval__c','apiVersion','join','Tracking\x20setting\x20not\x20updated\x20\x0a\x20','create','update','Tracking\x20setting\x20updated','./classes/logger/logger','apply','../../shared/managers/auth.manager','../../../constants/job','parse','Tracking_Setting__c','./classes/components.deployer','execute','flosumInstance','default','jobId','trackingSettingId','2609624VhDCxd','2568592lkDDSs','COMPLETED','targetInstance','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','createTrackingSettingRecord','(((.+)+)+)+$','FLOSUM_NAMESPACE','updateTrackingSetting','path','@flosum/salesforce','AuthManager','error','getSourceMemberHandler','20sLbdBT','1218267YtvRbT','Logger','../../../constants','984634tigaZY','initManifest','Tracking\x20components\x20job\x20has\x20been\x20completed','success','initLogger','flosumOrgCredentials','./classes/metadata-logger','Tracking\x20components\x20job\x20has\x20been\x20failed','utf-8','stream/promises','toString','EXCEPTION','search','then','defineProperty','minimist','argv','2069886WMiwGH','lastRetrieveDate','getTime','jobStorePath','startDate','673911fZBHpC','log','catch','Job','targetOrgId','metadataLogger','./classes/source-member.retriever','message','status','slice','logger','getSourceMemberRetriever','getComponentsDeployer','615858cjFNoP','../../../core','getMetadataRetriever','IN_PROGRESS','metadataTypes','metadataLogId'];a299_0x1d0b=function(){return _0x5d1d57;};return a299_0x1d0b();}var __importDefault=this&&this['__importDefault']||function(_0x434b72){return _0x434b72&&_0x434b72['__esModule']?_0x434b72:{'default':_0x434b72};};Object[a299_0x5f591d(0xba)](exports,'__esModule',{'value':!![]}),exports[a299_0x5f591d(0xc5)]=void 0x0;const minimist_1=__importDefault(require(a299_0x5f591d(0xbb))),core_1=require(a299_0x5f591d(0xd0)),salesforce_1=require(a299_0x5f591d(0xf8)),auth_manager_1=require(a299_0x5f591d(0xe4)),logger_1=__importDefault(require(a299_0x5f591d(0xe2))),promises_1=require(a299_0x5f591d(0xb5)),promises_2=require('fs/promises'),path_1=__importDefault(require(a299_0x5f591d(0xf7))),metadata_retriever_1=__importDefault(require('./classes/metadata.retriever')),components_deployer_1=__importDefault(require(a299_0x5f591d(0xe8))),source_member_retriever_1=__importDefault(require(a299_0x5f591d(0xc8))),source_member_handler_1=__importDefault(require(a299_0x5f591d(0xd9))),metadata_logger_1=__importDefault(require(a299_0x5f591d(0xb2))),job_1=require(a299_0x5f591d(0xe5)),constants_1=require(a299_0x5f591d(0xab)),constants_2=require('../constants'),{jobId,jobStorePath}=(0x0,minimist_1[a299_0x5f591d(0xeb)])(process[a299_0x5f591d(0xbc)][a299_0x5f591d(0xcb)](0x2)),systemLogger=new core_1[(a299_0x5f591d(0xaa))](jobId);class Job{constructor(){const _0x3a4827=a299_0x5f591d;this[_0x3a4827(0xc0)]=jobStorePath,this[_0x3a4827(0xec)]=jobId;}async['initManifest'](){const _0x312f07=a299_0x5f591d,_0x31f857=path_1[_0x312f07(0xeb)][_0x312f07(0xdd)](this['jobStorePath'],job_1['MANIFEST_FILENAME']),_0x3f5ce1=await(0x0,promises_2['readFile'])(_0x31f857,{'encoding':_0x312f07(0xb4)})[_0x312f07(0xb9)](JSON[_0x312f07(0xe6)])[_0x312f07(0xb9)](({details:_0x49b62a})=>_0x49b62a);await(0x0,promises_2['rm'])(_0x31f857,{'recursive':!![],'force':!![]}),this[_0x312f07(0xdc)]=_0x3f5ce1[_0x312f07(0xdc)],this[_0x312f07(0xb1)]=_0x3f5ce1[_0x312f07(0xb1)],this[_0x312f07(0xd6)]=_0x3f5ce1[_0x312f07(0xd6)],this[_0x312f07(0xc6)]=_0x3f5ce1['targetOrgId'],this[_0x312f07(0xed)]=_0x3f5ce1[_0x312f07(0xed)],this[_0x312f07(0xbe)]=_0x3f5ce1[_0x312f07(0xbe)],this[_0x312f07(0xd3)]=_0x3f5ce1[_0x312f07(0xd3)];}async['initInstances'](){const _0x1e3dbc=a299_0x5f591d;this[_0x1e3dbc(0xea)]=await salesforce_1[_0x1e3dbc(0xd5)][_0x1e3dbc(0xdf)](new auth_manager_1['AuthManager'](this[_0x1e3dbc(0xb1)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this['targetInstance']=await salesforce_1['AxiosInstanceUtils'][_0x1e3dbc(0xdf)](new auth_manager_1[(_0x1e3dbc(0xf9))](this['targetOrgCredentials']),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async['initMetadataLogger'](){const _0x3fce66=a299_0x5f591d;this['metadataLogger']=new metadata_logger_1[(_0x3fce66(0xeb))]({'apiVersion':this[_0x3fce66(0xdc)],'instance':this[_0x3fce66(0xea)],'targetOrgId':this[_0x3fce66(0xc6)],'trackingSettingId':this[_0x3fce66(0xed)],'startDate':this['startDate']}),this[_0x3fce66(0xd4)]=await this[_0x3fce66(0xc7)]['init']();}[a299_0x5f591d(0xb0)](){const _0x4eeb68=a299_0x5f591d;this[_0x4eeb68(0xcc)]=new logger_1['default']({'systemLogger':systemLogger,'apiVersion':this[_0x4eeb68(0xdc)],'instance':this[_0x4eeb68(0xea)],'metadataLogId':this[_0x4eeb68(0xd4)]});}[a299_0x5f591d(0xcd)](){const _0x5526b=a299_0x5f591d;return new source_member_retriever_1['default']({'apiVersion':this[_0x5526b(0xdc)],'instance':this[_0x5526b(0xf1)],'logger':this[_0x5526b(0xcc)],'lastRetrieveDate':this[_0x5526b(0xbe)],'currentRetrieveDate':this[_0x5526b(0xc1)],'metadataTypes':this[_0x5526b(0xd3)]});}[a299_0x5f591d(0xa7)](){const _0x519126=a299_0x5f591d;return new source_member_handler_1[(_0x519126(0xeb))]({'instance':this[_0x519126(0xea)],'apiVersion':this['apiVersion'],'logger':this[_0x519126(0xcc)],'targetOrgId':this[_0x519126(0xc6)]});}['getMetadataRetriever'](){const _0x464cad=a299_0x5f591d;return new metadata_retriever_1['default']({'instance':this['targetInstance'],'apiVersion':this[_0x464cad(0xdc)],'logger':this['logger'],'metadataTypes':this[_0x464cad(0xd3)]});}[a299_0x5f591d(0xce)](){const _0x39b572=a299_0x5f591d;return new components_deployer_1['default']({'instance':this['flosumInstance'],'logger':this[_0x39b572(0xcc)],'apiVersion':this[_0x39b572(0xdc)],'targetOrgId':this[_0x39b572(0xc6)],'trackingSettingId':this['trackingSettingId']});}['createTrackingSettingRecord'](){const _0x5a189d=a299_0x5f591d;return{'attributes':{'type':constants_1[_0x5a189d(0xf5)]+_0x5a189d(0xe7)},'Id':this[_0x5a189d(0xed)],[constants_1[_0x5a189d(0xf5)]+'Is_Processed__c']:![],[constants_1[_0x5a189d(0xf5)]+_0x5a189d(0xdb)]:this[_0x5a189d(0xc1)]};}async[a299_0x5f591d(0xf6)](){const _0x23ee67=a299_0x5f591d,_0x1a1a9d=this[_0x23ee67(0xf3)](),_0x1f7fec=new salesforce_1['RestSimpleDeployData']({'instance':this[_0x23ee67(0xea)],'objectName':constants_1[_0x23ee67(0xf5)]+'Tracking_Setting__c','api':this[_0x23ee67(0xdc)],'allOrNone':![],'externalIdField':'Id'}),_0xa3ae90=await _0x1f7fec[_0x23ee67(0xe9)]({'records':[_0x1a1a9d]}),_0x2d0605=_0xa3ae90['at'](0x0);(_0x2d0605===null||_0x2d0605===void 0x0?void 0x0:_0x2d0605[_0x23ee67(0xaf)])?this[_0x23ee67(0xcc)][_0x23ee67(0xc3)](_0x23ee67(0xe1)):this[_0x23ee67(0xcc)]['log'](_0x23ee67(0xde)+(_0x2d0605===null||_0x2d0605===void 0x0?void 0x0:_0x2d0605[_0x23ee67(0xa6)]));}async['execute'](){const _0xf1c6d=a299_0x5f591d;await this[_0xf1c6d(0xad)](),this[_0xf1c6d(0xc1)]=new Date()[_0xf1c6d(0xbf)]();try{await this['initInstances'](),await this[_0xf1c6d(0xd7)](),this[_0xf1c6d(0xb0)](),this[_0xf1c6d(0xcc)][_0xf1c6d(0xc3)](_0xf1c6d(0xf2)+this[_0xf1c6d(0xec)]),this[_0xf1c6d(0xc7)][_0xf1c6d(0xca)]=constants_2['LogStatus'][_0xf1c6d(0xd2)],await this[_0xf1c6d(0xc7)][_0xf1c6d(0xe0)](),await this[_0xf1c6d(0xcc)][_0xf1c6d(0xe0)]();const _0x5ac914=this['getSourceMemberRetriever'](),_0x576155=this[_0xf1c6d(0xa7)](),_0x5a5811=this[_0xf1c6d(0xd1)](),_0x3fae5e=this[_0xf1c6d(0xce)]();await(0x0,promises_1['pipeline'])(_0x5ac914,_0x576155,_0x5a5811,_0x3fae5e),this[_0xf1c6d(0xcc)]['log'](_0xf1c6d(0xae)),this['metadataLogger'][_0xf1c6d(0xca)]=constants_2['LogStatus'][_0xf1c6d(0xf0)];}catch(_0x8b3600){this[_0xf1c6d(0xcc)][_0xf1c6d(0xa6)](_0xf1c6d(0xb3)),this['logger'][_0xf1c6d(0xa6)](_0x8b3600[_0xf1c6d(0xc9)]),this['metadataLogger'][_0xf1c6d(0xca)]=constants_2['LogStatus'][_0xf1c6d(0xb7)];}finally{await this['updateTrackingSetting'](),await this[_0xf1c6d(0xcc)][_0xf1c6d(0xe0)](),await this[_0xf1c6d(0xc7)]['update']();}}}exports[a299_0x5f591d(0xc5)]=Job,new Job()['execute']()[a299_0x5f591d(0xb9)](()=>process[a299_0x5f591d(0xda)](0x0))[a299_0x5f591d(0xc4)](_0x2b0ed1=>{const _0x2ac146=a299_0x5f591d;systemLogger['error'](_0x2ac146(0xd8)+_0x2b0ed1['message']),process[_0x2ac146(0xda)](0x1);});