const a348_0x44e12a=a348_0x4cf7;(function(_0x304a9,_0x1dd903){const _0x2e0c0d=a348_0x4cf7,_0x1ab49a=_0x304a9();while(!![]){try{const _0x4ab174=-parseInt(_0x2e0c0d(0x1a1))/0x1+parseInt(_0x2e0c0d(0x155))/0x2*(-parseInt(_0x2e0c0d(0x173))/0x3)+-parseInt(_0x2e0c0d(0x15f))/0x4*(-parseInt(_0x2e0c0d(0x178))/0x5)+parseInt(_0x2e0c0d(0x15a))/0x6*(-parseInt(_0x2e0c0d(0x18a))/0x7)+parseInt(_0x2e0c0d(0x177))/0x8+parseInt(_0x2e0c0d(0x194))/0x9*(-parseInt(_0x2e0c0d(0x189))/0xa)+parseInt(_0x2e0c0d(0x18f))/0xb;if(_0x4ab174===_0x1dd903)break;else _0x1ab49a['push'](_0x1ab49a['shift']());}catch(_0x13e29d){_0x1ab49a['push'](_0x1ab49a['shift']());}}}(a348_0x1e4c,0x38072));const a348_0x5bfb73=(function(){let _0x4d8907=!![];return function(_0x23fd7a,_0x1c6f32){const _0x58f2c2=_0x4d8907?function(){const _0x2825e1=a348_0x4cf7;if(_0x1c6f32){const _0x4eeaea=_0x1c6f32[_0x2825e1(0x19c)](_0x23fd7a,arguments);return _0x1c6f32=null,_0x4eeaea;}}:function(){};return _0x4d8907=![],_0x58f2c2;};}()),a348_0x4877c9=a348_0x5bfb73(this,function(){const _0x1fd421=a348_0x4cf7;return a348_0x4877c9[_0x1fd421(0x17c)]()[_0x1fd421(0x16e)](_0x1fd421(0x18e))[_0x1fd421(0x17c)]()[_0x1fd421(0x17b)](a348_0x4877c9)[_0x1fd421(0x16e)](_0x1fd421(0x18e));});a348_0x4877c9();'use strict';function a348_0x4cf7(_0x2a73ac,_0x51b431){const _0x47f334=a348_0x1e4c();return a348_0x4cf7=function(_0x4877c9,_0x5bfb73){_0x4877c9=_0x4877c9-0x152;let _0x1e4cbd=_0x47f334[_0x4877c9];return _0x1e4cbd;},a348_0x4cf7(_0x2a73ac,_0x51b431);}var __importDefault=this&&this[a348_0x44e12a(0x19f)]||function(_0x312a0d){const _0x1e1ba2=a348_0x44e12a;return _0x312a0d&&_0x312a0d[_0x1e1ba2(0x16a)]?_0x312a0d:{'default':_0x312a0d};};Object[a348_0x44e12a(0x15b)](exports,'__esModule',{'value':!![]}),exports[a348_0x44e12a(0x175)]=void 0x0;function a348_0x1e4c(){const _0x49cb49=['initManifest','@flosum/salesforce','targetOrgId','getSourceMemberHandler','message','Job\x20Error:\x20','targetOrgCredentials','trackingSettingId','jobId','createTrackingSettingRecord','../../shared/managers/auth.manager','Logger','getComponentsDeployer','10IskNVH','./classes/metadata-logger','MetadataRetriever','../../../core','flosumInstance','150hRpBCB','defineProperty','isProcessed','flosumOrgCredentials','join','31316IuRsrK','metadataLogger','lastRetrieveDate','success','slice','SourceMemberRetriever','Tracking\x20setting\x20not\x20updated\x20\x0a\x20','init','startDate','AuthManager','exit','__esModule','FLOSUM_NAMESPACE','./classes/source-member.handler','IN_PROGRESS','search','catch','pipeline','logger','status','201846xiGJmk','../../../constants','Job','update','2705080fNxjGJ','255ZIBFpC','getMetadataRetriever','initInstances','constructor','toString','metadataTypes','ComponentsDeployer','./classes/logger/logger','argv','AxiosInstanceUtils','readFile','default','Tracking\x20setting\x20updated','LogStatus','./classes/components.deployer','path','initLogger','102530wObQSF','122437WOndtc','getTime','./classes/metadata.retriever','jobStorePath','(((.+)+)+)+$','11299343LQZXuM','timeZone','then','getSourceMemberRetriever','execute','378eEjQIb','targetInstance','Last_Start_Retrieval__c','parse','error','Tracking_Setting__c','log','create','apply','apiVersion','updateTrackingSetting','__importDefault','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','330826KteJTt'];a348_0x1e4c=function(){return _0x49cb49;};return a348_0x1e4c();}const minimist_1=__importDefault(require('minimist')),core_1=require(a348_0x44e12a(0x158)),salesforce_1=require(a348_0x44e12a(0x1a3)),auth_manager_1=require(a348_0x44e12a(0x152)),logger_1=require(a348_0x44e12a(0x17f)),promises_1=require('stream/promises'),promises_2=require('fs/promises'),path_1=__importDefault(require(a348_0x44e12a(0x187))),metadata_retriever_1=require(a348_0x44e12a(0x18c)),components_deployer_1=require(a348_0x44e12a(0x186)),source_member_retriever_1=require('./classes/source-member.retriever'),source_member_handler_1=require(a348_0x44e12a(0x16c)),metadata_logger_1=require(a348_0x44e12a(0x156)),job_1=require('../../../constants/job'),constants_1=require(a348_0x44e12a(0x174)),constants_2=require('../constants'),{jobId,jobStorePath}=(0x0,minimist_1['default'])(process[a348_0x44e12a(0x180)][a348_0x44e12a(0x163)](0x2)),systemLogger=new core_1['Logger'](jobId);class Job{constructor(){const _0x5378c6=a348_0x44e12a;this[_0x5378c6(0x18d)]=jobStorePath,this[_0x5378c6(0x1aa)]=jobId;}async['initManifest'](){const _0x3862ea=a348_0x44e12a,_0x2bf402=path_1[_0x3862ea(0x183)][_0x3862ea(0x15e)](this[_0x3862ea(0x18d)],job_1['MANIFEST_FILENAME']),_0x289ed0=await(0x0,promises_2[_0x3862ea(0x182)])(_0x2bf402,{'encoding':'utf-8'})[_0x3862ea(0x191)](JSON[_0x3862ea(0x197)])[_0x3862ea(0x191)](({details:_0x35ccd7})=>_0x35ccd7);await(0x0,promises_2['rm'])(_0x2bf402,{'recursive':!![],'force':!![]}),this[_0x3862ea(0x19d)]=_0x289ed0[_0x3862ea(0x19d)],this[_0x3862ea(0x15d)]=_0x289ed0['flosumOrgCredentials'],this[_0x3862ea(0x1a8)]=_0x289ed0['targetOrgCredentials'],this[_0x3862ea(0x1a4)]=_0x289ed0[_0x3862ea(0x1a4)],this[_0x3862ea(0x1a9)]=_0x289ed0['trackingSettingId'],this[_0x3862ea(0x161)]=_0x289ed0[_0x3862ea(0x161)],this[_0x3862ea(0x17d)]=_0x289ed0['metadataTypes'],this['timeZone']=_0x289ed0[_0x3862ea(0x190)];}async[a348_0x44e12a(0x17a)](){const _0x1ae93a=a348_0x44e12a;this[_0x1ae93a(0x159)]=await salesforce_1['AxiosInstanceUtils'][_0x1ae93a(0x19b)](new auth_manager_1[(_0x1ae93a(0x168))](this[_0x1ae93a(0x15d)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this[_0x1ae93a(0x195)]=await salesforce_1[_0x1ae93a(0x181)]['create'](new auth_manager_1[(_0x1ae93a(0x168))](this[_0x1ae93a(0x1a8)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async['initMetadataLogger'](){const _0x1a1e2f=a348_0x44e12a;this['metadataLogger']=new metadata_logger_1['MetadataLogger']({'apiVersion':this[_0x1a1e2f(0x19d)],'instance':this['flosumInstance'],'targetOrgId':this[_0x1a1e2f(0x1a4)],'trackingSettingId':this[_0x1a1e2f(0x1a9)],'startDate':this[_0x1a1e2f(0x167)]}),this['metadataLogId']=await this['metadataLogger'][_0x1a1e2f(0x166)]();}[a348_0x44e12a(0x188)](){const _0x915698=a348_0x44e12a;this[_0x915698(0x171)]=new logger_1[(_0x915698(0x153))]({'systemLogger':systemLogger,'apiVersion':this[_0x915698(0x19d)],'instance':this[_0x915698(0x159)],'metadataLogId':this['metadataLogId'],'timeZone':this[_0x915698(0x190)]});}[a348_0x44e12a(0x192)](){const _0x5b4069=a348_0x44e12a;return new source_member_retriever_1[(_0x5b4069(0x164))]({'apiVersion':this[_0x5b4069(0x19d)],'instance':this[_0x5b4069(0x195)],'logger':this['logger'],'lastRetrieveDate':this['lastRetrieveDate'],'currentRetrieveDate':this['startDate'],'metadataTypes':this[_0x5b4069(0x17d)]});}[a348_0x44e12a(0x1a5)](){const _0x32a554=a348_0x44e12a;return new source_member_handler_1['SourceMemberHandler']({'instance':this[_0x32a554(0x159)],'apiVersion':this[_0x32a554(0x19d)],'logger':this[_0x32a554(0x171)],'targetOrgId':this[_0x32a554(0x1a4)]});}[a348_0x44e12a(0x179)](){const _0x5b398e=a348_0x44e12a;return new metadata_retriever_1[(_0x5b398e(0x157))]({'instance':this['targetInstance'],'apiVersion':this['apiVersion'],'logger':this[_0x5b398e(0x171)],'metadataTypes':this[_0x5b398e(0x17d)]});}[a348_0x44e12a(0x154)](){const _0x37278a=a348_0x44e12a;return new components_deployer_1[(_0x37278a(0x17e))]({'instance':this['flosumInstance'],'logger':this['logger'],'apiVersion':this[_0x37278a(0x19d)],'targetOrgId':this[_0x37278a(0x1a4)],'trackingSettingId':this[_0x37278a(0x1a9)]});}[a348_0x44e12a(0x1ab)](){const _0xd1ad5b=a348_0x44e12a;return{'attributes':{'type':constants_1['FLOSUM_NAMESPACE']+_0xd1ad5b(0x199)},'Id':this[_0xd1ad5b(0x1a9)],[constants_1[_0xd1ad5b(0x16b)]+'Is_Processed__c']:this[_0xd1ad5b(0x15c)],[constants_1[_0xd1ad5b(0x16b)]+_0xd1ad5b(0x196)]:this[_0xd1ad5b(0x167)]};}async['updateTrackingSetting'](){const _0x5b540f=a348_0x44e12a,_0x4a60d0=this[_0x5b540f(0x1ab)](),_0xf3c08e=new salesforce_1['RestSimpleDeployData']({'instance':this[_0x5b540f(0x159)],'objectName':constants_1[_0x5b540f(0x16b)]+_0x5b540f(0x199),'api':this[_0x5b540f(0x19d)],'allOrNone':![],'externalIdField':'Id'}),_0x1c615f=await _0xf3c08e[_0x5b540f(0x193)]({'records':[_0x4a60d0]}),_0x14ff83=_0x1c615f['at'](0x0);(_0x14ff83===null||_0x14ff83===void 0x0?void 0x0:_0x14ff83[_0x5b540f(0x162)])?this[_0x5b540f(0x171)][_0x5b540f(0x19a)](_0x5b540f(0x184)):this[_0x5b540f(0x171)][_0x5b540f(0x19a)](_0x5b540f(0x165)+(_0x14ff83===null||_0x14ff83===void 0x0?void 0x0:_0x14ff83[_0x5b540f(0x198)]));}async[a348_0x44e12a(0x193)](){const _0x3a0028=a348_0x44e12a;await this[_0x3a0028(0x1a2)](),this[_0x3a0028(0x167)]=new Date()[_0x3a0028(0x18b)]();try{await this[_0x3a0028(0x17a)](),await this['initMetadataLogger'](),this[_0x3a0028(0x188)](),this[_0x3a0028(0x171)][_0x3a0028(0x19a)](_0x3a0028(0x1a0)+this[_0x3a0028(0x1aa)]),this[_0x3a0028(0x160)]['status']=constants_2[_0x3a0028(0x185)][_0x3a0028(0x16d)],this[_0x3a0028(0x15c)]=!![],await this[_0x3a0028(0x19e)](),await this[_0x3a0028(0x160)][_0x3a0028(0x176)](),await this[_0x3a0028(0x171)][_0x3a0028(0x176)]();const _0x50cefe=this[_0x3a0028(0x192)](),_0x3d4aaa=this['getSourceMemberHandler'](),_0x4404a9=this[_0x3a0028(0x179)](),_0x48f1c9=this[_0x3a0028(0x154)]();await(0x0,promises_1[_0x3a0028(0x170)])(_0x50cefe,_0x3d4aaa,_0x4404a9,_0x48f1c9),this[_0x3a0028(0x171)][_0x3a0028(0x19a)]('Tracking\x20components\x20job\x20has\x20been\x20completed'),this[_0x3a0028(0x160)][_0x3a0028(0x172)]=constants_2[_0x3a0028(0x185)]['COMPLETED'];}catch(_0x19ad5a){this['logger'][_0x3a0028(0x198)]('Tracking\x20components\x20job\x20has\x20been\x20failed'),this['logger'][_0x3a0028(0x198)](_0x19ad5a[_0x3a0028(0x1a6)]),this[_0x3a0028(0x160)][_0x3a0028(0x172)]=constants_2[_0x3a0028(0x185)]['EXCEPTION'];}finally{this[_0x3a0028(0x15c)]=![],await this['updateTrackingSetting'](),await this[_0x3a0028(0x171)][_0x3a0028(0x176)](),await this[_0x3a0028(0x160)][_0x3a0028(0x176)]();}}}exports[a348_0x44e12a(0x175)]=Job,new Job()[a348_0x44e12a(0x193)]()[a348_0x44e12a(0x191)](()=>process[a348_0x44e12a(0x169)](0x0))[a348_0x44e12a(0x16f)](_0xf8d7e9=>{const _0x108730=a348_0x44e12a;systemLogger[_0x108730(0x198)](_0x108730(0x1a7)+_0xf8d7e9[_0x108730(0x1a6)]),process[_0x108730(0x169)](0x1);});