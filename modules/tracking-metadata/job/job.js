const a347_0x2cf249=a347_0x44f3;(function(_0x3c1120,_0x42a540){const _0xd923fb=a347_0x44f3,_0xee68d9=_0x3c1120();while(!![]){try{const _0x31b595=-parseInt(_0xd923fb(0x16d))/0x1+parseInt(_0xd923fb(0x168))/0x2*(parseInt(_0xd923fb(0x174))/0x3)+parseInt(_0xd923fb(0x17b))/0x4+-parseInt(_0xd923fb(0x136))/0x5*(parseInt(_0xd923fb(0x180))/0x6)+-parseInt(_0xd923fb(0x175))/0x7*(parseInt(_0xd923fb(0x16e))/0x8)+-parseInt(_0xd923fb(0x179))/0x9+parseInt(_0xd923fb(0x158))/0xa*(parseInt(_0xd923fb(0x16b))/0xb);if(_0x31b595===_0x42a540)break;else _0xee68d9['push'](_0xee68d9['shift']());}catch(_0x2226eb){_0xee68d9['push'](_0xee68d9['shift']());}}}(a347_0x174a,0x8cdc5));const a347_0x31b1be=(function(){let _0x4470b3=!![];return function(_0x2a476e,_0x3176db){const _0x1cce50=_0x4470b3?function(){const _0x2063e2=a347_0x44f3;if(_0x3176db){const _0x32ad0b=_0x3176db[_0x2063e2(0x18f)](_0x2a476e,arguments);return _0x3176db=null,_0x32ad0b;}}:function(){};return _0x4470b3=![],_0x1cce50;};}()),a347_0x46e467=a347_0x31b1be(this,function(){const _0x34e71f=a347_0x44f3;return a347_0x46e467[_0x34e71f(0x181)]()[_0x34e71f(0x17c)](_0x34e71f(0x193))['toString']()[_0x34e71f(0x165)](a347_0x46e467)[_0x34e71f(0x17c)](_0x34e71f(0x193));});function a347_0x174a(){const _0x2a1284=['flosumOrgCredentials','initInstances','constructor','SourceMemberRetriever','exit','68YvMmlQ','parse','jobStorePath','36672449melTmq','execute','1133903uMzIiA','60832bZPWna','MANIFEST_FILENAME','minimist','../constants','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','metadataLogId','12615wdYWfY','791zxHbuT','update','__esModule','createTrackingSettingRecord','5794776IWzjLa','fs/promises','2177464OXvNEd','search','init','getSourceMemberHandler','Job','4843266LZWMkI','toString','slice','startDate','stream/promises','defineProperty','pipeline','success','COMPLETED','logger','../../shared/managers/auth.manager','log','./classes/logger/logger','metadataTypes','Tracking\x20components\x20job\x20has\x20been\x20failed','apply','argv','./classes/metadata.retriever','targetOrgCredentials','(((.+)+)+)+$','jobId','5Rzyyzf','status','timeZone','flosumInstance','trackingSettingId','message','RestSimpleDeployData','readFile','initLogger','EXCEPTION','./classes/metadata-logger','error','initMetadataLogger','targetInstance','targetOrgId','LogStatus','getComponentsDeployer','default','create','Last_Start_Retrieval__c','FLOSUM_NAMESPACE','AxiosInstanceUtils','apiVersion','join','MetadataRetriever','Tracking_Setting__c','utf-8','getTime','lastRetrieveDate','../../../constants/job','SourceMemberHandler','Is_Processed__c','Job\x20Error:\x20','then','10okAXiL','Logger','./classes/source-member.retriever','metadataLogger','Tracking\x20setting\x20updated','IN_PROGRESS','../../../core','updateTrackingSetting','./classes/components.deployer','MetadataLogger','getMetadataRetriever'];a347_0x174a=function(){return _0x2a1284;};return a347_0x174a();}a347_0x46e467();'use strict';function a347_0x44f3(_0x3a94f7,_0x5bbdfd){const _0x526b2b=a347_0x174a();return a347_0x44f3=function(_0x46e467,_0x31b1be){_0x46e467=_0x46e467-0x135;let _0x174a02=_0x526b2b[_0x46e467];return _0x174a02;},a347_0x44f3(_0x3a94f7,_0x5bbdfd);}var __importDefault=this&&this['__importDefault']||function(_0x59b3ca){const _0x3a37a7=a347_0x44f3;return _0x59b3ca&&_0x59b3ca[_0x3a37a7(0x177)]?_0x59b3ca:{'default':_0x59b3ca};};Object[a347_0x2cf249(0x185)](exports,a347_0x2cf249(0x177),{'value':!![]}),exports['Job']=void 0x0;const minimist_1=__importDefault(require(a347_0x2cf249(0x170))),core_1=require(a347_0x2cf249(0x15e)),salesforce_1=require('@flosum/salesforce'),auth_manager_1=require(a347_0x2cf249(0x18a)),logger_1=require(a347_0x2cf249(0x18c)),promises_1=require(a347_0x2cf249(0x184)),promises_2=require(a347_0x2cf249(0x17a)),path_1=__importDefault(require('path')),metadata_retriever_1=require(a347_0x2cf249(0x191)),components_deployer_1=require(a347_0x2cf249(0x160)),source_member_retriever_1=require(a347_0x2cf249(0x15a)),source_member_handler_1=require('./classes/source-member.handler'),metadata_logger_1=require(a347_0x2cf249(0x140)),job_1=require(a347_0x2cf249(0x153)),constants_1=require('../../../constants'),constants_2=require(a347_0x2cf249(0x171)),{jobId,jobStorePath}=(0x0,minimist_1[a347_0x2cf249(0x147)])(process[a347_0x2cf249(0x190)][a347_0x2cf249(0x182)](0x2)),systemLogger=new core_1[(a347_0x2cf249(0x159))](jobId);class Job{constructor(){const _0x237228=a347_0x2cf249;this[_0x237228(0x16a)]=jobStorePath,this[_0x237228(0x135)]=jobId;}async['initManifest'](){const _0x58dcd4=a347_0x2cf249,_0x5ce411=path_1[_0x58dcd4(0x147)][_0x58dcd4(0x14d)](this[_0x58dcd4(0x16a)],job_1[_0x58dcd4(0x16f)]),_0x32278d=await(0x0,promises_2[_0x58dcd4(0x13d)])(_0x5ce411,{'encoding':_0x58dcd4(0x150)})['then'](JSON[_0x58dcd4(0x169)])['then'](({details:_0xe6a8c3})=>_0xe6a8c3);await(0x0,promises_2['rm'])(_0x5ce411,{'recursive':!![],'force':!![]}),this[_0x58dcd4(0x14c)]=_0x32278d[_0x58dcd4(0x14c)],this[_0x58dcd4(0x163)]=_0x32278d['flosumOrgCredentials'],this[_0x58dcd4(0x192)]=_0x32278d[_0x58dcd4(0x192)],this[_0x58dcd4(0x144)]=_0x32278d[_0x58dcd4(0x144)],this[_0x58dcd4(0x13a)]=_0x32278d['trackingSettingId'],this[_0x58dcd4(0x152)]=_0x32278d[_0x58dcd4(0x152)],this[_0x58dcd4(0x18d)]=_0x32278d[_0x58dcd4(0x18d)],this[_0x58dcd4(0x138)]=_0x32278d[_0x58dcd4(0x138)];}async['initInstances'](){const _0x233ce8=a347_0x2cf249;this[_0x233ce8(0x139)]=await salesforce_1[_0x233ce8(0x14b)]['create'](new auth_manager_1['AuthManager'](this[_0x233ce8(0x163)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this[_0x233ce8(0x143)]=await salesforce_1['AxiosInstanceUtils'][_0x233ce8(0x148)](new auth_manager_1['AuthManager'](this[_0x233ce8(0x192)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async['initMetadataLogger'](){const _0x3be299=a347_0x2cf249;this['metadataLogger']=new metadata_logger_1[(_0x3be299(0x161))]({'apiVersion':this[_0x3be299(0x14c)],'instance':this[_0x3be299(0x139)],'targetOrgId':this['targetOrgId'],'trackingSettingId':this[_0x3be299(0x13a)],'startDate':this[_0x3be299(0x183)]}),this[_0x3be299(0x173)]=await this[_0x3be299(0x15b)][_0x3be299(0x17d)]();}['initLogger'](){const _0x15a490=a347_0x2cf249;this[_0x15a490(0x189)]=new logger_1[(_0x15a490(0x159))]({'systemLogger':systemLogger,'apiVersion':this[_0x15a490(0x14c)],'instance':this['flosumInstance'],'metadataLogId':this[_0x15a490(0x173)],'timeZone':this['timeZone']});}['getSourceMemberRetriever'](){const _0x1a81c9=a347_0x2cf249;return new source_member_retriever_1[(_0x1a81c9(0x166))]({'apiVersion':this[_0x1a81c9(0x14c)],'instance':this['targetInstance'],'logger':this[_0x1a81c9(0x189)],'lastRetrieveDate':this[_0x1a81c9(0x152)],'currentRetrieveDate':this['startDate'],'metadataTypes':this[_0x1a81c9(0x18d)]});}[a347_0x2cf249(0x17e)](){const _0x164108=a347_0x2cf249;return new source_member_handler_1[(_0x164108(0x154))]({'instance':this[_0x164108(0x139)],'apiVersion':this['apiVersion'],'logger':this['logger'],'targetOrgId':this[_0x164108(0x144)]});}[a347_0x2cf249(0x162)](){const _0x2e3e84=a347_0x2cf249;return new metadata_retriever_1[(_0x2e3e84(0x14e))]({'instance':this[_0x2e3e84(0x143)],'apiVersion':this[_0x2e3e84(0x14c)],'logger':this[_0x2e3e84(0x189)],'metadataTypes':this[_0x2e3e84(0x18d)]});}[a347_0x2cf249(0x146)](){const _0x12c07f=a347_0x2cf249;return new components_deployer_1['ComponentsDeployer']({'instance':this[_0x12c07f(0x139)],'logger':this[_0x12c07f(0x189)],'apiVersion':this[_0x12c07f(0x14c)],'targetOrgId':this['targetOrgId'],'trackingSettingId':this[_0x12c07f(0x13a)]});}[a347_0x2cf249(0x178)](){const _0x5db3ec=a347_0x2cf249;return{'attributes':{'type':constants_1['FLOSUM_NAMESPACE']+_0x5db3ec(0x14f)},'Id':this[_0x5db3ec(0x13a)],[constants_1[_0x5db3ec(0x14a)]+_0x5db3ec(0x155)]:![],[constants_1[_0x5db3ec(0x14a)]+_0x5db3ec(0x149)]:this[_0x5db3ec(0x183)]};}async[a347_0x2cf249(0x15f)](){const _0x1d0aa7=a347_0x2cf249,_0x2ff22f=this[_0x1d0aa7(0x178)](),_0x4ca3a6=new salesforce_1[(_0x1d0aa7(0x13c))]({'instance':this[_0x1d0aa7(0x139)],'objectName':constants_1[_0x1d0aa7(0x14a)]+'Tracking_Setting__c','api':this[_0x1d0aa7(0x14c)],'allOrNone':![],'externalIdField':'Id'}),_0x3547fa=await _0x4ca3a6[_0x1d0aa7(0x16c)]({'records':[_0x2ff22f]}),_0x41161e=_0x3547fa['at'](0x0);(_0x41161e===null||_0x41161e===void 0x0?void 0x0:_0x41161e[_0x1d0aa7(0x187)])?this[_0x1d0aa7(0x189)][_0x1d0aa7(0x18b)](_0x1d0aa7(0x15c)):this[_0x1d0aa7(0x189)][_0x1d0aa7(0x18b)]('Tracking\x20setting\x20not\x20updated\x20\x0a\x20'+(_0x41161e===null||_0x41161e===void 0x0?void 0x0:_0x41161e[_0x1d0aa7(0x141)]));}async['execute'](){const _0xa55b02=a347_0x2cf249;await this['initManifest'](),this['startDate']=new Date()[_0xa55b02(0x151)]();try{await this[_0xa55b02(0x164)](),await this[_0xa55b02(0x142)](),this[_0xa55b02(0x13e)](),this[_0xa55b02(0x189)][_0xa55b02(0x18b)](_0xa55b02(0x172)+this[_0xa55b02(0x135)]),this['metadataLogger'][_0xa55b02(0x137)]=constants_2[_0xa55b02(0x145)][_0xa55b02(0x15d)],await this[_0xa55b02(0x15b)][_0xa55b02(0x176)](),await this['logger'][_0xa55b02(0x176)]();const _0xd8446a=this['getSourceMemberRetriever'](),_0x50f29a=this[_0xa55b02(0x17e)](),_0x30f7fc=this[_0xa55b02(0x162)](),_0x3702df=this['getComponentsDeployer']();await(0x0,promises_1[_0xa55b02(0x186)])(_0xd8446a,_0x50f29a,_0x30f7fc,_0x3702df),this['logger'][_0xa55b02(0x18b)]('Tracking\x20components\x20job\x20has\x20been\x20completed'),this['metadataLogger'][_0xa55b02(0x137)]=constants_2[_0xa55b02(0x145)][_0xa55b02(0x188)];}catch(_0x53003c){this[_0xa55b02(0x189)][_0xa55b02(0x141)](_0xa55b02(0x18e)),this['logger'][_0xa55b02(0x141)](_0x53003c[_0xa55b02(0x13b)]),this[_0xa55b02(0x15b)][_0xa55b02(0x137)]=constants_2[_0xa55b02(0x145)][_0xa55b02(0x13f)];}finally{await this[_0xa55b02(0x15f)](),await this[_0xa55b02(0x189)][_0xa55b02(0x176)](),await this[_0xa55b02(0x15b)]['update']();}}}exports[a347_0x2cf249(0x17f)]=Job,new Job()[a347_0x2cf249(0x16c)]()[a347_0x2cf249(0x157)](()=>process[a347_0x2cf249(0x167)](0x0))['catch'](_0x3252f1=>{const _0x375d96=a347_0x2cf249;systemLogger['error'](_0x375d96(0x156)+_0x3252f1[_0x375d96(0x13b)]),process['exit'](0x1);});