const a348_0x131c5c=a348_0x2fe7;function a348_0x2fe7(_0x34dc3b,_0x101f85){const _0x1d4b12=a348_0x3152();return a348_0x2fe7=function(_0x4cd288,_0x365ec9){_0x4cd288=_0x4cd288-0x103;let _0x3152cc=_0x1d4b12[_0x4cd288];return _0x3152cc;},a348_0x2fe7(_0x34dc3b,_0x101f85);}(function(_0x3d20be,_0x3cc18d){const _0x2ed2aa=a348_0x2fe7,_0x4f303a=_0x3d20be();while(!![]){try{const _0x39f2cc=parseInt(_0x2ed2aa(0x147))/0x1+-parseInt(_0x2ed2aa(0x125))/0x2*(parseInt(_0x2ed2aa(0x12e))/0x3)+parseInt(_0x2ed2aa(0x105))/0x4+-parseInt(_0x2ed2aa(0x127))/0x5+parseInt(_0x2ed2aa(0x132))/0x6+-parseInt(_0x2ed2aa(0x140))/0x7+-parseInt(_0x2ed2aa(0x112))/0x8;if(_0x39f2cc===_0x3cc18d)break;else _0x4f303a['push'](_0x4f303a['shift']());}catch(_0x1603f7){_0x4f303a['push'](_0x4f303a['shift']());}}}(a348_0x3152,0x8e84e));const a348_0x365ec9=(function(){let _0x16542f=!![];return function(_0x119c76,_0x2bb6a2){const _0x296011=_0x16542f?function(){const _0x42e8ed=a348_0x2fe7;if(_0x2bb6a2){const _0x983578=_0x2bb6a2[_0x42e8ed(0x10a)](_0x119c76,arguments);return _0x2bb6a2=null,_0x983578;}}:function(){};return _0x16542f=![],_0x296011;};}()),a348_0x4cd288=a348_0x365ec9(this,function(){const _0x4aa4ff=a348_0x2fe7;return a348_0x4cd288[_0x4aa4ff(0x144)]()[_0x4aa4ff(0x146)](_0x4aa4ff(0x119))[_0x4aa4ff(0x144)]()['constructor'](a348_0x4cd288)[_0x4aa4ff(0x146)]('(((.+)+)+)+$');});a348_0x4cd288();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4f2d31){const _0x1211c7=a348_0x2fe7;return _0x4f2d31&&_0x4f2d31[_0x1211c7(0x138)]?_0x4f2d31:{'default':_0x4f2d31};};Object['defineProperty'](exports,a348_0x131c5c(0x138),{'value':!![]}),exports[a348_0x131c5c(0x158)]=void 0x0;const minimist_1=__importDefault(require(a348_0x131c5c(0x14f))),core_1=require(a348_0x131c5c(0x15a)),salesforce_1=require('@flosum/salesforce'),auth_manager_1=require('../../shared/managers/auth.manager'),logger_1=require(a348_0x131c5c(0x115)),promises_1=require(a348_0x131c5c(0x130)),promises_2=require(a348_0x131c5c(0x13f)),path_1=__importDefault(require(a348_0x131c5c(0x103))),metadata_retriever_1=require(a348_0x131c5c(0x10e)),components_deployer_1=require(a348_0x131c5c(0x156)),source_member_retriever_1=require(a348_0x131c5c(0x155)),source_member_handler_1=require(a348_0x131c5c(0x113)),metadata_logger_1=require('./classes/metadata-logger'),job_1=require('../../../constants/job'),constants_1=require(a348_0x131c5c(0x11b)),constants_2=require(a348_0x131c5c(0x117)),{jobId,jobStorePath}=(0x0,minimist_1[a348_0x131c5c(0x141)])(process[a348_0x131c5c(0x137)]['slice'](0x2)),systemLogger=new core_1['Logger'](jobId);function a348_0x3152(){const _0x11a157=['initLogger','success','startDate','RestSimpleDeployData','./classes/source-member.retriever','./classes/components.deployer','targetOrgCredentials','Job','LogStatus','../../../core','path','targetInstance','2906620xPBYGQ','IN_PROGRESS','error','metadataLogId','updateTrackingSetting','apply','Last_Start_Retrieval__c','create','SourceMemberRetriever','./classes/metadata.retriever','Tracking\x20components\x20job\x20has\x20been\x20completed','flosumInstance','getMetadataRetriever','6941936LQxZSu','./classes/source-member.handler','apiVersion','./classes/logger/logger','AxiosInstanceUtils','../constants','getSourceMemberHandler','(((.+)+)+)+$','trackingSettingId','../../../constants','pipeline','status','readFile','initManifest','Tracking_Setting__c','targetOrgId','Tracking\x20components\x20job\x20has\x20been\x20started\x20with\x20id:\x20','update','parse','472CGGuxu','lastRetrieveDate','2150530RqjYIe','utf-8','getComponentsDeployer','initMetadataLogger','Is_Processed__c','initInstances','jobStorePath','2844swSetg','flosumOrgCredentials','stream/promises','AuthManager','3855798DOOxtO','exit','Logger','jobId','execute','argv','__esModule','MANIFEST_FILENAME','EXCEPTION','MetadataRetriever','getTime','catch','timeZone','fs/promises','2531165TyEpFu','default','getSourceMemberRetriever','then','toString','createTrackingSettingRecord','search','1097641YoaMgF','FLOSUM_NAMESPACE','logger','join','MetadataLogger','init','metadataLogger','message','minimist','metadataTypes'];a348_0x3152=function(){return _0x11a157;};return a348_0x3152();}class Job{constructor(){const _0x168308=a348_0x131c5c;this[_0x168308(0x12d)]=jobStorePath,this['jobId']=jobId;}async['initManifest'](){const _0x5de7c7=a348_0x131c5c,_0x39685b=path_1['default'][_0x5de7c7(0x14a)](this['jobStorePath'],job_1[_0x5de7c7(0x139)]),_0x84e605=await(0x0,promises_2[_0x5de7c7(0x11e)])(_0x39685b,{'encoding':_0x5de7c7(0x128)})[_0x5de7c7(0x143)](JSON[_0x5de7c7(0x124)])['then'](({details:_0xb2a73e})=>_0xb2a73e);await(0x0,promises_2['rm'])(_0x39685b,{'recursive':!![],'force':!![]}),this[_0x5de7c7(0x114)]=_0x84e605[_0x5de7c7(0x114)],this[_0x5de7c7(0x12f)]=_0x84e605[_0x5de7c7(0x12f)],this[_0x5de7c7(0x157)]=_0x84e605[_0x5de7c7(0x157)],this[_0x5de7c7(0x121)]=_0x84e605[_0x5de7c7(0x121)],this[_0x5de7c7(0x11a)]=_0x84e605[_0x5de7c7(0x11a)],this[_0x5de7c7(0x126)]=_0x84e605[_0x5de7c7(0x126)],this[_0x5de7c7(0x150)]=_0x84e605[_0x5de7c7(0x150)],this[_0x5de7c7(0x13e)]=_0x84e605[_0x5de7c7(0x13e)];}async[a348_0x131c5c(0x12c)](){const _0x52b27d=a348_0x131c5c;this[_0x52b27d(0x110)]=await salesforce_1[_0x52b27d(0x116)]['create'](new auth_manager_1[(_0x52b27d(0x131))](this[_0x52b27d(0x12f)]),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity}),this[_0x52b27d(0x104)]=await salesforce_1['AxiosInstanceUtils'][_0x52b27d(0x10c)](new auth_manager_1[(_0x52b27d(0x131))](this['targetOrgCredentials']),[],{'maxContentLength':Infinity,'maxBodyLength':Infinity});}async[a348_0x131c5c(0x12a)](){const _0x39757a=a348_0x131c5c;this['metadataLogger']=new metadata_logger_1[(_0x39757a(0x14b))]({'apiVersion':this[_0x39757a(0x114)],'instance':this['flosumInstance'],'targetOrgId':this['targetOrgId'],'trackingSettingId':this[_0x39757a(0x11a)],'startDate':this['startDate']}),this[_0x39757a(0x108)]=await this[_0x39757a(0x14d)][_0x39757a(0x14c)]();}[a348_0x131c5c(0x151)](){const _0x586428=a348_0x131c5c;this[_0x586428(0x149)]=new logger_1[(_0x586428(0x134))]({'systemLogger':systemLogger,'apiVersion':this['apiVersion'],'instance':this[_0x586428(0x110)],'metadataLogId':this['metadataLogId'],'timeZone':this[_0x586428(0x13e)]});}[a348_0x131c5c(0x142)](){const _0x18ad69=a348_0x131c5c;return new source_member_retriever_1[(_0x18ad69(0x10d))]({'apiVersion':this[_0x18ad69(0x114)],'instance':this[_0x18ad69(0x104)],'logger':this['logger'],'lastRetrieveDate':this['lastRetrieveDate'],'currentRetrieveDate':this[_0x18ad69(0x153)],'metadataTypes':this[_0x18ad69(0x150)]});}[a348_0x131c5c(0x118)](){const _0x3c9b4d=a348_0x131c5c;return new source_member_handler_1['SourceMemberHandler']({'instance':this[_0x3c9b4d(0x110)],'apiVersion':this['apiVersion'],'logger':this[_0x3c9b4d(0x149)],'targetOrgId':this[_0x3c9b4d(0x121)]});}[a348_0x131c5c(0x111)](){const _0x41aa60=a348_0x131c5c;return new metadata_retriever_1[(_0x41aa60(0x13b))]({'instance':this[_0x41aa60(0x104)],'apiVersion':this['apiVersion'],'logger':this[_0x41aa60(0x149)],'metadataTypes':this[_0x41aa60(0x150)]});}['getComponentsDeployer'](){const _0x42b880=a348_0x131c5c;return new components_deployer_1['ComponentsDeployer']({'instance':this[_0x42b880(0x110)],'logger':this[_0x42b880(0x149)],'apiVersion':this[_0x42b880(0x114)],'targetOrgId':this[_0x42b880(0x121)],'trackingSettingId':this[_0x42b880(0x11a)]});}[a348_0x131c5c(0x145)](){const _0x5329c1=a348_0x131c5c;return{'attributes':{'type':constants_1[_0x5329c1(0x148)]+_0x5329c1(0x120)},'Id':this[_0x5329c1(0x11a)],[constants_1[_0x5329c1(0x148)]+_0x5329c1(0x12b)]:![],[constants_1[_0x5329c1(0x148)]+_0x5329c1(0x10b)]:this[_0x5329c1(0x153)]};}async[a348_0x131c5c(0x109)](){const _0x45f2c3=a348_0x131c5c,_0x464f37=this[_0x45f2c3(0x145)](),_0x303a75=new salesforce_1[(_0x45f2c3(0x154))]({'instance':this[_0x45f2c3(0x110)],'objectName':constants_1['FLOSUM_NAMESPACE']+_0x45f2c3(0x120),'api':this[_0x45f2c3(0x114)],'allOrNone':![],'externalIdField':'Id'}),_0x39997b=await _0x303a75[_0x45f2c3(0x136)]({'records':[_0x464f37]}),_0x3372a6=_0x39997b['at'](0x0);(_0x3372a6===null||_0x3372a6===void 0x0?void 0x0:_0x3372a6[_0x45f2c3(0x152)])?this[_0x45f2c3(0x149)]['log']('Tracking\x20setting\x20updated'):this[_0x45f2c3(0x149)]['log']('Tracking\x20setting\x20not\x20updated\x20\x0a\x20'+(_0x3372a6===null||_0x3372a6===void 0x0?void 0x0:_0x3372a6[_0x45f2c3(0x107)]));}async['execute'](){const _0x583b89=a348_0x131c5c;await this[_0x583b89(0x11f)](),this[_0x583b89(0x153)]=new Date()[_0x583b89(0x13c)]();try{await this[_0x583b89(0x12c)](),await this['initMetadataLogger'](),this[_0x583b89(0x151)](),this['logger']['log'](_0x583b89(0x122)+this[_0x583b89(0x135)]),this[_0x583b89(0x14d)]['status']=constants_2[_0x583b89(0x159)][_0x583b89(0x106)],await this[_0x583b89(0x14d)][_0x583b89(0x123)](),await this[_0x583b89(0x149)]['update']();const _0x11dc8e=this['getSourceMemberRetriever'](),_0x36782d=this['getSourceMemberHandler'](),_0x569f36=this['getMetadataRetriever'](),_0x116533=this[_0x583b89(0x129)]();await(0x0,promises_1[_0x583b89(0x11c)])(_0x11dc8e,_0x36782d,_0x569f36,_0x116533),this[_0x583b89(0x149)]['log'](_0x583b89(0x10f)),this[_0x583b89(0x14d)][_0x583b89(0x11d)]=constants_2[_0x583b89(0x159)]['COMPLETED'];}catch(_0x3bae4d){this[_0x583b89(0x149)][_0x583b89(0x107)]('Tracking\x20components\x20job\x20has\x20been\x20failed'),this[_0x583b89(0x149)][_0x583b89(0x107)](_0x3bae4d[_0x583b89(0x14e)]),this['metadataLogger'][_0x583b89(0x11d)]=constants_2['LogStatus'][_0x583b89(0x13a)];}finally{await this[_0x583b89(0x109)](),await this['logger'][_0x583b89(0x123)](),await this[_0x583b89(0x14d)][_0x583b89(0x123)]();}}}exports[a348_0x131c5c(0x158)]=Job,new Job()[a348_0x131c5c(0x136)]()['then'](()=>process['exit'](0x0))[a348_0x131c5c(0x13d)](_0x4cdb5f=>{const _0x592d4a=a348_0x131c5c;systemLogger['error']('Job\x20Error:\x20'+_0x4cdb5f[_0x592d4a(0x14e)]),process[_0x592d4a(0x133)](0x1);});