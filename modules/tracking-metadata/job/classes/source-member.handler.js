const a345_0x479e9a=a345_0x5466;function a345_0x5466(_0x23aa7d,_0x4482c4){const _0x4a78ba=a345_0x4c0b();return a345_0x5466=function(_0x112f2f,_0x2f70e6){_0x112f2f=_0x112f2f-0x1c9;let _0x4c0ba8=_0x4a78ba[_0x112f2f];return _0x4c0ba8;},a345_0x5466(_0x23aa7d,_0x4482c4);}(function(_0x3e9bee,_0x46eeb1){const _0x2a43d9=a345_0x5466,_0x9bad99=_0x3e9bee();while(!![]){try{const _0x22c41b=parseInt(_0x2a43d9(0x1e1))/0x1+-parseInt(_0x2a43d9(0x1e3))/0x2+-parseInt(_0x2a43d9(0x1f3))/0x3*(parseInt(_0x2a43d9(0x1fd))/0x4)+parseInt(_0x2a43d9(0x1e0))/0x5*(parseInt(_0x2a43d9(0x1f5))/0x6)+-parseInt(_0x2a43d9(0x1df))/0x7*(parseInt(_0x2a43d9(0x1e6))/0x8)+parseInt(_0x2a43d9(0x1f2))/0x9+-parseInt(_0x2a43d9(0x1e5))/0xa*(-parseInt(_0x2a43d9(0x1dc))/0xb);if(_0x22c41b===_0x46eeb1)break;else _0x9bad99['push'](_0x9bad99['shift']());}catch(_0x3c2a1c){_0x9bad99['push'](_0x9bad99['shift']());}}}(a345_0x4c0b,0xef81b));const a345_0x2f70e6=(function(){let _0xb11aa5=!![];return function(_0x1109e0,_0x247c31){const _0x39603e=_0xb11aa5?function(){if(_0x247c31){const _0x11f3ac=_0x247c31['apply'](_0x1109e0,arguments);return _0x247c31=null,_0x11f3ac;}}:function(){};return _0xb11aa5=![],_0x39603e;};}()),a345_0x112f2f=a345_0x2f70e6(this,function(){const _0x32674a=a345_0x5466;return a345_0x112f2f['toString']()['search'](_0x32674a(0x201))['toString']()[_0x32674a(0x200)](a345_0x112f2f)['search'](_0x32674a(0x201));});a345_0x112f2f();'use strict';Object['defineProperty'](exports,a345_0x479e9a(0x1e4),{'value':!![]}),exports['SourceMemberHandler']=void 0x0;const stream_1=require('stream'),salesforce_1=require(a345_0x479e9a(0x1db)),constants_1=require(a345_0x479e9a(0x1ee)),constants_2=require(a345_0x479e9a(0x1cb)),MAX_CHUNK_SIZE=0xfa0,REVISION_COUNTER_FIELD_NAME='RevisionCounter',IS_NAME_OBSOLETE=a345_0x479e9a(0x1c9),MEMBER_ID_FIELD_NAME=a345_0x479e9a(0x1ff),MEMBER_TYPE_FIELD_NAME=a345_0x479e9a(0x1f1),MEMBER_NAME=a345_0x479e9a(0x1fb),CHANGED_BY_FIELD_NAME=a345_0x479e9a(0x1cf),SOURCE_MEMBER_ID_FIELD_NAME=constants_2[a345_0x479e9a(0x1d7)]+a345_0x479e9a(0x1ec),ORGANIZATION_NAME_FIELD=constants_2[a345_0x479e9a(0x1d7)]+a345_0x479e9a(0x1d4),REVISION_COUNTER_CUSTOM_FIELD_NAME=constants_2[a345_0x479e9a(0x1d7)]+a345_0x479e9a(0x1cd),ORG_COMPONENT_SELECT_FIELDS=['Id',constants_2[a345_0x479e9a(0x1d7)]+a345_0x479e9a(0x1cd),constants_2[a345_0x479e9a(0x1d7)]+a345_0x479e9a(0x1e7),constants_2[a345_0x479e9a(0x1d7)]+a345_0x479e9a(0x1ca),constants_2['FLOSUM_NAMESPACE']+'Name__c',constants_2[a345_0x479e9a(0x1d7)]+'Source_Member_Id__c',constants_2[a345_0x479e9a(0x1d7)]+'OrganisationName__c',constants_2[a345_0x479e9a(0x1d7)]+a345_0x479e9a(0x1d0),constants_2['FLOSUM_NAMESPACE']+a345_0x479e9a(0x1dd)];class SourceMemberHandler extends stream_1[a345_0x479e9a(0x1d5)]{constructor({apiVersion:_0x24ba7a,instance:_0x3d1adf,targetOrgId:_0x49a1dd,logger:_0x5575e3}){const _0x51103a=a345_0x479e9a;super({'objectMode':!![]}),this[_0x51103a(0x1ea)]=new Map(),this['handledMembersCounter']=0x0,this[_0x51103a(0x1ef)]=_0x24ba7a,this['instance']=_0x3d1adf,this[_0x51103a(0x1f4)]=_0x49a1dd,this[_0x51103a(0x1ed)]=_0x5575e3;}[a345_0x479e9a(0x1d8)](){const _0x4f685d=a345_0x479e9a;return new salesforce_1['QueryBuilder']()[_0x4f685d(0x1f0)](...ORG_COMPONENT_SELECT_FIELDS)[_0x4f685d(0x1d2)](constants_1[_0x4f685d(0x1de)])[_0x4f685d(0x1e8)](SOURCE_MEMBER_ID_FIELD_NAME+'\x20IN\x20(:sourceMemberIds)',{'sourceMemberIds':[...this[_0x4f685d(0x1ea)]['keys']()]})['andWhere'](ORGANIZATION_NAME_FIELD+_0x4f685d(0x1fc),{'targetOrgId':this['targetOrgId']});}async['getComponentFromFlosum'](){const _0x146bf8=a345_0x479e9a,_0x31f7e5=new salesforce_1[(_0x146bf8(0x1d1))]({'api':this[_0x146bf8(0x1ef)],'queryBuilder':this[_0x146bf8(0x1d8)](),'instance':this['instance'],'isTooling':![]}),_0xb354d2=new Map();do{const {records:_0x2fd8a1}=await _0x31f7e5[_0x146bf8(0x1eb)]();for(const _0x255a86 of _0x2fd8a1){_0xb354d2[_0x146bf8(0x1ce)](_0x255a86[SOURCE_MEMBER_ID_FIELD_NAME],_0x255a86);}}while(!_0x31f7e5[_0x146bf8(0x1fe)]());return _0xb354d2;}async[a345_0x479e9a(0x1d6)](_0x4c4018){const _0x160c6e=a345_0x479e9a;this['sourceMemberRecords']['set'](_0x4c4018['Id'],_0x4c4018),this['sourceMemberRecords']['size']===MAX_CHUNK_SIZE&&await this[_0x160c6e(0x1d9)]();}async[a345_0x479e9a(0x1d9)](){const _0x4488ac=a345_0x479e9a,_0x3d9655=await this[_0x4488ac(0x1e2)]();for(const [_0x1fcc85,_0x3ba0cc]of this[_0x4488ac(0x1ea)]){const _0x3ae258=_0x3d9655[_0x4488ac(0x1da)](_0x1fcc85);if(_0x3ae258&&_0x3ba0cc[REVISION_COUNTER_FIELD_NAME]===_0x3ae258[REVISION_COUNTER_CUSTOM_FIELD_NAME])continue;const _0x48a5c0={'sourceMemberId':_0x3ba0cc['Id'],'componentId':(_0x3ae258===null||_0x3ae258===void 0x0?void 0x0:_0x3ae258['Id'])||null,'attachmentId':(_0x3ae258===null||_0x3ae258===void 0x0?void 0x0:_0x3ae258[_0x4488ac(0x1d0)])||null,'metadataId':_0x3ba0cc[MEMBER_ID_FIELD_NAME],'metadataType':_0x3ba0cc[MEMBER_TYPE_FIELD_NAME],'metadataName':_0x3ba0cc[MEMBER_NAME],'isNameObsolete':_0x3ba0cc[IS_NAME_OBSOLETE],'revisionCounter':_0x3ba0cc[REVISION_COUNTER_FIELD_NAME],'changedBy':_0x3ba0cc[CHANGED_BY_FIELD_NAME]};this[_0x4488ac(0x1f9)]++,this[_0x4488ac(0x1f8)](_0x48a5c0);}this[_0x4488ac(0x1ea)]=new Map();}async[a345_0x479e9a(0x1d3)](_0xbeeb2f,_0x5165e7,_0x581815){const _0x541e45=a345_0x479e9a;try{await this[_0x541e45(0x1d6)](_0xbeeb2f),_0x581815();}catch(_0x41b8e0){_0x581815(_0x41b8e0);}}async[a345_0x479e9a(0x1f7)](_0x37f73f){const _0x296be8=a345_0x479e9a;try{this['sourceMemberRecords'][_0x296be8(0x1fa)]&&await this[_0x296be8(0x1d9)](),this[_0x296be8(0x1ed)][_0x296be8(0x1e9)]('Changes\x20found\x20for\x20'+this[_0x296be8(0x1f9)]+_0x296be8(0x1cc)),await this['logger'][_0x296be8(0x1f6)](),_0x37f73f();}catch(_0x5d2604){_0x37f73f(_0x5d2604);}}}function a345_0x4c0b(){const _0x4b76ef=['select','MemberType','11787507qOrafZ','4710000KEPUrn','targetOrgId','102lMxweN','update','_flush','push','handledMembersCounter','size','MemberName','\x20=\x20:targetOrgId','4KBELfP','getIsDone','MemberIdOrName','constructor','(((.+)+)+)+$','IsNameObsolete','API_Name__c','../../../../constants','\x20components','Revision_Counter__c','set','ChangedBy','Attachment_ID__c','CompositeRetrieveData','from','_transform','OrganisationName__c','Transform','addToChunk','FLOSUM_NAMESPACE','buildOrgComponentQuery','handle','get','@flosum/salesforce','2519HFCgVg','Folder__c','ORG_COMPONENT_OBJECT_NAME','7XGMycU','90175zzEZUR','299328buHDOz','getComponentFromFlosum','3843812MDhfwP','__esModule','161660JUcHpc','9157880JzALtq','Component_Type__c','where','log','sourceMemberRecords','execute','Source_Member_Id__c','logger','../../constants','api'];a345_0x4c0b=function(){return _0x4b76ef;};return a345_0x4c0b();}exports['SourceMemberHandler']=SourceMemberHandler;