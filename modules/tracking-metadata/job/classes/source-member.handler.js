const a332_0x4729f3=a332_0x1965;(function(_0xd0edec,_0x59a543){const _0xdba990=a332_0x1965,_0x5d9d9f=_0xd0edec();while(!![]){try{const _0xf05506=-parseInt(_0xdba990(0xd9))/0x1*(parseInt(_0xdba990(0xe5))/0x2)+-parseInt(_0xdba990(0xdb))/0x3*(parseInt(_0xdba990(0xd8))/0x4)+parseInt(_0xdba990(0xd6))/0x5+-parseInt(_0xdba990(0xf2))/0x6+parseInt(_0xdba990(0xe6))/0x7*(parseInt(_0xdba990(0xe0))/0x8)+-parseInt(_0xdba990(0xe9))/0x9+parseInt(_0xdba990(0xd5))/0xa;if(_0xf05506===_0x59a543)break;else _0x5d9d9f['push'](_0x5d9d9f['shift']());}catch(_0x1a4739){_0x5d9d9f['push'](_0x5d9d9f['shift']());}}}(a332_0x119f,0xe68d6));const a332_0x47fbe9=(function(){let _0x34fe7c=!![];return function(_0x168b02,_0x2b4eb5){const _0x35c32e=_0x34fe7c?function(){const _0x30a267=a332_0x1965;if(_0x2b4eb5){const _0x22cd21=_0x2b4eb5[_0x30a267(0xfd)](_0x168b02,arguments);return _0x2b4eb5=null,_0x22cd21;}}:function(){};return _0x34fe7c=![],_0x35c32e;};}()),a332_0x14fb07=a332_0x47fbe9(this,function(){const _0x248227=a332_0x1965;return a332_0x14fb07['toString']()[_0x248227(0xd7)](_0x248227(0xca))[_0x248227(0xf8)]()[_0x248227(0xd0)](a332_0x14fb07)[_0x248227(0xd7)](_0x248227(0xca));});a332_0x14fb07();'use strict';Object[a332_0x4729f3(0xda)](exports,a332_0x4729f3(0xd2),{'value':!![]}),exports['SourceMemberHandler']=void 0x0;const stream_1=require(a332_0x4729f3(0xef)),salesforce_1=require('@flosum/salesforce'),constants_1=require('../../constants'),constants_2=require('../../../../constants'),MAX_CHUNK_SIZE=0xfa0,REVISION_COUNTER_FIELD_NAME='RevisionCounter',IS_NAME_OBSOLETE=a332_0x4729f3(0xfa),MEMBER_ID_FIELD_NAME=a332_0x4729f3(0xf6),MEMBER_TYPE_FIELD_NAME=a332_0x4729f3(0xf3),CHANGED_BY_FIELD_NAME=a332_0x4729f3(0xcb),SOURCE_MEMBER_ID_FIELD_NAME=constants_2[a332_0x4729f3(0xcd)]+a332_0x4729f3(0xed),ORGANIZATION_NAME_FIELD=constants_2[a332_0x4729f3(0xcd)]+a332_0x4729f3(0xcc),REVISION_COUNTER_CUSTOM_FIELD_NAME=constants_2['FLOSUM_NAMESPACE']+a332_0x4729f3(0x102),ORG_COMPONENT_SELECT_FIELDS=['Id',constants_2[a332_0x4729f3(0xcd)]+a332_0x4729f3(0x102),constants_2['FLOSUM_NAMESPACE']+a332_0x4729f3(0xff),constants_2[a332_0x4729f3(0xcd)]+a332_0x4729f3(0xe3),constants_2[a332_0x4729f3(0xcd)]+a332_0x4729f3(0xcf),constants_2[a332_0x4729f3(0xcd)]+a332_0x4729f3(0xed),constants_2[a332_0x4729f3(0xcd)]+a332_0x4729f3(0xcc),constants_2[a332_0x4729f3(0xcd)]+a332_0x4729f3(0xf7),constants_2[a332_0x4729f3(0xcd)]+a332_0x4729f3(0xdd)];function a332_0x119f(){const _0x82ad16=['set','502410aQdDgR','5278iFBydF','update','execute','8193168lHsTqL','logger','handledMembersCounter','QueryBuilder','Source_Member_Id__c','getComponentFromFlosum','stream','where','sourceMemberRecords','10954308EhiXbq','MemberType','_transform','targetOrgId','MemberIdOrName','Attachment_ID__c','toString','CompositeRetrieveData','IsNameObsolete','get','instance','apply','Changes\x20found\x20for\x20','Component_Type__c','_flush','\x20=\x20:targetOrgId','Revision_Counter__c','buildOrgComponentQuery','(((.+)+)+)+$','ChangedBy','OrganisationName__c','FLOSUM_NAMESPACE','\x20IN\x20(:sourceMemberIds)','Name__c','constructor','keys','__esModule','from','addToChunk','43561340NGwmtN','916550teHviZ','search','212KidezD','3rWUyKq','defineProperty','64779XhPqnG','getIsDone','Folder__c','select','ORG_COMPONENT_OBJECT_NAME','11024wonLAJ','handle','\x20components','API_Name__c'];a332_0x119f=function(){return _0x82ad16;};return a332_0x119f();}class SourceMemberHandler extends stream_1['Transform']{constructor({apiVersion:_0x1e94c7,instance:_0x423659,targetOrgId:_0x26f7d5,logger:_0x1147ce}){const _0x4715c5=a332_0x4729f3;super({'objectMode':!![]}),this[_0x4715c5(0xf1)]=new Map(),this['handledMembersCounter']=0x0,this['api']=_0x1e94c7,this[_0x4715c5(0xfc)]=_0x423659,this[_0x4715c5(0xf5)]=_0x26f7d5,this[_0x4715c5(0xea)]=_0x1147ce;}['buildOrgComponentQuery'](){const _0x452dfc=a332_0x4729f3;return new salesforce_1[(_0x452dfc(0xec))]()[_0x452dfc(0xde)](...ORG_COMPONENT_SELECT_FIELDS)[_0x452dfc(0xd3)](constants_1[_0x452dfc(0xdf)])[_0x452dfc(0xf0)](SOURCE_MEMBER_ID_FIELD_NAME+_0x452dfc(0xce),{'sourceMemberIds':[...this['sourceMemberRecords'][_0x452dfc(0xd1)]()]})['andWhere'](ORGANIZATION_NAME_FIELD+_0x452dfc(0x101),{'targetOrgId':this['targetOrgId']});}async[a332_0x4729f3(0xee)](){const _0x13159a=a332_0x4729f3,_0x264905=new salesforce_1[(_0x13159a(0xf9))]({'api':this['api'],'queryBuilder':this[_0x13159a(0x103)](),'instance':this[_0x13159a(0xfc)],'isTooling':![]}),_0x2f7804=new Map();do{const {records:_0x311a0e}=await _0x264905[_0x13159a(0xe8)]();for(const _0xf490e5 of _0x311a0e){_0x2f7804['set'](_0xf490e5[SOURCE_MEMBER_ID_FIELD_NAME],_0xf490e5);}}while(!_0x264905[_0x13159a(0xdc)]());return _0x2f7804;}async[a332_0x4729f3(0xd4)](_0x241a21){const _0x480d18=a332_0x4729f3;this[_0x480d18(0xf1)][_0x480d18(0xe4)](_0x241a21['Id'],_0x241a21),this[_0x480d18(0xf1)]['size']===MAX_CHUNK_SIZE&&await this[_0x480d18(0xe1)]();}async[a332_0x4729f3(0xe1)](){const _0x570bf4=a332_0x4729f3,_0x4a5bbf=await this['getComponentFromFlosum']();for(const [_0x5736e0,_0x4793ea]of this[_0x570bf4(0xf1)]){const _0x4c6bd2=_0x4a5bbf[_0x570bf4(0xfb)](_0x5736e0);if(_0x4c6bd2&&_0x4793ea[REVISION_COUNTER_FIELD_NAME]===_0x4c6bd2[REVISION_COUNTER_CUSTOM_FIELD_NAME])continue;const _0x532d5e={'sourceMemberId':_0x4793ea['Id'],'componentId':(_0x4c6bd2===null||_0x4c6bd2===void 0x0?void 0x0:_0x4c6bd2['Id'])||null,'attachmentId':(_0x4c6bd2===null||_0x4c6bd2===void 0x0?void 0x0:_0x4c6bd2[_0x570bf4(0xf7)])||null,'metadataId':_0x4793ea[MEMBER_ID_FIELD_NAME],'metadataType':_0x4793ea[MEMBER_TYPE_FIELD_NAME],'isNameObsolete':_0x4793ea[IS_NAME_OBSOLETE],'revisionCounter':_0x4793ea[REVISION_COUNTER_FIELD_NAME],'changedBy':_0x4793ea[CHANGED_BY_FIELD_NAME]};this['handledMembersCounter']++,this['push'](_0x532d5e);}this[_0x570bf4(0xf1)]=new Map();}async[a332_0x4729f3(0xf4)](_0x184445,_0x4fb1ba,_0x59d390){const _0x506f03=a332_0x4729f3;try{await this[_0x506f03(0xd4)](_0x184445),_0x59d390();}catch(_0x5a2263){_0x59d390(_0x5a2263);}}async[a332_0x4729f3(0x100)](_0x13408d){const _0x2ab098=a332_0x4729f3;try{this['sourceMemberRecords']['size']&&await this['handle'](),this['logger']['log'](_0x2ab098(0xfe)+this[_0x2ab098(0xeb)]+_0x2ab098(0xe2)),await this['logger'][_0x2ab098(0xe7)](),_0x13408d();}catch(_0x50b4ee){_0x13408d(_0x50b4ee);}}}function a332_0x1965(_0x332d7c,_0xe7ffd0){const _0x2313e3=a332_0x119f();return a332_0x1965=function(_0x14fb07,_0x47fbe9){_0x14fb07=_0x14fb07-0xca;let _0x119f33=_0x2313e3[_0x14fb07];return _0x119f33;},a332_0x1965(_0x332d7c,_0xe7ffd0);}exports['SourceMemberHandler']=SourceMemberHandler;