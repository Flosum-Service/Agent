const a300_0x2ad551=a300_0x3622;function a300_0x3622(_0x443bad,_0x558abd){const _0x1d83eb=a300_0xe159();return a300_0x3622=function(_0xbbf78f,_0x11de21){_0xbbf78f=_0xbbf78f-0x1e7;let _0xe159a6=_0x1d83eb[_0xbbf78f];return _0xe159a6;},a300_0x3622(_0x443bad,_0x558abd);}(function(_0x3b8c6b,_0x28f94c){const _0x15dcd6=a300_0x3622,_0xcb1923=_0x3b8c6b();while(!![]){try{const _0x55ac38=-parseInt(_0x15dcd6(0x1ec))/0x1+parseInt(_0x15dcd6(0x1f9))/0x2*(parseInt(_0x15dcd6(0x20e))/0x3)+parseInt(_0x15dcd6(0x1f1))/0x4+-parseInt(_0x15dcd6(0x1eb))/0x5*(parseInt(_0x15dcd6(0x21c))/0x6)+-parseInt(_0x15dcd6(0x1ee))/0x7+parseInt(_0x15dcd6(0x20a))/0x8+parseInt(_0x15dcd6(0x202))/0x9*(parseInt(_0x15dcd6(0x1f4))/0xa);if(_0x55ac38===_0x28f94c)break;else _0xcb1923['push'](_0xcb1923['shift']());}catch(_0xeea2dc){_0xcb1923['push'](_0xcb1923['shift']());}}}(a300_0xe159,0xc24ab));const a300_0x11de21=(function(){let _0x14db43=!![];return function(_0x10447a,_0x503f90){const _0x4f86bc=_0x14db43?function(){if(_0x503f90){const _0x376f2f=_0x503f90['apply'](_0x10447a,arguments);return _0x503f90=null,_0x376f2f;}}:function(){};return _0x14db43=![],_0x4f86bc;};}()),a300_0xbbf78f=a300_0x11de21(this,function(){const _0xbf392c=a300_0x3622;return a300_0xbbf78f[_0xbf392c(0x1fe)]()[_0xbf392c(0x1f7)](_0xbf392c(0x209))[_0xbf392c(0x1fe)]()[_0xbf392c(0x217)](a300_0xbbf78f)[_0xbf392c(0x1f7)](_0xbf392c(0x209));});a300_0xbbf78f();'use strict';Object[a300_0x2ad551(0x1ed)](exports,a300_0x2ad551(0x20f),{'value':!![]}),exports[a300_0x2ad551(0x208)]=void 0x0;const stream_1=require(a300_0x2ad551(0x207)),salesforce_1=require('@flosum/salesforce'),constants_1=require('../../constants'),constants_2=require('../../../../constants'),MAX_CHUNK_SIZE=0xfa0,REVISION_COUNTER_FIELD_NAME=a300_0x2ad551(0x203),IS_NAME_OBSOLETE=a300_0x2ad551(0x20b),MEMBER_ID_FIELD_NAME=a300_0x2ad551(0x1ea),MEMBER_TYPE_FIELD_NAME='MemberType',CHANGED_BY_FIELD_NAME=a300_0x2ad551(0x212),SOURCE_MEMBER_ID_FIELD_NAME=constants_2[a300_0x2ad551(0x1e8)]+'Source_Member_Id__c',ORGANIZATION_NAME_FIELD=constants_2['FLOSUM_NAMESPACE']+'OrganisationName__c',REVISION_COUNTER_CUSTOM_FIELD_NAME=constants_2['FLOSUM_NAMESPACE']+'Revision_Counter__c',ORG_COMPONENT_SELECT_FIELDS=['Id',constants_2[a300_0x2ad551(0x1e8)]+'Revision_Counter__c',constants_2[a300_0x2ad551(0x1e8)]+a300_0x2ad551(0x210),constants_2[a300_0x2ad551(0x1e8)]+a300_0x2ad551(0x1ef),constants_2[a300_0x2ad551(0x1e8)]+a300_0x2ad551(0x216),constants_2[a300_0x2ad551(0x1e8)]+a300_0x2ad551(0x219),constants_2[a300_0x2ad551(0x1e8)]+'OrganisationName__c',constants_2['FLOSUM_NAMESPACE']+'Attachment_ID__c',constants_2[a300_0x2ad551(0x1e8)]+a300_0x2ad551(0x1e9)];class SourceMemberHandler extends stream_1[a300_0x2ad551(0x21a)]{constructor({apiVersion:_0x4574b3,instance:_0x41a4a6,targetOrgId:_0x740e4,logger:_0x5aaf51}){const _0x24850d=a300_0x2ad551;super({'objectMode':!![]}),this['sourceMemberRecords']=new Map(),this[_0x24850d(0x1fa)]=0x0,this[_0x24850d(0x1f2)]=_0x4574b3,this['instance']=_0x41a4a6,this['targetOrgId']=_0x740e4,this['logger']=_0x5aaf51;}[a300_0x2ad551(0x1f5)](){const _0x29a66d=a300_0x2ad551;return new salesforce_1[(_0x29a66d(0x204))]()[_0x29a66d(0x214)](...ORG_COMPONENT_SELECT_FIELDS)[_0x29a66d(0x205)](constants_1[_0x29a66d(0x1ff)])[_0x29a66d(0x200)](SOURCE_MEMBER_ID_FIELD_NAME+_0x29a66d(0x1f8),{'sourceMemberIds':[...this['sourceMemberRecords'][_0x29a66d(0x1f0)]()]})['andWhere'](ORGANIZATION_NAME_FIELD+_0x29a66d(0x218),{'targetOrgId':this['targetOrgId']});}async[a300_0x2ad551(0x1fc)](){const _0xb9c00b=a300_0x2ad551,_0x58551b=new salesforce_1['CompositeRetrieveData']({'api':this[_0xb9c00b(0x1f2)],'queryBuilder':this[_0xb9c00b(0x1f5)](),'instance':this[_0xb9c00b(0x211)],'isTooling':![]}),_0xe4950b=new Map();do{const {records:_0x26eff8}=await _0x58551b[_0xb9c00b(0x20d)]();for(const _0x3e6f06 of _0x26eff8){_0xe4950b[_0xb9c00b(0x213)](_0x3e6f06[SOURCE_MEMBER_ID_FIELD_NAME],_0x3e6f06);}}while(!_0x58551b['getIsDone']());return _0xe4950b;}async['addToChunk'](_0x2d0fc4){const _0xd98394=a300_0x2ad551;this[_0xd98394(0x21d)][_0xd98394(0x213)](_0x2d0fc4['Id'],_0x2d0fc4),this[_0xd98394(0x21d)][_0xd98394(0x206)]===MAX_CHUNK_SIZE&&await this['handle']();}async['handle'](){const _0x1f0ba3=a300_0x2ad551,_0x4a7585=await this['getComponentFromFlosum']();for(const [_0x3e835f,_0x18252a]of this[_0x1f0ba3(0x21d)]){const _0x5eb9e6=_0x4a7585['get'](_0x3e835f);if(_0x5eb9e6&&_0x18252a[REVISION_COUNTER_FIELD_NAME]===_0x5eb9e6[REVISION_COUNTER_CUSTOM_FIELD_NAME])continue;const _0x17a6d3={'sourceMemberId':_0x18252a['Id'],'componentId':(_0x5eb9e6===null||_0x5eb9e6===void 0x0?void 0x0:_0x5eb9e6['Id'])||null,'attachmentId':(_0x5eb9e6===null||_0x5eb9e6===void 0x0?void 0x0:_0x5eb9e6[_0x1f0ba3(0x1e7)])||null,'metadataId':_0x18252a[MEMBER_ID_FIELD_NAME],'metadataType':_0x18252a[MEMBER_TYPE_FIELD_NAME],'isNameObsolete':_0x18252a[IS_NAME_OBSOLETE],'revisionCounter':_0x18252a[REVISION_COUNTER_FIELD_NAME],'changedBy':_0x18252a[CHANGED_BY_FIELD_NAME]};this['handledMembersCounter']++,this['push'](_0x17a6d3);}this[_0x1f0ba3(0x21d)]=new Map();}async[a300_0x2ad551(0x20c)](_0x4fed40,_0xabe2c2,_0x1d2d8f){const _0x6e768e=a300_0x2ad551;try{await this[_0x6e768e(0x21b)](_0x4fed40),_0x1d2d8f();}catch(_0x34210b){_0x1d2d8f(_0x34210b);}}async[a300_0x2ad551(0x1fd)](_0x16fc70){const _0x44e2ea=a300_0x2ad551;try{this['sourceMemberRecords']['size']&&await this[_0x44e2ea(0x1f6)](),this[_0x44e2ea(0x215)][_0x44e2ea(0x1fb)]('Changes\x20found\x20for\x20'+this[_0x44e2ea(0x1fa)]+_0x44e2ea(0x1f3)),await this[_0x44e2ea(0x215)][_0x44e2ea(0x201)](),_0x16fc70();}catch(_0x5b9ad1){_0x16fc70(_0x5b9ad1);}}}function a300_0xe159(){const _0x16df8b=['ORG_COMPONENT_OBJECT_NAME','where','update','1238022rdMOiE','RevisionCounter','QueryBuilder','from','size','stream','SourceMemberHandler','(((.+)+)+)+$','11350288LyDxsx','IsNameObsolete','_transform','execute','76683zgDRcU','__esModule','Component_Type__c','instance','ChangedBy','set','select','logger','Name__c','constructor','\x20=\x20:targetOrgId','Source_Member_Id__c','Transform','addToChunk','5621622uQkWRO','sourceMemberRecords','Attachment_ID__c','FLOSUM_NAMESPACE','Folder__c','MemberIdOrName','5RocLTA','1245514WOrHew','defineProperty','4072271PVDZMk','API_Name__c','keys','6261776EThkfs','api','\x20components','40muQrtW','buildOrgComponentQuery','handle','search','\x20IN\x20(:sourceMemberIds)','2gNFFmX','handledMembersCounter','log','getComponentFromFlosum','_flush','toString'];a300_0xe159=function(){return _0x16df8b;};return a300_0xe159();}exports[a300_0x2ad551(0x208)]=SourceMemberHandler;