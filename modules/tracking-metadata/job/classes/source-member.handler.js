const a331_0x2ab49e=a331_0x3d6b;(function(_0x3b68f0,_0x58315f){const _0x211f48=a331_0x3d6b,_0x4cd28f=_0x3b68f0();while(!![]){try{const _0x14857c=parseInt(_0x211f48(0x1ca))/0x1*(parseInt(_0x211f48(0x1b3))/0x2)+-parseInt(_0x211f48(0x1d7))/0x3*(parseInt(_0x211f48(0x1d5))/0x4)+-parseInt(_0x211f48(0x1ce))/0x5*(parseInt(_0x211f48(0x1d8))/0x6)+-parseInt(_0x211f48(0x1d1))/0x7*(-parseInt(_0x211f48(0x1b1))/0x8)+-parseInt(_0x211f48(0x1d3))/0x9+parseInt(_0x211f48(0x1ba))/0xa*(parseInt(_0x211f48(0x1cc))/0xb)+-parseInt(_0x211f48(0x1b5))/0xc*(parseInt(_0x211f48(0x1c2))/0xd);if(_0x14857c===_0x58315f)break;else _0x4cd28f['push'](_0x4cd28f['shift']());}catch(_0x593288){_0x4cd28f['push'](_0x4cd28f['shift']());}}}(a331_0x3184,0x9cb89));function a331_0x3184(){const _0xd917a3=['_flush','OrganisationName__c','update','QueryBuilder','ORG_COMPONENT_OBJECT_NAME','Attachment_ID__c','buildOrgComponentQuery','CompositeRetrieveData','targetOrgId','MemberIdOrName','\x20components','Source_Member_Id__c','40xkzBEb','\x20=\x20:targetOrgId','599686SAfOEa','set','8628aGlYXs','Component_Type__c','instance','\x20IN\x20(:sourceMemberIds)','SourceMemberHandler','18570PXmDAh','Revision_Counter__c','getComponentFromFlosum','addToChunk','(((.+)+)+)+$','IsNameObsolete','getIsDone','push','7501cOgsES','stream','constructor','Transform','RevisionCounter','FLOSUM_NAMESPACE','andWhere','Name__c','1EcolfT','sourceMemberRecords','7183MRpZDL','from','25cXcZVJ','API_Name__c','api','740299xgxIrZ','ChangedBy','4643109qZQHRM','MemberType','904oOUSNS','logger','1023rWLZUq','469788atzNWO','_transform','../../../../constants','size','select','where','keys','apply','handledMembersCounter','get','search'];a331_0x3184=function(){return _0xd917a3;};return a331_0x3184();}const a331_0xf63480=(function(){let _0x42c655=!![];return function(_0x364d68,_0xc2a204){const _0xb7e988=_0x42c655?function(){const _0x1e05a4=a331_0x3d6b;if(_0xc2a204){const _0x53b2e2=_0xc2a204[_0x1e05a4(0x1df)](_0x364d68,arguments);return _0xc2a204=null,_0x53b2e2;}}:function(){};return _0x42c655=![],_0xb7e988;};}()),a331_0x5f11b3=a331_0xf63480(this,function(){const _0x31fc00=a331_0x3d6b;return a331_0x5f11b3['toString']()[_0x31fc00(0x1e2)](_0x31fc00(0x1be))['toString']()[_0x31fc00(0x1c4)](a331_0x5f11b3)[_0x31fc00(0x1e2)](_0x31fc00(0x1be));});a331_0x5f11b3();'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a331_0x2ab49e(0x1b9)]=void 0x0;const stream_1=require(a331_0x2ab49e(0x1c3)),salesforce_1=require('@flosum/salesforce'),constants_1=require('../../constants'),constants_2=require(a331_0x2ab49e(0x1da)),MAX_CHUNK_SIZE=0xfa0,REVISION_COUNTER_FIELD_NAME=a331_0x2ab49e(0x1c6),IS_NAME_OBSOLETE=a331_0x2ab49e(0x1bf),MEMBER_ID_FIELD_NAME=a331_0x2ab49e(0x1ae),MEMBER_TYPE_FIELD_NAME=a331_0x2ab49e(0x1d4),CHANGED_BY_FIELD_NAME=a331_0x2ab49e(0x1d2),SOURCE_MEMBER_ID_FIELD_NAME=constants_2[a331_0x2ab49e(0x1c7)]+a331_0x2ab49e(0x1b0),ORGANIZATION_NAME_FIELD=constants_2[a331_0x2ab49e(0x1c7)]+a331_0x2ab49e(0x1e4),REVISION_COUNTER_CUSTOM_FIELD_NAME=constants_2['FLOSUM_NAMESPACE']+a331_0x2ab49e(0x1bb),ORG_COMPONENT_SELECT_FIELDS=['Id',constants_2[a331_0x2ab49e(0x1c7)]+'Revision_Counter__c',constants_2[a331_0x2ab49e(0x1c7)]+a331_0x2ab49e(0x1b6),constants_2[a331_0x2ab49e(0x1c7)]+a331_0x2ab49e(0x1cf),constants_2[a331_0x2ab49e(0x1c7)]+a331_0x2ab49e(0x1c9),constants_2[a331_0x2ab49e(0x1c7)]+a331_0x2ab49e(0x1b0),constants_2[a331_0x2ab49e(0x1c7)]+a331_0x2ab49e(0x1e4),constants_2[a331_0x2ab49e(0x1c7)]+a331_0x2ab49e(0x1aa),constants_2[a331_0x2ab49e(0x1c7)]+'Folder__c'];function a331_0x3d6b(_0x148461,_0x50c9e0){const _0x27e19a=a331_0x3184();return a331_0x3d6b=function(_0x5f11b3,_0xf63480){_0x5f11b3=_0x5f11b3-0x1aa;let _0x318491=_0x27e19a[_0x5f11b3];return _0x318491;},a331_0x3d6b(_0x148461,_0x50c9e0);}class SourceMemberHandler extends stream_1[a331_0x2ab49e(0x1c5)]{constructor({apiVersion:_0x11c759,instance:_0x55b8bf,targetOrgId:_0x284e0c,logger:_0x503e8f}){const _0x1ac6ef=a331_0x2ab49e;super({'objectMode':!![]}),this[_0x1ac6ef(0x1cb)]=new Map(),this['handledMembersCounter']=0x0,this[_0x1ac6ef(0x1d0)]=_0x11c759,this[_0x1ac6ef(0x1b7)]=_0x55b8bf,this['targetOrgId']=_0x284e0c,this['logger']=_0x503e8f;}[a331_0x2ab49e(0x1ab)](){const _0x3f1f2f=a331_0x2ab49e;return new salesforce_1[(_0x3f1f2f(0x1e6))]()[_0x3f1f2f(0x1dc)](...ORG_COMPONENT_SELECT_FIELDS)[_0x3f1f2f(0x1cd)](constants_1[_0x3f1f2f(0x1e7)])[_0x3f1f2f(0x1dd)](SOURCE_MEMBER_ID_FIELD_NAME+_0x3f1f2f(0x1b8),{'sourceMemberIds':[...this[_0x3f1f2f(0x1cb)][_0x3f1f2f(0x1de)]()]})[_0x3f1f2f(0x1c8)](ORGANIZATION_NAME_FIELD+_0x3f1f2f(0x1b2),{'targetOrgId':this[_0x3f1f2f(0x1ad)]});}async['getComponentFromFlosum'](){const _0x66e2e8=a331_0x2ab49e,_0x5cc9e2=new salesforce_1[(_0x66e2e8(0x1ac))]({'api':this['api'],'queryBuilder':this[_0x66e2e8(0x1ab)](),'instance':this[_0x66e2e8(0x1b7)],'isTooling':![]}),_0x58231=new Map();do{const {records:_0x227260}=await _0x5cc9e2['execute']();for(const _0x34a869 of _0x227260){_0x58231[_0x66e2e8(0x1b4)](_0x34a869[SOURCE_MEMBER_ID_FIELD_NAME],_0x34a869);}}while(!_0x5cc9e2[_0x66e2e8(0x1c0)]());return _0x58231;}async[a331_0x2ab49e(0x1bd)](_0x46afea){const _0x3141d1=a331_0x2ab49e;this[_0x3141d1(0x1cb)]['set'](_0x46afea['Id'],_0x46afea),this[_0x3141d1(0x1cb)][_0x3141d1(0x1db)]===MAX_CHUNK_SIZE&&await this['handle']();}async['handle'](){const _0x3ca6e0=a331_0x2ab49e,_0x9b6b59=await this[_0x3ca6e0(0x1bc)]();for(const [_0xbf8041,_0x1ca642]of this['sourceMemberRecords']){const _0x286240=_0x9b6b59[_0x3ca6e0(0x1e1)](_0xbf8041);if(_0x286240&&_0x1ca642[REVISION_COUNTER_FIELD_NAME]===_0x286240[REVISION_COUNTER_CUSTOM_FIELD_NAME])continue;const _0x29cc3e={'sourceMemberId':_0x1ca642['Id'],'componentId':(_0x286240===null||_0x286240===void 0x0?void 0x0:_0x286240['Id'])||null,'attachmentId':(_0x286240===null||_0x286240===void 0x0?void 0x0:_0x286240[_0x3ca6e0(0x1aa)])||null,'metadataId':_0x1ca642[MEMBER_ID_FIELD_NAME],'metadataType':_0x1ca642[MEMBER_TYPE_FIELD_NAME],'isNameObsolete':_0x1ca642[IS_NAME_OBSOLETE],'revisionCounter':_0x1ca642[REVISION_COUNTER_FIELD_NAME],'changedBy':_0x1ca642[CHANGED_BY_FIELD_NAME]};this['handledMembersCounter']++,this[_0x3ca6e0(0x1c1)](_0x29cc3e);}this[_0x3ca6e0(0x1cb)]=new Map();}async[a331_0x2ab49e(0x1d9)](_0x1f6f2c,_0x5cc0dc,_0x275cb6){const _0x2386b3=a331_0x2ab49e;try{await this[_0x2386b3(0x1bd)](_0x1f6f2c),_0x275cb6();}catch(_0x17d816){_0x275cb6(_0x17d816);}}async[a331_0x2ab49e(0x1e3)](_0x2437cc){const _0x3afb6=a331_0x2ab49e;try{this[_0x3afb6(0x1cb)][_0x3afb6(0x1db)]&&await this['handle'](),this[_0x3afb6(0x1d6)]['log']('Changes\x20found\x20for\x20'+this[_0x3afb6(0x1e0)]+_0x3afb6(0x1af)),await this['logger'][_0x3afb6(0x1e5)](),_0x2437cc();}catch(_0x2799ed){_0x2437cc(_0x2799ed);}}}exports[a331_0x2ab49e(0x1b9)]=SourceMemberHandler;