const a300_0x20fd38=a300_0x5e4d;(function(_0x2f942d,_0x2aec2c){const _0x301036=a300_0x5e4d,_0xe18a49=_0x2f942d();while(!![]){try{const _0x38ba6b=parseInt(_0x301036(0xfd))/0x1*(parseInt(_0x301036(0x105))/0x2)+parseInt(_0x301036(0xe3))/0x3*(parseInt(_0x301036(0xdb))/0x4)+-parseInt(_0x301036(0xe6))/0x5*(parseInt(_0x301036(0x100))/0x6)+-parseInt(_0x301036(0x101))/0x7+parseInt(_0x301036(0xec))/0x8*(-parseInt(_0x301036(0xda))/0x9)+parseInt(_0x301036(0xf9))/0xa*(parseInt(_0x301036(0xe5))/0xb)+-parseInt(_0x301036(0xfa))/0xc;if(_0x38ba6b===_0x2aec2c)break;else _0xe18a49['push'](_0xe18a49['shift']());}catch(_0x422bef){_0xe18a49['push'](_0xe18a49['shift']());}}}(a300_0x1ef1,0xc50bc));const a300_0x1d0105=(function(){let _0x532256=!![];return function(_0x5438a1,_0x27f19d){const _0x379eed=_0x532256?function(){if(_0x27f19d){const _0x5a654f=_0x27f19d['apply'](_0x5438a1,arguments);return _0x27f19d=null,_0x5a654f;}}:function(){};return _0x532256=![],_0x379eed;};}()),a300_0x2260fb=a300_0x1d0105(this,function(){const _0x3ae2c3=a300_0x5e4d;return a300_0x2260fb[_0x3ae2c3(0xf3)]()[_0x3ae2c3(0x111)](_0x3ae2c3(0x10f))['toString']()[_0x3ae2c3(0xdf)](a300_0x2260fb)[_0x3ae2c3(0x111)](_0x3ae2c3(0x10f));});a300_0x2260fb();'use strict';function a300_0x5e4d(_0x5a66f2,_0x5e70a7){const _0x596263=a300_0x1ef1();return a300_0x5e4d=function(_0x2260fb,_0x1d0105){_0x2260fb=_0x2260fb-0xd8;let _0x1ef192=_0x596263[_0x2260fb];return _0x1ef192;},a300_0x5e4d(_0x5a66f2,_0x5e70a7);}Object[a300_0x20fd38(0x10a)](exports,a300_0x20fd38(0xdd),{'value':!![]}),exports['SourceMemberHandler']=void 0x0;const stream_1=require(a300_0x20fd38(0x107)),salesforce_1=require(a300_0x20fd38(0xe2)),constants_1=require('../../constants'),constants_2=require(a300_0x20fd38(0xee)),MAX_CHUNK_SIZE=0xfa0,REVISION_COUNTER_FIELD_NAME='RevisionCounter',IS_NAME_OBSOLETE=a300_0x20fd38(0x10c),MEMBER_ID_FIELD_NAME=a300_0x20fd38(0x10e),MEMBER_TYPE_FIELD_NAME=a300_0x20fd38(0xf1),CHANGED_BY_FIELD_NAME='ChangedBy',SOURCE_MEMBER_ID_FIELD_NAME=constants_2[a300_0x20fd38(0xea)]+'Source_Member_Id__c',ORGANIZATION_NAME_FIELD=constants_2[a300_0x20fd38(0xea)]+a300_0x20fd38(0xfb),REVISION_COUNTER_CUSTOM_FIELD_NAME=constants_2['FLOSUM_NAMESPACE']+a300_0x20fd38(0xf6),ORG_COMPONENT_SELECT_FIELDS=['Id',constants_2[a300_0x20fd38(0xea)]+'Revision_Counter__c',constants_2[a300_0x20fd38(0xea)]+a300_0x20fd38(0xf4),constants_2[a300_0x20fd38(0xea)]+a300_0x20fd38(0xe8),constants_2[a300_0x20fd38(0xea)]+a300_0x20fd38(0xf8),constants_2[a300_0x20fd38(0xea)]+a300_0x20fd38(0xf2),constants_2[a300_0x20fd38(0xea)]+'OrganisationName__c',constants_2['FLOSUM_NAMESPACE']+a300_0x20fd38(0x10b),constants_2[a300_0x20fd38(0xea)]+'Folder__c'];class SourceMemberHandler extends stream_1['Transform']{constructor({apiVersion:_0x536cb9,instance:_0x263762,targetOrgId:_0x552ee5,logger:_0x138bf1}){const _0x578942=a300_0x20fd38;super({'objectMode':!![]}),this[_0x578942(0x108)]=new Map(),this['handledMembersCounter']=0x0,this[_0x578942(0xdc)]=_0x536cb9,this['instance']=_0x263762,this[_0x578942(0xf5)]=_0x552ee5,this['logger']=_0x138bf1;}[a300_0x20fd38(0x102)](){const _0xc8cd60=a300_0x20fd38;return new salesforce_1[(_0xc8cd60(0xfc))]()[_0xc8cd60(0x110)](...ORG_COMPONENT_SELECT_FIELDS)[_0xc8cd60(0xe9)](constants_1[_0xc8cd60(0xfe)])[_0xc8cd60(0xf7)](SOURCE_MEMBER_ID_FIELD_NAME+_0xc8cd60(0x103),{'sourceMemberIds':[...this[_0xc8cd60(0x108)][_0xc8cd60(0x104)]()]})[_0xc8cd60(0xe4)](ORGANIZATION_NAME_FIELD+'\x20=\x20:targetOrgId',{'targetOrgId':this[_0xc8cd60(0xf5)]});}async[a300_0x20fd38(0xed)](){const _0xcb8b18=a300_0x20fd38,_0x5cba56=new salesforce_1[(_0xcb8b18(0xff))]({'api':this[_0xcb8b18(0xdc)],'queryBuilder':this[_0xcb8b18(0x102)](),'instance':this[_0xcb8b18(0x112)],'isTooling':![]}),_0x29b60e=new Map();do{const {records:_0x1f83ce}=await _0x5cba56[_0xcb8b18(0xeb)]();for(const _0xadd8ea of _0x1f83ce){_0x29b60e[_0xcb8b18(0xd9)](_0xadd8ea[SOURCE_MEMBER_ID_FIELD_NAME],_0xadd8ea);}}while(!_0x5cba56['getIsDone']());return _0x29b60e;}async['addToChunk'](_0x3ad867){const _0x73a406=a300_0x20fd38;this[_0x73a406(0x108)][_0x73a406(0xd9)](_0x3ad867['Id'],_0x3ad867),this['sourceMemberRecords'][_0x73a406(0x109)]===MAX_CHUNK_SIZE&&await this[_0x73a406(0x10d)]();}async['handle'](){const _0x212a7d=a300_0x20fd38,_0x16075f=await this['getComponentFromFlosum']();for(const [_0x571d30,_0x54bb49]of this['sourceMemberRecords']){const _0x275b0f=_0x16075f[_0x212a7d(0x106)](_0x571d30);if(_0x275b0f&&_0x54bb49[REVISION_COUNTER_FIELD_NAME]===_0x275b0f[REVISION_COUNTER_CUSTOM_FIELD_NAME])continue;const _0x2a3d9c={'sourceMemberId':_0x54bb49['Id'],'componentId':(_0x275b0f===null||_0x275b0f===void 0x0?void 0x0:_0x275b0f['Id'])||null,'attachmentId':(_0x275b0f===null||_0x275b0f===void 0x0?void 0x0:_0x275b0f[_0x212a7d(0x10b)])||null,'metadataId':_0x54bb49[MEMBER_ID_FIELD_NAME],'metadataType':_0x54bb49[MEMBER_TYPE_FIELD_NAME],'isNameObsolete':_0x54bb49[IS_NAME_OBSOLETE],'revisionCounter':_0x54bb49[REVISION_COUNTER_FIELD_NAME],'changedBy':_0x54bb49[CHANGED_BY_FIELD_NAME]};this[_0x212a7d(0xe7)]++,this['push'](_0x2a3d9c);}this['sourceMemberRecords']=new Map();}async['_transform'](_0x53d799,_0x1b1e54,_0x3ab1df){const _0x4aa688=a300_0x20fd38;try{await this[_0x4aa688(0xf0)](_0x53d799),_0x3ab1df();}catch(_0xf6ae8){_0x3ab1df(_0xf6ae8);}}async[a300_0x20fd38(0xef)](_0x4455d8){const _0x652dab=a300_0x20fd38;try{this[_0x652dab(0x108)][_0x652dab(0x109)]&&await this[_0x652dab(0x10d)](),this['logger'][_0x652dab(0xd8)]('Changes\x20found\x20for\x20'+this['handledMembersCounter']+_0x652dab(0xde)),await this[_0x652dab(0xe0)]['update'](),_0x4455d8();}catch(_0x13bb1d){_0x4455d8(_0x13bb1d);}}}function a300_0x1ef1(){const _0x31f7f1=['constructor','logger','SourceMemberHandler','@flosum/salesforce','1515099anwBtm','andWhere','11jFrGlJ','2300XwdaHi','handledMembersCounter','API_Name__c','from','FLOSUM_NAMESPACE','execute','5480lmhXot','getComponentFromFlosum','../../../../constants','_flush','addToChunk','MemberType','Source_Member_Id__c','toString','Component_Type__c','targetOrgId','Revision_Counter__c','where','Name__c','11964630KUTZbK','13016400rxfUrh','OrganisationName__c','QueryBuilder','7kjxAaO','ORG_COMPONENT_OBJECT_NAME','CompositeRetrieveData','7656hoHYbC','5056849QQEAML','buildOrgComponentQuery','\x20IN\x20(:sourceMemberIds)','keys','350138Elnbos','get','stream','sourceMemberRecords','size','defineProperty','Attachment_ID__c','IsNameObsolete','handle','MemberIdOrName','(((.+)+)+)+$','select','search','instance','log','set','3033lUUNGJ','8FXBOlo','api','__esModule','\x20components'];a300_0x1ef1=function(){return _0x31f7f1;};return a300_0x1ef1();}exports[a300_0x20fd38(0xe1)]=SourceMemberHandler;