const a345_0x16c411=a345_0x4b29;(function(_0x3a5229,_0x31e75e){const _0x379bb8=a345_0x4b29,_0x1e3e93=_0x3a5229();while(!![]){try{const _0x3d5cb6=parseInt(_0x379bb8(0x12d))/0x1*(parseInt(_0x379bb8(0x139))/0x2)+parseInt(_0x379bb8(0x141))/0x3+parseInt(_0x379bb8(0x128))/0x4*(parseInt(_0x379bb8(0x119))/0x5)+-parseInt(_0x379bb8(0x145))/0x6+parseInt(_0x379bb8(0x123))/0x7*(-parseInt(_0x379bb8(0x126))/0x8)+parseInt(_0x379bb8(0x125))/0x9*(parseInt(_0x379bb8(0x121))/0xa)+parseInt(_0x379bb8(0x12b))/0xb;if(_0x3d5cb6===_0x31e75e)break;else _0x1e3e93['push'](_0x1e3e93['shift']());}catch(_0x1f3d95){_0x1e3e93['push'](_0x1e3e93['shift']());}}}(a345_0x3536,0x58297));function a345_0x3536(){const _0x2bdc5b=['Revision_Counter__c','constructor','instance','1384623siLEFF','api','MemberIdOrName','(((.+)+)+)+$','409314oxJWQP','__esModule','set','Transform','search','QueryBuilder','size','RevisionCounter','handledMembersCounter','andWhere','MemberName','101035nMtCTJ','update','logger','Component_Type__c','targetOrgId','get','keys','toString','681860OFZyym','../../constants','7trzuiw','addToChunk','36RDEoIa','4522888tjsLtP','\x20IN\x20(:sourceMemberIds)','16aRZjRc','Source_Member_Id__c','../../../../constants','1049675gengMu','push','3KjVHNT','_flush','FLOSUM_NAMESPACE','execute','apply','stream','buildOrgComponentQuery','handle','_transform','sourceMemberRecords','log','select','56102oKbRbu','IsNameObsolete','\x20components','CompositeRetrieveData','OrganisationName__c'];a345_0x3536=function(){return _0x2bdc5b;};return a345_0x3536();}function a345_0x4b29(_0x5d08de,_0x446c11){const _0x15bf81=a345_0x3536();return a345_0x4b29=function(_0x25fed8,_0x136a7f){_0x25fed8=_0x25fed8-0x117;let _0x353666=_0x15bf81[_0x25fed8];return _0x353666;},a345_0x4b29(_0x5d08de,_0x446c11);}const a345_0x136a7f=(function(){let _0x12340d=!![];return function(_0x2ae1c1,_0xeb66c0){const _0x426c45=_0x12340d?function(){const _0x3b95f1=a345_0x4b29;if(_0xeb66c0){const _0x3153e5=_0xeb66c0[_0x3b95f1(0x131)](_0x2ae1c1,arguments);return _0xeb66c0=null,_0x3153e5;}}:function(){};return _0x12340d=![],_0x426c45;};}()),a345_0x25fed8=a345_0x136a7f(this,function(){const _0x398618=a345_0x4b29;return a345_0x25fed8[_0x398618(0x120)]()['search'](_0x398618(0x144))[_0x398618(0x120)]()[_0x398618(0x13f)](a345_0x25fed8)[_0x398618(0x149)](_0x398618(0x144));});a345_0x25fed8();'use strict';Object['defineProperty'](exports,a345_0x16c411(0x146),{'value':!![]}),exports['SourceMemberHandler']=void 0x0;const stream_1=require(a345_0x16c411(0x132)),salesforce_1=require('@flosum/salesforce'),constants_1=require(a345_0x16c411(0x122)),constants_2=require(a345_0x16c411(0x12a)),MAX_CHUNK_SIZE=0xfa0,REVISION_COUNTER_FIELD_NAME=a345_0x16c411(0x14c),IS_NAME_OBSOLETE=a345_0x16c411(0x13a),MEMBER_ID_FIELD_NAME=a345_0x16c411(0x143),MEMBER_TYPE_FIELD_NAME='MemberType',MEMBER_NAME=a345_0x16c411(0x118),CHANGED_BY_FIELD_NAME='ChangedBy',SOURCE_MEMBER_ID_FIELD_NAME=constants_2[a345_0x16c411(0x12f)]+a345_0x16c411(0x129),ORGANIZATION_NAME_FIELD=constants_2[a345_0x16c411(0x12f)]+'OrganisationName__c',REVISION_COUNTER_CUSTOM_FIELD_NAME=constants_2['FLOSUM_NAMESPACE']+a345_0x16c411(0x13e),ORG_COMPONENT_SELECT_FIELDS=['Id',constants_2[a345_0x16c411(0x12f)]+a345_0x16c411(0x13e),constants_2['FLOSUM_NAMESPACE']+a345_0x16c411(0x11c),constants_2[a345_0x16c411(0x12f)]+'API_Name__c',constants_2[a345_0x16c411(0x12f)]+'Name__c',constants_2[a345_0x16c411(0x12f)]+a345_0x16c411(0x129),constants_2[a345_0x16c411(0x12f)]+a345_0x16c411(0x13d),constants_2[a345_0x16c411(0x12f)]+'Attachment_ID__c',constants_2[a345_0x16c411(0x12f)]+'Folder__c'];class SourceMemberHandler extends stream_1[a345_0x16c411(0x148)]{constructor({apiVersion:_0xf131b,instance:_0x3621c7,targetOrgId:_0x553c56,logger:_0x472d8e}){const _0x4ec502=a345_0x16c411;super({'objectMode':!![]}),this[_0x4ec502(0x136)]=new Map(),this[_0x4ec502(0x14d)]=0x0,this[_0x4ec502(0x142)]=_0xf131b,this[_0x4ec502(0x140)]=_0x3621c7,this[_0x4ec502(0x11d)]=_0x553c56,this[_0x4ec502(0x11b)]=_0x472d8e;}[a345_0x16c411(0x133)](){const _0x5b990a=a345_0x16c411;return new salesforce_1[(_0x5b990a(0x14a))]()[_0x5b990a(0x138)](...ORG_COMPONENT_SELECT_FIELDS)['from'](constants_1['ORG_COMPONENT_OBJECT_NAME'])['where'](SOURCE_MEMBER_ID_FIELD_NAME+_0x5b990a(0x127),{'sourceMemberIds':[...this[_0x5b990a(0x136)][_0x5b990a(0x11f)]()]})[_0x5b990a(0x117)](ORGANIZATION_NAME_FIELD+'\x20=\x20:targetOrgId',{'targetOrgId':this[_0x5b990a(0x11d)]});}async['getComponentFromFlosum'](){const _0x261a1b=a345_0x16c411,_0x225541=new salesforce_1[(_0x261a1b(0x13c))]({'api':this[_0x261a1b(0x142)],'queryBuilder':this['buildOrgComponentQuery'](),'instance':this['instance'],'isTooling':![]}),_0x324126=new Map();do{const {records:_0x1c7b48}=await _0x225541[_0x261a1b(0x130)]();for(const _0x27273e of _0x1c7b48){_0x324126[_0x261a1b(0x147)](_0x27273e[SOURCE_MEMBER_ID_FIELD_NAME],_0x27273e);}}while(!_0x225541['getIsDone']());return _0x324126;}async[a345_0x16c411(0x124)](_0x42c68c){const _0x48716d=a345_0x16c411;this[_0x48716d(0x136)][_0x48716d(0x147)](_0x42c68c['Id'],_0x42c68c),this[_0x48716d(0x136)][_0x48716d(0x14b)]===MAX_CHUNK_SIZE&&await this['handle']();}async[a345_0x16c411(0x134)](){const _0x43f139=a345_0x16c411,_0x495502=await this['getComponentFromFlosum']();for(const [_0x22a3a4,_0x1bd300]of this['sourceMemberRecords']){const _0xe031e0=_0x495502[_0x43f139(0x11e)](_0x22a3a4);if(_0xe031e0&&_0x1bd300[REVISION_COUNTER_FIELD_NAME]===_0xe031e0[REVISION_COUNTER_CUSTOM_FIELD_NAME])continue;const _0xcc7cc3={'sourceMemberId':_0x1bd300['Id'],'componentId':(_0xe031e0===null||_0xe031e0===void 0x0?void 0x0:_0xe031e0['Id'])||null,'attachmentId':(_0xe031e0===null||_0xe031e0===void 0x0?void 0x0:_0xe031e0['Attachment_ID__c'])||null,'metadataId':_0x1bd300[MEMBER_ID_FIELD_NAME],'metadataType':_0x1bd300[MEMBER_TYPE_FIELD_NAME],'metadataName':_0x1bd300[MEMBER_NAME],'isNameObsolete':_0x1bd300[IS_NAME_OBSOLETE],'revisionCounter':_0x1bd300[REVISION_COUNTER_FIELD_NAME],'changedBy':_0x1bd300[CHANGED_BY_FIELD_NAME]};this[_0x43f139(0x14d)]++,this[_0x43f139(0x12c)](_0xcc7cc3);}this['sourceMemberRecords']=new Map();}async[a345_0x16c411(0x135)](_0x5c9d33,_0x3765a9,_0x55e2c8){const _0x39cdb1=a345_0x16c411;try{await this[_0x39cdb1(0x124)](_0x5c9d33),_0x55e2c8();}catch(_0x444f52){_0x55e2c8(_0x444f52);}}async[a345_0x16c411(0x12e)](_0x6d0e7a){const _0x543acd=a345_0x16c411;try{this['sourceMemberRecords'][_0x543acd(0x14b)]&&await this['handle'](),this['logger'][_0x543acd(0x137)]('Changes\x20found\x20for\x20'+this[_0x543acd(0x14d)]+_0x543acd(0x13b)),await this[_0x543acd(0x11b)][_0x543acd(0x11a)](),_0x6d0e7a();}catch(_0x2026f2){_0x6d0e7a(_0x2026f2);}}}exports['SourceMemberHandler']=SourceMemberHandler;