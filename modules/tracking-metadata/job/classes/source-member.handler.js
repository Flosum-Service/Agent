const a300_0x2d0778=a300_0x1950;(function(_0x52cca9,_0x5ae201){const _0x2e29e0=a300_0x1950,_0x14075a=_0x52cca9();while(!![]){try{const _0x1c78e7=parseInt(_0x2e29e0(0x116))/0x1*(parseInt(_0x2e29e0(0x139))/0x2)+parseInt(_0x2e29e0(0x133))/0x3*(parseInt(_0x2e29e0(0x132))/0x4)+-parseInt(_0x2e29e0(0x14a))/0x5*(-parseInt(_0x2e29e0(0x130))/0x6)+-parseInt(_0x2e29e0(0x12a))/0x7+parseInt(_0x2e29e0(0x150))/0x8+-parseInt(_0x2e29e0(0x122))/0x9*(-parseInt(_0x2e29e0(0x147))/0xa)+-parseInt(_0x2e29e0(0x121))/0xb*(parseInt(_0x2e29e0(0x14f))/0xc);if(_0x1c78e7===_0x5ae201)break;else _0x14075a['push'](_0x14075a['shift']());}catch(_0x21dac6){_0x14075a['push'](_0x14075a['shift']());}}}(a300_0x5973,0xa44e1));const a300_0x1cc818=(function(){let _0x10ef16=!![];return function(_0x7464bd,_0x53a278){const _0x4ed485=_0x10ef16?function(){const _0x285fa2=a300_0x1950;if(_0x53a278){const _0x5cc24c=_0x53a278[_0x285fa2(0x128)](_0x7464bd,arguments);return _0x53a278=null,_0x5cc24c;}}:function(){};return _0x10ef16=![],_0x4ed485;};}()),a300_0x47bd31=a300_0x1cc818(this,function(){const _0x3c4ec9=a300_0x1950;return a300_0x47bd31[_0x3c4ec9(0x127)]()['search'](_0x3c4ec9(0x12c))[_0x3c4ec9(0x127)]()[_0x3c4ec9(0x14b)](a300_0x47bd31)[_0x3c4ec9(0x11e)]('(((.+)+)+)+$');});a300_0x47bd31();function a300_0x1950(_0x79a78d,_0xac60aa){const _0x1d94e0=a300_0x5973();return a300_0x1950=function(_0x47bd31,_0x1cc818){_0x47bd31=_0x47bd31-0x116;let _0x59738b=_0x1d94e0[_0x47bd31];return _0x59738b;},a300_0x1950(_0x79a78d,_0xac60aa);}'use strict';Object['defineProperty'](exports,a300_0x2d0778(0x143),{'value':!![]}),exports['SourceMemberHandler']=void 0x0;const stream_1=require(a300_0x2d0778(0x152)),salesforce_1=require(a300_0x2d0778(0x13b)),constants_1=require(a300_0x2d0778(0x137)),constants_2=require(a300_0x2d0778(0x12f)),MAX_CHUNK_SIZE=0xfa0,REVISION_COUNTER_FIELD_NAME=a300_0x2d0778(0x12e),IS_NAME_OBSOLETE=a300_0x2d0778(0x13f),MEMBER_ID_FIELD_NAME='MemberIdOrName',MEMBER_TYPE_FIELD_NAME=a300_0x2d0778(0x11c),CHANGED_BY_FIELD_NAME=a300_0x2d0778(0x142),SOURCE_MEMBER_ID_FIELD_NAME=constants_2[a300_0x2d0778(0x12b)]+a300_0x2d0778(0x11a),ORGANIZATION_NAME_FIELD=constants_2[a300_0x2d0778(0x12b)]+a300_0x2d0778(0x126),REVISION_COUNTER_CUSTOM_FIELD_NAME=constants_2['FLOSUM_NAMESPACE']+a300_0x2d0778(0x148),ORG_COMPONENT_SELECT_FIELDS=['Id',constants_2[a300_0x2d0778(0x12b)]+'Revision_Counter__c',constants_2[a300_0x2d0778(0x12b)]+a300_0x2d0778(0x131),constants_2[a300_0x2d0778(0x12b)]+a300_0x2d0778(0x12d),constants_2['FLOSUM_NAMESPACE']+a300_0x2d0778(0x134),constants_2[a300_0x2d0778(0x12b)]+a300_0x2d0778(0x11a),constants_2[a300_0x2d0778(0x12b)]+a300_0x2d0778(0x126),constants_2[a300_0x2d0778(0x12b)]+'Attachment_ID__c',constants_2[a300_0x2d0778(0x12b)]+'Folder__c'];function a300_0x5973(){const _0x137d01=['instance','@flosum/salesforce','\x20IN\x20(:sourceMemberIds)','select','update','IsNameObsolete','\x20=\x20:targetOrgId','buildOrgComponentQuery','ChangedBy','__esModule','api','handle','addToChunk','10ivNKRg','Revision_Counter__c','execute','3805615cPMYDr','constructor','sourceMemberRecords','_transform','\x20components','43399668DDZPIJ','2425264vcAhtY','where','stream','4880LOzlbD','logger','Changes\x20found\x20for\x20','keys','Source_Member_Id__c','set','MemberType','QueryBuilder','search','handledMembersCounter','SourceMemberHandler','11qgDsuL','6997977cvsHGE','Attachment_ID__c','log','get','OrganisationName__c','toString','apply','size','1358014lRpCWQ','FLOSUM_NAMESPACE','(((.+)+)+)+$','API_Name__c','RevisionCounter','../../../../constants','6sPPprM','Component_Type__c','8iRFkdK','1978980PGSJfY','Name__c','targetOrgId','andWhere','../../constants','Transform','542WjzYqP'];a300_0x5973=function(){return _0x137d01;};return a300_0x5973();}class SourceMemberHandler extends stream_1[a300_0x2d0778(0x138)]{constructor({apiVersion:_0x12ac7f,instance:_0x1a1f36,targetOrgId:_0x237b63,logger:_0x1d7a42}){const _0x1e9dcd=a300_0x2d0778;super({'objectMode':!![]}),this[_0x1e9dcd(0x14c)]=new Map(),this['handledMembersCounter']=0x0,this[_0x1e9dcd(0x144)]=_0x12ac7f,this[_0x1e9dcd(0x13a)]=_0x1a1f36,this[_0x1e9dcd(0x135)]=_0x237b63,this[_0x1e9dcd(0x117)]=_0x1d7a42;}[a300_0x2d0778(0x141)](){const _0x109fbf=a300_0x2d0778;return new salesforce_1[(_0x109fbf(0x11d))]()[_0x109fbf(0x13d)](...ORG_COMPONENT_SELECT_FIELDS)['from'](constants_1['ORG_COMPONENT_OBJECT_NAME'])[_0x109fbf(0x151)](SOURCE_MEMBER_ID_FIELD_NAME+_0x109fbf(0x13c),{'sourceMemberIds':[...this[_0x109fbf(0x14c)][_0x109fbf(0x119)]()]})[_0x109fbf(0x136)](ORGANIZATION_NAME_FIELD+_0x109fbf(0x140),{'targetOrgId':this['targetOrgId']});}async['getComponentFromFlosum'](){const _0x47aa32=a300_0x2d0778,_0x3043e1=new salesforce_1['CompositeRetrieveData']({'api':this[_0x47aa32(0x144)],'queryBuilder':this[_0x47aa32(0x141)](),'instance':this['instance'],'isTooling':![]}),_0x6d9d63=new Map();do{const {records:_0x11826b}=await _0x3043e1[_0x47aa32(0x149)]();for(const _0x31b684 of _0x11826b){_0x6d9d63[_0x47aa32(0x11b)](_0x31b684[SOURCE_MEMBER_ID_FIELD_NAME],_0x31b684);}}while(!_0x3043e1['getIsDone']());return _0x6d9d63;}async[a300_0x2d0778(0x146)](_0x567df2){const _0x7c99e5=a300_0x2d0778;this[_0x7c99e5(0x14c)][_0x7c99e5(0x11b)](_0x567df2['Id'],_0x567df2),this['sourceMemberRecords'][_0x7c99e5(0x129)]===MAX_CHUNK_SIZE&&await this[_0x7c99e5(0x145)]();}async[a300_0x2d0778(0x145)](){const _0x5a34fd=a300_0x2d0778,_0x77af3d=await this['getComponentFromFlosum']();for(const [_0x152275,_0x17ef96]of this['sourceMemberRecords']){const _0xbf93cd=_0x77af3d[_0x5a34fd(0x125)](_0x152275);if(_0xbf93cd&&_0x17ef96[REVISION_COUNTER_FIELD_NAME]===_0xbf93cd[REVISION_COUNTER_CUSTOM_FIELD_NAME])continue;const _0x289af6={'sourceMemberId':_0x17ef96['Id'],'componentId':(_0xbf93cd===null||_0xbf93cd===void 0x0?void 0x0:_0xbf93cd['Id'])||null,'attachmentId':(_0xbf93cd===null||_0xbf93cd===void 0x0?void 0x0:_0xbf93cd[_0x5a34fd(0x123)])||null,'metadataId':_0x17ef96[MEMBER_ID_FIELD_NAME],'metadataType':_0x17ef96[MEMBER_TYPE_FIELD_NAME],'isNameObsolete':_0x17ef96[IS_NAME_OBSOLETE],'revisionCounter':_0x17ef96[REVISION_COUNTER_FIELD_NAME],'changedBy':_0x17ef96[CHANGED_BY_FIELD_NAME]};this['handledMembersCounter']++,this['push'](_0x289af6);}this[_0x5a34fd(0x14c)]=new Map();}async[a300_0x2d0778(0x14d)](_0x6bb1ca,_0x248cba,_0x41fc17){const _0x2af9f3=a300_0x2d0778;try{await this[_0x2af9f3(0x146)](_0x6bb1ca),_0x41fc17();}catch(_0xd02338){_0x41fc17(_0xd02338);}}async['_flush'](_0x113b55){const _0x365010=a300_0x2d0778;try{this[_0x365010(0x14c)][_0x365010(0x129)]&&await this[_0x365010(0x145)](),this['logger'][_0x365010(0x124)](_0x365010(0x118)+this[_0x365010(0x11f)]+_0x365010(0x14e)),await this[_0x365010(0x117)][_0x365010(0x13e)](),_0x113b55();}catch(_0x47a133){_0x113b55(_0x47a133);}}}exports[a300_0x2d0778(0x120)]=SourceMemberHandler;