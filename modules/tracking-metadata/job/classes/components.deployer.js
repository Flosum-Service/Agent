function a339_0x55c6(_0x4cbdeb,_0x20eb70){const _0x41b676=a339_0x55c7();return a339_0x55c6=function(_0x311366,_0x4e0389){_0x311366=_0x311366-0x189;let _0x55c7a3=_0x41b676[_0x311366];return _0x55c7a3;},a339_0x55c6(_0x4cbdeb,_0x20eb70);}const a339_0x10ecaf=a339_0x55c6;(function(_0x4328a7,_0x5d09c0){const _0x87ea62=a339_0x55c6,_0x417933=_0x4328a7();while(!![]){try{const _0x1c6f42=-parseInt(_0x87ea62(0x1b2))/0x1+-parseInt(_0x87ea62(0x1b7))/0x2+parseInt(_0x87ea62(0x1c3))/0x3*(-parseInt(_0x87ea62(0x1bf))/0x4)+parseInt(_0x87ea62(0x19f))/0x5*(parseInt(_0x87ea62(0x1c0))/0x6)+parseInt(_0x87ea62(0x18c))/0x7*(parseInt(_0x87ea62(0x1c5))/0x8)+parseInt(_0x87ea62(0x189))/0x9+parseInt(_0x87ea62(0x1be))/0xa;if(_0x1c6f42===_0x5d09c0)break;else _0x417933['push'](_0x417933['shift']());}catch(_0x498a5f){_0x417933['push'](_0x417933['shift']());}}}(a339_0x55c7,0x7f2e3));const a339_0x4e0389=(function(){let _0x3a244b=!![];return function(_0xa3d43d,_0x38a1b2){const _0xf6f690=_0x3a244b?function(){const _0x43e207=a339_0x55c6;if(_0x38a1b2){const _0x45b9d1=_0x38a1b2[_0x43e207(0x1bc)](_0xa3d43d,arguments);return _0x38a1b2=null,_0x45b9d1;}}:function(){};return _0x3a244b=![],_0xf6f690;};}()),a339_0x311366=a339_0x4e0389(this,function(){const _0x2f12b5=a339_0x55c6;return a339_0x311366[_0x2f12b5(0x1a7)]()[_0x2f12b5(0x1d0)](_0x2f12b5(0x1ae))['toString']()[_0x2f12b5(0x1a5)](a339_0x311366)['search']('(((.+)+)+)+$');});a339_0x311366();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x58aec4){const _0x3c4da3=a339_0x55c6;return _0x58aec4&&_0x58aec4[_0x3c4da3(0x1b9)]?_0x58aec4:{'default':_0x58aec4};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['ComponentsDeployer']=void 0x0;const salesforce_1=require('@flosum/salesforce'),constants_1=require(a339_0x10ecaf(0x19a)),stream_1=require(a339_0x10ecaf(0x193)),jszip_1=__importDefault(require(a339_0x10ecaf(0x1c9))),constants_2=require(a339_0x10ecaf(0x18f)),MAX_COMPOSITE_CHUNK_COUNT=0xc8,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a339_0x10ecaf(0x1a9)]+a339_0x10ecaf(0x1d4),CONTENT_TYPE='application/zip';function a339_0x55c7(){const _0x229c2f=['binary','../../constants','log','Source_Member_Id__c','OrganisationName__c','generateAsync','975WhJxaH','CompositeConstants','orgComponentsToDeployChunk','Retrieved','nodebuffer','push','constructor','addAttachmentToChunk','toString','length','FLOSUM_NAMESPACE','apiVersion','then','MAX_BODY_SIZE','isReachedMaxChunk','(((.+)+)+)+$','ComponentsDeployer','byteLength','fileName','286407buLxXQ','from','update','Status__c','Label__c','674620eTFIRI','deployAttachments','__esModule','records','componentId','apply','attachmentsToDeployChunk','9963640zOLSMK','3926612nQaJgQ','26256TGaCLN','logger','type','3qSNyTv','Last_Updated_By__c','16mwwBGD','trackingSettingId','changedBy','isNameObsolete','jszip','ATTACHMENT_OBJECT_NAME','Name__c','populateAttachmentId','Writable','resetChunks','file','search','instance','attachmentId','deployOrgComponents','Attachment_ID__c','2009403MpRPjM','has','BINARY_FIELD_NAME','186725zkEmMy','successDeployedCounter','RestSimpleDeployData','../../../../constants','execute','targetOrgId','Process\x20completed\x20for\x20','stream','Readable','revisionCounter','handleDeployResult','fullName','deploy'];a339_0x55c7=function(){return _0x229c2f;};return a339_0x55c7();}class ComponentsDeployer extends stream_1[a339_0x10ecaf(0x1cd)]{constructor({apiVersion:_0x43b44b,instance:_0x4c2ecb,logger:_0x2f770b,targetOrgId:_0x35f497,trackingSettingId:_0x41cb4b}){const _0x95ee2a=a339_0x10ecaf;super({'objectMode':!![]}),this['attachmentsToDeployChunk']={'records':[],'binary':[]},this['binaryRecordsSizeChunk']=0x0,this[_0x95ee2a(0x1a1)]=[],this[_0x95ee2a(0x18d)]=0x0,this['apiVersion']=_0x43b44b,this['instance']=_0x4c2ecb,this[_0x95ee2a(0x1c1)]=_0x2f770b,this[_0x95ee2a(0x191)]=_0x35f497,this[_0x95ee2a(0x1c6)]=_0x41cb4b;}async[a339_0x10ecaf(0x198)](){const _0x3f823f=a339_0x10ecaf;await this[_0x3f823f(0x1b8)]()[_0x3f823f(0x1ab)](_0x2cf009=>this[_0x3f823f(0x1cc)](_0x2cf009))[_0x3f823f(0x1ab)](()=>this[_0x3f823f(0x1d3)]())[_0x3f823f(0x1ab)](_0x283ea8=>this[_0x3f823f(0x196)](_0x283ea8)),this['resetChunks']();}['deployAttachments'](){const _0x2fb97d=a339_0x10ecaf,_0x308d47=new salesforce_1['CompositeBinaryDeployData']({'instance':this[_0x2fb97d(0x1d1)],'objectName':constants_1[_0x2fb97d(0x1ca)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this[_0x2fb97d(0x1aa)]});return _0x308d47[_0x2fb97d(0x190)](this[_0x2fb97d(0x1bd)]);}[a339_0x10ecaf(0x1d3)](){const _0x371085=a339_0x10ecaf,_0x587884=new salesforce_1[(_0x371085(0x18e))]({'instance':this[_0x371085(0x1d1)],'objectName':constants_1['ORG_COMPONENT_OBJECT_NAME'],'api':this[_0x371085(0x1aa)],'allOrNone':![],'externalIdField':'Id'});return _0x587884['execute']({'records':this[_0x371085(0x1a1)]});}async[a339_0x10ecaf(0x196)](_0x4aeea5){for(const {success:_0x68a6ad,error:_0x2a17ec}of _0x4aeea5){if(_0x68a6ad){this['successDeployedCounter']++;continue;}_0x2a17ec&&this['logger']['error'](_0x2a17ec);}}[a339_0x10ecaf(0x1ad)](_0x4b7221){const _0x2c8cdb=a339_0x10ecaf;return _0x4b7221+this['binaryRecordsSizeChunk']>=salesforce_1[_0x2c8cdb(0x1a0)][_0x2c8cdb(0x1ac)]||this[_0x2c8cdb(0x1bd)][_0x2c8cdb(0x1ba)][_0x2c8cdb(0x1a8)]===MAX_COMPOSITE_CHUNK_COUNT;}[a339_0x10ecaf(0x1ce)](){const _0x5d224e=a339_0x10ecaf;this['binaryRecordsSizeChunk']=0x0,this[_0x5d224e(0x1bd)]={'records':[],'binary':[]},this['orgComponentsToDeployChunk']=[];}['populateAttachmentId'](_0x2af37e){const _0x1f38e4=a339_0x10ecaf;for(const _0x252613 in _0x2af37e){this[_0x1f38e4(0x1a1)][_0x252613][ATTACHMENT_FIELD_NAME]=_0x2af37e[_0x252613]['id'];}}async[a339_0x10ecaf(0x1a6)](_0xc3ba5e,_0x525989){const _0x342436=a339_0x10ecaf,{listMetadataItem:_0x5c1534,sourceMemberRecord:_0x26877f}=_0xc3ba5e,_0x43e306={'attributes':{'type':constants_1['ATTACHMENT_OBJECT_NAME'],'binaryPartName':_0x5c1534[_0x342436(0x197)],'binaryPartNameAlias':constants_1['BINARY_FIELD_NAME']},'Id':_0x26877f[_0x342436(0x1d2)],'Name':_0x5c1534[_0x342436(0x197)],'Description':_0x5c1534[_0x342436(0x1c2)],'ContentType':CONTENT_TYPE,'ParentId':this[_0x342436(0x191)],'Body':_0x5c1534['fullName']},_0x1deaf4={'binaryFieldName':constants_1[_0x342436(0x18b)],'name':_0x5c1534['fullName'],'value':stream_1[_0x342436(0x194)][_0x342436(0x1b3)](_0x525989)};this['attachmentsToDeployChunk'][_0x342436(0x1ba)]['push'](_0x43e306),this['attachmentsToDeployChunk'][_0x342436(0x199)][_0x342436(0x1a4)](_0x1deaf4);}['createZip'](_0x1297f2){const _0x5d062d=a339_0x10ecaf,_0xd58613=new jszip_1['default']();for(const _0xaf018d in _0x1297f2){_0xd58613[_0x5d062d(0x1cf)](_0xaf018d,_0x1297f2[_0xaf018d]);}return _0xd58613[_0x5d062d(0x19e)]({'type':_0x5d062d(0x1a3)});}['addOrgComponentToChunk'](_0x39720a,_0x425e13){const _0x147ae5=a339_0x10ecaf,_0x139210={'attributes':{'type':constants_1['ORG_COMPONENT_OBJECT_NAME']},'Id':_0x425e13[_0x147ae5(0x1bb)],[constants_2[_0x147ae5(0x1a9)]+'Is_Deleted__c']:_0x425e13[_0x147ae5(0x1c8)],[constants_2['FLOSUM_NAMESPACE']+'Revision_Counter__c']:_0x425e13[_0x147ae5(0x195)],[constants_2[_0x147ae5(0x1a9)]+_0x147ae5(0x19c)]:_0x425e13['sourceMemberId'],[constants_2[_0x147ae5(0x1a9)]+_0x147ae5(0x1c4)]:_0x425e13[_0x147ae5(0x1c7)],[constants_2[_0x147ae5(0x1a9)]+'API_Name__c']:_0x39720a[_0x147ae5(0x197)],[constants_2['FLOSUM_NAMESPACE']+_0x147ae5(0x1cb)]:_0x39720a[_0x147ae5(0x197)],[constants_2[_0x147ae5(0x1a9)]+'Component_Type__c']:_0x39720a[_0x147ae5(0x1c2)],[constants_2['FLOSUM_NAMESPACE']+_0x147ae5(0x1b6)]:_0x39720a[_0x147ae5(0x1b1)],[constants_2[_0x147ae5(0x1a9)]+'Folder__c']:constants_1['METADATA_FOLDER_MAP'][_0x147ae5(0x18a)](_0x39720a[_0x147ae5(0x1c2)])||null,[constants_2[_0x147ae5(0x1a9)]+'Is_Retrieved__c']:!![],[constants_2[_0x147ae5(0x1a9)]+_0x147ae5(0x19d)]:this[_0x147ae5(0x191)],[constants_2[_0x147ae5(0x1a9)]+'Tracking_Setting__c']:this['trackingSettingId'],[constants_2[_0x147ae5(0x1a9)]+_0x147ae5(0x1b5)]:_0x147ae5(0x1a2)};this[_0x147ae5(0x1a1)][_0x147ae5(0x1a4)](_0x139210);}async['_write'](_0x51407e,_0x597355,_0x2e5138){const _0x2f3cfd=a339_0x10ecaf;try{const {listMetadataItem:_0x285e3f,sourceMemberRecord:_0x5be7c9,files:_0xabd464}=_0x51407e,_0x35be3f=await this['createZip'](_0xabd464),_0x2adae5=Buffer[_0x2f3cfd(0x1b0)](_0x35be3f);this[_0x2f3cfd(0x1ad)](_0x2adae5)&&await this['deploy'](),this['binaryRecordsSizeChunk']+=_0x2adae5,await this['addAttachmentToChunk'](_0x51407e,_0x35be3f),this['addOrgComponentToChunk'](_0x285e3f,_0x5be7c9),_0x2e5138();}catch(_0x2e0453){_0x2e5138(_0x2e0453);}}async['_final'](_0xf23d3d){const _0x1d95cb=a339_0x10ecaf;try{this['attachmentsToDeployChunk'][_0x1d95cb(0x1ba)][_0x1d95cb(0x1a8)]&&this['orgComponentsToDeployChunk'][_0x1d95cb(0x1a8)]&&await this[_0x1d95cb(0x198)](),this[_0x1d95cb(0x1c1)][_0x1d95cb(0x19b)](_0x1d95cb(0x192)+this[_0x1d95cb(0x18d)]+'\x20components'),await this[_0x1d95cb(0x1c1)][_0x1d95cb(0x1b4)](),_0xf23d3d();}catch(_0x379247){_0xf23d3d(_0x379247);}}}exports[a339_0x10ecaf(0x1af)]=ComponentsDeployer;