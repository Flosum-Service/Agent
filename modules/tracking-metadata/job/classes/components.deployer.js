const a290_0x20f379=a290_0x1b0f;(function(_0x297e3d,_0x3143a0){const _0x1b92c2=a290_0x1b0f,_0x4f224f=_0x297e3d();while(!![]){try{const _0x988f8c=parseInt(_0x1b92c2(0x16d))/0x1+parseInt(_0x1b92c2(0x140))/0x2+parseInt(_0x1b92c2(0x134))/0x3+-parseInt(_0x1b92c2(0x15b))/0x4+-parseInt(_0x1b92c2(0x151))/0x5+parseInt(_0x1b92c2(0x14f))/0x6*(parseInt(_0x1b92c2(0x14b))/0x7)+-parseInt(_0x1b92c2(0x161))/0x8;if(_0x988f8c===_0x3143a0)break;else _0x4f224f['push'](_0x4f224f['shift']());}catch(_0x26fb7c){_0x4f224f['push'](_0x4f224f['shift']());}}}(a290_0x3335,0x7e20c));const a290_0x1bb85c=(function(){let _0x5efd79=!![];return function(_0x5f0624,_0x47e6de){const _0xf361de=_0x5efd79?function(){const _0x159fb5=a290_0x1b0f;if(_0x47e6de){const _0x17b657=_0x47e6de[_0x159fb5(0x138)](_0x5f0624,arguments);return _0x47e6de=null,_0x17b657;}}:function(){};return _0x5efd79=![],_0xf361de;};}()),a290_0x27e290=a290_0x1bb85c(this,function(){const _0x45818e=a290_0x1b0f;return a290_0x27e290[_0x45818e(0x127)]()[_0x45818e(0x156)]('(((.+)+)+)+$')['toString']()[_0x45818e(0x144)](a290_0x27e290)[_0x45818e(0x156)](_0x45818e(0x12d));});a290_0x27e290();'use strict';var __importDefault=this&&this[a290_0x20f379(0x149)]||function(_0x985e09){const _0x313df5=a290_0x20f379;return _0x985e09&&_0x985e09[_0x313df5(0x168)]?_0x985e09:{'default':_0x985e09};};function a290_0x1b0f(_0x38ffc1,_0x379576){const _0x392b80=a290_0x3335();return a290_0x1b0f=function(_0x27e290,_0x1bb85c){_0x27e290=_0x27e290-0x127;let _0x333582=_0x392b80[_0x27e290];return _0x333582;},a290_0x1b0f(_0x38ffc1,_0x379576);}Object[a290_0x20f379(0x164)](exports,a290_0x20f379(0x168),{'value':!![]});function a290_0x3335(){const _0x6e66a0=['byteLength','deployAttachments','Is_Retrieved__c','sourceMemberId','attachmentsToDeployChunk','nodebuffer','2813067FpizPY','Tracking_Setting__c','populateAttachmentId','../../../../constants','apply','isReachedMaxChunk','Readable','resetChunks','instance','Revision_Counter__c','deploy','handleDeployResult','432280qGqcTQ','\x20components','addOrgComponentToChunk','addAttachmentToChunk','constructor','Source_Member_Id__c','createZip','successDeployedCounter','push','__importDefault','FLOSUM_NAMESPACE','7EDzfWM','../../constants','orgComponentsToDeployChunk','MAX_BODY_SIZE','207006IIDzVM','OrganisationName__c','1001255iTxYGQ','binaryRecordsSizeChunk','trackingSettingId','METADATA_FOLDER_MAP','records','search','RestSimpleDeployData','stream','apiVersion','_write','908732oxvKVj','Retrieved','logger','from','has','ORG_COMPONENT_OBJECT_NAME','6265808KhWaHb','ATTACHMENT_OBJECT_NAME','Is_Deleted__c','defineProperty','API_Name__c','Folder__c','execute','__esModule','application/zip','componentId','then','file','538950sGdLif','BINARY_FIELD_NAME','length','targetOrgId','error','jszip','changedBy','fullName','CompositeBinaryDeployData','isNameObsolete','Writable','toString','fileName','Attachment_ID__c','CompositeConstants','type','_final','(((.+)+)+)+$'];a290_0x3335=function(){return _0x6e66a0;};return a290_0x3335();}const salesforce_1=require('@flosum/salesforce'),constants_1=require(a290_0x20f379(0x14c)),stream_1=require(a290_0x20f379(0x158)),jszip_1=__importDefault(require(a290_0x20f379(0x172))),constants_2=require(a290_0x20f379(0x137)),MAX_COMPOSITE_CHUNK_COUNT=0xc8,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2['FLOSUM_NAMESPACE']+a290_0x20f379(0x129),CONTENT_TYPE=a290_0x20f379(0x169);class ComponentsDeployer extends stream_1[a290_0x20f379(0x177)]{constructor({apiVersion:_0x1df2c3,instance:_0x398928,logger:_0x41c777,targetOrgId:_0x3629a8,trackingSettingId:_0x3073bf}){const _0x17c023=a290_0x20f379;super({'objectMode':!![]}),this[_0x17c023(0x132)]={'records':[],'binary':[]},this[_0x17c023(0x152)]=0x0,this[_0x17c023(0x14d)]=[],this['successDeployedCounter']=0x0,this[_0x17c023(0x159)]=_0x1df2c3,this['instance']=_0x398928,this[_0x17c023(0x15d)]=_0x41c777,this[_0x17c023(0x170)]=_0x3629a8,this['trackingSettingId']=_0x3073bf;}async['deploy'](){const _0xa06fe=a290_0x20f379;await this[_0xa06fe(0x12f)]()[_0xa06fe(0x16b)](_0x38fc3c=>this[_0xa06fe(0x136)](_0x38fc3c))['then'](()=>this['deployOrgComponents']())['then'](_0x3da63f=>this[_0xa06fe(0x13f)](_0x3da63f)),this[_0xa06fe(0x13b)]();}[a290_0x20f379(0x12f)](){const _0xfae8ca=a290_0x20f379,_0x1558ea=new salesforce_1[(_0xfae8ca(0x175))]({'instance':this[_0xfae8ca(0x13c)],'objectName':constants_1[_0xfae8ca(0x162)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this[_0xfae8ca(0x159)]});return _0x1558ea[_0xfae8ca(0x167)](this[_0xfae8ca(0x132)]);}['deployOrgComponents'](){const _0xcc3e5b=a290_0x20f379,_0x58eebb=new salesforce_1[(_0xcc3e5b(0x157))]({'instance':this[_0xcc3e5b(0x13c)],'objectName':constants_1[_0xcc3e5b(0x160)],'api':this['apiVersion'],'allOrNone':![],'externalIdField':'Id'});return _0x58eebb[_0xcc3e5b(0x167)]({'records':this[_0xcc3e5b(0x14d)]});}async[a290_0x20f379(0x13f)](_0x3fd16f){const _0x2779a9=a290_0x20f379;for(const {success:_0x4f423d,error:_0x43f112}of _0x3fd16f){if(_0x4f423d){this[_0x2779a9(0x147)]++;continue;}_0x43f112&&this[_0x2779a9(0x15d)][_0x2779a9(0x171)](_0x43f112);}}[a290_0x20f379(0x139)](_0x11ac1b){const _0x4938a7=a290_0x20f379;return _0x11ac1b+this['binaryRecordsSizeChunk']>=salesforce_1[_0x4938a7(0x12a)][_0x4938a7(0x14e)]||this[_0x4938a7(0x132)][_0x4938a7(0x155)][_0x4938a7(0x16f)]===MAX_COMPOSITE_CHUNK_COUNT;}[a290_0x20f379(0x13b)](){const _0x156eef=a290_0x20f379;this[_0x156eef(0x152)]=0x0,this[_0x156eef(0x132)]={'records':[],'binary':[]},this[_0x156eef(0x14d)]=[];}['populateAttachmentId'](_0x469de1){const _0x54e838=a290_0x20f379;for(const _0x1a6d1e in _0x469de1){this[_0x54e838(0x14d)][_0x1a6d1e][ATTACHMENT_FIELD_NAME]=_0x469de1[_0x1a6d1e]['id'];}}async['addAttachmentToChunk'](_0x457dd6,_0x346eb1){const _0x519462=a290_0x20f379,{listMetadataItem:_0x5711fd,sourceMemberRecord:_0x212fcb}=_0x457dd6,_0x5e77cb={'attributes':{'type':constants_1[_0x519462(0x162)],'binaryPartName':_0x5711fd['fullName'],'binaryPartNameAlias':constants_1[_0x519462(0x16e)]},'Id':_0x212fcb['attachmentId'],'Name':_0x5711fd['fullName'],'Description':_0x5711fd[_0x519462(0x12b)],'ContentType':CONTENT_TYPE,'ParentId':this[_0x519462(0x170)],'Body':_0x5711fd[_0x519462(0x174)]},_0x19919a={'binaryFieldName':constants_1[_0x519462(0x16e)],'name':_0x5711fd[_0x519462(0x174)],'value':stream_1[_0x519462(0x13a)][_0x519462(0x15e)](_0x346eb1)};this[_0x519462(0x132)]['records'][_0x519462(0x148)](_0x5e77cb),this['attachmentsToDeployChunk']['binary'][_0x519462(0x148)](_0x19919a);}[a290_0x20f379(0x146)](_0x19fd19){const _0x341bd6=a290_0x20f379,_0x365032=new jszip_1['default']();for(const _0x113382 in _0x19fd19){_0x365032[_0x341bd6(0x16c)](_0x113382,_0x19fd19[_0x113382]);}return _0x365032['generateAsync']({'type':_0x341bd6(0x133)});}[a290_0x20f379(0x142)](_0x57098d,_0x145d4b){const _0x36e98c=a290_0x20f379,_0x23abc3={'attributes':{'type':constants_1[_0x36e98c(0x160)]},'Id':_0x145d4b[_0x36e98c(0x16a)],[constants_2[_0x36e98c(0x14a)]+_0x36e98c(0x163)]:_0x145d4b[_0x36e98c(0x176)],[constants_2[_0x36e98c(0x14a)]+_0x36e98c(0x13d)]:_0x145d4b['revisionCounter'],[constants_2[_0x36e98c(0x14a)]+_0x36e98c(0x145)]:_0x145d4b[_0x36e98c(0x131)],[constants_2[_0x36e98c(0x14a)]+'Last_Updated_By__c']:_0x145d4b[_0x36e98c(0x173)],[constants_2['FLOSUM_NAMESPACE']+_0x36e98c(0x165)]:_0x57098d[_0x36e98c(0x174)],[constants_2['FLOSUM_NAMESPACE']+'Name__c']:_0x57098d[_0x36e98c(0x174)],[constants_2[_0x36e98c(0x14a)]+'Component_Type__c']:_0x57098d[_0x36e98c(0x12b)],[constants_2[_0x36e98c(0x14a)]+'Label__c']:_0x57098d[_0x36e98c(0x128)],[constants_2['FLOSUM_NAMESPACE']+_0x36e98c(0x166)]:constants_1[_0x36e98c(0x154)][_0x36e98c(0x15f)](_0x57098d[_0x36e98c(0x12b)])||null,[constants_2[_0x36e98c(0x14a)]+_0x36e98c(0x130)]:!![],[constants_2[_0x36e98c(0x14a)]+_0x36e98c(0x150)]:this[_0x36e98c(0x170)],[constants_2['FLOSUM_NAMESPACE']+_0x36e98c(0x135)]:this[_0x36e98c(0x153)],[constants_2[_0x36e98c(0x14a)]+'Status__c']:_0x36e98c(0x15c)};this[_0x36e98c(0x14d)][_0x36e98c(0x148)](_0x23abc3);}async[a290_0x20f379(0x15a)](_0x195a13,_0x1cf6e5,_0x6f8301){const _0x1db7d3=a290_0x20f379;try{const {listMetadataItem:_0x76a4ba,sourceMemberRecord:_0x2394a0,files:_0x2a613a}=_0x195a13,_0x25dad4=await this[_0x1db7d3(0x146)](_0x2a613a),_0x8cc183=Buffer[_0x1db7d3(0x12e)](_0x25dad4);this[_0x1db7d3(0x139)](_0x8cc183)&&await this[_0x1db7d3(0x13e)](),this[_0x1db7d3(0x152)]+=_0x8cc183,await this[_0x1db7d3(0x143)](_0x195a13,_0x25dad4),this['addOrgComponentToChunk'](_0x76a4ba,_0x2394a0),_0x6f8301();}catch(_0x5da12a){_0x6f8301(_0x5da12a);}}async[a290_0x20f379(0x12c)](_0x804e9a){const _0x40d518=a290_0x20f379;try{this['attachmentsToDeployChunk']['records'][_0x40d518(0x16f)]&&this[_0x40d518(0x14d)][_0x40d518(0x16f)]&&await this['deploy'](),this[_0x40d518(0x15d)]['log']('Process\x20completed\x20for\x20'+this[_0x40d518(0x147)]+_0x40d518(0x141)),await this[_0x40d518(0x15d)]['update'](),_0x804e9a();}catch(_0x26e34d){_0x804e9a(_0x26e34d);}}}exports['default']=ComponentsDeployer;