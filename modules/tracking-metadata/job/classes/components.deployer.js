const a338_0x5876c5=a338_0x7f8c;(function(_0x23d486,_0x5c297e){const _0x68afe3=a338_0x7f8c,_0x22c71c=_0x23d486();while(!![]){try{const _0xe2f936=-parseInt(_0x68afe3(0x1f1))/0x1+-parseInt(_0x68afe3(0x200))/0x2*(-parseInt(_0x68afe3(0x1e8))/0x3)+parseInt(_0x68afe3(0x1d7))/0x4+-parseInt(_0x68afe3(0x1ff))/0x5*(-parseInt(_0x68afe3(0x209))/0x6)+parseInt(_0x68afe3(0x1d8))/0x7+parseInt(_0x68afe3(0x1c9))/0x8+-parseInt(_0x68afe3(0x1f5))/0x9*(parseInt(_0x68afe3(0x1df))/0xa);if(_0xe2f936===_0x5c297e)break;else _0x22c71c['push'](_0x22c71c['shift']());}catch(_0x514461){_0x22c71c['push'](_0x22c71c['shift']());}}}(a338_0x1cbb,0x73f16));const a338_0xef873d=(function(){let _0x3285aa=!![];return function(_0x2c5018,_0x4a1ca1){const _0x4d5d0a=_0x3285aa?function(){const _0x526a2e=a338_0x7f8c;if(_0x4a1ca1){const _0x5cb15b=_0x4a1ca1[_0x526a2e(0x1e3)](_0x2c5018,arguments);return _0x4a1ca1=null,_0x5cb15b;}}:function(){};return _0x3285aa=![],_0x4d5d0a;};}()),a338_0x4ca93c=a338_0xef873d(this,function(){const _0x2c2eda=a338_0x7f8c;return a338_0x4ca93c[_0x2c2eda(0x214)]()[_0x2c2eda(0x206)]('(((.+)+)+)+$')[_0x2c2eda(0x214)]()['constructor'](a338_0x4ca93c)[_0x2c2eda(0x206)]('(((.+)+)+)+$');});function a338_0x1cbb(){const _0x172f28=['13448090ULoquN','Revision_Counter__c','isReachedMaxChunk','MAX_BODY_SIZE','apply','attachmentId','ATTACHMENT_OBJECT_NAME','jszip','../../constants','472182xHwcOz','addOrgComponentToChunk','apiVersion','__importDefault','then','file','_final','RestSimpleDeployData','Process\x20completed\x20for\x20','153811zCwYVE','update','execute','default','9MPhTtw','_write','componentId','\x20components','CompositeBinaryDeployData','successDeployedCounter','API_Name__c','ComponentsDeployer','handleDeployResult','log','613055pzpkBw','4cRlhRY','FLOSUM_NAMESPACE','__esModule','deployAttachments','byteLength','trackingSettingId','search','records','from','6uXGNOY','orgComponentsToDeployChunk','instance','deploy','Is_Retrieved__c','resetChunks','createZip','METADATA_FOLDER_MAP','Tracking_Setting__c','OrganisationName__c','fullName','toString','Readable','logger','Retrieved','Is_Deleted__c','BINARY_FIELD_NAME','nodebuffer','4859776Twgybc','changedBy','binary','revisionCounter','Source_Member_Id__c','has','Folder__c','addAttachmentToChunk','push','attachmentsToDeployChunk','length','ORG_COMPONENT_OBJECT_NAME','Writable','targetOrgId','2112448UsKCVF','2803773SlzIPn','Label__c','binaryRecordsSizeChunk','Attachment_ID__c','type','deployOrgComponents','fileName'];a338_0x1cbb=function(){return _0x172f28;};return a338_0x1cbb();}a338_0x4ca93c();'use strict';var __importDefault=this&&this[a338_0x5876c5(0x1eb)]||function(_0x460fc0){return _0x460fc0&&_0x460fc0['__esModule']?_0x460fc0:{'default':_0x460fc0};};Object['defineProperty'](exports,a338_0x5876c5(0x202),{'value':!![]}),exports['ComponentsDeployer']=void 0x0;const salesforce_1=require('@flosum/salesforce'),constants_1=require(a338_0x5876c5(0x1e7)),stream_1=require('stream'),jszip_1=__importDefault(require(a338_0x5876c5(0x1e6))),constants_2=require('../../../../constants'),MAX_COMPOSITE_CHUNK_COUNT=0xc8,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a338_0x5876c5(0x201)]+a338_0x5876c5(0x1db),CONTENT_TYPE='application/zip';class ComponentsDeployer extends stream_1[a338_0x5876c5(0x1d5)]{constructor({apiVersion:_0x47e66a,instance:_0x5aa8ba,logger:_0x5344f1,targetOrgId:_0x5234e9,trackingSettingId:_0x749be6}){const _0x383919=a338_0x5876c5;super({'objectMode':!![]}),this[_0x383919(0x1d2)]={'records':[],'binary':[]},this[_0x383919(0x1da)]=0x0,this[_0x383919(0x20a)]=[],this[_0x383919(0x1fa)]=0x0,this['apiVersion']=_0x47e66a,this['instance']=_0x5aa8ba,this[_0x383919(0x216)]=_0x5344f1,this[_0x383919(0x1d6)]=_0x5234e9,this['trackingSettingId']=_0x749be6;}async[a338_0x5876c5(0x20c)](){const _0xb90ca8=a338_0x5876c5;await this[_0xb90ca8(0x203)]()[_0xb90ca8(0x1ec)](_0x418f25=>this['populateAttachmentId'](_0x418f25))[_0xb90ca8(0x1ec)](()=>this[_0xb90ca8(0x1dd)]())[_0xb90ca8(0x1ec)](_0x55da25=>this[_0xb90ca8(0x1fd)](_0x55da25)),this[_0xb90ca8(0x20e)]();}[a338_0x5876c5(0x203)](){const _0x131ce9=a338_0x5876c5,_0x2c08ae=new salesforce_1[(_0x131ce9(0x1f9))]({'instance':this[_0x131ce9(0x20b)],'objectName':constants_1[_0x131ce9(0x1e5)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this['apiVersion']});return _0x2c08ae[_0x131ce9(0x1f3)](this['attachmentsToDeployChunk']);}['deployOrgComponents'](){const _0x4d7adb=a338_0x5876c5,_0x22e13a=new salesforce_1[(_0x4d7adb(0x1ef))]({'instance':this[_0x4d7adb(0x20b)],'objectName':constants_1[_0x4d7adb(0x1d4)],'api':this[_0x4d7adb(0x1ea)],'allOrNone':![],'externalIdField':'Id'});return _0x22e13a[_0x4d7adb(0x1f3)]({'records':this['orgComponentsToDeployChunk']});}async[a338_0x5876c5(0x1fd)](_0x4151d4){const _0x3ab755=a338_0x5876c5;for(const {success:_0x431d43,error:_0x2edb13}of _0x4151d4){if(_0x431d43){this[_0x3ab755(0x1fa)]++;continue;}_0x2edb13&&this[_0x3ab755(0x216)]['error'](_0x2edb13);}}['isReachedMaxChunk'](_0x499d5b){const _0x78b3a7=a338_0x5876c5;return _0x499d5b+this[_0x78b3a7(0x1da)]>=salesforce_1['CompositeConstants'][_0x78b3a7(0x1e2)]||this[_0x78b3a7(0x1d2)]['records']['length']===MAX_COMPOSITE_CHUNK_COUNT;}['resetChunks'](){const _0x174ff4=a338_0x5876c5;this[_0x174ff4(0x1da)]=0x0,this[_0x174ff4(0x1d2)]={'records':[],'binary':[]},this['orgComponentsToDeployChunk']=[];}['populateAttachmentId'](_0xdf7344){for(const _0x4578b4 in _0xdf7344){this['orgComponentsToDeployChunk'][_0x4578b4][ATTACHMENT_FIELD_NAME]=_0xdf7344[_0x4578b4]['id'];}}async[a338_0x5876c5(0x1d0)](_0x4db97f,_0x58b562){const _0x935f95=a338_0x5876c5,{listMetadataItem:_0x5c65ee,sourceMemberRecord:_0x1c487f}=_0x4db97f,_0x1bb66e={'attributes':{'type':constants_1['ATTACHMENT_OBJECT_NAME'],'binaryPartName':_0x5c65ee[_0x935f95(0x213)],'binaryPartNameAlias':constants_1[_0x935f95(0x1c7)]},'Id':_0x1c487f[_0x935f95(0x1e4)],'Name':_0x5c65ee[_0x935f95(0x213)],'Description':_0x5c65ee[_0x935f95(0x1dc)],'ContentType':CONTENT_TYPE,'ParentId':this['targetOrgId'],'Body':_0x5c65ee[_0x935f95(0x213)]},_0x1dd482={'binaryFieldName':constants_1[_0x935f95(0x1c7)],'name':_0x5c65ee[_0x935f95(0x213)],'value':stream_1[_0x935f95(0x215)][_0x935f95(0x208)](_0x58b562)};this[_0x935f95(0x1d2)][_0x935f95(0x207)][_0x935f95(0x1d1)](_0x1bb66e),this[_0x935f95(0x1d2)][_0x935f95(0x1cb)][_0x935f95(0x1d1)](_0x1dd482);}[a338_0x5876c5(0x20f)](_0x4463f6){const _0x4e1759=a338_0x5876c5,_0x5152f8=new jszip_1[(_0x4e1759(0x1f4))]();for(const _0x396fbb in _0x4463f6){_0x5152f8[_0x4e1759(0x1ed)](_0x396fbb,_0x4463f6[_0x396fbb]);}return _0x5152f8['generateAsync']({'type':_0x4e1759(0x1c8)});}[a338_0x5876c5(0x1e9)](_0x4eee82,_0xc6659f){const _0x59353e=a338_0x5876c5,_0x516fd0={'attributes':{'type':constants_1[_0x59353e(0x1d4)]},'Id':_0xc6659f[_0x59353e(0x1f7)],[constants_2[_0x59353e(0x201)]+_0x59353e(0x1c6)]:_0xc6659f['isNameObsolete'],[constants_2['FLOSUM_NAMESPACE']+_0x59353e(0x1e0)]:_0xc6659f[_0x59353e(0x1cc)],[constants_2[_0x59353e(0x201)]+_0x59353e(0x1cd)]:_0xc6659f['sourceMemberId'],[constants_2[_0x59353e(0x201)]+'Last_Updated_By__c']:_0xc6659f[_0x59353e(0x1ca)],[constants_2[_0x59353e(0x201)]+_0x59353e(0x1fb)]:_0x4eee82['fullName'],[constants_2[_0x59353e(0x201)]+'Name__c']:_0x4eee82[_0x59353e(0x213)],[constants_2['FLOSUM_NAMESPACE']+'Component_Type__c']:_0x4eee82[_0x59353e(0x1dc)],[constants_2['FLOSUM_NAMESPACE']+_0x59353e(0x1d9)]:_0x4eee82[_0x59353e(0x1de)],[constants_2[_0x59353e(0x201)]+_0x59353e(0x1cf)]:constants_1[_0x59353e(0x210)][_0x59353e(0x1ce)](_0x4eee82[_0x59353e(0x1dc)])||null,[constants_2[_0x59353e(0x201)]+_0x59353e(0x20d)]:!![],[constants_2[_0x59353e(0x201)]+_0x59353e(0x212)]:this['targetOrgId'],[constants_2[_0x59353e(0x201)]+_0x59353e(0x211)]:this[_0x59353e(0x205)],[constants_2['FLOSUM_NAMESPACE']+'Status__c']:_0x59353e(0x217)};this[_0x59353e(0x20a)][_0x59353e(0x1d1)](_0x516fd0);}async[a338_0x5876c5(0x1f6)](_0x5662bb,_0x548e37,_0x33f5ab){const _0x586265=a338_0x5876c5;try{const {listMetadataItem:_0x413b4a,sourceMemberRecord:_0x343010,files:_0x6dda83}=_0x5662bb,_0x1eafee=await this[_0x586265(0x20f)](_0x6dda83),_0x457334=Buffer[_0x586265(0x204)](_0x1eafee);this[_0x586265(0x1e1)](_0x457334)&&await this[_0x586265(0x20c)](),this[_0x586265(0x1da)]+=_0x457334,await this['addAttachmentToChunk'](_0x5662bb,_0x1eafee),this[_0x586265(0x1e9)](_0x413b4a,_0x343010),_0x33f5ab();}catch(_0x14f2ac){_0x33f5ab(_0x14f2ac);}}async[a338_0x5876c5(0x1ee)](_0x2259a6){const _0x18efb7=a338_0x5876c5;try{this[_0x18efb7(0x1d2)][_0x18efb7(0x207)][_0x18efb7(0x1d3)]&&this[_0x18efb7(0x20a)][_0x18efb7(0x1d3)]&&await this['deploy'](),this['logger'][_0x18efb7(0x1fe)](_0x18efb7(0x1f0)+this['successDeployedCounter']+_0x18efb7(0x1f8)),await this[_0x18efb7(0x216)][_0x18efb7(0x1f2)](),_0x2259a6();}catch(_0x54e2af){_0x2259a6(_0x54e2af);}}}function a338_0x7f8c(_0x1b7e6f,_0x51f182){const _0x32b0ff=a338_0x1cbb();return a338_0x7f8c=function(_0x4ca93c,_0xef873d){_0x4ca93c=_0x4ca93c-0x1c6;let _0x1cbb98=_0x32b0ff[_0x4ca93c];return _0x1cbb98;},a338_0x7f8c(_0x1b7e6f,_0x51f182);}exports[a338_0x5876c5(0x1fc)]=ComponentsDeployer;