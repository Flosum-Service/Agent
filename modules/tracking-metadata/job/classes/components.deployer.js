const a340_0x25d8d5=a340_0x39c8;function a340_0x28b6(){const _0x1d43f6=['targetOrgId','changedBy','Readable','addAttachmentToChunk','log','records','_final','__importDefault','isReachedMaxChunk','populateAttachmentId','file','constructor','2128VZonwb','Revision_Counter__c','CompositeBinaryDeployData','Component\x20too\x20large.\x20Type:\x20','ComponentsDeployer','3256206yiRxUH','trackingSettingId','jszip','Name__c','createZip','ORG_COMPONENT_OBJECT_NAME','execute','nodebuffer','Is_Deleted__c','update','204bOaTVw','BINARY_FIELD_NAME','resetChunks','API_Name__c','Folder__c','then','deployAttachments','Source_Member_Id__c','deploy','Last_Updated_By__c','Label__c','../../../../constants','\x20components','generateAsync','fileName','instance','binary','RestSimpleDeployData','apiVersion','has','243625AUjdha','addOrgComponentToChunk','Process\x20completed\x20for\x20','Too\x20Large','attachmentsToDeployChunk','ATTACHMENT_OBJECT_NAME','orgComponentsToDeployChunk','isNameObsolete','from',',\x20Name:\x20','push','toString','Component_Type__c','deployOrgComponents','type','fullName','(((.+)+)+)+$','successDeployedCounter','logger','error','attachmentId','257967EBAgJU','__esModule','125898FrVnYV','binaryRecordsSizeChunk','../../constants','3025778RhhFcp','MAX_BODY_SIZE','_write','byteLength','13518RZXxwO','Retrieved','handleDeployResult','length','31685dczKiF','apply','Is_Retrieved__c','sourceMemberId','FLOSUM_NAMESPACE','OrganisationName__c'];a340_0x28b6=function(){return _0x1d43f6;};return a340_0x28b6();}(function(_0x3f023a,_0x16b6cb){const _0x5a3ca7=a340_0x39c8,_0x38efa0=_0x3f023a();while(!![]){try{const _0x4ce7f7=-parseInt(_0x5a3ca7(0x198))/0x1+-parseInt(_0x5a3ca7(0x1af))/0x2+-parseInt(_0x5a3ca7(0x1ad))/0x3+parseInt(_0x5a3ca7(0x184))/0x4*(parseInt(_0x5a3ca7(0x1ba))/0x5)+parseInt(_0x5a3ca7(0x17a))/0x6+-parseInt(_0x5a3ca7(0x1b2))/0x7+parseInt(_0x5a3ca7(0x175))/0x8*(parseInt(_0x5a3ca7(0x1b6))/0x9);if(_0x4ce7f7===_0x16b6cb)break;else _0x38efa0['push'](_0x38efa0['shift']());}catch(_0x16660e){_0x38efa0['push'](_0x38efa0['shift']());}}}(a340_0x28b6,0x6b91b));const a340_0x3370e8=(function(){let _0x5abf6e=!![];return function(_0x232171,_0x7e53f8){const _0x108d40=_0x5abf6e?function(){const _0x436c46=a340_0x39c8;if(_0x7e53f8){const _0x28e4d9=_0x7e53f8[_0x436c46(0x1bb)](_0x232171,arguments);return _0x7e53f8=null,_0x28e4d9;}}:function(){};return _0x5abf6e=![],_0x108d40;};}()),a340_0x1d439a=a340_0x3370e8(this,function(){const _0x528a2c=a340_0x39c8;return a340_0x1d439a['toString']()['search']('(((.+)+)+)+$')[_0x528a2c(0x1a3)]()[_0x528a2c(0x174)](a340_0x1d439a)['search'](_0x528a2c(0x1a8));});a340_0x1d439a();function a340_0x39c8(_0xa7024f,_0x47a0be){const _0x1bfdfa=a340_0x28b6();return a340_0x39c8=function(_0x1d439a,_0x3370e8){_0x1d439a=_0x1d439a-0x16c;let _0x28b6fa=_0x1bfdfa[_0x1d439a];return _0x28b6fa;},a340_0x39c8(_0xa7024f,_0x47a0be);}'use strict';var __importDefault=this&&this[a340_0x25d8d5(0x170)]||function(_0x20b0f9){const _0x23699a=a340_0x25d8d5;return _0x20b0f9&&_0x20b0f9[_0x23699a(0x1ae)]?_0x20b0f9:{'default':_0x20b0f9};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a340_0x25d8d5(0x179)]=void 0x0;const salesforce_1=require('@flosum/salesforce'),constants_1=require(a340_0x25d8d5(0x1b1)),stream_1=require('stream'),jszip_1=__importDefault(require(a340_0x25d8d5(0x17c))),constants_2=require(a340_0x25d8d5(0x18f)),MAX_COMPOSITE_CHUNK_COUNT=0xc8,MAX_SINGLE_FILE_SIZE=0x5a06e0,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a340_0x25d8d5(0x1be)]+'Attachment_ID__c',CONTENT_TYPE='application/zip';class ComponentsDeployer extends stream_1['Writable']{constructor({apiVersion:_0x3c9d5e,instance:_0x2dec62,logger:_0x45f389,targetOrgId:_0xd3b932,trackingSettingId:_0x1722c3}){const _0x192760=a340_0x25d8d5;super({'objectMode':!![]}),this[_0x192760(0x19c)]={'records':[],'binary':[]},this[_0x192760(0x1b0)]=0x0,this[_0x192760(0x19e)]=[],this[_0x192760(0x1a9)]=0x0,this[_0x192760(0x196)]=_0x3c9d5e,this[_0x192760(0x193)]=_0x2dec62,this['logger']=_0x45f389,this['targetOrgId']=_0xd3b932,this[_0x192760(0x17b)]=_0x1722c3;}async[a340_0x25d8d5(0x18c)](){const _0x548e74=a340_0x25d8d5;await this[_0x548e74(0x18a)]()[_0x548e74(0x189)](_0x2584a0=>this[_0x548e74(0x172)](_0x2584a0))[_0x548e74(0x189)](()=>this[_0x548e74(0x1a5)]())[_0x548e74(0x189)](_0x2d0b85=>this['handleDeployResult'](_0x2d0b85)),this[_0x548e74(0x186)]();}[a340_0x25d8d5(0x18a)](){const _0x46cb58=a340_0x25d8d5,_0x1d754e=new salesforce_1[(_0x46cb58(0x177))]({'instance':this[_0x46cb58(0x193)],'objectName':constants_1[_0x46cb58(0x19d)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this[_0x46cb58(0x196)]});return _0x1d754e['execute'](this[_0x46cb58(0x19c)]);}[a340_0x25d8d5(0x1a5)](){const _0x2033e2=a340_0x25d8d5,_0x5c3f4c=new salesforce_1[(_0x2033e2(0x195))]({'instance':this[_0x2033e2(0x193)],'objectName':constants_1[_0x2033e2(0x17f)],'api':this[_0x2033e2(0x196)],'allOrNone':![],'externalIdField':'Id'});return _0x5c3f4c[_0x2033e2(0x180)]({'records':this['orgComponentsToDeployChunk']});}async[a340_0x25d8d5(0x1b8)](_0xa3bfdc){const _0x1e969d=a340_0x25d8d5;for(const {success:_0x344512,error:_0x5310a8}of _0xa3bfdc){if(_0x344512){this[_0x1e969d(0x1a9)]++;continue;}_0x5310a8&&this[_0x1e969d(0x1aa)][_0x1e969d(0x1ab)](_0x5310a8);}}[a340_0x25d8d5(0x171)](_0x315220){const _0x30101f=a340_0x25d8d5;return _0x315220+this[_0x30101f(0x1b0)]>=salesforce_1['CompositeConstants'][_0x30101f(0x1b3)]||this[_0x30101f(0x19c)][_0x30101f(0x16e)][_0x30101f(0x1b9)]===MAX_COMPOSITE_CHUNK_COUNT;}[a340_0x25d8d5(0x186)](){const _0x176b81=a340_0x25d8d5;this[_0x176b81(0x1b0)]=0x0,this['attachmentsToDeployChunk']={'records':[],'binary':[]},this[_0x176b81(0x19e)]=[];}[a340_0x25d8d5(0x172)](_0x1cd37a){const _0x56dd72=a340_0x25d8d5;for(const _0x2a2dba in _0x1cd37a){this[_0x56dd72(0x19e)][_0x2a2dba][ATTACHMENT_FIELD_NAME]=_0x1cd37a[_0x2a2dba]['id'];}}async[a340_0x25d8d5(0x16c)](_0x454c5c,_0x8acbc8){const _0x5b515f=a340_0x25d8d5,{listMetadataItem:_0x20a52e,sourceMemberRecord:_0x2211d5}=_0x454c5c,_0x117a69={'attributes':{'type':constants_1[_0x5b515f(0x19d)],'binaryPartName':_0x20a52e[_0x5b515f(0x1a7)],'binaryPartNameAlias':constants_1[_0x5b515f(0x185)]},'Id':_0x2211d5[_0x5b515f(0x1ac)],'Name':_0x20a52e[_0x5b515f(0x1a7)],'Description':_0x20a52e[_0x5b515f(0x1a6)],'ContentType':CONTENT_TYPE,'ParentId':this[_0x5b515f(0x1c0)],'Body':_0x20a52e['fullName']},_0x5013a9={'binaryFieldName':constants_1[_0x5b515f(0x185)],'name':_0x20a52e['fullName'],'value':stream_1[_0x5b515f(0x1c2)][_0x5b515f(0x1a0)](_0x8acbc8)};this[_0x5b515f(0x19c)][_0x5b515f(0x16e)][_0x5b515f(0x1a2)](_0x117a69),this['attachmentsToDeployChunk'][_0x5b515f(0x194)]['push'](_0x5013a9);}[a340_0x25d8d5(0x17e)](_0x58a3f0){const _0x4cf603=a340_0x25d8d5,_0x5cab5f=new jszip_1['default']();for(const _0x17ac55 in _0x58a3f0){_0x5cab5f[_0x4cf603(0x173)](_0x17ac55,_0x58a3f0[_0x17ac55]);}return _0x5cab5f[_0x4cf603(0x191)]({'type':_0x4cf603(0x181)});}[a340_0x25d8d5(0x199)](_0x4e198e,_0x35a706,_0x51b335){const _0x5f1552=a340_0x25d8d5,_0x48e712={'attributes':{'type':constants_1[_0x5f1552(0x17f)]},'Id':_0x35a706['componentId'],[constants_2['FLOSUM_NAMESPACE']+_0x5f1552(0x182)]:_0x35a706[_0x5f1552(0x19f)],[constants_2[_0x5f1552(0x1be)]+_0x5f1552(0x176)]:_0x35a706['revisionCounter'],[constants_2[_0x5f1552(0x1be)]+_0x5f1552(0x18b)]:_0x35a706[_0x5f1552(0x1bd)],[constants_2[_0x5f1552(0x1be)]+_0x5f1552(0x18d)]:_0x35a706[_0x5f1552(0x1c1)],[constants_2['FLOSUM_NAMESPACE']+_0x5f1552(0x187)]:_0x4e198e['fullName'],[constants_2[_0x5f1552(0x1be)]+_0x5f1552(0x17d)]:_0x4e198e['fullName'],[constants_2['FLOSUM_NAMESPACE']+_0x5f1552(0x1a4)]:_0x4e198e[_0x5f1552(0x1a6)],[constants_2[_0x5f1552(0x1be)]+_0x5f1552(0x18e)]:_0x4e198e[_0x5f1552(0x192)],[constants_2[_0x5f1552(0x1be)]+_0x5f1552(0x188)]:constants_1['METADATA_FOLDER_MAP'][_0x5f1552(0x197)](_0x4e198e[_0x5f1552(0x1a6)])||null,[constants_2[_0x5f1552(0x1be)]+_0x5f1552(0x1bc)]:!![],[constants_2['FLOSUM_NAMESPACE']+_0x5f1552(0x1bf)]:this[_0x5f1552(0x1c0)],[constants_2['FLOSUM_NAMESPACE']+'Tracking_Setting__c']:this[_0x5f1552(0x17b)],[constants_2[_0x5f1552(0x1be)]+'Status__c']:_0x51b335>MAX_SINGLE_FILE_SIZE?_0x5f1552(0x19b):_0x5f1552(0x1b7)};_0x51b335>MAX_SINGLE_FILE_SIZE&&this[_0x5f1552(0x1aa)][_0x5f1552(0x16d)](_0x5f1552(0x178)+_0x4e198e[_0x5f1552(0x1a6)]+_0x5f1552(0x1a1)+_0x4e198e[_0x5f1552(0x1a7)]),this[_0x5f1552(0x19e)][_0x5f1552(0x1a2)](_0x48e712);}async[a340_0x25d8d5(0x1b4)](_0x194971,_0x567b9b,_0x10ed2e){const _0x9ba0f7=a340_0x25d8d5;try{const {listMetadataItem:_0x1f69e3,sourceMemberRecord:_0x199ca0,files:_0x3255c8}=_0x194971,_0x89eb37=await this[_0x9ba0f7(0x17e)](_0x3255c8),_0x475cb8=Buffer[_0x9ba0f7(0x1b5)](_0x89eb37);this[_0x9ba0f7(0x171)](_0x475cb8)&&await this[_0x9ba0f7(0x18c)](),this[_0x9ba0f7(0x1b0)]+=_0x475cb8,await this[_0x9ba0f7(0x16c)](_0x194971,_0x89eb37),this[_0x9ba0f7(0x199)](_0x1f69e3,_0x199ca0,_0x89eb37['length']),_0x10ed2e();}catch(_0x58d6d6){_0x10ed2e(_0x58d6d6);}}async[a340_0x25d8d5(0x16f)](_0x1b8fad){const _0x695797=a340_0x25d8d5;try{this[_0x695797(0x19c)][_0x695797(0x16e)][_0x695797(0x1b9)]&&this[_0x695797(0x19e)]['length']&&await this[_0x695797(0x18c)](),this['logger'][_0x695797(0x16d)](_0x695797(0x19a)+this[_0x695797(0x1a9)]+_0x695797(0x190)),await this[_0x695797(0x1aa)][_0x695797(0x183)](),_0x1b8fad();}catch(_0x3d781b){_0x1b8fad(_0x3d781b);}}}exports[a340_0x25d8d5(0x179)]=ComponentsDeployer;