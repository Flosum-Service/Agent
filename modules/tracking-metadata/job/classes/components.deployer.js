const a311_0x495a57=a311_0x5cef;function a311_0x433b(){const _0x166610=['CompositeConstants','6055011dYwoyJ','ORG_COMPONENT_OBJECT_NAME','ComponentsDeployer','Label__c','__importDefault','update','createZip','default','Attachment_ID__c','from','Status__c','METADATA_FOLDER_MAP','../../../../constants','nodebuffer','binaryRecordsSizeChunk','ATTACHMENT_OBJECT_NAME','apply','CompositeBinaryDeployData','BINARY_FIELD_NAME','isNameObsolete','push','Last_Updated_By__c','attachmentId','1521070XzmOCk','1687273nQdhBg','then','330884ZrxnJJ','_final','populateAttachmentId','generateAsync','has','(((.+)+)+)+$','@flosum/salesforce','successDeployedCounter','componentId','file','deploy','targetOrgId','type','Writable','Folder__c','6240iAGzlQ','1022302AIvrCL','1zwKYws','Revision_Counter__c','isReachedMaxChunk','834900ehJHvk','execute','__esModule','Name__c','apiVersion','attachmentsToDeployChunk','RestSimpleDeployData','Component_Type__c','changedBy','MAX_BODY_SIZE','defineProperty','instance','addAttachmentToChunk','application/zip','8uibNla','OrganisationName__c','resetChunks','Retrieved','addOrgComponentToChunk','handleDeployResult','15LZvCut','search','deployOrgComponents','logger','Is_Deleted__c','fullName','37763nGJkAn','toString','binary','Readable','API_Name__c','length','Process\x20completed\x20for\x20','deployAttachments','\x20components','fileName','FLOSUM_NAMESPACE','error','orgComponentsToDeployChunk'];a311_0x433b=function(){return _0x166610;};return a311_0x433b();}(function(_0x4eb6c3,_0x3549dc){const _0x318e5a=a311_0x5cef,_0x345501=_0x4eb6c3();while(!![]){try{const _0x3a73db=parseInt(_0x318e5a(0x1d7))/0x1*(-parseInt(_0x318e5a(0x1d6))/0x2)+-parseInt(_0x318e5a(0x1ee))/0x3*(parseInt(_0x318e5a(0x1c6))/0x4)+parseInt(_0x318e5a(0x1c3))/0x5+-parseInt(_0x318e5a(0x1da))/0x6+parseInt(_0x318e5a(0x1c4))/0x7*(-parseInt(_0x318e5a(0x1e8))/0x8)+-parseInt(_0x318e5a(0x1ac))/0x9+-parseInt(_0x318e5a(0x1d5))/0xa*(-parseInt(_0x318e5a(0x1f4))/0xb);if(_0x3a73db===_0x3549dc)break;else _0x345501['push'](_0x345501['shift']());}catch(_0x38de31){_0x345501['push'](_0x345501['shift']());}}}(a311_0x433b,0x726ca));const a311_0x38f3ca=(function(){let _0x3cc731=!![];return function(_0x2518d2,_0x3b9a86){const _0x17cb70=_0x3cc731?function(){const _0x3d18d8=a311_0x5cef;if(_0x3b9a86){const _0x526253=_0x3b9a86[_0x3d18d8(0x1bc)](_0x2518d2,arguments);return _0x3b9a86=null,_0x526253;}}:function(){};return _0x3cc731=![],_0x17cb70;};}()),a311_0xc903a3=a311_0x38f3ca(this,function(){const _0x123700=a311_0x5cef;return a311_0xc903a3[_0x123700(0x1f5)]()[_0x123700(0x1ef)](_0x123700(0x1cb))[_0x123700(0x1f5)]()['constructor'](a311_0xc903a3)['search']('(((.+)+)+)+$');});a311_0xc903a3();'use strict';function a311_0x5cef(_0x6084d9,_0x4aea8c){const _0x2a826c=a311_0x433b();return a311_0x5cef=function(_0xc903a3,_0x38f3ca){_0xc903a3=_0xc903a3-0x1a7;let _0x433bf0=_0x2a826c[_0xc903a3];return _0x433bf0;},a311_0x5cef(_0x6084d9,_0x4aea8c);}var __importDefault=this&&this[a311_0x495a57(0x1b0)]||function(_0xdef8c1){const _0x309a60=a311_0x495a57;return _0xdef8c1&&_0xdef8c1[_0x309a60(0x1dc)]?_0xdef8c1:{'default':_0xdef8c1};};Object[a311_0x495a57(0x1e4)](exports,'__esModule',{'value':!![]}),exports[a311_0x495a57(0x1ae)]=void 0x0;const salesforce_1=require(a311_0x495a57(0x1cc)),constants_1=require('../../constants'),stream_1=require('stream'),jszip_1=__importDefault(require('jszip')),constants_2=require(a311_0x495a57(0x1b8)),MAX_COMPOSITE_CHUNK_COUNT=0xc8,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a311_0x495a57(0x1a8)]+a311_0x495a57(0x1b4),CONTENT_TYPE=a311_0x495a57(0x1e7);class ComponentsDeployer extends stream_1[a311_0x495a57(0x1d3)]{constructor({apiVersion:_0xa7df38,instance:_0x332b26,logger:_0x2841b2,targetOrgId:_0x1c57fe,trackingSettingId:_0x5f064e}){const _0xc5c2c6=a311_0x495a57;super({'objectMode':!![]}),this[_0xc5c2c6(0x1df)]={'records':[],'binary':[]},this[_0xc5c2c6(0x1ba)]=0x0,this[_0xc5c2c6(0x1aa)]=[],this[_0xc5c2c6(0x1cd)]=0x0,this[_0xc5c2c6(0x1de)]=_0xa7df38,this['instance']=_0x332b26,this[_0xc5c2c6(0x1f1)]=_0x2841b2,this['targetOrgId']=_0x1c57fe,this['trackingSettingId']=_0x5f064e;}async[a311_0x495a57(0x1d0)](){const _0x29f0f9=a311_0x495a57;await this[_0x29f0f9(0x1fb)]()[_0x29f0f9(0x1c5)](_0x5e3d45=>this[_0x29f0f9(0x1c8)](_0x5e3d45))[_0x29f0f9(0x1c5)](()=>this[_0x29f0f9(0x1f0)]())[_0x29f0f9(0x1c5)](_0x1a5aa6=>this['handleDeployResult'](_0x1a5aa6)),this[_0x29f0f9(0x1ea)]();}[a311_0x495a57(0x1fb)](){const _0x4b53e4=a311_0x495a57,_0x31233b=new salesforce_1[(_0x4b53e4(0x1bd))]({'instance':this[_0x4b53e4(0x1e5)],'objectName':constants_1[_0x4b53e4(0x1bb)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this['apiVersion']});return _0x31233b[_0x4b53e4(0x1db)](this['attachmentsToDeployChunk']);}['deployOrgComponents'](){const _0x22ead3=a311_0x495a57,_0x130c1e=new salesforce_1[(_0x22ead3(0x1e0))]({'instance':this[_0x22ead3(0x1e5)],'objectName':constants_1['ORG_COMPONENT_OBJECT_NAME'],'api':this[_0x22ead3(0x1de)],'allOrNone':![],'externalIdField':'Id'});return _0x130c1e[_0x22ead3(0x1db)]({'records':this[_0x22ead3(0x1aa)]});}async[a311_0x495a57(0x1ed)](_0x2457a7){const _0xb0bf38=a311_0x495a57;for(const {success:_0x2cb4bd,error:_0x1886cd}of _0x2457a7){if(_0x2cb4bd){this[_0xb0bf38(0x1cd)]++;continue;}_0x1886cd&&this[_0xb0bf38(0x1f1)][_0xb0bf38(0x1a9)](_0x1886cd);}}[a311_0x495a57(0x1d9)](_0x364f72){const _0x47a824=a311_0x495a57;return _0x364f72+this['binaryRecordsSizeChunk']>=salesforce_1[_0x47a824(0x1ab)][_0x47a824(0x1e3)]||this['attachmentsToDeployChunk']['records'][_0x47a824(0x1f9)]===MAX_COMPOSITE_CHUNK_COUNT;}[a311_0x495a57(0x1ea)](){const _0x354354=a311_0x495a57;this[_0x354354(0x1ba)]=0x0,this[_0x354354(0x1df)]={'records':[],'binary':[]},this[_0x354354(0x1aa)]=[];}[a311_0x495a57(0x1c8)](_0x429a83){const _0x3d4fe2=a311_0x495a57;for(const _0x5c595e in _0x429a83){this[_0x3d4fe2(0x1aa)][_0x5c595e][ATTACHMENT_FIELD_NAME]=_0x429a83[_0x5c595e]['id'];}}async[a311_0x495a57(0x1e6)](_0x16e1fd,_0x214451){const _0x56c591=a311_0x495a57,{listMetadataItem:_0x726d0c,sourceMemberRecord:_0x418d55}=_0x16e1fd,_0xa34fae={'attributes':{'type':constants_1['ATTACHMENT_OBJECT_NAME'],'binaryPartName':_0x726d0c[_0x56c591(0x1f3)],'binaryPartNameAlias':constants_1[_0x56c591(0x1be)]},'Id':_0x418d55[_0x56c591(0x1c2)],'Name':_0x726d0c[_0x56c591(0x1f3)],'Description':_0x726d0c[_0x56c591(0x1d2)],'ContentType':CONTENT_TYPE,'ParentId':this[_0x56c591(0x1d1)],'Body':_0x726d0c[_0x56c591(0x1f3)]},_0xc99411={'binaryFieldName':constants_1['BINARY_FIELD_NAME'],'name':_0x726d0c[_0x56c591(0x1f3)],'value':stream_1[_0x56c591(0x1f7)][_0x56c591(0x1b5)](_0x214451)};this[_0x56c591(0x1df)]['records'][_0x56c591(0x1c0)](_0xa34fae),this['attachmentsToDeployChunk'][_0x56c591(0x1f6)]['push'](_0xc99411);}[a311_0x495a57(0x1b2)](_0x339406){const _0x4d9b9a=a311_0x495a57,_0x1addf1=new jszip_1[(_0x4d9b9a(0x1b3))]();for(const _0xf02bca in _0x339406){_0x1addf1[_0x4d9b9a(0x1cf)](_0xf02bca,_0x339406[_0xf02bca]);}return _0x1addf1[_0x4d9b9a(0x1c9)]({'type':_0x4d9b9a(0x1b9)});}[a311_0x495a57(0x1ec)](_0x15f1dd,_0x4953bf){const _0x2123f5=a311_0x495a57,_0x382e23={'attributes':{'type':constants_1[_0x2123f5(0x1ad)]},'Id':_0x4953bf[_0x2123f5(0x1ce)],[constants_2[_0x2123f5(0x1a8)]+_0x2123f5(0x1f2)]:_0x4953bf[_0x2123f5(0x1bf)],[constants_2[_0x2123f5(0x1a8)]+_0x2123f5(0x1d8)]:_0x4953bf['revisionCounter'],[constants_2[_0x2123f5(0x1a8)]+'Source_Member_Id__c']:_0x4953bf['sourceMemberId'],[constants_2[_0x2123f5(0x1a8)]+_0x2123f5(0x1c1)]:_0x4953bf[_0x2123f5(0x1e2)],[constants_2[_0x2123f5(0x1a8)]+_0x2123f5(0x1f8)]:_0x15f1dd[_0x2123f5(0x1f3)],[constants_2[_0x2123f5(0x1a8)]+_0x2123f5(0x1dd)]:_0x15f1dd['fullName'],[constants_2[_0x2123f5(0x1a8)]+_0x2123f5(0x1e1)]:_0x15f1dd[_0x2123f5(0x1d2)],[constants_2[_0x2123f5(0x1a8)]+_0x2123f5(0x1af)]:_0x15f1dd[_0x2123f5(0x1a7)],[constants_2[_0x2123f5(0x1a8)]+_0x2123f5(0x1d4)]:constants_1[_0x2123f5(0x1b7)][_0x2123f5(0x1ca)](_0x15f1dd[_0x2123f5(0x1d2)])||null,[constants_2[_0x2123f5(0x1a8)]+'Is_Retrieved__c']:!![],[constants_2[_0x2123f5(0x1a8)]+_0x2123f5(0x1e9)]:this[_0x2123f5(0x1d1)],[constants_2[_0x2123f5(0x1a8)]+'Tracking_Setting__c']:this['trackingSettingId'],[constants_2[_0x2123f5(0x1a8)]+_0x2123f5(0x1b6)]:_0x2123f5(0x1eb)};this['orgComponentsToDeployChunk'][_0x2123f5(0x1c0)](_0x382e23);}async['_write'](_0x95e5ba,_0xba45f7,_0x23e6e3){const _0x28002b=a311_0x495a57;try{const {listMetadataItem:_0x272f5d,sourceMemberRecord:_0x19b689,files:_0x2c9e6b}=_0x95e5ba,_0x4f3127=await this[_0x28002b(0x1b2)](_0x2c9e6b),_0xab21a=Buffer['byteLength'](_0x4f3127);this[_0x28002b(0x1d9)](_0xab21a)&&await this[_0x28002b(0x1d0)](),this[_0x28002b(0x1ba)]+=_0xab21a,await this[_0x28002b(0x1e6)](_0x95e5ba,_0x4f3127),this['addOrgComponentToChunk'](_0x272f5d,_0x19b689),_0x23e6e3();}catch(_0x2a82b4){_0x23e6e3(_0x2a82b4);}}async[a311_0x495a57(0x1c7)](_0x263f5c){const _0x31000a=a311_0x495a57;try{this[_0x31000a(0x1df)]['records'][_0x31000a(0x1f9)]&&this[_0x31000a(0x1aa)][_0x31000a(0x1f9)]&&await this[_0x31000a(0x1d0)](),this['logger']['log'](_0x31000a(0x1fa)+this[_0x31000a(0x1cd)]+_0x31000a(0x1fc)),await this[_0x31000a(0x1f1)][_0x31000a(0x1b1)](),_0x263f5c();}catch(_0x2089c0){_0x263f5c(_0x2089c0);}}}exports['ComponentsDeployer']=ComponentsDeployer;