const a295_0x22fcd3=a295_0x2ec1;(function(_0x2d2993,_0xdcd531){const _0x171a19=a295_0x2ec1,_0x52f57f=_0x2d2993();while(!![]){try{const _0x3ef147=parseInt(_0x171a19(0x1df))/0x1+-parseInt(_0x171a19(0x205))/0x2+-parseInt(_0x171a19(0x200))/0x3*(-parseInt(_0x171a19(0x1ee))/0x4)+-parseInt(_0x171a19(0x21c))/0x5+-parseInt(_0x171a19(0x21a))/0x6+-parseInt(_0x171a19(0x1e6))/0x7+parseInt(_0x171a19(0x207))/0x8*(parseInt(_0x171a19(0x1d8))/0x9);if(_0x3ef147===_0xdcd531)break;else _0x52f57f['push'](_0x52f57f['shift']());}catch(_0x4d7bb0){_0x52f57f['push'](_0x52f57f['shift']());}}}(a295_0x2647,0x39ad7));const a295_0x38884b=(function(){let _0xebaeb9=!![];return function(_0x4056c7,_0x3c059b){const _0x11f8e7=_0xebaeb9?function(){const _0x280353=a295_0x2ec1;if(_0x3c059b){const _0x25a068=_0x3c059b[_0x280353(0x206)](_0x4056c7,arguments);return _0x3c059b=null,_0x25a068;}}:function(){};return _0xebaeb9=![],_0x11f8e7;};}()),a295_0x25dd1e=a295_0x38884b(this,function(){const _0x56d076=a295_0x2ec1;return a295_0x25dd1e['toString']()[_0x56d076(0x1fa)]('(((.+)+)+)+$')[_0x56d076(0x1db)]()[_0x56d076(0x202)](a295_0x25dd1e)[_0x56d076(0x1fa)](_0x56d076(0x1da));});a295_0x25dd1e();'use strict';var __importDefault=this&&this[a295_0x22fcd3(0x1d0)]||function(_0x3ec799){const _0x511a24=a295_0x22fcd3;return _0x3ec799&&_0x3ec799[_0x511a24(0x211)]?_0x3ec799:{'default':_0x3ec799};};Object[a295_0x22fcd3(0x1dd)](exports,'__esModule',{'value':!![]}),exports[a295_0x22fcd3(0x1ea)]=void 0x0;const salesforce_1=require('@flosum/salesforce'),constants_1=require(a295_0x22fcd3(0x1f4)),stream_1=require(a295_0x22fcd3(0x20b)),jszip_1=__importDefault(require(a295_0x22fcd3(0x217))),constants_2=require('../../../../constants'),MAX_COMPOSITE_CHUNK_COUNT=0xc8,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a295_0x22fcd3(0x208)]+a295_0x22fcd3(0x1ef),CONTENT_TYPE=a295_0x22fcd3(0x1f8);function a295_0x2ec1(_0x5ebd47,_0x3a1381){const _0x658baa=a295_0x2647();return a295_0x2ec1=function(_0x25dd1e,_0x38884b){_0x25dd1e=_0x25dd1e-0x1d0;let _0x264740=_0x658baa[_0x25dd1e];return _0x264740;},a295_0x2ec1(_0x5ebd47,_0x3a1381);}class ComponentsDeployer extends stream_1['Writable']{constructor({apiVersion:_0x49bac3,instance:_0x9df219,logger:_0x17fc86,targetOrgId:_0x4b5102,trackingSettingId:_0xd2a0e4}){const _0x2e5530=a295_0x22fcd3;super({'objectMode':!![]}),this['attachmentsToDeployChunk']={'records':[],'binary':[]},this[_0x2e5530(0x1fc)]=0x0,this[_0x2e5530(0x1e3)]=[],this[_0x2e5530(0x21d)]=0x0,this['apiVersion']=_0x49bac3,this[_0x2e5530(0x1eb)]=_0x9df219,this['logger']=_0x17fc86,this['targetOrgId']=_0x4b5102,this[_0x2e5530(0x1d2)]=_0xd2a0e4;}async[a295_0x22fcd3(0x1ec)](){const _0x4bb0e5=a295_0x22fcd3;await this[_0x4bb0e5(0x1dc)]()[_0x4bb0e5(0x1f9)](_0x10bca3=>this[_0x4bb0e5(0x1d3)](_0x10bca3))[_0x4bb0e5(0x1f9)](()=>this['deployOrgComponents']())[_0x4bb0e5(0x1f9)](_0x3eff30=>this['handleDeployResult'](_0x3eff30)),this[_0x4bb0e5(0x1fd)]();}['deployAttachments'](){const _0x3fd5e4=a295_0x22fcd3,_0x21dee1=new salesforce_1['CompositeBinaryDeployData']({'instance':this[_0x3fd5e4(0x1eb)],'objectName':constants_1[_0x3fd5e4(0x1e2)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this[_0x3fd5e4(0x1d9)]});return _0x21dee1['execute'](this['attachmentsToDeployChunk']);}[a295_0x22fcd3(0x1d6)](){const _0x2fc692=a295_0x22fcd3,_0x43593f=new salesforce_1['RestSimpleDeployData']({'instance':this[_0x2fc692(0x1eb)],'objectName':constants_1[_0x2fc692(0x21e)],'api':this['apiVersion'],'allOrNone':![],'externalIdField':'Id'});return _0x43593f['execute']({'records':this['orgComponentsToDeployChunk']});}async['handleDeployResult'](_0x54c6b5){const _0x56e76a=a295_0x22fcd3;for(const {success:_0x47d174,error:_0x3f11b1}of _0x54c6b5){if(_0x47d174){this[_0x56e76a(0x21d)]++;continue;}_0x3f11b1&&this['logger']['error'](_0x3f11b1);}}[a295_0x22fcd3(0x20c)](_0x293340){const _0x4ffc33=a295_0x22fcd3;return _0x293340+this['binaryRecordsSizeChunk']>=salesforce_1[_0x4ffc33(0x1e1)][_0x4ffc33(0x1d7)]||this[_0x4ffc33(0x213)][_0x4ffc33(0x1d5)][_0x4ffc33(0x1f6)]===MAX_COMPOSITE_CHUNK_COUNT;}['resetChunks'](){const _0x321c0c=a295_0x22fcd3;this[_0x321c0c(0x1fc)]=0x0,this[_0x321c0c(0x213)]={'records':[],'binary':[]},this[_0x321c0c(0x1e3)]=[];}[a295_0x22fcd3(0x1d3)](_0x5f24a9){const _0x2c66d2=a295_0x22fcd3;for(const _0x368408 in _0x5f24a9){this[_0x2c66d2(0x1e3)][_0x368408][ATTACHMENT_FIELD_NAME]=_0x5f24a9[_0x368408]['id'];}}async[a295_0x22fcd3(0x1f2)](_0x33edbd,_0x3807c0){const _0xbc3875=a295_0x22fcd3,{listMetadataItem:_0x4dfe3e,sourceMemberRecord:_0x3cdc50}=_0x33edbd,_0x12f02b={'attributes':{'type':constants_1['ATTACHMENT_OBJECT_NAME'],'binaryPartName':_0x4dfe3e['fullName'],'binaryPartNameAlias':constants_1['BINARY_FIELD_NAME']},'Id':_0x3cdc50['attachmentId'],'Name':_0x4dfe3e[_0xbc3875(0x1f5)],'Description':_0x4dfe3e[_0xbc3875(0x1e7)],'ContentType':CONTENT_TYPE,'ParentId':this['targetOrgId'],'Body':_0x4dfe3e[_0xbc3875(0x1f5)]},_0x4cc721={'binaryFieldName':constants_1[_0xbc3875(0x1e4)],'name':_0x4dfe3e['fullName'],'value':stream_1[_0xbc3875(0x218)][_0xbc3875(0x1d4)](_0x3807c0)};this[_0xbc3875(0x213)]['records'][_0xbc3875(0x210)](_0x12f02b),this[_0xbc3875(0x213)]['binary'][_0xbc3875(0x210)](_0x4cc721);}[a295_0x22fcd3(0x212)](_0x2e5d83){const _0x4a0fc0=a295_0x22fcd3,_0x28e8c9=new jszip_1[(_0x4a0fc0(0x20f))]();for(const _0x49bea7 in _0x2e5d83){_0x28e8c9[_0x4a0fc0(0x209)](_0x49bea7,_0x2e5d83[_0x49bea7]);}return _0x28e8c9[_0x4a0fc0(0x20a)]({'type':'nodebuffer'});}[a295_0x22fcd3(0x1f3)](_0x17f8ed,_0xca6060){const _0x5e4d75=a295_0x22fcd3,_0x34f3a5={'attributes':{'type':constants_1[_0x5e4d75(0x21e)]},'Id':_0xca6060[_0x5e4d75(0x219)],[constants_2[_0x5e4d75(0x208)]+_0x5e4d75(0x1ff)]:_0xca6060[_0x5e4d75(0x21b)],[constants_2[_0x5e4d75(0x208)]+'Revision_Counter__c']:_0xca6060[_0x5e4d75(0x201)],[constants_2[_0x5e4d75(0x208)]+_0x5e4d75(0x215)]:_0xca6060[_0x5e4d75(0x20e)],[constants_2[_0x5e4d75(0x208)]+'Last_Updated_By__c']:_0xca6060['changedBy'],[constants_2[_0x5e4d75(0x208)]+_0x5e4d75(0x1e5)]:_0x17f8ed['fullName'],[constants_2[_0x5e4d75(0x208)]+_0x5e4d75(0x1f1)]:_0x17f8ed[_0x5e4d75(0x1f5)],[constants_2['FLOSUM_NAMESPACE']+_0x5e4d75(0x1e0)]:_0x17f8ed[_0x5e4d75(0x1e7)],[constants_2['FLOSUM_NAMESPACE']+_0x5e4d75(0x1ed)]:_0x17f8ed[_0x5e4d75(0x1fe)],[constants_2['FLOSUM_NAMESPACE']+_0x5e4d75(0x214)]:constants_1['METADATA_FOLDER_MAP'][_0x5e4d75(0x1de)](_0x17f8ed[_0x5e4d75(0x1e7)])||null,[constants_2[_0x5e4d75(0x208)]+_0x5e4d75(0x1d1)]:!![],[constants_2[_0x5e4d75(0x208)]+'OrganisationName__c']:this[_0x5e4d75(0x216)],[constants_2[_0x5e4d75(0x208)]+_0x5e4d75(0x1e8)]:this[_0x5e4d75(0x1d2)],[constants_2['FLOSUM_NAMESPACE']+_0x5e4d75(0x203)]:'Retrieved'};this[_0x5e4d75(0x1e3)][_0x5e4d75(0x210)](_0x34f3a5);}async[a295_0x22fcd3(0x1f0)](_0x5cd1d2,_0x5aa723,_0x3ed227){const _0x149d93=a295_0x22fcd3;try{const {listMetadataItem:_0x46a0a7,sourceMemberRecord:_0x103010,files:_0x52f1ba}=_0x5cd1d2,_0x12a324=await this[_0x149d93(0x212)](_0x52f1ba),_0x56507d=Buffer[_0x149d93(0x204)](_0x12a324);this['isReachedMaxChunk'](_0x56507d)&&await this[_0x149d93(0x1ec)](),this['binaryRecordsSizeChunk']+=_0x56507d,await this[_0x149d93(0x1f2)](_0x5cd1d2,_0x12a324),this['addOrgComponentToChunk'](_0x46a0a7,_0x103010),_0x3ed227();}catch(_0x3f960a){_0x3ed227(_0x3f960a);}}async['_final'](_0x3068f5){const _0x4bbccf=a295_0x22fcd3;try{this[_0x4bbccf(0x213)][_0x4bbccf(0x1d5)]['length']&&this[_0x4bbccf(0x1e3)]['length']&&await this['deploy'](),this[_0x4bbccf(0x1f7)][_0x4bbccf(0x1fb)](_0x4bbccf(0x20d)+this[_0x4bbccf(0x21d)]+_0x4bbccf(0x1e9)),await this['logger']['update'](),_0x3068f5();}catch(_0x26e240){_0x3068f5(_0x26e240);}}}exports[a295_0x22fcd3(0x1ea)]=ComponentsDeployer;function a295_0x2647(){const _0x197b4a=['Is_Retrieved__c','trackingSettingId','populateAttachmentId','from','records','deployOrgComponents','MAX_BODY_SIZE','8960823npAvXB','apiVersion','(((.+)+)+)+$','toString','deployAttachments','defineProperty','has','88783ClxmLz','Component_Type__c','CompositeConstants','ATTACHMENT_OBJECT_NAME','orgComponentsToDeployChunk','BINARY_FIELD_NAME','API_Name__c','2953020OuOnSy','type','Tracking_Setting__c','\x20components','ComponentsDeployer','instance','deploy','Label__c','4MnOKFP','Attachment_ID__c','_write','Name__c','addAttachmentToChunk','addOrgComponentToChunk','../../constants','fullName','length','logger','application/zip','then','search','log','binaryRecordsSizeChunk','resetChunks','fileName','Is_Deleted__c','89646nUHEht','revisionCounter','constructor','Status__c','byteLength','305804uXzNnc','apply','8VsubXd','FLOSUM_NAMESPACE','file','generateAsync','stream','isReachedMaxChunk','Process\x20completed\x20for\x20','sourceMemberId','default','push','__esModule','createZip','attachmentsToDeployChunk','Folder__c','Source_Member_Id__c','targetOrgId','jszip','Readable','componentId','582984HiNxoG','isNameObsolete','1030695XVtYZX','successDeployedCounter','ORG_COMPONENT_OBJECT_NAME','__importDefault'];a295_0x2647=function(){return _0x197b4a;};return a295_0x2647();}