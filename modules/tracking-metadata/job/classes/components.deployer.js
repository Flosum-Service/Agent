const a295_0x4deb10=a295_0x24eb;function a295_0x4cf9(){const _0x1c25ce=['3CpRAFL','_final','Retrieved','binary','ATTACHMENT_OBJECT_NAME','defineProperty','constructor','@flosum/salesforce','ComponentsDeployer','_write','sourceMemberId','3042FKtmZD','deployAttachments','9718412KFNzli','handleDeployResult','search','file','Attachment_ID__c','default','ORG_COMPONENT_OBJECT_NAME','createZip','trackingSettingId','Readable','componentId','37916ouEWjW','length','byteLength','execute','fullName','populateAttachmentId','addOrgComponentToChunk','apply','update','binaryRecordsSizeChunk','fileName','instance','1380QDMYYM','Revision_Counter__c','MAX_BODY_SIZE','Process\x20completed\x20for\x20','has','apiVersion','successDeployedCounter','orgComponentsToDeployChunk','7CsMasn','changedBy','\x20components','resetChunks','619038iPhuHe','logger','2632312ZJaQEI','Last_Updated_By__c','FLOSUM_NAMESPACE','type','BINARY_FIELD_NAME','117469GKGfpR','CompositeBinaryDeployData','METADATA_FOLDER_MAP','../../../../constants','Is_Retrieved__c','stream','Name__c','deploy','from','Source_Member_Id__c','1952352PNbbks','addAttachmentToChunk','RestSimpleDeployData','jszip','toString','then','Tracking_Setting__c','OrganisationName__c','attachmentId','targetOrgId','Component_Type__c','445UpboTU','records','push','isNameObsolete','attachmentsToDeployChunk','isReachedMaxChunk'];a295_0x4cf9=function(){return _0x1c25ce;};return a295_0x4cf9();}(function(_0x4812da,_0x38f696){const _0x5a5ec2=a295_0x24eb,_0x9a00e3=_0x4812da();while(!![]){try{const _0x582846=-parseInt(_0x5a5ec2(0x93))/0x1+-parseInt(_0x5a5ec2(0x8e))/0x2*(-parseInt(_0x5a5ec2(0xae))/0x3)+-parseInt(_0x5a5ec2(0xc6))/0x4*(-parseInt(_0x5a5ec2(0xa8))/0x5)+parseInt(_0x5a5ec2(0x8c))/0x6*(-parseInt(_0x5a5ec2(0x88))/0x7)+-parseInt(_0x5a5ec2(0x9d))/0x8+-parseInt(_0x5a5ec2(0xb9))/0x9*(-parseInt(_0x5a5ec2(0xd2))/0xa)+-parseInt(_0x5a5ec2(0xbb))/0xb;if(_0x582846===_0x38f696)break;else _0x9a00e3['push'](_0x9a00e3['shift']());}catch(_0x3b74df){_0x9a00e3['push'](_0x9a00e3['shift']());}}}(a295_0x4cf9,0xd188d));const a295_0x10076d=(function(){let _0x5a7af3=!![];return function(_0x59bc53,_0xe4751d){const _0x4e1749=_0x5a7af3?function(){const _0x58464=a295_0x24eb;if(_0xe4751d){const _0x3d1098=_0xe4751d[_0x58464(0xcd)](_0x59bc53,arguments);return _0xe4751d=null,_0x3d1098;}}:function(){};return _0x5a7af3=![],_0x4e1749;};}()),a295_0x4242f2=a295_0x10076d(this,function(){const _0x299dbf=a295_0x24eb;return a295_0x4242f2[_0x299dbf(0xa1)]()[_0x299dbf(0xbd)]('(((.+)+)+)+$')['toString']()[_0x299dbf(0xb4)](a295_0x4242f2)[_0x299dbf(0xbd)]('(((.+)+)+)+$');});a295_0x4242f2();'use strict';function a295_0x24eb(_0x235656,_0x477148){const _0x35e096=a295_0x4cf9();return a295_0x24eb=function(_0x4242f2,_0x10076d){_0x4242f2=_0x4242f2-0x86;let _0x4cf99b=_0x35e096[_0x4242f2];return _0x4cf99b;},a295_0x24eb(_0x235656,_0x477148);}var __importDefault=this&&this['__importDefault']||function(_0x436024){return _0x436024&&_0x436024['__esModule']?_0x436024:{'default':_0x436024};};Object[a295_0x4deb10(0xb3)](exports,'__esModule',{'value':!![]}),exports[a295_0x4deb10(0xb6)]=void 0x0;const salesforce_1=require(a295_0x4deb10(0xb5)),constants_1=require('../../constants'),stream_1=require(a295_0x4deb10(0x98)),jszip_1=__importDefault(require(a295_0x4deb10(0xa0))),constants_2=require(a295_0x4deb10(0x96)),MAX_COMPOSITE_CHUNK_COUNT=0xc8,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a295_0x4deb10(0x90)]+a295_0x4deb10(0xbf),CONTENT_TYPE='application/zip';class ComponentsDeployer extends stream_1['Writable']{constructor({apiVersion:_0x3f195a,instance:_0x223779,logger:_0x26f5d3,targetOrgId:_0xdbf250,trackingSettingId:_0xaf382b}){const _0x429bc5=a295_0x4deb10;super({'objectMode':!![]}),this[_0x429bc5(0xac)]={'records':[],'binary':[]},this[_0x429bc5(0xcf)]=0x0,this[_0x429bc5(0x87)]=[],this[_0x429bc5(0x86)]=0x0,this['apiVersion']=_0x3f195a,this[_0x429bc5(0xd1)]=_0x223779,this[_0x429bc5(0x8d)]=_0x26f5d3,this[_0x429bc5(0xa6)]=_0xdbf250,this[_0x429bc5(0xc3)]=_0xaf382b;}async[a295_0x4deb10(0x9a)](){const _0x1da89c=a295_0x4deb10;await this[_0x1da89c(0xba)]()[_0x1da89c(0xa2)](_0x18a022=>this[_0x1da89c(0xcb)](_0x18a022))[_0x1da89c(0xa2)](()=>this['deployOrgComponents']())[_0x1da89c(0xa2)](_0x43cd45=>this[_0x1da89c(0xbc)](_0x43cd45)),this[_0x1da89c(0x8b)]();}[a295_0x4deb10(0xba)](){const _0x3380d9=a295_0x4deb10,_0x580dc6=new salesforce_1[(_0x3380d9(0x94))]({'instance':this[_0x3380d9(0xd1)],'objectName':constants_1['ATTACHMENT_OBJECT_NAME'],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this['apiVersion']});return _0x580dc6[_0x3380d9(0xc9)](this[_0x3380d9(0xac)]);}['deployOrgComponents'](){const _0x18f1c1=a295_0x4deb10,_0x4dce0f=new salesforce_1[(_0x18f1c1(0x9f))]({'instance':this[_0x18f1c1(0xd1)],'objectName':constants_1[_0x18f1c1(0xc1)],'api':this[_0x18f1c1(0xd7)],'allOrNone':![],'externalIdField':'Id'});return _0x4dce0f[_0x18f1c1(0xc9)]({'records':this[_0x18f1c1(0x87)]});}async[a295_0x4deb10(0xbc)](_0x37acaa){const _0x233dc7=a295_0x4deb10;for(const {success:_0x4611a5,error:_0x2fa66a}of _0x37acaa){if(_0x4611a5){this[_0x233dc7(0x86)]++;continue;}_0x2fa66a&&this['logger']['error'](_0x2fa66a);}}[a295_0x4deb10(0xad)](_0x1b9ba8){const _0x422d82=a295_0x4deb10;return _0x1b9ba8+this[_0x422d82(0xcf)]>=salesforce_1['CompositeConstants'][_0x422d82(0xd4)]||this[_0x422d82(0xac)]['records'][_0x422d82(0xc7)]===MAX_COMPOSITE_CHUNK_COUNT;}[a295_0x4deb10(0x8b)](){const _0x494fa0=a295_0x4deb10;this[_0x494fa0(0xcf)]=0x0,this[_0x494fa0(0xac)]={'records':[],'binary':[]},this[_0x494fa0(0x87)]=[];}[a295_0x4deb10(0xcb)](_0x24729a){const _0x572d01=a295_0x4deb10;for(const _0x5d72f5 in _0x24729a){this[_0x572d01(0x87)][_0x5d72f5][ATTACHMENT_FIELD_NAME]=_0x24729a[_0x5d72f5]['id'];}}async[a295_0x4deb10(0x9e)](_0x320e4d,_0x4a0fe5){const _0x29a8d5=a295_0x4deb10,{listMetadataItem:_0x360a88,sourceMemberRecord:_0x44c556}=_0x320e4d,_0x55f347={'attributes':{'type':constants_1[_0x29a8d5(0xb2)],'binaryPartName':_0x360a88[_0x29a8d5(0xca)],'binaryPartNameAlias':constants_1[_0x29a8d5(0x92)]},'Id':_0x44c556[_0x29a8d5(0xa5)],'Name':_0x360a88['fullName'],'Description':_0x360a88['type'],'ContentType':CONTENT_TYPE,'ParentId':this[_0x29a8d5(0xa6)],'Body':_0x360a88['fullName']},_0x1314e8={'binaryFieldName':constants_1[_0x29a8d5(0x92)],'name':_0x360a88['fullName'],'value':stream_1[_0x29a8d5(0xc4)][_0x29a8d5(0x9b)](_0x4a0fe5)};this['attachmentsToDeployChunk']['records'][_0x29a8d5(0xaa)](_0x55f347),this['attachmentsToDeployChunk'][_0x29a8d5(0xb1)][_0x29a8d5(0xaa)](_0x1314e8);}[a295_0x4deb10(0xc2)](_0x1fdebf){const _0x97aaad=a295_0x4deb10,_0x5c5b8a=new jszip_1[(_0x97aaad(0xc0))]();for(const _0x411d29 in _0x1fdebf){_0x5c5b8a[_0x97aaad(0xbe)](_0x411d29,_0x1fdebf[_0x411d29]);}return _0x5c5b8a['generateAsync']({'type':'nodebuffer'});}[a295_0x4deb10(0xcc)](_0x42200a,_0xb584d0){const _0x4d541f=a295_0x4deb10,_0x4afa62={'attributes':{'type':constants_1[_0x4d541f(0xc1)]},'Id':_0xb584d0[_0x4d541f(0xc5)],[constants_2[_0x4d541f(0x90)]+'Is_Deleted__c']:_0xb584d0[_0x4d541f(0xab)],[constants_2[_0x4d541f(0x90)]+_0x4d541f(0xd3)]:_0xb584d0['revisionCounter'],[constants_2[_0x4d541f(0x90)]+_0x4d541f(0x9c)]:_0xb584d0[_0x4d541f(0xb8)],[constants_2[_0x4d541f(0x90)]+_0x4d541f(0x8f)]:_0xb584d0[_0x4d541f(0x89)],[constants_2['FLOSUM_NAMESPACE']+'API_Name__c']:_0x42200a[_0x4d541f(0xca)],[constants_2['FLOSUM_NAMESPACE']+_0x4d541f(0x99)]:_0x42200a[_0x4d541f(0xca)],[constants_2['FLOSUM_NAMESPACE']+_0x4d541f(0xa7)]:_0x42200a['type'],[constants_2['FLOSUM_NAMESPACE']+'Label__c']:_0x42200a[_0x4d541f(0xd0)],[constants_2['FLOSUM_NAMESPACE']+'Folder__c']:constants_1[_0x4d541f(0x95)][_0x4d541f(0xd6)](_0x42200a[_0x4d541f(0x91)])||null,[constants_2[_0x4d541f(0x90)]+_0x4d541f(0x97)]:!![],[constants_2[_0x4d541f(0x90)]+_0x4d541f(0xa4)]:this[_0x4d541f(0xa6)],[constants_2['FLOSUM_NAMESPACE']+_0x4d541f(0xa3)]:this[_0x4d541f(0xc3)],[constants_2['FLOSUM_NAMESPACE']+'Status__c']:_0x4d541f(0xb0)};this['orgComponentsToDeployChunk'][_0x4d541f(0xaa)](_0x4afa62);}async[a295_0x4deb10(0xb7)](_0x5af492,_0x2e9c18,_0x319ecd){const _0x3062bc=a295_0x4deb10;try{const {listMetadataItem:_0x38d44d,sourceMemberRecord:_0x53dd64,files:_0x517981}=_0x5af492,_0x1b259f=await this[_0x3062bc(0xc2)](_0x517981),_0x505cf8=Buffer[_0x3062bc(0xc8)](_0x1b259f);this[_0x3062bc(0xad)](_0x505cf8)&&await this[_0x3062bc(0x9a)](),this[_0x3062bc(0xcf)]+=_0x505cf8,await this[_0x3062bc(0x9e)](_0x5af492,_0x1b259f),this['addOrgComponentToChunk'](_0x38d44d,_0x53dd64),_0x319ecd();}catch(_0x497b65){_0x319ecd(_0x497b65);}}async[a295_0x4deb10(0xaf)](_0x2daf3c){const _0x2eb5b7=a295_0x4deb10;try{this[_0x2eb5b7(0xac)][_0x2eb5b7(0xa9)][_0x2eb5b7(0xc7)]&&this[_0x2eb5b7(0x87)][_0x2eb5b7(0xc7)]&&await this[_0x2eb5b7(0x9a)](),this[_0x2eb5b7(0x8d)]['log'](_0x2eb5b7(0xd5)+this['successDeployedCounter']+_0x2eb5b7(0x8a)),await this[_0x2eb5b7(0x8d)][_0x2eb5b7(0xce)](),_0x2daf3c();}catch(_0x25e688){_0x2daf3c(_0x25e688);}}}exports[a295_0x4deb10(0xb6)]=ComponentsDeployer;