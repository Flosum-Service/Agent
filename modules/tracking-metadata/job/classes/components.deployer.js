const a338_0x219945=a338_0x2324;(function(_0x314b81,_0x2d879e){const _0x58b13a=a338_0x2324,_0x301e7c=_0x314b81();while(!![]){try{const _0xd3cf29=parseInt(_0x58b13a(0xd7))/0x1*(parseInt(_0x58b13a(0xdd))/0x2)+-parseInt(_0x58b13a(0xb5))/0x3+parseInt(_0x58b13a(0xfa))/0x4+parseInt(_0x58b13a(0xd5))/0x5+-parseInt(_0x58b13a(0xc3))/0x6*(-parseInt(_0x58b13a(0xf6))/0x7)+-parseInt(_0x58b13a(0xe2))/0x8*(parseInt(_0x58b13a(0xe8))/0x9)+-parseInt(_0x58b13a(0xd0))/0xa;if(_0xd3cf29===_0x2d879e)break;else _0x301e7c['push'](_0x301e7c['shift']());}catch(_0xcf4d9e){_0x301e7c['push'](_0x301e7c['shift']());}}}(a338_0x2806,0xd4887));const a338_0x17dfc8=(function(){let _0x3a3b6b=!![];return function(_0x1c975f,_0x2f7e10){const _0x2e0613=_0x3a3b6b?function(){if(_0x2f7e10){const _0x14115f=_0x2f7e10['apply'](_0x1c975f,arguments);return _0x2f7e10=null,_0x14115f;}}:function(){};return _0x3a3b6b=![],_0x2e0613;};}()),a338_0x4153e2=a338_0x17dfc8(this,function(){const _0x1b92df=a338_0x2324;return a338_0x4153e2[_0x1b92df(0xb7)]()['search']('(((.+)+)+)+$')[_0x1b92df(0xb7)]()['constructor'](a338_0x4153e2)[_0x1b92df(0xb9)](_0x1b92df(0xc2));});function a338_0x2806(){const _0x4faf00=['49136LqwZtW','fullName','Is_Retrieved__c','attachmentId','Tracking_Setting__c','push','1926ASdlUp','Last_Updated_By__c','stream','binary','populateAttachmentId','METADATA_FOLDER_MAP','ORG_COMPONENT_OBJECT_NAME','update','deployOrgComponents','Name__c','createZip','handleDeployResult','addAttachmentToChunk','CompositeConstants','4437188BvdINU','CompositeBinaryDeployData','Label__c','generateAsync','5594488FIdoba','BINARY_FIELD_NAME','resetChunks','logger','jszip','log','deploy','Writable','default','orgComponentsToDeployChunk','length','Revision_Counter__c','from','__importDefault','2949174eIRNtg','RestSimpleDeployData','toString','ATTACHMENT_OBJECT_NAME','search','fileName','apiVersion','execute','../../../../constants','Component_Type__c','changedBy','OrganisationName__c','Folder__c','(((.+)+)+)+$','6ddQYZC','Is_Deleted__c','trackingSettingId','_write','defineProperty','instance','Source_Member_Id__c','addOrgComponentToChunk','file','__esModule','\x20components','successDeployedCounter','then','4701720MUWFBn','nodebuffer','Attachment_ID__c','attachmentsToDeployChunk','deployAttachments','4641070JteurM','has','225811icCMrX','byteLength','targetOrgId','isNameObsolete','_final','Process\x20completed\x20for\x20','6fiMDVV','FLOSUM_NAMESPACE','isReachedMaxChunk','type','binaryRecordsSizeChunk'];a338_0x2806=function(){return _0x4faf00;};return a338_0x2806();}a338_0x4153e2();'use strict';var __importDefault=this&&this[a338_0x219945(0xb4)]||function(_0x15a725){const _0x23b70b=a338_0x219945;return _0x15a725&&_0x15a725[_0x23b70b(0xcc)]?_0x15a725:{'default':_0x15a725};};Object[a338_0x219945(0xc7)](exports,a338_0x219945(0xcc),{'value':!![]}),exports['ComponentsDeployer']=void 0x0;function a338_0x2324(_0x45e153,_0x1f1e29){const _0x2851d0=a338_0x2806();return a338_0x2324=function(_0x4153e2,_0x17dfc8){_0x4153e2=_0x4153e2-0xb4;let _0x2806eb=_0x2851d0[_0x4153e2];return _0x2806eb;},a338_0x2324(_0x45e153,_0x1f1e29);}const salesforce_1=require('@flosum/salesforce'),constants_1=require('../../constants'),stream_1=require(a338_0x219945(0xea)),jszip_1=__importDefault(require(a338_0x219945(0xfe))),constants_2=require(a338_0x219945(0xbd)),MAX_COMPOSITE_CHUNK_COUNT=0xc8,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a338_0x219945(0xde)]+a338_0x219945(0xd2),CONTENT_TYPE='application/zip';class ComponentsDeployer extends stream_1[a338_0x219945(0x101)]{constructor({apiVersion:_0x1e013b,instance:_0x32ee48,logger:_0x1f0e08,targetOrgId:_0x23c56b,trackingSettingId:_0x354f1d}){const _0x400a75=a338_0x219945;super({'objectMode':!![]}),this[_0x400a75(0xd3)]={'records':[],'binary':[]},this['binaryRecordsSizeChunk']=0x0,this['orgComponentsToDeployChunk']=[],this[_0x400a75(0xce)]=0x0,this[_0x400a75(0xbb)]=_0x1e013b,this[_0x400a75(0xc8)]=_0x32ee48,this[_0x400a75(0xfd)]=_0x1f0e08,this[_0x400a75(0xd9)]=_0x23c56b,this[_0x400a75(0xc5)]=_0x354f1d;}async[a338_0x219945(0x100)](){const _0x5efff5=a338_0x219945;await this['deployAttachments']()[_0x5efff5(0xcf)](_0x53ecf2=>this[_0x5efff5(0xec)](_0x53ecf2))[_0x5efff5(0xcf)](()=>this[_0x5efff5(0xf0)]())['then'](_0xbd7c57=>this['handleDeployResult'](_0xbd7c57)),this[_0x5efff5(0xfc)]();}[a338_0x219945(0xd4)](){const _0x518623=a338_0x219945,_0x2055db=new salesforce_1[(_0x518623(0xf7))]({'instance':this[_0x518623(0xc8)],'objectName':constants_1[_0x518623(0xb8)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this[_0x518623(0xbb)]});return _0x2055db['execute'](this['attachmentsToDeployChunk']);}[a338_0x219945(0xf0)](){const _0x3748c9=a338_0x219945,_0xc8b2ad=new salesforce_1[(_0x3748c9(0xb6))]({'instance':this[_0x3748c9(0xc8)],'objectName':constants_1['ORG_COMPONENT_OBJECT_NAME'],'api':this[_0x3748c9(0xbb)],'allOrNone':![],'externalIdField':'Id'});return _0xc8b2ad[_0x3748c9(0xbc)]({'records':this[_0x3748c9(0x103)]});}async[a338_0x219945(0xf3)](_0x2c6507){const _0x4fbcba=a338_0x219945;for(const {success:_0x58e8c5,error:_0x475343}of _0x2c6507){if(_0x58e8c5){this[_0x4fbcba(0xce)]++;continue;}_0x475343&&this[_0x4fbcba(0xfd)]['error'](_0x475343);}}['isReachedMaxChunk'](_0x5da5ca){const _0x360e13=a338_0x219945;return _0x5da5ca+this[_0x360e13(0xe1)]>=salesforce_1[_0x360e13(0xf5)]['MAX_BODY_SIZE']||this['attachmentsToDeployChunk']['records'][_0x360e13(0x104)]===MAX_COMPOSITE_CHUNK_COUNT;}[a338_0x219945(0xfc)](){const _0xa94acf=a338_0x219945;this[_0xa94acf(0xe1)]=0x0,this[_0xa94acf(0xd3)]={'records':[],'binary':[]},this[_0xa94acf(0x103)]=[];}[a338_0x219945(0xec)](_0x12c7a3){const _0x462a6c=a338_0x219945;for(const _0x155d8d in _0x12c7a3){this[_0x462a6c(0x103)][_0x155d8d][ATTACHMENT_FIELD_NAME]=_0x12c7a3[_0x155d8d]['id'];}}async[a338_0x219945(0xf4)](_0x3dbe93,_0x561366){const _0x36432a=a338_0x219945,{listMetadataItem:_0x145ad3,sourceMemberRecord:_0xa02039}=_0x3dbe93,_0x55d643={'attributes':{'type':constants_1[_0x36432a(0xb8)],'binaryPartName':_0x145ad3[_0x36432a(0xe3)],'binaryPartNameAlias':constants_1[_0x36432a(0xfb)]},'Id':_0xa02039[_0x36432a(0xe5)],'Name':_0x145ad3[_0x36432a(0xe3)],'Description':_0x145ad3['type'],'ContentType':CONTENT_TYPE,'ParentId':this[_0x36432a(0xd9)],'Body':_0x145ad3[_0x36432a(0xe3)]},_0x13c3c3={'binaryFieldName':constants_1[_0x36432a(0xfb)],'name':_0x145ad3[_0x36432a(0xe3)],'value':stream_1['Readable'][_0x36432a(0x106)](_0x561366)};this[_0x36432a(0xd3)]['records']['push'](_0x55d643),this[_0x36432a(0xd3)][_0x36432a(0xeb)][_0x36432a(0xe7)](_0x13c3c3);}[a338_0x219945(0xf2)](_0x234f67){const _0x54c262=a338_0x219945,_0x478ec7=new jszip_1[(_0x54c262(0x102))]();for(const _0x444fc3 in _0x234f67){_0x478ec7[_0x54c262(0xcb)](_0x444fc3,_0x234f67[_0x444fc3]);}return _0x478ec7[_0x54c262(0xf9)]({'type':_0x54c262(0xd1)});}['addOrgComponentToChunk'](_0xf58c5e,_0x3984b9){const _0x5c9682=a338_0x219945,_0x2fee70={'attributes':{'type':constants_1[_0x5c9682(0xee)]},'Id':_0x3984b9['componentId'],[constants_2[_0x5c9682(0xde)]+_0x5c9682(0xc4)]:_0x3984b9[_0x5c9682(0xda)],[constants_2[_0x5c9682(0xde)]+_0x5c9682(0x105)]:_0x3984b9['revisionCounter'],[constants_2[_0x5c9682(0xde)]+_0x5c9682(0xc9)]:_0x3984b9['sourceMemberId'],[constants_2['FLOSUM_NAMESPACE']+_0x5c9682(0xe9)]:_0x3984b9[_0x5c9682(0xbf)],[constants_2['FLOSUM_NAMESPACE']+'API_Name__c']:_0xf58c5e[_0x5c9682(0xe3)],[constants_2['FLOSUM_NAMESPACE']+_0x5c9682(0xf1)]:_0xf58c5e[_0x5c9682(0xe3)],[constants_2[_0x5c9682(0xde)]+_0x5c9682(0xbe)]:_0xf58c5e['type'],[constants_2[_0x5c9682(0xde)]+_0x5c9682(0xf8)]:_0xf58c5e[_0x5c9682(0xba)],[constants_2[_0x5c9682(0xde)]+_0x5c9682(0xc1)]:constants_1[_0x5c9682(0xed)][_0x5c9682(0xd6)](_0xf58c5e[_0x5c9682(0xe0)])||null,[constants_2[_0x5c9682(0xde)]+_0x5c9682(0xe4)]:!![],[constants_2['FLOSUM_NAMESPACE']+_0x5c9682(0xc0)]:this[_0x5c9682(0xd9)],[constants_2['FLOSUM_NAMESPACE']+_0x5c9682(0xe6)]:this[_0x5c9682(0xc5)],[constants_2[_0x5c9682(0xde)]+'Status__c']:'Retrieved'};this[_0x5c9682(0x103)]['push'](_0x2fee70);}async[a338_0x219945(0xc6)](_0x47f4a2,_0x53e203,_0x4b002a){const _0x415515=a338_0x219945;try{const {listMetadataItem:_0x5ee62f,sourceMemberRecord:_0x35ee9e,files:_0x34af65}=_0x47f4a2,_0x16abd8=await this[_0x415515(0xf2)](_0x34af65),_0x1123b6=Buffer[_0x415515(0xd8)](_0x16abd8);this[_0x415515(0xdf)](_0x1123b6)&&await this[_0x415515(0x100)](),this[_0x415515(0xe1)]+=_0x1123b6,await this[_0x415515(0xf4)](_0x47f4a2,_0x16abd8),this[_0x415515(0xca)](_0x5ee62f,_0x35ee9e),_0x4b002a();}catch(_0x4ad786){_0x4b002a(_0x4ad786);}}async[a338_0x219945(0xdb)](_0x5d9615){const _0x22160a=a338_0x219945;try{this[_0x22160a(0xd3)]['records'][_0x22160a(0x104)]&&this[_0x22160a(0x103)][_0x22160a(0x104)]&&await this[_0x22160a(0x100)](),this[_0x22160a(0xfd)][_0x22160a(0xff)](_0x22160a(0xdc)+this['successDeployedCounter']+_0x22160a(0xcd)),await this[_0x22160a(0xfd)][_0x22160a(0xef)](),_0x5d9615();}catch(_0xffbb5d){_0x5d9615(_0xffbb5d);}}}exports['ComponentsDeployer']=ComponentsDeployer;