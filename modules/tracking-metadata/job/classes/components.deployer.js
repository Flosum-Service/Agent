const a310_0x8b2acc=a310_0x4cfa;(function(_0x29f113,_0x412ced){const _0x33ca44=a310_0x4cfa,_0x43a147=_0x29f113();while(!![]){try{const _0x4c1d3f=parseInt(_0x33ca44(0xaf))/0x1+parseInt(_0x33ca44(0x76))/0x2*(-parseInt(_0x33ca44(0xb7))/0x3)+-parseInt(_0x33ca44(0xb9))/0x4+parseInt(_0x33ca44(0x85))/0x5*(-parseInt(_0x33ca44(0x83))/0x6)+-parseInt(_0x33ca44(0xb4))/0x7+-parseInt(_0x33ca44(0x64))/0x8+parseInt(_0x33ca44(0xbd))/0x9;if(_0x4c1d3f===_0x412ced)break;else _0x43a147['push'](_0x43a147['shift']());}catch(_0x3166c9){_0x43a147['push'](_0x43a147['shift']());}}}(a310_0x4b24,0x83737));const a310_0x3cc49b=(function(){let _0x46c724=!![];return function(_0x13f92e,_0x1fcbbb){const _0x4e9f92=_0x46c724?function(){const _0x16068c=a310_0x4cfa;if(_0x1fcbbb){const _0x2b3600=_0x1fcbbb[_0x16068c(0x68)](_0x13f92e,arguments);return _0x1fcbbb=null,_0x2b3600;}}:function(){};return _0x46c724=![],_0x4e9f92;};}()),a310_0x1a6057=a310_0x3cc49b(this,function(){const _0x148101=a310_0x4cfa;return a310_0x1a6057[_0x148101(0x69)]()[_0x148101(0x6e)]('(((.+)+)+)+$')[_0x148101(0x69)]()['constructor'](a310_0x1a6057)[_0x148101(0x6e)](_0x148101(0x7c));});a310_0x1a6057();'use strict';var __importDefault=this&&this[a310_0x8b2acc(0x8e)]||function(_0xff6719){const _0x1acebd=a310_0x8b2acc;return _0xff6719&&_0xff6719[_0x1acebd(0xa0)]?_0xff6719:{'default':_0xff6719};};Object[a310_0x8b2acc(0x89)](exports,a310_0x8b2acc(0xa0),{'value':!![]}),exports[a310_0x8b2acc(0x6d)]=void 0x0;function a310_0x4b24(){const _0x3a7e8a=['binary','OrganisationName__c','Last_Updated_By__c','Is_Deleted__c','orgComponentsToDeployChunk','737606uOdicI','generateAsync','attachmentsToDeployChunk','_final','from','has','(((.+)+)+)+$','stream','attachmentId','type','Folder__c','revisionCounter','Attachment_ID__c','6JNUDSj','jszip','3966715vVxlqF','default','changedBy','CompositeBinaryDeployData','defineProperty','error','binaryRecordsSizeChunk','log','Process\x20completed\x20for\x20','__importDefault','fileName','instance','Source_Member_Id__c','Is_Retrieved__c','Name__c','isReachedMaxChunk','deployOrgComponents','../../../../constants','METADATA_FOLDER_MAP','Tracking_Setting__c','populateAttachmentId','sourceMemberId','createZip','byteLength','then','API_Name__c','application/zip','__esModule','ORG_COMPONENT_OBJECT_NAME','execute','isNameObsolete','Writable','file','update','Retrieved','targetOrgId','componentId','Revision_Counter__c','resetChunks','RestSimpleDeployData','ATTACHMENT_OBJECT_NAME','push','499679SWyCKM','\x20components','CompositeConstants','records','BINARY_FIELD_NAME','1838837vvENzf','apiVersion','handleDeployResult','3zdbpJf','FLOSUM_NAMESPACE','2189916qtwWex','../../constants','Status__c','nodebuffer','27449982lUhVxT','logger','8311504HfizbT','trackingSettingId','addOrgComponentToChunk','deployAttachments','apply','toString','length','@flosum/salesforce','successDeployedCounter','ComponentsDeployer','search','deploy','fullName'];a310_0x4b24=function(){return _0x3a7e8a;};return a310_0x4b24();}function a310_0x4cfa(_0x4b46bc,_0xc5bda){const _0x72c37=a310_0x4b24();return a310_0x4cfa=function(_0x1a6057,_0x3cc49b){_0x1a6057=_0x1a6057-0x64;let _0x4b2436=_0x72c37[_0x1a6057];return _0x4b2436;},a310_0x4cfa(_0x4b46bc,_0xc5bda);}const salesforce_1=require(a310_0x8b2acc(0x6b)),constants_1=require(a310_0x8b2acc(0xba)),stream_1=require(a310_0x8b2acc(0x7d)),jszip_1=__importDefault(require(a310_0x8b2acc(0x84))),constants_2=require(a310_0x8b2acc(0x96)),MAX_COMPOSITE_CHUNK_COUNT=0xc8,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a310_0x8b2acc(0xb8)]+a310_0x8b2acc(0x82),CONTENT_TYPE=a310_0x8b2acc(0x9f);class ComponentsDeployer extends stream_1[a310_0x8b2acc(0xa4)]{constructor({apiVersion:_0x125351,instance:_0x1e1adf,logger:_0x5246a9,targetOrgId:_0x5537af,trackingSettingId:_0x38347f}){const _0x3442d1=a310_0x8b2acc;super({'objectMode':!![]}),this['attachmentsToDeployChunk']={'records':[],'binary':[]},this[_0x3442d1(0x8b)]=0x0,this[_0x3442d1(0x75)]=[],this['successDeployedCounter']=0x0,this['apiVersion']=_0x125351,this[_0x3442d1(0x90)]=_0x1e1adf,this['logger']=_0x5246a9,this[_0x3442d1(0xa8)]=_0x5537af,this[_0x3442d1(0x65)]=_0x38347f;}async[a310_0x8b2acc(0x6f)](){const _0x99500c=a310_0x8b2acc;await this[_0x99500c(0x67)]()[_0x99500c(0x9d)](_0x133d8c=>this[_0x99500c(0x99)](_0x133d8c))[_0x99500c(0x9d)](()=>this[_0x99500c(0x95)]())['then'](_0x40997e=>this[_0x99500c(0xb6)](_0x40997e)),this['resetChunks']();}['deployAttachments'](){const _0x1880d2=a310_0x8b2acc,_0x4004d9=new salesforce_1[(_0x1880d2(0x88))]({'instance':this[_0x1880d2(0x90)],'objectName':constants_1[_0x1880d2(0xad)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this[_0x1880d2(0xb5)]});return _0x4004d9[_0x1880d2(0xa2)](this[_0x1880d2(0x78)]);}[a310_0x8b2acc(0x95)](){const _0x306eef=a310_0x8b2acc,_0x4b7c44=new salesforce_1[(_0x306eef(0xac))]({'instance':this[_0x306eef(0x90)],'objectName':constants_1[_0x306eef(0xa1)],'api':this[_0x306eef(0xb5)],'allOrNone':![],'externalIdField':'Id'});return _0x4b7c44[_0x306eef(0xa2)]({'records':this[_0x306eef(0x75)]});}async[a310_0x8b2acc(0xb6)](_0x561fd6){const _0x5ad8d5=a310_0x8b2acc;for(const {success:_0x36809d,error:_0x39ae76}of _0x561fd6){if(_0x36809d){this[_0x5ad8d5(0x6c)]++;continue;}_0x39ae76&&this[_0x5ad8d5(0xbe)][_0x5ad8d5(0x8a)](_0x39ae76);}}[a310_0x8b2acc(0x94)](_0x32a499){const _0x28d943=a310_0x8b2acc;return _0x32a499+this[_0x28d943(0x8b)]>=salesforce_1[_0x28d943(0xb1)]['MAX_BODY_SIZE']||this['attachmentsToDeployChunk'][_0x28d943(0xb2)][_0x28d943(0x6a)]===MAX_COMPOSITE_CHUNK_COUNT;}[a310_0x8b2acc(0xab)](){const _0x774caa=a310_0x8b2acc;this[_0x774caa(0x8b)]=0x0,this[_0x774caa(0x78)]={'records':[],'binary':[]},this[_0x774caa(0x75)]=[];}['populateAttachmentId'](_0x4967f6){const _0x5ea6d3=a310_0x8b2acc;for(const _0x1bc320 in _0x4967f6){this[_0x5ea6d3(0x75)][_0x1bc320][ATTACHMENT_FIELD_NAME]=_0x4967f6[_0x1bc320]['id'];}}async['addAttachmentToChunk'](_0x182d7b,_0x3b8741){const _0xa177e5=a310_0x8b2acc,{listMetadataItem:_0x546f96,sourceMemberRecord:_0x5a1946}=_0x182d7b,_0x356242={'attributes':{'type':constants_1['ATTACHMENT_OBJECT_NAME'],'binaryPartName':_0x546f96[_0xa177e5(0x70)],'binaryPartNameAlias':constants_1[_0xa177e5(0xb3)]},'Id':_0x5a1946[_0xa177e5(0x7e)],'Name':_0x546f96[_0xa177e5(0x70)],'Description':_0x546f96[_0xa177e5(0x7f)],'ContentType':CONTENT_TYPE,'ParentId':this['targetOrgId'],'Body':_0x546f96['fullName']},_0x407e66={'binaryFieldName':constants_1[_0xa177e5(0xb3)],'name':_0x546f96[_0xa177e5(0x70)],'value':stream_1['Readable'][_0xa177e5(0x7a)](_0x3b8741)};this[_0xa177e5(0x78)]['records'][_0xa177e5(0xae)](_0x356242),this[_0xa177e5(0x78)][_0xa177e5(0x71)][_0xa177e5(0xae)](_0x407e66);}[a310_0x8b2acc(0x9b)](_0x23a640){const _0x89f8f3=a310_0x8b2acc,_0x37a32e=new jszip_1[(_0x89f8f3(0x86))]();for(const _0x412087 in _0x23a640){_0x37a32e[_0x89f8f3(0xa5)](_0x412087,_0x23a640[_0x412087]);}return _0x37a32e[_0x89f8f3(0x77)]({'type':_0x89f8f3(0xbc)});}[a310_0x8b2acc(0x66)](_0x582a7c,_0x19ee62){const _0x255786=a310_0x8b2acc,_0x3994de={'attributes':{'type':constants_1[_0x255786(0xa1)]},'Id':_0x19ee62[_0x255786(0xa9)],[constants_2[_0x255786(0xb8)]+_0x255786(0x74)]:_0x19ee62[_0x255786(0xa3)],[constants_2[_0x255786(0xb8)]+_0x255786(0xaa)]:_0x19ee62[_0x255786(0x81)],[constants_2[_0x255786(0xb8)]+_0x255786(0x91)]:_0x19ee62[_0x255786(0x9a)],[constants_2[_0x255786(0xb8)]+_0x255786(0x73)]:_0x19ee62[_0x255786(0x87)],[constants_2[_0x255786(0xb8)]+_0x255786(0x9e)]:_0x582a7c['fullName'],[constants_2[_0x255786(0xb8)]+_0x255786(0x93)]:_0x582a7c[_0x255786(0x70)],[constants_2[_0x255786(0xb8)]+'Component_Type__c']:_0x582a7c[_0x255786(0x7f)],[constants_2[_0x255786(0xb8)]+'Label__c']:_0x582a7c[_0x255786(0x8f)],[constants_2[_0x255786(0xb8)]+_0x255786(0x80)]:constants_1[_0x255786(0x97)][_0x255786(0x7b)](_0x582a7c[_0x255786(0x7f)])||null,[constants_2[_0x255786(0xb8)]+_0x255786(0x92)]:!![],[constants_2[_0x255786(0xb8)]+_0x255786(0x72)]:this['targetOrgId'],[constants_2[_0x255786(0xb8)]+_0x255786(0x98)]:this['trackingSettingId'],[constants_2[_0x255786(0xb8)]+_0x255786(0xbb)]:_0x255786(0xa7)};this['orgComponentsToDeployChunk']['push'](_0x3994de);}async['_write'](_0x2fdb5f,_0x5b3d25,_0x59d316){const _0x989ec0=a310_0x8b2acc;try{const {listMetadataItem:_0x389380,sourceMemberRecord:_0x1bde2c,files:_0x37b012}=_0x2fdb5f,_0x597798=await this[_0x989ec0(0x9b)](_0x37b012),_0x4f6764=Buffer[_0x989ec0(0x9c)](_0x597798);this[_0x989ec0(0x94)](_0x4f6764)&&await this[_0x989ec0(0x6f)](),this['binaryRecordsSizeChunk']+=_0x4f6764,await this['addAttachmentToChunk'](_0x2fdb5f,_0x597798),this[_0x989ec0(0x66)](_0x389380,_0x1bde2c),_0x59d316();}catch(_0x3ef50d){_0x59d316(_0x3ef50d);}}async[a310_0x8b2acc(0x79)](_0x164401){const _0x1befda=a310_0x8b2acc;try{this[_0x1befda(0x78)][_0x1befda(0xb2)][_0x1befda(0x6a)]&&this['orgComponentsToDeployChunk']['length']&&await this[_0x1befda(0x6f)](),this[_0x1befda(0xbe)][_0x1befda(0x8c)](_0x1befda(0x8d)+this[_0x1befda(0x6c)]+_0x1befda(0xb0)),await this[_0x1befda(0xbe)][_0x1befda(0xa6)](),_0x164401();}catch(_0x4faebd){_0x164401(_0x4faebd);}}}exports[a310_0x8b2acc(0x6d)]=ComponentsDeployer;