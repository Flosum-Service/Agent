const a295_0x2ff160=a295_0x267b;function a295_0x267b(_0x20cb4c,_0x2a6ecc){const _0x57a417=a295_0x4912();return a295_0x267b=function(_0x164021,_0x347870){_0x164021=_0x164021-0x1c7;let _0x49120c=_0x57a417[_0x164021];return _0x49120c;},a295_0x267b(_0x20cb4c,_0x2a6ecc);}(function(_0x351d3b,_0x399da1){const _0x3e5f79=a295_0x267b,_0x2f0206=_0x351d3b();while(!![]){try{const _0x311197=parseInt(_0x3e5f79(0x215))/0x1*(-parseInt(_0x3e5f79(0x1dc))/0x2)+-parseInt(_0x3e5f79(0x210))/0x3+parseInt(_0x3e5f79(0x1d1))/0x4+parseInt(_0x3e5f79(0x1e7))/0x5+-parseInt(_0x3e5f79(0x1cd))/0x6*(-parseInt(_0x3e5f79(0x1eb))/0x7)+-parseInt(_0x3e5f79(0x1fb))/0x8+-parseInt(_0x3e5f79(0x205))/0x9*(-parseInt(_0x3e5f79(0x209))/0xa);if(_0x311197===_0x399da1)break;else _0x2f0206['push'](_0x2f0206['shift']());}catch(_0x5bdf0e){_0x2f0206['push'](_0x2f0206['shift']());}}}(a295_0x4912,0xdf96b));const a295_0x347870=(function(){let _0xc7357=!![];return function(_0x599764,_0xc6160a){const _0x32ba14=_0xc7357?function(){const _0x251779=a295_0x267b;if(_0xc6160a){const _0x2f895e=_0xc6160a[_0x251779(0x207)](_0x599764,arguments);return _0xc6160a=null,_0x2f895e;}}:function(){};return _0xc7357=![],_0x32ba14;};}()),a295_0x164021=a295_0x347870(this,function(){const _0x21f879=a295_0x267b;return a295_0x164021[_0x21f879(0x1e8)]()[_0x21f879(0x1fc)](_0x21f879(0x1e9))[_0x21f879(0x1e8)]()[_0x21f879(0x1d2)](a295_0x164021)[_0x21f879(0x1fc)](_0x21f879(0x1e9));});a295_0x164021();'use strict';var __importDefault=this&&this[a295_0x2ff160(0x1df)]||function(_0xc7135c){return _0xc7135c&&_0xc7135c['__esModule']?_0xc7135c:{'default':_0xc7135c};};function a295_0x4912(){const _0x32e028=['../../constants','error','@flosum/salesforce','Label__c','FLOSUM_NAMESPACE','ComponentsDeployer','6657890iLCSLe','toString','(((.+)+)+)+$','length','7sHSSmq','Readable','Component_Type__c','nodebuffer','log','CompositeBinaryDeployData','deployOrgComponents','Is_Retrieved__c','sourceMemberId','isReachedMaxChunk','fileName','CompositeConstants','revisionCounter','trackingSettingId','RestSimpleDeployData','targetOrgId','13985304sQaGzG','search','__esModule','_final','execute','changedBy','componentId','Tracking_Setting__c','successDeployedCounter','binaryRecordsSizeChunk','2047095aPXlNf','OrganisationName__c','apply','Name__c','10cbZrry','Writable','push','attachmentId','fullName','defineProperty','isNameObsolete','1572240VnvGnX','createZip','Retrieved','API_Name__c','_write','1TYXqZf','logger','ATTACHMENT_OBJECT_NAME','\x20components','addOrgComponentToChunk','handleDeployResult','update','Is_Deleted__c','Revision_Counter__c','byteLength','file','ORG_COMPONENT_OBJECT_NAME','records','then','deploy','9680466rtJMpu','default','Folder__c','attachmentsToDeployChunk','6419308WSRWhU','constructor','Process\x20completed\x20for\x20','instance','Status__c','orgComponentsToDeployChunk','MAX_BODY_SIZE','deployAttachments','BINARY_FIELD_NAME','resetChunks','populateAttachmentId','3178418KFnqEB','addAttachmentToChunk','Attachment_ID__c','__importDefault','type'];a295_0x4912=function(){return _0x32e028;};return a295_0x4912();}Object[a295_0x2ff160(0x20e)](exports,a295_0x2ff160(0x1fd),{'value':!![]}),exports[a295_0x2ff160(0x1e6)]=void 0x0;const salesforce_1=require(a295_0x2ff160(0x1e3)),constants_1=require(a295_0x2ff160(0x1e1)),stream_1=require('stream'),jszip_1=__importDefault(require('jszip')),constants_2=require('../../../../constants'),MAX_COMPOSITE_CHUNK_COUNT=0xc8,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2['FLOSUM_NAMESPACE']+a295_0x2ff160(0x1de),CONTENT_TYPE='application/zip';class ComponentsDeployer extends stream_1[a295_0x2ff160(0x20a)]{constructor({apiVersion:_0x2c720d,instance:_0x51d561,logger:_0x3949f6,targetOrgId:_0x5751eb,trackingSettingId:_0x42a29c}){const _0x136d85=a295_0x2ff160;super({'objectMode':!![]}),this['attachmentsToDeployChunk']={'records':[],'binary':[]},this[_0x136d85(0x204)]=0x0,this[_0x136d85(0x1d6)]=[],this[_0x136d85(0x203)]=0x0,this['apiVersion']=_0x2c720d,this[_0x136d85(0x1d4)]=_0x51d561,this['logger']=_0x3949f6,this['targetOrgId']=_0x5751eb,this[_0x136d85(0x1f8)]=_0x42a29c;}async[a295_0x2ff160(0x1cc)](){const _0x183904=a295_0x2ff160;await this[_0x183904(0x1d8)]()['then'](_0x155203=>this[_0x183904(0x1db)](_0x155203))[_0x183904(0x1cb)](()=>this[_0x183904(0x1f1)]())[_0x183904(0x1cb)](_0x9e3df9=>this[_0x183904(0x21a)](_0x9e3df9)),this[_0x183904(0x1da)]();}[a295_0x2ff160(0x1d8)](){const _0x56435c=a295_0x2ff160,_0x5d251c=new salesforce_1[(_0x56435c(0x1f0))]({'instance':this['instance'],'objectName':constants_1[_0x56435c(0x217)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this['apiVersion']});return _0x5d251c['execute'](this[_0x56435c(0x1d0)]);}[a295_0x2ff160(0x1f1)](){const _0x2cfc4f=a295_0x2ff160,_0x353ede=new salesforce_1[(_0x2cfc4f(0x1f9))]({'instance':this[_0x2cfc4f(0x1d4)],'objectName':constants_1['ORG_COMPONENT_OBJECT_NAME'],'api':this['apiVersion'],'allOrNone':![],'externalIdField':'Id'});return _0x353ede[_0x2cfc4f(0x1ff)]({'records':this[_0x2cfc4f(0x1d6)]});}async[a295_0x2ff160(0x21a)](_0xc94abf){const _0x275025=a295_0x2ff160;for(const {success:_0x5f37d1,error:_0x1226fd}of _0xc94abf){if(_0x5f37d1){this[_0x275025(0x203)]++;continue;}_0x1226fd&&this[_0x275025(0x216)][_0x275025(0x1e2)](_0x1226fd);}}[a295_0x2ff160(0x1f4)](_0x4c8f1c){const _0x5d9cd9=a295_0x2ff160;return _0x4c8f1c+this[_0x5d9cd9(0x204)]>=salesforce_1[_0x5d9cd9(0x1f6)][_0x5d9cd9(0x1d7)]||this[_0x5d9cd9(0x1d0)][_0x5d9cd9(0x1ca)]['length']===MAX_COMPOSITE_CHUNK_COUNT;}[a295_0x2ff160(0x1da)](){const _0xf0ad5a=a295_0x2ff160;this['binaryRecordsSizeChunk']=0x0,this[_0xf0ad5a(0x1d0)]={'records':[],'binary':[]},this[_0xf0ad5a(0x1d6)]=[];}[a295_0x2ff160(0x1db)](_0x5b9c41){const _0xc0d980=a295_0x2ff160;for(const _0x28dd66 in _0x5b9c41){this[_0xc0d980(0x1d6)][_0x28dd66][ATTACHMENT_FIELD_NAME]=_0x5b9c41[_0x28dd66]['id'];}}async[a295_0x2ff160(0x1dd)](_0x44355b,_0x58c5a1){const _0x548c3b=a295_0x2ff160,{listMetadataItem:_0x532b82,sourceMemberRecord:_0x599ab4}=_0x44355b,_0x5bf86f={'attributes':{'type':constants_1[_0x548c3b(0x217)],'binaryPartName':_0x532b82[_0x548c3b(0x20d)],'binaryPartNameAlias':constants_1[_0x548c3b(0x1d9)]},'Id':_0x599ab4[_0x548c3b(0x20c)],'Name':_0x532b82[_0x548c3b(0x20d)],'Description':_0x532b82[_0x548c3b(0x1e0)],'ContentType':CONTENT_TYPE,'ParentId':this[_0x548c3b(0x1fa)],'Body':_0x532b82['fullName']},_0x5cc9e7={'binaryFieldName':constants_1[_0x548c3b(0x1d9)],'name':_0x532b82[_0x548c3b(0x20d)],'value':stream_1[_0x548c3b(0x1ec)]['from'](_0x58c5a1)};this[_0x548c3b(0x1d0)][_0x548c3b(0x1ca)][_0x548c3b(0x20b)](_0x5bf86f),this['attachmentsToDeployChunk']['binary'][_0x548c3b(0x20b)](_0x5cc9e7);}[a295_0x2ff160(0x211)](_0x33411e){const _0xf7f44f=a295_0x2ff160,_0x481e2b=new jszip_1[(_0xf7f44f(0x1ce))]();for(const _0x56eb1b in _0x33411e){_0x481e2b[_0xf7f44f(0x1c8)](_0x56eb1b,_0x33411e[_0x56eb1b]);}return _0x481e2b['generateAsync']({'type':_0xf7f44f(0x1ee)});}[a295_0x2ff160(0x219)](_0x1dd434,_0x587270){const _0x30197c=a295_0x2ff160,_0x56db4e={'attributes':{'type':constants_1[_0x30197c(0x1c9)]},'Id':_0x587270[_0x30197c(0x201)],[constants_2[_0x30197c(0x1e5)]+_0x30197c(0x21c)]:_0x587270[_0x30197c(0x20f)],[constants_2[_0x30197c(0x1e5)]+_0x30197c(0x21d)]:_0x587270[_0x30197c(0x1f7)],[constants_2[_0x30197c(0x1e5)]+'Source_Member_Id__c']:_0x587270[_0x30197c(0x1f3)],[constants_2[_0x30197c(0x1e5)]+'Last_Updated_By__c']:_0x587270[_0x30197c(0x200)],[constants_2[_0x30197c(0x1e5)]+_0x30197c(0x213)]:_0x1dd434[_0x30197c(0x20d)],[constants_2[_0x30197c(0x1e5)]+_0x30197c(0x208)]:_0x1dd434[_0x30197c(0x20d)],[constants_2[_0x30197c(0x1e5)]+_0x30197c(0x1ed)]:_0x1dd434[_0x30197c(0x1e0)],[constants_2['FLOSUM_NAMESPACE']+_0x30197c(0x1e4)]:_0x1dd434[_0x30197c(0x1f5)],[constants_2['FLOSUM_NAMESPACE']+_0x30197c(0x1cf)]:constants_1['METADATA_FOLDER_MAP']['has'](_0x1dd434['type'])||null,[constants_2[_0x30197c(0x1e5)]+_0x30197c(0x1f2)]:!![],[constants_2[_0x30197c(0x1e5)]+_0x30197c(0x206)]:this[_0x30197c(0x1fa)],[constants_2[_0x30197c(0x1e5)]+_0x30197c(0x202)]:this[_0x30197c(0x1f8)],[constants_2[_0x30197c(0x1e5)]+_0x30197c(0x1d5)]:_0x30197c(0x212)};this['orgComponentsToDeployChunk']['push'](_0x56db4e);}async[a295_0x2ff160(0x214)](_0x16e7e0,_0x343f60,_0x2ddf8c){const _0x15bedb=a295_0x2ff160;try{const {listMetadataItem:_0x217ca5,sourceMemberRecord:_0x2895f1,files:_0x2f42b2}=_0x16e7e0,_0x5ae746=await this['createZip'](_0x2f42b2),_0x59b243=Buffer[_0x15bedb(0x1c7)](_0x5ae746);this[_0x15bedb(0x1f4)](_0x59b243)&&await this[_0x15bedb(0x1cc)](),this['binaryRecordsSizeChunk']+=_0x59b243,await this[_0x15bedb(0x1dd)](_0x16e7e0,_0x5ae746),this[_0x15bedb(0x219)](_0x217ca5,_0x2895f1),_0x2ddf8c();}catch(_0x32cb09){_0x2ddf8c(_0x32cb09);}}async[a295_0x2ff160(0x1fe)](_0x569162){const _0x4beba2=a295_0x2ff160;try{this['attachmentsToDeployChunk']['records'][_0x4beba2(0x1ea)]&&this[_0x4beba2(0x1d6)][_0x4beba2(0x1ea)]&&await this[_0x4beba2(0x1cc)](),this[_0x4beba2(0x216)][_0x4beba2(0x1ef)](_0x4beba2(0x1d3)+this[_0x4beba2(0x203)]+_0x4beba2(0x218)),await this[_0x4beba2(0x216)][_0x4beba2(0x21b)](),_0x569162();}catch(_0x25080e){_0x569162(_0x25080e);}}}exports['ComponentsDeployer']=ComponentsDeployer;