const a340_0x5f1741=a340_0x2448;(function(_0x324204,_0x9ff7b4){const _0x530708=a340_0x2448,_0x49911a=_0x324204();while(!![]){try{const _0x4a821c=parseInt(_0x530708(0x101))/0x1*(-parseInt(_0x530708(0xe3))/0x2)+parseInt(_0x530708(0xfa))/0x3+-parseInt(_0x530708(0xfe))/0x4+parseInt(_0x530708(0x110))/0x5*(-parseInt(_0x530708(0x114))/0x6)+parseInt(_0x530708(0xce))/0x7*(-parseInt(_0x530708(0xf9))/0x8)+-parseInt(_0x530708(0xd8))/0x9+parseInt(_0x530708(0xcc))/0xa;if(_0x4a821c===_0x9ff7b4)break;else _0x49911a['push'](_0x49911a['shift']());}catch(_0x122e69){_0x49911a['push'](_0x49911a['shift']());}}}(a340_0x419d,0x2b3b5));const a340_0x26a96d=(function(){let _0x4d9ebb=!![];return function(_0x5f28da,_0x1d0339){const _0x28b46f=_0x4d9ebb?function(){const _0x3e4f3a=a340_0x2448;if(_0x1d0339){const _0x12e10b=_0x1d0339[_0x3e4f3a(0xc9)](_0x5f28da,arguments);return _0x1d0339=null,_0x12e10b;}}:function(){};return _0x4d9ebb=![],_0x28b46f;};}()),a340_0x3435bf=a340_0x26a96d(this,function(){const _0x46c734=a340_0x2448;return a340_0x3435bf[_0x46c734(0x111)]()[_0x46c734(0xc8)](_0x46c734(0xfc))[_0x46c734(0x111)]()['constructor'](a340_0x3435bf)[_0x46c734(0xc8)](_0x46c734(0xfc));});function a340_0x419d(){const _0x49bdb4=['Last_Updated_By__c','59518SFLaBT','Revision_Counter__c','records','Component\x20too\x20large.\x20Type:\x20','deployAttachments','sourceMemberId','log','deployOrgComponents','Component_Type__c','defineProperty','addOrgComponentToChunk','Process\x20completed\x20for\x20','Label__c','Retrieved','then','deploy','file','addAttachmentToChunk','length','resetChunks','Is_Deleted__c','targetOrgId','1136Jvnspt','824961efOAQs','__esModule','(((.+)+)+)+$','Status__c','79464SPcroa',',\x20Name:\x20','ORG_COMPONENT_OBJECT_NAME','2wmcPdV','ComponentsDeployer','binary','FLOSUM_NAMESPACE','nodebuffer','push','isReachedMaxChunk','componentId','METADATA_FOLDER_MAP','application/zip','CompositeBinaryDeployData','trackingSettingId','generateAsync','Tracking_Setting__c','attachmentsToDeployChunk','45UVRYRG','toString','handleDeployResult','../../../../constants','67722kyVuAu','jszip','Attachment_ID__c','Writable','changedBy','successDeployedCounter','attachmentId','byteLength','search','apply','from','fileName','4166570HXmFJi','Folder__c','10563lbwfag','apiVersion','ATTACHMENT_OBJECT_NAME','fullName','instance','MAX_BODY_SIZE','has','BINARY_FIELD_NAME','createZip','populateAttachmentId','1073898SfwOYw','binaryRecordsSizeChunk','Source_Member_Id__c','RestSimpleDeployData','Is_Retrieved__c','_write','logger','orgComponentsToDeployChunk','execute','type'];a340_0x419d=function(){return _0x49bdb4;};return a340_0x419d();}a340_0x3435bf();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x140a66){const _0x435109=a340_0x2448;return _0x140a66&&_0x140a66[_0x435109(0xfb)]?_0x140a66:{'default':_0x140a66};};Object[a340_0x5f1741(0xec)](exports,a340_0x5f1741(0xfb),{'value':!![]}),exports[a340_0x5f1741(0x102)]=void 0x0;const salesforce_1=require('@flosum/salesforce'),constants_1=require('../../constants'),stream_1=require('stream'),jszip_1=__importDefault(require(a340_0x5f1741(0x115))),constants_2=require(a340_0x5f1741(0x113)),MAX_COMPOSITE_CHUNK_COUNT=0xc8,MAX_SINGLE_FILE_SIZE=0x5a06e0,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a340_0x5f1741(0x104)]+a340_0x5f1741(0x116),CONTENT_TYPE=a340_0x5f1741(0x10a);class ComponentsDeployer extends stream_1[a340_0x5f1741(0x117)]{constructor({apiVersion:_0x4a194f,instance:_0x38e924,logger:_0x220d2b,targetOrgId:_0x5b5d5d,trackingSettingId:_0x42f79a}){const _0x65c79=a340_0x5f1741;super({'objectMode':!![]}),this['attachmentsToDeployChunk']={'records':[],'binary':[]},this['binaryRecordsSizeChunk']=0x0,this[_0x65c79(0xdf)]=[],this[_0x65c79(0xc5)]=0x0,this[_0x65c79(0xcf)]=_0x4a194f,this[_0x65c79(0xd2)]=_0x38e924,this[_0x65c79(0xde)]=_0x220d2b,this[_0x65c79(0xf8)]=_0x5b5d5d,this[_0x65c79(0x10c)]=_0x42f79a;}async['deploy'](){const _0x5d3942=a340_0x5f1741;await this[_0x5d3942(0xe7)]()[_0x5d3942(0xf1)](_0x30ccec=>this[_0x5d3942(0xd7)](_0x30ccec))['then'](()=>this[_0x5d3942(0xea)]())['then'](_0x2eeb13=>this[_0x5d3942(0x112)](_0x2eeb13)),this['resetChunks']();}[a340_0x5f1741(0xe7)](){const _0x8c090c=a340_0x5f1741,_0x1dba72=new salesforce_1[(_0x8c090c(0x10b))]({'instance':this[_0x8c090c(0xd2)],'objectName':constants_1['ATTACHMENT_OBJECT_NAME'],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this['apiVersion']});return _0x1dba72[_0x8c090c(0xe0)](this[_0x8c090c(0x10f)]);}[a340_0x5f1741(0xea)](){const _0x578e12=a340_0x5f1741,_0x18d4e6=new salesforce_1[(_0x578e12(0xdb))]({'instance':this[_0x578e12(0xd2)],'objectName':constants_1[_0x578e12(0x100)],'api':this[_0x578e12(0xcf)],'allOrNone':![],'externalIdField':'Id'});return _0x18d4e6[_0x578e12(0xe0)]({'records':this[_0x578e12(0xdf)]});}async[a340_0x5f1741(0x112)](_0x4e50e7){for(const {success:_0x3f1f5f,error:_0x2f989b}of _0x4e50e7){if(_0x3f1f5f){this['successDeployedCounter']++;continue;}_0x2f989b&&this['logger']['error'](_0x2f989b);}}[a340_0x5f1741(0x107)](_0x5af10c){const _0x3691ec=a340_0x5f1741;return _0x5af10c+this[_0x3691ec(0xd9)]>=salesforce_1['CompositeConstants'][_0x3691ec(0xd3)]||this[_0x3691ec(0x10f)][_0x3691ec(0xe5)]['length']===MAX_COMPOSITE_CHUNK_COUNT;}[a340_0x5f1741(0xf6)](){const _0x155760=a340_0x5f1741;this[_0x155760(0xd9)]=0x0,this[_0x155760(0x10f)]={'records':[],'binary':[]},this[_0x155760(0xdf)]=[];}[a340_0x5f1741(0xd7)](_0x365e1d){const _0x51da8a=a340_0x5f1741;for(const _0x4d2db1 in _0x365e1d){this[_0x51da8a(0xdf)][_0x4d2db1][ATTACHMENT_FIELD_NAME]=_0x365e1d[_0x4d2db1]['id'];}}async[a340_0x5f1741(0xf4)](_0x39625d,_0x5e95f9){const _0x322ee2=a340_0x5f1741,{listMetadataItem:_0xb4c72e,sourceMemberRecord:_0x14600f}=_0x39625d,_0x7e4ebf={'attributes':{'type':constants_1[_0x322ee2(0xd0)],'binaryPartName':_0xb4c72e[_0x322ee2(0xd1)],'binaryPartNameAlias':constants_1[_0x322ee2(0xd5)]},'Id':_0x14600f[_0x322ee2(0xc6)],'Name':_0xb4c72e['fullName'],'Description':_0xb4c72e[_0x322ee2(0xe1)],'ContentType':CONTENT_TYPE,'ParentId':this[_0x322ee2(0xf8)],'Body':_0xb4c72e['fullName']},_0x22e8d6={'binaryFieldName':constants_1[_0x322ee2(0xd5)],'name':_0xb4c72e['fullName'],'value':stream_1['Readable'][_0x322ee2(0xca)](_0x5e95f9)};this[_0x322ee2(0x10f)]['records'][_0x322ee2(0x106)](_0x7e4ebf),this['attachmentsToDeployChunk'][_0x322ee2(0x103)][_0x322ee2(0x106)](_0x22e8d6);}[a340_0x5f1741(0xd6)](_0x4151bc){const _0x44dc72=a340_0x5f1741,_0x1234b9=new jszip_1['default']();for(const _0x166361 in _0x4151bc){_0x1234b9[_0x44dc72(0xf3)](_0x166361,_0x4151bc[_0x166361]);}return _0x1234b9[_0x44dc72(0x10d)]({'type':_0x44dc72(0x105)});}['addOrgComponentToChunk'](_0x30c053,_0x14edf1,_0x4ca2b5){const _0x2a835f=a340_0x5f1741,_0xbb87c3={'attributes':{'type':constants_1[_0x2a835f(0x100)]},'Id':_0x14edf1[_0x2a835f(0x108)],[constants_2[_0x2a835f(0x104)]+_0x2a835f(0xf7)]:_0x14edf1['isNameObsolete'],[constants_2[_0x2a835f(0x104)]+_0x2a835f(0xe4)]:_0x14edf1['revisionCounter'],[constants_2['FLOSUM_NAMESPACE']+_0x2a835f(0xda)]:_0x14edf1[_0x2a835f(0xe8)],[constants_2[_0x2a835f(0x104)]+_0x2a835f(0xe2)]:_0x14edf1[_0x2a835f(0xc4)],[constants_2[_0x2a835f(0x104)]+'API_Name__c']:_0x30c053[_0x2a835f(0xd1)],[constants_2[_0x2a835f(0x104)]+'Name__c']:_0x30c053[_0x2a835f(0xd1)],[constants_2[_0x2a835f(0x104)]+_0x2a835f(0xeb)]:_0x30c053[_0x2a835f(0xe1)],[constants_2[_0x2a835f(0x104)]+_0x2a835f(0xef)]:_0x30c053[_0x2a835f(0xcb)],[constants_2['FLOSUM_NAMESPACE']+_0x2a835f(0xcd)]:constants_1[_0x2a835f(0x109)][_0x2a835f(0xd4)](_0x30c053[_0x2a835f(0xe1)])||null,[constants_2[_0x2a835f(0x104)]+_0x2a835f(0xdc)]:!![],[constants_2['FLOSUM_NAMESPACE']+'OrganisationName__c']:this['targetOrgId'],[constants_2[_0x2a835f(0x104)]+_0x2a835f(0x10e)]:this['trackingSettingId'],[constants_2[_0x2a835f(0x104)]+_0x2a835f(0xfd)]:_0x4ca2b5>MAX_SINGLE_FILE_SIZE?'Too\x20Large':_0x2a835f(0xf0)};_0x4ca2b5>MAX_SINGLE_FILE_SIZE&&this[_0x2a835f(0xde)][_0x2a835f(0xe9)](_0x2a835f(0xe6)+_0x30c053[_0x2a835f(0xe1)]+_0x2a835f(0xff)+_0x30c053[_0x2a835f(0xd1)]),this['orgComponentsToDeployChunk']['push'](_0xbb87c3);}async[a340_0x5f1741(0xdd)](_0x5463fa,_0xd75c52,_0x4414d8){const _0x83c513=a340_0x5f1741;try{const {listMetadataItem:_0x4e7266,sourceMemberRecord:_0x1eff78,files:_0x180cbd}=_0x5463fa,_0x5b8318=await this[_0x83c513(0xd6)](_0x180cbd),_0x13acb5=Buffer[_0x83c513(0xc7)](_0x5b8318);this[_0x83c513(0x107)](_0x13acb5)&&await this[_0x83c513(0xf2)](),this['binaryRecordsSizeChunk']+=_0x13acb5,await this[_0x83c513(0xf4)](_0x5463fa,_0x5b8318),this[_0x83c513(0xed)](_0x4e7266,_0x1eff78,_0x5b8318['length']),_0x4414d8();}catch(_0x50c4de){_0x4414d8(_0x50c4de);}}async['_final'](_0x4c46ad){const _0x36e72d=a340_0x5f1741;try{this[_0x36e72d(0x10f)][_0x36e72d(0xe5)]['length']&&this[_0x36e72d(0xdf)][_0x36e72d(0xf5)]&&await this[_0x36e72d(0xf2)](),this[_0x36e72d(0xde)]['log'](_0x36e72d(0xee)+this[_0x36e72d(0xc5)]+'\x20components'),await this['logger']['update'](),_0x4c46ad();}catch(_0x432032){_0x4c46ad(_0x432032);}}}function a340_0x2448(_0x1aa63f,_0x65942e){const _0x435b8b=a340_0x419d();return a340_0x2448=function(_0x3435bf,_0x26a96d){_0x3435bf=_0x3435bf-0xc4;let _0x419d58=_0x435b8b[_0x3435bf];return _0x419d58;},a340_0x2448(_0x1aa63f,_0x65942e);}exports[a340_0x5f1741(0x102)]=ComponentsDeployer;