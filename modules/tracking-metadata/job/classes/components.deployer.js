const a295_0x43ce86=a295_0x1640;(function(_0x42a2b2,_0x18d22b){const _0x29becf=a295_0x1640,_0x5cb482=_0x42a2b2();while(!![]){try{const _0x27bc50=parseInt(_0x29becf(0x17f))/0x1*(parseInt(_0x29becf(0x1bd))/0x2)+-parseInt(_0x29becf(0x17d))/0x3*(parseInt(_0x29becf(0x18c))/0x4)+parseInt(_0x29becf(0x195))/0x5+parseInt(_0x29becf(0x1a6))/0x6*(-parseInt(_0x29becf(0x18d))/0x7)+-parseInt(_0x29becf(0x184))/0x8+-parseInt(_0x29becf(0x17b))/0x9+parseInt(_0x29becf(0x19a))/0xa;if(_0x27bc50===_0x18d22b)break;else _0x5cb482['push'](_0x5cb482['shift']());}catch(_0x5cd9ae){_0x5cb482['push'](_0x5cb482['shift']());}}}(a295_0x29ff,0x69532));function a295_0x29ff(){const _0x5ef67f=['isNameObsolete','instance','binary','70OIobyH','Retrieved','has','populateAttachmentId','fileName','attachmentsToDeployChunk','handleDeployResult','../../../../constants','from','addAttachmentToChunk','@flosum/salesforce','Writable','apply','search','5430645EyYyXQ','CompositeBinaryDeployData','3TMWVqU','changedBy','23537lwmPoD','jszip','ATTACHMENT_OBJECT_NAME','deployAttachments','createZip','4959200nZxWLD','ComponentsDeployer','length','Last_Updated_By__c','update','addOrgComponentToChunk','OrganisationName__c','apiVersion','2377912uEalQB','4438jlDKQc','Readable','type','successDeployedCounter','push','isReachedMaxChunk','BINARY_FIELD_NAME','FLOSUM_NAMESPACE','13345FVYojI','resetChunks','orgComponentsToDeployChunk','trackingSettingId','Tracking_Setting__c','15577710QtUixX','(((.+)+)+)+$','deploy','Is_Retrieved__c','__importDefault','attachmentId','revisionCounter','Is_Deleted__c','fullName','binaryRecordsSizeChunk','default','CompositeConstants','1278LZSizw','targetOrgId','Folder__c','generateAsync','nodebuffer','API_Name__c','ORG_COMPONENT_OBJECT_NAME','logger','then','application/zip','constructor','Source_Member_Id__c','log','Attachment_ID__c','records','toString','MAX_BODY_SIZE','execute','Component_Type__c','file'];a295_0x29ff=function(){return _0x5ef67f;};return a295_0x29ff();}const a295_0x3841a4=(function(){let _0xbac2e4=!![];return function(_0xa5e91f,_0x460fe0){const _0x4b0a76=_0xbac2e4?function(){const _0x409a0e=a295_0x1640;if(_0x460fe0){const _0x32a951=_0x460fe0[_0x409a0e(0x1c9)](_0xa5e91f,arguments);return _0x460fe0=null,_0x32a951;}}:function(){};return _0xbac2e4=![],_0x4b0a76;};}()),a295_0xa9a6c4=a295_0x3841a4(this,function(){const _0x25171b=a295_0x1640;return a295_0xa9a6c4['toString']()[_0x25171b(0x17a)]('(((.+)+)+)+$')[_0x25171b(0x1b5)]()[_0x25171b(0x1b0)](a295_0xa9a6c4)[_0x25171b(0x17a)](_0x25171b(0x19b));});a295_0xa9a6c4();'use strict';var __importDefault=this&&this[a295_0x43ce86(0x19e)]||function(_0x43bd1b){return _0x43bd1b&&_0x43bd1b['__esModule']?_0x43bd1b:{'default':_0x43bd1b};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a295_0x43ce86(0x185)]=void 0x0;const salesforce_1=require(a295_0x43ce86(0x1c7)),constants_1=require('../../constants'),stream_1=require('stream'),jszip_1=__importDefault(require(a295_0x43ce86(0x180))),constants_2=require(a295_0x43ce86(0x1c4)),MAX_COMPOSITE_CHUNK_COUNT=0xc8,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a295_0x43ce86(0x194)]+a295_0x43ce86(0x1b3),CONTENT_TYPE=a295_0x43ce86(0x1af);class ComponentsDeployer extends stream_1[a295_0x43ce86(0x1c8)]{constructor({apiVersion:_0xf93eb2,instance:_0x1b98d5,logger:_0x1c8d9c,targetOrgId:_0x56147d,trackingSettingId:_0x4a525b}){const _0x5a8f2b=a295_0x43ce86;super({'objectMode':!![]}),this[_0x5a8f2b(0x1c2)]={'records':[],'binary':[]},this['binaryRecordsSizeChunk']=0x0,this[_0x5a8f2b(0x197)]=[],this[_0x5a8f2b(0x190)]=0x0,this[_0x5a8f2b(0x18b)]=_0xf93eb2,this['instance']=_0x1b98d5,this[_0x5a8f2b(0x1ad)]=_0x1c8d9c,this['targetOrgId']=_0x56147d,this[_0x5a8f2b(0x198)]=_0x4a525b;}async[a295_0x43ce86(0x19c)](){const _0x4769e4=a295_0x43ce86;await this[_0x4769e4(0x182)]()['then'](_0x3c2987=>this[_0x4769e4(0x1c0)](_0x3c2987))[_0x4769e4(0x1ae)](()=>this['deployOrgComponents']())[_0x4769e4(0x1ae)](_0x2ea6f3=>this[_0x4769e4(0x1c3)](_0x2ea6f3)),this['resetChunks']();}['deployAttachments'](){const _0x3cb213=a295_0x43ce86,_0x139c7a=new salesforce_1[(_0x3cb213(0x17c))]({'instance':this[_0x3cb213(0x1bb)],'objectName':constants_1[_0x3cb213(0x181)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this[_0x3cb213(0x18b)]});return _0x139c7a[_0x3cb213(0x1b7)](this[_0x3cb213(0x1c2)]);}['deployOrgComponents'](){const _0x3f70bc=a295_0x43ce86,_0x20abac=new salesforce_1['RestSimpleDeployData']({'instance':this[_0x3f70bc(0x1bb)],'objectName':constants_1['ORG_COMPONENT_OBJECT_NAME'],'api':this[_0x3f70bc(0x18b)],'allOrNone':![],'externalIdField':'Id'});return _0x20abac['execute']({'records':this['orgComponentsToDeployChunk']});}async['handleDeployResult'](_0x2548b4){const _0x2f745d=a295_0x43ce86;for(const {success:_0x4e77ce,error:_0x280252}of _0x2548b4){if(_0x4e77ce){this[_0x2f745d(0x190)]++;continue;}_0x280252&&this['logger']['error'](_0x280252);}}[a295_0x43ce86(0x192)](_0x43ebe3){const _0x42c564=a295_0x43ce86;return _0x43ebe3+this[_0x42c564(0x1a3)]>=salesforce_1[_0x42c564(0x1a5)][_0x42c564(0x1b6)]||this[_0x42c564(0x1c2)]['records'][_0x42c564(0x186)]===MAX_COMPOSITE_CHUNK_COUNT;}[a295_0x43ce86(0x196)](){const _0x2d03f3=a295_0x43ce86;this[_0x2d03f3(0x1a3)]=0x0,this[_0x2d03f3(0x1c2)]={'records':[],'binary':[]},this['orgComponentsToDeployChunk']=[];}[a295_0x43ce86(0x1c0)](_0x2019bc){const _0x120680=a295_0x43ce86;for(const _0x2e341e in _0x2019bc){this[_0x120680(0x197)][_0x2e341e][ATTACHMENT_FIELD_NAME]=_0x2019bc[_0x2e341e]['id'];}}async[a295_0x43ce86(0x1c6)](_0x58d060,_0x94afd1){const _0x263540=a295_0x43ce86,{listMetadataItem:_0x5e0803,sourceMemberRecord:_0x220b10}=_0x58d060,_0x1a4a81={'attributes':{'type':constants_1[_0x263540(0x181)],'binaryPartName':_0x5e0803[_0x263540(0x1a2)],'binaryPartNameAlias':constants_1[_0x263540(0x193)]},'Id':_0x220b10[_0x263540(0x19f)],'Name':_0x5e0803[_0x263540(0x1a2)],'Description':_0x5e0803[_0x263540(0x18f)],'ContentType':CONTENT_TYPE,'ParentId':this[_0x263540(0x1a7)],'Body':_0x5e0803['fullName']},_0x26e394={'binaryFieldName':constants_1['BINARY_FIELD_NAME'],'name':_0x5e0803[_0x263540(0x1a2)],'value':stream_1[_0x263540(0x18e)][_0x263540(0x1c5)](_0x94afd1)};this['attachmentsToDeployChunk'][_0x263540(0x1b4)][_0x263540(0x191)](_0x1a4a81),this[_0x263540(0x1c2)][_0x263540(0x1bc)][_0x263540(0x191)](_0x26e394);}[a295_0x43ce86(0x183)](_0x508a53){const _0x38e421=a295_0x43ce86,_0x567a14=new jszip_1[(_0x38e421(0x1a4))]();for(const _0x489c87 in _0x508a53){_0x567a14[_0x38e421(0x1b9)](_0x489c87,_0x508a53[_0x489c87]);}return _0x567a14[_0x38e421(0x1a9)]({'type':_0x38e421(0x1aa)});}[a295_0x43ce86(0x189)](_0x1aa99a,_0x558b26){const _0x3dbd71=a295_0x43ce86,_0x4d16af={'attributes':{'type':constants_1[_0x3dbd71(0x1ac)]},'Id':_0x558b26['componentId'],[constants_2[_0x3dbd71(0x194)]+_0x3dbd71(0x1a1)]:_0x558b26[_0x3dbd71(0x1ba)],[constants_2['FLOSUM_NAMESPACE']+'Revision_Counter__c']:_0x558b26[_0x3dbd71(0x1a0)],[constants_2[_0x3dbd71(0x194)]+_0x3dbd71(0x1b1)]:_0x558b26['sourceMemberId'],[constants_2['FLOSUM_NAMESPACE']+_0x3dbd71(0x187)]:_0x558b26[_0x3dbd71(0x17e)],[constants_2[_0x3dbd71(0x194)]+_0x3dbd71(0x1ab)]:_0x1aa99a[_0x3dbd71(0x1a2)],[constants_2['FLOSUM_NAMESPACE']+'Name__c']:_0x1aa99a['fullName'],[constants_2[_0x3dbd71(0x194)]+_0x3dbd71(0x1b8)]:_0x1aa99a[_0x3dbd71(0x18f)],[constants_2['FLOSUM_NAMESPACE']+'Label__c']:_0x1aa99a[_0x3dbd71(0x1c1)],[constants_2[_0x3dbd71(0x194)]+_0x3dbd71(0x1a8)]:constants_1['METADATA_FOLDER_MAP'][_0x3dbd71(0x1bf)](_0x1aa99a[_0x3dbd71(0x18f)])||null,[constants_2[_0x3dbd71(0x194)]+_0x3dbd71(0x19d)]:!![],[constants_2[_0x3dbd71(0x194)]+_0x3dbd71(0x18a)]:this[_0x3dbd71(0x1a7)],[constants_2[_0x3dbd71(0x194)]+_0x3dbd71(0x199)]:this[_0x3dbd71(0x198)],[constants_2[_0x3dbd71(0x194)]+'Status__c']:_0x3dbd71(0x1be)};this[_0x3dbd71(0x197)]['push'](_0x4d16af);}async['_write'](_0x1db66b,_0x47b0f1,_0x1cd613){const _0x4ee242=a295_0x43ce86;try{const {listMetadataItem:_0x385e9c,sourceMemberRecord:_0x501ba5,files:_0x280637}=_0x1db66b,_0x366243=await this[_0x4ee242(0x183)](_0x280637),_0x5bd2f8=Buffer['byteLength'](_0x366243);this[_0x4ee242(0x192)](_0x5bd2f8)&&await this[_0x4ee242(0x19c)](),this[_0x4ee242(0x1a3)]+=_0x5bd2f8,await this[_0x4ee242(0x1c6)](_0x1db66b,_0x366243),this[_0x4ee242(0x189)](_0x385e9c,_0x501ba5),_0x1cd613();}catch(_0x53445e){_0x1cd613(_0x53445e);}}async['_final'](_0x1d5951){const _0x34af6d=a295_0x43ce86;try{this[_0x34af6d(0x1c2)][_0x34af6d(0x1b4)]['length']&&this['orgComponentsToDeployChunk'][_0x34af6d(0x186)]&&await this[_0x34af6d(0x19c)](),this[_0x34af6d(0x1ad)][_0x34af6d(0x1b2)]('Process\x20completed\x20for\x20'+this[_0x34af6d(0x190)]+'\x20components'),await this['logger'][_0x34af6d(0x188)](),_0x1d5951();}catch(_0x645e89){_0x1d5951(_0x645e89);}}}function a295_0x1640(_0x7df92d,_0xe3388b){const _0x2f9e1c=a295_0x29ff();return a295_0x1640=function(_0xa9a6c4,_0x3841a4){_0xa9a6c4=_0xa9a6c4-0x17a;let _0x29ff01=_0x2f9e1c[_0xa9a6c4];return _0x29ff01;},a295_0x1640(_0x7df92d,_0xe3388b);}exports['ComponentsDeployer']=ComponentsDeployer;