const a340_0x22f13b=a340_0xd44d;(function(_0x57994f,_0x462a3d){const _0x3b70e9=a340_0xd44d,_0x28a1d2=_0x57994f();while(!![]){try{const _0x23e82f=parseInt(_0x3b70e9(0x1a5))/0x1+parseInt(_0x3b70e9(0x180))/0x2*(parseInt(_0x3b70e9(0x1a8))/0x3)+-parseInt(_0x3b70e9(0x178))/0x4*(parseInt(_0x3b70e9(0x1a6))/0x5)+parseInt(_0x3b70e9(0x18a))/0x6*(-parseInt(_0x3b70e9(0x1b6))/0x7)+parseInt(_0x3b70e9(0x16c))/0x8+parseInt(_0x3b70e9(0x170))/0x9*(parseInt(_0x3b70e9(0x177))/0xa)+-parseInt(_0x3b70e9(0x16a))/0xb;if(_0x23e82f===_0x462a3d)break;else _0x28a1d2['push'](_0x28a1d2['shift']());}catch(_0x1b751b){_0x28a1d2['push'](_0x28a1d2['shift']());}}}(a340_0x411a,0x5b8df));function a340_0xd44d(_0x4e486e,_0x1d7f05){const _0x29d390=a340_0x411a();return a340_0xd44d=function(_0x266235,_0x3868c6){_0x266235=_0x266235-0x169;let _0x411ab1=_0x29d390[_0x266235];return _0x411ab1;},a340_0xd44d(_0x4e486e,_0x1d7f05);}const a340_0x3868c6=(function(){let _0x2d6e33=!![];return function(_0x3b54ff,_0x1db288){const _0x6affd0=_0x2d6e33?function(){const _0x288bfd=a340_0xd44d;if(_0x1db288){const _0x53b8d6=_0x1db288[_0x288bfd(0x193)](_0x3b54ff,arguments);return _0x1db288=null,_0x53b8d6;}}:function(){};return _0x2d6e33=![],_0x6affd0;};}()),a340_0x266235=a340_0x3868c6(this,function(){const _0xd52275=a340_0xd44d;return a340_0x266235['toString']()['search'](_0xd52275(0x1a1))['toString']()[_0xd52275(0x19e)](a340_0x266235)[_0xd52275(0x1bd)](_0xd52275(0x1a1));});a340_0x266235();function a340_0x411a(){const _0x549efc=['addAttachmentToChunk','Process\x20completed\x20for\x20','4005393FzfCYt','stream','attachmentsToDeployChunk','binaryRecordsSizeChunk','Too\x20Large','Component_Type__c','log','search','CompositeConstants','_final','@flosum/salesforce','resetChunks','../../constants','handleDeployResult','4027144uutFZQ','MAX_BODY_SIZE','4047440BTPbmZ','Attachment_ID__c','generateAsync','RestSimpleDeployData','4311XdryEf','Name__c','_write','\x20components','Component\x20too\x20large.\x20Type:\x20','BINARY_FIELD_NAME','jszip','2770yzcibD','80kTyxEy','Folder__c','trackingSettingId','ORG_COMPONENT_OBJECT_NAME','__importDefault','ATTACHMENT_OBJECT_NAME','logger','then','758iYSubY','__esModule','records','../../../../constants','Writable','componentId','Is_Deleted__c','Status__c','Retrieved','FLOSUM_NAMESPACE','6xDAPEn','addOrgComponentToChunk','orgComponentsToDeployChunk','execute','CompositeBinaryDeployData','fileName','successDeployedCounter','changedBy','Is_Retrieved__c','apply','isNameObsolete','binary','ComponentsDeployer','METADATA_FOLDER_MAP',',\x20Name:\x20','push','type','byteLength','attachmentId','error','constructor','isReachedMaxChunk','deploy','(((.+)+)+)+$','Readable','defineProperty','createZip','90231aPzHqd','37130VvuMfx','instance','5802RsodrE','revisionCounter','file','deployOrgComponents','apiVersion','populateAttachmentId','length','targetOrgId','has','update','Label__c','fullName'];a340_0x411a=function(){return _0x549efc;};return a340_0x411a();}'use strict';var __importDefault=this&&this[a340_0x22f13b(0x17c)]||function(_0x2d1a3a){const _0x1a85ca=a340_0x22f13b;return _0x2d1a3a&&_0x2d1a3a[_0x1a85ca(0x181)]?_0x2d1a3a:{'default':_0x2d1a3a};};Object[a340_0x22f13b(0x1a3)](exports,a340_0x22f13b(0x181),{'value':!![]}),exports[a340_0x22f13b(0x196)]=void 0x0;const salesforce_1=require(a340_0x22f13b(0x1c0)),constants_1=require(a340_0x22f13b(0x1c2)),stream_1=require(a340_0x22f13b(0x1b7)),jszip_1=__importDefault(require(a340_0x22f13b(0x176))),constants_2=require(a340_0x22f13b(0x183)),MAX_COMPOSITE_CHUNK_COUNT=0xc8,MAX_SINGLE_FILE_SIZE=0x5a06e0,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a340_0x22f13b(0x189)]+a340_0x22f13b(0x16d),CONTENT_TYPE='application/zip';class ComponentsDeployer extends stream_1[a340_0x22f13b(0x184)]{constructor({apiVersion:_0x9d73c8,instance:_0x1d97c6,logger:_0x2d1d7d,targetOrgId:_0x5edb12,trackingSettingId:_0x395f2f}){const _0x517e05=a340_0x22f13b;super({'objectMode':!![]}),this[_0x517e05(0x1b8)]={'records':[],'binary':[]},this[_0x517e05(0x1b9)]=0x0,this['orgComponentsToDeployChunk']=[],this['successDeployedCounter']=0x0,this[_0x517e05(0x1ac)]=_0x9d73c8,this[_0x517e05(0x1a7)]=_0x1d97c6,this['logger']=_0x2d1d7d,this[_0x517e05(0x1af)]=_0x5edb12,this['trackingSettingId']=_0x395f2f;}async[a340_0x22f13b(0x1a0)](){const _0xf627dd=a340_0x22f13b;await this['deployAttachments']()[_0xf627dd(0x17f)](_0x2145be=>this[_0xf627dd(0x1ad)](_0x2145be))[_0xf627dd(0x17f)](()=>this[_0xf627dd(0x1ab)]())[_0xf627dd(0x17f)](_0x207306=>this[_0xf627dd(0x169)](_0x207306)),this[_0xf627dd(0x1c1)]();}['deployAttachments'](){const _0x556fe4=a340_0x22f13b,_0x42ec00=new salesforce_1[(_0x556fe4(0x18e))]({'instance':this[_0x556fe4(0x1a7)],'objectName':constants_1[_0x556fe4(0x17d)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this[_0x556fe4(0x1ac)]});return _0x42ec00[_0x556fe4(0x18d)](this[_0x556fe4(0x1b8)]);}[a340_0x22f13b(0x1ab)](){const _0x6f16fd=a340_0x22f13b,_0xc622a3=new salesforce_1[(_0x6f16fd(0x16f))]({'instance':this[_0x6f16fd(0x1a7)],'objectName':constants_1[_0x6f16fd(0x17b)],'api':this[_0x6f16fd(0x1ac)],'allOrNone':![],'externalIdField':'Id'});return _0xc622a3[_0x6f16fd(0x18d)]({'records':this[_0x6f16fd(0x18c)]});}async['handleDeployResult'](_0x8cea73){const _0xb2a6fc=a340_0x22f13b;for(const {success:_0x22eb3b,error:_0xa20840}of _0x8cea73){if(_0x22eb3b){this[_0xb2a6fc(0x190)]++;continue;}_0xa20840&&this[_0xb2a6fc(0x17e)][_0xb2a6fc(0x19d)](_0xa20840);}}[a340_0x22f13b(0x19f)](_0x489fbe){const _0x2e0812=a340_0x22f13b;return _0x489fbe+this[_0x2e0812(0x1b9)]>=salesforce_1[_0x2e0812(0x1be)][_0x2e0812(0x16b)]||this[_0x2e0812(0x1b8)][_0x2e0812(0x182)]['length']===MAX_COMPOSITE_CHUNK_COUNT;}[a340_0x22f13b(0x1c1)](){const _0x224e09=a340_0x22f13b;this[_0x224e09(0x1b9)]=0x0,this[_0x224e09(0x1b8)]={'records':[],'binary':[]},this[_0x224e09(0x18c)]=[];}['populateAttachmentId'](_0x27103a){const _0x1a9ec8=a340_0x22f13b;for(const _0x5257f0 in _0x27103a){this[_0x1a9ec8(0x18c)][_0x5257f0][ATTACHMENT_FIELD_NAME]=_0x27103a[_0x5257f0]['id'];}}async[a340_0x22f13b(0x1b4)](_0x588daa,_0x5225f3){const _0x462f79=a340_0x22f13b,{listMetadataItem:_0xf4605d,sourceMemberRecord:_0x9fea92}=_0x588daa,_0x44af1f={'attributes':{'type':constants_1[_0x462f79(0x17d)],'binaryPartName':_0xf4605d['fullName'],'binaryPartNameAlias':constants_1[_0x462f79(0x175)]},'Id':_0x9fea92[_0x462f79(0x19c)],'Name':_0xf4605d[_0x462f79(0x1b3)],'Description':_0xf4605d[_0x462f79(0x19a)],'ContentType':CONTENT_TYPE,'ParentId':this[_0x462f79(0x1af)],'Body':_0xf4605d[_0x462f79(0x1b3)]},_0x40b1b9={'binaryFieldName':constants_1[_0x462f79(0x175)],'name':_0xf4605d[_0x462f79(0x1b3)],'value':stream_1[_0x462f79(0x1a2)]['from'](_0x5225f3)};this[_0x462f79(0x1b8)]['records']['push'](_0x44af1f),this[_0x462f79(0x1b8)][_0x462f79(0x195)][_0x462f79(0x199)](_0x40b1b9);}[a340_0x22f13b(0x1a4)](_0x2e17b2){const _0x42b533=a340_0x22f13b,_0x23e015=new jszip_1['default']();for(const _0x235387 in _0x2e17b2){_0x23e015[_0x42b533(0x1aa)](_0x235387,_0x2e17b2[_0x235387]);}return _0x23e015[_0x42b533(0x16e)]({'type':'nodebuffer'});}[a340_0x22f13b(0x18b)](_0x9bdc13,_0x31da8d,_0x4b71df){const _0x439d88=a340_0x22f13b,_0x3b7764={'attributes':{'type':constants_1[_0x439d88(0x17b)]},'Id':_0x31da8d[_0x439d88(0x185)],[constants_2['FLOSUM_NAMESPACE']+_0x439d88(0x186)]:_0x31da8d[_0x439d88(0x194)],[constants_2[_0x439d88(0x189)]+'Revision_Counter__c']:_0x31da8d[_0x439d88(0x1a9)],[constants_2[_0x439d88(0x189)]+'Source_Member_Id__c']:_0x31da8d['sourceMemberId'],[constants_2[_0x439d88(0x189)]+'Last_Updated_By__c']:_0x31da8d[_0x439d88(0x191)],[constants_2[_0x439d88(0x189)]+'API_Name__c']:_0x9bdc13['fullName'],[constants_2['FLOSUM_NAMESPACE']+_0x439d88(0x171)]:_0x9bdc13[_0x439d88(0x1b3)],[constants_2[_0x439d88(0x189)]+_0x439d88(0x1bb)]:_0x9bdc13[_0x439d88(0x19a)],[constants_2[_0x439d88(0x189)]+_0x439d88(0x1b2)]:_0x9bdc13[_0x439d88(0x18f)],[constants_2[_0x439d88(0x189)]+_0x439d88(0x179)]:constants_1[_0x439d88(0x197)][_0x439d88(0x1b0)](_0x9bdc13[_0x439d88(0x19a)])||null,[constants_2[_0x439d88(0x189)]+_0x439d88(0x192)]:!![],[constants_2[_0x439d88(0x189)]+'OrganisationName__c']:this['targetOrgId'],[constants_2[_0x439d88(0x189)]+'Tracking_Setting__c']:this[_0x439d88(0x17a)],[constants_2[_0x439d88(0x189)]+_0x439d88(0x187)]:_0x4b71df>MAX_SINGLE_FILE_SIZE?_0x439d88(0x1ba):_0x439d88(0x188)};_0x4b71df>MAX_SINGLE_FILE_SIZE&&this[_0x439d88(0x17e)][_0x439d88(0x1bc)](_0x439d88(0x174)+_0x9bdc13[_0x439d88(0x19a)]+_0x439d88(0x198)+_0x9bdc13[_0x439d88(0x1b3)]),this[_0x439d88(0x18c)][_0x439d88(0x199)](_0x3b7764);}async[a340_0x22f13b(0x172)](_0x2f270d,_0x1f45e7,_0xceb8ee){const _0x3f39cf=a340_0x22f13b;try{const {listMetadataItem:_0x5bd9f8,sourceMemberRecord:_0x367080,files:_0x31fe32}=_0x2f270d,_0xdb0610=await this[_0x3f39cf(0x1a4)](_0x31fe32),_0x217a13=Buffer[_0x3f39cf(0x19b)](_0xdb0610);this['isReachedMaxChunk'](_0x217a13)&&await this[_0x3f39cf(0x1a0)](),this['binaryRecordsSizeChunk']+=_0x217a13,await this['addAttachmentToChunk'](_0x2f270d,_0xdb0610),this['addOrgComponentToChunk'](_0x5bd9f8,_0x367080,_0xdb0610[_0x3f39cf(0x1ae)]),_0xceb8ee();}catch(_0x1a8b82){_0xceb8ee(_0x1a8b82);}}async[a340_0x22f13b(0x1bf)](_0x32b9ec){const _0x12b605=a340_0x22f13b;try{this[_0x12b605(0x1b8)][_0x12b605(0x182)][_0x12b605(0x1ae)]&&this['orgComponentsToDeployChunk'][_0x12b605(0x1ae)]&&await this['deploy'](),this['logger'][_0x12b605(0x1bc)](_0x12b605(0x1b5)+this[_0x12b605(0x190)]+_0x12b605(0x173)),await this['logger'][_0x12b605(0x1b1)](),_0x32b9ec();}catch(_0x4ebe95){_0x32b9ec(_0x4ebe95);}}}exports[a340_0x22f13b(0x196)]=ComponentsDeployer;