const a339_0x167f15=a339_0x5347;function a339_0x5347(_0x5eb4d5,_0x2c020e){const _0x4d2891=a339_0x26e2();return a339_0x5347=function(_0x47316a,_0x57a877){_0x47316a=_0x47316a-0x19a;let _0x26e2a2=_0x4d2891[_0x47316a];return _0x26e2a2;},a339_0x5347(_0x5eb4d5,_0x2c020e);}(function(_0x186e91,_0x125375){const _0x71816b=a339_0x5347,_0x5b15e9=_0x186e91();while(!![]){try{const _0x166ad7=-parseInt(_0x71816b(0x1b4))/0x1+-parseInt(_0x71816b(0x1e1))/0x2*(parseInt(_0x71816b(0x1d8))/0x3)+parseInt(_0x71816b(0x1e9))/0x4*(-parseInt(_0x71816b(0x1d3))/0x5)+parseInt(_0x71816b(0x1e5))/0x6+-parseInt(_0x71816b(0x1e3))/0x7+-parseInt(_0x71816b(0x1d4))/0x8*(parseInt(_0x71816b(0x1a5))/0x9)+-parseInt(_0x71816b(0x1ab))/0xa*(-parseInt(_0x71816b(0x1cd))/0xb);if(_0x166ad7===_0x125375)break;else _0x5b15e9['push'](_0x5b15e9['shift']());}catch(_0x4bac5e){_0x5b15e9['push'](_0x5b15e9['shift']());}}}(a339_0x26e2,0x3da43));const a339_0x57a877=(function(){let _0x216031=!![];return function(_0x46b77a,_0x18716d){const _0x67b192=_0x216031?function(){const _0x3cb9a6=a339_0x5347;if(_0x18716d){const _0x531955=_0x18716d[_0x3cb9a6(0x1d2)](_0x46b77a,arguments);return _0x18716d=null,_0x531955;}}:function(){};return _0x216031=![],_0x67b192;};}()),a339_0x47316a=a339_0x57a877(this,function(){const _0x257736=a339_0x5347;return a339_0x47316a[_0x257736(0x1bb)]()[_0x257736(0x1bd)]('(((.+)+)+)+$')[_0x257736(0x1bb)]()[_0x257736(0x19b)](a339_0x47316a)[_0x257736(0x1bd)](_0x257736(0x1e2));});a339_0x47316a();'use strict';var __importDefault=this&&this[a339_0x167f15(0x1b7)]||function(_0x5b9d00){const _0x3c4ee0=a339_0x167f15;return _0x5b9d00&&_0x5b9d00[_0x3c4ee0(0x1a0)]?_0x5b9d00:{'default':_0x5b9d00};};Object[a339_0x167f15(0x1db)](exports,a339_0x167f15(0x1a0),{'value':!![]}),exports[a339_0x167f15(0x1da)]=void 0x0;const salesforce_1=require(a339_0x167f15(0x19a)),constants_1=require(a339_0x167f15(0x1e8)),stream_1=require(a339_0x167f15(0x1e4)),jszip_1=__importDefault(require('jszip')),constants_2=require('../../../../constants'),MAX_COMPOSITE_CHUNK_COUNT=0xc8,EXTERNAL_ID_FIELD='Id',ATTACHMENT_FIELD_NAME=constants_2[a339_0x167f15(0x1e6)]+a339_0x167f15(0x1dd),CONTENT_TYPE='application/zip';function a339_0x26e2(){const _0x4fc10b=['successDeployedCounter','_final','apiVersion','execute','Last_Updated_By__c','targetOrgId','881551EgShpw','ORG_COMPONENT_OBJECT_NAME','binary','Writable','push','apply','184545wIEyWH','56YSexRe','attachmentsToDeployChunk','orgComponentsToDeployChunk','fileName','39GRDsmP','resetChunks','ComponentsDeployer','defineProperty','componentId','Attachment_ID__c','instance','Status__c','deploy','2606VuHiFn','(((.+)+)+)+$','2405249CmoNKu','stream','2246502UIhUkS','FLOSUM_NAMESPACE','changedBy','../../constants','8DCaVVm','binaryRecordsSizeChunk','Process\x20completed\x20for\x20','default','Name__c','ATTACHMENT_OBJECT_NAME','@flosum/salesforce','constructor','Label__c','CompositeBinaryDeployData','BINARY_FIELD_NAME','RestSimpleDeployData','__esModule','isNameObsolete','addOrgComponentToChunk','populateAttachmentId','records','90243qSoUFW','Tracking_Setting__c','Folder__c','_write','fullName','logger','50VJUeGT','Retrieved','CompositeConstants','then','addAttachmentToChunk','handleDeployResult','Is_Retrieved__c','nodebuffer','MAX_BODY_SIZE','18086HoQezN','Is_Deleted__c','type','__importDefault','createZip','byteLength','Component_Type__c','toString','deployOrgComponents','search','OrganisationName__c','error','has','deployAttachments','update','revisionCounter','length','isReachedMaxChunk','Readable'];a339_0x26e2=function(){return _0x4fc10b;};return a339_0x26e2();}class ComponentsDeployer extends stream_1[a339_0x167f15(0x1d0)]{constructor({apiVersion:_0x1789f4,instance:_0x3db427,logger:_0x15d5c2,targetOrgId:_0x489e7e,trackingSettingId:_0x112385}){const _0x1bd25d=a339_0x167f15;super({'objectMode':!![]}),this['attachmentsToDeployChunk']={'records':[],'binary':[]},this[_0x1bd25d(0x1ea)]=0x0,this[_0x1bd25d(0x1d6)]=[],this[_0x1bd25d(0x1c7)]=0x0,this[_0x1bd25d(0x1c9)]=_0x1789f4,this[_0x1bd25d(0x1de)]=_0x3db427,this[_0x1bd25d(0x1aa)]=_0x15d5c2,this['targetOrgId']=_0x489e7e,this['trackingSettingId']=_0x112385;}async[a339_0x167f15(0x1e0)](){const _0x56ea8e=a339_0x167f15;await this[_0x56ea8e(0x1c1)]()[_0x56ea8e(0x1ae)](_0x4bd4d5=>this[_0x56ea8e(0x1a3)](_0x4bd4d5))[_0x56ea8e(0x1ae)](()=>this['deployOrgComponents']())[_0x56ea8e(0x1ae)](_0x89b892=>this[_0x56ea8e(0x1b0)](_0x89b892)),this[_0x56ea8e(0x1d9)]();}[a339_0x167f15(0x1c1)](){const _0x1178d4=a339_0x167f15,_0x2cc534=new salesforce_1[(_0x1178d4(0x19d))]({'instance':this['instance'],'objectName':constants_1[_0x1178d4(0x1ee)],'externalIdField':EXTERNAL_ID_FIELD,'allOrNone':![],'api':this[_0x1178d4(0x1c9)]});return _0x2cc534[_0x1178d4(0x1ca)](this[_0x1178d4(0x1d5)]);}[a339_0x167f15(0x1bc)](){const _0x3b5819=a339_0x167f15,_0x10d2fc=new salesforce_1[(_0x3b5819(0x19f))]({'instance':this['instance'],'objectName':constants_1[_0x3b5819(0x1ce)],'api':this[_0x3b5819(0x1c9)],'allOrNone':![],'externalIdField':'Id'});return _0x10d2fc[_0x3b5819(0x1ca)]({'records':this[_0x3b5819(0x1d6)]});}async[a339_0x167f15(0x1b0)](_0x133c45){const _0x4f3de1=a339_0x167f15;for(const {success:_0x5b7f8a,error:_0x234e00}of _0x133c45){if(_0x5b7f8a){this[_0x4f3de1(0x1c7)]++;continue;}_0x234e00&&this['logger'][_0x4f3de1(0x1bf)](_0x234e00);}}[a339_0x167f15(0x1c5)](_0x2c524b){const _0x42a4ea=a339_0x167f15;return _0x2c524b+this[_0x42a4ea(0x1ea)]>=salesforce_1[_0x42a4ea(0x1ad)][_0x42a4ea(0x1b3)]||this['attachmentsToDeployChunk'][_0x42a4ea(0x1a4)][_0x42a4ea(0x1c4)]===MAX_COMPOSITE_CHUNK_COUNT;}['resetChunks'](){const _0x401602=a339_0x167f15;this[_0x401602(0x1ea)]=0x0,this[_0x401602(0x1d5)]={'records':[],'binary':[]},this[_0x401602(0x1d6)]=[];}[a339_0x167f15(0x1a3)](_0xe54e4e){const _0x253e9d=a339_0x167f15;for(const _0x44b000 in _0xe54e4e){this[_0x253e9d(0x1d6)][_0x44b000][ATTACHMENT_FIELD_NAME]=_0xe54e4e[_0x44b000]['id'];}}async['addAttachmentToChunk'](_0x284bb6,_0x9c4cb8){const _0x2ed13a=a339_0x167f15,{listMetadataItem:_0x1764e4,sourceMemberRecord:_0x52d7f3}=_0x284bb6,_0x12a3ec={'attributes':{'type':constants_1['ATTACHMENT_OBJECT_NAME'],'binaryPartName':_0x1764e4['fullName'],'binaryPartNameAlias':constants_1[_0x2ed13a(0x19e)]},'Id':_0x52d7f3['attachmentId'],'Name':_0x1764e4[_0x2ed13a(0x1a9)],'Description':_0x1764e4[_0x2ed13a(0x1b6)],'ContentType':CONTENT_TYPE,'ParentId':this[_0x2ed13a(0x1cc)],'Body':_0x1764e4['fullName']},_0x2fc2eb={'binaryFieldName':constants_1[_0x2ed13a(0x19e)],'name':_0x1764e4[_0x2ed13a(0x1a9)],'value':stream_1[_0x2ed13a(0x1c6)]['from'](_0x9c4cb8)};this[_0x2ed13a(0x1d5)]['records']['push'](_0x12a3ec),this[_0x2ed13a(0x1d5)][_0x2ed13a(0x1cf)][_0x2ed13a(0x1d1)](_0x2fc2eb);}[a339_0x167f15(0x1b8)](_0x27061b){const _0x23ef8c=a339_0x167f15,_0x5a8718=new jszip_1[(_0x23ef8c(0x1ec))]();for(const _0xc8ff71 in _0x27061b){_0x5a8718['file'](_0xc8ff71,_0x27061b[_0xc8ff71]);}return _0x5a8718['generateAsync']({'type':_0x23ef8c(0x1b2)});}['addOrgComponentToChunk'](_0x4a15b4,_0x3f5477){const _0x342114=a339_0x167f15,_0x4ec798={'attributes':{'type':constants_1[_0x342114(0x1ce)]},'Id':_0x3f5477[_0x342114(0x1dc)],[constants_2[_0x342114(0x1e6)]+_0x342114(0x1b5)]:_0x3f5477[_0x342114(0x1a1)],[constants_2[_0x342114(0x1e6)]+'Revision_Counter__c']:_0x3f5477[_0x342114(0x1c3)],[constants_2[_0x342114(0x1e6)]+'Source_Member_Id__c']:_0x3f5477['sourceMemberId'],[constants_2[_0x342114(0x1e6)]+_0x342114(0x1cb)]:_0x3f5477[_0x342114(0x1e7)],[constants_2['FLOSUM_NAMESPACE']+'API_Name__c']:_0x4a15b4['fullName'],[constants_2['FLOSUM_NAMESPACE']+_0x342114(0x1ed)]:_0x4a15b4[_0x342114(0x1a9)],[constants_2[_0x342114(0x1e6)]+_0x342114(0x1ba)]:_0x4a15b4['type'],[constants_2[_0x342114(0x1e6)]+_0x342114(0x19c)]:_0x4a15b4[_0x342114(0x1d7)],[constants_2[_0x342114(0x1e6)]+_0x342114(0x1a7)]:constants_1['METADATA_FOLDER_MAP'][_0x342114(0x1c0)](_0x4a15b4['type'])||null,[constants_2['FLOSUM_NAMESPACE']+_0x342114(0x1b1)]:!![],[constants_2['FLOSUM_NAMESPACE']+_0x342114(0x1be)]:this[_0x342114(0x1cc)],[constants_2[_0x342114(0x1e6)]+_0x342114(0x1a6)]:this['trackingSettingId'],[constants_2[_0x342114(0x1e6)]+_0x342114(0x1df)]:_0x342114(0x1ac)};this[_0x342114(0x1d6)]['push'](_0x4ec798);}async[a339_0x167f15(0x1a8)](_0x5078b2,_0xc3e129,_0x2c59db){const _0x51a3dc=a339_0x167f15;try{const {listMetadataItem:_0x50d138,sourceMemberRecord:_0x2a8d2d,files:_0x2a8f5f}=_0x5078b2,_0x5cc066=await this['createZip'](_0x2a8f5f),_0x1b41d6=Buffer[_0x51a3dc(0x1b9)](_0x5cc066);this['isReachedMaxChunk'](_0x1b41d6)&&await this[_0x51a3dc(0x1e0)](),this[_0x51a3dc(0x1ea)]+=_0x1b41d6,await this[_0x51a3dc(0x1af)](_0x5078b2,_0x5cc066),this[_0x51a3dc(0x1a2)](_0x50d138,_0x2a8d2d),_0x2c59db();}catch(_0x45f5f2){_0x2c59db(_0x45f5f2);}}async[a339_0x167f15(0x1c8)](_0x25dc48){const _0x123942=a339_0x167f15;try{this['attachmentsToDeployChunk']['records']['length']&&this[_0x123942(0x1d6)][_0x123942(0x1c4)]&&await this['deploy'](),this[_0x123942(0x1aa)]['log'](_0x123942(0x1eb)+this['successDeployedCounter']+'\x20components'),await this['logger'][_0x123942(0x1c2)](),_0x25dc48();}catch(_0x257849){_0x25dc48(_0x257849);}}}exports[a339_0x167f15(0x1da)]=ComponentsDeployer;