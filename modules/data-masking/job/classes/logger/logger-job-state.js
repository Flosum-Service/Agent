const a58_0x5b2e71=a58_0x1401;(function(_0x36c798,_0x5f0cfb){const _0x523dcd=a58_0x1401,_0x228173=_0x36c798();while(!![]){try{const _0xdcaf71=-parseInt(_0x523dcd(0xa3))/0x1*(-parseInt(_0x523dcd(0xaf))/0x2)+parseInt(_0x523dcd(0x83))/0x3*(-parseInt(_0x523dcd(0xa4))/0x4)+-parseInt(_0x523dcd(0x9a))/0x5+parseInt(_0x523dcd(0x9f))/0x6*(-parseInt(_0x523dcd(0xb9))/0x7)+-parseInt(_0x523dcd(0x94))/0x8*(parseInt(_0x523dcd(0x91))/0x9)+parseInt(_0x523dcd(0xaa))/0xa*(parseInt(_0x523dcd(0x98))/0xb)+parseInt(_0x523dcd(0xa0))/0xc*(parseInt(_0x523dcd(0xb4))/0xd);if(_0xdcaf71===_0x5f0cfb)break;else _0x228173['push'](_0x228173['shift']());}catch(_0x20b839){_0x228173['push'](_0x228173['shift']());}}}(a58_0x3c5b,0xd9cbf));const a58_0x49ea8c=(function(){let _0xbb30fe=!![];return function(_0x40eb65,_0x58666d){const _0x1820cf=_0xbb30fe?function(){const _0x19cfc7=a58_0x1401;if(_0x58666d){const _0x184eed=_0x58666d[_0x19cfc7(0xb2)](_0x40eb65,arguments);return _0x58666d=null,_0x184eed;}}:function(){};return _0xbb30fe=![],_0x1820cf;};}()),a58_0x4ea076=a58_0x49ea8c(this,function(){const _0x336d74=a58_0x1401;return a58_0x4ea076[_0x336d74(0x97)]()[_0x336d74(0x80)](_0x336d74(0x87))[_0x336d74(0x97)]()['constructor'](a58_0x4ea076)['search'](_0x336d74(0x87));});a58_0x4ea076();function a58_0x1401(_0x4ee8e1,_0x172038){const _0x57ca09=a58_0x3c5b();return a58_0x1401=function(_0x4ea076,_0x49ea8c){_0x4ea076=_0x4ea076-0x7f;let _0x3c5ba9=_0x57ca09[_0x4ea076];return _0x3c5ba9;},a58_0x1401(_0x4ee8e1,_0x172038);}'use strict';var __importDefault=this&&this[a58_0x5b2e71(0xbb)]||function(_0x383f6c){return _0x383f6c&&_0x383f6c['__esModule']?_0x383f6c:{'default':_0x383f6c};};function a58_0x3c5b(){const _0x5ac4e4=['processed','default','9nrOQZW','write','failed','9764072YhqzjP','__esModule','defineProperty','toString','253hpBzPJ','fs/promises','1303140cJweJQ','_jobState','ObjectStatus','QUEUED','../../enums/logger.enums','138gbQeSa','24vHFqaK','setJobStatus','stringify','1022218UDaSzr','3508gGloXx','path','initJobState','init','_isLoggerInit','setJobError','671350NKZAZX','error','jobState','../../job-detail','COMPLETED','2hpAMZf','filePath','status','apply','isLoggerInit','10271573zyxUwI','parse','getTime','setObjectStatus','_jobPath','260519XsUdEt','completedDate','__importDefault','readFile','includes','search','getObjectState','updateLoggerState','3138QJTLKi','join','BaseLogger','jobStorePath','(((.+)+)+)+$','JOB_LOG_STATE_FILENAME','successful','FsUtils','./base-logger','initObjectStatistics','LoggerJobState','name'];a58_0x3c5b=function(){return _0x5ac4e4;};return a58_0x3c5b();}Object[a58_0x5b2e71(0x96)](exports,a58_0x5b2e71(0x95),{'value':!![]}),exports[a58_0x5b2e71(0x8d)]=void 0x0;const path_1=__importDefault(require(a58_0x5b2e71(0xa5))),logger_enums_1=require(a58_0x5b2e71(0x9e)),base_logger_1=require(a58_0x5b2e71(0x8b)),promises_1=require(a58_0x5b2e71(0x99)),job_detail_1=require(a58_0x5b2e71(0xad)),utils_1=require('@flosum/utils'),job_1=require('../../../../../constants/job');class LoggerJobState extends base_logger_1[a58_0x5b2e71(0x85)]{constructor(){const _0xb6166f=a58_0x5b2e71;super(...arguments),this[_0xb6166f(0xa8)]=![];}get[a58_0x5b2e71(0xb3)](){const _0xc230dd=a58_0x5b2e71;return this[_0xc230dd(0xa8)];}set[a58_0x5b2e71(0xb3)](_0x4dc9b3){this['_isLoggerInit']=_0x4dc9b3;}get[a58_0x5b2e71(0xac)](){const _0x263703=a58_0x5b2e71;if(!this[_0x263703(0xb3)])throw new Error('Logger\x20Job\x20State\x20wasn\x27t\x20init');return this['_jobState'];}get[a58_0x5b2e71(0xb0)](){const _0x1e1c7a=a58_0x5b2e71;return path_1[_0x1e1c7a(0x90)][_0x1e1c7a(0x84)](this[_0x1e1c7a(0xb8)],job_1['JOB_LOG_STATE_FILENAME']);}async[a58_0x5b2e71(0xa7)](_0x223d69){const _0x117854=a58_0x5b2e71;return this[_0x117854(0x9b)]=await this['getJobState'](),this[_0x117854(0x9b)][_0x117854(0x8f)]=this[_0x117854(0x8c)](_0x223d69),await this[_0x117854(0x92)](),await this['start'](),this[_0x117854(0xb3)]=!![],this;}[a58_0x5b2e71(0xb7)](_0x108389,_0x6e7805){const _0x8069dd=a58_0x5b2e71;this[_0x8069dd(0x81)](_0x108389)['status']=_0x6e7805,this['updateLoggerState']();}[a58_0x5b2e71(0xa1)](_0x1f34af){const _0x5d2edb=a58_0x5b2e71;this['jobState'][_0x5d2edb(0xb1)]=_0x1f34af,[logger_enums_1['JobStatus']['FAILED'],logger_enums_1['JobStatus'][_0x5d2edb(0xae)]][_0x5d2edb(0x7f)](_0x1f34af)&&(this[_0x5d2edb(0xac)][_0x5d2edb(0xba)]=new Date()[_0x5d2edb(0xb6)]()),this[_0x5d2edb(0x82)]();}[a58_0x5b2e71(0xa9)](_0x5db624){const _0x5e8598=a58_0x5b2e71;this[_0x5e8598(0xac)][_0x5e8598(0xab)]=_0x5db624,this[_0x5e8598(0x82)]();}['updateObjectProcess'](_0x5eb763,_0x4f3b07,_0x5bc178){const _0x8d0f15=a58_0x5b2e71,_0x4bbb75=this[_0x8d0f15(0x81)](_0x5eb763);_0x4bbb75[_0x8d0f15(0x89)]+=_0x4f3b07,_0x4bbb75[_0x8d0f15(0x93)]+=_0x5bc178,this[_0x8d0f15(0xac)][_0x8d0f15(0x89)]+=_0x4f3b07,this[_0x8d0f15(0xac)][_0x8d0f15(0x93)]+=_0x5bc178,this[_0x8d0f15(0x82)]();}['getObjectState'](_0x3c436d){const _0xb92ace=a58_0x5b2e71;var _0x170d19;const _0x33575b=(_0x170d19=this['jobState'][_0xb92ace(0x8f)])===null||_0x170d19===void 0x0?void 0x0:_0x170d19['find'](_0x13ac6a=>_0x13ac6a[_0xb92ace(0x8e)]===_0x3c436d);if(!_0x33575b)throw new Error('Cannot\x20find\x20object\x20\x27'+_0x3c436d+'\x27\x20in\x20statistic');return _0x33575b;}async['getJobState'](){const _0x434e9c=a58_0x5b2e71;if(!await utils_1[_0x434e9c(0x8a)]['isExistsPath'](this[_0x434e9c(0xb0)]))return this['initJobState']();const _0x60a466=await(0x0,promises_1[_0x434e9c(0xbc)])(job_detail_1[_0x434e9c(0x86)]+'/'+job_1[_0x434e9c(0x88)],{'encoding':'utf-8'});return JSON[_0x434e9c(0xb5)](_0x60a466);}[a58_0x5b2e71(0xa6)](){const _0x18e75e=a58_0x5b2e71;return{'id':this['_jobId'],'status':logger_enums_1['JobStatus'][_0x18e75e(0x9d)],'processed':[],'createdDate':new Date()[_0x18e75e(0xb6)](),'successful':0x0,'failed':0x0};}['initObjectStatistics'](_0x1c83bc){const _0x557e6d=a58_0x5b2e71;return _0x1c83bc['map'](_0x1e9333=>({'name':_0x1e9333,'status':logger_enums_1[_0x557e6d(0x9c)][_0x557e6d(0x9d)],'failed':0x0,'successful':0x0}));}[a58_0x5b2e71(0x92)](){const _0x27bffc=a58_0x5b2e71;return(0x0,promises_1['writeFile'])(this[_0x27bffc(0xb0)],JSON[_0x27bffc(0xa2)](this['_jobState']));}}exports['LoggerJobState']=LoggerJobState;