const a58_0x1caf1c=a58_0x5e3b;function a58_0x32d1(){const _0xb19a19=['JOB_LOG_STATE_FILENAME','start','fs/promises','jobStorePath','default','successful','status','isLoggerInit','join','isExistsPath','init','LoggerJobState','setJobStatus','jobState','726CjmSxe','utf-8','getObjectState','failed','\x27\x20in\x20statistic','45IPOopC','_jobState','getTime','2TNTfMs','updateLoggerState','path','search','processed','4300119GBIHQV','__esModule','3303950KCnGwp','getJobState','error','initJobState','JobStatus','write','_jobPath','writeFile','setObjectStatus','FsUtils','BaseLogger','FAILED','map','setJobError','67473hXQfjr','5438516tlxMue','QUEUED','includes','initObjectStatistics','(((.+)+)+)+$','11065968ygaQsQ','1453990xtfKLi','544448UAMvsn','filePath','_isLoggerInit','readFile'];a58_0x32d1=function(){return _0xb19a19;};return a58_0x32d1();}(function(_0x5ceaf4,_0x2a33b5){const _0x6940b5=a58_0x5e3b,_0xe3dc48=_0x5ceaf4();while(!![]){try{const _0x1151e8=-parseInt(_0x6940b5(0xe7))/0x1*(-parseInt(_0x6940b5(0x101))/0x2)+parseInt(_0x6940b5(0x106))/0x3+parseInt(_0x6940b5(0x117))/0x4+parseInt(_0x6940b5(0x108))/0x5+-parseInt(_0x6940b5(0xf9))/0x6*(parseInt(_0x6940b5(0x116))/0x7)+-parseInt(_0x6940b5(0x11c))/0x8+parseInt(_0x6940b5(0xfe))/0x9*(-parseInt(_0x6940b5(0xe6))/0xa);if(_0x1151e8===_0x2a33b5)break;else _0xe3dc48['push'](_0xe3dc48['shift']());}catch(_0x26cc10){_0xe3dc48['push'](_0xe3dc48['shift']());}}}(a58_0x32d1,0xb0310));const a58_0x704116=(function(){let _0x4059c9=!![];return function(_0x207212,_0x2ec501){const _0x42ff52=_0x4059c9?function(){if(_0x2ec501){const _0x5bbcf5=_0x2ec501['apply'](_0x207212,arguments);return _0x2ec501=null,_0x5bbcf5;}}:function(){};return _0x4059c9=![],_0x42ff52;};}()),a58_0x1c85f8=a58_0x704116(this,function(){const _0x2e6816=a58_0x5e3b;return a58_0x1c85f8['toString']()[_0x2e6816(0x104)](_0x2e6816(0x11b))['toString']()['constructor'](a58_0x1c85f8)['search'](_0x2e6816(0x11b));});a58_0x1c85f8();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x270d8a){const _0x5a0af9=a58_0x5e3b;return _0x270d8a&&_0x270d8a[_0x5a0af9(0x107)]?_0x270d8a:{'default':_0x270d8a};};Object['defineProperty'](exports,a58_0x1caf1c(0x107),{'value':!![]}),exports[a58_0x1caf1c(0xf6)]=void 0x0;const path_1=__importDefault(require(a58_0x1caf1c(0x103))),logger_enums_1=require('../../enums/logger.enums'),base_logger_1=require('./base-logger'),promises_1=require(a58_0x1caf1c(0xed)),job_detail_1=require('../../job-detail'),utils_1=require('@flosum/utils'),job_1=require('../../../../../constants/job');function a58_0x5e3b(_0x27dc95,_0x1ef72e){const _0x5ab93d=a58_0x32d1();return a58_0x5e3b=function(_0x1c85f8,_0x704116){_0x1c85f8=_0x1c85f8-0xe6;let _0x32d196=_0x5ab93d[_0x1c85f8];return _0x32d196;},a58_0x5e3b(_0x27dc95,_0x1ef72e);}class LoggerJobState extends base_logger_1[a58_0x1caf1c(0x112)]{constructor(){const _0x89fe18=a58_0x1caf1c;super(...arguments),this[_0x89fe18(0xe9)]=![];}get[a58_0x1caf1c(0xf2)](){return this['_isLoggerInit'];}set[a58_0x1caf1c(0xf2)](_0x89c1fe){const _0x2238d2=a58_0x1caf1c;this[_0x2238d2(0xe9)]=_0x89c1fe;}get[a58_0x1caf1c(0xf8)](){const _0x695e0b=a58_0x1caf1c;if(!this[_0x695e0b(0xf2)])throw new Error('Logger\x20Job\x20State\x20wasn\x27t\x20init');return this[_0x695e0b(0xff)];}get[a58_0x1caf1c(0xe8)](){const _0x2c85fc=a58_0x1caf1c;return path_1[_0x2c85fc(0xef)][_0x2c85fc(0xf3)](this[_0x2c85fc(0x10e)],job_1[_0x2c85fc(0xeb)]);}async[a58_0x1caf1c(0xf5)](_0x5064bf){const _0x5c792b=a58_0x1caf1c;return this[_0x5c792b(0xff)]=await this[_0x5c792b(0x109)](),this['_jobState'][_0x5c792b(0x105)]=this[_0x5c792b(0x11a)](_0x5064bf),await this[_0x5c792b(0x10d)](),await this[_0x5c792b(0xec)](),this[_0x5c792b(0xf2)]=!![],this;}[a58_0x1caf1c(0x110)](_0x557f70,_0x3460d8){const _0x202d7b=a58_0x1caf1c;this[_0x202d7b(0xfb)](_0x557f70)[_0x202d7b(0xf1)]=_0x3460d8,this['updateLoggerState']();}[a58_0x1caf1c(0xf7)](_0xc887ea){const _0x425820=a58_0x1caf1c;this['jobState'][_0x425820(0xf1)]=_0xc887ea,[logger_enums_1[_0x425820(0x10c)][_0x425820(0x113)],logger_enums_1[_0x425820(0x10c)]['COMPLETED']][_0x425820(0x119)](_0xc887ea)&&(this[_0x425820(0xf8)]['completedDate']=new Date()[_0x425820(0x100)]()),this[_0x425820(0x102)]();}[a58_0x1caf1c(0x115)](_0x37fd05){const _0x5b21a5=a58_0x1caf1c;this[_0x5b21a5(0xf8)][_0x5b21a5(0x10a)]=_0x37fd05,this[_0x5b21a5(0x102)]();}['updateObjectProcess'](_0x9a6ffa,_0x4a3c1d,_0x52523a){const _0x5a7807=a58_0x1caf1c,_0x40d249=this[_0x5a7807(0xfb)](_0x9a6ffa);_0x40d249[_0x5a7807(0xf0)]+=_0x4a3c1d,_0x40d249[_0x5a7807(0xfc)]+=_0x52523a,this['jobState'][_0x5a7807(0xf0)]+=_0x4a3c1d,this[_0x5a7807(0xf8)][_0x5a7807(0xfc)]+=_0x52523a,this['updateLoggerState']();}[a58_0x1caf1c(0xfb)](_0x323e6f){const _0x1c40d4=a58_0x1caf1c;var _0x2e28b9;const _0x25cae5=(_0x2e28b9=this['jobState'][_0x1c40d4(0x105)])===null||_0x2e28b9===void 0x0?void 0x0:_0x2e28b9['find'](_0x250f66=>_0x250f66['name']===_0x323e6f);if(!_0x25cae5)throw new Error('Cannot\x20find\x20object\x20\x27'+_0x323e6f+_0x1c40d4(0xfd));return _0x25cae5;}async[a58_0x1caf1c(0x109)](){const _0x4fbeec=a58_0x1caf1c;if(!await utils_1[_0x4fbeec(0x111)][_0x4fbeec(0xf4)](this[_0x4fbeec(0xe8)]))return this[_0x4fbeec(0x10b)]();const _0x28d266=await(0x0,promises_1[_0x4fbeec(0xea)])(job_detail_1[_0x4fbeec(0xee)]+'/'+job_1[_0x4fbeec(0xeb)],{'encoding':_0x4fbeec(0xfa)});return JSON['parse'](_0x28d266);}[a58_0x1caf1c(0x10b)](){const _0xd40fac=a58_0x1caf1c;return{'id':this['_jobId'],'status':logger_enums_1[_0xd40fac(0x10c)]['QUEUED'],'processed':[],'createdDate':new Date()['getTime'](),'successful':0x0,'failed':0x0};}[a58_0x1caf1c(0x11a)](_0x10c78e){const _0x5d2303=a58_0x1caf1c;return _0x10c78e[_0x5d2303(0x114)](_0x16c44d=>({'name':_0x16c44d,'status':logger_enums_1['ObjectStatus'][_0x5d2303(0x118)],'failed':0x0,'successful':0x0}));}[a58_0x1caf1c(0x10d)](){const _0x340e3a=a58_0x1caf1c;return(0x0,promises_1[_0x340e3a(0x10f)])(this[_0x340e3a(0xe8)],JSON['stringify'](this[_0x340e3a(0xff)]));}}exports[a58_0x1caf1c(0xf6)]=LoggerJobState;