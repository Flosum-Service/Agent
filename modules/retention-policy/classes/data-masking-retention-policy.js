const a308_0x1c386e=a308_0x400e;(function(_0xa2fb13,_0x4ca54a){const _0x514e7a=a308_0x400e,_0x788068=_0xa2fb13();while(!![]){try{const _0x170f36=-parseInt(_0x514e7a(0x20b))/0x1+parseInt(_0x514e7a(0x215))/0x2+parseInt(_0x514e7a(0x1fd))/0x3+parseInt(_0x514e7a(0x205))/0x4+parseInt(_0x514e7a(0x210))/0x5+-parseInt(_0x514e7a(0x204))/0x6+-parseInt(_0x514e7a(0x1f9))/0x7*(parseInt(_0x514e7a(0x1f8))/0x8);if(_0x170f36===_0x4ca54a)break;else _0x788068['push'](_0x788068['shift']());}catch(_0x4b9b0c){_0x788068['push'](_0x788068['shift']());}}}(a308_0x517c,0x1a2d8));const a308_0x2b3fd0=(function(){let _0x2713ca=!![];return function(_0x2b9335,_0x12827f){const _0x1c31f9=_0x2713ca?function(){const _0x651025=a308_0x400e;if(_0x12827f){const _0x23eb84=_0x12827f[_0x651025(0x1fe)](_0x2b9335,arguments);return _0x12827f=null,_0x23eb84;}}:function(){};return _0x2713ca=![],_0x1c31f9;};}()),a308_0x1a746=a308_0x2b3fd0(this,function(){const _0x176733=a308_0x400e;return a308_0x1a746[_0x176733(0x20c)]()[_0x176733(0x1fc)](_0x176733(0x203))[_0x176733(0x20c)]()['constructor'](a308_0x1a746)[_0x176733(0x1fc)](_0x176733(0x203));});function a308_0x400e(_0x89a30c,_0x4116c3){const _0x5cbb07=a308_0x517c();return a308_0x400e=function(_0x1a746,_0x2b3fd0){_0x1a746=_0x1a746-0x1f1;let _0x517c54=_0x5cbb07[_0x1a746];return _0x517c54;},a308_0x400e(_0x89a30c,_0x4116c3);}a308_0x1a746();'use strict';var __importDefault=this&&this[a308_0x1c386e(0x1f1)]||function(_0x2c127c){const _0x50c0e5=a308_0x1c386e;return _0x2c127c&&_0x2c127c[_0x50c0e5(0x1f6)]?_0x2c127c:{'default':_0x2c127c};};Object[a308_0x1c386e(0x207)](exports,a308_0x1c386e(0x1f6),{'value':!![]}),exports['DataMaskingRetentionPolicy']=void 0x0;const promises_1=require('fs/promises'),core_1=require('../../../core'),utils_1=require(a308_0x1c386e(0x212)),job_1=require(a308_0x1c386e(0x213)),job_utils_1=__importDefault(require(a308_0x1c386e(0x209))),masking_service_1=require(a308_0x1c386e(0x200)),path_1=__importDefault(require(a308_0x1c386e(0x1fb)));function a308_0x517c(){const _0x161431=['423372YXFvzX','completedDate','defineProperty','error','../../shared/utils/job.utils','logger','94060oQtxTR','toString','isExpiredDate','deleteJob','join','859775JMDjzY','maskingFolderPath','@flosum/utils','../../../constants/job','isExistsPath','331354LvcIfG','FsUtils','parse','readFile','MaskingService','__importDefault','DataMaskingRetentionPolicy','getJobsIds','default','filterExpiredJobs','__esModule','push','48osCFQD','275051kYHXMc','getJobCompletedDate','path','search','329049YAZFWf','apply','execute','../../data-masking/services/masking.service','utf-8','EXPIRED_RANGE_DATE','(((.+)+)+)+$','696696vBeTee'];a308_0x517c=function(){return _0x161431;};return a308_0x517c();}class DataMaskingRetentionPolicy{constructor(){const _0x3891de=a308_0x1c386e;this[_0x3891de(0x202)]=0x9a7ec800,this[_0x3891de(0x20a)]=new core_1['Logger'](DataMaskingRetentionPolicy['name']);}async[a308_0x1c386e(0x1ff)](){const _0x263991=a308_0x1c386e;try{const _0x320e47=await job_utils_1[_0x263991(0x1f4)][_0x263991(0x1f3)](masking_service_1[_0x263991(0x219)][_0x263991(0x211)]),_0xa51160=await this['filterExpiredJobs'](_0x320e47);for(const _0xc18200 of _0xa51160){await this[_0x263991(0x20e)](_0xc18200);}}catch(_0x1b85af){this['logger'][_0x263991(0x208)](_0x1b85af);}}async[a308_0x1c386e(0x1f5)](_0xfdb4cf){const _0x2357cf=a308_0x1c386e,_0x2f0efc=[];for(const _0x4d5a84 of _0xfdb4cf){const _0x17b31c=await this[_0x2357cf(0x1fa)](_0x4d5a84),_0xb58a3a=_0x17b31c&&this[_0x2357cf(0x20d)](_0x17b31c);_0xb58a3a&&_0x2f0efc[_0x2357cf(0x1f7)](_0x4d5a84);}return _0x2f0efc;}async[a308_0x1c386e(0x1fa)](_0x44d33b){const _0x187112=a308_0x1c386e;var _0xf20b4f;const _0x24a1c5=path_1[_0x187112(0x1f4)][_0x187112(0x20f)](masking_service_1[_0x187112(0x219)][_0x187112(0x211)],_0x44d33b,job_1['JOB_LOG_STATE_FILENAME']);if(!await utils_1[_0x187112(0x216)][_0x187112(0x214)](_0x24a1c5))return null;const _0x33f30a=await(0x0,promises_1[_0x187112(0x218)])(_0x24a1c5,{'encoding':_0x187112(0x201)});return(_0xf20b4f=JSON[_0x187112(0x217)](_0x33f30a)[_0x187112(0x206)])!==null&&_0xf20b4f!==void 0x0?_0xf20b4f:null;}[a308_0x1c386e(0x20d)](_0x40e39c){return new Date()['getTime']()-_0x40e39c>this['EXPIRED_RANGE_DATE'];}['deleteJob'](_0x37130e){const _0x51354b=a308_0x1c386e,_0x2b72d6=path_1[_0x51354b(0x1f4)]['join'](masking_service_1[_0x51354b(0x219)][_0x51354b(0x211)],_0x37130e);return(0x0,promises_1['rm'])(_0x2b72d6,{'recursive':!![],'force':!![]});}}exports[a308_0x1c386e(0x1f2)]=DataMaskingRetentionPolicy;