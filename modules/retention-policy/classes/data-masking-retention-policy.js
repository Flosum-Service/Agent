const a264_0xcd8d71=a264_0x11e6;function a264_0x11e6(_0x28a14d,_0x3378d7){const _0x10eff8=a264_0x1815();return a264_0x11e6=function(_0x1cc97b,_0x1820f){_0x1cc97b=_0x1cc97b-0x1f3;let _0x181547=_0x10eff8[_0x1cc97b];return _0x181547;},a264_0x11e6(_0x28a14d,_0x3378d7);}(function(_0x343330,_0x37be81){const _0x31f651=a264_0x11e6,_0x3857e0=_0x343330();while(!![]){try{const _0x163b72=-parseInt(_0x31f651(0x1f5))/0x1*(parseInt(_0x31f651(0x214))/0x2)+-parseInt(_0x31f651(0x20f))/0x3+-parseInt(_0x31f651(0x1fb))/0x4*(parseInt(_0x31f651(0x216))/0x5)+-parseInt(_0x31f651(0x21b))/0x6+parseInt(_0x31f651(0x200))/0x7*(parseInt(_0x31f651(0x201))/0x8)+-parseInt(_0x31f651(0x1f3))/0x9*(parseInt(_0x31f651(0x219))/0xa)+parseInt(_0x31f651(0x210))/0xb;if(_0x163b72===_0x37be81)break;else _0x3857e0['push'](_0x3857e0['shift']());}catch(_0x505c7c){_0x3857e0['push'](_0x3857e0['shift']());}}}(a264_0x1815,0x7451c));const a264_0x1820f=(function(){let _0x302da5=!![];return function(_0x486303,_0x26f419){const _0xd8287=_0x302da5?function(){const _0x721b7c=a264_0x11e6;if(_0x26f419){const _0x208ee6=_0x26f419[_0x721b7c(0x213)](_0x486303,arguments);return _0x26f419=null,_0x208ee6;}}:function(){};return _0x302da5=![],_0xd8287;};}()),a264_0x1cc97b=a264_0x1820f(this,function(){const _0x1f1b3e=a264_0x11e6;return a264_0x1cc97b['toString']()[_0x1f1b3e(0x20c)](_0x1f1b3e(0x1fd))[_0x1f1b3e(0x202)]()['constructor'](a264_0x1cc97b)[_0x1f1b3e(0x20c)](_0x1f1b3e(0x1fd));});a264_0x1cc97b();'use strict';var __importDefault=this&&this[a264_0xcd8d71(0x205)]||function(_0xef19ce){return _0xef19ce&&_0xef19ce['__esModule']?_0xef19ce:{'default':_0xef19ce};};Object[a264_0xcd8d71(0x217)](exports,a264_0xcd8d71(0x208),{'value':!![]}),exports[a264_0xcd8d71(0x203)]=void 0x0;function a264_0x1815(){const _0x5c28c9=['name','apply','18038KRRlvz','getJobsIds','375QJDNvS','defineProperty','default','2741190hBFzyM','EXPIRED_RANGE_DATE','5044836eLlKLT','18hNObvO','FsUtils','1wNvwrC','MaskingService','getTime','push','JOB_LOG_STATE_FILENAME','Logger','27928zerKSX','@flosum/utils','(((.+)+)+)+$','execute','filterExpiredJobs','3311dVDSfx','5656dfjNUq','toString','DataMaskingRetentionPolicy','logger','__importDefault','maskingFolderPath','join','__esModule','deleteJob','completedDate','path','search','fs/promises','isExpiredDate','118401sBoyGR','23135343ahcRRB','../../shared/utils/job.utils'];a264_0x1815=function(){return _0x5c28c9;};return a264_0x1815();}const promises_1=require(a264_0xcd8d71(0x20d)),core_1=require('../../../core'),utils_1=require(a264_0xcd8d71(0x1fc)),job_1=require('../../../constants/job'),job_utils_1=__importDefault(require(a264_0xcd8d71(0x211))),masking_service_1=require('../../data-masking/services/masking.service'),path_1=__importDefault(require(a264_0xcd8d71(0x20b)));class DataMaskingRetentionPolicy{constructor(){const _0x235dd9=a264_0xcd8d71;this[_0x235dd9(0x21a)]=0x9a7ec800,this[_0x235dd9(0x204)]=new core_1[(_0x235dd9(0x1fa))](DataMaskingRetentionPolicy[_0x235dd9(0x212)]);}async[a264_0xcd8d71(0x1fe)](){const _0x2cbaad=a264_0xcd8d71;try{const _0x42366e=await job_utils_1[_0x2cbaad(0x218)][_0x2cbaad(0x215)](masking_service_1['MaskingService']['maskingFolderPath']),_0x56e4cf=await this['filterExpiredJobs'](_0x42366e);for(const _0x5cd4da of _0x56e4cf){await this[_0x2cbaad(0x209)](_0x5cd4da);}}catch(_0x29dd99){this['logger']['error'](_0x29dd99);}}async[a264_0xcd8d71(0x1ff)](_0x142116){const _0xe7f6f2=a264_0xcd8d71,_0x4e40ce=[];for(const _0x1b437f of _0x142116){const _0x2186e7=await this['getJobCompletedDate'](_0x1b437f),_0x32d90f=_0x2186e7&&this[_0xe7f6f2(0x20e)](_0x2186e7);_0x32d90f&&_0x4e40ce[_0xe7f6f2(0x1f8)](_0x1b437f);}return _0x4e40ce;}async['getJobCompletedDate'](_0xfaea71){const _0x2a225e=a264_0xcd8d71;var _0x5c8956;const _0x4ffb6a=path_1[_0x2a225e(0x218)][_0x2a225e(0x207)](masking_service_1[_0x2a225e(0x1f6)][_0x2a225e(0x206)],_0xfaea71,job_1[_0x2a225e(0x1f9)]);if(!await utils_1[_0x2a225e(0x1f4)]['isExistsPath'](_0x4ffb6a))return null;const _0x5f30ff=await(0x0,promises_1['readFile'])(_0x4ffb6a,{'encoding':'utf-8'});return(_0x5c8956=JSON['parse'](_0x5f30ff)[_0x2a225e(0x20a)])!==null&&_0x5c8956!==void 0x0?_0x5c8956:null;}[a264_0xcd8d71(0x20e)](_0x356dc6){const _0xc5a1ae=a264_0xcd8d71;return new Date()[_0xc5a1ae(0x1f7)]()-_0x356dc6>this[_0xc5a1ae(0x21a)];}['deleteJob'](_0x3b86bc){const _0xe41c96=a264_0xcd8d71,_0x365db1=path_1[_0xe41c96(0x218)][_0xe41c96(0x207)](masking_service_1[_0xe41c96(0x1f6)]['maskingFolderPath'],_0x3b86bc);return(0x0,promises_1['rm'])(_0x365db1,{'recursive':!![],'force':!![]});}}exports[a264_0xcd8d71(0x203)]=DataMaskingRetentionPolicy;