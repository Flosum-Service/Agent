const a308_0x54a0cd=a308_0x19ad;function a308_0x27ca(){const _0x143027=['1175204lrOjsv','DataMaskingRetentionPolicy','../../../constants/job','default','completedDate','maskingFolderPath','deleteJob','1370IQhXBL','search','MaskingService','execute','../../../core','__importDefault','readFile','1450169VCjajc','join','61089rRzlAI','fs/promises','getTime','8YhonTa','__esModule','Logger','43978EMmyNI','constructor','371031vBxBxM','apply','JOB_LOG_STATE_FILENAME','../../data-masking/services/masking.service','EXPIRED_RANGE_DATE','../../shared/utils/job.utils','2472102NWiOVU','push','FsUtils','defineProperty','parse','10mkZiBN','2626452PgEYjp','isExpiredDate','filterExpiredJobs','toString','getJobsIds','5svbjwq','(((.+)+)+)+$','utf-8','logger'];a308_0x27ca=function(){return _0x143027;};return a308_0x27ca();}(function(_0x5404b7,_0x2fabfa){const _0x3976a=a308_0x19ad,_0x25c368=_0x5404b7();while(!![]){try{const _0x54ab7f=-parseInt(_0x3976a(0xae))/0x1*(parseInt(_0x3976a(0xc1))/0x2)+parseInt(_0x3976a(0xb6))/0x3+parseInt(_0x3976a(0xcb))/0x4*(parseInt(_0x3976a(0xc7))/0x5)+-parseInt(_0x3976a(0xbc))/0x6+-parseInt(_0x3976a(0xac))/0x7*(-parseInt(_0x3976a(0xb1))/0x8)+parseInt(_0x3976a(0xc2))/0x9+-parseInt(_0x3976a(0xa5))/0xa*(-parseInt(_0x3976a(0xb4))/0xb);if(_0x54ab7f===_0x2fabfa)break;else _0x25c368['push'](_0x25c368['shift']());}catch(_0x228265){_0x25c368['push'](_0x25c368['shift']());}}}(a308_0x27ca,0xb64f1));const a308_0x5e37d7=(function(){let _0x49f6fd=!![];return function(_0x3243c7,_0xfbbb9f){const _0xb40fb9=_0x49f6fd?function(){const _0x52dfa9=a308_0x19ad;if(_0xfbbb9f){const _0xb002a=_0xfbbb9f[_0x52dfa9(0xb7)](_0x3243c7,arguments);return _0xfbbb9f=null,_0xb002a;}}:function(){};return _0x49f6fd=![],_0xb40fb9;};}()),a308_0x5b31e7=a308_0x5e37d7(this,function(){const _0x1d2a6e=a308_0x19ad;return a308_0x5b31e7[_0x1d2a6e(0xc5)]()[_0x1d2a6e(0xa6)](_0x1d2a6e(0xc8))[_0x1d2a6e(0xc5)]()[_0x1d2a6e(0xb5)](a308_0x5b31e7)[_0x1d2a6e(0xa6)]('(((.+)+)+)+$');});a308_0x5b31e7();'use strict';function a308_0x19ad(_0x4532aa,_0x24d749){const _0x84b366=a308_0x27ca();return a308_0x19ad=function(_0x5b31e7,_0x5e37d7){_0x5b31e7=_0x5b31e7-0xa5;let _0x27ca3a=_0x84b366[_0x5b31e7];return _0x27ca3a;},a308_0x19ad(_0x4532aa,_0x24d749);}var __importDefault=this&&this[a308_0x54a0cd(0xaa)]||function(_0x5c6b80){return _0x5c6b80&&_0x5c6b80['__esModule']?_0x5c6b80:{'default':_0x5c6b80};};Object[a308_0x54a0cd(0xbf)](exports,a308_0x54a0cd(0xb2),{'value':!![]}),exports[a308_0x54a0cd(0xcc)]=void 0x0;const promises_1=require(a308_0x54a0cd(0xaf)),core_1=require(a308_0x54a0cd(0xa9)),utils_1=require('@flosum/utils'),job_1=require(a308_0x54a0cd(0xcd)),job_utils_1=__importDefault(require(a308_0x54a0cd(0xbb))),masking_service_1=require(a308_0x54a0cd(0xb9)),path_1=__importDefault(require('path'));class DataMaskingRetentionPolicy{constructor(){const _0x218c92=a308_0x54a0cd;this['EXPIRED_RANGE_DATE']=0x9a7ec800,this[_0x218c92(0xca)]=new core_1[(_0x218c92(0xb3))](DataMaskingRetentionPolicy['name']);}async[a308_0x54a0cd(0xa8)](){const _0x17d7ce=a308_0x54a0cd;try{const _0x5d9cbb=await job_utils_1[_0x17d7ce(0xce)][_0x17d7ce(0xc6)](masking_service_1[_0x17d7ce(0xa7)][_0x17d7ce(0xd0)]),_0x5521b2=await this['filterExpiredJobs'](_0x5d9cbb);for(const _0xa177f4 of _0x5521b2){await this[_0x17d7ce(0xd1)](_0xa177f4);}}catch(_0x13cd2a){this[_0x17d7ce(0xca)]['error'](_0x13cd2a);}}async[a308_0x54a0cd(0xc4)](_0x44e466){const _0x29a99e=a308_0x54a0cd,_0x357b83=[];for(const _0x3610a1 of _0x44e466){const _0x38bc48=await this['getJobCompletedDate'](_0x3610a1),_0x32ccb8=_0x38bc48&&this['isExpiredDate'](_0x38bc48);_0x32ccb8&&_0x357b83[_0x29a99e(0xbd)](_0x3610a1);}return _0x357b83;}async['getJobCompletedDate'](_0x3fdc0e){const _0x4c856c=a308_0x54a0cd;var _0x1b9a6c;const _0x508d0e=path_1[_0x4c856c(0xce)][_0x4c856c(0xad)](masking_service_1[_0x4c856c(0xa7)][_0x4c856c(0xd0)],_0x3fdc0e,job_1[_0x4c856c(0xb8)]);if(!await utils_1[_0x4c856c(0xbe)]['isExistsPath'](_0x508d0e))return null;const _0x3925ac=await(0x0,promises_1[_0x4c856c(0xab)])(_0x508d0e,{'encoding':_0x4c856c(0xc9)});return(_0x1b9a6c=JSON[_0x4c856c(0xc0)](_0x3925ac)[_0x4c856c(0xcf)])!==null&&_0x1b9a6c!==void 0x0?_0x1b9a6c:null;}[a308_0x54a0cd(0xc3)](_0xff0185){const _0x1f5af0=a308_0x54a0cd;return new Date()[_0x1f5af0(0xb0)]()-_0xff0185>this[_0x1f5af0(0xba)];}[a308_0x54a0cd(0xd1)](_0x39e01a){const _0x5bfde1=a308_0x54a0cd,_0x46b797=path_1[_0x5bfde1(0xce)]['join'](masking_service_1[_0x5bfde1(0xa7)][_0x5bfde1(0xd0)],_0x39e01a);return(0x0,promises_1['rm'])(_0x46b797,{'recursive':!![],'force':!![]});}}exports['DataMaskingRetentionPolicy']=DataMaskingRetentionPolicy;