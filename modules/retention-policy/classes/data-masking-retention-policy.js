const a264_0x147c69=a264_0xc1d9;(function(_0x3e9ae2,_0x357450){const _0x460a61=a264_0xc1d9,_0x24d714=_0x3e9ae2();while(!![]){try{const _0x55b02e=-parseInt(_0x460a61(0xdf))/0x1+parseInt(_0x460a61(0xf0))/0x2*(parseInt(_0x460a61(0xea))/0x3)+-parseInt(_0x460a61(0xe4))/0x4+-parseInt(_0x460a61(0xcc))/0x5+parseInt(_0x460a61(0xd8))/0x6+-parseInt(_0x460a61(0xdb))/0x7*(parseInt(_0x460a61(0xca))/0x8)+-parseInt(_0x460a61(0xd2))/0x9*(-parseInt(_0x460a61(0xe2))/0xa);if(_0x55b02e===_0x357450)break;else _0x24d714['push'](_0x24d714['shift']());}catch(_0x576b5a){_0x24d714['push'](_0x24d714['shift']());}}}(a264_0x5519,0xf20c1));const a264_0xbe354=(function(){let _0x2fa7ea=!![];return function(_0x2b04bd,_0x3830f2){const _0xddb610=_0x2fa7ea?function(){const _0x4be956=a264_0xc1d9;if(_0x3830f2){const _0x2beccf=_0x3830f2[_0x4be956(0xe0)](_0x2b04bd,arguments);return _0x3830f2=null,_0x2beccf;}}:function(){};return _0x2fa7ea=![],_0xddb610;};}()),a264_0xf13aa5=a264_0xbe354(this,function(){const _0x262326=a264_0xc1d9;return a264_0xf13aa5[_0x262326(0xe3)]()[_0x262326(0xcb)](_0x262326(0xd6))[_0x262326(0xe3)]()['constructor'](a264_0xf13aa5)['search']('(((.+)+)+)+$');});function a264_0xc1d9(_0x32b82f,_0x4bb8b0){const _0x4e179a=a264_0x5519();return a264_0xc1d9=function(_0xf13aa5,_0xbe354){_0xf13aa5=_0xf13aa5-0xc9;let _0x551921=_0x4e179a[_0xf13aa5];return _0x551921;},a264_0xc1d9(_0x32b82f,_0x4bb8b0);}a264_0xf13aa5();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4d3fe2){return _0x4d3fe2&&_0x4d3fe2['__esModule']?_0x4d3fe2:{'default':_0x4d3fe2};};function a264_0x5519(){const _0x1c0f36=['FsUtils','1943312kgoTfa','apply','MaskingService','10LKWjKJ','toString','5697816reiSRs','parse','execute','defineProperty','name','JOB_LOG_STATE_FILENAME','11325IeOtJJ','logger','filterExpiredJobs','../../data-masking/services/masking.service','push','__esModule','590vCyJpi','readFile','isExpiredDate','Logger','64qqhZyQ','search','2752425YqEoZv','../../../core','maskingFolderPath','fs/promises','deleteJob','default','24576543QzcYdC','EXPIRED_RANGE_DATE','DataMaskingRetentionPolicy','getJobCompletedDate','(((.+)+)+)+$','isExistsPath','11254248pMtKAZ','getJobsIds','completedDate','709086rJuLIE','@flosum/utils','join'];a264_0x5519=function(){return _0x1c0f36;};return a264_0x5519();}Object[a264_0x147c69(0xe7)](exports,a264_0x147c69(0xef),{'value':!![]}),exports[a264_0x147c69(0xd4)]=void 0x0;const promises_1=require(a264_0x147c69(0xcf)),core_1=require(a264_0x147c69(0xcd)),utils_1=require(a264_0x147c69(0xdc)),job_1=require('../../../constants/job'),job_utils_1=__importDefault(require('../../shared/utils/job.utils')),masking_service_1=require(a264_0x147c69(0xed)),path_1=__importDefault(require('path'));class DataMaskingRetentionPolicy{constructor(){const _0x2aa338=a264_0x147c69;this[_0x2aa338(0xd3)]=0x9a7ec800,this['logger']=new core_1[(_0x2aa338(0xc9))](DataMaskingRetentionPolicy[_0x2aa338(0xe8)]);}async[a264_0x147c69(0xe6)](){const _0x36d10b=a264_0x147c69;try{const _0x383662=await job_utils_1[_0x36d10b(0xd1)][_0x36d10b(0xd9)](masking_service_1[_0x36d10b(0xe1)][_0x36d10b(0xce)]),_0x29bb87=await this[_0x36d10b(0xec)](_0x383662);for(const _0xf1ebf4 of _0x29bb87){await this[_0x36d10b(0xd0)](_0xf1ebf4);}}catch(_0x3e5d60){this[_0x36d10b(0xeb)]['error'](_0x3e5d60);}}async['filterExpiredJobs'](_0x398723){const _0x4b26d8=a264_0x147c69,_0x2163c8=[];for(const _0x84ff9 of _0x398723){const _0x33fd1b=await this['getJobCompletedDate'](_0x84ff9),_0x4886d4=_0x33fd1b&&this['isExpiredDate'](_0x33fd1b);_0x4886d4&&_0x2163c8[_0x4b26d8(0xee)](_0x84ff9);}return _0x2163c8;}async[a264_0x147c69(0xd5)](_0x5e8b3c){const _0x4dd360=a264_0x147c69;var _0x253866;const _0x3d600e=path_1[_0x4dd360(0xd1)][_0x4dd360(0xdd)](masking_service_1['MaskingService'][_0x4dd360(0xce)],_0x5e8b3c,job_1[_0x4dd360(0xe9)]);if(!await utils_1[_0x4dd360(0xde)][_0x4dd360(0xd7)](_0x3d600e))return null;const _0x4cadd9=await(0x0,promises_1[_0x4dd360(0xf1)])(_0x3d600e,{'encoding':'utf-8'});return(_0x253866=JSON[_0x4dd360(0xe5)](_0x4cadd9)[_0x4dd360(0xda)])!==null&&_0x253866!==void 0x0?_0x253866:null;}[a264_0x147c69(0xf2)](_0x133ca2){const _0x542daf=a264_0x147c69;return new Date()['getTime']()-_0x133ca2>this[_0x542daf(0xd3)];}[a264_0x147c69(0xd0)](_0x2d3b5d){const _0x243d4f=a264_0x147c69,_0x3d9eeb=path_1[_0x243d4f(0xd1)][_0x243d4f(0xdd)](masking_service_1['MaskingService'][_0x243d4f(0xce)],_0x2d3b5d);return(0x0,promises_1['rm'])(_0x3d9eeb,{'recursive':!![],'force':!![]});}}exports[a264_0x147c69(0xd4)]=DataMaskingRetentionPolicy;