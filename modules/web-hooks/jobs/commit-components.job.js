const a181_0x2ccd5e=a181_0x13b0;(function(_0x4d465f,_0xe57ff){const _0x1e2966=a181_0x13b0,_0x40826c=_0x4d465f();while(!![]){try{const _0x4a9360=parseInt(_0x1e2966(0x1bd))/0x1*(-parseInt(_0x1e2966(0x16c))/0x2)+parseInt(_0x1e2966(0x1ab))/0x3+parseInt(_0x1e2966(0x18e))/0x4+-parseInt(_0x1e2966(0x186))/0x5*(-parseInt(_0x1e2966(0x1a3))/0x6)+-parseInt(_0x1e2966(0x178))/0x7*(-parseInt(_0x1e2966(0x1a2))/0x8)+-parseInt(_0x1e2966(0x18d))/0x9*(parseInt(_0x1e2966(0x15d))/0xa)+-parseInt(_0x1e2966(0x175))/0xb;if(_0x4a9360===_0xe57ff)break;else _0x40826c['push'](_0x40826c['shift']());}catch(_0x4bca2a){_0x40826c['push'](_0x40826c['shift']());}}}(a181_0x4f69,0xc9929));const a181_0x351e4d=(function(){let _0x3f9d38=!![];return function(_0x3b5a90,_0xcd800f){const _0xc33fdc=_0x3f9d38?function(){const _0x2dab8a=a181_0x13b0;if(_0xcd800f){const _0x4f03c3=_0xcd800f[_0x2dab8a(0x1a0)](_0x3b5a90,arguments);return _0xcd800f=null,_0x4f03c3;}}:function(){};return _0x3f9d38=![],_0xc33fdc;};}()),a181_0x1f0fb2=a181_0x351e4d(this,function(){const _0xd47163=a181_0x13b0;return a181_0x1f0fb2[_0xd47163(0x1be)]()[_0xd47163(0x199)](_0xd47163(0x1b9))[_0xd47163(0x1be)]()['constructor'](a181_0x1f0fb2)['search'](_0xd47163(0x1b9));});a181_0x1f0fb2();'use strict';function a181_0x13b0(_0x3e7a83,_0x1abd08){const _0x439348=a181_0x4f69();return a181_0x13b0=function(_0x1f0fb2,_0x351e4d){_0x1f0fb2=_0x1f0fb2-0x150;let _0x4f6975=_0x439348[_0x1f0fb2];return _0x4f6975;},a181_0x13b0(_0x3e7a83,_0x1abd08);}var __createBinding=this&&this[a181_0x2ccd5e(0x18f)]||(Object[a181_0x2ccd5e(0x16a)]?function(_0x18ca50,_0x52d840,_0x3d442a,_0x4b9ae5){const _0x579aa2=a181_0x2ccd5e;if(_0x4b9ae5===undefined)_0x4b9ae5=_0x3d442a;Object[_0x579aa2(0x1a8)](_0x18ca50,_0x4b9ae5,{'enumerable':!![],'get':function(){return _0x52d840[_0x3d442a];}});}:function(_0x49ce18,_0x69133c,_0x10127a,_0x57051a){if(_0x57051a===undefined)_0x57051a=_0x10127a;_0x49ce18[_0x57051a]=_0x69133c[_0x10127a];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a181_0x2ccd5e(0x16a)]?function(_0x143250,_0x4c976c){const _0xecbf6a=a181_0x2ccd5e;Object[_0xecbf6a(0x1a8)](_0x143250,_0xecbf6a(0x176),{'enumerable':!![],'value':_0x4c976c});}:function(_0x13f676,_0x29a6ce){_0x13f676['default']=_0x29a6ce;}),__decorate=this&&this[a181_0x2ccd5e(0x17c)]||function(_0x459064,_0x846781,_0x41ff13,_0x48c81d){const _0x5ac7fb=a181_0x2ccd5e;var _0x322433=arguments[_0x5ac7fb(0x1a4)],_0x15a4ac=_0x322433<0x3?_0x846781:_0x48c81d===null?_0x48c81d=Object[_0x5ac7fb(0x1a7)](_0x846781,_0x41ff13):_0x48c81d,_0x34e4d5;if(typeof Reflect===_0x5ac7fb(0x196)&&typeof Reflect[_0x5ac7fb(0x197)]==='function')_0x15a4ac=Reflect[_0x5ac7fb(0x197)](_0x459064,_0x846781,_0x41ff13,_0x48c81d);else{for(var _0x2ebc6c=_0x459064['length']-0x1;_0x2ebc6c>=0x0;_0x2ebc6c--)if(_0x34e4d5=_0x459064[_0x2ebc6c])_0x15a4ac=(_0x322433<0x3?_0x34e4d5(_0x15a4ac):_0x322433>0x3?_0x34e4d5(_0x846781,_0x41ff13,_0x15a4ac):_0x34e4d5(_0x846781,_0x41ff13))||_0x15a4ac;}return _0x322433>0x3&&_0x15a4ac&&Object[_0x5ac7fb(0x1a8)](_0x846781,_0x41ff13,_0x15a4ac),_0x15a4ac;},__importStar=this&&this['__importStar']||function(_0x35f296){const _0x3bdb88=a181_0x2ccd5e;if(_0x35f296&&_0x35f296[_0x3bdb88(0x168)])return _0x35f296;var _0x282d2f={};if(_0x35f296!=null){for(var _0x33b8b7 in _0x35f296)if(_0x33b8b7!=='default'&&Object[_0x3bdb88(0x16b)][_0x3bdb88(0x193)][_0x3bdb88(0x179)](_0x35f296,_0x33b8b7))__createBinding(_0x282d2f,_0x35f296,_0x33b8b7);}return __setModuleDefault(_0x282d2f,_0x35f296),_0x282d2f;},__metadata=this&&this['__metadata']||function(_0x3ccbab,_0x24f92f){const _0x2247f1=a181_0x2ccd5e;if(typeof Reflect===_0x2247f1(0x196)&&typeof Reflect[_0x2247f1(0x15c)]===_0x2247f1(0x1bf))return Reflect[_0x2247f1(0x15c)](_0x3ccbab,_0x24f92f);},__importDefault=this&&this[a181_0x2ccd5e(0x166)]||function(_0x1c8666){const _0x532283=a181_0x2ccd5e;return _0x1c8666&&_0x1c8666[_0x532283(0x168)]?_0x1c8666:{'default':_0x1c8666};};Object[a181_0x2ccd5e(0x1a8)](exports,a181_0x2ccd5e(0x168),{'value':!![]}),exports['CommitComponentsJob']=void 0x0;const auth_settings_service_1=require(a181_0x2ccd5e(0x155)),commit_components_dto_1=require('../dto/commit-components.dto'),events_1=__importDefault(require(a181_0x2ccd5e(0x181))),git_utils_1=require('../utils/git.utils'),mdapi_utils_1=require('../utils/mdapi.utils'),sfdx_utils_1=require(a181_0x2ccd5e(0x17a)),typedi_1=__importStar(require(a181_0x2ccd5e(0x19c))),child_types_1=__importDefault(require(a181_0x2ccd5e(0x1ba))),utils_1=require(a181_0x2ccd5e(0x1b5)),salesforce_logger_v2_service_1=require(a181_0x2ccd5e(0x15e)),constants_1=require('../../../constants'),bitbucket_api_service_1=require('../../git-api/services/bitbucket-api.service'),sfdx_utils_2=require(a181_0x2ccd5e(0x194)),fs_internal_1=require(a181_0x2ccd5e(0x156)),path_1=require(a181_0x2ccd5e(0x17e));let CommitComponentsJob=class CommitComponentsJob extends events_1[a181_0x2ccd5e(0x176)]{constructor(_0x4200fa){const _0x430551=a181_0x2ccd5e;super(),this['authSettings']=_0x4200fa,this[_0x430551(0x180)]=0x3e8,this[_0x430551(0x18a)]=0x0,this[_0x430551(0x1b4)]=0x0,this[_0x430551(0x18c)]=Date[_0x430551(0x1b3)]();}async[a181_0x2ccd5e(0x16f)](){const _0xbc083c=a181_0x2ccd5e,{repo:_0x49c57f}=this[_0xbc083c(0x16e)];let _0x5f214d=this[_0xbc083c(0x157)]['getCredentialsFor'](this[_0xbc083c(0x16e)][_0xbc083c(0x19d)]);if(this[_0xbc083c(0x16e)][_0xbc083c(0x19d)]==='bitbucket'){const _0x44228d=typedi_1['default'][_0xbc083c(0x19f)](bitbucket_api_service_1[_0xbc083c(0x15b)]);await _0x44228d[_0xbc083c(0x161)](),_0x5f214d+=encodeURIComponent(_0x44228d[_0xbc083c(0x151)]());}return _0x49c57f['gitUrl'][_0xbc083c(0x150)](/http(s)?\:\/\/(.+@)?/,utils_1[_0xbc083c(0x177)](_0x49c57f[_0xbc083c(0x1b1)])+'://'+_0x5f214d+'@');}['groupComponentsByFileName'](_0x79edd8){const _0x2fcec0=a181_0x2ccd5e;var _0x246db9;_0x79edd8[_0x2fcec0(0x185)](_0x4416d2=>child_types_1[_0x2fcec0(0x176)]['includes'](_0x4416d2['fileType'])?0x1:-0x1);const _0x51e9ba={};for(const _0x1eaf6f of _0x79edd8){_0x51e9ba[_0x246db9=_0x1eaf6f[_0x2fcec0(0x170)]]||(_0x51e9ba[_0x246db9]=[]),_0x51e9ba[_0x1eaf6f[_0x2fcec0(0x170)]][_0x2fcec0(0x18b)](_0x1eaf6f);}return Object[_0x2fcec0(0x169)](_0x51e9ba)[_0x2fcec0(0x1a1)]((_0x4a3e5e,_0x5d74d4)=>[..._0x4a3e5e,..._0x5d74d4],[]);}async[a181_0x2ccd5e(0x1aa)](_0x4bc15b){const _0x1295d5=a181_0x2ccd5e;_0x4bc15b=this[_0x1295d5(0x172)](_0x4bc15b);let _0x41472e=0x0;while(_0x4bc15b[_0x1295d5(0x1a4)]){const _0x71eb86=_0x4bc15b[_0x1295d5(0x182)](0x0,this[_0x1295d5(0x180)]);await this[_0x1295d5(0x1b7)][_0x1295d5(0x164)](_0x71eb86,{'skipChildErrors':this[_0x1295d5(0x16e)]['branch'][_0x1295d5(0x17b)]==='master'}),_0x41472e+=_0x71eb86[_0x1295d5(0x1a4)],this['sfLogger'][_0x1295d5(0x1b6)](_0x1295d5(0x15f)+_0x41472e+'/'+this['componentsToWrite']+'\x20components'),await this['sfLogger'][_0x1295d5(0x1b0)]();}}async[a181_0x2ccd5e(0x184)](_0x1539fb){const _0x5ebb16=a181_0x2ccd5e;_0x1539fb[_0x5ebb16(0x185)](_0x392901=>child_types_1[_0x5ebb16(0x176)][_0x5ebb16(0x187)](_0x392901[_0x5ebb16(0x153)])?-0x1:0x1);let _0x42d6e1=0x0;while(_0x1539fb[_0x5ebb16(0x1a4)]){const _0x53a9fb=_0x1539fb[_0x5ebb16(0x182)](0x0,this[_0x5ebb16(0x180)]);await this[_0x5ebb16(0x1b7)][_0x5ebb16(0x184)](_0x53a9fb),_0x42d6e1+=_0x53a9fb[_0x5ebb16(0x1a4)],this[_0x5ebb16(0x17d)][_0x5ebb16(0x1b6)](_0x5ebb16(0x158)+_0x42d6e1+'/'+this['componentsToDelete']+'\x20components'),await this['sfLogger'][_0x5ebb16(0x1b0)]();}}async[a181_0x2ccd5e(0x160)](){const _0x15b8f6=a181_0x2ccd5e;this['gitUtils']&&await this[_0x15b8f6(0x162)][_0x15b8f6(0x1af)]()[_0x15b8f6(0x1ac)](()=>void 0x0),this[_0x15b8f6(0x1b7)]&&await this[_0x15b8f6(0x1b7)][_0x15b8f6(0x1af)]()[_0x15b8f6(0x1ac)](()=>void 0x0),this[_0x15b8f6(0x1a9)]&&await this[_0x15b8f6(0x1a9)][_0x15b8f6(0x1af)]()[_0x15b8f6(0x1ac)](()=>void 0x0);}async['exec'](){const _0x772e9b=a181_0x2ccd5e,{repo:_0x2848e6,branch:_0x35f1b8,components:_0x3d632d,convertToSFDX:_0x2bd2db,message:_0x1e2274,user:_0x31a3fb}=this[_0x772e9b(0x16e)];this[_0x772e9b(0x1b7)]=new mdapi_utils_1[(_0x772e9b(0x152))](_0x2848e6[_0x772e9b(0x17b)],_0x35f1b8[_0x772e9b(0x17b)]),this[_0x772e9b(0x162)]=new git_utils_1[(_0x772e9b(0x1b2))](await this['getRemote']()),this[_0x772e9b(0x1a9)]=new sfdx_utils_1[(_0x772e9b(0x16d))](_0x2848e6['name'],_0x35f1b8[_0x772e9b(0x17b)]);let _0x2682c5=_0x2bd2db;try{this[_0x772e9b(0x17d)]['log']('[INFO]\x20Start\x20clonning\x20repository'),await this['gitUtils']['clone'](_0x35f1b8[_0x772e9b(0x17b)],_0x2848e6[_0x772e9b(0x17b)]);!this[_0x772e9b(0x16e)]['force']?(this[_0x772e9b(0x17d)][_0x772e9b(0x1b6)](_0x772e9b(0x1ad)),await this[_0x772e9b(0x1b7)]['prepareMdapi'](this[_0x772e9b(0x162)][_0x772e9b(0x1bb)])):this[_0x772e9b(0x17d)][_0x772e9b(0x1b6)](_0x772e9b(0x163));_0x3d632d[_0x772e9b(0x173)]&&(this[_0x772e9b(0x17d)][_0x772e9b(0x1b6)](_0x772e9b(0x1b8)),this[_0x772e9b(0x18a)]=_0x3d632d['writed'][_0x772e9b(0x1a4)],await this[_0x772e9b(0x1aa)](_0x3d632d[_0x772e9b(0x173)]),await this[_0x772e9b(0x17d)][_0x772e9b(0x1b0)]());_0x3d632d[_0x772e9b(0x192)]&&(this['sfLogger'][_0x772e9b(0x1b6)](_0x772e9b(0x174)),this[_0x772e9b(0x1b4)]=_0x3d632d[_0x772e9b(0x192)][_0x772e9b(0x1a4)],await this[_0x772e9b(0x184)](_0x3d632d['deleted']),await this[_0x772e9b(0x17d)][_0x772e9b(0x1b0)]());await this[_0x772e9b(0x17d)][_0x772e9b(0x1b0)]();await sfdx_utils_2[_0x772e9b(0x167)][_0x772e9b(0x198)](this['gitUtils']['dir'])?(_0x2682c5=!![],await fs_internal_1['FS']['removeDir'](path_1[_0x772e9b(0x1bc)](this['gitUtils'][_0x772e9b(0x1bb)],_0x772e9b(0x19a)))):(_0x2682c5&&(!await fs_internal_1['FS']['isEmptyDir'](this[_0x772e9b(0x162)]['dir'])&&(_0x2682c5=![])),await this[_0x772e9b(0x162)][_0x772e9b(0x17f)]());_0x2682c5?(this[_0x772e9b(0x17d)][_0x772e9b(0x1b6)]('[INFO]\x20Start\x20converting\x20to\x20SFDX'),await this[_0x772e9b(0x1a9)][_0x772e9b(0x15a)](this[_0x772e9b(0x1b7)][_0x772e9b(0x1bb)]),await this[_0x772e9b(0x1a9)][_0x772e9b(0x19e)](this[_0x772e9b(0x162)][_0x772e9b(0x1bb)]),await this[_0x772e9b(0x1a9)][_0x772e9b(0x1af)](),await this[_0x772e9b(0x17d)][_0x772e9b(0x1b0)]()):(this[_0x772e9b(0x17d)][_0x772e9b(0x1b6)](_0x772e9b(0x19b)),await this[_0x772e9b(0x1b7)]['copyMdapiTo'](this[_0x772e9b(0x162)][_0x772e9b(0x1bb)]),await this[_0x772e9b(0x17d)][_0x772e9b(0x1b0)]());this['sfLogger'][_0x772e9b(0x1b6)](_0x772e9b(0x189)),await this['gitUtils'][_0x772e9b(0x1a6)](_0x1e2274,{'email':constants_1['DEFAULT_GIT_USER_EMAIL'],'name':_0x31a3fb[_0x772e9b(0x17b)]},_0x35f1b8[_0x772e9b(0x17b)]),await this[_0x772e9b(0x162)][_0x772e9b(0x1af)](),await this['mdapiUtils']['removeDir']();const _0x35f4c1=this[_0x772e9b(0x18a)]+this['componentsToDelete'];this['sfLogger'][_0x772e9b(0x1b6)](_0x772e9b(0x183)+(Date[_0x772e9b(0x1b3)]()-this[_0x772e9b(0x18c)])+_0x772e9b(0x188)+_0x35f4c1),await this['sfLogger'][_0x772e9b(0x1b0)]();}catch(_0x51ed46){await this[_0x772e9b(0x160)](),this[_0x772e9b(0x17d)]['log'](_0x772e9b(0x154)+_0x51ed46),await this[_0x772e9b(0x17d)][_0x772e9b(0x1b0)]();throw _0x51ed46;}}async[a181_0x2ccd5e(0x191)](_0x170abe,_0xed1b8c){const _0x4d67eb=a181_0x2ccd5e;var _0x354595,_0x463e85;this[_0x4d67eb(0x17d)]=new salesforce_logger_v2_service_1[(_0x4d67eb(0x171))](_0xed1b8c[_0x4d67eb(0x1a5)](),_0xed1b8c['getPrefix']()+'\x20['+commit_components_dto_1['CommitComponentsDto'][_0x4d67eb(0x17b)]+']');const _0x260fa6=!!((_0x354595=_0x170abe[_0x4d67eb(0x165)])===null||_0x354595===void 0x0?void 0x0:_0x354595[_0x4d67eb(0x173)])||!!((_0x463e85=_0x170abe['components'])===null||_0x463e85===void 0x0?void 0x0:_0x463e85['deleted']);if(!_0x260fa6){this[_0x4d67eb(0x17d)][_0x4d67eb(0x1b6)](_0x4d67eb(0x190)),await this[_0x4d67eb(0x17d)][_0x4d67eb(0x1b0)]();return;}this[_0x4d67eb(0x16e)]=_0x170abe,await this['exec']();}};function a181_0x4f69(){const _0x1460f8=['[INFO]\x20Force\x20sync.\x20Skip\x20preparing\x20mdapi\x20from\x20repository.','writeFlosumComponents','components','__importDefault','SFDX','__esModule','values','create','prototype','28gRcCeu','SFDXUtils','commitData','getRemote','fileName','SalesforceLogger2','groupComponentsByFileName','writed','[INFO]\x20Preparing\x20to\x20delete\x20components','1328481MxTPZq','default','getProtocol','7RLDjNa','call','../utils/sfdx.utils','name','__decorate','sfLogger','path','clearDir','COMPONENTS_PER_TICK','events','splice','[INFO]\x20Commit\x20job\x20done.\x20Time\x20spent\x20-\x20','removeComponents','sort','228045tNolLm','includes','ms.\x20Committed\x20components\x20-\x20','[INFO]\x20Committing\x20and\x20pushing\x20source\x20to\x20git','componentsToWrite','push','startTime','693fdYvxM','2105212EiTgNX','__createBinding','[INFO]\x20Nothing\x20to\x20commit.\x20Skip.','run','deleted','hasOwnProperty','../../salesforce/utils/sfdx.utils','design:paramtypes','object','decorate','isSFDXProject','search','force-app','[INFO]\x20Copying\x20mdapi\x20to\x20git\x20folder','typedi','provider','copyProjectTo','get','apply','reduce','701504wiBrpQ','66mKwsuW','length','getLoggerId','commitAndPush','getOwnPropertyDescriptor','defineProperty','sfdxUtils','writeComponents','848157kjzXSm','catch','[INFO]\x20Prepare\x20mdapi\x20files','Service','removeDir','send','gitUrl','GitUtils','now','componentsToDelete','../../shared/utils','log','mdapiUtils','[INFO]\x20Preparing\x20to\x20write\x20components','(((.+)+)+)+$','../../parsers/data/child-types','dir','join','26164SOeEWv','toString','function','replace','getAccessToken','MDApiUtils','type','[ERROR]\x20','../../shared/services/auth-settings.service','../../internal/fs.internal','authSettings','[INFO]\x20Deleted\x20','AuthSettingsService','createProjectFrom','BitbucketApiService','metadata','11130jaIGmp','../../salesforce/services/salesforce-logger-v2.service','[INFO]\x20Wrote\x20','cleanUp','isLoggedIn','gitUtils'];a181_0x4f69=function(){return _0x1460f8;};return a181_0x4f69();}CommitComponentsJob=__decorate([typedi_1[a181_0x2ccd5e(0x1ae)]({'transient':!![]}),__metadata(a181_0x2ccd5e(0x195),[auth_settings_service_1[a181_0x2ccd5e(0x159)]])],CommitComponentsJob),exports['CommitComponentsJob']=CommitComponentsJob;