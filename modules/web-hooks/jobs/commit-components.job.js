const a180_0xeb210=a180_0x12e7;function a180_0x3056(){const _0x15c453=['[INFO]\x20Deleted\x20','../../shared/utils','../../parsers/data/child-types','cleanUp','[INFO]\x20Force\x20sync.\x20Skip\x20preparing\x20mdapi\x20from\x20repository.','getRemote','2286mybTyA','includes','call','gitUrl','GitUtils','removeComponents','[INFO]\x20Commit\x20job\x20done.\x20Time\x20spent\x20-\x20','307728mtxRXb','gitUtils','BitbucketApiService','sfLogger','13419GlMVup','../../git-api/services/bitbucket-api.service','defineProperty','944099bbaPQk','metadata','CommitComponentsJob','default','967315ZfRbsV','30NRgKai','path','__importDefault','catch','mdapiUtils','getLoggerId','18uvFMHA','log','function','\x20components','MDApiUtils','../../salesforce/services/salesforce-logger-v2.service','typedi','__importStar','COMPONENTS_PER_TICK','componentsToWrite','SFDX','fileName','prototype','type','push','../../internal/fs.internal','../utils/sfdx.utils','__metadata','isLoggedIn','create','getOwnPropertyDescriptor','../utils/git.utils','name','AuthSettingsService','__createBinding','[INFO]\x20Prepare\x20mdapi\x20files','get','218orlwAJ','../dto/commit-components.dto','design:paramtypes','groupComponentsByFileName','CommitComponentsDto','decorate','authSettings','splice','branch','../utils/mdapi.utils','send','bitbucket','object','[INFO]\x20Start\x20converting\x20to\x20SFDX','toString','72xqmcEa','removeDir','exec','writeComponents','4LfdGGq','5016uQhRNt','startTime','length','../../salesforce/utils/sfdx.utils','now','run','__decorate','dir','[INFO]\x20Wrote\x20','provider','../../shared/services/auth-settings.service','components','clearDir','commitAndPush','DEFAULT_GIT_USER_EMAIL','replace','values','933383iikhqW','copyProjectTo','fileType','commitData','clone','copyMdapiTo','writeFlosumComponents','force-app','writed','search','SalesforceLogger2','[INFO]\x20Nothing\x20to\x20commit.\x20Skip.','sort','deleted','719NQiovT','sfdxUtils','getProtocol','SFDXUtils','(((.+)+)+)+$','__esModule','componentsToDelete'];a180_0x3056=function(){return _0x15c453;};return a180_0x3056();}(function(_0x5549e0,_0x2d97b3){const _0x167417=a180_0x12e7,_0x204cbf=_0x5549e0();while(!![]){try{const _0x3f7cc3=-parseInt(_0x167417(0x20a))/0x1*(parseInt(_0x167417(0x1d7))/0x2)+-parseInt(_0x167417(0x21e))/0x3+-parseInt(_0x167417(0x1ea))/0x4*(parseInt(_0x167417(0x229))/0x5)+-parseInt(_0x167417(0x230))/0x6*(-parseInt(_0x167417(0x222))/0x7)+-parseInt(_0x167417(0x1eb))/0x8*(parseInt(_0x167417(0x217))/0x9)+-parseInt(_0x167417(0x22a))/0xa*(-parseInt(_0x167417(0x1fc))/0xb)+-parseInt(_0x167417(0x1e6))/0xc*(-parseInt(_0x167417(0x225))/0xd);if(_0x3f7cc3===_0x2d97b3)break;else _0x204cbf['push'](_0x204cbf['shift']());}catch(_0x56f5c1){_0x204cbf['push'](_0x204cbf['shift']());}}}(a180_0x3056,0x27a4c));const a180_0x299878=(function(){let _0x15faa6=!![];return function(_0x4c8389,_0x3510db){const _0x41e730=_0x15faa6?function(){if(_0x3510db){const _0x2c399f=_0x3510db['apply'](_0x4c8389,arguments);return _0x3510db=null,_0x2c399f;}}:function(){};return _0x15faa6=![],_0x41e730;};}()),a180_0x474bb9=a180_0x299878(this,function(){const _0x1c189f=a180_0x12e7;return a180_0x474bb9[_0x1c189f(0x1e5)]()[_0x1c189f(0x205)](_0x1c189f(0x20e))['toString']()['constructor'](a180_0x474bb9)[_0x1c189f(0x205)]('(((.+)+)+)+$');});function a180_0x12e7(_0x5b2bf2,_0x3d1040){const _0x7c40fc=a180_0x3056();return a180_0x12e7=function(_0x474bb9,_0x299878){_0x474bb9=_0x474bb9-0x1ca;let _0x305630=_0x7c40fc[_0x474bb9];return _0x305630;},a180_0x12e7(_0x5b2bf2,_0x3d1040);}a180_0x474bb9();'use strict';var __createBinding=this&&this[a180_0xeb210(0x1d4)]||(Object[a180_0xeb210(0x1cf)]?function(_0x21fecf,_0x25ac62,_0x3c350a,_0x3ab2a2){if(_0x3ab2a2===undefined)_0x3ab2a2=_0x3c350a;Object['defineProperty'](_0x21fecf,_0x3ab2a2,{'enumerable':!![],'get':function(){return _0x25ac62[_0x3c350a];}});}:function(_0xb7ee52,_0x1ef8fd,_0xd88c72,_0x4e7755){if(_0x4e7755===undefined)_0x4e7755=_0xd88c72;_0xb7ee52[_0x4e7755]=_0x1ef8fd[_0xd88c72];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a180_0xeb210(0x1cf)]?function(_0x392685,_0x4127ea){const _0x868936=a180_0xeb210;Object[_0x868936(0x224)](_0x392685,_0x868936(0x228),{'enumerable':!![],'value':_0x4127ea});}:function(_0x336df0,_0x1c78cd){const _0x3f92d9=a180_0xeb210;_0x336df0[_0x3f92d9(0x228)]=_0x1c78cd;}),__decorate=this&&this[a180_0xeb210(0x1f1)]||function(_0x27924e,_0x144d08,_0x4059df,_0x10c22b){const _0x44e80b=a180_0xeb210;var _0x1d2773=arguments[_0x44e80b(0x1ed)],_0x525d37=_0x1d2773<0x3?_0x144d08:_0x10c22b===null?_0x10c22b=Object[_0x44e80b(0x1d0)](_0x144d08,_0x4059df):_0x10c22b,_0x4ad8e3;if(typeof Reflect===_0x44e80b(0x1e3)&&typeof Reflect[_0x44e80b(0x1dc)]===_0x44e80b(0x232))_0x525d37=Reflect['decorate'](_0x27924e,_0x144d08,_0x4059df,_0x10c22b);else{for(var _0x263e4c=_0x27924e[_0x44e80b(0x1ed)]-0x1;_0x263e4c>=0x0;_0x263e4c--)if(_0x4ad8e3=_0x27924e[_0x263e4c])_0x525d37=(_0x1d2773<0x3?_0x4ad8e3(_0x525d37):_0x1d2773>0x3?_0x4ad8e3(_0x144d08,_0x4059df,_0x525d37):_0x4ad8e3(_0x144d08,_0x4059df))||_0x525d37;}return _0x1d2773>0x3&&_0x525d37&&Object[_0x44e80b(0x224)](_0x144d08,_0x4059df,_0x525d37),_0x525d37;},__importStar=this&&this[a180_0xeb210(0x237)]||function(_0x5ef5f4){const _0x157c06=a180_0xeb210;if(_0x5ef5f4&&_0x5ef5f4[_0x157c06(0x20f)])return _0x5ef5f4;var _0x44d473={};if(_0x5ef5f4!=null){for(var _0x434d70 in _0x5ef5f4)if(_0x434d70!==_0x157c06(0x228)&&Object[_0x157c06(0x23c)]['hasOwnProperty'][_0x157c06(0x219)](_0x5ef5f4,_0x434d70))__createBinding(_0x44d473,_0x5ef5f4,_0x434d70);}return __setModuleDefault(_0x44d473,_0x5ef5f4),_0x44d473;},__metadata=this&&this[a180_0xeb210(0x1cd)]||function(_0x34e0f1,_0x706687){const _0x189153=a180_0xeb210;if(typeof Reflect==='object'&&typeof Reflect[_0x189153(0x226)]===_0x189153(0x232))return Reflect['metadata'](_0x34e0f1,_0x706687);},__importDefault=this&&this[a180_0xeb210(0x22c)]||function(_0x5d4f9a){const _0x43332b=a180_0xeb210;return _0x5d4f9a&&_0x5d4f9a[_0x43332b(0x20f)]?_0x5d4f9a:{'default':_0x5d4f9a};};Object[a180_0xeb210(0x224)](exports,a180_0xeb210(0x20f),{'value':!![]}),exports[a180_0xeb210(0x227)]=void 0x0;const auth_settings_service_1=require(a180_0xeb210(0x1f5)),commit_components_dto_1=require(a180_0xeb210(0x1d8)),events_1=__importDefault(require('events')),git_utils_1=require(a180_0xeb210(0x1d1)),mdapi_utils_1=require(a180_0xeb210(0x1e0)),sfdx_utils_1=require(a180_0xeb210(0x1cc)),typedi_1=__importStar(require(a180_0xeb210(0x236))),child_types_1=__importDefault(require(a180_0xeb210(0x213))),utils_1=require(a180_0xeb210(0x212)),salesforce_logger_v2_service_1=require(a180_0xeb210(0x235)),constants_1=require('../../../constants'),bitbucket_api_service_1=require(a180_0xeb210(0x223)),sfdx_utils_2=require(a180_0xeb210(0x1ee)),fs_internal_1=require(a180_0xeb210(0x1cb)),path_1=require(a180_0xeb210(0x22b));let CommitComponentsJob=class CommitComponentsJob extends events_1[a180_0xeb210(0x228)]{constructor(_0x3e56a2){const _0x36b3cd=a180_0xeb210;super(),this[_0x36b3cd(0x1dd)]=_0x3e56a2,this[_0x36b3cd(0x238)]=0x3e8,this['componentsToWrite']=0x0,this[_0x36b3cd(0x210)]=0x0,this[_0x36b3cd(0x1ec)]=Date[_0x36b3cd(0x1ef)]();}async[a180_0xeb210(0x216)](){const _0x5a3e11=a180_0xeb210,{repo:_0xc18f78}=this[_0x5a3e11(0x1ff)];let _0x1e3bf5=this[_0x5a3e11(0x1dd)]['getCredentialsFor'](this[_0x5a3e11(0x1ff)][_0x5a3e11(0x1f4)]);if(this[_0x5a3e11(0x1ff)]['provider']===_0x5a3e11(0x1e2)){const _0x24cbe1=typedi_1[_0x5a3e11(0x228)][_0x5a3e11(0x1d6)](bitbucket_api_service_1[_0x5a3e11(0x220)]);await _0x24cbe1[_0x5a3e11(0x1ce)](),_0x1e3bf5+=encodeURIComponent(_0x24cbe1['getAccessToken']());}return _0xc18f78[_0x5a3e11(0x21a)][_0x5a3e11(0x1fa)](/http(s)?\:\/\/(.+@)?/,utils_1[_0x5a3e11(0x20c)](_0xc18f78[_0x5a3e11(0x21a)])+'://'+_0x1e3bf5+'@');}[a180_0xeb210(0x1da)](_0x2f403c){const _0x515f37=a180_0xeb210;var _0x2b529a;_0x2f403c[_0x515f37(0x208)](_0x4b0cc9=>child_types_1[_0x515f37(0x228)][_0x515f37(0x218)](_0x4b0cc9[_0x515f37(0x1fe)])?0x1:-0x1);const _0x574705={};for(const _0x2d7a17 of _0x2f403c){_0x574705[_0x2b529a=_0x2d7a17[_0x515f37(0x23b)]]||(_0x574705[_0x2b529a]=[]),_0x574705[_0x2d7a17['fileName']][_0x515f37(0x1ca)](_0x2d7a17);}return Object[_0x515f37(0x1fb)](_0x574705)['reduce']((_0x4fc382,_0x5dedbf)=>[..._0x4fc382,..._0x5dedbf],[]);}async[a180_0xeb210(0x1e9)](_0x2c7498){const _0x43e241=a180_0xeb210;_0x2c7498=this[_0x43e241(0x1da)](_0x2c7498);let _0x24e62b=0x0;while(_0x2c7498['length']){const _0x33a6a8=_0x2c7498[_0x43e241(0x1de)](0x0,this[_0x43e241(0x238)]);await this[_0x43e241(0x22e)][_0x43e241(0x202)](_0x33a6a8,{'skipChildErrors':this[_0x43e241(0x1ff)][_0x43e241(0x1df)][_0x43e241(0x1d2)]==='master'}),_0x24e62b+=_0x33a6a8[_0x43e241(0x1ed)],this[_0x43e241(0x221)]['log'](_0x43e241(0x1f3)+_0x24e62b+'/'+this[_0x43e241(0x239)]+'\x20components'),await this['sfLogger'][_0x43e241(0x1e1)]();}}async[a180_0xeb210(0x21c)](_0x13cbd6){const _0xaf871d=a180_0xeb210;_0x13cbd6[_0xaf871d(0x208)](_0x167014=>child_types_1[_0xaf871d(0x228)][_0xaf871d(0x218)](_0x167014[_0xaf871d(0x23d)])?-0x1:0x1);let _0x2a8273=0x0;while(_0x13cbd6[_0xaf871d(0x1ed)]){const _0x3154f5=_0x13cbd6[_0xaf871d(0x1de)](0x0,this[_0xaf871d(0x238)]);await this[_0xaf871d(0x22e)]['removeComponents'](_0x3154f5),_0x2a8273+=_0x3154f5[_0xaf871d(0x1ed)],this[_0xaf871d(0x221)][_0xaf871d(0x231)](_0xaf871d(0x211)+_0x2a8273+'/'+this['componentsToDelete']+_0xaf871d(0x233)),await this['sfLogger'][_0xaf871d(0x1e1)]();}}async[a180_0xeb210(0x214)](){const _0x5d4d55=a180_0xeb210;this[_0x5d4d55(0x21f)]&&await this[_0x5d4d55(0x21f)][_0x5d4d55(0x1e7)]()[_0x5d4d55(0x22d)](()=>void 0x0),this[_0x5d4d55(0x22e)]&&await this[_0x5d4d55(0x22e)][_0x5d4d55(0x1e7)]()[_0x5d4d55(0x22d)](()=>void 0x0),this['sfdxUtils']&&await this['sfdxUtils']['removeDir']()['catch'](()=>void 0x0);}async[a180_0xeb210(0x1e8)](){const _0x3803e4=a180_0xeb210,{repo:_0xeb9687,branch:_0x139ac9,components:_0x376bf0,convertToSFDX:_0x375e48,message:_0x2f6d4e,user:_0x1c3899}=this[_0x3803e4(0x1ff)];this['mdapiUtils']=new mdapi_utils_1[(_0x3803e4(0x234))](_0xeb9687['name'],_0x139ac9[_0x3803e4(0x1d2)]),this[_0x3803e4(0x21f)]=new git_utils_1[(_0x3803e4(0x21b))](await this[_0x3803e4(0x216)]()),this[_0x3803e4(0x20b)]=new sfdx_utils_1[(_0x3803e4(0x20d))](_0xeb9687[_0x3803e4(0x1d2)],_0x139ac9[_0x3803e4(0x1d2)]);let _0xfc8e5e=_0x375e48;try{this[_0x3803e4(0x221)][_0x3803e4(0x231)]('[INFO]\x20Start\x20clonning\x20repository'),await this[_0x3803e4(0x21f)][_0x3803e4(0x200)](_0x139ac9['name'],_0xeb9687[_0x3803e4(0x1d2)]);!this['commitData']['force']?(this['sfLogger'][_0x3803e4(0x231)](_0x3803e4(0x1d5)),await this[_0x3803e4(0x22e)]['prepareMdapi'](this[_0x3803e4(0x21f)][_0x3803e4(0x1f2)])):this[_0x3803e4(0x221)][_0x3803e4(0x231)](_0x3803e4(0x215));_0x376bf0[_0x3803e4(0x204)]&&(this[_0x3803e4(0x221)]['log']('[INFO]\x20Preparing\x20to\x20write\x20components'),this[_0x3803e4(0x239)]=_0x376bf0[_0x3803e4(0x204)][_0x3803e4(0x1ed)],await this['writeComponents'](_0x376bf0[_0x3803e4(0x204)]),await this[_0x3803e4(0x221)][_0x3803e4(0x1e1)]());_0x376bf0[_0x3803e4(0x209)]&&(this[_0x3803e4(0x221)][_0x3803e4(0x231)]('[INFO]\x20Preparing\x20to\x20delete\x20components'),this[_0x3803e4(0x210)]=_0x376bf0['deleted'][_0x3803e4(0x1ed)],await this[_0x3803e4(0x21c)](_0x376bf0[_0x3803e4(0x209)]),await this[_0x3803e4(0x221)][_0x3803e4(0x1e1)]());await this['sfLogger'][_0x3803e4(0x1e1)]();await sfdx_utils_2[_0x3803e4(0x23a)]['isSFDXProject'](this[_0x3803e4(0x21f)][_0x3803e4(0x1f2)])?(_0xfc8e5e=!![],await fs_internal_1['FS'][_0x3803e4(0x1e7)](path_1['join'](this[_0x3803e4(0x21f)][_0x3803e4(0x1f2)],_0x3803e4(0x203)))):(_0xfc8e5e&&(!await fs_internal_1['FS']['isEmptyDir'](this[_0x3803e4(0x21f)][_0x3803e4(0x1f2)])&&(_0xfc8e5e=![])),await this['gitUtils'][_0x3803e4(0x1f7)]());_0xfc8e5e?(this[_0x3803e4(0x221)]['log'](_0x3803e4(0x1e4)),await this[_0x3803e4(0x20b)]['createProjectFrom'](this[_0x3803e4(0x22e)][_0x3803e4(0x1f2)]),await this[_0x3803e4(0x20b)][_0x3803e4(0x1fd)](this[_0x3803e4(0x21f)][_0x3803e4(0x1f2)]),await this[_0x3803e4(0x20b)][_0x3803e4(0x1e7)](),await this[_0x3803e4(0x221)][_0x3803e4(0x1e1)]()):(this[_0x3803e4(0x221)]['log']('[INFO]\x20Copying\x20mdapi\x20to\x20git\x20folder'),await this[_0x3803e4(0x22e)][_0x3803e4(0x201)](this[_0x3803e4(0x21f)]['dir']),await this[_0x3803e4(0x221)][_0x3803e4(0x1e1)]());this['sfLogger'][_0x3803e4(0x231)]('[INFO]\x20Committing\x20and\x20pushing\x20source\x20to\x20git'),await this[_0x3803e4(0x21f)][_0x3803e4(0x1f8)](_0x2f6d4e,{'email':constants_1[_0x3803e4(0x1f9)],'name':_0x1c3899[_0x3803e4(0x1d2)]},_0x139ac9['name']),await this['gitUtils'][_0x3803e4(0x1e7)](),await this[_0x3803e4(0x22e)]['removeDir']();const _0x387ec5=this[_0x3803e4(0x239)]+this[_0x3803e4(0x210)];this['sfLogger'][_0x3803e4(0x231)](_0x3803e4(0x21d)+(Date[_0x3803e4(0x1ef)]()-this[_0x3803e4(0x1ec)])+'ms.\x20Committed\x20components\x20-\x20'+_0x387ec5),await this['sfLogger'][_0x3803e4(0x1e1)]();}catch(_0x5e6839){await this[_0x3803e4(0x214)](),this['sfLogger'][_0x3803e4(0x231)]('[ERROR]\x20'+_0x5e6839),await this['sfLogger'][_0x3803e4(0x1e1)]();throw _0x5e6839;}}async[a180_0xeb210(0x1f0)](_0x39d9f7,_0x1ed325){const _0x53b4b1=a180_0xeb210;var _0x3ff433,_0x86691;this[_0x53b4b1(0x221)]=new salesforce_logger_v2_service_1[(_0x53b4b1(0x206))](_0x1ed325[_0x53b4b1(0x22f)](),_0x1ed325['getPrefix']()+'\x20['+commit_components_dto_1[_0x53b4b1(0x1db)][_0x53b4b1(0x1d2)]+']');const _0x15e793=!!((_0x3ff433=_0x39d9f7[_0x53b4b1(0x1f6)])===null||_0x3ff433===void 0x0?void 0x0:_0x3ff433[_0x53b4b1(0x204)])||!!((_0x86691=_0x39d9f7[_0x53b4b1(0x1f6)])===null||_0x86691===void 0x0?void 0x0:_0x86691[_0x53b4b1(0x209)]);if(!_0x15e793){this[_0x53b4b1(0x221)][_0x53b4b1(0x231)](_0x53b4b1(0x207)),await this[_0x53b4b1(0x221)][_0x53b4b1(0x1e1)]();return;}this[_0x53b4b1(0x1ff)]=_0x39d9f7,await this[_0x53b4b1(0x1e8)]();}};CommitComponentsJob=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a180_0xeb210(0x1d9),[auth_settings_service_1[a180_0xeb210(0x1d3)]])],CommitComponentsJob),exports[a180_0xeb210(0x227)]=CommitComponentsJob;