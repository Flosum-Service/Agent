const a181_0x53b216=a181_0xf827;(function(_0x2958b7,_0xf86996){const _0x5cc23c=a181_0xf827,_0x551310=_0x2958b7();while(!![]){try{const _0x3a82ab=parseInt(_0x5cc23c(0x95))/0x1+parseInt(_0x5cc23c(0xb6))/0x2+-parseInt(_0x5cc23c(0xd3))/0x3+parseInt(_0x5cc23c(0xc9))/0x4+parseInt(_0x5cc23c(0xe8))/0x5+-parseInt(_0x5cc23c(0x96))/0x6+parseInt(_0x5cc23c(0xcb))/0x7*(-parseInt(_0x5cc23c(0x93))/0x8);if(_0x3a82ab===_0xf86996)break;else _0x551310['push'](_0x551310['shift']());}catch(_0xbae98c){_0x551310['push'](_0x551310['shift']());}}}(a181_0x5c0d,0x93357));function a181_0xf827(_0x398f58,_0x415877){const _0x20d082=a181_0x5c0d();return a181_0xf827=function(_0x490648,_0x51db73){_0x490648=_0x490648-0x91;let _0x5c0d95=_0x20d082[_0x490648];return _0x5c0d95;},a181_0xf827(_0x398f58,_0x415877);}const a181_0x51db73=(function(){let _0x223eab=!![];return function(_0x4fc06b,_0x59e521){const _0x422426=_0x223eab?function(){if(_0x59e521){const _0x560c51=_0x59e521['apply'](_0x4fc06b,arguments);return _0x59e521=null,_0x560c51;}}:function(){};return _0x223eab=![],_0x422426;};}()),a181_0x490648=a181_0x51db73(this,function(){const _0x4eaa90=a181_0xf827;return a181_0x490648[_0x4eaa90(0xb8)]()[_0x4eaa90(0xab)](_0x4eaa90(0xac))[_0x4eaa90(0xb8)]()['constructor'](a181_0x490648)[_0x4eaa90(0xab)](_0x4eaa90(0xac));});function a181_0x5c0d(){const _0x3f02d6=['mdapiUtils','../dto/commit-components.dto','branch','metadata','clearDir','groupComponentsByFileName','writed','splice','ms.\x20Committed\x20components\x20-\x20','sort','SalesforceLogger2','join','call','__esModule','create','\x20components','__metadata','MDApiUtils','__decorate','authSettings','10237296YpAhHD','includes','982729DNhjnm','5318160oAjrho','sfdxUtils','copyMdapiTo','../../parsers/data/child-types','SFDXUtils','://','exec','../utils/sfdx.utils','componentsToWrite','deleted','[INFO]\x20Commit\x20job\x20done.\x20Time\x20spent\x20-\x20','force','reduce','[INFO]\x20Preparing\x20to\x20delete\x20components','gitUrl','run','gitUtils','[INFO]\x20Force\x20sync.\x20Skip\x20preparing\x20mdapi\x20from\x20repository.','CommitComponentsJob','__importStar','fileName','search','(((.+)+)+)+$','log','name','COMPONENTS_PER_TICK','events','getLoggerId','decorate','BitbucketApiService','SFDX','componentsToDelete','2352722VpLpNG','typedi','toString','dir','Service','now','getAccessToken','defineProperty','prepareMdapi','commitData','../utils/git.utils','clone','default','commitAndPush','[INFO]\x20Nothing\x20to\x20commit.\x20Skip.','removeDir','length','isSFDXProject','provider','3276644VoqOBF','master','7TMtRJn','CommitComponentsDto','hasOwnProperty','../../salesforce/services/salesforce-logger-v2.service','__setModuleDefault','function','removeComponents','[INFO]\x20Prepare\x20mdapi\x20files','978510WLSqnI','[INFO]\x20Copying\x20mdapi\x20to\x20git\x20folder','../../shared/utils','components','catch','isLoggedIn','AuthSettingsService','createProjectFrom','startTime','cleanUp','getCredentialsFor','prototype','../../git-api/services/bitbucket-api.service','getRemote','[INFO]\x20Wrote\x20','bitbucket','sfLogger','values','[ERROR]\x20','../../shared/services/auth-settings.service','[INFO]\x20Preparing\x20to\x20write\x20components','584540FMubqM','[INFO]\x20Deleted\x20','get','../../../constants','object','send','[INFO]\x20Committing\x20and\x20pushing\x20source\x20to\x20git','type','path'];a181_0x5c0d=function(){return _0x3f02d6;};return a181_0x5c0d();}a181_0x490648();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a181_0x53b216(0xff)]?function(_0x4f842a,_0x35f3ea,_0x34cc79,_0x561b2f){const _0x473e78=a181_0x53b216;if(_0x561b2f===undefined)_0x561b2f=_0x34cc79;Object[_0x473e78(0xbd)](_0x4f842a,_0x561b2f,{'enumerable':!![],'get':function(){return _0x35f3ea[_0x34cc79];}});}:function(_0x46bdea,_0x386209,_0x42536b,_0x3e53da){if(_0x3e53da===undefined)_0x3e53da=_0x42536b;_0x46bdea[_0x3e53da]=_0x386209[_0x42536b];}),__setModuleDefault=this&&this[a181_0x53b216(0xcf)]||(Object[a181_0x53b216(0xff)]?function(_0x41a138,_0x5d1197){const _0x1e2b58=a181_0x53b216;Object[_0x1e2b58(0xbd)](_0x41a138,'default',{'enumerable':!![],'value':_0x5d1197});}:function(_0x51d6b0,_0x27232f){const _0x55e7f0=a181_0x53b216;_0x51d6b0[_0x55e7f0(0xc2)]=_0x27232f;}),__decorate=this&&this[a181_0x53b216(0x91)]||function(_0x42d30c,_0x52a6a1,_0x37e936,_0x408e60){const _0x4c341d=a181_0x53b216;var _0x187a38=arguments[_0x4c341d(0xc6)],_0x2e3efa=_0x187a38<0x3?_0x52a6a1:_0x408e60===null?_0x408e60=Object['getOwnPropertyDescriptor'](_0x52a6a1,_0x37e936):_0x408e60,_0x54b6fd;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x4c341d(0xd0))_0x2e3efa=Reflect[_0x4c341d(0xb2)](_0x42d30c,_0x52a6a1,_0x37e936,_0x408e60);else{for(var _0xd97e02=_0x42d30c[_0x4c341d(0xc6)]-0x1;_0xd97e02>=0x0;_0xd97e02--)if(_0x54b6fd=_0x42d30c[_0xd97e02])_0x2e3efa=(_0x187a38<0x3?_0x54b6fd(_0x2e3efa):_0x187a38>0x3?_0x54b6fd(_0x52a6a1,_0x37e936,_0x2e3efa):_0x54b6fd(_0x52a6a1,_0x37e936))||_0x2e3efa;}return _0x187a38>0x3&&_0x2e3efa&&Object['defineProperty'](_0x52a6a1,_0x37e936,_0x2e3efa),_0x2e3efa;},__importStar=this&&this[a181_0x53b216(0xa9)]||function(_0x22b850){const _0x291496=a181_0x53b216;if(_0x22b850&&_0x22b850[_0x291496(0xfe)])return _0x22b850;var _0x50f4aa={};if(_0x22b850!=null){for(var _0x5caa07 in _0x22b850)if(_0x5caa07!==_0x291496(0xc2)&&Object[_0x291496(0xde)][_0x291496(0xcd)][_0x291496(0xfd)](_0x22b850,_0x5caa07))__createBinding(_0x50f4aa,_0x22b850,_0x5caa07);}return __setModuleDefault(_0x50f4aa,_0x22b850),_0x50f4aa;},__metadata=this&&this[a181_0x53b216(0x101)]||function(_0x81ea8d,_0x107d5d){const _0x2fa9da=a181_0x53b216;if(typeof Reflect===_0x2fa9da(0xec)&&typeof Reflect['metadata']===_0x2fa9da(0xd0))return Reflect[_0x2fa9da(0xf4)](_0x81ea8d,_0x107d5d);},__importDefault=this&&this['__importDefault']||function(_0xd73287){const _0x471329=a181_0x53b216;return _0xd73287&&_0xd73287[_0x471329(0xfe)]?_0xd73287:{'default':_0xd73287};};Object[a181_0x53b216(0xbd)](exports,a181_0x53b216(0xfe),{'value':!![]}),exports[a181_0x53b216(0xa8)]=void 0x0;const auth_settings_service_1=require(a181_0x53b216(0xe6)),commit_components_dto_1=require(a181_0x53b216(0xf2)),events_1=__importDefault(require(a181_0x53b216(0xb0))),git_utils_1=require(a181_0x53b216(0xc0)),mdapi_utils_1=require('../utils/mdapi.utils'),sfdx_utils_1=require(a181_0x53b216(0x9d)),typedi_1=__importStar(require(a181_0x53b216(0xb7))),child_types_1=__importDefault(require(a181_0x53b216(0x99))),utils_1=require(a181_0x53b216(0xd5)),salesforce_logger_v2_service_1=require(a181_0x53b216(0xce)),constants_1=require(a181_0x53b216(0xeb)),bitbucket_api_service_1=require(a181_0x53b216(0xdf)),sfdx_utils_2=require('../../salesforce/utils/sfdx.utils'),fs_internal_1=require('../../internal/fs.internal'),path_1=require(a181_0x53b216(0xf0));let CommitComponentsJob=class CommitComponentsJob extends events_1[a181_0x53b216(0xc2)]{constructor(_0x4522da){const _0x4807e9=a181_0x53b216;super(),this[_0x4807e9(0x92)]=_0x4522da,this[_0x4807e9(0xaf)]=0x3e8,this[_0x4807e9(0x9e)]=0x0,this[_0x4807e9(0xb5)]=0x0,this[_0x4807e9(0xdb)]=Date['now']();}async[a181_0x53b216(0xe0)](){const _0x239002=a181_0x53b216,{repo:_0x227cac}=this[_0x239002(0xbf)];let _0x462f07=this[_0x239002(0x92)][_0x239002(0xdd)](this[_0x239002(0xbf)][_0x239002(0xc8)]);if(this[_0x239002(0xbf)][_0x239002(0xc8)]===_0x239002(0xe2)){const _0x3fd027=typedi_1[_0x239002(0xc2)][_0x239002(0xea)](bitbucket_api_service_1[_0x239002(0xb3)]);await _0x3fd027[_0x239002(0xd8)](),_0x462f07+=encodeURIComponent(_0x3fd027[_0x239002(0xbc)]());}return _0x227cac[_0x239002(0xa4)]['replace'](/http(s)?:\/\/(.+@)?/,utils_1['getProtocol'](_0x227cac[_0x239002(0xa4)])+_0x239002(0x9b)+_0x462f07+'@');}['groupComponentsByFileName'](_0x4b32cc){const _0x4166ce=a181_0x53b216;var _0x5b2ef1;_0x4b32cc['sort'](_0x4cbf43=>child_types_1[_0x4166ce(0xc2)][_0x4166ce(0x94)](_0x4cbf43['fileType'])?0x1:-0x1);const _0x4ce73a={};for(const _0x4ef10e of _0x4b32cc){_0x4ce73a[_0x5b2ef1=_0x4ef10e[_0x4166ce(0xaa)]]||(_0x4ce73a[_0x5b2ef1]=[]),_0x4ce73a[_0x4ef10e[_0x4166ce(0xaa)]]['push'](_0x4ef10e);}return Object[_0x4166ce(0xe4)](_0x4ce73a)[_0x4166ce(0xa2)]((_0x3e35ed,_0x46d8eb)=>[..._0x3e35ed,..._0x46d8eb],[]);}async['writeComponents'](_0xae775a){const _0x29f0f7=a181_0x53b216;_0xae775a=this[_0x29f0f7(0xf6)](_0xae775a);let _0x1e5084=0x0;while(_0xae775a['length']){const _0x5c362c=_0xae775a[_0x29f0f7(0xf8)](0x0,this[_0x29f0f7(0xaf)]);await this[_0x29f0f7(0xf1)]['writeFlosumComponents'](_0x5c362c,{'skipChildErrors':this[_0x29f0f7(0xbf)][_0x29f0f7(0xf3)][_0x29f0f7(0xae)]===_0x29f0f7(0xca)}),_0x1e5084+=_0x5c362c[_0x29f0f7(0xc6)],this[_0x29f0f7(0xe3)][_0x29f0f7(0xad)](_0x29f0f7(0xe1)+_0x1e5084+'/'+this[_0x29f0f7(0x9e)]+'\x20components'),await this[_0x29f0f7(0xe3)]['send']();}}async[a181_0x53b216(0xd1)](_0x8ab610){const _0x157d4d=a181_0x53b216;_0x8ab610[_0x157d4d(0xfa)](_0x2fd857=>child_types_1[_0x157d4d(0xc2)][_0x157d4d(0x94)](_0x2fd857[_0x157d4d(0xef)])?-0x1:0x1);let _0x540b55=0x0;while(_0x8ab610[_0x157d4d(0xc6)]){const _0x3dedb1=_0x8ab610['splice'](0x0,this[_0x157d4d(0xaf)]);await this[_0x157d4d(0xf1)][_0x157d4d(0xd1)](_0x3dedb1),_0x540b55+=_0x3dedb1[_0x157d4d(0xc6)],this[_0x157d4d(0xe3)][_0x157d4d(0xad)](_0x157d4d(0xe9)+_0x540b55+'/'+this['componentsToDelete']+_0x157d4d(0x100)),await this[_0x157d4d(0xe3)][_0x157d4d(0xed)]();}}async[a181_0x53b216(0xdc)](){const _0x189f9a=a181_0x53b216;this[_0x189f9a(0xa6)]&&await this[_0x189f9a(0xa6)][_0x189f9a(0xc5)]()[_0x189f9a(0xd7)](()=>void 0x0),this[_0x189f9a(0xf1)]&&await this['mdapiUtils']['removeDir']()['catch'](()=>void 0x0),this[_0x189f9a(0x97)]&&await this[_0x189f9a(0x97)][_0x189f9a(0xc5)]()[_0x189f9a(0xd7)](()=>void 0x0);}async[a181_0x53b216(0x9c)](){const _0xc4edd7=a181_0x53b216,{repo:_0x4efd64,branch:_0x437278,components:_0x5660c4,convertToSFDX:_0x16a0eb,message:_0x2710f2,user:_0x515cd8}=this['commitData'];this[_0xc4edd7(0xf1)]=new mdapi_utils_1[(_0xc4edd7(0x102))](),this[_0xc4edd7(0xa6)]=new git_utils_1['GitUtils'](await this[_0xc4edd7(0xe0)]()),this['sfdxUtils']=new sfdx_utils_1[(_0xc4edd7(0x9a))]();let _0x447613=_0x16a0eb;try{this['sfLogger'][_0xc4edd7(0xad)]('[INFO]\x20Start\x20clonning\x20repository'),await this[_0xc4edd7(0xa6)][_0xc4edd7(0xc1)](_0x437278['name'],_0x4efd64[_0xc4edd7(0xae)]);!this[_0xc4edd7(0xbf)][_0xc4edd7(0xa1)]?(this[_0xc4edd7(0xe3)][_0xc4edd7(0xad)](_0xc4edd7(0xd2)),await this[_0xc4edd7(0xf1)][_0xc4edd7(0xbe)](this['gitUtils'][_0xc4edd7(0xb9)])):this[_0xc4edd7(0xe3)][_0xc4edd7(0xad)](_0xc4edd7(0xa7));_0x5660c4[_0xc4edd7(0xf7)]&&(this[_0xc4edd7(0xe3)][_0xc4edd7(0xad)](_0xc4edd7(0xe7)),this[_0xc4edd7(0x9e)]=_0x5660c4[_0xc4edd7(0xf7)][_0xc4edd7(0xc6)],await this['writeComponents'](_0x5660c4['writed']),await this['sfLogger']['send']());_0x5660c4[_0xc4edd7(0x9f)]&&(this['sfLogger']['log'](_0xc4edd7(0xa3)),this[_0xc4edd7(0xb5)]=_0x5660c4['deleted'][_0xc4edd7(0xc6)],await this[_0xc4edd7(0xd1)](_0x5660c4[_0xc4edd7(0x9f)]),await this['sfLogger'][_0xc4edd7(0xed)]());await this[_0xc4edd7(0xe3)]['send']();const _0x5d1439=await fs_internal_1['FS']['isEmptyDir'](this[_0xc4edd7(0xa6)][_0xc4edd7(0xb9)]);await sfdx_utils_2[_0xc4edd7(0xb4)][_0xc4edd7(0xc7)](this[_0xc4edd7(0xa6)][_0xc4edd7(0xb9)])?(_0x447613=!![],await fs_internal_1['FS'][_0xc4edd7(0xc5)](path_1[_0xc4edd7(0xfc)](this[_0xc4edd7(0xa6)]['dir'],'force-app'))):(_0x447613&&(!_0x5d1439&&(_0x447613=![])),await this[_0xc4edd7(0xa6)][_0xc4edd7(0xf5)]());_0x447613?(this[_0xc4edd7(0xe3)][_0xc4edd7(0xad)]('[INFO]\x20Start\x20converting\x20to\x20SFDX'),await this[_0xc4edd7(0x97)][_0xc4edd7(0xda)](this[_0xc4edd7(0xf1)][_0xc4edd7(0xb9)]),await this[_0xc4edd7(0x97)]['copyProjectTo'](this[_0xc4edd7(0xa6)][_0xc4edd7(0xb9)],!_0x5d1439),await this[_0xc4edd7(0x97)][_0xc4edd7(0xc5)](),await this[_0xc4edd7(0xe3)]['send']()):(this[_0xc4edd7(0xe3)][_0xc4edd7(0xad)](_0xc4edd7(0xd4)),await this['mdapiUtils'][_0xc4edd7(0x98)](this[_0xc4edd7(0xa6)][_0xc4edd7(0xb9)]),await this[_0xc4edd7(0xe3)][_0xc4edd7(0xed)]());this['sfLogger']['log'](_0xc4edd7(0xee)),await this[_0xc4edd7(0xa6)][_0xc4edd7(0xc3)](_0x2710f2,{'email':constants_1['DEFAULT_GIT_USER_EMAIL'],'name':_0x515cd8['name']},_0x437278[_0xc4edd7(0xae)]),await this['gitUtils'][_0xc4edd7(0xc5)](),await this[_0xc4edd7(0xf1)][_0xc4edd7(0xc5)]();const _0x37c51a=this['componentsToWrite']+this[_0xc4edd7(0xb5)];this[_0xc4edd7(0xe3)][_0xc4edd7(0xad)](_0xc4edd7(0xa0)+(Date[_0xc4edd7(0xbb)]()-this[_0xc4edd7(0xdb)])+_0xc4edd7(0xf9)+_0x37c51a),await this[_0xc4edd7(0xe3)][_0xc4edd7(0xed)]();}catch(_0x2fd283){await this[_0xc4edd7(0xdc)](),this[_0xc4edd7(0xe3)][_0xc4edd7(0xad)](_0xc4edd7(0xe5)+_0x2fd283),await this[_0xc4edd7(0xe3)][_0xc4edd7(0xed)]();throw _0x2fd283;}}async[a181_0x53b216(0xa5)](_0x49f217,_0x505513){const _0x17ed97=a181_0x53b216;var _0x19ffa1,_0x30f6f1;this[_0x17ed97(0xe3)]=new salesforce_logger_v2_service_1[(_0x17ed97(0xfb))](_0x505513[_0x17ed97(0xb1)](),_0x505513['getPrefix']()+'\x20['+commit_components_dto_1[_0x17ed97(0xcc)]['name']+']');const _0x52f5af=!!((_0x19ffa1=_0x49f217['components'])===null||_0x19ffa1===void 0x0?void 0x0:_0x19ffa1['writed'])||!!((_0x30f6f1=_0x49f217[_0x17ed97(0xd6)])===null||_0x30f6f1===void 0x0?void 0x0:_0x30f6f1['deleted']);if(!_0x52f5af){this['sfLogger']['log'](_0x17ed97(0xc4)),await this['sfLogger']['send']();return;}this[_0x17ed97(0xbf)]=_0x49f217,await this[_0x17ed97(0x9c)]();}};CommitComponentsJob=__decorate([typedi_1[a181_0x53b216(0xba)]({'transient':!![]}),__metadata('design:paramtypes',[auth_settings_service_1[a181_0x53b216(0xd9)]])],CommitComponentsJob),exports[a181_0x53b216(0xa8)]=CommitComponentsJob;