const a181_0x462d3d=a181_0x19eb;(function(_0x595feb,_0x5c37e1){const _0x34db8a=a181_0x19eb,_0x32c888=_0x595feb();while(!![]){try{const _0x3d5074=-parseInt(_0x34db8a(0x116))/0x1*(parseInt(_0x34db8a(0xfd))/0x2)+parseInt(_0x34db8a(0x123))/0x3+parseInt(_0x34db8a(0x11d))/0x4*(-parseInt(_0x34db8a(0xc9))/0x5)+-parseInt(_0x34db8a(0xeb))/0x6+-parseInt(_0x34db8a(0x103))/0x7+parseInt(_0x34db8a(0xf9))/0x8+parseInt(_0x34db8a(0xc1))/0x9;if(_0x3d5074===_0x5c37e1)break;else _0x32c888['push'](_0x32c888['shift']());}catch(_0x3d951a){_0x32c888['push'](_0x32c888['shift']());}}}(a181_0x3bf3,0x3a838));const a181_0x39573d=(function(){let _0x490474=!![];return function(_0x56e770,_0x2923cb){const _0x3bb8a1=_0x490474?function(){const _0x317c5c=a181_0x19eb;if(_0x2923cb){const _0x5de455=_0x2923cb[_0x317c5c(0x126)](_0x56e770,arguments);return _0x2923cb=null,_0x5de455;}}:function(){};return _0x490474=![],_0x3bb8a1;};}()),a181_0x236a59=a181_0x39573d(this,function(){const _0x5240bf=a181_0x19eb;return a181_0x236a59['toString']()['search'](_0x5240bf(0xf0))[_0x5240bf(0x102)]()['constructor'](a181_0x236a59)[_0x5240bf(0xf7)](_0x5240bf(0xf0));});a181_0x236a59();function a181_0x19eb(_0x37c57e,_0x5e6bb7){const _0x5729f2=a181_0x3bf3();return a181_0x19eb=function(_0x236a59,_0x39573d){_0x236a59=_0x236a59-0xb8;let _0x3bf301=_0x5729f2[_0x236a59];return _0x3bf301;},a181_0x19eb(_0x37c57e,_0x5e6bb7);}'use strict';var __createBinding=this&&this[a181_0x462d3d(0xb8)]||(Object[a181_0x462d3d(0x10a)]?function(_0x48e980,_0x28e3e3,_0x43b1db,_0x57bfdd){const _0x27f995=a181_0x462d3d;if(_0x57bfdd===undefined)_0x57bfdd=_0x43b1db;Object[_0x27f995(0xf3)](_0x48e980,_0x57bfdd,{'enumerable':!![],'get':function(){return _0x28e3e3[_0x43b1db];}});}:function(_0x1ff1ae,_0x22d384,_0x21669a,_0x3162cb){if(_0x3162cb===undefined)_0x3162cb=_0x21669a;_0x1ff1ae[_0x3162cb]=_0x22d384[_0x21669a];}),__setModuleDefault=this&&this[a181_0x462d3d(0xe6)]||(Object[a181_0x462d3d(0x10a)]?function(_0x585135,_0x528ab7){const _0x307050=a181_0x462d3d;Object[_0x307050(0xf3)](_0x585135,_0x307050(0xda),{'enumerable':!![],'value':_0x528ab7});}:function(_0x27cd34,_0x7f6df4){_0x27cd34['default']=_0x7f6df4;}),__decorate=this&&this[a181_0x462d3d(0xe9)]||function(_0x3e1dcb,_0x3ea1d0,_0x186c00,_0x398a40){const _0x1c6560=a181_0x462d3d;var _0x14d188=arguments[_0x1c6560(0x127)],_0x51a540=_0x14d188<0x3?_0x3ea1d0:_0x398a40===null?_0x398a40=Object[_0x1c6560(0xce)](_0x3ea1d0,_0x186c00):_0x398a40,_0x5af056;if(typeof Reflect===_0x1c6560(0x104)&&typeof Reflect[_0x1c6560(0xd1)]===_0x1c6560(0xf4))_0x51a540=Reflect[_0x1c6560(0xd1)](_0x3e1dcb,_0x3ea1d0,_0x186c00,_0x398a40);else{for(var _0xdc5814=_0x3e1dcb[_0x1c6560(0x127)]-0x1;_0xdc5814>=0x0;_0xdc5814--)if(_0x5af056=_0x3e1dcb[_0xdc5814])_0x51a540=(_0x14d188<0x3?_0x5af056(_0x51a540):_0x14d188>0x3?_0x5af056(_0x3ea1d0,_0x186c00,_0x51a540):_0x5af056(_0x3ea1d0,_0x186c00))||_0x51a540;}return _0x14d188>0x3&&_0x51a540&&Object['defineProperty'](_0x3ea1d0,_0x186c00,_0x51a540),_0x51a540;},__importStar=this&&this[a181_0x462d3d(0x11f)]||function(_0x558363){const _0x3d499b=a181_0x462d3d;if(_0x558363&&_0x558363[_0x3d499b(0xd2)])return _0x558363;var _0x426197={};if(_0x558363!=null){for(var _0x290a4f in _0x558363)if(_0x290a4f!=='default'&&Object['prototype']['hasOwnProperty'][_0x3d499b(0xdc)](_0x558363,_0x290a4f))__createBinding(_0x426197,_0x558363,_0x290a4f);}return __setModuleDefault(_0x426197,_0x558363),_0x426197;},__metadata=this&&this['__metadata']||function(_0x24e7df,_0x1e7600){const _0x460dfc=a181_0x462d3d;if(typeof Reflect==='object'&&typeof Reflect[_0x460dfc(0xde)]===_0x460dfc(0xf4))return Reflect[_0x460dfc(0xde)](_0x24e7df,_0x1e7600);},__importDefault=this&&this[a181_0x462d3d(0xec)]||function(_0x15ac99){const _0x2d22ce=a181_0x462d3d;return _0x15ac99&&_0x15ac99[_0x2d22ce(0xd2)]?_0x15ac99:{'default':_0x15ac99};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a181_0x462d3d(0x100)]=void 0x0;const auth_settings_service_1=require(a181_0x462d3d(0xf1)),commit_components_dto_1=require(a181_0x462d3d(0x11c)),events_1=__importDefault(require(a181_0x462d3d(0xb9))),git_utils_1=require(a181_0x462d3d(0xe7)),mdapi_utils_1=require(a181_0x462d3d(0x121)),sfdx_utils_1=require(a181_0x462d3d(0x111)),typedi_1=__importStar(require(a181_0x462d3d(0xe5))),child_types_1=__importDefault(require(a181_0x462d3d(0xf5))),utils_1=require('../../shared/utils'),salesforce_logger_v2_service_1=require(a181_0x462d3d(0xe3)),constants_1=require('../../../constants'),bitbucket_api_service_1=require('../../git-api/services/bitbucket-api.service'),sfdx_utils_2=require(a181_0x462d3d(0x129)),fs_internal_1=require(a181_0x462d3d(0xe4)),path_1=require('path');let CommitComponentsJob=class CommitComponentsJob extends events_1['default']{constructor(_0x377512){const _0x373d9d=a181_0x462d3d;super(),this[_0x373d9d(0xf2)]=_0x377512,this[_0x373d9d(0xfe)]=0x3e8,this[_0x373d9d(0xbc)]=0x0,this[_0x373d9d(0x125)]=0x0,this[_0x373d9d(0x10c)]=Date[_0x373d9d(0x120)]();}async[a181_0x462d3d(0x119)](){const _0x3203c9=a181_0x462d3d,{repo:_0x37dfa3}=this['commitData'];let _0x29b151=this[_0x3203c9(0xf2)][_0x3203c9(0xca)](this[_0x3203c9(0xc8)][_0x3203c9(0xd4)]);if(this[_0x3203c9(0xc8)][_0x3203c9(0xd4)]===_0x3203c9(0x124)){const _0x580f76=typedi_1[_0x3203c9(0xda)][_0x3203c9(0x108)](bitbucket_api_service_1[_0x3203c9(0xee)]);await _0x580f76[_0x3203c9(0xcb)](),_0x29b151+=encodeURIComponent(_0x580f76[_0x3203c9(0xcc)]());}return _0x37dfa3['gitUrl']['replace'](/http(s)?:\/\/(.+@)?/,utils_1[_0x3203c9(0xd6)](_0x37dfa3['gitUrl'])+_0x3203c9(0x118)+_0x29b151+'@');}[a181_0x462d3d(0xd0)](_0x280ea8){const _0x58e1f4=a181_0x462d3d;var _0x191017;_0x280ea8['sort'](_0x1664f2=>child_types_1['default']['includes'](_0x1664f2[_0x58e1f4(0xd3)])?0x1:-0x1);const _0x2d97a1={};for(const _0x21f268 of _0x280ea8){_0x2d97a1[_0x191017=_0x21f268[_0x58e1f4(0xfc)]]||(_0x2d97a1[_0x191017]=[]),_0x2d97a1[_0x21f268[_0x58e1f4(0xfc)]][_0x58e1f4(0x101)](_0x21f268);}return Object['values'](_0x2d97a1)[_0x58e1f4(0x10e)]((_0x263f4d,_0x242123)=>[..._0x263f4d,..._0x242123],[]);}async[a181_0x462d3d(0xe8)](_0x1aa0ab){const _0x10509f=a181_0x462d3d;_0x1aa0ab=this[_0x10509f(0xd0)](_0x1aa0ab);let _0x504abd=0x0;while(_0x1aa0ab[_0x10509f(0x127)]){const _0xb78af3=_0x1aa0ab[_0x10509f(0x122)](0x0,this[_0x10509f(0xfe)]);await this[_0x10509f(0xbd)]['writeFlosumComponents'](_0xb78af3,{'skipChildErrors':this['commitData'][_0x10509f(0x11b)][_0x10509f(0x106)]===_0x10509f(0xbf)}),_0x504abd+=_0xb78af3[_0x10509f(0x127)],this['sfLogger'][_0x10509f(0xe1)](_0x10509f(0xdf)+_0x504abd+'/'+this[_0x10509f(0xbc)]+_0x10509f(0x113)),await this['sfLogger'][_0x10509f(0xe0)]();}}async[a181_0x462d3d(0x11e)](_0x37c9f4){const _0x52c355=a181_0x462d3d;_0x37c9f4[_0x52c355(0x112)](_0x35fb69=>child_types_1[_0x52c355(0xda)][_0x52c355(0x114)](_0x35fb69[_0x52c355(0xed)])?-0x1:0x1);let _0x53735b=0x0;while(_0x37c9f4[_0x52c355(0x127)]){const _0x4c87bb=_0x37c9f4[_0x52c355(0x122)](0x0,this['COMPONENTS_PER_TICK']);await this[_0x52c355(0xbd)]['removeComponents'](_0x4c87bb),_0x53735b+=_0x4c87bb[_0x52c355(0x127)],this['sfLogger'][_0x52c355(0xe1)](_0x52c355(0xf6)+_0x53735b+'/'+this[_0x52c355(0x125)]+_0x52c355(0x113)),await this[_0x52c355(0xd8)][_0x52c355(0xe0)]();}}async[a181_0x462d3d(0xe2)](){const _0x3f08bf=a181_0x462d3d;this['gitUtils']&&await this[_0x3f08bf(0x110)][_0x3f08bf(0xbe)]()[_0x3f08bf(0xd5)](()=>void 0x0),this[_0x3f08bf(0xbd)]&&await this[_0x3f08bf(0xbd)][_0x3f08bf(0xbe)]()[_0x3f08bf(0xd5)](()=>void 0x0),this[_0x3f08bf(0xea)]&&await this[_0x3f08bf(0xea)][_0x3f08bf(0xbe)]()[_0x3f08bf(0xd5)](()=>void 0x0);}async[a181_0x462d3d(0xef)](){const _0x4e3193=a181_0x462d3d,{repo:_0x20a04f,branch:_0x70f587,components:_0x5471dd,convertToSFDX:_0x527f7a,message:_0x264b60,user:_0x480277}=this[_0x4e3193(0xc8)];this['mdapiUtils']=new mdapi_utils_1[(_0x4e3193(0xc4))](),this[_0x4e3193(0x110)]=new git_utils_1['GitUtils'](await this[_0x4e3193(0x119)]()),this['sfdxUtils']=new sfdx_utils_1[(_0x4e3193(0x10d))]();let _0x2a0e4d=_0x527f7a;try{this[_0x4e3193(0xd8)][_0x4e3193(0xe1)](_0x4e3193(0xc2)),await this['gitUtils'][_0x4e3193(0xba)](_0x70f587[_0x4e3193(0x106)],_0x20a04f[_0x4e3193(0x106)]);!this[_0x4e3193(0xc8)]['force']?(this[_0x4e3193(0xd8)][_0x4e3193(0xe1)](_0x4e3193(0x128)),await this[_0x4e3193(0xbd)][_0x4e3193(0x10f)](this['gitUtils'][_0x4e3193(0xcf)])):this[_0x4e3193(0xd8)][_0x4e3193(0xe1)](_0x4e3193(0xf8));_0x5471dd['writed']&&(this['sfLogger']['log'](_0x4e3193(0xd9)),this['componentsToWrite']=_0x5471dd[_0x4e3193(0x109)][_0x4e3193(0x127)],await this['writeComponents'](_0x5471dd[_0x4e3193(0x109)]),await this['sfLogger'][_0x4e3193(0xe0)]());_0x5471dd[_0x4e3193(0xc5)]&&(this[_0x4e3193(0xd8)][_0x4e3193(0xe1)]('[INFO]\x20Preparing\x20to\x20delete\x20components'),this[_0x4e3193(0x125)]=_0x5471dd[_0x4e3193(0xc5)][_0x4e3193(0x127)],await this[_0x4e3193(0x11e)](_0x5471dd['deleted']),await this[_0x4e3193(0xd8)][_0x4e3193(0xe0)]());await this['sfLogger'][_0x4e3193(0xe0)]();const _0x201994=await fs_internal_1['FS'][_0x4e3193(0x107)](this[_0x4e3193(0x110)][_0x4e3193(0xcf)]);await sfdx_utils_2[_0x4e3193(0xcd)][_0x4e3193(0x115)](this['gitUtils']['dir'])?(_0x2a0e4d=!![],await fs_internal_1['FS']['removeDir'](path_1[_0x4e3193(0xc6)](this['gitUtils'][_0x4e3193(0xcf)],'force-app'))):(_0x2a0e4d&&(!_0x201994&&(_0x2a0e4d=![])),await this[_0x4e3193(0x110)]['clearDir']());_0x2a0e4d?(this[_0x4e3193(0xd8)][_0x4e3193(0xe1)](_0x4e3193(0x10b)),await this[_0x4e3193(0xea)][_0x4e3193(0xfb)](this[_0x4e3193(0xbd)][_0x4e3193(0xcf)]),await this['sfdxUtils'][_0x4e3193(0x117)](this[_0x4e3193(0x110)]['dir'],!_0x201994),await this[_0x4e3193(0xea)]['removeDir'](),await this['sfLogger'][_0x4e3193(0xe0)]()):(this[_0x4e3193(0xd8)]['log'](_0x4e3193(0xff)),await this[_0x4e3193(0xbd)][_0x4e3193(0xdd)](this['gitUtils']['dir']),await this['sfLogger'][_0x4e3193(0xe0)]());this[_0x4e3193(0xd8)][_0x4e3193(0xe1)](_0x4e3193(0x12c)),await this[_0x4e3193(0x110)][_0x4e3193(0xfa)](_0x264b60,{'email':constants_1[_0x4e3193(0x105)],'name':_0x480277[_0x4e3193(0x106)]},_0x70f587[_0x4e3193(0x106)]),await this[_0x4e3193(0x110)][_0x4e3193(0xbe)](),await this['mdapiUtils'][_0x4e3193(0xbe)]();const _0x32233b=this[_0x4e3193(0xbc)]+this[_0x4e3193(0x125)];this[_0x4e3193(0xd8)][_0x4e3193(0xe1)](_0x4e3193(0xc0)+(Date[_0x4e3193(0x120)]()-this['startTime'])+_0x4e3193(0xd7)+_0x32233b),await this[_0x4e3193(0xd8)]['send']();}catch(_0x5ed1f8){await this[_0x4e3193(0xe2)](),this[_0x4e3193(0xd8)][_0x4e3193(0xe1)]('[ERROR]\x20'+_0x5ed1f8),await this[_0x4e3193(0xd8)][_0x4e3193(0xe0)]();throw _0x5ed1f8;}}async['run'](_0x31c5f8,_0x241601){const _0x4d0b95=a181_0x462d3d;var _0x43f1f7,_0x2ea94f;this[_0x4d0b95(0xd8)]=new salesforce_logger_v2_service_1[(_0x4d0b95(0xdb))](_0x241601[_0x4d0b95(0x12b)](),_0x241601[_0x4d0b95(0x11a)]()+'\x20['+commit_components_dto_1[_0x4d0b95(0xc3)][_0x4d0b95(0x106)]+']');const _0x488bc1=!!((_0x43f1f7=_0x31c5f8[_0x4d0b95(0xc7)])===null||_0x43f1f7===void 0x0?void 0x0:_0x43f1f7[_0x4d0b95(0x109)])||!!((_0x2ea94f=_0x31c5f8['components'])===null||_0x2ea94f===void 0x0?void 0x0:_0x2ea94f[_0x4d0b95(0xc5)]);if(!_0x488bc1){this[_0x4d0b95(0xd8)]['log']('[INFO]\x20Nothing\x20to\x20commit.\x20Skip.'),await this[_0x4d0b95(0xd8)][_0x4d0b95(0xe0)]();return;}this[_0x4d0b95(0xc8)]=_0x31c5f8,await this[_0x4d0b95(0xef)]();}};function a181_0x3bf3(){const _0x11030c=['../../parsers/data/child-types','[INFO]\x20Deleted\x20','search','[INFO]\x20Force\x20sync.\x20Skip\x20preparing\x20mdapi\x20from\x20repository.','3389888SQMlph','commitAndPush','createProjectFrom','fileName','73898BxTZue','COMPONENTS_PER_TICK','[INFO]\x20Copying\x20mdapi\x20to\x20git\x20folder','CommitComponentsJob','push','toString','2470398glyCJy','object','DEFAULT_GIT_USER_EMAIL','name','isEmptyDir','get','writed','create','[INFO]\x20Start\x20converting\x20to\x20SFDX','startTime','SFDXUtils','reduce','prepareMdapi','gitUtils','../utils/sfdx.utils','sort','\x20components','includes','isSFDXProject','6bKnmUc','copyProjectTo','://','getRemote','getPrefix','branch','../dto/commit-components.dto','100612vpVtIC','removeComponents','__importStar','now','../utils/mdapi.utils','splice','1155549uJPTpW','bitbucket','componentsToDelete','apply','length','[INFO]\x20Prepare\x20mdapi\x20files','../../salesforce/utils/sfdx.utils','AuthSettingsService','getLoggerId','[INFO]\x20Committing\x20and\x20pushing\x20source\x20to\x20git','__createBinding','events','clone','Service','componentsToWrite','mdapiUtils','removeDir','master','[INFO]\x20Commit\x20job\x20done.\x20Time\x20spent\x20-\x20','2973573Yljwbn','[INFO]\x20Start\x20clonning\x20repository','CommitComponentsDto','MDApiUtils','deleted','join','components','commitData','10fqxJKQ','getCredentialsFor','isLoggedIn','getAccessToken','SFDX','getOwnPropertyDescriptor','dir','groupComponentsByFileName','decorate','__esModule','fileType','provider','catch','getProtocol','ms.\x20Committed\x20components\x20-\x20','sfLogger','[INFO]\x20Preparing\x20to\x20write\x20components','default','SalesforceLogger2','call','copyMdapiTo','metadata','[INFO]\x20Wrote\x20','send','log','cleanUp','../../salesforce/services/salesforce-logger-v2.service','../../internal/fs.internal','typedi','__setModuleDefault','../utils/git.utils','writeComponents','__decorate','sfdxUtils','1648380sQsjXi','__importDefault','type','BitbucketApiService','exec','(((.+)+)+)+$','../../shared/services/auth-settings.service','authSettings','defineProperty','function'];a181_0x3bf3=function(){return _0x11030c;};return a181_0x3bf3();}CommitComponentsJob=__decorate([typedi_1[a181_0x462d3d(0xbb)]({'transient':!![]}),__metadata('design:paramtypes',[auth_settings_service_1[a181_0x462d3d(0x12a)]])],CommitComponentsJob),exports[a181_0x462d3d(0x100)]=CommitComponentsJob;