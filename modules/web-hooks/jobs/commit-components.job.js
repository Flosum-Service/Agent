const a181_0x41760c=a181_0x1b91;function a181_0x1b91(_0x3b9611,_0x307cdf){const _0x401123=a181_0x3a9f();return a181_0x1b91=function(_0x4a4ccb,_0x5260f4){_0x4a4ccb=_0x4a4ccb-0x12d;let _0x3a9f4e=_0x401123[_0x4a4ccb];return _0x3a9f4e;},a181_0x1b91(_0x3b9611,_0x307cdf);}function a181_0x3a9f(){const _0x5a4d59=['AuthSettingsService','gitUtils','run','call','4834379WJfpWI','default','[INFO]\x20Commit\x20job\x20done.\x20Time\x20spent\x20-\x20','prototype','Service','groupComponentsByFileName','__esModule','../utils/mdapi.utils','now','writed','gitUrl','[INFO]\x20Prepare\x20mdapi\x20files','1047064OUoZQN','getProtocol','dir','deleted','removeDir','fileName','force','(((.+)+)+)+$','10aDIlfh','getOwnPropertyDescriptor','createProjectFrom','getCredentialsFor','921702lIGVeh','../../internal/fs.internal','SFDX','cleanUp','../../git-api/services/bitbucket-api.service','apply','authSettings','removeComponents','writeComponents','catch','toString','replace','__decorate','../../shared/utils','reduce','commitData','name','CommitComponentsJob','GitUtils','defineProperty','isSFDXProject','function','ms.\x20Committed\x20components\x20-\x20','events','3009456lxknVb','__metadata','../../salesforce/utils/sfdx.utils','provider','log','SalesforceLogger2','decorate','CommitComponentsDto','485YMuReu','master','[INFO]\x20Deleted\x20','[INFO]\x20Start\x20converting\x20to\x20SFDX','[INFO]\x20Copying\x20mdapi\x20to\x20git\x20folder','212fOPFBm','clone','5690wWtFRU','get','isEmptyDir','1056xJhUru','COMPONENTS_PER_TICK','\x20components','[INFO]\x20Committing\x20and\x20pushing\x20source\x20to\x20git','force-app','getRemote','prepareMdapi','getAccessToken','create','branch','componentsToDelete','hasOwnProperty','[INFO]\x20Preparing\x20to\x20write\x20components','join','BitbucketApiService','sfdxUtils','includes','push','../utils/sfdx.utils','copyMdapiTo','sfLogger','componentsToWrite','send','__importStar','length','search','://','values','object','sort','MDApiUtils','[INFO]\x20Wrote\x20','startTime','exec','[INFO]\x20Start\x20clonning\x20repository','mdapiUtils','1694bMiqsA','12RCexXf','metadata','18CBKSsU','getPrefix','__createBinding'];a181_0x3a9f=function(){return _0x5a4d59;};return a181_0x3a9f();}(function(_0x22a5c5,_0x1a4b20){const _0x5878af=a181_0x1b91,_0x445b09=_0x22a5c5();while(!![]){try{const _0x4e74c8=parseInt(_0x5878af(0x174))/0x1*(parseInt(_0x5878af(0x179))/0x2)+parseInt(_0x5878af(0x154))/0x3+-parseInt(_0x5878af(0x133))/0x4*(parseInt(_0x5878af(0x17b))/0x5)+parseInt(_0x5878af(0x17e))/0x6*(-parseInt(_0x5878af(0x132))/0x7)+parseInt(_0x5878af(0x148))/0x8*(-parseInt(_0x5878af(0x135))/0x9)+-parseInt(_0x5878af(0x150))/0xa*(-parseInt(_0x5878af(0x13c))/0xb)+-parseInt(_0x5878af(0x16c))/0xc;if(_0x4e74c8===_0x1a4b20)break;else _0x445b09['push'](_0x445b09['shift']());}catch(_0x160640){_0x445b09['push'](_0x445b09['shift']());}}}(a181_0x3a9f,0x3a7d5));const a181_0x5260f4=(function(){let _0x1323f8=!![];return function(_0x575c24,_0x2c22da){const _0x518afc=_0x1323f8?function(){const _0x2a62e1=a181_0x1b91;if(_0x2c22da){const _0x1f6530=_0x2c22da[_0x2a62e1(0x159)](_0x575c24,arguments);return _0x2c22da=null,_0x1f6530;}}:function(){};return _0x1323f8=![],_0x518afc;};}()),a181_0x4a4ccb=a181_0x5260f4(this,function(){const _0x15b84c=a181_0x1b91;return a181_0x4a4ccb[_0x15b84c(0x15e)]()[_0x15b84c(0x197)](_0x15b84c(0x14f))[_0x15b84c(0x15e)]()['constructor'](a181_0x4a4ccb)[_0x15b84c(0x197)](_0x15b84c(0x14f));});a181_0x4a4ccb();'use strict';var __createBinding=this&&this[a181_0x41760c(0x137)]||(Object[a181_0x41760c(0x186)]?function(_0x45cd85,_0x4ca3cc,_0xf14b35,_0x29da9e){const _0x2e9d7c=a181_0x41760c;if(_0x29da9e===undefined)_0x29da9e=_0xf14b35;Object[_0x2e9d7c(0x167)](_0x45cd85,_0x29da9e,{'enumerable':!![],'get':function(){return _0x4ca3cc[_0xf14b35];}});}:function(_0xc57a98,_0x22f20a,_0xe00a01,_0x423266){if(_0x423266===undefined)_0x423266=_0xe00a01;_0xc57a98[_0x423266]=_0x22f20a[_0xe00a01];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a181_0x41760c(0x186)]?function(_0x162e38,_0x295b0b){const _0x437e66=a181_0x41760c;Object[_0x437e66(0x167)](_0x162e38,'default',{'enumerable':!![],'value':_0x295b0b});}:function(_0x341fad,_0x2a7c97){const _0x187642=a181_0x41760c;_0x341fad[_0x187642(0x13d)]=_0x2a7c97;}),__decorate=this&&this[a181_0x41760c(0x160)]||function(_0x2bf0cb,_0x3052b7,_0x357cea,_0x5541fa){const _0x3d14d8=a181_0x41760c;var _0x1931f1=arguments[_0x3d14d8(0x196)],_0x5b5956=_0x1931f1<0x3?_0x3052b7:_0x5541fa===null?_0x5541fa=Object[_0x3d14d8(0x151)](_0x3052b7,_0x357cea):_0x5541fa,_0x25dc55;if(typeof Reflect===_0x3d14d8(0x19a)&&typeof Reflect['decorate']===_0x3d14d8(0x169))_0x5b5956=Reflect[_0x3d14d8(0x172)](_0x2bf0cb,_0x3052b7,_0x357cea,_0x5541fa);else{for(var _0x928882=_0x2bf0cb[_0x3d14d8(0x196)]-0x1;_0x928882>=0x0;_0x928882--)if(_0x25dc55=_0x2bf0cb[_0x928882])_0x5b5956=(_0x1931f1<0x3?_0x25dc55(_0x5b5956):_0x1931f1>0x3?_0x25dc55(_0x3052b7,_0x357cea,_0x5b5956):_0x25dc55(_0x3052b7,_0x357cea))||_0x5b5956;}return _0x1931f1>0x3&&_0x5b5956&&Object[_0x3d14d8(0x167)](_0x3052b7,_0x357cea,_0x5b5956),_0x5b5956;},__importStar=this&&this[a181_0x41760c(0x195)]||function(_0x4a1e43){const _0x3d8eeb=a181_0x41760c;if(_0x4a1e43&&_0x4a1e43[_0x3d8eeb(0x142)])return _0x4a1e43;var _0x4be88c={};if(_0x4a1e43!=null){for(var _0x4410ae in _0x4a1e43)if(_0x4410ae!=='default'&&Object[_0x3d8eeb(0x13f)][_0x3d8eeb(0x189)][_0x3d8eeb(0x13b)](_0x4a1e43,_0x4410ae))__createBinding(_0x4be88c,_0x4a1e43,_0x4410ae);}return __setModuleDefault(_0x4be88c,_0x4a1e43),_0x4be88c;},__metadata=this&&this[a181_0x41760c(0x16d)]||function(_0x219948,_0x584816){const _0xdd74f5=a181_0x41760c;if(typeof Reflect===_0xdd74f5(0x19a)&&typeof Reflect[_0xdd74f5(0x134)]===_0xdd74f5(0x169))return Reflect[_0xdd74f5(0x134)](_0x219948,_0x584816);},__importDefault=this&&this['__importDefault']||function(_0x2bafd3){const _0x1b03df=a181_0x41760c;return _0x2bafd3&&_0x2bafd3[_0x1b03df(0x142)]?_0x2bafd3:{'default':_0x2bafd3};};Object[a181_0x41760c(0x167)](exports,a181_0x41760c(0x142),{'value':!![]}),exports[a181_0x41760c(0x165)]=void 0x0;const auth_settings_service_1=require('../../shared/services/auth-settings.service'),commit_components_dto_1=require('../dto/commit-components.dto'),events_1=__importDefault(require(a181_0x41760c(0x16b))),git_utils_1=require('../utils/git.utils'),mdapi_utils_1=require(a181_0x41760c(0x143)),sfdx_utils_1=require(a181_0x41760c(0x190)),typedi_1=__importStar(require('typedi')),child_types_1=__importDefault(require('../../parsers/data/child-types')),utils_1=require(a181_0x41760c(0x161)),salesforce_logger_v2_service_1=require('../../salesforce/services/salesforce-logger-v2.service'),constants_1=require('../../../constants'),bitbucket_api_service_1=require(a181_0x41760c(0x158)),sfdx_utils_2=require(a181_0x41760c(0x16e)),fs_internal_1=require(a181_0x41760c(0x155)),path_1=require('path');let CommitComponentsJob=class CommitComponentsJob extends events_1['default']{constructor(_0x11db2d){const _0x5a4a7e=a181_0x41760c;super(),this[_0x5a4a7e(0x15a)]=_0x11db2d,this[_0x5a4a7e(0x17f)]=0x3e8,this[_0x5a4a7e(0x193)]=0x0,this[_0x5a4a7e(0x188)]=0x0,this['startTime']=Date[_0x5a4a7e(0x144)]();}async['getRemote'](){const _0x211a44=a181_0x41760c,{repo:_0x32dac8}=this[_0x211a44(0x163)];let _0x26e537=this[_0x211a44(0x15a)][_0x211a44(0x153)](this[_0x211a44(0x163)]['provider']);if(this[_0x211a44(0x163)][_0x211a44(0x16f)]==='bitbucket'){const _0x30a97b=typedi_1['default'][_0x211a44(0x17c)](bitbucket_api_service_1[_0x211a44(0x18c)]);await _0x30a97b['isLoggedIn'](),_0x26e537+=encodeURIComponent(_0x30a97b[_0x211a44(0x185)]());}return _0x32dac8['gitUrl'][_0x211a44(0x15f)](/http(s)?\:\/\/(.+@)?/,utils_1[_0x211a44(0x149)](_0x32dac8[_0x211a44(0x146)])+_0x211a44(0x198)+_0x26e537+'@');}[a181_0x41760c(0x141)](_0x4a2afd){const _0x1ba205=a181_0x41760c;var _0x4a7d42;_0x4a2afd[_0x1ba205(0x19b)](_0xeba4b7=>child_types_1[_0x1ba205(0x13d)][_0x1ba205(0x18e)](_0xeba4b7['fileType'])?0x1:-0x1);const _0x21b658={};for(const _0x13a2da of _0x4a2afd){_0x21b658[_0x4a7d42=_0x13a2da[_0x1ba205(0x14d)]]||(_0x21b658[_0x4a7d42]=[]),_0x21b658[_0x13a2da[_0x1ba205(0x14d)]][_0x1ba205(0x18f)](_0x13a2da);}return Object[_0x1ba205(0x199)](_0x21b658)[_0x1ba205(0x162)]((_0x444a26,_0x27d6de)=>[..._0x444a26,..._0x27d6de],[]);}async['writeComponents'](_0x479282){const _0x3f9370=a181_0x41760c;_0x479282=this[_0x3f9370(0x141)](_0x479282);let _0x457f7c=0x0;while(_0x479282[_0x3f9370(0x196)]){const _0xbf615=_0x479282['splice'](0x0,this[_0x3f9370(0x17f)]);await this['mdapiUtils']['writeFlosumComponents'](_0xbf615,{'skipChildErrors':this[_0x3f9370(0x163)][_0x3f9370(0x187)][_0x3f9370(0x164)]===_0x3f9370(0x175)}),_0x457f7c+=_0xbf615[_0x3f9370(0x196)],this[_0x3f9370(0x192)]['log'](_0x3f9370(0x12d)+_0x457f7c+'/'+this['componentsToWrite']+'\x20components'),await this['sfLogger'][_0x3f9370(0x194)]();}}async[a181_0x41760c(0x15b)](_0x4ac7d6){const _0x1597f3=a181_0x41760c;_0x4ac7d6['sort'](_0x3f520c=>child_types_1[_0x1597f3(0x13d)][_0x1597f3(0x18e)](_0x3f520c['type'])?-0x1:0x1);let _0x3be354=0x0;while(_0x4ac7d6[_0x1597f3(0x196)]){const _0x3e2242=_0x4ac7d6['splice'](0x0,this[_0x1597f3(0x17f)]);await this[_0x1597f3(0x131)][_0x1597f3(0x15b)](_0x3e2242),_0x3be354+=_0x3e2242[_0x1597f3(0x196)],this[_0x1597f3(0x192)]['log'](_0x1597f3(0x176)+_0x3be354+'/'+this[_0x1597f3(0x188)]+_0x1597f3(0x180)),await this[_0x1597f3(0x192)]['send']();}}async['cleanUp'](){const _0x414474=a181_0x41760c;this[_0x414474(0x139)]&&await this[_0x414474(0x139)][_0x414474(0x14c)]()[_0x414474(0x15d)](()=>void 0x0),this[_0x414474(0x131)]&&await this[_0x414474(0x131)][_0x414474(0x14c)]()[_0x414474(0x15d)](()=>void 0x0),this['sfdxUtils']&&await this[_0x414474(0x18d)][_0x414474(0x14c)]()[_0x414474(0x15d)](()=>void 0x0);}async[a181_0x41760c(0x12f)](){const _0x1c2142=a181_0x41760c,{repo:_0x322905,branch:_0x25481a,components:_0x467320,convertToSFDX:_0x5079b8,message:_0x1182ea,user:_0x397a95}=this[_0x1c2142(0x163)];this[_0x1c2142(0x131)]=new mdapi_utils_1[(_0x1c2142(0x19c))](_0x322905[_0x1c2142(0x164)],_0x25481a['name']),this[_0x1c2142(0x139)]=new git_utils_1[(_0x1c2142(0x166))](await this[_0x1c2142(0x183)]()),this[_0x1c2142(0x18d)]=new sfdx_utils_1['SFDXUtils'](_0x322905[_0x1c2142(0x164)],_0x25481a['name']);let _0x40270b=_0x5079b8;try{this[_0x1c2142(0x192)]['log'](_0x1c2142(0x130)),await this[_0x1c2142(0x139)][_0x1c2142(0x17a)](_0x25481a[_0x1c2142(0x164)],_0x322905['name']);!this[_0x1c2142(0x163)][_0x1c2142(0x14e)]?(this[_0x1c2142(0x192)][_0x1c2142(0x170)](_0x1c2142(0x147)),await this[_0x1c2142(0x131)][_0x1c2142(0x184)](this['gitUtils'][_0x1c2142(0x14a)])):this[_0x1c2142(0x192)][_0x1c2142(0x170)]('[INFO]\x20Force\x20sync.\x20Skip\x20preparing\x20mdapi\x20from\x20repository.');_0x467320[_0x1c2142(0x145)]&&(this[_0x1c2142(0x192)]['log'](_0x1c2142(0x18a)),this['componentsToWrite']=_0x467320[_0x1c2142(0x145)][_0x1c2142(0x196)],await this[_0x1c2142(0x15c)](_0x467320[_0x1c2142(0x145)]),await this[_0x1c2142(0x192)][_0x1c2142(0x194)]());_0x467320[_0x1c2142(0x14b)]&&(this[_0x1c2142(0x192)]['log']('[INFO]\x20Preparing\x20to\x20delete\x20components'),this[_0x1c2142(0x188)]=_0x467320[_0x1c2142(0x14b)][_0x1c2142(0x196)],await this[_0x1c2142(0x15b)](_0x467320[_0x1c2142(0x14b)]),await this[_0x1c2142(0x192)]['send']());await this[_0x1c2142(0x192)][_0x1c2142(0x194)]();await sfdx_utils_2[_0x1c2142(0x156)][_0x1c2142(0x168)](this[_0x1c2142(0x139)][_0x1c2142(0x14a)])?(_0x40270b=!![],await fs_internal_1['FS'][_0x1c2142(0x14c)](path_1[_0x1c2142(0x18b)](this[_0x1c2142(0x139)][_0x1c2142(0x14a)],_0x1c2142(0x182)))):(_0x40270b&&(!await fs_internal_1['FS'][_0x1c2142(0x17d)](this[_0x1c2142(0x139)]['dir'])&&(_0x40270b=![])),await this[_0x1c2142(0x139)]['clearDir']());_0x40270b?(this[_0x1c2142(0x192)]['log'](_0x1c2142(0x177)),await this['sfdxUtils'][_0x1c2142(0x152)](this[_0x1c2142(0x131)][_0x1c2142(0x14a)]),await this[_0x1c2142(0x18d)]['copyProjectTo'](this['gitUtils']['dir']),await this[_0x1c2142(0x18d)]['removeDir'](),await this[_0x1c2142(0x192)][_0x1c2142(0x194)]()):(this[_0x1c2142(0x192)][_0x1c2142(0x170)](_0x1c2142(0x178)),await this[_0x1c2142(0x131)][_0x1c2142(0x191)](this[_0x1c2142(0x139)]['dir']),await this['sfLogger'][_0x1c2142(0x194)]());this[_0x1c2142(0x192)]['log'](_0x1c2142(0x181)),await this[_0x1c2142(0x139)]['commitAndPush'](_0x1182ea,{'email':constants_1['DEFAULT_GIT_USER_EMAIL'],'name':_0x397a95[_0x1c2142(0x164)]},_0x25481a[_0x1c2142(0x164)]),await this[_0x1c2142(0x139)][_0x1c2142(0x14c)](),await this['mdapiUtils'][_0x1c2142(0x14c)]();const _0xbc198d=this[_0x1c2142(0x193)]+this['componentsToDelete'];this[_0x1c2142(0x192)]['log'](_0x1c2142(0x13e)+(Date[_0x1c2142(0x144)]()-this[_0x1c2142(0x12e)])+_0x1c2142(0x16a)+_0xbc198d),await this[_0x1c2142(0x192)][_0x1c2142(0x194)]();}catch(_0x5977f7){await this[_0x1c2142(0x157)](),this[_0x1c2142(0x192)][_0x1c2142(0x170)]('[ERROR]\x20'+_0x5977f7),await this['sfLogger'][_0x1c2142(0x194)]();throw _0x5977f7;}}async[a181_0x41760c(0x13a)](_0x46b426,_0x1aaac4){const _0x552859=a181_0x41760c;var _0xc6bd69,_0x230183;this[_0x552859(0x192)]=new salesforce_logger_v2_service_1[(_0x552859(0x171))](_0x1aaac4['getLoggerId'](),_0x1aaac4[_0x552859(0x136)]()+'\x20['+commit_components_dto_1[_0x552859(0x173)][_0x552859(0x164)]+']');const _0x5127a5=!!((_0xc6bd69=_0x46b426['components'])===null||_0xc6bd69===void 0x0?void 0x0:_0xc6bd69[_0x552859(0x145)])||!!((_0x230183=_0x46b426['components'])===null||_0x230183===void 0x0?void 0x0:_0x230183['deleted']);if(!_0x5127a5){this[_0x552859(0x192)]['log']('[INFO]\x20Nothing\x20to\x20commit.\x20Skip.'),await this['sfLogger']['send']();return;}this['commitData']=_0x46b426,await this[_0x552859(0x12f)]();}};CommitComponentsJob=__decorate([typedi_1[a181_0x41760c(0x140)]({'transient':!![]}),__metadata('design:paramtypes',[auth_settings_service_1[a181_0x41760c(0x138)]])],CommitComponentsJob),exports[a181_0x41760c(0x165)]=CommitComponentsJob;