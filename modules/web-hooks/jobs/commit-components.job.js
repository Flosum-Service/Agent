const a180_0x50fc53=a180_0x1a8a;(function(_0x2b29a1,_0x13d441){const _0x362d04=a180_0x1a8a,_0x51cf66=_0x2b29a1();while(!![]){try{const _0x437863=-parseInt(_0x362d04(0x191))/0x1+-parseInt(_0x362d04(0x123))/0x2*(parseInt(_0x362d04(0x141))/0x3)+-parseInt(_0x362d04(0x15c))/0x4*(-parseInt(_0x362d04(0x17c))/0x5)+-parseInt(_0x362d04(0x160))/0x6*(parseInt(_0x362d04(0x157))/0x7)+parseInt(_0x362d04(0x18e))/0x8*(-parseInt(_0x362d04(0x18a))/0x9)+parseInt(_0x362d04(0x17f))/0xa*(parseInt(_0x362d04(0x16d))/0xb)+parseInt(_0x362d04(0x12d))/0xc*(parseInt(_0x362d04(0x15e))/0xd);if(_0x437863===_0x13d441)break;else _0x51cf66['push'](_0x51cf66['shift']());}catch(_0x3ac8f1){_0x51cf66['push'](_0x51cf66['shift']());}}}(a180_0x58a6,0xa854e));const a180_0x213416=(function(){let _0x3ba83b=!![];return function(_0x2cbcd6,_0x55d020){const _0x452b81=_0x3ba83b?function(){if(_0x55d020){const _0x3f6ef5=_0x55d020['apply'](_0x2cbcd6,arguments);return _0x55d020=null,_0x3f6ef5;}}:function(){};return _0x3ba83b=![],_0x452b81;};}()),a180_0x3cc4dd=a180_0x213416(this,function(){const _0x552c5a=a180_0x1a8a;return a180_0x3cc4dd[_0x552c5a(0x175)]()['search']('(((.+)+)+)+$')[_0x552c5a(0x175)]()['constructor'](a180_0x3cc4dd)['search']('(((.+)+)+)+$');});a180_0x3cc4dd();'use strict';var __createBinding=this&&this[a180_0x50fc53(0x16e)]||(Object[a180_0x50fc53(0x181)]?function(_0xb07550,_0x81ad5e,_0x59decb,_0x4d5094){if(_0x4d5094===undefined)_0x4d5094=_0x59decb;Object['defineProperty'](_0xb07550,_0x4d5094,{'enumerable':!![],'get':function(){return _0x81ad5e[_0x59decb];}});}:function(_0x1857b8,_0x27a12c,_0x4aa07b,_0xa5fe5f){if(_0xa5fe5f===undefined)_0xa5fe5f=_0x4aa07b;_0x1857b8[_0xa5fe5f]=_0x27a12c[_0x4aa07b];}),__setModuleDefault=this&&this[a180_0x50fc53(0x122)]||(Object[a180_0x50fc53(0x181)]?function(_0x50eb64,_0x2d7daf){const _0xc62ccb=a180_0x50fc53;Object[_0xc62ccb(0x156)](_0x50eb64,_0xc62ccb(0x174),{'enumerable':!![],'value':_0x2d7daf});}:function(_0x4da306,_0x51bb57){_0x4da306['default']=_0x51bb57;}),__decorate=this&&this[a180_0x50fc53(0x16f)]||function(_0x49e882,_0x39b00a,_0x13e64d,_0x227baf){const _0x156b78=a180_0x50fc53;var _0x4792ba=arguments['length'],_0x15ddf6=_0x4792ba<0x3?_0x39b00a:_0x227baf===null?_0x227baf=Object[_0x156b78(0x148)](_0x39b00a,_0x13e64d):_0x227baf,_0x111e7a;if(typeof Reflect===_0x156b78(0x15a)&&typeof Reflect[_0x156b78(0x13c)]===_0x156b78(0x17a))_0x15ddf6=Reflect['decorate'](_0x49e882,_0x39b00a,_0x13e64d,_0x227baf);else{for(var _0x32e741=_0x49e882[_0x156b78(0x151)]-0x1;_0x32e741>=0x0;_0x32e741--)if(_0x111e7a=_0x49e882[_0x32e741])_0x15ddf6=(_0x4792ba<0x3?_0x111e7a(_0x15ddf6):_0x4792ba>0x3?_0x111e7a(_0x39b00a,_0x13e64d,_0x15ddf6):_0x111e7a(_0x39b00a,_0x13e64d))||_0x15ddf6;}return _0x4792ba>0x3&&_0x15ddf6&&Object[_0x156b78(0x156)](_0x39b00a,_0x13e64d,_0x15ddf6),_0x15ddf6;},__importStar=this&&this[a180_0x50fc53(0x168)]||function(_0x453a9e){const _0x1fe857=a180_0x50fc53;if(_0x453a9e&&_0x453a9e[_0x1fe857(0x150)])return _0x453a9e;var _0x48e4fd={};if(_0x453a9e!=null){for(var _0x30cb88 in _0x453a9e)if(_0x30cb88!=='default'&&Object[_0x1fe857(0x143)][_0x1fe857(0x135)]['call'](_0x453a9e,_0x30cb88))__createBinding(_0x48e4fd,_0x453a9e,_0x30cb88);}return __setModuleDefault(_0x48e4fd,_0x453a9e),_0x48e4fd;},__metadata=this&&this[a180_0x50fc53(0x182)]||function(_0x1a9d28,_0x547e8c){const _0x1f88ff=a180_0x50fc53;if(typeof Reflect==='object'&&typeof Reflect[_0x1f88ff(0x179)]===_0x1f88ff(0x17a))return Reflect[_0x1f88ff(0x179)](_0x1a9d28,_0x547e8c);},__importDefault=this&&this[a180_0x50fc53(0x18c)]||function(_0x557b46){return _0x557b46&&_0x557b46['__esModule']?_0x557b46:{'default':_0x557b46};};Object['defineProperty'](exports,a180_0x50fc53(0x150),{'value':!![]}),exports['CommitComponentsJob']=void 0x0;const auth_settings_service_1=require(a180_0x50fc53(0x193)),commit_components_dto_1=require('../dto/commit-components.dto'),events_1=__importDefault(require(a180_0x50fc53(0x136))),git_utils_1=require(a180_0x50fc53(0x14e)),mdapi_utils_1=require(a180_0x50fc53(0x12f)),sfdx_utils_1=require(a180_0x50fc53(0x129)),typedi_1=__importStar(require(a180_0x50fc53(0x120))),child_types_1=__importDefault(require(a180_0x50fc53(0x17e))),utils_1=require('../../shared/utils'),salesforce_logger_v2_service_1=require(a180_0x50fc53(0x16a)),constants_1=require(a180_0x50fc53(0x14d)),bitbucket_api_service_1=require(a180_0x50fc53(0x124)),sfdx_utils_2=require(a180_0x50fc53(0x121)),fs_internal_1=require(a180_0x50fc53(0x131)),path_1=require(a180_0x50fc53(0x13b));function a180_0x58a6(){const _0x20de28=['CommitComponentsJob','hasOwnProperty','events','[INFO]\x20Preparing\x20to\x20delete\x20components','MDApiUtils','isEmptyDir','writeFlosumComponents','path','decorate','provider','components','isSFDXProject','includes','1314SBGJwa','deleted','prototype','commitData','://','removeComponents','gitUtils','getOwnPropertyDescriptor','mdapiUtils','\x20components','fileType','copyMdapiTo','../../../constants','../utils/git.utils','getAccessToken','__esModule','length','gitUrl','SFDXUtils','reduce','join','defineProperty','7385YKODcj','dir','COMPONENTS_PER_TICK','object','sfdxUtils','12FqyMMv','componentsToWrite','940927IOQkLC','[INFO]\x20Force\x20sync.\x20Skip\x20preparing\x20mdapi\x20from\x20repository.','5898CxdRhO','GitUtils','get','SalesforceLogger2','sfLogger','getRemote','groupComponentsByFileName','prepareMdapi','__importStar','CommitComponentsDto','../../salesforce/services/salesforce-logger-v2.service','cleanUp','writed','902yzbGaH','__createBinding','__decorate','branch','splice','authSettings','copyProjectTo','default','toString','getPrefix','push','log','metadata','function','[INFO]\x20Wrote\x20','802545lgQIRP','name','../../parsers/data/child-types','156080pIeorx','[INFO]\x20Start\x20converting\x20to\x20SFDX','create','__metadata','removeDir','SFDX','catch','ms.\x20Committed\x20components\x20-\x20','componentsToDelete','[INFO]\x20Commit\x20job\x20done.\x20Time\x20spent\x20-\x20','[ERROR]\x20','45tpMYCb','[INFO]\x20Start\x20clonning\x20repository','__importDefault','force','298480wMapWD','startTime','writeComponents','388441TyfmYN','[INFO]\x20Committing\x20and\x20pushing\x20source\x20to\x20git','../../shared/services/auth-settings.service','AuthSettingsService','send','typedi','../../salesforce/utils/sfdx.utils','__setModuleDefault','508ZGJVNJ','../../git-api/services/bitbucket-api.service','BitbucketApiService','type','values','design:paramtypes','../utils/sfdx.utils','now','getProtocol','createProjectFrom','108SfOhNj','run','../utils/mdapi.utils','[INFO]\x20Copying\x20mdapi\x20to\x20git\x20folder','../../internal/fs.internal','exec','[INFO]\x20Nothing\x20to\x20commit.\x20Skip.'];a180_0x58a6=function(){return _0x20de28;};return a180_0x58a6();}let CommitComponentsJob=class CommitComponentsJob extends events_1[a180_0x50fc53(0x174)]{constructor(_0x2247c2){const _0x3e5746=a180_0x50fc53;super(),this[_0x3e5746(0x172)]=_0x2247c2,this[_0x3e5746(0x159)]=0x3e8,this[_0x3e5746(0x15d)]=0x0,this[_0x3e5746(0x187)]=0x0,this[_0x3e5746(0x18f)]=Date[_0x3e5746(0x12a)]();}async[a180_0x50fc53(0x165)](){const _0x35c037=a180_0x50fc53,{repo:_0x2c4dfa}=this['commitData'];let _0x1a760d=this[_0x35c037(0x172)]['getCredentialsFor'](this[_0x35c037(0x144)][_0x35c037(0x13d)]);if(this[_0x35c037(0x144)]['provider']==='bitbucket'){const _0x1dfea0=typedi_1[_0x35c037(0x174)][_0x35c037(0x162)](bitbucket_api_service_1[_0x35c037(0x125)]);await _0x1dfea0['isLoggedIn'](),_0x1a760d+=encodeURIComponent(_0x1dfea0[_0x35c037(0x14f)]());}return _0x2c4dfa[_0x35c037(0x152)]['replace'](/http(s)?\:\/\/(.+@)?/,utils_1[_0x35c037(0x12b)](_0x2c4dfa[_0x35c037(0x152)])+_0x35c037(0x145)+_0x1a760d+'@');}['groupComponentsByFileName'](_0x3ff451){const _0x460f8e=a180_0x50fc53;var _0x1ca42d;_0x3ff451['sort'](_0xf1ba7d=>child_types_1[_0x460f8e(0x174)][_0x460f8e(0x140)](_0xf1ba7d[_0x460f8e(0x14b)])?0x1:-0x1);const _0x423b51={};for(const _0x21bbfd of _0x3ff451){_0x423b51[_0x1ca42d=_0x21bbfd['fileName']]||(_0x423b51[_0x1ca42d]=[]),_0x423b51[_0x21bbfd['fileName']][_0x460f8e(0x177)](_0x21bbfd);}return Object[_0x460f8e(0x127)](_0x423b51)[_0x460f8e(0x154)]((_0x1803b7,_0x45ae5d)=>[..._0x1803b7,..._0x45ae5d],[]);}async[a180_0x50fc53(0x190)](_0x321522){const _0x3a2309=a180_0x50fc53;_0x321522=this[_0x3a2309(0x166)](_0x321522);let _0x5855ec=0x0;while(_0x321522[_0x3a2309(0x151)]){const _0x23b708=_0x321522[_0x3a2309(0x171)](0x0,this[_0x3a2309(0x159)]);await this['mdapiUtils'][_0x3a2309(0x13a)](_0x23b708,{'skipChildErrors':this[_0x3a2309(0x144)][_0x3a2309(0x170)][_0x3a2309(0x17d)]==='master'}),_0x5855ec+=_0x23b708[_0x3a2309(0x151)],this[_0x3a2309(0x164)][_0x3a2309(0x178)](_0x3a2309(0x17b)+_0x5855ec+'/'+this[_0x3a2309(0x15d)]+'\x20components'),await this[_0x3a2309(0x164)][_0x3a2309(0x195)]();}}async[a180_0x50fc53(0x146)](_0x1957ef){const _0xa984bb=a180_0x50fc53;_0x1957ef['sort'](_0x21f118=>child_types_1['default'][_0xa984bb(0x140)](_0x21f118[_0xa984bb(0x126)])?-0x1:0x1);let _0x23d95b=0x0;while(_0x1957ef[_0xa984bb(0x151)]){const _0x30b4ba=_0x1957ef[_0xa984bb(0x171)](0x0,this[_0xa984bb(0x159)]);await this[_0xa984bb(0x149)][_0xa984bb(0x146)](_0x30b4ba),_0x23d95b+=_0x30b4ba[_0xa984bb(0x151)],this[_0xa984bb(0x164)]['log']('[INFO]\x20Deleted\x20'+_0x23d95b+'/'+this[_0xa984bb(0x187)]+_0xa984bb(0x14a)),await this[_0xa984bb(0x164)][_0xa984bb(0x195)]();}}async[a180_0x50fc53(0x16b)](){const _0x253466=a180_0x50fc53;this[_0x253466(0x147)]&&await this[_0x253466(0x147)][_0x253466(0x183)]()[_0x253466(0x185)](()=>void 0x0),this[_0x253466(0x149)]&&await this[_0x253466(0x149)][_0x253466(0x183)]()[_0x253466(0x185)](()=>void 0x0),this[_0x253466(0x15b)]&&await this[_0x253466(0x15b)]['removeDir']()[_0x253466(0x185)](()=>void 0x0);}async[a180_0x50fc53(0x132)](){const _0x3a8681=a180_0x50fc53,{repo:_0xd36ec3,branch:_0x4eb6ee,components:_0x5e780f,convertToSFDX:_0x33d540,message:_0x3bb692,user:_0x8b822e}=this[_0x3a8681(0x144)];this[_0x3a8681(0x149)]=new mdapi_utils_1[(_0x3a8681(0x138))](_0xd36ec3[_0x3a8681(0x17d)],_0x4eb6ee['name']),this[_0x3a8681(0x147)]=new git_utils_1[(_0x3a8681(0x161))](await this[_0x3a8681(0x165)]()),this[_0x3a8681(0x15b)]=new sfdx_utils_1[(_0x3a8681(0x153))](_0xd36ec3[_0x3a8681(0x17d)],_0x4eb6ee[_0x3a8681(0x17d)]);let _0x1a2073=_0x33d540;try{this[_0x3a8681(0x164)][_0x3a8681(0x178)](_0x3a8681(0x18b)),await this[_0x3a8681(0x147)]['clone'](_0x4eb6ee[_0x3a8681(0x17d)],_0xd36ec3[_0x3a8681(0x17d)]);!this['commitData'][_0x3a8681(0x18d)]?(this[_0x3a8681(0x164)]['log']('[INFO]\x20Prepare\x20mdapi\x20files'),await this['mdapiUtils'][_0x3a8681(0x167)](this[_0x3a8681(0x147)]['dir'])):this['sfLogger'][_0x3a8681(0x178)](_0x3a8681(0x15f));_0x5e780f[_0x3a8681(0x16c)]&&(this[_0x3a8681(0x164)][_0x3a8681(0x178)]('[INFO]\x20Preparing\x20to\x20write\x20components'),this[_0x3a8681(0x15d)]=_0x5e780f[_0x3a8681(0x16c)][_0x3a8681(0x151)],await this[_0x3a8681(0x190)](_0x5e780f[_0x3a8681(0x16c)]),await this[_0x3a8681(0x164)][_0x3a8681(0x195)]());_0x5e780f[_0x3a8681(0x142)]&&(this[_0x3a8681(0x164)][_0x3a8681(0x178)](_0x3a8681(0x137)),this[_0x3a8681(0x187)]=_0x5e780f['deleted']['length'],await this[_0x3a8681(0x146)](_0x5e780f[_0x3a8681(0x142)]),await this[_0x3a8681(0x164)][_0x3a8681(0x195)]());await this[_0x3a8681(0x164)][_0x3a8681(0x195)]();await sfdx_utils_2[_0x3a8681(0x184)][_0x3a8681(0x13f)](this['gitUtils'][_0x3a8681(0x158)])?(_0x1a2073=!![],await fs_internal_1['FS'][_0x3a8681(0x183)](path_1[_0x3a8681(0x155)](this[_0x3a8681(0x147)]['dir'],'force-app'))):(_0x1a2073&&(!await fs_internal_1['FS'][_0x3a8681(0x139)](this[_0x3a8681(0x147)][_0x3a8681(0x158)])&&(_0x1a2073=![])),await this['gitUtils']['clearDir']());_0x1a2073?(this[_0x3a8681(0x164)]['log'](_0x3a8681(0x180)),await this[_0x3a8681(0x15b)][_0x3a8681(0x12c)](this[_0x3a8681(0x149)]['dir']),await this[_0x3a8681(0x15b)][_0x3a8681(0x173)](this[_0x3a8681(0x147)][_0x3a8681(0x158)]),await this[_0x3a8681(0x15b)][_0x3a8681(0x183)](),await this[_0x3a8681(0x164)][_0x3a8681(0x195)]()):(this[_0x3a8681(0x164)][_0x3a8681(0x178)](_0x3a8681(0x130)),await this[_0x3a8681(0x149)][_0x3a8681(0x14c)](this[_0x3a8681(0x147)]['dir']),await this[_0x3a8681(0x164)]['send']());this[_0x3a8681(0x164)][_0x3a8681(0x178)](_0x3a8681(0x192)),await this['gitUtils']['commitAndPush'](_0x3bb692,{'email':constants_1['DEFAULT_GIT_USER_EMAIL'],'name':_0x8b822e[_0x3a8681(0x17d)]},_0x4eb6ee['name']),await this[_0x3a8681(0x147)][_0x3a8681(0x183)](),await this['mdapiUtils'][_0x3a8681(0x183)]();const _0x331173=this[_0x3a8681(0x15d)]+this[_0x3a8681(0x187)];this[_0x3a8681(0x164)]['log'](_0x3a8681(0x188)+(Date[_0x3a8681(0x12a)]()-this[_0x3a8681(0x18f)])+_0x3a8681(0x186)+_0x331173),await this[_0x3a8681(0x164)][_0x3a8681(0x195)]();}catch(_0x1d9679){await this[_0x3a8681(0x16b)](),this[_0x3a8681(0x164)][_0x3a8681(0x178)](_0x3a8681(0x189)+_0x1d9679),await this[_0x3a8681(0x164)][_0x3a8681(0x195)]();throw _0x1d9679;}}async[a180_0x50fc53(0x12e)](_0x5da8d2,_0x1b8bb6){const _0x2f889c=a180_0x50fc53;var _0x798945,_0x25f956;this['sfLogger']=new salesforce_logger_v2_service_1[(_0x2f889c(0x163))](_0x1b8bb6['getLoggerId'](),_0x1b8bb6[_0x2f889c(0x176)]()+'\x20['+commit_components_dto_1[_0x2f889c(0x169)]['name']+']');const _0x59b0f4=!!((_0x798945=_0x5da8d2[_0x2f889c(0x13e)])===null||_0x798945===void 0x0?void 0x0:_0x798945[_0x2f889c(0x16c)])||!!((_0x25f956=_0x5da8d2[_0x2f889c(0x13e)])===null||_0x25f956===void 0x0?void 0x0:_0x25f956[_0x2f889c(0x142)]);if(!_0x59b0f4){this['sfLogger'][_0x2f889c(0x178)](_0x2f889c(0x133)),await this['sfLogger'][_0x2f889c(0x195)]();return;}this['commitData']=_0x5da8d2,await this[_0x2f889c(0x132)]();}};function a180_0x1a8a(_0x1aa331,_0x7c9a29){const _0x45feee=a180_0x58a6();return a180_0x1a8a=function(_0x3cc4dd,_0x213416){_0x3cc4dd=_0x3cc4dd-0x120;let _0x58a694=_0x45feee[_0x3cc4dd];return _0x58a694;},a180_0x1a8a(_0x1aa331,_0x7c9a29);}CommitComponentsJob=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a180_0x50fc53(0x128),[auth_settings_service_1[a180_0x50fc53(0x194)]])],CommitComponentsJob),exports[a180_0x50fc53(0x134)]=CommitComponentsJob;