const a180_0x1647ff=a180_0x5bf8;function a180_0x5bf8(_0x2f1c98,_0x5ccbbb){const _0x592573=a180_0x1969();return a180_0x5bf8=function(_0x19215f,_0x16d8d3){_0x19215f=_0x19215f-0x1b5;let _0x196911=_0x592573[_0x19215f];return _0x196911;},a180_0x5bf8(_0x2f1c98,_0x5ccbbb);}function a180_0x1969(){const _0x57e97c=['components','hasOwnProperty','__decorate','fileType','authSettings','default','deleted','copyMdapiTo','SalesforceLogger2','../../git-api/services/bitbucket-api.service','call','../utils/sfdx.utils','[INFO]\x20Nothing\x20to\x20commit.\x20Skip.','getPrefix','__importStar','createProjectFrom','includes','ms.\x20Committed\x20components\x20-\x20','://','2347096uijXrU','../../shared/utils','run','search','length','../utils/git.utils','decorate','push','getOwnPropertyDescriptor','clone','exec','isLoggedIn','constructor','../dto/commit-components.dto','writeComponents','2246280ggQmJg','clearDir','catch','[INFO]\x20Preparing\x20to\x20write\x20components','[INFO]\x20Force\x20sync.\x20Skip\x20preparing\x20mdapi\x20from\x20repository.','20719521vTttcS','__esModule','__metadata','gitUrl','isEmptyDir','metadata','[INFO]\x20Commit\x20job\x20done.\x20Time\x20spent\x20-\x20','../../salesforce/utils/sfdx.utils','CommitComponentsJob','defineProperty','fileName','gitUtils','6lycDfE','reduce','getCredentialsFor','Service','log','GitUtils','[INFO]\x20Copying\x20mdapi\x20to\x20git\x20folder','type','AuthSettingsService','writed','getProtocol','cleanUp','get','SFDX','toString','../../../constants','now','BitbucketApiService','54624yoAeKp','create','[INFO]\x20Deleted\x20','commitData','SFDXUtils','5zDOQwB','dir','sort','design:paramtypes','4252068UZFkSP','getAccessToken','commitAndPush','force','745892MSfTzY','replace','__createBinding','provider','[INFO]\x20Start\x20clonning\x20repository','prototype','object','[ERROR]\x20','values','function','componentsToWrite','2322969FmtPsE','mdapiUtils','(((.+)+)+)+$','bitbucket','name','componentsToDelete','sfdxUtils','groupComponentsByFileName','../../internal/fs.internal','startTime','getRemote','[INFO]\x20Preparing\x20to\x20delete\x20components','\x20components','send','sfLogger','COMPONENTS_PER_TICK','isSFDXProject','removeDir','join','apply','__setModuleDefault','MDApiUtils'];a180_0x1969=function(){return _0x57e97c;};return a180_0x1969();}(function(_0x3cfb0c,_0x1c7aec){const _0x52a211=a180_0x5bf8,_0x495435=_0x3cfb0c();while(!![]){try{const _0x2a4184=-parseInt(_0x52a211(0x1d6))/0x1*(parseInt(_0x52a211(0x1e8))/0x2)+-parseInt(_0x52a211(0x200))/0x3+-parseInt(_0x52a211(0x1b6))/0x4+parseInt(_0x52a211(0x1ed))/0x5*(-parseInt(_0x52a211(0x1f1))/0x6)+parseInt(_0x52a211(0x1f5))/0x7+parseInt(_0x52a211(0x1c5))/0x8+parseInt(_0x52a211(0x1ca))/0x9;if(_0x2a4184===_0x1c7aec)break;else _0x495435['push'](_0x495435['shift']());}catch(_0x1b217a){_0x495435['push'](_0x495435['shift']());}}}(a180_0x1969,0x6f4b7));const a180_0x16d8d3=(function(){let _0x503321=!![];return function(_0x110536,_0x9cdcd9){const _0x71c6d3=_0x503321?function(){const _0x56155b=a180_0x5bf8;if(_0x9cdcd9){const _0x3c3211=_0x9cdcd9[_0x56155b(0x213)](_0x110536,arguments);return _0x9cdcd9=null,_0x3c3211;}}:function(){};return _0x503321=![],_0x71c6d3;};}()),a180_0x19215f=a180_0x16d8d3(this,function(){const _0x4b6d22=a180_0x5bf8;return a180_0x19215f[_0x4b6d22(0x1e4)]()[_0x4b6d22(0x1b9)](_0x4b6d22(0x202))[_0x4b6d22(0x1e4)]()[_0x4b6d22(0x1c2)](a180_0x19215f)[_0x4b6d22(0x1b9)](_0x4b6d22(0x202));});a180_0x19215f();'use strict';var __createBinding=this&&this[a180_0x1647ff(0x1f7)]||(Object[a180_0x1647ff(0x1e9)]?function(_0x34e5c8,_0x4a208a,_0x51e857,_0xc8621a){const _0x2d857d=a180_0x1647ff;if(_0xc8621a===undefined)_0xc8621a=_0x51e857;Object[_0x2d857d(0x1d3)](_0x34e5c8,_0xc8621a,{'enumerable':!![],'get':function(){return _0x4a208a[_0x51e857];}});}:function(_0x1f7c91,_0x56a76b,_0x3a68d4,_0x443c3b){if(_0x443c3b===undefined)_0x443c3b=_0x3a68d4;_0x1f7c91[_0x443c3b]=_0x56a76b[_0x3a68d4];}),__setModuleDefault=this&&this[a180_0x1647ff(0x214)]||(Object[a180_0x1647ff(0x1e9)]?function(_0x133be2,_0x5a1c7b){const _0x1776d5=a180_0x1647ff;Object[_0x1776d5(0x1d3)](_0x133be2,_0x1776d5(0x21b),{'enumerable':!![],'value':_0x5a1c7b});}:function(_0x3c6311,_0x37a7cd){_0x3c6311['default']=_0x37a7cd;}),__decorate=this&&this[a180_0x1647ff(0x218)]||function(_0x5123a4,_0x5ad2d1,_0x3d5494,_0x45aafc){const _0x2da05f=a180_0x1647ff;var _0xc0c9f6=arguments[_0x2da05f(0x1ba)],_0x52886c=_0xc0c9f6<0x3?_0x5ad2d1:_0x45aafc===null?_0x45aafc=Object[_0x2da05f(0x1be)](_0x5ad2d1,_0x3d5494):_0x45aafc,_0x1ab565;if(typeof Reflect===_0x2da05f(0x1fb)&&typeof Reflect[_0x2da05f(0x1bc)]===_0x2da05f(0x1fe))_0x52886c=Reflect[_0x2da05f(0x1bc)](_0x5123a4,_0x5ad2d1,_0x3d5494,_0x45aafc);else{for(var _0x1ab880=_0x5123a4[_0x2da05f(0x1ba)]-0x1;_0x1ab880>=0x0;_0x1ab880--)if(_0x1ab565=_0x5123a4[_0x1ab880])_0x52886c=(_0xc0c9f6<0x3?_0x1ab565(_0x52886c):_0xc0c9f6>0x3?_0x1ab565(_0x5ad2d1,_0x3d5494,_0x52886c):_0x1ab565(_0x5ad2d1,_0x3d5494))||_0x52886c;}return _0xc0c9f6>0x3&&_0x52886c&&Object[_0x2da05f(0x1d3)](_0x5ad2d1,_0x3d5494,_0x52886c),_0x52886c;},__importStar=this&&this[a180_0x1647ff(0x224)]||function(_0x498419){const _0x1b7fc4=a180_0x1647ff;if(_0x498419&&_0x498419[_0x1b7fc4(0x1cb)])return _0x498419;var _0x5ec0e={};if(_0x498419!=null){for(var _0x29c7cd in _0x498419)if(_0x29c7cd!==_0x1b7fc4(0x21b)&&Object[_0x1b7fc4(0x1fa)][_0x1b7fc4(0x217)][_0x1b7fc4(0x220)](_0x498419,_0x29c7cd))__createBinding(_0x5ec0e,_0x498419,_0x29c7cd);}return __setModuleDefault(_0x5ec0e,_0x498419),_0x5ec0e;},__metadata=this&&this[a180_0x1647ff(0x1cc)]||function(_0x3870a8,_0xbe0f90){const _0x2c5513=a180_0x1647ff;if(typeof Reflect===_0x2c5513(0x1fb)&&typeof Reflect[_0x2c5513(0x1cf)]==='function')return Reflect[_0x2c5513(0x1cf)](_0x3870a8,_0xbe0f90);},__importDefault=this&&this['__importDefault']||function(_0x2de8d2){return _0x2de8d2&&_0x2de8d2['__esModule']?_0x2de8d2:{'default':_0x2de8d2};};Object['defineProperty'](exports,a180_0x1647ff(0x1cb),{'value':!![]}),exports[a180_0x1647ff(0x1d2)]=void 0x0;const auth_settings_service_1=require('../../shared/services/auth-settings.service'),commit_components_dto_1=require(a180_0x1647ff(0x1c3)),events_1=__importDefault(require('events')),git_utils_1=require(a180_0x1647ff(0x1bb)),mdapi_utils_1=require('../utils/mdapi.utils'),sfdx_utils_1=require(a180_0x1647ff(0x221)),typedi_1=__importStar(require('typedi')),child_types_1=__importDefault(require('../../parsers/data/child-types')),utils_1=require(a180_0x1647ff(0x1b7)),salesforce_logger_v2_service_1=require('../../salesforce/services/salesforce-logger-v2.service'),constants_1=require(a180_0x1647ff(0x1e5)),bitbucket_api_service_1=require(a180_0x1647ff(0x21f)),sfdx_utils_2=require(a180_0x1647ff(0x1d1)),fs_internal_1=require(a180_0x1647ff(0x208)),path_1=require('path');let CommitComponentsJob=class CommitComponentsJob extends events_1[a180_0x1647ff(0x21b)]{constructor(_0x370065){const _0x2b8608=a180_0x1647ff;super(),this[_0x2b8608(0x21a)]=_0x370065,this[_0x2b8608(0x20f)]=0x3e8,this[_0x2b8608(0x1ff)]=0x0,this['componentsToDelete']=0x0,this[_0x2b8608(0x209)]=Date[_0x2b8608(0x1e6)]();}async[a180_0x1647ff(0x20a)](){const _0x399ba4=a180_0x1647ff,{repo:_0x25097f}=this[_0x399ba4(0x1eb)];let _0x1b5c03=this[_0x399ba4(0x21a)][_0x399ba4(0x1d8)](this[_0x399ba4(0x1eb)]['provider']);if(this['commitData'][_0x399ba4(0x1f8)]===_0x399ba4(0x203)){const _0x470bf3=typedi_1[_0x399ba4(0x21b)][_0x399ba4(0x1e2)](bitbucket_api_service_1[_0x399ba4(0x1e7)]);await _0x470bf3[_0x399ba4(0x1c1)](),_0x1b5c03+=encodeURIComponent(_0x470bf3[_0x399ba4(0x1f2)]());}return _0x25097f[_0x399ba4(0x1cd)][_0x399ba4(0x1f6)](/http(s)?\:\/\/(.+@)?/,utils_1[_0x399ba4(0x1e0)](_0x25097f[_0x399ba4(0x1cd)])+_0x399ba4(0x1b5)+_0x1b5c03+'@');}[a180_0x1647ff(0x207)](_0x1a8b85){const _0x1eef55=a180_0x1647ff;var _0x1f5ce9;_0x1a8b85[_0x1eef55(0x1ef)](_0x459cb7=>child_types_1[_0x1eef55(0x21b)][_0x1eef55(0x226)](_0x459cb7[_0x1eef55(0x219)])?0x1:-0x1);const _0x1f30d8={};for(const _0x3ff0f4 of _0x1a8b85){_0x1f30d8[_0x1f5ce9=_0x3ff0f4[_0x1eef55(0x1d4)]]||(_0x1f30d8[_0x1f5ce9]=[]),_0x1f30d8[_0x3ff0f4[_0x1eef55(0x1d4)]][_0x1eef55(0x1bd)](_0x3ff0f4);}return Object[_0x1eef55(0x1fd)](_0x1f30d8)[_0x1eef55(0x1d7)]((_0x39652f,_0x160018)=>[..._0x39652f,..._0x160018],[]);}async['writeComponents'](_0x29c2ec){const _0x4f3bb5=a180_0x1647ff;_0x29c2ec=this['groupComponentsByFileName'](_0x29c2ec);let _0xf23505=0x0;while(_0x29c2ec[_0x4f3bb5(0x1ba)]){const _0x3532a7=_0x29c2ec['splice'](0x0,this['COMPONENTS_PER_TICK']);await this[_0x4f3bb5(0x201)]['writeFlosumComponents'](_0x3532a7,{'skipChildErrors':this['commitData']['branch'][_0x4f3bb5(0x204)]==='master'}),_0xf23505+=_0x3532a7[_0x4f3bb5(0x1ba)],this[_0x4f3bb5(0x20e)][_0x4f3bb5(0x1da)]('[INFO]\x20Wrote\x20'+_0xf23505+'/'+this[_0x4f3bb5(0x1ff)]+_0x4f3bb5(0x20c)),await this[_0x4f3bb5(0x20e)][_0x4f3bb5(0x20d)]();}}async['removeComponents'](_0xb72f4b){const _0x48e383=a180_0x1647ff;_0xb72f4b['sort'](_0x595b72=>child_types_1[_0x48e383(0x21b)][_0x48e383(0x226)](_0x595b72[_0x48e383(0x1dd)])?-0x1:0x1);let _0x240b24=0x0;while(_0xb72f4b[_0x48e383(0x1ba)]){const _0x4de87e=_0xb72f4b['splice'](0x0,this[_0x48e383(0x20f)]);await this[_0x48e383(0x201)]['removeComponents'](_0x4de87e),_0x240b24+=_0x4de87e['length'],this['sfLogger']['log'](_0x48e383(0x1ea)+_0x240b24+'/'+this[_0x48e383(0x205)]+_0x48e383(0x20c)),await this['sfLogger'][_0x48e383(0x20d)]();}}async[a180_0x1647ff(0x1e1)](){const _0x383b4b=a180_0x1647ff;this[_0x383b4b(0x1d5)]&&await this[_0x383b4b(0x1d5)][_0x383b4b(0x211)]()[_0x383b4b(0x1c7)](()=>void 0x0),this['mdapiUtils']&&await this[_0x383b4b(0x201)][_0x383b4b(0x211)]()[_0x383b4b(0x1c7)](()=>void 0x0),this[_0x383b4b(0x206)]&&await this[_0x383b4b(0x206)][_0x383b4b(0x211)]()[_0x383b4b(0x1c7)](()=>void 0x0);}async[a180_0x1647ff(0x1c0)](){const _0x5e0929=a180_0x1647ff,{repo:_0x29d623,branch:_0x59085b,components:_0x1be772,convertToSFDX:_0x55f3c2,message:_0x21f347,user:_0x3a48a}=this[_0x5e0929(0x1eb)];this[_0x5e0929(0x201)]=new mdapi_utils_1[(_0x5e0929(0x215))](_0x29d623[_0x5e0929(0x204)],_0x59085b[_0x5e0929(0x204)]),this[_0x5e0929(0x1d5)]=new git_utils_1[(_0x5e0929(0x1db))](await this[_0x5e0929(0x20a)]()),this[_0x5e0929(0x206)]=new sfdx_utils_1[(_0x5e0929(0x1ec))](_0x29d623[_0x5e0929(0x204)],_0x59085b[_0x5e0929(0x204)]);let _0x4fba07=_0x55f3c2;try{this['sfLogger']['log'](_0x5e0929(0x1f9)),await this['gitUtils'][_0x5e0929(0x1bf)](_0x59085b[_0x5e0929(0x204)],_0x29d623[_0x5e0929(0x204)]);!this[_0x5e0929(0x1eb)][_0x5e0929(0x1f4)]?(this['sfLogger'][_0x5e0929(0x1da)]('[INFO]\x20Prepare\x20mdapi\x20files'),await this[_0x5e0929(0x201)]['prepareMdapi'](this[_0x5e0929(0x1d5)][_0x5e0929(0x1ee)])):this['sfLogger'][_0x5e0929(0x1da)](_0x5e0929(0x1c9));_0x1be772[_0x5e0929(0x1df)]&&(this['sfLogger'][_0x5e0929(0x1da)](_0x5e0929(0x1c8)),this[_0x5e0929(0x1ff)]=_0x1be772['writed']['length'],await this[_0x5e0929(0x1c4)](_0x1be772[_0x5e0929(0x1df)]),await this['sfLogger']['send']());_0x1be772[_0x5e0929(0x21c)]&&(this[_0x5e0929(0x20e)][_0x5e0929(0x1da)](_0x5e0929(0x20b)),this[_0x5e0929(0x205)]=_0x1be772[_0x5e0929(0x21c)]['length'],await this['removeComponents'](_0x1be772[_0x5e0929(0x21c)]),await this[_0x5e0929(0x20e)][_0x5e0929(0x20d)]());await this[_0x5e0929(0x20e)][_0x5e0929(0x20d)]();await sfdx_utils_2[_0x5e0929(0x1e3)][_0x5e0929(0x210)](this[_0x5e0929(0x1d5)]['dir'])?(_0x4fba07=!![],await fs_internal_1['FS'][_0x5e0929(0x211)](path_1[_0x5e0929(0x212)](this[_0x5e0929(0x1d5)][_0x5e0929(0x1ee)],'force-app'))):(_0x4fba07&&(!await fs_internal_1['FS'][_0x5e0929(0x1ce)](this[_0x5e0929(0x1d5)][_0x5e0929(0x1ee)])&&(_0x4fba07=![])),await this['gitUtils'][_0x5e0929(0x1c6)]());_0x4fba07?(this[_0x5e0929(0x20e)]['log']('[INFO]\x20Start\x20converting\x20to\x20SFDX'),await this['sfdxUtils'][_0x5e0929(0x225)](this['mdapiUtils']['dir']),await this[_0x5e0929(0x206)]['copyProjectTo'](this[_0x5e0929(0x1d5)][_0x5e0929(0x1ee)]),await this[_0x5e0929(0x206)][_0x5e0929(0x211)](),await this['sfLogger'][_0x5e0929(0x20d)]()):(this['sfLogger'][_0x5e0929(0x1da)](_0x5e0929(0x1dc)),await this[_0x5e0929(0x201)][_0x5e0929(0x21d)](this[_0x5e0929(0x1d5)][_0x5e0929(0x1ee)]),await this[_0x5e0929(0x20e)][_0x5e0929(0x20d)]());this['sfLogger'][_0x5e0929(0x1da)]('[INFO]\x20Committing\x20and\x20pushing\x20source\x20to\x20git'),await this['gitUtils'][_0x5e0929(0x1f3)](_0x21f347,{'email':constants_1['DEFAULT_GIT_USER_EMAIL'],'name':_0x3a48a[_0x5e0929(0x204)]},_0x59085b[_0x5e0929(0x204)]),await this['gitUtils']['removeDir'](),await this['mdapiUtils'][_0x5e0929(0x211)]();const _0x262226=this[_0x5e0929(0x1ff)]+this['componentsToDelete'];this['sfLogger'][_0x5e0929(0x1da)](_0x5e0929(0x1d0)+(Date[_0x5e0929(0x1e6)]()-this[_0x5e0929(0x209)])+_0x5e0929(0x227)+_0x262226),await this['sfLogger']['send']();}catch(_0x3ed7f6){await this['cleanUp'](),this['sfLogger']['log'](_0x5e0929(0x1fc)+_0x3ed7f6),await this[_0x5e0929(0x20e)]['send']();throw _0x3ed7f6;}}async[a180_0x1647ff(0x1b8)](_0x87a04c,_0x51012e){const _0x206adc=a180_0x1647ff;var _0x206f5b,_0x3f9c0e;this[_0x206adc(0x20e)]=new salesforce_logger_v2_service_1[(_0x206adc(0x21e))](_0x51012e['getLoggerId'](),_0x51012e[_0x206adc(0x223)]()+'\x20['+commit_components_dto_1['CommitComponentsDto'][_0x206adc(0x204)]+']');const _0x4fb320=!!((_0x206f5b=_0x87a04c['components'])===null||_0x206f5b===void 0x0?void 0x0:_0x206f5b[_0x206adc(0x1df)])||!!((_0x3f9c0e=_0x87a04c[_0x206adc(0x216)])===null||_0x3f9c0e===void 0x0?void 0x0:_0x3f9c0e[_0x206adc(0x21c)]);if(!_0x4fb320){this['sfLogger'][_0x206adc(0x1da)](_0x206adc(0x222)),await this['sfLogger'][_0x206adc(0x20d)]();return;}this['commitData']=_0x87a04c,await this['exec']();}};CommitComponentsJob=__decorate([typedi_1[a180_0x1647ff(0x1d9)]({'transient':!![]}),__metadata(a180_0x1647ff(0x1f0),[auth_settings_service_1[a180_0x1647ff(0x1de)]])],CommitComponentsJob),exports[a180_0x1647ff(0x1d2)]=CommitComponentsJob;