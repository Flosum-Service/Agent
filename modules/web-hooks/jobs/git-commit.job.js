const a184_0x254d90=a184_0x4cc8;(function(_0x512fc9,_0x1c6865){const _0x38211e=a184_0x4cc8,_0x570332=_0x512fc9();while(!![]){try{const _0x16de8c=parseInt(_0x38211e(0x15d))/0x1+-parseInt(_0x38211e(0x13e))/0x2*(-parseInt(_0x38211e(0x119))/0x3)+parseInt(_0x38211e(0x182))/0x4*(-parseInt(_0x38211e(0x192))/0x5)+parseInt(_0x38211e(0x10f))/0x6*(-parseInt(_0x38211e(0x13f))/0x7)+-parseInt(_0x38211e(0x10a))/0x8+-parseInt(_0x38211e(0x17f))/0x9+parseInt(_0x38211e(0x124))/0xa*(parseInt(_0x38211e(0x162))/0xb);if(_0x16de8c===_0x1c6865)break;else _0x570332['push'](_0x570332['shift']());}catch(_0x582186){_0x570332['push'](_0x570332['shift']());}}}(a184_0x2ff4,0x6defc));const a184_0x58ca96=(function(){let _0x19b19a=!![];return function(_0x50aa1f,_0x2bc09c){const _0x51f8ce=_0x19b19a?function(){const _0x564ac4=a184_0x4cc8;if(_0x2bc09c){const _0x329681=_0x2bc09c[_0x564ac4(0x16f)](_0x50aa1f,arguments);return _0x2bc09c=null,_0x329681;}}:function(){};return _0x19b19a=![],_0x51f8ce;};}()),a184_0x4cde7b=a184_0x58ca96(this,function(){const _0x349cbc=a184_0x4cc8;return a184_0x4cde7b['toString']()['search'](_0x349cbc(0x130))[_0x349cbc(0x114)]()[_0x349cbc(0x110)](a184_0x4cde7b)[_0x349cbc(0xfd)](_0x349cbc(0x130));});a184_0x4cde7b();'use strict';var __createBinding=this&&this[a184_0x254d90(0x113)]||(Object[a184_0x254d90(0x11f)]?function(_0x33e261,_0x4236fd,_0x4cc540,_0x6c331){if(_0x6c331===undefined)_0x6c331=_0x4cc540;Object['defineProperty'](_0x33e261,_0x6c331,{'enumerable':!![],'get':function(){return _0x4236fd[_0x4cc540];}});}:function(_0x57a23c,_0x109192,_0x11915,_0x2f13a2){if(_0x2f13a2===undefined)_0x2f13a2=_0x11915;_0x57a23c[_0x2f13a2]=_0x109192[_0x11915];}),__setModuleDefault=this&&this[a184_0x254d90(0x15b)]||(Object[a184_0x254d90(0x11f)]?function(_0x1d600f,_0x4d7c93){const _0x42011d=a184_0x254d90;Object[_0x42011d(0x14f)](_0x1d600f,_0x42011d(0x117),{'enumerable':!![],'value':_0x4d7c93});}:function(_0xc3c220,_0x2b1f39){const _0x1451b2=a184_0x254d90;_0xc3c220[_0x1451b2(0x117)]=_0x2b1f39;}),__decorate=this&&this[a184_0x254d90(0x185)]||function(_0x191442,_0x2c93e2,_0xbba537,_0x37bf2e){const _0x508f3f=a184_0x254d90;var _0x44244b=arguments[_0x508f3f(0x193)],_0x6d2210=_0x44244b<0x3?_0x2c93e2:_0x37bf2e===null?_0x37bf2e=Object[_0x508f3f(0x174)](_0x2c93e2,_0xbba537):_0x37bf2e,_0x5b8e9f;if(typeof Reflect===_0x508f3f(0x120)&&typeof Reflect[_0x508f3f(0x161)]===_0x508f3f(0x158))_0x6d2210=Reflect[_0x508f3f(0x161)](_0x191442,_0x2c93e2,_0xbba537,_0x37bf2e);else{for(var _0x506bac=_0x191442['length']-0x1;_0x506bac>=0x0;_0x506bac--)if(_0x5b8e9f=_0x191442[_0x506bac])_0x6d2210=(_0x44244b<0x3?_0x5b8e9f(_0x6d2210):_0x44244b>0x3?_0x5b8e9f(_0x2c93e2,_0xbba537,_0x6d2210):_0x5b8e9f(_0x2c93e2,_0xbba537))||_0x6d2210;}return _0x44244b>0x3&&_0x6d2210&&Object[_0x508f3f(0x14f)](_0x2c93e2,_0xbba537,_0x6d2210),_0x6d2210;},__importStar=this&&this[a184_0x254d90(0xff)]||function(_0x38d4bf){const _0x18465f=a184_0x254d90;if(_0x38d4bf&&_0x38d4bf[_0x18465f(0x169)])return _0x38d4bf;var _0x2c2f05={};if(_0x38d4bf!=null){for(var _0x342a65 in _0x38d4bf)if(_0x342a65!==_0x18465f(0x117)&&Object[_0x18465f(0x122)][_0x18465f(0x156)][_0x18465f(0x15e)](_0x38d4bf,_0x342a65))__createBinding(_0x2c2f05,_0x38d4bf,_0x342a65);}return __setModuleDefault(_0x2c2f05,_0x38d4bf),_0x2c2f05;},__metadata=this&&this[a184_0x254d90(0x15f)]||function(_0x5662c8,_0xfb19f6){const _0x168af9=a184_0x254d90;if(typeof Reflect==='object'&&typeof Reflect[_0x168af9(0x12a)]===_0x168af9(0x158))return Reflect['metadata'](_0x5662c8,_0xfb19f6);},GitCommitJob_1;Object[a184_0x254d90(0x14f)](exports,a184_0x254d90(0x169),{'value':!![]}),exports[a184_0x254d90(0x13a)]=void 0x0;const core_1=require('../../../core'),fs_internal_1=require(a184_0x254d90(0x16b)),salesforce_logger_v2_service_1=require(a184_0x254d90(0x153)),auth_settings_service_1=require('../../shared/services/auth-settings.service'),utils_1=require(a184_0x254d90(0x10e)),path_1=require('path'),typedi_1=__importStar(require(a184_0x254d90(0x12e))),constants_1=require('../../../constants'),salesforce_commits_manager_service_1=require('../../salesforce/services/salesforce-commits-manager.service'),git_commit_utils_1=require('../utils/git-commit.utils'),git_utils_1=require(a184_0x254d90(0x131)),mdapi_utils_1=require(a184_0x254d90(0x127)),api_error_1=require('../../../core/errors/api.error'),salesforce_error_1=require(a184_0x254d90(0x10d)),git_commit_service_1=require('../services/git-commit.service'),flosum_commit_error_1=require(a184_0x254d90(0x104)),not_found_error_1=require(a184_0x254d90(0x157)),bitbucket_api_service_1=require(a184_0x254d90(0x167)),sfdx_utils_1=require(a184_0x254d90(0x194));let GitCommitJob=GitCommitJob_1=class GitCommitJob{constructor(_0x5cadf0,_0x11be19){const _0x15642e=a184_0x254d90;this[_0x15642e(0x141)]=_0x5cadf0,this[_0x15642e(0x11e)]=_0x11be19,this['MAX_COMPONENTS_PER_TICK']=+(process[_0x15642e(0x173)][_0x15642e(0x128)]||0xbb8),this[_0x15642e(0x164)]=new core_1['Logger'](GitCommitJob_1[_0x15642e(0x196)]),this['commitId']='';}async['getRemote'](){const _0x1a599=a184_0x254d90,{repositoryGit:_0x3a9b69}=this[_0x1a599(0x13b)];let _0x5eae9b=this[_0x1a599(0x141)][_0x1a599(0x12b)](this[_0x1a599(0x13b)][_0x1a599(0x14c)]);if(this[_0x1a599(0x13b)][_0x1a599(0x14c)]===_0x1a599(0x18d)){const _0x14ec5b=typedi_1['default'][_0x1a599(0x147)](bitbucket_api_service_1['BitbucketApiService']);await _0x14ec5b[_0x1a599(0x165)](),_0x5eae9b+=encodeURIComponent(_0x14ec5b[_0x1a599(0x151)]());}return _0x3a9b69[_0x1a599(0x100)](/http(s)?\:\/\/(.+@)?/,utils_1[_0x1a599(0x112)](_0x3a9b69)+_0x1a599(0x123)+_0x5eae9b+'@');}async[a184_0x254d90(0x142)](){const _0x15d79a=a184_0x254d90;if(this['gitCommitData']['force'])return;const _0x1b242b=[];for(const _0x5694ad of this[_0x15d79a(0x13b)]['commits']){const _0xaf0f8c=await this['gitUtils'][_0x15d79a(0xfc)](_0x5694ad['id']);_0x5694ad[_0x15d79a(0x191)]=_0xaf0f8c[_0x15d79a(0x13c)],_0x5694ad['message']=_0xaf0f8c[_0x15d79a(0x155)],_0x5694ad[_0x15d79a(0xfe)]=_0xaf0f8c['changes'],_0x5694ad[_0x15d79a(0x17e)]=_0xaf0f8c[_0x15d79a(0x17e)];if(_0x5694ad['email']===constants_1[_0x15d79a(0x10b)])throw new flosum_commit_error_1[(_0x15d79a(0x14e))]();_0x1b242b[_0x15d79a(0x12c)](...Object[_0x15d79a(0x111)](_0x5694ad['files'])[_0x15d79a(0x116)]());}this[_0x15d79a(0x13b)][_0x15d79a(0x11d)]=git_commit_utils_1[_0x15d79a(0x17a)]([...new Set(_0x1b242b)]);}async[a184_0x254d90(0x16e)](_0x33e80b,_0x102d6c,_0x31fd8d){const _0xee84bc=a184_0x254d90,_0xa8ed47=_0x31fd8d[_0xee84bc(0x152)]((_0x5afee4,_0x5a906c)=>{const _0x3e579f=_0xee84bc;return _0x5afee4['inserted']['push'](..._0x5a906c[_0x3e579f(0x144)]),_0x5afee4[_0x3e579f(0x170)][_0x3e579f(0x12c)](..._0x5a906c[_0x3e579f(0x170)]),_0x5afee4[_0x3e579f(0x16a)][_0x3e579f(0x12c)](..._0x5a906c['removed']),_0x5afee4;},{'inserted':[],'modified':[],'removed':[]}),_0x56648b=new salesforce_commits_manager_service_1[(_0xee84bc(0x184))]({'recordTypes':this['gitCommit'][_0xee84bc(0x176)](),'branchId':this['gitCommit'][_0xee84bc(0x181)](),'repositoryId':this[_0xee84bc(0x11e)][_0xee84bc(0x178)](),'logger':this[_0xee84bc(0x18c)],'commitId':this['commitId']});await _0x56648b[_0xee84bc(0x190)]([{'author':_0x33e80b,'message':_0x102d6c,'inserted':_0xa8ed47[_0xee84bc(0x144)],'modified':_0xa8ed47['modified'],'removed':_0xa8ed47[_0xee84bc(0x16a)]}]);}async[a184_0x254d90(0x140)](_0x4ecd79,_0x57f836){const _0x3405c7=a184_0x254d90,{added:_0x4e1387,modified:_0x5b6d0f,removed:_0x274003}=_0x4ecd79[_0x3405c7(0xfe)];_0x57f836&&_0x5b6d0f[_0x3405c7(0x12c)](..._0x274003[_0x3405c7(0x125)](0x0));const _0x52e3de=git_commit_utils_1[_0x3405c7(0x17a)]([..._0x4e1387,..._0x5b6d0f,..._0x274003]);let _0x372e96=0x0;const _0xaf6b8e=[];(_0x4e1387[_0x3405c7(0x193)]||_0x5b6d0f[_0x3405c7(0x193)])&&this[_0x3405c7(0x11e)][_0x3405c7(0x178)]()&&(this[_0x3405c7(0x18a)]=await this['gitCommit'][_0x3405c7(0x135)](_0x4ecd79[_0x3405c7(0x155)]));while(_0x52e3de[_0x3405c7(0x193)]){const _0x14a146=_0x52e3de['shift'](),_0x49c765=await this['gitCommit'][_0x3405c7(0x105)](_0x14a146,this[_0x3405c7(0x189)][_0x3405c7(0x195)],_0x57f836);_0x372e96+=_0x49c765[_0x3405c7(0x144)][_0x3405c7(0x193)]+_0x49c765[_0x3405c7(0x16a)]['length']+_0x49c765[_0x3405c7(0x170)]['length'],_0xaf6b8e[_0x3405c7(0x12c)](_0x49c765),_0x372e96>this[_0x3405c7(0x128)]&&(await this[_0x3405c7(0x16e)](_0x4ecd79[_0x3405c7(0x191)],_0x4ecd79[_0x3405c7(0x155)],_0xaf6b8e),_0x372e96=0x0,_0xaf6b8e[_0x3405c7(0x125)](0x0));}_0xaf6b8e[_0x3405c7(0x193)]&&await this[_0x3405c7(0x16e)](_0x4ecd79[_0x3405c7(0x191)],_0x4ecd79[_0x3405c7(0x155)],_0xaf6b8e);}async[a184_0x254d90(0x190)](_0x136b11){const _0x23d072=a184_0x254d90,_0x64dbc3=[...this[_0x23d072(0x13b)]['commits']],_0x53f623=_0x64dbc3[_0x23d072(0x193)];let _0x18dece=0x0;while(_0x64dbc3[_0x23d072(0x193)]){const _0x17c584=_0x64dbc3[_0x23d072(0x188)]();!this[_0x23d072(0x13b)][_0x23d072(0x159)]&&(this[_0x23d072(0x11e)][_0x23d072(0x178)]()?await this['gitUtils']['checkoutTo'](_0x17c584['id']):await this[_0x23d072(0x115)][_0x23d072(0x18b)](this[_0x23d072(0x18e)])),await this[_0x23d072(0x140)](_0x17c584,_0x136b11),_0x18dece+=0x1,await this[_0x23d072(0x18c)][_0x23d072(0x18f)]('[INFO]\x20Proceeded\x20'+_0x18dece+'/'+_0x53f623)['send']();}}async[a184_0x254d90(0x180)](){const _0x57146c=a184_0x254d90;this[_0x57146c(0x115)]&&await this[_0x57146c(0x115)][_0x57146c(0x17b)]()['catch'](()=>void 0x0),this[_0x57146c(0x189)]&&await this[_0x57146c(0x189)][_0x57146c(0x17b)]()[_0x57146c(0x149)](()=>void 0x0);}async[a184_0x254d90(0x15a)](_0x463184,_0x11ac2e){const _0x160023=a184_0x254d90;this[_0x160023(0x13b)]=_0x463184,this[_0x160023(0x11e)][_0x160023(0x186)](this[_0x160023(0x13b)]),this[_0x160023(0x18c)]=new salesforce_logger_v2_service_1['SalesforceLogger2'](_0x11ac2e?_0x11ac2e[_0x160023(0x15c)]():undefined,(_0x11ac2e&&_0x11ac2e['getPrefix']()||_0x160023(0xfb)+_0x463184[_0x160023(0x10c)]+']\x20[Branch:\x20'+_0x463184[_0x160023(0x16c)]+']')+'\x20['+GitCommitJob_1[_0x160023(0x196)]+']'),this[_0x160023(0x115)]=new git_utils_1[(_0x160023(0x121))](await this['getRemote']()),this[_0x160023(0x189)]=new mdapi_utils_1[(_0x160023(0x14a))](this[_0x160023(0x13b)]['repository'],this['gitCommitData'][_0x160023(0x16c)]);try{this['logger'][_0x160023(0x18f)]('fetch\x20repository/branch\x20data'),this[_0x160023(0x18c)]['log']('[INFO]\x20Fetch\x20salesforce\x20data.'),await this[_0x160023(0x11e)][_0x160023(0x183)](),this[_0x160023(0x164)][_0x160023(0x18f)](_0x160023(0x148),this['gitCommitData'][_0x160023(0x136)]),this[_0x160023(0x18c)][_0x160023(0x18f)](_0x160023(0x171)),await this[_0x160023(0x115)][_0x160023(0x118)](this[_0x160023(0x13b)][_0x160023(0x16c)],this[_0x160023(0x13b)][_0x160023(0x10c)]),this[_0x160023(0x164)][_0x160023(0x18f)](_0x160023(0x175)),this['sfLogger'][_0x160023(0x18f)](_0x160023(0x172)),await this[_0x160023(0x142)]();!this[_0x160023(0x18c)][_0x160023(0x15c)]()&&this[_0x160023(0x18c)][_0x160023(0x11a)]((await salesforce_logger_v2_service_1[_0x160023(0x109)][_0x160023(0x154)]())[_0x160023(0x15c)]());await this[_0x160023(0x11e)][_0x160023(0x107)](_0x160023(0x187)),this[_0x160023(0x164)][_0x160023(0x18f)](_0x160023(0x126)),await this['mdapiUtils'][_0x160023(0x143)](this[_0x160023(0x115)][_0x160023(0x195)]);if(_0x463184['force']){this[_0x160023(0x164)]['log'](_0x160023(0x16d));const _0x46a6c4=(await fs_internal_1['FS']['readDir'](this[_0x160023(0x189)][_0x160023(0x195)],!![]))[_0x160023(0x11c)](_0x2f4aa2=>path_1[_0x160023(0x13d)](this[_0x160023(0x189)][_0x160023(0x195)],_0x2f4aa2));this['sfLogger'][_0x160023(0x18f)](_0x160023(0x12f)+_0x46a6c4[_0x160023(0x193)]+_0x160023(0x139)),this[_0x160023(0x13b)][_0x160023(0x11d)]=[],this[_0x160023(0x13b)]['commits']=[{'files':{'modified':_0x46a6c4,'added':[],'removed':[]},'id':await this[_0x160023(0x115)][_0x160023(0x179)](),'message':_0x160023(0x129),'username':constants_1[_0x160023(0x14b)]}];}this[_0x160023(0x18e)]=this[_0x160023(0x13b)][_0x160023(0x138)][this['gitCommitData'][_0x160023(0x138)][_0x160023(0x193)]-0x1]['id'];const _0x3b3e9e=await this[_0x160023(0x11e)][_0x160023(0x134)](this[_0x160023(0x18e)]);if(_0x3b3e9e){await this['sfLogger'][_0x160023(0x18f)](_0x160023(0x168))[_0x160023(0x166)](),await this[_0x160023(0x11e)][_0x160023(0x107)]('Completed');return;}const _0x26ddc9=await sfdx_utils_1['SFDX'][_0x160023(0x11b)](this[_0x160023(0x115)][_0x160023(0x195)]);this['logger'][_0x160023(0x18f)](_0x160023(0x177)),await this['sfLogger']['log']('[INFO]\x20Download\x20components\x20metadata\x20from\x20flosum.'),await this[_0x160023(0x11e)][_0x160023(0x103)](_0x26ddc9),await this['gitCommit']['updateRemoteState']({[this[_0x160023(0x13b)][_0x160023(0x136)]]:{'lastCommit':this['lastCommitHash']}}),this[_0x160023(0x164)][_0x160023(0x18f)](_0x160023(0x12d)),this[_0x160023(0x18c)][_0x160023(0x18f)](_0x160023(0x101)+(_0x26ddc9?_0x160023(0x145):'NO')+_0x160023(0x132)),await this['proceedCommits'](_0x26ddc9),this[_0x160023(0x164)]['log'](_0x160023(0x150)),await this['sfLogger'][_0x160023(0x18f)](_0x160023(0x106)),await this['gitCommit']['updateStatus'](_0x160023(0x160));}catch(_0x38cb40){await this['cleanUp'](),this[_0x160023(0x164)]['error'](_0x38cb40);if(_0x38cb40 instanceof not_found_error_1[_0x160023(0x17d)]){await this[_0x160023(0x18c)][_0x160023(0x14d)]();return;}if(_0x38cb40 instanceof flosum_commit_error_1[_0x160023(0x14e)]){await this[_0x160023(0x18c)][_0x160023(0x14d)]();return;}this[_0x160023(0x18c)][_0x160023(0x18f)](_0x160023(0x108)+(_0x38cb40 instanceof api_error_1[_0x160023(0x163)]||_0x38cb40 instanceof salesforce_error_1[_0x160023(0x146)]?_0x38cb40[_0x160023(0x114)]():_0x38cb40)),await this[_0x160023(0x11e)][_0x160023(0x102)]({}),await this['gitCommit'][_0x160023(0x107)]('Error')['catch'](()=>void 0x0);throw _0x38cb40;}finally{await this[_0x160023(0x180)](),await this[_0x160023(0x18c)][_0x160023(0x166)]()[_0x160023(0x149)](()=>void 0x0);}}};function a184_0x4cc8(_0xdce2e8,_0x4cb476){const _0x1388e0=a184_0x2ff4();return a184_0x4cc8=function(_0x4cde7b,_0x58ca96){_0x4cde7b=_0x4cde7b-0xfb;let _0x2ff48e=_0x1388e0[_0x4cde7b];return _0x2ff48e;},a184_0x4cc8(_0xdce2e8,_0x4cb476);}GitCommitJob=GitCommitJob_1=__decorate([typedi_1[a184_0x254d90(0x17c)]({'transient':!![]}),__metadata(a184_0x254d90(0x133),[auth_settings_service_1['AuthSettingsService'],git_commit_service_1[a184_0x254d90(0x137)]])],GitCommitJob),exports[a184_0x254d90(0x13a)]=GitCommitJob;function a184_0x2ff4(){const _0x4c7e15=['GitCommitJob','gitCommitData','author','relative','312788bLgpVl','1495795lKKGcQ','handleCommit','authSettings','fetchCommits','prepareMdapi','inserted','YES','SalesforceError','get','clone\x20repository\x20from\x20%s','catch','MDApiUtils','DEFAULT_GIT_USER_NAME','provider','removeLogger','FlosumCommitError','defineProperty','git\x20commit\x20job\x20done\x20(´･ω･`)','getAccessToken','reduce','../../salesforce/services/salesforce-logger-v2.service','createLogger','message','hasOwnProperty','../../salesforce/errors/not-found.error','function','force','run','__setModuleDefault','getLoggerId','494890MvHBcA','call','__metadata','Completed','decorate','33ckUSPa','ApiError','logger','isLoggedIn','send','../../git-api/services/bitbucket-api.service','[INFO]\x20Branch\x20synchronized.\x20Skip','__esModule','removed','../../internal/fs.internal','branch','start\x20force\x20commit\x20job\x20to\x20sync\x20repository','sendComponents','apply','modified','[INFO]\x20Clone\x20git\x20repository.','[INFO]\x20Fetch\x20changes\x20files\x20from\x20git\x20commits.','env','getOwnPropertyDescriptor','fetching\x20git\x20commits','getRecordTypes','fetch\x20components\x20metadata','getRepositoryId','getCurrentHash','prepareGitChangedPaths','removeDir','Service','SalesforceNotFoundError','email','620748kCJvwM','cleanUp','getBranchId','78956yijhUw','fetchRepositoryOrBranchData','SalesforceCommitsManager','__decorate','setCommitDto','In\x20Progress','shift','mdapiUtils','commitId','checkoutTo','sfLogger','bitbucket','lastCommitHash','log','proceedCommits','username','40ThFyIv','length','../../salesforce/utils/sfdx.utils','dir','name','[GIT\x20->\x20FLOSUM]\x20[Repository:\x20','describeCommit','search','files','__importStar','replace','[INFO]\x20[SFDX:\x20','updateRemoteState','fetchComponentsMetadata','../errors/flosum-commit.error','proceedFile','[INFO]\x20Job\x20done.','updateStatus','[ERROR]\x20Error\x20has\x20occurred\x20when\x20commit\x20from\x20git\x20to\x20flosum\x20-\x20','SalesforceLogger2','2925352pTheat','DEFAULT_GIT_USER_EMAIL','repository','../../salesforce/errors/salesforce.error','../../shared/utils','12zepLXG','constructor','values','getProtocol','__createBinding','toString','gitUtils','flat','default','clone','9gMHVir','setLoggerId','isSFDXProject','map','fileNames','gitCommit','create','object','GitUtils','prototype','://','1687170JYUpWI','splice','prepare\x20mdapi\x20to\x20parse','../utils/mdapi.utils','MAX_COMPONENTS_PER_TICK','sync\x20components','metadata','getCredentialsFor','push','proceed\x20git\x20commits\x20to\x20flosum','typedi','[INFO]\x20Force\x20commit.\x20Have\x20to\x20parse\x20','(((.+)+)+)+$','../utils/git.utils',']\x20Start\x20proceeding\x20git\x20commits.\x20','design:paramtypes','checkSyncStatus','createCommit','repositoryGit','GitCommitService','commits','\x20before\x20sync.'];a184_0x2ff4=function(){return _0x4c7e15;};return a184_0x2ff4();}