const a182_0x2eaf47=a182_0x2eba;(function(_0x4341b1,_0x103f05){const _0x51adad=a182_0x2eba,_0x14dc1e=_0x4341b1();while(!![]){try{const _0x16d8f2=-parseInt(_0x51adad(0x111))/0x1+-parseInt(_0x51adad(0x109))/0x2*(parseInt(_0x51adad(0xf0))/0x3)+parseInt(_0x51adad(0xcb))/0x4*(parseInt(_0x51adad(0xf3))/0x5)+-parseInt(_0x51adad(0xd1))/0x6*(parseInt(_0x51adad(0x105))/0x7)+-parseInt(_0x51adad(0xdc))/0x8*(-parseInt(_0x51adad(0xd7))/0x9)+-parseInt(_0x51adad(0xd5))/0xa+parseInt(_0x51adad(0xed))/0xb;if(_0x16d8f2===_0x103f05)break;else _0x14dc1e['push'](_0x14dc1e['shift']());}catch(_0xb9aa3e){_0x14dc1e['push'](_0x14dc1e['shift']());}}}(a182_0x5d14,0x2ab2f));const a182_0x3d2738=(function(){let _0x314bbd=!![];return function(_0x54ac86,_0xff201e){const _0x54c01e=_0x314bbd?function(){const _0x32aa79=a182_0x2eba;if(_0xff201e){const _0x28261b=_0xff201e[_0x32aa79(0x106)](_0x54ac86,arguments);return _0xff201e=null,_0x28261b;}}:function(){};return _0x314bbd=![],_0x54c01e;};}()),a182_0x1dce5c=a182_0x3d2738(this,function(){const _0x90f447=a182_0x2eba;return a182_0x1dce5c[_0x90f447(0xe5)]()[_0x90f447(0x101)]('(((.+)+)+)+$')['toString']()[_0x90f447(0xc5)](a182_0x1dce5c)['search'](_0x90f447(0xea));});a182_0x1dce5c();'use strict';var __decorate=this&&this['__decorate']||function(_0x191874,_0xe453c4,_0x234fcb,_0x91a076){const _0x465017=a182_0x2eba;var _0x382b42=arguments[_0x465017(0x100)],_0x2ee79f=_0x382b42<0x3?_0xe453c4:_0x91a076===null?_0x91a076=Object[_0x465017(0x102)](_0xe453c4,_0x234fcb):_0x91a076,_0x35168b;if(typeof Reflect===_0x465017(0xb1)&&typeof Reflect[_0x465017(0x10e)]===_0x465017(0x10b))_0x2ee79f=Reflect[_0x465017(0x10e)](_0x191874,_0xe453c4,_0x234fcb,_0x91a076);else{for(var _0x3e0d5b=_0x191874[_0x465017(0x100)]-0x1;_0x3e0d5b>=0x0;_0x3e0d5b--)if(_0x35168b=_0x191874[_0x3e0d5b])_0x2ee79f=(_0x382b42<0x3?_0x35168b(_0x2ee79f):_0x382b42>0x3?_0x35168b(_0xe453c4,_0x234fcb,_0x2ee79f):_0x35168b(_0xe453c4,_0x234fcb))||_0x2ee79f;}return _0x382b42>0x3&&_0x2ee79f&&Object[_0x465017(0xf4)](_0xe453c4,_0x234fcb,_0x2ee79f),_0x2ee79f;},__metadata=this&&this[a182_0x2eaf47(0xe4)]||function(_0x2b5842,_0x156992){const _0x3c11db=a182_0x2eaf47;if(typeof Reflect==='object'&&typeof Reflect[_0x3c11db(0xc2)]===_0x3c11db(0x10b))return Reflect[_0x3c11db(0xc2)](_0x2b5842,_0x156992);},__importDefault=this&&this[a182_0x2eaf47(0x10d)]||function(_0x37410c){const _0x2198b0=a182_0x2eaf47;return _0x37410c&&_0x37410c[_0x2198b0(0xdd)]?_0x37410c:{'default':_0x37410c};},FlosumCommitJob_1;function a182_0x5d14(){const _0x165294=['patchObject','sfLogger','1818livBkJ','send','SalesforceSyncService','GitProviderManager','2316460fimHYr','exec','425079OYFsRC','repositoryData','deleteAttachment','../../../core','split','24fNtbFo','__esModule','./commit-components.job','../dto/commit-components.dto','gitManager','sha','commitJob','../../salesforce/services/salesforce-logger-v2.service','__metadata','toString','branch','all','../../salesforce/services/salesforce-retriever.service','../../../constants/errors','(((.+)+)+)+$','syncBranchId','fetchRepositoryData','9097231SdwnsV','run','retrieveAttachment','3dVtBHQ','components','BadRequestError','35BugNap','defineProperty','trim','provider','handleCommitJobError',']\x20[Repository:\x20','getComponentsToWrite','../../salesforce/services/salesforce.service','SalesforceLogger2','logger','commitAttachmentId','error','updateLastCommit','length','search','getOwnPropertyDescriptor','toUpperCase','message','5789WAwkpC','apply','repositoryName','getRepoService','397018DvKlmo','syncRepositoryId','function','convertToSFDX','__importDefault','decorate','name','getOne','314900paoXgs','updateRemoteState','Logger','setStatus','object','default','deleteAttachmentId','[FLOSUM\x20->\x20GIT]\x20[',']\x20[Branch:\x20','getPrefix','repoService','salesforceSync','Service','commitData','FlosumCommitJob','[INFO]\x20Start\x20commit\x20job','salesforceService','shortid','ERR_UNKNOWN_SYNC_RECORD_ID','repository','then','metadata','log','getComponentsToDelete','constructor','user','repo','gitUrl','getLoggerId','branches','115324gHURki','[ERROR]\x20','../../salesforce/services/salesforce-sync.service','../../shared/git-provider.manager'];a182_0x5d14=function(){return _0x165294;};return a182_0x5d14();}Object[a182_0x2eaf47(0xf4)](exports,'__esModule',{'value':!![]}),exports['FlosumCommitJob']=void 0x0;function a182_0x2eba(_0x2e4a51,_0x1df00a){const _0xcaf05c=a182_0x5d14();return a182_0x2eba=function(_0x1dce5c,_0x3d2738){_0x1dce5c=_0x1dce5c-0xae;let _0x5d1409=_0xcaf05c[_0x1dce5c];return _0x5d1409;},a182_0x2eba(_0x2e4a51,_0x1df00a);}const core_1=require(a182_0x2eaf47(0xda)),salesforce_logger_v2_service_1=require(a182_0x2eaf47(0xe3)),salesforce_service_1=require(a182_0x2eaf47(0xfa)),git_provider_manager_1=require(a182_0x2eaf47(0xce)),typedi_1=require('typedi'),errors_1=require(a182_0x2eaf47(0xe9)),bad_request_error_1=require('../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a182_0x2eaf47(0xe8)),salesforce_sync_service_1=require(a182_0x2eaf47(0xcd)),commit_components_dto_1=require(a182_0x2eaf47(0xdf)),commit_components_job_1=require(a182_0x2eaf47(0xde)),constants_1=require('../../../constants'),shortid_1=__importDefault(require(a182_0x2eaf47(0xbe)));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x4f5bf9,_0x49df77,_0x5ba1a2,_0x4bbab6){const _0x1c196c=a182_0x2eaf47;this[_0x1c196c(0xbd)]=_0x4f5bf9,this[_0x1c196c(0xe2)]=_0x49df77,this[_0x1c196c(0xb8)]=_0x5ba1a2,this[_0x1c196c(0xe0)]=_0x4bbab6,this['repoService']=this[_0x1c196c(0xe0)][_0x1c196c(0x108)](),this['logger']=new core_1[(_0x1c196c(0xaf))](FlosumCommitJob_1[_0x1c196c(0x10f)]);}async[a182_0x2eaf47(0xec)](){const _0x3b726a=a182_0x2eaf47;try{if(this[_0x3b726a(0xba)]['syncRepositoryId'])this[_0x3b726a(0xd8)]=await this[_0x3b726a(0xb8)]['getRepositoryRecord'](this['commitData'][_0x3b726a(0x10a)]);else this[_0x3b726a(0xba)][_0x3b726a(0xeb)]&&(this[_0x3b726a(0xd8)]=await this[_0x3b726a(0xb8)]['getBranchRecord'](this[_0x3b726a(0xba)][_0x3b726a(0xeb)]));}catch(_0xde5353){throw new bad_request_error_1[(_0x3b726a(0xf2))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a182_0x2eaf47(0xf9)](){const _0x4894c7=a182_0x2eaf47;if(!this[_0x4894c7(0xba)]['commitAttachmentId'])return[];await this[_0x4894c7(0xbd)][_0x4894c7(0xcf)](constants_1['FLOSUM_ATTACHMENT'],this[_0x4894c7(0xba)][_0x4894c7(0xfd)],{'Name':shortid_1['default']()});const _0x162c1e=await this[_0x4894c7(0xbd)][_0x4894c7(0xef)](this['commitData'][_0x4894c7(0xfd)])[_0x4894c7(0xc1)](_0x262109=>_0x262109[_0x4894c7(0xdb)]('\x20')['map'](_0x369a8e=>_0x369a8e[_0x4894c7(0xf5)]()));await this[_0x4894c7(0xbd)][_0x4894c7(0xd9)](this[_0x4894c7(0xba)][_0x4894c7(0xfd)]);const _0x1246e5=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x4894c7(0xbd)]);return await _0x1246e5[_0x4894c7(0xee)](_0x162c1e);}async[a182_0x2eaf47(0xc4)](){const _0x26a317=a182_0x2eaf47;if(!this[_0x26a317(0xba)][_0x26a317(0xb3)])return[];await this['salesforceService']['patchObject'](constants_1['FLOSUM_ATTACHMENT'],this['commitData'][_0x26a317(0xb3)],{'Name':shortid_1[_0x26a317(0xb2)]()});const _0x48b983=await this[_0x26a317(0xbd)]['retrieveAttachment'](this[_0x26a317(0xba)]['deleteAttachmentId']);return await this[_0x26a317(0xbd)][_0x26a317(0xd9)](this[_0x26a317(0xba)][_0x26a317(0xb3)]),_0x48b983;}async['getCommitDto'](){const _0x262d83=a182_0x2eaf47,_0x3bd016=new commit_components_dto_1['CommitComponentsDto'](),[_0x7807bd,_0x375dee]=await Promise[_0x262d83(0xe7)]([this[_0x262d83(0xf9)](),this['getComponentsToDelete']()]);return _0x3bd016[_0x262d83(0x104)]=this[_0x262d83(0xba)][_0x262d83(0x104)],_0x3bd016[_0x262d83(0xc6)]=this[_0x262d83(0xba)][_0x262d83(0xc6)],_0x3bd016[_0x262d83(0xf1)]={'writed':_0x7807bd,'deleted':_0x375dee},_0x3bd016['convertToSFDX']=this[_0x262d83(0xba)][_0x262d83(0x10c)],_0x3bd016[_0x262d83(0xc7)]=this['repository'],_0x3bd016[_0x262d83(0xe6)]=this[_0x262d83(0xe6)],_0x3bd016['provider']=this[_0x262d83(0xf6)],_0x3bd016;}async[a182_0x2eaf47(0xff)](_0x2d2643=![]){const _0x3102f9=a182_0x2eaf47;if(_0x2d2643)await this[_0x3102f9(0xb8)][_0x3102f9(0xae)](this[_0x3102f9(0xd8)],{});else{const _0x1f8ff0=await this[_0x3102f9(0xc0)][_0x3102f9(0xca)][_0x3102f9(0x110)](this[_0x3102f9(0xe6)]['name']);this[_0x3102f9(0xd0)][_0x3102f9(0xc3)]('[INFO]\x20Update\x20remote\x20state.');const _0x5e21ea={[this[_0x3102f9(0xc0)][_0x3102f9(0xc8)]]:{'lastCommit':_0x1f8ff0[_0x3102f9(0xe1)]}};await this['salesforceSync'][_0x3102f9(0xae)](this['repositoryData'],_0x5e21ea);}}async[a182_0x2eaf47(0xd6)](){const _0x4af3a1=a182_0x2eaf47,_0x32ff8f=await this['getCommitDto']();await this['salesforceSync']['setStatus'](this[_0x4af3a1(0xd8)],'In\x20Progress'),await this[_0x4af3a1(0xe2)][_0x4af3a1(0xee)](_0x32ff8f,this[_0x4af3a1(0xd0)]),await this[_0x4af3a1(0xff)](),await this[_0x4af3a1(0xb8)]['setStatus'](this[_0x4af3a1(0xd8)],'Completed');}async[a182_0x2eaf47(0xf7)](_0x3c968f){const _0x4030fd=a182_0x2eaf47;try{this[_0x4030fd(0xd0)]['log'](_0x4030fd(0xcc)+_0x3c968f),await this[_0x4030fd(0xd0)]['send'](),await this[_0x4030fd(0xff)](!![]),await this['salesforceSync'][_0x4030fd(0xb0)](this['repositoryData'],'Error');}catch(_0x5d844b){this[_0x4030fd(0xfc)][_0x4030fd(0xfe)](_0x5d844b);}}async[a182_0x2eaf47(0xee)](_0x7ad942,_0x14a3f2,_0x4d1b5c){const _0x174a51=a182_0x2eaf47;try{this[_0x174a51(0xba)]=_0x7ad942,this['provider']=_0x4d1b5c,await this['fetchRepositoryData'](),this[_0x174a51(0xc0)]=await this[_0x174a51(0xb7)][_0x174a51(0x110)](this[_0x174a51(0xd8)][_0x174a51(0x107)]),this['branch']=await this[_0x174a51(0xc0)][_0x174a51(0xca)][_0x174a51(0x110)](this['repositoryData']['branchName']),this[_0x174a51(0xd0)]=new salesforce_logger_v2_service_1[(_0x174a51(0xfb))](_0x14a3f2[_0x174a51(0xc9)](),(_0x14a3f2[_0x174a51(0xb6)]()||_0x174a51(0xb4)+_0x4d1b5c[_0x174a51(0x103)]()+_0x174a51(0xf8)+this[_0x174a51(0xd8)][_0x174a51(0x107)]+_0x174a51(0xb5)+this[_0x174a51(0xd8)]['branchName']+']')+'\x20['+FlosumCommitJob_1[_0x174a51(0x10f)]+']');if(!this['repositoryData'])throw new bad_request_error_1[(_0x174a51(0xf2))](errors_1[_0x174a51(0xbf)]);await this[_0x174a51(0xd0)][_0x174a51(0xc3)](_0x174a51(0xbc))[_0x174a51(0xd2)](),await this[_0x174a51(0xd6)]()['catch'](_0x55bf2c=>this['handleCommitJobError'](_0x55bf2c));}catch(_0xe8ba00){this['commitData']=undefined,this['logger'][_0x174a51(0xfe)](_0xe8ba00);throw _0xe8ba00;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1[a182_0x2eaf47(0xb9)]({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1['SalesforceService'],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a182_0x2eaf47(0xd3)],git_provider_manager_1[a182_0x2eaf47(0xd4)]])],FlosumCommitJob),exports[a182_0x2eaf47(0xbb)]=FlosumCommitJob;