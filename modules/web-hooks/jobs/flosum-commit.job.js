const a181_0x4e03fb=a181_0x4636;(function(_0x17ed02,_0x2054ae){const _0x305655=a181_0x4636,_0x30ef39=_0x17ed02();while(!![]){try{const _0x27d293=-parseInt(_0x305655(0x160))/0x1+parseInt(_0x305655(0x136))/0x2*(parseInt(_0x305655(0x118))/0x3)+-parseInt(_0x305655(0x138))/0x4*(-parseInt(_0x305655(0x120))/0x5)+-parseInt(_0x305655(0x110))/0x6*(parseInt(_0x305655(0x12c))/0x7)+-parseInt(_0x305655(0x14c))/0x8+-parseInt(_0x305655(0x135))/0x9*(parseInt(_0x305655(0x130))/0xa)+parseInt(_0x305655(0x133))/0xb;if(_0x27d293===_0x2054ae)break;else _0x30ef39['push'](_0x30ef39['shift']());}catch(_0xda45c3){_0x30ef39['push'](_0x30ef39['shift']());}}}(a181_0x2b67,0xeed3a));const a181_0x5270ac=(function(){let _0x19c9d2=!![];return function(_0x35126c,_0x31918e){const _0x453e04=_0x19c9d2?function(){const _0x4c96b6=a181_0x4636;if(_0x31918e){const _0x2fa98f=_0x31918e[_0x4c96b6(0x158)](_0x35126c,arguments);return _0x31918e=null,_0x2fa98f;}}:function(){};return _0x19c9d2=![],_0x453e04;};}()),a181_0x5e4162=a181_0x5270ac(this,function(){const _0x558ee6=a181_0x4636;return a181_0x5e4162['toString']()[_0x558ee6(0x152)]('(((.+)+)+)+$')[_0x558ee6(0x142)]()[_0x558ee6(0x124)](a181_0x5e4162)['search']('(((.+)+)+)+$');});a181_0x5e4162();'use strict';var __decorate=this&&this[a181_0x4e03fb(0x163)]||function(_0x2a8fbe,_0x34efa3,_0x1ce057,_0x3fcc2f){const _0x2343e5=a181_0x4e03fb;var _0x2e960f=arguments[_0x2343e5(0x11c)],_0x4050b3=_0x2e960f<0x3?_0x34efa3:_0x3fcc2f===null?_0x3fcc2f=Object[_0x2343e5(0x13b)](_0x34efa3,_0x1ce057):_0x3fcc2f,_0x212921;if(typeof Reflect===_0x2343e5(0x10e)&&typeof Reflect[_0x2343e5(0x10f)]===_0x2343e5(0x145))_0x4050b3=Reflect[_0x2343e5(0x10f)](_0x2a8fbe,_0x34efa3,_0x1ce057,_0x3fcc2f);else{for(var _0x561b84=_0x2a8fbe[_0x2343e5(0x11c)]-0x1;_0x561b84>=0x0;_0x561b84--)if(_0x212921=_0x2a8fbe[_0x561b84])_0x4050b3=(_0x2e960f<0x3?_0x212921(_0x4050b3):_0x2e960f>0x3?_0x212921(_0x34efa3,_0x1ce057,_0x4050b3):_0x212921(_0x34efa3,_0x1ce057))||_0x4050b3;}return _0x2e960f>0x3&&_0x4050b3&&Object[_0x2343e5(0x16a)](_0x34efa3,_0x1ce057,_0x4050b3),_0x4050b3;},__metadata=this&&this[a181_0x4e03fb(0x139)]||function(_0x652de8,_0x39aad3){const _0x545cfd=a181_0x4e03fb;if(typeof Reflect===_0x545cfd(0x10e)&&typeof Reflect[_0x545cfd(0x13f)]===_0x545cfd(0x145))return Reflect[_0x545cfd(0x13f)](_0x652de8,_0x39aad3);},FlosumCommitJob_1;function a181_0x2b67(){const _0x3a2b05=['121494bWjusU','branchName','getPrefix','fetchRepositoryData','SalesforceLogger2','SalesforceService','updateRemoteState','In\x20Progress','6267cvElcN','[INFO]\x20Start\x20commit\x20job','logger','../dto/commit-components.dto','length','commitAttachmentId','ERR_INVALID_SYNC_RECORD_ID','[ERROR]\x20','20bKcJhc','user','sha','name','constructor','CommitComponentsDto','getComponentsToWrite','handleCommitJobError','salesforceService','[FLOSUM\x20->\x20GIT]\x20[','BadRequestError','run','511wJPqrY','branches','deleteAttachmentId','commitData','70xlriSO','getCommitDto',']\x20[Repository:\x20','37016342RMtnNp','getComponentsToDelete','2402991JVBaAl','1626RxzpBt','SalesforceSyncService','1152976dcSAUg','__metadata','../../../constants/errors','getOwnPropertyDescriptor','split','provider','catch','metadata','setStatus','commitJob','toString','getRepositoryRecord','log','function','repository','repositoryName','GitProviderManager','then','map','error','14502960ENNuHb','../../../core/errors/bad-request.error','repositoryData','exec','all','../../salesforce/services/salesforce-logger-v2.service','search','getRepoService',']\x20[Branch:\x20','syncRepositoryId','design:paramtypes','SalesforceRetrieverService','apply','toUpperCase','convertToSFDX','../../shared/git-provider.manager','../../salesforce/services/salesforce.service','typedi','salesforceSync','updateLastCommit','78181abMKcJ','repo','getLoggerId','__decorate','retrieveAttachment','getBranchRecord','sfLogger','send','branch','./commit-components.job','defineProperty','repoService','../../../core','message','gitManager','syncBranchId','__esModule','deleteAttachment','Error','getOne','Service','object','decorate'];a181_0x2b67=function(){return _0x3a2b05;};return a181_0x2b67();}Object['defineProperty'](exports,a181_0x4e03fb(0x170),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a181_0x4e03fb(0x16c)),salesforce_logger_v2_service_1=require(a181_0x4e03fb(0x151)),salesforce_service_1=require(a181_0x4e03fb(0x15c)),git_provider_manager_1=require(a181_0x4e03fb(0x15b)),typedi_1=require(a181_0x4e03fb(0x15d)),errors_1=require(a181_0x4e03fb(0x13a)),bad_request_error_1=require(a181_0x4e03fb(0x14d)),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a181_0x4e03fb(0x11b)),commit_components_job_1=require(a181_0x4e03fb(0x169));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x221d65,_0x29a34d,_0x22d0a1,_0xfdd02f){const _0x5a9a0c=a181_0x4e03fb;this[_0x5a9a0c(0x128)]=_0x221d65,this[_0x5a9a0c(0x141)]=_0x29a34d,this[_0x5a9a0c(0x15e)]=_0x22d0a1,this[_0x5a9a0c(0x16e)]=_0xfdd02f,this[_0x5a9a0c(0x16b)]=this['gitManager'][_0x5a9a0c(0x153)](),this['logger']=new core_1['Logger'](FlosumCommitJob_1['name']);}async[a181_0x4e03fb(0x113)](){const _0x4b6fa0=a181_0x4e03fb;try{if(this[_0x4b6fa0(0x12f)][_0x4b6fa0(0x155)])this['repositoryData']=await this[_0x4b6fa0(0x15e)][_0x4b6fa0(0x143)](this['commitData'][_0x4b6fa0(0x155)]);else this[_0x4b6fa0(0x12f)][_0x4b6fa0(0x16f)]&&(this[_0x4b6fa0(0x14e)]=await this[_0x4b6fa0(0x15e)][_0x4b6fa0(0x165)](this[_0x4b6fa0(0x12f)]['syncBranchId']));}catch(_0x40ef50){throw new bad_request_error_1[(_0x4b6fa0(0x12a))](errors_1[_0x4b6fa0(0x11e)]);}}async[a181_0x4e03fb(0x126)](){const _0x699708=a181_0x4e03fb;if(!this[_0x699708(0x12f)][_0x699708(0x11d)])return[];const _0xcd0baa=await this[_0x699708(0x128)]['retrieveAttachment'](this[_0x699708(0x12f)][_0x699708(0x11d)])[_0x699708(0x149)](_0x4c02be=>_0x4c02be[_0x699708(0x13c)]('\x20')[_0x699708(0x14a)](_0x3a45cc=>_0x3a45cc['trim']())),_0x3b6e9b=new salesforce_retriever_service_1[(_0x699708(0x157))](this['salesforceService']),_0xd6bbb4=await _0x3b6e9b['run'](_0xcd0baa);return _0xd6bbb4;}async[a181_0x4e03fb(0x134)](){const _0x454798=a181_0x4e03fb;if(!this['commitData']['deleteAttachmentId'])return[];const _0x49f6d3=await this[_0x454798(0x128)][_0x454798(0x164)](this['commitData'][_0x454798(0x12e)]);return _0x49f6d3;}async[a181_0x4e03fb(0x131)](){const _0x2fc2d6=a181_0x4e03fb,_0x149d69=new commit_components_dto_1[(_0x2fc2d6(0x125))](),[_0x56f1c9,_0x1e5db2]=await Promise[_0x2fc2d6(0x150)]([this[_0x2fc2d6(0x126)](),this['getComponentsToDelete']()]);return _0x149d69[_0x2fc2d6(0x16d)]=this[_0x2fc2d6(0x12f)][_0x2fc2d6(0x16d)],_0x149d69[_0x2fc2d6(0x121)]=this['commitData'][_0x2fc2d6(0x121)],_0x149d69['components']={'writed':_0x56f1c9,'deleted':_0x1e5db2},_0x149d69[_0x2fc2d6(0x15a)]=this['commitData'][_0x2fc2d6(0x15a)],_0x149d69[_0x2fc2d6(0x161)]=this[_0x2fc2d6(0x146)],_0x149d69[_0x2fc2d6(0x168)]=this[_0x2fc2d6(0x168)],_0x149d69[_0x2fc2d6(0x13d)]=this[_0x2fc2d6(0x13d)],_0x149d69;}async[a181_0x4e03fb(0x15f)](_0x2a7f66=![]){const _0x3f8533=a181_0x4e03fb;if(_0x2a7f66)await this[_0x3f8533(0x15e)][_0x3f8533(0x116)](this[_0x3f8533(0x14e)],{});else{const _0x8941c7=await this['repository']['branches'][_0x3f8533(0x173)](this[_0x3f8533(0x168)][_0x3f8533(0x123)]);this['sfLogger']['log']('[INFO]\x20Update\x20remote\x20state.');const _0x2cf1fe={[this['repository']['gitUrl']]:{'lastCommit':_0x8941c7[_0x3f8533(0x122)]}};await this[_0x3f8533(0x15e)][_0x3f8533(0x116)](this[_0x3f8533(0x14e)],_0x2cf1fe);}}async[a181_0x4e03fb(0x14f)](){const _0x4f1fe8=a181_0x4e03fb,_0x3770e3=await this[_0x4f1fe8(0x131)]();await this[_0x4f1fe8(0x15e)][_0x4f1fe8(0x140)](this[_0x4f1fe8(0x14e)],_0x4f1fe8(0x117)),await this['commitJob'][_0x4f1fe8(0x12b)](_0x3770e3,this[_0x4f1fe8(0x166)]),await this[_0x4f1fe8(0x15f)](),this[_0x4f1fe8(0x12f)][_0x4f1fe8(0x11d)]&&await this[_0x4f1fe8(0x128)][_0x4f1fe8(0x171)](this[_0x4f1fe8(0x12f)]['commitAttachmentId']),this['commitData'][_0x4f1fe8(0x12e)]&&await this[_0x4f1fe8(0x128)][_0x4f1fe8(0x171)](this[_0x4f1fe8(0x12f)][_0x4f1fe8(0x12e)]),await this[_0x4f1fe8(0x15e)][_0x4f1fe8(0x140)](this[_0x4f1fe8(0x14e)],'Completed');}async[a181_0x4e03fb(0x127)](_0x2d9a2e){const _0x999230=a181_0x4e03fb;try{this[_0x999230(0x166)][_0x999230(0x144)](_0x999230(0x11f)+_0x2d9a2e),await this[_0x999230(0x166)][_0x999230(0x167)](),await this[_0x999230(0x15f)](!![]),await this[_0x999230(0x15e)][_0x999230(0x140)](this['repositoryData'],_0x999230(0x172));}catch(_0xd77c77){this[_0x999230(0x11a)][_0x999230(0x14b)](_0xd77c77);}}async['run'](_0x26159a,_0x396df8,_0x41461b){const _0x49bd53=a181_0x4e03fb;try{this[_0x49bd53(0x12f)]=_0x26159a,this[_0x49bd53(0x13d)]=_0x41461b,await this[_0x49bd53(0x113)](),this['repository']=await this[_0x49bd53(0x16b)][_0x49bd53(0x173)](this[_0x49bd53(0x14e)][_0x49bd53(0x147)]),this[_0x49bd53(0x168)]=await this[_0x49bd53(0x146)][_0x49bd53(0x12d)][_0x49bd53(0x173)](this[_0x49bd53(0x14e)][_0x49bd53(0x111)]),this[_0x49bd53(0x166)]=new salesforce_logger_v2_service_1[(_0x49bd53(0x114))](_0x396df8[_0x49bd53(0x162)](),(_0x396df8[_0x49bd53(0x112)]()||_0x49bd53(0x129)+_0x41461b[_0x49bd53(0x159)]()+_0x49bd53(0x132)+this[_0x49bd53(0x14e)][_0x49bd53(0x147)]+_0x49bd53(0x154)+this[_0x49bd53(0x14e)]['branchName']+']')+'\x20['+FlosumCommitJob_1[_0x49bd53(0x123)]+']');if(!this[_0x49bd53(0x14e)])throw new bad_request_error_1[(_0x49bd53(0x12a))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x49bd53(0x166)]['log'](_0x49bd53(0x119))[_0x49bd53(0x167)](),await this['exec']()[_0x49bd53(0x13e)](_0x5df118=>this['handleCommitJobError'](_0x5df118));}catch(_0x1b4365){this[_0x49bd53(0x12f)]=undefined,this[_0x49bd53(0x11a)][_0x49bd53(0x14b)](_0x1b4365);throw _0x1b4365;}}};function a181_0x4636(_0x56f147,_0x2e99ac){const _0x37bdcc=a181_0x2b67();return a181_0x4636=function(_0x5e4162,_0x5270ac){_0x5e4162=_0x5e4162-0x10e;let _0x2b671e=_0x37bdcc[_0x5e4162];return _0x2b671e;},a181_0x4636(_0x56f147,_0x2e99ac);}FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1[a181_0x4e03fb(0x174)]({'transient':!![]}),__metadata(a181_0x4e03fb(0x156),[salesforce_service_1[a181_0x4e03fb(0x115)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a181_0x4e03fb(0x137)],git_provider_manager_1[a181_0x4e03fb(0x148)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;