const a182_0x208e49=a182_0x5e77;(function(_0x108a5,_0x7cb7be){const _0x27d1b4=a182_0x5e77,_0x3cc854=_0x108a5();while(!![]){try{const _0x2e5dc2=-parseInt(_0x27d1b4(0xbf))/0x1+parseInt(_0x27d1b4(0x7d))/0x2*(parseInt(_0x27d1b4(0x8b))/0x3)+parseInt(_0x27d1b4(0xb4))/0x4*(parseInt(_0x27d1b4(0xb8))/0x5)+-parseInt(_0x27d1b4(0xab))/0x6*(-parseInt(_0x27d1b4(0xae))/0x7)+parseInt(_0x27d1b4(0xc7))/0x8+-parseInt(_0x27d1b4(0xbb))/0x9*(-parseInt(_0x27d1b4(0xd9))/0xa)+parseInt(_0x27d1b4(0x8a))/0xb*(-parseInt(_0x27d1b4(0xc5))/0xc);if(_0x2e5dc2===_0x7cb7be)break;else _0x3cc854['push'](_0x3cc854['shift']());}catch(_0x7e97c){_0x3cc854['push'](_0x3cc854['shift']());}}}(a182_0x148c,0x936ae));const a182_0x32723c=(function(){let _0x201fda=!![];return function(_0x36a9cb,_0x5550a6){const _0xfa6c97=_0x201fda?function(){const _0x124b72=a182_0x5e77;if(_0x5550a6){const _0x4bdc4b=_0x5550a6[_0x124b72(0x82)](_0x36a9cb,arguments);return _0x5550a6=null,_0x4bdc4b;}}:function(){};return _0x201fda=![],_0xfa6c97;};}()),a182_0x1350e9=a182_0x32723c(this,function(){const _0xf7a8e4=a182_0x5e77;return a182_0x1350e9['toString']()[_0xf7a8e4(0x9e)](_0xf7a8e4(0x73))[_0xf7a8e4(0x90)]()[_0xf7a8e4(0xc1)](a182_0x1350e9)[_0xf7a8e4(0x9e)](_0xf7a8e4(0x73));});a182_0x1350e9();'use strict';var __decorate=this&&this[a182_0x208e49(0xd2)]||function(_0x4e1b7e,_0x483549,_0x4cc753,_0x7908d8){const _0x289565=a182_0x208e49;var _0x3b0db3=arguments[_0x289565(0xa8)],_0x2df1b4=_0x3b0db3<0x3?_0x483549:_0x7908d8===null?_0x7908d8=Object[_0x289565(0xba)](_0x483549,_0x4cc753):_0x7908d8,_0x2045cd;if(typeof Reflect===_0x289565(0xaa)&&typeof Reflect['decorate']===_0x289565(0x75))_0x2df1b4=Reflect[_0x289565(0xcc)](_0x4e1b7e,_0x483549,_0x4cc753,_0x7908d8);else{for(var _0x352648=_0x4e1b7e['length']-0x1;_0x352648>=0x0;_0x352648--)if(_0x2045cd=_0x4e1b7e[_0x352648])_0x2df1b4=(_0x3b0db3<0x3?_0x2045cd(_0x2df1b4):_0x3b0db3>0x3?_0x2045cd(_0x483549,_0x4cc753,_0x2df1b4):_0x2045cd(_0x483549,_0x4cc753))||_0x2df1b4;}return _0x3b0db3>0x3&&_0x2df1b4&&Object[_0x289565(0xa0)](_0x483549,_0x4cc753,_0x2df1b4),_0x2df1b4;},__metadata=this&&this[a182_0x208e49(0xb6)]||function(_0x167879,_0x481a2a){const _0x5a0a75=a182_0x208e49;if(typeof Reflect===_0x5a0a75(0xaa)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x167879,_0x481a2a);},FlosumCommitJob_1;function a182_0x148c(){const _0xabc52d=['Logger','427210OIavqv','SalesforceService','trim','../../salesforce/services/salesforce-logger-v2.service','SalesforceLogger2','repositoryName','2408548uOvYGW','getCommitDto','__metadata','repoService','10EXBoLI','setStatus','getOwnPropertyDescriptor','1221381plsSYK','provider','branch','all','757125XrAbOo','deleteAttachment','constructor','../dto/commit-components.dto','__esModule','retrieveAttachment','2664012chBEcD','then','2699536BaskUF','salesforceSync','convertToSFDX','toUpperCase','syncRepositoryId','decorate','Error','design:paramtypes','exec','../../salesforce/services/salesforce-retriever.service','logger','__decorate','map','../../../core','sha','getPrefix','sfLogger','typedi','70zkzNrC','getOne','getRepoService','(((.+)+)+)+$','commitData','function','../../salesforce/services/salesforce.service','salesforceService','getComponentsToWrite','../../../core/errors/bad-request.error','branchName','[INFO]\x20Update\x20remote\x20state.','gitManager','269834MDBusO','run','commitJob','BadRequestError','handleCommitJobError','apply','[FLOSUM\x20->\x20GIT]\x20[','user','repo','repository','syncBranchId',']\x20[Branch:\x20','GitProviderManager','99sfEojK','3XpTlAk','../../shared/git-provider.manager','getComponentsToDelete','CommitComponentsDto','FlosumCommitJob','toString','CommitComponentsJob','[INFO]\x20Start\x20commit\x20job','components','getRepositoryRecord','send','log','branches','SalesforceSyncService','deleteAttachmentId','error','split','updateRemoteState','../../salesforce/services/salesforce-sync.service','search','commitAttachmentId','defineProperty','message','updateLastCommit','[ERROR]\x20','fetchRepositoryData','repositoryData','Service','catch','length','ERR_INVALID_SYNC_RECORD_ID','object','72VJkyor','name'];a182_0x148c=function(){return _0xabc52d;};return a182_0x148c();}Object[a182_0x208e49(0xa0)](exports,a182_0x208e49(0xc3),{'value':!![]}),exports[a182_0x208e49(0x8f)]=void 0x0;const core_1=require(a182_0x208e49(0xd4)),salesforce_logger_v2_service_1=require(a182_0x208e49(0xb1)),salesforce_service_1=require(a182_0x208e49(0x76)),git_provider_manager_1=require(a182_0x208e49(0x8c)),typedi_1=require(a182_0x208e49(0xd8)),errors_1=require('../../../constants/errors'),bad_request_error_1=require(a182_0x208e49(0x79)),salesforce_retriever_service_1=require(a182_0x208e49(0xd0)),salesforce_sync_service_1=require(a182_0x208e49(0x9d)),commit_components_dto_1=require(a182_0x208e49(0xc2)),commit_components_job_1=require('./commit-components.job');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0xf6fdee,_0x1e1629,_0x171f00,_0x30855a){const _0x2cec95=a182_0x208e49;this[_0x2cec95(0x77)]=_0xf6fdee,this[_0x2cec95(0x7f)]=_0x1e1629,this[_0x2cec95(0xc8)]=_0x171f00,this[_0x2cec95(0x7c)]=_0x30855a,this[_0x2cec95(0xb7)]=this[_0x2cec95(0x7c)][_0x2cec95(0x72)](),this[_0x2cec95(0xd1)]=new core_1[(_0x2cec95(0xad))](FlosumCommitJob_1[_0x2cec95(0xac)]);}async['fetchRepositoryData'](){const _0x4062a=a182_0x208e49;try{if(this['commitData']['syncRepositoryId'])this['repositoryData']=await this[_0x4062a(0xc8)][_0x4062a(0x94)](this[_0x4062a(0x74)][_0x4062a(0xcb)]);else this[_0x4062a(0x74)]['syncBranchId']&&(this[_0x4062a(0xa5)]=await this['salesforceSync']['getBranchRecord'](this[_0x4062a(0x74)][_0x4062a(0x87)]));}catch(_0xebad8){throw new bad_request_error_1[(_0x4062a(0x80))](errors_1[_0x4062a(0xa9)]);}}async[a182_0x208e49(0x78)](){const _0x2cd4ea=a182_0x208e49;if(!this[_0x2cd4ea(0x74)][_0x2cd4ea(0x9f)])return[];const _0x58806c=await this[_0x2cd4ea(0x77)][_0x2cd4ea(0xc4)](this[_0x2cd4ea(0x74)][_0x2cd4ea(0x9f)])[_0x2cd4ea(0xc6)](_0x5ecbed=>_0x5ecbed[_0x2cd4ea(0x9b)]('\x20')[_0x2cd4ea(0xd3)](_0x4cee17=>_0x4cee17[_0x2cd4ea(0xb0)]())),_0x291dda=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x2cd4ea(0x77)]),_0x29f087=await _0x291dda[_0x2cd4ea(0x7e)](_0x58806c);return _0x29f087;}async[a182_0x208e49(0x8d)](){const _0x4ed313=a182_0x208e49;if(!this[_0x4ed313(0x74)][_0x4ed313(0x99)])return[];const _0x46b33a=await this[_0x4ed313(0x77)][_0x4ed313(0xc4)](this[_0x4ed313(0x74)][_0x4ed313(0x99)]);return _0x46b33a;}async[a182_0x208e49(0xb5)](){const _0x4c45ca=a182_0x208e49,_0x49055d=new commit_components_dto_1[(_0x4c45ca(0x8e))](),[_0x585674,_0x769b98]=await Promise[_0x4c45ca(0xbe)]([this['getComponentsToWrite'](),this[_0x4c45ca(0x8d)]()]);return _0x49055d['message']=this[_0x4c45ca(0x74)][_0x4c45ca(0xa1)],_0x49055d[_0x4c45ca(0x84)]=this[_0x4c45ca(0x74)][_0x4c45ca(0x84)],_0x49055d[_0x4c45ca(0x93)]={'writed':_0x585674,'deleted':_0x769b98},_0x49055d[_0x4c45ca(0xc9)]=this[_0x4c45ca(0x74)][_0x4c45ca(0xc9)],_0x49055d[_0x4c45ca(0x85)]=this[_0x4c45ca(0x86)],_0x49055d[_0x4c45ca(0xbd)]=this[_0x4c45ca(0xbd)],_0x49055d['provider']=this[_0x4c45ca(0xbc)],_0x49055d;}async[a182_0x208e49(0xa2)](_0x17d77b=![]){const _0x19e5e5=a182_0x208e49;if(_0x17d77b)await this['salesforceSync']['updateRemoteState'](this[_0x19e5e5(0xa5)],{});else{const _0x51e395=await this[_0x19e5e5(0x86)][_0x19e5e5(0x97)][_0x19e5e5(0x71)](this['branch'][_0x19e5e5(0xac)]);this[_0x19e5e5(0xd7)][_0x19e5e5(0x96)](_0x19e5e5(0x7b));const _0xaa3b7={[this[_0x19e5e5(0x86)]['gitUrl']]:{'lastCommit':_0x51e395[_0x19e5e5(0xd5)]}};await this[_0x19e5e5(0xc8)][_0x19e5e5(0x9c)](this[_0x19e5e5(0xa5)],_0xaa3b7);}}async[a182_0x208e49(0xcf)](){const _0x4dae2c=a182_0x208e49,_0x3afaf2=await this[_0x4dae2c(0xb5)]();await this[_0x4dae2c(0xc8)][_0x4dae2c(0xb9)](this[_0x4dae2c(0xa5)],'In\x20Progress'),await this['commitJob'][_0x4dae2c(0x7e)](_0x3afaf2,this[_0x4dae2c(0xd7)]),await this[_0x4dae2c(0xa2)](),this[_0x4dae2c(0x74)][_0x4dae2c(0x9f)]&&await this[_0x4dae2c(0x77)][_0x4dae2c(0xc0)](this['commitData']['commitAttachmentId']),this[_0x4dae2c(0x74)][_0x4dae2c(0x99)]&&await this[_0x4dae2c(0x77)][_0x4dae2c(0xc0)](this['commitData']['deleteAttachmentId']),await this[_0x4dae2c(0xc8)]['setStatus'](this[_0x4dae2c(0xa5)],'Completed');}async[a182_0x208e49(0x81)](_0x3fc7d4){const _0x5cfb49=a182_0x208e49;try{this[_0x5cfb49(0xd7)][_0x5cfb49(0x96)](_0x5cfb49(0xa3)+_0x3fc7d4),await this[_0x5cfb49(0xd7)][_0x5cfb49(0x95)](),await this['updateLastCommit'](!![]),await this[_0x5cfb49(0xc8)][_0x5cfb49(0xb9)](this['repositoryData'],_0x5cfb49(0xcd));}catch(_0x1ad6f8){this[_0x5cfb49(0xd1)][_0x5cfb49(0x9a)](_0x1ad6f8);}}async['run'](_0x16f518,_0x8ae7f9,_0x2aa7ec){const _0x2e6500=a182_0x208e49;try{this[_0x2e6500(0x74)]=_0x16f518,this[_0x2e6500(0xbc)]=_0x2aa7ec,await this[_0x2e6500(0xa4)](),this[_0x2e6500(0x86)]=await this[_0x2e6500(0xb7)][_0x2e6500(0x71)](this[_0x2e6500(0xa5)][_0x2e6500(0xb3)]),this[_0x2e6500(0xbd)]=await this[_0x2e6500(0x86)]['branches'][_0x2e6500(0x71)](this[_0x2e6500(0xa5)]['branchName']),this[_0x2e6500(0xd7)]=new salesforce_logger_v2_service_1[(_0x2e6500(0xb2))](_0x8ae7f9['getLoggerId'](),(_0x8ae7f9[_0x2e6500(0xd6)]()||_0x2e6500(0x83)+_0x2aa7ec[_0x2e6500(0xca)]()+']\x20[Repository:\x20'+this[_0x2e6500(0xa5)][_0x2e6500(0xb3)]+_0x2e6500(0x88)+this['repositoryData'][_0x2e6500(0x7a)]+']')+'\x20['+FlosumCommitJob_1[_0x2e6500(0xac)]+']');if(!this[_0x2e6500(0xa5)])throw new bad_request_error_1[(_0x2e6500(0x80))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x2e6500(0xd7)]['log'](_0x2e6500(0x92))[_0x2e6500(0x95)](),await this[_0x2e6500(0xcf)]()[_0x2e6500(0xa7)](_0x16a929=>this[_0x2e6500(0x81)](_0x16a929));}catch(_0x303611){this[_0x2e6500(0x74)]=undefined,this[_0x2e6500(0xd1)][_0x2e6500(0x9a)](_0x303611);throw _0x303611;}}};function a182_0x5e77(_0x36c2ea,_0x1b9cbb){const _0x3162d9=a182_0x148c();return a182_0x5e77=function(_0x1350e9,_0x32723c){_0x1350e9=_0x1350e9-0x71;let _0x148caa=_0x3162d9[_0x1350e9];return _0x148caa;},a182_0x5e77(_0x36c2ea,_0x1b9cbb);}FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1[a182_0x208e49(0xa6)]({'transient':!![]}),__metadata(a182_0x208e49(0xce),[salesforce_service_1[a182_0x208e49(0xaf)],commit_components_job_1[a182_0x208e49(0x91)],salesforce_sync_service_1[a182_0x208e49(0x98)],git_provider_manager_1[a182_0x208e49(0x89)]])],FlosumCommitJob),exports[a182_0x208e49(0x8f)]=FlosumCommitJob;