const a182_0x2a082b=a182_0x5e9d;(function(_0x2c1bc5,_0x327b24){const _0x562c73=a182_0x5e9d,_0x2fe77f=_0x2c1bc5();while(!![]){try{const _0x2f9cfd=parseInt(_0x562c73(0x91))/0x1+parseInt(_0x562c73(0xae))/0x2*(parseInt(_0x562c73(0xa6))/0x3)+-parseInt(_0x562c73(0xa3))/0x4+-parseInt(_0x562c73(0xcf))/0x5+-parseInt(_0x562c73(0x98))/0x6+parseInt(_0x562c73(0x85))/0x7+parseInt(_0x562c73(0xd3))/0x8;if(_0x2f9cfd===_0x327b24)break;else _0x2fe77f['push'](_0x2fe77f['shift']());}catch(_0x1f9e57){_0x2fe77f['push'](_0x2fe77f['shift']());}}}(a182_0x48d8,0x423c0));const a182_0x42ff5b=(function(){let _0x404738=!![];return function(_0x3cc86d,_0xbf80ae){const _0x289735=_0x404738?function(){if(_0xbf80ae){const _0x50914b=_0xbf80ae['apply'](_0x3cc86d,arguments);return _0xbf80ae=null,_0x50914b;}}:function(){};return _0x404738=![],_0x289735;};}()),a182_0x523e4e=a182_0x42ff5b(this,function(){const _0x162e8b=a182_0x5e9d;return a182_0x523e4e[_0x162e8b(0xb2)]()['search']('(((.+)+)+)+$')[_0x162e8b(0xb2)]()[_0x162e8b(0xb7)](a182_0x523e4e)[_0x162e8b(0xa2)](_0x162e8b(0xac));});a182_0x523e4e();'use strict';var __decorate=this&&this[a182_0x2a082b(0x89)]||function(_0x31d4c2,_0x472f3b,_0x5e803b,_0x2ccfa6){const _0x30881c=a182_0x2a082b;var _0x33c71c=arguments[_0x30881c(0xb6)],_0x47bc2c=_0x33c71c<0x3?_0x472f3b:_0x2ccfa6===null?_0x2ccfa6=Object[_0x30881c(0x86)](_0x472f3b,_0x5e803b):_0x2ccfa6,_0x485331;if(typeof Reflect===_0x30881c(0xc1)&&typeof Reflect[_0x30881c(0xc0)]===_0x30881c(0xb8))_0x47bc2c=Reflect['decorate'](_0x31d4c2,_0x472f3b,_0x5e803b,_0x2ccfa6);else{for(var _0x282cff=_0x31d4c2[_0x30881c(0xb6)]-0x1;_0x282cff>=0x0;_0x282cff--)if(_0x485331=_0x31d4c2[_0x282cff])_0x47bc2c=(_0x33c71c<0x3?_0x485331(_0x47bc2c):_0x33c71c>0x3?_0x485331(_0x472f3b,_0x5e803b,_0x47bc2c):_0x485331(_0x472f3b,_0x5e803b))||_0x47bc2c;}return _0x33c71c>0x3&&_0x47bc2c&&Object[_0x30881c(0xc2)](_0x472f3b,_0x5e803b,_0x47bc2c),_0x47bc2c;},__metadata=this&&this[a182_0x2a082b(0xcb)]||function(_0x14e036,_0x53ccb3){const _0x46e019=a182_0x2a082b;if(typeof Reflect===_0x46e019(0xc1)&&typeof Reflect['metadata']===_0x46e019(0xb8))return Reflect['metadata'](_0x14e036,_0x53ccb3);},FlosumCommitJob_1;Object[a182_0x2a082b(0xc2)](exports,a182_0x2a082b(0x96),{'value':!![]}),exports[a182_0x2a082b(0x93)]=void 0x0;const core_1=require(a182_0x2a082b(0xa1)),salesforce_logger_v2_service_1=require(a182_0x2a082b(0x9d)),salesforce_service_1=require(a182_0x2a082b(0xdf)),git_provider_manager_1=require(a182_0x2a082b(0xa0)),typedi_1=require('typedi'),errors_1=require(a182_0x2a082b(0xda)),bad_request_error_1=require(a182_0x2a082b(0xe0)),salesforce_retriever_service_1=require(a182_0x2a082b(0xa5)),salesforce_sync_service_1=require(a182_0x2a082b(0xdb)),commit_components_dto_1=require(a182_0x2a082b(0xc8)),commit_components_job_1=require(a182_0x2a082b(0xbf));function a182_0x5e9d(_0x25edd5,_0x230e6d){const _0x429ce1=a182_0x48d8();return a182_0x5e9d=function(_0x523e4e,_0x42ff5b){_0x523e4e=_0x523e4e-0x84;let _0x48d81c=_0x429ce1[_0x523e4e];return _0x48d81c;},a182_0x5e9d(_0x25edd5,_0x230e6d);}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x536fec,_0x334d53,_0x2d5104,_0x2cb9ba){const _0x3a286c=a182_0x2a082b;this[_0x3a286c(0xbd)]=_0x536fec,this['commitJob']=_0x334d53,this[_0x3a286c(0x9a)]=_0x2d5104,this['gitManager']=_0x2cb9ba,this[_0x3a286c(0xc3)]=this['gitManager']['getRepoService'](),this[_0x3a286c(0xe1)]=new core_1['Logger'](FlosumCommitJob_1['name']);}async[a182_0x2a082b(0xad)](){const _0x3d4804=a182_0x2a082b;try{if(this[_0x3d4804(0xd0)][_0x3d4804(0xba)])this[_0x3d4804(0x8e)]=await this['salesforceSync'][_0x3d4804(0x8a)](this[_0x3d4804(0xd0)][_0x3d4804(0xba)]);else this[_0x3d4804(0xd0)][_0x3d4804(0xbb)]&&(this['repositoryData']=await this[_0x3d4804(0x9a)][_0x3d4804(0xde)](this[_0x3d4804(0xd0)][_0x3d4804(0xbb)]));}catch(_0x158ac7){throw new bad_request_error_1[(_0x3d4804(0xab))](errors_1[_0x3d4804(0x99)]);}}async[a182_0x2a082b(0x9b)](){const _0x1352ed=a182_0x2a082b;if(!this[_0x1352ed(0xd0)][_0x1352ed(0xb4)])return[];const _0x21a8e4=await this[_0x1352ed(0xbd)]['retrieveAttachment'](this['commitData'][_0x1352ed(0xb4)])[_0x1352ed(0xb9)](_0x49c842=>_0x49c842[_0x1352ed(0xcd)]('\x20')[_0x1352ed(0xd7)](_0xfd61c1=>_0xfd61c1[_0x1352ed(0xbe)]())),_0x51996e=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x1352ed(0xbd)]),_0x4ea042=await _0x51996e['run'](_0x21a8e4);return _0x4ea042;}async[a182_0x2a082b(0x9e)](){const _0x4e9c46=a182_0x2a082b;if(!this[_0x4e9c46(0xd0)][_0x4e9c46(0xd1)])return[];const _0x56aa96=await this['salesforceService'][_0x4e9c46(0x97)](this[_0x4e9c46(0xd0)][_0x4e9c46(0xd1)]);return _0x56aa96;}async[a182_0x2a082b(0xb0)](){const _0x384b28=a182_0x2a082b,_0x5d5e4c=new commit_components_dto_1[(_0x384b28(0x84))](),[_0x3959b4,_0x3b6f66]=await Promise['all']([this[_0x384b28(0x9b)](),this[_0x384b28(0x9e)]()]);return _0x5d5e4c['message']=this[_0x384b28(0xd0)][_0x384b28(0xd9)],_0x5d5e4c[_0x384b28(0xd2)]=this['commitData'][_0x384b28(0xd2)],_0x5d5e4c['components']={'writed':_0x3959b4,'deleted':_0x3b6f66},_0x5d5e4c[_0x384b28(0x8d)]=this[_0x384b28(0xd0)][_0x384b28(0x8d)],_0x5d5e4c[_0x384b28(0x94)]=this[_0x384b28(0xca)],_0x5d5e4c['branch']=this[_0x384b28(0xcc)],_0x5d5e4c[_0x384b28(0xa8)]=this['provider'],_0x5d5e4c;}async[a182_0x2a082b(0xaa)](_0x3ec5fb=![]){const _0x2c5559=a182_0x2a082b;if(_0x3ec5fb)await this[_0x2c5559(0x9a)][_0x2c5559(0x88)](this['repositoryData'],{});else{const _0x588f1d=await this[_0x2c5559(0xca)][_0x2c5559(0x90)][_0x2c5559(0xc6)](this[_0x2c5559(0xcc)][_0x2c5559(0xc9)]);this[_0x2c5559(0xd5)][_0x2c5559(0x92)](_0x2c5559(0x87));const _0x34bd8a={[this[_0x2c5559(0xca)]['gitUrl']]:{'lastCommit':_0x588f1d['sha']}};await this[_0x2c5559(0x9a)][_0x2c5559(0x88)](this['repositoryData'],_0x34bd8a);}}async[a182_0x2a082b(0xaf)](){const _0x55373f=a182_0x2a082b,_0x2d8b80=await this[_0x55373f(0xb0)]();await this[_0x55373f(0x9a)][_0x55373f(0x8f)](this['repositoryData'],_0x55373f(0x9f)),await this[_0x55373f(0xa4)][_0x55373f(0xbc)](_0x2d8b80,this[_0x55373f(0xd5)]),await this['updateLastCommit'](),this['commitData'][_0x55373f(0xb4)]&&await this[_0x55373f(0xbd)]['deleteAttachment'](this['commitData']['commitAttachmentId']),this[_0x55373f(0xd0)][_0x55373f(0xd1)]&&await this[_0x55373f(0xbd)]['deleteAttachment'](this['commitData'][_0x55373f(0xd1)]),await this[_0x55373f(0x9a)][_0x55373f(0x8f)](this['repositoryData'],'Completed');}async[a182_0x2a082b(0xc7)](_0x1cd1a5){const _0x384a24=a182_0x2a082b;try{this[_0x384a24(0xd5)][_0x384a24(0x92)](_0x384a24(0xc4)+_0x1cd1a5),await this['sfLogger'][_0x384a24(0xdc)](),await this[_0x384a24(0xaa)](!![]),await this[_0x384a24(0x9a)]['setStatus'](this[_0x384a24(0x8e)],_0x384a24(0xd8));}catch(_0x4c1e6b){this['logger'][_0x384a24(0xd4)](_0x4c1e6b);}}async[a182_0x2a082b(0xbc)](_0x20f813,_0x338279,_0x15d7ef){const _0x4573dd=a182_0x2a082b;try{this['commitData']=_0x20f813,this[_0x4573dd(0xa8)]=_0x15d7ef,await this[_0x4573dd(0xad)](),this[_0x4573dd(0xca)]=await this[_0x4573dd(0xc3)][_0x4573dd(0xc6)](this[_0x4573dd(0x8e)][_0x4573dd(0xc5)]),this[_0x4573dd(0xcc)]=await this['repository'][_0x4573dd(0x90)]['getOne'](this[_0x4573dd(0x8e)][_0x4573dd(0xb5)]),this[_0x4573dd(0xd5)]=new salesforce_logger_v2_service_1['SalesforceLogger2'](_0x338279[_0x4573dd(0xd6)](),(_0x338279[_0x4573dd(0xb1)]()||'[FLOSUM\x20->\x20GIT]\x20['+_0x15d7ef[_0x4573dd(0xa9)]()+_0x4573dd(0xce)+this['repositoryData']['repositoryName']+_0x4573dd(0x95)+this[_0x4573dd(0x8e)][_0x4573dd(0xb5)]+']')+'\x20['+FlosumCommitJob_1[_0x4573dd(0xc9)]+']');if(!this[_0x4573dd(0x8e)])throw new bad_request_error_1['BadRequestError'](errors_1[_0x4573dd(0x9c)]);await this[_0x4573dd(0xd5)][_0x4573dd(0x92)](_0x4573dd(0xdd))['send'](),await this[_0x4573dd(0xaf)]()['catch'](_0x299ee1=>this[_0x4573dd(0xc7)](_0x299ee1));}catch(_0x333a95){this[_0x4573dd(0xd0)]=undefined,this[_0x4573dd(0xe1)][_0x4573dd(0xd4)](_0x333a95);throw _0x333a95;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a182_0x2a082b(0xb3),[salesforce_service_1[a182_0x2a082b(0xa7)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a182_0x2a082b(0x8c)],git_provider_manager_1[a182_0x2a082b(0x8b)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;function a182_0x48d8(){const _0x1e8081=['../../shared/git-provider.manager','../../../core','search','1343172Opntpl','commitJob','../../salesforce/services/salesforce-retriever.service','1474593fEfVGk','SalesforceService','provider','toUpperCase','updateLastCommit','BadRequestError','(((.+)+)+)+$','fetchRepositoryData','2UVCIjt','exec','getCommitDto','getPrefix','toString','design:paramtypes','commitAttachmentId','branchName','length','constructor','function','then','syncRepositoryId','syncBranchId','run','salesforceService','trim','./commit-components.job','decorate','object','defineProperty','repoService','[ERROR]\x20','repositoryName','getOne','handleCommitJobError','../dto/commit-components.dto','name','repository','__metadata','branch','split',']\x20[Repository:\x20','1118955QeLppY','commitData','deleteAttachmentId','user','883088piBnjZ','error','sfLogger','getLoggerId','map','Error','message','../../../constants/errors','../../salesforce/services/salesforce-sync.service','send','[INFO]\x20Start\x20commit\x20job','getBranchRecord','../../salesforce/services/salesforce.service','../../../core/errors/bad-request.error','logger','CommitComponentsDto','292313UxjoRU','getOwnPropertyDescriptor','[INFO]\x20Update\x20remote\x20state.','updateRemoteState','__decorate','getRepositoryRecord','GitProviderManager','SalesforceSyncService','convertToSFDX','repositoryData','setStatus','branches','248562spNvwH','log','FlosumCommitJob','repo',']\x20[Branch:\x20','__esModule','retrieveAttachment','368148hftrfo','ERR_INVALID_SYNC_RECORD_ID','salesforceSync','getComponentsToWrite','ERR_UNKNOWN_SYNC_RECORD_ID','../../salesforce/services/salesforce-logger-v2.service','getComponentsToDelete','In\x20Progress'];a182_0x48d8=function(){return _0x1e8081;};return a182_0x48d8();}