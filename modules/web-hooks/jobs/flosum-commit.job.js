const a181_0x6f93bd=a181_0x1c63;(function(_0x20c868,_0x1dd43e){const _0x1d284c=a181_0x1c63,_0x850931=_0x20c868();while(!![]){try{const _0x3bb4ee=parseInt(_0x1d284c(0x142))/0x1+parseInt(_0x1d284c(0x139))/0x2*(-parseInt(_0x1d284c(0x154))/0x3)+-parseInt(_0x1d284c(0x134))/0x4+-parseInt(_0x1d284c(0x117))/0x5*(-parseInt(_0x1d284c(0x146))/0x6)+parseInt(_0x1d284c(0x153))/0x7*(-parseInt(_0x1d284c(0x14f))/0x8)+-parseInt(_0x1d284c(0x101))/0x9+parseInt(_0x1d284c(0x15b))/0xa;if(_0x3bb4ee===_0x1dd43e)break;else _0x850931['push'](_0x850931['shift']());}catch(_0x4fb649){_0x850931['push'](_0x850931['shift']());}}}(a181_0x163b,0x91b50));const a181_0x5e4ba6=(function(){let _0x380061=!![];return function(_0x14f088,_0x567fd7){const _0x51b01b=_0x380061?function(){const _0x19331b=a181_0x1c63;if(_0x567fd7){const _0x41180b=_0x567fd7[_0x19331b(0xfb)](_0x14f088,arguments);return _0x567fd7=null,_0x41180b;}}:function(){};return _0x380061=![],_0x51b01b;};}()),a181_0x6de9e4=a181_0x5e4ba6(this,function(){const _0x3e556f=a181_0x1c63;return a181_0x6de9e4['toString']()[_0x3e556f(0x149)](_0x3e556f(0x140))[_0x3e556f(0x15a)]()[_0x3e556f(0x12d)](a181_0x6de9e4)[_0x3e556f(0x149)]('(((.+)+)+)+$');});function a181_0x1c63(_0x41d624,_0x2e74b0){const _0x14a630=a181_0x163b();return a181_0x1c63=function(_0x6de9e4,_0x5e4ba6){_0x6de9e4=_0x6de9e4-0xfa;let _0x163b3f=_0x14a630[_0x6de9e4];return _0x163b3f;},a181_0x1c63(_0x41d624,_0x2e74b0);}a181_0x6de9e4();'use strict';var __decorate=this&&this[a181_0x6f93bd(0x106)]||function(_0xfef951,_0x9c5011,_0x2bbabc,_0x1c7a7c){const _0xb1a007=a181_0x6f93bd;var _0x102072=arguments[_0xb1a007(0x156)],_0x3fb66a=_0x102072<0x3?_0x9c5011:_0x1c7a7c===null?_0x1c7a7c=Object[_0xb1a007(0x11e)](_0x9c5011,_0x2bbabc):_0x1c7a7c,_0x4608b4;if(typeof Reflect===_0xb1a007(0x103)&&typeof Reflect[_0xb1a007(0x105)]==='function')_0x3fb66a=Reflect[_0xb1a007(0x105)](_0xfef951,_0x9c5011,_0x2bbabc,_0x1c7a7c);else{for(var _0xdceb24=_0xfef951['length']-0x1;_0xdceb24>=0x0;_0xdceb24--)if(_0x4608b4=_0xfef951[_0xdceb24])_0x3fb66a=(_0x102072<0x3?_0x4608b4(_0x3fb66a):_0x102072>0x3?_0x4608b4(_0x9c5011,_0x2bbabc,_0x3fb66a):_0x4608b4(_0x9c5011,_0x2bbabc))||_0x3fb66a;}return _0x102072>0x3&&_0x3fb66a&&Object[_0xb1a007(0x15d)](_0x9c5011,_0x2bbabc,_0x3fb66a),_0x3fb66a;},__metadata=this&&this[a181_0x6f93bd(0x13a)]||function(_0x5b25de,_0x47c498){const _0x16c456=a181_0x6f93bd;if(typeof Reflect===_0x16c456(0x103)&&typeof Reflect[_0x16c456(0x132)]===_0x16c456(0x116))return Reflect[_0x16c456(0x132)](_0x5b25de,_0x47c498);},FlosumCommitJob_1;Object[a181_0x6f93bd(0x15d)](exports,a181_0x6f93bd(0x147),{'value':!![]}),exports[a181_0x6f93bd(0xff)]=void 0x0;const core_1=require('../../../core'),salesforce_logger_v2_service_1=require('../../salesforce/services/salesforce-logger-v2.service'),salesforce_service_1=require(a181_0x6f93bd(0x158)),git_provider_manager_1=require(a181_0x6f93bd(0x102)),typedi_1=require(a181_0x6f93bd(0x11f)),errors_1=require(a181_0x6f93bd(0xfd)),bad_request_error_1=require(a181_0x6f93bd(0x10d)),salesforce_retriever_service_1=require(a181_0x6f93bd(0x157)),salesforce_sync_service_1=require(a181_0x6f93bd(0x10a)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a181_0x6f93bd(0xfa));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x2e6be3,_0x35e5ce,_0x4d640e,_0x1c6721){const _0x556082=a181_0x6f93bd;this[_0x556082(0x13f)]=_0x2e6be3,this[_0x556082(0x13b)]=_0x35e5ce,this[_0x556082(0x138)]=_0x4d640e,this[_0x556082(0x159)]=_0x1c6721,this[_0x556082(0x14e)]=this[_0x556082(0x159)][_0x556082(0x10f)](),this[_0x556082(0x11c)]=new core_1['Logger'](FlosumCommitJob_1[_0x556082(0x14c)]);}async['fetchRepositoryData'](){const _0xec0c8a=a181_0x6f93bd;try{if(this[_0xec0c8a(0x152)][_0xec0c8a(0x12b)])this[_0xec0c8a(0x111)]=await this[_0xec0c8a(0x138)][_0xec0c8a(0x131)](this['commitData'][_0xec0c8a(0x12b)]);else this[_0xec0c8a(0x152)][_0xec0c8a(0x144)]&&(this[_0xec0c8a(0x111)]=await this[_0xec0c8a(0x138)][_0xec0c8a(0x126)](this[_0xec0c8a(0x152)][_0xec0c8a(0x144)]));}catch(_0x561578){throw new bad_request_error_1['BadRequestError'](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a181_0x6f93bd(0x143)](){const _0x1c7ff0=a181_0x6f93bd;if(!this['commitData']['commitAttachmentId'])return[];const _0x16e49c=await this[_0x1c7ff0(0x13f)][_0x1c7ff0(0x115)](this[_0x1c7ff0(0x152)][_0x1c7ff0(0x113)])[_0x1c7ff0(0x12f)](_0x10437f=>_0x10437f[_0x1c7ff0(0x11b)]('\x20')[_0x1c7ff0(0x125)](_0x41d7dc=>_0x41d7dc[_0x1c7ff0(0x145)]())),_0x290c3d=new salesforce_retriever_service_1[(_0x1c7ff0(0x110))](this[_0x1c7ff0(0x13f)]),_0x4b343f=await _0x290c3d['run'](_0x16e49c);return _0x4b343f;}async[a181_0x6f93bd(0x10e)](){const _0xd555ba=a181_0x6f93bd;if(!this['commitData']['deleteAttachmentId'])return[];const _0x51e1b7=await this['salesforceService'][_0xd555ba(0x115)](this['commitData']['deleteAttachmentId']);return _0x51e1b7;}async['getCommitDto'](){const _0x5785c6=a181_0x6f93bd,_0x2d5779=new commit_components_dto_1['CommitComponentsDto'](),[_0x2ba363,_0x37b5fc]=await Promise['all']([this[_0x5785c6(0x143)](),this[_0x5785c6(0x10e)]()]);return _0x2d5779[_0x5785c6(0x11d)]=this[_0x5785c6(0x152)][_0x5785c6(0x11d)],_0x2d5779[_0x5785c6(0xfe)]=this[_0x5785c6(0x152)]['user'],_0x2d5779[_0x5785c6(0x14d)]={'writed':_0x2ba363,'deleted':_0x37b5fc},_0x2d5779[_0x5785c6(0x13e)]=this[_0x5785c6(0x152)]['convertToSFDX'],_0x2d5779[_0x5785c6(0x12a)]=this[_0x5785c6(0x133)],_0x2d5779[_0x5785c6(0x120)]=this['branch'],_0x2d5779[_0x5785c6(0x10b)]=this['provider'],_0x2d5779;}async['updateLastCommit'](_0x31f85d=![]){const _0x11c1ad=a181_0x6f93bd;if(_0x31f85d)await this[_0x11c1ad(0x138)][_0x11c1ad(0x128)](this[_0x11c1ad(0x111)],{});else{const _0x4f1ee7=await this['repository'][_0x11c1ad(0x112)][_0x11c1ad(0xfc)](this['branch']['name']);this[_0x11c1ad(0x12e)][_0x11c1ad(0x12c)]('[INFO]\x20Update\x20remote\x20state.');const _0x3146c7={[this[_0x11c1ad(0x133)]['gitUrl']]:{'lastCommit':_0x4f1ee7[_0x11c1ad(0x14b)]}};await this[_0x11c1ad(0x138)]['updateRemoteState'](this[_0x11c1ad(0x111)],_0x3146c7);}}async[a181_0x6f93bd(0x108)](){const _0x270f2c=a181_0x6f93bd,_0x14e2ed=await this[_0x270f2c(0x15c)]();await this[_0x270f2c(0x138)][_0x270f2c(0x130)](this[_0x270f2c(0x111)],'In\x20Progress'),await this[_0x270f2c(0x13b)][_0x270f2c(0x122)](_0x14e2ed,this['sfLogger']),await this['updateLastCommit'](),this[_0x270f2c(0x152)][_0x270f2c(0x113)]&&await this[_0x270f2c(0x13f)][_0x270f2c(0x150)](this[_0x270f2c(0x152)][_0x270f2c(0x113)]),this[_0x270f2c(0x152)][_0x270f2c(0x121)]&&await this['salesforceService']['deleteAttachment'](this[_0x270f2c(0x152)][_0x270f2c(0x121)]),await this['salesforceSync']['setStatus'](this['repositoryData'],'Completed');}async[a181_0x6f93bd(0x100)](_0x5ad52d){const _0x200f63=a181_0x6f93bd;try{this[_0x200f63(0x12e)][_0x200f63(0x12c)](_0x200f63(0x118)+_0x5ad52d),await this[_0x200f63(0x12e)][_0x200f63(0x137)](),await this[_0x200f63(0x136)](!![]),await this[_0x200f63(0x138)][_0x200f63(0x130)](this[_0x200f63(0x111)],'Error');}catch(_0x1bb6e5){this['logger'][_0x200f63(0x11a)](_0x1bb6e5);}}async[a181_0x6f93bd(0x122)](_0x11c372,_0x871638,_0x3ad555){const _0x5a7c0d=a181_0x6f93bd;try{this[_0x5a7c0d(0x152)]=_0x11c372,this['provider']=_0x3ad555,await this[_0x5a7c0d(0x13d)](),this[_0x5a7c0d(0x133)]=await this[_0x5a7c0d(0x14e)][_0x5a7c0d(0xfc)](this[_0x5a7c0d(0x111)]['repositoryName']),this[_0x5a7c0d(0x120)]=await this[_0x5a7c0d(0x133)][_0x5a7c0d(0x112)][_0x5a7c0d(0xfc)](this[_0x5a7c0d(0x111)][_0x5a7c0d(0x15e)]),this[_0x5a7c0d(0x12e)]=new salesforce_logger_v2_service_1[(_0x5a7c0d(0x155))](_0x871638[_0x5a7c0d(0x141)](),(_0x871638[_0x5a7c0d(0x123)]()||_0x5a7c0d(0x104)+_0x3ad555[_0x5a7c0d(0x114)]()+_0x5a7c0d(0x14a)+this[_0x5a7c0d(0x111)][_0x5a7c0d(0x10c)]+_0x5a7c0d(0x109)+this['repositoryData'][_0x5a7c0d(0x15e)]+']')+'\x20['+FlosumCommitJob_1[_0x5a7c0d(0x14c)]+']');if(!this[_0x5a7c0d(0x111)])throw new bad_request_error_1[(_0x5a7c0d(0x13c))](errors_1[_0x5a7c0d(0x107)]);await this[_0x5a7c0d(0x12e)][_0x5a7c0d(0x12c)]('[INFO]\x20Start\x20commit\x20job')[_0x5a7c0d(0x137)](),await this[_0x5a7c0d(0x108)]()[_0x5a7c0d(0x124)](_0x406093=>this[_0x5a7c0d(0x100)](_0x406093));}catch(_0x2ace0d){this['commitData']=undefined,this[_0x5a7c0d(0x11c)][_0x5a7c0d(0x11a)](_0x2ace0d);throw _0x2ace0d;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1[a181_0x6f93bd(0x135)]({'transient':!![]}),__metadata(a181_0x6f93bd(0x151),[salesforce_service_1[a181_0x6f93bd(0x127)],commit_components_job_1[a181_0x6f93bd(0x119)],salesforce_sync_service_1[a181_0x6f93bd(0x129)],git_provider_manager_1[a181_0x6f93bd(0x148)]])],FlosumCommitJob),exports[a181_0x6f93bd(0xff)]=FlosumCommitJob;function a181_0x163b(){const _0x380e06=['toUpperCase','retrieveAttachment','function','10XfHYGt','[ERROR]\x20','CommitComponentsJob','error','split','logger','message','getOwnPropertyDescriptor','typedi','branch','deleteAttachmentId','run','getPrefix','catch','map','getBranchRecord','SalesforceService','updateRemoteState','SalesforceSyncService','repo','syncRepositoryId','log','constructor','sfLogger','then','setStatus','getRepositoryRecord','metadata','repository','3584896EeBpOZ','Service','updateLastCommit','send','salesforceSync','181294DhSywI','__metadata','commitJob','BadRequestError','fetchRepositoryData','convertToSFDX','salesforceService','(((.+)+)+)+$','getLoggerId','1176128zUUUqD','getComponentsToWrite','syncBranchId','trim','536100ohRRyi','__esModule','GitProviderManager','search',']\x20[Repository:\x20','sha','name','components','repoService','39720Tcbkqh','deleteAttachment','design:paramtypes','commitData','1085CJhfOX','33uvqWDm','SalesforceLogger2','length','../../salesforce/services/salesforce-retriever.service','../../salesforce/services/salesforce.service','gitManager','toString','25353890LpPGCB','getCommitDto','defineProperty','branchName','./commit-components.job','apply','getOne','../../../constants/errors','user','FlosumCommitJob','handleCommitJobError','5674365lpPbNc','../../shared/git-provider.manager','object','[FLOSUM\x20->\x20GIT]\x20[','decorate','__decorate','ERR_UNKNOWN_SYNC_RECORD_ID','exec',']\x20[Branch:\x20','../../salesforce/services/salesforce-sync.service','provider','repositoryName','../../../core/errors/bad-request.error','getComponentsToDelete','getRepoService','SalesforceRetrieverService','repositoryData','branches','commitAttachmentId'];a181_0x163b=function(){return _0x380e06;};return a181_0x163b();}