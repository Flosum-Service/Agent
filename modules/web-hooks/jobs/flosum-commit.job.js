const a182_0x1da183=a182_0x2d0b;(function(_0x43818,_0x451f6b){const _0x453f1b=a182_0x2d0b,_0x12580d=_0x43818();while(!![]){try{const _0x3af40a=parseInt(_0x453f1b(0x229))/0x1+parseInt(_0x453f1b(0x1fc))/0x2*(-parseInt(_0x453f1b(0x246))/0x3)+parseInt(_0x453f1b(0x23c))/0x4+parseInt(_0x453f1b(0x244))/0x5*(-parseInt(_0x453f1b(0x21b))/0x6)+parseInt(_0x453f1b(0x239))/0x7+-parseInt(_0x453f1b(0x213))/0x8+parseInt(_0x453f1b(0x20b))/0x9;if(_0x3af40a===_0x451f6b)break;else _0x12580d['push'](_0x12580d['shift']());}catch(_0x23278d){_0x12580d['push'](_0x12580d['shift']());}}}(a182_0x143d,0x7ed3c));function a182_0x143d(){const _0x2e623f=['object','constructor','repoService','__esModule','SalesforceSyncService','CommitComponentsJob','[ERROR]\x20','30750AsBRPr','__metadata','18yBOxxM','syncBranchId','getComponentsToWrite','getOwnPropertyDescriptor','logger','error','getComponentsToDelete','message','log','BadRequestError','syncRepositoryId','exec','design:paramtypes','provider','SalesforceService','handleCommitJobError','SalesforceLogger2','../../../core/errors/bad-request.error','send','./commit-components.job','salesforceSync','repositoryData','SalesforceRetrieverService','[INFO]\x20Update\x20remote\x20state.','map','185482jSPfXL','../../salesforce/services/salesforce-sync.service','split','components','FlosumCommitJob','run','ERR_INVALID_SYNC_RECORD_ID','FLOSUM_ATTACHMENT','gitManager','(((.+)+)+)+$','function','name','catch','Logger','branches','17009406CMfMJZ','patchObject','all','../dto/commit-components.dto','deleteAttachment','updateLastCommit','commitAttachmentId','commitJob','7519592bAlhfa','retrieveAttachment','sfLogger','convertToSFDX','toString','[INFO]\x20Start\x20commit\x20job',']\x20[Repository:\x20','getRepositoryRecord','612Ulfghs','apply','In\x20Progress','decorate','getLoggerId','updateRemoteState','length','getPrefix','sha','salesforceService','../../shared/git-provider.manager','deleteAttachmentId','repositoryName','../../../core','219416yFqVhV','gitUrl','defineProperty','then','getOne','metadata','Error','__decorate','branchName','default','repo','Completed','getCommitDto','commitData','setStatus','repository','3480834RuiErK','../../../constants','fetchRepositoryData','146268uIxdoQ'];a182_0x143d=function(){return _0x2e623f;};return a182_0x143d();}const a182_0x415c8d=(function(){let _0x1afa93=!![];return function(_0x4b59a9,_0x1df9db){const _0x2260db=_0x1afa93?function(){const _0x4a1ad0=a182_0x2d0b;if(_0x1df9db){const _0x163386=_0x1df9db[_0x4a1ad0(0x21c)](_0x4b59a9,arguments);return _0x1df9db=null,_0x163386;}}:function(){};return _0x1afa93=![],_0x2260db;};}()),a182_0x4c69c3=a182_0x415c8d(this,function(){const _0x22259e=a182_0x2d0b;return a182_0x4c69c3['toString']()['search'](_0x22259e(0x205))[_0x22259e(0x217)]()[_0x22259e(0x23e)](a182_0x4c69c3)['search']('(((.+)+)+)+$');});a182_0x4c69c3();'use strict';var __decorate=this&&this[a182_0x1da183(0x230)]||function(_0x3d3c3d,_0x4cb3ff,_0x2120c7,_0x3d74a3){const _0x4dec2b=a182_0x1da183;var _0x31d50d=arguments['length'],_0x3134a1=_0x31d50d<0x3?_0x4cb3ff:_0x3d74a3===null?_0x3d74a3=Object[_0x4dec2b(0x1e6)](_0x4cb3ff,_0x2120c7):_0x3d74a3,_0x579503;if(typeof Reflect===_0x4dec2b(0x23d)&&typeof Reflect[_0x4dec2b(0x21e)]===_0x4dec2b(0x206))_0x3134a1=Reflect[_0x4dec2b(0x21e)](_0x3d3c3d,_0x4cb3ff,_0x2120c7,_0x3d74a3);else{for(var _0x2e9c1b=_0x3d3c3d[_0x4dec2b(0x221)]-0x1;_0x2e9c1b>=0x0;_0x2e9c1b--)if(_0x579503=_0x3d3c3d[_0x2e9c1b])_0x3134a1=(_0x31d50d<0x3?_0x579503(_0x3134a1):_0x31d50d>0x3?_0x579503(_0x4cb3ff,_0x2120c7,_0x3134a1):_0x579503(_0x4cb3ff,_0x2120c7))||_0x3134a1;}return _0x31d50d>0x3&&_0x3134a1&&Object['defineProperty'](_0x4cb3ff,_0x2120c7,_0x3134a1),_0x3134a1;},__metadata=this&&this[a182_0x1da183(0x245)]||function(_0xfed465,_0x161475){const _0x9691cf=a182_0x1da183;if(typeof Reflect===_0x9691cf(0x23d)&&typeof Reflect[_0x9691cf(0x22e)]===_0x9691cf(0x206))return Reflect[_0x9691cf(0x22e)](_0xfed465,_0x161475);},__importDefault=this&&this['__importDefault']||function(_0x35e9e3){const _0x5c5270=a182_0x1da183;return _0x35e9e3&&_0x35e9e3[_0x5c5270(0x240)]?_0x35e9e3:{'default':_0x35e9e3};},FlosumCommitJob_1;Object[a182_0x1da183(0x22b)](exports,'__esModule',{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a182_0x1da183(0x228)),salesforce_logger_v2_service_1=require('../../salesforce/services/salesforce-logger-v2.service'),salesforce_service_1=require('../../salesforce/services/salesforce.service'),git_provider_manager_1=require(a182_0x1da183(0x225)),typedi_1=require('typedi'),errors_1=require('../../../constants/errors'),bad_request_error_1=require(a182_0x1da183(0x1f4)),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require(a182_0x1da183(0x1fd)),commit_components_dto_1=require(a182_0x1da183(0x20e)),commit_components_job_1=require(a182_0x1da183(0x1f6)),constants_1=require(a182_0x1da183(0x23a)),shortid_1=__importDefault(require('shortid'));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x52780c,_0x283c8e,_0x1ba6cd,_0x221d39){const _0x11381d=a182_0x1da183;this[_0x11381d(0x224)]=_0x52780c,this[_0x11381d(0x212)]=_0x283c8e,this[_0x11381d(0x1f7)]=_0x1ba6cd,this['gitManager']=_0x221d39,this[_0x11381d(0x23f)]=this[_0x11381d(0x204)]['getRepoService'](),this[_0x11381d(0x1e7)]=new core_1[(_0x11381d(0x209))](FlosumCommitJob_1[_0x11381d(0x207)]);}async['fetchRepositoryData'](){const _0x14f8fc=a182_0x1da183;try{if(this['commitData'][_0x14f8fc(0x1ed)])this['repositoryData']=await this['salesforceSync'][_0x14f8fc(0x21a)](this[_0x14f8fc(0x236)][_0x14f8fc(0x1ed)]);else this[_0x14f8fc(0x236)][_0x14f8fc(0x247)]&&(this[_0x14f8fc(0x1f8)]=await this['salesforceSync']['getBranchRecord'](this[_0x14f8fc(0x236)][_0x14f8fc(0x247)]));}catch(_0x200756){throw new bad_request_error_1[(_0x14f8fc(0x1ec))](errors_1[_0x14f8fc(0x202)]);}}async[a182_0x1da183(0x1e5)](){const _0x5dcaaf=a182_0x1da183;if(!this[_0x5dcaaf(0x236)]['commitAttachmentId'])return[];await this[_0x5dcaaf(0x224)][_0x5dcaaf(0x20c)](constants_1[_0x5dcaaf(0x203)],this[_0x5dcaaf(0x236)]['commitAttachmentId'],{'Name':shortid_1['default']()});const _0x52bef9=await this['salesforceService'][_0x5dcaaf(0x214)](this[_0x5dcaaf(0x236)][_0x5dcaaf(0x211)])[_0x5dcaaf(0x22c)](_0x14cc79=>_0x14cc79[_0x5dcaaf(0x1fe)]('\x20')[_0x5dcaaf(0x1fb)](_0xd8dcc1=>_0xd8dcc1['trim']()));await this[_0x5dcaaf(0x224)]['deleteAttachment'](this[_0x5dcaaf(0x236)][_0x5dcaaf(0x211)]);const _0x1bbd6c=new salesforce_retriever_service_1[(_0x5dcaaf(0x1f9))](this[_0x5dcaaf(0x224)]);return await _0x1bbd6c[_0x5dcaaf(0x201)](_0x52bef9);}async[a182_0x1da183(0x1e9)](){const _0x55796a=a182_0x1da183;if(!this[_0x55796a(0x236)][_0x55796a(0x226)])return[];await this[_0x55796a(0x224)][_0x55796a(0x20c)](constants_1[_0x55796a(0x203)],this[_0x55796a(0x236)][_0x55796a(0x226)],{'Name':shortid_1[_0x55796a(0x232)]()});const _0x515572=await this[_0x55796a(0x224)][_0x55796a(0x214)](this[_0x55796a(0x236)][_0x55796a(0x226)]);return await this['salesforceService'][_0x55796a(0x20f)](this[_0x55796a(0x236)][_0x55796a(0x226)]),_0x515572;}async[a182_0x1da183(0x235)](){const _0x2ef589=a182_0x1da183,_0x445858=new commit_components_dto_1['CommitComponentsDto'](),[_0x55c13c,_0xfde30e]=await Promise[_0x2ef589(0x20d)]([this['getComponentsToWrite'](),this[_0x2ef589(0x1e9)]()]);return _0x445858[_0x2ef589(0x1ea)]=this['commitData'][_0x2ef589(0x1ea)],_0x445858['user']=this[_0x2ef589(0x236)]['user'],_0x445858[_0x2ef589(0x1ff)]={'writed':_0x55c13c,'deleted':_0xfde30e},_0x445858['convertToSFDX']=this['commitData'][_0x2ef589(0x216)],_0x445858[_0x2ef589(0x233)]=this['repository'],_0x445858['branch']=this['branch'],_0x445858[_0x2ef589(0x1f0)]=this[_0x2ef589(0x1f0)],_0x445858;}async[a182_0x1da183(0x210)](_0x423542=![]){const _0x33583d=a182_0x1da183;if(_0x423542)await this[_0x33583d(0x1f7)][_0x33583d(0x220)](this[_0x33583d(0x1f8)],{});else{const _0x259874=await this[_0x33583d(0x238)][_0x33583d(0x20a)][_0x33583d(0x22d)](this['branch'][_0x33583d(0x207)]);this[_0x33583d(0x215)][_0x33583d(0x1eb)](_0x33583d(0x1fa));const _0x4d3c9d={[this[_0x33583d(0x238)][_0x33583d(0x22a)]]:{'lastCommit':_0x259874[_0x33583d(0x223)]}};await this[_0x33583d(0x1f7)]['updateRemoteState'](this['repositoryData'],_0x4d3c9d);}}async['exec'](){const _0x53811d=a182_0x1da183,_0x2c30af=await this[_0x53811d(0x235)]();await this[_0x53811d(0x1f7)][_0x53811d(0x237)](this[_0x53811d(0x1f8)],_0x53811d(0x21d)),await this['commitJob'][_0x53811d(0x201)](_0x2c30af,this['sfLogger']),await this['updateLastCommit'](),await this[_0x53811d(0x1f7)][_0x53811d(0x237)](this['repositoryData'],_0x53811d(0x234));}async[a182_0x1da183(0x1f2)](_0x22cd9d){const _0x5eaa7e=a182_0x1da183;try{this[_0x5eaa7e(0x215)][_0x5eaa7e(0x1eb)](_0x5eaa7e(0x243)+_0x22cd9d),await this[_0x5eaa7e(0x215)][_0x5eaa7e(0x1f5)](),await this[_0x5eaa7e(0x210)](!![]),await this[_0x5eaa7e(0x1f7)][_0x5eaa7e(0x237)](this[_0x5eaa7e(0x1f8)],_0x5eaa7e(0x22f));}catch(_0x362114){this[_0x5eaa7e(0x1e7)][_0x5eaa7e(0x1e8)](_0x362114);}}async[a182_0x1da183(0x201)](_0xe15d6f,_0x2a5397,_0x5ba5b4){const _0x17f100=a182_0x1da183;try{this[_0x17f100(0x236)]=_0xe15d6f,this[_0x17f100(0x1f0)]=_0x5ba5b4,await this[_0x17f100(0x23b)](),this[_0x17f100(0x238)]=await this[_0x17f100(0x23f)][_0x17f100(0x22d)](this[_0x17f100(0x1f8)][_0x17f100(0x227)]),this['branch']=await this[_0x17f100(0x238)][_0x17f100(0x20a)]['getOne'](this[_0x17f100(0x1f8)][_0x17f100(0x231)]),this[_0x17f100(0x215)]=new salesforce_logger_v2_service_1[(_0x17f100(0x1f3))](_0x2a5397[_0x17f100(0x21f)](),(_0x2a5397[_0x17f100(0x222)]()||'[FLOSUM\x20->\x20GIT]\x20['+_0x5ba5b4['toUpperCase']()+_0x17f100(0x219)+this[_0x17f100(0x1f8)][_0x17f100(0x227)]+']\x20[Branch:\x20'+this[_0x17f100(0x1f8)][_0x17f100(0x231)]+']')+'\x20['+FlosumCommitJob_1[_0x17f100(0x207)]+']');if(!this[_0x17f100(0x1f8)])throw new bad_request_error_1[(_0x17f100(0x1ec))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x17f100(0x215)][_0x17f100(0x1eb)](_0x17f100(0x218))['send'](),await this[_0x17f100(0x1ee)]()[_0x17f100(0x208)](_0x2e5dba=>this[_0x17f100(0x1f2)](_0x2e5dba));}catch(_0x468556){this[_0x17f100(0x236)]=undefined,this[_0x17f100(0x1e7)][_0x17f100(0x1e8)](_0x468556);throw _0x468556;}}};function a182_0x2d0b(_0x5ca153,_0xcd97e5){const _0x4f0527=a182_0x143d();return a182_0x2d0b=function(_0x4c69c3,_0x415c8d){_0x4c69c3=_0x4c69c3-0x1e5;let _0x143db6=_0x4f0527[_0x4c69c3];return _0x143db6;},a182_0x2d0b(_0x5ca153,_0xcd97e5);}FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a182_0x1da183(0x1ef),[salesforce_service_1[a182_0x1da183(0x1f1)],commit_components_job_1[a182_0x1da183(0x242)],salesforce_sync_service_1[a182_0x1da183(0x241)],git_provider_manager_1['GitProviderManager']])],FlosumCommitJob),exports[a182_0x1da183(0x200)]=FlosumCommitJob;