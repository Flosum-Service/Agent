const a182_0x1b8693=a182_0x440f;(function(_0x453edb,_0x340da8){const _0x19e338=a182_0x440f,_0x10c26d=_0x453edb();while(!![]){try{const _0x2a4f64=parseInt(_0x19e338(0x16a))/0x1*(parseInt(_0x19e338(0x17b))/0x2)+-parseInt(_0x19e338(0x16b))/0x3+parseInt(_0x19e338(0x175))/0x4+-parseInt(_0x19e338(0x199))/0x5*(-parseInt(_0x19e338(0x14d))/0x6)+-parseInt(_0x19e338(0x165))/0x7+-parseInt(_0x19e338(0x156))/0x8*(-parseInt(_0x19e338(0x172))/0x9)+-parseInt(_0x19e338(0x15e))/0xa;if(_0x2a4f64===_0x340da8)break;else _0x10c26d['push'](_0x10c26d['shift']());}catch(_0x113c6d){_0x10c26d['push'](_0x10c26d['shift']());}}}(a182_0x5ccd,0xb23d4));const a182_0x4eec28=(function(){let _0x467be1=!![];return function(_0x425718,_0x540b38){const _0x4151f8=_0x467be1?function(){if(_0x540b38){const _0x3b508=_0x540b38['apply'](_0x425718,arguments);return _0x540b38=null,_0x3b508;}}:function(){};return _0x467be1=![],_0x4151f8;};}()),a182_0x161fcc=a182_0x4eec28(this,function(){const _0xc9e1a0=a182_0x440f;return a182_0x161fcc[_0xc9e1a0(0x196)]()[_0xc9e1a0(0x170)](_0xc9e1a0(0x18e))[_0xc9e1a0(0x196)]()[_0xc9e1a0(0x19e)](a182_0x161fcc)[_0xc9e1a0(0x170)](_0xc9e1a0(0x18e));});a182_0x161fcc();'use strict';function a182_0x440f(_0x28f244,_0x3ba913){const _0x18aa5d=a182_0x5ccd();return a182_0x440f=function(_0x161fcc,_0x4eec28){_0x161fcc=_0x161fcc-0x14b;let _0x5ccdf1=_0x18aa5d[_0x161fcc];return _0x5ccdf1;},a182_0x440f(_0x28f244,_0x3ba913);}var __decorate=this&&this['__decorate']||function(_0x566515,_0x21fad9,_0x3d72e0,_0x213eea){const _0x4b06b8=a182_0x440f;var _0x415c58=arguments[_0x4b06b8(0x16d)],_0x1364f9=_0x415c58<0x3?_0x21fad9:_0x213eea===null?_0x213eea=Object[_0x4b06b8(0x17c)](_0x21fad9,_0x3d72e0):_0x213eea,_0x38f4db;if(typeof Reflect===_0x4b06b8(0x1a6)&&typeof Reflect[_0x4b06b8(0x14c)]===_0x4b06b8(0x197))_0x1364f9=Reflect['decorate'](_0x566515,_0x21fad9,_0x3d72e0,_0x213eea);else{for(var _0x3bfd24=_0x566515[_0x4b06b8(0x16d)]-0x1;_0x3bfd24>=0x0;_0x3bfd24--)if(_0x38f4db=_0x566515[_0x3bfd24])_0x1364f9=(_0x415c58<0x3?_0x38f4db(_0x1364f9):_0x415c58>0x3?_0x38f4db(_0x21fad9,_0x3d72e0,_0x1364f9):_0x38f4db(_0x21fad9,_0x3d72e0))||_0x1364f9;}return _0x415c58>0x3&&_0x1364f9&&Object[_0x4b06b8(0x1a3)](_0x21fad9,_0x3d72e0,_0x1364f9),_0x1364f9;},__metadata=this&&this[a182_0x1b8693(0x166)]||function(_0x17a80c,_0x3cc2c2){const _0xcf0e90=a182_0x1b8693;if(typeof Reflect===_0xcf0e90(0x1a6)&&typeof Reflect['metadata']===_0xcf0e90(0x197))return Reflect[_0xcf0e90(0x17f)](_0x17a80c,_0x3cc2c2);},FlosumCommitJob_1;Object[a182_0x1b8693(0x1a3)](exports,a182_0x1b8693(0x15b),{'value':!![]}),exports[a182_0x1b8693(0x19d)]=void 0x0;function a182_0x5ccd(){const _0x54f018=['../../salesforce/services/salesforce.service','logger','[ERROR]\x20','repositoryData','getOne','../../salesforce/services/salesforce-retriever.service','gitManager','syncBranchId','retrieveAttachment','getComponentsToWrite','deleteAttachmentId','SalesforceLogger2','(((.+)+)+)+$','getRepositoryRecord','getComponentsToDelete','getCommitDto','user','Error','Completed','design:paramtypes','toString','function','[FLOSUM\x20->\x20GIT]\x20[','38270JaHJgA','CommitComponentsJob','deleteAttachment','getBranchRecord','FlosumCommitJob','constructor','getRepoService','branch','split','../../shared/git-provider.manager','defineProperty','map','salesforceService','object','fetchRepositoryData','In\x20Progress','handleCommitJobError','log','decorate','696ugggnf','repositoryName',']\x20[Branch:\x20','getLoggerId','CommitComponentsDto','sha','name','send','components','2232616DFdnvi','ERR_UNKNOWN_SYNC_RECORD_ID','SalesforceService','exec','convertToSFDX','__esModule','run','provider','8389920HVeRjo','BadRequestError','[INFO]\x20Update\x20remote\x20state.','commitData','../dto/commit-components.dto','./commit-components.job','setStatus','9474115idCxQm','__metadata','commitJob','all','../../salesforce/services/salesforce-logger-v2.service','180002NdpDOt','520590tLrrsY','commitAttachmentId','length','message','salesforceSync','search','updateLastCommit','36UmWWvy','trim','sfLogger','2927436ydOawL','gitUrl','error','repository','branchName','GitProviderManager','4kHepSq','getOwnPropertyDescriptor','SalesforceSyncService','[INFO]\x20Start\x20commit\x20job','metadata','catch','typedi'];a182_0x5ccd=function(){return _0x54f018;};return a182_0x5ccd();}const core_1=require('../../../core'),salesforce_logger_v2_service_1=require(a182_0x1b8693(0x169)),salesforce_service_1=require(a182_0x1b8693(0x182)),git_provider_manager_1=require(a182_0x1b8693(0x1a2)),typedi_1=require(a182_0x1b8693(0x181)),errors_1=require('../../../constants/errors'),bad_request_error_1=require('../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a182_0x1b8693(0x187)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a182_0x1b8693(0x162)),commit_components_job_1=require(a182_0x1b8693(0x163));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x1d8cb2,_0x66784a,_0x1c60d6,_0x320c06){const _0x51554e=a182_0x1b8693;this[_0x51554e(0x1a5)]=_0x1d8cb2,this['commitJob']=_0x66784a,this[_0x51554e(0x16f)]=_0x1c60d6,this[_0x51554e(0x188)]=_0x320c06,this['repoService']=this[_0x51554e(0x188)][_0x51554e(0x19f)](),this[_0x51554e(0x183)]=new core_1['Logger'](FlosumCommitJob_1[_0x51554e(0x153)]);}async[a182_0x1b8693(0x1a7)](){const _0x9ffd4a=a182_0x1b8693;try{if(this[_0x9ffd4a(0x161)]['syncRepositoryId'])this[_0x9ffd4a(0x185)]=await this[_0x9ffd4a(0x16f)][_0x9ffd4a(0x18f)](this[_0x9ffd4a(0x161)]['syncRepositoryId']);else this['commitData'][_0x9ffd4a(0x189)]&&(this[_0x9ffd4a(0x185)]=await this[_0x9ffd4a(0x16f)][_0x9ffd4a(0x19c)](this[_0x9ffd4a(0x161)][_0x9ffd4a(0x189)]));}catch(_0x34988a){throw new bad_request_error_1[(_0x9ffd4a(0x15f))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a182_0x1b8693(0x18b)](){const _0x461a94=a182_0x1b8693;if(!this['commitData']['commitAttachmentId'])return[];const _0x32252d=await this['salesforceService'][_0x461a94(0x18a)](this[_0x461a94(0x161)][_0x461a94(0x16c)])['then'](_0x4a7750=>_0x4a7750[_0x461a94(0x1a1)]('\x20')[_0x461a94(0x1a4)](_0x1f40c5=>_0x1f40c5[_0x461a94(0x173)]())),_0x135aa3=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x461a94(0x1a5)]),_0x483689=await _0x135aa3[_0x461a94(0x15c)](_0x32252d);return _0x483689;}async[a182_0x1b8693(0x190)](){const _0x5999a7=a182_0x1b8693;if(!this[_0x5999a7(0x161)][_0x5999a7(0x18c)])return[];const _0xc5082d=await this[_0x5999a7(0x1a5)]['retrieveAttachment'](this['commitData'][_0x5999a7(0x18c)]);return _0xc5082d;}async['getCommitDto'](){const _0x4a4c74=a182_0x1b8693,_0x1ff314=new commit_components_dto_1[(_0x4a4c74(0x151))](),[_0x590e10,_0x2f8bfa]=await Promise[_0x4a4c74(0x168)]([this[_0x4a4c74(0x18b)](),this['getComponentsToDelete']()]);return _0x1ff314[_0x4a4c74(0x16e)]=this[_0x4a4c74(0x161)][_0x4a4c74(0x16e)],_0x1ff314[_0x4a4c74(0x192)]=this['commitData'][_0x4a4c74(0x192)],_0x1ff314[_0x4a4c74(0x155)]={'writed':_0x590e10,'deleted':_0x2f8bfa},_0x1ff314[_0x4a4c74(0x15a)]=this['commitData'][_0x4a4c74(0x15a)],_0x1ff314['repo']=this[_0x4a4c74(0x178)],_0x1ff314[_0x4a4c74(0x1a0)]=this['branch'],_0x1ff314[_0x4a4c74(0x15d)]=this['provider'],_0x1ff314;}async[a182_0x1b8693(0x171)](_0x242535=![]){const _0x267373=a182_0x1b8693;if(_0x242535)await this[_0x267373(0x16f)]['updateRemoteState'](this[_0x267373(0x185)],{});else{const _0x56c622=await this[_0x267373(0x178)]['branches']['getOne'](this[_0x267373(0x1a0)][_0x267373(0x153)]);this[_0x267373(0x174)][_0x267373(0x14b)](_0x267373(0x160));const _0x3b0031={[this[_0x267373(0x178)][_0x267373(0x176)]]:{'lastCommit':_0x56c622[_0x267373(0x152)]}};await this[_0x267373(0x16f)]['updateRemoteState'](this['repositoryData'],_0x3b0031);}}async[a182_0x1b8693(0x159)](){const _0x5d0bd8=a182_0x1b8693,_0xf17b25=await this[_0x5d0bd8(0x191)]();await this['salesforceSync']['setStatus'](this['repositoryData'],_0x5d0bd8(0x1a8)),await this[_0x5d0bd8(0x167)][_0x5d0bd8(0x15c)](_0xf17b25,this[_0x5d0bd8(0x174)]),await this[_0x5d0bd8(0x171)](),this[_0x5d0bd8(0x161)]['commitAttachmentId']&&await this[_0x5d0bd8(0x1a5)][_0x5d0bd8(0x19b)](this['commitData'][_0x5d0bd8(0x16c)]),this['commitData'][_0x5d0bd8(0x18c)]&&await this['salesforceService'][_0x5d0bd8(0x19b)](this[_0x5d0bd8(0x161)][_0x5d0bd8(0x18c)]),await this[_0x5d0bd8(0x16f)][_0x5d0bd8(0x164)](this[_0x5d0bd8(0x185)],_0x5d0bd8(0x194));}async[a182_0x1b8693(0x1a9)](_0x177dc0){const _0x1d4fab=a182_0x1b8693;try{this[_0x1d4fab(0x174)]['log'](_0x1d4fab(0x184)+_0x177dc0),await this[_0x1d4fab(0x174)]['send'](),await this[_0x1d4fab(0x171)](!![]),await this[_0x1d4fab(0x16f)][_0x1d4fab(0x164)](this[_0x1d4fab(0x185)],_0x1d4fab(0x193));}catch(_0xd8a005){this[_0x1d4fab(0x183)][_0x1d4fab(0x177)](_0xd8a005);}}async['run'](_0x1c7858,_0x166cf9,_0x479c0a){const _0x100cc8=a182_0x1b8693;try{this[_0x100cc8(0x161)]=_0x1c7858,this[_0x100cc8(0x15d)]=_0x479c0a,await this[_0x100cc8(0x1a7)](),this[_0x100cc8(0x178)]=await this['repoService'][_0x100cc8(0x186)](this['repositoryData'][_0x100cc8(0x14e)]),this[_0x100cc8(0x1a0)]=await this['repository']['branches'][_0x100cc8(0x186)](this[_0x100cc8(0x185)][_0x100cc8(0x179)]),this[_0x100cc8(0x174)]=new salesforce_logger_v2_service_1[(_0x100cc8(0x18d))](_0x166cf9[_0x100cc8(0x150)](),(_0x166cf9['getPrefix']()||_0x100cc8(0x198)+_0x479c0a['toUpperCase']()+']\x20[Repository:\x20'+this[_0x100cc8(0x185)]['repositoryName']+_0x100cc8(0x14f)+this[_0x100cc8(0x185)][_0x100cc8(0x179)]+']')+'\x20['+FlosumCommitJob_1[_0x100cc8(0x153)]+']');if(!this['repositoryData'])throw new bad_request_error_1[(_0x100cc8(0x15f))](errors_1[_0x100cc8(0x157)]);await this[_0x100cc8(0x174)][_0x100cc8(0x14b)](_0x100cc8(0x17e))[_0x100cc8(0x154)](),await this[_0x100cc8(0x159)]()[_0x100cc8(0x180)](_0xa8781c=>this['handleCommitJobError'](_0xa8781c));}catch(_0x433845){this['commitData']=undefined,this['logger'][_0x100cc8(0x177)](_0x433845);throw _0x433845;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a182_0x1b8693(0x195),[salesforce_service_1[a182_0x1b8693(0x158)],commit_components_job_1[a182_0x1b8693(0x19a)],salesforce_sync_service_1[a182_0x1b8693(0x17d)],git_provider_manager_1[a182_0x1b8693(0x17a)]])],FlosumCommitJob),exports[a182_0x1b8693(0x19d)]=FlosumCommitJob;