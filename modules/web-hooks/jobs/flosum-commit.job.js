const a181_0x57ff6e=a181_0x4877;(function(_0x3c8063,_0x3e5721){const _0x127bef=a181_0x4877,_0x2f6956=_0x3c8063();while(!![]){try{const _0x2ce330=-parseInt(_0x127bef(0x186))/0x1*(parseInt(_0x127bef(0x13c))/0x2)+-parseInt(_0x127bef(0x151))/0x3+-parseInt(_0x127bef(0x15a))/0x4+-parseInt(_0x127bef(0x185))/0x5+parseInt(_0x127bef(0x12c))/0x6+parseInt(_0x127bef(0x158))/0x7*(parseInt(_0x127bef(0x163))/0x8)+parseInt(_0x127bef(0x18a))/0x9;if(_0x2ce330===_0x3e5721)break;else _0x2f6956['push'](_0x2f6956['shift']());}catch(_0x39636f){_0x2f6956['push'](_0x2f6956['shift']());}}}(a181_0x212c,0x9214f));const a181_0x2b8340=(function(){let _0x181e78=!![];return function(_0xaa200e,_0x43d4fc){const _0x35950c=_0x181e78?function(){const _0x27208b=a181_0x4877;if(_0x43d4fc){const _0x235d08=_0x43d4fc[_0x27208b(0x130)](_0xaa200e,arguments);return _0x43d4fc=null,_0x235d08;}}:function(){};return _0x181e78=![],_0x35950c;};}()),a181_0x388d73=a181_0x2b8340(this,function(){const _0x18707d=a181_0x4877;return a181_0x388d73['toString']()['search']('(((.+)+)+)+$')[_0x18707d(0x159)]()['constructor'](a181_0x388d73)[_0x18707d(0x153)](_0x18707d(0x13f));});a181_0x388d73();function a181_0x212c(){const _0x21070f=['toString','2563056XCKogC','getComponentsToDelete','user','commitData','getOwnPropertyDescriptor','retrieveAttachment','getComponentsToWrite','getBranchRecord','branches','4382384stVFVy','../../shared/git-provider.manager','syncRepositoryId','then','metadata','repository','convertToSFDX','SalesforceRetrieverService','all','ERR_INVALID_SYNC_RECORD_ID','setStatus','send','log','repositoryData','getRepoService','deleteAttachmentId','updateRemoteState','updateLastCommit','provider','[INFO]\x20Start\x20commit\x20job','[INFO]\x20Update\x20remote\x20state.','In\x20Progress','typedi','CommitComponentsDto','repositoryName','repo','sfLogger','getPrefix','sha','../../../core','map','ERR_UNKNOWN_SYNC_RECORD_ID','[ERROR]\x20','branchName','96515Vinupr','719Sfbpvq','decorate','../../salesforce/services/salesforce-retriever.service','logger','13807386LMkwyp','split','../../salesforce/services/salesforce-sync.service','3086910lprAaF','handleCommitJobError','Completed','gitManager','apply','design:paramtypes','getOne',']\x20[Repository:\x20','name','CommitComponentsJob','commitAttachmentId','gitUrl','repoService','run','syncBranchId','exec','2202PJEERw','Logger','salesforceSync','(((.+)+)+)+$','FlosumCommitJob','fetchRepositoryData','deleteAttachment','GitProviderManager','components','branch','commitJob','catch',']\x20[Branch:\x20','message','getRepositoryRecord','__esModule','salesforceService','../../../core/errors/bad-request.error','getLoggerId','object','function','1639200FNPHzY','toUpperCase','search','Error','BadRequestError','getCommitDto','SalesforceService','7Osgloh'];a181_0x212c=function(){return _0x21070f;};return a181_0x212c();}'use strict';function a181_0x4877(_0x49d7f3,_0x566081){const _0x4a4f30=a181_0x212c();return a181_0x4877=function(_0x388d73,_0x2b8340){_0x388d73=_0x388d73-0x12b;let _0x212cdd=_0x4a4f30[_0x388d73];return _0x212cdd;},a181_0x4877(_0x49d7f3,_0x566081);}var __decorate=this&&this['__decorate']||function(_0x4dc4ec,_0xbf101e,_0x2d2366,_0x43397e){const _0x4fd554=a181_0x4877;var _0x103b27=arguments['length'],_0x114f65=_0x103b27<0x3?_0xbf101e:_0x43397e===null?_0x43397e=Object[_0x4fd554(0x15e)](_0xbf101e,_0x2d2366):_0x43397e,_0x352305;if(typeof Reflect===_0x4fd554(0x14f)&&typeof Reflect[_0x4fd554(0x187)]===_0x4fd554(0x150))_0x114f65=Reflect[_0x4fd554(0x187)](_0x4dc4ec,_0xbf101e,_0x2d2366,_0x43397e);else{for(var _0x4dde1e=_0x4dc4ec['length']-0x1;_0x4dde1e>=0x0;_0x4dde1e--)if(_0x352305=_0x4dc4ec[_0x4dde1e])_0x114f65=(_0x103b27<0x3?_0x352305(_0x114f65):_0x103b27>0x3?_0x352305(_0xbf101e,_0x2d2366,_0x114f65):_0x352305(_0xbf101e,_0x2d2366))||_0x114f65;}return _0x103b27>0x3&&_0x114f65&&Object['defineProperty'](_0xbf101e,_0x2d2366,_0x114f65),_0x114f65;},__metadata=this&&this['__metadata']||function(_0x534719,_0x43f72a){const _0x49fa0a=a181_0x4877;if(typeof Reflect==='object'&&typeof Reflect[_0x49fa0a(0x167)]===_0x49fa0a(0x150))return Reflect[_0x49fa0a(0x167)](_0x534719,_0x43f72a);},FlosumCommitJob_1;Object['defineProperty'](exports,a181_0x57ff6e(0x14b),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a181_0x57ff6e(0x180)),salesforce_logger_v2_service_1=require('../../salesforce/services/salesforce-logger-v2.service'),salesforce_service_1=require('../../salesforce/services/salesforce.service'),git_provider_manager_1=require(a181_0x57ff6e(0x164)),typedi_1=require(a181_0x57ff6e(0x179)),errors_1=require('../../../constants/errors'),bad_request_error_1=require(a181_0x57ff6e(0x14d)),salesforce_retriever_service_1=require(a181_0x57ff6e(0x188)),salesforce_sync_service_1=require(a181_0x57ff6e(0x12b)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require('./commit-components.job');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x42e764,_0x55bef4,_0x10aebc,_0x2a09dd){const _0x55f2dd=a181_0x57ff6e;this[_0x55f2dd(0x14c)]=_0x42e764,this[_0x55f2dd(0x146)]=_0x55bef4,this[_0x55f2dd(0x13e)]=_0x10aebc,this['gitManager']=_0x2a09dd,this['repoService']=this[_0x55f2dd(0x12f)][_0x55f2dd(0x171)](),this[_0x55f2dd(0x189)]=new core_1[(_0x55f2dd(0x13d))](FlosumCommitJob_1[_0x55f2dd(0x134)]);}async[a181_0x57ff6e(0x141)](){const _0x490cb0=a181_0x57ff6e;try{if(this[_0x490cb0(0x15d)][_0x490cb0(0x165)])this['repositoryData']=await this[_0x490cb0(0x13e)][_0x490cb0(0x14a)](this[_0x490cb0(0x15d)][_0x490cb0(0x165)]);else this[_0x490cb0(0x15d)][_0x490cb0(0x13a)]&&(this[_0x490cb0(0x170)]=await this[_0x490cb0(0x13e)][_0x490cb0(0x161)](this[_0x490cb0(0x15d)][_0x490cb0(0x13a)]));}catch(_0x1acdb0){throw new bad_request_error_1['BadRequestError'](errors_1[_0x490cb0(0x16c)]);}}async[a181_0x57ff6e(0x160)](){const _0x30f2d9=a181_0x57ff6e;if(!this['commitData'][_0x30f2d9(0x136)])return[];const _0x26788a=await this['salesforceService']['retrieveAttachment'](this[_0x30f2d9(0x15d)][_0x30f2d9(0x136)])[_0x30f2d9(0x166)](_0x1323cd=>_0x1323cd[_0x30f2d9(0x18b)]('\x20')[_0x30f2d9(0x181)](_0x363972=>_0x363972['trim']())),_0x5f4aa8=new salesforce_retriever_service_1[(_0x30f2d9(0x16a))](this['salesforceService']),_0x316897=await _0x5f4aa8[_0x30f2d9(0x139)](_0x26788a);return _0x316897;}async['getComponentsToDelete'](){const _0x5ded7b=a181_0x57ff6e;if(!this[_0x5ded7b(0x15d)]['deleteAttachmentId'])return[];const _0x4fc211=await this[_0x5ded7b(0x14c)][_0x5ded7b(0x15f)](this[_0x5ded7b(0x15d)]['deleteAttachmentId']);return _0x4fc211;}async[a181_0x57ff6e(0x156)](){const _0x4d684b=a181_0x57ff6e,_0x588176=new commit_components_dto_1[(_0x4d684b(0x17a))](),[_0x1461c0,_0x4a1b20]=await Promise[_0x4d684b(0x16b)]([this['getComponentsToWrite'](),this[_0x4d684b(0x15b)]()]);return _0x588176[_0x4d684b(0x149)]=this[_0x4d684b(0x15d)][_0x4d684b(0x149)],_0x588176[_0x4d684b(0x15c)]=this[_0x4d684b(0x15d)]['user'],_0x588176[_0x4d684b(0x144)]={'writed':_0x1461c0,'deleted':_0x4a1b20},_0x588176[_0x4d684b(0x169)]=this[_0x4d684b(0x15d)]['convertToSFDX'],_0x588176[_0x4d684b(0x17c)]=this[_0x4d684b(0x168)],_0x588176[_0x4d684b(0x145)]=this['branch'],_0x588176[_0x4d684b(0x175)]=this[_0x4d684b(0x175)],_0x588176;}async[a181_0x57ff6e(0x174)](_0x581d57=![]){const _0x40a222=a181_0x57ff6e;if(_0x581d57)await this['salesforceSync'][_0x40a222(0x173)](this[_0x40a222(0x170)],{});else{const _0x195394=await this[_0x40a222(0x168)][_0x40a222(0x162)]['getOne'](this['branch'][_0x40a222(0x134)]);this['sfLogger'][_0x40a222(0x16f)](_0x40a222(0x177));const _0x4ca5b0={[this['repository'][_0x40a222(0x137)]]:{'lastCommit':_0x195394[_0x40a222(0x17f)]}};await this['salesforceSync'][_0x40a222(0x173)](this[_0x40a222(0x170)],_0x4ca5b0);}}async[a181_0x57ff6e(0x13b)](){const _0x1469e5=a181_0x57ff6e,_0x250703=await this[_0x1469e5(0x156)]();await this[_0x1469e5(0x13e)][_0x1469e5(0x16d)](this[_0x1469e5(0x170)],_0x1469e5(0x178)),await this['commitJob'][_0x1469e5(0x139)](_0x250703,this[_0x1469e5(0x17d)]),await this['updateLastCommit'](),this['commitData']['commitAttachmentId']&&await this[_0x1469e5(0x14c)][_0x1469e5(0x142)](this[_0x1469e5(0x15d)][_0x1469e5(0x136)]),this[_0x1469e5(0x15d)][_0x1469e5(0x172)]&&await this[_0x1469e5(0x14c)][_0x1469e5(0x142)](this[_0x1469e5(0x15d)][_0x1469e5(0x172)]),await this[_0x1469e5(0x13e)]['setStatus'](this[_0x1469e5(0x170)],_0x1469e5(0x12e));}async[a181_0x57ff6e(0x12d)](_0x1e88df){const _0x167f6d=a181_0x57ff6e;try{this[_0x167f6d(0x17d)][_0x167f6d(0x16f)](_0x167f6d(0x183)+_0x1e88df),await this[_0x167f6d(0x17d)][_0x167f6d(0x16e)](),await this[_0x167f6d(0x174)](!![]),await this['salesforceSync'][_0x167f6d(0x16d)](this[_0x167f6d(0x170)],_0x167f6d(0x154));}catch(_0x2919f8){this[_0x167f6d(0x189)]['error'](_0x2919f8);}}async[a181_0x57ff6e(0x139)](_0xe65c92,_0x1de599,_0x3d2afc){const _0x462445=a181_0x57ff6e;try{this[_0x462445(0x15d)]=_0xe65c92,this[_0x462445(0x175)]=_0x3d2afc,await this['fetchRepositoryData'](),this[_0x462445(0x168)]=await this[_0x462445(0x138)][_0x462445(0x132)](this['repositoryData'][_0x462445(0x17b)]),this[_0x462445(0x145)]=await this[_0x462445(0x168)][_0x462445(0x162)][_0x462445(0x132)](this[_0x462445(0x170)][_0x462445(0x184)]),this['sfLogger']=new salesforce_logger_v2_service_1['SalesforceLogger2'](_0x1de599[_0x462445(0x14e)](),(_0x1de599[_0x462445(0x17e)]()||'[FLOSUM\x20->\x20GIT]\x20['+_0x3d2afc[_0x462445(0x152)]()+_0x462445(0x133)+this[_0x462445(0x170)][_0x462445(0x17b)]+_0x462445(0x148)+this[_0x462445(0x170)][_0x462445(0x184)]+']')+'\x20['+FlosumCommitJob_1[_0x462445(0x134)]+']');if(!this[_0x462445(0x170)])throw new bad_request_error_1[(_0x462445(0x155))](errors_1[_0x462445(0x182)]);await this[_0x462445(0x17d)]['log'](_0x462445(0x176))['send'](),await this[_0x462445(0x13b)]()[_0x462445(0x147)](_0x43cf46=>this[_0x462445(0x12d)](_0x43cf46));}catch(_0x4ea429){this[_0x462445(0x15d)]=undefined,this[_0x462445(0x189)]['error'](_0x4ea429);throw _0x4ea429;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a181_0x57ff6e(0x131),[salesforce_service_1[a181_0x57ff6e(0x157)],commit_components_job_1[a181_0x57ff6e(0x135)],salesforce_sync_service_1['SalesforceSyncService'],git_provider_manager_1[a181_0x57ff6e(0x143)]])],FlosumCommitJob),exports[a181_0x57ff6e(0x140)]=FlosumCommitJob;