const a182_0xdac99d=a182_0x27f5;(function(_0x39fe2c,_0x5ac527){const _0x4da576=a182_0x27f5,_0x43ec98=_0x39fe2c();while(!![]){try{const _0x5ef43b=parseInt(_0x4da576(0xd9))/0x1*(-parseInt(_0x4da576(0xec))/0x2)+-parseInt(_0x4da576(0x109))/0x3*(parseInt(_0x4da576(0xde))/0x4)+parseInt(_0x4da576(0x126))/0x5+-parseInt(_0x4da576(0xca))/0x6+-parseInt(_0x4da576(0xe9))/0x7*(parseInt(_0x4da576(0xd2))/0x8)+-parseInt(_0x4da576(0xf2))/0x9+parseInt(_0x4da576(0xdb))/0xa*(parseInt(_0x4da576(0x11d))/0xb);if(_0x5ef43b===_0x5ac527)break;else _0x43ec98['push'](_0x43ec98['shift']());}catch(_0x47adcc){_0x43ec98['push'](_0x43ec98['shift']());}}}(a182_0x1c1e,0x36e91));const a182_0x112cb8=(function(){let _0x4ae446=!![];return function(_0x3f3b13,_0x536ca7){const _0x586655=_0x4ae446?function(){const _0x34336c=a182_0x27f5;if(_0x536ca7){const _0x508827=_0x536ca7[_0x34336c(0xfe)](_0x3f3b13,arguments);return _0x536ca7=null,_0x508827;}}:function(){};return _0x4ae446=![],_0x586655;};}()),a182_0x18acec=a182_0x112cb8(this,function(){const _0x1d77df=a182_0x27f5;return a182_0x18acec['toString']()[_0x1d77df(0x111)](_0x1d77df(0xd6))[_0x1d77df(0xfc)]()[_0x1d77df(0x108)](a182_0x18acec)[_0x1d77df(0x111)](_0x1d77df(0xd6));});function a182_0x27f5(_0x184853,_0x10246c){const _0x5c18f7=a182_0x1c1e();return a182_0x27f5=function(_0x18acec,_0x112cb8){_0x18acec=_0x18acec-0xc6;let _0x1c1eb5=_0x5c18f7[_0x18acec];return _0x1c1eb5;},a182_0x27f5(_0x184853,_0x10246c);}a182_0x18acec();function a182_0x1c1e(){const _0x147a03=['branchName','4528799cXVYQJ','../../../constants/errors','../../salesforce/services/salesforce-logger-v2.service','message','__importDefault','__metadata','syncBranchId','Completed','commitAttachmentId','1622325CmulnF','getPrefix','branches','getRepoService','salesforceService','catch','GitProviderManager','FLOSUM_ATTACHMENT','400920VxBIGu','syncRepositoryId','typedi','SalesforceService','getOne','run','SalesforceLogger2','defineProperty','104QlzutB','handleCommitJobError','FlosumCommitJob','logger','(((.+)+)+)+$','repositoryData','commitData','301611BhEvoX','deleteAttachmentId','20TRKlPF','user','components','16AwzBpU','BadRequestError','function','log','provider','repository','branch','exec','shortid','send','repoService','157164wzAfbb','Logger','repo','2DqSGTL','repositoryName','gitManager',']\x20[Branch:\x20','retrieveAttachment','salesforceSync','878031hHIHJW','__esModule','patchObject','../../shared/git-provider.manager','getComponentsToWrite','sha','split','getCommitDto','ERR_UNKNOWN_SYNC_RECORD_ID','In\x20Progress','toString','Error','apply','../../../core','../../salesforce/services/salesforce.service','CommitComponentsDto','[INFO]\x20Update\x20remote\x20state.','length','../../salesforce/services/salesforce-retriever.service','sfLogger','convertToSFDX','../../../core/errors/bad-request.error','constructor','123828bMjyKf','Service','name','updateLastCommit','setStatus','metadata',']\x20[Repository:\x20','fetchRepositoryData','search','error','getOwnPropertyDescriptor','object','commitJob','[FLOSUM\x20->\x20GIT]\x20[','getBranchRecord','getRepositoryRecord','updateRemoteState','[ERROR]\x20','default'];a182_0x1c1e=function(){return _0x147a03;};return a182_0x1c1e();}'use strict';var __decorate=this&&this['__decorate']||function(_0xc35f61,_0x253087,_0x45335a,_0x18a5c9){const _0x404eb2=a182_0x27f5;var _0x14f55e=arguments[_0x404eb2(0x103)],_0x259341=_0x14f55e<0x3?_0x253087:_0x18a5c9===null?_0x18a5c9=Object[_0x404eb2(0x113)](_0x253087,_0x45335a):_0x18a5c9,_0x59365a;if(typeof Reflect===_0x404eb2(0x114)&&typeof Reflect['decorate']===_0x404eb2(0xe0))_0x259341=Reflect['decorate'](_0xc35f61,_0x253087,_0x45335a,_0x18a5c9);else{for(var _0x3efab8=_0xc35f61[_0x404eb2(0x103)]-0x1;_0x3efab8>=0x0;_0x3efab8--)if(_0x59365a=_0xc35f61[_0x3efab8])_0x259341=(_0x14f55e<0x3?_0x59365a(_0x259341):_0x14f55e>0x3?_0x59365a(_0x253087,_0x45335a,_0x259341):_0x59365a(_0x253087,_0x45335a))||_0x259341;}return _0x14f55e>0x3&&_0x259341&&Object['defineProperty'](_0x253087,_0x45335a,_0x259341),_0x259341;},__metadata=this&&this[a182_0xdac99d(0x122)]||function(_0x1cd5ff,_0x494bdd){const _0x6c9bf6=a182_0xdac99d;if(typeof Reflect==='object'&&typeof Reflect[_0x6c9bf6(0x10e)]===_0x6c9bf6(0xe0))return Reflect['metadata'](_0x1cd5ff,_0x494bdd);},__importDefault=this&&this[a182_0xdac99d(0x121)]||function(_0x5ab096){const _0x18bde9=a182_0xdac99d;return _0x5ab096&&_0x5ab096[_0x18bde9(0xf3)]?_0x5ab096:{'default':_0x5ab096};},FlosumCommitJob_1;Object[a182_0xdac99d(0xd1)](exports,a182_0xdac99d(0xf3),{'value':!![]}),exports[a182_0xdac99d(0xd4)]=void 0x0;const core_1=require(a182_0xdac99d(0xff)),salesforce_logger_v2_service_1=require(a182_0xdac99d(0x11f)),salesforce_service_1=require(a182_0xdac99d(0x100)),git_provider_manager_1=require(a182_0xdac99d(0xf5)),typedi_1=require(a182_0xdac99d(0xcc)),errors_1=require(a182_0xdac99d(0x11e)),bad_request_error_1=require(a182_0xdac99d(0x107)),salesforce_retriever_service_1=require(a182_0xdac99d(0x104)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require('./commit-components.job'),constants_1=require('../../../constants'),shortid_1=__importDefault(require(a182_0xdac99d(0xe6)));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x244699,_0x22e3db,_0x2238e3,_0x41241a){const _0x1ce4b9=a182_0xdac99d;this[_0x1ce4b9(0xc6)]=_0x244699,this[_0x1ce4b9(0x115)]=_0x22e3db,this[_0x1ce4b9(0xf1)]=_0x2238e3,this['gitManager']=_0x41241a,this['repoService']=this[_0x1ce4b9(0xee)][_0x1ce4b9(0x129)](),this[_0x1ce4b9(0xd5)]=new core_1[(_0x1ce4b9(0xea))](FlosumCommitJob_1['name']);}async['fetchRepositoryData'](){const _0x1d6d9f=a182_0xdac99d;try{if(this[_0x1d6d9f(0xd8)][_0x1d6d9f(0xcb)])this[_0x1d6d9f(0xd7)]=await this[_0x1d6d9f(0xf1)][_0x1d6d9f(0x118)](this['commitData'][_0x1d6d9f(0xcb)]);else this[_0x1d6d9f(0xd8)][_0x1d6d9f(0x123)]&&(this[_0x1d6d9f(0xd7)]=await this[_0x1d6d9f(0xf1)][_0x1d6d9f(0x117)](this[_0x1d6d9f(0xd8)][_0x1d6d9f(0x123)]));}catch(_0x5dc445){throw new bad_request_error_1[(_0x1d6d9f(0xdf))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a182_0xdac99d(0xf6)](){const _0x1a09f5=a182_0xdac99d;if(!this[_0x1a09f5(0xd8)][_0x1a09f5(0x125)])return[];await this[_0x1a09f5(0xc6)][_0x1a09f5(0xf4)](constants_1[_0x1a09f5(0xc9)],this[_0x1a09f5(0xd8)][_0x1a09f5(0x125)],{'Name':shortid_1[_0x1a09f5(0x11b)]()});const _0x4b5794=await this[_0x1a09f5(0xc6)][_0x1a09f5(0xf0)](this[_0x1a09f5(0xd8)][_0x1a09f5(0x125)])['then'](_0x3125c3=>_0x3125c3[_0x1a09f5(0xf8)]('\x20')['map'](_0x239139=>_0x239139['trim']()));await this[_0x1a09f5(0xc6)]['deleteAttachment'](this['commitData'][_0x1a09f5(0x125)]);const _0x53ca23=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x1a09f5(0xc6)]);return await _0x53ca23[_0x1a09f5(0xcf)](_0x4b5794);}async['getComponentsToDelete'](){const _0x4baca4=a182_0xdac99d;if(!this['commitData'][_0x4baca4(0xda)])return[];await this[_0x4baca4(0xc6)][_0x4baca4(0xf4)](constants_1[_0x4baca4(0xc9)],this['commitData']['deleteAttachmentId'],{'Name':shortid_1['default']()});const _0x37bd0f=await this[_0x4baca4(0xc6)][_0x4baca4(0xf0)](this[_0x4baca4(0xd8)][_0x4baca4(0xda)]);return await this[_0x4baca4(0xc6)]['deleteAttachment'](this[_0x4baca4(0xd8)][_0x4baca4(0xda)]),_0x37bd0f;}async[a182_0xdac99d(0xf9)](){const _0x5f388b=a182_0xdac99d,_0x5e616f=new commit_components_dto_1[(_0x5f388b(0x101))](),[_0x279665,_0x28025d]=await Promise['all']([this[_0x5f388b(0xf6)](),this['getComponentsToDelete']()]);return _0x5e616f[_0x5f388b(0x120)]=this[_0x5f388b(0xd8)]['message'],_0x5e616f[_0x5f388b(0xdc)]=this[_0x5f388b(0xd8)][_0x5f388b(0xdc)],_0x5e616f[_0x5f388b(0xdd)]={'writed':_0x279665,'deleted':_0x28025d},_0x5e616f['convertToSFDX']=this[_0x5f388b(0xd8)][_0x5f388b(0x106)],_0x5e616f[_0x5f388b(0xeb)]=this[_0x5f388b(0xe3)],_0x5e616f[_0x5f388b(0xe4)]=this[_0x5f388b(0xe4)],_0x5e616f['provider']=this[_0x5f388b(0xe2)],_0x5e616f;}async['updateLastCommit'](_0x58f0a7=![]){const _0x161430=a182_0xdac99d;if(_0x58f0a7)await this[_0x161430(0xf1)][_0x161430(0x119)](this[_0x161430(0xd7)],{});else{const _0x201057=await this['repository'][_0x161430(0x128)][_0x161430(0xce)](this['branch'][_0x161430(0x10b)]);this[_0x161430(0x105)][_0x161430(0xe1)](_0x161430(0x102));const _0x5d62c1={[this[_0x161430(0xe3)]['gitUrl']]:{'lastCommit':_0x201057[_0x161430(0xf7)]}};await this[_0x161430(0xf1)]['updateRemoteState'](this[_0x161430(0xd7)],_0x5d62c1);}}async[a182_0xdac99d(0xe5)](){const _0x33e787=a182_0xdac99d,_0x1ac779=await this[_0x33e787(0xf9)]();await this['salesforceSync'][_0x33e787(0x10d)](this['repositoryData'],_0x33e787(0xfb)),await this['commitJob']['run'](_0x1ac779,this[_0x33e787(0x105)]),await this[_0x33e787(0x10c)](),await this[_0x33e787(0xf1)]['setStatus'](this[_0x33e787(0xd7)],_0x33e787(0x124));}async[a182_0xdac99d(0xd3)](_0x57e546){const _0x2dbcf1=a182_0xdac99d;try{this[_0x2dbcf1(0x105)][_0x2dbcf1(0xe1)](_0x2dbcf1(0x11a)+_0x57e546),await this[_0x2dbcf1(0x105)]['send'](),await this['updateLastCommit'](!![]),await this[_0x2dbcf1(0xf1)]['setStatus'](this[_0x2dbcf1(0xd7)],_0x2dbcf1(0xfd));}catch(_0x33ecad){this[_0x2dbcf1(0xd5)]['error'](_0x33ecad);}}async['run'](_0x23dc44,_0x4315c9,_0x321141){const _0x52f817=a182_0xdac99d;try{this[_0x52f817(0xd8)]=_0x23dc44,this[_0x52f817(0xe2)]=_0x321141,await this[_0x52f817(0x110)](),this[_0x52f817(0xe3)]=await this[_0x52f817(0xe8)][_0x52f817(0xce)](this[_0x52f817(0xd7)][_0x52f817(0xed)]),this[_0x52f817(0xe4)]=await this['repository'][_0x52f817(0x128)]['getOne'](this[_0x52f817(0xd7)][_0x52f817(0x11c)]),this[_0x52f817(0x105)]=new salesforce_logger_v2_service_1[(_0x52f817(0xd0))](_0x4315c9['getLoggerId'](),(_0x4315c9[_0x52f817(0x127)]()||_0x52f817(0x116)+_0x321141['toUpperCase']()+_0x52f817(0x10f)+this['repositoryData']['repositoryName']+_0x52f817(0xef)+this['repositoryData']['branchName']+']')+'\x20['+FlosumCommitJob_1[_0x52f817(0x10b)]+']');if(!this[_0x52f817(0xd7)])throw new bad_request_error_1[(_0x52f817(0xdf))](errors_1[_0x52f817(0xfa)]);await this[_0x52f817(0x105)]['log']('[INFO]\x20Start\x20commit\x20job')[_0x52f817(0xe7)](),await this[_0x52f817(0xe5)]()[_0x52f817(0xc7)](_0x1c9091=>this[_0x52f817(0xd3)](_0x1c9091));}catch(_0x1aa61e){this[_0x52f817(0xd8)]=undefined,this[_0x52f817(0xd5)][_0x52f817(0x112)](_0x1aa61e);throw _0x1aa61e;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1[a182_0xdac99d(0x10a)]({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a182_0xdac99d(0xcd)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1['SalesforceSyncService'],git_provider_manager_1[a182_0xdac99d(0xc8)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;