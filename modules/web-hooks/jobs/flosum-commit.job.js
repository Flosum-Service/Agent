const a182_0x25acb3=a182_0x27d6;(function(_0x71e3c,_0x311166){const _0x205144=a182_0x27d6,_0x298561=_0x71e3c();while(!![]){try{const _0x1b44cc=-parseInt(_0x205144(0x18b))/0x1+parseInt(_0x205144(0x168))/0x2+-parseInt(_0x205144(0x181))/0x3*(-parseInt(_0x205144(0x148))/0x4)+-parseInt(_0x205144(0x127))/0x5+-parseInt(_0x205144(0x155))/0x6*(-parseInt(_0x205144(0x12a))/0x7)+parseInt(_0x205144(0x13c))/0x8+-parseInt(_0x205144(0x190))/0x9*(parseInt(_0x205144(0x171))/0xa);if(_0x1b44cc===_0x311166)break;else _0x298561['push'](_0x298561['shift']());}catch(_0x22341e){_0x298561['push'](_0x298561['shift']());}}}(a182_0x546a,0x2fa61));function a182_0x546a(){const _0x17d034=['../dto/commit-components.dto','function','typedi','syncBranchId','../../salesforce/services/salesforce-sync.service','GitProviderManager','repoService','then','../../shared/git-provider.manager','671242efrwLg','commitJob','[FLOSUM\x20->\x20GIT]\x20[','ERR_UNKNOWN_SYNC_RECORD_ID','Logger','updateLastCommit','defineProperty','length','SalesforceSyncService','10FagFIr','apply','design:paramtypes','provider','repository','getOwnPropertyDescriptor','run','[ERROR]\x20','Error','getRepositoryRecord','getLoggerId','handleCommitJobError','name','toUpperCase','sha','repositoryData','6IcKGWN','In\x20Progress','commitData','catch','setStatus','exec','branchName','../../salesforce/services/salesforce.service','../../../core/errors/bad-request.error','sfLogger','260879AYhYBU','./commit-components.job','log','commitAttachmentId','trim','5169789fViwNX','convertToSFDX','202005mBLYCu','__decorate','getBranchRecord','21ezTlor',']\x20[Repository:\x20','getComponentsToWrite','metadata','retrieveAttachment','../../salesforce/services/salesforce-retriever.service','__esModule','deleteAttachmentId','send','updateRemoteState','FlosumCommitJob','getOne','message','repo','../../../core','BadRequestError','repositoryName','constructor','2402048zUihxB','decorate','branches','branch','Service','[INFO]\x20Update\x20remote\x20state.','toString','gitUrl','SalesforceService','(((.+)+)+)+$','salesforceSync','syncRepositoryId','584608dMlFdH','user','logger','deleteAttachment','CommitComponentsDto','getComponentsToDelete','components','salesforceService','getPrefix','getCommitDto','fetchRepositoryData','../../../constants/errors','object','285378ajeCxo','[INFO]\x20Start\x20commit\x20job','ERR_INVALID_SYNC_RECORD_ID','__metadata','../../salesforce/services/salesforce-logger-v2.service','split','SalesforceRetrieverService','error','Completed','gitManager'];a182_0x546a=function(){return _0x17d034;};return a182_0x546a();}const a182_0x2b07e3=(function(){let _0x5a80b0=!![];return function(_0x54a18c,_0x241025){const _0x57a638=_0x5a80b0?function(){const _0x3e9725=a182_0x27d6;if(_0x241025){const _0x45af0a=_0x241025[_0x3e9725(0x172)](_0x54a18c,arguments);return _0x241025=null,_0x45af0a;}}:function(){};return _0x5a80b0=![],_0x57a638;};}()),a182_0x463aa6=a182_0x2b07e3(this,function(){const _0x5b4421=a182_0x27d6;return a182_0x463aa6['toString']()['search'](_0x5b4421(0x145))[_0x5b4421(0x142)]()[_0x5b4421(0x13b)](a182_0x463aa6)['search'](_0x5b4421(0x145));});function a182_0x27d6(_0x148d7c,_0x1fe2ca){const _0xbe7d=a182_0x546a();return a182_0x27d6=function(_0x463aa6,_0x2b07e3){_0x463aa6=_0x463aa6-0x127;let _0x546ac2=_0xbe7d[_0x463aa6];return _0x546ac2;},a182_0x27d6(_0x148d7c,_0x1fe2ca);}a182_0x463aa6();'use strict';var __decorate=this&&this[a182_0x25acb3(0x128)]||function(_0x1c58f4,_0x2dd056,_0x32cc11,_0xa894a7){const _0x354564=a182_0x25acb3;var _0x4401c5=arguments[_0x354564(0x16f)],_0x26cc5f=_0x4401c5<0x3?_0x2dd056:_0xa894a7===null?_0xa894a7=Object[_0x354564(0x176)](_0x2dd056,_0x32cc11):_0xa894a7,_0xcaccdf;if(typeof Reflect===_0x354564(0x154)&&typeof Reflect[_0x354564(0x13d)]===_0x354564(0x160))_0x26cc5f=Reflect['decorate'](_0x1c58f4,_0x2dd056,_0x32cc11,_0xa894a7);else{for(var _0x23100c=_0x1c58f4[_0x354564(0x16f)]-0x1;_0x23100c>=0x0;_0x23100c--)if(_0xcaccdf=_0x1c58f4[_0x23100c])_0x26cc5f=(_0x4401c5<0x3?_0xcaccdf(_0x26cc5f):_0x4401c5>0x3?_0xcaccdf(_0x2dd056,_0x32cc11,_0x26cc5f):_0xcaccdf(_0x2dd056,_0x32cc11))||_0x26cc5f;}return _0x4401c5>0x3&&_0x26cc5f&&Object[_0x354564(0x16e)](_0x2dd056,_0x32cc11,_0x26cc5f),_0x26cc5f;},__metadata=this&&this[a182_0x25acb3(0x158)]||function(_0x1da7bc,_0x391288){const _0x2b3165=a182_0x25acb3;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x2b3165(0x160))return Reflect[_0x2b3165(0x12d)](_0x1da7bc,_0x391288);},FlosumCommitJob_1;Object[a182_0x25acb3(0x16e)](exports,a182_0x25acb3(0x130),{'value':!![]}),exports[a182_0x25acb3(0x134)]=void 0x0;const core_1=require(a182_0x25acb3(0x138)),salesforce_logger_v2_service_1=require(a182_0x25acb3(0x159)),salesforce_service_1=require(a182_0x25acb3(0x188)),git_provider_manager_1=require(a182_0x25acb3(0x167)),typedi_1=require(a182_0x25acb3(0x161)),errors_1=require(a182_0x25acb3(0x153)),bad_request_error_1=require(a182_0x25acb3(0x189)),salesforce_retriever_service_1=require(a182_0x25acb3(0x12f)),salesforce_sync_service_1=require(a182_0x25acb3(0x163)),commit_components_dto_1=require(a182_0x25acb3(0x15f)),commit_components_job_1=require(a182_0x25acb3(0x18c));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x5c846e,_0x28c8e9,_0x4e829d,_0x5ba746){const _0x5eb577=a182_0x25acb3;this[_0x5eb577(0x14f)]=_0x5c846e,this[_0x5eb577(0x169)]=_0x28c8e9,this[_0x5eb577(0x146)]=_0x4e829d,this[_0x5eb577(0x15e)]=_0x5ba746,this[_0x5eb577(0x165)]=this[_0x5eb577(0x15e)]['getRepoService'](),this['logger']=new core_1[(_0x5eb577(0x16c))](FlosumCommitJob_1[_0x5eb577(0x17d)]);}async[a182_0x25acb3(0x152)](){const _0x37aeea=a182_0x25acb3;try{if(this[_0x37aeea(0x183)][_0x37aeea(0x147)])this[_0x37aeea(0x180)]=await this[_0x37aeea(0x146)][_0x37aeea(0x17a)](this['commitData'][_0x37aeea(0x147)]);else this['commitData'][_0x37aeea(0x162)]&&(this['repositoryData']=await this[_0x37aeea(0x146)][_0x37aeea(0x129)](this[_0x37aeea(0x183)][_0x37aeea(0x162)]));}catch(_0x5a5388){throw new bad_request_error_1[(_0x37aeea(0x139))](errors_1[_0x37aeea(0x157)]);}}async[a182_0x25acb3(0x12c)](){const _0x418759=a182_0x25acb3;if(!this['commitData'][_0x418759(0x18e)])return[];const _0x1392aa=await this[_0x418759(0x14f)]['retrieveAttachment'](this[_0x418759(0x183)][_0x418759(0x18e)])[_0x418759(0x166)](_0x23651e=>_0x23651e[_0x418759(0x15a)]('\x20')['map'](_0x1d1669=>_0x1d1669[_0x418759(0x18f)]())),_0x325f1d=new salesforce_retriever_service_1[(_0x418759(0x15b))](this[_0x418759(0x14f)]),_0x4977e3=await _0x325f1d['run'](_0x1392aa);return _0x4977e3;}async[a182_0x25acb3(0x14d)](){const _0x599536=a182_0x25acb3;if(!this[_0x599536(0x183)]['deleteAttachmentId'])return[];const _0x2f0d7d=await this['salesforceService'][_0x599536(0x12e)](this[_0x599536(0x183)][_0x599536(0x131)]);return _0x2f0d7d;}async[a182_0x25acb3(0x151)](){const _0x4cac90=a182_0x25acb3,_0x4be153=new commit_components_dto_1[(_0x4cac90(0x14c))](),[_0x30aefc,_0x3d9806]=await Promise['all']([this[_0x4cac90(0x12c)](),this[_0x4cac90(0x14d)]()]);return _0x4be153['message']=this[_0x4cac90(0x183)][_0x4cac90(0x136)],_0x4be153[_0x4cac90(0x149)]=this['commitData']['user'],_0x4be153[_0x4cac90(0x14e)]={'writed':_0x30aefc,'deleted':_0x3d9806},_0x4be153[_0x4cac90(0x191)]=this[_0x4cac90(0x183)][_0x4cac90(0x191)],_0x4be153[_0x4cac90(0x137)]=this['repository'],_0x4be153[_0x4cac90(0x13f)]=this['branch'],_0x4be153[_0x4cac90(0x174)]=this[_0x4cac90(0x174)],_0x4be153;}async[a182_0x25acb3(0x16d)](_0x209f83=![]){const _0x5bcacd=a182_0x25acb3;if(_0x209f83)await this[_0x5bcacd(0x146)][_0x5bcacd(0x133)](this[_0x5bcacd(0x180)],{});else{const _0x37266c=await this[_0x5bcacd(0x175)][_0x5bcacd(0x13e)]['getOne'](this[_0x5bcacd(0x13f)][_0x5bcacd(0x17d)]);this[_0x5bcacd(0x18a)][_0x5bcacd(0x18d)](_0x5bcacd(0x141));const _0x42a2b1={[this[_0x5bcacd(0x175)][_0x5bcacd(0x143)]]:{'lastCommit':_0x37266c[_0x5bcacd(0x17f)]}};await this[_0x5bcacd(0x146)][_0x5bcacd(0x133)](this[_0x5bcacd(0x180)],_0x42a2b1);}}async['exec'](){const _0x409726=a182_0x25acb3,_0x1d4397=await this['getCommitDto']();await this['salesforceSync']['setStatus'](this['repositoryData'],_0x409726(0x182)),await this[_0x409726(0x169)][_0x409726(0x177)](_0x1d4397,this[_0x409726(0x18a)]),await this[_0x409726(0x16d)](),this['commitData'][_0x409726(0x18e)]&&await this[_0x409726(0x14f)]['deleteAttachment'](this[_0x409726(0x183)][_0x409726(0x18e)]),this[_0x409726(0x183)][_0x409726(0x131)]&&await this['salesforceService'][_0x409726(0x14b)](this[_0x409726(0x183)][_0x409726(0x131)]),await this[_0x409726(0x146)][_0x409726(0x185)](this[_0x409726(0x180)],_0x409726(0x15d));}async[a182_0x25acb3(0x17c)](_0x1cdea5){const _0x5b3a43=a182_0x25acb3;try{this[_0x5b3a43(0x18a)]['log'](_0x5b3a43(0x178)+_0x1cdea5),await this[_0x5b3a43(0x18a)][_0x5b3a43(0x132)](),await this[_0x5b3a43(0x16d)](!![]),await this['salesforceSync']['setStatus'](this[_0x5b3a43(0x180)],_0x5b3a43(0x179));}catch(_0x5becf5){this['logger'][_0x5b3a43(0x15c)](_0x5becf5);}}async[a182_0x25acb3(0x177)](_0x4f4871,_0x10d24e,_0x105650){const _0x15bdaa=a182_0x25acb3;try{this[_0x15bdaa(0x183)]=_0x4f4871,this[_0x15bdaa(0x174)]=_0x105650,await this['fetchRepositoryData'](),this[_0x15bdaa(0x175)]=await this['repoService'][_0x15bdaa(0x135)](this[_0x15bdaa(0x180)][_0x15bdaa(0x13a)]),this[_0x15bdaa(0x13f)]=await this[_0x15bdaa(0x175)][_0x15bdaa(0x13e)][_0x15bdaa(0x135)](this[_0x15bdaa(0x180)][_0x15bdaa(0x187)]),this[_0x15bdaa(0x18a)]=new salesforce_logger_v2_service_1['SalesforceLogger2'](_0x10d24e[_0x15bdaa(0x17b)](),(_0x10d24e[_0x15bdaa(0x150)]()||_0x15bdaa(0x16a)+_0x105650[_0x15bdaa(0x17e)]()+_0x15bdaa(0x12b)+this[_0x15bdaa(0x180)][_0x15bdaa(0x13a)]+']\x20[Branch:\x20'+this[_0x15bdaa(0x180)][_0x15bdaa(0x187)]+']')+'\x20['+FlosumCommitJob_1[_0x15bdaa(0x17d)]+']');if(!this[_0x15bdaa(0x180)])throw new bad_request_error_1[(_0x15bdaa(0x139))](errors_1[_0x15bdaa(0x16b)]);await this[_0x15bdaa(0x18a)][_0x15bdaa(0x18d)](_0x15bdaa(0x156))[_0x15bdaa(0x132)](),await this[_0x15bdaa(0x186)]()[_0x15bdaa(0x184)](_0x852957=>this[_0x15bdaa(0x17c)](_0x852957));}catch(_0x4a8b38){this[_0x15bdaa(0x183)]=undefined,this[_0x15bdaa(0x14a)][_0x15bdaa(0x15c)](_0x4a8b38);throw _0x4a8b38;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1[a182_0x25acb3(0x140)]({'transient':!![]}),__metadata(a182_0x25acb3(0x173),[salesforce_service_1[a182_0x25acb3(0x144)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a182_0x25acb3(0x170)],git_provider_manager_1[a182_0x25acb3(0x164)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;