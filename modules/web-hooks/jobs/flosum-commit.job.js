const a181_0x5b4fc1=a181_0x165b;(function(_0x5105ce,_0x2a7168){const _0x250564=a181_0x165b,_0x3f8f70=_0x5105ce();while(!![]){try{const _0x493891=-parseInt(_0x250564(0x1e6))/0x1*(parseInt(_0x250564(0x1fb))/0x2)+parseInt(_0x250564(0x1e5))/0x3+-parseInt(_0x250564(0x1aa))/0x4+-parseInt(_0x250564(0x1b7))/0x5+parseInt(_0x250564(0x1cd))/0x6+-parseInt(_0x250564(0x1e3))/0x7*(parseInt(_0x250564(0x1db))/0x8)+parseInt(_0x250564(0x1c5))/0x9*(parseInt(_0x250564(0x1ef))/0xa);if(_0x493891===_0x2a7168)break;else _0x3f8f70['push'](_0x3f8f70['shift']());}catch(_0x4bbf53){_0x3f8f70['push'](_0x3f8f70['shift']());}}}(a181_0x426e,0xed16d));const a181_0x3c314a=(function(){let _0xae16fc=!![];return function(_0x515e9c,_0x3adbc2){const _0x44508b=_0xae16fc?function(){const _0x325bd5=a181_0x165b;if(_0x3adbc2){const _0x5df35f=_0x3adbc2[_0x325bd5(0x208)](_0x515e9c,arguments);return _0x3adbc2=null,_0x5df35f;}}:function(){};return _0xae16fc=![],_0x44508b;};}()),a181_0x4b9dbd=a181_0x3c314a(this,function(){const _0xc3ddf9=a181_0x165b;return a181_0x4b9dbd[_0xc3ddf9(0x1ec)]()[_0xc3ddf9(0x1d3)](_0xc3ddf9(0x1ea))[_0xc3ddf9(0x1ec)]()[_0xc3ddf9(0x204)](a181_0x4b9dbd)[_0xc3ddf9(0x1d3)]('(((.+)+)+)+$');});a181_0x4b9dbd();'use strict';function a181_0x165b(_0x44b9a6,_0x51c0b2){const _0xe9a6ff=a181_0x426e();return a181_0x165b=function(_0x4b9dbd,_0x3c314a){_0x4b9dbd=_0x4b9dbd-0x1a6;let _0x426ede=_0xe9a6ff[_0x4b9dbd];return _0x426ede;},a181_0x165b(_0x44b9a6,_0x51c0b2);}var __decorate=this&&this[a181_0x5b4fc1(0x1f2)]||function(_0x21eb8a,_0x1a0b40,_0x56022b,_0x5aae2a){const _0x3add66=a181_0x5b4fc1;var _0x1b884f=arguments[_0x3add66(0x1d8)],_0x4e9302=_0x1b884f<0x3?_0x1a0b40:_0x5aae2a===null?_0x5aae2a=Object[_0x3add66(0x1d2)](_0x1a0b40,_0x56022b):_0x5aae2a,_0x16cb27;if(typeof Reflect===_0x3add66(0x1f5)&&typeof Reflect['decorate']===_0x3add66(0x202))_0x4e9302=Reflect[_0x3add66(0x1f4)](_0x21eb8a,_0x1a0b40,_0x56022b,_0x5aae2a);else{for(var _0x2c9aa8=_0x21eb8a[_0x3add66(0x1d8)]-0x1;_0x2c9aa8>=0x0;_0x2c9aa8--)if(_0x16cb27=_0x21eb8a[_0x2c9aa8])_0x4e9302=(_0x1b884f<0x3?_0x16cb27(_0x4e9302):_0x1b884f>0x3?_0x16cb27(_0x1a0b40,_0x56022b,_0x4e9302):_0x16cb27(_0x1a0b40,_0x56022b))||_0x4e9302;}return _0x1b884f>0x3&&_0x4e9302&&Object[_0x3add66(0x1ff)](_0x1a0b40,_0x56022b,_0x4e9302),_0x4e9302;},__metadata=this&&this[a181_0x5b4fc1(0x1af)]||function(_0x456d5a,_0x391d9f){const _0x3fc531=a181_0x5b4fc1;if(typeof Reflect===_0x3fc531(0x1f5)&&typeof Reflect['metadata']===_0x3fc531(0x202))return Reflect[_0x3fc531(0x1c4)](_0x456d5a,_0x391d9f);},FlosumCommitJob_1;Object[a181_0x5b4fc1(0x1ff)](exports,a181_0x5b4fc1(0x1fe),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a181_0x5b4fc1(0x1b8)),salesforce_logger_v2_service_1=require(a181_0x5b4fc1(0x1dc)),salesforce_service_1=require(a181_0x5b4fc1(0x1fc)),git_provider_manager_1=require(a181_0x5b4fc1(0x1e4)),typedi_1=require(a181_0x5b4fc1(0x1e1)),errors_1=require(a181_0x5b4fc1(0x1fa)),bad_request_error_1=require('../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require(a181_0x5b4fc1(0x1be)),commit_components_dto_1=require(a181_0x5b4fc1(0x1ca)),commit_components_job_1=require(a181_0x5b4fc1(0x1f1));function a181_0x426e(){const _0x5ed23d=['(((.+)+)+)+$','commitJob','toString','In\x20Progress','[ERROR]\x20','35612060yJzkrA','deleteAttachmentId','./commit-components.job','__decorate','log','decorate','object','getLoggerId','SalesforceSyncService','ERR_UNKNOWN_SYNC_RECORD_ID','map','../../../constants/errors','4xruJfS','../../salesforce/services/salesforce.service','commitData','__esModule','defineProperty','getPrefix','repositoryName','function','gitUrl','constructor','Service','repo','BadRequestError','apply','SalesforceService','gitManager','salesforceSync','getOne','user','then','updateLastCommit','branchName','setStatus','360992FgcxAy','logger','[FLOSUM\x20->\x20GIT]\x20[','[INFO]\x20Start\x20commit\x20job','message','__metadata','exec','branch','ERR_INVALID_SYNC_RECORD_ID','handleCommitJobError','name','deleteAttachment','syncRepositoryId','8770770NuxgNZ','../../../core','provider','CommitComponentsJob','error','repositoryData','CommitComponentsDto','../../salesforce/services/salesforce-sync.service','SalesforceRetrieverService','convertToSFDX','getComponentsToDelete','getRepoService','commitAttachmentId','metadata','9lLBMPa','[INFO]\x20Update\x20remote\x20state.',']\x20[Repository:\x20','send','repoService','../dto/commit-components.dto',']\x20[Branch:\x20','split','7272162uttwGd','salesforceService','repository','trim','all','getOwnPropertyDescriptor','search','getCommitDto','run','branches','sha','length','Error','Logger','18720intYLk','../../salesforce/services/salesforce-logger-v2.service','retrieveAttachment','fetchRepositoryData','SalesforceLogger2','getComponentsToWrite','typedi','GitProviderManager','4242iPjWJj','../../shared/git-provider.manager','1273134xMrUiq','482026KiYIej','sfLogger','getRepositoryRecord','syncBranchId'];a181_0x426e=function(){return _0x5ed23d;};return a181_0x426e();}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x320967,_0x41b259,_0x3db415,_0x36fce1){const _0x452b22=a181_0x5b4fc1;this[_0x452b22(0x1ce)]=_0x320967,this['commitJob']=_0x41b259,this[_0x452b22(0x20b)]=_0x3db415,this[_0x452b22(0x20a)]=_0x36fce1,this['repoService']=this['gitManager'][_0x452b22(0x1c2)](),this[_0x452b22(0x1ab)]=new core_1[(_0x452b22(0x1da))](FlosumCommitJob_1['name']);}async[a181_0x5b4fc1(0x1de)](){const _0x581e73=a181_0x5b4fc1;try{if(this[_0x581e73(0x1fd)][_0x581e73(0x1b6)])this[_0x581e73(0x1bc)]=await this[_0x581e73(0x20b)][_0x581e73(0x1e8)](this['commitData'][_0x581e73(0x1b6)]);else this[_0x581e73(0x1fd)]['syncBranchId']&&(this[_0x581e73(0x1bc)]=await this[_0x581e73(0x20b)]['getBranchRecord'](this['commitData'][_0x581e73(0x1e9)]));}catch(_0x54a03a){throw new bad_request_error_1[(_0x581e73(0x207))](errors_1[_0x581e73(0x1b2)]);}}async[a181_0x5b4fc1(0x1e0)](){const _0x2aec64=a181_0x5b4fc1;if(!this['commitData'][_0x2aec64(0x1c3)])return[];const _0x786c7f=await this[_0x2aec64(0x1ce)][_0x2aec64(0x1dd)](this[_0x2aec64(0x1fd)][_0x2aec64(0x1c3)])[_0x2aec64(0x1a6)](_0x396605=>_0x396605[_0x2aec64(0x1cc)]('\x20')[_0x2aec64(0x1f9)](_0x26f716=>_0x26f716[_0x2aec64(0x1d0)]())),_0x2e6d90=new salesforce_retriever_service_1[(_0x2aec64(0x1bf))](this[_0x2aec64(0x1ce)]),_0x2a0b60=await _0x2e6d90[_0x2aec64(0x1d5)](_0x786c7f);return _0x2a0b60;}async['getComponentsToDelete'](){const _0x5420d0=a181_0x5b4fc1;if(!this[_0x5420d0(0x1fd)][_0x5420d0(0x1f0)])return[];const _0x1684bd=await this['salesforceService'][_0x5420d0(0x1dd)](this[_0x5420d0(0x1fd)]['deleteAttachmentId']);return _0x1684bd;}async[a181_0x5b4fc1(0x1d4)](){const _0x9bd750=a181_0x5b4fc1,_0x1937cc=new commit_components_dto_1[(_0x9bd750(0x1bd))](),[_0x5aebf6,_0x18a2eb]=await Promise[_0x9bd750(0x1d1)]([this[_0x9bd750(0x1e0)](),this[_0x9bd750(0x1c1)]()]);return _0x1937cc[_0x9bd750(0x1ae)]=this[_0x9bd750(0x1fd)][_0x9bd750(0x1ae)],_0x1937cc[_0x9bd750(0x20d)]=this[_0x9bd750(0x1fd)][_0x9bd750(0x20d)],_0x1937cc['components']={'writed':_0x5aebf6,'deleted':_0x18a2eb},_0x1937cc['convertToSFDX']=this[_0x9bd750(0x1fd)][_0x9bd750(0x1c0)],_0x1937cc[_0x9bd750(0x206)]=this[_0x9bd750(0x1cf)],_0x1937cc[_0x9bd750(0x1b1)]=this[_0x9bd750(0x1b1)],_0x1937cc['provider']=this[_0x9bd750(0x1b9)],_0x1937cc;}async[a181_0x5b4fc1(0x1a7)](_0x3a5c11=![]){const _0x9e76ac=a181_0x5b4fc1;if(_0x3a5c11)await this['salesforceSync']['updateRemoteState'](this['repositoryData'],{});else{const _0x4c2584=await this[_0x9e76ac(0x1cf)]['branches']['getOne'](this[_0x9e76ac(0x1b1)][_0x9e76ac(0x1b4)]);this['sfLogger']['log'](_0x9e76ac(0x1c6));const _0x487dd0={[this[_0x9e76ac(0x1cf)][_0x9e76ac(0x203)]]:{'lastCommit':_0x4c2584[_0x9e76ac(0x1d7)]}};await this[_0x9e76ac(0x20b)]['updateRemoteState'](this[_0x9e76ac(0x1bc)],_0x487dd0);}}async['exec'](){const _0x32a818=a181_0x5b4fc1,_0x497c7e=await this[_0x32a818(0x1d4)]();await this['salesforceSync']['setStatus'](this[_0x32a818(0x1bc)],_0x32a818(0x1ed)),await this[_0x32a818(0x1eb)][_0x32a818(0x1d5)](_0x497c7e,this['sfLogger']),await this[_0x32a818(0x1a7)](),this['commitData'][_0x32a818(0x1c3)]&&await this[_0x32a818(0x1ce)][_0x32a818(0x1b5)](this['commitData'][_0x32a818(0x1c3)]),this[_0x32a818(0x1fd)][_0x32a818(0x1f0)]&&await this['salesforceService']['deleteAttachment'](this[_0x32a818(0x1fd)][_0x32a818(0x1f0)]),await this[_0x32a818(0x20b)][_0x32a818(0x1a9)](this[_0x32a818(0x1bc)],'Completed');}async[a181_0x5b4fc1(0x1b3)](_0x1665f5){const _0x2e9057=a181_0x5b4fc1;try{this[_0x2e9057(0x1e7)][_0x2e9057(0x1f3)](_0x2e9057(0x1ee)+_0x1665f5),await this[_0x2e9057(0x1e7)][_0x2e9057(0x1c8)](),await this[_0x2e9057(0x1a7)](!![]),await this[_0x2e9057(0x20b)][_0x2e9057(0x1a9)](this[_0x2e9057(0x1bc)],_0x2e9057(0x1d9));}catch(_0x4105b7){this['logger'][_0x2e9057(0x1bb)](_0x4105b7);}}async['run'](_0xbbb35c,_0xc5776a,_0x324c1d){const _0x2e388e=a181_0x5b4fc1;try{this[_0x2e388e(0x1fd)]=_0xbbb35c,this[_0x2e388e(0x1b9)]=_0x324c1d,await this[_0x2e388e(0x1de)](),this[_0x2e388e(0x1cf)]=await this[_0x2e388e(0x1c9)][_0x2e388e(0x20c)](this['repositoryData'][_0x2e388e(0x201)]),this['branch']=await this['repository'][_0x2e388e(0x1d6)][_0x2e388e(0x20c)](this[_0x2e388e(0x1bc)][_0x2e388e(0x1a8)]),this[_0x2e388e(0x1e7)]=new salesforce_logger_v2_service_1[(_0x2e388e(0x1df))](_0xc5776a[_0x2e388e(0x1f6)](),(_0xc5776a[_0x2e388e(0x200)]()||_0x2e388e(0x1ac)+_0x324c1d['toUpperCase']()+_0x2e388e(0x1c7)+this[_0x2e388e(0x1bc)]['repositoryName']+_0x2e388e(0x1cb)+this[_0x2e388e(0x1bc)]['branchName']+']')+'\x20['+FlosumCommitJob_1['name']+']');if(!this['repositoryData'])throw new bad_request_error_1['BadRequestError'](errors_1[_0x2e388e(0x1f8)]);await this[_0x2e388e(0x1e7)]['log'](_0x2e388e(0x1ad))[_0x2e388e(0x1c8)](),await this[_0x2e388e(0x1b0)]()['catch'](_0xfa1b51=>this[_0x2e388e(0x1b3)](_0xfa1b51));}catch(_0x373a0c){this['commitData']=undefined,this[_0x2e388e(0x1ab)][_0x2e388e(0x1bb)](_0x373a0c);throw _0x373a0c;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1[a181_0x5b4fc1(0x205)]({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a181_0x5b4fc1(0x209)],commit_components_job_1[a181_0x5b4fc1(0x1ba)],salesforce_sync_service_1[a181_0x5b4fc1(0x1f7)],git_provider_manager_1[a181_0x5b4fc1(0x1e2)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;