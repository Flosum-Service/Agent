const a181_0x251d7f=a181_0x53ee;(function(_0x572b85,_0x14ae35){const _0x471f47=a181_0x53ee,_0x479bfa=_0x572b85();while(!![]){try{const _0x178bb4=parseInt(_0x471f47(0x1cf))/0x1+-parseInt(_0x471f47(0x205))/0x2+-parseInt(_0x471f47(0x21f))/0x3+parseInt(_0x471f47(0x1ff))/0x4*(-parseInt(_0x471f47(0x1eb))/0x5)+parseInt(_0x471f47(0x1d6))/0x6*(-parseInt(_0x471f47(0x1e4))/0x7)+parseInt(_0x471f47(0x223))/0x8*(-parseInt(_0x471f47(0x1da))/0x9)+parseInt(_0x471f47(0x221))/0xa*(parseInt(_0x471f47(0x201))/0xb);if(_0x178bb4===_0x14ae35)break;else _0x479bfa['push'](_0x479bfa['shift']());}catch(_0x2bea20){_0x479bfa['push'](_0x479bfa['shift']());}}}(a181_0x2549,0x50c78));function a181_0x2549(){const _0x1b5056=['63jhyqZl','design:paramtypes','CommitComponentsDto','../../salesforce/services/salesforce-retriever.service','Error','../dto/commit-components.dto','Completed','10GPwMHM','getCommitDto','catch','SalesforceService','updateLastCommit','BadRequestError','constructor','getComponentsToWrite','name','commitAttachmentId','branch','exec','length','../../salesforce/services/salesforce-sync.service','getRepoService','[INFO]\x20Update\x20remote\x20state.','branchName','sfLogger','updateRemoteState','commitData','722180HgkNWe','../../salesforce/services/salesforce.service','121BULRqW','getLoggerId','Service','user','1110720RBhWQk','syncBranchId','CommitComponentsJob',']\x20[Branch:\x20','getBranchRecord','fetchRepositoryData','SalesforceRetrieverService','deleteAttachment','metadata','error','repoService','__metadata','function','object','ERR_UNKNOWN_SYNC_RECORD_ID','commitJob','repositoryData','./commit-components.job','(((.+)+)+)+$','log','logger','repo','trim','convertToSFDX','provider','../../shared/git-provider.manager','66054aBngTl','../../../constants/errors','1789870fmVkwD','defineProperty','5007632vmdzkZ','repositoryName','retrieveAttachment','../../../core','deleteAttachmentId','components','handleCommitJobError','getComponentsToDelete','getOwnPropertyDescriptor','message','all','SalesforceLogger2','split','run','typedi','setStatus','branches','salesforceSync','[ERROR]\x20','search','419754MCfOlF','gitManager','getOne','SalesforceSyncService','[INFO]\x20Start\x20commit\x20job','salesforceService','ERR_INVALID_SYNC_RECORD_ID','328878UXwnkp','FlosumCommitJob','Logger','__esModule','9jmwPCn','apply','send','../../salesforce/services/salesforce-logger-v2.service','toString','[FLOSUM\x20->\x20GIT]\x20[','toUpperCase','repository','In\x20Progress','GitProviderManager'];a181_0x2549=function(){return _0x1b5056;};return a181_0x2549();}const a181_0x3755e1=(function(){let _0x3bc4c0=!![];return function(_0x1b6738,_0x5b20ca){const _0x1150ad=_0x3bc4c0?function(){const _0x593856=a181_0x53ee;if(_0x5b20ca){const _0x208d5d=_0x5b20ca[_0x593856(0x1db)](_0x1b6738,arguments);return _0x5b20ca=null,_0x208d5d;}}:function(){};return _0x3bc4c0=![],_0x1150ad;};}()),a181_0x3c3c55=a181_0x3755e1(this,function(){const _0x22b92e=a181_0x53ee;return a181_0x3c3c55['toString']()[_0x22b92e(0x1ce)]('(((.+)+)+)+$')[_0x22b92e(0x1de)]()[_0x22b92e(0x1f1)](a181_0x3c3c55)[_0x22b92e(0x1ce)](_0x22b92e(0x217));});a181_0x3c3c55();'use strict';var __decorate=this&&this['__decorate']||function(_0xfadb9f,_0xe6f1e1,_0x214b25,_0x47bf4a){const _0x3b0e44=a181_0x53ee;var _0x5de8c6=arguments[_0x3b0e44(0x1f7)],_0x5aa405=_0x5de8c6<0x3?_0xe6f1e1:_0x47bf4a===null?_0x47bf4a=Object[_0x3b0e44(0x22b)](_0xe6f1e1,_0x214b25):_0x47bf4a,_0x458ab5;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x3b0e44(0x211))_0x5aa405=Reflect['decorate'](_0xfadb9f,_0xe6f1e1,_0x214b25,_0x47bf4a);else{for(var _0x14bf9d=_0xfadb9f[_0x3b0e44(0x1f7)]-0x1;_0x14bf9d>=0x0;_0x14bf9d--)if(_0x458ab5=_0xfadb9f[_0x14bf9d])_0x5aa405=(_0x5de8c6<0x3?_0x458ab5(_0x5aa405):_0x5de8c6>0x3?_0x458ab5(_0xe6f1e1,_0x214b25,_0x5aa405):_0x458ab5(_0xe6f1e1,_0x214b25))||_0x5aa405;}return _0x5de8c6>0x3&&_0x5aa405&&Object[_0x3b0e44(0x222)](_0xe6f1e1,_0x214b25,_0x5aa405),_0x5aa405;},__metadata=this&&this[a181_0x251d7f(0x210)]||function(_0x5ea504,_0x3a4680){const _0x2725f2=a181_0x251d7f;if(typeof Reflect===_0x2725f2(0x212)&&typeof Reflect[_0x2725f2(0x20d)]===_0x2725f2(0x211))return Reflect[_0x2725f2(0x20d)](_0x5ea504,_0x3a4680);},FlosumCommitJob_1;function a181_0x53ee(_0x4329c6,_0x4423c8){const _0x288f0f=a181_0x2549();return a181_0x53ee=function(_0x3c3c55,_0x3755e1){_0x3c3c55=_0x3c3c55-0x1cb;let _0x254921=_0x288f0f[_0x3c3c55];return _0x254921;},a181_0x53ee(_0x4329c6,_0x4423c8);}Object[a181_0x251d7f(0x222)](exports,a181_0x251d7f(0x1d9),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a181_0x251d7f(0x226)),salesforce_logger_v2_service_1=require(a181_0x251d7f(0x1dd)),salesforce_service_1=require(a181_0x251d7f(0x200)),git_provider_manager_1=require(a181_0x251d7f(0x21e)),typedi_1=require(a181_0x251d7f(0x231)),errors_1=require(a181_0x251d7f(0x220)),bad_request_error_1=require('../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a181_0x251d7f(0x1e7)),salesforce_sync_service_1=require(a181_0x251d7f(0x1f8)),commit_components_dto_1=require(a181_0x251d7f(0x1e9)),commit_components_job_1=require(a181_0x251d7f(0x216));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x42a032,_0x4ae1b6,_0x1b6299,_0x3557c8){const _0x45cf3b=a181_0x251d7f;this[_0x45cf3b(0x1d4)]=_0x42a032,this[_0x45cf3b(0x214)]=_0x4ae1b6,this['salesforceSync']=_0x1b6299,this['gitManager']=_0x3557c8,this[_0x45cf3b(0x20f)]=this[_0x45cf3b(0x1d0)][_0x45cf3b(0x1f9)](),this[_0x45cf3b(0x219)]=new core_1[(_0x45cf3b(0x1d8))](FlosumCommitJob_1[_0x45cf3b(0x1f3)]);}async['fetchRepositoryData'](){const _0x21d514=a181_0x251d7f;try{if(this[_0x21d514(0x1fe)]['syncRepositoryId'])this[_0x21d514(0x215)]=await this[_0x21d514(0x1cc)]['getRepositoryRecord'](this[_0x21d514(0x1fe)]['syncRepositoryId']);else this[_0x21d514(0x1fe)][_0x21d514(0x206)]&&(this['repositoryData']=await this[_0x21d514(0x1cc)][_0x21d514(0x209)](this[_0x21d514(0x1fe)]['syncBranchId']));}catch(_0x24b637){throw new bad_request_error_1[(_0x21d514(0x1f0))](errors_1[_0x21d514(0x1d5)]);}}async[a181_0x251d7f(0x1f2)](){const _0x2e0f8f=a181_0x251d7f;if(!this['commitData']['commitAttachmentId'])return[];const _0x430ee2=await this[_0x2e0f8f(0x1d4)][_0x2e0f8f(0x225)](this['commitData']['commitAttachmentId'])['then'](_0xc76d26=>_0xc76d26[_0x2e0f8f(0x22f)]('\x20')['map'](_0x2c1bec=>_0x2c1bec[_0x2e0f8f(0x21b)]())),_0x5f06ea=new salesforce_retriever_service_1[(_0x2e0f8f(0x20b))](this['salesforceService']),_0x5744c2=await _0x5f06ea[_0x2e0f8f(0x230)](_0x430ee2);return _0x5744c2;}async[a181_0x251d7f(0x22a)](){const _0x22aa36=a181_0x251d7f;if(!this['commitData'][_0x22aa36(0x227)])return[];const _0x19579c=await this[_0x22aa36(0x1d4)][_0x22aa36(0x225)](this[_0x22aa36(0x1fe)][_0x22aa36(0x227)]);return _0x19579c;}async['getCommitDto'](){const _0x248b24=a181_0x251d7f,_0x4a0a1b=new commit_components_dto_1[(_0x248b24(0x1e6))](),[_0x15bb83,_0x4b39de]=await Promise[_0x248b24(0x22d)]([this[_0x248b24(0x1f2)](),this['getComponentsToDelete']()]);return _0x4a0a1b[_0x248b24(0x22c)]=this['commitData']['message'],_0x4a0a1b[_0x248b24(0x204)]=this[_0x248b24(0x1fe)][_0x248b24(0x204)],_0x4a0a1b[_0x248b24(0x228)]={'writed':_0x15bb83,'deleted':_0x4b39de},_0x4a0a1b[_0x248b24(0x21c)]=this[_0x248b24(0x1fe)][_0x248b24(0x21c)],_0x4a0a1b[_0x248b24(0x21a)]=this[_0x248b24(0x1e1)],_0x4a0a1b[_0x248b24(0x1f5)]=this[_0x248b24(0x1f5)],_0x4a0a1b['provider']=this[_0x248b24(0x21d)],_0x4a0a1b;}async[a181_0x251d7f(0x1ef)](_0x545a4f=![]){const _0x147cd7=a181_0x251d7f;if(_0x545a4f)await this[_0x147cd7(0x1cc)][_0x147cd7(0x1fd)](this['repositoryData'],{});else{const _0x567c42=await this[_0x147cd7(0x1e1)][_0x147cd7(0x1cb)][_0x147cd7(0x1d1)](this[_0x147cd7(0x1f5)]['name']);this[_0x147cd7(0x1fc)][_0x147cd7(0x218)](_0x147cd7(0x1fa));const _0x50683c={[this['repository']['gitUrl']]:{'lastCommit':_0x567c42['sha']}};await this[_0x147cd7(0x1cc)]['updateRemoteState'](this[_0x147cd7(0x215)],_0x50683c);}}async['exec'](){const _0x142969=a181_0x251d7f,_0x1f5965=await this[_0x142969(0x1ec)]();await this[_0x142969(0x1cc)][_0x142969(0x232)](this[_0x142969(0x215)],_0x142969(0x1e2)),await this[_0x142969(0x214)]['run'](_0x1f5965,this[_0x142969(0x1fc)]),await this[_0x142969(0x1ef)](),this[_0x142969(0x1fe)][_0x142969(0x1f4)]&&await this['salesforceService'][_0x142969(0x20c)](this['commitData']['commitAttachmentId']),this[_0x142969(0x1fe)][_0x142969(0x227)]&&await this[_0x142969(0x1d4)]['deleteAttachment'](this['commitData'][_0x142969(0x227)]),await this[_0x142969(0x1cc)][_0x142969(0x232)](this['repositoryData'],_0x142969(0x1ea));}async[a181_0x251d7f(0x229)](_0x32aacd){const _0x53d81e=a181_0x251d7f;try{this[_0x53d81e(0x1fc)][_0x53d81e(0x218)](_0x53d81e(0x1cd)+_0x32aacd),await this[_0x53d81e(0x1fc)][_0x53d81e(0x1dc)](),await this['updateLastCommit'](!![]),await this['salesforceSync']['setStatus'](this[_0x53d81e(0x215)],_0x53d81e(0x1e8));}catch(_0x4ee952){this[_0x53d81e(0x219)][_0x53d81e(0x20e)](_0x4ee952);}}async[a181_0x251d7f(0x230)](_0x11c209,_0x295dc5,_0x2033cc){const _0x3067dd=a181_0x251d7f;try{this[_0x3067dd(0x1fe)]=_0x11c209,this[_0x3067dd(0x21d)]=_0x2033cc,await this[_0x3067dd(0x20a)](),this[_0x3067dd(0x1e1)]=await this['repoService'][_0x3067dd(0x1d1)](this[_0x3067dd(0x215)][_0x3067dd(0x224)]),this[_0x3067dd(0x1f5)]=await this[_0x3067dd(0x1e1)][_0x3067dd(0x1cb)]['getOne'](this['repositoryData'][_0x3067dd(0x1fb)]),this[_0x3067dd(0x1fc)]=new salesforce_logger_v2_service_1[(_0x3067dd(0x22e))](_0x295dc5[_0x3067dd(0x202)](),(_0x295dc5['getPrefix']()||_0x3067dd(0x1df)+_0x2033cc[_0x3067dd(0x1e0)]()+']\x20[Repository:\x20'+this[_0x3067dd(0x215)][_0x3067dd(0x224)]+_0x3067dd(0x208)+this[_0x3067dd(0x215)]['branchName']+']')+'\x20['+FlosumCommitJob_1[_0x3067dd(0x1f3)]+']');if(!this[_0x3067dd(0x215)])throw new bad_request_error_1['BadRequestError'](errors_1[_0x3067dd(0x213)]);await this[_0x3067dd(0x1fc)][_0x3067dd(0x218)](_0x3067dd(0x1d3))['send'](),await this[_0x3067dd(0x1f6)]()[_0x3067dd(0x1ed)](_0x5d9643=>this[_0x3067dd(0x229)](_0x5d9643));}catch(_0x1ba7f4){this['commitData']=undefined,this[_0x3067dd(0x219)][_0x3067dd(0x20e)](_0x1ba7f4);throw _0x1ba7f4;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1[a181_0x251d7f(0x203)]({'transient':!![]}),__metadata(a181_0x251d7f(0x1e5),[salesforce_service_1[a181_0x251d7f(0x1ee)],commit_components_job_1[a181_0x251d7f(0x207)],salesforce_sync_service_1[a181_0x251d7f(0x1d2)],git_provider_manager_1[a181_0x251d7f(0x1e3)]])],FlosumCommitJob),exports[a181_0x251d7f(0x1d7)]=FlosumCommitJob;