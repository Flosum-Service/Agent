const a187_0xed458a=a187_0xbd43;(function(_0x80dd1d,_0x590d69){const _0x894a3=a187_0xbd43,_0x3f2284=_0x80dd1d();while(!![]){try{const _0x3681c8=parseInt(_0x894a3(0x132))/0x1*(-parseInt(_0x894a3(0x126))/0x2)+parseInt(_0x894a3(0x10e))/0x3*(parseInt(_0x894a3(0x13b))/0x4)+-parseInt(_0x894a3(0x120))/0x5+-parseInt(_0x894a3(0xf8))/0x6+-parseInt(_0x894a3(0xfc))/0x7+-parseInt(_0x894a3(0x10a))/0x8+-parseInt(_0x894a3(0xef))/0x9*(-parseInt(_0x894a3(0x133))/0xa);if(_0x3681c8===_0x590d69)break;else _0x3f2284['push'](_0x3f2284['shift']());}catch(_0x548988){_0x3f2284['push'](_0x3f2284['shift']());}}}(a187_0x500e,0x6b6f1));const a187_0x34d305=(function(){let _0x4bb790=!![];return function(_0x506787,_0x3326ce){const _0x112391=_0x4bb790?function(){const _0x43a32c=a187_0xbd43;if(_0x3326ce){const _0x46b888=_0x3326ce[_0x43a32c(0xd9)](_0x506787,arguments);return _0x3326ce=null,_0x46b888;}}:function(){};return _0x4bb790=![],_0x112391;};}()),a187_0x4eb08c=a187_0x34d305(this,function(){const _0x5e0c86=a187_0xbd43;return a187_0x4eb08c[_0x5e0c86(0xdc)]()[_0x5e0c86(0x122)]('(((.+)+)+)+$')[_0x5e0c86(0xdc)]()[_0x5e0c86(0x128)](a187_0x4eb08c)[_0x5e0c86(0x122)](_0x5e0c86(0x127));});a187_0x4eb08c();'use strict';var __createBinding=this&&this[a187_0xed458a(0x139)]||(Object[a187_0xed458a(0x124)]?function(_0x29f2ae,_0x29d246,_0x41eecf,_0x1e1a44){if(_0x1e1a44===undefined)_0x1e1a44=_0x41eecf;Object['defineProperty'](_0x29f2ae,_0x1e1a44,{'enumerable':!![],'get':function(){return _0x29d246[_0x41eecf];}});}:function(_0xa409ad,_0x4666cd,_0x5ade00,_0x55b997){if(_0x55b997===undefined)_0x55b997=_0x5ade00;_0xa409ad[_0x55b997]=_0x4666cd[_0x5ade00];}),__setModuleDefault=this&&this[a187_0xed458a(0x13c)]||(Object[a187_0xed458a(0x124)]?function(_0x6267d5,_0x40a901){const _0x588552=a187_0xed458a;Object[_0x588552(0x114)](_0x6267d5,_0x588552(0x102),{'enumerable':!![],'value':_0x40a901});}:function(_0x38e7a8,_0x27f1e2){const _0x442834=a187_0xed458a;_0x38e7a8[_0x442834(0x102)]=_0x27f1e2;}),__decorate=this&&this[a187_0xed458a(0xdb)]||function(_0x52e981,_0x33d2a1,_0x21ad5c,_0x5e9e7d){const _0x4d47ad=a187_0xed458a;var _0x5a7e8c=arguments[_0x4d47ad(0x136)],_0xdc231f=_0x5a7e8c<0x3?_0x33d2a1:_0x5e9e7d===null?_0x5e9e7d=Object[_0x4d47ad(0x13e)](_0x33d2a1,_0x21ad5c):_0x5e9e7d,_0x3789e8;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0xdc231f=Reflect[_0x4d47ad(0x12e)](_0x52e981,_0x33d2a1,_0x21ad5c,_0x5e9e7d);else{for(var _0x29510b=_0x52e981[_0x4d47ad(0x136)]-0x1;_0x29510b>=0x0;_0x29510b--)if(_0x3789e8=_0x52e981[_0x29510b])_0xdc231f=(_0x5a7e8c<0x3?_0x3789e8(_0xdc231f):_0x5a7e8c>0x3?_0x3789e8(_0x33d2a1,_0x21ad5c,_0xdc231f):_0x3789e8(_0x33d2a1,_0x21ad5c))||_0xdc231f;}return _0x5a7e8c>0x3&&_0xdc231f&&Object[_0x4d47ad(0x114)](_0x33d2a1,_0x21ad5c,_0xdc231f),_0xdc231f;},__importStar=this&&this[a187_0xed458a(0x100)]||function(_0x3c855a){const _0x3706d9=a187_0xed458a;if(_0x3c855a&&_0x3c855a['__esModule'])return _0x3c855a;var _0xd741d9={};if(_0x3c855a!=null){for(var _0x1e2eb3 in _0x3c855a)if(_0x1e2eb3!=='default'&&Object['prototype']['hasOwnProperty'][_0x3706d9(0x104)](_0x3c855a,_0x1e2eb3))__createBinding(_0xd741d9,_0x3c855a,_0x1e2eb3);}return __setModuleDefault(_0xd741d9,_0x3c855a),_0xd741d9;},__metadata=this&&this[a187_0xed458a(0x11b)]||function(_0x2312a1,_0x2f1ec7){const _0x3dfdc7=a187_0xed458a;if(typeof Reflect===_0x3dfdc7(0x121)&&typeof Reflect[_0x3dfdc7(0xf7)]===_0x3dfdc7(0xe1))return Reflect[_0x3dfdc7(0xf7)](_0x2312a1,_0x2f1ec7);},SyncService_1;function a187_0x500e(){const _0x395907=['SyncService','get','repoService','direction','salesforceSync','__metadata','../../../core/errors/too-many-requests.error','typedi','../../../core','find','3217350WkBEBz','object','search','syncDto','create','../jobs/git-sync.job','570418KyUXBA','(((.+)+)+)+$','constructor','../../hooks/hooks.utils','\x27\x20in\x20repository\x20\x27','../../../constants','run','have\x20to\x20synchronize\x20%d\x20branches','decorate','test','logger','[INFO]\x20Start\x20sync\x20job','3fedePO','3804580eobzXw','getOrCreateRepo','url','length','[INFO]\x20Repository\x20\x22','catch','__createBinding','syncID','1790740KnxGqQ','__setModuleDefault','design:paramtypes','getOwnPropertyDescriptor','TooManyRequests','createHookPayload','SalesforceLogger2','error','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','sfLogger',']\x20[','FlosumToGit','GitBranchNotFoundError','apply','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','__decorate','toString','setStatus','getAll','[ERROR]\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','REPOSITORY_NAME_REGEXP','function','repoList','repositoryId','isIntersects','__esModule','../../salesforce/dto/flosum-repository-sync.dto','HooksUtils','SalesforceError','branchName','name','toUpperCase','FlosumSyncJob','../../salesforce/services/salesforce.service','../errors/git-branch-not-found.error','63OSzwvr','gitManager','handleRecordSyncError','getBranchRecords','../../shared/utils','log','repositoriesIntersections','../../salesforce/errors/salesforce.error','metadata','2295234ZCsYAj','../jobs/flosum-sync.job','gitUrl','hooks','2506378mqDBwk','Unable\x20to\x20synchronize\x20repository\x20\x27','getRepoService','Waiting','__importStar','Error','default','Not\x20Synchronized','call','Logger',']\x20due\x20error\x20-\x20','salesforceService','send','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','3449216ZRwiKr','repositoryName','SalesforceService','all','3EvaSyw','disableSync','createHooks','checkValidNaming','branchId','GitSyncJob','defineProperty','BRANCH_NAME_REGEXP'];a187_0x500e=function(){return _0x395907;};return a187_0x500e();}function a187_0xbd43(_0x48c998,_0x248919){const _0xb2e0ce=a187_0x500e();return a187_0xbd43=function(_0x4eb08c,_0x34d305){_0x4eb08c=_0x4eb08c-0xd0;let _0x500e95=_0xb2e0ce[_0x4eb08c];return _0x500e95;},a187_0xbd43(_0x48c998,_0x248919);}Object[a187_0xed458a(0x114)](exports,a187_0xed458a(0xe5),{'value':!![]}),exports[a187_0xed458a(0x116)]=void 0x0;const constants_1=require(a187_0xed458a(0x12b)),core_1=require(a187_0xed458a(0x11e)),too_many_requests_error_1=require(a187_0xed458a(0x11c)),flosum_repository_sync_dto_1=require(a187_0xed458a(0xe6)),salesforce_error_1=require(a187_0xed458a(0xf6)),salesforce_logger_v2_service_1=require('../../salesforce/services/salesforce-logger-v2.service'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a187_0xed458a(0xed)),git_provider_manager_1=require('../../shared/git-provider.manager'),utils_1=require(a187_0xed458a(0xf3)),typedi_1=__importStar(require(a187_0xed458a(0x11d))),hooks_utils_1=require(a187_0xed458a(0x129)),git_branch_not_found_error_1=require(a187_0xed458a(0xee)),flosum_sync_job_1=require(a187_0xed458a(0xf9)),git_sync_job_1=require(a187_0xed458a(0x125));let SyncService=SyncService_1=class SyncService{constructor(_0x1243b2,_0xecb88d,_0x315a38){const _0x41e318=a187_0xed458a;this[_0x41e318(0x107)]=_0x1243b2,this[_0x41e318(0x11a)]=_0xecb88d,this['gitManager']=_0x315a38,this[_0x41e318(0x130)]=new core_1[(_0x41e318(0x105))](SyncService_1['name']),this[_0x41e318(0xf5)]={},this[_0x41e318(0xe2)]=[];}async['handleRecordSyncError'](_0x5226df,_0x5df30f){const _0x18f8fd=a187_0xed458a;if(_0x5df30f instanceof git_branch_not_found_error_1[_0x18f8fd(0xd8)]){await this['salesforceSync'][_0x18f8fd(0xdd)](_0x5226df,_0x18f8fd(0x103));return;}if(_0x5df30f instanceof too_many_requests_error_1[_0x18f8fd(0xd0)]){await this[_0x18f8fd(0x11a)]['setStatus'](_0x5226df,_0x18f8fd(0xff));throw _0x5df30f;}try{await this[_0x18f8fd(0xd5)]['log']('[ERROR]\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x5226df[_0x18f8fd(0x10b)]+'\x27\x20['+_0x5226df[_0x18f8fd(0xe9)]+_0x18f8fd(0x106)+_0x5df30f)['send'](),await this['salesforceSync']['updateRemoteState'](_0x5226df,{}),await this[_0x18f8fd(0x11a)][_0x18f8fd(0xdd)](_0x5226df,_0x18f8fd(0x101));}catch(_0x2f9b6f){if(_0x2f9b6f instanceof salesforce_error_1[_0x18f8fd(0xe8)])throw _0x2f9b6f;}}async[a187_0xed458a(0xe4)](_0x2f4c06){const _0x42c97b=a187_0xed458a;if(_0x2f4c06['repositoryId']){const _0x1ddba0=_0x2f4c06[_0x42c97b(0x10b)]['toLowerCase'](),_0x51ad54=this[_0x42c97b(0xf5)][_0x1ddba0];if(!_0x51ad54)this[_0x42c97b(0xf5)][_0x1ddba0]=_0x2f4c06[_0x42c97b(0x10b)];else{if(_0x51ad54&&_0x51ad54!==_0x2f4c06['repositoryName'])return await this[_0x42c97b(0xf1)](_0x2f4c06,new Error(_0x42c97b(0xfd)+_0x2f4c06[_0x42c97b(0x10b)]+_0x42c97b(0xda)+_0x1ddba0+'\x27\x20-\x20\x27'+_0x51ad54+'\x27')),!![];}}return![];}async[a187_0xed458a(0x111)](_0x28c141){const _0x41d1bd=a187_0xed458a;if(!constants_1[_0x41d1bd(0xe0)][_0x41d1bd(0x12f)](_0x28c141[_0x41d1bd(0x10b)]))return await this[_0x41d1bd(0xf1)](_0x28c141,new Error(_0x41d1bd(0xfd)+_0x28c141['repositoryName']+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x41d1bd(0x115)][_0x41d1bd(0x12f)](_0x28c141[_0x41d1bd(0xe9)]))return await this[_0x41d1bd(0xf1)](_0x28c141,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x28c141[_0x41d1bd(0xe9)]+_0x41d1bd(0x12a)+_0x28c141[_0x41d1bd(0x10b)]+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async[a187_0xed458a(0x134)](_0x51edb4,_0x149d71,_0x27dadb){const _0x177e6f=a187_0xed458a;let _0x3798ea=this[_0x177e6f(0xe2)][_0x177e6f(0x11f)](_0x7d2cb0=>_0x51edb4[_0x177e6f(0x10b)]===_0x7d2cb0[_0x177e6f(0xea)]);!_0x3798ea&&(this[_0x177e6f(0xd5)]['log'](_0x177e6f(0x137)+_0x51edb4['repositoryName']+_0x177e6f(0x109)),_0x3798ea=await this[_0x177e6f(0x118)]['create']({'name':_0x51edb4['repositoryName'],'autoInit':!![],'defaultBranch':_0x51edb4[_0x177e6f(0xe9)],'private':!![],'createHook':this[_0x177e6f(0x123)][_0x177e6f(0x110)]}));if(this[_0x177e6f(0x123)][_0x177e6f(0x110)]){const _0x1d5574=await _0x3798ea[_0x177e6f(0xfb)]['getAll']();!_0x1d5574[_0x177e6f(0x11f)](_0x5a1a4f=>_0x5a1a4f[_0x177e6f(0x135)]===hooks_utils_1[_0x177e6f(0xe7)]['getHookLinkFor'](_0x149d71,_0x27dadb))&&(this[_0x177e6f(0xd5)][_0x177e6f(0xf4)](_0x177e6f(0x137)+_0x51edb4[_0x177e6f(0x10b)]+'\x22\x20does\x20not\x20has\x20the\x20agent\x20webhook.\x20Creating\x20a\x20new\x20one.'),await _0x3798ea['hooks'][_0x177e6f(0x124)](hooks_utils_1[_0x177e6f(0xe7)][_0x177e6f(0xd1)](_0x149d71,_0x3798ea['hooks'],_0x27dadb)));}return this[_0x177e6f(0xe2)]['push'](_0x3798ea),_0x3798ea;}async[a187_0xed458a(0x12c)](_0x394f74,_0x248591,_0x42d6ec,_0xff8750){const _0x43aa38=a187_0xed458a;this['salesforceService']['setLoggerId'](_0x248591),this[_0x43aa38(0x118)]=this[_0x43aa38(0xf0)][_0x43aa38(0xfe)](_0x42d6ec),this[_0x43aa38(0xd5)]=new salesforce_logger_v2_service_1[(_0x43aa38(0xd2))](_0x248591,'['+SyncService_1[_0x43aa38(0xea)]+_0x43aa38(0xd6)+_0x42d6ec[_0x43aa38(0xeb)]()+']'),this[_0x43aa38(0x123)]=_0x394f74;try{await this[_0x43aa38(0xd5)][_0x43aa38(0xf4)](_0x43aa38(0x131))[_0x43aa38(0x108)]();const [_0x5d158f,_0x571f6f]=await Promise[_0x43aa38(0x10d)]([this[_0x43aa38(0x11a)][_0x43aa38(0xf2)](),this[_0x43aa38(0x11a)]['getRepositoryRecords']()]);this['repoList']=await this['repoService'][_0x43aa38(0xde)]();const _0xc4a102=[..._0x571f6f,..._0x5d158f];this[_0x43aa38(0x130)][_0x43aa38(0xf4)](_0x43aa38(0x12d),_0xc4a102[_0x43aa38(0x136)]);for(const _0x302fd8 of _0xc4a102){this[_0x43aa38(0x130)][_0x43aa38(0xf4)]('syncing\x20%s[%s]\x20repository\x20%s[%s]\x20branch',_0x302fd8[_0x43aa38(0x10b)],_0x302fd8[_0x43aa38(0xe3)],_0x302fd8[_0x43aa38(0xe9)],_0x302fd8[_0x43aa38(0x112)]);const _0x130af4=await this['checkValidNaming'](_0x302fd8);if(!_0x130af4)continue;const _0x3106a4=await this[_0x43aa38(0xe4)](_0x302fd8);if(_0x3106a4)continue;let _0xb9fb4d;try{_0xb9fb4d=await this[_0x43aa38(0x134)](_0x302fd8,_0x42d6ec,_0xff8750);}catch(_0x3a181c){await this[_0x43aa38(0xf1)](_0x302fd8,_0x3a181c instanceof too_many_requests_error_1['TooManyRequests']?_0x3a181c:new Error(_0x43aa38(0xd4)+_0x3a181c));continue;}await this[_0x43aa38(0xd5)][_0x43aa38(0x108)]();if(_0x302fd8[_0x43aa38(0x119)]===flosum_repository_sync_dto_1['SyncDirection'][_0x43aa38(0xd7)]){const _0xc175e3=typedi_1[_0x43aa38(0x102)][_0x43aa38(0x117)](flosum_sync_job_1[_0x43aa38(0xec)]);await _0xc175e3['run']({'repository':_0xb9fb4d,'convertToSFDX':_0x394f74['convertToSFDX'],'syncRecord':_0x302fd8,'provider':_0x42d6ec,'logger':this[_0x43aa38(0xd5)]})[_0x43aa38(0x138)](_0x567a7d=>this[_0x43aa38(0xf1)](_0x302fd8,_0x567a7d));}else{const _0xdbd6eb=typedi_1[_0x43aa38(0x102)][_0x43aa38(0x117)](git_sync_job_1[_0x43aa38(0x113)]);await _0xdbd6eb['run']({'repository':_0xb9fb4d,'branch':_0x302fd8[_0x43aa38(0xe9)],'provider':_0x42d6ec,'repositoryGit':_0xb9fb4d[_0x43aa38(0xfa)],'syncRecord':_0x302fd8,'logger':this[_0x43aa38(0xd5)]})['catch'](_0x54464a=>this[_0x43aa38(0xf1)](_0x302fd8,_0x54464a));}}}catch(_0x4fa575){this[_0x43aa38(0x130)][_0x43aa38(0xd3)](_0x4fa575);_0x4fa575 instanceof too_many_requests_error_1[_0x43aa38(0xd0)]?(await this[_0x43aa38(0xd5)]['log']('[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.')[_0x43aa38(0x108)](),await utils_1['sleep'](0x3c*0x3c*0x3e8),this[_0x43aa38(0x12c)](_0x394f74,_0x248591,_0x42d6ec,_0xff8750)):await this[_0x43aa38(0xd5)]['log'](_0x43aa38(0xdf)+_0x4fa575)[_0x43aa38(0x108)]();return;}await this[_0x43aa38(0xd5)]['log']('[INFO]\x20Sync\x20job\x20done.')[_0x43aa38(0x108)](),await this['salesforceSync'][_0x43aa38(0x10f)](_0x394f74[_0x43aa38(0x13a)])[_0x43aa38(0x138)](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a187_0xed458a(0x13d),[salesforce_service_1[a187_0xed458a(0x10c)],salesforce_sync_service_1['SalesforceSyncService'],git_provider_manager_1['GitProviderManager']])],SyncService),exports[a187_0xed458a(0x116)]=SyncService;