const a188_0x2f9979=a188_0x2d54;(function(_0x480b2a,_0x466dcd){const _0xea2b50=a188_0x2d54,_0x5d78b4=_0x480b2a();while(!![]){try{const _0x51b51c=-parseInt(_0xea2b50(0x174))/0x1*(parseInt(_0xea2b50(0x1a6))/0x2)+-parseInt(_0xea2b50(0x1ae))/0x3*(-parseInt(_0xea2b50(0x181))/0x4)+-parseInt(_0xea2b50(0x182))/0x5+-parseInt(_0xea2b50(0x187))/0x6*(-parseInt(_0xea2b50(0x184))/0x7)+parseInt(_0xea2b50(0x1b3))/0x8*(parseInt(_0xea2b50(0x17e))/0x9)+-parseInt(_0xea2b50(0x154))/0xa*(-parseInt(_0xea2b50(0x16e))/0xb)+-parseInt(_0xea2b50(0x16a))/0xc*(-parseInt(_0xea2b50(0x151))/0xd);if(_0x51b51c===_0x466dcd)break;else _0x5d78b4['push'](_0x5d78b4['shift']());}catch(_0x44cb3f){_0x5d78b4['push'](_0x5d78b4['shift']());}}}(a188_0x4991,0x8b635));const a188_0x530015=(function(){let _0x16d016=!![];return function(_0x339e16,_0x3f8ebd){const _0x52aa59=_0x16d016?function(){const _0x2819d4=a188_0x2d54;if(_0x3f8ebd){const _0x4108a8=_0x3f8ebd[_0x2819d4(0x160)](_0x339e16,arguments);return _0x3f8ebd=null,_0x4108a8;}}:function(){};return _0x16d016=![],_0x52aa59;};}()),a188_0x24572b=a188_0x530015(this,function(){const _0x433c37=a188_0x2d54;return a188_0x24572b[_0x433c37(0x1a7)]()[_0x433c37(0x163)](_0x433c37(0x19f))[_0x433c37(0x1a7)]()[_0x433c37(0x156)](a188_0x24572b)[_0x433c37(0x163)](_0x433c37(0x19f));});a188_0x24572b();'use strict';var __createBinding=this&&this[a188_0x2f9979(0x15a)]||(Object[a188_0x2f9979(0x17d)]?function(_0x520352,_0x29b1c0,_0xb8d224,_0x3cbdd1){const _0x555dd9=a188_0x2f9979;if(_0x3cbdd1===undefined)_0x3cbdd1=_0xb8d224;Object[_0x555dd9(0x19b)](_0x520352,_0x3cbdd1,{'enumerable':!![],'get':function(){return _0x29b1c0[_0xb8d224];}});}:function(_0x33a819,_0x4021fb,_0x5e71d6,_0xb11084){if(_0xb11084===undefined)_0xb11084=_0x5e71d6;_0x33a819[_0xb11084]=_0x4021fb[_0x5e71d6];}),__setModuleDefault=this&&this[a188_0x2f9979(0x14c)]||(Object[a188_0x2f9979(0x17d)]?function(_0x4e5a6d,_0x4cde7b){const _0x217da6=a188_0x2f9979;Object['defineProperty'](_0x4e5a6d,_0x217da6(0x172),{'enumerable':!![],'value':_0x4cde7b});}:function(_0x3053b3,_0x4da12a){const _0x46ce09=a188_0x2f9979;_0x3053b3[_0x46ce09(0x172)]=_0x4da12a;}),__decorate=this&&this[a188_0x2f9979(0x15c)]||function(_0x184291,_0x11cb9f,_0x5b6e46,_0x2cdfbb){const _0xbdc096=a188_0x2f9979;var _0x5ab4c0=arguments['length'],_0x927b64=_0x5ab4c0<0x3?_0x11cb9f:_0x2cdfbb===null?_0x2cdfbb=Object['getOwnPropertyDescriptor'](_0x11cb9f,_0x5b6e46):_0x2cdfbb,_0x4d5ead;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0xbdc096(0x183))_0x927b64=Reflect[_0xbdc096(0x159)](_0x184291,_0x11cb9f,_0x5b6e46,_0x2cdfbb);else{for(var _0x30fa3d=_0x184291[_0xbdc096(0x170)]-0x1;_0x30fa3d>=0x0;_0x30fa3d--)if(_0x4d5ead=_0x184291[_0x30fa3d])_0x927b64=(_0x5ab4c0<0x3?_0x4d5ead(_0x927b64):_0x5ab4c0>0x3?_0x4d5ead(_0x11cb9f,_0x5b6e46,_0x927b64):_0x4d5ead(_0x11cb9f,_0x5b6e46))||_0x927b64;}return _0x5ab4c0>0x3&&_0x927b64&&Object[_0xbdc096(0x19b)](_0x11cb9f,_0x5b6e46,_0x927b64),_0x927b64;},__importStar=this&&this[a188_0x2f9979(0x199)]||function(_0x4bd281){const _0x270b5d=a188_0x2f9979;if(_0x4bd281&&_0x4bd281[_0x270b5d(0x14f)])return _0x4bd281;var _0x4f8918={};if(_0x4bd281!=null){for(var _0x332727 in _0x4bd281)if(_0x332727!=='default'&&Object['prototype'][_0x270b5d(0x186)][_0x270b5d(0x175)](_0x4bd281,_0x332727))__createBinding(_0x4f8918,_0x4bd281,_0x332727);}return __setModuleDefault(_0x4f8918,_0x4bd281),_0x4f8918;},__metadata=this&&this[a188_0x2f9979(0x17a)]||function(_0x292a71,_0x192dae){const _0x16e863=a188_0x2f9979;if(typeof Reflect===_0x16e863(0x191)&&typeof Reflect[_0x16e863(0x197)]==='function')return Reflect[_0x16e863(0x197)](_0x292a71,_0x192dae);},SyncService_1;Object[a188_0x2f9979(0x19b)](exports,a188_0x2f9979(0x14f),{'value':!![]}),exports[a188_0x2f9979(0x19d)]=void 0x0;function a188_0x2d54(_0xe015a9,_0x1ed405){const _0x4387b4=a188_0x4991();return a188_0x2d54=function(_0x24572b,_0x530015){_0x24572b=_0x24572b-0x148;let _0x499100=_0x4387b4[_0x24572b];return _0x499100;},a188_0x2d54(_0xe015a9,_0x1ed405);}const constants_1=require(a188_0x2f9979(0x180)),core_1=require(a188_0x2f9979(0x194)),too_many_requests_error_1=require(a188_0x2f9979(0x1a9)),flosum_repository_sync_dto_1=require(a188_0x2f9979(0x188)),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_logger_v2_service_1=require(a188_0x2f9979(0x161)),salesforce_sync_service_1=require(a188_0x2f9979(0x15b)),salesforce_service_1=require(a188_0x2f9979(0x198)),git_provider_manager_1=require(a188_0x2f9979(0x1ab)),utils_1=require(a188_0x2f9979(0x171)),typedi_1=__importStar(require(a188_0x2f9979(0x1b6))),hooks_utils_1=require(a188_0x2f9979(0x14a)),git_branch_not_found_error_1=require(a188_0x2f9979(0x1a4)),flosum_sync_job_1=require(a188_0x2f9979(0x1b9)),git_sync_job_1=require(a188_0x2f9979(0x16c));function a188_0x4991(){const _0x323f6a=['Error','salesforceSync','10NSHgMX','name','constructor','GitSyncJob','gitManager','decorate','__createBinding','../../salesforce/services/salesforce-sync.service','__decorate','HooksUtils','repositoriesIntersections','\x27\x20in\x20repository\x20\x27','apply','../../salesforce/services/salesforce-logger-v2.service','toLowerCase','search','SyncDirection','getOrCreateRepo','repoList','setStatus','logger','catch','18684DRzYfJ','\x27\x20[','../jobs/git-sync.job','send','4824105hnOOwa','error','length','../../shared/utils','default','repoService','527lxOwfJ','call','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','REPOSITORY_NAME_REGEXP','all','repositoryName','__metadata','syncID','getAll','create','338517RBWFmU','Unable\x20to\x20synchronize\x20branch\x20\x27','../../../constants','8UxEbBl','4919490SeLqxL','function','133vEhpfq','log','hasOwnProperty','36276wWmOFV','../../salesforce/dto/flosum-repository-sync.dto','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','branchName','Unable\x20to\x20synchronize\x20repository\x20\x27','FlosumToGit','sfLogger','gitUrl','Logger','GitProviderManager','object','get','isIntersects','../../../core','find','GitBranchNotFoundError','metadata','../../salesforce/services/salesforce.service','__importStar','SalesforceSyncService','defineProperty','SalesforceError','SyncService','test','(((.+)+)+)+$','syncing\x20%s[%s]\x20repository\x20%s[%s]\x20branch','push','repositoryId','[INFO]\x20Sync\x20job\x20done.','../errors/git-branch-not-found.error','Waiting','4162lNiukZ','toString','[INFO]\x20Repository\x20\x22','../../../core/errors/too-many-requests.error','getBranchRecords','../../shared/git-provider.manager','url','FlosumSyncJob','1507032UFoCEA','getRepositoryRecords','run','syncDto','checkValidNaming','216aeExCw','[ERROR]\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','hooks','typedi','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','Not\x20Synchronized','../jobs/flosum-sync.job','[ERROR]\x20Stop\x20sync\x20job\x20for\x20\x27','createHookPayload','createHooks','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','BRANCH_NAME_REGEXP','handleRecordSyncError','../../hooks/hooks.utils','TooManyRequests','__setModuleDefault','disableSync',']\x20due\x20error\x20-\x20','__esModule','toUpperCase','650OKUZTp'];a188_0x4991=function(){return _0x323f6a;};return a188_0x4991();}let SyncService=SyncService_1=class SyncService{constructor(_0x19c737,_0x39488d,_0xc44cc6){const _0x541f6a=a188_0x2f9979;this['salesforceService']=_0x19c737,this[_0x541f6a(0x153)]=_0x39488d,this[_0x541f6a(0x158)]=_0xc44cc6,this[_0x541f6a(0x168)]=new core_1[(_0x541f6a(0x18f))](SyncService_1['name']),this['repositoriesIntersections']={},this['repoList']=[];}async['handleRecordSyncError'](_0x57f7a3,_0x58e188){const _0x4c131d=a188_0x2f9979;if(_0x58e188 instanceof git_branch_not_found_error_1[_0x4c131d(0x196)]){await this[_0x4c131d(0x153)][_0x4c131d(0x167)](_0x57f7a3,_0x4c131d(0x1b8));return;}if(_0x58e188 instanceof too_many_requests_error_1['TooManyRequests']){await this[_0x4c131d(0x153)][_0x4c131d(0x167)](_0x57f7a3,_0x4c131d(0x1a5));throw _0x58e188;}try{await this[_0x4c131d(0x18d)][_0x4c131d(0x185)](_0x4c131d(0x1ba)+_0x57f7a3[_0x4c131d(0x179)]+_0x4c131d(0x16b)+_0x57f7a3['branchName']+_0x4c131d(0x14e)+_0x58e188)[_0x4c131d(0x16d)](),await this[_0x4c131d(0x153)]['updateRemoteState'](_0x57f7a3,{}),await this[_0x4c131d(0x153)][_0x4c131d(0x167)](_0x57f7a3,_0x4c131d(0x152));}catch(_0x3e018a){if(_0x3e018a instanceof salesforce_error_1[_0x4c131d(0x19c)])throw _0x3e018a;}}async['isIntersects'](_0x3c840b){const _0x595bbe=a188_0x2f9979;if(_0x3c840b[_0x595bbe(0x1a2)]){const _0x1720da=_0x3c840b[_0x595bbe(0x179)][_0x595bbe(0x162)](),_0x560531=this[_0x595bbe(0x15e)][_0x1720da];if(!_0x560531)this[_0x595bbe(0x15e)][_0x1720da]=_0x3c840b[_0x595bbe(0x179)];else{if(_0x560531&&_0x560531!==_0x3c840b[_0x595bbe(0x179)])return await this['handleRecordSyncError'](_0x3c840b,new Error(_0x595bbe(0x18b)+_0x3c840b[_0x595bbe(0x179)]+_0x595bbe(0x189)+_0x1720da+'\x27\x20-\x20\x27'+_0x560531+'\x27')),!![];}}return![];}async['checkValidNaming'](_0x207978){const _0x10f772=a188_0x2f9979;if(!constants_1[_0x10f772(0x177)][_0x10f772(0x19e)](_0x207978['repositoryName']))return await this[_0x10f772(0x149)](_0x207978,new Error(_0x10f772(0x18b)+_0x207978[_0x10f772(0x179)]+_0x10f772(0x1bd))),![];if(!constants_1[_0x10f772(0x148)][_0x10f772(0x19e)](_0x207978['branchName']))return await this[_0x10f772(0x149)](_0x207978,new Error(_0x10f772(0x17f)+_0x207978[_0x10f772(0x18a)]+_0x10f772(0x15f)+_0x207978[_0x10f772(0x179)]+_0x10f772(0x1b7))),![];return!![];}async[a188_0x2f9979(0x165)](_0xf275a5,_0x4d1585,_0x2aeff2){const _0xc33308=a188_0x2f9979;let _0x4bcf9c=this[_0xc33308(0x166)][_0xc33308(0x195)](_0x56a09e=>_0xf275a5[_0xc33308(0x179)]===_0x56a09e[_0xc33308(0x155)]);!_0x4bcf9c&&(this[_0xc33308(0x18d)]['log'](_0xc33308(0x1a8)+_0xf275a5[_0xc33308(0x179)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x4bcf9c=await this['repoService'][_0xc33308(0x17d)]({'name':_0xf275a5['repositoryName'],'autoInit':!![],'defaultBranch':_0xf275a5['branchName'],'private':!![],'createHook':this[_0xc33308(0x1b1)]['createHooks']}));if(this[_0xc33308(0x1b1)][_0xc33308(0x1bc)]){const _0x2156d6=await _0x4bcf9c[_0xc33308(0x1b5)][_0xc33308(0x17c)]();!_0x2156d6[_0xc33308(0x195)](_0x3c3ddb=>_0x3c3ddb[_0xc33308(0x1ac)]===hooks_utils_1[_0xc33308(0x15d)]['getHookLinkFor'](_0x4d1585,_0x2aeff2))&&(this[_0xc33308(0x18d)][_0xc33308(0x185)](_0xc33308(0x1a8)+_0xf275a5[_0xc33308(0x179)]+_0xc33308(0x176)),await _0x4bcf9c['hooks']['create'](hooks_utils_1[_0xc33308(0x15d)][_0xc33308(0x1bb)](_0x4d1585,_0x4bcf9c[_0xc33308(0x1b5)],_0x2aeff2)));}return this[_0xc33308(0x166)][_0xc33308(0x1a1)](_0x4bcf9c),_0x4bcf9c;}async[a188_0x2f9979(0x1b0)](_0xcb8a71,_0x54781a,_0x4b1c58,_0x51daec){const _0x2c7f5a=a188_0x2f9979;this['salesforceService']['setLoggerId'](_0x54781a),this[_0x2c7f5a(0x173)]=this[_0x2c7f5a(0x158)]['getRepoService'](_0x4b1c58),this['sfLogger']=new salesforce_logger_v2_service_1['SalesforceLogger2'](_0x54781a,'['+SyncService_1[_0x2c7f5a(0x155)]+']\x20['+_0x4b1c58[_0x2c7f5a(0x150)]()+']'),this[_0x2c7f5a(0x1b1)]=_0xcb8a71;try{await this[_0x2c7f5a(0x18d)]['log']('[INFO]\x20Start\x20sync\x20job')[_0x2c7f5a(0x16d)]();const [_0x4d387b,_0x2c365e]=await Promise[_0x2c7f5a(0x178)]([this[_0x2c7f5a(0x153)][_0x2c7f5a(0x1aa)](),this[_0x2c7f5a(0x153)][_0x2c7f5a(0x1af)]()]);this[_0x2c7f5a(0x166)]=await this[_0x2c7f5a(0x173)][_0x2c7f5a(0x17c)]();const _0x144f3a=[..._0x2c365e,..._0x4d387b];this[_0x2c7f5a(0x168)][_0x2c7f5a(0x185)]('have\x20to\x20synchronize\x20%d\x20branches',_0x144f3a[_0x2c7f5a(0x170)]);for(const _0x2e8773 of _0x144f3a){this['logger'][_0x2c7f5a(0x185)](_0x2c7f5a(0x1a0),_0x2e8773[_0x2c7f5a(0x179)],_0x2e8773[_0x2c7f5a(0x1a2)],_0x2e8773[_0x2c7f5a(0x18a)],_0x2e8773['branchId']);const _0x23e513=await this[_0x2c7f5a(0x1b2)](_0x2e8773);if(!_0x23e513)continue;const _0xfe488e=await this[_0x2c7f5a(0x193)](_0x2e8773);if(_0xfe488e)continue;let _0x759702;try{_0x759702=await this['getOrCreateRepo'](_0x2e8773,_0x4b1c58,_0x51daec);}catch(_0x2769d8){await this[_0x2c7f5a(0x149)](_0x2e8773,_0x2769d8 instanceof too_many_requests_error_1[_0x2c7f5a(0x14b)]?_0x2769d8:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x2769d8));continue;}await this['sfLogger'][_0x2c7f5a(0x16d)]();if(_0x2e8773['direction']===flosum_repository_sync_dto_1[_0x2c7f5a(0x164)][_0x2c7f5a(0x18c)]){const _0x13b743=typedi_1[_0x2c7f5a(0x172)][_0x2c7f5a(0x192)](flosum_sync_job_1[_0x2c7f5a(0x1ad)]);await _0x13b743[_0x2c7f5a(0x1b0)]({'repository':_0x759702,'convertToSFDX':_0xcb8a71['convertToSFDX'],'syncRecord':_0x2e8773,'provider':_0x4b1c58,'logger':this[_0x2c7f5a(0x18d)]})['catch'](_0x433e2e=>this[_0x2c7f5a(0x149)](_0x2e8773,_0x433e2e));}else{const _0x47bed6=typedi_1['default'][_0x2c7f5a(0x192)](git_sync_job_1[_0x2c7f5a(0x157)]);await _0x47bed6[_0x2c7f5a(0x1b0)]({'repository':_0x759702,'branch':_0x2e8773[_0x2c7f5a(0x18a)],'provider':_0x4b1c58,'repositoryGit':_0x759702[_0x2c7f5a(0x18e)],'syncRecord':_0x2e8773,'logger':this['sfLogger']})[_0x2c7f5a(0x169)](_0x3874f0=>this['handleRecordSyncError'](_0x2e8773,_0x3874f0));}}}catch(_0x21bb5d){this['logger'][_0x2c7f5a(0x16f)](_0x21bb5d);_0x21bb5d instanceof too_many_requests_error_1[_0x2c7f5a(0x14b)]?(await this[_0x2c7f5a(0x18d)]['log']('[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.')['send'](),await utils_1['sleep'](0x3c*0x3c*0x3e8),this['run'](_0xcb8a71,_0x54781a,_0x4b1c58,_0x51daec)):await this['sfLogger']['log'](_0x2c7f5a(0x1b4)+_0x21bb5d)[_0x2c7f5a(0x16d)]();return;}await this['sfLogger'][_0x2c7f5a(0x185)](_0x2c7f5a(0x1a3))['send'](),await this[_0x2c7f5a(0x153)][_0x2c7f5a(0x14d)](_0xcb8a71[_0x2c7f5a(0x17b)])[_0x2c7f5a(0x169)](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a188_0x2f9979(0x19a)],git_provider_manager_1[a188_0x2f9979(0x190)]])],SyncService),exports[a188_0x2f9979(0x19d)]=SyncService;