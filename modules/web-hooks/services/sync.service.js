const a187_0x23e0ac=a187_0x16c1;(function(_0x25e41b,_0x323a5c){const _0x2b635c=a187_0x16c1,_0x557f1f=_0x25e41b();while(!![]){try{const _0x1fbec4=parseInt(_0x2b635c(0x226))/0x1*(-parseInt(_0x2b635c(0x20a))/0x2)+-parseInt(_0x2b635c(0x228))/0x3*(parseInt(_0x2b635c(0x20c))/0x4)+parseInt(_0x2b635c(0x1f2))/0x5+parseInt(_0x2b635c(0x1ce))/0x6+-parseInt(_0x2b635c(0x206))/0x7+-parseInt(_0x2b635c(0x22b))/0x8+-parseInt(_0x2b635c(0x20d))/0x9*(-parseInt(_0x2b635c(0x211))/0xa);if(_0x1fbec4===_0x323a5c)break;else _0x557f1f['push'](_0x557f1f['shift']());}catch(_0x5664ca){_0x557f1f['push'](_0x557f1f['shift']());}}}(a187_0x5712,0x506e7));const a187_0x49dce9=(function(){let _0x534b53=!![];return function(_0x43b051,_0x264ec5){const _0x48088a=_0x534b53?function(){const _0x534987=a187_0x16c1;if(_0x264ec5){const _0x7d5c9b=_0x264ec5[_0x534987(0x231)](_0x43b051,arguments);return _0x264ec5=null,_0x7d5c9b;}}:function(){};return _0x534b53=![],_0x48088a;};}()),a187_0x4a8b28=a187_0x49dce9(this,function(){const _0x2689ab=a187_0x16c1;return a187_0x4a8b28[_0x2689ab(0x213)]()[_0x2689ab(0x1fa)](_0x2689ab(0x1de))[_0x2689ab(0x213)]()[_0x2689ab(0x1da)](a187_0x4a8b28)[_0x2689ab(0x1fa)](_0x2689ab(0x1de));});a187_0x4a8b28();'use strict';function a187_0x16c1(_0x6eb887,_0x1c95f9){const _0x13b17b=a187_0x5712();return a187_0x16c1=function(_0x4a8b28,_0x49dce9){_0x4a8b28=_0x4a8b28-0x1cc;let _0x571262=_0x13b17b[_0x4a8b28];return _0x571262;},a187_0x16c1(_0x6eb887,_0x1c95f9);}var __createBinding=this&&this['__createBinding']||(Object[a187_0x23e0ac(0x238)]?function(_0xe31b18,_0xa7a34d,_0x29ce66,_0xdd30cf){const _0x46f7e8=a187_0x23e0ac;if(_0xdd30cf===undefined)_0xdd30cf=_0x29ce66;Object[_0x46f7e8(0x219)](_0xe31b18,_0xdd30cf,{'enumerable':!![],'get':function(){return _0xa7a34d[_0x29ce66];}});}:function(_0x1554fa,_0x303981,_0x30ee4d,_0x3cac16){if(_0x3cac16===undefined)_0x3cac16=_0x30ee4d;_0x1554fa[_0x3cac16]=_0x303981[_0x30ee4d];}),__setModuleDefault=this&&this[a187_0x23e0ac(0x227)]||(Object['create']?function(_0x399327,_0x2046ca){const _0x238f9e=a187_0x23e0ac;Object[_0x238f9e(0x219)](_0x399327,_0x238f9e(0x223),{'enumerable':!![],'value':_0x2046ca});}:function(_0x36495d,_0x5a1dcf){_0x36495d['default']=_0x5a1dcf;}),__decorate=this&&this[a187_0x23e0ac(0x1e4)]||function(_0x2dc39,_0x4ef61e,_0x1233ac,_0x3a0163){const _0x832e4b=a187_0x23e0ac;var _0x3c36f2=arguments[_0x832e4b(0x1f5)],_0x2a47ea=_0x3c36f2<0x3?_0x4ef61e:_0x3a0163===null?_0x3a0163=Object[_0x832e4b(0x1cf)](_0x4ef61e,_0x1233ac):_0x3a0163,_0x310614;if(typeof Reflect===_0x832e4b(0x1e9)&&typeof Reflect['decorate']===_0x832e4b(0x1d2))_0x2a47ea=Reflect[_0x832e4b(0x1d1)](_0x2dc39,_0x4ef61e,_0x1233ac,_0x3a0163);else{for(var _0x10c2ac=_0x2dc39['length']-0x1;_0x10c2ac>=0x0;_0x10c2ac--)if(_0x310614=_0x2dc39[_0x10c2ac])_0x2a47ea=(_0x3c36f2<0x3?_0x310614(_0x2a47ea):_0x3c36f2>0x3?_0x310614(_0x4ef61e,_0x1233ac,_0x2a47ea):_0x310614(_0x4ef61e,_0x1233ac))||_0x2a47ea;}return _0x3c36f2>0x3&&_0x2a47ea&&Object[_0x832e4b(0x219)](_0x4ef61e,_0x1233ac,_0x2a47ea),_0x2a47ea;},__importStar=this&&this[a187_0x23e0ac(0x22a)]||function(_0x531169){const _0x56eaea=a187_0x23e0ac;if(_0x531169&&_0x531169[_0x56eaea(0x1dc)])return _0x531169;var _0x41e9da={};if(_0x531169!=null){for(var _0x59532a in _0x531169)if(_0x59532a!==_0x56eaea(0x223)&&Object[_0x56eaea(0x1ec)][_0x56eaea(0x232)][_0x56eaea(0x1e3)](_0x531169,_0x59532a))__createBinding(_0x41e9da,_0x531169,_0x59532a);}return __setModuleDefault(_0x41e9da,_0x531169),_0x41e9da;},__metadata=this&&this['__metadata']||function(_0x296e2b,_0x4aae58){const _0x3c5bd9=a187_0x23e0ac;if(typeof Reflect===_0x3c5bd9(0x1e9)&&typeof Reflect['metadata']===_0x3c5bd9(0x1d2))return Reflect[_0x3c5bd9(0x1ee)](_0x296e2b,_0x4aae58);},SyncService_1;function a187_0x5712(){const _0x4148ed=['3nckXWe','run','__importStar','1162904jNAiWw','syncDto','name','Logger','[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','updateRemoteState','apply','hasOwnProperty','gitManager','../../shared/git-provider.manager','all','../../salesforce/services/salesforce.service','disableSync','create','log','\x27\x20[','\x27\x20-\x20\x27','Error','168210XlJhba','getOwnPropertyDescriptor','send','decorate','function','Not\x20Synchronized','checkValidNaming','setLoggerId','../../../core','get','gitUrl','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','constructor',']\x20[','__esModule','../../hooks/hooks.utils','(((.+)+)+)+$','GitProviderManager','getBranchRecords','hooks','convertToSFDX','call','__decorate','direction','syncing\x20%s[%s]\x20repository\x20%s[%s]\x20branch','REPOSITORY_NAME_REGEXP','getOrCreateRepo','object','[INFO]\x20Repository\x20\x22','\x27\x20in\x20repository\x20\x27','prototype','createHooks','metadata','repoService','isIntersects','error','1723320tuyUkP','logger','branchName','length','FlosumToGit','../../shared/utils','[INFO]\x20Start\x20sync\x20job','Unable\x20to\x20synchronize\x20branch\x20\x27','search','setStatus','Unable\x20to\x20synchronize\x20repository\x20\x27','BRANCH_NAME_REGEXP','syncID','handleRecordSyncError','SyncDirection','../../salesforce/services/salesforce-sync.service','getRepositoryRecords','getAll','../../../core/errors/too-many-requests.error','repositoryId','558691XMPGAk','branchId','test','repositoriesIntersections','327298OBmQxh','salesforceSync','1638564fUHIRY','3438OKeZgw','HooksUtils','[ERROR]\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','19770rneruk','sfLogger','toString','push','Waiting','FlosumSyncJob','getHookLinkFor','GitBranchNotFoundError','defineProperty','url','../jobs/git-sync.job','repoList','toUpperCase','salesforceService','TooManyRequests',']\x20due\x20error\x20-\x20','getRepoService','catch','default','repositoryName','../../salesforce/dto/flosum-repository-sync.dto','1uVqEUx','__setModuleDefault'];a187_0x5712=function(){return _0x4148ed;};return a187_0x5712();}Object[a187_0x23e0ac(0x219)](exports,a187_0x23e0ac(0x1dc),{'value':!![]}),exports['SyncService']=void 0x0;const constants_1=require('../../../constants'),core_1=require(a187_0x23e0ac(0x1d6)),too_many_requests_error_1=require(a187_0x23e0ac(0x204)),flosum_repository_sync_dto_1=require(a187_0x23e0ac(0x225)),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_logger_v2_service_1=require('../../salesforce/services/salesforce-logger-v2.service'),salesforce_sync_service_1=require(a187_0x23e0ac(0x201)),salesforce_service_1=require(a187_0x23e0ac(0x236)),git_provider_manager_1=require(a187_0x23e0ac(0x234)),utils_1=require(a187_0x23e0ac(0x1f7)),typedi_1=__importStar(require('typedi')),hooks_utils_1=require(a187_0x23e0ac(0x1dd)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require(a187_0x23e0ac(0x21b));let SyncService=SyncService_1=class SyncService{constructor(_0x5c1f1a,_0x1710e0,_0x987e19){const _0x584604=a187_0x23e0ac;this['salesforceService']=_0x5c1f1a,this['salesforceSync']=_0x1710e0,this[_0x584604(0x233)]=_0x987e19,this[_0x584604(0x1f3)]=new core_1[(_0x584604(0x22e))](SyncService_1[_0x584604(0x22d)]),this[_0x584604(0x209)]={},this[_0x584604(0x21c)]=[];}async[a187_0x23e0ac(0x1ff)](_0x4c1262,_0x488154){const _0x2898f1=a187_0x23e0ac;if(_0x488154 instanceof git_branch_not_found_error_1[_0x2898f1(0x218)]){await this['salesforceSync']['setStatus'](_0x4c1262,_0x2898f1(0x1d3));return;}if(_0x488154 instanceof too_many_requests_error_1['TooManyRequests']){await this[_0x2898f1(0x20b)][_0x2898f1(0x1fb)](_0x4c1262,_0x2898f1(0x215));throw _0x488154;}try{await this[_0x2898f1(0x212)][_0x2898f1(0x239)]('[ERROR]\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x4c1262[_0x2898f1(0x224)]+_0x2898f1(0x23a)+_0x4c1262['branchName']+_0x2898f1(0x220)+_0x488154)[_0x2898f1(0x1d0)](),await this['salesforceSync'][_0x2898f1(0x230)](_0x4c1262,{}),await this[_0x2898f1(0x20b)][_0x2898f1(0x1fb)](_0x4c1262,_0x2898f1(0x1cd));}catch(_0x24edc1){if(_0x24edc1 instanceof salesforce_error_1['SalesforceError'])throw _0x24edc1;}}async['isIntersects'](_0xf3a0b){const _0x2b5f8b=a187_0x23e0ac;if(_0xf3a0b[_0x2b5f8b(0x205)]){const _0x5bdf9b=_0xf3a0b[_0x2b5f8b(0x224)]['toLowerCase'](),_0x42e416=this[_0x2b5f8b(0x209)][_0x5bdf9b];if(!_0x42e416)this[_0x2b5f8b(0x209)][_0x5bdf9b]=_0xf3a0b['repositoryName'];else{if(_0x42e416&&_0x42e416!==_0xf3a0b[_0x2b5f8b(0x224)])return await this[_0x2b5f8b(0x1ff)](_0xf3a0b,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0xf3a0b[_0x2b5f8b(0x224)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x5bdf9b+_0x2b5f8b(0x1cc)+_0x42e416+'\x27')),!![];}}return![];}async['checkValidNaming'](_0x55c319){const _0x2fc2ce=a187_0x23e0ac;if(!constants_1[_0x2fc2ce(0x1e7)][_0x2fc2ce(0x208)](_0x55c319[_0x2fc2ce(0x224)]))return await this[_0x2fc2ce(0x1ff)](_0x55c319,new Error(_0x2fc2ce(0x1fc)+_0x55c319['repositoryName']+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x2fc2ce(0x1fd)][_0x2fc2ce(0x208)](_0x55c319[_0x2fc2ce(0x1f4)]))return await this[_0x2fc2ce(0x1ff)](_0x55c319,new Error(_0x2fc2ce(0x1f9)+_0x55c319[_0x2fc2ce(0x1f4)]+_0x2fc2ce(0x1eb)+_0x55c319[_0x2fc2ce(0x224)]+_0x2fc2ce(0x1d9))),![];return!![];}async['getOrCreateRepo'](_0x508645,_0xa9eb7f,_0x4f4acc){const _0xa791b2=a187_0x23e0ac;let _0x801d47=this[_0xa791b2(0x21c)]['find'](_0x395da2=>_0x508645[_0xa791b2(0x224)]===_0x395da2[_0xa791b2(0x22d)]);!_0x801d47&&(this[_0xa791b2(0x212)][_0xa791b2(0x239)](_0xa791b2(0x1ea)+_0x508645[_0xa791b2(0x224)]+_0xa791b2(0x210)),_0x801d47=await this[_0xa791b2(0x1ef)][_0xa791b2(0x238)]({'name':_0x508645[_0xa791b2(0x224)],'autoInit':!![],'defaultBranch':_0x508645[_0xa791b2(0x1f4)],'private':!![],'createHook':this[_0xa791b2(0x22c)][_0xa791b2(0x1ed)]}));if(this['syncDto'][_0xa791b2(0x1ed)]){const _0x1f71f1=await _0x801d47[_0xa791b2(0x1e1)][_0xa791b2(0x203)]();!_0x1f71f1['find'](_0x277e1f=>_0x277e1f[_0xa791b2(0x21a)]===hooks_utils_1[_0xa791b2(0x20e)][_0xa791b2(0x217)](_0xa9eb7f,_0x4f4acc))&&(this['sfLogger'][_0xa791b2(0x239)]('[INFO]\x20Repository\x20\x22'+_0x508645[_0xa791b2(0x224)]+'\x22\x20does\x20not\x20has\x20the\x20agent\x20webhook.\x20Creating\x20a\x20new\x20one.'),await _0x801d47['hooks'][_0xa791b2(0x238)](hooks_utils_1[_0xa791b2(0x20e)]['createHookPayload'](_0xa9eb7f,_0x801d47[_0xa791b2(0x1e1)],_0x4f4acc)));}return this[_0xa791b2(0x21c)][_0xa791b2(0x214)](_0x801d47),_0x801d47;}async[a187_0x23e0ac(0x229)](_0x1124bd,_0x5290cb,_0x565139,_0xf59659){const _0x57094b=a187_0x23e0ac;this[_0x57094b(0x21e)][_0x57094b(0x1d5)](_0x5290cb),this[_0x57094b(0x1ef)]=this[_0x57094b(0x233)][_0x57094b(0x221)](_0x565139),this[_0x57094b(0x212)]=new salesforce_logger_v2_service_1['SalesforceLogger2'](_0x5290cb,'['+SyncService_1[_0x57094b(0x22d)]+_0x57094b(0x1db)+_0x565139[_0x57094b(0x21d)]()+']'),this[_0x57094b(0x22c)]=_0x1124bd;try{await this[_0x57094b(0x212)][_0x57094b(0x239)](_0x57094b(0x1f8))['send']();const [_0x379647,_0x5b5a38]=await Promise[_0x57094b(0x235)]([this['salesforceSync'][_0x57094b(0x1e0)](),this[_0x57094b(0x20b)][_0x57094b(0x202)]()]);this[_0x57094b(0x21c)]=await this[_0x57094b(0x1ef)][_0x57094b(0x203)]();const _0x353fc3=[..._0x5b5a38,..._0x379647];this[_0x57094b(0x1f3)][_0x57094b(0x239)]('have\x20to\x20synchronize\x20%d\x20branches',_0x353fc3[_0x57094b(0x1f5)]);for(const _0x35b21d of _0x353fc3){this[_0x57094b(0x1f3)][_0x57094b(0x239)](_0x57094b(0x1e6),_0x35b21d['repositoryName'],_0x35b21d['repositoryId'],_0x35b21d[_0x57094b(0x1f4)],_0x35b21d[_0x57094b(0x207)]);const _0xa9b45b=await this[_0x57094b(0x1d4)](_0x35b21d);if(!_0xa9b45b)continue;const _0x4dd281=await this[_0x57094b(0x1f0)](_0x35b21d);if(_0x4dd281)continue;let _0x25a056;try{_0x25a056=await this[_0x57094b(0x1e8)](_0x35b21d,_0x565139,_0xf59659);}catch(_0x44c5a3){await this[_0x57094b(0x1ff)](_0x35b21d,_0x44c5a3 instanceof too_many_requests_error_1['TooManyRequests']?_0x44c5a3:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x44c5a3));continue;}await this[_0x57094b(0x212)]['send']();if(_0x35b21d[_0x57094b(0x1e5)]===flosum_repository_sync_dto_1[_0x57094b(0x200)][_0x57094b(0x1f6)]){const _0x56e65d=typedi_1[_0x57094b(0x223)][_0x57094b(0x1d7)](flosum_sync_job_1[_0x57094b(0x216)]);await _0x56e65d[_0x57094b(0x229)]({'repository':_0x25a056,'convertToSFDX':_0x1124bd[_0x57094b(0x1e2)],'syncRecord':_0x35b21d,'provider':_0x565139,'logger':this[_0x57094b(0x212)]})[_0x57094b(0x222)](_0x35c13c=>this[_0x57094b(0x1ff)](_0x35b21d,_0x35c13c));}else{const _0x537465=typedi_1[_0x57094b(0x223)][_0x57094b(0x1d7)](git_sync_job_1['GitSyncJob']);await _0x537465['run']({'repository':_0x25a056,'branch':_0x35b21d[_0x57094b(0x1f4)],'provider':_0x565139,'repositoryGit':_0x25a056[_0x57094b(0x1d8)],'syncRecord':_0x35b21d,'logger':this['sfLogger']})['catch'](_0x3c2e64=>this[_0x57094b(0x1ff)](_0x35b21d,_0x3c2e64));}}}catch(_0x4515b4){this[_0x57094b(0x1f3)][_0x57094b(0x1f1)](_0x4515b4);_0x4515b4 instanceof too_many_requests_error_1[_0x57094b(0x21f)]?(await this[_0x57094b(0x212)][_0x57094b(0x239)](_0x57094b(0x22f))[_0x57094b(0x1d0)](),await utils_1['sleep'](0x3c*0x3c*0x3e8),this['run'](_0x1124bd,_0x5290cb,_0x565139,_0xf59659)):await this[_0x57094b(0x212)][_0x57094b(0x239)](_0x57094b(0x20f)+_0x4515b4)['send']();return;}await this[_0x57094b(0x212)]['log']('[INFO]\x20Sync\x20job\x20done.')[_0x57094b(0x1d0)](),await this[_0x57094b(0x20b)][_0x57094b(0x237)](_0x1124bd[_0x57094b(0x1fe)])[_0x57094b(0x222)](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1['SalesforceService'],salesforce_sync_service_1['SalesforceSyncService'],git_provider_manager_1[a187_0x23e0ac(0x1df)]])],SyncService),exports['SyncService']=SyncService;