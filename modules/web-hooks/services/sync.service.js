function a189_0x305f(_0x34050c,_0x229be1){const _0x2d157a=a189_0x4c17();return a189_0x305f=function(_0x5303c3,_0x38b8c2){_0x5303c3=_0x5303c3-0x159;let _0x4c1756=_0x2d157a[_0x5303c3];return _0x4c1756;},a189_0x305f(_0x34050c,_0x229be1);}const a189_0x428737=a189_0x305f;(function(_0x17cf50,_0x342727){const _0x46ffa0=a189_0x305f,_0x1fd5c9=_0x17cf50();while(!![]){try{const _0x203db3=-parseInt(_0x46ffa0(0x16f))/0x1+-parseInt(_0x46ffa0(0x196))/0x2*(parseInt(_0x46ffa0(0x1bd))/0x3)+-parseInt(_0x46ffa0(0x19f))/0x4+-parseInt(_0x46ffa0(0x16d))/0x5*(-parseInt(_0x46ffa0(0x18d))/0x6)+parseInt(_0x46ffa0(0x1a4))/0x7*(parseInt(_0x46ffa0(0x18b))/0x8)+-parseInt(_0x46ffa0(0x166))/0x9*(parseInt(_0x46ffa0(0x160))/0xa)+parseInt(_0x46ffa0(0x18e))/0xb;if(_0x203db3===_0x342727)break;else _0x1fd5c9['push'](_0x1fd5c9['shift']());}catch(_0x42d495){_0x1fd5c9['push'](_0x1fd5c9['shift']());}}}(a189_0x4c17,0xc9e63));const a189_0x38b8c2=(function(){let _0x2b6d25=!![];return function(_0x55120f,_0x22fc09){const _0x1c4cff=_0x2b6d25?function(){const _0x4255d9=a189_0x305f;if(_0x22fc09){const _0x56ea69=_0x22fc09[_0x4255d9(0x15b)](_0x55120f,arguments);return _0x22fc09=null,_0x56ea69;}}:function(){};return _0x2b6d25=![],_0x1c4cff;};}()),a189_0x5303c3=a189_0x38b8c2(this,function(){const _0x16ae05=a189_0x305f;return a189_0x5303c3['toString']()[_0x16ae05(0x18c)](_0x16ae05(0x15d))[_0x16ae05(0x175)]()['constructor'](a189_0x5303c3)[_0x16ae05(0x18c)](_0x16ae05(0x15d));});a189_0x5303c3();'use strict';var __createBinding=this&&this[a189_0x428737(0x1b7)]||(Object[a189_0x428737(0x1bb)]?function(_0x2f5410,_0x41cc7b,_0x1d8fbd,_0x2b2c55){if(_0x2b2c55===undefined)_0x2b2c55=_0x1d8fbd;Object['defineProperty'](_0x2f5410,_0x2b2c55,{'enumerable':!![],'get':function(){return _0x41cc7b[_0x1d8fbd];}});}:function(_0x148f13,_0x156f14,_0x488327,_0x5ca44a){if(_0x5ca44a===undefined)_0x5ca44a=_0x488327;_0x148f13[_0x5ca44a]=_0x156f14[_0x488327];}),__setModuleDefault=this&&this[a189_0x428737(0x1af)]||(Object[a189_0x428737(0x1bb)]?function(_0x710cdf,_0x133695){const _0x2597f7=a189_0x428737;Object[_0x2597f7(0x1b2)](_0x710cdf,_0x2597f7(0x1b3),{'enumerable':!![],'value':_0x133695});}:function(_0x134b26,_0x166c6c){const _0x3387a6=a189_0x428737;_0x134b26[_0x3387a6(0x1b3)]=_0x166c6c;}),__decorate=this&&this['__decorate']||function(_0x18d538,_0x444ef1,_0x26220f,_0x406ada){const _0x2047b5=a189_0x428737;var _0x545f72=arguments[_0x2047b5(0x1b0)],_0x28bd93=_0x545f72<0x3?_0x444ef1:_0x406ada===null?_0x406ada=Object[_0x2047b5(0x1bf)](_0x444ef1,_0x26220f):_0x406ada,_0x57a89e;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x2047b5(0x1b9))_0x28bd93=Reflect[_0x2047b5(0x184)](_0x18d538,_0x444ef1,_0x26220f,_0x406ada);else{for(var _0xd974af=_0x18d538[_0x2047b5(0x1b0)]-0x1;_0xd974af>=0x0;_0xd974af--)if(_0x57a89e=_0x18d538[_0xd974af])_0x28bd93=(_0x545f72<0x3?_0x57a89e(_0x28bd93):_0x545f72>0x3?_0x57a89e(_0x444ef1,_0x26220f,_0x28bd93):_0x57a89e(_0x444ef1,_0x26220f))||_0x28bd93;}return _0x545f72>0x3&&_0x28bd93&&Object[_0x2047b5(0x1b2)](_0x444ef1,_0x26220f,_0x28bd93),_0x28bd93;},__importStar=this&&this[a189_0x428737(0x1a6)]||function(_0x4c3f07){const _0xb1343e=a189_0x428737;if(_0x4c3f07&&_0x4c3f07[_0xb1343e(0x173)])return _0x4c3f07;var _0xef7e41={};if(_0x4c3f07!=null){for(var _0x3ed3fa in _0x4c3f07)if(_0x3ed3fa!==_0xb1343e(0x1b3)&&Object['prototype']['hasOwnProperty'][_0xb1343e(0x1cb)](_0x4c3f07,_0x3ed3fa))__createBinding(_0xef7e41,_0x4c3f07,_0x3ed3fa);}return __setModuleDefault(_0xef7e41,_0x4c3f07),_0xef7e41;},__metadata=this&&this['__metadata']||function(_0x4cff8d,_0x4eaba4){const _0x127195=a189_0x428737;if(typeof Reflect===_0x127195(0x1ab)&&typeof Reflect[_0x127195(0x1b1)]===_0x127195(0x1b9))return Reflect[_0x127195(0x1b1)](_0x4cff8d,_0x4eaba4);},SyncService_1;Object[a189_0x428737(0x1b2)](exports,'__esModule',{'value':!![]}),exports[a189_0x428737(0x1a1)]=void 0x0;const constants_1=require(a189_0x428737(0x1a9)),core_1=require(a189_0x428737(0x1ba)),too_many_requests_error_1=require(a189_0x428737(0x186)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_logger_v2_service_1=require(a189_0x428737(0x161)),salesforce_sync_service_1=require(a189_0x428737(0x1b4)),salesforce_service_1=require(a189_0x428737(0x170)),git_provider_manager_1=require(a189_0x428737(0x1c1)),utils_1=require(a189_0x428737(0x16c)),typedi_1=__importStar(require(a189_0x428737(0x19b))),hooks_utils_1=require(a189_0x428737(0x15f)),git_branch_not_found_error_1=require(a189_0x428737(0x18f)),flosum_sync_job_1=require(a189_0x428737(0x1ad)),git_sync_job_1=require(a189_0x428737(0x195));let SyncService=SyncService_1=class SyncService{constructor(_0x5c42e6,_0x1086d3,_0x4b9a9f){const _0x53c82f=a189_0x428737;this[_0x53c82f(0x1c0)]=_0x5c42e6,this['salesforceSync']=_0x1086d3,this['gitManager']=_0x4b9a9f,this['logger']=new core_1[(_0x53c82f(0x1ae))](SyncService_1[_0x53c82f(0x1ac)]),this['repositoriesIntersections']={},this['repoList']=[];}async[a189_0x428737(0x1a2)](_0x276d15,_0x1b4359){const _0x135310=a189_0x428737;if(_0x1b4359 instanceof git_branch_not_found_error_1[_0x135310(0x174)]){await this[_0x135310(0x182)][_0x135310(0x183)](_0x276d15,_0x135310(0x197));return;}if(_0x1b4359 instanceof too_many_requests_error_1[_0x135310(0x171)]){await this[_0x135310(0x182)][_0x135310(0x183)](_0x276d15,_0x135310(0x17f));throw _0x1b4359;}try{await this['sfLogger']['log'](_0x135310(0x15e)+_0x276d15[_0x135310(0x19e)]+_0x135310(0x1c4)+_0x276d15[_0x135310(0x16e)]+_0x135310(0x19a)+_0x1b4359)[_0x135310(0x172)](),await this[_0x135310(0x182)][_0x135310(0x1bc)](_0x276d15,{}),await this['salesforceSync'][_0x135310(0x183)](_0x276d15,_0x135310(0x1a8));}catch(_0x45a1d8){if(_0x45a1d8 instanceof salesforce_error_1['SalesforceError'])throw _0x45a1d8;}}async[a189_0x428737(0x193)](_0x37eb9e){const _0x42c4f3=a189_0x428737;if(_0x37eb9e['repositoryId']){const _0x408a02=_0x37eb9e[_0x42c4f3(0x19e)][_0x42c4f3(0x163)](),_0x32e002=this[_0x42c4f3(0x17c)][_0x408a02];if(!_0x32e002)this[_0x42c4f3(0x17c)][_0x408a02]=_0x37eb9e[_0x42c4f3(0x19e)];else{if(_0x32e002&&_0x32e002!==_0x37eb9e[_0x42c4f3(0x19e)])return await this['handleRecordSyncError'](_0x37eb9e,new Error(_0x42c4f3(0x178)+_0x37eb9e[_0x42c4f3(0x19e)]+_0x42c4f3(0x189)+_0x408a02+'\x27\x20-\x20\x27'+_0x32e002+'\x27')),!![];}}return![];}async['checkValidNaming'](_0x2583cc){const _0x1ee6e5=a189_0x428737;if(!constants_1[_0x1ee6e5(0x1a3)][_0x1ee6e5(0x167)](_0x2583cc[_0x1ee6e5(0x19e)]))return await this['handleRecordSyncError'](_0x2583cc,new Error(_0x1ee6e5(0x178)+_0x2583cc[_0x1ee6e5(0x19e)]+_0x1ee6e5(0x18a))),![];if(!constants_1[_0x1ee6e5(0x162)][_0x1ee6e5(0x167)](_0x2583cc['branchName']))return await this[_0x1ee6e5(0x1a2)](_0x2583cc,new Error(_0x1ee6e5(0x1c3)+_0x2583cc[_0x1ee6e5(0x16e)]+'\x27\x20in\x20repository\x20\x27'+_0x2583cc[_0x1ee6e5(0x19e)]+_0x1ee6e5(0x192))),![];return!![];}async[a189_0x428737(0x1a0)](_0x9a66a0,_0xdfd021,_0x233b1e){const _0x27ceba=a189_0x428737;let _0x461285=this[_0x27ceba(0x1aa)][_0x27ceba(0x165)](_0x5b7f77=>_0x9a66a0[_0x27ceba(0x19e)]===_0x5b7f77[_0x27ceba(0x1ac)]);!_0x461285&&(this[_0x27ceba(0x1b6)]['log']('[INFO]\x20Repository\x20\x22'+_0x9a66a0[_0x27ceba(0x19e)]+_0x27ceba(0x1c2)),_0x461285=await this[_0x27ceba(0x1a5)][_0x27ceba(0x1bb)]({'name':_0x9a66a0['repositoryName'],'autoInit':!![],'defaultBranch':_0x9a66a0['branchName'],'private':!![],'createHook':this[_0x27ceba(0x17d)]['createHooks']}));if(this['syncDto'][_0x27ceba(0x198)]){const _0x187ea9=await _0x461285[_0x27ceba(0x15a)][_0x27ceba(0x159)]();!_0x187ea9[_0x27ceba(0x165)](_0xb222f8=>_0xb222f8[_0x27ceba(0x1cd)]===hooks_utils_1[_0x27ceba(0x179)][_0x27ceba(0x177)](_0xdfd021,_0x233b1e))&&(this[_0x27ceba(0x1b6)][_0x27ceba(0x180)](_0x27ceba(0x194)+_0x9a66a0[_0x27ceba(0x19e)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x461285[_0x27ceba(0x15a)][_0x27ceba(0x1bb)](hooks_utils_1['HooksUtils'][_0x27ceba(0x17b)](_0xdfd021,_0x461285[_0x27ceba(0x15a)],_0x233b1e)));}return this[_0x27ceba(0x1aa)][_0x27ceba(0x176)](_0x461285),_0x461285;}async[a189_0x428737(0x164)](_0x146904,_0x4fc985,_0x302988,_0x1ef0f0){const _0x2a6d15=a189_0x428737;this[_0x2a6d15(0x1c0)][_0x2a6d15(0x185)](_0x4fc985),this[_0x2a6d15(0x1a5)]=this[_0x2a6d15(0x1ca)][_0x2a6d15(0x1c7)](_0x302988),this[_0x2a6d15(0x1b6)]=new salesforce_logger_v2_service_1[(_0x2a6d15(0x1c5))](_0x4fc985,'['+SyncService_1[_0x2a6d15(0x1ac)]+_0x2a6d15(0x17e)+_0x302988[_0x2a6d15(0x190)]()+']'),this[_0x2a6d15(0x17d)]=_0x146904;try{await this['sfLogger']['log'](_0x2a6d15(0x1b8))[_0x2a6d15(0x172)]();const [_0x2d92c8,_0x2fd443]=await Promise[_0x2a6d15(0x15c)]([this['salesforceSync'][_0x2a6d15(0x19c)](),this['salesforceSync']['getRepositoryRecords']()]);this['repoList']=await this[_0x2a6d15(0x1a5)][_0x2a6d15(0x159)]();const _0x248ca8=[..._0x2fd443,..._0x2d92c8];this[_0x2a6d15(0x17a)][_0x2a6d15(0x180)]('have\x20to\x20synchronize\x20%d\x20branches',_0x248ca8[_0x2a6d15(0x1b0)]);for(const _0x23afa9 of _0x248ca8){this[_0x2a6d15(0x17a)][_0x2a6d15(0x180)](_0x2a6d15(0x1a7),_0x23afa9[_0x2a6d15(0x19e)],_0x23afa9[_0x2a6d15(0x1c8)],_0x23afa9[_0x2a6d15(0x16e)],_0x23afa9[_0x2a6d15(0x181)]);const _0x5d81cd=await this[_0x2a6d15(0x16b)](_0x23afa9);if(!_0x5d81cd)continue;const _0x289499=await this['isIntersects'](_0x23afa9);if(_0x289499)continue;let _0x3d2c30;try{_0x3d2c30=await this[_0x2a6d15(0x1a0)](_0x23afa9,_0x302988,_0x1ef0f0);}catch(_0x334a68){await this[_0x2a6d15(0x1a2)](_0x23afa9,_0x334a68 instanceof too_many_requests_error_1[_0x2a6d15(0x171)]?_0x334a68:new Error(_0x2a6d15(0x1cc)+_0x334a68));continue;}await this['sfLogger'][_0x2a6d15(0x172)]();if(_0x23afa9['direction']===flosum_repository_sync_dto_1[_0x2a6d15(0x168)][_0x2a6d15(0x188)]){const _0x437287=typedi_1[_0x2a6d15(0x1b3)]['get'](flosum_sync_job_1[_0x2a6d15(0x16a)]);await _0x437287['run']({'repository':_0x3d2c30,'convertToSFDX':_0x146904[_0x2a6d15(0x1c6)],'syncRecord':_0x23afa9,'provider':_0x302988,'logger':this['sfLogger']})[_0x2a6d15(0x191)](_0x542b98=>this['handleRecordSyncError'](_0x23afa9,_0x542b98));}else{const _0x3876a5=typedi_1[_0x2a6d15(0x1b3)][_0x2a6d15(0x19d)](git_sync_job_1['GitSyncJob']);await _0x3876a5['run']({'repository':_0x3d2c30,'branch':_0x23afa9['branchName'],'provider':_0x302988,'repositoryGit':_0x3d2c30['gitUrl'],'syncRecord':_0x23afa9,'logger':this[_0x2a6d15(0x1b6)]})['catch'](_0xe6fe64=>this['handleRecordSyncError'](_0x23afa9,_0xe6fe64));}}}catch(_0x366ae3){this[_0x2a6d15(0x17a)][_0x2a6d15(0x187)](_0x366ae3);_0x366ae3 instanceof too_many_requests_error_1[_0x2a6d15(0x171)]?(await this[_0x2a6d15(0x1b6)][_0x2a6d15(0x180)](_0x2a6d15(0x199))[_0x2a6d15(0x172)](),await utils_1[_0x2a6d15(0x1c9)](0x3c*0x3c*0x3e8),this[_0x2a6d15(0x164)](_0x146904,_0x4fc985,_0x302988,_0x1ef0f0)):await this[_0x2a6d15(0x1b6)]['log']('[ERROR]\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x366ae3)[_0x2a6d15(0x172)]();return;}await this[_0x2a6d15(0x1b6)][_0x2a6d15(0x180)](_0x2a6d15(0x1be))[_0x2a6d15(0x172)](),await this[_0x2a6d15(0x182)][_0x2a6d15(0x1b5)](_0x146904['syncID'])[_0x2a6d15(0x191)](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a189_0x428737(0x169),[salesforce_service_1[a189_0x428737(0x1ce)],salesforce_sync_service_1[a189_0x428737(0x1cf)],git_provider_manager_1['GitProviderManager']])],SyncService),exports[a189_0x428737(0x1a1)]=SyncService;function a189_0x4c17(){const _0x414b5d=['BRANCH_NAME_REGEXP','toLowerCase','run','find','27JCSVOK','test','SyncDirection','design:paramtypes','FlosumSyncJob','checkValidNaming','../../shared/utils','880cBslQS','branchName','468649yigODA','../../salesforce/services/salesforce.service','TooManyRequests','send','__esModule','GitBranchNotFoundError','toString','push','getHookLinkFor','Unable\x20to\x20synchronize\x20repository\x20\x27','HooksUtils','logger','createHookPayload','repositoriesIntersections','syncDto',']\x20[','Waiting','log','branchId','salesforceSync','setStatus','decorate','setLoggerId','../../../core/errors/too-many-requests.error','error','FlosumToGit','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','2456naoNTo','search','4314ZnDLTQ','32209991qrdosA','../errors/git-branch-not-found.error','toUpperCase','catch','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','isIntersects','[INFO]\x20Repository\x20\x22','../jobs/git-sync.job','14wKUCIm','Not\x20Synchronized','createHooks','[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.',']\x20due\x20error\x20-\x20','typedi','getBranchRecords','get','repositoryName','2840556eERVuk','getOrCreateRepo','SyncService','handleRecordSyncError','REPOSITORY_NAME_REGEXP','15561KkNEIH','repoService','__importStar','syncing\x20%s[%s]\x20repository\x20%s[%s]\x20branch','Error','../../../constants','repoList','object','name','../jobs/flosum-sync.job','Logger','__setModuleDefault','length','metadata','defineProperty','default','../../salesforce/services/salesforce-sync.service','disableSync','sfLogger','__createBinding','[INFO]\x20Start\x20sync\x20job','function','../../../core','create','updateRemoteState','470913EpigMr','[INFO]\x20Sync\x20job\x20done.','getOwnPropertyDescriptor','salesforceService','../../shared/git-provider.manager','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','Unable\x20to\x20synchronize\x20branch\x20\x27','\x27\x20[','SalesforceLogger2','convertToSFDX','getRepoService','repositoryId','sleep','gitManager','call','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','url','SalesforceService','SalesforceSyncService','getAll','hooks','apply','all','(((.+)+)+)+$','[ERROR]\x20Stop\x20sync\x20job\x20for\x20\x27','../../hooks/hooks.utils','2108740qcVhYI','../../salesforce/services/salesforce-logger-v2.service'];a189_0x4c17=function(){return _0x414b5d;};return a189_0x4c17();}