const a187_0x428a2a=a187_0x1c45;function a187_0x1c45(_0x162a19,_0x5ed774){const _0x504c6b=a187_0x58ad();return a187_0x1c45=function(_0x5b64fd,_0x372bee){_0x5b64fd=_0x5b64fd-0xbe;let _0x58adca=_0x504c6b[_0x5b64fd];return _0x58adca;},a187_0x1c45(_0x162a19,_0x5ed774);}(function(_0x11efc1,_0x532c10){const _0x4c27ee=a187_0x1c45,_0x500bc9=_0x11efc1();while(!![]){try{const _0x549c28=parseInt(_0x4c27ee(0xf2))/0x1+-parseInt(_0x4c27ee(0x127))/0x2+-parseInt(_0x4c27ee(0xc7))/0x3+-parseInt(_0x4c27ee(0x120))/0x4*(-parseInt(_0x4c27ee(0x114))/0x5)+-parseInt(_0x4c27ee(0xf6))/0x6+-parseInt(_0x4c27ee(0x125))/0x7*(parseInt(_0x4c27ee(0xff))/0x8)+parseInt(_0x4c27ee(0x103))/0x9;if(_0x549c28===_0x532c10)break;else _0x500bc9['push'](_0x500bc9['shift']());}catch(_0x3df2c3){_0x500bc9['push'](_0x500bc9['shift']());}}}(a187_0x58ad,0x828ca));const a187_0x372bee=(function(){let _0x51f45b=!![];return function(_0x3c26eb,_0x4f1aa2){const _0x10e9fb=_0x51f45b?function(){if(_0x4f1aa2){const _0x45c1e3=_0x4f1aa2['apply'](_0x3c26eb,arguments);return _0x4f1aa2=null,_0x45c1e3;}}:function(){};return _0x51f45b=![],_0x10e9fb;};}()),a187_0x5b64fd=a187_0x372bee(this,function(){const _0x2df51d=a187_0x1c45;return a187_0x5b64fd[_0x2df51d(0x10e)]()[_0x2df51d(0xcb)](_0x2df51d(0xe4))[_0x2df51d(0x10e)]()[_0x2df51d(0xca)](a187_0x5b64fd)[_0x2df51d(0xcb)](_0x2df51d(0xe4));});a187_0x5b64fd();'use strict';var __createBinding=this&&this[a187_0x428a2a(0xf3)]||(Object[a187_0x428a2a(0x107)]?function(_0x54167b,_0x9d6191,_0x4adfb5,_0x1462c4){if(_0x1462c4===undefined)_0x1462c4=_0x4adfb5;Object['defineProperty'](_0x54167b,_0x1462c4,{'enumerable':!![],'get':function(){return _0x9d6191[_0x4adfb5];}});}:function(_0x306099,_0x2ce09c,_0x108636,_0x43b453){if(_0x43b453===undefined)_0x43b453=_0x108636;_0x306099[_0x43b453]=_0x2ce09c[_0x108636];}),__setModuleDefault=this&&this[a187_0x428a2a(0xd8)]||(Object['create']?function(_0x3bcf54,_0x38845b){const _0x3397=a187_0x428a2a;Object[_0x3397(0xe0)](_0x3bcf54,_0x3397(0x10b),{'enumerable':!![],'value':_0x38845b});}:function(_0x3091e8,_0x531db7){const _0x16f937=a187_0x428a2a;_0x3091e8[_0x16f937(0x10b)]=_0x531db7;}),__decorate=this&&this[a187_0x428a2a(0xe7)]||function(_0x411547,_0x2e5283,_0x246c33,_0x1e1afb){const _0x27b000=a187_0x428a2a;var _0x29db53=arguments[_0x27b000(0x126)],_0x3cfef9=_0x29db53<0x3?_0x2e5283:_0x1e1afb===null?_0x1e1afb=Object[_0x27b000(0xc5)](_0x2e5283,_0x246c33):_0x1e1afb,_0x260f19;if(typeof Reflect===_0x27b000(0x115)&&typeof Reflect['decorate']===_0x27b000(0x11f))_0x3cfef9=Reflect[_0x27b000(0x12e)](_0x411547,_0x2e5283,_0x246c33,_0x1e1afb);else{for(var _0x1031a8=_0x411547[_0x27b000(0x126)]-0x1;_0x1031a8>=0x0;_0x1031a8--)if(_0x260f19=_0x411547[_0x1031a8])_0x3cfef9=(_0x29db53<0x3?_0x260f19(_0x3cfef9):_0x29db53>0x3?_0x260f19(_0x2e5283,_0x246c33,_0x3cfef9):_0x260f19(_0x2e5283,_0x246c33))||_0x3cfef9;}return _0x29db53>0x3&&_0x3cfef9&&Object[_0x27b000(0xe0)](_0x2e5283,_0x246c33,_0x3cfef9),_0x3cfef9;},__importStar=this&&this[a187_0x428a2a(0xe3)]||function(_0x2a09cc){const _0x23b083=a187_0x428a2a;if(_0x2a09cc&&_0x2a09cc[_0x23b083(0x106)])return _0x2a09cc;var _0x21bc12={};if(_0x2a09cc!=null){for(var _0x49557d in _0x2a09cc)if(_0x49557d!==_0x23b083(0x10b)&&Object[_0x23b083(0xd0)][_0x23b083(0x105)][_0x23b083(0x108)](_0x2a09cc,_0x49557d))__createBinding(_0x21bc12,_0x2a09cc,_0x49557d);}return __setModuleDefault(_0x21bc12,_0x2a09cc),_0x21bc12;},__metadata=this&&this[a187_0x428a2a(0x118)]||function(_0x2f4747,_0x159da9){const _0x5ec354=a187_0x428a2a;if(typeof Reflect===_0x5ec354(0x115)&&typeof Reflect['metadata']===_0x5ec354(0x11f))return Reflect[_0x5ec354(0x11b)](_0x2f4747,_0x159da9);},SyncService_1;Object[a187_0x428a2a(0xe0)](exports,a187_0x428a2a(0x106),{'value':!![]}),exports[a187_0x428a2a(0x121)]=void 0x0;function a187_0x58ad(){const _0x2b8f90=['584448yMqssk','disableSync','convertToSFDX','constructor','search','[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','sfLogger','error','../errors/git-branch-not-found.error','prototype','repoList','setStatus','repositoriesIntersections','\x27\x20in\x20repository\x20\x27','getHookLinkFor','repoService','name','__setModuleDefault','get','find','toLowerCase','run','log','send','../../salesforce/dto/flosum-repository-sync.dto','defineProperty','../../salesforce/errors/salesforce.error','[ERROR]\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','__importStar','(((.+)+)+)+$',']\x20[','../../hooks/hooks.utils','__decorate','SyncDirection','Service','createHooks','sleep','\x27\x20-\x20\x27','catch','logger','getBranchRecords','repositoryName','direction','1066685KcGeZU','__createBinding','../../../core','SalesforceLogger2','1138854JwyAOC','createHookPayload','checkValidNaming','Unable\x20to\x20synchronize\x20branch\x20\x27','url','TooManyRequests','branchName','BRANCH_NAME_REGEXP','FlosumSyncJob','317192Vzeuak','[INFO]\x20Start\x20sync\x20job','syncDto','../../shared/utils','2335428KDksfQ','getRepoService','hasOwnProperty','__esModule','create','call','hooks','../jobs/flosum-sync.job','default','\x22\x20does\x20not\x20has\x20the\x20agent\x20webhook.\x20Creating\x20a\x20new\x20one.','GitBranchNotFoundError','toString','Not\x20Synchronized','SalesforceService','repositoryId','SalesforceSyncService','salesforceService','392680bWZUXm','object','Error','[INFO]\x20Repository\x20\x22','__metadata','getAll','Logger','metadata','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','HooksUtils','getOrCreateRepo','function','32iBnKXN','SyncService','handleRecordSyncError','typedi','Unable\x20to\x20synchronize\x20repository\x20\x27','119cucise','length','722154cxkqku','isIntersects','syncing\x20%s[%s]\x20repository\x20%s[%s]\x20branch','salesforceSync','REPOSITORY_NAME_REGEXP','GitSyncJob','gitUrl','decorate','Waiting','test','../jobs/git-sync.job','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','have\x20to\x20synchronize\x20%d\x20branches','../../salesforce/services/salesforce.service','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','../../../constants','../../salesforce/services/salesforce-sync.service','../../shared/git-provider.manager','gitManager','getOwnPropertyDescriptor','all'];a187_0x58ad=function(){return _0x2b8f90;};return a187_0x58ad();}const constants_1=require(a187_0x428a2a(0xc1)),core_1=require(a187_0x428a2a(0xf4)),too_many_requests_error_1=require('../../../core/errors/too-many-requests.error'),flosum_repository_sync_dto_1=require(a187_0x428a2a(0xdf)),salesforce_error_1=require(a187_0x428a2a(0xe1)),salesforce_logger_v2_service_1=require('../../salesforce/services/salesforce-logger-v2.service'),salesforce_sync_service_1=require(a187_0x428a2a(0xc2)),salesforce_service_1=require(a187_0x428a2a(0xbf)),git_provider_manager_1=require(a187_0x428a2a(0xc3)),utils_1=require(a187_0x428a2a(0x102)),typedi_1=__importStar(require(a187_0x428a2a(0x123))),hooks_utils_1=require(a187_0x428a2a(0xe6)),git_branch_not_found_error_1=require(a187_0x428a2a(0xcf)),flosum_sync_job_1=require(a187_0x428a2a(0x10a)),git_sync_job_1=require(a187_0x428a2a(0x131));let SyncService=SyncService_1=class SyncService{constructor(_0xa92bc4,_0x5ffad,_0x94741e){const _0x2231a0=a187_0x428a2a;this['salesforceService']=_0xa92bc4,this[_0x2231a0(0x12a)]=_0x5ffad,this['gitManager']=_0x94741e,this['logger']=new core_1[(_0x2231a0(0x11a))](SyncService_1[_0x2231a0(0xd7)]),this[_0x2231a0(0xd3)]={},this[_0x2231a0(0xd1)]=[];}async[a187_0x428a2a(0x122)](_0x5b0cb2,_0x5d7e26){const _0x1da881=a187_0x428a2a;if(_0x5d7e26 instanceof git_branch_not_found_error_1[_0x1da881(0x10d)]){await this[_0x1da881(0x12a)][_0x1da881(0xd2)](_0x5b0cb2,_0x1da881(0x10f));return;}if(_0x5d7e26 instanceof too_many_requests_error_1[_0x1da881(0xfb)]){await this[_0x1da881(0x12a)][_0x1da881(0xd2)](_0x5b0cb2,_0x1da881(0x12f));throw _0x5d7e26;}try{await this[_0x1da881(0xcd)][_0x1da881(0xdd)]('[ERROR]\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x5b0cb2[_0x1da881(0xf0)]+'\x27\x20['+_0x5b0cb2[_0x1da881(0xfc)]+']\x20due\x20error\x20-\x20'+_0x5d7e26)[_0x1da881(0xde)](),await this['salesforceSync']['updateRemoteState'](_0x5b0cb2,{}),await this[_0x1da881(0x12a)]['setStatus'](_0x5b0cb2,_0x1da881(0x116));}catch(_0x2deabf){if(_0x2deabf instanceof salesforce_error_1['SalesforceError'])throw _0x2deabf;}}async[a187_0x428a2a(0x128)](_0x5d59ce){const _0x5c05ba=a187_0x428a2a;if(_0x5d59ce[_0x5c05ba(0x111)]){const _0x2a24f8=_0x5d59ce['repositoryName'][_0x5c05ba(0xdb)](),_0x13c967=this[_0x5c05ba(0xd3)][_0x2a24f8];if(!_0x13c967)this[_0x5c05ba(0xd3)][_0x2a24f8]=_0x5d59ce[_0x5c05ba(0xf0)];else{if(_0x13c967&&_0x13c967!==_0x5d59ce[_0x5c05ba(0xf0)])return await this[_0x5c05ba(0x122)](_0x5d59ce,new Error(_0x5c05ba(0x124)+_0x5d59ce[_0x5c05ba(0xf0)]+_0x5c05ba(0x132)+_0x2a24f8+_0x5c05ba(0xec)+_0x13c967+'\x27')),!![];}}return![];}async[a187_0x428a2a(0xf8)](_0x1e4056){const _0x39dadd=a187_0x428a2a;if(!constants_1[_0x39dadd(0x12b)][_0x39dadd(0x130)](_0x1e4056[_0x39dadd(0xf0)]))return await this['handleRecordSyncError'](_0x1e4056,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x1e4056[_0x39dadd(0xf0)]+_0x39dadd(0x11c))),![];if(!constants_1[_0x39dadd(0xfd)]['test'](_0x1e4056[_0x39dadd(0xfc)]))return await this[_0x39dadd(0x122)](_0x1e4056,new Error(_0x39dadd(0xf9)+_0x1e4056[_0x39dadd(0xfc)]+_0x39dadd(0xd4)+_0x1e4056[_0x39dadd(0xf0)]+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async[a187_0x428a2a(0x11e)](_0x31371a,_0x501c29,_0x209964){const _0x3be4ae=a187_0x428a2a;let _0x4e14b5=this['repoList'][_0x3be4ae(0xda)](_0xcf2f17=>_0x31371a['repositoryName']===_0xcf2f17[_0x3be4ae(0xd7)]);!_0x4e14b5&&(this[_0x3be4ae(0xcd)]['log'](_0x3be4ae(0x117)+_0x31371a[_0x3be4ae(0xf0)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x4e14b5=await this[_0x3be4ae(0xd6)][_0x3be4ae(0x107)]({'name':_0x31371a[_0x3be4ae(0xf0)],'autoInit':!![],'defaultBranch':_0x31371a[_0x3be4ae(0xfc)],'private':!![],'createHook':this[_0x3be4ae(0x101)][_0x3be4ae(0xea)]}));if(this[_0x3be4ae(0x101)][_0x3be4ae(0xea)]){const _0x697dad=await _0x4e14b5[_0x3be4ae(0x109)][_0x3be4ae(0x119)]();!_0x697dad['find'](_0x50c489=>_0x50c489[_0x3be4ae(0xfa)]===hooks_utils_1[_0x3be4ae(0x11d)][_0x3be4ae(0xd5)](_0x501c29,_0x209964))&&(this['sfLogger'][_0x3be4ae(0xdd)]('[INFO]\x20Repository\x20\x22'+_0x31371a[_0x3be4ae(0xf0)]+_0x3be4ae(0x10c)),await _0x4e14b5[_0x3be4ae(0x109)][_0x3be4ae(0x107)](hooks_utils_1['HooksUtils'][_0x3be4ae(0xf7)](_0x501c29,_0x4e14b5['hooks'],_0x209964)));}return this['repoList']['push'](_0x4e14b5),_0x4e14b5;}async[a187_0x428a2a(0xdc)](_0x4f5685,_0x331594,_0x498d67,_0x27d656){const _0x28af69=a187_0x428a2a;this[_0x28af69(0x113)]['setLoggerId'](_0x331594),this[_0x28af69(0xd6)]=this[_0x28af69(0xc4)][_0x28af69(0x104)](_0x498d67),this[_0x28af69(0xcd)]=new salesforce_logger_v2_service_1[(_0x28af69(0xf5))](_0x331594,'['+SyncService_1[_0x28af69(0xd7)]+_0x28af69(0xe5)+_0x498d67['toUpperCase']()+']'),this[_0x28af69(0x101)]=_0x4f5685;try{await this[_0x28af69(0xcd)][_0x28af69(0xdd)](_0x28af69(0x100))['send']();const [_0x4e8759,_0x2316e0]=await Promise[_0x28af69(0xc6)]([this['salesforceSync'][_0x28af69(0xef)](),this['salesforceSync']['getRepositoryRecords']()]);this['repoList']=await this[_0x28af69(0xd6)][_0x28af69(0x119)]();const _0x43b038=[..._0x2316e0,..._0x4e8759];this['logger'][_0x28af69(0xdd)](_0x28af69(0xbe),_0x43b038[_0x28af69(0x126)]);for(const _0x1955fd of _0x43b038){this[_0x28af69(0xee)][_0x28af69(0xdd)](_0x28af69(0x129),_0x1955fd[_0x28af69(0xf0)],_0x1955fd[_0x28af69(0x111)],_0x1955fd['branchName'],_0x1955fd['branchId']);const _0x36bacb=await this[_0x28af69(0xf8)](_0x1955fd);if(!_0x36bacb)continue;const _0x18c242=await this[_0x28af69(0x128)](_0x1955fd);if(_0x18c242)continue;let _0x5592f8;try{_0x5592f8=await this[_0x28af69(0x11e)](_0x1955fd,_0x498d67,_0x27d656);}catch(_0x495c33){await this['handleRecordSyncError'](_0x1955fd,_0x495c33 instanceof too_many_requests_error_1[_0x28af69(0xfb)]?_0x495c33:new Error(_0x28af69(0xc0)+_0x495c33));continue;}await this[_0x28af69(0xcd)]['send']();if(_0x1955fd[_0x28af69(0xf1)]===flosum_repository_sync_dto_1[_0x28af69(0xe8)]['FlosumToGit']){const _0x281d09=typedi_1['default'][_0x28af69(0xd9)](flosum_sync_job_1[_0x28af69(0xfe)]);await _0x281d09['run']({'repository':_0x5592f8,'convertToSFDX':_0x4f5685[_0x28af69(0xc9)],'syncRecord':_0x1955fd,'provider':_0x498d67,'logger':this[_0x28af69(0xcd)]})[_0x28af69(0xed)](_0x38adca=>this[_0x28af69(0x122)](_0x1955fd,_0x38adca));}else{const _0x4ee111=typedi_1['default']['get'](git_sync_job_1[_0x28af69(0x12c)]);await _0x4ee111[_0x28af69(0xdc)]({'repository':_0x5592f8,'branch':_0x1955fd[_0x28af69(0xfc)],'provider':_0x498d67,'repositoryGit':_0x5592f8[_0x28af69(0x12d)],'syncRecord':_0x1955fd,'logger':this[_0x28af69(0xcd)]})['catch'](_0x33f069=>this[_0x28af69(0x122)](_0x1955fd,_0x33f069));}}}catch(_0xbb3f2d){this[_0x28af69(0xee)][_0x28af69(0xce)](_0xbb3f2d);_0xbb3f2d instanceof too_many_requests_error_1[_0x28af69(0xfb)]?(await this['sfLogger'][_0x28af69(0xdd)](_0x28af69(0xcc))[_0x28af69(0xde)](),await utils_1[_0x28af69(0xeb)](0x3c*0x3c*0x3e8),this['run'](_0x4f5685,_0x331594,_0x498d67,_0x27d656)):await this[_0x28af69(0xcd)][_0x28af69(0xdd)](_0x28af69(0xe2)+_0xbb3f2d)[_0x28af69(0xde)]();return;}await this[_0x28af69(0xcd)][_0x28af69(0xdd)]('[INFO]\x20Sync\x20job\x20done.')[_0x28af69(0xde)](),await this[_0x28af69(0x12a)][_0x28af69(0xc8)](_0x4f5685['syncID'])[_0x28af69(0xed)](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1[a187_0x428a2a(0xe9)]({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a187_0x428a2a(0x110)],salesforce_sync_service_1[a187_0x428a2a(0x112)],git_provider_manager_1['GitProviderManager']])],SyncService),exports['SyncService']=SyncService;