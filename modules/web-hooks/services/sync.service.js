const a188_0x56941c=a188_0x1f27;(function(_0xb85108,_0x5d96f5){const _0x2d963c=a188_0x1f27,_0x574257=_0xb85108();while(!![]){try{const _0x22419f=-parseInt(_0x2d963c(0x175))/0x1*(-parseInt(_0x2d963c(0x14a))/0x2)+-parseInt(_0x2d963c(0x16a))/0x3+parseInt(_0x2d963c(0x173))/0x4+parseInt(_0x2d963c(0x178))/0x5*(-parseInt(_0x2d963c(0x147))/0x6)+parseInt(_0x2d963c(0x197))/0x7*(parseInt(_0x2d963c(0x17c))/0x8)+-parseInt(_0x2d963c(0x139))/0x9+parseInt(_0x2d963c(0x143))/0xa*(parseInt(_0x2d963c(0x144))/0xb);if(_0x22419f===_0x5d96f5)break;else _0x574257['push'](_0x574257['shift']());}catch(_0x4186bf){_0x574257['push'](_0x574257['shift']());}}}(a188_0x3623,0x25725));const a188_0x16776b=(function(){let _0x27fbed=!![];return function(_0x4a665b,_0x197062){const _0x17fd3d=_0x27fbed?function(){const _0x1526e3=a188_0x1f27;if(_0x197062){const _0x21e7d0=_0x197062[_0x1526e3(0x184)](_0x4a665b,arguments);return _0x197062=null,_0x21e7d0;}}:function(){};return _0x27fbed=![],_0x17fd3d;};}()),a188_0x48e587=a188_0x16776b(this,function(){const _0x2c12fb=a188_0x1f27;return a188_0x48e587[_0x2c12fb(0x164)]()[_0x2c12fb(0x16f)](_0x2c12fb(0x133))[_0x2c12fb(0x164)]()['constructor'](a188_0x48e587)[_0x2c12fb(0x16f)](_0x2c12fb(0x133));});a188_0x48e587();function a188_0x1f27(_0x4e49ad,_0x3d5a6b){const _0x2cc1c9=a188_0x3623();return a188_0x1f27=function(_0x48e587,_0x16776b){_0x48e587=_0x48e587-0x12d;let _0x3623ee=_0x2cc1c9[_0x48e587];return _0x3623ee;},a188_0x1f27(_0x4e49ad,_0x3d5a6b);}function a188_0x3623(){const _0x148dcf=['syncDto','[ERROR]\x20Stop\x20sync\x20job\x20for\x20\x27','\x27\x20in\x20repository\x20\x27','TooManyRequests','toLowerCase','checkValidNaming','setStatus','object','getRepositoryRecords','SyncService','toString','gitManager',']\x20[','getAll','catch','create','260508lcXABP','__createBinding','repositoryId','getHookLinkFor','logger','search','[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','createHooks','setLoggerId','372260ywcXAF','SalesforceLogger2','81DxGmXa','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','direction','5pppmEW','design:paramtypes','length','repoService','8JmyPVj','../../shared/git-provider.manager','FlosumSyncJob','function','syncing\x20%s[%s]\x20repository\x20%s[%s]\x20branch','hasOwnProperty','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','FlosumToGit','apply','SalesforceSyncService','Not\x20Synchronized','SalesforceError','hooks','getOrCreateRepo','get','have\x20to\x20synchronize\x20%d\x20branches','Service','all','GitBranchNotFoundError','../../shared/utils','REPOSITORY_NAME_REGEXP','SalesforceService','\x27\x20-\x20\x27','branchId','__esModule','../jobs/git-sync.job','getRepoService','457289pLSuwx','find','Unable\x20to\x20synchronize\x20repository\x20\x27','typedi','isIntersects','../../salesforce/errors/salesforce.error','BRANCH_NAME_REGEXP','decorate','repoList','handleRecordSyncError','(((.+)+)+)+$','../../salesforce/services/salesforce-logger-v2.service','[INFO]\x20Repository\x20\x22','name','repositoryName','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','1975104hVPpII','HooksUtils','[INFO]\x20Start\x20sync\x20job','getBranchRecords','Logger','repositoriesIntersections','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','log','send','salesforceService','10SiyIJm','4887685iVoFZU','createHookPayload','salesforceSync','1604334OxNACT','default','prototype','3070HCCqvM','call','__decorate','[ERROR]\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','metadata','../../hooks/hooks.utils','sfLogger','../errors/git-branch-not-found.error','test','updateRemoteState','url','run','../../../core/errors/too-many-requests.error','defineProperty','sleep','branchName'];a188_0x3623=function(){return _0x148dcf;};return a188_0x3623();}'use strict';var __createBinding=this&&this[a188_0x56941c(0x16b)]||(Object[a188_0x56941c(0x169)]?function(_0x431032,_0x364d00,_0xd1a37e,_0x52fc5a){const _0x4f19f8=a188_0x56941c;if(_0x52fc5a===undefined)_0x52fc5a=_0xd1a37e;Object[_0x4f19f8(0x157)](_0x431032,_0x52fc5a,{'enumerable':!![],'get':function(){return _0x364d00[_0xd1a37e];}});}:function(_0x3f3866,_0x4ab240,_0x33f72a,_0x4eb442){if(_0x4eb442===undefined)_0x4eb442=_0x33f72a;_0x3f3866[_0x4eb442]=_0x4ab240[_0x33f72a];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a188_0x56941c(0x169)]?function(_0x158f2e,_0x35fb78){const _0xe97d97=a188_0x56941c;Object[_0xe97d97(0x157)](_0x158f2e,_0xe97d97(0x148),{'enumerable':!![],'value':_0x35fb78});}:function(_0x273acb,_0x55d71d){const _0x2e6455=a188_0x56941c;_0x273acb[_0x2e6455(0x148)]=_0x55d71d;}),__decorate=this&&this[a188_0x56941c(0x14c)]||function(_0x19a9cc,_0x5c2ad1,_0x420c66,_0x2a9529){const _0x3b87c3=a188_0x56941c;var _0x1e5a0a=arguments['length'],_0x1ef5a6=_0x1e5a0a<0x3?_0x5c2ad1:_0x2a9529===null?_0x2a9529=Object['getOwnPropertyDescriptor'](_0x5c2ad1,_0x420c66):_0x2a9529,_0x17411e;if(typeof Reflect===_0x3b87c3(0x161)&&typeof Reflect[_0x3b87c3(0x130)]==='function')_0x1ef5a6=Reflect[_0x3b87c3(0x130)](_0x19a9cc,_0x5c2ad1,_0x420c66,_0x2a9529);else{for(var _0x1a0fd1=_0x19a9cc[_0x3b87c3(0x17a)]-0x1;_0x1a0fd1>=0x0;_0x1a0fd1--)if(_0x17411e=_0x19a9cc[_0x1a0fd1])_0x1ef5a6=(_0x1e5a0a<0x3?_0x17411e(_0x1ef5a6):_0x1e5a0a>0x3?_0x17411e(_0x5c2ad1,_0x420c66,_0x1ef5a6):_0x17411e(_0x5c2ad1,_0x420c66))||_0x1ef5a6;}return _0x1e5a0a>0x3&&_0x1ef5a6&&Object[_0x3b87c3(0x157)](_0x5c2ad1,_0x420c66,_0x1ef5a6),_0x1ef5a6;},__importStar=this&&this['__importStar']||function(_0x44b617){const _0x1205af=a188_0x56941c;if(_0x44b617&&_0x44b617[_0x1205af(0x194)])return _0x44b617;var _0x229996={};if(_0x44b617!=null){for(var _0x36ada4 in _0x44b617)if(_0x36ada4!==_0x1205af(0x148)&&Object[_0x1205af(0x149)][_0x1205af(0x181)][_0x1205af(0x14b)](_0x44b617,_0x36ada4))__createBinding(_0x229996,_0x44b617,_0x36ada4);}return __setModuleDefault(_0x229996,_0x44b617),_0x229996;},__metadata=this&&this['__metadata']||function(_0x5b4fd7,_0x42fd9b){const _0x33ead6=a188_0x56941c;if(typeof Reflect==='object'&&typeof Reflect[_0x33ead6(0x14e)]===_0x33ead6(0x17f))return Reflect[_0x33ead6(0x14e)](_0x5b4fd7,_0x42fd9b);},SyncService_1;Object[a188_0x56941c(0x157)](exports,'__esModule',{'value':!![]}),exports[a188_0x56941c(0x163)]=void 0x0;const constants_1=require('../../../constants'),core_1=require('../../../core'),too_many_requests_error_1=require(a188_0x56941c(0x156)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require(a188_0x56941c(0x12e)),salesforce_logger_v2_service_1=require(a188_0x56941c(0x134)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require('../../salesforce/services/salesforce.service'),git_provider_manager_1=require(a188_0x56941c(0x17d)),utils_1=require(a188_0x56941c(0x18f)),typedi_1=__importStar(require(a188_0x56941c(0x19a))),hooks_utils_1=require(a188_0x56941c(0x14f)),git_branch_not_found_error_1=require(a188_0x56941c(0x151)),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require(a188_0x56941c(0x195));let SyncService=SyncService_1=class SyncService{constructor(_0xe47b0f,_0x5be217,_0x1c9b26){const _0x2a8f3d=a188_0x56941c;this[_0x2a8f3d(0x142)]=_0xe47b0f,this[_0x2a8f3d(0x146)]=_0x5be217,this['gitManager']=_0x1c9b26,this[_0x2a8f3d(0x16e)]=new core_1[(_0x2a8f3d(0x13d))](SyncService_1[_0x2a8f3d(0x136)]),this[_0x2a8f3d(0x13e)]={},this[_0x2a8f3d(0x131)]=[];}async[a188_0x56941c(0x132)](_0x5e7d7d,_0x57f825){const _0x2c3dd9=a188_0x56941c;if(_0x57f825 instanceof git_branch_not_found_error_1[_0x2c3dd9(0x18e)]){await this[_0x2c3dd9(0x146)][_0x2c3dd9(0x160)](_0x5e7d7d,_0x2c3dd9(0x186));return;}if(_0x57f825 instanceof too_many_requests_error_1[_0x2c3dd9(0x15d)]){await this[_0x2c3dd9(0x146)][_0x2c3dd9(0x160)](_0x5e7d7d,'Waiting');throw _0x57f825;}try{await this[_0x2c3dd9(0x150)][_0x2c3dd9(0x140)](_0x2c3dd9(0x15b)+_0x5e7d7d[_0x2c3dd9(0x137)]+'\x27\x20['+_0x5e7d7d[_0x2c3dd9(0x159)]+']\x20due\x20error\x20-\x20'+_0x57f825)['send'](),await this[_0x2c3dd9(0x146)][_0x2c3dd9(0x153)](_0x5e7d7d,{}),await this[_0x2c3dd9(0x146)]['setStatus'](_0x5e7d7d,'Error');}catch(_0x1a4173){if(_0x1a4173 instanceof salesforce_error_1[_0x2c3dd9(0x187)])throw _0x1a4173;}}async[a188_0x56941c(0x12d)](_0x4708dd){const _0x1f0805=a188_0x56941c;if(_0x4708dd[_0x1f0805(0x16c)]){const _0x27e704=_0x4708dd[_0x1f0805(0x137)][_0x1f0805(0x15e)](),_0x3dc8b8=this['repositoriesIntersections'][_0x27e704];if(!_0x3dc8b8)this[_0x1f0805(0x13e)][_0x27e704]=_0x4708dd['repositoryName'];else{if(_0x3dc8b8&&_0x3dc8b8!==_0x4708dd[_0x1f0805(0x137)])return await this[_0x1f0805(0x132)](_0x4708dd,new Error(_0x1f0805(0x199)+_0x4708dd['repositoryName']+_0x1f0805(0x182)+_0x27e704+_0x1f0805(0x192)+_0x3dc8b8+'\x27')),!![];}}return![];}async[a188_0x56941c(0x15f)](_0x230007){const _0xcd3f59=a188_0x56941c;if(!constants_1[_0xcd3f59(0x190)]['test'](_0x230007[_0xcd3f59(0x137)]))return await this['handleRecordSyncError'](_0x230007,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x230007['repositoryName']+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0xcd3f59(0x12f)][_0xcd3f59(0x152)](_0x230007[_0xcd3f59(0x159)]))return await this[_0xcd3f59(0x132)](_0x230007,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x230007[_0xcd3f59(0x159)]+_0xcd3f59(0x15c)+_0x230007[_0xcd3f59(0x137)]+_0xcd3f59(0x138))),![];return!![];}async[a188_0x56941c(0x189)](_0x5b80b1,_0x242cce,_0x401292){const _0x249a36=a188_0x56941c;let _0x35e7a4=this[_0x249a36(0x131)]['find'](_0x52b913=>_0x5b80b1[_0x249a36(0x137)]===_0x52b913[_0x249a36(0x136)]);!_0x35e7a4&&(this['sfLogger'][_0x249a36(0x140)](_0x249a36(0x135)+_0x5b80b1[_0x249a36(0x137)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x35e7a4=await this[_0x249a36(0x17b)][_0x249a36(0x169)]({'name':_0x5b80b1[_0x249a36(0x137)],'autoInit':!![],'defaultBranch':_0x5b80b1['branchName'],'private':!![],'createHook':this[_0x249a36(0x15a)][_0x249a36(0x171)]}));if(this[_0x249a36(0x15a)][_0x249a36(0x171)]){const _0x37d247=await _0x35e7a4[_0x249a36(0x188)][_0x249a36(0x167)]();!_0x37d247[_0x249a36(0x198)](_0x2a26da=>_0x2a26da[_0x249a36(0x154)]===hooks_utils_1['HooksUtils'][_0x249a36(0x16d)](_0x242cce,_0x401292))&&(this[_0x249a36(0x150)]['log'](_0x249a36(0x135)+_0x5b80b1[_0x249a36(0x137)]+_0x249a36(0x13f)),await _0x35e7a4[_0x249a36(0x188)][_0x249a36(0x169)](hooks_utils_1[_0x249a36(0x13a)][_0x249a36(0x145)](_0x242cce,_0x35e7a4[_0x249a36(0x188)],_0x401292)));}return this['repoList']['push'](_0x35e7a4),_0x35e7a4;}async['run'](_0x54bcd6,_0x5f5c69,_0x1359b2,_0x1aeebc){const _0x9fee48=a188_0x56941c;this[_0x9fee48(0x142)][_0x9fee48(0x172)](_0x5f5c69),this[_0x9fee48(0x17b)]=this[_0x9fee48(0x165)][_0x9fee48(0x196)](_0x1359b2),this['sfLogger']=new salesforce_logger_v2_service_1[(_0x9fee48(0x174))](_0x5f5c69,'['+SyncService_1[_0x9fee48(0x136)]+_0x9fee48(0x166)+_0x1359b2['toUpperCase']()+']'),this['syncDto']=_0x54bcd6;try{await this['sfLogger']['log'](_0x9fee48(0x13b))[_0x9fee48(0x141)]();const [_0x22f569,_0x534653]=await Promise[_0x9fee48(0x18d)]([this[_0x9fee48(0x146)][_0x9fee48(0x13c)](),this[_0x9fee48(0x146)][_0x9fee48(0x162)]()]);this['repoList']=await this[_0x9fee48(0x17b)]['getAll']();const _0x27d9c9=[..._0x534653,..._0x22f569];this[_0x9fee48(0x16e)][_0x9fee48(0x140)](_0x9fee48(0x18b),_0x27d9c9[_0x9fee48(0x17a)]);for(const _0x8bfcfd of _0x27d9c9){this[_0x9fee48(0x16e)][_0x9fee48(0x140)](_0x9fee48(0x180),_0x8bfcfd['repositoryName'],_0x8bfcfd[_0x9fee48(0x16c)],_0x8bfcfd[_0x9fee48(0x159)],_0x8bfcfd[_0x9fee48(0x193)]);const _0x14bc32=await this[_0x9fee48(0x15f)](_0x8bfcfd);if(!_0x14bc32)continue;const _0x5a7755=await this['isIntersects'](_0x8bfcfd);if(_0x5a7755)continue;let _0x221fb6;try{_0x221fb6=await this[_0x9fee48(0x189)](_0x8bfcfd,_0x1359b2,_0x1aeebc);}catch(_0x2d80c0){await this[_0x9fee48(0x132)](_0x8bfcfd,_0x2d80c0 instanceof too_many_requests_error_1[_0x9fee48(0x15d)]?_0x2d80c0:new Error(_0x9fee48(0x176)+_0x2d80c0));continue;}await this[_0x9fee48(0x150)]['send']();if(_0x8bfcfd[_0x9fee48(0x177)]===flosum_repository_sync_dto_1['SyncDirection'][_0x9fee48(0x183)]){const _0x37ba55=typedi_1['default'][_0x9fee48(0x18a)](flosum_sync_job_1[_0x9fee48(0x17e)]);await _0x37ba55[_0x9fee48(0x155)]({'repository':_0x221fb6,'convertToSFDX':_0x54bcd6['convertToSFDX'],'syncRecord':_0x8bfcfd,'provider':_0x1359b2,'logger':this['sfLogger']})[_0x9fee48(0x168)](_0x17886f=>this[_0x9fee48(0x132)](_0x8bfcfd,_0x17886f));}else{const _0x44bc06=typedi_1[_0x9fee48(0x148)][_0x9fee48(0x18a)](git_sync_job_1['GitSyncJob']);await _0x44bc06[_0x9fee48(0x155)]({'repository':_0x221fb6,'branch':_0x8bfcfd['branchName'],'provider':_0x1359b2,'repositoryGit':_0x221fb6['gitUrl'],'syncRecord':_0x8bfcfd,'logger':this[_0x9fee48(0x150)]})[_0x9fee48(0x168)](_0x38cdeb=>this[_0x9fee48(0x132)](_0x8bfcfd,_0x38cdeb));}}}catch(_0x3df120){this['logger']['error'](_0x3df120);_0x3df120 instanceof too_many_requests_error_1[_0x9fee48(0x15d)]?(await this[_0x9fee48(0x150)][_0x9fee48(0x140)](_0x9fee48(0x170))[_0x9fee48(0x141)](),await utils_1[_0x9fee48(0x158)](0x3c*0x3c*0x3e8),this[_0x9fee48(0x155)](_0x54bcd6,_0x5f5c69,_0x1359b2,_0x1aeebc)):await this[_0x9fee48(0x150)][_0x9fee48(0x140)](_0x9fee48(0x14d)+_0x3df120)['send']();return;}await this['sfLogger'][_0x9fee48(0x140)]('[INFO]\x20Sync\x20job\x20done.')['send'](),await this[_0x9fee48(0x146)]['disableSync'](_0x54bcd6['syncID'])[_0x9fee48(0x168)](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1[a188_0x56941c(0x18c)]({'transient':!![]}),__metadata(a188_0x56941c(0x179),[salesforce_service_1[a188_0x56941c(0x191)],salesforce_sync_service_1[a188_0x56941c(0x185)],git_provider_manager_1['GitProviderManager']])],SyncService),exports['SyncService']=SyncService;