const a188_0x36c9f2=a188_0x42d4;function a188_0x42d4(_0x4bd4c5,_0x48ed5f){const _0x73315a=a188_0x4cd6();return a188_0x42d4=function(_0x40ced1,_0x1614e6){_0x40ced1=_0x40ced1-0x146;let _0x4cd626=_0x73315a[_0x40ced1];return _0x4cd626;},a188_0x42d4(_0x4bd4c5,_0x48ed5f);}(function(_0x127a61,_0x50db03){const _0x401a9e=a188_0x42d4,_0x456f0b=_0x127a61();while(!![]){try{const _0x37857a=-parseInt(_0x401a9e(0x157))/0x1+parseInt(_0x401a9e(0x1b7))/0x2+-parseInt(_0x401a9e(0x169))/0x3+parseInt(_0x401a9e(0x166))/0x4+-parseInt(_0x401a9e(0x152))/0x5*(-parseInt(_0x401a9e(0x1a8))/0x6)+-parseInt(_0x401a9e(0x14b))/0x7+parseInt(_0x401a9e(0x153))/0x8;if(_0x37857a===_0x50db03)break;else _0x456f0b['push'](_0x456f0b['shift']());}catch(_0x4aab7c){_0x456f0b['push'](_0x456f0b['shift']());}}}(a188_0x4cd6,0xcfda2));const a188_0x1614e6=(function(){let _0x3a06a9=!![];return function(_0x5624f8,_0x936a79){const _0x3e6c31=_0x3a06a9?function(){if(_0x936a79){const _0x3fcbcb=_0x936a79['apply'](_0x5624f8,arguments);return _0x936a79=null,_0x3fcbcb;}}:function(){};return _0x3a06a9=![],_0x3e6c31;};}()),a188_0x40ced1=a188_0x1614e6(this,function(){const _0x5d20e0=a188_0x42d4;return a188_0x40ced1[_0x5d20e0(0x164)]()['search'](_0x5d20e0(0x1ab))[_0x5d20e0(0x164)]()[_0x5d20e0(0x1b5)](a188_0x40ced1)['search'](_0x5d20e0(0x1ab));});a188_0x40ced1();'use strict';var __createBinding=this&&this[a188_0x36c9f2(0x1ac)]||(Object['create']?function(_0x1f61a8,_0x3f3468,_0x480aab,_0x45b99f){if(_0x45b99f===undefined)_0x45b99f=_0x480aab;Object['defineProperty'](_0x1f61a8,_0x45b99f,{'enumerable':!![],'get':function(){return _0x3f3468[_0x480aab];}});}:function(_0x386945,_0x5ce1d2,_0xd4d056,_0x1f6047){if(_0x1f6047===undefined)_0x1f6047=_0xd4d056;_0x386945[_0x1f6047]=_0x5ce1d2[_0xd4d056];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a188_0x36c9f2(0x14f)]?function(_0x3a480b,_0x52a496){const _0x22d96e=a188_0x36c9f2;Object[_0x22d96e(0x168)](_0x3a480b,'default',{'enumerable':!![],'value':_0x52a496});}:function(_0xb3cb61,_0x2e85fa){_0xb3cb61['default']=_0x2e85fa;}),__decorate=this&&this[a188_0x36c9f2(0x1a0)]||function(_0x49af6e,_0x527dec,_0x427e2c,_0x39dbd1){const _0x1432ce=a188_0x36c9f2;var _0x24c683=arguments['length'],_0x4b53b9=_0x24c683<0x3?_0x527dec:_0x39dbd1===null?_0x39dbd1=Object['getOwnPropertyDescriptor'](_0x527dec,_0x427e2c):_0x39dbd1,_0x573e18;if(typeof Reflect===_0x1432ce(0x174)&&typeof Reflect[_0x1432ce(0x14e)]===_0x1432ce(0x1b4))_0x4b53b9=Reflect[_0x1432ce(0x14e)](_0x49af6e,_0x527dec,_0x427e2c,_0x39dbd1);else{for(var _0x226a6f=_0x49af6e[_0x1432ce(0x16a)]-0x1;_0x226a6f>=0x0;_0x226a6f--)if(_0x573e18=_0x49af6e[_0x226a6f])_0x4b53b9=(_0x24c683<0x3?_0x573e18(_0x4b53b9):_0x24c683>0x3?_0x573e18(_0x527dec,_0x427e2c,_0x4b53b9):_0x573e18(_0x527dec,_0x427e2c))||_0x4b53b9;}return _0x24c683>0x3&&_0x4b53b9&&Object[_0x1432ce(0x168)](_0x527dec,_0x427e2c,_0x4b53b9),_0x4b53b9;},__importStar=this&&this[a188_0x36c9f2(0x18b)]||function(_0x28e428){const _0x2387cb=a188_0x36c9f2;if(_0x28e428&&_0x28e428[_0x2387cb(0x1b0)])return _0x28e428;var _0x5abb26={};if(_0x28e428!=null){for(var _0x1c3add in _0x28e428)if(_0x1c3add!==_0x2387cb(0x160)&&Object[_0x2387cb(0x192)]['hasOwnProperty'][_0x2387cb(0x161)](_0x28e428,_0x1c3add))__createBinding(_0x5abb26,_0x28e428,_0x1c3add);}return __setModuleDefault(_0x5abb26,_0x28e428),_0x5abb26;},__metadata=this&&this['__metadata']||function(_0x3a59b6,_0x156d67){const _0x11870a=a188_0x36c9f2;if(typeof Reflect===_0x11870a(0x174)&&typeof Reflect[_0x11870a(0x196)]==='function')return Reflect[_0x11870a(0x196)](_0x3a59b6,_0x156d67);},SyncService_1;Object['defineProperty'](exports,a188_0x36c9f2(0x1b0),{'value':!![]}),exports['SyncService']=void 0x0;const constants_1=require(a188_0x36c9f2(0x16b)),core_1=require(a188_0x36c9f2(0x172)),too_many_requests_error_1=require(a188_0x36c9f2(0x1b1)),flosum_repository_sync_dto_1=require(a188_0x36c9f2(0x17d)),salesforce_error_1=require(a188_0x36c9f2(0x1a1)),salesforce_logger_v2_service_1=require(a188_0x36c9f2(0x190)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a188_0x36c9f2(0x170)),git_provider_manager_1=require(a188_0x36c9f2(0x15b)),utils_1=require(a188_0x36c9f2(0x155)),typedi_1=__importStar(require(a188_0x36c9f2(0x17e))),hooks_utils_1=require(a188_0x36c9f2(0x16d)),git_branch_not_found_error_1=require(a188_0x36c9f2(0x17b)),flosum_sync_job_1=require(a188_0x36c9f2(0x149)),git_sync_job_1=require(a188_0x36c9f2(0x17c));let SyncService=SyncService_1=class SyncService{constructor(_0x2fcb27,_0x225c52,_0x1f428e){const _0x1085b3=a188_0x36c9f2;this['salesforceService']=_0x2fcb27,this[_0x1085b3(0x188)]=_0x225c52,this[_0x1085b3(0x150)]=_0x1f428e,this['logger']=new core_1[(_0x1085b3(0x19e))](SyncService_1['name']),this[_0x1085b3(0x1a5)]={},this[_0x1085b3(0x14c)]=[];}async[a188_0x36c9f2(0x199)](_0xd5a2a0,_0x542537){const _0x3fad68=a188_0x36c9f2;if(_0x542537 instanceof git_branch_not_found_error_1[_0x3fad68(0x15d)]){await this[_0x3fad68(0x188)][_0x3fad68(0x181)](_0xd5a2a0,_0x3fad68(0x151));return;}if(_0x542537 instanceof too_many_requests_error_1[_0x3fad68(0x1ad)]){await this[_0x3fad68(0x188)][_0x3fad68(0x181)](_0xd5a2a0,'Waiting');throw _0x542537;}try{await this[_0x3fad68(0x173)][_0x3fad68(0x179)](_0x3fad68(0x180)+_0xd5a2a0[_0x3fad68(0x15a)]+_0x3fad68(0x178)+_0xd5a2a0[_0x3fad68(0x158)]+_0x3fad68(0x18d)+_0x542537)[_0x3fad68(0x185)](),await this[_0x3fad68(0x188)][_0x3fad68(0x14a)](_0xd5a2a0,{}),await this[_0x3fad68(0x188)]['setStatus'](_0xd5a2a0,'Error');}catch(_0x3938f9){if(_0x3938f9 instanceof salesforce_error_1['SalesforceError'])throw _0x3938f9;}}async[a188_0x36c9f2(0x197)](_0x1ce4cf){const _0x3c4181=a188_0x36c9f2;if(_0x1ce4cf[_0x3c4181(0x148)]){const _0x177751=_0x1ce4cf[_0x3c4181(0x15a)]['toLowerCase'](),_0x14093a=this['repositoriesIntersections'][_0x177751];if(!_0x14093a)this[_0x3c4181(0x1a5)][_0x177751]=_0x1ce4cf['repositoryName'];else{if(_0x14093a&&_0x14093a!==_0x1ce4cf[_0x3c4181(0x15a)])return await this[_0x3c4181(0x199)](_0x1ce4cf,new Error(_0x3c4181(0x17f)+_0x1ce4cf[_0x3c4181(0x15a)]+_0x3c4181(0x1a9)+_0x177751+_0x3c4181(0x183)+_0x14093a+'\x27')),!![];}}return![];}async['checkValidNaming'](_0x4d9104){const _0x413dcc=a188_0x36c9f2;if(!constants_1[_0x413dcc(0x187)][_0x413dcc(0x1a3)](_0x4d9104[_0x413dcc(0x15a)]))return await this[_0x413dcc(0x199)](_0x4d9104,new Error(_0x413dcc(0x17f)+_0x4d9104[_0x413dcc(0x15a)]+_0x413dcc(0x14d))),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x413dcc(0x1a3)](_0x4d9104['branchName']))return await this['handleRecordSyncError'](_0x4d9104,new Error(_0x413dcc(0x186)+_0x4d9104[_0x413dcc(0x158)]+_0x413dcc(0x15e)+_0x4d9104[_0x413dcc(0x15a)]+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async[a188_0x36c9f2(0x16f)](_0x4a4131,_0x1d2117,_0x1b92d6){const _0x8e852e=a188_0x36c9f2;let _0x19fffd=this[_0x8e852e(0x14c)]['find'](_0x44622c=>_0x4a4131[_0x8e852e(0x15a)]===_0x44622c[_0x8e852e(0x159)]);!_0x19fffd&&(this['sfLogger'][_0x8e852e(0x179)](_0x8e852e(0x177)+_0x4a4131[_0x8e852e(0x15a)]+_0x8e852e(0x171)),_0x19fffd=await this[_0x8e852e(0x147)][_0x8e852e(0x14f)]({'name':_0x4a4131[_0x8e852e(0x15a)],'autoInit':!![],'defaultBranch':_0x4a4131[_0x8e852e(0x158)],'private':!![],'createHook':this[_0x8e852e(0x189)][_0x8e852e(0x198)]}));if(this['syncDto'][_0x8e852e(0x198)]){const _0x4b6dec=await _0x19fffd[_0x8e852e(0x16c)][_0x8e852e(0x16e)]();!_0x4b6dec['find'](_0x3ecf30=>_0x3ecf30[_0x8e852e(0x1b6)]===hooks_utils_1[_0x8e852e(0x19a)][_0x8e852e(0x175)](_0x1d2117,_0x1b92d6))&&(this[_0x8e852e(0x173)][_0x8e852e(0x179)](_0x8e852e(0x177)+_0x4a4131['repositoryName']+_0x8e852e(0x1a7)),await _0x19fffd['hooks'][_0x8e852e(0x14f)](hooks_utils_1[_0x8e852e(0x19a)][_0x8e852e(0x1a4)](_0x1d2117,_0x19fffd[_0x8e852e(0x16c)],_0x1b92d6)));}return this[_0x8e852e(0x14c)][_0x8e852e(0x163)](_0x19fffd),_0x19fffd;}async['run'](_0x522dc9,_0x290ec0,_0x4f3649,_0x22c9cb){const _0x1f682f=a188_0x36c9f2;this[_0x1f682f(0x167)]['setLoggerId'](_0x290ec0),this['repoService']=this['gitManager'][_0x1f682f(0x1a2)](_0x4f3649),this[_0x1f682f(0x173)]=new salesforce_logger_v2_service_1[(_0x1f682f(0x162))](_0x290ec0,'['+SyncService_1[_0x1f682f(0x159)]+_0x1f682f(0x1a6)+_0x4f3649[_0x1f682f(0x19d)]()+']'),this['syncDto']=_0x522dc9;try{await this['sfLogger'][_0x1f682f(0x179)](_0x1f682f(0x1ae))['send']();const [_0x599e75,_0x33803f]=await Promise[_0x1f682f(0x18f)]([this[_0x1f682f(0x188)][_0x1f682f(0x1b3)](),this[_0x1f682f(0x188)]['getRepositoryRecords']()]);this['repoList']=await this['repoService'][_0x1f682f(0x16e)]();const _0x451f2f=[..._0x33803f,..._0x599e75];this[_0x1f682f(0x195)]['log'](_0x1f682f(0x18e),_0x451f2f[_0x1f682f(0x16a)]);for(const _0x89725e of _0x451f2f){this[_0x1f682f(0x195)][_0x1f682f(0x179)](_0x1f682f(0x19b),_0x89725e['repositoryName'],_0x89725e[_0x1f682f(0x148)],_0x89725e['branchName'],_0x89725e[_0x1f682f(0x193)]);const _0x17ed81=await this['checkValidNaming'](_0x89725e);if(!_0x17ed81)continue;const _0x57b8ca=await this[_0x1f682f(0x197)](_0x89725e);if(_0x57b8ca)continue;let _0x1d4167;try{_0x1d4167=await this[_0x1f682f(0x16f)](_0x89725e,_0x4f3649,_0x22c9cb);}catch(_0x3f5ddb){await this[_0x1f682f(0x199)](_0x89725e,_0x3f5ddb instanceof too_many_requests_error_1[_0x1f682f(0x1ad)]?_0x3f5ddb:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x3f5ddb));continue;}await this[_0x1f682f(0x173)][_0x1f682f(0x185)]();if(_0x89725e[_0x1f682f(0x15c)]===flosum_repository_sync_dto_1[_0x1f682f(0x1aa)][_0x1f682f(0x15f)]){const _0x3f77cf=typedi_1['default'][_0x1f682f(0x182)](flosum_sync_job_1[_0x1f682f(0x17a)]);await _0x3f77cf[_0x1f682f(0x18a)]({'repository':_0x1d4167,'convertToSFDX':_0x522dc9[_0x1f682f(0x19f)],'syncRecord':_0x89725e,'provider':_0x4f3649,'logger':this[_0x1f682f(0x173)]})[_0x1f682f(0x19c)](_0x373c6e=>this[_0x1f682f(0x199)](_0x89725e,_0x373c6e));}else{const _0x5f3f63=typedi_1[_0x1f682f(0x160)][_0x1f682f(0x182)](git_sync_job_1[_0x1f682f(0x156)]);await _0x5f3f63[_0x1f682f(0x18a)]({'repository':_0x1d4167,'branch':_0x89725e[_0x1f682f(0x158)],'provider':_0x4f3649,'repositoryGit':_0x1d4167[_0x1f682f(0x154)],'syncRecord':_0x89725e,'logger':this['sfLogger']})[_0x1f682f(0x19c)](_0x435aaa=>this[_0x1f682f(0x199)](_0x89725e,_0x435aaa));}}}catch(_0x421638){this['logger'][_0x1f682f(0x165)](_0x421638);_0x421638 instanceof too_many_requests_error_1['TooManyRequests']?(await this['sfLogger'][_0x1f682f(0x179)]('[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.')[_0x1f682f(0x185)](),await utils_1[_0x1f682f(0x194)](0x3c*0x3c*0x3e8),this[_0x1f682f(0x18a)](_0x522dc9,_0x290ec0,_0x4f3649,_0x22c9cb)):await this[_0x1f682f(0x173)][_0x1f682f(0x179)](_0x1f682f(0x184)+_0x421638)[_0x1f682f(0x185)]();return;}await this[_0x1f682f(0x173)]['log'](_0x1f682f(0x146))['send'](),await this[_0x1f682f(0x188)][_0x1f682f(0x1b2)](_0x522dc9[_0x1f682f(0x18c)])['catch'](()=>null);}};function a188_0x4cd6(){const _0x474292=['function','constructor','url','3021004KBDkVw','[INFO]\x20Sync\x20job\x20done.','repoService','repositoryId','../jobs/flosum-sync.job','updateRemoteState','11561515sfkHkO','repoList','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','decorate','create','gitManager','Not\x20Synchronized','5agFbMQ','9498072gqIEwP','gitUrl','../../shared/utils','GitSyncJob','1003726raOint','branchName','name','repositoryName','../../shared/git-provider.manager','direction','GitBranchNotFoundError','\x27\x20in\x20repository\x20\x27','FlosumToGit','default','call','SalesforceLogger2','push','toString','error','572016oapYMW','salesforceService','defineProperty','1704303jVrePf','length','../../../constants','hooks','../../hooks/hooks.utils','getAll','getOrCreateRepo','../../salesforce/services/salesforce.service','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','../../../core','sfLogger','object','getHookLinkFor','SyncService','[INFO]\x20Repository\x20\x22','\x27\x20[','log','FlosumSyncJob','../errors/git-branch-not-found.error','../jobs/git-sync.job','../../salesforce/dto/flosum-repository-sync.dto','typedi','Unable\x20to\x20synchronize\x20repository\x20\x27','[ERROR]\x20Stop\x20sync\x20job\x20for\x20\x27','setStatus','get','\x27\x20-\x20\x27','[ERROR]\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','send','Unable\x20to\x20synchronize\x20branch\x20\x27','REPOSITORY_NAME_REGEXP','salesforceSync','syncDto','run','__importStar','syncID',']\x20due\x20error\x20-\x20','have\x20to\x20synchronize\x20%d\x20branches','all','../../salesforce/services/salesforce-logger-v2.service','design:paramtypes','prototype','branchId','sleep','logger','metadata','isIntersects','createHooks','handleRecordSyncError','HooksUtils','syncing\x20%s[%s]\x20repository\x20%s[%s]\x20branch','catch','toUpperCase','Logger','convertToSFDX','__decorate','../../salesforce/errors/salesforce.error','getRepoService','test','createHookPayload','repositoriesIntersections',']\x20[','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','7404414QhYcrs','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','SyncDirection','(((.+)+)+)+$','__createBinding','TooManyRequests','[INFO]\x20Start\x20sync\x20job','SalesforceService','__esModule','../../../core/errors/too-many-requests.error','disableSync','getBranchRecords'];a188_0x4cd6=function(){return _0x474292;};return a188_0x4cd6();}SyncService=SyncService_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a188_0x36c9f2(0x191),[salesforce_service_1[a188_0x36c9f2(0x1af)],salesforce_sync_service_1['SalesforceSyncService'],git_provider_manager_1['GitProviderManager']])],SyncService),exports[a188_0x36c9f2(0x176)]=SyncService;