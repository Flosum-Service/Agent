const a347_0x44aed5=a347_0x3c25;(function(_0x24196a,_0x11f1d6){const _0x4ad218=a347_0x3c25,_0x318dd8=_0x24196a();while(!![]){try{const _0x14f881=parseInt(_0x4ad218(0x170))/0x1+-parseInt(_0x4ad218(0x197))/0x2+-parseInt(_0x4ad218(0x17b))/0x3+-parseInt(_0x4ad218(0x186))/0x4*(parseInt(_0x4ad218(0x167))/0x5)+-parseInt(_0x4ad218(0x14a))/0x6*(parseInt(_0x4ad218(0x16e))/0x7)+-parseInt(_0x4ad218(0x161))/0x8+-parseInt(_0x4ad218(0x153))/0x9*(-parseInt(_0x4ad218(0x166))/0xa);if(_0x14f881===_0x11f1d6)break;else _0x318dd8['push'](_0x318dd8['shift']());}catch(_0x14c728){_0x318dd8['push'](_0x318dd8['shift']());}}}(a347_0x74c6,0xabd6f));function a347_0x3c25(_0xb7035d,_0x4af722){const _0x55dcac=a347_0x74c6();return a347_0x3c25=function(_0x13f3cd,_0x2406aa){_0x13f3cd=_0x13f3cd-0x14a;let _0x74c6e7=_0x55dcac[_0x13f3cd];return _0x74c6e7;},a347_0x3c25(_0xb7035d,_0x4af722);}const a347_0x2406aa=(function(){let _0x39cd1c=!![];return function(_0x34eb87,_0x29b15b){const _0x3aad4f=_0x39cd1c?function(){const _0x5a2510=a347_0x3c25;if(_0x29b15b){const _0x14027c=_0x29b15b[_0x5a2510(0x178)](_0x34eb87,arguments);return _0x29b15b=null,_0x14027c;}}:function(){};return _0x39cd1c=![],_0x3aad4f;};}()),a347_0x13f3cd=a347_0x2406aa(this,function(){const _0x3d2abb=a347_0x3c25;return a347_0x13f3cd[_0x3d2abb(0x150)]()[_0x3d2abb(0x15f)](_0x3d2abb(0x174))['toString']()[_0x3d2abb(0x18d)](a347_0x13f3cd)[_0x3d2abb(0x15f)](_0x3d2abb(0x174));});a347_0x13f3cd();'use strict';function a347_0x74c6(){const _0x171837=['getAuthDetails','./classes/loggers/logger','72AfvzJC','createVeevaRequest','createSalesforceRequest','__metadata','./services/rollback.service','Controller','message','VeevaAuth','Post','default','./services/deploy.service','getOwnPropertyDescriptor','search','metadata','5018064vMuvfv','./enums/status.enums','retrieveDependency','./utils/veeva-request.utils','veeva-vault','6104130zsrgQV','269530OHtwKI','design:paramtypes','SalesforceAuth','decorate','param','fs/promises','execute','438473FCsdYR','v1.1','584485BIhrrv','Logger','__decorate','VeevaVaultController','(((.+)+)+)+$','Version','__esModule','__importDefault','apply','design:returntype','./utils/fs-util','3628113HuJAeu','./services/dependency.service','BaseVeevaError','object','shortid','finally','deployFromBranch','prototype','length','instanceUrl','makeDir','60zooTxF','deploy','./utils/salesforce-request.utils','AppResponseStatus','__param','snapshot','getMessages','constructor','SUCCESS','../../core','DeployService','body','then','temp/veeva/rollback_','defineProperty','temp/veeva/deploy_','FAILURE','2358260QdLiCU','SnapshotService','./classes/errors/base-veeva-error','rollback','join','90XPhPww','./services/snapshot.service','design:type','./classes/auth/salesforce-auth','RollbackService','doSnapshot','toString'];a347_0x74c6=function(){return _0x171837;};return a347_0x74c6();}var __decorate=this&&this[a347_0x44aed5(0x172)]||function(_0x1895d7,_0x1d6c5b,_0x11a576,_0x18a116){const _0x1e5849=a347_0x44aed5;var _0x267677=arguments[_0x1e5849(0x183)],_0x4ae0a7=_0x267677<0x3?_0x1d6c5b:_0x18a116===null?_0x18a116=Object[_0x1e5849(0x15e)](_0x1d6c5b,_0x11a576):_0x18a116,_0x4badf8;if(typeof Reflect==='object'&&typeof Reflect[_0x1e5849(0x16a)]==='function')_0x4ae0a7=Reflect['decorate'](_0x1895d7,_0x1d6c5b,_0x11a576,_0x18a116);else{for(var _0x3c2fca=_0x1895d7[_0x1e5849(0x183)]-0x1;_0x3c2fca>=0x0;_0x3c2fca--)if(_0x4badf8=_0x1895d7[_0x3c2fca])_0x4ae0a7=(_0x267677<0x3?_0x4badf8(_0x4ae0a7):_0x267677>0x3?_0x4badf8(_0x1d6c5b,_0x11a576,_0x4ae0a7):_0x4badf8(_0x1d6c5b,_0x11a576))||_0x4ae0a7;}return _0x267677>0x3&&_0x4ae0a7&&Object[_0x1e5849(0x194)](_0x1d6c5b,_0x11a576,_0x4ae0a7),_0x4ae0a7;},__metadata=this&&this[a347_0x44aed5(0x156)]||function(_0x4b939a,_0x1b498b){const _0x369398=a347_0x44aed5;if(typeof Reflect===_0x369398(0x17e)&&typeof Reflect[_0x369398(0x160)]==='function')return Reflect['metadata'](_0x4b939a,_0x1b498b);},__param=this&&this[a347_0x44aed5(0x18a)]||function(_0x5806dd,_0x26da56){return function(_0x11a0d8,_0x32cba1){_0x26da56(_0x11a0d8,_0x32cba1,_0x5806dd);};},__importDefault=this&&this[a347_0x44aed5(0x177)]||function(_0x11274b){const _0x13b10e=a347_0x44aed5;return _0x11274b&&_0x11274b[_0x13b10e(0x176)]?_0x11274b:{'default':_0x11274b};};Object['defineProperty'](exports,a347_0x44aed5(0x176),{'value':!![]}),exports[a347_0x44aed5(0x173)]=void 0x0;const core_1=require(a347_0x44aed5(0x18f)),dependency_service_1=require(a347_0x44aed5(0x17c)),snapshot_service_1=require(a347_0x44aed5(0x14b)),deploy_service_1=require(a347_0x44aed5(0x15d)),veeva_request_utils_1=require(a347_0x44aed5(0x164)),status_enums_1=require(a347_0x44aed5(0x162)),shortid_1=__importDefault(require(a347_0x44aed5(0x17f))),fs_util_1=require(a347_0x44aed5(0x17a)),logger_1=require(a347_0x44aed5(0x152)),promises_1=require(a347_0x44aed5(0x16c)),base_veeva_error_1=require(a347_0x44aed5(0x199)),salesforce_request_utils_1=require(a347_0x44aed5(0x188)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a347_0x44aed5(0x14d)),rollback_service_1=require(a347_0x44aed5(0x157)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x2ceb26){const _0x9f027c=a347_0x44aed5,{veevaAuth:_0x53c3eb,timeZone:_0x14dc81,attachmentLogId:_0x55f50e}=_0x2ceb26;try{const _0x46d516=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1['VeevaAuth'](_0x53c3eb,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1ee090=await salesforce_auth_1[_0x9f027c(0x169)][_0x9f027c(0x151)](),_0x248b57=(0x0,salesforce_request_utils_1[_0x9f027c(0x155)])(new salesforce_auth_1[(_0x9f027c(0x169))](_0x1ee090)),_0x4045d3=new logger_1[(_0x9f027c(0x171))](_0x248b57,_0x14dc81,_0x55f50e),_0x3e11ca=new snapshot_service_1[(_0x9f027c(0x198))](_0x2ceb26,_0x248b57,_0x46d516,_0x4045d3);return _0x3e11ca[_0x9f027c(0x16d)]()[_0x9f027c(0x192)](),{'responseStatus':status_enums_1[_0x9f027c(0x189)][_0x9f027c(0x18e)]};}catch(_0x1f2a61){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x9f027c(0x196)],'responseMessage':_0x1f2a61[_0x9f027c(0x159)]};}}async[a347_0x44aed5(0x181)](_0x5b663a){const _0x415dad=a347_0x44aed5,{veevaAuth:_0x4b269c,timeZone:_0x250431,attachmentLogId:_0x23f24d}=_0x5b663a;try{const _0x3bb56b=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x415dad(0x15a))](_0x4b269c,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x6531c8=await salesforce_auth_1[_0x415dad(0x169)][_0x415dad(0x151)](),_0x3a2bf4=(0x0,salesforce_request_utils_1[_0x415dad(0x155)])(new salesforce_auth_1[(_0x415dad(0x169))](_0x6531c8)),_0x113569=new logger_1[(_0x415dad(0x171))](_0x3a2bf4,_0x250431,_0x23f24d),_0x2d1dd5=_0x415dad(0x195)+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x415dad(0x185)])(_0x2d1dd5);const _0x4f795f=new deploy_service_1[(_0x415dad(0x190))](_0x5b663a,_0x3a2bf4,_0x3bb56b,_0x113569,_0x2d1dd5,_0x6531c8[_0x415dad(0x184)]);return _0x4f795f[_0x415dad(0x16d)]()[_0x415dad(0x180)](()=>(0x0,promises_1['rm'])(_0x2d1dd5,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x415dad(0x18e)]};}catch(_0x271485){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x415dad(0x196)],'responseMessage':_0x271485['message']};}}async[a347_0x44aed5(0x163)](_0x290974){const _0x166f6f=a347_0x44aed5,{veevaAuth:_0x538ea5}=_0x290974;try{const _0x17b0bd=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x166f6f(0x15a))](_0x538ea5)),_0x488b60=await salesforce_auth_1[_0x166f6f(0x169)][_0x166f6f(0x151)](),_0x211415=(0x0,salesforce_request_utils_1[_0x166f6f(0x155)])(new salesforce_auth_1[(_0x166f6f(0x169))](_0x488b60)),_0x248e46=new dependency_service_1['DependencyService'](_0x290974,_0x211415,_0x17b0bd);return await _0x248e46['execute']();}catch(_0x1db3c8){const _0x58ca98=_0x1db3c8 instanceof base_veeva_error_1[_0x166f6f(0x17d)]?_0x1db3c8[_0x166f6f(0x18c)]()[_0x166f6f(0x19b)]('\x0a'):_0x1db3c8['message'];return{'responseStatus':status_enums_1[_0x166f6f(0x189)][_0x166f6f(0x196)],'responseMessage':_0x58ca98};}}async[a347_0x44aed5(0x19a)](_0x5c78d5){const _0x2d59d7=a347_0x44aed5,{veevaAuth:_0x5f57b,timeZone:_0x54db3b,attachmentLogId:_0x11f801}=_0x5c78d5;try{const _0x23eeb6=(0x0,veeva_request_utils_1[_0x2d59d7(0x154)])(new veeva_auth_1[(_0x2d59d7(0x15a))](_0x5f57b,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x64afda=await salesforce_auth_1[_0x2d59d7(0x169)][_0x2d59d7(0x151)](),_0x14baee=(0x0,salesforce_request_utils_1[_0x2d59d7(0x155)])(new salesforce_auth_1[(_0x2d59d7(0x169))](_0x64afda)),_0x2470f5=new logger_1['Logger'](_0x14baee,_0x54db3b,_0x11f801),_0x200e21=_0x2d59d7(0x193)+(0x0,shortid_1[_0x2d59d7(0x15c)])();await(0x0,fs_util_1[_0x2d59d7(0x185)])(_0x200e21);const _0x4874fb=new rollback_service_1[(_0x2d59d7(0x14e))]({..._0x5c78d5,'connectionVeeva':_0x23eeb6,'connectionSalesforce':_0x14baee,'logger':_0x2470f5,'tempFolder':_0x200e21,'instanceUrl':_0x64afda[_0x2d59d7(0x184)]});return _0x4874fb[_0x2d59d7(0x16d)]()[_0x2d59d7(0x180)](()=>(0x0,promises_1['rm'])(_0x200e21,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x2d59d7(0x189)][_0x2d59d7(0x18e)]};}catch(_0x15be95){return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x15be95['message']};}}};__decorate([(0x0,core_1[a347_0x44aed5(0x15b)])(a347_0x44aed5(0x18b)),__param(0x0,core_1[a347_0x44aed5(0x16b)]['body']()),__metadata(a347_0x44aed5(0x14c),Function),__metadata('design:paramtypes',[Object]),__metadata(a347_0x44aed5(0x179),Promise)],VeevaVaultController[a347_0x44aed5(0x182)],a347_0x44aed5(0x14f),null),__decorate([(0x0,core_1[a347_0x44aed5(0x15b)])(a347_0x44aed5(0x187)),__param(0x0,core_1['param'][a347_0x44aed5(0x191)]()),__metadata(a347_0x44aed5(0x14c),Function),__metadata(a347_0x44aed5(0x168),[Object]),__metadata(a347_0x44aed5(0x179),Promise)],VeevaVaultController['prototype'],a347_0x44aed5(0x181),null),__decorate([(0x0,core_1['Post'])('dependency'),__param(0x0,core_1[a347_0x44aed5(0x16b)][a347_0x44aed5(0x191)]()),__metadata(a347_0x44aed5(0x14c),Function),__metadata(a347_0x44aed5(0x168),[Object]),__metadata(a347_0x44aed5(0x179),Promise)],VeevaVaultController['prototype'],a347_0x44aed5(0x163),null),__decorate([(0x0,core_1[a347_0x44aed5(0x15b)])(a347_0x44aed5(0x19a)),__param(0x0,core_1['param']['body']()),__metadata('design:type',Function),__metadata(a347_0x44aed5(0x168),[Object]),__metadata(a347_0x44aed5(0x179),Promise)],VeevaVaultController[a347_0x44aed5(0x182)],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a347_0x44aed5(0x158)])(a347_0x44aed5(0x165)),(0x0,core_1[a347_0x44aed5(0x175)])(a347_0x44aed5(0x16f))],VeevaVaultController),exports[a347_0x44aed5(0x173)]=VeevaVaultController;