const a370_0x4daf28=a370_0x28a4;function a370_0x28a4(_0x4f2463,_0x286eb3){const _0xed2141=a370_0xe9fc();return a370_0x28a4=function(_0x2882f0,_0x1e1320){_0x2882f0=_0x2882f0-0x135;let _0xe9fcb0=_0xed2141[_0x2882f0];return _0xe9fcb0;},a370_0x28a4(_0x4f2463,_0x286eb3);}(function(_0xd84324,_0x3892aa){const _0x30c098=a370_0x28a4,_0x957c96=_0xd84324();while(!![]){try{const _0x3ca991=-parseInt(_0x30c098(0x15e))/0x1*(-parseInt(_0x30c098(0x15f))/0x2)+parseInt(_0x30c098(0x135))/0x3*(parseInt(_0x30c098(0x13b))/0x4)+parseInt(_0x30c098(0x16d))/0x5+parseInt(_0x30c098(0x16b))/0x6+parseInt(_0x30c098(0x141))/0x7*(parseInt(_0x30c098(0x168))/0x8)+parseInt(_0x30c098(0x16e))/0x9*(parseInt(_0x30c098(0x147))/0xa)+-parseInt(_0x30c098(0x16c))/0xb;if(_0x3ca991===_0x3892aa)break;else _0x957c96['push'](_0x957c96['shift']());}catch(_0x543f40){_0x957c96['push'](_0x957c96['shift']());}}}(a370_0xe9fc,0xecc09));const a370_0x1e1320=(function(){let _0x49b562=!![];return function(_0x5ca558,_0x367fac){const _0x3c1460=_0x49b562?function(){const _0x16a5ce=a370_0x28a4;if(_0x367fac){const _0x5c8491=_0x367fac[_0x16a5ce(0x14c)](_0x5ca558,arguments);return _0x367fac=null,_0x5c8491;}}:function(){};return _0x49b562=![],_0x3c1460;};}()),a370_0x2882f0=a370_0x1e1320(this,function(){const _0x6fcd4f=a370_0x28a4;return a370_0x2882f0['toString']()[_0x6fcd4f(0x158)]('(((.+)+)+)+$')['toString']()['constructor'](a370_0x2882f0)['search']('(((.+)+)+)+$');});a370_0x2882f0();'use strict';var __decorate=this&&this[a370_0x4daf28(0x140)]||function(_0x2d850e,_0x1d53e8,_0x48a447,_0x556f6a){const _0x58a1fb=a370_0x4daf28;var _0x584bc2=arguments[_0x58a1fb(0x178)],_0x1a1b1c=_0x584bc2<0x3?_0x1d53e8:_0x556f6a===null?_0x556f6a=Object[_0x58a1fb(0x13e)](_0x1d53e8,_0x48a447):_0x556f6a,_0x26ad87;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x58a1fb(0x164))_0x1a1b1c=Reflect[_0x58a1fb(0x175)](_0x2d850e,_0x1d53e8,_0x48a447,_0x556f6a);else{for(var _0x2cff4e=_0x2d850e[_0x58a1fb(0x178)]-0x1;_0x2cff4e>=0x0;_0x2cff4e--)if(_0x26ad87=_0x2d850e[_0x2cff4e])_0x1a1b1c=(_0x584bc2<0x3?_0x26ad87(_0x1a1b1c):_0x584bc2>0x3?_0x26ad87(_0x1d53e8,_0x48a447,_0x1a1b1c):_0x26ad87(_0x1d53e8,_0x48a447))||_0x1a1b1c;}return _0x584bc2>0x3&&_0x1a1b1c&&Object[_0x58a1fb(0x143)](_0x1d53e8,_0x48a447,_0x1a1b1c),_0x1a1b1c;},__metadata=this&&this[a370_0x4daf28(0x151)]||function(_0x132e9e,_0x38f688){const _0x588034=a370_0x4daf28;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x588034(0x164))return Reflect[_0x588034(0x16f)](_0x132e9e,_0x38f688);},__param=this&&this[a370_0x4daf28(0x142)]||function(_0x2f4429,_0x2a2937){return function(_0x123a0e,_0x3e5b3a){_0x2a2937(_0x123a0e,_0x3e5b3a,_0x2f4429);};},__importDefault=this&&this[a370_0x4daf28(0x13f)]||function(_0x27d533){const _0x348f1b=a370_0x4daf28;return _0x27d533&&_0x27d533[_0x348f1b(0x15a)]?_0x27d533:{'default':_0x27d533};};Object[a370_0x4daf28(0x143)](exports,a370_0x4daf28(0x15a),{'value':!![]}),exports[a370_0x4daf28(0x176)]=void 0x0;const core_1=require(a370_0x4daf28(0x155)),dependency_service_1=require(a370_0x4daf28(0x156)),snapshot_service_1=require(a370_0x4daf28(0x163)),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require(a370_0x4daf28(0x177)),status_enums_1=require(a370_0x4daf28(0x13c)),shortid_1=__importDefault(require('shortid')),fs_util_1=require(a370_0x4daf28(0x159)),logger_1=require(a370_0x4daf28(0x162)),promises_1=require('fs/promises'),base_veeva_error_1=require(a370_0x4daf28(0x136)),salesforce_request_utils_1=require(a370_0x4daf28(0x149)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a370_0x4daf28(0x169)),rollback_service_1=require(a370_0x4daf28(0x171)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a370_0x4daf28(0x17a)](_0x676905){const _0x4a29ad=a370_0x4daf28,{veevaAuth:_0x592502,timeZone:_0x33cb3a,attachmentLogId:_0x5f2d65}=_0x676905;try{const _0x17782e=(0x0,veeva_request_utils_1[_0x4a29ad(0x14f)])(new veeva_auth_1['VeevaAuth'](_0x592502,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5be616=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0xb148f0=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x4a29ad(0x15c))](_0x5be616)),_0x17ffcd=new logger_1[(_0x4a29ad(0x172))](_0xb148f0,_0x33cb3a,_0x5f2d65),_0x10c2db=new snapshot_service_1[(_0x4a29ad(0x154))](_0x676905,_0xb148f0,_0x17782e,_0x17ffcd);return _0x10c2db[_0x4a29ad(0x145)]()['then'](),{'responseStatus':status_enums_1[_0x4a29ad(0x179)][_0x4a29ad(0x166)]};}catch(_0x2d2461){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x4a29ad(0x173)],'responseMessage':_0x2d2461[_0x4a29ad(0x170)]};}}async[a370_0x4daf28(0x139)](_0x325a88){const _0x84722f=a370_0x4daf28,{veevaAuth:_0x551c7f,timeZone:_0x26c23d,attachmentLogId:_0xabf1c8}=_0x325a88;try{const _0x2e95c0=(0x0,veeva_request_utils_1[_0x84722f(0x14f)])(new veeva_auth_1[(_0x84722f(0x144))](_0x551c7f,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x46fa53=await salesforce_auth_1['SalesforceAuth'][_0x84722f(0x14b)](),_0x5661fe=(0x0,salesforce_request_utils_1[_0x84722f(0x161)])(new salesforce_auth_1[(_0x84722f(0x15c))](_0x46fa53)),_0x3436e3=new logger_1[(_0x84722f(0x172))](_0x5661fe,_0x26c23d,_0xabf1c8),_0x1859aa=_0x84722f(0x13d)+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x84722f(0x13a)])(_0x1859aa);const _0x5b9afe=new deploy_service_1['DeployService'](_0x325a88,_0x5661fe,_0x2e95c0,_0x3436e3,_0x1859aa,_0x46fa53[_0x84722f(0x14e)]);return _0x5b9afe[_0x84722f(0x145)]()[_0x84722f(0x148)](()=>(0x0,promises_1['rm'])(_0x1859aa,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x84722f(0x179)][_0x84722f(0x166)]};}catch(_0x5d92ff){return{'responseStatus':status_enums_1[_0x84722f(0x179)][_0x84722f(0x173)],'responseMessage':_0x5d92ff[_0x84722f(0x170)]};}}async[a370_0x4daf28(0x14d)](_0x1146fe){const _0x10e9ec=a370_0x4daf28,{veevaAuth:_0x515e04}=_0x1146fe;try{const _0x528b52=(0x0,veeva_request_utils_1[_0x10e9ec(0x14f)])(new veeva_auth_1[(_0x10e9ec(0x144))](_0x515e04)),_0x4c0e22=await salesforce_auth_1[_0x10e9ec(0x15c)][_0x10e9ec(0x14b)](),_0x4a3054=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x10e9ec(0x15c))](_0x4c0e22)),_0x232814=new dependency_service_1['DependencyService'](_0x1146fe,_0x4a3054,_0x528b52);return await _0x232814[_0x10e9ec(0x145)]();}catch(_0x2738e3){const _0x59254e=_0x2738e3 instanceof base_veeva_error_1[_0x10e9ec(0x15d)]?_0x2738e3['getMessages']()[_0x10e9ec(0x153)]('\x0a'):_0x2738e3[_0x10e9ec(0x170)];return{'responseStatus':status_enums_1[_0x10e9ec(0x179)][_0x10e9ec(0x173)],'responseMessage':_0x59254e};}}async['rollback'](_0x5d2220){const _0x50cc33=a370_0x4daf28,{veevaAuth:_0x59328b,timeZone:_0x15d472,attachmentLogId:_0x138aed}=_0x5d2220;try{const _0x308490=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1['VeevaAuth'](_0x59328b,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x3f8d66=await salesforce_auth_1[_0x50cc33(0x15c)]['getAuthDetails'](),_0x58812f=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x50cc33(0x15c))](_0x3f8d66)),_0xe6aa30=new logger_1[(_0x50cc33(0x172))](_0x58812f,_0x15d472,_0x138aed),_0x353b90='temp/veeva/rollback_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x50cc33(0x13a)])(_0x353b90);const _0x443ca5=new rollback_service_1[(_0x50cc33(0x152))]({..._0x5d2220,'connectionVeeva':_0x308490,'connectionSalesforce':_0x58812f,'logger':_0xe6aa30,'tempFolder':_0x353b90,'instanceUrl':_0x3f8d66[_0x50cc33(0x14e)]});return _0x443ca5[_0x50cc33(0x145)]()[_0x50cc33(0x148)](()=>(0x0,promises_1['rm'])(_0x353b90,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x50cc33(0x179)][_0x50cc33(0x166)]};}catch(_0x3214fe){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x50cc33(0x173)],'responseMessage':_0x3214fe['message']};}}};__decorate([(0x0,core_1[a370_0x4daf28(0x174)])(a370_0x4daf28(0x16a)),__param(0x0,core_1[a370_0x4daf28(0x160)][a370_0x4daf28(0x165)]()),__metadata(a370_0x4daf28(0x15b),Function),__metadata(a370_0x4daf28(0x157),[Object]),__metadata(a370_0x4daf28(0x146),Promise)],VeevaVaultController[a370_0x4daf28(0x14a)],a370_0x4daf28(0x17a),null),__decorate([(0x0,core_1[a370_0x4daf28(0x174)])(a370_0x4daf28(0x137)),__param(0x0,core_1['param']['body']()),__metadata(a370_0x4daf28(0x15b),Function),__metadata(a370_0x4daf28(0x157),[Object]),__metadata(a370_0x4daf28(0x146),Promise)],VeevaVaultController[a370_0x4daf28(0x14a)],a370_0x4daf28(0x139),null),__decorate([(0x0,core_1['Post'])(a370_0x4daf28(0x138)),__param(0x0,core_1[a370_0x4daf28(0x160)][a370_0x4daf28(0x165)]()),__metadata(a370_0x4daf28(0x15b),Function),__metadata('design:paramtypes',[Object]),__metadata(a370_0x4daf28(0x146),Promise)],VeevaVaultController[a370_0x4daf28(0x14a)],'retrieveDependency',null),__decorate([(0x0,core_1[a370_0x4daf28(0x174)])(a370_0x4daf28(0x150)),__param(0x0,core_1[a370_0x4daf28(0x160)][a370_0x4daf28(0x165)]()),__metadata(a370_0x4daf28(0x15b),Function),__metadata('design:paramtypes',[Object]),__metadata(a370_0x4daf28(0x146),Promise)],VeevaVaultController[a370_0x4daf28(0x14a)],a370_0x4daf28(0x150),null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])('veeva-vault'),(0x0,core_1['Version'])(a370_0x4daf28(0x167))],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;function a370_0xe9fc(){const _0x1f69a3=['./utils/veeva-request.utils','length','AppResponseStatus','doSnapshot','270yYgGmx','./classes/errors/base-veeva-error','deploy','dependency','deployFromBranch','makeDir','38876Wivuvq','./enums/status.enums','temp/veeva/deploy_','getOwnPropertyDescriptor','__importDefault','__decorate','1960273VfbBSk','__param','defineProperty','VeevaAuth','execute','design:returntype','10aZflQp','finally','./utils/salesforce-request.utils','prototype','getAuthDetails','apply','retrieveDependency','instanceUrl','createVeevaRequest','rollback','__metadata','RollbackService','join','SnapshotService','../../core','./services/dependency.service','design:paramtypes','search','./utils/fs-util','__esModule','design:type','SalesforceAuth','BaseVeevaError','252EKIDWh','7204DhSGWX','param','createSalesforceRequest','./classes/loggers/logger','./services/snapshot.service','function','body','SUCCESS','v1.1','16QBUZHM','./classes/auth/salesforce-auth','snapshot','6110436kCgQOE','36146572kWpTHj','2750090XbWZng','3103857PUarbs','metadata','message','./services/rollback.service','Logger','FAILURE','Post','decorate','VeevaVaultController'];a370_0xe9fc=function(){return _0x1f69a3;};return a370_0xe9fc();}