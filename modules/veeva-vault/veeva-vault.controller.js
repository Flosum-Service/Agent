const a387_0x318b60=a387_0x5a2a;(function(_0x1f7a1c,_0x1b10e7){const _0x1cd9f1=a387_0x5a2a,_0x293261=_0x1f7a1c();while(!![]){try{const _0x41cd77=parseInt(_0x1cd9f1(0x13c))/0x1+-parseInt(_0x1cd9f1(0x154))/0x2*(-parseInt(_0x1cd9f1(0x156))/0x3)+parseInt(_0x1cd9f1(0x15b))/0x4*(parseInt(_0x1cd9f1(0x110))/0x5)+parseInt(_0x1cd9f1(0x132))/0x6+-parseInt(_0x1cd9f1(0x12b))/0x7*(parseInt(_0x1cd9f1(0x112))/0x8)+parseInt(_0x1cd9f1(0x158))/0x9*(parseInt(_0x1cd9f1(0x152))/0xa)+-parseInt(_0x1cd9f1(0x153))/0xb;if(_0x41cd77===_0x1b10e7)break;else _0x293261['push'](_0x293261['shift']());}catch(_0x4e945e){_0x293261['push'](_0x293261['shift']());}}}(a387_0x226a,0x6e503));const a387_0x2a51da=(function(){let _0x550780=!![];return function(_0x542350,_0x49bbc7){const _0x36764c=_0x550780?function(){const _0x38d447=a387_0x5a2a;if(_0x49bbc7){const _0x3afe89=_0x49bbc7[_0x38d447(0x121)](_0x542350,arguments);return _0x49bbc7=null,_0x3afe89;}}:function(){};return _0x550780=![],_0x36764c;};}()),a387_0x494e5=a387_0x2a51da(this,function(){const _0x3eaf9d=a387_0x5a2a;return a387_0x494e5[_0x3eaf9d(0x133)]()[_0x3eaf9d(0x14c)](_0x3eaf9d(0x13e))[_0x3eaf9d(0x133)]()['constructor'](a387_0x494e5)['search'](_0x3eaf9d(0x13e));});a387_0x494e5();'use strict';function a387_0x226a(){const _0xc0af5e=['./enums/status.enums','223285kVZDgu','length','2001528HasNMT','FAILURE','getOwnPropertyDescriptor','SnapshotService','./services/dependency.service','getAuthDetails','./services/snapshot.service','./utils/salesforce-request.utils','rollback','instanceUrl','doSnapshot','finally','fs/promises','then','body','apply','veeva-vault','./classes/loggers/logger','deploy','message','Controller','./services/deploy.service','./utils/veeva-request.utils','param','__param','14ZwynLX','Logger','design:returntype','prototype','createVeevaRequest','BaseVeevaError','function','213516qJYjSD','toString','RollbackService','Version','execute','getMessages','design:type','dependency','SalesforceAuth','VeevaVaultController','340765JUSRgy','metadata','(((.+)+)+)+$','AppResponseStatus','VeevaAuth','join','shortid','default','./classes/errors/base-veeva-error','defineProperty','__esModule','object','decorate','DeployService','snapshot','./classes/auth/salesforce-auth','search','DependencyService','retrieveDependency','SUCCESS','createSalesforceRequest','design:paramtypes','54170AjaLVH','10872466KSuKGW','452740cECRpp','temp/veeva/rollback_','6pNWwWl','makeDir','1179uITBLb','Post','deployFromBranch','36baskpP','./utils/fs-util'];a387_0x226a=function(){return _0xc0af5e;};return a387_0x226a();}var __decorate=this&&this['__decorate']||function(_0x50df0c,_0x5bb9b3,_0x5a0624,_0x3ae9d2){const _0x410125=a387_0x5a2a;var _0x1e0baa=arguments[_0x410125(0x111)],_0x9e4e59=_0x1e0baa<0x3?_0x5bb9b3:_0x3ae9d2===null?_0x3ae9d2=Object[_0x410125(0x114)](_0x5bb9b3,_0x5a0624):_0x3ae9d2,_0x152226;if(typeof Reflect===_0x410125(0x147)&&typeof Reflect[_0x410125(0x148)]==='function')_0x9e4e59=Reflect[_0x410125(0x148)](_0x50df0c,_0x5bb9b3,_0x5a0624,_0x3ae9d2);else{for(var _0x1669dd=_0x50df0c[_0x410125(0x111)]-0x1;_0x1669dd>=0x0;_0x1669dd--)if(_0x152226=_0x50df0c[_0x1669dd])_0x9e4e59=(_0x1e0baa<0x3?_0x152226(_0x9e4e59):_0x1e0baa>0x3?_0x152226(_0x5bb9b3,_0x5a0624,_0x9e4e59):_0x152226(_0x5bb9b3,_0x5a0624))||_0x9e4e59;}return _0x1e0baa>0x3&&_0x9e4e59&&Object[_0x410125(0x145)](_0x5bb9b3,_0x5a0624,_0x9e4e59),_0x9e4e59;},__metadata=this&&this['__metadata']||function(_0x4c7e4f,_0x1c4917){const _0x502063=a387_0x5a2a;if(typeof Reflect==='object'&&typeof Reflect[_0x502063(0x13d)]===_0x502063(0x131))return Reflect[_0x502063(0x13d)](_0x4c7e4f,_0x1c4917);},__param=this&&this[a387_0x318b60(0x12a)]||function(_0x130784,_0x14557b){return function(_0xfd9fa,_0x511ae5){_0x14557b(_0xfd9fa,_0x511ae5,_0x130784);};},__importDefault=this&&this['__importDefault']||function(_0x3306eb){const _0x3fed3b=a387_0x318b60;return _0x3306eb&&_0x3306eb[_0x3fed3b(0x146)]?_0x3306eb:{'default':_0x3306eb};};Object[a387_0x318b60(0x145)](exports,a387_0x318b60(0x146),{'value':!![]}),exports[a387_0x318b60(0x13b)]=void 0x0;function a387_0x5a2a(_0x5e98fe,_0x1afd75){const _0x1d37b6=a387_0x226a();return a387_0x5a2a=function(_0x494e5,_0x2a51da){_0x494e5=_0x494e5-0x10f;let _0x226a17=_0x1d37b6[_0x494e5];return _0x226a17;},a387_0x5a2a(_0x5e98fe,_0x1afd75);}const core_1=require('../../core'),dependency_service_1=require(a387_0x318b60(0x116)),snapshot_service_1=require(a387_0x318b60(0x118)),deploy_service_1=require(a387_0x318b60(0x127)),veeva_request_utils_1=require(a387_0x318b60(0x128)),status_enums_1=require(a387_0x318b60(0x10f)),shortid_1=__importDefault(require(a387_0x318b60(0x142))),fs_util_1=require(a387_0x318b60(0x15c)),logger_1=require(a387_0x318b60(0x123)),promises_1=require(a387_0x318b60(0x11e)),base_veeva_error_1=require(a387_0x318b60(0x144)),salesforce_request_utils_1=require(a387_0x318b60(0x119)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a387_0x318b60(0x14b)),rollback_service_1=require('./services/rollback.service'),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0xba6428){const _0x281920=a387_0x318b60,{veevaAuth:_0x59b920,timeZone:_0x4c4870,attachmentLogId:_0x28c223}=_0xba6428;try{const _0x4ab896=(0x0,veeva_request_utils_1[_0x281920(0x12f)])(new veeva_auth_1[(_0x281920(0x140))](_0x59b920,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2f903c=await salesforce_auth_1['SalesforceAuth'][_0x281920(0x117)](),_0x31973a=(0x0,salesforce_request_utils_1[_0x281920(0x150)])(new salesforce_auth_1['SalesforceAuth'](_0x2f903c)),_0x1310b4=new logger_1[(_0x281920(0x12c))](_0x31973a,_0x4c4870,_0x28c223),_0x355b6c=new snapshot_service_1[(_0x281920(0x115))](_0xba6428,_0x31973a,_0x4ab896,_0x1310b4);return _0x355b6c['execute']()[_0x281920(0x11f)](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x281920(0x14f)]};}catch(_0x499ba8){return{'responseStatus':status_enums_1[_0x281920(0x13f)][_0x281920(0x113)],'responseMessage':_0x499ba8[_0x281920(0x125)]};}}async[a387_0x318b60(0x15a)](_0xfbafe4){const _0x489dd6=a387_0x318b60,{veevaAuth:_0x33f8f6,timeZone:_0x44f099,attachmentLogId:_0x4cdc18}=_0xfbafe4;try{const _0xa3e495=(0x0,veeva_request_utils_1[_0x489dd6(0x12f)])(new veeva_auth_1[(_0x489dd6(0x140))](_0x33f8f6,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x52974d=await salesforce_auth_1[_0x489dd6(0x13a)][_0x489dd6(0x117)](),_0x4473e1=(0x0,salesforce_request_utils_1[_0x489dd6(0x150)])(new salesforce_auth_1['SalesforceAuth'](_0x52974d)),_0x33d9f4=new logger_1[(_0x489dd6(0x12c))](_0x4473e1,_0x44f099,_0x4cdc18),_0x2d85fd='temp/veeva/deploy_'+(0x0,shortid_1[_0x489dd6(0x143)])();await(0x0,fs_util_1['makeDir'])(_0x2d85fd);const _0x57aa7d=new deploy_service_1[(_0x489dd6(0x149))](_0xfbafe4,_0x4473e1,_0xa3e495,_0x33d9f4,_0x2d85fd,_0x52974d[_0x489dd6(0x11b)]);return _0x57aa7d[_0x489dd6(0x136)]()[_0x489dd6(0x11d)](()=>(0x0,promises_1['rm'])(_0x2d85fd,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x489dd6(0x14f)]};}catch(_0x476308){return{'responseStatus':status_enums_1[_0x489dd6(0x13f)][_0x489dd6(0x113)],'responseMessage':_0x476308[_0x489dd6(0x125)]};}}async[a387_0x318b60(0x14e)](_0x9a556a){const _0x49ccbe=a387_0x318b60,{veevaAuth:_0x768c61}=_0x9a556a;try{const _0x580b1d=(0x0,veeva_request_utils_1[_0x49ccbe(0x12f)])(new veeva_auth_1['VeevaAuth'](_0x768c61)),_0x877217=await salesforce_auth_1['SalesforceAuth'][_0x49ccbe(0x117)](),_0x3071ff=(0x0,salesforce_request_utils_1[_0x49ccbe(0x150)])(new salesforce_auth_1[(_0x49ccbe(0x13a))](_0x877217)),_0x46f720=new dependency_service_1[(_0x49ccbe(0x14d))](_0x9a556a,_0x3071ff,_0x580b1d);return await _0x46f720[_0x49ccbe(0x136)]();}catch(_0x3735c5){const _0x38a21b=_0x3735c5 instanceof base_veeva_error_1[_0x49ccbe(0x130)]?_0x3735c5[_0x49ccbe(0x137)]()[_0x49ccbe(0x141)]('\x0a'):_0x3735c5[_0x49ccbe(0x125)];return{'responseStatus':status_enums_1[_0x49ccbe(0x13f)][_0x49ccbe(0x113)],'responseMessage':_0x38a21b};}}async[a387_0x318b60(0x11a)](_0x17dca2){const _0x3dca16=a387_0x318b60,{veevaAuth:_0x1c228e,timeZone:_0x5f0d87,attachmentLogId:_0x3c8879}=_0x17dca2;try{const _0x2900c9=(0x0,veeva_request_utils_1[_0x3dca16(0x12f)])(new veeva_auth_1[(_0x3dca16(0x140))](_0x1c228e,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x10a7b0=await salesforce_auth_1[_0x3dca16(0x13a)][_0x3dca16(0x117)](),_0x38dcdc=(0x0,salesforce_request_utils_1[_0x3dca16(0x150)])(new salesforce_auth_1['SalesforceAuth'](_0x10a7b0)),_0x7861d2=new logger_1[(_0x3dca16(0x12c))](_0x38dcdc,_0x5f0d87,_0x3c8879),_0x360561=_0x3dca16(0x155)+(0x0,shortid_1[_0x3dca16(0x143)])();await(0x0,fs_util_1[_0x3dca16(0x157)])(_0x360561);const _0x23cdac=new rollback_service_1[(_0x3dca16(0x134))]({..._0x17dca2,'connectionVeeva':_0x2900c9,'connectionSalesforce':_0x38dcdc,'logger':_0x7861d2,'tempFolder':_0x360561,'instanceUrl':_0x10a7b0['instanceUrl']});return _0x23cdac['execute']()[_0x3dca16(0x11d)](()=>(0x0,promises_1['rm'])(_0x360561,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x3dca16(0x13f)]['SUCCESS']};}catch(_0x3addb8){return{'responseStatus':status_enums_1[_0x3dca16(0x13f)]['FAILURE'],'responseMessage':_0x3addb8[_0x3dca16(0x125)]};}}};__decorate([(0x0,core_1[a387_0x318b60(0x159)])(a387_0x318b60(0x14a)),__param(0x0,core_1[a387_0x318b60(0x129)][a387_0x318b60(0x120)]()),__metadata(a387_0x318b60(0x138),Function),__metadata(a387_0x318b60(0x151),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a387_0x318b60(0x12e)],a387_0x318b60(0x11c),null),__decorate([(0x0,core_1['Post'])(a387_0x318b60(0x124)),__param(0x0,core_1[a387_0x318b60(0x129)][a387_0x318b60(0x120)]()),__metadata(a387_0x318b60(0x138),Function),__metadata(a387_0x318b60(0x151),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a387_0x318b60(0x12e)],a387_0x318b60(0x15a),null),__decorate([(0x0,core_1['Post'])(a387_0x318b60(0x139)),__param(0x0,core_1[a387_0x318b60(0x129)][a387_0x318b60(0x120)]()),__metadata(a387_0x318b60(0x138),Function),__metadata(a387_0x318b60(0x151),[Object]),__metadata(a387_0x318b60(0x12d),Promise)],VeevaVaultController['prototype'],a387_0x318b60(0x14e),null),__decorate([(0x0,core_1['Post'])(a387_0x318b60(0x11a)),__param(0x0,core_1['param'][a387_0x318b60(0x120)]()),__metadata(a387_0x318b60(0x138),Function),__metadata(a387_0x318b60(0x151),[Object]),__metadata(a387_0x318b60(0x12d),Promise)],VeevaVaultController[a387_0x318b60(0x12e)],a387_0x318b60(0x11a),null),VeevaVaultController=__decorate([(0x0,core_1[a387_0x318b60(0x126)])(a387_0x318b60(0x122)),(0x0,core_1[a387_0x318b60(0x135)])('v1.1')],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;