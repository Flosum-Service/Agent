const a415_0x4aff91=a415_0x2403;(function(_0x5485c9,_0x12d89c){const _0x3893e5=a415_0x2403,_0x3c8411=_0x5485c9();while(!![]){try{const _0xe7c729=-parseInt(_0x3893e5(0x1c5))/0x1*(parseInt(_0x3893e5(0x1db))/0x2)+-parseInt(_0x3893e5(0x1ff))/0x3*(parseInt(_0x3893e5(0x1c2))/0x4)+-parseInt(_0x3893e5(0x1ef))/0x5*(parseInt(_0x3893e5(0x1b9))/0x6)+parseInt(_0x3893e5(0x1e6))/0x7+-parseInt(_0x3893e5(0x1cd))/0x8*(parseInt(_0x3893e5(0x1e5))/0x9)+-parseInt(_0x3893e5(0x1d4))/0xa+parseInt(_0x3893e5(0x1d3))/0xb*(parseInt(_0x3893e5(0x1d2))/0xc);if(_0xe7c729===_0x12d89c)break;else _0x3c8411['push'](_0x3c8411['shift']());}catch(_0x32c542){_0x3c8411['push'](_0x3c8411['shift']());}}}(a415_0x5a6f,0xdc184));const a415_0x2689c4=(function(){let _0x119b68=!![];return function(_0x51854f,_0x4d2430){const _0x4a213f=_0x119b68?function(){const _0x384482=a415_0x2403;if(_0x4d2430){const _0x5b8db6=_0x4d2430[_0x384482(0x1ca)](_0x51854f,arguments);return _0x4d2430=null,_0x5b8db6;}}:function(){};return _0x119b68=![],_0x4a213f;};}()),a415_0x5b16b1=a415_0x2689c4(this,function(){const _0x3777fd=a415_0x2403;return a415_0x5b16b1[_0x3777fd(0x1da)]()['search'](_0x3777fd(0x1fc))[_0x3777fd(0x1da)]()[_0x3777fd(0x1fe)](a415_0x5b16b1)[_0x3777fd(0x1d1)](_0x3777fd(0x1fc));});a415_0x5b16b1();function a415_0x2403(_0x1f270d,_0x477875){const _0x5f1333=a415_0x5a6f();return a415_0x2403=function(_0x5b16b1,_0x2689c4){_0x5b16b1=_0x5b16b1-0x1b8;let _0x5a6f16=_0x5f1333[_0x5b16b1];return _0x5a6f16;},a415_0x2403(_0x1f270d,_0x477875);}'use strict';var __decorate=this&&this[a415_0x4aff91(0x1b8)]||function(_0x5c1e6b,_0x4e1800,_0x2d2467,_0x4177e5){const _0x894ced=a415_0x4aff91;var _0x2aab83=arguments[_0x894ced(0x1ea)],_0x4ed248=_0x2aab83<0x3?_0x4e1800:_0x4177e5===null?_0x4177e5=Object[_0x894ced(0x1f4)](_0x4e1800,_0x2d2467):_0x4177e5,_0x1dd18d;if(typeof Reflect===_0x894ced(0x1fd)&&typeof Reflect['decorate']===_0x894ced(0x1bd))_0x4ed248=Reflect[_0x894ced(0x1c9)](_0x5c1e6b,_0x4e1800,_0x2d2467,_0x4177e5);else{for(var _0x51ab0a=_0x5c1e6b['length']-0x1;_0x51ab0a>=0x0;_0x51ab0a--)if(_0x1dd18d=_0x5c1e6b[_0x51ab0a])_0x4ed248=(_0x2aab83<0x3?_0x1dd18d(_0x4ed248):_0x2aab83>0x3?_0x1dd18d(_0x4e1800,_0x2d2467,_0x4ed248):_0x1dd18d(_0x4e1800,_0x2d2467))||_0x4ed248;}return _0x2aab83>0x3&&_0x4ed248&&Object[_0x894ced(0x1d9)](_0x4e1800,_0x2d2467,_0x4ed248),_0x4ed248;},__metadata=this&&this[a415_0x4aff91(0x1e9)]||function(_0x4f5497,_0x31bc21){const _0x347a09=a415_0x4aff91;if(typeof Reflect===_0x347a09(0x1fd)&&typeof Reflect[_0x347a09(0x1ce)]===_0x347a09(0x1bd))return Reflect['metadata'](_0x4f5497,_0x31bc21);},__param=this&&this[a415_0x4aff91(0x1c1)]||function(_0xda38d7,_0x7c689b){return function(_0x1b9534,_0x1a6691){_0x7c689b(_0x1b9534,_0x1a6691,_0xda38d7);};},__importDefault=this&&this[a415_0x4aff91(0x1f9)]||function(_0x52ffe6){const _0x32cd7b=a415_0x4aff91;return _0x52ffe6&&_0x52ffe6[_0x32cd7b(0x1bb)]?_0x52ffe6:{'default':_0x52ffe6};};Object[a415_0x4aff91(0x1d9)](exports,a415_0x4aff91(0x1bb),{'value':!![]}),exports[a415_0x4aff91(0x1c4)]=void 0x0;const core_1=require(a415_0x4aff91(0x1f1)),dependency_service_1=require(a415_0x4aff91(0x1e3)),snapshot_service_1=require(a415_0x4aff91(0x1e8)),deploy_service_1=require(a415_0x4aff91(0x1bc)),veeva_request_utils_1=require(a415_0x4aff91(0x1d8)),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require(a415_0x4aff91(0x1f5))),fs_util_1=require(a415_0x4aff91(0x1dd)),logger_1=require('./classes/loggers/logger'),promises_1=require(a415_0x4aff91(0x1ee)),base_veeva_error_1=require(a415_0x4aff91(0x1bf)),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require(a415_0x4aff91(0x203)),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require(a415_0x4aff91(0x1cc)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;function a415_0x5a6f(){const _0x54093c=['deploy','createSalesforceRequest','search','39264528NnIkmO','11WLinop','1181080NeZaLL','Post','default','FAILURE','./utils/veeva-request.utils','defineProperty','toString','2soBZgy','design:paramtypes','./utils/fs-util','instanceUrl','rollback','prototype','temp/veeva/rollback_','RollbackService','./services/dependency.service','doSnapshot','24183QUmYRI','5673325SsLsPw','SalesforceAuth','./services/snapshot.service','__metadata','length','then','AppResponseStatus','v1.1','fs/promises','92420qleppV','param','../../core','VeevaAuth','BaseVeevaError','getOwnPropertyDescriptor','shortid','retrieveDependency','Controller','design:returntype','__importDefault','veeva-vault','SUCCESS','(((.+)+)+)+$','object','constructor','1030065YkjOEU','makeDir','finally','Logger','./classes/auth/veeva-auth','design:type','__decorate','156OXnIOy','execute','__esModule','./services/deploy.service','function','getAuthDetails','./classes/errors/base-veeva-error','DependencyService','__param','8VglRev','body','VeevaVaultController','1583917kCNfuK','message','deployFromBranch','SnapshotService','decorate','apply','createVeevaRequest','./services/rollback.service','928oIUfLg','metadata'];a415_0x5a6f=function(){return _0x54093c;};return a415_0x5a6f();}let VeevaVaultController=class VeevaVaultController{async[a415_0x4aff91(0x1e4)](_0x109a37){const _0x2f9600=a415_0x4aff91,{veevaAuth:_0x496ee9,timeZone:_0x557e4a,attachmentLogId:_0x5b0e80}=_0x109a37;try{const _0x255503=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x2f9600(0x1f2))](_0x496ee9,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x3e963f=await salesforce_auth_1[_0x2f9600(0x1e7)][_0x2f9600(0x1be)](),_0x87427b=(0x0,salesforce_request_utils_1[_0x2f9600(0x1d0)])(new salesforce_auth_1[(_0x2f9600(0x1e7))](_0x3e963f)),_0x54b0c9=new logger_1[(_0x2f9600(0x202))](_0x87427b,_0x557e4a,_0x5b0e80),_0x177e43=new snapshot_service_1[(_0x2f9600(0x1c8))](_0x109a37,_0x87427b,_0x255503,_0x54b0c9);return _0x177e43['execute']()[_0x2f9600(0x1eb)](),{'responseStatus':status_enums_1[_0x2f9600(0x1ec)][_0x2f9600(0x1fb)]};}catch(_0x59a508){return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x59a508[_0x2f9600(0x1c6)]};}}async[a415_0x4aff91(0x1c7)](_0xae3341){const _0x2b0595=a415_0x4aff91,{veevaAuth:_0xd8c9cc,timeZone:_0x11a327,attachmentLogId:_0x227bd1}=_0xae3341;try{const _0x55d9a2=(0x0,veeva_request_utils_1[_0x2b0595(0x1cb)])(new veeva_auth_1[(_0x2b0595(0x1f2))](_0xd8c9cc,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1654d6=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x233b46=(0x0,salesforce_request_utils_1[_0x2b0595(0x1d0)])(new salesforce_auth_1['SalesforceAuth'](_0x1654d6)),_0x213d12=new logger_1['Logger'](_0x233b46,_0x11a327,_0x227bd1),_0x465981='temp/veeva/deploy_'+(0x0,shortid_1[_0x2b0595(0x1d6)])();await(0x0,fs_util_1[_0x2b0595(0x200)])(_0x465981);const _0x580c72=new deploy_service_1['DeployService'](_0xae3341,_0x233b46,_0x55d9a2,_0x213d12,_0x465981,_0x1654d6[_0x2b0595(0x1de)]);return _0x580c72[_0x2b0595(0x1ba)]()[_0x2b0595(0x201)](()=>(0x0,promises_1['rm'])(_0x465981,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x2b0595(0x1fb)]};}catch(_0x4ba129){return{'responseStatus':status_enums_1[_0x2b0595(0x1ec)][_0x2b0595(0x1d7)],'responseMessage':_0x4ba129[_0x2b0595(0x1c6)]};}}async[a415_0x4aff91(0x1f6)](_0x31d40a){const _0x2b8ff6=a415_0x4aff91,{veevaAuth:_0xc426a9}=_0x31d40a;try{const _0x1a774b=(0x0,veeva_request_utils_1[_0x2b8ff6(0x1cb)])(new veeva_auth_1[(_0x2b8ff6(0x1f2))](_0xc426a9)),_0x5e4c0e=await salesforce_auth_1[_0x2b8ff6(0x1e7)][_0x2b8ff6(0x1be)](),_0x21a704=(0x0,salesforce_request_utils_1[_0x2b8ff6(0x1d0)])(new salesforce_auth_1[(_0x2b8ff6(0x1e7))](_0x5e4c0e)),_0x4d40a6=new dependency_service_1[(_0x2b8ff6(0x1c0))](_0x31d40a,_0x21a704,_0x1a774b);return await _0x4d40a6['execute']();}catch(_0x2444a6){const _0x2d6154=_0x2444a6 instanceof base_veeva_error_1[_0x2b8ff6(0x1f3)]?_0x2444a6['getMessages']()['join']('\x0a'):_0x2444a6[_0x2b8ff6(0x1c6)];return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x2d6154};}}async[a415_0x4aff91(0x1df)](_0xaee1dc){const _0x522f22=a415_0x4aff91,{veevaAuth:_0x5456fa,timeZone:_0x3a8b10,attachmentLogId:_0x33fa53}=_0xaee1dc;try{const _0x2c7c29=(0x0,veeva_request_utils_1[_0x522f22(0x1cb)])(new veeva_auth_1[(_0x522f22(0x1f2))](_0x5456fa,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2cb4c4=await salesforce_auth_1['SalesforceAuth'][_0x522f22(0x1be)](),_0x3ab298=(0x0,salesforce_request_utils_1[_0x522f22(0x1d0)])(new salesforce_auth_1[(_0x522f22(0x1e7))](_0x2cb4c4)),_0x205d0f=new logger_1[(_0x522f22(0x202))](_0x3ab298,_0x3a8b10,_0x33fa53),_0x510957=_0x522f22(0x1e1)+(0x0,shortid_1['default'])();await(0x0,fs_util_1['makeDir'])(_0x510957);const _0x55cd92=new rollback_service_1[(_0x522f22(0x1e2))]({..._0xaee1dc,'connectionVeeva':_0x2c7c29,'connectionSalesforce':_0x3ab298,'logger':_0x205d0f,'tempFolder':_0x510957,'instanceUrl':_0x2cb4c4[_0x522f22(0x1de)]});return _0x55cd92[_0x522f22(0x1ba)]()[_0x522f22(0x201)](()=>(0x0,promises_1['rm'])(_0x510957,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x522f22(0x1ec)][_0x522f22(0x1fb)]};}catch(_0x579fbb){return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x579fbb[_0x522f22(0x1c6)]};}}};__decorate([(0x0,core_1[a415_0x4aff91(0x1d5)])('snapshot'),__param(0x0,core_1[a415_0x4aff91(0x1f0)]['body']()),__metadata(a415_0x4aff91(0x204),Function),__metadata(a415_0x4aff91(0x1dc),[Object]),__metadata(a415_0x4aff91(0x1f8),Promise)],VeevaVaultController[a415_0x4aff91(0x1e0)],a415_0x4aff91(0x1e4),null),__decorate([(0x0,core_1[a415_0x4aff91(0x1d5)])(a415_0x4aff91(0x1cf)),__param(0x0,core_1['param'][a415_0x4aff91(0x1c3)]()),__metadata(a415_0x4aff91(0x204),Function),__metadata(a415_0x4aff91(0x1dc),[Object]),__metadata(a415_0x4aff91(0x1f8),Promise)],VeevaVaultController[a415_0x4aff91(0x1e0)],a415_0x4aff91(0x1c7),null),__decorate([(0x0,core_1[a415_0x4aff91(0x1d5)])('dependency'),__param(0x0,core_1['param'][a415_0x4aff91(0x1c3)]()),__metadata(a415_0x4aff91(0x204),Function),__metadata(a415_0x4aff91(0x1dc),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a415_0x4aff91(0x1e0)],a415_0x4aff91(0x1f6),null),__decorate([(0x0,core_1[a415_0x4aff91(0x1d5)])(a415_0x4aff91(0x1df)),__param(0x0,core_1[a415_0x4aff91(0x1f0)]['body']()),__metadata(a415_0x4aff91(0x204),Function),__metadata(a415_0x4aff91(0x1dc),[Object]),__metadata(a415_0x4aff91(0x1f8),Promise)],VeevaVaultController[a415_0x4aff91(0x1e0)],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a415_0x4aff91(0x1f7)])(a415_0x4aff91(0x1fa)),(0x0,core_1['Version'])(a415_0x4aff91(0x1ed))],VeevaVaultController),exports[a415_0x4aff91(0x1c4)]=VeevaVaultController;