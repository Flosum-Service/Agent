const a403_0x4dabd4=a403_0x1d7f;(function(_0x3b9190,_0x3c9eac){const _0x44f060=a403_0x1d7f,_0x258566=_0x3b9190();while(!![]){try{const _0x389c65=parseInt(_0x44f060(0x145))/0x1+-parseInt(_0x44f060(0x102))/0x2+-parseInt(_0x44f060(0x110))/0x3*(-parseInt(_0x44f060(0x126))/0x4)+-parseInt(_0x44f060(0x124))/0x5+parseInt(_0x44f060(0x10b))/0x6+-parseInt(_0x44f060(0x100))/0x7*(-parseInt(_0x44f060(0x11e))/0x8)+-parseInt(_0x44f060(0x12e))/0x9;if(_0x389c65===_0x3c9eac)break;else _0x258566['push'](_0x258566['shift']());}catch(_0x3f4019){_0x258566['push'](_0x258566['shift']());}}}(a403_0x4499,0x52326));const a403_0x209819=(function(){let _0x3f8b82=!![];return function(_0x17e874,_0x23ee25){const _0x3257ac=_0x3f8b82?function(){const _0x332576=a403_0x1d7f;if(_0x23ee25){const _0x32194d=_0x23ee25[_0x332576(0x11d)](_0x17e874,arguments);return _0x23ee25=null,_0x32194d;}}:function(){};return _0x3f8b82=![],_0x3257ac;};}()),a403_0xef75f7=a403_0x209819(this,function(){const _0x46885e=a403_0x1d7f;return a403_0xef75f7[_0x46885e(0x13b)]()[_0x46885e(0x10d)](_0x46885e(0x12d))[_0x46885e(0x13b)]()[_0x46885e(0x116)](a403_0xef75f7)[_0x46885e(0x10d)](_0x46885e(0x12d));});a403_0xef75f7();function a403_0x1d7f(_0x500d95,_0x548638){const _0x2dd1ca=a403_0x4499();return a403_0x1d7f=function(_0xef75f7,_0x209819){_0xef75f7=_0xef75f7-0xfe;let _0x44991b=_0x2dd1ca[_0xef75f7];return _0x44991b;},a403_0x1d7f(_0x500d95,_0x548638);}'use strict';var __decorate=this&&this['__decorate']||function(_0x5a0d8,_0x3a57a6,_0x97baf1,_0x86442f){const _0x2e1f65=a403_0x1d7f;var _0x1df22d=arguments[_0x2e1f65(0x11f)],_0x14ed4d=_0x1df22d<0x3?_0x3a57a6:_0x86442f===null?_0x86442f=Object[_0x2e1f65(0x121)](_0x3a57a6,_0x97baf1):_0x86442f,_0x57688c;if(typeof Reflect===_0x2e1f65(0x104)&&typeof Reflect[_0x2e1f65(0x113)]===_0x2e1f65(0x135))_0x14ed4d=Reflect[_0x2e1f65(0x113)](_0x5a0d8,_0x3a57a6,_0x97baf1,_0x86442f);else{for(var _0x27e3e1=_0x5a0d8[_0x2e1f65(0x11f)]-0x1;_0x27e3e1>=0x0;_0x27e3e1--)if(_0x57688c=_0x5a0d8[_0x27e3e1])_0x14ed4d=(_0x1df22d<0x3?_0x57688c(_0x14ed4d):_0x1df22d>0x3?_0x57688c(_0x3a57a6,_0x97baf1,_0x14ed4d):_0x57688c(_0x3a57a6,_0x97baf1))||_0x14ed4d;}return _0x1df22d>0x3&&_0x14ed4d&&Object[_0x2e1f65(0x13a)](_0x3a57a6,_0x97baf1,_0x14ed4d),_0x14ed4d;},__metadata=this&&this[a403_0x4dabd4(0x11b)]||function(_0x4e4288,_0x2a39ea){const _0x13f6c0=a403_0x4dabd4;if(typeof Reflect===_0x13f6c0(0x104)&&typeof Reflect['metadata']===_0x13f6c0(0x135))return Reflect[_0x13f6c0(0x130)](_0x4e4288,_0x2a39ea);},__param=this&&this[a403_0x4dabd4(0x114)]||function(_0x2dd13c,_0x21b100){return function(_0x51041b,_0x286a09){_0x21b100(_0x51041b,_0x286a09,_0x2dd13c);};},__importDefault=this&&this['__importDefault']||function(_0x349bc2){const _0x4b4586=a403_0x4dabd4;return _0x349bc2&&_0x349bc2[_0x4b4586(0x131)]?_0x349bc2:{'default':_0x349bc2};};Object['defineProperty'](exports,a403_0x4dabd4(0x131),{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require(a403_0x4dabd4(0x12b)),dependency_service_1=require('./services/dependency.service'),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a403_0x4dabd4(0x12f)),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a403_0x4dabd4(0x117)),shortid_1=__importDefault(require('shortid')),fs_util_1=require(a403_0x4dabd4(0x137)),logger_1=require(a403_0x4dabd4(0x119)),promises_1=require('fs/promises'),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require(a403_0x4dabd4(0x144)),veeva_auth_1=require(a403_0x4dabd4(0x123)),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require(a403_0x4dabd4(0xfe)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a403_0x4dabd4(0x105)](_0x35feec){const _0x59ca84=a403_0x4dabd4,{veevaAuth:_0x2a5544,timeZone:_0x16cb71,attachmentLogId:_0x3b2832}=_0x35feec;try{const _0x538185=(0x0,veeva_request_utils_1[_0x59ca84(0x136)])(new veeva_auth_1['VeevaAuth'](_0x2a5544,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x35c391=await salesforce_auth_1[_0x59ca84(0x111)]['getAuthDetails'](),_0x4d19f7=(0x0,salesforce_request_utils_1[_0x59ca84(0x101)])(new salesforce_auth_1[(_0x59ca84(0x111))](_0x35c391)),_0x69364b=new logger_1[(_0x59ca84(0x112))](_0x4d19f7,_0x16cb71,_0x3b2832),_0x1eff58=new snapshot_service_1[(_0x59ca84(0x127))](_0x35feec,_0x4d19f7,_0x538185,_0x69364b);return _0x1eff58[_0x59ca84(0x142)]()['then'](),{'responseStatus':status_enums_1[_0x59ca84(0x132)]['SUCCESS']};}catch(_0x645513){return{'responseStatus':status_enums_1[_0x59ca84(0x132)]['FAILURE'],'responseMessage':_0x645513[_0x59ca84(0x139)]};}}async[a403_0x4dabd4(0x128)](_0x568b13){const _0x31cec1=a403_0x4dabd4,{veevaAuth:_0x5998a1,timeZone:_0x1a506e,attachmentLogId:_0x46b14}=_0x568b13;try{const _0x13ddac=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x31cec1(0x10a))](_0x5998a1,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x45b0eb=await salesforce_auth_1[_0x31cec1(0x111)][_0x31cec1(0x133)](),_0x57bc96=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x31cec1(0x111))](_0x45b0eb)),_0x1dbd84=new logger_1[(_0x31cec1(0x112))](_0x57bc96,_0x1a506e,_0x46b14),_0xb75ff=_0x31cec1(0x12a)+(0x0,shortid_1[_0x31cec1(0x11a)])();await(0x0,fs_util_1[_0x31cec1(0x10f)])(_0xb75ff);const _0x500677=new deploy_service_1[(_0x31cec1(0x13c))](_0x568b13,_0x57bc96,_0x13ddac,_0x1dbd84,_0xb75ff,_0x45b0eb[_0x31cec1(0x122)]);return _0x500677['execute']()[_0x31cec1(0x118)](()=>(0x0,promises_1['rm'])(_0xb75ff,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x31cec1(0x132)]['SUCCESS']};}catch(_0x42abaa){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x31cec1(0x109)],'responseMessage':_0x42abaa[_0x31cec1(0x139)]};}}async[a403_0x4dabd4(0x115)](_0x4d9908){const _0x45e3aa=a403_0x4dabd4,{veevaAuth:_0x2a5a4d}=_0x4d9908;try{const _0x3748bd=(0x0,veeva_request_utils_1[_0x45e3aa(0x136)])(new veeva_auth_1[(_0x45e3aa(0x10a))](_0x2a5a4d)),_0x60a104=await salesforce_auth_1['SalesforceAuth'][_0x45e3aa(0x133)](),_0x2761c=(0x0,salesforce_request_utils_1[_0x45e3aa(0x101)])(new salesforce_auth_1[(_0x45e3aa(0x111))](_0x60a104)),_0x42a6a7=new dependency_service_1[(_0x45e3aa(0x103))](_0x4d9908,_0x2761c,_0x3748bd);return await _0x42a6a7[_0x45e3aa(0x142)]();}catch(_0x1ecae2){const _0x238514=_0x1ecae2 instanceof base_veeva_error_1[_0x45e3aa(0x129)]?_0x1ecae2[_0x45e3aa(0x143)]()[_0x45e3aa(0x138)]('\x0a'):_0x1ecae2[_0x45e3aa(0x139)];return{'responseStatus':status_enums_1[_0x45e3aa(0x132)][_0x45e3aa(0x109)],'responseMessage':_0x238514};}}async[a403_0x4dabd4(0x10c)](_0x2f05b7){const _0x46755a=a403_0x4dabd4,{veevaAuth:_0x535f55,timeZone:_0x446cbe,attachmentLogId:_0x411db1}=_0x2f05b7;try{const _0x289ba5=(0x0,veeva_request_utils_1[_0x46755a(0x136)])(new veeva_auth_1[(_0x46755a(0x10a))](_0x535f55,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x570674=await salesforce_auth_1['SalesforceAuth'][_0x46755a(0x133)](),_0x26c72a=(0x0,salesforce_request_utils_1[_0x46755a(0x101)])(new salesforce_auth_1[(_0x46755a(0x111))](_0x570674)),_0x4c4437=new logger_1[(_0x46755a(0x112))](_0x26c72a,_0x446cbe,_0x411db1),_0x542b1a=_0x46755a(0x13d)+(0x0,shortid_1[_0x46755a(0x11a)])();await(0x0,fs_util_1[_0x46755a(0x10f)])(_0x542b1a);const _0x179843=new rollback_service_1[(_0x46755a(0x125))]({..._0x2f05b7,'connectionVeeva':_0x289ba5,'connectionSalesforce':_0x26c72a,'logger':_0x4c4437,'tempFolder':_0x542b1a,'instanceUrl':_0x570674[_0x46755a(0x122)]});return _0x179843['execute']()[_0x46755a(0x118)](()=>(0x0,promises_1['rm'])(_0x542b1a,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x46755a(0x132)][_0x46755a(0x13e)]};}catch(_0xc1a0b2){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x46755a(0x109)],'responseMessage':_0xc1a0b2[_0x46755a(0x139)]};}}};__decorate([(0x0,core_1['Post'])(a403_0x4dabd4(0x13f)),__param(0x0,core_1[a403_0x4dabd4(0x141)][a403_0x4dabd4(0x140)]()),__metadata(a403_0x4dabd4(0xff),Function),__metadata(a403_0x4dabd4(0x12c),[Object]),__metadata(a403_0x4dabd4(0x120),Promise)],VeevaVaultController[a403_0x4dabd4(0x10e)],a403_0x4dabd4(0x105),null),__decorate([(0x0,core_1['Post'])('deploy'),__param(0x0,core_1[a403_0x4dabd4(0x141)]['body']()),__metadata(a403_0x4dabd4(0xff),Function),__metadata(a403_0x4dabd4(0x12c),[Object]),__metadata(a403_0x4dabd4(0x120),Promise)],VeevaVaultController[a403_0x4dabd4(0x10e)],a403_0x4dabd4(0x128),null),__decorate([(0x0,core_1[a403_0x4dabd4(0x106)])(a403_0x4dabd4(0x107)),__param(0x0,core_1[a403_0x4dabd4(0x141)]['body']()),__metadata(a403_0x4dabd4(0xff),Function),__metadata('design:paramtypes',[Object]),__metadata(a403_0x4dabd4(0x120),Promise)],VeevaVaultController['prototype'],a403_0x4dabd4(0x115),null),__decorate([(0x0,core_1[a403_0x4dabd4(0x106)])('rollback'),__param(0x0,core_1['param'][a403_0x4dabd4(0x140)]()),__metadata(a403_0x4dabd4(0xff),Function),__metadata(a403_0x4dabd4(0x12c),[Object]),__metadata(a403_0x4dabd4(0x120),Promise)],VeevaVaultController['prototype'],a403_0x4dabd4(0x10c),null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])(a403_0x4dabd4(0x108)),(0x0,core_1['Version'])(a403_0x4dabd4(0x134))],VeevaVaultController),exports[a403_0x4dabd4(0x11c)]=VeevaVaultController;function a403_0x4499(){const _0x3f0cb5=['./enums/status.enums','finally','./classes/loggers/logger','default','__metadata','VeevaVaultController','apply','120yKxvXC','length','design:returntype','getOwnPropertyDescriptor','instanceUrl','./classes/auth/veeva-auth','210730vDzCzR','RollbackService','144WvIIWF','SnapshotService','deployFromBranch','BaseVeevaError','temp/veeva/deploy_','../../core','design:paramtypes','(((.+)+)+)+$','1622367iHHRwt','./services/deploy.service','metadata','__esModule','AppResponseStatus','getAuthDetails','v1.1','function','createVeevaRequest','./utils/fs-util','join','message','defineProperty','toString','DeployService','temp/veeva/rollback_','SUCCESS','snapshot','body','param','execute','getMessages','./utils/salesforce-request.utils','156562eHTWEl','./services/rollback.service','design:type','269913fvpQqk','createSalesforceRequest','977716BGHESd','DependencyService','object','doSnapshot','Post','dependency','veeva-vault','FAILURE','VeevaAuth','1877772FNAKWd','rollback','search','prototype','makeDir','3aXvHgZ','SalesforceAuth','Logger','decorate','__param','retrieveDependency','constructor'];a403_0x4499=function(){return _0x3f0cb5;};return a403_0x4499();}