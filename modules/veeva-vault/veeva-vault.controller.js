const a414_0x222753=a414_0x38eb;(function(_0x30bd1a,_0x1080d4){const _0x1d7b70=a414_0x38eb,_0x1b4047=_0x30bd1a();while(!![]){try{const _0x118dc7=parseInt(_0x1d7b70(0x207))/0x1+parseInt(_0x1d7b70(0x1ec))/0x2+-parseInt(_0x1d7b70(0x1d9))/0x3*(parseInt(_0x1d7b70(0x1f9))/0x4)+-parseInt(_0x1d7b70(0x1cc))/0x5*(parseInt(_0x1d7b70(0x1f2))/0x6)+parseInt(_0x1d7b70(0x1f5))/0x7*(parseInt(_0x1d7b70(0x1bf))/0x8)+parseInt(_0x1d7b70(0x1e8))/0x9+-parseInt(_0x1d7b70(0x1f6))/0xa*(parseInt(_0x1d7b70(0x1fd))/0xb);if(_0x118dc7===_0x1080d4)break;else _0x1b4047['push'](_0x1b4047['shift']());}catch(_0x211d09){_0x1b4047['push'](_0x1b4047['shift']());}}}(a414_0x54a1,0xe4ee6));const a414_0x5c6985=(function(){let _0x3f308a=!![];return function(_0x534231,_0x4cb34a){const _0x4ce649=_0x3f308a?function(){const _0x242485=a414_0x38eb;if(_0x4cb34a){const _0x27d1ae=_0x4cb34a[_0x242485(0x1c8)](_0x534231,arguments);return _0x4cb34a=null,_0x27d1ae;}}:function(){};return _0x3f308a=![],_0x4ce649;};}()),a414_0x1b2112=a414_0x5c6985(this,function(){const _0x5b67a5=a414_0x38eb;return a414_0x1b2112['toString']()[_0x5b67a5(0x1c2)](_0x5b67a5(0x1e6))[_0x5b67a5(0x1da)]()[_0x5b67a5(0x1fc)](a414_0x1b2112)['search'](_0x5b67a5(0x1e6));});a414_0x1b2112();'use strict';var __decorate=this&&this[a414_0x222753(0x1d0)]||function(_0x269dd8,_0x291fb8,_0x260fe4,_0x335f93){const _0x1a1820=a414_0x222753;var _0x476d3c=arguments[_0x1a1820(0x1ca)],_0x117d2f=_0x476d3c<0x3?_0x291fb8:_0x335f93===null?_0x335f93=Object['getOwnPropertyDescriptor'](_0x291fb8,_0x260fe4):_0x335f93,_0x4b9126;if(typeof Reflect===_0x1a1820(0x1dc)&&typeof Reflect['decorate']===_0x1a1820(0x1e5))_0x117d2f=Reflect[_0x1a1820(0x1e2)](_0x269dd8,_0x291fb8,_0x260fe4,_0x335f93);else{for(var _0x12190f=_0x269dd8[_0x1a1820(0x1ca)]-0x1;_0x12190f>=0x0;_0x12190f--)if(_0x4b9126=_0x269dd8[_0x12190f])_0x117d2f=(_0x476d3c<0x3?_0x4b9126(_0x117d2f):_0x476d3c>0x3?_0x4b9126(_0x291fb8,_0x260fe4,_0x117d2f):_0x4b9126(_0x291fb8,_0x260fe4))||_0x117d2f;}return _0x476d3c>0x3&&_0x117d2f&&Object[_0x1a1820(0x1db)](_0x291fb8,_0x260fe4,_0x117d2f),_0x117d2f;},__metadata=this&&this[a414_0x222753(0x1fe)]||function(_0x25ba6c,_0x109356){const _0x559775=a414_0x222753;if(typeof Reflect===_0x559775(0x1dc)&&typeof Reflect['metadata']==='function')return Reflect[_0x559775(0x1e0)](_0x25ba6c,_0x109356);},__param=this&&this[a414_0x222753(0x1f1)]||function(_0xc72847,_0x3e81fa){return function(_0x33b661,_0x364fab){_0x3e81fa(_0x33b661,_0x364fab,_0xc72847);};},__importDefault=this&&this[a414_0x222753(0x1eb)]||function(_0x555701){const _0x24c72d=a414_0x222753;return _0x555701&&_0x555701[_0x24c72d(0x1de)]?_0x555701:{'default':_0x555701};};Object[a414_0x222753(0x1db)](exports,a414_0x222753(0x1de),{'value':!![]}),exports[a414_0x222753(0x1c0)]=void 0x0;const core_1=require(a414_0x222753(0x1cd)),dependency_service_1=require('./services/dependency.service'),snapshot_service_1=require(a414_0x222753(0x1d8)),deploy_service_1=require(a414_0x222753(0x1c5)),veeva_request_utils_1=require(a414_0x222753(0x1d6)),status_enums_1=require(a414_0x222753(0x202)),shortid_1=__importDefault(require(a414_0x222753(0x1c6))),fs_util_1=require(a414_0x222753(0x1cb)),logger_1=require('./classes/loggers/logger'),promises_1=require('fs/promises'),base_veeva_error_1=require(a414_0x222753(0x1fa)),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require(a414_0x222753(0x1f0)),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require(a414_0x222753(0x1c3)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a414_0x222753(0x1c1)](_0x5296a5){const _0x379184=a414_0x222753,{veevaAuth:_0x51dcb0,timeZone:_0x3dfdc2,attachmentLogId:_0x1269f8}=_0x5296a5;try{const _0x4331d5=(0x0,veeva_request_utils_1[_0x379184(0x1e7)])(new veeva_auth_1[(_0x379184(0x1ea))](_0x51dcb0,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x38d9f7=await salesforce_auth_1[_0x379184(0x1ff)][_0x379184(0x204)](),_0x1bf86f=(0x0,salesforce_request_utils_1[_0x379184(0x1f8)])(new salesforce_auth_1[(_0x379184(0x1ff))](_0x38d9f7)),_0x32f2e1=new logger_1['Logger'](_0x1bf86f,_0x3dfdc2,_0x1269f8),_0x540bd4=new snapshot_service_1['SnapshotService'](_0x5296a5,_0x1bf86f,_0x4331d5,_0x32f2e1);return _0x540bd4[_0x379184(0x201)]()[_0x379184(0x1cf)](),{'responseStatus':status_enums_1[_0x379184(0x209)][_0x379184(0x1c7)]};}catch(_0x387169){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x379184(0x203)],'responseMessage':_0x387169[_0x379184(0x1d3)]};}}async[a414_0x222753(0x1e9)](_0x15e0df){const _0xf7e24=a414_0x222753,{veevaAuth:_0xbbb974,timeZone:_0x320120,attachmentLogId:_0x5ef2b5}=_0x15e0df;try{const _0x15137d=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0xf7e24(0x1ea))](_0xbbb974,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2717de=await salesforce_auth_1[_0xf7e24(0x1ff)][_0xf7e24(0x204)](),_0x46e330=(0x0,salesforce_request_utils_1[_0xf7e24(0x1f8)])(new salesforce_auth_1[(_0xf7e24(0x1ff))](_0x2717de)),_0x47d771=new logger_1[(_0xf7e24(0x1d4))](_0x46e330,_0x320120,_0x5ef2b5),_0x26a8d1=_0xf7e24(0x208)+(0x0,shortid_1[_0xf7e24(0x1d5)])();await(0x0,fs_util_1['makeDir'])(_0x26a8d1);const _0x1582d9=new deploy_service_1[(_0xf7e24(0x1df))](_0x15e0df,_0x46e330,_0x15137d,_0x47d771,_0x26a8d1,_0x2717de[_0xf7e24(0x1f3)]);return _0x1582d9['execute']()['finally'](()=>(0x0,promises_1['rm'])(_0x26a8d1,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0xf7e24(0x1c7)]};}catch(_0x56d973){return{'responseStatus':status_enums_1[_0xf7e24(0x209)][_0xf7e24(0x203)],'responseMessage':_0x56d973[_0xf7e24(0x1d3)]};}}async[a414_0x222753(0x1f7)](_0x1f864b){const _0x7639cd=a414_0x222753,{veevaAuth:_0x51594a}=_0x1f864b;try{const _0x53a215=(0x0,veeva_request_utils_1[_0x7639cd(0x1e7)])(new veeva_auth_1[(_0x7639cd(0x1ea))](_0x51594a)),_0x2707b5=await salesforce_auth_1[_0x7639cd(0x1ff)][_0x7639cd(0x204)](),_0x49dcf7=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0x2707b5)),_0x21270d=new dependency_service_1[(_0x7639cd(0x1dd))](_0x1f864b,_0x49dcf7,_0x53a215);return await _0x21270d[_0x7639cd(0x201)]();}catch(_0x5eb5fb){const _0x4a32f0=_0x5eb5fb instanceof base_veeva_error_1[_0x7639cd(0x1d1)]?_0x5eb5fb[_0x7639cd(0x200)]()[_0x7639cd(0x1fb)]('\x0a'):_0x5eb5fb[_0x7639cd(0x1d3)];return{'responseStatus':status_enums_1[_0x7639cd(0x209)][_0x7639cd(0x203)],'responseMessage':_0x4a32f0};}}async[a414_0x222753(0x205)](_0x125f69){const _0x340b2c=a414_0x222753,{veevaAuth:_0x1c14e4,timeZone:_0x4980a5,attachmentLogId:_0x2b1873}=_0x125f69;try{const _0x46698d=(0x0,veeva_request_utils_1[_0x340b2c(0x1e7)])(new veeva_auth_1[(_0x340b2c(0x1ea))](_0x1c14e4,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x4fe433=await salesforce_auth_1[_0x340b2c(0x1ff)][_0x340b2c(0x204)](),_0x21bcbd=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x340b2c(0x1ff))](_0x4fe433)),_0x4c491e=new logger_1['Logger'](_0x21bcbd,_0x4980a5,_0x2b1873),_0x3203e1=_0x340b2c(0x1d7)+(0x0,shortid_1[_0x340b2c(0x1d5)])();await(0x0,fs_util_1['makeDir'])(_0x3203e1);const _0xdc9b85=new rollback_service_1[(_0x340b2c(0x1d2))]({..._0x125f69,'connectionVeeva':_0x46698d,'connectionSalesforce':_0x21bcbd,'logger':_0x4c491e,'tempFolder':_0x3203e1,'instanceUrl':_0x4fe433['instanceUrl']});return _0xdc9b85['execute']()[_0x340b2c(0x1e1)](()=>(0x0,promises_1['rm'])(_0x3203e1,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus']['SUCCESS']};}catch(_0x15d6b8){return{'responseStatus':status_enums_1[_0x340b2c(0x209)]['FAILURE'],'responseMessage':_0x15d6b8[_0x340b2c(0x1d3)]};}}};function a414_0x38eb(_0x894987,_0x28c669){const _0x201aaa=a414_0x54a1();return a414_0x38eb=function(_0x1b2112,_0x5c6985){_0x1b2112=_0x1b2112-0x1bf;let _0x54a137=_0x201aaa[_0x1b2112];return _0x54a137;},a414_0x38eb(_0x894987,_0x28c669);}function a414_0x54a1(){const _0xcb559e=['__metadata','SalesforceAuth','getMessages','execute','./enums/status.enums','FAILURE','getAuthDetails','rollback','dependency','1127392CPWaXP','temp/veeva/deploy_','AppResponseStatus','param','48BiWpHf','VeevaVaultController','doSnapshot','search','./services/rollback.service','prototype','./services/deploy.service','shortid','SUCCESS','apply','design:returntype','length','./utils/fs-util','36835SMvcCj','../../core','v1.1','then','__decorate','BaseVeevaError','RollbackService','message','Logger','default','./utils/veeva-request.utils','temp/veeva/rollback_','./services/snapshot.service','29493RQnGuy','toString','defineProperty','object','DependencyService','__esModule','DeployService','metadata','finally','decorate','veeva-vault','Controller','function','(((.+)+)+)+$','createVeevaRequest','7433496lvpxPy','deployFromBranch','VeevaAuth','__importDefault','1939954claXFc','body','design:type','Post','./classes/auth/veeva-auth','__param','222OovhkE','instanceUrl','design:paramtypes','1204721tQyvMR','3730vFKSFA','retrieveDependency','createSalesforceRequest','56aNphcm','./classes/errors/base-veeva-error','join','constructor','76912wbPlpZ'];a414_0x54a1=function(){return _0xcb559e;};return a414_0x54a1();}__decorate([(0x0,core_1[a414_0x222753(0x1ef)])('snapshot'),__param(0x0,core_1[a414_0x222753(0x20a)][a414_0x222753(0x1ed)]()),__metadata(a414_0x222753(0x1ee),Function),__metadata(a414_0x222753(0x1f4),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a414_0x222753(0x1c4)],a414_0x222753(0x1c1),null),__decorate([(0x0,core_1[a414_0x222753(0x1ef)])('deploy'),__param(0x0,core_1['param'][a414_0x222753(0x1ed)]()),__metadata(a414_0x222753(0x1ee),Function),__metadata('design:paramtypes',[Object]),__metadata(a414_0x222753(0x1c9),Promise)],VeevaVaultController[a414_0x222753(0x1c4)],a414_0x222753(0x1e9),null),__decorate([(0x0,core_1['Post'])(a414_0x222753(0x206)),__param(0x0,core_1[a414_0x222753(0x20a)][a414_0x222753(0x1ed)]()),__metadata('design:type',Function),__metadata(a414_0x222753(0x1f4),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a414_0x222753(0x1c4)],'retrieveDependency',null),__decorate([(0x0,core_1[a414_0x222753(0x1ef)])(a414_0x222753(0x205)),__param(0x0,core_1[a414_0x222753(0x20a)][a414_0x222753(0x1ed)]()),__metadata(a414_0x222753(0x1ee),Function),__metadata(a414_0x222753(0x1f4),[Object]),__metadata(a414_0x222753(0x1c9),Promise)],VeevaVaultController[a414_0x222753(0x1c4)],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a414_0x222753(0x1e4)])(a414_0x222753(0x1e3)),(0x0,core_1['Version'])(a414_0x222753(0x1ce))],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;