const a414_0x44f8c0=a414_0x27f4;(function(_0x33fdd7,_0x3fcf3e){const _0xa9b494=a414_0x27f4,_0x4e16d0=_0x33fdd7();while(!![]){try{const _0x527dc2=-parseInt(_0xa9b494(0xdc))/0x1+parseInt(_0xa9b494(0xbe))/0x2+parseInt(_0xa9b494(0xdb))/0x3*(-parseInt(_0xa9b494(0xd9))/0x4)+-parseInt(_0xa9b494(0xc5))/0x5*(parseInt(_0xa9b494(0xf3))/0x6)+-parseInt(_0xa9b494(0xe2))/0x7*(parseInt(_0xa9b494(0xbd))/0x8)+parseInt(_0xa9b494(0xbc))/0x9*(-parseInt(_0xa9b494(0xda))/0xa)+parseInt(_0xa9b494(0xb7))/0xb*(parseInt(_0xa9b494(0xe7))/0xc);if(_0x527dc2===_0x3fcf3e)break;else _0x4e16d0['push'](_0x4e16d0['shift']());}catch(_0x13e03f){_0x4e16d0['push'](_0x4e16d0['shift']());}}}(a414_0x317a,0x388a6));const a414_0x195cc5=(function(){let _0x41c1b7=!![];return function(_0x47631a,_0x1a4113){const _0x53f4f3=_0x41c1b7?function(){const _0x33e06d=a414_0x27f4;if(_0x1a4113){const _0x4ab23d=_0x1a4113[_0x33e06d(0xde)](_0x47631a,arguments);return _0x1a4113=null,_0x4ab23d;}}:function(){};return _0x41c1b7=![],_0x53f4f3;};}()),a414_0x17ce00=a414_0x195cc5(this,function(){const _0x51b121=a414_0x27f4;return a414_0x17ce00['toString']()[_0x51b121(0xf4)](_0x51b121(0xb2))['toString']()[_0x51b121(0xc3)](a414_0x17ce00)[_0x51b121(0xf4)](_0x51b121(0xb2));});a414_0x17ce00();'use strict';var __decorate=this&&this['__decorate']||function(_0x399d36,_0x59cfbf,_0xe6598d,_0x224d83){const _0x58b702=a414_0x27f4;var _0xe13232=arguments[_0x58b702(0xe1)],_0x551f3a=_0xe13232<0x3?_0x59cfbf:_0x224d83===null?_0x224d83=Object[_0x58b702(0xce)](_0x59cfbf,_0xe6598d):_0x224d83,_0x2e5a1b;if(typeof Reflect===_0x58b702(0xb4)&&typeof Reflect[_0x58b702(0xd6)]===_0x58b702(0xe6))_0x551f3a=Reflect[_0x58b702(0xd6)](_0x399d36,_0x59cfbf,_0xe6598d,_0x224d83);else{for(var _0x1519ac=_0x399d36[_0x58b702(0xe1)]-0x1;_0x1519ac>=0x0;_0x1519ac--)if(_0x2e5a1b=_0x399d36[_0x1519ac])_0x551f3a=(_0xe13232<0x3?_0x2e5a1b(_0x551f3a):_0xe13232>0x3?_0x2e5a1b(_0x59cfbf,_0xe6598d,_0x551f3a):_0x2e5a1b(_0x59cfbf,_0xe6598d))||_0x551f3a;}return _0xe13232>0x3&&_0x551f3a&&Object[_0x58b702(0xd3)](_0x59cfbf,_0xe6598d,_0x551f3a),_0x551f3a;},__metadata=this&&this[a414_0x44f8c0(0xcf)]||function(_0x2b691f,_0x58f8b0){const _0x5db009=a414_0x44f8c0;if(typeof Reflect==='object'&&typeof Reflect[_0x5db009(0xba)]==='function')return Reflect[_0x5db009(0xba)](_0x2b691f,_0x58f8b0);},__param=this&&this['__param']||function(_0x4fba7a,_0x44fa07){return function(_0x40da26,_0x2a38f0){_0x44fa07(_0x40da26,_0x2a38f0,_0x4fba7a);};},__importDefault=this&&this['__importDefault']||function(_0x2c2b4f){const _0x3bbecf=a414_0x44f8c0;return _0x2c2b4f&&_0x2c2b4f[_0x3bbecf(0xd5)]?_0x2c2b4f:{'default':_0x2c2b4f};};Object[a414_0x44f8c0(0xd3)](exports,'__esModule',{'value':!![]}),exports[a414_0x44f8c0(0xf7)]=void 0x0;function a414_0x27f4(_0x281069,_0x77c01){const _0x5869ca=a414_0x317a();return a414_0x27f4=function(_0x17ce00,_0x195cc5){_0x17ce00=_0x17ce00-0xb1;let _0x317ad9=_0x5869ca[_0x17ce00];return _0x317ad9;},a414_0x27f4(_0x281069,_0x77c01);}function a414_0x317a(){const _0x57f691=['temp/veeva/deploy_','getAuthDetails','function','3234492lNREWb','SnapshotService','instanceUrl','RollbackService','../../core','finally','param','./utils/veeva-request.utils','shortid','./classes/auth/salesforce-auth','./services/deploy.service','./enums/status.enums','408942dsDglK','search','then','Controller','VeevaVaultController','AppResponseStatus','VeevaAuth','design:type','(((.+)+)+)+$','deploy','object','./services/dependency.service','FAILURE','77GreSeg','./classes/errors/base-veeva-error','SalesforceAuth','metadata','execute','1449gUfDss','128424jgsYtf','90756WtdvuT','retrieveDependency','./utils/salesforce-request.utils','getMessages','makeDir','constructor','Logger','25YdCEpw','doSnapshot','dependency','./services/rollback.service','deployFromBranch','BaseVeevaError','Post','design:paramtypes','./services/snapshot.service','getOwnPropertyDescriptor','__metadata','fs/promises','message','createSalesforceRequest','defineProperty','rollback','__esModule','decorate','prototype','body','48284aqtXog','18360YUwLYK','111TVALdj','248348CswOZH','v1.1','apply','createVeevaRequest','default','length','161EAgLxM','design:returntype'];a414_0x317a=function(){return _0x57f691;};return a414_0x317a();}const core_1=require(a414_0x44f8c0(0xeb)),dependency_service_1=require(a414_0x44f8c0(0xb5)),snapshot_service_1=require(a414_0x44f8c0(0xcd)),deploy_service_1=require(a414_0x44f8c0(0xf1)),veeva_request_utils_1=require(a414_0x44f8c0(0xee)),status_enums_1=require(a414_0x44f8c0(0xf2)),shortid_1=__importDefault(require(a414_0x44f8c0(0xef))),fs_util_1=require('./utils/fs-util'),logger_1=require('./classes/loggers/logger'),promises_1=require(a414_0x44f8c0(0xd0)),base_veeva_error_1=require(a414_0x44f8c0(0xb8)),salesforce_request_utils_1=require(a414_0x44f8c0(0xc0)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a414_0x44f8c0(0xf0)),rollback_service_1=require(a414_0x44f8c0(0xc8)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a414_0x44f8c0(0xc6)](_0x25827e){const _0x2aac02=a414_0x44f8c0,{veevaAuth:_0x4262dd,timeZone:_0x9c795a,attachmentLogId:_0x323050}=_0x25827e;try{const _0x15bedb=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x2aac02(0xf9))](_0x4262dd,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x34e1a3=await salesforce_auth_1[_0x2aac02(0xb9)][_0x2aac02(0xe5)](),_0x9d7f8c=(0x0,salesforce_request_utils_1[_0x2aac02(0xd2)])(new salesforce_auth_1[(_0x2aac02(0xb9))](_0x34e1a3)),_0x5c9c6b=new logger_1['Logger'](_0x9d7f8c,_0x9c795a,_0x323050),_0x3ed611=new snapshot_service_1[(_0x2aac02(0xe8))](_0x25827e,_0x9d7f8c,_0x15bedb,_0x5c9c6b);return _0x3ed611[_0x2aac02(0xbb)]()[_0x2aac02(0xf5)](),{'responseStatus':status_enums_1['AppResponseStatus']['SUCCESS']};}catch(_0x19f533){return{'responseStatus':status_enums_1[_0x2aac02(0xf8)][_0x2aac02(0xb6)],'responseMessage':_0x19f533[_0x2aac02(0xd1)]};}}async[a414_0x44f8c0(0xc9)](_0x4c6096){const _0x2edb53=a414_0x44f8c0,{veevaAuth:_0x41d440,timeZone:_0x2a8f12,attachmentLogId:_0x5a55fe}=_0x4c6096;try{const _0x35faa6=(0x0,veeva_request_utils_1[_0x2edb53(0xdf)])(new veeva_auth_1['VeevaAuth'](_0x41d440,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x17db05=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x453211=(0x0,salesforce_request_utils_1[_0x2edb53(0xd2)])(new salesforce_auth_1[(_0x2edb53(0xb9))](_0x17db05)),_0x3174d8=new logger_1[(_0x2edb53(0xc4))](_0x453211,_0x2a8f12,_0x5a55fe),_0x2ffc6f=_0x2edb53(0xe4)+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x2edb53(0xc2)])(_0x2ffc6f);const _0x87697b=new deploy_service_1['DeployService'](_0x4c6096,_0x453211,_0x35faa6,_0x3174d8,_0x2ffc6f,_0x17db05['instanceUrl']);return _0x87697b[_0x2edb53(0xbb)]()['finally'](()=>(0x0,promises_1['rm'])(_0x2ffc6f,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x2edb53(0xf8)]['SUCCESS']};}catch(_0x490714){return{'responseStatus':status_enums_1[_0x2edb53(0xf8)]['FAILURE'],'responseMessage':_0x490714[_0x2edb53(0xd1)]};}}async['retrieveDependency'](_0x417bc3){const _0x1fb345=a414_0x44f8c0,{veevaAuth:_0x535d6c}=_0x417bc3;try{const _0x1b7ce4=(0x0,veeva_request_utils_1[_0x1fb345(0xdf)])(new veeva_auth_1[(_0x1fb345(0xf9))](_0x535d6c)),_0x460da4=await salesforce_auth_1[_0x1fb345(0xb9)]['getAuthDetails'](),_0x344f25=(0x0,salesforce_request_utils_1[_0x1fb345(0xd2)])(new salesforce_auth_1[(_0x1fb345(0xb9))](_0x460da4)),_0x475864=new dependency_service_1['DependencyService'](_0x417bc3,_0x344f25,_0x1b7ce4);return await _0x475864['execute']();}catch(_0x48f92f){const _0xb60510=_0x48f92f instanceof base_veeva_error_1[_0x1fb345(0xca)]?_0x48f92f[_0x1fb345(0xc1)]()['join']('\x0a'):_0x48f92f['message'];return{'responseStatus':status_enums_1[_0x1fb345(0xf8)][_0x1fb345(0xb6)],'responseMessage':_0xb60510};}}async['rollback'](_0x32f07d){const _0x515bc5=a414_0x44f8c0,{veevaAuth:_0x4558f2,timeZone:_0x31f20f,attachmentLogId:_0x29d749}=_0x32f07d;try{const _0x356cd1=(0x0,veeva_request_utils_1[_0x515bc5(0xdf)])(new veeva_auth_1[(_0x515bc5(0xf9))](_0x4558f2,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x30f622=await salesforce_auth_1[_0x515bc5(0xb9)][_0x515bc5(0xe5)](),_0x469fcb=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x515bc5(0xb9))](_0x30f622)),_0x4a2a10=new logger_1[(_0x515bc5(0xc4))](_0x469fcb,_0x31f20f,_0x29d749),_0x321e50='temp/veeva/rollback_'+(0x0,shortid_1[_0x515bc5(0xe0)])();await(0x0,fs_util_1['makeDir'])(_0x321e50);const _0x4163b9=new rollback_service_1[(_0x515bc5(0xea))]({..._0x32f07d,'connectionVeeva':_0x356cd1,'connectionSalesforce':_0x469fcb,'logger':_0x4a2a10,'tempFolder':_0x321e50,'instanceUrl':_0x30f622[_0x515bc5(0xe9)]});return _0x4163b9[_0x515bc5(0xbb)]()[_0x515bc5(0xec)](()=>(0x0,promises_1['rm'])(_0x321e50,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x515bc5(0xf8)]['SUCCESS']};}catch(_0x477ff1){return{'responseStatus':status_enums_1[_0x515bc5(0xf8)][_0x515bc5(0xb6)],'responseMessage':_0x477ff1[_0x515bc5(0xd1)]};}}};__decorate([(0x0,core_1[a414_0x44f8c0(0xcb)])('snapshot'),__param(0x0,core_1['param'][a414_0x44f8c0(0xd8)]()),__metadata(a414_0x44f8c0(0xb1),Function),__metadata('design:paramtypes',[Object]),__metadata(a414_0x44f8c0(0xe3),Promise)],VeevaVaultController[a414_0x44f8c0(0xd7)],a414_0x44f8c0(0xc6),null),__decorate([(0x0,core_1['Post'])(a414_0x44f8c0(0xb3)),__param(0x0,core_1[a414_0x44f8c0(0xed)]['body']()),__metadata(a414_0x44f8c0(0xb1),Function),__metadata('design:paramtypes',[Object]),__metadata(a414_0x44f8c0(0xe3),Promise)],VeevaVaultController['prototype'],a414_0x44f8c0(0xc9),null),__decorate([(0x0,core_1['Post'])(a414_0x44f8c0(0xc7)),__param(0x0,core_1[a414_0x44f8c0(0xed)][a414_0x44f8c0(0xd8)]()),__metadata('design:type',Function),__metadata(a414_0x44f8c0(0xcc),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a414_0x44f8c0(0xd7)],a414_0x44f8c0(0xbf),null),__decorate([(0x0,core_1['Post'])(a414_0x44f8c0(0xd4)),__param(0x0,core_1['param'][a414_0x44f8c0(0xd8)]()),__metadata(a414_0x44f8c0(0xb1),Function),__metadata('design:paramtypes',[Object]),__metadata(a414_0x44f8c0(0xe3),Promise)],VeevaVaultController[a414_0x44f8c0(0xd7)],a414_0x44f8c0(0xd4),null),VeevaVaultController=__decorate([(0x0,core_1[a414_0x44f8c0(0xf6)])('veeva-vault'),(0x0,core_1['Version'])(a414_0x44f8c0(0xdd))],VeevaVaultController),exports[a414_0x44f8c0(0xf7)]=VeevaVaultController;