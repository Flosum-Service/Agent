const a414_0x506512=a414_0x2b55;(function(_0x812ef5,_0x1410c9){const _0x339996=a414_0x2b55,_0x35e150=_0x812ef5();while(!![]){try{const _0x3bfa25=-parseInt(_0x339996(0x1ae))/0x1*(parseInt(_0x339996(0x1bc))/0x2)+parseInt(_0x339996(0x18c))/0x3+parseInt(_0x339996(0x194))/0x4*(-parseInt(_0x339996(0x1b5))/0x5)+parseInt(_0x339996(0x188))/0x6*(parseInt(_0x339996(0x17d))/0x7)+-parseInt(_0x339996(0x1b0))/0x8+parseInt(_0x339996(0x19c))/0x9*(-parseInt(_0x339996(0x1b4))/0xa)+parseInt(_0x339996(0x1bb))/0xb;if(_0x3bfa25===_0x1410c9)break;else _0x35e150['push'](_0x35e150['shift']());}catch(_0x2efdf6){_0x35e150['push'](_0x35e150['shift']());}}}(a414_0x5b17,0xa26be));const a414_0x5c012c=(function(){let _0x100516=!![];return function(_0x333a38,_0x36b5aa){const _0x1a5623=_0x100516?function(){if(_0x36b5aa){const _0x8855a8=_0x36b5aa['apply'](_0x333a38,arguments);return _0x36b5aa=null,_0x8855a8;}}:function(){};return _0x100516=![],_0x1a5623;};}()),a414_0x275c53=a414_0x5c012c(this,function(){const _0x1cea60=a414_0x2b55;return a414_0x275c53['toString']()['search'](_0x1cea60(0x175))[_0x1cea60(0x1b8)]()[_0x1cea60(0x1b2)](a414_0x275c53)[_0x1cea60(0x199)](_0x1cea60(0x175));});function a414_0x2b55(_0x5014f9,_0x42e1d7){const _0x177c06=a414_0x5b17();return a414_0x2b55=function(_0x275c53,_0x5c012c){_0x275c53=_0x275c53-0x171;let _0x5b179c=_0x177c06[_0x275c53];return _0x5b179c;},a414_0x2b55(_0x5014f9,_0x42e1d7);}a414_0x275c53();function a414_0x5b17(){const _0x162a0a=['./classes/errors/base-veeva-error','function','Post','finally','./classes/loggers/logger','rollback','FAILURE','AppResponseStatus','./classes/auth/salesforce-auth','doSnapshot','v1.1','getAuthDetails','261RnsrcI','./utils/salesforce-request.utils','4112792dJhKrU','retrieveDependency','constructor','body','730PXCiet','5QMioZn','./utils/veeva-request.utils','design:paramtypes','toString','SUCCESS','message','38945456wFmtaQ','8886GSSAMb','shortid','default','Controller','./services/deploy.service','(((.+)+)+)+$','param','temp/veeva/rollback_','snapshot','VeevaAuth','getMessages','./services/dependency.service','VeevaVaultController','2779raFEfA','veeva-vault','__param','dependency','metadata','./services/snapshot.service','./utils/fs-util','makeDir','createSalesforceRequest','decorate','DependencyService','5262Mrjyvq','__esModule','design:returntype','length','83415JbXfzD','instanceUrl','SnapshotService','__importDefault','createVeevaRequest','./services/rollback.service','__decorate','RollbackService','3980596ojspxX','execute','deployFromBranch','BaseVeevaError','Logger','search','prototype','SalesforceAuth','71793AuhmEq','deploy','./enums/status.enums','temp/veeva/deploy_','then','defineProperty'];a414_0x5b17=function(){return _0x162a0a;};return a414_0x5b17();}'use strict';var __decorate=this&&this[a414_0x506512(0x192)]||function(_0x28d2aa,_0x29aab9,_0x45e6a6,_0x5309a9){const _0x35454c=a414_0x506512;var _0x3aba63=arguments[_0x35454c(0x18b)],_0x2aadfa=_0x3aba63<0x3?_0x29aab9:_0x5309a9===null?_0x5309a9=Object['getOwnPropertyDescriptor'](_0x29aab9,_0x45e6a6):_0x5309a9,_0x317b97;if(typeof Reflect==='object'&&typeof Reflect[_0x35454c(0x186)]===_0x35454c(0x1a3))_0x2aadfa=Reflect[_0x35454c(0x186)](_0x28d2aa,_0x29aab9,_0x45e6a6,_0x5309a9);else{for(var _0x250f5e=_0x28d2aa['length']-0x1;_0x250f5e>=0x0;_0x250f5e--)if(_0x317b97=_0x28d2aa[_0x250f5e])_0x2aadfa=(_0x3aba63<0x3?_0x317b97(_0x2aadfa):_0x3aba63>0x3?_0x317b97(_0x29aab9,_0x45e6a6,_0x2aadfa):_0x317b97(_0x29aab9,_0x45e6a6))||_0x2aadfa;}return _0x3aba63>0x3&&_0x2aadfa&&Object[_0x35454c(0x1a1)](_0x29aab9,_0x45e6a6,_0x2aadfa),_0x2aadfa;},__metadata=this&&this['__metadata']||function(_0x2cfeae,_0x1ef751){const _0x9a1c97=a414_0x506512;if(typeof Reflect==='object'&&typeof Reflect[_0x9a1c97(0x181)]==='function')return Reflect['metadata'](_0x2cfeae,_0x1ef751);},__param=this&&this[a414_0x506512(0x17f)]||function(_0x4723a4,_0x3a533c){return function(_0x3af164,_0x5d63e8){_0x3a533c(_0x3af164,_0x5d63e8,_0x4723a4);};},__importDefault=this&&this[a414_0x506512(0x18f)]||function(_0x2117d7){return _0x2117d7&&_0x2117d7['__esModule']?_0x2117d7:{'default':_0x2117d7};};Object[a414_0x506512(0x1a1)](exports,a414_0x506512(0x189),{'value':!![]}),exports[a414_0x506512(0x17c)]=void 0x0;const core_1=require('../../core'),dependency_service_1=require(a414_0x506512(0x17b)),snapshot_service_1=require(a414_0x506512(0x182)),deploy_service_1=require(a414_0x506512(0x174)),veeva_request_utils_1=require(a414_0x506512(0x1b6)),status_enums_1=require(a414_0x506512(0x19e)),shortid_1=__importDefault(require(a414_0x506512(0x171))),fs_util_1=require(a414_0x506512(0x183)),logger_1=require(a414_0x506512(0x1a6)),promises_1=require('fs/promises'),base_veeva_error_1=require(a414_0x506512(0x1a2)),salesforce_request_utils_1=require(a414_0x506512(0x1af)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a414_0x506512(0x1aa)),rollback_service_1=require(a414_0x506512(0x191)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x38f0f0){const _0x333f43=a414_0x506512,{veevaAuth:_0x3c9a8e,timeZone:_0x1b25c1,attachmentLogId:_0xc144e0}=_0x38f0f0;try{const _0x22665e=(0x0,veeva_request_utils_1[_0x333f43(0x190)])(new veeva_auth_1[(_0x333f43(0x179))](_0x3c9a8e,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1c92a2=await salesforce_auth_1[_0x333f43(0x19b)][_0x333f43(0x1ad)](),_0x4c6181=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x333f43(0x19b))](_0x1c92a2)),_0x415c53=new logger_1[(_0x333f43(0x198))](_0x4c6181,_0x1b25c1,_0xc144e0),_0x323150=new snapshot_service_1[(_0x333f43(0x18e))](_0x38f0f0,_0x4c6181,_0x22665e,_0x415c53);return _0x323150['execute']()[_0x333f43(0x1a0)](),{'responseStatus':status_enums_1[_0x333f43(0x1a9)][_0x333f43(0x1b9)]};}catch(_0x46e5dd){return{'responseStatus':status_enums_1[_0x333f43(0x1a9)][_0x333f43(0x1a8)],'responseMessage':_0x46e5dd[_0x333f43(0x1ba)]};}}async[a414_0x506512(0x196)](_0x3496a4){const _0x216263=a414_0x506512,{veevaAuth:_0x4954a3,timeZone:_0x4e4e89,attachmentLogId:_0x3903a3}=_0x3496a4;try{const _0x830d22=(0x0,veeva_request_utils_1[_0x216263(0x190)])(new veeva_auth_1[(_0x216263(0x179))](_0x4954a3,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x20c187=await salesforce_auth_1[_0x216263(0x19b)][_0x216263(0x1ad)](),_0x3bc523=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x216263(0x19b))](_0x20c187)),_0x5b5d33=new logger_1['Logger'](_0x3bc523,_0x4e4e89,_0x3903a3),_0x55c142=_0x216263(0x19f)+(0x0,shortid_1[_0x216263(0x172)])();await(0x0,fs_util_1[_0x216263(0x184)])(_0x55c142);const _0x109185=new deploy_service_1['DeployService'](_0x3496a4,_0x3bc523,_0x830d22,_0x5b5d33,_0x55c142,_0x20c187['instanceUrl']);return _0x109185[_0x216263(0x195)]()[_0x216263(0x1a5)](()=>(0x0,promises_1['rm'])(_0x55c142,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x216263(0x1a9)]['SUCCESS']};}catch(_0x25ee27){return{'responseStatus':status_enums_1[_0x216263(0x1a9)][_0x216263(0x1a8)],'responseMessage':_0x25ee27[_0x216263(0x1ba)]};}}async[a414_0x506512(0x1b1)](_0x2e6afa){const _0x9ba500=a414_0x506512,{veevaAuth:_0x4894e5}=_0x2e6afa;try{const _0x3b77b8=(0x0,veeva_request_utils_1[_0x9ba500(0x190)])(new veeva_auth_1[(_0x9ba500(0x179))](_0x4894e5)),_0x5a79b0=await salesforce_auth_1[_0x9ba500(0x19b)]['getAuthDetails'](),_0x4d30b2=(0x0,salesforce_request_utils_1[_0x9ba500(0x185)])(new salesforce_auth_1[(_0x9ba500(0x19b))](_0x5a79b0)),_0x27920f=new dependency_service_1[(_0x9ba500(0x187))](_0x2e6afa,_0x4d30b2,_0x3b77b8);return await _0x27920f[_0x9ba500(0x195)]();}catch(_0x5db028){const _0x5320d8=_0x5db028 instanceof base_veeva_error_1[_0x9ba500(0x197)]?_0x5db028[_0x9ba500(0x17a)]()['join']('\x0a'):_0x5db028[_0x9ba500(0x1ba)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x9ba500(0x1a8)],'responseMessage':_0x5320d8};}}async[a414_0x506512(0x1a7)](_0x3ad92d){const _0x5c5db3=a414_0x506512,{veevaAuth:_0x16dfbd,timeZone:_0x45d3f8,attachmentLogId:_0x426791}=_0x3ad92d;try{const _0x57f880=(0x0,veeva_request_utils_1[_0x5c5db3(0x190)])(new veeva_auth_1[(_0x5c5db3(0x179))](_0x16dfbd,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x195ebb=await salesforce_auth_1[_0x5c5db3(0x19b)]['getAuthDetails'](),_0x6f5eb4=(0x0,salesforce_request_utils_1[_0x5c5db3(0x185)])(new salesforce_auth_1['SalesforceAuth'](_0x195ebb)),_0x44854f=new logger_1[(_0x5c5db3(0x198))](_0x6f5eb4,_0x45d3f8,_0x426791),_0x18b3ba=_0x5c5db3(0x177)+(0x0,shortid_1[_0x5c5db3(0x172)])();await(0x0,fs_util_1['makeDir'])(_0x18b3ba);const _0x260cc8=new rollback_service_1[(_0x5c5db3(0x193))]({..._0x3ad92d,'connectionVeeva':_0x57f880,'connectionSalesforce':_0x6f5eb4,'logger':_0x44854f,'tempFolder':_0x18b3ba,'instanceUrl':_0x195ebb[_0x5c5db3(0x18d)]});return _0x260cc8['execute']()[_0x5c5db3(0x1a5)](()=>(0x0,promises_1['rm'])(_0x18b3ba,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x5c5db3(0x1a9)][_0x5c5db3(0x1b9)]};}catch(_0x35fe72){return{'responseStatus':status_enums_1[_0x5c5db3(0x1a9)]['FAILURE'],'responseMessage':_0x35fe72[_0x5c5db3(0x1ba)]};}}};__decorate([(0x0,core_1[a414_0x506512(0x1a4)])(a414_0x506512(0x178)),__param(0x0,core_1[a414_0x506512(0x176)][a414_0x506512(0x1b3)]()),__metadata('design:type',Function),__metadata(a414_0x506512(0x1b7),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a414_0x506512(0x19a)],a414_0x506512(0x1ab),null),__decorate([(0x0,core_1[a414_0x506512(0x1a4)])(a414_0x506512(0x19d)),__param(0x0,core_1['param'][a414_0x506512(0x1b3)]()),__metadata('design:type',Function),__metadata(a414_0x506512(0x1b7),[Object]),__metadata(a414_0x506512(0x18a),Promise)],VeevaVaultController['prototype'],a414_0x506512(0x196),null),__decorate([(0x0,core_1['Post'])(a414_0x506512(0x180)),__param(0x0,core_1[a414_0x506512(0x176)][a414_0x506512(0x1b3)]()),__metadata('design:type',Function),__metadata(a414_0x506512(0x1b7),[Object]),__metadata(a414_0x506512(0x18a),Promise)],VeevaVaultController[a414_0x506512(0x19a)],a414_0x506512(0x1b1),null),__decorate([(0x0,core_1['Post'])(a414_0x506512(0x1a7)),__param(0x0,core_1['param'][a414_0x506512(0x1b3)]()),__metadata('design:type',Function),__metadata(a414_0x506512(0x1b7),[Object]),__metadata(a414_0x506512(0x18a),Promise)],VeevaVaultController[a414_0x506512(0x19a)],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a414_0x506512(0x173)])(a414_0x506512(0x17e)),(0x0,core_1['Version'])(a414_0x506512(0x1ac))],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;