const a402_0x101b1a=a402_0x28fb;(function(_0x4633d4,_0x58eb6){const _0x3beddd=a402_0x28fb,_0x344233=_0x4633d4();while(!![]){try{const _0x33c236=-parseInt(_0x3beddd(0x188))/0x1*(parseInt(_0x3beddd(0x1a6))/0x2)+-parseInt(_0x3beddd(0x1ab))/0x3*(-parseInt(_0x3beddd(0x17d))/0x4)+parseInt(_0x3beddd(0x1a1))/0x5+parseInt(_0x3beddd(0x1a4))/0x6*(-parseInt(_0x3beddd(0x18c))/0x7)+-parseInt(_0x3beddd(0x185))/0x8+-parseInt(_0x3beddd(0x1ba))/0x9*(-parseInt(_0x3beddd(0x19e))/0xa)+parseInt(_0x3beddd(0x177))/0xb;if(_0x33c236===_0x58eb6)break;else _0x344233['push'](_0x344233['shift']());}catch(_0xfcb17b){_0x344233['push'](_0x344233['shift']());}}}(a402_0x253d,0x93f48));const a402_0x38c3e8=(function(){let _0x5de893=!![];return function(_0x9835b4,_0x1852c4){const _0x53d6fd=_0x5de893?function(){const _0x581e03=a402_0x28fb;if(_0x1852c4){const _0x2a3def=_0x1852c4[_0x581e03(0x17e)](_0x9835b4,arguments);return _0x1852c4=null,_0x2a3def;}}:function(){};return _0x5de893=![],_0x53d6fd;};}()),a402_0x15e2a3=a402_0x38c3e8(this,function(){const _0x24fad5=a402_0x28fb;return a402_0x15e2a3['toString']()[_0x24fad5(0x190)](_0x24fad5(0x181))[_0x24fad5(0x1b4)]()['constructor'](a402_0x15e2a3)['search']('(((.+)+)+)+$');});a402_0x15e2a3();'use strict';var __decorate=this&&this['__decorate']||function(_0x29c6db,_0x47da7e,_0x472878,_0xc571d7){const _0x504f85=a402_0x28fb;var _0x25a818=arguments[_0x504f85(0x197)],_0x12cfa3=_0x25a818<0x3?_0x47da7e:_0xc571d7===null?_0xc571d7=Object[_0x504f85(0x1b1)](_0x47da7e,_0x472878):_0xc571d7,_0x5c92eb;if(typeof Reflect===_0x504f85(0x1aa)&&typeof Reflect[_0x504f85(0x195)]==='function')_0x12cfa3=Reflect[_0x504f85(0x195)](_0x29c6db,_0x47da7e,_0x472878,_0xc571d7);else{for(var _0xe2cbc8=_0x29c6db['length']-0x1;_0xe2cbc8>=0x0;_0xe2cbc8--)if(_0x5c92eb=_0x29c6db[_0xe2cbc8])_0x12cfa3=(_0x25a818<0x3?_0x5c92eb(_0x12cfa3):_0x25a818>0x3?_0x5c92eb(_0x47da7e,_0x472878,_0x12cfa3):_0x5c92eb(_0x47da7e,_0x472878))||_0x12cfa3;}return _0x25a818>0x3&&_0x12cfa3&&Object[_0x504f85(0x19b)](_0x47da7e,_0x472878,_0x12cfa3),_0x12cfa3;},__metadata=this&&this[a402_0x101b1a(0x198)]||function(_0x22f2a4,_0xa63abd){const _0x413405=a402_0x101b1a;if(typeof Reflect===_0x413405(0x1aa)&&typeof Reflect[_0x413405(0x189)]===_0x413405(0x180))return Reflect[_0x413405(0x189)](_0x22f2a4,_0xa63abd);},__param=this&&this[a402_0x101b1a(0x1c0)]||function(_0x44c668,_0xd7d0b5){return function(_0x1ec376,_0x3e5727){_0xd7d0b5(_0x1ec376,_0x3e5727,_0x44c668);};},__importDefault=this&&this['__importDefault']||function(_0x27334a){const _0x4fc951=a402_0x101b1a;return _0x27334a&&_0x27334a[_0x4fc951(0x1be)]?_0x27334a:{'default':_0x27334a};};function a402_0x253d(){const _0x262340=['getAuthDetails','design:type','966969wBgcMi','prototype','RollbackService','finally','__esModule','default','__param','retrieveDependency','join','createVeevaRequest','./services/deploy.service','3802007qIgkeJ','Controller','./utils/fs-util','message','deployFromBranch','instanceUrl','4zWXkeD','apply','FAILURE','function','(((.+)+)+)+$','VeevaVaultController','body','DeployService','5902656HdLZAO','VeevaAuth','DependencyService','3315SNZMfG','metadata','dependency','param','5513837cEYVGE','temp/veeva/rollback_','./utils/veeva-request.utils','rollback','search','shortid','SnapshotService','AppResponseStatus','snapshot','decorate','doSnapshot','length','__metadata','Version','design:paramtypes','defineProperty','./enums/status.enums','v1.1','80yvdliK','../../core','./classes/errors/base-veeva-error','3203180JfYNRp','design:returntype','Logger','6XntrAj','./services/dependency.service','194ZDsumo','SUCCESS','./classes/loggers/logger','execute','object','1821903fzcIRm','makeDir','SalesforceAuth','Post','veeva-vault','./utils/salesforce-request.utils','getOwnPropertyDescriptor','./classes/auth/veeva-auth','BaseVeevaError','toString','deploy','getMessages','createSalesforceRequest'];a402_0x253d=function(){return _0x262340;};return a402_0x253d();}function a402_0x28fb(_0x3320aa,_0x122f57){const _0x52f8fd=a402_0x253d();return a402_0x28fb=function(_0x15e2a3,_0x38c3e8){_0x15e2a3=_0x15e2a3-0x175;let _0x253d06=_0x52f8fd[_0x15e2a3];return _0x253d06;},a402_0x28fb(_0x3320aa,_0x122f57);}Object[a402_0x101b1a(0x19b)](exports,a402_0x101b1a(0x1be),{'value':!![]}),exports[a402_0x101b1a(0x182)]=void 0x0;const core_1=require(a402_0x101b1a(0x19f)),dependency_service_1=require(a402_0x101b1a(0x1a5)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a402_0x101b1a(0x176)),veeva_request_utils_1=require(a402_0x101b1a(0x18e)),status_enums_1=require(a402_0x101b1a(0x19c)),shortid_1=__importDefault(require(a402_0x101b1a(0x191))),fs_util_1=require(a402_0x101b1a(0x179)),logger_1=require(a402_0x101b1a(0x1a8)),promises_1=require('fs/promises'),base_veeva_error_1=require(a402_0x101b1a(0x1a0)),salesforce_request_utils_1=require(a402_0x101b1a(0x1b0)),veeva_auth_1=require(a402_0x101b1a(0x1b2)),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require('./services/rollback.service'),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a402_0x101b1a(0x196)](_0x3e9f4b){const _0x326af5=a402_0x101b1a,{veevaAuth:_0x3f5a29,timeZone:_0x2a40d2,attachmentLogId:_0x35b1e8}=_0x3e9f4b;try{const _0x23fab4=(0x0,veeva_request_utils_1[_0x326af5(0x175)])(new veeva_auth_1[(_0x326af5(0x186))](_0x3f5a29,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x4f61d8=await salesforce_auth_1[_0x326af5(0x1ad)][_0x326af5(0x1b8)](),_0x3090bd=(0x0,salesforce_request_utils_1[_0x326af5(0x1b7)])(new salesforce_auth_1[(_0x326af5(0x1ad))](_0x4f61d8)),_0x1f0302=new logger_1['Logger'](_0x3090bd,_0x2a40d2,_0x35b1e8),_0x4b181a=new snapshot_service_1[(_0x326af5(0x192))](_0x3e9f4b,_0x3090bd,_0x23fab4,_0x1f0302);return _0x4b181a[_0x326af5(0x1a9)]()['then'](),{'responseStatus':status_enums_1[_0x326af5(0x193)]['SUCCESS']};}catch(_0x4edf4f){return{'responseStatus':status_enums_1[_0x326af5(0x193)][_0x326af5(0x17f)],'responseMessage':_0x4edf4f[_0x326af5(0x17a)]};}}async[a402_0x101b1a(0x17b)](_0x5f2fa3){const _0x1c632d=a402_0x101b1a,{veevaAuth:_0x2e6fbc,timeZone:_0x5a0faf,attachmentLogId:_0x546904}=_0x5f2fa3;try{const _0x3514f6=(0x0,veeva_request_utils_1[_0x1c632d(0x175)])(new veeva_auth_1[(_0x1c632d(0x186))](_0x2e6fbc,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xaab775=await salesforce_auth_1[_0x1c632d(0x1ad)][_0x1c632d(0x1b8)](),_0xaa7d4b=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0xaab775)),_0x5e759f=new logger_1['Logger'](_0xaa7d4b,_0x5a0faf,_0x546904),_0x58a459='temp/veeva/deploy_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x1c632d(0x1ac)])(_0x58a459);const _0x2b31d7=new deploy_service_1[(_0x1c632d(0x184))](_0x5f2fa3,_0xaa7d4b,_0x3514f6,_0x5e759f,_0x58a459,_0xaab775[_0x1c632d(0x17c)]);return _0x2b31d7[_0x1c632d(0x1a9)]()[_0x1c632d(0x1bd)](()=>(0x0,promises_1['rm'])(_0x58a459,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x1c632d(0x193)][_0x1c632d(0x1a7)]};}catch(_0x5f5bc3){return{'responseStatus':status_enums_1[_0x1c632d(0x193)][_0x1c632d(0x17f)],'responseMessage':_0x5f5bc3[_0x1c632d(0x17a)]};}}async[a402_0x101b1a(0x1c1)](_0x118385){const _0x36a52b=a402_0x101b1a,{veevaAuth:_0x20bdc5}=_0x118385;try{const _0x3fe3ab=(0x0,veeva_request_utils_1[_0x36a52b(0x175)])(new veeva_auth_1[(_0x36a52b(0x186))](_0x20bdc5)),_0xab0b6=await salesforce_auth_1[_0x36a52b(0x1ad)]['getAuthDetails'](),_0x5121d5=(0x0,salesforce_request_utils_1[_0x36a52b(0x1b7)])(new salesforce_auth_1[(_0x36a52b(0x1ad))](_0xab0b6)),_0x175a0e=new dependency_service_1[(_0x36a52b(0x187))](_0x118385,_0x5121d5,_0x3fe3ab);return await _0x175a0e[_0x36a52b(0x1a9)]();}catch(_0x3b72be){const _0x1400e4=_0x3b72be instanceof base_veeva_error_1[_0x36a52b(0x1b3)]?_0x3b72be[_0x36a52b(0x1b6)]()[_0x36a52b(0x1c2)]('\x0a'):_0x3b72be['message'];return{'responseStatus':status_enums_1[_0x36a52b(0x193)][_0x36a52b(0x17f)],'responseMessage':_0x1400e4};}}async[a402_0x101b1a(0x18f)](_0x3e1908){const _0x368124=a402_0x101b1a,{veevaAuth:_0x559091,timeZone:_0x4f14e7,attachmentLogId:_0x4f54ef}=_0x3e1908;try{const _0x3303c0=(0x0,veeva_request_utils_1[_0x368124(0x175)])(new veeva_auth_1[(_0x368124(0x186))](_0x559091,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x3f8a25=await salesforce_auth_1[_0x368124(0x1ad)][_0x368124(0x1b8)](),_0x1c839e=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x368124(0x1ad))](_0x3f8a25)),_0x1a110c=new logger_1[(_0x368124(0x1a3))](_0x1c839e,_0x4f14e7,_0x4f54ef),_0x1dcbc2=_0x368124(0x18d)+(0x0,shortid_1[_0x368124(0x1bf)])();await(0x0,fs_util_1[_0x368124(0x1ac)])(_0x1dcbc2);const _0x760cc8=new rollback_service_1[(_0x368124(0x1bc))]({..._0x3e1908,'connectionVeeva':_0x3303c0,'connectionSalesforce':_0x1c839e,'logger':_0x1a110c,'tempFolder':_0x1dcbc2,'instanceUrl':_0x3f8a25[_0x368124(0x17c)]});return _0x760cc8[_0x368124(0x1a9)]()[_0x368124(0x1bd)](()=>(0x0,promises_1['rm'])(_0x1dcbc2,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x368124(0x193)]['SUCCESS']};}catch(_0x22b2ea){return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x22b2ea['message']};}}};__decorate([(0x0,core_1['Post'])(a402_0x101b1a(0x194)),__param(0x0,core_1[a402_0x101b1a(0x18b)][a402_0x101b1a(0x183)]()),__metadata('design:type',Function),__metadata(a402_0x101b1a(0x19a),[Object]),__metadata(a402_0x101b1a(0x1a2),Promise)],VeevaVaultController[a402_0x101b1a(0x1bb)],a402_0x101b1a(0x196),null),__decorate([(0x0,core_1['Post'])(a402_0x101b1a(0x1b5)),__param(0x0,core_1[a402_0x101b1a(0x18b)]['body']()),__metadata(a402_0x101b1a(0x1b9),Function),__metadata('design:paramtypes',[Object]),__metadata(a402_0x101b1a(0x1a2),Promise)],VeevaVaultController[a402_0x101b1a(0x1bb)],a402_0x101b1a(0x17b),null),__decorate([(0x0,core_1[a402_0x101b1a(0x1ae)])(a402_0x101b1a(0x18a)),__param(0x0,core_1[a402_0x101b1a(0x18b)]['body']()),__metadata(a402_0x101b1a(0x1b9),Function),__metadata(a402_0x101b1a(0x19a),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a402_0x101b1a(0x1bb)],'retrieveDependency',null),__decorate([(0x0,core_1[a402_0x101b1a(0x1ae)])(a402_0x101b1a(0x18f)),__param(0x0,core_1[a402_0x101b1a(0x18b)][a402_0x101b1a(0x183)]()),__metadata('design:type',Function),__metadata(a402_0x101b1a(0x19a),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a402_0x101b1a(0x178)])(a402_0x101b1a(0x1af)),(0x0,core_1[a402_0x101b1a(0x199)])(a402_0x101b1a(0x19d))],VeevaVaultController),exports[a402_0x101b1a(0x182)]=VeevaVaultController;