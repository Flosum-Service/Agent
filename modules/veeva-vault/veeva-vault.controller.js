const a415_0x21ddcc=a415_0x1f9d;(function(_0x3db286,_0x251042){const _0x8e1804=a415_0x1f9d,_0x314dd2=_0x3db286();while(!![]){try{const _0xd0fc97=-parseInt(_0x8e1804(0xb7))/0x1+parseInt(_0x8e1804(0x91))/0x2+parseInt(_0x8e1804(0xbe))/0x3*(-parseInt(_0x8e1804(0x89))/0x4)+-parseInt(_0x8e1804(0x88))/0x5*(-parseInt(_0x8e1804(0x8b))/0x6)+parseInt(_0x8e1804(0x87))/0x7*(-parseInt(_0x8e1804(0xb8))/0x8)+parseInt(_0x8e1804(0xa2))/0x9+parseInt(_0x8e1804(0xa0))/0xa;if(_0xd0fc97===_0x251042)break;else _0x314dd2['push'](_0x314dd2['shift']());}catch(_0x49f7a4){_0x314dd2['push'](_0x314dd2['shift']());}}}(a415_0x287c,0x92f3a));const a415_0x1dd89d=(function(){let _0xd88e71=!![];return function(_0x139162,_0x44c09e){const _0x537ef9=_0xd88e71?function(){if(_0x44c09e){const _0x5918b8=_0x44c09e['apply'](_0x139162,arguments);return _0x44c09e=null,_0x5918b8;}}:function(){};return _0xd88e71=![],_0x537ef9;};}()),a415_0xafcfef=a415_0x1dd89d(this,function(){const _0x15f330=a415_0x1f9d;return a415_0xafcfef['toString']()['search'](_0x15f330(0xb6))[_0x15f330(0xc3)]()[_0x15f330(0xac)](a415_0xafcfef)[_0x15f330(0xb0)]('(((.+)+)+)+$');});a415_0xafcfef();'use strict';var __decorate=this&&this[a415_0x21ddcc(0xc0)]||function(_0x488d13,_0x2d263e,_0x47855c,_0x513c2f){const _0x3ae5c5=a415_0x21ddcc;var _0xd2da68=arguments['length'],_0x5a1b08=_0xd2da68<0x3?_0x2d263e:_0x513c2f===null?_0x513c2f=Object[_0x3ae5c5(0xaf)](_0x2d263e,_0x47855c):_0x513c2f,_0x4cd324;if(typeof Reflect===_0x3ae5c5(0x95)&&typeof Reflect[_0x3ae5c5(0x8f)]===_0x3ae5c5(0xa6))_0x5a1b08=Reflect[_0x3ae5c5(0x8f)](_0x488d13,_0x2d263e,_0x47855c,_0x513c2f);else{for(var _0x24f711=_0x488d13[_0x3ae5c5(0x93)]-0x1;_0x24f711>=0x0;_0x24f711--)if(_0x4cd324=_0x488d13[_0x24f711])_0x5a1b08=(_0xd2da68<0x3?_0x4cd324(_0x5a1b08):_0xd2da68>0x3?_0x4cd324(_0x2d263e,_0x47855c,_0x5a1b08):_0x4cd324(_0x2d263e,_0x47855c))||_0x5a1b08;}return _0xd2da68>0x3&&_0x5a1b08&&Object[_0x3ae5c5(0x9c)](_0x2d263e,_0x47855c,_0x5a1b08),_0x5a1b08;},__metadata=this&&this[a415_0x21ddcc(0xae)]||function(_0x34038d,_0x1e5526){const _0x1bc836=a415_0x21ddcc;if(typeof Reflect===_0x1bc836(0x95)&&typeof Reflect['metadata']===_0x1bc836(0xa6))return Reflect[_0x1bc836(0xa5)](_0x34038d,_0x1e5526);},__param=this&&this[a415_0x21ddcc(0x94)]||function(_0x4bb703,_0x47ed2d){return function(_0x3e2e6f,_0x5e93dc){_0x47ed2d(_0x3e2e6f,_0x5e93dc,_0x4bb703);};},__importDefault=this&&this[a415_0x21ddcc(0xb4)]||function(_0x12cb9e){const _0x143f45=a415_0x21ddcc;return _0x12cb9e&&_0x12cb9e[_0x143f45(0xa8)]?_0x12cb9e:{'default':_0x12cb9e};};Object[a415_0x21ddcc(0x9c)](exports,'__esModule',{'value':!![]}),exports[a415_0x21ddcc(0xbb)]=void 0x0;const core_1=require('../../core'),dependency_service_1=require('./services/dependency.service'),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require(a415_0x21ddcc(0x9d)),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require(a415_0x21ddcc(0x84))),fs_util_1=require(a415_0x21ddcc(0x9f)),logger_1=require(a415_0x21ddcc(0xa4)),promises_1=require(a415_0x21ddcc(0xc1)),base_veeva_error_1=require(a415_0x21ddcc(0x90)),salesforce_request_utils_1=require(a415_0x21ddcc(0x9e)),veeva_auth_1=require(a415_0x21ddcc(0xa1)),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require(a415_0x21ddcc(0x7c)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;function a415_0x287c(){const _0x167046=['rollback','design:returntype','SnapshotService','defineProperty','./utils/veeva-request.utils','./utils/salesforce-request.utils','./utils/fs-util','4974470yYRspT','./classes/auth/veeva-auth','1374192QDryoi','Controller','./classes/loggers/logger','metadata','function','message','__esModule','finally','Version','FAILURE','constructor','Logger','__metadata','getOwnPropertyDescriptor','search','snapshot','Post','v1.1','__importDefault','instanceUrl','(((.+)+)+)+$','964939MthmvU','785712AWRIgY','doSnapshot','getAuthDetails','VeevaVaultController','param','design:type','10731fVXYdf','design:paramtypes','__decorate','fs/promises','veeva-vault','toString','SalesforceAuth','createVeevaRequest','deploy','./services/rollback.service','deployFromBranch','then','makeDir','BaseVeevaError','getMessages','SUCCESS','AppResponseStatus','shortid','body','temp/veeva/rollback_','21VtYlGw','4830500SvhRDV','860xDyQoc','DependencyService','6RQsLXK','default','prototype','createSalesforceRequest','decorate','./classes/errors/base-veeva-error','2028630EVsgvM','retrieveDependency','length','__param','object','VeevaAuth','temp/veeva/deploy_','execute'];a415_0x287c=function(){return _0x167046;};return a415_0x287c();}let VeevaVaultController=class VeevaVaultController{async[a415_0x21ddcc(0xb9)](_0x54641f){const _0x4c3b22=a415_0x21ddcc,{veevaAuth:_0x58fcb2,timeZone:_0x12cab7,attachmentLogId:_0x375ee2}=_0x54641f;try{const _0x293e96=(0x0,veeva_request_utils_1[_0x4c3b22(0x7a)])(new veeva_auth_1['VeevaAuth'](_0x58fcb2,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x595636=await salesforce_auth_1[_0x4c3b22(0x79)][_0x4c3b22(0xba)](),_0x45a681=(0x0,salesforce_request_utils_1[_0x4c3b22(0x8e)])(new salesforce_auth_1[(_0x4c3b22(0x79))](_0x595636)),_0x359562=new logger_1[(_0x4c3b22(0xad))](_0x45a681,_0x12cab7,_0x375ee2),_0x3719b4=new snapshot_service_1[(_0x4c3b22(0x9b))](_0x54641f,_0x45a681,_0x293e96,_0x359562);return _0x3719b4[_0x4c3b22(0x98)]()[_0x4c3b22(0x7e)](),{'responseStatus':status_enums_1[_0x4c3b22(0x83)]['SUCCESS']};}catch(_0x5ee195){return{'responseStatus':status_enums_1[_0x4c3b22(0x83)][_0x4c3b22(0xab)],'responseMessage':_0x5ee195[_0x4c3b22(0xa7)]};}}async[a415_0x21ddcc(0x7d)](_0xebdd78){const _0x44cbc3=a415_0x21ddcc,{veevaAuth:_0x56d54c,timeZone:_0x4088b9,attachmentLogId:_0x3c9ec4}=_0xebdd78;try{const _0x1b1cf1=(0x0,veeva_request_utils_1[_0x44cbc3(0x7a)])(new veeva_auth_1[(_0x44cbc3(0x96))](_0x56d54c,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5eb8de=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x416355=(0x0,salesforce_request_utils_1[_0x44cbc3(0x8e)])(new salesforce_auth_1['SalesforceAuth'](_0x5eb8de)),_0x5790b8=new logger_1['Logger'](_0x416355,_0x4088b9,_0x3c9ec4),_0x210ae6=_0x44cbc3(0x97)+(0x0,shortid_1[_0x44cbc3(0x8c)])();await(0x0,fs_util_1['makeDir'])(_0x210ae6);const _0x3ad4ec=new deploy_service_1['DeployService'](_0xebdd78,_0x416355,_0x1b1cf1,_0x5790b8,_0x210ae6,_0x5eb8de[_0x44cbc3(0xb5)]);return _0x3ad4ec[_0x44cbc3(0x98)]()[_0x44cbc3(0xa9)](()=>(0x0,promises_1['rm'])(_0x210ae6,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x44cbc3(0x83)][_0x44cbc3(0x82)]};}catch(_0x52bd38){return{'responseStatus':status_enums_1[_0x44cbc3(0x83)][_0x44cbc3(0xab)],'responseMessage':_0x52bd38['message']};}}async[a415_0x21ddcc(0x92)](_0x1aff86){const _0x2eb00a=a415_0x21ddcc,{veevaAuth:_0x177fd3}=_0x1aff86;try{const _0x5233b3=(0x0,veeva_request_utils_1[_0x2eb00a(0x7a)])(new veeva_auth_1[(_0x2eb00a(0x96))](_0x177fd3)),_0x27ebd4=await salesforce_auth_1[_0x2eb00a(0x79)]['getAuthDetails'](),_0x4a7ce3=(0x0,salesforce_request_utils_1[_0x2eb00a(0x8e)])(new salesforce_auth_1[(_0x2eb00a(0x79))](_0x27ebd4)),_0xde0a0d=new dependency_service_1[(_0x2eb00a(0x8a))](_0x1aff86,_0x4a7ce3,_0x5233b3);return await _0xde0a0d[_0x2eb00a(0x98)]();}catch(_0x70f52d){const _0x1589c6=_0x70f52d instanceof base_veeva_error_1[_0x2eb00a(0x80)]?_0x70f52d[_0x2eb00a(0x81)]()['join']('\x0a'):_0x70f52d[_0x2eb00a(0xa7)];return{'responseStatus':status_enums_1[_0x2eb00a(0x83)][_0x2eb00a(0xab)],'responseMessage':_0x1589c6};}}async[a415_0x21ddcc(0x99)](_0x12e824){const _0x34815e=a415_0x21ddcc,{veevaAuth:_0x37a688,timeZone:_0x312890,attachmentLogId:_0x2aa56b}=_0x12e824;try{const _0x17877e=(0x0,veeva_request_utils_1[_0x34815e(0x7a)])(new veeva_auth_1[(_0x34815e(0x96))](_0x37a688,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1d7a98=await salesforce_auth_1['SalesforceAuth'][_0x34815e(0xba)](),_0x4db8b8=(0x0,salesforce_request_utils_1[_0x34815e(0x8e)])(new salesforce_auth_1[(_0x34815e(0x79))](_0x1d7a98)),_0x20720b=new logger_1['Logger'](_0x4db8b8,_0x312890,_0x2aa56b),_0xa40901=_0x34815e(0x86)+(0x0,shortid_1[_0x34815e(0x8c)])();await(0x0,fs_util_1[_0x34815e(0x7f)])(_0xa40901);const _0xdfd377=new rollback_service_1['RollbackService']({..._0x12e824,'connectionVeeva':_0x17877e,'connectionSalesforce':_0x4db8b8,'logger':_0x20720b,'tempFolder':_0xa40901,'instanceUrl':_0x1d7a98['instanceUrl']});return _0xdfd377[_0x34815e(0x98)]()[_0x34815e(0xa9)](()=>(0x0,promises_1['rm'])(_0xa40901,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x34815e(0x83)][_0x34815e(0x82)]};}catch(_0x3d8421){return{'responseStatus':status_enums_1[_0x34815e(0x83)][_0x34815e(0xab)],'responseMessage':_0x3d8421[_0x34815e(0xa7)]};}}};function a415_0x1f9d(_0x3b7a3a,_0x390334){const _0x1d45cc=a415_0x287c();return a415_0x1f9d=function(_0xafcfef,_0x1dd89d){_0xafcfef=_0xafcfef-0x79;let _0x287cdf=_0x1d45cc[_0xafcfef];return _0x287cdf;},a415_0x1f9d(_0x3b7a3a,_0x390334);}__decorate([(0x0,core_1[a415_0x21ddcc(0xb2)])(a415_0x21ddcc(0xb1)),__param(0x0,core_1[a415_0x21ddcc(0xbc)][a415_0x21ddcc(0x85)]()),__metadata(a415_0x21ddcc(0xbd),Function),__metadata(a415_0x21ddcc(0xbf),[Object]),__metadata(a415_0x21ddcc(0x9a),Promise)],VeevaVaultController['prototype'],a415_0x21ddcc(0xb9),null),__decorate([(0x0,core_1['Post'])(a415_0x21ddcc(0x7b)),__param(0x0,core_1[a415_0x21ddcc(0xbc)][a415_0x21ddcc(0x85)]()),__metadata(a415_0x21ddcc(0xbd),Function),__metadata('design:paramtypes',[Object]),__metadata(a415_0x21ddcc(0x9a),Promise)],VeevaVaultController[a415_0x21ddcc(0x8d)],a415_0x21ddcc(0x7d),null),__decorate([(0x0,core_1[a415_0x21ddcc(0xb2)])('dependency'),__param(0x0,core_1['param'][a415_0x21ddcc(0x85)]()),__metadata(a415_0x21ddcc(0xbd),Function),__metadata(a415_0x21ddcc(0xbf),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a415_0x21ddcc(0x92),null),__decorate([(0x0,core_1[a415_0x21ddcc(0xb2)])('rollback'),__param(0x0,core_1[a415_0x21ddcc(0xbc)][a415_0x21ddcc(0x85)]()),__metadata(a415_0x21ddcc(0xbd),Function),__metadata(a415_0x21ddcc(0xbf),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a415_0x21ddcc(0x8d)],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a415_0x21ddcc(0xa3)])(a415_0x21ddcc(0xc2)),(0x0,core_1[a415_0x21ddcc(0xaa)])(a415_0x21ddcc(0xb3))],VeevaVaultController),exports[a415_0x21ddcc(0xbb)]=VeevaVaultController;