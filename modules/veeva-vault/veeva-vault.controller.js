const a371_0x3d8d45=a371_0x4612;function a371_0x1fe4(){const _0x476823=['./utils/salesforce-request.utils','finally','object','./services/dependency.service','param','dependency','948522OlaFIm','BaseVeevaError','./classes/auth/salesforce-auth','design:returntype','length','DependencyService','doSnapshot','body','design:paramtypes','3745445azprkm','message','__param','design:type','join','instanceUrl','./utils/veeva-request.utils','getOwnPropertyDescriptor','6645723KECgOT','retrieveDependency','search','1341860FtRIrm','deploy','Post','__decorate','./classes/loggers/logger','1933947MnEEDD','constructor','createVeevaRequest','fs/promises','default','prototype','getAuthDetails','Logger','(((.+)+)+)+$','SalesforceAuth','277933cCkrUU','apply','VeevaAuth','./services/snapshot.service','getMessages','FAILURE','execute','__esModule','decorate','AppResponseStatus','snapshot','SUCCESS','__importDefault','rollback','function','createSalesforceRequest','v1.1','11809632lFoRYb','shortid','2gGSKWJ','./services/rollback.service','makeDir','defineProperty','deployFromBranch','../../core','RollbackService','metadata'];a371_0x1fe4=function(){return _0x476823;};return a371_0x1fe4();}(function(_0x2995df,_0x45dd78){const _0x5c18fe=a371_0x4612,_0x52ebeb=_0x2995df();while(!![]){try{const _0x434354=parseInt(_0x5c18fe(0x12b))/0x1+-parseInt(_0x5c18fe(0xfa))/0x2*(-parseInt(_0x5c18fe(0x121))/0x3)+-parseInt(_0x5c18fe(0x11c))/0x4+-parseInt(_0x5c18fe(0x111))/0x5+parseInt(_0x5c18fe(0x108))/0x6+-parseInt(_0x5c18fe(0x119))/0x7+parseInt(_0x5c18fe(0xf8))/0x8;if(_0x434354===_0x45dd78)break;else _0x52ebeb['push'](_0x52ebeb['shift']());}catch(_0x576b5a){_0x52ebeb['push'](_0x52ebeb['shift']());}}}(a371_0x1fe4,0x7fab2));const a371_0x4eeae4=(function(){let _0xf564a8=!![];return function(_0x5456ee,_0x371e68){const _0x24aaa8=_0xf564a8?function(){const _0x4889fe=a371_0x4612;if(_0x371e68){const _0x1ea5eb=_0x371e68[_0x4889fe(0x12c)](_0x5456ee,arguments);return _0x371e68=null,_0x1ea5eb;}}:function(){};return _0xf564a8=![],_0x24aaa8;};}()),a371_0x10f9b9=a371_0x4eeae4(this,function(){const _0x1245a4=a371_0x4612;return a371_0x10f9b9['toString']()[_0x1245a4(0x11b)](_0x1245a4(0x129))['toString']()[_0x1245a4(0x122)](a371_0x10f9b9)['search'](_0x1245a4(0x129));});a371_0x10f9b9();'use strict';var __decorate=this&&this[a371_0x3d8d45(0x11f)]||function(_0x5219df,_0x5cfd79,_0x1842ce,_0x25e768){const _0x53afce=a371_0x3d8d45;var _0x689581=arguments['length'],_0x55f159=_0x689581<0x3?_0x5cfd79:_0x25e768===null?_0x25e768=Object[_0x53afce(0x118)](_0x5cfd79,_0x1842ce):_0x25e768,_0x811681;if(typeof Reflect===_0x53afce(0x104)&&typeof Reflect[_0x53afce(0xef)]==='function')_0x55f159=Reflect[_0x53afce(0xef)](_0x5219df,_0x5cfd79,_0x1842ce,_0x25e768);else{for(var _0x3a7c3b=_0x5219df[_0x53afce(0x10c)]-0x1;_0x3a7c3b>=0x0;_0x3a7c3b--)if(_0x811681=_0x5219df[_0x3a7c3b])_0x55f159=(_0x689581<0x3?_0x811681(_0x55f159):_0x689581>0x3?_0x811681(_0x5cfd79,_0x1842ce,_0x55f159):_0x811681(_0x5cfd79,_0x1842ce))||_0x55f159;}return _0x689581>0x3&&_0x55f159&&Object[_0x53afce(0xfd)](_0x5cfd79,_0x1842ce,_0x55f159),_0x55f159;},__metadata=this&&this['__metadata']||function(_0x4d1bb6,_0x75153a){const _0x11a7fc=a371_0x3d8d45;if(typeof Reflect===_0x11a7fc(0x104)&&typeof Reflect[_0x11a7fc(0x101)]===_0x11a7fc(0xf5))return Reflect['metadata'](_0x4d1bb6,_0x75153a);},__param=this&&this[a371_0x3d8d45(0x113)]||function(_0x298fd9,_0x4fefdb){return function(_0x4f07,_0x4f78f1){_0x4fefdb(_0x4f07,_0x4f78f1,_0x298fd9);};},__importDefault=this&&this[a371_0x3d8d45(0xf3)]||function(_0x7bd408){const _0x23ee04=a371_0x3d8d45;return _0x7bd408&&_0x7bd408[_0x23ee04(0xee)]?_0x7bd408:{'default':_0x7bd408};};Object[a371_0x3d8d45(0xfd)](exports,'__esModule',{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require(a371_0x3d8d45(0xff)),dependency_service_1=require(a371_0x3d8d45(0x105)),snapshot_service_1=require(a371_0x3d8d45(0x12e)),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require(a371_0x3d8d45(0x117)),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require(a371_0x3d8d45(0xf9))),fs_util_1=require('./utils/fs-util'),logger_1=require(a371_0x3d8d45(0x120)),promises_1=require(a371_0x3d8d45(0x124)),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require(a371_0x3d8d45(0x102)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a371_0x3d8d45(0x10a)),rollback_service_1=require(a371_0x3d8d45(0xfb)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;function a371_0x4612(_0x1febd0,_0x270a5e){const _0x2aedfb=a371_0x1fe4();return a371_0x4612=function(_0x10f9b9,_0x4eeae4){_0x10f9b9=_0x10f9b9-0xed;let _0x1fe434=_0x2aedfb[_0x10f9b9];return _0x1fe434;},a371_0x4612(_0x1febd0,_0x270a5e);}let VeevaVaultController=class VeevaVaultController{async[a371_0x3d8d45(0x10e)](_0x549ecc){const _0x3a61e0=a371_0x3d8d45,{veevaAuth:_0x244a0b,timeZone:_0x5e529f,attachmentLogId:_0xb72329}=_0x549ecc;try{const _0x3a4082=(0x0,veeva_request_utils_1[_0x3a61e0(0x123)])(new veeva_auth_1['VeevaAuth'](_0x244a0b,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x41f8e8=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x8efb6e=(0x0,salesforce_request_utils_1[_0x3a61e0(0xf6)])(new salesforce_auth_1[(_0x3a61e0(0x12a))](_0x41f8e8)),_0x5501a5=new logger_1[(_0x3a61e0(0x128))](_0x8efb6e,_0x5e529f,_0xb72329),_0x2dde87=new snapshot_service_1['SnapshotService'](_0x549ecc,_0x8efb6e,_0x3a4082,_0x5501a5);return _0x2dde87['execute']()['then'](),{'responseStatus':status_enums_1[_0x3a61e0(0xf0)][_0x3a61e0(0xf2)]};}catch(_0x54a84e){return{'responseStatus':status_enums_1[_0x3a61e0(0xf0)]['FAILURE'],'responseMessage':_0x54a84e[_0x3a61e0(0x112)]};}}async['deployFromBranch'](_0x360050){const _0x13141d=a371_0x3d8d45,{veevaAuth:_0x11cda1,timeZone:_0x39a0dd,attachmentLogId:_0x2f7224}=_0x360050;try{const _0x5f0f52=(0x0,veeva_request_utils_1[_0x13141d(0x123)])(new veeva_auth_1[(_0x13141d(0x12d))](_0x11cda1,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x264af5=await salesforce_auth_1[_0x13141d(0x12a)][_0x13141d(0x127)](),_0x41150c=(0x0,salesforce_request_utils_1[_0x13141d(0xf6)])(new salesforce_auth_1[(_0x13141d(0x12a))](_0x264af5)),_0x17226f=new logger_1[(_0x13141d(0x128))](_0x41150c,_0x39a0dd,_0x2f7224),_0x4cf077='temp/veeva/deploy_'+(0x0,shortid_1[_0x13141d(0x125)])();await(0x0,fs_util_1[_0x13141d(0xfc)])(_0x4cf077);const _0x3b730d=new deploy_service_1['DeployService'](_0x360050,_0x41150c,_0x5f0f52,_0x17226f,_0x4cf077,_0x264af5[_0x13141d(0x116)]);return _0x3b730d[_0x13141d(0xed)]()[_0x13141d(0x103)](()=>(0x0,promises_1['rm'])(_0x4cf077,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x13141d(0xf0)]['SUCCESS']};}catch(_0xe5e31c){return{'responseStatus':status_enums_1[_0x13141d(0xf0)]['FAILURE'],'responseMessage':_0xe5e31c[_0x13141d(0x112)]};}}async[a371_0x3d8d45(0x11a)](_0x4d43d6){const _0x43a803=a371_0x3d8d45,{veevaAuth:_0x7842ca}=_0x4d43d6;try{const _0x3e8d98=(0x0,veeva_request_utils_1[_0x43a803(0x123)])(new veeva_auth_1[(_0x43a803(0x12d))](_0x7842ca)),_0x3279dc=await salesforce_auth_1[_0x43a803(0x12a)][_0x43a803(0x127)](),_0x2e120b=(0x0,salesforce_request_utils_1[_0x43a803(0xf6)])(new salesforce_auth_1[(_0x43a803(0x12a))](_0x3279dc)),_0xca5479=new dependency_service_1[(_0x43a803(0x10d))](_0x4d43d6,_0x2e120b,_0x3e8d98);return await _0xca5479[_0x43a803(0xed)]();}catch(_0x4e08a8){const _0x3b7851=_0x4e08a8 instanceof base_veeva_error_1[_0x43a803(0x109)]?_0x4e08a8[_0x43a803(0x12f)]()[_0x43a803(0x115)]('\x0a'):_0x4e08a8[_0x43a803(0x112)];return{'responseStatus':status_enums_1[_0x43a803(0xf0)]['FAILURE'],'responseMessage':_0x3b7851};}}async['rollback'](_0x163aa7){const _0x55635c=a371_0x3d8d45,{veevaAuth:_0x23e284,timeZone:_0x26330a,attachmentLogId:_0x17d3bb}=_0x163aa7;try{const _0x5866fa=(0x0,veeva_request_utils_1[_0x55635c(0x123)])(new veeva_auth_1[(_0x55635c(0x12d))](_0x23e284,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x577270=await salesforce_auth_1[_0x55635c(0x12a)]['getAuthDetails'](),_0x14b1b1=(0x0,salesforce_request_utils_1[_0x55635c(0xf6)])(new salesforce_auth_1[(_0x55635c(0x12a))](_0x577270)),_0x18a9e2=new logger_1[(_0x55635c(0x128))](_0x14b1b1,_0x26330a,_0x17d3bb),_0xc47002='temp/veeva/rollback_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1['makeDir'])(_0xc47002);const _0x217e1d=new rollback_service_1[(_0x55635c(0x100))]({..._0x163aa7,'connectionVeeva':_0x5866fa,'connectionSalesforce':_0x14b1b1,'logger':_0x18a9e2,'tempFolder':_0xc47002,'instanceUrl':_0x577270['instanceUrl']});return _0x217e1d[_0x55635c(0xed)]()[_0x55635c(0x103)](()=>(0x0,promises_1['rm'])(_0xc47002,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x55635c(0xf0)]['SUCCESS']};}catch(_0xfa6d9d){return{'responseStatus':status_enums_1[_0x55635c(0xf0)][_0x55635c(0x130)],'responseMessage':_0xfa6d9d['message']};}}};__decorate([(0x0,core_1['Post'])(a371_0x3d8d45(0xf1)),__param(0x0,core_1['param'][a371_0x3d8d45(0x10f)]()),__metadata(a371_0x3d8d45(0x114),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x3d8d45(0x126)],a371_0x3d8d45(0x10e),null),__decorate([(0x0,core_1[a371_0x3d8d45(0x11e)])(a371_0x3d8d45(0x11d)),__param(0x0,core_1['param'][a371_0x3d8d45(0x10f)]()),__metadata(a371_0x3d8d45(0x114),Function),__metadata('design:paramtypes',[Object]),__metadata(a371_0x3d8d45(0x10b),Promise)],VeevaVaultController[a371_0x3d8d45(0x126)],a371_0x3d8d45(0xfe),null),__decorate([(0x0,core_1[a371_0x3d8d45(0x11e)])(a371_0x3d8d45(0x107)),__param(0x0,core_1[a371_0x3d8d45(0x106)][a371_0x3d8d45(0x10f)]()),__metadata('design:type',Function),__metadata(a371_0x3d8d45(0x110),[Object]),__metadata(a371_0x3d8d45(0x10b),Promise)],VeevaVaultController[a371_0x3d8d45(0x126)],a371_0x3d8d45(0x11a),null),__decorate([(0x0,core_1['Post'])(a371_0x3d8d45(0xf4)),__param(0x0,core_1['param'][a371_0x3d8d45(0x10f)]()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata(a371_0x3d8d45(0x10b),Promise)],VeevaVaultController[a371_0x3d8d45(0x126)],a371_0x3d8d45(0xf4),null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])('veeva-vault'),(0x0,core_1['Version'])(a371_0x3d8d45(0xf7))],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;