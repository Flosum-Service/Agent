const a387_0x1b6005=a387_0x5d6e;(function(_0x4e663b,_0x5eee57){const _0x448697=a387_0x5d6e,_0x5984c6=_0x4e663b();while(!![]){try{const _0x145594=-parseInt(_0x448697(0xdf))/0x1*(parseInt(_0x448697(0xf0))/0x2)+-parseInt(_0x448697(0xff))/0x3+parseInt(_0x448697(0x126))/0x4+parseInt(_0x448697(0xee))/0x5*(parseInt(_0x448697(0x127))/0x6)+parseInt(_0x448697(0x111))/0x7+-parseInt(_0x448697(0x105))/0x8*(parseInt(_0x448697(0xe0))/0x9)+parseInt(_0x448697(0xf7))/0xa;if(_0x145594===_0x5eee57)break;else _0x5984c6['push'](_0x5984c6['shift']());}catch(_0x2fa79c){_0x5984c6['push'](_0x5984c6['shift']());}}}(a387_0x338a,0x36b85));const a387_0x44e271=(function(){let _0x55b88b=!![];return function(_0x4fef0d,_0x1b3cbb){const _0x21d510=_0x55b88b?function(){const _0x4711e2=a387_0x5d6e;if(_0x1b3cbb){const _0x422e62=_0x1b3cbb[_0x4711e2(0x114)](_0x4fef0d,arguments);return _0x1b3cbb=null,_0x422e62;}}:function(){};return _0x55b88b=![],_0x21d510;};}()),a387_0x4d6892=a387_0x44e271(this,function(){const _0x513b2a=a387_0x5d6e;return a387_0x4d6892[_0x513b2a(0xeb)]()[_0x513b2a(0xfa)](_0x513b2a(0xe6))[_0x513b2a(0xeb)]()[_0x513b2a(0x11d)](a387_0x4d6892)[_0x513b2a(0xfa)]('(((.+)+)+)+$');});a387_0x4d6892();'use strict';var __decorate=this&&this['__decorate']||function(_0x266091,_0x4851aa,_0x23ae45,_0x2a9c4f){const _0x24c608=a387_0x5d6e;var _0x1f1f97=arguments[_0x24c608(0xf3)],_0x2a8752=_0x1f1f97<0x3?_0x4851aa:_0x2a9c4f===null?_0x2a9c4f=Object[_0x24c608(0x10b)](_0x4851aa,_0x23ae45):_0x2a9c4f,_0x301157;if(typeof Reflect===_0x24c608(0x122)&&typeof Reflect['decorate']==='function')_0x2a8752=Reflect[_0x24c608(0x118)](_0x266091,_0x4851aa,_0x23ae45,_0x2a9c4f);else{for(var _0x308e51=_0x266091[_0x24c608(0xf3)]-0x1;_0x308e51>=0x0;_0x308e51--)if(_0x301157=_0x266091[_0x308e51])_0x2a8752=(_0x1f1f97<0x3?_0x301157(_0x2a8752):_0x1f1f97>0x3?_0x301157(_0x4851aa,_0x23ae45,_0x2a8752):_0x301157(_0x4851aa,_0x23ae45))||_0x2a8752;}return _0x1f1f97>0x3&&_0x2a8752&&Object[_0x24c608(0x11f)](_0x4851aa,_0x23ae45,_0x2a8752),_0x2a8752;},__metadata=this&&this[a387_0x1b6005(0x10f)]||function(_0x46eed4,_0x15fd03){const _0x5dd6e2=a387_0x1b6005;if(typeof Reflect===_0x5dd6e2(0x122)&&typeof Reflect[_0x5dd6e2(0x11e)]===_0x5dd6e2(0xef))return Reflect[_0x5dd6e2(0x11e)](_0x46eed4,_0x15fd03);},__param=this&&this[a387_0x1b6005(0xfd)]||function(_0x12fd26,_0x491713){return function(_0x6b553f,_0x5ab5ef){_0x491713(_0x6b553f,_0x5ab5ef,_0x12fd26);};},__importDefault=this&&this[a387_0x1b6005(0x102)]||function(_0x2b638a){const _0x3c15a1=a387_0x1b6005;return _0x2b638a&&_0x2b638a[_0x3c15a1(0x100)]?_0x2b638a:{'default':_0x2b638a};};function a387_0x5d6e(_0x44a517,_0x44273d){const _0x25c5c6=a387_0x338a();return a387_0x5d6e=function(_0x4d6892,_0x44e271){_0x4d6892=_0x4d6892-0xde;let _0x338a7b=_0x25c5c6[_0x4d6892];return _0x338a7b;},a387_0x5d6e(_0x44a517,_0x44273d);}Object[a387_0x1b6005(0x11f)](exports,a387_0x1b6005(0x100),{'value':!![]}),exports[a387_0x1b6005(0xf6)]=void 0x0;const core_1=require(a387_0x1b6005(0x11c)),dependency_service_1=require(a387_0x1b6005(0x11b)),snapshot_service_1=require(a387_0x1b6005(0x129)),deploy_service_1=require(a387_0x1b6005(0xfe)),veeva_request_utils_1=require(a387_0x1b6005(0x106)),status_enums_1=require(a387_0x1b6005(0xf2)),shortid_1=__importDefault(require('shortid')),fs_util_1=require('./utils/fs-util'),logger_1=require(a387_0x1b6005(0x107)),promises_1=require(a387_0x1b6005(0xf1)),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require(a387_0x1b6005(0xe3)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require(a387_0x1b6005(0xed)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a387_0x1b6005(0xe8)](_0x5eca08){const _0x4ae355=a387_0x1b6005,{veevaAuth:_0x430afe,timeZone:_0x44f3c6,attachmentLogId:_0x2bf936}=_0x5eca08;try{const _0x5da6c7=(0x0,veeva_request_utils_1[_0x4ae355(0x10e)])(new veeva_auth_1[(_0x4ae355(0x10d))](_0x430afe,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2bc185=await salesforce_auth_1['SalesforceAuth'][_0x4ae355(0x124)](),_0x4e9da5=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x4ae355(0x112))](_0x2bc185)),_0xe721c8=new logger_1[(_0x4ae355(0x11a))](_0x4e9da5,_0x44f3c6,_0x2bf936),_0x28f580=new snapshot_service_1[(_0x4ae355(0xe4))](_0x5eca08,_0x4e9da5,_0x5da6c7,_0xe721c8);return _0x28f580['execute']()[_0x4ae355(0x120)](),{'responseStatus':status_enums_1[_0x4ae355(0xf8)][_0x4ae355(0x121)]};}catch(_0x1ee566){return{'responseStatus':status_enums_1[_0x4ae355(0xf8)]['FAILURE'],'responseMessage':_0x1ee566[_0x4ae355(0x123)]};}}async[a387_0x1b6005(0xe7)](_0x5eb806){const _0x11dd0a=a387_0x1b6005,{veevaAuth:_0x7d2ba1,timeZone:_0x1b31f9,attachmentLogId:_0x4dcf02}=_0x5eb806;try{const _0x1c3413=(0x0,veeva_request_utils_1[_0x11dd0a(0x10e)])(new veeva_auth_1[(_0x11dd0a(0x10d))](_0x7d2ba1,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xd7aa01=await salesforce_auth_1[_0x11dd0a(0x112)][_0x11dd0a(0x124)](),_0x369ede=(0x0,salesforce_request_utils_1[_0x11dd0a(0xe9)])(new salesforce_auth_1[(_0x11dd0a(0x112))](_0xd7aa01)),_0x365b04=new logger_1[(_0x11dd0a(0x11a))](_0x369ede,_0x1b31f9,_0x4dcf02),_0x201092=_0x11dd0a(0x103)+(0x0,shortid_1[_0x11dd0a(0xea)])();await(0x0,fs_util_1[_0x11dd0a(0xde)])(_0x201092);const _0x2c6363=new deploy_service_1[(_0x11dd0a(0x108))](_0x5eb806,_0x369ede,_0x1c3413,_0x365b04,_0x201092,_0xd7aa01[_0x11dd0a(0xfc)]);return _0x2c6363['execute']()[_0x11dd0a(0x117)](()=>(0x0,promises_1['rm'])(_0x201092,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x11dd0a(0xf8)][_0x11dd0a(0x121)]};}catch(_0x3babea){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x11dd0a(0x125)],'responseMessage':_0x3babea[_0x11dd0a(0x123)]};}}async[a387_0x1b6005(0x12a)](_0x1942b7){const _0x3c249b=a387_0x1b6005,{veevaAuth:_0x451ab8}=_0x1942b7;try{const _0x2fb57f=(0x0,veeva_request_utils_1[_0x3c249b(0x10e)])(new veeva_auth_1['VeevaAuth'](_0x451ab8)),_0x1977b0=await salesforce_auth_1[_0x3c249b(0x112)]['getAuthDetails'](),_0x4d6f65=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x3c249b(0x112))](_0x1977b0)),_0xbef9cf=new dependency_service_1[(_0x3c249b(0xe2))](_0x1942b7,_0x4d6f65,_0x2fb57f);return await _0xbef9cf[_0x3c249b(0x119)]();}catch(_0x3f36ae){const _0x54183a=_0x3f36ae instanceof base_veeva_error_1[_0x3c249b(0x128)]?_0x3f36ae[_0x3c249b(0xe1)]()[_0x3c249b(0xec)]('\x0a'):_0x3f36ae['message'];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x3c249b(0x125)],'responseMessage':_0x54183a};}}async['rollback'](_0x101910){const _0x3ff199=a387_0x1b6005,{veevaAuth:_0x2cf423,timeZone:_0x108185,attachmentLogId:_0x2cd50e}=_0x101910;try{const _0x13a2ed=(0x0,veeva_request_utils_1[_0x3ff199(0x10e)])(new veeva_auth_1['VeevaAuth'](_0x2cf423,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5a7844=await salesforce_auth_1[_0x3ff199(0x112)][_0x3ff199(0x124)](),_0x41b151=(0x0,salesforce_request_utils_1[_0x3ff199(0xe9)])(new salesforce_auth_1[(_0x3ff199(0x112))](_0x5a7844)),_0x375e2b=new logger_1[(_0x3ff199(0x11a))](_0x41b151,_0x108185,_0x2cd50e),_0x128c00=_0x3ff199(0x10c)+(0x0,shortid_1[_0x3ff199(0xea)])();await(0x0,fs_util_1['makeDir'])(_0x128c00);const _0x164ec2=new rollback_service_1[(_0x3ff199(0x101))]({..._0x101910,'connectionVeeva':_0x13a2ed,'connectionSalesforce':_0x41b151,'logger':_0x375e2b,'tempFolder':_0x128c00,'instanceUrl':_0x5a7844[_0x3ff199(0xfc)]});return _0x164ec2[_0x3ff199(0x119)]()['finally'](()=>(0x0,promises_1['rm'])(_0x128c00,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x3ff199(0xf8)][_0x3ff199(0x121)]};}catch(_0x5cc65f){return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x5cc65f[_0x3ff199(0x123)]};}}};function a387_0x338a(){const _0x8458cb=['__esModule','RollbackService','__importDefault','temp/veeva/deploy_','design:paramtypes','18672kpbefD','./utils/veeva-request.utils','./classes/loggers/logger','DeployService','prototype','Post','getOwnPropertyDescriptor','temp/veeva/rollback_','VeevaAuth','createVeevaRequest','__metadata','design:returntype','1491469kGHbBU','SalesforceAuth','v1.1','apply','dependency','rollback','finally','decorate','execute','Logger','./services/dependency.service','../../core','constructor','metadata','defineProperty','then','SUCCESS','object','message','getAuthDetails','FAILURE','541732pDMDgo','494742PzQUcI','BaseVeevaError','./services/snapshot.service','retrieveDependency','makeDir','132518GtOFEk','270aFsbZU','getMessages','DependencyService','./utils/salesforce-request.utils','SnapshotService','param','(((.+)+)+)+$','deployFromBranch','doSnapshot','createSalesforceRequest','default','toString','join','./services/rollback.service','20qtIgRr','function','6RoYbWj','fs/promises','./enums/status.enums','length','design:type','Version','VeevaVaultController','3648390nCnoaB','AppResponseStatus','body','search','veeva-vault','instanceUrl','__param','./services/deploy.service','1054380rpWGoj'];a387_0x338a=function(){return _0x8458cb;};return a387_0x338a();}__decorate([(0x0,core_1[a387_0x1b6005(0x10a)])('snapshot'),__param(0x0,core_1[a387_0x1b6005(0xe5)][a387_0x1b6005(0xf9)]()),__metadata(a387_0x1b6005(0xf4),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a387_0x1b6005(0xe8),null),__decorate([(0x0,core_1['Post'])('deploy'),__param(0x0,core_1[a387_0x1b6005(0xe5)][a387_0x1b6005(0xf9)]()),__metadata(a387_0x1b6005(0xf4),Function),__metadata('design:paramtypes',[Object]),__metadata(a387_0x1b6005(0x110),Promise)],VeevaVaultController[a387_0x1b6005(0x109)],a387_0x1b6005(0xe7),null),__decorate([(0x0,core_1['Post'])(a387_0x1b6005(0x115)),__param(0x0,core_1[a387_0x1b6005(0xe5)]['body']()),__metadata('design:type',Function),__metadata(a387_0x1b6005(0x104),[Object]),__metadata(a387_0x1b6005(0x110),Promise)],VeevaVaultController[a387_0x1b6005(0x109)],'retrieveDependency',null),__decorate([(0x0,core_1[a387_0x1b6005(0x10a)])(a387_0x1b6005(0x116)),__param(0x0,core_1[a387_0x1b6005(0xe5)][a387_0x1b6005(0xf9)]()),__metadata(a387_0x1b6005(0xf4),Function),__metadata(a387_0x1b6005(0x104),[Object]),__metadata(a387_0x1b6005(0x110),Promise)],VeevaVaultController[a387_0x1b6005(0x109)],a387_0x1b6005(0x116),null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])(a387_0x1b6005(0xfb)),(0x0,core_1[a387_0x1b6005(0xf5)])(a387_0x1b6005(0x113))],VeevaVaultController),exports[a387_0x1b6005(0xf6)]=VeevaVaultController;