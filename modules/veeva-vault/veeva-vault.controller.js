const a347_0x157878=a347_0xe0d0;(function(_0x28ef12,_0x3a8ed4){const _0x5e3309=a347_0xe0d0,_0x50732c=_0x28ef12();while(!![]){try{const _0x3d181f=parseInt(_0x5e3309(0x1c6))/0x1*(parseInt(_0x5e3309(0x1e7))/0x2)+parseInt(_0x5e3309(0x1e1))/0x3*(-parseInt(_0x5e3309(0x1d4))/0x4)+-parseInt(_0x5e3309(0x1c4))/0x5+parseInt(_0x5e3309(0x1da))/0x6+-parseInt(_0x5e3309(0x1f7))/0x7*(-parseInt(_0x5e3309(0x1bc))/0x8)+-parseInt(_0x5e3309(0x1dd))/0x9+-parseInt(_0x5e3309(0x1e9))/0xa;if(_0x3d181f===_0x3a8ed4)break;else _0x50732c['push'](_0x50732c['shift']());}catch(_0x2b77ed){_0x50732c['push'](_0x50732c['shift']());}}}(a347_0x4fe8,0xc1486));const a347_0x31b771=(function(){let _0x4eb795=!![];return function(_0xeb7c1c,_0x4f8cf3){const _0x4066a9=_0x4eb795?function(){if(_0x4f8cf3){const _0xe3b005=_0x4f8cf3['apply'](_0xeb7c1c,arguments);return _0x4f8cf3=null,_0xe3b005;}}:function(){};return _0x4eb795=![],_0x4066a9;};}()),a347_0x4c3138=a347_0x31b771(this,function(){const _0x194bfe=a347_0xe0d0;return a347_0x4c3138['toString']()[_0x194bfe(0x1dc)](_0x194bfe(0x1bd))['toString']()[_0x194bfe(0x1c3)](a347_0x4c3138)[_0x194bfe(0x1dc)](_0x194bfe(0x1bd));});a347_0x4c3138();function a347_0xe0d0(_0x1a0578,_0x2a8572){const _0x30bb83=a347_0x4fe8();return a347_0xe0d0=function(_0x4c3138,_0x31b771){_0x4c3138=_0x4c3138-0x1b6;let _0x4fe89c=_0x30bb83[_0x4c3138];return _0x4fe89c;},a347_0xe0d0(_0x1a0578,_0x2a8572);}'use strict';var __decorate=this&&this['__decorate']||function(_0x5c3de2,_0x243836,_0xf57cec,_0x4349a4){const _0x29d9ea=a347_0xe0d0;var _0x46799a=arguments[_0x29d9ea(0x1d7)],_0x410fc4=_0x46799a<0x3?_0x243836:_0x4349a4===null?_0x4349a4=Object[_0x29d9ea(0x1ed)](_0x243836,_0xf57cec):_0x4349a4,_0x335802;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x410fc4=Reflect['decorate'](_0x5c3de2,_0x243836,_0xf57cec,_0x4349a4);else{for(var _0x3f1737=_0x5c3de2[_0x29d9ea(0x1d7)]-0x1;_0x3f1737>=0x0;_0x3f1737--)if(_0x335802=_0x5c3de2[_0x3f1737])_0x410fc4=(_0x46799a<0x3?_0x335802(_0x410fc4):_0x46799a>0x3?_0x335802(_0x243836,_0xf57cec,_0x410fc4):_0x335802(_0x243836,_0xf57cec))||_0x410fc4;}return _0x46799a>0x3&&_0x410fc4&&Object['defineProperty'](_0x243836,_0xf57cec,_0x410fc4),_0x410fc4;},__metadata=this&&this['__metadata']||function(_0x4cad72,_0x59ef12){const _0x5e3cc7=a347_0xe0d0;if(typeof Reflect==='object'&&typeof Reflect[_0x5e3cc7(0x1e2)]===_0x5e3cc7(0x1ef))return Reflect[_0x5e3cc7(0x1e2)](_0x4cad72,_0x59ef12);},__param=this&&this[a347_0x157878(0x1f0)]||function(_0x417d36,_0x553e1b){return function(_0x525a3e,_0x575571){_0x553e1b(_0x525a3e,_0x575571,_0x417d36);};},__importDefault=this&&this[a347_0x157878(0x1d2)]||function(_0xc399c1){const _0x447fe1=a347_0x157878;return _0xc399c1&&_0xc399c1[_0x447fe1(0x1f2)]?_0xc399c1:{'default':_0xc399c1};};Object[a347_0x157878(0x1bf)](exports,'__esModule',{'value':!![]}),exports[a347_0x157878(0x1de)]=void 0x0;const core_1=require(a347_0x157878(0x1cf)),dependency_service_1=require(a347_0x157878(0x1be)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a347_0x157878(0x1d0)),veeva_request_utils_1=require(a347_0x157878(0x1b9)),status_enums_1=require(a347_0x157878(0x1ea)),shortid_1=__importDefault(require(a347_0x157878(0x1d6))),fs_util_1=require(a347_0x157878(0x1f3)),logger_1=require('./classes/loggers/logger'),promises_1=require(a347_0x157878(0x1cd)),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require(a347_0x157878(0x1ec)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a347_0x157878(0x1d5)),rollback_service_1=require(a347_0x157878(0x1c9)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a347_0x157878(0x1e3)](_0x34cde8){const _0xf9277e=a347_0x157878,{veevaAuth:_0x25d619,timeZone:_0x5055ee,attachmentLogId:_0x2a2463}=_0x34cde8;try{const _0x2d69e7=(0x0,veeva_request_utils_1[_0xf9277e(0x1c7)])(new veeva_auth_1[(_0xf9277e(0x1c1))](_0x25d619,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x11e686=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0xee0ed3=(0x0,salesforce_request_utils_1[_0xf9277e(0x1df)])(new salesforce_auth_1['SalesforceAuth'](_0x11e686)),_0x2f34f9=new logger_1[(_0xf9277e(0x1eb))](_0xee0ed3,_0x5055ee,_0x2a2463),_0x30bf5a=new snapshot_service_1[(_0xf9277e(0x1e6))](_0x34cde8,_0xee0ed3,_0x2d69e7,_0x2f34f9);return _0x30bf5a[_0xf9277e(0x1d3)]()[_0xf9277e(0x1f6)](),{'responseStatus':status_enums_1[_0xf9277e(0x1b8)][_0xf9277e(0x1fc)]};}catch(_0x164bd9){return{'responseStatus':status_enums_1[_0xf9277e(0x1b8)][_0xf9277e(0x1f4)],'responseMessage':_0x164bd9[_0xf9277e(0x1c0)]};}}async[a347_0x157878(0x1f1)](_0x403851){const _0x178776=a347_0x157878,{veevaAuth:_0x41c394,timeZone:_0x33a6ba,attachmentLogId:_0x3ba9d2}=_0x403851;try{const _0x3cdb43=(0x0,veeva_request_utils_1[_0x178776(0x1c7)])(new veeva_auth_1['VeevaAuth'](_0x41c394,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x20a643=await salesforce_auth_1[_0x178776(0x1bb)][_0x178776(0x1c2)](),_0x522fee=(0x0,salesforce_request_utils_1[_0x178776(0x1df)])(new salesforce_auth_1[(_0x178776(0x1bb))](_0x20a643)),_0x25f188=new logger_1[(_0x178776(0x1eb))](_0x522fee,_0x33a6ba,_0x3ba9d2),_0x57af75=_0x178776(0x1e4)+(0x0,shortid_1['default'])();await(0x0,fs_util_1['makeDir'])(_0x57af75);const _0x5a47c9=new deploy_service_1[(_0x178776(0x1db))](_0x403851,_0x522fee,_0x3cdb43,_0x25f188,_0x57af75,_0x20a643['instanceUrl']);return _0x5a47c9[_0x178776(0x1d3)]()[_0x178776(0x1f9)](()=>(0x0,promises_1['rm'])(_0x57af75,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x178776(0x1b8)][_0x178776(0x1fc)]};}catch(_0x56962d){return{'responseStatus':status_enums_1[_0x178776(0x1b8)][_0x178776(0x1f4)],'responseMessage':_0x56962d[_0x178776(0x1c0)]};}}async[a347_0x157878(0x1e5)](_0x115d5f){const _0x42415e=a347_0x157878,{veevaAuth:_0x7403db}=_0x115d5f;try{const _0xe3fc68=(0x0,veeva_request_utils_1[_0x42415e(0x1c7)])(new veeva_auth_1[(_0x42415e(0x1c1))](_0x7403db)),_0x21ee91=await salesforce_auth_1[_0x42415e(0x1bb)][_0x42415e(0x1c2)](),_0xa856c=(0x0,salesforce_request_utils_1[_0x42415e(0x1df)])(new salesforce_auth_1['SalesforceAuth'](_0x21ee91)),_0x58724e=new dependency_service_1['DependencyService'](_0x115d5f,_0xa856c,_0xe3fc68);return await _0x58724e['execute']();}catch(_0x396942){const _0x4cfc80=_0x396942 instanceof base_veeva_error_1['BaseVeevaError']?_0x396942['getMessages']()[_0x42415e(0x1f8)]('\x0a'):_0x396942['message'];return{'responseStatus':status_enums_1[_0x42415e(0x1b8)][_0x42415e(0x1f4)],'responseMessage':_0x4cfc80};}}async['rollback'](_0x37c6e5){const _0x29e40f=a347_0x157878,{veevaAuth:_0x4c4d30,timeZone:_0x427336,attachmentLogId:_0x54c8f3}=_0x37c6e5;try{const _0x220300=(0x0,veeva_request_utils_1[_0x29e40f(0x1c7)])(new veeva_auth_1[(_0x29e40f(0x1c1))](_0x4c4d30,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x4bfb98=await salesforce_auth_1[_0x29e40f(0x1bb)][_0x29e40f(0x1c2)](),_0x2df33f=(0x0,salesforce_request_utils_1[_0x29e40f(0x1df)])(new salesforce_auth_1[(_0x29e40f(0x1bb))](_0x4bfb98)),_0x584ee2=new logger_1[(_0x29e40f(0x1eb))](_0x2df33f,_0x427336,_0x54c8f3),_0x5a02aa=_0x29e40f(0x1fa)+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x29e40f(0x1e8)])(_0x5a02aa);const _0x4e987c=new rollback_service_1[(_0x29e40f(0x1fb))]({..._0x37c6e5,'connectionVeeva':_0x220300,'connectionSalesforce':_0x2df33f,'logger':_0x584ee2,'tempFolder':_0x5a02aa,'instanceUrl':_0x4bfb98[_0x29e40f(0x1b6)]});return _0x4e987c[_0x29e40f(0x1d3)]()[_0x29e40f(0x1f9)](()=>(0x0,promises_1['rm'])(_0x5a02aa,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x29e40f(0x1b8)][_0x29e40f(0x1fc)]};}catch(_0x475ab6){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x29e40f(0x1f4)],'responseMessage':_0x475ab6[_0x29e40f(0x1c0)]};}}};function a347_0x4fe8(){const _0x27855f=['./utils/fs-util','FAILURE','design:type','then','418558CcQyAX','join','finally','temp/veeva/rollback_','RollbackService','SUCCESS','instanceUrl','dependency','AppResponseStatus','./utils/veeva-request.utils','rollback','SalesforceAuth','184LPIDZS','(((.+)+)+)+$','./services/dependency.service','defineProperty','message','VeevaAuth','getAuthDetails','constructor','5376210BCTtax','deploy','524934qdNBHc','createVeevaRequest','veeva-vault','./services/rollback.service','snapshot','design:paramtypes','Post','fs/promises','Controller','../../core','./services/deploy.service','Version','__importDefault','execute','68OUBnyK','./classes/auth/salesforce-auth','shortid','length','body','design:returntype','2384160GaHnlL','DeployService','search','8205093zCbIDB','VeevaVaultController','createSalesforceRequest','prototype','19149ASPDoZ','metadata','doSnapshot','temp/veeva/deploy_','retrieveDependency','SnapshotService','6nKEocz','makeDir','4603080SIbYys','./enums/status.enums','Logger','./utils/salesforce-request.utils','getOwnPropertyDescriptor','param','function','__param','deployFromBranch','__esModule'];a347_0x4fe8=function(){return _0x27855f;};return a347_0x4fe8();}__decorate([(0x0,core_1[a347_0x157878(0x1cc)])(a347_0x157878(0x1ca)),__param(0x0,core_1['param'][a347_0x157878(0x1d8)]()),__metadata(a347_0x157878(0x1f5),Function),__metadata(a347_0x157878(0x1cb),[Object]),__metadata(a347_0x157878(0x1d9),Promise)],VeevaVaultController[a347_0x157878(0x1e0)],'doSnapshot',null),__decorate([(0x0,core_1[a347_0x157878(0x1cc)])(a347_0x157878(0x1c5)),__param(0x0,core_1[a347_0x157878(0x1ee)]['body']()),__metadata(a347_0x157878(0x1f5),Function),__metadata(a347_0x157878(0x1cb),[Object]),__metadata(a347_0x157878(0x1d9),Promise)],VeevaVaultController[a347_0x157878(0x1e0)],a347_0x157878(0x1f1),null),__decorate([(0x0,core_1[a347_0x157878(0x1cc)])(a347_0x157878(0x1b7)),__param(0x0,core_1[a347_0x157878(0x1ee)][a347_0x157878(0x1d8)]()),__metadata('design:type',Function),__metadata(a347_0x157878(0x1cb),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a347_0x157878(0x1e0)],a347_0x157878(0x1e5),null),__decorate([(0x0,core_1[a347_0x157878(0x1cc)])(a347_0x157878(0x1ba)),__param(0x0,core_1[a347_0x157878(0x1ee)][a347_0x157878(0x1d8)]()),__metadata(a347_0x157878(0x1f5),Function),__metadata(a347_0x157878(0x1cb),[Object]),__metadata(a347_0x157878(0x1d9),Promise)],VeevaVaultController[a347_0x157878(0x1e0)],a347_0x157878(0x1ba),null),VeevaVaultController=__decorate([(0x0,core_1[a347_0x157878(0x1ce)])(a347_0x157878(0x1c8)),(0x0,core_1[a347_0x157878(0x1d1)])('v1.1')],VeevaVaultController),exports[a347_0x157878(0x1de)]=VeevaVaultController;