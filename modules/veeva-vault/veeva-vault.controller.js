const a415_0x3faad3=a415_0x1541;(function(_0x224301,_0xa07828){const _0x1498f7=a415_0x1541,_0x577380=_0x224301();while(!![]){try{const _0x26f371=-parseInt(_0x1498f7(0x212))/0x1*(parseInt(_0x1498f7(0x214))/0x2)+parseInt(_0x1498f7(0x20f))/0x3+parseInt(_0x1498f7(0x20a))/0x4+parseInt(_0x1498f7(0x20b))/0x5*(parseInt(_0x1498f7(0x1ff))/0x6)+-parseInt(_0x1498f7(0x1f4))/0x7*(-parseInt(_0x1498f7(0x21a))/0x8)+parseInt(_0x1498f7(0x226))/0x9+-parseInt(_0x1498f7(0x1fd))/0xa;if(_0x26f371===_0xa07828)break;else _0x577380['push'](_0x577380['shift']());}catch(_0x49e37f){_0x577380['push'](_0x577380['shift']());}}}(a415_0x5f30,0x66eae));const a415_0x18f403=(function(){let _0x15f14d=!![];return function(_0x3e8d68,_0x3985c9){const _0x5a13b7=_0x15f14d?function(){if(_0x3985c9){const _0x5b4f8c=_0x3985c9['apply'](_0x3e8d68,arguments);return _0x3985c9=null,_0x5b4f8c;}}:function(){};return _0x15f14d=![],_0x5a13b7;};}()),a415_0x2bdbd5=a415_0x18f403(this,function(){const _0xbc28b8=a415_0x1541;return a415_0x2bdbd5[_0xbc28b8(0x1fe)]()[_0xbc28b8(0x1fb)](_0xbc28b8(0x228))[_0xbc28b8(0x1fe)]()[_0xbc28b8(0x20c)](a415_0x2bdbd5)[_0xbc28b8(0x1fb)]('(((.+)+)+)+$');});a415_0x2bdbd5();function a415_0x5f30(){const _0x271a1c=['SnapshotService','./classes/errors/base-veeva-error','__importDefault','metadata','param','function','deployFromBranch','length','message','./classes/loggers/logger','589797fTbitR','DeployService','(((.+)+)+)+$','createVeevaRequest','./utils/salesforce-request.utils','execute','body','VeevaVaultController','rollback','DependencyService','./services/deploy.service','FAILURE','instanceUrl','getAuthDetails','Version','RollbackService','prototype','__metadata','AppResponseStatus','getOwnPropertyDescriptor','Controller','7hRNbeb','./services/dependency.service','SalesforceAuth','v1.1','BaseVeevaError','./services/rollback.service','SUCCESS','search','join','15566310CHeizZ','toString','461436hLboeL','Post','veeva-vault','finally','shortid','design:paramtypes','retrieveDependency','./classes/auth/salesforce-auth','getMessages','__esModule','doSnapshot','2785868jzcmeF','30RMWjuf','constructor','createSalesforceRequest','./utils/veeva-request.utils','2127252tzUPAu','design:returntype','VeevaAuth','3594EzGXZf','defineProperty','38SZKNBf','./enums/status.enums','__param','makeDir','__decorate','./utils/fs-util','911576sweink','design:type'];a415_0x5f30=function(){return _0x271a1c;};return a415_0x5f30();}function a415_0x1541(_0x475606,_0x52e28c){const _0x52a000=a415_0x5f30();return a415_0x1541=function(_0x2bdbd5,_0x18f403){_0x2bdbd5=_0x2bdbd5-0x1e6;let _0x5f3071=_0x52a000[_0x2bdbd5];return _0x5f3071;},a415_0x1541(_0x475606,_0x52e28c);}'use strict';var __decorate=this&&this[a415_0x3faad3(0x218)]||function(_0x26811e,_0x51dd5b,_0x4991b1,_0x106cc5){const _0x4d3202=a415_0x3faad3;var _0x3307eb=arguments[_0x4d3202(0x223)],_0x2b6c2a=_0x3307eb<0x3?_0x51dd5b:_0x106cc5===null?_0x106cc5=Object[_0x4d3202(0x1f2)](_0x51dd5b,_0x4991b1):_0x106cc5,_0x7be6b6;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x4d3202(0x221))_0x2b6c2a=Reflect['decorate'](_0x26811e,_0x51dd5b,_0x4991b1,_0x106cc5);else{for(var _0x2a0c17=_0x26811e[_0x4d3202(0x223)]-0x1;_0x2a0c17>=0x0;_0x2a0c17--)if(_0x7be6b6=_0x26811e[_0x2a0c17])_0x2b6c2a=(_0x3307eb<0x3?_0x7be6b6(_0x2b6c2a):_0x3307eb>0x3?_0x7be6b6(_0x51dd5b,_0x4991b1,_0x2b6c2a):_0x7be6b6(_0x51dd5b,_0x4991b1))||_0x2b6c2a;}return _0x3307eb>0x3&&_0x2b6c2a&&Object[_0x4d3202(0x213)](_0x51dd5b,_0x4991b1,_0x2b6c2a),_0x2b6c2a;},__metadata=this&&this[a415_0x3faad3(0x1f0)]||function(_0xd85cd5,_0x775c9d){const _0x33caa1=a415_0x3faad3;if(typeof Reflect==='object'&&typeof Reflect[_0x33caa1(0x21f)]===_0x33caa1(0x221))return Reflect[_0x33caa1(0x21f)](_0xd85cd5,_0x775c9d);},__param=this&&this[a415_0x3faad3(0x216)]||function(_0x46432e,_0x177401){return function(_0x52185e,_0x56a2d5){_0x177401(_0x52185e,_0x56a2d5,_0x46432e);};},__importDefault=this&&this[a415_0x3faad3(0x21e)]||function(_0x1f6209){return _0x1f6209&&_0x1f6209['__esModule']?_0x1f6209:{'default':_0x1f6209};};Object[a415_0x3faad3(0x213)](exports,a415_0x3faad3(0x208),{'value':!![]}),exports[a415_0x3faad3(0x1e6)]=void 0x0;const core_1=require('../../core'),dependency_service_1=require(a415_0x3faad3(0x1f5)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a415_0x3faad3(0x1e9)),veeva_request_utils_1=require(a415_0x3faad3(0x20e)),status_enums_1=require(a415_0x3faad3(0x215)),shortid_1=__importDefault(require(a415_0x3faad3(0x203))),fs_util_1=require(a415_0x3faad3(0x219)),logger_1=require(a415_0x3faad3(0x225)),promises_1=require('fs/promises'),base_veeva_error_1=require(a415_0x3faad3(0x21d)),salesforce_request_utils_1=require(a415_0x3faad3(0x22a)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a415_0x3faad3(0x206)),rollback_service_1=require(a415_0x3faad3(0x1f9)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x390815){const _0x3166bb=a415_0x3faad3,{veevaAuth:_0x57b4aa,timeZone:_0x2db7e6,attachmentLogId:_0xd66d25}=_0x390815;try{const _0x59444b=(0x0,veeva_request_utils_1[_0x3166bb(0x229)])(new veeva_auth_1[(_0x3166bb(0x211))](_0x57b4aa,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x7739a0=await salesforce_auth_1[_0x3166bb(0x1f6)][_0x3166bb(0x1ec)](),_0x428563=(0x0,salesforce_request_utils_1[_0x3166bb(0x20d)])(new salesforce_auth_1['SalesforceAuth'](_0x7739a0)),_0x1cc50f=new logger_1['Logger'](_0x428563,_0x2db7e6,_0xd66d25),_0x42d21e=new snapshot_service_1[(_0x3166bb(0x21c))](_0x390815,_0x428563,_0x59444b,_0x1cc50f);return _0x42d21e[_0x3166bb(0x22b)]()['then'](),{'responseStatus':status_enums_1[_0x3166bb(0x1f1)][_0x3166bb(0x1fa)]};}catch(_0x309668){return{'responseStatus':status_enums_1[_0x3166bb(0x1f1)][_0x3166bb(0x1ea)],'responseMessage':_0x309668[_0x3166bb(0x224)]};}}async[a415_0x3faad3(0x222)](_0xa2d041){const _0x56f55c=a415_0x3faad3,{veevaAuth:_0x1d6ef2,timeZone:_0x48b728,attachmentLogId:_0x5aae3f}=_0xa2d041;try{const _0x489ed6=(0x0,veeva_request_utils_1[_0x56f55c(0x229)])(new veeva_auth_1[(_0x56f55c(0x211))](_0x1d6ef2,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xc5beb1=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x45cff5=(0x0,salesforce_request_utils_1[_0x56f55c(0x20d)])(new salesforce_auth_1['SalesforceAuth'](_0xc5beb1)),_0x3c7b1f=new logger_1['Logger'](_0x45cff5,_0x48b728,_0x5aae3f),_0x4a244f='temp/veeva/deploy_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x56f55c(0x217)])(_0x4a244f);const _0x41ba5a=new deploy_service_1[(_0x56f55c(0x227))](_0xa2d041,_0x45cff5,_0x489ed6,_0x3c7b1f,_0x4a244f,_0xc5beb1[_0x56f55c(0x1eb)]);return _0x41ba5a[_0x56f55c(0x22b)]()[_0x56f55c(0x202)](()=>(0x0,promises_1['rm'])(_0x4a244f,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x56f55c(0x1f1)][_0x56f55c(0x1fa)]};}catch(_0x2fe0ee){return{'responseStatus':status_enums_1[_0x56f55c(0x1f1)]['FAILURE'],'responseMessage':_0x2fe0ee['message']};}}async['retrieveDependency'](_0x9a23fb){const _0x153459=a415_0x3faad3,{veevaAuth:_0x462424}=_0x9a23fb;try{const _0x4b0001=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x153459(0x211))](_0x462424)),_0x199a31=await salesforce_auth_1[_0x153459(0x1f6)][_0x153459(0x1ec)](),_0x1cda9d=(0x0,salesforce_request_utils_1[_0x153459(0x20d)])(new salesforce_auth_1['SalesforceAuth'](_0x199a31)),_0x395a07=new dependency_service_1[(_0x153459(0x1e8))](_0x9a23fb,_0x1cda9d,_0x4b0001);return await _0x395a07['execute']();}catch(_0x1a850c){const _0x2bc7ad=_0x1a850c instanceof base_veeva_error_1[_0x153459(0x1f8)]?_0x1a850c[_0x153459(0x207)]()[_0x153459(0x1fc)]('\x0a'):_0x1a850c[_0x153459(0x224)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x153459(0x1ea)],'responseMessage':_0x2bc7ad};}}async[a415_0x3faad3(0x1e7)](_0x20e350){const _0x5f1ffc=a415_0x3faad3,{veevaAuth:_0x1b3f3b,timeZone:_0x1080b8,attachmentLogId:_0x5da379}=_0x20e350;try{const _0x7e3147=(0x0,veeva_request_utils_1[_0x5f1ffc(0x229)])(new veeva_auth_1['VeevaAuth'](_0x1b3f3b,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2d5d5a=await salesforce_auth_1[_0x5f1ffc(0x1f6)][_0x5f1ffc(0x1ec)](),_0x506b1f=(0x0,salesforce_request_utils_1[_0x5f1ffc(0x20d)])(new salesforce_auth_1[(_0x5f1ffc(0x1f6))](_0x2d5d5a)),_0x3d37ce=new logger_1['Logger'](_0x506b1f,_0x1080b8,_0x5da379),_0x306a27='temp/veeva/rollback_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x5f1ffc(0x217)])(_0x306a27);const _0x597e62=new rollback_service_1[(_0x5f1ffc(0x1ee))]({..._0x20e350,'connectionVeeva':_0x7e3147,'connectionSalesforce':_0x506b1f,'logger':_0x3d37ce,'tempFolder':_0x306a27,'instanceUrl':_0x2d5d5a[_0x5f1ffc(0x1eb)]});return _0x597e62[_0x5f1ffc(0x22b)]()['finally'](()=>(0x0,promises_1['rm'])(_0x306a27,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x5f1ffc(0x1f1)][_0x5f1ffc(0x1fa)]};}catch(_0x410c32){return{'responseStatus':status_enums_1[_0x5f1ffc(0x1f1)][_0x5f1ffc(0x1ea)],'responseMessage':_0x410c32[_0x5f1ffc(0x224)]};}}};__decorate([(0x0,core_1[a415_0x3faad3(0x200)])('snapshot'),__param(0x0,core_1[a415_0x3faad3(0x220)][a415_0x3faad3(0x22c)]()),__metadata(a415_0x3faad3(0x21b),Function),__metadata(a415_0x3faad3(0x204),[Object]),__metadata(a415_0x3faad3(0x210),Promise)],VeevaVaultController[a415_0x3faad3(0x1ef)],a415_0x3faad3(0x209),null),__decorate([(0x0,core_1['Post'])('deploy'),__param(0x0,core_1['param'][a415_0x3faad3(0x22c)]()),__metadata(a415_0x3faad3(0x21b),Function),__metadata(a415_0x3faad3(0x204),[Object]),__metadata(a415_0x3faad3(0x210),Promise)],VeevaVaultController[a415_0x3faad3(0x1ef)],a415_0x3faad3(0x222),null),__decorate([(0x0,core_1['Post'])('dependency'),__param(0x0,core_1[a415_0x3faad3(0x220)][a415_0x3faad3(0x22c)]()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata(a415_0x3faad3(0x210),Promise)],VeevaVaultController[a415_0x3faad3(0x1ef)],a415_0x3faad3(0x205),null),__decorate([(0x0,core_1[a415_0x3faad3(0x200)])('rollback'),__param(0x0,core_1['param'][a415_0x3faad3(0x22c)]()),__metadata(a415_0x3faad3(0x21b),Function),__metadata(a415_0x3faad3(0x204),[Object]),__metadata(a415_0x3faad3(0x210),Promise)],VeevaVaultController[a415_0x3faad3(0x1ef)],a415_0x3faad3(0x1e7),null),VeevaVaultController=__decorate([(0x0,core_1[a415_0x3faad3(0x1f3)])(a415_0x3faad3(0x201)),(0x0,core_1[a415_0x3faad3(0x1ed)])(a415_0x3faad3(0x1f7))],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;