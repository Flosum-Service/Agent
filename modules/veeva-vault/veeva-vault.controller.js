const a366_0x53f248=a366_0x1ee8;(function(_0x527a2b,_0x5e8820){const _0x48e3b4=a366_0x1ee8,_0x361647=_0x527a2b();while(!![]){try{const _0x33beb3=-parseInt(_0x48e3b4(0xe7))/0x1+-parseInt(_0x48e3b4(0xd4))/0x2+parseInt(_0x48e3b4(0xf5))/0x3*(parseInt(_0x48e3b4(0xe4))/0x4)+parseInt(_0x48e3b4(0xbe))/0x5*(-parseInt(_0x48e3b4(0xf3))/0x6)+-parseInt(_0x48e3b4(0xc1))/0x7+-parseInt(_0x48e3b4(0xcc))/0x8+parseInt(_0x48e3b4(0xe8))/0x9;if(_0x33beb3===_0x5e8820)break;else _0x361647['push'](_0x361647['shift']());}catch(_0x5aed90){_0x361647['push'](_0x361647['shift']());}}}(a366_0x1f8a,0x4d750));const a366_0x224dd1=(function(){let _0x3ee2eb=!![];return function(_0x1c65d3,_0x3c557a){const _0x2d9ce0=_0x3ee2eb?function(){const _0x584b37=a366_0x1ee8;if(_0x3c557a){const _0xe337b=_0x3c557a[_0x584b37(0xd0)](_0x1c65d3,arguments);return _0x3c557a=null,_0xe337b;}}:function(){};return _0x3ee2eb=![],_0x2d9ce0;};}()),a366_0x1bdee1=a366_0x224dd1(this,function(){const _0x350448=a366_0x1ee8;return a366_0x1bdee1[_0x350448(0xca)]()['search'](_0x350448(0xea))[_0x350448(0xca)]()[_0x350448(0xf4)](a366_0x1bdee1)[_0x350448(0xbb)](_0x350448(0xea));});a366_0x1bdee1();'use strict';var __decorate=this&&this['__decorate']||function(_0x35a535,_0x53c60d,_0x3e5e1c,_0xa81c64){const _0x2e638e=a366_0x1ee8;var _0x24160b=arguments[_0x2e638e(0xe6)],_0xa1d3ef=_0x24160b<0x3?_0x53c60d:_0xa81c64===null?_0xa81c64=Object['getOwnPropertyDescriptor'](_0x53c60d,_0x3e5e1c):_0xa81c64,_0x318d28;if(typeof Reflect==='object'&&typeof Reflect[_0x2e638e(0xdb)]==='function')_0xa1d3ef=Reflect['decorate'](_0x35a535,_0x53c60d,_0x3e5e1c,_0xa81c64);else{for(var _0x584645=_0x35a535[_0x2e638e(0xe6)]-0x1;_0x584645>=0x0;_0x584645--)if(_0x318d28=_0x35a535[_0x584645])_0xa1d3ef=(_0x24160b<0x3?_0x318d28(_0xa1d3ef):_0x24160b>0x3?_0x318d28(_0x53c60d,_0x3e5e1c,_0xa1d3ef):_0x318d28(_0x53c60d,_0x3e5e1c))||_0xa1d3ef;}return _0x24160b>0x3&&_0xa1d3ef&&Object[_0x2e638e(0xe3)](_0x53c60d,_0x3e5e1c,_0xa1d3ef),_0xa1d3ef;},__metadata=this&&this['__metadata']||function(_0x433991,_0x57619d){const _0x467272=a366_0x1ee8;if(typeof Reflect===_0x467272(0xd8)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x433991,_0x57619d);},__param=this&&this['__param']||function(_0x291794,_0x17b85a){return function(_0x17ff33,_0x3881dd){_0x17b85a(_0x17ff33,_0x3881dd,_0x291794);};},__importDefault=this&&this['__importDefault']||function(_0x36334b){const _0x475b99=a366_0x1ee8;return _0x36334b&&_0x36334b[_0x475b99(0xeb)]?_0x36334b:{'default':_0x36334b};};function a366_0x1ee8(_0x4e533b,_0x168558){const _0x201939=a366_0x1f8a();return a366_0x1ee8=function(_0x1bdee1,_0x224dd1){_0x1bdee1=_0x1bdee1-0xb2;let _0x1f8a13=_0x201939[_0x1bdee1];return _0x1f8a13;},a366_0x1ee8(_0x4e533b,_0x168558);}Object[a366_0x53f248(0xe3)](exports,a366_0x53f248(0xeb),{'value':!![]}),exports['VeevaVaultController']=void 0x0;function a366_0x1f8a(){const _0x436d4f=['doSnapshot','length','211454UervVf','8650782rRQCCz','body','(((.+)+)+)+$','__esModule','./utils/veeva-request.utils','retrieveDependency','DependencyService','v1.1','dependency','temp/veeva/rollback_','Post','1329618yznwyK','constructor','1373487TpWcua','Logger','veeva-vault','rollback','SUCCESS','finally','FAILURE','SalesforceAuth','./services/snapshot.service','./classes/errors/base-veeva-error','VeevaAuth','AppResponseStatus','search','DeployService','../../core','5nekncc','Controller','design:paramtypes','2712661HYmNwH','snapshot','./utils/fs-util','fs/promises','./services/deploy.service','BaseVeevaError','./classes/loggers/logger','./utils/salesforce-request.utils','createSalesforceRequest','toString','instanceUrl','2169552jaBVDS','./enums/status.enums','execute','./classes/auth/salesforce-auth','apply','deployFromBranch','prototype','temp/veeva/deploy_','19978HpjYqC','param','makeDir','design:returntype','object','default','createVeevaRequest','decorate','./services/dependency.service','message','Version','VeevaVaultController','RollbackService','design:type','getAuthDetails','defineProperty','4YoNYyl'];a366_0x1f8a=function(){return _0x436d4f;};return a366_0x1f8a();}const core_1=require(a366_0x53f248(0xbd)),dependency_service_1=require(a366_0x53f248(0xdc)),snapshot_service_1=require(a366_0x53f248(0xb7)),deploy_service_1=require(a366_0x53f248(0xc5)),veeva_request_utils_1=require(a366_0x53f248(0xec)),status_enums_1=require(a366_0x53f248(0xcd)),shortid_1=__importDefault(require('shortid')),fs_util_1=require(a366_0x53f248(0xc3)),logger_1=require(a366_0x53f248(0xc7)),promises_1=require(a366_0x53f248(0xc4)),base_veeva_error_1=require(a366_0x53f248(0xb8)),salesforce_request_utils_1=require(a366_0x53f248(0xc8)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a366_0x53f248(0xcf)),rollback_service_1=require('./services/rollback.service'),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a366_0x53f248(0xe5)](_0x5d20cd){const _0x433855=a366_0x53f248,{veevaAuth:_0x5a1d1d,timeZone:_0x559f40,attachmentLogId:_0x4a67a1}=_0x5d20cd;try{const _0xe538a8=(0x0,veeva_request_utils_1[_0x433855(0xda)])(new veeva_auth_1['VeevaAuth'](_0x5a1d1d,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1e1ed0=await salesforce_auth_1[_0x433855(0xb6)][_0x433855(0xe2)](),_0x4d4763=(0x0,salesforce_request_utils_1[_0x433855(0xc9)])(new salesforce_auth_1[(_0x433855(0xb6))](_0x1e1ed0)),_0x1a5428=new logger_1[(_0x433855(0xf6))](_0x4d4763,_0x559f40,_0x4a67a1),_0x51a3e1=new snapshot_service_1['SnapshotService'](_0x5d20cd,_0x4d4763,_0xe538a8,_0x1a5428);return _0x51a3e1['execute']()['then'](),{'responseStatus':status_enums_1[_0x433855(0xba)][_0x433855(0xb3)]};}catch(_0x14465f){return{'responseStatus':status_enums_1[_0x433855(0xba)][_0x433855(0xb5)],'responseMessage':_0x14465f[_0x433855(0xdd)]};}}async[a366_0x53f248(0xd1)](_0x30b74b){const _0x171429=a366_0x53f248,{veevaAuth:_0x14a90b,timeZone:_0x473c2a,attachmentLogId:_0x4af199}=_0x30b74b;try{const _0x552caa=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x171429(0xb9))](_0x14a90b,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2f1eb0=await salesforce_auth_1[_0x171429(0xb6)][_0x171429(0xe2)](),_0x403756=(0x0,salesforce_request_utils_1[_0x171429(0xc9)])(new salesforce_auth_1[(_0x171429(0xb6))](_0x2f1eb0)),_0x1b52fe=new logger_1[(_0x171429(0xf6))](_0x403756,_0x473c2a,_0x4af199),_0x24b48c=_0x171429(0xd3)+(0x0,shortid_1[_0x171429(0xd9)])();await(0x0,fs_util_1[_0x171429(0xd6)])(_0x24b48c);const _0xb0b852=new deploy_service_1[(_0x171429(0xbc))](_0x30b74b,_0x403756,_0x552caa,_0x1b52fe,_0x24b48c,_0x2f1eb0[_0x171429(0xcb)]);return _0xb0b852[_0x171429(0xce)]()[_0x171429(0xb4)](()=>(0x0,promises_1['rm'])(_0x24b48c,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x171429(0xba)][_0x171429(0xb3)]};}catch(_0x36cfef){return{'responseStatus':status_enums_1[_0x171429(0xba)][_0x171429(0xb5)],'responseMessage':_0x36cfef[_0x171429(0xdd)]};}}async[a366_0x53f248(0xed)](_0x827305){const _0x7a4b5c=a366_0x53f248,{veevaAuth:_0x251736}=_0x827305;try{const _0x32dea2=(0x0,veeva_request_utils_1[_0x7a4b5c(0xda)])(new veeva_auth_1[(_0x7a4b5c(0xb9))](_0x251736)),_0x5022dc=await salesforce_auth_1[_0x7a4b5c(0xb6)][_0x7a4b5c(0xe2)](),_0x2f2811=(0x0,salesforce_request_utils_1[_0x7a4b5c(0xc9)])(new salesforce_auth_1['SalesforceAuth'](_0x5022dc)),_0x1fdf53=new dependency_service_1[(_0x7a4b5c(0xee))](_0x827305,_0x2f2811,_0x32dea2);return await _0x1fdf53['execute']();}catch(_0x29ed70){const _0x45987d=_0x29ed70 instanceof base_veeva_error_1[_0x7a4b5c(0xc6)]?_0x29ed70['getMessages']()['join']('\x0a'):_0x29ed70[_0x7a4b5c(0xdd)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x7a4b5c(0xb5)],'responseMessage':_0x45987d};}}async[a366_0x53f248(0xb2)](_0x1bee31){const _0x54691f=a366_0x53f248,{veevaAuth:_0x52caa8,timeZone:_0x56a1e6,attachmentLogId:_0x263f0b}=_0x1bee31;try{const _0x1d9304=(0x0,veeva_request_utils_1[_0x54691f(0xda)])(new veeva_auth_1[(_0x54691f(0xb9))](_0x52caa8,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x8b7119=await salesforce_auth_1[_0x54691f(0xb6)][_0x54691f(0xe2)](),_0x4b030b=(0x0,salesforce_request_utils_1[_0x54691f(0xc9)])(new salesforce_auth_1[(_0x54691f(0xb6))](_0x8b7119)),_0x4490ae=new logger_1[(_0x54691f(0xf6))](_0x4b030b,_0x56a1e6,_0x263f0b),_0x418020=_0x54691f(0xf1)+(0x0,shortid_1[_0x54691f(0xd9)])();await(0x0,fs_util_1[_0x54691f(0xd6)])(_0x418020);const _0x1f98a4=new rollback_service_1[(_0x54691f(0xe0))]({..._0x1bee31,'connectionVeeva':_0x1d9304,'connectionSalesforce':_0x4b030b,'logger':_0x4490ae,'tempFolder':_0x418020,'instanceUrl':_0x8b7119[_0x54691f(0xcb)]});return _0x1f98a4['execute']()[_0x54691f(0xb4)](()=>(0x0,promises_1['rm'])(_0x418020,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x54691f(0xba)][_0x54691f(0xb3)]};}catch(_0x3098e3){return{'responseStatus':status_enums_1[_0x54691f(0xba)][_0x54691f(0xb5)],'responseMessage':_0x3098e3[_0x54691f(0xdd)]};}}};__decorate([(0x0,core_1[a366_0x53f248(0xf2)])(a366_0x53f248(0xc2)),__param(0x0,core_1[a366_0x53f248(0xd5)][a366_0x53f248(0xe9)]()),__metadata(a366_0x53f248(0xe1),Function),__metadata(a366_0x53f248(0xc0),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a366_0x53f248(0xe5),null),__decorate([(0x0,core_1[a366_0x53f248(0xf2)])('deploy'),__param(0x0,core_1[a366_0x53f248(0xd5)][a366_0x53f248(0xe9)]()),__metadata(a366_0x53f248(0xe1),Function),__metadata(a366_0x53f248(0xc0),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a366_0x53f248(0xd2)],'deployFromBranch',null),__decorate([(0x0,core_1[a366_0x53f248(0xf2)])(a366_0x53f248(0xf0)),__param(0x0,core_1[a366_0x53f248(0xd5)]['body']()),__metadata('design:type',Function),__metadata(a366_0x53f248(0xc0),[Object]),__metadata(a366_0x53f248(0xd7),Promise)],VeevaVaultController[a366_0x53f248(0xd2)],a366_0x53f248(0xed),null),__decorate([(0x0,core_1['Post'])(a366_0x53f248(0xb2)),__param(0x0,core_1['param'][a366_0x53f248(0xe9)]()),__metadata(a366_0x53f248(0xe1),Function),__metadata(a366_0x53f248(0xc0),[Object]),__metadata(a366_0x53f248(0xd7),Promise)],VeevaVaultController[a366_0x53f248(0xd2)],a366_0x53f248(0xb2),null),VeevaVaultController=__decorate([(0x0,core_1[a366_0x53f248(0xbf)])(a366_0x53f248(0xf7)),(0x0,core_1[a366_0x53f248(0xde)])(a366_0x53f248(0xef))],VeevaVaultController),exports[a366_0x53f248(0xdf)]=VeevaVaultController;