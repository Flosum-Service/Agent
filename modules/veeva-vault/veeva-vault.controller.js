const a371_0x5aefb6=a371_0x5244;(function(_0x52d733,_0x29974f){const _0x29926d=a371_0x5244,_0x50cf43=_0x52d733();while(!![]){try{const _0x4394ff=-parseInt(_0x29926d(0x95))/0x1*(-parseInt(_0x29926d(0xb8))/0x2)+parseInt(_0x29926d(0xcf))/0x3+-parseInt(_0x29926d(0xd2))/0x4*(parseInt(_0x29926d(0xcd))/0x5)+parseInt(_0x29926d(0xd7))/0x6+-parseInt(_0x29926d(0x9b))/0x7*(parseInt(_0x29926d(0xa4))/0x8)+-parseInt(_0x29926d(0xd1))/0x9+parseInt(_0x29926d(0xbf))/0xa*(parseInt(_0x29926d(0x97))/0xb);if(_0x4394ff===_0x29974f)break;else _0x50cf43['push'](_0x50cf43['shift']());}catch(_0xb7c48a){_0x50cf43['push'](_0x50cf43['shift']());}}}(a371_0x4174,0x5a13d));const a371_0x1e7cfe=(function(){let _0x14c390=!![];return function(_0xd02fe6,_0x1ab03b){const _0x444d05=_0x14c390?function(){const _0x2ad8b1=a371_0x5244;if(_0x1ab03b){const _0x3b973e=_0x1ab03b[_0x2ad8b1(0xdb)](_0xd02fe6,arguments);return _0x1ab03b=null,_0x3b973e;}}:function(){};return _0x14c390=![],_0x444d05;};}()),a371_0x3cb127=a371_0x1e7cfe(this,function(){const _0x22ed6e=a371_0x5244;return a371_0x3cb127[_0x22ed6e(0xa8)]()[_0x22ed6e(0x99)](_0x22ed6e(0xaf))[_0x22ed6e(0xa8)]()[_0x22ed6e(0xc1)](a371_0x3cb127)[_0x22ed6e(0x99)]('(((.+)+)+)+$');});function a371_0x4174(){const _0x5e9726=['./utils/veeva-request.utils','param','DependencyService','length','instanceUrl','decorate','getAuthDetails','VeevaVaultController','dependency','9465xOLngF','FAILURE','263055CdAslH','createSalesforceRequest','3109329TIHrwy','44xnMPXI','function','./classes/auth/veeva-auth','./utils/salesforce-request.utils','Post','1414014aRxwIr','design:returntype','../../core','design:type','apply','execute','SUCCESS','19OGjUWR','./services/snapshot.service','2222hSpaCf','body','search','AppResponseStatus','1819209ogPqFc','deploy','__importDefault','__esModule','DeployService','makeDir','./enums/status.enums','veeva-vault','Logger','16pZETyd','./utils/fs-util','SalesforceAuth','BaseVeevaError','toString','shortid','RollbackService','object','./services/dependency.service','./classes/auth/salesforce-auth','createVeevaRequest','(((.+)+)+)+$','prototype','retrieveDependency','Version','__metadata','default','design:paramtypes','./classes/loggers/logger','deployFromBranch','16570uNnfSh','VeevaAuth','rollback','finally','then','message','./services/rollback.service','38330wmSpjS','defineProperty','constructor','metadata','./classes/errors/base-veeva-error'];a371_0x4174=function(){return _0x5e9726;};return a371_0x4174();}function a371_0x5244(_0x3eadea,_0x125c39){const _0x1e5933=a371_0x4174();return a371_0x5244=function(_0x3cb127,_0x1e7cfe){_0x3cb127=_0x3cb127-0x93;let _0x417497=_0x1e5933[_0x3cb127];return _0x417497;},a371_0x5244(_0x3eadea,_0x125c39);}a371_0x3cb127();'use strict';var __decorate=this&&this['__decorate']||function(_0x7b4b1b,_0x51d62a,_0x304af2,_0x3cedf0){const _0x38afda=a371_0x5244;var _0x517a62=arguments[_0x38afda(0xc7)],_0x16aa2a=_0x517a62<0x3?_0x51d62a:_0x3cedf0===null?_0x3cedf0=Object['getOwnPropertyDescriptor'](_0x51d62a,_0x304af2):_0x3cedf0,_0x7d96fa;if(typeof Reflect===_0x38afda(0xab)&&typeof Reflect['decorate']==='function')_0x16aa2a=Reflect[_0x38afda(0xc9)](_0x7b4b1b,_0x51d62a,_0x304af2,_0x3cedf0);else{for(var _0x965c6=_0x7b4b1b[_0x38afda(0xc7)]-0x1;_0x965c6>=0x0;_0x965c6--)if(_0x7d96fa=_0x7b4b1b[_0x965c6])_0x16aa2a=(_0x517a62<0x3?_0x7d96fa(_0x16aa2a):_0x517a62>0x3?_0x7d96fa(_0x51d62a,_0x304af2,_0x16aa2a):_0x7d96fa(_0x51d62a,_0x304af2))||_0x16aa2a;}return _0x517a62>0x3&&_0x16aa2a&&Object[_0x38afda(0xc0)](_0x51d62a,_0x304af2,_0x16aa2a),_0x16aa2a;},__metadata=this&&this[a371_0x5aefb6(0xb3)]||function(_0x1f8b4d,_0x127213){const _0x318c19=a371_0x5aefb6;if(typeof Reflect===_0x318c19(0xab)&&typeof Reflect[_0x318c19(0xc2)]===_0x318c19(0xd3))return Reflect[_0x318c19(0xc2)](_0x1f8b4d,_0x127213);},__param=this&&this['__param']||function(_0x200dd5,_0x45e92c){return function(_0x1e485d,_0x4383f4){_0x45e92c(_0x1e485d,_0x4383f4,_0x200dd5);};},__importDefault=this&&this[a371_0x5aefb6(0x9d)]||function(_0x597415){const _0x516aca=a371_0x5aefb6;return _0x597415&&_0x597415[_0x516aca(0x9e)]?_0x597415:{'default':_0x597415};};Object[a371_0x5aefb6(0xc0)](exports,a371_0x5aefb6(0x9e),{'value':!![]}),exports[a371_0x5aefb6(0xcb)]=void 0x0;const core_1=require(a371_0x5aefb6(0xd9)),dependency_service_1=require(a371_0x5aefb6(0xac)),snapshot_service_1=require(a371_0x5aefb6(0x96)),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require(a371_0x5aefb6(0xc4)),status_enums_1=require(a371_0x5aefb6(0xa1)),shortid_1=__importDefault(require(a371_0x5aefb6(0xa9))),fs_util_1=require(a371_0x5aefb6(0xa5)),logger_1=require(a371_0x5aefb6(0xb6)),promises_1=require('fs/promises'),base_veeva_error_1=require(a371_0x5aefb6(0xc3)),salesforce_request_utils_1=require(a371_0x5aefb6(0xd5)),veeva_auth_1=require(a371_0x5aefb6(0xd4)),salesforce_auth_1=require(a371_0x5aefb6(0xad)),rollback_service_1=require(a371_0x5aefb6(0xbe)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x3bd39e){const _0x1853c4=a371_0x5aefb6,{veevaAuth:_0x2fd73e,timeZone:_0x2a48fd,attachmentLogId:_0x22b214}=_0x3bd39e;try{const _0x19ec79=(0x0,veeva_request_utils_1[_0x1853c4(0xae)])(new veeva_auth_1[(_0x1853c4(0xb9))](_0x2fd73e,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x570b2c=await salesforce_auth_1[_0x1853c4(0xa6)][_0x1853c4(0xca)](),_0x539c48=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x1853c4(0xa6))](_0x570b2c)),_0x5096d3=new logger_1[(_0x1853c4(0xa3))](_0x539c48,_0x2a48fd,_0x22b214),_0x22fc8f=new snapshot_service_1['SnapshotService'](_0x3bd39e,_0x539c48,_0x19ec79,_0x5096d3);return _0x22fc8f[_0x1853c4(0x93)]()[_0x1853c4(0xbc)](),{'responseStatus':status_enums_1[_0x1853c4(0x9a)]['SUCCESS']};}catch(_0x33e6d4){return{'responseStatus':status_enums_1[_0x1853c4(0x9a)][_0x1853c4(0xce)],'responseMessage':_0x33e6d4['message']};}}async[a371_0x5aefb6(0xb7)](_0x3d64b2){const _0x101f25=a371_0x5aefb6,{veevaAuth:_0x290c35,timeZone:_0x21f420,attachmentLogId:_0x5b4825}=_0x3d64b2;try{const _0x53012d=(0x0,veeva_request_utils_1[_0x101f25(0xae)])(new veeva_auth_1['VeevaAuth'](_0x290c35,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x283781=await salesforce_auth_1['SalesforceAuth'][_0x101f25(0xca)](),_0x290f8d=(0x0,salesforce_request_utils_1[_0x101f25(0xd0)])(new salesforce_auth_1[(_0x101f25(0xa6))](_0x283781)),_0x3bb684=new logger_1['Logger'](_0x290f8d,_0x21f420,_0x5b4825),_0x4e6679='temp/veeva/deploy_'+(0x0,shortid_1[_0x101f25(0xb4)])();await(0x0,fs_util_1['makeDir'])(_0x4e6679);const _0x5bb7f0=new deploy_service_1[(_0x101f25(0x9f))](_0x3d64b2,_0x290f8d,_0x53012d,_0x3bb684,_0x4e6679,_0x283781[_0x101f25(0xc8)]);return _0x5bb7f0['execute']()[_0x101f25(0xbb)](()=>(0x0,promises_1['rm'])(_0x4e6679,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x101f25(0x9a)][_0x101f25(0x94)]};}catch(_0x1556f2){return{'responseStatus':status_enums_1[_0x101f25(0x9a)][_0x101f25(0xce)],'responseMessage':_0x1556f2[_0x101f25(0xbd)]};}}async[a371_0x5aefb6(0xb1)](_0x268527){const _0x133481=a371_0x5aefb6,{veevaAuth:_0x5ba6ad}=_0x268527;try{const _0x5c3536=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x133481(0xb9))](_0x5ba6ad)),_0x4faab5=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x6b6d82=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x133481(0xa6))](_0x4faab5)),_0x3af52e=new dependency_service_1[(_0x133481(0xc6))](_0x268527,_0x6b6d82,_0x5c3536);return await _0x3af52e[_0x133481(0x93)]();}catch(_0x5a312e){const _0x294a76=_0x5a312e instanceof base_veeva_error_1[_0x133481(0xa7)]?_0x5a312e['getMessages']()['join']('\x0a'):_0x5a312e[_0x133481(0xbd)];return{'responseStatus':status_enums_1[_0x133481(0x9a)]['FAILURE'],'responseMessage':_0x294a76};}}async[a371_0x5aefb6(0xba)](_0x48283c){const _0x412a13=a371_0x5aefb6,{veevaAuth:_0x14b413,timeZone:_0xd8cb14,attachmentLogId:_0x389b52}=_0x48283c;try{const _0x31e67d=(0x0,veeva_request_utils_1[_0x412a13(0xae)])(new veeva_auth_1[(_0x412a13(0xb9))](_0x14b413,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1dcb5a=await salesforce_auth_1['SalesforceAuth'][_0x412a13(0xca)](),_0x484e6c=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x412a13(0xa6))](_0x1dcb5a)),_0x58aa9a=new logger_1['Logger'](_0x484e6c,_0xd8cb14,_0x389b52),_0x3db93c='temp/veeva/rollback_'+(0x0,shortid_1[_0x412a13(0xb4)])();await(0x0,fs_util_1[_0x412a13(0xa0)])(_0x3db93c);const _0x43fb19=new rollback_service_1[(_0x412a13(0xaa))]({..._0x48283c,'connectionVeeva':_0x31e67d,'connectionSalesforce':_0x484e6c,'logger':_0x58aa9a,'tempFolder':_0x3db93c,'instanceUrl':_0x1dcb5a[_0x412a13(0xc8)]});return _0x43fb19[_0x412a13(0x93)]()[_0x412a13(0xbb)](()=>(0x0,promises_1['rm'])(_0x3db93c,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x412a13(0x9a)][_0x412a13(0x94)]};}catch(_0x5d883d){return{'responseStatus':status_enums_1[_0x412a13(0x9a)][_0x412a13(0xce)],'responseMessage':_0x5d883d['message']};}}};__decorate([(0x0,core_1[a371_0x5aefb6(0xd6)])('snapshot'),__param(0x0,core_1[a371_0x5aefb6(0xc5)]['body']()),__metadata(a371_0x5aefb6(0xda),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],'doSnapshot',null),__decorate([(0x0,core_1['Post'])(a371_0x5aefb6(0x9c)),__param(0x0,core_1[a371_0x5aefb6(0xc5)]['body']()),__metadata(a371_0x5aefb6(0xda),Function),__metadata(a371_0x5aefb6(0xb5),[Object]),__metadata(a371_0x5aefb6(0xd8),Promise)],VeevaVaultController['prototype'],'deployFromBranch',null),__decorate([(0x0,core_1[a371_0x5aefb6(0xd6)])(a371_0x5aefb6(0xcc)),__param(0x0,core_1[a371_0x5aefb6(0xc5)][a371_0x5aefb6(0x98)]()),__metadata(a371_0x5aefb6(0xda),Function),__metadata('design:paramtypes',[Object]),__metadata(a371_0x5aefb6(0xd8),Promise)],VeevaVaultController[a371_0x5aefb6(0xb0)],a371_0x5aefb6(0xb1),null),__decorate([(0x0,core_1['Post'])(a371_0x5aefb6(0xba)),__param(0x0,core_1[a371_0x5aefb6(0xc5)]['body']()),__metadata('design:type',Function),__metadata(a371_0x5aefb6(0xb5),[Object]),__metadata(a371_0x5aefb6(0xd8),Promise)],VeevaVaultController['prototype'],a371_0x5aefb6(0xba),null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])(a371_0x5aefb6(0xa2)),(0x0,core_1[a371_0x5aefb6(0xb2)])('v1.1')],VeevaVaultController),exports[a371_0x5aefb6(0xcb)]=VeevaVaultController;