const a403_0x59035a=a403_0x2edb;(function(_0x58c888,_0x292519){const _0x72d64d=a403_0x2edb,_0x2642ff=_0x58c888();while(!![]){try{const _0x4e83bf=parseInt(_0x72d64d(0x1bc))/0x1+parseInt(_0x72d64d(0x1d6))/0x2+parseInt(_0x72d64d(0x1b7))/0x3+-parseInt(_0x72d64d(0x1c3))/0x4+-parseInt(_0x72d64d(0x1a4))/0x5+-parseInt(_0x72d64d(0x1a2))/0x6*(parseInt(_0x72d64d(0x1b1))/0x7)+-parseInt(_0x72d64d(0x19e))/0x8*(-parseInt(_0x72d64d(0x1a1))/0x9);if(_0x4e83bf===_0x292519)break;else _0x2642ff['push'](_0x2642ff['shift']());}catch(_0x476048){_0x2642ff['push'](_0x2642ff['shift']());}}}(a403_0x8767,0x1f418));const a403_0x54bf9e=(function(){let _0x226190=!![];return function(_0xd25cc,_0x26715d){const _0x343890=_0x226190?function(){const _0x31b701=a403_0x2edb;if(_0x26715d){const _0x4a8329=_0x26715d[_0x31b701(0x1bf)](_0xd25cc,arguments);return _0x26715d=null,_0x4a8329;}}:function(){};return _0x226190=![],_0x343890;};}()),a403_0x5c0249=a403_0x54bf9e(this,function(){const _0x1c8f5d=a403_0x2edb;return a403_0x5c0249[_0x1c8f5d(0x195)]()[_0x1c8f5d(0x196)](_0x1c8f5d(0x1dd))['toString']()[_0x1c8f5d(0x1c1)](a403_0x5c0249)['search'](_0x1c8f5d(0x1dd));});a403_0x5c0249();'use strict';var __decorate=this&&this[a403_0x59035a(0x1a0)]||function(_0x543ab4,_0x3b2dab,_0x45324d,_0x195866){const _0x12ceb4=a403_0x59035a;var _0xac464c=arguments['length'],_0x5d1a4c=_0xac464c<0x3?_0x3b2dab:_0x195866===null?_0x195866=Object[_0x12ceb4(0x1ce)](_0x3b2dab,_0x45324d):_0x195866,_0x4938eb;if(typeof Reflect===_0x12ceb4(0x192)&&typeof Reflect[_0x12ceb4(0x1a6)]===_0x12ceb4(0x1d2))_0x5d1a4c=Reflect[_0x12ceb4(0x1a6)](_0x543ab4,_0x3b2dab,_0x45324d,_0x195866);else{for(var _0x4d857a=_0x543ab4[_0x12ceb4(0x1de)]-0x1;_0x4d857a>=0x0;_0x4d857a--)if(_0x4938eb=_0x543ab4[_0x4d857a])_0x5d1a4c=(_0xac464c<0x3?_0x4938eb(_0x5d1a4c):_0xac464c>0x3?_0x4938eb(_0x3b2dab,_0x45324d,_0x5d1a4c):_0x4938eb(_0x3b2dab,_0x45324d))||_0x5d1a4c;}return _0xac464c>0x3&&_0x5d1a4c&&Object[_0x12ceb4(0x193)](_0x3b2dab,_0x45324d,_0x5d1a4c),_0x5d1a4c;},__metadata=this&&this['__metadata']||function(_0x583d4e,_0x43ceec){const _0x535025=a403_0x59035a;if(typeof Reflect===_0x535025(0x192)&&typeof Reflect[_0x535025(0x1b3)]===_0x535025(0x1d2))return Reflect['metadata'](_0x583d4e,_0x43ceec);},__param=this&&this[a403_0x59035a(0x1c0)]||function(_0x5a01ae,_0x3f83f0){return function(_0x127136,_0xa179e8){_0x3f83f0(_0x127136,_0xa179e8,_0x5a01ae);};},__importDefault=this&&this[a403_0x59035a(0x1ab)]||function(_0x38d3dc){const _0x48157d=a403_0x59035a;return _0x38d3dc&&_0x38d3dc[_0x48157d(0x1d8)]?_0x38d3dc:{'default':_0x38d3dc};};function a403_0x2edb(_0x7909d6,_0x2bd105){const _0x14fc75=a403_0x8767();return a403_0x2edb=function(_0x5c0249,_0x54bf9e){_0x5c0249=_0x5c0249-0x192;let _0x876763=_0x14fc75[_0x5c0249];return _0x876763;},a403_0x2edb(_0x7909d6,_0x2bd105);}Object['defineProperty'](exports,a403_0x59035a(0x1d8),{'value':!![]}),exports[a403_0x59035a(0x1ac)]=void 0x0;function a403_0x8767(){const _0x48e08c=['VeevaVaultController','RollbackService','message','design:returntype','createSalesforceRequest','1695729AKFIqm','execute','metadata','temp/veeva/rollback_','body','./classes/auth/salesforce-auth','697668pjVOrC','Post','shortid','temp/veeva/deploy_','prototype','126642FtOvKR','snapshot','./classes/loggers/logger','apply','__param','constructor','FAILURE','782920ZZbGyi','deploy','./classes/auth/veeva-auth','makeDir','./services/dependency.service','Version','./utils/salesforce-request.utils','rollback','design:paramtypes','SalesforceAuth','getAuthDetails','getOwnPropertyDescriptor','./services/rollback.service','SUCCESS','dependency','function','SnapshotService','design:type','./classes/errors/base-veeva-error','415352SBjrxe','fs/promises','__esModule','default','finally','retrieveDependency','./enums/status.enums','(((.+)+)+)+$','length','doSnapshot','object','defineProperty','./services/snapshot.service','toString','search','./utils/fs-util','then','AppResponseStatus','veeva-vault','deployFromBranch','Controller','Logger','152kOjFaM','DeployService','__decorate','50931nfywzc','6rrgLjd','./services/deploy.service','541970gyqWxa','instanceUrl','decorate','VeevaAuth','param','BaseVeevaError','createVeevaRequest','__importDefault'];a403_0x8767=function(){return _0x48e08c;};return a403_0x8767();}const core_1=require('../../core'),dependency_service_1=require(a403_0x59035a(0x1c7)),snapshot_service_1=require(a403_0x59035a(0x194)),deploy_service_1=require(a403_0x59035a(0x1a3)),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a403_0x59035a(0x1dc)),shortid_1=__importDefault(require(a403_0x59035a(0x1b9))),fs_util_1=require(a403_0x59035a(0x197)),logger_1=require(a403_0x59035a(0x1be)),promises_1=require(a403_0x59035a(0x1d7)),base_veeva_error_1=require(a403_0x59035a(0x1d5)),salesforce_request_utils_1=require(a403_0x59035a(0x1c9)),veeva_auth_1=require(a403_0x59035a(0x1c5)),salesforce_auth_1=require(a403_0x59035a(0x1b6)),rollback_service_1=require(a403_0x59035a(0x1cf)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x292060){const _0x5cf67a=a403_0x59035a,{veevaAuth:_0xbcf5e2,timeZone:_0xad313a,attachmentLogId:_0x3141f7}=_0x292060;try{const _0x3c4e09=(0x0,veeva_request_utils_1[_0x5cf67a(0x1aa)])(new veeva_auth_1['VeevaAuth'](_0xbcf5e2,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x306a97=await salesforce_auth_1['SalesforceAuth'][_0x5cf67a(0x1cd)](),_0x5a3506=(0x0,salesforce_request_utils_1[_0x5cf67a(0x1b0)])(new salesforce_auth_1['SalesforceAuth'](_0x306a97)),_0x273b2b=new logger_1[(_0x5cf67a(0x19d))](_0x5a3506,_0xad313a,_0x3141f7),_0x3e1e4f=new snapshot_service_1[(_0x5cf67a(0x1d3))](_0x292060,_0x5a3506,_0x3c4e09,_0x273b2b);return _0x3e1e4f['execute']()[_0x5cf67a(0x198)](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x5cf67a(0x1d0)]};}catch(_0x22cef6){return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x22cef6[_0x5cf67a(0x1ae)]};}}async[a403_0x59035a(0x19b)](_0x37c01d){const _0x478793=a403_0x59035a,{veevaAuth:_0x43e5a2,timeZone:_0x3b07f0,attachmentLogId:_0x498f38}=_0x37c01d;try{const _0x358c5e=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x478793(0x1a7))](_0x43e5a2,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x36e308=await salesforce_auth_1[_0x478793(0x1cc)][_0x478793(0x1cd)](),_0x584fb7=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x478793(0x1cc))](_0x36e308)),_0xdd2832=new logger_1['Logger'](_0x584fb7,_0x3b07f0,_0x498f38),_0x2aa8ae=_0x478793(0x1ba)+(0x0,shortid_1[_0x478793(0x1d9)])();await(0x0,fs_util_1[_0x478793(0x1c6)])(_0x2aa8ae);const _0x24f672=new deploy_service_1[(_0x478793(0x19f))](_0x37c01d,_0x584fb7,_0x358c5e,_0xdd2832,_0x2aa8ae,_0x36e308[_0x478793(0x1a5)]);return _0x24f672[_0x478793(0x1b2)]()[_0x478793(0x1da)](()=>(0x0,promises_1['rm'])(_0x2aa8ae,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x478793(0x199)][_0x478793(0x1d0)]};}catch(_0x4d7a80){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x478793(0x1c2)],'responseMessage':_0x4d7a80[_0x478793(0x1ae)]};}}async['retrieveDependency'](_0x3884d1){const _0x25305a=a403_0x59035a,{veevaAuth:_0x5931e7}=_0x3884d1;try{const _0x4c352b=(0x0,veeva_request_utils_1[_0x25305a(0x1aa)])(new veeva_auth_1[(_0x25305a(0x1a7))](_0x5931e7)),_0x47e654=await salesforce_auth_1[_0x25305a(0x1cc)][_0x25305a(0x1cd)](),_0x43fff8=(0x0,salesforce_request_utils_1[_0x25305a(0x1b0)])(new salesforce_auth_1[(_0x25305a(0x1cc))](_0x47e654)),_0x41b84b=new dependency_service_1['DependencyService'](_0x3884d1,_0x43fff8,_0x4c352b);return await _0x41b84b[_0x25305a(0x1b2)]();}catch(_0x1afcb6){const _0x13f97b=_0x1afcb6 instanceof base_veeva_error_1[_0x25305a(0x1a9)]?_0x1afcb6['getMessages']()['join']('\x0a'):_0x1afcb6[_0x25305a(0x1ae)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x25305a(0x1c2)],'responseMessage':_0x13f97b};}}async[a403_0x59035a(0x1ca)](_0x44f09b){const _0x10b372=a403_0x59035a,{veevaAuth:_0x5707a8,timeZone:_0x2628de,attachmentLogId:_0x241ad1}=_0x44f09b;try{const _0x504745=(0x0,veeva_request_utils_1[_0x10b372(0x1aa)])(new veeva_auth_1['VeevaAuth'](_0x5707a8,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x326552=await salesforce_auth_1[_0x10b372(0x1cc)]['getAuthDetails'](),_0x3efea4=(0x0,salesforce_request_utils_1[_0x10b372(0x1b0)])(new salesforce_auth_1[(_0x10b372(0x1cc))](_0x326552)),_0x2a0a44=new logger_1['Logger'](_0x3efea4,_0x2628de,_0x241ad1),_0x13988c=_0x10b372(0x1b4)+(0x0,shortid_1[_0x10b372(0x1d9)])();await(0x0,fs_util_1['makeDir'])(_0x13988c);const _0x29be77=new rollback_service_1[(_0x10b372(0x1ad))]({..._0x44f09b,'connectionVeeva':_0x504745,'connectionSalesforce':_0x3efea4,'logger':_0x2a0a44,'tempFolder':_0x13988c,'instanceUrl':_0x326552['instanceUrl']});return _0x29be77[_0x10b372(0x1b2)]()[_0x10b372(0x1da)](()=>(0x0,promises_1['rm'])(_0x13988c,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x10b372(0x199)][_0x10b372(0x1d0)]};}catch(_0x4798fb){return{'responseStatus':status_enums_1[_0x10b372(0x199)][_0x10b372(0x1c2)],'responseMessage':_0x4798fb[_0x10b372(0x1ae)]};}}};__decorate([(0x0,core_1[a403_0x59035a(0x1b8)])(a403_0x59035a(0x1bd)),__param(0x0,core_1[a403_0x59035a(0x1a8)][a403_0x59035a(0x1b5)]()),__metadata(a403_0x59035a(0x1d4),Function),__metadata(a403_0x59035a(0x1cb),[Object]),__metadata(a403_0x59035a(0x1af),Promise)],VeevaVaultController['prototype'],a403_0x59035a(0x1df),null),__decorate([(0x0,core_1['Post'])(a403_0x59035a(0x1c4)),__param(0x0,core_1[a403_0x59035a(0x1a8)][a403_0x59035a(0x1b5)]()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata(a403_0x59035a(0x1af),Promise)],VeevaVaultController[a403_0x59035a(0x1bb)],a403_0x59035a(0x19b),null),__decorate([(0x0,core_1[a403_0x59035a(0x1b8)])(a403_0x59035a(0x1d1)),__param(0x0,core_1[a403_0x59035a(0x1a8)]['body']()),__metadata(a403_0x59035a(0x1d4),Function),__metadata(a403_0x59035a(0x1cb),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a403_0x59035a(0x1db),null),__decorate([(0x0,core_1['Post'])(a403_0x59035a(0x1ca)),__param(0x0,core_1[a403_0x59035a(0x1a8)][a403_0x59035a(0x1b5)]()),__metadata(a403_0x59035a(0x1d4),Function),__metadata(a403_0x59035a(0x1cb),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a403_0x59035a(0x1bb)],a403_0x59035a(0x1ca),null),VeevaVaultController=__decorate([(0x0,core_1[a403_0x59035a(0x19c)])(a403_0x59035a(0x19a)),(0x0,core_1[a403_0x59035a(0x1c8)])('v1.1')],VeevaVaultController),exports[a403_0x59035a(0x1ac)]=VeevaVaultController;