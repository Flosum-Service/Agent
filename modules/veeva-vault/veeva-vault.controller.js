const a371_0x3a1ab5=a371_0x3651;(function(_0x5a8b84,_0x2f3d8d){const _0x2cfb4f=a371_0x3651,_0x5df75c=_0x5a8b84();while(!![]){try{const _0x3f840a=-parseInt(_0x2cfb4f(0x1ab))/0x1*(parseInt(_0x2cfb4f(0x1b0))/0x2)+parseInt(_0x2cfb4f(0x190))/0x3+-parseInt(_0x2cfb4f(0x17d))/0x4+parseInt(_0x2cfb4f(0x198))/0x5*(parseInt(_0x2cfb4f(0x1b6))/0x6)+parseInt(_0x2cfb4f(0x179))/0x7*(-parseInt(_0x2cfb4f(0x170))/0x8)+parseInt(_0x2cfb4f(0x1a7))/0x9*(parseInt(_0x2cfb4f(0x1b1))/0xa)+parseInt(_0x2cfb4f(0x1a3))/0xb;if(_0x3f840a===_0x2f3d8d)break;else _0x5df75c['push'](_0x5df75c['shift']());}catch(_0x2267d4){_0x5df75c['push'](_0x5df75c['shift']());}}}(a371_0x2530,0xc80d6));const a371_0x1b777c=(function(){let _0x1d5daa=!![];return function(_0x348820,_0x27e1fd){const _0x386158=_0x1d5daa?function(){const _0x191385=a371_0x3651;if(_0x27e1fd){const _0x26ef98=_0x27e1fd[_0x191385(0x191)](_0x348820,arguments);return _0x27e1fd=null,_0x26ef98;}}:function(){};return _0x1d5daa=![],_0x386158;};}()),a371_0x4c0c9f=a371_0x1b777c(this,function(){const _0x2b0c89=a371_0x3651;return a371_0x4c0c9f[_0x2b0c89(0x18f)]()[_0x2b0c89(0x18e)](_0x2b0c89(0x19c))['toString']()['constructor'](a371_0x4c0c9f)[_0x2b0c89(0x18e)]('(((.+)+)+)+$');});a371_0x4c0c9f();'use strict';var __decorate=this&&this[a371_0x3a1ab5(0x197)]||function(_0x4f132f,_0x58dea1,_0x463082,_0x436c3d){const _0x4a65da=a371_0x3a1ab5;var _0x1a017c=arguments[_0x4a65da(0x193)],_0x3c7a45=_0x1a017c<0x3?_0x58dea1:_0x436c3d===null?_0x436c3d=Object[_0x4a65da(0x16d)](_0x58dea1,_0x463082):_0x436c3d,_0x292a8a;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x4a65da(0x17e))_0x3c7a45=Reflect[_0x4a65da(0x173)](_0x4f132f,_0x58dea1,_0x463082,_0x436c3d);else{for(var _0x35b020=_0x4f132f[_0x4a65da(0x193)]-0x1;_0x35b020>=0x0;_0x35b020--)if(_0x292a8a=_0x4f132f[_0x35b020])_0x3c7a45=(_0x1a017c<0x3?_0x292a8a(_0x3c7a45):_0x1a017c>0x3?_0x292a8a(_0x58dea1,_0x463082,_0x3c7a45):_0x292a8a(_0x58dea1,_0x463082))||_0x3c7a45;}return _0x1a017c>0x3&&_0x3c7a45&&Object[_0x4a65da(0x199)](_0x58dea1,_0x463082,_0x3c7a45),_0x3c7a45;},__metadata=this&&this[a371_0x3a1ab5(0x18a)]||function(_0x3f92c2,_0x301bb4){const _0xf85e0e=a371_0x3a1ab5;if(typeof Reflect==='object'&&typeof Reflect[_0xf85e0e(0x189)]===_0xf85e0e(0x17e))return Reflect['metadata'](_0x3f92c2,_0x301bb4);},__param=this&&this['__param']||function(_0x35db54,_0x1edb23){return function(_0x562186,_0x58d801){_0x1edb23(_0x562186,_0x58d801,_0x35db54);};},__importDefault=this&&this[a371_0x3a1ab5(0x17c)]||function(_0x93afe4){return _0x93afe4&&_0x93afe4['__esModule']?_0x93afe4:{'default':_0x93afe4};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a371_0x3a1ab5(0x187)]=void 0x0;function a371_0x3651(_0x2f409a,_0x1eae37){const _0x1a66c4=a371_0x2530();return a371_0x3651=function(_0x4c0c9f,_0x1b777c){_0x4c0c9f=_0x4c0c9f-0x16d;let _0x253066=_0x1a66c4[_0x4c0c9f];return _0x253066;},a371_0x3651(_0x2f409a,_0x1eae37);}const core_1=require(a371_0x3a1ab5(0x16f)),dependency_service_1=require(a371_0x3a1ab5(0x1a2)),snapshot_service_1=require(a371_0x3a1ab5(0x194)),deploy_service_1=require(a371_0x3a1ab5(0x188)),veeva_request_utils_1=require(a371_0x3a1ab5(0x183)),status_enums_1=require(a371_0x3a1ab5(0x19b)),shortid_1=__importDefault(require(a371_0x3a1ab5(0x195))),fs_util_1=require(a371_0x3a1ab5(0x18d)),logger_1=require(a371_0x3a1ab5(0x176)),promises_1=require(a371_0x3a1ab5(0x177)),base_veeva_error_1=require(a371_0x3a1ab5(0x1a6)),salesforce_request_utils_1=require(a371_0x3a1ab5(0x196)),veeva_auth_1=require(a371_0x3a1ab5(0x17b)),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require(a371_0x3a1ab5(0x16e)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a371_0x3a1ab5(0x1ad)](_0x555cf1){const _0x49db44=a371_0x3a1ab5,{veevaAuth:_0x2d5242,timeZone:_0x4d2cf1,attachmentLogId:_0x4d0e9f}=_0x555cf1;try{const _0x14c510=(0x0,veeva_request_utils_1[_0x49db44(0x1b7)])(new veeva_auth_1[(_0x49db44(0x17f))](_0x2d5242,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x525cc5=await salesforce_auth_1['SalesforceAuth'][_0x49db44(0x192)](),_0x88745d=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x49db44(0x181))](_0x525cc5)),_0x2e840f=new logger_1[(_0x49db44(0x19e))](_0x88745d,_0x4d2cf1,_0x4d0e9f),_0x272422=new snapshot_service_1[(_0x49db44(0x180))](_0x555cf1,_0x88745d,_0x14c510,_0x2e840f);return _0x272422[_0x49db44(0x186)]()[_0x49db44(0x19f)](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x49db44(0x18c)]};}catch(_0x297315){return{'responseStatus':status_enums_1[_0x49db44(0x185)]['FAILURE'],'responseMessage':_0x297315[_0x49db44(0x1a4)]};}}async['deployFromBranch'](_0x192ff7){const _0x30cba3=a371_0x3a1ab5,{veevaAuth:_0x421497,timeZone:_0x565b3c,attachmentLogId:_0x193bfb}=_0x192ff7;try{const _0x579512=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1['VeevaAuth'](_0x421497,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2f0ea8=await salesforce_auth_1[_0x30cba3(0x181)][_0x30cba3(0x192)](),_0x51647c=(0x0,salesforce_request_utils_1[_0x30cba3(0x1ac)])(new salesforce_auth_1[(_0x30cba3(0x181))](_0x2f0ea8)),_0xa1b548=new logger_1[(_0x30cba3(0x19e))](_0x51647c,_0x565b3c,_0x193bfb),_0x18d329='temp/veeva/deploy_'+(0x0,shortid_1[_0x30cba3(0x1b2)])();await(0x0,fs_util_1[_0x30cba3(0x178)])(_0x18d329);const _0x421315=new deploy_service_1['DeployService'](_0x192ff7,_0x51647c,_0x579512,_0xa1b548,_0x18d329,_0x2f0ea8[_0x30cba3(0x171)]);return _0x421315[_0x30cba3(0x186)]()[_0x30cba3(0x18b)](()=>(0x0,promises_1['rm'])(_0x18d329,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x30cba3(0x18c)]};}catch(_0xbf384d){return{'responseStatus':status_enums_1[_0x30cba3(0x185)][_0x30cba3(0x182)],'responseMessage':_0xbf384d[_0x30cba3(0x1a4)]};}}async[a371_0x3a1ab5(0x184)](_0x3aac97){const _0x23aaa4=a371_0x3a1ab5,{veevaAuth:_0x122ff4}=_0x3aac97;try{const _0x1bfc90=(0x0,veeva_request_utils_1[_0x23aaa4(0x1b7)])(new veeva_auth_1[(_0x23aaa4(0x17f))](_0x122ff4)),_0x4ceb77=await salesforce_auth_1['SalesforceAuth'][_0x23aaa4(0x192)](),_0xfc7106=(0x0,salesforce_request_utils_1[_0x23aaa4(0x1ac)])(new salesforce_auth_1[(_0x23aaa4(0x181))](_0x4ceb77)),_0x3edc4b=new dependency_service_1[(_0x23aaa4(0x1ae))](_0x3aac97,_0xfc7106,_0x1bfc90);return await _0x3edc4b[_0x23aaa4(0x186)]();}catch(_0x5e8949){const _0x52ca6b=_0x5e8949 instanceof base_veeva_error_1[_0x23aaa4(0x1aa)]?_0x5e8949['getMessages']()['join']('\x0a'):_0x5e8949[_0x23aaa4(0x1a4)];return{'responseStatus':status_enums_1[_0x23aaa4(0x185)]['FAILURE'],'responseMessage':_0x52ca6b};}}async[a371_0x3a1ab5(0x19a)](_0x378cdc){const _0xf374=a371_0x3a1ab5,{veevaAuth:_0x20dc6b,timeZone:_0x2c5063,attachmentLogId:_0x4c8d22}=_0x378cdc;try{const _0x508011=(0x0,veeva_request_utils_1[_0xf374(0x1b7)])(new veeva_auth_1[(_0xf374(0x17f))](_0x20dc6b,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x22ec8c=await salesforce_auth_1[_0xf374(0x181)][_0xf374(0x192)](),_0x1bc267=(0x0,salesforce_request_utils_1[_0xf374(0x1ac)])(new salesforce_auth_1[(_0xf374(0x181))](_0x22ec8c)),_0x2d8f57=new logger_1[(_0xf374(0x19e))](_0x1bc267,_0x2c5063,_0x4c8d22),_0x19a895='temp/veeva/rollback_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0xf374(0x178)])(_0x19a895);const _0x41c606=new rollback_service_1['RollbackService']({..._0x378cdc,'connectionVeeva':_0x508011,'connectionSalesforce':_0x1bc267,'logger':_0x2d8f57,'tempFolder':_0x19a895,'instanceUrl':_0x22ec8c[_0xf374(0x171)]});return _0x41c606[_0xf374(0x186)]()[_0xf374(0x18b)](()=>(0x0,promises_1['rm'])(_0x19a895,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0xf374(0x185)][_0xf374(0x18c)]};}catch(_0x1b7fcd){return{'responseStatus':status_enums_1[_0xf374(0x185)][_0xf374(0x182)],'responseMessage':_0x1b7fcd[_0xf374(0x1a4)]};}}};function a371_0x2530(){const _0x353be7=['getAuthDetails','length','./services/snapshot.service','shortid','./utils/salesforce-request.utils','__decorate','5187235jbbQoC','defineProperty','rollback','./enums/status.enums','(((.+)+)+)+$','design:returntype','Logger','then','design:type','deploy','./services/dependency.service','8219013uQPEmE','message','Controller','./classes/errors/base-veeva-error','4545VUauZd','v1.1','param','BaseVeevaError','5dVbCUw','createSalesforceRequest','doSnapshot','DependencyService','prototype','303434DGLCDJ','1090TqxjEu','default','Version','body','design:paramtypes','6hBhKbX','createVeevaRequest','getOwnPropertyDescriptor','./services/rollback.service','../../core','11832uAEVgQ','instanceUrl','Post','decorate','snapshot','dependency','./classes/loggers/logger','fs/promises','makeDir','469hlSbSJ','veeva-vault','./classes/auth/veeva-auth','__importDefault','1022444uXKPVG','function','VeevaAuth','SnapshotService','SalesforceAuth','FAILURE','./utils/veeva-request.utils','retrieveDependency','AppResponseStatus','execute','VeevaVaultController','./services/deploy.service','metadata','__metadata','finally','SUCCESS','./utils/fs-util','search','toString','279084rUtDMI','apply'];a371_0x2530=function(){return _0x353be7;};return a371_0x2530();}__decorate([(0x0,core_1['Post'])(a371_0x3a1ab5(0x174)),__param(0x0,core_1[a371_0x3a1ab5(0x1a9)][a371_0x3a1ab5(0x1b4)]()),__metadata('design:type',Function),__metadata(a371_0x3a1ab5(0x1b5),[Object]),__metadata(a371_0x3a1ab5(0x19d),Promise)],VeevaVaultController[a371_0x3a1ab5(0x1af)],a371_0x3a1ab5(0x1ad),null),__decorate([(0x0,core_1['Post'])(a371_0x3a1ab5(0x1a1)),__param(0x0,core_1['param'][a371_0x3a1ab5(0x1b4)]()),__metadata('design:type',Function),__metadata(a371_0x3a1ab5(0x1b5),[Object]),__metadata(a371_0x3a1ab5(0x19d),Promise)],VeevaVaultController[a371_0x3a1ab5(0x1af)],'deployFromBranch',null),__decorate([(0x0,core_1['Post'])(a371_0x3a1ab5(0x175)),__param(0x0,core_1['param']['body']()),__metadata(a371_0x3a1ab5(0x1a0),Function),__metadata(a371_0x3a1ab5(0x1b5),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],'retrieveDependency',null),__decorate([(0x0,core_1[a371_0x3a1ab5(0x172)])(a371_0x3a1ab5(0x19a)),__param(0x0,core_1['param']['body']()),__metadata(a371_0x3a1ab5(0x1a0),Function),__metadata(a371_0x3a1ab5(0x1b5),[Object]),__metadata(a371_0x3a1ab5(0x19d),Promise)],VeevaVaultController[a371_0x3a1ab5(0x1af)],a371_0x3a1ab5(0x19a),null),VeevaVaultController=__decorate([(0x0,core_1[a371_0x3a1ab5(0x1a5)])(a371_0x3a1ab5(0x17a)),(0x0,core_1[a371_0x3a1ab5(0x1b3)])(a371_0x3a1ab5(0x1a8))],VeevaVaultController),exports[a371_0x3a1ab5(0x187)]=VeevaVaultController;