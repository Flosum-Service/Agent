const a371_0x12b219=a371_0x5a74;(function(_0x4f32c6,_0x4c26f9){const _0x4b7b69=a371_0x5a74,_0x542324=_0x4f32c6();while(!![]){try{const _0x3b7dec=parseInt(_0x4b7b69(0x17b))/0x1+parseInt(_0x4b7b69(0x17e))/0x2+parseInt(_0x4b7b69(0x18f))/0x3+parseInt(_0x4b7b69(0x166))/0x4*(parseInt(_0x4b7b69(0x197))/0x5)+parseInt(_0x4b7b69(0x1ab))/0x6+-parseInt(_0x4b7b69(0x194))/0x7+-parseInt(_0x4b7b69(0x199))/0x8*(parseInt(_0x4b7b69(0x176))/0x9);if(_0x3b7dec===_0x4c26f9)break;else _0x542324['push'](_0x542324['shift']());}catch(_0x29a4ca){_0x542324['push'](_0x542324['shift']());}}}(a371_0x36b9,0x92b6e));function a371_0x36b9(){const _0x1365e9=['./services/dependency.service','Version','constructor','VeevaAuth','./utils/fs-util','6491598GAOEMr','shortid','design:paramtypes','BaseVeevaError','temp/veeva/deploy_','./classes/errors/base-veeva-error','10092VjQlJh','getOwnPropertyDescriptor','message','AppResponseStatus','SUCCESS','SnapshotService','deployFromBranch','finally','Controller','Logger','retrieveDependency','makeDir','design:returntype','decorate','FAILURE','__metadata','99rUdRGt','getMessages','__param','instanceUrl','../../core','1021824YQgjxj','execute','Post','1293528rUAKaZ','./classes/auth/veeva-auth','rollback','toString','deploy','snapshot','DependencyService','function','./services/rollback.service','param','DeployService','veeva-vault','createSalesforceRequest','then','dependency','fs/promises','v1.1','1619280QORkSx','createVeevaRequest','object','apply','length','2192316RcLGpU','(((.+)+)+)+$','SalesforceAuth','760NNzQiq','prototype','2007016oMfgZP','getAuthDetails','doSnapshot','VeevaVaultController','body','./utils/veeva-request.utils','./services/deploy.service','design:type','default','join','search','RollbackService','./classes/auth/salesforce-auth'];a371_0x36b9=function(){return _0x1365e9;};return a371_0x36b9();}const a371_0x29b66d=(function(){let _0x2a84ca=!![];return function(_0x4ff6e2,_0x4a57fd){const _0x5af4c3=_0x2a84ca?function(){const _0x3f009b=a371_0x5a74;if(_0x4a57fd){const _0x585eb5=_0x4a57fd[_0x3f009b(0x192)](_0x4ff6e2,arguments);return _0x4a57fd=null,_0x585eb5;}}:function(){};return _0x2a84ca=![],_0x5af4c3;};}()),a371_0x512d70=a371_0x29b66d(this,function(){const _0x4688ad=a371_0x5a74;return a371_0x512d70[_0x4688ad(0x181)]()[_0x4688ad(0x1a3)]('(((.+)+)+)+$')[_0x4688ad(0x181)]()[_0x4688ad(0x1a8)](a371_0x512d70)[_0x4688ad(0x1a3)](_0x4688ad(0x195));});a371_0x512d70();'use strict';function a371_0x5a74(_0x3fd6e9,_0x3e6c77){const _0x58491e=a371_0x36b9();return a371_0x5a74=function(_0x512d70,_0x29b66d){_0x512d70=_0x512d70-0x164;let _0x36b982=_0x58491e[_0x512d70];return _0x36b982;},a371_0x5a74(_0x3fd6e9,_0x3e6c77);}var __decorate=this&&this['__decorate']||function(_0x464b3f,_0x47e067,_0x8168bc,_0x34b2bb){const _0x5d4d0e=a371_0x5a74;var _0x51df97=arguments[_0x5d4d0e(0x193)],_0x520124=_0x51df97<0x3?_0x47e067:_0x34b2bb===null?_0x34b2bb=Object[_0x5d4d0e(0x167)](_0x47e067,_0x8168bc):_0x34b2bb,_0x1f4790;if(typeof Reflect===_0x5d4d0e(0x191)&&typeof Reflect['decorate']==='function')_0x520124=Reflect[_0x5d4d0e(0x173)](_0x464b3f,_0x47e067,_0x8168bc,_0x34b2bb);else{for(var _0x44e431=_0x464b3f['length']-0x1;_0x44e431>=0x0;_0x44e431--)if(_0x1f4790=_0x464b3f[_0x44e431])_0x520124=(_0x51df97<0x3?_0x1f4790(_0x520124):_0x51df97>0x3?_0x1f4790(_0x47e067,_0x8168bc,_0x520124):_0x1f4790(_0x47e067,_0x8168bc))||_0x520124;}return _0x51df97>0x3&&_0x520124&&Object['defineProperty'](_0x47e067,_0x8168bc,_0x520124),_0x520124;},__metadata=this&&this[a371_0x12b219(0x175)]||function(_0x750b36,_0x5897a3){const _0x5c54ab=a371_0x12b219;if(typeof Reflect===_0x5c54ab(0x191)&&typeof Reflect['metadata']===_0x5c54ab(0x185))return Reflect['metadata'](_0x750b36,_0x5897a3);},__param=this&&this[a371_0x12b219(0x178)]||function(_0x17e490,_0x157e49){return function(_0x1ea9ac,_0x2291b2){_0x157e49(_0x1ea9ac,_0x2291b2,_0x17e490);};},__importDefault=this&&this['__importDefault']||function(_0x436062){return _0x436062&&_0x436062['__esModule']?_0x436062:{'default':_0x436062};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a371_0x12b219(0x19c)]=void 0x0;const core_1=require(a371_0x12b219(0x17a)),dependency_service_1=require(a371_0x12b219(0x1a6)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a371_0x12b219(0x19f)),veeva_request_utils_1=require(a371_0x12b219(0x19e)),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require(a371_0x12b219(0x1ac))),fs_util_1=require(a371_0x12b219(0x1aa)),logger_1=require('./classes/loggers/logger'),promises_1=require(a371_0x12b219(0x18d)),base_veeva_error_1=require(a371_0x12b219(0x165)),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require(a371_0x12b219(0x17f)),salesforce_auth_1=require(a371_0x12b219(0x1a5)),rollback_service_1=require(a371_0x12b219(0x186)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a371_0x12b219(0x19b)](_0x1a7c0d){const _0x1774c1=a371_0x12b219,{veevaAuth:_0x5f3973,timeZone:_0x24c2bf,attachmentLogId:_0x594a62}=_0x1a7c0d;try{const _0x393429=(0x0,veeva_request_utils_1[_0x1774c1(0x190)])(new veeva_auth_1[(_0x1774c1(0x1a9))](_0x5f3973,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x3bad9b=await salesforce_auth_1[_0x1774c1(0x196)][_0x1774c1(0x19a)](),_0x28224b=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0x3bad9b)),_0x4477cf=new logger_1[(_0x1774c1(0x16f))](_0x28224b,_0x24c2bf,_0x594a62),_0x1297c5=new snapshot_service_1[(_0x1774c1(0x16b))](_0x1a7c0d,_0x28224b,_0x393429,_0x4477cf);return _0x1297c5[_0x1774c1(0x17c)]()[_0x1774c1(0x18b)](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x1774c1(0x16a)]};}catch(_0x4a5aa2){return{'responseStatus':status_enums_1[_0x1774c1(0x169)][_0x1774c1(0x174)],'responseMessage':_0x4a5aa2['message']};}}async['deployFromBranch'](_0x2bfe8b){const _0x4bcc8e=a371_0x12b219,{veevaAuth:_0x16c8aa,timeZone:_0x1f9e5e,attachmentLogId:_0x1b696a}=_0x2bfe8b;try{const _0x1a8b83=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x4bcc8e(0x1a9))](_0x16c8aa,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2b87f2=await salesforce_auth_1[_0x4bcc8e(0x196)][_0x4bcc8e(0x19a)](),_0x29fc10=(0x0,salesforce_request_utils_1[_0x4bcc8e(0x18a)])(new salesforce_auth_1[(_0x4bcc8e(0x196))](_0x2b87f2)),_0x518750=new logger_1[(_0x4bcc8e(0x16f))](_0x29fc10,_0x1f9e5e,_0x1b696a),_0x3383f1=_0x4bcc8e(0x164)+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x4bcc8e(0x171)])(_0x3383f1);const _0x33ec3f=new deploy_service_1[(_0x4bcc8e(0x188))](_0x2bfe8b,_0x29fc10,_0x1a8b83,_0x518750,_0x3383f1,_0x2b87f2[_0x4bcc8e(0x179)]);return _0x33ec3f[_0x4bcc8e(0x17c)]()['finally'](()=>(0x0,promises_1['rm'])(_0x3383f1,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x4bcc8e(0x169)][_0x4bcc8e(0x16a)]};}catch(_0x264961){return{'responseStatus':status_enums_1[_0x4bcc8e(0x169)][_0x4bcc8e(0x174)],'responseMessage':_0x264961[_0x4bcc8e(0x168)]};}}async[a371_0x12b219(0x170)](_0xe4a28a){const _0xb6f18b=a371_0x12b219,{veevaAuth:_0x3618d6}=_0xe4a28a;try{const _0x3acfc4=(0x0,veeva_request_utils_1[_0xb6f18b(0x190)])(new veeva_auth_1['VeevaAuth'](_0x3618d6)),_0x1c964f=await salesforce_auth_1[_0xb6f18b(0x196)]['getAuthDetails'](),_0x2193bf=(0x0,salesforce_request_utils_1[_0xb6f18b(0x18a)])(new salesforce_auth_1[(_0xb6f18b(0x196))](_0x1c964f)),_0x3e2842=new dependency_service_1[(_0xb6f18b(0x184))](_0xe4a28a,_0x2193bf,_0x3acfc4);return await _0x3e2842[_0xb6f18b(0x17c)]();}catch(_0x4b9aea){const _0x236587=_0x4b9aea instanceof base_veeva_error_1[_0xb6f18b(0x1ae)]?_0x4b9aea[_0xb6f18b(0x177)]()[_0xb6f18b(0x1a2)]('\x0a'):_0x4b9aea['message'];return{'responseStatus':status_enums_1[_0xb6f18b(0x169)][_0xb6f18b(0x174)],'responseMessage':_0x236587};}}async[a371_0x12b219(0x180)](_0x1482b9){const _0x544cfb=a371_0x12b219,{veevaAuth:_0x4a5dbb,timeZone:_0x1848ea,attachmentLogId:_0x5ad764}=_0x1482b9;try{const _0x5dde0c=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x544cfb(0x1a9))](_0x4a5dbb,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x29b655=await salesforce_auth_1[_0x544cfb(0x196)][_0x544cfb(0x19a)](),_0x35e3db=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x544cfb(0x196))](_0x29b655)),_0x2b2e0d=new logger_1[(_0x544cfb(0x16f))](_0x35e3db,_0x1848ea,_0x5ad764),_0x4252d8='temp/veeva/rollback_'+(0x0,shortid_1[_0x544cfb(0x1a1)])();await(0x0,fs_util_1[_0x544cfb(0x171)])(_0x4252d8);const _0x3bb496=new rollback_service_1[(_0x544cfb(0x1a4))]({..._0x1482b9,'connectionVeeva':_0x5dde0c,'connectionSalesforce':_0x35e3db,'logger':_0x2b2e0d,'tempFolder':_0x4252d8,'instanceUrl':_0x29b655[_0x544cfb(0x179)]});return _0x3bb496[_0x544cfb(0x17c)]()[_0x544cfb(0x16d)](()=>(0x0,promises_1['rm'])(_0x4252d8,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x544cfb(0x169)][_0x544cfb(0x16a)]};}catch(_0x3b319c){return{'responseStatus':status_enums_1[_0x544cfb(0x169)]['FAILURE'],'responseMessage':_0x3b319c['message']};}}};__decorate([(0x0,core_1[a371_0x12b219(0x17d)])(a371_0x12b219(0x183)),__param(0x0,core_1[a371_0x12b219(0x187)]['body']()),__metadata('design:type',Function),__metadata(a371_0x12b219(0x1ad),[Object]),__metadata(a371_0x12b219(0x172),Promise)],VeevaVaultController[a371_0x12b219(0x198)],'doSnapshot',null),__decorate([(0x0,core_1[a371_0x12b219(0x17d)])(a371_0x12b219(0x182)),__param(0x0,core_1[a371_0x12b219(0x187)]['body']()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata(a371_0x12b219(0x172),Promise)],VeevaVaultController['prototype'],a371_0x12b219(0x16c),null),__decorate([(0x0,core_1[a371_0x12b219(0x17d)])(a371_0x12b219(0x18c)),__param(0x0,core_1[a371_0x12b219(0x187)][a371_0x12b219(0x19d)]()),__metadata(a371_0x12b219(0x1a0),Function),__metadata(a371_0x12b219(0x1ad),[Object]),__metadata(a371_0x12b219(0x172),Promise)],VeevaVaultController[a371_0x12b219(0x198)],a371_0x12b219(0x170),null),__decorate([(0x0,core_1[a371_0x12b219(0x17d)])(a371_0x12b219(0x180)),__param(0x0,core_1[a371_0x12b219(0x187)]['body']()),__metadata(a371_0x12b219(0x1a0),Function),__metadata(a371_0x12b219(0x1ad),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x12b219(0x198)],a371_0x12b219(0x180),null),VeevaVaultController=__decorate([(0x0,core_1[a371_0x12b219(0x16e)])(a371_0x12b219(0x189)),(0x0,core_1[a371_0x12b219(0x1a7)])(a371_0x12b219(0x18e))],VeevaVaultController),exports[a371_0x12b219(0x19c)]=VeevaVaultController;