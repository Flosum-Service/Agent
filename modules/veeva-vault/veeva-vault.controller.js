function a371_0x245d(){const _0x52fa46=['toString','516bSsWzm','default','defineProperty','Post','length','3007879xMXtba','body','SalesforceAuth','then','__metadata','dependency','design:paramtypes','./utils/fs-util','1067322SqigYF','search','SUCCESS','function','metadata','message','96020VfaDAe','Controller','temp/veeva/deploy_','object','getAuthDetails','SnapshotService','prototype','deploy','2655xiizcv','decorate','temp/veeva/rollback_','./classes/loggers/logger','constructor','VeevaAuth','DeployService','__importDefault','execute','join','16LlpaqM','retrieveDependency','1821945odQhpK','deployFromBranch','BaseVeevaError','design:type','__esModule','instanceUrl','./utils/veeva-request.utils','../../core','./services/snapshot.service','(((.+)+)+)+$','./classes/auth/salesforce-auth','FAILURE','VeevaVaultController','./services/rollback.service','Logger','snapshot','shortid','design:returntype','./classes/auth/veeva-auth','fs/promises','createSalesforceRequest','veeva-vault','createVeevaRequest','838691irsItK','./enums/status.enums','getMessages','rollback','param','988SLHKuo','1726988wznjzx','__param','makeDir','AppResponseStatus','./services/dependency.service'];a371_0x245d=function(){return _0x52fa46;};return a371_0x245d();}function a371_0x28ad(_0x1b907e,_0xb50bc2){const _0x3f498d=a371_0x245d();return a371_0x28ad=function(_0x3f992e,_0xc08f13){_0x3f992e=_0x3f992e-0x163;let _0x245d6d=_0x3f498d[_0x3f992e];return _0x245d6d;},a371_0x28ad(_0x1b907e,_0xb50bc2);}const a371_0xb98474=a371_0x28ad;(function(_0x38bd04,_0x12c6c2){const _0x383e24=a371_0x28ad,_0x41fe82=_0x38bd04();while(!![]){try{const _0x54259d=-parseInt(_0x383e24(0x19c))/0x1+parseInt(_0x383e24(0x1a1))/0x2*(-parseInt(_0x383e24(0x1a8))/0x3)+-parseInt(_0x383e24(0x1a2))/0x4+-parseInt(_0x383e24(0x185))/0x5+parseInt(_0x383e24(0x16b))/0x6+parseInt(_0x383e24(0x163))/0x7*(-parseInt(_0x383e24(0x183))/0x8)+-parseInt(_0x383e24(0x179))/0x9*(-parseInt(_0x383e24(0x171))/0xa);if(_0x54259d===_0x12c6c2)break;else _0x41fe82['push'](_0x41fe82['shift']());}catch(_0x1f9247){_0x41fe82['push'](_0x41fe82['shift']());}}}(a371_0x245d,0x694b8));const a371_0xc08f13=(function(){let _0x45610d=!![];return function(_0x5e5dac,_0x504bca){const _0x1bb747=_0x45610d?function(){if(_0x504bca){const _0x60812d=_0x504bca['apply'](_0x5e5dac,arguments);return _0x504bca=null,_0x60812d;}}:function(){};return _0x45610d=![],_0x1bb747;};}()),a371_0x3f992e=a371_0xc08f13(this,function(){const _0x233ddb=a371_0x28ad;return a371_0x3f992e[_0x233ddb(0x1a7)]()[_0x233ddb(0x16c)]('(((.+)+)+)+$')[_0x233ddb(0x1a7)]()[_0x233ddb(0x17d)](a371_0x3f992e)[_0x233ddb(0x16c)](_0x233ddb(0x18e));});a371_0x3f992e();'use strict';var __decorate=this&&this['__decorate']||function(_0x45938a,_0x13e649,_0x40c3cc,_0x7fd105){const _0x3cbf56=a371_0x28ad;var _0x205465=arguments['length'],_0x4e79e7=_0x205465<0x3?_0x13e649:_0x7fd105===null?_0x7fd105=Object['getOwnPropertyDescriptor'](_0x13e649,_0x40c3cc):_0x7fd105,_0x33d6a0;if(typeof Reflect===_0x3cbf56(0x174)&&typeof Reflect[_0x3cbf56(0x17a)]===_0x3cbf56(0x16e))_0x4e79e7=Reflect[_0x3cbf56(0x17a)](_0x45938a,_0x13e649,_0x40c3cc,_0x7fd105);else{for(var _0x29fd6b=_0x45938a[_0x3cbf56(0x1ac)]-0x1;_0x29fd6b>=0x0;_0x29fd6b--)if(_0x33d6a0=_0x45938a[_0x29fd6b])_0x4e79e7=(_0x205465<0x3?_0x33d6a0(_0x4e79e7):_0x205465>0x3?_0x33d6a0(_0x13e649,_0x40c3cc,_0x4e79e7):_0x33d6a0(_0x13e649,_0x40c3cc))||_0x4e79e7;}return _0x205465>0x3&&_0x4e79e7&&Object[_0x3cbf56(0x1aa)](_0x13e649,_0x40c3cc,_0x4e79e7),_0x4e79e7;},__metadata=this&&this[a371_0xb98474(0x167)]||function(_0xf3f2c,_0x5c95c1){const _0x172c1a=a371_0xb98474;if(typeof Reflect==='object'&&typeof Reflect[_0x172c1a(0x16f)]==='function')return Reflect[_0x172c1a(0x16f)](_0xf3f2c,_0x5c95c1);},__param=this&&this[a371_0xb98474(0x1a3)]||function(_0x28c2c1,_0x43c110){return function(_0x404d96,_0x5d0dcf){_0x43c110(_0x404d96,_0x5d0dcf,_0x28c2c1);};},__importDefault=this&&this[a371_0xb98474(0x180)]||function(_0x587656){const _0x212949=a371_0xb98474;return _0x587656&&_0x587656[_0x212949(0x189)]?_0x587656:{'default':_0x587656};};Object[a371_0xb98474(0x1aa)](exports,a371_0xb98474(0x189),{'value':!![]}),exports[a371_0xb98474(0x191)]=void 0x0;const core_1=require(a371_0xb98474(0x18c)),dependency_service_1=require(a371_0xb98474(0x1a6)),snapshot_service_1=require(a371_0xb98474(0x18d)),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require(a371_0xb98474(0x18b)),status_enums_1=require(a371_0xb98474(0x19d)),shortid_1=__importDefault(require(a371_0xb98474(0x195))),fs_util_1=require(a371_0xb98474(0x16a)),logger_1=require(a371_0xb98474(0x17c)),promises_1=require(a371_0xb98474(0x198)),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require(a371_0xb98474(0x197)),salesforce_auth_1=require(a371_0xb98474(0x18f)),rollback_service_1=require(a371_0xb98474(0x192)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x41a360){const _0x550e2d=a371_0xb98474,{veevaAuth:_0x123b62,timeZone:_0x57af18,attachmentLogId:_0x4ee437}=_0x41a360;try{const _0x53a434=(0x0,veeva_request_utils_1[_0x550e2d(0x19b)])(new veeva_auth_1[(_0x550e2d(0x17e))](_0x123b62,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xea28ca=await salesforce_auth_1[_0x550e2d(0x165)][_0x550e2d(0x175)](),_0x44684e=(0x0,salesforce_request_utils_1[_0x550e2d(0x199)])(new salesforce_auth_1[(_0x550e2d(0x165))](_0xea28ca)),_0x5d2dfb=new logger_1['Logger'](_0x44684e,_0x57af18,_0x4ee437),_0xe71919=new snapshot_service_1[(_0x550e2d(0x176))](_0x41a360,_0x44684e,_0x53a434,_0x5d2dfb);return _0xe71919[_0x550e2d(0x181)]()[_0x550e2d(0x166)](),{'responseStatus':status_enums_1[_0x550e2d(0x1a5)][_0x550e2d(0x16d)]};}catch(_0x4c12c7){return{'responseStatus':status_enums_1[_0x550e2d(0x1a5)][_0x550e2d(0x190)],'responseMessage':_0x4c12c7[_0x550e2d(0x170)]};}}async[a371_0xb98474(0x186)](_0x3c0ad1){const _0x402a8e=a371_0xb98474,{veevaAuth:_0x3c4ac6,timeZone:_0x1a023c,attachmentLogId:_0x3187e6}=_0x3c0ad1;try{const _0x389291=(0x0,veeva_request_utils_1[_0x402a8e(0x19b)])(new veeva_auth_1['VeevaAuth'](_0x3c4ac6,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x42d55b=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x15a90b=(0x0,salesforce_request_utils_1[_0x402a8e(0x199)])(new salesforce_auth_1[(_0x402a8e(0x165))](_0x42d55b)),_0x3b95d2=new logger_1['Logger'](_0x15a90b,_0x1a023c,_0x3187e6),_0x12b8c4=_0x402a8e(0x173)+(0x0,shortid_1[_0x402a8e(0x1a9)])();await(0x0,fs_util_1[_0x402a8e(0x1a4)])(_0x12b8c4);const _0x31b691=new deploy_service_1[(_0x402a8e(0x17f))](_0x3c0ad1,_0x15a90b,_0x389291,_0x3b95d2,_0x12b8c4,_0x42d55b[_0x402a8e(0x18a)]);return _0x31b691[_0x402a8e(0x181)]()['finally'](()=>(0x0,promises_1['rm'])(_0x12b8c4,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x402a8e(0x1a5)][_0x402a8e(0x16d)]};}catch(_0x374f7a){return{'responseStatus':status_enums_1[_0x402a8e(0x1a5)][_0x402a8e(0x190)],'responseMessage':_0x374f7a[_0x402a8e(0x170)]};}}async[a371_0xb98474(0x184)](_0x52bcf0){const _0x1530c1=a371_0xb98474,{veevaAuth:_0x548374}=_0x52bcf0;try{const _0x4434ae=(0x0,veeva_request_utils_1[_0x1530c1(0x19b)])(new veeva_auth_1[(_0x1530c1(0x17e))](_0x548374)),_0x1b5825=await salesforce_auth_1['SalesforceAuth'][_0x1530c1(0x175)](),_0x443543=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x1530c1(0x165))](_0x1b5825)),_0x40c79b=new dependency_service_1['DependencyService'](_0x52bcf0,_0x443543,_0x4434ae);return await _0x40c79b[_0x1530c1(0x181)]();}catch(_0x473d28){const _0x4184e7=_0x473d28 instanceof base_veeva_error_1[_0x1530c1(0x187)]?_0x473d28[_0x1530c1(0x19e)]()[_0x1530c1(0x182)]('\x0a'):_0x473d28[_0x1530c1(0x170)];return{'responseStatus':status_enums_1[_0x1530c1(0x1a5)][_0x1530c1(0x190)],'responseMessage':_0x4184e7};}}async[a371_0xb98474(0x19f)](_0x3127b3){const _0x59b546=a371_0xb98474,{veevaAuth:_0x5966e0,timeZone:_0x869241,attachmentLogId:_0x2b2f65}=_0x3127b3;try{const _0x3f9a65=(0x0,veeva_request_utils_1[_0x59b546(0x19b)])(new veeva_auth_1[(_0x59b546(0x17e))](_0x5966e0,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x7c79f6=await salesforce_auth_1[_0x59b546(0x165)][_0x59b546(0x175)](),_0x5a5c08=(0x0,salesforce_request_utils_1[_0x59b546(0x199)])(new salesforce_auth_1[(_0x59b546(0x165))](_0x7c79f6)),_0x2bf06f=new logger_1[(_0x59b546(0x193))](_0x5a5c08,_0x869241,_0x2b2f65),_0xb14b0f=_0x59b546(0x17b)+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x59b546(0x1a4)])(_0xb14b0f);const _0x1a4a44=new rollback_service_1['RollbackService']({..._0x3127b3,'connectionVeeva':_0x3f9a65,'connectionSalesforce':_0x5a5c08,'logger':_0x2bf06f,'tempFolder':_0xb14b0f,'instanceUrl':_0x7c79f6[_0x59b546(0x18a)]});return _0x1a4a44[_0x59b546(0x181)]()['finally'](()=>(0x0,promises_1['rm'])(_0xb14b0f,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x59b546(0x1a5)]['SUCCESS']};}catch(_0x13efd0){return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x13efd0[_0x59b546(0x170)]};}}};__decorate([(0x0,core_1[a371_0xb98474(0x1ab)])(a371_0xb98474(0x194)),__param(0x0,core_1[a371_0xb98474(0x1a0)][a371_0xb98474(0x164)]()),__metadata(a371_0xb98474(0x188),Function),__metadata(a371_0xb98474(0x169),[Object]),__metadata(a371_0xb98474(0x196),Promise)],VeevaVaultController[a371_0xb98474(0x177)],'doSnapshot',null),__decorate([(0x0,core_1[a371_0xb98474(0x1ab)])(a371_0xb98474(0x178)),__param(0x0,core_1[a371_0xb98474(0x1a0)][a371_0xb98474(0x164)]()),__metadata(a371_0xb98474(0x188),Function),__metadata(a371_0xb98474(0x169),[Object]),__metadata(a371_0xb98474(0x196),Promise)],VeevaVaultController['prototype'],'deployFromBranch',null),__decorate([(0x0,core_1[a371_0xb98474(0x1ab)])(a371_0xb98474(0x168)),__param(0x0,core_1[a371_0xb98474(0x1a0)][a371_0xb98474(0x164)]()),__metadata('design:type',Function),__metadata(a371_0xb98474(0x169),[Object]),__metadata(a371_0xb98474(0x196),Promise)],VeevaVaultController[a371_0xb98474(0x177)],a371_0xb98474(0x184),null),__decorate([(0x0,core_1[a371_0xb98474(0x1ab)])('rollback'),__param(0x0,core_1[a371_0xb98474(0x1a0)][a371_0xb98474(0x164)]()),__metadata('design:type',Function),__metadata(a371_0xb98474(0x169),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0xb98474(0x177)],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a371_0xb98474(0x172)])(a371_0xb98474(0x19a)),(0x0,core_1['Version'])('v1.1')],VeevaVaultController),exports[a371_0xb98474(0x191)]=VeevaVaultController;