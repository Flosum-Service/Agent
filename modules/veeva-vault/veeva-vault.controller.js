const a415_0x240dc5=a415_0x5913;(function(_0x18ef65,_0x26fa91){const _0x540e83=a415_0x5913,_0x3ef1d8=_0x18ef65();while(!![]){try{const _0x1852a6=-parseInt(_0x540e83(0xdd))/0x1*(-parseInt(_0x540e83(0x112))/0x2)+parseInt(_0x540e83(0xf0))/0x3+-parseInt(_0x540e83(0x10b))/0x4*(parseInt(_0x540e83(0xf9))/0x5)+-parseInt(_0x540e83(0x103))/0x6*(-parseInt(_0x540e83(0x114))/0x7)+-parseInt(_0x540e83(0x105))/0x8+parseInt(_0x540e83(0x10d))/0x9+-parseInt(_0x540e83(0xfa))/0xa*(parseInt(_0x540e83(0x123))/0xb);if(_0x1852a6===_0x26fa91)break;else _0x3ef1d8['push'](_0x3ef1d8['shift']());}catch(_0x1b7b43){_0x3ef1d8['push'](_0x3ef1d8['shift']());}}}(a415_0x2800,0x8b974));const a415_0x4a8adf=(function(){let _0x752861=!![];return function(_0x78c838,_0x2ddbaa){const _0x44a3d1=_0x752861?function(){const _0x25fe0e=a415_0x5913;if(_0x2ddbaa){const _0x191b6b=_0x2ddbaa[_0x25fe0e(0x111)](_0x78c838,arguments);return _0x2ddbaa=null,_0x191b6b;}}:function(){};return _0x752861=![],_0x44a3d1;};}()),a415_0xe2f00f=a415_0x4a8adf(this,function(){const _0x4055d9=a415_0x5913;return a415_0xe2f00f[_0x4055d9(0xf7)]()['search'](_0x4055d9(0x100))[_0x4055d9(0xf7)]()[_0x4055d9(0x106)](a415_0xe2f00f)[_0x4055d9(0xe8)]('(((.+)+)+)+$');});a415_0xe2f00f();'use strict';var __decorate=this&&this[a415_0x240dc5(0xdb)]||function(_0x3a8eba,_0x24ad53,_0x204098,_0x232bd8){const _0x3c0a70=a415_0x240dc5;var _0x5b3a8e=arguments['length'],_0x12690c=_0x5b3a8e<0x3?_0x24ad53:_0x232bd8===null?_0x232bd8=Object[_0x3c0a70(0xff)](_0x24ad53,_0x204098):_0x232bd8,_0x5190fd;if(typeof Reflect===_0x3c0a70(0xf2)&&typeof Reflect[_0x3c0a70(0x101)]===_0x3c0a70(0x11b))_0x12690c=Reflect[_0x3c0a70(0x101)](_0x3a8eba,_0x24ad53,_0x204098,_0x232bd8);else{for(var _0xed01ea=_0x3a8eba['length']-0x1;_0xed01ea>=0x0;_0xed01ea--)if(_0x5190fd=_0x3a8eba[_0xed01ea])_0x12690c=(_0x5b3a8e<0x3?_0x5190fd(_0x12690c):_0x5b3a8e>0x3?_0x5190fd(_0x24ad53,_0x204098,_0x12690c):_0x5190fd(_0x24ad53,_0x204098))||_0x12690c;}return _0x5b3a8e>0x3&&_0x12690c&&Object[_0x3c0a70(0xf3)](_0x24ad53,_0x204098,_0x12690c),_0x12690c;},__metadata=this&&this['__metadata']||function(_0xbc0140,_0x1b9d94){const _0x53f442=a415_0x240dc5;if(typeof Reflect===_0x53f442(0xf2)&&typeof Reflect[_0x53f442(0x11a)]==='function')return Reflect[_0x53f442(0x11a)](_0xbc0140,_0x1b9d94);},__param=this&&this[a415_0x240dc5(0xec)]||function(_0x5de5a8,_0x4d4d11){return function(_0x2397d1,_0x2ff088){_0x4d4d11(_0x2397d1,_0x2ff088,_0x5de5a8);};},__importDefault=this&&this[a415_0x240dc5(0xe9)]||function(_0x27cdf7){return _0x27cdf7&&_0x27cdf7['__esModule']?_0x27cdf7:{'default':_0x27cdf7};};Object['defineProperty'](exports,a415_0x240dc5(0x122),{'value':!![]}),exports[a415_0x240dc5(0x10e)]=void 0x0;const core_1=require(a415_0x240dc5(0x11d)),dependency_service_1=require('./services/dependency.service'),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a415_0x240dc5(0xfb)),veeva_request_utils_1=require(a415_0x240dc5(0x10a)),status_enums_1=require(a415_0x240dc5(0xea)),shortid_1=__importDefault(require(a415_0x240dc5(0xef))),fs_util_1=require(a415_0x240dc5(0x109)),logger_1=require(a415_0x240dc5(0xf6)),promises_1=require('fs/promises'),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a415_0x240dc5(0xfd)),rollback_service_1=require(a415_0x240dc5(0xeb)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x3df8e8){const _0x165ec4=a415_0x240dc5,{veevaAuth:_0x2427b3,timeZone:_0x15e4c9,attachmentLogId:_0x22971c}=_0x3df8e8;try{const _0x33d9ad=(0x0,veeva_request_utils_1[_0x165ec4(0xde)])(new veeva_auth_1[(_0x165ec4(0xe1))](_0x2427b3,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x53187c=await salesforce_auth_1[_0x165ec4(0xe4)][_0x165ec4(0x11e)](),_0x5346b8=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x165ec4(0xe4))](_0x53187c)),_0x4bf7a6=new logger_1[(_0x165ec4(0x11c))](_0x5346b8,_0x15e4c9,_0x22971c),_0x6143b=new snapshot_service_1[(_0x165ec4(0x10c))](_0x3df8e8,_0x5346b8,_0x33d9ad,_0x4bf7a6);return _0x6143b[_0x165ec4(0xed)]()[_0x165ec4(0x113)](),{'responseStatus':status_enums_1[_0x165ec4(0xf5)][_0x165ec4(0xe0)]};}catch(_0x439217){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x165ec4(0x116)],'responseMessage':_0x439217['message']};}}async[a415_0x240dc5(0xdf)](_0x539c00){const _0x47152d=a415_0x240dc5,{veevaAuth:_0x24747e,timeZone:_0x53a0c2,attachmentLogId:_0x9ca77c}=_0x539c00;try{const _0x36ae6a=(0x0,veeva_request_utils_1[_0x47152d(0xde)])(new veeva_auth_1[(_0x47152d(0xe1))](_0x24747e,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x48fe97=await salesforce_auth_1[_0x47152d(0xe4)]['getAuthDetails'](),_0x4b2782=(0x0,salesforce_request_utils_1[_0x47152d(0xe7)])(new salesforce_auth_1['SalesforceAuth'](_0x48fe97)),_0x3652e6=new logger_1['Logger'](_0x4b2782,_0x53a0c2,_0x9ca77c),_0x56d64d=_0x47152d(0xf8)+(0x0,shortid_1[_0x47152d(0xfc)])();await(0x0,fs_util_1['makeDir'])(_0x56d64d);const _0x3ba6d3=new deploy_service_1['DeployService'](_0x539c00,_0x4b2782,_0x36ae6a,_0x3652e6,_0x56d64d,_0x48fe97['instanceUrl']);return _0x3ba6d3[_0x47152d(0xed)]()['finally'](()=>(0x0,promises_1['rm'])(_0x56d64d,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x47152d(0xf5)][_0x47152d(0xe0)]};}catch(_0x153bf7){return{'responseStatus':status_enums_1[_0x47152d(0xf5)][_0x47152d(0x116)],'responseMessage':_0x153bf7[_0x47152d(0x102)]};}}async[a415_0x240dc5(0xe3)](_0x9536a7){const _0x54968b=a415_0x240dc5,{veevaAuth:_0x1f7c18}=_0x9536a7;try{const _0x42d9b0=(0x0,veeva_request_utils_1[_0x54968b(0xde)])(new veeva_auth_1['VeevaAuth'](_0x1f7c18)),_0x5dd0c4=await salesforce_auth_1[_0x54968b(0xe4)][_0x54968b(0x11e)](),_0x1b53ea=(0x0,salesforce_request_utils_1[_0x54968b(0xe7)])(new salesforce_auth_1[(_0x54968b(0xe4))](_0x5dd0c4)),_0x5bb0ec=new dependency_service_1['DependencyService'](_0x9536a7,_0x1b53ea,_0x42d9b0);return await _0x5bb0ec['execute']();}catch(_0x4f0f7c){const _0x20cbcd=_0x4f0f7c instanceof base_veeva_error_1[_0x54968b(0x104)]?_0x4f0f7c[_0x54968b(0x120)]()[_0x54968b(0x118)]('\x0a'):_0x4f0f7c[_0x54968b(0x102)];return{'responseStatus':status_enums_1[_0x54968b(0xf5)][_0x54968b(0x116)],'responseMessage':_0x20cbcd};}}async[a415_0x240dc5(0xe5)](_0x1d52d2){const _0x2b59fa=a415_0x240dc5,{veevaAuth:_0x3f0ef1,timeZone:_0x10bdfd,attachmentLogId:_0x409191}=_0x1d52d2;try{const _0x5b6f0a=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1['VeevaAuth'](_0x3f0ef1,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x20f2b9=await salesforce_auth_1[_0x2b59fa(0xe4)][_0x2b59fa(0x11e)](),_0xc4a28a=(0x0,salesforce_request_utils_1[_0x2b59fa(0xe7)])(new salesforce_auth_1['SalesforceAuth'](_0x20f2b9)),_0xff7516=new logger_1[(_0x2b59fa(0x11c))](_0xc4a28a,_0x10bdfd,_0x409191),_0x5ae61a=_0x2b59fa(0x11f)+(0x0,shortid_1[_0x2b59fa(0xfc)])();await(0x0,fs_util_1[_0x2b59fa(0x115)])(_0x5ae61a);const _0x5aac4b=new rollback_service_1['RollbackService']({..._0x1d52d2,'connectionVeeva':_0x5b6f0a,'connectionSalesforce':_0xc4a28a,'logger':_0xff7516,'tempFolder':_0x5ae61a,'instanceUrl':_0x20f2b9[_0x2b59fa(0x117)]});return _0x5aac4b[_0x2b59fa(0xed)]()[_0x2b59fa(0x110)](()=>(0x0,promises_1['rm'])(_0x5ae61a,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x2b59fa(0xf5)][_0x2b59fa(0xe0)]};}catch(_0x279f12){return{'responseStatus':status_enums_1[_0x2b59fa(0xf5)][_0x2b59fa(0x116)],'responseMessage':_0x279f12[_0x2b59fa(0x102)]};}}};function a415_0x5913(_0x364cbd,_0x1941d9){const _0x1ffe61=a415_0x2800();return a415_0x5913=function(_0xe2f00f,_0x4a8adf){_0xe2f00f=_0xe2f00f-0xdb;let _0x28009e=_0x1ffe61[_0xe2f00f];return _0x28009e;},a415_0x5913(_0x364cbd,_0x1941d9);}function a415_0x2800(){const _0x2621c1=['10NVTZBD','./services/deploy.service','default','./classes/auth/salesforce-auth','Version','getOwnPropertyDescriptor','(((.+)+)+)+$','decorate','message','1446384BdfLVy','BaseVeevaError','1939592ePeUYe','constructor','Post','design:type','./utils/fs-util','./utils/veeva-request.utils','128KoOoKj','SnapshotService','5706819ybIhKb','VeevaVaultController','dependency','finally','apply','1985702MIZpGi','then','7wAFKrX','makeDir','FAILURE','instanceUrl','join','veeva-vault','metadata','function','Logger','../../core','getAuthDetails','temp/veeva/rollback_','getMessages','body','__esModule','3599673QFpuNe','deploy','__decorate','design:paramtypes','1rVhCnR','createVeevaRequest','deployFromBranch','SUCCESS','VeevaAuth','v1.1','retrieveDependency','SalesforceAuth','rollback','Controller','createSalesforceRequest','search','__importDefault','./enums/status.enums','./services/rollback.service','__param','execute','param','shortid','1244766NqLQiP','design:returntype','object','defineProperty','prototype','AppResponseStatus','./classes/loggers/logger','toString','temp/veeva/deploy_','178355YMZFbb'];a415_0x2800=function(){return _0x2621c1;};return a415_0x2800();}__decorate([(0x0,core_1[a415_0x240dc5(0x107)])('snapshot'),__param(0x0,core_1[a415_0x240dc5(0xee)][a415_0x240dc5(0x121)]()),__metadata(a415_0x240dc5(0x108),Function),__metadata(a415_0x240dc5(0xdc),[Object]),__metadata(a415_0x240dc5(0xf1),Promise)],VeevaVaultController[a415_0x240dc5(0xf4)],'doSnapshot',null),__decorate([(0x0,core_1['Post'])(a415_0x240dc5(0x124)),__param(0x0,core_1[a415_0x240dc5(0xee)]['body']()),__metadata(a415_0x240dc5(0x108),Function),__metadata('design:paramtypes',[Object]),__metadata(a415_0x240dc5(0xf1),Promise)],VeevaVaultController[a415_0x240dc5(0xf4)],a415_0x240dc5(0xdf),null),__decorate([(0x0,core_1[a415_0x240dc5(0x107)])(a415_0x240dc5(0x10f)),__param(0x0,core_1['param']['body']()),__metadata(a415_0x240dc5(0x108),Function),__metadata(a415_0x240dc5(0xdc),[Object]),__metadata(a415_0x240dc5(0xf1),Promise)],VeevaVaultController[a415_0x240dc5(0xf4)],'retrieveDependency',null),__decorate([(0x0,core_1['Post'])(a415_0x240dc5(0xe5)),__param(0x0,core_1['param'][a415_0x240dc5(0x121)]()),__metadata(a415_0x240dc5(0x108),Function),__metadata(a415_0x240dc5(0xdc),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a415_0x240dc5(0xf4)],a415_0x240dc5(0xe5),null),VeevaVaultController=__decorate([(0x0,core_1[a415_0x240dc5(0xe6)])(a415_0x240dc5(0x119)),(0x0,core_1[a415_0x240dc5(0xfe)])(a415_0x240dc5(0xe2))],VeevaVaultController),exports[a415_0x240dc5(0x10e)]=VeevaVaultController;