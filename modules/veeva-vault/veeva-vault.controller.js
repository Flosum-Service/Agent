const a371_0x5dd637=a371_0x4e57;(function(_0x44db53,_0x55dc9b){const _0x5d1e9d=a371_0x4e57,_0x4167c3=_0x44db53();while(!![]){try{const _0x5673c0=-parseInt(_0x5d1e9d(0xcc))/0x1+parseInt(_0x5d1e9d(0xda))/0x2*(-parseInt(_0x5d1e9d(0xc7))/0x3)+parseInt(_0x5d1e9d(0xd5))/0x4+-parseInt(_0x5d1e9d(0xe2))/0x5+-parseInt(_0x5d1e9d(0xd6))/0x6*(parseInt(_0x5d1e9d(0xc4))/0x7)+parseInt(_0x5d1e9d(0xb7))/0x8+-parseInt(_0x5d1e9d(0xc8))/0x9;if(_0x5673c0===_0x55dc9b)break;else _0x4167c3['push'](_0x4167c3['shift']());}catch(_0x2bc6b0){_0x4167c3['push'](_0x4167c3['shift']());}}}(a371_0x39ea,0x3b675));const a371_0xcb39bb=(function(){let _0x4990e9=!![];return function(_0x573134,_0x2aafe9){const _0x31f2d8=_0x4990e9?function(){const _0x1dbc10=a371_0x4e57;if(_0x2aafe9){const _0x2a2a18=_0x2aafe9[_0x1dbc10(0xf6)](_0x573134,arguments);return _0x2aafe9=null,_0x2a2a18;}}:function(){};return _0x4990e9=![],_0x31f2d8;};}()),a371_0x75c15d=a371_0xcb39bb(this,function(){const _0x357ff8=a371_0x4e57;return a371_0x75c15d[_0x357ff8(0xf8)]()[_0x357ff8(0xcd)](_0x357ff8(0xe0))[_0x357ff8(0xf8)]()[_0x357ff8(0xcf)](a371_0x75c15d)['search'](_0x357ff8(0xe0));});a371_0x75c15d();function a371_0x4e57(_0x1bf4bf,_0x1277f9){const _0x1ba905=a371_0x39ea();return a371_0x4e57=function(_0x75c15d,_0xcb39bb){_0x75c15d=_0x75c15d-0xb4;let _0x39ea2d=_0x1ba905[_0x75c15d];return _0x39ea2d;},a371_0x4e57(_0x1bf4bf,_0x1277f9);}'use strict';var __decorate=this&&this['__decorate']||function(_0x3d85dd,_0x4bb8f3,_0x52f78f,_0x3a3daf){const _0xa7aba3=a371_0x4e57;var _0x3d9045=arguments[_0xa7aba3(0xe3)],_0x994d=_0x3d9045<0x3?_0x4bb8f3:_0x3a3daf===null?_0x3a3daf=Object[_0xa7aba3(0xf9)](_0x4bb8f3,_0x52f78f):_0x3a3daf,_0x35520d;if(typeof Reflect===_0xa7aba3(0xec)&&typeof Reflect[_0xa7aba3(0xd2)]===_0xa7aba3(0xd8))_0x994d=Reflect['decorate'](_0x3d85dd,_0x4bb8f3,_0x52f78f,_0x3a3daf);else{for(var _0x374762=_0x3d85dd[_0xa7aba3(0xe3)]-0x1;_0x374762>=0x0;_0x374762--)if(_0x35520d=_0x3d85dd[_0x374762])_0x994d=(_0x3d9045<0x3?_0x35520d(_0x994d):_0x3d9045>0x3?_0x35520d(_0x4bb8f3,_0x52f78f,_0x994d):_0x35520d(_0x4bb8f3,_0x52f78f))||_0x994d;}return _0x3d9045>0x3&&_0x994d&&Object[_0xa7aba3(0xc6)](_0x4bb8f3,_0x52f78f,_0x994d),_0x994d;},__metadata=this&&this['__metadata']||function(_0x45527d,_0x297ce5){const _0xe27920=a371_0x4e57;if(typeof Reflect===_0xe27920(0xec)&&typeof Reflect[_0xe27920(0xb6)]===_0xe27920(0xd8))return Reflect[_0xe27920(0xb6)](_0x45527d,_0x297ce5);},__param=this&&this['__param']||function(_0x38d582,_0x1719fe){return function(_0xd5ad78,_0x23dc4a){_0x1719fe(_0xd5ad78,_0x23dc4a,_0x38d582);};},__importDefault=this&&this['__importDefault']||function(_0x4bd95e){const _0x584309=a371_0x4e57;return _0x4bd95e&&_0x4bd95e[_0x584309(0xd1)]?_0x4bd95e:{'default':_0x4bd95e};};Object['defineProperty'](exports,a371_0x5dd637(0xd1),{'value':!![]}),exports['VeevaVaultController']=void 0x0;function a371_0x39ea(){const _0x525175=['810280ONAynL','length','BaseVeevaError','./utils/salesforce-request.utils','DeployService','prototype','default','../../core','./classes/loggers/logger','then','object','deploy','design:paramtypes','message','temp/veeva/rollback_','retrieveDependency','finally','doSnapshot','fs/promises','Version','apply','Logger','toString','getOwnPropertyDescriptor','createVeevaRequest','makeDir','snapshot','design:returntype','metadata','3882488FLsRIE','SalesforceAuth','DependencyService','design:type','getAuthDetails','getMessages','VeevaAuth','./classes/auth/salesforce-auth','deployFromBranch','FAILURE','AppResponseStatus','param','./services/dependency.service','1253gXOdoi','VeevaVaultController','defineProperty','6orBGXY','767700zjUygb','./services/deploy.service','execute','veeva-vault','71587DkxqBZ','search','rollback','constructor','./classes/auth/veeva-auth','__esModule','decorate','createSalesforceRequest','Controller','1813808RbBLZO','2334qhCuaG','shortid','function','body','306872AkeawY','v1.1','Post','./utils/veeva-request.utils','instanceUrl','./enums/status.enums','(((.+)+)+)+$','SUCCESS'];a371_0x39ea=function(){return _0x525175;};return a371_0x39ea();}const core_1=require(a371_0x5dd637(0xe9)),dependency_service_1=require(a371_0x5dd637(0xc3)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a371_0x5dd637(0xc9)),veeva_request_utils_1=require(a371_0x5dd637(0xdd)),status_enums_1=require(a371_0x5dd637(0xdf)),shortid_1=__importDefault(require(a371_0x5dd637(0xd7))),fs_util_1=require('./utils/fs-util'),logger_1=require(a371_0x5dd637(0xea)),promises_1=require(a371_0x5dd637(0xf4)),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require(a371_0x5dd637(0xe5)),veeva_auth_1=require(a371_0x5dd637(0xd0)),salesforce_auth_1=require(a371_0x5dd637(0xbe)),rollback_service_1=require('./services/rollback.service'),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a371_0x5dd637(0xf3)](_0x44e173){const _0x26271d=a371_0x5dd637,{veevaAuth:_0xfb6b95,timeZone:_0x152fde,attachmentLogId:_0x29f1b3}=_0x44e173;try{const _0xae8470=(0x0,veeva_request_utils_1[_0x26271d(0xfa)])(new veeva_auth_1[(_0x26271d(0xbd))](_0xfb6b95,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x3920b5=await salesforce_auth_1[_0x26271d(0xb8)][_0x26271d(0xbb)](),_0x59e2d7=(0x0,salesforce_request_utils_1[_0x26271d(0xd3)])(new salesforce_auth_1['SalesforceAuth'](_0x3920b5)),_0x13cadf=new logger_1[(_0x26271d(0xf7))](_0x59e2d7,_0x152fde,_0x29f1b3),_0x42917e=new snapshot_service_1['SnapshotService'](_0x44e173,_0x59e2d7,_0xae8470,_0x13cadf);return _0x42917e['execute']()[_0x26271d(0xeb)](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x26271d(0xe1)]};}catch(_0x3263e9){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x26271d(0xc0)],'responseMessage':_0x3263e9[_0x26271d(0xef)]};}}async[a371_0x5dd637(0xbf)](_0x55eaa4){const _0x2fc86c=a371_0x5dd637,{veevaAuth:_0x22fdba,timeZone:_0x5049fd,attachmentLogId:_0x27becb}=_0x55eaa4;try{const _0x26d7ca=(0x0,veeva_request_utils_1[_0x2fc86c(0xfa)])(new veeva_auth_1['VeevaAuth'](_0x22fdba,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x534605=await salesforce_auth_1[_0x2fc86c(0xb8)][_0x2fc86c(0xbb)](),_0x3d8f4d=(0x0,salesforce_request_utils_1[_0x2fc86c(0xd3)])(new salesforce_auth_1[(_0x2fc86c(0xb8))](_0x534605)),_0x3823da=new logger_1[(_0x2fc86c(0xf7))](_0x3d8f4d,_0x5049fd,_0x27becb),_0xa47206='temp/veeva/deploy_'+(0x0,shortid_1[_0x2fc86c(0xe8)])();await(0x0,fs_util_1['makeDir'])(_0xa47206);const _0x38b0df=new deploy_service_1[(_0x2fc86c(0xe6))](_0x55eaa4,_0x3d8f4d,_0x26d7ca,_0x3823da,_0xa47206,_0x534605[_0x2fc86c(0xde)]);return _0x38b0df[_0x2fc86c(0xca)]()[_0x2fc86c(0xf2)](()=>(0x0,promises_1['rm'])(_0xa47206,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x2fc86c(0xc1)][_0x2fc86c(0xe1)]};}catch(_0x56e036){return{'responseStatus':status_enums_1[_0x2fc86c(0xc1)][_0x2fc86c(0xc0)],'responseMessage':_0x56e036[_0x2fc86c(0xef)]};}}async[a371_0x5dd637(0xf1)](_0x1e8d9e){const _0x442b45=a371_0x5dd637,{veevaAuth:_0x37c91a}=_0x1e8d9e;try{const _0x46aacd=(0x0,veeva_request_utils_1[_0x442b45(0xfa)])(new veeva_auth_1[(_0x442b45(0xbd))](_0x37c91a)),_0x10daae=await salesforce_auth_1[_0x442b45(0xb8)]['getAuthDetails'](),_0x4a1889=(0x0,salesforce_request_utils_1[_0x442b45(0xd3)])(new salesforce_auth_1[(_0x442b45(0xb8))](_0x10daae)),_0x1948a2=new dependency_service_1[(_0x442b45(0xb9))](_0x1e8d9e,_0x4a1889,_0x46aacd);return await _0x1948a2['execute']();}catch(_0x55dda7){const _0x48cf1d=_0x55dda7 instanceof base_veeva_error_1[_0x442b45(0xe4)]?_0x55dda7[_0x442b45(0xbc)]()['join']('\x0a'):_0x55dda7[_0x442b45(0xef)];return{'responseStatus':status_enums_1[_0x442b45(0xc1)][_0x442b45(0xc0)],'responseMessage':_0x48cf1d};}}async[a371_0x5dd637(0xce)](_0x576ecd){const _0x49b229=a371_0x5dd637,{veevaAuth:_0x274035,timeZone:_0x8de89e,attachmentLogId:_0x1a89c7}=_0x576ecd;try{const _0x1f51f1=(0x0,veeva_request_utils_1[_0x49b229(0xfa)])(new veeva_auth_1['VeevaAuth'](_0x274035,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xd4ab33=await salesforce_auth_1[_0x49b229(0xb8)]['getAuthDetails'](),_0xdfc61b=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x49b229(0xb8))](_0xd4ab33)),_0x2df408=new logger_1['Logger'](_0xdfc61b,_0x8de89e,_0x1a89c7),_0x57fa49=_0x49b229(0xf0)+(0x0,shortid_1[_0x49b229(0xe8)])();await(0x0,fs_util_1[_0x49b229(0xfb)])(_0x57fa49);const _0x5e5437=new rollback_service_1['RollbackService']({..._0x576ecd,'connectionVeeva':_0x1f51f1,'connectionSalesforce':_0xdfc61b,'logger':_0x2df408,'tempFolder':_0x57fa49,'instanceUrl':_0xd4ab33[_0x49b229(0xde)]});return _0x5e5437[_0x49b229(0xca)]()['finally'](()=>(0x0,promises_1['rm'])(_0x57fa49,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x49b229(0xc1)][_0x49b229(0xe1)]};}catch(_0xe891a5){return{'responseStatus':status_enums_1[_0x49b229(0xc1)][_0x49b229(0xc0)],'responseMessage':_0xe891a5['message']};}}};__decorate([(0x0,core_1[a371_0x5dd637(0xdc)])(a371_0x5dd637(0xb4)),__param(0x0,core_1['param'][a371_0x5dd637(0xd9)]()),__metadata(a371_0x5dd637(0xba),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x5dd637(0xe7)],'doSnapshot',null),__decorate([(0x0,core_1[a371_0x5dd637(0xdc)])(a371_0x5dd637(0xed)),__param(0x0,core_1[a371_0x5dd637(0xc2)][a371_0x5dd637(0xd9)]()),__metadata(a371_0x5dd637(0xba),Function),__metadata(a371_0x5dd637(0xee),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x5dd637(0xe7)],a371_0x5dd637(0xbf),null),__decorate([(0x0,core_1[a371_0x5dd637(0xdc)])('dependency'),__param(0x0,core_1['param']['body']()),__metadata(a371_0x5dd637(0xba),Function),__metadata(a371_0x5dd637(0xee),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x5dd637(0xe7)],'retrieveDependency',null),__decorate([(0x0,core_1['Post'])(a371_0x5dd637(0xce)),__param(0x0,core_1[a371_0x5dd637(0xc2)]['body']()),__metadata('design:type',Function),__metadata(a371_0x5dd637(0xee),[Object]),__metadata(a371_0x5dd637(0xb5),Promise)],VeevaVaultController[a371_0x5dd637(0xe7)],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a371_0x5dd637(0xd4)])(a371_0x5dd637(0xcb)),(0x0,core_1[a371_0x5dd637(0xf5)])(a371_0x5dd637(0xdb))],VeevaVaultController),exports[a371_0x5dd637(0xc5)]=VeevaVaultController;