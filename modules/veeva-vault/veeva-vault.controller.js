const a416_0x1de31a=a416_0xabdf;(function(_0x5e8a90,_0x930363){const _0x36b9d6=a416_0xabdf,_0x5c678f=_0x5e8a90();while(!![]){try{const _0x3191c3=parseInt(_0x36b9d6(0x1eb))/0x1*(parseInt(_0x36b9d6(0x218))/0x2)+parseInt(_0x36b9d6(0x21e))/0x3*(-parseInt(_0x36b9d6(0x1e4))/0x4)+-parseInt(_0x36b9d6(0x1fa))/0x5+-parseInt(_0x36b9d6(0x1e8))/0x6+parseInt(_0x36b9d6(0x1ff))/0x7*(-parseInt(_0x36b9d6(0x205))/0x8)+-parseInt(_0x36b9d6(0x227))/0x9*(parseInt(_0x36b9d6(0x1e9))/0xa)+parseInt(_0x36b9d6(0x20b))/0xb*(parseInt(_0x36b9d6(0x225))/0xc);if(_0x3191c3===_0x930363)break;else _0x5c678f['push'](_0x5c678f['shift']());}catch(_0x40cddf){_0x5c678f['push'](_0x5c678f['shift']());}}}(a416_0x23a4,0x3ef40));const a416_0x114bbc=(function(){let _0x11c66d=!![];return function(_0x1e61ca,_0x31d60d){const _0x1989da=_0x11c66d?function(){const _0x9781ef=a416_0xabdf;if(_0x31d60d){const _0x350e5e=_0x31d60d[_0x9781ef(0x203)](_0x1e61ca,arguments);return _0x31d60d=null,_0x350e5e;}}:function(){};return _0x11c66d=![],_0x1989da;};}()),a416_0x5125c2=a416_0x114bbc(this,function(){const _0x2dbeb5=a416_0xabdf;return a416_0x5125c2[_0x2dbeb5(0x214)]()[_0x2dbeb5(0x211)](_0x2dbeb5(0x215))[_0x2dbeb5(0x214)]()[_0x2dbeb5(0x21c)](a416_0x5125c2)[_0x2dbeb5(0x211)]('(((.+)+)+)+$');});a416_0x5125c2();function a416_0x23a4(){const _0x14558d=['join','design:paramtypes','finally','apply','Logger','757360MsDdKo','deploy','FAILURE','./services/snapshot.service','makeDir','prototype','16571665zjbQDs','./services/dependency.service','function','./services/rollback.service','./classes/loggers/logger','RollbackService','search','deployFromBranch','default','toString','(((.+)+)+)+$','object','length','189496zYDduf','AppResponseStatus','__decorate','v1.1','constructor','./services/deploy.service','26745KzlWDZ','snapshot','./utils/veeva-request.utils','createVeevaRequest','instanceUrl','dependency','createSalesforceRequest','12RHHjXp','rollback','3771eJPdnM','design:type','DependencyService','veeva-vault','VeevaAuth','DeployService','doSnapshot','164fRshqJ','SnapshotService','execute','BaseVeevaError','1791606mzdleU','2690iRmbVq','getAuthDetails','3VycSvo','decorate','metadata','design:returntype','fs/promises','./classes/errors/base-veeva-error','SalesforceAuth','defineProperty','__esModule','Controller','VeevaVaultController','param','./classes/auth/veeva-auth','./utils/salesforce-request.utils','SUCCESS','1886980mLjIpU','Post','body','message','retrieveDependency','28hGWzYr'];a416_0x23a4=function(){return _0x14558d;};return a416_0x23a4();}'use strict';function a416_0xabdf(_0x1295bd,_0x3afdb5){const _0x39c3eb=a416_0x23a4();return a416_0xabdf=function(_0x5125c2,_0x114bbc){_0x5125c2=_0x5125c2-0x1df;let _0x23a43f=_0x39c3eb[_0x5125c2];return _0x23a43f;},a416_0xabdf(_0x1295bd,_0x3afdb5);}var __decorate=this&&this[a416_0x1de31a(0x21a)]||function(_0x26b371,_0x5b63b2,_0x573293,_0x833c3b){const _0x3e2989=a416_0x1de31a;var _0x5d4f39=arguments[_0x3e2989(0x217)],_0x19514a=_0x5d4f39<0x3?_0x5b63b2:_0x833c3b===null?_0x833c3b=Object['getOwnPropertyDescriptor'](_0x5b63b2,_0x573293):_0x833c3b,_0x5f1b5d;if(typeof Reflect===_0x3e2989(0x216)&&typeof Reflect[_0x3e2989(0x1ec)]===_0x3e2989(0x20d))_0x19514a=Reflect[_0x3e2989(0x1ec)](_0x26b371,_0x5b63b2,_0x573293,_0x833c3b);else{for(var _0x2d59d6=_0x26b371[_0x3e2989(0x217)]-0x1;_0x2d59d6>=0x0;_0x2d59d6--)if(_0x5f1b5d=_0x26b371[_0x2d59d6])_0x19514a=(_0x5d4f39<0x3?_0x5f1b5d(_0x19514a):_0x5d4f39>0x3?_0x5f1b5d(_0x5b63b2,_0x573293,_0x19514a):_0x5f1b5d(_0x5b63b2,_0x573293))||_0x19514a;}return _0x5d4f39>0x3&&_0x19514a&&Object['defineProperty'](_0x5b63b2,_0x573293,_0x19514a),_0x19514a;},__metadata=this&&this['__metadata']||function(_0x3b0b93,_0x3d4973){const _0x1ab725=a416_0x1de31a;if(typeof Reflect===_0x1ab725(0x216)&&typeof Reflect[_0x1ab725(0x1ed)]===_0x1ab725(0x20d))return Reflect[_0x1ab725(0x1ed)](_0x3b0b93,_0x3d4973);},__param=this&&this['__param']||function(_0x3ee198,_0x3a8557){return function(_0x452dfd,_0xcbdf0c){_0x3a8557(_0x452dfd,_0xcbdf0c,_0x3ee198);};},__importDefault=this&&this['__importDefault']||function(_0x126e26){const _0x362b73=a416_0x1de31a;return _0x126e26&&_0x126e26[_0x362b73(0x1f3)]?_0x126e26:{'default':_0x126e26};};Object[a416_0x1de31a(0x1f2)](exports,a416_0x1de31a(0x1f3),{'value':!![]}),exports[a416_0x1de31a(0x1f5)]=void 0x0;const core_1=require('../../core'),dependency_service_1=require(a416_0x1de31a(0x20c)),snapshot_service_1=require(a416_0x1de31a(0x208)),deploy_service_1=require(a416_0x1de31a(0x21d)),veeva_request_utils_1=require(a416_0x1de31a(0x220)),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require('shortid')),fs_util_1=require('./utils/fs-util'),logger_1=require(a416_0x1de31a(0x20f)),promises_1=require(a416_0x1de31a(0x1ef)),base_veeva_error_1=require(a416_0x1de31a(0x1f0)),salesforce_request_utils_1=require(a416_0x1de31a(0x1f8)),veeva_auth_1=require(a416_0x1de31a(0x1f7)),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require(a416_0x1de31a(0x20e)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a416_0x1de31a(0x1e3)](_0x5cb750){const _0x4abfd7=a416_0x1de31a,{veevaAuth:_0x536e83,timeZone:_0x157c34,attachmentLogId:_0x3070a3}=_0x5cb750;try{const _0x4bb4e0=(0x0,veeva_request_utils_1[_0x4abfd7(0x221)])(new veeva_auth_1['VeevaAuth'](_0x536e83,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5c3706=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x43ad7c=(0x0,salesforce_request_utils_1[_0x4abfd7(0x224)])(new salesforce_auth_1['SalesforceAuth'](_0x5c3706)),_0x51fa51=new logger_1[(_0x4abfd7(0x204))](_0x43ad7c,_0x157c34,_0x3070a3),_0x182bbb=new snapshot_service_1[(_0x4abfd7(0x1e5))](_0x5cb750,_0x43ad7c,_0x4bb4e0,_0x51fa51);return _0x182bbb[_0x4abfd7(0x1e6)]()['then'](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x4abfd7(0x1f9)]};}catch(_0x10b41b){return{'responseStatus':status_enums_1[_0x4abfd7(0x219)][_0x4abfd7(0x207)],'responseMessage':_0x10b41b[_0x4abfd7(0x1fd)]};}}async['deployFromBranch'](_0x400459){const _0xc259f7=a416_0x1de31a,{veevaAuth:_0xda1a99,timeZone:_0x4b3f30,attachmentLogId:_0x59f9d4}=_0x400459;try{const _0x3a6caf=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0xc259f7(0x1e1))](_0xda1a99,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2e4ae1=await salesforce_auth_1['SalesforceAuth'][_0xc259f7(0x1ea)](),_0x4a30c3=(0x0,salesforce_request_utils_1[_0xc259f7(0x224)])(new salesforce_auth_1['SalesforceAuth'](_0x2e4ae1)),_0x354224=new logger_1[(_0xc259f7(0x204))](_0x4a30c3,_0x4b3f30,_0x59f9d4),_0x209b14='temp/veeva/deploy_'+(0x0,shortid_1[_0xc259f7(0x213)])();await(0x0,fs_util_1['makeDir'])(_0x209b14);const _0x5eabc9=new deploy_service_1[(_0xc259f7(0x1e2))](_0x400459,_0x4a30c3,_0x3a6caf,_0x354224,_0x209b14,_0x2e4ae1['instanceUrl']);return _0x5eabc9[_0xc259f7(0x1e6)]()[_0xc259f7(0x202)](()=>(0x0,promises_1['rm'])(_0x209b14,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0xc259f7(0x219)]['SUCCESS']};}catch(_0x400a18){return{'responseStatus':status_enums_1[_0xc259f7(0x219)][_0xc259f7(0x207)],'responseMessage':_0x400a18[_0xc259f7(0x1fd)]};}}async[a416_0x1de31a(0x1fe)](_0xfa108e){const _0x7ba38c=a416_0x1de31a,{veevaAuth:_0x336f39}=_0xfa108e;try{const _0x5776eb=(0x0,veeva_request_utils_1[_0x7ba38c(0x221)])(new veeva_auth_1[(_0x7ba38c(0x1e1))](_0x336f39)),_0x2c2419=await salesforce_auth_1[_0x7ba38c(0x1f1)]['getAuthDetails'](),_0x14bd75=(0x0,salesforce_request_utils_1[_0x7ba38c(0x224)])(new salesforce_auth_1[(_0x7ba38c(0x1f1))](_0x2c2419)),_0x30f27c=new dependency_service_1[(_0x7ba38c(0x1df))](_0xfa108e,_0x14bd75,_0x5776eb);return await _0x30f27c[_0x7ba38c(0x1e6)]();}catch(_0x4992a9){const _0x696be4=_0x4992a9 instanceof base_veeva_error_1[_0x7ba38c(0x1e7)]?_0x4992a9['getMessages']()[_0x7ba38c(0x200)]('\x0a'):_0x4992a9[_0x7ba38c(0x1fd)];return{'responseStatus':status_enums_1[_0x7ba38c(0x219)][_0x7ba38c(0x207)],'responseMessage':_0x696be4};}}async[a416_0x1de31a(0x226)](_0x5d93c3){const _0x38e60a=a416_0x1de31a,{veevaAuth:_0xbb95b,timeZone:_0x490744,attachmentLogId:_0x55b0fd}=_0x5d93c3;try{const _0x41e6c0=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x38e60a(0x1e1))](_0xbb95b,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x139889=await salesforce_auth_1[_0x38e60a(0x1f1)]['getAuthDetails'](),_0x4fe31d=(0x0,salesforce_request_utils_1[_0x38e60a(0x224)])(new salesforce_auth_1[(_0x38e60a(0x1f1))](_0x139889)),_0x4c8abd=new logger_1[(_0x38e60a(0x204))](_0x4fe31d,_0x490744,_0x55b0fd),_0x4726f6='temp/veeva/rollback_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x38e60a(0x209)])(_0x4726f6);const _0x34960a=new rollback_service_1[(_0x38e60a(0x210))]({..._0x5d93c3,'connectionVeeva':_0x41e6c0,'connectionSalesforce':_0x4fe31d,'logger':_0x4c8abd,'tempFolder':_0x4726f6,'instanceUrl':_0x139889[_0x38e60a(0x222)]});return _0x34960a['execute']()[_0x38e60a(0x202)](()=>(0x0,promises_1['rm'])(_0x4726f6,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x38e60a(0x219)][_0x38e60a(0x1f9)]};}catch(_0x529053){return{'responseStatus':status_enums_1[_0x38e60a(0x219)][_0x38e60a(0x207)],'responseMessage':_0x529053['message']};}}};__decorate([(0x0,core_1['Post'])(a416_0x1de31a(0x21f)),__param(0x0,core_1[a416_0x1de31a(0x1f6)][a416_0x1de31a(0x1fc)]()),__metadata(a416_0x1de31a(0x228),Function),__metadata(a416_0x1de31a(0x201),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a416_0x1de31a(0x20a)],a416_0x1de31a(0x1e3),null),__decorate([(0x0,core_1['Post'])(a416_0x1de31a(0x206)),__param(0x0,core_1[a416_0x1de31a(0x1f6)][a416_0x1de31a(0x1fc)]()),__metadata('design:type',Function),__metadata(a416_0x1de31a(0x201),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a416_0x1de31a(0x20a)],a416_0x1de31a(0x212),null),__decorate([(0x0,core_1[a416_0x1de31a(0x1fb)])(a416_0x1de31a(0x223)),__param(0x0,core_1['param'][a416_0x1de31a(0x1fc)]()),__metadata(a416_0x1de31a(0x228),Function),__metadata(a416_0x1de31a(0x201),[Object]),__metadata(a416_0x1de31a(0x1ee),Promise)],VeevaVaultController[a416_0x1de31a(0x20a)],'retrieveDependency',null),__decorate([(0x0,core_1['Post'])('rollback'),__param(0x0,core_1['param'][a416_0x1de31a(0x1fc)]()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata(a416_0x1de31a(0x1ee),Promise)],VeevaVaultController[a416_0x1de31a(0x20a)],a416_0x1de31a(0x226),null),VeevaVaultController=__decorate([(0x0,core_1[a416_0x1de31a(0x1f4)])(a416_0x1de31a(0x1e0)),(0x0,core_1['Version'])(a416_0x1de31a(0x21b))],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;