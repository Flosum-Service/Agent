const a414_0xe8443b=a414_0x228a;(function(_0x282e4e,_0x125736){const _0x5afb3d=a414_0x228a,_0x4759ca=_0x282e4e();while(!![]){try{const _0x385eab=parseInt(_0x5afb3d(0x16e))/0x1*(-parseInt(_0x5afb3d(0x189))/0x2)+parseInt(_0x5afb3d(0x180))/0x3*(-parseInt(_0x5afb3d(0x18a))/0x4)+parseInt(_0x5afb3d(0x17b))/0x5*(parseInt(_0x5afb3d(0x17e))/0x6)+-parseInt(_0x5afb3d(0x14e))/0x7*(parseInt(_0x5afb3d(0x15f))/0x8)+-parseInt(_0x5afb3d(0x164))/0x9*(parseInt(_0x5afb3d(0x174))/0xa)+-parseInt(_0x5afb3d(0x185))/0xb+parseInt(_0x5afb3d(0x178))/0xc;if(_0x385eab===_0x125736)break;else _0x4759ca['push'](_0x4759ca['shift']());}catch(_0x5f07aa){_0x4759ca['push'](_0x4759ca['shift']());}}}(a414_0x8213,0xa89de));function a414_0x228a(_0x2da993,_0xe0a47c){const _0x44d2fd=a414_0x8213();return a414_0x228a=function(_0x34f5d9,_0x1120c1){_0x34f5d9=_0x34f5d9-0x144;let _0x8213a0=_0x44d2fd[_0x34f5d9];return _0x8213a0;},a414_0x228a(_0x2da993,_0xe0a47c);}const a414_0x1120c1=(function(){let _0x3b947e=!![];return function(_0x3b95a1,_0x4be3b1){const _0xd9aabd=_0x3b947e?function(){if(_0x4be3b1){const _0x4bbffa=_0x4be3b1['apply'](_0x3b95a1,arguments);return _0x4be3b1=null,_0x4bbffa;}}:function(){};return _0x3b947e=![],_0xd9aabd;};}()),a414_0x34f5d9=a414_0x1120c1(this,function(){const _0x34dac7=a414_0x228a;return a414_0x34f5d9[_0x34dac7(0x148)]()[_0x34dac7(0x147)](_0x34dac7(0x160))['toString']()[_0x34dac7(0x163)](a414_0x34f5d9)[_0x34dac7(0x147)](_0x34dac7(0x160));});a414_0x34f5d9();'use strict';var __decorate=this&&this['__decorate']||function(_0x2f47dd,_0x2d077d,_0x320dde,_0x24534f){const _0x44ba37=a414_0x228a;var _0x598c62=arguments[_0x44ba37(0x17f)],_0x2087f7=_0x598c62<0x3?_0x2d077d:_0x24534f===null?_0x24534f=Object[_0x44ba37(0x177)](_0x2d077d,_0x320dde):_0x24534f,_0x5eb40b;if(typeof Reflect===_0x44ba37(0x152)&&typeof Reflect[_0x44ba37(0x17d)]===_0x44ba37(0x146))_0x2087f7=Reflect[_0x44ba37(0x17d)](_0x2f47dd,_0x2d077d,_0x320dde,_0x24534f);else{for(var _0x1ffcda=_0x2f47dd['length']-0x1;_0x1ffcda>=0x0;_0x1ffcda--)if(_0x5eb40b=_0x2f47dd[_0x1ffcda])_0x2087f7=(_0x598c62<0x3?_0x5eb40b(_0x2087f7):_0x598c62>0x3?_0x5eb40b(_0x2d077d,_0x320dde,_0x2087f7):_0x5eb40b(_0x2d077d,_0x320dde))||_0x2087f7;}return _0x598c62>0x3&&_0x2087f7&&Object[_0x44ba37(0x172)](_0x2d077d,_0x320dde,_0x2087f7),_0x2087f7;},__metadata=this&&this['__metadata']||function(_0x13cdd6,_0x417970){const _0x1acaa5=a414_0x228a;if(typeof Reflect===_0x1acaa5(0x152)&&typeof Reflect['metadata']===_0x1acaa5(0x146))return Reflect[_0x1acaa5(0x15c)](_0x13cdd6,_0x417970);},__param=this&&this[a414_0xe8443b(0x181)]||function(_0x8f8f9e,_0x333e13){return function(_0x29af97,_0x31c2f3){_0x333e13(_0x29af97,_0x31c2f3,_0x8f8f9e);};},__importDefault=this&&this[a414_0xe8443b(0x16d)]||function(_0x3cad9c){const _0x3f879c=a414_0xe8443b;return _0x3cad9c&&_0x3cad9c[_0x3f879c(0x151)]?_0x3cad9c:{'default':_0x3cad9c};};Object[a414_0xe8443b(0x172)](exports,a414_0xe8443b(0x151),{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require('../../core'),dependency_service_1=require(a414_0xe8443b(0x15b)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a414_0xe8443b(0x153)),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a414_0xe8443b(0x187)),shortid_1=__importDefault(require(a414_0xe8443b(0x162))),fs_util_1=require(a414_0xe8443b(0x15d)),logger_1=require('./classes/loggers/logger'),promises_1=require(a414_0xe8443b(0x166)),base_veeva_error_1=require(a414_0xe8443b(0x173)),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a414_0xe8443b(0x155)),rollback_service_1=require('./services/rollback.service'),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a414_0xe8443b(0x171)](_0x38f7eb){const _0x11fc3b=a414_0xe8443b,{veevaAuth:_0x582581,timeZone:_0x9e60d,attachmentLogId:_0x30e354}=_0x38f7eb;try{const _0x39517b=(0x0,veeva_request_utils_1[_0x11fc3b(0x14d)])(new veeva_auth_1[(_0x11fc3b(0x169))](_0x582581,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x3cf7d5=await salesforce_auth_1['SalesforceAuth'][_0x11fc3b(0x14c)](),_0x4997e4=(0x0,salesforce_request_utils_1[_0x11fc3b(0x161)])(new salesforce_auth_1['SalesforceAuth'](_0x3cf7d5)),_0x3c03ec=new logger_1[(_0x11fc3b(0x145))](_0x4997e4,_0x9e60d,_0x30e354),_0x55fe54=new snapshot_service_1[(_0x11fc3b(0x183))](_0x38f7eb,_0x4997e4,_0x39517b,_0x3c03ec);return _0x55fe54['execute']()[_0x11fc3b(0x16f)](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x11fc3b(0x167)]};}catch(_0xd2d563){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x11fc3b(0x14a)],'responseMessage':_0xd2d563['message']};}}async[a414_0xe8443b(0x179)](_0x4def44){const _0x4aadcc=a414_0xe8443b,{veevaAuth:_0x34d38a,timeZone:_0x39eef7,attachmentLogId:_0x558290}=_0x4def44;try{const _0x37e782=(0x0,veeva_request_utils_1[_0x4aadcc(0x14d)])(new veeva_auth_1[(_0x4aadcc(0x169))](_0x34d38a,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x32640a=await salesforce_auth_1[_0x4aadcc(0x14b)][_0x4aadcc(0x14c)](),_0x46d2f8=(0x0,salesforce_request_utils_1[_0x4aadcc(0x161)])(new salesforce_auth_1[(_0x4aadcc(0x14b))](_0x32640a)),_0x1b0d7c=new logger_1[(_0x4aadcc(0x145))](_0x46d2f8,_0x39eef7,_0x558290),_0x5ec749='temp/veeva/deploy_'+(0x0,shortid_1[_0x4aadcc(0x14f)])();await(0x0,fs_util_1[_0x4aadcc(0x17c)])(_0x5ec749);const _0x2457d1=new deploy_service_1[(_0x4aadcc(0x15a))](_0x4def44,_0x46d2f8,_0x37e782,_0x1b0d7c,_0x5ec749,_0x32640a['instanceUrl']);return _0x2457d1[_0x4aadcc(0x16b)]()[_0x4aadcc(0x150)](()=>(0x0,promises_1['rm'])(_0x5ec749,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x4aadcc(0x175)][_0x4aadcc(0x167)]};}catch(_0xd96c3b){return{'responseStatus':status_enums_1[_0x4aadcc(0x175)][_0x4aadcc(0x14a)],'responseMessage':_0xd96c3b[_0x4aadcc(0x176)]};}}async[a414_0xe8443b(0x157)](_0x3fc857){const _0x227dda=a414_0xe8443b,{veevaAuth:_0x512e53}=_0x3fc857;try{const _0x30d4d4=(0x0,veeva_request_utils_1[_0x227dda(0x14d)])(new veeva_auth_1[(_0x227dda(0x169))](_0x512e53)),_0x42f19c=await salesforce_auth_1[_0x227dda(0x14b)][_0x227dda(0x14c)](),_0x3a44ff=(0x0,salesforce_request_utils_1[_0x227dda(0x161)])(new salesforce_auth_1['SalesforceAuth'](_0x42f19c)),_0x496640=new dependency_service_1['DependencyService'](_0x3fc857,_0x3a44ff,_0x30d4d4);return await _0x496640[_0x227dda(0x16b)]();}catch(_0x36bf7d){const _0x56ee91=_0x36bf7d instanceof base_veeva_error_1[_0x227dda(0x168)]?_0x36bf7d[_0x227dda(0x186)]()[_0x227dda(0x158)]('\x0a'):_0x36bf7d[_0x227dda(0x176)];return{'responseStatus':status_enums_1[_0x227dda(0x175)][_0x227dda(0x14a)],'responseMessage':_0x56ee91};}}async[a414_0xe8443b(0x16a)](_0x359089){const _0x34dd5c=a414_0xe8443b,{veevaAuth:_0x45c7dc,timeZone:_0x251920,attachmentLogId:_0x29fbfc}=_0x359089;try{const _0x2812e6=(0x0,veeva_request_utils_1[_0x34dd5c(0x14d)])(new veeva_auth_1['VeevaAuth'](_0x45c7dc,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2d43f9=await salesforce_auth_1[_0x34dd5c(0x14b)][_0x34dd5c(0x14c)](),_0x2fc938=(0x0,salesforce_request_utils_1[_0x34dd5c(0x161)])(new salesforce_auth_1[(_0x34dd5c(0x14b))](_0x2d43f9)),_0x59565e=new logger_1['Logger'](_0x2fc938,_0x251920,_0x29fbfc),_0x5ecf78=_0x34dd5c(0x149)+(0x0,shortid_1[_0x34dd5c(0x14f)])();await(0x0,fs_util_1['makeDir'])(_0x5ecf78);const _0x422004=new rollback_service_1[(_0x34dd5c(0x170))]({..._0x359089,'connectionVeeva':_0x2812e6,'connectionSalesforce':_0x2fc938,'logger':_0x59565e,'tempFolder':_0x5ecf78,'instanceUrl':_0x2d43f9['instanceUrl']});return _0x422004['execute']()[_0x34dd5c(0x150)](()=>(0x0,promises_1['rm'])(_0x5ecf78,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x34dd5c(0x175)][_0x34dd5c(0x167)]};}catch(_0x180a8b){return{'responseStatus':status_enums_1[_0x34dd5c(0x175)][_0x34dd5c(0x14a)],'responseMessage':_0x180a8b[_0x34dd5c(0x176)]};}}};function a414_0x8213(){const _0x488c73=['4102892SHTXsk','dependency','snapshot','Logger','function','search','toString','temp/veeva/rollback_','FAILURE','SalesforceAuth','getAuthDetails','createVeevaRequest','8916019VGXeWi','default','finally','__esModule','object','./services/deploy.service','body','./classes/auth/salesforce-auth','Version','retrieveDependency','join','Post','DeployService','./services/dependency.service','metadata','./utils/fs-util','design:returntype','8SfNaRF','(((.+)+)+)+$','createSalesforceRequest','shortid','constructor','1342323Mhdaqs','design:type','fs/promises','SUCCESS','BaseVeevaError','VeevaAuth','rollback','execute','prototype','__importDefault','92eZAHJv','then','RollbackService','doSnapshot','defineProperty','./classes/errors/base-veeva-error','90VUDnvO','AppResponseStatus','message','getOwnPropertyDescriptor','65073672jcFMFM','deployFromBranch','Controller','15EpvlCS','makeDir','decorate','1046244aWUzEH','length','3oZfSDt','__param','veeva-vault','SnapshotService','design:paramtypes','14255197CGXJxG','getMessages','./enums/status.enums','param','6904JjeTxD'];a414_0x8213=function(){return _0x488c73;};return a414_0x8213();}__decorate([(0x0,core_1[a414_0xe8443b(0x159)])(a414_0xe8443b(0x144)),__param(0x0,core_1[a414_0xe8443b(0x188)]['body']()),__metadata(a414_0xe8443b(0x165),Function),__metadata(a414_0xe8443b(0x184),[Object]),__metadata(a414_0xe8443b(0x15e),Promise)],VeevaVaultController[a414_0xe8443b(0x16c)],a414_0xe8443b(0x171),null),__decorate([(0x0,core_1[a414_0xe8443b(0x159)])('deploy'),__param(0x0,core_1[a414_0xe8443b(0x188)][a414_0xe8443b(0x154)]()),__metadata(a414_0xe8443b(0x165),Function),__metadata(a414_0xe8443b(0x184),[Object]),__metadata(a414_0xe8443b(0x15e),Promise)],VeevaVaultController[a414_0xe8443b(0x16c)],a414_0xe8443b(0x179),null),__decorate([(0x0,core_1['Post'])(a414_0xe8443b(0x18b)),__param(0x0,core_1['param']['body']()),__metadata('design:type',Function),__metadata(a414_0xe8443b(0x184),[Object]),__metadata(a414_0xe8443b(0x15e),Promise)],VeevaVaultController[a414_0xe8443b(0x16c)],a414_0xe8443b(0x157),null),__decorate([(0x0,core_1[a414_0xe8443b(0x159)])(a414_0xe8443b(0x16a)),__param(0x0,core_1[a414_0xe8443b(0x188)]['body']()),__metadata(a414_0xe8443b(0x165),Function),__metadata(a414_0xe8443b(0x184),[Object]),__metadata(a414_0xe8443b(0x15e),Promise)],VeevaVaultController[a414_0xe8443b(0x16c)],a414_0xe8443b(0x16a),null),VeevaVaultController=__decorate([(0x0,core_1[a414_0xe8443b(0x17a)])(a414_0xe8443b(0x182)),(0x0,core_1[a414_0xe8443b(0x156)])('v1.1')],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;