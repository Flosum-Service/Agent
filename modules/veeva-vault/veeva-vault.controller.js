const a363_0x38ec0b=a363_0x3324;(function(_0x177b2a,_0x1abb85){const _0x366a=a363_0x3324,_0x7a0453=_0x177b2a();while(!![]){try{const _0x3572de=parseInt(_0x366a(0x184))/0x1*(parseInt(_0x366a(0x182))/0x2)+-parseInt(_0x366a(0x1c8))/0x3+-parseInt(_0x366a(0x1b5))/0x4+parseInt(_0x366a(0x1c3))/0x5+parseInt(_0x366a(0x1a3))/0x6+-parseInt(_0x366a(0x1b3))/0x7*(-parseInt(_0x366a(0x1aa))/0x8)+parseInt(_0x366a(0x191))/0x9;if(_0x3572de===_0x1abb85)break;else _0x7a0453['push'](_0x7a0453['shift']());}catch(_0xfbce66){_0x7a0453['push'](_0x7a0453['shift']());}}}(a363_0x2dbf,0x8e8d4));const a363_0x56cf75=(function(){let _0x53e88d=!![];return function(_0x7572a7,_0x4b4215){const _0x588dca=_0x53e88d?function(){const _0x3f0bbb=a363_0x3324;if(_0x4b4215){const _0x4140d6=_0x4b4215[_0x3f0bbb(0x189)](_0x7572a7,arguments);return _0x4b4215=null,_0x4140d6;}}:function(){};return _0x53e88d=![],_0x588dca;};}()),a363_0x24b235=a363_0x56cf75(this,function(){const _0x219ad0=a363_0x3324;return a363_0x24b235['toString']()['search']('(((.+)+)+)+$')[_0x219ad0(0x18d)]()[_0x219ad0(0x19f)](a363_0x24b235)[_0x219ad0(0x196)](_0x219ad0(0x198));});function a363_0x2dbf(){const _0x5c407e=['1430889BENuyf','./services/snapshot.service','1484ysnjts','./services/rollback.service','1541gOrBWu','metadata','__importDefault','../../core','rollback','apply','VeevaVaultController','getMessages','doSnapshot','toString','deployFromBranch','object','SalesforceAuth','6390009LLJBxB','./classes/auth/veeva-auth','VeevaAuth','dependency','./classes/errors/base-veeva-error','search','getAuthDetails','(((.+)+)+)+$','__decorate','./utils/fs-util','defineProperty','./utils/salesforce-request.utils','default','then','constructor','Controller','Logger','function','236352ZdQHmN','snapshot','Post','DeployService','temp/veeva/rollback_','shortid','__param','1022976YQlgBd','AppResponseStatus','message','Version','getOwnPropertyDescriptor','./classes/auth/salesforce-auth','design:returntype','makeDir','createVeevaRequest','7kVBPav','param','4620804TxgzeG','createSalesforceRequest','body','v1.1','SUCCESS','length','./services/dependency.service','instanceUrl','deploy','temp/veeva/deploy_','prototype','__esModule','join','design:type','976845sehiHY','./enums/status.enums','FAILURE','design:paramtypes','execute'];a363_0x2dbf=function(){return _0x5c407e;};return a363_0x2dbf();}function a363_0x3324(_0x35f881,_0x12142c){const _0x31a5ae=a363_0x2dbf();return a363_0x3324=function(_0x24b235,_0x56cf75){_0x24b235=_0x24b235-0x182;let _0x2dbf04=_0x31a5ae[_0x24b235];return _0x2dbf04;},a363_0x3324(_0x35f881,_0x12142c);}a363_0x24b235();'use strict';var __decorate=this&&this[a363_0x38ec0b(0x199)]||function(_0x54bc79,_0x2f46b2,_0x5fdef,_0x2c2db2){const _0x243d3f=a363_0x38ec0b;var _0xdd3258=arguments[_0x243d3f(0x1ba)],_0x466cc9=_0xdd3258<0x3?_0x2f46b2:_0x2c2db2===null?_0x2c2db2=Object[_0x243d3f(0x1ae)](_0x2f46b2,_0x5fdef):_0x2c2db2,_0x4c60ed;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x243d3f(0x1a2))_0x466cc9=Reflect['decorate'](_0x54bc79,_0x2f46b2,_0x5fdef,_0x2c2db2);else{for(var _0x3f0125=_0x54bc79[_0x243d3f(0x1ba)]-0x1;_0x3f0125>=0x0;_0x3f0125--)if(_0x4c60ed=_0x54bc79[_0x3f0125])_0x466cc9=(_0xdd3258<0x3?_0x4c60ed(_0x466cc9):_0xdd3258>0x3?_0x4c60ed(_0x2f46b2,_0x5fdef,_0x466cc9):_0x4c60ed(_0x2f46b2,_0x5fdef))||_0x466cc9;}return _0xdd3258>0x3&&_0x466cc9&&Object['defineProperty'](_0x2f46b2,_0x5fdef,_0x466cc9),_0x466cc9;},__metadata=this&&this['__metadata']||function(_0x351fd2,_0xb818c){const _0x18b098=a363_0x38ec0b;if(typeof Reflect===_0x18b098(0x18f)&&typeof Reflect[_0x18b098(0x185)]===_0x18b098(0x1a2))return Reflect[_0x18b098(0x185)](_0x351fd2,_0xb818c);},__param=this&&this[a363_0x38ec0b(0x1a9)]||function(_0x22f47a,_0xb9a898){return function(_0x17bcc0,_0x1c9340){_0xb9a898(_0x17bcc0,_0x1c9340,_0x22f47a);};},__importDefault=this&&this[a363_0x38ec0b(0x186)]||function(_0x39e52e){const _0x1aeba0=a363_0x38ec0b;return _0x39e52e&&_0x39e52e[_0x1aeba0(0x1c0)]?_0x39e52e:{'default':_0x39e52e};};Object[a363_0x38ec0b(0x19b)](exports,a363_0x38ec0b(0x1c0),{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require(a363_0x38ec0b(0x187)),dependency_service_1=require(a363_0x38ec0b(0x1bb)),snapshot_service_1=require(a363_0x38ec0b(0x1c9)),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a363_0x38ec0b(0x1c4)),shortid_1=__importDefault(require(a363_0x38ec0b(0x1a8))),fs_util_1=require(a363_0x38ec0b(0x19a)),logger_1=require('./classes/loggers/logger'),promises_1=require('fs/promises'),base_veeva_error_1=require(a363_0x38ec0b(0x195)),salesforce_request_utils_1=require(a363_0x38ec0b(0x19c)),veeva_auth_1=require(a363_0x38ec0b(0x192)),salesforce_auth_1=require(a363_0x38ec0b(0x1af)),rollback_service_1=require(a363_0x38ec0b(0x183)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a363_0x38ec0b(0x18c)](_0x261e6e){const _0xf8ffb5=a363_0x38ec0b,{veevaAuth:_0x3127cf,timeZone:_0x726c6b,attachmentLogId:_0x2069c3}=_0x261e6e;try{const _0x57288b=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0xf8ffb5(0x193))](_0x3127cf,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2fbb52=await salesforce_auth_1[_0xf8ffb5(0x190)][_0xf8ffb5(0x197)](),_0x44bc7b=(0x0,salesforce_request_utils_1[_0xf8ffb5(0x1b6)])(new salesforce_auth_1[(_0xf8ffb5(0x190))](_0x2fbb52)),_0x58a95a=new logger_1[(_0xf8ffb5(0x1a1))](_0x44bc7b,_0x726c6b,_0x2069c3),_0x38c4ce=new snapshot_service_1['SnapshotService'](_0x261e6e,_0x44bc7b,_0x57288b,_0x58a95a);return _0x38c4ce[_0xf8ffb5(0x1c7)]()[_0xf8ffb5(0x19e)](),{'responseStatus':status_enums_1['AppResponseStatus']['SUCCESS']};}catch(_0xc1e148){return{'responseStatus':status_enums_1['AppResponseStatus'][_0xf8ffb5(0x1c5)],'responseMessage':_0xc1e148['message']};}}async[a363_0x38ec0b(0x18e)](_0x2c6229){const _0x4b8e11=a363_0x38ec0b,{veevaAuth:_0x5a49ec,timeZone:_0x543b3b,attachmentLogId:_0x162f42}=_0x2c6229;try{const _0x568c4c=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x4b8e11(0x193))](_0x5a49ec,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x53d6e7=await salesforce_auth_1[_0x4b8e11(0x190)]['getAuthDetails'](),_0x27b7d3=(0x0,salesforce_request_utils_1[_0x4b8e11(0x1b6)])(new salesforce_auth_1[(_0x4b8e11(0x190))](_0x53d6e7)),_0x28dae3=new logger_1[(_0x4b8e11(0x1a1))](_0x27b7d3,_0x543b3b,_0x162f42),_0x1f3c3c=_0x4b8e11(0x1be)+(0x0,shortid_1[_0x4b8e11(0x19d)])();await(0x0,fs_util_1[_0x4b8e11(0x1b1)])(_0x1f3c3c);const _0x4c5334=new deploy_service_1[(_0x4b8e11(0x1a6))](_0x2c6229,_0x27b7d3,_0x568c4c,_0x28dae3,_0x1f3c3c,_0x53d6e7['instanceUrl']);return _0x4c5334[_0x4b8e11(0x1c7)]()['finally'](()=>(0x0,promises_1['rm'])(_0x1f3c3c,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x4b8e11(0x1ab)][_0x4b8e11(0x1b9)]};}catch(_0x804414){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x4b8e11(0x1c5)],'responseMessage':_0x804414[_0x4b8e11(0x1ac)]};}}async['retrieveDependency'](_0x42fe26){const _0x3e8c7f=a363_0x38ec0b,{veevaAuth:_0x5e0366}=_0x42fe26;try{const _0x2bff24=(0x0,veeva_request_utils_1[_0x3e8c7f(0x1b2)])(new veeva_auth_1[(_0x3e8c7f(0x193))](_0x5e0366)),_0x1ee277=await salesforce_auth_1[_0x3e8c7f(0x190)][_0x3e8c7f(0x197)](),_0x39d284=(0x0,salesforce_request_utils_1[_0x3e8c7f(0x1b6)])(new salesforce_auth_1[(_0x3e8c7f(0x190))](_0x1ee277)),_0x8971f5=new dependency_service_1['DependencyService'](_0x42fe26,_0x39d284,_0x2bff24);return await _0x8971f5[_0x3e8c7f(0x1c7)]();}catch(_0x12fe2f){const _0x8eee07=_0x12fe2f instanceof base_veeva_error_1['BaseVeevaError']?_0x12fe2f[_0x3e8c7f(0x18b)]()[_0x3e8c7f(0x1c1)]('\x0a'):_0x12fe2f['message'];return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x8eee07};}}async[a363_0x38ec0b(0x188)](_0x46f051){const _0x2aa8f3=a363_0x38ec0b,{veevaAuth:_0x52c73d,timeZone:_0x404b1b,attachmentLogId:_0x52157c}=_0x46f051;try{const _0xff2d88=(0x0,veeva_request_utils_1[_0x2aa8f3(0x1b2)])(new veeva_auth_1[(_0x2aa8f3(0x193))](_0x52c73d,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xa5d6f1=await salesforce_auth_1['SalesforceAuth'][_0x2aa8f3(0x197)](),_0x3002c0=(0x0,salesforce_request_utils_1[_0x2aa8f3(0x1b6)])(new salesforce_auth_1[(_0x2aa8f3(0x190))](_0xa5d6f1)),_0x263810=new logger_1[(_0x2aa8f3(0x1a1))](_0x3002c0,_0x404b1b,_0x52157c),_0x177173=_0x2aa8f3(0x1a7)+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x2aa8f3(0x1b1)])(_0x177173);const _0x101475=new rollback_service_1['RollbackService']({..._0x46f051,'connectionVeeva':_0xff2d88,'connectionSalesforce':_0x3002c0,'logger':_0x263810,'tempFolder':_0x177173,'instanceUrl':_0xa5d6f1[_0x2aa8f3(0x1bc)]});return _0x101475[_0x2aa8f3(0x1c7)]()['finally'](()=>(0x0,promises_1['rm'])(_0x177173,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x2aa8f3(0x1b9)]};}catch(_0x196eb7){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x2aa8f3(0x1c5)],'responseMessage':_0x196eb7['message']};}}};__decorate([(0x0,core_1[a363_0x38ec0b(0x1a5)])(a363_0x38ec0b(0x1a4)),__param(0x0,core_1[a363_0x38ec0b(0x1b4)]['body']()),__metadata('design:type',Function),__metadata(a363_0x38ec0b(0x1c6),[Object]),__metadata(a363_0x38ec0b(0x1b0),Promise)],VeevaVaultController[a363_0x38ec0b(0x1bf)],a363_0x38ec0b(0x18c),null),__decorate([(0x0,core_1['Post'])(a363_0x38ec0b(0x1bd)),__param(0x0,core_1[a363_0x38ec0b(0x1b4)][a363_0x38ec0b(0x1b7)]()),__metadata(a363_0x38ec0b(0x1c2),Function),__metadata(a363_0x38ec0b(0x1c6),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a363_0x38ec0b(0x1bf)],a363_0x38ec0b(0x18e),null),__decorate([(0x0,core_1[a363_0x38ec0b(0x1a5)])(a363_0x38ec0b(0x194)),__param(0x0,core_1[a363_0x38ec0b(0x1b4)][a363_0x38ec0b(0x1b7)]()),__metadata('design:type',Function),__metadata(a363_0x38ec0b(0x1c6),[Object]),__metadata(a363_0x38ec0b(0x1b0),Promise)],VeevaVaultController[a363_0x38ec0b(0x1bf)],'retrieveDependency',null),__decorate([(0x0,core_1[a363_0x38ec0b(0x1a5)])(a363_0x38ec0b(0x188)),__param(0x0,core_1[a363_0x38ec0b(0x1b4)]['body']()),__metadata(a363_0x38ec0b(0x1c2),Function),__metadata('design:paramtypes',[Object]),__metadata(a363_0x38ec0b(0x1b0),Promise)],VeevaVaultController['prototype'],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a363_0x38ec0b(0x1a0)])('veeva-vault'),(0x0,core_1[a363_0x38ec0b(0x1ad)])(a363_0x38ec0b(0x1b8))],VeevaVaultController),exports[a363_0x38ec0b(0x18a)]=VeevaVaultController;