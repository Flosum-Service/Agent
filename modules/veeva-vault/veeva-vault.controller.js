const a347_0x31cd59=a347_0x2e18;(function(_0x3487fb,_0x471780){const _0x41e842=a347_0x2e18,_0x4abc3e=_0x3487fb();while(!![]){try{const _0x2e52ee=parseInt(_0x41e842(0x1d2))/0x1+-parseInt(_0x41e842(0x1ef))/0x2+parseInt(_0x41e842(0x1e4))/0x3*(parseInt(_0x41e842(0x1ad))/0x4)+parseInt(_0x41e842(0x1bf))/0x5+-parseInt(_0x41e842(0x1db))/0x6*(parseInt(_0x41e842(0x1b9))/0x7)+-parseInt(_0x41e842(0x1e3))/0x8+-parseInt(_0x41e842(0x1cf))/0x9*(-parseInt(_0x41e842(0x1b4))/0xa);if(_0x2e52ee===_0x471780)break;else _0x4abc3e['push'](_0x4abc3e['shift']());}catch(_0x31878c){_0x4abc3e['push'](_0x4abc3e['shift']());}}}(a347_0x82f1,0x486ca));const a347_0xfbc868=(function(){let _0x58bdcc=!![];return function(_0x4ce65f,_0x5a1ccb){const _0x36f0a8=_0x58bdcc?function(){if(_0x5a1ccb){const _0x49ad19=_0x5a1ccb['apply'](_0x4ce65f,arguments);return _0x5a1ccb=null,_0x49ad19;}}:function(){};return _0x58bdcc=![],_0x36f0a8;};}()),a347_0x57fb22=a347_0xfbc868(this,function(){const _0x1ecb6a=a347_0x2e18;return a347_0x57fb22[_0x1ecb6a(0x1d4)]()[_0x1ecb6a(0x1ce)](_0x1ecb6a(0x1ba))['toString']()['constructor'](a347_0x57fb22)[_0x1ecb6a(0x1ce)](_0x1ecb6a(0x1ba));});a347_0x57fb22();'use strict';function a347_0x2e18(_0x284510,_0x66bc3d){const _0x2b3f02=a347_0x82f1();return a347_0x2e18=function(_0x57fb22,_0xfbc868){_0x57fb22=_0x57fb22-0x1ad;let _0x82f1b2=_0x2b3f02[_0x57fb22];return _0x82f1b2;},a347_0x2e18(_0x284510,_0x66bc3d);}var __decorate=this&&this[a347_0x31cd59(0x1f4)]||function(_0x2226a1,_0x3c0821,_0x73626f,_0x23ed87){const _0x55649f=a347_0x31cd59;var _0x158c71=arguments[_0x55649f(0x1e9)],_0x51804a=_0x158c71<0x3?_0x3c0821:_0x23ed87===null?_0x23ed87=Object[_0x55649f(0x1ec)](_0x3c0821,_0x73626f):_0x23ed87,_0xa9e549;if(typeof Reflect===_0x55649f(0x1f5)&&typeof Reflect['decorate']==='function')_0x51804a=Reflect['decorate'](_0x2226a1,_0x3c0821,_0x73626f,_0x23ed87);else{for(var _0x335095=_0x2226a1[_0x55649f(0x1e9)]-0x1;_0x335095>=0x0;_0x335095--)if(_0xa9e549=_0x2226a1[_0x335095])_0x51804a=(_0x158c71<0x3?_0xa9e549(_0x51804a):_0x158c71>0x3?_0xa9e549(_0x3c0821,_0x73626f,_0x51804a):_0xa9e549(_0x3c0821,_0x73626f))||_0x51804a;}return _0x158c71>0x3&&_0x51804a&&Object['defineProperty'](_0x3c0821,_0x73626f,_0x51804a),_0x51804a;},__metadata=this&&this[a347_0x31cd59(0x1e6)]||function(_0xfcd9aa,_0x41cf06){const _0x5d191a=a347_0x31cd59;if(typeof Reflect===_0x5d191a(0x1f5)&&typeof Reflect['metadata']==='function')return Reflect[_0x5d191a(0x1f2)](_0xfcd9aa,_0x41cf06);},__param=this&&this[a347_0x31cd59(0x1d0)]||function(_0x52299b,_0x73a1c2){return function(_0x55da8b,_0x898ade){_0x73a1c2(_0x55da8b,_0x898ade,_0x52299b);};},__importDefault=this&&this[a347_0x31cd59(0x1ea)]||function(_0x22eb8f){const _0x49b326=a347_0x31cd59;return _0x22eb8f&&_0x22eb8f[_0x49b326(0x1e8)]?_0x22eb8f:{'default':_0x22eb8f};};Object[a347_0x31cd59(0x1c7)](exports,a347_0x31cd59(0x1e8),{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require('../../core'),dependency_service_1=require('./services/dependency.service'),snapshot_service_1=require(a347_0x31cd59(0x1b8)),deploy_service_1=require(a347_0x31cd59(0x1c1)),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a347_0x31cd59(0x1b3)),shortid_1=__importDefault(require(a347_0x31cd59(0x1eb))),fs_util_1=require(a347_0x31cd59(0x1f1)),logger_1=require(a347_0x31cd59(0x1c3)),promises_1=require('fs/promises'),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require(a347_0x31cd59(0x1f3)),veeva_auth_1=require(a347_0x31cd59(0x1d7)),salesforce_auth_1=require(a347_0x31cd59(0x1b1)),rollback_service_1=require('./services/rollback.service'),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a347_0x31cd59(0x1b2)](_0x277f01){const _0x3bc1e2=a347_0x31cd59,{veevaAuth:_0x551cd6,timeZone:_0x23a35d,attachmentLogId:_0x283db2}=_0x277f01;try{const _0x17a802=(0x0,veeva_request_utils_1[_0x3bc1e2(0x1dc)])(new veeva_auth_1[(_0x3bc1e2(0x1c4))](_0x551cd6,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x351fcb=await salesforce_auth_1['SalesforceAuth'][_0x3bc1e2(0x1b5)](),_0x536ddc=(0x0,salesforce_request_utils_1[_0x3bc1e2(0x1da)])(new salesforce_auth_1[(_0x3bc1e2(0x1ed))](_0x351fcb)),_0x4165e1=new logger_1[(_0x3bc1e2(0x1cd))](_0x536ddc,_0x23a35d,_0x283db2),_0x284b41=new snapshot_service_1[(_0x3bc1e2(0x1e7))](_0x277f01,_0x536ddc,_0x17a802,_0x4165e1);return _0x284b41[_0x3bc1e2(0x1e1)]()[_0x3bc1e2(0x1c2)](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x3bc1e2(0x1b6)]};}catch(_0x302b35){return{'responseStatus':status_enums_1[_0x3bc1e2(0x1d8)]['FAILURE'],'responseMessage':_0x302b35['message']};}}async[a347_0x31cd59(0x1d6)](_0x789a2c){const _0x523b34=a347_0x31cd59,{veevaAuth:_0x758b2a,timeZone:_0x1f32e1,attachmentLogId:_0x59555c}=_0x789a2c;try{const _0x7a7254=(0x0,veeva_request_utils_1[_0x523b34(0x1dc)])(new veeva_auth_1['VeevaAuth'](_0x758b2a,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2503e9=await salesforce_auth_1[_0x523b34(0x1ed)][_0x523b34(0x1b5)](),_0x253d81=(0x0,salesforce_request_utils_1[_0x523b34(0x1da)])(new salesforce_auth_1[(_0x523b34(0x1ed))](_0x2503e9)),_0x77fa65=new logger_1['Logger'](_0x253d81,_0x1f32e1,_0x59555c),_0x8c5960=_0x523b34(0x1de)+(0x0,shortid_1[_0x523b34(0x1c8)])();await(0x0,fs_util_1['makeDir'])(_0x8c5960);const _0xe9aa82=new deploy_service_1[(_0x523b34(0x1cc))](_0x789a2c,_0x253d81,_0x7a7254,_0x77fa65,_0x8c5960,_0x2503e9[_0x523b34(0x1b7)]);return _0xe9aa82[_0x523b34(0x1e1)]()[_0x523b34(0x1bc)](()=>(0x0,promises_1['rm'])(_0x8c5960,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x523b34(0x1d8)]['SUCCESS']};}catch(_0x14fac5){return{'responseStatus':status_enums_1[_0x523b34(0x1d8)][_0x523b34(0x1c0)],'responseMessage':_0x14fac5['message']};}}async[a347_0x31cd59(0x1d1)](_0x22d00a){const _0x3380c9=a347_0x31cd59,{veevaAuth:_0x48de3e}=_0x22d00a;try{const _0x26f050=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x3380c9(0x1c4))](_0x48de3e)),_0x2ea188=await salesforce_auth_1[_0x3380c9(0x1ed)][_0x3380c9(0x1b5)](),_0x2a90c5=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0x2ea188)),_0x4614cc=new dependency_service_1[(_0x3380c9(0x1bb))](_0x22d00a,_0x2a90c5,_0x26f050);return await _0x4614cc[_0x3380c9(0x1e1)]();}catch(_0x2460fc){const _0x498337=_0x2460fc instanceof base_veeva_error_1[_0x3380c9(0x1e2)]?_0x2460fc[_0x3380c9(0x1cb)]()[_0x3380c9(0x1b0)]('\x0a'):_0x2460fc[_0x3380c9(0x1f6)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x3380c9(0x1c0)],'responseMessage':_0x498337};}}async[a347_0x31cd59(0x1ca)](_0x24190a){const _0x25f799=a347_0x31cd59,{veevaAuth:_0x45b7df,timeZone:_0x1ce21a,attachmentLogId:_0x4b7dfe}=_0x24190a;try{const _0x2f8d2e=(0x0,veeva_request_utils_1[_0x25f799(0x1dc)])(new veeva_auth_1['VeevaAuth'](_0x45b7df,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5627db=await salesforce_auth_1[_0x25f799(0x1ed)][_0x25f799(0x1b5)](),_0x481384=(0x0,salesforce_request_utils_1[_0x25f799(0x1da)])(new salesforce_auth_1['SalesforceAuth'](_0x5627db)),_0x4c160a=new logger_1[(_0x25f799(0x1cd))](_0x481384,_0x1ce21a,_0x4b7dfe),_0x274f46=_0x25f799(0x1c5)+(0x0,shortid_1[_0x25f799(0x1c8)])();await(0x0,fs_util_1[_0x25f799(0x1e0)])(_0x274f46);const _0x5a7758=new rollback_service_1[(_0x25f799(0x1df))]({..._0x24190a,'connectionVeeva':_0x2f8d2e,'connectionSalesforce':_0x481384,'logger':_0x4c160a,'tempFolder':_0x274f46,'instanceUrl':_0x5627db['instanceUrl']});return _0x5a7758[_0x25f799(0x1e1)]()[_0x25f799(0x1bc)](()=>(0x0,promises_1['rm'])(_0x274f46,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x25f799(0x1d8)]['SUCCESS']};}catch(_0x260258){return{'responseStatus':status_enums_1[_0x25f799(0x1d8)][_0x25f799(0x1c0)],'responseMessage':_0x260258[_0x25f799(0x1f6)]};}}};function a347_0x82f1(){const _0x4c54cb=['retrieveDependency','371395seLaFf','design:returntype','toString','dependency','deployFromBranch','./classes/auth/veeva-auth','AppResponseStatus','VeevaVaultController','createSalesforceRequest','762PgvyFn','createVeevaRequest','Post','temp/veeva/deploy_','RollbackService','makeDir','execute','BaseVeevaError','2755456ifpiCz','654522tjSYmY','veeva-vault','__metadata','SnapshotService','__esModule','length','__importDefault','shortid','getOwnPropertyDescriptor','SalesforceAuth','param','427288zGDkTF','Version','./utils/fs-util','metadata','./utils/salesforce-request.utils','__decorate','object','message','4PCvaWC','body','design:paramtypes','join','./classes/auth/salesforce-auth','doSnapshot','./enums/status.enums','64410vEesUr','getAuthDetails','SUCCESS','instanceUrl','./services/snapshot.service','12943BVpduo','(((.+)+)+)+$','DependencyService','finally','design:type','prototype','1179495cLwyvU','FAILURE','./services/deploy.service','then','./classes/loggers/logger','VeevaAuth','temp/veeva/rollback_','deploy','defineProperty','default','v1.1','rollback','getMessages','DeployService','Logger','search','369nygCew','__param'];a347_0x82f1=function(){return _0x4c54cb;};return a347_0x82f1();}__decorate([(0x0,core_1[a347_0x31cd59(0x1dd)])('snapshot'),__param(0x0,core_1['param'][a347_0x31cd59(0x1ae)]()),__metadata(a347_0x31cd59(0x1bd),Function),__metadata(a347_0x31cd59(0x1af),[Object]),__metadata(a347_0x31cd59(0x1d3),Promise)],VeevaVaultController[a347_0x31cd59(0x1be)],a347_0x31cd59(0x1b2),null),__decorate([(0x0,core_1[a347_0x31cd59(0x1dd)])(a347_0x31cd59(0x1c6)),__param(0x0,core_1[a347_0x31cd59(0x1ee)][a347_0x31cd59(0x1ae)]()),__metadata(a347_0x31cd59(0x1bd),Function),__metadata('design:paramtypes',[Object]),__metadata(a347_0x31cd59(0x1d3),Promise)],VeevaVaultController[a347_0x31cd59(0x1be)],a347_0x31cd59(0x1d6),null),__decorate([(0x0,core_1[a347_0x31cd59(0x1dd)])(a347_0x31cd59(0x1d5)),__param(0x0,core_1[a347_0x31cd59(0x1ee)][a347_0x31cd59(0x1ae)]()),__metadata(a347_0x31cd59(0x1bd),Function),__metadata(a347_0x31cd59(0x1af),[Object]),__metadata(a347_0x31cd59(0x1d3),Promise)],VeevaVaultController['prototype'],a347_0x31cd59(0x1d1),null),__decorate([(0x0,core_1[a347_0x31cd59(0x1dd)])('rollback'),__param(0x0,core_1[a347_0x31cd59(0x1ee)][a347_0x31cd59(0x1ae)]()),__metadata('design:type',Function),__metadata(a347_0x31cd59(0x1af),[Object]),__metadata(a347_0x31cd59(0x1d3),Promise)],VeevaVaultController[a347_0x31cd59(0x1be)],a347_0x31cd59(0x1ca),null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])(a347_0x31cd59(0x1e5)),(0x0,core_1[a347_0x31cd59(0x1f0)])(a347_0x31cd59(0x1c9))],VeevaVaultController),exports[a347_0x31cd59(0x1d9)]=VeevaVaultController;