const a371_0x127203=a371_0x3112;(function(_0x1edd47,_0x284364){const _0x5d1e30=a371_0x3112,_0x22087f=_0x1edd47();while(!![]){try{const _0x53fe63=-parseInt(_0x5d1e30(0xa8))/0x1*(parseInt(_0x5d1e30(0xa0))/0x2)+parseInt(_0x5d1e30(0xcc))/0x3*(parseInt(_0x5d1e30(0xba))/0x4)+parseInt(_0x5d1e30(0xa5))/0x5*(parseInt(_0x5d1e30(0x8c))/0x6)+-parseInt(_0x5d1e30(0xbb))/0x7*(-parseInt(_0x5d1e30(0x91))/0x8)+-parseInt(_0x5d1e30(0xa6))/0x9+parseInt(_0x5d1e30(0xcf))/0xa+-parseInt(_0x5d1e30(0xc5))/0xb*(parseInt(_0x5d1e30(0xaa))/0xc);if(_0x53fe63===_0x284364)break;else _0x22087f['push'](_0x22087f['shift']());}catch(_0x2b9b71){_0x22087f['push'](_0x22087f['shift']());}}}(a371_0x4545,0xa28e1));const a371_0x5501a3=(function(){let _0xdcf555=!![];return function(_0x51b320,_0x35309a){const _0x1209b8=_0xdcf555?function(){if(_0x35309a){const _0x14571b=_0x35309a['apply'](_0x51b320,arguments);return _0x35309a=null,_0x14571b;}}:function(){};return _0xdcf555=![],_0x1209b8;};}()),a371_0x5b796d=a371_0x5501a3(this,function(){const _0x2af747=a371_0x3112;return a371_0x5b796d[_0x2af747(0xb6)]()[_0x2af747(0xb3)]('(((.+)+)+)+$')['toString']()[_0x2af747(0xb1)](a371_0x5b796d)['search'](_0x2af747(0xa7));});function a371_0x4545(){const _0x334141=['15rtjxyF','./services/dependency.service','DependencyService','11597860mCuphB','deployFromBranch','retrieveDependency','default','length','param','join','1452iIfdLq','veeva-vault','createVeevaRequest','__importDefault','./utils/salesforce-request.utils','24yqLkrr','rollback','AppResponseStatus','./classes/errors/base-veeva-error','dependency','Logger','./enums/status.enums','./services/rollback.service','SnapshotService','execute','./classes/auth/veeva-auth','then','BaseVeevaError','./services/snapshot.service','getMessages','6babcsA','__decorate','temp/veeva/deploy_','prototype','design:type','8995ajlCiq','984438pIFNMB','(((.+)+)+)+$','78917SLHrMw','VeevaVaultController','27695004YsyQWO','message','snapshot','Post','__param','instanceUrl','shortid','constructor','SUCCESS','search','body','finally','toString','getAuthDetails','metadata','doSnapshot','415364oWVBYs','2812894RybmZw','deploy','defineProperty','object','createSalesforceRequest','makeDir','v1.1','design:paramtypes','FAILURE','../../core','11QpLhcn','temp/veeva/rollback_','VeevaAuth','function','decorate','__esModule','SalesforceAuth'];a371_0x4545=function(){return _0x334141;};return a371_0x4545();}a371_0x5b796d();'use strict';var __decorate=this&&this[a371_0x127203(0xa1)]||function(_0x43749f,_0x1d110b,_0x56b215,_0x5432bc){const _0x5ebf50=a371_0x127203;var _0x378eb1=arguments[_0x5ebf50(0xd3)],_0x2466fb=_0x378eb1<0x3?_0x1d110b:_0x5432bc===null?_0x5432bc=Object['getOwnPropertyDescriptor'](_0x1d110b,_0x56b215):_0x5432bc,_0x2130a5;if(typeof Reflect===_0x5ebf50(0xbe)&&typeof Reflect['decorate']==='function')_0x2466fb=Reflect[_0x5ebf50(0xc9)](_0x43749f,_0x1d110b,_0x56b215,_0x5432bc);else{for(var _0x5efdba=_0x43749f[_0x5ebf50(0xd3)]-0x1;_0x5efdba>=0x0;_0x5efdba--)if(_0x2130a5=_0x43749f[_0x5efdba])_0x2466fb=(_0x378eb1<0x3?_0x2130a5(_0x2466fb):_0x378eb1>0x3?_0x2130a5(_0x1d110b,_0x56b215,_0x2466fb):_0x2130a5(_0x1d110b,_0x56b215))||_0x2466fb;}return _0x378eb1>0x3&&_0x2466fb&&Object[_0x5ebf50(0xbd)](_0x1d110b,_0x56b215,_0x2466fb),_0x2466fb;},__metadata=this&&this['__metadata']||function(_0x50ef67,_0x421500){const _0x2e8170=a371_0x127203;if(typeof Reflect===_0x2e8170(0xbe)&&typeof Reflect[_0x2e8170(0xb8)]===_0x2e8170(0xc8))return Reflect[_0x2e8170(0xb8)](_0x50ef67,_0x421500);},__param=this&&this[a371_0x127203(0xae)]||function(_0x1d4695,_0x241df0){return function(_0x3b9bd3,_0x4dc633){_0x241df0(_0x3b9bd3,_0x4dc633,_0x1d4695);};},__importDefault=this&&this[a371_0x127203(0x8f)]||function(_0x91e11e){const _0x5698c7=a371_0x127203;return _0x91e11e&&_0x91e11e[_0x5698c7(0xca)]?_0x91e11e:{'default':_0x91e11e};};Object[a371_0x127203(0xbd)](exports,'__esModule',{'value':!![]}),exports[a371_0x127203(0xa9)]=void 0x0;const core_1=require(a371_0x127203(0xc4)),dependency_service_1=require(a371_0x127203(0xcd)),snapshot_service_1=require(a371_0x127203(0x9e)),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a371_0x127203(0x97)),shortid_1=__importDefault(require(a371_0x127203(0xb0))),fs_util_1=require('./utils/fs-util'),logger_1=require('./classes/loggers/logger'),promises_1=require('fs/promises'),base_veeva_error_1=require(a371_0x127203(0x94)),salesforce_request_utils_1=require(a371_0x127203(0x90)),veeva_auth_1=require(a371_0x127203(0x9b)),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require(a371_0x127203(0x98)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;function a371_0x3112(_0x3656c4,_0x52537d){const _0x165e59=a371_0x4545();return a371_0x3112=function(_0x5b796d,_0x5501a3){_0x5b796d=_0x5b796d-0x8a;let _0x454510=_0x165e59[_0x5b796d];return _0x454510;},a371_0x3112(_0x3656c4,_0x52537d);}let VeevaVaultController=class VeevaVaultController{async[a371_0x127203(0xb9)](_0x1317cc){const _0x439cbc=a371_0x127203,{veevaAuth:_0x882b23,timeZone:_0x2134bc,attachmentLogId:_0x11f2c0}=_0x1317cc;try{const _0x2a2b79=(0x0,veeva_request_utils_1[_0x439cbc(0x8e)])(new veeva_auth_1[(_0x439cbc(0xc7))](_0x882b23,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x3206fc=await salesforce_auth_1['SalesforceAuth'][_0x439cbc(0xb7)](),_0x343352=(0x0,salesforce_request_utils_1[_0x439cbc(0xbf)])(new salesforce_auth_1[(_0x439cbc(0xcb))](_0x3206fc)),_0x545a7d=new logger_1[(_0x439cbc(0x96))](_0x343352,_0x2134bc,_0x11f2c0),_0x155796=new snapshot_service_1[(_0x439cbc(0x99))](_0x1317cc,_0x343352,_0x2a2b79,_0x545a7d);return _0x155796[_0x439cbc(0x9a)]()[_0x439cbc(0x9c)](),{'responseStatus':status_enums_1[_0x439cbc(0x93)][_0x439cbc(0xb2)]};}catch(_0x2f5a4e){return{'responseStatus':status_enums_1[_0x439cbc(0x93)]['FAILURE'],'responseMessage':_0x2f5a4e['message']};}}async[a371_0x127203(0xd0)](_0x4d2e0a){const _0x5270d2=a371_0x127203,{veevaAuth:_0x197c42,timeZone:_0x44363f,attachmentLogId:_0xcd0105}=_0x4d2e0a;try{const _0x2c348e=(0x0,veeva_request_utils_1[_0x5270d2(0x8e)])(new veeva_auth_1[(_0x5270d2(0xc7))](_0x197c42,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x4ecba2=await salesforce_auth_1[_0x5270d2(0xcb)]['getAuthDetails'](),_0x574357=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x5270d2(0xcb))](_0x4ecba2)),_0x261c4f=new logger_1[(_0x5270d2(0x96))](_0x574357,_0x44363f,_0xcd0105),_0x8df6d1=_0x5270d2(0xa2)+(0x0,shortid_1[_0x5270d2(0xd2)])();await(0x0,fs_util_1['makeDir'])(_0x8df6d1);const _0x3f2712=new deploy_service_1['DeployService'](_0x4d2e0a,_0x574357,_0x2c348e,_0x261c4f,_0x8df6d1,_0x4ecba2['instanceUrl']);return _0x3f2712[_0x5270d2(0x9a)]()[_0x5270d2(0xb5)](()=>(0x0,promises_1['rm'])(_0x8df6d1,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x5270d2(0x93)][_0x5270d2(0xb2)]};}catch(_0x22b75f){return{'responseStatus':status_enums_1[_0x5270d2(0x93)][_0x5270d2(0xc3)],'responseMessage':_0x22b75f['message']};}}async['retrieveDependency'](_0x17f5ec){const _0x2f99ff=a371_0x127203,{veevaAuth:_0x4a1d3e}=_0x17f5ec;try{const _0x283ddb=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x2f99ff(0xc7))](_0x4a1d3e)),_0x1a2681=await salesforce_auth_1['SalesforceAuth'][_0x2f99ff(0xb7)](),_0x264054=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0x1a2681)),_0x45713b=new dependency_service_1[(_0x2f99ff(0xce))](_0x17f5ec,_0x264054,_0x283ddb);return await _0x45713b[_0x2f99ff(0x9a)]();}catch(_0x1f9392){const _0x326c5a=_0x1f9392 instanceof base_veeva_error_1[_0x2f99ff(0x9d)]?_0x1f9392[_0x2f99ff(0x9f)]()[_0x2f99ff(0x8b)]('\x0a'):_0x1f9392[_0x2f99ff(0xab)];return{'responseStatus':status_enums_1[_0x2f99ff(0x93)][_0x2f99ff(0xc3)],'responseMessage':_0x326c5a};}}async[a371_0x127203(0x92)](_0x4c389e){const _0x597189=a371_0x127203,{veevaAuth:_0x17937c,timeZone:_0x43b04e,attachmentLogId:_0x298b62}=_0x4c389e;try{const _0xb29e93=(0x0,veeva_request_utils_1[_0x597189(0x8e)])(new veeva_auth_1[(_0x597189(0xc7))](_0x17937c,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x4afce0=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x57e823=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0x4afce0)),_0x48af0d=new logger_1[(_0x597189(0x96))](_0x57e823,_0x43b04e,_0x298b62),_0x4f05fd=_0x597189(0xc6)+(0x0,shortid_1[_0x597189(0xd2)])();await(0x0,fs_util_1[_0x597189(0xc0)])(_0x4f05fd);const _0x45ab32=new rollback_service_1['RollbackService']({..._0x4c389e,'connectionVeeva':_0xb29e93,'connectionSalesforce':_0x57e823,'logger':_0x48af0d,'tempFolder':_0x4f05fd,'instanceUrl':_0x4afce0[_0x597189(0xaf)]});return _0x45ab32[_0x597189(0x9a)]()[_0x597189(0xb5)](()=>(0x0,promises_1['rm'])(_0x4f05fd,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x597189(0xb2)]};}catch(_0x2b9aaf){return{'responseStatus':status_enums_1[_0x597189(0x93)][_0x597189(0xc3)],'responseMessage':_0x2b9aaf[_0x597189(0xab)]};}}};__decorate([(0x0,core_1[a371_0x127203(0xad)])(a371_0x127203(0xac)),__param(0x0,core_1[a371_0x127203(0x8a)]['body']()),__metadata(a371_0x127203(0xa4),Function),__metadata(a371_0x127203(0xc2),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x127203(0xa3)],'doSnapshot',null),__decorate([(0x0,core_1[a371_0x127203(0xad)])(a371_0x127203(0xbc)),__param(0x0,core_1['param']['body']()),__metadata('design:type',Function),__metadata(a371_0x127203(0xc2),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a371_0x127203(0xd0),null),__decorate([(0x0,core_1['Post'])(a371_0x127203(0x95)),__param(0x0,core_1[a371_0x127203(0x8a)][a371_0x127203(0xb4)]()),__metadata(a371_0x127203(0xa4),Function),__metadata(a371_0x127203(0xc2),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x127203(0xa3)],a371_0x127203(0xd1),null),__decorate([(0x0,core_1[a371_0x127203(0xad)])(a371_0x127203(0x92)),__param(0x0,core_1[a371_0x127203(0x8a)]['body']()),__metadata(a371_0x127203(0xa4),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x127203(0xa3)],a371_0x127203(0x92),null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])(a371_0x127203(0x8d)),(0x0,core_1['Version'])(a371_0x127203(0xc1))],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;