const a414_0x441142=a414_0x2155;(function(_0x1711a3,_0x2b4bef){const _0x5a57b8=a414_0x2155,_0x55f91c=_0x1711a3();while(!![]){try{const _0x5c96ad=-parseInt(_0x5a57b8(0xd2))/0x1+parseInt(_0x5a57b8(0xb0))/0x2+parseInt(_0x5a57b8(0xbc))/0x3*(parseInt(_0x5a57b8(0xb8))/0x4)+parseInt(_0x5a57b8(0xb1))/0x5+-parseInt(_0x5a57b8(0xaa))/0x6+parseInt(_0x5a57b8(0xa2))/0x7*(-parseInt(_0x5a57b8(0xcd))/0x8)+-parseInt(_0x5a57b8(0xc8))/0x9;if(_0x5c96ad===_0x2b4bef)break;else _0x55f91c['push'](_0x55f91c['shift']());}catch(_0x27026a){_0x55f91c['push'](_0x55f91c['shift']());}}}(a414_0x10a9,0x35597));function a414_0x2155(_0x42e396,_0x114c3d){const _0x1ac030=a414_0x10a9();return a414_0x2155=function(_0x5a1ecd,_0x5c1a1d){_0x5a1ecd=_0x5a1ecd-0x96;let _0x10a943=_0x1ac030[_0x5a1ecd];return _0x10a943;},a414_0x2155(_0x42e396,_0x114c3d);}const a414_0x5c1a1d=(function(){let _0x53e3dd=!![];return function(_0x1d491f,_0x34e501){const _0x128556=_0x53e3dd?function(){const _0x4ae583=a414_0x2155;if(_0x34e501){const _0x4fc815=_0x34e501[_0x4ae583(0x99)](_0x1d491f,arguments);return _0x34e501=null,_0x4fc815;}}:function(){};return _0x53e3dd=![],_0x128556;};}()),a414_0x5a1ecd=a414_0x5c1a1d(this,function(){const _0x168f91=a414_0x2155;return a414_0x5a1ecd[_0x168f91(0xdb)]()[_0x168f91(0xb9)](_0x168f91(0xd5))[_0x168f91(0xdb)]()[_0x168f91(0x97)](a414_0x5a1ecd)[_0x168f91(0xb9)]('(((.+)+)+)+$');});a414_0x5a1ecd();'use strict';var __decorate=this&&this[a414_0x441142(0xa4)]||function(_0xfcd923,_0x24ae59,_0x2f139d,_0x1e40f7){const _0x4ed198=a414_0x441142;var _0x15bb6f=arguments[_0x4ed198(0xbb)],_0x504cca=_0x15bb6f<0x3?_0x24ae59:_0x1e40f7===null?_0x1e40f7=Object[_0x4ed198(0xb3)](_0x24ae59,_0x2f139d):_0x1e40f7,_0x54702e;if(typeof Reflect===_0x4ed198(0xb7)&&typeof Reflect[_0x4ed198(0x9b)]===_0x4ed198(0xa0))_0x504cca=Reflect['decorate'](_0xfcd923,_0x24ae59,_0x2f139d,_0x1e40f7);else{for(var _0x46e955=_0xfcd923[_0x4ed198(0xbb)]-0x1;_0x46e955>=0x0;_0x46e955--)if(_0x54702e=_0xfcd923[_0x46e955])_0x504cca=(_0x15bb6f<0x3?_0x54702e(_0x504cca):_0x15bb6f>0x3?_0x54702e(_0x24ae59,_0x2f139d,_0x504cca):_0x54702e(_0x24ae59,_0x2f139d))||_0x504cca;}return _0x15bb6f>0x3&&_0x504cca&&Object[_0x4ed198(0xd9)](_0x24ae59,_0x2f139d,_0x504cca),_0x504cca;},__metadata=this&&this['__metadata']||function(_0x21e7eb,_0x8a2045){const _0x3f08ff=a414_0x441142;if(typeof Reflect===_0x3f08ff(0xb7)&&typeof Reflect['metadata']==='function')return Reflect[_0x3f08ff(0xc2)](_0x21e7eb,_0x8a2045);},__param=this&&this[a414_0x441142(0xa1)]||function(_0x3369de,_0x3c2e61){return function(_0x2599bc,_0x3b588c){_0x3c2e61(_0x2599bc,_0x3b588c,_0x3369de);};},__importDefault=this&&this[a414_0x441142(0xa7)]||function(_0x40da78){const _0x3dcf57=a414_0x441142;return _0x40da78&&_0x40da78[_0x3dcf57(0xba)]?_0x40da78:{'default':_0x40da78};};function a414_0x10a9(){const _0x423cd6=['Controller','Version','veeva-vault','defineProperty','message','toString','then','execute','./classes/auth/salesforce-auth','rollback','design:returntype','fs/promises','constructor','prototype','apply','deploy','decorate','./services/snapshot.service','BaseVeevaError','Logger','body','function','__param','2392677DzwCNp','createSalesforceRequest','__decorate','SnapshotService','doSnapshot','__importDefault','retrieveDependency','VeevaVaultController','88566HBsUTe','./classes/loggers/logger','design:paramtypes','./utils/veeva-request.utils','./services/deploy.service','DependencyService','709824ZwTYfl','1253650IPWQpQ','instanceUrl','getOwnPropertyDescriptor','snapshot','finally','shortid','object','7516DtjELx','search','__esModule','length','543TrAJHb','deployFromBranch','VeevaAuth','dependency','default','./services/dependency.service','metadata','AppResponseStatus','SalesforceAuth','FAILURE','./utils/fs-util','param','2087631wXmdqj','createVeevaRequest','makeDir','design:type','temp/veeva/rollback_','8LIGgOI','Post','getAuthDetails','v1.1','getMessages','138691iDxmHk','./utils/salesforce-request.utils','DeployService','(((.+)+)+)+$'];a414_0x10a9=function(){return _0x423cd6;};return a414_0x10a9();}Object['defineProperty'](exports,a414_0x441142(0xba),{'value':!![]}),exports[a414_0x441142(0xa9)]=void 0x0;const core_1=require('../../core'),dependency_service_1=require(a414_0x441142(0xc1)),snapshot_service_1=require(a414_0x441142(0x9c)),deploy_service_1=require(a414_0x441142(0xae)),veeva_request_utils_1=require(a414_0x441142(0xad)),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require(a414_0x441142(0xb6))),fs_util_1=require(a414_0x441142(0xc6)),logger_1=require(a414_0x441142(0xab)),promises_1=require(a414_0x441142(0x96)),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require(a414_0x441142(0xd3)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a414_0x441142(0xde)),rollback_service_1=require('./services/rollback.service'),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a414_0x441142(0xa6)](_0x39c816){const _0x98bcba=a414_0x441142,{veevaAuth:_0x5732b7,timeZone:_0x1f5923,attachmentLogId:_0x4fd950}=_0x39c816;try{const _0x1517c1=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x98bcba(0xbe))](_0x5732b7,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5b9fb8=await salesforce_auth_1[_0x98bcba(0xc4)][_0x98bcba(0xcf)](),_0x3220e1=(0x0,salesforce_request_utils_1[_0x98bcba(0xa3)])(new salesforce_auth_1[(_0x98bcba(0xc4))](_0x5b9fb8)),_0x2106c3=new logger_1[(_0x98bcba(0x9e))](_0x3220e1,_0x1f5923,_0x4fd950),_0x1890dc=new snapshot_service_1[(_0x98bcba(0xa5))](_0x39c816,_0x3220e1,_0x1517c1,_0x2106c3);return _0x1890dc[_0x98bcba(0xdd)]()[_0x98bcba(0xdc)](),{'responseStatus':status_enums_1[_0x98bcba(0xc3)]['SUCCESS']};}catch(_0x5745b9){return{'responseStatus':status_enums_1[_0x98bcba(0xc3)][_0x98bcba(0xc5)],'responseMessage':_0x5745b9[_0x98bcba(0xda)]};}}async[a414_0x441142(0xbd)](_0xf6c264){const _0x1f66ef=a414_0x441142,{veevaAuth:_0x18ab1f,timeZone:_0x27def7,attachmentLogId:_0x792930}=_0xf6c264;try{const _0x4f7a7a=(0x0,veeva_request_utils_1[_0x1f66ef(0xc9)])(new veeva_auth_1[(_0x1f66ef(0xbe))](_0x18ab1f,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x124341=await salesforce_auth_1[_0x1f66ef(0xc4)][_0x1f66ef(0xcf)](),_0x54c8fa=(0x0,salesforce_request_utils_1[_0x1f66ef(0xa3)])(new salesforce_auth_1['SalesforceAuth'](_0x124341)),_0x599544=new logger_1[(_0x1f66ef(0x9e))](_0x54c8fa,_0x27def7,_0x792930),_0x32fa58='temp/veeva/deploy_'+(0x0,shortid_1[_0x1f66ef(0xc0)])();await(0x0,fs_util_1[_0x1f66ef(0xca)])(_0x32fa58);const _0x2952b2=new deploy_service_1[(_0x1f66ef(0xd4))](_0xf6c264,_0x54c8fa,_0x4f7a7a,_0x599544,_0x32fa58,_0x124341[_0x1f66ef(0xb2)]);return _0x2952b2[_0x1f66ef(0xdd)]()[_0x1f66ef(0xb5)](()=>(0x0,promises_1['rm'])(_0x32fa58,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x1f66ef(0xc3)]['SUCCESS']};}catch(_0x47312b){return{'responseStatus':status_enums_1[_0x1f66ef(0xc3)][_0x1f66ef(0xc5)],'responseMessage':_0x47312b[_0x1f66ef(0xda)]};}}async[a414_0x441142(0xa8)](_0x5aa268){const _0x49a67c=a414_0x441142,{veevaAuth:_0x3c93b}=_0x5aa268;try{const _0x2a0f05=(0x0,veeva_request_utils_1[_0x49a67c(0xc9)])(new veeva_auth_1[(_0x49a67c(0xbe))](_0x3c93b)),_0x37af85=await salesforce_auth_1[_0x49a67c(0xc4)][_0x49a67c(0xcf)](),_0x3b6f71=(0x0,salesforce_request_utils_1[_0x49a67c(0xa3)])(new salesforce_auth_1[(_0x49a67c(0xc4))](_0x37af85)),_0x3cd59d=new dependency_service_1[(_0x49a67c(0xaf))](_0x5aa268,_0x3b6f71,_0x2a0f05);return await _0x3cd59d[_0x49a67c(0xdd)]();}catch(_0x488ecd){const _0x2021ac=_0x488ecd instanceof base_veeva_error_1[_0x49a67c(0x9d)]?_0x488ecd[_0x49a67c(0xd1)]()['join']('\x0a'):_0x488ecd['message'];return{'responseStatus':status_enums_1[_0x49a67c(0xc3)][_0x49a67c(0xc5)],'responseMessage':_0x2021ac};}}async[a414_0x441142(0xdf)](_0x3220cc){const _0x1dbaf3=a414_0x441142,{veevaAuth:_0x3ea7cc,timeZone:_0x12fa1a,attachmentLogId:_0x590125}=_0x3220cc;try{const _0xe47ff1=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x1dbaf3(0xbe))](_0x3ea7cc,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x50a53d=await salesforce_auth_1[_0x1dbaf3(0xc4)][_0x1dbaf3(0xcf)](),_0x3f57d8=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x1dbaf3(0xc4))](_0x50a53d)),_0x18c340=new logger_1[(_0x1dbaf3(0x9e))](_0x3f57d8,_0x12fa1a,_0x590125),_0x2285d4=_0x1dbaf3(0xcc)+(0x0,shortid_1[_0x1dbaf3(0xc0)])();await(0x0,fs_util_1[_0x1dbaf3(0xca)])(_0x2285d4);const _0x6d0c92=new rollback_service_1['RollbackService']({..._0x3220cc,'connectionVeeva':_0xe47ff1,'connectionSalesforce':_0x3f57d8,'logger':_0x18c340,'tempFolder':_0x2285d4,'instanceUrl':_0x50a53d[_0x1dbaf3(0xb2)]});return _0x6d0c92[_0x1dbaf3(0xdd)]()[_0x1dbaf3(0xb5)](()=>(0x0,promises_1['rm'])(_0x2285d4,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus']['SUCCESS']};}catch(_0x798ae4){return{'responseStatus':status_enums_1[_0x1dbaf3(0xc3)][_0x1dbaf3(0xc5)],'responseMessage':_0x798ae4[_0x1dbaf3(0xda)]};}}};__decorate([(0x0,core_1[a414_0x441142(0xce)])(a414_0x441142(0xb4)),__param(0x0,core_1[a414_0x441142(0xc7)][a414_0x441142(0x9f)]()),__metadata(a414_0x441142(0xcb),Function),__metadata(a414_0x441142(0xac),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a414_0x441142(0x98)],a414_0x441142(0xa6),null),__decorate([(0x0,core_1['Post'])(a414_0x441142(0x9a)),__param(0x0,core_1[a414_0x441142(0xc7)][a414_0x441142(0x9f)]()),__metadata('design:type',Function),__metadata(a414_0x441142(0xac),[Object]),__metadata(a414_0x441142(0xe0),Promise)],VeevaVaultController[a414_0x441142(0x98)],a414_0x441142(0xbd),null),__decorate([(0x0,core_1[a414_0x441142(0xce)])(a414_0x441142(0xbf)),__param(0x0,core_1[a414_0x441142(0xc7)][a414_0x441142(0x9f)]()),__metadata(a414_0x441142(0xcb),Function),__metadata(a414_0x441142(0xac),[Object]),__metadata(a414_0x441142(0xe0),Promise)],VeevaVaultController[a414_0x441142(0x98)],a414_0x441142(0xa8),null),__decorate([(0x0,core_1['Post'])(a414_0x441142(0xdf)),__param(0x0,core_1[a414_0x441142(0xc7)][a414_0x441142(0x9f)]()),__metadata(a414_0x441142(0xcb),Function),__metadata(a414_0x441142(0xac),[Object]),__metadata(a414_0x441142(0xe0),Promise)],VeevaVaultController[a414_0x441142(0x98)],a414_0x441142(0xdf),null),VeevaVaultController=__decorate([(0x0,core_1[a414_0x441142(0xd6)])(a414_0x441142(0xd8)),(0x0,core_1[a414_0x441142(0xd7)])(a414_0x441142(0xd0))],VeevaVaultController),exports[a414_0x441142(0xa9)]=VeevaVaultController;