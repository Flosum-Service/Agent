const a347_0x204827=a347_0x52e9;(function(_0x20fdc5,_0x34f291){const _0x2d6536=a347_0x52e9,_0x1e4c99=_0x20fdc5();while(!![]){try{const _0x43fb34=-parseInt(_0x2d6536(0x145))/0x1+parseInt(_0x2d6536(0x13d))/0x2*(parseInt(_0x2d6536(0x144))/0x3)+-parseInt(_0x2d6536(0x16d))/0x4*(-parseInt(_0x2d6536(0x12b))/0x5)+-parseInt(_0x2d6536(0x162))/0x6*(-parseInt(_0x2d6536(0x14b))/0x7)+parseInt(_0x2d6536(0x12a))/0x8*(-parseInt(_0x2d6536(0x15f))/0x9)+-parseInt(_0x2d6536(0x12e))/0xa*(parseInt(_0x2d6536(0x166))/0xb)+-parseInt(_0x2d6536(0x14d))/0xc*(-parseInt(_0x2d6536(0x16e))/0xd);if(_0x43fb34===_0x34f291)break;else _0x1e4c99['push'](_0x1e4c99['shift']());}catch(_0x14c747){_0x1e4c99['push'](_0x1e4c99['shift']());}}}(a347_0x1411,0xc68b2));function a347_0x52e9(_0x3b4aea,_0x3e8fd9){const _0x19c9fe=a347_0x1411();return a347_0x52e9=function(_0x19f268,_0x4f759a){_0x19f268=_0x19f268-0x122;let _0x141162=_0x19c9fe[_0x19f268];return _0x141162;},a347_0x52e9(_0x3b4aea,_0x3e8fd9);}const a347_0x4f759a=(function(){let _0x49d65e=!![];return function(_0x1b746d,_0x45a750){const _0x59494e=_0x49d65e?function(){if(_0x45a750){const _0x2d91d6=_0x45a750['apply'](_0x1b746d,arguments);return _0x45a750=null,_0x2d91d6;}}:function(){};return _0x49d65e=![],_0x59494e;};}()),a347_0x19f268=a347_0x4f759a(this,function(){const _0x20384b=a347_0x52e9;return a347_0x19f268[_0x20384b(0x14a)]()[_0x20384b(0x130)]('(((.+)+)+)+$')[_0x20384b(0x14a)]()[_0x20384b(0x163)](a347_0x19f268)[_0x20384b(0x130)](_0x20384b(0x124));});a347_0x19f268();'use strict';function a347_0x1411(){const _0x27c7f9=['design:returntype','__decorate','temp/veeva/rollback_','VeevaVaultController','doSnapshot','SnapshotService','body','object','fs/promises','getOwnPropertyDescriptor','deployFromBranch','3057066TKRVnu','message','SUCCESS','1542PlpiRe','constructor','veeva-vault','BaseVeevaError','742104Iwooyt','metadata','getAuthDetails','../../core','param','makeDir','rollback','6156tyziTy','741rJnQUE','VeevaAuth','Controller','(((.+)+)+)+$','__param','createSalesforceRequest','default','v1.1','function','32qHoiWU','130wbDqGo','deploy','createVeevaRequest','230BFgaKg','then','search','./services/rollback.service','join','./services/dependency.service','decorate','temp/veeva/deploy_','design:type','length','instanceUrl','DeployService','SalesforceAuth','execute','./utils/salesforce-request.utils','2rtxLny','shortid','finally','Post','DependencyService','__esModule','prototype','666639rScocd','33604lRLgVX','snapshot','retrieveDependency','design:paramtypes','./utils/veeva-request.utils','toString','21882AFefau','AppResponseStatus','566652bNFNPR','./classes/errors/base-veeva-error','Logger','FAILURE','Version','defineProperty','./classes/auth/salesforce-auth'];a347_0x1411=function(){return _0x27c7f9;};return a347_0x1411();}var __decorate=this&&this[a347_0x204827(0x155)]||function(_0x54ac64,_0x326f3f,_0xce0aaa,_0x37d343){const _0x15324b=a347_0x204827;var _0x30e7cc=arguments[_0x15324b(0x137)],_0x308900=_0x30e7cc<0x3?_0x326f3f:_0x37d343===null?_0x37d343=Object[_0x15324b(0x15d)](_0x326f3f,_0xce0aaa):_0x37d343,_0x19445b;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x15324b(0x129))_0x308900=Reflect[_0x15324b(0x134)](_0x54ac64,_0x326f3f,_0xce0aaa,_0x37d343);else{for(var _0x1e5d28=_0x54ac64[_0x15324b(0x137)]-0x1;_0x1e5d28>=0x0;_0x1e5d28--)if(_0x19445b=_0x54ac64[_0x1e5d28])_0x308900=(_0x30e7cc<0x3?_0x19445b(_0x308900):_0x30e7cc>0x3?_0x19445b(_0x326f3f,_0xce0aaa,_0x308900):_0x19445b(_0x326f3f,_0xce0aaa))||_0x308900;}return _0x30e7cc>0x3&&_0x308900&&Object[_0x15324b(0x152)](_0x326f3f,_0xce0aaa,_0x308900),_0x308900;},__metadata=this&&this['__metadata']||function(_0x3e1836,_0x5aad3e){const _0x178774=a347_0x204827;if(typeof Reflect===_0x178774(0x15b)&&typeof Reflect[_0x178774(0x167)]==='function')return Reflect['metadata'](_0x3e1836,_0x5aad3e);},__param=this&&this[a347_0x204827(0x125)]||function(_0x447e8b,_0x4319f9){return function(_0x178ac5,_0xdbd3e0){_0x4319f9(_0x178ac5,_0xdbd3e0,_0x447e8b);};},__importDefault=this&&this['__importDefault']||function(_0x1177ba){const _0x12a5fd=a347_0x204827;return _0x1177ba&&_0x1177ba[_0x12a5fd(0x142)]?_0x1177ba:{'default':_0x1177ba};};Object[a347_0x204827(0x152)](exports,a347_0x204827(0x142),{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require(a347_0x204827(0x169)),dependency_service_1=require(a347_0x204827(0x133)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require(a347_0x204827(0x149)),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require(a347_0x204827(0x13e))),fs_util_1=require('./utils/fs-util'),logger_1=require('./classes/loggers/logger'),promises_1=require(a347_0x204827(0x15c)),base_veeva_error_1=require(a347_0x204827(0x14e)),salesforce_request_utils_1=require(a347_0x204827(0x13c)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a347_0x204827(0x153)),rollback_service_1=require(a347_0x204827(0x131)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a347_0x204827(0x158)](_0x4fc3a4){const _0x3b9f69=a347_0x204827,{veevaAuth:_0x52806d,timeZone:_0x449af6,attachmentLogId:_0x3e47a8}=_0x4fc3a4;try{const _0x2e5054=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1['VeevaAuth'](_0x52806d,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x269fa1=await salesforce_auth_1[_0x3b9f69(0x13a)][_0x3b9f69(0x168)](),_0x1ff366=(0x0,salesforce_request_utils_1[_0x3b9f69(0x126)])(new salesforce_auth_1['SalesforceAuth'](_0x269fa1)),_0x4efdfc=new logger_1[(_0x3b9f69(0x14f))](_0x1ff366,_0x449af6,_0x3e47a8),_0x50d46d=new snapshot_service_1[(_0x3b9f69(0x159))](_0x4fc3a4,_0x1ff366,_0x2e5054,_0x4efdfc);return _0x50d46d[_0x3b9f69(0x13b)]()[_0x3b9f69(0x12f)](),{'responseStatus':status_enums_1[_0x3b9f69(0x14c)]['SUCCESS']};}catch(_0x1b57ee){return{'responseStatus':status_enums_1[_0x3b9f69(0x14c)]['FAILURE'],'responseMessage':_0x1b57ee[_0x3b9f69(0x160)]};}}async[a347_0x204827(0x15e)](_0x392368){const _0x2576c4=a347_0x204827,{veevaAuth:_0x32e809,timeZone:_0x11ddf8,attachmentLogId:_0x32d1f1}=_0x392368;try{const _0x3de36c=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x2576c4(0x122))](_0x32e809,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x47c322=await salesforce_auth_1[_0x2576c4(0x13a)]['getAuthDetails'](),_0x5ebc33=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x2576c4(0x13a))](_0x47c322)),_0x63ce92=new logger_1[(_0x2576c4(0x14f))](_0x5ebc33,_0x11ddf8,_0x32d1f1),_0x454b6f=_0x2576c4(0x135)+(0x0,shortid_1[_0x2576c4(0x127)])();await(0x0,fs_util_1[_0x2576c4(0x16b)])(_0x454b6f);const _0x1a3ffc=new deploy_service_1[(_0x2576c4(0x139))](_0x392368,_0x5ebc33,_0x3de36c,_0x63ce92,_0x454b6f,_0x47c322[_0x2576c4(0x138)]);return _0x1a3ffc[_0x2576c4(0x13b)]()[_0x2576c4(0x13f)](()=>(0x0,promises_1['rm'])(_0x454b6f,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x2576c4(0x14c)]['SUCCESS']};}catch(_0x1deceb){return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x1deceb[_0x2576c4(0x160)]};}}async[a347_0x204827(0x147)](_0x29e73e){const _0x5ac7ed=a347_0x204827,{veevaAuth:_0x13a6d6}=_0x29e73e;try{const _0x4d0455=(0x0,veeva_request_utils_1[_0x5ac7ed(0x12d)])(new veeva_auth_1['VeevaAuth'](_0x13a6d6)),_0x56eb58=await salesforce_auth_1[_0x5ac7ed(0x13a)][_0x5ac7ed(0x168)](),_0x271a40=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x5ac7ed(0x13a))](_0x56eb58)),_0x5d9584=new dependency_service_1[(_0x5ac7ed(0x141))](_0x29e73e,_0x271a40,_0x4d0455);return await _0x5d9584[_0x5ac7ed(0x13b)]();}catch(_0x5b6828){const _0x18643d=_0x5b6828 instanceof base_veeva_error_1[_0x5ac7ed(0x165)]?_0x5b6828['getMessages']()[_0x5ac7ed(0x132)]('\x0a'):_0x5b6828[_0x5ac7ed(0x160)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x5ac7ed(0x150)],'responseMessage':_0x18643d};}}async['rollback'](_0xb0921a){const _0x16f580=a347_0x204827,{veevaAuth:_0x5d9141,timeZone:_0x3797d7,attachmentLogId:_0x5dc64a}=_0xb0921a;try{const _0x37e6a6=(0x0,veeva_request_utils_1[_0x16f580(0x12d)])(new veeva_auth_1[(_0x16f580(0x122))](_0x5d9141,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1be0c4=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x45d3d4=(0x0,salesforce_request_utils_1[_0x16f580(0x126)])(new salesforce_auth_1[(_0x16f580(0x13a))](_0x1be0c4)),_0x35e227=new logger_1[(_0x16f580(0x14f))](_0x45d3d4,_0x3797d7,_0x5dc64a),_0x5d9709=_0x16f580(0x156)+(0x0,shortid_1[_0x16f580(0x127)])();await(0x0,fs_util_1['makeDir'])(_0x5d9709);const _0x14d607=new rollback_service_1['RollbackService']({..._0xb0921a,'connectionVeeva':_0x37e6a6,'connectionSalesforce':_0x45d3d4,'logger':_0x35e227,'tempFolder':_0x5d9709,'instanceUrl':_0x1be0c4[_0x16f580(0x138)]});return _0x14d607['execute']()[_0x16f580(0x13f)](()=>(0x0,promises_1['rm'])(_0x5d9709,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x16f580(0x14c)][_0x16f580(0x161)]};}catch(_0x127bea){return{'responseStatus':status_enums_1[_0x16f580(0x14c)][_0x16f580(0x150)],'responseMessage':_0x127bea[_0x16f580(0x160)]};}}};__decorate([(0x0,core_1[a347_0x204827(0x140)])(a347_0x204827(0x146)),__param(0x0,core_1[a347_0x204827(0x16a)][a347_0x204827(0x15a)]()),__metadata('design:type',Function),__metadata(a347_0x204827(0x148),[Object]),__metadata(a347_0x204827(0x154),Promise)],VeevaVaultController[a347_0x204827(0x143)],a347_0x204827(0x158),null),__decorate([(0x0,core_1['Post'])(a347_0x204827(0x12c)),__param(0x0,core_1[a347_0x204827(0x16a)][a347_0x204827(0x15a)]()),__metadata(a347_0x204827(0x136),Function),__metadata(a347_0x204827(0x148),[Object]),__metadata(a347_0x204827(0x154),Promise)],VeevaVaultController['prototype'],a347_0x204827(0x15e),null),__decorate([(0x0,core_1[a347_0x204827(0x140)])('dependency'),__param(0x0,core_1['param'][a347_0x204827(0x15a)]()),__metadata(a347_0x204827(0x136),Function),__metadata('design:paramtypes',[Object]),__metadata(a347_0x204827(0x154),Promise)],VeevaVaultController[a347_0x204827(0x143)],a347_0x204827(0x147),null),__decorate([(0x0,core_1[a347_0x204827(0x140)])(a347_0x204827(0x16c)),__param(0x0,core_1[a347_0x204827(0x16a)][a347_0x204827(0x15a)]()),__metadata(a347_0x204827(0x136),Function),__metadata(a347_0x204827(0x148),[Object]),__metadata(a347_0x204827(0x154),Promise)],VeevaVaultController[a347_0x204827(0x143)],a347_0x204827(0x16c),null),VeevaVaultController=__decorate([(0x0,core_1[a347_0x204827(0x123)])(a347_0x204827(0x164)),(0x0,core_1[a347_0x204827(0x151)])(a347_0x204827(0x128))],VeevaVaultController),exports[a347_0x204827(0x157)]=VeevaVaultController;