const a371_0x2f1187=a371_0xd73e;(function(_0x211d53,_0x4c7da1){const _0x501f2b=a371_0xd73e,_0x4acc1c=_0x211d53();while(!![]){try{const _0x935409=-parseInt(_0x501f2b(0x140))/0x1+parseInt(_0x501f2b(0x129))/0x2+-parseInt(_0x501f2b(0x136))/0x3+parseInt(_0x501f2b(0x128))/0x4+-parseInt(_0x501f2b(0x13b))/0x5+-parseInt(_0x501f2b(0x112))/0x6*(parseInt(_0x501f2b(0x148))/0x7)+parseInt(_0x501f2b(0x153))/0x8*(parseInt(_0x501f2b(0x114))/0x9);if(_0x935409===_0x4c7da1)break;else _0x4acc1c['push'](_0x4acc1c['shift']());}catch(_0x5e7873){_0x4acc1c['push'](_0x4acc1c['shift']());}}}(a371_0x10dd,0x99e95));const a371_0xc8713a=(function(){let _0x17e437=!![];return function(_0x4d79ab,_0x280019){const _0x4efba6=_0x17e437?function(){const _0x34fd5b=a371_0xd73e;if(_0x280019){const _0x30c660=_0x280019[_0x34fd5b(0x10e)](_0x4d79ab,arguments);return _0x280019=null,_0x30c660;}}:function(){};return _0x17e437=![],_0x4efba6;};}()),a371_0x2f6ca1=a371_0xc8713a(this,function(){const _0x10c5bd=a371_0xd73e;return a371_0x2f6ca1[_0x10c5bd(0x144)]()[_0x10c5bd(0x10b)](_0x10c5bd(0x11e))[_0x10c5bd(0x144)]()[_0x10c5bd(0x138)](a371_0x2f6ca1)[_0x10c5bd(0x10b)](_0x10c5bd(0x11e));});a371_0x2f6ca1();function a371_0x10dd(){const _0x1e94e6=['join','__decorate','execute','message','RollbackService','body','./services/dependency.service','Controller','getAuthDetails','(((.+)+)+)+$','DeployService','VeevaAuth','retrieveDependency','finally','param','SUCCESS','temp/veeva/deploy_','metadata','dependency','967260uBjUhr','717610fhsbqr','./utils/veeva-request.utils','./utils/fs-util','VeevaVaultController','makeDir','__esModule','length','deployFromBranch','../../core','getMessages','v1.1','design:paramtypes','Logger','3289638MniZtk','getOwnPropertyDescriptor','constructor','doSnapshot','AppResponseStatus','1240615SjhkhY','./services/snapshot.service','./classes/auth/salesforce-auth','DependencyService','fs/promises','578384xRfdrN','BaseVeevaError','default','./classes/errors/base-veeva-error','toString','design:returntype','./utils/salesforce-request.utils','./classes/auth/veeva-auth','782831pqGpRo','createVeevaRequest','temp/veeva/rollback_','SalesforceAuth','shortid','./services/rollback.service','design:type','createSalesforceRequest','__param','prototype','then','16gOVFpt','search','snapshot','rollback','apply','Post','object','FAILURE','48WJWdPj','function','12813831vcniMT'];a371_0x10dd=function(){return _0x1e94e6;};return a371_0x10dd();}'use strict';var __decorate=this&&this[a371_0x2f1187(0x116)]||function(_0x1f08d1,_0x1fa38a,_0xae134f,_0x26949e){const _0xb417b5=a371_0x2f1187;var _0x45936e=arguments[_0xb417b5(0x12f)],_0x37a4b4=_0x45936e<0x3?_0x1fa38a:_0x26949e===null?_0x26949e=Object[_0xb417b5(0x137)](_0x1fa38a,_0xae134f):_0x26949e,_0x44cead;if(typeof Reflect===_0xb417b5(0x110)&&typeof Reflect['decorate']===_0xb417b5(0x113))_0x37a4b4=Reflect['decorate'](_0x1f08d1,_0x1fa38a,_0xae134f,_0x26949e);else{for(var _0x22e8f0=_0x1f08d1['length']-0x1;_0x22e8f0>=0x0;_0x22e8f0--)if(_0x44cead=_0x1f08d1[_0x22e8f0])_0x37a4b4=(_0x45936e<0x3?_0x44cead(_0x37a4b4):_0x45936e>0x3?_0x44cead(_0x1fa38a,_0xae134f,_0x37a4b4):_0x44cead(_0x1fa38a,_0xae134f))||_0x37a4b4;}return _0x45936e>0x3&&_0x37a4b4&&Object['defineProperty'](_0x1fa38a,_0xae134f,_0x37a4b4),_0x37a4b4;},__metadata=this&&this['__metadata']||function(_0x159e52,_0x2cdc4d){const _0x357dd8=a371_0x2f1187;if(typeof Reflect==='object'&&typeof Reflect[_0x357dd8(0x126)]===_0x357dd8(0x113))return Reflect[_0x357dd8(0x126)](_0x159e52,_0x2cdc4d);},__param=this&&this[a371_0x2f1187(0x150)]||function(_0xe1e414,_0x5acdd5){return function(_0x4ac0dd,_0x3b6ee5){_0x5acdd5(_0x4ac0dd,_0x3b6ee5,_0xe1e414);};},__importDefault=this&&this['__importDefault']||function(_0x213d92){const _0x5367e0=a371_0x2f1187;return _0x213d92&&_0x213d92[_0x5367e0(0x12e)]?_0x213d92:{'default':_0x213d92};};function a371_0xd73e(_0x587445,_0x1460ad){const _0x56201e=a371_0x10dd();return a371_0xd73e=function(_0x2f6ca1,_0xc8713a){_0x2f6ca1=_0x2f6ca1-0x10b;let _0x10dde3=_0x56201e[_0x2f6ca1];return _0x10dde3;},a371_0xd73e(_0x587445,_0x1460ad);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a371_0x2f1187(0x12c)]=void 0x0;const core_1=require(a371_0x2f1187(0x131)),dependency_service_1=require(a371_0x2f1187(0x11b)),snapshot_service_1=require(a371_0x2f1187(0x13c)),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require(a371_0x2f1187(0x12a)),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require(a371_0x2f1187(0x14c))),fs_util_1=require(a371_0x2f1187(0x12b)),logger_1=require('./classes/loggers/logger'),promises_1=require(a371_0x2f1187(0x13f)),base_veeva_error_1=require(a371_0x2f1187(0x143)),salesforce_request_utils_1=require(a371_0x2f1187(0x146)),veeva_auth_1=require(a371_0x2f1187(0x147)),salesforce_auth_1=require(a371_0x2f1187(0x13d)),rollback_service_1=require(a371_0x2f1187(0x14d)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a371_0x2f1187(0x139)](_0x594bdd){const _0x43e194=a371_0x2f1187,{veevaAuth:_0xce20a7,timeZone:_0x425560,attachmentLogId:_0x400693}=_0x594bdd;try{const _0x370701=(0x0,veeva_request_utils_1[_0x43e194(0x149)])(new veeva_auth_1[(_0x43e194(0x120))](_0xce20a7,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1534cb=await salesforce_auth_1[_0x43e194(0x14b)]['getAuthDetails'](),_0x25abb8=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x43e194(0x14b))](_0x1534cb)),_0xf86187=new logger_1['Logger'](_0x25abb8,_0x425560,_0x400693),_0x1fc8b4=new snapshot_service_1['SnapshotService'](_0x594bdd,_0x25abb8,_0x370701,_0xf86187);return _0x1fc8b4[_0x43e194(0x117)]()[_0x43e194(0x152)](),{'responseStatus':status_enums_1[_0x43e194(0x13a)][_0x43e194(0x124)]};}catch(_0x4c6bd3){return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x4c6bd3[_0x43e194(0x118)]};}}async['deployFromBranch'](_0x37d5f0){const _0x3d537e=a371_0x2f1187,{veevaAuth:_0x29b831,timeZone:_0x109fb2,attachmentLogId:_0x3f55e6}=_0x37d5f0;try{const _0x204647=(0x0,veeva_request_utils_1[_0x3d537e(0x149)])(new veeva_auth_1[(_0x3d537e(0x120))](_0x29b831,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5085cb=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x37120b=(0x0,salesforce_request_utils_1[_0x3d537e(0x14f)])(new salesforce_auth_1[(_0x3d537e(0x14b))](_0x5085cb)),_0x36be09=new logger_1[(_0x3d537e(0x135))](_0x37120b,_0x109fb2,_0x3f55e6),_0x4fe860=_0x3d537e(0x125)+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x3d537e(0x12d)])(_0x4fe860);const _0x2a7df4=new deploy_service_1[(_0x3d537e(0x11f))](_0x37d5f0,_0x37120b,_0x204647,_0x36be09,_0x4fe860,_0x5085cb['instanceUrl']);return _0x2a7df4[_0x3d537e(0x117)]()[_0x3d537e(0x122)](()=>(0x0,promises_1['rm'])(_0x4fe860,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x3d537e(0x13a)][_0x3d537e(0x124)]};}catch(_0x33f367){return{'responseStatus':status_enums_1[_0x3d537e(0x13a)][_0x3d537e(0x111)],'responseMessage':_0x33f367[_0x3d537e(0x118)]};}}async[a371_0x2f1187(0x121)](_0x3a50e0){const _0x369e0f=a371_0x2f1187,{veevaAuth:_0x45b81a}=_0x3a50e0;try{const _0x2723f9=(0x0,veeva_request_utils_1[_0x369e0f(0x149)])(new veeva_auth_1['VeevaAuth'](_0x45b81a)),_0xe92a9d=await salesforce_auth_1['SalesforceAuth'][_0x369e0f(0x11d)](),_0x580d50=(0x0,salesforce_request_utils_1[_0x369e0f(0x14f)])(new salesforce_auth_1['SalesforceAuth'](_0xe92a9d)),_0x16d18c=new dependency_service_1[(_0x369e0f(0x13e))](_0x3a50e0,_0x580d50,_0x2723f9);return await _0x16d18c[_0x369e0f(0x117)]();}catch(_0xaa3079){const _0x567c2a=_0xaa3079 instanceof base_veeva_error_1[_0x369e0f(0x141)]?_0xaa3079[_0x369e0f(0x132)]()[_0x369e0f(0x115)]('\x0a'):_0xaa3079[_0x369e0f(0x118)];return{'responseStatus':status_enums_1[_0x369e0f(0x13a)][_0x369e0f(0x111)],'responseMessage':_0x567c2a};}}async[a371_0x2f1187(0x10d)](_0x126216){const _0xb8f122=a371_0x2f1187,{veevaAuth:_0x5cf393,timeZone:_0x53d7ba,attachmentLogId:_0x1fd0ec}=_0x126216;try{const _0x42625b=(0x0,veeva_request_utils_1[_0xb8f122(0x149)])(new veeva_auth_1[(_0xb8f122(0x120))](_0x5cf393,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x595b76=await salesforce_auth_1[_0xb8f122(0x14b)][_0xb8f122(0x11d)](),_0x2d35ca=(0x0,salesforce_request_utils_1[_0xb8f122(0x14f)])(new salesforce_auth_1[(_0xb8f122(0x14b))](_0x595b76)),_0x1f36d4=new logger_1[(_0xb8f122(0x135))](_0x2d35ca,_0x53d7ba,_0x1fd0ec),_0x382c82=_0xb8f122(0x14a)+(0x0,shortid_1[_0xb8f122(0x142)])();await(0x0,fs_util_1['makeDir'])(_0x382c82);const _0x3f3734=new rollback_service_1[(_0xb8f122(0x119))]({..._0x126216,'connectionVeeva':_0x42625b,'connectionSalesforce':_0x2d35ca,'logger':_0x1f36d4,'tempFolder':_0x382c82,'instanceUrl':_0x595b76['instanceUrl']});return _0x3f3734[_0xb8f122(0x117)]()[_0xb8f122(0x122)](()=>(0x0,promises_1['rm'])(_0x382c82,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0xb8f122(0x124)]};}catch(_0x2ecc17){return{'responseStatus':status_enums_1[_0xb8f122(0x13a)]['FAILURE'],'responseMessage':_0x2ecc17[_0xb8f122(0x118)]};}}};__decorate([(0x0,core_1[a371_0x2f1187(0x10f)])(a371_0x2f1187(0x10c)),__param(0x0,core_1[a371_0x2f1187(0x123)][a371_0x2f1187(0x11a)]()),__metadata(a371_0x2f1187(0x14e),Function),__metadata('design:paramtypes',[Object]),__metadata(a371_0x2f1187(0x145),Promise)],VeevaVaultController[a371_0x2f1187(0x151)],a371_0x2f1187(0x139),null),__decorate([(0x0,core_1[a371_0x2f1187(0x10f)])('deploy'),__param(0x0,core_1['param'][a371_0x2f1187(0x11a)]()),__metadata(a371_0x2f1187(0x14e),Function),__metadata(a371_0x2f1187(0x134),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x2f1187(0x151)],a371_0x2f1187(0x130),null),__decorate([(0x0,core_1[a371_0x2f1187(0x10f)])(a371_0x2f1187(0x127)),__param(0x0,core_1[a371_0x2f1187(0x123)][a371_0x2f1187(0x11a)]()),__metadata(a371_0x2f1187(0x14e),Function),__metadata(a371_0x2f1187(0x134),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x2f1187(0x151)],a371_0x2f1187(0x121),null),__decorate([(0x0,core_1['Post'])(a371_0x2f1187(0x10d)),__param(0x0,core_1[a371_0x2f1187(0x123)]['body']()),__metadata(a371_0x2f1187(0x14e),Function),__metadata(a371_0x2f1187(0x134),[Object]),__metadata(a371_0x2f1187(0x145),Promise)],VeevaVaultController['prototype'],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a371_0x2f1187(0x11c)])('veeva-vault'),(0x0,core_1['Version'])(a371_0x2f1187(0x133))],VeevaVaultController),exports[a371_0x2f1187(0x12c)]=VeevaVaultController;