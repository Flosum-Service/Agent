function a371_0x3335(_0x29d1da,_0x75f8b9){const _0x13cce8=a371_0xedee();return a371_0x3335=function(_0x4489f4,_0x49dd24){_0x4489f4=_0x4489f4-0x7a;let _0xedee03=_0x13cce8[_0x4489f4];return _0xedee03;},a371_0x3335(_0x29d1da,_0x75f8b9);}const a371_0xdc97aa=a371_0x3335;(function(_0x2e29e9,_0x33f539){const _0x54f4d8=a371_0x3335,_0x327641=_0x2e29e9();while(!![]){try{const _0x108b19=parseInt(_0x54f4d8(0x9e))/0x1*(parseInt(_0x54f4d8(0x9b))/0x2)+-parseInt(_0x54f4d8(0xb4))/0x3+-parseInt(_0x54f4d8(0x98))/0x4*(parseInt(_0x54f4d8(0x8a))/0x5)+-parseInt(_0x54f4d8(0xb5))/0x6*(parseInt(_0x54f4d8(0xb2))/0x7)+parseInt(_0x54f4d8(0x85))/0x8+parseInt(_0x54f4d8(0x8c))/0x9+parseInt(_0x54f4d8(0xa9))/0xa;if(_0x108b19===_0x33f539)break;else _0x327641['push'](_0x327641['shift']());}catch(_0x27bf29){_0x327641['push'](_0x327641['shift']());}}}(a371_0xedee,0xb1c19));const a371_0x49dd24=(function(){let _0x3a1f70=!![];return function(_0x522dbb,_0x47c5fb){const _0x344dc8=_0x3a1f70?function(){if(_0x47c5fb){const _0x539d76=_0x47c5fb['apply'](_0x522dbb,arguments);return _0x47c5fb=null,_0x539d76;}}:function(){};return _0x3a1f70=![],_0x344dc8;};}()),a371_0x4489f4=a371_0x49dd24(this,function(){const _0x100a2c=a371_0x3335;return a371_0x4489f4[_0x100a2c(0x7d)]()[_0x100a2c(0x92)](_0x100a2c(0x87))[_0x100a2c(0x7d)]()['constructor'](a371_0x4489f4)[_0x100a2c(0x92)](_0x100a2c(0x87));});a371_0x4489f4();'use strict';var __decorate=this&&this['__decorate']||function(_0x525d5e,_0x430ef5,_0x1eda5f,_0x2c2f8a){const _0x3a0954=a371_0x3335;var _0x372889=arguments[_0x3a0954(0x99)],_0x4a6012=_0x372889<0x3?_0x430ef5:_0x2c2f8a===null?_0x2c2f8a=Object[_0x3a0954(0xa0)](_0x430ef5,_0x1eda5f):_0x2c2f8a,_0x3042c1;if(typeof Reflect===_0x3a0954(0x7b)&&typeof Reflect[_0x3a0954(0xa4)]==='function')_0x4a6012=Reflect[_0x3a0954(0xa4)](_0x525d5e,_0x430ef5,_0x1eda5f,_0x2c2f8a);else{for(var _0x5236a2=_0x525d5e[_0x3a0954(0x99)]-0x1;_0x5236a2>=0x0;_0x5236a2--)if(_0x3042c1=_0x525d5e[_0x5236a2])_0x4a6012=(_0x372889<0x3?_0x3042c1(_0x4a6012):_0x372889>0x3?_0x3042c1(_0x430ef5,_0x1eda5f,_0x4a6012):_0x3042c1(_0x430ef5,_0x1eda5f))||_0x4a6012;}return _0x372889>0x3&&_0x4a6012&&Object[_0x3a0954(0xa7)](_0x430ef5,_0x1eda5f,_0x4a6012),_0x4a6012;},__metadata=this&&this[a371_0xdc97aa(0xbe)]||function(_0x5520f5,_0x397bb9){const _0x57b6af=a371_0xdc97aa;if(typeof Reflect===_0x57b6af(0x7b)&&typeof Reflect[_0x57b6af(0x8f)]===_0x57b6af(0xa2))return Reflect[_0x57b6af(0x8f)](_0x5520f5,_0x397bb9);},__param=this&&this[a371_0xdc97aa(0x97)]||function(_0x28975b,_0x560b58){return function(_0x12abb4,_0x184d82){_0x560b58(_0x12abb4,_0x184d82,_0x28975b);};},__importDefault=this&&this[a371_0xdc97aa(0xb6)]||function(_0x555e4d){const _0x1d49ff=a371_0xdc97aa;return _0x555e4d&&_0x555e4d[_0x1d49ff(0x84)]?_0x555e4d:{'default':_0x555e4d};};function a371_0xedee(){const _0x21462d=['object','createSalesforceRequest','toString','SnapshotService','getMessages','finally','./utils/salesforce-request.utils','deployFromBranch','./enums/status.enums','__esModule','4015768nEYQXw','snapshot','(((.+)+)+)+$','Post','v1.1','689415jWwqon','AppResponseStatus','12451500zZeicT','DeployService','join','metadata','design:paramtypes','deploy','search','SalesforceAuth','DependencyService','./services/rollback.service','createVeevaRequest','__param','36LnjAsf','length','execute','8290yqArMe','SUCCESS','makeDir','87jXFPkU','then','getOwnPropertyDescriptor','temp/veeva/rollback_','function','design:type','decorate','./utils/veeva-request.utils','dependency','defineProperty','RollbackService','9073490lLBOna','prototype','VeevaAuth','./services/deploy.service','Logger','Version','VeevaVaultController','retrieveDependency','doSnapshot','4369169LbKpoS','body','1680696uBojIA','6cuopgU','__importDefault','design:returntype','Controller','getAuthDetails','FAILURE','instanceUrl','message','./services/snapshot.service','__metadata','BaseVeevaError','rollback','../../core','./classes/errors/base-veeva-error','shortid','param'];a371_0xedee=function(){return _0x21462d;};return a371_0xedee();}Object[a371_0xdc97aa(0xa7)](exports,'__esModule',{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require(a371_0xdc97aa(0xc1)),dependency_service_1=require('./services/dependency.service'),snapshot_service_1=require(a371_0xdc97aa(0xbd)),deploy_service_1=require(a371_0xdc97aa(0xac)),veeva_request_utils_1=require(a371_0xdc97aa(0xa5)),status_enums_1=require(a371_0xdc97aa(0x83)),shortid_1=__importDefault(require(a371_0xdc97aa(0xc3))),fs_util_1=require('./utils/fs-util'),logger_1=require('./classes/loggers/logger'),promises_1=require('fs/promises'),base_veeva_error_1=require(a371_0xdc97aa(0xc2)),salesforce_request_utils_1=require(a371_0xdc97aa(0x81)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require(a371_0xdc97aa(0x95)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a371_0xdc97aa(0xb1)](_0x75f931){const _0x7f7521=a371_0xdc97aa,{veevaAuth:_0x3cb469,timeZone:_0x3ec886,attachmentLogId:_0xdd0e82}=_0x75f931;try{const _0x3b842e=(0x0,veeva_request_utils_1[_0x7f7521(0x96)])(new veeva_auth_1['VeevaAuth'](_0x3cb469,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1b6b2e=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x70ca14=(0x0,salesforce_request_utils_1[_0x7f7521(0x7c)])(new salesforce_auth_1['SalesforceAuth'](_0x1b6b2e)),_0xdd82c7=new logger_1[(_0x7f7521(0xad))](_0x70ca14,_0x3ec886,_0xdd0e82),_0x4f57ac=new snapshot_service_1[(_0x7f7521(0x7e))](_0x75f931,_0x70ca14,_0x3b842e,_0xdd82c7);return _0x4f57ac['execute']()[_0x7f7521(0x9f)](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x7f7521(0x9c)]};}catch(_0x7d873d){return{'responseStatus':status_enums_1[_0x7f7521(0x8b)][_0x7f7521(0xba)],'responseMessage':_0x7d873d[_0x7f7521(0xbc)]};}}async[a371_0xdc97aa(0x82)](_0x42b19d){const _0x5f5b9f=a371_0xdc97aa,{veevaAuth:_0x13c536,timeZone:_0x5ed6fe,attachmentLogId:_0x2f0755}=_0x42b19d;try{const _0x1868a2=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x5f5b9f(0xab))](_0x13c536,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x4eab71=await salesforce_auth_1[_0x5f5b9f(0x93)][_0x5f5b9f(0xb9)](),_0x1835c7=(0x0,salesforce_request_utils_1[_0x5f5b9f(0x7c)])(new salesforce_auth_1[(_0x5f5b9f(0x93))](_0x4eab71)),_0x58464e=new logger_1[(_0x5f5b9f(0xad))](_0x1835c7,_0x5ed6fe,_0x2f0755),_0x424e95='temp/veeva/deploy_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x5f5b9f(0x9d)])(_0x424e95);const _0x35a19e=new deploy_service_1[(_0x5f5b9f(0x8d))](_0x42b19d,_0x1835c7,_0x1868a2,_0x58464e,_0x424e95,_0x4eab71['instanceUrl']);return _0x35a19e['execute']()[_0x5f5b9f(0x80)](()=>(0x0,promises_1['rm'])(_0x424e95,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x5f5b9f(0x8b)]['SUCCESS']};}catch(_0x2443fa){return{'responseStatus':status_enums_1[_0x5f5b9f(0x8b)][_0x5f5b9f(0xba)],'responseMessage':_0x2443fa[_0x5f5b9f(0xbc)]};}}async[a371_0xdc97aa(0xb0)](_0x345b60){const _0x27c5fd=a371_0xdc97aa,{veevaAuth:_0x18ec10}=_0x345b60;try{const _0x642e41=(0x0,veeva_request_utils_1[_0x27c5fd(0x96)])(new veeva_auth_1['VeevaAuth'](_0x18ec10)),_0x45ea32=await salesforce_auth_1['SalesforceAuth'][_0x27c5fd(0xb9)](),_0xf5f779=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0x45ea32)),_0x1b47ff=new dependency_service_1[(_0x27c5fd(0x94))](_0x345b60,_0xf5f779,_0x642e41);return await _0x1b47ff['execute']();}catch(_0x26348a){const _0x555954=_0x26348a instanceof base_veeva_error_1[_0x27c5fd(0xbf)]?_0x26348a[_0x27c5fd(0x7f)]()[_0x27c5fd(0x8e)]('\x0a'):_0x26348a[_0x27c5fd(0xbc)];return{'responseStatus':status_enums_1[_0x27c5fd(0x8b)][_0x27c5fd(0xba)],'responseMessage':_0x555954};}}async[a371_0xdc97aa(0xc0)](_0x2327b4){const _0x4388ad=a371_0xdc97aa,{veevaAuth:_0x4585d5,timeZone:_0x5ec712,attachmentLogId:_0x50f0b4}=_0x2327b4;try{const _0x1d4838=(0x0,veeva_request_utils_1[_0x4388ad(0x96)])(new veeva_auth_1[(_0x4388ad(0xab))](_0x4585d5,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x4a548f=await salesforce_auth_1[_0x4388ad(0x93)][_0x4388ad(0xb9)](),_0x5dbd65=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x4388ad(0x93))](_0x4a548f)),_0x46c080=new logger_1['Logger'](_0x5dbd65,_0x5ec712,_0x50f0b4),_0x24e6be=_0x4388ad(0xa1)+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x4388ad(0x9d)])(_0x24e6be);const _0x1a9b47=new rollback_service_1[(_0x4388ad(0xa8))]({..._0x2327b4,'connectionVeeva':_0x1d4838,'connectionSalesforce':_0x5dbd65,'logger':_0x46c080,'tempFolder':_0x24e6be,'instanceUrl':_0x4a548f[_0x4388ad(0xbb)]});return _0x1a9b47[_0x4388ad(0x9a)]()[_0x4388ad(0x80)](()=>(0x0,promises_1['rm'])(_0x24e6be,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x4388ad(0x8b)][_0x4388ad(0x9c)]};}catch(_0x2f8c96){return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0x2f8c96[_0x4388ad(0xbc)]};}}};__decorate([(0x0,core_1[a371_0xdc97aa(0x88)])(a371_0xdc97aa(0x86)),__param(0x0,core_1[a371_0xdc97aa(0x7a)][a371_0xdc97aa(0xb3)]()),__metadata(a371_0xdc97aa(0xa3),Function),__metadata(a371_0xdc97aa(0x90),[Object]),__metadata(a371_0xdc97aa(0xb7),Promise)],VeevaVaultController[a371_0xdc97aa(0xaa)],a371_0xdc97aa(0xb1),null),__decorate([(0x0,core_1[a371_0xdc97aa(0x88)])(a371_0xdc97aa(0x91)),__param(0x0,core_1[a371_0xdc97aa(0x7a)]['body']()),__metadata(a371_0xdc97aa(0xa3),Function),__metadata(a371_0xdc97aa(0x90),[Object]),__metadata(a371_0xdc97aa(0xb7),Promise)],VeevaVaultController[a371_0xdc97aa(0xaa)],'deployFromBranch',null),__decorate([(0x0,core_1[a371_0xdc97aa(0x88)])(a371_0xdc97aa(0xa6)),__param(0x0,core_1[a371_0xdc97aa(0x7a)][a371_0xdc97aa(0xb3)]()),__metadata(a371_0xdc97aa(0xa3),Function),__metadata(a371_0xdc97aa(0x90),[Object]),__metadata(a371_0xdc97aa(0xb7),Promise)],VeevaVaultController[a371_0xdc97aa(0xaa)],a371_0xdc97aa(0xb0),null),__decorate([(0x0,core_1[a371_0xdc97aa(0x88)])('rollback'),__param(0x0,core_1['param']['body']()),__metadata(a371_0xdc97aa(0xa3),Function),__metadata(a371_0xdc97aa(0x90),[Object]),__metadata(a371_0xdc97aa(0xb7),Promise)],VeevaVaultController[a371_0xdc97aa(0xaa)],a371_0xdc97aa(0xc0),null),VeevaVaultController=__decorate([(0x0,core_1[a371_0xdc97aa(0xb8)])('veeva-vault'),(0x0,core_1[a371_0xdc97aa(0xae)])(a371_0xdc97aa(0x89))],VeevaVaultController),exports[a371_0xdc97aa(0xaf)]=VeevaVaultController;