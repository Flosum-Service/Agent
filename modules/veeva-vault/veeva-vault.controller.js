const a371_0x509167=a371_0x34f1;function a371_0x5e25(){const _0x37084d=['./utils/salesforce-request.utils','SalesforceAuth','AppResponseStatus','(((.+)+)+)+$','execute','snapshot','rollback','design:type','getAuthDetails','design:paramtypes','17172jNRwhW','../../core','776828ItMenx','createVeevaRequest','4396344Jbitgh','length','makeDir','v1.1','464FwdqvJ','dependency','doSnapshot','Controller','finally','__decorate','./classes/auth/salesforce-auth','metadata','SUCCESS','VeevaAuth','param','retrieveDependency','SnapshotService','5342216SjNoec','prototype','12rEnXrp','deployFromBranch','__importDefault','./classes/errors/base-veeva-error','20IQNFVA','./enums/status.enums','createSalesforceRequest','1150425uuLhvo','toString','body','decorate','DeployService','Version','10738EWCcck','Post','__esModule','getMessages','instanceUrl','function','8lRFyPS','default','166867OAmhle','design:returntype','110529BGSLtc','./utils/fs-util','message','VeevaVaultController','__metadata','defineProperty','join','veeva-vault','./utils/veeva-request.utils','then','Logger','./services/snapshot.service','7NhvhVj','./services/dependency.service','RollbackService','constructor','FAILURE','apply','object','search'];a371_0x5e25=function(){return _0x37084d;};return a371_0x5e25();}(function(_0x301ee3,_0x5e0a42){const _0x38e4f4=a371_0x34f1,_0x4ff881=_0x301ee3();while(!![]){try{const _0xb2be53=parseInt(_0x38e4f4(0x1ba))/0x1*(-parseInt(_0x38e4f4(0x1b8))/0x2)+parseInt(_0x38e4f4(0x1a5))/0x3*(-parseInt(_0x38e4f4(0x190))/0x4)+-parseInt(_0x38e4f4(0x1ac))/0x5+-parseInt(_0x38e4f4(0x192))/0x6*(-parseInt(_0x38e4f4(0x1c8))/0x7)+-parseInt(_0x38e4f4(0x196))/0x8*(parseInt(_0x38e4f4(0x1bc))/0x9)+-parseInt(_0x38e4f4(0x1a9))/0xa*(-parseInt(_0x38e4f4(0x1a3))/0xb)+-parseInt(_0x38e4f4(0x18e))/0xc*(-parseInt(_0x38e4f4(0x1b2))/0xd);if(_0xb2be53===_0x5e0a42)break;else _0x4ff881['push'](_0x4ff881['shift']());}catch(_0x1aaa2c){_0x4ff881['push'](_0x4ff881['shift']());}}}(a371_0x5e25,0x79ea3));const a371_0x1417e7=(function(){let _0x1b7228=!![];return function(_0xafb411,_0x54971a){const _0x2f6c34=_0x1b7228?function(){const _0x35f006=a371_0x34f1;if(_0x54971a){const _0x9ddf2f=_0x54971a[_0x35f006(0x1cd)](_0xafb411,arguments);return _0x54971a=null,_0x9ddf2f;}}:function(){};return _0x1b7228=![],_0x2f6c34;};}()),a371_0x4c779f=a371_0x1417e7(this,function(){const _0x43e44a=a371_0x34f1;return a371_0x4c779f[_0x43e44a(0x1ad)]()['search'](_0x43e44a(0x1d3))[_0x43e44a(0x1ad)]()[_0x43e44a(0x1cb)](a371_0x4c779f)[_0x43e44a(0x1cf)](_0x43e44a(0x1d3));});a371_0x4c779f();'use strict';function a371_0x34f1(_0x26aadd,_0x4de93f){const _0x3767b4=a371_0x5e25();return a371_0x34f1=function(_0x4c779f,_0x1417e7){_0x4c779f=_0x4c779f-0x18e;let _0x5e2550=_0x3767b4[_0x4c779f];return _0x5e2550;},a371_0x34f1(_0x26aadd,_0x4de93f);}var __decorate=this&&this[a371_0x509167(0x19b)]||function(_0x5ae987,_0x9bbd29,_0x405ba2,_0x5aad6b){const _0x52b0c9=a371_0x509167;var _0x4182e9=arguments['length'],_0x2aa3eb=_0x4182e9<0x3?_0x9bbd29:_0x5aad6b===null?_0x5aad6b=Object['getOwnPropertyDescriptor'](_0x9bbd29,_0x405ba2):_0x5aad6b,_0x225740;if(typeof Reflect===_0x52b0c9(0x1ce)&&typeof Reflect[_0x52b0c9(0x1af)]===_0x52b0c9(0x1b7))_0x2aa3eb=Reflect[_0x52b0c9(0x1af)](_0x5ae987,_0x9bbd29,_0x405ba2,_0x5aad6b);else{for(var _0x8e4b54=_0x5ae987[_0x52b0c9(0x193)]-0x1;_0x8e4b54>=0x0;_0x8e4b54--)if(_0x225740=_0x5ae987[_0x8e4b54])_0x2aa3eb=(_0x4182e9<0x3?_0x225740(_0x2aa3eb):_0x4182e9>0x3?_0x225740(_0x9bbd29,_0x405ba2,_0x2aa3eb):_0x225740(_0x9bbd29,_0x405ba2))||_0x2aa3eb;}return _0x4182e9>0x3&&_0x2aa3eb&&Object[_0x52b0c9(0x1c1)](_0x9bbd29,_0x405ba2,_0x2aa3eb),_0x2aa3eb;},__metadata=this&&this[a371_0x509167(0x1c0)]||function(_0x1a5976,_0x53011){const _0x4c429f=a371_0x509167;if(typeof Reflect===_0x4c429f(0x1ce)&&typeof Reflect['metadata']==='function')return Reflect[_0x4c429f(0x19d)](_0x1a5976,_0x53011);},__param=this&&this['__param']||function(_0x2ac196,_0x16ef38){return function(_0x1c9839,_0x309ad7){_0x16ef38(_0x1c9839,_0x309ad7,_0x2ac196);};},__importDefault=this&&this[a371_0x509167(0x1a7)]||function(_0x4ae1e3){const _0x3251b6=a371_0x509167;return _0x4ae1e3&&_0x4ae1e3[_0x3251b6(0x1b4)]?_0x4ae1e3:{'default':_0x4ae1e3};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a371_0x509167(0x1bf)]=void 0x0;const core_1=require(a371_0x509167(0x18f)),dependency_service_1=require(a371_0x509167(0x1c9)),snapshot_service_1=require(a371_0x509167(0x1c7)),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require(a371_0x509167(0x1c4)),status_enums_1=require(a371_0x509167(0x1aa)),shortid_1=__importDefault(require('shortid')),fs_util_1=require(a371_0x509167(0x1bd)),logger_1=require('./classes/loggers/logger'),promises_1=require('fs/promises'),base_veeva_error_1=require(a371_0x509167(0x1a8)),salesforce_request_utils_1=require(a371_0x509167(0x1d0)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a371_0x509167(0x19c)),rollback_service_1=require('./services/rollback.service'),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x84022d){const _0x29a028=a371_0x509167,{veevaAuth:_0x16a97c,timeZone:_0x3eedc8,attachmentLogId:_0x24bee0}=_0x84022d;try{const _0x74dedb=(0x0,veeva_request_utils_1[_0x29a028(0x191)])(new veeva_auth_1[(_0x29a028(0x19f))](_0x16a97c,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x55ae21=await salesforce_auth_1[_0x29a028(0x1d1)][_0x29a028(0x1d8)](),_0x196c0e=(0x0,salesforce_request_utils_1[_0x29a028(0x1ab)])(new salesforce_auth_1['SalesforceAuth'](_0x55ae21)),_0x2a9837=new logger_1['Logger'](_0x196c0e,_0x3eedc8,_0x24bee0),_0x5a3b81=new snapshot_service_1[(_0x29a028(0x1a2))](_0x84022d,_0x196c0e,_0x74dedb,_0x2a9837);return _0x5a3b81['execute']()[_0x29a028(0x1c5)](),{'responseStatus':status_enums_1['AppResponseStatus']['SUCCESS']};}catch(_0x1bae6d){return{'responseStatus':status_enums_1[_0x29a028(0x1d2)][_0x29a028(0x1cc)],'responseMessage':_0x1bae6d[_0x29a028(0x1be)]};}}async[a371_0x509167(0x1a6)](_0x3fb71f){const _0x3bb639=a371_0x509167,{veevaAuth:_0xffd088,timeZone:_0x290bec,attachmentLogId:_0x1ff77b}=_0x3fb71f;try{const _0x1c47c3=(0x0,veeva_request_utils_1[_0x3bb639(0x191)])(new veeva_auth_1['VeevaAuth'](_0xffd088,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x4f5467=await salesforce_auth_1[_0x3bb639(0x1d1)][_0x3bb639(0x1d8)](),_0x5ca7da=(0x0,salesforce_request_utils_1[_0x3bb639(0x1ab)])(new salesforce_auth_1[(_0x3bb639(0x1d1))](_0x4f5467)),_0x536240=new logger_1[(_0x3bb639(0x1c6))](_0x5ca7da,_0x290bec,_0x1ff77b),_0x3f0966='temp/veeva/deploy_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x3bb639(0x194)])(_0x3f0966);const _0x3fa9ec=new deploy_service_1[(_0x3bb639(0x1b0))](_0x3fb71f,_0x5ca7da,_0x1c47c3,_0x536240,_0x3f0966,_0x4f5467[_0x3bb639(0x1b6)]);return _0x3fa9ec['execute']()[_0x3bb639(0x19a)](()=>(0x0,promises_1['rm'])(_0x3f0966,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x3bb639(0x1d2)][_0x3bb639(0x19e)]};}catch(_0x21b09b){return{'responseStatus':status_enums_1[_0x3bb639(0x1d2)][_0x3bb639(0x1cc)],'responseMessage':_0x21b09b['message']};}}async[a371_0x509167(0x1a1)](_0x35ebc5){const _0x257bc2=a371_0x509167,{veevaAuth:_0x2cdccf}=_0x35ebc5;try{const _0x107fdc=(0x0,veeva_request_utils_1[_0x257bc2(0x191)])(new veeva_auth_1[(_0x257bc2(0x19f))](_0x2cdccf)),_0x36a42e=await salesforce_auth_1[_0x257bc2(0x1d1)]['getAuthDetails'](),_0x534535=(0x0,salesforce_request_utils_1[_0x257bc2(0x1ab)])(new salesforce_auth_1[(_0x257bc2(0x1d1))](_0x36a42e)),_0x190440=new dependency_service_1['DependencyService'](_0x35ebc5,_0x534535,_0x107fdc);return await _0x190440[_0x257bc2(0x1d4)]();}catch(_0x58b146){const _0x36d9ec=_0x58b146 instanceof base_veeva_error_1['BaseVeevaError']?_0x58b146[_0x257bc2(0x1b5)]()[_0x257bc2(0x1c2)]('\x0a'):_0x58b146[_0x257bc2(0x1be)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x257bc2(0x1cc)],'responseMessage':_0x36d9ec};}}async[a371_0x509167(0x1d6)](_0xc89715){const _0xc6128d=a371_0x509167,{veevaAuth:_0x2bb204,timeZone:_0x36cd5c,attachmentLogId:_0x14e0ad}=_0xc89715;try{const _0x5976a1=(0x0,veeva_request_utils_1[_0xc6128d(0x191)])(new veeva_auth_1[(_0xc6128d(0x19f))](_0x2bb204,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x41a9ef=await salesforce_auth_1[_0xc6128d(0x1d1)][_0xc6128d(0x1d8)](),_0x4199a8=(0x0,salesforce_request_utils_1[_0xc6128d(0x1ab)])(new salesforce_auth_1[(_0xc6128d(0x1d1))](_0x41a9ef)),_0x124cfe=new logger_1[(_0xc6128d(0x1c6))](_0x4199a8,_0x36cd5c,_0x14e0ad),_0x31d342='temp/veeva/rollback_'+(0x0,shortid_1[_0xc6128d(0x1b9)])();await(0x0,fs_util_1[_0xc6128d(0x194)])(_0x31d342);const _0x32d7c5=new rollback_service_1[(_0xc6128d(0x1ca))]({..._0xc89715,'connectionVeeva':_0x5976a1,'connectionSalesforce':_0x4199a8,'logger':_0x124cfe,'tempFolder':_0x31d342,'instanceUrl':_0x41a9ef['instanceUrl']});return _0x32d7c5[_0xc6128d(0x1d4)]()[_0xc6128d(0x19a)](()=>(0x0,promises_1['rm'])(_0x31d342,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0xc6128d(0x1d2)][_0xc6128d(0x19e)]};}catch(_0x152b4b){return{'responseStatus':status_enums_1[_0xc6128d(0x1d2)][_0xc6128d(0x1cc)],'responseMessage':_0x152b4b[_0xc6128d(0x1be)]};}}};__decorate([(0x0,core_1[a371_0x509167(0x1b3)])(a371_0x509167(0x1d5)),__param(0x0,core_1[a371_0x509167(0x1a0)][a371_0x509167(0x1ae)]()),__metadata(a371_0x509167(0x1d7),Function),__metadata('design:paramtypes',[Object]),__metadata(a371_0x509167(0x1bb),Promise)],VeevaVaultController[a371_0x509167(0x1a4)],a371_0x509167(0x198),null),__decorate([(0x0,core_1['Post'])('deploy'),__param(0x0,core_1[a371_0x509167(0x1a0)][a371_0x509167(0x1ae)]()),__metadata(a371_0x509167(0x1d7),Function),__metadata(a371_0x509167(0x1d9),[Object]),__metadata(a371_0x509167(0x1bb),Promise)],VeevaVaultController['prototype'],a371_0x509167(0x1a6),null),__decorate([(0x0,core_1[a371_0x509167(0x1b3)])(a371_0x509167(0x197)),__param(0x0,core_1[a371_0x509167(0x1a0)][a371_0x509167(0x1ae)]()),__metadata(a371_0x509167(0x1d7),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x509167(0x1a4)],a371_0x509167(0x1a1),null),__decorate([(0x0,core_1['Post'])(a371_0x509167(0x1d6)),__param(0x0,core_1[a371_0x509167(0x1a0)]['body']()),__metadata(a371_0x509167(0x1d7),Function),__metadata(a371_0x509167(0x1d9),[Object]),__metadata(a371_0x509167(0x1bb),Promise)],VeevaVaultController['prototype'],a371_0x509167(0x1d6),null),VeevaVaultController=__decorate([(0x0,core_1[a371_0x509167(0x199)])(a371_0x509167(0x1c3)),(0x0,core_1[a371_0x509167(0x1b1)])(a371_0x509167(0x195))],VeevaVaultController),exports[a371_0x509167(0x1bf)]=VeevaVaultController;