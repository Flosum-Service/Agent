const a414_0x24fa71=a414_0x536d;(function(_0x305b55,_0x34e2ff){const _0x4768fe=a414_0x536d,_0x2d93f3=_0x305b55();while(!![]){try{const _0x45b7c3=-parseInt(_0x4768fe(0x211))/0x1+-parseInt(_0x4768fe(0x1da))/0x2+parseInt(_0x4768fe(0x1e1))/0x3+parseInt(_0x4768fe(0x1f9))/0x4*(parseInt(_0x4768fe(0x1f2))/0x5)+parseInt(_0x4768fe(0x1d8))/0x6+parseInt(_0x4768fe(0x20e))/0x7+-parseInt(_0x4768fe(0x1d4))/0x8;if(_0x45b7c3===_0x34e2ff)break;else _0x2d93f3['push'](_0x2d93f3['shift']());}catch(_0x5b2d97){_0x2d93f3['push'](_0x2d93f3['shift']());}}}(a414_0x4c65,0x458b4));const a414_0xe2660c=(function(){let _0x521498=!![];return function(_0xb6cfd2,_0x807dda){const _0x23fc00=_0x521498?function(){const _0x347186=a414_0x536d;if(_0x807dda){const _0x4d8c3f=_0x807dda[_0x347186(0x1fb)](_0xb6cfd2,arguments);return _0x807dda=null,_0x4d8c3f;}}:function(){};return _0x521498=![],_0x23fc00;};}()),a414_0x48e7e2=a414_0xe2660c(this,function(){const _0x2c15b8=a414_0x536d;return a414_0x48e7e2[_0x2c15b8(0x20c)]()[_0x2c15b8(0x1db)]('(((.+)+)+)+$')['toString']()['constructor'](a414_0x48e7e2)[_0x2c15b8(0x1db)]('(((.+)+)+)+$');});function a414_0x4c65(){const _0x4d6964=['./services/snapshot.service','./classes/auth/salesforce-auth','753516skvBda','VeevaAuth','FAILURE','v1.1','body','./services/dependency.service','./services/rollback.service','__esModule','DeployService','length','Controller','SUCCESS','RollbackService','getAuthDetails','deployFromBranch','getMessages','./enums/status.enums','112970WFNsiu','default','join','./classes/loggers/logger','./classes/auth/veeva-auth','design:paramtypes','object','44TSKJqr','design:returntype','apply','./classes/errors/base-veeva-error','dependency','__importDefault','__metadata','deploy','../../core','createVeevaRequest','prototype','./utils/salesforce-request.utils','getOwnPropertyDescriptor','SalesforceAuth','param','Version','design:type','message','Post','toString','then','2074597MzEVZj','Logger','createSalesforceRequest','108532sOviLf','defineProperty','./utils/fs-util','instanceUrl','metadata','rollback','__param','finally','makeDir','2948168vQZYjj','retrieveDependency','shortid','function','1782120ZbgIID','execute','662384CWnoSN','search','decorate','AppResponseStatus','./services/deploy.service'];a414_0x4c65=function(){return _0x4d6964;};return a414_0x4c65();}a414_0x48e7e2();function a414_0x536d(_0x1b66ab,_0x175c69){const _0x1ab961=a414_0x4c65();return a414_0x536d=function(_0x48e7e2,_0xe2660c){_0x48e7e2=_0x48e7e2-0x1d2;let _0x4c65fe=_0x1ab961[_0x48e7e2];return _0x4c65fe;},a414_0x536d(_0x1b66ab,_0x175c69);}'use strict';var __decorate=this&&this['__decorate']||function(_0x2d13a4,_0x500352,_0x5487b5,_0x409a3f){const _0x980143=a414_0x536d;var _0x1ac527=arguments[_0x980143(0x1ea)],_0x63e414=_0x1ac527<0x3?_0x500352:_0x409a3f===null?_0x409a3f=Object[_0x980143(0x205)](_0x500352,_0x5487b5):_0x409a3f,_0x17a57f;if(typeof Reflect===_0x980143(0x1f8)&&typeof Reflect[_0x980143(0x1dc)]===_0x980143(0x1d7))_0x63e414=Reflect['decorate'](_0x2d13a4,_0x500352,_0x5487b5,_0x409a3f);else{for(var _0x2d7b6b=_0x2d13a4['length']-0x1;_0x2d7b6b>=0x0;_0x2d7b6b--)if(_0x17a57f=_0x2d13a4[_0x2d7b6b])_0x63e414=(_0x1ac527<0x3?_0x17a57f(_0x63e414):_0x1ac527>0x3?_0x17a57f(_0x500352,_0x5487b5,_0x63e414):_0x17a57f(_0x500352,_0x5487b5))||_0x63e414;}return _0x1ac527>0x3&&_0x63e414&&Object['defineProperty'](_0x500352,_0x5487b5,_0x63e414),_0x63e414;},__metadata=this&&this[a414_0x24fa71(0x1ff)]||function(_0x28129d,_0x2600f7){const _0x947c16=a414_0x24fa71;if(typeof Reflect==='object'&&typeof Reflect[_0x947c16(0x215)]==='function')return Reflect[_0x947c16(0x215)](_0x28129d,_0x2600f7);},__param=this&&this[a414_0x24fa71(0x217)]||function(_0x47811f,_0x53979b){return function(_0x4cfaca,_0x11f938){_0x53979b(_0x4cfaca,_0x11f938,_0x47811f);};},__importDefault=this&&this[a414_0x24fa71(0x1fe)]||function(_0x13f51f){const _0x5c0df9=a414_0x24fa71;return _0x13f51f&&_0x13f51f[_0x5c0df9(0x1e8)]?_0x13f51f:{'default':_0x13f51f};};Object[a414_0x24fa71(0x212)](exports,a414_0x24fa71(0x1e8),{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require(a414_0x24fa71(0x201)),dependency_service_1=require(a414_0x24fa71(0x1e6)),snapshot_service_1=require(a414_0x24fa71(0x1df)),deploy_service_1=require(a414_0x24fa71(0x1de)),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a414_0x24fa71(0x1f1)),shortid_1=__importDefault(require(a414_0x24fa71(0x1d6))),fs_util_1=require(a414_0x24fa71(0x213)),logger_1=require(a414_0x24fa71(0x1f5)),promises_1=require('fs/promises'),base_veeva_error_1=require(a414_0x24fa71(0x1fc)),salesforce_request_utils_1=require(a414_0x24fa71(0x204)),veeva_auth_1=require(a414_0x24fa71(0x1f6)),salesforce_auth_1=require(a414_0x24fa71(0x1e0)),rollback_service_1=require(a414_0x24fa71(0x1e7)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x5ebc1a){const _0x484808=a414_0x24fa71,{veevaAuth:_0x73ac5b,timeZone:_0x1ae5ef,attachmentLogId:_0x4a3a8d}=_0x5ebc1a;try{const _0x32b774=(0x0,veeva_request_utils_1[_0x484808(0x202)])(new veeva_auth_1[(_0x484808(0x1e2))](_0x73ac5b,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x13c9ab=await salesforce_auth_1['SalesforceAuth'][_0x484808(0x1ee)](),_0x5653d5=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x484808(0x206))](_0x13c9ab)),_0xa120f1=new logger_1[(_0x484808(0x20f))](_0x5653d5,_0x1ae5ef,_0x4a3a8d),_0x1761bd=new snapshot_service_1['SnapshotService'](_0x5ebc1a,_0x5653d5,_0x32b774,_0xa120f1);return _0x1761bd[_0x484808(0x1d9)]()[_0x484808(0x20d)](),{'responseStatus':status_enums_1['AppResponseStatus']['SUCCESS']};}catch(_0x1310c4){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x484808(0x1e3)],'responseMessage':_0x1310c4[_0x484808(0x20a)]};}}async[a414_0x24fa71(0x1ef)](_0x19bd71){const _0x5edc68=a414_0x24fa71,{veevaAuth:_0x30bf9c,timeZone:_0x3e1795,attachmentLogId:_0x2cb4f7}=_0x19bd71;try{const _0x4aec44=(0x0,veeva_request_utils_1[_0x5edc68(0x202)])(new veeva_auth_1[(_0x5edc68(0x1e2))](_0x30bf9c,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x11514e=await salesforce_auth_1[_0x5edc68(0x206)][_0x5edc68(0x1ee)](),_0x53e31a=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x5edc68(0x206))](_0x11514e)),_0x2f3b74=new logger_1[(_0x5edc68(0x20f))](_0x53e31a,_0x3e1795,_0x2cb4f7),_0xdf28c7='temp/veeva/deploy_'+(0x0,shortid_1[_0x5edc68(0x1f3)])();await(0x0,fs_util_1[_0x5edc68(0x1d3)])(_0xdf28c7);const _0x2edb6b=new deploy_service_1[(_0x5edc68(0x1e9))](_0x19bd71,_0x53e31a,_0x4aec44,_0x2f3b74,_0xdf28c7,_0x11514e['instanceUrl']);return _0x2edb6b[_0x5edc68(0x1d9)]()[_0x5edc68(0x1d2)](()=>(0x0,promises_1['rm'])(_0xdf28c7,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x5edc68(0x1dd)][_0x5edc68(0x1ec)]};}catch(_0x4d118f){return{'responseStatus':status_enums_1[_0x5edc68(0x1dd)][_0x5edc68(0x1e3)],'responseMessage':_0x4d118f[_0x5edc68(0x20a)]};}}async[a414_0x24fa71(0x1d5)](_0x54e009){const _0x6b80a0=a414_0x24fa71,{veevaAuth:_0x5ae61c}=_0x54e009;try{const _0x2d755=(0x0,veeva_request_utils_1[_0x6b80a0(0x202)])(new veeva_auth_1[(_0x6b80a0(0x1e2))](_0x5ae61c)),_0x4bd57c=await salesforce_auth_1['SalesforceAuth'][_0x6b80a0(0x1ee)](),_0xfbbd3e=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0x4bd57c)),_0x450186=new dependency_service_1['DependencyService'](_0x54e009,_0xfbbd3e,_0x2d755);return await _0x450186[_0x6b80a0(0x1d9)]();}catch(_0x2b65ac){const _0x55924b=_0x2b65ac instanceof base_veeva_error_1['BaseVeevaError']?_0x2b65ac[_0x6b80a0(0x1f0)]()[_0x6b80a0(0x1f4)]('\x0a'):_0x2b65ac[_0x6b80a0(0x20a)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x6b80a0(0x1e3)],'responseMessage':_0x55924b};}}async[a414_0x24fa71(0x216)](_0x3199ad){const _0x5d3d2b=a414_0x24fa71,{veevaAuth:_0x4094ff,timeZone:_0x355aa6,attachmentLogId:_0x5891d9}=_0x3199ad;try{const _0x2143ea=(0x0,veeva_request_utils_1[_0x5d3d2b(0x202)])(new veeva_auth_1['VeevaAuth'](_0x4094ff,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xdc3319=await salesforce_auth_1['SalesforceAuth'][_0x5d3d2b(0x1ee)](),_0x1b04e7=(0x0,salesforce_request_utils_1[_0x5d3d2b(0x210)])(new salesforce_auth_1['SalesforceAuth'](_0xdc3319)),_0x19e0c5=new logger_1['Logger'](_0x1b04e7,_0x355aa6,_0x5891d9),_0x3d9333='temp/veeva/rollback_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x5d3d2b(0x1d3)])(_0x3d9333);const _0x6fa29b=new rollback_service_1[(_0x5d3d2b(0x1ed))]({..._0x3199ad,'connectionVeeva':_0x2143ea,'connectionSalesforce':_0x1b04e7,'logger':_0x19e0c5,'tempFolder':_0x3d9333,'instanceUrl':_0xdc3319[_0x5d3d2b(0x214)]});return _0x6fa29b[_0x5d3d2b(0x1d9)]()[_0x5d3d2b(0x1d2)](()=>(0x0,promises_1['rm'])(_0x3d9333,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x5d3d2b(0x1ec)]};}catch(_0x3ebf89){return{'responseStatus':status_enums_1[_0x5d3d2b(0x1dd)][_0x5d3d2b(0x1e3)],'responseMessage':_0x3ebf89[_0x5d3d2b(0x20a)]};}}};__decorate([(0x0,core_1['Post'])('snapshot'),__param(0x0,core_1[a414_0x24fa71(0x207)][a414_0x24fa71(0x1e5)]()),__metadata('design:type',Function),__metadata(a414_0x24fa71(0x1f7),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],'doSnapshot',null),__decorate([(0x0,core_1['Post'])(a414_0x24fa71(0x200)),__param(0x0,core_1[a414_0x24fa71(0x207)][a414_0x24fa71(0x1e5)]()),__metadata(a414_0x24fa71(0x209),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a414_0x24fa71(0x1ef),null),__decorate([(0x0,core_1['Post'])(a414_0x24fa71(0x1fd)),__param(0x0,core_1[a414_0x24fa71(0x207)][a414_0x24fa71(0x1e5)]()),__metadata(a414_0x24fa71(0x209),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a414_0x24fa71(0x203)],'retrieveDependency',null),__decorate([(0x0,core_1[a414_0x24fa71(0x20b)])(a414_0x24fa71(0x216)),__param(0x0,core_1[a414_0x24fa71(0x207)][a414_0x24fa71(0x1e5)]()),__metadata('design:type',Function),__metadata(a414_0x24fa71(0x1f7),[Object]),__metadata(a414_0x24fa71(0x1fa),Promise)],VeevaVaultController[a414_0x24fa71(0x203)],a414_0x24fa71(0x216),null),VeevaVaultController=__decorate([(0x0,core_1[a414_0x24fa71(0x1eb)])('veeva-vault'),(0x0,core_1[a414_0x24fa71(0x208)])(a414_0x24fa71(0x1e4))],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;