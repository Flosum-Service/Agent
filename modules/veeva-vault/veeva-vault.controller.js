const a370_0x361f08=a370_0x505b;(function(_0x4538d7,_0x432520){const _0x55e5ff=a370_0x505b,_0x1eb36b=_0x4538d7();while(!![]){try{const _0x28685a=parseInt(_0x55e5ff(0x19c))/0x1*(-parseInt(_0x55e5ff(0x1c7))/0x2)+-parseInt(_0x55e5ff(0x1b5))/0x3*(-parseInt(_0x55e5ff(0x19e))/0x4)+-parseInt(_0x55e5ff(0x1a0))/0x5*(-parseInt(_0x55e5ff(0x1b1))/0x6)+parseInt(_0x55e5ff(0x1c1))/0x7*(parseInt(_0x55e5ff(0x199))/0x8)+parseInt(_0x55e5ff(0x18f))/0x9*(parseInt(_0x55e5ff(0x1be))/0xa)+-parseInt(_0x55e5ff(0x1b8))/0xb*(-parseInt(_0x55e5ff(0x1bc))/0xc)+-parseInt(_0x55e5ff(0x19f))/0xd*(parseInt(_0x55e5ff(0x1a1))/0xe);if(_0x28685a===_0x432520)break;else _0x1eb36b['push'](_0x1eb36b['shift']());}catch(_0x97b2af){_0x1eb36b['push'](_0x1eb36b['shift']());}}}(a370_0x45c9,0x33af0));const a370_0x5a5237=(function(){let _0x534018=!![];return function(_0x582897,_0x2dd3ed){const _0x31f1d0=_0x534018?function(){const _0x58af98=a370_0x505b;if(_0x2dd3ed){const _0x2209ea=_0x2dd3ed[_0x58af98(0x18c)](_0x582897,arguments);return _0x2dd3ed=null,_0x2209ea;}}:function(){};return _0x534018=![],_0x31f1d0;};}()),a370_0x484ccc=a370_0x5a5237(this,function(){const _0x5b2de8=a370_0x505b;return a370_0x484ccc[_0x5b2de8(0x1b3)]()[_0x5b2de8(0x1c3)](_0x5b2de8(0x1cf))[_0x5b2de8(0x1b3)]()['constructor'](a370_0x484ccc)['search']('(((.+)+)+)+$');});function a370_0x45c9(){const _0x58f8b9=['finally','param','__metadata','design:type','retrieveDependency','deploy','apply','rollback','__esModule','9KGMnrw','body','length','fs/promises','function','SUCCESS','getOwnPropertyDescriptor','design:returntype','design:paramtypes','instanceUrl','24MosvLU','then','./utils/fs-util','3SiqQyo','AppResponseStatus','2276PJnCGk','1003301pdlbZk','68815vbFTiG','112LQogyN','SnapshotService','getAuthDetails','./classes/errors/base-veeva-error','deployFromBranch','Post','BaseVeevaError','temp/veeva/deploy_','decorate','Controller','default','defineProperty','./utils/salesforce-request.utils','createSalesforceRequest','__param','../../core','96FcfxHV','Version','toString','VeevaAuth','1698ACCeXy','message','./classes/auth/salesforce-auth','11OvLAVM','./enums/status.enums','execute','FAILURE','130836nwIyTE','./classes/auth/veeva-auth','3533410QrYhhH','Logger','./services/deploy.service','71568VRrxfA','./services/dependency.service','search','__decorate','object','./services/rollback.service','72044mlNIRJ','metadata','DependencyService','createVeevaRequest','SalesforceAuth','prototype','dependency','shortid','(((.+)+)+)+$','DeployService'];a370_0x45c9=function(){return _0x58f8b9;};return a370_0x45c9();}a370_0x484ccc();function a370_0x505b(_0x3ee6f2,_0x2bf1ff){const _0x2243d4=a370_0x45c9();return a370_0x505b=function(_0x484ccc,_0x5a5237){_0x484ccc=_0x484ccc-0x185;let _0x45c934=_0x2243d4[_0x484ccc];return _0x45c934;},a370_0x505b(_0x3ee6f2,_0x2bf1ff);}'use strict';var __decorate=this&&this[a370_0x361f08(0x1c4)]||function(_0x2925a3,_0x35d018,_0x67de89,_0x557887){const _0x533216=a370_0x361f08;var _0x94310=arguments[_0x533216(0x191)],_0x5ce16c=_0x94310<0x3?_0x35d018:_0x557887===null?_0x557887=Object[_0x533216(0x195)](_0x35d018,_0x67de89):_0x557887,_0x2f9901;if(typeof Reflect===_0x533216(0x1c5)&&typeof Reflect[_0x533216(0x1a9)]===_0x533216(0x193))_0x5ce16c=Reflect['decorate'](_0x2925a3,_0x35d018,_0x67de89,_0x557887);else{for(var _0x1f265c=_0x2925a3[_0x533216(0x191)]-0x1;_0x1f265c>=0x0;_0x1f265c--)if(_0x2f9901=_0x2925a3[_0x1f265c])_0x5ce16c=(_0x94310<0x3?_0x2f9901(_0x5ce16c):_0x94310>0x3?_0x2f9901(_0x35d018,_0x67de89,_0x5ce16c):_0x2f9901(_0x35d018,_0x67de89))||_0x5ce16c;}return _0x94310>0x3&&_0x5ce16c&&Object[_0x533216(0x1ac)](_0x35d018,_0x67de89,_0x5ce16c),_0x5ce16c;},__metadata=this&&this[a370_0x361f08(0x188)]||function(_0x59d16b,_0x5cb7dd){const _0x5170fb=a370_0x361f08;if(typeof Reflect===_0x5170fb(0x1c5)&&typeof Reflect[_0x5170fb(0x1c8)]===_0x5170fb(0x193))return Reflect[_0x5170fb(0x1c8)](_0x59d16b,_0x5cb7dd);},__param=this&&this[a370_0x361f08(0x1af)]||function(_0x59ee5f,_0x38e7b9){return function(_0x12d3b2,_0x116388){_0x38e7b9(_0x12d3b2,_0x116388,_0x59ee5f);};},__importDefault=this&&this['__importDefault']||function(_0x46f9d9){const _0x3e7e3d=a370_0x361f08;return _0x46f9d9&&_0x46f9d9[_0x3e7e3d(0x18e)]?_0x46f9d9:{'default':_0x46f9d9};};Object[a370_0x361f08(0x1ac)](exports,a370_0x361f08(0x18e),{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require(a370_0x361f08(0x1b0)),dependency_service_1=require(a370_0x361f08(0x1c2)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a370_0x361f08(0x1c0)),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a370_0x361f08(0x1b9)),shortid_1=__importDefault(require(a370_0x361f08(0x1ce))),fs_util_1=require(a370_0x361f08(0x19b)),logger_1=require('./classes/loggers/logger'),promises_1=require(a370_0x361f08(0x192)),base_veeva_error_1=require(a370_0x361f08(0x1a4)),salesforce_request_utils_1=require(a370_0x361f08(0x1ad)),veeva_auth_1=require(a370_0x361f08(0x1bd)),salesforce_auth_1=require(a370_0x361f08(0x1b7)),rollback_service_1=require(a370_0x361f08(0x1c6)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x1fe960){const _0x2b60e9=a370_0x361f08,{veevaAuth:_0x411eda,timeZone:_0x56a1fe,attachmentLogId:_0x59daeb}=_0x1fe960;try{const _0x40ad5e=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x2b60e9(0x1b4))](_0x411eda,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x401de8=await salesforce_auth_1['SalesforceAuth'][_0x2b60e9(0x1a3)](),_0x3f8435=(0x0,salesforce_request_utils_1[_0x2b60e9(0x1ae)])(new salesforce_auth_1[(_0x2b60e9(0x1cb))](_0x401de8)),_0x165173=new logger_1['Logger'](_0x3f8435,_0x56a1fe,_0x59daeb),_0x2c4ada=new snapshot_service_1[(_0x2b60e9(0x1a2))](_0x1fe960,_0x3f8435,_0x40ad5e,_0x165173);return _0x2c4ada[_0x2b60e9(0x1ba)]()[_0x2b60e9(0x19a)](),{'responseStatus':status_enums_1[_0x2b60e9(0x19d)][_0x2b60e9(0x194)]};}catch(_0x26faab){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x2b60e9(0x1bb)],'responseMessage':_0x26faab[_0x2b60e9(0x1b6)]};}}async[a370_0x361f08(0x1a5)](_0x199957){const _0x554080=a370_0x361f08,{veevaAuth:_0x1d9d61,timeZone:_0x9664ee,attachmentLogId:_0x13e69a}=_0x199957;try{const _0x3ef3a0=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x554080(0x1b4))](_0x1d9d61,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x391cfe=await salesforce_auth_1['SalesforceAuth'][_0x554080(0x1a3)](),_0xebbf79=(0x0,salesforce_request_utils_1[_0x554080(0x1ae)])(new salesforce_auth_1[(_0x554080(0x1cb))](_0x391cfe)),_0x1052e0=new logger_1['Logger'](_0xebbf79,_0x9664ee,_0x13e69a),_0x1fa142=_0x554080(0x1a8)+(0x0,shortid_1['default'])();await(0x0,fs_util_1['makeDir'])(_0x1fa142);const _0x40ffba=new deploy_service_1[(_0x554080(0x185))](_0x199957,_0xebbf79,_0x3ef3a0,_0x1052e0,_0x1fa142,_0x391cfe[_0x554080(0x198)]);return _0x40ffba[_0x554080(0x1ba)]()[_0x554080(0x186)](()=>(0x0,promises_1['rm'])(_0x1fa142,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x554080(0x194)]};}catch(_0x4bb9e3){return{'responseStatus':status_enums_1[_0x554080(0x19d)][_0x554080(0x1bb)],'responseMessage':_0x4bb9e3[_0x554080(0x1b6)]};}}async['retrieveDependency'](_0x1d46f7){const _0x4708d2=a370_0x361f08,{veevaAuth:_0x5e6112}=_0x1d46f7;try{const _0x2fd182=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x4708d2(0x1b4))](_0x5e6112)),_0x395f1a=await salesforce_auth_1[_0x4708d2(0x1cb)][_0x4708d2(0x1a3)](),_0x624c85=(0x0,salesforce_request_utils_1[_0x4708d2(0x1ae)])(new salesforce_auth_1[(_0x4708d2(0x1cb))](_0x395f1a)),_0x5c9194=new dependency_service_1[(_0x4708d2(0x1c9))](_0x1d46f7,_0x624c85,_0x2fd182);return await _0x5c9194[_0x4708d2(0x1ba)]();}catch(_0x273dc1){const _0x11f8bf=_0x273dc1 instanceof base_veeva_error_1[_0x4708d2(0x1a7)]?_0x273dc1['getMessages']()['join']('\x0a'):_0x273dc1[_0x4708d2(0x1b6)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x4708d2(0x1bb)],'responseMessage':_0x11f8bf};}}async[a370_0x361f08(0x18d)](_0x377047){const _0x303981=a370_0x361f08,{veevaAuth:_0x45e5d1,timeZone:_0x969500,attachmentLogId:_0x2e28c6}=_0x377047;try{const _0x2887ff=(0x0,veeva_request_utils_1[_0x303981(0x1ca)])(new veeva_auth_1[(_0x303981(0x1b4))](_0x45e5d1,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x239599=await salesforce_auth_1[_0x303981(0x1cb)][_0x303981(0x1a3)](),_0x24b1e2=(0x0,salesforce_request_utils_1[_0x303981(0x1ae)])(new salesforce_auth_1[(_0x303981(0x1cb))](_0x239599)),_0x1c3821=new logger_1[(_0x303981(0x1bf))](_0x24b1e2,_0x969500,_0x2e28c6),_0x3d7278='temp/veeva/rollback_'+(0x0,shortid_1[_0x303981(0x1ab)])();await(0x0,fs_util_1['makeDir'])(_0x3d7278);const _0x8c974e=new rollback_service_1['RollbackService']({..._0x377047,'connectionVeeva':_0x2887ff,'connectionSalesforce':_0x24b1e2,'logger':_0x1c3821,'tempFolder':_0x3d7278,'instanceUrl':_0x239599[_0x303981(0x198)]});return _0x8c974e[_0x303981(0x1ba)]()['finally'](()=>(0x0,promises_1['rm'])(_0x3d7278,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x303981(0x19d)][_0x303981(0x194)]};}catch(_0x5b1322){return{'responseStatus':status_enums_1[_0x303981(0x19d)][_0x303981(0x1bb)],'responseMessage':_0x5b1322[_0x303981(0x1b6)]};}}};__decorate([(0x0,core_1[a370_0x361f08(0x1a6)])('snapshot'),__param(0x0,core_1[a370_0x361f08(0x187)][a370_0x361f08(0x190)]()),__metadata(a370_0x361f08(0x189),Function),__metadata(a370_0x361f08(0x197),[Object]),__metadata(a370_0x361f08(0x196),Promise)],VeevaVaultController[a370_0x361f08(0x1cc)],'doSnapshot',null),__decorate([(0x0,core_1['Post'])(a370_0x361f08(0x18b)),__param(0x0,core_1[a370_0x361f08(0x187)]['body']()),__metadata(a370_0x361f08(0x189),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a370_0x361f08(0x1a5),null),__decorate([(0x0,core_1[a370_0x361f08(0x1a6)])(a370_0x361f08(0x1cd)),__param(0x0,core_1[a370_0x361f08(0x187)][a370_0x361f08(0x190)]()),__metadata(a370_0x361f08(0x189),Function),__metadata(a370_0x361f08(0x197),[Object]),__metadata(a370_0x361f08(0x196),Promise)],VeevaVaultController[a370_0x361f08(0x1cc)],a370_0x361f08(0x18a),null),__decorate([(0x0,core_1['Post'])(a370_0x361f08(0x18d)),__param(0x0,core_1[a370_0x361f08(0x187)]['body']()),__metadata('design:type',Function),__metadata(a370_0x361f08(0x197),[Object]),__metadata(a370_0x361f08(0x196),Promise)],VeevaVaultController[a370_0x361f08(0x1cc)],a370_0x361f08(0x18d),null),VeevaVaultController=__decorate([(0x0,core_1[a370_0x361f08(0x1aa)])('veeva-vault'),(0x0,core_1[a370_0x361f08(0x1b2)])('v1.1')],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;