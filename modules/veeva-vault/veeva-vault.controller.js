const a414_0x298994=a414_0x3e04;(function(_0x50a8b2,_0xd222b6){const _0x4b9445=a414_0x3e04,_0x576451=_0x50a8b2();while(!![]){try{const _0x527c2d=parseInt(_0x4b9445(0x18d))/0x1*(parseInt(_0x4b9445(0x1b5))/0x2)+parseInt(_0x4b9445(0x1a1))/0x3+-parseInt(_0x4b9445(0x18e))/0x4*(parseInt(_0x4b9445(0x176))/0x5)+-parseInt(_0x4b9445(0x1b2))/0x6+-parseInt(_0x4b9445(0x1aa))/0x7+-parseInt(_0x4b9445(0x17a))/0x8+parseInt(_0x4b9445(0x182))/0x9*(parseInt(_0x4b9445(0x185))/0xa);if(_0x527c2d===_0xd222b6)break;else _0x576451['push'](_0x576451['shift']());}catch(_0x11036e){_0x576451['push'](_0x576451['shift']());}}}(a414_0x3cc0,0xcc728));function a414_0x3e04(_0xcd9ac4,_0x579798){const _0x2413c1=a414_0x3cc0();return a414_0x3e04=function(_0x1cf434,_0x21aef8){_0x1cf434=_0x1cf434-0x174;let _0x3cc011=_0x2413c1[_0x1cf434];return _0x3cc011;},a414_0x3e04(_0xcd9ac4,_0x579798);}const a414_0x21aef8=(function(){let _0x21fbee=!![];return function(_0x2197ce,_0x5a8d47){const _0x5246f5=_0x21fbee?function(){if(_0x5a8d47){const _0x94ed8b=_0x5a8d47['apply'](_0x2197ce,arguments);return _0x5a8d47=null,_0x94ed8b;}}:function(){};return _0x21fbee=![],_0x5246f5;};}()),a414_0x1cf434=a414_0x21aef8(this,function(){const _0x3ed7e0=a414_0x3e04;return a414_0x1cf434[_0x3ed7e0(0x18f)]()[_0x3ed7e0(0x19e)](_0x3ed7e0(0x18a))[_0x3ed7e0(0x18f)]()[_0x3ed7e0(0x180)](a414_0x1cf434)[_0x3ed7e0(0x19e)](_0x3ed7e0(0x18a));});a414_0x1cf434();'use strict';var __decorate=this&&this[a414_0x298994(0x19a)]||function(_0x2b27c0,_0x47c995,_0x3a29fd,_0x32ec88){const _0x555e5f=a414_0x298994;var _0x9cd21e=arguments[_0x555e5f(0x186)],_0x1bc732=_0x9cd21e<0x3?_0x47c995:_0x32ec88===null?_0x32ec88=Object[_0x555e5f(0x190)](_0x47c995,_0x3a29fd):_0x32ec88,_0xd1b7b8;if(typeof Reflect==='object'&&typeof Reflect[_0x555e5f(0x1a2)]===_0x555e5f(0x19d))_0x1bc732=Reflect[_0x555e5f(0x1a2)](_0x2b27c0,_0x47c995,_0x3a29fd,_0x32ec88);else{for(var _0x405a3e=_0x2b27c0[_0x555e5f(0x186)]-0x1;_0x405a3e>=0x0;_0x405a3e--)if(_0xd1b7b8=_0x2b27c0[_0x405a3e])_0x1bc732=(_0x9cd21e<0x3?_0xd1b7b8(_0x1bc732):_0x9cd21e>0x3?_0xd1b7b8(_0x47c995,_0x3a29fd,_0x1bc732):_0xd1b7b8(_0x47c995,_0x3a29fd))||_0x1bc732;}return _0x9cd21e>0x3&&_0x1bc732&&Object['defineProperty'](_0x47c995,_0x3a29fd,_0x1bc732),_0x1bc732;},__metadata=this&&this[a414_0x298994(0x193)]||function(_0x5daf8d,_0x1e3aa6){const _0xdef1f4=a414_0x298994;if(typeof Reflect===_0xdef1f4(0x1bd)&&typeof Reflect['metadata']==='function')return Reflect[_0xdef1f4(0x1a9)](_0x5daf8d,_0x1e3aa6);},__param=this&&this[a414_0x298994(0x196)]||function(_0x1f69be,_0x3846f2){return function(_0x5e077b,_0x56ae95){_0x3846f2(_0x5e077b,_0x56ae95,_0x1f69be);};},__importDefault=this&&this[a414_0x298994(0x1ab)]||function(_0x184d6a){const _0xac071a=a414_0x298994;return _0x184d6a&&_0x184d6a[_0xac071a(0x1b9)]?_0x184d6a:{'default':_0x184d6a};};Object['defineProperty'](exports,a414_0x298994(0x1b9),{'value':!![]}),exports[a414_0x298994(0x174)]=void 0x0;const core_1=require(a414_0x298994(0x1a8)),dependency_service_1=require(a414_0x298994(0x194)),snapshot_service_1=require(a414_0x298994(0x178)),deploy_service_1=require(a414_0x298994(0x183)),veeva_request_utils_1=require(a414_0x298994(0x1b1)),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require(a414_0x298994(0x1a6))),fs_util_1=require(a414_0x298994(0x192)),logger_1=require(a414_0x298994(0x1b3)),promises_1=require(a414_0x298994(0x17d)),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require(a414_0x298994(0x18c)),salesforce_auth_1=require(a414_0x298994(0x189)),rollback_service_1=require(a414_0x298994(0x1b6)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;function a414_0x3cc0(){const _0x4a82b9=['DeployService','veeva-vault','./classes/auth/salesforce-auth','(((.+)+)+)+$','design:paramtypes','./classes/auth/veeva-auth','140977bWOyOF','124ZNlgXm','toString','getOwnPropertyDescriptor','default','./utils/fs-util','__metadata','./services/dependency.service','deploy','__param','deployFromBranch','param','AppResponseStatus','__decorate','temp/veeva/deploy_','message','function','search','getAuthDetails','retrieveDependency','2369268JcpaWM','decorate','finally','temp/veeva/rollback_','snapshot','shortid','SnapshotService','../../core','metadata','6736975jxJeeQ','__importDefault','execute','SUCCESS','createVeevaRequest','Logger','dependency','./utils/veeva-request.utils','5240736oVLpnl','./classes/loggers/logger','getMessages','8UbEwQz','./services/rollback.service','makeDir','VeevaAuth','__esModule','design:returntype','createSalesforceRequest','instanceUrl','object','doSnapshot','VeevaVaultController','prototype','167045dxQinP','body','./services/snapshot.service','rollback','4397280jyGoWm','Controller','design:type','fs/promises','SalesforceAuth','DependencyService','constructor','Post','1244988xZsJee','./services/deploy.service','FAILURE','210TCcDzi','length'];a414_0x3cc0=function(){return _0x4a82b9;};return a414_0x3cc0();}let VeevaVaultController=class VeevaVaultController{async[a414_0x298994(0x1be)](_0x575cac){const _0x38b6f1=a414_0x298994,{veevaAuth:_0x593d78,timeZone:_0x16606e,attachmentLogId:_0x296c9c}=_0x575cac;try{const _0x510148=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1['VeevaAuth'](_0x593d78,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x558268=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x247e64=(0x0,salesforce_request_utils_1[_0x38b6f1(0x1bb)])(new salesforce_auth_1['SalesforceAuth'](_0x558268)),_0x901993=new logger_1[(_0x38b6f1(0x1af))](_0x247e64,_0x16606e,_0x296c9c),_0x2672f5=new snapshot_service_1[(_0x38b6f1(0x1a7))](_0x575cac,_0x247e64,_0x510148,_0x901993);return _0x2672f5['execute']()['then'](),{'responseStatus':status_enums_1[_0x38b6f1(0x199)]['SUCCESS']};}catch(_0xd5c1af){return{'responseStatus':status_enums_1[_0x38b6f1(0x199)][_0x38b6f1(0x184)],'responseMessage':_0xd5c1af['message']};}}async[a414_0x298994(0x197)](_0xc916e4){const _0x11bbf6=a414_0x298994,{veevaAuth:_0x32a7a9,timeZone:_0x265df3,attachmentLogId:_0x2dcffc}=_0xc916e4;try{const _0x47f640=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x11bbf6(0x1b8))](_0x32a7a9,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2f8e52=await salesforce_auth_1[_0x11bbf6(0x17e)][_0x11bbf6(0x19f)](),_0x34e559=(0x0,salesforce_request_utils_1[_0x11bbf6(0x1bb)])(new salesforce_auth_1[(_0x11bbf6(0x17e))](_0x2f8e52)),_0x25fd17=new logger_1[(_0x11bbf6(0x1af))](_0x34e559,_0x265df3,_0x2dcffc),_0x1f97b9=_0x11bbf6(0x19b)+(0x0,shortid_1[_0x11bbf6(0x191)])();await(0x0,fs_util_1[_0x11bbf6(0x1b7)])(_0x1f97b9);const _0x22afdc=new deploy_service_1[(_0x11bbf6(0x187))](_0xc916e4,_0x34e559,_0x47f640,_0x25fd17,_0x1f97b9,_0x2f8e52[_0x11bbf6(0x1bc)]);return _0x22afdc[_0x11bbf6(0x1ac)]()['finally'](()=>(0x0,promises_1['rm'])(_0x1f97b9,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus']['SUCCESS']};}catch(_0x3d4c39){return{'responseStatus':status_enums_1[_0x11bbf6(0x199)]['FAILURE'],'responseMessage':_0x3d4c39[_0x11bbf6(0x19c)]};}}async['retrieveDependency'](_0x1dd8f1){const _0x11b583=a414_0x298994,{veevaAuth:_0x518235}=_0x1dd8f1;try{const _0x24aed7=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x11b583(0x1b8))](_0x518235)),_0x330e33=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x5d1fb2=(0x0,salesforce_request_utils_1[_0x11b583(0x1bb)])(new salesforce_auth_1[(_0x11b583(0x17e))](_0x330e33)),_0x3dae40=new dependency_service_1[(_0x11b583(0x17f))](_0x1dd8f1,_0x5d1fb2,_0x24aed7);return await _0x3dae40['execute']();}catch(_0x32dc78){const _0x5bcb1d=_0x32dc78 instanceof base_veeva_error_1['BaseVeevaError']?_0x32dc78[_0x11b583(0x1b4)]()['join']('\x0a'):_0x32dc78[_0x11b583(0x19c)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x11b583(0x184)],'responseMessage':_0x5bcb1d};}}async[a414_0x298994(0x179)](_0x311711){const _0x161f4d=a414_0x298994,{veevaAuth:_0x3d61f5,timeZone:_0x187853,attachmentLogId:_0x2d41a6}=_0x311711;try{const _0x2b89e0=(0x0,veeva_request_utils_1[_0x161f4d(0x1ae)])(new veeva_auth_1['VeevaAuth'](_0x3d61f5,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x43741c=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x296363=(0x0,salesforce_request_utils_1[_0x161f4d(0x1bb)])(new salesforce_auth_1[(_0x161f4d(0x17e))](_0x43741c)),_0x4bcadb=new logger_1['Logger'](_0x296363,_0x187853,_0x2d41a6),_0x4acdbf=_0x161f4d(0x1a4)+(0x0,shortid_1[_0x161f4d(0x191)])();await(0x0,fs_util_1['makeDir'])(_0x4acdbf);const _0x1d5488=new rollback_service_1['RollbackService']({..._0x311711,'connectionVeeva':_0x2b89e0,'connectionSalesforce':_0x296363,'logger':_0x4bcadb,'tempFolder':_0x4acdbf,'instanceUrl':_0x43741c[_0x161f4d(0x1bc)]});return _0x1d5488['execute']()[_0x161f4d(0x1a3)](()=>(0x0,promises_1['rm'])(_0x4acdbf,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x161f4d(0x199)][_0x161f4d(0x1ad)]};}catch(_0x558f31){return{'responseStatus':status_enums_1[_0x161f4d(0x199)]['FAILURE'],'responseMessage':_0x558f31[_0x161f4d(0x19c)]};}}};__decorate([(0x0,core_1[a414_0x298994(0x181)])(a414_0x298994(0x1a5)),__param(0x0,core_1['param'][a414_0x298994(0x177)]()),__metadata('design:type',Function),__metadata(a414_0x298994(0x18b),[Object]),__metadata(a414_0x298994(0x1ba),Promise)],VeevaVaultController['prototype'],a414_0x298994(0x1be),null),__decorate([(0x0,core_1[a414_0x298994(0x181)])(a414_0x298994(0x195)),__param(0x0,core_1['param'][a414_0x298994(0x177)]()),__metadata(a414_0x298994(0x17c),Function),__metadata('design:paramtypes',[Object]),__metadata(a414_0x298994(0x1ba),Promise)],VeevaVaultController[a414_0x298994(0x175)],a414_0x298994(0x197),null),__decorate([(0x0,core_1['Post'])(a414_0x298994(0x1b0)),__param(0x0,core_1[a414_0x298994(0x198)][a414_0x298994(0x177)]()),__metadata(a414_0x298994(0x17c),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a414_0x298994(0x1a0),null),__decorate([(0x0,core_1[a414_0x298994(0x181)])('rollback'),__param(0x0,core_1['param'][a414_0x298994(0x177)]()),__metadata(a414_0x298994(0x17c),Function),__metadata('design:paramtypes',[Object]),__metadata(a414_0x298994(0x1ba),Promise)],VeevaVaultController[a414_0x298994(0x175)],a414_0x298994(0x179),null),VeevaVaultController=__decorate([(0x0,core_1[a414_0x298994(0x17b)])(a414_0x298994(0x188)),(0x0,core_1['Version'])('v1.1')],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;