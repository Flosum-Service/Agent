const a371_0x45f606=a371_0x3db6;(function(_0x47321b,_0x17808e){const _0x2751c8=a371_0x3db6,_0xb67e32=_0x47321b();while(!![]){try{const _0xf64368=-parseInt(_0x2751c8(0x108))/0x1+-parseInt(_0x2751c8(0x10c))/0x2+parseInt(_0x2751c8(0xfd))/0x3+parseInt(_0x2751c8(0x109))/0x4+-parseInt(_0x2751c8(0x128))/0x5*(parseInt(_0x2751c8(0x110))/0x6)+parseInt(_0x2751c8(0x101))/0x7*(parseInt(_0x2751c8(0x11e))/0x8)+-parseInt(_0x2751c8(0x104))/0x9;if(_0xf64368===_0x17808e)break;else _0xb67e32['push'](_0xb67e32['shift']());}catch(_0x2ad179){_0xb67e32['push'](_0xb67e32['shift']());}}}(a371_0x288c,0xd3938));function a371_0x288c(){const _0x1a4342=['__metadata','./services/rollback.service','./utils/salesforce-request.utils','__esModule','9030nDMOex','../../core','Post','Controller','AppResponseStatus','makeDir','DependencyService','execute','message','DeployService','__param','v1.1','decorate','Logger','./classes/auth/salesforce-auth','getOwnPropertyDescriptor','snapshot','./classes/loggers/logger','SalesforceAuth','Version','./services/dependency.service','finally','metadata','fs/promises','dependency','VeevaAuth','FAILURE','search','default','instanceUrl','getAuthDetails','join','SUCCESS','5111226RIQRQh','temp/veeva/deploy_','shortid','temp/veeva/rollback_','2752001MaiGsd','doSnapshot','SnapshotService','186237bnwcbd','./enums/status.enums','design:paramtypes','param','790118daVsbF','6179240Ydzzjq','./classes/errors/base-veeva-error','VeevaVaultController','2333384tmkqrH','prototype','object','toString','5262bQutaf','body','createSalesforceRequest','apply','__importDefault','__decorate','getMessages','deployFromBranch','constructor','design:type','retrieveDependency','rollback','deploy','length','24nBjjDd','createVeevaRequest','defineProperty','function','(((.+)+)+)+$','design:returntype'];a371_0x288c=function(){return _0x1a4342;};return a371_0x288c();}const a371_0x4f6004=(function(){let _0xb2a63e=!![];return function(_0x2761c8,_0x274f75){const _0xe88feb=_0xb2a63e?function(){const _0xb16d52=a371_0x3db6;if(_0x274f75){const _0x29c046=_0x274f75[_0xb16d52(0x113)](_0x2761c8,arguments);return _0x274f75=null,_0x29c046;}}:function(){};return _0xb2a63e=![],_0xe88feb;};}()),a371_0x2b3c41=a371_0x4f6004(this,function(){const _0x175d58=a371_0x3db6;return a371_0x2b3c41[_0x175d58(0x10f)]()[_0x175d58(0xf7)](_0x175d58(0x122))[_0x175d58(0x10f)]()[_0x175d58(0x118)](a371_0x2b3c41)[_0x175d58(0xf7)](_0x175d58(0x122));});a371_0x2b3c41();'use strict';var __decorate=this&&this[a371_0x45f606(0x115)]||function(_0x53bbe7,_0x49f466,_0x136f77,_0x29d271){const _0x4c947b=a371_0x45f606;var _0x3b74ab=arguments['length'],_0x2e178c=_0x3b74ab<0x3?_0x49f466:_0x29d271===null?_0x29d271=Object[_0x4c947b(0x137)](_0x49f466,_0x136f77):_0x29d271,_0x28016b;if(typeof Reflect===_0x4c947b(0x10e)&&typeof Reflect[_0x4c947b(0x134)]===_0x4c947b(0x121))_0x2e178c=Reflect[_0x4c947b(0x134)](_0x53bbe7,_0x49f466,_0x136f77,_0x29d271);else{for(var _0x5aecf4=_0x53bbe7[_0x4c947b(0x11d)]-0x1;_0x5aecf4>=0x0;_0x5aecf4--)if(_0x28016b=_0x53bbe7[_0x5aecf4])_0x2e178c=(_0x3b74ab<0x3?_0x28016b(_0x2e178c):_0x3b74ab>0x3?_0x28016b(_0x49f466,_0x136f77,_0x2e178c):_0x28016b(_0x49f466,_0x136f77))||_0x2e178c;}return _0x3b74ab>0x3&&_0x2e178c&&Object[_0x4c947b(0x120)](_0x49f466,_0x136f77,_0x2e178c),_0x2e178c;},__metadata=this&&this[a371_0x45f606(0x124)]||function(_0x1bda99,_0x1cda86){const _0x295669=a371_0x45f606;if(typeof Reflect===_0x295669(0x10e)&&typeof Reflect[_0x295669(0xf2)]===_0x295669(0x121))return Reflect['metadata'](_0x1bda99,_0x1cda86);},__param=this&&this[a371_0x45f606(0x132)]||function(_0x1dcaaa,_0x2036c6){return function(_0x16c75c,_0x532903){_0x2036c6(_0x16c75c,_0x532903,_0x1dcaaa);};},__importDefault=this&&this[a371_0x45f606(0x114)]||function(_0x49d3c2){const _0x260164=a371_0x45f606;return _0x49d3c2&&_0x49d3c2[_0x260164(0x127)]?_0x49d3c2:{'default':_0x49d3c2};};function a371_0x3db6(_0x4db800,_0xc3202c){const _0x5ee34e=a371_0x288c();return a371_0x3db6=function(_0x2b3c41,_0x4f6004){_0x2b3c41=_0x2b3c41-0xed;let _0x288cb1=_0x5ee34e[_0x2b3c41];return _0x288cb1;},a371_0x3db6(_0x4db800,_0xc3202c);}Object[a371_0x45f606(0x120)](exports,a371_0x45f606(0x127),{'value':!![]}),exports[a371_0x45f606(0x10b)]=void 0x0;const core_1=require(a371_0x45f606(0x129)),dependency_service_1=require(a371_0x45f606(0xf0)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a371_0x45f606(0x105)),shortid_1=__importDefault(require(a371_0x45f606(0xff))),fs_util_1=require('./utils/fs-util'),logger_1=require(a371_0x45f606(0xed)),promises_1=require(a371_0x45f606(0xf3)),base_veeva_error_1=require(a371_0x45f606(0x10a)),salesforce_request_utils_1=require(a371_0x45f606(0x126)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a371_0x45f606(0x136)),rollback_service_1=require(a371_0x45f606(0x125)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a371_0x45f606(0x102)](_0x3e9e62){const _0x1501dc=a371_0x45f606,{veevaAuth:_0x59a1e1,timeZone:_0x17d321,attachmentLogId:_0x12572b}=_0x3e9e62;try{const _0x563f95=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x1501dc(0xf5))](_0x59a1e1,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5723fc=await salesforce_auth_1[_0x1501dc(0xee)][_0x1501dc(0xfa)](),_0x39741b=(0x0,salesforce_request_utils_1[_0x1501dc(0x112)])(new salesforce_auth_1['SalesforceAuth'](_0x5723fc)),_0x429149=new logger_1[(_0x1501dc(0x135))](_0x39741b,_0x17d321,_0x12572b),_0xed0e4e=new snapshot_service_1[(_0x1501dc(0x103))](_0x3e9e62,_0x39741b,_0x563f95,_0x429149);return _0xed0e4e[_0x1501dc(0x12f)]()['then'](),{'responseStatus':status_enums_1[_0x1501dc(0x12c)][_0x1501dc(0xfc)]};}catch(_0x2e320e){return{'responseStatus':status_enums_1[_0x1501dc(0x12c)][_0x1501dc(0xf6)],'responseMessage':_0x2e320e[_0x1501dc(0x130)]};}}async[a371_0x45f606(0x117)](_0x36a3ce){const _0x2dfccd=a371_0x45f606,{veevaAuth:_0x964d91,timeZone:_0x5585a0,attachmentLogId:_0x15097d}=_0x36a3ce;try{const _0x5a8e18=(0x0,veeva_request_utils_1[_0x2dfccd(0x11f)])(new veeva_auth_1[(_0x2dfccd(0xf5))](_0x964d91,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5f4dd0=await salesforce_auth_1[_0x2dfccd(0xee)]['getAuthDetails'](),_0x52e80d=(0x0,salesforce_request_utils_1[_0x2dfccd(0x112)])(new salesforce_auth_1[(_0x2dfccd(0xee))](_0x5f4dd0)),_0x1e6c5d=new logger_1[(_0x2dfccd(0x135))](_0x52e80d,_0x5585a0,_0x15097d),_0x28a9f4=_0x2dfccd(0xfe)+(0x0,shortid_1['default'])();await(0x0,fs_util_1['makeDir'])(_0x28a9f4);const _0x1aaf4a=new deploy_service_1[(_0x2dfccd(0x131))](_0x36a3ce,_0x52e80d,_0x5a8e18,_0x1e6c5d,_0x28a9f4,_0x5f4dd0[_0x2dfccd(0xf9)]);return _0x1aaf4a[_0x2dfccd(0x12f)]()['finally'](()=>(0x0,promises_1['rm'])(_0x28a9f4,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x2dfccd(0x12c)]['SUCCESS']};}catch(_0x128294){return{'responseStatus':status_enums_1[_0x2dfccd(0x12c)]['FAILURE'],'responseMessage':_0x128294[_0x2dfccd(0x130)]};}}async[a371_0x45f606(0x11a)](_0x92f0a5){const _0x226d59=a371_0x45f606,{veevaAuth:_0x2191e0}=_0x92f0a5;try{const _0x25de2a=(0x0,veeva_request_utils_1[_0x226d59(0x11f)])(new veeva_auth_1[(_0x226d59(0xf5))](_0x2191e0)),_0x1aeadb=await salesforce_auth_1[_0x226d59(0xee)][_0x226d59(0xfa)](),_0x2684e3=(0x0,salesforce_request_utils_1[_0x226d59(0x112)])(new salesforce_auth_1[(_0x226d59(0xee))](_0x1aeadb)),_0x5d4cbf=new dependency_service_1[(_0x226d59(0x12e))](_0x92f0a5,_0x2684e3,_0x25de2a);return await _0x5d4cbf['execute']();}catch(_0x2c3829){const _0x1a8aee=_0x2c3829 instanceof base_veeva_error_1['BaseVeevaError']?_0x2c3829[_0x226d59(0x116)]()[_0x226d59(0xfb)]('\x0a'):_0x2c3829[_0x226d59(0x130)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x226d59(0xf6)],'responseMessage':_0x1a8aee};}}async['rollback'](_0x37e142){const _0x1cd0f8=a371_0x45f606,{veevaAuth:_0x54c93c,timeZone:_0x31d4bf,attachmentLogId:_0x135948}=_0x37e142;try{const _0x1c669c=(0x0,veeva_request_utils_1[_0x1cd0f8(0x11f)])(new veeva_auth_1[(_0x1cd0f8(0xf5))](_0x54c93c,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x527e44=await salesforce_auth_1[_0x1cd0f8(0xee)][_0x1cd0f8(0xfa)](),_0x136f99=(0x0,salesforce_request_utils_1[_0x1cd0f8(0x112)])(new salesforce_auth_1['SalesforceAuth'](_0x527e44)),_0x436d13=new logger_1[(_0x1cd0f8(0x135))](_0x136f99,_0x31d4bf,_0x135948),_0x4aa2e0=_0x1cd0f8(0x100)+(0x0,shortid_1[_0x1cd0f8(0xf8)])();await(0x0,fs_util_1[_0x1cd0f8(0x12d)])(_0x4aa2e0);const _0x5a3520=new rollback_service_1['RollbackService']({..._0x37e142,'connectionVeeva':_0x1c669c,'connectionSalesforce':_0x136f99,'logger':_0x436d13,'tempFolder':_0x4aa2e0,'instanceUrl':_0x527e44[_0x1cd0f8(0xf9)]});return _0x5a3520['execute']()[_0x1cd0f8(0xf1)](()=>(0x0,promises_1['rm'])(_0x4aa2e0,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x1cd0f8(0x12c)][_0x1cd0f8(0xfc)]};}catch(_0x2d25c9){return{'responseStatus':status_enums_1[_0x1cd0f8(0x12c)]['FAILURE'],'responseMessage':_0x2d25c9['message']};}}};__decorate([(0x0,core_1[a371_0x45f606(0x12a)])(a371_0x45f606(0x138)),__param(0x0,core_1[a371_0x45f606(0x107)]['body']()),__metadata(a371_0x45f606(0x119),Function),__metadata(a371_0x45f606(0x106),[Object]),__metadata(a371_0x45f606(0x123),Promise)],VeevaVaultController[a371_0x45f606(0x10d)],a371_0x45f606(0x102),null),__decorate([(0x0,core_1['Post'])(a371_0x45f606(0x11c)),__param(0x0,core_1[a371_0x45f606(0x107)]['body']()),__metadata(a371_0x45f606(0x119),Function),__metadata('design:paramtypes',[Object]),__metadata(a371_0x45f606(0x123),Promise)],VeevaVaultController[a371_0x45f606(0x10d)],a371_0x45f606(0x117),null),__decorate([(0x0,core_1[a371_0x45f606(0x12a)])(a371_0x45f606(0xf4)),__param(0x0,core_1[a371_0x45f606(0x107)]['body']()),__metadata(a371_0x45f606(0x119),Function),__metadata(a371_0x45f606(0x106),[Object]),__metadata(a371_0x45f606(0x123),Promise)],VeevaVaultController[a371_0x45f606(0x10d)],a371_0x45f606(0x11a),null),__decorate([(0x0,core_1[a371_0x45f606(0x12a)])(a371_0x45f606(0x11b)),__param(0x0,core_1[a371_0x45f606(0x107)][a371_0x45f606(0x111)]()),__metadata(a371_0x45f606(0x119),Function),__metadata(a371_0x45f606(0x106),[Object]),__metadata(a371_0x45f606(0x123),Promise)],VeevaVaultController[a371_0x45f606(0x10d)],a371_0x45f606(0x11b),null),VeevaVaultController=__decorate([(0x0,core_1[a371_0x45f606(0x12b)])('veeva-vault'),(0x0,core_1[a371_0x45f606(0xef)])(a371_0x45f606(0x133))],VeevaVaultController),exports[a371_0x45f606(0x10b)]=VeevaVaultController;