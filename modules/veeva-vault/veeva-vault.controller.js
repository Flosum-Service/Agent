function a370_0xf381(){const _0x52d06b=['join','Post','metadata','getAuthDetails','28994913TgnuKG','FAILURE','instanceUrl','./services/rollback.service','./classes/auth/veeva-auth','SalesforceAuth','(((.+)+)+)+$','constructor','finally','249566PtTkpa','6654EqzrbD','5022540wQDsWj','../../core','then','./classes/errors/base-veeva-error','./classes/auth/salesforce-auth','toString','design:paramtypes','__esModule','veeva-vault','6072353AaTjcL','temp/veeva/rollback_','992zoLUfb','v1.1','function','BaseVeevaError','apply','design:type','dependency','body','makeDir','prototype','deploy','decorate','VeevaVaultController','DeployService','createSalesforceRequest','createVeevaRequest','Version','deployFromBranch','__param','design:returntype','8rZLUyC','./services/deploy.service','rollback','defineProperty','object','param','shortid','message','search','doSnapshot','retrieveDependency','execute','SnapshotService','getOwnPropertyDescriptor','__metadata','DependencyService','./services/snapshot.service','./services/dependency.service','AppResponseStatus','3444168ixYkMA','SUCCESS','./classes/loggers/logger','Logger','VeevaAuth','549148wYqLec','default','length'];a370_0xf381=function(){return _0x52d06b;};return a370_0xf381();}const a370_0x461b60=a370_0x718e;(function(_0x3640b1,_0x4b29da){const _0xa4885a=a370_0x718e,_0x435fbd=_0x3640b1();while(!![]){try{const _0x120c34=parseInt(_0xa4885a(0x15e))/0x1+-parseInt(_0xa4885a(0x16e))/0x2+parseInt(_0xa4885a(0x16f))/0x3*(-parseInt(_0xa4885a(0x132))/0x4)+-parseInt(_0xa4885a(0x170))/0x5+-parseInt(_0xa4885a(0x159))/0x6+-parseInt(_0xa4885a(0x130))/0x7*(parseInt(_0xa4885a(0x146))/0x8)+parseInt(_0xa4885a(0x165))/0x9;if(_0x120c34===_0x4b29da)break;else _0x435fbd['push'](_0x435fbd['shift']());}catch(_0x35a442){_0x435fbd['push'](_0x435fbd['shift']());}}}(a370_0xf381,0x9ead7));const a370_0x24ef86=(function(){let _0x400241=!![];return function(_0x2a3e96,_0x442761){const _0x3e35b8=_0x400241?function(){const _0x49a34e=a370_0x718e;if(_0x442761){const _0x1e3863=_0x442761[_0x49a34e(0x136)](_0x2a3e96,arguments);return _0x442761=null,_0x1e3863;}}:function(){};return _0x400241=![],_0x3e35b8;};}()),a370_0x1dd89d=a370_0x24ef86(this,function(){const _0x3a7234=a370_0x718e;return a370_0x1dd89d[_0x3a7234(0x175)]()[_0x3a7234(0x14e)](_0x3a7234(0x16b))[_0x3a7234(0x175)]()[_0x3a7234(0x16c)](a370_0x1dd89d)['search'](_0x3a7234(0x16b));});a370_0x1dd89d();'use strict';var __decorate=this&&this['__decorate']||function(_0x58d182,_0x30ec3c,_0xfd090b,_0x28b6f1){const _0x4c326f=a370_0x718e;var _0xf04fb0=arguments[_0x4c326f(0x160)],_0x497350=_0xf04fb0<0x3?_0x30ec3c:_0x28b6f1===null?_0x28b6f1=Object[_0x4c326f(0x153)](_0x30ec3c,_0xfd090b):_0x28b6f1,_0x8d5e4b;if(typeof Reflect===_0x4c326f(0x14a)&&typeof Reflect['decorate']===_0x4c326f(0x134))_0x497350=Reflect[_0x4c326f(0x13d)](_0x58d182,_0x30ec3c,_0xfd090b,_0x28b6f1);else{for(var _0x28977d=_0x58d182[_0x4c326f(0x160)]-0x1;_0x28977d>=0x0;_0x28977d--)if(_0x8d5e4b=_0x58d182[_0x28977d])_0x497350=(_0xf04fb0<0x3?_0x8d5e4b(_0x497350):_0xf04fb0>0x3?_0x8d5e4b(_0x30ec3c,_0xfd090b,_0x497350):_0x8d5e4b(_0x30ec3c,_0xfd090b))||_0x497350;}return _0xf04fb0>0x3&&_0x497350&&Object[_0x4c326f(0x149)](_0x30ec3c,_0xfd090b,_0x497350),_0x497350;},__metadata=this&&this[a370_0x461b60(0x154)]||function(_0x4cf6be,_0x3fa2c6){const _0x1e9b0a=a370_0x461b60;if(typeof Reflect==='object'&&typeof Reflect[_0x1e9b0a(0x163)]==='function')return Reflect[_0x1e9b0a(0x163)](_0x4cf6be,_0x3fa2c6);},__param=this&&this[a370_0x461b60(0x144)]||function(_0x48deda,_0x3515f4){return function(_0x1affde,_0x2acba0){_0x3515f4(_0x1affde,_0x2acba0,_0x48deda);};},__importDefault=this&&this['__importDefault']||function(_0x329c56){const _0x31427e=a370_0x461b60;return _0x329c56&&_0x329c56[_0x31427e(0x177)]?_0x329c56:{'default':_0x329c56};};function a370_0x718e(_0x30bf11,_0x5225e9){const _0x4b889a=a370_0xf381();return a370_0x718e=function(_0x1dd89d,_0x24ef86){_0x1dd89d=_0x1dd89d-0x130;let _0xf38170=_0x4b889a[_0x1dd89d];return _0xf38170;},a370_0x718e(_0x30bf11,_0x5225e9);}Object['defineProperty'](exports,a370_0x461b60(0x177),{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require(a370_0x461b60(0x171)),dependency_service_1=require(a370_0x461b60(0x157)),snapshot_service_1=require(a370_0x461b60(0x156)),deploy_service_1=require(a370_0x461b60(0x147)),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require(a370_0x461b60(0x14c))),fs_util_1=require('./utils/fs-util'),logger_1=require(a370_0x461b60(0x15b)),promises_1=require('fs/promises'),base_veeva_error_1=require(a370_0x461b60(0x173)),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require(a370_0x461b60(0x169)),salesforce_auth_1=require(a370_0x461b60(0x174)),rollback_service_1=require(a370_0x461b60(0x168)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x49adee){const _0x5c2dde=a370_0x461b60,{veevaAuth:_0x1989f3,timeZone:_0x2ed392,attachmentLogId:_0x26c20a}=_0x49adee;try{const _0x493944=(0x0,veeva_request_utils_1[_0x5c2dde(0x141)])(new veeva_auth_1[(_0x5c2dde(0x15d))](_0x1989f3,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x338a5f=await salesforce_auth_1[_0x5c2dde(0x16a)][_0x5c2dde(0x164)](),_0x25e4da=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x5c2dde(0x16a))](_0x338a5f)),_0x62b393=new logger_1[(_0x5c2dde(0x15c))](_0x25e4da,_0x2ed392,_0x26c20a),_0x1f0cee=new snapshot_service_1[(_0x5c2dde(0x152))](_0x49adee,_0x25e4da,_0x493944,_0x62b393);return _0x1f0cee[_0x5c2dde(0x151)]()[_0x5c2dde(0x172)](),{'responseStatus':status_enums_1[_0x5c2dde(0x158)][_0x5c2dde(0x15a)]};}catch(_0x59dec4){return{'responseStatus':status_enums_1[_0x5c2dde(0x158)]['FAILURE'],'responseMessage':_0x59dec4['message']};}}async['deployFromBranch'](_0x5f0556){const _0x5b7e3d=a370_0x461b60,{veevaAuth:_0x991938,timeZone:_0x13e44b,attachmentLogId:_0x44a53a}=_0x5f0556;try{const _0x459cf6=(0x0,veeva_request_utils_1[_0x5b7e3d(0x141)])(new veeva_auth_1['VeevaAuth'](_0x991938,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5472d4=await salesforce_auth_1[_0x5b7e3d(0x16a)]['getAuthDetails'](),_0x2bb0bb=(0x0,salesforce_request_utils_1[_0x5b7e3d(0x140)])(new salesforce_auth_1[(_0x5b7e3d(0x16a))](_0x5472d4)),_0xb105a6=new logger_1[(_0x5b7e3d(0x15c))](_0x2bb0bb,_0x13e44b,_0x44a53a),_0x1fbce1='temp/veeva/deploy_'+(0x0,shortid_1[_0x5b7e3d(0x15f)])();await(0x0,fs_util_1[_0x5b7e3d(0x13a)])(_0x1fbce1);const _0x5efab5=new deploy_service_1[(_0x5b7e3d(0x13f))](_0x5f0556,_0x2bb0bb,_0x459cf6,_0xb105a6,_0x1fbce1,_0x5472d4['instanceUrl']);return _0x5efab5['execute']()[_0x5b7e3d(0x16d)](()=>(0x0,promises_1['rm'])(_0x1fbce1,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x5b7e3d(0x158)][_0x5b7e3d(0x15a)]};}catch(_0xa22842){return{'responseStatus':status_enums_1[_0x5b7e3d(0x158)]['FAILURE'],'responseMessage':_0xa22842[_0x5b7e3d(0x14d)]};}}async[a370_0x461b60(0x150)](_0x494b20){const _0x4973d9=a370_0x461b60,{veevaAuth:_0x253c26}=_0x494b20;try{const _0x456442=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x4973d9(0x15d))](_0x253c26)),_0x526f4d=await salesforce_auth_1[_0x4973d9(0x16a)]['getAuthDetails'](),_0x1ff365=(0x0,salesforce_request_utils_1[_0x4973d9(0x140)])(new salesforce_auth_1[(_0x4973d9(0x16a))](_0x526f4d)),_0x51d667=new dependency_service_1[(_0x4973d9(0x155))](_0x494b20,_0x1ff365,_0x456442);return await _0x51d667[_0x4973d9(0x151)]();}catch(_0x3f8921){const _0xd7aa0=_0x3f8921 instanceof base_veeva_error_1[_0x4973d9(0x135)]?_0x3f8921['getMessages']()[_0x4973d9(0x161)]('\x0a'):_0x3f8921['message'];return{'responseStatus':status_enums_1[_0x4973d9(0x158)][_0x4973d9(0x166)],'responseMessage':_0xd7aa0};}}async[a370_0x461b60(0x148)](_0xc81bad){const _0x3f3c3a=a370_0x461b60,{veevaAuth:_0x3d8a5d,timeZone:_0x2405a0,attachmentLogId:_0xaf0c82}=_0xc81bad;try{const _0x1517a1=(0x0,veeva_request_utils_1[_0x3f3c3a(0x141)])(new veeva_auth_1[(_0x3f3c3a(0x15d))](_0x3d8a5d,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x31b75c=await salesforce_auth_1[_0x3f3c3a(0x16a)][_0x3f3c3a(0x164)](),_0x1beda6=(0x0,salesforce_request_utils_1[_0x3f3c3a(0x140)])(new salesforce_auth_1[(_0x3f3c3a(0x16a))](_0x31b75c)),_0x4690ca=new logger_1[(_0x3f3c3a(0x15c))](_0x1beda6,_0x2405a0,_0xaf0c82),_0x364013=_0x3f3c3a(0x131)+(0x0,shortid_1[_0x3f3c3a(0x15f)])();await(0x0,fs_util_1[_0x3f3c3a(0x13a)])(_0x364013);const _0x28d001=new rollback_service_1['RollbackService']({..._0xc81bad,'connectionVeeva':_0x1517a1,'connectionSalesforce':_0x1beda6,'logger':_0x4690ca,'tempFolder':_0x364013,'instanceUrl':_0x31b75c[_0x3f3c3a(0x167)]});return _0x28d001['execute']()[_0x3f3c3a(0x16d)](()=>(0x0,promises_1['rm'])(_0x364013,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x3f3c3a(0x158)][_0x3f3c3a(0x15a)]};}catch(_0x295f14){return{'responseStatus':status_enums_1[_0x3f3c3a(0x158)]['FAILURE'],'responseMessage':_0x295f14['message']};}}};__decorate([(0x0,core_1[a370_0x461b60(0x162)])('snapshot'),__param(0x0,core_1[a370_0x461b60(0x14b)][a370_0x461b60(0x139)]()),__metadata(a370_0x461b60(0x137),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a370_0x461b60(0x14f),null),__decorate([(0x0,core_1[a370_0x461b60(0x162)])(a370_0x461b60(0x13c)),__param(0x0,core_1['param']['body']()),__metadata(a370_0x461b60(0x137),Function),__metadata(a370_0x461b60(0x176),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a370_0x461b60(0x13b)],a370_0x461b60(0x143),null),__decorate([(0x0,core_1['Post'])(a370_0x461b60(0x138)),__param(0x0,core_1['param'][a370_0x461b60(0x139)]()),__metadata(a370_0x461b60(0x137),Function),__metadata(a370_0x461b60(0x176),[Object]),__metadata(a370_0x461b60(0x145),Promise)],VeevaVaultController[a370_0x461b60(0x13b)],a370_0x461b60(0x150),null),__decorate([(0x0,core_1[a370_0x461b60(0x162)])('rollback'),__param(0x0,core_1[a370_0x461b60(0x14b)]['body']()),__metadata(a370_0x461b60(0x137),Function),__metadata('design:paramtypes',[Object]),__metadata(a370_0x461b60(0x145),Promise)],VeevaVaultController['prototype'],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])(a370_0x461b60(0x178)),(0x0,core_1[a370_0x461b60(0x142)])(a370_0x461b60(0x133))],VeevaVaultController),exports[a370_0x461b60(0x13e)]=VeevaVaultController;