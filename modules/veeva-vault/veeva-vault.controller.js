const a402_0x1c7af4=a402_0x1a75;(function(_0x19467f,_0x1714e9){const _0x302964=a402_0x1a75,_0x581a3b=_0x19467f();while(!![]){try{const _0x1e5fc4=parseInt(_0x302964(0x1f5))/0x1+-parseInt(_0x302964(0x1c4))/0x2*(-parseInt(_0x302964(0x1cd))/0x3)+parseInt(_0x302964(0x1dc))/0x4+parseInt(_0x302964(0x1f2))/0x5+parseInt(_0x302964(0x1d5))/0x6*(parseInt(_0x302964(0x1cc))/0x7)+-parseInt(_0x302964(0x1f1))/0x8+-parseInt(_0x302964(0x1eb))/0x9;if(_0x1e5fc4===_0x1714e9)break;else _0x581a3b['push'](_0x581a3b['shift']());}catch(_0x134235){_0x581a3b['push'](_0x581a3b['shift']());}}}(a402_0x4a8c,0x3d3a8));const a402_0x4319df=(function(){let _0x287a2c=!![];return function(_0xf8d40,_0x19e306){const _0x714a41=_0x287a2c?function(){if(_0x19e306){const _0x95f655=_0x19e306['apply'](_0xf8d40,arguments);return _0x19e306=null,_0x95f655;}}:function(){};return _0x287a2c=![],_0x714a41;};}()),a402_0x581f0c=a402_0x4319df(this,function(){const _0x224227=a402_0x1a75;return a402_0x581f0c[_0x224227(0x1fa)]()[_0x224227(0x1ec)](_0x224227(0x1f9))[_0x224227(0x1fa)]()[_0x224227(0x1e3)](a402_0x581f0c)[_0x224227(0x1ec)]('(((.+)+)+)+$');});a402_0x581f0c();'use strict';var __decorate=this&&this['__decorate']||function(_0x2b20ab,_0x1ae4d5,_0x180f36,_0x1561b2){const _0x5730a8=a402_0x1a75;var _0x3c1173=arguments[_0x5730a8(0x1d1)],_0x31e847=_0x3c1173<0x3?_0x1ae4d5:_0x1561b2===null?_0x1561b2=Object['getOwnPropertyDescriptor'](_0x1ae4d5,_0x180f36):_0x1561b2,_0x442748;if(typeof Reflect===_0x5730a8(0x1f8)&&typeof Reflect[_0x5730a8(0x1ba)]===_0x5730a8(0x1e1))_0x31e847=Reflect[_0x5730a8(0x1ba)](_0x2b20ab,_0x1ae4d5,_0x180f36,_0x1561b2);else{for(var _0x26b4aa=_0x2b20ab[_0x5730a8(0x1d1)]-0x1;_0x26b4aa>=0x0;_0x26b4aa--)if(_0x442748=_0x2b20ab[_0x26b4aa])_0x31e847=(_0x3c1173<0x3?_0x442748(_0x31e847):_0x3c1173>0x3?_0x442748(_0x1ae4d5,_0x180f36,_0x31e847):_0x442748(_0x1ae4d5,_0x180f36))||_0x31e847;}return _0x3c1173>0x3&&_0x31e847&&Object[_0x5730a8(0x1c9)](_0x1ae4d5,_0x180f36,_0x31e847),_0x31e847;},__metadata=this&&this[a402_0x1c7af4(0x1e4)]||function(_0x3d03cb,_0x9512ca){const _0x22410e=a402_0x1c7af4;if(typeof Reflect===_0x22410e(0x1f8)&&typeof Reflect[_0x22410e(0x1dd)]===_0x22410e(0x1e1))return Reflect[_0x22410e(0x1dd)](_0x3d03cb,_0x9512ca);},__param=this&&this[a402_0x1c7af4(0x1ef)]||function(_0x51a6b8,_0x233e5a){return function(_0x2c068c,_0x163c85){_0x233e5a(_0x2c068c,_0x163c85,_0x51a6b8);};},__importDefault=this&&this[a402_0x1c7af4(0x1db)]||function(_0x5a2bdc){return _0x5a2bdc&&_0x5a2bdc['__esModule']?_0x5a2bdc:{'default':_0x5a2bdc};};Object[a402_0x1c7af4(0x1c9)](exports,a402_0x1c7af4(0x1fb),{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require(a402_0x1c7af4(0x1d4)),dependency_service_1=require(a402_0x1c7af4(0x1b8)),snapshot_service_1=require(a402_0x1c7af4(0x1da)),deploy_service_1=require(a402_0x1c7af4(0x1c3)),veeva_request_utils_1=require(a402_0x1c7af4(0x1c2)),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require('shortid')),fs_util_1=require(a402_0x1c7af4(0x1ea)),logger_1=require(a402_0x1c7af4(0x1f0)),promises_1=require('fs/promises'),base_veeva_error_1=require(a402_0x1c7af4(0x1e0)),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require(a402_0x1c7af4(0x1c8)),salesforce_auth_1=require(a402_0x1c7af4(0x1c1)),rollback_service_1=require(a402_0x1c7af4(0x1d0)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x104e34){const _0x4575f3=a402_0x1c7af4,{veevaAuth:_0x390eed,timeZone:_0x321fb5,attachmentLogId:_0x522517}=_0x104e34;try{const _0x17bc0f=(0x0,veeva_request_utils_1[_0x4575f3(0x1ce)])(new veeva_auth_1[(_0x4575f3(0x1f4))](_0x390eed,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1bbc21=await salesforce_auth_1[_0x4575f3(0x1c0)][_0x4575f3(0x1e8)](),_0x340d44=(0x0,salesforce_request_utils_1[_0x4575f3(0x1c7)])(new salesforce_auth_1[(_0x4575f3(0x1c0))](_0x1bbc21)),_0x240d9a=new logger_1[(_0x4575f3(0x1e2))](_0x340d44,_0x321fb5,_0x522517),_0x56d38b=new snapshot_service_1[(_0x4575f3(0x1d7))](_0x104e34,_0x340d44,_0x17bc0f,_0x240d9a);return _0x56d38b[_0x4575f3(0x1e6)]()['then'](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x4575f3(0x1e7)]};}catch(_0x4f0b00){return{'responseStatus':status_enums_1[_0x4575f3(0x1f7)]['FAILURE'],'responseMessage':_0x4f0b00[_0x4575f3(0x1c5)]};}}async[a402_0x1c7af4(0x1cf)](_0x59881f){const _0x277d0a=a402_0x1c7af4,{veevaAuth:_0x34f502,timeZone:_0x3af2b5,attachmentLogId:_0x3169c7}=_0x59881f;try{const _0x441cc4=(0x0,veeva_request_utils_1[_0x277d0a(0x1ce)])(new veeva_auth_1[(_0x277d0a(0x1f4))](_0x34f502,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xf1fe72=await salesforce_auth_1[_0x277d0a(0x1c0)][_0x277d0a(0x1e8)](),_0x3e0a9f=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x277d0a(0x1c0))](_0xf1fe72)),_0x2435af=new logger_1[(_0x277d0a(0x1e2))](_0x3e0a9f,_0x3af2b5,_0x3169c7),_0x48f97a='temp/veeva/deploy_'+(0x0,shortid_1[_0x277d0a(0x1d3)])();await(0x0,fs_util_1['makeDir'])(_0x48f97a);const _0x2b9a45=new deploy_service_1[(_0x277d0a(0x1b6))](_0x59881f,_0x3e0a9f,_0x441cc4,_0x2435af,_0x48f97a,_0xf1fe72[_0x277d0a(0x1d8)]);return _0x2b9a45[_0x277d0a(0x1e6)]()['finally'](()=>(0x0,promises_1['rm'])(_0x48f97a,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x277d0a(0x1f7)][_0x277d0a(0x1e7)]};}catch(_0x55fd82){return{'responseStatus':status_enums_1[_0x277d0a(0x1f7)][_0x277d0a(0x1bb)],'responseMessage':_0x55fd82['message']};}}async[a402_0x1c7af4(0x1ca)](_0x46c858){const _0x517cfb=a402_0x1c7af4,{veevaAuth:_0x3e1e19}=_0x46c858;try{const _0x767a1d=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x517cfb(0x1f4))](_0x3e1e19)),_0x2da36d=await salesforce_auth_1[_0x517cfb(0x1c0)]['getAuthDetails'](),_0x34a898=(0x0,salesforce_request_utils_1[_0x517cfb(0x1c7)])(new salesforce_auth_1[(_0x517cfb(0x1c0))](_0x2da36d)),_0x5b6e1c=new dependency_service_1[(_0x517cfb(0x1f3))](_0x46c858,_0x34a898,_0x767a1d);return await _0x5b6e1c[_0x517cfb(0x1e6)]();}catch(_0x1187d3){const _0x3f6988=_0x1187d3 instanceof base_veeva_error_1[_0x517cfb(0x1bf)]?_0x1187d3[_0x517cfb(0x1d6)]()[_0x517cfb(0x1bd)]('\x0a'):_0x1187d3[_0x517cfb(0x1c5)];return{'responseStatus':status_enums_1[_0x517cfb(0x1f7)][_0x517cfb(0x1bb)],'responseMessage':_0x3f6988};}}async['rollback'](_0x129c63){const _0xb51d8d=a402_0x1c7af4,{veevaAuth:_0x2428f7,timeZone:_0x515236,attachmentLogId:_0x217c93}=_0x129c63;try{const _0x45bb57=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1['VeevaAuth'](_0x2428f7,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5f1124=await salesforce_auth_1[_0xb51d8d(0x1c0)][_0xb51d8d(0x1e8)](),_0x5ce25f=(0x0,salesforce_request_utils_1[_0xb51d8d(0x1c7)])(new salesforce_auth_1[(_0xb51d8d(0x1c0))](_0x5f1124)),_0x2c62fe=new logger_1['Logger'](_0x5ce25f,_0x515236,_0x217c93),_0x794d56='temp/veeva/rollback_'+(0x0,shortid_1[_0xb51d8d(0x1d3)])();await(0x0,fs_util_1[_0xb51d8d(0x1ed)])(_0x794d56);const _0x4fc645=new rollback_service_1['RollbackService']({..._0x129c63,'connectionVeeva':_0x45bb57,'connectionSalesforce':_0x5ce25f,'logger':_0x2c62fe,'tempFolder':_0x794d56,'instanceUrl':_0x5f1124[_0xb51d8d(0x1d8)]});return _0x4fc645[_0xb51d8d(0x1e6)]()[_0xb51d8d(0x1b9)](()=>(0x0,promises_1['rm'])(_0x794d56,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0xb51d8d(0x1f7)][_0xb51d8d(0x1e7)]};}catch(_0x1442dc){return{'responseStatus':status_enums_1[_0xb51d8d(0x1f7)][_0xb51d8d(0x1bb)],'responseMessage':_0x1442dc[_0xb51d8d(0x1c5)]};}}};function a402_0x1a75(_0x4b70c6,_0x22ff70){const _0x1d1ce0=a402_0x4a8c();return a402_0x1a75=function(_0x581f0c,_0x4319df){_0x581f0c=_0x581f0c-0x1b6;let _0x4a8cf4=_0x1d1ce0[_0x581f0c];return _0x4a8cf4;},a402_0x1a75(_0x4b70c6,_0x22ff70);}function a402_0x4a8c(){const _0x144658=['veeva-vault','doSnapshot','./classes/errors/base-veeva-error','function','Logger','constructor','__metadata','design:type','execute','SUCCESS','getAuthDetails','snapshot','./utils/fs-util','11670993OwDpJg','search','makeDir','Post','__param','./classes/loggers/logger','718896hZKEor','1118295OhAWiq','DependencyService','VeevaAuth','487429qGaLeZ','prototype','AppResponseStatus','object','(((.+)+)+)+$','toString','__esModule','DeployService','body','./services/dependency.service','finally','decorate','FAILURE','dependency','join','design:returntype','BaseVeevaError','SalesforceAuth','./classes/auth/salesforce-auth','./utils/veeva-request.utils','./services/deploy.service','4DzaXqo','message','deploy','createSalesforceRequest','./classes/auth/veeva-auth','defineProperty','retrieveDependency','Version','1841nnSXCH','567174fJOYeI','createVeevaRequest','deployFromBranch','./services/rollback.service','length','param','default','../../core','10740FspEqL','getMessages','SnapshotService','instanceUrl','design:paramtypes','./services/snapshot.service','__importDefault','309828mvRCnd','metadata'];a402_0x4a8c=function(){return _0x144658;};return a402_0x4a8c();}__decorate([(0x0,core_1[a402_0x1c7af4(0x1ee)])(a402_0x1c7af4(0x1e9)),__param(0x0,core_1[a402_0x1c7af4(0x1d2)]['body']()),__metadata(a402_0x1c7af4(0x1e5),Function),__metadata(a402_0x1c7af4(0x1d9),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a402_0x1c7af4(0x1f6)],a402_0x1c7af4(0x1df),null),__decorate([(0x0,core_1[a402_0x1c7af4(0x1ee)])(a402_0x1c7af4(0x1c6)),__param(0x0,core_1['param']['body']()),__metadata(a402_0x1c7af4(0x1e5),Function),__metadata(a402_0x1c7af4(0x1d9),[Object]),__metadata(a402_0x1c7af4(0x1be),Promise)],VeevaVaultController['prototype'],a402_0x1c7af4(0x1cf),null),__decorate([(0x0,core_1[a402_0x1c7af4(0x1ee)])(a402_0x1c7af4(0x1bc)),__param(0x0,core_1[a402_0x1c7af4(0x1d2)][a402_0x1c7af4(0x1b7)]()),__metadata('design:type',Function),__metadata(a402_0x1c7af4(0x1d9),[Object]),__metadata(a402_0x1c7af4(0x1be),Promise)],VeevaVaultController['prototype'],'retrieveDependency',null),__decorate([(0x0,core_1[a402_0x1c7af4(0x1ee)])('rollback'),__param(0x0,core_1[a402_0x1c7af4(0x1d2)][a402_0x1c7af4(0x1b7)]()),__metadata(a402_0x1c7af4(0x1e5),Function),__metadata(a402_0x1c7af4(0x1d9),[Object]),__metadata(a402_0x1c7af4(0x1be),Promise)],VeevaVaultController['prototype'],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])(a402_0x1c7af4(0x1de)),(0x0,core_1[a402_0x1c7af4(0x1cb)])('v1.1')],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;