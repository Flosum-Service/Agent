const a415_0x5866b7=a415_0x29b0;(function(_0x296f60,_0x35046d){const _0x5927df=a415_0x29b0,_0x155fac=_0x296f60();while(!![]){try{const _0x211d8e=parseInt(_0x5927df(0xcd))/0x1*(parseInt(_0x5927df(0xe7))/0x2)+parseInt(_0x5927df(0xda))/0x3+parseInt(_0x5927df(0xde))/0x4+parseInt(_0x5927df(0xe1))/0x5*(parseInt(_0x5927df(0xee))/0x6)+parseInt(_0x5927df(0xcf))/0x7+parseInt(_0x5927df(0xfc))/0x8*(parseInt(_0x5927df(0xc4))/0x9)+-parseInt(_0x5927df(0xb6))/0xa;if(_0x211d8e===_0x35046d)break;else _0x155fac['push'](_0x155fac['shift']());}catch(_0x22b0ab){_0x155fac['push'](_0x155fac['shift']());}}}(a415_0x463f,0x8f44f));const a415_0x588863=(function(){let _0x127190=!![];return function(_0x429d45,_0x44733a){const _0x1aa77e=_0x127190?function(){const _0x16b1b8=a415_0x29b0;if(_0x44733a){const _0x2c92fd=_0x44733a[_0x16b1b8(0xc6)](_0x429d45,arguments);return _0x44733a=null,_0x2c92fd;}}:function(){};return _0x127190=![],_0x1aa77e;};}()),a415_0x320960=a415_0x588863(this,function(){const _0x1251dd=a415_0x29b0;return a415_0x320960[_0x1251dd(0xb8)]()[_0x1251dd(0xd8)](_0x1251dd(0xef))[_0x1251dd(0xb8)]()[_0x1251dd(0xc1)](a415_0x320960)[_0x1251dd(0xd8)](_0x1251dd(0xef));});a415_0x320960();'use strict';var __decorate=this&&this['__decorate']||function(_0x1be3c1,_0x42ec57,_0x1de2ce,_0x370918){const _0x35a92d=a415_0x29b0;var _0x12bb1a=arguments[_0x35a92d(0xbc)],_0x224ef9=_0x12bb1a<0x3?_0x42ec57:_0x370918===null?_0x370918=Object[_0x35a92d(0xe2)](_0x42ec57,_0x1de2ce):_0x370918,_0x3e53ab;if(typeof Reflect==='object'&&typeof Reflect[_0x35a92d(0xcb)]===_0x35a92d(0xe4))_0x224ef9=Reflect['decorate'](_0x1be3c1,_0x42ec57,_0x1de2ce,_0x370918);else{for(var _0x31f5b=_0x1be3c1[_0x35a92d(0xbc)]-0x1;_0x31f5b>=0x0;_0x31f5b--)if(_0x3e53ab=_0x1be3c1[_0x31f5b])_0x224ef9=(_0x12bb1a<0x3?_0x3e53ab(_0x224ef9):_0x12bb1a>0x3?_0x3e53ab(_0x42ec57,_0x1de2ce,_0x224ef9):_0x3e53ab(_0x42ec57,_0x1de2ce))||_0x224ef9;}return _0x12bb1a>0x3&&_0x224ef9&&Object['defineProperty'](_0x42ec57,_0x1de2ce,_0x224ef9),_0x224ef9;},__metadata=this&&this[a415_0x5866b7(0xf5)]||function(_0x2ff4f9,_0x131ce1){const _0x4ff0fd=a415_0x5866b7;if(typeof Reflect===_0x4ff0fd(0xcc)&&typeof Reflect[_0x4ff0fd(0xdc)]===_0x4ff0fd(0xe4))return Reflect['metadata'](_0x2ff4f9,_0x131ce1);},__param=this&&this['__param']||function(_0x30262c,_0x366d52){return function(_0x533347,_0x4530f0){_0x366d52(_0x533347,_0x4530f0,_0x30262c);};},__importDefault=this&&this[a415_0x5866b7(0xc5)]||function(_0x5c074f){return _0x5c074f&&_0x5c074f['__esModule']?_0x5c074f:{'default':_0x5c074f};};Object[a415_0x5866b7(0xdd)](exports,a415_0x5866b7(0xd1),{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require('../../core'),dependency_service_1=require(a415_0x5866b7(0xd5)),snapshot_service_1=require(a415_0x5866b7(0xfa)),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a415_0x5866b7(0xf6)),shortid_1=__importDefault(require(a415_0x5866b7(0xe5))),fs_util_1=require('./utils/fs-util'),logger_1=require(a415_0x5866b7(0xc3)),promises_1=require(a415_0x5866b7(0xd3)),base_veeva_error_1=require(a415_0x5866b7(0xd4)),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require(a415_0x5866b7(0xed)),salesforce_auth_1=require(a415_0x5866b7(0xc7)),rollback_service_1=require(a415_0x5866b7(0xce)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a415_0x5866b7(0xf2)](_0x4be730){const _0x294010=a415_0x5866b7,{veevaAuth:_0x4f9dcc,timeZone:_0x97f542,attachmentLogId:_0x1335d8}=_0x4be730;try{const _0x2ff269=(0x0,veeva_request_utils_1[_0x294010(0xd9)])(new veeva_auth_1[(_0x294010(0xe8))](_0x4f9dcc,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5166fa=await salesforce_auth_1['SalesforceAuth'][_0x294010(0xb5)](),_0xc14a78=(0x0,salesforce_request_utils_1[_0x294010(0xb9)])(new salesforce_auth_1['SalesforceAuth'](_0x5166fa)),_0x4e5b91=new logger_1['Logger'](_0xc14a78,_0x97f542,_0x1335d8),_0x3f1a1a=new snapshot_service_1[(_0x294010(0xec))](_0x4be730,_0xc14a78,_0x2ff269,_0x4e5b91);return _0x3f1a1a[_0x294010(0xfd)]()[_0x294010(0xb7)](),{'responseStatus':status_enums_1[_0x294010(0xe6)]['SUCCESS']};}catch(_0x17b508){return{'responseStatus':status_enums_1[_0x294010(0xe6)][_0x294010(0xc8)],'responseMessage':_0x17b508[_0x294010(0xc0)]};}}async[a415_0x5866b7(0xba)](_0x1a022b){const _0x5d03a7=a415_0x5866b7,{veevaAuth:_0x1c6530,timeZone:_0x2e8348,attachmentLogId:_0x2fc06a}=_0x1a022b;try{const _0x35a51e=(0x0,veeva_request_utils_1[_0x5d03a7(0xd9)])(new veeva_auth_1[(_0x5d03a7(0xe8))](_0x1c6530,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2dd774=await salesforce_auth_1[_0x5d03a7(0xea)][_0x5d03a7(0xb5)](),_0x561701=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x5d03a7(0xea))](_0x2dd774)),_0x235189=new logger_1[(_0x5d03a7(0xf3))](_0x561701,_0x2e8348,_0x2fc06a),_0x43619d=_0x5d03a7(0xf9)+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x5d03a7(0xfe)])(_0x43619d);const _0x3dbcd4=new deploy_service_1['DeployService'](_0x1a022b,_0x561701,_0x35a51e,_0x235189,_0x43619d,_0x2dd774[_0x5d03a7(0xd2)]);return _0x3dbcd4['execute']()[_0x5d03a7(0xe0)](()=>(0x0,promises_1['rm'])(_0x43619d,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x5d03a7(0xe6)]['SUCCESS']};}catch(_0x42481a){return{'responseStatus':status_enums_1[_0x5d03a7(0xe6)]['FAILURE'],'responseMessage':_0x42481a[_0x5d03a7(0xc0)]};}}async[a415_0x5866b7(0xf1)](_0x5c7755){const _0xb3b578=a415_0x5866b7,{veevaAuth:_0x531d3c}=_0x5c7755;try{const _0x438559=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0xb3b578(0xe8))](_0x531d3c)),_0x6c229b=await salesforce_auth_1[_0xb3b578(0xea)][_0xb3b578(0xb5)](),_0x303c3e=(0x0,salesforce_request_utils_1[_0xb3b578(0xb9)])(new salesforce_auth_1[(_0xb3b578(0xea))](_0x6c229b)),_0x12e387=new dependency_service_1['DependencyService'](_0x5c7755,_0x303c3e,_0x438559);return await _0x12e387[_0xb3b578(0xfd)]();}catch(_0x59eef0){const _0x448f11=_0x59eef0 instanceof base_veeva_error_1['BaseVeevaError']?_0x59eef0[_0xb3b578(0xca)]()[_0xb3b578(0xbf)]('\x0a'):_0x59eef0[_0xb3b578(0xc0)];return{'responseStatus':status_enums_1[_0xb3b578(0xe6)][_0xb3b578(0xc8)],'responseMessage':_0x448f11};}}async['rollback'](_0x374578){const _0x48764a=a415_0x5866b7,{veevaAuth:_0x27b4a5,timeZone:_0xd4fd7f,attachmentLogId:_0x1c04b2}=_0x374578;try{const _0x114eb3=(0x0,veeva_request_utils_1[_0x48764a(0xd9)])(new veeva_auth_1[(_0x48764a(0xe8))](_0x27b4a5,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x3b580a=await salesforce_auth_1[_0x48764a(0xea)]['getAuthDetails'](),_0x228462=(0x0,salesforce_request_utils_1[_0x48764a(0xb9)])(new salesforce_auth_1[(_0x48764a(0xea))](_0x3b580a)),_0x48abbc=new logger_1[(_0x48764a(0xf3))](_0x228462,_0xd4fd7f,_0x1c04b2),_0x141ec7=_0x48764a(0xf8)+(0x0,shortid_1[_0x48764a(0xdb)])();await(0x0,fs_util_1[_0x48764a(0xfe)])(_0x141ec7);const _0x13d390=new rollback_service_1['RollbackService']({..._0x374578,'connectionVeeva':_0x114eb3,'connectionSalesforce':_0x228462,'logger':_0x48abbc,'tempFolder':_0x141ec7,'instanceUrl':_0x3b580a[_0x48764a(0xd2)]});return _0x13d390[_0x48764a(0xfd)]()[_0x48764a(0xe0)](()=>(0x0,promises_1['rm'])(_0x141ec7,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x48764a(0xe6)][_0x48764a(0xd7)]};}catch(_0x31bd65){return{'responseStatus':status_enums_1[_0x48764a(0xe6)][_0x48764a(0xc8)],'responseMessage':_0x31bd65[_0x48764a(0xc0)]};}}};function a415_0x463f(){const _0x4cfb77=['v1.1','SalesforceAuth','veeva-vault','SnapshotService','./classes/auth/veeva-auth','12gNwShW','(((.+)+)+)+$','rollback','retrieveDependency','doSnapshot','Logger','Version','__metadata','./enums/status.enums','param','temp/veeva/rollback_','temp/veeva/deploy_','./services/snapshot.service','design:paramtypes','8QzAgXP','execute','makeDir','getAuthDetails','44749430XUBwEs','then','toString','createSalesforceRequest','deployFromBranch','body','length','Post','design:type','join','message','constructor','deploy','./classes/loggers/logger','9310878GIORVk','__importDefault','apply','./classes/auth/salesforce-auth','FAILURE','snapshot','getMessages','decorate','object','4817FTYMnE','./services/rollback.service','6378855NmcDRC','prototype','__esModule','instanceUrl','fs/promises','./classes/errors/base-veeva-error','./services/dependency.service','VeevaVaultController','SUCCESS','search','createVeevaRequest','2824278ORzSFa','default','metadata','defineProperty','2433336dUnJTu','design:returntype','finally','1085530mzyfOC','getOwnPropertyDescriptor','dependency','function','shortid','AppResponseStatus','470FyOdjz','VeevaAuth'];a415_0x463f=function(){return _0x4cfb77;};return a415_0x463f();}function a415_0x29b0(_0x35b063,_0x36a857){const _0x2c0b61=a415_0x463f();return a415_0x29b0=function(_0x320960,_0x588863){_0x320960=_0x320960-0xb5;let _0x463fff=_0x2c0b61[_0x320960];return _0x463fff;},a415_0x29b0(_0x35b063,_0x36a857);}__decorate([(0x0,core_1[a415_0x5866b7(0xbd)])(a415_0x5866b7(0xc9)),__param(0x0,core_1['param'][a415_0x5866b7(0xbb)]()),__metadata('design:type',Function),__metadata(a415_0x5866b7(0xfb),[Object]),__metadata(a415_0x5866b7(0xdf),Promise)],VeevaVaultController['prototype'],a415_0x5866b7(0xf2),null),__decorate([(0x0,core_1['Post'])(a415_0x5866b7(0xc2)),__param(0x0,core_1[a415_0x5866b7(0xf7)][a415_0x5866b7(0xbb)]()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a415_0x5866b7(0xd0)],a415_0x5866b7(0xba),null),__decorate([(0x0,core_1[a415_0x5866b7(0xbd)])(a415_0x5866b7(0xe3)),__param(0x0,core_1['param'][a415_0x5866b7(0xbb)]()),__metadata(a415_0x5866b7(0xbe),Function),__metadata('design:paramtypes',[Object]),__metadata(a415_0x5866b7(0xdf),Promise)],VeevaVaultController[a415_0x5866b7(0xd0)],a415_0x5866b7(0xf1),null),__decorate([(0x0,core_1[a415_0x5866b7(0xbd)])(a415_0x5866b7(0xf0)),__param(0x0,core_1['param'][a415_0x5866b7(0xbb)]()),__metadata(a415_0x5866b7(0xbe),Function),__metadata(a415_0x5866b7(0xfb),[Object]),__metadata(a415_0x5866b7(0xdf),Promise)],VeevaVaultController[a415_0x5866b7(0xd0)],a415_0x5866b7(0xf0),null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])(a415_0x5866b7(0xeb)),(0x0,core_1[a415_0x5866b7(0xf4)])(a415_0x5866b7(0xe9))],VeevaVaultController),exports[a415_0x5866b7(0xd6)]=VeevaVaultController;