function a370_0x5c77(_0x284f58,_0x23d620){const _0x4de9a0=a370_0x1e29();return a370_0x5c77=function(_0x5ce0ee,_0x35d3a0){_0x5ce0ee=_0x5ce0ee-0xef;let _0x1e2998=_0x4de9a0[_0x5ce0ee];return _0x1e2998;},a370_0x5c77(_0x284f58,_0x23d620);}const a370_0x4ef9a3=a370_0x5c77;(function(_0x888289,_0x483360){const _0x549aea=a370_0x5c77,_0x213381=_0x888289();while(!![]){try{const _0x5dba84=parseInt(_0x549aea(0x11f))/0x1*(parseInt(_0x549aea(0xf5))/0x2)+parseInt(_0x549aea(0xf8))/0x3+parseInt(_0x549aea(0x10d))/0x4+parseInt(_0x549aea(0xff))/0x5*(parseInt(_0x549aea(0x132))/0x6)+-parseInt(_0x549aea(0x12a))/0x7+parseInt(_0x549aea(0x108))/0x8+-parseInt(_0x549aea(0x114))/0x9;if(_0x5dba84===_0x483360)break;else _0x213381['push'](_0x213381['shift']());}catch(_0x428b42){_0x213381['push'](_0x213381['shift']());}}}(a370_0x1e29,0xb082b));const a370_0x35d3a0=(function(){let _0x52e6b9=!![];return function(_0x9a45dd,_0x1175cc){const _0x1eeb41=_0x52e6b9?function(){if(_0x1175cc){const _0x2de41a=_0x1175cc['apply'](_0x9a45dd,arguments);return _0x1175cc=null,_0x2de41a;}}:function(){};return _0x52e6b9=![],_0x1eeb41;};}()),a370_0x5ce0ee=a370_0x35d3a0(this,function(){const _0x160dfd=a370_0x5c77;return a370_0x5ce0ee[_0x160dfd(0x123)]()[_0x160dfd(0x12e)]('(((.+)+)+)+$')[_0x160dfd(0x123)]()['constructor'](a370_0x5ce0ee)[_0x160dfd(0x12e)](_0x160dfd(0x115));});a370_0x5ce0ee();'use strict';var __decorate=this&&this[a370_0x4ef9a3(0x122)]||function(_0x3da15f,_0x5530ce,_0x6520e9,_0x2d9452){const _0x1ca776=a370_0x4ef9a3;var _0x3e871c=arguments[_0x1ca776(0x109)],_0x1f8991=_0x3e871c<0x3?_0x5530ce:_0x2d9452===null?_0x2d9452=Object[_0x1ca776(0x126)](_0x5530ce,_0x6520e9):_0x2d9452,_0xace1b1;if(typeof Reflect===_0x1ca776(0xf3)&&typeof Reflect[_0x1ca776(0x128)]===_0x1ca776(0x136))_0x1f8991=Reflect[_0x1ca776(0x128)](_0x3da15f,_0x5530ce,_0x6520e9,_0x2d9452);else{for(var _0x326717=_0x3da15f['length']-0x1;_0x326717>=0x0;_0x326717--)if(_0xace1b1=_0x3da15f[_0x326717])_0x1f8991=(_0x3e871c<0x3?_0xace1b1(_0x1f8991):_0x3e871c>0x3?_0xace1b1(_0x5530ce,_0x6520e9,_0x1f8991):_0xace1b1(_0x5530ce,_0x6520e9))||_0x1f8991;}return _0x3e871c>0x3&&_0x1f8991&&Object[_0x1ca776(0xf0)](_0x5530ce,_0x6520e9,_0x1f8991),_0x1f8991;},__metadata=this&&this[a370_0x4ef9a3(0xef)]||function(_0x4dc978,_0x19d9a5){const _0x14bb8d=a370_0x4ef9a3;if(typeof Reflect===_0x14bb8d(0xf3)&&typeof Reflect[_0x14bb8d(0xfe)]===_0x14bb8d(0x136))return Reflect[_0x14bb8d(0xfe)](_0x4dc978,_0x19d9a5);},__param=this&&this[a370_0x4ef9a3(0x10c)]||function(_0x1e1dd1,_0xe0d375){return function(_0x25a09e,_0x5660ad){_0xe0d375(_0x25a09e,_0x5660ad,_0x1e1dd1);};},__importDefault=this&&this[a370_0x4ef9a3(0x11c)]||function(_0x5dda90){const _0x57ee39=a370_0x4ef9a3;return _0x5dda90&&_0x5dda90[_0x57ee39(0x11a)]?_0x5dda90:{'default':_0x5dda90};};Object[a370_0x4ef9a3(0xf0)](exports,a370_0x4ef9a3(0x11a),{'value':!![]}),exports[a370_0x4ef9a3(0x11b)]=void 0x0;const core_1=require(a370_0x4ef9a3(0x113)),dependency_service_1=require(a370_0x4ef9a3(0x110)),snapshot_service_1=require(a370_0x4ef9a3(0x121)),deploy_service_1=require(a370_0x4ef9a3(0x104)),veeva_request_utils_1=require(a370_0x4ef9a3(0x100)),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require(a370_0x4ef9a3(0x112))),fs_util_1=require('./utils/fs-util'),logger_1=require(a370_0x4ef9a3(0xf1)),promises_1=require('fs/promises'),base_veeva_error_1=require(a370_0x4ef9a3(0x10a)),salesforce_request_utils_1=require(a370_0x4ef9a3(0xf6)),veeva_auth_1=require(a370_0x4ef9a3(0x107)),salesforce_auth_1=require(a370_0x4ef9a3(0x11e)),rollback_service_1=require(a370_0x4ef9a3(0xfb)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;function a370_0x1e29(){const _0x34cc27=['RollbackService','__metadata','defineProperty','./classes/loggers/logger','BaseVeevaError','object','deployFromBranch','804sviXEP','./utils/salesforce-request.utils','SalesforceAuth','1554663FVLaPv','retrieveDependency','prototype','./services/rollback.service','Logger','design:returntype','metadata','907415iZIHkN','./utils/veeva-request.utils','body','default','design:paramtypes','./services/deploy.service','finally','AppResponseStatus','./classes/auth/veeva-auth','10895992sHlvxK','length','./classes/errors/base-veeva-error','DependencyService','__param','2064144sUESJt','message','FAILURE','./services/dependency.service','rollback','shortid','../../core','16245900rMZMpu','(((.+)+)+)+$','snapshot','SUCCESS','VeevaAuth','Post','__esModule','VeevaVaultController','__importDefault','veeva-vault','./classes/auth/salesforce-auth','2305GxqBZl','then','./services/snapshot.service','__decorate','toString','dependency','SnapshotService','getOwnPropertyDescriptor','param','decorate','deploy','6833834fjOQsb','instanceUrl','createSalesforceRequest','doSnapshot','search','makeDir','v1.1','getAuthDetails','6zkOHEd','createVeevaRequest','execute','DeployService','function','design:type'];a370_0x1e29=function(){return _0x34cc27;};return a370_0x1e29();}let VeevaVaultController=class VeevaVaultController{async[a370_0x4ef9a3(0x12d)](_0x4b380d){const _0x270e9d=a370_0x4ef9a3,{veevaAuth:_0xe6225f,timeZone:_0x32f405,attachmentLogId:_0xdc036}=_0x4b380d;try{const _0x41e735=(0x0,veeva_request_utils_1[_0x270e9d(0x133)])(new veeva_auth_1[(_0x270e9d(0x118))](_0xe6225f,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1cf486=await salesforce_auth_1[_0x270e9d(0xf7)][_0x270e9d(0x131)](),_0x3295d3=(0x0,salesforce_request_utils_1[_0x270e9d(0x12c)])(new salesforce_auth_1[(_0x270e9d(0xf7))](_0x1cf486)),_0xa628a6=new logger_1[(_0x270e9d(0xfc))](_0x3295d3,_0x32f405,_0xdc036),_0x4a7165=new snapshot_service_1[(_0x270e9d(0x125))](_0x4b380d,_0x3295d3,_0x41e735,_0xa628a6);return _0x4a7165['execute']()[_0x270e9d(0x120)](),{'responseStatus':status_enums_1[_0x270e9d(0x106)][_0x270e9d(0x117)]};}catch(_0x45a776){return{'responseStatus':status_enums_1[_0x270e9d(0x106)][_0x270e9d(0x10f)],'responseMessage':_0x45a776[_0x270e9d(0x10e)]};}}async[a370_0x4ef9a3(0xf4)](_0xa9c528){const _0x1b0159=a370_0x4ef9a3,{veevaAuth:_0x4348b2,timeZone:_0xa8304f,attachmentLogId:_0x7bf4c4}=_0xa9c528;try{const _0x2ec675=(0x0,veeva_request_utils_1[_0x1b0159(0x133)])(new veeva_auth_1['VeevaAuth'](_0x4348b2,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x103774=await salesforce_auth_1[_0x1b0159(0xf7)]['getAuthDetails'](),_0x1edb21=(0x0,salesforce_request_utils_1[_0x1b0159(0x12c)])(new salesforce_auth_1[(_0x1b0159(0xf7))](_0x103774)),_0x3242d5=new logger_1[(_0x1b0159(0xfc))](_0x1edb21,_0xa8304f,_0x7bf4c4),_0x6279b4='temp/veeva/deploy_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1['makeDir'])(_0x6279b4);const _0x3ea5bd=new deploy_service_1[(_0x1b0159(0x135))](_0xa9c528,_0x1edb21,_0x2ec675,_0x3242d5,_0x6279b4,_0x103774[_0x1b0159(0x12b)]);return _0x3ea5bd[_0x1b0159(0x134)]()[_0x1b0159(0x105)](()=>(0x0,promises_1['rm'])(_0x6279b4,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x1b0159(0x106)][_0x1b0159(0x117)]};}catch(_0x20110a){return{'responseStatus':status_enums_1[_0x1b0159(0x106)]['FAILURE'],'responseMessage':_0x20110a[_0x1b0159(0x10e)]};}}async[a370_0x4ef9a3(0xf9)](_0x59ba1c){const _0x78ca66=a370_0x4ef9a3,{veevaAuth:_0x4702e3}=_0x59ba1c;try{const _0x1e87e1=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x78ca66(0x118))](_0x4702e3)),_0x41fb28=await salesforce_auth_1[_0x78ca66(0xf7)][_0x78ca66(0x131)](),_0x65a42b=(0x0,salesforce_request_utils_1[_0x78ca66(0x12c)])(new salesforce_auth_1[(_0x78ca66(0xf7))](_0x41fb28)),_0xd851ab=new dependency_service_1[(_0x78ca66(0x10b))](_0x59ba1c,_0x65a42b,_0x1e87e1);return await _0xd851ab[_0x78ca66(0x134)]();}catch(_0x3719d7){const _0x1a85db=_0x3719d7 instanceof base_veeva_error_1[_0x78ca66(0xf2)]?_0x3719d7['getMessages']()['join']('\x0a'):_0x3719d7[_0x78ca66(0x10e)];return{'responseStatus':status_enums_1[_0x78ca66(0x106)][_0x78ca66(0x10f)],'responseMessage':_0x1a85db};}}async[a370_0x4ef9a3(0x111)](_0x14e6b6){const _0x21d124=a370_0x4ef9a3,{veevaAuth:_0x424aa2,timeZone:_0x3f094d,attachmentLogId:_0x4848e4}=_0x14e6b6;try{const _0x43ebe0=(0x0,veeva_request_utils_1[_0x21d124(0x133)])(new veeva_auth_1['VeevaAuth'](_0x424aa2,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x295fcb=await salesforce_auth_1['SalesforceAuth'][_0x21d124(0x131)](),_0x58042f=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x21d124(0xf7))](_0x295fcb)),_0x54c206=new logger_1[(_0x21d124(0xfc))](_0x58042f,_0x3f094d,_0x4848e4),_0x117c54='temp/veeva/rollback_'+(0x0,shortid_1[_0x21d124(0x102)])();await(0x0,fs_util_1[_0x21d124(0x12f)])(_0x117c54);const _0x79be3=new rollback_service_1[(_0x21d124(0x138))]({..._0x14e6b6,'connectionVeeva':_0x43ebe0,'connectionSalesforce':_0x58042f,'logger':_0x54c206,'tempFolder':_0x117c54,'instanceUrl':_0x295fcb[_0x21d124(0x12b)]});return _0x79be3[_0x21d124(0x134)]()[_0x21d124(0x105)](()=>(0x0,promises_1['rm'])(_0x117c54,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x21d124(0x117)]};}catch(_0x2ea758){return{'responseStatus':status_enums_1[_0x21d124(0x106)][_0x21d124(0x10f)],'responseMessage':_0x2ea758['message']};}}};__decorate([(0x0,core_1['Post'])(a370_0x4ef9a3(0x116)),__param(0x0,core_1[a370_0x4ef9a3(0x127)][a370_0x4ef9a3(0x101)]()),__metadata('design:type',Function),__metadata(a370_0x4ef9a3(0x103),[Object]),__metadata(a370_0x4ef9a3(0xfd),Promise)],VeevaVaultController[a370_0x4ef9a3(0xfa)],a370_0x4ef9a3(0x12d),null),__decorate([(0x0,core_1['Post'])(a370_0x4ef9a3(0x129)),__param(0x0,core_1[a370_0x4ef9a3(0x127)][a370_0x4ef9a3(0x101)]()),__metadata('design:type',Function),__metadata(a370_0x4ef9a3(0x103),[Object]),__metadata(a370_0x4ef9a3(0xfd),Promise)],VeevaVaultController[a370_0x4ef9a3(0xfa)],a370_0x4ef9a3(0xf4),null),__decorate([(0x0,core_1['Post'])(a370_0x4ef9a3(0x124)),__param(0x0,core_1[a370_0x4ef9a3(0x127)][a370_0x4ef9a3(0x101)]()),__metadata(a370_0x4ef9a3(0x137),Function),__metadata(a370_0x4ef9a3(0x103),[Object]),__metadata(a370_0x4ef9a3(0xfd),Promise)],VeevaVaultController[a370_0x4ef9a3(0xfa)],a370_0x4ef9a3(0xf9),null),__decorate([(0x0,core_1[a370_0x4ef9a3(0x119)])(a370_0x4ef9a3(0x111)),__param(0x0,core_1['param'][a370_0x4ef9a3(0x101)]()),__metadata(a370_0x4ef9a3(0x137),Function),__metadata(a370_0x4ef9a3(0x103),[Object]),__metadata(a370_0x4ef9a3(0xfd),Promise)],VeevaVaultController[a370_0x4ef9a3(0xfa)],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])(a370_0x4ef9a3(0x11d)),(0x0,core_1['Version'])(a370_0x4ef9a3(0x130))],VeevaVaultController),exports[a370_0x4ef9a3(0x11b)]=VeevaVaultController;