const a387_0x2c7df9=a387_0x2aa7;(function(_0x97afb3,_0x2a211e){const _0x4e6afb=a387_0x2aa7,_0x4f4a7f=_0x97afb3();while(!![]){try{const _0x27d0bc=-parseInt(_0x4e6afb(0x22c))/0x1*(parseInt(_0x4e6afb(0x212))/0x2)+-parseInt(_0x4e6afb(0x1fa))/0x3+parseInt(_0x4e6afb(0x21d))/0x4*(-parseInt(_0x4e6afb(0x228))/0x5)+-parseInt(_0x4e6afb(0x20d))/0x6*(parseInt(_0x4e6afb(0x20c))/0x7)+-parseInt(_0x4e6afb(0x1fd))/0x8+-parseInt(_0x4e6afb(0x217))/0x9+parseInt(_0x4e6afb(0x21f))/0xa;if(_0x27d0bc===_0x2a211e)break;else _0x4f4a7f['push'](_0x4f4a7f['shift']());}catch(_0x4174f8){_0x4f4a7f['push'](_0x4f4a7f['shift']());}}}(a387_0x469b,0x4c76e));function a387_0x2aa7(_0x3c755c,_0x1acddb){const _0x75bf84=a387_0x469b();return a387_0x2aa7=function(_0x4fc605,_0x34839f){_0x4fc605=_0x4fc605-0x1ea;let _0x469b8e=_0x75bf84[_0x4fc605];return _0x469b8e;},a387_0x2aa7(_0x3c755c,_0x1acddb);}const a387_0x34839f=(function(){let _0x531432=!![];return function(_0x458975,_0x502e6c){const _0xd5a38c=_0x531432?function(){if(_0x502e6c){const _0x148cad=_0x502e6c['apply'](_0x458975,arguments);return _0x502e6c=null,_0x148cad;}}:function(){};return _0x531432=![],_0xd5a38c;};}()),a387_0x4fc605=a387_0x34839f(this,function(){const _0x26ed26=a387_0x2aa7;return a387_0x4fc605[_0x26ed26(0x213)]()[_0x26ed26(0x203)](_0x26ed26(0x204))[_0x26ed26(0x213)]()[_0x26ed26(0x1f8)](a387_0x4fc605)['search']('(((.+)+)+)+$');});a387_0x4fc605();'use strict';var __decorate=this&&this[a387_0x2c7df9(0x223)]||function(_0x6c9b28,_0x141a11,_0x5c10d1,_0x26a660){const _0x7c2ce3=a387_0x2c7df9;var _0x479a46=arguments[_0x7c2ce3(0x211)],_0x2dc623=_0x479a46<0x3?_0x141a11:_0x26a660===null?_0x26a660=Object['getOwnPropertyDescriptor'](_0x141a11,_0x5c10d1):_0x26a660,_0x49a01f;if(typeof Reflect===_0x7c2ce3(0x222)&&typeof Reflect[_0x7c2ce3(0x22a)]===_0x7c2ce3(0x219))_0x2dc623=Reflect[_0x7c2ce3(0x22a)](_0x6c9b28,_0x141a11,_0x5c10d1,_0x26a660);else{for(var _0x4987a3=_0x6c9b28['length']-0x1;_0x4987a3>=0x0;_0x4987a3--)if(_0x49a01f=_0x6c9b28[_0x4987a3])_0x2dc623=(_0x479a46<0x3?_0x49a01f(_0x2dc623):_0x479a46>0x3?_0x49a01f(_0x141a11,_0x5c10d1,_0x2dc623):_0x49a01f(_0x141a11,_0x5c10d1))||_0x2dc623;}return _0x479a46>0x3&&_0x2dc623&&Object['defineProperty'](_0x141a11,_0x5c10d1,_0x2dc623),_0x2dc623;},__metadata=this&&this['__metadata']||function(_0xf48c60,_0x1ab1a0){const _0x39fd3e=a387_0x2c7df9;if(typeof Reflect===_0x39fd3e(0x222)&&typeof Reflect['metadata']===_0x39fd3e(0x219))return Reflect['metadata'](_0xf48c60,_0x1ab1a0);},__param=this&&this[a387_0x2c7df9(0x1f3)]||function(_0x541bd1,_0x4ec36e){return function(_0x26b119,_0x3f4a1c){_0x4ec36e(_0x26b119,_0x3f4a1c,_0x541bd1);};},__importDefault=this&&this[a387_0x2c7df9(0x201)]||function(_0x1e5c7a){const _0xbb7daa=a387_0x2c7df9;return _0x1e5c7a&&_0x1e5c7a[_0xbb7daa(0x214)]?_0x1e5c7a:{'default':_0x1e5c7a};};Object['defineProperty'](exports,a387_0x2c7df9(0x214),{'value':!![]}),exports[a387_0x2c7df9(0x1f4)]=void 0x0;const core_1=require('../../core'),dependency_service_1=require(a387_0x2c7df9(0x218)),snapshot_service_1=require(a387_0x2c7df9(0x1fb)),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require('./enums/status.enums'),shortid_1=__importDefault(require(a387_0x2c7df9(0x1ee))),fs_util_1=require(a387_0x2c7df9(0x22b)),logger_1=require(a387_0x2c7df9(0x227)),promises_1=require('fs/promises'),base_veeva_error_1=require(a387_0x2c7df9(0x220)),salesforce_request_utils_1=require(a387_0x2c7df9(0x200)),veeva_auth_1=require(a387_0x2c7df9(0x202)),salesforce_auth_1=require(a387_0x2c7df9(0x1ff)),rollback_service_1=require(a387_0x2c7df9(0x207)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a387_0x2c7df9(0x21e)](_0x4129ba){const _0x590812=a387_0x2c7df9,{veevaAuth:_0x2ea949,timeZone:_0x1f12a6,attachmentLogId:_0x57610c}=_0x4129ba;try{const _0x318a81=(0x0,veeva_request_utils_1[_0x590812(0x1ed)])(new veeva_auth_1[(_0x590812(0x209))](_0x2ea949,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xea368f=await salesforce_auth_1['SalesforceAuth'][_0x590812(0x21b)](),_0x2f2101=(0x0,salesforce_request_utils_1[_0x590812(0x1f6)])(new salesforce_auth_1[(_0x590812(0x1f0))](_0xea368f)),_0x4f2ef3=new logger_1[(_0x590812(0x1f2))](_0x2f2101,_0x1f12a6,_0x57610c),_0x3f6b4a=new snapshot_service_1['SnapshotService'](_0x4129ba,_0x2f2101,_0x318a81,_0x4f2ef3);return _0x3f6b4a[_0x590812(0x21c)]()['then'](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x590812(0x221)]};}catch(_0x15885a){return{'responseStatus':status_enums_1[_0x590812(0x224)][_0x590812(0x208)],'responseMessage':_0x15885a[_0x590812(0x20e)]};}}async[a387_0x2c7df9(0x1f7)](_0x31c226){const _0x120dc4=a387_0x2c7df9,{veevaAuth:_0xd02125,timeZone:_0x29b3ce,attachmentLogId:_0x4331f6}=_0x31c226;try{const _0xfc3756=(0x0,veeva_request_utils_1[_0x120dc4(0x1ed)])(new veeva_auth_1['VeevaAuth'](_0xd02125,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x50d964=await salesforce_auth_1[_0x120dc4(0x1f0)][_0x120dc4(0x21b)](),_0x54b784=(0x0,salesforce_request_utils_1[_0x120dc4(0x1f6)])(new salesforce_auth_1[(_0x120dc4(0x1f0))](_0x50d964)),_0x49afb9=new logger_1[(_0x120dc4(0x1f2))](_0x54b784,_0x29b3ce,_0x4331f6),_0x3cd64e='temp/veeva/deploy_'+(0x0,shortid_1[_0x120dc4(0x206)])();await(0x0,fs_util_1[_0x120dc4(0x1ef)])(_0x3cd64e);const _0xeabde8=new deploy_service_1['DeployService'](_0x31c226,_0x54b784,_0xfc3756,_0x49afb9,_0x3cd64e,_0x50d964[_0x120dc4(0x205)]);return _0xeabde8[_0x120dc4(0x21c)]()[_0x120dc4(0x216)](()=>(0x0,promises_1['rm'])(_0x3cd64e,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x120dc4(0x224)][_0x120dc4(0x221)]};}catch(_0x22c867){return{'responseStatus':status_enums_1[_0x120dc4(0x224)]['FAILURE'],'responseMessage':_0x22c867[_0x120dc4(0x20e)]};}}async[a387_0x2c7df9(0x1f9)](_0x22223e){const _0x391441=a387_0x2c7df9,{veevaAuth:_0x34a5ae}=_0x22223e;try{const _0x1aca48=(0x0,veeva_request_utils_1[_0x391441(0x1ed)])(new veeva_auth_1[(_0x391441(0x209))](_0x34a5ae)),_0x128af4=await salesforce_auth_1[_0x391441(0x1f0)][_0x391441(0x21b)](),_0x470110=(0x0,salesforce_request_utils_1[_0x391441(0x1f6)])(new salesforce_auth_1[(_0x391441(0x1f0))](_0x128af4)),_0x327056=new dependency_service_1[(_0x391441(0x1f1))](_0x22223e,_0x470110,_0x1aca48);return await _0x327056['execute']();}catch(_0x59900a){const _0x5a7d82=_0x59900a instanceof base_veeva_error_1['BaseVeevaError']?_0x59900a[_0x391441(0x229)]()['join']('\x0a'):_0x59900a[_0x391441(0x20e)];return{'responseStatus':status_enums_1[_0x391441(0x224)][_0x391441(0x208)],'responseMessage':_0x5a7d82};}}async[a387_0x2c7df9(0x20f)](_0x4a6484){const _0x58ceae=a387_0x2c7df9,{veevaAuth:_0x55affc,timeZone:_0x11e6b7,attachmentLogId:_0xde4bfa}=_0x4a6484;try{const _0x52c1b6=(0x0,veeva_request_utils_1[_0x58ceae(0x1ed)])(new veeva_auth_1[(_0x58ceae(0x209))](_0x55affc,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xad33ee=await salesforce_auth_1['SalesforceAuth'][_0x58ceae(0x21b)](),_0x5ed18b=(0x0,salesforce_request_utils_1[_0x58ceae(0x1f6)])(new salesforce_auth_1[(_0x58ceae(0x1f0))](_0xad33ee)),_0x3c0616=new logger_1[(_0x58ceae(0x1f2))](_0x5ed18b,_0x11e6b7,_0xde4bfa),_0x36bdfc='temp/veeva/rollback_'+(0x0,shortid_1[_0x58ceae(0x206)])();await(0x0,fs_util_1[_0x58ceae(0x1ef)])(_0x36bdfc);const _0x3423cb=new rollback_service_1['RollbackService']({..._0x4a6484,'connectionVeeva':_0x52c1b6,'connectionSalesforce':_0x5ed18b,'logger':_0x3c0616,'tempFolder':_0x36bdfc,'instanceUrl':_0xad33ee[_0x58ceae(0x205)]});return _0x3423cb[_0x58ceae(0x21c)]()[_0x58ceae(0x216)](()=>(0x0,promises_1['rm'])(_0x36bdfc,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x58ceae(0x224)][_0x58ceae(0x221)]};}catch(_0x5b7d64){return{'responseStatus':status_enums_1[_0x58ceae(0x224)]['FAILURE'],'responseMessage':_0x5b7d64['message']};}}};__decorate([(0x0,core_1[a387_0x2c7df9(0x215)])(a387_0x2c7df9(0x20b)),__param(0x0,core_1[a387_0x2c7df9(0x226)][a387_0x2c7df9(0x225)]()),__metadata(a387_0x2c7df9(0x1f5),Function),__metadata(a387_0x2c7df9(0x1fe),[Object]),__metadata(a387_0x2c7df9(0x20a),Promise)],VeevaVaultController[a387_0x2c7df9(0x210)],'doSnapshot',null),__decorate([(0x0,core_1[a387_0x2c7df9(0x215)])(a387_0x2c7df9(0x1ea)),__param(0x0,core_1[a387_0x2c7df9(0x226)][a387_0x2c7df9(0x225)]()),__metadata(a387_0x2c7df9(0x1f5),Function),__metadata(a387_0x2c7df9(0x1fe),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a387_0x2c7df9(0x1f7),null),__decorate([(0x0,core_1[a387_0x2c7df9(0x215)])(a387_0x2c7df9(0x1ec)),__param(0x0,core_1[a387_0x2c7df9(0x226)][a387_0x2c7df9(0x225)]()),__metadata(a387_0x2c7df9(0x1f5),Function),__metadata(a387_0x2c7df9(0x1fe),[Object]),__metadata(a387_0x2c7df9(0x20a),Promise)],VeevaVaultController[a387_0x2c7df9(0x210)],'retrieveDependency',null),__decorate([(0x0,core_1[a387_0x2c7df9(0x215)])(a387_0x2c7df9(0x20f)),__param(0x0,core_1[a387_0x2c7df9(0x226)][a387_0x2c7df9(0x225)]()),__metadata(a387_0x2c7df9(0x1f5),Function),__metadata(a387_0x2c7df9(0x1fe),[Object]),__metadata(a387_0x2c7df9(0x20a),Promise)],VeevaVaultController[a387_0x2c7df9(0x210)],a387_0x2c7df9(0x20f),null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])(a387_0x2c7df9(0x1fc)),(0x0,core_1[a387_0x2c7df9(0x1eb)])(a387_0x2c7df9(0x21a))],VeevaVaultController),exports[a387_0x2c7df9(0x1f4)]=VeevaVaultController;function a387_0x469b(){const _0x44e83f=['v1.1','getAuthDetails','execute','3808rtczwc','doSnapshot','12774490PmLLYJ','./classes/errors/base-veeva-error','SUCCESS','object','__decorate','AppResponseStatus','body','param','./classes/loggers/logger','1110syaGsQ','getMessages','decorate','./utils/fs-util','254086cJfKLq','deploy','Version','dependency','createVeevaRequest','shortid','makeDir','SalesforceAuth','DependencyService','Logger','__param','VeevaVaultController','design:type','createSalesforceRequest','deployFromBranch','constructor','retrieveDependency','408441zPmkjz','./services/snapshot.service','veeva-vault','1109800zQzVEv','design:paramtypes','./classes/auth/salesforce-auth','./utils/salesforce-request.utils','__importDefault','./classes/auth/veeva-auth','search','(((.+)+)+)+$','instanceUrl','default','./services/rollback.service','FAILURE','VeevaAuth','design:returntype','snapshot','6377SwsXmC','1236oJqOBg','message','rollback','prototype','length','2yoeywy','toString','__esModule','Post','finally','326547LovUru','./services/dependency.service','function'];a387_0x469b=function(){return _0x44e83f;};return a387_0x469b();}