const a415_0x2bb68a=a415_0x151d;(function(_0x409643,_0x216f4f){const _0x320636=a415_0x151d,_0x2577a4=_0x409643();while(!![]){try{const _0x3b7d89=parseInt(_0x320636(0x99))/0x1+-parseInt(_0x320636(0xac))/0x2+-parseInt(_0x320636(0xd0))/0x3+-parseInt(_0x320636(0xcc))/0x4+parseInt(_0x320636(0xc6))/0x5+-parseInt(_0x320636(0x94))/0x6*(-parseInt(_0x320636(0x9d))/0x7)+parseInt(_0x320636(0xaa))/0x8;if(_0x3b7d89===_0x216f4f)break;else _0x2577a4['push'](_0x2577a4['shift']());}catch(_0x426f10){_0x2577a4['push'](_0x2577a4['shift']());}}}(a415_0x1b01,0xf202c));const a415_0x5b3c8e=(function(){let _0x58a4e1=!![];return function(_0x2a3daf,_0x5450a8){const _0x358ed3=_0x58a4e1?function(){const _0x3ada7d=a415_0x151d;if(_0x5450a8){const _0x4b96de=_0x5450a8[_0x3ada7d(0xa9)](_0x2a3daf,arguments);return _0x5450a8=null,_0x4b96de;}}:function(){};return _0x58a4e1=![],_0x358ed3;};}()),a415_0x27fc6a=a415_0x5b3c8e(this,function(){const _0x5f43db=a415_0x151d;return a415_0x27fc6a[_0x5f43db(0xcd)]()[_0x5f43db(0x93)](_0x5f43db(0xa7))[_0x5f43db(0xcd)]()[_0x5f43db(0xc5)](a415_0x27fc6a)['search'](_0x5f43db(0xa7));});function a415_0x151d(_0x31bf20,_0x58c8b6){const _0x2b2041=a415_0x1b01();return a415_0x151d=function(_0x27fc6a,_0x5b3c8e){_0x27fc6a=_0x27fc6a-0x91;let _0x1b013c=_0x2b2041[_0x27fc6a];return _0x1b013c;},a415_0x151d(_0x31bf20,_0x58c8b6);}a415_0x27fc6a();'use strict';var __decorate=this&&this[a415_0x2bb68a(0xbc)]||function(_0xa13449,_0x5357ef,_0x51928d,_0x285f9f){const _0x56267b=a415_0x2bb68a;var _0x319e4c=arguments[_0x56267b(0xd1)],_0x2d30fb=_0x319e4c<0x3?_0x5357ef:_0x285f9f===null?_0x285f9f=Object[_0x56267b(0xa6)](_0x5357ef,_0x51928d):_0x285f9f,_0x3bbb54;if(typeof Reflect===_0x56267b(0xa2)&&typeof Reflect['decorate']===_0x56267b(0x9c))_0x2d30fb=Reflect[_0x56267b(0xbd)](_0xa13449,_0x5357ef,_0x51928d,_0x285f9f);else{for(var _0x405452=_0xa13449[_0x56267b(0xd1)]-0x1;_0x405452>=0x0;_0x405452--)if(_0x3bbb54=_0xa13449[_0x405452])_0x2d30fb=(_0x319e4c<0x3?_0x3bbb54(_0x2d30fb):_0x319e4c>0x3?_0x3bbb54(_0x5357ef,_0x51928d,_0x2d30fb):_0x3bbb54(_0x5357ef,_0x51928d))||_0x2d30fb;}return _0x319e4c>0x3&&_0x2d30fb&&Object[_0x56267b(0x92)](_0x5357ef,_0x51928d,_0x2d30fb),_0x2d30fb;},__metadata=this&&this[a415_0x2bb68a(0xd7)]||function(_0x2af40a,_0x2b41b2){const _0x1aa7da=a415_0x2bb68a;if(typeof Reflect===_0x1aa7da(0xa2)&&typeof Reflect['metadata']===_0x1aa7da(0x9c))return Reflect[_0x1aa7da(0xb5)](_0x2af40a,_0x2b41b2);},__param=this&&this['__param']||function(_0x9ae927,_0x490305){return function(_0x205bd1,_0x4a6704){_0x490305(_0x205bd1,_0x4a6704,_0x9ae927);};},__importDefault=this&&this[a415_0x2bb68a(0xd6)]||function(_0x3cca5e){const _0x433df2=a415_0x2bb68a;return _0x3cca5e&&_0x3cca5e[_0x433df2(0xc3)]?_0x3cca5e:{'default':_0x3cca5e};};Object[a415_0x2bb68a(0x92)](exports,a415_0x2bb68a(0xc3),{'value':!![]}),exports[a415_0x2bb68a(0xbe)]=void 0x0;const core_1=require(a415_0x2bb68a(0x91)),dependency_service_1=require(a415_0x2bb68a(0xca)),snapshot_service_1=require(a415_0x2bb68a(0xd2)),deploy_service_1=require(a415_0x2bb68a(0xb4)),veeva_request_utils_1=require(a415_0x2bb68a(0x9e)),status_enums_1=require(a415_0x2bb68a(0xc9)),shortid_1=__importDefault(require(a415_0x2bb68a(0x96))),fs_util_1=require('./utils/fs-util'),logger_1=require(a415_0x2bb68a(0xd4)),promises_1=require(a415_0x2bb68a(0xb2)),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require(a415_0x2bb68a(0xb3)),veeva_auth_1=require(a415_0x2bb68a(0xa4)),salesforce_auth_1=require(a415_0x2bb68a(0xab)),rollback_service_1=require(a415_0x2bb68a(0x95)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x2ae976){const _0x5218e7=a415_0x2bb68a,{veevaAuth:_0x9154a2,timeZone:_0x223718,attachmentLogId:_0x120ea1}=_0x2ae976;try{const _0x528243=(0x0,veeva_request_utils_1[_0x5218e7(0xb0)])(new veeva_auth_1[(_0x5218e7(0xa8))](_0x9154a2,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x3fad78=await salesforce_auth_1[_0x5218e7(0xc8)]['getAuthDetails'](),_0x272f22=(0x0,salesforce_request_utils_1[_0x5218e7(0xb9)])(new salesforce_auth_1[(_0x5218e7(0xc8))](_0x3fad78)),_0x285d12=new logger_1[(_0x5218e7(0xa3))](_0x272f22,_0x223718,_0x120ea1),_0x830e36=new snapshot_service_1['SnapshotService'](_0x2ae976,_0x272f22,_0x528243,_0x285d12);return _0x830e36[_0x5218e7(0xae)]()['then'](),{'responseStatus':status_enums_1[_0x5218e7(0x9f)]['SUCCESS']};}catch(_0x44adaf){return{'responseStatus':status_enums_1[_0x5218e7(0x9f)]['FAILURE'],'responseMessage':_0x44adaf['message']};}}async['deployFromBranch'](_0x4526c6){const _0x3073b9=a415_0x2bb68a,{veevaAuth:_0x8cec27,timeZone:_0xa478a,attachmentLogId:_0x4fa0ba}=_0x4526c6;try{const _0x22ab07=(0x0,veeva_request_utils_1[_0x3073b9(0xb0)])(new veeva_auth_1[(_0x3073b9(0xa8))](_0x8cec27,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5595fa=await salesforce_auth_1[_0x3073b9(0xc8)][_0x3073b9(0xd9)](),_0x4e746b=(0x0,salesforce_request_utils_1[_0x3073b9(0xb9)])(new salesforce_auth_1['SalesforceAuth'](_0x5595fa)),_0xf10e31=new logger_1[(_0x3073b9(0xa3))](_0x4e746b,_0xa478a,_0x4fa0ba),_0x1c5afc=_0x3073b9(0x97)+(0x0,shortid_1[_0x3073b9(0xc0)])();await(0x0,fs_util_1['makeDir'])(_0x1c5afc);const _0xc5bd0c=new deploy_service_1['DeployService'](_0x4526c6,_0x4e746b,_0x22ab07,_0xf10e31,_0x1c5afc,_0x5595fa[_0x3073b9(0xb6)]);return _0xc5bd0c[_0x3073b9(0xae)]()[_0x3073b9(0xa1)](()=>(0x0,promises_1['rm'])(_0x1c5afc,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x3073b9(0x9f)][_0x3073b9(0xcb)]};}catch(_0x48f094){return{'responseStatus':status_enums_1[_0x3073b9(0x9f)][_0x3073b9(0xd8)],'responseMessage':_0x48f094['message']};}}async[a415_0x2bb68a(0x9b)](_0x2c3366){const _0x11c965=a415_0x2bb68a,{veevaAuth:_0x193be7}=_0x2c3366;try{const _0x306721=(0x0,veeva_request_utils_1[_0x11c965(0xb0)])(new veeva_auth_1[(_0x11c965(0xa8))](_0x193be7)),_0xf40345=await salesforce_auth_1[_0x11c965(0xc8)][_0x11c965(0xd9)](),_0x146cde=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x11c965(0xc8))](_0xf40345)),_0x45d228=new dependency_service_1[(_0x11c965(0xc4))](_0x2c3366,_0x146cde,_0x306721);return await _0x45d228[_0x11c965(0xae)]();}catch(_0x40059c){const _0x179fc5=_0x40059c instanceof base_veeva_error_1[_0x11c965(0x9a)]?_0x40059c[_0x11c965(0xcf)]()[_0x11c965(0xc2)]('\x0a'):_0x40059c[_0x11c965(0xc1)];return{'responseStatus':status_enums_1[_0x11c965(0x9f)][_0x11c965(0xd8)],'responseMessage':_0x179fc5};}}async[a415_0x2bb68a(0x98)](_0x33d3fc){const _0x96ae2f=a415_0x2bb68a,{veevaAuth:_0x543510,timeZone:_0x26c67e,attachmentLogId:_0x33a897}=_0x33d3fc;try{const _0x2f3b82=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1['VeevaAuth'](_0x543510,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x4fa9f1=await salesforce_auth_1[_0x96ae2f(0xc8)]['getAuthDetails'](),_0x3cc699=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0x4fa9f1)),_0x4fe167=new logger_1['Logger'](_0x3cc699,_0x26c67e,_0x33a897),_0x2445dc=_0x96ae2f(0xad)+(0x0,shortid_1[_0x96ae2f(0xc0)])();await(0x0,fs_util_1[_0x96ae2f(0xd5)])(_0x2445dc);const _0x235db5=new rollback_service_1[(_0x96ae2f(0xba))]({..._0x33d3fc,'connectionVeeva':_0x2f3b82,'connectionSalesforce':_0x3cc699,'logger':_0x4fe167,'tempFolder':_0x2445dc,'instanceUrl':_0x4fa9f1[_0x96ae2f(0xb6)]});return _0x235db5[_0x96ae2f(0xae)]()[_0x96ae2f(0xa1)](()=>(0x0,promises_1['rm'])(_0x2445dc,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x96ae2f(0x9f)][_0x96ae2f(0xcb)]};}catch(_0x584a93){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x96ae2f(0xd8)],'responseMessage':_0x584a93['message']};}}};function a415_0x1b01(){const _0x39f7cf=['RollbackService','prototype','__decorate','decorate','VeevaVaultController','design:returntype','default','message','join','__esModule','DependencyService','constructor','7333610nasspu','body','SalesforceAuth','./enums/status.enums','./services/dependency.service','SUCCESS','7482368Ueeidt','toString','Controller','getMessages','1990239xcPujX','length','./services/snapshot.service','Post','./classes/loggers/logger','makeDir','__importDefault','__metadata','FAILURE','getAuthDetails','v1.1','param','Version','../../core','defineProperty','search','1446672lrQgyd','./services/rollback.service','shortid','temp/veeva/deploy_','rollback','209248YMbnrh','BaseVeevaError','retrieveDependency','function','21YGZUvG','./utils/veeva-request.utils','AppResponseStatus','deployFromBranch','finally','object','Logger','./classes/auth/veeva-auth','dependency','getOwnPropertyDescriptor','(((.+)+)+)+$','VeevaAuth','apply','13070064uqmXKd','./classes/auth/salesforce-auth','1015566DSWcYC','temp/veeva/rollback_','execute','deploy','createVeevaRequest','doSnapshot','fs/promises','./utils/salesforce-request.utils','./services/deploy.service','metadata','instanceUrl','design:paramtypes','design:type','createSalesforceRequest'];a415_0x1b01=function(){return _0x39f7cf;};return a415_0x1b01();}__decorate([(0x0,core_1[a415_0x2bb68a(0xd3)])('snapshot'),__param(0x0,core_1[a415_0x2bb68a(0xdb)][a415_0x2bb68a(0xc7)]()),__metadata(a415_0x2bb68a(0xb8),Function),__metadata(a415_0x2bb68a(0xb7),[Object]),__metadata(a415_0x2bb68a(0xbf),Promise)],VeevaVaultController[a415_0x2bb68a(0xbb)],a415_0x2bb68a(0xb1),null),__decorate([(0x0,core_1[a415_0x2bb68a(0xd3)])(a415_0x2bb68a(0xaf)),__param(0x0,core_1['param'][a415_0x2bb68a(0xc7)]()),__metadata(a415_0x2bb68a(0xb8),Function),__metadata(a415_0x2bb68a(0xb7),[Object]),__metadata(a415_0x2bb68a(0xbf),Promise)],VeevaVaultController['prototype'],a415_0x2bb68a(0xa0),null),__decorate([(0x0,core_1[a415_0x2bb68a(0xd3)])(a415_0x2bb68a(0xa5)),__param(0x0,core_1[a415_0x2bb68a(0xdb)]['body']()),__metadata(a415_0x2bb68a(0xb8),Function),__metadata(a415_0x2bb68a(0xb7),[Object]),__metadata(a415_0x2bb68a(0xbf),Promise)],VeevaVaultController['prototype'],a415_0x2bb68a(0x9b),null),__decorate([(0x0,core_1[a415_0x2bb68a(0xd3)])(a415_0x2bb68a(0x98)),__param(0x0,core_1[a415_0x2bb68a(0xdb)][a415_0x2bb68a(0xc7)]()),__metadata('design:type',Function),__metadata(a415_0x2bb68a(0xb7),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a415_0x2bb68a(0xbb)],a415_0x2bb68a(0x98),null),VeevaVaultController=__decorate([(0x0,core_1[a415_0x2bb68a(0xce)])('veeva-vault'),(0x0,core_1[a415_0x2bb68a(0xdc)])(a415_0x2bb68a(0xda))],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;