const a386_0x58f347=a386_0x4561;function a386_0x2c94(){const _0x618aa2=['createVeevaRequest','1858041CZQqQJ','1454016FdbswM','rollback','fs/promises','doSnapshot','./services/deploy.service','(((.+)+)+)+$','BaseVeevaError','./utils/salesforce-request.utils','execute','instanceUrl','SalesforceAuth','__importDefault','24687PPKqvJ','VeevaAuth','design:paramtypes','DependencyService','Post','veeva-vault','../../core','default','shortid','1430814MAGDHn','param','finally','FAILURE','__decorate','object','retrieveDependency','__esModule','function','then','design:type','metadata','SUCCESS','defineProperty','675656pQuORO','getAuthDetails','design:returntype','RollbackService','5dzRsjb','createSalesforceRequest','deploy','22228EcFfDu','message','./utils/veeva-request.utils','./utils/fs-util','join','4cTuMrb','./services/rollback.service','getOwnPropertyDescriptor','snapshot','prototype','deployFromBranch','SnapshotService','body','length','1289673riCkdC','AppResponseStatus','decorate','Logger','./enums/status.enums','./classes/loggers/logger','__metadata','makeDir','search','./classes/auth/veeva-auth'];a386_0x2c94=function(){return _0x618aa2;};return a386_0x2c94();}(function(_0x20b27d,_0x4065d6){const _0x307ba1=a386_0x4561,_0x4948aa=_0x20b27d();while(!![]){try{const _0x3ae6da=parseInt(_0x307ba1(0x227))/0x1*(-parseInt(_0x307ba1(0x222))/0x2)+-parseInt(_0x307ba1(0x204))/0x3+-parseInt(_0x307ba1(0x21b))/0x4*(-parseInt(_0x307ba1(0x21f))/0x5)+parseInt(_0x307ba1(0x20d))/0x6+parseInt(_0x307ba1(0x230))/0x7+-parseInt(_0x307ba1(0x1f8))/0x8+-parseInt(_0x307ba1(0x1f7))/0x9;if(_0x3ae6da===_0x4065d6)break;else _0x4948aa['push'](_0x4948aa['shift']());}catch(_0x197929){_0x4948aa['push'](_0x4948aa['shift']());}}}(a386_0x2c94,0x24cd0));const a386_0xfc8745=(function(){let _0x1104be=!![];return function(_0x255b5b,_0x2e25d2){const _0x4299ff=_0x1104be?function(){if(_0x2e25d2){const _0x19bc24=_0x2e25d2['apply'](_0x255b5b,arguments);return _0x2e25d2=null,_0x19bc24;}}:function(){};return _0x1104be=![],_0x4299ff;};}()),a386_0x2e1105=a386_0xfc8745(this,function(){const _0x287739=a386_0x4561;return a386_0x2e1105['toString']()['search'](_0x287739(0x1fd))['toString']()['constructor'](a386_0x2e1105)[_0x287739(0x1f4)](_0x287739(0x1fd));});a386_0x2e1105();'use strict';var __decorate=this&&this[a386_0x58f347(0x211)]||function(_0x3b3c57,_0x5b1f1a,_0x3cff4b,_0x2257f1){const _0x4fce63=a386_0x58f347;var _0x518fc3=arguments[_0x4fce63(0x22f)],_0x13597f=_0x518fc3<0x3?_0x5b1f1a:_0x2257f1===null?_0x2257f1=Object[_0x4fce63(0x229)](_0x5b1f1a,_0x3cff4b):_0x2257f1,_0x22077b;if(typeof Reflect===_0x4fce63(0x212)&&typeof Reflect[_0x4fce63(0x232)]===_0x4fce63(0x215))_0x13597f=Reflect[_0x4fce63(0x232)](_0x3b3c57,_0x5b1f1a,_0x3cff4b,_0x2257f1);else{for(var _0x556af0=_0x3b3c57[_0x4fce63(0x22f)]-0x1;_0x556af0>=0x0;_0x556af0--)if(_0x22077b=_0x3b3c57[_0x556af0])_0x13597f=(_0x518fc3<0x3?_0x22077b(_0x13597f):_0x518fc3>0x3?_0x22077b(_0x5b1f1a,_0x3cff4b,_0x13597f):_0x22077b(_0x5b1f1a,_0x3cff4b))||_0x13597f;}return _0x518fc3>0x3&&_0x13597f&&Object[_0x4fce63(0x21a)](_0x5b1f1a,_0x3cff4b,_0x13597f),_0x13597f;},__metadata=this&&this[a386_0x58f347(0x1f2)]||function(_0x43848f,_0x1a5d3d){const _0x1f4613=a386_0x58f347;if(typeof Reflect===_0x1f4613(0x212)&&typeof Reflect[_0x1f4613(0x218)]===_0x1f4613(0x215))return Reflect['metadata'](_0x43848f,_0x1a5d3d);},__param=this&&this['__param']||function(_0x43cc23,_0x4b63ab){return function(_0x26368f,_0x39ca96){_0x4b63ab(_0x26368f,_0x39ca96,_0x43cc23);};},__importDefault=this&&this[a386_0x58f347(0x203)]||function(_0x1448db){const _0x5cb8f5=a386_0x58f347;return _0x1448db&&_0x1448db[_0x5cb8f5(0x214)]?_0x1448db:{'default':_0x1448db};};Object[a386_0x58f347(0x21a)](exports,'__esModule',{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require(a386_0x58f347(0x20a)),dependency_service_1=require('./services/dependency.service'),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a386_0x58f347(0x1fc)),veeva_request_utils_1=require(a386_0x58f347(0x224)),status_enums_1=require(a386_0x58f347(0x1f0)),shortid_1=__importDefault(require(a386_0x58f347(0x20c))),fs_util_1=require(a386_0x58f347(0x225)),logger_1=require(a386_0x58f347(0x1f1)),promises_1=require(a386_0x58f347(0x1fa)),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require(a386_0x58f347(0x1ff)),veeva_auth_1=require(a386_0x58f347(0x1f5)),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require(a386_0x58f347(0x228)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;function a386_0x4561(_0x4df2f8,_0x2061c0){const _0xed3fce=a386_0x2c94();return a386_0x4561=function(_0x2e1105,_0xfc8745){_0x2e1105=_0x2e1105-0x1ef;let _0x2c944c=_0xed3fce[_0x2e1105];return _0x2c944c;},a386_0x4561(_0x4df2f8,_0x2061c0);}let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x501729){const _0x1460ff=a386_0x58f347,{veevaAuth:_0x540ea6,timeZone:_0x656656,attachmentLogId:_0x4ecb88}=_0x501729;try{const _0x3170aa=(0x0,veeva_request_utils_1[_0x1460ff(0x1f6)])(new veeva_auth_1[(_0x1460ff(0x205))](_0x540ea6,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x29928c=await salesforce_auth_1['SalesforceAuth'][_0x1460ff(0x21c)](),_0x4c7919=(0x0,salesforce_request_utils_1[_0x1460ff(0x220)])(new salesforce_auth_1['SalesforceAuth'](_0x29928c)),_0x17c4dc=new logger_1[(_0x1460ff(0x1ef))](_0x4c7919,_0x656656,_0x4ecb88),_0x5df84b=new snapshot_service_1[(_0x1460ff(0x22d))](_0x501729,_0x4c7919,_0x3170aa,_0x17c4dc);return _0x5df84b['execute']()[_0x1460ff(0x216)](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x1460ff(0x219)]};}catch(_0x4891c1){return{'responseStatus':status_enums_1[_0x1460ff(0x231)][_0x1460ff(0x210)],'responseMessage':_0x4891c1[_0x1460ff(0x223)]};}}async[a386_0x58f347(0x22c)](_0x262006){const _0x1ca7c1=a386_0x58f347,{veevaAuth:_0x5032ab,timeZone:_0x33eec8,attachmentLogId:_0x3065f7}=_0x262006;try{const _0x19dc9c=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1['VeevaAuth'](_0x5032ab,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2950dc=await salesforce_auth_1[_0x1ca7c1(0x202)][_0x1ca7c1(0x21c)](),_0x50d6e6=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x1ca7c1(0x202))](_0x2950dc)),_0x2e2570=new logger_1['Logger'](_0x50d6e6,_0x33eec8,_0x3065f7),_0x1cd09d='temp/veeva/deploy_'+(0x0,shortid_1[_0x1ca7c1(0x20b)])();await(0x0,fs_util_1[_0x1ca7c1(0x1f3)])(_0x1cd09d);const _0x5b57f2=new deploy_service_1['DeployService'](_0x262006,_0x50d6e6,_0x19dc9c,_0x2e2570,_0x1cd09d,_0x2950dc['instanceUrl']);return _0x5b57f2[_0x1ca7c1(0x200)]()[_0x1ca7c1(0x20f)](()=>(0x0,promises_1['rm'])(_0x1cd09d,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x1ca7c1(0x231)][_0x1ca7c1(0x219)]};}catch(_0x35e74f){return{'responseStatus':status_enums_1[_0x1ca7c1(0x231)]['FAILURE'],'responseMessage':_0x35e74f[_0x1ca7c1(0x223)]};}}async[a386_0x58f347(0x213)](_0x503923){const _0xe309c6=a386_0x58f347,{veevaAuth:_0x25dcdb}=_0x503923;try{const _0x5768a7=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0xe309c6(0x205))](_0x25dcdb)),_0x566c37=await salesforce_auth_1['SalesforceAuth'][_0xe309c6(0x21c)](),_0xeb820e=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0xe309c6(0x202))](_0x566c37)),_0x440218=new dependency_service_1[(_0xe309c6(0x207))](_0x503923,_0xeb820e,_0x5768a7);return await _0x440218[_0xe309c6(0x200)]();}catch(_0x4d9436){const _0x1b3312=_0x4d9436 instanceof base_veeva_error_1[_0xe309c6(0x1fe)]?_0x4d9436['getMessages']()[_0xe309c6(0x226)]('\x0a'):_0x4d9436['message'];return{'responseStatus':status_enums_1['AppResponseStatus'][_0xe309c6(0x210)],'responseMessage':_0x1b3312};}}async['rollback'](_0x2809c9){const _0x2a99f8=a386_0x58f347,{veevaAuth:_0x2ced3c,timeZone:_0x3cf0e6,attachmentLogId:_0x457b33}=_0x2809c9;try{const _0x28ae00=(0x0,veeva_request_utils_1[_0x2a99f8(0x1f6)])(new veeva_auth_1[(_0x2a99f8(0x205))](_0x2ced3c,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x298144=await salesforce_auth_1[_0x2a99f8(0x202)][_0x2a99f8(0x21c)](),_0x2b983d=(0x0,salesforce_request_utils_1[_0x2a99f8(0x220)])(new salesforce_auth_1[(_0x2a99f8(0x202))](_0x298144)),_0x227c9a=new logger_1[(_0x2a99f8(0x1ef))](_0x2b983d,_0x3cf0e6,_0x457b33),_0x1c6e0b='temp/veeva/rollback_'+(0x0,shortid_1[_0x2a99f8(0x20b)])();await(0x0,fs_util_1[_0x2a99f8(0x1f3)])(_0x1c6e0b);const _0x4edaef=new rollback_service_1[(_0x2a99f8(0x21e))]({..._0x2809c9,'connectionVeeva':_0x28ae00,'connectionSalesforce':_0x2b983d,'logger':_0x227c9a,'tempFolder':_0x1c6e0b,'instanceUrl':_0x298144[_0x2a99f8(0x201)]});return _0x4edaef['execute']()['finally'](()=>(0x0,promises_1['rm'])(_0x1c6e0b,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x2a99f8(0x231)]['SUCCESS']};}catch(_0xd58fc2){return{'responseStatus':status_enums_1[_0x2a99f8(0x231)][_0x2a99f8(0x210)],'responseMessage':_0xd58fc2[_0x2a99f8(0x223)]};}}};__decorate([(0x0,core_1[a386_0x58f347(0x208)])(a386_0x58f347(0x22a)),__param(0x0,core_1[a386_0x58f347(0x20e)][a386_0x58f347(0x22e)]()),__metadata(a386_0x58f347(0x217),Function),__metadata(a386_0x58f347(0x206),[Object]),__metadata(a386_0x58f347(0x21d),Promise)],VeevaVaultController['prototype'],a386_0x58f347(0x1fb),null),__decorate([(0x0,core_1['Post'])(a386_0x58f347(0x221)),__param(0x0,core_1[a386_0x58f347(0x20e)][a386_0x58f347(0x22e)]()),__metadata(a386_0x58f347(0x217),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a386_0x58f347(0x22b)],a386_0x58f347(0x22c),null),__decorate([(0x0,core_1[a386_0x58f347(0x208)])('dependency'),__param(0x0,core_1[a386_0x58f347(0x20e)][a386_0x58f347(0x22e)]()),__metadata(a386_0x58f347(0x217),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a386_0x58f347(0x213),null),__decorate([(0x0,core_1['Post'])(a386_0x58f347(0x1f9)),__param(0x0,core_1[a386_0x58f347(0x20e)]['body']()),__metadata('design:type',Function),__metadata(a386_0x58f347(0x206),[Object]),__metadata(a386_0x58f347(0x21d),Promise)],VeevaVaultController[a386_0x58f347(0x22b)],a386_0x58f347(0x1f9),null),VeevaVaultController=__decorate([(0x0,core_1['Controller'])(a386_0x58f347(0x209)),(0x0,core_1['Version'])('v1.1')],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;