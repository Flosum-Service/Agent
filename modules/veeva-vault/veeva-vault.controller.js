const a371_0xe65f75=a371_0x36a9;(function(_0x555d2c,_0x3ce1b){const _0x11921c=a371_0x36a9,_0x4c3991=_0x555d2c();while(!![]){try{const _0x55a4be=-parseInt(_0x11921c(0x16b))/0x1+parseInt(_0x11921c(0x180))/0x2*(parseInt(_0x11921c(0x1a4))/0x3)+-parseInt(_0x11921c(0x17b))/0x4*(parseInt(_0x11921c(0x185))/0x5)+parseInt(_0x11921c(0x191))/0x6+-parseInt(_0x11921c(0x18e))/0x7*(parseInt(_0x11921c(0x169))/0x8)+parseInt(_0x11921c(0x197))/0x9*(-parseInt(_0x11921c(0x173))/0xa)+parseInt(_0x11921c(0x195))/0xb;if(_0x55a4be===_0x3ce1b)break;else _0x4c3991['push'](_0x4c3991['shift']());}catch(_0x3bb232){_0x4c3991['push'](_0x4c3991['shift']());}}}(a371_0x5597,0x4d282));function a371_0x36a9(_0x3382a0,_0x23a094){const _0xea5b=a371_0x5597();return a371_0x36a9=function(_0x5a7ca2,_0xcff5ff){_0x5a7ca2=_0x5a7ca2-0x15e;let _0x55970b=_0xea5b[_0x5a7ca2];return _0x55970b;},a371_0x36a9(_0x3382a0,_0x23a094);}const a371_0xcff5ff=(function(){let _0xd1051=!![];return function(_0x575f0c,_0x3b49e5){const _0xe55717=_0xd1051?function(){if(_0x3b49e5){const _0x5ab384=_0x3b49e5['apply'](_0x575f0c,arguments);return _0x3b49e5=null,_0x5ab384;}}:function(){};return _0xd1051=![],_0xe55717;};}()),a371_0x5a7ca2=a371_0xcff5ff(this,function(){const _0x17e96a=a371_0x36a9;return a371_0x5a7ca2[_0x17e96a(0x182)]()[_0x17e96a(0x1a6)](_0x17e96a(0x15e))[_0x17e96a(0x182)]()[_0x17e96a(0x1a0)](a371_0x5a7ca2)[_0x17e96a(0x1a6)](_0x17e96a(0x15e));});a371_0x5a7ca2();'use strict';var __decorate=this&&this[a371_0xe65f75(0x1a8)]||function(_0x528355,_0x5bfca0,_0x38b0a3,_0xf8cfc5){const _0x34144d=a371_0xe65f75;var _0x59a22f=arguments[_0x34144d(0x1a2)],_0x481e83=_0x59a22f<0x3?_0x5bfca0:_0xf8cfc5===null?_0xf8cfc5=Object[_0x34144d(0x162)](_0x5bfca0,_0x38b0a3):_0xf8cfc5,_0x1ed6f9;if(typeof Reflect===_0x34144d(0x19f)&&typeof Reflect['decorate']==='function')_0x481e83=Reflect[_0x34144d(0x1ac)](_0x528355,_0x5bfca0,_0x38b0a3,_0xf8cfc5);else{for(var _0x49691d=_0x528355[_0x34144d(0x1a2)]-0x1;_0x49691d>=0x0;_0x49691d--)if(_0x1ed6f9=_0x528355[_0x49691d])_0x481e83=(_0x59a22f<0x3?_0x1ed6f9(_0x481e83):_0x59a22f>0x3?_0x1ed6f9(_0x5bfca0,_0x38b0a3,_0x481e83):_0x1ed6f9(_0x5bfca0,_0x38b0a3))||_0x481e83;}return _0x59a22f>0x3&&_0x481e83&&Object[_0x34144d(0x18c)](_0x5bfca0,_0x38b0a3,_0x481e83),_0x481e83;},__metadata=this&&this[a371_0xe65f75(0x18d)]||function(_0x44b2ab,_0x53ced5){const _0x5caeae=a371_0xe65f75;if(typeof Reflect===_0x5caeae(0x19f)&&typeof Reflect[_0x5caeae(0x170)]===_0x5caeae(0x164))return Reflect['metadata'](_0x44b2ab,_0x53ced5);},__param=this&&this['__param']||function(_0x8acea3,_0xc5dfb9){return function(_0x571b68,_0x396053){_0xc5dfb9(_0x571b68,_0x396053,_0x8acea3);};},__importDefault=this&&this[a371_0xe65f75(0x15f)]||function(_0x158548){const _0x4c0a10=a371_0xe65f75;return _0x158548&&_0x158548[_0x4c0a10(0x175)]?_0x158548:{'default':_0x158548};};Object[a371_0xe65f75(0x18c)](exports,a371_0xe65f75(0x175),{'value':!![]}),exports[a371_0xe65f75(0x171)]=void 0x0;const core_1=require(a371_0xe65f75(0x17c)),dependency_service_1=require(a371_0xe65f75(0x192)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a371_0xe65f75(0x16e)),veeva_request_utils_1=require(a371_0xe65f75(0x18b)),status_enums_1=require(a371_0xe65f75(0x19c)),shortid_1=__importDefault(require('shortid')),fs_util_1=require(a371_0xe65f75(0x194)),logger_1=require(a371_0xe65f75(0x19b)),promises_1=require('fs/promises'),base_veeva_error_1=require(a371_0xe65f75(0x172)),salesforce_request_utils_1=require(a371_0xe65f75(0x188)),veeva_auth_1=require(a371_0xe65f75(0x18f)),salesforce_auth_1=require(a371_0xe65f75(0x19a)),rollback_service_1=require(a371_0xe65f75(0x163)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;function a371_0x5597(){const _0x3c7518=['rollback','length','SalesforceAuth','69Jlsrxn','getMessages','search','deploy','__decorate','createVeevaRequest','message','default','decorate','(((.+)+)+)+$','__importDefault','SUCCESS','DependencyService','getOwnPropertyDescriptor','./services/rollback.service','function','Logger','VeevaAuth','dependency','deployFromBranch','24BPRtgt','finally','371105hjziEL','RollbackService','temp/veeva/deploy_','./services/deploy.service','Version','metadata','VeevaVaultController','./classes/errors/base-veeva-error','120yCSYfs','veeva-vault','__esModule','AppResponseStatus','prototype','param','execute','design:returntype','2240468NuyTfD','../../core','SnapshotService','design:type','createSalesforceRequest','35766ihbuJt','body','toString','Controller','then','5rGAbAi','FAILURE','instanceUrl','./utils/salesforce-request.utils','retrieveDependency','makeDir','./utils/veeva-request.utils','defineProperty','__metadata','169267grQhip','./classes/auth/veeva-auth','temp/veeva/rollback_','722322ExDZpa','./services/dependency.service','doSnapshot','./utils/fs-util','14082981XQoANc','DeployService','369126EutRXn','getAuthDetails','join','./classes/auth/salesforce-auth','./classes/loggers/logger','./enums/status.enums','Post','design:paramtypes','object','constructor'];a371_0x5597=function(){return _0x3c7518;};return a371_0x5597();}let VeevaVaultController=class VeevaVaultController{async[a371_0xe65f75(0x193)](_0x195702){const _0x52ee4e=a371_0xe65f75,{veevaAuth:_0x47f53f,timeZone:_0x3b1007,attachmentLogId:_0x1656ef}=_0x195702;try{const _0x2bd3e7=(0x0,veeva_request_utils_1[_0x52ee4e(0x1a9)])(new veeva_auth_1['VeevaAuth'](_0x47f53f,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x380008=await salesforce_auth_1[_0x52ee4e(0x1a3)][_0x52ee4e(0x198)](),_0x102df4=(0x0,salesforce_request_utils_1[_0x52ee4e(0x17f)])(new salesforce_auth_1['SalesforceAuth'](_0x380008)),_0x2ff08e=new logger_1[(_0x52ee4e(0x165))](_0x102df4,_0x3b1007,_0x1656ef),_0x4fca5d=new snapshot_service_1[(_0x52ee4e(0x17d))](_0x195702,_0x102df4,_0x2bd3e7,_0x2ff08e);return _0x4fca5d[_0x52ee4e(0x179)]()[_0x52ee4e(0x184)](),{'responseStatus':status_enums_1[_0x52ee4e(0x176)]['SUCCESS']};}catch(_0x57f18a){return{'responseStatus':status_enums_1[_0x52ee4e(0x176)][_0x52ee4e(0x186)],'responseMessage':_0x57f18a[_0x52ee4e(0x1aa)]};}}async[a371_0xe65f75(0x168)](_0x52d1a3){const _0x2b35bc=a371_0xe65f75,{veevaAuth:_0x2233db,timeZone:_0x155981,attachmentLogId:_0x2bbd39}=_0x52d1a3;try{const _0x2e1d67=(0x0,veeva_request_utils_1[_0x2b35bc(0x1a9)])(new veeva_auth_1[(_0x2b35bc(0x166))](_0x2233db,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1bc80d=await salesforce_auth_1[_0x2b35bc(0x1a3)][_0x2b35bc(0x198)](),_0xfe8378=(0x0,salesforce_request_utils_1[_0x2b35bc(0x17f)])(new salesforce_auth_1[(_0x2b35bc(0x1a3))](_0x1bc80d)),_0x250359=new logger_1[(_0x2b35bc(0x165))](_0xfe8378,_0x155981,_0x2bbd39),_0x3fe971=_0x2b35bc(0x16d)+(0x0,shortid_1[_0x2b35bc(0x1ab)])();await(0x0,fs_util_1[_0x2b35bc(0x18a)])(_0x3fe971);const _0x129950=new deploy_service_1[(_0x2b35bc(0x196))](_0x52d1a3,_0xfe8378,_0x2e1d67,_0x250359,_0x3fe971,_0x1bc80d[_0x2b35bc(0x187)]);return _0x129950['execute']()['finally'](()=>(0x0,promises_1['rm'])(_0x3fe971,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x2b35bc(0x176)]['SUCCESS']};}catch(_0x5b9960){return{'responseStatus':status_enums_1[_0x2b35bc(0x176)]['FAILURE'],'responseMessage':_0x5b9960[_0x2b35bc(0x1aa)]};}}async[a371_0xe65f75(0x189)](_0xe0d21f){const _0x4d25b9=a371_0xe65f75,{veevaAuth:_0x54e47d}=_0xe0d21f;try{const _0x17162d=(0x0,veeva_request_utils_1[_0x4d25b9(0x1a9)])(new veeva_auth_1[(_0x4d25b9(0x166))](_0x54e47d)),_0x4c8681=await salesforce_auth_1[_0x4d25b9(0x1a3)][_0x4d25b9(0x198)](),_0x5183b0=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0x4c8681)),_0x150737=new dependency_service_1[(_0x4d25b9(0x161))](_0xe0d21f,_0x5183b0,_0x17162d);return await _0x150737[_0x4d25b9(0x179)]();}catch(_0x1a4465){const _0x396d74=_0x1a4465 instanceof base_veeva_error_1['BaseVeevaError']?_0x1a4465[_0x4d25b9(0x1a5)]()[_0x4d25b9(0x199)]('\x0a'):_0x1a4465[_0x4d25b9(0x1aa)];return{'responseStatus':status_enums_1[_0x4d25b9(0x176)][_0x4d25b9(0x186)],'responseMessage':_0x396d74};}}async[a371_0xe65f75(0x1a1)](_0x482aaa){const _0x43d333=a371_0xe65f75,{veevaAuth:_0x18df9d,timeZone:_0x32208c,attachmentLogId:_0xe8fc7a}=_0x482aaa;try{const _0x38f70a=(0x0,veeva_request_utils_1[_0x43d333(0x1a9)])(new veeva_auth_1[(_0x43d333(0x166))](_0x18df9d,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x18904e=await salesforce_auth_1['SalesforceAuth'][_0x43d333(0x198)](),_0x59d6e1=(0x0,salesforce_request_utils_1[_0x43d333(0x17f)])(new salesforce_auth_1[(_0x43d333(0x1a3))](_0x18904e)),_0x69a106=new logger_1[(_0x43d333(0x165))](_0x59d6e1,_0x32208c,_0xe8fc7a),_0x1bb335=_0x43d333(0x190)+(0x0,shortid_1[_0x43d333(0x1ab)])();await(0x0,fs_util_1['makeDir'])(_0x1bb335);const _0x27350b=new rollback_service_1[(_0x43d333(0x16c))]({..._0x482aaa,'connectionVeeva':_0x38f70a,'connectionSalesforce':_0x59d6e1,'logger':_0x69a106,'tempFolder':_0x1bb335,'instanceUrl':_0x18904e[_0x43d333(0x187)]});return _0x27350b[_0x43d333(0x179)]()[_0x43d333(0x16a)](()=>(0x0,promises_1['rm'])(_0x1bb335,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x43d333(0x160)]};}catch(_0x318449){return{'responseStatus':status_enums_1[_0x43d333(0x176)][_0x43d333(0x186)],'responseMessage':_0x318449[_0x43d333(0x1aa)]};}}};__decorate([(0x0,core_1[a371_0xe65f75(0x19d)])('snapshot'),__param(0x0,core_1[a371_0xe65f75(0x178)][a371_0xe65f75(0x181)]()),__metadata(a371_0xe65f75(0x17e),Function),__metadata('design:paramtypes',[Object]),__metadata(a371_0xe65f75(0x17a),Promise)],VeevaVaultController[a371_0xe65f75(0x177)],'doSnapshot',null),__decorate([(0x0,core_1[a371_0xe65f75(0x19d)])(a371_0xe65f75(0x1a7)),__param(0x0,core_1[a371_0xe65f75(0x178)]['body']()),__metadata(a371_0xe65f75(0x17e),Function),__metadata(a371_0xe65f75(0x19e),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a371_0xe65f75(0x168),null),__decorate([(0x0,core_1['Post'])(a371_0xe65f75(0x167)),__param(0x0,core_1['param'][a371_0xe65f75(0x181)]()),__metadata('design:type',Function),__metadata(a371_0xe65f75(0x19e),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0xe65f75(0x177)],a371_0xe65f75(0x189),null),__decorate([(0x0,core_1[a371_0xe65f75(0x19d)])(a371_0xe65f75(0x1a1)),__param(0x0,core_1[a371_0xe65f75(0x178)][a371_0xe65f75(0x181)]()),__metadata(a371_0xe65f75(0x17e),Function),__metadata('design:paramtypes',[Object]),__metadata(a371_0xe65f75(0x17a),Promise)],VeevaVaultController[a371_0xe65f75(0x177)],a371_0xe65f75(0x1a1),null),VeevaVaultController=__decorate([(0x0,core_1[a371_0xe65f75(0x183)])(a371_0xe65f75(0x174)),(0x0,core_1[a371_0xe65f75(0x16f)])('v1.1')],VeevaVaultController),exports[a371_0xe65f75(0x171)]=VeevaVaultController;