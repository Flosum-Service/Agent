const a387_0x591c95=a387_0x5e15;function a387_0x5e15(_0x2bae4c,_0x59b730){const _0x197abc=a387_0x7b26();return a387_0x5e15=function(_0x2d70b5,_0x6ba9b2){_0x2d70b5=_0x2d70b5-0x1f1;let _0x7b2692=_0x197abc[_0x2d70b5];return _0x7b2692;},a387_0x5e15(_0x2bae4c,_0x59b730);}(function(_0x4c9ad0,_0x22e6dc){const _0x20f0b0=a387_0x5e15,_0x580919=_0x4c9ad0();while(!![]){try{const _0x3301be=parseInt(_0x20f0b0(0x1fd))/0x1*(-parseInt(_0x20f0b0(0x233))/0x2)+parseInt(_0x20f0b0(0x1f5))/0x3+-parseInt(_0x20f0b0(0x221))/0x4+-parseInt(_0x20f0b0(0x207))/0x5+-parseInt(_0x20f0b0(0x215))/0x6*(-parseInt(_0x20f0b0(0x22e))/0x7)+-parseInt(_0x20f0b0(0x23b))/0x8*(parseInt(_0x20f0b0(0x227))/0x9)+parseInt(_0x20f0b0(0x223))/0xa*(parseInt(_0x20f0b0(0x21f))/0xb);if(_0x3301be===_0x22e6dc)break;else _0x580919['push'](_0x580919['shift']());}catch(_0x59b865){_0x580919['push'](_0x580919['shift']());}}}(a387_0x7b26,0xeea6d));const a387_0x6ba9b2=(function(){let _0x2bf601=!![];return function(_0x443135,_0x17d2e7){const _0x183154=_0x2bf601?function(){const _0x27ff84=a387_0x5e15;if(_0x17d2e7){const _0x5aa9bc=_0x17d2e7[_0x27ff84(0x208)](_0x443135,arguments);return _0x17d2e7=null,_0x5aa9bc;}}:function(){};return _0x2bf601=![],_0x183154;};}()),a387_0x2d70b5=a387_0x6ba9b2(this,function(){const _0x365884=a387_0x5e15;return a387_0x2d70b5[_0x365884(0x209)]()['search'](_0x365884(0x1fb))[_0x365884(0x209)]()[_0x365884(0x22f)](a387_0x2d70b5)['search'](_0x365884(0x1fb));});a387_0x2d70b5();'use strict';var __decorate=this&&this[a387_0x591c95(0x202)]||function(_0x19f515,_0x46f215,_0x19f3fe,_0x10b1d5){const _0x424f3b=a387_0x591c95;var _0x5d08a5=arguments['length'],_0x534684=_0x5d08a5<0x3?_0x46f215:_0x10b1d5===null?_0x10b1d5=Object[_0x424f3b(0x1f3)](_0x46f215,_0x19f3fe):_0x10b1d5,_0x3b65dc;if(typeof Reflect==='object'&&typeof Reflect[_0x424f3b(0x1f1)]===_0x424f3b(0x224))_0x534684=Reflect[_0x424f3b(0x1f1)](_0x19f515,_0x46f215,_0x19f3fe,_0x10b1d5);else{for(var _0x310881=_0x19f515[_0x424f3b(0x1f6)]-0x1;_0x310881>=0x0;_0x310881--)if(_0x3b65dc=_0x19f515[_0x310881])_0x534684=(_0x5d08a5<0x3?_0x3b65dc(_0x534684):_0x5d08a5>0x3?_0x3b65dc(_0x46f215,_0x19f3fe,_0x534684):_0x3b65dc(_0x46f215,_0x19f3fe))||_0x534684;}return _0x5d08a5>0x3&&_0x534684&&Object[_0x424f3b(0x210)](_0x46f215,_0x19f3fe,_0x534684),_0x534684;},__metadata=this&&this['__metadata']||function(_0x4afb2b,_0x5b2f3d){const _0x5d2c45=a387_0x591c95;if(typeof Reflect===_0x5d2c45(0x20d)&&typeof Reflect[_0x5d2c45(0x206)]==='function')return Reflect[_0x5d2c45(0x206)](_0x4afb2b,_0x5b2f3d);},__param=this&&this[a387_0x591c95(0x1fe)]||function(_0x493055,_0x1fe859){return function(_0x25eead,_0x46c1de){_0x1fe859(_0x25eead,_0x46c1de,_0x493055);};},__importDefault=this&&this['__importDefault']||function(_0x53397c){const _0x2c40d0=a387_0x591c95;return _0x53397c&&_0x53397c[_0x2c40d0(0x219)]?_0x53397c:{'default':_0x53397c};};function a387_0x7b26(){const _0x4c271d=['Controller','param','finally','design:type','(((.+)+)+)+$','design:returntype','1vVFzSl','__param','doSnapshot','./services/dependency.service','createSalesforceRequest','__decorate','AppResponseStatus','retrieveDependency','instanceUrl','metadata','657560MTstph','apply','toString','join','deploy','dependency','object','VeevaVaultController','getAuthDetails','defineProperty','FAILURE','SUCCESS','Logger','./utils/veeva-request.utils','42GHPOSy','default','temp/veeva/rollback_','./classes/auth/veeva-auth','__esModule','RollbackService','SnapshotService','then','design:paramtypes','execute','26176359ULQHBS','DependencyService','6974212tlJaON','veeva-vault','20IHmvVr','function','DeployService','createVeevaRequest','18rMrbDZ','./services/rollback.service','./enums/status.enums','BaseVeevaError','VeevaAuth','SalesforceAuth','getMessages','266fnNZzY','constructor','Post','makeDir','./services/deploy.service','2436322pjDidG','./classes/loggers/logger','deployFromBranch','./classes/errors/base-veeva-error','v1.1','body','rollback','message','4686112MgRVIV','decorate','../../core','getOwnPropertyDescriptor','prototype','1448001Tflyrt','length'];a387_0x7b26=function(){return _0x4c271d;};return a387_0x7b26();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a387_0x591c95(0x20e)]=void 0x0;const core_1=require(a387_0x591c95(0x1f2)),dependency_service_1=require(a387_0x591c95(0x200)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require(a387_0x591c95(0x232)),veeva_request_utils_1=require(a387_0x591c95(0x214)),status_enums_1=require(a387_0x591c95(0x229)),shortid_1=__importDefault(require('shortid')),fs_util_1=require('./utils/fs-util'),logger_1=require(a387_0x591c95(0x234)),promises_1=require('fs/promises'),base_veeva_error_1=require(a387_0x591c95(0x236)),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require(a387_0x591c95(0x218)),salesforce_auth_1=require('./classes/auth/salesforce-auth'),rollback_service_1=require(a387_0x591c95(0x228)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x55312f){const _0x365a31=a387_0x591c95,{veevaAuth:_0x46c8b1,timeZone:_0x195366,attachmentLogId:_0x3cfb9e}=_0x55312f;try{const _0x2510e3=(0x0,veeva_request_utils_1[_0x365a31(0x226)])(new veeva_auth_1[(_0x365a31(0x22b))](_0x46c8b1,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2f196d=await salesforce_auth_1['SalesforceAuth'][_0x365a31(0x20f)](),_0x234bc4=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x365a31(0x22c))](_0x2f196d)),_0x56eb6b=new logger_1[(_0x365a31(0x213))](_0x234bc4,_0x195366,_0x3cfb9e),_0x230f32=new snapshot_service_1[(_0x365a31(0x21b))](_0x55312f,_0x234bc4,_0x2510e3,_0x56eb6b);return _0x230f32[_0x365a31(0x21e)]()[_0x365a31(0x21c)](),{'responseStatus':status_enums_1[_0x365a31(0x203)][_0x365a31(0x212)]};}catch(_0x56d9e5){return{'responseStatus':status_enums_1[_0x365a31(0x203)][_0x365a31(0x211)],'responseMessage':_0x56d9e5['message']};}}async['deployFromBranch'](_0x7bf6e){const _0x2b6991=a387_0x591c95,{veevaAuth:_0x761288,timeZone:_0x4d6845,attachmentLogId:_0x151a18}=_0x7bf6e;try{const _0x10e2cf=(0x0,veeva_request_utils_1[_0x2b6991(0x226)])(new veeva_auth_1[(_0x2b6991(0x22b))](_0x761288,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x4e996a=await salesforce_auth_1['SalesforceAuth'][_0x2b6991(0x20f)](),_0x417716=(0x0,salesforce_request_utils_1[_0x2b6991(0x201)])(new salesforce_auth_1['SalesforceAuth'](_0x4e996a)),_0x2f6576=new logger_1[(_0x2b6991(0x213))](_0x417716,_0x4d6845,_0x151a18),_0x1b56cb='temp/veeva/deploy_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x2b6991(0x231)])(_0x1b56cb);const _0x5b3486=new deploy_service_1[(_0x2b6991(0x225))](_0x7bf6e,_0x417716,_0x10e2cf,_0x2f6576,_0x1b56cb,_0x4e996a[_0x2b6991(0x205)]);return _0x5b3486[_0x2b6991(0x21e)]()[_0x2b6991(0x1f9)](()=>(0x0,promises_1['rm'])(_0x1b56cb,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x2b6991(0x203)]['SUCCESS']};}catch(_0x3fd1ff){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x2b6991(0x211)],'responseMessage':_0x3fd1ff['message']};}}async[a387_0x591c95(0x204)](_0x324c6f){const _0x49a131=a387_0x591c95,{veevaAuth:_0x220d2f}=_0x324c6f;try{const _0x52d816=(0x0,veeva_request_utils_1[_0x49a131(0x226)])(new veeva_auth_1[(_0x49a131(0x22b))](_0x220d2f)),_0x1e0844=await salesforce_auth_1['SalesforceAuth']['getAuthDetails'](),_0x106ac9=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x49a131(0x22c))](_0x1e0844)),_0x58a1ad=new dependency_service_1[(_0x49a131(0x220))](_0x324c6f,_0x106ac9,_0x52d816);return await _0x58a1ad[_0x49a131(0x21e)]();}catch(_0x256b94){const _0x4f68cd=_0x256b94 instanceof base_veeva_error_1[_0x49a131(0x22a)]?_0x256b94[_0x49a131(0x22d)]()[_0x49a131(0x20a)]('\x0a'):_0x256b94[_0x49a131(0x23a)];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x49a131(0x211)],'responseMessage':_0x4f68cd};}}async[a387_0x591c95(0x239)](_0x3175d3){const _0x108f46=a387_0x591c95,{veevaAuth:_0x595820,timeZone:_0x4e5e04,attachmentLogId:_0x6a7358}=_0x3175d3;try{const _0x4d98ab=(0x0,veeva_request_utils_1[_0x108f46(0x226)])(new veeva_auth_1[(_0x108f46(0x22b))](_0x595820,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5c29bf=await salesforce_auth_1[_0x108f46(0x22c)][_0x108f46(0x20f)](),_0x1e6a0b=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x108f46(0x22c))](_0x5c29bf)),_0x58875c=new logger_1[(_0x108f46(0x213))](_0x1e6a0b,_0x4e5e04,_0x6a7358),_0x1078f8=_0x108f46(0x217)+(0x0,shortid_1[_0x108f46(0x216)])();await(0x0,fs_util_1[_0x108f46(0x231)])(_0x1078f8);const _0x4d0377=new rollback_service_1[(_0x108f46(0x21a))]({..._0x3175d3,'connectionVeeva':_0x4d98ab,'connectionSalesforce':_0x1e6a0b,'logger':_0x58875c,'tempFolder':_0x1078f8,'instanceUrl':_0x5c29bf[_0x108f46(0x205)]});return _0x4d0377['execute']()[_0x108f46(0x1f9)](()=>(0x0,promises_1['rm'])(_0x1078f8,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x108f46(0x203)][_0x108f46(0x212)]};}catch(_0x2ef6d8){return{'responseStatus':status_enums_1[_0x108f46(0x203)]['FAILURE'],'responseMessage':_0x2ef6d8[_0x108f46(0x23a)]};}}};__decorate([(0x0,core_1[a387_0x591c95(0x230)])('snapshot'),__param(0x0,core_1['param'][a387_0x591c95(0x238)]()),__metadata('design:type',Function),__metadata(a387_0x591c95(0x21d),[Object]),__metadata(a387_0x591c95(0x1fc),Promise)],VeevaVaultController[a387_0x591c95(0x1f4)],a387_0x591c95(0x1ff),null),__decorate([(0x0,core_1[a387_0x591c95(0x230)])(a387_0x591c95(0x20b)),__param(0x0,core_1['param'][a387_0x591c95(0x238)]()),__metadata(a387_0x591c95(0x1fa),Function),__metadata(a387_0x591c95(0x21d),[Object]),__metadata(a387_0x591c95(0x1fc),Promise)],VeevaVaultController['prototype'],a387_0x591c95(0x235),null),__decorate([(0x0,core_1[a387_0x591c95(0x230)])(a387_0x591c95(0x20c)),__param(0x0,core_1[a387_0x591c95(0x1f8)][a387_0x591c95(0x238)]()),__metadata(a387_0x591c95(0x1fa),Function),__metadata(a387_0x591c95(0x21d),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a387_0x591c95(0x1f4)],'retrieveDependency',null),__decorate([(0x0,core_1[a387_0x591c95(0x230)])(a387_0x591c95(0x239)),__param(0x0,core_1[a387_0x591c95(0x1f8)]['body']()),__metadata(a387_0x591c95(0x1fa),Function),__metadata(a387_0x591c95(0x21d),[Object]),__metadata(a387_0x591c95(0x1fc),Promise)],VeevaVaultController[a387_0x591c95(0x1f4)],a387_0x591c95(0x239),null),VeevaVaultController=__decorate([(0x0,core_1[a387_0x591c95(0x1f7)])(a387_0x591c95(0x222)),(0x0,core_1['Version'])(a387_0x591c95(0x237))],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;