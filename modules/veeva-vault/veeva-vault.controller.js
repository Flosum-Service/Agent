const a415_0x39c310=a415_0x1878;(function(_0x2bcbd0,_0x4ca253){const _0x23ceae=a415_0x1878,_0x483adf=_0x2bcbd0();while(!![]){try{const _0x5872d1=-parseInt(_0x23ceae(0x1b8))/0x1+parseInt(_0x23ceae(0x187))/0x2*(parseInt(_0x23ceae(0x182))/0x3)+parseInt(_0x23ceae(0x194))/0x4*(-parseInt(_0x23ceae(0x1bd))/0x5)+-parseInt(_0x23ceae(0x18b))/0x6+-parseInt(_0x23ceae(0x1b5))/0x7+-parseInt(_0x23ceae(0x176))/0x8+parseInt(_0x23ceae(0x1b7))/0x9;if(_0x5872d1===_0x4ca253)break;else _0x483adf['push'](_0x483adf['shift']());}catch(_0x5166aa){_0x483adf['push'](_0x483adf['shift']());}}}(a415_0x4b60,0x7d54c));const a415_0xfc7697=(function(){let _0x4626bd=!![];return function(_0x316faa,_0x57dbe5){const _0x21c262=_0x4626bd?function(){const _0x112ba1=a415_0x1878;if(_0x57dbe5){const _0x573f51=_0x57dbe5[_0x112ba1(0x19a)](_0x316faa,arguments);return _0x57dbe5=null,_0x573f51;}}:function(){};return _0x4626bd=![],_0x21c262;};}()),a415_0x41796c=a415_0xfc7697(this,function(){const _0x1eb764=a415_0x1878;return a415_0x41796c[_0x1eb764(0x19e)]()[_0x1eb764(0x1ba)](_0x1eb764(0x19f))['toString']()['constructor'](a415_0x41796c)[_0x1eb764(0x1ba)](_0x1eb764(0x19f));});a415_0x41796c();function a415_0x4b60(){const _0x107fd9=['deploy','temp/veeva/rollback_','default','getOwnPropertyDescriptor','FAILURE','DeployService','./classes/errors/base-veeva-error','doSnapshot','body','prototype','function','execute','param','RollbackService','3427382JUQnJQ','rollback','28455885QTrYqK','931720upPXXQ','object','search','decorate','deployFromBranch','5grUefT','__metadata','SalesforceAuth','./services/rollback.service','7589976vfdzLo','length','metadata','Post','DependencyService','design:returntype','shortid','getAuthDetails','./services/dependency.service','message','createSalesforceRequest','VeevaAuth','32496OlATFf','./utils/fs-util','SnapshotService','BaseVeevaError','temp/veeva/deploy_','166PNhATr','createVeevaRequest','finally','./enums/status.enums','5883810zhUtot','makeDir','Logger','veeva-vault','then','__importDefault','instanceUrl','retrieveDependency','AppResponseStatus','786948AVPrNE','__decorate','design:type','join','__esModule','defineProperty','apply','design:paramtypes','Controller','getMessages','toString','(((.+)+)+)+$','VeevaVaultController','dependency','SUCCESS','Version','./services/snapshot.service','snapshot','./classes/auth/salesforce-auth'];a415_0x4b60=function(){return _0x107fd9;};return a415_0x4b60();}'use strict';var __decorate=this&&this[a415_0x39c310(0x195)]||function(_0x3d61cd,_0x2b8452,_0x5dfcee,_0x589a65){const _0x3c5234=a415_0x39c310;var _0x22eb2c=arguments[_0x3c5234(0x177)],_0x460c84=_0x22eb2c<0x3?_0x2b8452:_0x589a65===null?_0x589a65=Object[_0x3c5234(0x1aa)](_0x2b8452,_0x5dfcee):_0x589a65,_0x3bac73;if(typeof Reflect===_0x3c5234(0x1b9)&&typeof Reflect['decorate']===_0x3c5234(0x1b1))_0x460c84=Reflect[_0x3c5234(0x1bb)](_0x3d61cd,_0x2b8452,_0x5dfcee,_0x589a65);else{for(var _0x46224d=_0x3d61cd['length']-0x1;_0x46224d>=0x0;_0x46224d--)if(_0x3bac73=_0x3d61cd[_0x46224d])_0x460c84=(_0x22eb2c<0x3?_0x3bac73(_0x460c84):_0x22eb2c>0x3?_0x3bac73(_0x2b8452,_0x5dfcee,_0x460c84):_0x3bac73(_0x2b8452,_0x5dfcee))||_0x460c84;}return _0x22eb2c>0x3&&_0x460c84&&Object[_0x3c5234(0x199)](_0x2b8452,_0x5dfcee,_0x460c84),_0x460c84;},__metadata=this&&this[a415_0x39c310(0x1be)]||function(_0x1c414c,_0x32bab6){const _0x292d0b=a415_0x39c310;if(typeof Reflect===_0x292d0b(0x1b9)&&typeof Reflect[_0x292d0b(0x178)]===_0x292d0b(0x1b1))return Reflect[_0x292d0b(0x178)](_0x1c414c,_0x32bab6);},__param=this&&this['__param']||function(_0x50d498,_0x454d8a){return function(_0x174abf,_0x44bd91){_0x454d8a(_0x174abf,_0x44bd91,_0x50d498);};},__importDefault=this&&this[a415_0x39c310(0x190)]||function(_0xffdfdf){const _0x35bc9d=a415_0x39c310;return _0xffdfdf&&_0xffdfdf[_0x35bc9d(0x198)]?_0xffdfdf:{'default':_0xffdfdf};};Object[a415_0x39c310(0x199)](exports,a415_0x39c310(0x198),{'value':!![]}),exports[a415_0x39c310(0x1a0)]=void 0x0;const core_1=require('../../core'),dependency_service_1=require(a415_0x39c310(0x17e)),snapshot_service_1=require(a415_0x39c310(0x1a4)),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a415_0x39c310(0x18a)),shortid_1=__importDefault(require(a415_0x39c310(0x17c))),fs_util_1=require(a415_0x39c310(0x183)),logger_1=require('./classes/loggers/logger'),promises_1=require('fs/promises'),base_veeva_error_1=require(a415_0x39c310(0x1ad)),salesforce_request_utils_1=require('./utils/salesforce-request.utils'),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a415_0x39c310(0x1a6)),rollback_service_1=require(a415_0x39c310(0x175)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async['doSnapshot'](_0x274bf7){const _0x582c70=a415_0x39c310,{veevaAuth:_0x561c53,timeZone:_0x29922e,attachmentLogId:_0x554e26}=_0x274bf7;try{const _0x116b99=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x582c70(0x181))](_0x561c53,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x16387c=await salesforce_auth_1[_0x582c70(0x1bf)][_0x582c70(0x17d)](),_0x14364b=(0x0,salesforce_request_utils_1[_0x582c70(0x180)])(new salesforce_auth_1[(_0x582c70(0x1bf))](_0x16387c)),_0x30c0a5=new logger_1['Logger'](_0x14364b,_0x29922e,_0x554e26),_0x1b50aa=new snapshot_service_1[(_0x582c70(0x184))](_0x274bf7,_0x14364b,_0x116b99,_0x30c0a5);return _0x1b50aa['execute']()[_0x582c70(0x18f)](),{'responseStatus':status_enums_1[_0x582c70(0x193)]['SUCCESS']};}catch(_0x92476d){return{'responseStatus':status_enums_1[_0x582c70(0x193)][_0x582c70(0x1ab)],'responseMessage':_0x92476d[_0x582c70(0x17f)]};}}async[a415_0x39c310(0x1bc)](_0x3ee8b1){const _0x3cb59e=a415_0x39c310,{veevaAuth:_0x188968,timeZone:_0x481811,attachmentLogId:_0x2b6a3a}=_0x3ee8b1;try{const _0x1e2fba=(0x0,veeva_request_utils_1[_0x3cb59e(0x188)])(new veeva_auth_1[(_0x3cb59e(0x181))](_0x188968,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x70a2a=await salesforce_auth_1[_0x3cb59e(0x1bf)][_0x3cb59e(0x17d)](),_0x1f4fbc=(0x0,salesforce_request_utils_1[_0x3cb59e(0x180)])(new salesforce_auth_1[(_0x3cb59e(0x1bf))](_0x70a2a)),_0x7dab7c=new logger_1[(_0x3cb59e(0x18d))](_0x1f4fbc,_0x481811,_0x2b6a3a),_0x39f564=_0x3cb59e(0x186)+(0x0,shortid_1[_0x3cb59e(0x1a9)])();await(0x0,fs_util_1[_0x3cb59e(0x18c)])(_0x39f564);const _0x179995=new deploy_service_1[(_0x3cb59e(0x1ac))](_0x3ee8b1,_0x1f4fbc,_0x1e2fba,_0x7dab7c,_0x39f564,_0x70a2a[_0x3cb59e(0x191)]);return _0x179995[_0x3cb59e(0x1b2)]()['finally'](()=>(0x0,promises_1['rm'])(_0x39f564,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x3cb59e(0x193)][_0x3cb59e(0x1a2)]};}catch(_0x20ca07){return{'responseStatus':status_enums_1[_0x3cb59e(0x193)][_0x3cb59e(0x1ab)],'responseMessage':_0x20ca07['message']};}}async[a415_0x39c310(0x192)](_0x160bbc){const _0x2c00ae=a415_0x39c310,{veevaAuth:_0x54b485}=_0x160bbc;try{const _0x4612eb=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x2c00ae(0x181))](_0x54b485)),_0x5c6cb6=await salesforce_auth_1['SalesforceAuth'][_0x2c00ae(0x17d)](),_0x1631bd=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0x5c6cb6)),_0x1e24be=new dependency_service_1[(_0x2c00ae(0x17a))](_0x160bbc,_0x1631bd,_0x4612eb);return await _0x1e24be[_0x2c00ae(0x1b2)]();}catch(_0x55db89){const _0x2cb887=_0x55db89 instanceof base_veeva_error_1[_0x2c00ae(0x185)]?_0x55db89[_0x2c00ae(0x19d)]()[_0x2c00ae(0x197)]('\x0a'):_0x55db89['message'];return{'responseStatus':status_enums_1['AppResponseStatus'][_0x2c00ae(0x1ab)],'responseMessage':_0x2cb887};}}async[a415_0x39c310(0x1b6)](_0x2b7776){const _0x86ae99=a415_0x39c310,{veevaAuth:_0x43dbd0,timeZone:_0x13bc9d,attachmentLogId:_0x5a21d7}=_0x2b7776;try{const _0x161cf4=(0x0,veeva_request_utils_1[_0x86ae99(0x188)])(new veeva_auth_1[(_0x86ae99(0x181))](_0x43dbd0,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x4ebb73=await salesforce_auth_1[_0x86ae99(0x1bf)][_0x86ae99(0x17d)](),_0x12e50d=(0x0,salesforce_request_utils_1[_0x86ae99(0x180)])(new salesforce_auth_1['SalesforceAuth'](_0x4ebb73)),_0xe08541=new logger_1[(_0x86ae99(0x18d))](_0x12e50d,_0x13bc9d,_0x5a21d7),_0x44172f=_0x86ae99(0x1a8)+(0x0,shortid_1[_0x86ae99(0x1a9)])();await(0x0,fs_util_1[_0x86ae99(0x18c)])(_0x44172f);const _0x291111=new rollback_service_1[(_0x86ae99(0x1b4))]({..._0x2b7776,'connectionVeeva':_0x161cf4,'connectionSalesforce':_0x12e50d,'logger':_0xe08541,'tempFolder':_0x44172f,'instanceUrl':_0x4ebb73[_0x86ae99(0x191)]});return _0x291111[_0x86ae99(0x1b2)]()[_0x86ae99(0x189)](()=>(0x0,promises_1['rm'])(_0x44172f,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x86ae99(0x193)][_0x86ae99(0x1a2)]};}catch(_0xe77c11){return{'responseStatus':status_enums_1[_0x86ae99(0x193)][_0x86ae99(0x1ab)],'responseMessage':_0xe77c11[_0x86ae99(0x17f)]};}}};function a415_0x1878(_0xfb6f15,_0x26f9e6){const _0x5f022e=a415_0x4b60();return a415_0x1878=function(_0x41796c,_0xfc7697){_0x41796c=_0x41796c-0x175;let _0x4b603b=_0x5f022e[_0x41796c];return _0x4b603b;},a415_0x1878(_0xfb6f15,_0x26f9e6);}__decorate([(0x0,core_1[a415_0x39c310(0x179)])(a415_0x39c310(0x1a5)),__param(0x0,core_1[a415_0x39c310(0x1b3)]['body']()),__metadata(a415_0x39c310(0x196),Function),__metadata('design:paramtypes',[Object]),__metadata(a415_0x39c310(0x17b),Promise)],VeevaVaultController[a415_0x39c310(0x1b0)],a415_0x39c310(0x1ae),null),__decorate([(0x0,core_1[a415_0x39c310(0x179)])(a415_0x39c310(0x1a7)),__param(0x0,core_1[a415_0x39c310(0x1b3)][a415_0x39c310(0x1af)]()),__metadata(a415_0x39c310(0x196),Function),__metadata(a415_0x39c310(0x19b),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController['prototype'],a415_0x39c310(0x1bc),null),__decorate([(0x0,core_1[a415_0x39c310(0x179)])(a415_0x39c310(0x1a1)),__param(0x0,core_1[a415_0x39c310(0x1b3)][a415_0x39c310(0x1af)]()),__metadata(a415_0x39c310(0x196),Function),__metadata(a415_0x39c310(0x19b),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a415_0x39c310(0x1b0)],a415_0x39c310(0x192),null),__decorate([(0x0,core_1[a415_0x39c310(0x179)])(a415_0x39c310(0x1b6)),__param(0x0,core_1[a415_0x39c310(0x1b3)][a415_0x39c310(0x1af)]()),__metadata(a415_0x39c310(0x196),Function),__metadata(a415_0x39c310(0x19b),[Object]),__metadata(a415_0x39c310(0x17b),Promise)],VeevaVaultController[a415_0x39c310(0x1b0)],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a415_0x39c310(0x19c)])(a415_0x39c310(0x18e)),(0x0,core_1[a415_0x39c310(0x1a3)])('v1.1')],VeevaVaultController),exports[a415_0x39c310(0x1a0)]=VeevaVaultController;