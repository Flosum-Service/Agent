const a414_0x2f7b1d=a414_0x416a;(function(_0x3a15ba,_0x5532c5){const _0x596c79=a414_0x416a,_0x48b78f=_0x3a15ba();while(!![]){try{const _0x57abee=-parseInt(_0x596c79(0xfa))/0x1+parseInt(_0x596c79(0xb9))/0x2*(parseInt(_0x596c79(0xea))/0x3)+-parseInt(_0x596c79(0xb6))/0x4*(-parseInt(_0x596c79(0xdc))/0x5)+-parseInt(_0x596c79(0xda))/0x6+parseInt(_0x596c79(0xb5))/0x7*(-parseInt(_0x596c79(0xfb))/0x8)+-parseInt(_0x596c79(0xbf))/0x9*(parseInt(_0x596c79(0xc0))/0xa)+parseInt(_0x596c79(0xc3))/0xb*(parseInt(_0x596c79(0xf3))/0xc);if(_0x57abee===_0x5532c5)break;else _0x48b78f['push'](_0x48b78f['shift']());}catch(_0x3d57f5){_0x48b78f['push'](_0x48b78f['shift']());}}}(a414_0x56a8,0x616c5));const a414_0x2050e0=(function(){let _0x46fdaf=!![];return function(_0x37d263,_0x4a36f8){const _0x377776=_0x46fdaf?function(){const _0x2a70c5=a414_0x416a;if(_0x4a36f8){const _0x39c9c7=_0x4a36f8[_0x2a70c5(0xf1)](_0x37d263,arguments);return _0x4a36f8=null,_0x39c9c7;}}:function(){};return _0x46fdaf=![],_0x377776;};}()),a414_0x3bbe7e=a414_0x2050e0(this,function(){const _0x332197=a414_0x416a;return a414_0x3bbe7e['toString']()['search'](_0x332197(0xbd))['toString']()[_0x332197(0xd9)](a414_0x3bbe7e)['search'](_0x332197(0xbd));});a414_0x3bbe7e();'use strict';var __decorate=this&&this[a414_0x2f7b1d(0xd3)]||function(_0x344eb9,_0x4d3ffe,_0x5f47f8,_0x37b0ad){const _0x5900fd=a414_0x2f7b1d;var _0x1bdfd6=arguments[_0x5900fd(0xb7)],_0x1ce685=_0x1bdfd6<0x3?_0x4d3ffe:_0x37b0ad===null?_0x37b0ad=Object[_0x5900fd(0xe9)](_0x4d3ffe,_0x5f47f8):_0x37b0ad,_0x481d78;if(typeof Reflect===_0x5900fd(0xcd)&&typeof Reflect['decorate']==='function')_0x1ce685=Reflect['decorate'](_0x344eb9,_0x4d3ffe,_0x5f47f8,_0x37b0ad);else{for(var _0x374637=_0x344eb9['length']-0x1;_0x374637>=0x0;_0x374637--)if(_0x481d78=_0x344eb9[_0x374637])_0x1ce685=(_0x1bdfd6<0x3?_0x481d78(_0x1ce685):_0x1bdfd6>0x3?_0x481d78(_0x4d3ffe,_0x5f47f8,_0x1ce685):_0x481d78(_0x4d3ffe,_0x5f47f8))||_0x1ce685;}return _0x1bdfd6>0x3&&_0x1ce685&&Object['defineProperty'](_0x4d3ffe,_0x5f47f8,_0x1ce685),_0x1ce685;},__metadata=this&&this[a414_0x2f7b1d(0xc9)]||function(_0x4c7ef9,_0x4bec14){const _0x571290=a414_0x2f7b1d;if(typeof Reflect===_0x571290(0xcd)&&typeof Reflect[_0x571290(0xe0)]==='function')return Reflect[_0x571290(0xe0)](_0x4c7ef9,_0x4bec14);},__param=this&&this[a414_0x2f7b1d(0xd5)]||function(_0x4160fc,_0x5594e9){return function(_0x450330,_0x5e8731){_0x5594e9(_0x450330,_0x5e8731,_0x4160fc);};},__importDefault=this&&this[a414_0x2f7b1d(0xf4)]||function(_0x11b75c){const _0x388848=a414_0x2f7b1d;return _0x11b75c&&_0x11b75c[_0x388848(0xc8)]?_0x11b75c:{'default':_0x11b75c};};Object[a414_0x2f7b1d(0xc1)](exports,a414_0x2f7b1d(0xc8),{'value':!![]}),exports['VeevaVaultController']=void 0x0;function a414_0x416a(_0xb8794a,_0x36cbec){const _0x5e272f=a414_0x56a8();return a414_0x416a=function(_0x3bbe7e,_0x2050e0){_0x3bbe7e=_0x3bbe7e-0xb5;let _0x56a8ea=_0x5e272f[_0x3bbe7e];return _0x56a8ea;},a414_0x416a(_0xb8794a,_0x36cbec);}function a414_0x56a8(){const _0x9f1944=['Version','createVeevaRequest','./services/snapshot.service','param','then','dependency','getOwnPropertyDescriptor','222kYoxcL','./utils/salesforce-request.utils','temp/veeva/deploy_','SnapshotService','./utils/veeva-request.utils','DependencyService','./services/rollback.service','apply','makeDir','9362412DZGFOa','__importDefault','finally','Controller','Post','rollback','../../core','795454nHIPat','45208nbPdnQ','veeva-vault','design:type','join','./services/deploy.service','./enums/status.enums','message','903zvFthn','324524adPWpE','length','execute','4426vHpUmW','snapshot','getAuthDetails','design:paramtypes','(((.+)+)+)+$','shortid','9GaJfua','4299520AfUxsG','defineProperty','doSnapshot','33rZqaOC','AppResponseStatus','./classes/auth/salesforce-auth','FAILURE','./classes/errors/base-veeva-error','__esModule','__metadata','SalesforceAuth','./services/dependency.service','instanceUrl','object','createSalesforceRequest','retrieveDependency','./classes/loggers/logger','default','deploy','__decorate','prototype','__param','body','temp/veeva/rollback_','SUCCESS','constructor','3339540NpXeoP','BaseVeevaError','25BdhFPe','fs/promises','Logger','DeployService','metadata','design:returntype','VeevaAuth'];a414_0x56a8=function(){return _0x9f1944;};return a414_0x56a8();}const core_1=require(a414_0x2f7b1d(0xf9)),dependency_service_1=require(a414_0x2f7b1d(0xcb)),snapshot_service_1=require(a414_0x2f7b1d(0xe5)),deploy_service_1=require(a414_0x2f7b1d(0xff)),veeva_request_utils_1=require(a414_0x2f7b1d(0xee)),status_enums_1=require(a414_0x2f7b1d(0x100)),shortid_1=__importDefault(require(a414_0x2f7b1d(0xbe))),fs_util_1=require('./utils/fs-util'),logger_1=require(a414_0x2f7b1d(0xd0)),promises_1=require(a414_0x2f7b1d(0xdd)),base_veeva_error_1=require(a414_0x2f7b1d(0xc7)),salesforce_request_utils_1=require(a414_0x2f7b1d(0xeb)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a414_0x2f7b1d(0xc5)),rollback_service_1=require(a414_0x2f7b1d(0xf0)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a414_0x2f7b1d(0xc2)](_0x16a5a2){const _0x258e4e=a414_0x2f7b1d,{veevaAuth:_0x5002bc,timeZone:_0x2da901,attachmentLogId:_0x1ae0b2}=_0x16a5a2;try{const _0x247b7c=(0x0,veeva_request_utils_1[_0x258e4e(0xe4)])(new veeva_auth_1['VeevaAuth'](_0x5002bc,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x41cf10=await salesforce_auth_1[_0x258e4e(0xca)]['getAuthDetails'](),_0x1e4f44=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x258e4e(0xca))](_0x41cf10)),_0x5a303e=new logger_1[(_0x258e4e(0xde))](_0x1e4f44,_0x2da901,_0x1ae0b2),_0x26be11=new snapshot_service_1[(_0x258e4e(0xed))](_0x16a5a2,_0x1e4f44,_0x247b7c,_0x5a303e);return _0x26be11[_0x258e4e(0xb8)]()[_0x258e4e(0xe7)](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x258e4e(0xd8)]};}catch(_0x191606){return{'responseStatus':status_enums_1[_0x258e4e(0xc4)]['FAILURE'],'responseMessage':_0x191606[_0x258e4e(0x101)]};}}async['deployFromBranch'](_0x234bff){const _0x24410e=a414_0x2f7b1d,{veevaAuth:_0x2e74d9,timeZone:_0x3052f3,attachmentLogId:_0xcd8412}=_0x234bff;try{const _0x2b4f5a=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x24410e(0xe2))](_0x2e74d9,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x40f060=await salesforce_auth_1[_0x24410e(0xca)][_0x24410e(0xbb)](),_0x29a782=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x24410e(0xca))](_0x40f060)),_0x53baed=new logger_1[(_0x24410e(0xde))](_0x29a782,_0x3052f3,_0xcd8412),_0x4589aa=_0x24410e(0xec)+(0x0,shortid_1[_0x24410e(0xd1)])();await(0x0,fs_util_1['makeDir'])(_0x4589aa);const _0x55ce27=new deploy_service_1[(_0x24410e(0xdf))](_0x234bff,_0x29a782,_0x2b4f5a,_0x53baed,_0x4589aa,_0x40f060['instanceUrl']);return _0x55ce27[_0x24410e(0xb8)]()[_0x24410e(0xf5)](()=>(0x0,promises_1['rm'])(_0x4589aa,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x24410e(0xc4)][_0x24410e(0xd8)]};}catch(_0x169c5c){return{'responseStatus':status_enums_1[_0x24410e(0xc4)][_0x24410e(0xc6)],'responseMessage':_0x169c5c['message']};}}async[a414_0x2f7b1d(0xcf)](_0x50e01a){const _0x422a15=a414_0x2f7b1d,{veevaAuth:_0x35df67}=_0x50e01a;try{const _0x5223a6=(0x0,veeva_request_utils_1[_0x422a15(0xe4)])(new veeva_auth_1[(_0x422a15(0xe2))](_0x35df67)),_0x563b9a=await salesforce_auth_1[_0x422a15(0xca)][_0x422a15(0xbb)](),_0x48e997=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1[(_0x422a15(0xca))](_0x563b9a)),_0x15e0b3=new dependency_service_1[(_0x422a15(0xef))](_0x50e01a,_0x48e997,_0x5223a6);return await _0x15e0b3[_0x422a15(0xb8)]();}catch(_0x161945){const _0x289a1b=_0x161945 instanceof base_veeva_error_1[_0x422a15(0xdb)]?_0x161945['getMessages']()[_0x422a15(0xfe)]('\x0a'):_0x161945['message'];return{'responseStatus':status_enums_1[_0x422a15(0xc4)][_0x422a15(0xc6)],'responseMessage':_0x289a1b};}}async[a414_0x2f7b1d(0xf8)](_0x2539c4){const _0x382f9d=a414_0x2f7b1d,{veevaAuth:_0x4e4cf0,timeZone:_0x1002c8,attachmentLogId:_0xcabf11}=_0x2539c4;try{const _0x290e93=(0x0,veeva_request_utils_1[_0x382f9d(0xe4)])(new veeva_auth_1['VeevaAuth'](_0x4e4cf0,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x126e4d=await salesforce_auth_1[_0x382f9d(0xca)][_0x382f9d(0xbb)](),_0x484173=(0x0,salesforce_request_utils_1[_0x382f9d(0xce)])(new salesforce_auth_1['SalesforceAuth'](_0x126e4d)),_0xc9d016=new logger_1['Logger'](_0x484173,_0x1002c8,_0xcabf11),_0x4814fe=_0x382f9d(0xd7)+(0x0,shortid_1[_0x382f9d(0xd1)])();await(0x0,fs_util_1[_0x382f9d(0xf2)])(_0x4814fe);const _0x24f493=new rollback_service_1['RollbackService']({..._0x2539c4,'connectionVeeva':_0x290e93,'connectionSalesforce':_0x484173,'logger':_0xc9d016,'tempFolder':_0x4814fe,'instanceUrl':_0x126e4d[_0x382f9d(0xcc)]});return _0x24f493['execute']()['finally'](()=>(0x0,promises_1['rm'])(_0x4814fe,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x382f9d(0xc4)][_0x382f9d(0xd8)]};}catch(_0x54fe80){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x382f9d(0xc6)],'responseMessage':_0x54fe80[_0x382f9d(0x101)]};}}};__decorate([(0x0,core_1[a414_0x2f7b1d(0xf7)])(a414_0x2f7b1d(0xba)),__param(0x0,core_1[a414_0x2f7b1d(0xe6)]['body']()),__metadata(a414_0x2f7b1d(0xfd),Function),__metadata(a414_0x2f7b1d(0xbc),[Object]),__metadata(a414_0x2f7b1d(0xe1),Promise)],VeevaVaultController[a414_0x2f7b1d(0xd4)],a414_0x2f7b1d(0xc2),null),__decorate([(0x0,core_1['Post'])(a414_0x2f7b1d(0xd2)),__param(0x0,core_1['param'][a414_0x2f7b1d(0xd6)]()),__metadata(a414_0x2f7b1d(0xfd),Function),__metadata(a414_0x2f7b1d(0xbc),[Object]),__metadata(a414_0x2f7b1d(0xe1),Promise)],VeevaVaultController[a414_0x2f7b1d(0xd4)],'deployFromBranch',null),__decorate([(0x0,core_1[a414_0x2f7b1d(0xf7)])(a414_0x2f7b1d(0xe8)),__param(0x0,core_1['param'][a414_0x2f7b1d(0xd6)]()),__metadata(a414_0x2f7b1d(0xfd),Function),__metadata('design:paramtypes',[Object]),__metadata(a414_0x2f7b1d(0xe1),Promise)],VeevaVaultController[a414_0x2f7b1d(0xd4)],a414_0x2f7b1d(0xcf),null),__decorate([(0x0,core_1['Post'])(a414_0x2f7b1d(0xf8)),__param(0x0,core_1[a414_0x2f7b1d(0xe6)]['body']()),__metadata(a414_0x2f7b1d(0xfd),Function),__metadata(a414_0x2f7b1d(0xbc),[Object]),__metadata(a414_0x2f7b1d(0xe1),Promise)],VeevaVaultController[a414_0x2f7b1d(0xd4)],a414_0x2f7b1d(0xf8),null),VeevaVaultController=__decorate([(0x0,core_1[a414_0x2f7b1d(0xf6)])(a414_0x2f7b1d(0xfc)),(0x0,core_1[a414_0x2f7b1d(0xe3)])('v1.1')],VeevaVaultController),exports['VeevaVaultController']=VeevaVaultController;