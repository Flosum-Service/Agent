const a386_0x5755f0=a386_0xe3a8;(function(_0x4c9094,_0x5abfcc){const _0x30a18b=a386_0xe3a8,_0xc6b7ac=_0x4c9094();while(!![]){try{const _0x2c5860=parseInt(_0x30a18b(0x103))/0x1*(parseInt(_0x30a18b(0xf5))/0x2)+parseInt(_0x30a18b(0x102))/0x3*(parseInt(_0x30a18b(0x11a))/0x4)+parseInt(_0x30a18b(0xfe))/0x5*(parseInt(_0x30a18b(0xe6))/0x6)+parseInt(_0x30a18b(0xe7))/0x7+-parseInt(_0x30a18b(0xe1))/0x8*(parseInt(_0x30a18b(0xd6))/0x9)+-parseInt(_0x30a18b(0xd7))/0xa+-parseInt(_0x30a18b(0x108))/0xb*(parseInt(_0x30a18b(0x11c))/0xc);if(_0x2c5860===_0x5abfcc)break;else _0xc6b7ac['push'](_0xc6b7ac['shift']());}catch(_0x4d7f4f){_0xc6b7ac['push'](_0xc6b7ac['shift']());}}}(a386_0xfcae,0x622f1));const a386_0x9431d3=(function(){let _0x39c71f=!![];return function(_0x34f1e5,_0x45a719){const _0x1beeca=_0x39c71f?function(){const _0x527e01=a386_0xe3a8;if(_0x45a719){const _0x46e4ca=_0x45a719[_0x527e01(0xe5)](_0x34f1e5,arguments);return _0x45a719=null,_0x46e4ca;}}:function(){};return _0x39c71f=![],_0x1beeca;};}()),a386_0x2d0a0c=a386_0x9431d3(this,function(){const _0x49547a=a386_0xe3a8;return a386_0x2d0a0c['toString']()[_0x49547a(0x109)](_0x49547a(0x10d))['toString']()[_0x49547a(0xf8)](a386_0x2d0a0c)[_0x49547a(0x109)]('(((.+)+)+)+$');});function a386_0xe3a8(_0x6efae3,_0x2d66cc){const _0x1b1a6c=a386_0xfcae();return a386_0xe3a8=function(_0x2d0a0c,_0x9431d3){_0x2d0a0c=_0x2d0a0c-0xd3;let _0xfcae34=_0x1b1a6c[_0x2d0a0c];return _0xfcae34;},a386_0xe3a8(_0x6efae3,_0x2d66cc);}a386_0x2d0a0c();'use strict';function a386_0xfcae(){const _0x495bf2=['DependencyService','execute','1687948PWKTWA','shortid','11688SoNrxn','deploy','prototype','Logger','dependency','__importDefault','27yuoamV','5125610dOUSWJ','defineProperty','Controller','./classes/auth/veeva-auth','deployFromBranch','./services/snapshot.service','./services/deploy.service','v1.1','./services/dependency.service','metadata','2038008lfGAfe','decorate','DeployService','./utils/salesforce-request.utils','apply','2375130qkoBnD','1966916QTbeff','object','fs/promises','length','Post','__metadata','design:type','./classes/errors/base-veeva-error','./utils/fs-util','SalesforceAuth','function','param','message','createSalesforceRequest','76bEawpf','default','veeva-vault','constructor','design:paramtypes','join','snapshot','AppResponseStatus','SUCCESS','10HPAumn','retrieveDependency','getAuthDetails','body','3kFTLbC','7823JWvLOp','then','./enums/status.enums','Version','makeDir','1276iMKLWZ','search','FAILURE','VeevaVaultController','VeevaAuth','(((.+)+)+)+$','createVeevaRequest','design:returntype','temp/veeva/deploy_','getOwnPropertyDescriptor','RollbackService','rollback','./classes/auth/salesforce-auth','BaseVeevaError','doSnapshot','instanceUrl'];a386_0xfcae=function(){return _0x495bf2;};return a386_0xfcae();}var __decorate=this&&this['__decorate']||function(_0x39762f,_0x4c3fb9,_0x3bc023,_0x53c4bf){const _0x103801=a386_0xe3a8;var _0x526565=arguments[_0x103801(0xea)],_0x2c807b=_0x526565<0x3?_0x4c3fb9:_0x53c4bf===null?_0x53c4bf=Object[_0x103801(0x111)](_0x4c3fb9,_0x3bc023):_0x53c4bf,_0x4bb70f;if(typeof Reflect===_0x103801(0xe8)&&typeof Reflect[_0x103801(0xe2)]==='function')_0x2c807b=Reflect[_0x103801(0xe2)](_0x39762f,_0x4c3fb9,_0x3bc023,_0x53c4bf);else{for(var _0x1505e2=_0x39762f[_0x103801(0xea)]-0x1;_0x1505e2>=0x0;_0x1505e2--)if(_0x4bb70f=_0x39762f[_0x1505e2])_0x2c807b=(_0x526565<0x3?_0x4bb70f(_0x2c807b):_0x526565>0x3?_0x4bb70f(_0x4c3fb9,_0x3bc023,_0x2c807b):_0x4bb70f(_0x4c3fb9,_0x3bc023))||_0x2c807b;}return _0x526565>0x3&&_0x2c807b&&Object[_0x103801(0xd8)](_0x4c3fb9,_0x3bc023,_0x2c807b),_0x2c807b;},__metadata=this&&this[a386_0x5755f0(0xec)]||function(_0x538008,_0x29ace0){const _0x142a19=a386_0x5755f0;if(typeof Reflect===_0x142a19(0xe8)&&typeof Reflect[_0x142a19(0xe0)]===_0x142a19(0xf1))return Reflect[_0x142a19(0xe0)](_0x538008,_0x29ace0);},__param=this&&this['__param']||function(_0x1cf96c,_0x3a2c26){return function(_0x4b21b4,_0x4b0a67){_0x3a2c26(_0x4b21b4,_0x4b0a67,_0x1cf96c);};},__importDefault=this&&this[a386_0x5755f0(0xd5)]||function(_0x52661c){return _0x52661c&&_0x52661c['__esModule']?_0x52661c:{'default':_0x52661c};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require('../../core'),dependency_service_1=require(a386_0x5755f0(0xdf)),snapshot_service_1=require(a386_0x5755f0(0xdc)),deploy_service_1=require(a386_0x5755f0(0xdd)),veeva_request_utils_1=require('./utils/veeva-request.utils'),status_enums_1=require(a386_0x5755f0(0x105)),shortid_1=__importDefault(require(a386_0x5755f0(0x11b))),fs_util_1=require(a386_0x5755f0(0xef)),logger_1=require('./classes/loggers/logger'),promises_1=require(a386_0x5755f0(0xe9)),base_veeva_error_1=require(a386_0x5755f0(0xee)),salesforce_request_utils_1=require(a386_0x5755f0(0xe4)),veeva_auth_1=require(a386_0x5755f0(0xda)),salesforce_auth_1=require(a386_0x5755f0(0x114)),rollback_service_1=require('./services/rollback.service'),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a386_0x5755f0(0x116)](_0x13f0e1){const _0x2e4087=a386_0x5755f0,{veevaAuth:_0x40ed5c,timeZone:_0x32f10c,attachmentLogId:_0x4a75f7}=_0x13f0e1;try{const _0xd94dd5=(0x0,veeva_request_utils_1[_0x2e4087(0x10e)])(new veeva_auth_1[(_0x2e4087(0x10c))](_0x40ed5c,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x245ba1=await salesforce_auth_1[_0x2e4087(0xf0)][_0x2e4087(0x100)](),_0x575a6e=(0x0,salesforce_request_utils_1[_0x2e4087(0xf4)])(new salesforce_auth_1['SalesforceAuth'](_0x245ba1)),_0x162f9c=new logger_1[(_0x2e4087(0xd3))](_0x575a6e,_0x32f10c,_0x4a75f7),_0x2aec1b=new snapshot_service_1['SnapshotService'](_0x13f0e1,_0x575a6e,_0xd94dd5,_0x162f9c);return _0x2aec1b[_0x2e4087(0x119)]()[_0x2e4087(0x104)](),{'responseStatus':status_enums_1[_0x2e4087(0xfc)][_0x2e4087(0xfd)]};}catch(_0x421665){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x2e4087(0x10a)],'responseMessage':_0x421665[_0x2e4087(0xf3)]};}}async[a386_0x5755f0(0xdb)](_0x231d79){const _0x1290dc=a386_0x5755f0,{veevaAuth:_0x2d873e,timeZone:_0x36c915,attachmentLogId:_0x1f41f8}=_0x231d79;try{const _0x32b49e=(0x0,veeva_request_utils_1[_0x1290dc(0x10e)])(new veeva_auth_1['VeevaAuth'](_0x2d873e,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x379089=await salesforce_auth_1[_0x1290dc(0xf0)][_0x1290dc(0x100)](),_0xee7e3a=(0x0,salesforce_request_utils_1[_0x1290dc(0xf4)])(new salesforce_auth_1[(_0x1290dc(0xf0))](_0x379089)),_0x1a5c87=new logger_1[(_0x1290dc(0xd3))](_0xee7e3a,_0x36c915,_0x1f41f8),_0x5a02be=_0x1290dc(0x110)+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x1290dc(0x107)])(_0x5a02be);const _0x11225c=new deploy_service_1[(_0x1290dc(0xe3))](_0x231d79,_0xee7e3a,_0x32b49e,_0x1a5c87,_0x5a02be,_0x379089[_0x1290dc(0x117)]);return _0x11225c['execute']()['finally'](()=>(0x0,promises_1['rm'])(_0x5a02be,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x1290dc(0xfc)]['SUCCESS']};}catch(_0x22ad0b){return{'responseStatus':status_enums_1[_0x1290dc(0xfc)][_0x1290dc(0x10a)],'responseMessage':_0x22ad0b[_0x1290dc(0xf3)]};}}async[a386_0x5755f0(0xff)](_0x461d9d){const _0xabf03d=a386_0x5755f0,{veevaAuth:_0x4400bf}=_0x461d9d;try{const _0x4ab94d=(0x0,veeva_request_utils_1[_0xabf03d(0x10e)])(new veeva_auth_1[(_0xabf03d(0x10c))](_0x4400bf)),_0x17c18d=await salesforce_auth_1[_0xabf03d(0xf0)]['getAuthDetails'](),_0x5a00ac=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0x17c18d)),_0x54c24b=new dependency_service_1[(_0xabf03d(0x118))](_0x461d9d,_0x5a00ac,_0x4ab94d);return await _0x54c24b[_0xabf03d(0x119)]();}catch(_0x4f8f5d){const _0x19dd92=_0x4f8f5d instanceof base_veeva_error_1[_0xabf03d(0x115)]?_0x4f8f5d['getMessages']()[_0xabf03d(0xfa)]('\x0a'):_0x4f8f5d['message'];return{'responseStatus':status_enums_1[_0xabf03d(0xfc)]['FAILURE'],'responseMessage':_0x19dd92};}}async[a386_0x5755f0(0x113)](_0x4d03f1){const _0x5e503e=a386_0x5755f0,{veevaAuth:_0x3e0c27,timeZone:_0x5f254b,attachmentLogId:_0xb5cfcb}=_0x4d03f1;try{const _0xe6e2b=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x5e503e(0x10c))](_0x3e0c27,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xf95ab8=await salesforce_auth_1['SalesforceAuth'][_0x5e503e(0x100)](),_0x1ecea6=(0x0,salesforce_request_utils_1[_0x5e503e(0xf4)])(new salesforce_auth_1['SalesforceAuth'](_0xf95ab8)),_0x5888b0=new logger_1['Logger'](_0x1ecea6,_0x5f254b,_0xb5cfcb),_0x252774='temp/veeva/rollback_'+(0x0,shortid_1[_0x5e503e(0xf6)])();await(0x0,fs_util_1[_0x5e503e(0x107)])(_0x252774);const _0x402821=new rollback_service_1[(_0x5e503e(0x112))]({..._0x4d03f1,'connectionVeeva':_0xe6e2b,'connectionSalesforce':_0x1ecea6,'logger':_0x5888b0,'tempFolder':_0x252774,'instanceUrl':_0xf95ab8['instanceUrl']});return _0x402821[_0x5e503e(0x119)]()['finally'](()=>(0x0,promises_1['rm'])(_0x252774,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x5e503e(0xfd)]};}catch(_0x12680b){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x5e503e(0x10a)],'responseMessage':_0x12680b[_0x5e503e(0xf3)]};}}};__decorate([(0x0,core_1['Post'])(a386_0x5755f0(0xfb)),__param(0x0,core_1[a386_0x5755f0(0xf2)][a386_0x5755f0(0x101)]()),__metadata(a386_0x5755f0(0xed),Function),__metadata(a386_0x5755f0(0xf9),[Object]),__metadata(a386_0x5755f0(0x10f),Promise)],VeevaVaultController[a386_0x5755f0(0x11e)],'doSnapshot',null),__decorate([(0x0,core_1[a386_0x5755f0(0xeb)])(a386_0x5755f0(0x11d)),__param(0x0,core_1['param'][a386_0x5755f0(0x101)]()),__metadata(a386_0x5755f0(0xed),Function),__metadata('design:paramtypes',[Object]),__metadata(a386_0x5755f0(0x10f),Promise)],VeevaVaultController[a386_0x5755f0(0x11e)],a386_0x5755f0(0xdb),null),__decorate([(0x0,core_1[a386_0x5755f0(0xeb)])(a386_0x5755f0(0xd4)),__param(0x0,core_1[a386_0x5755f0(0xf2)]['body']()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata(a386_0x5755f0(0x10f),Promise)],VeevaVaultController[a386_0x5755f0(0x11e)],a386_0x5755f0(0xff),null),__decorate([(0x0,core_1[a386_0x5755f0(0xeb)])(a386_0x5755f0(0x113)),__param(0x0,core_1[a386_0x5755f0(0xf2)][a386_0x5755f0(0x101)]()),__metadata(a386_0x5755f0(0xed),Function),__metadata(a386_0x5755f0(0xf9),[Object]),__metadata(a386_0x5755f0(0x10f),Promise)],VeevaVaultController['prototype'],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a386_0x5755f0(0xd9)])(a386_0x5755f0(0xf7)),(0x0,core_1[a386_0x5755f0(0x106)])(a386_0x5755f0(0xde))],VeevaVaultController),exports[a386_0x5755f0(0x10b)]=VeevaVaultController;