function a371_0x3708(_0x4bae95,_0x292c8f){const _0x3eabd7=a371_0x5896();return a371_0x3708=function(_0xdc6ead,_0x5d695a){_0xdc6ead=_0xdc6ead-0x1ac;let _0x589660=_0x3eabd7[_0xdc6ead];return _0x589660;},a371_0x3708(_0x4bae95,_0x292c8f);}const a371_0xd3318e=a371_0x3708;(function(_0x5106e5,_0xf1cb9b){const _0xb4d0f1=a371_0x3708,_0x5e6480=_0x5106e5();while(!![]){try{const _0x594b57=parseInt(_0xb4d0f1(0x1eb))/0x1*(parseInt(_0xb4d0f1(0x1ea))/0x2)+-parseInt(_0xb4d0f1(0x1ba))/0x3+parseInt(_0xb4d0f1(0x1e6))/0x4*(parseInt(_0xb4d0f1(0x1bc))/0x5)+parseInt(_0xb4d0f1(0x1ee))/0x6+-parseInt(_0xb4d0f1(0x1c4))/0x7*(parseInt(_0xb4d0f1(0x1da))/0x8)+parseInt(_0xb4d0f1(0x1d9))/0x9+parseInt(_0xb4d0f1(0x1ec))/0xa*(-parseInt(_0xb4d0f1(0x1de))/0xb);if(_0x594b57===_0xf1cb9b)break;else _0x5e6480['push'](_0x5e6480['shift']());}catch(_0x10b0da){_0x5e6480['push'](_0x5e6480['shift']());}}}(a371_0x5896,0x6dff0));const a371_0x5d695a=(function(){let _0x62c8e6=!![];return function(_0x50e9f3,_0x3d3408){const _0xe27f1=_0x62c8e6?function(){if(_0x3d3408){const _0x47d44c=_0x3d3408['apply'](_0x50e9f3,arguments);return _0x3d3408=null,_0x47d44c;}}:function(){};return _0x62c8e6=![],_0xe27f1;};}()),a371_0xdc6ead=a371_0x5d695a(this,function(){const _0x23afa2=a371_0x3708;return a371_0xdc6ead[_0x23afa2(0x1df)]()[_0x23afa2(0x1b2)]('(((.+)+)+)+$')['toString']()['constructor'](a371_0xdc6ead)[_0x23afa2(0x1b2)]('(((.+)+)+)+$');});a371_0xdc6ead();'use strict';var __decorate=this&&this[a371_0xd3318e(0x1cd)]||function(_0x529e4a,_0x494a9a,_0x170089,_0x2bfb08){const _0x5901bf=a371_0xd3318e;var _0xa03452=arguments['length'],_0x448144=_0xa03452<0x3?_0x494a9a:_0x2bfb08===null?_0x2bfb08=Object[_0x5901bf(0x1cc)](_0x494a9a,_0x170089):_0x2bfb08,_0x54c33f;if(typeof Reflect==='object'&&typeof Reflect[_0x5901bf(0x1ce)]===_0x5901bf(0x1e3))_0x448144=Reflect[_0x5901bf(0x1ce)](_0x529e4a,_0x494a9a,_0x170089,_0x2bfb08);else{for(var _0x4cf137=_0x529e4a[_0x5901bf(0x1b3)]-0x1;_0x4cf137>=0x0;_0x4cf137--)if(_0x54c33f=_0x529e4a[_0x4cf137])_0x448144=(_0xa03452<0x3?_0x54c33f(_0x448144):_0xa03452>0x3?_0x54c33f(_0x494a9a,_0x170089,_0x448144):_0x54c33f(_0x494a9a,_0x170089))||_0x448144;}return _0xa03452>0x3&&_0x448144&&Object[_0x5901bf(0x1d1)](_0x494a9a,_0x170089,_0x448144),_0x448144;},__metadata=this&&this[a371_0xd3318e(0x1ca)]||function(_0x4ec558,_0x3ed2f6){const _0x5d016b=a371_0xd3318e;if(typeof Reflect==='object'&&typeof Reflect[_0x5d016b(0x1e1)]===_0x5d016b(0x1e3))return Reflect[_0x5d016b(0x1e1)](_0x4ec558,_0x3ed2f6);},__param=this&&this[a371_0xd3318e(0x1af)]||function(_0x15d0ce,_0xd39ced){return function(_0x1b1044,_0x38e871){_0xd39ced(_0x1b1044,_0x38e871,_0x15d0ce);};},__importDefault=this&&this[a371_0xd3318e(0x1d2)]||function(_0x153387){return _0x153387&&_0x153387['__esModule']?_0x153387:{'default':_0x153387};};Object[a371_0xd3318e(0x1d1)](exports,a371_0xd3318e(0x1d8),{'value':!![]}),exports['VeevaVaultController']=void 0x0;const core_1=require(a371_0xd3318e(0x1ed)),dependency_service_1=require(a371_0xd3318e(0x1d0)),snapshot_service_1=require('./services/snapshot.service'),deploy_service_1=require('./services/deploy.service'),veeva_request_utils_1=require(a371_0xd3318e(0x1d5)),status_enums_1=require(a371_0xd3318e(0x1b8)),shortid_1=__importDefault(require('shortid')),fs_util_1=require(a371_0xd3318e(0x1ac)),logger_1=require(a371_0xd3318e(0x1d3)),promises_1=require(a371_0xd3318e(0x1c8)),base_veeva_error_1=require(a371_0xd3318e(0x1f2)),salesforce_request_utils_1=require(a371_0xd3318e(0x1f3)),veeva_auth_1=require('./classes/auth/veeva-auth'),salesforce_auth_1=require(a371_0xd3318e(0x1e4)),rollback_service_1=require(a371_0xd3318e(0x1f0)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a371_0xd3318e(0x1dd)](_0x337a44){const _0x328a89=a371_0xd3318e,{veevaAuth:_0xc5208f,timeZone:_0x94261a,attachmentLogId:_0x2f3b9}=_0x337a44;try{const _0x2e6299=(0x0,veeva_request_utils_1[_0x328a89(0x1c5)])(new veeva_auth_1['VeevaAuth'](_0xc5208f,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x1c1916=await salesforce_auth_1[_0x328a89(0x1e2)][_0x328a89(0x1d4)](),_0x33b5cb=(0x0,salesforce_request_utils_1[_0x328a89(0x1b6)])(new salesforce_auth_1[(_0x328a89(0x1e2))](_0x1c1916)),_0x13b6c5=new logger_1[(_0x328a89(0x1b0))](_0x33b5cb,_0x94261a,_0x2f3b9),_0x3d3ebf=new snapshot_service_1[(_0x328a89(0x1be))](_0x337a44,_0x33b5cb,_0x2e6299,_0x13b6c5);return _0x3d3ebf[_0x328a89(0x1dc)]()[_0x328a89(0x1b5)](),{'responseStatus':status_enums_1['AppResponseStatus'][_0x328a89(0x1e7)]};}catch(_0xe7ff6){return{'responseStatus':status_enums_1['AppResponseStatus']['FAILURE'],'responseMessage':_0xe7ff6[_0x328a89(0x1b4)]};}}async[a371_0xd3318e(0x1b1)](_0x357fa4){const _0x4d8103=a371_0xd3318e,{veevaAuth:_0x1ac96f,timeZone:_0xf93160,attachmentLogId:_0x1a25db}=_0x357fa4;try{const _0x536cf4=(0x0,veeva_request_utils_1[_0x4d8103(0x1c5)])(new veeva_auth_1[(_0x4d8103(0x1cf))](_0x1ac96f,JOB_UPDATE_TOKEN_ATTEMPTS)),_0xe8d015=await salesforce_auth_1[_0x4d8103(0x1e2)][_0x4d8103(0x1d4)](),_0x7e2a2=(0x0,salesforce_request_utils_1[_0x4d8103(0x1b6)])(new salesforce_auth_1[(_0x4d8103(0x1e2))](_0xe8d015)),_0xeb312f=new logger_1['Logger'](_0x7e2a2,_0xf93160,_0x1a25db),_0x3ec63f=_0x4d8103(0x1d6)+(0x0,shortid_1[_0x4d8103(0x1db)])();await(0x0,fs_util_1['makeDir'])(_0x3ec63f);const _0x16ccbb=new deploy_service_1['DeployService'](_0x357fa4,_0x7e2a2,_0x536cf4,_0xeb312f,_0x3ec63f,_0xe8d015[_0x4d8103(0x1cb)]);return _0x16ccbb['execute']()['finally'](()=>(0x0,promises_1['rm'])(_0x3ec63f,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x4d8103(0x1c6)][_0x4d8103(0x1e7)]};}catch(_0x203448){return{'responseStatus':status_enums_1[_0x4d8103(0x1c6)]['FAILURE'],'responseMessage':_0x203448[_0x4d8103(0x1b4)]};}}async[a371_0xd3318e(0x1f1)](_0x1aee43){const _0x2b9ffe=a371_0xd3318e,{veevaAuth:_0xa41c5b}=_0x1aee43;try{const _0x1a6802=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x2b9ffe(0x1cf))](_0xa41c5b)),_0xa2483=await salesforce_auth_1[_0x2b9ffe(0x1e2)][_0x2b9ffe(0x1d4)](),_0x33afff=(0x0,salesforce_request_utils_1['createSalesforceRequest'])(new salesforce_auth_1['SalesforceAuth'](_0xa2483)),_0x366cec=new dependency_service_1['DependencyService'](_0x1aee43,_0x33afff,_0x1a6802);return await _0x366cec[_0x2b9ffe(0x1dc)]();}catch(_0x439d17){const _0x4d2536=_0x439d17 instanceof base_veeva_error_1[_0x2b9ffe(0x1ef)]?_0x439d17[_0x2b9ffe(0x1b7)]()[_0x2b9ffe(0x1e8)]('\x0a'):_0x439d17[_0x2b9ffe(0x1b4)];return{'responseStatus':status_enums_1[_0x2b9ffe(0x1c6)][_0x2b9ffe(0x1e0)],'responseMessage':_0x4d2536};}}async['rollback'](_0x451e0a){const _0x1b5b65=a371_0xd3318e,{veevaAuth:_0x547c6c,timeZone:_0x5e7410,attachmentLogId:_0x262400}=_0x451e0a;try{const _0x460f3e=(0x0,veeva_request_utils_1[_0x1b5b65(0x1c5)])(new veeva_auth_1[(_0x1b5b65(0x1cf))](_0x547c6c,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x48670d=await salesforce_auth_1[_0x1b5b65(0x1e2)]['getAuthDetails'](),_0xa3b0c=(0x0,salesforce_request_utils_1[_0x1b5b65(0x1b6)])(new salesforce_auth_1[(_0x1b5b65(0x1e2))](_0x48670d)),_0x81a89a=new logger_1['Logger'](_0xa3b0c,_0x5e7410,_0x262400),_0x302c98='temp/veeva/rollback_'+(0x0,shortid_1[_0x1b5b65(0x1db)])();await(0x0,fs_util_1['makeDir'])(_0x302c98);const _0x56924b=new rollback_service_1[(_0x1b5b65(0x1c9))]({..._0x451e0a,'connectionVeeva':_0x460f3e,'connectionSalesforce':_0xa3b0c,'logger':_0x81a89a,'tempFolder':_0x302c98,'instanceUrl':_0x48670d[_0x1b5b65(0x1cb)]});return _0x56924b[_0x1b5b65(0x1dc)]()[_0x1b5b65(0x1bd)](()=>(0x0,promises_1['rm'])(_0x302c98,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1['AppResponseStatus'][_0x1b5b65(0x1e7)]};}catch(_0x56b741){return{'responseStatus':status_enums_1[_0x1b5b65(0x1c6)][_0x1b5b65(0x1e0)],'responseMessage':_0x56b741['message']};}}};__decorate([(0x0,core_1[a371_0xd3318e(0x1e5)])(a371_0xd3318e(0x1c1)),__param(0x0,core_1[a371_0xd3318e(0x1c0)][a371_0xd3318e(0x1e9)]()),__metadata(a371_0xd3318e(0x1c2),Function),__metadata(a371_0xd3318e(0x1bb),[Object]),__metadata(a371_0xd3318e(0x1bf),Promise)],VeevaVaultController[a371_0xd3318e(0x1c7)],a371_0xd3318e(0x1dd),null),__decorate([(0x0,core_1[a371_0xd3318e(0x1e5)])(a371_0xd3318e(0x1b9)),__param(0x0,core_1[a371_0xd3318e(0x1c0)][a371_0xd3318e(0x1e9)]()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata(a371_0xd3318e(0x1bf),Promise)],VeevaVaultController[a371_0xd3318e(0x1c7)],'deployFromBranch',null),__decorate([(0x0,core_1[a371_0xd3318e(0x1e5)])(a371_0xd3318e(0x1ad)),__param(0x0,core_1[a371_0xd3318e(0x1c0)][a371_0xd3318e(0x1e9)]()),__metadata(a371_0xd3318e(0x1c2),Function),__metadata(a371_0xd3318e(0x1bb),[Object]),__metadata(a371_0xd3318e(0x1bf),Promise)],VeevaVaultController[a371_0xd3318e(0x1c7)],a371_0xd3318e(0x1f1),null),__decorate([(0x0,core_1[a371_0xd3318e(0x1e5)])('rollback'),__param(0x0,core_1[a371_0xd3318e(0x1c0)][a371_0xd3318e(0x1e9)]()),__metadata('design:type',Function),__metadata(a371_0xd3318e(0x1bb),[Object]),__metadata(a371_0xd3318e(0x1bf),Promise)],VeevaVaultController[a371_0xd3318e(0x1c7)],'rollback',null),VeevaVaultController=__decorate([(0x0,core_1[a371_0xd3318e(0x1c3)])('veeva-vault'),(0x0,core_1['Version'])(a371_0xd3318e(0x1d7))],VeevaVaultController),exports[a371_0xd3318e(0x1ae)]=VeevaVaultController;function a371_0x5896(){const _0x2f665e=['snapshot','design:type','Controller','2541xsundK','createVeevaRequest','AppResponseStatus','prototype','fs/promises','RollbackService','__metadata','instanceUrl','getOwnPropertyDescriptor','__decorate','decorate','VeevaAuth','./services/dependency.service','defineProperty','__importDefault','./classes/loggers/logger','getAuthDetails','./utils/veeva-request.utils','temp/veeva/deploy_','v1.1','__esModule','4323492ZUwFfu','10792OkXXKq','default','execute','doSnapshot','693NnzMWO','toString','FAILURE','metadata','SalesforceAuth','function','./classes/auth/salesforce-auth','Post','12yZsMwI','SUCCESS','join','body','142RxhDMZ','8791HdNzCU','185340UCaqAh','../../core','4324272bgnNSL','BaseVeevaError','./services/rollback.service','retrieveDependency','./classes/errors/base-veeva-error','./utils/salesforce-request.utils','./utils/fs-util','dependency','VeevaVaultController','__param','Logger','deployFromBranch','search','length','message','then','createSalesforceRequest','getMessages','./enums/status.enums','deploy','1381131TNlFGW','design:paramtypes','1238315TwSdsH','finally','SnapshotService','design:returntype','param'];a371_0x5896=function(){return _0x2f665e;};return a371_0x5896();}