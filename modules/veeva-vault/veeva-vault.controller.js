const a371_0x18270c=a371_0x4e19;(function(_0x234f74,_0x156597){const _0x3c7d50=a371_0x4e19,_0x2f1cd9=_0x234f74();while(!![]){try{const _0x28a35a=-parseInt(_0x3c7d50(0xff))/0x1+-parseInt(_0x3c7d50(0x127))/0x2+parseInt(_0x3c7d50(0x11a))/0x3+parseInt(_0x3c7d50(0xed))/0x4*(parseInt(_0x3c7d50(0x102))/0x5)+parseInt(_0x3c7d50(0xec))/0x6+-parseInt(_0x3c7d50(0x126))/0x7+parseInt(_0x3c7d50(0x124))/0x8;if(_0x28a35a===_0x156597)break;else _0x2f1cd9['push'](_0x2f1cd9['shift']());}catch(_0x31968a){_0x2f1cd9['push'](_0x2f1cd9['shift']());}}}(a371_0x347a,0x9f7c7));const a371_0x381a33=(function(){let _0x20466a=!![];return function(_0x566a2a,_0x72a3c2){const _0xda5373=_0x20466a?function(){const _0x57ffe0=a371_0x4e19;if(_0x72a3c2){const _0x15b1c8=_0x72a3c2[_0x57ffe0(0x120)](_0x566a2a,arguments);return _0x72a3c2=null,_0x15b1c8;}}:function(){};return _0x20466a=![],_0xda5373;};}()),a371_0x2e89fd=a371_0x381a33(this,function(){const _0x3a7514=a371_0x4e19;return a371_0x2e89fd['toString']()[_0x3a7514(0x108)](_0x3a7514(0x10b))['toString']()[_0x3a7514(0xf2)](a371_0x2e89fd)[_0x3a7514(0x108)](_0x3a7514(0x10b));});function a371_0x4e19(_0x5f0513,_0x1eb189){const _0x5c1cf6=a371_0x347a();return a371_0x4e19=function(_0x2e89fd,_0x381a33){_0x2e89fd=_0x2e89fd-0xea;let _0x347af9=_0x5c1cf6[_0x2e89fd];return _0x347af9;},a371_0x4e19(_0x5f0513,_0x1eb189);}a371_0x2e89fd();'use strict';function a371_0x347a(){const _0x3eb137=['instanceUrl','15516632xaLtWt','Controller','5801285ZILGmS','1173754mfPIcE','./services/rollback.service','temp/veeva/deploy_','body','design:type','./classes/auth/salesforce-auth','v1.1','metadata','execute','./classes/auth/veeva-auth','finally','AppResponseStatus','length','919320YRNumx','121852eLDIIl','./services/deploy.service','doSnapshot','Logger','./enums/status.enums','constructor','getMessages','SalesforceAuth','__esModule','prototype','rollback','makeDir','SUCCESS','getAuthDetails','FAILURE','function','VeevaAuth','dependency','1210655FbGSgD','deployFromBranch','message','35VoFOTl','getOwnPropertyDescriptor','./classes/loggers/logger','./utils/fs-util','defineProperty','createSalesforceRequest','search','__importDefault','join','(((.+)+)+)+$','fs/promises','./services/dependency.service','./utils/veeva-request.utils','Version','./utils/salesforce-request.utils','Post','default','then','VeevaVaultController','param','object','decorate','design:paramtypes','BaseVeevaError','2920506QgjDZv','RollbackService','retrieveDependency','./services/snapshot.service','createVeevaRequest','shortid','apply','design:returntype','deploy'];a371_0x347a=function(){return _0x3eb137;};return a371_0x347a();}var __decorate=this&&this['__decorate']||function(_0x37321a,_0x5d8c31,_0x450a7b,_0x2063d1){const _0x292612=a371_0x4e19;var _0x3a1a39=arguments[_0x292612(0xeb)],_0x475955=_0x3a1a39<0x3?_0x5d8c31:_0x2063d1===null?_0x2063d1=Object[_0x292612(0x103)](_0x5d8c31,_0x450a7b):_0x2063d1,_0x95ba57;if(typeof Reflect===_0x292612(0x116)&&typeof Reflect[_0x292612(0x117)]===_0x292612(0xfc))_0x475955=Reflect[_0x292612(0x117)](_0x37321a,_0x5d8c31,_0x450a7b,_0x2063d1);else{for(var _0x33ffe6=_0x37321a[_0x292612(0xeb)]-0x1;_0x33ffe6>=0x0;_0x33ffe6--)if(_0x95ba57=_0x37321a[_0x33ffe6])_0x475955=(_0x3a1a39<0x3?_0x95ba57(_0x475955):_0x3a1a39>0x3?_0x95ba57(_0x5d8c31,_0x450a7b,_0x475955):_0x95ba57(_0x5d8c31,_0x450a7b))||_0x475955;}return _0x3a1a39>0x3&&_0x475955&&Object['defineProperty'](_0x5d8c31,_0x450a7b,_0x475955),_0x475955;},__metadata=this&&this['__metadata']||function(_0x2e3915,_0x4363e3){const _0x361feb=a371_0x4e19;if(typeof Reflect==='object'&&typeof Reflect[_0x361feb(0x12e)]==='function')return Reflect['metadata'](_0x2e3915,_0x4363e3);},__param=this&&this['__param']||function(_0x51aed3,_0xdd7c62){return function(_0x2e4c82,_0x2efaa8){_0xdd7c62(_0x2e4c82,_0x2efaa8,_0x51aed3);};},__importDefault=this&&this[a371_0x18270c(0x109)]||function(_0x2f32e2){const _0x150545=a371_0x18270c;return _0x2f32e2&&_0x2f32e2[_0x150545(0xf5)]?_0x2f32e2:{'default':_0x2f32e2};};Object[a371_0x18270c(0x106)](exports,a371_0x18270c(0xf5),{'value':!![]}),exports[a371_0x18270c(0x114)]=void 0x0;const core_1=require('../../core'),dependency_service_1=require(a371_0x18270c(0x10d)),snapshot_service_1=require(a371_0x18270c(0x11d)),deploy_service_1=require(a371_0x18270c(0xee)),veeva_request_utils_1=require(a371_0x18270c(0x10e)),status_enums_1=require(a371_0x18270c(0xf1)),shortid_1=__importDefault(require(a371_0x18270c(0x11f))),fs_util_1=require(a371_0x18270c(0x105)),logger_1=require(a371_0x18270c(0x104)),promises_1=require(a371_0x18270c(0x10c)),base_veeva_error_1=require('./classes/errors/base-veeva-error'),salesforce_request_utils_1=require(a371_0x18270c(0x110)),veeva_auth_1=require(a371_0x18270c(0x130)),salesforce_auth_1=require(a371_0x18270c(0x12c)),rollback_service_1=require(a371_0x18270c(0x128)),JOB_UPDATE_TOKEN_ATTEMPTS=0x1;let VeevaVaultController=class VeevaVaultController{async[a371_0x18270c(0xef)](_0x4df3ad){const _0x9fbe17=a371_0x18270c,{veevaAuth:_0x3ddc18,timeZone:_0x5163c5,attachmentLogId:_0x23ae06}=_0x4df3ad;try{const _0x2c5a7f=(0x0,veeva_request_utils_1['createVeevaRequest'])(new veeva_auth_1[(_0x9fbe17(0xfd))](_0x3ddc18,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x5a515f=await salesforce_auth_1[_0x9fbe17(0xf4)][_0x9fbe17(0xfa)](),_0x39ca90=(0x0,salesforce_request_utils_1[_0x9fbe17(0x107)])(new salesforce_auth_1['SalesforceAuth'](_0x5a515f)),_0x37ea82=new logger_1[(_0x9fbe17(0xf0))](_0x39ca90,_0x5163c5,_0x23ae06),_0x2e395d=new snapshot_service_1['SnapshotService'](_0x4df3ad,_0x39ca90,_0x2c5a7f,_0x37ea82);return _0x2e395d[_0x9fbe17(0x12f)]()[_0x9fbe17(0x113)](),{'responseStatus':status_enums_1[_0x9fbe17(0xea)][_0x9fbe17(0xf9)]};}catch(_0x5058cc){return{'responseStatus':status_enums_1[_0x9fbe17(0xea)][_0x9fbe17(0xfb)],'responseMessage':_0x5058cc[_0x9fbe17(0x101)]};}}async[a371_0x18270c(0x100)](_0x29aef5){const _0x9ce63d=a371_0x18270c,{veevaAuth:_0x5e3027,timeZone:_0x227317,attachmentLogId:_0x5c1bc4}=_0x29aef5;try{const _0x40a386=(0x0,veeva_request_utils_1[_0x9ce63d(0x11e)])(new veeva_auth_1[(_0x9ce63d(0xfd))](_0x5e3027,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x2e3e42=await salesforce_auth_1[_0x9ce63d(0xf4)][_0x9ce63d(0xfa)](),_0x81d66b=(0x0,salesforce_request_utils_1[_0x9ce63d(0x107)])(new salesforce_auth_1[(_0x9ce63d(0xf4))](_0x2e3e42)),_0x46ae6b=new logger_1['Logger'](_0x81d66b,_0x227317,_0x5c1bc4),_0x5831b7=_0x9ce63d(0x129)+(0x0,shortid_1[_0x9ce63d(0x112)])();await(0x0,fs_util_1['makeDir'])(_0x5831b7);const _0x571177=new deploy_service_1['DeployService'](_0x29aef5,_0x81d66b,_0x40a386,_0x46ae6b,_0x5831b7,_0x2e3e42[_0x9ce63d(0x123)]);return _0x571177[_0x9ce63d(0x12f)]()[_0x9ce63d(0x131)](()=>(0x0,promises_1['rm'])(_0x5831b7,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x9ce63d(0xea)][_0x9ce63d(0xf9)]};}catch(_0x2e77c7){return{'responseStatus':status_enums_1['AppResponseStatus'][_0x9ce63d(0xfb)],'responseMessage':_0x2e77c7[_0x9ce63d(0x101)]};}}async[a371_0x18270c(0x11c)](_0x48953f){const _0x56a6de=a371_0x18270c,{veevaAuth:_0x36e5e6}=_0x48953f;try{const _0x4f53a3=(0x0,veeva_request_utils_1[_0x56a6de(0x11e)])(new veeva_auth_1['VeevaAuth'](_0x36e5e6)),_0x2be9b8=await salesforce_auth_1[_0x56a6de(0xf4)][_0x56a6de(0xfa)](),_0x25534a=(0x0,salesforce_request_utils_1[_0x56a6de(0x107)])(new salesforce_auth_1[(_0x56a6de(0xf4))](_0x2be9b8)),_0x4202c8=new dependency_service_1['DependencyService'](_0x48953f,_0x25534a,_0x4f53a3);return await _0x4202c8[_0x56a6de(0x12f)]();}catch(_0x56b575){const _0x51d4ca=_0x56b575 instanceof base_veeva_error_1[_0x56a6de(0x119)]?_0x56b575[_0x56a6de(0xf3)]()[_0x56a6de(0x10a)]('\x0a'):_0x56b575[_0x56a6de(0x101)];return{'responseStatus':status_enums_1[_0x56a6de(0xea)]['FAILURE'],'responseMessage':_0x51d4ca};}}async[a371_0x18270c(0xf7)](_0x4cb1b1){const _0x2decf9=a371_0x18270c,{veevaAuth:_0x307f47,timeZone:_0x144ea8,attachmentLogId:_0x327fee}=_0x4cb1b1;try{const _0x108a72=(0x0,veeva_request_utils_1[_0x2decf9(0x11e)])(new veeva_auth_1[(_0x2decf9(0xfd))](_0x307f47,JOB_UPDATE_TOKEN_ATTEMPTS)),_0x592621=await salesforce_auth_1[_0x2decf9(0xf4)]['getAuthDetails'](),_0xd1508b=(0x0,salesforce_request_utils_1[_0x2decf9(0x107)])(new salesforce_auth_1[(_0x2decf9(0xf4))](_0x592621)),_0x3c5f90=new logger_1[(_0x2decf9(0xf0))](_0xd1508b,_0x144ea8,_0x327fee),_0x1ebffc='temp/veeva/rollback_'+(0x0,shortid_1['default'])();await(0x0,fs_util_1[_0x2decf9(0xf8)])(_0x1ebffc);const _0x2cfad0=new rollback_service_1[(_0x2decf9(0x11b))]({..._0x4cb1b1,'connectionVeeva':_0x108a72,'connectionSalesforce':_0xd1508b,'logger':_0x3c5f90,'tempFolder':_0x1ebffc,'instanceUrl':_0x592621[_0x2decf9(0x123)]});return _0x2cfad0[_0x2decf9(0x12f)]()[_0x2decf9(0x131)](()=>(0x0,promises_1['rm'])(_0x1ebffc,{'recursive':!![],'force':!![]})),{'responseStatus':status_enums_1[_0x2decf9(0xea)][_0x2decf9(0xf9)]};}catch(_0x745a5f){return{'responseStatus':status_enums_1[_0x2decf9(0xea)][_0x2decf9(0xfb)],'responseMessage':_0x745a5f[_0x2decf9(0x101)]};}}};__decorate([(0x0,core_1['Post'])('snapshot'),__param(0x0,core_1[a371_0x18270c(0x115)][a371_0x18270c(0x12a)]()),__metadata(a371_0x18270c(0x12b),Function),__metadata(a371_0x18270c(0x118),[Object]),__metadata('design:returntype',Promise)],VeevaVaultController[a371_0x18270c(0xf6)],a371_0x18270c(0xef),null),__decorate([(0x0,core_1['Post'])(a371_0x18270c(0x122)),__param(0x0,core_1['param']['body']()),__metadata(a371_0x18270c(0x12b),Function),__metadata(a371_0x18270c(0x118),[Object]),__metadata(a371_0x18270c(0x121),Promise)],VeevaVaultController['prototype'],a371_0x18270c(0x100),null),__decorate([(0x0,core_1[a371_0x18270c(0x111)])(a371_0x18270c(0xfe)),__param(0x0,core_1['param'][a371_0x18270c(0x12a)]()),__metadata(a371_0x18270c(0x12b),Function),__metadata('design:paramtypes',[Object]),__metadata(a371_0x18270c(0x121),Promise)],VeevaVaultController[a371_0x18270c(0xf6)],a371_0x18270c(0x11c),null),__decorate([(0x0,core_1['Post'])(a371_0x18270c(0xf7)),__param(0x0,core_1[a371_0x18270c(0x115)][a371_0x18270c(0x12a)]()),__metadata('design:type',Function),__metadata(a371_0x18270c(0x118),[Object]),__metadata(a371_0x18270c(0x121),Promise)],VeevaVaultController[a371_0x18270c(0xf6)],a371_0x18270c(0xf7),null),VeevaVaultController=__decorate([(0x0,core_1[a371_0x18270c(0x125)])('veeva-vault'),(0x0,core_1[a371_0x18270c(0x10f)])(a371_0x18270c(0x12d))],VeevaVaultController),exports[a371_0x18270c(0x114)]=VeevaVaultController;