const a310_0x5e1459=a310_0x545c;(function(_0x40c9e7,_0x3eebce){const _0x1e1830=a310_0x545c,_0x2d0bf9=_0x40c9e7();while(!![]){try{const _0x4bb3f2=parseInt(_0x1e1830(0x1b6))/0x1+parseInt(_0x1e1830(0x162))/0x2+-parseInt(_0x1e1830(0x175))/0x3+-parseInt(_0x1e1830(0x21c))/0x4+parseInt(_0x1e1830(0x159))/0x5*(-parseInt(_0x1e1830(0x1e2))/0x6)+-parseInt(_0x1e1830(0x1ae))/0x7*(-parseInt(_0x1e1830(0x1f5))/0x8)+-parseInt(_0x1e1830(0x1bd))/0x9*(parseInt(_0x1e1830(0x18d))/0xa);if(_0x4bb3f2===_0x3eebce)break;else _0x2d0bf9['push'](_0x2d0bf9['shift']());}catch(_0x577d63){_0x2d0bf9['push'](_0x2d0bf9['shift']());}}}(a310_0x1f3e,0x6a117));function a310_0x545c(_0x3fc2bb,_0x24a859){const _0x3b4fa2=a310_0x1f3e();return a310_0x545c=function(_0x5c45f3,_0x3fa103){_0x5c45f3=_0x5c45f3-0x158;let _0x1f3e2e=_0x3b4fa2[_0x5c45f3];return _0x1f3e2e;},a310_0x545c(_0x3fc2bb,_0x24a859);}const a310_0x3fa103=(function(){let _0x1d8bb7=!![];return function(_0x3fbe73,_0x121624){const _0x2e8336=_0x1d8bb7?function(){if(_0x121624){const _0xe243a6=_0x121624['apply'](_0x3fbe73,arguments);return _0x121624=null,_0xe243a6;}}:function(){};return _0x1d8bb7=![],_0x2e8336;};}()),a310_0x5c45f3=a310_0x3fa103(this,function(){const _0x140b42=a310_0x545c;return a310_0x5c45f3['toString']()[_0x140b42(0x1c4)]('(((.+)+)+)+$')[_0x140b42(0x1d5)]()['constructor'](a310_0x5c45f3)[_0x140b42(0x1c4)](_0x140b42(0x1eb));});a310_0x5c45f3();'use strict';var __importDefault=this&&this[a310_0x5e1459(0x206)]||function(_0x4ca0be){return _0x4ca0be&&_0x4ca0be['__esModule']?_0x4ca0be:{'default':_0x4ca0be};};Object[a310_0x5e1459(0x17b)](exports,a310_0x5e1459(0x179),{'value':!![]}),exports[a310_0x5e1459(0x1c2)]=void 0x0;const jszip_1=__importDefault(require(a310_0x5e1459(0x1db))),form_data_1=__importDefault(require(a310_0x5e1459(0x201))),fs_1=require('fs'),promises_1=require(a310_0x5e1459(0x1e6)),constants_1=require(a310_0x5e1459(0x213)),flosum_constants_1=require(a310_0x5e1459(0x200)),veeva_constants_1=require(a310_0x5e1459(0x209)),veeva_service_1=require('./veeva.service'),component_dto_1=require(a310_0x5e1459(0x1da)),job_result_dto_1=require(a310_0x5e1459(0x1ec)),package_component_dto_1=require(a310_0x5e1459(0x1df)),salesforce_service_1=require(a310_0x5e1459(0x226)),core_1=require('../../../core'),status_enums_1=require(a310_0x5e1459(0x1fa)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),veeva_error_1=require(a310_0x5e1459(0x1bc)),shortid_1=__importDefault(require(a310_0x5e1459(0x1f6))),veeva_auth_utils_1=require(a310_0x5e1459(0x19b)),xml2js_1=require('xml2js'),fetch_attachments_1=require(a310_0x5e1459(0x197));class DeployService{constructor(_0x118199,_0x1e2fff,_0x3688c1,_0x18a879,_0x32e029,_0x545ee1){const _0x2bed34=a310_0x5e1459;this[_0x2bed34(0x1ed)]=_0x1e2fff,this['_connectionVeeva']=_0x3688c1,this[_0x2bed34(0x16d)]=_0x18a879,this['_tempFolder']=_0x32e029,this[_0x2bed34(0x196)]=_0x545ee1,this['_branchId']=_0x118199[_0x2bed34(0x158)],this['_metadataLogId']=_0x118199[_0x2bed34(0x20b)],this['_attachmentLogId']=_0x118199[_0x2bed34(0x1ad)],this['_organisationId']=_0x118199[_0x2bed34(0x20f)],this[_0x2bed34(0x20c)]=_0x118199['timeZone'],this[_0x2bed34(0x228)]=_0x118199[_0x2bed34(0x1e9)],this[_0x2bed34(0x20e)]=_0x118199[_0x2bed34(0x219)],this['_deploymentName']=_0x118199['deploymentName'],this['_systemLogger']=new core_1['Logger']('veeva-deploy');}async[a310_0x5e1459(0x22a)](){const _0x27264e=a310_0x5e1459;try{const _0x3dc3b3=await this[_0x27264e(0x210)](),_0x3f50ba=await this[_0x27264e(0x1d6)](_0x3dc3b3),_0x4442d6=await this[_0x27264e(0x202)](_0x3f50ba),_0x377bd1=await this[_0x27264e(0x15e)](_0x4442d6);await this[_0x27264e(0x203)](_0x377bd1);const _0x2a9032=await this[_0x27264e(0x1d8)](_0x377bd1),_0x2789c9=await this[_0x27264e(0x222)](_0x2a9032);await this[_0x27264e(0x1c7)](_0x2789c9);const _0xa0ea90=await this[_0x27264e(0x221)](_0x2789c9[_0x27264e(0x19e)]),_0x421cdb=await this[_0x27264e(0x222)](_0xa0ea90);await this[_0x27264e(0x184)](_0x421cdb);const _0x14fbb9=this[_0x27264e(0x188)](_0x3dc3b3,_0x421cdb[_0x27264e(0x1e8)]);await this[_0x27264e(0x1cd)](_0x14fbb9),await this['finishDeploy'](_0x421cdb[_0x27264e(0x165)],![],_0x2789c9[_0x27264e(0x19e)]);}catch(_0x1aad1f){await this[_0x27264e(0x1a5)](_0x1aad1f)[_0x27264e(0x215)](_0x357632=>this[_0x27264e(0x191)][_0x27264e(0x169)](_0x357632));}}async[a310_0x5e1459(0x210)](){const _0x5663d6=a310_0x5e1459,_0xaff67b=new Set(this['_componentIdList']);this[_0x5663d6(0x16d)][_0x5663d6(0x1f0)]('Retrieving\x20components');const _0x4e55d3=_0x5663d6(0x1c9)+constants_1[_0x5663d6(0x1e1)]+_0x5663d6(0x170)+constants_1['FLOSUM_NAMESPACE']+'Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20'+constants_1[_0x5663d6(0x1e1)]+_0x5663d6(0x186)+constants_1[_0x5663d6(0x1e1)]+_0x5663d6(0x1a3)+constants_1['FLOSUM_NAMESPACE']+_0x5663d6(0x171)+constants_1[_0x5663d6(0x1e1)]+_0x5663d6(0x1ac)+this[_0x5663d6(0x16b)]+'\x27',_0x5cc092=await salesforce_service_1[_0x5663d6(0x212)][_0x5663d6(0x1cc)](this['_connectionSalesforce'],_0x4e55d3);if(!_0x5cc092[_0x5663d6(0x1c8)])throw new Error(_0x5663d6(0x217));const _0x21ad01=_0x5cc092[_0x5663d6(0x1cf)](_0xc06ac5=>new component_dto_1['ComponentDto'](_0xc06ac5))[_0x5663d6(0x19a)](_0x2bb896=>_0xaff67b['has'](_0x2bb896['id']));if(_0x21ad01[_0x5663d6(0x1c8)]!==this[_0x5663d6(0x20e)][_0x5663d6(0x1c8)])throw new Error('Cannot\x20retrieve\x20all\x20components.');return _0x21ad01;}async[a310_0x5e1459(0x1d6)](_0xba38de){const _0x358976=a310_0x5e1459;this['_logger'][_0x358976(0x1f0)](_0x358976(0x173));const _0x182bc0=await(0x0,fetch_attachments_1[_0x358976(0x225)])(this[_0x358976(0x1ed)],_0xba38de[_0x358976(0x1cf)](_0x20bff3=>_0x20bff3[_0x358976(0x1b4)])),_0x85ea88=await(0x0,fetch_attachments_1[_0x358976(0x1d6)])(_0x182bc0,this[_0x358976(0x1ed)]);if(_0x85ea88[_0x358976(0x1c8)]!==this[_0x358976(0x20e)][_0x358976(0x1c8)])throw new Error(_0x358976(0x1c6));return _0x85ea88[_0x358976(0x1cf)](_0x2d91c8=>_0x2d91c8['values'][_0x358976(0x1ca)]);}async['joinAllAttachments'](_0x48d001){const _0x22176f=a310_0x5e1459;var _0x3d680c;this['_logger'][_0x22176f(0x1f0)](_0x22176f(0x1f4));const _0x3436a8=new jszip_1[(_0x22176f(0x185))]();for(const _0x5b71da of _0x48d001){const _0x3dcb91=new jszip_1[(_0x22176f(0x185))]();await _0x3dcb91[_0x22176f(0x216)](_0x5b71da,{'base64':!![]});for(const _0x5db529 in _0x3dcb91[_0x22176f(0x1e3)]){const _0x559394=await((_0x3d680c=_0x3dcb91[_0x22176f(0x17f)](_0x5db529))===null||_0x3d680c===void 0x0?void 0x0:_0x3d680c[_0x22176f(0x199)](_0x22176f(0x192)));_0x559394&&_0x3436a8[_0x22176f(0x17f)](_0x5db529,_0x559394);}}const _0xf15c3c=new xml2js_1[(_0x22176f(0x1a1))]({'headless':!![]}),_0x3a0b39={'vaultpackage':{'$':{'xmlns':_0x22176f(0x1e4)},'name':this[_0x22176f(0x17a)],'source':{'vault':undefined,'author':_0x22176f(0x1a2)},'packagetype':_0x22176f(0x207),'summary':'Deploy','description':_0x22176f(0x1ba)}};_0x3436a8[_0x22176f(0x17f)](_0x22176f(0x163),_0xf15c3c[_0x22176f(0x16c)](_0x3a0b39));const _0x3bc678=this[_0x22176f(0x1b2)]+'/'+(0x0,shortid_1[_0x22176f(0x185)])()+_0x22176f(0x21e),_0x432b02=await _0x3436a8[_0x22176f(0x182)]({'type':_0x22176f(0x15d)});return await(0x0,promises_1[_0x22176f(0x21f)])(_0x3bc678,_0x432b02),_0x3bc678;}async['generateVPK'](_0x561848,_0x2d96e1=0x1){const _0x2b7b3e=a310_0x5e1459;var _0x1a7a34;this[_0x2b7b3e(0x16d)][_0x2b7b3e(0x1f0)]('Generate\x20vpk\x20package');const _0x1c4103=new form_data_1[(_0x2b7b3e(0x185))]();_0x1c4103[_0x2b7b3e(0x15b)](_0x2b7b3e(0x17f),(0x0,fs_1[_0x2b7b3e(0x1a4)])(_0x561848));const _0x1f197e=await this['_connectionVeeva'][_0x2b7b3e(0x190)](veeva_constants_1[_0x2b7b3e(0x1fb)][_0x2b7b3e(0x16a)],_0x1c4103,{'responseType':'arraybuffer','headers':{'Content-Type':'multipart/form-data'}}),_0xb10cf2=(_0x1a7a34=_0x1f197e['headers'][_0x2b7b3e(0x1c3)])===null||_0x1a7a34===void 0x0?void 0x0:_0x1a7a34[_0x2b7b3e(0x19f)](_0x2b7b3e(0x168));if(!_0xb10cf2){const _0x5202ee=_0x1f197e['data'],_0x5edc9a=this[_0x2b7b3e(0x1b2)]+_0x2b7b3e(0x1d0)+_0x561848[_0x2b7b3e(0x204)](_0x561848[_0x2b7b3e(0x1e7)]('/')+0x1);return await(0x0,promises_1[_0x2b7b3e(0x21f)])(_0x5edc9a,_0x5202ee),_0x5edc9a;}else{const _0x1f4a41=JSON['parse'](_0x1f197e['data']);if(_0x2d96e1>0x0)return await(0x0,veeva_auth_utils_1[_0x2b7b3e(0x166)])(this[_0x2b7b3e(0x16e)]),await this[_0x2b7b3e(0x15e)](_0x561848,_0x2d96e1-0x1);throw new veeva_error_1[(_0x2b7b3e(0x1fc))](_0x1f4a41['errors']);}}async[a310_0x5e1459(0x203)](_0x45ee8e,_0x1e1e41=0x1){const _0x3505a6=a310_0x5e1459;this[_0x3505a6(0x16d)][_0x3505a6(0x1f0)](_0x3505a6(0x195));const _0x1958eb=new form_data_1['default']();_0x1958eb['append'](_0x3505a6(0x17f),(0x0,fs_1[_0x3505a6(0x1a4)])(_0x45ee8e));const _0xafbbdf=await this[_0x3505a6(0x16e)]['post'](veeva_constants_1[_0x3505a6(0x1fb)]['ENDPOINT_VALIDATE_PACKAGE'],_0x1958eb,{'headers':{'Content-Type':_0x3505a6(0x1f3)}}),_0x44fb64=_0xafbbdf['data'];if(_0x44fb64[_0x3505a6(0x223)]===status_enums_1[_0x3505a6(0x1d3)][_0x3505a6(0x214)])return _0x44fb64;else{if(_0x1e1e41>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x3505a6(0x16e)]),await this[_0x3505a6(0x203)](_0x45ee8e,_0x1e1e41-0x1);throw new veeva_error_1[(_0x3505a6(0x1fc))](_0x44fb64[_0x3505a6(0x15c)]);}}async['importVpk'](_0x410444,_0x1f648c=0x1){const _0x983743=a310_0x5e1459;this[_0x983743(0x16d)][_0x983743(0x1f0)](_0x983743(0x161));const _0x4317df=new form_data_1[(_0x983743(0x185))]();_0x4317df['append'](_0x983743(0x17f),(0x0,fs_1[_0x983743(0x1a4)])(_0x410444));const _0x1cfb76=await this[_0x983743(0x16e)]['put'](veeva_constants_1['VeevaConstants']['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x4317df,{'headers':{'Content-Type':'multipart/form-data'}}),_0x3065cc=_0x1cfb76[_0x983743(0x194)];if(_0x3065cc[_0x983743(0x223)]===status_enums_1[_0x983743(0x1d3)][_0x983743(0x214)])return _0x3065cc[_0x983743(0x1b0)];else{if(_0x1f648c>0x0)return await(0x0,veeva_auth_utils_1[_0x983743(0x166)])(this[_0x983743(0x16e)]),await this[_0x983743(0x1d8)](_0x410444,_0x1f648c-0x1);throw new veeva_error_1['VeevaError'](_0x3065cc[_0x983743(0x15c)]);}}async['deployPackage'](_0x396d1f){const _0x20bbf6=a310_0x5e1459;this[_0x20bbf6(0x16d)][_0x20bbf6(0x1f0)](_0x20bbf6(0x218));const _0xe06083=await this['_connectionVeeva']['post'](veeva_constants_1['VeevaConstants'][_0x20bbf6(0x229)]['replace']('{package_id}',_0x396d1f)),_0xa35e33=await _0xe06083[_0x20bbf6(0x194)];if(_0xa35e33[_0x20bbf6(0x223)]===status_enums_1[_0x20bbf6(0x1d3)][_0x20bbf6(0x214)])return _0xa35e33['url'];else throw new veeva_error_1[(_0x20bbf6(0x1fc))](_0xa35e33[_0x20bbf6(0x15c)]);}async['getJobStatus'](_0x5bc0e6){const _0x18556a=a310_0x5e1459;this['_logger'][_0x18556a(0x1f0)](_0x18556a(0x1cb));const _0x4fe1b2=new job_result_dto_1[(_0x18556a(0x1c1))](),[_0x1fb30f]=await veeva_service_1[_0x18556a(0x17c)]['getJobResult']([_0x5bc0e6],this[_0x18556a(0x16e)],this[_0x18556a(0x16d)]);return _0x4fe1b2[_0x18556a(0x1f8)]=_0x1fb30f[_0x18556a(0x1fe)]===status_enums_1[_0x18556a(0x1aa)]['SUCCESS'],_0x4fe1b2['detailUrl']=_0x1fb30f[_0x18556a(0x1ab)][_0x18556a(0x1b1)](_0x5eebc3=>_0x5eebc3[_0x18556a(0x174)]==='artifacts')[_0x18556a(0x1f1)],_0x4fe1b2;}async['getValidationDetailsAndSaveLog'](_0x3625f7){const _0x353efa=a310_0x5e1459;this[_0x353efa(0x16d)][_0x353efa(0x1f0)]('Get\x20validation\x20details.');const {data:_0x9f8388}=await this[_0x353efa(0x16e)][_0x353efa(0x167)](_0x3625f7[_0x353efa(0x15f)]);if(_0x9f8388[_0x353efa(0x223)]===status_enums_1[_0x353efa(0x1d3)][_0x353efa(0x214)]){const {log:_0x567512,id:_0x2f82b4,package_status:_0x52ccb4}=_0x9f8388['vaultPackage'],_0x47c233=_0x567512[_0x353efa(0x19a)](_0x4fa313=>_0x4fa313[_0x353efa(0x1d7)][_0x353efa(0x21d)](_0x353efa(0x1ff))),_0x150c11=await this[_0x353efa(0x1d2)](_0x47c233[0x0][_0x353efa(0x1b0)]);await this['saveLog'](_0x150c11,_0x353efa(0x224)),_0x3625f7[_0x353efa(0x19e)]=_0x2f82b4;if(_0x52ccb4!==status_enums_1[_0x353efa(0x20a)][_0x353efa(0x1bb)])throw new Error('Package\x20not\x20verified');}else throw new veeva_error_1[(_0x353efa(0x1fc))](_0x9f8388['errors']);}async[a310_0x5e1459(0x184)](_0x71aa47){const _0x47a69c=a310_0x5e1459;this['_logger'][_0x47a69c(0x1f0)](_0x47a69c(0x1fd));const {data:_0x4e1c3b}=await this[_0x47a69c(0x16e)][_0x47a69c(0x167)](_0x71aa47[_0x47a69c(0x15f)]);if(_0x4e1c3b[_0x47a69c(0x223)]===status_enums_1['VeevaResponseStatus'][_0x47a69c(0x214)]){const {responseDetails:{deployment_log:_0x4854bc,package_status__v:_0x281d26},package_steps:_0x104f88}=_0x4e1c3b,_0x38204a=_0x4854bc['filter'](_0x42f923=>_0x42f923[_0x47a69c(0x1d7)][_0x47a69c(0x21d)](_0x47a69c(0x18a))),_0x1ba34d=await this[_0x47a69c(0x1d2)](_0x38204a[0x0][_0x47a69c(0x1b0)]);await this[_0x47a69c(0x1dd)](_0x1ba34d,_0x47a69c(0x18e)),_0x71aa47[_0x47a69c(0x165)]=[status_enums_1[_0x47a69c(0x20a)][_0x47a69c(0x19c)],status_enums_1[_0x47a69c(0x20a)][_0x47a69c(0x1b9)]][_0x47a69c(0x19f)](_0x281d26);const _0x35c187=this['formPackageComponentList'](_0x104f88);_0x71aa47[_0x47a69c(0x1e8)]=_0x35c187[_0x47a69c(0x19a)](_0x34bdaf=>_0x34bdaf['status']!==status_enums_1[_0x47a69c(0x16f)][_0x47a69c(0x1bb)]);if(!_0x71aa47[_0x47a69c(0x1e8)][_0x47a69c(0x1c8)])throw new Error(_0x47a69c(0x205));}else throw new veeva_error_1[(_0x47a69c(0x1fc))](_0x4e1c3b[_0x47a69c(0x15c)]);}async[a310_0x5e1459(0x1d2)](_0x466ca1){const _0x38d083=a310_0x5e1459,{data:_0x2e55bb}=await this[_0x38d083(0x16e)][_0x38d083(0x167)](_0x466ca1,{'responseType':'text'});return _0x2e55bb;}[a310_0x5e1459(0x1ce)](_0x14bb10){return _0x14bb10['reduce']((_0xb17c74,_0x2aa26e)=>{const _0x44481d=a310_0x545c,_0x5e1330=_0x2aa26e[_0x44481d(0x1d1)][_0x44481d(0x1cf)](_0x4d8afb=>new package_component_dto_1[(_0x44481d(0x180))](_0x4d8afb,_0x2aa26e['deployment_status__v']));return[..._0xb17c74,..._0x5e1330];},[]);}async['saveLog'](_0x1b571a,_0x354c75){const _0x1400b0=a310_0x5e1459;this[_0x1400b0(0x16d)][_0x1400b0(0x1f0)]('Save\x20log');const _0x5a2eae={'Body':Buffer[_0x1400b0(0x1f2)](_0x1b571a)[_0x1400b0(0x1d5)]('base64'),'ContentType':_0x1400b0(0x1b3),'ParentId':this['_metadataLogId'],'Name':_0x354c75},{data:_0x2da6a2}=await this[_0x1400b0(0x1ed)][_0x1400b0(0x190)](flosum_constants_1['FlosumConstants']['ENDPOINT_UPSERT_RECORD']+_0x1400b0(0x172),_0x5a2eae);return _0x2da6a2['id'];}['formFlosumDeploymentResults'](_0x2860b3,_0x55df8b){const _0x42721d=a310_0x5e1459;this['_logger'][_0x42721d(0x1f0)](_0x42721d(0x1ef));const _0xe76aad=_0x2860b3[_0x42721d(0x1be)]((_0x335c73,_0x35fb97)=>_0x335c73[_0x42721d(0x21b)]((_0x35fb97['componentType']+'.'+_0x35fb97[_0x42721d(0x1de)])[_0x42721d(0x1a7)](),_0x35fb97),new Map());return _0x55df8b[_0x42721d(0x1cf)](_0xd27bfd=>{const _0x178ed9=_0x42721d;this['_logger']['log'](_0xd27bfd[_0x178ed9(0x1af)]+'.'+_0xd27bfd['name']+_0x178ed9(0x1a6)+_0xd27bfd[_0x178ed9(0x1fe)]);const _0x498c5b=(_0xd27bfd[_0x178ed9(0x1af)]+'.'+_0xd27bfd[_0x178ed9(0x227)])[_0x178ed9(0x1a7)](),_0x288fa3=_0xe76aad['get'](_0x498c5b);return{[constants_1[_0x178ed9(0x1e1)]+_0x178ed9(0x1ea)]:_0x178ed9(0x176),[constants_1['FLOSUM_NAMESPACE']+_0x178ed9(0x1a8)]:_0xd27bfd['status']===status_enums_1[_0x178ed9(0x16f)]['DEPLOYED']?_0x178ed9(0x1e5):'Failure',[constants_1[_0x178ed9(0x1e1)]+'Result__c']:_0x178ed9(0x1b5),[constants_1[_0x178ed9(0x1e1)]+_0x178ed9(0x1e0)]:_0xd27bfd[_0x178ed9(0x227)],[constants_1[_0x178ed9(0x1e1)]+'Component_Type__c']:_0xd27bfd[_0x178ed9(0x1af)],[constants_1[_0x178ed9(0x1e1)]+_0x178ed9(0x1d9)]:this[_0x178ed9(0x20d)],[constants_1[_0x178ed9(0x1e1)]+'Metadata_Log__c']:this[_0x178ed9(0x220)],[constants_1[_0x178ed9(0x1e1)]+_0x178ed9(0x198)]:_0x288fa3[_0x178ed9(0x1b4)]};});}async[a310_0x5e1459(0x1cd)](_0x11dc7f){const _0x41afa0=a310_0x5e1459;this[_0x41afa0(0x16d)][_0x41afa0(0x1f0)](_0x41afa0(0x17e));const _0x55fc43=await salesforce_service_1[_0x41afa0(0x212)][_0x41afa0(0x18b)](this['_connectionSalesforce'],constants_1[_0x41afa0(0x1e1)]+'Deployment_Result__c',_0x11dc7f),_0x584323=_0x55fc43[_0x41afa0(0x19a)](_0x461534=>!_0x461534[_0x41afa0(0x181)])[_0x41afa0(0x1cf)](_0x30b168=>_0x30b168['errors'])[_0x41afa0(0x189)]();if(_0x584323[_0x41afa0(0x1c8)])throw new salesforce_dml_error_1[(_0x41afa0(0x187))](_0x584323);}async['finishDeployWithError'](_0xd13fe5){const _0x3091af=a310_0x5e1459;this[_0x3091af(0x16d)]['logError'](_0xd13fe5),await this['_logger']['updateLog'](),await this[_0x3091af(0x1f9)](![],!![],'');}async[a310_0x5e1459(0x1f9)](_0x1812c3,_0x133ce4,_0xe9c781){const _0x244f10=a310_0x5e1459,_0x235506=_0x244f10(0x177)+this[_0x244f10(0x196)]+'/'+this[_0x244f10(0x220)]+_0x244f10(0x1dc)+_0x244f10(0x211)+_0x244f10(0x208),_0x1eca74='<a\x20href='+this[_0x244f10(0x196)]+'/'+this[_0x244f10(0x20d)]+'\x20>'+this['_organisationName']+_0x244f10(0x21a),_0x25a36b=_0x235506+'\x20of\x20branch\x20to\x20Organization\x20'+_0x1eca74+'\x20has\x20been\x20created.',_0x5ae64f={[constants_1[_0x244f10(0x1e1)]+_0x244f10(0x15a)]:_0x25a36b,[constants_1['FLOSUM_NAMESPACE']+_0x244f10(0x1c5)]:new Date(),[constants_1[_0x244f10(0x1e1)]+_0x244f10(0x1a0)]:this['_branchId'],[constants_1[_0x244f10(0x1e1)]+'Activity_Item__c']:_0x244f10(0x17d),[constants_1[_0x244f10(0x1e1)]+'Activity_Type__c']:'Deployment',[constants_1[_0x244f10(0x1e1)]+_0x244f10(0x183)]:this['_organisationId']},_0x7b96db={[constants_1[_0x244f10(0x1e1)]+_0x244f10(0x193)]:!_0x1812c3,[constants_1[_0x244f10(0x1e1)]+_0x244f10(0x1a9)]:_0x1812c3,[constants_1[_0x244f10(0x1e1)]+_0x244f10(0x1a8)]:_0x133ce4?status_enums_1[_0x244f10(0x18f)][_0x244f10(0x1bf)]:status_enums_1[_0x244f10(0x18f)][_0x244f10(0x1b8)],[constants_1[_0x244f10(0x1e1)]+'Job_Completed__c']:!![],[constants_1[_0x244f10(0x1e1)]+_0x244f10(0x1f7)]:flosum_constants_1[_0x244f10(0x18c)]['PROCESS_DEPLOYMENT'],[constants_1[_0x244f10(0x1e1)]+_0x244f10(0x178)]:_0xe9c781};await this[_0x244f10(0x1ed)]['patch'](flosum_constants_1['FlosumConstants']['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x244f10(0x1e1)]+_0x244f10(0x1b7)+this[_0x244f10(0x220)],_0x7b96db),await this[_0x244f10(0x1ed)][_0x244f10(0x190)](flosum_constants_1[_0x244f10(0x18c)][_0x244f10(0x160)]+'/'+constants_1[_0x244f10(0x1e1)]+_0x244f10(0x1d4),_0x5ae64f),this[_0x244f10(0x16d)][_0x244f10(0x1f0)](_0x244f10(0x1ee)+(_0x1812c3?_0x244f10(0x164):_0x244f10(0x19d))+'.'),await this[_0x244f10(0x16d)][_0x244f10(0x1c0)]();}}exports[a310_0x5e1459(0x1c2)]=DeployService;function a310_0x1f3e(){const _0x12caf0=['90297vCZKYR','reduce','EXCEPTION','updateLog','JobResultDto','DeployService','content-type','search','Date__c','Cannot\x20retrieve\x20all\x20attachments','getValidationDetailsAndSaveLog','length','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Body','Wait\x20Executing\x20job','retrieveRecords','saveDeploymentResults','formPackageComponentList','map','/vpk__','package_components','getLogResultText','VeevaResponseStatus','Log__c','toString','retrieveAttachments','filename','importVpk','Org__c','../dtos/component.dto','jszip','\x20>\x20','saveLog','componentName','../dtos/package-component.dto','Component_Name__c','FLOSUM_NAMESPACE','1800YavVjd','files','https://veevavault.com/','Success','fs/promises','lastIndexOf','packageComponentList','organisationName','Type__c','(((.+)+)+)+$','../dtos/job-result.dto','_connectionSalesforce','Deploy\x20completed\x20','Form\x20Deployment\x20Results','log','href','from','multipart/form-data','Join\x20all\x20mdl\x20into\x20one\x20zip','332632DtIUfc','shortid','Process_Type__c','isSuccess','finishDeploy','../enums/status.enums','VeevaConstants','VeevaError','Get\x20deploy\x20result','status','Validation.log','../constants/flosum.constants','form-data','joinAllAttachments','validateVpk','slice','Cannot\x20find\x20deployment\x20results','__importDefault','migration__v','\x20</a>','../constants/veeva.constants','VeevaPackageStatus','metadataLogId','_timeZone','_organisationId','_componentIdList','organisationId','retrieveComponents','Veeva\x20Deployment','SalesforceService','../../../constants','SUCCESS','catch','loadAsync','Cannot\x20retrieve\x20all\x20components.','Deploy\x20package','componentIdList','</a>','set','193420AZvbWA','endsWith','.zip','writeFile','_metadataLogId','deployPackage','getJobStatus','responseStatus','Validation\x20Log','fetchAttachmentsDetailsByParentId','./salesforce.service','name','_organisationName','ENDPOINT_DEPLOY_PACKAGE','execute','branchId','1115PTqXka','Action__c','append','errors','nodebuffer','generateVPK','detailUrl','ENDPOINT_UPSERT_RECORD','Import\x20package','1600722lsIaSc','vaultpackage.xml','successfully','isDeployed','updateVeevaConnection','get','application/json','error','ENDPOINT_EXPORT_IMPORT_PACKAGE','_branchId','buildObject','_logger','_connectionVeeva','PackageComponentStatus','Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20','/Attachment','Retrieving\x20attachments','rel','1864710Anmqhx','Deployment\x20Result','<a\x20href=','Async_Request_Id__c','__esModule','_deploymentName','defineProperty','VeevaService','Branch','Save\x20Deployment\x20Results','file','PackageComponentDto','success','generateAsync','TargetId__c','getDeployDetailsAndSaveLog','default','Components__r\x20ORDER\x20BY\x20','SalesforceDmlError','formFlosumDeploymentResults','flat','Deployment.log','insertMultipleRecords','FlosumConstants','230hUjRUQ','Deploy\x20Log','MetadataLogStatus','post','_systemLogger','string','Is_Error__c','data','Validate\x20package','_instanceUrl','../../shared/utils/fetch-attachments','Component_History__c','async','filter','../utils/veeva-auth.utils','DEPLOYED','with\x20error','packageId','includes','Branch__c','Builder','Flosum','Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20','createReadStream','finishDeployWithError','\x20:\x20','toLowerCase','Status__c','Succeed__c','VeevaJobStatus','links','Branch__c\x20=\x20\x27','attachmentLogId','7ybUXYe','type','url','find','_tempFolder','text/plain','componentHistoryId','RECREATE','560099PnnoZt','Metadata_Log__c/','COMPLETED','DEPLOYED_WITH_WARNINGS','null','VERIFIED','../classes/errors/veeva-error'];a310_0x1f3e=function(){return _0x12caf0;};return a310_0x1f3e();}