const a310_0x1a77c4=a310_0x2b6a;(function(_0x3a7d8f,_0xa0029){const _0x2c0520=a310_0x2b6a,_0x3113f8=_0x3a7d8f();while(!![]){try{const _0x1f7a86=-parseInt(_0x2c0520(0x1d9))/0x1*(parseInt(_0x2c0520(0x1b7))/0x2)+parseInt(_0x2c0520(0x165))/0x3+-parseInt(_0x2c0520(0x17f))/0x4*(parseInt(_0x2c0520(0x1fd))/0x5)+parseInt(_0x2c0520(0x224))/0x6*(-parseInt(_0x2c0520(0x1cc))/0x7)+parseInt(_0x2c0520(0x1a6))/0x8*(-parseInt(_0x2c0520(0x1aa))/0x9)+parseInt(_0x2c0520(0x207))/0xa+parseInt(_0x2c0520(0x174))/0xb;if(_0x1f7a86===_0xa0029)break;else _0x3113f8['push'](_0x3113f8['shift']());}catch(_0x21c393){_0x3113f8['push'](_0x3113f8['shift']());}}}(a310_0x19c3,0x4c137));const a310_0x166105=(function(){let _0x3a41a2=!![];return function(_0x212eee,_0x362d68){const _0xc59255=_0x3a41a2?function(){const _0x317837=a310_0x2b6a;if(_0x362d68){const _0x30c768=_0x362d68[_0x317837(0x217)](_0x212eee,arguments);return _0x362d68=null,_0x30c768;}}:function(){};return _0x3a41a2=![],_0xc59255;};}()),a310_0x484366=a310_0x166105(this,function(){const _0x4c54cb=a310_0x2b6a;return a310_0x484366[_0x4c54cb(0x236)]()[_0x4c54cb(0x22e)](_0x4c54cb(0x1f7))['toString']()[_0x4c54cb(0x239)](a310_0x484366)[_0x4c54cb(0x22e)]('(((.+)+)+)+$');});function a310_0x19c3(){const _0x1c8d03=['__esModule','lastIndexOf','url','Component_Name__c','Veeva\x20Deployment','parse','VeevaConstants','validateVpk','../dtos/component.dto','Deploy\x20package','../dtos/job-result.dto','endsWith','7gDAAQO','content-type','nodebuffer','SUCCESS','headers','successfully','reduce','Async_Request_Id__c','filename','VeevaPackageStatus','patch','VERIFIED','xml2js','2651hcWWYL','slice','saveDeploymentResults','Component_Type__c','Join\x20all\x20mdl\x20into\x20one\x20zip','_connectionSalesforce','loadAsync','_tempFolder','_deploymentName','Cannot\x20retrieve\x20all\x20components.','insertMultipleRecords','Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20','ENDPOINT_DEPLOY_PACKAGE','__importDefault','DEPLOYED_WITH_WARNINGS','Retrieving\x20components','jszip','Action__c','SalesforceService','Logger','deploymentName','./salesforce.service','getValidationDetailsAndSaveLog','Package\x20not\x20verified','_organisationName','_systemLogger','_branchId','veeva-deploy','Form\x20Deployment\x20Results','buildObject','(((.+)+)+)+$','async','Validation.log','updateVeevaConnection','success','saveLog','11710NlbsfL','Body','text/plain','_connectionVeeva','/vpk__','SalesforceDmlError','Cannot\x20retrieve\x20all\x20attachments','multipart/form-data','finishDeploy','https://veevavault.com/','1979120HNSDQi','componentHistoryId','includes','componentType','Status__c','../../../core','Branch__c','find','../classes/errors/salesforce-dml-error','DeployService','href','file','_logger','fetchAttachmentsDetailsByParentId','form-data','packageComponentList','apply','packageId','status','updateLog','Save\x20Deployment\x20Results','Flosum','getLogResultText','Succeed__c','Deployment_Result__c','Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','set','Retrieving\x20attachments','Activity_Item__c','2479548ARslOe','importVpk','with\x20error','./veeva.service','filter','shortid','../constants/veeva.constants','vaultPackage','FlosumConstants','VeevaJobStatus','search','fs/promises','Deployment','map','TargetId__c','writeFile','Validate\x20package','Cannot\x20find\x20deployment\x20results','toString','getJobStatus','links','constructor','Component_History__c','\x20of\x20branch\x20to\x20Organization\x20','Builder','ENDPOINT_VALIDATE_PACKAGE','\x20has\x20been\x20created.','get','_componentIdList','responseStatus','type','1848792iMgvDa','isDeployed','length','toLowerCase','Generate\x20vpk\x20package','Deploy','../dtos/package-component.dto','Metadata_Log__c','<a\x20href=','detailUrl','attachmentLogId','data','base64','Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20','flat','11538626DRvGSI','Import\x20package','Type__c','application/json','rel','null','finishDeployWithError','Deployment.log','append','../utils/veeva-auth.utils','VeevaError','924GpifMK','Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20','string','ENDPOINT_UPSERT_RECORD','_instanceUrl','post','log','execute','metadataLogId','name','has','branchId','retrieveAttachments','VeevaService','Deployment\x20Result','FLOSUM_NAMESPACE','timeZone','MetadataLogStatus','generateVPK','Activity_Type__c','/Attachment','formPackageComponentList','Failure','Get\x20deploy\x20result','from','getDeployDetailsAndSaveLog','Save\x20log','createReadStream','VeevaResponseStatus','replace','Deploy\x20completed\x20','Success','Components__r\x20ORDER\x20BY\x20','_metadataLogId','PackageComponentStatus','DEPLOYED','Job_Completed__c','Validation\x20Log','../../../constants','16nqCunI','_organisationId','deployPackage','default','886383rxIyGO','getJobResult','package_components','Org__c','formFlosumDeploymentResults','catch','logError','_timeZone','retrieveComponents','errors','values','Branch__c\x20=\x20\x27','defineProperty','302QhhMca','COMPLETED','Log__c','_attachmentLogId','vaultpackage.xml','PROCESS_DEPLOYMENT','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','ComponentDto','../constants/flosum.constants'];a310_0x19c3=function(){return _0x1c8d03;};return a310_0x19c3();}function a310_0x2b6a(_0x50d352,_0x37ad5d){const _0x1a020e=a310_0x19c3();return a310_0x2b6a=function(_0x484366,_0x166105){_0x484366=_0x484366-0x15e;let _0x19c323=_0x1a020e[_0x484366];return _0x19c323;},a310_0x2b6a(_0x50d352,_0x37ad5d);}a310_0x484366();'use strict';var __importDefault=this&&this[a310_0x1a77c4(0x1e6)]||function(_0x3148f6){const _0x501e09=a310_0x1a77c4;return _0x3148f6&&_0x3148f6[_0x501e09(0x1c0)]?_0x3148f6:{'default':_0x3148f6};};Object[a310_0x1a77c4(0x1b6)](exports,a310_0x1a77c4(0x1c0),{'value':!![]}),exports[a310_0x1a77c4(0x210)]=void 0x0;const jszip_1=__importDefault(require(a310_0x1a77c4(0x1e9))),form_data_1=__importDefault(require(a310_0x1a77c4(0x215))),fs_1=require('fs'),promises_1=require(a310_0x1a77c4(0x22f)),constants_1=require(a310_0x1a77c4(0x1a5)),flosum_constants_1=require(a310_0x1a77c4(0x1bf)),veeva_constants_1=require(a310_0x1a77c4(0x22a)),veeva_service_1=require(a310_0x1a77c4(0x227)),component_dto_1=require(a310_0x1a77c4(0x1c8)),job_result_dto_1=require(a310_0x1a77c4(0x1ca)),package_component_dto_1=require(a310_0x1a77c4(0x16b)),salesforce_service_1=require(a310_0x1a77c4(0x1ee)),core_1=require(a310_0x1a77c4(0x20c)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a310_0x1a77c4(0x20f)),veeva_error_1=require('../classes/errors/veeva-error'),shortid_1=__importDefault(require(a310_0x1a77c4(0x229))),veeva_auth_utils_1=require(a310_0x1a77c4(0x17d)),xml2js_1=require(a310_0x1a77c4(0x1d8)),fetch_attachments_1=require('../../shared/utils/fetch-attachments');class DeployService{constructor(_0x2424a3,_0x2f9218,_0x31efca,_0x14df77,_0x34d10d,_0x1a3d18){const _0x373c03=a310_0x1a77c4;this['_connectionSalesforce']=_0x2f9218,this[_0x373c03(0x200)]=_0x31efca,this[_0x373c03(0x213)]=_0x14df77,this[_0x373c03(0x1e0)]=_0x34d10d,this[_0x373c03(0x183)]=_0x1a3d18,this['_branchId']=_0x2424a3[_0x373c03(0x18a)],this['_metadataLogId']=_0x2424a3[_0x373c03(0x187)],this[_0x373c03(0x1ba)]=_0x2424a3[_0x373c03(0x16f)],this[_0x373c03(0x1a7)]=_0x2424a3['organisationId'],this[_0x373c03(0x1b1)]=_0x2424a3[_0x373c03(0x18f)],this[_0x373c03(0x1f1)]=_0x2424a3['organisationName'],this['_componentIdList']=_0x2424a3['componentIdList'],this['_deploymentName']=_0x2424a3[_0x373c03(0x1ed)],this['_systemLogger']=new core_1[(_0x373c03(0x1ec))](_0x373c03(0x1f4));}async[a310_0x1a77c4(0x186)](){const _0x56c6a8=a310_0x1a77c4;try{const _0x4e8a3d=await this[_0x56c6a8(0x1b2)](),_0x15c6ca=await this['retrieveAttachments'](_0x4e8a3d),_0x3d4faa=await this['joinAllAttachments'](_0x15c6ca),_0x270dad=await this[_0x56c6a8(0x191)](_0x3d4faa);await this['validateVpk'](_0x270dad);const _0x575ec9=await this[_0x56c6a8(0x225)](_0x270dad),_0x1baf7e=await this[_0x56c6a8(0x237)](_0x575ec9);await this[_0x56c6a8(0x1ef)](_0x1baf7e);const _0x28bede=await this[_0x56c6a8(0x1a8)](_0x1baf7e[_0x56c6a8(0x218)]),_0x26d40a=await this[_0x56c6a8(0x237)](_0x28bede);await this[_0x56c6a8(0x198)](_0x26d40a);const _0x2aaaf1=this[_0x56c6a8(0x1ae)](_0x4e8a3d,_0x26d40a['packageComponentList']);await this[_0x56c6a8(0x1db)](_0x2aaaf1),await this[_0x56c6a8(0x205)](_0x26d40a[_0x56c6a8(0x166)],![],_0x1baf7e[_0x56c6a8(0x218)]);}catch(_0x2c00b1){await this['finishDeployWithError'](_0x2c00b1)[_0x56c6a8(0x1af)](_0x1251c2=>this[_0x56c6a8(0x1f2)]['error'](_0x1251c2));}}async[a310_0x1a77c4(0x1b2)](){const _0x32b86f=a310_0x1a77c4,_0x5cb579=new Set(this['_componentIdList']);this[_0x32b86f(0x213)][_0x32b86f(0x185)](_0x32b86f(0x1e8));const _0x173d95=_0x32b86f(0x1bd)+constants_1[_0x32b86f(0x18e)]+_0x32b86f(0x220)+constants_1[_0x32b86f(0x18e)]+_0x32b86f(0x180)+constants_1[_0x32b86f(0x18e)]+_0x32b86f(0x19f)+constants_1[_0x32b86f(0x18e)]+_0x32b86f(0x172)+constants_1['FLOSUM_NAMESPACE']+_0x32b86f(0x1e4)+constants_1['FLOSUM_NAMESPACE']+_0x32b86f(0x1b5)+this[_0x32b86f(0x1f3)]+'\x27',_0xafd134=await salesforce_service_1[_0x32b86f(0x1eb)]['retrieveRecords'](this[_0x32b86f(0x1de)],_0x173d95);if(!_0xafd134[_0x32b86f(0x167)])throw new Error(_0x32b86f(0x1e2));const _0xb23328=_0xafd134['map'](_0x14e891=>new component_dto_1[(_0x32b86f(0x1be))](_0x14e891))[_0x32b86f(0x228)](_0x32b30b=>_0x5cb579[_0x32b86f(0x189)](_0x32b30b['id']));if(_0xb23328[_0x32b86f(0x167)]!==this['_componentIdList'][_0x32b86f(0x167)])throw new Error(_0x32b86f(0x1e2));return _0xb23328;}async[a310_0x1a77c4(0x18b)](_0x3213e9){const _0x3e2250=a310_0x1a77c4;this[_0x3e2250(0x213)][_0x3e2250(0x185)](_0x3e2250(0x222));const _0x4a130b=await(0x0,fetch_attachments_1[_0x3e2250(0x214)])(this[_0x3e2250(0x1de)],_0x3213e9[_0x3e2250(0x231)](_0x3a0d47=>_0x3a0d47[_0x3e2250(0x208)])),_0x2a9644=await(0x0,fetch_attachments_1[_0x3e2250(0x18b)])(_0x4a130b,this['_connectionSalesforce']);if(_0x2a9644[_0x3e2250(0x167)]!==this[_0x3e2250(0x162)][_0x3e2250(0x167)])throw new Error(_0x3e2250(0x203));return _0x2a9644['map'](_0x1864f9=>_0x1864f9[_0x3e2250(0x1b4)][_0x3e2250(0x1fe)]);}async['joinAllAttachments'](_0x2fa7d6){const _0x38f8dc=a310_0x1a77c4;var _0x99fe0d;this[_0x38f8dc(0x213)][_0x38f8dc(0x185)](_0x38f8dc(0x1dd));const _0x3c3ee4=new jszip_1['default']();for(const _0x296fb5 of _0x2fa7d6){const _0xeac3e5=new jszip_1[(_0x38f8dc(0x1a9))]();await _0xeac3e5[_0x38f8dc(0x1df)](_0x296fb5,{'base64':!![]});for(const _0x5a4185 in _0xeac3e5['files']){const _0x26dd64=await((_0x99fe0d=_0xeac3e5[_0x38f8dc(0x212)](_0x5a4185))===null||_0x99fe0d===void 0x0?void 0x0:_0x99fe0d[_0x38f8dc(0x1f8)](_0x38f8dc(0x181)));_0x26dd64&&_0x3c3ee4[_0x38f8dc(0x212)](_0x5a4185,_0x26dd64);}}const _0x98209e=new xml2js_1[(_0x38f8dc(0x15e))]({'headless':!![]}),_0x42a28c={'vaultpackage':{'$':{'xmlns':_0x38f8dc(0x206)},'name':this[_0x38f8dc(0x1e1)],'source':{'vault':undefined,'author':_0x38f8dc(0x21c)},'packagetype':'migration__v','summary':_0x38f8dc(0x16a),'description':_0x38f8dc(0x179)}};_0x3c3ee4['file'](_0x38f8dc(0x1bb),_0x98209e[_0x38f8dc(0x1f6)](_0x42a28c));const _0x393512=this[_0x38f8dc(0x1e0)]+'/'+(0x0,shortid_1[_0x38f8dc(0x1a9)])()+'.zip',_0x407f10=await _0x3c3ee4['generateAsync']({'type':_0x38f8dc(0x1ce)});return await(0x0,promises_1['writeFile'])(_0x393512,_0x407f10),_0x393512;}async['generateVPK'](_0x2d04d0,_0x5c2710=0x1){const _0x49c83a=a310_0x1a77c4;var _0x3abeb4;this['_logger'][_0x49c83a(0x185)](_0x49c83a(0x169));const _0x1dcdee=new form_data_1[(_0x49c83a(0x1a9))]();_0x1dcdee[_0x49c83a(0x17c)]('file',(0x0,fs_1[_0x49c83a(0x19a)])(_0x2d04d0));const _0x4d8208=await this[_0x49c83a(0x200)][_0x49c83a(0x184)](veeva_constants_1[_0x49c83a(0x1c6)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x1dcdee,{'responseType':'arraybuffer','headers':{'Content-Type':_0x49c83a(0x204)}}),_0x5bfcac=(_0x3abeb4=_0x4d8208[_0x49c83a(0x1d0)][_0x49c83a(0x1cd)])===null||_0x3abeb4===void 0x0?void 0x0:_0x3abeb4[_0x49c83a(0x209)](_0x49c83a(0x177));if(!_0x5bfcac){const _0x5de803=_0x4d8208['data'],_0x20d71c=this[_0x49c83a(0x1e0)]+_0x49c83a(0x201)+_0x2d04d0[_0x49c83a(0x1da)](_0x2d04d0[_0x49c83a(0x1c1)]('/')+0x1);return await(0x0,promises_1[_0x49c83a(0x233)])(_0x20d71c,_0x5de803),_0x20d71c;}else{const _0x5196b9=JSON[_0x49c83a(0x1c5)](_0x4d8208[_0x49c83a(0x170)]);if(_0x5c2710>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x49c83a(0x200)]),await this[_0x49c83a(0x191)](_0x2d04d0,_0x5c2710-0x1);throw new veeva_error_1[(_0x49c83a(0x17e))](_0x5196b9[_0x49c83a(0x1b3)]);}}async['validateVpk'](_0x15882a,_0x549e89=0x1){const _0x1810ba=a310_0x1a77c4;this['_logger'][_0x1810ba(0x185)](_0x1810ba(0x234));const _0x3d18db=new form_data_1[(_0x1810ba(0x1a9))]();_0x3d18db[_0x1810ba(0x17c)](_0x1810ba(0x212),(0x0,fs_1[_0x1810ba(0x19a)])(_0x15882a));const _0x57f1f4=await this['_connectionVeeva'][_0x1810ba(0x184)](veeva_constants_1[_0x1810ba(0x1c6)][_0x1810ba(0x15f)],_0x3d18db,{'headers':{'Content-Type':'multipart/form-data'}}),_0x21209e=_0x57f1f4[_0x1810ba(0x170)];if(_0x21209e[_0x1810ba(0x163)]===status_enums_1[_0x1810ba(0x19b)]['SUCCESS'])return _0x21209e;else{if(_0x549e89>0x0)return await(0x0,veeva_auth_utils_1[_0x1810ba(0x1fa)])(this[_0x1810ba(0x200)]),await this[_0x1810ba(0x1c7)](_0x15882a,_0x549e89-0x1);throw new veeva_error_1[(_0x1810ba(0x17e))](_0x21209e[_0x1810ba(0x1b3)]);}}async[a310_0x1a77c4(0x225)](_0x22ba6a,_0x3322f2=0x1){const _0x165428=a310_0x1a77c4;this[_0x165428(0x213)]['log'](_0x165428(0x175));const _0x4df8e0=new form_data_1['default']();_0x4df8e0[_0x165428(0x17c)]('file',(0x0,fs_1[_0x165428(0x19a)])(_0x22ba6a));const _0x56decd=await this[_0x165428(0x200)]['put'](veeva_constants_1[_0x165428(0x1c6)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x4df8e0,{'headers':{'Content-Type':_0x165428(0x204)}}),_0x46498d=_0x56decd[_0x165428(0x170)];if(_0x46498d[_0x165428(0x163)]===status_enums_1[_0x165428(0x19b)][_0x165428(0x1cf)])return _0x46498d[_0x165428(0x1c2)];else{if(_0x3322f2>0x0)return await(0x0,veeva_auth_utils_1[_0x165428(0x1fa)])(this[_0x165428(0x200)]),await this[_0x165428(0x225)](_0x22ba6a,_0x3322f2-0x1);throw new veeva_error_1[(_0x165428(0x17e))](_0x46498d[_0x165428(0x1b3)]);}}async[a310_0x1a77c4(0x1a8)](_0x2b9375){const _0x26af18=a310_0x1a77c4;this[_0x26af18(0x213)][_0x26af18(0x185)](_0x26af18(0x1c9));const _0xefa9ff=await this['_connectionVeeva'][_0x26af18(0x184)](veeva_constants_1[_0x26af18(0x1c6)][_0x26af18(0x1e5)][_0x26af18(0x19c)]('{package_id}',_0x2b9375)),_0x3557a1=await _0xefa9ff[_0x26af18(0x170)];if(_0x3557a1[_0x26af18(0x163)]===status_enums_1[_0x26af18(0x19b)][_0x26af18(0x1cf)])return _0x3557a1[_0x26af18(0x1c2)];else throw new veeva_error_1[(_0x26af18(0x17e))](_0x3557a1[_0x26af18(0x1b3)]);}async[a310_0x1a77c4(0x237)](_0x23d2e0){const _0x2a67c5=a310_0x1a77c4;this[_0x2a67c5(0x213)][_0x2a67c5(0x185)]('Wait\x20Executing\x20job');const _0x599bc7=new job_result_dto_1['JobResultDto'](),[_0x404927]=await veeva_service_1[_0x2a67c5(0x18c)][_0x2a67c5(0x1ab)]([_0x23d2e0],this['_connectionVeeva'],this[_0x2a67c5(0x213)]);return _0x599bc7['isSuccess']=_0x404927['status']===status_enums_1[_0x2a67c5(0x22d)][_0x2a67c5(0x1cf)],_0x599bc7[_0x2a67c5(0x16e)]=_0x404927[_0x2a67c5(0x238)][_0x2a67c5(0x20e)](_0x4088e0=>_0x4088e0[_0x2a67c5(0x178)]==='artifacts')[_0x2a67c5(0x211)],_0x599bc7;}async[a310_0x1a77c4(0x1ef)](_0x3a11ec){const _0x5bd180=a310_0x1a77c4;this[_0x5bd180(0x213)][_0x5bd180(0x185)]('Get\x20validation\x20details.');const {data:_0x4ffe81}=await this[_0x5bd180(0x200)][_0x5bd180(0x161)](_0x3a11ec[_0x5bd180(0x16e)]);if(_0x4ffe81[_0x5bd180(0x163)]===status_enums_1[_0x5bd180(0x19b)][_0x5bd180(0x1cf)]){const {log:_0x31977f,id:_0x58218b,package_status:_0x287026}=_0x4ffe81[_0x5bd180(0x22b)],_0x36c56c=_0x31977f['filter'](_0x2c9d8d=>_0x2c9d8d['filename']['endsWith'](_0x5bd180(0x1f9))),_0x214ee2=await this[_0x5bd180(0x21d)](_0x36c56c[0x0][_0x5bd180(0x1c2)]);await this[_0x5bd180(0x1fc)](_0x214ee2,_0x5bd180(0x1a4)),_0x3a11ec[_0x5bd180(0x218)]=_0x58218b;if(_0x287026!==status_enums_1[_0x5bd180(0x1d5)]['VERIFIED'])throw new Error(_0x5bd180(0x1f0));}else throw new veeva_error_1[(_0x5bd180(0x17e))](_0x4ffe81['errors']);}async[a310_0x1a77c4(0x198)](_0x2e645e){const _0x245dd0=a310_0x1a77c4;this['_logger']['log'](_0x245dd0(0x196));const {data:_0x228e1a}=await this[_0x245dd0(0x200)][_0x245dd0(0x161)](_0x2e645e[_0x245dd0(0x16e)]);if(_0x228e1a[_0x245dd0(0x163)]===status_enums_1[_0x245dd0(0x19b)][_0x245dd0(0x1cf)]){const {responseDetails:{deployment_log:_0x5e6ba7,package_status__v:_0x29f9f6},package_steps:_0x4d9a41}=_0x228e1a,_0x412d7c=_0x5e6ba7[_0x245dd0(0x228)](_0x499fad=>_0x499fad[_0x245dd0(0x1d4)][_0x245dd0(0x1cb)](_0x245dd0(0x17b))),_0x51e426=await this['getLogResultText'](_0x412d7c[0x0]['url']);await this[_0x245dd0(0x1fc)](_0x51e426,'Deploy\x20Log'),_0x2e645e['isDeployed']=[status_enums_1['VeevaPackageStatus'][_0x245dd0(0x1a2)],status_enums_1[_0x245dd0(0x1d5)][_0x245dd0(0x1e7)]][_0x245dd0(0x209)](_0x29f9f6);const _0x36ec30=this[_0x245dd0(0x194)](_0x4d9a41);_0x2e645e[_0x245dd0(0x216)]=_0x36ec30['filter'](_0x54430e=>_0x54430e[_0x245dd0(0x219)]!==status_enums_1['PackageComponentStatus'][_0x245dd0(0x1d7)]);if(!_0x2e645e[_0x245dd0(0x216)][_0x245dd0(0x167)])throw new Error(_0x245dd0(0x235));}else throw new veeva_error_1[(_0x245dd0(0x17e))](_0x228e1a[_0x245dd0(0x1b3)]);}async[a310_0x1a77c4(0x21d)](_0x599d2c){const _0xe8a7c7=a310_0x1a77c4,{data:_0x39b510}=await this[_0xe8a7c7(0x200)][_0xe8a7c7(0x161)](_0x599d2c,{'responseType':'text'});return _0x39b510;}['formPackageComponentList'](_0x42e1b4){const _0x53507b=a310_0x1a77c4;return _0x42e1b4[_0x53507b(0x1d2)]((_0x2d1947,_0x25184f)=>{const _0x45c0f2=_0x53507b,_0x5dd75d=_0x25184f[_0x45c0f2(0x1ac)][_0x45c0f2(0x231)](_0x4fcba7=>new package_component_dto_1['PackageComponentDto'](_0x4fcba7,_0x25184f['deployment_status__v']));return[..._0x2d1947,..._0x5dd75d];},[]);}async['saveLog'](_0x12e31a,_0x809c){const _0x31e934=a310_0x1a77c4;this['_logger'][_0x31e934(0x185)](_0x31e934(0x199));const _0x9344ab={'Body':Buffer[_0x31e934(0x197)](_0x12e31a)[_0x31e934(0x236)](_0x31e934(0x171)),'ContentType':_0x31e934(0x1ff),'ParentId':this[_0x31e934(0x1a0)],'Name':_0x809c},{data:_0x41f779}=await this[_0x31e934(0x1de)]['post'](flosum_constants_1[_0x31e934(0x22c)][_0x31e934(0x182)]+_0x31e934(0x193),_0x9344ab);return _0x41f779['id'];}[a310_0x1a77c4(0x1ae)](_0x1cc366,_0x528d5b){const _0x63f56=a310_0x1a77c4;this[_0x63f56(0x213)]['log'](_0x63f56(0x1f5));const _0x280c50=_0x1cc366[_0x63f56(0x1d2)]((_0x591c8f,_0x9c6176)=>_0x591c8f[_0x63f56(0x221)]((_0x9c6176[_0x63f56(0x20a)]+'.'+_0x9c6176['componentName'])[_0x63f56(0x168)](),_0x9c6176),new Map());return _0x528d5b['map'](_0x4418cd=>{const _0x13a381=_0x63f56;this['_logger']['log'](_0x4418cd['type']+'.'+_0x4418cd[_0x13a381(0x188)]+'\x20:\x20'+_0x4418cd['status']);const _0x173eec=(_0x4418cd[_0x13a381(0x164)]+'.'+_0x4418cd[_0x13a381(0x188)])[_0x13a381(0x168)](),_0xdc1fbb=_0x280c50[_0x13a381(0x161)](_0x173eec);return{[constants_1[_0x13a381(0x18e)]+_0x13a381(0x176)]:_0x13a381(0x18d),[constants_1[_0x13a381(0x18e)]+'Status__c']:_0x4418cd[_0x13a381(0x219)]===status_enums_1[_0x13a381(0x1a1)][_0x13a381(0x1a2)]?_0x13a381(0x19e):_0x13a381(0x195),[constants_1[_0x13a381(0x18e)]+'Result__c']:'RECREATE',[constants_1['FLOSUM_NAMESPACE']+_0x13a381(0x1c3)]:_0x4418cd[_0x13a381(0x188)],[constants_1['FLOSUM_NAMESPACE']+_0x13a381(0x1dc)]:_0x4418cd[_0x13a381(0x164)],[constants_1['FLOSUM_NAMESPACE']+_0x13a381(0x1ad)]:this[_0x13a381(0x1a7)],[constants_1[_0x13a381(0x18e)]+_0x13a381(0x16c)]:this[_0x13a381(0x1a0)],[constants_1['FLOSUM_NAMESPACE']+_0x13a381(0x23a)]:_0xdc1fbb[_0x13a381(0x208)]};});}async[a310_0x1a77c4(0x1db)](_0x347b8a){const _0x5ce70d=a310_0x1a77c4;this['_logger']['log'](_0x5ce70d(0x21b));const _0x177bd7=await salesforce_service_1['SalesforceService'][_0x5ce70d(0x1e3)](this[_0x5ce70d(0x1de)],constants_1['FLOSUM_NAMESPACE']+_0x5ce70d(0x21f),_0x347b8a),_0x599a41=_0x177bd7['filter'](_0x30e78f=>!_0x30e78f[_0x5ce70d(0x1fb)])[_0x5ce70d(0x231)](_0x479445=>_0x479445[_0x5ce70d(0x1b3)])[_0x5ce70d(0x173)]();if(_0x599a41['length'])throw new salesforce_dml_error_1[(_0x5ce70d(0x202))](_0x599a41);}async[a310_0x1a77c4(0x17a)](_0x410690){const _0xd38893=a310_0x1a77c4;this[_0xd38893(0x213)][_0xd38893(0x1b0)](_0x410690),await this['_logger'][_0xd38893(0x21a)](),await this[_0xd38893(0x205)](![],!![],'');}async['finishDeploy'](_0x571ba6,_0x4cfd42,_0x4c90ad){const _0x20db3d=a310_0x1a77c4,_0x36a99e='<a\x20href='+this[_0x20db3d(0x183)]+'/'+this['_metadataLogId']+'\x20>\x20'+_0x20db3d(0x1c4)+'\x20</a>',_0x3bd0b7=_0x20db3d(0x16d)+this[_0x20db3d(0x183)]+'/'+this[_0x20db3d(0x1a7)]+'\x20>'+this[_0x20db3d(0x1f1)]+'</a>',_0x907711=_0x36a99e+_0x20db3d(0x23b)+_0x3bd0b7+_0x20db3d(0x160),_0x39af9d={[constants_1[_0x20db3d(0x18e)]+_0x20db3d(0x1ea)]:_0x907711,[constants_1[_0x20db3d(0x18e)]+'Date__c']:new Date(),[constants_1[_0x20db3d(0x18e)]+_0x20db3d(0x20d)]:this[_0x20db3d(0x1f3)],[constants_1[_0x20db3d(0x18e)]+_0x20db3d(0x223)]:'Branch',[constants_1[_0x20db3d(0x18e)]+_0x20db3d(0x192)]:_0x20db3d(0x230),[constants_1[_0x20db3d(0x18e)]+_0x20db3d(0x232)]:this[_0x20db3d(0x1a7)]},_0x35d672={[constants_1[_0x20db3d(0x18e)]+'Is_Error__c']:!_0x571ba6,[constants_1[_0x20db3d(0x18e)]+_0x20db3d(0x21e)]:_0x571ba6,[constants_1['FLOSUM_NAMESPACE']+_0x20db3d(0x20b)]:_0x4cfd42?status_enums_1[_0x20db3d(0x190)]['EXCEPTION']:status_enums_1['MetadataLogStatus'][_0x20db3d(0x1b8)],[constants_1['FLOSUM_NAMESPACE']+_0x20db3d(0x1a3)]:!![],[constants_1[_0x20db3d(0x18e)]+'Process_Type__c']:flosum_constants_1['FlosumConstants'][_0x20db3d(0x1bc)],[constants_1[_0x20db3d(0x18e)]+_0x20db3d(0x1d3)]:_0x4c90ad};await this[_0x20db3d(0x1de)][_0x20db3d(0x1d6)](flosum_constants_1[_0x20db3d(0x22c)][_0x20db3d(0x182)]+'/'+constants_1[_0x20db3d(0x18e)]+'Metadata_Log__c/'+this[_0x20db3d(0x1a0)],_0x35d672),await this[_0x20db3d(0x1de)]['post'](flosum_constants_1[_0x20db3d(0x22c)][_0x20db3d(0x182)]+'/'+constants_1[_0x20db3d(0x18e)]+_0x20db3d(0x1b9),_0x39af9d),this[_0x20db3d(0x213)][_0x20db3d(0x185)](_0x20db3d(0x19d)+(_0x571ba6?_0x20db3d(0x1d1):_0x20db3d(0x226))+'.'),await this[_0x20db3d(0x213)][_0x20db3d(0x21a)]();}}exports[a310_0x1a77c4(0x210)]=DeployService;