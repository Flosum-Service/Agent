const a311_0x299759=a311_0x5d08;function a311_0x5d08(_0x826d91,_0x4d5f88){const _0xe12ea2=a311_0x20c7();return a311_0x5d08=function(_0x56fe47,_0x5a0de3){_0x56fe47=_0x56fe47-0x1b6;let _0x20c775=_0xe12ea2[_0x56fe47];return _0x20c775;},a311_0x5d08(_0x826d91,_0x4d5f88);}(function(_0x315620,_0xb50507){const _0x50c707=a311_0x5d08,_0x5e3e8e=_0x315620();while(!![]){try{const _0x240dd5=-parseInt(_0x50c707(0x234))/0x1*(-parseInt(_0x50c707(0x26b))/0x2)+-parseInt(_0x50c707(0x25e))/0x3*(-parseInt(_0x50c707(0x249))/0x4)+-parseInt(_0x50c707(0x1e2))/0x5+parseInt(_0x50c707(0x1c7))/0x6*(-parseInt(_0x50c707(0x287))/0x7)+parseInt(_0x50c707(0x1f3))/0x8*(-parseInt(_0x50c707(0x244))/0x9)+-parseInt(_0x50c707(0x264))/0xa+parseInt(_0x50c707(0x247))/0xb;if(_0x240dd5===_0xb50507)break;else _0x5e3e8e['push'](_0x5e3e8e['shift']());}catch(_0x13f88e){_0x5e3e8e['push'](_0x5e3e8e['shift']());}}}(a311_0x20c7,0xd3ab9));const a311_0x5a0de3=(function(){let _0x13cec1=!![];return function(_0x22bfa9,_0x4ab822){const _0x1e6bd9=_0x13cec1?function(){const _0x4b1f5c=a311_0x5d08;if(_0x4ab822){const _0x237abc=_0x4ab822[_0x4b1f5c(0x276)](_0x22bfa9,arguments);return _0x4ab822=null,_0x237abc;}}:function(){};return _0x13cec1=![],_0x1e6bd9;};}()),a311_0x56fe47=a311_0x5a0de3(this,function(){const _0x5ea415=a311_0x5d08;return a311_0x56fe47[_0x5ea415(0x231)]()[_0x5ea415(0x1d5)](_0x5ea415(0x266))[_0x5ea415(0x231)]()[_0x5ea415(0x23c)](a311_0x56fe47)[_0x5ea415(0x1d5)]('(((.+)+)+)+$');});a311_0x56fe47();'use strict';var __importDefault=this&&this[a311_0x299759(0x1bb)]||function(_0x5b32ae){const _0x43334b=a311_0x299759;return _0x5b32ae&&_0x5b32ae[_0x43334b(0x26c)]?_0x5b32ae:{'default':_0x5b32ae};};Object[a311_0x299759(0x23e)](exports,a311_0x299759(0x26c),{'value':!![]}),exports[a311_0x299759(0x281)]=void 0x0;const jszip_1=__importDefault(require(a311_0x299759(0x216))),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),promises_1=require(a311_0x299759(0x212)),constants_1=require('../../../constants'),flosum_constants_1=require(a311_0x299759(0x260)),veeva_constants_1=require(a311_0x299759(0x23b)),veeva_service_1=require(a311_0x299759(0x217)),component_dto_1=require(a311_0x299759(0x1fa)),job_result_dto_1=require(a311_0x299759(0x1c2)),package_component_dto_1=require(a311_0x299759(0x1bc)),salesforce_service_1=require('./salesforce.service'),core_1=require(a311_0x299759(0x207)),status_enums_1=require(a311_0x299759(0x1c0)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),veeva_error_1=require(a311_0x299759(0x23f)),shortid_1=__importDefault(require(a311_0x299759(0x286))),veeva_auth_utils_1=require(a311_0x299759(0x238)),xml2js_1=require('xml2js'),fetch_attachments_1=require(a311_0x299759(0x1f0));class DeployService{constructor(_0xf7dade,_0x193722,_0x37ddab,_0x55e993,_0x253d74,_0x62eefb){const _0x2479a9=a311_0x299759;this[_0x2479a9(0x22a)]=_0x193722,this['_connectionVeeva']=_0x37ddab,this[_0x2479a9(0x20b)]=_0x55e993,this['_tempFolder']=_0x253d74,this[_0x2479a9(0x1d2)]=_0x62eefb,this['_branchId']=_0xf7dade['branchId'],this[_0x2479a9(0x1e5)]=_0xf7dade[_0x2479a9(0x268)],this[_0x2479a9(0x20e)]=_0xf7dade[_0x2479a9(0x272)],this[_0x2479a9(0x288)]=_0xf7dade[_0x2479a9(0x284)],this[_0x2479a9(0x218)]=_0xf7dade[_0x2479a9(0x1db)],this[_0x2479a9(0x25f)]=_0xf7dade[_0x2479a9(0x285)],this[_0x2479a9(0x290)]=_0xf7dade['componentIdList'],this[_0x2479a9(0x27f)]=_0xf7dade['deploymentName'],this[_0x2479a9(0x25b)]=new core_1['Logger']('veeva-deploy');}async[a311_0x299759(0x1e1)](){const _0x50cad9=a311_0x299759;try{const _0x4582f7=await this[_0x50cad9(0x1fe)](),_0x3c66ab=await this['retrieveAttachments'](_0x4582f7),_0x469955=await this['joinAllAttachments'](_0x3c66ab),_0x1765a8=await this[_0x50cad9(0x283)](_0x469955);await this['validateVpk'](_0x1765a8);const _0x31cc16=await this['importVpk'](_0x1765a8),_0x12662c=await this[_0x50cad9(0x22f)](_0x31cc16);await this[_0x50cad9(0x1be)](_0x12662c);const _0x2bb0c1=await this['deployPackage'](_0x12662c[_0x50cad9(0x271)]),_0x38ff8a=await this[_0x50cad9(0x22f)](_0x2bb0c1);await this[_0x50cad9(0x215)](_0x38ff8a);const _0x417bb0=this[_0x50cad9(0x1ea)](_0x4582f7,_0x38ff8a[_0x50cad9(0x289)]);await this['saveDeploymentResults'](_0x417bb0),await this[_0x50cad9(0x236)](_0x38ff8a[_0x50cad9(0x261)],![],_0x12662c[_0x50cad9(0x271)]);}catch(_0x4d9cd8){await this[_0x50cad9(0x1ca)](_0x4d9cd8)[_0x50cad9(0x270)](_0x6e2bd9=>this[_0x50cad9(0x25b)][_0x50cad9(0x267)](_0x6e2bd9));}}async[a311_0x299759(0x1fe)](){const _0x5dd15b=a311_0x299759,_0x5c0ba8=new Set(this[_0x5dd15b(0x290)]);this[_0x5dd15b(0x20b)][_0x5dd15b(0x1df)](_0x5dd15b(0x1dc));const _0x372908='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+constants_1['FLOSUM_NAMESPACE']+_0x5dd15b(0x1bf)+constants_1[_0x5dd15b(0x225)]+'Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20'+constants_1[_0x5dd15b(0x225)]+_0x5dd15b(0x293)+constants_1[_0x5dd15b(0x225)]+'Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20'+constants_1['FLOSUM_NAMESPACE']+_0x5dd15b(0x210)+constants_1[_0x5dd15b(0x225)]+_0x5dd15b(0x262)+this[_0x5dd15b(0x27b)]+'\x27',_0x22696d=await salesforce_service_1[_0x5dd15b(0x280)][_0x5dd15b(0x1fb)](this[_0x5dd15b(0x22a)],_0x372908);if(!_0x22696d[_0x5dd15b(0x220)])throw new Error('Cannot\x20retrieve\x20all\x20components.');const _0x2099c9=_0x22696d[_0x5dd15b(0x22d)](_0x3befd7=>new component_dto_1[(_0x5dd15b(0x1d8))](_0x3befd7))[_0x5dd15b(0x1b6)](_0x383490=>_0x5c0ba8['has'](_0x383490['id']));if(_0x2099c9[_0x5dd15b(0x220)]!==this[_0x5dd15b(0x290)][_0x5dd15b(0x220)])throw new Error(_0x5dd15b(0x221));return _0x2099c9;}async[a311_0x299759(0x243)](_0x16f7b3){const _0x15c7d5=a311_0x299759;this[_0x15c7d5(0x20b)][_0x15c7d5(0x1df)](_0x15c7d5(0x206));const _0x21f23d=await(0x0,fetch_attachments_1['fetchAttachmentsDetailsByParentId'])(this['_connectionSalesforce'],_0x16f7b3[_0x15c7d5(0x22d)](_0x31ce4e=>_0x31ce4e[_0x15c7d5(0x229)])),_0x619d04=await(0x0,fetch_attachments_1[_0x15c7d5(0x243)])(_0x21f23d,this[_0x15c7d5(0x22a)]);if(_0x619d04[_0x15c7d5(0x220)]!==this[_0x15c7d5(0x290)][_0x15c7d5(0x220)])throw new Error('Cannot\x20retrieve\x20all\x20attachments');return _0x619d04['map'](_0x54880f=>_0x54880f[_0x15c7d5(0x1f5)][_0x15c7d5(0x1cb)]);}async[a311_0x299759(0x1bd)](_0x4c356f){const _0x10528e=a311_0x299759;var _0x1605f8;this[_0x10528e(0x20b)]['log'](_0x10528e(0x245));const _0x4532a3=new jszip_1[(_0x10528e(0x27e))]();for(const _0x4b62f8 of _0x4c356f){const _0x47f2a1=new jszip_1[(_0x10528e(0x27e))]();await _0x47f2a1[_0x10528e(0x202)](_0x4b62f8,{'base64':!![]});for(const _0x5bf980 in _0x47f2a1[_0x10528e(0x28b)]){const _0x35ba6d=await((_0x1605f8=_0x47f2a1['file'](_0x5bf980))===null||_0x1605f8===void 0x0?void 0x0:_0x1605f8[_0x10528e(0x21b)]('string'));_0x35ba6d&&_0x4532a3[_0x10528e(0x1e4)](_0x5bf980,_0x35ba6d);}}const _0x1bbb11=new xml2js_1[(_0x10528e(0x28d))]({'headless':!![]}),_0xd81cb1={'vaultpackage':{'$':{'xmlns':_0x10528e(0x1da)},'name':this[_0x10528e(0x27f)],'source':{'vault':undefined,'author':_0x10528e(0x205)},'packagetype':_0x10528e(0x1c1),'summary':_0x10528e(0x230),'description':_0x10528e(0x209)}};_0x4532a3[_0x10528e(0x1e4)](_0x10528e(0x22c),_0x1bbb11[_0x10528e(0x1f6)](_0xd81cb1));const _0x188001=this[_0x10528e(0x292)]+'/'+(0x0,shortid_1[_0x10528e(0x27e)])()+_0x10528e(0x1e6),_0x177a8b=await _0x4532a3[_0x10528e(0x24b)]({'type':_0x10528e(0x255)});return await(0x0,promises_1[_0x10528e(0x232)])(_0x188001,_0x177a8b),_0x188001;}async['generateVPK'](_0x196159,_0x7ea2e=0x1){const _0x17c70c=a311_0x299759;var _0x39e2fc;this[_0x17c70c(0x20b)][_0x17c70c(0x1df)](_0x17c70c(0x28a));const _0x291016=new form_data_1[(_0x17c70c(0x27e))]();_0x291016[_0x17c70c(0x22e)](_0x17c70c(0x1e4),(0x0,fs_1[_0x17c70c(0x28f)])(_0x196159));const _0x4398e1=await this['_connectionVeeva'][_0x17c70c(0x213)](veeva_constants_1[_0x17c70c(0x246)][_0x17c70c(0x1d3)],_0x291016,{'responseType':_0x17c70c(0x1ed),'headers':{'Content-Type':_0x17c70c(0x1c8)}}),_0x2d2fea=(_0x39e2fc=_0x4398e1[_0x17c70c(0x224)][_0x17c70c(0x1cd)])===null||_0x39e2fc===void 0x0?void 0x0:_0x39e2fc['includes']('application/json');if(!_0x2d2fea){const _0x54f260=_0x4398e1['data'],_0x213129=this[_0x17c70c(0x292)]+_0x17c70c(0x24f)+_0x196159['slice'](_0x196159[_0x17c70c(0x282)]('/')+0x1);return await(0x0,promises_1['writeFile'])(_0x213129,_0x54f260),_0x213129;}else{const _0x4a5aef=JSON[_0x17c70c(0x239)](_0x4398e1[_0x17c70c(0x201)]);if(_0x7ea2e>0x0)return await(0x0,veeva_auth_utils_1[_0x17c70c(0x1f4)])(this['_connectionVeeva']),await this['generateVPK'](_0x196159,_0x7ea2e-0x1);throw new veeva_error_1['VeevaError'](_0x4a5aef[_0x17c70c(0x21c)]);}}async[a311_0x299759(0x1d1)](_0xc394b3,_0x273e85=0x1){const _0x4aefb9=a311_0x299759;this[_0x4aefb9(0x20b)]['log'](_0x4aefb9(0x1de));const _0x4ccbd6=new form_data_1['default']();_0x4ccbd6[_0x4aefb9(0x22e)](_0x4aefb9(0x1e4),(0x0,fs_1[_0x4aefb9(0x28f)])(_0xc394b3));const _0x5b560b=await this[_0x4aefb9(0x257)][_0x4aefb9(0x213)](veeva_constants_1[_0x4aefb9(0x246)][_0x4aefb9(0x20f)],_0x4ccbd6,{'headers':{'Content-Type':_0x4aefb9(0x1c8)}}),_0x34edc1=_0x5b560b[_0x4aefb9(0x201)];if(_0x34edc1[_0x4aefb9(0x258)]===status_enums_1['VeevaResponseStatus'][_0x4aefb9(0x1d7)])return _0x34edc1;else{if(_0x273e85>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x4aefb9(0x257)]),await this[_0x4aefb9(0x1d1)](_0xc394b3,_0x273e85-0x1);throw new veeva_error_1['VeevaError'](_0x34edc1['errors']);}}async[a311_0x299759(0x253)](_0x110305,_0x36c458=0x1){const _0x53f495=a311_0x299759;this['_logger']['log']('Import\x20package');const _0x3c069b=new form_data_1[(_0x53f495(0x27e))]();_0x3c069b[_0x53f495(0x22e)]('file',(0x0,fs_1['createReadStream'])(_0x110305));const _0x102c96=await this[_0x53f495(0x257)][_0x53f495(0x222)](veeva_constants_1['VeevaConstants'][_0x53f495(0x1d3)],_0x3c069b,{'headers':{'Content-Type':_0x53f495(0x1c8)}}),_0x2196c1=_0x102c96[_0x53f495(0x201)];if(_0x2196c1['responseStatus']===status_enums_1[_0x53f495(0x1f9)][_0x53f495(0x1d7)])return _0x2196c1[_0x53f495(0x24e)];else{if(_0x36c458>0x0)return await(0x0,veeva_auth_utils_1[_0x53f495(0x1f4)])(this[_0x53f495(0x257)]),await this['importVpk'](_0x110305,_0x36c458-0x1);throw new veeva_error_1[(_0x53f495(0x1d4))](_0x2196c1[_0x53f495(0x21c)]);}}async[a311_0x299759(0x1f8)](_0x7e27ba){const _0x1dd2f2=a311_0x299759;this[_0x1dd2f2(0x20b)][_0x1dd2f2(0x1df)](_0x1dd2f2(0x1cc));const _0x364f97=await this[_0x1dd2f2(0x257)][_0x1dd2f2(0x213)](veeva_constants_1[_0x1dd2f2(0x246)][_0x1dd2f2(0x1c4)][_0x1dd2f2(0x241)]('{package_id}',_0x7e27ba)),_0x135b9d=await _0x364f97['data'];if(_0x135b9d[_0x1dd2f2(0x258)]===status_enums_1[_0x1dd2f2(0x1f9)][_0x1dd2f2(0x1d7)])return _0x135b9d[_0x1dd2f2(0x24e)];else throw new veeva_error_1[(_0x1dd2f2(0x1d4))](_0x135b9d[_0x1dd2f2(0x21c)]);}async[a311_0x299759(0x22f)](_0x4d5613){const _0x2fbc2c=a311_0x299759;this['_logger']['log'](_0x2fbc2c(0x27c));const _0x3ac99b=new job_result_dto_1[(_0x2fbc2c(0x240))](),[_0x5109bb]=await veeva_service_1['VeevaService']['getJobResult']([_0x4d5613],this[_0x2fbc2c(0x257)],this['_logger']);return _0x3ac99b['isSuccess']=_0x5109bb[_0x2fbc2c(0x259)]===status_enums_1[_0x2fbc2c(0x219)][_0x2fbc2c(0x1d7)],_0x3ac99b[_0x2fbc2c(0x233)]=_0x5109bb['links'][_0x2fbc2c(0x208)](_0x3de332=>_0x3de332[_0x2fbc2c(0x25a)]===_0x2fbc2c(0x1b9))[_0x2fbc2c(0x23d)],_0x3ac99b;}async['getValidationDetailsAndSaveLog'](_0x565090){const _0x264c00=a311_0x299759;this[_0x264c00(0x20b)]['log'](_0x264c00(0x1d9));const {data:_0x5b69ed}=await this[_0x264c00(0x257)][_0x264c00(0x237)](_0x565090[_0x264c00(0x233)]);if(_0x5b69ed[_0x264c00(0x258)]===status_enums_1[_0x264c00(0x1f9)]['SUCCESS']){const {log:_0x572ec8,id:_0x19e30c,package_status:_0x59423e}=_0x5b69ed[_0x264c00(0x279)],_0x2aaccf=_0x572ec8[_0x264c00(0x1b6)](_0x2708f2=>_0x2708f2['filename'][_0x264c00(0x263)](_0x264c00(0x223))),_0x393745=await this[_0x264c00(0x1e7)](_0x2aaccf[0x0][_0x264c00(0x24e)]);await this[_0x264c00(0x1ef)](_0x393745,'Validation\x20Log'),_0x565090[_0x264c00(0x271)]=_0x19e30c;if(_0x59423e!==status_enums_1[_0x264c00(0x21d)][_0x264c00(0x28e)])throw new Error(_0x264c00(0x203));}else throw new veeva_error_1[(_0x264c00(0x1d4))](_0x5b69ed[_0x264c00(0x21c)]);}async['getDeployDetailsAndSaveLog'](_0x2603c9){const _0x384733=a311_0x299759;this[_0x384733(0x20b)][_0x384733(0x1df)](_0x384733(0x28c));const {data:_0x25c68b}=await this[_0x384733(0x257)][_0x384733(0x237)](_0x2603c9[_0x384733(0x233)]);if(_0x25c68b[_0x384733(0x258)]===status_enums_1[_0x384733(0x1f9)][_0x384733(0x1d7)]){const {responseDetails:{deployment_log:_0x4fe2f9,package_status__v:_0x442f21},package_steps:_0x8eb34a}=_0x25c68b,_0x545ca3=_0x4fe2f9[_0x384733(0x1b6)](_0x328be2=>_0x328be2[_0x384733(0x265)]['endsWith'](_0x384733(0x1ff))),_0x4d1220=await this[_0x384733(0x1e7)](_0x545ca3[0x0][_0x384733(0x24e)]);await this[_0x384733(0x1ef)](_0x4d1220,_0x384733(0x1ec)),_0x2603c9['isDeployed']=[status_enums_1[_0x384733(0x21d)][_0x384733(0x1c5)],status_enums_1[_0x384733(0x21d)][_0x384733(0x21f)]]['includes'](_0x442f21);const _0x5914e0=this[_0x384733(0x1b8)](_0x8eb34a);_0x2603c9[_0x384733(0x289)]=_0x5914e0[_0x384733(0x1b6)](_0x287e3b=>_0x287e3b[_0x384733(0x259)]!==status_enums_1[_0x384733(0x21e)][_0x384733(0x28e)]);if(!_0x2603c9['packageComponentList'][_0x384733(0x220)])throw new Error('Cannot\x20find\x20deployment\x20results');}else throw new veeva_error_1['VeevaError'](_0x25c68b[_0x384733(0x21c)]);}async['getLogResultText'](_0x598707){const _0x59ca23=a311_0x299759,{data:_0x3119d4}=await this[_0x59ca23(0x257)][_0x59ca23(0x237)](_0x598707,{'responseType':'text'});return _0x3119d4;}[a311_0x299759(0x1b8)](_0x572cc3){return _0x572cc3['reduce']((_0x213152,_0x586b23)=>{const _0x16e15e=a311_0x5d08,_0x1e4687=_0x586b23[_0x16e15e(0x1dd)]['map'](_0x571343=>new package_component_dto_1[(_0x16e15e(0x1e3))](_0x571343,_0x586b23[_0x16e15e(0x251)]));return[..._0x213152,..._0x1e4687];},[]);}async[a311_0x299759(0x1ef)](_0x3d75df,_0xfd985d){const _0x2bc752=a311_0x299759;this[_0x2bc752(0x20b)][_0x2bc752(0x1df)](_0x2bc752(0x227));const _0x1bfd2d={'Body':Buffer[_0x2bc752(0x278)](_0x3d75df)['toString'](_0x2bc752(0x20c)),'ContentType':'text/plain','ParentId':this['_metadataLogId'],'Name':_0xfd985d},{data:_0x474da3}=await this[_0x2bc752(0x22a)]['post'](flosum_constants_1[_0x2bc752(0x1ee)][_0x2bc752(0x291)]+_0x2bc752(0x21a),_0x1bfd2d);return _0x474da3['id'];}['formFlosumDeploymentResults'](_0x4e2a2,_0x3535df){const _0x3fbb2e=a311_0x299759;this[_0x3fbb2e(0x20b)][_0x3fbb2e(0x1df)](_0x3fbb2e(0x226));const _0x3d1b08=_0x4e2a2[_0x3fbb2e(0x214)]((_0x474fc4,_0x53338e)=>_0x474fc4[_0x3fbb2e(0x1b7)]((_0x53338e['componentType']+'.'+_0x53338e[_0x3fbb2e(0x274)])[_0x3fbb2e(0x22b)](),_0x53338e),new Map());return _0x3535df['map'](_0x47cd6b=>{const _0x2c3279=_0x3fbb2e;this[_0x2c3279(0x20b)][_0x2c3279(0x1df)](_0x47cd6b[_0x2c3279(0x20a)]+'.'+_0x47cd6b[_0x2c3279(0x235)]+_0x2c3279(0x1e0)+_0x47cd6b[_0x2c3279(0x259)]);const _0xad11b0=(_0x47cd6b[_0x2c3279(0x20a)]+'.'+_0x47cd6b['name'])['toLowerCase'](),_0x2cf0a0=_0x3d1b08[_0x2c3279(0x237)](_0xad11b0);return{[constants_1[_0x2c3279(0x225)]+'Type__c']:_0x2c3279(0x1eb),[constants_1[_0x2c3279(0x225)]+_0x2c3279(0x23a)]:_0x47cd6b[_0x2c3279(0x259)]===status_enums_1[_0x2c3279(0x21e)]['DEPLOYED']?_0x2c3279(0x1ce):_0x2c3279(0x1fd),[constants_1[_0x2c3279(0x225)]+'Result__c']:_0x2c3279(0x24c),[constants_1[_0x2c3279(0x225)]+'Component_Name__c']:_0x47cd6b[_0x2c3279(0x235)],[constants_1[_0x2c3279(0x225)]+_0x2c3279(0x1ba)]:_0x47cd6b[_0x2c3279(0x20a)],[constants_1['FLOSUM_NAMESPACE']+_0x2c3279(0x248)]:this[_0x2c3279(0x288)],[constants_1['FLOSUM_NAMESPACE']+_0x2c3279(0x250)]:this['_metadataLogId'],[constants_1[_0x2c3279(0x225)]+_0x2c3279(0x1f7)]:_0x2cf0a0[_0x2c3279(0x229)]};});}async['saveDeploymentResults'](_0x35883b){const _0x9d7d5c=a311_0x299759;this[_0x9d7d5c(0x20b)]['log'](_0x9d7d5c(0x27a));const _0x40693a=await salesforce_service_1[_0x9d7d5c(0x280)][_0x9d7d5c(0x26a)](this['_connectionSalesforce'],constants_1['FLOSUM_NAMESPACE']+_0x9d7d5c(0x277),_0x35883b),_0x4cf388=_0x40693a[_0x9d7d5c(0x1b6)](_0x578e3f=>!_0x578e3f[_0x9d7d5c(0x1c6)])[_0x9d7d5c(0x22d)](_0x59583e=>_0x59583e[_0x9d7d5c(0x21c)])[_0x9d7d5c(0x269)]();if(_0x4cf388[_0x9d7d5c(0x220)])throw new salesforce_dml_error_1[(_0x9d7d5c(0x242))](_0x4cf388);}async['finishDeployWithError'](_0x45f338){const _0x4ce0c4=a311_0x299759;this['_logger'][_0x4ce0c4(0x1c9)](_0x45f338),await this[_0x4ce0c4(0x20b)]['updateLog'](),await this['finishDeploy'](![],!![],'');}async['finishDeploy'](_0x1337fb,_0x2d0288,_0x1c787a){const _0x2b0bb6=a311_0x299759,_0xec9630=_0x2b0bb6(0x26e)+this[_0x2b0bb6(0x1d2)]+'/'+this['_metadataLogId']+_0x2b0bb6(0x256)+_0x2b0bb6(0x26d)+_0x2b0bb6(0x26f),_0xbfc4ff=_0x2b0bb6(0x26e)+this[_0x2b0bb6(0x1d2)]+'/'+this[_0x2b0bb6(0x288)]+'\x20>'+this[_0x2b0bb6(0x25f)]+_0x2b0bb6(0x1d6),_0x150409=_0xec9630+_0x2b0bb6(0x25c)+_0xbfc4ff+_0x2b0bb6(0x254),_0x5a95cc={[constants_1[_0x2b0bb6(0x225)]+_0x2b0bb6(0x211)]:_0x150409,[constants_1[_0x2b0bb6(0x225)]+'Date__c']:new Date(),[constants_1['FLOSUM_NAMESPACE']+_0x2b0bb6(0x275)]:this[_0x2b0bb6(0x27b)],[constants_1[_0x2b0bb6(0x225)]+_0x2b0bb6(0x228)]:_0x2b0bb6(0x1e8),[constants_1['FLOSUM_NAMESPACE']+_0x2b0bb6(0x273)]:_0x2b0bb6(0x1fc),[constants_1[_0x2b0bb6(0x225)]+_0x2b0bb6(0x1f1)]:this[_0x2b0bb6(0x288)]},_0x3f0885={[constants_1['FLOSUM_NAMESPACE']+_0x2b0bb6(0x1cf)]:!_0x1337fb,[constants_1[_0x2b0bb6(0x225)]+_0x2b0bb6(0x1e9)]:_0x1337fb,[constants_1[_0x2b0bb6(0x225)]+_0x2b0bb6(0x23a)]:_0x2d0288?status_enums_1[_0x2b0bb6(0x24d)][_0x2b0bb6(0x20d)]:status_enums_1[_0x2b0bb6(0x24d)][_0x2b0bb6(0x1f2)],[constants_1[_0x2b0bb6(0x225)]+_0x2b0bb6(0x25d)]:!![],[constants_1[_0x2b0bb6(0x225)]+'Process_Type__c']:flosum_constants_1[_0x2b0bb6(0x1ee)][_0x2b0bb6(0x27d)],[constants_1[_0x2b0bb6(0x225)]+_0x2b0bb6(0x1d0)]:_0x1c787a};await this['_connectionSalesforce']['patch'](flosum_constants_1[_0x2b0bb6(0x1ee)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x2b0bb6(0x225)]+_0x2b0bb6(0x252)+this[_0x2b0bb6(0x1e5)],_0x3f0885),await this[_0x2b0bb6(0x22a)]['post'](flosum_constants_1[_0x2b0bb6(0x1ee)][_0x2b0bb6(0x291)]+'/'+constants_1[_0x2b0bb6(0x225)]+_0x2b0bb6(0x1c3),_0x5a95cc),this[_0x2b0bb6(0x20b)]['log'](_0x2b0bb6(0x24a)+(_0x1337fb?'successfully':_0x2b0bb6(0x200))+'.'),await this[_0x2b0bb6(0x20b)][_0x2b0bb6(0x204)]();}}exports['DeployService']=DeployService;function a311_0x20c7(){const _0x21e4f0=['getDeployDetailsAndSaveLog','jszip','./veeva.service','_timeZone','VeevaJobStatus','/Attachment','async','errors','VeevaPackageStatus','PackageComponentStatus','DEPLOYED_WITH_WARNINGS','length','Cannot\x20retrieve\x20all\x20components.','put','Validation.log','headers','FLOSUM_NAMESPACE','Form\x20Deployment\x20Results','Save\x20log','Activity_Item__c','componentHistoryId','_connectionSalesforce','toLowerCase','vaultpackage.xml','map','append','getJobStatus','Deploy','toString','writeFile','detailUrl','519gMBRTH','name','finishDeploy','get','../utils/veeva-auth.utils','parse','Status__c','../constants/veeva.constants','constructor','href','defineProperty','../classes/errors/veeva-error','JobResultDto','replace','SalesforceDmlError','retrieveAttachments','36441TpyaeF','Join\x20all\x20mdl\x20into\x20one\x20zip','VeevaConstants','33577313wIJhvn','Org__c','16jkJeMG','Deploy\x20completed\x20','generateAsync','RECREATE','MetadataLogStatus','url','/vpk__','Metadata_Log__c','deployment_status__v','Metadata_Log__c/','importVpk','\x20has\x20been\x20created.','nodebuffer','\x20>\x20','_connectionVeeva','responseStatus','status','rel','_systemLogger','\x20of\x20branch\x20to\x20Organization\x20','Job_Completed__c','584481nIvkvO','_organisationName','../constants/flosum.constants','isDeployed','Branch__c\x20=\x20\x27','endsWith','4217420mLfPXb','filename','(((.+)+)+)+$','error','metadataLogId','flat','insertMultipleRecords','3506WaFSZB','__esModule','Veeva\x20Deployment','<a\x20href=','\x20</a>','catch','packageId','attachmentLogId','Activity_Type__c','componentName','Branch__c','apply','Deployment_Result__c','from','vaultPackage','Save\x20Deployment\x20Results','_branchId','Wait\x20Executing\x20job','PROCESS_DEPLOYMENT','default','_deploymentName','SalesforceService','DeployService','lastIndexOf','generateVPK','organisationId','organisationName','shortid','110677TRBAVe','_organisationId','packageComponentList','Generate\x20vpk\x20package','files','Get\x20deploy\x20result','Builder','VERIFIED','createReadStream','_componentIdList','ENDPOINT_UPSERT_RECORD','_tempFolder','Components__r\x20ORDER\x20BY\x20','filter','set','formPackageComponentList','artifacts','Component_Type__c','__importDefault','../dtos/package-component.dto','joinAllAttachments','getValidationDetailsAndSaveLog','Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','../enums/status.enums','migration__v','../dtos/job-result.dto','Log__c','ENDPOINT_DEPLOY_PACKAGE','DEPLOYED','success','402mplHwV','multipart/form-data','logError','finishDeployWithError','Body','Deploy\x20package','content-type','Success','Is_Error__c','Async_Request_Id__c','validateVpk','_instanceUrl','ENDPOINT_EXPORT_IMPORT_PACKAGE','VeevaError','search','</a>','SUCCESS','ComponentDto','Get\x20validation\x20details.','https://veevavault.com/','timeZone','Retrieving\x20components','package_components','Validate\x20package','log','\x20:\x20','execute','8606920OYeyAP','PackageComponentDto','file','_metadataLogId','.zip','getLogResultText','Branch','Succeed__c','formFlosumDeploymentResults','Deployment\x20Result','Deploy\x20Log','arraybuffer','FlosumConstants','saveLog','../../shared/utils/fetch-attachments','TargetId__c','COMPLETED','1328tAkHsD','updateVeevaConnection','values','buildObject','Component_History__c','deployPackage','VeevaResponseStatus','../dtos/component.dto','retrieveRecords','Deployment','Failure','retrieveComponents','Deployment.log','with\x20error','data','loadAsync','Package\x20not\x20verified','updateLog','Flosum','Retrieving\x20attachments','../../../core','find','null','type','_logger','base64','EXCEPTION','_attachmentLogId','ENDPOINT_VALIDATE_PACKAGE','Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20','Action__c','fs/promises','post','reduce'];a311_0x20c7=function(){return _0x21e4f0;};return a311_0x20c7();}