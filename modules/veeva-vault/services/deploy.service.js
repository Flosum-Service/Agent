function a373_0x53a9(_0x3c7e6e,_0x2e121d){const _0x3a8027=a373_0x32fb();return a373_0x53a9=function(_0x51e7b0,_0x3cb935){_0x51e7b0=_0x51e7b0-0x144;let _0x32fb00=_0x3a8027[_0x51e7b0];return _0x32fb00;},a373_0x53a9(_0x3c7e6e,_0x2e121d);}const a373_0x223c0b=a373_0x53a9;(function(_0x2a1fb6,_0x426d81){const _0x1195af=a373_0x53a9,_0x35c164=_0x2a1fb6();while(!![]){try{const _0x5a3d7a=-parseInt(_0x1195af(0x19c))/0x1*(-parseInt(_0x1195af(0x195))/0x2)+parseInt(_0x1195af(0x18a))/0x3+-parseInt(_0x1195af(0x1e0))/0x4+parseInt(_0x1195af(0x18d))/0x5*(-parseInt(_0x1195af(0x1d6))/0x6)+-parseInt(_0x1195af(0x16e))/0x7+parseInt(_0x1195af(0x1a6))/0x8*(parseInt(_0x1195af(0x18f))/0x9)+-parseInt(_0x1195af(0x168))/0xa*(-parseInt(_0x1195af(0x165))/0xb);if(_0x5a3d7a===_0x426d81)break;else _0x35c164['push'](_0x35c164['shift']());}catch(_0xef0691){_0x35c164['push'](_0x35c164['shift']());}}}(a373_0x32fb,0xb6b04));const a373_0x3cb935=(function(){let _0x489d02=!![];return function(_0x17c6fe,_0x19a39b){const _0x314758=_0x489d02?function(){if(_0x19a39b){const _0x291cd7=_0x19a39b['apply'](_0x17c6fe,arguments);return _0x19a39b=null,_0x291cd7;}}:function(){};return _0x489d02=![],_0x314758;};}()),a373_0x51e7b0=a373_0x3cb935(this,function(){const _0x4b950b=a373_0x53a9;return a373_0x51e7b0[_0x4b950b(0x15c)]()[_0x4b950b(0x1e2)](_0x4b950b(0x1cd))[_0x4b950b(0x15c)]()[_0x4b950b(0x1d7)](a373_0x51e7b0)['search'](_0x4b950b(0x1cd));});a373_0x51e7b0();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x458939){return _0x458939&&_0x458939['__esModule']?_0x458939:{'default':_0x458939};};Object[a373_0x223c0b(0x15b)](exports,a373_0x223c0b(0x1c3),{'value':!![]}),exports[a373_0x223c0b(0x199)]=void 0x0;function a373_0x32fb(){const _0x345664=['Job_Completed__c','EXCEPTION','6UzWZWV','constructor','default','Join\x20all\x20mdl\x20into\x20one\x20zip','../../../core','map','_veevaService','../classes/retrievers/veeva-components/flosum-component.veeva-component.retriever','bind','Deploy\x20completed\x20','4969296NTSEur','MetadataLogStatus','search','FlosumConstants','_connectionVeeva','\x20</a>','Component_History__c','Success','status','deploymentAction','error','length','\x20:\x20','Branch','../classes/retrievers/flosum-components/branch-component-history.flosum-component.retriever','Retrieving\x20attachments','componentName','saveBackup','metadataLogId','Is_Error__c','../../shared/utils/fetch-attachments','type','name','lastIndexOf','Save\x20log','reduce','Activity_Item__c','from','../constants/flosum.constants','log','set','defineProperty','toString','VpkService','./vpk.service','finishDeploy','_salesforceService','validate','Create\x20vpk\x20package','post','Retrieving\x20components','1128479MoUPQy','.zip','get','110GCGDHj','retrieve','_deploymentName','_packageImportService','createZip','saveLog','4938717vnmloh','External_Deployment_Id__c','Veeva_Step_Name__c','Deployment\x20Result','Backup','SalesforceDmlError','generateAsync','/vpk__','Result__c','values','retrieveAttachments','Component_Name__c','import','base64','filter','patch','_branchId','_tempFolder','../classes/errors/salesforce-dml-error','veeva-deploy','logError','<a\x20href=','_organisationName','ZipCreatorDeploy','./package-import.service','Status__c','_metadataLogId','Log__c','1804920FoJPPD','../classes/deploy/zip-creator.deploy','_logger','1014890RzOVoF','timeZone','9aWwErM','componentType','toLowerCase','/Attachment','writeFile','PackageExportService','2fwpLDo','flat','Branch__c','createBackup','DeployService','getFlosumComponents','../enums/status.enums','1078465FnoCzy','Date__c','FLOSUM_NAMESPACE','shortid','componentHistoryId','Form\x20Deployment\x20Results','with\x20error','createVpk','Veeva\x20Deployment','Type__c','724328pWnMFU','saveDeploymentResults','_timeZone','execute','Save\x20Deployment\x20Results','insertMultipleRecords','text/plain','\x20of\x20branch\x20to\x20Organization\x20','generate','updateLog','fetchAttachmentsDetailsByParentId','./salesforce.service','_componentIdList','../../../constants','Body','application/zip','_vpkService','packageId','Succeed__c','isDeployed','Logger','DEPLOYED','_organisationId','_systemLogger','branchId','Create\x20Backup','</a>','successfully','FlosumComponentVeevaComponentRetriever','__esModule','jszip','fs/promises','\x20>\x20','ENDPOINT_UPSERT_RECORD','COMPLETED','export','has','BranchComponentHistoryFlosumComponentRetriever','Metadata_Log__c','(((.+)+)+)+$','_instanceUrl','_packageExportService','Metadata_Log__c/','_connectionSalesforce','VeevaService','\x20has\x20been\x20created.'];a373_0x32fb=function(){return _0x345664;};return a373_0x32fb();}const jszip_1=__importDefault(require(a373_0x223c0b(0x1c4))),promises_1=require(a373_0x223c0b(0x1c5)),constants_1=require(a373_0x223c0b(0x1b3)),flosum_constants_1=require(a373_0x223c0b(0x158)),veeva_service_1=require('./veeva.service'),salesforce_service_1=require(a373_0x223c0b(0x1b1)),core_1=require(a373_0x223c0b(0x1da)),status_enums_1=require(a373_0x223c0b(0x19b)),salesforce_dml_error_1=require(a373_0x223c0b(0x180)),shortid_1=__importDefault(require(a373_0x223c0b(0x19f))),fetch_attachments_1=require(a373_0x223c0b(0x150)),package_import_service_1=require(a373_0x223c0b(0x186)),branch_component_history_flosum_component_retriever_1=require(a373_0x223c0b(0x14a)),flosum_component_veeva_component_retriever_1=require(a373_0x223c0b(0x1dd)),package_export_service_1=require('./package-export.service'),vpk_service_1=require(a373_0x223c0b(0x15e)),zip_creator_deploy_1=require(a373_0x223c0b(0x18b));class DeployService{constructor(_0x4aabc3,_0x1e03e8,_0x72046c,_0x3787b,_0x1504d9,_0x46724e){const _0x177417=a373_0x223c0b;this['_connectionSalesforce']=_0x1e03e8,this['_connectionVeeva']=_0x72046c,this[_0x177417(0x18c)]=_0x3787b,this[_0x177417(0x17f)]=_0x1504d9,this[_0x177417(0x1ce)]=_0x46724e,this[_0x177417(0x17e)]=_0x4aabc3[_0x177417(0x1be)],this[_0x177417(0x188)]=_0x4aabc3[_0x177417(0x14e)],this['_attachmentLogId']=_0x4aabc3['attachmentLogId'],this[_0x177417(0x1bc)]=_0x4aabc3['organisationId'],this[_0x177417(0x1a8)]=_0x4aabc3[_0x177417(0x18e)],this['_organisationName']=_0x4aabc3['organisationName'],this[_0x177417(0x1b2)]=_0x4aabc3['componentIdList'],this[_0x177417(0x16a)]=_0x4aabc3['deploymentName'],this[_0x177417(0x1bd)]=new core_1[(_0x177417(0x1ba))](_0x177417(0x181)),this['_veevaService']=new veeva_service_1[(_0x177417(0x1d2))]({'connection':this[_0x177417(0x1e4)],'logger':this[_0x177417(0x18c)]}),this['_salesforceService']=new salesforce_service_1['SalesforceService']({'connection':this[_0x177417(0x1d1)]}),this['_packageImportService']=new package_import_service_1['PackageImportService']({'veevaService':this[_0x177417(0x1dc)],'connection':this[_0x177417(0x1e4)],'logger':this[_0x177417(0x18c)],'saveLog':this[_0x177417(0x16d)][_0x177417(0x1de)](this)}),this[_0x177417(0x1cf)]=new package_export_service_1[(_0x177417(0x194))]({'veevaService':this[_0x177417(0x1dc)],'connection':this['_connectionVeeva'],'logger':this[_0x177417(0x18c)]}),this['_vpkService']=new vpk_service_1[(_0x177417(0x15d))]({'connection':this[_0x177417(0x1e4)]});}async[a373_0x223c0b(0x1a9)](){const _0x3752af=a373_0x223c0b;try{const _0x115bc6=await this[_0x3752af(0x19a)]();await this['_logger'][_0x3752af(0x1af)]();const _0x1e8c2e=await this[_0x3752af(0x198)](_0x115bc6);await this[_0x3752af(0x14d)](_0x1e8c2e);const _0x14fa34=await this[_0x3752af(0x178)](_0x115bc6),_0x5ace16=await this[_0x3752af(0x16c)](_0x14fa34),_0x84dec3=await this[_0x3752af(0x1a3)](_0x5ace16);await this[_0x3752af(0x18c)]['updateLog']();const _0x2adfd5=await this[_0x3752af(0x16b)][_0x3752af(0x17a)](_0x84dec3);await this[_0x3752af(0x18c)][_0x3752af(0x1af)]();const _0x1c4649=this['formFlosumDeploymentResults'](_0x115bc6,_0x2adfd5['packageComponentList']);await this[_0x3752af(0x1a7)](_0x1c4649),await this[_0x3752af(0x15f)](_0x2adfd5[_0x3752af(0x1b9)],![],_0x2adfd5[_0x3752af(0x1b7)]);}catch(_0x367631){await this['finishDeployWithError'](_0x367631)['catch'](_0x13ec81=>this['_systemLogger'][_0x3752af(0x146)](_0x13ec81));}}async[a373_0x223c0b(0x19a)](){const _0x2221c5=a373_0x223c0b,_0x2938f8=new Set(this[_0x2221c5(0x1b2)]);this[_0x2221c5(0x18c)][_0x2221c5(0x159)](_0x2221c5(0x164));const _0x3eac97=await new branch_component_history_flosum_component_retriever_1[(_0x2221c5(0x1cb))]({'value':this[_0x2221c5(0x17e)],'salesforceService':this[_0x2221c5(0x160)]})['retrieve'](),_0x529011=_0x3eac97[_0x2221c5(0x17c)](_0x5e3c5b=>_0x2938f8[_0x2221c5(0x1ca)](_0x5e3c5b['id']));if(_0x529011[_0x2221c5(0x147)]!==this['_componentIdList'][_0x2221c5(0x147)])throw new Error('Cannot\x20retrieve\x20all\x20components.');return _0x529011;}async[a373_0x223c0b(0x198)](_0x1039a0){const _0x5926a9=a373_0x223c0b;var _0x20437d;this['_logger'][_0x5926a9(0x159)](_0x5926a9(0x1bf));const _0x29cc35=await new flosum_component_veeva_component_retriever_1[(_0x5926a9(0x1c2))]({'value':_0x1039a0,'veevaService':this[_0x5926a9(0x1dc)],'logger':this[_0x5926a9(0x18c)]})[_0x5926a9(0x169)](),_0x5aed2f=await this[_0x5926a9(0x1cf)][_0x5926a9(0x1c9)](_0x29cc35,_0x5926a9(0x172));if(_0x5aed2f[_0x5926a9(0x147)]>0x1)throw new Error('Cannot\x20Backup\x20more\x20than\x20200\x20components.');return(_0x20437d=_0x5aed2f[0x0])!==null&&_0x20437d!==void 0x0?_0x20437d:_0x5aed2f[0x0]=new jszip_1[(_0x5926a9(0x1d8))](),_0x5aed2f[0x0][_0x5926a9(0x174)]({'type':'base64'});}async[a373_0x223c0b(0x14d)](_0x1a97e0){const _0x26e16f=a373_0x223c0b;this[_0x26e16f(0x18c)][_0x26e16f(0x159)]('Save\x20Backup\x20to\x20Salesforce');const _0x409297={'Body':_0x1a97e0,'ContentType':_0x26e16f(0x1b5),'ParentId':this[_0x26e16f(0x188)],'Name':flosum_constants_1[_0x26e16f(0x1e3)]['BACKUP_ZIP_NAME']};await this[_0x26e16f(0x1d1)][_0x26e16f(0x163)](flosum_constants_1[_0x26e16f(0x1e3)]['ENDPOINT_UPSERT_RECORD']+_0x26e16f(0x192),_0x409297);}async[a373_0x223c0b(0x178)](_0x4d84c9){const _0x55d7f2=a373_0x223c0b;this[_0x55d7f2(0x18c)][_0x55d7f2(0x159)](_0x55d7f2(0x14b));const _0x5d782e=await(0x0,fetch_attachments_1[_0x55d7f2(0x1b0)])(this['_connectionSalesforce'],_0x4d84c9[_0x55d7f2(0x1db)](_0x3ddfd8=>_0x3ddfd8[_0x55d7f2(0x1a0)])),_0x249291=await(0x0,fetch_attachments_1['retrieveAttachments'])(_0x5d782e,this[_0x55d7f2(0x1d1)]);if(_0x249291[_0x55d7f2(0x147)]!==this[_0x55d7f2(0x1b2)][_0x55d7f2(0x147)])throw new Error('Cannot\x20retrievers\x20all\x20attachments');return _0x249291[_0x55d7f2(0x1db)](_0x3d1bf9=>_0x3d1bf9[_0x55d7f2(0x177)][_0x55d7f2(0x1b4)]);}async[a373_0x223c0b(0x16c)](_0x37d4b2){const _0x276f4b=a373_0x223c0b;this[_0x276f4b(0x18c)][_0x276f4b(0x159)](_0x276f4b(0x1d9));const _0x139b29=await new zip_creator_deploy_1[(_0x276f4b(0x185))]({'attachmentBodies':_0x37d4b2,'deploymentName':this[_0x276f4b(0x16a)]})[_0x276f4b(0x1a9)](),_0x522416=this[_0x276f4b(0x17f)]+'/'+(0x0,shortid_1[_0x276f4b(0x1d8)])()+_0x276f4b(0x166);return await(0x0,promises_1[_0x276f4b(0x193)])(_0x522416,_0x139b29),_0x522416;}async[a373_0x223c0b(0x1a3)](_0x3c37a4){const _0x329fa1=a373_0x223c0b;this[_0x329fa1(0x18c)]['log'](_0x329fa1(0x162));const _0x23e3b5=await this[_0x329fa1(0x1b6)][_0x329fa1(0x1ae)](_0x3c37a4),_0x27e80d=this[_0x329fa1(0x17f)]+_0x329fa1(0x175)+_0x3c37a4['slice'](_0x3c37a4[_0x329fa1(0x153)]('/')+0x1);return await(0x0,promises_1[_0x329fa1(0x193)])(_0x27e80d,_0x23e3b5),await this[_0x329fa1(0x1b6)][_0x329fa1(0x161)](_0x27e80d),_0x27e80d;}async[a373_0x223c0b(0x16d)](_0x2c7237,_0x5ede1f){const _0x447a32=a373_0x223c0b;this[_0x447a32(0x18c)]['log'](_0x447a32(0x154));const _0x27d920={'Body':Buffer[_0x447a32(0x157)](_0x2c7237)[_0x447a32(0x15c)](_0x447a32(0x17b)),'ContentType':_0x447a32(0x1ac),'ParentId':this[_0x447a32(0x188)],'Name':_0x5ede1f};await this[_0x447a32(0x1d1)][_0x447a32(0x163)](flosum_constants_1[_0x447a32(0x1e3)][_0x447a32(0x1c7)]+'/Attachment',_0x27d920);}['formFlosumDeploymentResults'](_0x386b0a,_0x43071e){const _0x3e1b9b=a373_0x223c0b;this['_logger'][_0x3e1b9b(0x159)](_0x3e1b9b(0x1a1));const _0x59edb6=_0x386b0a[_0x3e1b9b(0x155)]((_0x45877b,_0x4df8dd)=>_0x45877b[_0x3e1b9b(0x15a)]((_0x4df8dd[_0x3e1b9b(0x190)]+'.'+_0x4df8dd[_0x3e1b9b(0x14c)])['toLowerCase'](),_0x4df8dd),new Map());return _0x43071e['map'](_0x3b34e2=>{const _0x3d18db=_0x3e1b9b;this[_0x3d18db(0x18c)][_0x3d18db(0x159)](_0x3b34e2[_0x3d18db(0x151)]+'.'+_0x3b34e2[_0x3d18db(0x152)]+_0x3d18db(0x148)+_0x3b34e2[_0x3d18db(0x144)]);const _0xf389c2=(_0x3b34e2[_0x3d18db(0x151)]+'.'+_0x3b34e2[_0x3d18db(0x152)])[_0x3d18db(0x191)](),_0x313835=_0x59edb6[_0x3d18db(0x167)](_0xf389c2);return{[constants_1['FLOSUM_NAMESPACE']+_0x3d18db(0x1a5)]:_0x3d18db(0x171),[constants_1[_0x3d18db(0x19e)]+'Status__c']:_0x3b34e2[_0x3d18db(0x144)]===status_enums_1['PackageComponentStatus'][_0x3d18db(0x1bb)]?_0x3d18db(0x1e7):'Failure',[constants_1['FLOSUM_NAMESPACE']+_0x3d18db(0x176)]:_0x3b34e2[_0x3d18db(0x145)],[constants_1['FLOSUM_NAMESPACE']+_0x3d18db(0x179)]:_0x3b34e2[_0x3d18db(0x152)],[constants_1['FLOSUM_NAMESPACE']+'Component_Type__c']:_0x3b34e2['type'],[constants_1[_0x3d18db(0x19e)]+_0x3d18db(0x170)]:_0x3b34e2['stepName'],[constants_1['FLOSUM_NAMESPACE']+'Org__c']:this[_0x3d18db(0x1bc)],[constants_1[_0x3d18db(0x19e)]+_0x3d18db(0x1cc)]:this[_0x3d18db(0x188)],[constants_1[_0x3d18db(0x19e)]+_0x3d18db(0x1e6)]:_0x313835['componentHistoryId']};});}async[a373_0x223c0b(0x1a7)](_0x37c190){const _0x53499f=a373_0x223c0b;this[_0x53499f(0x18c)][_0x53499f(0x159)](_0x53499f(0x1aa));const _0xb5e58d=await this[_0x53499f(0x160)][_0x53499f(0x1ab)](constants_1['FLOSUM_NAMESPACE']+'Deployment_Result__c',_0x37c190),_0x119799=_0xb5e58d['filter'](_0x2087bb=>!_0x2087bb['success'])[_0x53499f(0x1db)](_0x3fe7fc=>_0x3fe7fc['errors'])[_0x53499f(0x196)]();if(_0x119799[_0x53499f(0x147)])throw new salesforce_dml_error_1[(_0x53499f(0x173))](_0x119799);}async['finishDeployWithError'](_0x59cb91){const _0x1cf13b=a373_0x223c0b;this[_0x1cf13b(0x18c)][_0x1cf13b(0x182)](_0x59cb91),await this[_0x1cf13b(0x18c)]['updateLog'](),await this['finishDeploy'](![],!![],'');}async[a373_0x223c0b(0x15f)](_0x1ae911,_0x429590,_0x142c5f){const _0x5720de=a373_0x223c0b,_0x56a6c6='<a\x20href='+this[_0x5720de(0x1ce)]+'/'+this['_metadataLogId']+_0x5720de(0x1c6)+_0x5720de(0x1a4)+_0x5720de(0x1e5),_0x54b8a6=_0x5720de(0x183)+this[_0x5720de(0x1ce)]+'/'+this[_0x5720de(0x1bc)]+'\x20>'+this[_0x5720de(0x184)]+_0x5720de(0x1c0),_0x2629aa=_0x56a6c6+_0x5720de(0x1ad)+_0x54b8a6+_0x5720de(0x1d3),_0x3f8faf={[constants_1[_0x5720de(0x19e)]+'Action__c']:_0x2629aa,[constants_1[_0x5720de(0x19e)]+_0x5720de(0x19d)]:new Date(),[constants_1[_0x5720de(0x19e)]+_0x5720de(0x197)]:this[_0x5720de(0x17e)],[constants_1[_0x5720de(0x19e)]+_0x5720de(0x156)]:_0x5720de(0x149),[constants_1['FLOSUM_NAMESPACE']+'Activity_Type__c']:'Deployment',[constants_1[_0x5720de(0x19e)]+'TargetId__c']:this[_0x5720de(0x1bc)]},_0x391d0b={[constants_1[_0x5720de(0x19e)]+_0x5720de(0x14f)]:!_0x1ae911,[constants_1[_0x5720de(0x19e)]+_0x5720de(0x1b8)]:_0x1ae911,[constants_1[_0x5720de(0x19e)]+_0x5720de(0x187)]:_0x429590?status_enums_1[_0x5720de(0x1e1)][_0x5720de(0x1d5)]:status_enums_1[_0x5720de(0x1e1)][_0x5720de(0x1c8)],[constants_1['FLOSUM_NAMESPACE']+_0x5720de(0x1d4)]:!![],[constants_1[_0x5720de(0x19e)]+_0x5720de(0x16f)]:_0x142c5f};await this[_0x5720de(0x1d1)][_0x5720de(0x17d)](flosum_constants_1[_0x5720de(0x1e3)][_0x5720de(0x1c7)]+'/'+constants_1[_0x5720de(0x19e)]+_0x5720de(0x1d0)+this['_metadataLogId'],_0x391d0b),await this['_connectionSalesforce'][_0x5720de(0x163)](flosum_constants_1['FlosumConstants']['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x5720de(0x19e)]+_0x5720de(0x189),_0x3f8faf),this[_0x5720de(0x18c)][_0x5720de(0x159)](_0x5720de(0x1df)+(_0x1ae911?_0x5720de(0x1c1):_0x5720de(0x1a2))+'.'),await this[_0x5720de(0x18c)][_0x5720de(0x1af)]();}}exports['DeployService']=DeployService;