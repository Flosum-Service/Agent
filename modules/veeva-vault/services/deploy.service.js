function a357_0x2c13(){const _0x13bae5=['./salesforce.service','values','_branchId','205nnkvsj','saveLog','6333228nvNkWy','EXCEPTION','catch','../classes/deploy/zip-creator.deploy','_connectionSalesforce','constructor','length','base64','errors','toString','import','default','getFlosumComponents','../../../constants','SalesforceDmlError','_tempFolder','COMPLETED','formFlosumDeploymentResults','apply','\x20:\x20','../../../core','success','_timeZone','../classes/retrievers/veeva-components/flosum-component.veeva-component.retriever','writeFile','Save\x20Backup\x20to\x20Salesforce','Logger','organisationId','Org__c','Cannot\x20Backup\x20more\x20than\x20200\x20components.','bind','type','retrieveAttachments','FLOSUM_NAMESPACE','_vpkService','log','name','Join\x20all\x20mdl\x20into\x20one\x20zip','\x20>\x20','componentIdList','.zip','Deployment\x20Result','generate','/Attachment','text/plain','_packageImportService','slice','Veeva_Step_Name__c','1046160uwEwtg','flat','3KOjVgs','insertMultipleRecords','_connectionVeeva','Failure','Success','componentName','attachmentLogId','retrieve','./package-export.service','map','Branch','\x20has\x20been\x20created.','toLowerCase','_componentIdList','timeZone','./vpk.service','TargetId__c','_organisationId','veeva-deploy','ZipCreatorDeploy','BACKUP_ZIP_NAME','shortid','_logger','Create\x20vpk\x20package','stepName','../../shared/utils/fetch-attachments','ENDPOINT_UPSERT_RECORD','updateLog','\x20</a>','deploymentName','Deployment','Save\x20log','defineProperty','Retrieving\x20attachments','branchId','finishDeployWithError','3603950zVsaGB','createZip','(((.+)+)+)+$','packageComponentList','8988RopeIQ','DEPLOYED','error','../enums/status.enums','_veevaService','Component_Name__c','../classes/retrievers/flosum-components/branch-component-history.flosum-component.retriever','fetchAttachmentsDetailsByParentId','fs/promises','Body','Component_History__c','Job_Completed__c','metadataLogId','patch','deploymentAction','_organisationName','logError','_systemLogger','_salesforceService','Succeed__c','FlosumConstants','status','Activity_Type__c','Status__c','604VGNXJS','FlosumComponentVeevaComponentRetriever','Component_Type__c','Metadata_Log__c','VpkService','jszip','\x20of\x20branch\x20to\x20Organization\x20','Veeva\x20Deployment','Log__c','filter','Date__c','finishDeploy','</a>','reduce','saveBackup','337HSoyDS','successfully','Cannot\x20retrievers\x20all\x20attachments','has','VeevaService','<a\x20href=','./veeva.service','Save\x20Deployment\x20Results','Action__c','Deploy\x20completed\x20','__esModule','DeployService','set','application/zip','_packageExportService','8ZjlNYj','1912692LFrCZN','Metadata_Log__c/','Activity_Item__c','export','Backup','isDeployed','3168501GjqMVU','post','Is_Error__c','createBackup','organisationName','createVpk','_instanceUrl','packageId','Async_Request_Id__c','execute','saveDeploymentResults','_metadataLogId','_deploymentName','Cannot\x20retrieve\x20all\x20components.','/vpk__','get','PackageExportService','MetadataLogStatus'];a357_0x2c13=function(){return _0x13bae5;};return a357_0x2c13();}const a357_0x5153fb=a357_0x3d6a;(function(_0x18ea79,_0x59e7aa){const _0x490b7d=a357_0x3d6a,_0x3bd3e7=_0x18ea79();while(!![]){try{const _0x1f8168=parseInt(_0x490b7d(0x95))/0x1*(-parseInt(_0x490b7d(0x86))/0x2)+-parseInt(_0x490b7d(0xf4))/0x3*(parseInt(_0x490b7d(0xa5))/0x4)+-parseInt(_0x490b7d(0xc0))/0x5*(-parseInt(_0x490b7d(0x11c))/0x6)+-parseInt(_0x490b7d(0xab))/0x7*(-parseInt(_0x490b7d(0xa4))/0x8)+parseInt(_0x490b7d(0xf2))/0x9+-parseInt(_0x490b7d(0x118))/0xa+parseInt(_0x490b7d(0xc2))/0xb;if(_0x1f8168===_0x59e7aa)break;else _0x3bd3e7['push'](_0x3bd3e7['shift']());}catch(_0x2cf622){_0x3bd3e7['push'](_0x3bd3e7['shift']());}}}(a357_0x2c13,0x40deb));const a357_0x2c4fff=(function(){let _0x4f621d=!![];return function(_0x3fb6be,_0x444696){const _0x4d3a91=_0x4f621d?function(){const _0xc0842f=a357_0x3d6a;if(_0x444696){const _0xfe21c9=_0x444696[_0xc0842f(0xd4)](_0x3fb6be,arguments);return _0x444696=null,_0xfe21c9;}}:function(){};return _0x4f621d=![],_0x4d3a91;};}()),a357_0x47dcbd=a357_0x2c4fff(this,function(){const _0x27f51c=a357_0x3d6a;return a357_0x47dcbd[_0x27f51c(0xcb)]()['search'](_0x27f51c(0x11a))['toString']()[_0x27f51c(0xc7)](a357_0x47dcbd)['search']('(((.+)+)+)+$');});a357_0x47dcbd();'use strict';var __importDefault=this&&this['__importDefault']||function(_0xcbeb8c){return _0xcbeb8c&&_0xcbeb8c['__esModule']?_0xcbeb8c:{'default':_0xcbeb8c};};Object[a357_0x5153fb(0x114)](exports,a357_0x5153fb(0x9f),{'value':!![]}),exports[a357_0x5153fb(0xa0)]=void 0x0;function a357_0x3d6a(_0x3c4980,_0x39832c){const _0x2379ac=a357_0x2c13();return a357_0x3d6a=function(_0x47dcbd,_0x2c4fff){_0x47dcbd=_0x47dcbd-0x81;let _0x2c1381=_0x2379ac[_0x47dcbd];return _0x2c1381;},a357_0x3d6a(_0x3c4980,_0x39832c);}const jszip_1=__importDefault(require(a357_0x5153fb(0x8b))),promises_1=require(a357_0x5153fb(0x124)),constants_1=require(a357_0x5153fb(0xcf)),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require(a357_0x5153fb(0x9b)),salesforce_service_1=require(a357_0x5153fb(0xbd)),core_1=require(a357_0x5153fb(0xd6)),status_enums_1=require(a357_0x5153fb(0x11f)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),shortid_1=__importDefault(require(a357_0x5153fb(0x109))),fetch_attachments_1=require(a357_0x5153fb(0x10d)),package_import_service_1=require('./package-import.service'),branch_component_history_flosum_component_retriever_1=require(a357_0x5153fb(0x122)),flosum_component_veeva_component_retriever_1=require(a357_0x5153fb(0xd9)),package_export_service_1=require(a357_0x5153fb(0xfc)),vpk_service_1=require(a357_0x5153fb(0x103)),zip_creator_deploy_1=require(a357_0x5153fb(0xc5));class DeployService{constructor(_0x3a1351,_0x24ce8b,_0x45c7cd,_0x2d5558,_0x291ead,_0xf23446){const _0x4f5cd2=a357_0x5153fb;this['_connectionSalesforce']=_0x24ce8b,this['_connectionVeeva']=_0x45c7cd,this[_0x4f5cd2(0x10a)]=_0x2d5558,this[_0x4f5cd2(0xd1)]=_0x291ead,this['_instanceUrl']=_0xf23446,this['_branchId']=_0x3a1351[_0x4f5cd2(0x116)],this['_metadataLogId']=_0x3a1351[_0x4f5cd2(0x128)],this['_attachmentLogId']=_0x3a1351[_0x4f5cd2(0xfa)],this[_0x4f5cd2(0x105)]=_0x3a1351[_0x4f5cd2(0xdd)],this[_0x4f5cd2(0xd8)]=_0x3a1351[_0x4f5cd2(0x102)],this[_0x4f5cd2(0x12b)]=_0x3a1351[_0x4f5cd2(0xaf)],this[_0x4f5cd2(0x101)]=_0x3a1351[_0x4f5cd2(0xe9)],this[_0x4f5cd2(0xb7)]=_0x3a1351[_0x4f5cd2(0x111)],this[_0x4f5cd2(0x12d)]=new core_1[(_0x4f5cd2(0xdc))](_0x4f5cd2(0x106)),this['_veevaService']=new veeva_service_1[(_0x4f5cd2(0x99))]({'connection':this[_0x4f5cd2(0xf6)],'logger':this['_logger']}),this[_0x4f5cd2(0x12e)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x4f5cd2(0xc6)]}),this['_packageImportService']=new package_import_service_1['PackageImportService']({'veevaService':this[_0x4f5cd2(0x120)],'connection':this['_connectionVeeva'],'logger':this[_0x4f5cd2(0x10a)],'saveLog':this[_0x4f5cd2(0xc1)][_0x4f5cd2(0xe0)](this)}),this[_0x4f5cd2(0xa3)]=new package_export_service_1[(_0x4f5cd2(0xbb))]({'veevaService':this['_veevaService'],'connection':this[_0x4f5cd2(0xf6)],'logger':this[_0x4f5cd2(0x10a)]}),this['_vpkService']=new vpk_service_1[(_0x4f5cd2(0x8a))]({'connection':this[_0x4f5cd2(0xf6)]});}async[a357_0x5153fb(0xb4)](){const _0x423c16=a357_0x5153fb;try{const _0x494c3a=await this['getFlosumComponents']();await this[_0x423c16(0x10a)]['updateLog']();const _0x10f496=await this[_0x423c16(0xae)](_0x494c3a);await this[_0x423c16(0x94)](_0x10f496);const _0x423bdf=await this[_0x423c16(0xe2)](_0x494c3a),_0xa61922=await this[_0x423c16(0x119)](_0x423bdf),_0x286473=await this['createVpk'](_0xa61922);await this[_0x423c16(0x10a)][_0x423c16(0x10f)]();const _0x11fbfe=await this[_0x423c16(0xef)][_0x423c16(0xcc)](_0x286473);await this[_0x423c16(0x10a)]['updateLog']();const _0x16cd9b=this[_0x423c16(0xd3)](_0x494c3a,_0x11fbfe[_0x423c16(0x11b)]);await this['saveDeploymentResults'](_0x16cd9b),await this[_0x423c16(0x91)](_0x11fbfe[_0x423c16(0xaa)],![],_0x11fbfe[_0x423c16(0xb2)]);}catch(_0x47eecc){await this[_0x423c16(0x117)](_0x47eecc)[_0x423c16(0xc4)](_0x369c9d=>this[_0x423c16(0x12d)][_0x423c16(0x11e)](_0x369c9d));}}async[a357_0x5153fb(0xce)](){const _0x278d85=a357_0x5153fb,_0x4d66c1=new Set(this[_0x278d85(0x101)]);this['_logger'][_0x278d85(0xe5)]('Retrieving\x20components');const _0x17433d=await new branch_component_history_flosum_component_retriever_1['BranchComponentHistoryFlosumComponentRetriever']({'value':this[_0x278d85(0xbf)],'salesforceService':this[_0x278d85(0x12e)]})[_0x278d85(0xfb)](),_0x46883f=_0x17433d['filter'](_0x269fc6=>_0x4d66c1[_0x278d85(0x98)](_0x269fc6['id']));if(_0x46883f['length']!==this['_componentIdList'][_0x278d85(0xc8)])throw new Error(_0x278d85(0xb8));return _0x46883f;}async[a357_0x5153fb(0xae)](_0x2b7469){const _0x3a2646=a357_0x5153fb;var _0x33feb0;this[_0x3a2646(0x10a)]['log']('Create\x20Backup');const _0x3c9029=await new flosum_component_veeva_component_retriever_1[(_0x3a2646(0x87))]({'value':_0x2b7469,'veevaService':this['_veevaService'],'logger':this[_0x3a2646(0x10a)]})['retrieve'](),_0xa6c9f5=await this[_0x3a2646(0xa3)][_0x3a2646(0xa8)](_0x3c9029,_0x3a2646(0xa9));if(_0xa6c9f5[_0x3a2646(0xc8)]>0x1)throw new Error(_0x3a2646(0xdf));return(_0x33feb0=_0xa6c9f5[0x0])!==null&&_0x33feb0!==void 0x0?_0x33feb0:_0xa6c9f5[0x0]=new jszip_1[(_0x3a2646(0xcd))](),_0xa6c9f5[0x0]['generateAsync']({'type':_0x3a2646(0xc9)});}async[a357_0x5153fb(0x94)](_0x33cedd){const _0x3927c3=a357_0x5153fb;this['_logger'][_0x3927c3(0xe5)](_0x3927c3(0xdb));const _0x24b0b5={'Body':_0x33cedd,'ContentType':_0x3927c3(0xa2),'ParentId':this[_0x3927c3(0xb6)],'Name':flosum_constants_1[_0x3927c3(0x82)][_0x3927c3(0x108)]};await this[_0x3927c3(0xc6)][_0x3927c3(0xac)](flosum_constants_1['FlosumConstants'][_0x3927c3(0x10e)]+_0x3927c3(0xed),_0x24b0b5);}async[a357_0x5153fb(0xe2)](_0x527b5b){const _0x5ce2bd=a357_0x5153fb;this['_logger'][_0x5ce2bd(0xe5)](_0x5ce2bd(0x115));const _0x27b000=await(0x0,fetch_attachments_1[_0x5ce2bd(0x123)])(this[_0x5ce2bd(0xc6)],_0x527b5b[_0x5ce2bd(0xfd)](_0x413014=>_0x413014['componentHistoryId'])),_0x333a1f=await(0x0,fetch_attachments_1['retrieveAttachments'])(_0x27b000,this[_0x5ce2bd(0xc6)]);if(_0x333a1f['length']!==this[_0x5ce2bd(0x101)][_0x5ce2bd(0xc8)])throw new Error(_0x5ce2bd(0x97));return _0x333a1f[_0x5ce2bd(0xfd)](_0x34b19d=>_0x34b19d[_0x5ce2bd(0xbe)][_0x5ce2bd(0x125)]);}async['createZip'](_0xba9e0e){const _0x199d64=a357_0x5153fb;this['_logger'][_0x199d64(0xe5)](_0x199d64(0xe7));const _0x3cd8d2=await new zip_creator_deploy_1[(_0x199d64(0x107))]({'attachmentBodies':_0xba9e0e,'deploymentName':this[_0x199d64(0xb7)]})[_0x199d64(0xb4)](),_0x415600=this[_0x199d64(0xd1)]+'/'+(0x0,shortid_1[_0x199d64(0xcd)])()+_0x199d64(0xea);return await(0x0,promises_1[_0x199d64(0xda)])(_0x415600,_0x3cd8d2),_0x415600;}async[a357_0x5153fb(0xb0)](_0x17d02b){const _0x5110c3=a357_0x5153fb;this['_logger']['log'](_0x5110c3(0x10b));const _0x3b4a9f=await this[_0x5110c3(0xe4)][_0x5110c3(0xec)](_0x17d02b),_0x29e8cb=this['_tempFolder']+_0x5110c3(0xb9)+_0x17d02b[_0x5110c3(0xf0)](_0x17d02b['lastIndexOf']('/')+0x1);return await(0x0,promises_1['writeFile'])(_0x29e8cb,_0x3b4a9f),await this[_0x5110c3(0xe4)]['validate'](_0x29e8cb),_0x29e8cb;}async['saveLog'](_0x74105d,_0x175bc9){const _0x3c40c0=a357_0x5153fb;this['_logger'][_0x3c40c0(0xe5)](_0x3c40c0(0x113));const _0x13f170={'Body':Buffer['from'](_0x74105d)[_0x3c40c0(0xcb)](_0x3c40c0(0xc9)),'ContentType':_0x3c40c0(0xee),'ParentId':this[_0x3c40c0(0xb6)],'Name':_0x175bc9};await this[_0x3c40c0(0xc6)]['post'](flosum_constants_1[_0x3c40c0(0x82)][_0x3c40c0(0x10e)]+_0x3c40c0(0xed),_0x13f170);}[a357_0x5153fb(0xd3)](_0x5ea048,_0x1d6d67){const _0xe482e4=a357_0x5153fb;this[_0xe482e4(0x10a)][_0xe482e4(0xe5)]('Form\x20Deployment\x20Results');const _0x4141ef=_0x5ea048[_0xe482e4(0x93)]((_0x53024d,_0x588d2e)=>_0x53024d[_0xe482e4(0xa1)]((_0x588d2e['componentType']+'.'+_0x588d2e[_0xe482e4(0xf9)])[_0xe482e4(0x100)](),_0x588d2e),new Map());return _0x1d6d67[_0xe482e4(0xfd)](_0x1054df=>{const _0x4a211d=_0xe482e4;this['_logger']['log'](_0x1054df[_0x4a211d(0xe1)]+'.'+_0x1054df[_0x4a211d(0xe6)]+_0x4a211d(0xd5)+_0x1054df[_0x4a211d(0x83)]);const _0xb7f788=(_0x1054df[_0x4a211d(0xe1)]+'.'+_0x1054df['name'])[_0x4a211d(0x100)](),_0x3e0a9c=_0x4141ef[_0x4a211d(0xba)](_0xb7f788);return{[constants_1['FLOSUM_NAMESPACE']+'Type__c']:_0x4a211d(0xeb),[constants_1['FLOSUM_NAMESPACE']+_0x4a211d(0x85)]:_0x1054df[_0x4a211d(0x83)]===status_enums_1['PackageComponentStatus'][_0x4a211d(0x11d)]?_0x4a211d(0xf8):_0x4a211d(0xf7),[constants_1[_0x4a211d(0xe3)]+'Result__c']:_0x1054df[_0x4a211d(0x12a)],[constants_1[_0x4a211d(0xe3)]+_0x4a211d(0x121)]:_0x1054df[_0x4a211d(0xe6)],[constants_1[_0x4a211d(0xe3)]+_0x4a211d(0x88)]:_0x1054df[_0x4a211d(0xe1)],[constants_1['FLOSUM_NAMESPACE']+_0x4a211d(0xf1)]:_0x1054df[_0x4a211d(0x10c)],[constants_1['FLOSUM_NAMESPACE']+_0x4a211d(0xde)]:this[_0x4a211d(0x105)],[constants_1[_0x4a211d(0xe3)]+_0x4a211d(0x89)]:this['_metadataLogId'],[constants_1['FLOSUM_NAMESPACE']+_0x4a211d(0x126)]:_0x3e0a9c['componentHistoryId']};});}async[a357_0x5153fb(0xb5)](_0x5d9527){const _0x150189=a357_0x5153fb;this[_0x150189(0x10a)]['log'](_0x150189(0x9c));const _0x529ad7=await this[_0x150189(0x12e)][_0x150189(0xf5)](constants_1['FLOSUM_NAMESPACE']+'Deployment_Result__c',_0x5d9527),_0x317f98=_0x529ad7[_0x150189(0x8f)](_0x469a3f=>!_0x469a3f[_0x150189(0xd7)])[_0x150189(0xfd)](_0x479484=>_0x479484[_0x150189(0xca)])[_0x150189(0xf3)]();if(_0x317f98[_0x150189(0xc8)])throw new salesforce_dml_error_1[(_0x150189(0xd0))](_0x317f98);}async['finishDeployWithError'](_0x5b3cd1){const _0x30f30d=a357_0x5153fb;this['_logger'][_0x30f30d(0x12c)](_0x5b3cd1),await this[_0x30f30d(0x10a)]['updateLog'](),await this['finishDeploy'](![],!![],'');}async[a357_0x5153fb(0x91)](_0x214e70,_0x70f7df,_0x422332){const _0x1e08ba=a357_0x5153fb,_0x123ecb=_0x1e08ba(0x9a)+this[_0x1e08ba(0xb1)]+'/'+this[_0x1e08ba(0xb6)]+_0x1e08ba(0xe8)+_0x1e08ba(0x8d)+_0x1e08ba(0x110),_0x2ffb90=_0x1e08ba(0x9a)+this[_0x1e08ba(0xb1)]+'/'+this[_0x1e08ba(0x105)]+'\x20>'+this[_0x1e08ba(0x12b)]+_0x1e08ba(0x92),_0x2c14a7=_0x123ecb+_0x1e08ba(0x8c)+_0x2ffb90+_0x1e08ba(0xff),_0x36989a={[constants_1[_0x1e08ba(0xe3)]+_0x1e08ba(0x9d)]:_0x2c14a7,[constants_1[_0x1e08ba(0xe3)]+_0x1e08ba(0x90)]:new Date(),[constants_1[_0x1e08ba(0xe3)]+'Branch__c']:this[_0x1e08ba(0xbf)],[constants_1[_0x1e08ba(0xe3)]+_0x1e08ba(0xa7)]:_0x1e08ba(0xfe),[constants_1[_0x1e08ba(0xe3)]+_0x1e08ba(0x84)]:_0x1e08ba(0x112),[constants_1['FLOSUM_NAMESPACE']+_0x1e08ba(0x104)]:this[_0x1e08ba(0x105)]},_0x47cf71={[constants_1[_0x1e08ba(0xe3)]+_0x1e08ba(0xad)]:!_0x214e70,[constants_1[_0x1e08ba(0xe3)]+_0x1e08ba(0x81)]:_0x214e70,[constants_1[_0x1e08ba(0xe3)]+'Status__c']:_0x70f7df?status_enums_1[_0x1e08ba(0xbc)][_0x1e08ba(0xc3)]:status_enums_1[_0x1e08ba(0xbc)][_0x1e08ba(0xd2)],[constants_1[_0x1e08ba(0xe3)]+_0x1e08ba(0x127)]:!![],[constants_1['FLOSUM_NAMESPACE']+_0x1e08ba(0xb3)]:_0x422332};await this[_0x1e08ba(0xc6)][_0x1e08ba(0x129)](flosum_constants_1[_0x1e08ba(0x82)][_0x1e08ba(0x10e)]+'/'+constants_1[_0x1e08ba(0xe3)]+_0x1e08ba(0xa6)+this['_metadataLogId'],_0x47cf71),await this['_connectionSalesforce']['post'](flosum_constants_1[_0x1e08ba(0x82)][_0x1e08ba(0x10e)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x1e08ba(0x8e),_0x36989a),this[_0x1e08ba(0x10a)][_0x1e08ba(0xe5)](_0x1e08ba(0x9e)+(_0x214e70?_0x1e08ba(0x96):'with\x20error')+'.'),await this[_0x1e08ba(0x10a)]['updateLog']();}}exports['DeployService']=DeployService;