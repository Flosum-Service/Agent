function a402_0xd488(){const _0x233005=['type','isDeployed','generate','__esModule','./package-import.service','reduce','finishDeployWithError','./veeva.service','Save\x20log','Join\x20all\x20mdl\x20into\x20one\x20zip','Status__c','Result__c','slice','Create\x20vpk\x20package','../enums/status.enums','ENDPOINT_UPSERT_RECORD','Deployment_Result__c','name','_componentIdList','./package-export.service','External_Deployment_Id__c','Job_Completed__c','_organisationName','jszip','veeva-deploy','_packageExportService','errors','createZip','__importDefault','Date__c','TargetId__c','retrieveAttachments','saveBackup','Component_Name__c','status','COMPLETED','values','_metadataLogId','../../../core','_connectionSalesforce','Type__c','length','VpkService','_salesforceService','componentName','3432141YDYPWA','_packageImportService','search','\x20</a>','deploymentName','Branch','componentType','EXCEPTION','Backup','_instanceUrl','BACKUP_ZIP_NAME','_vpkService','fetchAttachmentsDetailsByParentId','_timeZone','(((.+)+)+)+$','_systemLogger','/Attachment','PackageImportService','createBackup','toLowerCase','apply','retrieve','with\x20error','20QkziWi','map','toString','<a\x20href=','Retrieving\x20components','Log__c','Cannot\x20Backup\x20more\x20than\x20200\x20components.','./salesforce.service','../../../constants','Retrieving\x20attachments','\x20:\x20','FLOSUM_NAMESPACE','1048275VILunh','saveLog','saveDeploymentResults','writeFile','packageComponentList','2090130oPImRb','Component_History__c','DeployService','SalesforceDmlError','FlosumConstants','deploymentAction','1776888Rizhsp','default','from','\x20has\x20been\x20created.','.zip','application/zip','ZipCreatorDeploy','filter','text/plain','organisationId','_tempFolder','PackageComponentStatus','100495UnEApx','/vpk__','_connectionVeeva','Succeed__c','Org__c','metadataLogId','success','_veevaService','set','Veeva_Step_Name__c','MetadataLogStatus','Metadata_Log__c/','attachmentLogId','Save\x20Deployment\x20Results','shortid','log','3iCkOVQ','_attachmentLogId','formFlosumDeploymentResults','patch','../classes/retrievers/veeva-components/flosum-component.veeva-component.retriever','Cannot\x20retrieve\x20all\x20components.','updateLog','_branchId','lastIndexOf','getFlosumComponents','Component_Type__c','base64','export','has','defineProperty','execute','packageId','143564ogDEBm','createVpk','validate','_organisationId','post','VeevaService','Branch__c','flat','organisationName','Cannot\x20retrievers\x20all\x20attachments','</a>','BranchComponentHistoryFlosumComponentRetriever','80dcgwHg','DEPLOYED','_logger','Save\x20Backup\x20to\x20Salesforce','\x20>\x20','PackageExportService','successfully','Activity_Type__c','timeZone','branchId','catch','3665022qpGXAO','finishDeploy','../classes/deploy/zip-creator.deploy','Veeva\x20Deployment','./vpk.service','constructor'];a402_0xd488=function(){return _0x233005;};return a402_0xd488();}const a402_0x57c620=a402_0x2c7e;(function(_0x4b9faa,_0x168706){const _0x99e608=a402_0x2c7e,_0xd30710=_0x4b9faa();while(!![]){try{const _0x50eda9=-parseInt(_0x99e608(0x228))/0x1+parseInt(_0x99e608(0x1bb))/0x2*(-parseInt(_0x99e608(0x24f))/0x3)+-parseInt(_0x99e608(0x1c7))/0x4*(-parseInt(_0x99e608(0x23f))/0x5)+parseInt(_0x99e608(0x1d2))/0x6+-parseInt(_0x99e608(0x22d))/0x7+parseInt(_0x99e608(0x233))/0x8+-parseInt(_0x99e608(0x205))/0x9*(-parseInt(_0x99e608(0x21c))/0xa);if(_0x50eda9===_0x168706)break;else _0xd30710['push'](_0xd30710['shift']());}catch(_0x27b151){_0xd30710['push'](_0xd30710['shift']());}}}(a402_0xd488,0x8d5a3));const a402_0x264308=(function(){let _0x4f213e=!![];return function(_0x52a2d1,_0x4968a3){const _0x5173f3=_0x4f213e?function(){const _0x599a02=a402_0x2c7e;if(_0x4968a3){const _0x26633d=_0x4968a3[_0x599a02(0x219)](_0x52a2d1,arguments);return _0x4968a3=null,_0x26633d;}}:function(){};return _0x4f213e=![],_0x5173f3;};}()),a402_0x541ef8=a402_0x264308(this,function(){const _0x283511=a402_0x2c7e;return a402_0x541ef8[_0x283511(0x21e)]()['search'](_0x283511(0x213))[_0x283511(0x21e)]()[_0x283511(0x1d7)](a402_0x541ef8)[_0x283511(0x207)]('(((.+)+)+)+$');});a402_0x541ef8();'use strict';var __importDefault=this&&this[a402_0x57c620(0x1f4)]||function(_0x2bea4f){const _0x8dc12a=a402_0x57c620;return _0x2bea4f&&_0x2bea4f[_0x8dc12a(0x1db)]?_0x2bea4f:{'default':_0x2bea4f};};Object[a402_0x57c620(0x1b8)](exports,a402_0x57c620(0x1db),{'value':!![]}),exports[a402_0x57c620(0x22f)]=void 0x0;const jszip_1=__importDefault(require(a402_0x57c620(0x1ef))),promises_1=require('fs/promises'),constants_1=require(a402_0x57c620(0x224)),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require(a402_0x57c620(0x1df)),salesforce_service_1=require(a402_0x57c620(0x223)),core_1=require(a402_0x57c620(0x1fe)),status_enums_1=require(a402_0x57c620(0x1e6)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),shortid_1=__importDefault(require(a402_0x57c620(0x24d))),fetch_attachments_1=require('../../shared/utils/fetch-attachments'),package_import_service_1=require(a402_0x57c620(0x1dc)),branch_component_history_flosum_component_retriever_1=require('../classes/retrievers/flosum-components/branch-component-history.flosum-component.retriever'),flosum_component_veeva_component_retriever_1=require(a402_0x57c620(0x1ae)),package_export_service_1=require(a402_0x57c620(0x1eb)),vpk_service_1=require(a402_0x57c620(0x1d6)),zip_creator_deploy_1=require(a402_0x57c620(0x1d4));class DeployService{constructor(_0x403932,_0x856788,_0x16e119,_0x4c71de,_0x251ad5,_0x3c0e16){const _0x5e6ec0=a402_0x57c620;this['_connectionSalesforce']=_0x856788,this[_0x5e6ec0(0x241)]=_0x16e119,this[_0x5e6ec0(0x1c9)]=_0x4c71de,this[_0x5e6ec0(0x23d)]=_0x251ad5,this[_0x5e6ec0(0x20e)]=_0x3c0e16,this['_branchId']=_0x403932[_0x5e6ec0(0x1d0)],this[_0x5e6ec0(0x1fd)]=_0x403932[_0x5e6ec0(0x244)],this[_0x5e6ec0(0x250)]=_0x403932[_0x5e6ec0(0x24b)],this['_organisationId']=_0x403932[_0x5e6ec0(0x23c)],this[_0x5e6ec0(0x212)]=_0x403932[_0x5e6ec0(0x1cf)],this[_0x5e6ec0(0x1ee)]=_0x403932[_0x5e6ec0(0x1c3)],this['_componentIdList']=_0x403932['componentIdList'],this['_deploymentName']=_0x403932[_0x5e6ec0(0x209)],this[_0x5e6ec0(0x214)]=new core_1['Logger'](_0x5e6ec0(0x1f0)),this[_0x5e6ec0(0x246)]=new veeva_service_1[(_0x5e6ec0(0x1c0))]({'connection':this['_connectionVeeva'],'logger':this[_0x5e6ec0(0x1c9)]}),this['_salesforceService']=new salesforce_service_1['SalesforceService']({'connection':this[_0x5e6ec0(0x1ff)]}),this[_0x5e6ec0(0x206)]=new package_import_service_1[(_0x5e6ec0(0x216))]({'veevaService':this['_veevaService'],'connection':this[_0x5e6ec0(0x241)],'logger':this['_logger'],'saveLog':this[_0x5e6ec0(0x229)]['bind'](this)}),this[_0x5e6ec0(0x1f1)]=new package_export_service_1[(_0x5e6ec0(0x1cc))]({'veevaService':this['_veevaService'],'connection':this['_connectionVeeva'],'logger':this['_logger']}),this['_vpkService']=new vpk_service_1[(_0x5e6ec0(0x202))]({'connection':this['_connectionVeeva']});}async[a402_0x57c620(0x1b9)](){const _0x2d25ad=a402_0x57c620;try{const _0x32716b=await this[_0x2d25ad(0x1b3)]();await this[_0x2d25ad(0x1c9)][_0x2d25ad(0x1b0)]();const _0x36b4df=await this[_0x2d25ad(0x217)](_0x32716b);await this[_0x2d25ad(0x1f8)](_0x36b4df);const _0x5a06cc=await this[_0x2d25ad(0x1f7)](_0x32716b),_0x3d9080=await this['createZip'](_0x5a06cc),_0x3f8990=await this['createVpk'](_0x3d9080);await this[_0x2d25ad(0x1c9)][_0x2d25ad(0x1b0)]();const _0x3443a1=await this[_0x2d25ad(0x206)]['import'](_0x3f8990);await this[_0x2d25ad(0x1c9)]['updateLog']();const _0x228461=this['formFlosumDeploymentResults'](_0x32716b,_0x3443a1[_0x2d25ad(0x22c)]);await this['saveDeploymentResults'](_0x228461),await this[_0x2d25ad(0x1d3)](_0x3443a1[_0x2d25ad(0x1d9)],![],_0x3443a1[_0x2d25ad(0x1ba)]);}catch(_0x2b5888){await this[_0x2d25ad(0x1de)](_0x2b5888)[_0x2d25ad(0x1d1)](_0x2262e7=>this[_0x2d25ad(0x214)]['error'](_0x2262e7));}}async[a402_0x57c620(0x1b3)](){const _0x486e43=a402_0x57c620,_0x32eba2=new Set(this[_0x486e43(0x1ea)]);this[_0x486e43(0x1c9)][_0x486e43(0x24e)](_0x486e43(0x220));const _0x263ed7=await new branch_component_history_flosum_component_retriever_1[(_0x486e43(0x1c6))]({'value':this[_0x486e43(0x1b1)],'salesforceService':this[_0x486e43(0x203)]})[_0x486e43(0x21a)](),_0x1f14f3=_0x263ed7[_0x486e43(0x23a)](_0x1d257b=>_0x32eba2[_0x486e43(0x1b7)](_0x1d257b['id']));if(_0x1f14f3[_0x486e43(0x201)]!==this[_0x486e43(0x1ea)][_0x486e43(0x201)])throw new Error(_0x486e43(0x1af));return _0x1f14f3;}async[a402_0x57c620(0x217)](_0x5c8161){const _0x5f02bc=a402_0x57c620;var _0x4c10f9;this[_0x5f02bc(0x1c9)][_0x5f02bc(0x24e)]('Create\x20Backup');const _0x50c8b9=await new flosum_component_veeva_component_retriever_1['FlosumComponentVeevaComponentRetriever']({'value':_0x5c8161,'veevaService':this['_veevaService'],'logger':this[_0x5f02bc(0x1c9)]})[_0x5f02bc(0x21a)](),_0x9c0d8=await this[_0x5f02bc(0x1f1)][_0x5f02bc(0x1b6)](_0x50c8b9,_0x5f02bc(0x20d));if(_0x9c0d8['length']>0x1)throw new Error(_0x5f02bc(0x222));return(_0x4c10f9=_0x9c0d8[0x0])!==null&&_0x4c10f9!==void 0x0?_0x4c10f9:_0x9c0d8[0x0]=new jszip_1[(_0x5f02bc(0x234))](),_0x9c0d8[0x0]['generateAsync']({'type':_0x5f02bc(0x1b5)});}async[a402_0x57c620(0x1f8)](_0x4d8dd5){const _0x307a7c=a402_0x57c620;this[_0x307a7c(0x1c9)][_0x307a7c(0x24e)](_0x307a7c(0x1ca));const _0x5400bc={'Body':_0x4d8dd5,'ContentType':_0x307a7c(0x238),'ParentId':this['_metadataLogId'],'Name':flosum_constants_1[_0x307a7c(0x231)][_0x307a7c(0x20f)]};await this['_connectionSalesforce']['post'](flosum_constants_1['FlosumConstants'][_0x307a7c(0x1e7)]+'/Attachment',_0x5400bc);}async[a402_0x57c620(0x1f7)](_0x181380){const _0x1d8573=a402_0x57c620;this[_0x1d8573(0x1c9)][_0x1d8573(0x24e)](_0x1d8573(0x225));const _0x35d7b6=await(0x0,fetch_attachments_1[_0x1d8573(0x211)])(this[_0x1d8573(0x1ff)],_0x181380[_0x1d8573(0x21d)](_0x2f0f3a=>_0x2f0f3a['componentHistoryId'])),_0x485b3c=await(0x0,fetch_attachments_1[_0x1d8573(0x1f7)])(_0x35d7b6,this['_connectionSalesforce']);if(_0x485b3c['length']!==this[_0x1d8573(0x1ea)][_0x1d8573(0x201)])throw new Error(_0x1d8573(0x1c4));return _0x485b3c[_0x1d8573(0x21d)](_0x4d84e3=>_0x4d84e3[_0x1d8573(0x1fc)]['Body']);}async[a402_0x57c620(0x1f3)](_0x1d8240){const _0x59d16e=a402_0x57c620;this['_logger'][_0x59d16e(0x24e)](_0x59d16e(0x1e1));const _0x18735d=await new zip_creator_deploy_1[(_0x59d16e(0x239))]({'attachmentBodies':_0x1d8240,'deploymentName':this['_deploymentName']})['execute'](),_0x212bf1=this[_0x59d16e(0x23d)]+'/'+(0x0,shortid_1[_0x59d16e(0x234)])()+_0x59d16e(0x237);return await(0x0,promises_1[_0x59d16e(0x22b)])(_0x212bf1,_0x18735d),_0x212bf1;}async[a402_0x57c620(0x1bc)](_0x132d72){const _0x343f0e=a402_0x57c620;this['_logger']['log'](_0x343f0e(0x1e5));const _0x47df73=await this[_0x343f0e(0x210)][_0x343f0e(0x1da)](_0x132d72),_0x55bf70=this[_0x343f0e(0x23d)]+_0x343f0e(0x240)+_0x132d72[_0x343f0e(0x1e4)](_0x132d72[_0x343f0e(0x1b2)]('/')+0x1);return await(0x0,promises_1[_0x343f0e(0x22b)])(_0x55bf70,_0x47df73),await this[_0x343f0e(0x210)][_0x343f0e(0x1bd)](_0x55bf70),_0x55bf70;}async['saveLog'](_0x2a15c4,_0x4dbf94){const _0x3dadc4=a402_0x57c620;this[_0x3dadc4(0x1c9)][_0x3dadc4(0x24e)](_0x3dadc4(0x1e0));const _0x123010={'Body':Buffer[_0x3dadc4(0x235)](_0x2a15c4)[_0x3dadc4(0x21e)](_0x3dadc4(0x1b5)),'ContentType':_0x3dadc4(0x23b),'ParentId':this[_0x3dadc4(0x1fd)],'Name':_0x4dbf94};await this[_0x3dadc4(0x1ff)][_0x3dadc4(0x1bf)](flosum_constants_1[_0x3dadc4(0x231)][_0x3dadc4(0x1e7)]+_0x3dadc4(0x215),_0x123010);}[a402_0x57c620(0x251)](_0x550f88,_0x696457){const _0x2cf857=a402_0x57c620;this[_0x2cf857(0x1c9)][_0x2cf857(0x24e)]('Form\x20Deployment\x20Results');const _0x55b208=_0x550f88[_0x2cf857(0x1dd)]((_0x24c469,_0x27b0bf)=>_0x24c469[_0x2cf857(0x247)]((_0x27b0bf[_0x2cf857(0x20b)]+'.'+_0x27b0bf[_0x2cf857(0x204)])[_0x2cf857(0x218)](),_0x27b0bf),new Map());return _0x696457[_0x2cf857(0x21d)](_0x42ac1d=>{const _0x4d9285=_0x2cf857;this[_0x4d9285(0x1c9)]['log'](_0x42ac1d[_0x4d9285(0x1d8)]+'.'+_0x42ac1d[_0x4d9285(0x1e9)]+_0x4d9285(0x226)+_0x42ac1d[_0x4d9285(0x1fa)]);const _0xcd25af=(_0x42ac1d[_0x4d9285(0x1d8)]+'.'+_0x42ac1d['name'])[_0x4d9285(0x218)](),_0xc53290=_0x55b208['get'](_0xcd25af);return{[constants_1[_0x4d9285(0x227)]+_0x4d9285(0x200)]:'Deployment\x20Result',[constants_1['FLOSUM_NAMESPACE']+_0x4d9285(0x1e2)]:_0x42ac1d[_0x4d9285(0x1fa)]===status_enums_1[_0x4d9285(0x23e)][_0x4d9285(0x1c8)]?'Success':'Failure',[constants_1[_0x4d9285(0x227)]+_0x4d9285(0x1e3)]:_0x42ac1d[_0x4d9285(0x232)],[constants_1['FLOSUM_NAMESPACE']+_0x4d9285(0x1f9)]:_0x42ac1d[_0x4d9285(0x1e9)],[constants_1[_0x4d9285(0x227)]+_0x4d9285(0x1b4)]:_0x42ac1d['type'],[constants_1['FLOSUM_NAMESPACE']+_0x4d9285(0x248)]:_0x42ac1d['stepName'],[constants_1[_0x4d9285(0x227)]+_0x4d9285(0x243)]:this[_0x4d9285(0x1be)],[constants_1[_0x4d9285(0x227)]+'Metadata_Log__c']:this[_0x4d9285(0x1fd)],[constants_1[_0x4d9285(0x227)]+_0x4d9285(0x22e)]:_0xc53290['componentHistoryId']};});}async[a402_0x57c620(0x22a)](_0x5399fe){const _0x2ccea1=a402_0x57c620;this[_0x2ccea1(0x1c9)][_0x2ccea1(0x24e)](_0x2ccea1(0x24c));const _0x24f42e=await this[_0x2ccea1(0x203)]['insertMultipleRecords'](constants_1[_0x2ccea1(0x227)]+_0x2ccea1(0x1e8),_0x5399fe),_0x5cbf24=_0x24f42e[_0x2ccea1(0x23a)](_0x4f46ef=>!_0x4f46ef[_0x2ccea1(0x245)])[_0x2ccea1(0x21d)](_0x5a9022=>_0x5a9022[_0x2ccea1(0x1f2)])[_0x2ccea1(0x1c2)]();if(_0x5cbf24['length'])throw new salesforce_dml_error_1[(_0x2ccea1(0x230))](_0x5cbf24);}async[a402_0x57c620(0x1de)](_0x2e6ef9){const _0x2437ad=a402_0x57c620;this[_0x2437ad(0x1c9)]['logError'](_0x2e6ef9),await this[_0x2437ad(0x1c9)][_0x2437ad(0x1b0)](),await this[_0x2437ad(0x1d3)](![],!![],'');}async[a402_0x57c620(0x1d3)](_0x5a47d5,_0xa3c9db,_0x3fa9ee){const _0x321b22=a402_0x57c620,_0x565f27='<a\x20href='+this[_0x321b22(0x20e)]+'/'+this[_0x321b22(0x1fd)]+_0x321b22(0x1cb)+_0x321b22(0x1d5)+_0x321b22(0x208),_0x36e6c0=_0x321b22(0x21f)+this[_0x321b22(0x20e)]+'/'+this[_0x321b22(0x1be)]+'\x20>'+this[_0x321b22(0x1ee)]+_0x321b22(0x1c5),_0x4d1efd=_0x565f27+'\x20of\x20branch\x20to\x20Organization\x20'+_0x36e6c0+_0x321b22(0x236),_0x19a9ec={[constants_1['FLOSUM_NAMESPACE']+'Action__c']:_0x4d1efd,[constants_1[_0x321b22(0x227)]+_0x321b22(0x1f5)]:new Date(),[constants_1[_0x321b22(0x227)]+_0x321b22(0x1c1)]:this[_0x321b22(0x1b1)],[constants_1[_0x321b22(0x227)]+'Activity_Item__c']:_0x321b22(0x20a),[constants_1['FLOSUM_NAMESPACE']+_0x321b22(0x1ce)]:'Deployment',[constants_1['FLOSUM_NAMESPACE']+_0x321b22(0x1f6)]:this['_organisationId']},_0x5bf5a6={[constants_1[_0x321b22(0x227)]+'Is_Error__c']:!_0x5a47d5,[constants_1[_0x321b22(0x227)]+_0x321b22(0x242)]:_0x5a47d5,[constants_1[_0x321b22(0x227)]+_0x321b22(0x1e2)]:_0xa3c9db?status_enums_1[_0x321b22(0x249)][_0x321b22(0x20c)]:status_enums_1[_0x321b22(0x249)][_0x321b22(0x1fb)],[constants_1[_0x321b22(0x227)]+_0x321b22(0x1ed)]:!![],[constants_1[_0x321b22(0x227)]+_0x321b22(0x1ec)]:_0x3fa9ee};await this[_0x321b22(0x1ff)][_0x321b22(0x1ad)](flosum_constants_1[_0x321b22(0x231)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1['FLOSUM_NAMESPACE']+_0x321b22(0x24a)+this[_0x321b22(0x1fd)],_0x5bf5a6),await this[_0x321b22(0x1ff)][_0x321b22(0x1bf)](flosum_constants_1[_0x321b22(0x231)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x321b22(0x227)]+_0x321b22(0x221),_0x19a9ec),this[_0x321b22(0x1c9)][_0x321b22(0x24e)]('Deploy\x20completed\x20'+(_0x5a47d5?_0x321b22(0x1cd):_0x321b22(0x21b))+'.'),await this[_0x321b22(0x1c9)][_0x321b22(0x1b0)]();}}function a402_0x2c7e(_0x4cf9fc,_0x40fa86){const _0x2ba7f7=a402_0xd488();return a402_0x2c7e=function(_0x541ef8,_0x264308){_0x541ef8=_0x541ef8-0x1ad;let _0xd4886e=_0x2ba7f7[_0x541ef8];return _0xd4886e;},a402_0x2c7e(_0x4cf9fc,_0x40fa86);}exports[a402_0x57c620(0x22f)]=DeployService;