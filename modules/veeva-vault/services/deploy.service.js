const a358_0x3431c1=a358_0x1404;(function(_0x500611,_0x4c08f5){const _0x25c034=a358_0x1404,_0x3dcbad=_0x500611();while(!![]){try{const _0x1ebee9=parseInt(_0x25c034(0x15f))/0x1*(parseInt(_0x25c034(0x145))/0x2)+parseInt(_0x25c034(0x11e))/0x3*(-parseInt(_0x25c034(0x11b))/0x4)+-parseInt(_0x25c034(0x186))/0x5*(parseInt(_0x25c034(0x150))/0x6)+-parseInt(_0x25c034(0x15e))/0x7+-parseInt(_0x25c034(0x10f))/0x8+parseInt(_0x25c034(0x141))/0x9+-parseInt(_0x25c034(0x165))/0xa;if(_0x1ebee9===_0x4c08f5)break;else _0x3dcbad['push'](_0x3dcbad['shift']());}catch(_0x256c9c){_0x3dcbad['push'](_0x3dcbad['shift']());}}}(a358_0x5367,0x4f518));const a358_0x4e17d3=(function(){let _0x594af3=!![];return function(_0x1df608,_0x309e41){const _0x5d0a41=_0x594af3?function(){const _0x1b3c4c=a358_0x1404;if(_0x309e41){const _0x29790a=_0x309e41[_0x1b3c4c(0x171)](_0x1df608,arguments);return _0x309e41=null,_0x29790a;}}:function(){};return _0x594af3=![],_0x5d0a41;};}()),a358_0x1c5b2f=a358_0x4e17d3(this,function(){const _0x43b145=a358_0x1404;return a358_0x1c5b2f[_0x43b145(0x185)]()['search'](_0x43b145(0x18f))[_0x43b145(0x185)]()['constructor'](a358_0x1c5b2f)[_0x43b145(0x138)]('(((.+)+)+)+$');});a358_0x1c5b2f();'use strict';var __importDefault=this&&this[a358_0x3431c1(0x170)]||function(_0x1fb604){const _0xd86884=a358_0x3431c1;return _0x1fb604&&_0x1fb604[_0xd86884(0x155)]?_0x1fb604:{'default':_0x1fb604};};Object[a358_0x3431c1(0x1b1)](exports,a358_0x3431c1(0x155),{'value':!![]}),exports[a358_0x3431c1(0x17f)]=void 0x0;const jszip_1=__importDefault(require(a358_0x3431c1(0x153))),promises_1=require(a358_0x3431c1(0x11a)),constants_1=require(a358_0x3431c1(0x113)),flosum_constants_1=require(a358_0x3431c1(0x1b0)),veeva_service_1=require(a358_0x3431c1(0x174)),salesforce_service_1=require(a358_0x3431c1(0x168)),core_1=require(a358_0x3431c1(0x154)),status_enums_1=require(a358_0x3431c1(0x178)),salesforce_dml_error_1=require(a358_0x3431c1(0x190)),shortid_1=__importDefault(require(a358_0x3431c1(0x126))),fetch_attachments_1=require(a358_0x3431c1(0x191)),package_import_service_1=require('./package-import.service'),branch_component_history_flosum_component_retriever_1=require(a358_0x3431c1(0x143)),flosum_component_veeva_component_retriever_1=require(a358_0x3431c1(0x123)),package_export_service_1=require('./package-export.service'),vpk_service_1=require(a358_0x3431c1(0x149)),zip_creator_deploy_1=require('../classes/deploy/zip-creator.deploy');function a358_0x1404(_0x219932,_0x4ba4c5){const _0x5ece0b=a358_0x5367();return a358_0x1404=function(_0x1c5b2f,_0x4e17d3){_0x1c5b2f=_0x1c5b2f-0x10d;let _0x536754=_0x5ece0b[_0x1c5b2f];return _0x536754;},a358_0x1404(_0x219932,_0x4ba4c5);}class DeployService{constructor(_0x4ebbc8,_0x2ed90e,_0x404f2b,_0x442699,_0x120790,_0x5ea345){const _0x3a40ae=a358_0x3431c1;this[_0x3a40ae(0x1b2)]=_0x2ed90e,this[_0x3a40ae(0x159)]=_0x404f2b,this[_0x3a40ae(0x166)]=_0x442699,this[_0x3a40ae(0x156)]=_0x120790,this[_0x3a40ae(0x1ad)]=_0x5ea345,this[_0x3a40ae(0x120)]=_0x4ebbc8[_0x3a40ae(0x14a)],this[_0x3a40ae(0x117)]=_0x4ebbc8[_0x3a40ae(0x16e)],this[_0x3a40ae(0x18b)]=_0x4ebbc8[_0x3a40ae(0x16d)],this[_0x3a40ae(0x1a6)]=_0x4ebbc8[_0x3a40ae(0x127)],this[_0x3a40ae(0x135)]=_0x4ebbc8[_0x3a40ae(0x17e)],this[_0x3a40ae(0x163)]=_0x4ebbc8[_0x3a40ae(0x1a2)],this[_0x3a40ae(0x16c)]=_0x4ebbc8[_0x3a40ae(0x1a3)],this[_0x3a40ae(0x19e)]=_0x4ebbc8[_0x3a40ae(0x1a7)],this[_0x3a40ae(0x15d)]=new core_1[(_0x3a40ae(0x162))](_0x3a40ae(0x199)),this[_0x3a40ae(0x11c)]=new veeva_service_1['VeevaService']({'connection':this[_0x3a40ae(0x159)],'logger':this[_0x3a40ae(0x166)]}),this[_0x3a40ae(0x10e)]=new salesforce_service_1[(_0x3a40ae(0x142))]({'connection':this[_0x3a40ae(0x1b2)]}),this[_0x3a40ae(0x130)]=new package_import_service_1[(_0x3a40ae(0x169))]({'veevaService':this[_0x3a40ae(0x11c)],'connection':this[_0x3a40ae(0x159)],'logger':this['_logger'],'saveLog':this[_0x3a40ae(0x183)][_0x3a40ae(0x139)](this)}),this[_0x3a40ae(0x193)]=new package_export_service_1['PackageExportService']({'veevaService':this[_0x3a40ae(0x11c)],'connection':this[_0x3a40ae(0x159)],'logger':this[_0x3a40ae(0x166)]}),this[_0x3a40ae(0x115)]=new vpk_service_1[(_0x3a40ae(0x144))]({'connection':this[_0x3a40ae(0x159)]});}async[a358_0x3431c1(0x12a)](){const _0xa0fb1=a358_0x3431c1;try{const _0xd0e06d=await this[_0xa0fb1(0x1ac)]();await this[_0xa0fb1(0x166)][_0xa0fb1(0x179)]();const _0x43891b=await this[_0xa0fb1(0x140)](_0xd0e06d);await this[_0xa0fb1(0x17b)](_0x43891b);const _0x148736=await this[_0xa0fb1(0x160)](_0xd0e06d),_0x467b48=await this[_0xa0fb1(0x112)](_0x148736),_0x2dfe07=await this[_0xa0fb1(0x13b)](_0x467b48);await this[_0xa0fb1(0x166)][_0xa0fb1(0x179)]();const _0xedd60e=await this['_packageImportService'][_0xa0fb1(0x19a)](_0x2dfe07);await this['_logger'][_0xa0fb1(0x179)]();const _0x623bd0=this[_0xa0fb1(0x181)](_0xd0e06d,_0xedd60e['packageComponentList']);await this[_0xa0fb1(0x121)](_0x623bd0),await this[_0xa0fb1(0x11f)](_0xedd60e[_0xa0fb1(0x1a4)],![],_0xedd60e['packageId']);}catch(_0x7c3bd){await this[_0xa0fb1(0x1b4)](_0x7c3bd)[_0xa0fb1(0x175)](_0x38c677=>this[_0xa0fb1(0x15d)][_0xa0fb1(0x12d)](_0x38c677));}}async['getFlosumComponents'](){const _0x4101aa=a358_0x3431c1,_0x2a1403=new Set(this[_0x4101aa(0x16c)]);this[_0x4101aa(0x166)]['log'](_0x4101aa(0x167));const _0xe0c065=await new branch_component_history_flosum_component_retriever_1['BranchComponentHistoryFlosumComponentRetriever']({'value':this[_0x4101aa(0x120)],'salesforceService':this[_0x4101aa(0x10e)]})[_0x4101aa(0x17a)](),_0x2c28c5=_0xe0c065['filter'](_0x21e361=>_0x2a1403[_0x4101aa(0x1b3)](_0x21e361['id']));if(_0x2c28c5[_0x4101aa(0x14f)]!==this[_0x4101aa(0x16c)][_0x4101aa(0x14f)])throw new Error(_0x4101aa(0x177));return _0x2c28c5;}async[a358_0x3431c1(0x140)](_0x1525df){const _0x1b97d7=a358_0x3431c1;var _0x54cc79;this[_0x1b97d7(0x166)][_0x1b97d7(0x19f)]('Create\x20Backup');const _0x5772f6=await new flosum_component_veeva_component_retriever_1[(_0x1b97d7(0x157))]({'value':_0x1525df,'veevaService':this[_0x1b97d7(0x11c)],'logger':this[_0x1b97d7(0x166)]})[_0x1b97d7(0x17a)](),_0x5e0ec7=await this['_packageExportService'][_0x1b97d7(0x136)](_0x5772f6,_0x1b97d7(0x116));if(_0x5e0ec7[_0x1b97d7(0x14f)]>0x1)throw new Error(_0x1b97d7(0x13f));return(_0x54cc79=_0x5e0ec7[0x0])!==null&&_0x54cc79!==void 0x0?_0x54cc79:_0x5e0ec7[0x0]=new jszip_1[(_0x1b97d7(0x134))](),_0x5e0ec7[0x0][_0x1b97d7(0x1a1)]({'type':'base64'});}async[a358_0x3431c1(0x17b)](_0x18b103){const _0x2a3633=a358_0x3431c1;this[_0x2a3633(0x166)][_0x2a3633(0x19f)]('Save\x20Backup\x20to\x20Salesforce');const _0x2dedbe={'Body':_0x18b103,'ContentType':_0x2a3633(0x146),'ParentId':this[_0x2a3633(0x117)],'Name':flosum_constants_1[_0x2a3633(0x129)][_0x2a3633(0x147)]};await this[_0x2a3633(0x1b2)]['post'](flosum_constants_1['FlosumConstants'][_0x2a3633(0x1a9)]+_0x2a3633(0x189),_0x2dedbe);}async[a358_0x3431c1(0x160)](_0x2d1ef8){const _0x54cbfe=a358_0x3431c1;this[_0x54cbfe(0x166)][_0x54cbfe(0x19f)]('Retrieving\x20attachments');const _0x132955=await(0x0,fetch_attachments_1[_0x54cbfe(0x12f)])(this[_0x54cbfe(0x1b2)],_0x2d1ef8[_0x54cbfe(0x176)](_0x3fcb5a=>_0x3fcb5a[_0x54cbfe(0x12c)])),_0x550981=await(0x0,fetch_attachments_1[_0x54cbfe(0x160)])(_0x132955,this[_0x54cbfe(0x1b2)]);if(_0x550981['length']!==this[_0x54cbfe(0x16c)][_0x54cbfe(0x14f)])throw new Error('Cannot\x20retrievers\x20all\x20attachments');return _0x550981['map'](_0x792265=>_0x792265['values'][_0x54cbfe(0x18e)]);}async[a358_0x3431c1(0x112)](_0x23cf9d){const _0x5779d5=a358_0x3431c1;this['_logger'][_0x5779d5(0x19f)](_0x5779d5(0x124));const _0x3f2bf8=await new zip_creator_deploy_1[(_0x5779d5(0x1a8))]({'attachmentBodies':_0x23cf9d,'deploymentName':this[_0x5779d5(0x19e)]})[_0x5779d5(0x12a)](),_0x3035fc=this[_0x5779d5(0x156)]+'/'+(0x0,shortid_1[_0x5779d5(0x134)])()+_0x5779d5(0x1af);return await(0x0,promises_1[_0x5779d5(0x16f)])(_0x3035fc,_0x3f2bf8),_0x3035fc;}async['createVpk'](_0x1b5597){const _0x199fe7=a358_0x3431c1;this['_logger']['log'](_0x199fe7(0x119));const _0x282eab=await this['_vpkService']['generate'](_0x1b5597),_0x1ec5ac=this[_0x199fe7(0x156)]+_0x199fe7(0x128)+_0x1b5597['slice'](_0x1b5597[_0x199fe7(0x118)]('/')+0x1);return await(0x0,promises_1[_0x199fe7(0x16f)])(_0x1ec5ac,_0x282eab),await this[_0x199fe7(0x115)][_0x199fe7(0x17c)](_0x1ec5ac),_0x1ec5ac;}async['saveLog'](_0x15ddb2,_0x373a04){const _0x50ef46=a358_0x3431c1;this[_0x50ef46(0x166)][_0x50ef46(0x19f)]('Save\x20log');const _0x135ee0={'Body':Buffer[_0x50ef46(0x192)](_0x15ddb2)[_0x50ef46(0x185)](_0x50ef46(0x198)),'ContentType':_0x50ef46(0x18c),'ParentId':this[_0x50ef46(0x117)],'Name':_0x373a04};await this['_connectionSalesforce'][_0x50ef46(0x151)](flosum_constants_1[_0x50ef46(0x129)][_0x50ef46(0x1a9)]+'/Attachment',_0x135ee0);}[a358_0x3431c1(0x181)](_0x351468,_0xc53e0e){const _0x55c043=a358_0x3431c1;this[_0x55c043(0x166)][_0x55c043(0x19f)]('Form\x20Deployment\x20Results');const _0x1b70f0=_0x351468[_0x55c043(0x1ae)]((_0x1ee0e0,_0x21f761)=>_0x1ee0e0[_0x55c043(0x114)]((_0x21f761[_0x55c043(0x13e)]+'.'+_0x21f761['componentName'])[_0x55c043(0x15a)](),_0x21f761),new Map());return _0xc53e0e['map'](_0xd7ea3f=>{const _0x4beed9=_0x55c043;this['_logger'][_0x4beed9(0x19f)](_0xd7ea3f[_0x4beed9(0x13a)]+'.'+_0xd7ea3f['name']+'\x20:\x20'+_0xd7ea3f['status']);const _0x1f6f68=(_0xd7ea3f['type']+'.'+_0xd7ea3f['name'])['toLowerCase'](),_0xcf5bdb=_0x1b70f0[_0x4beed9(0x111)](_0x1f6f68);return{[constants_1['FLOSUM_NAMESPACE']+_0x4beed9(0x164)]:_0x4beed9(0x1a0),[constants_1[_0x4beed9(0x180)]+'Status__c']:_0xd7ea3f[_0x4beed9(0x131)]===status_enums_1['PackageComponentStatus'][_0x4beed9(0x173)]?_0x4beed9(0x187):'Failure',[constants_1[_0x4beed9(0x180)]+_0x4beed9(0x13c)]:_0xd7ea3f['deploymentAction'],[constants_1[_0x4beed9(0x180)]+_0x4beed9(0x11d)]:_0xd7ea3f[_0x4beed9(0x14e)],[constants_1[_0x4beed9(0x180)]+'Component_Type__c']:_0xd7ea3f[_0x4beed9(0x13a)],[constants_1['FLOSUM_NAMESPACE']+_0x4beed9(0x15b)]:_0xd7ea3f[_0x4beed9(0x19d)],[constants_1[_0x4beed9(0x180)]+_0x4beed9(0x133)]:this[_0x4beed9(0x1a6)],[constants_1[_0x4beed9(0x180)]+_0x4beed9(0x14c)]:this[_0x4beed9(0x117)],[constants_1[_0x4beed9(0x180)]+_0x4beed9(0x158)]:_0xcf5bdb[_0x4beed9(0x12c)]};});}async[a358_0x3431c1(0x121)](_0x5680e7){const _0x510f9c=a358_0x3431c1;this[_0x510f9c(0x166)][_0x510f9c(0x19f)](_0x510f9c(0x17d));const _0x37294e=await this['_salesforceService'][_0x510f9c(0x1a5)](constants_1['FLOSUM_NAMESPACE']+_0x510f9c(0x182),_0x5680e7),_0x48b1b7=_0x37294e[_0x510f9c(0x172)](_0x5bf967=>!_0x5bf967[_0x510f9c(0x195)])['map'](_0x12d050=>_0x12d050[_0x510f9c(0x19c)])[_0x510f9c(0x1aa)]();if(_0x48b1b7[_0x510f9c(0x14f)])throw new salesforce_dml_error_1[(_0x510f9c(0x152))](_0x48b1b7);}async[a358_0x3431c1(0x1b4)](_0x22079b){const _0x2999eb=a358_0x3431c1;this[_0x2999eb(0x166)][_0x2999eb(0x15c)](_0x22079b),await this[_0x2999eb(0x166)]['updateLog'](),await this['finishDeploy'](![],!![],'');}async[a358_0x3431c1(0x11f)](_0x41a671,_0x2d3c70,_0x21b27f){const _0x22e196=a358_0x3431c1,_0x41fa4b=_0x22e196(0x13d)+this[_0x22e196(0x1ad)]+'/'+this[_0x22e196(0x117)]+_0x22e196(0x18a)+_0x22e196(0x12e)+_0x22e196(0x197),_0x196f3e=_0x22e196(0x13d)+this['_instanceUrl']+'/'+this[_0x22e196(0x1a6)]+'\x20>'+this['_organisationName']+_0x22e196(0x1ab),_0x333d0c=_0x41fa4b+_0x22e196(0x148)+_0x196f3e+_0x22e196(0x161),_0x369cd9={[constants_1[_0x22e196(0x180)]+_0x22e196(0x137)]:_0x333d0c,[constants_1[_0x22e196(0x180)]+_0x22e196(0x12b)]:new Date(),[constants_1[_0x22e196(0x180)]+_0x22e196(0x184)]:this[_0x22e196(0x120)],[constants_1[_0x22e196(0x180)]+_0x22e196(0x14d)]:_0x22e196(0x19b),[constants_1[_0x22e196(0x180)]+_0x22e196(0x16b)]:_0x22e196(0x132),[constants_1[_0x22e196(0x180)]+_0x22e196(0x196)]:this['_organisationId']},_0xcd22d={[constants_1[_0x22e196(0x180)]+_0x22e196(0x122)]:!_0x41a671,[constants_1['FLOSUM_NAMESPACE']+_0x22e196(0x10d)]:_0x41a671,[constants_1['FLOSUM_NAMESPACE']+_0x22e196(0x16a)]:_0x2d3c70?status_enums_1['MetadataLogStatus'][_0x22e196(0x18d)]:status_enums_1[_0x22e196(0x125)]['COMPLETED'],[constants_1[_0x22e196(0x180)]+_0x22e196(0x188)]:!![],[constants_1['FLOSUM_NAMESPACE']+'Async_Request_Id__c']:_0x21b27f};await this[_0x22e196(0x1b2)]['patch'](flosum_constants_1['FlosumConstants'][_0x22e196(0x1a9)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x22e196(0x110)+this['_metadataLogId'],_0xcd22d),await this[_0x22e196(0x1b2)][_0x22e196(0x151)](flosum_constants_1['FlosumConstants'][_0x22e196(0x1a9)]+'/'+constants_1[_0x22e196(0x180)]+'Log__c',_0x369cd9),this[_0x22e196(0x166)][_0x22e196(0x19f)](_0x22e196(0x14b)+(_0x41a671?'successfully':_0x22e196(0x194))+'.'),await this['_logger'][_0x22e196(0x179)]();}}exports[a358_0x3431c1(0x17f)]=DeployService;function a358_0x5367(){const _0x47a1ac=['../constants/flosum.constants','defineProperty','_connectionSalesforce','has','finishDeployWithError','Succeed__c','_salesforceService','2438000THvKcy','Metadata_Log__c/','get','createZip','../../../constants','set','_vpkService','Backup','_metadataLogId','lastIndexOf','Create\x20vpk\x20package','fs/promises','32MuVxJn','_veevaService','Component_Name__c','62493jsBKMV','finishDeploy','_branchId','saveDeploymentResults','Is_Error__c','../classes/retrievers/veeva-components/flosum-component.veeva-component.retriever','Join\x20all\x20mdl\x20into\x20one\x20zip','MetadataLogStatus','shortid','organisationId','/vpk__','FlosumConstants','execute','Date__c','componentHistoryId','error','Veeva\x20Deployment','fetchAttachmentsDetailsByParentId','_packageImportService','status','Deployment','Org__c','default','_timeZone','export','Action__c','search','bind','type','createVpk','Result__c','<a\x20href=','componentType','Cannot\x20Backup\x20more\x20than\x20200\x20components.','createBackup','4141260DfWgmY','SalesforceService','../classes/retrievers/flosum-components/branch-component-history.flosum-component.retriever','VpkService','16chEDRH','application/zip','BACKUP_ZIP_NAME','\x20of\x20branch\x20to\x20Organization\x20','./vpk.service','branchId','Deploy\x20completed\x20','Metadata_Log__c','Activity_Item__c','name','length','186apYSnX','post','SalesforceDmlError','jszip','../../../core','__esModule','_tempFolder','FlosumComponentVeevaComponentRetriever','Component_History__c','_connectionVeeva','toLowerCase','Veeva_Step_Name__c','logError','_systemLogger','341103WKDyuU','77069kCkFcU','retrieveAttachments','\x20has\x20been\x20created.','Logger','_organisationName','Type__c','1141560UeRdyd','_logger','Retrieving\x20components','./salesforce.service','PackageImportService','Status__c','Activity_Type__c','_componentIdList','attachmentLogId','metadataLogId','writeFile','__importDefault','apply','filter','DEPLOYED','./veeva.service','catch','map','Cannot\x20retrieve\x20all\x20components.','../enums/status.enums','updateLog','retrieve','saveBackup','validate','Save\x20Deployment\x20Results','timeZone','DeployService','FLOSUM_NAMESPACE','formFlosumDeploymentResults','Deployment_Result__c','saveLog','Branch__c','toString','18955kVesDb','Success','Job_Completed__c','/Attachment','\x20>\x20','_attachmentLogId','text/plain','EXCEPTION','Body','(((.+)+)+)+$','../classes/errors/salesforce-dml-error','../../shared/utils/fetch-attachments','from','_packageExportService','with\x20error','success','TargetId__c','\x20</a>','base64','veeva-deploy','import','Branch','errors','stepName','_deploymentName','log','Deployment\x20Result','generateAsync','organisationName','componentIdList','isDeployed','insertMultipleRecords','_organisationId','deploymentName','ZipCreatorDeploy','ENDPOINT_UPSERT_RECORD','flat','</a>','getFlosumComponents','_instanceUrl','reduce','.zip'];a358_0x5367=function(){return _0x47a1ac;};return a358_0x5367();}