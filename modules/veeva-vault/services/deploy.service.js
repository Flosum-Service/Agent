function a310_0x1f90(_0x443ee9,_0x1a8cf9){const _0x417fe7=a310_0x1bc2();return a310_0x1f90=function(_0x5590ba,_0x1e7dd3){_0x5590ba=_0x5590ba-0x1cb;let _0x1bc2c8=_0x417fe7[_0x5590ba];return _0x1bc2c8;},a310_0x1f90(_0x443ee9,_0x1a8cf9);}const a310_0x318208=a310_0x1f90;(function(_0x5ae3d1,_0x5981a0){const _0x1ab8bd=a310_0x1f90,_0x5a898a=_0x5ae3d1();while(!![]){try{const _0x402583=-parseInt(_0x1ab8bd(0x1d5))/0x1+parseInt(_0x1ab8bd(0x243))/0x2*(-parseInt(_0x1ab8bd(0x1f0))/0x3)+parseInt(_0x1ab8bd(0x1fd))/0x4*(parseInt(_0x1ab8bd(0x255))/0x5)+-parseInt(_0x1ab8bd(0x278))/0x6*(parseInt(_0x1ab8bd(0x27b))/0x7)+parseInt(_0x1ab8bd(0x1e2))/0x8+parseInt(_0x1ab8bd(0x1f4))/0x9*(parseInt(_0x1ab8bd(0x276))/0xa)+parseInt(_0x1ab8bd(0x230))/0xb*(parseInt(_0x1ab8bd(0x20c))/0xc);if(_0x402583===_0x5981a0)break;else _0x5a898a['push'](_0x5a898a['shift']());}catch(_0x5eb469){_0x5a898a['push'](_0x5a898a['shift']());}}}(a310_0x1bc2,0xdadac));const a310_0x1e7dd3=(function(){let _0x5adb25=!![];return function(_0x391f0e,_0x2daacb){const _0x355d5f=_0x5adb25?function(){const _0x1cc1fd=a310_0x1f90;if(_0x2daacb){const _0x50be29=_0x2daacb[_0x1cc1fd(0x26c)](_0x391f0e,arguments);return _0x2daacb=null,_0x50be29;}}:function(){};return _0x5adb25=![],_0x355d5f;};}()),a310_0x5590ba=a310_0x1e7dd3(this,function(){const _0x392ae0=a310_0x1f90;return a310_0x5590ba[_0x392ae0(0x202)]()['search'](_0x392ae0(0x1db))[_0x392ae0(0x202)]()[_0x392ae0(0x24d)](a310_0x5590ba)[_0x392ae0(0x294)](_0x392ae0(0x1db));});a310_0x5590ba();'use strict';var __importDefault=this&&this[a310_0x318208(0x290)]||function(_0x4fcf4e){const _0x6902d=a310_0x318208;return _0x4fcf4e&&_0x4fcf4e[_0x6902d(0x23d)]?_0x4fcf4e:{'default':_0x4fcf4e};};Object[a310_0x318208(0x1fb)](exports,a310_0x318208(0x23d),{'value':!![]}),exports[a310_0x318208(0x1f9)]=void 0x0;function a310_0x1bc2(){const _0xab07ae=['base64','_logger','content-type','writeFile','../dtos/job-result.dto','from','values','VERIFIED','_componentIdList','_systemLogger','Logger','Builder','Join\x20all\x20mdl\x20into\x20one\x20zip','retrieveRecords','VeevaPackageStatus','Activity_Type__c','__importDefault','multipart/form-data','VeevaConstants','deployPackage','search','links','componentIdList','find','_connectionVeeva','MetadataLogStatus','set','</a>','Retrieving\x20components','updateVeevaConnection','\x20of\x20branch\x20to\x20Organization\x20','form-data','Deploy\x20completed\x20','../../../constants','fs/promises','../constants/flosum.constants','_organisationId','veeva-deploy','../dtos/component.dto','timeZone','/Attachment','Branch','666177ZcToxx','deploymentName','length','Activity_Item__c','packageComponentList','/vpk__','(((.+)+)+)+$','../utils/veeva-auth.utils','filter','detailUrl','Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20','FlosumConstants','finishDeployWithError','13968096qyCWHB','Success','../../shared/utils/fetch-attachments','with\x20error','file','./veeva.service','../constants/veeva.constants','_tempFolder','errors','get','finishDeploy','getLogResultText','PackageComponentDto','nodebuffer','3PycDim','type','toLowerCase','SalesforceDmlError','1415349INvLLS','Flosum','joinAllAttachments','SUCCESS','Validate\x20package','DeployService','ENDPOINT_UPSERT_RECORD','defineProperty','responseStatus','44024NfATDZ','Cannot\x20find\x20deployment\x20results','componentType','success','insertMultipleRecords','toString','ENDPOINT_VALIDATE_PACKAGE','packageId','deployment_status__v','post','PROCESS_DEPLOYMENT','Deploy\x20Log','vaultpackage.xml','../dtos/package-component.dto','files','12ULoxWQ','loadAsync','componentHistoryId','isDeployed','Deploy\x20package','Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','data','getJobStatus','buildObject','default','componentName','reduce','jszip','retrieveAttachments','branchId','xml2js','Deployment.log','endsWith','filename','_metadataLogId','PackageComponentStatus','Save\x20log','saveDeploymentResults','isSuccess','flat','url','Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20','JobResultDto','Component_Type__c','logError','getValidationDetailsAndSaveLog','RECREATE','FLOSUM_NAMESPACE','metadataLogId','async','slice','4082089qdMNwh','_deploymentName','package_components','rel','saveLog','VeevaResponseStatus','Branch__c\x20=\x20\x27','\x20</a>','COMPLETED','Deployment_Result__c','Status__c','Cannot\x20retrieve\x20all\x20components.','_timeZone','__esModule','VeevaError','map','DEPLOYED','importVpk','null','2426514XQkCFU','SalesforceService','Component_Name__c','Get\x20deploy\x20result','Save\x20Deployment\x20Results','headers','Deployment\x20Result','log','TargetId__c','generateVPK','constructor','Result__c','ENDPOINT_EXPORT_IMPORT_PACKAGE','text/plain','name','DEPLOYED_WITH_WARNINGS','includes','generateAsync','140IBSizU','Components__r\x20ORDER\x20BY\x20','text','Branch__c','Body','_instanceUrl','getDeployDetailsAndSaveLog','arraybuffer','append','Form\x20Deployment\x20Results','Generate\x20vpk\x20package','VeevaJobStatus','execute','Retrieving\x20attachments','../classes/errors/salesforce-dml-error','_branchId','attachmentLogId','{package_id}','Job_Completed__c','organisationId','status','validateVpk','Validation\x20Log','apply','\x20>\x20','ENDPOINT_DEPLOY_PACKAGE','Date__c','.zip','has','parse','formFlosumDeploymentResults','migration__v','updateLog','110MruOWW','Import\x20package','6tDlPNy','formPackageComponentList','application/json','9655016xIwbMJ','_connectionSalesforce','Metadata_Log__c','<a\x20href=','createReadStream'];a310_0x1bc2=function(){return _0xab07ae;};return a310_0x1bc2();}const jszip_1=__importDefault(require(a310_0x318208(0x218))),form_data_1=__importDefault(require(a310_0x318208(0x29f))),fs_1=require('fs'),promises_1=require(a310_0x318208(0x1cd)),constants_1=require(a310_0x318208(0x1cc)),flosum_constants_1=require(a310_0x318208(0x1ce)),veeva_constants_1=require(a310_0x318208(0x1e8)),veeva_service_1=require(a310_0x318208(0x1e7)),component_dto_1=require(a310_0x318208(0x1d1)),job_result_dto_1=require(a310_0x318208(0x284)),package_component_dto_1=require(a310_0x318208(0x20a)),salesforce_service_1=require('./salesforce.service'),core_1=require('../../../core'),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a310_0x318208(0x263)),veeva_error_1=require('../classes/errors/veeva-error'),shortid_1=__importDefault(require('shortid')),veeva_auth_utils_1=require(a310_0x318208(0x1dc)),xml2js_1=require(a310_0x318208(0x21b)),fetch_attachments_1=require(a310_0x318208(0x1e4));class DeployService{constructor(_0x4221ca,_0x1e4d5e,_0x470171,_0x476a18,_0x4ef445,_0x5bf58a){const _0x4c1771=a310_0x318208;this[_0x4c1771(0x27c)]=_0x1e4d5e,this['_connectionVeeva']=_0x470171,this[_0x4c1771(0x281)]=_0x476a18,this[_0x4c1771(0x1e9)]=_0x4ef445,this['_instanceUrl']=_0x5bf58a,this[_0x4c1771(0x264)]=_0x4221ca[_0x4c1771(0x21a)],this[_0x4c1771(0x21f)]=_0x4221ca[_0x4c1771(0x22d)],this['_attachmentLogId']=_0x4221ca[_0x4c1771(0x265)],this[_0x4c1771(0x1cf)]=_0x4221ca[_0x4c1771(0x268)],this[_0x4c1771(0x23c)]=_0x4221ca[_0x4c1771(0x1d2)],this['_organisationName']=_0x4221ca['organisationName'],this[_0x4c1771(0x288)]=_0x4221ca[_0x4c1771(0x296)],this[_0x4c1771(0x231)]=_0x4221ca[_0x4c1771(0x1d6)],this[_0x4c1771(0x289)]=new core_1[(_0x4c1771(0x28a))](_0x4c1771(0x1d0));}async[a310_0x318208(0x261)](){const _0x4699e0=a310_0x318208;try{const _0x56642a=await this['retrieveComponents'](),_0x2f2669=await this[_0x4699e0(0x219)](_0x56642a),_0x37b5cc=await this[_0x4699e0(0x1f6)](_0x2f2669),_0x4e360f=await this[_0x4699e0(0x24c)](_0x37b5cc);await this[_0x4699e0(0x26a)](_0x4e360f);const _0x57fb6f=await this[_0x4699e0(0x241)](_0x4e360f),_0x3ee29b=await this[_0x4699e0(0x213)](_0x57fb6f);await this['getValidationDetailsAndSaveLog'](_0x3ee29b);const _0x5bff79=await this[_0x4699e0(0x293)](_0x3ee29b[_0x4699e0(0x204)]),_0x550ab7=await this[_0x4699e0(0x213)](_0x5bff79);await this[_0x4699e0(0x25b)](_0x550ab7);const _0xb8c6fe=this[_0x4699e0(0x273)](_0x56642a,_0x550ab7['packageComponentList']);await this[_0x4699e0(0x222)](_0xb8c6fe),await this[_0x4699e0(0x1ec)](_0x550ab7[_0x4699e0(0x20f)],![],_0x3ee29b[_0x4699e0(0x204)]);}catch(_0x517409){await this[_0x4699e0(0x1e1)](_0x517409)['catch'](_0x411159=>this['_systemLogger']['error'](_0x411159));}}async['retrieveComponents'](){const _0x1aeeda=a310_0x318208,_0x538499=new Set(this[_0x1aeeda(0x288)]);this['_logger']['log'](_0x1aeeda(0x29c));const _0x419c1e='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+constants_1[_0x1aeeda(0x22c)]+_0x1aeeda(0x211)+constants_1[_0x1aeeda(0x22c)]+'Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20'+constants_1[_0x1aeeda(0x22c)]+_0x1aeeda(0x256)+constants_1[_0x1aeeda(0x22c)]+_0x1aeeda(0x226)+constants_1[_0x1aeeda(0x22c)]+_0x1aeeda(0x1df)+constants_1['FLOSUM_NAMESPACE']+_0x1aeeda(0x236)+this[_0x1aeeda(0x264)]+'\x27',_0x1b7100=await salesforce_service_1[_0x1aeeda(0x244)][_0x1aeeda(0x28d)](this['_connectionSalesforce'],_0x419c1e);if(!_0x1b7100[_0x1aeeda(0x1d7)])throw new Error(_0x1aeeda(0x23b));const _0x55ce2a=_0x1b7100[_0x1aeeda(0x23f)](_0x5500dd=>new component_dto_1['ComponentDto'](_0x5500dd))[_0x1aeeda(0x1dd)](_0x17c0f0=>_0x538499[_0x1aeeda(0x271)](_0x17c0f0['id']));if(_0x55ce2a[_0x1aeeda(0x1d7)]!==this[_0x1aeeda(0x288)]['length'])throw new Error('Cannot\x20retrieve\x20all\x20components.');return _0x55ce2a;}async['retrieveAttachments'](_0x137c4b){const _0x45d8ce=a310_0x318208;this['_logger'][_0x45d8ce(0x24a)](_0x45d8ce(0x262));const _0xac496d=await(0x0,fetch_attachments_1['fetchAttachmentsDetailsByParentId'])(this[_0x45d8ce(0x27c)],_0x137c4b['map'](_0x4e01d5=>_0x4e01d5[_0x45d8ce(0x20e)])),_0x120d82=await(0x0,fetch_attachments_1[_0x45d8ce(0x219)])(_0xac496d,this[_0x45d8ce(0x27c)]);if(_0x120d82[_0x45d8ce(0x1d7)]!==this['_componentIdList'][_0x45d8ce(0x1d7)])throw new Error('Cannot\x20retrieve\x20all\x20attachments');return _0x120d82[_0x45d8ce(0x23f)](_0x112ed9=>_0x112ed9[_0x45d8ce(0x286)][_0x45d8ce(0x259)]);}async[a310_0x318208(0x1f6)](_0xc89f74){const _0x403ec3=a310_0x318208;var _0x145dfe;this['_logger'][_0x403ec3(0x24a)](_0x403ec3(0x28c));const _0x3bc9ae=new jszip_1['default']();for(const _0x8a821a of _0xc89f74){const _0x4b9a03=new jszip_1[(_0x403ec3(0x215))]();await _0x4b9a03[_0x403ec3(0x20d)](_0x8a821a,{'base64':!![]});for(const _0x5de012 in _0x4b9a03[_0x403ec3(0x20b)]){const _0x236a27=await((_0x145dfe=_0x4b9a03[_0x403ec3(0x1e6)](_0x5de012))===null||_0x145dfe===void 0x0?void 0x0:_0x145dfe[_0x403ec3(0x22e)]('string'));_0x236a27&&_0x3bc9ae['file'](_0x5de012,_0x236a27);}}const _0x4add34=new xml2js_1[(_0x403ec3(0x28b))]({'headless':!![]}),_0x3dcd2f={'vaultpackage':{'$':{'xmlns':'https://veevavault.com/'},'name':this['_deploymentName'],'source':{'vault':undefined,'author':_0x403ec3(0x1f5)},'packagetype':_0x403ec3(0x274),'summary':'Deploy','description':_0x403ec3(0x242)}};_0x3bc9ae[_0x403ec3(0x1e6)](_0x403ec3(0x209),_0x4add34[_0x403ec3(0x214)](_0x3dcd2f));const _0x105f52=this[_0x403ec3(0x1e9)]+'/'+(0x0,shortid_1['default'])()+_0x403ec3(0x270),_0x10c565=await _0x3bc9ae[_0x403ec3(0x254)]({'type':_0x403ec3(0x1ef)});return await(0x0,promises_1[_0x403ec3(0x283)])(_0x105f52,_0x10c565),_0x105f52;}async['generateVPK'](_0x460d8e,_0x50d563=0x1){const _0x16b26a=a310_0x318208;var _0x89f2ad;this[_0x16b26a(0x281)][_0x16b26a(0x24a)](_0x16b26a(0x25f));const _0x2001ab=new form_data_1[(_0x16b26a(0x215))]();_0x2001ab[_0x16b26a(0x25d)](_0x16b26a(0x1e6),(0x0,fs_1['createReadStream'])(_0x460d8e));const _0x15fba3=await this[_0x16b26a(0x298)][_0x16b26a(0x206)](veeva_constants_1['VeevaConstants'][_0x16b26a(0x24f)],_0x2001ab,{'responseType':_0x16b26a(0x25c),'headers':{'Content-Type':_0x16b26a(0x291)}}),_0x526f45=(_0x89f2ad=_0x15fba3[_0x16b26a(0x248)][_0x16b26a(0x282)])===null||_0x89f2ad===void 0x0?void 0x0:_0x89f2ad[_0x16b26a(0x253)](_0x16b26a(0x27a));if(!_0x526f45){const _0x18490e=_0x15fba3[_0x16b26a(0x212)],_0x374f4b=this[_0x16b26a(0x1e9)]+_0x16b26a(0x1da)+_0x460d8e[_0x16b26a(0x22f)](_0x460d8e['lastIndexOf']('/')+0x1);return await(0x0,promises_1['writeFile'])(_0x374f4b,_0x18490e),_0x374f4b;}else{const _0x10ae56=JSON[_0x16b26a(0x272)](_0x15fba3[_0x16b26a(0x212)]);if(_0x50d563>0x0)return await(0x0,veeva_auth_utils_1[_0x16b26a(0x29d)])(this['_connectionVeeva']),await this[_0x16b26a(0x24c)](_0x460d8e,_0x50d563-0x1);throw new veeva_error_1[(_0x16b26a(0x23e))](_0x10ae56[_0x16b26a(0x1ea)]);}}async['validateVpk'](_0x5baac4,_0xd700bc=0x1){const _0x54c106=a310_0x318208;this[_0x54c106(0x281)][_0x54c106(0x24a)](_0x54c106(0x1f8));const _0x54fce8=new form_data_1['default']();_0x54fce8[_0x54c106(0x25d)](_0x54c106(0x1e6),(0x0,fs_1[_0x54c106(0x27f)])(_0x5baac4));const _0x21d854=await this[_0x54c106(0x298)][_0x54c106(0x206)](veeva_constants_1[_0x54c106(0x292)][_0x54c106(0x203)],_0x54fce8,{'headers':{'Content-Type':_0x54c106(0x291)}}),_0x47fbd5=_0x21d854[_0x54c106(0x212)];if(_0x47fbd5[_0x54c106(0x1fc)]===status_enums_1['VeevaResponseStatus']['SUCCESS'])return _0x47fbd5;else{if(_0xd700bc>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x54c106(0x298)]),await this[_0x54c106(0x26a)](_0x5baac4,_0xd700bc-0x1);throw new veeva_error_1[(_0x54c106(0x23e))](_0x47fbd5[_0x54c106(0x1ea)]);}}async[a310_0x318208(0x241)](_0x2547f6,_0x534f1d=0x1){const _0x206507=a310_0x318208;this[_0x206507(0x281)][_0x206507(0x24a)](_0x206507(0x277));const _0x4ecffc=new form_data_1[(_0x206507(0x215))]();_0x4ecffc[_0x206507(0x25d)](_0x206507(0x1e6),(0x0,fs_1[_0x206507(0x27f)])(_0x2547f6));const _0x5637d9=await this['_connectionVeeva']['put'](veeva_constants_1[_0x206507(0x292)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x4ecffc,{'headers':{'Content-Type':'multipart/form-data'}}),_0x533ef5=_0x5637d9[_0x206507(0x212)];if(_0x533ef5['responseStatus']===status_enums_1[_0x206507(0x235)][_0x206507(0x1f7)])return _0x533ef5[_0x206507(0x225)];else{if(_0x534f1d>0x0)return await(0x0,veeva_auth_utils_1[_0x206507(0x29d)])(this[_0x206507(0x298)]),await this['importVpk'](_0x2547f6,_0x534f1d-0x1);throw new veeva_error_1[(_0x206507(0x23e))](_0x533ef5[_0x206507(0x1ea)]);}}async['deployPackage'](_0x5b754f){const _0x9467ae=a310_0x318208;this[_0x9467ae(0x281)]['log'](_0x9467ae(0x210));const _0x306441=await this[_0x9467ae(0x298)]['post'](veeva_constants_1[_0x9467ae(0x292)][_0x9467ae(0x26e)]['replace'](_0x9467ae(0x266),_0x5b754f)),_0x19899a=await _0x306441[_0x9467ae(0x212)];if(_0x19899a[_0x9467ae(0x1fc)]===status_enums_1['VeevaResponseStatus'][_0x9467ae(0x1f7)])return _0x19899a[_0x9467ae(0x225)];else throw new veeva_error_1[(_0x9467ae(0x23e))](_0x19899a[_0x9467ae(0x1ea)]);}async['getJobStatus'](_0xd5909e){const _0x320218=a310_0x318208;this[_0x320218(0x281)][_0x320218(0x24a)]('Wait\x20Executing\x20job');const _0x1e0cad=new job_result_dto_1[(_0x320218(0x227))](),[_0x599871]=await veeva_service_1['VeevaService']['getJobResult']([_0xd5909e],this[_0x320218(0x298)],this[_0x320218(0x281)]);return _0x1e0cad[_0x320218(0x223)]=_0x599871[_0x320218(0x269)]===status_enums_1[_0x320218(0x260)]['SUCCESS'],_0x1e0cad['detailUrl']=_0x599871[_0x320218(0x295)][_0x320218(0x297)](_0x264a2a=>_0x264a2a[_0x320218(0x233)]==='artifacts')['href'],_0x1e0cad;}async[a310_0x318208(0x22a)](_0x2f8037){const _0x296d6e=a310_0x318208;this[_0x296d6e(0x281)][_0x296d6e(0x24a)]('Get\x20validation\x20details.');const {data:_0xd5a273}=await this[_0x296d6e(0x298)]['get'](_0x2f8037[_0x296d6e(0x1de)]);if(_0xd5a273[_0x296d6e(0x1fc)]===status_enums_1['VeevaResponseStatus'][_0x296d6e(0x1f7)]){const {log:_0x16eefb,id:_0xcdce53,package_status:_0x3b73d9}=_0xd5a273['vaultPackage'],_0x2fd7b8=_0x16eefb[_0x296d6e(0x1dd)](_0x4f27bb=>_0x4f27bb['filename'][_0x296d6e(0x21d)]('Validation.log')),_0x240696=await this['getLogResultText'](_0x2fd7b8[0x0][_0x296d6e(0x225)]);await this[_0x296d6e(0x234)](_0x240696,_0x296d6e(0x26b)),_0x2f8037[_0x296d6e(0x204)]=_0xcdce53;if(_0x3b73d9!==status_enums_1[_0x296d6e(0x28e)][_0x296d6e(0x287)])throw new Error('Package\x20not\x20verified');}else throw new veeva_error_1[(_0x296d6e(0x23e))](_0xd5a273[_0x296d6e(0x1ea)]);}async[a310_0x318208(0x25b)](_0x13df80){const _0x9d916c=a310_0x318208;this[_0x9d916c(0x281)][_0x9d916c(0x24a)](_0x9d916c(0x246));const {data:_0x39bf58}=await this[_0x9d916c(0x298)][_0x9d916c(0x1eb)](_0x13df80[_0x9d916c(0x1de)]);if(_0x39bf58[_0x9d916c(0x1fc)]===status_enums_1[_0x9d916c(0x235)][_0x9d916c(0x1f7)]){const {responseDetails:{deployment_log:_0x44f55c,package_status__v:_0xa89fc8},package_steps:_0x56e538}=_0x39bf58,_0x1c1e00=_0x44f55c[_0x9d916c(0x1dd)](_0x55fcc6=>_0x55fcc6[_0x9d916c(0x21e)][_0x9d916c(0x21d)](_0x9d916c(0x21c))),_0x52da07=await this[_0x9d916c(0x1ed)](_0x1c1e00[0x0][_0x9d916c(0x225)]);await this[_0x9d916c(0x234)](_0x52da07,_0x9d916c(0x208)),_0x13df80['isDeployed']=[status_enums_1['VeevaPackageStatus']['DEPLOYED'],status_enums_1[_0x9d916c(0x28e)][_0x9d916c(0x252)]][_0x9d916c(0x253)](_0xa89fc8);const _0x37dc70=this[_0x9d916c(0x279)](_0x56e538);_0x13df80[_0x9d916c(0x1d9)]=_0x37dc70[_0x9d916c(0x1dd)](_0xaa0273=>_0xaa0273['status']!==status_enums_1[_0x9d916c(0x220)][_0x9d916c(0x287)]);if(!_0x13df80[_0x9d916c(0x1d9)][_0x9d916c(0x1d7)])throw new Error(_0x9d916c(0x1fe));}else throw new veeva_error_1[(_0x9d916c(0x23e))](_0x39bf58[_0x9d916c(0x1ea)]);}async[a310_0x318208(0x1ed)](_0x342651){const _0x4bc7f7=a310_0x318208,{data:_0x1289bb}=await this[_0x4bc7f7(0x298)][_0x4bc7f7(0x1eb)](_0x342651,{'responseType':_0x4bc7f7(0x257)});return _0x1289bb;}[a310_0x318208(0x279)](_0x233201){return _0x233201['reduce']((_0x427194,_0x4f85f8)=>{const _0x56713a=a310_0x1f90,_0xeb1c97=_0x4f85f8[_0x56713a(0x232)][_0x56713a(0x23f)](_0x30326a=>new package_component_dto_1[(_0x56713a(0x1ee))](_0x30326a,_0x4f85f8[_0x56713a(0x205)]));return[..._0x427194,..._0xeb1c97];},[]);}async[a310_0x318208(0x234)](_0x30603a,_0xb20892){const _0x48ad72=a310_0x318208;this['_logger'][_0x48ad72(0x24a)](_0x48ad72(0x221));const _0x10929c={'Body':Buffer[_0x48ad72(0x285)](_0x30603a)['toString'](_0x48ad72(0x280)),'ContentType':_0x48ad72(0x250),'ParentId':this[_0x48ad72(0x21f)],'Name':_0xb20892},{data:_0x184fc8}=await this[_0x48ad72(0x27c)]['post'](flosum_constants_1['FlosumConstants'][_0x48ad72(0x1fa)]+_0x48ad72(0x1d3),_0x10929c);return _0x184fc8['id'];}['formFlosumDeploymentResults'](_0x223133,_0x2c16b){const _0x5caa10=a310_0x318208;this[_0x5caa10(0x281)]['log'](_0x5caa10(0x25e));const _0x6b5d6e=_0x223133[_0x5caa10(0x217)]((_0x1bbf02,_0x5fafe)=>_0x1bbf02[_0x5caa10(0x29a)]((_0x5fafe[_0x5caa10(0x1ff)]+'.'+_0x5fafe[_0x5caa10(0x216)])[_0x5caa10(0x1f2)](),_0x5fafe),new Map());return _0x2c16b[_0x5caa10(0x23f)](_0x51e8d1=>{const _0x1347ba=_0x5caa10;this['_logger']['log'](_0x51e8d1[_0x1347ba(0x1f1)]+'.'+_0x51e8d1[_0x1347ba(0x251)]+'\x20:\x20'+_0x51e8d1['status']);const _0x1fbd8b=(_0x51e8d1[_0x1347ba(0x1f1)]+'.'+_0x51e8d1[_0x1347ba(0x251)])['toLowerCase'](),_0x11f6fd=_0x6b5d6e['get'](_0x1fbd8b);return{[constants_1[_0x1347ba(0x22c)]+'Type__c']:_0x1347ba(0x249),[constants_1[_0x1347ba(0x22c)]+_0x1347ba(0x23a)]:_0x51e8d1['status']===status_enums_1['PackageComponentStatus'][_0x1347ba(0x240)]?_0x1347ba(0x1e3):'Failure',[constants_1[_0x1347ba(0x22c)]+_0x1347ba(0x24e)]:_0x1347ba(0x22b),[constants_1[_0x1347ba(0x22c)]+_0x1347ba(0x245)]:_0x51e8d1[_0x1347ba(0x251)],[constants_1[_0x1347ba(0x22c)]+_0x1347ba(0x228)]:_0x51e8d1[_0x1347ba(0x1f1)],[constants_1[_0x1347ba(0x22c)]+'Org__c']:this[_0x1347ba(0x1cf)],[constants_1[_0x1347ba(0x22c)]+_0x1347ba(0x27d)]:this[_0x1347ba(0x21f)],[constants_1[_0x1347ba(0x22c)]+'Component_History__c']:_0x11f6fd[_0x1347ba(0x20e)]};});}async[a310_0x318208(0x222)](_0x14e2d7){const _0x4701dd=a310_0x318208;this['_logger']['log'](_0x4701dd(0x247));const _0x26da42=await salesforce_service_1[_0x4701dd(0x244)][_0x4701dd(0x201)](this[_0x4701dd(0x27c)],constants_1['FLOSUM_NAMESPACE']+_0x4701dd(0x239),_0x14e2d7),_0x467220=_0x26da42['filter'](_0x1569ad=>!_0x1569ad[_0x4701dd(0x200)])['map'](_0x2ced9a=>_0x2ced9a['errors'])[_0x4701dd(0x224)]();if(_0x467220[_0x4701dd(0x1d7)])throw new salesforce_dml_error_1[(_0x4701dd(0x1f3))](_0x467220);}async['finishDeployWithError'](_0x21433d){const _0x37c77e=a310_0x318208;this[_0x37c77e(0x281)][_0x37c77e(0x229)](_0x21433d),await this[_0x37c77e(0x281)][_0x37c77e(0x275)](),await this[_0x37c77e(0x1ec)](![],!![],'');}async['finishDeploy'](_0x1ce530,_0x5be2dd,_0x5d0f50){const _0xd415e0=a310_0x318208,_0xbae889=_0xd415e0(0x27e)+this[_0xd415e0(0x25a)]+'/'+this[_0xd415e0(0x21f)]+_0xd415e0(0x26d)+'Veeva\x20Deployment'+_0xd415e0(0x237),_0x4f4300='<a\x20href='+this[_0xd415e0(0x25a)]+'/'+this[_0xd415e0(0x1cf)]+'\x20>'+this['_organisationName']+_0xd415e0(0x29b),_0x244091=_0xbae889+_0xd415e0(0x29e)+_0x4f4300+'\x20has\x20been\x20created.',_0x565eb7={[constants_1[_0xd415e0(0x22c)]+'Action__c']:_0x244091,[constants_1['FLOSUM_NAMESPACE']+_0xd415e0(0x26f)]:new Date(),[constants_1['FLOSUM_NAMESPACE']+_0xd415e0(0x258)]:this['_branchId'],[constants_1['FLOSUM_NAMESPACE']+_0xd415e0(0x1d8)]:_0xd415e0(0x1d4),[constants_1[_0xd415e0(0x22c)]+_0xd415e0(0x28f)]:'Deployment',[constants_1['FLOSUM_NAMESPACE']+_0xd415e0(0x24b)]:this[_0xd415e0(0x1cf)]},_0x246c17={[constants_1[_0xd415e0(0x22c)]+'Is_Error__c']:!_0x1ce530,[constants_1[_0xd415e0(0x22c)]+'Succeed__c']:_0x1ce530,[constants_1[_0xd415e0(0x22c)]+_0xd415e0(0x23a)]:_0x5be2dd?status_enums_1[_0xd415e0(0x299)]['EXCEPTION']:status_enums_1[_0xd415e0(0x299)][_0xd415e0(0x238)],[constants_1[_0xd415e0(0x22c)]+_0xd415e0(0x267)]:!![],[constants_1[_0xd415e0(0x22c)]+'Process_Type__c']:flosum_constants_1[_0xd415e0(0x1e0)][_0xd415e0(0x207)],[constants_1[_0xd415e0(0x22c)]+'Async_Request_Id__c']:_0x5d0f50};await this['_connectionSalesforce']['patch'](flosum_constants_1['FlosumConstants'][_0xd415e0(0x1fa)]+'/'+constants_1['FLOSUM_NAMESPACE']+'Metadata_Log__c/'+this['_metadataLogId'],_0x246c17),await this['_connectionSalesforce']['post'](flosum_constants_1[_0xd415e0(0x1e0)][_0xd415e0(0x1fa)]+'/'+constants_1[_0xd415e0(0x22c)]+'Log__c',_0x565eb7),this[_0xd415e0(0x281)][_0xd415e0(0x24a)](_0xd415e0(0x1cb)+(_0x1ce530?'successfully':_0xd415e0(0x1e5))+'.'),await this[_0xd415e0(0x281)][_0xd415e0(0x275)]();}}exports['DeployService']=DeployService;