const a255_0x3476bd=a255_0x1af1;(function(_0x489ff5,_0xcf3547){const _0x37e21d=a255_0x1af1,_0x3c39bf=_0x489ff5();while(!![]){try{const _0xc9dd81=-parseInt(_0x37e21d(0x7a))/0x1+parseInt(_0x37e21d(0x124))/0x2+-parseInt(_0x37e21d(0x79))/0x3*(parseInt(_0x37e21d(0x67))/0x4)+parseInt(_0x37e21d(0x11b))/0x5+parseInt(_0x37e21d(0x87))/0x6*(parseInt(_0x37e21d(0xdf))/0x7)+parseInt(_0x37e21d(0xb3))/0x8*(parseInt(_0x37e21d(0x94))/0x9)+-parseInt(_0x37e21d(0x108))/0xa;if(_0xc9dd81===_0xcf3547)break;else _0x3c39bf['push'](_0x3c39bf['shift']());}catch(_0x589d26){_0x3c39bf['push'](_0x3c39bf['shift']());}}}(a255_0x4280,0xb691b));const a255_0x57e5e2=(function(){let _0x3df97d=!![];return function(_0xa71a88,_0x4ce98a){const _0x32232e=_0x3df97d?function(){const _0x33bb9d=a255_0x1af1;if(_0x4ce98a){const _0x10a38c=_0x4ce98a[_0x33bb9d(0xdc)](_0xa71a88,arguments);return _0x4ce98a=null,_0x10a38c;}}:function(){};return _0x3df97d=![],_0x32232e;};}()),a255_0x1372f1=a255_0x57e5e2(this,function(){const _0x1e0157=a255_0x1af1;return a255_0x1372f1[_0x1e0157(0x102)]()['search'](_0x1e0157(0xde))[_0x1e0157(0x102)]()[_0x1e0157(0x77)](a255_0x1372f1)[_0x1e0157(0xf2)](_0x1e0157(0xde));});a255_0x1372f1();'use strict';var __importDefault=this&&this[a255_0x3476bd(0xa4)]||function(_0x2fff6d){const _0x18e936=a255_0x3476bd;return _0x2fff6d&&_0x2fff6d[_0x18e936(0xd3)]?_0x2fff6d:{'default':_0x2fff6d};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a255_0x3476bd(0x69)]=void 0x0;const jszip_1=__importDefault(require(a255_0x3476bd(0xc0))),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),promises_1=require('fs/promises'),constants_1=require('../../../constants'),flosum_constants_1=require('../constants/flosum.constants'),veeva_constants_1=require(a255_0x3476bd(0xfd)),veeva_service_1=require(a255_0x3476bd(0x6b)),component_dto_1=require(a255_0x3476bd(0x6f)),job_result_dto_1=require(a255_0x3476bd(0x121)),package_component_dto_1=require('../dtos/package-component.dto'),salesforce_service_1=require(a255_0x3476bd(0x7e)),core_1=require(a255_0x3476bd(0x6d)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a255_0x3476bd(0x6e)),veeva_error_1=require(a255_0x3476bd(0x103)),shortid_1=__importDefault(require(a255_0x3476bd(0x10c))),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),xml2js_1=require(a255_0x3476bd(0x123)),fetch_attachments_1=require(a255_0x3476bd(0xdb));function a255_0x4280(){const _0x2bceb2=['append','_logger','detailUrl','joinAllAttachments','15454990RALYxR','PROCESS_DEPLOYMENT','Branch','files','shortid','SalesforceService','importVpk','Branch__c\x20=\x20\x27','retrieveAttachments','execute','find','name','<a\x20href=','veeva-deploy','Components__r\x20ORDER\x20BY\x20','TargetId__c','Component_Type__c','branchId','Form\x20Deployment\x20Results','4667490NeCnVx','_componentIdList','DEPLOYED','_metadataLogId','Body','getJobResult','../dtos/job-result.dto','componentHistoryId','xml2js','2643268WjahNP','Flosum','includes','_systemLogger','Cannot\x20retrieve\x20all\x20attachments','filename','attachmentLogId','Deployment','componentType','vaultpackage.xml','formPackageComponentList','VeevaResponseStatus','Deployment_Result__c','set','nodebuffer','from','package_components','/Attachment','ENDPOINT_VALIDATE_PACKAGE','getValidationDetailsAndSaveLog','416748beInmW','\x20has\x20been\x20created.','DeployService','buildObject','./veeva.service','multipart/form-data','../../../core','../classes/errors/salesforce-dml-error','../dtos/component.dto','url','with\x20error','parse','_connectionSalesforce','href','Deploy','VeevaService','constructor','VeevaConstants','9BpXait','430881veoeDu','Deploy\x20package','Validate\x20package','migration__v','./salesforce.service','finishDeploy','VeevaError','Deploy\x20completed\x20','\x20:\x20','file','</a>','{package_id}','Process_Type__c','6kXHnow','insertMultipleRecords','finishDeployWithError','Wait\x20Executing\x20job','Activity_Type__c','deployPackage','SalesforceDmlError','toLowerCase','Get\x20deploy\x20result','generateVPK','timeZone','null','async','5835735JLPBuo','Deployment\x20Result','slice','deploymentName','_organisationName','Import\x20package','/vpk__','log','organisationId','responseStatus','Retrieving\x20components','deployment_status__v','headers','logError','saveLog','Metadata_Log__c','__importDefault','formFlosumDeploymentResults','Async_Request_Id__c','ComponentDto','VERIFIED','Logger','Component_History__c','createReadStream','packageComponentList','Org__c','generateAsync','isDeployed','\x20>\x20','updateLog','_organisationId','8EhJFcK','componentIdList','Join\x20all\x20mdl\x20into\x20one\x20zip','Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20','Package\x20not\x20verified','reduce','EXCEPTION','Log__c','successfully','_deploymentName','getJobStatus','map','Cannot\x20retrieve\x20all\x20components.','jszip','post','validateVpk','get','Generate\x20vpk\x20package','endsWith','Builder','error','Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20','application/json','_attachmentLogId','Job_Completed__c','retrieveComponents','PackageComponentStatus','SUCCESS','Result__c','_connectionVeeva','PackageComponentDto','rel','__esModule','put','lastIndexOf','writeFile','Save\x20Deployment\x20Results','Status__c','getDeployDetailsAndSaveLog','Activity_Item__c','../../shared/utils/fetch-attachments','apply','replace','(((.+)+)+)+$','932379RwwmPp','Validation\x20Log','saveDeploymentResults','ENDPOINT_UPSERT_RECORD','has','data','getLogResultText','default','flat','filter','isSuccess','packageId','https://veevavault.com/','errors','Deployment.log','arraybuffer','MetadataLogStatus','_instanceUrl','FlosumConstants','search','length','_tempFolder','links','ENDPOINT_DEPLOY_PACKAGE','type','FLOSUM_NAMESPACE','Branch__c','status','artifacts','componentName','../constants/veeva.constants','VeevaPackageStatus','Save\x20log','_branchId','Type__c','toString','../classes/errors/veeva-error'];a255_0x4280=function(){return _0x2bceb2;};return a255_0x4280();}function a255_0x1af1(_0x48ebc8,_0x180784){const _0x2426b4=a255_0x4280();return a255_0x1af1=function(_0x1372f1,_0x57e5e2){_0x1372f1=_0x1372f1-0x67;let _0x428035=_0x2426b4[_0x1372f1];return _0x428035;},a255_0x1af1(_0x48ebc8,_0x180784);}class DeployService{constructor(_0x48d190,_0x10530e,_0x28a5b6,_0x5b2a5c,_0x599c85,_0x12c34b){const _0x4c849c=a255_0x3476bd;this[_0x4c849c(0x73)]=_0x10530e,this[_0x4c849c(0xd0)]=_0x28a5b6,this[_0x4c849c(0x105)]=_0x5b2a5c,this['_tempFolder']=_0x599c85,this['_instanceUrl']=_0x12c34b,this[_0x4c849c(0x100)]=_0x48d190[_0x4c849c(0x119)],this[_0x4c849c(0x11e)]=_0x48d190['metadataLogId'],this[_0x4c849c(0xca)]=_0x48d190[_0x4c849c(0x12a)],this['_organisationId']=_0x48d190[_0x4c849c(0x9c)],this['_timeZone']=_0x48d190[_0x4c849c(0x91)],this[_0x4c849c(0x98)]=_0x48d190['organisationName'],this['_componentIdList']=_0x48d190[_0x4c849c(0xb4)],this[_0x4c849c(0xbc)]=_0x48d190[_0x4c849c(0x97)],this[_0x4c849c(0x127)]=new core_1[(_0x4c849c(0xa9))](_0x4c849c(0x115));}async[a255_0x3476bd(0x111)](){const _0x282ad6=a255_0x3476bd;try{const _0x2d1311=await this[_0x282ad6(0xcc)](),_0x804d31=await this['retrieveAttachments'](_0x2d1311),_0x13990e=await this[_0x282ad6(0x107)](_0x804d31),_0x422424=await this[_0x282ad6(0x90)](_0x13990e);await this[_0x282ad6(0xc2)](_0x422424);const _0x562b29=await this[_0x282ad6(0x10e)](_0x422424),_0x1bee84=await this[_0x282ad6(0xbd)](_0x562b29);await this['getValidationDetailsAndSaveLog'](_0x1bee84);const _0x9c276b=await this[_0x282ad6(0x8c)](_0x1bee84[_0x282ad6(0xea)]),_0x1e5207=await this['getJobStatus'](_0x9c276b);await this[_0x282ad6(0xd9)](_0x1e5207);const _0x539608=this[_0x282ad6(0xa5)](_0x2d1311,_0x1e5207[_0x282ad6(0xac)]);await this['saveDeploymentResults'](_0x539608),await this[_0x282ad6(0x7f)](_0x1e5207[_0x282ad6(0xaf)],![],_0x1bee84[_0x282ad6(0xea)]);}catch(_0x1c34d2){await this[_0x282ad6(0x89)](_0x1c34d2)['catch'](_0x2901f1=>this[_0x282ad6(0x127)][_0x282ad6(0xc7)](_0x2901f1));}}async[a255_0x3476bd(0xcc)](){const _0x45909d=a255_0x3476bd,_0x21c014=new Set(this['_componentIdList']);this[_0x45909d(0x105)][_0x45909d(0x9b)](_0x45909d(0x9e));const _0xb701e3='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+constants_1[_0x45909d(0xf8)]+'Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+constants_1['FLOSUM_NAMESPACE']+_0x45909d(0xb6)+constants_1[_0x45909d(0xf8)]+_0x45909d(0x116)+constants_1[_0x45909d(0xf8)]+_0x45909d(0xc8)+constants_1[_0x45909d(0xf8)]+'Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20'+constants_1['FLOSUM_NAMESPACE']+_0x45909d(0x10f)+this[_0x45909d(0x100)]+'\x27',_0x2eb3d2=await salesforce_service_1['SalesforceService']['retrieveRecords'](this[_0x45909d(0x73)],_0xb701e3);if(!_0x2eb3d2[_0x45909d(0xf3)])throw new Error(_0x45909d(0xbf));const _0x16c161=_0x2eb3d2[_0x45909d(0xbe)](_0x25bb1e=>new component_dto_1[(_0x45909d(0xa7))](_0x25bb1e))['filter'](_0x418de8=>_0x21c014[_0x45909d(0xe3)](_0x418de8['id']));if(_0x16c161[_0x45909d(0xf3)]!==this[_0x45909d(0x11c)][_0x45909d(0xf3)])throw new Error(_0x45909d(0xbf));return _0x16c161;}async[a255_0x3476bd(0x110)](_0x4477f7){const _0x127b9f=a255_0x3476bd;this[_0x127b9f(0x105)][_0x127b9f(0x9b)]('Retrieving\x20attachments');const _0x3011b7=await(0x0,fetch_attachments_1['fetchAttachmentsDetailsByParentId'])(this[_0x127b9f(0x73)],_0x4477f7['map'](_0x420a5e=>_0x420a5e[_0x127b9f(0x122)])),_0x4294a0=await(0x0,fetch_attachments_1['retrieveAttachments'])(_0x3011b7,this[_0x127b9f(0x73)]);if(_0x4294a0[_0x127b9f(0xf3)]!==this[_0x127b9f(0x11c)]['length'])throw new Error(_0x127b9f(0x128));return _0x4294a0['map'](_0x157618=>_0x157618['values'][_0x127b9f(0x11f)]);}async[a255_0x3476bd(0x107)](_0x30b473){const _0x15f70a=a255_0x3476bd;var _0x382677;this[_0x15f70a(0x105)][_0x15f70a(0x9b)](_0x15f70a(0xb5));const _0x4aeb51=new jszip_1['default']();for(const _0x1b4ae5 of _0x30b473){const _0x5fbcbf=new jszip_1[(_0x15f70a(0xe6))]();await _0x5fbcbf['loadAsync'](_0x1b4ae5,{'base64':!![]});for(const _0x487bf1 in _0x5fbcbf[_0x15f70a(0x10b)]){const _0x533241=await((_0x382677=_0x5fbcbf['file'](_0x487bf1))===null||_0x382677===void 0x0?void 0x0:_0x382677[_0x15f70a(0x93)]('string'));_0x533241&&_0x4aeb51['file'](_0x487bf1,_0x533241);}}const _0x1d2343=new xml2js_1[(_0x15f70a(0xc6))]({'headless':!![]}),_0x2579c9={'vaultpackage':{'$':{'xmlns':_0x15f70a(0xeb)},'name':this[_0x15f70a(0xbc)],'source':{'vault':undefined,'author':_0x15f70a(0x125)},'packagetype':_0x15f70a(0x7d),'summary':_0x15f70a(0x75),'description':_0x15f70a(0x92)}};_0x4aeb51['file'](_0x15f70a(0x12d),_0x1d2343[_0x15f70a(0x6a)](_0x2579c9));const _0x373d95=this[_0x15f70a(0xf4)]+'/'+(0x0,shortid_1['default'])()+'.zip',_0x5b00eb=await _0x4aeb51[_0x15f70a(0xae)]({'type':_0x15f70a(0x132)});return await(0x0,promises_1[_0x15f70a(0xd6)])(_0x373d95,_0x5b00eb),_0x373d95;}async[a255_0x3476bd(0x90)](_0x30805,_0x2206d5=0x1){const _0x338333=a255_0x3476bd;var _0x474b81;this['_logger'][_0x338333(0x9b)](_0x338333(0xc4));const _0x38ddc=new form_data_1[(_0x338333(0xe6))]();_0x38ddc[_0x338333(0x104)]('file',(0x0,fs_1['createReadStream'])(_0x30805));const _0x216ae3=await this['_connectionVeeva'][_0x338333(0xc1)](veeva_constants_1[_0x338333(0x78)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x38ddc,{'responseType':_0x338333(0xee),'headers':{'Content-Type':'multipart/form-data'}}),_0x523486=(_0x474b81=_0x216ae3[_0x338333(0xa0)]['content-type'])===null||_0x474b81===void 0x0?void 0x0:_0x474b81[_0x338333(0x126)](_0x338333(0xc9));if(!_0x523486){const _0x24874b=_0x216ae3[_0x338333(0xe4)],_0x2bad08=this['_tempFolder']+_0x338333(0x9a)+_0x30805[_0x338333(0x96)](_0x30805[_0x338333(0xd5)]('/')+0x1);return await(0x0,promises_1['writeFile'])(_0x2bad08,_0x24874b),_0x2bad08;}else{const _0x521c21=JSON[_0x338333(0x72)](_0x216ae3[_0x338333(0xe4)]);if(_0x2206d5>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x338333(0xd0)]),await this[_0x338333(0x90)](_0x30805,_0x2206d5-0x1);throw new veeva_error_1['VeevaError'](_0x521c21[_0x338333(0xec)]);}}async['validateVpk'](_0x319760,_0x44d84c=0x1){const _0x23bdd3=a255_0x3476bd;this[_0x23bdd3(0x105)][_0x23bdd3(0x9b)](_0x23bdd3(0x7c));const _0x36de1e=new form_data_1[(_0x23bdd3(0xe6))]();_0x36de1e[_0x23bdd3(0x104)]('file',(0x0,fs_1['createReadStream'])(_0x319760));const _0x38bc87=await this[_0x23bdd3(0xd0)][_0x23bdd3(0xc1)](veeva_constants_1[_0x23bdd3(0x78)][_0x23bdd3(0x136)],_0x36de1e,{'headers':{'Content-Type':_0x23bdd3(0x6c)}}),_0x466f28=_0x38bc87[_0x23bdd3(0xe4)];if(_0x466f28[_0x23bdd3(0x9d)]===status_enums_1[_0x23bdd3(0x12f)][_0x23bdd3(0xce)])return _0x466f28;else{if(_0x44d84c>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this['_connectionVeeva']),await this[_0x23bdd3(0xc2)](_0x319760,_0x44d84c-0x1);throw new veeva_error_1['VeevaError'](_0x466f28[_0x23bdd3(0xec)]);}}async['importVpk'](_0x5eccfd,_0x2e4a29=0x1){const _0x138221=a255_0x3476bd;this[_0x138221(0x105)]['log'](_0x138221(0x99));const _0x18de44=new form_data_1['default']();_0x18de44[_0x138221(0x104)](_0x138221(0x83),(0x0,fs_1[_0x138221(0xab)])(_0x5eccfd));const _0x380eba=await this[_0x138221(0xd0)][_0x138221(0xd4)](veeva_constants_1[_0x138221(0x78)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x18de44,{'headers':{'Content-Type':_0x138221(0x6c)}}),_0x439f7f=_0x380eba[_0x138221(0xe4)];if(_0x439f7f[_0x138221(0x9d)]===status_enums_1[_0x138221(0x12f)]['SUCCESS'])return _0x439f7f[_0x138221(0x70)];else{if(_0x2e4a29>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x138221(0xd0)]),await this[_0x138221(0x10e)](_0x5eccfd,_0x2e4a29-0x1);throw new veeva_error_1[(_0x138221(0x80))](_0x439f7f[_0x138221(0xec)]);}}async[a255_0x3476bd(0x8c)](_0x3ad46c){const _0x4a1aeb=a255_0x3476bd;this[_0x4a1aeb(0x105)][_0x4a1aeb(0x9b)](_0x4a1aeb(0x7b));const _0x347cc=await this['_connectionVeeva'][_0x4a1aeb(0xc1)](veeva_constants_1[_0x4a1aeb(0x78)][_0x4a1aeb(0xf6)][_0x4a1aeb(0xdd)](_0x4a1aeb(0x85),_0x3ad46c)),_0x5d0463=await _0x347cc[_0x4a1aeb(0xe4)];if(_0x5d0463['responseStatus']===status_enums_1[_0x4a1aeb(0x12f)][_0x4a1aeb(0xce)])return _0x5d0463[_0x4a1aeb(0x70)];else throw new veeva_error_1[(_0x4a1aeb(0x80))](_0x5d0463[_0x4a1aeb(0xec)]);}async['getJobStatus'](_0x27e4aa){const _0x3ea0a6=a255_0x3476bd;this[_0x3ea0a6(0x105)][_0x3ea0a6(0x9b)](_0x3ea0a6(0x8a));const _0x42c62b=new job_result_dto_1['JobResultDto'](),[_0x4c86ad]=await veeva_service_1[_0x3ea0a6(0x76)][_0x3ea0a6(0x120)]([_0x27e4aa],this['_connectionVeeva'],this[_0x3ea0a6(0x105)]);return _0x42c62b[_0x3ea0a6(0xe9)]=_0x4c86ad[_0x3ea0a6(0xfa)]===status_enums_1['VeevaJobStatus'][_0x3ea0a6(0xce)],_0x42c62b[_0x3ea0a6(0x106)]=_0x4c86ad[_0x3ea0a6(0xf5)][_0x3ea0a6(0x112)](_0x467727=>_0x467727[_0x3ea0a6(0xd2)]===_0x3ea0a6(0xfb))[_0x3ea0a6(0x74)],_0x42c62b;}async[a255_0x3476bd(0x137)](_0xc95f67){const _0x12201a=a255_0x3476bd;this['_logger'][_0x12201a(0x9b)]('Get\x20validation\x20details.');const {data:_0x5b0081}=await this[_0x12201a(0xd0)]['get'](_0xc95f67[_0x12201a(0x106)]);if(_0x5b0081[_0x12201a(0x9d)]===status_enums_1[_0x12201a(0x12f)][_0x12201a(0xce)]){const {log:_0x4a638e,id:_0x29d37e,package_status:_0xea082e}=_0x5b0081['vaultPackage'],_0x27b460=_0x4a638e['filter'](_0x2a3bab=>_0x2a3bab[_0x12201a(0x129)][_0x12201a(0xc5)]('Validation.log')),_0x4fffd7=await this[_0x12201a(0xe5)](_0x27b460[0x0][_0x12201a(0x70)]);await this[_0x12201a(0xa2)](_0x4fffd7,_0x12201a(0xe0)),_0xc95f67[_0x12201a(0xea)]=_0x29d37e;if(_0xea082e!==status_enums_1[_0x12201a(0xfe)]['VERIFIED'])throw new Error(_0x12201a(0xb7));}else throw new veeva_error_1[(_0x12201a(0x80))](_0x5b0081[_0x12201a(0xec)]);}async[a255_0x3476bd(0xd9)](_0x5e80ba){const _0x4ac4c0=a255_0x3476bd;this[_0x4ac4c0(0x105)][_0x4ac4c0(0x9b)](_0x4ac4c0(0x8f));const {data:_0x348016}=await this['_connectionVeeva']['get'](_0x5e80ba[_0x4ac4c0(0x106)]);if(_0x348016[_0x4ac4c0(0x9d)]===status_enums_1[_0x4ac4c0(0x12f)]['SUCCESS']){const {responseDetails:{deployment_log:_0xfdfd5d,package_status__v:_0x6881e0},package_steps:_0x469b7b}=_0x348016,_0x8dea1=_0xfdfd5d[_0x4ac4c0(0xe8)](_0x551914=>_0x551914[_0x4ac4c0(0x129)]['endsWith'](_0x4ac4c0(0xed))),_0x56d79a=await this[_0x4ac4c0(0xe5)](_0x8dea1[0x0][_0x4ac4c0(0x70)]);await this[_0x4ac4c0(0xa2)](_0x56d79a,'Deploy\x20Log'),_0x5e80ba['isDeployed']=[status_enums_1[_0x4ac4c0(0xfe)][_0x4ac4c0(0x11d)],status_enums_1['VeevaPackageStatus']['DEPLOYED_WITH_WARNINGS']][_0x4ac4c0(0x126)](_0x6881e0);const _0x4162ff=this[_0x4ac4c0(0x12e)](_0x469b7b);_0x5e80ba[_0x4ac4c0(0xac)]=_0x4162ff[_0x4ac4c0(0xe8)](_0x319708=>_0x319708['status']!==status_enums_1[_0x4ac4c0(0xcd)][_0x4ac4c0(0xa8)]);if(!_0x5e80ba[_0x4ac4c0(0xac)]['length'])throw new Error('Cannot\x20find\x20deployment\x20results');}else throw new veeva_error_1[(_0x4ac4c0(0x80))](_0x348016[_0x4ac4c0(0xec)]);}async[a255_0x3476bd(0xe5)](_0x87f27f){const _0x4b22ef=a255_0x3476bd,{data:_0x184515}=await this['_connectionVeeva'][_0x4b22ef(0xc3)](_0x87f27f,{'responseType':'text'});return _0x184515;}['formPackageComponentList'](_0x5ba66d){const _0x223755=a255_0x3476bd;return _0x5ba66d[_0x223755(0xb8)]((_0x21d245,_0x53d65f)=>{const _0x2d4b0e=_0x223755,_0x2dc044=_0x53d65f[_0x2d4b0e(0x134)][_0x2d4b0e(0xbe)](_0x2dd30a=>new package_component_dto_1[(_0x2d4b0e(0xd1))](_0x2dd30a,_0x53d65f[_0x2d4b0e(0x9f)]));return[..._0x21d245,..._0x2dc044];},[]);}async[a255_0x3476bd(0xa2)](_0x1aa42b,_0xa35a52){const _0xff2879=a255_0x3476bd;this['_logger'][_0xff2879(0x9b)](_0xff2879(0xff));const _0x12315f={'Body':Buffer[_0xff2879(0x133)](_0x1aa42b)[_0xff2879(0x102)]('base64'),'ContentType':'text/plain','ParentId':this[_0xff2879(0x11e)],'Name':_0xa35a52},{data:_0x60ad2d}=await this[_0xff2879(0x73)][_0xff2879(0xc1)](flosum_constants_1['FlosumConstants']['ENDPOINT_UPSERT_RECORD']+_0xff2879(0x135),_0x12315f);return _0x60ad2d['id'];}[a255_0x3476bd(0xa5)](_0x28a1f3,_0x5b6a0c){const _0x557807=a255_0x3476bd;this[_0x557807(0x105)][_0x557807(0x9b)](_0x557807(0x11a));const _0x44c9c4=_0x28a1f3[_0x557807(0xb8)]((_0x4e0642,_0x482c71)=>_0x4e0642[_0x557807(0x131)]((_0x482c71[_0x557807(0x12c)]+'.'+_0x482c71[_0x557807(0xfc)])['toLowerCase'](),_0x482c71),new Map());return _0x5b6a0c[_0x557807(0xbe)](_0x161a1c=>{const _0x37e14b=_0x557807;this['_logger']['log'](_0x161a1c[_0x37e14b(0xf7)]+'.'+_0x161a1c[_0x37e14b(0x113)]+_0x37e14b(0x82)+_0x161a1c[_0x37e14b(0xfa)]);const _0x1cc194=(_0x161a1c[_0x37e14b(0xf7)]+'.'+_0x161a1c['name'])[_0x37e14b(0x8e)](),_0x58d383=_0x44c9c4[_0x37e14b(0xc3)](_0x1cc194);return{[constants_1[_0x37e14b(0xf8)]+_0x37e14b(0x101)]:_0x37e14b(0x95),[constants_1[_0x37e14b(0xf8)]+_0x37e14b(0xd8)]:_0x161a1c['status']===status_enums_1['PackageComponentStatus'][_0x37e14b(0x11d)]?'Success':'Failure',[constants_1[_0x37e14b(0xf8)]+_0x37e14b(0xcf)]:'RECREATE',[constants_1['FLOSUM_NAMESPACE']+'Component_Name__c']:_0x161a1c['name'],[constants_1[_0x37e14b(0xf8)]+_0x37e14b(0x118)]:_0x161a1c[_0x37e14b(0xf7)],[constants_1[_0x37e14b(0xf8)]+_0x37e14b(0xad)]:this['_organisationId'],[constants_1[_0x37e14b(0xf8)]+_0x37e14b(0xa3)]:this['_metadataLogId'],[constants_1['FLOSUM_NAMESPACE']+_0x37e14b(0xaa)]:_0x58d383[_0x37e14b(0x122)]};});}async[a255_0x3476bd(0xe1)](_0x48a119){const _0x432a61=a255_0x3476bd;this[_0x432a61(0x105)][_0x432a61(0x9b)](_0x432a61(0xd7));const _0x1d5e2f=await salesforce_service_1[_0x432a61(0x10d)][_0x432a61(0x88)](this[_0x432a61(0x73)],constants_1[_0x432a61(0xf8)]+_0x432a61(0x130),_0x48a119),_0x161a41=_0x1d5e2f[_0x432a61(0xe8)](_0x3228a6=>!_0x3228a6['success'])[_0x432a61(0xbe)](_0x3edb9a=>_0x3edb9a[_0x432a61(0xec)])[_0x432a61(0xe7)]();if(_0x161a41[_0x432a61(0xf3)])throw new salesforce_dml_error_1[(_0x432a61(0x8d))](_0x161a41);}async[a255_0x3476bd(0x89)](_0x5ca573){const _0x1c5344=a255_0x3476bd;this[_0x1c5344(0x105)][_0x1c5344(0xa1)](_0x5ca573),await this[_0x1c5344(0x105)][_0x1c5344(0xb1)](),await this[_0x1c5344(0x7f)](![],!![],'');}async[a255_0x3476bd(0x7f)](_0x56b5a7,_0x93da5b,_0x4dc13d){const _0x3c6e99=a255_0x3476bd,_0x571011=_0x3c6e99(0x114)+this[_0x3c6e99(0xf0)]+'/'+this['_metadataLogId']+_0x3c6e99(0xb0)+'Veeva\x20Deployment'+'\x20</a>',_0x52c479=_0x3c6e99(0x114)+this[_0x3c6e99(0xf0)]+'/'+this[_0x3c6e99(0xb2)]+'\x20>'+this[_0x3c6e99(0x98)]+_0x3c6e99(0x84),_0xf2f980=_0x571011+'\x20of\x20branch\x20to\x20Organization\x20'+_0x52c479+_0x3c6e99(0x68),_0x12de54={[constants_1['FLOSUM_NAMESPACE']+'Action__c']:_0xf2f980,[constants_1[_0x3c6e99(0xf8)]+'Date__c']:new Date(),[constants_1['FLOSUM_NAMESPACE']+_0x3c6e99(0xf9)]:this[_0x3c6e99(0x100)],[constants_1[_0x3c6e99(0xf8)]+_0x3c6e99(0xda)]:_0x3c6e99(0x10a),[constants_1['FLOSUM_NAMESPACE']+_0x3c6e99(0x8b)]:_0x3c6e99(0x12b),[constants_1[_0x3c6e99(0xf8)]+_0x3c6e99(0x117)]:this[_0x3c6e99(0xb2)]},_0x2e0403={[constants_1[_0x3c6e99(0xf8)]+'Is_Error__c']:!_0x56b5a7,[constants_1['FLOSUM_NAMESPACE']+'Succeed__c']:_0x56b5a7,[constants_1[_0x3c6e99(0xf8)]+_0x3c6e99(0xd8)]:_0x93da5b?status_enums_1[_0x3c6e99(0xef)][_0x3c6e99(0xb9)]:status_enums_1[_0x3c6e99(0xef)]['COMPLETED'],[constants_1['FLOSUM_NAMESPACE']+_0x3c6e99(0xcb)]:!![],[constants_1[_0x3c6e99(0xf8)]+_0x3c6e99(0x86)]:flosum_constants_1[_0x3c6e99(0xf1)][_0x3c6e99(0x109)],[constants_1[_0x3c6e99(0xf8)]+_0x3c6e99(0xa6)]:_0x4dc13d};await this['_connectionSalesforce']['patch'](flosum_constants_1[_0x3c6e99(0xf1)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x3c6e99(0xf8)]+'Metadata_Log__c/'+this[_0x3c6e99(0x11e)],_0x2e0403),await this[_0x3c6e99(0x73)][_0x3c6e99(0xc1)](flosum_constants_1[_0x3c6e99(0xf1)][_0x3c6e99(0xe2)]+'/'+constants_1[_0x3c6e99(0xf8)]+_0x3c6e99(0xba),_0x12de54),this['_logger'][_0x3c6e99(0x9b)](_0x3c6e99(0x81)+(_0x56b5a7?_0x3c6e99(0xbb):_0x3c6e99(0x71))+'.'),await this[_0x3c6e99(0x105)][_0x3c6e99(0xb1)]();}}exports[a255_0x3476bd(0x69)]=DeployService;