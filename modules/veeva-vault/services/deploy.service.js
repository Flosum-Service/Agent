const a311_0x236f23=a311_0x2268;(function(_0x4e763f,_0x304102){const _0x53e55f=a311_0x2268,_0x1eeff7=_0x4e763f();while(!![]){try{const _0x1f7665=-parseInt(_0x53e55f(0xf0))/0x1*(-parseInt(_0x53e55f(0xd6))/0x2)+parseInt(_0x53e55f(0x131))/0x3*(parseInt(_0x53e55f(0x157))/0x4)+parseInt(_0x53e55f(0xdb))/0x5+parseInt(_0x53e55f(0x137))/0x6+-parseInt(_0x53e55f(0xe3))/0x7+parseInt(_0x53e55f(0x112))/0x8+-parseInt(_0x53e55f(0x14f))/0x9;if(_0x1f7665===_0x304102)break;else _0x1eeff7['push'](_0x1eeff7['shift']());}catch(_0x247ca0){_0x1eeff7['push'](_0x1eeff7['shift']());}}}(a311_0x4f29,0x57e43));const a311_0x3e72e2=(function(){let _0x14ff84=!![];return function(_0x3ad560,_0x1ba526){const _0x13b83c=_0x14ff84?function(){const _0x4e1d3a=a311_0x2268;if(_0x1ba526){const _0x2bc463=_0x1ba526[_0x4e1d3a(0xbe)](_0x3ad560,arguments);return _0x1ba526=null,_0x2bc463;}}:function(){};return _0x14ff84=![],_0x13b83c;};}()),a311_0x53901c=a311_0x3e72e2(this,function(){const _0x511d47=a311_0x2268;return a311_0x53901c[_0x511d47(0x10f)]()['search'](_0x511d47(0xdc))[_0x511d47(0x10f)]()[_0x511d47(0x106)](a311_0x53901c)[_0x511d47(0xf2)]('(((.+)+)+)+$');});a311_0x53901c();'use strict';var __importDefault=this&&this[a311_0x236f23(0x18f)]||function(_0x244381){const _0x457643=a311_0x236f23;return _0x244381&&_0x244381[_0x457643(0x12a)]?_0x244381:{'default':_0x244381};};Object[a311_0x236f23(0x15f)](exports,'__esModule',{'value':!![]}),exports[a311_0x236f23(0x138)]=void 0x0;function a311_0x4f29(){const _0x2d71ec=['async','lastIndexOf','isSuccess','put','updateLog','Generate\x20vpk\x20package','files','text','VeevaError','componentIdList','length','../../../constants','saveLog','ENDPOINT_VALIDATE_PACKAGE','_metadataLogId','Save\x20log','writeFile','logError','rel','__importDefault','Component_Name__c','<a\x20href=','finishDeployWithError','fetchAttachmentsDetailsByParentId','status','Join\x20all\x20mdl\x20into\x20one\x20zip','formFlosumDeploymentResults','FLOSUM_NAMESPACE','execute','Package\x20not\x20verified','apply','get','map','getDeployDetailsAndSaveLog','VeevaResponseStatus','PackageComponentDto','isDeployed','SUCCESS','packageComponentList','vaultpackage.xml','Flosum','_timeZone','organisationId','ENDPOINT_EXPORT_IMPORT_PACKAGE','_branchId','getLogResultText','VeevaConstants','_connectionSalesforce','retrieveAttachments','../dtos/job-result.dto','fs/promises','Branch__c\x20=\x20\x27','TargetId__c','../classes/errors/veeva-error','835502oWMUAW','string','JobResultDto','Retrieving\x20attachments','Validate\x20package','3511060qhLyXU','(((.+)+)+)+$','_tempFolder','Save\x20Deployment\x20Results','Log__c','Async_Request_Id__c','\x20:\x20','Import\x20package','3365250iSUtLw','url','file','../utils/veeva-auth.utils','Validation\x20Log','Validation.log','DEPLOYED','\x20</a>','content-type','multipart/form-data','VeevaPackageStatus','name','Failure','1oUuDHa','getJobResult','search','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','ComponentDto','VeevaJobStatus','componentHistoryId','_organisationId','Builder','../../../core','parse','Result__c','_organisationName','vaultPackage','artifacts','includes','_attachmentLogId','shortid','Action__c','formPackageComponentList','_instanceUrl','attachmentLogId','constructor','detailUrl','Cannot\x20retrieve\x20all\x20components.','\x20has\x20been\x20created.','replace','null','catch','/Attachment','has','toString','../dtos/package-component.dto','deploymentName','3906072kNujle','errors','</a>','Form\x20Deployment\x20Results','.zip','getValidationDetailsAndSaveLog','flat','DEPLOYED_WITH_WARNINGS','patch','updateVeevaConnection','FlosumConstants','Deployment','\x20of\x20branch\x20to\x20Organization\x20','from','values','Metadata_Log__c','Type__c','success','retrieveComponents','finishDeploy','\x20>\x20','joinAllAttachments','filter','toLowerCase','__esModule','Components__r\x20ORDER\x20BY\x20','jszip','Retrieving\x20components','timeZone','_deploymentName','Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','3XMfvLy','default','Cannot\x20find\x20deployment\x20results','./veeva.service','migration__v','Succeed__c','1416318fetcqA','DeployService','_logger','form-data','Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20','xml2js','_componentIdList','Veeva\x20Deployment','Is_Error__c','Deploy\x20completed\x20','ENDPOINT_DEPLOY_PACKAGE','../classes/errors/salesforce-dml-error','Deploy\x20Log','responseStatus','retrieveRecords','error','filename','Date__c','package_components','headers','Status__c','with\x20error','base64','post','11504592gVQIGA','endsWith','EXCEPTION','organisationName','metadataLogId','saveDeploymentResults','generateVPK','createReadStream','1099064lBBWJG','componentType','ENDPOINT_UPSERT_RECORD','branchId','Wait\x20Executing\x20job','importVpk','append','veeva-deploy','defineProperty','nodebuffer','validateVpk','Cannot\x20retrieve\x20all\x20attachments','_connectionVeeva','PackageComponentStatus','reduce','Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20','buildObject','MetadataLogStatus','getJobStatus','successfully','Deployment\x20Result','../../shared/utils/fetch-attachments','_systemLogger','log','type','PROCESS_DEPLOYMENT','data','set','href','packageId','deployPackage','VERIFIED','COMPLETED','text/plain','https://veevavault.com/','/vpk__','Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20'];a311_0x4f29=function(){return _0x2d71ec;};return a311_0x4f29();}const jszip_1=__importDefault(require(a311_0x236f23(0x12c))),form_data_1=__importDefault(require(a311_0x236f23(0x13a))),fs_1=require('fs'),promises_1=require(a311_0x236f23(0xd2)),constants_1=require(a311_0x236f23(0x187)),flosum_constants_1=require('../constants/flosum.constants'),veeva_constants_1=require('../constants/veeva.constants'),veeva_service_1=require(a311_0x236f23(0x134)),component_dto_1=require('../dtos/component.dto'),job_result_dto_1=require(a311_0x236f23(0xd1)),package_component_dto_1=require(a311_0x236f23(0x110)),salesforce_service_1=require('./salesforce.service'),core_1=require(a311_0x236f23(0xf9)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a311_0x236f23(0x142)),veeva_error_1=require(a311_0x236f23(0xd5)),shortid_1=__importDefault(require(a311_0x236f23(0x101))),veeva_auth_utils_1=require(a311_0x236f23(0xe6)),xml2js_1=require(a311_0x236f23(0x13c)),fetch_attachments_1=require(a311_0x236f23(0x16c));class DeployService{constructor(_0x2df5bc,_0x28f905,_0x41dc6,_0x53454b,_0x1f2eae,_0x3bad56){const _0x15d31c=a311_0x236f23;this[_0x15d31c(0xcf)]=_0x28f905,this['_connectionVeeva']=_0x41dc6,this[_0x15d31c(0x139)]=_0x53454b,this[_0x15d31c(0xdd)]=_0x1f2eae,this[_0x15d31c(0x104)]=_0x3bad56,this[_0x15d31c(0xcc)]=_0x2df5bc[_0x15d31c(0x15a)],this[_0x15d31c(0x18a)]=_0x2df5bc[_0x15d31c(0x153)],this[_0x15d31c(0x100)]=_0x2df5bc[_0x15d31c(0x105)],this['_organisationId']=_0x2df5bc[_0x15d31c(0xca)],this[_0x15d31c(0xc9)]=_0x2df5bc[_0x15d31c(0x12e)],this[_0x15d31c(0xfc)]=_0x2df5bc[_0x15d31c(0x152)],this[_0x15d31c(0x13d)]=_0x2df5bc[_0x15d31c(0x185)],this[_0x15d31c(0x12f)]=_0x2df5bc[_0x15d31c(0x111)],this[_0x15d31c(0x16d)]=new core_1['Logger'](_0x15d31c(0x15e));}async[a311_0x236f23(0xbc)](){const _0x418e05=a311_0x236f23;try{const _0x1f40ed=await this[_0x418e05(0x124)](),_0x51738a=await this[_0x418e05(0xd0)](_0x1f40ed),_0x1bffb2=await this[_0x418e05(0x127)](_0x51738a),_0x35e629=await this[_0x418e05(0x155)](_0x1bffb2);await this[_0x418e05(0x161)](_0x35e629);const _0x4bc02a=await this[_0x418e05(0x15c)](_0x35e629),_0x3b111d=await this[_0x418e05(0x169)](_0x4bc02a);await this[_0x418e05(0x117)](_0x3b111d);const _0x2b149c=await this[_0x418e05(0x175)](_0x3b111d[_0x418e05(0x174)]),_0x56336b=await this[_0x418e05(0x169)](_0x2b149c);await this[_0x418e05(0xc1)](_0x56336b);const _0x3b6b87=this[_0x418e05(0x196)](_0x1f40ed,_0x56336b[_0x418e05(0xc6)]);await this[_0x418e05(0x154)](_0x3b6b87),await this['finishDeploy'](_0x56336b[_0x418e05(0xc4)],![],_0x3b111d[_0x418e05(0x174)]);}catch(_0x35b826){await this[_0x418e05(0x192)](_0x35b826)[_0x418e05(0x10c)](_0x3906ce=>this['_systemLogger'][_0x418e05(0x146)](_0x3906ce));}}async[a311_0x236f23(0x124)](){const _0x3dc561=a311_0x236f23,_0x5107d7=new Set(this[_0x3dc561(0x13d)]);this[_0x3dc561(0x139)][_0x3dc561(0x16e)](_0x3dc561(0x12d));const _0x2a0cb6=_0x3dc561(0xf3)+constants_1[_0x3dc561(0xbb)]+_0x3dc561(0x130)+constants_1['FLOSUM_NAMESPACE']+_0x3dc561(0x13b)+constants_1['FLOSUM_NAMESPACE']+_0x3dc561(0x12b)+constants_1['FLOSUM_NAMESPACE']+_0x3dc561(0x166)+constants_1[_0x3dc561(0xbb)]+_0x3dc561(0x17b)+constants_1[_0x3dc561(0xbb)]+_0x3dc561(0xd3)+this['_branchId']+'\x27',_0x3285cb=await salesforce_service_1['SalesforceService'][_0x3dc561(0x145)](this[_0x3dc561(0xcf)],_0x2a0cb6);if(!_0x3285cb[_0x3dc561(0x186)])throw new Error(_0x3dc561(0x108));const _0x232dd3=_0x3285cb[_0x3dc561(0xc0)](_0x17e18e=>new component_dto_1[(_0x3dc561(0xf4))](_0x17e18e))[_0x3dc561(0x128)](_0xda7f1a=>_0x5107d7[_0x3dc561(0x10e)](_0xda7f1a['id']));if(_0x232dd3['length']!==this['_componentIdList'][_0x3dc561(0x186)])throw new Error('Cannot\x20retrieve\x20all\x20components.');return _0x232dd3;}async[a311_0x236f23(0xd0)](_0xdc5339){const _0x32cbab=a311_0x236f23;this['_logger'][_0x32cbab(0x16e)](_0x32cbab(0xd9));const _0x5c8070=await(0x0,fetch_attachments_1[_0x32cbab(0x193)])(this[_0x32cbab(0xcf)],_0xdc5339[_0x32cbab(0xc0)](_0x1dd646=>_0x1dd646[_0x32cbab(0xf6)])),_0x573f71=await(0x0,fetch_attachments_1[_0x32cbab(0xd0)])(_0x5c8070,this['_connectionSalesforce']);if(_0x573f71['length']!==this['_componentIdList'][_0x32cbab(0x186)])throw new Error(_0x32cbab(0x162));return _0x573f71['map'](_0x55afdd=>_0x55afdd[_0x32cbab(0x120)]['Body']);}async[a311_0x236f23(0x127)](_0xe1d65f){const _0x290064=a311_0x236f23;var _0x14200a;this['_logger'][_0x290064(0x16e)](_0x290064(0x195));const _0x3c970f=new jszip_1[(_0x290064(0x132))]();for(const _0x3880ba of _0xe1d65f){const _0x16f599=new jszip_1[(_0x290064(0x132))]();await _0x16f599['loadAsync'](_0x3880ba,{'base64':!![]});for(const _0x1638de in _0x16f599[_0x290064(0x182)]){const _0x19e02b=await((_0x14200a=_0x16f599[_0x290064(0xe5)](_0x1638de))===null||_0x14200a===void 0x0?void 0x0:_0x14200a[_0x290064(0x17c)](_0x290064(0xd7)));_0x19e02b&&_0x3c970f[_0x290064(0xe5)](_0x1638de,_0x19e02b);}}const _0x256b7b=new xml2js_1[(_0x290064(0xf8))]({'headless':!![]}),_0x50da26={'vaultpackage':{'$':{'xmlns':_0x290064(0x179)},'name':this['_deploymentName'],'source':{'vault':undefined,'author':_0x290064(0xc8)},'packagetype':_0x290064(0x135),'summary':'Deploy','description':_0x290064(0x10b)}};_0x3c970f['file'](_0x290064(0xc7),_0x256b7b[_0x290064(0x167)](_0x50da26));const _0x6613b8=this['_tempFolder']+'/'+(0x0,shortid_1[_0x290064(0x132)])()+_0x290064(0x116),_0x5a7285=await _0x3c970f['generateAsync']({'type':_0x290064(0x160)});return await(0x0,promises_1[_0x290064(0x18c)])(_0x6613b8,_0x5a7285),_0x6613b8;}async[a311_0x236f23(0x155)](_0x21a370,_0x5bda86=0x1){const _0x3bfb0d=a311_0x236f23;var _0x2a17f7;this['_logger'][_0x3bfb0d(0x16e)](_0x3bfb0d(0x181));const _0x249dcc=new form_data_1['default']();_0x249dcc[_0x3bfb0d(0x15d)](_0x3bfb0d(0xe5),(0x0,fs_1[_0x3bfb0d(0x156)])(_0x21a370));const _0x1083c4=await this['_connectionVeeva'][_0x3bfb0d(0x14e)](veeva_constants_1[_0x3bfb0d(0xce)][_0x3bfb0d(0xcb)],_0x249dcc,{'responseType':'arraybuffer','headers':{'Content-Type':_0x3bfb0d(0xec)}}),_0xb02289=(_0x2a17f7=_0x1083c4[_0x3bfb0d(0x14a)][_0x3bfb0d(0xeb)])===null||_0x2a17f7===void 0x0?void 0x0:_0x2a17f7[_0x3bfb0d(0xff)]('application/json');if(!_0xb02289){const _0x3e39d4=_0x1083c4[_0x3bfb0d(0x171)],_0x1ee86e=this[_0x3bfb0d(0xdd)]+_0x3bfb0d(0x17a)+_0x21a370['slice'](_0x21a370[_0x3bfb0d(0x17d)]('/')+0x1);return await(0x0,promises_1[_0x3bfb0d(0x18c)])(_0x1ee86e,_0x3e39d4),_0x1ee86e;}else{const _0x5583c6=JSON[_0x3bfb0d(0xfa)](_0x1083c4[_0x3bfb0d(0x171)]);if(_0x5bda86>0x0)return await(0x0,veeva_auth_utils_1[_0x3bfb0d(0x11b)])(this[_0x3bfb0d(0x163)]),await this[_0x3bfb0d(0x155)](_0x21a370,_0x5bda86-0x1);throw new veeva_error_1[(_0x3bfb0d(0x184))](_0x5583c6['errors']);}}async['validateVpk'](_0x1265b9,_0x1f4933=0x1){const _0x1bcac0=a311_0x236f23;this[_0x1bcac0(0x139)][_0x1bcac0(0x16e)](_0x1bcac0(0xda));const _0x3d4033=new form_data_1[(_0x1bcac0(0x132))]();_0x3d4033['append'](_0x1bcac0(0xe5),(0x0,fs_1[_0x1bcac0(0x156)])(_0x1265b9));const _0x273baa=await this['_connectionVeeva'][_0x1bcac0(0x14e)](veeva_constants_1[_0x1bcac0(0xce)][_0x1bcac0(0x189)],_0x3d4033,{'headers':{'Content-Type':_0x1bcac0(0xec)}}),_0xc545fc=_0x273baa[_0x1bcac0(0x171)];if(_0xc545fc[_0x1bcac0(0x144)]===status_enums_1[_0x1bcac0(0xc2)][_0x1bcac0(0xc5)])return _0xc545fc;else{if(_0x1f4933>0x0)return await(0x0,veeva_auth_utils_1[_0x1bcac0(0x11b)])(this[_0x1bcac0(0x163)]),await this['validateVpk'](_0x1265b9,_0x1f4933-0x1);throw new veeva_error_1[(_0x1bcac0(0x184))](_0xc545fc[_0x1bcac0(0x113)]);}}async[a311_0x236f23(0x15c)](_0x431489,_0x241f1e=0x1){const _0x509624=a311_0x236f23;this[_0x509624(0x139)][_0x509624(0x16e)](_0x509624(0xe2));const _0x4c2fe5=new form_data_1['default']();_0x4c2fe5[_0x509624(0x15d)](_0x509624(0xe5),(0x0,fs_1[_0x509624(0x156)])(_0x431489));const _0x4c0e5e=await this[_0x509624(0x163)][_0x509624(0x17f)](veeva_constants_1['VeevaConstants'][_0x509624(0xcb)],_0x4c2fe5,{'headers':{'Content-Type':'multipart/form-data'}}),_0x217921=_0x4c0e5e[_0x509624(0x171)];if(_0x217921['responseStatus']===status_enums_1[_0x509624(0xc2)][_0x509624(0xc5)])return _0x217921[_0x509624(0xe4)];else{if(_0x241f1e>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x509624(0x163)]),await this[_0x509624(0x15c)](_0x431489,_0x241f1e-0x1);throw new veeva_error_1['VeevaError'](_0x217921[_0x509624(0x113)]);}}async[a311_0x236f23(0x175)](_0x405e87){const _0x319108=a311_0x236f23;this[_0x319108(0x139)][_0x319108(0x16e)]('Deploy\x20package');const _0x3dfcea=await this[_0x319108(0x163)][_0x319108(0x14e)](veeva_constants_1[_0x319108(0xce)][_0x319108(0x141)][_0x319108(0x10a)]('{package_id}',_0x405e87)),_0x1e3c99=await _0x3dfcea[_0x319108(0x171)];if(_0x1e3c99[_0x319108(0x144)]===status_enums_1[_0x319108(0xc2)][_0x319108(0xc5)])return _0x1e3c99[_0x319108(0xe4)];else throw new veeva_error_1['VeevaError'](_0x1e3c99[_0x319108(0x113)]);}async[a311_0x236f23(0x169)](_0xd1572e){const _0x499739=a311_0x236f23;this[_0x499739(0x139)][_0x499739(0x16e)](_0x499739(0x15b));const _0x3f523c=new job_result_dto_1[(_0x499739(0xd8))](),[_0x5eba30]=await veeva_service_1['VeevaService'][_0x499739(0xf1)]([_0xd1572e],this[_0x499739(0x163)],this[_0x499739(0x139)]);return _0x3f523c[_0x499739(0x17e)]=_0x5eba30[_0x499739(0x194)]===status_enums_1[_0x499739(0xf5)][_0x499739(0xc5)],_0x3f523c[_0x499739(0x107)]=_0x5eba30['links']['find'](_0x19070a=>_0x19070a[_0x499739(0x18e)]===_0x499739(0xfe))[_0x499739(0x173)],_0x3f523c;}async[a311_0x236f23(0x117)](_0x56e637){const _0x5dbfc0=a311_0x236f23;this[_0x5dbfc0(0x139)]['log']('Get\x20validation\x20details.');const {data:_0x574d68}=await this[_0x5dbfc0(0x163)][_0x5dbfc0(0xbf)](_0x56e637[_0x5dbfc0(0x107)]);if(_0x574d68[_0x5dbfc0(0x144)]===status_enums_1[_0x5dbfc0(0xc2)][_0x5dbfc0(0xc5)]){const {log:_0x3b3d3a,id:_0x5486b1,package_status:_0x4df2d3}=_0x574d68[_0x5dbfc0(0xfd)],_0x5d211e=_0x3b3d3a['filter'](_0x5e76ba=>_0x5e76ba[_0x5dbfc0(0x147)]['endsWith'](_0x5dbfc0(0xe8))),_0x28bd71=await this[_0x5dbfc0(0xcd)](_0x5d211e[0x0][_0x5dbfc0(0xe4)]);await this[_0x5dbfc0(0x188)](_0x28bd71,_0x5dbfc0(0xe7)),_0x56e637[_0x5dbfc0(0x174)]=_0x5486b1;if(_0x4df2d3!==status_enums_1[_0x5dbfc0(0xed)][_0x5dbfc0(0x176)])throw new Error(_0x5dbfc0(0xbd));}else throw new veeva_error_1['VeevaError'](_0x574d68[_0x5dbfc0(0x113)]);}async[a311_0x236f23(0xc1)](_0x741a52){const _0x3c6c47=a311_0x236f23;this[_0x3c6c47(0x139)][_0x3c6c47(0x16e)]('Get\x20deploy\x20result');const {data:_0x5c3bdf}=await this[_0x3c6c47(0x163)]['get'](_0x741a52['detailUrl']);if(_0x5c3bdf['responseStatus']===status_enums_1[_0x3c6c47(0xc2)]['SUCCESS']){const {responseDetails:{deployment_log:_0x5093e3,package_status__v:_0x541741},package_steps:_0x5cf0b1}=_0x5c3bdf,_0xdbe927=_0x5093e3[_0x3c6c47(0x128)](_0x2c30ef=>_0x2c30ef['filename'][_0x3c6c47(0x150)]('Deployment.log')),_0x32c2f1=await this[_0x3c6c47(0xcd)](_0xdbe927[0x0][_0x3c6c47(0xe4)]);await this[_0x3c6c47(0x188)](_0x32c2f1,_0x3c6c47(0x143)),_0x741a52[_0x3c6c47(0xc4)]=[status_enums_1[_0x3c6c47(0xed)][_0x3c6c47(0xe9)],status_enums_1[_0x3c6c47(0xed)][_0x3c6c47(0x119)]][_0x3c6c47(0xff)](_0x541741);const _0x485caf=this[_0x3c6c47(0x103)](_0x5cf0b1);_0x741a52[_0x3c6c47(0xc6)]=_0x485caf[_0x3c6c47(0x128)](_0x2a713a=>_0x2a713a['status']!==status_enums_1[_0x3c6c47(0x164)]['VERIFIED']);if(!_0x741a52[_0x3c6c47(0xc6)]['length'])throw new Error(_0x3c6c47(0x133));}else throw new veeva_error_1[(_0x3c6c47(0x184))](_0x5c3bdf[_0x3c6c47(0x113)]);}async[a311_0x236f23(0xcd)](_0x3b8095){const _0x274a96=a311_0x236f23,{data:_0x32785e}=await this['_connectionVeeva'][_0x274a96(0xbf)](_0x3b8095,{'responseType':_0x274a96(0x183)});return _0x32785e;}[a311_0x236f23(0x103)](_0x30ff6e){return _0x30ff6e['reduce']((_0x31ed98,_0x242616)=>{const _0x214a02=a311_0x2268,_0x614f71=_0x242616[_0x214a02(0x149)][_0x214a02(0xc0)](_0x2db48b=>new package_component_dto_1[(_0x214a02(0xc3))](_0x2db48b,_0x242616['deployment_status__v']));return[..._0x31ed98,..._0x614f71];},[]);}async['saveLog'](_0x328c25,_0x371ebf){const _0x4755fc=a311_0x236f23;this[_0x4755fc(0x139)]['log'](_0x4755fc(0x18b));const _0xfa2d5e={'Body':Buffer[_0x4755fc(0x11f)](_0x328c25)['toString'](_0x4755fc(0x14d)),'ContentType':_0x4755fc(0x178),'ParentId':this['_metadataLogId'],'Name':_0x371ebf},{data:_0x34b46e}=await this['_connectionSalesforce'][_0x4755fc(0x14e)](flosum_constants_1[_0x4755fc(0x11c)][_0x4755fc(0x159)]+_0x4755fc(0x10d),_0xfa2d5e);return _0x34b46e['id'];}['formFlosumDeploymentResults'](_0x12705f,_0xa0cfe3){const _0xc52194=a311_0x236f23;this[_0xc52194(0x139)]['log'](_0xc52194(0x115));const _0x3c9b6f=_0x12705f[_0xc52194(0x165)]((_0xd3fac1,_0x2e3020)=>_0xd3fac1[_0xc52194(0x172)]((_0x2e3020[_0xc52194(0x158)]+'.'+_0x2e3020['componentName'])[_0xc52194(0x129)](),_0x2e3020),new Map());return _0xa0cfe3[_0xc52194(0xc0)](_0x32b565=>{const _0xa76371=_0xc52194;this['_logger'][_0xa76371(0x16e)](_0x32b565['type']+'.'+_0x32b565[_0xa76371(0xee)]+_0xa76371(0xe1)+_0x32b565[_0xa76371(0x194)]);const _0x5e41a8=(_0x32b565[_0xa76371(0x16f)]+'.'+_0x32b565[_0xa76371(0xee)])['toLowerCase'](),_0xad9736=_0x3c9b6f[_0xa76371(0xbf)](_0x5e41a8);return{[constants_1[_0xa76371(0xbb)]+_0xa76371(0x122)]:_0xa76371(0x16b),[constants_1[_0xa76371(0xbb)]+_0xa76371(0x14b)]:_0x32b565['status']===status_enums_1[_0xa76371(0x164)][_0xa76371(0xe9)]?'Success':_0xa76371(0xef),[constants_1['FLOSUM_NAMESPACE']+_0xa76371(0xfb)]:'RECREATE',[constants_1[_0xa76371(0xbb)]+_0xa76371(0x190)]:_0x32b565[_0xa76371(0xee)],[constants_1[_0xa76371(0xbb)]+'Component_Type__c']:_0x32b565[_0xa76371(0x16f)],[constants_1['FLOSUM_NAMESPACE']+'Org__c']:this[_0xa76371(0xf7)],[constants_1['FLOSUM_NAMESPACE']+_0xa76371(0x121)]:this['_metadataLogId'],[constants_1[_0xa76371(0xbb)]+'Component_History__c']:_0xad9736['componentHistoryId']};});}async[a311_0x236f23(0x154)](_0x3abc29){const _0x4707d4=a311_0x236f23;this[_0x4707d4(0x139)]['log'](_0x4707d4(0xde));const _0x348775=await salesforce_service_1['SalesforceService']['insertMultipleRecords'](this[_0x4707d4(0xcf)],constants_1[_0x4707d4(0xbb)]+'Deployment_Result__c',_0x3abc29),_0x366bcf=_0x348775[_0x4707d4(0x128)](_0x24ee01=>!_0x24ee01[_0x4707d4(0x123)])[_0x4707d4(0xc0)](_0x256dd1=>_0x256dd1[_0x4707d4(0x113)])[_0x4707d4(0x118)]();if(_0x366bcf[_0x4707d4(0x186)])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x366bcf);}async['finishDeployWithError'](_0x513542){const _0x323bdf=a311_0x236f23;this['_logger'][_0x323bdf(0x18d)](_0x513542),await this[_0x323bdf(0x139)][_0x323bdf(0x180)](),await this['finishDeploy'](![],!![],'');}async[a311_0x236f23(0x125)](_0x46a033,_0x5bd646,_0x1c4a7b){const _0x419830=a311_0x236f23,_0x481e21=_0x419830(0x191)+this[_0x419830(0x104)]+'/'+this[_0x419830(0x18a)]+_0x419830(0x126)+_0x419830(0x13e)+_0x419830(0xea),_0x32dbb3=_0x419830(0x191)+this['_instanceUrl']+'/'+this['_organisationId']+'\x20>'+this[_0x419830(0xfc)]+_0x419830(0x114),_0x40d18f=_0x481e21+_0x419830(0x11e)+_0x32dbb3+_0x419830(0x109),_0xcdbe24={[constants_1[_0x419830(0xbb)]+_0x419830(0x102)]:_0x40d18f,[constants_1[_0x419830(0xbb)]+_0x419830(0x148)]:new Date(),[constants_1[_0x419830(0xbb)]+'Branch__c']:this[_0x419830(0xcc)],[constants_1[_0x419830(0xbb)]+'Activity_Item__c']:'Branch',[constants_1['FLOSUM_NAMESPACE']+'Activity_Type__c']:_0x419830(0x11d),[constants_1['FLOSUM_NAMESPACE']+_0x419830(0xd4)]:this[_0x419830(0xf7)]},_0x59bf47={[constants_1[_0x419830(0xbb)]+_0x419830(0x13f)]:!_0x46a033,[constants_1[_0x419830(0xbb)]+_0x419830(0x136)]:_0x46a033,[constants_1[_0x419830(0xbb)]+_0x419830(0x14b)]:_0x5bd646?status_enums_1[_0x419830(0x168)][_0x419830(0x151)]:status_enums_1['MetadataLogStatus'][_0x419830(0x177)],[constants_1['FLOSUM_NAMESPACE']+'Job_Completed__c']:!![],[constants_1[_0x419830(0xbb)]+'Process_Type__c']:flosum_constants_1['FlosumConstants'][_0x419830(0x170)],[constants_1[_0x419830(0xbb)]+_0x419830(0xe0)]:_0x1c4a7b};await this[_0x419830(0xcf)][_0x419830(0x11a)](flosum_constants_1['FlosumConstants'][_0x419830(0x159)]+'/'+constants_1['FLOSUM_NAMESPACE']+'Metadata_Log__c/'+this['_metadataLogId'],_0x59bf47),await this[_0x419830(0xcf)][_0x419830(0x14e)](flosum_constants_1[_0x419830(0x11c)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x419830(0xbb)]+_0x419830(0xdf),_0xcdbe24),this['_logger'][_0x419830(0x16e)](_0x419830(0x140)+(_0x46a033?_0x419830(0x16a):_0x419830(0x14c))+'.'),await this[_0x419830(0x139)][_0x419830(0x180)]();}}function a311_0x2268(_0x246fdd,_0x263331){const _0x1994ba=a311_0x4f29();return a311_0x2268=function(_0x53901c,_0x3e72e2){_0x53901c=_0x53901c-0xbb;let _0x4f29bb=_0x1994ba[_0x53901c];return _0x4f29bb;},a311_0x2268(_0x246fdd,_0x263331);}exports[a311_0x236f23(0x138)]=DeployService;