function a358_0x2055(){const _0x4a45fa=['../classes/retrievers/veeva-components/flosum-component.veeva-component.retriever','../constants/flosum.constants','saveLog','retrieve','_branchId','createZip','Log__c','DeployService','2631005lMnCwh','writeFile','formFlosumDeploymentResults','FLOSUM_NAMESPACE','isDeployed','bind','updateLog','../classes/deploy/zip-creator.deploy','Deployment_Result__c','../classes/errors/salesforce-dml-error','error','text/plain','\x20of\x20branch\x20to\x20Organization\x20','../classes/retrievers/flosum-components/branch-component-history.flosum-component.retriever','Deployment\x20Result','application/zip','PackageExportService','_instanceUrl','4100568oFcLQm','search','logError','length','_organisationName','Failure','shortid','Veeva\x20Deployment','Component_Type__c','type','toString','jszip','../../../constants','\x20:\x20','createVpk','reduce','Org__c','2114750UHpplU','Create\x20vpk\x20package','Join\x20all\x20mdl\x20into\x20one\x20zip','map','4171872fSYFkX','PackageImportService','External_Deployment_Id__c','flat','Body','with\x20error','6kYDqAC','./package-import.service','patch','Logger','toLowerCase','base64','BACKUP_ZIP_NAME','retrieveAttachments','<a\x20href=','_vpkService','(((.+)+)+)+$','_timeZone','stepName','_organisationId','</a>','veeva-deploy','/Attachment','Type__c','_componentIdList','Save\x20Deployment\x20Results','Branch__c','_logger','apply','log','.zip','validate','_metadataLogId','Form\x20Deployment\x20Results','FlosumConstants','defineProperty','saveDeploymentResults','componentIdList','metadataLogId','15531579jdpIqj','getFlosumComponents','fs/promises','slice','Cannot\x20Backup\x20more\x20than\x20200\x20components.','__esModule','_attachmentLogId','\x20>\x20','values','name','./veeva.service','Backup','componentType','has','Succeed__c','Cannot\x20retrievers\x20all\x20attachments','./vpk.service','_veevaService','7TPwHqx','_connectionVeeva','./package-export.service','_packageExportService','COMPLETED','errors','finishDeployWithError','Veeva_Step_Name__c','componentHistoryId','_systemLogger','VeevaService','packageComponentList','_tempFolder','Deployment','1085596qnagSU','SalesforceDmlError','status','Date__c','FlosumComponentVeevaComponentRetriever','Status__c','timeZone','Metadata_Log__c','import','from','_salesforceService','23532pRBGTH','successfully','Activity_Item__c','ENDPOINT_UPSERT_RECORD','Activity_Type__c','Create\x20Backup','organisationName','\x20</a>','DEPLOYED','componentName','packageId','_connectionSalesforce','execute','_packageImportService','finishDeploy','Success','get','insertMultipleRecords','filter','organisationId','post','createBackup','default','_deploymentName','Deploy\x20completed\x20','Result__c','Cannot\x20retrieve\x20all\x20components.'];a358_0x2055=function(){return _0x4a45fa;};return a358_0x2055();}const a358_0x5e3ff6=a358_0x4c7b;(function(_0x58a971,_0x337a8b){const _0x3d28f9=a358_0x4c7b,_0x2d6872=_0x58a971();while(!![]){try{const _0x2bb50a=-parseInt(_0x3d28f9(0x15c))/0x1+parseInt(_0x3d28f9(0x106))/0x2+-parseInt(_0x3d28f9(0x110))/0x3*(-parseInt(_0x3d28f9(0x151))/0x4)+-parseInt(_0x3d28f9(0xe3))/0x5+parseInt(_0x3d28f9(0x10a))/0x6+parseInt(_0x3d28f9(0x143))/0x7*(parseInt(_0x3d28f9(0xf5))/0x8)+-parseInt(_0x3d28f9(0x131))/0x9;if(_0x2bb50a===_0x337a8b)break;else _0x2d6872['push'](_0x2d6872['shift']());}catch(_0x1cdd5d){_0x2d6872['push'](_0x2d6872['shift']());}}}(a358_0x2055,0x82070));const a358_0x5e3119=(function(){let _0x1d974b=!![];return function(_0x3df378,_0x48de11){const _0x3d78a1=_0x1d974b?function(){const _0x59eef5=a358_0x4c7b;if(_0x48de11){const _0x2b88e8=_0x48de11[_0x59eef5(0x126)](_0x3df378,arguments);return _0x48de11=null,_0x2b88e8;}}:function(){};return _0x1d974b=![],_0x3d78a1;};}()),a358_0x1445bd=a358_0x5e3119(this,function(){const _0x175f4e=a358_0x4c7b;return a358_0x1445bd[_0x175f4e(0xff)]()[_0x175f4e(0xf6)](_0x175f4e(0x11a))[_0x175f4e(0xff)]()['constructor'](a358_0x1445bd)[_0x175f4e(0xf6)](_0x175f4e(0x11a));});a358_0x1445bd();'use strict';var __importDefault=this&&this['__importDefault']||function(_0xb7fa9c){const _0x27d1d9=a358_0x4c7b;return _0xb7fa9c&&_0xb7fa9c[_0x27d1d9(0x136)]?_0xb7fa9c:{'default':_0xb7fa9c};};Object[a358_0x5e3ff6(0x12d)](exports,a358_0x5e3ff6(0x136),{'value':!![]}),exports[a358_0x5e3ff6(0xe2)]=void 0x0;const jszip_1=__importDefault(require(a358_0x5e3ff6(0x100))),promises_1=require(a358_0x5e3ff6(0x133)),constants_1=require(a358_0x5e3ff6(0x101)),flosum_constants_1=require(a358_0x5e3ff6(0xdc)),veeva_service_1=require(a358_0x5e3ff6(0x13b)),salesforce_service_1=require('./salesforce.service'),core_1=require('../../../core'),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a358_0x5e3ff6(0xec)),shortid_1=__importDefault(require(a358_0x5e3ff6(0xfb))),fetch_attachments_1=require('../../shared/utils/fetch-attachments'),package_import_service_1=require(a358_0x5e3ff6(0x111)),branch_component_history_flosum_component_retriever_1=require(a358_0x5e3ff6(0xf0)),flosum_component_veeva_component_retriever_1=require(a358_0x5e3ff6(0xdb)),package_export_service_1=require(a358_0x5e3ff6(0x145)),vpk_service_1=require(a358_0x5e3ff6(0x141)),zip_creator_deploy_1=require(a358_0x5e3ff6(0xea));class DeployService{constructor(_0x35cff2,_0x579e35,_0x9f8535,_0x27f0da,_0x396343,_0x31cf7b){const _0x17bc3a=a358_0x5e3ff6;this['_connectionSalesforce']=_0x579e35,this[_0x17bc3a(0x144)]=_0x9f8535,this[_0x17bc3a(0x125)]=_0x27f0da,this[_0x17bc3a(0x14f)]=_0x396343,this[_0x17bc3a(0xf4)]=_0x31cf7b,this[_0x17bc3a(0xdf)]=_0x35cff2['branchId'],this['_metadataLogId']=_0x35cff2[_0x17bc3a(0x130)],this[_0x17bc3a(0x137)]=_0x35cff2['attachmentLogId'],this[_0x17bc3a(0x11d)]=_0x35cff2[_0x17bc3a(0x16f)],this[_0x17bc3a(0x11b)]=_0x35cff2[_0x17bc3a(0x157)],this['_organisationName']=_0x35cff2[_0x17bc3a(0x162)],this[_0x17bc3a(0x122)]=_0x35cff2[_0x17bc3a(0x12f)],this[_0x17bc3a(0xd7)]=_0x35cff2['deploymentName'],this['_systemLogger']=new core_1[(_0x17bc3a(0x113))](_0x17bc3a(0x11f)),this[_0x17bc3a(0x142)]=new veeva_service_1[(_0x17bc3a(0x14d))]({'connection':this[_0x17bc3a(0x144)],'logger':this['_logger']}),this['_salesforceService']=new salesforce_service_1['SalesforceService']({'connection':this['_connectionSalesforce']}),this['_packageImportService']=new package_import_service_1[(_0x17bc3a(0x10b))]({'veevaService':this[_0x17bc3a(0x142)],'connection':this[_0x17bc3a(0x144)],'logger':this[_0x17bc3a(0x125)],'saveLog':this[_0x17bc3a(0xdd)][_0x17bc3a(0xe8)](this)}),this[_0x17bc3a(0x146)]=new package_export_service_1[(_0x17bc3a(0xf3))]({'veevaService':this[_0x17bc3a(0x142)],'connection':this[_0x17bc3a(0x144)],'logger':this[_0x17bc3a(0x125)]}),this['_vpkService']=new vpk_service_1['VpkService']({'connection':this['_connectionVeeva']});}async[a358_0x5e3ff6(0x168)](){const _0xd575cd=a358_0x5e3ff6;try{const _0x2bac13=await this[_0xd575cd(0x132)]();await this[_0xd575cd(0x125)][_0xd575cd(0xe9)]();const _0x338d44=await this[_0xd575cd(0xd5)](_0x2bac13);await this['saveBackup'](_0x338d44);const _0x3d837a=await this[_0xd575cd(0x117)](_0x2bac13),_0xd537f3=await this[_0xd575cd(0xe0)](_0x3d837a),_0x51883b=await this[_0xd575cd(0x103)](_0xd537f3);await this[_0xd575cd(0x125)][_0xd575cd(0xe9)]();const _0x153f24=await this[_0xd575cd(0x169)][_0xd575cd(0x159)](_0x51883b);await this[_0xd575cd(0x125)][_0xd575cd(0xe9)]();const _0x28807e=this[_0xd575cd(0xe5)](_0x2bac13,_0x153f24[_0xd575cd(0x14e)]);await this['saveDeploymentResults'](_0x28807e),await this['finishDeploy'](_0x153f24[_0xd575cd(0xe7)],![],_0x153f24[_0xd575cd(0x166)]);}catch(_0x5b6f7e){await this['finishDeployWithError'](_0x5b6f7e)['catch'](_0x1bbe61=>this[_0xd575cd(0x14c)][_0xd575cd(0xed)](_0x1bbe61));}}async[a358_0x5e3ff6(0x132)](){const _0x764f6a=a358_0x5e3ff6,_0x4ac704=new Set(this[_0x764f6a(0x122)]);this['_logger']['log']('Retrieving\x20components');const _0x1f20b4=await new branch_component_history_flosum_component_retriever_1['BranchComponentHistoryFlosumComponentRetriever']({'value':this[_0x764f6a(0xdf)],'salesforceService':this[_0x764f6a(0x15b)]})[_0x764f6a(0xde)](),_0x4d0335=_0x1f20b4['filter'](_0x1827bf=>_0x4ac704[_0x764f6a(0x13e)](_0x1827bf['id']));if(_0x4d0335[_0x764f6a(0xf8)]!==this[_0x764f6a(0x122)][_0x764f6a(0xf8)])throw new Error(_0x764f6a(0xda));return _0x4d0335;}async[a358_0x5e3ff6(0xd5)](_0x5f1bbb){const _0x17f13f=a358_0x5e3ff6;var _0x33bc5e;this['_logger'][_0x17f13f(0x127)](_0x17f13f(0x161));const _0x4cd2ae=await new flosum_component_veeva_component_retriever_1[(_0x17f13f(0x155))]({'value':_0x5f1bbb,'veevaService':this[_0x17f13f(0x142)],'logger':this['_logger']})[_0x17f13f(0xde)](),_0x496ca9=await this[_0x17f13f(0x146)]['export'](_0x4cd2ae,_0x17f13f(0x13c));if(_0x496ca9[_0x17f13f(0xf8)]>0x1)throw new Error(_0x17f13f(0x135));return(_0x33bc5e=_0x496ca9[0x0])!==null&&_0x33bc5e!==void 0x0?_0x33bc5e:_0x496ca9[0x0]=new jszip_1[(_0x17f13f(0xd6))](),_0x496ca9[0x0]['generateAsync']({'type':_0x17f13f(0x115)});}async['saveBackup'](_0x334d90){const _0x295bd0=a358_0x5e3ff6;this[_0x295bd0(0x125)][_0x295bd0(0x127)]('Save\x20Backup\x20to\x20Salesforce');const _0x1658e5={'Body':_0x334d90,'ContentType':_0x295bd0(0xf2),'ParentId':this[_0x295bd0(0x12a)],'Name':flosum_constants_1['FlosumConstants'][_0x295bd0(0x116)]};await this[_0x295bd0(0x167)][_0x295bd0(0x170)](flosum_constants_1[_0x295bd0(0x12c)][_0x295bd0(0x15f)]+'/Attachment',_0x1658e5);}async[a358_0x5e3ff6(0x117)](_0x302558){const _0xc851b9=a358_0x5e3ff6;this[_0xc851b9(0x125)][_0xc851b9(0x127)]('Retrieving\x20attachments');const _0x10bc68=await(0x0,fetch_attachments_1['fetchAttachmentsDetailsByParentId'])(this['_connectionSalesforce'],_0x302558[_0xc851b9(0x109)](_0x17b049=>_0x17b049[_0xc851b9(0x14b)])),_0x28f162=await(0x0,fetch_attachments_1[_0xc851b9(0x117)])(_0x10bc68,this[_0xc851b9(0x167)]);if(_0x28f162[_0xc851b9(0xf8)]!==this[_0xc851b9(0x122)][_0xc851b9(0xf8)])throw new Error(_0xc851b9(0x140));return _0x28f162[_0xc851b9(0x109)](_0x4420bd=>_0x4420bd[_0xc851b9(0x139)][_0xc851b9(0x10e)]);}async[a358_0x5e3ff6(0xe0)](_0x4dd315){const _0x2cbf42=a358_0x5e3ff6;this[_0x2cbf42(0x125)][_0x2cbf42(0x127)](_0x2cbf42(0x108));const _0x51cd8e=await new zip_creator_deploy_1['ZipCreatorDeploy']({'attachmentBodies':_0x4dd315,'deploymentName':this[_0x2cbf42(0xd7)]})['execute'](),_0x5c2c3f=this[_0x2cbf42(0x14f)]+'/'+(0x0,shortid_1[_0x2cbf42(0xd6)])()+_0x2cbf42(0x128);return await(0x0,promises_1[_0x2cbf42(0xe4)])(_0x5c2c3f,_0x51cd8e),_0x5c2c3f;}async[a358_0x5e3ff6(0x103)](_0x502fb9){const _0x1d451f=a358_0x5e3ff6;this[_0x1d451f(0x125)][_0x1d451f(0x127)](_0x1d451f(0x107));const _0x1082c5=await this[_0x1d451f(0x119)]['generate'](_0x502fb9),_0x10cb55=this['_tempFolder']+'/vpk__'+_0x502fb9[_0x1d451f(0x134)](_0x502fb9['lastIndexOf']('/')+0x1);return await(0x0,promises_1['writeFile'])(_0x10cb55,_0x1082c5),await this['_vpkService'][_0x1d451f(0x129)](_0x10cb55),_0x10cb55;}async[a358_0x5e3ff6(0xdd)](_0x5e325b,_0x5118ad){const _0x472198=a358_0x5e3ff6;this[_0x472198(0x125)][_0x472198(0x127)]('Save\x20log');const _0x548c7e={'Body':Buffer[_0x472198(0x15a)](_0x5e325b)[_0x472198(0xff)]('base64'),'ContentType':_0x472198(0xee),'ParentId':this['_metadataLogId'],'Name':_0x5118ad};await this[_0x472198(0x167)][_0x472198(0x170)](flosum_constants_1[_0x472198(0x12c)][_0x472198(0x15f)]+_0x472198(0x120),_0x548c7e);}[a358_0x5e3ff6(0xe5)](_0x637a66,_0xf79ef){const _0x339d13=a358_0x5e3ff6;this[_0x339d13(0x125)][_0x339d13(0x127)](_0x339d13(0x12b));const _0x5f1e9c=_0x637a66[_0x339d13(0x104)]((_0x1b5e41,_0x1c35f5)=>_0x1b5e41['set']((_0x1c35f5[_0x339d13(0x13d)]+'.'+_0x1c35f5[_0x339d13(0x165)])[_0x339d13(0x114)](),_0x1c35f5),new Map());return _0xf79ef[_0x339d13(0x109)](_0x4a23d2=>{const _0x9a7b1d=_0x339d13;this[_0x9a7b1d(0x125)][_0x9a7b1d(0x127)](_0x4a23d2[_0x9a7b1d(0xfe)]+'.'+_0x4a23d2[_0x9a7b1d(0x13a)]+_0x9a7b1d(0x102)+_0x4a23d2['status']);const _0x1cb80d=(_0x4a23d2['type']+'.'+_0x4a23d2[_0x9a7b1d(0x13a)])[_0x9a7b1d(0x114)](),_0x5412cc=_0x5f1e9c[_0x9a7b1d(0x16c)](_0x1cb80d);return{[constants_1[_0x9a7b1d(0xe6)]+_0x9a7b1d(0x121)]:_0x9a7b1d(0xf1),[constants_1[_0x9a7b1d(0xe6)]+_0x9a7b1d(0x156)]:_0x4a23d2[_0x9a7b1d(0x153)]===status_enums_1['PackageComponentStatus'][_0x9a7b1d(0x164)]?_0x9a7b1d(0x16b):_0x9a7b1d(0xfa),[constants_1[_0x9a7b1d(0xe6)]+_0x9a7b1d(0xd9)]:_0x4a23d2['deploymentAction'],[constants_1[_0x9a7b1d(0xe6)]+'Component_Name__c']:_0x4a23d2[_0x9a7b1d(0x13a)],[constants_1[_0x9a7b1d(0xe6)]+_0x9a7b1d(0xfd)]:_0x4a23d2[_0x9a7b1d(0xfe)],[constants_1['FLOSUM_NAMESPACE']+_0x9a7b1d(0x14a)]:_0x4a23d2[_0x9a7b1d(0x11c)],[constants_1[_0x9a7b1d(0xe6)]+_0x9a7b1d(0x105)]:this[_0x9a7b1d(0x11d)],[constants_1[_0x9a7b1d(0xe6)]+_0x9a7b1d(0x158)]:this[_0x9a7b1d(0x12a)],[constants_1[_0x9a7b1d(0xe6)]+'Component_History__c']:_0x5412cc[_0x9a7b1d(0x14b)]};});}async[a358_0x5e3ff6(0x12e)](_0x4d2fbb){const _0xc578f9=a358_0x5e3ff6;this[_0xc578f9(0x125)]['log'](_0xc578f9(0x123));const _0x15fb1e=await this[_0xc578f9(0x15b)][_0xc578f9(0x16d)](constants_1[_0xc578f9(0xe6)]+_0xc578f9(0xeb),_0x4d2fbb),_0x47c5f2=_0x15fb1e[_0xc578f9(0x16e)](_0x30532b=>!_0x30532b['success'])[_0xc578f9(0x109)](_0x38a97e=>_0x38a97e[_0xc578f9(0x148)])[_0xc578f9(0x10d)]();if(_0x47c5f2[_0xc578f9(0xf8)])throw new salesforce_dml_error_1[(_0xc578f9(0x152))](_0x47c5f2);}async[a358_0x5e3ff6(0x149)](_0x30808f){const _0x1b516e=a358_0x5e3ff6;this[_0x1b516e(0x125)][_0x1b516e(0xf7)](_0x30808f),await this[_0x1b516e(0x125)][_0x1b516e(0xe9)](),await this[_0x1b516e(0x16a)](![],!![],'');}async[a358_0x5e3ff6(0x16a)](_0x135120,_0x56b317,_0x2b88ff){const _0x24fe0e=a358_0x5e3ff6,_0x55d4f6=_0x24fe0e(0x118)+this[_0x24fe0e(0xf4)]+'/'+this['_metadataLogId']+_0x24fe0e(0x138)+_0x24fe0e(0xfc)+_0x24fe0e(0x163),_0x4b76e7=_0x24fe0e(0x118)+this[_0x24fe0e(0xf4)]+'/'+this[_0x24fe0e(0x11d)]+'\x20>'+this[_0x24fe0e(0xf9)]+_0x24fe0e(0x11e),_0x2cb1dd=_0x55d4f6+_0x24fe0e(0xef)+_0x4b76e7+'\x20has\x20been\x20created.',_0x3a8c6a={[constants_1[_0x24fe0e(0xe6)]+'Action__c']:_0x2cb1dd,[constants_1[_0x24fe0e(0xe6)]+_0x24fe0e(0x154)]:new Date(),[constants_1['FLOSUM_NAMESPACE']+_0x24fe0e(0x124)]:this[_0x24fe0e(0xdf)],[constants_1[_0x24fe0e(0xe6)]+_0x24fe0e(0x15e)]:'Branch',[constants_1['FLOSUM_NAMESPACE']+_0x24fe0e(0x160)]:_0x24fe0e(0x150),[constants_1[_0x24fe0e(0xe6)]+'TargetId__c']:this[_0x24fe0e(0x11d)]},_0xc61582={[constants_1[_0x24fe0e(0xe6)]+'Is_Error__c']:!_0x135120,[constants_1['FLOSUM_NAMESPACE']+_0x24fe0e(0x13f)]:_0x135120,[constants_1['FLOSUM_NAMESPACE']+_0x24fe0e(0x156)]:_0x56b317?status_enums_1['MetadataLogStatus']['EXCEPTION']:status_enums_1['MetadataLogStatus'][_0x24fe0e(0x147)],[constants_1[_0x24fe0e(0xe6)]+'Job_Completed__c']:!![],[constants_1[_0x24fe0e(0xe6)]+_0x24fe0e(0x10c)]:_0x2b88ff};await this[_0x24fe0e(0x167)][_0x24fe0e(0x112)](flosum_constants_1[_0x24fe0e(0x12c)][_0x24fe0e(0x15f)]+'/'+constants_1[_0x24fe0e(0xe6)]+'Metadata_Log__c/'+this[_0x24fe0e(0x12a)],_0xc61582),await this[_0x24fe0e(0x167)]['post'](flosum_constants_1[_0x24fe0e(0x12c)][_0x24fe0e(0x15f)]+'/'+constants_1[_0x24fe0e(0xe6)]+_0x24fe0e(0xe1),_0x3a8c6a),this['_logger'][_0x24fe0e(0x127)](_0x24fe0e(0xd8)+(_0x135120?_0x24fe0e(0x15d):_0x24fe0e(0x10f))+'.'),await this[_0x24fe0e(0x125)]['updateLog']();}}function a358_0x4c7b(_0x5b9a88,_0x4afd8f){const _0x141681=a358_0x2055();return a358_0x4c7b=function(_0x1445bd,_0x5e3119){_0x1445bd=_0x1445bd-0xd5;let _0x2055e9=_0x141681[_0x1445bd];return _0x2055e9;},a358_0x4c7b(_0x5b9a88,_0x4afd8f);}exports[a358_0x5e3ff6(0xe2)]=DeployService;