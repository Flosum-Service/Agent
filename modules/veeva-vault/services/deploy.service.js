const a310_0x56ada9=a310_0x59a9;function a310_0x1bb9(){const _0x2cb244=['43771GzoMCr','buildObject','../classes/errors/veeva-error','Date__c','application/json','Status__c','_systemLogger','_timeZone','get','__importDefault','put','Deploy','name','https://veevavault.com/','default','saveLog','length','SalesforceDmlError','Process_Type__c','artifacts','arraybuffer','with\x20error','status','550384WKjhQT','Deployment_Result__c','map','jszip','../../shared/utils/fetch-attachments','updateVeevaConnection','Import\x20package','PROCESS_DEPLOYMENT','Cannot\x20retrieve\x20all\x20attachments','ENDPOINT_UPSERT_RECORD','Get\x20validation\x20details.','formPackageComponentList','Join\x20all\x20mdl\x20into\x20one\x20zip','find','multipart/form-data','_branchId','7730fjSVwy','veeva-deploy','MetadataLogStatus','Generate\x20vpk\x20package','Cannot\x20find\x20deployment\x20results','componentName','VeevaError','text','headers','../constants/veeva.constants','SUCCESS','endsWith','VeevaJobStatus','Components__r\x20ORDER\x20BY\x20','16ZDAkCe','nodebuffer','8013ZbZOJe','DEPLOYED_WITH_WARNINGS','type','responseStatus','componentIdList','.zip','importVpk','getLogResultText','lastIndexOf','migration__v','Retrieving\x20components','isDeployed','apply','_tempFolder','updateLog','links','1498230YdibyE','Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20','createReadStream','filter','SalesforceService','DeployService','defineProperty','../classes/errors/salesforce-dml-error','vaultpackage.xml','(((.+)+)+)+$','getJobStatus','file','Success','content-type','finishDeploy','getJobResult','RECREATE','retrieveComponents','filename','packageComponentList','Activity_Type__c','retrieveAttachments','\x20:\x20','getValidationDetailsAndSaveLog','272320NNcHPa','insertMultipleRecords','/Attachment','base64','append','_organisationName','PackageComponentDto','VeevaConstants','data','reduce','Deployment','success','componentType','organisationId','../dtos/component.dto','logError','PackageComponentStatus','toLowerCase','search','DEPLOYED','Job_Completed__c','../constants/flosum.constants','_logger','generateVPK','detailUrl','componentHistoryId','Action__c','Package\x20not\x20verified','set','deploymentName','Validation\x20Log','_organisationId','1481553MMNcdd','flat','validateVpk','VeevaResponseStatus','slice','__esModule','execute','string','Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20','\x20</a>','null','_componentIdList','Metadata_Log__c/','from','joinAllAttachments','attachmentLogId','constructor','Metadata_Log__c','_metadataLogId','../../../core','metadataLogId','catch','url','Org__c','async','Body','retrieveRecords','VERIFIED','Form\x20Deployment\x20Results','values','Result__c','ENDPOINT_EXPORT_IMPORT_PACKAGE','getDeployDetailsAndSaveLog','parse','fetchAttachmentsDetailsByParentId','form-data','Deployment\x20Result','log','<a\x20href=','Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','packageId','202jUwcbi','errors','../../../constants','/vpk__','Save\x20Deployment\x20Results','post','FlosumConstants','VeevaPackageStatus','Cannot\x20retrieve\x20all\x20components.','_connectionVeeva','organisationName','</a>','ENDPOINT_VALIDATE_PACKAGE','vaultPackage','xml2js','COMPLETED','138noNDhl','\x20has\x20been\x20created.','Logger','toString','deployPackage','replace','_instanceUrl','_connectionSalesforce','{package_id}','Save\x20log','deployment_status__v','Component_Type__c','successfully','./veeva.service','FLOSUM_NAMESPACE','finishDeployWithError'];a310_0x1bb9=function(){return _0x2cb244;};return a310_0x1bb9();}(function(_0x18d6f9,_0x87f112){const _0x3a15b2=a310_0x59a9,_0x48282a=_0x18d6f9();while(!![]){try{const _0x1bee7b=parseInt(_0x3a15b2(0x15b))/0x1+-parseInt(_0x3a15b2(0x1a4))/0x2*(parseInt(_0x3a15b2(0x1fb))/0x3)+parseInt(_0x3a15b2(0x1db))/0x4+parseInt(_0x3a15b2(0x1eb))/0x5*(parseInt(_0x3a15b2(0x1b4))/0x6)+parseInt(_0x3a15b2(0x1c4))/0x7*(-parseInt(_0x3a15b2(0x1f9))/0x8)+-parseInt(_0x3a15b2(0x17b))/0x9+parseInt(_0x3a15b2(0x143))/0xa;if(_0x1bee7b===_0x87f112)break;else _0x48282a['push'](_0x48282a['shift']());}catch(_0x640ec6){_0x48282a['push'](_0x48282a['shift']());}}}(a310_0x1bb9,0x243b3));const a310_0x28accb=(function(){let _0x14f9c0=!![];return function(_0x2e5d1f,_0x79682d){const _0x504d8c=_0x14f9c0?function(){const _0x1705ca=a310_0x59a9;if(_0x79682d){const _0x5ec9ca=_0x79682d[_0x1705ca(0x207)](_0x2e5d1f,arguments);return _0x79682d=null,_0x5ec9ca;}}:function(){};return _0x14f9c0=![],_0x504d8c;};}()),a310_0x4e2550=a310_0x28accb(this,function(){const _0x24af31=a310_0x59a9;return a310_0x4e2550[_0x24af31(0x1b7)]()[_0x24af31(0x16d)](_0x24af31(0x14c))[_0x24af31(0x1b7)]()[_0x24af31(0x18b)](a310_0x4e2550)[_0x24af31(0x16d)](_0x24af31(0x14c));});a310_0x4e2550();'use strict';var __importDefault=this&&this[a310_0x56ada9(0x1cd)]||function(_0x8a6528){const _0x485ac6=a310_0x56ada9;return _0x8a6528&&_0x8a6528[_0x485ac6(0x180)]?_0x8a6528:{'default':_0x8a6528};};Object[a310_0x56ada9(0x149)](exports,a310_0x56ada9(0x180),{'value':!![]}),exports[a310_0x56ada9(0x148)]=void 0x0;const jszip_1=__importDefault(require(a310_0x56ada9(0x1de))),form_data_1=__importDefault(require(a310_0x56ada9(0x19e))),fs_1=require('fs'),promises_1=require('fs/promises'),constants_1=require(a310_0x56ada9(0x1a6)),flosum_constants_1=require(a310_0x56ada9(0x170)),veeva_constants_1=require(a310_0x56ada9(0x1f4)),veeva_service_1=require(a310_0x56ada9(0x1c1)),component_dto_1=require(a310_0x56ada9(0x169)),job_result_dto_1=require('../dtos/job-result.dto'),package_component_dto_1=require('../dtos/package-component.dto'),salesforce_service_1=require('./salesforce.service'),core_1=require(a310_0x56ada9(0x18e)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a310_0x56ada9(0x14a)),veeva_error_1=require(a310_0x56ada9(0x1c6)),shortid_1=__importDefault(require('shortid')),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),xml2js_1=require(a310_0x56ada9(0x1b2)),fetch_attachments_1=require(a310_0x56ada9(0x1df));class DeployService{constructor(_0x124a46,_0x4655ff,_0x2e7fc4,_0x52df3e,_0x6ed923,_0x14a064){const _0x27c4ce=a310_0x56ada9;this[_0x27c4ce(0x1bb)]=_0x4655ff,this[_0x27c4ce(0x1ad)]=_0x2e7fc4,this['_logger']=_0x52df3e,this[_0x27c4ce(0x140)]=_0x6ed923,this['_instanceUrl']=_0x14a064,this[_0x27c4ce(0x1ea)]=_0x124a46['branchId'],this[_0x27c4ce(0x18d)]=_0x124a46[_0x27c4ce(0x18f)],this['_attachmentLogId']=_0x124a46[_0x27c4ce(0x18a)],this[_0x27c4ce(0x17a)]=_0x124a46[_0x27c4ce(0x168)],this[_0x27c4ce(0x1cb)]=_0x124a46['timeZone'],this[_0x27c4ce(0x160)]=_0x124a46[_0x27c4ce(0x1ae)],this[_0x27c4ce(0x186)]=_0x124a46[_0x27c4ce(0x1ff)],this['_deploymentName']=_0x124a46[_0x27c4ce(0x178)],this[_0x27c4ce(0x1ca)]=new core_1[(_0x27c4ce(0x1b6))](_0x27c4ce(0x1ec));}async[a310_0x56ada9(0x181)](){const _0x116113=a310_0x56ada9;try{const _0x38626e=await this['retrieveComponents'](),_0x292d53=await this[_0x116113(0x158)](_0x38626e),_0x431f29=await this[_0x116113(0x189)](_0x292d53),_0x581c41=await this[_0x116113(0x172)](_0x431f29);await this[_0x116113(0x17d)](_0x581c41);const _0x40f4c=await this[_0x116113(0x201)](_0x581c41),_0x2d3d73=await this[_0x116113(0x14d)](_0x40f4c);await this[_0x116113(0x15a)](_0x2d3d73);const _0x1c6bf5=await this[_0x116113(0x1b8)](_0x2d3d73[_0x116113(0x1a3)]),_0x4c80d1=await this[_0x116113(0x14d)](_0x1c6bf5);await this[_0x116113(0x19b)](_0x4c80d1);const _0x276222=this['formFlosumDeploymentResults'](_0x38626e,_0x4c80d1[_0x116113(0x156)]);await this['saveDeploymentResults'](_0x276222),await this[_0x116113(0x151)](_0x4c80d1[_0x116113(0x206)],![],_0x2d3d73[_0x116113(0x1a3)]);}catch(_0x46a4e6){await this[_0x116113(0x1c3)](_0x46a4e6)[_0x116113(0x190)](_0x8cccdf=>this[_0x116113(0x1ca)]['error'](_0x8cccdf));}}async[a310_0x56ada9(0x154)](){const _0x2ef766=a310_0x56ada9,_0x30c01e=new Set(this[_0x2ef766(0x186)]);this[_0x2ef766(0x171)]['log'](_0x2ef766(0x205));const _0x1252e0='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+constants_1[_0x2ef766(0x1c2)]+_0x2ef766(0x1a2)+constants_1['FLOSUM_NAMESPACE']+_0x2ef766(0x183)+constants_1[_0x2ef766(0x1c2)]+_0x2ef766(0x1f8)+constants_1['FLOSUM_NAMESPACE']+'Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20'+constants_1[_0x2ef766(0x1c2)]+_0x2ef766(0x144)+constants_1[_0x2ef766(0x1c2)]+'Branch__c\x20=\x20\x27'+this[_0x2ef766(0x1ea)]+'\x27',_0x4ebb60=await salesforce_service_1[_0x2ef766(0x147)][_0x2ef766(0x195)](this['_connectionSalesforce'],_0x1252e0);if(!_0x4ebb60['length'])throw new Error('Cannot\x20retrieve\x20all\x20components.');const _0x5dd959=_0x4ebb60['map'](_0x525035=>new component_dto_1['ComponentDto'](_0x525035))[_0x2ef766(0x146)](_0x126ad6=>_0x30c01e['has'](_0x126ad6['id']));if(_0x5dd959[_0x2ef766(0x1d4)]!==this['_componentIdList'][_0x2ef766(0x1d4)])throw new Error(_0x2ef766(0x1ac));return _0x5dd959;}async[a310_0x56ada9(0x158)](_0x1e5a4f){const _0x42a78c=a310_0x56ada9;this[_0x42a78c(0x171)][_0x42a78c(0x1a0)]('Retrieving\x20attachments');const _0x216178=await(0x0,fetch_attachments_1[_0x42a78c(0x19d)])(this[_0x42a78c(0x1bb)],_0x1e5a4f[_0x42a78c(0x1dd)](_0x4b5274=>_0x4b5274[_0x42a78c(0x174)])),_0x45b6f8=await(0x0,fetch_attachments_1[_0x42a78c(0x158)])(_0x216178,this[_0x42a78c(0x1bb)]);if(_0x45b6f8['length']!==this[_0x42a78c(0x186)][_0x42a78c(0x1d4)])throw new Error(_0x42a78c(0x1e3));return _0x45b6f8['map'](_0x1e7794=>_0x1e7794[_0x42a78c(0x198)][_0x42a78c(0x194)]);}async[a310_0x56ada9(0x189)](_0x1ca218){const _0x2c2c67=a310_0x56ada9;var _0x239680;this[_0x2c2c67(0x171)][_0x2c2c67(0x1a0)](_0x2c2c67(0x1e7));const _0x4a21ad=new jszip_1[(_0x2c2c67(0x1d2))]();for(const _0x52cdba of _0x1ca218){const _0x4a48f7=new jszip_1['default']();await _0x4a48f7['loadAsync'](_0x52cdba,{'base64':!![]});for(const _0xe22941 in _0x4a48f7['files']){const _0x148b28=await((_0x239680=_0x4a48f7['file'](_0xe22941))===null||_0x239680===void 0x0?void 0x0:_0x239680[_0x2c2c67(0x193)](_0x2c2c67(0x182)));_0x148b28&&_0x4a21ad[_0x2c2c67(0x14e)](_0xe22941,_0x148b28);}}const _0x2cafc1=new xml2js_1['Builder']({'headless':!![]}),_0x5db615={'vaultpackage':{'$':{'xmlns':_0x2c2c67(0x1d1)},'name':this['_deploymentName'],'source':{'vault':undefined,'author':'Flosum'},'packagetype':_0x2c2c67(0x204),'summary':_0x2c2c67(0x1cf),'description':_0x2c2c67(0x185)}};_0x4a21ad['file'](_0x2c2c67(0x14b),_0x2cafc1[_0x2c2c67(0x1c5)](_0x5db615));const _0x2fe7e0=this[_0x2c2c67(0x140)]+'/'+(0x0,shortid_1[_0x2c2c67(0x1d2)])()+_0x2c2c67(0x200),_0x4b8c86=await _0x4a21ad['generateAsync']({'type':_0x2c2c67(0x1fa)});return await(0x0,promises_1['writeFile'])(_0x2fe7e0,_0x4b8c86),_0x2fe7e0;}async[a310_0x56ada9(0x172)](_0x1af0b0,_0x36daf3=0x1){const _0x4371e7=a310_0x56ada9;var _0x15ade0;this[_0x4371e7(0x171)][_0x4371e7(0x1a0)](_0x4371e7(0x1ee));const _0x3a0670=new form_data_1[(_0x4371e7(0x1d2))]();_0x3a0670[_0x4371e7(0x15f)](_0x4371e7(0x14e),(0x0,fs_1[_0x4371e7(0x145)])(_0x1af0b0));const _0x5071b8=await this[_0x4371e7(0x1ad)][_0x4371e7(0x1a9)](veeva_constants_1[_0x4371e7(0x162)][_0x4371e7(0x19a)],_0x3a0670,{'responseType':_0x4371e7(0x1d8),'headers':{'Content-Type':_0x4371e7(0x1e9)}}),_0x28a0d2=(_0x15ade0=_0x5071b8[_0x4371e7(0x1f3)][_0x4371e7(0x150)])===null||_0x15ade0===void 0x0?void 0x0:_0x15ade0['includes'](_0x4371e7(0x1c8));if(!_0x28a0d2){const _0x5b2de=_0x5071b8[_0x4371e7(0x163)],_0x35d85f=this[_0x4371e7(0x140)]+_0x4371e7(0x1a7)+_0x1af0b0[_0x4371e7(0x17f)](_0x1af0b0[_0x4371e7(0x203)]('/')+0x1);return await(0x0,promises_1['writeFile'])(_0x35d85f,_0x5b2de),_0x35d85f;}else{const _0x3a86b9=JSON[_0x4371e7(0x19c)](_0x5071b8[_0x4371e7(0x163)]);if(_0x36daf3>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x4371e7(0x1ad)]),await this['generateVPK'](_0x1af0b0,_0x36daf3-0x1);throw new veeva_error_1[(_0x4371e7(0x1f1))](_0x3a86b9[_0x4371e7(0x1a5)]);}}async['validateVpk'](_0x30213d,_0x57c179=0x1){const _0x300ce1=a310_0x56ada9;this[_0x300ce1(0x171)][_0x300ce1(0x1a0)]('Validate\x20package');const _0x3e1e67=new form_data_1[(_0x300ce1(0x1d2))]();_0x3e1e67[_0x300ce1(0x15f)]('file',(0x0,fs_1[_0x300ce1(0x145)])(_0x30213d));const _0x2f8b0f=await this[_0x300ce1(0x1ad)][_0x300ce1(0x1a9)](veeva_constants_1[_0x300ce1(0x162)][_0x300ce1(0x1b0)],_0x3e1e67,{'headers':{'Content-Type':_0x300ce1(0x1e9)}}),_0xfd1a90=_0x2f8b0f[_0x300ce1(0x163)];if(_0xfd1a90['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x300ce1(0x1f5)])return _0xfd1a90;else{if(_0x57c179>0x0)return await(0x0,veeva_auth_utils_1[_0x300ce1(0x1e0)])(this[_0x300ce1(0x1ad)]),await this[_0x300ce1(0x17d)](_0x30213d,_0x57c179-0x1);throw new veeva_error_1[(_0x300ce1(0x1f1))](_0xfd1a90[_0x300ce1(0x1a5)]);}}async['importVpk'](_0x5e83d9,_0x3ae141=0x1){const _0x22ebd7=a310_0x56ada9;this[_0x22ebd7(0x171)]['log'](_0x22ebd7(0x1e1));const _0x2eb5af=new form_data_1['default']();_0x2eb5af[_0x22ebd7(0x15f)]('file',(0x0,fs_1[_0x22ebd7(0x145)])(_0x5e83d9));const _0x3d522c=await this[_0x22ebd7(0x1ad)][_0x22ebd7(0x1ce)](veeva_constants_1['VeevaConstants'][_0x22ebd7(0x19a)],_0x2eb5af,{'headers':{'Content-Type':_0x22ebd7(0x1e9)}}),_0x101994=_0x3d522c['data'];if(_0x101994['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x22ebd7(0x1f5)])return _0x101994[_0x22ebd7(0x191)];else{if(_0x3ae141>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x22ebd7(0x1ad)]),await this[_0x22ebd7(0x201)](_0x5e83d9,_0x3ae141-0x1);throw new veeva_error_1[(_0x22ebd7(0x1f1))](_0x101994[_0x22ebd7(0x1a5)]);}}async['deployPackage'](_0xe11b67){const _0xf71b0d=a310_0x56ada9;this[_0xf71b0d(0x171)][_0xf71b0d(0x1a0)]('Deploy\x20package');const _0x4d3b0f=await this['_connectionVeeva'][_0xf71b0d(0x1a9)](veeva_constants_1['VeevaConstants']['ENDPOINT_DEPLOY_PACKAGE'][_0xf71b0d(0x1b9)](_0xf71b0d(0x1bc),_0xe11b67)),_0x2a322a=await _0x4d3b0f[_0xf71b0d(0x163)];if(_0x2a322a[_0xf71b0d(0x1fe)]===status_enums_1[_0xf71b0d(0x17e)][_0xf71b0d(0x1f5)])return _0x2a322a['url'];else throw new veeva_error_1[(_0xf71b0d(0x1f1))](_0x2a322a[_0xf71b0d(0x1a5)]);}async[a310_0x56ada9(0x14d)](_0xa2fa39){const _0x28d5a2=a310_0x56ada9;this[_0x28d5a2(0x171)]['log']('Wait\x20Executing\x20job');const _0x1a969b=new job_result_dto_1['JobResultDto'](),[_0x54113f]=await veeva_service_1['VeevaService'][_0x28d5a2(0x152)]([_0xa2fa39],this[_0x28d5a2(0x1ad)],this['_logger']);return _0x1a969b['isSuccess']=_0x54113f[_0x28d5a2(0x1da)]===status_enums_1[_0x28d5a2(0x1f7)][_0x28d5a2(0x1f5)],_0x1a969b[_0x28d5a2(0x173)]=_0x54113f[_0x28d5a2(0x142)][_0x28d5a2(0x1e8)](_0x5bc2c6=>_0x5bc2c6['rel']===_0x28d5a2(0x1d7))['href'],_0x1a969b;}async[a310_0x56ada9(0x15a)](_0x28bce4){const _0x295314=a310_0x56ada9;this[_0x295314(0x171)][_0x295314(0x1a0)](_0x295314(0x1e5));const {data:_0x39f23a}=await this[_0x295314(0x1ad)]['get'](_0x28bce4['detailUrl']);if(_0x39f23a[_0x295314(0x1fe)]===status_enums_1[_0x295314(0x17e)][_0x295314(0x1f5)]){const {log:_0x27cc8d,id:_0x53dee1,package_status:_0x1ab587}=_0x39f23a[_0x295314(0x1b1)],_0x4f5da9=_0x27cc8d['filter'](_0x51078a=>_0x51078a[_0x295314(0x155)][_0x295314(0x1f6)]('Validation.log')),_0x1571f2=await this[_0x295314(0x202)](_0x4f5da9[0x0][_0x295314(0x191)]);await this[_0x295314(0x1d3)](_0x1571f2,_0x295314(0x179)),_0x28bce4['packageId']=_0x53dee1;if(_0x1ab587!==status_enums_1['VeevaPackageStatus'][_0x295314(0x196)])throw new Error(_0x295314(0x176));}else throw new veeva_error_1[(_0x295314(0x1f1))](_0x39f23a[_0x295314(0x1a5)]);}async['getDeployDetailsAndSaveLog'](_0x13a29c){const _0x1a0556=a310_0x56ada9;this[_0x1a0556(0x171)][_0x1a0556(0x1a0)]('Get\x20deploy\x20result');const {data:_0x4473f4}=await this[_0x1a0556(0x1ad)][_0x1a0556(0x1cc)](_0x13a29c[_0x1a0556(0x173)]);if(_0x4473f4[_0x1a0556(0x1fe)]===status_enums_1[_0x1a0556(0x17e)][_0x1a0556(0x1f5)]){const {responseDetails:{deployment_log:_0xec7b86,package_status__v:_0x290e07},package_steps:_0x2f23b1}=_0x4473f4,_0x3e466b=_0xec7b86[_0x1a0556(0x146)](_0x2de019=>_0x2de019[_0x1a0556(0x155)]['endsWith']('Deployment.log')),_0x4b4dfc=await this['getLogResultText'](_0x3e466b[0x0]['url']);await this[_0x1a0556(0x1d3)](_0x4b4dfc,'Deploy\x20Log'),_0x13a29c[_0x1a0556(0x206)]=[status_enums_1[_0x1a0556(0x1ab)][_0x1a0556(0x16e)],status_enums_1[_0x1a0556(0x1ab)][_0x1a0556(0x1fc)]]['includes'](_0x290e07);const _0x17b597=this[_0x1a0556(0x1e6)](_0x2f23b1);_0x13a29c[_0x1a0556(0x156)]=_0x17b597[_0x1a0556(0x146)](_0x5305ea=>_0x5305ea[_0x1a0556(0x1da)]!==status_enums_1[_0x1a0556(0x16b)]['VERIFIED']);if(!_0x13a29c[_0x1a0556(0x156)][_0x1a0556(0x1d4)])throw new Error(_0x1a0556(0x1ef));}else throw new veeva_error_1['VeevaError'](_0x4473f4['errors']);}async[a310_0x56ada9(0x202)](_0x59f8ed){const _0x27a3eb=a310_0x56ada9,{data:_0xd7abd4}=await this[_0x27a3eb(0x1ad)][_0x27a3eb(0x1cc)](_0x59f8ed,{'responseType':_0x27a3eb(0x1f2)});return _0xd7abd4;}['formPackageComponentList'](_0x52068b){const _0x5c1d2a=a310_0x56ada9;return _0x52068b[_0x5c1d2a(0x164)]((_0x308f2e,_0x24f47e)=>{const _0x1bb5ac=_0x5c1d2a,_0x142392=_0x24f47e['package_components'][_0x1bb5ac(0x1dd)](_0x50331e=>new package_component_dto_1[(_0x1bb5ac(0x161))](_0x50331e,_0x24f47e[_0x1bb5ac(0x1be)]));return[..._0x308f2e,..._0x142392];},[]);}async['saveLog'](_0x473361,_0x4f4ffb){const _0x32cd7f=a310_0x56ada9;this['_logger'][_0x32cd7f(0x1a0)](_0x32cd7f(0x1bd));const _0x265c81={'Body':Buffer[_0x32cd7f(0x188)](_0x473361)[_0x32cd7f(0x1b7)](_0x32cd7f(0x15e)),'ContentType':'text/plain','ParentId':this[_0x32cd7f(0x18d)],'Name':_0x4f4ffb},{data:_0x20b33d}=await this[_0x32cd7f(0x1bb)]['post'](flosum_constants_1[_0x32cd7f(0x1aa)][_0x32cd7f(0x1e4)]+_0x32cd7f(0x15d),_0x265c81);return _0x20b33d['id'];}['formFlosumDeploymentResults'](_0x5af563,_0x559ddc){const _0x3cd0f5=a310_0x56ada9;this[_0x3cd0f5(0x171)][_0x3cd0f5(0x1a0)](_0x3cd0f5(0x197));const _0x4023ab=_0x5af563[_0x3cd0f5(0x164)]((_0x4afeb3,_0x4a7710)=>_0x4afeb3[_0x3cd0f5(0x177)]((_0x4a7710[_0x3cd0f5(0x167)]+'.'+_0x4a7710[_0x3cd0f5(0x1f0)])[_0x3cd0f5(0x16c)](),_0x4a7710),new Map());return _0x559ddc[_0x3cd0f5(0x1dd)](_0x35892f=>{const _0x504252=_0x3cd0f5;this['_logger'][_0x504252(0x1a0)](_0x35892f['type']+'.'+_0x35892f[_0x504252(0x1d0)]+_0x504252(0x159)+_0x35892f[_0x504252(0x1da)]);const _0x1b5816=(_0x35892f[_0x504252(0x1fd)]+'.'+_0x35892f[_0x504252(0x1d0)])[_0x504252(0x16c)](),_0x5535d8=_0x4023ab[_0x504252(0x1cc)](_0x1b5816);return{[constants_1[_0x504252(0x1c2)]+'Type__c']:_0x504252(0x19f),[constants_1[_0x504252(0x1c2)]+_0x504252(0x1c9)]:_0x35892f[_0x504252(0x1da)]===status_enums_1[_0x504252(0x16b)]['DEPLOYED']?_0x504252(0x14f):'Failure',[constants_1[_0x504252(0x1c2)]+_0x504252(0x199)]:_0x504252(0x153),[constants_1['FLOSUM_NAMESPACE']+'Component_Name__c']:_0x35892f[_0x504252(0x1d0)],[constants_1['FLOSUM_NAMESPACE']+_0x504252(0x1bf)]:_0x35892f[_0x504252(0x1fd)],[constants_1[_0x504252(0x1c2)]+_0x504252(0x192)]:this[_0x504252(0x17a)],[constants_1[_0x504252(0x1c2)]+_0x504252(0x18c)]:this[_0x504252(0x18d)],[constants_1[_0x504252(0x1c2)]+'Component_History__c']:_0x5535d8[_0x504252(0x174)]};});}async['saveDeploymentResults'](_0x1ff9ab){const _0x2c60ef=a310_0x56ada9;this[_0x2c60ef(0x171)][_0x2c60ef(0x1a0)](_0x2c60ef(0x1a8));const _0x4a3825=await salesforce_service_1[_0x2c60ef(0x147)][_0x2c60ef(0x15c)](this[_0x2c60ef(0x1bb)],constants_1[_0x2c60ef(0x1c2)]+_0x2c60ef(0x1dc),_0x1ff9ab),_0x1f5766=_0x4a3825[_0x2c60ef(0x146)](_0x2ea94d=>!_0x2ea94d[_0x2c60ef(0x166)])['map'](_0x2efcd9=>_0x2efcd9[_0x2c60ef(0x1a5)])[_0x2c60ef(0x17c)]();if(_0x1f5766[_0x2c60ef(0x1d4)])throw new salesforce_dml_error_1[(_0x2c60ef(0x1d5))](_0x1f5766);}async[a310_0x56ada9(0x1c3)](_0x56c5f8){const _0x537a25=a310_0x56ada9;this[_0x537a25(0x171)][_0x537a25(0x16a)](_0x56c5f8),await this['_logger'][_0x537a25(0x141)](),await this[_0x537a25(0x151)](![],!![],'');}async[a310_0x56ada9(0x151)](_0x37df5f,_0x189811,_0x27fe8d){const _0x567cd3=a310_0x56ada9,_0x291599=_0x567cd3(0x1a1)+this[_0x567cd3(0x1ba)]+'/'+this[_0x567cd3(0x18d)]+'\x20>\x20'+'Veeva\x20Deployment'+_0x567cd3(0x184),_0x2472cb='<a\x20href='+this[_0x567cd3(0x1ba)]+'/'+this[_0x567cd3(0x17a)]+'\x20>'+this[_0x567cd3(0x160)]+_0x567cd3(0x1af),_0x364e7b=_0x291599+'\x20of\x20branch\x20to\x20Organization\x20'+_0x2472cb+_0x567cd3(0x1b5),_0x256ef2={[constants_1[_0x567cd3(0x1c2)]+_0x567cd3(0x175)]:_0x364e7b,[constants_1[_0x567cd3(0x1c2)]+_0x567cd3(0x1c7)]:new Date(),[constants_1['FLOSUM_NAMESPACE']+'Branch__c']:this['_branchId'],[constants_1[_0x567cd3(0x1c2)]+'Activity_Item__c']:'Branch',[constants_1['FLOSUM_NAMESPACE']+_0x567cd3(0x157)]:_0x567cd3(0x165),[constants_1[_0x567cd3(0x1c2)]+'TargetId__c']:this[_0x567cd3(0x17a)]},_0x269b5d={[constants_1[_0x567cd3(0x1c2)]+'Is_Error__c']:!_0x37df5f,[constants_1[_0x567cd3(0x1c2)]+'Succeed__c']:_0x37df5f,[constants_1[_0x567cd3(0x1c2)]+_0x567cd3(0x1c9)]:_0x189811?status_enums_1[_0x567cd3(0x1ed)]['EXCEPTION']:status_enums_1[_0x567cd3(0x1ed)][_0x567cd3(0x1b3)],[constants_1[_0x567cd3(0x1c2)]+_0x567cd3(0x16f)]:!![],[constants_1['FLOSUM_NAMESPACE']+_0x567cd3(0x1d6)]:flosum_constants_1[_0x567cd3(0x1aa)][_0x567cd3(0x1e2)],[constants_1[_0x567cd3(0x1c2)]+'Async_Request_Id__c']:_0x27fe8d};await this[_0x567cd3(0x1bb)]['patch'](flosum_constants_1[_0x567cd3(0x1aa)][_0x567cd3(0x1e4)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x567cd3(0x187)+this['_metadataLogId'],_0x269b5d),await this[_0x567cd3(0x1bb)][_0x567cd3(0x1a9)](flosum_constants_1[_0x567cd3(0x1aa)][_0x567cd3(0x1e4)]+'/'+constants_1[_0x567cd3(0x1c2)]+'Log__c',_0x256ef2),this['_logger'][_0x567cd3(0x1a0)]('Deploy\x20completed\x20'+(_0x37df5f?_0x567cd3(0x1c0):_0x567cd3(0x1d9))+'.'),await this[_0x567cd3(0x171)][_0x567cd3(0x141)]();}}function a310_0x59a9(_0x359061,_0x129001){const _0x43f17b=a310_0x1bb9();return a310_0x59a9=function(_0x4e2550,_0x28accb){_0x4e2550=_0x4e2550-0x140;let _0x1bb965=_0x43f17b[_0x4e2550];return _0x1bb965;},a310_0x59a9(_0x359061,_0x129001);}exports[a310_0x56ada9(0x148)]=DeployService;