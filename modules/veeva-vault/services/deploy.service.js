const a310_0x86e7b9=a310_0x2ab9;(function(_0x383422,_0x458659){const _0x3319d8=a310_0x2ab9,_0x2231d9=_0x383422();while(!![]){try{const _0x47e282=parseInt(_0x3319d8(0x148))/0x1*(parseInt(_0x3319d8(0xac))/0x2)+parseInt(_0x3319d8(0x103))/0x3+-parseInt(_0x3319d8(0xae))/0x4+parseInt(_0x3319d8(0xe7))/0x5*(parseInt(_0x3319d8(0xf5))/0x6)+-parseInt(_0x3319d8(0x13a))/0x7+parseInt(_0x3319d8(0x11a))/0x8*(parseInt(_0x3319d8(0x141))/0x9)+parseInt(_0x3319d8(0x145))/0xa;if(_0x47e282===_0x458659)break;else _0x2231d9['push'](_0x2231d9['shift']());}catch(_0x2aa494){_0x2231d9['push'](_0x2231d9['shift']());}}}(a310_0x1a80,0xc552c));const a310_0x3875d1=(function(){let _0x3c75e8=!![];return function(_0x5091f6,_0x3dbabb){const _0x3a8c2b=_0x3c75e8?function(){const _0x45b509=a310_0x2ab9;if(_0x3dbabb){const _0x5ec523=_0x3dbabb[_0x45b509(0xee)](_0x5091f6,arguments);return _0x3dbabb=null,_0x5ec523;}}:function(){};return _0x3c75e8=![],_0x3a8c2b;};}()),a310_0x3746ef=a310_0x3875d1(this,function(){const _0xf24f61=a310_0x2ab9;return a310_0x3746ef[_0xf24f61(0xa3)]()[_0xf24f61(0x12a)]('(((.+)+)+)+$')[_0xf24f61(0xa3)]()[_0xf24f61(0x105)](a310_0x3746ef)['search']('(((.+)+)+)+$');});a310_0x3746ef();'use strict';var __importDefault=this&&this[a310_0x86e7b9(0x11f)]||function(_0xd39e02){return _0xd39e02&&_0xd39e02['__esModule']?_0xd39e02:{'default':_0xd39e02};};function a310_0x1a80(){const _0xa75075=['472djbFdY','../constants/veeva.constants','log','with\x20error','_systemLogger','__importDefault','vaultPackage','_metadataLogId','</a>','deploymentName','joinAllAttachments','Action__c','Branch__c','VeevaService','DEPLOYED','DEPLOYED_WITH_WARNINGS','search','componentName','FLOSUM_NAMESPACE','../dtos/package-component.dto','async','filename','https://veevavault.com/','filter','from','../classes/errors/veeva-error','multipart/form-data','Wait\x20Executing\x20job','{package_id}','VERIFIED','finishDeployWithError','Retrieving\x20components','7415121ZYFqew','shortid','find','retrieveAttachments','Deploy\x20completed\x20','responseStatus','\x20</a>','99747ogWThM','Generate\x20vpk\x20package','_branchId','form-data','6667490uLqkMN','Branch__c\x20=\x20\x27','formFlosumDeploymentResults','1048xmLjwD','VeevaPackageStatus','VeevaError','componentType','finishDeploy','logError','\x20has\x20been\x20created.','retrieveComponents','formPackageComponentList','headers','FlosumConstants','url','data','files','Deployment','replace','migration__v','getJobStatus','Process_Type__c','arraybuffer','updateLog','SalesforceService','Metadata_Log__c/','links','VeevaConstants','ComponentDto','_tempFolder','Job_Completed__c','Success','DeployService','Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20','JobResultDto','VeevaJobStatus','success','post','TargetId__c','toString','Log__c','status','file','VeevaResponseStatus','length','validateVpk','Cannot\x20retrieve\x20all\x20components.','getLogResultText','998WYnBZM','../../../constants','3397668FilcHf','Builder','ENDPOINT_UPSERT_RECORD','artifacts','Activity_Type__c','.zip','Result__c','has','Components__r\x20ORDER\x20BY\x20','_instanceUrl','./salesforce.service','Form\x20Deployment\x20Results','EXCEPTION','Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20','branchId','ENDPOINT_EXPORT_IMPORT_PACKAGE','saveDeploymentResults','MetadataLogStatus','Component_Name__c','insertMultipleRecords','includes','Import\x20package','package_components','attachmentLogId','_organisationId','_logger','veeva-deploy','./veeva.service','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Save\x20Deployment\x20Results','Branch','Org__c','Date__c','deployment_status__v','type','updateVeevaConnection','../classes/errors/salesforce-dml-error','xml2js','Body','base64','Veeva\x20Deployment','Deploy','default','Component_History__c','../enums/status.enums','reduce','ENDPOINT_DEPLOY_PACKAGE','createReadStream','Deployment.log','values','vaultpackage.xml','name','getValidationDetailsAndSaveLog','detailUrl','Get\x20validation\x20details.','../constants/flosum.constants','errors','240750TJuaHb','importVpk','error','_organisationName','_connectionSalesforce','../dtos/job-result.dto','getDeployDetailsAndSaveLog','apply','ENDPOINT_VALIDATE_PACKAGE','map','Activity_Item__c','loadAsync','PackageComponentStatus','generateAsync','6MUjWNU','catch','isDeployed','SUCCESS','writeFile','_connectionVeeva','lastIndexOf','organisationName','nodebuffer','rel','defineProperty','_deploymentName','get','deployPackage','2475624oBDtrS','Validation.log','constructor','Save\x20log','../../shared/utils/fetch-attachments','_timeZone','generateVPK','slice','Failure','PackageComponentDto','text','_attachmentLogId','_componentIdList','Status__c','saveLog','Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','set','\x20:\x20','SalesforceDmlError','append','timeZone','Logger','href'];a310_0x1a80=function(){return _0xa75075;};return a310_0x1a80();}function a310_0x2ab9(_0x41d557,_0x42edb9){const _0xc5fd7e=a310_0x1a80();return a310_0x2ab9=function(_0x3746ef,_0x3875d1){_0x3746ef=_0x3746ef-0x99;let _0x1a8006=_0xc5fd7e[_0x3746ef];return _0x1a8006;},a310_0x2ab9(_0x41d557,_0x42edb9);}Object[a310_0x86e7b9(0xff)](exports,'__esModule',{'value':!![]}),exports['DeployService']=void 0x0;const jszip_1=__importDefault(require('jszip')),form_data_1=__importDefault(require(a310_0x86e7b9(0x144))),fs_1=require('fs'),promises_1=require('fs/promises'),constants_1=require(a310_0x86e7b9(0xad)),flosum_constants_1=require(a310_0x86e7b9(0xe5)),veeva_constants_1=require(a310_0x86e7b9(0x11b)),veeva_service_1=require(a310_0x86e7b9(0xc9)),component_dto_1=require('../dtos/component.dto'),job_result_dto_1=require(a310_0x86e7b9(0xec)),package_component_dto_1=require(a310_0x86e7b9(0x12d)),salesforce_service_1=require(a310_0x86e7b9(0xb8)),core_1=require('../../../core'),status_enums_1=require(a310_0x86e7b9(0xda)),salesforce_dml_error_1=require(a310_0x86e7b9(0xd2)),veeva_error_1=require(a310_0x86e7b9(0x133)),shortid_1=__importDefault(require(a310_0x86e7b9(0x13b))),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),xml2js_1=require(a310_0x86e7b9(0xd3)),fetch_attachments_1=require(a310_0x86e7b9(0x107));class DeployService{constructor(_0x32b1e8,_0x44ce2b,_0x3b0980,_0x5e1658,_0x53709e,_0x434e5f){const _0x4632b0=a310_0x86e7b9;this[_0x4632b0(0xeb)]=_0x44ce2b,this[_0x4632b0(0xfa)]=_0x3b0980,this[_0x4632b0(0xc7)]=_0x5e1658,this[_0x4632b0(0x99)]=_0x53709e,this[_0x4632b0(0xb7)]=_0x434e5f,this['_branchId']=_0x32b1e8[_0x4632b0(0xbc)],this[_0x4632b0(0x121)]=_0x32b1e8['metadataLogId'],this[_0x4632b0(0x10e)]=_0x32b1e8[_0x4632b0(0xc5)],this['_organisationId']=_0x32b1e8['organisationId'],this[_0x4632b0(0x108)]=_0x32b1e8[_0x4632b0(0x117)],this[_0x4632b0(0xea)]=_0x32b1e8[_0x4632b0(0xfc)],this['_componentIdList']=_0x32b1e8['componentIdList'],this[_0x4632b0(0x100)]=_0x32b1e8[_0x4632b0(0x123)],this[_0x4632b0(0x11e)]=new core_1[(_0x4632b0(0x118))](_0x4632b0(0xc8));}async['execute'](){const _0xac6eaa=a310_0x86e7b9;try{const _0x30deca=await this[_0xac6eaa(0x14f)](),_0x460ee9=await this['retrieveAttachments'](_0x30deca),_0x132238=await this['joinAllAttachments'](_0x460ee9),_0x167e58=await this[_0xac6eaa(0x109)](_0x132238);await this[_0xac6eaa(0xa9)](_0x167e58);const _0x51f449=await this[_0xac6eaa(0xe8)](_0x167e58),_0x4ae174=await this[_0xac6eaa(0x159)](_0x51f449);await this[_0xac6eaa(0xe2)](_0x4ae174);const _0x222ee0=await this[_0xac6eaa(0x102)](_0x4ae174['packageId']),_0x438e87=await this[_0xac6eaa(0x159)](_0x222ee0);await this[_0xac6eaa(0xed)](_0x438e87);const _0x534293=this[_0xac6eaa(0x147)](_0x30deca,_0x438e87['packageComponentList']);await this[_0xac6eaa(0xbe)](_0x534293),await this[_0xac6eaa(0x14c)](_0x438e87['isDeployed'],![],_0x4ae174['packageId']);}catch(_0x1e1576){await this['finishDeployWithError'](_0x1e1576)[_0xac6eaa(0xf6)](_0x282374=>this[_0xac6eaa(0x11e)][_0xac6eaa(0xe9)](_0x282374));}}async[a310_0x86e7b9(0x14f)](){const _0x273f38=a310_0x86e7b9,_0x59b944=new Set(this[_0x273f38(0x10f)]);this[_0x273f38(0xc7)][_0x273f38(0x11c)](_0x273f38(0x139));const _0x460d21=_0x273f38(0xca)+constants_1[_0x273f38(0x12c)]+_0x273f38(0x112)+constants_1[_0x273f38(0x12c)]+_0x273f38(0x9d)+constants_1[_0x273f38(0x12c)]+_0x273f38(0xb6)+constants_1[_0x273f38(0x12c)]+'Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20'+constants_1[_0x273f38(0x12c)]+_0x273f38(0xbb)+constants_1[_0x273f38(0x12c)]+_0x273f38(0x146)+this[_0x273f38(0x143)]+'\x27',_0x542703=await salesforce_service_1[_0x273f38(0x15d)]['retrieveRecords'](this[_0x273f38(0xeb)],_0x460d21);if(!_0x542703['length'])throw new Error(_0x273f38(0xaa));const _0x4848c9=_0x542703[_0x273f38(0xf0)](_0x5180c2=>new component_dto_1[(_0x273f38(0x161))](_0x5180c2))[_0x273f38(0x131)](_0x214c02=>_0x59b944[_0x273f38(0xb5)](_0x214c02['id']));if(_0x4848c9['length']!==this[_0x273f38(0x10f)][_0x273f38(0xa8)])throw new Error('Cannot\x20retrieve\x20all\x20components.');return _0x4848c9;}async[a310_0x86e7b9(0x13d)](_0x35aab3){const _0x5bf367=a310_0x86e7b9;this[_0x5bf367(0xc7)][_0x5bf367(0x11c)]('Retrieving\x20attachments');const _0x4391bc=await(0x0,fetch_attachments_1['fetchAttachmentsDetailsByParentId'])(this[_0x5bf367(0xeb)],_0x35aab3[_0x5bf367(0xf0)](_0x4e29a9=>_0x4e29a9['componentHistoryId'])),_0x3b5145=await(0x0,fetch_attachments_1[_0x5bf367(0x13d)])(_0x4391bc,this[_0x5bf367(0xeb)]);if(_0x3b5145[_0x5bf367(0xa8)]!==this[_0x5bf367(0x10f)]['length'])throw new Error('Cannot\x20retrieve\x20all\x20attachments');return _0x3b5145[_0x5bf367(0xf0)](_0x34d985=>_0x34d985[_0x5bf367(0xdf)][_0x5bf367(0xd4)]);}async[a310_0x86e7b9(0x124)](_0x2a372c){const _0x546b18=a310_0x86e7b9;var _0x354b0d;this[_0x546b18(0xc7)]['log']('Join\x20all\x20mdl\x20into\x20one\x20zip');const _0x4f7ec6=new jszip_1['default']();for(const _0x51d294 of _0x2a372c){const _0x23e7ad=new jszip_1[(_0x546b18(0xd8))]();await _0x23e7ad[_0x546b18(0xf2)](_0x51d294,{'base64':!![]});for(const _0x2707ae in _0x23e7ad[_0x546b18(0x155)]){const _0x5e92a6=await((_0x354b0d=_0x23e7ad[_0x546b18(0xa6)](_0x2707ae))===null||_0x354b0d===void 0x0?void 0x0:_0x354b0d[_0x546b18(0x12e)]('string'));_0x5e92a6&&_0x4f7ec6['file'](_0x2707ae,_0x5e92a6);}}const _0x5c6a77=new xml2js_1[(_0x546b18(0xaf))]({'headless':!![]}),_0x2e0710={'vaultpackage':{'$':{'xmlns':_0x546b18(0x130)},'name':this[_0x546b18(0x100)],'source':{'vault':undefined,'author':'Flosum'},'packagetype':_0x546b18(0x158),'summary':_0x546b18(0xd7),'description':'null'}};_0x4f7ec6[_0x546b18(0xa6)](_0x546b18(0xe0),_0x5c6a77['buildObject'](_0x2e0710));const _0x3a824e=this[_0x546b18(0x99)]+'/'+(0x0,shortid_1[_0x546b18(0xd8)])()+_0x546b18(0xb3),_0x2c76b8=await _0x4f7ec6[_0x546b18(0xf4)]({'type':_0x546b18(0xfd)});return await(0x0,promises_1[_0x546b18(0xf9)])(_0x3a824e,_0x2c76b8),_0x3a824e;}async[a310_0x86e7b9(0x109)](_0x576ce4,_0x348e2f=0x1){const _0x32dc12=a310_0x86e7b9;var _0x5483d7;this[_0x32dc12(0xc7)][_0x32dc12(0x11c)](_0x32dc12(0x142));const _0x263656=new form_data_1[(_0x32dc12(0xd8))]();_0x263656[_0x32dc12(0x116)]('file',(0x0,fs_1[_0x32dc12(0xdd)])(_0x576ce4));const _0x3b29ed=await this[_0x32dc12(0xfa)][_0x32dc12(0xa1)](veeva_constants_1[_0x32dc12(0x160)][_0x32dc12(0xbd)],_0x263656,{'responseType':_0x32dc12(0x15b),'headers':{'Content-Type':_0x32dc12(0x134)}}),_0xd1b948=(_0x5483d7=_0x3b29ed[_0x32dc12(0x151)]['content-type'])===null||_0x5483d7===void 0x0?void 0x0:_0x5483d7['includes']('application/json');if(!_0xd1b948){const _0x2dfb51=_0x3b29ed[_0x32dc12(0x154)],_0x1a1a9b=this[_0x32dc12(0x99)]+'/vpk__'+_0x576ce4[_0x32dc12(0x10a)](_0x576ce4[_0x32dc12(0xfb)]('/')+0x1);return await(0x0,promises_1[_0x32dc12(0xf9)])(_0x1a1a9b,_0x2dfb51),_0x1a1a9b;}else{const _0x4bc1c7=JSON['parse'](_0x3b29ed[_0x32dc12(0x154)]);if(_0x348e2f>0x0)return await(0x0,veeva_auth_utils_1[_0x32dc12(0xd1)])(this[_0x32dc12(0xfa)]),await this[_0x32dc12(0x109)](_0x576ce4,_0x348e2f-0x1);throw new veeva_error_1[(_0x32dc12(0x14a))](_0x4bc1c7[_0x32dc12(0xe6)]);}}async[a310_0x86e7b9(0xa9)](_0x342c09,_0x4257cd=0x1){const _0x25241f=a310_0x86e7b9;this[_0x25241f(0xc7)][_0x25241f(0x11c)]('Validate\x20package');const _0x447fe2=new form_data_1[(_0x25241f(0xd8))]();_0x447fe2[_0x25241f(0x116)](_0x25241f(0xa6),(0x0,fs_1[_0x25241f(0xdd)])(_0x342c09));const _0x449a03=await this[_0x25241f(0xfa)]['post'](veeva_constants_1['VeevaConstants'][_0x25241f(0xef)],_0x447fe2,{'headers':{'Content-Type':'multipart/form-data'}}),_0x4fc9d1=_0x449a03[_0x25241f(0x154)];if(_0x4fc9d1[_0x25241f(0x13f)]===status_enums_1[_0x25241f(0xa7)]['SUCCESS'])return _0x4fc9d1;else{if(_0x4257cd>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x25241f(0xfa)]),await this[_0x25241f(0xa9)](_0x342c09,_0x4257cd-0x1);throw new veeva_error_1[(_0x25241f(0x14a))](_0x4fc9d1[_0x25241f(0xe6)]);}}async[a310_0x86e7b9(0xe8)](_0xe61bf1,_0x224887=0x1){const _0x141b37=a310_0x86e7b9;this[_0x141b37(0xc7)]['log'](_0x141b37(0xc3));const _0x28f55d=new form_data_1['default']();_0x28f55d[_0x141b37(0x116)](_0x141b37(0xa6),(0x0,fs_1[_0x141b37(0xdd)])(_0xe61bf1));const _0x12bc75=await this[_0x141b37(0xfa)]['put'](veeva_constants_1[_0x141b37(0x160)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x28f55d,{'headers':{'Content-Type':_0x141b37(0x134)}}),_0x42a4e6=_0x12bc75[_0x141b37(0x154)];if(_0x42a4e6['responseStatus']===status_enums_1[_0x141b37(0xa7)]['SUCCESS'])return _0x42a4e6['url'];else{if(_0x224887>0x0)return await(0x0,veeva_auth_utils_1[_0x141b37(0xd1)])(this[_0x141b37(0xfa)]),await this[_0x141b37(0xe8)](_0xe61bf1,_0x224887-0x1);throw new veeva_error_1[(_0x141b37(0x14a))](_0x42a4e6[_0x141b37(0xe6)]);}}async['deployPackage'](_0x5f1336){const _0x3c802c=a310_0x86e7b9;this[_0x3c802c(0xc7)][_0x3c802c(0x11c)]('Deploy\x20package');const _0x4df12d=await this[_0x3c802c(0xfa)][_0x3c802c(0xa1)](veeva_constants_1[_0x3c802c(0x160)][_0x3c802c(0xdc)][_0x3c802c(0x157)](_0x3c802c(0x136),_0x5f1336)),_0x5ecb3=await _0x4df12d[_0x3c802c(0x154)];if(_0x5ecb3[_0x3c802c(0x13f)]===status_enums_1['VeevaResponseStatus']['SUCCESS'])return _0x5ecb3['url'];else throw new veeva_error_1[(_0x3c802c(0x14a))](_0x5ecb3[_0x3c802c(0xe6)]);}async[a310_0x86e7b9(0x159)](_0x3f68e0){const _0x145777=a310_0x86e7b9;this[_0x145777(0xc7)][_0x145777(0x11c)](_0x145777(0x135));const _0x118fc8=new job_result_dto_1[(_0x145777(0x9e))](),[_0x264202]=await veeva_service_1[_0x145777(0x127)]['getJobResult']([_0x3f68e0],this['_connectionVeeva'],this[_0x145777(0xc7)]);return _0x118fc8['isSuccess']=_0x264202[_0x145777(0xa5)]===status_enums_1[_0x145777(0x9f)][_0x145777(0xf8)],_0x118fc8[_0x145777(0xe3)]=_0x264202[_0x145777(0x15f)][_0x145777(0x13c)](_0x41c111=>_0x41c111[_0x145777(0xfe)]===_0x145777(0xb1))[_0x145777(0x119)],_0x118fc8;}async[a310_0x86e7b9(0xe2)](_0x3adfbf){const _0x3e7108=a310_0x86e7b9;this[_0x3e7108(0xc7)][_0x3e7108(0x11c)](_0x3e7108(0xe4));const {data:_0x164e7b}=await this['_connectionVeeva'][_0x3e7108(0x101)](_0x3adfbf['detailUrl']);if(_0x164e7b['responseStatus']===status_enums_1[_0x3e7108(0xa7)]['SUCCESS']){const {log:_0x4404b1,id:_0x1cd780,package_status:_0x1b31f9}=_0x164e7b[_0x3e7108(0x120)],_0x205b41=_0x4404b1[_0x3e7108(0x131)](_0x2f2759=>_0x2f2759[_0x3e7108(0x12f)]['endsWith'](_0x3e7108(0x104))),_0xf470a8=await this[_0x3e7108(0xab)](_0x205b41[0x0][_0x3e7108(0x153)]);await this[_0x3e7108(0x111)](_0xf470a8,'Validation\x20Log'),_0x3adfbf['packageId']=_0x1cd780;if(_0x1b31f9!==status_enums_1[_0x3e7108(0x149)]['VERIFIED'])throw new Error('Package\x20not\x20verified');}else throw new veeva_error_1[(_0x3e7108(0x14a))](_0x164e7b[_0x3e7108(0xe6)]);}async[a310_0x86e7b9(0xed)](_0x966477){const _0x10aa7b=a310_0x86e7b9;this[_0x10aa7b(0xc7)]['log']('Get\x20deploy\x20result');const {data:_0x23a1ad}=await this[_0x10aa7b(0xfa)][_0x10aa7b(0x101)](_0x966477[_0x10aa7b(0xe3)]);if(_0x23a1ad[_0x10aa7b(0x13f)]===status_enums_1[_0x10aa7b(0xa7)][_0x10aa7b(0xf8)]){const {responseDetails:{deployment_log:_0x57c31d,package_status__v:_0x5d1898},package_steps:_0x4d7a8d}=_0x23a1ad,_0x54a895=_0x57c31d[_0x10aa7b(0x131)](_0x5f04b0=>_0x5f04b0['filename']['endsWith'](_0x10aa7b(0xde))),_0x3b2c31=await this['getLogResultText'](_0x54a895[0x0][_0x10aa7b(0x153)]);await this[_0x10aa7b(0x111)](_0x3b2c31,'Deploy\x20Log'),_0x966477[_0x10aa7b(0xf7)]=[status_enums_1['VeevaPackageStatus'][_0x10aa7b(0x128)],status_enums_1[_0x10aa7b(0x149)][_0x10aa7b(0x129)]][_0x10aa7b(0xc2)](_0x5d1898);const _0x455b55=this['formPackageComponentList'](_0x4d7a8d);_0x966477['packageComponentList']=_0x455b55['filter'](_0x2c09e5=>_0x2c09e5[_0x10aa7b(0xa5)]!==status_enums_1[_0x10aa7b(0xf3)][_0x10aa7b(0x137)]);if(!_0x966477['packageComponentList']['length'])throw new Error('Cannot\x20find\x20deployment\x20results');}else throw new veeva_error_1[(_0x10aa7b(0x14a))](_0x23a1ad[_0x10aa7b(0xe6)]);}async[a310_0x86e7b9(0xab)](_0x56e031){const _0x335188=a310_0x86e7b9,{data:_0x19800c}=await this['_connectionVeeva'][_0x335188(0x101)](_0x56e031,{'responseType':_0x335188(0x10d)});return _0x19800c;}[a310_0x86e7b9(0x150)](_0x794b13){const _0x540663=a310_0x86e7b9;return _0x794b13[_0x540663(0xdb)]((_0x550b67,_0x45f692)=>{const _0x40b8d2=_0x540663,_0x5d4292=_0x45f692[_0x40b8d2(0xc4)][_0x40b8d2(0xf0)](_0x2c1293=>new package_component_dto_1[(_0x40b8d2(0x10c))](_0x2c1293,_0x45f692[_0x40b8d2(0xcf)]));return[..._0x550b67,..._0x5d4292];},[]);}async[a310_0x86e7b9(0x111)](_0x24c4be,_0xdcafab){const _0x29ccc3=a310_0x86e7b9;this[_0x29ccc3(0xc7)]['log'](_0x29ccc3(0x106));const _0xfd53b5={'Body':Buffer[_0x29ccc3(0x132)](_0x24c4be)[_0x29ccc3(0xa3)](_0x29ccc3(0xd5)),'ContentType':'text/plain','ParentId':this[_0x29ccc3(0x121)],'Name':_0xdcafab},{data:_0xbd33a0}=await this['_connectionSalesforce'][_0x29ccc3(0xa1)](flosum_constants_1['FlosumConstants'][_0x29ccc3(0xb0)]+'/Attachment',_0xfd53b5);return _0xbd33a0['id'];}[a310_0x86e7b9(0x147)](_0x2be347,_0x4a832f){const _0x310285=a310_0x86e7b9;this[_0x310285(0xc7)][_0x310285(0x11c)](_0x310285(0xb9));const _0x11c0ac=_0x2be347['reduce']((_0x1a1be0,_0x56f145)=>_0x1a1be0[_0x310285(0x113)]((_0x56f145[_0x310285(0x14b)]+'.'+_0x56f145[_0x310285(0x12b)])['toLowerCase'](),_0x56f145),new Map());return _0x4a832f[_0x310285(0xf0)](_0x5c84ae=>{const _0x265035=_0x310285;this[_0x265035(0xc7)][_0x265035(0x11c)](_0x5c84ae['type']+'.'+_0x5c84ae[_0x265035(0xe1)]+_0x265035(0x114)+_0x5c84ae[_0x265035(0xa5)]);const _0x3a738c=(_0x5c84ae[_0x265035(0xd0)]+'.'+_0x5c84ae[_0x265035(0xe1)])['toLowerCase'](),_0x2a5706=_0x11c0ac['get'](_0x3a738c);return{[constants_1[_0x265035(0x12c)]+'Type__c']:'Deployment\x20Result',[constants_1[_0x265035(0x12c)]+_0x265035(0x110)]:_0x5c84ae[_0x265035(0xa5)]===status_enums_1['PackageComponentStatus'][_0x265035(0x128)]?_0x265035(0x9b):_0x265035(0x10b),[constants_1[_0x265035(0x12c)]+_0x265035(0xb4)]:'RECREATE',[constants_1['FLOSUM_NAMESPACE']+_0x265035(0xc0)]:_0x5c84ae[_0x265035(0xe1)],[constants_1[_0x265035(0x12c)]+'Component_Type__c']:_0x5c84ae[_0x265035(0xd0)],[constants_1[_0x265035(0x12c)]+_0x265035(0xcd)]:this['_organisationId'],[constants_1['FLOSUM_NAMESPACE']+'Metadata_Log__c']:this[_0x265035(0x121)],[constants_1['FLOSUM_NAMESPACE']+_0x265035(0xd9)]:_0x2a5706['componentHistoryId']};});}async[a310_0x86e7b9(0xbe)](_0x301fe4){const _0x4e3cd6=a310_0x86e7b9;this[_0x4e3cd6(0xc7)][_0x4e3cd6(0x11c)](_0x4e3cd6(0xcb));const _0x3d244d=await salesforce_service_1[_0x4e3cd6(0x15d)][_0x4e3cd6(0xc1)](this['_connectionSalesforce'],constants_1['FLOSUM_NAMESPACE']+'Deployment_Result__c',_0x301fe4),_0x5bba61=_0x3d244d[_0x4e3cd6(0x131)](_0x2c166f=>!_0x2c166f[_0x4e3cd6(0xa0)])[_0x4e3cd6(0xf0)](_0x5862b0=>_0x5862b0[_0x4e3cd6(0xe6)])['flat']();if(_0x5bba61['length'])throw new salesforce_dml_error_1[(_0x4e3cd6(0x115))](_0x5bba61);}async[a310_0x86e7b9(0x138)](_0x5f2a12){const _0x35ad38=a310_0x86e7b9;this['_logger'][_0x35ad38(0x14d)](_0x5f2a12),await this[_0x35ad38(0xc7)][_0x35ad38(0x15c)](),await this[_0x35ad38(0x14c)](![],!![],'');}async['finishDeploy'](_0x22c570,_0x3e5843,_0x1fffcb){const _0x4010f5=a310_0x86e7b9,_0x1b800c='<a\x20href='+this[_0x4010f5(0xb7)]+'/'+this['_metadataLogId']+'\x20>\x20'+_0x4010f5(0xd6)+_0x4010f5(0x140),_0x1d1999='<a\x20href='+this[_0x4010f5(0xb7)]+'/'+this[_0x4010f5(0xc6)]+'\x20>'+this[_0x4010f5(0xea)]+_0x4010f5(0x122),_0xd7bae0=_0x1b800c+'\x20of\x20branch\x20to\x20Organization\x20'+_0x1d1999+_0x4010f5(0x14e),_0x2fd88d={[constants_1['FLOSUM_NAMESPACE']+_0x4010f5(0x125)]:_0xd7bae0,[constants_1[_0x4010f5(0x12c)]+_0x4010f5(0xce)]:new Date(),[constants_1[_0x4010f5(0x12c)]+_0x4010f5(0x126)]:this[_0x4010f5(0x143)],[constants_1['FLOSUM_NAMESPACE']+_0x4010f5(0xf1)]:_0x4010f5(0xcc),[constants_1[_0x4010f5(0x12c)]+_0x4010f5(0xb2)]:_0x4010f5(0x156),[constants_1[_0x4010f5(0x12c)]+_0x4010f5(0xa2)]:this[_0x4010f5(0xc6)]},_0x4767d6={[constants_1[_0x4010f5(0x12c)]+'Is_Error__c']:!_0x22c570,[constants_1[_0x4010f5(0x12c)]+'Succeed__c']:_0x22c570,[constants_1[_0x4010f5(0x12c)]+_0x4010f5(0x110)]:_0x3e5843?status_enums_1[_0x4010f5(0xbf)][_0x4010f5(0xba)]:status_enums_1['MetadataLogStatus']['COMPLETED'],[constants_1['FLOSUM_NAMESPACE']+_0x4010f5(0x9a)]:!![],[constants_1['FLOSUM_NAMESPACE']+_0x4010f5(0x15a)]:flosum_constants_1[_0x4010f5(0x152)]['PROCESS_DEPLOYMENT'],[constants_1[_0x4010f5(0x12c)]+'Async_Request_Id__c']:_0x1fffcb};await this[_0x4010f5(0xeb)]['patch'](flosum_constants_1['FlosumConstants']['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x4010f5(0x12c)]+_0x4010f5(0x15e)+this['_metadataLogId'],_0x4767d6),await this[_0x4010f5(0xeb)][_0x4010f5(0xa1)](flosum_constants_1[_0x4010f5(0x152)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x4010f5(0x12c)]+_0x4010f5(0xa4),_0x2fd88d),this[_0x4010f5(0xc7)]['log'](_0x4010f5(0x13e)+(_0x22c570?'successfully':_0x4010f5(0x11d))+'.'),await this['_logger'][_0x4010f5(0x15c)]();}}exports[a310_0x86e7b9(0x9c)]=DeployService;