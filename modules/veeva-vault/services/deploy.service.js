const a310_0x2a2e2a=a310_0x3114;(function(_0x5c1576,_0xf72576){const _0x3aba79=a310_0x3114,_0x3646c1=_0x5c1576();while(!![]){try{const _0xbf74a6=-parseInt(_0x3aba79(0x22b))/0x1+parseInt(_0x3aba79(0x18e))/0x2*(parseInt(_0x3aba79(0x21b))/0x3)+-parseInt(_0x3aba79(0x159))/0x4+parseInt(_0x3aba79(0x221))/0x5+-parseInt(_0x3aba79(0x1a8))/0x6*(parseInt(_0x3aba79(0x1d0))/0x7)+parseInt(_0x3aba79(0x1ed))/0x8*(-parseInt(_0x3aba79(0x1a7))/0x9)+parseInt(_0x3aba79(0x16c))/0xa*(parseInt(_0x3aba79(0x214))/0xb);if(_0xbf74a6===_0xf72576)break;else _0x3646c1['push'](_0x3646c1['shift']());}catch(_0x172f66){_0x3646c1['push'](_0x3646c1['shift']());}}}(a310_0xe5d0,0xb262c));const a310_0x2f4912=(function(){let _0x323c50=!![];return function(_0xfad67c,_0x41ae32){const _0xefbf26=_0x323c50?function(){const _0x496035=a310_0x3114;if(_0x41ae32){const _0x152fc1=_0x41ae32[_0x496035(0x186)](_0xfad67c,arguments);return _0x41ae32=null,_0x152fc1;}}:function(){};return _0x323c50=![],_0xefbf26;};}()),a310_0x31e15d=a310_0x2f4912(this,function(){const _0x14460b=a310_0x3114;return a310_0x31e15d['toString']()[_0x14460b(0x1bf)](_0x14460b(0x1b0))[_0x14460b(0x185)]()['constructor'](a310_0x31e15d)[_0x14460b(0x1bf)](_0x14460b(0x1b0));});a310_0x31e15d();function a310_0xe5d0(){const _0x14f71b=['Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20of\x20branch\x20to\x20Organization\x20','find','log','_connectionVeeva','9sudmLf','6lLspHI','detailUrl','fetchAttachmentsDetailsByParentId','Log__c','../utils/veeva-auth.utils','default','Validation.log','../../../constants','(((.+)+)+)+$','retrieveComponents','successfully','packageComponentList','Deploy','error','updateLog','_componentIdList','Get\x20validation\x20details.','type','/vpk__','validateVpk','_branchId','componentType','Result__c','search','metadataLogId','packageId','DeployService','../constants/flosum.constants','Branch','\x20</a>','https://veevavault.com/','SalesforceDmlError','organisationName','veeva-deploy','Org__c','Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20','../enums/status.enums','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Type__c','generateAsync','1912099Aesoxg','insertMultipleRecords','Body','arraybuffer','../dtos/package-component.dto','Branch__c\x20=\x20\x27','writeFile','from','updateVeevaConnection','append','SUCCESS','getLogResultText','_logger','rel','base64','Get\x20deploy\x20result','execute','toLowerCase','data','_connectionSalesforce','<a\x20href=','joinAllAttachments','Deploy\x20package','text','Status__c','\x20has\x20been\x20created.','getDeployDetailsAndSaveLog','deploymentName','VeevaJobStatus','10781448mYrcjP','ENDPOINT_UPSERT_RECORD','Save\x20Deployment\x20Results','saveLog','Wait\x20Executing\x20job','Form\x20Deployment\x20Results','shortid','package_components','Succeed__c','filename','ENDPOINT_DEPLOY_PACKAGE','links','RECREATE','filter','../classes/errors/salesforce-dml-error','includes','Validation\x20Log','deployPackage','_systemLogger','VeevaError','headers','length','slice','DEPLOYED','get','MetadataLogStatus','vaultPackage','Is_Error__c','organisationId','getJobStatus','VeevaResponseStatus','_metadataLogId','COMPLETED','flat','endsWith','reduce','Deploy\x20completed\x20','FLOSUM_NAMESPACE','Validate\x20package','9804905IpHMCh','deployment_status__v','retrieveAttachments','saveDeploymentResults','status','componentIdList','Metadata_Log__c','1161dpebhJ','finishDeploy','jszip','importVpk','generateVPK','\x20>\x20','6840055CEKxtm','../constants/veeva.constants','multipart/form-data','success','EXCEPTION','nodebuffer','string','../../shared/utils/fetch-attachments','VeevaPackageStatus','__importDefault','420851FSWKSw','loadAsync','componentName','Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20','_tempFolder','Builder','Deployment.log','../dtos/component.dto','.zip','has','PackageComponentStatus','values','timeZone','attachmentLogId','2384980pYuTCA','Branch__c','SalesforceService','xml2js','Activity_Type__c','FlosumConstants','catch','Cannot\x20retrieve\x20all\x20components.','Deployment','name','\x20:\x20','Deploy\x20Log','TargetId__c','buildObject','Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20','Async_Request_Id__c','VeevaConstants','VERIFIED','responseStatus','20ySXygz','_instanceUrl','_organisationName','fs/promises','ComponentDto','url','Join\x20all\x20mdl\x20into\x20one\x20zip','form-data','Save\x20log','branchId','Retrieving\x20attachments','formFlosumDeploymentResults','__esModule','formPackageComponentList','isDeployed','VeevaService','DEPLOYED_WITH_WARNINGS','parse','Action__c','getJobResult','text/plain','createReadStream','put','retrieveRecords','Failure','toString','apply','application/json','map','componentHistoryId','../dtos/job-result.dto','/Attachment','Activity_Item__c','file','1126hIPFSC','set','_attachmentLogId','{package_id}','Job_Completed__c','Import\x20package','errors','./salesforce.service','_organisationId','_timeZone','logError','with\x20error','finishDeployWithError','_deploymentName','Component_Type__c','post','replace','Deployment\x20Result','ENDPOINT_EXPORT_IMPORT_PACKAGE','Cannot\x20retrieve\x20all\x20attachments'];a310_0xe5d0=function(){return _0x14f71b;};return a310_0xe5d0();}'use strict';var __importDefault=this&&this[a310_0x2a2e2a(0x22a)]||function(_0x5bb99d){const _0x2c812a=a310_0x2a2e2a;return _0x5bb99d&&_0x5bb99d[_0x2c812a(0x178)]?_0x5bb99d:{'default':_0x5bb99d};};Object['defineProperty'](exports,a310_0x2a2e2a(0x178),{'value':!![]}),exports[a310_0x2a2e2a(0x1c2)]=void 0x0;const jszip_1=__importDefault(require(a310_0x2a2e2a(0x21d))),form_data_1=__importDefault(require(a310_0x2a2e2a(0x173))),fs_1=require('fs'),promises_1=require(a310_0x2a2e2a(0x16f)),constants_1=require(a310_0x2a2e2a(0x1af)),flosum_constants_1=require(a310_0x2a2e2a(0x1c3)),veeva_constants_1=require(a310_0x2a2e2a(0x222)),veeva_service_1=require('./veeva.service'),component_dto_1=require(a310_0x2a2e2a(0x232)),job_result_dto_1=require(a310_0x2a2e2a(0x18a)),package_component_dto_1=require(a310_0x2a2e2a(0x1d4)),salesforce_service_1=require(a310_0x2a2e2a(0x195)),core_1=require('../../../core'),status_enums_1=require(a310_0x2a2e2a(0x1cc)),salesforce_dml_error_1=require(a310_0x2a2e2a(0x1fb)),veeva_error_1=require('../classes/errors/veeva-error'),shortid_1=__importDefault(require(a310_0x2a2e2a(0x1f3))),veeva_auth_utils_1=require(a310_0x2a2e2a(0x1ac)),xml2js_1=require(a310_0x2a2e2a(0x15c)),fetch_attachments_1=require(a310_0x2a2e2a(0x228));class DeployService{constructor(_0x25dbf9,_0x4677e5,_0x259aec,_0x5480bf,_0x256d98,_0x32f3dd){const _0x1e85c9=a310_0x2a2e2a;this[_0x1e85c9(0x1e3)]=_0x4677e5,this[_0x1e85c9(0x1a6)]=_0x259aec,this[_0x1e85c9(0x1dc)]=_0x5480bf,this[_0x1e85c9(0x22f)]=_0x256d98,this['_instanceUrl']=_0x32f3dd,this['_branchId']=_0x25dbf9[_0x1e85c9(0x175)],this['_metadataLogId']=_0x25dbf9[_0x1e85c9(0x1c0)],this[_0x1e85c9(0x190)]=_0x25dbf9[_0x1e85c9(0x158)],this[_0x1e85c9(0x196)]=_0x25dbf9[_0x1e85c9(0x209)],this[_0x1e85c9(0x197)]=_0x25dbf9[_0x1e85c9(0x157)],this[_0x1e85c9(0x16e)]=_0x25dbf9[_0x1e85c9(0x1c8)],this['_componentIdList']=_0x25dbf9[_0x1e85c9(0x219)],this[_0x1e85c9(0x19b)]=_0x25dbf9[_0x1e85c9(0x1eb)],this[_0x1e85c9(0x1ff)]=new core_1['Logger'](_0x1e85c9(0x1c9));}async[a310_0x2a2e2a(0x1e0)](){const _0x299943=a310_0x2a2e2a;try{const _0x159689=await this[_0x299943(0x1b1)](),_0x1d74dc=await this[_0x299943(0x216)](_0x159689),_0x1cbb10=await this[_0x299943(0x1e5)](_0x1d74dc),_0x4ac449=await this[_0x299943(0x21f)](_0x1cbb10);await this['validateVpk'](_0x4ac449);const _0x180461=await this['importVpk'](_0x4ac449),_0x5f24da=await this[_0x299943(0x20a)](_0x180461);await this['getValidationDetailsAndSaveLog'](_0x5f24da);const _0x582ad4=await this['deployPackage'](_0x5f24da[_0x299943(0x1c1)]),_0xdbee4d=await this[_0x299943(0x20a)](_0x582ad4);await this[_0x299943(0x1ea)](_0xdbee4d);const _0x11fc7f=this[_0x299943(0x177)](_0x159689,_0xdbee4d['packageComponentList']);await this[_0x299943(0x217)](_0x11fc7f),await this[_0x299943(0x21c)](_0xdbee4d[_0x299943(0x17a)],![],_0x5f24da[_0x299943(0x1c1)]);}catch(_0x13d8e0){await this[_0x299943(0x19a)](_0x13d8e0)[_0x299943(0x15f)](_0x3e91ed=>this['_systemLogger'][_0x299943(0x1b5)](_0x3e91ed));}}async[a310_0x2a2e2a(0x1b1)](){const _0xc86b19=a310_0x2a2e2a,_0xff1f0f=new Set(this[_0xc86b19(0x1b7)]);this[_0xc86b19(0x1dc)]['log']('Retrieving\x20components');const _0x15382c=_0xc86b19(0x1cd)+constants_1['FLOSUM_NAMESPACE']+_0xc86b19(0x1a2)+constants_1[_0xc86b19(0x212)]+_0xc86b19(0x22e)+constants_1[_0xc86b19(0x212)]+'Components__r\x20ORDER\x20BY\x20'+constants_1[_0xc86b19(0x212)]+_0xc86b19(0x167)+constants_1[_0xc86b19(0x212)]+_0xc86b19(0x1cb)+constants_1[_0xc86b19(0x212)]+_0xc86b19(0x1d5)+this[_0xc86b19(0x1bc)]+'\x27',_0x1fca85=await salesforce_service_1[_0xc86b19(0x15b)][_0xc86b19(0x183)](this['_connectionSalesforce'],_0x15382c);if(!_0x1fca85['length'])throw new Error(_0xc86b19(0x160));const _0xbe9f0f=_0x1fca85[_0xc86b19(0x188)](_0x550cc3=>new component_dto_1[(_0xc86b19(0x170))](_0x550cc3))[_0xc86b19(0x1fa)](_0x9d2822=>_0xff1f0f[_0xc86b19(0x234)](_0x9d2822['id']));if(_0xbe9f0f[_0xc86b19(0x202)]!==this['_componentIdList'][_0xc86b19(0x202)])throw new Error(_0xc86b19(0x160));return _0xbe9f0f;}async[a310_0x2a2e2a(0x216)](_0x5315a4){const _0x29f35e=a310_0x2a2e2a;this[_0x29f35e(0x1dc)][_0x29f35e(0x1a5)](_0x29f35e(0x176));const _0x9dff3e=await(0x0,fetch_attachments_1[_0x29f35e(0x1aa)])(this['_connectionSalesforce'],_0x5315a4['map'](_0x3ea2e5=>_0x3ea2e5['componentHistoryId'])),_0x435dc8=await(0x0,fetch_attachments_1[_0x29f35e(0x216)])(_0x9dff3e,this[_0x29f35e(0x1e3)]);if(_0x435dc8[_0x29f35e(0x202)]!==this[_0x29f35e(0x1b7)][_0x29f35e(0x202)])throw new Error(_0x29f35e(0x1a1));return _0x435dc8[_0x29f35e(0x188)](_0x21a0ae=>_0x21a0ae[_0x29f35e(0x156)][_0x29f35e(0x1d2)]);}async['joinAllAttachments'](_0x362a4f){const _0x548cef=a310_0x2a2e2a;var _0x23aab6;this[_0x548cef(0x1dc)]['log'](_0x548cef(0x172));const _0x33c1a0=new jszip_1[(_0x548cef(0x1ad))]();for(const _0x5be32c of _0x362a4f){const _0x300bce=new jszip_1['default']();await _0x300bce[_0x548cef(0x22c)](_0x5be32c,{'base64':!![]});for(const _0x3c014c in _0x300bce['files']){const _0x47607f=await((_0x23aab6=_0x300bce[_0x548cef(0x18d)](_0x3c014c))===null||_0x23aab6===void 0x0?void 0x0:_0x23aab6['async'](_0x548cef(0x227)));_0x47607f&&_0x33c1a0[_0x548cef(0x18d)](_0x3c014c,_0x47607f);}}const _0x56f7e1=new xml2js_1[(_0x548cef(0x230))]({'headless':!![]}),_0x522c78={'vaultpackage':{'$':{'xmlns':_0x548cef(0x1c6)},'name':this[_0x548cef(0x19b)],'source':{'vault':undefined,'author':'Flosum'},'packagetype':'migration__v','summary':_0x548cef(0x1b4),'description':'null'}};_0x33c1a0['file']('vaultpackage.xml',_0x56f7e1[_0x548cef(0x166)](_0x522c78));const _0x29f597=this['_tempFolder']+'/'+(0x0,shortid_1['default'])()+_0x548cef(0x233),_0x4c2541=await _0x33c1a0[_0x548cef(0x1cf)]({'type':_0x548cef(0x226)});return await(0x0,promises_1['writeFile'])(_0x29f597,_0x4c2541),_0x29f597;}async[a310_0x2a2e2a(0x21f)](_0x1aff56,_0x1f65b2=0x1){const _0x583cc3=a310_0x2a2e2a;var _0x142fbe;this[_0x583cc3(0x1dc)][_0x583cc3(0x1a5)]('Generate\x20vpk\x20package');const _0xe73c02=new form_data_1[(_0x583cc3(0x1ad))]();_0xe73c02[_0x583cc3(0x1d9)]('file',(0x0,fs_1[_0x583cc3(0x181)])(_0x1aff56));const _0x2dacfe=await this['_connectionVeeva'][_0x583cc3(0x19d)](veeva_constants_1[_0x583cc3(0x169)][_0x583cc3(0x1a0)],_0xe73c02,{'responseType':_0x583cc3(0x1d3),'headers':{'Content-Type':_0x583cc3(0x223)}}),_0x3ad534=(_0x142fbe=_0x2dacfe[_0x583cc3(0x201)]['content-type'])===null||_0x142fbe===void 0x0?void 0x0:_0x142fbe[_0x583cc3(0x1fc)](_0x583cc3(0x187));if(!_0x3ad534){const _0x2c75a4=_0x2dacfe[_0x583cc3(0x1e2)],_0x3d2b68=this[_0x583cc3(0x22f)]+_0x583cc3(0x1ba)+_0x1aff56[_0x583cc3(0x203)](_0x1aff56['lastIndexOf']('/')+0x1);return await(0x0,promises_1[_0x583cc3(0x1d6)])(_0x3d2b68,_0x2c75a4),_0x3d2b68;}else{const _0x110f8f=JSON[_0x583cc3(0x17d)](_0x2dacfe[_0x583cc3(0x1e2)]);if(_0x1f65b2>0x0)return await(0x0,veeva_auth_utils_1[_0x583cc3(0x1d8)])(this[_0x583cc3(0x1a6)]),await this[_0x583cc3(0x21f)](_0x1aff56,_0x1f65b2-0x1);throw new veeva_error_1[(_0x583cc3(0x200))](_0x110f8f[_0x583cc3(0x194)]);}}async[a310_0x2a2e2a(0x1bb)](_0x11f9f3,_0x34e44f=0x1){const _0x3bd49b=a310_0x2a2e2a;this[_0x3bd49b(0x1dc)][_0x3bd49b(0x1a5)](_0x3bd49b(0x213));const _0x19353e=new form_data_1[(_0x3bd49b(0x1ad))]();_0x19353e[_0x3bd49b(0x1d9)](_0x3bd49b(0x18d),(0x0,fs_1[_0x3bd49b(0x181)])(_0x11f9f3));const _0x4eb9d6=await this['_connectionVeeva'][_0x3bd49b(0x19d)](veeva_constants_1[_0x3bd49b(0x169)]['ENDPOINT_VALIDATE_PACKAGE'],_0x19353e,{'headers':{'Content-Type':_0x3bd49b(0x223)}}),_0x3d5926=_0x4eb9d6['data'];if(_0x3d5926[_0x3bd49b(0x16b)]===status_enums_1['VeevaResponseStatus'][_0x3bd49b(0x1da)])return _0x3d5926;else{if(_0x34e44f>0x0)return await(0x0,veeva_auth_utils_1[_0x3bd49b(0x1d8)])(this[_0x3bd49b(0x1a6)]),await this['validateVpk'](_0x11f9f3,_0x34e44f-0x1);throw new veeva_error_1[(_0x3bd49b(0x200))](_0x3d5926[_0x3bd49b(0x194)]);}}async[a310_0x2a2e2a(0x21e)](_0x5bc56c,_0x41de31=0x1){const _0x42c657=a310_0x2a2e2a;this[_0x42c657(0x1dc)][_0x42c657(0x1a5)](_0x42c657(0x193));const _0x5bb19e=new form_data_1[(_0x42c657(0x1ad))]();_0x5bb19e[_0x42c657(0x1d9)]('file',(0x0,fs_1[_0x42c657(0x181)])(_0x5bc56c));const _0x4f3469=await this[_0x42c657(0x1a6)][_0x42c657(0x182)](veeva_constants_1[_0x42c657(0x169)][_0x42c657(0x1a0)],_0x5bb19e,{'headers':{'Content-Type':_0x42c657(0x223)}}),_0x2c8d02=_0x4f3469[_0x42c657(0x1e2)];if(_0x2c8d02[_0x42c657(0x16b)]===status_enums_1[_0x42c657(0x20b)][_0x42c657(0x1da)])return _0x2c8d02[_0x42c657(0x171)];else{if(_0x41de31>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this['_connectionVeeva']),await this[_0x42c657(0x21e)](_0x5bc56c,_0x41de31-0x1);throw new veeva_error_1[(_0x42c657(0x200))](_0x2c8d02['errors']);}}async[a310_0x2a2e2a(0x1fe)](_0x4e5559){const _0x322ff7=a310_0x2a2e2a;this['_logger'][_0x322ff7(0x1a5)](_0x322ff7(0x1e6));const _0x5b4b29=await this[_0x322ff7(0x1a6)][_0x322ff7(0x19d)](veeva_constants_1['VeevaConstants'][_0x322ff7(0x1f7)][_0x322ff7(0x19e)](_0x322ff7(0x191),_0x4e5559)),_0x3e3e3a=await _0x5b4b29['data'];if(_0x3e3e3a[_0x322ff7(0x16b)]===status_enums_1[_0x322ff7(0x20b)][_0x322ff7(0x1da)])return _0x3e3e3a[_0x322ff7(0x171)];else throw new veeva_error_1[(_0x322ff7(0x200))](_0x3e3e3a[_0x322ff7(0x194)]);}async[a310_0x2a2e2a(0x20a)](_0xdd49d){const _0x564e88=a310_0x2a2e2a;this[_0x564e88(0x1dc)][_0x564e88(0x1a5)](_0x564e88(0x1f1));const _0x17d099=new job_result_dto_1['JobResultDto'](),[_0x5dac7e]=await veeva_service_1[_0x564e88(0x17b)][_0x564e88(0x17f)]([_0xdd49d],this[_0x564e88(0x1a6)],this['_logger']);return _0x17d099['isSuccess']=_0x5dac7e[_0x564e88(0x218)]===status_enums_1[_0x564e88(0x1ec)][_0x564e88(0x1da)],_0x17d099['detailUrl']=_0x5dac7e[_0x564e88(0x1f8)][_0x564e88(0x1a4)](_0x14118e=>_0x14118e[_0x564e88(0x1dd)]==='artifacts')['href'],_0x17d099;}async['getValidationDetailsAndSaveLog'](_0xf67195){const _0x425447=a310_0x2a2e2a;this[_0x425447(0x1dc)][_0x425447(0x1a5)](_0x425447(0x1b8));const {data:_0x3407fb}=await this['_connectionVeeva'][_0x425447(0x205)](_0xf67195['detailUrl']);if(_0x3407fb[_0x425447(0x16b)]===status_enums_1['VeevaResponseStatus'][_0x425447(0x1da)]){const {log:_0x511032,id:_0x5f5455,package_status:_0x237e71}=_0x3407fb[_0x425447(0x207)],_0x535a5a=_0x511032[_0x425447(0x1fa)](_0x3c6f52=>_0x3c6f52[_0x425447(0x1f6)][_0x425447(0x20f)](_0x425447(0x1ae))),_0x5cd2ae=await this[_0x425447(0x1db)](_0x535a5a[0x0]['url']);await this[_0x425447(0x1f0)](_0x5cd2ae,_0x425447(0x1fd)),_0xf67195[_0x425447(0x1c1)]=_0x5f5455;if(_0x237e71!==status_enums_1[_0x425447(0x229)][_0x425447(0x16a)])throw new Error('Package\x20not\x20verified');}else throw new veeva_error_1[(_0x425447(0x200))](_0x3407fb['errors']);}async[a310_0x2a2e2a(0x1ea)](_0x23aed9){const _0x242de6=a310_0x2a2e2a;this[_0x242de6(0x1dc)][_0x242de6(0x1a5)](_0x242de6(0x1df));const {data:_0x5ac962}=await this[_0x242de6(0x1a6)]['get'](_0x23aed9[_0x242de6(0x1a9)]);if(_0x5ac962['responseStatus']===status_enums_1[_0x242de6(0x20b)][_0x242de6(0x1da)]){const {responseDetails:{deployment_log:_0x3e2694,package_status__v:_0x2e6599},package_steps:_0x9bb40e}=_0x5ac962,_0x383555=_0x3e2694['filter'](_0x1d2893=>_0x1d2893['filename']['endsWith'](_0x242de6(0x231))),_0x400810=await this[_0x242de6(0x1db)](_0x383555[0x0][_0x242de6(0x171)]);await this[_0x242de6(0x1f0)](_0x400810,_0x242de6(0x164)),_0x23aed9[_0x242de6(0x17a)]=[status_enums_1[_0x242de6(0x229)][_0x242de6(0x204)],status_enums_1[_0x242de6(0x229)][_0x242de6(0x17c)]][_0x242de6(0x1fc)](_0x2e6599);const _0x77aa54=this[_0x242de6(0x179)](_0x9bb40e);_0x23aed9[_0x242de6(0x1b3)]=_0x77aa54[_0x242de6(0x1fa)](_0x2616a4=>_0x2616a4[_0x242de6(0x218)]!==status_enums_1[_0x242de6(0x155)][_0x242de6(0x16a)]);if(!_0x23aed9[_0x242de6(0x1b3)][_0x242de6(0x202)])throw new Error('Cannot\x20find\x20deployment\x20results');}else throw new veeva_error_1[(_0x242de6(0x200))](_0x5ac962[_0x242de6(0x194)]);}async[a310_0x2a2e2a(0x1db)](_0x237818){const _0x7295d6=a310_0x2a2e2a,{data:_0x26949b}=await this[_0x7295d6(0x1a6)][_0x7295d6(0x205)](_0x237818,{'responseType':_0x7295d6(0x1e7)});return _0x26949b;}['formPackageComponentList'](_0x378a9d){const _0x3c81bb=a310_0x2a2e2a;return _0x378a9d[_0x3c81bb(0x210)]((_0xbb87cb,_0x2565d5)=>{const _0x4d59cb=_0x3c81bb,_0x25ea54=_0x2565d5[_0x4d59cb(0x1f4)]['map'](_0x58e199=>new package_component_dto_1['PackageComponentDto'](_0x58e199,_0x2565d5[_0x4d59cb(0x215)]));return[..._0xbb87cb,..._0x25ea54];},[]);}async[a310_0x2a2e2a(0x1f0)](_0x45bc30,_0x453e49){const _0x164e0c=a310_0x2a2e2a;this[_0x164e0c(0x1dc)][_0x164e0c(0x1a5)](_0x164e0c(0x174));const _0x51cd2c={'Body':Buffer[_0x164e0c(0x1d7)](_0x45bc30)['toString'](_0x164e0c(0x1de)),'ContentType':_0x164e0c(0x180),'ParentId':this['_metadataLogId'],'Name':_0x453e49},{data:_0x27d3e1}=await this[_0x164e0c(0x1e3)][_0x164e0c(0x19d)](flosum_constants_1[_0x164e0c(0x15e)][_0x164e0c(0x1ee)]+_0x164e0c(0x18b),_0x51cd2c);return _0x27d3e1['id'];}['formFlosumDeploymentResults'](_0x23e89a,_0x1f69cd){const _0x2f7d81=a310_0x2a2e2a;this['_logger']['log'](_0x2f7d81(0x1f2));const _0x3f952b=_0x23e89a[_0x2f7d81(0x210)]((_0x22932c,_0x36b288)=>_0x22932c[_0x2f7d81(0x18f)]((_0x36b288[_0x2f7d81(0x1bd)]+'.'+_0x36b288[_0x2f7d81(0x22d)])[_0x2f7d81(0x1e1)](),_0x36b288),new Map());return _0x1f69cd['map'](_0x372f4f=>{const _0x323011=_0x2f7d81;this[_0x323011(0x1dc)][_0x323011(0x1a5)](_0x372f4f[_0x323011(0x1b9)]+'.'+_0x372f4f[_0x323011(0x162)]+_0x323011(0x163)+_0x372f4f[_0x323011(0x218)]);const _0x145602=(_0x372f4f[_0x323011(0x1b9)]+'.'+_0x372f4f[_0x323011(0x162)])[_0x323011(0x1e1)](),_0x5dc32c=_0x3f952b[_0x323011(0x205)](_0x145602);return{[constants_1[_0x323011(0x212)]+_0x323011(0x1ce)]:_0x323011(0x19f),[constants_1[_0x323011(0x212)]+_0x323011(0x1e8)]:_0x372f4f['status']===status_enums_1[_0x323011(0x155)][_0x323011(0x204)]?'Success':_0x323011(0x184),[constants_1[_0x323011(0x212)]+_0x323011(0x1be)]:_0x323011(0x1f9),[constants_1[_0x323011(0x212)]+'Component_Name__c']:_0x372f4f[_0x323011(0x162)],[constants_1['FLOSUM_NAMESPACE']+_0x323011(0x19c)]:_0x372f4f[_0x323011(0x1b9)],[constants_1['FLOSUM_NAMESPACE']+_0x323011(0x1ca)]:this[_0x323011(0x196)],[constants_1['FLOSUM_NAMESPACE']+_0x323011(0x21a)]:this[_0x323011(0x20c)],[constants_1[_0x323011(0x212)]+'Component_History__c']:_0x5dc32c[_0x323011(0x189)]};});}async['saveDeploymentResults'](_0x43687a){const _0x12df53=a310_0x2a2e2a;this[_0x12df53(0x1dc)][_0x12df53(0x1a5)](_0x12df53(0x1ef));const _0xf08b8a=await salesforce_service_1[_0x12df53(0x15b)][_0x12df53(0x1d1)](this[_0x12df53(0x1e3)],constants_1[_0x12df53(0x212)]+'Deployment_Result__c',_0x43687a),_0x8a15c8=_0xf08b8a[_0x12df53(0x1fa)](_0x161d45=>!_0x161d45[_0x12df53(0x224)])[_0x12df53(0x188)](_0x144885=>_0x144885[_0x12df53(0x194)])[_0x12df53(0x20e)]();if(_0x8a15c8[_0x12df53(0x202)])throw new salesforce_dml_error_1[(_0x12df53(0x1c7))](_0x8a15c8);}async['finishDeployWithError'](_0x36ac5d){const _0x569e6f=a310_0x2a2e2a;this[_0x569e6f(0x1dc)][_0x569e6f(0x198)](_0x36ac5d),await this['_logger'][_0x569e6f(0x1b6)](),await this['finishDeploy'](![],!![],'');}async['finishDeploy'](_0x98e4b4,_0x4c6815,_0x119d43){const _0x99d5f=a310_0x2a2e2a,_0x42e7d6='<a\x20href='+this[_0x99d5f(0x16d)]+'/'+this[_0x99d5f(0x20c)]+_0x99d5f(0x220)+'Veeva\x20Deployment'+_0x99d5f(0x1c5),_0x1ce958=_0x99d5f(0x1e4)+this[_0x99d5f(0x16d)]+'/'+this['_organisationId']+'\x20>'+this[_0x99d5f(0x16e)]+'</a>',_0x22b171=_0x42e7d6+_0x99d5f(0x1a3)+_0x1ce958+_0x99d5f(0x1e9),_0x48243b={[constants_1['FLOSUM_NAMESPACE']+_0x99d5f(0x17e)]:_0x22b171,[constants_1[_0x99d5f(0x212)]+'Date__c']:new Date(),[constants_1[_0x99d5f(0x212)]+_0x99d5f(0x15a)]:this['_branchId'],[constants_1[_0x99d5f(0x212)]+_0x99d5f(0x18c)]:_0x99d5f(0x1c4),[constants_1['FLOSUM_NAMESPACE']+_0x99d5f(0x15d)]:_0x99d5f(0x161),[constants_1['FLOSUM_NAMESPACE']+_0x99d5f(0x165)]:this[_0x99d5f(0x196)]},_0x5a5a96={[constants_1['FLOSUM_NAMESPACE']+_0x99d5f(0x208)]:!_0x98e4b4,[constants_1['FLOSUM_NAMESPACE']+_0x99d5f(0x1f5)]:_0x98e4b4,[constants_1[_0x99d5f(0x212)]+_0x99d5f(0x1e8)]:_0x4c6815?status_enums_1[_0x99d5f(0x206)][_0x99d5f(0x225)]:status_enums_1['MetadataLogStatus'][_0x99d5f(0x20d)],[constants_1[_0x99d5f(0x212)]+_0x99d5f(0x192)]:!![],[constants_1[_0x99d5f(0x212)]+'Process_Type__c']:flosum_constants_1[_0x99d5f(0x15e)]['PROCESS_DEPLOYMENT'],[constants_1['FLOSUM_NAMESPACE']+_0x99d5f(0x168)]:_0x119d43};await this['_connectionSalesforce']['patch'](flosum_constants_1[_0x99d5f(0x15e)][_0x99d5f(0x1ee)]+'/'+constants_1['FLOSUM_NAMESPACE']+'Metadata_Log__c/'+this[_0x99d5f(0x20c)],_0x5a5a96),await this[_0x99d5f(0x1e3)][_0x99d5f(0x19d)](flosum_constants_1[_0x99d5f(0x15e)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x99d5f(0x212)]+_0x99d5f(0x1ab),_0x48243b),this[_0x99d5f(0x1dc)]['log'](_0x99d5f(0x211)+(_0x98e4b4?_0x99d5f(0x1b2):_0x99d5f(0x199))+'.'),await this[_0x99d5f(0x1dc)][_0x99d5f(0x1b6)]();}}function a310_0x3114(_0x19f30c,_0xf8cec7){const _0x3a030b=a310_0xe5d0();return a310_0x3114=function(_0x31e15d,_0x2f4912){_0x31e15d=_0x31e15d-0x155;let _0xe5d0bf=_0x3a030b[_0x31e15d];return _0xe5d0bf;},a310_0x3114(_0x19f30c,_0xf8cec7);}exports[a310_0x2a2e2a(0x1c2)]=DeployService;