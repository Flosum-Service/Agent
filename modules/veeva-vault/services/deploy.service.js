const a310_0x652658=a310_0x4ba6;function a310_0x266f(){const _0x1e5958=['toLowerCase','(((.+)+)+)+$','deployment_status__v','_timeZone','848060mpyOgk','Metadata_Log__c/','updateLog','../constants/veeva.constants','Cannot\x20find\x20deployment\x20results','responseStatus','Deploy\x20Log','success','string','JobResultDto','VeevaResponseStatus','\x20:\x20','componentName','map','buildObject','Get\x20deploy\x20result','Get\x20validation\x20details.','arraybuffer','formPackageComponentList','Branch__c','values','Type__c','content-type','headers','__importDefault','search','errors','multipart/form-data','COMPLETED','Status__c','VeevaService','Log__c','_organisationId','../dtos/package-component.dto','Package\x20not\x20verified','Logger','_branchId','filter','get','async','jszip','detailUrl','with\x20error','_tempFolder','filename','rel','PackageComponentDto','_attachmentLogId','packageComponentList','Deploy\x20package','Builder','fs/promises','saveDeploymentResults','retrieveComponents','veeva-deploy','importVpk','text','FlosumConstants','Component_Name__c','Retrieving\x20attachments','854lylVcx','_componentIdList','validateVpk','Component_Type__c','32574XpvfDP','\x20of\x20branch\x20to\x20Organization\x20','organisationId','replace','Body','11NGLDrt','Cannot\x20retrieve\x20all\x20attachments','getValidationDetailsAndSaveLog','\x20</a>','_connectionVeeva','Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','metadataLogId','PROCESS_DEPLOYMENT','execute','</a>','insertMultipleRecords','log','formFlosumDeploymentResults','ENDPOINT_DEPLOY_PACKAGE','SalesforceService','isDeployed','getJobResult','../../../core','VeevaPackageStatus','Is_Error__c','{package_id}','ComponentDto','PackageComponentStatus','../utils/veeva-auth.utils','5301gAWYlI','./veeva.service','Deploy','application/json','Deployment\x20Result','reduce','joinAllAttachments','1453380icdxqx','endsWith','patch','Validate\x20package','isSuccess','VERIFIED','from','/vpk__','status','EXCEPTION','length','files','updateVeevaConnection','base64','shortid','null','flat','VeevaConstants','name','ENDPOINT_EXPORT_IMPORT_PACKAGE','nodebuffer','xml2js','componentHistoryId','./salesforce.service','constructor','Async_Request_Id__c','Form\x20Deployment\x20Results','_metadataLogId','__esModule','_organisationName','createReadStream','DEPLOYED_WITH_WARNINGS','Deployment','VeevaError','href','apply','../../../constants','../dtos/job-result.dto','../constants/flosum.constants','migration__v','slice','RECREATE','includes','deployPackage','Veeva\x20Deployment','\x20>\x20','generateAsync','catch','organisationName','_systemLogger','deploymentName','SUCCESS','\x20has\x20been\x20created.','url','6736992JNuhqA','5ygLobC','Validation\x20Log','DeployService','vaultPackage','Component_History__c','Generate\x20vpk\x20package','retrieveAttachments','getDeployDetailsAndSaveLog','finishDeploy','find','getJobStatus','fetchAttachmentsDetailsByParentId','_deploymentName','Branch__c\x20=\x20\x27','set','links','generateVPK','DEPLOYED','toString','Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20','733728vYknKX','_logger','20688ifoGvr','Metadata_Log__c','artifacts','saveLog','Org__c','TargetId__c','18vbEAsS','Failure','../classes/errors/veeva-error','/Attachment','https://veevavault.com/','attachmentLogId','Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20','_connectionSalesforce','getLogResultText','append','lastIndexOf','Activity_Type__c','Cannot\x20retrieve\x20all\x20components.','../dtos/component.dto','form-data','file','has','branchId','Save\x20Deployment\x20Results','Save\x20log','Deployment_Result__c','6008kBaxCB','type','packageId','error','default','Import\x20package','ENDPOINT_UPSERT_RECORD','post','<a\x20href=','writeFile','Action__c','MetadataLogStatus','finishDeployWithError','Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20','FLOSUM_NAMESPACE','ENDPOINT_VALIDATE_PACKAGE','data','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','_instanceUrl','../../shared/utils/fetch-attachments'];a310_0x266f=function(){return _0x1e5958;};return a310_0x266f();}(function(_0xb40f0e,_0xcff531){const _0x3f681c=a310_0x4ba6,_0x27af72=_0xb40f0e();while(!![]){try{const _0x541d9a=parseInt(_0x3f681c(0x18c))/0x1*(parseInt(_0x3f681c(0x203))/0x2)+-parseInt(_0x3f681c(0x1fb))/0x3+-parseInt(_0x3f681c(0x230))/0x4*(parseInt(_0x3f681c(0x1e7))/0x5)+parseInt(_0x3f681c(0x1fd))/0x6*(parseInt(_0x3f681c(0x188))/0x7)+parseInt(_0x3f681c(0x218))/0x8*(-parseInt(_0x3f681c(0x1a9))/0x9)+parseInt(_0x3f681c(0x1b0))/0xa*(-parseInt(_0x3f681c(0x191))/0xb)+parseInt(_0x3f681c(0x1e6))/0xc;if(_0x541d9a===_0xcff531)break;else _0x27af72['push'](_0x27af72['shift']());}catch(_0x551317){_0x27af72['push'](_0x27af72['shift']());}}}(a310_0x266f,0x3863a));const a310_0x1db5ad=(function(){let _0x226916=!![];return function(_0x52ae1e,_0x21eee7){const _0x3be42e=_0x226916?function(){const _0x1a25f5=a310_0x4ba6;if(_0x21eee7){const _0x5562c8=_0x21eee7[_0x1a25f5(0x1d3)](_0x52ae1e,arguments);return _0x21eee7=null,_0x5562c8;}}:function(){};return _0x226916=![],_0x3be42e;};}()),a310_0x504cef=a310_0x1db5ad(this,function(){const _0x241b6f=a310_0x4ba6;return a310_0x504cef[_0x241b6f(0x1f9)]()[_0x241b6f(0x165)](_0x241b6f(0x22d))[_0x241b6f(0x1f9)]()[_0x241b6f(0x1c8)](a310_0x504cef)[_0x241b6f(0x165)](_0x241b6f(0x22d));});a310_0x504cef();'use strict';var __importDefault=this&&this[a310_0x652658(0x164)]||function(_0x52c4a6){const _0xa47514=a310_0x652658;return _0x52c4a6&&_0x52c4a6[_0xa47514(0x1cc)]?_0x52c4a6:{'default':_0x52c4a6};};function a310_0x4ba6(_0xa4dbdc,_0x5e6c13){const _0x353f0e=a310_0x266f();return a310_0x4ba6=function(_0x504cef,_0x1db5ad){_0x504cef=_0x504cef-0x14f;let _0x266f0b=_0x353f0e[_0x504cef];return _0x266f0b;},a310_0x4ba6(_0xa4dbdc,_0x5e6c13);}Object['defineProperty'](exports,a310_0x652658(0x1cc),{'value':!![]}),exports[a310_0x652658(0x1e9)]=void 0x0;const jszip_1=__importDefault(require(a310_0x652658(0x174))),form_data_1=__importDefault(require(a310_0x652658(0x211))),fs_1=require('fs'),promises_1=require(a310_0x652658(0x17f)),constants_1=require(a310_0x652658(0x1d4)),flosum_constants_1=require(a310_0x652658(0x1d6)),veeva_constants_1=require(a310_0x652658(0x14f)),veeva_service_1=require(a310_0x652658(0x1aa)),component_dto_1=require(a310_0x652658(0x210)),job_result_dto_1=require(a310_0x652658(0x1d5)),package_component_dto_1=require(a310_0x652658(0x16d)),salesforce_service_1=require(a310_0x652658(0x1c7)),core_1=require(a310_0x652658(0x1a2)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),veeva_error_1=require(a310_0x652658(0x205)),shortid_1=__importDefault(require(a310_0x652658(0x1be))),veeva_auth_utils_1=require(a310_0x652658(0x1a8)),xml2js_1=require(a310_0x652658(0x1c5)),fetch_attachments_1=require(a310_0x652658(0x22b));class DeployService{constructor(_0x630399,_0x4acd8c,_0x32daf0,_0x3ce31a,_0x14339e,_0x2fc1b9){const _0x2be8ee=a310_0x652658;this[_0x2be8ee(0x20a)]=_0x4acd8c,this['_connectionVeeva']=_0x32daf0,this[_0x2be8ee(0x1fc)]=_0x3ce31a,this[_0x2be8ee(0x177)]=_0x14339e,this[_0x2be8ee(0x22a)]=_0x2fc1b9,this[_0x2be8ee(0x170)]=_0x630399[_0x2be8ee(0x214)],this[_0x2be8ee(0x1cb)]=_0x630399[_0x2be8ee(0x197)],this[_0x2be8ee(0x17b)]=_0x630399[_0x2be8ee(0x208)],this[_0x2be8ee(0x16c)]=_0x630399[_0x2be8ee(0x18e)],this[_0x2be8ee(0x22f)]=_0x630399['timeZone'],this['_organisationName']=_0x630399[_0x2be8ee(0x1e0)],this[_0x2be8ee(0x189)]=_0x630399['componentIdList'],this[_0x2be8ee(0x1f3)]=_0x630399[_0x2be8ee(0x1e2)],this[_0x2be8ee(0x1e1)]=new core_1[(_0x2be8ee(0x16f))](_0x2be8ee(0x182));}async[a310_0x652658(0x199)](){const _0x325968=a310_0x652658;try{const _0x56aa02=await this[_0x325968(0x181)](),_0x125282=await this[_0x325968(0x1ed)](_0x56aa02),_0x367789=await this['joinAllAttachments'](_0x125282),_0x28f720=await this[_0x325968(0x1f7)](_0x367789);await this[_0x325968(0x18a)](_0x28f720);const _0x177d58=await this[_0x325968(0x183)](_0x28f720),_0x81424c=await this[_0x325968(0x1f1)](_0x177d58);await this[_0x325968(0x193)](_0x81424c);const _0x116a6c=await this[_0x325968(0x1db)](_0x81424c[_0x325968(0x21a)]),_0x11e107=await this[_0x325968(0x1f1)](_0x116a6c);await this[_0x325968(0x1ee)](_0x11e107);const _0x1c90c2=this[_0x325968(0x19d)](_0x56aa02,_0x11e107[_0x325968(0x17c)]);await this[_0x325968(0x180)](_0x1c90c2),await this[_0x325968(0x1ef)](_0x11e107[_0x325968(0x1a0)],![],_0x81424c[_0x325968(0x21a)]);}catch(_0x4aecb6){await this[_0x325968(0x224)](_0x4aecb6)[_0x325968(0x1df)](_0x2e193c=>this[_0x325968(0x1e1)][_0x325968(0x21b)](_0x2e193c));}}async[a310_0x652658(0x181)](){const _0x55595b=a310_0x652658,_0x592f2b=new Set(this[_0x55595b(0x189)]);this['_logger'][_0x55595b(0x19c)]('Retrieving\x20components');const _0x2d6d26=_0x55595b(0x229)+constants_1[_0x55595b(0x226)]+_0x55595b(0x196)+constants_1[_0x55595b(0x226)]+_0x55595b(0x209)+constants_1[_0x55595b(0x226)]+'Components__r\x20ORDER\x20BY\x20'+constants_1['FLOSUM_NAMESPACE']+_0x55595b(0x1fa)+constants_1[_0x55595b(0x226)]+_0x55595b(0x225)+constants_1['FLOSUM_NAMESPACE']+_0x55595b(0x1f4)+this[_0x55595b(0x170)]+'\x27',_0x11e7f4=await salesforce_service_1[_0x55595b(0x19f)]['retrieveRecords'](this['_connectionSalesforce'],_0x2d6d26);if(!_0x11e7f4[_0x55595b(0x1ba)])throw new Error(_0x55595b(0x20f));const _0x352418=_0x11e7f4[_0x55595b(0x159)](_0x395893=>new component_dto_1[(_0x55595b(0x1a6))](_0x395893))['filter'](_0x3b10cb=>_0x592f2b[_0x55595b(0x213)](_0x3b10cb['id']));if(_0x352418[_0x55595b(0x1ba)]!==this[_0x55595b(0x189)]['length'])throw new Error(_0x55595b(0x20f));return _0x352418;}async[a310_0x652658(0x1ed)](_0x4c0ebc){const _0x27970c=a310_0x652658;this['_logger'][_0x27970c(0x19c)](_0x27970c(0x187));const _0x2146b0=await(0x0,fetch_attachments_1[_0x27970c(0x1f2)])(this[_0x27970c(0x20a)],_0x4c0ebc['map'](_0x34c76e=>_0x34c76e[_0x27970c(0x1c6)])),_0x2d8f2f=await(0x0,fetch_attachments_1[_0x27970c(0x1ed)])(_0x2146b0,this[_0x27970c(0x20a)]);if(_0x2d8f2f[_0x27970c(0x1ba)]!==this['_componentIdList']['length'])throw new Error(_0x27970c(0x192));return _0x2d8f2f[_0x27970c(0x159)](_0x4feb7f=>_0x4feb7f[_0x27970c(0x160)][_0x27970c(0x190)]);}async[a310_0x652658(0x1af)](_0x185a11){const _0x397eb6=a310_0x652658;var _0x3b951e;this['_logger']['log']('Join\x20all\x20mdl\x20into\x20one\x20zip');const _0x1b92b3=new jszip_1[(_0x397eb6(0x21c))]();for(const _0x27b0c9 of _0x185a11){const _0x520b0b=new jszip_1[(_0x397eb6(0x21c))]();await _0x520b0b['loadAsync'](_0x27b0c9,{'base64':!![]});for(const _0x4fee31 in _0x520b0b[_0x397eb6(0x1bb)]){const _0x26bc57=await((_0x3b951e=_0x520b0b[_0x397eb6(0x212)](_0x4fee31))===null||_0x3b951e===void 0x0?void 0x0:_0x3b951e[_0x397eb6(0x173)](_0x397eb6(0x154)));_0x26bc57&&_0x1b92b3[_0x397eb6(0x212)](_0x4fee31,_0x26bc57);}}const _0x427ca1=new xml2js_1[(_0x397eb6(0x17e))]({'headless':!![]}),_0x230d08={'vaultpackage':{'$':{'xmlns':_0x397eb6(0x207)},'name':this[_0x397eb6(0x1f3)],'source':{'vault':undefined,'author':'Flosum'},'packagetype':_0x397eb6(0x1d7),'summary':_0x397eb6(0x1ab),'description':_0x397eb6(0x1bf)}};_0x1b92b3['file']('vaultpackage.xml',_0x427ca1[_0x397eb6(0x15a)](_0x230d08));const _0x3c19af=this[_0x397eb6(0x177)]+'/'+(0x0,shortid_1['default'])()+'.zip',_0x4093fe=await _0x1b92b3[_0x397eb6(0x1de)]({'type':_0x397eb6(0x1c4)});return await(0x0,promises_1[_0x397eb6(0x221)])(_0x3c19af,_0x4093fe),_0x3c19af;}async[a310_0x652658(0x1f7)](_0x4f6d30,_0x2f02c6=0x1){const _0x2ca716=a310_0x652658;var _0x545330;this[_0x2ca716(0x1fc)][_0x2ca716(0x19c)](_0x2ca716(0x1ec));const _0x455e19=new form_data_1[(_0x2ca716(0x21c))]();_0x455e19[_0x2ca716(0x20c)](_0x2ca716(0x212),(0x0,fs_1[_0x2ca716(0x1ce)])(_0x4f6d30));const _0xb70d72=await this['_connectionVeeva']['post'](veeva_constants_1[_0x2ca716(0x1c1)][_0x2ca716(0x1c3)],_0x455e19,{'responseType':_0x2ca716(0x15d),'headers':{'Content-Type':_0x2ca716(0x167)}}),_0x543b9d=(_0x545330=_0xb70d72[_0x2ca716(0x163)][_0x2ca716(0x162)])===null||_0x545330===void 0x0?void 0x0:_0x545330[_0x2ca716(0x1da)](_0x2ca716(0x1ac));if(!_0x543b9d){const _0x22dfbe=_0xb70d72['data'],_0x4f034c=this['_tempFolder']+_0x2ca716(0x1b7)+_0x4f6d30[_0x2ca716(0x1d8)](_0x4f6d30[_0x2ca716(0x20d)]('/')+0x1);return await(0x0,promises_1[_0x2ca716(0x221)])(_0x4f034c,_0x22dfbe),_0x4f034c;}else{const _0x3dd20f=JSON['parse'](_0xb70d72[_0x2ca716(0x228)]);if(_0x2f02c6>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this['_connectionVeeva']),await this[_0x2ca716(0x1f7)](_0x4f6d30,_0x2f02c6-0x1);throw new veeva_error_1['VeevaError'](_0x3dd20f[_0x2ca716(0x166)]);}}async[a310_0x652658(0x18a)](_0x356104,_0x460fc7=0x1){const _0x4bc5df=a310_0x652658;this[_0x4bc5df(0x1fc)][_0x4bc5df(0x19c)](_0x4bc5df(0x1b3));const _0x9e6b08=new form_data_1[(_0x4bc5df(0x21c))]();_0x9e6b08['append']('file',(0x0,fs_1[_0x4bc5df(0x1ce)])(_0x356104));const _0x5304a4=await this[_0x4bc5df(0x195)][_0x4bc5df(0x21f)](veeva_constants_1['VeevaConstants'][_0x4bc5df(0x227)],_0x9e6b08,{'headers':{'Content-Type':_0x4bc5df(0x167)}}),_0x504d4d=_0x5304a4[_0x4bc5df(0x228)];if(_0x504d4d[_0x4bc5df(0x151)]===status_enums_1[_0x4bc5df(0x156)][_0x4bc5df(0x1e3)])return _0x504d4d;else{if(_0x460fc7>0x0)return await(0x0,veeva_auth_utils_1[_0x4bc5df(0x1bc)])(this[_0x4bc5df(0x195)]),await this[_0x4bc5df(0x18a)](_0x356104,_0x460fc7-0x1);throw new veeva_error_1[(_0x4bc5df(0x1d1))](_0x504d4d[_0x4bc5df(0x166)]);}}async[a310_0x652658(0x183)](_0x62c568,_0x46ed79=0x1){const _0x294489=a310_0x652658;this[_0x294489(0x1fc)]['log'](_0x294489(0x21d));const _0x256e9d=new form_data_1[(_0x294489(0x21c))]();_0x256e9d[_0x294489(0x20c)](_0x294489(0x212),(0x0,fs_1[_0x294489(0x1ce)])(_0x62c568));const _0x75e979=await this[_0x294489(0x195)]['put'](veeva_constants_1[_0x294489(0x1c1)][_0x294489(0x1c3)],_0x256e9d,{'headers':{'Content-Type':_0x294489(0x167)}}),_0x266706=_0x75e979['data'];if(_0x266706[_0x294489(0x151)]===status_enums_1[_0x294489(0x156)][_0x294489(0x1e3)])return _0x266706['url'];else{if(_0x46ed79>0x0)return await(0x0,veeva_auth_utils_1[_0x294489(0x1bc)])(this['_connectionVeeva']),await this[_0x294489(0x183)](_0x62c568,_0x46ed79-0x1);throw new veeva_error_1['VeevaError'](_0x266706['errors']);}}async[a310_0x652658(0x1db)](_0x113a52){const _0x2642c4=a310_0x652658;this[_0x2642c4(0x1fc)][_0x2642c4(0x19c)](_0x2642c4(0x17d));const _0x535e1c=await this[_0x2642c4(0x195)]['post'](veeva_constants_1['VeevaConstants'][_0x2642c4(0x19e)][_0x2642c4(0x18f)](_0x2642c4(0x1a5),_0x113a52)),_0x410ec2=await _0x535e1c[_0x2642c4(0x228)];if(_0x410ec2['responseStatus']===status_enums_1[_0x2642c4(0x156)][_0x2642c4(0x1e3)])return _0x410ec2[_0x2642c4(0x1e5)];else throw new veeva_error_1[(_0x2642c4(0x1d1))](_0x410ec2[_0x2642c4(0x166)]);}async[a310_0x652658(0x1f1)](_0x533d27){const _0x5c417a=a310_0x652658;this[_0x5c417a(0x1fc)]['log']('Wait\x20Executing\x20job');const _0x4ae86b=new job_result_dto_1[(_0x5c417a(0x155))](),[_0x4cca46]=await veeva_service_1[_0x5c417a(0x16a)][_0x5c417a(0x1a1)]([_0x533d27],this[_0x5c417a(0x195)],this[_0x5c417a(0x1fc)]);return _0x4ae86b[_0x5c417a(0x1b4)]=_0x4cca46[_0x5c417a(0x1b8)]===status_enums_1['VeevaJobStatus']['SUCCESS'],_0x4ae86b['detailUrl']=_0x4cca46[_0x5c417a(0x1f6)][_0x5c417a(0x1f0)](_0x5dee41=>_0x5dee41[_0x5c417a(0x179)]===_0x5c417a(0x1ff))[_0x5c417a(0x1d2)],_0x4ae86b;}async[a310_0x652658(0x193)](_0x8bd366){const _0x535f27=a310_0x652658;this['_logger'][_0x535f27(0x19c)](_0x535f27(0x15c));const {data:_0x4daa87}=await this[_0x535f27(0x195)]['get'](_0x8bd366[_0x535f27(0x175)]);if(_0x4daa87[_0x535f27(0x151)]===status_enums_1[_0x535f27(0x156)]['SUCCESS']){const {log:_0x1430f7,id:_0x354a89,package_status:_0x564a2d}=_0x4daa87[_0x535f27(0x1ea)],_0xeed27a=_0x1430f7[_0x535f27(0x171)](_0x5ff2e6=>_0x5ff2e6[_0x535f27(0x178)][_0x535f27(0x1b1)]('Validation.log')),_0x124a9d=await this[_0x535f27(0x20b)](_0xeed27a[0x0][_0x535f27(0x1e5)]);await this[_0x535f27(0x200)](_0x124a9d,_0x535f27(0x1e8)),_0x8bd366['packageId']=_0x354a89;if(_0x564a2d!==status_enums_1[_0x535f27(0x1a3)][_0x535f27(0x1b5)])throw new Error(_0x535f27(0x16e));}else throw new veeva_error_1['VeevaError'](_0x4daa87[_0x535f27(0x166)]);}async['getDeployDetailsAndSaveLog'](_0x4cf1be){const _0x31f004=a310_0x652658;this[_0x31f004(0x1fc)][_0x31f004(0x19c)](_0x31f004(0x15b));const {data:_0x42d678}=await this[_0x31f004(0x195)][_0x31f004(0x172)](_0x4cf1be[_0x31f004(0x175)]);if(_0x42d678[_0x31f004(0x151)]===status_enums_1['VeevaResponseStatus'][_0x31f004(0x1e3)]){const {responseDetails:{deployment_log:_0x46e895,package_status__v:_0x457c27},package_steps:_0x5c288a}=_0x42d678,_0x56d3e5=_0x46e895[_0x31f004(0x171)](_0x163ce2=>_0x163ce2[_0x31f004(0x178)][_0x31f004(0x1b1)]('Deployment.log')),_0x1a64e5=await this[_0x31f004(0x20b)](_0x56d3e5[0x0][_0x31f004(0x1e5)]);await this[_0x31f004(0x200)](_0x1a64e5,_0x31f004(0x152)),_0x4cf1be[_0x31f004(0x1a0)]=[status_enums_1[_0x31f004(0x1a3)]['DEPLOYED'],status_enums_1[_0x31f004(0x1a3)][_0x31f004(0x1cf)]][_0x31f004(0x1da)](_0x457c27);const _0x279c35=this['formPackageComponentList'](_0x5c288a);_0x4cf1be[_0x31f004(0x17c)]=_0x279c35[_0x31f004(0x171)](_0x6993c1=>_0x6993c1[_0x31f004(0x1b8)]!==status_enums_1['PackageComponentStatus'][_0x31f004(0x1b5)]);if(!_0x4cf1be[_0x31f004(0x17c)][_0x31f004(0x1ba)])throw new Error(_0x31f004(0x150));}else throw new veeva_error_1['VeevaError'](_0x42d678[_0x31f004(0x166)]);}async[a310_0x652658(0x20b)](_0x5b269d){const _0x5cbd34=a310_0x652658,{data:_0x47573f}=await this['_connectionVeeva']['get'](_0x5b269d,{'responseType':_0x5cbd34(0x184)});return _0x47573f;}[a310_0x652658(0x15e)](_0x4412f0){const _0x33c7f3=a310_0x652658;return _0x4412f0[_0x33c7f3(0x1ae)]((_0x3d643c,_0x4c250f)=>{const _0x92f0df=_0x33c7f3,_0x5d4a95=_0x4c250f['package_components'][_0x92f0df(0x159)](_0x5a5013=>new package_component_dto_1[(_0x92f0df(0x17a))](_0x5a5013,_0x4c250f[_0x92f0df(0x22e)]));return[..._0x3d643c,..._0x5d4a95];},[]);}async['saveLog'](_0x42308e,_0x4da2d9){const _0x3c2bd2=a310_0x652658;this['_logger'][_0x3c2bd2(0x19c)](_0x3c2bd2(0x216));const _0xd69ac9={'Body':Buffer[_0x3c2bd2(0x1b6)](_0x42308e)[_0x3c2bd2(0x1f9)](_0x3c2bd2(0x1bd)),'ContentType':'text/plain','ParentId':this['_metadataLogId'],'Name':_0x4da2d9},{data:_0x4937ca}=await this[_0x3c2bd2(0x20a)][_0x3c2bd2(0x21f)](flosum_constants_1['FlosumConstants'][_0x3c2bd2(0x21e)]+_0x3c2bd2(0x206),_0xd69ac9);return _0x4937ca['id'];}[a310_0x652658(0x19d)](_0x3f0f0f,_0x234469){const _0x4e4ad8=a310_0x652658;this['_logger']['log'](_0x4e4ad8(0x1ca));const _0x4dc133=_0x3f0f0f[_0x4e4ad8(0x1ae)]((_0x851519,_0x4366e0)=>_0x851519[_0x4e4ad8(0x1f5)]((_0x4366e0['componentType']+'.'+_0x4366e0[_0x4e4ad8(0x158)])[_0x4e4ad8(0x22c)](),_0x4366e0),new Map());return _0x234469[_0x4e4ad8(0x159)](_0x1600da=>{const _0x3f0e71=_0x4e4ad8;this[_0x3f0e71(0x1fc)][_0x3f0e71(0x19c)](_0x1600da[_0x3f0e71(0x219)]+'.'+_0x1600da[_0x3f0e71(0x1c2)]+_0x3f0e71(0x157)+_0x1600da[_0x3f0e71(0x1b8)]);const _0x56f41f=(_0x1600da[_0x3f0e71(0x219)]+'.'+_0x1600da[_0x3f0e71(0x1c2)])['toLowerCase'](),_0x139c83=_0x4dc133[_0x3f0e71(0x172)](_0x56f41f);return{[constants_1[_0x3f0e71(0x226)]+_0x3f0e71(0x161)]:_0x3f0e71(0x1ad),[constants_1[_0x3f0e71(0x226)]+_0x3f0e71(0x169)]:_0x1600da[_0x3f0e71(0x1b8)]===status_enums_1[_0x3f0e71(0x1a7)][_0x3f0e71(0x1f8)]?'Success':_0x3f0e71(0x204),[constants_1[_0x3f0e71(0x226)]+'Result__c']:_0x3f0e71(0x1d9),[constants_1[_0x3f0e71(0x226)]+_0x3f0e71(0x186)]:_0x1600da[_0x3f0e71(0x1c2)],[constants_1[_0x3f0e71(0x226)]+_0x3f0e71(0x18b)]:_0x1600da[_0x3f0e71(0x219)],[constants_1['FLOSUM_NAMESPACE']+_0x3f0e71(0x201)]:this['_organisationId'],[constants_1[_0x3f0e71(0x226)]+_0x3f0e71(0x1fe)]:this[_0x3f0e71(0x1cb)],[constants_1[_0x3f0e71(0x226)]+_0x3f0e71(0x1eb)]:_0x139c83[_0x3f0e71(0x1c6)]};});}async['saveDeploymentResults'](_0x4f300a){const _0x44b47=a310_0x652658;this[_0x44b47(0x1fc)][_0x44b47(0x19c)](_0x44b47(0x215));const _0x4458f5=await salesforce_service_1['SalesforceService'][_0x44b47(0x19b)](this[_0x44b47(0x20a)],constants_1[_0x44b47(0x226)]+_0x44b47(0x217),_0x4f300a),_0x4a62b1=_0x4458f5[_0x44b47(0x171)](_0x33e4d9=>!_0x33e4d9[_0x44b47(0x153)])['map'](_0x131929=>_0x131929[_0x44b47(0x166)])[_0x44b47(0x1c0)]();if(_0x4a62b1[_0x44b47(0x1ba)])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x4a62b1);}async[a310_0x652658(0x224)](_0x594f13){const _0x416b2e=a310_0x652658;this['_logger']['logError'](_0x594f13),await this['_logger'][_0x416b2e(0x232)](),await this[_0x416b2e(0x1ef)](![],!![],'');}async['finishDeploy'](_0x10a951,_0x5d0b92,_0xda2dce){const _0x22ea7d=a310_0x652658,_0x41affc=_0x22ea7d(0x220)+this[_0x22ea7d(0x22a)]+'/'+this[_0x22ea7d(0x1cb)]+_0x22ea7d(0x1dd)+_0x22ea7d(0x1dc)+_0x22ea7d(0x194),_0xfa0fa5=_0x22ea7d(0x220)+this[_0x22ea7d(0x22a)]+'/'+this[_0x22ea7d(0x16c)]+'\x20>'+this[_0x22ea7d(0x1cd)]+_0x22ea7d(0x19a),_0x2bc853=_0x41affc+_0x22ea7d(0x18d)+_0xfa0fa5+_0x22ea7d(0x1e4),_0x2d402e={[constants_1['FLOSUM_NAMESPACE']+_0x22ea7d(0x222)]:_0x2bc853,[constants_1[_0x22ea7d(0x226)]+'Date__c']:new Date(),[constants_1[_0x22ea7d(0x226)]+_0x22ea7d(0x15f)]:this[_0x22ea7d(0x170)],[constants_1[_0x22ea7d(0x226)]+'Activity_Item__c']:'Branch',[constants_1[_0x22ea7d(0x226)]+_0x22ea7d(0x20e)]:_0x22ea7d(0x1d0),[constants_1[_0x22ea7d(0x226)]+_0x22ea7d(0x202)]:this['_organisationId']},_0x4466a8={[constants_1[_0x22ea7d(0x226)]+_0x22ea7d(0x1a4)]:!_0x10a951,[constants_1['FLOSUM_NAMESPACE']+'Succeed__c']:_0x10a951,[constants_1[_0x22ea7d(0x226)]+'Status__c']:_0x5d0b92?status_enums_1[_0x22ea7d(0x223)][_0x22ea7d(0x1b9)]:status_enums_1[_0x22ea7d(0x223)][_0x22ea7d(0x168)],[constants_1[_0x22ea7d(0x226)]+'Job_Completed__c']:!![],[constants_1[_0x22ea7d(0x226)]+'Process_Type__c']:flosum_constants_1[_0x22ea7d(0x185)][_0x22ea7d(0x198)],[constants_1['FLOSUM_NAMESPACE']+_0x22ea7d(0x1c9)]:_0xda2dce};await this[_0x22ea7d(0x20a)][_0x22ea7d(0x1b2)](flosum_constants_1['FlosumConstants']['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x22ea7d(0x226)]+_0x22ea7d(0x231)+this[_0x22ea7d(0x1cb)],_0x4466a8),await this[_0x22ea7d(0x20a)][_0x22ea7d(0x21f)](flosum_constants_1[_0x22ea7d(0x185)][_0x22ea7d(0x21e)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x22ea7d(0x16b),_0x2d402e),this[_0x22ea7d(0x1fc)][_0x22ea7d(0x19c)]('Deploy\x20completed\x20'+(_0x10a951?'successfully':_0x22ea7d(0x176))+'.'),await this[_0x22ea7d(0x1fc)]['updateLog']();}}exports[a310_0x652658(0x1e9)]=DeployService;