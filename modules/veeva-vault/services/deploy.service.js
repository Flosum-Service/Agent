const a311_0x5dad2f=a311_0x32cb;(function(_0x47d61d,_0x8f23b){const _0x37e523=a311_0x32cb,_0x451461=_0x47d61d();while(!![]){try{const _0x2ea280=parseInt(_0x37e523(0xfd))/0x1+parseInt(_0x37e523(0xde))/0x2+-parseInt(_0x37e523(0x7f))/0x3*(parseInt(_0x37e523(0x7a))/0x4)+-parseInt(_0x37e523(0xe7))/0x5*(-parseInt(_0x37e523(0x86))/0x6)+-parseInt(_0x37e523(0xf4))/0x7+-parseInt(_0x37e523(0x105))/0x8+-parseInt(_0x37e523(0x129))/0x9;if(_0x2ea280===_0x8f23b)break;else _0x451461['push'](_0x451461['shift']());}catch(_0x1f2cec){_0x451461['push'](_0x451461['shift']());}}}(a311_0x3ed5,0x77ab8));const a311_0x2771b8=(function(){let _0x38a7e8=!![];return function(_0x285e2d,_0xd6427e){const _0x448e6c=_0x38a7e8?function(){const _0x45b6d4=a311_0x32cb;if(_0xd6427e){const _0x1a06b0=_0xd6427e[_0x45b6d4(0x12d)](_0x285e2d,arguments);return _0xd6427e=null,_0x1a06b0;}}:function(){};return _0x38a7e8=![],_0x448e6c;};}()),a311_0x4fec77=a311_0x2771b8(this,function(){const _0x38f084=a311_0x32cb;return a311_0x4fec77[_0x38f084(0xff)]()[_0x38f084(0x77)](_0x38f084(0x108))[_0x38f084(0xff)]()['constructor'](a311_0x4fec77)['search'](_0x38f084(0x108));});a311_0x4fec77();'use strict';function a311_0x3ed5(){const _0x5aa46e=['multipart/form-data','getLogResultText','parse','artifacts','migration__v','Validation\x20Log','Save\x20log','Branch__c','Process_Type__c','683865pBrlAo','formPackageComponentList','Cannot\x20retrieve\x20all\x20attachments','RECREATE','_deploymentName','Wait\x20Executing\x20job','updateLog','generateVPK','url','869056dCWIYS','Get\x20validation\x20details.','toString','lastIndexOf','saveDeploymentResults','from','ComponentDto','Component_Type__c','6189024nsGuir','Deployment\x20Result','Deployment_Result__c','(((.+)+)+)+$','\x20</a>','includes','<a\x20href=','fetchAttachmentsDetailsByParentId','\x20of\x20branch\x20to\x20Organization\x20','veeva-deploy','__esModule','Job_Completed__c','_metadataLogId','_branchId','finishDeploy','map','Component_History__c','Status__c','href','saveLog','getJobResult','Result__c','DEPLOYED','attachmentLogId','writeFile','formFlosumDeploymentResults','componentIdList','type','post','form-data','MetadataLogStatus','Generate\x20vpk\x20package','VeevaJobStatus','default','retrieveAttachments','FlosumConstants','1564083dCTrhc','../constants/veeva.constants','Deploy','ENDPOINT_UPSERT_RECORD','apply','detailUrl','packageComponentList','reduce','updateVeevaConnection','retrieveComponents','file','./veeva.service','append','_connectionVeeva','importVpk','VeevaConstants','Metadata_Log__c','DEPLOYED_WITH_WARNINGS','filter','getJobStatus','../classes/errors/veeva-error','toLowerCase','Branch','buildObject','isDeployed','package_components','Cannot\x20retrieve\x20all\x20components.','execute','search','defineProperty','Logger','2908zDmmRU','replace','Retrieving\x20components','deploymentName','Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20','2901DLUXDb','flat','_componentIdList','length','deployPackage','errors','ENDPOINT_VALIDATE_PACKAGE','105318ZLLAGz','../utils/veeva-auth.utils','find','text','_organisationId','with\x20error','../classes/errors/salesforce-dml-error','isSuccess','createReadStream','joinAllAttachments','error','TargetId__c','name','files','endsWith','ENDPOINT_DEPLOY_PACKAGE','headers','responseStatus','packageId','null','Body','Save\x20Deployment\x20Results','_attachmentLogId','Get\x20deploy\x20result','Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20','Builder','put','COMPLETED','insertMultipleRecords','../../shared/utils/fetch-attachments','_timeZone','VeevaError','get','DeployService','Flosum','Retrieving\x20attachments','deployment_status__v','log','Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Deploy\x20package','Veeva\x20Deployment','status','_instanceUrl','../constants/flosum.constants','Org__c','Components__r\x20ORDER\x20BY\x20','../../../constants','Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20','fs/promises','../../../core','_systemLogger','_logger','values','Package\x20not\x20verified','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','set','Component_Name__c','ENDPOINT_EXPORT_IMPORT_PACKAGE','has','VERIFIED','getDeployDetailsAndSaveLog','Metadata_Log__c/','PackageComponentStatus','base64','links','timeZone','PROCESS_DEPLOYMENT','Deploy\x20completed\x20','/vpk__','../dtos/job-result.dto','nodebuffer','Is_Error__c','_organisationName','metadataLogId','rel','Import\x20package','EXCEPTION','VeevaResponseStatus','Failure','Log__c','\x20has\x20been\x20created.','_connectionSalesforce','SUCCESS','validateVpk','Deployment','logError','componentHistoryId','arraybuffer','1474646WQBAXa','Type__c','__importDefault','FLOSUM_NAMESPACE','Validation.log','filename','SalesforceService','_tempFolder','data','180yeqrTX','VeevaService','SalesforceDmlError','content-type'];a311_0x3ed5=function(){return _0x5aa46e;};return a311_0x3ed5();}var __importDefault=this&&this[a311_0x5dad2f(0xe0)]||function(_0x24462f){return _0x24462f&&_0x24462f['__esModule']?_0x24462f:{'default':_0x24462f};};Object[a311_0x5dad2f(0x78)](exports,a311_0x5dad2f(0x10f),{'value':!![]}),exports[a311_0x5dad2f(0xa7)]=void 0x0;const jszip_1=__importDefault(require('jszip')),form_data_1=__importDefault(require(a311_0x5dad2f(0x122))),fs_1=require('fs'),promises_1=require(a311_0x5dad2f(0xb6)),constants_1=require(a311_0x5dad2f(0xb4)),flosum_constants_1=require(a311_0x5dad2f(0xb1)),veeva_constants_1=require(a311_0x5dad2f(0x12a)),veeva_service_1=require(a311_0x5dad2f(0x134)),component_dto_1=require('../dtos/component.dto'),job_result_dto_1=require(a311_0x5dad2f(0xcb)),package_component_dto_1=require('../dtos/package-component.dto'),salesforce_service_1=require('./salesforce.service'),core_1=require(a311_0x5dad2f(0xb7)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a311_0x5dad2f(0x8c)),veeva_error_1=require(a311_0x5dad2f(0x13d)),shortid_1=__importDefault(require('shortid')),veeva_auth_utils_1=require(a311_0x5dad2f(0x87)),xml2js_1=require('xml2js'),fetch_attachments_1=require(a311_0x5dad2f(0xa3));class DeployService{constructor(_0x43a6a5,_0x4a1769,_0x4a0d74,_0x5969af,_0xf26fc1,_0x3e9295){const _0x22c459=a311_0x5dad2f;this[_0x22c459(0xd7)]=_0x4a1769,this['_connectionVeeva']=_0x4a0d74,this[_0x22c459(0xb9)]=_0x5969af,this[_0x22c459(0xe5)]=_0xf26fc1,this[_0x22c459(0xb0)]=_0x3e9295,this[_0x22c459(0x112)]=_0x43a6a5['branchId'],this[_0x22c459(0x111)]=_0x43a6a5[_0x22c459(0xcf)],this[_0x22c459(0x9c)]=_0x43a6a5[_0x22c459(0x11c)],this['_organisationId']=_0x43a6a5['organisationId'],this[_0x22c459(0xa4)]=_0x43a6a5[_0x22c459(0xc7)],this[_0x22c459(0xce)]=_0x43a6a5['organisationName'],this[_0x22c459(0x81)]=_0x43a6a5[_0x22c459(0x11f)],this[_0x22c459(0xf8)]=_0x43a6a5[_0x22c459(0x7d)],this[_0x22c459(0xb8)]=new core_1[(_0x22c459(0x79))](_0x22c459(0x10e));}async[a311_0x5dad2f(0x76)](){const _0x16944c=a311_0x5dad2f;try{const _0xe4ffec=await this[_0x16944c(0x132)](),_0xb01c46=await this[_0x16944c(0x127)](_0xe4ffec),_0x276ea2=await this['joinAllAttachments'](_0xb01c46),_0x198395=await this['generateVPK'](_0x276ea2);await this[_0x16944c(0xd9)](_0x198395);const _0x13119d=await this[_0x16944c(0x137)](_0x198395),_0x5af33b=await this[_0x16944c(0x13c)](_0x13119d);await this['getValidationDetailsAndSaveLog'](_0x5af33b);const _0x18db8a=await this[_0x16944c(0x83)](_0x5af33b[_0x16944c(0x98)]),_0x107d9f=await this['getJobStatus'](_0x18db8a);await this['getDeployDetailsAndSaveLog'](_0x107d9f);const _0x3e29cb=this[_0x16944c(0x11e)](_0xe4ffec,_0x107d9f['packageComponentList']);await this[_0x16944c(0x101)](_0x3e29cb),await this[_0x16944c(0x113)](_0x107d9f[_0x16944c(0x73)],![],_0x5af33b['packageId']);}catch(_0xd375db){await this['finishDeployWithError'](_0xd375db)['catch'](_0x693b34=>this[_0x16944c(0xb8)][_0x16944c(0x90)](_0x693b34));}}async['retrieveComponents'](){const _0x532a46=a311_0x5dad2f,_0x8192b2=new Set(this[_0x532a46(0x81)]);this['_logger'][_0x532a46(0xab)](_0x532a46(0x7c));const _0x1dae17=_0x532a46(0xbc)+constants_1[_0x532a46(0xe1)]+_0x532a46(0xac)+constants_1[_0x532a46(0xe1)]+_0x532a46(0x7e)+constants_1[_0x532a46(0xe1)]+_0x532a46(0xb3)+constants_1[_0x532a46(0xe1)]+_0x532a46(0x9e)+constants_1[_0x532a46(0xe1)]+_0x532a46(0xb5)+constants_1[_0x532a46(0xe1)]+'Branch__c\x20=\x20\x27'+this[_0x532a46(0x112)]+'\x27',_0x2f7031=await salesforce_service_1[_0x532a46(0xe4)]['retrieveRecords'](this[_0x532a46(0xd7)],_0x1dae17);if(!_0x2f7031[_0x532a46(0x82)])throw new Error(_0x532a46(0x75));const _0x50bec9=_0x2f7031[_0x532a46(0x114)](_0x39dc5a=>new component_dto_1[(_0x532a46(0x103))](_0x39dc5a))[_0x532a46(0x13b)](_0x56c0a1=>_0x8192b2[_0x532a46(0xc0)](_0x56c0a1['id']));if(_0x50bec9[_0x532a46(0x82)]!==this[_0x532a46(0x81)][_0x532a46(0x82)])throw new Error(_0x532a46(0x75));return _0x50bec9;}async[a311_0x5dad2f(0x127)](_0x5c1819){const _0xe2ce85=a311_0x5dad2f;this[_0xe2ce85(0xb9)][_0xe2ce85(0xab)](_0xe2ce85(0xa9));const _0x177b08=await(0x0,fetch_attachments_1[_0xe2ce85(0x10c)])(this['_connectionSalesforce'],_0x5c1819['map'](_0x2a7a3f=>_0x2a7a3f['componentHistoryId'])),_0x57f4ca=await(0x0,fetch_attachments_1[_0xe2ce85(0x127)])(_0x177b08,this[_0xe2ce85(0xd7)]);if(_0x57f4ca[_0xe2ce85(0x82)]!==this[_0xe2ce85(0x81)][_0xe2ce85(0x82)])throw new Error(_0xe2ce85(0xf6));return _0x57f4ca[_0xe2ce85(0x114)](_0xbf64cf=>_0xbf64cf[_0xe2ce85(0xba)][_0xe2ce85(0x9a)]);}async[a311_0x5dad2f(0x8f)](_0xa80ca1){const _0x3eb72d=a311_0x5dad2f;var _0xe62bfe;this[_0x3eb72d(0xb9)][_0x3eb72d(0xab)]('Join\x20all\x20mdl\x20into\x20one\x20zip');const _0x32ae6f=new jszip_1['default']();for(const _0xf0adc6 of _0xa80ca1){const _0x5ab7c0=new jszip_1[(_0x3eb72d(0x126))]();await _0x5ab7c0['loadAsync'](_0xf0adc6,{'base64':!![]});for(const _0x291d0c in _0x5ab7c0[_0x3eb72d(0x93)]){const _0x27fa74=await((_0xe62bfe=_0x5ab7c0['file'](_0x291d0c))===null||_0xe62bfe===void 0x0?void 0x0:_0xe62bfe['async']('string'));_0x27fa74&&_0x32ae6f[_0x3eb72d(0x133)](_0x291d0c,_0x27fa74);}}const _0xe903bc=new xml2js_1[(_0x3eb72d(0x9f))]({'headless':!![]}),_0x363b1e={'vaultpackage':{'$':{'xmlns':'https://veevavault.com/'},'name':this[_0x3eb72d(0xf8)],'source':{'vault':undefined,'author':_0x3eb72d(0xa8)},'packagetype':_0x3eb72d(0xef),'summary':_0x3eb72d(0x12b),'description':_0x3eb72d(0x99)}};_0x32ae6f['file']('vaultpackage.xml',_0xe903bc[_0x3eb72d(0x72)](_0x363b1e));const _0x29999d=this[_0x3eb72d(0xe5)]+'/'+(0x0,shortid_1[_0x3eb72d(0x126)])()+'.zip',_0x5c0e09=await _0x32ae6f['generateAsync']({'type':_0x3eb72d(0xcc)});return await(0x0,promises_1[_0x3eb72d(0x11d)])(_0x29999d,_0x5c0e09),_0x29999d;}async['generateVPK'](_0x48eff2,_0x309967=0x1){const _0x4002eb=a311_0x5dad2f;var _0x2bcbd4;this[_0x4002eb(0xb9)][_0x4002eb(0xab)](_0x4002eb(0x124));const _0x356eae=new form_data_1[(_0x4002eb(0x126))]();_0x356eae[_0x4002eb(0x135)]('file',(0x0,fs_1[_0x4002eb(0x8e)])(_0x48eff2));const _0x464b42=await this['_connectionVeeva'][_0x4002eb(0x121)](veeva_constants_1[_0x4002eb(0x138)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x356eae,{'responseType':_0x4002eb(0xdd),'headers':{'Content-Type':_0x4002eb(0xeb)}}),_0x15fae6=(_0x2bcbd4=_0x464b42[_0x4002eb(0x96)][_0x4002eb(0xea)])===null||_0x2bcbd4===void 0x0?void 0x0:_0x2bcbd4[_0x4002eb(0x10a)]('application/json');if(!_0x15fae6){const _0xee130c=_0x464b42[_0x4002eb(0xe6)],_0x1f6fbe=this['_tempFolder']+_0x4002eb(0xca)+_0x48eff2['slice'](_0x48eff2[_0x4002eb(0x100)]('/')+0x1);return await(0x0,promises_1['writeFile'])(_0x1f6fbe,_0xee130c),_0x1f6fbe;}else{const _0x63f5ce=JSON[_0x4002eb(0xed)](_0x464b42[_0x4002eb(0xe6)]);if(_0x309967>0x0)return await(0x0,veeva_auth_utils_1[_0x4002eb(0x131)])(this[_0x4002eb(0x136)]),await this[_0x4002eb(0xfb)](_0x48eff2,_0x309967-0x1);throw new veeva_error_1[(_0x4002eb(0xa5))](_0x63f5ce[_0x4002eb(0x84)]);}}async['validateVpk'](_0x152caa,_0x3fda0a=0x1){const _0x4fafb0=a311_0x5dad2f;this['_logger'][_0x4fafb0(0xab)]('Validate\x20package');const _0x36f9dc=new form_data_1[(_0x4fafb0(0x126))]();_0x36f9dc[_0x4fafb0(0x135)](_0x4fafb0(0x133),(0x0,fs_1[_0x4fafb0(0x8e)])(_0x152caa));const _0x3f01cc=await this[_0x4fafb0(0x136)]['post'](veeva_constants_1['VeevaConstants'][_0x4fafb0(0x85)],_0x36f9dc,{'headers':{'Content-Type':'multipart/form-data'}}),_0x50b3d0=_0x3f01cc[_0x4fafb0(0xe6)];if(_0x50b3d0[_0x4fafb0(0x97)]===status_enums_1[_0x4fafb0(0xd3)][_0x4fafb0(0xd8)])return _0x50b3d0;else{if(_0x3fda0a>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x4fafb0(0x136)]),await this[_0x4fafb0(0xd9)](_0x152caa,_0x3fda0a-0x1);throw new veeva_error_1[(_0x4fafb0(0xa5))](_0x50b3d0[_0x4fafb0(0x84)]);}}async[a311_0x5dad2f(0x137)](_0x4eec03,_0x5415d2=0x1){const _0x207a5d=a311_0x5dad2f;this[_0x207a5d(0xb9)][_0x207a5d(0xab)](_0x207a5d(0xd1));const _0x65242=new form_data_1[(_0x207a5d(0x126))]();_0x65242[_0x207a5d(0x135)](_0x207a5d(0x133),(0x0,fs_1[_0x207a5d(0x8e)])(_0x4eec03));const _0x504db2=await this[_0x207a5d(0x136)][_0x207a5d(0xa0)](veeva_constants_1[_0x207a5d(0x138)][_0x207a5d(0xbf)],_0x65242,{'headers':{'Content-Type':_0x207a5d(0xeb)}}),_0x1c0db9=_0x504db2[_0x207a5d(0xe6)];if(_0x1c0db9['responseStatus']===status_enums_1[_0x207a5d(0xd3)]['SUCCESS'])return _0x1c0db9[_0x207a5d(0xfc)];else{if(_0x5415d2>0x0)return await(0x0,veeva_auth_utils_1[_0x207a5d(0x131)])(this[_0x207a5d(0x136)]),await this[_0x207a5d(0x137)](_0x4eec03,_0x5415d2-0x1);throw new veeva_error_1['VeevaError'](_0x1c0db9['errors']);}}async[a311_0x5dad2f(0x83)](_0x245dd2){const _0x165350=a311_0x5dad2f;this['_logger'][_0x165350(0xab)](_0x165350(0xad));const _0x1129c1=await this[_0x165350(0x136)][_0x165350(0x121)](veeva_constants_1['VeevaConstants'][_0x165350(0x95)][_0x165350(0x7b)]('{package_id}',_0x245dd2)),_0x487163=await _0x1129c1[_0x165350(0xe6)];if(_0x487163[_0x165350(0x97)]===status_enums_1[_0x165350(0xd3)][_0x165350(0xd8)])return _0x487163['url'];else throw new veeva_error_1['VeevaError'](_0x487163['errors']);}async[a311_0x5dad2f(0x13c)](_0x463709){const _0x42f414=a311_0x5dad2f;this[_0x42f414(0xb9)][_0x42f414(0xab)](_0x42f414(0xf9));const _0x7a0ae0=new job_result_dto_1['JobResultDto'](),[_0x44bc47]=await veeva_service_1[_0x42f414(0xe8)][_0x42f414(0x119)]([_0x463709],this[_0x42f414(0x136)],this[_0x42f414(0xb9)]);return _0x7a0ae0[_0x42f414(0x8d)]=_0x44bc47[_0x42f414(0xaf)]===status_enums_1[_0x42f414(0x125)]['SUCCESS'],_0x7a0ae0[_0x42f414(0x12e)]=_0x44bc47[_0x42f414(0xc6)][_0x42f414(0x88)](_0x32d2c5=>_0x32d2c5[_0x42f414(0xd0)]===_0x42f414(0xee))[_0x42f414(0x117)],_0x7a0ae0;}async['getValidationDetailsAndSaveLog'](_0x11fa28){const _0x580956=a311_0x5dad2f;this[_0x580956(0xb9)][_0x580956(0xab)](_0x580956(0xfe));const {data:_0x5111b0}=await this[_0x580956(0x136)]['get'](_0x11fa28[_0x580956(0x12e)]);if(_0x5111b0[_0x580956(0x97)]===status_enums_1['VeevaResponseStatus'][_0x580956(0xd8)]){const {log:_0x2a8904,id:_0xc379f1,package_status:_0x1eeae8}=_0x5111b0['vaultPackage'],_0x5eae78=_0x2a8904['filter'](_0x2642ba=>_0x2642ba[_0x580956(0xe3)][_0x580956(0x94)](_0x580956(0xe2))),_0x4a66ec=await this[_0x580956(0xec)](_0x5eae78[0x0][_0x580956(0xfc)]);await this[_0x580956(0x118)](_0x4a66ec,_0x580956(0xf0)),_0x11fa28[_0x580956(0x98)]=_0xc379f1;if(_0x1eeae8!==status_enums_1['VeevaPackageStatus'][_0x580956(0xc1)])throw new Error(_0x580956(0xbb));}else throw new veeva_error_1[(_0x580956(0xa5))](_0x5111b0[_0x580956(0x84)]);}async[a311_0x5dad2f(0xc2)](_0xe5b23b){const _0x5a8f80=a311_0x5dad2f;this[_0x5a8f80(0xb9)][_0x5a8f80(0xab)](_0x5a8f80(0x9d));const {data:_0x6fadf2}=await this[_0x5a8f80(0x136)]['get'](_0xe5b23b['detailUrl']);if(_0x6fadf2[_0x5a8f80(0x97)]===status_enums_1[_0x5a8f80(0xd3)][_0x5a8f80(0xd8)]){const {responseDetails:{deployment_log:_0x2cde12,package_status__v:_0x1be4da},package_steps:_0x3eff05}=_0x6fadf2,_0x5b9ad7=_0x2cde12[_0x5a8f80(0x13b)](_0x26d25a=>_0x26d25a[_0x5a8f80(0xe3)][_0x5a8f80(0x94)]('Deployment.log')),_0x9c8003=await this['getLogResultText'](_0x5b9ad7[0x0][_0x5a8f80(0xfc)]);await this[_0x5a8f80(0x118)](_0x9c8003,'Deploy\x20Log'),_0xe5b23b[_0x5a8f80(0x73)]=[status_enums_1['VeevaPackageStatus'][_0x5a8f80(0x11b)],status_enums_1['VeevaPackageStatus'][_0x5a8f80(0x13a)]][_0x5a8f80(0x10a)](_0x1be4da);const _0x481eaf=this[_0x5a8f80(0xf5)](_0x3eff05);_0xe5b23b[_0x5a8f80(0x12f)]=_0x481eaf[_0x5a8f80(0x13b)](_0xd94b23=>_0xd94b23[_0x5a8f80(0xaf)]!==status_enums_1[_0x5a8f80(0xc4)]['VERIFIED']);if(!_0xe5b23b['packageComponentList'][_0x5a8f80(0x82)])throw new Error('Cannot\x20find\x20deployment\x20results');}else throw new veeva_error_1[(_0x5a8f80(0xa5))](_0x6fadf2[_0x5a8f80(0x84)]);}async[a311_0x5dad2f(0xec)](_0x255ade){const _0x7c7ad8=a311_0x5dad2f,{data:_0x393650}=await this[_0x7c7ad8(0x136)]['get'](_0x255ade,{'responseType':_0x7c7ad8(0x89)});return _0x393650;}[a311_0x5dad2f(0xf5)](_0x2d0a34){const _0x1758be=a311_0x5dad2f;return _0x2d0a34[_0x1758be(0x130)]((_0x47e582,_0x24acbf)=>{const _0x1ebb21=_0x1758be,_0x14e6c9=_0x24acbf[_0x1ebb21(0x74)][_0x1ebb21(0x114)](_0x5e7272=>new package_component_dto_1['PackageComponentDto'](_0x5e7272,_0x24acbf[_0x1ebb21(0xaa)]));return[..._0x47e582,..._0x14e6c9];},[]);}async[a311_0x5dad2f(0x118)](_0x4a4380,_0x291a95){const _0x2a7134=a311_0x5dad2f;this[_0x2a7134(0xb9)][_0x2a7134(0xab)](_0x2a7134(0xf1));const _0x335606={'Body':Buffer[_0x2a7134(0x102)](_0x4a4380)[_0x2a7134(0xff)](_0x2a7134(0xc5)),'ContentType':'text/plain','ParentId':this['_metadataLogId'],'Name':_0x291a95},{data:_0x561cd3}=await this[_0x2a7134(0xd7)][_0x2a7134(0x121)](flosum_constants_1[_0x2a7134(0x128)][_0x2a7134(0x12c)]+'/Attachment',_0x335606);return _0x561cd3['id'];}[a311_0x5dad2f(0x11e)](_0x4ef1a8,_0x3bd38d){const _0x112fd4=a311_0x5dad2f;this[_0x112fd4(0xb9)][_0x112fd4(0xab)]('Form\x20Deployment\x20Results');const _0x7fbd4a=_0x4ef1a8[_0x112fd4(0x130)]((_0x2e28f1,_0x1895ec)=>_0x2e28f1[_0x112fd4(0xbd)]((_0x1895ec['componentType']+'.'+_0x1895ec['componentName'])['toLowerCase'](),_0x1895ec),new Map());return _0x3bd38d[_0x112fd4(0x114)](_0x281a18=>{const _0x35da92=_0x112fd4;this[_0x35da92(0xb9)][_0x35da92(0xab)](_0x281a18[_0x35da92(0x120)]+'.'+_0x281a18[_0x35da92(0x92)]+'\x20:\x20'+_0x281a18[_0x35da92(0xaf)]);const _0x44b06f=(_0x281a18[_0x35da92(0x120)]+'.'+_0x281a18[_0x35da92(0x92)])[_0x35da92(0x13e)](),_0x36ab11=_0x7fbd4a[_0x35da92(0xa6)](_0x44b06f);return{[constants_1[_0x35da92(0xe1)]+_0x35da92(0xdf)]:_0x35da92(0x106),[constants_1['FLOSUM_NAMESPACE']+'Status__c']:_0x281a18[_0x35da92(0xaf)]===status_enums_1[_0x35da92(0xc4)]['DEPLOYED']?'Success':_0x35da92(0xd4),[constants_1['FLOSUM_NAMESPACE']+_0x35da92(0x11a)]:_0x35da92(0xf7),[constants_1[_0x35da92(0xe1)]+_0x35da92(0xbe)]:_0x281a18[_0x35da92(0x92)],[constants_1[_0x35da92(0xe1)]+_0x35da92(0x104)]:_0x281a18[_0x35da92(0x120)],[constants_1[_0x35da92(0xe1)]+_0x35da92(0xb2)]:this['_organisationId'],[constants_1['FLOSUM_NAMESPACE']+_0x35da92(0x139)]:this[_0x35da92(0x111)],[constants_1[_0x35da92(0xe1)]+_0x35da92(0x115)]:_0x36ab11[_0x35da92(0xdc)]};});}async[a311_0x5dad2f(0x101)](_0x21c64a){const _0xdd290=a311_0x5dad2f;this[_0xdd290(0xb9)][_0xdd290(0xab)](_0xdd290(0x9b));const _0x28e341=await salesforce_service_1['SalesforceService'][_0xdd290(0xa2)](this[_0xdd290(0xd7)],constants_1['FLOSUM_NAMESPACE']+_0xdd290(0x107),_0x21c64a),_0x119db7=_0x28e341['filter'](_0xd7ce79=>!_0xd7ce79['success'])[_0xdd290(0x114)](_0x51d74f=>_0x51d74f[_0xdd290(0x84)])[_0xdd290(0x80)]();if(_0x119db7[_0xdd290(0x82)])throw new salesforce_dml_error_1[(_0xdd290(0xe9))](_0x119db7);}async['finishDeployWithError'](_0x754c71){const _0x31049c=a311_0x5dad2f;this['_logger'][_0x31049c(0xdb)](_0x754c71),await this['_logger']['updateLog'](),await this[_0x31049c(0x113)](![],!![],'');}async[a311_0x5dad2f(0x113)](_0x4e3067,_0x4c26a0,_0xf1027){const _0x569482=a311_0x5dad2f,_0x36b59b=_0x569482(0x10b)+this[_0x569482(0xb0)]+'/'+this[_0x569482(0x111)]+'\x20>\x20'+_0x569482(0xae)+_0x569482(0x109),_0x393b02='<a\x20href='+this[_0x569482(0xb0)]+'/'+this[_0x569482(0x8a)]+'\x20>'+this[_0x569482(0xce)]+'</a>',_0x2a8d08=_0x36b59b+_0x569482(0x10d)+_0x393b02+_0x569482(0xd6),_0x3e27e4={[constants_1[_0x569482(0xe1)]+'Action__c']:_0x2a8d08,[constants_1['FLOSUM_NAMESPACE']+'Date__c']:new Date(),[constants_1[_0x569482(0xe1)]+_0x569482(0xf2)]:this[_0x569482(0x112)],[constants_1[_0x569482(0xe1)]+'Activity_Item__c']:_0x569482(0x71),[constants_1[_0x569482(0xe1)]+'Activity_Type__c']:_0x569482(0xda),[constants_1[_0x569482(0xe1)]+_0x569482(0x91)]:this[_0x569482(0x8a)]},_0x5ac14f={[constants_1[_0x569482(0xe1)]+_0x569482(0xcd)]:!_0x4e3067,[constants_1[_0x569482(0xe1)]+'Succeed__c']:_0x4e3067,[constants_1['FLOSUM_NAMESPACE']+_0x569482(0x116)]:_0x4c26a0?status_enums_1[_0x569482(0x123)][_0x569482(0xd2)]:status_enums_1[_0x569482(0x123)][_0x569482(0xa1)],[constants_1[_0x569482(0xe1)]+_0x569482(0x110)]:!![],[constants_1[_0x569482(0xe1)]+_0x569482(0xf3)]:flosum_constants_1[_0x569482(0x128)][_0x569482(0xc8)],[constants_1[_0x569482(0xe1)]+'Async_Request_Id__c']:_0xf1027};await this[_0x569482(0xd7)]['patch'](flosum_constants_1[_0x569482(0x128)][_0x569482(0x12c)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x569482(0xc3)+this[_0x569482(0x111)],_0x5ac14f),await this[_0x569482(0xd7)][_0x569482(0x121)](flosum_constants_1[_0x569482(0x128)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x569482(0xe1)]+_0x569482(0xd5),_0x3e27e4),this[_0x569482(0xb9)][_0x569482(0xab)](_0x569482(0xc9)+(_0x4e3067?'successfully':_0x569482(0x8b))+'.'),await this[_0x569482(0xb9)][_0x569482(0xfa)]();}}function a311_0x32cb(_0x54a37c,_0x504ab7){const _0x5669e9=a311_0x3ed5();return a311_0x32cb=function(_0x4fec77,_0x2771b8){_0x4fec77=_0x4fec77-0x71;let _0x3ed50b=_0x5669e9[_0x4fec77];return _0x3ed50b;},a311_0x32cb(_0x54a37c,_0x504ab7);}exports[a311_0x5dad2f(0xa7)]=DeployService;