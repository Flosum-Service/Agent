const a257_0x4bae9d=a257_0x38c7;(function(_0x2fe3ec,_0x285891){const _0x7dd194=a257_0x38c7,_0x6e37b8=_0x2fe3ec();while(!![]){try{const _0x3aea36=-parseInt(_0x7dd194(0x229))/0x1*(-parseInt(_0x7dd194(0x29c))/0x2)+-parseInt(_0x7dd194(0x284))/0x3*(parseInt(_0x7dd194(0x2a5))/0x4)+parseInt(_0x7dd194(0x275))/0x5+-parseInt(_0x7dd194(0x215))/0x6+-parseInt(_0x7dd194(0x20c))/0x7*(-parseInt(_0x7dd194(0x286))/0x8)+-parseInt(_0x7dd194(0x203))/0x9*(parseInt(_0x7dd194(0x1f0))/0xa)+parseInt(_0x7dd194(0x1d6))/0xb;if(_0x3aea36===_0x285891)break;else _0x6e37b8['push'](_0x6e37b8['shift']());}catch(_0xdb9fc6){_0x6e37b8['push'](_0x6e37b8['shift']());}}}(a257_0x549c,0x1a661));const a257_0x397e42=(function(){let _0x37e0da=!![];return function(_0x34b692,_0x34f883){const _0x1e5e96=_0x37e0da?function(){const _0x33f040=a257_0x38c7;if(_0x34f883){const _0x22f6f2=_0x34f883[_0x33f040(0x2a3)](_0x34b692,arguments);return _0x34f883=null,_0x22f6f2;}}:function(){};return _0x37e0da=![],_0x1e5e96;};}()),a257_0x5d5a2f=a257_0x397e42(this,function(){const _0x5cbdbe=a257_0x38c7;return a257_0x5d5a2f[_0x5cbdbe(0x208)]()[_0x5cbdbe(0x207)](_0x5cbdbe(0x268))[_0x5cbdbe(0x208)]()['constructor'](a257_0x5d5a2f)[_0x5cbdbe(0x207)](_0x5cbdbe(0x268));});a257_0x5d5a2f();'use strict';var __importDefault=this&&this[a257_0x4bae9d(0x26a)]||function(_0x3e2f56){const _0xaf59c4=a257_0x4bae9d;return _0x3e2f56&&_0x3e2f56[_0xaf59c4(0x285)]?_0x3e2f56:{'default':_0x3e2f56};};Object[a257_0x4bae9d(0x25b)](exports,'__esModule',{'value':!![]}),exports[a257_0x4bae9d(0x1e2)]=void 0x0;function a257_0x549c(){const _0x489d9f=['deployPackage','Deploy','default','../constants/flosum.constants','href','287346zHIRvR','Log__c','Validation\x20Log','string','async','_organisationId','replace','formFlosumDeploymentResults','loadAsync','finishDeployWithError','multipart/form-data','_instanceUrl','filter','_connectionSalesforce','Get\x20validation\x20details.','Succeed__c','Component_Type__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(SELECT\x20Id\x20FROM\x20','insertMultipleRecords','retrieveRecords','Cannot\x20find\x20deployment\x20results','14167KQXnOb','reduce','catch','slice','Logger','componentIdList','getLogResultText','Branch','../../../core','VeevaPackageStatus','Veeva\x20Deployment','_attachmentLogId','text/plain','Cannot\x20retrieve\x20all\x20attachments','error','Builder','branchId','</a>','updateLog','formPackageComponentList','Async_Request_Id__c','\x20:\x20','retrieveComponents','joinAllAttachments','../../../constants','ENDPOINT_UPSERT_RECORD','responseStatus','jszip','Failure','headers','Job_Completed__c','../constants/veeva.constants','\x20>\x20','Validation.log','buildObject','Body','Form\x20Deployment\x20Results','Activity_Item__c','map','Metadata_Log__c','VeevaService','Deployment\x20Result','fetchAttachmentsDetailsByParentId','_componentIdList','Status__c','get','../../shared/utils/fetch-attachments','packageId','RECREATE','successfully','defineProperty','append','Save\x20Deployment\x20Results','base64','fs/promises','PackageComponentStatus','_deploymentName','links','ENDPOINT_EXPORT_IMPORT_PACKAGE','organisationId','form-data','getDeployDetailsAndSaveLog','Deployment','(((.+)+)+)+$','arraybuffer','__importDefault','importVpk','../enums/status.enums','/Attachment','getJobResult','_logger','isDeployed','_timeZone','Wait\x20Executing\x20job','finishDeploy','name','145615dgmNIM','ENDPOINT_DEPLOY_PACKAGE','Deploy\x20package','Process_Type__c','Join\x20all\x20mdl\x20into\x20one\x20zip','PackageComponentDto','componentHistoryId','type','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','_tempFolder','Import\x20package','url','../classes/errors/veeva-error','application/json','metadataLogId','27uYdJIN','__esModule','152HQglnW','Component_History__c','SalesforceService','timeZone','Org__c','Is_Error__c','retrieveAttachments','componentType','Version__c\x20DESC\x20LIMIT\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20','<a\x20href=','componentName','packageComponentList','data','VeevaResponseStatus','Date__c','xml2js','post','../dtos/job-result.dto','Retrieving\x20components','vaultPackage','generateAsync','veeva-deploy','12uNObau','logError','validateVpk','nodebuffer','../classes/errors/salesforce-dml-error','_branchId','generateVPK','apply','from','94652qmztmB','JobResultDto','Generate\x20vpk\x20package','createReadStream','TargetId__c','isSuccess','Save\x20log','FLOSUM_NAMESPACE','includes','text','2818453DNrkka','_systemLogger','Validate\x20package','VERIFIED','length','VeevaConstants','patch','.zip','file','Component_Type__c','Get\x20deploy\x20result','Deployment_Result__c','DeployService','../utils/veeva-auth.utils','saveDeploymentResults','VeevaError','MetadataLogStatus','put','\x20of\x20branch\x20to\x20Organization\x20','artifacts','{package_id}','updateVeevaConnection','status','_metadataLogId','null','Component_Name__c,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','90aTTEme','endsWith','getJobStatus','_organisationName','set','execute','Components__r\x20ORDER\x20BY\x20','success','saveLog','_connectionVeeva','ComponentDto','PROCESS_DEPLOYMENT','Deploy\x20Log','FlosumConstants','filename','has','Branch__c\x20=\x20\x27','../dtos/component.dto','flat','214731ftntDb','DEPLOYED','COMPLETED','errors','search','toString','Action__c','SUCCESS','detailUrl','78610wPOsgk','Component__c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20','log','Cannot\x20retrieve\x20all\x20components.'];a257_0x549c=function(){return _0x489d9f;};return a257_0x549c();}function a257_0x38c7(_0x5549e2,_0x1cd021){const _0x4c4e07=a257_0x549c();return a257_0x38c7=function(_0x5d5a2f,_0x397e42){_0x5d5a2f=_0x5d5a2f-0x1cd;let _0x549ce7=_0x4c4e07[_0x5d5a2f];return _0x549ce7;},a257_0x38c7(_0x5549e2,_0x1cd021);}const jszip_1=__importDefault(require(a257_0x4bae9d(0x244))),form_data_1=__importDefault(require(a257_0x4bae9d(0x265))),fs_1=require('fs'),promises_1=require(a257_0x4bae9d(0x25f)),constants_1=require(a257_0x4bae9d(0x241)),flosum_constants_1=require(a257_0x4bae9d(0x213)),veeva_constants_1=require(a257_0x4bae9d(0x248)),veeva_service_1=require('./veeva.service'),component_dto_1=require(a257_0x4bae9d(0x201)),job_result_dto_1=require(a257_0x4bae9d(0x297)),package_component_dto_1=require('../dtos/package-component.dto'),salesforce_service_1=require('./salesforce.service'),core_1=require(a257_0x4bae9d(0x231)),status_enums_1=require(a257_0x4bae9d(0x26c)),salesforce_dml_error_1=require(a257_0x4bae9d(0x2a0)),veeva_error_1=require(a257_0x4bae9d(0x281)),shortid_1=__importDefault(require('shortid')),veeva_auth_utils_1=require(a257_0x4bae9d(0x1e3)),xml2js_1=require(a257_0x4bae9d(0x295)),fetch_attachments_1=require(a257_0x4bae9d(0x257));class DeployService{constructor(_0x46163b,_0x20483b,_0x4a2105,_0x2a2a29,_0x48cb43,_0x544fcb){const _0x29ef6c=a257_0x4bae9d;this['_connectionSalesforce']=_0x20483b,this['_connectionVeeva']=_0x4a2105,this[_0x29ef6c(0x26f)]=_0x2a2a29,this[_0x29ef6c(0x27e)]=_0x48cb43,this[_0x29ef6c(0x220)]=_0x544fcb,this[_0x29ef6c(0x2a1)]=_0x46163b[_0x29ef6c(0x239)],this[_0x29ef6c(0x1ed)]=_0x46163b[_0x29ef6c(0x283)],this[_0x29ef6c(0x234)]=_0x46163b['attachmentLogId'],this[_0x29ef6c(0x21a)]=_0x46163b[_0x29ef6c(0x264)],this[_0x29ef6c(0x271)]=_0x46163b[_0x29ef6c(0x289)],this[_0x29ef6c(0x1f3)]=_0x46163b['organisationName'],this[_0x29ef6c(0x254)]=_0x46163b[_0x29ef6c(0x22e)],this[_0x29ef6c(0x261)]=_0x46163b['deploymentName'],this[_0x29ef6c(0x1d7)]=new core_1[(_0x29ef6c(0x22d))](_0x29ef6c(0x29b));}async[a257_0x4bae9d(0x1f5)](){const _0x4c57b5=a257_0x4bae9d;try{const _0x2b81b3=await this[_0x4c57b5(0x23f)](),_0x1afeb8=await this['retrieveAttachments'](_0x2b81b3),_0x550346=await this[_0x4c57b5(0x240)](_0x1afeb8),_0x2e0433=await this[_0x4c57b5(0x2a2)](_0x550346);await this[_0x4c57b5(0x29e)](_0x2e0433);const _0x8a9b53=await this[_0x4c57b5(0x26b)](_0x2e0433),_0x1b5f57=await this['getJobStatus'](_0x8a9b53);await this['getValidationDetailsAndSaveLog'](_0x1b5f57);const _0x303377=await this[_0x4c57b5(0x210)](_0x1b5f57[_0x4c57b5(0x258)]),_0x2c351a=await this[_0x4c57b5(0x1f2)](_0x303377);await this[_0x4c57b5(0x266)](_0x2c351a);const _0x329bff=this[_0x4c57b5(0x21c)](_0x2b81b3,_0x2c351a[_0x4c57b5(0x291)]);await this[_0x4c57b5(0x1e4)](_0x329bff),await this[_0x4c57b5(0x273)](_0x2c351a[_0x4c57b5(0x270)],![],_0x1b5f57[_0x4c57b5(0x258)]);}catch(_0x5288b3){await this[_0x4c57b5(0x21e)](_0x5288b3)[_0x4c57b5(0x22b)](_0x4a198d=>this[_0x4c57b5(0x1d7)][_0x4c57b5(0x237)](_0x4a198d));}}async[a257_0x4bae9d(0x23f)](){const _0x50e728=a257_0x4bae9d,_0x1dbaa9=new Set(this[_0x50e728(0x254)]);this[_0x50e728(0x26f)][_0x50e728(0x20e)](_0x50e728(0x298));const _0x442cbf=_0x50e728(0x27d)+constants_1['FLOSUM_NAMESPACE']+_0x50e728(0x1ef)+constants_1[_0x50e728(0x1d3)]+_0x50e728(0x225)+constants_1['FLOSUM_NAMESPACE']+_0x50e728(0x1f6)+constants_1[_0x50e728(0x1d3)]+_0x50e728(0x28e)+constants_1['FLOSUM_NAMESPACE']+_0x50e728(0x20d)+constants_1[_0x50e728(0x1d3)]+_0x50e728(0x200)+this['_branchId']+'\x27',_0x4991f8=await salesforce_service_1[_0x50e728(0x288)][_0x50e728(0x227)](this[_0x50e728(0x222)],_0x442cbf);if(!_0x4991f8[_0x50e728(0x1da)])throw new Error(_0x50e728(0x20f));const _0x1e2ac4=_0x4991f8['map'](_0x4f1a90=>new component_dto_1[(_0x50e728(0x1fa))](_0x4f1a90))['filter'](_0x146219=>_0x1dbaa9[_0x50e728(0x1ff)](_0x146219['id']));if(_0x1e2ac4[_0x50e728(0x1da)]!==this['_componentIdList'][_0x50e728(0x1da)])throw new Error(_0x50e728(0x20f));return _0x1e2ac4;}async['retrieveAttachments'](_0x1fda6f){const _0x1b1efb=a257_0x4bae9d;this['_logger'][_0x1b1efb(0x20e)]('Retrieving\x20attachments');const _0x2123c5=await(0x0,fetch_attachments_1[_0x1b1efb(0x253)])(this['_connectionSalesforce'],_0x1fda6f['map'](_0x3688ff=>_0x3688ff[_0x1b1efb(0x27b)])),_0x3dbe92=await(0x0,fetch_attachments_1[_0x1b1efb(0x28c)])(_0x2123c5,this[_0x1b1efb(0x222)]);if(_0x3dbe92[_0x1b1efb(0x1da)]!==this[_0x1b1efb(0x254)]['length'])throw new Error(_0x1b1efb(0x236));return _0x3dbe92[_0x1b1efb(0x24f)](_0x3d0b03=>_0x3d0b03['values'][_0x1b1efb(0x24c)]);}async[a257_0x4bae9d(0x240)](_0xec132f){const _0x56e774=a257_0x4bae9d;var _0x56f5c5;this[_0x56e774(0x26f)][_0x56e774(0x20e)](_0x56e774(0x279));const _0x3e232b=new jszip_1[(_0x56e774(0x212))]();for(const _0x184d5b of _0xec132f){const _0x292746=new jszip_1[(_0x56e774(0x212))]();await _0x292746[_0x56e774(0x21d)](_0x184d5b,{'base64':!![]});for(const _0x751b9b in _0x292746['files']){const _0x477882=await((_0x56f5c5=_0x292746[_0x56e774(0x1de)](_0x751b9b))===null||_0x56f5c5===void 0x0?void 0x0:_0x56f5c5[_0x56e774(0x219)](_0x56e774(0x218)));_0x477882&&_0x3e232b[_0x56e774(0x1de)](_0x751b9b,_0x477882);}}const _0x29f4df=new xml2js_1[(_0x56e774(0x238))]({'headless':!![]}),_0x26c073={'vaultpackage':{'$':{'xmlns':'https://veevavault.com/'},'name':this['_deploymentName'],'source':{'vault':undefined,'author':'Flosum'},'packagetype':'migration__v','summary':_0x56e774(0x211),'description':_0x56e774(0x1ee)}};_0x3e232b[_0x56e774(0x1de)]('vaultpackage.xml',_0x29f4df[_0x56e774(0x24b)](_0x26c073));const _0x67c548=this['_tempFolder']+'/'+(0x0,shortid_1[_0x56e774(0x212)])()+_0x56e774(0x1dd),_0x279d0c=await _0x3e232b[_0x56e774(0x29a)]({'type':_0x56e774(0x29f)});return await(0x0,promises_1['writeFile'])(_0x67c548,_0x279d0c),_0x67c548;}async['generateVPK'](_0x45e9c8,_0x4d86c9=0x1){const _0x4e889f=a257_0x4bae9d;var _0x835439;this['_logger']['log'](_0x4e889f(0x1ce));const _0x443b93=new form_data_1[(_0x4e889f(0x212))]();_0x443b93[_0x4e889f(0x25c)]('file',(0x0,fs_1[_0x4e889f(0x1cf)])(_0x45e9c8));const _0x15c290=await this[_0x4e889f(0x1f9)][_0x4e889f(0x296)](veeva_constants_1[_0x4e889f(0x1db)][_0x4e889f(0x263)],_0x443b93,{'responseType':_0x4e889f(0x269),'headers':{'Content-Type':_0x4e889f(0x21f)}}),_0x3075f4=(_0x835439=_0x15c290[_0x4e889f(0x246)]['content-type'])===null||_0x835439===void 0x0?void 0x0:_0x835439['includes'](_0x4e889f(0x282));if(!_0x3075f4){const _0x5cd713=_0x15c290[_0x4e889f(0x292)],_0x33918d=this['_tempFolder']+'/vpk__'+_0x45e9c8[_0x4e889f(0x22c)](_0x45e9c8['lastIndexOf']('/')+0x1);return await(0x0,promises_1['writeFile'])(_0x33918d,_0x5cd713),_0x33918d;}else{const _0x4efd69=JSON['parse'](_0x15c290[_0x4e889f(0x292)]);if(_0x4d86c9>0x0)return await(0x0,veeva_auth_utils_1[_0x4e889f(0x1eb)])(this[_0x4e889f(0x1f9)]),await this[_0x4e889f(0x2a2)](_0x45e9c8,_0x4d86c9-0x1);throw new veeva_error_1[(_0x4e889f(0x1e5))](_0x4efd69['errors']);}}async['validateVpk'](_0x81ec61,_0x2bdf8c=0x1){const _0x9228d5=a257_0x4bae9d;this[_0x9228d5(0x26f)][_0x9228d5(0x20e)](_0x9228d5(0x1d8));const _0x10996b=new form_data_1[(_0x9228d5(0x212))]();_0x10996b[_0x9228d5(0x25c)](_0x9228d5(0x1de),(0x0,fs_1[_0x9228d5(0x1cf)])(_0x81ec61));const _0x5a5579=await this[_0x9228d5(0x1f9)]['post'](veeva_constants_1['VeevaConstants']['ENDPOINT_VALIDATE_PACKAGE'],_0x10996b,{'headers':{'Content-Type':_0x9228d5(0x21f)}}),_0x42b6f4=_0x5a5579[_0x9228d5(0x292)];if(_0x42b6f4['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x9228d5(0x20a)])return _0x42b6f4;else{if(_0x2bdf8c>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x9228d5(0x1f9)]),await this['validateVpk'](_0x81ec61,_0x2bdf8c-0x1);throw new veeva_error_1['VeevaError'](_0x42b6f4['errors']);}}async[a257_0x4bae9d(0x26b)](_0x2c436a,_0x59071f=0x1){const _0x3d2ede=a257_0x4bae9d;this[_0x3d2ede(0x26f)][_0x3d2ede(0x20e)](_0x3d2ede(0x27f));const _0x3c864b=new form_data_1[(_0x3d2ede(0x212))]();_0x3c864b[_0x3d2ede(0x25c)](_0x3d2ede(0x1de),(0x0,fs_1[_0x3d2ede(0x1cf)])(_0x2c436a));const _0x48017f=await this[_0x3d2ede(0x1f9)][_0x3d2ede(0x1e7)](veeva_constants_1[_0x3d2ede(0x1db)][_0x3d2ede(0x263)],_0x3c864b,{'headers':{'Content-Type':_0x3d2ede(0x21f)}}),_0x4e24f3=_0x48017f['data'];if(_0x4e24f3[_0x3d2ede(0x243)]===status_enums_1[_0x3d2ede(0x293)][_0x3d2ede(0x20a)])return _0x4e24f3[_0x3d2ede(0x280)];else{if(_0x59071f>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this['_connectionVeeva']),await this[_0x3d2ede(0x26b)](_0x2c436a,_0x59071f-0x1);throw new veeva_error_1[(_0x3d2ede(0x1e5))](_0x4e24f3[_0x3d2ede(0x206)]);}}async[a257_0x4bae9d(0x210)](_0x1e938a){const _0x14a58c=a257_0x4bae9d;this[_0x14a58c(0x26f)]['log'](_0x14a58c(0x277));const _0x3f1f3c=await this[_0x14a58c(0x1f9)][_0x14a58c(0x296)](veeva_constants_1[_0x14a58c(0x1db)][_0x14a58c(0x276)][_0x14a58c(0x21b)](_0x14a58c(0x1ea),_0x1e938a)),_0x2ad2eb=await _0x3f1f3c[_0x14a58c(0x292)];if(_0x2ad2eb[_0x14a58c(0x243)]===status_enums_1[_0x14a58c(0x293)][_0x14a58c(0x20a)])return _0x2ad2eb[_0x14a58c(0x280)];else throw new veeva_error_1[(_0x14a58c(0x1e5))](_0x2ad2eb[_0x14a58c(0x206)]);}async[a257_0x4bae9d(0x1f2)](_0x2661a7){const _0x426116=a257_0x4bae9d;this[_0x426116(0x26f)]['log'](_0x426116(0x272));const _0x4d6cd9=new job_result_dto_1[(_0x426116(0x1cd))](),[_0x45d212]=await veeva_service_1[_0x426116(0x251)][_0x426116(0x26e)]([_0x2661a7],this['_connectionVeeva'],this[_0x426116(0x26f)]);return _0x4d6cd9[_0x426116(0x1d1)]=_0x45d212[_0x426116(0x1ec)]===status_enums_1['VeevaJobStatus'][_0x426116(0x20a)],_0x4d6cd9['detailUrl']=_0x45d212[_0x426116(0x262)]['find'](_0x30787a=>_0x30787a['rel']===_0x426116(0x1e9))[_0x426116(0x214)],_0x4d6cd9;}async['getValidationDetailsAndSaveLog'](_0x4c5dd3){const _0x5bdda=a257_0x4bae9d;this['_logger'][_0x5bdda(0x20e)](_0x5bdda(0x223));const {data:_0x84d5fc}=await this[_0x5bdda(0x1f9)][_0x5bdda(0x256)](_0x4c5dd3[_0x5bdda(0x20b)]);if(_0x84d5fc[_0x5bdda(0x243)]===status_enums_1['VeevaResponseStatus'][_0x5bdda(0x20a)]){const {log:_0x474ea3,id:_0x34ad6d,package_status:_0x487e4e}=_0x84d5fc[_0x5bdda(0x299)],_0x5886ef=_0x474ea3['filter'](_0x39d947=>_0x39d947[_0x5bdda(0x1fe)][_0x5bdda(0x1f1)](_0x5bdda(0x24a))),_0x39be43=await this[_0x5bdda(0x22f)](_0x5886ef[0x0][_0x5bdda(0x280)]);await this[_0x5bdda(0x1f8)](_0x39be43,_0x5bdda(0x217)),_0x4c5dd3[_0x5bdda(0x258)]=_0x34ad6d;if(_0x487e4e!==status_enums_1[_0x5bdda(0x232)]['VERIFIED'])throw new Error('Package\x20not\x20verified');}else throw new veeva_error_1[(_0x5bdda(0x1e5))](_0x84d5fc[_0x5bdda(0x206)]);}async[a257_0x4bae9d(0x266)](_0x424103){const _0x3180f2=a257_0x4bae9d;this['_logger'][_0x3180f2(0x20e)](_0x3180f2(0x1e0));const {data:_0x1be807}=await this[_0x3180f2(0x1f9)][_0x3180f2(0x256)](_0x424103[_0x3180f2(0x20b)]);if(_0x1be807['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x3180f2(0x20a)]){const {responseDetails:{deployment_log:_0x523a42,package_status__v:_0x45c1f7},package_steps:_0x107a5e}=_0x1be807,_0x3466f3=_0x523a42[_0x3180f2(0x221)](_0x1e28e2=>_0x1e28e2[_0x3180f2(0x1fe)][_0x3180f2(0x1f1)]('Deployment.log')),_0x163445=await this['getLogResultText'](_0x3466f3[0x0][_0x3180f2(0x280)]);await this[_0x3180f2(0x1f8)](_0x163445,_0x3180f2(0x1fc)),_0x424103['isDeployed']=[status_enums_1[_0x3180f2(0x232)][_0x3180f2(0x204)],status_enums_1[_0x3180f2(0x232)]['DEPLOYED_WITH_WARNINGS']][_0x3180f2(0x1d4)](_0x45c1f7);const _0x5b77e0=this[_0x3180f2(0x23c)](_0x107a5e);_0x424103[_0x3180f2(0x291)]=_0x5b77e0[_0x3180f2(0x221)](_0x112a38=>_0x112a38[_0x3180f2(0x1ec)]!==status_enums_1[_0x3180f2(0x260)][_0x3180f2(0x1d9)]);if(!_0x424103[_0x3180f2(0x291)][_0x3180f2(0x1da)])throw new Error(_0x3180f2(0x228));}else throw new veeva_error_1[(_0x3180f2(0x1e5))](_0x1be807['errors']);}async['getLogResultText'](_0x467e32){const _0x19a8c9=a257_0x4bae9d,{data:_0x1ee9e4}=await this[_0x19a8c9(0x1f9)]['get'](_0x467e32,{'responseType':_0x19a8c9(0x1d5)});return _0x1ee9e4;}[a257_0x4bae9d(0x23c)](_0x4d725a){const _0x5c0105=a257_0x4bae9d;return _0x4d725a[_0x5c0105(0x22a)]((_0x529592,_0x103bdd)=>{const _0x4cd910=_0x5c0105,_0x290027=_0x103bdd['package_components']['map'](_0x56246b=>new package_component_dto_1[(_0x4cd910(0x27a))](_0x56246b,_0x103bdd['deployment_status__v']));return[..._0x529592,..._0x290027];},[]);}async[a257_0x4bae9d(0x1f8)](_0x2cade1,_0x1d16ca){const _0x152371=a257_0x4bae9d;this[_0x152371(0x26f)]['log'](_0x152371(0x1d2));const _0x109fe9={'Body':Buffer[_0x152371(0x2a4)](_0x2cade1)[_0x152371(0x208)](_0x152371(0x25e)),'ContentType':_0x152371(0x235),'ParentId':this[_0x152371(0x1ed)],'Name':_0x1d16ca},{data:_0x3ce0e2}=await this[_0x152371(0x222)][_0x152371(0x296)](flosum_constants_1[_0x152371(0x1fd)]['ENDPOINT_UPSERT_RECORD']+_0x152371(0x26d),_0x109fe9);return _0x3ce0e2['id'];}[a257_0x4bae9d(0x21c)](_0x47b364,_0x541aca){const _0x3916d9=a257_0x4bae9d;this[_0x3916d9(0x26f)][_0x3916d9(0x20e)](_0x3916d9(0x24d));const _0x1d329f=_0x47b364[_0x3916d9(0x22a)]((_0x24e0ed,_0x3d7640)=>_0x24e0ed[_0x3916d9(0x1f4)]((_0x3d7640[_0x3916d9(0x28d)]+'.'+_0x3d7640[_0x3916d9(0x290)])['toLowerCase'](),_0x3d7640),new Map());return _0x541aca['map'](_0x5046b4=>{const _0x56deba=_0x3916d9;this[_0x56deba(0x26f)][_0x56deba(0x20e)](_0x5046b4[_0x56deba(0x27c)]+'.'+_0x5046b4['name']+_0x56deba(0x23e)+_0x5046b4['status']);const _0x10f5a5=(_0x5046b4['type']+'.'+_0x5046b4[_0x56deba(0x274)])['toLowerCase'](),_0x4a6aae=_0x1d329f[_0x56deba(0x256)](_0x10f5a5);return{[constants_1[_0x56deba(0x1d3)]+'Type__c']:_0x56deba(0x252),[constants_1[_0x56deba(0x1d3)]+_0x56deba(0x255)]:_0x5046b4['status']===status_enums_1['PackageComponentStatus'][_0x56deba(0x204)]?'Success':_0x56deba(0x245),[constants_1[_0x56deba(0x1d3)]+'Result__c']:_0x56deba(0x259),[constants_1[_0x56deba(0x1d3)]+'Component_Name__c']:_0x5046b4[_0x56deba(0x274)],[constants_1['FLOSUM_NAMESPACE']+_0x56deba(0x1df)]:_0x5046b4[_0x56deba(0x27c)],[constants_1['FLOSUM_NAMESPACE']+_0x56deba(0x28a)]:this[_0x56deba(0x21a)],[constants_1[_0x56deba(0x1d3)]+_0x56deba(0x250)]:this[_0x56deba(0x1ed)],[constants_1[_0x56deba(0x1d3)]+_0x56deba(0x287)]:_0x4a6aae[_0x56deba(0x27b)]};});}async['saveDeploymentResults'](_0x48aa01){const _0x8f6b86=a257_0x4bae9d;this[_0x8f6b86(0x26f)]['log'](_0x8f6b86(0x25d));const _0x429bad=await salesforce_service_1[_0x8f6b86(0x288)][_0x8f6b86(0x226)](this['_connectionSalesforce'],constants_1[_0x8f6b86(0x1d3)]+_0x8f6b86(0x1e1),_0x48aa01),_0x567320=_0x429bad[_0x8f6b86(0x221)](_0xaa80f2=>!_0xaa80f2[_0x8f6b86(0x1f7)])[_0x8f6b86(0x24f)](_0x28a4a4=>_0x28a4a4[_0x8f6b86(0x206)])[_0x8f6b86(0x202)]();if(_0x567320['length'])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x567320);}async[a257_0x4bae9d(0x21e)](_0x26e9df){const _0xc7b51=a257_0x4bae9d;this[_0xc7b51(0x26f)][_0xc7b51(0x29d)](_0x26e9df),await this[_0xc7b51(0x26f)][_0xc7b51(0x23b)](),await this[_0xc7b51(0x273)](![],!![],'');}async[a257_0x4bae9d(0x273)](_0xa71a1f,_0x1887fb,_0x4e5748){const _0xeeffb3=a257_0x4bae9d,_0x66760a='<a\x20href='+this[_0xeeffb3(0x220)]+'/'+this[_0xeeffb3(0x1ed)]+_0xeeffb3(0x249)+_0xeeffb3(0x233)+'\x20</a>',_0x1d5e1a=_0xeeffb3(0x28f)+this[_0xeeffb3(0x220)]+'/'+this[_0xeeffb3(0x21a)]+'\x20>'+this[_0xeeffb3(0x1f3)]+_0xeeffb3(0x23a),_0x542a01=_0x66760a+_0xeeffb3(0x1e8)+_0x1d5e1a+'\x20has\x20been\x20created.',_0x36b742={[constants_1['FLOSUM_NAMESPACE']+_0xeeffb3(0x209)]:_0x542a01,[constants_1['FLOSUM_NAMESPACE']+_0xeeffb3(0x294)]:new Date(),[constants_1[_0xeeffb3(0x1d3)]+'Branch__c']:this[_0xeeffb3(0x2a1)],[constants_1['FLOSUM_NAMESPACE']+_0xeeffb3(0x24e)]:_0xeeffb3(0x230),[constants_1[_0xeeffb3(0x1d3)]+'Activity_Type__c']:_0xeeffb3(0x267),[constants_1[_0xeeffb3(0x1d3)]+_0xeeffb3(0x1d0)]:this[_0xeeffb3(0x21a)]},_0x293c12={[constants_1[_0xeeffb3(0x1d3)]+_0xeeffb3(0x28b)]:!_0xa71a1f,[constants_1['FLOSUM_NAMESPACE']+_0xeeffb3(0x224)]:_0xa71a1f,[constants_1[_0xeeffb3(0x1d3)]+_0xeeffb3(0x255)]:_0x1887fb?status_enums_1[_0xeeffb3(0x1e6)]['EXCEPTION']:status_enums_1[_0xeeffb3(0x1e6)][_0xeeffb3(0x205)],[constants_1['FLOSUM_NAMESPACE']+_0xeeffb3(0x247)]:!![],[constants_1[_0xeeffb3(0x1d3)]+_0xeeffb3(0x278)]:flosum_constants_1[_0xeeffb3(0x1fd)][_0xeeffb3(0x1fb)],[constants_1[_0xeeffb3(0x1d3)]+_0xeeffb3(0x23d)]:_0x4e5748};await this[_0xeeffb3(0x222)][_0xeeffb3(0x1dc)](flosum_constants_1['FlosumConstants'][_0xeeffb3(0x242)]+'/'+constants_1['FLOSUM_NAMESPACE']+'Metadata_Log__c/'+this[_0xeeffb3(0x1ed)],_0x293c12),await this['_connectionSalesforce']['post'](flosum_constants_1[_0xeeffb3(0x1fd)][_0xeeffb3(0x242)]+'/'+constants_1[_0xeeffb3(0x1d3)]+_0xeeffb3(0x216),_0x36b742),this[_0xeeffb3(0x26f)][_0xeeffb3(0x20e)]('Deploy\x20completed\x20'+(_0xa71a1f?_0xeeffb3(0x25a):'with\x20error')+'.'),await this[_0xeeffb3(0x26f)][_0xeeffb3(0x23b)]();}}exports[a257_0x4bae9d(0x1e2)]=DeployService;