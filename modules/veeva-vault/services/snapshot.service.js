const a363_0x3ea30e=a363_0x3353;(function(_0x267a5a,_0x22777c){const _0x19a1f5=a363_0x3353,_0x3d116c=_0x267a5a();while(!![]){try{const _0x3b7fb8=-parseInt(_0x19a1f5(0xff))/0x1+parseInt(_0x19a1f5(0x149))/0x2*(-parseInt(_0x19a1f5(0xe4))/0x3)+-parseInt(_0x19a1f5(0x139))/0x4+parseInt(_0x19a1f5(0xe2))/0x5*(parseInt(_0x19a1f5(0x118))/0x6)+-parseInt(_0x19a1f5(0x112))/0x7+parseInt(_0x19a1f5(0x12d))/0x8+parseInt(_0x19a1f5(0x125))/0x9;if(_0x3b7fb8===_0x22777c)break;else _0x3d116c['push'](_0x3d116c['shift']());}catch(_0x258288){_0x3d116c['push'](_0x3d116c['shift']());}}}(a363_0x17a5,0x402a2));function a363_0x3353(_0x1189eb,_0x2b745a){const _0x24aa92=a363_0x17a5();return a363_0x3353=function(_0x1283ea,_0x3ae273){_0x1283ea=_0x1283ea-0xe1;let _0x17a5b4=_0x24aa92[_0x1283ea];return _0x17a5b4;},a363_0x3353(_0x1189eb,_0x2b745a);}const a363_0x3ae273=(function(){let _0xf0f35=!![];return function(_0x5c425c,_0x437af9){const _0x489035=_0xf0f35?function(){const _0x39dc44=a363_0x3353;if(_0x437af9){const _0x2b0592=_0x437af9[_0x39dc44(0x119)](_0x5c425c,arguments);return _0x437af9=null,_0x2b0592;}}:function(){};return _0xf0f35=![],_0x489035;};}()),a363_0x1283ea=a363_0x3ae273(this,function(){const _0x12d06b=a363_0x3353;return a363_0x1283ea[_0x12d06b(0x104)]()['search'](_0x12d06b(0x10e))[_0x12d06b(0x104)]()[_0x12d06b(0xe8)](a363_0x1283ea)[_0x12d06b(0xed)](_0x12d06b(0x10e));});a363_0x1283ea();'use strict';function a363_0x17a5(){const _0xb4b16a=['_snapshotId','reduce','Snapshot\x20completed\x20','retrieveVeevaComponents','../../../constants','__importDefault','6570YYBAOJ','files','15RrvBzT','jszip','from','_metadataLogId','constructor','label','Job_Completed__c','Cannot\x20retrieve\x20','_connectionSalesforce','search','COMPLETED','Metadata_Item__c','apiName','./package-export.service','EXCEPTION','FLOSUM_NAMESPACE','TypeAndNameVeevaComponentRetriever','SnapshotService','VeevaConstants','join','sep','patch','Snapshot__c','saveComponentsInSalesforce','logError','Attachment','stringify','514647qvehxo','Status__c','_logger','_selectedMetaTypes','MDL_EXTENSION','toString','Attachment_ID__c','csv-parse/sync','../classes/retrievers/veeva-components/type.veeva-component.retriever','attachmentId','export','_whereClause','isRetrieved','updateLog','_connectionVeeva','(((.+)+)+)+$','Snapshot','finishSnapshot','OUTBOUND_PACKAGE_NAME','2037182GqvOXq','map','successfully','filter','./salesforce.service','createMetadataItemListWithBody','462gZlgPM','apply','Metadata_Log__c/','log','parse','lastModifiedDate','with\x20error','__esModule','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','../dtos/metadata-item.dto','./veeva.service','file','TypeVeevaComponentRetriever','11067012mFYYWm','_packageExportService','string','Saving\x20Attachments.','SalesforceService','Veeva_Component_Type__c','snapshotId','ENDPOINT_UPSERT_RECORD','2425792yrsTST','FlosumConstants','defineProperty','veevaComponentType','has','MetadataLogStatus','_selectedComponentMap','_veevaService','MetadataItemDto','values','get','Is_Error__c','1195356xOWlKU','../constants/flosum.constants','_salesforceService','formMetadataItemDtoList','SalesforceDmlError','async','Is_Retrieved__c','application/zip','forEach','Cannot\x20Save\x20Metadata\x20Items','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','error','\x20Metadata\x20Items','length','../classes/errors/salesforce-dml-error','posix','106696GoSQyJ','catch','insertMultipleRecords','../constants/veeva.constants','Saving\x20','saveAttachments','set','path','body','retrieve','PackageExportService','name','success','transformDependencyFile','execute','default','base64','Snapshot\x20started.','type','errors'];a363_0x17a5=function(){return _0xb4b16a;};return a363_0x17a5();}var __importDefault=this&&this[a363_0x3ea30e(0xe1)]||function(_0x21da17){return _0x21da17&&_0x21da17['__esModule']?_0x21da17:{'default':_0x21da17};};Object[a363_0x3ea30e(0x12f)](exports,a363_0x3ea30e(0x11f),{'value':!![]}),exports[a363_0x3ea30e(0xf5)]=void 0x0;const jszip_1=__importDefault(require(a363_0x3ea30e(0xe5))),flosum_constants_1=require(a363_0x3ea30e(0x13a)),veeva_service_1=require(a363_0x3ea30e(0x122)),metadata_item_dto_1=require(a363_0x3ea30e(0x121)),constants_1=require(a363_0x3ea30e(0x161)),salesforce_service_1=require(a363_0x3ea30e(0x116)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a363_0x3ea30e(0x147)),package_export_service_1=require(a363_0x3ea30e(0xf1)),type_and_name_veeva_component_retriever_1=require(a363_0x3ea30e(0x143)),type_veeva_component_retriever_1=require(a363_0x3ea30e(0x107)),sync_1=require(a363_0x3ea30e(0x106)),sync_2=require('csv-stringify/sync'),veeva_constants_1=require(a363_0x3ea30e(0x14c)),path_1=__importDefault(require(a363_0x3ea30e(0x150)));class SnapshotService{constructor({snapshotId:_0x297676,metadataLogId:_0xf6c143,selectedMetaTypes:_0x5bb15e,selectedComponentMap:_0xc5e349,whereClause:_0xe2fb2b},_0x2a39d9,_0x4a52c6,_0x32e55c){const _0x10a221=a363_0x3ea30e;this[_0x10a221(0xec)]=_0x2a39d9,this[_0x10a221(0x10d)]=_0x4a52c6,this['_logger']=_0x32e55c,this['_snapshotId']=_0x297676,this[_0x10a221(0xe7)]=_0xf6c143,this[_0x10a221(0x102)]=_0x5bb15e,this[_0x10a221(0x133)]=_0xc5e349,this[_0x10a221(0x10a)]=_0xe2fb2b,this[_0x10a221(0x134)]=new veeva_service_1['VeevaService']({'connection':this[_0x10a221(0x10d)],'logger':this[_0x10a221(0x101)]}),this[_0x10a221(0x13b)]=new salesforce_service_1[(_0x10a221(0x129))]({'connection':this['_connectionSalesforce']}),this[_0x10a221(0x126)]=new package_export_service_1[(_0x10a221(0x153))]({'veevaService':this[_0x10a221(0x134)],'connection':this[_0x10a221(0x10d)],'logger':this[_0x10a221(0x101)]});}async[a363_0x3ea30e(0x157)](){const _0x5f4ace=a363_0x3ea30e;try{this[_0x5f4ace(0x101)][_0x5f4ace(0x11b)](_0x5f4ace(0x15a));const _0x457c08=await this[_0x5f4ace(0x160)]();await this[_0x5f4ace(0x101)]['updateLog']();const _0x1ec65b=await this['_packageExportService'][_0x5f4ace(0x109)](_0x457c08,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this[_0x5f4ace(0x101)]['updateLog']();const _0x2d229d=await this[_0x5f4ace(0x117)](_0x457c08,_0x1ec65b);await this['saveComponentsInSalesforce'](_0x2d229d),await this['_logger'][_0x5f4ace(0x10c)](),await this[_0x5f4ace(0x110)](!![]);}catch(_0x354861){this[_0x5f4ace(0x101)]['logError'](_0x354861),await this[_0x5f4ace(0x110)](![])[_0x5f4ace(0x14a)](_0x56eef2=>this['_systemLogger'][_0x5f4ace(0x144)](_0x56eef2));}}async[a363_0x3ea30e(0x160)](){const _0x250d55=a363_0x3ea30e,_0xa0d475={'veevaService':this[_0x250d55(0x134)],'logger':this[_0x250d55(0x101)]},_0x1ae420=Array[_0x250d55(0xe6)](Object[_0x250d55(0x136)](this[_0x250d55(0x133)]))[_0x250d55(0x146)]?new type_and_name_veeva_component_retriever_1[(_0x250d55(0xf4))]({'value':this['_selectedComponentMap'],..._0xa0d475}):new type_veeva_component_retriever_1[(_0x250d55(0x124))]({'value':this[_0x250d55(0x102)],'whereClause':this[_0x250d55(0x10a)],..._0xa0d475});return _0x1ae420[_0x250d55(0x152)]();}async['createMetadataItemListWithBody'](_0x5a7fa3,_0x46ab41){const _0x3bb711=a363_0x3ea30e;var _0x35d846,_0x3af101;this[_0x3bb711(0x101)][_0x3bb711(0x11b)](_0x3bb711(0x120));const _0x1693c9=this[_0x3bb711(0x13c)](_0x5a7fa3),_0x4db697=_0x1693c9[_0x3bb711(0x15e)]((_0xd0fe74,_0x34d11a)=>_0xd0fe74[_0x3bb711(0x14f)](_0x34d11a[_0x3bb711(0xe9)],_0x34d11a),new Map());for(const _0x5e3485 of _0x46ab41){for(const _0x58abbd in _0x5e3485[_0x3bb711(0xe3)]){const {base:_0x29e837,name:_0x227143,dir:_0x27511c}=path_1[_0x3bb711(0x158)][_0x3bb711(0x11c)](_0x58abbd),_0x41b8b7=_0x227143+veeva_constants_1['VeevaConstants']['DEPENDENCY_EXTENSION'];if(_0x4db697[_0x3bb711(0x131)](_0x29e837)){const _0x2bd035=await((_0x35d846=_0x5e3485[_0x3bb711(0x123)]([_0x27511c,_0x29e837][_0x3bb711(0xf7)](path_1['default'][_0x3bb711(0x148)][_0x3bb711(0xf8)])))===null||_0x35d846===void 0x0?void 0x0:_0x35d846[_0x3bb711(0x13e)](_0x3bb711(0x127))),_0x26f3df=await((_0x3af101=_0x5e3485[_0x3bb711(0x123)]([_0x27511c,_0x41b8b7][_0x3bb711(0xf7)](path_1[_0x3bb711(0x158)]['posix'][_0x3bb711(0xf8)])))===null||_0x3af101===void 0x0?void 0x0:_0x3af101['async'](_0x3bb711(0x127)));if(_0x2bd035){const _0x55f1f5=new jszip_1[(_0x3bb711(0x158))]();_0x55f1f5['file'](_0x29e837,_0x2bd035),_0x26f3df&&_0x55f1f5[_0x3bb711(0x123)](_0x41b8b7,this[_0x3bb711(0x156)](_0x26f3df)),_0x4db697[_0x3bb711(0x137)](_0x29e837)[_0x3bb711(0x151)]=await _0x55f1f5['generateAsync']({'type':_0x3bb711(0x159)});}}}}return _0x1693c9[_0x3bb711(0x115)](_0x19c33f=>!_0x19c33f[_0x3bb711(0x151)])[_0x3bb711(0x141)](_0x1acdf0=>{const _0x40b41f=_0x3bb711;this[_0x40b41f(0x101)][_0x40b41f(0x11b)](_0x40b41f(0xeb)+_0x1acdf0['veevaComponentType']+'.'+_0x1acdf0['name']+'\x20from\x20outbound\x20package');}),_0x1693c9['filter'](_0x305c77=>_0x305c77[_0x3bb711(0x151)]);}['transformDependencyFile'](_0xaaf6ea){const _0x4d42cb=a363_0x3ea30e,_0x4dbd6b=(0x0,sync_1['parse'])(_0xaaf6ea,{'columns':!![],'skip_empty_lines':!![]}),_0x2ba07f=_0x4dbd6b[_0x4d42cb(0x113)](({'In\x20Package':_0x37fda5,..._0xea3fb2})=>_0xea3fb2);return(0x0,sync_2[_0x4d42cb(0xfe)])(_0x2ba07f,{'header':!![]});}['formMetadataItemDtoList'](_0x2745e9){const _0x37562f=a363_0x3ea30e;return _0x2745e9[_0x37562f(0x113)](_0x545b7a=>{const _0x1e3811=_0x37562f,_0x2f064a=new metadata_item_dto_1[(_0x1e3811(0x135))]();return _0x2f064a['name']=_0x545b7a[_0x1e3811(0x154)],_0x2f064a[_0x1e3811(0xf0)]=_0x545b7a[_0x1e3811(0x154)],_0x2f064a[_0x1e3811(0x12b)]=this['_snapshotId'],_0x2f064a[_0x1e3811(0xe9)]=_0x545b7a[_0x1e3811(0x15b)]+'.'+_0x545b7a[_0x1e3811(0x154)]+veeva_constants_1[_0x1e3811(0xf6)][_0x1e3811(0x103)],_0x2f064a[_0x1e3811(0x130)]=_0x545b7a['type'],_0x2f064a[_0x1e3811(0x11d)]=_0x545b7a[_0x1e3811(0x11d)],_0x2f064a['isRetrieved']=![],_0x2f064a;});}async[a363_0x3ea30e(0xfb)](_0x431a29){const _0x23e8bf=a363_0x3ea30e;this[_0x23e8bf(0x101)][_0x23e8bf(0x11b)](_0x23e8bf(0x128)),await this[_0x23e8bf(0x14e)](_0x431a29),this[_0x23e8bf(0x101)][_0x23e8bf(0x11b)]('Saving\x20'+_0x431a29[_0x23e8bf(0x146)]+_0x23e8bf(0x145));const _0xf5212c=_0x431a29[_0x23e8bf(0x113)](_0x2850db=>{const _0x27830f=_0x23e8bf;return{[constants_1['FLOSUM_NAMESPACE']+'Name__c']:_0x2850db[_0x27830f(0x154)],[constants_1[_0x27830f(0xf3)]+'API_Name__c']:_0x2850db[_0x27830f(0xf0)],[constants_1[_0x27830f(0xf3)]+_0x27830f(0xfa)]:_0x2850db[_0x27830f(0x12b)],[constants_1[_0x27830f(0xf3)]+'Label__c']:_0x2850db[_0x27830f(0xe9)],[constants_1[_0x27830f(0xf3)]+_0x27830f(0x13f)]:_0x2850db[_0x27830f(0x10b)],[constants_1[_0x27830f(0xf3)]+_0x27830f(0x12a)]:_0x2850db[_0x27830f(0x130)],[constants_1['FLOSUM_NAMESPACE']+_0x27830f(0x105)]:_0x2850db[_0x27830f(0x108)],[constants_1[_0x27830f(0xf3)]+'Last_Modified_Date__c']:_0x2850db[_0x27830f(0x11d)]};}),_0x4b4986=await this[_0x23e8bf(0x13b)][_0x23e8bf(0x14b)](constants_1[_0x23e8bf(0xf3)]+_0x23e8bf(0xef),_0xf5212c);let _0x3f14bf=!![];_0x4b4986[_0x23e8bf(0x141)]((_0x508e73,_0x3f08d8)=>{const _0x27dfc9=_0x23e8bf;this['_logger'][_0x27dfc9(0x11b)](_0x27dfc9(0x14d)+_0x431a29[_0x3f08d8][_0x27dfc9(0x130)]+'.'+_0x431a29[_0x3f08d8][_0x27dfc9(0x154)]);if(!_0x508e73[_0x27dfc9(0x155)]){_0x3f14bf=![];const _0x57f28e=new salesforce_dml_error_1[(_0x27dfc9(0x13d))](_0x508e73[_0x27dfc9(0x15c)]);this[_0x27dfc9(0x101)][_0x27dfc9(0xfc)](_0x57f28e);}});if(!_0x3f14bf)throw new Error(_0x23e8bf(0x142));}async[a363_0x3ea30e(0x14e)](_0x217d4c){const _0x4c756d=a363_0x3ea30e,_0x34044f=this['formAttachments'](_0x217d4c),_0x384244=await this[_0x4c756d(0x13b)][_0x4c756d(0x14b)](SnapshotService['ATTACHMENT'],_0x34044f),_0x1a1b5d=[];_0x384244[_0x4c756d(0x141)]((_0x13d191,_0x55d564)=>{const _0x89d2e9=_0x4c756d;_0x13d191[_0x89d2e9(0x155)]?(_0x217d4c[_0x55d564]['attachmentId']=_0x13d191['id'],_0x217d4c[_0x55d564][_0x89d2e9(0x10b)]=!![]):_0x1a1b5d['push'](..._0x13d191[_0x89d2e9(0x15c)]);});if(_0x1a1b5d['length'])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x1a1b5d);}['formAttachments'](_0x416b2a){const _0x2cf66a=a363_0x3ea30e;return _0x416b2a[_0x2cf66a(0x113)](_0x1a04c9=>({'ParentId':this[_0x2cf66a(0x15d)],'Name':_0x1a04c9['veevaComponentType'],'ContentType':_0x2cf66a(0x140),'Body':_0x1a04c9[_0x2cf66a(0x151)],'Description':_0x1a04c9[_0x2cf66a(0x130)]}));}async['finishSnapshot'](_0x2ab634){const _0x53ec6d=a363_0x3ea30e,_0x42841d={[constants_1[_0x53ec6d(0xf3)]+'Is_Completed__c']:!![],[constants_1[_0x53ec6d(0xf3)]+'Is_Error__c']:!_0x2ab634},_0x37589f={[constants_1[_0x53ec6d(0xf3)]+_0x53ec6d(0x138)]:!_0x2ab634,[constants_1['FLOSUM_NAMESPACE']+'Succeed__c']:_0x2ab634,[constants_1[_0x53ec6d(0xf3)]+_0x53ec6d(0x100)]:_0x2ab634?status_enums_1[_0x53ec6d(0x132)][_0x53ec6d(0xee)]:status_enums_1[_0x53ec6d(0x132)][_0x53ec6d(0xf2)],[constants_1[_0x53ec6d(0xf3)]+_0x53ec6d(0xea)]:!![]};await this['_connectionSalesforce'][_0x53ec6d(0xf9)](flosum_constants_1[_0x53ec6d(0x12e)][_0x53ec6d(0x12c)]+'/'+constants_1[_0x53ec6d(0xf3)]+'Snapshot__c/'+this[_0x53ec6d(0x15d)],_0x42841d),await this[_0x53ec6d(0xec)][_0x53ec6d(0xf9)](flosum_constants_1[_0x53ec6d(0x12e)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x53ec6d(0xf3)]+_0x53ec6d(0x11a)+this[_0x53ec6d(0xe7)],_0x37589f),this[_0x53ec6d(0x101)][_0x53ec6d(0x11b)](_0x53ec6d(0x15f)+(_0x2ab634?_0x53ec6d(0x114):_0x53ec6d(0x11e))+'.'),await this[_0x53ec6d(0x101)][_0x53ec6d(0x10c)]();}}exports[a363_0x3ea30e(0xf5)]=SnapshotService,SnapshotService[a363_0x3ea30e(0x111)]=a363_0x3ea30e(0x10f),SnapshotService['ATTACHMENT']=a363_0x3ea30e(0xfd);