const a406_0xcb273f=a406_0x3508;(function(_0x188098,_0x4aa5e7){const _0x2a7a8d=a406_0x3508,_0x47d4cf=_0x188098();while(!![]){try{const _0x5cbeeb=parseInt(_0x2a7a8d(0x95))/0x1*(-parseInt(_0x2a7a8d(0x88))/0x2)+parseInt(_0x2a7a8d(0xd3))/0x3+parseInt(_0x2a7a8d(0xe7))/0x4*(parseInt(_0x2a7a8d(0xd2))/0x5)+-parseInt(_0x2a7a8d(0x89))/0x6+parseInt(_0x2a7a8d(0xd7))/0x7+parseInt(_0x2a7a8d(0xb7))/0x8+-parseInt(_0x2a7a8d(0x7b))/0x9;if(_0x5cbeeb===_0x4aa5e7)break;else _0x47d4cf['push'](_0x47d4cf['shift']());}catch(_0x31dc7f){_0x47d4cf['push'](_0x47d4cf['shift']());}}}(a406_0xfd13,0x4207b));const a406_0x336b95=(function(){let _0x4d9767=!![];return function(_0x39cf31,_0x1c8214){const _0x56f4b0=_0x4d9767?function(){if(_0x1c8214){const _0x2d33ee=_0x1c8214['apply'](_0x39cf31,arguments);return _0x1c8214=null,_0x2d33ee;}}:function(){};return _0x4d9767=![],_0x56f4b0;};}()),a406_0x7e3949=a406_0x336b95(this,function(){const _0x34cd43=a406_0x3508;return a406_0x7e3949['toString']()[_0x34cd43(0xad)](_0x34cd43(0xb4))[_0x34cd43(0xdc)]()[_0x34cd43(0x9d)](a406_0x7e3949)[_0x34cd43(0xad)](_0x34cd43(0xb4));});a406_0x7e3949();'use strict';var __importDefault=this&&this[a406_0xcb273f(0xe8)]||function(_0x4145a8){const _0x160cca=a406_0xcb273f;return _0x4145a8&&_0x4145a8[_0x160cca(0x8a)]?_0x4145a8:{'default':_0x4145a8};};function a406_0x3508(_0x3d3f64,_0x479c3a){const _0x2d35c1=a406_0xfd13();return a406_0x3508=function(_0x7e3949,_0x336b95){_0x7e3949=_0x7e3949-0x74;let _0xfd13f3=_0x2d35c1[_0x7e3949];return _0xfd13f3;},a406_0x3508(_0x3d3f64,_0x479c3a);}Object[a406_0xcb273f(0xd6)](exports,a406_0xcb273f(0x8a),{'value':!![]}),exports[a406_0xcb273f(0xe3)]=void 0x0;function a406_0xfd13(){const _0x2f7a7a=['FLOSUM_NAMESPACE','search','transformDependencyFile','Label__c','log','formAttachments','createMetadataItemListWithBody','Veeva_Component_Type__c','(((.+)+)+)+$','Last_Modified_Date__c','../../../constants','2891144uBoQFB','parse','generateAsync','EXCEPTION','TypeVeevaComponentRetriever','Cannot\x20Save\x20Metadata\x20Items','Job_Completed__c','catch','Attachment_ID__c','MDL_EXTENSION','MetadataLogStatus','\x20Metadata\x20Items','_salesforceService','join','from','Attachment','Metadata_Item__c','csv-stringify/sync','Status__c','_veevaService','_packageExportService','label','file','_metadataLogId','execute','name','Metadata_Log__c/','890oIfTdj','1216206MMUoXm','_systemLogger','patch','defineProperty','2609026qYTuVJ','type','../classes/retrievers/veeva-components/type.veeva-component.retriever','_connectionVeeva','reduce','toString','_selectedMetaTypes','./veeva.service','jszip','path','COMPLETED','ENDPOINT_UPSERT_RECORD','SnapshotService','veevaComponentType','stringify','VeevaService','8924dXTiZj','__importDefault','retrieveVeevaComponents','async','success','errors','Snapshot\x20completed\x20','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','Saving\x20Attachments.','Name__c','lastModifiedDate','Is_Completed__c','base64','apiName','PackageExportService','files','TypeAndNameVeevaComponentRetriever','FlosumConstants','Succeed__c','7131951OvTYLF','Cannot\x20retrieve\x20','../enums/status.enums','updateLog','ATTACHMENT','VeevaConstants','formMetadataItemDtoList','get','SalesforceDmlError','Snapshot__c','_logger','../classes/errors/salesforce-dml-error','map','310154EcXMZm','51012hqVanL','__esModule','_connectionSalesforce','Snapshot\x20started.','sep','snapshotId','saveAttachments','OUTBOUND_PACKAGE_NAME','isRetrieved','values','MetadataItemDto','_selectedComponentMap','3dyFOya','saveComponentsInSalesforce','insertMultipleRecords','API_Name__c','Snapshot','filter','Is_Error__c','retrieve','constructor','Saving\x20','logError','set','Is_Retrieved__c','default','_snapshotId','\x20from\x20outbound\x20package','length','body','posix','finishSnapshot','push','_whereClause','forEach'];a406_0xfd13=function(){return _0x2f7a7a;};return a406_0xfd13();}const jszip_1=__importDefault(require(a406_0xcb273f(0xdf))),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require(a406_0xcb273f(0xde)),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a406_0xcb273f(0xb6)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a406_0xcb273f(0x7d)),salesforce_dml_error_1=require(a406_0xcb273f(0x86)),package_export_service_1=require('./package-export.service'),type_and_name_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever'),type_veeva_component_retriever_1=require(a406_0xcb273f(0xd9)),sync_1=require('csv-parse/sync'),sync_2=require(a406_0xcb273f(0xc8)),veeva_constants_1=require('../constants/veeva.constants'),path_1=__importDefault(require(a406_0xcb273f(0xe0)));class SnapshotService{constructor({snapshotId:_0x425425,metadataLogId:_0x9289c2,selectedMetaTypes:_0x205964,selectedComponentMap:_0x13803c,whereClause:_0x2d798f},_0x5b92ef,_0x54fccd,_0x4c22ef){const _0x451ec4=a406_0xcb273f;this['_connectionSalesforce']=_0x5b92ef,this[_0x451ec4(0xda)]=_0x54fccd,this[_0x451ec4(0x85)]=_0x4c22ef,this[_0x451ec4(0xa3)]=_0x425425,this[_0x451ec4(0xce)]=_0x9289c2,this[_0x451ec4(0xdd)]=_0x205964,this[_0x451ec4(0x94)]=_0x13803c,this[_0x451ec4(0xaa)]=_0x2d798f,this['_veevaService']=new veeva_service_1[(_0x451ec4(0xe6))]({'connection':this[_0x451ec4(0xda)],'logger':this[_0x451ec4(0x85)]}),this[_0x451ec4(0xc3)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x451ec4(0x8b)]}),this['_packageExportService']=new package_export_service_1[(_0x451ec4(0x76))]({'veevaService':this[_0x451ec4(0xca)],'connection':this[_0x451ec4(0xda)],'logger':this[_0x451ec4(0x85)]});}async[a406_0xcb273f(0xcf)](){const _0x163db6=a406_0xcb273f;try{this[_0x163db6(0x85)][_0x163db6(0xb0)](_0x163db6(0x8c));const _0x50a2a2=await this[_0x163db6(0xe9)]();await this['_logger']['updateLog']();const _0x3edb81=await this[_0x163db6(0xcb)]['export'](_0x50a2a2,SnapshotService[_0x163db6(0x90)]);await this[_0x163db6(0x85)][_0x163db6(0x7e)]();const _0x1a693a=await this[_0x163db6(0xb2)](_0x50a2a2,_0x3edb81);await this[_0x163db6(0x96)](_0x1a693a),await this[_0x163db6(0x85)][_0x163db6(0x7e)](),await this[_0x163db6(0xa8)](!![]);}catch(_0x1634c2){this[_0x163db6(0x85)][_0x163db6(0x9f)](_0x1634c2),await this[_0x163db6(0xa8)](![])[_0x163db6(0xbe)](_0x5720ae=>this[_0x163db6(0xd4)]['error'](_0x5720ae));}}async['retrieveVeevaComponents'](){const _0x51d7ec=a406_0xcb273f,_0x35b0da={'veevaService':this[_0x51d7ec(0xca)],'logger':this[_0x51d7ec(0x85)]},_0x5b0674=Array[_0x51d7ec(0xc5)](Object[_0x51d7ec(0x92)](this[_0x51d7ec(0x94)]))[_0x51d7ec(0xa5)]?new type_and_name_veeva_component_retriever_1[(_0x51d7ec(0x78))]({'value':this[_0x51d7ec(0x94)],..._0x35b0da}):new type_veeva_component_retriever_1[(_0x51d7ec(0xbb))]({'value':this[_0x51d7ec(0xdd)],'whereClause':this[_0x51d7ec(0xaa)],..._0x35b0da});return _0x5b0674[_0x51d7ec(0x9c)]();}async['createMetadataItemListWithBody'](_0x24269e,_0x554f5e){const _0x573ca3=a406_0xcb273f;var _0x40fbc3,_0x520e1a;this['_logger']['log'](_0x573ca3(0xee));const _0x2952ca=this['formMetadataItemDtoList'](_0x24269e),_0xf76ac7=_0x2952ca[_0x573ca3(0xdb)]((_0x2d0405,_0x44a578)=>_0x2d0405[_0x573ca3(0xa0)](_0x44a578[_0x573ca3(0xcc)],_0x44a578),new Map());for(const _0x454900 of _0x554f5e){for(const _0x38d91b in _0x454900[_0x573ca3(0x77)]){const {base:_0x5e1924,name:_0x492281,dir:_0x5756fc}=path_1['default']['parse'](_0x38d91b),_0x2bd00b=_0x492281+veeva_constants_1[_0x573ca3(0x80)]['DEPENDENCY_EXTENSION'];if(_0xf76ac7['has'](_0x5e1924)){const _0x235dc5=await((_0x40fbc3=_0x454900['file']([_0x5756fc,_0x5e1924][_0x573ca3(0xc4)](path_1[_0x573ca3(0xa2)][_0x573ca3(0xa7)][_0x573ca3(0x8d)])))===null||_0x40fbc3===void 0x0?void 0x0:_0x40fbc3['async']('string')),_0x2a6851=await((_0x520e1a=_0x454900[_0x573ca3(0xcd)]([_0x5756fc,_0x2bd00b][_0x573ca3(0xc4)](path_1[_0x573ca3(0xa2)][_0x573ca3(0xa7)][_0x573ca3(0x8d)])))===null||_0x520e1a===void 0x0?void 0x0:_0x520e1a[_0x573ca3(0xea)]('string'));if(_0x235dc5){const _0xbb28f7=new jszip_1['default']();_0xbb28f7[_0x573ca3(0xcd)](_0x5e1924,_0x235dc5),_0x2a6851&&_0xbb28f7[_0x573ca3(0xcd)](_0x2bd00b,this[_0x573ca3(0xae)](_0x2a6851)),_0xf76ac7[_0x573ca3(0x82)](_0x5e1924)[_0x573ca3(0xa6)]=await _0xbb28f7[_0x573ca3(0xb9)]({'type':_0x573ca3(0x74)});}}}}return _0x2952ca[_0x573ca3(0x9a)](_0x250faa=>!_0x250faa['body'])['forEach'](_0x1e5651=>{const _0x5035cd=_0x573ca3;this[_0x5035cd(0x85)]['log'](_0x5035cd(0x7c)+_0x1e5651[_0x5035cd(0xe4)]+'.'+_0x1e5651[_0x5035cd(0xd0)]+_0x5035cd(0xa4));}),_0x2952ca['filter'](_0x334e69=>_0x334e69[_0x573ca3(0xa6)]);}[a406_0xcb273f(0xae)](_0x5eba07){const _0x4a2139=a406_0xcb273f,_0x1bccb9=(0x0,sync_1[_0x4a2139(0xb8)])(_0x5eba07,{'columns':!![],'skip_empty_lines':!![]}),_0x19f3b6=_0x1bccb9[_0x4a2139(0x87)](({'In\x20Package':_0x2b43d7,..._0x4d76a7})=>_0x4d76a7);return(0x0,sync_2[_0x4a2139(0xe5)])(_0x19f3b6,{'header':!![]});}[a406_0xcb273f(0x81)](_0x4700d8){const _0x296b93=a406_0xcb273f;return _0x4700d8[_0x296b93(0x87)](_0x2bfea2=>{const _0x335677=_0x296b93,_0x482d04=new metadata_item_dto_1[(_0x335677(0x93))]();return _0x482d04[_0x335677(0xd0)]=_0x2bfea2[_0x335677(0xd0)],_0x482d04['apiName']=_0x2bfea2['name'],_0x482d04[_0x335677(0x8e)]=this[_0x335677(0xa3)],_0x482d04[_0x335677(0xcc)]=_0x2bfea2[_0x335677(0xd8)]+'.'+_0x2bfea2[_0x335677(0xd0)]+veeva_constants_1[_0x335677(0x80)][_0x335677(0xc0)],_0x482d04[_0x335677(0xe4)]=_0x2bfea2[_0x335677(0xd8)],_0x482d04['lastModifiedDate']=_0x2bfea2[_0x335677(0xf1)],_0x482d04[_0x335677(0x91)]=![],_0x482d04;});}async['saveComponentsInSalesforce'](_0x121f8d){const _0x3eae34=a406_0xcb273f;this['_logger'][_0x3eae34(0xb0)](_0x3eae34(0xef)),await this[_0x3eae34(0x8f)](_0x121f8d),this[_0x3eae34(0x85)][_0x3eae34(0xb0)](_0x3eae34(0x9e)+_0x121f8d[_0x3eae34(0xa5)]+_0x3eae34(0xc2));const _0x817688=_0x121f8d['map'](_0x1d62e9=>{const _0x43378a=_0x3eae34;return{[constants_1[_0x43378a(0xac)]+_0x43378a(0xf0)]:_0x1d62e9[_0x43378a(0xd0)],[constants_1['FLOSUM_NAMESPACE']+_0x43378a(0x98)]:_0x1d62e9[_0x43378a(0x75)],[constants_1['FLOSUM_NAMESPACE']+_0x43378a(0x84)]:_0x1d62e9['snapshotId'],[constants_1['FLOSUM_NAMESPACE']+_0x43378a(0xaf)]:_0x1d62e9[_0x43378a(0xcc)],[constants_1[_0x43378a(0xac)]+_0x43378a(0xa1)]:_0x1d62e9[_0x43378a(0x91)],[constants_1[_0x43378a(0xac)]+_0x43378a(0xb3)]:_0x1d62e9[_0x43378a(0xe4)],[constants_1[_0x43378a(0xac)]+_0x43378a(0xbf)]:_0x1d62e9['attachmentId'],[constants_1[_0x43378a(0xac)]+_0x43378a(0xb5)]:_0x1d62e9['lastModifiedDate']};}),_0xcd8265=await this[_0x3eae34(0xc3)][_0x3eae34(0x97)](constants_1[_0x3eae34(0xac)]+_0x3eae34(0xc7),_0x817688);let _0x393280=!![];_0xcd8265[_0x3eae34(0xab)]((_0x515fd2,_0x26b6b7)=>{const _0x46f726=_0x3eae34;this[_0x46f726(0x85)][_0x46f726(0xb0)]('Saving\x20'+_0x121f8d[_0x26b6b7][_0x46f726(0xe4)]+'.'+_0x121f8d[_0x26b6b7][_0x46f726(0xd0)]);if(!_0x515fd2[_0x46f726(0xeb)]){_0x393280=![];const _0x2bd7f1=new salesforce_dml_error_1[(_0x46f726(0x83))](_0x515fd2[_0x46f726(0xec)]);this[_0x46f726(0x85)][_0x46f726(0x9f)](_0x2bd7f1);}});if(!_0x393280)throw new Error(_0x3eae34(0xbc));}async[a406_0xcb273f(0x8f)](_0x55d9c9){const _0x141f0d=a406_0xcb273f,_0x3b698f=this[_0x141f0d(0xb1)](_0x55d9c9),_0x2bea92=await this[_0x141f0d(0xc3)][_0x141f0d(0x97)](SnapshotService[_0x141f0d(0x7f)],_0x3b698f),_0x269faa=[];_0x2bea92[_0x141f0d(0xab)]((_0x21eab8,_0x4f5e7d)=>{const _0x244fb0=_0x141f0d;_0x21eab8[_0x244fb0(0xeb)]?(_0x55d9c9[_0x4f5e7d]['attachmentId']=_0x21eab8['id'],_0x55d9c9[_0x4f5e7d][_0x244fb0(0x91)]=!![]):_0x269faa[_0x244fb0(0xa9)](..._0x21eab8[_0x244fb0(0xec)]);});if(_0x269faa[_0x141f0d(0xa5)])throw new salesforce_dml_error_1[(_0x141f0d(0x83))](_0x269faa);}['formAttachments'](_0x3c1afe){const _0xe1b101=a406_0xcb273f;return _0x3c1afe[_0xe1b101(0x87)](_0x4ed9f5=>({'ParentId':this[_0xe1b101(0xa3)],'Name':_0x4ed9f5['veevaComponentType'],'ContentType':'application/zip','Body':_0x4ed9f5[_0xe1b101(0xa6)],'Description':_0x4ed9f5[_0xe1b101(0xe4)]}));}async[a406_0xcb273f(0xa8)](_0x4c1166){const _0x502604=a406_0xcb273f,_0x3cabed={[constants_1[_0x502604(0xac)]+_0x502604(0xf2)]:!![],[constants_1[_0x502604(0xac)]+_0x502604(0x9b)]:!_0x4c1166},_0x5b25e7={[constants_1[_0x502604(0xac)]+_0x502604(0x9b)]:!_0x4c1166,[constants_1[_0x502604(0xac)]+_0x502604(0x7a)]:_0x4c1166,[constants_1[_0x502604(0xac)]+_0x502604(0xc9)]:_0x4c1166?status_enums_1[_0x502604(0xc1)][_0x502604(0xe1)]:status_enums_1[_0x502604(0xc1)][_0x502604(0xba)],[constants_1['FLOSUM_NAMESPACE']+_0x502604(0xbd)]:!![]};await this['_connectionSalesforce'][_0x502604(0xd5)](flosum_constants_1[_0x502604(0x79)][_0x502604(0xe2)]+'/'+constants_1[_0x502604(0xac)]+'Snapshot__c/'+this[_0x502604(0xa3)],_0x3cabed),await this[_0x502604(0x8b)]['patch'](flosum_constants_1[_0x502604(0x79)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1['FLOSUM_NAMESPACE']+_0x502604(0xd1)+this[_0x502604(0xce)],_0x5b25e7),this[_0x502604(0x85)][_0x502604(0xb0)](_0x502604(0xed)+(_0x4c1166?'successfully':'with\x20error')+'.'),await this['_logger']['updateLog']();}}exports[a406_0xcb273f(0xe3)]=SnapshotService,SnapshotService[a406_0xcb273f(0x90)]=a406_0xcb273f(0x99),SnapshotService[a406_0xcb273f(0x7f)]=a406_0xcb273f(0xc6);