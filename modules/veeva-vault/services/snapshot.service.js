const a406_0x2f9aff=a406_0x2171;(function(_0x1a3ecd,_0x381b85){const _0x288956=a406_0x2171,_0x28e14a=_0x1a3ecd();while(!![]){try{const _0x54fed1=parseInt(_0x288956(0x1c7))/0x1+parseInt(_0x288956(0x1cd))/0x2+parseInt(_0x288956(0x1a1))/0x3*(-parseInt(_0x288956(0x1c3))/0x4)+-parseInt(_0x288956(0x1ef))/0x5+parseInt(_0x288956(0x1c8))/0x6*(parseInt(_0x288956(0x205))/0x7)+parseInt(_0x288956(0x1aa))/0x8+-parseInt(_0x288956(0x1c2))/0x9;if(_0x54fed1===_0x381b85)break;else _0x28e14a['push'](_0x28e14a['shift']());}catch(_0x47bb74){_0x28e14a['push'](_0x28e14a['shift']());}}}(a406_0x12ed,0xd5d05));const a406_0x17de0e=(function(){let _0x35b54f=!![];return function(_0x3b4cda,_0x353701){const _0x326872=_0x35b54f?function(){const _0x535158=a406_0x2171;if(_0x353701){const _0x270c86=_0x353701[_0x535158(0x1fb)](_0x3b4cda,arguments);return _0x353701=null,_0x270c86;}}:function(){};return _0x35b54f=![],_0x326872;};}()),a406_0x126566=a406_0x17de0e(this,function(){const _0x48c3df=a406_0x2171;return a406_0x126566[_0x48c3df(0x1f2)]()[_0x48c3df(0x1a6)](_0x48c3df(0x1b9))['toString']()['constructor'](a406_0x126566)[_0x48c3df(0x1a6)](_0x48c3df(0x1b9));});function a406_0x2171(_0x3dfa46,_0x35e07c){const _0x4960c1=a406_0x12ed();return a406_0x2171=function(_0x126566,_0x17de0e){_0x126566=_0x126566-0x194;let _0x12ed4b=_0x4960c1[_0x126566];return _0x12ed4b;},a406_0x2171(_0x3dfa46,_0x35e07c);}a406_0x126566();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4d8617){const _0x404e2e=a406_0x2171;return _0x4d8617&&_0x4d8617[_0x404e2e(0x1eb)]?_0x4d8617:{'default':_0x4d8617};};Object[a406_0x2f9aff(0x1f0)](exports,'__esModule',{'value':!![]}),exports[a406_0x2f9aff(0x1e4)]=void 0x0;const jszip_1=__importDefault(require(a406_0x2f9aff(0x1d4))),flosum_constants_1=require(a406_0x2f9aff(0x1bc)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a406_0x2f9aff(0x1e3)),salesforce_service_1=require(a406_0x2f9aff(0x1ad)),status_enums_1=require(a406_0x2f9aff(0x1b8)),salesforce_dml_error_1=require(a406_0x2f9aff(0x1d1)),package_export_service_1=require('./package-export.service'),type_and_name_veeva_component_retriever_1=require(a406_0x2f9aff(0x1c4)),type_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type.veeva-component.retriever'),sync_1=require(a406_0x2f9aff(0x20b)),sync_2=require(a406_0x2f9aff(0x1a8)),veeva_constants_1=require(a406_0x2f9aff(0x1dd)),path_1=__importDefault(require(a406_0x2f9aff(0x1d5)));class SnapshotService{constructor({snapshotId:_0x1742e7,metadataLogId:_0x6de5b3,selectedMetaTypes:_0x51cd2d,selectedComponentMap:_0x3e701e,whereClause:_0x52f992},_0x399dc0,_0x5588d0,_0x470c8b){const _0x1e830e=a406_0x2f9aff;this[_0x1e830e(0x200)]=_0x399dc0,this[_0x1e830e(0x1ff)]=_0x5588d0,this[_0x1e830e(0x1ae)]=_0x470c8b,this['_snapshotId']=_0x1742e7,this['_metadataLogId']=_0x6de5b3,this['_selectedMetaTypes']=_0x51cd2d,this['_selectedComponentMap']=_0x3e701e,this[_0x1e830e(0x1ea)]=_0x52f992,this['_veevaService']=new veeva_service_1[(_0x1e830e(0x1b5))]({'connection':this[_0x1e830e(0x1ff)],'logger':this[_0x1e830e(0x1ae)]}),this[_0x1e830e(0x1b2)]=new salesforce_service_1[(_0x1e830e(0x1d6))]({'connection':this[_0x1e830e(0x200)]}),this[_0x1e830e(0x1be)]=new package_export_service_1[(_0x1e830e(0x19c))]({'veevaService':this[_0x1e830e(0x1b0)],'connection':this[_0x1e830e(0x1ff)],'logger':this['_logger']});}async['execute'](){const _0x124d25=a406_0x2f9aff;try{this['_logger']['log'](_0x124d25(0x201));const _0x3e1348=await this[_0x124d25(0x1a2)]();await this[_0x124d25(0x1ae)][_0x124d25(0x1dc)]();const _0x3210fc=await this[_0x124d25(0x1be)][_0x124d25(0x1d3)](_0x3e1348,SnapshotService[_0x124d25(0x1ac)]);await this[_0x124d25(0x1ae)][_0x124d25(0x1dc)]();const _0x2d50d7=await this['createMetadataItemListWithBody'](_0x3e1348,_0x3210fc);await this['saveComponentsInSalesforce'](_0x2d50d7),await this['_logger'][_0x124d25(0x1dc)](),await this[_0x124d25(0x1d2)](!![]);}catch(_0x54c7fe){this[_0x124d25(0x1ae)][_0x124d25(0x1d9)](_0x54c7fe),await this[_0x124d25(0x1d2)](![])[_0x124d25(0x197)](_0x460396=>this[_0x124d25(0x1ca)][_0x124d25(0x198)](_0x460396));}}async[a406_0x2f9aff(0x1a2)](){const _0x5cbbec=a406_0x2f9aff,_0x251e7a={'veevaService':this[_0x5cbbec(0x1b0)],'logger':this['_logger']},_0x30f996=Array[_0x5cbbec(0x1f8)](Object['values'](this[_0x5cbbec(0x1a0)]))['length']?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x5cbbec(0x1a0)],..._0x251e7a}):new type_veeva_component_retriever_1[(_0x5cbbec(0x1cb))]({'value':this['_selectedMetaTypes'],'whereClause':this[_0x5cbbec(0x1ea)],..._0x251e7a});return _0x30f996['retrieve']();}async[a406_0x2f9aff(0x20d)](_0x155931,_0x392a1c){const _0x595b65=a406_0x2f9aff;var _0x44c6f9,_0x4c5a10;this['_logger'][_0x595b65(0x1df)]('Unpack\x20zip\x20and\x20create\x20metadata\x20items.');const _0x53eb67=this[_0x595b65(0x1fe)](_0x155931),_0x5b2147=_0x53eb67[_0x595b65(0x1a9)]((_0x5a2ba4,_0x2a04d5)=>_0x5a2ba4[_0x595b65(0x1e8)](_0x2a04d5[_0x595b65(0x19d)],_0x2a04d5),new Map());for(const _0x7baac8 of _0x392a1c){for(const _0x318ee5 in _0x7baac8[_0x595b65(0x194)]){const {base:_0x3d1cd2,name:_0x33bf5e,dir:_0x224588}=path_1[_0x595b65(0x1f3)][_0x595b65(0x19f)](_0x318ee5),_0x869b0=_0x33bf5e+veeva_constants_1[_0x595b65(0x1db)][_0x595b65(0x1e7)];if(_0x5b2147[_0x595b65(0x1ba)](_0x3d1cd2)){const _0x51aa49=await((_0x44c6f9=_0x7baac8[_0x595b65(0x1e0)]([_0x224588,_0x3d1cd2][_0x595b65(0x1e5)](path_1[_0x595b65(0x1f3)][_0x595b65(0x1b6)]['sep'])))===null||_0x44c6f9===void 0x0?void 0x0:_0x44c6f9[_0x595b65(0x204)](_0x595b65(0x206))),_0x10b1dc=await((_0x4c5a10=_0x7baac8[_0x595b65(0x1e0)]([_0x224588,_0x869b0][_0x595b65(0x1e5)](path_1[_0x595b65(0x1f3)][_0x595b65(0x1b6)]['sep'])))===null||_0x4c5a10===void 0x0?void 0x0:_0x4c5a10['async'](_0x595b65(0x206)));if(_0x51aa49){const _0x2e3da2=new jszip_1['default']();_0x2e3da2[_0x595b65(0x1e0)](_0x3d1cd2,_0x51aa49),_0x10b1dc&&_0x2e3da2[_0x595b65(0x1e0)](_0x869b0,this[_0x595b65(0x1b4)](_0x10b1dc)),_0x5b2147[_0x595b65(0x1bb)](_0x3d1cd2)[_0x595b65(0x1f1)]=await _0x2e3da2['generateAsync']({'type':_0x595b65(0x207)});}}}}return _0x53eb67[_0x595b65(0x1d0)](_0x2a7d6c=>!_0x2a7d6c['body'])['forEach'](_0x497546=>{const _0x3d07af=_0x595b65;this[_0x3d07af(0x1ae)][_0x3d07af(0x1df)](_0x3d07af(0x1a5)+_0x497546[_0x3d07af(0x1fa)]+'.'+_0x497546['name']+_0x3d07af(0x1b3));}),_0x53eb67[_0x595b65(0x1d0)](_0x498f7d=>_0x498f7d[_0x595b65(0x1f1)]);}[a406_0x2f9aff(0x1b4)](_0x5f33b2){const _0x3cd570=a406_0x2f9aff,_0x2ea339=(0x0,sync_1['parse'])(_0x5f33b2,{'columns':!![],'skip_empty_lines':!![]}),_0x52b7c8=_0x2ea339[_0x3cd570(0x20a)](({'In\x20Package':_0x3e5007,..._0x536e9d})=>_0x536e9d);return(0x0,sync_2[_0x3cd570(0x1a4)])(_0x52b7c8,{'header':!![]});}[a406_0x2f9aff(0x1fe)](_0x24e0ce){const _0x5b039e=a406_0x2f9aff;return _0x24e0ce[_0x5b039e(0x20a)](_0xadf622=>{const _0x40ac45=_0x5b039e,_0x42dafe=new metadata_item_dto_1['MetadataItemDto']();return _0x42dafe[_0x40ac45(0x1d8)]=_0xadf622['name'],_0x42dafe[_0x40ac45(0x1e6)]=_0xadf622[_0x40ac45(0x1d8)],_0x42dafe[_0x40ac45(0x1ab)]=this[_0x40ac45(0x1ec)],_0x42dafe[_0x40ac45(0x19d)]=_0xadf622[_0x40ac45(0x1ee)]+'.'+_0xadf622[_0x40ac45(0x1d8)]+veeva_constants_1[_0x40ac45(0x1db)][_0x40ac45(0x1c9)],_0x42dafe[_0x40ac45(0x1fa)]=_0xadf622[_0x40ac45(0x1ee)],_0x42dafe[_0x40ac45(0x1da)]=_0xadf622[_0x40ac45(0x1da)],_0x42dafe[_0x40ac45(0x1b1)]=![],_0x42dafe;});}async['saveComponentsInSalesforce'](_0xef97e8){const _0x28e93c=a406_0x2f9aff;this[_0x28e93c(0x1ae)][_0x28e93c(0x1df)](_0x28e93c(0x1e2)),await this[_0x28e93c(0x1cc)](_0xef97e8),this[_0x28e93c(0x1ae)][_0x28e93c(0x1df)]('Saving\x20'+_0xef97e8['length']+_0x28e93c(0x1af));const _0x383b65=_0xef97e8['map'](_0x1b7873=>{const _0x237825=_0x28e93c;return{[constants_1[_0x237825(0x19e)]+_0x237825(0x1a7)]:_0x1b7873['name'],[constants_1[_0x237825(0x19e)]+'API_Name__c']:_0x1b7873[_0x237825(0x1e6)],[constants_1['FLOSUM_NAMESPACE']+'Snapshot__c']:_0x1b7873[_0x237825(0x1ab)],[constants_1[_0x237825(0x19e)]+_0x237825(0x1ce)]:_0x1b7873[_0x237825(0x19d)],[constants_1['FLOSUM_NAMESPACE']+_0x237825(0x1f4)]:_0x1b7873['isRetrieved'],[constants_1[_0x237825(0x19e)]+_0x237825(0x1fc)]:_0x1b7873[_0x237825(0x1fa)],[constants_1[_0x237825(0x19e)]+_0x237825(0x1c5)]:_0x1b7873['attachmentId'],[constants_1[_0x237825(0x19e)]+_0x237825(0x19b)]:_0x1b7873[_0x237825(0x1da)]};}),_0x2b2590=await this[_0x28e93c(0x1b2)]['insertMultipleRecords'](constants_1[_0x28e93c(0x19e)]+_0x28e93c(0x1fd),_0x383b65);let _0x45b66b=!![];_0x2b2590[_0x28e93c(0x195)]((_0x34be62,_0x47f8b5)=>{const _0x2c244c=_0x28e93c;this[_0x2c244c(0x1ae)][_0x2c244c(0x1df)](_0x2c244c(0x19a)+_0xef97e8[_0x47f8b5][_0x2c244c(0x1fa)]+'.'+_0xef97e8[_0x47f8b5][_0x2c244c(0x1d8)]);if(!_0x34be62['success']){_0x45b66b=![];const _0x4d193e=new salesforce_dml_error_1[(_0x2c244c(0x1f5))](_0x34be62[_0x2c244c(0x209)]);this[_0x2c244c(0x1ae)][_0x2c244c(0x1d9)](_0x4d193e);}});if(!_0x45b66b)throw new Error(_0x28e93c(0x1c0));}async[a406_0x2f9aff(0x1cc)](_0x127f71){const _0x36be2c=a406_0x2f9aff,_0x8c1703=this['formAttachments'](_0x127f71),_0x216102=await this['_salesforceService']['insertMultipleRecords'](SnapshotService[_0x36be2c(0x1d7)],_0x8c1703),_0x5e9c29=[];_0x216102[_0x36be2c(0x195)]((_0x29a756,_0x306059)=>{const _0x4cc52f=_0x36be2c;_0x29a756[_0x4cc52f(0x1f6)]?(_0x127f71[_0x306059]['attachmentId']=_0x29a756['id'],_0x127f71[_0x306059][_0x4cc52f(0x1b1)]=!![]):_0x5e9c29[_0x4cc52f(0x1a3)](..._0x29a756[_0x4cc52f(0x209)]);});if(_0x5e9c29[_0x36be2c(0x1cf)])throw new salesforce_dml_error_1[(_0x36be2c(0x1f5))](_0x5e9c29);}[a406_0x2f9aff(0x203)](_0x28134e){const _0x3b900a=a406_0x2f9aff;return _0x28134e[_0x3b900a(0x20a)](_0x4f2fd2=>({'ParentId':this[_0x3b900a(0x1ec)],'Name':_0x4f2fd2[_0x3b900a(0x1fa)],'ContentType':'application/zip','Body':_0x4f2fd2[_0x3b900a(0x1f1)],'Description':_0x4f2fd2[_0x3b900a(0x1fa)]}));}async[a406_0x2f9aff(0x1d2)](_0x1406fa){const _0x8d1c09=a406_0x2f9aff,_0x2fb0dc={[constants_1[_0x8d1c09(0x19e)]+_0x8d1c09(0x202)]:!![],[constants_1[_0x8d1c09(0x19e)]+_0x8d1c09(0x1f7)]:!_0x1406fa},_0x52487d={[constants_1[_0x8d1c09(0x19e)]+_0x8d1c09(0x1f7)]:!_0x1406fa,[constants_1[_0x8d1c09(0x19e)]+_0x8d1c09(0x1b7)]:_0x1406fa,[constants_1['FLOSUM_NAMESPACE']+_0x8d1c09(0x20c)]:_0x1406fa?status_enums_1['MetadataLogStatus']['COMPLETED']:status_enums_1['MetadataLogStatus'][_0x8d1c09(0x1bd)],[constants_1['FLOSUM_NAMESPACE']+_0x8d1c09(0x1ed)]:!![]};await this[_0x8d1c09(0x200)][_0x8d1c09(0x1c1)](flosum_constants_1[_0x8d1c09(0x199)][_0x8d1c09(0x196)]+'/'+constants_1[_0x8d1c09(0x19e)]+_0x8d1c09(0x1de)+this['_snapshotId'],_0x2fb0dc),await this[_0x8d1c09(0x200)][_0x8d1c09(0x1c1)](flosum_constants_1[_0x8d1c09(0x199)][_0x8d1c09(0x196)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x8d1c09(0x1f9)+this['_metadataLogId'],_0x52487d),this[_0x8d1c09(0x1ae)][_0x8d1c09(0x1df)](_0x8d1c09(0x1e9)+(_0x1406fa?_0x8d1c09(0x208):_0x8d1c09(0x1e1))+'.'),await this['_logger'][_0x8d1c09(0x1dc)]();}}function a406_0x12ed(){const _0x301ef5=['formAttachments','async','1645pMzwgb','string','base64','successfully','errors','map','csv-parse/sync','Status__c','createMetadataItemListWithBody','files','forEach','ENDPOINT_UPSERT_RECORD','catch','error','FlosumConstants','Saving\x20','Last_Modified_Date__c','PackageExportService','label','FLOSUM_NAMESPACE','parse','_selectedComponentMap','2300649AJcabN','retrieveVeevaComponents','push','stringify','Cannot\x20retrieve\x20','search','Name__c','csv-stringify/sync','reduce','13061304hEacsD','snapshotId','OUTBOUND_PACKAGE_NAME','./salesforce.service','_logger','\x20Metadata\x20Items','_veevaService','isRetrieved','_salesforceService','\x20from\x20outbound\x20package','transformDependencyFile','VeevaService','posix','Succeed__c','../enums/status.enums','(((.+)+)+)+$','has','get','../constants/flosum.constants','EXCEPTION','_packageExportService','Attachment','Cannot\x20Save\x20Metadata\x20Items','patch','9984258SFfqSn','4GRJrFX','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','Attachment_ID__c','Snapshot','154018CncYMs','20226VhdhOT','MDL_EXTENSION','_systemLogger','TypeVeevaComponentRetriever','saveAttachments','1774580PwatQQ','Label__c','length','filter','../classes/errors/salesforce-dml-error','finishSnapshot','export','jszip','path','SalesforceService','ATTACHMENT','name','logError','lastModifiedDate','VeevaConstants','updateLog','../constants/veeva.constants','Snapshot__c/','log','file','with\x20error','Saving\x20Attachments.','../../../constants','SnapshotService','join','apiName','DEPENDENCY_EXTENSION','set','Snapshot\x20completed\x20','_whereClause','__esModule','_snapshotId','Job_Completed__c','type','3570650lmlsAi','defineProperty','body','toString','default','Is_Retrieved__c','SalesforceDmlError','success','Is_Error__c','from','Metadata_Log__c/','veevaComponentType','apply','Veeva_Component_Type__c','Metadata_Item__c','formMetadataItemDtoList','_connectionVeeva','_connectionSalesforce','Snapshot\x20started.','Is_Completed__c'];a406_0x12ed=function(){return _0x301ef5;};return a406_0x12ed();}exports[a406_0x2f9aff(0x1e4)]=SnapshotService,SnapshotService['OUTBOUND_PACKAGE_NAME']=a406_0x2f9aff(0x1c6),SnapshotService[a406_0x2f9aff(0x1d7)]=a406_0x2f9aff(0x1bf);