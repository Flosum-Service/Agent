const a339_0x53805c=a339_0x566f;(function(_0x1be74b,_0x1b721c){const _0xb6db11=a339_0x566f,_0x3b44ad=_0x1be74b();while(!![]){try{const _0x41f415=-parseInt(_0xb6db11(0x117))/0x1*(parseInt(_0xb6db11(0xf2))/0x2)+parseInt(_0xb6db11(0xfa))/0x3+-parseInt(_0xb6db11(0x135))/0x4*(parseInt(_0xb6db11(0x13c))/0x5)+parseInt(_0xb6db11(0x10b))/0x6*(parseInt(_0xb6db11(0xdf))/0x7)+parseInt(_0xb6db11(0x146))/0x8+parseInt(_0xb6db11(0x14b))/0x9*(parseInt(_0xb6db11(0x144))/0xa)+parseInt(_0xb6db11(0x110))/0xb;if(_0x41f415===_0x1b721c)break;else _0x3b44ad['push'](_0x3b44ad['shift']());}catch(_0x207c32){_0x3b44ad['push'](_0x3b44ad['shift']());}}}(a339_0x20f6,0x48b3c));const a339_0x2b721b=(function(){let _0x20d330=!![];return function(_0x76b526,_0x3950d2){const _0x58defd=_0x20d330?function(){const _0x52387c=a339_0x566f;if(_0x3950d2){const _0x3adafc=_0x3950d2[_0x52387c(0x12b)](_0x76b526,arguments);return _0x3950d2=null,_0x3adafc;}}:function(){};return _0x20d330=![],_0x58defd;};}()),a339_0x1f0a64=a339_0x2b721b(this,function(){const _0x9cc4d3=a339_0x566f;return a339_0x1f0a64['toString']()['search'](_0x9cc4d3(0x11a))[_0x9cc4d3(0xe5)]()[_0x9cc4d3(0x119)](a339_0x1f0a64)[_0x9cc4d3(0x10e)](_0x9cc4d3(0x11a));});a339_0x1f0a64();function a339_0x20f6(){const _0x4c511b=['SnapshotService','665zbCivP','timeZone','saveAttachments','_connectionVeeva','metadataLogId','defineProperty','ATTACHMENT','filter','8210VEWNXh','map','1221464mMfJeR','error','get','type','_packageExportService','5085dSTFCq','finishSnapshot','Veeva_Component_Type__c','lastModifiedDate','Saving\x20','saveComponentsInSalesforce','MetadataItemDto','from','Is_Retrieved__c','selectedComponentMap','Saving\x20Attachments.','veevaComponentType','logError','11536jmXMEW','\x20Metadata\x20Items','Metadata_Item__c','./salesforce.service','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','OUTBOUND_PACKAGE_NAME','toString','reduce','log','Metadata_Log__c/','label','forEach','TypeVeevaComponentRetriever','../../../constants','_attachmentLogId','FLOSUM_NAMESPACE','./package-export.service','createMetadataItemListWithBody','./veeva.service','712118hBcXcr','Label__c','selectedMetaTypes','snapshotId','TypeAndNameVeevaComponentRetriever','API_Name__c','file','__importDefault','100992VRCEdm','insertMultipleRecords','Cannot\x20Save\x20Metadata\x20Items','errors','EXCEPTION','success','_logger','retrieveVeevaComponents','length','FlosumConstants','_veevaService','push','split','\x20from\x20outbound\x20package','execute','_selectedMetaTypes','ENDPOINT_UPSERT_RECORD','348mqdsol','Snapshot\x20completed\x20','VeevaService','search','_connectionSalesforce','2711896dEHyNZ','Snapshot__c','files','../classes/retrievers/veeva-components/type.veeva-component.retriever','Succeed__c','updateLog','attachmentLogId','1dsSEDA','PackageExportService','constructor','(((.+)+)+)+$','body','_snapshotId','Snapshot\x20started.','_salesforceService','catch','../dtos/metadata-item.dto','SalesforceDmlError','MetadataLogStatus','has','with\x20error','_metadataLogId','name','Job_Completed__c','string','attachmentId','Attachment_ID__c','apply','async','isRetrieved','formAttachments','__esModule','generateAsync','formMetadataItemDtoList','Is_Error__c','values','_timeZone','10180suLOgm','apiName','Status__c','_selectedComponentMap','patch','Name__c'];a339_0x20f6=function(){return _0x4c511b;};return a339_0x20f6();}'use strict';var __importDefault=this&&this[a339_0x53805c(0xf9)]||function(_0x2ade85){const _0x22698a=a339_0x53805c;return _0x2ade85&&_0x2ade85[_0x22698a(0x12f)]?_0x2ade85:{'default':_0x2ade85};};Object[a339_0x53805c(0x141)](exports,a339_0x53805c(0x12f),{'value':!![]}),exports[a339_0x53805c(0x13b)]=void 0x0;function a339_0x566f(_0x57dc77,_0xa70329){const _0x220ecc=a339_0x20f6();return a339_0x566f=function(_0x1f0a64,_0x2b721b){_0x1f0a64=_0x1f0a64-0xda;let _0x20f6bf=_0x220ecc[_0x1f0a64];return _0x20f6bf;},a339_0x566f(_0x57dc77,_0xa70329);}const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require(a339_0x53805c(0xf1)),metadata_item_dto_1=require(a339_0x53805c(0x120)),constants_1=require(a339_0x53805c(0xec)),salesforce_service_1=require(a339_0x53805c(0xe2)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require(a339_0x53805c(0xef)),type_and_name_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever'),type_veeva_component_retriever_1=require(a339_0x53805c(0x113));class SnapshotService{constructor(_0x22ac65,_0x245642,_0x3d8118,_0x146c8d){const _0x4a5eba=a339_0x53805c;this[_0x4a5eba(0x10f)]=_0x245642,this[_0x4a5eba(0x13f)]=_0x3d8118,this[_0x4a5eba(0x100)]=_0x146c8d,this[_0x4a5eba(0x11c)]=_0x22ac65[_0x4a5eba(0xf5)],this[_0x4a5eba(0x125)]=_0x22ac65[_0x4a5eba(0x140)],this[_0x4a5eba(0xed)]=_0x22ac65[_0x4a5eba(0x116)],this[_0x4a5eba(0x134)]=_0x22ac65[_0x4a5eba(0x13d)],this[_0x4a5eba(0x109)]=_0x22ac65[_0x4a5eba(0xf4)],this[_0x4a5eba(0x138)]=_0x22ac65[_0x4a5eba(0xdb)],this[_0x4a5eba(0x104)]=new veeva_service_1[(_0x4a5eba(0x10d))]({'connection':this[_0x4a5eba(0x13f)],'logger':this['_logger']}),this[_0x4a5eba(0x11e)]=new salesforce_service_1['SalesforceService']({'connection':this['_connectionSalesforce']}),this[_0x4a5eba(0x14a)]=new package_export_service_1[(_0x4a5eba(0x118))]({'veevaService':this[_0x4a5eba(0x104)],'connection':this[_0x4a5eba(0x13f)],'logger':this[_0x4a5eba(0x100)]});}async[a339_0x53805c(0x108)](){const _0xb132f8=a339_0x53805c;try{this[_0xb132f8(0x100)][_0xb132f8(0xe7)](_0xb132f8(0x11d));const _0x4d0374=await this[_0xb132f8(0x101)]();await this[_0xb132f8(0x100)][_0xb132f8(0x115)]();const _0x3d6df9=await this['_packageExportService']['export'](_0x4d0374,SnapshotService[_0xb132f8(0xe4)]);await this[_0xb132f8(0x100)][_0xb132f8(0x115)]();const _0x23c296=await this[_0xb132f8(0xf0)](_0x4d0374,_0x3d6df9);await this[_0xb132f8(0x150)](_0x23c296),await this[_0xb132f8(0x100)][_0xb132f8(0x115)](),await this[_0xb132f8(0x14c)](!![]);}catch(_0x2ae100){this[_0xb132f8(0x100)][_0xb132f8(0xde)](_0x2ae100),await this[_0xb132f8(0x14c)](![])[_0xb132f8(0x11f)](_0x5c564c=>this['_systemLogger'][_0xb132f8(0x147)](_0x5c564c));}}async[a339_0x53805c(0x101)](){const _0x324502=a339_0x53805c,_0x1a5500={'veevaService':this[_0x324502(0x104)],'logger':this[_0x324502(0x100)]},_0x15ec8b=Array[_0x324502(0x152)](Object[_0x324502(0x133)](this[_0x324502(0x138)]))[_0x324502(0x102)]?new type_and_name_veeva_component_retriever_1[(_0x324502(0xf6))]({'value':this[_0x324502(0x138)],..._0x1a5500}):new type_veeva_component_retriever_1[(_0x324502(0xeb))]({'value':this[_0x324502(0x109)],..._0x1a5500});return _0x15ec8b['retrieve']();}async['createMetadataItemListWithBody'](_0x194df6,_0x37cbc4){const _0x13f647=a339_0x53805c;var _0x45fac1;this[_0x13f647(0x100)][_0x13f647(0xe7)](_0x13f647(0xe3));const _0x17e046=this[_0x13f647(0x131)](_0x194df6),_0x3f5c9a=_0x17e046[_0x13f647(0xe6)]((_0x51bfa,_0x1808a6)=>_0x51bfa['set'](_0x1808a6[_0x13f647(0xe9)],_0x1808a6),new Map());for(const _0x48c383 of _0x37cbc4){for(const _0x2e12e9 in _0x48c383[_0x13f647(0x112)]){const _0x583fe4=_0x2e12e9[_0x13f647(0x106)]('/')['at'](-0x1);if(_0x3f5c9a[_0x13f647(0x123)](_0x583fe4)){const _0x13516d=await((_0x45fac1=_0x48c383[_0x13f647(0xf8)](_0x2e12e9))===null||_0x45fac1===void 0x0?void 0x0:_0x45fac1[_0x13f647(0x12c)](_0x13f647(0x128)));if(_0x13516d){const _0x3e3a49=new jszip_1['default']();_0x3e3a49[_0x13f647(0xf8)](_0x583fe4,_0x13516d),_0x3f5c9a[_0x13f647(0x148)](_0x583fe4)[_0x13f647(0x11b)]=await _0x3e3a49[_0x13f647(0x130)]({'type':'base64'});}}}}return _0x17e046[_0x13f647(0x143)](_0xd88647=>!_0xd88647[_0x13f647(0x11b)])[_0x13f647(0xea)](_0x3eef2=>{const _0x438ec1=_0x13f647;this['_logger']['log']('Cannot\x20retrieve\x20'+_0x3eef2['veevaComponentType']+'.'+_0x3eef2[_0x438ec1(0x126)]+_0x438ec1(0x107));}),_0x17e046['filter'](_0x3d4123=>_0x3d4123[_0x13f647(0x11b)]);}[a339_0x53805c(0x131)](_0x5ce094){const _0x29e265=a339_0x53805c;return _0x5ce094[_0x29e265(0x145)](_0x47dec3=>{const _0x5b9023=_0x29e265,_0x4c1a40=new metadata_item_dto_1[(_0x5b9023(0x151))]();return _0x4c1a40[_0x5b9023(0x126)]=_0x47dec3['name'],_0x4c1a40[_0x5b9023(0x136)]=_0x47dec3[_0x5b9023(0x126)],_0x4c1a40[_0x5b9023(0xf5)]=this[_0x5b9023(0x11c)],_0x4c1a40[_0x5b9023(0xe9)]=_0x47dec3[_0x5b9023(0x149)]+'.'+_0x47dec3[_0x5b9023(0x126)]+'.mdl',_0x4c1a40[_0x5b9023(0xdd)]=_0x47dec3[_0x5b9023(0x149)],_0x4c1a40[_0x5b9023(0x14e)]=_0x47dec3[_0x5b9023(0x14e)],_0x4c1a40[_0x5b9023(0x12d)]=![],_0x4c1a40;});}async[a339_0x53805c(0x150)](_0x36705){const _0x57e15e=a339_0x53805c;this[_0x57e15e(0x100)][_0x57e15e(0xe7)](_0x57e15e(0xdc)),await this[_0x57e15e(0x13e)](_0x36705),this['_logger'][_0x57e15e(0xe7)](_0x57e15e(0x14f)+_0x36705[_0x57e15e(0x102)]+_0x57e15e(0xe0));const _0x2d075a=_0x36705[_0x57e15e(0x145)](_0x45768a=>{const _0x2ea5e0=_0x57e15e;return{[constants_1[_0x2ea5e0(0xee)]+_0x2ea5e0(0x13a)]:_0x45768a[_0x2ea5e0(0x126)],[constants_1['FLOSUM_NAMESPACE']+_0x2ea5e0(0xf7)]:_0x45768a['apiName'],[constants_1[_0x2ea5e0(0xee)]+_0x2ea5e0(0x111)]:_0x45768a[_0x2ea5e0(0xf5)],[constants_1[_0x2ea5e0(0xee)]+_0x2ea5e0(0xf3)]:_0x45768a['label'],[constants_1['FLOSUM_NAMESPACE']+_0x2ea5e0(0xda)]:_0x45768a[_0x2ea5e0(0x12d)],[constants_1[_0x2ea5e0(0xee)]+_0x2ea5e0(0x14d)]:_0x45768a[_0x2ea5e0(0xdd)],[constants_1[_0x2ea5e0(0xee)]+_0x2ea5e0(0x12a)]:_0x45768a[_0x2ea5e0(0x129)],[constants_1[_0x2ea5e0(0xee)]+'Last_Modified_Date__c']:_0x45768a['lastModifiedDate']};}),_0x1b1ca0=await this['_salesforceService'][_0x57e15e(0xfb)](constants_1[_0x57e15e(0xee)]+_0x57e15e(0xe1),_0x2d075a);let _0x41b4f5=!![];_0x1b1ca0[_0x57e15e(0xea)]((_0x2b9053,_0x1e0149)=>{const _0x18138e=_0x57e15e;this[_0x18138e(0x100)][_0x18138e(0xe7)]('Saving\x20'+_0x36705[_0x1e0149][_0x18138e(0xdd)]+'.'+_0x36705[_0x1e0149]['name']);if(!_0x2b9053[_0x18138e(0xff)]){_0x41b4f5=![];const _0x2ca21b=new salesforce_dml_error_1['SalesforceDmlError'](_0x2b9053[_0x18138e(0xfd)]);this[_0x18138e(0x100)][_0x18138e(0xde)](_0x2ca21b);}});if(!_0x41b4f5)throw new Error(_0x57e15e(0xfc));}async[a339_0x53805c(0x13e)](_0x270531){const _0x21d0d5=a339_0x53805c,_0x5a732f=this[_0x21d0d5(0x12e)](_0x270531),_0x114164=await this['_salesforceService'][_0x21d0d5(0xfb)](SnapshotService[_0x21d0d5(0x142)],_0x5a732f),_0x4033b0=[];_0x114164[_0x21d0d5(0xea)]((_0x2f2185,_0x5db047)=>{const _0x94dcec=_0x21d0d5;_0x2f2185[_0x94dcec(0xff)]?(_0x270531[_0x5db047]['attachmentId']=_0x2f2185['id'],_0x270531[_0x5db047][_0x94dcec(0x12d)]=!![]):_0x4033b0[_0x94dcec(0x105)](..._0x2f2185[_0x94dcec(0xfd)]);});if(_0x4033b0[_0x21d0d5(0x102)])throw new salesforce_dml_error_1[(_0x21d0d5(0x121))](_0x4033b0);}[a339_0x53805c(0x12e)](_0x3d9b26){const _0x41dad2=a339_0x53805c;return _0x3d9b26[_0x41dad2(0x145)](_0x1bdefb=>({'ParentId':this['_snapshotId'],'Name':_0x1bdefb[_0x41dad2(0xdd)],'ContentType':'application/zip','Body':_0x1bdefb['body'],'Description':_0x1bdefb[_0x41dad2(0xdd)]}));}async[a339_0x53805c(0x14c)](_0xd161ab){const _0x1bd046=a339_0x53805c,_0x511b84={[constants_1[_0x1bd046(0xee)]+'Is_Completed__c']:!![],[constants_1[_0x1bd046(0xee)]+_0x1bd046(0x132)]:!_0xd161ab},_0x14ccac={[constants_1[_0x1bd046(0xee)]+_0x1bd046(0x132)]:!_0xd161ab,[constants_1[_0x1bd046(0xee)]+_0x1bd046(0x114)]:_0xd161ab,[constants_1[_0x1bd046(0xee)]+_0x1bd046(0x137)]:_0xd161ab?status_enums_1[_0x1bd046(0x122)]['COMPLETED']:status_enums_1['MetadataLogStatus'][_0x1bd046(0xfe)],[constants_1['FLOSUM_NAMESPACE']+_0x1bd046(0x127)]:!![]};await this[_0x1bd046(0x10f)][_0x1bd046(0x139)](flosum_constants_1[_0x1bd046(0x103)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1['FLOSUM_NAMESPACE']+'Snapshot__c/'+this['_snapshotId'],_0x511b84),await this[_0x1bd046(0x10f)][_0x1bd046(0x139)](flosum_constants_1[_0x1bd046(0x103)][_0x1bd046(0x10a)]+'/'+constants_1[_0x1bd046(0xee)]+_0x1bd046(0xe8)+this['_metadataLogId'],_0x14ccac),this[_0x1bd046(0x100)][_0x1bd046(0xe7)](_0x1bd046(0x10c)+(_0xd161ab?'successfully':_0x1bd046(0x124))+'.'),await this[_0x1bd046(0x100)][_0x1bd046(0x115)]();}}exports[a339_0x53805c(0x13b)]=SnapshotService,SnapshotService[a339_0x53805c(0xe4)]='Snapshot',SnapshotService[a339_0x53805c(0x142)]='Attachment';