function a407_0x4e39(){const _0x18c19d=['_whereClause','Cannot\x20retrieve\x20','Name__c','SalesforceDmlError','error','MetadataLogStatus','from','label','base64','finishSnapshot','type','default','parse','retrieveVeevaComponents','1329414MGdlaK','search','FlosumConstants','log','5654390nwpAIT','length','retrieve','file','Last_Modified_Date__c','Succeed__c','get','insertMultipleRecords','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','3VSnTEp','../classes/retrievers/veeva-components/type.veeva-component.retriever','successfully','./package-export.service','35scjiqM','../constants/flosum.constants','csv-stringify/sync','string','../../../constants','./salesforce.service','toString','set','snapshotId','Saving\x20','export','SnapshotService','__importDefault','_snapshotId','Attachment_ID__c','logError','saveAttachments','Status__c','MetadataItemDto','sep','jszip','_metadataLogId','API_Name__c','with\x20error','TypeAndNameVeevaComponentRetriever','path','csv-parse/sync','(((.+)+)+)+$','../dtos/metadata-item.dto','Metadata_Item__c','Snapshot','forEach','body','constructor','reduce','FLOSUM_NAMESPACE','posix','../constants/veeva.constants','map','_systemLogger','transformDependencyFile','../enums/status.enums','PackageExportService','_selectedMetaTypes','join','MDL_EXTENSION','\x20from\x20outbound\x20package','Snapshot__c','208718rXAExE','_veevaService','../classes/errors/salesforce-dml-error','COMPLETED','DEPENDENCY_EXTENSION','14946435kRbESU','Job_Completed__c','\x20Metadata\x20Items','6552108CtCeFd','822792ULRLmG','_salesforceService','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','ENDPOINT_UPSERT_RECORD','Is_Completed__c','push','veevaComponentType','Snapshot__c/','formMetadataItemDtoList','Veeva_Component_Type__c','OUTBOUND_PACKAGE_NAME','Is_Error__c','values','_packageExportService','patch','generateAsync','Snapshot\x20completed\x20','isRetrieved','_selectedComponentMap','apiName','execute','updateLog','__esModule','defineProperty','Cannot\x20Save\x20Metadata\x20Items','name','saveComponentsInSalesforce','lastModifiedDate','application/zip','async','errors','createMetadataItemListWithBody','attachmentId','_logger','_connectionVeeva','success','./veeva.service','4349892MWtQjc','VeevaConstants','_connectionSalesforce'];a407_0x4e39=function(){return _0x18c19d;};return a407_0x4e39();}const a407_0x1bacb4=a407_0x41fe;(function(_0x569323,_0x385f05){const _0x5f1c15=a407_0x41fe,_0x543d4c=_0x569323();while(!![]){try{const _0xe9d045=-parseInt(_0x5f1c15(0xbd))/0x1+parseInt(_0x5f1c15(0xfe))/0x2*(-parseInt(_0x5f1c15(0xca))/0x3)+parseInt(_0x5f1c15(0xac))/0x4+parseInt(_0x5f1c15(0xc1))/0x5+parseInt(_0x5f1c15(0x106))/0x6+parseInt(_0x5f1c15(0xce))/0x7*(parseInt(_0x5f1c15(0x107))/0x8)+-parseInt(_0x5f1c15(0x103))/0x9;if(_0xe9d045===_0x385f05)break;else _0x543d4c['push'](_0x543d4c['shift']());}catch(_0xe163bd){_0x543d4c['push'](_0x543d4c['shift']());}}}(a407_0x4e39,0xb240e));const a407_0x27c8e9=(function(){let _0x55d58a=!![];return function(_0x2c08ff,_0xbd60f9){const _0x2011c6=_0x55d58a?function(){if(_0xbd60f9){const _0x58df8c=_0xbd60f9['apply'](_0x2c08ff,arguments);return _0xbd60f9=null,_0x58df8c;}}:function(){};return _0x55d58a=![],_0x2011c6;};}()),a407_0x1a111b=a407_0x27c8e9(this,function(){const _0x27e9a8=a407_0x41fe;return a407_0x1a111b[_0x27e9a8(0xd4)]()[_0x27e9a8(0xbe)]('(((.+)+)+)+$')[_0x27e9a8(0xd4)]()[_0x27e9a8(0xef)](a407_0x1a111b)[_0x27e9a8(0xbe)](_0x27e9a8(0xe9));});a407_0x1a111b();'use strict';function a407_0x41fe(_0x53e67f,_0x1dcb02){const _0x562384=a407_0x4e39();return a407_0x41fe=function(_0x1a111b,_0x27c8e9){_0x1a111b=_0x1a111b-0x9b;let _0x4e3902=_0x562384[_0x1a111b];return _0x4e3902;},a407_0x41fe(_0x53e67f,_0x1dcb02);}var __importDefault=this&&this[a407_0x1bacb4(0xda)]||function(_0x52efed){const _0x5c1f40=a407_0x1bacb4;return _0x52efed&&_0x52efed[_0x5c1f40(0x9d)]?_0x52efed:{'default':_0x52efed};};Object[a407_0x1bacb4(0x9e)](exports,a407_0x1bacb4(0x9d),{'value':!![]}),exports[a407_0x1bacb4(0xd9)]=void 0x0;const jszip_1=__importDefault(require(a407_0x1bacb4(0xe2))),flosum_constants_1=require(a407_0x1bacb4(0xcf)),veeva_service_1=require(a407_0x1bacb4(0xab)),metadata_item_dto_1=require(a407_0x1bacb4(0xea)),constants_1=require(a407_0x1bacb4(0xd2)),salesforce_service_1=require(a407_0x1bacb4(0xd3)),status_enums_1=require(a407_0x1bacb4(0xf7)),salesforce_dml_error_1=require(a407_0x1bacb4(0x100)),package_export_service_1=require(a407_0x1bacb4(0xcd)),type_and_name_veeva_component_retriever_1=require(a407_0x1bacb4(0xc9)),type_veeva_component_retriever_1=require(a407_0x1bacb4(0xcb)),sync_1=require(a407_0x1bacb4(0xe8)),sync_2=require(a407_0x1bacb4(0xd0)),veeva_constants_1=require(a407_0x1bacb4(0xf3)),path_1=__importDefault(require(a407_0x1bacb4(0xe7)));class SnapshotService{constructor({snapshotId:_0xe50913,metadataLogId:_0x4d8111,selectedMetaTypes:_0x282c31,selectedComponentMap:_0x32e067,whereClause:_0x5218fd},_0x330cb3,_0x2572c4,_0x290a43){const _0x4d4578=a407_0x1bacb4;this[_0x4d4578(0xae)]=_0x330cb3,this[_0x4d4578(0xa9)]=_0x2572c4,this['_logger']=_0x290a43,this[_0x4d4578(0xdb)]=_0xe50913,this['_metadataLogId']=_0x4d8111,this[_0x4d4578(0xf9)]=_0x282c31,this['_selectedComponentMap']=_0x32e067,this[_0x4d4578(0xaf)]=_0x5218fd,this[_0x4d4578(0xff)]=new veeva_service_1['VeevaService']({'connection':this[_0x4d4578(0xa9)],'logger':this[_0x4d4578(0xa8)]}),this['_salesforceService']=new salesforce_service_1['SalesforceService']({'connection':this[_0x4d4578(0xae)]}),this[_0x4d4578(0x114)]=new package_export_service_1[(_0x4d4578(0xf8))]({'veevaService':this[_0x4d4578(0xff)],'connection':this[_0x4d4578(0xa9)],'logger':this[_0x4d4578(0xa8)]});}async[a407_0x1bacb4(0x9b)](){const _0x56e950=a407_0x1bacb4;try{this[_0x56e950(0xa8)][_0x56e950(0xc0)]('Snapshot\x20started.');const _0x4bd2dc=await this['retrieveVeevaComponents']();await this['_logger'][_0x56e950(0x9c)]();const _0x4f7808=await this['_packageExportService'][_0x56e950(0xd8)](_0x4bd2dc,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this[_0x56e950(0xa8)][_0x56e950(0x9c)]();const _0x4e0bb7=await this[_0x56e950(0xa6)](_0x4bd2dc,_0x4f7808);await this[_0x56e950(0xa1)](_0x4e0bb7),await this[_0x56e950(0xa8)][_0x56e950(0x9c)](),await this[_0x56e950(0xb8)](!![]);}catch(_0x4da0af){this[_0x56e950(0xa8)][_0x56e950(0xdd)](_0x4da0af),await this['finishSnapshot'](![])['catch'](_0x240347=>this[_0x56e950(0xf5)][_0x56e950(0xb3)](_0x240347));}}async[a407_0x1bacb4(0xbc)](){const _0x57f5ac=a407_0x1bacb4,_0x3defa8={'veevaService':this[_0x57f5ac(0xff)],'logger':this[_0x57f5ac(0xa8)]},_0x4a0957=Array[_0x57f5ac(0xb5)](Object[_0x57f5ac(0x113)](this[_0x57f5ac(0x119)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x57f5ac(0xe6))]({'value':this['_selectedComponentMap'],..._0x3defa8}):new type_veeva_component_retriever_1['TypeVeevaComponentRetriever']({'value':this[_0x57f5ac(0xf9)],'whereClause':this['_whereClause'],..._0x3defa8});return _0x4a0957[_0x57f5ac(0xc3)]();}async[a407_0x1bacb4(0xa6)](_0x3e5b49,_0x48a84d){const _0x58b101=a407_0x1bacb4;var _0x266a4e,_0x3266cd;this[_0x58b101(0xa8)][_0x58b101(0xc0)](_0x58b101(0x109));const _0x284f14=this['formMetadataItemDtoList'](_0x3e5b49),_0x339778=_0x284f14[_0x58b101(0xf0)]((_0x129bed,_0x1bc047)=>_0x129bed[_0x58b101(0xd5)](_0x1bc047['label'],_0x1bc047),new Map());for(const _0x7d1f99 of _0x48a84d){for(const _0x3957b9 in _0x7d1f99['files']){const {base:_0x230297,name:_0x1a7adc,dir:_0x46dbff}=path_1['default']['parse'](_0x3957b9),_0x1e0e87=_0x1a7adc+veeva_constants_1[_0x58b101(0xad)][_0x58b101(0x102)];if(_0x339778['has'](_0x230297)){const _0x1cb139=await((_0x266a4e=_0x7d1f99[_0x58b101(0xc4)]([_0x46dbff,_0x230297][_0x58b101(0xfa)](path_1['default'][_0x58b101(0xf2)][_0x58b101(0xe1)])))===null||_0x266a4e===void 0x0?void 0x0:_0x266a4e['async'](_0x58b101(0xd1))),_0x205374=await((_0x3266cd=_0x7d1f99[_0x58b101(0xc4)]([_0x46dbff,_0x1e0e87][_0x58b101(0xfa)](path_1[_0x58b101(0xba)][_0x58b101(0xf2)][_0x58b101(0xe1)])))===null||_0x3266cd===void 0x0?void 0x0:_0x3266cd[_0x58b101(0xa4)]('string'));if(_0x1cb139){const _0x46238a=new jszip_1[(_0x58b101(0xba))]();_0x46238a[_0x58b101(0xc4)](_0x230297,_0x1cb139),_0x205374&&_0x46238a[_0x58b101(0xc4)](_0x1e0e87,this[_0x58b101(0xf6)](_0x205374)),_0x339778[_0x58b101(0xc7)](_0x230297)[_0x58b101(0xee)]=await _0x46238a[_0x58b101(0x116)]({'type':_0x58b101(0xb7)});}}}}return _0x284f14['filter'](_0x204fd6=>!_0x204fd6['body'])[_0x58b101(0xed)](_0x3204a8=>{const _0x8237d6=_0x58b101;this[_0x8237d6(0xa8)][_0x8237d6(0xc0)](_0x8237d6(0xb0)+_0x3204a8[_0x8237d6(0x10d)]+'.'+_0x3204a8[_0x8237d6(0xa0)]+_0x8237d6(0xfc));}),_0x284f14['filter'](_0x3ea52e=>_0x3ea52e[_0x58b101(0xee)]);}[a407_0x1bacb4(0xf6)](_0x48f2a2){const _0x1add29=a407_0x1bacb4,_0x2a0a8a=(0x0,sync_1[_0x1add29(0xbb)])(_0x48f2a2,{'columns':!![],'skip_empty_lines':!![]}),_0x3c3a3d=_0x2a0a8a[_0x1add29(0xf4)](({'In\x20Package':_0x56be0d,..._0x1e17cf})=>_0x1e17cf);return(0x0,sync_2['stringify'])(_0x3c3a3d,{'header':!![]});}[a407_0x1bacb4(0x10f)](_0x2fdea2){return _0x2fdea2['map'](_0x37f5f0=>{const _0x4577bd=a407_0x41fe,_0x1bde00=new metadata_item_dto_1[(_0x4577bd(0xe0))]();return _0x1bde00[_0x4577bd(0xa0)]=_0x37f5f0[_0x4577bd(0xa0)],_0x1bde00[_0x4577bd(0x11a)]=_0x37f5f0[_0x4577bd(0xa0)],_0x1bde00[_0x4577bd(0xd6)]=this[_0x4577bd(0xdb)],_0x1bde00[_0x4577bd(0xb6)]=_0x37f5f0[_0x4577bd(0xb9)]+'.'+_0x37f5f0[_0x4577bd(0xa0)]+veeva_constants_1[_0x4577bd(0xad)][_0x4577bd(0xfb)],_0x1bde00[_0x4577bd(0x10d)]=_0x37f5f0[_0x4577bd(0xb9)],_0x1bde00['lastModifiedDate']=_0x37f5f0[_0x4577bd(0xa2)],_0x1bde00[_0x4577bd(0x118)]=![],_0x1bde00;});}async['saveComponentsInSalesforce'](_0x40c697){const _0x27867e=a407_0x1bacb4;this[_0x27867e(0xa8)]['log']('Saving\x20Attachments.'),await this['saveAttachments'](_0x40c697),this[_0x27867e(0xa8)][_0x27867e(0xc0)](_0x27867e(0xd7)+_0x40c697[_0x27867e(0xc2)]+_0x27867e(0x105));const _0x10b0db=_0x40c697['map'](_0x2c00bd=>{const _0xb1999a=_0x27867e;return{[constants_1[_0xb1999a(0xf1)]+_0xb1999a(0xb1)]:_0x2c00bd[_0xb1999a(0xa0)],[constants_1[_0xb1999a(0xf1)]+_0xb1999a(0xe4)]:_0x2c00bd[_0xb1999a(0x11a)],[constants_1[_0xb1999a(0xf1)]+_0xb1999a(0xfd)]:_0x2c00bd[_0xb1999a(0xd6)],[constants_1['FLOSUM_NAMESPACE']+'Label__c']:_0x2c00bd['label'],[constants_1[_0xb1999a(0xf1)]+'Is_Retrieved__c']:_0x2c00bd[_0xb1999a(0x118)],[constants_1[_0xb1999a(0xf1)]+_0xb1999a(0x110)]:_0x2c00bd['veevaComponentType'],[constants_1['FLOSUM_NAMESPACE']+_0xb1999a(0xdc)]:_0x2c00bd[_0xb1999a(0xa7)],[constants_1[_0xb1999a(0xf1)]+_0xb1999a(0xc5)]:_0x2c00bd[_0xb1999a(0xa2)]};}),_0x1c1fe=await this['_salesforceService'][_0x27867e(0xc8)](constants_1[_0x27867e(0xf1)]+_0x27867e(0xeb),_0x10b0db);let _0x20bd05=!![];_0x1c1fe[_0x27867e(0xed)]((_0x39cc37,_0x54e8e6)=>{const _0x1a27a8=_0x27867e;this[_0x1a27a8(0xa8)][_0x1a27a8(0xc0)](_0x1a27a8(0xd7)+_0x40c697[_0x54e8e6]['veevaComponentType']+'.'+_0x40c697[_0x54e8e6][_0x1a27a8(0xa0)]);if(!_0x39cc37[_0x1a27a8(0xaa)]){_0x20bd05=![];const _0x2e96e9=new salesforce_dml_error_1[(_0x1a27a8(0xb2))](_0x39cc37[_0x1a27a8(0xa5)]);this[_0x1a27a8(0xa8)][_0x1a27a8(0xdd)](_0x2e96e9);}});if(!_0x20bd05)throw new Error(_0x27867e(0x9f));}async[a407_0x1bacb4(0xde)](_0x5e61d6){const _0x47f34d=a407_0x1bacb4,_0x1e6819=this['formAttachments'](_0x5e61d6),_0x2aad70=await this[_0x47f34d(0x108)][_0x47f34d(0xc8)](SnapshotService['ATTACHMENT'],_0x1e6819),_0x43d8fa=[];_0x2aad70[_0x47f34d(0xed)]((_0x5960bb,_0x15e590)=>{const _0x3ae8c3=_0x47f34d;_0x5960bb['success']?(_0x5e61d6[_0x15e590]['attachmentId']=_0x5960bb['id'],_0x5e61d6[_0x15e590][_0x3ae8c3(0x118)]=!![]):_0x43d8fa[_0x3ae8c3(0x10c)](..._0x5960bb[_0x3ae8c3(0xa5)]);});if(_0x43d8fa[_0x47f34d(0xc2)])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x43d8fa);}['formAttachments'](_0x2aef32){const _0x1b88d5=a407_0x1bacb4;return _0x2aef32[_0x1b88d5(0xf4)](_0x3fb2cc=>({'ParentId':this[_0x1b88d5(0xdb)],'Name':_0x3fb2cc[_0x1b88d5(0x10d)],'ContentType':_0x1b88d5(0xa3),'Body':_0x3fb2cc['body'],'Description':_0x3fb2cc[_0x1b88d5(0x10d)]}));}async['finishSnapshot'](_0x2218e8){const _0x31b4df=a407_0x1bacb4,_0x511d89={[constants_1[_0x31b4df(0xf1)]+_0x31b4df(0x10b)]:!![],[constants_1['FLOSUM_NAMESPACE']+_0x31b4df(0x112)]:!_0x2218e8},_0x4de018={[constants_1[_0x31b4df(0xf1)]+_0x31b4df(0x112)]:!_0x2218e8,[constants_1[_0x31b4df(0xf1)]+_0x31b4df(0xc6)]:_0x2218e8,[constants_1[_0x31b4df(0xf1)]+_0x31b4df(0xdf)]:_0x2218e8?status_enums_1[_0x31b4df(0xb4)][_0x31b4df(0x101)]:status_enums_1[_0x31b4df(0xb4)]['EXCEPTION'],[constants_1[_0x31b4df(0xf1)]+_0x31b4df(0x104)]:!![]};await this[_0x31b4df(0xae)]['patch'](flosum_constants_1[_0x31b4df(0xbf)][_0x31b4df(0x10a)]+'/'+constants_1[_0x31b4df(0xf1)]+_0x31b4df(0x10e)+this[_0x31b4df(0xdb)],_0x511d89),await this[_0x31b4df(0xae)][_0x31b4df(0x115)](flosum_constants_1['FlosumConstants'][_0x31b4df(0x10a)]+'/'+constants_1[_0x31b4df(0xf1)]+'Metadata_Log__c/'+this[_0x31b4df(0xe3)],_0x4de018),this[_0x31b4df(0xa8)][_0x31b4df(0xc0)](_0x31b4df(0x117)+(_0x2218e8?_0x31b4df(0xcc):_0x31b4df(0xe5))+'.'),await this[_0x31b4df(0xa8)][_0x31b4df(0x9c)]();}}exports[a407_0x1bacb4(0xd9)]=SnapshotService,SnapshotService[a407_0x1bacb4(0x111)]=a407_0x1bacb4(0xec),SnapshotService['ATTACHMENT']='Attachment';