function a407_0x44d3(_0x404eb8,_0x4a77f2){const _0xeec507=a407_0x40d2();return a407_0x44d3=function(_0x1364b8,_0x26c175){_0x1364b8=_0x1364b8-0xdc;let _0x40d2de=_0xeec507[_0x1364b8];return _0x40d2de;},a407_0x44d3(_0x404eb8,_0x4a77f2);}const a407_0x77d3a4=a407_0x44d3;(function(_0x81699f,_0x342de1){const _0x26755c=a407_0x44d3,_0x1a9669=_0x81699f();while(!![]){try{const _0xa5e884=-parseInt(_0x26755c(0x109))/0x1*(parseInt(_0x26755c(0x156))/0x2)+-parseInt(_0x26755c(0xf4))/0x3*(parseInt(_0x26755c(0x158))/0x4)+parseInt(_0x26755c(0x110))/0x5*(-parseInt(_0x26755c(0xf1))/0x6)+parseInt(_0x26755c(0xdc))/0x7*(parseInt(_0x26755c(0xf7))/0x8)+-parseInt(_0x26755c(0x11a))/0x9*(-parseInt(_0x26755c(0x14e))/0xa)+-parseInt(_0x26755c(0x122))/0xb*(-parseInt(_0x26755c(0x11e))/0xc)+parseInt(_0x26755c(0x152))/0xd;if(_0xa5e884===_0x342de1)break;else _0x1a9669['push'](_0x1a9669['shift']());}catch(_0xe5962c){_0x1a9669['push'](_0x1a9669['shift']());}}}(a407_0x40d2,0xebc2f));const a407_0x26c175=(function(){let _0x22de3a=!![];return function(_0x4b00fb,_0x2a0fca){const _0x48c1c1=_0x22de3a?function(){const _0xf4a580=a407_0x44d3;if(_0x2a0fca){const _0x1b67fb=_0x2a0fca[_0xf4a580(0x102)](_0x4b00fb,arguments);return _0x2a0fca=null,_0x1b67fb;}}:function(){};return _0x22de3a=![],_0x48c1c1;};}()),a407_0x1364b8=a407_0x26c175(this,function(){const _0x59a7b5=a407_0x44d3;return a407_0x1364b8[_0x59a7b5(0x108)]()[_0x59a7b5(0xef)](_0x59a7b5(0xf5))[_0x59a7b5(0x108)]()['constructor'](a407_0x1364b8)[_0x59a7b5(0xef)](_0x59a7b5(0xf5));});a407_0x1364b8();'use strict';function a407_0x40d2(){const _0x2e0bcc=['finishSnapshot','get','Snapshot__c/','Name__c','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','filter','Is_Error__c','csv-stringify/sync','with\x20error','../dtos/metadata-item.dto','name','VeevaService','values','20eaPoGN','TypeVeevaComponentRetriever','__importDefault','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','9915841migvVb','saveAttachments','lastModifiedDate','defineProperty','14kvPzvQ','sep','1289036dtRukM','set','map','../enums/status.enums','49KvKvnK','_selectedComponentMap','Status__c','transformDependencyFile','Saving\x20','../classes/retrievers/veeva-components/type.veeva-component.retriever','Metadata_Item__c','FLOSUM_NAMESPACE','VeevaConstants','_connectionSalesforce','error','Snapshot','Snapshot\x20started.','ATTACHMENT','Last_Modified_Date__c','base64','from','FlosumConstants','veevaComponentType','search','generateAsync','3686898tgenhz','reduce','join','15KSUVss','(((.+)+)+)+$','../constants/veeva.constants','505464hMhCmZ','formMetadataItemDtoList','./veeva.service','__esModule','retrieve','PackageExportService','successfully','_systemLogger','_snapshotId','createMetadataItemListWithBody','apiName','apply','default','length','success','../constants/flosum.constants','catch','toString','52943FzTYud','Is_Completed__c','body','API_Name__c','string','\x20Metadata\x20Items','Snapshot\x20completed\x20','5CpUdLK','OUTBOUND_PACKAGE_NAME','jszip','updateLog','_veevaService','isRetrieved','SalesforceDmlError','attachmentId','Attachment','Cannot\x20retrieve\x20','2170161ktUhXy','_packageExportService','Label__c','_salesforceService','1212YaUGbj','Attachment_ID__c','_logger','formAttachments','204182uZRJtR','Job_Completed__c','errors','SnapshotService','insertMultipleRecords','snapshotId','export','log','path','_selectedMetaTypes','forEach','./salesforce.service','\x20from\x20outbound\x20package','file','_metadataLogId','_whereClause','../../../constants','Is_Retrieved__c','async','has','../classes/errors/salesforce-dml-error','Snapshot__c','_connectionVeeva','SalesforceService','parse','posix','saveComponentsInSalesforce','retrieveVeevaComponents','patch','MetadataLogStatus','MDL_EXTENSION'];a407_0x40d2=function(){return _0x2e0bcc;};return a407_0x40d2();}var __importDefault=this&&this[a407_0x77d3a4(0x150)]||function(_0x502e0c){const _0xda23d=a407_0x77d3a4;return _0x502e0c&&_0x502e0c[_0xda23d(0xfa)]?_0x502e0c:{'default':_0x502e0c};};Object[a407_0x77d3a4(0x155)](exports,'__esModule',{'value':!![]}),exports[a407_0x77d3a4(0x125)]=void 0x0;const jszip_1=__importDefault(require(a407_0x77d3a4(0x112))),flosum_constants_1=require(a407_0x77d3a4(0x106)),veeva_service_1=require(a407_0x77d3a4(0xf9)),metadata_item_dto_1=require(a407_0x77d3a4(0x14a)),constants_1=require(a407_0x77d3a4(0x132)),salesforce_service_1=require(a407_0x77d3a4(0x12d)),status_enums_1=require(a407_0x77d3a4(0x15b)),salesforce_dml_error_1=require(a407_0x77d3a4(0x136)),package_export_service_1=require('./package-export.service'),type_and_name_veeva_component_retriever_1=require(a407_0x77d3a4(0x145)),type_veeva_component_retriever_1=require(a407_0x77d3a4(0xe1)),sync_1=require('csv-parse/sync'),sync_2=require(a407_0x77d3a4(0x148)),veeva_constants_1=require(a407_0x77d3a4(0xf6)),path_1=__importDefault(require(a407_0x77d3a4(0x12a)));class SnapshotService{constructor({snapshotId:_0x55ac95,metadataLogId:_0x49bdd8,selectedMetaTypes:_0x15ce94,selectedComponentMap:_0x34ad58,whereClause:_0x30fb79},_0x3c77b1,_0x3ac972,_0x4af4df){const _0x203077=a407_0x77d3a4;this[_0x203077(0xe5)]=_0x3c77b1,this[_0x203077(0x138)]=_0x3ac972,this[_0x203077(0x120)]=_0x4af4df,this[_0x203077(0xff)]=_0x55ac95,this[_0x203077(0x130)]=_0x49bdd8,this['_selectedMetaTypes']=_0x15ce94,this[_0x203077(0xdd)]=_0x34ad58,this[_0x203077(0x131)]=_0x30fb79,this['_veevaService']=new veeva_service_1[(_0x203077(0x14c))]({'connection':this[_0x203077(0x138)],'logger':this['_logger']}),this[_0x203077(0x11d)]=new salesforce_service_1[(_0x203077(0x139))]({'connection':this['_connectionSalesforce']}),this[_0x203077(0x11b)]=new package_export_service_1[(_0x203077(0xfc))]({'veevaService':this[_0x203077(0x114)],'connection':this['_connectionVeeva'],'logger':this[_0x203077(0x120)]});}async['execute'](){const _0x41e516=a407_0x77d3a4;try{this[_0x41e516(0x120)]['log'](_0x41e516(0xe8));const _0x33a72d=await this[_0x41e516(0x13d)]();await this['_logger']['updateLog']();const _0x21af66=await this[_0x41e516(0x11b)][_0x41e516(0x128)](_0x33a72d,SnapshotService[_0x41e516(0x111)]);await this[_0x41e516(0x120)][_0x41e516(0x113)]();const _0x1206a2=await this[_0x41e516(0x100)](_0x33a72d,_0x21af66);await this[_0x41e516(0x13c)](_0x1206a2),await this[_0x41e516(0x120)][_0x41e516(0x113)](),await this[_0x41e516(0x141)](!![]);}catch(_0x1b302f){this['_logger']['logError'](_0x1b302f),await this[_0x41e516(0x141)](![])[_0x41e516(0x107)](_0x2e4ffb=>this[_0x41e516(0xfe)][_0x41e516(0xe6)](_0x2e4ffb));}}async[a407_0x77d3a4(0x13d)](){const _0x5810d6=a407_0x77d3a4,_0x3caee4={'veevaService':this[_0x5810d6(0x114)],'logger':this['_logger']},_0x28a198=Array[_0x5810d6(0xec)](Object[_0x5810d6(0x14d)](this[_0x5810d6(0xdd)]))[_0x5810d6(0x104)]?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x5810d6(0xdd)],..._0x3caee4}):new type_veeva_component_retriever_1[(_0x5810d6(0x14f))]({'value':this[_0x5810d6(0x12b)],'whereClause':this['_whereClause'],..._0x3caee4});return _0x28a198[_0x5810d6(0xfb)]();}async[a407_0x77d3a4(0x100)](_0x1521e9,_0x5b3f4e){const _0x649e5b=a407_0x77d3a4;var _0x351182,_0x5e92fe;this['_logger'][_0x649e5b(0x129)](_0x649e5b(0x151));const _0x454b33=this[_0x649e5b(0xf8)](_0x1521e9),_0x542131=_0x454b33[_0x649e5b(0xf2)]((_0x45dbf8,_0x1e5786)=>_0x45dbf8[_0x649e5b(0x159)](_0x1e5786['label'],_0x1e5786),new Map());for(const _0x59f6b2 of _0x5b3f4e){for(const _0x463acd in _0x59f6b2['files']){const {base:_0x435210,name:_0x564486,dir:_0x1f11eb}=path_1['default'][_0x649e5b(0x13a)](_0x463acd),_0x5d3fe4=_0x564486+veeva_constants_1[_0x649e5b(0xe4)]['DEPENDENCY_EXTENSION'];if(_0x542131[_0x649e5b(0x135)](_0x435210)){const _0x166ab8=await((_0x351182=_0x59f6b2[_0x649e5b(0x12f)]([_0x1f11eb,_0x435210][_0x649e5b(0xf3)](path_1['default'][_0x649e5b(0x13b)][_0x649e5b(0x157)])))===null||_0x351182===void 0x0?void 0x0:_0x351182[_0x649e5b(0x134)]('string')),_0x5bcc50=await((_0x5e92fe=_0x59f6b2['file']([_0x1f11eb,_0x5d3fe4][_0x649e5b(0xf3)](path_1[_0x649e5b(0x103)]['posix'][_0x649e5b(0x157)])))===null||_0x5e92fe===void 0x0?void 0x0:_0x5e92fe[_0x649e5b(0x134)](_0x649e5b(0x10d)));if(_0x166ab8){const _0x44546b=new jszip_1[(_0x649e5b(0x103))]();_0x44546b['file'](_0x435210,_0x166ab8),_0x5bcc50&&_0x44546b[_0x649e5b(0x12f)](_0x5d3fe4,this[_0x649e5b(0xdf)](_0x5bcc50)),_0x542131[_0x649e5b(0x142)](_0x435210)['body']=await _0x44546b[_0x649e5b(0xf0)]({'type':_0x649e5b(0xeb)});}}}}return _0x454b33[_0x649e5b(0x146)](_0x2fa20f=>!_0x2fa20f[_0x649e5b(0x10b)])[_0x649e5b(0x12c)](_0xc777c=>{const _0x5a17b2=_0x649e5b;this[_0x5a17b2(0x120)][_0x5a17b2(0x129)](_0x5a17b2(0x119)+_0xc777c[_0x5a17b2(0xee)]+'.'+_0xc777c[_0x5a17b2(0x14b)]+_0x5a17b2(0x12e));}),_0x454b33[_0x649e5b(0x146)](_0x2f97af=>_0x2f97af[_0x649e5b(0x10b)]);}[a407_0x77d3a4(0xdf)](_0x3c3dd9){const _0x3998b8=(0x0,sync_1['parse'])(_0x3c3dd9,{'columns':!![],'skip_empty_lines':!![]}),_0x29265b=_0x3998b8['map'](({'In\x20Package':_0x4021ee,..._0x3d2a8d})=>_0x3d2a8d);return(0x0,sync_2['stringify'])(_0x29265b,{'header':!![]});}[a407_0x77d3a4(0xf8)](_0x524329){const _0x48d029=a407_0x77d3a4;return _0x524329[_0x48d029(0x15a)](_0x33bcfa=>{const _0x464fca=_0x48d029,_0x5f44b2=new metadata_item_dto_1['MetadataItemDto']();return _0x5f44b2[_0x464fca(0x14b)]=_0x33bcfa['name'],_0x5f44b2['apiName']=_0x33bcfa[_0x464fca(0x14b)],_0x5f44b2[_0x464fca(0x127)]=this[_0x464fca(0xff)],_0x5f44b2['label']=_0x33bcfa['type']+'.'+_0x33bcfa['name']+veeva_constants_1[_0x464fca(0xe4)][_0x464fca(0x140)],_0x5f44b2[_0x464fca(0xee)]=_0x33bcfa['type'],_0x5f44b2[_0x464fca(0x154)]=_0x33bcfa[_0x464fca(0x154)],_0x5f44b2['isRetrieved']=![],_0x5f44b2;});}async[a407_0x77d3a4(0x13c)](_0xcdaf0b){const _0x3bdc58=a407_0x77d3a4;this['_logger'][_0x3bdc58(0x129)]('Saving\x20Attachments.'),await this[_0x3bdc58(0x153)](_0xcdaf0b),this['_logger'][_0x3bdc58(0x129)]('Saving\x20'+_0xcdaf0b[_0x3bdc58(0x104)]+_0x3bdc58(0x10e));const _0x1eab2f=_0xcdaf0b[_0x3bdc58(0x15a)](_0x3ec0b4=>{const _0x1c925c=_0x3bdc58;return{[constants_1[_0x1c925c(0xe3)]+_0x1c925c(0x144)]:_0x3ec0b4['name'],[constants_1['FLOSUM_NAMESPACE']+_0x1c925c(0x10c)]:_0x3ec0b4[_0x1c925c(0x101)],[constants_1[_0x1c925c(0xe3)]+_0x1c925c(0x137)]:_0x3ec0b4[_0x1c925c(0x127)],[constants_1[_0x1c925c(0xe3)]+_0x1c925c(0x11c)]:_0x3ec0b4['label'],[constants_1[_0x1c925c(0xe3)]+_0x1c925c(0x133)]:_0x3ec0b4[_0x1c925c(0x115)],[constants_1['FLOSUM_NAMESPACE']+'Veeva_Component_Type__c']:_0x3ec0b4[_0x1c925c(0xee)],[constants_1['FLOSUM_NAMESPACE']+_0x1c925c(0x11f)]:_0x3ec0b4[_0x1c925c(0x117)],[constants_1[_0x1c925c(0xe3)]+_0x1c925c(0xea)]:_0x3ec0b4[_0x1c925c(0x154)]};}),_0x56b80f=await this[_0x3bdc58(0x11d)]['insertMultipleRecords'](constants_1['FLOSUM_NAMESPACE']+_0x3bdc58(0xe2),_0x1eab2f);let _0x48f14c=!![];_0x56b80f[_0x3bdc58(0x12c)]((_0x1985d5,_0x31c2b8)=>{const _0x5b22de=_0x3bdc58;this[_0x5b22de(0x120)][_0x5b22de(0x129)](_0x5b22de(0xe0)+_0xcdaf0b[_0x31c2b8][_0x5b22de(0xee)]+'.'+_0xcdaf0b[_0x31c2b8][_0x5b22de(0x14b)]);if(!_0x1985d5[_0x5b22de(0x105)]){_0x48f14c=![];const _0x410faf=new salesforce_dml_error_1[(_0x5b22de(0x116))](_0x1985d5[_0x5b22de(0x124)]);this[_0x5b22de(0x120)]['logError'](_0x410faf);}});if(!_0x48f14c)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async[a407_0x77d3a4(0x153)](_0x1a5fd6){const _0x15973b=a407_0x77d3a4,_0x5212ad=this[_0x15973b(0x121)](_0x1a5fd6),_0x32ccea=await this['_salesforceService'][_0x15973b(0x126)](SnapshotService[_0x15973b(0xe9)],_0x5212ad),_0x16a439=[];_0x32ccea[_0x15973b(0x12c)]((_0x42252c,_0x23b950)=>{const _0xf24bec=_0x15973b;_0x42252c[_0xf24bec(0x105)]?(_0x1a5fd6[_0x23b950][_0xf24bec(0x117)]=_0x42252c['id'],_0x1a5fd6[_0x23b950]['isRetrieved']=!![]):_0x16a439['push'](..._0x42252c[_0xf24bec(0x124)]);});if(_0x16a439['length'])throw new salesforce_dml_error_1[(_0x15973b(0x116))](_0x16a439);}['formAttachments'](_0x2c59a9){const _0x2c4150=a407_0x77d3a4;return _0x2c59a9[_0x2c4150(0x15a)](_0x316683=>({'ParentId':this[_0x2c4150(0xff)],'Name':_0x316683[_0x2c4150(0xee)],'ContentType':'application/zip','Body':_0x316683['body'],'Description':_0x316683[_0x2c4150(0xee)]}));}async[a407_0x77d3a4(0x141)](_0x1b84ad){const _0x2cf6c8=a407_0x77d3a4,_0xa9aacd={[constants_1[_0x2cf6c8(0xe3)]+_0x2cf6c8(0x10a)]:!![],[constants_1[_0x2cf6c8(0xe3)]+_0x2cf6c8(0x147)]:!_0x1b84ad},_0x41de69={[constants_1['FLOSUM_NAMESPACE']+_0x2cf6c8(0x147)]:!_0x1b84ad,[constants_1[_0x2cf6c8(0xe3)]+'Succeed__c']:_0x1b84ad,[constants_1[_0x2cf6c8(0xe3)]+_0x2cf6c8(0xde)]:_0x1b84ad?status_enums_1[_0x2cf6c8(0x13f)]['COMPLETED']:status_enums_1[_0x2cf6c8(0x13f)]['EXCEPTION'],[constants_1[_0x2cf6c8(0xe3)]+_0x2cf6c8(0x123)]:!![]};await this[_0x2cf6c8(0xe5)][_0x2cf6c8(0x13e)](flosum_constants_1['FlosumConstants']['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x2cf6c8(0xe3)]+_0x2cf6c8(0x143)+this['_snapshotId'],_0xa9aacd),await this[_0x2cf6c8(0xe5)]['patch'](flosum_constants_1[_0x2cf6c8(0xed)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x2cf6c8(0xe3)]+'Metadata_Log__c/'+this['_metadataLogId'],_0x41de69),this[_0x2cf6c8(0x120)][_0x2cf6c8(0x129)](_0x2cf6c8(0x10f)+(_0x1b84ad?_0x2cf6c8(0xfd):_0x2cf6c8(0x149))+'.'),await this[_0x2cf6c8(0x120)][_0x2cf6c8(0x113)]();}}exports[a407_0x77d3a4(0x125)]=SnapshotService,SnapshotService[a407_0x77d3a4(0x111)]=a407_0x77d3a4(0xe7),SnapshotService[a407_0x77d3a4(0xe9)]=a407_0x77d3a4(0x118);