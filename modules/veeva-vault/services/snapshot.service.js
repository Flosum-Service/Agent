const a363_0x43332b=a363_0x524f;(function(_0x49d5d0,_0x494d31){const _0x23810c=a363_0x524f,_0x27bcf5=_0x49d5d0();while(!![]){try{const _0x1ba0f0=parseInt(_0x23810c(0xbe))/0x1*(-parseInt(_0x23810c(0x86))/0x2)+parseInt(_0x23810c(0xbd))/0x3*(-parseInt(_0x23810c(0xcb))/0x4)+-parseInt(_0x23810c(0x6e))/0x5*(-parseInt(_0x23810c(0xc2))/0x6)+parseInt(_0x23810c(0xe8))/0x7*(-parseInt(_0x23810c(0xe4))/0x8)+-parseInt(_0x23810c(0x9a))/0x9+-parseInt(_0x23810c(0xce))/0xa*(-parseInt(_0x23810c(0x83))/0xb)+-parseInt(_0x23810c(0x9c))/0xc*(-parseInt(_0x23810c(0x93))/0xd);if(_0x1ba0f0===_0x494d31)break;else _0x27bcf5['push'](_0x27bcf5['shift']());}catch(_0x45f1ae){_0x27bcf5['push'](_0x27bcf5['shift']());}}}(a363_0x379d,0xc724e));const a363_0x4f6199=(function(){let _0x52e742=!![];return function(_0x342d36,_0x5d5bd0){const _0x42dd92=_0x52e742?function(){const _0x1c13c0=a363_0x524f;if(_0x5d5bd0){const _0x3109f7=_0x5d5bd0[_0x1c13c0(0x79)](_0x342d36,arguments);return _0x5d5bd0=null,_0x3109f7;}}:function(){};return _0x52e742=![],_0x42dd92;};}()),a363_0x38eb79=a363_0x4f6199(this,function(){const _0x5d75df=a363_0x524f;return a363_0x38eb79['toString']()['search'](_0x5d75df(0xd8))[_0x5d75df(0x8a)]()[_0x5d75df(0x8b)](a363_0x38eb79)[_0x5d75df(0xc1)](_0x5d75df(0xd8));});a363_0x38eb79();function a363_0x524f(_0x2bde,_0x440f4d){const _0x1d9828=a363_0x379d();return a363_0x524f=function(_0x38eb79,_0x4f6199){_0x38eb79=_0x38eb79-0x67;let _0x379d78=_0x1d9828[_0x38eb79];return _0x379d78;},a363_0x524f(_0x2bde,_0x440f4d);}'use strict';function a363_0x379d(){const _0x3cc3fd=['Label__c','18ZBWIQG','log','from','execute','toString','constructor','selectedMetaTypes','lastModifiedDate','async','Status__c','label','apiName','SalesforceService','9590815dGajUC','application/zip','defineProperty','Cannot\x20retrieve\x20','_veevaService','Succeed__c','Snapshot__c/','136242IyFvKT','formAttachments','12sjXpJK','Snapshot\x20started.','_connectionVeeva','_logger','string','path','COMPLETED','filter','isRetrieved','../enums/status.enums','FlosumConstants','Saving\x20','../classes/retrievers/veeva-components/type.veeva-component.retriever','parse','SnapshotService','set','Attachment','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','OUTBOUND_PACKAGE_NAME','TypeAndNameVeevaComponentRetriever','DEPENDENCY_EXTENSION','type','files','__esModule','../../../constants','error','has','saveComponentsInSalesforce','Snapshot__c','sep','attachmentId','success','metadataLogId','215664srwNib','12447VaQpOy','selectedComponentMap','FLOSUM_NAMESPACE','search','278232KFKfih','csv-parse/sync','length','push','Last_Modified_Date__c','jszip','posix','logError','attachmentLogId','48iGeuAK','snapshotId','ENDPOINT_UPSERT_RECORD','1250iCmPyC','MetadataItemDto','errors','Is_Error__c','_snapshotId','veevaComponentType','name','ATTACHMENT','./salesforce.service','Metadata_Log__c/','(((.+)+)+)+$','transformDependencyFile','../constants/flosum.constants','body','default','TypeVeevaComponentRetriever','retrieve','retrieveVeevaComponents','timeZone','stringify','map','_salesforceService','9091112RFNCfV','forEach','_timeZone','VeevaService','7gBVChr','_selectedMetaTypes','PackageExportService','MetadataLogStatus','VeevaConstants','patch','EXCEPTION','Saving\x20Attachments.','updateLog','finishSnapshot','175tVMGSV','_connectionSalesforce','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','\x20Metadata\x20Items','./package-export.service','_metadataLogId','API_Name__c','Veeva_Component_Type__c','Cannot\x20Save\x20Metadata\x20Items','../classes/errors/salesforce-dml-error','Is_Retrieved__c','apply','join','file','createMetadataItemListWithBody','catch','Is_Completed__c','formMetadataItemDtoList','\x20from\x20outbound\x20package','generateAsync','base64','51139RYnKqp','saveAttachments'];a363_0x379d=function(){return _0x3cc3fd;};return a363_0x379d();}var __importDefault=this&&this['__importDefault']||function(_0x26fb8c){return _0x26fb8c&&_0x26fb8c['__esModule']?_0x26fb8c:{'default':_0x26fb8c};};Object[a363_0x43332b(0x95)](exports,a363_0x43332b(0xb3),{'value':!![]}),exports[a363_0x43332b(0xaa)]=void 0x0;const jszip_1=__importDefault(require(a363_0x43332b(0xc7))),flosum_constants_1=require(a363_0x43332b(0xda)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a363_0x43332b(0xb4)),salesforce_service_1=require(a363_0x43332b(0xd6)),status_enums_1=require(a363_0x43332b(0xa5)),salesforce_dml_error_1=require(a363_0x43332b(0x77)),package_export_service_1=require(a363_0x43332b(0x72)),type_and_name_veeva_component_retriever_1=require(a363_0x43332b(0xad)),type_veeva_component_retriever_1=require(a363_0x43332b(0xa8)),sync_1=require(a363_0x43332b(0xc3)),sync_2=require('csv-stringify/sync'),veeva_constants_1=require('../constants/veeva.constants'),path_1=__importDefault(require(a363_0x43332b(0xa1)));class SnapshotService{constructor(_0xa83809,_0x175654,_0x578af6,_0x1f3361){const _0x3fcce3=a363_0x43332b;this[_0x3fcce3(0x6f)]=_0x175654,this[_0x3fcce3(0x9e)]=_0x578af6,this[_0x3fcce3(0x9f)]=_0x1f3361,this[_0x3fcce3(0xd2)]=_0xa83809['snapshotId'],this[_0x3fcce3(0x73)]=_0xa83809[_0x3fcce3(0xbc)],this['_attachmentLogId']=_0xa83809[_0x3fcce3(0xca)],this[_0x3fcce3(0xe6)]=_0xa83809[_0x3fcce3(0xe0)],this[_0x3fcce3(0xe9)]=_0xa83809[_0x3fcce3(0x8c)],this['_selectedComponentMap']=_0xa83809[_0x3fcce3(0xbf)],this[_0x3fcce3(0x97)]=new veeva_service_1[(_0x3fcce3(0xe7))]({'connection':this[_0x3fcce3(0x9e)],'logger':this[_0x3fcce3(0x9f)]}),this['_salesforceService']=new salesforce_service_1[(_0x3fcce3(0x92))]({'connection':this[_0x3fcce3(0x6f)]}),this['_packageExportService']=new package_export_service_1[(_0x3fcce3(0xea))]({'veevaService':this['_veevaService'],'connection':this[_0x3fcce3(0x9e)],'logger':this[_0x3fcce3(0x9f)]});}async[a363_0x43332b(0x89)](){const _0x1c8596=a363_0x43332b;try{this['_logger']['log'](_0x1c8596(0x9d));const _0xb7356=await this[_0x1c8596(0xdf)]();await this['_logger'][_0x1c8596(0x6c)]();const _0x42aa6b=await this['_packageExportService']['export'](_0xb7356,SnapshotService[_0x1c8596(0xae)]);await this[_0x1c8596(0x9f)][_0x1c8596(0x6c)]();const _0x697f61=await this[_0x1c8596(0x7c)](_0xb7356,_0x42aa6b);await this[_0x1c8596(0xb7)](_0x697f61),await this[_0x1c8596(0x9f)][_0x1c8596(0x6c)](),await this[_0x1c8596(0x6d)](!![]);}catch(_0x651a8c){this[_0x1c8596(0x9f)]['logError'](_0x651a8c),await this[_0x1c8596(0x6d)](![])[_0x1c8596(0x7d)](_0x49e0eb=>this['_systemLogger'][_0x1c8596(0xb5)](_0x49e0eb));}}async[a363_0x43332b(0xdf)](){const _0x26fe56=a363_0x43332b,_0x5af655={'veevaService':this[_0x26fe56(0x97)],'logger':this[_0x26fe56(0x9f)]},_0x35cd4f=Array[_0x26fe56(0x88)](Object['values'](this['_selectedComponentMap']))[_0x26fe56(0xc4)]?new type_and_name_veeva_component_retriever_1[(_0x26fe56(0xaf))]({'value':this['_selectedComponentMap'],..._0x5af655}):new type_veeva_component_retriever_1[(_0x26fe56(0xdd))]({'value':this[_0x26fe56(0xe9)],..._0x5af655});return _0x35cd4f[_0x26fe56(0xde)]();}async[a363_0x43332b(0x7c)](_0x878bb3,_0x27b7d0){const _0x28ceae=a363_0x43332b;var _0x1f6ea9,_0x4d196b;this[_0x28ceae(0x9f)][_0x28ceae(0x87)](_0x28ceae(0x70));const _0x3af5fa=this[_0x28ceae(0x7f)](_0x878bb3),_0x30f45c=_0x3af5fa['reduce']((_0x11e439,_0x2d6f69)=>_0x11e439[_0x28ceae(0xab)](_0x2d6f69[_0x28ceae(0x90)],_0x2d6f69),new Map());for(const _0x14c9d9 of _0x27b7d0){for(const _0x42ca3d in _0x14c9d9[_0x28ceae(0xb2)]){const {base:_0x16e887,name:_0x46acf7,dir:_0x1cdabb}=path_1[_0x28ceae(0xdc)][_0x28ceae(0xa9)](_0x42ca3d),_0x51c055=_0x46acf7+veeva_constants_1[_0x28ceae(0x68)][_0x28ceae(0xb0)];if(_0x30f45c[_0x28ceae(0xb6)](_0x16e887)){const _0x34306a=await((_0x1f6ea9=_0x14c9d9['file']([_0x1cdabb,_0x16e887][_0x28ceae(0x7a)](path_1[_0x28ceae(0xdc)][_0x28ceae(0xc8)][_0x28ceae(0xb9)])))===null||_0x1f6ea9===void 0x0?void 0x0:_0x1f6ea9[_0x28ceae(0x8e)](_0x28ceae(0xa0))),_0x3a75f3=await((_0x4d196b=_0x14c9d9['file']([_0x1cdabb,_0x51c055][_0x28ceae(0x7a)](path_1[_0x28ceae(0xdc)][_0x28ceae(0xc8)][_0x28ceae(0xb9)])))===null||_0x4d196b===void 0x0?void 0x0:_0x4d196b['async'](_0x28ceae(0xa0)));if(_0x34306a){const _0x1c53d4=new jszip_1[(_0x28ceae(0xdc))]();_0x1c53d4[_0x28ceae(0x7b)](_0x16e887,_0x34306a),_0x3a75f3&&_0x1c53d4[_0x28ceae(0x7b)](_0x51c055,this[_0x28ceae(0xd9)](_0x3a75f3)),_0x30f45c['get'](_0x16e887)[_0x28ceae(0xdb)]=await _0x1c53d4[_0x28ceae(0x81)]({'type':_0x28ceae(0x82)});}}}}return _0x3af5fa[_0x28ceae(0xa3)](_0x2f1eb1=>!_0x2f1eb1[_0x28ceae(0xdb)])[_0x28ceae(0xe5)](_0x4b1437=>{const _0x1a3d04=_0x28ceae;this['_logger'][_0x1a3d04(0x87)](_0x1a3d04(0x96)+_0x4b1437[_0x1a3d04(0xd3)]+'.'+_0x4b1437[_0x1a3d04(0xd4)]+_0x1a3d04(0x80));}),_0x3af5fa[_0x28ceae(0xa3)](_0x1595ce=>_0x1595ce[_0x28ceae(0xdb)]);}['transformDependencyFile'](_0x1a24cd){const _0x24269c=a363_0x43332b,_0x3608eb=(0x0,sync_1[_0x24269c(0xa9)])(_0x1a24cd,{'columns':!![],'skip_empty_lines':!![]}),_0x4b730f=_0x3608eb[_0x24269c(0xe2)](({'In\x20Package':_0x3960fa,..._0x205315})=>_0x205315);return(0x0,sync_2[_0x24269c(0xe1)])(_0x4b730f,{'header':!![]});}[a363_0x43332b(0x7f)](_0x437401){const _0x3f0f53=a363_0x43332b;return _0x437401[_0x3f0f53(0xe2)](_0x1b16cf=>{const _0x26ea57=_0x3f0f53,_0x14a9b5=new metadata_item_dto_1[(_0x26ea57(0xcf))]();return _0x14a9b5[_0x26ea57(0xd4)]=_0x1b16cf['name'],_0x14a9b5[_0x26ea57(0x91)]=_0x1b16cf[_0x26ea57(0xd4)],_0x14a9b5['snapshotId']=this[_0x26ea57(0xd2)],_0x14a9b5[_0x26ea57(0x90)]=_0x1b16cf[_0x26ea57(0xb1)]+'.'+_0x1b16cf[_0x26ea57(0xd4)]+veeva_constants_1['VeevaConstants']['MDL_EXTENSION'],_0x14a9b5[_0x26ea57(0xd3)]=_0x1b16cf['type'],_0x14a9b5[_0x26ea57(0x8d)]=_0x1b16cf[_0x26ea57(0x8d)],_0x14a9b5[_0x26ea57(0xa4)]=![],_0x14a9b5;});}async[a363_0x43332b(0xb7)](_0x2e5e54){const _0x19a608=a363_0x43332b;this[_0x19a608(0x9f)][_0x19a608(0x87)](_0x19a608(0x6b)),await this[_0x19a608(0x84)](_0x2e5e54),this[_0x19a608(0x9f)]['log'](_0x19a608(0xa7)+_0x2e5e54[_0x19a608(0xc4)]+_0x19a608(0x71));const _0x4af9cc=_0x2e5e54[_0x19a608(0xe2)](_0x499d66=>{const _0x5688cd=_0x19a608;return{[constants_1[_0x5688cd(0xc0)]+'Name__c']:_0x499d66[_0x5688cd(0xd4)],[constants_1['FLOSUM_NAMESPACE']+_0x5688cd(0x74)]:_0x499d66[_0x5688cd(0x91)],[constants_1[_0x5688cd(0xc0)]+_0x5688cd(0xb8)]:_0x499d66[_0x5688cd(0xcc)],[constants_1['FLOSUM_NAMESPACE']+_0x5688cd(0x85)]:_0x499d66['label'],[constants_1[_0x5688cd(0xc0)]+_0x5688cd(0x78)]:_0x499d66[_0x5688cd(0xa4)],[constants_1[_0x5688cd(0xc0)]+_0x5688cd(0x75)]:_0x499d66[_0x5688cd(0xd3)],[constants_1[_0x5688cd(0xc0)]+'Attachment_ID__c']:_0x499d66[_0x5688cd(0xba)],[constants_1[_0x5688cd(0xc0)]+_0x5688cd(0xc6)]:_0x499d66[_0x5688cd(0x8d)]};}),_0x4f626e=await this['_salesforceService']['insertMultipleRecords'](constants_1[_0x19a608(0xc0)]+'Metadata_Item__c',_0x4af9cc);let _0x3318c6=!![];_0x4f626e[_0x19a608(0xe5)]((_0x5a3d65,_0x5995b8)=>{const _0x18ae8f=_0x19a608;this[_0x18ae8f(0x9f)][_0x18ae8f(0x87)]('Saving\x20'+_0x2e5e54[_0x5995b8][_0x18ae8f(0xd3)]+'.'+_0x2e5e54[_0x5995b8][_0x18ae8f(0xd4)]);if(!_0x5a3d65[_0x18ae8f(0xbb)]){_0x3318c6=![];const _0x19f798=new salesforce_dml_error_1['SalesforceDmlError'](_0x5a3d65[_0x18ae8f(0xd0)]);this[_0x18ae8f(0x9f)][_0x18ae8f(0xc9)](_0x19f798);}});if(!_0x3318c6)throw new Error(_0x19a608(0x76));}async['saveAttachments'](_0x1b0ca9){const _0x3b2fa8=a363_0x43332b,_0x296f8f=this[_0x3b2fa8(0x9b)](_0x1b0ca9),_0x525005=await this[_0x3b2fa8(0xe3)]['insertMultipleRecords'](SnapshotService[_0x3b2fa8(0xd5)],_0x296f8f),_0x22e25a=[];_0x525005[_0x3b2fa8(0xe5)]((_0x3f3a33,_0x2eb556)=>{const _0xd17867=_0x3b2fa8;_0x3f3a33[_0xd17867(0xbb)]?(_0x1b0ca9[_0x2eb556]['attachmentId']=_0x3f3a33['id'],_0x1b0ca9[_0x2eb556][_0xd17867(0xa4)]=!![]):_0x22e25a[_0xd17867(0xc5)](..._0x3f3a33['errors']);});if(_0x22e25a[_0x3b2fa8(0xc4)])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x22e25a);}[a363_0x43332b(0x9b)](_0x613865){const _0x1890ab=a363_0x43332b;return _0x613865[_0x1890ab(0xe2)](_0x28a8c9=>({'ParentId':this[_0x1890ab(0xd2)],'Name':_0x28a8c9['veevaComponentType'],'ContentType':_0x1890ab(0x94),'Body':_0x28a8c9[_0x1890ab(0xdb)],'Description':_0x28a8c9[_0x1890ab(0xd3)]}));}async[a363_0x43332b(0x6d)](_0x146241){const _0x3b6f8d=a363_0x43332b,_0xe6973b={[constants_1[_0x3b6f8d(0xc0)]+_0x3b6f8d(0x7e)]:!![],[constants_1[_0x3b6f8d(0xc0)]+_0x3b6f8d(0xd1)]:!_0x146241},_0x4bd964={[constants_1[_0x3b6f8d(0xc0)]+_0x3b6f8d(0xd1)]:!_0x146241,[constants_1[_0x3b6f8d(0xc0)]+_0x3b6f8d(0x98)]:_0x146241,[constants_1[_0x3b6f8d(0xc0)]+_0x3b6f8d(0x8f)]:_0x146241?status_enums_1[_0x3b6f8d(0x67)][_0x3b6f8d(0xa2)]:status_enums_1[_0x3b6f8d(0x67)][_0x3b6f8d(0x6a)],[constants_1[_0x3b6f8d(0xc0)]+'Job_Completed__c']:!![]};await this[_0x3b6f8d(0x6f)][_0x3b6f8d(0x69)](flosum_constants_1[_0x3b6f8d(0xa6)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x3b6f8d(0xc0)]+_0x3b6f8d(0x99)+this[_0x3b6f8d(0xd2)],_0xe6973b),await this[_0x3b6f8d(0x6f)][_0x3b6f8d(0x69)](flosum_constants_1[_0x3b6f8d(0xa6)][_0x3b6f8d(0xcd)]+'/'+constants_1[_0x3b6f8d(0xc0)]+_0x3b6f8d(0xd7)+this[_0x3b6f8d(0x73)],_0x4bd964),this[_0x3b6f8d(0x9f)][_0x3b6f8d(0x87)]('Snapshot\x20completed\x20'+(_0x146241?'successfully':'with\x20error')+'.'),await this[_0x3b6f8d(0x9f)][_0x3b6f8d(0x6c)]();}}exports['SnapshotService']=SnapshotService,SnapshotService['OUTBOUND_PACKAGE_NAME']='Snapshot',SnapshotService[a363_0x43332b(0xd5)]=a363_0x43332b(0xac);