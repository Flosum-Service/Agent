const a406_0x1a8fdb=a406_0x4318;(function(_0x396a0f,_0x31b95f){const _0x3ba3e0=a406_0x4318,_0x542983=_0x396a0f();while(!![]){try{const _0x551f2d=parseInt(_0x3ba3e0(0x81))/0x1+-parseInt(_0x3ba3e0(0x82))/0x2*(-parseInt(_0x3ba3e0(0xbd))/0x3)+-parseInt(_0x3ba3e0(0xf7))/0x4+-parseInt(_0x3ba3e0(0xcd))/0x5+-parseInt(_0x3ba3e0(0xc5))/0x6+parseInt(_0x3ba3e0(0xa0))/0x7*(parseInt(_0x3ba3e0(0xe5))/0x8)+parseInt(_0x3ba3e0(0xb1))/0x9*(parseInt(_0x3ba3e0(0x100))/0xa);if(_0x551f2d===_0x31b95f)break;else _0x542983['push'](_0x542983['shift']());}catch(_0xd06884){_0x542983['push'](_0x542983['shift']());}}}(a406_0xa7ac,0x6d022));const a406_0x3576b6=(function(){let _0x405933=!![];return function(_0x5d5740,_0x387121){const _0x172930=_0x405933?function(){const _0x786e27=a406_0x4318;if(_0x387121){const _0x485faa=_0x387121[_0x786e27(0xd7)](_0x5d5740,arguments);return _0x387121=null,_0x485faa;}}:function(){};return _0x405933=![],_0x172930;};}()),a406_0x465c9f=a406_0x3576b6(this,function(){const _0x2cc61b=a406_0x4318;return a406_0x465c9f['toString']()['search'](_0x2cc61b(0x96))[_0x2cc61b(0xbc)]()[_0x2cc61b(0x99)](a406_0x465c9f)['search'](_0x2cc61b(0x96));});a406_0x465c9f();'use strict';var __importDefault=this&&this[a406_0x1a8fdb(0xdf)]||function(_0x4af964){const _0x2846e8=a406_0x1a8fdb;return _0x4af964&&_0x4af964[_0x2846e8(0xee)]?_0x4af964:{'default':_0x4af964};};Object[a406_0x1a8fdb(0xf3)](exports,a406_0x1a8fdb(0xee),{'value':!![]}),exports[a406_0x1a8fdb(0xeb)]=void 0x0;const jszip_1=__importDefault(require(a406_0x1a8fdb(0x9a))),flosum_constants_1=require(a406_0x1a8fdb(0x9e)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require(a406_0x1a8fdb(0xaa)),constants_1=require(a406_0x1a8fdb(0xb3)),salesforce_service_1=require(a406_0x1a8fdb(0xd5)),status_enums_1=require(a406_0x1a8fdb(0xa2)),salesforce_dml_error_1=require(a406_0x1a8fdb(0xcb)),package_export_service_1=require(a406_0x1a8fdb(0xfc)),type_and_name_veeva_component_retriever_1=require(a406_0x1a8fdb(0xf8)),type_veeva_component_retriever_1=require(a406_0x1a8fdb(0xb4)),sync_1=require(a406_0x1a8fdb(0xa9)),sync_2=require('csv-stringify/sync'),veeva_constants_1=require(a406_0x1a8fdb(0x83)),path_1=__importDefault(require(a406_0x1a8fdb(0x8c)));function a406_0x4318(_0x2cb79a,_0x4051ec){const _0x5e9c0a=a406_0xa7ac();return a406_0x4318=function(_0x465c9f,_0x3576b6){_0x465c9f=_0x465c9f-0x81;let _0xa7ace3=_0x5e9c0a[_0x465c9f];return _0xa7ace3;},a406_0x4318(_0x2cb79a,_0x4051ec);}class SnapshotService{constructor({snapshotId:_0x3a254f,metadataLogId:_0x255a68,selectedMetaTypes:_0xcc300c,selectedComponentMap:_0xcfe92e,whereClause:_0x43f86e},_0x1a3213,_0x42f7f8,_0x84ac47){const _0x243457=a406_0x1a8fdb;this[_0x243457(0xd1)]=_0x1a3213,this['_connectionVeeva']=_0x42f7f8,this[_0x243457(0x84)]=_0x84ac47,this[_0x243457(0xb8)]=_0x3a254f,this[_0x243457(0xed)]=_0x255a68,this[_0x243457(0x101)]=_0xcc300c,this[_0x243457(0xc3)]=_0xcfe92e,this['_whereClause']=_0x43f86e,this[_0x243457(0x97)]=new veeva_service_1[(_0x243457(0xe7))]({'connection':this[_0x243457(0xa5)],'logger':this[_0x243457(0x84)]}),this['_salesforceService']=new salesforce_service_1['SalesforceService']({'connection':this[_0x243457(0xd1)]}),this[_0x243457(0xcc)]=new package_export_service_1[(_0x243457(0xc7))]({'veevaService':this[_0x243457(0x97)],'connection':this['_connectionVeeva'],'logger':this[_0x243457(0x84)]});}async[a406_0x1a8fdb(0xe3)](){const _0x50a82a=a406_0x1a8fdb;try{this[_0x50a82a(0x84)][_0x50a82a(0x92)]('Snapshot\x20started.');const _0x5bf7dc=await this[_0x50a82a(0xb2)]();await this[_0x50a82a(0x84)][_0x50a82a(0x8e)]();const _0x51ba3b=await this[_0x50a82a(0xcc)][_0x50a82a(0xd4)](_0x5bf7dc,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this[_0x50a82a(0x84)][_0x50a82a(0x8e)]();const _0x4847e6=await this[_0x50a82a(0xe1)](_0x5bf7dc,_0x51ba3b);await this[_0x50a82a(0xb5)](_0x4847e6),await this[_0x50a82a(0x84)]['updateLog'](),await this[_0x50a82a(0xad)](!![]);}catch(_0x4bde95){this[_0x50a82a(0x84)][_0x50a82a(0xaf)](_0x4bde95),await this['finishSnapshot'](![])[_0x50a82a(0xec)](_0x362a55=>this[_0x50a82a(0xf5)]['error'](_0x362a55));}}async[a406_0x1a8fdb(0xb2)](){const _0x40a90e=a406_0x1a8fdb,_0x14c062={'veevaService':this[_0x40a90e(0x97)],'logger':this[_0x40a90e(0x84)]},_0x5cfeda=Array[_0x40a90e(0xef)](Object['values'](this[_0x40a90e(0xc3)]))['length']?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x40a90e(0xc3)],..._0x14c062}):new type_veeva_component_retriever_1[(_0x40a90e(0xc8))]({'value':this[_0x40a90e(0x101)],'whereClause':this[_0x40a90e(0x9f)],..._0x14c062});return _0x5cfeda[_0x40a90e(0xac)]();}async[a406_0x1a8fdb(0xe1)](_0x839b79,_0x46c464){const _0x1ee901=a406_0x1a8fdb;var _0x2c0cf2,_0x558838;this['_logger'][_0x1ee901(0x92)](_0x1ee901(0xc6));const _0x451eea=this[_0x1ee901(0xda)](_0x839b79),_0x3e8321=_0x451eea[_0x1ee901(0xae)]((_0x10f802,_0x45c026)=>_0x10f802[_0x1ee901(0xa6)](_0x45c026[_0x1ee901(0xd8)],_0x45c026),new Map());for(const _0x265b06 of _0x46c464){for(const _0x342e22 in _0x265b06[_0x1ee901(0xdc)]){const {base:_0x1e1787,name:_0x550939,dir:_0x7e786c}=path_1[_0x1ee901(0x95)][_0x1ee901(0xde)](_0x342e22),_0xed0f5a=_0x550939+veeva_constants_1[_0x1ee901(0xab)]['DEPENDENCY_EXTENSION'];if(_0x3e8321[_0x1ee901(0xd9)](_0x1e1787)){const _0x43bbfd=await((_0x2c0cf2=_0x265b06[_0x1ee901(0x91)]([_0x7e786c,_0x1e1787][_0x1ee901(0x9c)](path_1[_0x1ee901(0x95)][_0x1ee901(0xbe)]['sep'])))===null||_0x2c0cf2===void 0x0?void 0x0:_0x2c0cf2['async'](_0x1ee901(0x8f))),_0x1942a9=await((_0x558838=_0x265b06['file']([_0x7e786c,_0xed0f5a]['join'](path_1[_0x1ee901(0x95)][_0x1ee901(0xbe)][_0x1ee901(0xfd)])))===null||_0x558838===void 0x0?void 0x0:_0x558838[_0x1ee901(0xa1)](_0x1ee901(0x8f)));if(_0x43bbfd){const _0x5dd3a4=new jszip_1[(_0x1ee901(0x95))]();_0x5dd3a4[_0x1ee901(0x91)](_0x1e1787,_0x43bbfd),_0x1942a9&&_0x5dd3a4['file'](_0xed0f5a,this[_0x1ee901(0x8d)](_0x1942a9)),_0x3e8321[_0x1ee901(0xc9)](_0x1e1787)['body']=await _0x5dd3a4[_0x1ee901(0x90)]({'type':_0x1ee901(0x87)});}}}}return _0x451eea[_0x1ee901(0xf2)](_0x2c5397=>!_0x2c5397[_0x1ee901(0xea)])['forEach'](_0x3c4b08=>{const _0x44b571=_0x1ee901;this[_0x44b571(0x84)][_0x44b571(0x92)](_0x44b571(0xca)+_0x3c4b08[_0x44b571(0xe9)]+'.'+_0x3c4b08[_0x44b571(0xa7)]+_0x44b571(0xfa));}),_0x451eea[_0x1ee901(0xf2)](_0x309ed0=>_0x309ed0[_0x1ee901(0xea)]);}[a406_0x1a8fdb(0x8d)](_0x524eb5){const _0x3f5e9a=a406_0x1a8fdb,_0x2a3a2a=(0x0,sync_1[_0x3f5e9a(0xde)])(_0x524eb5,{'columns':!![],'skip_empty_lines':!![]}),_0x17696c=_0x2a3a2a[_0x3f5e9a(0xf1)](({'In\x20Package':_0x4869d8,..._0x51bb99})=>_0x51bb99);return(0x0,sync_2['stringify'])(_0x17696c,{'header':!![]});}['formMetadataItemDtoList'](_0x34f7cc){return _0x34f7cc['map'](_0x6762e2=>{const _0x1626d0=a406_0x4318,_0x28957b=new metadata_item_dto_1['MetadataItemDto']();return _0x28957b[_0x1626d0(0xa7)]=_0x6762e2[_0x1626d0(0xa7)],_0x28957b[_0x1626d0(0xe4)]=_0x6762e2[_0x1626d0(0xa7)],_0x28957b[_0x1626d0(0xe0)]=this[_0x1626d0(0xb8)],_0x28957b['label']=_0x6762e2['type']+'.'+_0x6762e2[_0x1626d0(0xa7)]+veeva_constants_1[_0x1626d0(0xab)][_0x1626d0(0x9b)],_0x28957b['veevaComponentType']=_0x6762e2[_0x1626d0(0xbf)],_0x28957b[_0x1626d0(0xce)]=_0x6762e2['lastModifiedDate'],_0x28957b[_0x1626d0(0xa4)]=![],_0x28957b;});}async[a406_0x1a8fdb(0xb5)](_0x244b7e){const _0x4ea8b1=a406_0x1a8fdb;this['_logger'][_0x4ea8b1(0x92)](_0x4ea8b1(0xcf)),await this[_0x4ea8b1(0x98)](_0x244b7e),this[_0x4ea8b1(0x84)][_0x4ea8b1(0x92)](_0x4ea8b1(0x8a)+_0x244b7e[_0x4ea8b1(0xa8)]+_0x4ea8b1(0xe6));const _0x544196=_0x244b7e[_0x4ea8b1(0xf1)](_0x566aaa=>{const _0x11ffe7=_0x4ea8b1;return{[constants_1[_0x11ffe7(0x93)]+'Name__c']:_0x566aaa[_0x11ffe7(0xa7)],[constants_1[_0x11ffe7(0x93)]+'API_Name__c']:_0x566aaa['apiName'],[constants_1['FLOSUM_NAMESPACE']+_0x11ffe7(0xfe)]:_0x566aaa['snapshotId'],[constants_1['FLOSUM_NAMESPACE']+_0x11ffe7(0x89)]:_0x566aaa[_0x11ffe7(0xd8)],[constants_1[_0x11ffe7(0x93)]+'Is_Retrieved__c']:_0x566aaa[_0x11ffe7(0xa4)],[constants_1['FLOSUM_NAMESPACE']+_0x11ffe7(0xf4)]:_0x566aaa['veevaComponentType'],[constants_1[_0x11ffe7(0x93)]+_0x11ffe7(0x9d)]:_0x566aaa['attachmentId'],[constants_1['FLOSUM_NAMESPACE']+_0x11ffe7(0xb7)]:_0x566aaa[_0x11ffe7(0xce)]};}),_0x113e9b=await this['_salesforceService'][_0x4ea8b1(0xc1)](constants_1[_0x4ea8b1(0x93)]+_0x4ea8b1(0xc2),_0x544196);let _0x24e6d0=!![];_0x113e9b['forEach']((_0x52b030,_0x1f1316)=>{const _0x40532b=_0x4ea8b1;this[_0x40532b(0x84)][_0x40532b(0x92)]('Saving\x20'+_0x244b7e[_0x1f1316][_0x40532b(0xe9)]+'.'+_0x244b7e[_0x1f1316]['name']);if(!_0x52b030[_0x40532b(0xdb)]){_0x24e6d0=![];const _0x52bef6=new salesforce_dml_error_1[(_0x40532b(0xe2))](_0x52b030[_0x40532b(0x94)]);this[_0x40532b(0x84)][_0x40532b(0xaf)](_0x52bef6);}});if(!_0x24e6d0)throw new Error(_0x4ea8b1(0x88));}async[a406_0x1a8fdb(0x98)](_0x3c256c){const _0x1d27a9=a406_0x1a8fdb,_0x5a6866=this[_0x1d27a9(0xf9)](_0x3c256c),_0x2e24ec=await this[_0x1d27a9(0xc4)][_0x1d27a9(0xc1)](SnapshotService[_0x1d27a9(0xff)],_0x5a6866),_0x4427ec=[];_0x2e24ec[_0x1d27a9(0xe8)]((_0xea2e3e,_0x6f5c65)=>{const _0x353d17=_0x1d27a9;_0xea2e3e[_0x353d17(0xdb)]?(_0x3c256c[_0x6f5c65][_0x353d17(0xb9)]=_0xea2e3e['id'],_0x3c256c[_0x6f5c65][_0x353d17(0xa4)]=!![]):_0x4427ec[_0x353d17(0xd3)](..._0xea2e3e[_0x353d17(0x94)]);});if(_0x4427ec[_0x1d27a9(0xa8)])throw new salesforce_dml_error_1[(_0x1d27a9(0xe2))](_0x4427ec);}['formAttachments'](_0x22cad7){const _0x5db75d=a406_0x1a8fdb;return _0x22cad7['map'](_0x50b1cd=>({'ParentId':this['_snapshotId'],'Name':_0x50b1cd['veevaComponentType'],'ContentType':_0x5db75d(0x8b),'Body':_0x50b1cd[_0x5db75d(0xea)],'Description':_0x50b1cd[_0x5db75d(0xe9)]}));}async[a406_0x1a8fdb(0xad)](_0x2b672f){const _0x461fa5=a406_0x1a8fdb,_0x4770f7={[constants_1[_0x461fa5(0x93)]+_0x461fa5(0xd0)]:!![],[constants_1['FLOSUM_NAMESPACE']+_0x461fa5(0xa3)]:!_0x2b672f},_0x430ce2={[constants_1[_0x461fa5(0x93)]+'Is_Error__c']:!_0x2b672f,[constants_1[_0x461fa5(0x93)]+_0x461fa5(0xfb)]:_0x2b672f,[constants_1['FLOSUM_NAMESPACE']+'Status__c']:_0x2b672f?status_enums_1['MetadataLogStatus']['COMPLETED']:status_enums_1[_0x461fa5(0xba)][_0x461fa5(0xf6)],[constants_1[_0x461fa5(0x93)]+_0x461fa5(0x85)]:!![]};await this[_0x461fa5(0xd1)][_0x461fa5(0xdd)](flosum_constants_1[_0x461fa5(0xb0)][_0x461fa5(0xb6)]+'/'+constants_1[_0x461fa5(0x93)]+_0x461fa5(0xd6)+this[_0x461fa5(0xb8)],_0x4770f7),await this['_connectionSalesforce'][_0x461fa5(0xdd)](flosum_constants_1[_0x461fa5(0xb0)][_0x461fa5(0xb6)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x461fa5(0x86)+this[_0x461fa5(0xed)],_0x430ce2),this[_0x461fa5(0x84)]['log'](_0x461fa5(0xbb)+(_0x2b672f?_0x461fa5(0xf0):'with\x20error')+'.'),await this[_0x461fa5(0x84)][_0x461fa5(0x8e)]();}}exports[a406_0x1a8fdb(0xeb)]=SnapshotService,SnapshotService[a406_0x1a8fdb(0xc0)]='Snapshot',SnapshotService[a406_0x1a8fdb(0xff)]=a406_0x1a8fdb(0xd2);function a406_0xa7ac(){const _0x1e1316=['Veeva_Component_Type__c','_systemLogger','EXCEPTION','3371948LgLYZe','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','formAttachments','\x20from\x20outbound\x20package','Succeed__c','./package-export.service','sep','Snapshot__c','ATTACHMENT','109370gBlXAQ','_selectedMetaTypes','864155oPdaYU','834536JCqxOu','../constants/veeva.constants','_logger','Job_Completed__c','Metadata_Log__c/','base64','Cannot\x20Save\x20Metadata\x20Items','Label__c','Saving\x20','application/zip','path','transformDependencyFile','updateLog','string','generateAsync','file','log','FLOSUM_NAMESPACE','errors','default','(((.+)+)+)+$','_veevaService','saveAttachments','constructor','jszip','MDL_EXTENSION','join','Attachment_ID__c','../constants/flosum.constants','_whereClause','26306wHbskg','async','../enums/status.enums','Is_Error__c','isRetrieved','_connectionVeeva','set','name','length','csv-parse/sync','../dtos/metadata-item.dto','VeevaConstants','retrieve','finishSnapshot','reduce','logError','FlosumConstants','225CWPIYr','retrieveVeevaComponents','../../../constants','../classes/retrievers/veeva-components/type.veeva-component.retriever','saveComponentsInSalesforce','ENDPOINT_UPSERT_RECORD','Last_Modified_Date__c','_snapshotId','attachmentId','MetadataLogStatus','Snapshot\x20completed\x20','toString','6TaQzEI','posix','type','OUTBOUND_PACKAGE_NAME','insertMultipleRecords','Metadata_Item__c','_selectedComponentMap','_salesforceService','2002944uJtEvs','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','PackageExportService','TypeVeevaComponentRetriever','get','Cannot\x20retrieve\x20','../classes/errors/salesforce-dml-error','_packageExportService','2533215hNHNOq','lastModifiedDate','Saving\x20Attachments.','Is_Completed__c','_connectionSalesforce','Attachment','push','export','./salesforce.service','Snapshot__c/','apply','label','has','formMetadataItemDtoList','success','files','patch','parse','__importDefault','snapshotId','createMetadataItemListWithBody','SalesforceDmlError','execute','apiName','336jTCtuw','\x20Metadata\x20Items','VeevaService','forEach','veevaComponentType','body','SnapshotService','catch','_metadataLogId','__esModule','from','successfully','map','filter','defineProperty'];a406_0xa7ac=function(){return _0x1e1316;};return a406_0xa7ac();}