const a406_0x33bacb=a406_0x55a3;(function(_0x45e6db,_0xdf9dd1){const _0x4f825a=a406_0x55a3,_0x4eda0e=_0x45e6db();while(!![]){try{const _0x3127d1=parseInt(_0x4f825a(0x1ac))/0x1+parseInt(_0x4f825a(0x1a0))/0x2*(parseInt(_0x4f825a(0x1e5))/0x3)+parseInt(_0x4f825a(0x1de))/0x4*(parseInt(_0x4f825a(0x1f4))/0x5)+parseInt(_0x4f825a(0x1af))/0x6*(parseInt(_0x4f825a(0x202))/0x7)+parseInt(_0x4f825a(0x1fa))/0x8*(parseInt(_0x4f825a(0x1b4))/0x9)+-parseInt(_0x4f825a(0x1b7))/0xa*(parseInt(_0x4f825a(0x1f0))/0xb)+parseInt(_0x4f825a(0x1b9))/0xc*(-parseInt(_0x4f825a(0x1fc))/0xd);if(_0x3127d1===_0xdf9dd1)break;else _0x4eda0e['push'](_0x4eda0e['shift']());}catch(_0x2e7f1a){_0x4eda0e['push'](_0x4eda0e['shift']());}}}(a406_0x3aa5,0x4bb28));const a406_0x240adf=(function(){let _0x3afb75=!![];return function(_0x403763,_0x1960e5){const _0x67eccb=_0x3afb75?function(){if(_0x1960e5){const _0x5fffce=_0x1960e5['apply'](_0x403763,arguments);return _0x1960e5=null,_0x5fffce;}}:function(){};return _0x3afb75=![],_0x67eccb;};}()),a406_0x56d7b7=a406_0x240adf(this,function(){const _0x38d149=a406_0x55a3;return a406_0x56d7b7[_0x38d149(0x1e3)]()[_0x38d149(0x203)](_0x38d149(0x1e9))[_0x38d149(0x1e3)]()[_0x38d149(0x1fd)](a406_0x56d7b7)[_0x38d149(0x203)]('(((.+)+)+)+$');});a406_0x56d7b7();'use strict';var __importDefault=this&&this[a406_0x33bacb(0x1cc)]||function(_0x5c79fb){const _0x3c9f41=a406_0x33bacb;return _0x5c79fb&&_0x5c79fb[_0x3c9f41(0x1bd)]?_0x5c79fb:{'default':_0x5c79fb};};Object['defineProperty'](exports,a406_0x33bacb(0x1bd),{'value':!![]}),exports[a406_0x33bacb(0x205)]=void 0x0;function a406_0x55a3(_0x48d731,_0x4ecfad){const _0x358ea6=a406_0x3aa5();return a406_0x55a3=function(_0x56d7b7,_0x240adf){_0x56d7b7=_0x56d7b7-0x193;let _0x3aa5da=_0x358ea6[_0x56d7b7];return _0x3aa5da;},a406_0x55a3(_0x48d731,_0x4ecfad);}const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a406_0x33bacb(0x1c5)),salesforce_service_1=require(a406_0x33bacb(0x1dc)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a406_0x33bacb(0x19e)),package_export_service_1=require(a406_0x33bacb(0x19a)),type_and_name_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever'),type_veeva_component_retriever_1=require(a406_0x33bacb(0x210)),sync_1=require(a406_0x33bacb(0x1d7)),sync_2=require(a406_0x33bacb(0x1a2)),veeva_constants_1=require(a406_0x33bacb(0x1ff)),path_1=__importDefault(require(a406_0x33bacb(0x1a4)));function a406_0x3aa5(){const _0x228a40=['TypeAndNameVeevaComponentRetriever','(((.+)+)+)+$','Snapshot\x20started.','from','Name__c','Is_Error__c','patch','formAttachments','5962APqgpI','SalesforceService','Saving\x20Attachments.','log','5wPNuaj','success','name','Last_Modified_Date__c','logError','MDL_EXTENSION','80KGPpXT','Is_Completed__c','10305763HQCzNd','constructor','apiName','../constants/veeva.constants','Metadata_Log__c/','default','2884VYbeRa','search','saveAttachments','SnapshotService','Snapshot\x20completed\x20','\x20from\x20outbound\x20package','MetadataLogStatus','_veevaService','set','FLOSUM_NAMESPACE','lastModifiedDate','MetadataItemDto','file','finishSnapshot','../classes/retrievers/veeva-components/type.veeva-component.retriever','error','length','_systemLogger','join','export','Is_Retrieved__c','execute','./package-export.service','isRetrieved','Attachment','string','../classes/errors/salesforce-dml-error','snapshotId','17908ikLVQY','_packageExportService','csv-stringify/sync','SalesforceDmlError','path','sep','successfully','base64','createMetadataItemListWithBody','OUTBOUND_PACKAGE_NAME','_selectedComponentMap','forEach','282994KSvYls','attachmentId','label','84ehIyan','Attachment_ID__c','formMetadataItemDtoList','Snapshot__c','_metadataLogId','485496aHZGet','veevaComponentType','VeevaService','8590hbfUrQ','get','12cubZYo','COMPLETED','posix','body','__esModule','_whereClause','TypeVeevaComponentRetriever','values','ENDPOINT_UPSERT_RECORD','type','DEPENDENCY_EXTENSION','FlosumConstants','../../../constants','\x20Metadata\x20Items','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','_connectionSalesforce','retrieveVeevaComponents','_snapshotId','saveComponentsInSalesforce','__importDefault','VeevaConstants','_salesforceService','ATTACHMENT','transformDependencyFile','updateLog','errors','map','PackageExportService','async','application/zip','csv-parse/sync','_logger','Status__c','stringify','parse','./salesforce.service','with\x20error','1922068aZsnqm','filter','push','_connectionVeeva','_selectedMetaTypes','toString','reduce','87JDFglT','Cannot\x20Save\x20Metadata\x20Items','Succeed__c'];a406_0x3aa5=function(){return _0x228a40;};return a406_0x3aa5();}class SnapshotService{constructor({snapshotId:_0x5a76b6,metadataLogId:_0x26fa01,selectedMetaTypes:_0x336e37,selectedComponentMap:_0x530c08,whereClause:_0x2952b4},_0x349547,_0x41db4a,_0xf1d456){const _0x1fa543=a406_0x33bacb;this[_0x1fa543(0x1c8)]=_0x349547,this[_0x1fa543(0x1e1)]=_0x41db4a,this['_logger']=_0xf1d456,this[_0x1fa543(0x1ca)]=_0x5a76b6,this[_0x1fa543(0x1b3)]=_0x26fa01,this[_0x1fa543(0x1e2)]=_0x336e37,this[_0x1fa543(0x1aa)]=_0x530c08,this[_0x1fa543(0x1be)]=_0x2952b4,this['_veevaService']=new veeva_service_1[(_0x1fa543(0x1b6))]({'connection':this[_0x1fa543(0x1e1)],'logger':this[_0x1fa543(0x1d8)]}),this[_0x1fa543(0x1ce)]=new salesforce_service_1[(_0x1fa543(0x1f1))]({'connection':this[_0x1fa543(0x1c8)]}),this['_packageExportService']=new package_export_service_1[(_0x1fa543(0x1d4))]({'veevaService':this[_0x1fa543(0x209)],'connection':this['_connectionVeeva'],'logger':this[_0x1fa543(0x1d8)]});}async[a406_0x33bacb(0x199)](){const _0x17fc1d=a406_0x33bacb;try{this[_0x17fc1d(0x1d8)]['log'](_0x17fc1d(0x1ea));const _0x3537bd=await this[_0x17fc1d(0x1c9)]();await this[_0x17fc1d(0x1d8)][_0x17fc1d(0x1d1)]();const _0x26172f=await this[_0x17fc1d(0x1a1)][_0x17fc1d(0x197)](_0x3537bd,SnapshotService[_0x17fc1d(0x1a9)]);await this[_0x17fc1d(0x1d8)][_0x17fc1d(0x1d1)]();const _0x3edac6=await this[_0x17fc1d(0x1a8)](_0x3537bd,_0x26172f);await this['saveComponentsInSalesforce'](_0x3edac6),await this[_0x17fc1d(0x1d8)][_0x17fc1d(0x1d1)](),await this['finishSnapshot'](!![]);}catch(_0x5a448e){this[_0x17fc1d(0x1d8)][_0x17fc1d(0x1f8)](_0x5a448e),await this[_0x17fc1d(0x20f)](![])['catch'](_0x203288=>this[_0x17fc1d(0x195)][_0x17fc1d(0x193)](_0x203288));}}async[a406_0x33bacb(0x1c9)](){const _0x57100d=a406_0x33bacb,_0x565847={'veevaService':this[_0x57100d(0x209)],'logger':this[_0x57100d(0x1d8)]},_0x51e24a=Array[_0x57100d(0x1eb)](Object[_0x57100d(0x1c0)](this[_0x57100d(0x1aa)]))[_0x57100d(0x194)]?new type_and_name_veeva_component_retriever_1[(_0x57100d(0x1e8))]({'value':this[_0x57100d(0x1aa)],..._0x565847}):new type_veeva_component_retriever_1[(_0x57100d(0x1bf))]({'value':this[_0x57100d(0x1e2)],'whereClause':this[_0x57100d(0x1be)],..._0x565847});return _0x51e24a['retrieve']();}async[a406_0x33bacb(0x1a8)](_0x13e5dd,_0x55a00d){const _0x1384cf=a406_0x33bacb;var _0x2207e0,_0x10f507;this[_0x1384cf(0x1d8)]['log'](_0x1384cf(0x1c7));const _0x4cf742=this[_0x1384cf(0x1b1)](_0x13e5dd),_0x35903a=_0x4cf742[_0x1384cf(0x1e4)]((_0x20be00,_0x8066d9)=>_0x20be00[_0x1384cf(0x20a)](_0x8066d9[_0x1384cf(0x1ae)],_0x8066d9),new Map());for(const _0x52a7c8 of _0x55a00d){for(const _0x493be0 in _0x52a7c8['files']){const {base:_0x350e93,name:_0x59c0bf,dir:_0x4cd699}=path_1[_0x1384cf(0x201)][_0x1384cf(0x1db)](_0x493be0),_0x4b56e7=_0x59c0bf+veeva_constants_1[_0x1384cf(0x1cd)][_0x1384cf(0x1c3)];if(_0x35903a['has'](_0x350e93)){const _0x33dd65=await((_0x2207e0=_0x52a7c8[_0x1384cf(0x20e)]([_0x4cd699,_0x350e93][_0x1384cf(0x196)](path_1[_0x1384cf(0x201)][_0x1384cf(0x1bb)][_0x1384cf(0x1a5)])))===null||_0x2207e0===void 0x0?void 0x0:_0x2207e0[_0x1384cf(0x1d5)](_0x1384cf(0x19d))),_0xd7f1a9=await((_0x10f507=_0x52a7c8[_0x1384cf(0x20e)]([_0x4cd699,_0x4b56e7][_0x1384cf(0x196)](path_1[_0x1384cf(0x201)]['posix'][_0x1384cf(0x1a5)])))===null||_0x10f507===void 0x0?void 0x0:_0x10f507['async']('string'));if(_0x33dd65){const _0x41283a=new jszip_1[(_0x1384cf(0x201))]();_0x41283a['file'](_0x350e93,_0x33dd65),_0xd7f1a9&&_0x41283a[_0x1384cf(0x20e)](_0x4b56e7,this[_0x1384cf(0x1d0)](_0xd7f1a9)),_0x35903a[_0x1384cf(0x1b8)](_0x350e93)[_0x1384cf(0x1bc)]=await _0x41283a['generateAsync']({'type':_0x1384cf(0x1a7)});}}}}return _0x4cf742[_0x1384cf(0x1df)](_0x4013b2=>!_0x4013b2[_0x1384cf(0x1bc)])['forEach'](_0x482914=>{const _0x5b9b8c=_0x1384cf;this['_logger'][_0x5b9b8c(0x1f3)]('Cannot\x20retrieve\x20'+_0x482914[_0x5b9b8c(0x1b5)]+'.'+_0x482914[_0x5b9b8c(0x1f6)]+_0x5b9b8c(0x207));}),_0x4cf742['filter'](_0x231857=>_0x231857[_0x1384cf(0x1bc)]);}['transformDependencyFile'](_0x3814db){const _0x143418=a406_0x33bacb,_0x26de7d=(0x0,sync_1[_0x143418(0x1db)])(_0x3814db,{'columns':!![],'skip_empty_lines':!![]}),_0x488a6c=_0x26de7d['map'](({'In\x20Package':_0x10da97,..._0x22dab0})=>_0x22dab0);return(0x0,sync_2[_0x143418(0x1da)])(_0x488a6c,{'header':!![]});}[a406_0x33bacb(0x1b1)](_0x2e399e){const _0x2bc737=a406_0x33bacb;return _0x2e399e[_0x2bc737(0x1d3)](_0x3f882b=>{const _0x256d8f=_0x2bc737,_0x260967=new metadata_item_dto_1[(_0x256d8f(0x20d))]();return _0x260967['name']=_0x3f882b[_0x256d8f(0x1f6)],_0x260967[_0x256d8f(0x1fe)]=_0x3f882b[_0x256d8f(0x1f6)],_0x260967[_0x256d8f(0x19f)]=this[_0x256d8f(0x1ca)],_0x260967[_0x256d8f(0x1ae)]=_0x3f882b[_0x256d8f(0x1c2)]+'.'+_0x3f882b['name']+veeva_constants_1[_0x256d8f(0x1cd)][_0x256d8f(0x1f9)],_0x260967['veevaComponentType']=_0x3f882b[_0x256d8f(0x1c2)],_0x260967[_0x256d8f(0x20c)]=_0x3f882b[_0x256d8f(0x20c)],_0x260967[_0x256d8f(0x19b)]=![],_0x260967;});}async[a406_0x33bacb(0x1cb)](_0x978701){const _0x23d534=a406_0x33bacb;this[_0x23d534(0x1d8)][_0x23d534(0x1f3)](_0x23d534(0x1f2)),await this[_0x23d534(0x204)](_0x978701),this[_0x23d534(0x1d8)][_0x23d534(0x1f3)]('Saving\x20'+_0x978701[_0x23d534(0x194)]+_0x23d534(0x1c6));const _0x2bffa1=_0x978701['map'](_0x3b45df=>{const _0x17c35f=_0x23d534;return{[constants_1[_0x17c35f(0x20b)]+_0x17c35f(0x1ec)]:_0x3b45df[_0x17c35f(0x1f6)],[constants_1[_0x17c35f(0x20b)]+'API_Name__c']:_0x3b45df['apiName'],[constants_1[_0x17c35f(0x20b)]+_0x17c35f(0x1b2)]:_0x3b45df[_0x17c35f(0x19f)],[constants_1[_0x17c35f(0x20b)]+'Label__c']:_0x3b45df[_0x17c35f(0x1ae)],[constants_1[_0x17c35f(0x20b)]+_0x17c35f(0x198)]:_0x3b45df[_0x17c35f(0x19b)],[constants_1['FLOSUM_NAMESPACE']+'Veeva_Component_Type__c']:_0x3b45df[_0x17c35f(0x1b5)],[constants_1['FLOSUM_NAMESPACE']+_0x17c35f(0x1b0)]:_0x3b45df[_0x17c35f(0x1ad)],[constants_1[_0x17c35f(0x20b)]+_0x17c35f(0x1f7)]:_0x3b45df[_0x17c35f(0x20c)]};}),_0x46481e=await this[_0x23d534(0x1ce)]['insertMultipleRecords'](constants_1[_0x23d534(0x20b)]+'Metadata_Item__c',_0x2bffa1);let _0x180c71=!![];_0x46481e[_0x23d534(0x1ab)]((_0x5bce88,_0x2c706d)=>{const _0x560b8f=_0x23d534;this['_logger']['log']('Saving\x20'+_0x978701[_0x2c706d]['veevaComponentType']+'.'+_0x978701[_0x2c706d]['name']);if(!_0x5bce88[_0x560b8f(0x1f5)]){_0x180c71=![];const _0x2d2cf0=new salesforce_dml_error_1['SalesforceDmlError'](_0x5bce88[_0x560b8f(0x1d2)]);this[_0x560b8f(0x1d8)]['logError'](_0x2d2cf0);}});if(!_0x180c71)throw new Error(_0x23d534(0x1e6));}async[a406_0x33bacb(0x204)](_0x1b8fbc){const _0x6d6e56=a406_0x33bacb,_0x5096be=this[_0x6d6e56(0x1ef)](_0x1b8fbc),_0xbbcddd=await this[_0x6d6e56(0x1ce)]['insertMultipleRecords'](SnapshotService[_0x6d6e56(0x1cf)],_0x5096be),_0x3715b5=[];_0xbbcddd[_0x6d6e56(0x1ab)]((_0x3593ce,_0x2f15ce)=>{const _0x47f22d=_0x6d6e56;_0x3593ce['success']?(_0x1b8fbc[_0x2f15ce][_0x47f22d(0x1ad)]=_0x3593ce['id'],_0x1b8fbc[_0x2f15ce][_0x47f22d(0x19b)]=!![]):_0x3715b5[_0x47f22d(0x1e0)](..._0x3593ce['errors']);});if(_0x3715b5[_0x6d6e56(0x194)])throw new salesforce_dml_error_1[(_0x6d6e56(0x1a3))](_0x3715b5);}[a406_0x33bacb(0x1ef)](_0x114cdb){const _0x48438d=a406_0x33bacb;return _0x114cdb['map'](_0x3c2e89=>({'ParentId':this[_0x48438d(0x1ca)],'Name':_0x3c2e89['veevaComponentType'],'ContentType':_0x48438d(0x1d6),'Body':_0x3c2e89[_0x48438d(0x1bc)],'Description':_0x3c2e89['veevaComponentType']}));}async[a406_0x33bacb(0x20f)](_0x36caf1){const _0x4021de=a406_0x33bacb,_0x17042f={[constants_1[_0x4021de(0x20b)]+_0x4021de(0x1fb)]:!![],[constants_1[_0x4021de(0x20b)]+_0x4021de(0x1ed)]:!_0x36caf1},_0x218dae={[constants_1[_0x4021de(0x20b)]+_0x4021de(0x1ed)]:!_0x36caf1,[constants_1[_0x4021de(0x20b)]+_0x4021de(0x1e7)]:_0x36caf1,[constants_1['FLOSUM_NAMESPACE']+_0x4021de(0x1d9)]:_0x36caf1?status_enums_1['MetadataLogStatus'][_0x4021de(0x1ba)]:status_enums_1[_0x4021de(0x208)]['EXCEPTION'],[constants_1[_0x4021de(0x20b)]+'Job_Completed__c']:!![]};await this[_0x4021de(0x1c8)]['patch'](flosum_constants_1[_0x4021de(0x1c4)][_0x4021de(0x1c1)]+'/'+constants_1[_0x4021de(0x20b)]+'Snapshot__c/'+this['_snapshotId'],_0x17042f),await this['_connectionSalesforce'][_0x4021de(0x1ee)](flosum_constants_1['FlosumConstants'][_0x4021de(0x1c1)]+'/'+constants_1[_0x4021de(0x20b)]+_0x4021de(0x200)+this[_0x4021de(0x1b3)],_0x218dae),this['_logger'][_0x4021de(0x1f3)](_0x4021de(0x206)+(_0x36caf1?_0x4021de(0x1a6):_0x4021de(0x1dd))+'.'),await this[_0x4021de(0x1d8)][_0x4021de(0x1d1)]();}}exports[a406_0x33bacb(0x205)]=SnapshotService,SnapshotService[a406_0x33bacb(0x1a9)]='Snapshot',SnapshotService['ATTACHMENT']=a406_0x33bacb(0x19c);