const a339_0x2375d7=a339_0x2aae;(function(_0x27e9db,_0x437d18){const _0x5360b2=a339_0x2aae,_0x56ae28=_0x27e9db();while(!![]){try{const _0x1b5326=parseInt(_0x5360b2(0x235))/0x1+-parseInt(_0x5360b2(0x23d))/0x2*(parseInt(_0x5360b2(0x208))/0x3)+-parseInt(_0x5360b2(0x1d9))/0x4+parseInt(_0x5360b2(0x218))/0x5*(-parseInt(_0x5360b2(0x1eb))/0x6)+-parseInt(_0x5360b2(0x205))/0x7+-parseInt(_0x5360b2(0x239))/0x8+parseInt(_0x5360b2(0x238))/0x9;if(_0x1b5326===_0x437d18)break;else _0x56ae28['push'](_0x56ae28['shift']());}catch(_0x2ea53d){_0x56ae28['push'](_0x56ae28['shift']());}}}(a339_0x25a9,0x93434));const a339_0x1bc294=(function(){let _0x5cc39f=!![];return function(_0x26eb5b,_0x3ac2c6){const _0xcaf55b=_0x5cc39f?function(){const _0x2aedf0=a339_0x2aae;if(_0x3ac2c6){const _0xe67d7e=_0x3ac2c6[_0x2aedf0(0x1df)](_0x26eb5b,arguments);return _0x3ac2c6=null,_0xe67d7e;}}:function(){};return _0x5cc39f=![],_0xcaf55b;};}()),a339_0x2ca7a5=a339_0x1bc294(this,function(){const _0x3e49bd=a339_0x2aae;return a339_0x2ca7a5['toString']()['search'](_0x3e49bd(0x213))[_0x3e49bd(0x1ea)]()[_0x3e49bd(0x217)](a339_0x2ca7a5)['search'](_0x3e49bd(0x213));});a339_0x2ca7a5();'use strict';var __importDefault=this&&this[a339_0x2375d7(0x242)]||function(_0x44aa01){return _0x44aa01&&_0x44aa01['__esModule']?_0x44aa01:{'default':_0x44aa01};};Object['defineProperty'](exports,a339_0x2375d7(0x21d),{'value':!![]}),exports[a339_0x2375d7(0x214)]=void 0x0;function a339_0x2aae(_0x1eefce,_0x5f21a2){const _0x49e261=a339_0x25a9();return a339_0x2aae=function(_0x2ca7a5,_0x1bc294){_0x2ca7a5=_0x2ca7a5-0x1d4;let _0x25a960=_0x49e261[_0x2ca7a5];return _0x25a960;},a339_0x2aae(_0x1eefce,_0x5f21a2);}const jszip_1=__importDefault(require(a339_0x2375d7(0x1fa))),flosum_constants_1=require(a339_0x2375d7(0x1dd)),veeva_service_1=require(a339_0x2375d7(0x23a)),metadata_item_dto_1=require(a339_0x2375d7(0x1ee)),constants_1=require(a339_0x2375d7(0x20f)),salesforce_service_1=require(a339_0x2375d7(0x210)),status_enums_1=require(a339_0x2375d7(0x1fe)),salesforce_dml_error_1=require(a339_0x2375d7(0x1da)),package_export_service_1=require(a339_0x2375d7(0x23c)),type_and_name_veeva_component_retriever_1=require(a339_0x2375d7(0x21f)),type_veeva_component_retriever_1=require(a339_0x2375d7(0x20b));class SnapshotService{constructor(_0x2f3f33,_0x14ef9b,_0x3083ed,_0x4a0e2b){const _0x4e2f68=a339_0x2375d7;this[_0x4e2f68(0x221)]=_0x14ef9b,this[_0x4e2f68(0x1fb)]=_0x3083ed,this[_0x4e2f68(0x206)]=_0x4a0e2b,this[_0x4e2f68(0x228)]=_0x2f3f33[_0x4e2f68(0x212)],this[_0x4e2f68(0x22a)]=_0x2f3f33['metadataLogId'],this[_0x4e2f68(0x1e8)]=_0x2f3f33[_0x4e2f68(0x1f6)],this[_0x4e2f68(0x246)]=_0x2f3f33[_0x4e2f68(0x1fc)],this[_0x4e2f68(0x215)]=_0x2f3f33[_0x4e2f68(0x224)],this[_0x4e2f68(0x1f1)]=_0x2f3f33[_0x4e2f68(0x234)],this[_0x4e2f68(0x237)]=new veeva_service_1['VeevaService']({'connection':this[_0x4e2f68(0x1fb)],'logger':this['_logger']}),this['_salesforceService']=new salesforce_service_1[(_0x4e2f68(0x22e))]({'connection':this[_0x4e2f68(0x221)]}),this[_0x4e2f68(0x20d)]=new package_export_service_1['PackageExportService']({'veevaService':this[_0x4e2f68(0x237)],'connection':this[_0x4e2f68(0x1fb)],'logger':this['_logger']});}async[a339_0x2375d7(0x1f8)](){const _0x5b7c0a=a339_0x2375d7;try{this[_0x5b7c0a(0x206)][_0x5b7c0a(0x1e1)](_0x5b7c0a(0x24a));const _0x552921=await this[_0x5b7c0a(0x200)]();await this[_0x5b7c0a(0x206)][_0x5b7c0a(0x21b)]();const _0x5555e8=await this[_0x5b7c0a(0x20d)][_0x5b7c0a(0x244)](_0x552921,SnapshotService[_0x5b7c0a(0x20c)]);await this[_0x5b7c0a(0x206)][_0x5b7c0a(0x21b)]();const _0x3075fd=await this[_0x5b7c0a(0x1e9)](_0x552921,_0x5555e8);await this[_0x5b7c0a(0x1e5)](_0x3075fd),await this[_0x5b7c0a(0x206)]['updateLog'](),await this['finishSnapshot'](!![]);}catch(_0x332814){this[_0x5b7c0a(0x206)][_0x5b7c0a(0x201)](_0x332814),await this[_0x5b7c0a(0x203)](![])[_0x5b7c0a(0x216)](_0x6ce210=>this['_systemLogger'][_0x5b7c0a(0x1f0)](_0x6ce210));}}async[a339_0x2375d7(0x200)](){const _0x20df20=a339_0x2375d7,_0x309647={'veevaService':this[_0x20df20(0x237)],'logger':this[_0x20df20(0x206)]},_0x225f87=Array[_0x20df20(0x211)](Object[_0x20df20(0x20a)](this[_0x20df20(0x1f1)]))[_0x20df20(0x1d5)]?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x20df20(0x1f1)],..._0x309647}):new type_veeva_component_retriever_1[(_0x20df20(0x225))]({'value':this[_0x20df20(0x215)],..._0x309647});return _0x225f87[_0x20df20(0x22d)]();}async[a339_0x2375d7(0x1e9)](_0x209aec,_0x14fc8a){const _0x150fa0=a339_0x2375d7;var _0x354f0f;this[_0x150fa0(0x206)][_0x150fa0(0x1e1)](_0x150fa0(0x233));const _0x4046d3=this['formMetadataItemDtoList'](_0x209aec),_0x2336e4=_0x4046d3[_0x150fa0(0x1fd)]((_0x4903b6,_0x435620)=>_0x4903b6[_0x150fa0(0x1e7)](_0x435620['label'],_0x435620),new Map());for(const _0x18d63a of _0x14fc8a){for(const _0x42da4f in _0x18d63a[_0x150fa0(0x23f)]){const _0x1881d9=_0x42da4f['split']('/')['at'](-0x1);if(_0x2336e4[_0x150fa0(0x1db)](_0x1881d9)){const _0x554b7f=await((_0x354f0f=_0x18d63a[_0x150fa0(0x1e3)](_0x42da4f))===null||_0x354f0f===void 0x0?void 0x0:_0x354f0f['async'](_0x150fa0(0x20e)));if(_0x554b7f){const _0x4ef42a=new jszip_1['default']();_0x4ef42a[_0x150fa0(0x1e3)](_0x1881d9,_0x554b7f),_0x2336e4['get'](_0x1881d9)[_0x150fa0(0x209)]=await _0x4ef42a[_0x150fa0(0x219)]({'type':_0x150fa0(0x1ed)});}}}}return _0x4046d3['filter'](_0x3c649d=>!_0x3c649d['body'])[_0x150fa0(0x1dc)](_0x1de6f0=>{const _0x571420=_0x150fa0;this['_logger'][_0x571420(0x1e1)](_0x571420(0x1d8)+_0x1de6f0[_0x571420(0x21a)]+'.'+_0x1de6f0[_0x571420(0x202)]+_0x571420(0x249));}),_0x4046d3[_0x150fa0(0x240)](_0x4f69c1=>_0x4f69c1[_0x150fa0(0x209)]);}[a339_0x2375d7(0x243)](_0x460f9d){const _0x51e143=a339_0x2375d7;return _0x460f9d[_0x51e143(0x236)](_0xe98e31=>{const _0x73fd3=_0x51e143,_0x1f5cf8=new metadata_item_dto_1[(_0x73fd3(0x1f4))]();return _0x1f5cf8[_0x73fd3(0x202)]=_0xe98e31['name'],_0x1f5cf8[_0x73fd3(0x22f)]=_0xe98e31[_0x73fd3(0x202)],_0x1f5cf8[_0x73fd3(0x212)]=this['_snapshotId'],_0x1f5cf8[_0x73fd3(0x222)]=_0xe98e31[_0x73fd3(0x227)]+'.'+_0xe98e31[_0x73fd3(0x202)]+_0x73fd3(0x22c),_0x1f5cf8[_0x73fd3(0x21a)]=_0xe98e31[_0x73fd3(0x227)],_0x1f5cf8[_0x73fd3(0x231)]=_0xe98e31[_0x73fd3(0x231)],_0x1f5cf8[_0x73fd3(0x1e4)]=![],_0x1f5cf8;});}async[a339_0x2375d7(0x1e5)](_0x3e48fc){const _0x42ae71=a339_0x2375d7;this[_0x42ae71(0x206)][_0x42ae71(0x1e1)]('Saving\x20Attachments.'),await this[_0x42ae71(0x1d4)](_0x3e48fc),this[_0x42ae71(0x206)][_0x42ae71(0x1e1)](_0x42ae71(0x1e0)+_0x3e48fc[_0x42ae71(0x1d5)]+_0x42ae71(0x22b));const _0x390251=_0x3e48fc[_0x42ae71(0x236)](_0x344a15=>{const _0x236c79=_0x42ae71;return{[constants_1[_0x236c79(0x1de)]+'Name__c']:_0x344a15['name'],[constants_1['FLOSUM_NAMESPACE']+_0x236c79(0x207)]:_0x344a15[_0x236c79(0x22f)],[constants_1['FLOSUM_NAMESPACE']+_0x236c79(0x232)]:_0x344a15['snapshotId'],[constants_1[_0x236c79(0x1de)]+_0x236c79(0x1f9)]:_0x344a15[_0x236c79(0x222)],[constants_1['FLOSUM_NAMESPACE']+_0x236c79(0x1e2)]:_0x344a15[_0x236c79(0x1e4)],[constants_1[_0x236c79(0x1de)]+'Veeva_Component_Type__c']:_0x344a15[_0x236c79(0x21a)],[constants_1[_0x236c79(0x1de)]+_0x236c79(0x1ef)]:_0x344a15[_0x236c79(0x23b)],[constants_1[_0x236c79(0x1de)]+_0x236c79(0x247)]:_0x344a15['lastModifiedDate']};}),_0x44aacc=await this[_0x42ae71(0x223)][_0x42ae71(0x220)](constants_1[_0x42ae71(0x1de)]+_0x42ae71(0x1f3),_0x390251);let _0x134647=!![];_0x44aacc[_0x42ae71(0x1dc)]((_0xd7f449,_0x1208fc)=>{const _0x3a5245=_0x42ae71;this['_logger'][_0x3a5245(0x1e1)](_0x3a5245(0x1e0)+_0x3e48fc[_0x1208fc]['veevaComponentType']+'.'+_0x3e48fc[_0x1208fc][_0x3a5245(0x202)]);if(!_0xd7f449[_0x3a5245(0x1f5)]){_0x134647=![];const _0x3d5a5e=new salesforce_dml_error_1[(_0x3a5245(0x21c))](_0xd7f449['errors']);this[_0x3a5245(0x206)][_0x3a5245(0x201)](_0x3d5a5e);}});if(!_0x134647)throw new Error(_0x42ae71(0x1e6));}async[a339_0x2375d7(0x1d4)](_0x3217d8){const _0x20a85c=a339_0x2375d7,_0x2ff9d4=this[_0x20a85c(0x226)](_0x3217d8),_0x13d5b0=await this[_0x20a85c(0x223)]['insertMultipleRecords'](SnapshotService[_0x20a85c(0x248)],_0x2ff9d4),_0x30cbf1=[];_0x13d5b0[_0x20a85c(0x1dc)]((_0x4d73dd,_0x35377f)=>{const _0x1c6718=_0x20a85c;_0x4d73dd[_0x1c6718(0x1f5)]?(_0x3217d8[_0x35377f]['attachmentId']=_0x4d73dd['id'],_0x3217d8[_0x35377f][_0x1c6718(0x1e4)]=!![]):_0x30cbf1['push'](..._0x4d73dd['errors']);});if(_0x30cbf1[_0x20a85c(0x1d5)])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x30cbf1);}[a339_0x2375d7(0x226)](_0x3e19f2){const _0x191d5d=a339_0x2375d7;return _0x3e19f2[_0x191d5d(0x236)](_0x43b8de=>({'ParentId':this[_0x191d5d(0x228)],'Name':_0x43b8de[_0x191d5d(0x21a)],'ContentType':_0x191d5d(0x1ec),'Body':_0x43b8de[_0x191d5d(0x209)],'Description':_0x43b8de['veevaComponentType']}));}async['finishSnapshot'](_0x289f86){const _0x4adcff=a339_0x2375d7,_0x4378dd={[constants_1[_0x4adcff(0x1de)]+'Is_Completed__c']:!![],[constants_1['FLOSUM_NAMESPACE']+_0x4adcff(0x241)]:!_0x289f86},_0x43796c={[constants_1[_0x4adcff(0x1de)]+'Is_Error__c']:!_0x289f86,[constants_1[_0x4adcff(0x1de)]+'Succeed__c']:_0x289f86,[constants_1[_0x4adcff(0x1de)]+_0x4adcff(0x23e)]:_0x289f86?status_enums_1[_0x4adcff(0x230)][_0x4adcff(0x1ff)]:status_enums_1[_0x4adcff(0x230)][_0x4adcff(0x204)],[constants_1[_0x4adcff(0x1de)]+'Job_Completed__c']:!![]};await this[_0x4adcff(0x221)][_0x4adcff(0x1d7)](flosum_constants_1[_0x4adcff(0x229)][_0x4adcff(0x1d6)]+'/'+constants_1[_0x4adcff(0x1de)]+'Snapshot__c/'+this[_0x4adcff(0x228)],_0x4378dd),await this[_0x4adcff(0x221)]['patch'](flosum_constants_1[_0x4adcff(0x229)][_0x4adcff(0x1d6)]+'/'+constants_1[_0x4adcff(0x1de)]+_0x4adcff(0x1f2)+this[_0x4adcff(0x22a)],_0x43796c),this['_logger'][_0x4adcff(0x1e1)](_0x4adcff(0x21e)+(_0x289f86?'successfully':_0x4adcff(0x245))+'.'),await this[_0x4adcff(0x206)][_0x4adcff(0x21b)]();}}exports['SnapshotService']=SnapshotService,SnapshotService[a339_0x2375d7(0x20c)]=a339_0x2375d7(0x1f7),SnapshotService[a339_0x2375d7(0x248)]='Attachment';function a339_0x25a9(){const _0x29b6e5=['timeZone','reduce','../enums/status.enums','COMPLETED','retrieveVeevaComponents','logError','name','finishSnapshot','EXCEPTION','3314640xSRqBZ','_logger','API_Name__c','21Esdsun','body','values','../classes/retrievers/veeva-components/type.veeva-component.retriever','OUTBOUND_PACKAGE_NAME','_packageExportService','string','../../../constants','./salesforce.service','from','snapshotId','(((.+)+)+)+$','SnapshotService','_selectedMetaTypes','catch','constructor','520465FxRNRL','generateAsync','veevaComponentType','updateLog','SalesforceDmlError','__esModule','Snapshot\x20completed\x20','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','insertMultipleRecords','_connectionSalesforce','label','_salesforceService','selectedMetaTypes','TypeVeevaComponentRetriever','formAttachments','type','_snapshotId','FlosumConstants','_metadataLogId','\x20Metadata\x20Items','.mdl','retrieve','SalesforceService','apiName','MetadataLogStatus','lastModifiedDate','Snapshot__c','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','selectedComponentMap','1090126NjtHkm','map','_veevaService','25864560hqVRKJ','9041712CgceqC','./veeva.service','attachmentId','./package-export.service','322428vBJQUu','Status__c','files','filter','Is_Error__c','__importDefault','formMetadataItemDtoList','export','with\x20error','_timeZone','Last_Modified_Date__c','ATTACHMENT','\x20from\x20outbound\x20package','Snapshot\x20started.','saveAttachments','length','ENDPOINT_UPSERT_RECORD','patch','Cannot\x20retrieve\x20','2097812gVWmmr','../classes/errors/salesforce-dml-error','has','forEach','../constants/flosum.constants','FLOSUM_NAMESPACE','apply','Saving\x20','log','Is_Retrieved__c','file','isRetrieved','saveComponentsInSalesforce','Cannot\x20Save\x20Metadata\x20Items','set','_attachmentLogId','createMetadataItemListWithBody','toString','6eAdmHS','application/zip','base64','../dtos/metadata-item.dto','Attachment_ID__c','error','_selectedComponentMap','Metadata_Log__c/','Metadata_Item__c','MetadataItemDto','success','attachmentLogId','Snapshot','execute','Label__c','jszip','_connectionVeeva'];a339_0x25a9=function(){return _0x29b6e5;};return a339_0x25a9();}