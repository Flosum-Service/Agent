function a379_0x5263(_0x53d83e,_0x4c256b){const _0x457170=a379_0x1378();return a379_0x5263=function(_0x151ca1,_0x45061c){_0x151ca1=_0x151ca1-0x14a;let _0x137854=_0x457170[_0x151ca1];return _0x137854;},a379_0x5263(_0x53d83e,_0x4c256b);}const a379_0x2856a0=a379_0x5263;(function(_0x23cd94,_0x5df1c9){const _0x31a1b7=a379_0x5263,_0x3ddbad=_0x23cd94();while(!![]){try{const _0x35fbf8=parseInt(_0x31a1b7(0x153))/0x1*(parseInt(_0x31a1b7(0x15b))/0x2)+-parseInt(_0x31a1b7(0x178))/0x3+-parseInt(_0x31a1b7(0x18e))/0x4*(parseInt(_0x31a1b7(0x1a0))/0x5)+parseInt(_0x31a1b7(0x188))/0x6+parseInt(_0x31a1b7(0x1ae))/0x7+-parseInt(_0x31a1b7(0x16e))/0x8*(-parseInt(_0x31a1b7(0x1b5))/0x9)+-parseInt(_0x31a1b7(0x199))/0xa*(parseInt(_0x31a1b7(0x18c))/0xb);if(_0x35fbf8===_0x5df1c9)break;else _0x3ddbad['push'](_0x3ddbad['shift']());}catch(_0x14c3b5){_0x3ddbad['push'](_0x3ddbad['shift']());}}}(a379_0x1378,0xdeefa));const a379_0x45061c=(function(){let _0x2b263c=!![];return function(_0x103a29,_0x5b5e0c){const _0x4c916a=_0x2b263c?function(){if(_0x5b5e0c){const _0x4f53d6=_0x5b5e0c['apply'](_0x103a29,arguments);return _0x5b5e0c=null,_0x4f53d6;}}:function(){};return _0x2b263c=![],_0x4c916a;};}()),a379_0x151ca1=a379_0x45061c(this,function(){const _0x277a43=a379_0x5263;return a379_0x151ca1[_0x277a43(0x191)]()['search'](_0x277a43(0x1c6))[_0x277a43(0x191)]()[_0x277a43(0x159)](a379_0x151ca1)['search']('(((.+)+)+)+$');});a379_0x151ca1();'use strict';var __importDefault=this&&this[a379_0x2856a0(0x14c)]||function(_0x27e644){return _0x27e644&&_0x27e644['__esModule']?_0x27e644:{'default':_0x27e644};};Object[a379_0x2856a0(0x1c5)](exports,a379_0x2856a0(0x173),{'value':!![]}),exports[a379_0x2856a0(0x1cd)]=void 0x0;const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require(a379_0x2856a0(0x1b4)),veeva_service_1=require(a379_0x2856a0(0x1aa)),metadata_item_dto_1=require(a379_0x2856a0(0x168)),constants_1=require(a379_0x2856a0(0x17d)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a379_0x2856a0(0x1a1)),salesforce_dml_error_1=require(a379_0x2856a0(0x18f)),package_export_service_1=require(a379_0x2856a0(0x1c0)),type_and_name_veeva_component_retriever_1=require(a379_0x2856a0(0x1a6)),type_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type.veeva-component.retriever'),sync_1=require(a379_0x2856a0(0x1b6)),sync_2=require('csv-stringify/sync'),veeva_constants_1=require(a379_0x2856a0(0x1c7)),path_1=__importDefault(require(a379_0x2856a0(0x161)));function a379_0x1378(){const _0x4ef67e=['COMPLETED','FLOSUM_NAMESPACE','success','label','_logger','generateAsync','API_Name__c','FlosumConstants','./package-export.service','export','_whereClause','lastModifiedDate','patch','defineProperty','(((.+)+)+)+$','../constants/veeva.constants','Saving\x20Attachments.','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','Snapshot\x20completed\x20','TypeAndNameVeevaComponentRetriever','push','SnapshotService','_selectedMetaTypes','Attachment_ID__c','__importDefault','_snapshotId','forEach','Veeva_Component_Type__c','DEPENDENCY_EXTENSION','Snapshot__c/','updateLog','1STVaeo','map','retrieveVeevaComponents','VeevaService','PackageExportService','application/zip','constructor','isRetrieved','451370UkttsC','sep','saveComponentsInSalesforce','join','Snapshot','apiName','path','posix','_salesforceService','Cannot\x20Save\x20Metadata\x20Items','Name__c','_connectionSalesforce','veevaComponentType','../dtos/metadata-item.dto','Is_Error__c','retrieve','SalesforceService','Succeed__c','ATTACHMENT','297944QnABbO','snapshotId','values','Job_Completed__c','length','__esModule','attachmentId','successfully','transformDependencyFile','filter','1981461gzamuv','type','OUTBOUND_PACKAGE_NAME','Metadata_Item__c','createMetadataItemListWithBody','../../../constants','_systemLogger','TypeVeevaComponentRetriever','Snapshot\x20started.','saveAttachments','log','\x20Metadata\x20Items','execute','formAttachments','get','reduce','358314YVwNEW','Attachment','Label__c','finishSnapshot','5731PNMqms','insertMultipleRecords','24kzdEUc','../classes/errors/salesforce-dml-error','MetadataLogStatus','toString','errors','set','SalesforceDmlError','from','Metadata_Log__c/','MetadataItemDto','error','2710zUFuOV','Last_Modified_Date__c','_metadataLogId','EXCEPTION','file','Snapshot__c','VeevaConstants','1173415WVhrKo','../enums/status.enums','parse','Saving\x20','default','body','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','_veevaService','Is_Retrieved__c','_connectionVeeva','./veeva.service','async','_selectedComponentMap','name','8913184ppjqJd','ENDPOINT_UPSERT_RECORD','catch','logError','formMetadataItemDtoList','_packageExportService','../constants/flosum.constants','378ajQtOi','csv-parse/sync','files'];a379_0x1378=function(){return _0x4ef67e;};return a379_0x1378();}class SnapshotService{constructor({snapshotId:_0x7cead9,metadataLogId:_0x377fc8,selectedMetaTypes:_0x14b32e,selectedComponentMap:_0xcc43ec,whereClause:_0xb3b35c},_0x1a9011,_0x3c2db6,_0x2dc11f){const _0x589bb6=a379_0x2856a0;this[_0x589bb6(0x166)]=_0x1a9011,this['_connectionVeeva']=_0x3c2db6,this['_logger']=_0x2dc11f,this[_0x589bb6(0x14d)]=_0x7cead9,this[_0x589bb6(0x19b)]=_0x377fc8,this[_0x589bb6(0x14a)]=_0x14b32e,this['_selectedComponentMap']=_0xcc43ec,this[_0x589bb6(0x1c2)]=_0xb3b35c,this[_0x589bb6(0x1a7)]=new veeva_service_1[(_0x589bb6(0x156))]({'connection':this['_connectionVeeva'],'logger':this[_0x589bb6(0x1bc)]}),this[_0x589bb6(0x163)]=new salesforce_service_1[(_0x589bb6(0x16b))]({'connection':this[_0x589bb6(0x166)]}),this[_0x589bb6(0x1b3)]=new package_export_service_1[(_0x589bb6(0x157))]({'veevaService':this['_veevaService'],'connection':this[_0x589bb6(0x1a9)],'logger':this[_0x589bb6(0x1bc)]});}async[a379_0x2856a0(0x184)](){const _0x37be73=a379_0x2856a0;try{this[_0x37be73(0x1bc)][_0x37be73(0x182)](_0x37be73(0x180));const _0x81e4c5=await this[_0x37be73(0x155)]();await this[_0x37be73(0x1bc)][_0x37be73(0x152)]();const _0x552b8b=await this['_packageExportService'][_0x37be73(0x1c1)](_0x81e4c5,SnapshotService[_0x37be73(0x17a)]);await this[_0x37be73(0x1bc)][_0x37be73(0x152)]();const _0x2bbd71=await this[_0x37be73(0x17c)](_0x81e4c5,_0x552b8b);await this[_0x37be73(0x15d)](_0x2bbd71),await this[_0x37be73(0x1bc)][_0x37be73(0x152)](),await this[_0x37be73(0x18b)](!![]);}catch(_0x85edff){this[_0x37be73(0x1bc)][_0x37be73(0x1b1)](_0x85edff),await this[_0x37be73(0x18b)](![])[_0x37be73(0x1b0)](_0x58c29d=>this[_0x37be73(0x17e)][_0x37be73(0x198)](_0x58c29d));}}async[a379_0x2856a0(0x155)](){const _0x117792=a379_0x2856a0,_0x2ed859={'veevaService':this['_veevaService'],'logger':this[_0x117792(0x1bc)]},_0x5dc61f=Array[_0x117792(0x195)](Object[_0x117792(0x170)](this[_0x117792(0x1ac)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x117792(0x1cb))]({'value':this['_selectedComponentMap'],..._0x2ed859}):new type_veeva_component_retriever_1[(_0x117792(0x17f))]({'value':this[_0x117792(0x14a)],'whereClause':this[_0x117792(0x1c2)],..._0x2ed859});return _0x5dc61f[_0x117792(0x16a)]();}async[a379_0x2856a0(0x17c)](_0x5c528c,_0x1d6e2c){const _0x342a72=a379_0x2856a0;var _0x3fa55d,_0x39b248;this[_0x342a72(0x1bc)][_0x342a72(0x182)](_0x342a72(0x1c9));const _0xb4d9d3=this[_0x342a72(0x1b2)](_0x5c528c),_0x39c8b9=_0xb4d9d3[_0x342a72(0x187)]((_0x42880e,_0x1f9b86)=>_0x42880e[_0x342a72(0x193)](_0x1f9b86[_0x342a72(0x1bb)],_0x1f9b86),new Map());for(const _0x3982b3 of _0x1d6e2c){for(const _0x1896e6 in _0x3982b3[_0x342a72(0x1b7)]){const {base:_0x5e5561,name:_0xeb7a1d,dir:_0x26d68f}=path_1[_0x342a72(0x1a4)]['parse'](_0x1896e6),_0x3fc463=_0xeb7a1d+veeva_constants_1[_0x342a72(0x19f)][_0x342a72(0x150)];if(_0x39c8b9['has'](_0x5e5561)){const _0x1724ea=await((_0x3fa55d=_0x3982b3['file']([_0x26d68f,_0x5e5561][_0x342a72(0x15e)](path_1[_0x342a72(0x1a4)][_0x342a72(0x162)][_0x342a72(0x15c)])))===null||_0x3fa55d===void 0x0?void 0x0:_0x3fa55d[_0x342a72(0x1ab)]('string')),_0x376d68=await((_0x39b248=_0x3982b3['file']([_0x26d68f,_0x3fc463][_0x342a72(0x15e)](path_1[_0x342a72(0x1a4)][_0x342a72(0x162)]['sep'])))===null||_0x39b248===void 0x0?void 0x0:_0x39b248[_0x342a72(0x1ab)]('string'));if(_0x1724ea){const _0x451791=new jszip_1['default']();_0x451791[_0x342a72(0x19d)](_0x5e5561,_0x1724ea),_0x376d68&&_0x451791[_0x342a72(0x19d)](_0x3fc463,this[_0x342a72(0x176)](_0x376d68)),_0x39c8b9[_0x342a72(0x186)](_0x5e5561)[_0x342a72(0x1a5)]=await _0x451791[_0x342a72(0x1bd)]({'type':'base64'});}}}}return _0xb4d9d3[_0x342a72(0x177)](_0x4da01b=>!_0x4da01b[_0x342a72(0x1a5)])['forEach'](_0x158591=>{const _0x24d18d=_0x342a72;this[_0x24d18d(0x1bc)][_0x24d18d(0x182)]('Cannot\x20retrieve\x20'+_0x158591['veevaComponentType']+'.'+_0x158591[_0x24d18d(0x1ad)]+'\x20from\x20outbound\x20package');}),_0xb4d9d3[_0x342a72(0x177)](_0x537da3=>_0x537da3[_0x342a72(0x1a5)]);}[a379_0x2856a0(0x176)](_0x40025a){const _0x2b5b84=a379_0x2856a0,_0x50e62c=(0x0,sync_1[_0x2b5b84(0x1a2)])(_0x40025a,{'columns':!![],'skip_empty_lines':!![]}),_0x1ad4ec=_0x50e62c[_0x2b5b84(0x154)](({'In\x20Package':_0x4ae4dc,..._0x2a540a})=>_0x2a540a);return(0x0,sync_2['stringify'])(_0x1ad4ec,{'header':!![]});}[a379_0x2856a0(0x1b2)](_0x1dccf9){const _0x511e49=a379_0x2856a0;return _0x1dccf9[_0x511e49(0x154)](_0xf6acb=>{const _0x33c95a=_0x511e49,_0x2153b5=new metadata_item_dto_1[(_0x33c95a(0x197))]();return _0x2153b5[_0x33c95a(0x1ad)]=_0xf6acb['name'],_0x2153b5[_0x33c95a(0x160)]=_0xf6acb[_0x33c95a(0x1ad)],_0x2153b5[_0x33c95a(0x16f)]=this['_snapshotId'],_0x2153b5[_0x33c95a(0x1bb)]=_0xf6acb[_0x33c95a(0x179)]+'.'+_0xf6acb['name']+veeva_constants_1[_0x33c95a(0x19f)]['MDL_EXTENSION'],_0x2153b5['veevaComponentType']=_0xf6acb[_0x33c95a(0x179)],_0x2153b5['lastModifiedDate']=_0xf6acb[_0x33c95a(0x1c3)],_0x2153b5[_0x33c95a(0x15a)]=![],_0x2153b5;});}async[a379_0x2856a0(0x15d)](_0x31c931){const _0x5994c1=a379_0x2856a0;this[_0x5994c1(0x1bc)]['log'](_0x5994c1(0x1c8)),await this[_0x5994c1(0x181)](_0x31c931),this['_logger']['log'](_0x5994c1(0x1a3)+_0x31c931[_0x5994c1(0x172)]+_0x5994c1(0x183));const _0x21381c=_0x31c931[_0x5994c1(0x154)](_0x54ed48=>{const _0x5e5df0=_0x5994c1;return{[constants_1[_0x5e5df0(0x1b9)]+_0x5e5df0(0x165)]:_0x54ed48['name'],[constants_1[_0x5e5df0(0x1b9)]+_0x5e5df0(0x1be)]:_0x54ed48[_0x5e5df0(0x160)],[constants_1[_0x5e5df0(0x1b9)]+_0x5e5df0(0x19e)]:_0x54ed48['snapshotId'],[constants_1[_0x5e5df0(0x1b9)]+_0x5e5df0(0x18a)]:_0x54ed48[_0x5e5df0(0x1bb)],[constants_1[_0x5e5df0(0x1b9)]+_0x5e5df0(0x1a8)]:_0x54ed48[_0x5e5df0(0x15a)],[constants_1[_0x5e5df0(0x1b9)]+_0x5e5df0(0x14f)]:_0x54ed48[_0x5e5df0(0x167)],[constants_1[_0x5e5df0(0x1b9)]+_0x5e5df0(0x14b)]:_0x54ed48[_0x5e5df0(0x174)],[constants_1['FLOSUM_NAMESPACE']+_0x5e5df0(0x19a)]:_0x54ed48[_0x5e5df0(0x1c3)]};}),_0x563ce3=await this[_0x5994c1(0x163)][_0x5994c1(0x18d)](constants_1[_0x5994c1(0x1b9)]+_0x5994c1(0x17b),_0x21381c);let _0x5064d8=!![];_0x563ce3[_0x5994c1(0x14e)]((_0x14a6c6,_0x23737a)=>{const _0x511d9c=_0x5994c1;this[_0x511d9c(0x1bc)]['log'](_0x511d9c(0x1a3)+_0x31c931[_0x23737a][_0x511d9c(0x167)]+'.'+_0x31c931[_0x23737a][_0x511d9c(0x1ad)]);if(!_0x14a6c6[_0x511d9c(0x1ba)]){_0x5064d8=![];const _0x2a6bb0=new salesforce_dml_error_1[(_0x511d9c(0x194))](_0x14a6c6[_0x511d9c(0x192)]);this[_0x511d9c(0x1bc)][_0x511d9c(0x1b1)](_0x2a6bb0);}});if(!_0x5064d8)throw new Error(_0x5994c1(0x164));}async[a379_0x2856a0(0x181)](_0x42275e){const _0x2f49cc=a379_0x2856a0,_0x210119=this[_0x2f49cc(0x185)](_0x42275e),_0x34f867=await this[_0x2f49cc(0x163)][_0x2f49cc(0x18d)](SnapshotService[_0x2f49cc(0x16d)],_0x210119),_0x377073=[];_0x34f867[_0x2f49cc(0x14e)]((_0x4e5c28,_0x2cc8b)=>{const _0x41f02d=_0x2f49cc;_0x4e5c28[_0x41f02d(0x1ba)]?(_0x42275e[_0x2cc8b][_0x41f02d(0x174)]=_0x4e5c28['id'],_0x42275e[_0x2cc8b][_0x41f02d(0x15a)]=!![]):_0x377073[_0x41f02d(0x1cc)](..._0x4e5c28[_0x41f02d(0x192)]);});if(_0x377073[_0x2f49cc(0x172)])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x377073);}[a379_0x2856a0(0x185)](_0x4d8f6c){const _0x151a1b=a379_0x2856a0;return _0x4d8f6c[_0x151a1b(0x154)](_0x1d3e04=>({'ParentId':this[_0x151a1b(0x14d)],'Name':_0x1d3e04['veevaComponentType'],'ContentType':_0x151a1b(0x158),'Body':_0x1d3e04[_0x151a1b(0x1a5)],'Description':_0x1d3e04[_0x151a1b(0x167)]}));}async[a379_0x2856a0(0x18b)](_0x5448f4){const _0x2af83e=a379_0x2856a0,_0x3c1837={[constants_1['FLOSUM_NAMESPACE']+'Is_Completed__c']:!![],[constants_1[_0x2af83e(0x1b9)]+_0x2af83e(0x169)]:!_0x5448f4},_0x204389={[constants_1[_0x2af83e(0x1b9)]+'Is_Error__c']:!_0x5448f4,[constants_1[_0x2af83e(0x1b9)]+_0x2af83e(0x16c)]:_0x5448f4,[constants_1['FLOSUM_NAMESPACE']+'Status__c']:_0x5448f4?status_enums_1[_0x2af83e(0x190)][_0x2af83e(0x1b8)]:status_enums_1[_0x2af83e(0x190)][_0x2af83e(0x19c)],[constants_1[_0x2af83e(0x1b9)]+_0x2af83e(0x171)]:!![]};await this['_connectionSalesforce'][_0x2af83e(0x1c4)](flosum_constants_1[_0x2af83e(0x1bf)][_0x2af83e(0x1af)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x2af83e(0x151)+this[_0x2af83e(0x14d)],_0x3c1837),await this[_0x2af83e(0x166)]['patch'](flosum_constants_1[_0x2af83e(0x1bf)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x2af83e(0x1b9)]+_0x2af83e(0x196)+this[_0x2af83e(0x19b)],_0x204389),this[_0x2af83e(0x1bc)][_0x2af83e(0x182)](_0x2af83e(0x1ca)+(_0x5448f4?_0x2af83e(0x175):'with\x20error')+'.'),await this[_0x2af83e(0x1bc)][_0x2af83e(0x152)]();}}exports['SnapshotService']=SnapshotService,SnapshotService[a379_0x2856a0(0x17a)]=a379_0x2856a0(0x15f),SnapshotService['ATTACHMENT']=a379_0x2856a0(0x189);