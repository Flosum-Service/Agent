const a363_0x2896c7=a363_0x2dc6;(function(_0x47e386,_0x4d5e48){const _0x26b2ac=a363_0x2dc6,_0x5dd07f=_0x47e386();while(!![]){try{const _0xe40fcf=parseInt(_0x26b2ac(0x149))/0x1*(parseInt(_0x26b2ac(0x156))/0x2)+-parseInt(_0x26b2ac(0x102))/0x3+parseInt(_0x26b2ac(0x17a))/0x4*(-parseInt(_0x26b2ac(0x126))/0x5)+-parseInt(_0x26b2ac(0x14d))/0x6+parseInt(_0x26b2ac(0x157))/0x7+-parseInt(_0x26b2ac(0x11b))/0x8+-parseInt(_0x26b2ac(0x132))/0x9*(-parseInt(_0x26b2ac(0x108))/0xa);if(_0xe40fcf===_0x4d5e48)break;else _0x5dd07f['push'](_0x5dd07f['shift']());}catch(_0x5cba3b){_0x5dd07f['push'](_0x5dd07f['shift']());}}}(a363_0x3f66,0x860ed));const a363_0x425ff5=(function(){let _0xcee5d0=!![];return function(_0x77b40f,_0x420c6f){const _0x1b2bfd=_0xcee5d0?function(){const _0x15be85=a363_0x2dc6;if(_0x420c6f){const _0x41d4ba=_0x420c6f[_0x15be85(0xff)](_0x77b40f,arguments);return _0x420c6f=null,_0x41d4ba;}}:function(){};return _0xcee5d0=![],_0x1b2bfd;};}()),a363_0x500f59=a363_0x425ff5(this,function(){const _0xf037b3=a363_0x2dc6;return a363_0x500f59[_0xf037b3(0x170)]()[_0xf037b3(0x12b)](_0xf037b3(0x128))[_0xf037b3(0x170)]()[_0xf037b3(0x111)](a363_0x500f59)[_0xf037b3(0x12b)](_0xf037b3(0x128));});a363_0x500f59();'use strict';var __importDefault=this&&this[a363_0x2896c7(0x113)]||function(_0x47903d){const _0x242d75=a363_0x2896c7;return _0x47903d&&_0x47903d[_0x242d75(0x16f)]?_0x47903d:{'default':_0x47903d};};Object[a363_0x2896c7(0x16e)](exports,a363_0x2896c7(0x16f),{'value':!![]}),exports[a363_0x2896c7(0x164)]=void 0x0;function a363_0x2dc6(_0x47e84f,_0x250546){const _0x42a6ae=a363_0x3f66();return a363_0x2dc6=function(_0x500f59,_0x425ff5){_0x500f59=_0x500f59-0xfe;let _0x3f66bb=_0x42a6ae[_0x500f59];return _0x3f66bb;},a363_0x2dc6(_0x47e84f,_0x250546);}function a363_0x3f66(){const _0xef3f25=['Succeed__c','Cannot\x20retrieve\x20','FlosumConstants','EXCEPTION','finishSnapshot','_connectionVeeva','join','defineProperty','__esModule','toString','parse','_attachmentLogId','DEPENDENCY_EXTENSION','selectedMetaTypes','execute','OUTBOUND_PACKAGE_NAME','errors','values','Snapshot__c/','4DWmuAn','length','apply','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','reduce','1499400GYSqrU','formMetadataItemDtoList','./veeva.service','_selectedMetaTypes','Snapshot\x20started.','attachmentId','15320VNXRgw','MetadataLogStatus','application/zip','transformDependencyFile','push','Last_Modified_Date__c','updateLog','name','retrieve','constructor','saveAttachments','__importDefault','has','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','MDL_EXTENSION','default','Saving\x20Attachments.','label','Job_Completed__c','1679808zXtljl','async','Status__c','VeevaConstants','logError','error','_snapshotId','SalesforceDmlError','selectedComponentMap','ENDPOINT_UPSERT_RECORD','filter','2798735WSBUpA','successfully','(((.+)+)+)+$','forEach','attachmentLogId','search','Cannot\x20Save\x20Metadata\x20Items','snapshotId','TypeAndNameVeevaComponentRetriever','ATTACHMENT','isRetrieved','./salesforce.service','5742LSTsup','Is_Error__c','_salesforceService','csv-parse/sync','_selectedComponentMap','generateAsync','_connectionSalesforce','_logger','map','_systemLogger','lastModifiedDate','FLOSUM_NAMESPACE','apiName','../constants/veeva.constants','saveComponentsInSalesforce','TypeVeevaComponentRetriever','SalesforceService','./package-export.service','API_Name__c','base64','type','metadataLogId','file','1693JyPWFZ','_timeZone','veevaComponentType','success','2816754WCYwXZ','body','insertMultipleRecords','retrieveVeevaComponents','formAttachments','Veeva_Component_Type__c','log','../classes/retrievers/veeva-components/type.veeva-component.retriever','export','282uOopKc','7503678bbWszv','../constants/flosum.constants','../dtos/metadata-item.dto','string','jszip','_packageExportService','with\x20error','createMetadataItemListWithBody','Snapshot__c','Saving\x20','patch','PackageExportService','from','SnapshotService','_veevaService','timeZone'];a363_0x3f66=function(){return _0xef3f25;};return a363_0x3f66();}const jszip_1=__importDefault(require(a363_0x2896c7(0x15b))),flosum_constants_1=require(a363_0x2896c7(0x158)),veeva_service_1=require(a363_0x2896c7(0x104)),metadata_item_dto_1=require(a363_0x2896c7(0x159)),constants_1=require('../../../constants'),salesforce_service_1=require(a363_0x2896c7(0x131)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require(a363_0x2896c7(0x143)),type_and_name_veeva_component_retriever_1=require(a363_0x2896c7(0x100)),type_veeva_component_retriever_1=require(a363_0x2896c7(0x154)),sync_1=require(a363_0x2896c7(0x135)),sync_2=require('csv-stringify/sync'),veeva_constants_1=require(a363_0x2896c7(0x13f)),path_1=__importDefault(require('path'));class SnapshotService{constructor(_0x30b5b5,_0x4daf62,_0xa68f81,_0x1782d4){const _0x1d2381=a363_0x2896c7;this[_0x1d2381(0x138)]=_0x4daf62,this[_0x1d2381(0x16c)]=_0xa68f81,this[_0x1d2381(0x139)]=_0x1782d4,this['_snapshotId']=_0x30b5b5['snapshotId'],this['_metadataLogId']=_0x30b5b5[_0x1d2381(0x147)],this[_0x1d2381(0x172)]=_0x30b5b5[_0x1d2381(0x12a)],this[_0x1d2381(0x14a)]=_0x30b5b5[_0x1d2381(0x166)],this[_0x1d2381(0x105)]=_0x30b5b5[_0x1d2381(0x174)],this[_0x1d2381(0x136)]=_0x30b5b5[_0x1d2381(0x123)],this[_0x1d2381(0x165)]=new veeva_service_1['VeevaService']({'connection':this[_0x1d2381(0x16c)],'logger':this[_0x1d2381(0x139)]}),this[_0x1d2381(0x134)]=new salesforce_service_1[(_0x1d2381(0x142))]({'connection':this[_0x1d2381(0x138)]}),this[_0x1d2381(0x15c)]=new package_export_service_1[(_0x1d2381(0x162))]({'veevaService':this[_0x1d2381(0x165)],'connection':this[_0x1d2381(0x16c)],'logger':this['_logger']});}async[a363_0x2896c7(0x175)](){const _0xbc77f5=a363_0x2896c7;try{this[_0xbc77f5(0x139)]['log'](_0xbc77f5(0x106));const _0x284bce=await this[_0xbc77f5(0x150)]();await this[_0xbc77f5(0x139)]['updateLog']();const _0x3589de=await this[_0xbc77f5(0x15c)][_0xbc77f5(0x155)](_0x284bce,SnapshotService[_0xbc77f5(0x176)]);await this['_logger'][_0xbc77f5(0x10e)]();const _0x282224=await this[_0xbc77f5(0x15e)](_0x284bce,_0x3589de);await this['saveComponentsInSalesforce'](_0x282224),await this[_0xbc77f5(0x139)][_0xbc77f5(0x10e)](),await this[_0xbc77f5(0x16b)](!![]);}catch(_0x45b16b){this[_0xbc77f5(0x139)]['logError'](_0x45b16b),await this[_0xbc77f5(0x16b)](![])['catch'](_0x1c6bca=>this[_0xbc77f5(0x13b)][_0xbc77f5(0x120)](_0x1c6bca));}}async[a363_0x2896c7(0x150)](){const _0xbfa404=a363_0x2896c7,_0x3ead6a={'veevaService':this[_0xbfa404(0x165)],'logger':this[_0xbfa404(0x139)]},_0x3f26d7=Array[_0xbfa404(0x163)](Object[_0xbfa404(0x178)](this[_0xbfa404(0x136)]))[_0xbfa404(0xfe)]?new type_and_name_veeva_component_retriever_1[(_0xbfa404(0x12e))]({'value':this[_0xbfa404(0x136)],..._0x3ead6a}):new type_veeva_component_retriever_1[(_0xbfa404(0x141))]({'value':this[_0xbfa404(0x105)],..._0x3ead6a});return _0x3f26d7[_0xbfa404(0x110)]();}async['createMetadataItemListWithBody'](_0x7d2b0c,_0xce5587){const _0x2d3c03=a363_0x2896c7;var _0x1de896,_0xb0fb7c;this[_0x2d3c03(0x139)][_0x2d3c03(0x153)](_0x2d3c03(0x115));const _0x34d5b3=this[_0x2d3c03(0x103)](_0x7d2b0c),_0xdb2541=_0x34d5b3[_0x2d3c03(0x101)]((_0x5102a1,_0x572257)=>_0x5102a1['set'](_0x572257[_0x2d3c03(0x119)],_0x572257),new Map());for(const _0x344f12 of _0xce5587){for(const _0x11b1bc in _0x344f12['files']){const {base:_0x22e056,name:_0x5d11fe,dir:_0x12a17a}=path_1[_0x2d3c03(0x117)][_0x2d3c03(0x171)](_0x11b1bc),_0x2e486b=_0x5d11fe+veeva_constants_1[_0x2d3c03(0x11e)][_0x2d3c03(0x173)];if(_0xdb2541[_0x2d3c03(0x114)](_0x22e056)){const _0x1313cf=await((_0x1de896=_0x344f12[_0x2d3c03(0x148)](path_1['default'][_0x2d3c03(0x16d)](_0x12a17a,_0x22e056)))===null||_0x1de896===void 0x0?void 0x0:_0x1de896[_0x2d3c03(0x11c)](_0x2d3c03(0x15a))),_0x3977d0=await((_0xb0fb7c=_0x344f12['file'](path_1[_0x2d3c03(0x117)][_0x2d3c03(0x16d)](_0x12a17a,_0x2e486b)))===null||_0xb0fb7c===void 0x0?void 0x0:_0xb0fb7c[_0x2d3c03(0x11c)](_0x2d3c03(0x15a)));if(_0x1313cf&&_0x3977d0){const _0x4cf3de=new jszip_1['default']();_0x4cf3de[_0x2d3c03(0x148)](_0x22e056,_0x1313cf),_0x4cf3de[_0x2d3c03(0x148)](_0x2e486b,this[_0x2d3c03(0x10b)](_0x3977d0)),_0xdb2541['get'](_0x22e056)[_0x2d3c03(0x14e)]=await _0x4cf3de[_0x2d3c03(0x137)]({'type':_0x2d3c03(0x145)});}}}}return _0x34d5b3['filter'](_0x3ff35e=>!_0x3ff35e[_0x2d3c03(0x14e)])[_0x2d3c03(0x129)](_0x5ea940=>{const _0x123576=_0x2d3c03;this[_0x123576(0x139)][_0x123576(0x153)](_0x123576(0x168)+_0x5ea940['veevaComponentType']+'.'+_0x5ea940['name']+'\x20from\x20outbound\x20package');}),_0x34d5b3[_0x2d3c03(0x125)](_0x355b0b=>_0x355b0b[_0x2d3c03(0x14e)]);}['transformDependencyFile'](_0xfff8f0){const _0x25f25d=a363_0x2896c7,_0x5ec8b9=(0x0,sync_1[_0x25f25d(0x171)])(_0xfff8f0,{'columns':!![],'skip_empty_lines':!![]}),_0x1849b1=_0x5ec8b9[_0x25f25d(0x13a)](({'In\x20Package':_0x4c3636,..._0x3ac903})=>_0x3ac903);return(0x0,sync_2['stringify'])(_0x1849b1,{'header':!![]});}[a363_0x2896c7(0x103)](_0x16d7e4){const _0x2ea32a=a363_0x2896c7;return _0x16d7e4[_0x2ea32a(0x13a)](_0xdbe539=>{const _0x499029=_0x2ea32a,_0x28b8ef=new metadata_item_dto_1['MetadataItemDto']();return _0x28b8ef[_0x499029(0x10f)]=_0xdbe539[_0x499029(0x10f)],_0x28b8ef[_0x499029(0x13e)]=_0xdbe539[_0x499029(0x10f)],_0x28b8ef[_0x499029(0x12d)]=this[_0x499029(0x121)],_0x28b8ef[_0x499029(0x119)]=_0xdbe539[_0x499029(0x146)]+'.'+_0xdbe539['name']+veeva_constants_1['VeevaConstants'][_0x499029(0x116)],_0x28b8ef[_0x499029(0x14b)]=_0xdbe539[_0x499029(0x146)],_0x28b8ef[_0x499029(0x13c)]=_0xdbe539[_0x499029(0x13c)],_0x28b8ef['isRetrieved']=![],_0x28b8ef;});}async[a363_0x2896c7(0x140)](_0x30c009){const _0x34f526=a363_0x2896c7;this[_0x34f526(0x139)]['log'](_0x34f526(0x118)),await this[_0x34f526(0x112)](_0x30c009),this[_0x34f526(0x139)][_0x34f526(0x153)](_0x34f526(0x160)+_0x30c009[_0x34f526(0xfe)]+'\x20Metadata\x20Items');const _0x22c926=_0x30c009[_0x34f526(0x13a)](_0x3652ef=>{const _0x10787e=_0x34f526;return{[constants_1[_0x10787e(0x13d)]+'Name__c']:_0x3652ef[_0x10787e(0x10f)],[constants_1[_0x10787e(0x13d)]+_0x10787e(0x144)]:_0x3652ef[_0x10787e(0x13e)],[constants_1[_0x10787e(0x13d)]+_0x10787e(0x15f)]:_0x3652ef['snapshotId'],[constants_1[_0x10787e(0x13d)]+'Label__c']:_0x3652ef[_0x10787e(0x119)],[constants_1['FLOSUM_NAMESPACE']+'Is_Retrieved__c']:_0x3652ef[_0x10787e(0x130)],[constants_1[_0x10787e(0x13d)]+_0x10787e(0x152)]:_0x3652ef[_0x10787e(0x14b)],[constants_1['FLOSUM_NAMESPACE']+'Attachment_ID__c']:_0x3652ef[_0x10787e(0x107)],[constants_1[_0x10787e(0x13d)]+_0x10787e(0x10d)]:_0x3652ef[_0x10787e(0x13c)]};}),_0x5b8443=await this[_0x34f526(0x134)][_0x34f526(0x14f)](constants_1['FLOSUM_NAMESPACE']+'Metadata_Item__c',_0x22c926);let _0x4ff67b=!![];_0x5b8443[_0x34f526(0x129)]((_0x13a223,_0x471202)=>{const _0x31ff8f=_0x34f526;this[_0x31ff8f(0x139)][_0x31ff8f(0x153)](_0x31ff8f(0x160)+_0x30c009[_0x471202][_0x31ff8f(0x14b)]+'.'+_0x30c009[_0x471202][_0x31ff8f(0x10f)]);if(!_0x13a223[_0x31ff8f(0x14c)]){_0x4ff67b=![];const _0x486068=new salesforce_dml_error_1[(_0x31ff8f(0x122))](_0x13a223[_0x31ff8f(0x177)]);this[_0x31ff8f(0x139)][_0x31ff8f(0x11f)](_0x486068);}});if(!_0x4ff67b)throw new Error(_0x34f526(0x12c));}async['saveAttachments'](_0x44fc6c){const _0x1d35db=a363_0x2896c7,_0xb7b24b=this[_0x1d35db(0x151)](_0x44fc6c),_0x329e60=await this[_0x1d35db(0x134)][_0x1d35db(0x14f)](SnapshotService[_0x1d35db(0x12f)],_0xb7b24b),_0x2fab4d=[];_0x329e60[_0x1d35db(0x129)]((_0x498338,_0x326695)=>{const _0x75e364=_0x1d35db;_0x498338[_0x75e364(0x14c)]?(_0x44fc6c[_0x326695][_0x75e364(0x107)]=_0x498338['id'],_0x44fc6c[_0x326695][_0x75e364(0x130)]=!![]):_0x2fab4d[_0x75e364(0x10c)](..._0x498338[_0x75e364(0x177)]);});if(_0x2fab4d['length'])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x2fab4d);}[a363_0x2896c7(0x151)](_0x361e79){const _0x56005f=a363_0x2896c7;return _0x361e79[_0x56005f(0x13a)](_0x11281e=>({'ParentId':this[_0x56005f(0x121)],'Name':_0x11281e[_0x56005f(0x14b)],'ContentType':_0x56005f(0x10a),'Body':_0x11281e[_0x56005f(0x14e)],'Description':_0x11281e[_0x56005f(0x14b)]}));}async[a363_0x2896c7(0x16b)](_0x21f574){const _0x105497=a363_0x2896c7,_0x5c3d3={[constants_1[_0x105497(0x13d)]+'Is_Completed__c']:!![],[constants_1[_0x105497(0x13d)]+_0x105497(0x133)]:!_0x21f574},_0x5562c1={[constants_1[_0x105497(0x13d)]+'Is_Error__c']:!_0x21f574,[constants_1[_0x105497(0x13d)]+_0x105497(0x167)]:_0x21f574,[constants_1[_0x105497(0x13d)]+_0x105497(0x11d)]:_0x21f574?status_enums_1[_0x105497(0x109)]['COMPLETED']:status_enums_1['MetadataLogStatus'][_0x105497(0x16a)],[constants_1[_0x105497(0x13d)]+_0x105497(0x11a)]:!![]};await this[_0x105497(0x138)][_0x105497(0x161)](flosum_constants_1[_0x105497(0x169)][_0x105497(0x124)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x105497(0x179)+this[_0x105497(0x121)],_0x5c3d3),await this[_0x105497(0x138)][_0x105497(0x161)](flosum_constants_1[_0x105497(0x169)][_0x105497(0x124)]+'/'+constants_1['FLOSUM_NAMESPACE']+'Metadata_Log__c/'+this['_metadataLogId'],_0x5562c1),this[_0x105497(0x139)][_0x105497(0x153)]('Snapshot\x20completed\x20'+(_0x21f574?_0x105497(0x127):_0x105497(0x15d))+'.'),await this[_0x105497(0x139)][_0x105497(0x10e)]();}}exports['SnapshotService']=SnapshotService,SnapshotService['OUTBOUND_PACKAGE_NAME']='Snapshot',SnapshotService[a363_0x2896c7(0x12f)]='Attachment';