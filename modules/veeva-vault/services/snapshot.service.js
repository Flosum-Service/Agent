const a363_0x4e737c=a363_0x6222;function a363_0x6222(_0x561b67,_0x4b45f8){const _0x12441f=a363_0x724b();return a363_0x6222=function(_0x28677a,_0x363c9b){_0x28677a=_0x28677a-0x98;let _0x724b7a=_0x12441f[_0x28677a];return _0x724b7a;},a363_0x6222(_0x561b67,_0x4b45f8);}(function(_0x1cf6d1,_0x234d4d){const _0x434171=a363_0x6222,_0x1e2a45=_0x1cf6d1();while(!![]){try{const _0x9b856=parseInt(_0x434171(0xb7))/0x1*(-parseInt(_0x434171(0xbe))/0x2)+-parseInt(_0x434171(0x118))/0x3+-parseInt(_0x434171(0x11d))/0x4*(parseInt(_0x434171(0xa6))/0x5)+parseInt(_0x434171(0x119))/0x6*(-parseInt(_0x434171(0xb5))/0x7)+parseInt(_0x434171(0x10e))/0x8+-parseInt(_0x434171(0xad))/0x9+parseInt(_0x434171(0x117))/0xa*(parseInt(_0x434171(0x109))/0xb);if(_0x9b856===_0x234d4d)break;else _0x1e2a45['push'](_0x1e2a45['shift']());}catch(_0x3e494a){_0x1e2a45['push'](_0x1e2a45['shift']());}}}(a363_0x724b,0x8492e));const a363_0x363c9b=(function(){let _0x5d1eda=!![];return function(_0x38a8a2,_0x47eba5){const _0x236ec7=_0x5d1eda?function(){const _0xe8a722=a363_0x6222;if(_0x47eba5){const _0xb4678b=_0x47eba5[_0xe8a722(0xd0)](_0x38a8a2,arguments);return _0x47eba5=null,_0xb4678b;}}:function(){};return _0x5d1eda=![],_0x236ec7;};}()),a363_0x28677a=a363_0x363c9b(this,function(){const _0x257144=a363_0x6222;return a363_0x28677a[_0x257144(0xbb)]()[_0x257144(0xf3)](_0x257144(0xc3))[_0x257144(0xbb)]()['constructor'](a363_0x28677a)[_0x257144(0xf3)](_0x257144(0xc3));});a363_0x28677a();'use strict';var __importDefault=this&&this[a363_0x4e737c(0x11a)]||function(_0x4a840b){const _0x316dae=a363_0x4e737c;return _0x4a840b&&_0x4a840b[_0x316dae(0xd8)]?_0x4a840b:{'default':_0x4a840b};};Object[a363_0x4e737c(0xf1)](exports,'__esModule',{'value':!![]}),exports[a363_0x4e737c(0xb0)]=void 0x0;const jszip_1=__importDefault(require(a363_0x4e737c(0x113))),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require(a363_0x4e737c(0x10d)),constants_1=require(a363_0x4e737c(0x105)),salesforce_service_1=require(a363_0x4e737c(0xfb)),status_enums_1=require(a363_0x4e737c(0xd9)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require(a363_0x4e737c(0xf0)),type_and_name_veeva_component_retriever_1=require(a363_0x4e737c(0xcc)),type_veeva_component_retriever_1=require(a363_0x4e737c(0xca)),sync_1=require(a363_0x4e737c(0x115)),sync_2=require(a363_0x4e737c(0x110)),veeva_constants_1=require(a363_0x4e737c(0x107)),path_1=__importDefault(require(a363_0x4e737c(0xb4)));class SnapshotService{constructor(_0x46de98,_0x9dd5c3,_0x134e2a,_0x266c60){const _0x1c0fb8=a363_0x4e737c;this[_0x1c0fb8(0xe8)]=_0x9dd5c3,this['_connectionVeeva']=_0x134e2a,this[_0x1c0fb8(0xdf)]=_0x266c60,this['_snapshotId']=_0x46de98['snapshotId'],this[_0x1c0fb8(0xee)]=_0x46de98['metadataLogId'],this[_0x1c0fb8(0xeb)]=_0x46de98[_0x1c0fb8(0xaa)],this[_0x1c0fb8(0xe0)]=_0x46de98[_0x1c0fb8(0x9a)],this[_0x1c0fb8(0xd5)]=_0x46de98[_0x1c0fb8(0xec)],this[_0x1c0fb8(0xa0)]=_0x46de98[_0x1c0fb8(0x98)],this['_veevaService']=new veeva_service_1[(_0x1c0fb8(0x9e))]({'connection':this['_connectionVeeva'],'logger':this[_0x1c0fb8(0xdf)]}),this['_salesforceService']=new salesforce_service_1[(_0x1c0fb8(0xfe))]({'connection':this['_connectionSalesforce']}),this[_0x1c0fb8(0x9f)]=new package_export_service_1[(_0x1c0fb8(0xd7))]({'veevaService':this[_0x1c0fb8(0x104)],'connection':this[_0x1c0fb8(0x9c)],'logger':this[_0x1c0fb8(0xdf)]});}async['execute'](){const _0x2c0f1b=a363_0x4e737c;try{this['_logger'][_0x2c0f1b(0xef)](_0x2c0f1b(0xc6));const _0x3159cc=await this[_0x2c0f1b(0xce)]();await this['_logger'][_0x2c0f1b(0xdd)]();const _0x45d23d=await this[_0x2c0f1b(0x9f)][_0x2c0f1b(0x11e)](_0x3159cc,SnapshotService[_0x2c0f1b(0xa2)]);await this[_0x2c0f1b(0xdf)]['updateLog']();const _0x3c978a=await this[_0x2c0f1b(0xa3)](_0x3159cc,_0x45d23d);await this[_0x2c0f1b(0x103)](_0x3c978a),await this[_0x2c0f1b(0xdf)]['updateLog'](),await this[_0x2c0f1b(0xcd)](!![]);}catch(_0x11743a){this[_0x2c0f1b(0xdf)][_0x2c0f1b(0xba)](_0x11743a),await this[_0x2c0f1b(0xcd)](![])['catch'](_0x26e048=>this[_0x2c0f1b(0xe5)][_0x2c0f1b(0x10f)](_0x26e048));}}async[a363_0x4e737c(0xce)](){const _0x39b5d0=a363_0x4e737c,_0x5de3ed={'veevaService':this[_0x39b5d0(0x104)],'logger':this[_0x39b5d0(0xdf)]},_0x547063=Array[_0x39b5d0(0xa9)](Object[_0x39b5d0(0xea)](this[_0x39b5d0(0xa0)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x39b5d0(0x116))]({'value':this['_selectedComponentMap'],..._0x5de3ed}):new type_veeva_component_retriever_1['TypeVeevaComponentRetriever']({'value':this[_0x39b5d0(0xd5)],..._0x5de3ed});return _0x547063['retrieve']();}async[a363_0x4e737c(0xa3)](_0x2ce521,_0x3239a0){const _0x2900f7=a363_0x4e737c;var _0x467454,_0x563586;this[_0x2900f7(0xdf)][_0x2900f7(0xef)](_0x2900f7(0x114));const _0x35aca4=this[_0x2900f7(0xb2)](_0x2ce521),_0x549072=_0x35aca4[_0x2900f7(0xc2)]((_0x5cba3e,_0x20dee2)=>_0x5cba3e[_0x2900f7(0xe6)](_0x20dee2[_0x2900f7(0x108)],_0x20dee2),new Map());for(const _0x53fa4f of _0x3239a0){for(const _0x2dfd9e in _0x53fa4f[_0x2900f7(0xb8)]){const {base:_0x3f41ae,name:_0x31ef74,dir:_0x114b4d}=path_1[_0x2900f7(0xb3)][_0x2900f7(0xc8)](_0x2dfd9e),_0x5e3384=_0x31ef74+veeva_constants_1[_0x2900f7(0xed)][_0x2900f7(0xab)];if(_0x549072[_0x2900f7(0xfc)](_0x3f41ae)){const _0x36b835=await((_0x467454=_0x53fa4f['file'](path_1[_0x2900f7(0xb3)][_0x2900f7(0xa1)](_0x114b4d,_0x3f41ae)))===null||_0x467454===void 0x0?void 0x0:_0x467454['async'](_0x2900f7(0xd6))),_0x24d31b=await((_0x563586=_0x53fa4f[_0x2900f7(0xa7)](path_1['default'][_0x2900f7(0xa1)](_0x114b4d,_0x5e3384)))===null||_0x563586===void 0x0?void 0x0:_0x563586[_0x2900f7(0x9b)](_0x2900f7(0xd6)));if(_0x36b835&&_0x24d31b){const _0x163612=new jszip_1[(_0x2900f7(0xb3))]();_0x163612[_0x2900f7(0xa7)](_0x3f41ae,_0x36b835),_0x163612['file'](_0x5e3384,this[_0x2900f7(0xdc)](_0x24d31b)),_0x549072[_0x2900f7(0x112)](_0x3f41ae)[_0x2900f7(0xb1)]=await _0x163612[_0x2900f7(0x11b)]({'type':_0x2900f7(0xd2)});}}}}return _0x35aca4[_0x2900f7(0x106)](_0x54634f=>!_0x54634f[_0x2900f7(0xb1)])['forEach'](_0x23769b=>{const _0x137ada=_0x2900f7;this['_logger'][_0x137ada(0xef)](_0x137ada(0x9d)+_0x23769b[_0x137ada(0xf6)]+'.'+_0x23769b['name']+_0x137ada(0x102));}),_0x35aca4[_0x2900f7(0x106)](_0x394671=>_0x394671[_0x2900f7(0xb1)]);}[a363_0x4e737c(0xdc)](_0x51dcaf){const _0x10bc87=a363_0x4e737c,_0x2f9f39=(0x0,sync_1[_0x10bc87(0xc8)])(_0x51dcaf,{'columns':!![],'skip_empty_lines':!![]}),_0x3d117b=_0x2f9f39['map'](({'In\x20Package':_0x34a353,..._0x25f1e4})=>_0x25f1e4);return(0x0,sync_2[_0x10bc87(0xe9)])(_0x3d117b,{'header':!![]});}['formMetadataItemDtoList'](_0x187952){const _0x1e9953=a363_0x4e737c;return _0x187952[_0x1e9953(0x11c)](_0x4d41f3=>{const _0x144be0=_0x1e9953,_0x4f14d1=new metadata_item_dto_1[(_0x144be0(0xda))]();return _0x4f14d1['name']=_0x4d41f3[_0x144be0(0xf8)],_0x4f14d1[_0x144be0(0xa8)]=_0x4d41f3[_0x144be0(0xf8)],_0x4f14d1[_0x144be0(0xc1)]=this[_0x144be0(0xdb)],_0x4f14d1['label']=_0x4d41f3[_0x144be0(0xde)]+'.'+_0x4d41f3[_0x144be0(0xf8)]+veeva_constants_1[_0x144be0(0xed)]['MDL_EXTENSION'],_0x4f14d1[_0x144be0(0xf6)]=_0x4d41f3[_0x144be0(0xde)],_0x4f14d1['lastModifiedDate']=_0x4d41f3[_0x144be0(0x10a)],_0x4f14d1['isRetrieved']=![],_0x4f14d1;});}async[a363_0x4e737c(0x103)](_0x436d73){const _0x23f88e=a363_0x4e737c;this[_0x23f88e(0xdf)]['log'](_0x23f88e(0xc4)),await this[_0x23f88e(0xa4)](_0x436d73),this[_0x23f88e(0xdf)][_0x23f88e(0xef)](_0x23f88e(0xac)+_0x436d73[_0x23f88e(0xe1)]+_0x23f88e(0xb6));const _0xb50cf=_0x436d73[_0x23f88e(0x11c)](_0xc4b7c2=>{const _0x21bcdb=_0x23f88e;return{[constants_1[_0x21bcdb(0xcf)]+_0x21bcdb(0x100)]:_0xc4b7c2[_0x21bcdb(0xf8)],[constants_1['FLOSUM_NAMESPACE']+'API_Name__c']:_0xc4b7c2[_0x21bcdb(0xa8)],[constants_1[_0x21bcdb(0xcf)]+_0x21bcdb(0xc7)]:_0xc4b7c2[_0x21bcdb(0xc1)],[constants_1[_0x21bcdb(0xcf)]+'Label__c']:_0xc4b7c2[_0x21bcdb(0x108)],[constants_1[_0x21bcdb(0xcf)]+_0x21bcdb(0xe7)]:_0xc4b7c2[_0x21bcdb(0xb9)],[constants_1[_0x21bcdb(0xcf)]+_0x21bcdb(0xbc)]:_0xc4b7c2['veevaComponentType'],[constants_1[_0x21bcdb(0xcf)]+'Attachment_ID__c']:_0xc4b7c2[_0x21bcdb(0xc5)],[constants_1[_0x21bcdb(0xcf)]+'Last_Modified_Date__c']:_0xc4b7c2['lastModifiedDate']};}),_0x176074=await this[_0x23f88e(0xe4)][_0x23f88e(0xaf)](constants_1['FLOSUM_NAMESPACE']+_0x23f88e(0xc9),_0xb50cf);let _0x2aa4bd=!![];_0x176074[_0x23f88e(0xd4)]((_0x4e1af5,_0x1ecda8)=>{const _0xdbdcb3=_0x23f88e;this['_logger'][_0xdbdcb3(0xef)](_0xdbdcb3(0xac)+_0x436d73[_0x1ecda8][_0xdbdcb3(0xf6)]+'.'+_0x436d73[_0x1ecda8][_0xdbdcb3(0xf8)]);if(!_0x4e1af5[_0xdbdcb3(0xff)]){_0x2aa4bd=![];const _0x19f12b=new salesforce_dml_error_1[(_0xdbdcb3(0xcb))](_0x4e1af5[_0xdbdcb3(0xf7)]);this[_0xdbdcb3(0xdf)][_0xdbdcb3(0xba)](_0x19f12b);}});if(!_0x2aa4bd)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async['saveAttachments'](_0x1230d2){const _0x551bea=a363_0x4e737c,_0x29df6a=this[_0x551bea(0xf2)](_0x1230d2),_0xd2c4ee=await this['_salesforceService'][_0x551bea(0xaf)](SnapshotService[_0x551bea(0xfd)],_0x29df6a),_0x530315=[];_0xd2c4ee[_0x551bea(0xd4)]((_0x2c4331,_0x40f112)=>{const _0xf56d95=_0x551bea;_0x2c4331['success']?(_0x1230d2[_0x40f112][_0xf56d95(0xc5)]=_0x2c4331['id'],_0x1230d2[_0x40f112][_0xf56d95(0xb9)]=!![]):_0x530315[_0xf56d95(0x111)](..._0x2c4331[_0xf56d95(0xf7)]);});if(_0x530315[_0x551bea(0xe1)])throw new salesforce_dml_error_1[(_0x551bea(0xcb))](_0x530315);}['formAttachments'](_0x155d7d){const _0x4ca7ae=a363_0x4e737c;return _0x155d7d['map'](_0x469360=>({'ParentId':this[_0x4ca7ae(0xdb)],'Name':_0x469360[_0x4ca7ae(0xf6)],'ContentType':_0x4ca7ae(0x99),'Body':_0x469360[_0x4ca7ae(0xb1)],'Description':_0x469360[_0x4ca7ae(0xf6)]}));}async['finishSnapshot'](_0x467afe){const _0x46b155=a363_0x4e737c,_0x3f7954={[constants_1['FLOSUM_NAMESPACE']+_0x46b155(0xbf)]:!![],[constants_1[_0x46b155(0xcf)]+_0x46b155(0xf4)]:!_0x467afe},_0x5a9df8={[constants_1['FLOSUM_NAMESPACE']+_0x46b155(0xf4)]:!_0x467afe,[constants_1[_0x46b155(0xcf)]+_0x46b155(0xe2)]:_0x467afe,[constants_1[_0x46b155(0xcf)]+_0x46b155(0xf9)]:_0x467afe?status_enums_1['MetadataLogStatus']['COMPLETED']:status_enums_1[_0x46b155(0xd1)][_0x46b155(0xfa)],[constants_1[_0x46b155(0xcf)]+_0x46b155(0x10b)]:!![]};await this[_0x46b155(0xe8)][_0x46b155(0x101)](flosum_constants_1[_0x46b155(0xe3)][_0x46b155(0xc0)]+'/'+constants_1[_0x46b155(0xcf)]+_0x46b155(0xf5)+this[_0x46b155(0xdb)],_0x3f7954),await this[_0x46b155(0xe8)][_0x46b155(0x101)](flosum_constants_1[_0x46b155(0xe3)][_0x46b155(0xc0)]+'/'+constants_1[_0x46b155(0xcf)]+_0x46b155(0x10c)+this[_0x46b155(0xee)],_0x5a9df8),this[_0x46b155(0xdf)]['log'](_0x46b155(0xa5)+(_0x467afe?'successfully':_0x46b155(0xae))+'.'),await this[_0x46b155(0xdf)][_0x46b155(0xdd)]();}}function a363_0x724b(){const _0xcdda5e=['updateLog','type','_logger','_timeZone','length','Succeed__c','FlosumConstants','_salesforceService','_systemLogger','set','Is_Retrieved__c','_connectionSalesforce','stringify','values','_attachmentLogId','selectedMetaTypes','VeevaConstants','_metadataLogId','log','./package-export.service','defineProperty','formAttachments','search','Is_Error__c','Snapshot__c/','veevaComponentType','errors','name','Status__c','EXCEPTION','./salesforce.service','has','ATTACHMENT','SalesforceService','success','Name__c','patch','\x20from\x20outbound\x20package','saveComponentsInSalesforce','_veevaService','../../../constants','filter','../constants/veeva.constants','label','781GZLcHk','lastModifiedDate','Job_Completed__c','Metadata_Log__c/','../dtos/metadata-item.dto','5197600EXxDYr','error','csv-stringify/sync','push','get','jszip','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','csv-parse/sync','TypeAndNameVeevaComponentRetriever','394770JAUhJu','2438109lRYknS','233502XQRMTJ','__importDefault','generateAsync','map','2952560VGnGWc','export','selectedComponentMap','application/zip','timeZone','async','_connectionVeeva','Cannot\x20retrieve\x20','VeevaService','_packageExportService','_selectedComponentMap','join','OUTBOUND_PACKAGE_NAME','createMetadataItemListWithBody','saveAttachments','Snapshot\x20completed\x20','5pNPsyQ','file','apiName','from','attachmentLogId','DEPENDENCY_EXTENSION','Saving\x20','4594923kERelg','with\x20error','insertMultipleRecords','SnapshotService','body','formMetadataItemDtoList','default','path','91TOCvzQ','\x20Metadata\x20Items','114078mfPaMB','files','isRetrieved','logError','toString','Veeva_Component_Type__c','Snapshot','6wpNuJR','Is_Completed__c','ENDPOINT_UPSERT_RECORD','snapshotId','reduce','(((.+)+)+)+$','Saving\x20Attachments.','attachmentId','Snapshot\x20started.','Snapshot__c','parse','Metadata_Item__c','../classes/retrievers/veeva-components/type.veeva-component.retriever','SalesforceDmlError','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','finishSnapshot','retrieveVeevaComponents','FLOSUM_NAMESPACE','apply','MetadataLogStatus','base64','Attachment','forEach','_selectedMetaTypes','string','PackageExportService','__esModule','../enums/status.enums','MetadataItemDto','_snapshotId','transformDependencyFile'];a363_0x724b=function(){return _0xcdda5e;};return a363_0x724b();}exports[a363_0x4e737c(0xb0)]=SnapshotService,SnapshotService['OUTBOUND_PACKAGE_NAME']=a363_0x4e737c(0xbd),SnapshotService[a363_0x4e737c(0xfd)]=a363_0x4e737c(0xd3);