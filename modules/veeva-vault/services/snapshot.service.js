const a379_0x122b5d=a379_0x52de;(function(_0xd82fd8,_0x58b7ef){const _0x14187c=a379_0x52de,_0x99a34d=_0xd82fd8();while(!![]){try{const _0x515cd0=parseInt(_0x14187c(0x11d))/0x1+-parseInt(_0x14187c(0x135))/0x2+-parseInt(_0x14187c(0x13e))/0x3+-parseInt(_0x14187c(0x11f))/0x4*(parseInt(_0x14187c(0xeb))/0x5)+parseInt(_0x14187c(0x124))/0x6+-parseInt(_0x14187c(0x116))/0x7+parseInt(_0x14187c(0xf7))/0x8;if(_0x515cd0===_0x58b7ef)break;else _0x99a34d['push'](_0x99a34d['shift']());}catch(_0x522b22){_0x99a34d['push'](_0x99a34d['shift']());}}}(a379_0x1f4b,0xb30e7));function a379_0x1f4b(){const _0x1b3185=['get','133435IAowfI','../classes/errors/salesforce-dml-error','execute','createMetadataItemListWithBody','insertMultipleRecords','file','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','Metadata_Item__c','../enums/status.enums','./veeva.service','_logger','Snapshot\x20completed\x20','20219456qexJAl','formMetadataItemDtoList','SalesforceDmlError','./package-export.service','success','type','reduce','Snapshot__c/','_metadataLogId','transformDependencyFile','Snapshot\x20started.','Snapshot__c','_veevaService','Cannot\x20retrieve\x20','Label__c','Job_Completed__c','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','sep','\x20from\x20outbound\x20package','../../../constants','application/zip','VeevaConstants','OUTBOUND_PACKAGE_NAME','../classes/retrievers/veeva-components/type.veeva-component.retriever','retrieve','../constants/veeva.constants','Snapshot','updateLog','lastModifiedDate','Attachment','apiName','3194485JxdIgt','saveComponentsInSalesforce','filter','MetadataLogStatus','../dtos/metadata-item.dto','_systemLogger','MetadataItemDto','638123yTuNzh','snapshotId','188UnspwN','with\x20error','_whereClause','constructor','_salesforceService','2738658ObJXma','ATTACHMENT','Is_Error__c','_packageExportService','apply','_selectedMetaTypes','csv-parse/sync','join','FlosumConstants','DEPENDENCY_EXTENSION','export','toString','MDL_EXTENSION','Saving\x20Attachments.','posix','defineProperty','FLOSUM_NAMESPACE','1758754KSdJsz','_connectionSalesforce','csv-stringify/sync','isRetrieved','name','parse','VeevaService','values','set','895686JzBAbc','Is_Retrieved__c','Saving\x20','label','Name__c','log','files','body','Attachment_ID__c','search','veevaComponentType','../constants/flosum.constants','Last_Modified_Date__c','_selectedComponentMap','length','Status__c','attachmentId','forEach','Is_Completed__c','(((.+)+)+)+$','string','formAttachments','map','saveAttachments','SnapshotService','successfully','__importDefault','_connectionVeeva','errors','Cannot\x20Save\x20Metadata\x20Items','\x20Metadata\x20Items','TypeVeevaComponentRetriever','jszip','default','patch','base64','async','__esModule','_snapshotId','logError'];a379_0x1f4b=function(){return _0x1b3185;};return a379_0x1f4b();}const a379_0x4f4fc6=(function(){let _0x45f410=!![];return function(_0x3cd4bd,_0x25ab87){const _0x2b1529=_0x45f410?function(){const _0x1f9fbc=a379_0x52de;if(_0x25ab87){const _0x4a4446=_0x25ab87[_0x1f9fbc(0x128)](_0x3cd4bd,arguments);return _0x25ab87=null,_0x4a4446;}}:function(){};return _0x45f410=![],_0x2b1529;};}()),a379_0x3da76a=a379_0x4f4fc6(this,function(){const _0x4daa90=a379_0x52de;return a379_0x3da76a[_0x4daa90(0x12f)]()[_0x4daa90(0x147)](_0x4daa90(0x151))[_0x4daa90(0x12f)]()[_0x4daa90(0x122)](a379_0x3da76a)['search'](_0x4daa90(0x151));});a379_0x3da76a();'use strict';var __importDefault=this&&this[a379_0x122b5d(0x158)]||function(_0x4d0e19){return _0x4d0e19&&_0x4d0e19['__esModule']?_0x4d0e19:{'default':_0x4d0e19};};Object[a379_0x122b5d(0x133)](exports,a379_0x122b5d(0xe7),{'value':!![]}),exports[a379_0x122b5d(0x156)]=void 0x0;function a379_0x52de(_0xe65898,_0x41dd18){const _0x369ebe=a379_0x1f4b();return a379_0x52de=function(_0x3da76a,_0x4f4fc6){_0x3da76a=_0x3da76a-0xe1;let _0x1f4bb6=_0x369ebe[_0x3da76a];return _0x1f4bb6;},a379_0x52de(_0xe65898,_0x41dd18);}const jszip_1=__importDefault(require(a379_0x122b5d(0xe2))),flosum_constants_1=require(a379_0x122b5d(0x149)),veeva_service_1=require(a379_0x122b5d(0xf4)),metadata_item_dto_1=require(a379_0x122b5d(0x11a)),constants_1=require(a379_0x122b5d(0x10a)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a379_0x122b5d(0xf3)),salesforce_dml_error_1=require(a379_0x122b5d(0xec)),package_export_service_1=require(a379_0x122b5d(0xfa)),type_and_name_veeva_component_retriever_1=require(a379_0x122b5d(0x107)),type_veeva_component_retriever_1=require(a379_0x122b5d(0x10e)),sync_1=require(a379_0x122b5d(0x12a)),sync_2=require(a379_0x122b5d(0x137)),veeva_constants_1=require(a379_0x122b5d(0x110)),path_1=__importDefault(require('path'));class SnapshotService{constructor({snapshotId:_0x491681,metadataLogId:_0x1467b4,selectedMetaTypes:_0x41754a,selectedComponentMap:_0x5d0826,whereClause:_0x749c1},_0x193a17,_0x5bf9be,_0x419be2){const _0x4436d8=a379_0x122b5d;this[_0x4436d8(0x136)]=_0x193a17,this[_0x4436d8(0x159)]=_0x5bf9be,this['_logger']=_0x419be2,this[_0x4436d8(0xe8)]=_0x491681,this[_0x4436d8(0xff)]=_0x1467b4,this[_0x4436d8(0x129)]=_0x41754a,this[_0x4436d8(0x14b)]=_0x5d0826,this['_whereClause']=_0x749c1,this['_veevaService']=new veeva_service_1[(_0x4436d8(0x13b))]({'connection':this[_0x4436d8(0x159)],'logger':this[_0x4436d8(0xf5)]}),this[_0x4436d8(0x123)]=new salesforce_service_1['SalesforceService']({'connection':this['_connectionSalesforce']}),this[_0x4436d8(0x127)]=new package_export_service_1['PackageExportService']({'veevaService':this['_veevaService'],'connection':this[_0x4436d8(0x159)],'logger':this[_0x4436d8(0xf5)]});}async[a379_0x122b5d(0xed)](){const _0xdfef72=a379_0x122b5d;try{this[_0xdfef72(0xf5)][_0xdfef72(0x143)](_0xdfef72(0x101));const _0x172a23=await this['retrieveVeevaComponents']();await this['_logger']['updateLog']();const _0x28b6fe=await this[_0xdfef72(0x127)][_0xdfef72(0x12e)](_0x172a23,SnapshotService[_0xdfef72(0x10d)]);await this[_0xdfef72(0xf5)][_0xdfef72(0x112)]();const _0x10a085=await this[_0xdfef72(0xee)](_0x172a23,_0x28b6fe);await this[_0xdfef72(0x117)](_0x10a085),await this[_0xdfef72(0xf5)][_0xdfef72(0x112)](),await this['finishSnapshot'](!![]);}catch(_0x4d8f4d){this[_0xdfef72(0xf5)][_0xdfef72(0xe9)](_0x4d8f4d),await this['finishSnapshot'](![])['catch'](_0x3f813e=>this[_0xdfef72(0x11b)]['error'](_0x3f813e));}}async['retrieveVeevaComponents'](){const _0x31841f=a379_0x122b5d,_0x2d2ac0={'veevaService':this[_0x31841f(0x103)],'logger':this[_0x31841f(0xf5)]},_0x585807=Array['from'](Object[_0x31841f(0x13c)](this[_0x31841f(0x14b)]))['length']?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x31841f(0x14b)],..._0x2d2ac0}):new type_veeva_component_retriever_1[(_0x31841f(0xe1))]({'value':this[_0x31841f(0x129)],'whereClause':this[_0x31841f(0x121)],..._0x2d2ac0});return _0x585807[_0x31841f(0x10f)]();}async[a379_0x122b5d(0xee)](_0x45122d,_0x58721b){const _0x21225d=a379_0x122b5d;var _0x2f1446,_0x232288;this['_logger'][_0x21225d(0x143)](_0x21225d(0xf1));const _0x1c22eb=this[_0x21225d(0xf8)](_0x45122d),_0x3dd146=_0x1c22eb[_0x21225d(0xfd)]((_0x599c3c,_0x3f343d)=>_0x599c3c[_0x21225d(0x13d)](_0x3f343d[_0x21225d(0x141)],_0x3f343d),new Map());for(const _0x157c1d of _0x58721b){for(const _0x5a9539 in _0x157c1d[_0x21225d(0x144)]){const {base:_0x15fd88,name:_0xd90f02,dir:_0x1c7187}=path_1[_0x21225d(0xe3)][_0x21225d(0x13a)](_0x5a9539),_0x30a7d4=_0xd90f02+veeva_constants_1[_0x21225d(0x10c)][_0x21225d(0x12d)];if(_0x3dd146['has'](_0x15fd88)){const _0x117c67=await((_0x2f1446=_0x157c1d[_0x21225d(0xf0)]([_0x1c7187,_0x15fd88][_0x21225d(0x12b)](path_1[_0x21225d(0xe3)][_0x21225d(0x132)][_0x21225d(0x108)])))===null||_0x2f1446===void 0x0?void 0x0:_0x2f1446['async']('string')),_0x3162b5=await((_0x232288=_0x157c1d[_0x21225d(0xf0)]([_0x1c7187,_0x30a7d4][_0x21225d(0x12b)](path_1[_0x21225d(0xe3)][_0x21225d(0x132)][_0x21225d(0x108)])))===null||_0x232288===void 0x0?void 0x0:_0x232288[_0x21225d(0xe6)](_0x21225d(0x152)));if(_0x117c67){const _0x3307fc=new jszip_1['default']();_0x3307fc[_0x21225d(0xf0)](_0x15fd88,_0x117c67),_0x3162b5&&_0x3307fc[_0x21225d(0xf0)](_0x30a7d4,this[_0x21225d(0x100)](_0x3162b5)),_0x3dd146[_0x21225d(0xea)](_0x15fd88)['body']=await _0x3307fc['generateAsync']({'type':_0x21225d(0xe5)});}}}}return _0x1c22eb['filter'](_0x29bc41=>!_0x29bc41['body'])[_0x21225d(0x14f)](_0x3349ae=>{const _0x37600f=_0x21225d;this[_0x37600f(0xf5)]['log'](_0x37600f(0x104)+_0x3349ae['veevaComponentType']+'.'+_0x3349ae[_0x37600f(0x139)]+_0x37600f(0x109));}),_0x1c22eb[_0x21225d(0x118)](_0x7fe271=>_0x7fe271[_0x21225d(0x145)]);}[a379_0x122b5d(0x100)](_0x5d26d0){const _0x474d72=a379_0x122b5d,_0x146998=(0x0,sync_1[_0x474d72(0x13a)])(_0x5d26d0,{'columns':!![],'skip_empty_lines':!![]}),_0x3610cc=_0x146998[_0x474d72(0x154)](({'In\x20Package':_0x3abbbf,..._0x212a28})=>_0x212a28);return(0x0,sync_2['stringify'])(_0x3610cc,{'header':!![]});}[a379_0x122b5d(0xf8)](_0x4ee02c){const _0x174220=a379_0x122b5d;return _0x4ee02c[_0x174220(0x154)](_0xfde8ec=>{const _0x33fb06=_0x174220,_0x4271a=new metadata_item_dto_1[(_0x33fb06(0x11c))]();return _0x4271a['name']=_0xfde8ec[_0x33fb06(0x139)],_0x4271a[_0x33fb06(0x115)]=_0xfde8ec[_0x33fb06(0x139)],_0x4271a[_0x33fb06(0x11e)]=this[_0x33fb06(0xe8)],_0x4271a[_0x33fb06(0x141)]=_0xfde8ec[_0x33fb06(0xfc)]+'.'+_0xfde8ec[_0x33fb06(0x139)]+veeva_constants_1['VeevaConstants'][_0x33fb06(0x130)],_0x4271a[_0x33fb06(0x148)]=_0xfde8ec[_0x33fb06(0xfc)],_0x4271a['lastModifiedDate']=_0xfde8ec['lastModifiedDate'],_0x4271a[_0x33fb06(0x138)]=![],_0x4271a;});}async[a379_0x122b5d(0x117)](_0xa77f4b){const _0x4c3d47=a379_0x122b5d;this[_0x4c3d47(0xf5)][_0x4c3d47(0x143)](_0x4c3d47(0x131)),await this[_0x4c3d47(0x155)](_0xa77f4b),this[_0x4c3d47(0xf5)]['log'](_0x4c3d47(0x140)+_0xa77f4b['length']+_0x4c3d47(0x15c));const _0x128bb7=_0xa77f4b[_0x4c3d47(0x154)](_0x4bc6c5=>{const _0x19ebea=_0x4c3d47;return{[constants_1[_0x19ebea(0x134)]+_0x19ebea(0x142)]:_0x4bc6c5[_0x19ebea(0x139)],[constants_1[_0x19ebea(0x134)]+'API_Name__c']:_0x4bc6c5[_0x19ebea(0x115)],[constants_1['FLOSUM_NAMESPACE']+_0x19ebea(0x102)]:_0x4bc6c5[_0x19ebea(0x11e)],[constants_1[_0x19ebea(0x134)]+_0x19ebea(0x105)]:_0x4bc6c5[_0x19ebea(0x141)],[constants_1[_0x19ebea(0x134)]+_0x19ebea(0x13f)]:_0x4bc6c5[_0x19ebea(0x138)],[constants_1[_0x19ebea(0x134)]+'Veeva_Component_Type__c']:_0x4bc6c5['veevaComponentType'],[constants_1['FLOSUM_NAMESPACE']+_0x19ebea(0x146)]:_0x4bc6c5[_0x19ebea(0x14e)],[constants_1[_0x19ebea(0x134)]+_0x19ebea(0x14a)]:_0x4bc6c5[_0x19ebea(0x113)]};}),_0x4b68ea=await this['_salesforceService'][_0x4c3d47(0xef)](constants_1['FLOSUM_NAMESPACE']+_0x4c3d47(0xf2),_0x128bb7);let _0x2b9d9e=!![];_0x4b68ea[_0x4c3d47(0x14f)]((_0x4f4034,_0x520528)=>{const _0x40932a=_0x4c3d47;this['_logger'][_0x40932a(0x143)](_0x40932a(0x140)+_0xa77f4b[_0x520528][_0x40932a(0x148)]+'.'+_0xa77f4b[_0x520528][_0x40932a(0x139)]);if(!_0x4f4034['success']){_0x2b9d9e=![];const _0x2bc65d=new salesforce_dml_error_1[(_0x40932a(0xf9))](_0x4f4034[_0x40932a(0x15a)]);this[_0x40932a(0xf5)][_0x40932a(0xe9)](_0x2bc65d);}});if(!_0x2b9d9e)throw new Error(_0x4c3d47(0x15b));}async[a379_0x122b5d(0x155)](_0x56c262){const _0x59f75d=a379_0x122b5d,_0x4ccdd4=this[_0x59f75d(0x153)](_0x56c262),_0x33f7d6=await this[_0x59f75d(0x123)][_0x59f75d(0xef)](SnapshotService[_0x59f75d(0x125)],_0x4ccdd4),_0x2096cd=[];_0x33f7d6['forEach']((_0x2e730f,_0xee80e4)=>{const _0x19d422=_0x59f75d;_0x2e730f[_0x19d422(0xfb)]?(_0x56c262[_0xee80e4][_0x19d422(0x14e)]=_0x2e730f['id'],_0x56c262[_0xee80e4]['isRetrieved']=!![]):_0x2096cd['push'](..._0x2e730f[_0x19d422(0x15a)]);});if(_0x2096cd[_0x59f75d(0x14c)])throw new salesforce_dml_error_1[(_0x59f75d(0xf9))](_0x2096cd);}['formAttachments'](_0xc38e13){const _0x396cba=a379_0x122b5d;return _0xc38e13['map'](_0x45efd4=>({'ParentId':this[_0x396cba(0xe8)],'Name':_0x45efd4[_0x396cba(0x148)],'ContentType':_0x396cba(0x10b),'Body':_0x45efd4[_0x396cba(0x145)],'Description':_0x45efd4['veevaComponentType']}));}async['finishSnapshot'](_0x2657d7){const _0x2a666b=a379_0x122b5d,_0x52f331={[constants_1['FLOSUM_NAMESPACE']+_0x2a666b(0x150)]:!![],[constants_1['FLOSUM_NAMESPACE']+'Is_Error__c']:!_0x2657d7},_0x1bdbc9={[constants_1[_0x2a666b(0x134)]+_0x2a666b(0x126)]:!_0x2657d7,[constants_1[_0x2a666b(0x134)]+'Succeed__c']:_0x2657d7,[constants_1['FLOSUM_NAMESPACE']+_0x2a666b(0x14d)]:_0x2657d7?status_enums_1[_0x2a666b(0x119)]['COMPLETED']:status_enums_1[_0x2a666b(0x119)]['EXCEPTION'],[constants_1[_0x2a666b(0x134)]+_0x2a666b(0x106)]:!![]};await this[_0x2a666b(0x136)][_0x2a666b(0xe4)](flosum_constants_1[_0x2a666b(0x12c)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1['FLOSUM_NAMESPACE']+_0x2a666b(0xfe)+this['_snapshotId'],_0x52f331),await this['_connectionSalesforce'][_0x2a666b(0xe4)](flosum_constants_1[_0x2a666b(0x12c)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x2a666b(0x134)]+'Metadata_Log__c/'+this[_0x2a666b(0xff)],_0x1bdbc9),this[_0x2a666b(0xf5)]['log'](_0x2a666b(0xf6)+(_0x2657d7?_0x2a666b(0x157):_0x2a666b(0x120))+'.'),await this['_logger'][_0x2a666b(0x112)]();}}exports[a379_0x122b5d(0x156)]=SnapshotService,SnapshotService[a379_0x122b5d(0x10d)]=a379_0x122b5d(0x111),SnapshotService[a379_0x122b5d(0x125)]=a379_0x122b5d(0x114);