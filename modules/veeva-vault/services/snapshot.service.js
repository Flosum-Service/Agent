const a408_0x55d01b=a408_0x2c5a;(function(_0x4194e5,_0x920d2b){const _0x17929a=a408_0x2c5a,_0x781ee2=_0x4194e5();while(!![]){try{const _0x126807=-parseInt(_0x17929a(0x1cf))/0x1+parseInt(_0x17929a(0x208))/0x2*(parseInt(_0x17929a(0x1df))/0x3)+parseInt(_0x17929a(0x1c1))/0x4+-parseInt(_0x17929a(0x1d5))/0x5*(-parseInt(_0x17929a(0x1c8))/0x6)+-parseInt(_0x17929a(0x1af))/0x7+-parseInt(_0x17929a(0x203))/0x8+parseInt(_0x17929a(0x1ab))/0x9;if(_0x126807===_0x920d2b)break;else _0x781ee2['push'](_0x781ee2['shift']());}catch(_0x31cbfd){_0x781ee2['push'](_0x781ee2['shift']());}}}(a408_0x1a2e,0x98273));const a408_0x332b17=(function(){let _0x5c323d=!![];return function(_0x2b3e1,_0x46c86e){const _0x3ce0c3=_0x5c323d?function(){const _0x18af00=a408_0x2c5a;if(_0x46c86e){const _0x4cf5c2=_0x46c86e[_0x18af00(0x20a)](_0x2b3e1,arguments);return _0x46c86e=null,_0x4cf5c2;}}:function(){};return _0x5c323d=![],_0x3ce0c3;};}()),a408_0x441676=a408_0x332b17(this,function(){const _0x2e4368=a408_0x2c5a;return a408_0x441676[_0x2e4368(0x1e2)]()[_0x2e4368(0x1fc)](_0x2e4368(0x1f3))[_0x2e4368(0x1e2)]()[_0x2e4368(0x1bb)](a408_0x441676)[_0x2e4368(0x1fc)](_0x2e4368(0x1f3));});a408_0x441676();'use strict';function a408_0x1a2e(){const _0x1675a9=['TypeVeevaComponentRetriever','__esModule','Snapshot\x20completed\x20','Attachment_ID__c','_veevaService','join','_snapshotId','errors','error','files','11487582WaiFbr','sep','TypeAndNameVeevaComponentRetriever','SnapshotService','4146793DDrEJs','EXCEPTION','export','success','__importDefault','base64','../constants/veeva.constants','Snapshot__c/','Succeed__c','apiName','Is_Completed__c','Cannot\x20retrieve\x20','constructor','FLOSUM_NAMESPACE','log','Job_Completed__c','Snapshot__c','string','271432EdJzwV','../../../constants','\x20from\x20outbound\x20package','path','PackageExportService','stringify','FlosumConstants','1675956PoNbaP','retrieve','finishSnapshot','_logger','Label__c','_metadataLogId','successfully','225231HNqqOK','parse','name','_salesforceService','set','default','5uzoBLI','values','csv-parse/sync','defineProperty','_selectedMetaTypes','VeevaService','attachmentId','forEach','SalesforceService','retrieveVeevaComponents','3699WPbJHd','../constants/flosum.constants','Veeva_Component_Type__c','toString','map','label','_selectedComponentMap','Name__c','Is_Retrieved__c','posix','lastModifiedDate','transformDependencyFile','DEPENDENCY_EXTENSION','OUTBOUND_PACKAGE_NAME','formMetadataItemDtoList','SalesforceDmlError','Cannot\x20Save\x20Metadata\x20Items','patch','_whereClause','saveComponentsInSalesforce','(((.+)+)+)+$','Metadata_Log__c/','Status__c','MetadataItemDto','isRetrieved','VeevaConstants','_packageExportService','application/zip','veevaComponentType','search','Saving\x20','logError','MDL_EXTENSION','catch','jszip','csv-stringify/sync','2793504HUVzae','MetadataLogStatus','execute','ATTACHMENT','from','270dZEXpv','_connectionVeeva','apply','Snapshot','with\x20error','length','../dtos/metadata-item.dto','Is_Error__c','updateLog','Metadata_Item__c','body','./salesforce.service','ENDPOINT_UPSERT_RECORD','reduce','filter','saveAttachments','file','async','_systemLogger','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever'];a408_0x1a2e=function(){return _0x1675a9;};return a408_0x1a2e();}var __importDefault=this&&this[a408_0x55d01b(0x1b3)]||function(_0x5bfaaa){const _0x1e2860=a408_0x55d01b;return _0x5bfaaa&&_0x5bfaaa[_0x1e2860(0x1a2)]?_0x5bfaaa:{'default':_0x5bfaaa};};Object[a408_0x55d01b(0x1d8)](exports,a408_0x55d01b(0x1a2),{'value':!![]}),exports[a408_0x55d01b(0x1ae)]=void 0x0;const jszip_1=__importDefault(require(a408_0x55d01b(0x201))),flosum_constants_1=require(a408_0x55d01b(0x1e0)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require(a408_0x55d01b(0x193)),constants_1=require(a408_0x55d01b(0x1c2)),salesforce_service_1=require(a408_0x55d01b(0x198)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require('./package-export.service'),type_and_name_veeva_component_retriever_1=require(a408_0x55d01b(0x1a0)),type_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type.veeva-component.retriever'),sync_1=require(a408_0x55d01b(0x1d7)),sync_2=require(a408_0x55d01b(0x202)),veeva_constants_1=require(a408_0x55d01b(0x1b5)),path_1=__importDefault(require(a408_0x55d01b(0x1c4)));class SnapshotService{constructor({snapshotId:_0x3ed96f,metadataLogId:_0x47e9d8,selectedMetaTypes:_0x3904be,selectedComponentMap:_0xbeca9,whereClause:_0x243913},_0x208234,_0x3fb50b,_0x2aca8d){const _0x4b467e=a408_0x55d01b;this['_connectionSalesforce']=_0x208234,this[_0x4b467e(0x209)]=_0x3fb50b,this['_logger']=_0x2aca8d,this[_0x4b467e(0x1a7)]=_0x3ed96f,this[_0x4b467e(0x1cd)]=_0x47e9d8,this[_0x4b467e(0x1d9)]=_0x3904be,this['_selectedComponentMap']=_0xbeca9,this['_whereClause']=_0x243913,this['_veevaService']=new veeva_service_1[(_0x4b467e(0x1da))]({'connection':this[_0x4b467e(0x209)],'logger':this[_0x4b467e(0x1cb)]}),this[_0x4b467e(0x1d2)]=new salesforce_service_1[(_0x4b467e(0x1dd))]({'connection':this['_connectionSalesforce']}),this[_0x4b467e(0x1f9)]=new package_export_service_1[(_0x4b467e(0x1c5))]({'veevaService':this[_0x4b467e(0x1a5)],'connection':this[_0x4b467e(0x209)],'logger':this['_logger']});}async[a408_0x55d01b(0x205)](){const _0x11f217=a408_0x55d01b;try{this[_0x11f217(0x1cb)]['log']('Snapshot\x20started.');const _0x92266a=await this[_0x11f217(0x1de)]();await this[_0x11f217(0x1cb)]['updateLog']();const _0x310dcd=await this['_packageExportService'][_0x11f217(0x1b1)](_0x92266a,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this[_0x11f217(0x1cb)][_0x11f217(0x195)]();const _0x3e40ef=await this['createMetadataItemListWithBody'](_0x92266a,_0x310dcd);await this['saveComponentsInSalesforce'](_0x3e40ef),await this['_logger'][_0x11f217(0x195)](),await this[_0x11f217(0x1ca)](!![]);}catch(_0x4921e5){this['_logger'][_0x11f217(0x1fe)](_0x4921e5),await this[_0x11f217(0x1ca)](![])[_0x11f217(0x200)](_0x4a8573=>this[_0x11f217(0x19f)][_0x11f217(0x1a9)](_0x4a8573));}}async['retrieveVeevaComponents'](){const _0x48ac14=a408_0x55d01b,_0x10168a={'veevaService':this[_0x48ac14(0x1a5)],'logger':this[_0x48ac14(0x1cb)]},_0x3feffd=Array[_0x48ac14(0x207)](Object[_0x48ac14(0x1d6)](this[_0x48ac14(0x1e5)]))[_0x48ac14(0x20d)]?new type_and_name_veeva_component_retriever_1[(_0x48ac14(0x1ad))]({'value':this[_0x48ac14(0x1e5)],..._0x10168a}):new type_veeva_component_retriever_1[(_0x48ac14(0x1a1))]({'value':this[_0x48ac14(0x1d9)],'whereClause':this[_0x48ac14(0x1f1)],..._0x10168a});return _0x3feffd[_0x48ac14(0x1c9)]();}async['createMetadataItemListWithBody'](_0x5222e0,_0x3e0c79){const _0x17d349=a408_0x55d01b;var _0x2382f7,_0x59213d;this[_0x17d349(0x1cb)][_0x17d349(0x1bd)]('Unpack\x20zip\x20and\x20create\x20metadata\x20items.');const _0x53dae8=this[_0x17d349(0x1ed)](_0x5222e0),_0x27b867=_0x53dae8[_0x17d349(0x19a)]((_0x121477,_0x54d6a1)=>_0x121477[_0x17d349(0x1d3)](_0x54d6a1[_0x17d349(0x1e4)],_0x54d6a1),new Map());for(const _0x467b4d of _0x3e0c79){for(const _0x1791aa in _0x467b4d[_0x17d349(0x1aa)]){const {base:_0x5e0df4,name:_0xbcd052,dir:_0x146172}=path_1[_0x17d349(0x1d4)]['parse'](_0x1791aa),_0xd09d92=_0xbcd052+veeva_constants_1['VeevaConstants'][_0x17d349(0x1eb)];if(_0x27b867['has'](_0x5e0df4)){const _0x344e4f=await((_0x2382f7=_0x467b4d[_0x17d349(0x19d)]([_0x146172,_0x5e0df4][_0x17d349(0x1a6)](path_1[_0x17d349(0x1d4)]['posix']['sep'])))===null||_0x2382f7===void 0x0?void 0x0:_0x2382f7[_0x17d349(0x19e)]('string')),_0x616697=await((_0x59213d=_0x467b4d[_0x17d349(0x19d)]([_0x146172,_0xd09d92][_0x17d349(0x1a6)](path_1[_0x17d349(0x1d4)][_0x17d349(0x1e8)][_0x17d349(0x1ac)])))===null||_0x59213d===void 0x0?void 0x0:_0x59213d['async'](_0x17d349(0x1c0)));if(_0x344e4f){const _0x367847=new jszip_1['default']();_0x367847[_0x17d349(0x19d)](_0x5e0df4,_0x344e4f),_0x616697&&_0x367847[_0x17d349(0x19d)](_0xd09d92,this[_0x17d349(0x1ea)](_0x616697)),_0x27b867['get'](_0x5e0df4)[_0x17d349(0x197)]=await _0x367847['generateAsync']({'type':_0x17d349(0x1b4)});}}}}return _0x53dae8[_0x17d349(0x19b)](_0x38d3fd=>!_0x38d3fd[_0x17d349(0x197)])[_0x17d349(0x1dc)](_0x3a650b=>{const _0x537eb7=_0x17d349;this[_0x537eb7(0x1cb)]['log'](_0x537eb7(0x1ba)+_0x3a650b['veevaComponentType']+'.'+_0x3a650b[_0x537eb7(0x1d1)]+_0x537eb7(0x1c3));}),_0x53dae8[_0x17d349(0x19b)](_0x1cba48=>_0x1cba48['body']);}[a408_0x55d01b(0x1ea)](_0x10912f){const _0xe9e9e9=a408_0x55d01b,_0x2f0399=(0x0,sync_1[_0xe9e9e9(0x1d0)])(_0x10912f,{'columns':!![],'skip_empty_lines':!![]}),_0x5b4af7=_0x2f0399[_0xe9e9e9(0x1e3)](({'In\x20Package':_0x4baf2e,..._0x5318d1})=>_0x5318d1);return(0x0,sync_2[_0xe9e9e9(0x1c6)])(_0x5b4af7,{'header':!![]});}[a408_0x55d01b(0x1ed)](_0x38cb77){return _0x38cb77['map'](_0x275d38=>{const _0x1d3b7c=a408_0x2c5a,_0x3ed4b5=new metadata_item_dto_1[(_0x1d3b7c(0x1f6))]();return _0x3ed4b5[_0x1d3b7c(0x1d1)]=_0x275d38[_0x1d3b7c(0x1d1)],_0x3ed4b5['apiName']=_0x275d38['name'],_0x3ed4b5['snapshotId']=this[_0x1d3b7c(0x1a7)],_0x3ed4b5[_0x1d3b7c(0x1e4)]=_0x275d38['type']+'.'+_0x275d38[_0x1d3b7c(0x1d1)]+veeva_constants_1[_0x1d3b7c(0x1f8)][_0x1d3b7c(0x1ff)],_0x3ed4b5['veevaComponentType']=_0x275d38['type'],_0x3ed4b5[_0x1d3b7c(0x1e9)]=_0x275d38[_0x1d3b7c(0x1e9)],_0x3ed4b5['isRetrieved']=![],_0x3ed4b5;});}async[a408_0x55d01b(0x1f2)](_0x21b25f){const _0x4a3118=a408_0x55d01b;this[_0x4a3118(0x1cb)][_0x4a3118(0x1bd)]('Saving\x20Attachments.'),await this[_0x4a3118(0x19c)](_0x21b25f),this[_0x4a3118(0x1cb)][_0x4a3118(0x1bd)](_0x4a3118(0x1fd)+_0x21b25f[_0x4a3118(0x20d)]+'\x20Metadata\x20Items');const _0x3668a1=_0x21b25f['map'](_0x5509be=>{const _0x1025da=_0x4a3118;return{[constants_1[_0x1025da(0x1bc)]+_0x1025da(0x1e6)]:_0x5509be[_0x1025da(0x1d1)],[constants_1[_0x1025da(0x1bc)]+'API_Name__c']:_0x5509be[_0x1025da(0x1b8)],[constants_1[_0x1025da(0x1bc)]+_0x1025da(0x1bf)]:_0x5509be['snapshotId'],[constants_1[_0x1025da(0x1bc)]+_0x1025da(0x1cc)]:_0x5509be['label'],[constants_1[_0x1025da(0x1bc)]+_0x1025da(0x1e7)]:_0x5509be[_0x1025da(0x1f7)],[constants_1[_0x1025da(0x1bc)]+_0x1025da(0x1e1)]:_0x5509be[_0x1025da(0x1fb)],[constants_1[_0x1025da(0x1bc)]+_0x1025da(0x1a4)]:_0x5509be[_0x1025da(0x1db)],[constants_1[_0x1025da(0x1bc)]+'Last_Modified_Date__c']:_0x5509be[_0x1025da(0x1e9)]};}),_0x41a35e=await this[_0x4a3118(0x1d2)]['insertMultipleRecords'](constants_1['FLOSUM_NAMESPACE']+_0x4a3118(0x196),_0x3668a1);let _0x21a0a3=!![];_0x41a35e[_0x4a3118(0x1dc)]((_0x1e1b2f,_0x3d667b)=>{const _0x4010ba=_0x4a3118;this[_0x4010ba(0x1cb)][_0x4010ba(0x1bd)](_0x4010ba(0x1fd)+_0x21b25f[_0x3d667b][_0x4010ba(0x1fb)]+'.'+_0x21b25f[_0x3d667b][_0x4010ba(0x1d1)]);if(!_0x1e1b2f[_0x4010ba(0x1b2)]){_0x21a0a3=![];const _0x4e3ff7=new salesforce_dml_error_1[(_0x4010ba(0x1ee))](_0x1e1b2f[_0x4010ba(0x1a8)]);this[_0x4010ba(0x1cb)]['logError'](_0x4e3ff7);}});if(!_0x21a0a3)throw new Error(_0x4a3118(0x1ef));}async[a408_0x55d01b(0x19c)](_0x5352b0){const _0x17aea8=a408_0x55d01b,_0x44ffa7=this['formAttachments'](_0x5352b0),_0x486ec0=await this[_0x17aea8(0x1d2)]['insertMultipleRecords'](SnapshotService['ATTACHMENT'],_0x44ffa7),_0x5730ed=[];_0x486ec0[_0x17aea8(0x1dc)]((_0x2f4882,_0x149a8e)=>{const _0xcb85a4=_0x17aea8;_0x2f4882[_0xcb85a4(0x1b2)]?(_0x5352b0[_0x149a8e]['attachmentId']=_0x2f4882['id'],_0x5352b0[_0x149a8e]['isRetrieved']=!![]):_0x5730ed['push'](..._0x2f4882[_0xcb85a4(0x1a8)]);});if(_0x5730ed[_0x17aea8(0x20d)])throw new salesforce_dml_error_1[(_0x17aea8(0x1ee))](_0x5730ed);}['formAttachments'](_0x45b759){const _0x2030a0=a408_0x55d01b;return _0x45b759[_0x2030a0(0x1e3)](_0xb02433=>({'ParentId':this['_snapshotId'],'Name':_0xb02433['veevaComponentType'],'ContentType':_0x2030a0(0x1fa),'Body':_0xb02433[_0x2030a0(0x197)],'Description':_0xb02433[_0x2030a0(0x1fb)]}));}async[a408_0x55d01b(0x1ca)](_0x14b8bc){const _0x521072=a408_0x55d01b,_0x654f39={[constants_1[_0x521072(0x1bc)]+_0x521072(0x1b9)]:!![],[constants_1[_0x521072(0x1bc)]+_0x521072(0x194)]:!_0x14b8bc},_0x533f44={[constants_1['FLOSUM_NAMESPACE']+_0x521072(0x194)]:!_0x14b8bc,[constants_1['FLOSUM_NAMESPACE']+_0x521072(0x1b7)]:_0x14b8bc,[constants_1[_0x521072(0x1bc)]+_0x521072(0x1f5)]:_0x14b8bc?status_enums_1[_0x521072(0x204)]['COMPLETED']:status_enums_1[_0x521072(0x204)][_0x521072(0x1b0)],[constants_1[_0x521072(0x1bc)]+_0x521072(0x1be)]:!![]};await this['_connectionSalesforce'][_0x521072(0x1f0)](flosum_constants_1[_0x521072(0x1c7)][_0x521072(0x199)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x521072(0x1b6)+this[_0x521072(0x1a7)],_0x654f39),await this['_connectionSalesforce']['patch'](flosum_constants_1[_0x521072(0x1c7)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1['FLOSUM_NAMESPACE']+_0x521072(0x1f4)+this[_0x521072(0x1cd)],_0x533f44),this[_0x521072(0x1cb)]['log'](_0x521072(0x1a3)+(_0x14b8bc?_0x521072(0x1ce):_0x521072(0x20c))+'.'),await this[_0x521072(0x1cb)][_0x521072(0x195)]();}}function a408_0x2c5a(_0x317fe9,_0x55e2f4){const _0x160170=a408_0x1a2e();return a408_0x2c5a=function(_0x441676,_0x332b17){_0x441676=_0x441676-0x193;let _0x1a2ebc=_0x160170[_0x441676];return _0x1a2ebc;},a408_0x2c5a(_0x317fe9,_0x55e2f4);}exports['SnapshotService']=SnapshotService,SnapshotService[a408_0x55d01b(0x1ec)]=a408_0x55d01b(0x20b),SnapshotService[a408_0x55d01b(0x206)]='Attachment';