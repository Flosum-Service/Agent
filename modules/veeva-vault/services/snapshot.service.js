const a363_0x5a2d6e=a363_0x3a0f;(function(_0x2fcf28,_0x184ecb){const _0xd54620=a363_0x3a0f,_0xade1ff=_0x2fcf28();while(!![]){try{const _0x3f02a2=parseInt(_0xd54620(0xb5))/0x1+parseInt(_0xd54620(0xb6))/0x2+parseInt(_0xd54620(0xe0))/0x3+-parseInt(_0xd54620(0x9b))/0x4*(parseInt(_0xd54620(0x8f))/0x5)+parseInt(_0xd54620(0xa1))/0x6*(-parseInt(_0xd54620(0xde))/0x7)+-parseInt(_0xd54620(0xd7))/0x8+parseInt(_0xd54620(0x91))/0x9;if(_0x3f02a2===_0x184ecb)break;else _0xade1ff['push'](_0xade1ff['shift']());}catch(_0x212764){_0xade1ff['push'](_0xade1ff['shift']());}}}(a363_0x2078,0x2b683));const a363_0x598968=(function(){let _0x12e65a=!![];return function(_0x403176,_0x1a65d0){const _0x1c0911=_0x12e65a?function(){const _0x2b3126=a363_0x3a0f;if(_0x1a65d0){const _0xf949d1=_0x1a65d0[_0x2b3126(0x84)](_0x403176,arguments);return _0x1a65d0=null,_0xf949d1;}}:function(){};return _0x12e65a=![],_0x1c0911;};}()),a363_0x2d360b=a363_0x598968(this,function(){const _0x127782=a363_0x3a0f;return a363_0x2d360b[_0x127782(0xab)]()['search'](_0x127782(0x80))[_0x127782(0xab)]()[_0x127782(0xb1)](a363_0x2d360b)[_0x127782(0x92)]('(((.+)+)+)+$');});function a363_0x2078(){const _0x57ef28=['errors','get','generateAsync','_connectionSalesforce','__esModule','from','OUTBOUND_PACKAGE_NAME','../constants/veeva.constants','patch','isRetrieved','filter','metadataLogId','logError','error','success','(((.+)+)+)+$','catch','API_Name__c','FLOSUM_NAMESPACE','apply','name','Name__c','Snapshot__c','insertMultipleRecords','string','forEach','Saving\x20Attachments.','files','Is_Error__c','join','469550jLEHif','updateLog','6495849VpYSRM','search','EXCEPTION','with\x20error','SnapshotService','push','async','apiName','label','retrieve','8AlifvN','_logger','Metadata_Log__c/','reduce','defineProperty','Succeed__c','1345962UCZUAj','saveComponentsInSalesforce','_metadataLogId','saveAttachments','PackageExportService','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','_packageExportService','veevaComponentType','Label__c','Status__c','toString','../constants/flosum.constants','createMetadataItemListWithBody','length','file','type','constructor','./package-export.service','\x20Metadata\x20Items','parse','33840oBIEoB','69694VREbio','Snapshot__c/','Job_Completed__c','attachmentId','DEPENDENCY_EXTENSION','_veevaService','Saving\x20','successfully','Snapshot\x20started.','_attachmentLogId','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','_salesforceService','Cannot\x20Save\x20Metadata\x20Items','Last_Modified_Date__c','../classes/errors/salesforce-dml-error','Cannot\x20retrieve\x20','_systemLogger','Is_Completed__c','MetadataItemDto','lastModifiedDate','formMetadataItemDtoList','COMPLETED','default','_connectionVeeva','Attachment_ID__c','formAttachments','VeevaService','ATTACHMENT','__importDefault','../../../constants','selectedComponentMap','execute','_selectedMetaTypes','1979960BlKHxW','transformDependencyFile','TypeAndNameVeevaComponentRetriever','_timeZone','log','sep','retrieveVeevaComponents','7PwRhmd','snapshotId','140967SgRCIi','VeevaConstants','map','../classes/retrievers/veeva-components/type.veeva-component.retriever','ENDPOINT_UPSERT_RECORD','_selectedComponentMap','posix','FlosumConstants','path','attachmentLogId','_snapshotId','selectedMetaTypes','finishSnapshot','body','MetadataLogStatus'];a363_0x2078=function(){return _0x57ef28;};return a363_0x2078();}a363_0x2d360b();'use strict';function a363_0x3a0f(_0x5b2235,_0x92d55d){const _0x25bb92=a363_0x2078();return a363_0x3a0f=function(_0x2d360b,_0x598968){_0x2d360b=_0x2d360b-0x74;let _0x207843=_0x25bb92[_0x2d360b];return _0x207843;},a363_0x3a0f(_0x5b2235,_0x92d55d);}var __importDefault=this&&this[a363_0x5a2d6e(0xd2)]||function(_0x17550c){const _0xe3f936=a363_0x5a2d6e;return _0x17550c&&_0x17550c[_0xe3f936(0x75)]?_0x17550c:{'default':_0x17550c};};Object[a363_0x5a2d6e(0x9f)](exports,'__esModule',{'value':!![]}),exports['SnapshotService']=void 0x0;const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require(a363_0x5a2d6e(0xac)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a363_0x5a2d6e(0xd3)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a363_0x5a2d6e(0xc4)),package_export_service_1=require(a363_0x5a2d6e(0xb2)),type_and_name_veeva_component_retriever_1=require(a363_0x5a2d6e(0xc0)),type_veeva_component_retriever_1=require(a363_0x5a2d6e(0xe3)),sync_1=require('csv-parse/sync'),sync_2=require('csv-stringify/sync'),veeva_constants_1=require(a363_0x5a2d6e(0x78)),path_1=__importDefault(require(a363_0x5a2d6e(0xe8)));class SnapshotService{constructor(_0x2fbf40,_0x5a0544,_0x8c574a,_0x555df5){const _0x531189=a363_0x5a2d6e;this[_0x531189(0x74)]=_0x5a0544,this[_0x531189(0xcd)]=_0x8c574a,this[_0x531189(0x9c)]=_0x555df5,this[_0x531189(0xea)]=_0x2fbf40[_0x531189(0xdf)],this[_0x531189(0xa3)]=_0x2fbf40[_0x531189(0x7c)],this[_0x531189(0xbf)]=_0x2fbf40[_0x531189(0xe9)],this[_0x531189(0xda)]=_0x2fbf40['timeZone'],this['_selectedMetaTypes']=_0x2fbf40[_0x531189(0xeb)],this[_0x531189(0xe5)]=_0x2fbf40[_0x531189(0xd4)],this[_0x531189(0xbb)]=new veeva_service_1[(_0x531189(0xd0))]({'connection':this[_0x531189(0xcd)],'logger':this[_0x531189(0x9c)]}),this[_0x531189(0xc1)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x531189(0x74)]}),this[_0x531189(0xa7)]=new package_export_service_1[(_0x531189(0xa5))]({'veevaService':this[_0x531189(0xbb)],'connection':this[_0x531189(0xcd)],'logger':this[_0x531189(0x9c)]});}async[a363_0x5a2d6e(0xd5)](){const _0x5b5fed=a363_0x5a2d6e;try{this[_0x5b5fed(0x9c)][_0x5b5fed(0xdb)](_0x5b5fed(0xbe));const _0x337253=await this[_0x5b5fed(0xdd)]();await this[_0x5b5fed(0x9c)]['updateLog']();const _0x5cf9dd=await this[_0x5b5fed(0xa7)]['export'](_0x337253,SnapshotService[_0x5b5fed(0x77)]);await this[_0x5b5fed(0x9c)][_0x5b5fed(0x90)]();const _0x25cd69=await this[_0x5b5fed(0xad)](_0x337253,_0x5cf9dd);await this[_0x5b5fed(0xa2)](_0x25cd69),await this[_0x5b5fed(0x9c)][_0x5b5fed(0x90)](),await this[_0x5b5fed(0xec)](!![]);}catch(_0x4ad904){this['_logger'][_0x5b5fed(0x7d)](_0x4ad904),await this[_0x5b5fed(0xec)](![])[_0x5b5fed(0x81)](_0xeb3839=>this[_0x5b5fed(0xc6)][_0x5b5fed(0x7e)](_0xeb3839));}}async['retrieveVeevaComponents'](){const _0x144324=a363_0x5a2d6e,_0x11342c={'veevaService':this[_0x144324(0xbb)],'logger':this[_0x144324(0x9c)]},_0x414a25=Array[_0x144324(0x76)](Object['values'](this[_0x144324(0xe5)]))[_0x144324(0xae)]?new type_and_name_veeva_component_retriever_1[(_0x144324(0xd9))]({'value':this[_0x144324(0xe5)],..._0x11342c}):new type_veeva_component_retriever_1['TypeVeevaComponentRetriever']({'value':this[_0x144324(0xd6)],..._0x11342c});return _0x414a25[_0x144324(0x9a)]();}async[a363_0x5a2d6e(0xad)](_0x4e20c5,_0x51087a){const _0x331f39=a363_0x5a2d6e;var _0x15cb17,_0xf0c58;this[_0x331f39(0x9c)][_0x331f39(0xdb)](_0x331f39(0xa6));const _0x4159a2=this[_0x331f39(0xca)](_0x4e20c5),_0x235952=_0x4159a2[_0x331f39(0x9e)]((_0x467662,_0x3e9c91)=>_0x467662['set'](_0x3e9c91[_0x331f39(0x99)],_0x3e9c91),new Map());for(const _0x4e5286 of _0x51087a){for(const _0x11ff6f in _0x4e5286[_0x331f39(0x8c)]){const {base:_0x24923a,name:_0x1b1d15,dir:_0x233f43}=path_1[_0x331f39(0xcc)][_0x331f39(0xb4)](_0x11ff6f),_0x596b65=_0x1b1d15+veeva_constants_1[_0x331f39(0xe1)][_0x331f39(0xba)];if(_0x235952['has'](_0x24923a)){const _0x5962fd=await((_0x15cb17=_0x4e5286[_0x331f39(0xaf)]([_0x233f43,_0x24923a][_0x331f39(0x8e)](path_1[_0x331f39(0xcc)][_0x331f39(0xe6)][_0x331f39(0xdc)])))===null||_0x15cb17===void 0x0?void 0x0:_0x15cb17['async'](_0x331f39(0x89))),_0x888fea=await((_0xf0c58=_0x4e5286['file']([_0x233f43,_0x596b65]['join'](path_1[_0x331f39(0xcc)]['posix'][_0x331f39(0xdc)])))===null||_0xf0c58===void 0x0?void 0x0:_0xf0c58[_0x331f39(0x97)]('string'));if(_0x5962fd){const _0x4dfee9=new jszip_1['default']();_0x4dfee9['file'](_0x24923a,_0x5962fd),_0x888fea&&_0x4dfee9[_0x331f39(0xaf)](_0x596b65,this[_0x331f39(0xd8)](_0x888fea)),_0x235952[_0x331f39(0xf0)](_0x24923a)['body']=await _0x4dfee9[_0x331f39(0xf1)]({'type':'base64'});}}}}return _0x4159a2[_0x331f39(0x7b)](_0x39508f=>!_0x39508f[_0x331f39(0xed)])[_0x331f39(0x8a)](_0x5ebd09=>{const _0x4875c6=_0x331f39;this[_0x4875c6(0x9c)][_0x4875c6(0xdb)](_0x4875c6(0xc5)+_0x5ebd09[_0x4875c6(0xa8)]+'.'+_0x5ebd09[_0x4875c6(0x85)]+'\x20from\x20outbound\x20package');}),_0x4159a2[_0x331f39(0x7b)](_0x391bdf=>_0x391bdf[_0x331f39(0xed)]);}['transformDependencyFile'](_0x408cea){const _0x532c94=a363_0x5a2d6e,_0x4c1e40=(0x0,sync_1['parse'])(_0x408cea,{'columns':!![],'skip_empty_lines':!![]}),_0x29af93=_0x4c1e40[_0x532c94(0xe2)](({'In\x20Package':_0x44b0c4,..._0x3c1f65})=>_0x3c1f65);return(0x0,sync_2['stringify'])(_0x29af93,{'header':!![]});}[a363_0x5a2d6e(0xca)](_0x53a70c){return _0x53a70c['map'](_0x24948a=>{const _0x488ea6=a363_0x3a0f,_0x3c415b=new metadata_item_dto_1[(_0x488ea6(0xc8))]();return _0x3c415b['name']=_0x24948a['name'],_0x3c415b[_0x488ea6(0x98)]=_0x24948a[_0x488ea6(0x85)],_0x3c415b[_0x488ea6(0xdf)]=this[_0x488ea6(0xea)],_0x3c415b['label']=_0x24948a[_0x488ea6(0xb0)]+'.'+_0x24948a[_0x488ea6(0x85)]+veeva_constants_1[_0x488ea6(0xe1)]['MDL_EXTENSION'],_0x3c415b[_0x488ea6(0xa8)]=_0x24948a['type'],_0x3c415b['lastModifiedDate']=_0x24948a['lastModifiedDate'],_0x3c415b[_0x488ea6(0x7a)]=![],_0x3c415b;});}async[a363_0x5a2d6e(0xa2)](_0x2d35c4){const _0x4d8474=a363_0x5a2d6e;this[_0x4d8474(0x9c)][_0x4d8474(0xdb)](_0x4d8474(0x8b)),await this[_0x4d8474(0xa4)](_0x2d35c4),this[_0x4d8474(0x9c)][_0x4d8474(0xdb)](_0x4d8474(0xbc)+_0x2d35c4[_0x4d8474(0xae)]+_0x4d8474(0xb3));const _0x3dad9b=_0x2d35c4['map'](_0x26db98=>{const _0x5a8747=_0x4d8474;return{[constants_1[_0x5a8747(0x83)]+_0x5a8747(0x86)]:_0x26db98[_0x5a8747(0x85)],[constants_1[_0x5a8747(0x83)]+_0x5a8747(0x82)]:_0x26db98['apiName'],[constants_1['FLOSUM_NAMESPACE']+_0x5a8747(0x87)]:_0x26db98[_0x5a8747(0xdf)],[constants_1['FLOSUM_NAMESPACE']+_0x5a8747(0xa9)]:_0x26db98['label'],[constants_1[_0x5a8747(0x83)]+'Is_Retrieved__c']:_0x26db98[_0x5a8747(0x7a)],[constants_1['FLOSUM_NAMESPACE']+'Veeva_Component_Type__c']:_0x26db98[_0x5a8747(0xa8)],[constants_1[_0x5a8747(0x83)]+_0x5a8747(0xce)]:_0x26db98[_0x5a8747(0xb9)],[constants_1['FLOSUM_NAMESPACE']+_0x5a8747(0xc3)]:_0x26db98[_0x5a8747(0xc9)]};}),_0x40482f=await this[_0x4d8474(0xc1)][_0x4d8474(0x88)](constants_1[_0x4d8474(0x83)]+'Metadata_Item__c',_0x3dad9b);let _0x4ed563=!![];_0x40482f[_0x4d8474(0x8a)]((_0x188887,_0x539944)=>{const _0x2ce5de=_0x4d8474;this['_logger'][_0x2ce5de(0xdb)](_0x2ce5de(0xbc)+_0x2d35c4[_0x539944][_0x2ce5de(0xa8)]+'.'+_0x2d35c4[_0x539944][_0x2ce5de(0x85)]);if(!_0x188887[_0x2ce5de(0x7f)]){_0x4ed563=![];const _0xcf1e4d=new salesforce_dml_error_1['SalesforceDmlError'](_0x188887[_0x2ce5de(0xef)]);this[_0x2ce5de(0x9c)]['logError'](_0xcf1e4d);}});if(!_0x4ed563)throw new Error(_0x4d8474(0xc2));}async[a363_0x5a2d6e(0xa4)](_0x3c3579){const _0x3c0f1a=a363_0x5a2d6e,_0x1eee93=this[_0x3c0f1a(0xcf)](_0x3c3579),_0x580e20=await this['_salesforceService'][_0x3c0f1a(0x88)](SnapshotService[_0x3c0f1a(0xd1)],_0x1eee93),_0x1ce5bb=[];_0x580e20[_0x3c0f1a(0x8a)]((_0x44516e,_0x495828)=>{const _0x402efe=_0x3c0f1a;_0x44516e['success']?(_0x3c3579[_0x495828]['attachmentId']=_0x44516e['id'],_0x3c3579[_0x495828]['isRetrieved']=!![]):_0x1ce5bb[_0x402efe(0x96)](..._0x44516e[_0x402efe(0xef)]);});if(_0x1ce5bb[_0x3c0f1a(0xae)])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x1ce5bb);}[a363_0x5a2d6e(0xcf)](_0x5a4e21){const _0x136bd6=a363_0x5a2d6e;return _0x5a4e21[_0x136bd6(0xe2)](_0xa21e6f=>({'ParentId':this[_0x136bd6(0xea)],'Name':_0xa21e6f[_0x136bd6(0xa8)],'ContentType':'application/zip','Body':_0xa21e6f[_0x136bd6(0xed)],'Description':_0xa21e6f['veevaComponentType']}));}async['finishSnapshot'](_0x37059b){const _0x49f8d8=a363_0x5a2d6e,_0x4d66b7={[constants_1[_0x49f8d8(0x83)]+_0x49f8d8(0xc7)]:!![],[constants_1[_0x49f8d8(0x83)]+_0x49f8d8(0x8d)]:!_0x37059b},_0x409f2a={[constants_1[_0x49f8d8(0x83)]+_0x49f8d8(0x8d)]:!_0x37059b,[constants_1[_0x49f8d8(0x83)]+_0x49f8d8(0xa0)]:_0x37059b,[constants_1[_0x49f8d8(0x83)]+_0x49f8d8(0xaa)]:_0x37059b?status_enums_1[_0x49f8d8(0xee)][_0x49f8d8(0xcb)]:status_enums_1['MetadataLogStatus'][_0x49f8d8(0x93)],[constants_1[_0x49f8d8(0x83)]+_0x49f8d8(0xb8)]:!![]};await this['_connectionSalesforce'][_0x49f8d8(0x79)](flosum_constants_1[_0x49f8d8(0xe7)][_0x49f8d8(0xe4)]+'/'+constants_1[_0x49f8d8(0x83)]+_0x49f8d8(0xb7)+this[_0x49f8d8(0xea)],_0x4d66b7),await this[_0x49f8d8(0x74)][_0x49f8d8(0x79)](flosum_constants_1[_0x49f8d8(0xe7)][_0x49f8d8(0xe4)]+'/'+constants_1[_0x49f8d8(0x83)]+_0x49f8d8(0x9d)+this[_0x49f8d8(0xa3)],_0x409f2a),this[_0x49f8d8(0x9c)][_0x49f8d8(0xdb)]('Snapshot\x20completed\x20'+(_0x37059b?_0x49f8d8(0xbd):_0x49f8d8(0x94))+'.'),await this['_logger']['updateLog']();}}exports[a363_0x5a2d6e(0x95)]=SnapshotService,SnapshotService[a363_0x5a2d6e(0x77)]='Snapshot',SnapshotService[a363_0x5a2d6e(0xd1)]='Attachment';