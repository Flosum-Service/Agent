const a362_0x4c0517=a362_0x481d;(function(_0x569907,_0x390c88){const _0x2f111e=a362_0x481d,_0xae0304=_0x569907();while(!![]){try{const _0x519973=parseInt(_0x2f111e(0x138))/0x1+parseInt(_0x2f111e(0x10b))/0x2*(parseInt(_0x2f111e(0x132))/0x3)+-parseInt(_0x2f111e(0x11c))/0x4*(parseInt(_0x2f111e(0x110))/0x5)+-parseInt(_0x2f111e(0x12e))/0x6*(-parseInt(_0x2f111e(0xde))/0x7)+-parseInt(_0x2f111e(0xca))/0x8+parseInt(_0x2f111e(0x13d))/0x9*(parseInt(_0x2f111e(0xce))/0xa)+-parseInt(_0x2f111e(0xf4))/0xb*(-parseInt(_0x2f111e(0xf9))/0xc);if(_0x519973===_0x390c88)break;else _0xae0304['push'](_0xae0304['shift']());}catch(_0x2a48d1){_0xae0304['push'](_0xae0304['shift']());}}}(a362_0x2583,0xcb2c5));const a362_0x21869c=(function(){let _0x881dc1=!![];return function(_0x5afa13,_0x4321d4){const _0x4d004a=_0x881dc1?function(){const _0x456654=a362_0x481d;if(_0x4321d4){const _0x5eb8f5=_0x4321d4[_0x456654(0xfc)](_0x5afa13,arguments);return _0x4321d4=null,_0x5eb8f5;}}:function(){};return _0x881dc1=![],_0x4d004a;};}()),a362_0x2005fd=a362_0x21869c(this,function(){const _0x593e80=a362_0x481d;return a362_0x2005fd['toString']()[_0x593e80(0x103)](_0x593e80(0x12f))[_0x593e80(0xd8)]()[_0x593e80(0x140)](a362_0x2005fd)[_0x593e80(0x103)](_0x593e80(0x12f));});a362_0x2005fd();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5dec26){return _0x5dec26&&_0x5dec26['__esModule']?_0x5dec26:{'default':_0x5dec26};};Object[a362_0x4c0517(0x11f)](exports,a362_0x4c0517(0xe5),{'value':!![]}),exports[a362_0x4c0517(0x12b)]=void 0x0;const jszip_1=__importDefault(require(a362_0x4c0517(0x144))),flosum_constants_1=require(a362_0x4c0517(0xe9)),veeva_service_1=require(a362_0x4c0517(0x125)),metadata_item_dto_1=require(a362_0x4c0517(0x13b)),constants_1=require('../../../constants'),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a362_0x4c0517(0xeb)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require(a362_0x4c0517(0xe6)),type_and_name_veeva_component_retriever_1=require(a362_0x4c0517(0x147)),type_veeva_component_retriever_1=require(a362_0x4c0517(0x135)),sync_1=require(a362_0x4c0517(0xe4)),sync_2=require('csv-stringify/sync'),veeva_constants_1=require(a362_0x4c0517(0xd0)),path_1=__importDefault(require(a362_0x4c0517(0x139)));function a362_0x481d(_0xb35788,_0x5956a9){const _0x2a3518=a362_0x2583();return a362_0x481d=function(_0x2005fd,_0x21869c){_0x2005fd=_0x2005fd-0xca;let _0x258395=_0x2a3518[_0x2005fd];return _0x258395;},a362_0x481d(_0xb35788,_0x5956a9);}class SnapshotService{constructor(_0x451ba6,_0x1f0e12,_0x3190cb,_0x2faa99){const _0x255fb1=a362_0x4c0517;this[_0x255fb1(0x130)]=_0x1f0e12,this['_connectionVeeva']=_0x3190cb,this[_0x255fb1(0x126)]=_0x2faa99,this[_0x255fb1(0x10c)]=_0x451ba6['snapshotId'],this[_0x255fb1(0x129)]=_0x451ba6[_0x255fb1(0x117)],this[_0x255fb1(0x13c)]=_0x451ba6[_0x255fb1(0x143)],this['_timeZone']=_0x451ba6[_0x255fb1(0x127)],this[_0x255fb1(0xf2)]=_0x451ba6[_0x255fb1(0x104)],this[_0x255fb1(0x13f)]=_0x451ba6['selectedComponentMap'],this[_0x255fb1(0x131)]=new veeva_service_1['VeevaService']({'connection':this[_0x255fb1(0xea)],'logger':this[_0x255fb1(0x126)]}),this[_0x255fb1(0x115)]=new salesforce_service_1[(_0x255fb1(0x10d))]({'connection':this[_0x255fb1(0x130)]}),this[_0x255fb1(0xec)]=new package_export_service_1[(_0x255fb1(0xd1))]({'veevaService':this[_0x255fb1(0x131)],'connection':this[_0x255fb1(0xea)],'logger':this['_logger']});}async[a362_0x4c0517(0x11b)](){const _0xdc3e9b=a362_0x4c0517;try{this[_0xdc3e9b(0x126)][_0xdc3e9b(0x100)](_0xdc3e9b(0x13a));const _0x122cb5=await this[_0xdc3e9b(0xcc)]();await this[_0xdc3e9b(0x126)][_0xdc3e9b(0x106)]();const _0x22deb4=await this[_0xdc3e9b(0xec)][_0xdc3e9b(0x145)](_0x122cb5,SnapshotService[_0xdc3e9b(0xee)]);await this[_0xdc3e9b(0x126)]['updateLog']();const _0x90eadc=await this['createMetadataItemListWithBody'](_0x122cb5,_0x22deb4);await this[_0xdc3e9b(0x10f)](_0x90eadc),await this[_0xdc3e9b(0x126)][_0xdc3e9b(0x106)](),await this[_0xdc3e9b(0x116)](!![]);}catch(_0x4f5737){this[_0xdc3e9b(0x126)][_0xdc3e9b(0x107)](_0x4f5737),await this[_0xdc3e9b(0x116)](![])['catch'](_0x2ed178=>this['_systemLogger'][_0xdc3e9b(0x111)](_0x2ed178));}}async[a362_0x4c0517(0xcc)](){const _0x2e4d73=a362_0x4c0517,_0x5b4c53={'veevaService':this[_0x2e4d73(0x131)],'logger':this[_0x2e4d73(0x126)]},_0x2a353d=Array['from'](Object[_0x2e4d73(0xed)](this[_0x2e4d73(0x13f)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x2e4d73(0x124))]({'value':this[_0x2e4d73(0x13f)],..._0x5b4c53}):new type_veeva_component_retriever_1['TypeVeevaComponentRetriever']({'value':this[_0x2e4d73(0xf2)],..._0x5b4c53});return _0x2a353d['retrieve']();}async['createMetadataItemListWithBody'](_0x4cd08e,_0x42a1a8){const _0x246fe1=a362_0x4c0517;var _0x5aa5c9,_0x13ff4b;this['_logger'][_0x246fe1(0x100)]('Unpack\x20zip\x20and\x20create\x20metadata\x20items.');const _0xf241d5=this[_0x246fe1(0x142)](_0x4cd08e),_0x447246=_0xf241d5['reduce']((_0x142873,_0x7fcb27)=>_0x142873[_0x246fe1(0xfe)](_0x7fcb27['label'],_0x7fcb27),new Map());for(const _0x2ba641 of _0x42a1a8){for(const _0x333f5d in _0x2ba641[_0x246fe1(0x105)]){const {base:_0x406748,name:_0x429773,dir:_0x4435b}=path_1['default'][_0x246fe1(0xcf)](_0x333f5d),_0x1a37ef=_0x429773+veeva_constants_1[_0x246fe1(0xe8)][_0x246fe1(0x109)];if(_0x447246[_0x246fe1(0xd5)](_0x406748)){const _0x35c462=await((_0x5aa5c9=_0x2ba641[_0x246fe1(0xd2)](path_1[_0x246fe1(0x114)][_0x246fe1(0x120)](_0x4435b,_0x406748)))===null||_0x5aa5c9===void 0x0?void 0x0:_0x5aa5c9[_0x246fe1(0x128)](_0x246fe1(0xe1))),_0x36259b=await((_0x13ff4b=_0x2ba641['file'](path_1['default'][_0x246fe1(0x120)](_0x4435b,_0x1a37ef)))===null||_0x13ff4b===void 0x0?void 0x0:_0x13ff4b['async']('string'));if(_0x35c462&&_0x36259b){const _0x389fc4=new jszip_1[(_0x246fe1(0x114))]();_0x389fc4[_0x246fe1(0xd2)](_0x406748,_0x35c462),_0x389fc4[_0x246fe1(0xd2)](_0x1a37ef,this['transformDependencyFile'](_0x36259b)),_0x447246[_0x246fe1(0xd7)](_0x406748)[_0x246fe1(0x112)]=await _0x389fc4[_0x246fe1(0xd6)]({'type':'base64'});}}}}return _0xf241d5[_0x246fe1(0xe7)](_0x202384=>!_0x202384[_0x246fe1(0x112)])[_0x246fe1(0xf8)](_0x5cc902=>{const _0xcb369=_0x246fe1;this[_0xcb369(0x126)][_0xcb369(0x100)](_0xcb369(0xfd)+_0x5cc902[_0xcb369(0xda)]+'.'+_0x5cc902[_0xcb369(0xdd)]+_0xcb369(0x122));}),_0xf241d5[_0x246fe1(0xe7)](_0x570944=>_0x570944[_0x246fe1(0x112)]);}[a362_0x4c0517(0xdc)](_0x22a3e4){const _0x3aba9d=a362_0x4c0517,_0x3d148e=(0x0,sync_1[_0x3aba9d(0xcf)])(_0x22a3e4,{'columns':!![],'skip_empty_lines':!![]}),_0x583c7f=_0x3d148e['map'](({'In\x20Package':_0x22191c,..._0x425608})=>_0x425608);return(0x0,sync_2['stringify'])(_0x583c7f,{'header':!![]});}['formMetadataItemDtoList'](_0x449823){const _0x2917f3=a362_0x4c0517;return _0x449823[_0x2917f3(0x10e)](_0x53c6b8=>{const _0x589519=_0x2917f3,_0x2b7df0=new metadata_item_dto_1[(_0x589519(0x146))]();return _0x2b7df0[_0x589519(0xdd)]=_0x53c6b8['name'],_0x2b7df0['apiName']=_0x53c6b8[_0x589519(0xdd)],_0x2b7df0[_0x589519(0xdb)]=this['_snapshotId'],_0x2b7df0['label']=_0x53c6b8[_0x589519(0xe0)]+'.'+_0x53c6b8[_0x589519(0xdd)]+veeva_constants_1[_0x589519(0xe8)][_0x589519(0xd9)],_0x2b7df0[_0x589519(0xda)]=_0x53c6b8[_0x589519(0xe0)],_0x2b7df0[_0x589519(0xfa)]=_0x53c6b8[_0x589519(0xfa)],_0x2b7df0[_0x589519(0xf3)]=![],_0x2b7df0;});}async[a362_0x4c0517(0x10f)](_0x25a2a7){const _0x56e368=a362_0x4c0517;this[_0x56e368(0x126)]['log'](_0x56e368(0xdf)),await this[_0x56e368(0xf1)](_0x25a2a7),this['_logger'][_0x56e368(0x100)]('Saving\x20'+_0x25a2a7[_0x56e368(0xcd)]+_0x56e368(0x141));const _0xe5c7ae=_0x25a2a7[_0x56e368(0x10e)](_0x35d4ea=>{const _0x3b3721=_0x56e368;return{[constants_1[_0x3b3721(0x118)]+_0x3b3721(0x12d)]:_0x35d4ea['name'],[constants_1['FLOSUM_NAMESPACE']+'API_Name__c']:_0x35d4ea[_0x3b3721(0xd4)],[constants_1[_0x3b3721(0x118)]+'Snapshot__c']:_0x35d4ea[_0x3b3721(0xdb)],[constants_1['FLOSUM_NAMESPACE']+_0x3b3721(0xef)]:_0x35d4ea[_0x3b3721(0xe3)],[constants_1[_0x3b3721(0x118)]+_0x3b3721(0x11e)]:_0x35d4ea[_0x3b3721(0xf3)],[constants_1[_0x3b3721(0x118)]+_0x3b3721(0x12a)]:_0x35d4ea[_0x3b3721(0xda)],[constants_1[_0x3b3721(0x118)]+_0x3b3721(0x113)]:_0x35d4ea[_0x3b3721(0xf0)],[constants_1[_0x3b3721(0x118)]+_0x3b3721(0x137)]:_0x35d4ea['lastModifiedDate']};}),_0x46ef20=await this[_0x56e368(0x115)]['insertMultipleRecords'](constants_1[_0x56e368(0x118)]+_0x56e368(0x13e),_0xe5c7ae);let _0xbb6319=!![];_0x46ef20[_0x56e368(0xf8)]((_0x5b3a0f,_0xb5147)=>{const _0x2383ec=_0x56e368;this['_logger']['log']('Saving\x20'+_0x25a2a7[_0xb5147][_0x2383ec(0xda)]+'.'+_0x25a2a7[_0xb5147]['name']);if(!_0x5b3a0f[_0x2383ec(0x136)]){_0xbb6319=![];const _0x34a483=new salesforce_dml_error_1[(_0x2383ec(0xe2))](_0x5b3a0f['errors']);this[_0x2383ec(0x126)]['logError'](_0x34a483);}});if(!_0xbb6319)throw new Error(_0x56e368(0x133));}async[a362_0x4c0517(0xf1)](_0xfa9af1){const _0x238df9=a362_0x4c0517,_0x4c322e=this[_0x238df9(0x12c)](_0xfa9af1),_0x321a1e=await this[_0x238df9(0x115)][_0x238df9(0xfb)](SnapshotService[_0x238df9(0x11a)],_0x4c322e),_0x42838c=[];_0x321a1e[_0x238df9(0xf8)]((_0x3ae6d0,_0x5e41cd)=>{const _0xb07397=_0x238df9;_0x3ae6d0[_0xb07397(0x136)]?(_0xfa9af1[_0x5e41cd][_0xb07397(0xf0)]=_0x3ae6d0['id'],_0xfa9af1[_0x5e41cd][_0xb07397(0xf3)]=!![]):_0x42838c[_0xb07397(0x102)](..._0x3ae6d0[_0xb07397(0x101)]);});if(_0x42838c['length'])throw new salesforce_dml_error_1[(_0x238df9(0xe2))](_0x42838c);}['formAttachments'](_0x425ae5){const _0x4800df=a362_0x4c0517;return _0x425ae5[_0x4800df(0x10e)](_0x2d466c=>({'ParentId':this[_0x4800df(0x10c)],'Name':_0x2d466c[_0x4800df(0xda)],'ContentType':_0x4800df(0xf7),'Body':_0x2d466c['body'],'Description':_0x2d466c['veevaComponentType']}));}async['finishSnapshot'](_0x3b9d89){const _0x53c7a7=a362_0x4c0517,_0x399449={[constants_1[_0x53c7a7(0x118)]+_0x53c7a7(0x11d)]:!![],[constants_1[_0x53c7a7(0x118)]+_0x53c7a7(0x119)]:!_0x3b9d89},_0x184558={[constants_1[_0x53c7a7(0x118)]+_0x53c7a7(0x119)]:!_0x3b9d89,[constants_1[_0x53c7a7(0x118)]+_0x53c7a7(0x121)]:_0x3b9d89,[constants_1[_0x53c7a7(0x118)]+'Status__c']:_0x3b9d89?status_enums_1[_0x53c7a7(0x123)]['COMPLETED']:status_enums_1[_0x53c7a7(0x123)]['EXCEPTION'],[constants_1['FLOSUM_NAMESPACE']+'Job_Completed__c']:!![]};await this[_0x53c7a7(0x130)][_0x53c7a7(0xd3)](flosum_constants_1[_0x53c7a7(0xf5)][_0x53c7a7(0xcb)]+'/'+constants_1[_0x53c7a7(0x118)]+_0x53c7a7(0x10a)+this['_snapshotId'],_0x399449),await this['_connectionSalesforce']['patch'](flosum_constants_1['FlosumConstants'][_0x53c7a7(0xcb)]+'/'+constants_1[_0x53c7a7(0x118)]+_0x53c7a7(0x134)+this[_0x53c7a7(0x129)],_0x184558),this['_logger']['log']('Snapshot\x20completed\x20'+(_0x3b9d89?'successfully':_0x53c7a7(0x108))+'.'),await this['_logger']['updateLog']();}}function a362_0x2583(){const _0x1f36ec=['5553816kyIxdc','ENDPOINT_UPSERT_RECORD','retrieveVeevaComponents','length','60650moCWPn','parse','../constants/veeva.constants','PackageExportService','file','patch','apiName','has','generateAsync','get','toString','MDL_EXTENSION','veevaComponentType','snapshotId','transformDependencyFile','name','35sMcsUi','Saving\x20Attachments.','type','string','SalesforceDmlError','label','csv-parse/sync','__esModule','./package-export.service','filter','VeevaConstants','../constants/flosum.constants','_connectionVeeva','../enums/status.enums','_packageExportService','values','OUTBOUND_PACKAGE_NAME','Label__c','attachmentId','saveAttachments','_selectedMetaTypes','isRetrieved','22UoTmnD','FlosumConstants','Snapshot','application/zip','forEach','1137372NFiZNe','lastModifiedDate','insertMultipleRecords','apply','Cannot\x20retrieve\x20','set','Attachment','log','errors','push','search','selectedMetaTypes','files','updateLog','logError','with\x20error','DEPENDENCY_EXTENSION','Snapshot__c/','210bgjXYv','_snapshotId','SalesforceService','map','saveComponentsInSalesforce','20eKzcpU','error','body','Attachment_ID__c','default','_salesforceService','finishSnapshot','metadataLogId','FLOSUM_NAMESPACE','Is_Error__c','ATTACHMENT','execute','1164932bZiDzS','Is_Completed__c','Is_Retrieved__c','defineProperty','join','Succeed__c','\x20from\x20outbound\x20package','MetadataLogStatus','TypeAndNameVeevaComponentRetriever','./veeva.service','_logger','timeZone','async','_metadataLogId','Veeva_Component_Type__c','SnapshotService','formAttachments','Name__c','1543200XEnlCV','(((.+)+)+)+$','_connectionSalesforce','_veevaService','19929CTZTRx','Cannot\x20Save\x20Metadata\x20Items','Metadata_Log__c/','../classes/retrievers/veeva-components/type.veeva-component.retriever','success','Last_Modified_Date__c','427304XxqMax','path','Snapshot\x20started.','../dtos/metadata-item.dto','_attachmentLogId','135whztfw','Metadata_Item__c','_selectedComponentMap','constructor','\x20Metadata\x20Items','formMetadataItemDtoList','attachmentLogId','jszip','export','MetadataItemDto','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever'];a362_0x2583=function(){return _0x1f36ec;};return a362_0x2583();}exports['SnapshotService']=SnapshotService,SnapshotService[a362_0x4c0517(0xee)]=a362_0x4c0517(0xf6),SnapshotService[a362_0x4c0517(0x11a)]=a362_0x4c0517(0xff);