const a379_0x3ca8b3=a379_0x1e76;function a379_0x1e76(_0x3a73f2,_0x3d4003){const _0x3b152e=a379_0x41be();return a379_0x1e76=function(_0x2af5a2,_0x2a87ee){_0x2af5a2=_0x2af5a2-0x15c;let _0x41be0b=_0x3b152e[_0x2af5a2];return _0x41be0b;},a379_0x1e76(_0x3a73f2,_0x3d4003);}(function(_0x12d644,_0xa01876){const _0x3f4cbd=a379_0x1e76,_0xde3ad8=_0x12d644();while(!![]){try{const _0x50b54b=parseInt(_0x3f4cbd(0x1b2))/0x1+parseInt(_0x3f4cbd(0x186))/0x2*(-parseInt(_0x3f4cbd(0x1b6))/0x3)+-parseInt(_0x3f4cbd(0x17c))/0x4+-parseInt(_0x3f4cbd(0x1a9))/0x5+parseInt(_0x3f4cbd(0x197))/0x6*(parseInt(_0x3f4cbd(0x190))/0x7)+parseInt(_0x3f4cbd(0x1c2))/0x8*(-parseInt(_0x3f4cbd(0x18c))/0x9)+parseInt(_0x3f4cbd(0x1c1))/0xa;if(_0x50b54b===_0xa01876)break;else _0xde3ad8['push'](_0xde3ad8['shift']());}catch(_0xc5e4e2){_0xde3ad8['push'](_0xde3ad8['shift']());}}}(a379_0x41be,0x7e2d4));const a379_0x2a87ee=(function(){let _0x328899=!![];return function(_0x3daa58,_0x4b6acc){const _0x4c85ab=_0x328899?function(){const _0x2687f3=a379_0x1e76;if(_0x4b6acc){const _0x16783a=_0x4b6acc[_0x2687f3(0x1b3)](_0x3daa58,arguments);return _0x4b6acc=null,_0x16783a;}}:function(){};return _0x328899=![],_0x4c85ab;};}()),a379_0x2af5a2=a379_0x2a87ee(this,function(){const _0x1a1f1a=a379_0x1e76;return a379_0x2af5a2['toString']()[_0x1a1f1a(0x164)](_0x1a1f1a(0x16e))[_0x1a1f1a(0x1d2)]()[_0x1a1f1a(0x1a0)](a379_0x2af5a2)[_0x1a1f1a(0x164)]('(((.+)+)+)+$');});a379_0x2af5a2();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x545c8f){const _0x15e6d6=a379_0x1e76;return _0x545c8f&&_0x545c8f[_0x15e6d6(0x1bf)]?_0x545c8f:{'default':_0x545c8f};};Object[a379_0x3ca8b3(0x19b)](exports,a379_0x3ca8b3(0x1bf),{'value':!![]}),exports['SnapshotService']=void 0x0;const jszip_1=__importDefault(require(a379_0x3ca8b3(0x17f))),flosum_constants_1=require(a379_0x3ca8b3(0x19c)),veeva_service_1=require(a379_0x3ca8b3(0x1cb)),metadata_item_dto_1=require(a379_0x3ca8b3(0x18a)),constants_1=require(a379_0x3ca8b3(0x1b5)),salesforce_service_1=require(a379_0x3ca8b3(0x176)),status_enums_1=require(a379_0x3ca8b3(0x183)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require('./package-export.service'),type_and_name_veeva_component_retriever_1=require(a379_0x3ca8b3(0x179)),type_veeva_component_retriever_1=require(a379_0x3ca8b3(0x17a)),sync_1=require(a379_0x3ca8b3(0x171)),sync_2=require(a379_0x3ca8b3(0x15f)),veeva_constants_1=require(a379_0x3ca8b3(0x1ad)),path_1=__importDefault(require(a379_0x3ca8b3(0x192)));function a379_0x41be(){const _0xdba227=['toString','Attachment_ID__c','default','PackageExportService','Status__c','errors','body','with\x20error','ATTACHMENT','successfully','error','Snapshot__c/','csv-stringify/sync','Snapshot\x20started.','reduce','COMPLETED','files','search','Is_Error__c','Is_Completed__c','Saving\x20','SalesforceDmlError','formMetadataItemDtoList','Is_Retrieved__c','TypeVeevaComponentRetriever','catch','lastModifiedDate','(((.+)+)+)+$','TypeAndNameVeevaComponentRetriever','_connectionVeeva','csv-parse/sync','attachmentId','\x20from\x20outbound\x20package','forEach','sep','./salesforce.service','apiName','_whereClause','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','../classes/retrievers/veeva-components/type.veeva-component.retriever','posix','1924372KrFFgJ','FLOSUM_NAMESPACE','_selectedComponentMap','jszip','logError','isRetrieved','async','../enums/status.enums','Cannot\x20Save\x20Metadata\x20Items','_systemLogger','232328DyntCh','join','get','has','../dtos/metadata-item.dto','parse','4415904wGKDWK','_salesforceService','_packageExportService','filter','23051TbKtkC','insertMultipleRecords','path','patch','finishSnapshot','string','Metadata_Log__c/','666fKeVUy','retrieveVeevaComponents','map','length','defineProperty','../constants/flosum.constants','Veeva_Component_Type__c','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','name','constructor','log','export','Saving\x20Attachments.','Metadata_Item__c','_metadataLogId','transformDependencyFile','Attachment','OUTBOUND_PACKAGE_NAME','265595slSdOc','Succeed__c','_snapshotId','VeevaConstants','../constants/veeva.constants','file','application/zip','saveComponentsInSalesforce','Snapshot\x20completed\x20','759094NsijHN','apply','_connectionSalesforce','../../../constants','18mAazif','Name__c','stringify','Job_Completed__c','_logger','createMetadataItemListWithBody','updateLog','success','DEPENDENCY_EXTENSION','__esModule','Label__c','16047110UuzqQG','16PRBjpm','base64','type','ENDPOINT_UPSERT_RECORD','label','EXCEPTION','execute','veevaComponentType','_veevaService','./veeva.service','_selectedMetaTypes','FlosumConstants','saveAttachments','formAttachments','Snapshot','MetadataLogStatus'];a379_0x41be=function(){return _0xdba227;};return a379_0x41be();}class SnapshotService{constructor({snapshotId:_0x5ac252,metadataLogId:_0x1e6dd8,selectedMetaTypes:_0x36c815,selectedComponentMap:_0xa4eb07,whereClause:_0x51fefd},_0x1ea6a9,_0x245fc6,_0x51aa46){const _0x34fa43=a379_0x3ca8b3;this[_0x34fa43(0x1b4)]=_0x1ea6a9,this[_0x34fa43(0x170)]=_0x245fc6,this[_0x34fa43(0x1ba)]=_0x51aa46,this[_0x34fa43(0x1ab)]=_0x5ac252,this[_0x34fa43(0x1a5)]=_0x1e6dd8,this[_0x34fa43(0x1cc)]=_0x36c815,this[_0x34fa43(0x17e)]=_0xa4eb07,this[_0x34fa43(0x178)]=_0x51fefd,this[_0x34fa43(0x1ca)]=new veeva_service_1['VeevaService']({'connection':this[_0x34fa43(0x170)],'logger':this['_logger']}),this[_0x34fa43(0x18d)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x34fa43(0x1b4)]}),this[_0x34fa43(0x18e)]=new package_export_service_1[(_0x34fa43(0x1d5))]({'veevaService':this['_veevaService'],'connection':this[_0x34fa43(0x170)],'logger':this[_0x34fa43(0x1ba)]});}async[a379_0x3ca8b3(0x1c8)](){const _0x1aa280=a379_0x3ca8b3;try{this['_logger'][_0x1aa280(0x1a1)](_0x1aa280(0x160));const _0x3a7698=await this[_0x1aa280(0x198)]();await this[_0x1aa280(0x1ba)][_0x1aa280(0x1bc)]();const _0x484743=await this['_packageExportService'][_0x1aa280(0x1a2)](_0x3a7698,SnapshotService[_0x1aa280(0x1a8)]);await this[_0x1aa280(0x1ba)][_0x1aa280(0x1bc)]();const _0x797f81=await this[_0x1aa280(0x1bb)](_0x3a7698,_0x484743);await this[_0x1aa280(0x1b0)](_0x797f81),await this[_0x1aa280(0x1ba)][_0x1aa280(0x1bc)](),await this[_0x1aa280(0x194)](!![]);}catch(_0x2b265c){this[_0x1aa280(0x1ba)][_0x1aa280(0x180)](_0x2b265c),await this[_0x1aa280(0x194)](![])[_0x1aa280(0x16c)](_0x3ce7b1=>this[_0x1aa280(0x185)][_0x1aa280(0x15d)](_0x3ce7b1));}}async[a379_0x3ca8b3(0x198)](){const _0x261e22=a379_0x3ca8b3,_0x25b93c={'veevaService':this['_veevaService'],'logger':this['_logger']},_0x9fed12=Array['from'](Object['values'](this[_0x261e22(0x17e)]))[_0x261e22(0x19a)]?new type_and_name_veeva_component_retriever_1[(_0x261e22(0x16f))]({'value':this[_0x261e22(0x17e)],..._0x25b93c}):new type_veeva_component_retriever_1[(_0x261e22(0x16b))]({'value':this[_0x261e22(0x1cc)],'whereClause':this[_0x261e22(0x178)],..._0x25b93c});return _0x9fed12['retrieve']();}async['createMetadataItemListWithBody'](_0x26743f,_0x1529c6){const _0x3f3475=a379_0x3ca8b3;var _0x519477,_0x556eda;this[_0x3f3475(0x1ba)]['log'](_0x3f3475(0x19e));const _0x562590=this[_0x3f3475(0x169)](_0x26743f),_0x4f6a35=_0x562590[_0x3f3475(0x161)]((_0x22c9f1,_0x232240)=>_0x22c9f1['set'](_0x232240[_0x3f3475(0x1c6)],_0x232240),new Map());for(const _0x561d17 of _0x1529c6){for(const _0x4189ef in _0x561d17[_0x3f3475(0x163)]){const {base:_0x2d5e3f,name:_0x310902,dir:_0xa8f99d}=path_1[_0x3f3475(0x1d4)][_0x3f3475(0x18b)](_0x4189ef),_0x3fb359=_0x310902+veeva_constants_1['VeevaConstants'][_0x3f3475(0x1be)];if(_0x4f6a35[_0x3f3475(0x189)](_0x2d5e3f)){const _0x11cdbb=await((_0x519477=_0x561d17[_0x3f3475(0x1ae)]([_0xa8f99d,_0x2d5e3f][_0x3f3475(0x187)](path_1['default'][_0x3f3475(0x17b)][_0x3f3475(0x175)])))===null||_0x519477===void 0x0?void 0x0:_0x519477[_0x3f3475(0x182)](_0x3f3475(0x195))),_0x2cdfc0=await((_0x556eda=_0x561d17[_0x3f3475(0x1ae)]([_0xa8f99d,_0x3fb359][_0x3f3475(0x187)](path_1['default'][_0x3f3475(0x17b)][_0x3f3475(0x175)])))===null||_0x556eda===void 0x0?void 0x0:_0x556eda['async'](_0x3f3475(0x195)));if(_0x11cdbb){const _0x49d928=new jszip_1['default']();_0x49d928[_0x3f3475(0x1ae)](_0x2d5e3f,_0x11cdbb),_0x2cdfc0&&_0x49d928['file'](_0x3fb359,this['transformDependencyFile'](_0x2cdfc0)),_0x4f6a35[_0x3f3475(0x188)](_0x2d5e3f)[_0x3f3475(0x1d8)]=await _0x49d928['generateAsync']({'type':_0x3f3475(0x1c3)});}}}}return _0x562590[_0x3f3475(0x18f)](_0x4f7bd4=>!_0x4f7bd4['body'])[_0x3f3475(0x174)](_0x22a368=>{const _0xe0c91f=_0x3f3475;this[_0xe0c91f(0x1ba)][_0xe0c91f(0x1a1)]('Cannot\x20retrieve\x20'+_0x22a368[_0xe0c91f(0x1c9)]+'.'+_0x22a368[_0xe0c91f(0x19f)]+_0xe0c91f(0x173));}),_0x562590['filter'](_0x172844=>_0x172844[_0x3f3475(0x1d8)]);}[a379_0x3ca8b3(0x1a6)](_0x1f5fd0){const _0x10e165=a379_0x3ca8b3,_0x1c60e5=(0x0,sync_1['parse'])(_0x1f5fd0,{'columns':!![],'skip_empty_lines':!![]}),_0x34ecc9=_0x1c60e5[_0x10e165(0x199)](({'In\x20Package':_0x184ec4,..._0x336520})=>_0x336520);return(0x0,sync_2[_0x10e165(0x1b8)])(_0x34ecc9,{'header':!![]});}[a379_0x3ca8b3(0x169)](_0x194486){const _0x4ffd42=a379_0x3ca8b3;return _0x194486[_0x4ffd42(0x199)](_0x394158=>{const _0x31b70b=_0x4ffd42,_0x2da82b=new metadata_item_dto_1['MetadataItemDto']();return _0x2da82b['name']=_0x394158[_0x31b70b(0x19f)],_0x2da82b[_0x31b70b(0x177)]=_0x394158['name'],_0x2da82b['snapshotId']=this[_0x31b70b(0x1ab)],_0x2da82b[_0x31b70b(0x1c6)]=_0x394158[_0x31b70b(0x1c4)]+'.'+_0x394158[_0x31b70b(0x19f)]+veeva_constants_1[_0x31b70b(0x1ac)]['MDL_EXTENSION'],_0x2da82b[_0x31b70b(0x1c9)]=_0x394158[_0x31b70b(0x1c4)],_0x2da82b[_0x31b70b(0x16d)]=_0x394158[_0x31b70b(0x16d)],_0x2da82b[_0x31b70b(0x181)]=![],_0x2da82b;});}async['saveComponentsInSalesforce'](_0x24e533){const _0x4d3c1f=a379_0x3ca8b3;this['_logger']['log'](_0x4d3c1f(0x1a3)),await this[_0x4d3c1f(0x1ce)](_0x24e533),this[_0x4d3c1f(0x1ba)][_0x4d3c1f(0x1a1)](_0x4d3c1f(0x167)+_0x24e533[_0x4d3c1f(0x19a)]+'\x20Metadata\x20Items');const _0x1fda63=_0x24e533[_0x4d3c1f(0x199)](_0x3e9489=>{const _0x24dd51=_0x4d3c1f;return{[constants_1[_0x24dd51(0x17d)]+_0x24dd51(0x1b7)]:_0x3e9489[_0x24dd51(0x19f)],[constants_1[_0x24dd51(0x17d)]+'API_Name__c']:_0x3e9489[_0x24dd51(0x177)],[constants_1[_0x24dd51(0x17d)]+'Snapshot__c']:_0x3e9489['snapshotId'],[constants_1[_0x24dd51(0x17d)]+_0x24dd51(0x1c0)]:_0x3e9489[_0x24dd51(0x1c6)],[constants_1[_0x24dd51(0x17d)]+_0x24dd51(0x16a)]:_0x3e9489[_0x24dd51(0x181)],[constants_1[_0x24dd51(0x17d)]+_0x24dd51(0x19d)]:_0x3e9489[_0x24dd51(0x1c9)],[constants_1[_0x24dd51(0x17d)]+_0x24dd51(0x1d3)]:_0x3e9489['attachmentId'],[constants_1[_0x24dd51(0x17d)]+'Last_Modified_Date__c']:_0x3e9489[_0x24dd51(0x16d)]};}),_0x5c874b=await this[_0x4d3c1f(0x18d)][_0x4d3c1f(0x191)](constants_1['FLOSUM_NAMESPACE']+_0x4d3c1f(0x1a4),_0x1fda63);let _0x26504e=!![];_0x5c874b[_0x4d3c1f(0x174)]((_0x5f3d90,_0x5800d5)=>{const _0x452194=_0x4d3c1f;this['_logger'][_0x452194(0x1a1)](_0x452194(0x167)+_0x24e533[_0x5800d5][_0x452194(0x1c9)]+'.'+_0x24e533[_0x5800d5][_0x452194(0x19f)]);if(!_0x5f3d90[_0x452194(0x1bd)]){_0x26504e=![];const _0x5cd4e0=new salesforce_dml_error_1['SalesforceDmlError'](_0x5f3d90['errors']);this[_0x452194(0x1ba)]['logError'](_0x5cd4e0);}});if(!_0x26504e)throw new Error(_0x4d3c1f(0x184));}async[a379_0x3ca8b3(0x1ce)](_0x518dfe){const _0x6cd178=a379_0x3ca8b3,_0x49a2fe=this[_0x6cd178(0x1cf)](_0x518dfe),_0x253c8f=await this['_salesforceService'][_0x6cd178(0x191)](SnapshotService['ATTACHMENT'],_0x49a2fe),_0x152b07=[];_0x253c8f[_0x6cd178(0x174)]((_0x243ebc,_0x1cb1cb)=>{const _0x2d28a2=_0x6cd178;_0x243ebc[_0x2d28a2(0x1bd)]?(_0x518dfe[_0x1cb1cb][_0x2d28a2(0x172)]=_0x243ebc['id'],_0x518dfe[_0x1cb1cb][_0x2d28a2(0x181)]=!![]):_0x152b07['push'](..._0x243ebc[_0x2d28a2(0x1d7)]);});if(_0x152b07[_0x6cd178(0x19a)])throw new salesforce_dml_error_1[(_0x6cd178(0x168))](_0x152b07);}[a379_0x3ca8b3(0x1cf)](_0x423e19){const _0x49a41a=a379_0x3ca8b3;return _0x423e19[_0x49a41a(0x199)](_0x1aa016=>({'ParentId':this[_0x49a41a(0x1ab)],'Name':_0x1aa016[_0x49a41a(0x1c9)],'ContentType':_0x49a41a(0x1af),'Body':_0x1aa016[_0x49a41a(0x1d8)],'Description':_0x1aa016[_0x49a41a(0x1c9)]}));}async['finishSnapshot'](_0x3ba5af){const _0x32125d=a379_0x3ca8b3,_0x2d07fd={[constants_1['FLOSUM_NAMESPACE']+_0x32125d(0x166)]:!![],[constants_1['FLOSUM_NAMESPACE']+_0x32125d(0x165)]:!_0x3ba5af},_0x1d970d={[constants_1[_0x32125d(0x17d)]+_0x32125d(0x165)]:!_0x3ba5af,[constants_1['FLOSUM_NAMESPACE']+_0x32125d(0x1aa)]:_0x3ba5af,[constants_1[_0x32125d(0x17d)]+_0x32125d(0x1d6)]:_0x3ba5af?status_enums_1[_0x32125d(0x1d1)][_0x32125d(0x162)]:status_enums_1[_0x32125d(0x1d1)][_0x32125d(0x1c7)],[constants_1[_0x32125d(0x17d)]+_0x32125d(0x1b9)]:!![]};await this[_0x32125d(0x1b4)][_0x32125d(0x193)](flosum_constants_1[_0x32125d(0x1cd)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1['FLOSUM_NAMESPACE']+_0x32125d(0x15e)+this['_snapshotId'],_0x2d07fd),await this[_0x32125d(0x1b4)][_0x32125d(0x193)](flosum_constants_1[_0x32125d(0x1cd)][_0x32125d(0x1c5)]+'/'+constants_1[_0x32125d(0x17d)]+_0x32125d(0x196)+this[_0x32125d(0x1a5)],_0x1d970d),this['_logger'][_0x32125d(0x1a1)](_0x32125d(0x1b1)+(_0x3ba5af?_0x32125d(0x15c):_0x32125d(0x1d9))+'.'),await this[_0x32125d(0x1ba)][_0x32125d(0x1bc)]();}}exports['SnapshotService']=SnapshotService,SnapshotService[a379_0x3ca8b3(0x1a8)]=a379_0x3ca8b3(0x1d0),SnapshotService[a379_0x3ca8b3(0x1da)]=a379_0x3ca8b3(0x1a7);