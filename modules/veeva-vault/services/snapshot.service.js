const a407_0x45542b=a407_0x3280;function a407_0x3280(_0x7b1d1e,_0x9f9a26){const _0x43f854=a407_0x5b25();return a407_0x3280=function(_0x1f0a78,_0xdac8cf){_0x1f0a78=_0x1f0a78-0xc8;let _0x5b25a8=_0x43f854[_0x1f0a78];return _0x5b25a8;},a407_0x3280(_0x7b1d1e,_0x9f9a26);}function a407_0x5b25(){const _0xfc3685=['string','ENDPOINT_UPSERT_RECORD','735seloIP','_selectedComponentMap','catch','push','defineProperty','_salesforceService','TypeAndNameVeevaComponentRetriever','MetadataLogStatus','MetadataItemDto','Attachment','apply','generateAsync','_logger','_veevaService','Snapshot\x20started.','_metadataLogId','join','forEach','formMetadataItemDtoList','csv-parse/sync','Snapshot__c','21635caSqjl','snapshotId','label','Last_Modified_Date__c','Is_Retrieved__c','success','SnapshotService','PackageExportService','isRetrieved','async','Veeva_Component_Type__c','_connectionVeeva','FLOSUM_NAMESPACE','error','lastModifiedDate','finishSnapshot','TypeVeevaComponentRetriever','createMetadataItemListWithBody','successfully','from','default','transformDependencyFile','\x20Metadata\x20Items','updateLog','parse','_connectionSalesforce','toString','get','../constants/flosum.constants','Metadata_Item__c','Saving\x20','map','_selectedMetaTypes','veevaComponentType','length','Attachment_ID__c','_packageExportService','6922201GceVRY','2961144ClHrdz','11342728pWgQEt','DEPENDENCY_EXTENSION','log','VeevaConstants','values','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','saveComponentsInSalesforce','\x20from\x20outbound\x20package','1524jufFvw','../dtos/metadata-item.dto','attachmentId','errors','MDL_EXTENSION','file','COMPLETED','files','_whereClause','Is_Error__c','FlosumConstants','Is_Completed__c','patch','filter','30iPtdGw','./veeva.service','Metadata_Log__c/','base64','14932740JtgRdn','(((.+)+)+)+$','Snapshot','39BvGUTP','set','../../../constants','ATTACHMENT','../classes/errors/salesforce-dml-error','apiName','EXCEPTION','__importDefault','9tJaeCh','body','SalesforceDmlError','execute','9732YzoPKh','Job_Completed__c','OUTBOUND_PACKAGE_NAME','Succeed__c','stringify','../enums/status.enums','Snapshot\x20completed\x20','Label__c','retrieveVeevaComponents','has','csv-stringify/sync','formAttachments','with\x20error','name','Status__c','154zGKiip','../constants/veeva.constants','search','Saving\x20Attachments.','reduce','__esModule','insertMultipleRecords','_systemLogger','saveAttachments','2572NMLzEx','type','posix','logError','../classes/retrievers/veeva-components/type.veeva-component.retriever','./package-export.service','_snapshotId'];a407_0x5b25=function(){return _0xfc3685;};return a407_0x5b25();}(function(_0xd614ae,_0xf701b0){const _0x479151=a407_0x3280,_0x313ca4=_0xd614ae();while(!![]){try{const _0x1aaa52=-parseInt(_0x479151(0xfc))/0x1*(-parseInt(_0x479151(0xf3))/0x2)+-parseInt(_0x479151(0x140))/0x3+parseInt(_0x479151(0x149))/0x4*(-parseInt(_0x479151(0x11a))/0x5)+parseInt(_0x479151(0xe4))/0x6*(parseInt(_0x479151(0x105))/0x7)+-parseInt(_0x479151(0x141))/0x8*(-parseInt(_0x479151(0xe0))/0x9)+-parseInt(_0x479151(0xd1))/0xa*(parseInt(_0x479151(0x13f))/0xb)+parseInt(_0x479151(0xd5))/0xc*(parseInt(_0x479151(0xd8))/0xd);if(_0x1aaa52===_0xf701b0)break;else _0x313ca4['push'](_0x313ca4['shift']());}catch(_0x392961){_0x313ca4['push'](_0x313ca4['shift']());}}}(a407_0x5b25,0xf3220));const a407_0xdac8cf=(function(){let _0x573247=!![];return function(_0x1a9ac7,_0x12b0d7){const _0x4929a0=_0x573247?function(){const _0x5ea15b=a407_0x3280;if(_0x12b0d7){const _0x3b449f=_0x12b0d7[_0x5ea15b(0x10f)](_0x1a9ac7,arguments);return _0x12b0d7=null,_0x3b449f;}}:function(){};return _0x573247=![],_0x4929a0;};}()),a407_0x1f0a78=a407_0xdac8cf(this,function(){const _0x11f3d9=a407_0x3280;return a407_0x1f0a78['toString']()[_0x11f3d9(0xf5)](_0x11f3d9(0xd6))[_0x11f3d9(0x134)]()['constructor'](a407_0x1f0a78)['search']('(((.+)+)+)+$');});a407_0x1f0a78();'use strict';var __importDefault=this&&this[a407_0x45542b(0xdf)]||function(_0x5f4f6b){const _0x48a728=a407_0x45542b;return _0x5f4f6b&&_0x5f4f6b[_0x48a728(0xf8)]?_0x5f4f6b:{'default':_0x5f4f6b};};Object[a407_0x45542b(0x109)](exports,a407_0x45542b(0xf8),{'value':!![]}),exports[a407_0x45542b(0x120)]=void 0x0;const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require(a407_0x45542b(0x136)),veeva_service_1=require(a407_0x45542b(0xd2)),metadata_item_dto_1=require(a407_0x45542b(0x14a)),constants_1=require(a407_0x45542b(0xda)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a407_0x45542b(0xe9)),salesforce_dml_error_1=require(a407_0x45542b(0xdc)),package_export_service_1=require(a407_0x45542b(0x101)),type_and_name_veeva_component_retriever_1=require(a407_0x45542b(0x146)),type_veeva_component_retriever_1=require(a407_0x45542b(0x100)),sync_1=require(a407_0x45542b(0x118)),sync_2=require(a407_0x45542b(0xee)),veeva_constants_1=require(a407_0x45542b(0xf4)),path_1=__importDefault(require('path'));class SnapshotService{constructor({snapshotId:_0x1cc01c,metadataLogId:_0xbaac4,selectedMetaTypes:_0xf0b700,selectedComponentMap:_0x36fcbb,whereClause:_0x4e7345},_0x4532f0,_0x36483b,_0x424db6){const _0x2be923=a407_0x45542b;this[_0x2be923(0x133)]=_0x4532f0,this[_0x2be923(0x125)]=_0x36483b,this[_0x2be923(0x111)]=_0x424db6,this[_0x2be923(0x102)]=_0x1cc01c,this[_0x2be923(0x114)]=_0xbaac4,this[_0x2be923(0x13a)]=_0xf0b700,this['_selectedComponentMap']=_0x36fcbb,this[_0x2be923(0xcb)]=_0x4e7345,this[_0x2be923(0x112)]=new veeva_service_1['VeevaService']({'connection':this[_0x2be923(0x125)],'logger':this[_0x2be923(0x111)]}),this['_salesforceService']=new salesforce_service_1['SalesforceService']({'connection':this[_0x2be923(0x133)]}),this[_0x2be923(0x13e)]=new package_export_service_1[(_0x2be923(0x121))]({'veevaService':this[_0x2be923(0x112)],'connection':this['_connectionVeeva'],'logger':this[_0x2be923(0x111)]});}async[a407_0x45542b(0xe3)](){const _0x1be88b=a407_0x45542b;try{this[_0x1be88b(0x111)][_0x1be88b(0x143)](_0x1be88b(0x113));const _0x3d8c7d=await this[_0x1be88b(0xec)]();await this[_0x1be88b(0x111)][_0x1be88b(0x131)]();const _0x5bcda4=await this[_0x1be88b(0x13e)]['export'](_0x3d8c7d,SnapshotService[_0x1be88b(0xe6)]);await this[_0x1be88b(0x111)][_0x1be88b(0x131)]();const _0x365f84=await this['createMetadataItemListWithBody'](_0x3d8c7d,_0x5bcda4);await this[_0x1be88b(0x147)](_0x365f84),await this[_0x1be88b(0x111)][_0x1be88b(0x131)](),await this[_0x1be88b(0x129)](!![]);}catch(_0x57445d){this['_logger'][_0x1be88b(0xff)](_0x57445d),await this[_0x1be88b(0x129)](![])[_0x1be88b(0x107)](_0x42e153=>this[_0x1be88b(0xfa)][_0x1be88b(0x127)](_0x42e153));}}async['retrieveVeevaComponents'](){const _0x26260e=a407_0x45542b,_0x5a6758={'veevaService':this['_veevaService'],'logger':this[_0x26260e(0x111)]},_0x11d3bd=Array[_0x26260e(0x12d)](Object[_0x26260e(0x145)](this[_0x26260e(0x106)]))[_0x26260e(0x13c)]?new type_and_name_veeva_component_retriever_1[(_0x26260e(0x10b))]({'value':this['_selectedComponentMap'],..._0x5a6758}):new type_veeva_component_retriever_1[(_0x26260e(0x12a))]({'value':this[_0x26260e(0x13a)],'whereClause':this['_whereClause'],..._0x5a6758});return _0x11d3bd['retrieve']();}async[a407_0x45542b(0x12b)](_0x3df125,_0x22b150){const _0x4c9691=a407_0x45542b;var _0x1d66c3,_0xec7e16;this[_0x4c9691(0x111)]['log']('Unpack\x20zip\x20and\x20create\x20metadata\x20items.');const _0x43b272=this[_0x4c9691(0x117)](_0x3df125),_0x1ecda2=_0x43b272[_0x4c9691(0xf7)]((_0x313ccd,_0xe9b9bf)=>_0x313ccd[_0x4c9691(0xd9)](_0xe9b9bf[_0x4c9691(0x11c)],_0xe9b9bf),new Map());for(const _0x298f60 of _0x22b150){for(const _0x383006 in _0x298f60[_0x4c9691(0xca)]){const {base:_0x5151d2,name:_0x134bf2,dir:_0x49d7b7}=path_1[_0x4c9691(0x12e)]['parse'](_0x383006),_0x30ac89=_0x134bf2+veeva_constants_1['VeevaConstants'][_0x4c9691(0x142)];if(_0x1ecda2[_0x4c9691(0xed)](_0x5151d2)){const _0x355c81=await((_0x1d66c3=_0x298f60[_0x4c9691(0xc8)]([_0x49d7b7,_0x5151d2][_0x4c9691(0x115)](path_1['default']['posix']['sep'])))===null||_0x1d66c3===void 0x0?void 0x0:_0x1d66c3['async'](_0x4c9691(0x103))),_0x224065=await((_0xec7e16=_0x298f60[_0x4c9691(0xc8)]([_0x49d7b7,_0x30ac89][_0x4c9691(0x115)](path_1[_0x4c9691(0x12e)][_0x4c9691(0xfe)]['sep'])))===null||_0xec7e16===void 0x0?void 0x0:_0xec7e16[_0x4c9691(0x123)]('string'));if(_0x355c81){const _0x5ad461=new jszip_1[(_0x4c9691(0x12e))]();_0x5ad461['file'](_0x5151d2,_0x355c81),_0x224065&&_0x5ad461[_0x4c9691(0xc8)](_0x30ac89,this[_0x4c9691(0x12f)](_0x224065)),_0x1ecda2[_0x4c9691(0x135)](_0x5151d2)[_0x4c9691(0xe1)]=await _0x5ad461[_0x4c9691(0x110)]({'type':_0x4c9691(0xd4)});}}}}return _0x43b272[_0x4c9691(0xd0)](_0x259cde=>!_0x259cde['body'])[_0x4c9691(0x116)](_0x3ad152=>{const _0x211fcb=_0x4c9691;this[_0x211fcb(0x111)][_0x211fcb(0x143)]('Cannot\x20retrieve\x20'+_0x3ad152[_0x211fcb(0x13b)]+'.'+_0x3ad152[_0x211fcb(0xf1)]+_0x211fcb(0x148));}),_0x43b272[_0x4c9691(0xd0)](_0x2f5ee5=>_0x2f5ee5[_0x4c9691(0xe1)]);}[a407_0x45542b(0x12f)](_0x417991){const _0x140720=a407_0x45542b,_0x301a68=(0x0,sync_1[_0x140720(0x132)])(_0x417991,{'columns':!![],'skip_empty_lines':!![]}),_0x31ddc0=_0x301a68[_0x140720(0x139)](({'In\x20Package':_0x14db33,..._0x442fef})=>_0x442fef);return(0x0,sync_2[_0x140720(0xe8)])(_0x31ddc0,{'header':!![]});}[a407_0x45542b(0x117)](_0x349679){const _0x1e51ec=a407_0x45542b;return _0x349679[_0x1e51ec(0x139)](_0x150672=>{const _0x513a0c=_0x1e51ec,_0x32c042=new metadata_item_dto_1[(_0x513a0c(0x10d))]();return _0x32c042[_0x513a0c(0xf1)]=_0x150672[_0x513a0c(0xf1)],_0x32c042['apiName']=_0x150672[_0x513a0c(0xf1)],_0x32c042[_0x513a0c(0x11b)]=this[_0x513a0c(0x102)],_0x32c042[_0x513a0c(0x11c)]=_0x150672[_0x513a0c(0xfd)]+'.'+_0x150672[_0x513a0c(0xf1)]+veeva_constants_1[_0x513a0c(0x144)][_0x513a0c(0x14d)],_0x32c042[_0x513a0c(0x13b)]=_0x150672['type'],_0x32c042[_0x513a0c(0x128)]=_0x150672[_0x513a0c(0x128)],_0x32c042[_0x513a0c(0x122)]=![],_0x32c042;});}async[a407_0x45542b(0x147)](_0x265c95){const _0x32faff=a407_0x45542b;this[_0x32faff(0x111)][_0x32faff(0x143)](_0x32faff(0xf6)),await this[_0x32faff(0xfb)](_0x265c95),this['_logger']['log']('Saving\x20'+_0x265c95['length']+_0x32faff(0x130));const _0x1c699f=_0x265c95[_0x32faff(0x139)](_0x2d9c8c=>{const _0x3c3c09=_0x32faff;return{[constants_1[_0x3c3c09(0x126)]+'Name__c']:_0x2d9c8c[_0x3c3c09(0xf1)],[constants_1[_0x3c3c09(0x126)]+'API_Name__c']:_0x2d9c8c[_0x3c3c09(0xdd)],[constants_1['FLOSUM_NAMESPACE']+_0x3c3c09(0x119)]:_0x2d9c8c['snapshotId'],[constants_1[_0x3c3c09(0x126)]+_0x3c3c09(0xeb)]:_0x2d9c8c['label'],[constants_1[_0x3c3c09(0x126)]+_0x3c3c09(0x11e)]:_0x2d9c8c[_0x3c3c09(0x122)],[constants_1[_0x3c3c09(0x126)]+_0x3c3c09(0x124)]:_0x2d9c8c[_0x3c3c09(0x13b)],[constants_1[_0x3c3c09(0x126)]+_0x3c3c09(0x13d)]:_0x2d9c8c['attachmentId'],[constants_1['FLOSUM_NAMESPACE']+_0x3c3c09(0x11d)]:_0x2d9c8c[_0x3c3c09(0x128)]};}),_0x47ec1a=await this[_0x32faff(0x10a)][_0x32faff(0xf9)](constants_1[_0x32faff(0x126)]+_0x32faff(0x137),_0x1c699f);let _0x86b072=!![];_0x47ec1a[_0x32faff(0x116)]((_0x2cd72b,_0x19f8a6)=>{const _0x397f2b=_0x32faff;this[_0x397f2b(0x111)][_0x397f2b(0x143)](_0x397f2b(0x138)+_0x265c95[_0x19f8a6][_0x397f2b(0x13b)]+'.'+_0x265c95[_0x19f8a6][_0x397f2b(0xf1)]);if(!_0x2cd72b[_0x397f2b(0x11f)]){_0x86b072=![];const _0x4cc1c0=new salesforce_dml_error_1[(_0x397f2b(0xe2))](_0x2cd72b[_0x397f2b(0x14c)]);this['_logger'][_0x397f2b(0xff)](_0x4cc1c0);}});if(!_0x86b072)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async['saveAttachments'](_0x578b14){const _0x1d6e12=a407_0x45542b,_0x33dade=this['formAttachments'](_0x578b14),_0x26a16b=await this[_0x1d6e12(0x10a)]['insertMultipleRecords'](SnapshotService['ATTACHMENT'],_0x33dade),_0x5b0af3=[];_0x26a16b['forEach']((_0x2dd1b5,_0x320833)=>{const _0x1aecd1=_0x1d6e12;_0x2dd1b5[_0x1aecd1(0x11f)]?(_0x578b14[_0x320833][_0x1aecd1(0x14b)]=_0x2dd1b5['id'],_0x578b14[_0x320833]['isRetrieved']=!![]):_0x5b0af3[_0x1aecd1(0x108)](..._0x2dd1b5[_0x1aecd1(0x14c)]);});if(_0x5b0af3[_0x1d6e12(0x13c)])throw new salesforce_dml_error_1[(_0x1d6e12(0xe2))](_0x5b0af3);}[a407_0x45542b(0xef)](_0x2ca64a){const _0x443e4e=a407_0x45542b;return _0x2ca64a['map'](_0x1b3c64=>({'ParentId':this[_0x443e4e(0x102)],'Name':_0x1b3c64[_0x443e4e(0x13b)],'ContentType':'application/zip','Body':_0x1b3c64[_0x443e4e(0xe1)],'Description':_0x1b3c64[_0x443e4e(0x13b)]}));}async[a407_0x45542b(0x129)](_0x37d81f){const _0x324bb1=a407_0x45542b,_0x2d7c01={[constants_1['FLOSUM_NAMESPACE']+_0x324bb1(0xce)]:!![],[constants_1[_0x324bb1(0x126)]+_0x324bb1(0xcc)]:!_0x37d81f},_0x516be4={[constants_1[_0x324bb1(0x126)]+_0x324bb1(0xcc)]:!_0x37d81f,[constants_1[_0x324bb1(0x126)]+_0x324bb1(0xe7)]:_0x37d81f,[constants_1[_0x324bb1(0x126)]+_0x324bb1(0xf2)]:_0x37d81f?status_enums_1[_0x324bb1(0x10c)][_0x324bb1(0xc9)]:status_enums_1[_0x324bb1(0x10c)][_0x324bb1(0xde)],[constants_1['FLOSUM_NAMESPACE']+_0x324bb1(0xe5)]:!![]};await this['_connectionSalesforce'][_0x324bb1(0xcf)](flosum_constants_1[_0x324bb1(0xcd)][_0x324bb1(0x104)]+'/'+constants_1[_0x324bb1(0x126)]+'Snapshot__c/'+this[_0x324bb1(0x102)],_0x2d7c01),await this['_connectionSalesforce'][_0x324bb1(0xcf)](flosum_constants_1['FlosumConstants'][_0x324bb1(0x104)]+'/'+constants_1[_0x324bb1(0x126)]+_0x324bb1(0xd3)+this[_0x324bb1(0x114)],_0x516be4),this[_0x324bb1(0x111)][_0x324bb1(0x143)](_0x324bb1(0xea)+(_0x37d81f?_0x324bb1(0x12c):_0x324bb1(0xf0))+'.'),await this[_0x324bb1(0x111)][_0x324bb1(0x131)]();}}exports[a407_0x45542b(0x120)]=SnapshotService,SnapshotService[a407_0x45542b(0xe6)]=a407_0x45542b(0xd7),SnapshotService[a407_0x45542b(0xdb)]=a407_0x45542b(0x10e);