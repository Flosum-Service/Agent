const a363_0x5500ed=a363_0x19a4;(function(_0x59f5df,_0x1012cf){const _0x200f0c=a363_0x19a4,_0x597227=_0x59f5df();while(!![]){try{const _0x4cf3d0=parseInt(_0x200f0c(0x11c))/0x1*(parseInt(_0x200f0c(0x131))/0x2)+parseInt(_0x200f0c(0xd1))/0x3*(-parseInt(_0x200f0c(0xec))/0x4)+-parseInt(_0x200f0c(0x117))/0x5*(-parseInt(_0x200f0c(0xce))/0x6)+parseInt(_0x200f0c(0xf2))/0x7+parseInt(_0x200f0c(0xf0))/0x8*(parseInt(_0x200f0c(0x115))/0x9)+-parseInt(_0x200f0c(0x12a))/0xa+-parseInt(_0x200f0c(0xe9))/0xb*(parseInt(_0x200f0c(0xe7))/0xc);if(_0x4cf3d0===_0x1012cf)break;else _0x597227['push'](_0x597227['shift']());}catch(_0x49e808){_0x597227['push'](_0x597227['shift']());}}}(a363_0xf0f0,0x29976));const a363_0x292fde=(function(){let _0x31217d=!![];return function(_0x4e455a,_0x3a295e){const _0x3062a9=_0x31217d?function(){const _0x37384c=a363_0x19a4;if(_0x3a295e){const _0x7c7065=_0x3a295e[_0x37384c(0x119)](_0x4e455a,arguments);return _0x3a295e=null,_0x7c7065;}}:function(){};return _0x31217d=![],_0x3062a9;};}()),a363_0x3a53e0=a363_0x292fde(this,function(){const _0x207581=a363_0x19a4;return a363_0x3a53e0[_0x207581(0x12d)]()['search'](_0x207581(0x109))['toString']()[_0x207581(0xcd)](a363_0x3a53e0)[_0x207581(0x13c)](_0x207581(0x109));});a363_0x3a53e0();'use strict';function a363_0x19a4(_0x3fe341,_0x34ad9e){const _0x4cbaf8=a363_0xf0f0();return a363_0x19a4=function(_0x3a53e0,_0x292fde){_0x3a53e0=_0x3a53e0-0xba;let _0xf0f09d=_0x4cbaf8[_0x3a53e0];return _0xf0f09d;},a363_0x19a4(_0x3fe341,_0x34ad9e);}var __importDefault=this&&this[a363_0x5500ed(0xd0)]||function(_0x35167c){const _0x23b070=a363_0x5500ed;return _0x35167c&&_0x35167c[_0x23b070(0xd6)]?_0x35167c:{'default':_0x35167c};};Object['defineProperty'](exports,a363_0x5500ed(0xd6),{'value':!![]}),exports[a363_0x5500ed(0xbb)]=void 0x0;function a363_0xf0f0(){const _0x344524=['Snapshot__c','_selectedComponentMap','saveAttachments','createMetadataItemListWithBody','Metadata_Item__c','apiName','Snapshot','\x20Metadata\x20Items','../enums/status.enums','name','_connectionSalesforce','patch','12SBegsn','retrieveVeevaComponents','989153jvZXtB','Saving\x20Attachments.','map','24ZgLjQn','reduce','async','Cannot\x20Save\x20Metadata\x20Items','41832GKQRXx','execute','665714TxiPcl','Is_Retrieved__c','COMPLETED','selectedComponentMap','_snapshotId','../constants/veeva.constants','files','Name__c','FlosumConstants','saveComponentsInSalesforce','_timeZone','./package-export.service','base64','Metadata_Log__c/','success','_connectionVeeva','ENDPOINT_UPSERT_RECORD','length','successfully','filter','OUTBOUND_PACKAGE_NAME','jszip','application/zip','(((.+)+)+)+$','../constants/flosum.constants','export','logError','Snapshot\x20completed\x20','../classes/errors/salesforce-dml-error','timeZone','join','forEach','API_Name__c','MetadataLogStatus','log','459fIgdfc','formMetadataItemDtoList','5qUDAmd','TypeVeevaComponentRetriever','apply','from','transformDependencyFile','9vJKymK','finishSnapshot','updateLog','errors','_salesforceService','parse','formAttachments','VeevaConstants','attachmentId','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','Status__c','MetadataItemDto','../../../constants','Is_Completed__c','3390880qIfXfp','file','get','toString','default','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','EXCEPTION','47662tZhysA','TypeAndNameVeevaComponentRetriever','../classes/retrievers/veeva-components/type.veeva-component.retriever','veevaComponentType','lastModifiedDate','MDL_EXTENSION','Label__c','snapshotId','attachmentLogId','catch','_selectedMetaTypes','search','type','Last_Modified_Date__c','Attachment','SnapshotService','stringify','_packageExportService','Saving\x20','PackageExportService','selectedMetaTypes','Job_Completed__c','SalesforceDmlError','Is_Error__c','error','Attachment_ID__c','metadataLogId','Veeva_Component_Type__c','has','SalesforceService','csv-stringify/sync','label','_veevaService','constructor','1742490HdPTpE','csv-parse/sync','__importDefault','133653zSPQlZ','values','_logger','isRetrieved','ATTACHMENT','__esModule','Succeed__c','FLOSUM_NAMESPACE','body','string'];a363_0xf0f0=function(){return _0x344524;};return a363_0xf0f0();}const jszip_1=__importDefault(require(a363_0x5500ed(0x107))),flosum_constants_1=require(a363_0x5500ed(0x10a)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a363_0x5500ed(0x128)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a363_0x5500ed(0xe3)),salesforce_dml_error_1=require(a363_0x5500ed(0x10e)),package_export_service_1=require(a363_0x5500ed(0xfd)),type_and_name_veeva_component_retriever_1=require(a363_0x5500ed(0x12f)),type_veeva_component_retriever_1=require(a363_0x5500ed(0x133)),sync_1=require(a363_0x5500ed(0xcf)),sync_2=require(a363_0x5500ed(0xca)),veeva_constants_1=require(a363_0x5500ed(0xf7)),path_1=__importDefault(require('path'));class SnapshotService{constructor(_0x4dee84,_0x49df4b,_0xe9a68d,_0x5cab14){const _0x1c39a9=a363_0x5500ed;this[_0x1c39a9(0xe5)]=_0x49df4b,this['_connectionVeeva']=_0xe9a68d,this[_0x1c39a9(0xd3)]=_0x5cab14,this[_0x1c39a9(0xf6)]=_0x4dee84[_0x1c39a9(0x138)],this['_metadataLogId']=_0x4dee84[_0x1c39a9(0xc6)],this['_attachmentLogId']=_0x4dee84[_0x1c39a9(0x139)],this[_0x1c39a9(0xfc)]=_0x4dee84[_0x1c39a9(0x10f)],this[_0x1c39a9(0x13b)]=_0x4dee84[_0x1c39a9(0xc0)],this[_0x1c39a9(0xdc)]=_0x4dee84[_0x1c39a9(0xf5)],this[_0x1c39a9(0xcc)]=new veeva_service_1['VeevaService']({'connection':this[_0x1c39a9(0x101)],'logger':this[_0x1c39a9(0xd3)]}),this[_0x1c39a9(0x120)]=new salesforce_service_1[(_0x1c39a9(0xc9))]({'connection':this['_connectionSalesforce']}),this[_0x1c39a9(0xbd)]=new package_export_service_1[(_0x1c39a9(0xbf))]({'veevaService':this[_0x1c39a9(0xcc)],'connection':this[_0x1c39a9(0x101)],'logger':this[_0x1c39a9(0xd3)]});}async[a363_0x5500ed(0xf1)](){const _0x30dd62=a363_0x5500ed;try{this[_0x30dd62(0xd3)][_0x30dd62(0x114)]('Snapshot\x20started.');const _0x2c60be=await this['retrieveVeevaComponents']();await this['_logger'][_0x30dd62(0x11e)]();const _0x41f8d7=await this['_packageExportService'][_0x30dd62(0x10b)](_0x2c60be,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this[_0x30dd62(0xd3)][_0x30dd62(0x11e)]();const _0x5d5134=await this[_0x30dd62(0xde)](_0x2c60be,_0x41f8d7);await this[_0x30dd62(0xfb)](_0x5d5134),await this[_0x30dd62(0xd3)][_0x30dd62(0x11e)](),await this[_0x30dd62(0x11d)](!![]);}catch(_0x1eb2d9){this['_logger'][_0x30dd62(0x10c)](_0x1eb2d9),await this[_0x30dd62(0x11d)](![])[_0x30dd62(0x13a)](_0x46388d=>this['_systemLogger'][_0x30dd62(0xc4)](_0x46388d));}}async[a363_0x5500ed(0xe8)](){const _0x4658c8=a363_0x5500ed,_0x4fdab2={'veevaService':this[_0x4658c8(0xcc)],'logger':this[_0x4658c8(0xd3)]},_0x1905e8=Array[_0x4658c8(0x11a)](Object[_0x4658c8(0xd2)](this[_0x4658c8(0xdc)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x4658c8(0x132))]({'value':this[_0x4658c8(0xdc)],..._0x4fdab2}):new type_veeva_component_retriever_1[(_0x4658c8(0x118))]({'value':this[_0x4658c8(0x13b)],..._0x4fdab2});return _0x1905e8['retrieve']();}async[a363_0x5500ed(0xde)](_0x128d30,_0x2b67fc){const _0x3e3717=a363_0x5500ed;var _0x2e0e84,_0x31d477;this[_0x3e3717(0xd3)]['log'](_0x3e3717(0x125));const _0x3b60a4=this[_0x3e3717(0x116)](_0x128d30),_0x185ba2=_0x3b60a4[_0x3e3717(0xed)]((_0x2ba9b4,_0x54c01e)=>_0x2ba9b4['set'](_0x54c01e['label'],_0x54c01e),new Map());for(const _0x4bd688 of _0x2b67fc){for(const _0x5ad583 in _0x4bd688[_0x3e3717(0xf8)]){const {base:_0x13e471,name:_0x474d94,dir:_0x11aad2}=path_1[_0x3e3717(0x12e)][_0x3e3717(0x121)](_0x5ad583),_0x2ba1ba=_0x474d94+veeva_constants_1['VeevaConstants']['DEPENDENCY_EXTENSION'];if(_0x185ba2[_0x3e3717(0xc8)](_0x13e471)){const _0x4b0f33=await((_0x2e0e84=_0x4bd688[_0x3e3717(0x12b)](path_1[_0x3e3717(0x12e)][_0x3e3717(0x110)](_0x11aad2,_0x13e471)))===null||_0x2e0e84===void 0x0?void 0x0:_0x2e0e84[_0x3e3717(0xee)](_0x3e3717(0xda))),_0x3405c0=await((_0x31d477=_0x4bd688['file'](path_1[_0x3e3717(0x12e)]['join'](_0x11aad2,_0x2ba1ba)))===null||_0x31d477===void 0x0?void 0x0:_0x31d477[_0x3e3717(0xee)](_0x3e3717(0xda)));if(_0x4b0f33&&_0x3405c0){const _0x1635ba=new jszip_1[(_0x3e3717(0x12e))]();_0x1635ba[_0x3e3717(0x12b)](_0x13e471,_0x4b0f33),_0x1635ba['file'](_0x2ba1ba,this[_0x3e3717(0x11b)](_0x3405c0)),_0x185ba2[_0x3e3717(0x12c)](_0x13e471)['body']=await _0x1635ba['generateAsync']({'type':_0x3e3717(0xfe)});}}}}return _0x3b60a4[_0x3e3717(0x105)](_0x648206=>!_0x648206[_0x3e3717(0xd9)])['forEach'](_0x39765f=>{const _0x24c726=_0x3e3717;this[_0x24c726(0xd3)]['log']('Cannot\x20retrieve\x20'+_0x39765f['veevaComponentType']+'.'+_0x39765f[_0x24c726(0xe4)]+'\x20from\x20outbound\x20package');}),_0x3b60a4[_0x3e3717(0x105)](_0x3f9578=>_0x3f9578['body']);}[a363_0x5500ed(0x11b)](_0x3652ef){const _0x15a013=a363_0x5500ed,_0x19e141=(0x0,sync_1[_0x15a013(0x121)])(_0x3652ef,{'columns':!![],'skip_empty_lines':!![]}),_0x1bf8c1=_0x19e141[_0x15a013(0xeb)](({'In\x20Package':_0x1dd264,..._0x381df6})=>_0x381df6);return(0x0,sync_2[_0x15a013(0xbc)])(_0x1bf8c1,{'header':!![]});}[a363_0x5500ed(0x116)](_0x53ef57){const _0x1add4c=a363_0x5500ed;return _0x53ef57[_0x1add4c(0xeb)](_0x19743c=>{const _0x407f1a=_0x1add4c,_0x3decc0=new metadata_item_dto_1[(_0x407f1a(0x127))]();return _0x3decc0['name']=_0x19743c['name'],_0x3decc0[_0x407f1a(0xe0)]=_0x19743c['name'],_0x3decc0[_0x407f1a(0x138)]=this['_snapshotId'],_0x3decc0[_0x407f1a(0xcb)]=_0x19743c['type']+'.'+_0x19743c[_0x407f1a(0xe4)]+veeva_constants_1[_0x407f1a(0x123)][_0x407f1a(0x136)],_0x3decc0[_0x407f1a(0x134)]=_0x19743c[_0x407f1a(0x13d)],_0x3decc0[_0x407f1a(0x135)]=_0x19743c[_0x407f1a(0x135)],_0x3decc0[_0x407f1a(0xd4)]=![],_0x3decc0;});}async[a363_0x5500ed(0xfb)](_0x3f1972){const _0x35d064=a363_0x5500ed;this[_0x35d064(0xd3)][_0x35d064(0x114)](_0x35d064(0xea)),await this[_0x35d064(0xdd)](_0x3f1972),this['_logger'][_0x35d064(0x114)](_0x35d064(0xbe)+_0x3f1972['length']+_0x35d064(0xe2));const _0x3ac3a0=_0x3f1972[_0x35d064(0xeb)](_0x465da3=>{const _0x2fd19e=_0x35d064;return{[constants_1[_0x2fd19e(0xd8)]+_0x2fd19e(0xf9)]:_0x465da3['name'],[constants_1['FLOSUM_NAMESPACE']+_0x2fd19e(0x112)]:_0x465da3[_0x2fd19e(0xe0)],[constants_1[_0x2fd19e(0xd8)]+_0x2fd19e(0xdb)]:_0x465da3[_0x2fd19e(0x138)],[constants_1[_0x2fd19e(0xd8)]+_0x2fd19e(0x137)]:_0x465da3[_0x2fd19e(0xcb)],[constants_1['FLOSUM_NAMESPACE']+_0x2fd19e(0xf3)]:_0x465da3[_0x2fd19e(0xd4)],[constants_1[_0x2fd19e(0xd8)]+_0x2fd19e(0xc7)]:_0x465da3[_0x2fd19e(0x134)],[constants_1['FLOSUM_NAMESPACE']+_0x2fd19e(0xc5)]:_0x465da3[_0x2fd19e(0x124)],[constants_1['FLOSUM_NAMESPACE']+_0x2fd19e(0x13e)]:_0x465da3[_0x2fd19e(0x135)]};}),_0x5d264c=await this['_salesforceService']['insertMultipleRecords'](constants_1['FLOSUM_NAMESPACE']+_0x35d064(0xdf),_0x3ac3a0);let _0x4e4d39=!![];_0x5d264c[_0x35d064(0x111)]((_0x538153,_0x468d5a)=>{const _0x4bd2a6=_0x35d064;this[_0x4bd2a6(0xd3)]['log'](_0x4bd2a6(0xbe)+_0x3f1972[_0x468d5a]['veevaComponentType']+'.'+_0x3f1972[_0x468d5a][_0x4bd2a6(0xe4)]);if(!_0x538153[_0x4bd2a6(0x100)]){_0x4e4d39=![];const _0x376106=new salesforce_dml_error_1[(_0x4bd2a6(0xc2))](_0x538153['errors']);this[_0x4bd2a6(0xd3)]['logError'](_0x376106);}});if(!_0x4e4d39)throw new Error(_0x35d064(0xef));}async[a363_0x5500ed(0xdd)](_0x4d34e4){const _0x3210f4=a363_0x5500ed,_0x5edd7c=this[_0x3210f4(0x122)](_0x4d34e4),_0x581144=await this[_0x3210f4(0x120)]['insertMultipleRecords'](SnapshotService[_0x3210f4(0xd5)],_0x5edd7c),_0x30ef07=[];_0x581144['forEach']((_0x5ce394,_0x3bab6f)=>{const _0x776d1b=_0x3210f4;_0x5ce394[_0x776d1b(0x100)]?(_0x4d34e4[_0x3bab6f][_0x776d1b(0x124)]=_0x5ce394['id'],_0x4d34e4[_0x3bab6f]['isRetrieved']=!![]):_0x30ef07['push'](..._0x5ce394[_0x776d1b(0x11f)]);});if(_0x30ef07[_0x3210f4(0x103)])throw new salesforce_dml_error_1[(_0x3210f4(0xc2))](_0x30ef07);}[a363_0x5500ed(0x122)](_0x3d1cf1){const _0x166b81=a363_0x5500ed;return _0x3d1cf1[_0x166b81(0xeb)](_0x4fb2a5=>({'ParentId':this[_0x166b81(0xf6)],'Name':_0x4fb2a5[_0x166b81(0x134)],'ContentType':_0x166b81(0x108),'Body':_0x4fb2a5[_0x166b81(0xd9)],'Description':_0x4fb2a5[_0x166b81(0x134)]}));}async['finishSnapshot'](_0x3d8e3f){const _0x2846f9=a363_0x5500ed,_0xf7c166={[constants_1['FLOSUM_NAMESPACE']+_0x2846f9(0x129)]:!![],[constants_1[_0x2846f9(0xd8)]+_0x2846f9(0xc3)]:!_0x3d8e3f},_0x3dd29c={[constants_1['FLOSUM_NAMESPACE']+'Is_Error__c']:!_0x3d8e3f,[constants_1['FLOSUM_NAMESPACE']+_0x2846f9(0xd7)]:_0x3d8e3f,[constants_1[_0x2846f9(0xd8)]+_0x2846f9(0x126)]:_0x3d8e3f?status_enums_1[_0x2846f9(0x113)][_0x2846f9(0xf4)]:status_enums_1['MetadataLogStatus'][_0x2846f9(0x130)],[constants_1[_0x2846f9(0xd8)]+_0x2846f9(0xc1)]:!![]};await this['_connectionSalesforce']['patch'](flosum_constants_1[_0x2846f9(0xfa)][_0x2846f9(0x102)]+'/'+constants_1[_0x2846f9(0xd8)]+'Snapshot__c/'+this[_0x2846f9(0xf6)],_0xf7c166),await this['_connectionSalesforce'][_0x2846f9(0xe6)](flosum_constants_1[_0x2846f9(0xfa)][_0x2846f9(0x102)]+'/'+constants_1[_0x2846f9(0xd8)]+_0x2846f9(0xff)+this['_metadataLogId'],_0x3dd29c),this[_0x2846f9(0xd3)][_0x2846f9(0x114)](_0x2846f9(0x10d)+(_0x3d8e3f?_0x2846f9(0x104):'with\x20error')+'.'),await this['_logger'][_0x2846f9(0x11e)]();}}exports[a363_0x5500ed(0xbb)]=SnapshotService,SnapshotService[a363_0x5500ed(0x106)]=a363_0x5500ed(0xe1),SnapshotService[a363_0x5500ed(0xd5)]=a363_0x5500ed(0xba);