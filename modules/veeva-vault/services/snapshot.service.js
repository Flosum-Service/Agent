const a339_0x43173b=a339_0x364b;function a339_0x5ae2(){const _0x19865f=['createMetadataItemListWithBody','metadataLogId','base64','logError','body','../enums/status.enums','constructor','apiName','../classes/errors/salesforce-dml-error','with\x20error','\x20Metadata\x20Items','values','./package-export.service','Job_Completed__c','successfully','split','4voUOOF','log','catch','veevaComponentType','_packageExportService','../dtos/metadata-item.dto','snapshotId','updateLog','_salesforceService','FLOSUM_NAMESPACE','filter','forEach','_logger','Cannot\x20retrieve\x20','jszip','EXCEPTION','set','file','4273794cApHZt','SnapshotService','attachmentId','export','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','Snapshot__c','length','insertMultipleRecords','Is_Error__c','__esModule','label','SalesforceDmlError','_systemLogger','push','666768cWOQIQ','string','files','VeevaService','Name__c','has','59673vZFkYW','Snapshot__c/','_selectedComponentMap','lastModifiedDate','_connectionSalesforce','6666390jpAQIV','_snapshotId','retrieve','_veevaService','./salesforce.service','Is_Retrieved__c','retrieveVeevaComponents','_connectionVeeva','success','ATTACHMENT','selectedComponentMap','Label__c','Veeva_Component_Type__c','Saving\x20','__importDefault','OUTBOUND_PACKAGE_NAME','get','10vdIFWQ','_selectedMetaTypes','defineProperty','FlosumConstants','saveComponentsInSalesforce','\x20from\x20outbound\x20package','isRetrieved','ENDPOINT_UPSERT_RECORD','formAttachments','Snapshot','default','formMetadataItemDtoList','name','reduce','from','../classes/retrievers/veeva-components/type.veeva-component.retriever','type','../constants/flosum.constants','generateAsync','_timeZone','finishSnapshot','map','_attachmentLogId','2184240rwdvwj','Saving\x20Attachments.','SalesforceService','_metadataLogId','Last_Modified_Date__c','492222hDKUus','Snapshot\x20completed\x20','patch','MetadataLogStatus','2482895BMZsEk','MetadataItemDto','Metadata_Log__c/','search','Succeed__c','Metadata_Item__c','execute','attachmentLogId','Attachment_ID__c','toString','./veeva.service','errors'];a339_0x5ae2=function(){return _0x19865f;};return a339_0x5ae2();}(function(_0x4bf71d,_0x47cc4e){const _0x58bee5=a339_0x364b,_0x18e9c8=_0x4bf71d();while(!![]){try{const _0x28062c=-parseInt(_0x58bee5(0x163))/0x1+-parseInt(_0x58bee5(0x1bf))/0x2*(-parseInt(_0x58bee5(0x1a9))/0x3)+-parseInt(_0x58bee5(0x183))/0x4*(-parseInt(_0x58bee5(0x167))/0x5)+parseInt(_0x58bee5(0x1a3))/0x6+parseInt(_0x58bee5(0x195))/0x7+parseInt(_0x58bee5(0x1d6))/0x8+-parseInt(_0x58bee5(0x1ae))/0x9;if(_0x28062c===_0x47cc4e)break;else _0x18e9c8['push'](_0x18e9c8['shift']());}catch(_0x453362){_0x18e9c8['push'](_0x18e9c8['shift']());}}}(a339_0x5ae2,0x575aa));const a339_0x4d550b=(function(){let _0x5e6b73=!![];return function(_0x1ae9be,_0x189b15){const _0x429b23=_0x5e6b73?function(){if(_0x189b15){const _0x3255e0=_0x189b15['apply'](_0x1ae9be,arguments);return _0x189b15=null,_0x3255e0;}}:function(){};return _0x5e6b73=![],_0x429b23;};}()),a339_0x33ce99=a339_0x4d550b(this,function(){const _0x16a552=a339_0x364b;return a339_0x33ce99[_0x16a552(0x170)]()[_0x16a552(0x16a)]('(((.+)+)+)+$')[_0x16a552(0x170)]()[_0x16a552(0x179)](a339_0x33ce99)[_0x16a552(0x16a)]('(((.+)+)+)+$');});a339_0x33ce99();'use strict';var __importDefault=this&&this[a339_0x43173b(0x1bc)]||function(_0x542753){const _0x1c4599=a339_0x43173b;return _0x542753&&_0x542753[_0x1c4599(0x19e)]?_0x542753:{'default':_0x542753};};function a339_0x364b(_0x132dd4,_0x5b7334){const _0x22be5b=a339_0x5ae2();return a339_0x364b=function(_0x33ce99,_0x4d550b){_0x33ce99=_0x33ce99-0x15f;let _0x5ae23f=_0x22be5b[_0x33ce99];return _0x5ae23f;},a339_0x364b(_0x132dd4,_0x5b7334);}Object[a339_0x43173b(0x1c1)](exports,a339_0x43173b(0x19e),{'value':!![]}),exports[a339_0x43173b(0x196)]=void 0x0;const jszip_1=__importDefault(require(a339_0x43173b(0x191))),flosum_constants_1=require(a339_0x43173b(0x1d0)),veeva_service_1=require(a339_0x43173b(0x171)),metadata_item_dto_1=require(a339_0x43173b(0x188)),constants_1=require('../../../constants'),salesforce_service_1=require(a339_0x43173b(0x1b2)),status_enums_1=require(a339_0x43173b(0x178)),salesforce_dml_error_1=require(a339_0x43173b(0x17b)),package_export_service_1=require(a339_0x43173b(0x17f)),type_and_name_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever'),type_veeva_component_retriever_1=require(a339_0x43173b(0x1ce));class SnapshotService{constructor(_0x5745f9,_0x4bfbb4,_0x3d8e9c,_0x4ba8bc){const _0x33b4ac=a339_0x43173b;this['_connectionSalesforce']=_0x4bfbb4,this[_0x33b4ac(0x1b5)]=_0x3d8e9c,this['_logger']=_0x4ba8bc,this[_0x33b4ac(0x1af)]=_0x5745f9[_0x33b4ac(0x189)],this['_metadataLogId']=_0x5745f9[_0x33b4ac(0x174)],this[_0x33b4ac(0x1d5)]=_0x5745f9[_0x33b4ac(0x16e)],this[_0x33b4ac(0x1d2)]=_0x5745f9['timeZone'],this[_0x33b4ac(0x1c0)]=_0x5745f9['selectedMetaTypes'],this[_0x33b4ac(0x1ab)]=_0x5745f9[_0x33b4ac(0x1b8)],this['_veevaService']=new veeva_service_1[(_0x33b4ac(0x1a6))]({'connection':this['_connectionVeeva'],'logger':this[_0x33b4ac(0x18f)]}),this['_salesforceService']=new salesforce_service_1[(_0x33b4ac(0x160))]({'connection':this['_connectionSalesforce']}),this['_packageExportService']=new package_export_service_1['PackageExportService']({'veevaService':this[_0x33b4ac(0x1b1)],'connection':this[_0x33b4ac(0x1b5)],'logger':this[_0x33b4ac(0x18f)]});}async[a339_0x43173b(0x16d)](){const _0x5c8afb=a339_0x43173b;try{this['_logger']['log']('Snapshot\x20started.');const _0x46eb6a=await this[_0x5c8afb(0x1b4)]();await this[_0x5c8afb(0x18f)][_0x5c8afb(0x18a)]();const _0x12f92c=await this[_0x5c8afb(0x187)][_0x5c8afb(0x198)](_0x46eb6a,SnapshotService[_0x5c8afb(0x1bd)]);await this[_0x5c8afb(0x18f)][_0x5c8afb(0x18a)]();const _0x2f0a7b=await this[_0x5c8afb(0x173)](_0x46eb6a,_0x12f92c);await this['saveComponentsInSalesforce'](_0x2f0a7b),await this[_0x5c8afb(0x18f)]['updateLog'](),await this[_0x5c8afb(0x1d3)](!![]);}catch(_0x4f1667){this[_0x5c8afb(0x18f)]['logError'](_0x4f1667),await this['finishSnapshot'](![])[_0x5c8afb(0x185)](_0xee9d=>this[_0x5c8afb(0x1a1)]['error'](_0xee9d));}}async[a339_0x43173b(0x1b4)](){const _0x9760e9=a339_0x43173b,_0x328b38={'veevaService':this[_0x9760e9(0x1b1)],'logger':this[_0x9760e9(0x18f)]},_0x418bab=Array[_0x9760e9(0x1cd)](Object[_0x9760e9(0x17e)](this[_0x9760e9(0x1ab)]))[_0x9760e9(0x19b)]?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x9760e9(0x1ab)],..._0x328b38}):new type_veeva_component_retriever_1['TypeVeevaComponentRetriever']({'value':this[_0x9760e9(0x1c0)],..._0x328b38});return _0x418bab[_0x9760e9(0x1b0)]();}async[a339_0x43173b(0x173)](_0x10e3ea,_0x3ca10f){const _0x505702=a339_0x43173b;var _0xebdf50;this[_0x505702(0x18f)][_0x505702(0x184)](_0x505702(0x199));const _0x5c8e32=this[_0x505702(0x1ca)](_0x10e3ea),_0xcda3eb=_0x5c8e32[_0x505702(0x1cc)]((_0x232c59,_0x3ca1ce)=>_0x232c59[_0x505702(0x193)](_0x3ca1ce[_0x505702(0x19f)],_0x3ca1ce),new Map());for(const _0x23c3a7 of _0x3ca10f){for(const _0x20d466 in _0x23c3a7[_0x505702(0x1a5)]){const _0x5e34f6=_0x20d466[_0x505702(0x182)]('/')['at'](-0x1);if(_0xcda3eb[_0x505702(0x1a8)](_0x5e34f6)){const _0x2c35dd=await((_0xebdf50=_0x23c3a7[_0x505702(0x194)](_0x20d466))===null||_0xebdf50===void 0x0?void 0x0:_0xebdf50['async'](_0x505702(0x1a4)));if(_0x2c35dd){const _0x440c4c=new jszip_1[(_0x505702(0x1c9))]();_0x440c4c['file'](_0x5e34f6,_0x2c35dd),_0xcda3eb[_0x505702(0x1be)](_0x5e34f6)[_0x505702(0x177)]=await _0x440c4c[_0x505702(0x1d1)]({'type':_0x505702(0x175)});}}}}return _0x5c8e32[_0x505702(0x18d)](_0x366fbe=>!_0x366fbe[_0x505702(0x177)])[_0x505702(0x18e)](_0x525a6a=>{const _0x49e7cc=_0x505702;this['_logger'][_0x49e7cc(0x184)](_0x49e7cc(0x190)+_0x525a6a[_0x49e7cc(0x186)]+'.'+_0x525a6a[_0x49e7cc(0x1cb)]+_0x49e7cc(0x1c4));}),_0x5c8e32[_0x505702(0x18d)](_0x5bef50=>_0x5bef50[_0x505702(0x177)]);}['formMetadataItemDtoList'](_0x360036){const _0x25a427=a339_0x43173b;return _0x360036[_0x25a427(0x1d4)](_0x496e93=>{const _0x4b0060=_0x25a427,_0x543c98=new metadata_item_dto_1[(_0x4b0060(0x168))]();return _0x543c98['name']=_0x496e93[_0x4b0060(0x1cb)],_0x543c98[_0x4b0060(0x17a)]=_0x496e93[_0x4b0060(0x1cb)],_0x543c98[_0x4b0060(0x189)]=this[_0x4b0060(0x1af)],_0x543c98[_0x4b0060(0x19f)]=_0x496e93[_0x4b0060(0x1cf)]+'.'+_0x496e93[_0x4b0060(0x1cb)]+'.mdl',_0x543c98['veevaComponentType']=_0x496e93[_0x4b0060(0x1cf)],_0x543c98[_0x4b0060(0x1ac)]=_0x496e93['lastModifiedDate'],_0x543c98[_0x4b0060(0x1c5)]=![],_0x543c98;});}async[a339_0x43173b(0x1c3)](_0x57057a){const _0x3c335e=a339_0x43173b;this[_0x3c335e(0x18f)][_0x3c335e(0x184)](_0x3c335e(0x15f)),await this['saveAttachments'](_0x57057a),this[_0x3c335e(0x18f)][_0x3c335e(0x184)](_0x3c335e(0x1bb)+_0x57057a[_0x3c335e(0x19b)]+_0x3c335e(0x17d));const _0x24d724=_0x57057a[_0x3c335e(0x1d4)](_0x96bd70=>{const _0x2aa0b6=_0x3c335e;return{[constants_1[_0x2aa0b6(0x18c)]+_0x2aa0b6(0x1a7)]:_0x96bd70['name'],[constants_1[_0x2aa0b6(0x18c)]+'API_Name__c']:_0x96bd70['apiName'],[constants_1[_0x2aa0b6(0x18c)]+_0x2aa0b6(0x19a)]:_0x96bd70['snapshotId'],[constants_1[_0x2aa0b6(0x18c)]+_0x2aa0b6(0x1b9)]:_0x96bd70[_0x2aa0b6(0x19f)],[constants_1[_0x2aa0b6(0x18c)]+_0x2aa0b6(0x1b3)]:_0x96bd70[_0x2aa0b6(0x1c5)],[constants_1['FLOSUM_NAMESPACE']+_0x2aa0b6(0x1ba)]:_0x96bd70[_0x2aa0b6(0x186)],[constants_1[_0x2aa0b6(0x18c)]+_0x2aa0b6(0x16f)]:_0x96bd70[_0x2aa0b6(0x197)],[constants_1['FLOSUM_NAMESPACE']+_0x2aa0b6(0x162)]:_0x96bd70[_0x2aa0b6(0x1ac)]};}),_0x1d98c7=await this[_0x3c335e(0x18b)][_0x3c335e(0x19c)](constants_1['FLOSUM_NAMESPACE']+_0x3c335e(0x16c),_0x24d724);let _0x4756da=!![];_0x1d98c7[_0x3c335e(0x18e)]((_0x2ea689,_0x109a18)=>{const _0x129492=_0x3c335e;this[_0x129492(0x18f)][_0x129492(0x184)](_0x129492(0x1bb)+_0x57057a[_0x109a18]['veevaComponentType']+'.'+_0x57057a[_0x109a18][_0x129492(0x1cb)]);if(!_0x2ea689['success']){_0x4756da=![];const _0x21bcf4=new salesforce_dml_error_1['SalesforceDmlError'](_0x2ea689[_0x129492(0x172)]);this[_0x129492(0x18f)][_0x129492(0x176)](_0x21bcf4);}});if(!_0x4756da)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async['saveAttachments'](_0x2ffa6b){const _0x547d77=a339_0x43173b,_0x1bc44a=this[_0x547d77(0x1c7)](_0x2ffa6b),_0x5580fd=await this[_0x547d77(0x18b)][_0x547d77(0x19c)](SnapshotService[_0x547d77(0x1b7)],_0x1bc44a),_0x2409ad=[];_0x5580fd[_0x547d77(0x18e)]((_0xb48420,_0x3a07ac)=>{const _0x3967c3=_0x547d77;_0xb48420[_0x3967c3(0x1b6)]?(_0x2ffa6b[_0x3a07ac][_0x3967c3(0x197)]=_0xb48420['id'],_0x2ffa6b[_0x3a07ac]['isRetrieved']=!![]):_0x2409ad[_0x3967c3(0x1a2)](..._0xb48420[_0x3967c3(0x172)]);});if(_0x2409ad[_0x547d77(0x19b)])throw new salesforce_dml_error_1[(_0x547d77(0x1a0))](_0x2409ad);}[a339_0x43173b(0x1c7)](_0x2b4668){const _0x56aeba=a339_0x43173b;return _0x2b4668[_0x56aeba(0x1d4)](_0x5a138b=>({'ParentId':this[_0x56aeba(0x1af)],'Name':_0x5a138b[_0x56aeba(0x186)],'ContentType':'application/zip','Body':_0x5a138b[_0x56aeba(0x177)],'Description':_0x5a138b[_0x56aeba(0x186)]}));}async['finishSnapshot'](_0x5e4410){const _0x16a900=a339_0x43173b,_0x55e699={[constants_1[_0x16a900(0x18c)]+'Is_Completed__c']:!![],[constants_1[_0x16a900(0x18c)]+_0x16a900(0x19d)]:!_0x5e4410},_0x3799b6={[constants_1[_0x16a900(0x18c)]+'Is_Error__c']:!_0x5e4410,[constants_1[_0x16a900(0x18c)]+_0x16a900(0x16b)]:_0x5e4410,[constants_1['FLOSUM_NAMESPACE']+'Status__c']:_0x5e4410?status_enums_1[_0x16a900(0x166)]['COMPLETED']:status_enums_1[_0x16a900(0x166)][_0x16a900(0x192)],[constants_1['FLOSUM_NAMESPACE']+_0x16a900(0x180)]:!![]};await this[_0x16a900(0x1ad)][_0x16a900(0x165)](flosum_constants_1[_0x16a900(0x1c2)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1['FLOSUM_NAMESPACE']+_0x16a900(0x1aa)+this[_0x16a900(0x1af)],_0x55e699),await this[_0x16a900(0x1ad)][_0x16a900(0x165)](flosum_constants_1[_0x16a900(0x1c2)][_0x16a900(0x1c6)]+'/'+constants_1[_0x16a900(0x18c)]+_0x16a900(0x169)+this[_0x16a900(0x161)],_0x3799b6),this['_logger'][_0x16a900(0x184)](_0x16a900(0x164)+(_0x5e4410?_0x16a900(0x181):_0x16a900(0x17c))+'.'),await this['_logger'][_0x16a900(0x18a)]();}}exports[a339_0x43173b(0x196)]=SnapshotService,SnapshotService[a339_0x43173b(0x1bd)]=a339_0x43173b(0x1c8),SnapshotService[a339_0x43173b(0x1b7)]='Attachment';