function a363_0x59b3(_0x3dab22,_0x25b186){const _0x1ce08c=a363_0x2fb1();return a363_0x59b3=function(_0x5d0001,_0x16a975){_0x5d0001=_0x5d0001-0x176;let _0x2fb120=_0x1ce08c[_0x5d0001];return _0x2fb120;},a363_0x59b3(_0x3dab22,_0x25b186);}const a363_0x7c1110=a363_0x59b3;(function(_0x2ecebc,_0x445afc){const _0x189f68=a363_0x59b3,_0x20b9c2=_0x2ecebc();while(!![]){try{const _0x3fe284=-parseInt(_0x189f68(0x177))/0x1*(-parseInt(_0x189f68(0x19e))/0x2)+parseInt(_0x189f68(0x198))/0x3*(parseInt(_0x189f68(0x1c6))/0x4)+-parseInt(_0x189f68(0x1c4))/0x5+-parseInt(_0x189f68(0x17d))/0x6*(-parseInt(_0x189f68(0x1a2))/0x7)+-parseInt(_0x189f68(0x186))/0x8*(parseInt(_0x189f68(0x1d6))/0x9)+-parseInt(_0x189f68(0x1a0))/0xa*(-parseInt(_0x189f68(0x1ef))/0xb)+parseInt(_0x189f68(0x1b9))/0xc*(parseInt(_0x189f68(0x1c8))/0xd);if(_0x3fe284===_0x445afc)break;else _0x20b9c2['push'](_0x20b9c2['shift']());}catch(_0x6a3a62){_0x20b9c2['push'](_0x20b9c2['shift']());}}}(a363_0x2fb1,0x23178));const a363_0x16a975=(function(){let _0x4d5b82=!![];return function(_0x57cd7b,_0x575fa3){const _0x4c32f1=_0x4d5b82?function(){const _0x3bbece=a363_0x59b3;if(_0x575fa3){const _0xc69bc7=_0x575fa3[_0x3bbece(0x1b8)](_0x57cd7b,arguments);return _0x575fa3=null,_0xc69bc7;}}:function(){};return _0x4d5b82=![],_0x4c32f1;};}()),a363_0x5d0001=a363_0x16a975(this,function(){const _0x3c679c=a363_0x59b3;return a363_0x5d0001[_0x3c679c(0x185)]()[_0x3c679c(0x1dc)]('(((.+)+)+)+$')[_0x3c679c(0x185)]()[_0x3c679c(0x1f3)](a363_0x5d0001)['search'](_0x3c679c(0x194));});a363_0x5d0001();'use strict';function a363_0x2fb1(){const _0x4cfece=['name','updateLog','apply','2424sexJFP','Attachment_ID__c','MetadataItemDto','Saving\x20','Attachment','forEach','../enums/status.enums','path','API_Name__c','join','retrieveVeevaComponents','809975FilCbQ','EXCEPTION','1436FqsjLa','_packageExportService','9074tpbpFM','default','successfully','base64','__esModule','Snapshot','TypeAndNameVeevaComponentRetriever','__importDefault','_salesforceService','values','apiName','generateAsync','reduce','Cannot\x20retrieve\x20','742725bWwxPB','body','MetadataLogStatus','parse','log','lastModifiedDate','search','retrieve','catch','get','Snapshot__c','_systemLogger','Is_Completed__c','Snapshot\x20started.','Last_Modified_Date__c','\x20Metadata\x20Items','with\x20error','TypeVeevaComponentRetriever','errors','../../../constants','_timeZone','../classes/errors/salesforce-dml-error','attachmentLogId','label','FLOSUM_NAMESPACE','22qwxzRX','attachmentId','files','_connectionSalesforce','constructor','isRetrieved','string','error','FlosumConstants','patch','Is_Retrieved__c','Job_Completed__c','2539VdUjWY','logError','SnapshotService','Metadata_Item__c','../constants/flosum.constants','createMetadataItemListWithBody','68274icOibf','map','snapshotId','set','selectedComponentMap','csv-parse/sync','_snapshotId','Is_Error__c','toString','16ajzZjo','filter','type','saveAttachments','timeZone','Name__c','_veevaService','../constants/veeva.constants','formMetadataItemDtoList','COMPLETED','selectedMetaTypes','_logger','async','length','(((.+)+)+)+$','file','SalesforceDmlError','DEPENDENCY_EXTENSION','867uxDJNv','VeevaConstants','application/zip','_selectedMetaTypes','finishSnapshot','SalesforceService','10RANZqo','success','896010qeSAeV','csv-stringify/sync','21zsUEai','formAttachments','Veeva_Component_Type__c','ENDPOINT_UPSERT_RECORD','_connectionVeeva','Saving\x20Attachments.','veevaComponentType','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','Snapshot\x20completed\x20','_metadataLogId','_selectedComponentMap','VeevaService','insertMultipleRecords','Succeed__c','has','transformDependencyFile','Label__c','saveComponentsInSalesforce','export','OUTBOUND_PACKAGE_NAME'];a363_0x2fb1=function(){return _0x4cfece;};return a363_0x2fb1();}var __importDefault=this&&this[a363_0x7c1110(0x1cf)]||function(_0x54bb06){const _0x44c3ca=a363_0x7c1110;return _0x54bb06&&_0x54bb06[_0x44c3ca(0x1cc)]?_0x54bb06:{'default':_0x54bb06};};Object['defineProperty'](exports,a363_0x7c1110(0x1cc),{'value':!![]}),exports[a363_0x7c1110(0x179)]=void 0x0;const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require(a363_0x7c1110(0x17b)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a363_0x7c1110(0x1e9)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a363_0x7c1110(0x1bf)),salesforce_dml_error_1=require(a363_0x7c1110(0x1eb)),package_export_service_1=require('./package-export.service'),type_and_name_veeva_component_retriever_1=require(a363_0x7c1110(0x1a9)),type_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type.veeva-component.retriever'),sync_1=require(a363_0x7c1110(0x182)),sync_2=require(a363_0x7c1110(0x1a1)),veeva_constants_1=require(a363_0x7c1110(0x18d)),path_1=__importDefault(require(a363_0x7c1110(0x1c0)));class SnapshotService{constructor(_0x37e39f,_0x2d9046,_0x5de53d,_0x4b29aa){const _0x331d32=a363_0x7c1110;this['_connectionSalesforce']=_0x2d9046,this[_0x331d32(0x1a6)]=_0x5de53d,this[_0x331d32(0x191)]=_0x4b29aa,this['_snapshotId']=_0x37e39f['snapshotId'],this[_0x331d32(0x1ab)]=_0x37e39f['metadataLogId'],this['_attachmentLogId']=_0x37e39f[_0x331d32(0x1ec)],this[_0x331d32(0x1ea)]=_0x37e39f[_0x331d32(0x18a)],this['_selectedMetaTypes']=_0x37e39f[_0x331d32(0x190)],this[_0x331d32(0x1ac)]=_0x37e39f[_0x331d32(0x181)],this[_0x331d32(0x18c)]=new veeva_service_1[(_0x331d32(0x1ad))]({'connection':this[_0x331d32(0x1a6)],'logger':this[_0x331d32(0x191)]}),this[_0x331d32(0x1d0)]=new salesforce_service_1[(_0x331d32(0x19d))]({'connection':this['_connectionSalesforce']}),this[_0x331d32(0x1c7)]=new package_export_service_1['PackageExportService']({'veevaService':this[_0x331d32(0x18c)],'connection':this['_connectionVeeva'],'logger':this['_logger']});}async['execute'](){const _0x5f53d5=a363_0x7c1110;try{this[_0x5f53d5(0x191)][_0x5f53d5(0x1da)](_0x5f53d5(0x1e3));const _0x72911=await this['retrieveVeevaComponents']();await this[_0x5f53d5(0x191)][_0x5f53d5(0x1b7)]();const _0x363941=await this[_0x5f53d5(0x1c7)][_0x5f53d5(0x1b4)](_0x72911,SnapshotService[_0x5f53d5(0x1b5)]);await this['_logger'][_0x5f53d5(0x1b7)]();const _0x5f8f1d=await this[_0x5f53d5(0x17c)](_0x72911,_0x363941);await this[_0x5f53d5(0x1b3)](_0x5f8f1d),await this[_0x5f53d5(0x191)][_0x5f53d5(0x1b7)](),await this[_0x5f53d5(0x19c)](!![]);}catch(_0x1fe4bd){this[_0x5f53d5(0x191)][_0x5f53d5(0x178)](_0x1fe4bd),await this['finishSnapshot'](![])[_0x5f53d5(0x1de)](_0x1fceac=>this[_0x5f53d5(0x1e1)][_0x5f53d5(0x1f6)](_0x1fceac));}}async[a363_0x7c1110(0x1c3)](){const _0x39d78c=a363_0x7c1110,_0xca8be3={'veevaService':this[_0x39d78c(0x18c)],'logger':this['_logger']},_0x18e291=Array['from'](Object[_0x39d78c(0x1d1)](this[_0x39d78c(0x1ac)]))[_0x39d78c(0x193)]?new type_and_name_veeva_component_retriever_1[(_0x39d78c(0x1ce))]({'value':this[_0x39d78c(0x1ac)],..._0xca8be3}):new type_veeva_component_retriever_1[(_0x39d78c(0x1e7))]({'value':this[_0x39d78c(0x19b)],..._0xca8be3});return _0x18e291[_0x39d78c(0x1dd)]();}async[a363_0x7c1110(0x17c)](_0x492885,_0xfee773){const _0x183448=a363_0x7c1110;var _0x2701fe,_0x51cdbf;this['_logger'][_0x183448(0x1da)]('Unpack\x20zip\x20and\x20create\x20metadata\x20items.');const _0x14acab=this[_0x183448(0x18e)](_0x492885),_0x5069a2=_0x14acab[_0x183448(0x1d4)]((_0x2ce006,_0x4554c2)=>_0x2ce006[_0x183448(0x180)](_0x4554c2[_0x183448(0x1ed)],_0x4554c2),new Map());for(const _0x40cff9 of _0xfee773){for(const _0x3d76ee in _0x40cff9[_0x183448(0x1f1)]){const {base:_0x1a949d,name:_0x24f50b,dir:_0x470c8c}=path_1['default'][_0x183448(0x1d9)](_0x3d76ee),_0x2aad6d=_0x24f50b+veeva_constants_1[_0x183448(0x199)][_0x183448(0x197)];if(_0x5069a2[_0x183448(0x1b0)](_0x1a949d)){const _0x196c84=await((_0x2701fe=_0x40cff9[_0x183448(0x195)](path_1[_0x183448(0x1c9)][_0x183448(0x1c2)](_0x470c8c,_0x1a949d)))===null||_0x2701fe===void 0x0?void 0x0:_0x2701fe[_0x183448(0x192)](_0x183448(0x1f5))),_0x2001e3=await((_0x51cdbf=_0x40cff9[_0x183448(0x195)](path_1['default'][_0x183448(0x1c2)](_0x470c8c,_0x2aad6d)))===null||_0x51cdbf===void 0x0?void 0x0:_0x51cdbf[_0x183448(0x192)](_0x183448(0x1f5)));if(_0x196c84&&_0x2001e3){const _0x5858c2=new jszip_1[(_0x183448(0x1c9))]();_0x5858c2[_0x183448(0x195)](_0x1a949d,_0x196c84),_0x5858c2['file'](_0x2aad6d,this[_0x183448(0x1b1)](_0x2001e3)),_0x5069a2[_0x183448(0x1df)](_0x1a949d)[_0x183448(0x1d7)]=await _0x5858c2[_0x183448(0x1d3)]({'type':_0x183448(0x1cb)});}}}}return _0x14acab[_0x183448(0x187)](_0x413d71=>!_0x413d71['body'])[_0x183448(0x1be)](_0x428736=>{const _0x496c9b=_0x183448;this[_0x496c9b(0x191)]['log'](_0x496c9b(0x1d5)+_0x428736['veevaComponentType']+'.'+_0x428736[_0x496c9b(0x1b6)]+'\x20from\x20outbound\x20package');}),_0x14acab[_0x183448(0x187)](_0x2c3975=>_0x2c3975['body']);}[a363_0x7c1110(0x1b1)](_0xab799b){const _0x3e9c6e=a363_0x7c1110,_0xe46d30=(0x0,sync_1[_0x3e9c6e(0x1d9)])(_0xab799b,{'columns':!![],'skip_empty_lines':!![]}),_0x415efb=_0xe46d30[_0x3e9c6e(0x17e)](({'In\x20Package':_0x756bcd,..._0x45805e})=>_0x45805e);return(0x0,sync_2['stringify'])(_0x415efb,{'header':!![]});}[a363_0x7c1110(0x18e)](_0x2076ae){return _0x2076ae['map'](_0x4da673=>{const _0x24e139=a363_0x59b3,_0x275e75=new metadata_item_dto_1[(_0x24e139(0x1bb))]();return _0x275e75[_0x24e139(0x1b6)]=_0x4da673[_0x24e139(0x1b6)],_0x275e75['apiName']=_0x4da673['name'],_0x275e75['snapshotId']=this[_0x24e139(0x183)],_0x275e75[_0x24e139(0x1ed)]=_0x4da673[_0x24e139(0x188)]+'.'+_0x4da673[_0x24e139(0x1b6)]+veeva_constants_1[_0x24e139(0x199)]['MDL_EXTENSION'],_0x275e75[_0x24e139(0x1a8)]=_0x4da673['type'],_0x275e75[_0x24e139(0x1db)]=_0x4da673['lastModifiedDate'],_0x275e75[_0x24e139(0x1f4)]=![],_0x275e75;});}async['saveComponentsInSalesforce'](_0x2d213){const _0x1181ac=a363_0x7c1110;this[_0x1181ac(0x191)][_0x1181ac(0x1da)](_0x1181ac(0x1a7)),await this['saveAttachments'](_0x2d213),this[_0x1181ac(0x191)][_0x1181ac(0x1da)](_0x1181ac(0x1bc)+_0x2d213[_0x1181ac(0x193)]+_0x1181ac(0x1e5));const _0x335a47=_0x2d213['map'](_0x160361=>{const _0x4ae17f=_0x1181ac;return{[constants_1[_0x4ae17f(0x1ee)]+_0x4ae17f(0x18b)]:_0x160361[_0x4ae17f(0x1b6)],[constants_1['FLOSUM_NAMESPACE']+_0x4ae17f(0x1c1)]:_0x160361[_0x4ae17f(0x1d2)],[constants_1['FLOSUM_NAMESPACE']+_0x4ae17f(0x1e0)]:_0x160361[_0x4ae17f(0x17f)],[constants_1['FLOSUM_NAMESPACE']+_0x4ae17f(0x1b2)]:_0x160361[_0x4ae17f(0x1ed)],[constants_1[_0x4ae17f(0x1ee)]+_0x4ae17f(0x1f9)]:_0x160361[_0x4ae17f(0x1f4)],[constants_1[_0x4ae17f(0x1ee)]+_0x4ae17f(0x1a4)]:_0x160361[_0x4ae17f(0x1a8)],[constants_1[_0x4ae17f(0x1ee)]+_0x4ae17f(0x1ba)]:_0x160361[_0x4ae17f(0x1f0)],[constants_1[_0x4ae17f(0x1ee)]+_0x4ae17f(0x1e4)]:_0x160361['lastModifiedDate']};}),_0x34aa05=await this['_salesforceService'][_0x1181ac(0x1ae)](constants_1[_0x1181ac(0x1ee)]+_0x1181ac(0x17a),_0x335a47);let _0x2bbd0f=!![];_0x34aa05[_0x1181ac(0x1be)]((_0x2e4503,_0x302667)=>{const _0x11ba9f=_0x1181ac;this[_0x11ba9f(0x191)][_0x11ba9f(0x1da)]('Saving\x20'+_0x2d213[_0x302667][_0x11ba9f(0x1a8)]+'.'+_0x2d213[_0x302667][_0x11ba9f(0x1b6)]);if(!_0x2e4503[_0x11ba9f(0x19f)]){_0x2bbd0f=![];const _0x504b38=new salesforce_dml_error_1[(_0x11ba9f(0x196))](_0x2e4503[_0x11ba9f(0x1e8)]);this[_0x11ba9f(0x191)][_0x11ba9f(0x178)](_0x504b38);}});if(!_0x2bbd0f)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async[a363_0x7c1110(0x189)](_0x2257a2){const _0x50d52f=a363_0x7c1110,_0xa1f261=this['formAttachments'](_0x2257a2),_0x3e8cb0=await this[_0x50d52f(0x1d0)]['insertMultipleRecords'](SnapshotService['ATTACHMENT'],_0xa1f261),_0x3b41e9=[];_0x3e8cb0['forEach']((_0x2c7a82,_0x2951c1)=>{const _0xec4bcf=_0x50d52f;_0x2c7a82[_0xec4bcf(0x19f)]?(_0x2257a2[_0x2951c1]['attachmentId']=_0x2c7a82['id'],_0x2257a2[_0x2951c1][_0xec4bcf(0x1f4)]=!![]):_0x3b41e9['push'](..._0x2c7a82[_0xec4bcf(0x1e8)]);});if(_0x3b41e9[_0x50d52f(0x193)])throw new salesforce_dml_error_1[(_0x50d52f(0x196))](_0x3b41e9);}[a363_0x7c1110(0x1a3)](_0x374cad){const _0x4288d7=a363_0x7c1110;return _0x374cad[_0x4288d7(0x17e)](_0x5746a1=>({'ParentId':this[_0x4288d7(0x183)],'Name':_0x5746a1[_0x4288d7(0x1a8)],'ContentType':_0x4288d7(0x19a),'Body':_0x5746a1[_0x4288d7(0x1d7)],'Description':_0x5746a1[_0x4288d7(0x1a8)]}));}async[a363_0x7c1110(0x19c)](_0x5bb3f9){const _0x2e3372=a363_0x7c1110,_0x27ced4={[constants_1[_0x2e3372(0x1ee)]+_0x2e3372(0x1e2)]:!![],[constants_1[_0x2e3372(0x1ee)]+_0x2e3372(0x184)]:!_0x5bb3f9},_0x3a3e1d={[constants_1[_0x2e3372(0x1ee)]+_0x2e3372(0x184)]:!_0x5bb3f9,[constants_1['FLOSUM_NAMESPACE']+_0x2e3372(0x1af)]:_0x5bb3f9,[constants_1[_0x2e3372(0x1ee)]+'Status__c']:_0x5bb3f9?status_enums_1['MetadataLogStatus'][_0x2e3372(0x18f)]:status_enums_1[_0x2e3372(0x1d8)][_0x2e3372(0x1c5)],[constants_1[_0x2e3372(0x1ee)]+_0x2e3372(0x176)]:!![]};await this[_0x2e3372(0x1f2)]['patch'](flosum_constants_1[_0x2e3372(0x1f7)][_0x2e3372(0x1a5)]+'/'+constants_1[_0x2e3372(0x1ee)]+'Snapshot__c/'+this[_0x2e3372(0x183)],_0x27ced4),await this[_0x2e3372(0x1f2)][_0x2e3372(0x1f8)](flosum_constants_1['FlosumConstants']['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x2e3372(0x1ee)]+'Metadata_Log__c/'+this[_0x2e3372(0x1ab)],_0x3a3e1d),this[_0x2e3372(0x191)]['log'](_0x2e3372(0x1aa)+(_0x5bb3f9?_0x2e3372(0x1ca):_0x2e3372(0x1e6))+'.'),await this['_logger']['updateLog']();}}exports['SnapshotService']=SnapshotService,SnapshotService[a363_0x7c1110(0x1b5)]=a363_0x7c1110(0x1cd),SnapshotService['ATTACHMENT']=a363_0x7c1110(0x1bd);