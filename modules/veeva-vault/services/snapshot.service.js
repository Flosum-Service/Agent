function a339_0x4b8d(){const _0x5e8634=['apiName','logError','createMetadataItemListWithBody','__esModule','saveComponentsInSalesforce','Job_Completed__c','insertMultipleRecords','Last_Modified_Date__c','files','split','\x20Metadata\x20Items','application/zip','async','attachmentLogId','Snapshot__c','FlosumConstants','retrieve','push','VeevaService','retrieveVeevaComponents','map','191225ONVPLf','has','type','Is_Error__c','file','attachmentId','_systemLogger','success','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','Name__c','FLOSUM_NAMESPACE','_logger','filter','Saving\x20','Snapshot\x20completed\x20','selectedComponentMap','snapshotId','forEach','(((.+)+)+)+$','./salesforce.service','values','../enums/status.enums','error','_connectionSalesforce','_snapshotId','formAttachments','log','6928tBeamj','_metadataLogId','_veevaService','saveAttachments','\x20from\x20outbound\x20package','_attachmentLogId','MetadataLogStatus','Cannot\x20retrieve\x20','252824tQxGnL','_salesforceService','constructor','Attachment','Is_Retrieved__c','../classes/errors/salesforce-dml-error','SnapshotService','./package-export.service','label','TypeVeevaComponentRetriever','successfully','4298xYlWbC','veevaComponentType','reduce','isRetrieved','44RBQfTF','metadataLogId','body','MetadataItemDto','export','_selectedComponentMap','jszip','timeZone','Saving\x20Attachments.','Succeed__c','Status__c','errors','TypeAndNameVeevaComponentRetriever','../classes/retrievers/veeva-components/type.veeva-component.retriever','patch','_connectionVeeva','with\x20error','353754BMNRVt','_packageExportService','PackageExportService','updateLog','SalesforceDmlError','search','execute','Label__c','ATTACHMENT','721128UUbpho','finishSnapshot','../constants/flosum.constants','COMPLETED','base64','Snapshot__c/','22IVRMXE','formMetadataItemDtoList','1794990ocmBHI','Metadata_Item__c','lastModifiedDate','toString','4jcqxiB','name','OUTBOUND_PACKAGE_NAME','_selectedMetaTypes','catch','Attachment_ID__c','.mdl','2284518gmTRxQ','Veeva_Component_Type__c','length','generateAsync','default','API_Name__c','EXCEPTION','Metadata_Log__c/','apply','set','../../../constants','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever'];a339_0x4b8d=function(){return _0x5e8634;};return a339_0x4b8d();}function a339_0x4fb3(_0x1134c3,_0x5e370a){const _0x548071=a339_0x4b8d();return a339_0x4fb3=function(_0x844523,_0x4c45a3){_0x844523=_0x844523-0x7b;let _0x4b8dc5=_0x548071[_0x844523];return _0x4b8dc5;},a339_0x4fb3(_0x1134c3,_0x5e370a);}const a339_0xc9b647=a339_0x4fb3;(function(_0x8a0616,_0x5b29c5){const _0x34470b=a339_0x4fb3,_0x5ccdc3=_0x8a0616();while(!![]){try{const _0xf099f8=-parseInt(_0x34470b(0xbf))/0x1*(parseInt(_0x34470b(0xf4))/0x2)+-parseInt(_0x34470b(0xe8))/0x3+-parseInt(_0x34470b(0xce))/0x4*(-parseInt(_0x34470b(0x9c))/0x5)+parseInt(_0x34470b(0x7b))/0x6+-parseInt(_0x34470b(0xca))/0x7*(-parseInt(_0x34470b(0xb7))/0x8)+parseInt(_0x34470b(0xdf))/0x9+parseInt(_0x34470b(0xf0))/0xa*(-parseInt(_0x34470b(0xee))/0xb);if(_0xf099f8===_0x5b29c5)break;else _0x5ccdc3['push'](_0x5ccdc3['shift']());}catch(_0x5b4737){_0x5ccdc3['push'](_0x5ccdc3['shift']());}}}(a339_0x4b8d,0x414c0));const a339_0x4c45a3=(function(){let _0x358934=!![];return function(_0x1e59e3,_0x3d4caa){const _0x5aecc4=_0x358934?function(){const _0x33b813=a339_0x4fb3;if(_0x3d4caa){const _0x186813=_0x3d4caa[_0x33b813(0x83)](_0x1e59e3,arguments);return _0x3d4caa=null,_0x186813;}}:function(){};return _0x358934=![],_0x5aecc4;};}()),a339_0x844523=a339_0x4c45a3(this,function(){const _0x974b21=a339_0x4fb3;return a339_0x844523[_0x974b21(0xf3)]()[_0x974b21(0xe4)](_0x974b21(0xae))[_0x974b21(0xf3)]()[_0x974b21(0xc1)](a339_0x844523)[_0x974b21(0xe4)](_0x974b21(0xae));});a339_0x844523();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x36f2e5){const _0xfa5347=a339_0x4fb3;return _0x36f2e5&&_0x36f2e5[_0xfa5347(0x8a)]?_0x36f2e5:{'default':_0x36f2e5};};Object['defineProperty'](exports,a339_0xc9b647(0x8a),{'value':!![]}),exports[a339_0xc9b647(0xc5)]=void 0x0;const jszip_1=__importDefault(require(a339_0xc9b647(0xd4))),flosum_constants_1=require(a339_0xc9b647(0xea)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a339_0xc9b647(0x85)),salesforce_service_1=require(a339_0xc9b647(0xaf)),status_enums_1=require(a339_0xc9b647(0xb1)),salesforce_dml_error_1=require(a339_0xc9b647(0xc4)),package_export_service_1=require(a339_0xc9b647(0xc6)),type_and_name_veeva_component_retriever_1=require(a339_0xc9b647(0x86)),type_veeva_component_retriever_1=require(a339_0xc9b647(0xdb));class SnapshotService{constructor(_0x5199eb,_0x44ab2c,_0x3ebec8,_0xb3195f){const _0x270d29=a339_0xc9b647;this[_0x270d29(0xb3)]=_0x44ab2c,this[_0x270d29(0xdd)]=_0x3ebec8,this[_0x270d29(0xa7)]=_0xb3195f,this[_0x270d29(0xb4)]=_0x5199eb['snapshotId'],this['_metadataLogId']=_0x5199eb[_0x270d29(0xcf)],this[_0x270d29(0xbc)]=_0x5199eb[_0x270d29(0x94)],this['_timeZone']=_0x5199eb[_0x270d29(0xd5)],this[_0x270d29(0xf7)]=_0x5199eb['selectedMetaTypes'],this[_0x270d29(0xd3)]=_0x5199eb[_0x270d29(0xab)],this[_0x270d29(0xb9)]=new veeva_service_1[(_0x270d29(0x99))]({'connection':this[_0x270d29(0xdd)],'logger':this[_0x270d29(0xa7)]}),this[_0x270d29(0xc0)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x270d29(0xb3)]}),this[_0x270d29(0xe0)]=new package_export_service_1[(_0x270d29(0xe1))]({'veevaService':this[_0x270d29(0xb9)],'connection':this[_0x270d29(0xdd)],'logger':this[_0x270d29(0xa7)]});}async[a339_0xc9b647(0xe5)](){const _0x4d2b87=a339_0xc9b647;try{this['_logger'][_0x4d2b87(0xb6)]('Snapshot\x20started.');const _0x2bd97e=await this[_0x4d2b87(0x9a)]();await this[_0x4d2b87(0xa7)][_0x4d2b87(0xe2)]();const _0x488aa8=await this[_0x4d2b87(0xe0)][_0x4d2b87(0xd2)](_0x2bd97e,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this[_0x4d2b87(0xa7)][_0x4d2b87(0xe2)]();const _0x3c9579=await this[_0x4d2b87(0x89)](_0x2bd97e,_0x488aa8);await this[_0x4d2b87(0x8b)](_0x3c9579),await this[_0x4d2b87(0xa7)]['updateLog'](),await this['finishSnapshot'](!![]);}catch(_0x167688){this[_0x4d2b87(0xa7)][_0x4d2b87(0x88)](_0x167688),await this[_0x4d2b87(0xe9)](![])[_0x4d2b87(0xf8)](_0x2761d6=>this[_0x4d2b87(0xa2)][_0x4d2b87(0xb2)](_0x2761d6));}}async[a339_0xc9b647(0x9a)](){const _0x2f899d=a339_0xc9b647,_0x2767d3={'veevaService':this['_veevaService'],'logger':this[_0x2f899d(0xa7)]},_0x7f99e2=Array['from'](Object[_0x2f899d(0xb0)](this[_0x2f899d(0xd3)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x2f899d(0xda))]({'value':this[_0x2f899d(0xd3)],..._0x2767d3}):new type_veeva_component_retriever_1[(_0x2f899d(0xc8))]({'value':this[_0x2f899d(0xf7)],..._0x2767d3});return _0x7f99e2[_0x2f899d(0x97)]();}async[a339_0xc9b647(0x89)](_0x1858c4,_0x4bfdcb){const _0x51deba=a339_0xc9b647;var _0x577f28;this['_logger'][_0x51deba(0xb6)](_0x51deba(0xa4));const _0x13d676=this[_0x51deba(0xef)](_0x1858c4),_0x29c55e=_0x13d676[_0x51deba(0xcc)]((_0x55744c,_0xf317d7)=>_0x55744c[_0x51deba(0x84)](_0xf317d7['label'],_0xf317d7),new Map());for(const _0x52dddc of _0x4bfdcb){for(const _0x3566d3 in _0x52dddc[_0x51deba(0x8f)]){const _0x27db34=_0x3566d3[_0x51deba(0x90)]('/')['at'](-0x1);if(_0x29c55e[_0x51deba(0x9d)](_0x27db34)){const _0x272aa0=await((_0x577f28=_0x52dddc[_0x51deba(0xa0)](_0x3566d3))===null||_0x577f28===void 0x0?void 0x0:_0x577f28[_0x51deba(0x93)]('string'));if(_0x272aa0){const _0x32030a=new jszip_1[(_0x51deba(0x7f))]();_0x32030a[_0x51deba(0xa0)](_0x27db34,_0x272aa0),_0x29c55e['get'](_0x27db34)[_0x51deba(0xd0)]=await _0x32030a[_0x51deba(0x7e)]({'type':_0x51deba(0xec)});}}}}return _0x13d676['filter'](_0x2f0faa=>!_0x2f0faa[_0x51deba(0xd0)])[_0x51deba(0xad)](_0x148347=>{const _0x23ea12=_0x51deba;this[_0x23ea12(0xa7)][_0x23ea12(0xb6)](_0x23ea12(0xbe)+_0x148347[_0x23ea12(0xcb)]+'.'+_0x148347[_0x23ea12(0xf5)]+_0x23ea12(0xbb));}),_0x13d676[_0x51deba(0xa8)](_0x21c345=>_0x21c345['body']);}[a339_0xc9b647(0xef)](_0x5c70b0){const _0x44dc06=a339_0xc9b647;return _0x5c70b0[_0x44dc06(0x9b)](_0x2e2e5a=>{const _0x4dae78=_0x44dc06,_0x2bd64d=new metadata_item_dto_1[(_0x4dae78(0xd1))]();return _0x2bd64d[_0x4dae78(0xf5)]=_0x2e2e5a['name'],_0x2bd64d[_0x4dae78(0x87)]=_0x2e2e5a[_0x4dae78(0xf5)],_0x2bd64d[_0x4dae78(0xac)]=this[_0x4dae78(0xb4)],_0x2bd64d[_0x4dae78(0xc7)]=_0x2e2e5a[_0x4dae78(0x9e)]+'.'+_0x2e2e5a[_0x4dae78(0xf5)]+_0x4dae78(0xfa),_0x2bd64d[_0x4dae78(0xcb)]=_0x2e2e5a[_0x4dae78(0x9e)],_0x2bd64d[_0x4dae78(0xf2)]=_0x2e2e5a[_0x4dae78(0xf2)],_0x2bd64d[_0x4dae78(0xcd)]=![],_0x2bd64d;});}async[a339_0xc9b647(0x8b)](_0x12e9e0){const _0x549d35=a339_0xc9b647;this[_0x549d35(0xa7)][_0x549d35(0xb6)](_0x549d35(0xd6)),await this[_0x549d35(0xba)](_0x12e9e0),this[_0x549d35(0xa7)]['log'](_0x549d35(0xa9)+_0x12e9e0[_0x549d35(0x7d)]+_0x549d35(0x91));const _0x229d99=_0x12e9e0[_0x549d35(0x9b)](_0x16f48d=>{const _0x2058d4=_0x549d35;return{[constants_1[_0x2058d4(0xa6)]+_0x2058d4(0xa5)]:_0x16f48d[_0x2058d4(0xf5)],[constants_1['FLOSUM_NAMESPACE']+_0x2058d4(0x80)]:_0x16f48d[_0x2058d4(0x87)],[constants_1[_0x2058d4(0xa6)]+_0x2058d4(0x95)]:_0x16f48d[_0x2058d4(0xac)],[constants_1[_0x2058d4(0xa6)]+_0x2058d4(0xe6)]:_0x16f48d[_0x2058d4(0xc7)],[constants_1[_0x2058d4(0xa6)]+_0x2058d4(0xc3)]:_0x16f48d['isRetrieved'],[constants_1[_0x2058d4(0xa6)]+_0x2058d4(0x7c)]:_0x16f48d['veevaComponentType'],[constants_1['FLOSUM_NAMESPACE']+_0x2058d4(0xf9)]:_0x16f48d['attachmentId'],[constants_1[_0x2058d4(0xa6)]+_0x2058d4(0x8e)]:_0x16f48d[_0x2058d4(0xf2)]};}),_0x2d5c8d=await this['_salesforceService'][_0x549d35(0x8d)](constants_1['FLOSUM_NAMESPACE']+_0x549d35(0xf1),_0x229d99);let _0x171d88=!![];_0x2d5c8d[_0x549d35(0xad)]((_0x4d4746,_0x10e138)=>{const _0x26d2e4=_0x549d35;this[_0x26d2e4(0xa7)]['log'](_0x26d2e4(0xa9)+_0x12e9e0[_0x10e138][_0x26d2e4(0xcb)]+'.'+_0x12e9e0[_0x10e138][_0x26d2e4(0xf5)]);if(!_0x4d4746['success']){_0x171d88=![];const _0x319ea5=new salesforce_dml_error_1[(_0x26d2e4(0xe3))](_0x4d4746[_0x26d2e4(0xd9)]);this[_0x26d2e4(0xa7)][_0x26d2e4(0x88)](_0x319ea5);}});if(!_0x171d88)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async[a339_0xc9b647(0xba)](_0x3f3664){const _0x332224=a339_0xc9b647,_0x2809a8=this[_0x332224(0xb5)](_0x3f3664),_0x84b058=await this[_0x332224(0xc0)][_0x332224(0x8d)](SnapshotService[_0x332224(0xe7)],_0x2809a8),_0x327348=[];_0x84b058[_0x332224(0xad)]((_0x3b235d,_0x4c0d49)=>{const _0x4c916e=_0x332224;_0x3b235d[_0x4c916e(0xa3)]?(_0x3f3664[_0x4c0d49][_0x4c916e(0xa1)]=_0x3b235d['id'],_0x3f3664[_0x4c0d49][_0x4c916e(0xcd)]=!![]):_0x327348[_0x4c916e(0x98)](..._0x3b235d[_0x4c916e(0xd9)]);});if(_0x327348[_0x332224(0x7d)])throw new salesforce_dml_error_1[(_0x332224(0xe3))](_0x327348);}[a339_0xc9b647(0xb5)](_0x12eb7c){const _0x4534be=a339_0xc9b647;return _0x12eb7c[_0x4534be(0x9b)](_0x43704b=>({'ParentId':this[_0x4534be(0xb4)],'Name':_0x43704b[_0x4534be(0xcb)],'ContentType':_0x4534be(0x92),'Body':_0x43704b[_0x4534be(0xd0)],'Description':_0x43704b[_0x4534be(0xcb)]}));}async['finishSnapshot'](_0x160e66){const _0x1f6f2c=a339_0xc9b647,_0x1bf13b={[constants_1[_0x1f6f2c(0xa6)]+'Is_Completed__c']:!![],[constants_1['FLOSUM_NAMESPACE']+_0x1f6f2c(0x9f)]:!_0x160e66},_0x3a08e2={[constants_1[_0x1f6f2c(0xa6)]+_0x1f6f2c(0x9f)]:!_0x160e66,[constants_1[_0x1f6f2c(0xa6)]+_0x1f6f2c(0xd7)]:_0x160e66,[constants_1['FLOSUM_NAMESPACE']+_0x1f6f2c(0xd8)]:_0x160e66?status_enums_1[_0x1f6f2c(0xbd)][_0x1f6f2c(0xeb)]:status_enums_1[_0x1f6f2c(0xbd)][_0x1f6f2c(0x81)],[constants_1['FLOSUM_NAMESPACE']+_0x1f6f2c(0x8c)]:!![]};await this[_0x1f6f2c(0xb3)][_0x1f6f2c(0xdc)](flosum_constants_1['FlosumConstants']['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x1f6f2c(0xa6)]+_0x1f6f2c(0xed)+this[_0x1f6f2c(0xb4)],_0x1bf13b),await this[_0x1f6f2c(0xb3)][_0x1f6f2c(0xdc)](flosum_constants_1[_0x1f6f2c(0x96)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1['FLOSUM_NAMESPACE']+_0x1f6f2c(0x82)+this[_0x1f6f2c(0xb8)],_0x3a08e2),this['_logger']['log'](_0x1f6f2c(0xaa)+(_0x160e66?_0x1f6f2c(0xc9):_0x1f6f2c(0xde))+'.'),await this['_logger'][_0x1f6f2c(0xe2)]();}}exports[a339_0xc9b647(0xc5)]=SnapshotService,SnapshotService[a339_0xc9b647(0xf6)]='Snapshot',SnapshotService[a339_0xc9b647(0xe7)]=a339_0xc9b647(0xc2);