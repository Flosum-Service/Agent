const a407_0x332140=a407_0x211b;(function(_0x4b1a46,_0x43677c){const _0x33ed89=a407_0x211b,_0x31ef96=_0x4b1a46();while(!![]){try{const _0x9fc27b=parseInt(_0x33ed89(0x100))/0x1*(parseInt(_0x33ed89(0xe8))/0x2)+-parseInt(_0x33ed89(0x114))/0x3+-parseInt(_0x33ed89(0x128))/0x4+parseInt(_0x33ed89(0x105))/0x5+parseInt(_0x33ed89(0x138))/0x6+parseInt(_0x33ed89(0x11a))/0x7+-parseInt(_0x33ed89(0x106))/0x8;if(_0x9fc27b===_0x43677c)break;else _0x31ef96['push'](_0x31ef96['shift']());}catch(_0x41a814){_0x31ef96['push'](_0x31ef96['shift']());}}}(a407_0x36e0,0x46102));const a407_0x45e752=(function(){let _0x19bbfd=!![];return function(_0x9416f2,_0x271ce0){const _0x4886c6=_0x19bbfd?function(){if(_0x271ce0){const _0x3513cf=_0x271ce0['apply'](_0x9416f2,arguments);return _0x271ce0=null,_0x3513cf;}}:function(){};return _0x19bbfd=![],_0x4886c6;};}()),a407_0x2ff177=a407_0x45e752(this,function(){const _0x45b5c2=a407_0x211b;return a407_0x2ff177[_0x45b5c2(0x14f)]()['search'](_0x45b5c2(0xd7))[_0x45b5c2(0x14f)]()['constructor'](a407_0x2ff177)[_0x45b5c2(0xda)]('(((.+)+)+)+$');});a407_0x2ff177();'use strict';function a407_0x36e0(){const _0x55ec01=['forEach','Saving\x20','log','Label__c','COMPLETED','87813SUHlvJ','FLOSUM_NAMESPACE','../classes/retrievers/veeva-components/type.veeva-component.retriever','has','Cannot\x20Save\x20Metadata\x20Items','_connectionSalesforce','2278087LvgYkv','csv-stringify/sync','reduce','defineProperty','Snapshot\x20completed\x20','insertMultipleRecords','ATTACHMENT','length','Is_Error__c','../enums/status.enums','createMetadataItemListWithBody','lastModifiedDate','stringify','updateLog','1899412NHlvgQ','execute','MetadataLogStatus','FlosumConstants','Snapshot','_salesforceService','isRetrieved','Name__c','DEPENDENCY_EXTENSION','files','_systemLogger','Snapshot__c','body','SalesforceDmlError','OUTBOUND_PACKAGE_NAME','string','548436JYEHaG','../constants/flosum.constants','label','SnapshotService','TypeVeevaComponentRetriever','attachmentId','errors','veevaComponentType','sep','logError','./package-export.service','patch','Status__c','_packageExportService','with\x20error','../classes/errors/salesforce-dml-error','Metadata_Log__c/','retrieveVeevaComponents','PackageExportService','parse','saveAttachments','_selectedMetaTypes','formMetadataItemDtoList','toString','Is_Completed__c','transformDependencyFile','(((.+)+)+)+$','csv-parse/sync','file','search','Saving\x20Attachments.','Last_Modified_Date__c','ENDPOINT_UPSERT_RECORD','async','posix','\x20from\x20outbound\x20package','SalesforceService','success','name','get','jszip','_selectedComponentMap','_metadataLogId','26476DmfIgz','successfully','apiName','generateAsync','snapshotId','saveComponentsInSalesforce','retrieve','_snapshotId','type','VeevaService','API_Name__c','Attachment_ID__c','join','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','Succeed__c','Cannot\x20retrieve\x20','_logger','finishSnapshot','error','../constants/veeva.constants','../../../constants','base64','filter','Metadata_Item__c','11VsiSRv','map','__esModule','default','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','2672055uxVkvz','2446192hISRwm','_veevaService','formAttachments','_connectionVeeva','VeevaConstants','./veeva.service','_whereClause','__importDefault','\x20Metadata\x20Items'];a407_0x36e0=function(){return _0x55ec01;};return a407_0x36e0();}function a407_0x211b(_0x565599,_0x1c8850){const _0x28bbf3=a407_0x36e0();return a407_0x211b=function(_0x2ff177,_0x45e752){_0x2ff177=_0x2ff177-0xd7;let _0x36e08d=_0x28bbf3[_0x2ff177];return _0x36e08d;},a407_0x211b(_0x565599,_0x1c8850);}var __importDefault=this&&this[a407_0x332140(0x10d)]||function(_0x10d3ff){const _0x16ebd4=a407_0x332140;return _0x10d3ff&&_0x10d3ff[_0x16ebd4(0x102)]?_0x10d3ff:{'default':_0x10d3ff};};Object[a407_0x332140(0x11d)](exports,a407_0x332140(0x102),{'value':!![]}),exports['SnapshotService']=void 0x0;const jszip_1=__importDefault(require(a407_0x332140(0xe5))),flosum_constants_1=require(a407_0x332140(0x139)),veeva_service_1=require(a407_0x332140(0x10b)),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a407_0x332140(0xfc)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a407_0x332140(0x123)),salesforce_dml_error_1=require(a407_0x332140(0x147)),package_export_service_1=require(a407_0x332140(0x142)),type_and_name_veeva_component_retriever_1=require(a407_0x332140(0xf5)),type_veeva_component_retriever_1=require(a407_0x332140(0x116)),sync_1=require(a407_0x332140(0xd8)),sync_2=require(a407_0x332140(0x11b)),veeva_constants_1=require(a407_0x332140(0xfb)),path_1=__importDefault(require('path'));class SnapshotService{constructor({snapshotId:_0x8f5643,metadataLogId:_0x1e2ed4,selectedMetaTypes:_0x184ce7,selectedComponentMap:_0x2ce80f,whereClause:_0x575356},_0x378538,_0xc0f9da,_0x4b9ca0){const _0x26ff67=a407_0x332140;this[_0x26ff67(0x119)]=_0x378538,this[_0x26ff67(0x109)]=_0xc0f9da,this[_0x26ff67(0xf8)]=_0x4b9ca0,this[_0x26ff67(0xef)]=_0x8f5643,this[_0x26ff67(0xe7)]=_0x1e2ed4,this[_0x26ff67(0x14d)]=_0x184ce7,this[_0x26ff67(0xe6)]=_0x2ce80f,this[_0x26ff67(0x10c)]=_0x575356,this[_0x26ff67(0x107)]=new veeva_service_1[(_0x26ff67(0xf1))]({'connection':this['_connectionVeeva'],'logger':this[_0x26ff67(0xf8)]}),this[_0x26ff67(0x12d)]=new salesforce_service_1[(_0x26ff67(0xe1))]({'connection':this[_0x26ff67(0x119)]}),this['_packageExportService']=new package_export_service_1[(_0x26ff67(0x14a))]({'veevaService':this[_0x26ff67(0x107)],'connection':this[_0x26ff67(0x109)],'logger':this['_logger']});}async[a407_0x332140(0x129)](){const _0x15fabc=a407_0x332140;try{this['_logger'][_0x15fabc(0x111)]('Snapshot\x20started.');const _0x1f10bc=await this[_0x15fabc(0x149)]();await this[_0x15fabc(0xf8)]['updateLog']();const _0x5aad9e=await this[_0x15fabc(0x145)]['export'](_0x1f10bc,SnapshotService[_0x15fabc(0x136)]);await this[_0x15fabc(0xf8)][_0x15fabc(0x127)]();const _0x3119c8=await this[_0x15fabc(0x124)](_0x1f10bc,_0x5aad9e);await this['saveComponentsInSalesforce'](_0x3119c8),await this[_0x15fabc(0xf8)]['updateLog'](),await this['finishSnapshot'](!![]);}catch(_0x279497){this['_logger'][_0x15fabc(0x141)](_0x279497),await this[_0x15fabc(0xf9)](![])['catch'](_0x52e4ef=>this[_0x15fabc(0x132)][_0x15fabc(0xfa)](_0x52e4ef));}}async['retrieveVeevaComponents'](){const _0x449936=a407_0x332140,_0xded01a={'veevaService':this[_0x449936(0x107)],'logger':this[_0x449936(0xf8)]},_0x2e7505=Array['from'](Object['values'](this[_0x449936(0xe6)]))[_0x449936(0x121)]?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this['_selectedComponentMap'],..._0xded01a}):new type_veeva_component_retriever_1[(_0x449936(0x13c))]({'value':this[_0x449936(0x14d)],'whereClause':this['_whereClause'],..._0xded01a});return _0x2e7505[_0x449936(0xee)]();}async[a407_0x332140(0x124)](_0x54dbea,_0x2cdab3){const _0x444ff1=a407_0x332140;var _0xe4691a,_0xf3df0e;this[_0x444ff1(0xf8)][_0x444ff1(0x111)](_0x444ff1(0x104));const _0x3e2dac=this['formMetadataItemDtoList'](_0x54dbea),_0x237ec9=_0x3e2dac[_0x444ff1(0x11c)]((_0xbbc47f,_0x18c042)=>_0xbbc47f['set'](_0x18c042[_0x444ff1(0x13a)],_0x18c042),new Map());for(const _0x39fb54 of _0x2cdab3){for(const _0x38e9cb in _0x39fb54[_0x444ff1(0x131)]){const {base:_0x5c9834,name:_0xd6be5b,dir:_0x2fe128}=path_1[_0x444ff1(0x103)][_0x444ff1(0x14b)](_0x38e9cb),_0x4d4833=_0xd6be5b+veeva_constants_1[_0x444ff1(0x10a)][_0x444ff1(0x130)];if(_0x237ec9[_0x444ff1(0x117)](_0x5c9834)){const _0x5c4759=await((_0xe4691a=_0x39fb54[_0x444ff1(0xd9)]([_0x2fe128,_0x5c9834][_0x444ff1(0xf4)](path_1[_0x444ff1(0x103)]['posix'][_0x444ff1(0x140)])))===null||_0xe4691a===void 0x0?void 0x0:_0xe4691a[_0x444ff1(0xde)](_0x444ff1(0x137))),_0x5ba590=await((_0xf3df0e=_0x39fb54[_0x444ff1(0xd9)]([_0x2fe128,_0x4d4833]['join'](path_1[_0x444ff1(0x103)][_0x444ff1(0xdf)][_0x444ff1(0x140)])))===null||_0xf3df0e===void 0x0?void 0x0:_0xf3df0e[_0x444ff1(0xde)](_0x444ff1(0x137)));if(_0x5c4759){const _0x37cd10=new jszip_1['default']();_0x37cd10[_0x444ff1(0xd9)](_0x5c9834,_0x5c4759),_0x5ba590&&_0x37cd10[_0x444ff1(0xd9)](_0x4d4833,this[_0x444ff1(0x151)](_0x5ba590)),_0x237ec9[_0x444ff1(0xe4)](_0x5c9834)[_0x444ff1(0x134)]=await _0x37cd10[_0x444ff1(0xeb)]({'type':_0x444ff1(0xfd)});}}}}return _0x3e2dac[_0x444ff1(0xfe)](_0x311325=>!_0x311325[_0x444ff1(0x134)])[_0x444ff1(0x10f)](_0x124827=>{const _0x2cc5d0=_0x444ff1;this[_0x2cc5d0(0xf8)]['log'](_0x2cc5d0(0xf7)+_0x124827[_0x2cc5d0(0x13f)]+'.'+_0x124827[_0x2cc5d0(0xe3)]+_0x2cc5d0(0xe0));}),_0x3e2dac['filter'](_0xd29b77=>_0xd29b77['body']);}[a407_0x332140(0x151)](_0x8da3ae){const _0x43490c=a407_0x332140,_0x44748f=(0x0,sync_1[_0x43490c(0x14b)])(_0x8da3ae,{'columns':!![],'skip_empty_lines':!![]}),_0x1928a6=_0x44748f[_0x43490c(0x101)](({'In\x20Package':_0x1d7707,..._0x142905})=>_0x142905);return(0x0,sync_2[_0x43490c(0x126)])(_0x1928a6,{'header':!![]});}[a407_0x332140(0x14e)](_0x2341f8){const _0x41b7af=a407_0x332140;return _0x2341f8[_0x41b7af(0x101)](_0x2fa783=>{const _0x11ba08=_0x41b7af,_0x52969e=new metadata_item_dto_1['MetadataItemDto']();return _0x52969e[_0x11ba08(0xe3)]=_0x2fa783['name'],_0x52969e[_0x11ba08(0xea)]=_0x2fa783[_0x11ba08(0xe3)],_0x52969e[_0x11ba08(0xec)]=this['_snapshotId'],_0x52969e[_0x11ba08(0x13a)]=_0x2fa783[_0x11ba08(0xf0)]+'.'+_0x2fa783[_0x11ba08(0xe3)]+veeva_constants_1[_0x11ba08(0x10a)]['MDL_EXTENSION'],_0x52969e[_0x11ba08(0x13f)]=_0x2fa783[_0x11ba08(0xf0)],_0x52969e[_0x11ba08(0x125)]=_0x2fa783['lastModifiedDate'],_0x52969e[_0x11ba08(0x12e)]=![],_0x52969e;});}async[a407_0x332140(0xed)](_0x164a78){const _0x51aacf=a407_0x332140;this['_logger'][_0x51aacf(0x111)](_0x51aacf(0xdb)),await this[_0x51aacf(0x14c)](_0x164a78),this[_0x51aacf(0xf8)][_0x51aacf(0x111)](_0x51aacf(0x110)+_0x164a78['length']+_0x51aacf(0x10e));const _0x187275=_0x164a78[_0x51aacf(0x101)](_0x5ba344=>{const _0x2f9e6d=_0x51aacf;return{[constants_1['FLOSUM_NAMESPACE']+_0x2f9e6d(0x12f)]:_0x5ba344[_0x2f9e6d(0xe3)],[constants_1[_0x2f9e6d(0x115)]+_0x2f9e6d(0xf2)]:_0x5ba344[_0x2f9e6d(0xea)],[constants_1[_0x2f9e6d(0x115)]+_0x2f9e6d(0x133)]:_0x5ba344[_0x2f9e6d(0xec)],[constants_1['FLOSUM_NAMESPACE']+_0x2f9e6d(0x112)]:_0x5ba344['label'],[constants_1[_0x2f9e6d(0x115)]+'Is_Retrieved__c']:_0x5ba344[_0x2f9e6d(0x12e)],[constants_1['FLOSUM_NAMESPACE']+'Veeva_Component_Type__c']:_0x5ba344[_0x2f9e6d(0x13f)],[constants_1[_0x2f9e6d(0x115)]+_0x2f9e6d(0xf3)]:_0x5ba344[_0x2f9e6d(0x13d)],[constants_1[_0x2f9e6d(0x115)]+_0x2f9e6d(0xdc)]:_0x5ba344[_0x2f9e6d(0x125)]};}),_0x4f6b3f=await this['_salesforceService'][_0x51aacf(0x11f)](constants_1[_0x51aacf(0x115)]+_0x51aacf(0xff),_0x187275);let _0xa31b06=!![];_0x4f6b3f['forEach']((_0x79ba2,_0x40d1fb)=>{const _0x40c2a8=_0x51aacf;this['_logger']['log'](_0x40c2a8(0x110)+_0x164a78[_0x40d1fb]['veevaComponentType']+'.'+_0x164a78[_0x40d1fb]['name']);if(!_0x79ba2[_0x40c2a8(0xe2)]){_0xa31b06=![];const _0x1ad7ff=new salesforce_dml_error_1[(_0x40c2a8(0x135))](_0x79ba2[_0x40c2a8(0x13e)]);this['_logger'][_0x40c2a8(0x141)](_0x1ad7ff);}});if(!_0xa31b06)throw new Error(_0x51aacf(0x118));}async[a407_0x332140(0x14c)](_0x185125){const _0x993a3d=a407_0x332140,_0x38a02b=this[_0x993a3d(0x108)](_0x185125),_0xeacbe=await this['_salesforceService'][_0x993a3d(0x11f)](SnapshotService[_0x993a3d(0x120)],_0x38a02b),_0xc8c689=[];_0xeacbe[_0x993a3d(0x10f)]((_0x4d42bb,_0x4fda93)=>{const _0x281cc5=_0x993a3d;_0x4d42bb[_0x281cc5(0xe2)]?(_0x185125[_0x4fda93][_0x281cc5(0x13d)]=_0x4d42bb['id'],_0x185125[_0x4fda93][_0x281cc5(0x12e)]=!![]):_0xc8c689['push'](..._0x4d42bb['errors']);});if(_0xc8c689[_0x993a3d(0x121)])throw new salesforce_dml_error_1[(_0x993a3d(0x135))](_0xc8c689);}[a407_0x332140(0x108)](_0x59a57c){const _0x25b394=a407_0x332140;return _0x59a57c['map'](_0x371b07=>({'ParentId':this[_0x25b394(0xef)],'Name':_0x371b07[_0x25b394(0x13f)],'ContentType':'application/zip','Body':_0x371b07['body'],'Description':_0x371b07['veevaComponentType']}));}async[a407_0x332140(0xf9)](_0x3a5457){const _0x309f68=a407_0x332140,_0x125fcc={[constants_1['FLOSUM_NAMESPACE']+_0x309f68(0x150)]:!![],[constants_1[_0x309f68(0x115)]+'Is_Error__c']:!_0x3a5457},_0x14b5fc={[constants_1[_0x309f68(0x115)]+_0x309f68(0x122)]:!_0x3a5457,[constants_1['FLOSUM_NAMESPACE']+_0x309f68(0xf6)]:_0x3a5457,[constants_1['FLOSUM_NAMESPACE']+_0x309f68(0x144)]:_0x3a5457?status_enums_1[_0x309f68(0x12a)][_0x309f68(0x113)]:status_enums_1[_0x309f68(0x12a)]['EXCEPTION'],[constants_1[_0x309f68(0x115)]+'Job_Completed__c']:!![]};await this['_connectionSalesforce'][_0x309f68(0x143)](flosum_constants_1[_0x309f68(0x12b)][_0x309f68(0xdd)]+'/'+constants_1['FLOSUM_NAMESPACE']+'Snapshot__c/'+this[_0x309f68(0xef)],_0x125fcc),await this['_connectionSalesforce'][_0x309f68(0x143)](flosum_constants_1[_0x309f68(0x12b)][_0x309f68(0xdd)]+'/'+constants_1[_0x309f68(0x115)]+_0x309f68(0x148)+this[_0x309f68(0xe7)],_0x14b5fc),this[_0x309f68(0xf8)][_0x309f68(0x111)](_0x309f68(0x11e)+(_0x3a5457?_0x309f68(0xe9):_0x309f68(0x146))+'.'),await this[_0x309f68(0xf8)][_0x309f68(0x127)]();}}exports[a407_0x332140(0x13b)]=SnapshotService,SnapshotService['OUTBOUND_PACKAGE_NAME']=a407_0x332140(0x12c),SnapshotService[a407_0x332140(0x120)]='Attachment';