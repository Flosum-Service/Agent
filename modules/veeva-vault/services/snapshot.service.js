function a395_0x410b(){const _0x540471=['FLOSUM_NAMESPACE','updateLog','generateAsync','Metadata_Log__c/','_selectedComponentMap','MetadataLogStatus','_metadataLogId','_snapshotId','forEach','API_Name__c','filter','push','_logger','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','finishSnapshot','VeevaService','31650120HjkMQf','_systemLogger','map','logError','constructor','from','Metadata_Item__c','Succeed__c','snapshotId','jszip','apiName','formMetadataItemDtoList','MetadataItemDto','string','_connectionVeeva','Cannot\x20Save\x20Metadata\x20Items','_veevaService','log','_whereClause','_connectionSalesforce','lastModifiedDate','_packageExportService','successfully','get','body','type','298788LobQHO','Snapshot','path','1379518dzAOeu','toString','MDL_EXTENSION','files','async','veevaComponentType','Attachment','OUTBOUND_PACKAGE_NAME','6019616ZCMVTP','Cannot\x20retrieve\x20','default','Saving\x20Attachments.','saveComponentsInSalesforce','../classes/retrievers/veeva-components/type.veeva-component.retriever','FlosumConstants','114LIiIvF','isRetrieved','Saving\x20','SnapshotService','success','with\x20error','stringify','transformDependencyFile','insertMultipleRecords','name','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','Last_Modified_Date__c','(((.+)+)+)+$','posix','SalesforceDmlError','PackageExportService','__esModule','../constants/veeva.constants','saveAttachments','retrieveVeevaComponents','join','../../../constants','1401734peztnm','814014pefTAv','parse','Snapshot__c','\x20from\x20outbound\x20package','Veeva_Component_Type__c','attachmentId','_salesforceService','search','../constants/flosum.constants','ATTACHMENT','createMetadataItemListWithBody','Snapshot\x20completed\x20','retrieve','Status__c','_selectedMetaTypes','\x20Metadata\x20Items','158930uvsOCd','patch','Attachment_ID__c','file','export','error','Is_Completed__c','./salesforce.service','Is_Retrieved__c','SalesforceService','EXCEPTION','set','defineProperty','length','../classes/errors/salesforce-dml-error','label','Snapshot\x20started.','ENDPOINT_UPSERT_RECORD','base64','./package-export.service','../dtos/metadata-item.dto'];a395_0x410b=function(){return _0x540471;};return a395_0x410b();}const a395_0x2b163a=a395_0x5183;(function(_0xb5e12c,_0x2dd2e0){const _0x4cfdd6=a395_0x5183,_0x5b63e3=_0xb5e12c();while(!![]){try{const _0xea1f10=-parseInt(_0x4cfdd6(0xf0))/0x1+parseInt(_0x4cfdd6(0x143))/0x2+-parseInt(_0x4cfdd6(0xf1))/0x3+-parseInt(_0x4cfdd6(0x14b))/0x4+-parseInt(_0x4cfdd6(0x101))/0x5*(parseInt(_0x4cfdd6(0x152))/0x6)+-parseInt(_0x4cfdd6(0x140))/0x7+parseInt(_0x4cfdd6(0x126))/0x8;if(_0xea1f10===_0x2dd2e0)break;else _0x5b63e3['push'](_0x5b63e3['shift']());}catch(_0x3b8e13){_0x5b63e3['push'](_0x5b63e3['shift']());}}}(a395_0x410b,0xc88b6));const a395_0x51d178=(function(){let _0xbbb641=!![];return function(_0x51404a,_0x9e47cb){const _0x1d572d=_0xbbb641?function(){if(_0x9e47cb){const _0xabd819=_0x9e47cb['apply'](_0x51404a,arguments);return _0x9e47cb=null,_0xabd819;}}:function(){};return _0xbbb641=![],_0x1d572d;};}()),a395_0x2c2c69=a395_0x51d178(this,function(){const _0x3f16b5=a395_0x5183;return a395_0x2c2c69[_0x3f16b5(0x144)]()[_0x3f16b5(0xf8)]('(((.+)+)+)+$')[_0x3f16b5(0x144)]()[_0x3f16b5(0x12a)](a395_0x2c2c69)[_0x3f16b5(0xf8)](_0x3f16b5(0xe6));});a395_0x2c2c69();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2a4540){const _0x2906fb=a395_0x5183;return _0x2a4540&&_0x2a4540[_0x2906fb(0xea)]?_0x2a4540:{'default':_0x2a4540};};function a395_0x5183(_0xfb3209,_0x12bef4){const _0x3d674e=a395_0x410b();return a395_0x5183=function(_0x2c2c69,_0x51d178){_0x2c2c69=_0x2c2c69-0xe3;let _0x410b89=_0x3d674e[_0x2c2c69];return _0x410b89;},a395_0x5183(_0xfb3209,_0x12bef4);}Object[a395_0x2b163a(0x10d)](exports,a395_0x2b163a(0xea),{'value':!![]}),exports[a395_0x2b163a(0x155)]=void 0x0;const jszip_1=__importDefault(require(a395_0x2b163a(0x12f))),flosum_constants_1=require(a395_0x2b163a(0xf9)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require(a395_0x2b163a(0x115)),constants_1=require(a395_0x2b163a(0xef)),salesforce_service_1=require(a395_0x2b163a(0x108)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a395_0x2b163a(0x10f)),package_export_service_1=require(a395_0x2b163a(0x114)),type_and_name_veeva_component_retriever_1=require(a395_0x2b163a(0x123)),type_veeva_component_retriever_1=require(a395_0x2b163a(0x150)),sync_1=require('csv-parse/sync'),sync_2=require('csv-stringify/sync'),veeva_constants_1=require(a395_0x2b163a(0xeb)),path_1=__importDefault(require(a395_0x2b163a(0x142)));class SnapshotService{constructor({snapshotId:_0x47c9c5,metadataLogId:_0x34abe1,selectedMetaTypes:_0x26812e,selectedComponentMap:_0x425114,whereClause:_0x28f5e1},_0x51127d,_0x30351a,_0x1a0085){const _0x3645ca=a395_0x2b163a;this[_0x3645ca(0x139)]=_0x51127d,this[_0x3645ca(0x134)]=_0x30351a,this[_0x3645ca(0x122)]=_0x1a0085,this[_0x3645ca(0x11d)]=_0x47c9c5,this[_0x3645ca(0x11c)]=_0x34abe1,this['_selectedMetaTypes']=_0x26812e,this[_0x3645ca(0x11a)]=_0x425114,this[_0x3645ca(0x138)]=_0x28f5e1,this['_veevaService']=new veeva_service_1[(_0x3645ca(0x125))]({'connection':this['_connectionVeeva'],'logger':this[_0x3645ca(0x122)]}),this[_0x3645ca(0xf7)]=new salesforce_service_1[(_0x3645ca(0x10a))]({'connection':this['_connectionSalesforce']}),this['_packageExportService']=new package_export_service_1[(_0x3645ca(0xe9))]({'veevaService':this[_0x3645ca(0x136)],'connection':this[_0x3645ca(0x134)],'logger':this['_logger']});}async['execute'](){const _0x436859=a395_0x2b163a;try{this[_0x436859(0x122)][_0x436859(0x137)](_0x436859(0x111));const _0x52a203=await this['retrieveVeevaComponents']();await this[_0x436859(0x122)][_0x436859(0x117)]();const _0x44db9c=await this[_0x436859(0x13b)][_0x436859(0x105)](_0x52a203,SnapshotService[_0x436859(0x14a)]);await this[_0x436859(0x122)]['updateLog']();const _0x3839db=await this[_0x436859(0xfb)](_0x52a203,_0x44db9c);await this[_0x436859(0x14f)](_0x3839db),await this[_0x436859(0x122)]['updateLog'](),await this[_0x436859(0x124)](!![]);}catch(_0x58e45f){this[_0x436859(0x122)][_0x436859(0x129)](_0x58e45f),await this[_0x436859(0x124)](![])['catch'](_0x91c1de=>this[_0x436859(0x127)][_0x436859(0x106)](_0x91c1de));}}async[a395_0x2b163a(0xed)](){const _0x283f0b=a395_0x2b163a,_0x91bd2c={'veevaService':this[_0x283f0b(0x136)],'logger':this['_logger']},_0x5209bc=Array[_0x283f0b(0x12b)](Object['values'](this[_0x283f0b(0x11a)]))[_0x283f0b(0x10e)]?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x283f0b(0x11a)],..._0x91bd2c}):new type_veeva_component_retriever_1['TypeVeevaComponentRetriever']({'value':this[_0x283f0b(0xff)],'whereClause':this['_whereClause'],..._0x91bd2c});return _0x5209bc[_0x283f0b(0xfd)]();}async[a395_0x2b163a(0xfb)](_0xe7c104,_0x3a05ab){const _0x2fe05c=a395_0x2b163a;var _0x489b88,_0x70f81c;this[_0x2fe05c(0x122)][_0x2fe05c(0x137)](_0x2fe05c(0xe4));const _0x3ab81a=this[_0x2fe05c(0x131)](_0xe7c104),_0xfd9fbf=_0x3ab81a['reduce']((_0x3e5367,_0x3116f4)=>_0x3e5367[_0x2fe05c(0x10c)](_0x3116f4[_0x2fe05c(0x110)],_0x3116f4),new Map());for(const _0xd5041 of _0x3a05ab){for(const _0x536675 in _0xd5041[_0x2fe05c(0x146)]){const {base:_0x54c527,name:_0x49c548,dir:_0x17a686}=path_1[_0x2fe05c(0x14d)][_0x2fe05c(0xf2)](_0x536675),_0x17a212=_0x49c548+veeva_constants_1['VeevaConstants']['DEPENDENCY_EXTENSION'];if(_0xfd9fbf['has'](_0x54c527)){const _0x44569a=await((_0x489b88=_0xd5041['file']([_0x17a686,_0x54c527]['join'](path_1[_0x2fe05c(0x14d)][_0x2fe05c(0xe7)]['sep'])))===null||_0x489b88===void 0x0?void 0x0:_0x489b88[_0x2fe05c(0x147)]('string')),_0x52658c=await((_0x70f81c=_0xd5041[_0x2fe05c(0x104)]([_0x17a686,_0x17a212][_0x2fe05c(0xee)](path_1[_0x2fe05c(0x14d)][_0x2fe05c(0xe7)]['sep'])))===null||_0x70f81c===void 0x0?void 0x0:_0x70f81c[_0x2fe05c(0x147)](_0x2fe05c(0x133)));if(_0x44569a){const _0x97ab8c=new jszip_1[(_0x2fe05c(0x14d))]();_0x97ab8c[_0x2fe05c(0x104)](_0x54c527,_0x44569a),_0x52658c&&_0x97ab8c[_0x2fe05c(0x104)](_0x17a212,this[_0x2fe05c(0x159)](_0x52658c)),_0xfd9fbf[_0x2fe05c(0x13d)](_0x54c527)['body']=await _0x97ab8c[_0x2fe05c(0x118)]({'type':_0x2fe05c(0x113)});}}}}return _0x3ab81a['filter'](_0x3a8fa4=>!_0x3a8fa4[_0x2fe05c(0x13e)])[_0x2fe05c(0x11e)](_0x27ad9f=>{const _0x420a9e=_0x2fe05c;this[_0x420a9e(0x122)][_0x420a9e(0x137)](_0x420a9e(0x14c)+_0x27ad9f['veevaComponentType']+'.'+_0x27ad9f['name']+_0x420a9e(0xf4));}),_0x3ab81a[_0x2fe05c(0x120)](_0x3c987e=>_0x3c987e[_0x2fe05c(0x13e)]);}[a395_0x2b163a(0x159)](_0x183ea1){const _0x598808=a395_0x2b163a,_0x2b9da5=(0x0,sync_1[_0x598808(0xf2)])(_0x183ea1,{'columns':!![],'skip_empty_lines':!![]}),_0x46bab5=_0x2b9da5[_0x598808(0x128)](({'In\x20Package':_0x201909,..._0xffdadc})=>_0xffdadc);return(0x0,sync_2[_0x598808(0x158)])(_0x46bab5,{'header':!![]});}[a395_0x2b163a(0x131)](_0x502c4e){const _0x25925f=a395_0x2b163a;return _0x502c4e[_0x25925f(0x128)](_0x2bfd02=>{const _0x1b05ce=_0x25925f,_0x5596dc=new metadata_item_dto_1[(_0x1b05ce(0x132))]();return _0x5596dc[_0x1b05ce(0xe3)]=_0x2bfd02['name'],_0x5596dc[_0x1b05ce(0x130)]=_0x2bfd02[_0x1b05ce(0xe3)],_0x5596dc[_0x1b05ce(0x12e)]=this[_0x1b05ce(0x11d)],_0x5596dc[_0x1b05ce(0x110)]=_0x2bfd02[_0x1b05ce(0x13f)]+'.'+_0x2bfd02['name']+veeva_constants_1['VeevaConstants'][_0x1b05ce(0x145)],_0x5596dc[_0x1b05ce(0x148)]=_0x2bfd02[_0x1b05ce(0x13f)],_0x5596dc['lastModifiedDate']=_0x2bfd02[_0x1b05ce(0x13a)],_0x5596dc[_0x1b05ce(0x153)]=![],_0x5596dc;});}async['saveComponentsInSalesforce'](_0x109e18){const _0x21fca3=a395_0x2b163a;this[_0x21fca3(0x122)]['log'](_0x21fca3(0x14e)),await this[_0x21fca3(0xec)](_0x109e18),this['_logger'][_0x21fca3(0x137)](_0x21fca3(0x154)+_0x109e18[_0x21fca3(0x10e)]+_0x21fca3(0x100));const _0x42b0d8=_0x109e18[_0x21fca3(0x128)](_0x2538ac=>{const _0x42c89d=_0x21fca3;return{[constants_1[_0x42c89d(0x116)]+'Name__c']:_0x2538ac[_0x42c89d(0xe3)],[constants_1['FLOSUM_NAMESPACE']+_0x42c89d(0x11f)]:_0x2538ac[_0x42c89d(0x130)],[constants_1['FLOSUM_NAMESPACE']+_0x42c89d(0xf3)]:_0x2538ac[_0x42c89d(0x12e)],[constants_1[_0x42c89d(0x116)]+'Label__c']:_0x2538ac[_0x42c89d(0x110)],[constants_1[_0x42c89d(0x116)]+_0x42c89d(0x109)]:_0x2538ac[_0x42c89d(0x153)],[constants_1[_0x42c89d(0x116)]+_0x42c89d(0xf5)]:_0x2538ac['veevaComponentType'],[constants_1[_0x42c89d(0x116)]+_0x42c89d(0x103)]:_0x2538ac[_0x42c89d(0xf6)],[constants_1[_0x42c89d(0x116)]+_0x42c89d(0xe5)]:_0x2538ac[_0x42c89d(0x13a)]};}),_0x388ba2=await this[_0x21fca3(0xf7)][_0x21fca3(0x15a)](constants_1['FLOSUM_NAMESPACE']+_0x21fca3(0x12c),_0x42b0d8);let _0x44cfaf=!![];_0x388ba2[_0x21fca3(0x11e)]((_0x2d5e3a,_0x24fb6f)=>{const _0x6a36d0=_0x21fca3;this['_logger'][_0x6a36d0(0x137)]('Saving\x20'+_0x109e18[_0x24fb6f]['veevaComponentType']+'.'+_0x109e18[_0x24fb6f][_0x6a36d0(0xe3)]);if(!_0x2d5e3a[_0x6a36d0(0x156)]){_0x44cfaf=![];const _0x474c98=new salesforce_dml_error_1[(_0x6a36d0(0xe8))](_0x2d5e3a['errors']);this[_0x6a36d0(0x122)][_0x6a36d0(0x129)](_0x474c98);}});if(!_0x44cfaf)throw new Error(_0x21fca3(0x135));}async[a395_0x2b163a(0xec)](_0xa9c24c){const _0x111a49=a395_0x2b163a,_0x2c45f1=this['formAttachments'](_0xa9c24c),_0x31862a=await this['_salesforceService'][_0x111a49(0x15a)](SnapshotService[_0x111a49(0xfa)],_0x2c45f1),_0x377af7=[];_0x31862a[_0x111a49(0x11e)]((_0x1e6adc,_0x15a0e1)=>{const _0x5dfd4c=_0x111a49;_0x1e6adc[_0x5dfd4c(0x156)]?(_0xa9c24c[_0x15a0e1][_0x5dfd4c(0xf6)]=_0x1e6adc['id'],_0xa9c24c[_0x15a0e1][_0x5dfd4c(0x153)]=!![]):_0x377af7[_0x5dfd4c(0x121)](..._0x1e6adc['errors']);});if(_0x377af7['length'])throw new salesforce_dml_error_1[(_0x111a49(0xe8))](_0x377af7);}['formAttachments'](_0x2ad6fc){const _0x4245fe=a395_0x2b163a;return _0x2ad6fc[_0x4245fe(0x128)](_0x2adfc8=>({'ParentId':this['_snapshotId'],'Name':_0x2adfc8[_0x4245fe(0x148)],'ContentType':'application/zip','Body':_0x2adfc8[_0x4245fe(0x13e)],'Description':_0x2adfc8[_0x4245fe(0x148)]}));}async[a395_0x2b163a(0x124)](_0x28ed7d){const _0xcf0225=a395_0x2b163a,_0x38583c={[constants_1[_0xcf0225(0x116)]+_0xcf0225(0x107)]:!![],[constants_1[_0xcf0225(0x116)]+'Is_Error__c']:!_0x28ed7d},_0x2f6e3c={[constants_1['FLOSUM_NAMESPACE']+'Is_Error__c']:!_0x28ed7d,[constants_1['FLOSUM_NAMESPACE']+_0xcf0225(0x12d)]:_0x28ed7d,[constants_1[_0xcf0225(0x116)]+_0xcf0225(0xfe)]:_0x28ed7d?status_enums_1[_0xcf0225(0x11b)]['COMPLETED']:status_enums_1[_0xcf0225(0x11b)][_0xcf0225(0x10b)],[constants_1['FLOSUM_NAMESPACE']+'Job_Completed__c']:!![]};await this['_connectionSalesforce'][_0xcf0225(0x102)](flosum_constants_1[_0xcf0225(0x151)][_0xcf0225(0x112)]+'/'+constants_1['FLOSUM_NAMESPACE']+'Snapshot__c/'+this['_snapshotId'],_0x38583c),await this[_0xcf0225(0x139)][_0xcf0225(0x102)](flosum_constants_1[_0xcf0225(0x151)][_0xcf0225(0x112)]+'/'+constants_1[_0xcf0225(0x116)]+_0xcf0225(0x119)+this[_0xcf0225(0x11c)],_0x2f6e3c),this['_logger'][_0xcf0225(0x137)](_0xcf0225(0xfc)+(_0x28ed7d?_0xcf0225(0x13c):_0xcf0225(0x157))+'.'),await this[_0xcf0225(0x122)][_0xcf0225(0x117)]();}}exports['SnapshotService']=SnapshotService,SnapshotService[a395_0x2b163a(0x14a)]=a395_0x2b163a(0x141),SnapshotService[a395_0x2b163a(0xfa)]=a395_0x2b163a(0x149);