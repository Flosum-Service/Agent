const a339_0x2b5003=a339_0x492e;(function(_0x2ef750,_0x4b2003){const _0x1e3423=a339_0x492e,_0x245ef3=_0x2ef750();while(!![]){try{const _0x15d47b=parseInt(_0x1e3423(0xff))/0x1*(parseInt(_0x1e3423(0x9e))/0x2)+parseInt(_0x1e3423(0xc2))/0x3*(-parseInt(_0x1e3423(0x9f))/0x4)+-parseInt(_0x1e3423(0x9d))/0x5+parseInt(_0x1e3423(0xf9))/0x6+parseInt(_0x1e3423(0xe2))/0x7*(-parseInt(_0x1e3423(0x103))/0x8)+parseInt(_0x1e3423(0x97))/0x9*(-parseInt(_0x1e3423(0xa3))/0xa)+parseInt(_0x1e3423(0xaf))/0xb*(parseInt(_0x1e3423(0xd1))/0xc);if(_0x15d47b===_0x4b2003)break;else _0x245ef3['push'](_0x245ef3['shift']());}catch(_0x311bf6){_0x245ef3['push'](_0x245ef3['shift']());}}}(a339_0x1f98,0x9024b));const a339_0x17944c=(function(){let _0x2347be=!![];return function(_0x82e5c,_0x53489e){const _0xfac442=_0x2347be?function(){const _0x45b54b=a339_0x492e;if(_0x53489e){const _0x54a114=_0x53489e[_0x45b54b(0xda)](_0x82e5c,arguments);return _0x53489e=null,_0x54a114;}}:function(){};return _0x2347be=![],_0xfac442;};}()),a339_0x451dd6=a339_0x17944c(this,function(){const _0x52d6a2=a339_0x492e;return a339_0x451dd6[_0x52d6a2(0xc7)]()[_0x52d6a2(0xc9)](_0x52d6a2(0xb5))[_0x52d6a2(0xc7)]()[_0x52d6a2(0xd8)](a339_0x451dd6)[_0x52d6a2(0xc9)](_0x52d6a2(0xb5));});a339_0x451dd6();'use strict';var __importDefault=this&&this[a339_0x2b5003(0x91)]||function(_0x4d019d){return _0x4d019d&&_0x4d019d['__esModule']?_0x4d019d:{'default':_0x4d019d};};Object[a339_0x2b5003(0xfb)](exports,a339_0x2b5003(0xb3),{'value':!![]}),exports['SnapshotService']=void 0x0;const jszip_1=__importDefault(require(a339_0x2b5003(0xee))),flosum_constants_1=require(a339_0x2b5003(0xb1)),veeva_service_1=require(a339_0x2b5003(0xe3)),metadata_item_dto_1=require(a339_0x2b5003(0xa0)),constants_1=require(a339_0x2b5003(0xfe)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a339_0x2b5003(0xcf)),salesforce_dml_error_1=require(a339_0x2b5003(0x105)),package_export_service_1=require(a339_0x2b5003(0xfa)),type_and_name_veeva_component_retriever_1=require(a339_0x2b5003(0xb9)),type_veeva_component_retriever_1=require(a339_0x2b5003(0xf7));function a339_0x1f98(){const _0x33a8e8=['_timeZone','PackageExportService','4671pvQasX','\x20Metadata\x20Items','finishSnapshot','length','generateAsync','lastModifiedDate','4025320jpgYWG','202828syvPDF','1172ssmWwH','../dtos/metadata-item.dto','Snapshot__c','type','16190XFoBKP','Succeed__c','with\x20error','SalesforceDmlError','TypeVeevaComponentRetriever','_metadataLogId','successfully','Veeva_Component_Type__c','Is_Retrieved__c','snapshotId','label','ENDPOINT_UPSERT_RECORD','22BXGPBd','body','../constants/flosum.constants','SnapshotService','__esModule','forEach','(((.+)+)+)+$','_attachmentLogId','attachmentLogId','_packageExportService','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','_connectionVeeva','saveAttachments','ATTACHMENT','filter','MetadataItemDto','OUTBOUND_PACKAGE_NAME','_salesforceService','_snapshotId','11721boWxYv','_selectedMetaTypes','patch','logError','file','toString','reduce','search','retrieve','from','_selectedComponentMap','attachmentId','MetadataLogStatus','../enums/status.enums','Label__c','21564012xOrDIR','catch','_connectionSalesforce','Status__c','FLOSUM_NAMESPACE','selectedMetaTypes','Snapshot','constructor','_logger','apply','Is_Error__c','string','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','async','base64','updateLog','selectedComponentMap','1478869hIhZAB','./veeva.service','files','Is_Completed__c','success','Metadata_Item__c','values','default','Attachment','name','veevaComponentType','FlosumConstants','jszip','formAttachments','metadataLogId','map','retrieveVeevaComponents','\x20from\x20outbound\x20package','insertMultipleRecords','COMPLETED','_systemLogger','../classes/retrievers/veeva-components/type.veeva-component.retriever','error','1406016njvIcR','./package-export.service','defineProperty','formMetadataItemDtoList','has','../../../constants','6QmBpYX','isRetrieved','timeZone','errors','40iSGjsz','application/zip','../classes/errors/salesforce-dml-error','Saving\x20Attachments.','Saving\x20','export','Snapshot\x20started.','createMetadataItemListWithBody','saveComponentsInSalesforce','log','_veevaService','__importDefault','set','API_Name__c','get'];a339_0x1f98=function(){return _0x33a8e8;};return a339_0x1f98();}function a339_0x492e(_0x19f90b,_0x154879){const _0x42904a=a339_0x1f98();return a339_0x492e=function(_0x451dd6,_0x17944c){_0x451dd6=_0x451dd6-0x8e;let _0x1f981c=_0x42904a[_0x451dd6];return _0x1f981c;},a339_0x492e(_0x19f90b,_0x154879);}class SnapshotService{constructor(_0x3694db,_0x243bca,_0x2cf3d8,_0x1cab56){const _0x27f8ed=a339_0x2b5003;this['_connectionSalesforce']=_0x243bca,this[_0x27f8ed(0xba)]=_0x2cf3d8,this[_0x27f8ed(0xd9)]=_0x1cab56,this[_0x27f8ed(0xc1)]=_0x3694db['snapshotId'],this['_metadataLogId']=_0x3694db[_0x27f8ed(0xf0)],this[_0x27f8ed(0xb6)]=_0x3694db[_0x27f8ed(0xb7)],this[_0x27f8ed(0x95)]=_0x3694db[_0x27f8ed(0x101)],this[_0x27f8ed(0xc3)]=_0x3694db[_0x27f8ed(0xd6)],this['_selectedComponentMap']=_0x3694db[_0x27f8ed(0xe1)],this['_veevaService']=new veeva_service_1['VeevaService']({'connection':this[_0x27f8ed(0xba)],'logger':this['_logger']}),this[_0x27f8ed(0xc0)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x27f8ed(0xd3)]}),this[_0x27f8ed(0xb8)]=new package_export_service_1[(_0x27f8ed(0x96))]({'veevaService':this['_veevaService'],'connection':this[_0x27f8ed(0xba)],'logger':this[_0x27f8ed(0xd9)]});}async['execute'](){const _0x438460=a339_0x2b5003;try{this[_0x438460(0xd9)]['log'](_0x438460(0x109));const _0x4790a4=await this[_0x438460(0xf2)]();await this[_0x438460(0xd9)]['updateLog']();const _0x23f961=await this['_packageExportService'][_0x438460(0x108)](_0x4790a4,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this[_0x438460(0xd9)][_0x438460(0xe0)]();const _0x54e4e4=await this[_0x438460(0x10a)](_0x4790a4,_0x23f961);await this[_0x438460(0x8e)](_0x54e4e4),await this[_0x438460(0xd9)][_0x438460(0xe0)](),await this[_0x438460(0x99)](!![]);}catch(_0x571b47){this[_0x438460(0xd9)][_0x438460(0xc5)](_0x571b47),await this[_0x438460(0x99)](![])[_0x438460(0xd2)](_0x4a2067=>this[_0x438460(0xf6)][_0x438460(0xf8)](_0x4a2067));}}async[a339_0x2b5003(0xf2)](){const _0x3dab56=a339_0x2b5003,_0x4166be={'veevaService':this[_0x3dab56(0x90)],'logger':this[_0x3dab56(0xd9)]},_0x382052=Array[_0x3dab56(0xcb)](Object[_0x3dab56(0xe8)](this[_0x3dab56(0xcc)]))['length']?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x3dab56(0xcc)],..._0x4166be}):new type_veeva_component_retriever_1[(_0x3dab56(0xa7))]({'value':this[_0x3dab56(0xc3)],..._0x4166be});return _0x382052[_0x3dab56(0xca)]();}async[a339_0x2b5003(0x10a)](_0x5642a3,_0x53c8e3){const _0x47977d=a339_0x2b5003;var _0x27181a;this[_0x47977d(0xd9)][_0x47977d(0x8f)](_0x47977d(0xdd));const _0x1ac7f8=this[_0x47977d(0xfc)](_0x5642a3),_0x14ee26=_0x1ac7f8[_0x47977d(0xc8)]((_0x3944db,_0x13cf8a)=>_0x3944db[_0x47977d(0x92)](_0x13cf8a['label'],_0x13cf8a),new Map());for(const _0x1635fd of _0x53c8e3){for(const _0x20e691 in _0x1635fd[_0x47977d(0xe4)]){const _0x388fc5=_0x20e691['split']('/')['at'](-0x1);if(_0x14ee26[_0x47977d(0xfd)](_0x388fc5)){const _0x1dc346=await((_0x27181a=_0x1635fd[_0x47977d(0xc6)](_0x20e691))===null||_0x27181a===void 0x0?void 0x0:_0x27181a[_0x47977d(0xde)](_0x47977d(0xdc)));if(_0x1dc346){const _0x4fe785=new jszip_1[(_0x47977d(0xe9))]();_0x4fe785[_0x47977d(0xc6)](_0x388fc5,_0x1dc346),_0x14ee26[_0x47977d(0x94)](_0x388fc5)[_0x47977d(0xb0)]=await _0x4fe785[_0x47977d(0x9b)]({'type':_0x47977d(0xdf)});}}}}return _0x1ac7f8[_0x47977d(0xbd)](_0x4017bf=>!_0x4017bf['body'])[_0x47977d(0xb4)](_0x1acf4a=>{const _0x136cea=_0x47977d;this[_0x136cea(0xd9)]['log']('Cannot\x20retrieve\x20'+_0x1acf4a[_0x136cea(0xec)]+'.'+_0x1acf4a[_0x136cea(0xeb)]+_0x136cea(0xf3));}),_0x1ac7f8[_0x47977d(0xbd)](_0x21cb31=>_0x21cb31[_0x47977d(0xb0)]);}[a339_0x2b5003(0xfc)](_0x14e599){const _0x5b9317=a339_0x2b5003;return _0x14e599[_0x5b9317(0xf1)](_0xaad257=>{const _0x30d89b=_0x5b9317,_0x244441=new metadata_item_dto_1[(_0x30d89b(0xbe))]();return _0x244441[_0x30d89b(0xeb)]=_0xaad257[_0x30d89b(0xeb)],_0x244441['apiName']=_0xaad257[_0x30d89b(0xeb)],_0x244441['snapshotId']=this['_snapshotId'],_0x244441[_0x30d89b(0xad)]=_0xaad257[_0x30d89b(0xa2)]+'.'+_0xaad257[_0x30d89b(0xeb)]+'.mdl',_0x244441[_0x30d89b(0xec)]=_0xaad257['type'],_0x244441[_0x30d89b(0x9c)]=_0xaad257[_0x30d89b(0x9c)],_0x244441[_0x30d89b(0x100)]=![],_0x244441;});}async[a339_0x2b5003(0x8e)](_0x3d642b){const _0x4cd56a=a339_0x2b5003;this[_0x4cd56a(0xd9)]['log'](_0x4cd56a(0x106)),await this[_0x4cd56a(0xbb)](_0x3d642b),this[_0x4cd56a(0xd9)][_0x4cd56a(0x8f)](_0x4cd56a(0x107)+_0x3d642b[_0x4cd56a(0x9a)]+_0x4cd56a(0x98));const _0x4eea66=_0x3d642b[_0x4cd56a(0xf1)](_0x417ee5=>{const _0x1afcb2=_0x4cd56a;return{[constants_1[_0x1afcb2(0xd5)]+'Name__c']:_0x417ee5[_0x1afcb2(0xeb)],[constants_1[_0x1afcb2(0xd5)]+_0x1afcb2(0x93)]:_0x417ee5['apiName'],[constants_1['FLOSUM_NAMESPACE']+_0x1afcb2(0xa1)]:_0x417ee5[_0x1afcb2(0xac)],[constants_1['FLOSUM_NAMESPACE']+_0x1afcb2(0xd0)]:_0x417ee5[_0x1afcb2(0xad)],[constants_1[_0x1afcb2(0xd5)]+_0x1afcb2(0xab)]:_0x417ee5[_0x1afcb2(0x100)],[constants_1[_0x1afcb2(0xd5)]+_0x1afcb2(0xaa)]:_0x417ee5[_0x1afcb2(0xec)],[constants_1[_0x1afcb2(0xd5)]+'Attachment_ID__c']:_0x417ee5[_0x1afcb2(0xcd)],[constants_1[_0x1afcb2(0xd5)]+'Last_Modified_Date__c']:_0x417ee5[_0x1afcb2(0x9c)]};}),_0x22219b=await this['_salesforceService'][_0x4cd56a(0xf4)](constants_1[_0x4cd56a(0xd5)]+_0x4cd56a(0xe7),_0x4eea66);let _0x5a2bb6=!![];_0x22219b[_0x4cd56a(0xb4)]((_0x3224d5,_0x324f3d)=>{const _0x2b8aaa=_0x4cd56a;this[_0x2b8aaa(0xd9)][_0x2b8aaa(0x8f)](_0x2b8aaa(0x107)+_0x3d642b[_0x324f3d][_0x2b8aaa(0xec)]+'.'+_0x3d642b[_0x324f3d][_0x2b8aaa(0xeb)]);if(!_0x3224d5[_0x2b8aaa(0xe6)]){_0x5a2bb6=![];const _0x5b66c9=new salesforce_dml_error_1['SalesforceDmlError'](_0x3224d5['errors']);this[_0x2b8aaa(0xd9)][_0x2b8aaa(0xc5)](_0x5b66c9);}});if(!_0x5a2bb6)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async['saveAttachments'](_0x1be018){const _0x5df80d=a339_0x2b5003,_0x4f4292=this[_0x5df80d(0xef)](_0x1be018),_0x874540=await this[_0x5df80d(0xc0)]['insertMultipleRecords'](SnapshotService[_0x5df80d(0xbc)],_0x4f4292),_0x13e1b7=[];_0x874540['forEach']((_0x2e939b,_0x4309cc)=>{const _0x8ae9ec=_0x5df80d;_0x2e939b[_0x8ae9ec(0xe6)]?(_0x1be018[_0x4309cc][_0x8ae9ec(0xcd)]=_0x2e939b['id'],_0x1be018[_0x4309cc][_0x8ae9ec(0x100)]=!![]):_0x13e1b7['push'](..._0x2e939b[_0x8ae9ec(0x102)]);});if(_0x13e1b7[_0x5df80d(0x9a)])throw new salesforce_dml_error_1[(_0x5df80d(0xa6))](_0x13e1b7);}[a339_0x2b5003(0xef)](_0x1c462a){const _0x2e78d9=a339_0x2b5003;return _0x1c462a[_0x2e78d9(0xf1)](_0x45888f=>({'ParentId':this[_0x2e78d9(0xc1)],'Name':_0x45888f[_0x2e78d9(0xec)],'ContentType':_0x2e78d9(0x104),'Body':_0x45888f[_0x2e78d9(0xb0)],'Description':_0x45888f[_0x2e78d9(0xec)]}));}async[a339_0x2b5003(0x99)](_0x364636){const _0x2dbe6f=a339_0x2b5003,_0x3eff0a={[constants_1['FLOSUM_NAMESPACE']+_0x2dbe6f(0xe5)]:!![],[constants_1[_0x2dbe6f(0xd5)]+'Is_Error__c']:!_0x364636},_0x1ea427={[constants_1['FLOSUM_NAMESPACE']+_0x2dbe6f(0xdb)]:!_0x364636,[constants_1[_0x2dbe6f(0xd5)]+_0x2dbe6f(0xa4)]:_0x364636,[constants_1[_0x2dbe6f(0xd5)]+_0x2dbe6f(0xd4)]:_0x364636?status_enums_1[_0x2dbe6f(0xce)][_0x2dbe6f(0xf5)]:status_enums_1[_0x2dbe6f(0xce)]['EXCEPTION'],[constants_1[_0x2dbe6f(0xd5)]+'Job_Completed__c']:!![]};await this['_connectionSalesforce'][_0x2dbe6f(0xc4)](flosum_constants_1[_0x2dbe6f(0xed)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x2dbe6f(0xd5)]+'Snapshot__c/'+this[_0x2dbe6f(0xc1)],_0x3eff0a),await this[_0x2dbe6f(0xd3)]['patch'](flosum_constants_1[_0x2dbe6f(0xed)][_0x2dbe6f(0xae)]+'/'+constants_1['FLOSUM_NAMESPACE']+'Metadata_Log__c/'+this[_0x2dbe6f(0xa8)],_0x1ea427),this[_0x2dbe6f(0xd9)][_0x2dbe6f(0x8f)]('Snapshot\x20completed\x20'+(_0x364636?_0x2dbe6f(0xa9):_0x2dbe6f(0xa5))+'.'),await this[_0x2dbe6f(0xd9)][_0x2dbe6f(0xe0)]();}}exports[a339_0x2b5003(0xb2)]=SnapshotService,SnapshotService[a339_0x2b5003(0xbf)]=a339_0x2b5003(0xd7),SnapshotService[a339_0x2b5003(0xbc)]=a339_0x2b5003(0xea);