const a395_0x88abc8=a395_0x5bcf;function a395_0x5bcf(_0x1ed581,_0x448bb5){const _0x38410a=a395_0x3d32();return a395_0x5bcf=function(_0x2c3db6,_0x3d2b7a){_0x2c3db6=_0x2c3db6-0x1c5;let _0x3d3289=_0x38410a[_0x2c3db6];return _0x3d3289;},a395_0x5bcf(_0x1ed581,_0x448bb5);}(function(_0x12d8af,_0x51270c){const _0x2bd7d1=a395_0x5bcf,_0x161f12=_0x12d8af();while(!![]){try{const _0x1a49d4=parseInt(_0x2bd7d1(0x204))/0x1+-parseInt(_0x2bd7d1(0x1ef))/0x2*(parseInt(_0x2bd7d1(0x22d))/0x3)+-parseInt(_0x2bd7d1(0x1db))/0x4*(parseInt(_0x2bd7d1(0x1f1))/0x5)+parseInt(_0x2bd7d1(0x23b))/0x6+parseInt(_0x2bd7d1(0x1f8))/0x7*(-parseInt(_0x2bd7d1(0x222))/0x8)+parseInt(_0x2bd7d1(0x1f7))/0x9*(-parseInt(_0x2bd7d1(0x1d8))/0xa)+-parseInt(_0x2bd7d1(0x238))/0xb*(-parseInt(_0x2bd7d1(0x1c6))/0xc);if(_0x1a49d4===_0x51270c)break;else _0x161f12['push'](_0x161f12['shift']());}catch(_0xacc628){_0x161f12['push'](_0x161f12['shift']());}}}(a395_0x3d32,0x7c6fd));const a395_0x3d2b7a=(function(){let _0x1d0c96=!![];return function(_0x3e402d,_0x229bcf){const _0x226b57=_0x1d0c96?function(){const _0x219b70=a395_0x5bcf;if(_0x229bcf){const _0x2bea4d=_0x229bcf[_0x219b70(0x1e4)](_0x3e402d,arguments);return _0x229bcf=null,_0x2bea4d;}}:function(){};return _0x1d0c96=![],_0x226b57;};}()),a395_0x2c3db6=a395_0x3d2b7a(this,function(){const _0x30fba1=a395_0x5bcf;return a395_0x2c3db6[_0x30fba1(0x1eb)]()[_0x30fba1(0x1d9)](_0x30fba1(0x22b))['toString']()['constructor'](a395_0x2c3db6)[_0x30fba1(0x1d9)](_0x30fba1(0x22b));});a395_0x2c3db6();'use strict';var __importDefault=this&&this[a395_0x88abc8(0x1df)]||function(_0x5dacb6){const _0x31c896=a395_0x88abc8;return _0x5dacb6&&_0x5dacb6[_0x31c896(0x1ec)]?_0x5dacb6:{'default':_0x5dacb6};};Object['defineProperty'](exports,a395_0x88abc8(0x1ec),{'value':!![]}),exports[a395_0x88abc8(0x225)]=void 0x0;function a395_0x3d32(){const _0xe241d2=['push','SalesforceService','csv-stringify/sync','_salesforceService','../constants/veeva.constants','API_Name__c','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','8294737mTorzx','base64','Name__c','3806004edKqeJ','catch','../constants/flosum.constants','reduce','_connectionVeeva','name','with\x20error','VeevaConstants','forEach','insertMultipleRecords','from','24wknnUL','VeevaService','formAttachments','label','saveComponentsInSalesforce','lastModifiedDate','DEPENDENCY_EXTENSION','OUTBOUND_PACKAGE_NAME','jszip','_logger','default','ENDPOINT_UPSERT_RECORD','finishSnapshot','type','Metadata_Item__c','join','MetadataItemDto','_selectedComponentMap','456080thbGyK','search','body','280Icpbbi','Succeed__c','transformDependencyFile','Veeva_Component_Type__c','__importDefault','snapshotId','has','_whereClause','Saving\x20','apply','COMPLETED','Snapshot','error','csv-parse/sync','successfully','set','toString','__esModule','values','saveAttachments','839428hmIkfP','../classes/errors/salesforce-dml-error','36180AIIBhb','Last_Modified_Date__c','posix','../dtos/metadata-item.dto','Is_Retrieved__c','FlosumConstants','18SmsXHm','7DMXlJJ','_systemLogger','Snapshot__c/','success','EXCEPTION','filter','_veevaService','retrieveVeevaComponents','./salesforce.service','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','string','../../../constants','18681fhkFVO','_packageExportService','_snapshotId','sep','Attachment_ID__c','get','_selectedMetaTypes','patch','Label__c','updateLog','_connectionSalesforce','path','application/zip','Cannot\x20Save\x20Metadata\x20Items','async','Is_Completed__c','./veeva.service','SalesforceDmlError','Job_Completed__c','isRetrieved','_metadataLogId','Snapshot\x20completed\x20','FLOSUM_NAMESPACE','veevaComponentType','formMetadataItemDtoList','map','Cannot\x20retrieve\x20','./package-export.service','attachmentId','errors','5072048CZLaOb','export','createMetadataItemListWithBody','SnapshotService','length','log','logError','apiName','Is_Error__c','(((.+)+)+)+$','file','3eJruIn','PackageExportService','execute','ATTACHMENT'];a395_0x3d32=function(){return _0xe241d2;};return a395_0x3d32();}const jszip_1=__importDefault(require(a395_0x88abc8(0x1ce))),flosum_constants_1=require(a395_0x88abc8(0x23d)),veeva_service_1=require(a395_0x88abc8(0x214)),metadata_item_dto_1=require(a395_0x88abc8(0x1f4)),constants_1=require(a395_0x88abc8(0x203)),salesforce_service_1=require(a395_0x88abc8(0x200)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a395_0x88abc8(0x1f0)),package_export_service_1=require(a395_0x88abc8(0x21f)),type_and_name_veeva_component_retriever_1=require(a395_0x88abc8(0x237)),type_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type.veeva-component.retriever'),sync_1=require(a395_0x88abc8(0x1e8)),sync_2=require(a395_0x88abc8(0x233)),veeva_constants_1=require(a395_0x88abc8(0x235)),path_1=__importDefault(require(a395_0x88abc8(0x20f)));class SnapshotService{constructor({snapshotId:_0x208ddf,metadataLogId:_0x4f8888,selectedMetaTypes:_0x2baa5a,selectedComponentMap:_0x612181,whereClause:_0x1f0fe5},_0x5525f5,_0x3353c8,_0x37052b){const _0x4ab77=a395_0x88abc8;this['_connectionSalesforce']=_0x5525f5,this[_0x4ab77(0x23f)]=_0x3353c8,this[_0x4ab77(0x1cf)]=_0x37052b,this[_0x4ab77(0x206)]=_0x208ddf,this['_metadataLogId']=_0x4f8888,this[_0x4ab77(0x20a)]=_0x2baa5a,this[_0x4ab77(0x1d7)]=_0x612181,this['_whereClause']=_0x1f0fe5,this[_0x4ab77(0x1fe)]=new veeva_service_1[(_0x4ab77(0x1c7))]({'connection':this[_0x4ab77(0x23f)],'logger':this['_logger']}),this[_0x4ab77(0x234)]=new salesforce_service_1[(_0x4ab77(0x232))]({'connection':this[_0x4ab77(0x20e)]}),this[_0x4ab77(0x205)]=new package_export_service_1[(_0x4ab77(0x22e))]({'veevaService':this['_veevaService'],'connection':this[_0x4ab77(0x23f)],'logger':this[_0x4ab77(0x1cf)]});}async[a395_0x88abc8(0x22f)](){const _0x69cfff=a395_0x88abc8;try{this[_0x69cfff(0x1cf)][_0x69cfff(0x227)]('Snapshot\x20started.');const _0x5a43b0=await this[_0x69cfff(0x1ff)]();await this[_0x69cfff(0x1cf)][_0x69cfff(0x20d)]();const _0x4decd7=await this['_packageExportService'][_0x69cfff(0x223)](_0x5a43b0,SnapshotService[_0x69cfff(0x1cd)]);await this[_0x69cfff(0x1cf)][_0x69cfff(0x20d)]();const _0xd5a44=await this[_0x69cfff(0x224)](_0x5a43b0,_0x4decd7);await this[_0x69cfff(0x1ca)](_0xd5a44),await this[_0x69cfff(0x1cf)][_0x69cfff(0x20d)](),await this[_0x69cfff(0x1d2)](!![]);}catch(_0x18ed96){this['_logger'][_0x69cfff(0x228)](_0x18ed96),await this[_0x69cfff(0x1d2)](![])[_0x69cfff(0x23c)](_0x1766bb=>this[_0x69cfff(0x1f9)][_0x69cfff(0x1e7)](_0x1766bb));}}async[a395_0x88abc8(0x1ff)](){const _0x58f3ba=a395_0x88abc8,_0x2e78af={'veevaService':this[_0x58f3ba(0x1fe)],'logger':this['_logger']},_0x39a7bf=Array[_0x58f3ba(0x1c5)](Object[_0x58f3ba(0x1ed)](this[_0x58f3ba(0x1d7)]))['length']?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x58f3ba(0x1d7)],..._0x2e78af}):new type_veeva_component_retriever_1['TypeVeevaComponentRetriever']({'value':this[_0x58f3ba(0x20a)],'whereClause':this[_0x58f3ba(0x1e2)],..._0x2e78af});return _0x39a7bf['retrieve']();}async[a395_0x88abc8(0x224)](_0x24cd4b,_0x16d351){const _0xa03b94=a395_0x88abc8;var _0x5f15f9,_0x5ba8b7;this[_0xa03b94(0x1cf)][_0xa03b94(0x227)](_0xa03b94(0x201));const _0x47db5f=this[_0xa03b94(0x21c)](_0x24cd4b),_0x285fda=_0x47db5f[_0xa03b94(0x23e)]((_0x3c3864,_0x24d536)=>_0x3c3864[_0xa03b94(0x1ea)](_0x24d536[_0xa03b94(0x1c9)],_0x24d536),new Map());for(const _0x194bfc of _0x16d351){for(const _0x496273 in _0x194bfc['files']){const {base:_0x879493,name:_0x1cb17d,dir:_0x43dc1a}=path_1[_0xa03b94(0x1d0)]['parse'](_0x496273),_0x3d79d9=_0x1cb17d+veeva_constants_1['VeevaConstants'][_0xa03b94(0x1cc)];if(_0x285fda[_0xa03b94(0x1e1)](_0x879493)){const _0x431c5d=await((_0x5f15f9=_0x194bfc['file']([_0x43dc1a,_0x879493][_0xa03b94(0x1d5)](path_1[_0xa03b94(0x1d0)][_0xa03b94(0x1f3)][_0xa03b94(0x207)])))===null||_0x5f15f9===void 0x0?void 0x0:_0x5f15f9[_0xa03b94(0x212)](_0xa03b94(0x202))),_0x5bc6be=await((_0x5ba8b7=_0x194bfc[_0xa03b94(0x22c)]([_0x43dc1a,_0x3d79d9]['join'](path_1[_0xa03b94(0x1d0)][_0xa03b94(0x1f3)][_0xa03b94(0x207)])))===null||_0x5ba8b7===void 0x0?void 0x0:_0x5ba8b7[_0xa03b94(0x212)](_0xa03b94(0x202)));if(_0x431c5d){const _0xae6f74=new jszip_1[(_0xa03b94(0x1d0))]();_0xae6f74[_0xa03b94(0x22c)](_0x879493,_0x431c5d),_0x5bc6be&&_0xae6f74[_0xa03b94(0x22c)](_0x3d79d9,this[_0xa03b94(0x1dd)](_0x5bc6be)),_0x285fda[_0xa03b94(0x209)](_0x879493)[_0xa03b94(0x1da)]=await _0xae6f74['generateAsync']({'type':_0xa03b94(0x239)});}}}}return _0x47db5f[_0xa03b94(0x1fd)](_0x238707=>!_0x238707[_0xa03b94(0x1da)])[_0xa03b94(0x243)](_0xb8e1f8=>{const _0x509313=_0xa03b94;this[_0x509313(0x1cf)]['log'](_0x509313(0x21e)+_0xb8e1f8[_0x509313(0x21b)]+'.'+_0xb8e1f8['name']+'\x20from\x20outbound\x20package');}),_0x47db5f[_0xa03b94(0x1fd)](_0x21ad75=>_0x21ad75[_0xa03b94(0x1da)]);}[a395_0x88abc8(0x1dd)](_0x1d0248){const _0x5ce32a=a395_0x88abc8,_0x242e90=(0x0,sync_1['parse'])(_0x1d0248,{'columns':!![],'skip_empty_lines':!![]}),_0x424866=_0x242e90[_0x5ce32a(0x21d)](({'In\x20Package':_0x4e5918,..._0x1e0451})=>_0x1e0451);return(0x0,sync_2['stringify'])(_0x424866,{'header':!![]});}[a395_0x88abc8(0x21c)](_0x52debc){const _0x5e68b2=a395_0x88abc8;return _0x52debc[_0x5e68b2(0x21d)](_0xaeedb5=>{const _0x424120=_0x5e68b2,_0x507a28=new metadata_item_dto_1[(_0x424120(0x1d6))]();return _0x507a28['name']=_0xaeedb5[_0x424120(0x240)],_0x507a28[_0x424120(0x229)]=_0xaeedb5[_0x424120(0x240)],_0x507a28['snapshotId']=this[_0x424120(0x206)],_0x507a28[_0x424120(0x1c9)]=_0xaeedb5['type']+'.'+_0xaeedb5[_0x424120(0x240)]+veeva_constants_1[_0x424120(0x242)]['MDL_EXTENSION'],_0x507a28['veevaComponentType']=_0xaeedb5[_0x424120(0x1d3)],_0x507a28[_0x424120(0x1cb)]=_0xaeedb5['lastModifiedDate'],_0x507a28[_0x424120(0x217)]=![],_0x507a28;});}async[a395_0x88abc8(0x1ca)](_0x1aa674){const _0x3d6580=a395_0x88abc8;this[_0x3d6580(0x1cf)][_0x3d6580(0x227)]('Saving\x20Attachments.'),await this[_0x3d6580(0x1ee)](_0x1aa674),this[_0x3d6580(0x1cf)]['log'](_0x3d6580(0x1e3)+_0x1aa674[_0x3d6580(0x226)]+'\x20Metadata\x20Items');const _0x5d59d4=_0x1aa674['map'](_0x180db5=>{const _0x40f949=_0x3d6580;return{[constants_1['FLOSUM_NAMESPACE']+_0x40f949(0x23a)]:_0x180db5['name'],[constants_1[_0x40f949(0x21a)]+_0x40f949(0x236)]:_0x180db5[_0x40f949(0x229)],[constants_1[_0x40f949(0x21a)]+'Snapshot__c']:_0x180db5[_0x40f949(0x1e0)],[constants_1[_0x40f949(0x21a)]+_0x40f949(0x20c)]:_0x180db5[_0x40f949(0x1c9)],[constants_1['FLOSUM_NAMESPACE']+_0x40f949(0x1f5)]:_0x180db5[_0x40f949(0x217)],[constants_1[_0x40f949(0x21a)]+_0x40f949(0x1de)]:_0x180db5[_0x40f949(0x21b)],[constants_1[_0x40f949(0x21a)]+_0x40f949(0x208)]:_0x180db5[_0x40f949(0x220)],[constants_1[_0x40f949(0x21a)]+_0x40f949(0x1f2)]:_0x180db5[_0x40f949(0x1cb)]};}),_0x1b1172=await this[_0x3d6580(0x234)][_0x3d6580(0x244)](constants_1[_0x3d6580(0x21a)]+_0x3d6580(0x1d4),_0x5d59d4);let _0x2f00a9=!![];_0x1b1172[_0x3d6580(0x243)]((_0x7620e7,_0x33ed49)=>{const _0x4e17fa=_0x3d6580;this[_0x4e17fa(0x1cf)][_0x4e17fa(0x227)](_0x4e17fa(0x1e3)+_0x1aa674[_0x33ed49][_0x4e17fa(0x21b)]+'.'+_0x1aa674[_0x33ed49][_0x4e17fa(0x240)]);if(!_0x7620e7[_0x4e17fa(0x1fb)]){_0x2f00a9=![];const _0x4f83f4=new salesforce_dml_error_1['SalesforceDmlError'](_0x7620e7[_0x4e17fa(0x221)]);this['_logger'][_0x4e17fa(0x228)](_0x4f83f4);}});if(!_0x2f00a9)throw new Error(_0x3d6580(0x211));}async[a395_0x88abc8(0x1ee)](_0x1ca7cd){const _0x26fd7f=a395_0x88abc8,_0x4b3f97=this[_0x26fd7f(0x1c8)](_0x1ca7cd),_0x3a53f5=await this[_0x26fd7f(0x234)]['insertMultipleRecords'](SnapshotService[_0x26fd7f(0x230)],_0x4b3f97),_0x4d106b=[];_0x3a53f5[_0x26fd7f(0x243)]((_0x553d3a,_0x396358)=>{const _0x651d2=_0x26fd7f;_0x553d3a[_0x651d2(0x1fb)]?(_0x1ca7cd[_0x396358]['attachmentId']=_0x553d3a['id'],_0x1ca7cd[_0x396358][_0x651d2(0x217)]=!![]):_0x4d106b[_0x651d2(0x231)](..._0x553d3a['errors']);});if(_0x4d106b[_0x26fd7f(0x226)])throw new salesforce_dml_error_1[(_0x26fd7f(0x215))](_0x4d106b);}[a395_0x88abc8(0x1c8)](_0x35a973){const _0x580857=a395_0x88abc8;return _0x35a973[_0x580857(0x21d)](_0x5c2ea9=>({'ParentId':this['_snapshotId'],'Name':_0x5c2ea9[_0x580857(0x21b)],'ContentType':_0x580857(0x210),'Body':_0x5c2ea9[_0x580857(0x1da)],'Description':_0x5c2ea9[_0x580857(0x21b)]}));}async[a395_0x88abc8(0x1d2)](_0x11655c){const _0x17a7fc=a395_0x88abc8,_0x49cbd5={[constants_1[_0x17a7fc(0x21a)]+_0x17a7fc(0x213)]:!![],[constants_1[_0x17a7fc(0x21a)]+'Is_Error__c']:!_0x11655c},_0x384aff={[constants_1[_0x17a7fc(0x21a)]+_0x17a7fc(0x22a)]:!_0x11655c,[constants_1[_0x17a7fc(0x21a)]+_0x17a7fc(0x1dc)]:_0x11655c,[constants_1['FLOSUM_NAMESPACE']+'Status__c']:_0x11655c?status_enums_1['MetadataLogStatus'][_0x17a7fc(0x1e5)]:status_enums_1['MetadataLogStatus'][_0x17a7fc(0x1fc)],[constants_1[_0x17a7fc(0x21a)]+_0x17a7fc(0x216)]:!![]};await this[_0x17a7fc(0x20e)]['patch'](flosum_constants_1[_0x17a7fc(0x1f6)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x17a7fc(0x21a)]+_0x17a7fc(0x1fa)+this[_0x17a7fc(0x206)],_0x49cbd5),await this['_connectionSalesforce'][_0x17a7fc(0x20b)](flosum_constants_1[_0x17a7fc(0x1f6)][_0x17a7fc(0x1d1)]+'/'+constants_1[_0x17a7fc(0x21a)]+'Metadata_Log__c/'+this[_0x17a7fc(0x218)],_0x384aff),this['_logger'][_0x17a7fc(0x227)](_0x17a7fc(0x219)+(_0x11655c?_0x17a7fc(0x1e9):_0x17a7fc(0x241))+'.'),await this['_logger'][_0x17a7fc(0x20d)]();}}exports[a395_0x88abc8(0x225)]=SnapshotService,SnapshotService[a395_0x88abc8(0x1cd)]=a395_0x88abc8(0x1e6),SnapshotService[a395_0x88abc8(0x230)]='Attachment';