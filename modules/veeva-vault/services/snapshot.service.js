function a378_0x1015(_0x4e34a0,_0x4090e0){const _0x35b801=a378_0x7665();return a378_0x1015=function(_0x32ff2d,_0x431193){_0x32ff2d=_0x32ff2d-0xb2;let _0x7665d4=_0x35b801[_0x32ff2d];return _0x7665d4;},a378_0x1015(_0x4e34a0,_0x4090e0);}const a378_0x572075=a378_0x1015;(function(_0x390964,_0x287d47){const _0x4fa996=a378_0x1015,_0xc37e54=_0x390964();while(!![]){try{const _0x418ac1=-parseInt(_0x4fa996(0xeb))/0x1+parseInt(_0x4fa996(0xcf))/0x2+-parseInt(_0x4fa996(0x125))/0x3+-parseInt(_0x4fa996(0xc7))/0x4+parseInt(_0x4fa996(0xd0))/0x5*(-parseInt(_0x4fa996(0xc6))/0x6)+parseInt(_0x4fa996(0x109))/0x7*(parseInt(_0x4fa996(0x127))/0x8)+parseInt(_0x4fa996(0x120))/0x9;if(_0x418ac1===_0x287d47)break;else _0xc37e54['push'](_0xc37e54['shift']());}catch(_0x118cfe){_0xc37e54['push'](_0xc37e54['shift']());}}}(a378_0x7665,0xd720c));const a378_0x431193=(function(){let _0x3d2f8f=!![];return function(_0x1484ec,_0x4003cc){const _0x2036bf=_0x3d2f8f?function(){const _0x3494f6=a378_0x1015;if(_0x4003cc){const _0x52cd3f=_0x4003cc[_0x3494f6(0xb2)](_0x1484ec,arguments);return _0x4003cc=null,_0x52cd3f;}}:function(){};return _0x3d2f8f=![],_0x2036bf;};}()),a378_0x32ff2d=a378_0x431193(this,function(){const _0x497b51=a378_0x1015;return a378_0x32ff2d[_0x497b51(0xf6)]()['search'](_0x497b51(0xcd))[_0x497b51(0xf6)]()['constructor'](a378_0x32ff2d)[_0x497b51(0xec)](_0x497b51(0xcd));});a378_0x32ff2d();'use strict';function a378_0x7665(){const _0x4c585b=['../dtos/metadata-item.dto','../../../constants','TypeAndNameVeevaComponentRetriever','lastModifiedDate','_selectedComponentMap','FlosumConstants','files','transformDependencyFile','toString','FLOSUM_NAMESPACE','__importDefault','__esModule','reduce','TypeVeevaComponentRetriever','csv-parse/sync','successfully','Snapshot__c','Name__c','path','\x20Metadata\x20Items','retrieve','Snapshot\x20completed\x20','Veeva_Component_Type__c','get','_veevaService','logError','posix','3051937ayYsOQ','error','_logger','_metadataLogId','ENDPOINT_UPSERT_RECORD','Job_Completed__c','SalesforceDmlError','execute','type','Metadata_Item__c','saveAttachments','_packageExportService','saveComponentsInSalesforce','Snapshot\x20started.','formAttachments','_snapshotId','join','generateAsync','_selectedMetaTypes','Is_Error__c','Last_Modified_Date__c','with\x20error','Status__c','22578525nVRoqZ','_connectionSalesforce','from','../enums/status.enums','isRetrieved','4973553kVaeRf','updateLog','16qWaidz','_systemLogger','retrieveVeevaComponents','filter','MetadataLogStatus','SnapshotService','insertMultipleRecords','string','VeevaService','label','SalesforceService','MetadataItemDto','apply','set','map','csv-stringify/sync','parse','sep','veevaComponentType','application/zip','./package-export.service','createMetadataItemListWithBody','Is_Retrieved__c','Snapshot','export','../constants/veeva.constants','attachmentId','ATTACHMENT','forEach','Attachment_ID__c','OUTBOUND_PACKAGE_NAME','../classes/retrievers/veeva-components/type.veeva-component.retriever','3745362HgmOJU','756112vRwBfR','push','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','formMetadataItemDtoList','Saving\x20','_connectionVeeva','(((.+)+)+)+$','Cannot\x20Save\x20Metadata\x20Items','660286LKeAKr','5SJoAFS','length','values','Snapshot__c/','snapshotId','_whereClause','./salesforce.service','COMPLETED','Label__c','Saving\x20Attachments.','apiName','errors','file','patch','body','name','catch','API_Name__c','default','EXCEPTION','log','_salesforceService','success','../classes/errors/salesforce-dml-error','finishSnapshot','has','MDL_EXTENSION','358580kBjejh','search','PackageExportService'];a378_0x7665=function(){return _0x4c585b;};return a378_0x7665();}var __importDefault=this&&this[a378_0x572075(0xf8)]||function(_0x1eb087){const _0x776f56=a378_0x572075;return _0x1eb087&&_0x1eb087[_0x776f56(0xf9)]?_0x1eb087:{'default':_0x1eb087};};Object['defineProperty'](exports,a378_0x572075(0xf9),{'value':!![]}),exports[a378_0x572075(0x12c)]=void 0x0;const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require(a378_0x572075(0xee)),constants_1=require(a378_0x572075(0xef)),salesforce_service_1=require(a378_0x572075(0xd6)),status_enums_1=require(a378_0x572075(0x123)),salesforce_dml_error_1=require(a378_0x572075(0xe7)),package_export_service_1=require(a378_0x572075(0xba)),type_and_name_veeva_component_retriever_1=require(a378_0x572075(0xc9)),type_veeva_component_retriever_1=require(a378_0x572075(0xc5)),sync_1=require(a378_0x572075(0xfc)),sync_2=require(a378_0x572075(0xb5)),veeva_constants_1=require(a378_0x572075(0xbf)),path_1=__importDefault(require(a378_0x572075(0x100)));class SnapshotService{constructor({snapshotId:_0x4379d0,metadataLogId:_0x10ea56,selectedMetaTypes:_0xf47a09,selectedComponentMap:_0x34e656,whereClause:_0x41d903},_0x2dab72,_0x2bc647,_0x3321c2){const _0x6bebb1=a378_0x572075;this[_0x6bebb1(0x121)]=_0x2dab72,this['_connectionVeeva']=_0x2bc647,this[_0x6bebb1(0x10b)]=_0x3321c2,this[_0x6bebb1(0x118)]=_0x4379d0,this[_0x6bebb1(0x10c)]=_0x10ea56,this[_0x6bebb1(0x11b)]=_0xf47a09,this['_selectedComponentMap']=_0x34e656,this[_0x6bebb1(0xd5)]=_0x41d903,this[_0x6bebb1(0x106)]=new veeva_service_1[(_0x6bebb1(0x12f))]({'connection':this[_0x6bebb1(0xcc)],'logger':this[_0x6bebb1(0x10b)]}),this[_0x6bebb1(0xe5)]=new salesforce_service_1[(_0x6bebb1(0x131))]({'connection':this[_0x6bebb1(0x121)]}),this[_0x6bebb1(0x114)]=new package_export_service_1[(_0x6bebb1(0xed))]({'veevaService':this[_0x6bebb1(0x106)],'connection':this[_0x6bebb1(0xcc)],'logger':this[_0x6bebb1(0x10b)]});}async[a378_0x572075(0x110)](){const _0x51f382=a378_0x572075;try{this[_0x51f382(0x10b)]['log'](_0x51f382(0x116));const _0x498697=await this[_0x51f382(0x129)]();await this[_0x51f382(0x10b)][_0x51f382(0x126)]();const _0x41f311=await this[_0x51f382(0x114)][_0x51f382(0xbe)](_0x498697,SnapshotService[_0x51f382(0xc4)]);await this[_0x51f382(0x10b)][_0x51f382(0x126)]();const _0x22128e=await this['createMetadataItemListWithBody'](_0x498697,_0x41f311);await this[_0x51f382(0x115)](_0x22128e),await this[_0x51f382(0x10b)][_0x51f382(0x126)](),await this[_0x51f382(0xe8)](!![]);}catch(_0x440816){this[_0x51f382(0x10b)][_0x51f382(0x107)](_0x440816),await this[_0x51f382(0xe8)](![])[_0x51f382(0xe0)](_0x3d9df2=>this[_0x51f382(0x128)][_0x51f382(0x10a)](_0x3d9df2));}}async['retrieveVeevaComponents'](){const _0x2436bc=a378_0x572075,_0x3de3f6={'veevaService':this['_veevaService'],'logger':this[_0x2436bc(0x10b)]},_0x3d748f=Array[_0x2436bc(0x122)](Object[_0x2436bc(0xd2)](this[_0x2436bc(0xf2)]))[_0x2436bc(0xd1)]?new type_and_name_veeva_component_retriever_1[(_0x2436bc(0xf0))]({'value':this[_0x2436bc(0xf2)],..._0x3de3f6}):new type_veeva_component_retriever_1[(_0x2436bc(0xfb))]({'value':this[_0x2436bc(0x11b)],'whereClause':this['_whereClause'],..._0x3de3f6});return _0x3d748f[_0x2436bc(0x102)]();}async[a378_0x572075(0xbb)](_0x3630ca,_0x504be9){const _0x40e622=a378_0x572075;var _0x2d17c0,_0x5c5e38;this[_0x40e622(0x10b)][_0x40e622(0xe4)]('Unpack\x20zip\x20and\x20create\x20metadata\x20items.');const _0x3f94aa=this['formMetadataItemDtoList'](_0x3630ca),_0x3a8da0=_0x3f94aa[_0x40e622(0xfa)]((_0x202cdd,_0x578cc3)=>_0x202cdd[_0x40e622(0xb3)](_0x578cc3[_0x40e622(0x130)],_0x578cc3),new Map());for(const _0x1d3cff of _0x504be9){for(const _0x498f8d in _0x1d3cff[_0x40e622(0xf4)]){const {base:_0x36f3c1,name:_0x5c973c,dir:_0x48184a}=path_1[_0x40e622(0xe2)][_0x40e622(0xb6)](_0x498f8d),_0x595f9a=_0x5c973c+veeva_constants_1['VeevaConstants']['DEPENDENCY_EXTENSION'];if(_0x3a8da0[_0x40e622(0xe9)](_0x36f3c1)){const _0x1f382e=await((_0x2d17c0=_0x1d3cff['file']([_0x48184a,_0x36f3c1]['join'](path_1[_0x40e622(0xe2)][_0x40e622(0x108)]['sep'])))===null||_0x2d17c0===void 0x0?void 0x0:_0x2d17c0['async'](_0x40e622(0x12e))),_0x4bc28a=await((_0x5c5e38=_0x1d3cff[_0x40e622(0xdc)]([_0x48184a,_0x595f9a][_0x40e622(0x119)](path_1['default'][_0x40e622(0x108)][_0x40e622(0xb7)])))===null||_0x5c5e38===void 0x0?void 0x0:_0x5c5e38['async'](_0x40e622(0x12e)));if(_0x1f382e){const _0x34ed0d=new jszip_1['default']();_0x34ed0d['file'](_0x36f3c1,_0x1f382e),_0x4bc28a&&_0x34ed0d[_0x40e622(0xdc)](_0x595f9a,this['transformDependencyFile'](_0x4bc28a)),_0x3a8da0[_0x40e622(0x105)](_0x36f3c1)['body']=await _0x34ed0d[_0x40e622(0x11a)]({'type':'base64'});}}}}return _0x3f94aa[_0x40e622(0x12a)](_0x5e75d8=>!_0x5e75d8[_0x40e622(0xde)])['forEach'](_0x1f7a97=>{const _0x1a7b81=_0x40e622;this['_logger'][_0x1a7b81(0xe4)]('Cannot\x20retrieve\x20'+_0x1f7a97[_0x1a7b81(0xb8)]+'.'+_0x1f7a97[_0x1a7b81(0xdf)]+'\x20from\x20outbound\x20package');}),_0x3f94aa['filter'](_0x4f5f82=>_0x4f5f82['body']);}[a378_0x572075(0xf5)](_0x38f143){const _0x12eaa6=a378_0x572075,_0x1b5a9c=(0x0,sync_1[_0x12eaa6(0xb6)])(_0x38f143,{'columns':!![],'skip_empty_lines':!![]}),_0xedb0db=_0x1b5a9c[_0x12eaa6(0xb4)](({'In\x20Package':_0x437544,..._0xffe8a0})=>_0xffe8a0);return(0x0,sync_2['stringify'])(_0xedb0db,{'header':!![]});}[a378_0x572075(0xca)](_0x1001d0){return _0x1001d0['map'](_0x1d2d8c=>{const _0x588dc5=a378_0x1015,_0x36e56e=new metadata_item_dto_1[(_0x588dc5(0x132))]();return _0x36e56e[_0x588dc5(0xdf)]=_0x1d2d8c[_0x588dc5(0xdf)],_0x36e56e[_0x588dc5(0xda)]=_0x1d2d8c[_0x588dc5(0xdf)],_0x36e56e['snapshotId']=this['_snapshotId'],_0x36e56e['label']=_0x1d2d8c[_0x588dc5(0x111)]+'.'+_0x1d2d8c[_0x588dc5(0xdf)]+veeva_constants_1['VeevaConstants'][_0x588dc5(0xea)],_0x36e56e[_0x588dc5(0xb8)]=_0x1d2d8c[_0x588dc5(0x111)],_0x36e56e[_0x588dc5(0xf1)]=_0x1d2d8c['lastModifiedDate'],_0x36e56e[_0x588dc5(0x124)]=![],_0x36e56e;});}async['saveComponentsInSalesforce'](_0x32d524){const _0x24d908=a378_0x572075;this['_logger'][_0x24d908(0xe4)](_0x24d908(0xd9)),await this[_0x24d908(0x113)](_0x32d524),this['_logger'][_0x24d908(0xe4)](_0x24d908(0xcb)+_0x32d524[_0x24d908(0xd1)]+_0x24d908(0x101));const _0x31b80b=_0x32d524[_0x24d908(0xb4)](_0x116528=>{const _0x3d0d98=_0x24d908;return{[constants_1[_0x3d0d98(0xf7)]+_0x3d0d98(0xff)]:_0x116528[_0x3d0d98(0xdf)],[constants_1[_0x3d0d98(0xf7)]+_0x3d0d98(0xe1)]:_0x116528[_0x3d0d98(0xda)],[constants_1[_0x3d0d98(0xf7)]+_0x3d0d98(0xfe)]:_0x116528[_0x3d0d98(0xd4)],[constants_1[_0x3d0d98(0xf7)]+_0x3d0d98(0xd8)]:_0x116528[_0x3d0d98(0x130)],[constants_1['FLOSUM_NAMESPACE']+_0x3d0d98(0xbc)]:_0x116528['isRetrieved'],[constants_1[_0x3d0d98(0xf7)]+_0x3d0d98(0x104)]:_0x116528[_0x3d0d98(0xb8)],[constants_1[_0x3d0d98(0xf7)]+_0x3d0d98(0xc3)]:_0x116528['attachmentId'],[constants_1[_0x3d0d98(0xf7)]+_0x3d0d98(0x11d)]:_0x116528[_0x3d0d98(0xf1)]};}),_0x500996=await this[_0x24d908(0xe5)][_0x24d908(0x12d)](constants_1[_0x24d908(0xf7)]+_0x24d908(0x112),_0x31b80b);let _0x45ec2d=!![];_0x500996[_0x24d908(0xc2)]((_0x1bfffb,_0x1fe28f)=>{const _0x38544c=_0x24d908;this['_logger'][_0x38544c(0xe4)]('Saving\x20'+_0x32d524[_0x1fe28f]['veevaComponentType']+'.'+_0x32d524[_0x1fe28f][_0x38544c(0xdf)]);if(!_0x1bfffb[_0x38544c(0xe6)]){_0x45ec2d=![];const _0x122a2e=new salesforce_dml_error_1[(_0x38544c(0x10f))](_0x1bfffb['errors']);this[_0x38544c(0x10b)]['logError'](_0x122a2e);}});if(!_0x45ec2d)throw new Error(_0x24d908(0xce));}async['saveAttachments'](_0x435194){const _0x1d67db=a378_0x572075,_0x5622ab=this[_0x1d67db(0x117)](_0x435194),_0x4687f0=await this[_0x1d67db(0xe5)][_0x1d67db(0x12d)](SnapshotService[_0x1d67db(0xc1)],_0x5622ab),_0x3d5bb2=[];_0x4687f0[_0x1d67db(0xc2)]((_0x3b3321,_0x2843f2)=>{const _0x4b5bf4=_0x1d67db;_0x3b3321[_0x4b5bf4(0xe6)]?(_0x435194[_0x2843f2][_0x4b5bf4(0xc0)]=_0x3b3321['id'],_0x435194[_0x2843f2][_0x4b5bf4(0x124)]=!![]):_0x3d5bb2[_0x4b5bf4(0xc8)](..._0x3b3321[_0x4b5bf4(0xdb)]);});if(_0x3d5bb2[_0x1d67db(0xd1)])throw new salesforce_dml_error_1[(_0x1d67db(0x10f))](_0x3d5bb2);}[a378_0x572075(0x117)](_0x3dd601){const _0x370354=a378_0x572075;return _0x3dd601[_0x370354(0xb4)](_0x20702a=>({'ParentId':this[_0x370354(0x118)],'Name':_0x20702a[_0x370354(0xb8)],'ContentType':_0x370354(0xb9),'Body':_0x20702a[_0x370354(0xde)],'Description':_0x20702a[_0x370354(0xb8)]}));}async[a378_0x572075(0xe8)](_0x19179f){const _0x3a6c85=a378_0x572075,_0x17b021={[constants_1[_0x3a6c85(0xf7)]+'Is_Completed__c']:!![],[constants_1[_0x3a6c85(0xf7)]+_0x3a6c85(0x11c)]:!_0x19179f},_0x1d46e9={[constants_1[_0x3a6c85(0xf7)]+'Is_Error__c']:!_0x19179f,[constants_1[_0x3a6c85(0xf7)]+'Succeed__c']:_0x19179f,[constants_1['FLOSUM_NAMESPACE']+_0x3a6c85(0x11f)]:_0x19179f?status_enums_1[_0x3a6c85(0x12b)][_0x3a6c85(0xd7)]:status_enums_1[_0x3a6c85(0x12b)][_0x3a6c85(0xe3)],[constants_1[_0x3a6c85(0xf7)]+_0x3a6c85(0x10e)]:!![]};await this[_0x3a6c85(0x121)][_0x3a6c85(0xdd)](flosum_constants_1[_0x3a6c85(0xf3)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x3a6c85(0xf7)]+_0x3a6c85(0xd3)+this[_0x3a6c85(0x118)],_0x17b021),await this[_0x3a6c85(0x121)][_0x3a6c85(0xdd)](flosum_constants_1['FlosumConstants'][_0x3a6c85(0x10d)]+'/'+constants_1[_0x3a6c85(0xf7)]+'Metadata_Log__c/'+this[_0x3a6c85(0x10c)],_0x1d46e9),this[_0x3a6c85(0x10b)][_0x3a6c85(0xe4)](_0x3a6c85(0x103)+(_0x19179f?_0x3a6c85(0xfd):_0x3a6c85(0x11e))+'.'),await this[_0x3a6c85(0x10b)][_0x3a6c85(0x126)]();}}exports[a378_0x572075(0x12c)]=SnapshotService,SnapshotService[a378_0x572075(0xc4)]=a378_0x572075(0xbd),SnapshotService[a378_0x572075(0xc1)]='Attachment';