const a362_0x393b3b=a362_0x4e5a;(function(_0x10c386,_0x4222f1){const _0x125b26=a362_0x4e5a,_0x43f4b7=_0x10c386();while(!![]){try{const _0x251671=parseInt(_0x125b26(0x244))/0x1+-parseInt(_0x125b26(0x202))/0x2*(-parseInt(_0x125b26(0x209))/0x3)+parseInt(_0x125b26(0x24a))/0x4+parseInt(_0x125b26(0x232))/0x5+parseInt(_0x125b26(0x23a))/0x6+parseInt(_0x125b26(0x23e))/0x7+parseInt(_0x125b26(0x208))/0x8*(-parseInt(_0x125b26(0x239))/0x9);if(_0x251671===_0x4222f1)break;else _0x43f4b7['push'](_0x43f4b7['shift']());}catch(_0x584090){_0x43f4b7['push'](_0x43f4b7['shift']());}}}(a362_0x12a4,0xca0cd));const a362_0x4b9c40=(function(){let _0x56730e=!![];return function(_0x503de2,_0x3d2d90){const _0x521cbc=_0x56730e?function(){if(_0x3d2d90){const _0x4fd6d6=_0x3d2d90['apply'](_0x503de2,arguments);return _0x3d2d90=null,_0x4fd6d6;}}:function(){};return _0x56730e=![],_0x521cbc;};}()),a362_0x1c3e57=a362_0x4b9c40(this,function(){const _0x45bb3f=a362_0x4e5a;return a362_0x1c3e57[_0x45bb3f(0x1f2)]()[_0x45bb3f(0x267)](_0x45bb3f(0x1fc))[_0x45bb3f(0x1f2)]()[_0x45bb3f(0x266)](a362_0x1c3e57)[_0x45bb3f(0x267)](_0x45bb3f(0x1fc));});a362_0x1c3e57();'use strict';var __importDefault=this&&this[a362_0x393b3b(0x265)]||function(_0x149806){const _0x1867d1=a362_0x393b3b;return _0x149806&&_0x149806[_0x1867d1(0x24f)]?_0x149806:{'default':_0x149806};};Object[a362_0x393b3b(0x220)](exports,'__esModule',{'value':!![]}),exports[a362_0x393b3b(0x254)]=void 0x0;function a362_0x12a4(){const _0x5a5f2f=['attachmentId','veevaComponentType','_selectedMetaTypes','Cannot\x20Save\x20Metadata\x20Items','../constants/flosum.constants','8XRpdYe','202074ZNlouY','execute','Is_Completed__c','_logger','\x20Metadata\x20Items','retrieve','type','Snapshot\x20started.','body','createMetadataItemListWithBody','Label__c','success','jszip','\x20from\x20outbound\x20package','string','logError','Is_Error__c','async','Status__c','_snapshotId','saveComponentsInSalesforce','reduce','../constants/veeva.constants','defineProperty','Cannot\x20retrieve\x20','Saving\x20Attachments.','TypeVeevaComponentRetriever','VeevaConstants','with\x20error','error','_systemLogger','push','COMPLETED','name','FLOSUM_NAMESPACE','length','_salesforceService','base64','../enums/status.enums','snapshotId','ENDPOINT_UPSERT_RECORD','5945fVYpzX','Metadata_Item__c','OUTBOUND_PACKAGE_NAME','patch','_timeZone','Snapshot','./package-export.service','23871492CyGDRa','5375070cisOUo','parse','files','lastModifiedDate','4091717GEzSoN','../../../constants','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','_connectionSalesforce','Is_Retrieved__c','retrieveVeevaComponents','1572456RAEfEc','set','forEach','updateLog','from','_connectionVeeva','1434424zRBZup','generateAsync','errors','finishSnapshot','export','__esModule','Job_Completed__c','PackageExportService','values','_veevaService','SnapshotService','application/zip','API_Name__c','_packageExportService','csv-parse/sync','default','filter','_metadataLogId','insertMultipleRecords','Snapshot__c/','selectedComponentMap','apiName','Saving\x20','label','attachmentLogId','Attachment_ID__c','SalesforceDmlError','__importDefault','constructor','search','formAttachments','ATTACHMENT','MetadataLogStatus','_selectedComponentMap','timeZone','log','csv-stringify/sync','FlosumConstants','MDL_EXTENSION','Veeva_Component_Type__c','toString','formMetadataItemDtoList','../classes/errors/salesforce-dml-error','Last_Modified_Date__c','saveAttachments','metadataLogId','VeevaService','join','selectedMetaTypes','catch','(((.+)+)+)+$','get','Name__c','file','map','isRetrieved','2qnazqd'];a362_0x12a4=function(){return _0x5a5f2f;};return a362_0x12a4();}const jszip_1=__importDefault(require(a362_0x393b3b(0x215))),flosum_constants_1=require(a362_0x393b3b(0x207)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a362_0x393b3b(0x23f)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a362_0x393b3b(0x22f)),salesforce_dml_error_1=require(a362_0x393b3b(0x1f4)),package_export_service_1=require(a362_0x393b3b(0x238)),type_and_name_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever'),type_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type.veeva-component.retriever'),sync_1=require(a362_0x393b3b(0x258)),sync_2=require(a362_0x393b3b(0x1ee)),veeva_constants_1=require(a362_0x393b3b(0x21f)),path_1=__importDefault(require('path'));function a362_0x4e5a(_0x5dd261,_0x467c14){const _0x326cec=a362_0x12a4();return a362_0x4e5a=function(_0x1c3e57,_0x4b9c40){_0x1c3e57=_0x1c3e57-0x1e9;let _0x12a450=_0x326cec[_0x1c3e57];return _0x12a450;},a362_0x4e5a(_0x5dd261,_0x467c14);}class SnapshotService{constructor(_0x38d906,_0x1dac72,_0x187f6f,_0x188712){const _0x149174=a362_0x393b3b;this['_connectionSalesforce']=_0x1dac72,this[_0x149174(0x249)]=_0x187f6f,this[_0x149174(0x20c)]=_0x188712,this['_snapshotId']=_0x38d906[_0x149174(0x230)],this[_0x149174(0x25b)]=_0x38d906[_0x149174(0x1f7)],this['_attachmentLogId']=_0x38d906[_0x149174(0x262)],this[_0x149174(0x236)]=_0x38d906[_0x149174(0x1ec)],this[_0x149174(0x205)]=_0x38d906[_0x149174(0x1fa)],this[_0x149174(0x1eb)]=_0x38d906[_0x149174(0x25e)],this['_veevaService']=new veeva_service_1[(_0x149174(0x1f8))]({'connection':this['_connectionVeeva'],'logger':this[_0x149174(0x20c)]}),this[_0x149174(0x22d)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x149174(0x241)]}),this['_packageExportService']=new package_export_service_1[(_0x149174(0x251))]({'veevaService':this[_0x149174(0x253)],'connection':this[_0x149174(0x249)],'logger':this[_0x149174(0x20c)]});}async[a362_0x393b3b(0x20a)](){const _0xb1ea8=a362_0x393b3b;try{this['_logger'][_0xb1ea8(0x1ed)](_0xb1ea8(0x210));const _0x3379f9=await this[_0xb1ea8(0x243)]();await this[_0xb1ea8(0x20c)][_0xb1ea8(0x247)]();const _0x2cd34b=await this[_0xb1ea8(0x257)][_0xb1ea8(0x24e)](_0x3379f9,SnapshotService[_0xb1ea8(0x234)]);await this[_0xb1ea8(0x20c)]['updateLog']();const _0x4b3b98=await this['createMetadataItemListWithBody'](_0x3379f9,_0x2cd34b);await this[_0xb1ea8(0x21d)](_0x4b3b98),await this['_logger'][_0xb1ea8(0x247)](),await this[_0xb1ea8(0x24d)](!![]);}catch(_0x4b6752){this[_0xb1ea8(0x20c)][_0xb1ea8(0x218)](_0x4b6752),await this[_0xb1ea8(0x24d)](![])[_0xb1ea8(0x1fb)](_0xd2be56=>this[_0xb1ea8(0x227)][_0xb1ea8(0x226)](_0xd2be56));}}async[a362_0x393b3b(0x243)](){const _0x223c1f=a362_0x393b3b,_0x4db403={'veevaService':this[_0x223c1f(0x253)],'logger':this[_0x223c1f(0x20c)]},_0x2f4168=Array[_0x223c1f(0x248)](Object[_0x223c1f(0x252)](this[_0x223c1f(0x1eb)]))[_0x223c1f(0x22c)]?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x223c1f(0x1eb)],..._0x4db403}):new type_veeva_component_retriever_1[(_0x223c1f(0x223))]({'value':this['_selectedMetaTypes'],..._0x4db403});return _0x2f4168[_0x223c1f(0x20e)]();}async[a362_0x393b3b(0x212)](_0x38da4,_0x29da26){const _0x394d3d=a362_0x393b3b;var _0x51a4e4,_0x473c07;this[_0x394d3d(0x20c)][_0x394d3d(0x1ed)](_0x394d3d(0x240));const _0x230897=this[_0x394d3d(0x1f3)](_0x38da4),_0x10365f=_0x230897[_0x394d3d(0x21e)]((_0x1676a8,_0x2fc37f)=>_0x1676a8[_0x394d3d(0x245)](_0x2fc37f['label'],_0x2fc37f),new Map());for(const _0x4c02bc of _0x29da26){for(const _0x2abec1 in _0x4c02bc[_0x394d3d(0x23c)]){const {base:_0x508d3f,name:_0xe30b66,dir:_0x23d283}=path_1[_0x394d3d(0x259)]['parse'](_0x2abec1),_0x5bc7d2=_0xe30b66+veeva_constants_1[_0x394d3d(0x224)]['DEPENDENCY_EXTENSION'];if(_0x10365f['has'](_0x508d3f)){const _0x303a38=await((_0x51a4e4=_0x4c02bc['file'](path_1['default'][_0x394d3d(0x1f9)](_0x23d283,_0x508d3f)))===null||_0x51a4e4===void 0x0?void 0x0:_0x51a4e4[_0x394d3d(0x21a)](_0x394d3d(0x217))),_0x166aa9=await((_0x473c07=_0x4c02bc[_0x394d3d(0x1ff)](path_1[_0x394d3d(0x259)][_0x394d3d(0x1f9)](_0x23d283,_0x5bc7d2)))===null||_0x473c07===void 0x0?void 0x0:_0x473c07['async'](_0x394d3d(0x217)));if(_0x303a38&&_0x166aa9){const _0x141ce8=new jszip_1[(_0x394d3d(0x259))]();_0x141ce8[_0x394d3d(0x1ff)](_0x508d3f,_0x303a38),_0x141ce8[_0x394d3d(0x1ff)](_0x5bc7d2,this['transformDependencyFile'](_0x166aa9)),_0x10365f[_0x394d3d(0x1fd)](_0x508d3f)['body']=await _0x141ce8[_0x394d3d(0x24b)]({'type':_0x394d3d(0x22e)});}}}}return _0x230897['filter'](_0x3ba77e=>!_0x3ba77e[_0x394d3d(0x211)])['forEach'](_0x23f250=>{const _0x13febe=_0x394d3d;this[_0x13febe(0x20c)][_0x13febe(0x1ed)](_0x13febe(0x221)+_0x23f250[_0x13febe(0x204)]+'.'+_0x23f250[_0x13febe(0x22a)]+_0x13febe(0x216));}),_0x230897[_0x394d3d(0x25a)](_0x1158a1=>_0x1158a1[_0x394d3d(0x211)]);}['transformDependencyFile'](_0x410c17){const _0xae1db0=a362_0x393b3b,_0x1d615e=(0x0,sync_1[_0xae1db0(0x23b)])(_0x410c17,{'columns':!![],'skip_empty_lines':!![]}),_0x40165f=_0x1d615e[_0xae1db0(0x200)](({'In\x20Package':_0x37df0b,..._0x490522})=>_0x490522);return(0x0,sync_2['stringify'])(_0x40165f,{'header':!![]});}[a362_0x393b3b(0x1f3)](_0x16119c){const _0x4b23a6=a362_0x393b3b;return _0x16119c[_0x4b23a6(0x200)](_0x37c391=>{const _0x5ff18c=_0x4b23a6,_0x5a3872=new metadata_item_dto_1['MetadataItemDto']();return _0x5a3872['name']=_0x37c391[_0x5ff18c(0x22a)],_0x5a3872[_0x5ff18c(0x25f)]=_0x37c391[_0x5ff18c(0x22a)],_0x5a3872[_0x5ff18c(0x230)]=this[_0x5ff18c(0x21c)],_0x5a3872[_0x5ff18c(0x261)]=_0x37c391[_0x5ff18c(0x20f)]+'.'+_0x37c391['name']+veeva_constants_1[_0x5ff18c(0x224)][_0x5ff18c(0x1f0)],_0x5a3872['veevaComponentType']=_0x37c391[_0x5ff18c(0x20f)],_0x5a3872[_0x5ff18c(0x23d)]=_0x37c391[_0x5ff18c(0x23d)],_0x5a3872[_0x5ff18c(0x201)]=![],_0x5a3872;});}async[a362_0x393b3b(0x21d)](_0x47ab56){const _0x5b485a=a362_0x393b3b;this['_logger'][_0x5b485a(0x1ed)](_0x5b485a(0x222)),await this[_0x5b485a(0x1f6)](_0x47ab56),this[_0x5b485a(0x20c)][_0x5b485a(0x1ed)](_0x5b485a(0x260)+_0x47ab56[_0x5b485a(0x22c)]+_0x5b485a(0x20d));const _0x1ae9b0=_0x47ab56['map'](_0x1f2036=>{const _0x136950=_0x5b485a;return{[constants_1['FLOSUM_NAMESPACE']+_0x136950(0x1fe)]:_0x1f2036[_0x136950(0x22a)],[constants_1['FLOSUM_NAMESPACE']+_0x136950(0x256)]:_0x1f2036['apiName'],[constants_1[_0x136950(0x22b)]+'Snapshot__c']:_0x1f2036[_0x136950(0x230)],[constants_1['FLOSUM_NAMESPACE']+_0x136950(0x213)]:_0x1f2036[_0x136950(0x261)],[constants_1[_0x136950(0x22b)]+_0x136950(0x242)]:_0x1f2036['isRetrieved'],[constants_1[_0x136950(0x22b)]+_0x136950(0x1f1)]:_0x1f2036[_0x136950(0x204)],[constants_1[_0x136950(0x22b)]+_0x136950(0x263)]:_0x1f2036[_0x136950(0x203)],[constants_1['FLOSUM_NAMESPACE']+_0x136950(0x1f5)]:_0x1f2036[_0x136950(0x23d)]};}),_0x1895f1=await this[_0x5b485a(0x22d)][_0x5b485a(0x25c)](constants_1[_0x5b485a(0x22b)]+_0x5b485a(0x233),_0x1ae9b0);let _0x3b2a38=!![];_0x1895f1['forEach']((_0x339698,_0x342d1e)=>{const _0x28f005=_0x5b485a;this[_0x28f005(0x20c)][_0x28f005(0x1ed)](_0x28f005(0x260)+_0x47ab56[_0x342d1e][_0x28f005(0x204)]+'.'+_0x47ab56[_0x342d1e][_0x28f005(0x22a)]);if(!_0x339698[_0x28f005(0x214)]){_0x3b2a38=![];const _0x4e48c1=new salesforce_dml_error_1[(_0x28f005(0x264))](_0x339698['errors']);this[_0x28f005(0x20c)][_0x28f005(0x218)](_0x4e48c1);}});if(!_0x3b2a38)throw new Error(_0x5b485a(0x206));}async[a362_0x393b3b(0x1f6)](_0x3934bf){const _0x94a206=a362_0x393b3b,_0x45f6f2=this[_0x94a206(0x268)](_0x3934bf),_0x3a830e=await this[_0x94a206(0x22d)]['insertMultipleRecords'](SnapshotService[_0x94a206(0x1e9)],_0x45f6f2),_0x3be081=[];_0x3a830e[_0x94a206(0x246)]((_0x463b2f,_0x19e277)=>{const _0x54506c=_0x94a206;_0x463b2f[_0x54506c(0x214)]?(_0x3934bf[_0x19e277]['attachmentId']=_0x463b2f['id'],_0x3934bf[_0x19e277]['isRetrieved']=!![]):_0x3be081[_0x54506c(0x228)](..._0x463b2f[_0x54506c(0x24c)]);});if(_0x3be081[_0x94a206(0x22c)])throw new salesforce_dml_error_1[(_0x94a206(0x264))](_0x3be081);}[a362_0x393b3b(0x268)](_0x340e2a){const _0x5da90a=a362_0x393b3b;return _0x340e2a['map'](_0x3f7bab=>({'ParentId':this[_0x5da90a(0x21c)],'Name':_0x3f7bab[_0x5da90a(0x204)],'ContentType':_0x5da90a(0x255),'Body':_0x3f7bab[_0x5da90a(0x211)],'Description':_0x3f7bab['veevaComponentType']}));}async['finishSnapshot'](_0x414765){const _0x33dcbc=a362_0x393b3b,_0x57bfff={[constants_1[_0x33dcbc(0x22b)]+_0x33dcbc(0x20b)]:!![],[constants_1[_0x33dcbc(0x22b)]+'Is_Error__c']:!_0x414765},_0x1de0a0={[constants_1[_0x33dcbc(0x22b)]+_0x33dcbc(0x219)]:!_0x414765,[constants_1[_0x33dcbc(0x22b)]+'Succeed__c']:_0x414765,[constants_1[_0x33dcbc(0x22b)]+_0x33dcbc(0x21b)]:_0x414765?status_enums_1['MetadataLogStatus'][_0x33dcbc(0x229)]:status_enums_1[_0x33dcbc(0x1ea)]['EXCEPTION'],[constants_1[_0x33dcbc(0x22b)]+_0x33dcbc(0x250)]:!![]};await this[_0x33dcbc(0x241)]['patch'](flosum_constants_1[_0x33dcbc(0x1ef)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x33dcbc(0x22b)]+_0x33dcbc(0x25d)+this[_0x33dcbc(0x21c)],_0x57bfff),await this[_0x33dcbc(0x241)][_0x33dcbc(0x235)](flosum_constants_1['FlosumConstants'][_0x33dcbc(0x231)]+'/'+constants_1[_0x33dcbc(0x22b)]+'Metadata_Log__c/'+this[_0x33dcbc(0x25b)],_0x1de0a0),this[_0x33dcbc(0x20c)][_0x33dcbc(0x1ed)]('Snapshot\x20completed\x20'+(_0x414765?'successfully':_0x33dcbc(0x225))+'.'),await this['_logger'][_0x33dcbc(0x247)]();}}exports[a362_0x393b3b(0x254)]=SnapshotService,SnapshotService[a362_0x393b3b(0x234)]=a362_0x393b3b(0x237),SnapshotService[a362_0x393b3b(0x1e9)]='Attachment';