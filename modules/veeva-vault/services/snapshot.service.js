const a363_0x369a5e=a363_0x40af;(function(_0x2d55fb,_0x532b82){const _0x539bff=a363_0x40af,_0x256a37=_0x2d55fb();while(!![]){try{const _0x52da2e=parseInt(_0x539bff(0xde))/0x1+parseInt(_0x539bff(0xbe))/0x2+parseInt(_0x539bff(0xbd))/0x3+parseInt(_0x539bff(0xb0))/0x4+-parseInt(_0x539bff(0xa0))/0x5*(-parseInt(_0x539bff(0xb6))/0x6)+-parseInt(_0x539bff(0xf1))/0x7+-parseInt(_0x539bff(0xe7))/0x8*(parseInt(_0x539bff(0xd4))/0x9);if(_0x52da2e===_0x532b82)break;else _0x256a37['push'](_0x256a37['shift']());}catch(_0x162574){_0x256a37['push'](_0x256a37['shift']());}}}(a363_0x260d,0x3085a));const a363_0x2eda89=(function(){let _0x50e8cd=!![];return function(_0x4d43b7,_0x50a91b){const _0x4d05d9=_0x50e8cd?function(){const _0x2eac43=a363_0x40af;if(_0x50a91b){const _0x1e4be6=_0x50a91b[_0x2eac43(0xce)](_0x4d43b7,arguments);return _0x50a91b=null,_0x1e4be6;}}:function(){};return _0x50e8cd=![],_0x4d05d9;};}()),a363_0x5e52a9=a363_0x2eda89(this,function(){const _0x558bb3=a363_0x40af;return a363_0x5e52a9[_0x558bb3(0x8e)]()[_0x558bb3(0xc2)](_0x558bb3(0x79))[_0x558bb3(0x8e)]()[_0x558bb3(0xd3)](a363_0x5e52a9)[_0x558bb3(0xc2)](_0x558bb3(0x79));});a363_0x5e52a9();'use strict';function a363_0x40af(_0x3d4b60,_0x11b44c){const _0x5563f5=a363_0x260d();return a363_0x40af=function(_0x5e52a9,_0x2eda89){_0x5e52a9=_0x5e52a9-0x79;let _0x260dff=_0x5563f5[_0x5e52a9];return _0x260dff;},a363_0x40af(_0x3d4b60,_0x11b44c);}var __importDefault=this&&this[a363_0x369a5e(0xb1)]||function(_0x403d2b){const _0x524d92=a363_0x369a5e;return _0x403d2b&&_0x403d2b[_0x524d92(0xba)]?_0x403d2b:{'default':_0x403d2b};};Object[a363_0x369a5e(0xeb)](exports,'__esModule',{'value':!![]}),exports[a363_0x369a5e(0xaa)]=void 0x0;const jszip_1=__importDefault(require(a363_0x369a5e(0x95))),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require(a363_0x369a5e(0xaf)),metadata_item_dto_1=require(a363_0x369a5e(0xbb)),constants_1=require(a363_0x369a5e(0xb9)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a363_0x369a5e(0xc8)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require(a363_0x369a5e(0xf0)),type_and_name_veeva_component_retriever_1=require(a363_0x369a5e(0x98)),type_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type.veeva-component.retriever'),sync_1=require(a363_0x369a5e(0x8f)),sync_2=require(a363_0x369a5e(0xb3)),veeva_constants_1=require(a363_0x369a5e(0xc3)),path_1=__importDefault(require('path'));function a363_0x260d(){const _0x54e47c=['success','./package-export.service','1973636rpJXzs','COMPLETED','retrieve','DEPENDENCY_EXTENSION','(((.+)+)+)+$','parse','catch','_snapshotId','Snapshot__c','formAttachments','_packageExportService','string','OUTBOUND_PACKAGE_NAME','posix','_veevaService','retrieveVeevaComponents','label','log','MetadataLogStatus','MetadataItemDto','VeevaConstants','Succeed__c','\x20from\x20outbound\x20package','async','Name__c','toString','csv-parse/sync','\x20Metadata\x20Items','FlosumConstants','type','_selectedMetaTypes','with\x20error','jszip','_salesforceService','Is_Completed__c','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','map','finishSnapshot','Saving\x20Attachments.','successfully','VeevaService','default','Snapshot','195VUmZSb','values','Veeva_Component_Type__c','ATTACHMENT','FLOSUM_NAMESPACE','createMetadataItemListWithBody','sep','_whereClause','saveAttachments','reduce','SnapshotService','filter','Attachment','ENDPOINT_UPSERT_RECORD','isRetrieved','./veeva.service','536736oWvXnp','__importDefault','generateAsync','csv-stringify/sync','Snapshot\x20started.','push','27282MBbdeU','Snapshot\x20completed\x20','transformDependencyFile','../../../constants','__esModule','../dtos/metadata-item.dto','errors','811488aFXHpg','755862KEYvVR','_connectionVeeva','SalesforceDmlError','_logger','search','../constants/veeva.constants','lastModifiedDate','Saving\x20','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','forEach','../enums/status.enums','PackageExportService','stringify','name','base64','length','apply','veevaComponentType','attachmentId','files','MDL_EXTENSION','constructor','18qPczeT','_connectionSalesforce','updateLog','formMetadataItemDtoList','Last_Modified_Date__c','file','join','snapshotId','TypeVeevaComponentRetriever','patch','211346yNsikC','execute','Attachment_ID__c','body','Cannot\x20retrieve\x20','insertMultipleRecords','Job_Completed__c','Metadata_Item__c','Metadata_Log__c/','2762384OwwyQd','from','Is_Retrieved__c','saveComponentsInSalesforce','defineProperty','_metadataLogId','_selectedComponentMap','Is_Error__c'];a363_0x260d=function(){return _0x54e47c;};return a363_0x260d();}class SnapshotService{constructor({snapshotId:_0x63453f,metadataLogId:_0x2e9976,selectedMetaTypes:_0x3bb1d1,selectedComponentMap:_0x2d8092,whereClause:_0x2896c6},_0x167916,_0x20f99c,_0x8b89b2){const _0x2cb65d=a363_0x369a5e;this['_connectionSalesforce']=_0x167916,this[_0x2cb65d(0xbf)]=_0x20f99c,this[_0x2cb65d(0xc1)]=_0x8b89b2,this[_0x2cb65d(0x7c)]=_0x63453f,this[_0x2cb65d(0xec)]=_0x2e9976,this[_0x2cb65d(0x93)]=_0x3bb1d1,this[_0x2cb65d(0xed)]=_0x2d8092,this[_0x2cb65d(0xa7)]=_0x2896c6,this['_veevaService']=new veeva_service_1[(_0x2cb65d(0x9d))]({'connection':this['_connectionVeeva'],'logger':this[_0x2cb65d(0xc1)]}),this[_0x2cb65d(0x96)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x2cb65d(0xd5)]}),this[_0x2cb65d(0x7f)]=new package_export_service_1[(_0x2cb65d(0xc9))]({'veevaService':this[_0x2cb65d(0x83)],'connection':this['_connectionVeeva'],'logger':this[_0x2cb65d(0xc1)]});}async[a363_0x369a5e(0xdf)](){const _0x23fec4=a363_0x369a5e;try{this[_0x23fec4(0xc1)][_0x23fec4(0x86)](_0x23fec4(0xb4));const _0x25c4b9=await this[_0x23fec4(0x84)]();await this[_0x23fec4(0xc1)][_0x23fec4(0xd6)]();const _0x425bd1=await this['_packageExportService']['export'](_0x25c4b9,SnapshotService[_0x23fec4(0x81)]);await this[_0x23fec4(0xc1)][_0x23fec4(0xd6)]();const _0x4bb9dc=await this['createMetadataItemListWithBody'](_0x25c4b9,_0x425bd1);await this[_0x23fec4(0xea)](_0x4bb9dc),await this[_0x23fec4(0xc1)][_0x23fec4(0xd6)](),await this[_0x23fec4(0x9a)](!![]);}catch(_0x11f10d){this[_0x23fec4(0xc1)]['logError'](_0x11f10d),await this['finishSnapshot'](![])[_0x23fec4(0x7b)](_0xd1c8f4=>this['_systemLogger']['error'](_0xd1c8f4));}}async[a363_0x369a5e(0x84)](){const _0x115661=a363_0x369a5e,_0x459620={'veevaService':this[_0x115661(0x83)],'logger':this[_0x115661(0xc1)]},_0x10a2ad=Array[_0x115661(0xe8)](Object[_0x115661(0xa1)](this[_0x115661(0xed)]))[_0x115661(0xcd)]?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this['_selectedComponentMap'],..._0x459620}):new type_veeva_component_retriever_1[(_0x115661(0xdc))]({'value':this[_0x115661(0x93)],'whereClause':this[_0x115661(0xa7)],..._0x459620});return _0x10a2ad[_0x115661(0xf3)]();}async[a363_0x369a5e(0xa5)](_0x5aae0f,_0xfcd253){const _0x90d2c9=a363_0x369a5e;var _0x532463,_0x29048e;this[_0x90d2c9(0xc1)][_0x90d2c9(0x86)](_0x90d2c9(0xc6));const _0x4ed7d9=this[_0x90d2c9(0xd7)](_0x5aae0f),_0x4d6ce5=_0x4ed7d9[_0x90d2c9(0xa9)]((_0x2aa250,_0x32900c)=>_0x2aa250['set'](_0x32900c[_0x90d2c9(0x85)],_0x32900c),new Map());for(const _0xf5b07b of _0xfcd253){for(const _0xe408d in _0xf5b07b[_0x90d2c9(0xd1)]){const {base:_0x537b63,name:_0x4db646,dir:_0x5e50c6}=path_1[_0x90d2c9(0x9e)][_0x90d2c9(0x7a)](_0xe408d),_0x10d831=_0x4db646+veeva_constants_1[_0x90d2c9(0x89)][_0x90d2c9(0xf4)];if(_0x4d6ce5['has'](_0x537b63)){const _0x1f6732=await((_0x532463=_0xf5b07b['file']([_0x5e50c6,_0x537b63][_0x90d2c9(0xda)](path_1['default']['posix'][_0x90d2c9(0xa6)])))===null||_0x532463===void 0x0?void 0x0:_0x532463[_0x90d2c9(0x8c)](_0x90d2c9(0x80))),_0x38a369=await((_0x29048e=_0xf5b07b[_0x90d2c9(0xd9)]([_0x5e50c6,_0x10d831][_0x90d2c9(0xda)](path_1[_0x90d2c9(0x9e)][_0x90d2c9(0x82)][_0x90d2c9(0xa6)])))===null||_0x29048e===void 0x0?void 0x0:_0x29048e[_0x90d2c9(0x8c)](_0x90d2c9(0x80)));if(_0x1f6732){const _0x540241=new jszip_1[(_0x90d2c9(0x9e))]();_0x540241[_0x90d2c9(0xd9)](_0x537b63,_0x1f6732),_0x38a369&&_0x540241['file'](_0x10d831,this[_0x90d2c9(0xb8)](_0x38a369)),_0x4d6ce5['get'](_0x537b63)['body']=await _0x540241[_0x90d2c9(0xb2)]({'type':_0x90d2c9(0xcc)});}}}}return _0x4ed7d9['filter'](_0x27e65a=>!_0x27e65a[_0x90d2c9(0xe1)])[_0x90d2c9(0xc7)](_0x34fd32=>{const _0x472979=_0x90d2c9;this['_logger']['log'](_0x472979(0xe2)+_0x34fd32['veevaComponentType']+'.'+_0x34fd32['name']+_0x472979(0x8b));}),_0x4ed7d9[_0x90d2c9(0xab)](_0x312741=>_0x312741[_0x90d2c9(0xe1)]);}[a363_0x369a5e(0xb8)](_0x21ae2f){const _0x455e66=a363_0x369a5e,_0x17ad57=(0x0,sync_1[_0x455e66(0x7a)])(_0x21ae2f,{'columns':!![],'skip_empty_lines':!![]}),_0x53e778=_0x17ad57[_0x455e66(0x99)](({'In\x20Package':_0x282457,..._0x4584cc})=>_0x4584cc);return(0x0,sync_2[_0x455e66(0xca)])(_0x53e778,{'header':!![]});}[a363_0x369a5e(0xd7)](_0x14846c){return _0x14846c['map'](_0x596317=>{const _0x4c5298=a363_0x40af,_0xa47a1a=new metadata_item_dto_1[(_0x4c5298(0x88))]();return _0xa47a1a[_0x4c5298(0xcb)]=_0x596317[_0x4c5298(0xcb)],_0xa47a1a['apiName']=_0x596317[_0x4c5298(0xcb)],_0xa47a1a[_0x4c5298(0xdb)]=this[_0x4c5298(0x7c)],_0xa47a1a[_0x4c5298(0x85)]=_0x596317[_0x4c5298(0x92)]+'.'+_0x596317[_0x4c5298(0xcb)]+veeva_constants_1[_0x4c5298(0x89)][_0x4c5298(0xd2)],_0xa47a1a[_0x4c5298(0xcf)]=_0x596317['type'],_0xa47a1a[_0x4c5298(0xc4)]=_0x596317[_0x4c5298(0xc4)],_0xa47a1a[_0x4c5298(0xae)]=![],_0xa47a1a;});}async['saveComponentsInSalesforce'](_0x581191){const _0x484fd3=a363_0x369a5e;this['_logger'][_0x484fd3(0x86)](_0x484fd3(0x9b)),await this[_0x484fd3(0xa8)](_0x581191),this[_0x484fd3(0xc1)][_0x484fd3(0x86)](_0x484fd3(0xc5)+_0x581191[_0x484fd3(0xcd)]+_0x484fd3(0x90));const _0x36c1ac=_0x581191[_0x484fd3(0x99)](_0x841f95=>{const _0x4e54fb=_0x484fd3;return{[constants_1[_0x4e54fb(0xa4)]+_0x4e54fb(0x8d)]:_0x841f95[_0x4e54fb(0xcb)],[constants_1[_0x4e54fb(0xa4)]+'API_Name__c']:_0x841f95['apiName'],[constants_1[_0x4e54fb(0xa4)]+_0x4e54fb(0x7d)]:_0x841f95[_0x4e54fb(0xdb)],[constants_1[_0x4e54fb(0xa4)]+'Label__c']:_0x841f95['label'],[constants_1[_0x4e54fb(0xa4)]+_0x4e54fb(0xe9)]:_0x841f95[_0x4e54fb(0xae)],[constants_1['FLOSUM_NAMESPACE']+_0x4e54fb(0xa2)]:_0x841f95[_0x4e54fb(0xcf)],[constants_1[_0x4e54fb(0xa4)]+_0x4e54fb(0xe0)]:_0x841f95[_0x4e54fb(0xd0)],[constants_1[_0x4e54fb(0xa4)]+_0x4e54fb(0xd8)]:_0x841f95[_0x4e54fb(0xc4)]};}),_0x2292bb=await this[_0x484fd3(0x96)][_0x484fd3(0xe3)](constants_1['FLOSUM_NAMESPACE']+_0x484fd3(0xe5),_0x36c1ac);let _0x6ff460=!![];_0x2292bb[_0x484fd3(0xc7)]((_0x30812a,_0xf9b631)=>{const _0x164f95=_0x484fd3;this[_0x164f95(0xc1)][_0x164f95(0x86)](_0x164f95(0xc5)+_0x581191[_0xf9b631][_0x164f95(0xcf)]+'.'+_0x581191[_0xf9b631][_0x164f95(0xcb)]);if(!_0x30812a[_0x164f95(0xef)]){_0x6ff460=![];const _0x566b94=new salesforce_dml_error_1[(_0x164f95(0xc0))](_0x30812a[_0x164f95(0xbc)]);this['_logger']['logError'](_0x566b94);}});if(!_0x6ff460)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async['saveAttachments'](_0x2712b0){const _0x21ff32=a363_0x369a5e,_0x41eaa7=this[_0x21ff32(0x7e)](_0x2712b0),_0x4120da=await this[_0x21ff32(0x96)]['insertMultipleRecords'](SnapshotService[_0x21ff32(0xa3)],_0x41eaa7),_0x2982e8=[];_0x4120da[_0x21ff32(0xc7)]((_0x33dc94,_0x189b72)=>{const _0x2c157d=_0x21ff32;_0x33dc94['success']?(_0x2712b0[_0x189b72][_0x2c157d(0xd0)]=_0x33dc94['id'],_0x2712b0[_0x189b72][_0x2c157d(0xae)]=!![]):_0x2982e8[_0x2c157d(0xb5)](..._0x33dc94[_0x2c157d(0xbc)]);});if(_0x2982e8[_0x21ff32(0xcd)])throw new salesforce_dml_error_1[(_0x21ff32(0xc0))](_0x2982e8);}[a363_0x369a5e(0x7e)](_0x11c61){const _0x10f343=a363_0x369a5e;return _0x11c61[_0x10f343(0x99)](_0x37cc87=>({'ParentId':this[_0x10f343(0x7c)],'Name':_0x37cc87['veevaComponentType'],'ContentType':'application/zip','Body':_0x37cc87['body'],'Description':_0x37cc87[_0x10f343(0xcf)]}));}async[a363_0x369a5e(0x9a)](_0x4975a0){const _0x3523df=a363_0x369a5e,_0x433abd={[constants_1[_0x3523df(0xa4)]+_0x3523df(0x97)]:!![],[constants_1[_0x3523df(0xa4)]+_0x3523df(0xee)]:!_0x4975a0},_0x1cb491={[constants_1[_0x3523df(0xa4)]+_0x3523df(0xee)]:!_0x4975a0,[constants_1[_0x3523df(0xa4)]+_0x3523df(0x8a)]:_0x4975a0,[constants_1['FLOSUM_NAMESPACE']+'Status__c']:_0x4975a0?status_enums_1['MetadataLogStatus'][_0x3523df(0xf2)]:status_enums_1[_0x3523df(0x87)]['EXCEPTION'],[constants_1[_0x3523df(0xa4)]+_0x3523df(0xe4)]:!![]};await this[_0x3523df(0xd5)][_0x3523df(0xdd)](flosum_constants_1[_0x3523df(0x91)][_0x3523df(0xad)]+'/'+constants_1[_0x3523df(0xa4)]+'Snapshot__c/'+this['_snapshotId'],_0x433abd),await this[_0x3523df(0xd5)][_0x3523df(0xdd)](flosum_constants_1[_0x3523df(0x91)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1['FLOSUM_NAMESPACE']+_0x3523df(0xe6)+this[_0x3523df(0xec)],_0x1cb491),this[_0x3523df(0xc1)][_0x3523df(0x86)](_0x3523df(0xb7)+(_0x4975a0?_0x3523df(0x9c):_0x3523df(0x94))+'.'),await this[_0x3523df(0xc1)]['updateLog']();}}exports[a363_0x369a5e(0xaa)]=SnapshotService,SnapshotService[a363_0x369a5e(0x81)]=a363_0x369a5e(0x9f),SnapshotService[a363_0x369a5e(0xa3)]=a363_0x369a5e(0xac);