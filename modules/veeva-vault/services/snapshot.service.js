function a362_0x5c09(_0x4b4c20,_0x5e8f82){const _0x2a9af8=a362_0x2233();return a362_0x5c09=function(_0x12c8fa,_0x484cb3){_0x12c8fa=_0x12c8fa-0x17f;let _0x22332e=_0x2a9af8[_0x12c8fa];return _0x22332e;},a362_0x5c09(_0x4b4c20,_0x5e8f82);}const a362_0x3ddddd=a362_0x5c09;(function(_0x55e32a,_0x538ff3){const _0x22ab64=a362_0x5c09,_0x5f151e=_0x55e32a();while(!![]){try{const _0x24bb99=-parseInt(_0x22ab64(0x194))/0x1+-parseInt(_0x22ab64(0x1a6))/0x2+-parseInt(_0x22ab64(0x1ed))/0x3+-parseInt(_0x22ab64(0x1a9))/0x4+parseInt(_0x22ab64(0x192))/0x5+-parseInt(_0x22ab64(0x1dc))/0x6*(parseInt(_0x22ab64(0x1cf))/0x7)+parseInt(_0x22ab64(0x1ee))/0x8;if(_0x24bb99===_0x538ff3)break;else _0x5f151e['push'](_0x5f151e['shift']());}catch(_0x31640a){_0x5f151e['push'](_0x5f151e['shift']());}}}(a362_0x2233,0x90f8f));const a362_0x484cb3=(function(){let _0x379ae8=!![];return function(_0x2ddaa1,_0x1d3e60){const _0x50f71e=_0x379ae8?function(){const _0x54cfe9=a362_0x5c09;if(_0x1d3e60){const _0x1c2543=_0x1d3e60[_0x54cfe9(0x1ae)](_0x2ddaa1,arguments);return _0x1d3e60=null,_0x1c2543;}}:function(){};return _0x379ae8=![],_0x50f71e;};}()),a362_0x12c8fa=a362_0x484cb3(this,function(){const _0x21a343=a362_0x5c09;return a362_0x12c8fa[_0x21a343(0x1d8)]()['search'](_0x21a343(0x1eb))[_0x21a343(0x1d8)]()[_0x21a343(0x1a3)](a362_0x12c8fa)[_0x21a343(0x1e2)](_0x21a343(0x1eb));});a362_0x12c8fa();function a362_0x2233(){const _0x4d4866=['toString','retrieveVeevaComponents','\x20from\x20outbound\x20package','_systemLogger','2322uGYEaE','error','selectedMetaTypes','_metadataLogId','length','stringify','search','get','FlosumConstants','map','type','async','../../../constants','Cannot\x20retrieve\x20','__esModule','(((.+)+)+)+$','_logger','3397074jsbLfH','19261928DwmhzX','parse','COMPLETED','name','SnapshotService','ATTACHMENT','retrieve','csv-stringify/sync','TypeAndNameVeevaComponentRetriever','selectedComponentMap','_selectedComponentMap','files','_connectionSalesforce','Snapshot__c','saveAttachments','Snapshot\x20started.','updateLog','Status__c','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','PackageExportService','Snapshot\x20completed\x20','reduce','SalesforceDmlError','transformDependencyFile','Is_Retrieved__c','EXCEPTION','values','3543810szfxYo','isRetrieved','692203Uzlgds','_attachmentLogId','errors','timeZone','_packageExportService','snapshotId','_veevaService','Saving\x20','log','file','MetadataLogStatus','_connectionVeeva','ENDPOINT_UPSERT_RECORD','has','defineProperty','constructor','Attachment','application/zip','221196yXGget','lastModifiedDate','string','1172120iFgqyB','MetadataItemDto','./salesforce.service','VeevaConstants','formMetadataItemDtoList','apply','__importDefault','../classes/retrievers/veeva-components/type.veeva-component.retriever','default','forEach','success','logError','_selectedMetaTypes','jszip','Succeed__c','Last_Modified_Date__c','_snapshotId','successfully','apiName','_timeZone','SalesforceService','createMetadataItemListWithBody','from','body','Label__c','VeevaService','join','Is_Error__c','../classes/errors/salesforce-dml-error','label','FLOSUM_NAMESPACE','finishSnapshot','veevaComponentType','csv-parse/sync','\x20Metadata\x20Items','catch','filter','insertMultipleRecords','5327bAYBLQ','saveComponentsInSalesforce','Metadata_Item__c','patch','Snapshot__c/','Job_Completed__c','set','_salesforceService','Veeva_Component_Type__c'];a362_0x2233=function(){return _0x4d4866;};return a362_0x2233();}'use strict';var __importDefault=this&&this[a362_0x3ddddd(0x1af)]||function(_0x3f224a){return _0x3f224a&&_0x3f224a['__esModule']?_0x3f224a:{'default':_0x3f224a};};Object[a362_0x3ddddd(0x1a2)](exports,a362_0x3ddddd(0x1ea),{'value':!![]}),exports[a362_0x3ddddd(0x1f2)]=void 0x0;const jszip_1=__importDefault(require(a362_0x3ddddd(0x1b6))),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a362_0x3ddddd(0x1e8)),salesforce_service_1=require(a362_0x3ddddd(0x1ab)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a362_0x3ddddd(0x1c5)),package_export_service_1=require('./package-export.service'),type_and_name_veeva_component_retriever_1=require(a362_0x3ddddd(0x189)),type_veeva_component_retriever_1=require(a362_0x3ddddd(0x1b0)),sync_1=require(a362_0x3ddddd(0x1ca)),sync_2=require(a362_0x3ddddd(0x1f5)),veeva_constants_1=require('../constants/veeva.constants'),path_1=__importDefault(require('path'));class SnapshotService{constructor(_0x2162e6,_0x13ba1c,_0x4e06ad,_0x2d1481){const _0x56346f=a362_0x3ddddd;this[_0x56346f(0x183)]=_0x13ba1c,this[_0x56346f(0x19f)]=_0x4e06ad,this[_0x56346f(0x1ec)]=_0x2d1481,this[_0x56346f(0x1b9)]=_0x2162e6['snapshotId'],this[_0x56346f(0x1df)]=_0x2162e6['metadataLogId'],this[_0x56346f(0x195)]=_0x2162e6['attachmentLogId'],this[_0x56346f(0x1bc)]=_0x2162e6[_0x56346f(0x197)],this[_0x56346f(0x1b5)]=_0x2162e6[_0x56346f(0x1de)],this[_0x56346f(0x181)]=_0x2162e6[_0x56346f(0x180)],this[_0x56346f(0x19a)]=new veeva_service_1[(_0x56346f(0x1c2))]({'connection':this['_connectionVeeva'],'logger':this[_0x56346f(0x1ec)]}),this[_0x56346f(0x1d6)]=new salesforce_service_1[(_0x56346f(0x1bd))]({'connection':this[_0x56346f(0x183)]}),this[_0x56346f(0x198)]=new package_export_service_1[(_0x56346f(0x18a))]({'veevaService':this['_veevaService'],'connection':this[_0x56346f(0x19f)],'logger':this['_logger']});}async['execute'](){const _0x51f36e=a362_0x3ddddd;try{this[_0x51f36e(0x1ec)]['log'](_0x51f36e(0x186));const _0x19b773=await this[_0x51f36e(0x1d9)]();await this['_logger']['updateLog']();const _0x4075e5=await this[_0x51f36e(0x198)]['export'](_0x19b773,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this[_0x51f36e(0x1ec)][_0x51f36e(0x187)]();const _0x39fc5b=await this[_0x51f36e(0x1be)](_0x19b773,_0x4075e5);await this[_0x51f36e(0x1d0)](_0x39fc5b),await this[_0x51f36e(0x1ec)][_0x51f36e(0x187)](),await this['finishSnapshot'](!![]);}catch(_0xe6bcb6){this[_0x51f36e(0x1ec)][_0x51f36e(0x1b4)](_0xe6bcb6),await this[_0x51f36e(0x1c8)](![])[_0x51f36e(0x1cc)](_0x4fe407=>this[_0x51f36e(0x1db)][_0x51f36e(0x1dd)](_0x4fe407));}}async[a362_0x3ddddd(0x1d9)](){const _0x1ba58f=a362_0x3ddddd,_0x9e50bc={'veevaService':this[_0x1ba58f(0x19a)],'logger':this[_0x1ba58f(0x1ec)]},_0x1fedde=Array[_0x1ba58f(0x1bf)](Object[_0x1ba58f(0x191)](this[_0x1ba58f(0x181)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x1ba58f(0x17f))]({'value':this[_0x1ba58f(0x181)],..._0x9e50bc}):new type_veeva_component_retriever_1['TypeVeevaComponentRetriever']({'value':this['_selectedMetaTypes'],..._0x9e50bc});return _0x1fedde[_0x1ba58f(0x1f4)]();}async[a362_0x3ddddd(0x1be)](_0x438d44,_0x215274){const _0x3dda51=a362_0x3ddddd;var _0x5f4312,_0x3f6826;this['_logger']['log']('Unpack\x20zip\x20and\x20create\x20metadata\x20items.');const _0x4cd52e=this[_0x3dda51(0x1ad)](_0x438d44),_0x5807d4=_0x4cd52e[_0x3dda51(0x18c)]((_0x30bc80,_0x515881)=>_0x30bc80[_0x3dda51(0x1d5)](_0x515881[_0x3dda51(0x1c6)],_0x515881),new Map());for(const _0x38b85b of _0x215274){for(const _0x2370e9 in _0x38b85b[_0x3dda51(0x182)]){const {base:_0x4fb80e,name:_0xcb2904,dir:_0x31edb1}=path_1[_0x3dda51(0x1b1)][_0x3dda51(0x1ef)](_0x2370e9),_0x74d4b7=_0xcb2904+veeva_constants_1['VeevaConstants']['DEPENDENCY_EXTENSION'];if(_0x5807d4[_0x3dda51(0x1a1)](_0x4fb80e)){const _0x40d4bb=await((_0x5f4312=_0x38b85b['file'](path_1['default'][_0x3dda51(0x1c3)](_0x31edb1,_0x4fb80e)))===null||_0x5f4312===void 0x0?void 0x0:_0x5f4312[_0x3dda51(0x1e7)](_0x3dda51(0x1a8))),_0x78cf25=await((_0x3f6826=_0x38b85b['file'](path_1[_0x3dda51(0x1b1)][_0x3dda51(0x1c3)](_0x31edb1,_0x74d4b7)))===null||_0x3f6826===void 0x0?void 0x0:_0x3f6826[_0x3dda51(0x1e7)](_0x3dda51(0x1a8)));if(_0x40d4bb&&_0x78cf25){const _0x3ecba7=new jszip_1[(_0x3dda51(0x1b1))]();_0x3ecba7[_0x3dda51(0x19d)](_0x4fb80e,_0x40d4bb),_0x3ecba7['file'](_0x74d4b7,this[_0x3dda51(0x18e)](_0x78cf25)),_0x5807d4[_0x3dda51(0x1e3)](_0x4fb80e)[_0x3dda51(0x1c0)]=await _0x3ecba7['generateAsync']({'type':'base64'});}}}}return _0x4cd52e[_0x3dda51(0x1cd)](_0x51105a=>!_0x51105a[_0x3dda51(0x1c0)])[_0x3dda51(0x1b2)](_0x2ab97e=>{const _0x3b3bd7=_0x3dda51;this[_0x3b3bd7(0x1ec)]['log'](_0x3b3bd7(0x1e9)+_0x2ab97e['veevaComponentType']+'.'+_0x2ab97e[_0x3b3bd7(0x1f1)]+_0x3b3bd7(0x1da));}),_0x4cd52e[_0x3dda51(0x1cd)](_0x579eff=>_0x579eff[_0x3dda51(0x1c0)]);}['transformDependencyFile'](_0x972d8d){const _0x49651a=a362_0x3ddddd,_0x54c477=(0x0,sync_1[_0x49651a(0x1ef)])(_0x972d8d,{'columns':!![],'skip_empty_lines':!![]}),_0x53c52c=_0x54c477[_0x49651a(0x1e5)](({'In\x20Package':_0xfa78a4,..._0x36409c})=>_0x36409c);return(0x0,sync_2[_0x49651a(0x1e1)])(_0x53c52c,{'header':!![]});}[a362_0x3ddddd(0x1ad)](_0x5ca115){const _0x13e040=a362_0x3ddddd;return _0x5ca115[_0x13e040(0x1e5)](_0x190234=>{const _0x3f4174=_0x13e040,_0x5d1945=new metadata_item_dto_1[(_0x3f4174(0x1aa))]();return _0x5d1945[_0x3f4174(0x1f1)]=_0x190234['name'],_0x5d1945[_0x3f4174(0x1bb)]=_0x190234[_0x3f4174(0x1f1)],_0x5d1945[_0x3f4174(0x199)]=this[_0x3f4174(0x1b9)],_0x5d1945['label']=_0x190234[_0x3f4174(0x1e6)]+'.'+_0x190234[_0x3f4174(0x1f1)]+veeva_constants_1[_0x3f4174(0x1ac)]['MDL_EXTENSION'],_0x5d1945[_0x3f4174(0x1c9)]=_0x190234[_0x3f4174(0x1e6)],_0x5d1945[_0x3f4174(0x1a7)]=_0x190234[_0x3f4174(0x1a7)],_0x5d1945[_0x3f4174(0x193)]=![],_0x5d1945;});}async[a362_0x3ddddd(0x1d0)](_0x3236a6){const _0x2ca1ae=a362_0x3ddddd;this[_0x2ca1ae(0x1ec)][_0x2ca1ae(0x19c)]('Saving\x20Attachments.'),await this['saveAttachments'](_0x3236a6),this[_0x2ca1ae(0x1ec)][_0x2ca1ae(0x19c)](_0x2ca1ae(0x19b)+_0x3236a6[_0x2ca1ae(0x1e0)]+_0x2ca1ae(0x1cb));const _0x3f758d=_0x3236a6[_0x2ca1ae(0x1e5)](_0x5a5653=>{const _0x5ae39a=_0x2ca1ae;return{[constants_1[_0x5ae39a(0x1c7)]+'Name__c']:_0x5a5653[_0x5ae39a(0x1f1)],[constants_1[_0x5ae39a(0x1c7)]+'API_Name__c']:_0x5a5653['apiName'],[constants_1['FLOSUM_NAMESPACE']+_0x5ae39a(0x184)]:_0x5a5653[_0x5ae39a(0x199)],[constants_1[_0x5ae39a(0x1c7)]+_0x5ae39a(0x1c1)]:_0x5a5653['label'],[constants_1[_0x5ae39a(0x1c7)]+_0x5ae39a(0x18f)]:_0x5a5653[_0x5ae39a(0x193)],[constants_1[_0x5ae39a(0x1c7)]+_0x5ae39a(0x1d7)]:_0x5a5653[_0x5ae39a(0x1c9)],[constants_1[_0x5ae39a(0x1c7)]+'Attachment_ID__c']:_0x5a5653['attachmentId'],[constants_1[_0x5ae39a(0x1c7)]+_0x5ae39a(0x1b8)]:_0x5a5653[_0x5ae39a(0x1a7)]};}),_0x34452e=await this[_0x2ca1ae(0x1d6)][_0x2ca1ae(0x1ce)](constants_1[_0x2ca1ae(0x1c7)]+_0x2ca1ae(0x1d1),_0x3f758d);let _0x2f2735=!![];_0x34452e[_0x2ca1ae(0x1b2)]((_0x158685,_0x3144db)=>{const _0x35f5aa=_0x2ca1ae;this['_logger'][_0x35f5aa(0x19c)](_0x35f5aa(0x19b)+_0x3236a6[_0x3144db][_0x35f5aa(0x1c9)]+'.'+_0x3236a6[_0x3144db][_0x35f5aa(0x1f1)]);if(!_0x158685[_0x35f5aa(0x1b3)]){_0x2f2735=![];const _0x5ba2f4=new salesforce_dml_error_1[(_0x35f5aa(0x18d))](_0x158685[_0x35f5aa(0x196)]);this[_0x35f5aa(0x1ec)][_0x35f5aa(0x1b4)](_0x5ba2f4);}});if(!_0x2f2735)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async[a362_0x3ddddd(0x185)](_0x545f21){const _0x3ba5bb=a362_0x3ddddd,_0x438c0f=this['formAttachments'](_0x545f21),_0x5f23be=await this[_0x3ba5bb(0x1d6)][_0x3ba5bb(0x1ce)](SnapshotService[_0x3ba5bb(0x1f3)],_0x438c0f),_0x139fb7=[];_0x5f23be[_0x3ba5bb(0x1b2)]((_0x153f4c,_0x59ebcd)=>{const _0x1dc830=_0x3ba5bb;_0x153f4c[_0x1dc830(0x1b3)]?(_0x545f21[_0x59ebcd]['attachmentId']=_0x153f4c['id'],_0x545f21[_0x59ebcd][_0x1dc830(0x193)]=!![]):_0x139fb7['push'](..._0x153f4c[_0x1dc830(0x196)]);});if(_0x139fb7[_0x3ba5bb(0x1e0)])throw new salesforce_dml_error_1[(_0x3ba5bb(0x18d))](_0x139fb7);}['formAttachments'](_0x45998f){const _0x3374f5=a362_0x3ddddd;return _0x45998f[_0x3374f5(0x1e5)](_0x9c5ddc=>({'ParentId':this[_0x3374f5(0x1b9)],'Name':_0x9c5ddc[_0x3374f5(0x1c9)],'ContentType':_0x3374f5(0x1a5),'Body':_0x9c5ddc[_0x3374f5(0x1c0)],'Description':_0x9c5ddc['veevaComponentType']}));}async[a362_0x3ddddd(0x1c8)](_0x17827f){const _0x11b61c=a362_0x3ddddd,_0x348565={[constants_1['FLOSUM_NAMESPACE']+'Is_Completed__c']:!![],[constants_1[_0x11b61c(0x1c7)]+_0x11b61c(0x1c4)]:!_0x17827f},_0x216101={[constants_1[_0x11b61c(0x1c7)]+_0x11b61c(0x1c4)]:!_0x17827f,[constants_1[_0x11b61c(0x1c7)]+_0x11b61c(0x1b7)]:_0x17827f,[constants_1[_0x11b61c(0x1c7)]+_0x11b61c(0x188)]:_0x17827f?status_enums_1[_0x11b61c(0x19e)][_0x11b61c(0x1f0)]:status_enums_1[_0x11b61c(0x19e)][_0x11b61c(0x190)],[constants_1[_0x11b61c(0x1c7)]+_0x11b61c(0x1d4)]:!![]};await this['_connectionSalesforce']['patch'](flosum_constants_1['FlosumConstants'][_0x11b61c(0x1a0)]+'/'+constants_1[_0x11b61c(0x1c7)]+_0x11b61c(0x1d3)+this[_0x11b61c(0x1b9)],_0x348565),await this[_0x11b61c(0x183)][_0x11b61c(0x1d2)](flosum_constants_1[_0x11b61c(0x1e4)][_0x11b61c(0x1a0)]+'/'+constants_1[_0x11b61c(0x1c7)]+'Metadata_Log__c/'+this[_0x11b61c(0x1df)],_0x216101),this[_0x11b61c(0x1ec)]['log'](_0x11b61c(0x18b)+(_0x17827f?_0x11b61c(0x1ba):'with\x20error')+'.'),await this[_0x11b61c(0x1ec)][_0x11b61c(0x187)]();}}exports[a362_0x3ddddd(0x1f2)]=SnapshotService,SnapshotService['OUTBOUND_PACKAGE_NAME']='Snapshot',SnapshotService[a362_0x3ddddd(0x1f3)]=a362_0x3ddddd(0x1a4);