const a358_0x1ff73d=a358_0x57cc;(function(_0x35b396,_0x2ba0b3){const _0x51c485=a358_0x57cc,_0x139e57=_0x35b396();while(!![]){try{const _0x5edc3d=parseInt(_0x51c485(0xd0))/0x1*(parseInt(_0x51c485(0xc4))/0x2)+parseInt(_0x51c485(0x71))/0x3+parseInt(_0x51c485(0xe5))/0x4*(-parseInt(_0x51c485(0xe4))/0x5)+parseInt(_0x51c485(0xbe))/0x6+-parseInt(_0x51c485(0x87))/0x7+parseInt(_0x51c485(0x91))/0x8*(-parseInt(_0x51c485(0xab))/0x9)+-parseInt(_0x51c485(0xb4))/0xa;if(_0x5edc3d===_0x2ba0b3)break;else _0x139e57['push'](_0x139e57['shift']());}catch(_0x2904ea){_0x139e57['push'](_0x139e57['shift']());}}}(a358_0x3a76,0x2f1c1));function a358_0x3a76(){const _0x16dc47=['finishSnapshot','saveComponentsInSalesforce','get','./salesforce.service','reduce','_selectedComponentMap','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','1505AyhKMw','424wNkFbl','Name__c','defineProperty','success','_logger','Label__c','Metadata_Log__c/','DEPENDENCY_EXTENSION','updateLog','body','veevaComponentType','base64','1115205opACLz','ENDPOINT_UPSERT_RECORD','logError','attachmentLogId','execute','saveAttachments','Attachment_ID__c','file','Cannot\x20Save\x20Metadata\x20Items','length','log','__importDefault','isRetrieved','_packageExportService','_systemLogger','../../../constants','_metadataLogId','insertMultipleRecords','stringify','_connectionSalesforce','SnapshotService','SalesforceService','2465071ZfnrAw','_salesforceService','timeZone','formMetadataItemDtoList','_veevaService','./package-export.service','string','forEach','csv-stringify/sync','export','5208IQGfMV','attachmentId','snapshotId','selectedMetaTypes','jszip','filter','../classes/retrievers/veeva-components/type.veeva-component.retriever','csv-parse/sync','apiName','Saving\x20Attachments.','Saving\x20','EXCEPTION','search','Metadata_Item__c','Cannot\x20retrieve\x20','Status__c','FLOSUM_NAMESPACE','PackageExportService','name','default','Snapshot__c/','lastModifiedDate','path','Succeed__c','../dtos/metadata-item.dto','metadataLogId','9bxQdKp','Snapshot__c','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','Snapshot','values','generateAsync','MetadataLogStatus','with\x20error','__esModule','365550BpGSlR','errors','async','\x20from\x20outbound\x20package','../constants/flosum.constants','MDL_EXTENSION','apply','OUTBOUND_PACKAGE_NAME','formAttachments','patch','1394610iOpAqS','TypeAndNameVeevaComponentRetriever','createMetadataItemListWithBody','files','_snapshotId','transformDependencyFile','5028YadGCP','_connectionVeeva','_attachmentLogId','parse','retrieveVeevaComponents','(((.+)+)+)+$','map','ATTACHMENT','Snapshot\x20completed\x20','FlosumConstants','set','Is_Retrieved__c','4cmUAwy','has','retrieve','join','API_Name__c','application/zip','Is_Completed__c','Veeva_Component_Type__c','label','./veeva.service','toString','catch','SalesforceDmlError'];a358_0x3a76=function(){return _0x16dc47;};return a358_0x3a76();}const a358_0x2b4372=(function(){let _0x1d0edf=!![];return function(_0x3db163,_0x45b0ea){const _0x1f44ab=_0x1d0edf?function(){const _0x36f633=a358_0x57cc;if(_0x45b0ea){const _0x3da6b5=_0x45b0ea[_0x36f633(0xba)](_0x3db163,arguments);return _0x45b0ea=null,_0x3da6b5;}}:function(){};return _0x1d0edf=![],_0x1f44ab;};}()),a358_0x37942c=a358_0x2b4372(this,function(){const _0x6a36fe=a358_0x57cc;return a358_0x37942c[_0x6a36fe(0xda)]()[_0x6a36fe(0x9d)](_0x6a36fe(0xc9))[_0x6a36fe(0xda)]()['constructor'](a358_0x37942c)[_0x6a36fe(0x9d)](_0x6a36fe(0xc9));});a358_0x37942c();'use strict';var __importDefault=this&&this[a358_0x1ff73d(0x7c)]||function(_0x5aad95){const _0x5db2b2=a358_0x1ff73d;return _0x5aad95&&_0x5aad95[_0x5db2b2(0xb3)]?_0x5aad95:{'default':_0x5aad95};};Object[a358_0x1ff73d(0xe7)](exports,a358_0x1ff73d(0xb3),{'value':!![]}),exports[a358_0x1ff73d(0x85)]=void 0x0;const jszip_1=__importDefault(require(a358_0x1ff73d(0x95))),flosum_constants_1=require(a358_0x1ff73d(0xb8)),veeva_service_1=require(a358_0x1ff73d(0xd9)),metadata_item_dto_1=require(a358_0x1ff73d(0xa9)),constants_1=require(a358_0x1ff73d(0x80)),salesforce_service_1=require(a358_0x1ff73d(0xe0)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require(a358_0x1ff73d(0x8c)),type_and_name_veeva_component_retriever_1=require(a358_0x1ff73d(0xad)),type_veeva_component_retriever_1=require(a358_0x1ff73d(0x97)),sync_1=require(a358_0x1ff73d(0x98)),sync_2=require(a358_0x1ff73d(0x8f)),veeva_constants_1=require('../constants/veeva.constants'),path_1=__importDefault(require(a358_0x1ff73d(0xa7)));function a358_0x57cc(_0x75b032,_0x25b785){const _0x356e71=a358_0x3a76();return a358_0x57cc=function(_0x37942c,_0x2b4372){_0x37942c=_0x37942c-0x71;let _0x3a76ad=_0x356e71[_0x37942c];return _0x3a76ad;},a358_0x57cc(_0x75b032,_0x25b785);}class SnapshotService{constructor(_0x9e30f5,_0x48e6e1,_0x1c0fe9,_0x35af48){const _0x31060b=a358_0x1ff73d;this['_connectionSalesforce']=_0x48e6e1,this['_connectionVeeva']=_0x1c0fe9,this[_0x31060b(0xe9)]=_0x35af48,this[_0x31060b(0xc2)]=_0x9e30f5[_0x31060b(0x93)],this['_metadataLogId']=_0x9e30f5[_0x31060b(0xaa)],this[_0x31060b(0xc6)]=_0x9e30f5[_0x31060b(0x74)],this['_timeZone']=_0x9e30f5[_0x31060b(0x89)],this['_selectedMetaTypes']=_0x9e30f5[_0x31060b(0x94)],this['_selectedComponentMap']=_0x9e30f5['selectedComponentMap'],this[_0x31060b(0x8b)]=new veeva_service_1['VeevaService']({'connection':this[_0x31060b(0xc5)],'logger':this[_0x31060b(0xe9)]}),this[_0x31060b(0x88)]=new salesforce_service_1[(_0x31060b(0x86))]({'connection':this['_connectionSalesforce']}),this[_0x31060b(0x7e)]=new package_export_service_1[(_0x31060b(0xa2))]({'veevaService':this[_0x31060b(0x8b)],'connection':this['_connectionVeeva'],'logger':this[_0x31060b(0xe9)]});}async[a358_0x1ff73d(0x75)](){const _0x11249b=a358_0x1ff73d;try{this[_0x11249b(0xe9)][_0x11249b(0x7b)]('Snapshot\x20started.');const _0x1964ec=await this[_0x11249b(0xc8)]();await this[_0x11249b(0xe9)][_0x11249b(0xed)]();const _0x4dfdd9=await this[_0x11249b(0x7e)][_0x11249b(0x90)](_0x1964ec,SnapshotService[_0x11249b(0xbb)]);await this[_0x11249b(0xe9)][_0x11249b(0xed)]();const _0x55cae8=await this[_0x11249b(0xc0)](_0x1964ec,_0x4dfdd9);await this['saveComponentsInSalesforce'](_0x55cae8),await this[_0x11249b(0xe9)][_0x11249b(0xed)](),await this[_0x11249b(0xdd)](!![]);}catch(_0x3b91f0){this[_0x11249b(0xe9)][_0x11249b(0x73)](_0x3b91f0),await this[_0x11249b(0xdd)](![])[_0x11249b(0xdb)](_0x32fb64=>this[_0x11249b(0x7f)]['error'](_0x32fb64));}}async[a358_0x1ff73d(0xc8)](){const _0x5ad141=a358_0x1ff73d,_0x4e831d={'veevaService':this[_0x5ad141(0x8b)],'logger':this[_0x5ad141(0xe9)]},_0x53fe9c=Array['from'](Object[_0x5ad141(0xaf)](this[_0x5ad141(0xe2)]))[_0x5ad141(0x7a)]?new type_and_name_veeva_component_retriever_1[(_0x5ad141(0xbf))]({'value':this[_0x5ad141(0xe2)],..._0x4e831d}):new type_veeva_component_retriever_1['TypeVeevaComponentRetriever']({'value':this['_selectedMetaTypes'],..._0x4e831d});return _0x53fe9c[_0x5ad141(0xd2)]();}async[a358_0x1ff73d(0xc0)](_0xdd5e37,_0x1525a2){const _0x4cff7a=a358_0x1ff73d;var _0x14399c,_0x502273;this[_0x4cff7a(0xe9)][_0x4cff7a(0x7b)](_0x4cff7a(0xe3));const _0x31be34=this[_0x4cff7a(0x8a)](_0xdd5e37),_0x5db25a=_0x31be34[_0x4cff7a(0xe1)]((_0x5a501a,_0x30a2be)=>_0x5a501a[_0x4cff7a(0xce)](_0x30a2be[_0x4cff7a(0xd8)],_0x30a2be),new Map());for(const _0x12452f of _0x1525a2){for(const _0xd82f7a in _0x12452f[_0x4cff7a(0xc1)]){const {base:_0x1f2198,name:_0x3a1161,dir:_0x1e1f3a}=path_1['default']['parse'](_0xd82f7a),_0x49acdc=_0x3a1161+veeva_constants_1['VeevaConstants'][_0x4cff7a(0xec)];if(_0x5db25a[_0x4cff7a(0xd1)](_0x1f2198)){const _0x34d833=await((_0x14399c=_0x12452f[_0x4cff7a(0x78)](path_1[_0x4cff7a(0xa4)]['join'](_0x1e1f3a,_0x1f2198)))===null||_0x14399c===void 0x0?void 0x0:_0x14399c[_0x4cff7a(0xb6)](_0x4cff7a(0x8d))),_0x7824d1=await((_0x502273=_0x12452f[_0x4cff7a(0x78)](path_1[_0x4cff7a(0xa4)][_0x4cff7a(0xd3)](_0x1e1f3a,_0x49acdc)))===null||_0x502273===void 0x0?void 0x0:_0x502273[_0x4cff7a(0xb6)](_0x4cff7a(0x8d)));if(_0x34d833&&_0x7824d1){const _0x53654b=new jszip_1[(_0x4cff7a(0xa4))]();_0x53654b[_0x4cff7a(0x78)](_0x1f2198,_0x34d833),_0x53654b[_0x4cff7a(0x78)](_0x49acdc,this[_0x4cff7a(0xc3)](_0x7824d1)),_0x5db25a[_0x4cff7a(0xdf)](_0x1f2198)[_0x4cff7a(0xee)]=await _0x53654b[_0x4cff7a(0xb0)]({'type':_0x4cff7a(0xf0)});}}}}return _0x31be34[_0x4cff7a(0x96)](_0x41a0a5=>!_0x41a0a5[_0x4cff7a(0xee)])[_0x4cff7a(0x8e)](_0x5f3483=>{const _0x48f2f1=_0x4cff7a;this[_0x48f2f1(0xe9)][_0x48f2f1(0x7b)](_0x48f2f1(0x9f)+_0x5f3483[_0x48f2f1(0xef)]+'.'+_0x5f3483[_0x48f2f1(0xa3)]+_0x48f2f1(0xb7));}),_0x31be34['filter'](_0x3eea13=>_0x3eea13[_0x4cff7a(0xee)]);}[a358_0x1ff73d(0xc3)](_0x310d05){const _0x527a3c=a358_0x1ff73d,_0x49fee3=(0x0,sync_1[_0x527a3c(0xc7)])(_0x310d05,{'columns':!![],'skip_empty_lines':!![]}),_0x3659ee=_0x49fee3[_0x527a3c(0xca)](({'In\x20Package':_0x3c0a8a,..._0x2e26b8})=>_0x2e26b8);return(0x0,sync_2[_0x527a3c(0x83)])(_0x3659ee,{'header':!![]});}['formMetadataItemDtoList'](_0x40a9be){const _0x5c6f8b=a358_0x1ff73d;return _0x40a9be[_0x5c6f8b(0xca)](_0x3dec50=>{const _0x591d3a=_0x5c6f8b,_0x4e88cc=new metadata_item_dto_1['MetadataItemDto']();return _0x4e88cc[_0x591d3a(0xa3)]=_0x3dec50[_0x591d3a(0xa3)],_0x4e88cc[_0x591d3a(0x99)]=_0x3dec50[_0x591d3a(0xa3)],_0x4e88cc[_0x591d3a(0x93)]=this[_0x591d3a(0xc2)],_0x4e88cc[_0x591d3a(0xd8)]=_0x3dec50['type']+'.'+_0x3dec50['name']+veeva_constants_1['VeevaConstants'][_0x591d3a(0xb9)],_0x4e88cc[_0x591d3a(0xef)]=_0x3dec50['type'],_0x4e88cc[_0x591d3a(0xa6)]=_0x3dec50[_0x591d3a(0xa6)],_0x4e88cc[_0x591d3a(0x7d)]=![],_0x4e88cc;});}async[a358_0x1ff73d(0xde)](_0x5eff42){const _0x5573c8=a358_0x1ff73d;this['_logger'][_0x5573c8(0x7b)](_0x5573c8(0x9a)),await this['saveAttachments'](_0x5eff42),this['_logger'][_0x5573c8(0x7b)](_0x5573c8(0x9b)+_0x5eff42[_0x5573c8(0x7a)]+'\x20Metadata\x20Items');const _0x3615e5=_0x5eff42[_0x5573c8(0xca)](_0x4cbdba=>{const _0x1a6b4e=_0x5573c8;return{[constants_1[_0x1a6b4e(0xa1)]+_0x1a6b4e(0xe6)]:_0x4cbdba['name'],[constants_1[_0x1a6b4e(0xa1)]+_0x1a6b4e(0xd4)]:_0x4cbdba[_0x1a6b4e(0x99)],[constants_1['FLOSUM_NAMESPACE']+_0x1a6b4e(0xac)]:_0x4cbdba[_0x1a6b4e(0x93)],[constants_1['FLOSUM_NAMESPACE']+_0x1a6b4e(0xea)]:_0x4cbdba[_0x1a6b4e(0xd8)],[constants_1['FLOSUM_NAMESPACE']+_0x1a6b4e(0xcf)]:_0x4cbdba['isRetrieved'],[constants_1['FLOSUM_NAMESPACE']+_0x1a6b4e(0xd7)]:_0x4cbdba[_0x1a6b4e(0xef)],[constants_1['FLOSUM_NAMESPACE']+_0x1a6b4e(0x77)]:_0x4cbdba[_0x1a6b4e(0x92)],[constants_1[_0x1a6b4e(0xa1)]+'Last_Modified_Date__c']:_0x4cbdba[_0x1a6b4e(0xa6)]};}),_0x1f1e2c=await this[_0x5573c8(0x88)][_0x5573c8(0x82)](constants_1[_0x5573c8(0xa1)]+_0x5573c8(0x9e),_0x3615e5);let _0x409798=!![];_0x1f1e2c['forEach']((_0x16e887,_0xe9a29c)=>{const _0x3b1531=_0x5573c8;this[_0x3b1531(0xe9)]['log'](_0x3b1531(0x9b)+_0x5eff42[_0xe9a29c]['veevaComponentType']+'.'+_0x5eff42[_0xe9a29c][_0x3b1531(0xa3)]);if(!_0x16e887[_0x3b1531(0xe8)]){_0x409798=![];const _0x2ead25=new salesforce_dml_error_1[(_0x3b1531(0xdc))](_0x16e887['errors']);this[_0x3b1531(0xe9)][_0x3b1531(0x73)](_0x2ead25);}});if(!_0x409798)throw new Error(_0x5573c8(0x79));}async[a358_0x1ff73d(0x76)](_0x305216){const _0x1437d1=a358_0x1ff73d,_0x466038=this['formAttachments'](_0x305216),_0x3002aa=await this[_0x1437d1(0x88)]['insertMultipleRecords'](SnapshotService[_0x1437d1(0xcb)],_0x466038),_0x57d8b1=[];_0x3002aa[_0x1437d1(0x8e)]((_0x58e8df,_0x12193d)=>{const _0x368dd3=_0x1437d1;_0x58e8df['success']?(_0x305216[_0x12193d][_0x368dd3(0x92)]=_0x58e8df['id'],_0x305216[_0x12193d][_0x368dd3(0x7d)]=!![]):_0x57d8b1['push'](..._0x58e8df[_0x368dd3(0xb5)]);});if(_0x57d8b1[_0x1437d1(0x7a)])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x57d8b1);}[a358_0x1ff73d(0xbc)](_0x5701d0){const _0x1a8939=a358_0x1ff73d;return _0x5701d0[_0x1a8939(0xca)](_0x575eff=>({'ParentId':this[_0x1a8939(0xc2)],'Name':_0x575eff['veevaComponentType'],'ContentType':_0x1a8939(0xd5),'Body':_0x575eff[_0x1a8939(0xee)],'Description':_0x575eff['veevaComponentType']}));}async[a358_0x1ff73d(0xdd)](_0x43578e){const _0x41513d=a358_0x1ff73d,_0x1bda5a={[constants_1[_0x41513d(0xa1)]+_0x41513d(0xd6)]:!![],[constants_1[_0x41513d(0xa1)]+'Is_Error__c']:!_0x43578e},_0x24205c={[constants_1[_0x41513d(0xa1)]+'Is_Error__c']:!_0x43578e,[constants_1['FLOSUM_NAMESPACE']+_0x41513d(0xa8)]:_0x43578e,[constants_1['FLOSUM_NAMESPACE']+_0x41513d(0xa0)]:_0x43578e?status_enums_1[_0x41513d(0xb1)]['COMPLETED']:status_enums_1['MetadataLogStatus'][_0x41513d(0x9c)],[constants_1[_0x41513d(0xa1)]+'Job_Completed__c']:!![]};await this[_0x41513d(0x84)][_0x41513d(0xbd)](flosum_constants_1[_0x41513d(0xcd)][_0x41513d(0x72)]+'/'+constants_1[_0x41513d(0xa1)]+_0x41513d(0xa5)+this[_0x41513d(0xc2)],_0x1bda5a),await this[_0x41513d(0x84)][_0x41513d(0xbd)](flosum_constants_1['FlosumConstants'][_0x41513d(0x72)]+'/'+constants_1[_0x41513d(0xa1)]+_0x41513d(0xeb)+this[_0x41513d(0x81)],_0x24205c),this['_logger'][_0x41513d(0x7b)](_0x41513d(0xcc)+(_0x43578e?'successfully':_0x41513d(0xb2))+'.'),await this[_0x41513d(0xe9)]['updateLog']();}}exports[a358_0x1ff73d(0x85)]=SnapshotService,SnapshotService[a358_0x1ff73d(0xbb)]=a358_0x1ff73d(0xae),SnapshotService[a358_0x1ff73d(0xcb)]='Attachment';