const a363_0x45eb63=a363_0x1e67;(function(_0x250471,_0x46e2fc){const _0x2a9357=a363_0x1e67,_0x270fa8=_0x250471();while(!![]){try{const _0x1f47a4=parseInt(_0x2a9357(0x1d3))/0x1+parseInt(_0x2a9357(0x1e2))/0x2+-parseInt(_0x2a9357(0x1f9))/0x3+parseInt(_0x2a9357(0x221))/0x4*(parseInt(_0x2a9357(0x21f))/0x5)+parseInt(_0x2a9357(0x1b4))/0x6*(-parseInt(_0x2a9357(0x216))/0x7)+-parseInt(_0x2a9357(0x233))/0x8*(parseInt(_0x2a9357(0x1d5))/0x9)+-parseInt(_0x2a9357(0x1f4))/0xa;if(_0x1f47a4===_0x46e2fc)break;else _0x270fa8['push'](_0x270fa8['shift']());}catch(_0x3c47b1){_0x270fa8['push'](_0x270fa8['shift']());}}}(a363_0x2ff7,0x572b2));const a363_0x29ee50=(function(){let _0x272f54=!![];return function(_0x456801,_0x22f980){const _0x2f5b0d=_0x272f54?function(){const _0xed842b=a363_0x1e67;if(_0x22f980){const _0x5404c6=_0x22f980[_0xed842b(0x1fd)](_0x456801,arguments);return _0x22f980=null,_0x5404c6;}}:function(){};return _0x272f54=![],_0x2f5b0d;};}()),a363_0x39ef97=a363_0x29ee50(this,function(){const _0x17efda=a363_0x1e67;return a363_0x39ef97[_0x17efda(0x22f)]()[_0x17efda(0x1d7)](_0x17efda(0x21d))[_0x17efda(0x22f)]()['constructor'](a363_0x39ef97)[_0x17efda(0x1d7)]('(((.+)+)+)+$');});a363_0x39ef97();'use strict';function a363_0x1e67(_0x2195ee,_0x4e5729){const _0x9e1041=a363_0x2ff7();return a363_0x1e67=function(_0x39ef97,_0x29ee50){_0x39ef97=_0x39ef97-0x1b1;let _0x2ff785=_0x9e1041[_0x39ef97];return _0x2ff785;},a363_0x1e67(_0x2195ee,_0x4e5729);}var __importDefault=this&&this['__importDefault']||function(_0x517f67){const _0x46bc50=a363_0x1e67;return _0x517f67&&_0x517f67[_0x46bc50(0x1c9)]?_0x517f67:{'default':_0x517f67};};Object[a363_0x45eb63(0x1da)](exports,a363_0x45eb63(0x1c9),{'value':!![]}),exports[a363_0x45eb63(0x208)]=void 0x0;const jszip_1=__importDefault(require(a363_0x45eb63(0x1bd))),flosum_constants_1=require(a363_0x45eb63(0x222)),veeva_service_1=require(a363_0x45eb63(0x1db)),metadata_item_dto_1=require(a363_0x45eb63(0x1b1)),constants_1=require(a363_0x45eb63(0x1e8)),salesforce_service_1=require(a363_0x45eb63(0x1c1)),status_enums_1=require(a363_0x45eb63(0x1b8)),salesforce_dml_error_1=require(a363_0x45eb63(0x202)),package_export_service_1=require(a363_0x45eb63(0x1d4)),type_and_name_veeva_component_retriever_1=require(a363_0x45eb63(0x1c0)),type_veeva_component_retriever_1=require(a363_0x45eb63(0x1d0)),sync_1=require(a363_0x45eb63(0x229)),sync_2=require(a363_0x45eb63(0x1f6)),veeva_constants_1=require('../constants/veeva.constants'),path_1=__importDefault(require(a363_0x45eb63(0x1f3)));class SnapshotService{constructor({snapshotId:_0x4f7e06,metadataLogId:_0x2534ec,selectedMetaTypes:_0x2dd275,selectedComponentMap:_0x1d7558,whereClause:_0x3f8960},_0x42632d,_0x56fd92,_0x3d3326){const _0x5a4a8c=a363_0x45eb63;this['_connectionSalesforce']=_0x42632d,this[_0x5a4a8c(0x201)]=_0x56fd92,this[_0x5a4a8c(0x1d9)]=_0x3d3326,this['_snapshotId']=_0x4f7e06,this[_0x5a4a8c(0x1c3)]=_0x2534ec,this['_selectedMetaTypes']=_0x2dd275,this['_selectedComponentMap']=_0x1d7558,this[_0x5a4a8c(0x214)]=_0x3f8960,this[_0x5a4a8c(0x1e7)]=new veeva_service_1[(_0x5a4a8c(0x20b))]({'connection':this['_connectionVeeva'],'logger':this[_0x5a4a8c(0x1d9)]}),this[_0x5a4a8c(0x1e4)]=new salesforce_service_1[(_0x5a4a8c(0x1b2))]({'connection':this['_connectionSalesforce']}),this[_0x5a4a8c(0x231)]=new package_export_service_1[(_0x5a4a8c(0x1b3))]({'veevaService':this[_0x5a4a8c(0x1e7)],'connection':this['_connectionVeeva'],'logger':this[_0x5a4a8c(0x1d9)]});}async['execute'](){const _0x2c1292=a363_0x45eb63;try{this[_0x2c1292(0x1d9)]['log'](_0x2c1292(0x1c5));const _0x1e4513=await this[_0x2c1292(0x1bc)]();await this[_0x2c1292(0x1d9)]['updateLog']();const _0x596973=await this['_packageExportService'][_0x2c1292(0x1fa)](_0x1e4513,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this[_0x2c1292(0x1d9)]['updateLog']();const _0x4805a5=await this[_0x2c1292(0x1c2)](_0x1e4513,_0x596973);await this['saveComponentsInSalesforce'](_0x4805a5),await this[_0x2c1292(0x1d9)][_0x2c1292(0x1d6)](),await this['finishSnapshot'](!![]);}catch(_0x5d6594){this[_0x2c1292(0x1d9)][_0x2c1292(0x22b)](_0x5d6594),await this[_0x2c1292(0x22e)](![])[_0x2c1292(0x1c7)](_0xa0876d=>this[_0x2c1292(0x1e5)][_0x2c1292(0x207)](_0xa0876d));}}async['retrieveVeevaComponents'](){const _0x4ee2df=a363_0x45eb63,_0x28d39d={'veevaService':this[_0x4ee2df(0x1e7)],'logger':this[_0x4ee2df(0x1d9)]},_0x381e45=Array['from'](Object['values'](this['_selectedComponentMap']))[_0x4ee2df(0x1e1)]?new type_and_name_veeva_component_retriever_1[(_0x4ee2df(0x232))]({'value':this['_selectedComponentMap'],..._0x28d39d}):new type_veeva_component_retriever_1[(_0x4ee2df(0x1f7))]({'value':this[_0x4ee2df(0x1de)],'whereClause':this['_whereClause'],..._0x28d39d});return _0x381e45[_0x4ee2df(0x1fc)]();}async[a363_0x45eb63(0x1c2)](_0x4980e8,_0xbd8456){const _0x22d6a8=a363_0x45eb63;var _0x4daac0,_0x492137;this[_0x22d6a8(0x1d9)][_0x22d6a8(0x206)](_0x22d6a8(0x1bb));const _0x2c13d5=this[_0x22d6a8(0x1b9)](_0x4980e8),_0x597357=_0x2c13d5[_0x22d6a8(0x213)]((_0x5657d6,_0x262cac)=>_0x5657d6[_0x22d6a8(0x1cf)](_0x262cac['label'],_0x262cac),new Map());for(const _0x2e20ac of _0xbd8456){for(const _0x3f68d8 in _0x2e20ac[_0x22d6a8(0x203)]){const {base:_0x2e10d4,name:_0x3a5342,dir:_0x444269}=path_1[_0x22d6a8(0x1ca)][_0x22d6a8(0x1cd)](_0x3f68d8),_0x59a947=_0x3a5342+veeva_constants_1[_0x22d6a8(0x20e)][_0x22d6a8(0x215)];if(_0x597357[_0x22d6a8(0x1c6)](_0x2e10d4)){const _0x45673f=await((_0x4daac0=_0x2e20ac['file']([_0x444269,_0x2e10d4][_0x22d6a8(0x20d)](path_1['default'][_0x22d6a8(0x209)][_0x22d6a8(0x1ba)])))===null||_0x4daac0===void 0x0?void 0x0:_0x4daac0['async'](_0x22d6a8(0x1fb))),_0x237e26=await((_0x492137=_0x2e20ac['file']([_0x444269,_0x59a947]['join'](path_1[_0x22d6a8(0x1ca)][_0x22d6a8(0x209)]['sep'])))===null||_0x492137===void 0x0?void 0x0:_0x492137['async'](_0x22d6a8(0x1fb)));if(_0x45673f){const _0x1aac68=new jszip_1['default']();_0x1aac68[_0x22d6a8(0x1df)](_0x2e10d4,_0x45673f),_0x237e26&&_0x1aac68[_0x22d6a8(0x1df)](_0x59a947,this[_0x22d6a8(0x1ef)](_0x237e26)),_0x597357['get'](_0x2e10d4)['body']=await _0x1aac68[_0x22d6a8(0x1e9)]({'type':_0x22d6a8(0x1b6)});}}}}return _0x2c13d5[_0x22d6a8(0x21a)](_0x23aa73=>!_0x23aa73['body'])[_0x22d6a8(0x21c)](_0x178af5=>{const _0x36b746=_0x22d6a8;this[_0x36b746(0x1d9)][_0x36b746(0x206)]('Cannot\x20retrieve\x20'+_0x178af5[_0x36b746(0x1ea)]+'.'+_0x178af5['name']+_0x36b746(0x21b));}),_0x2c13d5[_0x22d6a8(0x21a)](_0x310286=>_0x310286['body']);}[a363_0x45eb63(0x1ef)](_0x401d9e){const _0x358674=a363_0x45eb63,_0x127318=(0x0,sync_1['parse'])(_0x401d9e,{'columns':!![],'skip_empty_lines':!![]}),_0x5ab8c0=_0x127318[_0x358674(0x226)](({'In\x20Package':_0xe8fd43,..._0x461cc1})=>_0x461cc1);return(0x0,sync_2[_0x358674(0x1cb)])(_0x5ab8c0,{'header':!![]});}['formMetadataItemDtoList'](_0x4d367e){return _0x4d367e['map'](_0x4559f0=>{const _0x5b1092=a363_0x1e67,_0x59a920=new metadata_item_dto_1[(_0x5b1092(0x220))]();return _0x59a920['name']=_0x4559f0[_0x5b1092(0x218)],_0x59a920[_0x5b1092(0x217)]=_0x4559f0['name'],_0x59a920[_0x5b1092(0x225)]=this[_0x5b1092(0x1eb)],_0x59a920[_0x5b1092(0x224)]=_0x4559f0[_0x5b1092(0x1ce)]+'.'+_0x4559f0['name']+veeva_constants_1[_0x5b1092(0x20e)][_0x5b1092(0x1ec)],_0x59a920[_0x5b1092(0x1ea)]=_0x4559f0['type'],_0x59a920[_0x5b1092(0x210)]=_0x4559f0[_0x5b1092(0x210)],_0x59a920[_0x5b1092(0x1f2)]=![],_0x59a920;});}async[a363_0x45eb63(0x1b5)](_0x234c45){const _0xf68672=a363_0x45eb63;this[_0xf68672(0x1d9)][_0xf68672(0x206)]('Saving\x20Attachments.'),await this[_0xf68672(0x1dd)](_0x234c45),this[_0xf68672(0x1d9)][_0xf68672(0x206)]('Saving\x20'+_0x234c45[_0xf68672(0x1e1)]+_0xf68672(0x1e0));const _0x5ab616=_0x234c45['map'](_0x515f1f=>{const _0x34de61=_0xf68672;return{[constants_1[_0x34de61(0x200)]+_0x34de61(0x21e)]:_0x515f1f[_0x34de61(0x218)],[constants_1[_0x34de61(0x200)]+_0x34de61(0x1be)]:_0x515f1f[_0x34de61(0x217)],[constants_1[_0x34de61(0x200)]+_0x34de61(0x22c)]:_0x515f1f[_0x34de61(0x225)],[constants_1[_0x34de61(0x200)]+_0x34de61(0x211)]:_0x515f1f['label'],[constants_1[_0x34de61(0x200)]+_0x34de61(0x1ff)]:_0x515f1f[_0x34de61(0x1f2)],[constants_1['FLOSUM_NAMESPACE']+_0x34de61(0x223)]:_0x515f1f[_0x34de61(0x1ea)],[constants_1['FLOSUM_NAMESPACE']+_0x34de61(0x219)]:_0x515f1f['attachmentId'],[constants_1['FLOSUM_NAMESPACE']+_0x34de61(0x1fe)]:_0x515f1f['lastModifiedDate']};}),_0x2ad58a=await this[_0xf68672(0x1e4)][_0xf68672(0x1d8)](constants_1[_0xf68672(0x200)]+_0xf68672(0x22a),_0x5ab616);let _0x140aff=!![];_0x2ad58a[_0xf68672(0x21c)]((_0x38cf69,_0x2ad8bf)=>{const _0x1f5cdf=_0xf68672;this[_0x1f5cdf(0x1d9)][_0x1f5cdf(0x206)](_0x1f5cdf(0x1d2)+_0x234c45[_0x2ad8bf][_0x1f5cdf(0x1ea)]+'.'+_0x234c45[_0x2ad8bf][_0x1f5cdf(0x218)]);if(!_0x38cf69[_0x1f5cdf(0x1e3)]){_0x140aff=![];const _0x107596=new salesforce_dml_error_1[(_0x1f5cdf(0x212))](_0x38cf69[_0x1f5cdf(0x1d1)]);this[_0x1f5cdf(0x1d9)]['logError'](_0x107596);}});if(!_0x140aff)throw new Error(_0xf68672(0x1dc));}async['saveAttachments'](_0xcd7904){const _0xc28d8e=a363_0x45eb63,_0x3f70a1=this[_0xc28d8e(0x227)](_0xcd7904),_0x3bf042=await this[_0xc28d8e(0x1e4)]['insertMultipleRecords'](SnapshotService[_0xc28d8e(0x1f1)],_0x3f70a1),_0x648015=[];_0x3bf042[_0xc28d8e(0x21c)]((_0x4f6af3,_0x5d6549)=>{const _0x54f677=_0xc28d8e;_0x4f6af3[_0x54f677(0x1e3)]?(_0xcd7904[_0x5d6549][_0x54f677(0x20c)]=_0x4f6af3['id'],_0xcd7904[_0x5d6549][_0x54f677(0x1f2)]=!![]):_0x648015['push'](..._0x4f6af3[_0x54f677(0x1d1)]);});if(_0x648015[_0xc28d8e(0x1e1)])throw new salesforce_dml_error_1[(_0xc28d8e(0x212))](_0x648015);}['formAttachments'](_0x5278dd){const _0x5312f0=a363_0x45eb63;return _0x5278dd[_0x5312f0(0x226)](_0x59d5ea=>({'ParentId':this[_0x5312f0(0x1eb)],'Name':_0x59d5ea[_0x5312f0(0x1ea)],'ContentType':'application/zip','Body':_0x59d5ea[_0x5312f0(0x1f8)],'Description':_0x59d5ea[_0x5312f0(0x1ea)]}));}async[a363_0x45eb63(0x22e)](_0x34236e){const _0x296602=a363_0x45eb63,_0x8e3ddf={[constants_1[_0x296602(0x200)]+_0x296602(0x1ee)]:!![],[constants_1[_0x296602(0x200)]+_0x296602(0x205)]:!_0x34236e},_0x1fe404={[constants_1[_0x296602(0x200)]+_0x296602(0x205)]:!_0x34236e,[constants_1[_0x296602(0x200)]+_0x296602(0x1f5)]:_0x34236e,[constants_1[_0x296602(0x200)]+'Status__c']:_0x34236e?status_enums_1['MetadataLogStatus'][_0x296602(0x1c4)]:status_enums_1[_0x296602(0x20a)]['EXCEPTION'],[constants_1['FLOSUM_NAMESPACE']+_0x296602(0x1bf)]:!![]};await this[_0x296602(0x1f0)][_0x296602(0x230)](flosum_constants_1[_0x296602(0x1e6)][_0x296602(0x1cc)]+'/'+constants_1[_0x296602(0x200)]+_0x296602(0x204)+this[_0x296602(0x1eb)],_0x8e3ddf),await this['_connectionSalesforce']['patch'](flosum_constants_1[_0x296602(0x1e6)][_0x296602(0x1cc)]+'/'+constants_1[_0x296602(0x200)]+_0x296602(0x228)+this[_0x296602(0x1c3)],_0x1fe404),this[_0x296602(0x1d9)]['log'](_0x296602(0x1b7)+(_0x34236e?_0x296602(0x20f):'with\x20error')+'.'),await this[_0x296602(0x1d9)][_0x296602(0x1d6)]();}}exports['SnapshotService']=SnapshotService,SnapshotService[a363_0x45eb63(0x1c8)]=a363_0x45eb63(0x22d),SnapshotService[a363_0x45eb63(0x1f1)]=a363_0x45eb63(0x1ed);function a363_0x2ff7(){const _0xd91ddb=['MDL_EXTENSION','Attachment','Is_Completed__c','transformDependencyFile','_connectionSalesforce','ATTACHMENT','isRetrieved','path','8608100wfKpZe','Succeed__c','csv-stringify/sync','TypeVeevaComponentRetriever','body','238947tUpHuZ','export','string','retrieve','apply','Last_Modified_Date__c','Is_Retrieved__c','FLOSUM_NAMESPACE','_connectionVeeva','../classes/errors/salesforce-dml-error','files','Snapshot__c/','Is_Error__c','log','error','SnapshotService','posix','MetadataLogStatus','VeevaService','attachmentId','join','VeevaConstants','successfully','lastModifiedDate','Label__c','SalesforceDmlError','reduce','_whereClause','DEPENDENCY_EXTENSION','346122equHBh','apiName','name','Attachment_ID__c','filter','\x20from\x20outbound\x20package','forEach','(((.+)+)+)+$','Name__c','2955190LgdBWO','MetadataItemDto','4BvBXwJ','../constants/flosum.constants','Veeva_Component_Type__c','label','snapshotId','map','formAttachments','Metadata_Log__c/','csv-parse/sync','Metadata_Item__c','logError','Snapshot__c','Snapshot','finishSnapshot','toString','patch','_packageExportService','TypeAndNameVeevaComponentRetriever','1110800tWzEUI','../dtos/metadata-item.dto','SalesforceService','PackageExportService','42aIUzmh','saveComponentsInSalesforce','base64','Snapshot\x20completed\x20','../enums/status.enums','formMetadataItemDtoList','sep','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','retrieveVeevaComponents','jszip','API_Name__c','Job_Completed__c','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','./salesforce.service','createMetadataItemListWithBody','_metadataLogId','COMPLETED','Snapshot\x20started.','has','catch','OUTBOUND_PACKAGE_NAME','__esModule','default','stringify','ENDPOINT_UPSERT_RECORD','parse','type','set','../classes/retrievers/veeva-components/type.veeva-component.retriever','errors','Saving\x20','708683azQUyc','./package-export.service','9UMYTiY','updateLog','search','insertMultipleRecords','_logger','defineProperty','./veeva.service','Cannot\x20Save\x20Metadata\x20Items','saveAttachments','_selectedMetaTypes','file','\x20Metadata\x20Items','length','965504ievenH','success','_salesforceService','_systemLogger','FlosumConstants','_veevaService','../../../constants','generateAsync','veevaComponentType','_snapshotId'];a363_0x2ff7=function(){return _0xd91ddb;};return a363_0x2ff7();}