const a407_0x357a61=a407_0xce2d;function a407_0x2cba(){const _0x2ea78b=['insertMultipleRecords','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','saveComponentsInSalesforce','FLOSUM_NAMESPACE','success','157458gtFowu','_selectedMetaTypes','SnapshotService','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','name','execute','constructor','async','logError','Metadata_Log__c/','defineProperty','_metadataLogId','24gCodWo','MetadataLogStatus','_whereClause','veevaComponentType','reduce','PackageExportService','string','body','../classes/retrievers/veeva-components/type.veeva-component.retriever','\x20Metadata\x20Items','MDL_EXTENSION','jszip','Is_Error__c','export','application/zip','Snapshot\x20started.','createMetadataItemListWithBody','_snapshotId','formAttachments','successfully','DEPENDENCY_EXTENSION','finishSnapshot','apiName','updateLog','_salesforceService','ATTACHMENT','values','csv-stringify/sync','retrieveVeevaComponents','formMetadataItemDtoList','patch','_logger','Label__c','length','label','834701gftHgO','OUTBOUND_PACKAGE_NAME','files','12PfpnpJ','VeevaService','SalesforceDmlError','__esModule','type','Succeed__c','attachmentId','default','toString','ENDPOINT_UPSERT_RECORD','saveAttachments','forEach','errors','Snapshot__c/','VeevaConstants','with\x20error','from','push','66684FsXVkJ','TypeVeevaComponentRetriever','csv-parse/sync','./package-export.service','TypeAndNameVeevaComponentRetriever','_selectedComponentMap','filter','_connectionSalesforce','base64','FlosumConstants','API_Name__c','has','2299956zWEzRW','COMPLETED','Saving\x20','join','Attachment_ID__c','isRetrieved','transformDependencyFile','Cannot\x20retrieve\x20','Job_Completed__c','snapshotId','_packageExportService','lastModifiedDate','Name__c','Snapshot__c','posix','../dtos/metadata-item.dto','368788GkjvLZ','_systemLogger','_connectionVeeva','search','EXCEPTION','Is_Retrieved__c','map','Veeva_Component_Type__c','Last_Modified_Date__c','../constants/flosum.constants','Saving\x20Attachments.','1970613mbLNex','1432385XunesL','log','_veevaService','retrieve','file'];a407_0x2cba=function(){return _0x2ea78b;};return a407_0x2cba();}(function(_0x2f91aa,_0x47854a){const _0x4000e6=a407_0xce2d,_0x4747d8=_0x2f91aa();while(!![]){try{const _0x3e1f66=parseInt(_0x4000e6(0x134))/0x1+-parseInt(_0x4000e6(0x11e))/0x2+parseInt(_0x4000e6(0x178))/0x3*(parseInt(_0x4000e6(0x166))/0x4)+-parseInt(_0x4000e6(0x12a))/0x5+parseInt(_0x4000e6(0x184))/0x6+parseInt(_0x4000e6(0x163))/0x7*(parseInt(_0x4000e6(0x140))/0x8)+-parseInt(_0x4000e6(0x129))/0x9;if(_0x3e1f66===_0x47854a)break;else _0x4747d8['push'](_0x4747d8['shift']());}catch(_0x310fe0){_0x4747d8['push'](_0x4747d8['shift']());}}}(a407_0x2cba,0x433a9));const a407_0x180536=(function(){let _0xeb9ebe=!![];return function(_0x13c71e,_0x40fe49){const _0x4d1bc3=_0xeb9ebe?function(){if(_0x40fe49){const _0x119593=_0x40fe49['apply'](_0x13c71e,arguments);return _0x40fe49=null,_0x119593;}}:function(){};return _0xeb9ebe=![],_0x4d1bc3;};}()),a407_0x29c618=a407_0x180536(this,function(){const _0x1c6fd5=a407_0xce2d;return a407_0x29c618['toString']()[_0x1c6fd5(0x121)]('(((.+)+)+)+$')[_0x1c6fd5(0x16e)]()[_0x1c6fd5(0x13a)](a407_0x29c618)['search']('(((.+)+)+)+$');});a407_0x29c618();'use strict';function a407_0xce2d(_0x30590c,_0x360fef){const _0x3d8305=a407_0x2cba();return a407_0xce2d=function(_0x29c618,_0x180536){_0x29c618=_0x29c618-0x114;let _0x2cbaea=_0x3d8305[_0x29c618];return _0x2cbaea;},a407_0xce2d(_0x30590c,_0x360fef);}var __importDefault=this&&this['__importDefault']||function(_0x39894f){const _0x577289=a407_0xce2d;return _0x39894f&&_0x39894f[_0x577289(0x169)]?_0x39894f:{'default':_0x39894f};};Object[a407_0x357a61(0x13e)](exports,a407_0x357a61(0x169),{'value':!![]}),exports['SnapshotService']=void 0x0;const jszip_1=__importDefault(require(a407_0x357a61(0x14b))),flosum_constants_1=require(a407_0x357a61(0x127)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require(a407_0x357a61(0x11d)),constants_1=require('../../../constants'),salesforce_service_1=require('./salesforce.service'),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require(a407_0x357a61(0x17b)),type_and_name_veeva_component_retriever_1=require(a407_0x357a61(0x137)),type_veeva_component_retriever_1=require(a407_0x357a61(0x148)),sync_1=require(a407_0x357a61(0x17a)),sync_2=require(a407_0x357a61(0x15b)),veeva_constants_1=require('../constants/veeva.constants'),path_1=__importDefault(require('path'));class SnapshotService{constructor({snapshotId:_0x3d7666,metadataLogId:_0x5134b5,selectedMetaTypes:_0x5a3022,selectedComponentMap:_0x39090c,whereClause:_0x5d5c13},_0x58f1ff,_0x31547e,_0x2c8233){const _0x4dc48b=a407_0x357a61;this[_0x4dc48b(0x17f)]=_0x58f1ff,this[_0x4dc48b(0x120)]=_0x31547e,this[_0x4dc48b(0x15f)]=_0x2c8233,this[_0x4dc48b(0x151)]=_0x3d7666,this[_0x4dc48b(0x13f)]=_0x5134b5,this['_selectedMetaTypes']=_0x5a3022,this[_0x4dc48b(0x17d)]=_0x39090c,this['_whereClause']=_0x5d5c13,this['_veevaService']=new veeva_service_1[(_0x4dc48b(0x167))]({'connection':this[_0x4dc48b(0x120)],'logger':this['_logger']}),this[_0x4dc48b(0x158)]=new salesforce_service_1['SalesforceService']({'connection':this['_connectionSalesforce']}),this[_0x4dc48b(0x118)]=new package_export_service_1[(_0x4dc48b(0x145))]({'veevaService':this[_0x4dc48b(0x12c)],'connection':this[_0x4dc48b(0x120)],'logger':this['_logger']});}async[a407_0x357a61(0x139)](){const _0x5aeec5=a407_0x357a61;try{this[_0x5aeec5(0x15f)][_0x5aeec5(0x12b)](_0x5aeec5(0x14f));const _0x579422=await this['retrieveVeevaComponents']();await this[_0x5aeec5(0x15f)][_0x5aeec5(0x157)]();const _0x31e2da=await this[_0x5aeec5(0x118)][_0x5aeec5(0x14d)](_0x579422,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this['_logger']['updateLog']();const _0x33bc11=await this[_0x5aeec5(0x150)](_0x579422,_0x31e2da);await this[_0x5aeec5(0x131)](_0x33bc11),await this[_0x5aeec5(0x15f)][_0x5aeec5(0x157)](),await this[_0x5aeec5(0x155)](!![]);}catch(_0x5efcf3){this[_0x5aeec5(0x15f)][_0x5aeec5(0x13c)](_0x5efcf3),await this['finishSnapshot'](![])['catch'](_0xb09366=>this[_0x5aeec5(0x11f)]['error'](_0xb09366));}}async[a407_0x357a61(0x15c)](){const _0x2e1b52=a407_0x357a61,_0x4145ed={'veevaService':this['_veevaService'],'logger':this['_logger']},_0x326540=Array[_0x2e1b52(0x176)](Object[_0x2e1b52(0x15a)](this[_0x2e1b52(0x17d)]))[_0x2e1b52(0x161)]?new type_and_name_veeva_component_retriever_1[(_0x2e1b52(0x17c))]({'value':this[_0x2e1b52(0x17d)],..._0x4145ed}):new type_veeva_component_retriever_1[(_0x2e1b52(0x179))]({'value':this[_0x2e1b52(0x135)],'whereClause':this[_0x2e1b52(0x142)],..._0x4145ed});return _0x326540[_0x2e1b52(0x12d)]();}async[a407_0x357a61(0x150)](_0x13cff1,_0x531c5b){const _0x38098b=a407_0x357a61;var _0x1c84f8,_0x219be6;this[_0x38098b(0x15f)][_0x38098b(0x12b)](_0x38098b(0x130));const _0xa912a9=this[_0x38098b(0x15d)](_0x13cff1),_0x50252f=_0xa912a9[_0x38098b(0x144)]((_0x3b8e97,_0x2dac4f)=>_0x3b8e97['set'](_0x2dac4f[_0x38098b(0x162)],_0x2dac4f),new Map());for(const _0x465004 of _0x531c5b){for(const _0x1b5657 in _0x465004[_0x38098b(0x165)]){const {base:_0x361d17,name:_0x382579,dir:_0x54eda6}=path_1['default']['parse'](_0x1b5657),_0x31d03f=_0x382579+veeva_constants_1['VeevaConstants'][_0x38098b(0x154)];if(_0x50252f[_0x38098b(0x183)](_0x361d17)){const _0x346e1d=await((_0x1c84f8=_0x465004[_0x38098b(0x12e)]([_0x54eda6,_0x361d17][_0x38098b(0x187)](path_1[_0x38098b(0x16d)][_0x38098b(0x11c)]['sep'])))===null||_0x1c84f8===void 0x0?void 0x0:_0x1c84f8[_0x38098b(0x13b)](_0x38098b(0x146))),_0x1783fd=await((_0x219be6=_0x465004['file']([_0x54eda6,_0x31d03f][_0x38098b(0x187)](path_1[_0x38098b(0x16d)][_0x38098b(0x11c)]['sep'])))===null||_0x219be6===void 0x0?void 0x0:_0x219be6[_0x38098b(0x13b)](_0x38098b(0x146)));if(_0x346e1d){const _0xb7343=new jszip_1['default']();_0xb7343[_0x38098b(0x12e)](_0x361d17,_0x346e1d),_0x1783fd&&_0xb7343[_0x38098b(0x12e)](_0x31d03f,this[_0x38098b(0x114)](_0x1783fd)),_0x50252f['get'](_0x361d17)['body']=await _0xb7343['generateAsync']({'type':_0x38098b(0x180)});}}}}return _0xa912a9[_0x38098b(0x17e)](_0x44f95c=>!_0x44f95c[_0x38098b(0x147)])[_0x38098b(0x171)](_0x41d78e=>{const _0x202126=_0x38098b;this[_0x202126(0x15f)]['log'](_0x202126(0x115)+_0x41d78e[_0x202126(0x143)]+'.'+_0x41d78e[_0x202126(0x138)]+'\x20from\x20outbound\x20package');}),_0xa912a9[_0x38098b(0x17e)](_0x486b92=>_0x486b92['body']);}['transformDependencyFile'](_0x22ee43){const _0x24f624=(0x0,sync_1['parse'])(_0x22ee43,{'columns':!![],'skip_empty_lines':!![]}),_0x13c31d=_0x24f624['map'](({'In\x20Package':_0x5d006c,..._0x5dcc85})=>_0x5dcc85);return(0x0,sync_2['stringify'])(_0x13c31d,{'header':!![]});}[a407_0x357a61(0x15d)](_0x2af8c5){const _0x2f027f=a407_0x357a61;return _0x2af8c5[_0x2f027f(0x124)](_0x2ce147=>{const _0x1183db=_0x2f027f,_0x20a78e=new metadata_item_dto_1['MetadataItemDto']();return _0x20a78e[_0x1183db(0x138)]=_0x2ce147[_0x1183db(0x138)],_0x20a78e[_0x1183db(0x156)]=_0x2ce147['name'],_0x20a78e[_0x1183db(0x117)]=this[_0x1183db(0x151)],_0x20a78e[_0x1183db(0x162)]=_0x2ce147[_0x1183db(0x16a)]+'.'+_0x2ce147['name']+veeva_constants_1[_0x1183db(0x174)][_0x1183db(0x14a)],_0x20a78e[_0x1183db(0x143)]=_0x2ce147[_0x1183db(0x16a)],_0x20a78e[_0x1183db(0x119)]=_0x2ce147['lastModifiedDate'],_0x20a78e[_0x1183db(0x189)]=![],_0x20a78e;});}async['saveComponentsInSalesforce'](_0x2e726c){const _0x55b60a=a407_0x357a61;this['_logger'][_0x55b60a(0x12b)](_0x55b60a(0x128)),await this[_0x55b60a(0x170)](_0x2e726c),this[_0x55b60a(0x15f)][_0x55b60a(0x12b)](_0x55b60a(0x186)+_0x2e726c[_0x55b60a(0x161)]+_0x55b60a(0x149));const _0x2df31e=_0x2e726c[_0x55b60a(0x124)](_0x3e5836=>{const _0x3f70c4=_0x55b60a;return{[constants_1['FLOSUM_NAMESPACE']+_0x3f70c4(0x11a)]:_0x3e5836[_0x3f70c4(0x138)],[constants_1[_0x3f70c4(0x132)]+_0x3f70c4(0x182)]:_0x3e5836['apiName'],[constants_1[_0x3f70c4(0x132)]+_0x3f70c4(0x11b)]:_0x3e5836[_0x3f70c4(0x117)],[constants_1[_0x3f70c4(0x132)]+_0x3f70c4(0x160)]:_0x3e5836[_0x3f70c4(0x162)],[constants_1['FLOSUM_NAMESPACE']+_0x3f70c4(0x123)]:_0x3e5836[_0x3f70c4(0x189)],[constants_1[_0x3f70c4(0x132)]+_0x3f70c4(0x125)]:_0x3e5836[_0x3f70c4(0x143)],[constants_1[_0x3f70c4(0x132)]+_0x3f70c4(0x188)]:_0x3e5836[_0x3f70c4(0x16c)],[constants_1[_0x3f70c4(0x132)]+_0x3f70c4(0x126)]:_0x3e5836[_0x3f70c4(0x119)]};}),_0x3397ee=await this[_0x55b60a(0x158)][_0x55b60a(0x12f)](constants_1['FLOSUM_NAMESPACE']+'Metadata_Item__c',_0x2df31e);let _0x242178=!![];_0x3397ee[_0x55b60a(0x171)]((_0x1798ad,_0x291ebf)=>{const _0x318d6c=_0x55b60a;this['_logger'][_0x318d6c(0x12b)]('Saving\x20'+_0x2e726c[_0x291ebf]['veevaComponentType']+'.'+_0x2e726c[_0x291ebf][_0x318d6c(0x138)]);if(!_0x1798ad[_0x318d6c(0x133)]){_0x242178=![];const _0x24b702=new salesforce_dml_error_1['SalesforceDmlError'](_0x1798ad[_0x318d6c(0x172)]);this[_0x318d6c(0x15f)]['logError'](_0x24b702);}});if(!_0x242178)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async[a407_0x357a61(0x170)](_0x120867){const _0x4ea177=a407_0x357a61,_0x1f5780=this[_0x4ea177(0x152)](_0x120867),_0x300966=await this[_0x4ea177(0x158)][_0x4ea177(0x12f)](SnapshotService[_0x4ea177(0x159)],_0x1f5780),_0x581272=[];_0x300966[_0x4ea177(0x171)]((_0x19df38,_0x160521)=>{const _0x3fd3aa=_0x4ea177;_0x19df38[_0x3fd3aa(0x133)]?(_0x120867[_0x160521][_0x3fd3aa(0x16c)]=_0x19df38['id'],_0x120867[_0x160521][_0x3fd3aa(0x189)]=!![]):_0x581272[_0x3fd3aa(0x177)](..._0x19df38['errors']);});if(_0x581272[_0x4ea177(0x161)])throw new salesforce_dml_error_1[(_0x4ea177(0x168))](_0x581272);}['formAttachments'](_0x4275f7){const _0x1a43f5=a407_0x357a61;return _0x4275f7[_0x1a43f5(0x124)](_0x348ca1=>({'ParentId':this[_0x1a43f5(0x151)],'Name':_0x348ca1[_0x1a43f5(0x143)],'ContentType':_0x1a43f5(0x14e),'Body':_0x348ca1[_0x1a43f5(0x147)],'Description':_0x348ca1[_0x1a43f5(0x143)]}));}async[a407_0x357a61(0x155)](_0x28d3eb){const _0x32ca19=a407_0x357a61,_0x190b30={[constants_1['FLOSUM_NAMESPACE']+'Is_Completed__c']:!![],[constants_1[_0x32ca19(0x132)]+_0x32ca19(0x14c)]:!_0x28d3eb},_0x2ce471={[constants_1[_0x32ca19(0x132)]+_0x32ca19(0x14c)]:!_0x28d3eb,[constants_1['FLOSUM_NAMESPACE']+_0x32ca19(0x16b)]:_0x28d3eb,[constants_1[_0x32ca19(0x132)]+'Status__c']:_0x28d3eb?status_enums_1[_0x32ca19(0x141)][_0x32ca19(0x185)]:status_enums_1[_0x32ca19(0x141)][_0x32ca19(0x122)],[constants_1['FLOSUM_NAMESPACE']+_0x32ca19(0x116)]:!![]};await this[_0x32ca19(0x17f)]['patch'](flosum_constants_1[_0x32ca19(0x181)][_0x32ca19(0x16f)]+'/'+constants_1[_0x32ca19(0x132)]+_0x32ca19(0x173)+this[_0x32ca19(0x151)],_0x190b30),await this[_0x32ca19(0x17f)][_0x32ca19(0x15e)](flosum_constants_1['FlosumConstants'][_0x32ca19(0x16f)]+'/'+constants_1[_0x32ca19(0x132)]+_0x32ca19(0x13d)+this[_0x32ca19(0x13f)],_0x2ce471),this[_0x32ca19(0x15f)][_0x32ca19(0x12b)]('Snapshot\x20completed\x20'+(_0x28d3eb?_0x32ca19(0x153):_0x32ca19(0x175))+'.'),await this['_logger']['updateLog']();}}exports[a407_0x357a61(0x136)]=SnapshotService,SnapshotService[a407_0x357a61(0x164)]='Snapshot',SnapshotService[a407_0x357a61(0x159)]='Attachment';