const a407_0x126292=a407_0x25c8;(function(_0xbf433e,_0x26420a){const _0x3a8d98=a407_0x25c8,_0x5d0da4=_0xbf433e();while(!![]){try{const _0x339882=-parseInt(_0x3a8d98(0xec))/0x1+-parseInt(_0x3a8d98(0xe2))/0x2+-parseInt(_0x3a8d98(0xd6))/0x3*(parseInt(_0x3a8d98(0x116))/0x4)+parseInt(_0x3a8d98(0xfb))/0x5*(-parseInt(_0x3a8d98(0xfd))/0x6)+parseInt(_0x3a8d98(0x94))/0x7+-parseInt(_0x3a8d98(0xd5))/0x8+-parseInt(_0x3a8d98(0x105))/0x9*(-parseInt(_0x3a8d98(0x115))/0xa);if(_0x339882===_0x26420a)break;else _0x5d0da4['push'](_0x5d0da4['shift']());}catch(_0x225743){_0x5d0da4['push'](_0x5d0da4['shift']());}}}(a407_0x4bc8,0xc19e3));const a407_0x114d67=(function(){let _0x16c8d4=!![];return function(_0x47d1eb,_0x308526){const _0x1acbeb=_0x16c8d4?function(){if(_0x308526){const _0x1c1d0d=_0x308526['apply'](_0x47d1eb,arguments);return _0x308526=null,_0x1c1d0d;}}:function(){};return _0x16c8d4=![],_0x1acbeb;};}()),a407_0xeeca74=a407_0x114d67(this,function(){const _0x7dc291=a407_0x25c8;return a407_0xeeca74[_0x7dc291(0xc9)]()[_0x7dc291(0xb1)](_0x7dc291(0xa4))[_0x7dc291(0xc9)]()[_0x7dc291(0xb6)](a407_0xeeca74)['search'](_0x7dc291(0xa4));});function a407_0x4bc8(){const _0x4ac19b=['./package-export.service','patch','Snapshot__c/','../classes/retrievers/veeva-components/type.veeva-component.retriever','retrieve','API_Name__c','VeevaService','SalesforceService','FLOSUM_NAMESPACE','10ejBQHX','320ZGBOUM','isRetrieved','2281475ZaHBxQ','length','default','forEach','defineProperty','../constants/veeva.constants','jszip','Label__c','\x20Metadata\x20Items','Status__c','_systemLogger','string','_connectionVeeva','execute','../classes/errors/salesforce-dml-error','_connectionSalesforce','(((.+)+)+)+$','SalesforceDmlError','DEPENDENCY_EXTENSION','createMetadataItemListWithBody','values','updateLog','path','../enums/status.enums','success','files','Last_Modified_Date__c','ATTACHMENT','Succeed__c','search','retrieveVeevaComponents','base64','Snapshot__c','_packageExportService','constructor','type','veevaComponentType','_veevaService','sep','saveComponentsInSalesforce','../dtos/metadata-item.dto','push','formMetadataItemDtoList','Metadata_Item__c','../../../constants','posix','Is_Error__c','__esModule','MetadataItemDto','Is_Completed__c','join','_snapshotId','_selectedMetaTypes','toString','_logger','Job_Completed__c','\x20from\x20outbound\x20package','TypeAndNameVeevaComponentRetriever','error','MDL_EXTENSION','apiName','../constants/flosum.constants','body','logError','Saving\x20Attachments.','6043528umtKpK','18051YXizdB','_metadataLogId','transformDependencyFile','VeevaConstants','snapshotId','reduce','file','Saving\x20','set','successfully','saveAttachments','_selectedComponentMap','2044152KvOJWY','catch','SnapshotService','Metadata_Log__c/','lastModifiedDate','label','formAttachments','async','csv-parse/sync','EXCEPTION','1255977SlOfaV','csv-stringify/sync','errors','finishSnapshot','Cannot\x20Save\x20Metadata\x20Items','TypeVeevaComponentRetriever','log','Name__c','FlosumConstants','Snapshot\x20started.','insertMultipleRecords','./veeva.service','filter','get','COMPLETED','3985xAxNwC','Veeva_Component_Type__c','894XJCuGt','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','_salesforceService','export','parse','__importDefault','attachmentId','OUTBOUND_PACKAGE_NAME','36906669UNAHDh','MetadataLogStatus','map','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','./salesforce.service','name','Attachment_ID__c'];a407_0x4bc8=function(){return _0x4ac19b;};return a407_0x4bc8();}a407_0xeeca74();'use strict';function a407_0x25c8(_0x2999aa,_0xd74788){const _0xa63636=a407_0x4bc8();return a407_0x25c8=function(_0xeeca74,_0x114d67){_0xeeca74=_0xeeca74-0x94;let _0x4bc809=_0xa63636[_0xeeca74];return _0x4bc809;},a407_0x25c8(_0x2999aa,_0xd74788);}var __importDefault=this&&this[a407_0x126292(0x102)]||function(_0x9f3123){const _0x50079c=a407_0x126292;return _0x9f3123&&_0x9f3123[_0x50079c(0xc3)]?_0x9f3123:{'default':_0x9f3123};};Object[a407_0x126292(0x98)](exports,'__esModule',{'value':!![]}),exports[a407_0x126292(0xe4)]=void 0x0;const jszip_1=__importDefault(require(a407_0x126292(0x9a))),flosum_constants_1=require(a407_0x126292(0xd1)),veeva_service_1=require(a407_0x126292(0xf7)),metadata_item_dto_1=require(a407_0x126292(0xbc)),constants_1=require(a407_0x126292(0xc0)),salesforce_service_1=require(a407_0x126292(0x109)),status_enums_1=require(a407_0x126292(0xab)),salesforce_dml_error_1=require(a407_0x126292(0xa2)),package_export_service_1=require(a407_0x126292(0x10c)),type_and_name_veeva_component_retriever_1=require(a407_0x126292(0x108)),type_veeva_component_retriever_1=require(a407_0x126292(0x10f)),sync_1=require(a407_0x126292(0xea)),sync_2=require(a407_0x126292(0xed)),veeva_constants_1=require(a407_0x126292(0x99)),path_1=__importDefault(require(a407_0x126292(0xaa)));class SnapshotService{constructor({snapshotId:_0x49f9de,metadataLogId:_0xc19bb5,selectedMetaTypes:_0xe833aa,selectedComponentMap:_0x123f82,whereClause:_0x18606e},_0xffb3d7,_0x5c391b,_0xc5c73){const _0x566a67=a407_0x126292;this[_0x566a67(0xa3)]=_0xffb3d7,this[_0x566a67(0xa0)]=_0x5c391b,this[_0x566a67(0xca)]=_0xc5c73,this[_0x566a67(0xc7)]=_0x49f9de,this[_0x566a67(0xd7)]=_0xc19bb5,this[_0x566a67(0xc8)]=_0xe833aa,this[_0x566a67(0xe1)]=_0x123f82,this['_whereClause']=_0x18606e,this[_0x566a67(0xb9)]=new veeva_service_1[(_0x566a67(0x112))]({'connection':this[_0x566a67(0xa0)],'logger':this[_0x566a67(0xca)]}),this[_0x566a67(0xff)]=new salesforce_service_1[(_0x566a67(0x113))]({'connection':this['_connectionSalesforce']}),this[_0x566a67(0xb5)]=new package_export_service_1['PackageExportService']({'veevaService':this[_0x566a67(0xb9)],'connection':this[_0x566a67(0xa0)],'logger':this[_0x566a67(0xca)]});}async[a407_0x126292(0xa1)](){const _0x548da9=a407_0x126292;try{this[_0x548da9(0xca)][_0x548da9(0xf2)](_0x548da9(0xf5));const _0x45f206=await this[_0x548da9(0xb2)]();await this[_0x548da9(0xca)]['updateLog']();const _0x78333e=await this['_packageExportService'][_0x548da9(0x100)](_0x45f206,SnapshotService[_0x548da9(0x104)]);await this[_0x548da9(0xca)]['updateLog']();const _0x103399=await this[_0x548da9(0xa7)](_0x45f206,_0x78333e);await this['saveComponentsInSalesforce'](_0x103399),await this[_0x548da9(0xca)][_0x548da9(0xa9)](),await this['finishSnapshot'](!![]);}catch(_0x3880bf){this[_0x548da9(0xca)][_0x548da9(0xd3)](_0x3880bf),await this[_0x548da9(0xef)](![])[_0x548da9(0xe3)](_0x50950f=>this[_0x548da9(0x9e)][_0x548da9(0xce)](_0x50950f));}}async[a407_0x126292(0xb2)](){const _0x4209a9=a407_0x126292,_0x82e3ca={'veevaService':this[_0x4209a9(0xb9)],'logger':this[_0x4209a9(0xca)]},_0x2eb3c5=Array['from'](Object[_0x4209a9(0xa8)](this[_0x4209a9(0xe1)]))[_0x4209a9(0x95)]?new type_and_name_veeva_component_retriever_1[(_0x4209a9(0xcd))]({'value':this[_0x4209a9(0xe1)],..._0x82e3ca}):new type_veeva_component_retriever_1[(_0x4209a9(0xf1))]({'value':this[_0x4209a9(0xc8)],'whereClause':this['_whereClause'],..._0x82e3ca});return _0x2eb3c5[_0x4209a9(0x110)]();}async[a407_0x126292(0xa7)](_0x3080f8,_0x176ca1){const _0x4185ea=a407_0x126292;var _0x228411,_0x2dc3b9;this['_logger'][_0x4185ea(0xf2)](_0x4185ea(0xfe));const _0x22fa71=this[_0x4185ea(0xbe)](_0x3080f8),_0x10a36a=_0x22fa71[_0x4185ea(0xdb)]((_0x2f39b1,_0x392065)=>_0x2f39b1[_0x4185ea(0xde)](_0x392065[_0x4185ea(0xe7)],_0x392065),new Map());for(const _0x272fc4 of _0x176ca1){for(const _0x26aea4 in _0x272fc4[_0x4185ea(0xad)]){const {base:_0x20e96d,name:_0x2f1271,dir:_0x1421df}=path_1[_0x4185ea(0x96)][_0x4185ea(0x101)](_0x26aea4),_0x56fd7f=_0x2f1271+veeva_constants_1['VeevaConstants'][_0x4185ea(0xa6)];if(_0x10a36a['has'](_0x20e96d)){const _0x1ed81d=await((_0x228411=_0x272fc4['file']([_0x1421df,_0x20e96d][_0x4185ea(0xc6)](path_1[_0x4185ea(0x96)][_0x4185ea(0xc1)][_0x4185ea(0xba)])))===null||_0x228411===void 0x0?void 0x0:_0x228411[_0x4185ea(0xe9)](_0x4185ea(0x9f))),_0x271600=await((_0x2dc3b9=_0x272fc4[_0x4185ea(0xdc)]([_0x1421df,_0x56fd7f][_0x4185ea(0xc6)](path_1[_0x4185ea(0x96)][_0x4185ea(0xc1)][_0x4185ea(0xba)])))===null||_0x2dc3b9===void 0x0?void 0x0:_0x2dc3b9[_0x4185ea(0xe9)](_0x4185ea(0x9f)));if(_0x1ed81d){const _0x2ef5b1=new jszip_1[(_0x4185ea(0x96))]();_0x2ef5b1[_0x4185ea(0xdc)](_0x20e96d,_0x1ed81d),_0x271600&&_0x2ef5b1[_0x4185ea(0xdc)](_0x56fd7f,this[_0x4185ea(0xd8)](_0x271600)),_0x10a36a[_0x4185ea(0xf9)](_0x20e96d)[_0x4185ea(0xd2)]=await _0x2ef5b1['generateAsync']({'type':_0x4185ea(0xb3)});}}}}return _0x22fa71['filter'](_0x1583bc=>!_0x1583bc['body'])[_0x4185ea(0x97)](_0x33b327=>{const _0x1c8e33=_0x4185ea;this[_0x1c8e33(0xca)][_0x1c8e33(0xf2)]('Cannot\x20retrieve\x20'+_0x33b327['veevaComponentType']+'.'+_0x33b327[_0x1c8e33(0x10a)]+_0x1c8e33(0xcc));}),_0x22fa71[_0x4185ea(0xf8)](_0x31868e=>_0x31868e['body']);}[a407_0x126292(0xd8)](_0x261ffc){const _0x12ea10=a407_0x126292,_0x6b452c=(0x0,sync_1[_0x12ea10(0x101)])(_0x261ffc,{'columns':!![],'skip_empty_lines':!![]}),_0x4c5edf=_0x6b452c[_0x12ea10(0x107)](({'In\x20Package':_0x330ffb,..._0x1e3268})=>_0x1e3268);return(0x0,sync_2['stringify'])(_0x4c5edf,{'header':!![]});}[a407_0x126292(0xbe)](_0xc15a8){return _0xc15a8['map'](_0x92cf1e=>{const _0x3a3d59=a407_0x25c8,_0x215da5=new metadata_item_dto_1[(_0x3a3d59(0xc4))]();return _0x215da5[_0x3a3d59(0x10a)]=_0x92cf1e[_0x3a3d59(0x10a)],_0x215da5[_0x3a3d59(0xd0)]=_0x92cf1e['name'],_0x215da5[_0x3a3d59(0xda)]=this[_0x3a3d59(0xc7)],_0x215da5[_0x3a3d59(0xe7)]=_0x92cf1e[_0x3a3d59(0xb7)]+'.'+_0x92cf1e[_0x3a3d59(0x10a)]+veeva_constants_1[_0x3a3d59(0xd9)][_0x3a3d59(0xcf)],_0x215da5[_0x3a3d59(0xb8)]=_0x92cf1e['type'],_0x215da5[_0x3a3d59(0xe6)]=_0x92cf1e[_0x3a3d59(0xe6)],_0x215da5[_0x3a3d59(0x117)]=![],_0x215da5;});}async[a407_0x126292(0xbb)](_0x3b5a82){const _0x186cbe=a407_0x126292;this[_0x186cbe(0xca)][_0x186cbe(0xf2)](_0x186cbe(0xd4)),await this[_0x186cbe(0xe0)](_0x3b5a82),this[_0x186cbe(0xca)][_0x186cbe(0xf2)](_0x186cbe(0xdd)+_0x3b5a82['length']+_0x186cbe(0x9c));const _0x476892=_0x3b5a82['map'](_0x57c868=>{const _0x54f207=_0x186cbe;return{[constants_1['FLOSUM_NAMESPACE']+_0x54f207(0xf3)]:_0x57c868[_0x54f207(0x10a)],[constants_1['FLOSUM_NAMESPACE']+_0x54f207(0x111)]:_0x57c868[_0x54f207(0xd0)],[constants_1['FLOSUM_NAMESPACE']+_0x54f207(0xb4)]:_0x57c868[_0x54f207(0xda)],[constants_1[_0x54f207(0x114)]+_0x54f207(0x9b)]:_0x57c868['label'],[constants_1[_0x54f207(0x114)]+'Is_Retrieved__c']:_0x57c868[_0x54f207(0x117)],[constants_1[_0x54f207(0x114)]+_0x54f207(0xfc)]:_0x57c868[_0x54f207(0xb8)],[constants_1[_0x54f207(0x114)]+_0x54f207(0x10b)]:_0x57c868[_0x54f207(0x103)],[constants_1[_0x54f207(0x114)]+_0x54f207(0xae)]:_0x57c868[_0x54f207(0xe6)]};}),_0x3953ca=await this['_salesforceService'][_0x186cbe(0xf6)](constants_1[_0x186cbe(0x114)]+_0x186cbe(0xbf),_0x476892);let _0x594ba5=!![];_0x3953ca['forEach']((_0x366e80,_0x759492)=>{const _0x4cbcb8=_0x186cbe;this[_0x4cbcb8(0xca)]['log'](_0x4cbcb8(0xdd)+_0x3b5a82[_0x759492][_0x4cbcb8(0xb8)]+'.'+_0x3b5a82[_0x759492][_0x4cbcb8(0x10a)]);if(!_0x366e80['success']){_0x594ba5=![];const _0x340a12=new salesforce_dml_error_1[(_0x4cbcb8(0xa5))](_0x366e80[_0x4cbcb8(0xee)]);this['_logger'][_0x4cbcb8(0xd3)](_0x340a12);}});if(!_0x594ba5)throw new Error(_0x186cbe(0xf0));}async[a407_0x126292(0xe0)](_0x3ddf09){const _0x27192c=a407_0x126292,_0x53234d=this['formAttachments'](_0x3ddf09),_0x18ee2a=await this[_0x27192c(0xff)][_0x27192c(0xf6)](SnapshotService[_0x27192c(0xaf)],_0x53234d),_0x5c2edd=[];_0x18ee2a[_0x27192c(0x97)]((_0x2d8207,_0x2e136e)=>{const _0x540fca=_0x27192c;_0x2d8207[_0x540fca(0xac)]?(_0x3ddf09[_0x2e136e][_0x540fca(0x103)]=_0x2d8207['id'],_0x3ddf09[_0x2e136e]['isRetrieved']=!![]):_0x5c2edd[_0x540fca(0xbd)](..._0x2d8207[_0x540fca(0xee)]);});if(_0x5c2edd[_0x27192c(0x95)])throw new salesforce_dml_error_1[(_0x27192c(0xa5))](_0x5c2edd);}[a407_0x126292(0xe8)](_0x4f7553){const _0x3d2f2f=a407_0x126292;return _0x4f7553['map'](_0x3c94ce=>({'ParentId':this[_0x3d2f2f(0xc7)],'Name':_0x3c94ce['veevaComponentType'],'ContentType':'application/zip','Body':_0x3c94ce['body'],'Description':_0x3c94ce[_0x3d2f2f(0xb8)]}));}async[a407_0x126292(0xef)](_0x1ebb67){const _0x50398f=a407_0x126292,_0x45292a={[constants_1['FLOSUM_NAMESPACE']+_0x50398f(0xc5)]:!![],[constants_1[_0x50398f(0x114)]+_0x50398f(0xc2)]:!_0x1ebb67},_0x4bb04c={[constants_1['FLOSUM_NAMESPACE']+'Is_Error__c']:!_0x1ebb67,[constants_1[_0x50398f(0x114)]+_0x50398f(0xb0)]:_0x1ebb67,[constants_1[_0x50398f(0x114)]+_0x50398f(0x9d)]:_0x1ebb67?status_enums_1[_0x50398f(0x106)][_0x50398f(0xfa)]:status_enums_1[_0x50398f(0x106)][_0x50398f(0xeb)],[constants_1[_0x50398f(0x114)]+_0x50398f(0xcb)]:!![]};await this[_0x50398f(0xa3)]['patch'](flosum_constants_1[_0x50398f(0xf4)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x50398f(0x114)]+_0x50398f(0x10e)+this['_snapshotId'],_0x45292a),await this[_0x50398f(0xa3)][_0x50398f(0x10d)](flosum_constants_1['FlosumConstants']['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x50398f(0x114)]+_0x50398f(0xe5)+this[_0x50398f(0xd7)],_0x4bb04c),this[_0x50398f(0xca)][_0x50398f(0xf2)]('Snapshot\x20completed\x20'+(_0x1ebb67?_0x50398f(0xdf):'with\x20error')+'.'),await this[_0x50398f(0xca)][_0x50398f(0xa9)]();}}exports[a407_0x126292(0xe4)]=SnapshotService,SnapshotService[a407_0x126292(0x104)]='Snapshot',SnapshotService[a407_0x126292(0xaf)]='Attachment';