function a379_0x371e(){const _0x30505f=['DEPENDENCY_EXTENSION','MetadataItemDto','_systemLogger','__importDefault','saveAttachments','Status__c','Is_Retrieved__c','SnapshotService','EXCEPTION','701708RGJAOf','PackageExportService','Saving\x20','../constants/veeva.constants','retrieveVeevaComponents','_connectionSalesforce','SalesforceService','../classes/retrievers/veeva-components/type.veeva-component.retriever','SalesforceDmlError','VeevaService','1706901ysnStS','__esModule','length','join','120xdGTmX','files','Job_Completed__c','success','log','path','has','Succeed__c','formAttachments','_connectionVeeva','attachmentId','successfully','Metadata_Item__c','./package-export.service','errors','_whereClause','Snapshot','map','jszip','type','stringify','Snapshot__c/','updateLog','../constants/flosum.constants','apiName','OUTBOUND_PACKAGE_NAME','transformDependencyFile','Veeva_Component_Type__c','(((.+)+)+)+$','_veevaService','Metadata_Log__c/','veevaComponentType','error','Cannot\x20retrieve\x20','base64','label','set','generateAsync','Cannot\x20Save\x20Metadata\x20Items','API_Name__c','_salesforceService','Is_Completed__c','5154RWBxyw','11893424GYdYBO','FLOSUM_NAMESPACE','_metadataLogId','posix','name','from','VeevaConstants','parse','Label__c','13940298DxNoOS','../dtos/metadata-item.dto','async','\x20from\x20outbound\x20package','ATTACHMENT','../../../constants','Snapshot\x20completed\x20','1101668XRmQUF','FlosumConstants','\x20Metadata\x20Items','105155qdtikV','constructor','_packageExportService','Attachment','_selectedMetaTypes','finishSnapshot','apply','string','../enums/status.enums','lastModifiedDate','reduce','search','_logger','formMetadataItemDtoList','catch','./veeva.service','forEach','toString','COMPLETED','filter','isRetrieved','_snapshotId','insertMultipleRecords','MetadataLogStatus','retrieve','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','Is_Error__c','body','push','default','saveComponentsInSalesforce','snapshotId','file','_selectedComponentMap','TypeVeevaComponentRetriever','with\x20error','application/zip','5425otJZuH','Snapshot\x20started.','logError'];a379_0x371e=function(){return _0x30505f;};return a379_0x371e();}const a379_0x35cabf=a379_0x3fc0;(function(_0x5dfd82,_0x493913){const _0xe239ee=a379_0x3fc0,_0x1839df=_0x5dfd82();while(!![]){try{const _0x44eb29=parseInt(_0xe239ee(0xa9))/0x1+-parseInt(_0xe239ee(0xf2))/0x2+parseInt(_0xe239ee(0xb3))/0x3+-parseInt(_0xe239ee(0xb7))/0x4*(parseInt(_0xe239ee(0xf5))/0x5)+parseInt(_0xe239ee(0xe1))/0x6*(parseInt(_0xe239ee(0x9d))/0x7)+-parseInt(_0xe239ee(0xe2))/0x8+parseInt(_0xe239ee(0xeb))/0x9;if(_0x44eb29===_0x493913)break;else _0x1839df['push'](_0x1839df['shift']());}catch(_0x4dcd06){_0x1839df['push'](_0x1839df['shift']());}}}(a379_0x371e,0xc76f0));const a379_0x542929=(function(){let _0x517593=!![];return function(_0x1aed5c,_0x1eb849){const _0x21362d=_0x517593?function(){const _0x1d2fc1=a379_0x3fc0;if(_0x1eb849){const _0x3a9697=_0x1eb849[_0x1d2fc1(0xfb)](_0x1aed5c,arguments);return _0x1eb849=null,_0x3a9697;}}:function(){};return _0x517593=![],_0x21362d;};}()),a379_0x550086=a379_0x542929(this,function(){const _0x415e52=a379_0x3fc0;return a379_0x550086['toString']()[_0x415e52(0x100)](_0x415e52(0xd3))[_0x415e52(0x89)]()[_0x415e52(0xf6)](a379_0x550086)['search']('(((.+)+)+)+$');});a379_0x550086();'use strict';var __importDefault=this&&this[a379_0x35cabf(0xa3)]||function(_0x5a76db){const _0x39a92b=a379_0x35cabf;return _0x5a76db&&_0x5a76db[_0x39a92b(0xb4)]?_0x5a76db:{'default':_0x5a76db};};Object['defineProperty'](exports,a379_0x35cabf(0xb4),{'value':!![]}),exports[a379_0x35cabf(0xa7)]=void 0x0;function a379_0x3fc0(_0x28a786,_0x5ecac9){const _0x395a99=a379_0x371e();return a379_0x3fc0=function(_0x550086,_0x542929){_0x550086=_0x550086-0x84;let _0x371ec4=_0x395a99[_0x550086];return _0x371ec4;},a379_0x3fc0(_0x28a786,_0x5ecac9);}const jszip_1=__importDefault(require(a379_0x35cabf(0xc9))),flosum_constants_1=require(a379_0x35cabf(0xce)),veeva_service_1=require(a379_0x35cabf(0x87)),metadata_item_dto_1=require(a379_0x35cabf(0xec)),constants_1=require(a379_0x35cabf(0xf0)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a379_0x35cabf(0xfd)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require(a379_0x35cabf(0xc4)),type_and_name_veeva_component_retriever_1=require(a379_0x35cabf(0x91)),type_veeva_component_retriever_1=require(a379_0x35cabf(0xb0)),sync_1=require('csv-parse/sync'),sync_2=require('csv-stringify/sync'),veeva_constants_1=require(a379_0x35cabf(0xac)),path_1=__importDefault(require(a379_0x35cabf(0xbc)));class SnapshotService{constructor({snapshotId:_0x26bf1c,metadataLogId:_0x5c6d15,selectedMetaTypes:_0x2b2c3d,selectedComponentMap:_0x1ce620,whereClause:_0x168a9b},_0x48e23e,_0x3cbf04,_0x75d0bd){const _0x2f7481=a379_0x35cabf;this[_0x2f7481(0xae)]=_0x48e23e,this[_0x2f7481(0xc0)]=_0x3cbf04,this[_0x2f7481(0x84)]=_0x75d0bd,this[_0x2f7481(0x8d)]=_0x26bf1c,this[_0x2f7481(0xe4)]=_0x5c6d15,this[_0x2f7481(0xf9)]=_0x2b2c3d,this[_0x2f7481(0x99)]=_0x1ce620,this['_whereClause']=_0x168a9b,this[_0x2f7481(0xd4)]=new veeva_service_1[(_0x2f7481(0xb2))]({'connection':this[_0x2f7481(0xc0)],'logger':this[_0x2f7481(0x84)]}),this[_0x2f7481(0xdf)]=new salesforce_service_1[(_0x2f7481(0xaf))]({'connection':this[_0x2f7481(0xae)]}),this[_0x2f7481(0xf7)]=new package_export_service_1[(_0x2f7481(0xaa))]({'veevaService':this['_veevaService'],'connection':this[_0x2f7481(0xc0)],'logger':this[_0x2f7481(0x84)]});}async['execute'](){const _0x273e7e=a379_0x35cabf;try{this['_logger'][_0x273e7e(0xbb)](_0x273e7e(0x9e));const _0x149951=await this['retrieveVeevaComponents']();await this[_0x273e7e(0x84)][_0x273e7e(0xcd)]();const _0x449ca0=await this[_0x273e7e(0xf7)]['export'](_0x149951,SnapshotService[_0x273e7e(0xd0)]);await this[_0x273e7e(0x84)][_0x273e7e(0xcd)]();const _0x514c31=await this['createMetadataItemListWithBody'](_0x149951,_0x449ca0);await this[_0x273e7e(0x96)](_0x514c31),await this[_0x273e7e(0x84)][_0x273e7e(0xcd)](),await this[_0x273e7e(0xfa)](!![]);}catch(_0x82002){this[_0x273e7e(0x84)][_0x273e7e(0x9f)](_0x82002),await this[_0x273e7e(0xfa)](![])[_0x273e7e(0x86)](_0x4f808b=>this[_0x273e7e(0xa2)][_0x273e7e(0xd7)](_0x4f808b));}}async[a379_0x35cabf(0xad)](){const _0x65d01d=a379_0x35cabf,_0x1c376d={'veevaService':this[_0x65d01d(0xd4)],'logger':this[_0x65d01d(0x84)]},_0x3fa05a=Array[_0x65d01d(0xe7)](Object['values'](this[_0x65d01d(0x99)]))[_0x65d01d(0xb5)]?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x65d01d(0x99)],..._0x1c376d}):new type_veeva_component_retriever_1[(_0x65d01d(0x9a))]({'value':this['_selectedMetaTypes'],'whereClause':this[_0x65d01d(0xc6)],..._0x1c376d});return _0x3fa05a[_0x65d01d(0x90)]();}async['createMetadataItemListWithBody'](_0x15f32b,_0x35ce82){const _0x4d798b=a379_0x35cabf;var _0x3c6454,_0x17e33a;this[_0x4d798b(0x84)][_0x4d798b(0xbb)]('Unpack\x20zip\x20and\x20create\x20metadata\x20items.');const _0x3147d4=this[_0x4d798b(0x85)](_0x15f32b),_0x14068d=_0x3147d4[_0x4d798b(0xff)]((_0x22a7de,_0x524eff)=>_0x22a7de[_0x4d798b(0xdb)](_0x524eff[_0x4d798b(0xda)],_0x524eff),new Map());for(const _0x1ac63a of _0x35ce82){for(const _0x3b4812 in _0x1ac63a[_0x4d798b(0xb8)]){const {base:_0x4f8cfb,name:_0x39f02f,dir:_0x47dc5e}=path_1[_0x4d798b(0x95)][_0x4d798b(0xe9)](_0x3b4812),_0x335f2b=_0x39f02f+veeva_constants_1[_0x4d798b(0xe8)][_0x4d798b(0xa0)];if(_0x14068d[_0x4d798b(0xbd)](_0x4f8cfb)){const _0x51b8e5=await((_0x3c6454=_0x1ac63a['file']([_0x47dc5e,_0x4f8cfb][_0x4d798b(0xb6)](path_1[_0x4d798b(0x95)][_0x4d798b(0xe5)]['sep'])))===null||_0x3c6454===void 0x0?void 0x0:_0x3c6454[_0x4d798b(0xed)]('string')),_0x487f00=await((_0x17e33a=_0x1ac63a[_0x4d798b(0x98)]([_0x47dc5e,_0x335f2b]['join'](path_1[_0x4d798b(0x95)][_0x4d798b(0xe5)]['sep'])))===null||_0x17e33a===void 0x0?void 0x0:_0x17e33a[_0x4d798b(0xed)](_0x4d798b(0xfc)));if(_0x51b8e5){const _0x36d1bd=new jszip_1[(_0x4d798b(0x95))]();_0x36d1bd[_0x4d798b(0x98)](_0x4f8cfb,_0x51b8e5),_0x487f00&&_0x36d1bd[_0x4d798b(0x98)](_0x335f2b,this[_0x4d798b(0xd1)](_0x487f00)),_0x14068d['get'](_0x4f8cfb)[_0x4d798b(0x93)]=await _0x36d1bd[_0x4d798b(0xdc)]({'type':_0x4d798b(0xd9)});}}}}return _0x3147d4[_0x4d798b(0x8b)](_0x52cedf=>!_0x52cedf[_0x4d798b(0x93)])[_0x4d798b(0x88)](_0x2156a3=>{const _0xdff5cc=_0x4d798b;this[_0xdff5cc(0x84)][_0xdff5cc(0xbb)](_0xdff5cc(0xd8)+_0x2156a3['veevaComponentType']+'.'+_0x2156a3['name']+_0xdff5cc(0xee));}),_0x3147d4[_0x4d798b(0x8b)](_0x7235e8=>_0x7235e8[_0x4d798b(0x93)]);}['transformDependencyFile'](_0x3dddb0){const _0x4d2c07=a379_0x35cabf,_0x3105cc=(0x0,sync_1[_0x4d2c07(0xe9)])(_0x3dddb0,{'columns':!![],'skip_empty_lines':!![]}),_0x339954=_0x3105cc[_0x4d2c07(0xc8)](({'In\x20Package':_0x323fbb,..._0x21ef66})=>_0x21ef66);return(0x0,sync_2[_0x4d2c07(0xcb)])(_0x339954,{'header':!![]});}['formMetadataItemDtoList'](_0x3495d7){const _0x8ca40a=a379_0x35cabf;return _0x3495d7[_0x8ca40a(0xc8)](_0x4dbe36=>{const _0x32a763=_0x8ca40a,_0x7d0cb2=new metadata_item_dto_1[(_0x32a763(0xa1))]();return _0x7d0cb2[_0x32a763(0xe6)]=_0x4dbe36[_0x32a763(0xe6)],_0x7d0cb2[_0x32a763(0xcf)]=_0x4dbe36[_0x32a763(0xe6)],_0x7d0cb2[_0x32a763(0x97)]=this[_0x32a763(0x8d)],_0x7d0cb2[_0x32a763(0xda)]=_0x4dbe36[_0x32a763(0xca)]+'.'+_0x4dbe36[_0x32a763(0xe6)]+veeva_constants_1['VeevaConstants']['MDL_EXTENSION'],_0x7d0cb2[_0x32a763(0xd6)]=_0x4dbe36[_0x32a763(0xca)],_0x7d0cb2[_0x32a763(0xfe)]=_0x4dbe36[_0x32a763(0xfe)],_0x7d0cb2['isRetrieved']=![],_0x7d0cb2;});}async[a379_0x35cabf(0x96)](_0x24a594){const _0x24505c=a379_0x35cabf;this['_logger'][_0x24505c(0xbb)]('Saving\x20Attachments.'),await this[_0x24505c(0xa4)](_0x24a594),this['_logger'][_0x24505c(0xbb)](_0x24505c(0xab)+_0x24a594[_0x24505c(0xb5)]+_0x24505c(0xf4));const _0x530d63=_0x24a594[_0x24505c(0xc8)](_0x1a32dd=>{const _0x1b6e16=_0x24505c;return{[constants_1['FLOSUM_NAMESPACE']+'Name__c']:_0x1a32dd['name'],[constants_1['FLOSUM_NAMESPACE']+_0x1b6e16(0xde)]:_0x1a32dd[_0x1b6e16(0xcf)],[constants_1[_0x1b6e16(0xe3)]+'Snapshot__c']:_0x1a32dd[_0x1b6e16(0x97)],[constants_1[_0x1b6e16(0xe3)]+_0x1b6e16(0xea)]:_0x1a32dd['label'],[constants_1[_0x1b6e16(0xe3)]+_0x1b6e16(0xa6)]:_0x1a32dd[_0x1b6e16(0x8c)],[constants_1[_0x1b6e16(0xe3)]+_0x1b6e16(0xd2)]:_0x1a32dd['veevaComponentType'],[constants_1['FLOSUM_NAMESPACE']+'Attachment_ID__c']:_0x1a32dd[_0x1b6e16(0xc1)],[constants_1['FLOSUM_NAMESPACE']+'Last_Modified_Date__c']:_0x1a32dd[_0x1b6e16(0xfe)]};}),_0x53d65f=await this[_0x24505c(0xdf)]['insertMultipleRecords'](constants_1[_0x24505c(0xe3)]+_0x24505c(0xc3),_0x530d63);let _0x6fddc2=!![];_0x53d65f[_0x24505c(0x88)]((_0x4b66e6,_0x388c25)=>{const _0x4ee9cf=_0x24505c;this[_0x4ee9cf(0x84)]['log'](_0x4ee9cf(0xab)+_0x24a594[_0x388c25][_0x4ee9cf(0xd6)]+'.'+_0x24a594[_0x388c25][_0x4ee9cf(0xe6)]);if(!_0x4b66e6['success']){_0x6fddc2=![];const _0x4b4674=new salesforce_dml_error_1[(_0x4ee9cf(0xb1))](_0x4b66e6[_0x4ee9cf(0xc5)]);this[_0x4ee9cf(0x84)][_0x4ee9cf(0x9f)](_0x4b4674);}});if(!_0x6fddc2)throw new Error(_0x24505c(0xdd));}async[a379_0x35cabf(0xa4)](_0x5d9181){const _0x50c4a8=a379_0x35cabf,_0x182b0a=this['formAttachments'](_0x5d9181),_0x2246b1=await this[_0x50c4a8(0xdf)][_0x50c4a8(0x8e)](SnapshotService['ATTACHMENT'],_0x182b0a),_0x1e3f2c=[];_0x2246b1[_0x50c4a8(0x88)]((_0x270ca4,_0x33b3f3)=>{const _0x2f2cb8=_0x50c4a8;_0x270ca4[_0x2f2cb8(0xba)]?(_0x5d9181[_0x33b3f3][_0x2f2cb8(0xc1)]=_0x270ca4['id'],_0x5d9181[_0x33b3f3]['isRetrieved']=!![]):_0x1e3f2c[_0x2f2cb8(0x94)](..._0x270ca4[_0x2f2cb8(0xc5)]);});if(_0x1e3f2c['length'])throw new salesforce_dml_error_1[(_0x50c4a8(0xb1))](_0x1e3f2c);}[a379_0x35cabf(0xbf)](_0x1d316e){const _0x518f29=a379_0x35cabf;return _0x1d316e[_0x518f29(0xc8)](_0x2b8ff4=>({'ParentId':this[_0x518f29(0x8d)],'Name':_0x2b8ff4['veevaComponentType'],'ContentType':_0x518f29(0x9c),'Body':_0x2b8ff4[_0x518f29(0x93)],'Description':_0x2b8ff4[_0x518f29(0xd6)]}));}async[a379_0x35cabf(0xfa)](_0x2ef1cc){const _0x5ce21a=a379_0x35cabf,_0x1101db={[constants_1[_0x5ce21a(0xe3)]+_0x5ce21a(0xe0)]:!![],[constants_1[_0x5ce21a(0xe3)]+_0x5ce21a(0x92)]:!_0x2ef1cc},_0x3ef290={[constants_1[_0x5ce21a(0xe3)]+_0x5ce21a(0x92)]:!_0x2ef1cc,[constants_1[_0x5ce21a(0xe3)]+_0x5ce21a(0xbe)]:_0x2ef1cc,[constants_1['FLOSUM_NAMESPACE']+_0x5ce21a(0xa5)]:_0x2ef1cc?status_enums_1[_0x5ce21a(0x8f)][_0x5ce21a(0x8a)]:status_enums_1[_0x5ce21a(0x8f)][_0x5ce21a(0xa8)],[constants_1[_0x5ce21a(0xe3)]+_0x5ce21a(0xb9)]:!![]};await this[_0x5ce21a(0xae)]['patch'](flosum_constants_1[_0x5ce21a(0xf3)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x5ce21a(0xe3)]+_0x5ce21a(0xcc)+this[_0x5ce21a(0x8d)],_0x1101db),await this['_connectionSalesforce']['patch'](flosum_constants_1[_0x5ce21a(0xf3)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x5ce21a(0xe3)]+_0x5ce21a(0xd5)+this['_metadataLogId'],_0x3ef290),this[_0x5ce21a(0x84)][_0x5ce21a(0xbb)](_0x5ce21a(0xf1)+(_0x2ef1cc?_0x5ce21a(0xc2):_0x5ce21a(0x9b))+'.'),await this[_0x5ce21a(0x84)][_0x5ce21a(0xcd)]();}}exports['SnapshotService']=SnapshotService,SnapshotService[a379_0x35cabf(0xd0)]=a379_0x35cabf(0xc7),SnapshotService[a379_0x35cabf(0xef)]=a379_0x35cabf(0xf8);