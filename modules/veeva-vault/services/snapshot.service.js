const a363_0x3858a0=a363_0x1645;(function(_0x4f4985,_0x355086){const _0x335044=a363_0x1645,_0x5855d4=_0x4f4985();while(!![]){try{const _0xd5d2a8=parseInt(_0x335044(0x1b9))/0x1*(parseInt(_0x335044(0x1c3))/0x2)+parseInt(_0x335044(0x1d2))/0x3*(-parseInt(_0x335044(0x182))/0x4)+parseInt(_0x335044(0x1c1))/0x5*(parseInt(_0x335044(0x1ce))/0x6)+parseInt(_0x335044(0x197))/0x7+parseInt(_0x335044(0x1dc))/0x8+parseInt(_0x335044(0x1d9))/0x9+-parseInt(_0x335044(0x1a5))/0xa;if(_0xd5d2a8===_0x355086)break;else _0x5855d4['push'](_0x5855d4['shift']());}catch(_0x59b296){_0x5855d4['push'](_0x5855d4['shift']());}}}(a363_0x3e2a,0x84dd7));const a363_0x4a96fa=(function(){let _0x3a2f81=!![];return function(_0xe931e3,_0x1ed553){const _0x50698f=_0x3a2f81?function(){const _0x19b87a=a363_0x1645;if(_0x1ed553){const _0x416b40=_0x1ed553[_0x19b87a(0x1e1)](_0xe931e3,arguments);return _0x1ed553=null,_0x416b40;}}:function(){};return _0x3a2f81=![],_0x50698f;};}()),a363_0x202eef=a363_0x4a96fa(this,function(){const _0x1972ce=a363_0x1645;return a363_0x202eef[_0x1972ce(0x178)]()[_0x1972ce(0x1d0)]('(((.+)+)+)+$')[_0x1972ce(0x178)]()[_0x1972ce(0x18d)](a363_0x202eef)['search'](_0x1972ce(0x188));});function a363_0x1645(_0x144c68,_0x6fbe53){const _0x31a899=a363_0x3e2a();return a363_0x1645=function(_0x202eef,_0x4a96fa){_0x202eef=_0x202eef-0x168;let _0x3e2a8c=_0x31a899[_0x202eef];return _0x3e2a8c;},a363_0x1645(_0x144c68,_0x6fbe53);}a363_0x202eef();'use strict';var __importDefault=this&&this[a363_0x3858a0(0x1d5)]||function(_0x459d2b){return _0x459d2b&&_0x459d2b['__esModule']?_0x459d2b:{'default':_0x459d2b};};Object['defineProperty'](exports,a363_0x3858a0(0x168),{'value':!![]}),exports[a363_0x3858a0(0x1ac)]=void 0x0;const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require(a363_0x3858a0(0x1ba)),veeva_service_1=require('./veeva.service'),metadata_item_dto_1=require(a363_0x3858a0(0x1c5)),constants_1=require(a363_0x3858a0(0x16d)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a363_0x3858a0(0x1ab)),salesforce_dml_error_1=require(a363_0x3858a0(0x1a6)),package_export_service_1=require('./package-export.service'),type_and_name_veeva_component_retriever_1=require(a363_0x3858a0(0x199)),type_veeva_component_retriever_1=require(a363_0x3858a0(0x18b)),sync_1=require('csv-parse/sync'),sync_2=require(a363_0x3858a0(0x1cc)),veeva_constants_1=require(a363_0x3858a0(0x1d1)),path_1=__importDefault(require(a363_0x3858a0(0x16a)));class SnapshotService{constructor(_0x5c57c4,_0x4956f6,_0xb57667,_0x1fa2fe){const _0x1350c9=a363_0x3858a0;this[_0x1350c9(0x1d7)]=_0x4956f6,this[_0x1350c9(0x16c)]=_0xb57667,this[_0x1350c9(0x176)]=_0x1fa2fe,this[_0x1350c9(0x18a)]=_0x5c57c4['snapshotId'],this[_0x1350c9(0x181)]=_0x5c57c4[_0x1350c9(0x19c)],this[_0x1350c9(0x1a2)]=_0x5c57c4['attachmentLogId'],this[_0x1350c9(0x1b6)]=_0x5c57c4[_0x1350c9(0x19f)],this[_0x1350c9(0x175)]=_0x5c57c4['selectedMetaTypes'],this[_0x1350c9(0x1a9)]=_0x5c57c4[_0x1350c9(0x185)],this[_0x1350c9(0x1c0)]=new veeva_service_1['VeevaService']({'connection':this[_0x1350c9(0x16c)],'logger':this[_0x1350c9(0x176)]}),this[_0x1350c9(0x1b4)]=new salesforce_service_1[(_0x1350c9(0x1d3))]({'connection':this[_0x1350c9(0x1d7)]}),this[_0x1350c9(0x1a7)]=new package_export_service_1[(_0x1350c9(0x19b))]({'veevaService':this[_0x1350c9(0x1c0)],'connection':this['_connectionVeeva'],'logger':this[_0x1350c9(0x176)]});}async[a363_0x3858a0(0x1e4)](){const _0x1fea73=a363_0x3858a0;try{this[_0x1fea73(0x176)][_0x1fea73(0x1a8)]('Snapshot\x20started.');const _0x2baa55=await this['retrieveVeevaComponents']();await this[_0x1fea73(0x176)][_0x1fea73(0x1ad)]();const _0x26b1bb=await this[_0x1fea73(0x1a7)][_0x1fea73(0x179)](_0x2baa55,SnapshotService[_0x1fea73(0x1bf)]);await this['_logger'][_0x1fea73(0x1ad)]();const _0x2df7f2=await this[_0x1fea73(0x17a)](_0x2baa55,_0x26b1bb);await this[_0x1fea73(0x172)](_0x2df7f2),await this['_logger'][_0x1fea73(0x1ad)](),await this[_0x1fea73(0x1de)](!![]);}catch(_0x55c74b){this[_0x1fea73(0x176)][_0x1fea73(0x1c7)](_0x55c74b),await this['finishSnapshot'](![])['catch'](_0x3973fd=>this[_0x1fea73(0x174)][_0x1fea73(0x191)](_0x3973fd));}}async['retrieveVeevaComponents'](){const _0x3cb799=a363_0x3858a0,_0x4da6ec={'veevaService':this[_0x3cb799(0x1c0)],'logger':this['_logger']},_0x273f3f=Array[_0x3cb799(0x1df)](Object[_0x3cb799(0x195)](this['_selectedComponentMap']))['length']?new type_and_name_veeva_component_retriever_1[(_0x3cb799(0x1a1))]({'value':this[_0x3cb799(0x1a9)],..._0x4da6ec}):new type_veeva_component_retriever_1['TypeVeevaComponentRetriever']({'value':this[_0x3cb799(0x175)],..._0x4da6ec});return _0x273f3f[_0x3cb799(0x16b)]();}async[a363_0x3858a0(0x17a)](_0x1101ab,_0x193b94){const _0x666f07=a363_0x3858a0;var _0x1a284e,_0x4dfe7a;this['_logger'][_0x666f07(0x1a8)](_0x666f07(0x1bb));const _0x4c51c0=this[_0x666f07(0x1aa)](_0x1101ab),_0x187f48=_0x4c51c0[_0x666f07(0x19a)]((_0xa490d9,_0x4a7d71)=>_0xa490d9[_0x666f07(0x1ca)](_0x4a7d71[_0x666f07(0x1dd)],_0x4a7d71),new Map());for(const _0x380cd5 of _0x193b94){for(const _0x140393 in _0x380cd5[_0x666f07(0x173)]){const {base:_0x350d3d,name:_0x352a18,dir:_0x2ad1c7}=path_1[_0x666f07(0x1b3)][_0x666f07(0x192)](_0x140393),_0x591912=_0x352a18+veeva_constants_1[_0x666f07(0x18e)][_0x666f07(0x1bd)];if(_0x187f48['has'](_0x350d3d)){const _0x592977=await((_0x1a284e=_0x380cd5[_0x666f07(0x190)](path_1[_0x666f07(0x1b3)][_0x666f07(0x1ae)](_0x2ad1c7,_0x350d3d)))===null||_0x1a284e===void 0x0?void 0x0:_0x1a284e['async']('string')),_0x551932=await((_0x4dfe7a=_0x380cd5[_0x666f07(0x190)](path_1[_0x666f07(0x1b3)][_0x666f07(0x1ae)](_0x2ad1c7,_0x591912)))===null||_0x4dfe7a===void 0x0?void 0x0:_0x4dfe7a[_0x666f07(0x18c)](_0x666f07(0x189)));if(_0x592977&&_0x551932){const _0x429c30=new jszip_1['default']();_0x429c30[_0x666f07(0x190)](_0x350d3d,_0x592977),_0x429c30[_0x666f07(0x190)](_0x591912,this[_0x666f07(0x1a3)](_0x551932)),_0x187f48[_0x666f07(0x170)](_0x350d3d)['body']=await _0x429c30[_0x666f07(0x1c2)]({'type':_0x666f07(0x19d)});}}}}return _0x4c51c0[_0x666f07(0x1af)](_0x1134e9=>!_0x1134e9[_0x666f07(0x171)])[_0x666f07(0x184)](_0x58df3b=>{const _0x408d12=_0x666f07;this['_logger'][_0x408d12(0x1a8)](_0x408d12(0x1c8)+_0x58df3b[_0x408d12(0x183)]+'.'+_0x58df3b[_0x408d12(0x198)]+_0x408d12(0x18f));}),_0x4c51c0[_0x666f07(0x1af)](_0x16e57a=>_0x16e57a[_0x666f07(0x171)]);}['transformDependencyFile'](_0x40139e){const _0x58dc0c=a363_0x3858a0,_0x2db650=(0x0,sync_1['parse'])(_0x40139e,{'columns':!![],'skip_empty_lines':!![]}),_0x4f2fcc=_0x2db650['map'](({'In\x20Package':_0x51ac50,..._0x343e7c})=>_0x343e7c);return(0x0,sync_2[_0x58dc0c(0x169)])(_0x4f2fcc,{'header':!![]});}[a363_0x3858a0(0x1aa)](_0x22daaf){const _0x2dd620=a363_0x3858a0;return _0x22daaf[_0x2dd620(0x1db)](_0x1be362=>{const _0x39c0fc=_0x2dd620,_0x35a562=new metadata_item_dto_1[(_0x39c0fc(0x1e0))]();return _0x35a562['name']=_0x1be362['name'],_0x35a562[_0x39c0fc(0x194)]=_0x1be362['name'],_0x35a562[_0x39c0fc(0x1d6)]=this[_0x39c0fc(0x18a)],_0x35a562[_0x39c0fc(0x1dd)]=_0x1be362[_0x39c0fc(0x17e)]+'.'+_0x1be362['name']+veeva_constants_1[_0x39c0fc(0x18e)][_0x39c0fc(0x1b8)],_0x35a562[_0x39c0fc(0x183)]=_0x1be362[_0x39c0fc(0x17e)],_0x35a562[_0x39c0fc(0x1a4)]=_0x1be362[_0x39c0fc(0x1a4)],_0x35a562['isRetrieved']=![],_0x35a562;});}async[a363_0x3858a0(0x172)](_0xaea393){const _0x361d6d=a363_0x3858a0;this[_0x361d6d(0x176)][_0x361d6d(0x1a8)](_0x361d6d(0x1be)),await this[_0x361d6d(0x1bc)](_0xaea393),this[_0x361d6d(0x176)][_0x361d6d(0x1a8)](_0x361d6d(0x17d)+_0xaea393[_0x361d6d(0x1c9)]+'\x20Metadata\x20Items');const _0x56d2d7=_0xaea393['map'](_0x30fd8f=>{const _0x32e48=_0x361d6d;return{[constants_1[_0x32e48(0x1cf)]+_0x32e48(0x180)]:_0x30fd8f[_0x32e48(0x198)],[constants_1[_0x32e48(0x1cf)]+_0x32e48(0x17f)]:_0x30fd8f['apiName'],[constants_1[_0x32e48(0x1cf)]+_0x32e48(0x1c6)]:_0x30fd8f[_0x32e48(0x1d6)],[constants_1['FLOSUM_NAMESPACE']+'Label__c']:_0x30fd8f[_0x32e48(0x1dd)],[constants_1['FLOSUM_NAMESPACE']+'Is_Retrieved__c']:_0x30fd8f['isRetrieved'],[constants_1[_0x32e48(0x1cf)]+_0x32e48(0x186)]:_0x30fd8f['veevaComponentType'],[constants_1[_0x32e48(0x1cf)]+_0x32e48(0x1b7)]:_0x30fd8f[_0x32e48(0x1cb)],[constants_1[_0x32e48(0x1cf)]+_0x32e48(0x196)]:_0x30fd8f[_0x32e48(0x1a4)]};}),_0x2fae2c=await this[_0x361d6d(0x1b4)]['insertMultipleRecords'](constants_1[_0x361d6d(0x1cf)]+_0x361d6d(0x187),_0x56d2d7);let _0x51d079=!![];_0x2fae2c[_0x361d6d(0x184)]((_0xbed6b1,_0x46fa05)=>{const _0x5cc084=_0x361d6d;this[_0x5cc084(0x176)]['log'](_0x5cc084(0x17d)+_0xaea393[_0x46fa05]['veevaComponentType']+'.'+_0xaea393[_0x46fa05][_0x5cc084(0x198)]);if(!_0xbed6b1[_0x5cc084(0x1e3)]){_0x51d079=![];const _0x2bfb12=new salesforce_dml_error_1[(_0x5cc084(0x1cd))](_0xbed6b1['errors']);this[_0x5cc084(0x176)]['logError'](_0x2bfb12);}});if(!_0x51d079)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async[a363_0x3858a0(0x1bc)](_0x13f702){const _0x23a01b=a363_0x3858a0,_0x12bf65=this[_0x23a01b(0x1e5)](_0x13f702),_0x3d6e1e=await this[_0x23a01b(0x1b4)][_0x23a01b(0x1a0)](SnapshotService[_0x23a01b(0x1d4)],_0x12bf65),_0x46299e=[];_0x3d6e1e[_0x23a01b(0x184)]((_0x5d5992,_0x146ec9)=>{const _0x257105=_0x23a01b;_0x5d5992[_0x257105(0x1e3)]?(_0x13f702[_0x146ec9][_0x257105(0x1cb)]=_0x5d5992['id'],_0x13f702[_0x146ec9]['isRetrieved']=!![]):_0x46299e[_0x257105(0x1b2)](..._0x5d5992[_0x257105(0x1b5)]);});if(_0x46299e[_0x23a01b(0x1c9)])throw new salesforce_dml_error_1[(_0x23a01b(0x1cd))](_0x46299e);}[a363_0x3858a0(0x1e5)](_0x212d83){const _0x41c1d0=a363_0x3858a0;return _0x212d83[_0x41c1d0(0x1db)](_0x499b57=>({'ParentId':this[_0x41c1d0(0x18a)],'Name':_0x499b57[_0x41c1d0(0x183)],'ContentType':'application/zip','Body':_0x499b57[_0x41c1d0(0x171)],'Description':_0x499b57[_0x41c1d0(0x183)]}));}async[a363_0x3858a0(0x1de)](_0x43ec99){const _0x5c6840=a363_0x3858a0,_0x221a16={[constants_1[_0x5c6840(0x1cf)]+'Is_Completed__c']:!![],[constants_1[_0x5c6840(0x1cf)]+_0x5c6840(0x177)]:!_0x43ec99},_0x514a09={[constants_1[_0x5c6840(0x1cf)]+_0x5c6840(0x177)]:!_0x43ec99,[constants_1[_0x5c6840(0x1cf)]+'Succeed__c']:_0x43ec99,[constants_1[_0x5c6840(0x1cf)]+_0x5c6840(0x16f)]:_0x43ec99?status_enums_1['MetadataLogStatus'][_0x5c6840(0x1da)]:status_enums_1[_0x5c6840(0x17b)][_0x5c6840(0x1d8)],[constants_1[_0x5c6840(0x1cf)]+_0x5c6840(0x17c)]:!![]};await this[_0x5c6840(0x1d7)][_0x5c6840(0x1b0)](flosum_constants_1[_0x5c6840(0x1b1)][_0x5c6840(0x19e)]+'/'+constants_1[_0x5c6840(0x1cf)]+_0x5c6840(0x193)+this[_0x5c6840(0x18a)],_0x221a16),await this[_0x5c6840(0x1d7)][_0x5c6840(0x1b0)](flosum_constants_1[_0x5c6840(0x1b1)][_0x5c6840(0x19e)]+'/'+constants_1[_0x5c6840(0x1cf)]+_0x5c6840(0x1c4)+this[_0x5c6840(0x181)],_0x514a09),this[_0x5c6840(0x176)]['log'](_0x5c6840(0x1e2)+(_0x43ec99?'successfully':'with\x20error')+'.'),await this['_logger'][_0x5c6840(0x1ad)]();}}exports['SnapshotService']=SnapshotService,SnapshotService[a363_0x3858a0(0x1bf)]='Snapshot',SnapshotService[a363_0x3858a0(0x1d4)]=a363_0x3858a0(0x16e);function a363_0x3e2a(){const _0x1d2e9a=['values','Last_Modified_Date__c','5423712GUhySF','name','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','reduce','PackageExportService','metadataLogId','base64','ENDPOINT_UPSERT_RECORD','timeZone','insertMultipleRecords','TypeAndNameVeevaComponentRetriever','_attachmentLogId','transformDependencyFile','lastModifiedDate','12319570bLWMXk','../classes/errors/salesforce-dml-error','_packageExportService','log','_selectedComponentMap','formMetadataItemDtoList','../enums/status.enums','SnapshotService','updateLog','join','filter','patch','FlosumConstants','push','default','_salesforceService','errors','_timeZone','Attachment_ID__c','MDL_EXTENSION','15139jzxgXX','../constants/flosum.constants','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','saveAttachments','DEPENDENCY_EXTENSION','Saving\x20Attachments.','OUTBOUND_PACKAGE_NAME','_veevaService','37475YOrVMi','generateAsync','6tJaCfM','Metadata_Log__c/','../dtos/metadata-item.dto','Snapshot__c','logError','Cannot\x20retrieve\x20','length','set','attachmentId','csv-stringify/sync','SalesforceDmlError','492rBIWmz','FLOSUM_NAMESPACE','search','../constants/veeva.constants','294972DDDNjg','SalesforceService','ATTACHMENT','__importDefault','snapshotId','_connectionSalesforce','EXCEPTION','3066975rXLRZd','COMPLETED','map','1577776RtZybM','label','finishSnapshot','from','MetadataItemDto','apply','Snapshot\x20completed\x20','success','execute','formAttachments','__esModule','stringify','path','retrieve','_connectionVeeva','../../../constants','Attachment','Status__c','get','body','saveComponentsInSalesforce','files','_systemLogger','_selectedMetaTypes','_logger','Is_Error__c','toString','export','createMetadataItemListWithBody','MetadataLogStatus','Job_Completed__c','Saving\x20','type','API_Name__c','Name__c','_metadataLogId','8qRlXdY','veevaComponentType','forEach','selectedComponentMap','Veeva_Component_Type__c','Metadata_Item__c','(((.+)+)+)+$','string','_snapshotId','../classes/retrievers/veeva-components/type.veeva-component.retriever','async','constructor','VeevaConstants','\x20from\x20outbound\x20package','file','error','parse','Snapshot__c/','apiName'];a363_0x3e2a=function(){return _0x1d2e9a;};return a363_0x3e2a();}