function a406_0x28b6(){const _0x54e9a1=['TypeAndNameVeevaComponentRetriever','5817YXeidM','base64','toString','type','successfully','VeevaConstants','3530rqtcPC','updateLog','retrieveVeevaComponents','label','3036430ASAQas','80232SmthIa','MetadataLogStatus','Attachment_ID__c','6aeifWF','insertMultipleRecords','_logger','Job_Completed__c','\x20Metadata\x20Items','apiName','retrieve','saveComponentsInSalesforce','SnapshotService','with\x20error','../constants/flosum.constants','OUTBOUND_PACKAGE_NAME','export','Is_Completed__c','file','join','114274ijMCdg','COMPLETED','formAttachments','veevaComponentType','string','./veeva.service','_snapshotId','snapshotId','catch','Metadata_Item__c','createMetadataItemListWithBody','MetadataItemDto','sep','FLOSUM_NAMESPACE','files','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','forEach','1045fGTjbp','../classes/errors/salesforce-dml-error','Snapshot\x20completed\x20','PackageExportService','attachmentId','body','Succeed__c','constructor','_selectedMetaTypes','./package-export.service','length','defineProperty','Label__c','error','../classes/retrievers/veeva-components/type.veeva-component.retriever','Attachment','log','2632nsfXAx','_systemLogger','Veeva_Component_Type__c','../enums/status.enums','isRetrieved','_packageExportService','search','Cannot\x20Save\x20Metadata\x20Items','get','Cannot\x20retrieve\x20','119550Ldfkmo','name','DEPENDENCY_EXTENSION','Saving\x20Attachments.','logError','transformDependencyFile','_whereClause','Is_Error__c','_salesforceService','VeevaService','EXCEPTION','Last_Modified_Date__c','FlosumConstants','formMetadataItemDtoList','finishSnapshot','async','stringify','success','errors','../dtos/metadata-item.dto','192892Oqpvlg','_selectedComponentMap','filter','default','../constants/veeva.constants','csv-parse/sync','posix','set','execute','values','Snapshot\x20started.','patch','__esModule','from','_metadataLogId','\x20from\x20outbound\x20package','saveAttachments','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','map','1089WvASrB','ENDPOINT_UPSERT_RECORD','1xoLexl','SalesforceDmlError','Metadata_Log__c/','has','_veevaService','TypeVeevaComponentRetriever','(((.+)+)+)+$','parse','./salesforce.service','_connectionSalesforce','Saving\x20','reduce','push','_connectionVeeva'];a406_0x28b6=function(){return _0x54e9a1;};return a406_0x28b6();}const a406_0x175589=a406_0x2e0e;(function(_0x54cfac,_0x2cbef6){const _0x296d06=a406_0x2e0e,_0x24eeed=_0x54cfac();while(!![]){try{const _0x170313=parseInt(_0x296d06(0x184))/0x1*(parseInt(_0x296d06(0x1b1))/0x2)+parseInt(_0x296d06(0x1a1))/0x3*(-parseInt(_0x296d06(0x16f))/0x4)+-parseInt(_0x296d06(0x19d))/0x5+parseInt(_0x296d06(0x1dd))/0x6+parseInt(_0x296d06(0x193))/0x7*(parseInt(_0x296d06(0x1d3))/0x8)+-parseInt(_0x296d06(0x182))/0x9*(-parseInt(_0x296d06(0x199))/0xa)+-parseInt(_0x296d06(0x1c2))/0xb*(-parseInt(_0x296d06(0x19e))/0xc);if(_0x170313===_0x2cbef6)break;else _0x24eeed['push'](_0x24eeed['shift']());}catch(_0x49999b){_0x24eeed['push'](_0x24eeed['shift']());}}}(a406_0x28b6,0x4f404));const a406_0x3c49ed=(function(){let _0x334b82=!![];return function(_0x2e4b9b,_0x549e51){const _0x597bc9=_0x334b82?function(){if(_0x549e51){const _0xa37bee=_0x549e51['apply'](_0x2e4b9b,arguments);return _0x549e51=null,_0xa37bee;}}:function(){};return _0x334b82=![],_0x597bc9;};}()),a406_0x3a05ca=a406_0x3c49ed(this,function(){const _0x138df9=a406_0x2e0e;return a406_0x3a05ca[_0x138df9(0x195)]()[_0x138df9(0x1d9)](_0x138df9(0x18a))[_0x138df9(0x195)]()[_0x138df9(0x1c9)](a406_0x3a05ca)[_0x138df9(0x1d9)](_0x138df9(0x18a));});a406_0x3a05ca();'use strict';function a406_0x2e0e(_0x43eaed,_0x103ba4){const _0xff9f9=a406_0x28b6();return a406_0x2e0e=function(_0x3a05ca,_0x3c49ed){_0x3a05ca=_0x3a05ca-0x15f;let _0x28b624=_0xff9f9[_0x3a05ca];return _0x28b624;},a406_0x2e0e(_0x43eaed,_0x103ba4);}var __importDefault=this&&this['__importDefault']||function(_0x2df428){const _0x45265f=a406_0x2e0e;return _0x2df428&&_0x2df428[_0x45265f(0x17b)]?_0x2df428:{'default':_0x2df428};};Object[a406_0x175589(0x1cd)](exports,a406_0x175589(0x17b),{'value':!![]}),exports['SnapshotService']=void 0x0;const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require(a406_0x175589(0x1ab)),veeva_service_1=require(a406_0x175589(0x1b6)),metadata_item_dto_1=require(a406_0x175589(0x16e)),constants_1=require('../../../constants'),salesforce_service_1=require(a406_0x175589(0x18c)),status_enums_1=require(a406_0x175589(0x1d6)),salesforce_dml_error_1=require(a406_0x175589(0x1c3)),package_export_service_1=require(a406_0x175589(0x1cb)),type_and_name_veeva_component_retriever_1=require(a406_0x175589(0x1c0)),type_veeva_component_retriever_1=require(a406_0x175589(0x1d0)),sync_1=require(a406_0x175589(0x174)),sync_2=require('csv-stringify/sync'),veeva_constants_1=require(a406_0x175589(0x173)),path_1=__importDefault(require('path'));class SnapshotService{constructor({snapshotId:_0x40fc11,metadataLogId:_0x445c69,selectedMetaTypes:_0x4cf9ed,selectedComponentMap:_0xe32933,whereClause:_0x423a31},_0x2e7288,_0x2b8b71,_0x250b33){const _0x1dea0b=a406_0x175589;this[_0x1dea0b(0x18d)]=_0x2e7288,this[_0x1dea0b(0x191)]=_0x2b8b71,this[_0x1dea0b(0x1a3)]=_0x250b33,this[_0x1dea0b(0x1b7)]=_0x40fc11,this['_metadataLogId']=_0x445c69,this[_0x1dea0b(0x1ca)]=_0x4cf9ed,this[_0x1dea0b(0x170)]=_0xe32933,this[_0x1dea0b(0x161)]=_0x423a31,this[_0x1dea0b(0x188)]=new veeva_service_1[(_0x1dea0b(0x164))]({'connection':this['_connectionVeeva'],'logger':this[_0x1dea0b(0x1a3)]}),this['_salesforceService']=new salesforce_service_1['SalesforceService']({'connection':this[_0x1dea0b(0x18d)]}),this[_0x1dea0b(0x1d8)]=new package_export_service_1[(_0x1dea0b(0x1c5))]({'veevaService':this[_0x1dea0b(0x188)],'connection':this[_0x1dea0b(0x191)],'logger':this[_0x1dea0b(0x1a3)]});}async[a406_0x175589(0x177)](){const _0x5888e8=a406_0x175589;try{this[_0x5888e8(0x1a3)][_0x5888e8(0x1d2)](_0x5888e8(0x179));const _0x385978=await this[_0x5888e8(0x19b)]();await this[_0x5888e8(0x1a3)][_0x5888e8(0x19a)]();const _0x3a4f34=await this[_0x5888e8(0x1d8)][_0x5888e8(0x1ad)](_0x385978,SnapshotService[_0x5888e8(0x1ac)]);await this[_0x5888e8(0x1a3)][_0x5888e8(0x19a)]();const _0x137158=await this[_0x5888e8(0x1bb)](_0x385978,_0x3a4f34);await this[_0x5888e8(0x1a8)](_0x137158),await this[_0x5888e8(0x1a3)][_0x5888e8(0x19a)](),await this[_0x5888e8(0x169)](!![]);}catch(_0x4d7dfd){this[_0x5888e8(0x1a3)]['logError'](_0x4d7dfd),await this['finishSnapshot'](![])[_0x5888e8(0x1b9)](_0x190374=>this[_0x5888e8(0x1d4)][_0x5888e8(0x1cf)](_0x190374));}}async[a406_0x175589(0x19b)](){const _0x9a2f9c=a406_0x175589,_0x5a9ac7={'veevaService':this[_0x9a2f9c(0x188)],'logger':this[_0x9a2f9c(0x1a3)]},_0x129431=Array[_0x9a2f9c(0x17c)](Object[_0x9a2f9c(0x178)](this[_0x9a2f9c(0x170)]))[_0x9a2f9c(0x1cc)]?new type_and_name_veeva_component_retriever_1[(_0x9a2f9c(0x192))]({'value':this[_0x9a2f9c(0x170)],..._0x5a9ac7}):new type_veeva_component_retriever_1[(_0x9a2f9c(0x189))]({'value':this[_0x9a2f9c(0x1ca)],'whereClause':this[_0x9a2f9c(0x161)],..._0x5a9ac7});return _0x129431[_0x9a2f9c(0x1a7)]();}async['createMetadataItemListWithBody'](_0x1a6138,_0x355f98){const _0x3265dd=a406_0x175589;var _0x369bf6,_0x848b88;this[_0x3265dd(0x1a3)][_0x3265dd(0x1d2)](_0x3265dd(0x180));const _0x3d31b3=this['formMetadataItemDtoList'](_0x1a6138),_0x23cefb=_0x3d31b3[_0x3265dd(0x18f)]((_0x5896d7,_0x493e2f)=>_0x5896d7[_0x3265dd(0x176)](_0x493e2f[_0x3265dd(0x19c)],_0x493e2f),new Map());for(const _0x17beb6 of _0x355f98){for(const _0x3c9984 in _0x17beb6[_0x3265dd(0x1bf)]){const {base:_0x119211,name:_0x21cdbe,dir:_0x56c9de}=path_1[_0x3265dd(0x172)][_0x3265dd(0x18b)](_0x3c9984),_0x4333ae=_0x21cdbe+veeva_constants_1['VeevaConstants'][_0x3265dd(0x1df)];if(_0x23cefb[_0x3265dd(0x187)](_0x119211)){const _0x3de6d6=await((_0x369bf6=_0x17beb6[_0x3265dd(0x1af)]([_0x56c9de,_0x119211][_0x3265dd(0x1b0)](path_1[_0x3265dd(0x172)][_0x3265dd(0x175)]['sep'])))===null||_0x369bf6===void 0x0?void 0x0:_0x369bf6['async'](_0x3265dd(0x1b5))),_0x3cc055=await((_0x848b88=_0x17beb6['file']([_0x56c9de,_0x4333ae][_0x3265dd(0x1b0)](path_1[_0x3265dd(0x172)]['posix'][_0x3265dd(0x1bd)])))===null||_0x848b88===void 0x0?void 0x0:_0x848b88[_0x3265dd(0x16a)](_0x3265dd(0x1b5)));if(_0x3de6d6){const _0x20fc95=new jszip_1[(_0x3265dd(0x172))]();_0x20fc95[_0x3265dd(0x1af)](_0x119211,_0x3de6d6),_0x3cc055&&_0x20fc95[_0x3265dd(0x1af)](_0x4333ae,this[_0x3265dd(0x160)](_0x3cc055)),_0x23cefb[_0x3265dd(0x1db)](_0x119211)[_0x3265dd(0x1c7)]=await _0x20fc95['generateAsync']({'type':_0x3265dd(0x194)});}}}}return _0x3d31b3['filter'](_0xea8931=>!_0xea8931[_0x3265dd(0x1c7)])[_0x3265dd(0x1c1)](_0x26ab31=>{const _0x15ea96=_0x3265dd;this[_0x15ea96(0x1a3)][_0x15ea96(0x1d2)](_0x15ea96(0x1dc)+_0x26ab31[_0x15ea96(0x1b4)]+'.'+_0x26ab31[_0x15ea96(0x1de)]+_0x15ea96(0x17e));}),_0x3d31b3[_0x3265dd(0x171)](_0x4e7f07=>_0x4e7f07[_0x3265dd(0x1c7)]);}[a406_0x175589(0x160)](_0x4d38b5){const _0x37ce5a=a406_0x175589,_0x7ed5b3=(0x0,sync_1[_0x37ce5a(0x18b)])(_0x4d38b5,{'columns':!![],'skip_empty_lines':!![]}),_0x190c97=_0x7ed5b3[_0x37ce5a(0x181)](({'In\x20Package':_0x3bdfac,..._0x1bbdbf})=>_0x1bbdbf);return(0x0,sync_2[_0x37ce5a(0x16b)])(_0x190c97,{'header':!![]});}[a406_0x175589(0x168)](_0x268652){const _0x157b3f=a406_0x175589;return _0x268652[_0x157b3f(0x181)](_0xff36bd=>{const _0xf97cdf=_0x157b3f,_0x5e8006=new metadata_item_dto_1[(_0xf97cdf(0x1bc))]();return _0x5e8006[_0xf97cdf(0x1de)]=_0xff36bd['name'],_0x5e8006[_0xf97cdf(0x1a6)]=_0xff36bd[_0xf97cdf(0x1de)],_0x5e8006[_0xf97cdf(0x1b8)]=this['_snapshotId'],_0x5e8006[_0xf97cdf(0x19c)]=_0xff36bd[_0xf97cdf(0x196)]+'.'+_0xff36bd[_0xf97cdf(0x1de)]+veeva_constants_1[_0xf97cdf(0x198)]['MDL_EXTENSION'],_0x5e8006[_0xf97cdf(0x1b4)]=_0xff36bd['type'],_0x5e8006['lastModifiedDate']=_0xff36bd['lastModifiedDate'],_0x5e8006[_0xf97cdf(0x1d7)]=![],_0x5e8006;});}async[a406_0x175589(0x1a8)](_0x36fdcc){const _0x48c5dd=a406_0x175589;this[_0x48c5dd(0x1a3)]['log'](_0x48c5dd(0x1e0)),await this['saveAttachments'](_0x36fdcc),this[_0x48c5dd(0x1a3)][_0x48c5dd(0x1d2)](_0x48c5dd(0x18e)+_0x36fdcc[_0x48c5dd(0x1cc)]+_0x48c5dd(0x1a5));const _0x168025=_0x36fdcc['map'](_0x20a4d6=>{const _0x5e22f1=_0x48c5dd;return{[constants_1['FLOSUM_NAMESPACE']+'Name__c']:_0x20a4d6[_0x5e22f1(0x1de)],[constants_1[_0x5e22f1(0x1be)]+'API_Name__c']:_0x20a4d6[_0x5e22f1(0x1a6)],[constants_1[_0x5e22f1(0x1be)]+'Snapshot__c']:_0x20a4d6[_0x5e22f1(0x1b8)],[constants_1[_0x5e22f1(0x1be)]+_0x5e22f1(0x1ce)]:_0x20a4d6[_0x5e22f1(0x19c)],[constants_1[_0x5e22f1(0x1be)]+'Is_Retrieved__c']:_0x20a4d6['isRetrieved'],[constants_1[_0x5e22f1(0x1be)]+_0x5e22f1(0x1d5)]:_0x20a4d6[_0x5e22f1(0x1b4)],[constants_1[_0x5e22f1(0x1be)]+_0x5e22f1(0x1a0)]:_0x20a4d6['attachmentId'],[constants_1[_0x5e22f1(0x1be)]+_0x5e22f1(0x166)]:_0x20a4d6['lastModifiedDate']};}),_0x6f9d44=await this[_0x48c5dd(0x163)]['insertMultipleRecords'](constants_1[_0x48c5dd(0x1be)]+_0x48c5dd(0x1ba),_0x168025);let _0xa02903=!![];_0x6f9d44[_0x48c5dd(0x1c1)]((_0x553580,_0x3a75a3)=>{const _0x3905c6=_0x48c5dd;this['_logger']['log'](_0x3905c6(0x18e)+_0x36fdcc[_0x3a75a3]['veevaComponentType']+'.'+_0x36fdcc[_0x3a75a3][_0x3905c6(0x1de)]);if(!_0x553580[_0x3905c6(0x16c)]){_0xa02903=![];const _0x44fffe=new salesforce_dml_error_1[(_0x3905c6(0x185))](_0x553580['errors']);this['_logger'][_0x3905c6(0x15f)](_0x44fffe);}});if(!_0xa02903)throw new Error(_0x48c5dd(0x1da));}async[a406_0x175589(0x17f)](_0x1631aa){const _0x3985c7=a406_0x175589,_0x5c1a43=this[_0x3985c7(0x1b3)](_0x1631aa),_0x1b8992=await this[_0x3985c7(0x163)][_0x3985c7(0x1a2)](SnapshotService['ATTACHMENT'],_0x5c1a43),_0x4450b0=[];_0x1b8992[_0x3985c7(0x1c1)]((_0x3764ba,_0x48224e)=>{const _0x4c7579=_0x3985c7;_0x3764ba[_0x4c7579(0x16c)]?(_0x1631aa[_0x48224e][_0x4c7579(0x1c6)]=_0x3764ba['id'],_0x1631aa[_0x48224e][_0x4c7579(0x1d7)]=!![]):_0x4450b0[_0x4c7579(0x190)](..._0x3764ba[_0x4c7579(0x16d)]);});if(_0x4450b0['length'])throw new salesforce_dml_error_1[(_0x3985c7(0x185))](_0x4450b0);}[a406_0x175589(0x1b3)](_0x3fde81){const _0x1a6c00=a406_0x175589;return _0x3fde81[_0x1a6c00(0x181)](_0x2f2a7d=>({'ParentId':this[_0x1a6c00(0x1b7)],'Name':_0x2f2a7d[_0x1a6c00(0x1b4)],'ContentType':'application/zip','Body':_0x2f2a7d[_0x1a6c00(0x1c7)],'Description':_0x2f2a7d['veevaComponentType']}));}async[a406_0x175589(0x169)](_0x42ea5c){const _0x2091d5=a406_0x175589,_0x2d1ba5={[constants_1[_0x2091d5(0x1be)]+_0x2091d5(0x1ae)]:!![],[constants_1[_0x2091d5(0x1be)]+'Is_Error__c']:!_0x42ea5c},_0x551a3f={[constants_1[_0x2091d5(0x1be)]+_0x2091d5(0x162)]:!_0x42ea5c,[constants_1['FLOSUM_NAMESPACE']+_0x2091d5(0x1c8)]:_0x42ea5c,[constants_1[_0x2091d5(0x1be)]+'Status__c']:_0x42ea5c?status_enums_1[_0x2091d5(0x19f)][_0x2091d5(0x1b2)]:status_enums_1[_0x2091d5(0x19f)][_0x2091d5(0x165)],[constants_1[_0x2091d5(0x1be)]+_0x2091d5(0x1a4)]:!![]};await this[_0x2091d5(0x18d)][_0x2091d5(0x17a)](flosum_constants_1[_0x2091d5(0x167)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x2091d5(0x1be)]+'Snapshot__c/'+this[_0x2091d5(0x1b7)],_0x2d1ba5),await this[_0x2091d5(0x18d)][_0x2091d5(0x17a)](flosum_constants_1['FlosumConstants'][_0x2091d5(0x183)]+'/'+constants_1[_0x2091d5(0x1be)]+_0x2091d5(0x186)+this[_0x2091d5(0x17d)],_0x551a3f),this[_0x2091d5(0x1a3)][_0x2091d5(0x1d2)](_0x2091d5(0x1c4)+(_0x42ea5c?_0x2091d5(0x197):_0x2091d5(0x1aa))+'.'),await this[_0x2091d5(0x1a3)][_0x2091d5(0x19a)]();}}exports[a406_0x175589(0x1a9)]=SnapshotService,SnapshotService['OUTBOUND_PACKAGE_NAME']='Snapshot',SnapshotService['ATTACHMENT']=a406_0x175589(0x1d1);