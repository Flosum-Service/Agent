const a355_0x480e34=a355_0x2628;(function(_0x1e2674,_0x2ace7b){const _0x10dd04=a355_0x2628,_0x4a394d=_0x1e2674();while(!![]){try{const _0x293153=-parseInt(_0x10dd04(0x14d))/0x1*(-parseInt(_0x10dd04(0x151))/0x2)+-parseInt(_0x10dd04(0x134))/0x3+parseInt(_0x10dd04(0x105))/0x4+-parseInt(_0x10dd04(0x131))/0x5*(parseInt(_0x10dd04(0x16c))/0x6)+-parseInt(_0x10dd04(0x122))/0x7*(parseInt(_0x10dd04(0x15a))/0x8)+parseInt(_0x10dd04(0x119))/0x9*(parseInt(_0x10dd04(0x169))/0xa)+-parseInt(_0x10dd04(0x140))/0xb;if(_0x293153===_0x2ace7b)break;else _0x4a394d['push'](_0x4a394d['shift']());}catch(_0x4c5817){_0x4a394d['push'](_0x4a394d['shift']());}}}(a355_0x1fe0,0xd2ca5));const a355_0xd2ec6b=(function(){let _0x537ba4=!![];return function(_0x57ec87,_0x3642ed){const _0xfd26ff=_0x537ba4?function(){if(_0x3642ed){const _0x2b9f6c=_0x3642ed['apply'](_0x57ec87,arguments);return _0x3642ed=null,_0x2b9f6c;}}:function(){};return _0x537ba4=![],_0xfd26ff;};}()),a355_0x133759=a355_0xd2ec6b(this,function(){const _0x347c9f=a355_0x2628;return a355_0x133759['toString']()[_0x347c9f(0x112)](_0x347c9f(0x162))['toString']()['constructor'](a355_0x133759)[_0x347c9f(0x112)](_0x347c9f(0x162));});a355_0x133759();'use strict';function a355_0x1fe0(){const _0x2855c9=['errors','_systemLogger','Snapshot\x20completed\x20','search','retrieveVeevaComponents','ENDPOINT_UPSERT_RECORD','retrieve','.mdl','snapshotId','map','9812466BrJEgY','forEach','OUTBOUND_PACKAGE_NAME','veevaComponentType','get','TypeAndNameVeevaComponentRetriever','string','Status__c','Metadata_Log__c/','2234281uhqBhd','FlosumConstants','_packageExportService','_snapshotId','../enums/status.enums','formMetadataItemDtoList','Saving\x20Attachments.','success','_metadataLogId','Snapshot','log','has','patch','MetadataLogStatus','values','35KWZJdX','updateLog','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','1838190jwWoEk','__importDefault','push','_logger','defineProperty','Succeed__c','filter','TypeVeevaComponentRetriever','../constants/flosum.constants','./package-export.service','split','timeZone','1374175rsZaNI','lastModifiedDate','selectedMetaTypes','_timeZone','_connectionSalesforce','jszip','Cannot\x20retrieve\x20','apiName','isRetrieved','_salesforceService','../dtos/metadata-item.dto','_connectionVeeva','Cannot\x20Save\x20Metadata\x20Items','24503YPVPTe','_attachmentLogId','EXCEPTION','SalesforceService','20TzqEUv','finishSnapshot','execute','__esModule','Job_Completed__c','Snapshot__c/','set','ATTACHMENT','successfully','8wgYTBx','../classes/retrievers/veeva-components/type.veeva-component.retriever','name','body','label','Label__c','base64','attachmentLogId','(((.+)+)+)+$','./salesforce.service','Is_Error__c','catch','MetadataItemDto','_selectedComponentMap','Attachment','10abxmvp','Saving\x20','FLOSUM_NAMESPACE','512376FxeopX','logError','Attachment_ID__c','saveAttachments','Snapshot__c','insertMultipleRecords','SalesforceDmlError','_veevaService','./veeva.service','Last_Modified_Date__c','\x20Metadata\x20Items','createMetadataItemListWithBody','formAttachments','async','4730812IDHwDl','Is_Completed__c','generateAsync','VeevaService','Veeva_Component_Type__c','files','error','saveComponentsInSalesforce','length','API_Name__c'];a355_0x1fe0=function(){return _0x2855c9;};return a355_0x1fe0();}var __importDefault=this&&this[a355_0x480e34(0x135)]||function(_0x554ced){const _0x445dea=a355_0x480e34;return _0x554ced&&_0x554ced[_0x445dea(0x154)]?_0x554ced:{'default':_0x554ced};};Object[a355_0x480e34(0x138)](exports,a355_0x480e34(0x154),{'value':!![]}),exports['SnapshotService']=void 0x0;function a355_0x2628(_0x4e56e7,_0x212dd8){const _0x44833=a355_0x1fe0();return a355_0x2628=function(_0x133759,_0xd2ec6b){_0x133759=_0x133759-0xff;let _0x1fe0f6=_0x44833[_0x133759];return _0x1fe0f6;},a355_0x2628(_0x4e56e7,_0x212dd8);}const jszip_1=__importDefault(require(a355_0x480e34(0x145))),flosum_constants_1=require(a355_0x480e34(0x13c)),veeva_service_1=require(a355_0x480e34(0xff)),metadata_item_dto_1=require(a355_0x480e34(0x14a)),constants_1=require('../../../constants'),salesforce_service_1=require(a355_0x480e34(0x163)),status_enums_1=require(a355_0x480e34(0x126)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require(a355_0x480e34(0x13d)),type_and_name_veeva_component_retriever_1=require(a355_0x480e34(0x133)),type_veeva_component_retriever_1=require(a355_0x480e34(0x15b));class SnapshotService{constructor(_0x36e2b8,_0x1f56ae,_0x5623e4,_0x38ad9d){const _0x478bfc=a355_0x480e34;this['_connectionSalesforce']=_0x1f56ae,this['_connectionVeeva']=_0x5623e4,this['_logger']=_0x38ad9d,this['_snapshotId']=_0x36e2b8[_0x478bfc(0x117)],this[_0x478bfc(0x12a)]=_0x36e2b8['metadataLogId'],this[_0x478bfc(0x14e)]=_0x36e2b8[_0x478bfc(0x161)],this[_0x478bfc(0x143)]=_0x36e2b8[_0x478bfc(0x13f)],this['_selectedMetaTypes']=_0x36e2b8[_0x478bfc(0x142)],this[_0x478bfc(0x167)]=_0x36e2b8['selectedComponentMap'],this['_veevaService']=new veeva_service_1[(_0x478bfc(0x108))]({'connection':this[_0x478bfc(0x14b)],'logger':this[_0x478bfc(0x137)]}),this[_0x478bfc(0x149)]=new salesforce_service_1[(_0x478bfc(0x150))]({'connection':this['_connectionSalesforce']}),this[_0x478bfc(0x124)]=new package_export_service_1['PackageExportService']({'veevaService':this[_0x478bfc(0x173)],'connection':this[_0x478bfc(0x14b)],'logger':this['_logger']});}async[a355_0x480e34(0x153)](){const _0x579d7e=a355_0x480e34;try{this['_logger']['log']('Snapshot\x20started.');const _0x1913dc=await this[_0x579d7e(0x113)]();await this[_0x579d7e(0x137)][_0x579d7e(0x132)]();const _0x5cd028=await this['_packageExportService']['export'](_0x1913dc,SnapshotService[_0x579d7e(0x11b)]);await this[_0x579d7e(0x137)][_0x579d7e(0x132)]();const _0xe3d99f=await this['createMetadataItemListWithBody'](_0x1913dc,_0x5cd028);await this[_0x579d7e(0x10c)](_0xe3d99f),await this['_logger'][_0x579d7e(0x132)](),await this[_0x579d7e(0x152)](!![]);}catch(_0x3dd73d){this[_0x579d7e(0x137)][_0x579d7e(0x16d)](_0x3dd73d),await this[_0x579d7e(0x152)](![])[_0x579d7e(0x165)](_0x20e5a1=>this[_0x579d7e(0x110)][_0x579d7e(0x10b)](_0x20e5a1));}}async['retrieveVeevaComponents'](){const _0x17dfa0=a355_0x480e34,_0x18582d={'veevaService':this['_veevaService'],'logger':this[_0x17dfa0(0x137)]},_0x4bf389=Array['from'](Object[_0x17dfa0(0x130)](this['_selectedComponentMap']))[_0x17dfa0(0x10d)]?new type_and_name_veeva_component_retriever_1[(_0x17dfa0(0x11e))]({'value':this[_0x17dfa0(0x167)],..._0x18582d}):new type_veeva_component_retriever_1[(_0x17dfa0(0x13b))]({'value':this['_selectedMetaTypes'],..._0x18582d});return _0x4bf389[_0x17dfa0(0x115)]();}async[a355_0x480e34(0x102)](_0x1d73cf,_0x2b1f36){const _0x1b0619=a355_0x480e34;var _0x541df2;this[_0x1b0619(0x137)][_0x1b0619(0x12c)]('Unpack\x20zip\x20and\x20create\x20metadata\x20items.');const _0x3006d8=this['formMetadataItemDtoList'](_0x1d73cf),_0x3ea945=_0x3006d8['reduce']((_0x3533a4,_0x585dd4)=>_0x3533a4[_0x1b0619(0x157)](_0x585dd4['label'],_0x585dd4),new Map());for(const _0x31c8d7 of _0x2b1f36){for(const _0x270487 in _0x31c8d7[_0x1b0619(0x10a)]){const _0x216939=_0x270487[_0x1b0619(0x13e)]('/')['at'](-0x1);if(_0x3ea945[_0x1b0619(0x12d)](_0x216939)){const _0xfd19b4=await((_0x541df2=_0x31c8d7['file'](_0x270487))===null||_0x541df2===void 0x0?void 0x0:_0x541df2[_0x1b0619(0x104)](_0x1b0619(0x11f)));if(_0xfd19b4){const _0x18f8ba=new jszip_1['default']();_0x18f8ba['file'](_0x216939,_0xfd19b4),_0x3ea945[_0x1b0619(0x11d)](_0x216939)[_0x1b0619(0x15d)]=await _0x18f8ba[_0x1b0619(0x107)]({'type':_0x1b0619(0x160)});}}}}return _0x3006d8[_0x1b0619(0x13a)](_0x255a29=>!_0x255a29['body'])[_0x1b0619(0x11a)](_0x4d7ea5=>{const _0x559881=_0x1b0619;this[_0x559881(0x137)][_0x559881(0x12c)](_0x559881(0x146)+_0x4d7ea5[_0x559881(0x11c)]+'.'+_0x4d7ea5['name']+'\x20from\x20outbound\x20package');}),_0x3006d8[_0x1b0619(0x13a)](_0x1d8891=>_0x1d8891[_0x1b0619(0x15d)]);}[a355_0x480e34(0x127)](_0x1c21b4){const _0x144481=a355_0x480e34;return _0x1c21b4[_0x144481(0x118)](_0x4d2d09=>{const _0x5dd807=_0x144481,_0x761b4e=new metadata_item_dto_1[(_0x5dd807(0x166))]();return _0x761b4e['name']=_0x4d2d09['name'],_0x761b4e['apiName']=_0x4d2d09[_0x5dd807(0x15c)],_0x761b4e[_0x5dd807(0x117)]=this['_snapshotId'],_0x761b4e[_0x5dd807(0x15e)]=_0x4d2d09['type']+'.'+_0x4d2d09[_0x5dd807(0x15c)]+_0x5dd807(0x116),_0x761b4e['veevaComponentType']=_0x4d2d09['type'],_0x761b4e[_0x5dd807(0x141)]=_0x4d2d09['lastModifiedDate'],_0x761b4e[_0x5dd807(0x148)]=![],_0x761b4e;});}async['saveComponentsInSalesforce'](_0x52195f){const _0xd1bcf3=a355_0x480e34;this['_logger'][_0xd1bcf3(0x12c)](_0xd1bcf3(0x128)),await this[_0xd1bcf3(0x16f)](_0x52195f),this[_0xd1bcf3(0x137)]['log'](_0xd1bcf3(0x16a)+_0x52195f[_0xd1bcf3(0x10d)]+_0xd1bcf3(0x101));const _0x1859f0=_0x52195f[_0xd1bcf3(0x118)](_0x5d5e03=>{const _0x531818=_0xd1bcf3;return{[constants_1[_0x531818(0x16b)]+'Name__c']:_0x5d5e03[_0x531818(0x15c)],[constants_1[_0x531818(0x16b)]+_0x531818(0x10e)]:_0x5d5e03[_0x531818(0x147)],[constants_1[_0x531818(0x16b)]+_0x531818(0x170)]:_0x5d5e03[_0x531818(0x117)],[constants_1[_0x531818(0x16b)]+_0x531818(0x15f)]:_0x5d5e03['label'],[constants_1[_0x531818(0x16b)]+'Is_Retrieved__c']:_0x5d5e03[_0x531818(0x148)],[constants_1['FLOSUM_NAMESPACE']+_0x531818(0x109)]:_0x5d5e03[_0x531818(0x11c)],[constants_1[_0x531818(0x16b)]+_0x531818(0x16e)]:_0x5d5e03['attachmentId'],[constants_1[_0x531818(0x16b)]+_0x531818(0x100)]:_0x5d5e03[_0x531818(0x141)]};}),_0x24a073=await this['_salesforceService'][_0xd1bcf3(0x171)](constants_1[_0xd1bcf3(0x16b)]+'Metadata_Item__c',_0x1859f0);let _0x204581=!![];_0x24a073[_0xd1bcf3(0x11a)]((_0x3b86d2,_0x59d927)=>{const _0x1f725c=_0xd1bcf3;this[_0x1f725c(0x137)][_0x1f725c(0x12c)](_0x1f725c(0x16a)+_0x52195f[_0x59d927][_0x1f725c(0x11c)]+'.'+_0x52195f[_0x59d927][_0x1f725c(0x15c)]);if(!_0x3b86d2[_0x1f725c(0x129)]){_0x204581=![];const _0x2419b1=new salesforce_dml_error_1[(_0x1f725c(0x172))](_0x3b86d2[_0x1f725c(0x10f)]);this[_0x1f725c(0x137)]['logError'](_0x2419b1);}});if(!_0x204581)throw new Error(_0xd1bcf3(0x14c));}async[a355_0x480e34(0x16f)](_0x2f90f5){const _0x18f8be=a355_0x480e34,_0x21c94f=this[_0x18f8be(0x103)](_0x2f90f5),_0x6578b9=await this[_0x18f8be(0x149)][_0x18f8be(0x171)](SnapshotService['ATTACHMENT'],_0x21c94f),_0x33fefe=[];_0x6578b9['forEach']((_0x8c3c84,_0x59069e)=>{const _0x184739=_0x18f8be;_0x8c3c84['success']?(_0x2f90f5[_0x59069e]['attachmentId']=_0x8c3c84['id'],_0x2f90f5[_0x59069e][_0x184739(0x148)]=!![]):_0x33fefe[_0x184739(0x136)](..._0x8c3c84[_0x184739(0x10f)]);});if(_0x33fefe['length'])throw new salesforce_dml_error_1[(_0x18f8be(0x172))](_0x33fefe);}['formAttachments'](_0xdfdb26){const _0x1b27c0=a355_0x480e34;return _0xdfdb26['map'](_0x9b54ca=>({'ParentId':this[_0x1b27c0(0x125)],'Name':_0x9b54ca[_0x1b27c0(0x11c)],'ContentType':'application/zip','Body':_0x9b54ca[_0x1b27c0(0x15d)],'Description':_0x9b54ca[_0x1b27c0(0x11c)]}));}async[a355_0x480e34(0x152)](_0x3d076e){const _0x101b65=a355_0x480e34,_0x170a37={[constants_1['FLOSUM_NAMESPACE']+_0x101b65(0x106)]:!![],[constants_1[_0x101b65(0x16b)]+'Is_Error__c']:!_0x3d076e},_0xbbf34={[constants_1[_0x101b65(0x16b)]+_0x101b65(0x164)]:!_0x3d076e,[constants_1[_0x101b65(0x16b)]+_0x101b65(0x139)]:_0x3d076e,[constants_1[_0x101b65(0x16b)]+_0x101b65(0x120)]:_0x3d076e?status_enums_1['MetadataLogStatus']['COMPLETED']:status_enums_1[_0x101b65(0x12f)][_0x101b65(0x14f)],[constants_1[_0x101b65(0x16b)]+_0x101b65(0x155)]:!![]};await this[_0x101b65(0x144)][_0x101b65(0x12e)](flosum_constants_1[_0x101b65(0x123)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x101b65(0x16b)]+_0x101b65(0x156)+this[_0x101b65(0x125)],_0x170a37),await this[_0x101b65(0x144)][_0x101b65(0x12e)](flosum_constants_1[_0x101b65(0x123)][_0x101b65(0x114)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x101b65(0x121)+this['_metadataLogId'],_0xbbf34),this['_logger'][_0x101b65(0x12c)](_0x101b65(0x111)+(_0x3d076e?_0x101b65(0x159):'with\x20error')+'.'),await this[_0x101b65(0x137)][_0x101b65(0x132)]();}}exports['SnapshotService']=SnapshotService,SnapshotService['OUTBOUND_PACKAGE_NAME']=a355_0x480e34(0x12b),SnapshotService[a355_0x480e34(0x158)]=a355_0x480e34(0x168);