const a395_0x43d0cf=a395_0x1383;function a395_0x1383(_0x1d8c74,_0x46a83b){const _0x2681d0=a395_0x2a91();return a395_0x1383=function(_0x5dbb86,_0xb6610a){_0x5dbb86=_0x5dbb86-0x112;let _0x2a91cf=_0x2681d0[_0x5dbb86];return _0x2a91cf;},a395_0x1383(_0x1d8c74,_0x46a83b);}(function(_0xa29a92,_0x3f821a){const _0x5d8932=a395_0x1383,_0x4fbda7=_0xa29a92();while(!![]){try{const _0x5ab9ab=parseInt(_0x5d8932(0x15c))/0x1*(-parseInt(_0x5d8932(0x14f))/0x2)+-parseInt(_0x5d8932(0x118))/0x3+-parseInt(_0x5d8932(0x15d))/0x4*(-parseInt(_0x5d8932(0x181))/0x5)+-parseInt(_0x5d8932(0x189))/0x6*(-parseInt(_0x5d8932(0x14c))/0x7)+parseInt(_0x5d8932(0x158))/0x8+-parseInt(_0x5d8932(0x13c))/0x9*(-parseInt(_0x5d8932(0x193))/0xa)+-parseInt(_0x5d8932(0x140))/0xb;if(_0x5ab9ab===_0x3f821a)break;else _0x4fbda7['push'](_0x4fbda7['shift']());}catch(_0x4700dc){_0x4fbda7['push'](_0x4fbda7['shift']());}}}(a395_0x2a91,0xb9dca));const a395_0xb6610a=(function(){let _0x24a7bd=!![];return function(_0x1d3726,_0x18cea5){const _0x39f067=_0x24a7bd?function(){const _0x4ff65=a395_0x1383;if(_0x18cea5){const _0x93ed40=_0x18cea5[_0x4ff65(0x131)](_0x1d3726,arguments);return _0x18cea5=null,_0x93ed40;}}:function(){};return _0x24a7bd=![],_0x39f067;};}()),a395_0x5dbb86=a395_0xb6610a(this,function(){const _0x288bcd=a395_0x1383;return a395_0x5dbb86[_0x288bcd(0x16e)]()[_0x288bcd(0x12b)]('(((.+)+)+)+$')[_0x288bcd(0x16e)]()[_0x288bcd(0x14e)](a395_0x5dbb86)['search'](_0x288bcd(0x15e));});a395_0x5dbb86();function a395_0x2a91(){const _0x4ac33b=['Metadata_Item__c','1346450YHxUzP','Snapshot__c','transformDependencyFile','_whereClause','PackageExportService','finishSnapshot','Attachment','Job_Completed__c','18uiwrHI','SnapshotService','Snapshot\x20completed\x20','body','reduce','csv-parse/sync','updateLog','FLOSUM_NAMESPACE','join','map','270iiAQnL','files','_selectedComponentMap','_systemLogger','has','_metadataLogId','createMetadataItemListWithBody','982302nqugdb','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','successfully','__importDefault','ATTACHMENT','apiName','filter','insertMultipleRecords','catch','isRetrieved','snapshotId','defineProperty','MetadataItemDto','lastModifiedDate','./veeva.service','Snapshot__c/','success','file','errors','search','TypeAndNameVeevaComponentRetriever','parse','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','Snapshot','TypeVeevaComponentRetriever','apply','Is_Completed__c','name','sep','execute','application/zip','attachmentId','Metadata_Log__c/','\x20Metadata\x20Items','label','Is_Retrieved__c','165339TSLSGS','Veeva_Component_Type__c','set','./salesforce.service','5956423uiBxTP','VeevaService','Label__c','VeevaConstants','Cannot\x20retrieve\x20','Attachment_ID__c','Is_Error__c','API_Name__c','_connectionSalesforce','default','values','EXCEPTION','453299XzjkQG','formAttachments','constructor','6924VxcPeJ','OUTBOUND_PACKAGE_NAME','csv-stringify/sync','get','_veevaService','base64','string','generateAsync','forEach','7121896WCzZGl','_snapshotId','Saving\x20','length','219zMScTt','12lAWuXV','(((.+)+)+)+$','SalesforceDmlError','./package-export.service','Snapshot\x20started.','ENDPOINT_UPSERT_RECORD','retrieveVeevaComponents','_logger','posix','path','../constants/veeva.constants','error','../enums/status.enums','__esModule','log','../../../constants','Saving\x20Attachments.','toString','formMetadataItemDtoList','../constants/flosum.constants','veevaComponentType','Cannot\x20Save\x20Metadata\x20Items','saveAttachments','../classes/retrievers/veeva-components/type.veeva-component.retriever','async','_salesforceService','../dtos/metadata-item.dto','saveComponentsInSalesforce','_connectionVeeva','logError','../classes/errors/salesforce-dml-error','patch','_packageExportService','from','FlosumConstants'];a395_0x2a91=function(){return _0x4ac33b;};return a395_0x2a91();}'use strict';var __importDefault=this&&this[a395_0x43d0cf(0x11b)]||function(_0x217702){const _0x1282fc=a395_0x43d0cf;return _0x217702&&_0x217702[_0x1282fc(0x16a)]?_0x217702:{'default':_0x217702};};Object[a395_0x43d0cf(0x123)](exports,'__esModule',{'value':!![]}),exports['SnapshotService']=void 0x0;const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require(a395_0x43d0cf(0x170)),veeva_service_1=require(a395_0x43d0cf(0x126)),metadata_item_dto_1=require(a395_0x43d0cf(0x177)),constants_1=require(a395_0x43d0cf(0x16c)),salesforce_service_1=require(a395_0x43d0cf(0x13f)),status_enums_1=require(a395_0x43d0cf(0x169)),salesforce_dml_error_1=require(a395_0x43d0cf(0x17b)),package_export_service_1=require(a395_0x43d0cf(0x160)),type_and_name_veeva_component_retriever_1=require(a395_0x43d0cf(0x119)),type_veeva_component_retriever_1=require(a395_0x43d0cf(0x174)),sync_1=require(a395_0x43d0cf(0x18e)),sync_2=require(a395_0x43d0cf(0x151)),veeva_constants_1=require(a395_0x43d0cf(0x167)),path_1=__importDefault(require(a395_0x43d0cf(0x166)));class SnapshotService{constructor({snapshotId:_0x4d588c,metadataLogId:_0x47653c,selectedMetaTypes:_0x21f8ea,selectedComponentMap:_0xc5240,whereClause:_0x3fb715},_0x23918a,_0xa486e7,_0x104de5){const _0x129113=a395_0x43d0cf;this['_connectionSalesforce']=_0x23918a,this[_0x129113(0x179)]=_0xa486e7,this[_0x129113(0x164)]=_0x104de5,this['_snapshotId']=_0x4d588c,this[_0x129113(0x116)]=_0x47653c,this['_selectedMetaTypes']=_0x21f8ea,this[_0x129113(0x113)]=_0xc5240,this[_0x129113(0x184)]=_0x3fb715,this['_veevaService']=new veeva_service_1[(_0x129113(0x141))]({'connection':this[_0x129113(0x179)],'logger':this[_0x129113(0x164)]}),this[_0x129113(0x176)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x129113(0x148)]}),this[_0x129113(0x17d)]=new package_export_service_1[(_0x129113(0x185))]({'veevaService':this[_0x129113(0x153)],'connection':this[_0x129113(0x179)],'logger':this[_0x129113(0x164)]});}async[a395_0x43d0cf(0x135)](){const _0x1c6629=a395_0x43d0cf;try{this[_0x1c6629(0x164)][_0x1c6629(0x16b)](_0x1c6629(0x161));const _0x429707=await this[_0x1c6629(0x163)]();await this['_logger'][_0x1c6629(0x18f)]();const _0x81a63f=await this[_0x1c6629(0x17d)]['export'](_0x429707,SnapshotService[_0x1c6629(0x150)]);await this[_0x1c6629(0x164)]['updateLog']();const _0x2c5565=await this[_0x1c6629(0x117)](_0x429707,_0x81a63f);await this[_0x1c6629(0x178)](_0x2c5565),await this[_0x1c6629(0x164)][_0x1c6629(0x18f)](),await this[_0x1c6629(0x186)](!![]);}catch(_0x33c6b4){this[_0x1c6629(0x164)][_0x1c6629(0x17a)](_0x33c6b4),await this[_0x1c6629(0x186)](![])[_0x1c6629(0x120)](_0x2998d1=>this[_0x1c6629(0x114)][_0x1c6629(0x168)](_0x2998d1));}}async[a395_0x43d0cf(0x163)](){const _0x2b1408=a395_0x43d0cf,_0x218e44={'veevaService':this['_veevaService'],'logger':this[_0x2b1408(0x164)]},_0x52e30f=Array[_0x2b1408(0x17e)](Object[_0x2b1408(0x14a)](this['_selectedComponentMap']))[_0x2b1408(0x15b)]?new type_and_name_veeva_component_retriever_1[(_0x2b1408(0x12c))]({'value':this[_0x2b1408(0x113)],..._0x218e44}):new type_veeva_component_retriever_1[(_0x2b1408(0x130))]({'value':this['_selectedMetaTypes'],'whereClause':this[_0x2b1408(0x184)],..._0x218e44});return _0x52e30f['retrieve']();}async[a395_0x43d0cf(0x117)](_0x44471c,_0x215f3c){const _0x35ddda=a395_0x43d0cf;var _0x4602a9,_0x912b6d;this[_0x35ddda(0x164)][_0x35ddda(0x16b)](_0x35ddda(0x12e));const _0x17daa3=this[_0x35ddda(0x16f)](_0x44471c),_0x3ff253=_0x17daa3[_0x35ddda(0x18d)]((_0x42f7dc,_0x227078)=>_0x42f7dc[_0x35ddda(0x13e)](_0x227078[_0x35ddda(0x13a)],_0x227078),new Map());for(const _0x52d226 of _0x215f3c){for(const _0x36f6ba in _0x52d226[_0x35ddda(0x112)]){const {base:_0x488847,name:_0x4cedae,dir:_0x24be0c}=path_1[_0x35ddda(0x149)][_0x35ddda(0x12d)](_0x36f6ba),_0x653806=_0x4cedae+veeva_constants_1['VeevaConstants']['DEPENDENCY_EXTENSION'];if(_0x3ff253[_0x35ddda(0x115)](_0x488847)){const _0x295ce7=await((_0x4602a9=_0x52d226[_0x35ddda(0x129)]([_0x24be0c,_0x488847][_0x35ddda(0x191)](path_1[_0x35ddda(0x149)][_0x35ddda(0x165)]['sep'])))===null||_0x4602a9===void 0x0?void 0x0:_0x4602a9['async'](_0x35ddda(0x155))),_0x2eb160=await((_0x912b6d=_0x52d226[_0x35ddda(0x129)]([_0x24be0c,_0x653806][_0x35ddda(0x191)](path_1[_0x35ddda(0x149)][_0x35ddda(0x165)][_0x35ddda(0x134)])))===null||_0x912b6d===void 0x0?void 0x0:_0x912b6d[_0x35ddda(0x175)](_0x35ddda(0x155)));if(_0x295ce7){const _0x15b169=new jszip_1[(_0x35ddda(0x149))]();_0x15b169[_0x35ddda(0x129)](_0x488847,_0x295ce7),_0x2eb160&&_0x15b169['file'](_0x653806,this['transformDependencyFile'](_0x2eb160)),_0x3ff253[_0x35ddda(0x152)](_0x488847)['body']=await _0x15b169[_0x35ddda(0x156)]({'type':_0x35ddda(0x154)});}}}}return _0x17daa3['filter'](_0xdd5e5d=>!_0xdd5e5d[_0x35ddda(0x18c)])[_0x35ddda(0x157)](_0x40e71e=>{const _0x8199f3=_0x35ddda;this[_0x8199f3(0x164)][_0x8199f3(0x16b)](_0x8199f3(0x144)+_0x40e71e['veevaComponentType']+'.'+_0x40e71e[_0x8199f3(0x133)]+'\x20from\x20outbound\x20package');}),_0x17daa3[_0x35ddda(0x11e)](_0x57fda4=>_0x57fda4['body']);}[a395_0x43d0cf(0x183)](_0x10ecc5){const _0x379888=a395_0x43d0cf,_0x53a82f=(0x0,sync_1[_0x379888(0x12d)])(_0x10ecc5,{'columns':!![],'skip_empty_lines':!![]}),_0x2946d1=_0x53a82f[_0x379888(0x192)](({'In\x20Package':_0x57efd5,..._0x5e8501})=>_0x5e8501);return(0x0,sync_2['stringify'])(_0x2946d1,{'header':!![]});}[a395_0x43d0cf(0x16f)](_0x3efe1f){const _0x5e5a70=a395_0x43d0cf;return _0x3efe1f[_0x5e5a70(0x192)](_0x518b2c=>{const _0x38e9f6=_0x5e5a70,_0x578188=new metadata_item_dto_1[(_0x38e9f6(0x124))]();return _0x578188['name']=_0x518b2c[_0x38e9f6(0x133)],_0x578188[_0x38e9f6(0x11d)]=_0x518b2c[_0x38e9f6(0x133)],_0x578188[_0x38e9f6(0x122)]=this['_snapshotId'],_0x578188['label']=_0x518b2c['type']+'.'+_0x518b2c[_0x38e9f6(0x133)]+veeva_constants_1[_0x38e9f6(0x143)]['MDL_EXTENSION'],_0x578188[_0x38e9f6(0x171)]=_0x518b2c['type'],_0x578188['lastModifiedDate']=_0x518b2c[_0x38e9f6(0x125)],_0x578188[_0x38e9f6(0x121)]=![],_0x578188;});}async[a395_0x43d0cf(0x178)](_0x35fd88){const _0x45692b=a395_0x43d0cf;this['_logger']['log'](_0x45692b(0x16d)),await this['saveAttachments'](_0x35fd88),this['_logger'][_0x45692b(0x16b)](_0x45692b(0x15a)+_0x35fd88['length']+_0x45692b(0x139));const _0x6d1433=_0x35fd88[_0x45692b(0x192)](_0x4a2e40=>{const _0x1a3eb6=_0x45692b;return{[constants_1[_0x1a3eb6(0x190)]+'Name__c']:_0x4a2e40[_0x1a3eb6(0x133)],[constants_1[_0x1a3eb6(0x190)]+_0x1a3eb6(0x147)]:_0x4a2e40[_0x1a3eb6(0x11d)],[constants_1['FLOSUM_NAMESPACE']+_0x1a3eb6(0x182)]:_0x4a2e40[_0x1a3eb6(0x122)],[constants_1[_0x1a3eb6(0x190)]+_0x1a3eb6(0x142)]:_0x4a2e40[_0x1a3eb6(0x13a)],[constants_1[_0x1a3eb6(0x190)]+_0x1a3eb6(0x13b)]:_0x4a2e40[_0x1a3eb6(0x121)],[constants_1[_0x1a3eb6(0x190)]+_0x1a3eb6(0x13d)]:_0x4a2e40[_0x1a3eb6(0x171)],[constants_1['FLOSUM_NAMESPACE']+_0x1a3eb6(0x145)]:_0x4a2e40[_0x1a3eb6(0x137)],[constants_1[_0x1a3eb6(0x190)]+'Last_Modified_Date__c']:_0x4a2e40['lastModifiedDate']};}),_0x12ee3e=await this['_salesforceService'][_0x45692b(0x11f)](constants_1[_0x45692b(0x190)]+_0x45692b(0x180),_0x6d1433);let _0x414018=!![];_0x12ee3e['forEach']((_0x44636a,_0x1ec87e)=>{const _0x313708=_0x45692b;this['_logger']['log'](_0x313708(0x15a)+_0x35fd88[_0x1ec87e][_0x313708(0x171)]+'.'+_0x35fd88[_0x1ec87e][_0x313708(0x133)]);if(!_0x44636a[_0x313708(0x128)]){_0x414018=![];const _0xaae48b=new salesforce_dml_error_1[(_0x313708(0x15f))](_0x44636a['errors']);this['_logger'][_0x313708(0x17a)](_0xaae48b);}});if(!_0x414018)throw new Error(_0x45692b(0x172));}async[a395_0x43d0cf(0x173)](_0x5d8748){const _0x50480d=a395_0x43d0cf,_0x1dc4ad=this['formAttachments'](_0x5d8748),_0x4766ea=await this['_salesforceService'][_0x50480d(0x11f)](SnapshotService[_0x50480d(0x11c)],_0x1dc4ad),_0x3fd5c0=[];_0x4766ea['forEach']((_0x2070a0,_0x3bf31f)=>{const _0x27ddfc=_0x50480d;_0x2070a0[_0x27ddfc(0x128)]?(_0x5d8748[_0x3bf31f][_0x27ddfc(0x137)]=_0x2070a0['id'],_0x5d8748[_0x3bf31f][_0x27ddfc(0x121)]=!![]):_0x3fd5c0['push'](..._0x2070a0[_0x27ddfc(0x12a)]);});if(_0x3fd5c0['length'])throw new salesforce_dml_error_1['SalesforceDmlError'](_0x3fd5c0);}[a395_0x43d0cf(0x14d)](_0x502cb8){const _0x5f3276=a395_0x43d0cf;return _0x502cb8[_0x5f3276(0x192)](_0x267b5a=>({'ParentId':this[_0x5f3276(0x159)],'Name':_0x267b5a[_0x5f3276(0x171)],'ContentType':_0x5f3276(0x136),'Body':_0x267b5a[_0x5f3276(0x18c)],'Description':_0x267b5a[_0x5f3276(0x171)]}));}async[a395_0x43d0cf(0x186)](_0x25c663){const _0x3e7451=a395_0x43d0cf,_0x4349ce={[constants_1['FLOSUM_NAMESPACE']+_0x3e7451(0x132)]:!![],[constants_1[_0x3e7451(0x190)]+_0x3e7451(0x146)]:!_0x25c663},_0x1958d7={[constants_1[_0x3e7451(0x190)]+'Is_Error__c']:!_0x25c663,[constants_1[_0x3e7451(0x190)]+'Succeed__c']:_0x25c663,[constants_1[_0x3e7451(0x190)]+'Status__c']:_0x25c663?status_enums_1['MetadataLogStatus']['COMPLETED']:status_enums_1['MetadataLogStatus'][_0x3e7451(0x14b)],[constants_1['FLOSUM_NAMESPACE']+_0x3e7451(0x188)]:!![]};await this[_0x3e7451(0x148)]['patch'](flosum_constants_1[_0x3e7451(0x17f)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x3e7451(0x190)]+_0x3e7451(0x127)+this[_0x3e7451(0x159)],_0x4349ce),await this[_0x3e7451(0x148)][_0x3e7451(0x17c)](flosum_constants_1[_0x3e7451(0x17f)][_0x3e7451(0x162)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x3e7451(0x138)+this[_0x3e7451(0x116)],_0x1958d7),this[_0x3e7451(0x164)][_0x3e7451(0x16b)](_0x3e7451(0x18b)+(_0x25c663?_0x3e7451(0x11a):'with\x20error')+'.'),await this[_0x3e7451(0x164)][_0x3e7451(0x18f)]();}}exports[a395_0x43d0cf(0x18a)]=SnapshotService,SnapshotService[a395_0x43d0cf(0x150)]=a395_0x43d0cf(0x12f),SnapshotService['ATTACHMENT']=a395_0x43d0cf(0x187);