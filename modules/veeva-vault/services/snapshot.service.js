const a362_0x51757a=a362_0x1a92;(function(_0x41cbca,_0x15e00e){const _0x3e1705=a362_0x1a92,_0xfcb164=_0x41cbca();while(!![]){try{const _0x148964=-parseInt(_0x3e1705(0x258))/0x1*(parseInt(_0x3e1705(0x230))/0x2)+-parseInt(_0x3e1705(0x20c))/0x3+-parseInt(_0x3e1705(0x23d))/0x4*(-parseInt(_0x3e1705(0x24b))/0x5)+parseInt(_0x3e1705(0x259))/0x6+parseInt(_0x3e1705(0x1f8))/0x7*(-parseInt(_0x3e1705(0x254))/0x8)+-parseInt(_0x3e1705(0x1e6))/0x9+parseInt(_0x3e1705(0x24f))/0xa*(parseInt(_0x3e1705(0x23f))/0xb);if(_0x148964===_0x15e00e)break;else _0xfcb164['push'](_0xfcb164['shift']());}catch(_0x1a753b){_0xfcb164['push'](_0xfcb164['shift']());}}}(a362_0x5552,0x385a0));const a362_0x5d32c7=(function(){let _0x4db3bd=!![];return function(_0x3901c9,_0x1967a8){const _0x241951=_0x4db3bd?function(){if(_0x1967a8){const _0x274bd4=_0x1967a8['apply'](_0x3901c9,arguments);return _0x1967a8=null,_0x274bd4;}}:function(){};return _0x4db3bd=![],_0x241951;};}()),a362_0x3bbd63=a362_0x5d32c7(this,function(){const _0x5f3872=a362_0x1a92;return a362_0x3bbd63[_0x5f3872(0x23c)]()[_0x5f3872(0x229)](_0x5f3872(0x231))[_0x5f3872(0x23c)]()[_0x5f3872(0x1f0)](a362_0x3bbd63)[_0x5f3872(0x229)](_0x5f3872(0x231));});function a362_0x1a92(_0x4affdf,_0x2d7d5f){const _0x174f7a=a362_0x5552();return a362_0x1a92=function(_0x3bbd63,_0x5d32c7){_0x3bbd63=_0x3bbd63-0x1d6;let _0x5552bb=_0x174f7a[_0x3bbd63];return _0x5552bb;},a362_0x1a92(_0x4affdf,_0x2d7d5f);}a362_0x3bbd63();function a362_0x5552(){const _0x4684d4=['metadataLogId','transformDependencyFile','join','_connectionVeeva','./veeva.service','VeevaConstants','with\x20error','toString','438148mzgayz','FlosumConstants','81290eJwdvr','Attachment','../classes/retrievers/veeva-components/type.veeva-component.retriever','VeevaService','_systemLogger','../../../constants','length','_veevaService','SnapshotService','Attachment_ID__c','../constants/flosum.constants','Snapshot__c/','20tskepL','reduce','../constants/veeva.constants','path','1150RUeovw','insertMultipleRecords','_selectedComponentMap','_snapshotId','timeZone','120gEjidL','success','../enums/status.enums','Job_Completed__c','1qhDHnF','1492422kTCbAL','generateAsync','OUTBOUND_PACKAGE_NAME','name','__esModule','_salesforceService','lastModifiedDate','label','Is_Retrieved__c','file','get','TypeAndNameVeevaComponentRetriever','_logger','values','error','finishSnapshot','selectedComponentMap','ATTACHMENT','Saving\x20','Status__c','2449746zPdWsY','Last_Modified_Date__c','catch','logError','\x20Metadata\x20Items','csv-parse/sync','_packageExportService','patch','TypeVeevaComponentRetriever','selectedMetaTypes','constructor','veevaComponentType','Snapshot__c','log','from','map','async','type','159999XcaJdk','Is_Error__c','../classes/errors/salesforce-dml-error','_selectedMetaTypes','base64','retrieveVeevaComponents','attachmentId','Is_Completed__c','MetadataItemDto','EXCEPTION','Veeva_Component_Type__c','execute','PackageExportService','\x20from\x20outbound\x20package','Name__c','set','csv-stringify/sync','parse','MDL_EXTENSION','retrieve','712953gMvmQe','_metadataLogId','errors','updateLog','_attachmentLogId','Metadata_Item__c','Snapshot\x20completed\x20','forEach','Snapshot','_timeZone','Saving\x20Attachments.','saveComponentsInSalesforce','formMetadataItemDtoList','saveAttachments','defineProperty','Snapshot\x20started.','default','FLOSUM_NAMESPACE','formAttachments','MetadataLogStatus','Label__c','../dtos/metadata-item.dto','./package-export.service','has','attachmentLogId','body','snapshotId','_connectionSalesforce','export','search','Cannot\x20retrieve\x20','stringify','Metadata_Log__c/','SalesforceDmlError','isRetrieved','./salesforce.service','906438jsFCQA','(((.+)+)+)+$','ENDPOINT_UPSERT_RECORD','filter','string'];a362_0x5552=function(){return _0x4684d4;};return a362_0x5552();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x16127e){const _0x247f3c=a362_0x1a92;return _0x16127e&&_0x16127e[_0x247f3c(0x1d6)]?_0x16127e:{'default':_0x16127e};};Object[a362_0x51757a(0x21a)](exports,a362_0x51757a(0x1d6),{'value':!![]}),exports['SnapshotService']=void 0x0;const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require(a362_0x51757a(0x249)),veeva_service_1=require(a362_0x51757a(0x239)),metadata_item_dto_1=require(a362_0x51757a(0x221)),constants_1=require(a362_0x51757a(0x244)),salesforce_service_1=require(a362_0x51757a(0x22f)),status_enums_1=require(a362_0x51757a(0x256)),salesforce_dml_error_1=require(a362_0x51757a(0x1fa)),package_export_service_1=require(a362_0x51757a(0x222)),type_and_name_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever'),type_veeva_component_retriever_1=require(a362_0x51757a(0x241)),sync_1=require(a362_0x51757a(0x1eb)),sync_2=require(a362_0x51757a(0x208)),veeva_constants_1=require(a362_0x51757a(0x24d)),path_1=__importDefault(require(a362_0x51757a(0x24e)));class SnapshotService{constructor(_0x3b2655,_0x120bbd,_0x34ce55,_0x5d3c84){const _0x3f38b3=a362_0x51757a;this[_0x3f38b3(0x227)]=_0x120bbd,this['_connectionVeeva']=_0x34ce55,this['_logger']=_0x5d3c84,this[_0x3f38b3(0x252)]=_0x3b2655[_0x3f38b3(0x226)],this[_0x3f38b3(0x20d)]=_0x3b2655[_0x3f38b3(0x235)],this[_0x3f38b3(0x210)]=_0x3b2655[_0x3f38b3(0x224)],this[_0x3f38b3(0x215)]=_0x3b2655[_0x3f38b3(0x253)],this[_0x3f38b3(0x1fb)]=_0x3b2655[_0x3f38b3(0x1ef)],this['_selectedComponentMap']=_0x3b2655[_0x3f38b3(0x1e2)],this[_0x3f38b3(0x246)]=new veeva_service_1[(_0x3f38b3(0x242))]({'connection':this[_0x3f38b3(0x238)],'logger':this[_0x3f38b3(0x1de)]}),this['_salesforceService']=new salesforce_service_1['SalesforceService']({'connection':this[_0x3f38b3(0x227)]}),this[_0x3f38b3(0x1ec)]=new package_export_service_1[(_0x3f38b3(0x204))]({'veevaService':this[_0x3f38b3(0x246)],'connection':this[_0x3f38b3(0x238)],'logger':this[_0x3f38b3(0x1de)]});}async[a362_0x51757a(0x203)](){const _0x5de72b=a362_0x51757a;try{this[_0x5de72b(0x1de)][_0x5de72b(0x1f3)](_0x5de72b(0x21b));const _0x265c0a=await this[_0x5de72b(0x1fd)]();await this[_0x5de72b(0x1de)][_0x5de72b(0x20f)]();const _0x138c0e=await this[_0x5de72b(0x1ec)][_0x5de72b(0x228)](_0x265c0a,SnapshotService[_0x5de72b(0x25b)]);await this[_0x5de72b(0x1de)][_0x5de72b(0x20f)]();const _0x315eba=await this['createMetadataItemListWithBody'](_0x265c0a,_0x138c0e);await this[_0x5de72b(0x217)](_0x315eba),await this['_logger']['updateLog'](),await this[_0x5de72b(0x1e1)](!![]);}catch(_0xf0b4a7){this[_0x5de72b(0x1de)][_0x5de72b(0x1e9)](_0xf0b4a7),await this[_0x5de72b(0x1e1)](![])[_0x5de72b(0x1e8)](_0x21e0e2=>this[_0x5de72b(0x243)][_0x5de72b(0x1e0)](_0x21e0e2));}}async[a362_0x51757a(0x1fd)](){const _0x131af4=a362_0x51757a,_0x310175={'veevaService':this[_0x131af4(0x246)],'logger':this[_0x131af4(0x1de)]},_0x563d71=Array[_0x131af4(0x1f4)](Object[_0x131af4(0x1df)](this[_0x131af4(0x251)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x131af4(0x1dd))]({'value':this[_0x131af4(0x251)],..._0x310175}):new type_veeva_component_retriever_1[(_0x131af4(0x1ee))]({'value':this[_0x131af4(0x1fb)],..._0x310175});return _0x563d71[_0x131af4(0x20b)]();}async['createMetadataItemListWithBody'](_0x3900c2,_0x9cb87c){const _0x1fafbb=a362_0x51757a;var _0x14c726,_0x5414e6;this['_logger']['log']('Unpack\x20zip\x20and\x20create\x20metadata\x20items.');const _0x2f4877=this[_0x1fafbb(0x218)](_0x3900c2),_0x12bb72=_0x2f4877[_0x1fafbb(0x24c)]((_0x5e6b0c,_0x2d39a9)=>_0x5e6b0c[_0x1fafbb(0x207)](_0x2d39a9[_0x1fafbb(0x1d9)],_0x2d39a9),new Map());for(const _0x4069d2 of _0x9cb87c){for(const _0x498379 in _0x4069d2['files']){const {base:_0x134dde,name:_0xbcd359,dir:_0x13e2d1}=path_1[_0x1fafbb(0x21c)][_0x1fafbb(0x209)](_0x498379),_0x28301d=_0xbcd359+veeva_constants_1[_0x1fafbb(0x23a)]['DEPENDENCY_EXTENSION'];if(_0x12bb72[_0x1fafbb(0x223)](_0x134dde)){const _0x394397=await((_0x14c726=_0x4069d2['file'](path_1[_0x1fafbb(0x21c)][_0x1fafbb(0x237)](_0x13e2d1,_0x134dde)))===null||_0x14c726===void 0x0?void 0x0:_0x14c726[_0x1fafbb(0x1f6)](_0x1fafbb(0x234))),_0x307f32=await((_0x5414e6=_0x4069d2['file'](path_1[_0x1fafbb(0x21c)]['join'](_0x13e2d1,_0x28301d)))===null||_0x5414e6===void 0x0?void 0x0:_0x5414e6[_0x1fafbb(0x1f6)](_0x1fafbb(0x234)));if(_0x394397&&_0x307f32){const _0x24012a=new jszip_1[(_0x1fafbb(0x21c))]();_0x24012a[_0x1fafbb(0x1db)](_0x134dde,_0x394397),_0x24012a[_0x1fafbb(0x1db)](_0x28301d,this[_0x1fafbb(0x236)](_0x307f32)),_0x12bb72[_0x1fafbb(0x1dc)](_0x134dde)['body']=await _0x24012a[_0x1fafbb(0x25a)]({'type':_0x1fafbb(0x1fc)});}}}}return _0x2f4877[_0x1fafbb(0x233)](_0x44bc1d=>!_0x44bc1d['body'])['forEach'](_0x262851=>{const _0x40498a=_0x1fafbb;this[_0x40498a(0x1de)][_0x40498a(0x1f3)](_0x40498a(0x22a)+_0x262851['veevaComponentType']+'.'+_0x262851[_0x40498a(0x25c)]+_0x40498a(0x205));}),_0x2f4877['filter'](_0x4dd6a0=>_0x4dd6a0['body']);}[a362_0x51757a(0x236)](_0x5e0211){const _0x33d8fe=a362_0x51757a,_0x999e=(0x0,sync_1[_0x33d8fe(0x209)])(_0x5e0211,{'columns':!![],'skip_empty_lines':!![]}),_0x15c85b=_0x999e[_0x33d8fe(0x1f5)](({'In\x20Package':_0x2f60c2,..._0x42534f})=>_0x42534f);return(0x0,sync_2[_0x33d8fe(0x22b)])(_0x15c85b,{'header':!![]});}[a362_0x51757a(0x218)](_0x24823b){const _0xc63ee3=a362_0x51757a;return _0x24823b[_0xc63ee3(0x1f5)](_0x171964=>{const _0x220b85=_0xc63ee3,_0x37fe52=new metadata_item_dto_1[(_0x220b85(0x200))]();return _0x37fe52[_0x220b85(0x25c)]=_0x171964[_0x220b85(0x25c)],_0x37fe52['apiName']=_0x171964[_0x220b85(0x25c)],_0x37fe52[_0x220b85(0x226)]=this[_0x220b85(0x252)],_0x37fe52[_0x220b85(0x1d9)]=_0x171964['type']+'.'+_0x171964[_0x220b85(0x25c)]+veeva_constants_1[_0x220b85(0x23a)][_0x220b85(0x20a)],_0x37fe52[_0x220b85(0x1f1)]=_0x171964[_0x220b85(0x1f7)],_0x37fe52[_0x220b85(0x1d8)]=_0x171964[_0x220b85(0x1d8)],_0x37fe52[_0x220b85(0x22e)]=![],_0x37fe52;});}async['saveComponentsInSalesforce'](_0x86f4ce){const _0x454712=a362_0x51757a;this[_0x454712(0x1de)][_0x454712(0x1f3)](_0x454712(0x216)),await this['saveAttachments'](_0x86f4ce),this[_0x454712(0x1de)][_0x454712(0x1f3)](_0x454712(0x1e4)+_0x86f4ce[_0x454712(0x245)]+_0x454712(0x1ea));const _0x988894=_0x86f4ce[_0x454712(0x1f5)](_0x25e99b=>{const _0x4f7d12=_0x454712;return{[constants_1[_0x4f7d12(0x21d)]+_0x4f7d12(0x206)]:_0x25e99b[_0x4f7d12(0x25c)],[constants_1[_0x4f7d12(0x21d)]+'API_Name__c']:_0x25e99b['apiName'],[constants_1[_0x4f7d12(0x21d)]+_0x4f7d12(0x1f2)]:_0x25e99b[_0x4f7d12(0x226)],[constants_1[_0x4f7d12(0x21d)]+_0x4f7d12(0x220)]:_0x25e99b['label'],[constants_1[_0x4f7d12(0x21d)]+_0x4f7d12(0x1da)]:_0x25e99b['isRetrieved'],[constants_1['FLOSUM_NAMESPACE']+_0x4f7d12(0x202)]:_0x25e99b['veevaComponentType'],[constants_1[_0x4f7d12(0x21d)]+_0x4f7d12(0x248)]:_0x25e99b['attachmentId'],[constants_1[_0x4f7d12(0x21d)]+_0x4f7d12(0x1e7)]:_0x25e99b[_0x4f7d12(0x1d8)]};}),_0xfe0e95=await this[_0x454712(0x1d7)]['insertMultipleRecords'](constants_1[_0x454712(0x21d)]+_0x454712(0x211),_0x988894);let _0x2306e2=!![];_0xfe0e95[_0x454712(0x213)]((_0xde7c96,_0x107a80)=>{const _0x5d90d2=_0x454712;this[_0x5d90d2(0x1de)][_0x5d90d2(0x1f3)](_0x5d90d2(0x1e4)+_0x86f4ce[_0x107a80][_0x5d90d2(0x1f1)]+'.'+_0x86f4ce[_0x107a80][_0x5d90d2(0x25c)]);if(!_0xde7c96[_0x5d90d2(0x255)]){_0x2306e2=![];const _0x419d1c=new salesforce_dml_error_1['SalesforceDmlError'](_0xde7c96[_0x5d90d2(0x20e)]);this[_0x5d90d2(0x1de)][_0x5d90d2(0x1e9)](_0x419d1c);}});if(!_0x2306e2)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async[a362_0x51757a(0x219)](_0x368c93){const _0x4c0367=a362_0x51757a,_0x229577=this[_0x4c0367(0x21e)](_0x368c93),_0x4191b4=await this[_0x4c0367(0x1d7)][_0x4c0367(0x250)](SnapshotService[_0x4c0367(0x1e3)],_0x229577),_0x2b3e2d=[];_0x4191b4[_0x4c0367(0x213)]((_0x1d9b0a,_0x19f156)=>{const _0x450e90=_0x4c0367;_0x1d9b0a[_0x450e90(0x255)]?(_0x368c93[_0x19f156][_0x450e90(0x1fe)]=_0x1d9b0a['id'],_0x368c93[_0x19f156][_0x450e90(0x22e)]=!![]):_0x2b3e2d['push'](..._0x1d9b0a[_0x450e90(0x20e)]);});if(_0x2b3e2d[_0x4c0367(0x245)])throw new salesforce_dml_error_1[(_0x4c0367(0x22d))](_0x2b3e2d);}['formAttachments'](_0x4bfa08){const _0x12d7c9=a362_0x51757a;return _0x4bfa08[_0x12d7c9(0x1f5)](_0x1ca82c=>({'ParentId':this[_0x12d7c9(0x252)],'Name':_0x1ca82c['veevaComponentType'],'ContentType':'application/zip','Body':_0x1ca82c[_0x12d7c9(0x225)],'Description':_0x1ca82c[_0x12d7c9(0x1f1)]}));}async[a362_0x51757a(0x1e1)](_0x2dc80b){const _0x436ccb=a362_0x51757a,_0x2659e6={[constants_1['FLOSUM_NAMESPACE']+_0x436ccb(0x1ff)]:!![],[constants_1[_0x436ccb(0x21d)]+_0x436ccb(0x1f9)]:!_0x2dc80b},_0x3a8718={[constants_1[_0x436ccb(0x21d)]+'Is_Error__c']:!_0x2dc80b,[constants_1[_0x436ccb(0x21d)]+'Succeed__c']:_0x2dc80b,[constants_1[_0x436ccb(0x21d)]+_0x436ccb(0x1e5)]:_0x2dc80b?status_enums_1[_0x436ccb(0x21f)]['COMPLETED']:status_enums_1[_0x436ccb(0x21f)][_0x436ccb(0x201)],[constants_1['FLOSUM_NAMESPACE']+_0x436ccb(0x257)]:!![]};await this[_0x436ccb(0x227)][_0x436ccb(0x1ed)](flosum_constants_1[_0x436ccb(0x23e)][_0x436ccb(0x232)]+'/'+constants_1[_0x436ccb(0x21d)]+_0x436ccb(0x24a)+this[_0x436ccb(0x252)],_0x2659e6),await this['_connectionSalesforce'][_0x436ccb(0x1ed)](flosum_constants_1[_0x436ccb(0x23e)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1['FLOSUM_NAMESPACE']+_0x436ccb(0x22c)+this[_0x436ccb(0x20d)],_0x3a8718),this[_0x436ccb(0x1de)][_0x436ccb(0x1f3)](_0x436ccb(0x212)+(_0x2dc80b?'successfully':_0x436ccb(0x23b))+'.'),await this[_0x436ccb(0x1de)]['updateLog']();}}exports[a362_0x51757a(0x247)]=SnapshotService,SnapshotService[a362_0x51757a(0x25b)]=a362_0x51757a(0x214),SnapshotService[a362_0x51757a(0x1e3)]=a362_0x51757a(0x240);