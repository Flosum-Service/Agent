function a406_0x5d12(){const _0xa14bef=['15798WXlAgh','FlosumConstants','OUTBOUND_PACKAGE_NAME','VeevaService','errors','_whereClause','isRetrieved','_logger','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','TypeVeevaComponentRetriever','has','Is_Error__c','ENDPOINT_UPSERT_RECORD','Snapshot\x20completed\x20','_packageExportService','length','\x20from\x20outbound\x20package','API_Name__c','label','type','generateAsync','MetadataItemDto','9TdPiKB','3750160rnGHRP','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','6GTNlHl','finishSnapshot','Status__c','Succeed__c','snapshotId','Snapshot__c','push','Last_Modified_Date__c','jszip','body','updateLog','521057hVJoWd','Attachment','Snapshot','./veeva.service','logError','async','stringify','Metadata_Log__c/','error','reduce','Metadata_Item__c','COMPLETED','259xDKcnA','_connectionSalesforce','Attachment_ID__c','map','2672400lmmXZA','apply','retrieveVeevaComponents','string','default','475929iDTBnw','EXCEPTION','_connectionVeeva','ATTACHMENT','_salesforceService','veevaComponentType','search','attachmentId','FLOSUM_NAMESPACE','../../../constants','TypeAndNameVeevaComponentRetriever','Snapshot__c/','_veevaService','apiName','saveAttachments','parse','MDL_EXTENSION','successfully','file','defineProperty','insertMultipleRecords','./package-export.service','base64','files','catch','../classes/errors/salesforce-dml-error','Saving\x20','\x20Metadata\x20Items','../classes/retrievers/veeva-components/type.veeva-component.retriever','log','join','(((.+)+)+)+$','name','toString','_snapshotId','../enums/status.enums','set','166415oHuSVf','forEach','DEPENDENCY_EXTENSION','28aGHefU','csv-parse/sync','_metadataLogId','__esModule','../constants/veeva.constants','createMetadataItemListWithBody','get','_selectedComponentMap','execute','export','Cannot\x20Save\x20Metadata\x20Items','transformDependencyFile','../dtos/metadata-item.dto','Is_Completed__c','success','application/zip','SnapshotService','formMetadataItemDtoList','4687045gmbQlo','MetadataLogStatus','from','lastModifiedDate','path','Cannot\x20retrieve\x20','VeevaConstants','filter','SalesforceDmlError'];a406_0x5d12=function(){return _0xa14bef;};return a406_0x5d12();}const a406_0x1fbad5=a406_0x266b;(function(_0x2d001c,_0x21691a){const _0x539e68=a406_0x266b,_0x361373=_0x2d001c();while(!![]){try{const _0x1da24d=-parseInt(_0x539e68(0x243))/0x1+parseInt(_0x539e68(0x238))/0x2*(-parseInt(_0x539e68(0x1dc))/0x3)+-parseInt(_0x539e68(0x204))/0x4*(-parseInt(_0x539e68(0x201))/0x5)+parseInt(_0x539e68(0x21f))/0x6*(-parseInt(_0x539e68(0x1d3))/0x7)+parseInt(_0x539e68(0x1d7))/0x8+parseInt(_0x539e68(0x235))/0x9*(parseInt(_0x539e68(0x236))/0xa)+parseInt(_0x539e68(0x216))/0xb;if(_0x1da24d===_0x21691a)break;else _0x361373['push'](_0x361373['shift']());}catch(_0x83a3d){_0x361373['push'](_0x361373['shift']());}}}(a406_0x5d12,0x42d47));const a406_0x3373c2=(function(){let _0x9e0af0=!![];return function(_0x2f244d,_0x2abe56){const _0x50b697=_0x9e0af0?function(){const _0x2e693a=a406_0x266b;if(_0x2abe56){const _0x14d43e=_0x2abe56[_0x2e693a(0x1d8)](_0x2f244d,arguments);return _0x2abe56=null,_0x14d43e;}}:function(){};return _0x9e0af0=![],_0x50b697;};}()),a406_0x1a2906=a406_0x3373c2(this,function(){const _0x3243d9=a406_0x266b;return a406_0x1a2906[_0x3243d9(0x1fd)]()['search'](_0x3243d9(0x1fb))['toString']()['constructor'](a406_0x1a2906)[_0x3243d9(0x1e2)]('(((.+)+)+)+$');});a406_0x1a2906();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x55207b){const _0xd881e5=a406_0x266b;return _0x55207b&&_0x55207b[_0xd881e5(0x207)]?_0x55207b:{'default':_0x55207b};};function a406_0x266b(_0x151a6b,_0x422011){const _0x15d70a=a406_0x5d12();return a406_0x266b=function(_0x1a2906,_0x3373c2){_0x1a2906=_0x1a2906-0x1cf;let _0x5d120b=_0x15d70a[_0x1a2906];return _0x5d120b;},a406_0x266b(_0x151a6b,_0x422011);}Object[a406_0x1fbad5(0x1ef)](exports,a406_0x1fbad5(0x207),{'value':!![]}),exports[a406_0x1fbad5(0x214)]=void 0x0;const jszip_1=__importDefault(require(a406_0x1fbad5(0x240))),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require(a406_0x1fbad5(0x246)),metadata_item_dto_1=require(a406_0x1fbad5(0x210)),constants_1=require(a406_0x1fbad5(0x1e5)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a406_0x1fbad5(0x1ff)),salesforce_dml_error_1=require(a406_0x1fbad5(0x1f5)),package_export_service_1=require(a406_0x1fbad5(0x1f1)),type_and_name_veeva_component_retriever_1=require(a406_0x1fbad5(0x227)),type_veeva_component_retriever_1=require(a406_0x1fbad5(0x1f8)),sync_1=require(a406_0x1fbad5(0x205)),sync_2=require('csv-stringify/sync'),veeva_constants_1=require(a406_0x1fbad5(0x208)),path_1=__importDefault(require(a406_0x1fbad5(0x21a)));class SnapshotService{constructor({snapshotId:_0x381624,metadataLogId:_0x2b9a5c,selectedMetaTypes:_0x35969f,selectedComponentMap:_0x4551ad,whereClause:_0x274b3c},_0x396e5f,_0x2294d0,_0x2227f6){const _0x786dea=a406_0x1fbad5;this['_connectionSalesforce']=_0x396e5f,this[_0x786dea(0x1de)]=_0x2294d0,this['_logger']=_0x2227f6,this[_0x786dea(0x1fe)]=_0x381624,this[_0x786dea(0x206)]=_0x2b9a5c,this['_selectedMetaTypes']=_0x35969f,this[_0x786dea(0x20b)]=_0x4551ad,this[_0x786dea(0x224)]=_0x274b3c,this[_0x786dea(0x1e8)]=new veeva_service_1[(_0x786dea(0x222))]({'connection':this[_0x786dea(0x1de)],'logger':this[_0x786dea(0x226)]}),this[_0x786dea(0x1e0)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x786dea(0x1d4)]}),this[_0x786dea(0x22d)]=new package_export_service_1['PackageExportService']({'veevaService':this[_0x786dea(0x1e8)],'connection':this[_0x786dea(0x1de)],'logger':this[_0x786dea(0x226)]});}async[a406_0x1fbad5(0x20c)](){const _0x65d7b5=a406_0x1fbad5;try{this['_logger'][_0x65d7b5(0x1f9)]('Snapshot\x20started.');const _0x1d528b=await this[_0x65d7b5(0x1d9)]();await this['_logger']['updateLog']();const _0x152b90=await this[_0x65d7b5(0x22d)][_0x65d7b5(0x20d)](_0x1d528b,SnapshotService[_0x65d7b5(0x221)]);await this[_0x65d7b5(0x226)][_0x65d7b5(0x242)]();const _0x363b6f=await this[_0x65d7b5(0x209)](_0x1d528b,_0x152b90);await this['saveComponentsInSalesforce'](_0x363b6f),await this[_0x65d7b5(0x226)][_0x65d7b5(0x242)](),await this['finishSnapshot'](!![]);}catch(_0x32bbef){this[_0x65d7b5(0x226)][_0x65d7b5(0x247)](_0x32bbef),await this[_0x65d7b5(0x239)](![])[_0x65d7b5(0x1f4)](_0x4de09e=>this['_systemLogger'][_0x65d7b5(0x1cf)](_0x4de09e));}}async['retrieveVeevaComponents'](){const _0x373e54=a406_0x1fbad5,_0x1e6539={'veevaService':this[_0x373e54(0x1e8)],'logger':this['_logger']},_0x29d2f5=Array[_0x373e54(0x218)](Object['values'](this[_0x373e54(0x20b)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x373e54(0x1e6))]({'value':this[_0x373e54(0x20b)],..._0x1e6539}):new type_veeva_component_retriever_1[(_0x373e54(0x228))]({'value':this['_selectedMetaTypes'],'whereClause':this['_whereClause'],..._0x1e6539});return _0x29d2f5['retrieve']();}async[a406_0x1fbad5(0x209)](_0x11a377,_0x199e2){const _0x32668d=a406_0x1fbad5;var _0xdd9f5e,_0x14ab66;this[_0x32668d(0x226)][_0x32668d(0x1f9)](_0x32668d(0x237));const _0x55f065=this[_0x32668d(0x215)](_0x11a377),_0x1f2763=_0x55f065[_0x32668d(0x1d0)]((_0x13b8fc,_0x542672)=>_0x13b8fc[_0x32668d(0x200)](_0x542672[_0x32668d(0x231)],_0x542672),new Map());for(const _0x4d4fc2 of _0x199e2){for(const _0x126aed in _0x4d4fc2[_0x32668d(0x1f3)]){const {base:_0x49272,name:_0x33df3d,dir:_0x1c6078}=path_1['default'][_0x32668d(0x1eb)](_0x126aed),_0x4afa4f=_0x33df3d+veeva_constants_1[_0x32668d(0x21c)][_0x32668d(0x203)];if(_0x1f2763[_0x32668d(0x229)](_0x49272)){const _0x3d06fe=await((_0xdd9f5e=_0x4d4fc2[_0x32668d(0x1ee)]([_0x1c6078,_0x49272][_0x32668d(0x1fa)](path_1[_0x32668d(0x1db)]['posix']['sep'])))===null||_0xdd9f5e===void 0x0?void 0x0:_0xdd9f5e['async'](_0x32668d(0x1da))),_0x16321e=await((_0x14ab66=_0x4d4fc2[_0x32668d(0x1ee)]([_0x1c6078,_0x4afa4f][_0x32668d(0x1fa)](path_1[_0x32668d(0x1db)]['posix']['sep'])))===null||_0x14ab66===void 0x0?void 0x0:_0x14ab66[_0x32668d(0x248)](_0x32668d(0x1da)));if(_0x3d06fe){const _0x2511d5=new jszip_1[(_0x32668d(0x1db))]();_0x2511d5[_0x32668d(0x1ee)](_0x49272,_0x3d06fe),_0x16321e&&_0x2511d5[_0x32668d(0x1ee)](_0x4afa4f,this[_0x32668d(0x20f)](_0x16321e)),_0x1f2763[_0x32668d(0x20a)](_0x49272)[_0x32668d(0x241)]=await _0x2511d5[_0x32668d(0x233)]({'type':_0x32668d(0x1f2)});}}}}return _0x55f065[_0x32668d(0x21d)](_0x3fc240=>!_0x3fc240[_0x32668d(0x241)])[_0x32668d(0x202)](_0x164375=>{const _0x26e943=_0x32668d;this[_0x26e943(0x226)][_0x26e943(0x1f9)](_0x26e943(0x21b)+_0x164375[_0x26e943(0x1e1)]+'.'+_0x164375[_0x26e943(0x1fc)]+_0x26e943(0x22f));}),_0x55f065[_0x32668d(0x21d)](_0x47de44=>_0x47de44[_0x32668d(0x241)]);}[a406_0x1fbad5(0x20f)](_0x271dab){const _0x413a7b=a406_0x1fbad5,_0x4690f8=(0x0,sync_1['parse'])(_0x271dab,{'columns':!![],'skip_empty_lines':!![]}),_0xe61e22=_0x4690f8['map'](({'In\x20Package':_0x4f3b20,..._0x2b843d})=>_0x2b843d);return(0x0,sync_2[_0x413a7b(0x249)])(_0xe61e22,{'header':!![]});}[a406_0x1fbad5(0x215)](_0x11ae01){const _0x1f67fa=a406_0x1fbad5;return _0x11ae01[_0x1f67fa(0x1d6)](_0x2af6d7=>{const _0x4c9840=_0x1f67fa,_0x4ffdbb=new metadata_item_dto_1[(_0x4c9840(0x234))]();return _0x4ffdbb[_0x4c9840(0x1fc)]=_0x2af6d7[_0x4c9840(0x1fc)],_0x4ffdbb['apiName']=_0x2af6d7[_0x4c9840(0x1fc)],_0x4ffdbb[_0x4c9840(0x23c)]=this[_0x4c9840(0x1fe)],_0x4ffdbb[_0x4c9840(0x231)]=_0x2af6d7[_0x4c9840(0x232)]+'.'+_0x2af6d7['name']+veeva_constants_1[_0x4c9840(0x21c)][_0x4c9840(0x1ec)],_0x4ffdbb[_0x4c9840(0x1e1)]=_0x2af6d7[_0x4c9840(0x232)],_0x4ffdbb[_0x4c9840(0x219)]=_0x2af6d7['lastModifiedDate'],_0x4ffdbb[_0x4c9840(0x225)]=![],_0x4ffdbb;});}async['saveComponentsInSalesforce'](_0x592abf){const _0x4e9c48=a406_0x1fbad5;this[_0x4e9c48(0x226)][_0x4e9c48(0x1f9)]('Saving\x20Attachments.'),await this[_0x4e9c48(0x1ea)](_0x592abf),this[_0x4e9c48(0x226)]['log']('Saving\x20'+_0x592abf[_0x4e9c48(0x22e)]+_0x4e9c48(0x1f7));const _0x31ecd7=_0x592abf[_0x4e9c48(0x1d6)](_0x1096e4=>{const _0x127a2b=_0x4e9c48;return{[constants_1['FLOSUM_NAMESPACE']+'Name__c']:_0x1096e4[_0x127a2b(0x1fc)],[constants_1['FLOSUM_NAMESPACE']+_0x127a2b(0x230)]:_0x1096e4[_0x127a2b(0x1e9)],[constants_1[_0x127a2b(0x1e4)]+_0x127a2b(0x23d)]:_0x1096e4[_0x127a2b(0x23c)],[constants_1['FLOSUM_NAMESPACE']+'Label__c']:_0x1096e4[_0x127a2b(0x231)],[constants_1[_0x127a2b(0x1e4)]+'Is_Retrieved__c']:_0x1096e4[_0x127a2b(0x225)],[constants_1['FLOSUM_NAMESPACE']+'Veeva_Component_Type__c']:_0x1096e4[_0x127a2b(0x1e1)],[constants_1[_0x127a2b(0x1e4)]+_0x127a2b(0x1d5)]:_0x1096e4[_0x127a2b(0x1e3)],[constants_1['FLOSUM_NAMESPACE']+_0x127a2b(0x23f)]:_0x1096e4[_0x127a2b(0x219)]};}),_0x3144b2=await this['_salesforceService'][_0x4e9c48(0x1f0)](constants_1[_0x4e9c48(0x1e4)]+_0x4e9c48(0x1d1),_0x31ecd7);let _0x242a03=!![];_0x3144b2[_0x4e9c48(0x202)]((_0x43176d,_0x4131f7)=>{const _0x539e29=_0x4e9c48;this[_0x539e29(0x226)]['log'](_0x539e29(0x1f6)+_0x592abf[_0x4131f7][_0x539e29(0x1e1)]+'.'+_0x592abf[_0x4131f7][_0x539e29(0x1fc)]);if(!_0x43176d['success']){_0x242a03=![];const _0x4a7a36=new salesforce_dml_error_1[(_0x539e29(0x21e))](_0x43176d[_0x539e29(0x223)]);this[_0x539e29(0x226)]['logError'](_0x4a7a36);}});if(!_0x242a03)throw new Error(_0x4e9c48(0x20e));}async[a406_0x1fbad5(0x1ea)](_0x2de617){const _0x1e86ab=a406_0x1fbad5,_0x3e9920=this['formAttachments'](_0x2de617),_0x34ac9c=await this[_0x1e86ab(0x1e0)][_0x1e86ab(0x1f0)](SnapshotService[_0x1e86ab(0x1df)],_0x3e9920),_0x30f3ef=[];_0x34ac9c['forEach']((_0x198302,_0x4bd166)=>{const _0x3b3565=_0x1e86ab;_0x198302[_0x3b3565(0x212)]?(_0x2de617[_0x4bd166][_0x3b3565(0x1e3)]=_0x198302['id'],_0x2de617[_0x4bd166][_0x3b3565(0x225)]=!![]):_0x30f3ef[_0x3b3565(0x23e)](..._0x198302[_0x3b3565(0x223)]);});if(_0x30f3ef[_0x1e86ab(0x22e)])throw new salesforce_dml_error_1[(_0x1e86ab(0x21e))](_0x30f3ef);}['formAttachments'](_0x587a6a){const _0x18f068=a406_0x1fbad5;return _0x587a6a[_0x18f068(0x1d6)](_0x4afb0b=>({'ParentId':this['_snapshotId'],'Name':_0x4afb0b[_0x18f068(0x1e1)],'ContentType':_0x18f068(0x213),'Body':_0x4afb0b[_0x18f068(0x241)],'Description':_0x4afb0b[_0x18f068(0x1e1)]}));}async[a406_0x1fbad5(0x239)](_0x5d6e0d){const _0x4128ff=a406_0x1fbad5,_0x5be00f={[constants_1[_0x4128ff(0x1e4)]+_0x4128ff(0x211)]:!![],[constants_1[_0x4128ff(0x1e4)]+_0x4128ff(0x22a)]:!_0x5d6e0d},_0x498904={[constants_1[_0x4128ff(0x1e4)]+_0x4128ff(0x22a)]:!_0x5d6e0d,[constants_1[_0x4128ff(0x1e4)]+_0x4128ff(0x23b)]:_0x5d6e0d,[constants_1['FLOSUM_NAMESPACE']+_0x4128ff(0x23a)]:_0x5d6e0d?status_enums_1['MetadataLogStatus'][_0x4128ff(0x1d2)]:status_enums_1[_0x4128ff(0x217)][_0x4128ff(0x1dd)],[constants_1['FLOSUM_NAMESPACE']+'Job_Completed__c']:!![]};await this[_0x4128ff(0x1d4)]['patch'](flosum_constants_1[_0x4128ff(0x220)][_0x4128ff(0x22b)]+'/'+constants_1[_0x4128ff(0x1e4)]+_0x4128ff(0x1e7)+this[_0x4128ff(0x1fe)],_0x5be00f),await this['_connectionSalesforce']['patch'](flosum_constants_1['FlosumConstants'][_0x4128ff(0x22b)]+'/'+constants_1[_0x4128ff(0x1e4)]+_0x4128ff(0x24a)+this[_0x4128ff(0x206)],_0x498904),this['_logger'][_0x4128ff(0x1f9)](_0x4128ff(0x22c)+(_0x5d6e0d?_0x4128ff(0x1ed):'with\x20error')+'.'),await this[_0x4128ff(0x226)][_0x4128ff(0x242)]();}}exports[a406_0x1fbad5(0x214)]=SnapshotService,SnapshotService['OUTBOUND_PACKAGE_NAME']=a406_0x1fbad5(0x245),SnapshotService[a406_0x1fbad5(0x1df)]=a406_0x1fbad5(0x244);