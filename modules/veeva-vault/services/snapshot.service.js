const a406_0x2e5c81=a406_0x6a17;(function(_0x54b5b4,_0xd17eaf){const _0x112af2=a406_0x6a17,_0x419c8e=_0x54b5b4();while(!![]){try{const _0x166c6b=parseInt(_0x112af2(0x121))/0x1+parseInt(_0x112af2(0x122))/0x2+-parseInt(_0x112af2(0x15a))/0x3+-parseInt(_0x112af2(0x141))/0x4+-parseInt(_0x112af2(0x144))/0x5*(-parseInt(_0x112af2(0x11a))/0x6)+-parseInt(_0x112af2(0x156))/0x7+parseInt(_0x112af2(0x11d))/0x8;if(_0x166c6b===_0xd17eaf)break;else _0x419c8e['push'](_0x419c8e['shift']());}catch(_0x574e78){_0x419c8e['push'](_0x419c8e['shift']());}}}(a406_0x6ac1,0xafffa));const a406_0x5b79d0=(function(){let _0x20b4ad=!![];return function(_0x17a471,_0x4effa7){const _0x4d97e0=_0x20b4ad?function(){if(_0x4effa7){const _0x133f86=_0x4effa7['apply'](_0x17a471,arguments);return _0x4effa7=null,_0x133f86;}}:function(){};return _0x20b4ad=![],_0x4d97e0;};}()),a406_0x3fa43c=a406_0x5b79d0(this,function(){const _0x2f03b6=a406_0x6a17;return a406_0x3fa43c['toString']()[_0x2f03b6(0x189)](_0x2f03b6(0x138))['toString']()[_0x2f03b6(0x14e)](a406_0x3fa43c)[_0x2f03b6(0x189)](_0x2f03b6(0x138));});a406_0x3fa43c();'use strict';var __importDefault=this&&this[a406_0x2e5c81(0x190)]||function(_0x43fac7){const _0x34afad=a406_0x2e5c81;return _0x43fac7&&_0x43fac7[_0x34afad(0x15e)]?_0x43fac7:{'default':_0x43fac7};};function a406_0x6a17(_0x1ec7fa,_0x4ed0ad){const _0x6be83d=a406_0x6ac1();return a406_0x6a17=function(_0x3fa43c,_0x5b79d0){_0x3fa43c=_0x3fa43c-0x11a;let _0x6ac1c1=_0x6be83d[_0x3fa43c];return _0x6ac1c1;},a406_0x6a17(_0x1ec7fa,_0x4ed0ad);}Object[a406_0x2e5c81(0x170)](exports,a406_0x2e5c81(0x15e),{'value':!![]}),exports[a406_0x2e5c81(0x12c)]=void 0x0;const jszip_1=__importDefault(require(a406_0x2e5c81(0x161))),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require(a406_0x2e5c81(0x134)),metadata_item_dto_1=require(a406_0x2e5c81(0x14a)),constants_1=require(a406_0x2e5c81(0x12d)),salesforce_service_1=require(a406_0x2e5c81(0x12e)),status_enums_1=require(a406_0x2e5c81(0x182)),salesforce_dml_error_1=require(a406_0x2e5c81(0x18b)),package_export_service_1=require('./package-export.service'),type_and_name_veeva_component_retriever_1=require(a406_0x2e5c81(0x16f)),type_veeva_component_retriever_1=require(a406_0x2e5c81(0x185)),sync_1=require(a406_0x2e5c81(0x176)),sync_2=require(a406_0x2e5c81(0x197)),veeva_constants_1=require(a406_0x2e5c81(0x163)),path_1=__importDefault(require('path'));function a406_0x6ac1(){const _0x14ca23=['map','Attachment_ID__c','SnapshotService','../../../constants','./salesforce.service','TypeVeevaComponentRetriever','MetadataLogStatus','Saving\x20','label','OUTBOUND_PACKAGE_NAME','./veeva.service','MDL_EXTENSION','COMPLETED','snapshotId','(((.+)+)+)+$','filter','SalesforceService','formMetadataItemDtoList','has','_connectionSalesforce','saveAttachments','join','Job_Completed__c','3984292zWqeGc','attachmentId','Veeva_Component_Type__c','4008365aRtjPH','createMetadataItemListWithBody','Snapshot__c','log','apiName','success','../dtos/metadata-item.dto','_whereClause','lastModifiedDate','_veevaService','constructor','_logger','_metadataLogId','_salesforceService','DEPENDENCY_EXTENSION','stringify','EXCEPTION','isRetrieved','3481009ljGhUn','Is_Error__c','\x20Metadata\x20Items','FlosumConstants','758535ZMDscv','Name__c','posix','VeevaConstants','__esModule','formAttachments','_snapshotId','jszip','\x20from\x20outbound\x20package','../constants/veeva.constants','TypeAndNameVeevaComponentRetriever','push','saveComponentsInSalesforce','errors','MetadataItemDto','body','values','insertMultipleRecords','files','veevaComponentType','successfully','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','defineProperty','transformDependencyFile','_connectionVeeva','Is_Completed__c','forEach','export','csv-parse/sync','default','sep','Saving\x20Attachments.','logError','patch','from','Snapshot\x20started.','execute','get','type','_selectedMetaTypes','../enums/status.enums','generateAsync','string','../classes/retrievers/veeva-components/type.veeva-component.retriever','Snapshot\x20completed\x20','_selectedComponentMap','Succeed__c','search','parse','../classes/errors/salesforce-dml-error','_systemLogger','Label__c','Metadata_Log__c/','reduce','__importDefault','Cannot\x20retrieve\x20','catch','file','updateLog','Status__c','async','csv-stringify/sync','VeevaService','base64','SalesforceDmlError','6QRgPtA','name','ENDPOINT_UPSERT_RECORD','574208NuRCiJ','Last_Modified_Date__c','_packageExportService','FLOSUM_NAMESPACE','1008221GCbfRh','1170850tywjMt','finishSnapshot','ATTACHMENT','length','retrieve','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','Cannot\x20Save\x20Metadata\x20Items','Snapshot'];a406_0x6ac1=function(){return _0x14ca23;};return a406_0x6ac1();}class SnapshotService{constructor({snapshotId:_0x156840,metadataLogId:_0x29b9fb,selectedMetaTypes:_0x367f24,selectedComponentMap:_0x1a88a7,whereClause:_0x568257},_0x1e866b,_0xd622c,_0x177fa8){const _0x596b28=a406_0x2e5c81;this[_0x596b28(0x13d)]=_0x1e866b,this[_0x596b28(0x172)]=_0xd622c,this['_logger']=_0x177fa8,this['_snapshotId']=_0x156840,this['_metadataLogId']=_0x29b9fb,this[_0x596b28(0x181)]=_0x367f24,this[_0x596b28(0x187)]=_0x1a88a7,this['_whereClause']=_0x568257,this[_0x596b28(0x14d)]=new veeva_service_1[(_0x596b28(0x198))]({'connection':this[_0x596b28(0x172)],'logger':this[_0x596b28(0x14f)]}),this[_0x596b28(0x151)]=new salesforce_service_1[(_0x596b28(0x13a))]({'connection':this['_connectionSalesforce']}),this[_0x596b28(0x11f)]=new package_export_service_1['PackageExportService']({'veevaService':this['_veevaService'],'connection':this[_0x596b28(0x172)],'logger':this[_0x596b28(0x14f)]});}async[a406_0x2e5c81(0x17e)](){const _0x4b4a95=a406_0x2e5c81;try{this[_0x4b4a95(0x14f)][_0x4b4a95(0x147)](_0x4b4a95(0x17d));const _0x1cfceb=await this['retrieveVeevaComponents']();await this[_0x4b4a95(0x14f)][_0x4b4a95(0x194)]();const _0xd20d59=await this['_packageExportService'][_0x4b4a95(0x175)](_0x1cfceb,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this['_logger']['updateLog']();const _0x40a928=await this[_0x4b4a95(0x145)](_0x1cfceb,_0xd20d59);await this['saveComponentsInSalesforce'](_0x40a928),await this[_0x4b4a95(0x14f)]['updateLog'](),await this['finishSnapshot'](!![]);}catch(_0x3f95c6){this['_logger'][_0x4b4a95(0x17a)](_0x3f95c6),await this[_0x4b4a95(0x123)](![])[_0x4b4a95(0x192)](_0xb25853=>this[_0x4b4a95(0x18c)]['error'](_0xb25853));}}async['retrieveVeevaComponents'](){const _0x2d6f9f=a406_0x2e5c81,_0x4dd230={'veevaService':this[_0x2d6f9f(0x14d)],'logger':this[_0x2d6f9f(0x14f)]},_0x2d8b02=Array[_0x2d6f9f(0x17c)](Object[_0x2d6f9f(0x16a)](this[_0x2d6f9f(0x187)]))[_0x2d6f9f(0x125)]?new type_and_name_veeva_component_retriever_1[(_0x2d6f9f(0x164))]({'value':this['_selectedComponentMap'],..._0x4dd230}):new type_veeva_component_retriever_1[(_0x2d6f9f(0x12f))]({'value':this[_0x2d6f9f(0x181)],'whereClause':this[_0x2d6f9f(0x14b)],..._0x4dd230});return _0x2d8b02[_0x2d6f9f(0x126)]();}async[a406_0x2e5c81(0x145)](_0x28a493,_0x5c14ba){const _0x5f5bc2=a406_0x2e5c81;var _0x325d61,_0x2c9dc4;this['_logger'][_0x5f5bc2(0x147)](_0x5f5bc2(0x127));const _0x5e1816=this[_0x5f5bc2(0x13b)](_0x28a493),_0x3fdb9a=_0x5e1816[_0x5f5bc2(0x18f)]((_0x36b5d9,_0x3d6f90)=>_0x36b5d9['set'](_0x3d6f90['label'],_0x3d6f90),new Map());for(const _0x25d535 of _0x5c14ba){for(const _0x3eb563 in _0x25d535[_0x5f5bc2(0x16c)]){const {base:_0x5ebee0,name:_0x1f172a,dir:_0x2e3cc6}=path_1[_0x5f5bc2(0x177)][_0x5f5bc2(0x18a)](_0x3eb563),_0x34b1ab=_0x1f172a+veeva_constants_1['VeevaConstants'][_0x5f5bc2(0x152)];if(_0x3fdb9a[_0x5f5bc2(0x13c)](_0x5ebee0)){const _0x11a511=await((_0x325d61=_0x25d535[_0x5f5bc2(0x193)]([_0x2e3cc6,_0x5ebee0][_0x5f5bc2(0x13f)](path_1[_0x5f5bc2(0x177)][_0x5f5bc2(0x15c)][_0x5f5bc2(0x178)])))===null||_0x325d61===void 0x0?void 0x0:_0x325d61[_0x5f5bc2(0x196)]('string')),_0x36d7db=await((_0x2c9dc4=_0x25d535['file']([_0x2e3cc6,_0x34b1ab][_0x5f5bc2(0x13f)](path_1['default'][_0x5f5bc2(0x15c)][_0x5f5bc2(0x178)])))===null||_0x2c9dc4===void 0x0?void 0x0:_0x2c9dc4[_0x5f5bc2(0x196)](_0x5f5bc2(0x184)));if(_0x11a511){const _0x2e9aef=new jszip_1['default']();_0x2e9aef[_0x5f5bc2(0x193)](_0x5ebee0,_0x11a511),_0x36d7db&&_0x2e9aef[_0x5f5bc2(0x193)](_0x34b1ab,this['transformDependencyFile'](_0x36d7db)),_0x3fdb9a[_0x5f5bc2(0x17f)](_0x5ebee0)[_0x5f5bc2(0x169)]=await _0x2e9aef[_0x5f5bc2(0x183)]({'type':_0x5f5bc2(0x199)});}}}}return _0x5e1816['filter'](_0xb6f1bf=>!_0xb6f1bf[_0x5f5bc2(0x169)])[_0x5f5bc2(0x174)](_0x24eac6=>{const _0x51b63a=_0x5f5bc2;this[_0x51b63a(0x14f)]['log'](_0x51b63a(0x191)+_0x24eac6['veevaComponentType']+'.'+_0x24eac6[_0x51b63a(0x11b)]+_0x51b63a(0x162));}),_0x5e1816[_0x5f5bc2(0x139)](_0x90ddd3=>_0x90ddd3[_0x5f5bc2(0x169)]);}[a406_0x2e5c81(0x171)](_0x3245aa){const _0x47bd11=a406_0x2e5c81,_0x118aa1=(0x0,sync_1['parse'])(_0x3245aa,{'columns':!![],'skip_empty_lines':!![]}),_0x534a1f=_0x118aa1[_0x47bd11(0x12a)](({'In\x20Package':_0x588ec5,..._0x2957ef})=>_0x2957ef);return(0x0,sync_2[_0x47bd11(0x153)])(_0x534a1f,{'header':!![]});}[a406_0x2e5c81(0x13b)](_0x2643cc){const _0x174c28=a406_0x2e5c81;return _0x2643cc[_0x174c28(0x12a)](_0x5dd2b1=>{const _0x5021bf=_0x174c28,_0x53adac=new metadata_item_dto_1[(_0x5021bf(0x168))]();return _0x53adac[_0x5021bf(0x11b)]=_0x5dd2b1[_0x5021bf(0x11b)],_0x53adac['apiName']=_0x5dd2b1['name'],_0x53adac[_0x5021bf(0x137)]=this['_snapshotId'],_0x53adac['label']=_0x5dd2b1[_0x5021bf(0x180)]+'.'+_0x5dd2b1[_0x5021bf(0x11b)]+veeva_constants_1[_0x5021bf(0x15d)][_0x5021bf(0x135)],_0x53adac[_0x5021bf(0x16d)]=_0x5dd2b1['type'],_0x53adac[_0x5021bf(0x14c)]=_0x5dd2b1['lastModifiedDate'],_0x53adac[_0x5021bf(0x155)]=![],_0x53adac;});}async[a406_0x2e5c81(0x166)](_0x3e4846){const _0x9a3d8b=a406_0x2e5c81;this[_0x9a3d8b(0x14f)]['log'](_0x9a3d8b(0x179)),await this[_0x9a3d8b(0x13e)](_0x3e4846),this['_logger'][_0x9a3d8b(0x147)](_0x9a3d8b(0x131)+_0x3e4846[_0x9a3d8b(0x125)]+_0x9a3d8b(0x158));const _0x14b3b3=_0x3e4846[_0x9a3d8b(0x12a)](_0x17132a=>{const _0x39ab7b=_0x9a3d8b;return{[constants_1[_0x39ab7b(0x120)]+_0x39ab7b(0x15b)]:_0x17132a['name'],[constants_1[_0x39ab7b(0x120)]+'API_Name__c']:_0x17132a[_0x39ab7b(0x148)],[constants_1[_0x39ab7b(0x120)]+_0x39ab7b(0x146)]:_0x17132a[_0x39ab7b(0x137)],[constants_1['FLOSUM_NAMESPACE']+_0x39ab7b(0x18d)]:_0x17132a[_0x39ab7b(0x132)],[constants_1[_0x39ab7b(0x120)]+'Is_Retrieved__c']:_0x17132a['isRetrieved'],[constants_1[_0x39ab7b(0x120)]+_0x39ab7b(0x143)]:_0x17132a['veevaComponentType'],[constants_1[_0x39ab7b(0x120)]+_0x39ab7b(0x12b)]:_0x17132a['attachmentId'],[constants_1['FLOSUM_NAMESPACE']+_0x39ab7b(0x11e)]:_0x17132a[_0x39ab7b(0x14c)]};}),_0x455b8e=await this['_salesforceService']['insertMultipleRecords'](constants_1[_0x9a3d8b(0x120)]+'Metadata_Item__c',_0x14b3b3);let _0x49f523=!![];_0x455b8e[_0x9a3d8b(0x174)]((_0x7292d4,_0x3b055c)=>{const _0x2ad38a=_0x9a3d8b;this[_0x2ad38a(0x14f)][_0x2ad38a(0x147)](_0x2ad38a(0x131)+_0x3e4846[_0x3b055c]['veevaComponentType']+'.'+_0x3e4846[_0x3b055c][_0x2ad38a(0x11b)]);if(!_0x7292d4[_0x2ad38a(0x149)]){_0x49f523=![];const _0x3ad2b0=new salesforce_dml_error_1[(_0x2ad38a(0x19a))](_0x7292d4[_0x2ad38a(0x167)]);this['_logger'][_0x2ad38a(0x17a)](_0x3ad2b0);}});if(!_0x49f523)throw new Error(_0x9a3d8b(0x128));}async[a406_0x2e5c81(0x13e)](_0x3361b9){const _0x4beb7e=a406_0x2e5c81,_0x1e7c8f=this[_0x4beb7e(0x15f)](_0x3361b9),_0x26419e=await this[_0x4beb7e(0x151)][_0x4beb7e(0x16b)](SnapshotService[_0x4beb7e(0x124)],_0x1e7c8f),_0xa1f929=[];_0x26419e[_0x4beb7e(0x174)]((_0x137e1d,_0x293848)=>{const _0x2f2427=_0x4beb7e;_0x137e1d[_0x2f2427(0x149)]?(_0x3361b9[_0x293848][_0x2f2427(0x142)]=_0x137e1d['id'],_0x3361b9[_0x293848]['isRetrieved']=!![]):_0xa1f929[_0x2f2427(0x165)](..._0x137e1d[_0x2f2427(0x167)]);});if(_0xa1f929[_0x4beb7e(0x125)])throw new salesforce_dml_error_1[(_0x4beb7e(0x19a))](_0xa1f929);}[a406_0x2e5c81(0x15f)](_0x5042f7){const _0x41f1e8=a406_0x2e5c81;return _0x5042f7[_0x41f1e8(0x12a)](_0x1e1710=>({'ParentId':this[_0x41f1e8(0x160)],'Name':_0x1e1710[_0x41f1e8(0x16d)],'ContentType':'application/zip','Body':_0x1e1710[_0x41f1e8(0x169)],'Description':_0x1e1710['veevaComponentType']}));}async[a406_0x2e5c81(0x123)](_0x4fd489){const _0x2b183d=a406_0x2e5c81,_0x42f72d={[constants_1[_0x2b183d(0x120)]+_0x2b183d(0x173)]:!![],[constants_1[_0x2b183d(0x120)]+_0x2b183d(0x157)]:!_0x4fd489},_0x200127={[constants_1[_0x2b183d(0x120)]+'Is_Error__c']:!_0x4fd489,[constants_1['FLOSUM_NAMESPACE']+_0x2b183d(0x188)]:_0x4fd489,[constants_1['FLOSUM_NAMESPACE']+_0x2b183d(0x195)]:_0x4fd489?status_enums_1[_0x2b183d(0x130)][_0x2b183d(0x136)]:status_enums_1[_0x2b183d(0x130)][_0x2b183d(0x154)],[constants_1[_0x2b183d(0x120)]+_0x2b183d(0x140)]:!![]};await this[_0x2b183d(0x13d)][_0x2b183d(0x17b)](flosum_constants_1[_0x2b183d(0x159)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x2b183d(0x120)]+'Snapshot__c/'+this[_0x2b183d(0x160)],_0x42f72d),await this['_connectionSalesforce'][_0x2b183d(0x17b)](flosum_constants_1[_0x2b183d(0x159)][_0x2b183d(0x11c)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x2b183d(0x18e)+this[_0x2b183d(0x150)],_0x200127),this[_0x2b183d(0x14f)][_0x2b183d(0x147)](_0x2b183d(0x186)+(_0x4fd489?_0x2b183d(0x16e):'with\x20error')+'.'),await this['_logger'][_0x2b183d(0x194)]();}}exports[a406_0x2e5c81(0x12c)]=SnapshotService,SnapshotService[a406_0x2e5c81(0x133)]=a406_0x2e5c81(0x129),SnapshotService[a406_0x2e5c81(0x124)]='Attachment';