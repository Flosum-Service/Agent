const a362_0xea04a6=a362_0x826b;(function(_0x5d15db,_0x6800f){const _0x462c42=a362_0x826b,_0x3d20e4=_0x5d15db();while(!![]){try{const _0x3a7920=parseInt(_0x462c42(0xa9))/0x1+parseInt(_0x462c42(0xd2))/0x2+-parseInt(_0x462c42(0xbf))/0x3*(-parseInt(_0x462c42(0x10a))/0x4)+parseInt(_0x462c42(0xfb))/0x5*(-parseInt(_0x462c42(0xac))/0x6)+parseInt(_0x462c42(0xee))/0x7+-parseInt(_0x462c42(0x107))/0x8*(parseInt(_0x462c42(0xc7))/0x9)+-parseInt(_0x462c42(0x114))/0xa;if(_0x3a7920===_0x6800f)break;else _0x3d20e4['push'](_0x3d20e4['shift']());}catch(_0x484974){_0x3d20e4['push'](_0x3d20e4['shift']());}}}(a362_0x3ef4,0x78c6e));const a362_0x17a338=(function(){let _0x3ea307=!![];return function(_0x6778d2,_0x524291){const _0x32139a=_0x3ea307?function(){const _0x33d00e=a362_0x826b;if(_0x524291){const _0x2cbd3c=_0x524291[_0x33d00e(0xea)](_0x6778d2,arguments);return _0x524291=null,_0x2cbd3c;}}:function(){};return _0x3ea307=![],_0x32139a;};}()),a362_0x2f4ce7=a362_0x17a338(this,function(){const _0x331366=a362_0x826b;return a362_0x2f4ce7[_0x331366(0xe6)]()[_0x331366(0xa8)]('(((.+)+)+)+$')['toString']()[_0x331366(0xa3)](a362_0x2f4ce7)[_0x331366(0xa8)](_0x331366(0x10b));});a362_0x2f4ce7();function a362_0x3ef4(){const _0x2c4d07=['constructor','with\x20error','./package-export.service','execute','base64','search','770753Vosafm','retrieve','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','6WdzZmp','_packageExportService','transformDependencyFile','saveComponentsInSalesforce','error','EXCEPTION','values','formMetadataItemDtoList','csv-stringify/sync','defineProperty','selectedComponentMap','PackageExportService','join','Veeva_Component_Type__c','_logger','get','OUTBOUND_PACKAGE_NAME','Metadata_Item__c','label','177AiUFGv','_selectedComponentMap','name','ENDPOINT_UPSERT_RECORD','attachmentId','../constants/veeva.constants','application/zip','catch','72aXtZXw','../enums/status.enums','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','_salesforceService','patch','MDL_EXTENSION','success','formAttachments','export','logError','has','1789886VEPqgx','Saving\x20','Last_Modified_Date__c','Status__c','Cannot\x20Save\x20Metadata\x20Items','../../../constants','_connectionSalesforce','string','ATTACHMENT','Is_Retrieved__c','./veeva.service','body','_snapshotId','../dtos/metadata-item.dto','apiName','MetadataLogStatus','log','Label__c','errors','files','toString','SnapshotService','createMetadataItemListWithBody','_systemLogger','apply','_connectionVeeva','Snapshot__c','attachmentLogId','316918hYdIGm','filter','veevaComponentType','generateAsync','Name__c','Succeed__c','retrieveVeevaComponents','Cannot\x20retrieve\x20','default','map','async','VeevaConstants','lastModifiedDate','2113070iTiTqB','saveAttachments','Snapshot__c/','__esModule','Attachment','Is_Completed__c','forEach','_selectedMetaTypes','type','FlosumConstants','finishSnapshot','API_Name__c','803552HZbWre','jszip','Metadata_Log__c/','16936caWKTa','(((.+)+)+)+$','SalesforceDmlError','TypeVeevaComponentRetriever','TypeAndNameVeevaComponentRetriever','file','insertMultipleRecords','path','Job_Completed__c','DEPENDENCY_EXTENSION','2399080giOQZx','isRetrieved','metadataLogId','../classes/retrievers/veeva-components/type.veeva-component.retriever','snapshotId','FLOSUM_NAMESPACE','_veevaService','Is_Error__c','length','Snapshot','./salesforce.service','updateLog','timeZone'];a362_0x3ef4=function(){return _0x2c4d07;};return a362_0x3ef4();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x494447){const _0x3ed8c6=a362_0x826b;return _0x494447&&_0x494447[_0x3ed8c6(0xfe)]?_0x494447:{'default':_0x494447};};Object[a362_0xea04a6(0xb5)](exports,'__esModule',{'value':!![]}),exports[a362_0xea04a6(0xe7)]=void 0x0;function a362_0x826b(_0x9f809a,_0x5e38b0){const _0xc20e32=a362_0x3ef4();return a362_0x826b=function(_0x2f4ce7,_0x17a338){_0x2f4ce7=_0x2f4ce7-0xa0;let _0x3ef419=_0xc20e32[_0x2f4ce7];return _0x3ef419;},a362_0x826b(_0x9f809a,_0x5e38b0);}const jszip_1=__importDefault(require(a362_0xea04a6(0x108))),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require(a362_0xea04a6(0xdc)),metadata_item_dto_1=require(a362_0xea04a6(0xdf)),constants_1=require(a362_0xea04a6(0xd7)),salesforce_service_1=require(a362_0xea04a6(0xa0)),status_enums_1=require(a362_0xea04a6(0xc8)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require(a362_0xea04a6(0xa5)),type_and_name_veeva_component_retriever_1=require(a362_0xea04a6(0xc9)),type_veeva_component_retriever_1=require(a362_0xea04a6(0x117)),sync_1=require('csv-parse/sync'),sync_2=require(a362_0xea04a6(0xb4)),veeva_constants_1=require(a362_0xea04a6(0xc4)),path_1=__importDefault(require(a362_0xea04a6(0x111)));class SnapshotService{constructor(_0x849844,_0x195920,_0x5b28cf,_0x2133af){const _0x498ae5=a362_0xea04a6;this['_connectionSalesforce']=_0x195920,this[_0x498ae5(0xeb)]=_0x5b28cf,this[_0x498ae5(0xba)]=_0x2133af,this[_0x498ae5(0xde)]=_0x849844[_0x498ae5(0x118)],this['_metadataLogId']=_0x849844[_0x498ae5(0x116)],this['_attachmentLogId']=_0x849844[_0x498ae5(0xed)],this['_timeZone']=_0x849844[_0x498ae5(0xa2)],this[_0x498ae5(0x102)]=_0x849844['selectedMetaTypes'],this[_0x498ae5(0xc0)]=_0x849844[_0x498ae5(0xb6)],this['_veevaService']=new veeva_service_1['VeevaService']({'connection':this[_0x498ae5(0xeb)],'logger':this[_0x498ae5(0xba)]}),this[_0x498ae5(0xca)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x498ae5(0xd8)]}),this[_0x498ae5(0xad)]=new package_export_service_1[(_0x498ae5(0xb7))]({'veevaService':this['_veevaService'],'connection':this[_0x498ae5(0xeb)],'logger':this[_0x498ae5(0xba)]});}async[a362_0xea04a6(0xa6)](){const _0x1f76bc=a362_0xea04a6;try{this[_0x1f76bc(0xba)][_0x1f76bc(0xe2)]('Snapshot\x20started.');const _0x59af5a=await this[_0x1f76bc(0xf4)]();await this[_0x1f76bc(0xba)]['updateLog']();const _0x278785=await this[_0x1f76bc(0xad)][_0x1f76bc(0xcf)](_0x59af5a,SnapshotService[_0x1f76bc(0xbc)]);await this['_logger'][_0x1f76bc(0xa1)]();const _0xc2bfb3=await this[_0x1f76bc(0xe8)](_0x59af5a,_0x278785);await this[_0x1f76bc(0xaf)](_0xc2bfb3),await this[_0x1f76bc(0xba)][_0x1f76bc(0xa1)](),await this[_0x1f76bc(0x105)](!![]);}catch(_0x50cf63){this[_0x1f76bc(0xba)][_0x1f76bc(0xd0)](_0x50cf63),await this[_0x1f76bc(0x105)](![])[_0x1f76bc(0xc6)](_0x162f5a=>this[_0x1f76bc(0xe9)][_0x1f76bc(0xb0)](_0x162f5a));}}async[a362_0xea04a6(0xf4)](){const _0x1222a2=a362_0xea04a6,_0x51917a={'veevaService':this[_0x1222a2(0x11a)],'logger':this[_0x1222a2(0xba)]},_0x52972b=Array['from'](Object[_0x1222a2(0xb2)](this[_0x1222a2(0xc0)]))[_0x1222a2(0x11c)]?new type_and_name_veeva_component_retriever_1[(_0x1222a2(0x10e))]({'value':this[_0x1222a2(0xc0)],..._0x51917a}):new type_veeva_component_retriever_1[(_0x1222a2(0x10d))]({'value':this[_0x1222a2(0x102)],..._0x51917a});return _0x52972b[_0x1222a2(0xaa)]();}async['createMetadataItemListWithBody'](_0x23030c,_0x25bebf){const _0x4fdcbe=a362_0xea04a6;var _0x32816b,_0x5e6526;this[_0x4fdcbe(0xba)]['log'](_0x4fdcbe(0xab));const _0x30f403=this[_0x4fdcbe(0xb3)](_0x23030c),_0x3605c2=_0x30f403['reduce']((_0x45c94b,_0x4981dc)=>_0x45c94b['set'](_0x4981dc[_0x4fdcbe(0xbe)],_0x4981dc),new Map());for(const _0x4c55c0 of _0x25bebf){for(const _0x30f1b1 in _0x4c55c0[_0x4fdcbe(0xe5)]){const {base:_0x1d8a24,name:_0x172ff2,dir:_0x4e57ba}=path_1['default']['parse'](_0x30f1b1),_0x7ac203=_0x172ff2+veeva_constants_1[_0x4fdcbe(0xf9)][_0x4fdcbe(0x113)];if(_0x3605c2[_0x4fdcbe(0xd1)](_0x1d8a24)){const _0x245284=await((_0x32816b=_0x4c55c0[_0x4fdcbe(0x10f)](path_1[_0x4fdcbe(0xf6)][_0x4fdcbe(0xb8)](_0x4e57ba,_0x1d8a24)))===null||_0x32816b===void 0x0?void 0x0:_0x32816b[_0x4fdcbe(0xf8)]('string')),_0x3e0109=await((_0x5e6526=_0x4c55c0[_0x4fdcbe(0x10f)](path_1[_0x4fdcbe(0xf6)]['join'](_0x4e57ba,_0x7ac203)))===null||_0x5e6526===void 0x0?void 0x0:_0x5e6526[_0x4fdcbe(0xf8)](_0x4fdcbe(0xd9)));if(_0x245284&&_0x3e0109){const _0x374883=new jszip_1[(_0x4fdcbe(0xf6))]();_0x374883[_0x4fdcbe(0x10f)](_0x1d8a24,_0x245284),_0x374883[_0x4fdcbe(0x10f)](_0x7ac203,this['transformDependencyFile'](_0x3e0109)),_0x3605c2[_0x4fdcbe(0xbb)](_0x1d8a24)[_0x4fdcbe(0xdd)]=await _0x374883[_0x4fdcbe(0xf1)]({'type':_0x4fdcbe(0xa7)});}}}}return _0x30f403['filter'](_0x590056=>!_0x590056['body'])['forEach'](_0x1aceb6=>{const _0x59287b=_0x4fdcbe;this[_0x59287b(0xba)][_0x59287b(0xe2)](_0x59287b(0xf5)+_0x1aceb6[_0x59287b(0xf0)]+'.'+_0x1aceb6[_0x59287b(0xc1)]+'\x20from\x20outbound\x20package');}),_0x30f403[_0x4fdcbe(0xef)](_0x1e36c0=>_0x1e36c0[_0x4fdcbe(0xdd)]);}[a362_0xea04a6(0xae)](_0x4e43bf){const _0x32d1b1=a362_0xea04a6,_0x30ded7=(0x0,sync_1['parse'])(_0x4e43bf,{'columns':!![],'skip_empty_lines':!![]}),_0x1fe6c7=_0x30ded7[_0x32d1b1(0xf7)](({'In\x20Package':_0x16c7f1,..._0x50ee66})=>_0x50ee66);return(0x0,sync_2['stringify'])(_0x1fe6c7,{'header':!![]});}[a362_0xea04a6(0xb3)](_0x5d1981){const _0x237123=a362_0xea04a6;return _0x5d1981[_0x237123(0xf7)](_0x158ac0=>{const _0x5c2ae0=_0x237123,_0x1718e6=new metadata_item_dto_1['MetadataItemDto']();return _0x1718e6['name']=_0x158ac0[_0x5c2ae0(0xc1)],_0x1718e6['apiName']=_0x158ac0[_0x5c2ae0(0xc1)],_0x1718e6[_0x5c2ae0(0x118)]=this['_snapshotId'],_0x1718e6[_0x5c2ae0(0xbe)]=_0x158ac0[_0x5c2ae0(0x103)]+'.'+_0x158ac0[_0x5c2ae0(0xc1)]+veeva_constants_1[_0x5c2ae0(0xf9)][_0x5c2ae0(0xcc)],_0x1718e6[_0x5c2ae0(0xf0)]=_0x158ac0[_0x5c2ae0(0x103)],_0x1718e6[_0x5c2ae0(0xfa)]=_0x158ac0['lastModifiedDate'],_0x1718e6['isRetrieved']=![],_0x1718e6;});}async['saveComponentsInSalesforce'](_0x45303d){const _0x5b2a2f=a362_0xea04a6;this['_logger'][_0x5b2a2f(0xe2)]('Saving\x20Attachments.'),await this['saveAttachments'](_0x45303d),this['_logger'][_0x5b2a2f(0xe2)](_0x5b2a2f(0xd3)+_0x45303d['length']+'\x20Metadata\x20Items');const _0x74eaa2=_0x45303d[_0x5b2a2f(0xf7)](_0x19baff=>{const _0x55888c=_0x5b2a2f;return{[constants_1['FLOSUM_NAMESPACE']+_0x55888c(0xf2)]:_0x19baff[_0x55888c(0xc1)],[constants_1['FLOSUM_NAMESPACE']+_0x55888c(0x106)]:_0x19baff[_0x55888c(0xe0)],[constants_1['FLOSUM_NAMESPACE']+_0x55888c(0xec)]:_0x19baff[_0x55888c(0x118)],[constants_1[_0x55888c(0x119)]+_0x55888c(0xe3)]:_0x19baff[_0x55888c(0xbe)],[constants_1['FLOSUM_NAMESPACE']+_0x55888c(0xdb)]:_0x19baff[_0x55888c(0x115)],[constants_1[_0x55888c(0x119)]+_0x55888c(0xb9)]:_0x19baff[_0x55888c(0xf0)],[constants_1[_0x55888c(0x119)]+'Attachment_ID__c']:_0x19baff[_0x55888c(0xc3)],[constants_1['FLOSUM_NAMESPACE']+_0x55888c(0xd4)]:_0x19baff[_0x55888c(0xfa)]};}),_0x5b59a5=await this[_0x5b2a2f(0xca)][_0x5b2a2f(0x110)](constants_1['FLOSUM_NAMESPACE']+_0x5b2a2f(0xbd),_0x74eaa2);let _0x3be2c0=!![];_0x5b59a5[_0x5b2a2f(0x101)]((_0x421f88,_0x3f4043)=>{const _0x8c858f=_0x5b2a2f;this['_logger'][_0x8c858f(0xe2)](_0x8c858f(0xd3)+_0x45303d[_0x3f4043][_0x8c858f(0xf0)]+'.'+_0x45303d[_0x3f4043]['name']);if(!_0x421f88[_0x8c858f(0xcd)]){_0x3be2c0=![];const _0x38c356=new salesforce_dml_error_1[(_0x8c858f(0x10c))](_0x421f88[_0x8c858f(0xe4)]);this[_0x8c858f(0xba)][_0x8c858f(0xd0)](_0x38c356);}});if(!_0x3be2c0)throw new Error(_0x5b2a2f(0xd6));}async[a362_0xea04a6(0xfc)](_0x5eb929){const _0x3b95c2=a362_0xea04a6,_0x3fc572=this[_0x3b95c2(0xce)](_0x5eb929),_0x19a9b2=await this[_0x3b95c2(0xca)][_0x3b95c2(0x110)](SnapshotService[_0x3b95c2(0xda)],_0x3fc572),_0x44d857=[];_0x19a9b2[_0x3b95c2(0x101)]((_0x38067f,_0x1f5b8f)=>{const _0x1019f1=_0x3b95c2;_0x38067f[_0x1019f1(0xcd)]?(_0x5eb929[_0x1f5b8f][_0x1019f1(0xc3)]=_0x38067f['id'],_0x5eb929[_0x1f5b8f]['isRetrieved']=!![]):_0x44d857['push'](..._0x38067f[_0x1019f1(0xe4)]);});if(_0x44d857['length'])throw new salesforce_dml_error_1[(_0x3b95c2(0x10c))](_0x44d857);}[a362_0xea04a6(0xce)](_0x3a0328){const _0x8de222=a362_0xea04a6;return _0x3a0328['map'](_0x2c9cb5=>({'ParentId':this[_0x8de222(0xde)],'Name':_0x2c9cb5['veevaComponentType'],'ContentType':_0x8de222(0xc5),'Body':_0x2c9cb5[_0x8de222(0xdd)],'Description':_0x2c9cb5['veevaComponentType']}));}async[a362_0xea04a6(0x105)](_0x174c05){const _0x47158e=a362_0xea04a6,_0x56fe33={[constants_1[_0x47158e(0x119)]+_0x47158e(0x100)]:!![],[constants_1[_0x47158e(0x119)]+_0x47158e(0x11b)]:!_0x174c05},_0x1f3c37={[constants_1[_0x47158e(0x119)]+'Is_Error__c']:!_0x174c05,[constants_1[_0x47158e(0x119)]+_0x47158e(0xf3)]:_0x174c05,[constants_1['FLOSUM_NAMESPACE']+_0x47158e(0xd5)]:_0x174c05?status_enums_1[_0x47158e(0xe1)]['COMPLETED']:status_enums_1['MetadataLogStatus'][_0x47158e(0xb1)],[constants_1[_0x47158e(0x119)]+_0x47158e(0x112)]:!![]};await this[_0x47158e(0xd8)][_0x47158e(0xcb)](flosum_constants_1[_0x47158e(0x104)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x47158e(0x119)]+_0x47158e(0xfd)+this[_0x47158e(0xde)],_0x56fe33),await this[_0x47158e(0xd8)]['patch'](flosum_constants_1[_0x47158e(0x104)][_0x47158e(0xc2)]+'/'+constants_1[_0x47158e(0x119)]+_0x47158e(0x109)+this['_metadataLogId'],_0x1f3c37),this[_0x47158e(0xba)][_0x47158e(0xe2)]('Snapshot\x20completed\x20'+(_0x174c05?'successfully':_0x47158e(0xa4))+'.'),await this['_logger'][_0x47158e(0xa1)]();}}exports['SnapshotService']=SnapshotService,SnapshotService['OUTBOUND_PACKAGE_NAME']=a362_0xea04a6(0x11d),SnapshotService[a362_0xea04a6(0xda)]=a362_0xea04a6(0xff);