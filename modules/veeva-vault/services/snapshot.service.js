const a363_0x3d0e86=a363_0x2268;(function(_0x3ecd72,_0x29dd62){const _0x5cdc83=a363_0x2268,_0x3f4614=_0x3ecd72();while(!![]){try{const _0x29641b=parseInt(_0x5cdc83(0x198))/0x1+parseInt(_0x5cdc83(0x173))/0x2*(parseInt(_0x5cdc83(0x172))/0x3)+parseInt(_0x5cdc83(0x177))/0x4*(-parseInt(_0x5cdc83(0x1d5))/0x5)+parseInt(_0x5cdc83(0x192))/0x6*(parseInt(_0x5cdc83(0x1c8))/0x7)+parseInt(_0x5cdc83(0x182))/0x8*(parseInt(_0x5cdc83(0x1c1))/0x9)+-parseInt(_0x5cdc83(0x1c2))/0xa+-parseInt(_0x5cdc83(0x1bb))/0xb;if(_0x29641b===_0x29dd62)break;else _0x3f4614['push'](_0x3f4614['shift']());}catch(_0x1792ef){_0x3f4614['push'](_0x3f4614['shift']());}}}(a363_0x1683,0xbfb9f));const a363_0x19d8d6=(function(){let _0x53b4b7=!![];return function(_0x18f26b,_0x3160bb){const _0x171602=_0x53b4b7?function(){const _0x5c0a41=a363_0x2268;if(_0x3160bb){const _0x3ae239=_0x3160bb[_0x5c0a41(0x191)](_0x18f26b,arguments);return _0x3160bb=null,_0x3ae239;}}:function(){};return _0x53b4b7=![],_0x171602;};}()),a363_0x1bb477=a363_0x19d8d6(this,function(){const _0x28532a=a363_0x2268;return a363_0x1bb477['toString']()[_0x28532a(0x1de)](_0x28532a(0x171))['toString']()['constructor'](a363_0x1bb477)[_0x28532a(0x1de)](_0x28532a(0x171));});a363_0x1bb477();'use strict';var __importDefault=this&&this[a363_0x3d0e86(0x1ad)]||function(_0x3ae1e5){return _0x3ae1e5&&_0x3ae1e5['__esModule']?_0x3ae1e5:{'default':_0x3ae1e5};};Object[a363_0x3d0e86(0x1b8)](exports,'__esModule',{'value':!![]}),exports[a363_0x3d0e86(0x1b6)]=void 0x0;const jszip_1=__importDefault(require(a363_0x3d0e86(0x1a7))),flosum_constants_1=require(a363_0x3d0e86(0x19d)),veeva_service_1=require(a363_0x3d0e86(0x197)),metadata_item_dto_1=require(a363_0x3d0e86(0x1cd)),constants_1=require(a363_0x3d0e86(0x1d8)),salesforce_service_1=require(a363_0x3d0e86(0x1a1)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a363_0x3d0e86(0x183)),package_export_service_1=require(a363_0x3d0e86(0x1c7)),type_and_name_veeva_component_retriever_1=require(a363_0x3d0e86(0x1ba)),type_veeva_component_retriever_1=require(a363_0x3d0e86(0x17c)),sync_1=require(a363_0x3d0e86(0x179)),sync_2=require(a363_0x3d0e86(0x19f)),veeva_constants_1=require(a363_0x3d0e86(0x18e)),path_1=__importDefault(require(a363_0x3d0e86(0x1ac)));function a363_0x2268(_0x4ebe5d,_0x202537){const _0x460450=a363_0x1683();return a363_0x2268=function(_0x1bb477,_0x19d8d6){_0x1bb477=_0x1bb477-0x16b;let _0x1683c1=_0x460450[_0x1bb477];return _0x1683c1;},a363_0x2268(_0x4ebe5d,_0x202537);}class SnapshotService{constructor({snapshotId:_0x4f935b,metadataLogId:_0xd0c34e,selectedMetaTypes:_0x50512e,selectedComponentMap:_0x11752b,whereClause:_0x3a2ab3},_0x30210d,_0x21b03c,_0x1eb94d){const _0x336469=a363_0x3d0e86;this[_0x336469(0x1c0)]=_0x30210d,this[_0x336469(0x188)]=_0x21b03c,this[_0x336469(0x1dd)]=_0x1eb94d,this['_snapshotId']=_0x4f935b,this['_metadataLogId']=_0xd0c34e,this['_selectedMetaTypes']=_0x50512e,this[_0x336469(0x1ca)]=_0x11752b,this[_0x336469(0x1e7)]=_0x3a2ab3,this['_veevaService']=new veeva_service_1['VeevaService']({'connection':this[_0x336469(0x188)],'logger':this[_0x336469(0x1dd)]}),this[_0x336469(0x190)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x336469(0x1c0)]}),this['_packageExportService']=new package_export_service_1['PackageExportService']({'veevaService':this[_0x336469(0x1d6)],'connection':this['_connectionVeeva'],'logger':this[_0x336469(0x1dd)]});}async[a363_0x3d0e86(0x16f)](){const _0x5219e3=a363_0x3d0e86;try{this['_logger'][_0x5219e3(0x180)](_0x5219e3(0x19a));const _0x5796a2=await this['retrieveVeevaComponents']();await this[_0x5219e3(0x1dd)][_0x5219e3(0x189)]();const _0x2abdb9=await this['_packageExportService']['export'](_0x5796a2,SnapshotService[_0x5219e3(0x1b5)]);await this[_0x5219e3(0x1dd)][_0x5219e3(0x189)]();const _0x20e388=await this['createMetadataItemListWithBody'](_0x5796a2,_0x2abdb9);await this[_0x5219e3(0x1be)](_0x20e388),await this[_0x5219e3(0x1dd)][_0x5219e3(0x189)](),await this[_0x5219e3(0x1b2)](!![]);}catch(_0x3b433d){this['_logger'][_0x5219e3(0x1db)](_0x3b433d),await this[_0x5219e3(0x1b2)](![])[_0x5219e3(0x1aa)](_0xa97a99=>this['_systemLogger'][_0x5219e3(0x193)](_0xa97a99));}}async[a363_0x3d0e86(0x1da)](){const _0x5065c8=a363_0x3d0e86,_0x27e237={'veevaService':this[_0x5065c8(0x1d6)],'logger':this[_0x5065c8(0x1dd)]},_0x5a9e43=Array['from'](Object[_0x5065c8(0x16d)](this[_0x5065c8(0x1ca)]))[_0x5065c8(0x16e)]?new type_and_name_veeva_component_retriever_1[(_0x5065c8(0x1e3))]({'value':this[_0x5065c8(0x1ca)],..._0x27e237}):new type_veeva_component_retriever_1[(_0x5065c8(0x1a9))]({'value':this['_selectedMetaTypes'],'whereClause':this[_0x5065c8(0x1e7)],..._0x27e237});return _0x5a9e43[_0x5065c8(0x1b0)]();}async[a363_0x3d0e86(0x1c3)](_0x4b34d7,_0x589bbd){const _0x520680=a363_0x3d0e86;var _0x1517e0,_0x383f3b;this[_0x520680(0x1dd)][_0x520680(0x180)](_0x520680(0x19e));const _0xbacf6d=this['formMetadataItemDtoList'](_0x4b34d7),_0x1b764f=_0xbacf6d[_0x520680(0x1b9)]((_0x56411d,_0x3b024d)=>_0x56411d[_0x520680(0x1e6)](_0x3b024d[_0x520680(0x1d3)],_0x3b024d),new Map());for(const _0x3525e9 of _0x589bbd){for(const _0x3a73be in _0x3525e9['files']){const {base:_0x27feda,name:_0x217751,dir:_0x4858cc}=path_1[_0x520680(0x1c6)][_0x520680(0x1a5)](_0x3a73be),_0x5eb9cc=_0x217751+veeva_constants_1['VeevaConstants']['DEPENDENCY_EXTENSION'];if(_0x1b764f[_0x520680(0x18d)](_0x27feda)){const _0x34b59a=await((_0x1517e0=_0x3525e9[_0x520680(0x175)]([_0x4858cc,_0x27feda]['join'](path_1[_0x520680(0x1c6)][_0x520680(0x17e)][_0x520680(0x184)])))===null||_0x1517e0===void 0x0?void 0x0:_0x1517e0[_0x520680(0x1a2)](_0x520680(0x1e2))),_0x100430=await((_0x383f3b=_0x3525e9[_0x520680(0x175)]([_0x4858cc,_0x5eb9cc][_0x520680(0x195)](path_1[_0x520680(0x1c6)][_0x520680(0x17e)][_0x520680(0x184)])))===null||_0x383f3b===void 0x0?void 0x0:_0x383f3b['async'](_0x520680(0x1e2)));if(_0x34b59a){const _0x1f2e17=new jszip_1[(_0x520680(0x1c6))]();_0x1f2e17[_0x520680(0x175)](_0x27feda,_0x34b59a),_0x100430&&_0x1f2e17[_0x520680(0x175)](_0x5eb9cc,this[_0x520680(0x181)](_0x100430)),_0x1b764f[_0x520680(0x18c)](_0x27feda)['body']=await _0x1f2e17[_0x520680(0x1df)]({'type':_0x520680(0x1a0)});}}}}return _0xbacf6d[_0x520680(0x16b)](_0x368c3a=>!_0x368c3a[_0x520680(0x16c)])[_0x520680(0x1af)](_0x32ec4e=>{const _0x3e4682=_0x520680;this[_0x3e4682(0x1dd)][_0x3e4682(0x180)](_0x3e4682(0x1b3)+_0x32ec4e['veevaComponentType']+'.'+_0x32ec4e[_0x3e4682(0x1a6)]+_0x3e4682(0x1d0));}),_0xbacf6d['filter'](_0x2b998e=>_0x2b998e['body']);}['transformDependencyFile'](_0x31e57c){const _0x21c29f=a363_0x3d0e86,_0x2ffae6=(0x0,sync_1[_0x21c29f(0x1a5)])(_0x31e57c,{'columns':!![],'skip_empty_lines':!![]}),_0x34476f=_0x2ffae6[_0x21c29f(0x1cf)](({'In\x20Package':_0x317b30,..._0x3dd056})=>_0x3dd056);return(0x0,sync_2[_0x21c29f(0x1dc)])(_0x34476f,{'header':!![]});}[a363_0x3d0e86(0x176)](_0x308b87){const _0x40705f=a363_0x3d0e86;return _0x308b87[_0x40705f(0x1cf)](_0x95651a=>{const _0x2a7dc4=_0x40705f,_0x4419a1=new metadata_item_dto_1[(_0x2a7dc4(0x19b))]();return _0x4419a1[_0x2a7dc4(0x1a6)]=_0x95651a['name'],_0x4419a1[_0x2a7dc4(0x1b7)]=_0x95651a['name'],_0x4419a1[_0x2a7dc4(0x17b)]=this[_0x2a7dc4(0x18b)],_0x4419a1[_0x2a7dc4(0x1d3)]=_0x95651a['type']+'.'+_0x95651a[_0x2a7dc4(0x1a6)]+veeva_constants_1[_0x2a7dc4(0x1bc)][_0x2a7dc4(0x18f)],_0x4419a1['veevaComponentType']=_0x95651a[_0x2a7dc4(0x1d2)],_0x4419a1[_0x2a7dc4(0x1c4)]=_0x95651a[_0x2a7dc4(0x1c4)],_0x4419a1[_0x2a7dc4(0x1e1)]=![],_0x4419a1;});}async[a363_0x3d0e86(0x1be)](_0x44853e){const _0x1ef505=a363_0x3d0e86;this[_0x1ef505(0x1dd)][_0x1ef505(0x180)](_0x1ef505(0x17f)),await this['saveAttachments'](_0x44853e),this[_0x1ef505(0x1dd)][_0x1ef505(0x180)](_0x1ef505(0x1e5)+_0x44853e[_0x1ef505(0x16e)]+_0x1ef505(0x1b1));const _0x13df72=_0x44853e[_0x1ef505(0x1cf)](_0xd2a72=>{const _0x2269c4=_0x1ef505;return{[constants_1[_0x2269c4(0x1e0)]+'Name__c']:_0xd2a72[_0x2269c4(0x1a6)],[constants_1[_0x2269c4(0x1e0)]+'API_Name__c']:_0xd2a72[_0x2269c4(0x1b7)],[constants_1[_0x2269c4(0x1e0)]+_0x2269c4(0x174)]:_0xd2a72[_0x2269c4(0x17b)],[constants_1[_0x2269c4(0x1e0)]+'Label__c']:_0xd2a72[_0x2269c4(0x1d3)],[constants_1[_0x2269c4(0x1e0)]+'Is_Retrieved__c']:_0xd2a72[_0x2269c4(0x1e1)],[constants_1[_0x2269c4(0x1e0)]+_0x2269c4(0x1b4)]:_0xd2a72['veevaComponentType'],[constants_1['FLOSUM_NAMESPACE']+_0x2269c4(0x1ce)]:_0xd2a72[_0x2269c4(0x1a3)],[constants_1[_0x2269c4(0x1e0)]+'Last_Modified_Date__c']:_0xd2a72[_0x2269c4(0x1c4)]};}),_0x5ea84e=await this[_0x1ef505(0x190)][_0x1ef505(0x1c5)](constants_1['FLOSUM_NAMESPACE']+'Metadata_Item__c',_0x13df72);let _0x508a3c=!![];_0x5ea84e['forEach']((_0x4ad36b,_0x148c9a)=>{const _0x600f9e=_0x1ef505;this['_logger'][_0x600f9e(0x180)](_0x600f9e(0x1e5)+_0x44853e[_0x148c9a][_0x600f9e(0x1d1)]+'.'+_0x44853e[_0x148c9a][_0x600f9e(0x1a6)]);if(!_0x4ad36b[_0x600f9e(0x1a8)]){_0x508a3c=![];const _0x420088=new salesforce_dml_error_1[(_0x600f9e(0x1bf))](_0x4ad36b[_0x600f9e(0x199)]);this['_logger'][_0x600f9e(0x1db)](_0x420088);}});if(!_0x508a3c)throw new Error(_0x1ef505(0x187));}async[a363_0x3d0e86(0x194)](_0x47a3ae){const _0x30d4f4=a363_0x3d0e86,_0x148eb7=this[_0x30d4f4(0x196)](_0x47a3ae),_0x237ed4=await this[_0x30d4f4(0x190)][_0x30d4f4(0x1c5)](SnapshotService[_0x30d4f4(0x1cb)],_0x148eb7),_0x20635=[];_0x237ed4['forEach']((_0x26c821,_0x56497d)=>{const _0x2c5989=_0x30d4f4;_0x26c821[_0x2c5989(0x1a8)]?(_0x47a3ae[_0x56497d][_0x2c5989(0x1a3)]=_0x26c821['id'],_0x47a3ae[_0x56497d][_0x2c5989(0x1e1)]=!![]):_0x20635[_0x2c5989(0x186)](..._0x26c821['errors']);});if(_0x20635[_0x30d4f4(0x16e)])throw new salesforce_dml_error_1[(_0x30d4f4(0x1bf))](_0x20635);}[a363_0x3d0e86(0x196)](_0x3f3416){const _0x17d0d8=a363_0x3d0e86;return _0x3f3416['map'](_0x50fcf0=>({'ParentId':this[_0x17d0d8(0x18b)],'Name':_0x50fcf0[_0x17d0d8(0x1d1)],'ContentType':_0x17d0d8(0x185),'Body':_0x50fcf0['body'],'Description':_0x50fcf0[_0x17d0d8(0x1d1)]}));}async[a363_0x3d0e86(0x1b2)](_0xc5a9a6){const _0x488e30=a363_0x3d0e86,_0x5bc8ae={[constants_1['FLOSUM_NAMESPACE']+_0x488e30(0x18a)]:!![],[constants_1['FLOSUM_NAMESPACE']+_0x488e30(0x1a4)]:!_0xc5a9a6},_0x445ad0={[constants_1['FLOSUM_NAMESPACE']+_0x488e30(0x1a4)]:!_0xc5a9a6,[constants_1[_0x488e30(0x1e0)]+_0x488e30(0x1d4)]:_0xc5a9a6,[constants_1['FLOSUM_NAMESPACE']+'Status__c']:_0xc5a9a6?status_enums_1[_0x488e30(0x1ae)][_0x488e30(0x17d)]:status_enums_1[_0x488e30(0x1ae)][_0x488e30(0x17a)],[constants_1[_0x488e30(0x1e0)]+_0x488e30(0x19c)]:!![]};await this[_0x488e30(0x1c0)][_0x488e30(0x1cc)](flosum_constants_1[_0x488e30(0x1bd)][_0x488e30(0x170)]+'/'+constants_1[_0x488e30(0x1e0)]+'Snapshot__c/'+this['_snapshotId'],_0x5bc8ae),await this['_connectionSalesforce'][_0x488e30(0x1cc)](flosum_constants_1[_0x488e30(0x1bd)][_0x488e30(0x170)]+'/'+constants_1[_0x488e30(0x1e0)]+'Metadata_Log__c/'+this[_0x488e30(0x1e4)],_0x445ad0),this[_0x488e30(0x1dd)][_0x488e30(0x180)](_0x488e30(0x1c9)+(_0xc5a9a6?_0x488e30(0x1d7):_0x488e30(0x1d9))+'.'),await this['_logger'][_0x488e30(0x189)]();}}exports[a363_0x3d0e86(0x1b6)]=SnapshotService,SnapshotService[a363_0x3d0e86(0x1b5)]=a363_0x3d0e86(0x178),SnapshotService[a363_0x3d0e86(0x1cb)]=a363_0x3d0e86(0x1ab);function a363_0x1683(){const _0x74cc16=['catch','Attachment','path','__importDefault','MetadataLogStatus','forEach','retrieve','\x20Metadata\x20Items','finishSnapshot','Cannot\x20retrieve\x20','Veeva_Component_Type__c','OUTBOUND_PACKAGE_NAME','SnapshotService','apiName','defineProperty','reduce','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','1016345PGnVcj','VeevaConstants','FlosumConstants','saveComponentsInSalesforce','SalesforceDmlError','_connectionSalesforce','324fJjkAi','8095020uZGppz','createMetadataItemListWithBody','lastModifiedDate','insertMultipleRecords','default','./package-export.service','10396491AuYUwj','Snapshot\x20completed\x20','_selectedComponentMap','ATTACHMENT','patch','../dtos/metadata-item.dto','Attachment_ID__c','map','\x20from\x20outbound\x20package','veevaComponentType','type','label','Succeed__c','15yYUSft','_veevaService','successfully','../../../constants','with\x20error','retrieveVeevaComponents','logError','stringify','_logger','search','generateAsync','FLOSUM_NAMESPACE','isRetrieved','string','TypeAndNameVeevaComponentRetriever','_metadataLogId','Saving\x20','set','_whereClause','filter','body','values','length','execute','ENDPOINT_UPSERT_RECORD','(((.+)+)+)+$','12zTjFId','215098hAcLIu','Snapshot__c','file','formMetadataItemDtoList','2040124rTNrKX','Snapshot','csv-parse/sync','EXCEPTION','snapshotId','../classes/retrievers/veeva-components/type.veeva-component.retriever','COMPLETED','posix','Saving\x20Attachments.','log','transformDependencyFile','42632mwHaaW','../classes/errors/salesforce-dml-error','sep','application/zip','push','Cannot\x20Save\x20Metadata\x20Items','_connectionVeeva','updateLog','Is_Completed__c','_snapshotId','get','has','../constants/veeva.constants','MDL_EXTENSION','_salesforceService','apply','6EDsBrp','error','saveAttachments','join','formAttachments','./veeva.service','1110048DwaTpM','errors','Snapshot\x20started.','MetadataItemDto','Job_Completed__c','../constants/flosum.constants','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','csv-stringify/sync','base64','./salesforce.service','async','attachmentId','Is_Error__c','parse','name','jszip','success','TypeVeevaComponentRetriever'];a363_0x1683=function(){return _0x74cc16;};return a363_0x1683();}