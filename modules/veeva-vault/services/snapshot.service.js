const a339_0x43590a=a339_0x1c61;(function(_0x4a77cb,_0x414487){const _0x4af5e3=a339_0x1c61,_0x2cf36e=_0x4a77cb();while(!![]){try{const _0x492fc8=parseInt(_0x4af5e3(0x1ae))/0x1+parseInt(_0x4af5e3(0x154))/0x2*(-parseInt(_0x4af5e3(0x170))/0x3)+parseInt(_0x4af5e3(0x190))/0x4+-parseInt(_0x4af5e3(0x17a))/0x5+parseInt(_0x4af5e3(0x18b))/0x6*(parseInt(_0x4af5e3(0x1a7))/0x7)+-parseInt(_0x4af5e3(0x15a))/0x8*(parseInt(_0x4af5e3(0x1b1))/0x9)+parseInt(_0x4af5e3(0x148))/0xa;if(_0x492fc8===_0x414487)break;else _0x2cf36e['push'](_0x2cf36e['shift']());}catch(_0x3a6af8){_0x2cf36e['push'](_0x2cf36e['shift']());}}}(a339_0x4d32,0xce24a));const a339_0xaf0e44=(function(){let _0x15c4c3=!![];return function(_0x59ce72,_0x2404b2){const _0x429fd8=_0x15c4c3?function(){const _0x4be0d1=a339_0x1c61;if(_0x2404b2){const _0x1649bf=_0x2404b2[_0x4be0d1(0x14e)](_0x59ce72,arguments);return _0x2404b2=null,_0x1649bf;}}:function(){};return _0x15c4c3=![],_0x429fd8;};}()),a339_0x5dde3f=a339_0xaf0e44(this,function(){const _0x2af739=a339_0x1c61;return a339_0x5dde3f['toString']()[_0x2af739(0x17d)](_0x2af739(0x17c))['toString']()[_0x2af739(0x18f)](a339_0x5dde3f)[_0x2af739(0x17d)](_0x2af739(0x17c));});a339_0x5dde3f();'use strict';var __importDefault=this&&this[a339_0x43590a(0x186)]||function(_0x2e2d17){return _0x2e2d17&&_0x2e2d17['__esModule']?_0x2e2d17:{'default':_0x2e2d17};};Object[a339_0x43590a(0x152)](exports,'__esModule',{'value':!![]}),exports[a339_0x43590a(0x1a9)]=void 0x0;const jszip_1=__importDefault(require('jszip')),flosum_constants_1=require(a339_0x43590a(0x185)),veeva_service_1=require(a339_0x43590a(0x1b6)),metadata_item_dto_1=require(a339_0x43590a(0x157)),constants_1=require(a339_0x43590a(0x1b3)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a339_0x43590a(0x16f)),package_export_service_1=require(a339_0x43590a(0x156)),type_and_name_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever'),type_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type.veeva-component.retriever');class SnapshotService{constructor(_0x3b90d9,_0xf07bf3,_0x298c07,_0x260f1d){const _0x2958ba=a339_0x43590a;this[_0x2958ba(0x18a)]=_0xf07bf3,this[_0x2958ba(0x1a0)]=_0x298c07,this['_logger']=_0x260f1d,this['_snapshotId']=_0x3b90d9[_0x2958ba(0x16b)],this['_metadataLogId']=_0x3b90d9[_0x2958ba(0x1a3)],this['_attachmentLogId']=_0x3b90d9[_0x2958ba(0x16e)],this[_0x2958ba(0x143)]=_0x3b90d9['timeZone'],this[_0x2958ba(0x165)]=_0x3b90d9[_0x2958ba(0x19e)],this[_0x2958ba(0x178)]=_0x3b90d9[_0x2958ba(0x150)],this[_0x2958ba(0x13f)]=new veeva_service_1[(_0x2958ba(0x162))]({'connection':this[_0x2958ba(0x1a0)],'logger':this['_logger']}),this[_0x2958ba(0x15e)]=new salesforce_service_1[(_0x2958ba(0x17b))]({'connection':this[_0x2958ba(0x18a)]}),this[_0x2958ba(0x14f)]=new package_export_service_1[(_0x2958ba(0x149))]({'veevaService':this['_veevaService'],'connection':this[_0x2958ba(0x1a0)],'logger':this[_0x2958ba(0x1ab)]});}async[a339_0x43590a(0x184)](){const _0x265688=a339_0x43590a;try{this['_logger'][_0x265688(0x199)]('Snapshot\x20started.');const _0x5b1744=await this[_0x265688(0x147)]();await this[_0x265688(0x1ab)][_0x265688(0x183)]();const _0x324662=await this[_0x265688(0x14f)][_0x265688(0x17f)](_0x5b1744,SnapshotService[_0x265688(0x144)]);await this[_0x265688(0x1ab)][_0x265688(0x183)]();const _0x3ce0fc=await this['createMetadataItemListWithBody'](_0x5b1744,_0x324662);await this[_0x265688(0x142)](_0x3ce0fc),await this[_0x265688(0x1ab)][_0x265688(0x183)](),await this[_0x265688(0x17e)](!![]);}catch(_0x354aff){this[_0x265688(0x1ab)]['logError'](_0x354aff),await this[_0x265688(0x17e)](![])[_0x265688(0x166)](_0x3c0cf2=>this[_0x265688(0x141)][_0x265688(0x171)](_0x3c0cf2));}}async[a339_0x43590a(0x147)](){const _0x456bf1=a339_0x43590a,_0x217895={'veevaService':this[_0x456bf1(0x13f)],'logger':this[_0x456bf1(0x1ab)]},_0x355141=Array[_0x456bf1(0x18c)](Object[_0x456bf1(0x155)](this[_0x456bf1(0x178)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x456bf1(0x195))]({'value':this[_0x456bf1(0x178)],..._0x217895}):new type_veeva_component_retriever_1[(_0x456bf1(0x167))]({'value':this['_selectedMetaTypes'],..._0x217895});return _0x355141[_0x456bf1(0x169)]();}async[a339_0x43590a(0x14c)](_0xb87725,_0x5cbe1a){const _0x4ee888=a339_0x43590a;var _0x23340c;this[_0x4ee888(0x1ab)]['log'](_0x4ee888(0x16a));const _0x534e86=this[_0x4ee888(0x13e)](_0xb87725),_0x22f5d6=_0x534e86[_0x4ee888(0x1ad)]((_0x101488,_0xca70ae)=>_0x101488[_0x4ee888(0x15b)](_0xca70ae[_0x4ee888(0x18d)],_0xca70ae),new Map());for(const _0xed1e29 of _0x5cbe1a){for(const _0x21e242 in _0xed1e29[_0x4ee888(0x160)]){const _0x1e5792=_0x21e242[_0x4ee888(0x173)]('/')['at'](-0x1);if(_0x22f5d6[_0x4ee888(0x14d)](_0x1e5792)){const _0x47e8ef=await((_0x23340c=_0xed1e29[_0x4ee888(0x1a1)](_0x21e242))===null||_0x23340c===void 0x0?void 0x0:_0x23340c[_0x4ee888(0x181)](_0x4ee888(0x1ac)));if(_0x47e8ef){const _0x6cb447=new jszip_1[(_0x4ee888(0x151))]();_0x6cb447[_0x4ee888(0x1a1)](_0x1e5792,_0x47e8ef),_0x22f5d6[_0x4ee888(0x1b5)](_0x1e5792)['body']=await _0x6cb447[_0x4ee888(0x198)]({'type':_0x4ee888(0x172)});}}}}return _0x534e86[_0x4ee888(0x1a2)](_0x26e26d=>!_0x26e26d[_0x4ee888(0x176)])[_0x4ee888(0x175)](_0x31e198=>{const _0x2c6c59=_0x4ee888;this[_0x2c6c59(0x1ab)][_0x2c6c59(0x199)](_0x2c6c59(0x1b4)+_0x31e198['veevaComponentType']+'.'+_0x31e198[_0x2c6c59(0x1aa)]+_0x2c6c59(0x19f));}),_0x534e86['filter'](_0x30a380=>_0x30a380[_0x4ee888(0x176)]);}[a339_0x43590a(0x13e)](_0x33dd09){const _0x45717d=a339_0x43590a;return _0x33dd09[_0x45717d(0x182)](_0x5e3e34=>{const _0x26cf57=_0x45717d,_0x48c014=new metadata_item_dto_1[(_0x26cf57(0x159))]();return _0x48c014[_0x26cf57(0x1aa)]=_0x5e3e34[_0x26cf57(0x1aa)],_0x48c014[_0x26cf57(0x15f)]=_0x5e3e34[_0x26cf57(0x1aa)],_0x48c014[_0x26cf57(0x16b)]=this[_0x26cf57(0x146)],_0x48c014[_0x26cf57(0x18d)]=_0x5e3e34[_0x26cf57(0x194)]+'.'+_0x5e3e34[_0x26cf57(0x1aa)]+_0x26cf57(0x196),_0x48c014['veevaComponentType']=_0x5e3e34['type'],_0x48c014['lastModifiedDate']=_0x5e3e34[_0x26cf57(0x19b)],_0x48c014['isRetrieved']=![],_0x48c014;});}async[a339_0x43590a(0x142)](_0x1dca97){const _0x389811=a339_0x43590a;this[_0x389811(0x1ab)][_0x389811(0x199)](_0x389811(0x1a4)),await this[_0x389811(0x19d)](_0x1dca97),this[_0x389811(0x1ab)][_0x389811(0x199)]('Saving\x20'+_0x1dca97[_0x389811(0x16c)]+'\x20Metadata\x20Items');const _0x7241ac=_0x1dca97['map'](_0x497efc=>{const _0x17556f=_0x389811;return{[constants_1[_0x17556f(0x189)]+_0x17556f(0x161)]:_0x497efc['name'],[constants_1[_0x17556f(0x189)]+'API_Name__c']:_0x497efc[_0x17556f(0x15f)],[constants_1[_0x17556f(0x189)]+_0x17556f(0x1b2)]:_0x497efc[_0x17556f(0x16b)],[constants_1[_0x17556f(0x189)]+_0x17556f(0x14a)]:_0x497efc[_0x17556f(0x18d)],[constants_1[_0x17556f(0x189)]+'Is_Retrieved__c']:_0x497efc[_0x17556f(0x1a6)],[constants_1['FLOSUM_NAMESPACE']+_0x17556f(0x1a5)]:_0x497efc['veevaComponentType'],[constants_1[_0x17556f(0x189)]+_0x17556f(0x1af)]:_0x497efc[_0x17556f(0x16d)],[constants_1[_0x17556f(0x189)]+_0x17556f(0x192)]:_0x497efc[_0x17556f(0x19b)]};}),_0x57f817=await this[_0x389811(0x15e)][_0x389811(0x1b0)](constants_1['FLOSUM_NAMESPACE']+'Metadata_Item__c',_0x7241ac);let _0x413141=!![];_0x57f817['forEach']((_0x46b125,_0x24a3c5)=>{const _0x2e3378=_0x389811;this[_0x2e3378(0x1ab)][_0x2e3378(0x199)](_0x2e3378(0x19c)+_0x1dca97[_0x24a3c5]['veevaComponentType']+'.'+_0x1dca97[_0x24a3c5][_0x2e3378(0x1aa)]);if(!_0x46b125[_0x2e3378(0x191)]){_0x413141=![];const _0x5069f5=new salesforce_dml_error_1['SalesforceDmlError'](_0x46b125['errors']);this[_0x2e3378(0x1ab)][_0x2e3378(0x180)](_0x5069f5);}});if(!_0x413141)throw new Error(_0x389811(0x153));}async[a339_0x43590a(0x19d)](_0x584568){const _0x302313=a339_0x43590a,_0x3c5ea4=this[_0x302313(0x15c)](_0x584568),_0x5e3882=await this['_salesforceService']['insertMultipleRecords'](SnapshotService[_0x302313(0x174)],_0x3c5ea4),_0x54c0fe=[];_0x5e3882['forEach']((_0x39c26f,_0x23610b)=>{const _0x3c0ad8=_0x302313;_0x39c26f['success']?(_0x584568[_0x23610b]['attachmentId']=_0x39c26f['id'],_0x584568[_0x23610b][_0x3c0ad8(0x1a6)]=!![]):_0x54c0fe[_0x3c0ad8(0x188)](..._0x39c26f['errors']);});if(_0x54c0fe[_0x302313(0x16c)])throw new salesforce_dml_error_1[(_0x302313(0x193))](_0x54c0fe);}[a339_0x43590a(0x15c)](_0x43edd3){const _0x534271=a339_0x43590a;return _0x43edd3[_0x534271(0x182)](_0x41d0b4=>({'ParentId':this[_0x534271(0x146)],'Name':_0x41d0b4[_0x534271(0x163)],'ContentType':'application/zip','Body':_0x41d0b4[_0x534271(0x176)],'Description':_0x41d0b4[_0x534271(0x163)]}));}async[a339_0x43590a(0x17e)](_0x29ae2c){const _0x26ca04=a339_0x43590a,_0xf75a49={[constants_1['FLOSUM_NAMESPACE']+_0x26ca04(0x179)]:!![],[constants_1[_0x26ca04(0x189)]+_0x26ca04(0x14b)]:!_0x29ae2c},_0xa6b00a={[constants_1[_0x26ca04(0x189)]+_0x26ca04(0x14b)]:!_0x29ae2c,[constants_1[_0x26ca04(0x189)]+'Succeed__c']:_0x29ae2c,[constants_1[_0x26ca04(0x189)]+_0x26ca04(0x1a8)]:_0x29ae2c?status_enums_1[_0x26ca04(0x168)][_0x26ca04(0x18e)]:status_enums_1[_0x26ca04(0x168)][_0x26ca04(0x177)],[constants_1[_0x26ca04(0x189)]+_0x26ca04(0x164)]:!![]};await this[_0x26ca04(0x18a)][_0x26ca04(0x140)](flosum_constants_1[_0x26ca04(0x145)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x26ca04(0x189)]+_0x26ca04(0x197)+this[_0x26ca04(0x146)],_0xf75a49),await this['_connectionSalesforce'][_0x26ca04(0x140)](flosum_constants_1['FlosumConstants'][_0x26ca04(0x13d)]+'/'+constants_1[_0x26ca04(0x189)]+_0x26ca04(0x19a)+this[_0x26ca04(0x158)],_0xa6b00a),this[_0x26ca04(0x1ab)][_0x26ca04(0x199)](_0x26ca04(0x15d)+(_0x29ae2c?'successfully':'with\x20error')+'.'),await this[_0x26ca04(0x1ab)][_0x26ca04(0x183)]();}}function a339_0x1c61(_0x3357e3,_0x5d2aae){const _0x34b54d=a339_0x4d32();return a339_0x1c61=function(_0x5dde3f,_0xaf0e44){_0x5dde3f=_0x5dde3f-0x13d;let _0x4d32bf=_0x34b54d[_0x5dde3f];return _0x4d32bf;},a339_0x1c61(_0x3357e3,_0x5d2aae);}function a339_0x4d32(){const _0x127661=['Unpack\x20zip\x20and\x20create\x20metadata\x20items.','snapshotId','length','attachmentId','attachmentLogId','../classes/errors/salesforce-dml-error','14046vgUIzh','error','base64','split','ATTACHMENT','forEach','body','EXCEPTION','_selectedComponentMap','Is_Completed__c','7276425gHOVGl','SalesforceService','(((.+)+)+)+$','search','finishSnapshot','export','logError','async','map','updateLog','execute','../constants/flosum.constants','__importDefault','Attachment','push','FLOSUM_NAMESPACE','_connectionSalesforce','6eIXiUq','from','label','COMPLETED','constructor','3899676fvLGas','success','Last_Modified_Date__c','SalesforceDmlError','type','TypeAndNameVeevaComponentRetriever','.mdl','Snapshot__c/','generateAsync','log','Metadata_Log__c/','lastModifiedDate','Saving\x20','saveAttachments','selectedMetaTypes','\x20from\x20outbound\x20package','_connectionVeeva','file','filter','metadataLogId','Saving\x20Attachments.','Veeva_Component_Type__c','isRetrieved','9271577blWzlM','Status__c','SnapshotService','name','_logger','string','reduce','1661645DIbbld','Attachment_ID__c','insertMultipleRecords','18yKDavX','Snapshot__c','../../../constants','Cannot\x20retrieve\x20','get','./veeva.service','ENDPOINT_UPSERT_RECORD','formMetadataItemDtoList','_veevaService','patch','_systemLogger','saveComponentsInSalesforce','_timeZone','OUTBOUND_PACKAGE_NAME','FlosumConstants','_snapshotId','retrieveVeevaComponents','5554360jUKntc','PackageExportService','Label__c','Is_Error__c','createMetadataItemListWithBody','has','apply','_packageExportService','selectedComponentMap','default','defineProperty','Cannot\x20Save\x20Metadata\x20Items','628roJyFI','values','./package-export.service','../dtos/metadata-item.dto','_metadataLogId','MetadataItemDto','2986864rNQEar','set','formAttachments','Snapshot\x20completed\x20','_salesforceService','apiName','files','Name__c','VeevaService','veevaComponentType','Job_Completed__c','_selectedMetaTypes','catch','TypeVeevaComponentRetriever','MetadataLogStatus','retrieve'];a339_0x4d32=function(){return _0x127661;};return a339_0x4d32();}exports[a339_0x43590a(0x1a9)]=SnapshotService,SnapshotService[a339_0x43590a(0x144)]='Snapshot',SnapshotService[a339_0x43590a(0x174)]=a339_0x43590a(0x187);