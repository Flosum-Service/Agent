const a395_0x3f4c4c=a395_0x4fd6;(function(_0x569fa7,_0x20e35e){const _0x342392=a395_0x4fd6,_0x1ced7a=_0x569fa7();while(!![]){try{const _0x344355=-parseInt(_0x342392(0x18b))/0x1+parseInt(_0x342392(0x1ed))/0x2*(parseInt(_0x342392(0x1f1))/0x3)+parseInt(_0x342392(0x1e6))/0x4+-parseInt(_0x342392(0x1c6))/0x5+-parseInt(_0x342392(0x1f5))/0x6*(-parseInt(_0x342392(0x18e))/0x7)+parseInt(_0x342392(0x1e3))/0x8*(-parseInt(_0x342392(0x1e0))/0x9)+-parseInt(_0x342392(0x199))/0xa*(-parseInt(_0x342392(0x1b0))/0xb);if(_0x344355===_0x20e35e)break;else _0x1ced7a['push'](_0x1ced7a['shift']());}catch(_0x2ddc24){_0x1ced7a['push'](_0x1ced7a['shift']());}}}(a395_0x3533,0xeac20));const a395_0x18e5bd=(function(){let _0x5ebd9a=!![];return function(_0x22940b,_0x517d0a){const _0x53724d=_0x5ebd9a?function(){const _0x3efcbf=a395_0x4fd6;if(_0x517d0a){const _0x41f186=_0x517d0a[_0x3efcbf(0x1bb)](_0x22940b,arguments);return _0x517d0a=null,_0x41f186;}}:function(){};return _0x5ebd9a=![],_0x53724d;};}()),a395_0x47be50=a395_0x18e5bd(this,function(){const _0x18a288=a395_0x4fd6;return a395_0x47be50[_0x18a288(0x1bc)]()['search'](_0x18a288(0x197))[_0x18a288(0x1bc)]()[_0x18a288(0x1e1)](a395_0x47be50)[_0x18a288(0x188)]('(((.+)+)+)+$');});a395_0x47be50();'use strict';var __importDefault=this&&this[a395_0x3f4c4c(0x1b4)]||function(_0x562d62){return _0x562d62&&_0x562d62['__esModule']?_0x562d62:{'default':_0x562d62};};function a395_0x4fd6(_0x4a9e78,_0x3c2b16){const _0x1b34fb=a395_0x3533();return a395_0x4fd6=function(_0x47be50,_0x18e5bd){_0x47be50=_0x47be50-0x181;let _0x3533f3=_0x1b34fb[_0x47be50];return _0x3533f3;},a395_0x4fd6(_0x4a9e78,_0x3c2b16);}Object[a395_0x3f4c4c(0x198)](exports,a395_0x3f4c4c(0x1a1),{'value':!![]}),exports[a395_0x3f4c4c(0x19d)]=void 0x0;const jszip_1=__importDefault(require(a395_0x3f4c4c(0x19b))),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require(a395_0x3f4c4c(0x1e2)),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require('../../../constants'),salesforce_service_1=require('./salesforce.service'),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a395_0x3f4c4c(0x1c8)),package_export_service_1=require(a395_0x3f4c4c(0x1a0)),type_and_name_veeva_component_retriever_1=require(a395_0x3f4c4c(0x1fb)),type_veeva_component_retriever_1=require(a395_0x3f4c4c(0x187)),sync_1=require(a395_0x3f4c4c(0x1df)),sync_2=require(a395_0x3f4c4c(0x1eb)),veeva_constants_1=require(a395_0x3f4c4c(0x1de)),path_1=__importDefault(require('path'));function a395_0x3533(){const _0x2a0615=['9432032WhsRty','stringify','Saving\x20','2593020LQgNYN','API_Name__c','Veeva_Component_Type__c','log','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','csv-stringify/sync','snapshotId','2aEJZBb','Snapshot__c/','success','default','94683xixtGb','retrieve','insertMultipleRecords','file','2412798gjCQAh','_selectedComponentMap','\x20Metadata\x20Items','veevaComponentType','updateLog','_metadataLogId','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','createMetadataItemListWithBody','has','Metadata_Item__c','generateAsync','_packageExportService','with\x20error','saveAttachments','SalesforceDmlError','posix','formAttachments','map','../classes/retrievers/veeva-components/type.veeva-component.retriever','search','execute','base64','738600pkjKDE','length','Cannot\x20retrieve\x20','7KDitQV','FlosumConstants','body','export','files','Last_Modified_Date__c','filter','ENDPOINT_UPSERT_RECORD','\x20from\x20outbound\x20package','(((.+)+)+)+$','defineProperty','35251990TvIiXI','logError','jszip','push','SnapshotService','lastModifiedDate','_salesforceService','./package-export.service','__esModule','ATTACHMENT','set','Status__c','get','_connectionSalesforce','VeevaService','finishSnapshot','VeevaConstants','FLOSUM_NAMESPACE','_snapshotId','MetadataItemDto','Attachment','TypeVeevaComponentRetriever','transformDependencyFile','11vHskNl','isRetrieved','_connectionVeeva','name','__importDefault','Snapshot\x20started.','patch','errors','EXCEPTION','_whereClause','Name__c','apply','toString','_logger','Saving\x20Attachments.','type','apiName','Label__c','MetadataLogStatus','retrieveVeevaComponents','Snapshot','SalesforceService','8639880mmCZgS','formMetadataItemDtoList','../classes/errors/salesforce-dml-error','sep','forEach','Succeed__c','label','Attachment_ID__c','values','attachmentId','_selectedMetaTypes','Is_Error__c','string','MDL_EXTENSION','_veevaService','OUTBOUND_PACKAGE_NAME','from','async','Snapshot\x20completed\x20','join','saveComponentsInSalesforce','successfully','Metadata_Log__c/','COMPLETED','../constants/veeva.constants','csv-parse/sync','9WTnUFg','constructor','./veeva.service'];a395_0x3533=function(){return _0x2a0615;};return a395_0x3533();}class SnapshotService{constructor({snapshotId:_0x4d7edd,metadataLogId:_0x14ae61,selectedMetaTypes:_0x357970,selectedComponentMap:_0x201a5e,whereClause:_0x499c81},_0x5cd417,_0x9ccd0a,_0x74b4b5){const _0x447d26=a395_0x3f4c4c;this['_connectionSalesforce']=_0x5cd417,this[_0x447d26(0x1b2)]=_0x9ccd0a,this[_0x447d26(0x1bd)]=_0x74b4b5,this[_0x447d26(0x1ab)]=_0x4d7edd,this[_0x447d26(0x1fa)]=_0x14ae61,this[_0x447d26(0x1d0)]=_0x357970,this[_0x447d26(0x1f6)]=_0x201a5e,this[_0x447d26(0x1b9)]=_0x499c81,this[_0x447d26(0x1d4)]=new veeva_service_1[(_0x447d26(0x1a7))]({'connection':this['_connectionVeeva'],'logger':this[_0x447d26(0x1bd)]}),this[_0x447d26(0x19f)]=new salesforce_service_1[(_0x447d26(0x1c5))]({'connection':this[_0x447d26(0x1a6)]}),this[_0x447d26(0x200)]=new package_export_service_1['PackageExportService']({'veevaService':this[_0x447d26(0x1d4)],'connection':this[_0x447d26(0x1b2)],'logger':this['_logger']});}async[a395_0x3f4c4c(0x189)](){const _0x3d9daa=a395_0x3f4c4c;try{this[_0x3d9daa(0x1bd)][_0x3d9daa(0x1e9)](_0x3d9daa(0x1b5));const _0x95c46d=await this[_0x3d9daa(0x1c3)]();await this[_0x3d9daa(0x1bd)][_0x3d9daa(0x1f9)]();const _0x1fe401=await this[_0x3d9daa(0x200)][_0x3d9daa(0x191)](_0x95c46d,SnapshotService['OUTBOUND_PACKAGE_NAME']);await this[_0x3d9daa(0x1bd)][_0x3d9daa(0x1f9)]();const _0x25f47f=await this[_0x3d9daa(0x1fc)](_0x95c46d,_0x1fe401);await this['saveComponentsInSalesforce'](_0x25f47f),await this[_0x3d9daa(0x1bd)]['updateLog'](),await this[_0x3d9daa(0x1a8)](!![]);}catch(_0x5ee4ca){this[_0x3d9daa(0x1bd)][_0x3d9daa(0x19a)](_0x5ee4ca),await this[_0x3d9daa(0x1a8)](![])['catch'](_0x5c6364=>this['_systemLogger']['error'](_0x5c6364));}}async[a395_0x3f4c4c(0x1c3)](){const _0x5cfe27=a395_0x3f4c4c,_0x2abc33={'veevaService':this[_0x5cfe27(0x1d4)],'logger':this['_logger']},_0x1cd201=Array[_0x5cfe27(0x1d6)](Object[_0x5cfe27(0x1ce)](this[_0x5cfe27(0x1f6)]))[_0x5cfe27(0x18c)]?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this['_selectedComponentMap'],..._0x2abc33}):new type_veeva_component_retriever_1[(_0x5cfe27(0x1ae))]({'value':this['_selectedMetaTypes'],'whereClause':this[_0x5cfe27(0x1b9)],..._0x2abc33});return _0x1cd201[_0x5cfe27(0x1f2)]();}async['createMetadataItemListWithBody'](_0x10a563,_0x15dd44){const _0x32e5cd=a395_0x3f4c4c;var _0x5d4801,_0x476802;this[_0x32e5cd(0x1bd)][_0x32e5cd(0x1e9)](_0x32e5cd(0x1ea));const _0x35afed=this[_0x32e5cd(0x1c7)](_0x10a563),_0x3da0d2=_0x35afed['reduce']((_0x395322,_0x530b24)=>_0x395322[_0x32e5cd(0x1a3)](_0x530b24[_0x32e5cd(0x1cc)],_0x530b24),new Map());for(const _0x12a285 of _0x15dd44){for(const _0x4679c7 in _0x12a285[_0x32e5cd(0x192)]){const {base:_0x58f100,name:_0x26be0c,dir:_0x418977}=path_1[_0x32e5cd(0x1f0)]['parse'](_0x4679c7),_0x55af1d=_0x26be0c+veeva_constants_1[_0x32e5cd(0x1a9)]['DEPENDENCY_EXTENSION'];if(_0x3da0d2[_0x32e5cd(0x1fd)](_0x58f100)){const _0x4e399c=await((_0x5d4801=_0x12a285['file']([_0x418977,_0x58f100][_0x32e5cd(0x1d9)](path_1[_0x32e5cd(0x1f0)][_0x32e5cd(0x184)][_0x32e5cd(0x1c9)])))===null||_0x5d4801===void 0x0?void 0x0:_0x5d4801[_0x32e5cd(0x1d7)](_0x32e5cd(0x1d2))),_0x2422f1=await((_0x476802=_0x12a285['file']([_0x418977,_0x55af1d][_0x32e5cd(0x1d9)](path_1[_0x32e5cd(0x1f0)][_0x32e5cd(0x184)][_0x32e5cd(0x1c9)])))===null||_0x476802===void 0x0?void 0x0:_0x476802[_0x32e5cd(0x1d7)](_0x32e5cd(0x1d2)));if(_0x4e399c){const _0x3bf099=new jszip_1['default']();_0x3bf099[_0x32e5cd(0x1f4)](_0x58f100,_0x4e399c),_0x2422f1&&_0x3bf099[_0x32e5cd(0x1f4)](_0x55af1d,this[_0x32e5cd(0x1af)](_0x2422f1)),_0x3da0d2[_0x32e5cd(0x1a5)](_0x58f100)['body']=await _0x3bf099[_0x32e5cd(0x1ff)]({'type':_0x32e5cd(0x18a)});}}}}return _0x35afed[_0x32e5cd(0x194)](_0x41145c=>!_0x41145c[_0x32e5cd(0x190)])[_0x32e5cd(0x1ca)](_0x37d283=>{const _0x34062d=_0x32e5cd;this[_0x34062d(0x1bd)][_0x34062d(0x1e9)](_0x34062d(0x18d)+_0x37d283['veevaComponentType']+'.'+_0x37d283[_0x34062d(0x1b3)]+_0x34062d(0x196));}),_0x35afed['filter'](_0x4387f7=>_0x4387f7['body']);}[a395_0x3f4c4c(0x1af)](_0x3e3a04){const _0x3687cb=a395_0x3f4c4c,_0x2d46ec=(0x0,sync_1['parse'])(_0x3e3a04,{'columns':!![],'skip_empty_lines':!![]}),_0x56877e=_0x2d46ec['map'](({'In\x20Package':_0x39b984,..._0x66997})=>_0x66997);return(0x0,sync_2[_0x3687cb(0x1e4)])(_0x56877e,{'header':!![]});}[a395_0x3f4c4c(0x1c7)](_0x38a1c4){const _0x301531=a395_0x3f4c4c;return _0x38a1c4[_0x301531(0x186)](_0x3db53b=>{const _0x8e766f=_0x301531,_0x36d9f1=new metadata_item_dto_1[(_0x8e766f(0x1ac))]();return _0x36d9f1[_0x8e766f(0x1b3)]=_0x3db53b[_0x8e766f(0x1b3)],_0x36d9f1[_0x8e766f(0x1c0)]=_0x3db53b[_0x8e766f(0x1b3)],_0x36d9f1[_0x8e766f(0x1ec)]=this[_0x8e766f(0x1ab)],_0x36d9f1[_0x8e766f(0x1cc)]=_0x3db53b[_0x8e766f(0x1bf)]+'.'+_0x3db53b['name']+veeva_constants_1[_0x8e766f(0x1a9)][_0x8e766f(0x1d3)],_0x36d9f1[_0x8e766f(0x1f8)]=_0x3db53b[_0x8e766f(0x1bf)],_0x36d9f1[_0x8e766f(0x19e)]=_0x3db53b['lastModifiedDate'],_0x36d9f1[_0x8e766f(0x1b1)]=![],_0x36d9f1;});}async[a395_0x3f4c4c(0x1da)](_0x4fdc73){const _0x598baf=a395_0x3f4c4c;this[_0x598baf(0x1bd)][_0x598baf(0x1e9)](_0x598baf(0x1be)),await this[_0x598baf(0x182)](_0x4fdc73),this[_0x598baf(0x1bd)][_0x598baf(0x1e9)](_0x598baf(0x1e5)+_0x4fdc73[_0x598baf(0x18c)]+_0x598baf(0x1f7));const _0x3635b8=_0x4fdc73[_0x598baf(0x186)](_0xd6e4bb=>{const _0x1ef7c3=_0x598baf;return{[constants_1[_0x1ef7c3(0x1aa)]+_0x1ef7c3(0x1ba)]:_0xd6e4bb['name'],[constants_1[_0x1ef7c3(0x1aa)]+_0x1ef7c3(0x1e7)]:_0xd6e4bb[_0x1ef7c3(0x1c0)],[constants_1['FLOSUM_NAMESPACE']+'Snapshot__c']:_0xd6e4bb[_0x1ef7c3(0x1ec)],[constants_1[_0x1ef7c3(0x1aa)]+_0x1ef7c3(0x1c1)]:_0xd6e4bb[_0x1ef7c3(0x1cc)],[constants_1[_0x1ef7c3(0x1aa)]+'Is_Retrieved__c']:_0xd6e4bb[_0x1ef7c3(0x1b1)],[constants_1[_0x1ef7c3(0x1aa)]+_0x1ef7c3(0x1e8)]:_0xd6e4bb['veevaComponentType'],[constants_1['FLOSUM_NAMESPACE']+_0x1ef7c3(0x1cd)]:_0xd6e4bb[_0x1ef7c3(0x1cf)],[constants_1[_0x1ef7c3(0x1aa)]+_0x1ef7c3(0x193)]:_0xd6e4bb[_0x1ef7c3(0x19e)]};}),_0x75009d=await this[_0x598baf(0x19f)][_0x598baf(0x1f3)](constants_1[_0x598baf(0x1aa)]+_0x598baf(0x1fe),_0x3635b8);let _0x1cb942=!![];_0x75009d[_0x598baf(0x1ca)]((_0x32b86a,_0x2f6ba1)=>{const _0x592c99=_0x598baf;this[_0x592c99(0x1bd)][_0x592c99(0x1e9)](_0x592c99(0x1e5)+_0x4fdc73[_0x2f6ba1][_0x592c99(0x1f8)]+'.'+_0x4fdc73[_0x2f6ba1]['name']);if(!_0x32b86a[_0x592c99(0x1ef)]){_0x1cb942=![];const _0x2ef8a2=new salesforce_dml_error_1['SalesforceDmlError'](_0x32b86a[_0x592c99(0x1b7)]);this[_0x592c99(0x1bd)]['logError'](_0x2ef8a2);}});if(!_0x1cb942)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async[a395_0x3f4c4c(0x182)](_0x230ed5){const _0x1aa34f=a395_0x3f4c4c,_0x42f075=this[_0x1aa34f(0x185)](_0x230ed5),_0x32c32d=await this[_0x1aa34f(0x19f)]['insertMultipleRecords'](SnapshotService[_0x1aa34f(0x1a2)],_0x42f075),_0x1b90f8=[];_0x32c32d[_0x1aa34f(0x1ca)]((_0x33f645,_0x24c4dd)=>{const _0x4a5dec=_0x1aa34f;_0x33f645[_0x4a5dec(0x1ef)]?(_0x230ed5[_0x24c4dd][_0x4a5dec(0x1cf)]=_0x33f645['id'],_0x230ed5[_0x24c4dd]['isRetrieved']=!![]):_0x1b90f8[_0x4a5dec(0x19c)](..._0x33f645[_0x4a5dec(0x1b7)]);});if(_0x1b90f8[_0x1aa34f(0x18c)])throw new salesforce_dml_error_1[(_0x1aa34f(0x183))](_0x1b90f8);}[a395_0x3f4c4c(0x185)](_0x3c95a7){const _0x1867fc=a395_0x3f4c4c;return _0x3c95a7[_0x1867fc(0x186)](_0x3bf6fd=>({'ParentId':this[_0x1867fc(0x1ab)],'Name':_0x3bf6fd[_0x1867fc(0x1f8)],'ContentType':'application/zip','Body':_0x3bf6fd[_0x1867fc(0x190)],'Description':_0x3bf6fd[_0x1867fc(0x1f8)]}));}async['finishSnapshot'](_0x407862){const _0x362605=a395_0x3f4c4c,_0x3a9947={[constants_1[_0x362605(0x1aa)]+'Is_Completed__c']:!![],[constants_1[_0x362605(0x1aa)]+'Is_Error__c']:!_0x407862},_0x5e16b4={[constants_1['FLOSUM_NAMESPACE']+_0x362605(0x1d1)]:!_0x407862,[constants_1[_0x362605(0x1aa)]+_0x362605(0x1cb)]:_0x407862,[constants_1[_0x362605(0x1aa)]+_0x362605(0x1a4)]:_0x407862?status_enums_1[_0x362605(0x1c2)][_0x362605(0x1dd)]:status_enums_1[_0x362605(0x1c2)][_0x362605(0x1b8)],[constants_1[_0x362605(0x1aa)]+'Job_Completed__c']:!![]};await this[_0x362605(0x1a6)][_0x362605(0x1b6)](flosum_constants_1[_0x362605(0x18f)][_0x362605(0x195)]+'/'+constants_1[_0x362605(0x1aa)]+_0x362605(0x1ee)+this['_snapshotId'],_0x3a9947),await this[_0x362605(0x1a6)][_0x362605(0x1b6)](flosum_constants_1[_0x362605(0x18f)][_0x362605(0x195)]+'/'+constants_1[_0x362605(0x1aa)]+_0x362605(0x1dc)+this[_0x362605(0x1fa)],_0x5e16b4),this[_0x362605(0x1bd)][_0x362605(0x1e9)](_0x362605(0x1d8)+(_0x407862?_0x362605(0x1db):_0x362605(0x181))+'.'),await this[_0x362605(0x1bd)][_0x362605(0x1f9)]();}}exports[a395_0x3f4c4c(0x19d)]=SnapshotService,SnapshotService[a395_0x3f4c4c(0x1d5)]=a395_0x3f4c4c(0x1c4),SnapshotService[a395_0x3f4c4c(0x1a2)]=a395_0x3f4c4c(0x1ad);