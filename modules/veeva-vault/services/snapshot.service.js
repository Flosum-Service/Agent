const a394_0x519f46=a394_0x466d;(function(_0x196342,_0x3e8570){const _0x758234=a394_0x466d,_0x5ddc26=_0x196342();while(!![]){try{const _0x447c38=-parseInt(_0x758234(0x152))/0x1+-parseInt(_0x758234(0x143))/0x2*(-parseInt(_0x758234(0x15c))/0x3)+-parseInt(_0x758234(0x150))/0x4*(-parseInt(_0x758234(0x117))/0x5)+parseInt(_0x758234(0xf1))/0x6*(parseInt(_0x758234(0x136))/0x7)+parseInt(_0x758234(0x11b))/0x8*(-parseInt(_0x758234(0x14f))/0x9)+parseInt(_0x758234(0xe9))/0xa+-parseInt(_0x758234(0x142))/0xb*(parseInt(_0x758234(0x12b))/0xc);if(_0x447c38===_0x3e8570)break;else _0x5ddc26['push'](_0x5ddc26['shift']());}catch(_0x5653eb){_0x5ddc26['push'](_0x5ddc26['shift']());}}}(a394_0x20a8,0x2e86b));const a394_0x3682da=(function(){let _0x11e9cb=!![];return function(_0x40ca30,_0x22ebeb){const _0x2e0fcf=_0x11e9cb?function(){const _0x1d1295=a394_0x466d;if(_0x22ebeb){const _0xebc099=_0x22ebeb[_0x1d1295(0xf0)](_0x40ca30,arguments);return _0x22ebeb=null,_0xebc099;}}:function(){};return _0x11e9cb=![],_0x2e0fcf;};}()),a394_0x5c2210=a394_0x3682da(this,function(){const _0x1f08d8=a394_0x466d;return a394_0x5c2210[_0x1f08d8(0x11e)]()[_0x1f08d8(0x118)](_0x1f08d8(0x11c))[_0x1f08d8(0x11e)]()[_0x1f08d8(0xfa)](a394_0x5c2210)['search']('(((.+)+)+)+$');});a394_0x5c2210();function a394_0x466d(_0x3ea021,_0xfc48e6){const _0x5df62f=a394_0x20a8();return a394_0x466d=function(_0x5c2210,_0x3682da){_0x5c2210=_0x5c2210-0xe5;let _0x20a8de=_0x5df62f[_0x5c2210];return _0x20a8de;},a394_0x466d(_0x3ea021,_0xfc48e6);}'use strict';var __importDefault=this&&this['__importDefault']||function(_0xdb47bd){const _0x329a78=a394_0x466d;return _0xdb47bd&&_0xdb47bd[_0x329a78(0x11d)]?_0xdb47bd:{'default':_0xdb47bd};};Object['defineProperty'](exports,a394_0x519f46(0x11d),{'value':!![]}),exports['SnapshotService']=void 0x0;const jszip_1=__importDefault(require(a394_0x519f46(0x132))),flosum_constants_1=require(a394_0x519f46(0x101)),veeva_service_1=require(a394_0x519f46(0x155)),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a394_0x519f46(0x110)),salesforce_service_1=require(a394_0x519f46(0x137)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a394_0x519f46(0x10e)),package_export_service_1=require(a394_0x519f46(0x13a)),type_and_name_veeva_component_retriever_1=require(a394_0x519f46(0x135)),type_veeva_component_retriever_1=require(a394_0x519f46(0x127)),sync_1=require(a394_0x519f46(0x147)),sync_2=require(a394_0x519f46(0x124)),veeva_constants_1=require(a394_0x519f46(0x112)),path_1=__importDefault(require('path'));class SnapshotService{constructor({snapshotId:_0x15ba54,metadataLogId:_0xa35d02,selectedMetaTypes:_0x2203f2,selectedComponentMap:_0x3201a2,whereClause:_0xa7f959},_0x289388,_0x59cb59,_0x2482bd){const _0x350801=a394_0x519f46;this[_0x350801(0xfc)]=_0x289388,this[_0x350801(0x10c)]=_0x59cb59,this['_logger']=_0x2482bd,this[_0x350801(0x13b)]=_0x15ba54,this[_0x350801(0x115)]=_0xa35d02,this[_0x350801(0x15b)]=_0x2203f2,this[_0x350801(0x156)]=_0x3201a2,this[_0x350801(0xf3)]=_0xa7f959,this[_0x350801(0x151)]=new veeva_service_1[(_0x350801(0x130))]({'connection':this[_0x350801(0x10c)],'logger':this[_0x350801(0xfb)]}),this['_salesforceService']=new salesforce_service_1['SalesforceService']({'connection':this[_0x350801(0xfc)]}),this[_0x350801(0x14e)]=new package_export_service_1['PackageExportService']({'veevaService':this['_veevaService'],'connection':this[_0x350801(0x10c)],'logger':this[_0x350801(0xfb)]});}async[a394_0x519f46(0x122)](){const _0x45f01b=a394_0x519f46;try{this[_0x45f01b(0xfb)][_0x45f01b(0x140)](_0x45f01b(0x123));const _0x25d944=await this['retrieveVeevaComponents']();await this[_0x45f01b(0xfb)]['updateLog']();const _0x42bf2d=await this[_0x45f01b(0x14e)][_0x45f01b(0x10f)](_0x25d944,SnapshotService[_0x45f01b(0x149)]);await this[_0x45f01b(0xfb)][_0x45f01b(0x14d)]();const _0x21cef8=await this[_0x45f01b(0x139)](_0x25d944,_0x42bf2d);await this[_0x45f01b(0x158)](_0x21cef8),await this[_0x45f01b(0xfb)][_0x45f01b(0x14d)](),await this[_0x45f01b(0xeb)](!![]);}catch(_0x586f61){this['_logger'][_0x45f01b(0xe6)](_0x586f61),await this[_0x45f01b(0xeb)](![])['catch'](_0x2fd70e=>this['_systemLogger'][_0x45f01b(0x128)](_0x2fd70e));}}async[a394_0x519f46(0x144)](){const _0x289e9b=a394_0x519f46,_0x112b5f={'veevaService':this['_veevaService'],'logger':this[_0x289e9b(0xfb)]},_0x27ab32=Array[_0x289e9b(0x11f)](Object['values'](this['_selectedComponentMap']))['length']?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x289e9b(0x156)],..._0x112b5f}):new type_veeva_component_retriever_1[(_0x289e9b(0x131))]({'value':this[_0x289e9b(0x15b)],'whereClause':this['_whereClause'],..._0x112b5f});return _0x27ab32[_0x289e9b(0xee)]();}async[a394_0x519f46(0x139)](_0x49f985,_0x4fbb7b){const _0x1dcffe=a394_0x519f46;var _0x199e16,_0x3b2925;this[_0x1dcffe(0xfb)][_0x1dcffe(0x140)](_0x1dcffe(0x113));const _0xb3d4a7=this['formMetadataItemDtoList'](_0x49f985),_0x422743=_0xb3d4a7[_0x1dcffe(0x13c)]((_0x414785,_0xd644af)=>_0x414785[_0x1dcffe(0x159)](_0xd644af['label'],_0xd644af),new Map());for(const _0x488993 of _0x4fbb7b){for(const _0x3ebb96 in _0x488993[_0x1dcffe(0x15f)]){const {base:_0x50420a,name:_0x392307,dir:_0x1a9886}=path_1[_0x1dcffe(0x129)][_0x1dcffe(0x141)](_0x3ebb96),_0x2fe444=_0x392307+veeva_constants_1[_0x1dcffe(0x108)][_0x1dcffe(0x13f)];if(_0x422743['has'](_0x50420a)){const _0x17a3dd=await((_0x199e16=_0x488993['file']([_0x1a9886,_0x50420a][_0x1dcffe(0x134)](path_1['default'][_0x1dcffe(0x111)][_0x1dcffe(0x10b)])))===null||_0x199e16===void 0x0?void 0x0:_0x199e16[_0x1dcffe(0x114)](_0x1dcffe(0x10a))),_0x11477f=await((_0x3b2925=_0x488993[_0x1dcffe(0x119)]([_0x1a9886,_0x2fe444]['join'](path_1['default'][_0x1dcffe(0x111)]['sep'])))===null||_0x3b2925===void 0x0?void 0x0:_0x3b2925['async'](_0x1dcffe(0x10a)));if(_0x17a3dd){const _0xbfd59f=new jszip_1[(_0x1dcffe(0x129))]();_0xbfd59f[_0x1dcffe(0x119)](_0x50420a,_0x17a3dd),_0x11477f&&_0xbfd59f[_0x1dcffe(0x119)](_0x2fe444,this[_0x1dcffe(0x11a)](_0x11477f)),_0x422743[_0x1dcffe(0x13e)](_0x50420a)['body']=await _0xbfd59f[_0x1dcffe(0x12c)]({'type':_0x1dcffe(0x153)});}}}}return _0xb3d4a7[_0x1dcffe(0x106)](_0x4b7e93=>!_0x4b7e93[_0x1dcffe(0x109)])[_0x1dcffe(0xed)](_0x3b4b2d=>{const _0x3fe359=_0x1dcffe;this[_0x3fe359(0xfb)][_0x3fe359(0x140)]('Cannot\x20retrieve\x20'+_0x3b4b2d[_0x3fe359(0x10d)]+'.'+_0x3b4b2d['name']+_0x3fe359(0xef));}),_0xb3d4a7[_0x1dcffe(0x106)](_0x748331=>_0x748331[_0x1dcffe(0x109)]);}['transformDependencyFile'](_0xa8cba3){const _0x58fe3d=a394_0x519f46,_0x1e9936=(0x0,sync_1['parse'])(_0xa8cba3,{'columns':!![],'skip_empty_lines':!![]}),_0x42bad1=_0x1e9936[_0x58fe3d(0x12d)](({'In\x20Package':_0x431e86,..._0x180e8c})=>_0x180e8c);return(0x0,sync_2[_0x58fe3d(0xf4)])(_0x42bad1,{'header':!![]});}['formMetadataItemDtoList'](_0x3ec970){return _0x3ec970['map'](_0x4cca4c=>{const _0x1b6e64=a394_0x466d,_0x2ade92=new metadata_item_dto_1['MetadataItemDto']();return _0x2ade92[_0x1b6e64(0xfe)]=_0x4cca4c['name'],_0x2ade92[_0x1b6e64(0xf5)]=_0x4cca4c['name'],_0x2ade92[_0x1b6e64(0xfd)]=this[_0x1b6e64(0x13b)],_0x2ade92[_0x1b6e64(0x103)]=_0x4cca4c[_0x1b6e64(0x14b)]+'.'+_0x4cca4c[_0x1b6e64(0xfe)]+veeva_constants_1[_0x1b6e64(0x108)]['MDL_EXTENSION'],_0x2ade92[_0x1b6e64(0x10d)]=_0x4cca4c[_0x1b6e64(0x14b)],_0x2ade92[_0x1b6e64(0x15a)]=_0x4cca4c[_0x1b6e64(0x15a)],_0x2ade92[_0x1b6e64(0x12e)]=![],_0x2ade92;});}async['saveComponentsInSalesforce'](_0x3345fa){const _0x3b1cbe=a394_0x519f46;this[_0x3b1cbe(0xfb)][_0x3b1cbe(0x140)](_0x3b1cbe(0x125)),await this['saveAttachments'](_0x3345fa),this['_logger'][_0x3b1cbe(0x140)]('Saving\x20'+_0x3345fa[_0x3b1cbe(0xe8)]+_0x3b1cbe(0x105));const _0x50ec42=_0x3345fa[_0x3b1cbe(0x12d)](_0x23f5fd=>{const _0x1cd35e=_0x3b1cbe;return{[constants_1[_0x1cd35e(0x148)]+_0x1cd35e(0xe7)]:_0x23f5fd[_0x1cd35e(0xfe)],[constants_1[_0x1cd35e(0x148)]+'API_Name__c']:_0x23f5fd[_0x1cd35e(0xf5)],[constants_1[_0x1cd35e(0x148)]+_0x1cd35e(0x12a)]:_0x23f5fd[_0x1cd35e(0xfd)],[constants_1[_0x1cd35e(0x148)]+'Label__c']:_0x23f5fd['label'],[constants_1[_0x1cd35e(0x148)]+'Is_Retrieved__c']:_0x23f5fd[_0x1cd35e(0x12e)],[constants_1[_0x1cd35e(0x148)]+_0x1cd35e(0x138)]:_0x23f5fd[_0x1cd35e(0x10d)],[constants_1[_0x1cd35e(0x148)]+_0x1cd35e(0x15d)]:_0x23f5fd[_0x1cd35e(0xf2)],[constants_1[_0x1cd35e(0x148)]+_0x1cd35e(0x100)]:_0x23f5fd[_0x1cd35e(0x15a)]};}),_0x2009fa=await this[_0x3b1cbe(0x116)][_0x3b1cbe(0x102)](constants_1[_0x3b1cbe(0x148)]+_0x3b1cbe(0x104),_0x50ec42);let _0x278c65=!![];_0x2009fa['forEach']((_0x36faed,_0x10f9d3)=>{const _0x5dc459=_0x3b1cbe;this['_logger'][_0x5dc459(0x140)](_0x5dc459(0x126)+_0x3345fa[_0x10f9d3][_0x5dc459(0x10d)]+'.'+_0x3345fa[_0x10f9d3][_0x5dc459(0xfe)]);if(!_0x36faed['success']){_0x278c65=![];const _0x150f76=new salesforce_dml_error_1[(_0x5dc459(0xf9))](_0x36faed['errors']);this[_0x5dc459(0xfb)][_0x5dc459(0xe6)](_0x150f76);}});if(!_0x278c65)throw new Error(_0x3b1cbe(0xf6));}async['saveAttachments'](_0xdd73db){const _0x9b8c74=a394_0x519f46,_0x4140ec=this[_0x9b8c74(0x14c)](_0xdd73db),_0x4d27e2=await this[_0x9b8c74(0x116)][_0x9b8c74(0x102)](SnapshotService[_0x9b8c74(0x12f)],_0x4140ec),_0x57de58=[];_0x4d27e2[_0x9b8c74(0xed)]((_0x35bcf1,_0x31e244)=>{const _0x3db6c5=_0x9b8c74;_0x35bcf1['success']?(_0xdd73db[_0x31e244][_0x3db6c5(0xf2)]=_0x35bcf1['id'],_0xdd73db[_0x31e244][_0x3db6c5(0x12e)]=!![]):_0x57de58[_0x3db6c5(0xf7)](..._0x35bcf1['errors']);});if(_0x57de58[_0x9b8c74(0xe8)])throw new salesforce_dml_error_1[(_0x9b8c74(0xf9))](_0x57de58);}[a394_0x519f46(0x14c)](_0x27c909){const _0x30e607=a394_0x519f46;return _0x27c909[_0x30e607(0x12d)](_0x1e8c9a=>({'ParentId':this[_0x30e607(0x13b)],'Name':_0x1e8c9a[_0x30e607(0x10d)],'ContentType':_0x30e607(0x107),'Body':_0x1e8c9a[_0x30e607(0x109)],'Description':_0x1e8c9a[_0x30e607(0x10d)]}));}async['finishSnapshot'](_0x79c077){const _0x192185=a394_0x519f46,_0xa2020a={[constants_1[_0x192185(0x148)]+'Is_Completed__c']:!![],[constants_1['FLOSUM_NAMESPACE']+_0x192185(0x13d)]:!_0x79c077},_0xaefa2c={[constants_1['FLOSUM_NAMESPACE']+_0x192185(0x13d)]:!_0x79c077,[constants_1[_0x192185(0x148)]+_0x192185(0x14a)]:_0x79c077,[constants_1[_0x192185(0x148)]+_0x192185(0xf8)]:_0x79c077?status_enums_1[_0x192185(0xff)]['COMPLETED']:status_enums_1['MetadataLogStatus']['EXCEPTION'],[constants_1[_0x192185(0x148)]+_0x192185(0x15e)]:!![]};await this[_0x192185(0xfc)][_0x192185(0x133)](flosum_constants_1[_0x192185(0x121)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1['FLOSUM_NAMESPACE']+_0x192185(0x154)+this[_0x192185(0x13b)],_0xa2020a),await this[_0x192185(0xfc)][_0x192185(0x133)](flosum_constants_1[_0x192185(0x121)][_0x192185(0xe5)]+'/'+constants_1[_0x192185(0x148)]+_0x192185(0xec)+this['_metadataLogId'],_0xaefa2c),this[_0x192185(0xfb)][_0x192185(0x140)](_0x192185(0x145)+(_0x79c077?_0x192185(0xea):'with\x20error')+'.'),await this['_logger'][_0x192185(0x14d)]();}}function a394_0x20a8(){const _0x5d2a2c=['VeevaService','TypeVeevaComponentRetriever','jszip','patch','join','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','1391873kLialA','./salesforce.service','Veeva_Component_Type__c','createMetadataItemListWithBody','./package-export.service','_snapshotId','reduce','Is_Error__c','get','DEPENDENCY_EXTENSION','log','parse','363BkbPLq','2RrNgwc','retrieveVeevaComponents','Snapshot\x20completed\x20','SnapshotService','csv-parse/sync','FLOSUM_NAMESPACE','OUTBOUND_PACKAGE_NAME','Succeed__c','type','formAttachments','updateLog','_packageExportService','279wOVVXR','360hOiCpl','_veevaService','169554WJPzri','base64','Snapshot__c/','./veeva.service','_selectedComponentMap','Attachment','saveComponentsInSalesforce','set','lastModifiedDate','_selectedMetaTypes','112809uiIcgs','Attachment_ID__c','Job_Completed__c','files','ENDPOINT_UPSERT_RECORD','logError','Name__c','length','3455670uqEQHA','successfully','finishSnapshot','Metadata_Log__c/','forEach','retrieve','\x20from\x20outbound\x20package','apply','6jaPVlo','attachmentId','_whereClause','stringify','apiName','Cannot\x20Save\x20Metadata\x20Items','push','Status__c','SalesforceDmlError','constructor','_logger','_connectionSalesforce','snapshotId','name','MetadataLogStatus','Last_Modified_Date__c','../constants/flosum.constants','insertMultipleRecords','label','Metadata_Item__c','\x20Metadata\x20Items','filter','application/zip','VeevaConstants','body','string','sep','_connectionVeeva','veevaComponentType','../classes/errors/salesforce-dml-error','export','../../../constants','posix','../constants/veeva.constants','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','async','_metadataLogId','_salesforceService','14265HPeAqJ','search','file','transformDependencyFile','61688yHlCsA','(((.+)+)+)+$','__esModule','toString','from','Snapshot','FlosumConstants','execute','Snapshot\x20started.','csv-stringify/sync','Saving\x20Attachments.','Saving\x20','../classes/retrievers/veeva-components/type.veeva-component.retriever','error','default','Snapshot__c','87132PEugYw','generateAsync','map','isRetrieved','ATTACHMENT'];a394_0x20a8=function(){return _0x5d2a2c;};return a394_0x20a8();}exports[a394_0x519f46(0x146)]=SnapshotService,SnapshotService['OUTBOUND_PACKAGE_NAME']=a394_0x519f46(0x120),SnapshotService[a394_0x519f46(0x12f)]=a394_0x519f46(0x157);