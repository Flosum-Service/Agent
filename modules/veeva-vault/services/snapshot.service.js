const a363_0x4c8c8e=a363_0x2780;(function(_0x1bfcb7,_0x163060){const _0x276b06=a363_0x2780,_0x4b7b10=_0x1bfcb7();while(!![]){try{const _0x498ec8=parseInt(_0x276b06(0x131))/0x1+parseInt(_0x276b06(0x17b))/0x2+-parseInt(_0x276b06(0x172))/0x3*(-parseInt(_0x276b06(0x139))/0x4)+parseInt(_0x276b06(0x147))/0x5*(parseInt(_0x276b06(0x19a))/0x6)+parseInt(_0x276b06(0x1a0))/0x7+parseInt(_0x276b06(0x168))/0x8+parseInt(_0x276b06(0x191))/0x9*(-parseInt(_0x276b06(0x145))/0xa);if(_0x498ec8===_0x163060)break;else _0x4b7b10['push'](_0x4b7b10['shift']());}catch(_0x3ec96b){_0x4b7b10['push'](_0x4b7b10['shift']());}}}(a363_0x4afe,0x60083));const a363_0x7d628c=(function(){let _0x3dcf49=!![];return function(_0x3dbfb2,_0x20ec96){const _0x1bcd16=_0x3dcf49?function(){if(_0x20ec96){const _0x3a18ad=_0x20ec96['apply'](_0x3dbfb2,arguments);return _0x20ec96=null,_0x3a18ad;}}:function(){};return _0x3dcf49=![],_0x1bcd16;};}()),a363_0x19fc7e=a363_0x7d628c(this,function(){const _0x50d67c=a363_0x2780;return a363_0x19fc7e[_0x50d67c(0x166)]()[_0x50d67c(0x199)](_0x50d67c(0x14f))[_0x50d67c(0x166)]()[_0x50d67c(0x140)](a363_0x19fc7e)['search'](_0x50d67c(0x14f));});a363_0x19fc7e();function a363_0x4afe(){const _0x172612=['constructor','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','patch','jszip','OUTBOUND_PACKAGE_NAME','1250aJZsZV','_selectedComponentMap','103685kFleZD','ENDPOINT_UPSERT_RECORD','_connectionSalesforce','TypeAndNameVeevaComponentRetriever','updateLog','_logger','_salesforceService','logError','(((.+)+)+)+$','createMetadataItemListWithBody','transformDependencyFile','../dtos/metadata-item.dto','\x20Metadata\x20Items','name','insertMultipleRecords','join','defineProperty','file','Saving\x20Attachments.','__esModule','formAttachments','_timeZone','path','Snapshot\x20started.','__importDefault','application/zip','veevaComponentType','Veeva_Component_Type__c','_metadataLogId','ATTACHMENT','Attachment','toString','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','6077184LZwqMj','Is_Error__c','finishSnapshot','log','isRetrieved','saveComponentsInSalesforce','default','Succeed__c','_snapshotId','../constants/veeva.constants','15oMTEhT','async','get','../enums/status.enums','generateAsync','retrieveVeevaComponents','_packageExportService','Last_Modified_Date__c','\x20from\x20outbound\x20package','96262HkbeGf','PackageExportService','_selectedMetaTypes','reduce','VeevaConstants','FlosumConstants','success','from','MetadataLogStatus','error','map','../classes/retrievers/veeva-components/type.veeva-component.retriever','_veevaService','../constants/flosum.constants','length','body','Is_Retrieved__c','VeevaService','retrieve','Snapshot\x20completed\x20','SnapshotService','values','127395uJhuVM','errors','parse','selectedMetaTypes','apiName','csv-stringify/sync','FLOSUM_NAMESPACE','Cannot\x20retrieve\x20','search','30kUOijg','_connectionVeeva','MDL_EXTENSION','./salesforce.service','Is_Completed__c','Saving\x20','3766217HLAnxf','snapshotId','successfully','type','EXCEPTION','set','filter','COMPLETED','MetadataItemDto','lastModifiedDate','selectedComponentMap','./veeva.service','string','attachmentId','201257hmqoEu','TypeVeevaComponentRetriever','push','SalesforceDmlError','attachmentLogId','forEach','../../../constants','stringify','409576UyYxcm','has','saveAttachments','label','Attachment_ID__c','metadataLogId','formMetadataItemDtoList'];a363_0x4afe=function(){return _0x172612;};return a363_0x4afe();}'use strict';var __importDefault=this&&this[a363_0x4c8c8e(0x15f)]||function(_0x21b5ca){const _0x998b5e=a363_0x4c8c8e;return _0x21b5ca&&_0x21b5ca[_0x998b5e(0x15a)]?_0x21b5ca:{'default':_0x21b5ca};};Object[a363_0x4c8c8e(0x157)](exports,a363_0x4c8c8e(0x15a),{'value':!![]}),exports[a363_0x4c8c8e(0x18f)]=void 0x0;function a363_0x2780(_0x3fc753,_0x587305){const _0x547c26=a363_0x4afe();return a363_0x2780=function(_0x19fc7e,_0x7d628c){_0x19fc7e=_0x19fc7e-0x129;let _0x4afeb8=_0x547c26[_0x19fc7e];return _0x4afeb8;},a363_0x2780(_0x3fc753,_0x587305);}const jszip_1=__importDefault(require(a363_0x4c8c8e(0x143))),flosum_constants_1=require(a363_0x4c8c8e(0x188)),veeva_service_1=require(a363_0x4c8c8e(0x12e)),metadata_item_dto_1=require(a363_0x4c8c8e(0x152)),constants_1=require(a363_0x4c8c8e(0x137)),salesforce_service_1=require(a363_0x4c8c8e(0x19d)),status_enums_1=require(a363_0x4c8c8e(0x175)),salesforce_dml_error_1=require('../classes/errors/salesforce-dml-error'),package_export_service_1=require('./package-export.service'),type_and_name_veeva_component_retriever_1=require(a363_0x4c8c8e(0x167)),type_veeva_component_retriever_1=require(a363_0x4c8c8e(0x186)),sync_1=require('csv-parse/sync'),sync_2=require(a363_0x4c8c8e(0x196)),veeva_constants_1=require(a363_0x4c8c8e(0x171)),path_1=__importDefault(require(a363_0x4c8c8e(0x15d)));class SnapshotService{constructor(_0x368f3d,_0x88913d,_0x4ccae3,_0x493d97){const _0x33a4a6=a363_0x4c8c8e;this[_0x33a4a6(0x149)]=_0x88913d,this[_0x33a4a6(0x19b)]=_0x4ccae3,this[_0x33a4a6(0x14c)]=_0x493d97,this[_0x33a4a6(0x170)]=_0x368f3d['snapshotId'],this[_0x33a4a6(0x163)]=_0x368f3d[_0x33a4a6(0x13e)],this['_attachmentLogId']=_0x368f3d[_0x33a4a6(0x135)],this[_0x33a4a6(0x15c)]=_0x368f3d['timeZone'],this[_0x33a4a6(0x17d)]=_0x368f3d[_0x33a4a6(0x194)],this[_0x33a4a6(0x146)]=_0x368f3d[_0x33a4a6(0x12d)],this[_0x33a4a6(0x187)]=new veeva_service_1[(_0x33a4a6(0x18c))]({'connection':this['_connectionVeeva'],'logger':this[_0x33a4a6(0x14c)]}),this[_0x33a4a6(0x14d)]=new salesforce_service_1['SalesforceService']({'connection':this[_0x33a4a6(0x149)]}),this[_0x33a4a6(0x178)]=new package_export_service_1[(_0x33a4a6(0x17c))]({'veevaService':this[_0x33a4a6(0x187)],'connection':this[_0x33a4a6(0x19b)],'logger':this[_0x33a4a6(0x14c)]});}async['execute'](){const _0x9e48f2=a363_0x4c8c8e;try{this[_0x9e48f2(0x14c)][_0x9e48f2(0x16b)](_0x9e48f2(0x15e));const _0x88b0e2=await this['retrieveVeevaComponents']();await this[_0x9e48f2(0x14c)][_0x9e48f2(0x14b)]();const _0x20ffdc=await this[_0x9e48f2(0x178)]['export'](_0x88b0e2,SnapshotService[_0x9e48f2(0x144)]);await this[_0x9e48f2(0x14c)][_0x9e48f2(0x14b)]();const _0x1f843c=await this[_0x9e48f2(0x150)](_0x88b0e2,_0x20ffdc);await this['saveComponentsInSalesforce'](_0x1f843c),await this[_0x9e48f2(0x14c)][_0x9e48f2(0x14b)](),await this[_0x9e48f2(0x16a)](!![]);}catch(_0xad25ad){this[_0x9e48f2(0x14c)][_0x9e48f2(0x14e)](_0xad25ad),await this['finishSnapshot'](![])['catch'](_0x986040=>this['_systemLogger'][_0x9e48f2(0x184)](_0x986040));}}async[a363_0x4c8c8e(0x177)](){const _0x3d76d1=a363_0x4c8c8e,_0x389771={'veevaService':this[_0x3d76d1(0x187)],'logger':this['_logger']},_0x31c929=Array[_0x3d76d1(0x182)](Object[_0x3d76d1(0x190)](this[_0x3d76d1(0x146)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x3d76d1(0x14a))]({'value':this[_0x3d76d1(0x146)],..._0x389771}):new type_veeva_component_retriever_1[(_0x3d76d1(0x132))]({'value':this[_0x3d76d1(0x17d)],..._0x389771});return _0x31c929[_0x3d76d1(0x18d)]();}async['createMetadataItemListWithBody'](_0x2a3d86,_0x43b9bb){const _0x24b7dd=a363_0x4c8c8e;var _0x5d2930,_0x5acd9d;this['_logger'][_0x24b7dd(0x16b)](_0x24b7dd(0x141));const _0x941d4b=this[_0x24b7dd(0x13f)](_0x2a3d86),_0x4968f3=_0x941d4b[_0x24b7dd(0x17e)]((_0x3b46fb,_0x5c478c)=>_0x3b46fb[_0x24b7dd(0x1a5)](_0x5c478c[_0x24b7dd(0x13c)],_0x5c478c),new Map());for(const _0x511b93 of _0x43b9bb){for(const _0x401fde in _0x511b93['files']){const {base:_0x517bed,name:_0x1aaf7c,dir:_0x1b4ec9}=path_1['default']['parse'](_0x401fde),_0x4779e6=_0x1aaf7c+veeva_constants_1[_0x24b7dd(0x17f)]['DEPENDENCY_EXTENSION'];if(_0x4968f3[_0x24b7dd(0x13a)](_0x517bed)){const _0x6da0d5=await((_0x5d2930=_0x511b93['file'](path_1[_0x24b7dd(0x16e)][_0x24b7dd(0x156)](_0x1b4ec9,_0x517bed)))===null||_0x5d2930===void 0x0?void 0x0:_0x5d2930[_0x24b7dd(0x173)](_0x24b7dd(0x12f))),_0x187cde=await((_0x5acd9d=_0x511b93[_0x24b7dd(0x158)](path_1[_0x24b7dd(0x16e)][_0x24b7dd(0x156)](_0x1b4ec9,_0x4779e6)))===null||_0x5acd9d===void 0x0?void 0x0:_0x5acd9d[_0x24b7dd(0x173)](_0x24b7dd(0x12f)));if(_0x6da0d5&&_0x187cde){const _0x27f2c6=new jszip_1[(_0x24b7dd(0x16e))]();_0x27f2c6[_0x24b7dd(0x158)](_0x517bed,_0x6da0d5),_0x27f2c6[_0x24b7dd(0x158)](_0x4779e6,this[_0x24b7dd(0x151)](_0x187cde)),_0x4968f3[_0x24b7dd(0x174)](_0x517bed)[_0x24b7dd(0x18a)]=await _0x27f2c6[_0x24b7dd(0x176)]({'type':'base64'});}}}}return _0x941d4b[_0x24b7dd(0x129)](_0x4163ed=>!_0x4163ed['body'])[_0x24b7dd(0x136)](_0x1179b2=>{const _0x106617=_0x24b7dd;this['_logger'][_0x106617(0x16b)](_0x106617(0x198)+_0x1179b2[_0x106617(0x161)]+'.'+_0x1179b2[_0x106617(0x154)]+_0x106617(0x17a));}),_0x941d4b[_0x24b7dd(0x129)](_0xfc5dfd=>_0xfc5dfd[_0x24b7dd(0x18a)]);}[a363_0x4c8c8e(0x151)](_0x414998){const _0x43c887=a363_0x4c8c8e,_0x81f25d=(0x0,sync_1[_0x43c887(0x193)])(_0x414998,{'columns':!![],'skip_empty_lines':!![]}),_0x248630=_0x81f25d[_0x43c887(0x185)](({'In\x20Package':_0x420c12,..._0x4224d8})=>_0x4224d8);return(0x0,sync_2[_0x43c887(0x138)])(_0x248630,{'header':!![]});}['formMetadataItemDtoList'](_0x467c8d){return _0x467c8d['map'](_0x4eb9d4=>{const _0x2e0b9c=a363_0x2780,_0x43fef1=new metadata_item_dto_1[(_0x2e0b9c(0x12b))]();return _0x43fef1['name']=_0x4eb9d4[_0x2e0b9c(0x154)],_0x43fef1['apiName']=_0x4eb9d4[_0x2e0b9c(0x154)],_0x43fef1['snapshotId']=this[_0x2e0b9c(0x170)],_0x43fef1['label']=_0x4eb9d4[_0x2e0b9c(0x1a3)]+'.'+_0x4eb9d4[_0x2e0b9c(0x154)]+veeva_constants_1['VeevaConstants'][_0x2e0b9c(0x19c)],_0x43fef1[_0x2e0b9c(0x161)]=_0x4eb9d4[_0x2e0b9c(0x1a3)],_0x43fef1[_0x2e0b9c(0x12c)]=_0x4eb9d4[_0x2e0b9c(0x12c)],_0x43fef1[_0x2e0b9c(0x16c)]=![],_0x43fef1;});}async[a363_0x4c8c8e(0x16d)](_0x505bfb){const _0x35d288=a363_0x4c8c8e;this['_logger'][_0x35d288(0x16b)](_0x35d288(0x159)),await this[_0x35d288(0x13b)](_0x505bfb),this[_0x35d288(0x14c)][_0x35d288(0x16b)](_0x35d288(0x19f)+_0x505bfb[_0x35d288(0x189)]+_0x35d288(0x153));const _0x1dcf16=_0x505bfb['map'](_0x47b0ec=>{const _0x13918a=_0x35d288;return{[constants_1[_0x13918a(0x197)]+'Name__c']:_0x47b0ec[_0x13918a(0x154)],[constants_1[_0x13918a(0x197)]+'API_Name__c']:_0x47b0ec[_0x13918a(0x195)],[constants_1[_0x13918a(0x197)]+'Snapshot__c']:_0x47b0ec[_0x13918a(0x1a1)],[constants_1['FLOSUM_NAMESPACE']+'Label__c']:_0x47b0ec[_0x13918a(0x13c)],[constants_1[_0x13918a(0x197)]+_0x13918a(0x18b)]:_0x47b0ec[_0x13918a(0x16c)],[constants_1[_0x13918a(0x197)]+_0x13918a(0x162)]:_0x47b0ec[_0x13918a(0x161)],[constants_1['FLOSUM_NAMESPACE']+_0x13918a(0x13d)]:_0x47b0ec[_0x13918a(0x130)],[constants_1[_0x13918a(0x197)]+_0x13918a(0x179)]:_0x47b0ec[_0x13918a(0x12c)]};}),_0x47cbfe=await this[_0x35d288(0x14d)][_0x35d288(0x155)](constants_1[_0x35d288(0x197)]+'Metadata_Item__c',_0x1dcf16);let _0x371757=!![];_0x47cbfe[_0x35d288(0x136)]((_0x54dd13,_0x2762ad)=>{const _0x3b19c8=_0x35d288;this['_logger'][_0x3b19c8(0x16b)](_0x3b19c8(0x19f)+_0x505bfb[_0x2762ad][_0x3b19c8(0x161)]+'.'+_0x505bfb[_0x2762ad]['name']);if(!_0x54dd13[_0x3b19c8(0x181)]){_0x371757=![];const _0xa725dc=new salesforce_dml_error_1[(_0x3b19c8(0x134))](_0x54dd13[_0x3b19c8(0x192)]);this['_logger'][_0x3b19c8(0x14e)](_0xa725dc);}});if(!_0x371757)throw new Error('Cannot\x20Save\x20Metadata\x20Items');}async[a363_0x4c8c8e(0x13b)](_0x3fa708){const _0x3dc6e5=a363_0x4c8c8e,_0x45fb46=this[_0x3dc6e5(0x15b)](_0x3fa708),_0x461324=await this['_salesforceService']['insertMultipleRecords'](SnapshotService[_0x3dc6e5(0x164)],_0x45fb46),_0x2e8214=[];_0x461324[_0x3dc6e5(0x136)]((_0x8cd98a,_0x323405)=>{const _0x16e1e8=_0x3dc6e5;_0x8cd98a[_0x16e1e8(0x181)]?(_0x3fa708[_0x323405][_0x16e1e8(0x130)]=_0x8cd98a['id'],_0x3fa708[_0x323405][_0x16e1e8(0x16c)]=!![]):_0x2e8214[_0x16e1e8(0x133)](..._0x8cd98a['errors']);});if(_0x2e8214[_0x3dc6e5(0x189)])throw new salesforce_dml_error_1[(_0x3dc6e5(0x134))](_0x2e8214);}['formAttachments'](_0x5a1a0c){const _0x49d2b1=a363_0x4c8c8e;return _0x5a1a0c[_0x49d2b1(0x185)](_0x546b17=>({'ParentId':this['_snapshotId'],'Name':_0x546b17['veevaComponentType'],'ContentType':_0x49d2b1(0x160),'Body':_0x546b17[_0x49d2b1(0x18a)],'Description':_0x546b17[_0x49d2b1(0x161)]}));}async[a363_0x4c8c8e(0x16a)](_0x196642){const _0x2aaeec=a363_0x4c8c8e,_0x27a04b={[constants_1[_0x2aaeec(0x197)]+_0x2aaeec(0x19e)]:!![],[constants_1['FLOSUM_NAMESPACE']+_0x2aaeec(0x169)]:!_0x196642},_0x17f983={[constants_1[_0x2aaeec(0x197)]+_0x2aaeec(0x169)]:!_0x196642,[constants_1[_0x2aaeec(0x197)]+_0x2aaeec(0x16f)]:_0x196642,[constants_1[_0x2aaeec(0x197)]+'Status__c']:_0x196642?status_enums_1[_0x2aaeec(0x183)][_0x2aaeec(0x12a)]:status_enums_1[_0x2aaeec(0x183)][_0x2aaeec(0x1a4)],[constants_1[_0x2aaeec(0x197)]+'Job_Completed__c']:!![]};await this[_0x2aaeec(0x149)][_0x2aaeec(0x142)](flosum_constants_1[_0x2aaeec(0x180)][_0x2aaeec(0x148)]+'/'+constants_1[_0x2aaeec(0x197)]+'Snapshot__c/'+this['_snapshotId'],_0x27a04b),await this['_connectionSalesforce'][_0x2aaeec(0x142)](flosum_constants_1['FlosumConstants'][_0x2aaeec(0x148)]+'/'+constants_1[_0x2aaeec(0x197)]+'Metadata_Log__c/'+this['_metadataLogId'],_0x17f983),this[_0x2aaeec(0x14c)][_0x2aaeec(0x16b)](_0x2aaeec(0x18e)+(_0x196642?_0x2aaeec(0x1a2):'with\x20error')+'.'),await this[_0x2aaeec(0x14c)]['updateLog']();}}exports[a363_0x4c8c8e(0x18f)]=SnapshotService,SnapshotService[a363_0x4c8c8e(0x144)]='Snapshot',SnapshotService[a363_0x4c8c8e(0x164)]=a363_0x4c8c8e(0x165);