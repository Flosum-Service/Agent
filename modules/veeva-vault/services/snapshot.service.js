const a363_0x1d5663=a363_0x186c;(function(_0x47d179,_0xff0e9e){const _0x268156=a363_0x186c,_0x43cc49=_0x47d179();while(!![]){try{const _0x5ab3da=-parseInt(_0x268156(0x99))/0x1*(-parseInt(_0x268156(0xd6))/0x2)+-parseInt(_0x268156(0xdd))/0x3+parseInt(_0x268156(0xeb))/0x4*(-parseInt(_0x268156(0xaf))/0x5)+parseInt(_0x268156(0xb2))/0x6+-parseInt(_0x268156(0xbf))/0x7+parseInt(_0x268156(0xf2))/0x8*(-parseInt(_0x268156(0x110))/0x9)+parseInt(_0x268156(0xf3))/0xa;if(_0x5ab3da===_0xff0e9e)break;else _0x43cc49['push'](_0x43cc49['shift']());}catch(_0x26e775){_0x43cc49['push'](_0x43cc49['shift']());}}}(a363_0x1df1,0x57693));const a363_0x267c7e=(function(){let _0x70ecbe=!![];return function(_0x496435,_0x43589a){const _0x438b13=_0x70ecbe?function(){const _0x5f4c67=a363_0x186c;if(_0x43589a){const _0x42d081=_0x43589a[_0x5f4c67(0xa6)](_0x496435,arguments);return _0x43589a=null,_0x42d081;}}:function(){};return _0x70ecbe=![],_0x438b13;};}()),a363_0x1dd83b=a363_0x267c7e(this,function(){const _0x40bdc0=a363_0x186c;return a363_0x1dd83b[_0x40bdc0(0xe5)]()[_0x40bdc0(0xb1)](_0x40bdc0(0xfd))[_0x40bdc0(0xe5)]()[_0x40bdc0(0xdc)](a363_0x1dd83b)[_0x40bdc0(0xb1)](_0x40bdc0(0xfd));});a363_0x1dd83b();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5aa7a1){const _0x38993a=a363_0x186c;return _0x5aa7a1&&_0x5aa7a1[_0x38993a(0xe7)]?_0x5aa7a1:{'default':_0x5aa7a1};};function a363_0x1df1(){const _0x2eb58d=['base64','createMetadataItemListWithBody','_veevaService','API_Name__c','COMPLETED','TypeVeevaComponentRetriever','apply','execute','EXCEPTION','Label__c','label','FlosumConstants','posix','csv-parse/sync','Last_Modified_Date__c','433385PBdxHn','body','search','2288850UiPdnV','FLOSUM_NAMESPACE','attachmentId','./veeva.service','file','_salesforceService','Is_Completed__c','VeevaConstants','Attachment_ID__c','generateAsync','snapshotId','Snapshot','../constants/veeva.constants','3826788pQSMHG','veevaComponentType','log','\x20Metadata\x20Items','logError','isRetrieved','../classes/errors/salesforce-dml-error','sep','\x20from\x20outbound\x20package','DEPENDENCY_EXTENSION','error','string','MetadataItemDto','_metadataLogId','_snapshotId','apiName','Saving\x20','../constants/flosum.constants','application/zip','MetadataLogStatus','has','Job_Completed__c','Veeva_Component_Type__c','2kJBgwX','_connectionSalesforce','type','./salesforce.service','retrieveVeevaComponents','filter','constructor','726507NfjTZD','length','transformDependencyFile','with\x20error','patch','MDL_EXTENSION','OUTBOUND_PACKAGE_NAME','../classes/retrievers/veeva-components/type.veeva-component.retriever','toString','default','__esModule','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','Is_Retrieved__c','saveComponentsInSalesforce','24HtndFF','SalesforceDmlError','path','formAttachments','lastModifiedDate','async','push','8GUubnz','12965390PFfqid','SalesforceService','_connectionVeeva','formMetadataItemDtoList','get','name','defineProperty','finishSnapshot','forEach','catch','(((.+)+)+)+$','success','_packageExportService','_selectedMetaTypes','Snapshot__c','../../../constants','updateLog','_whereClause','insertMultipleRecords','reduce','VeevaService','from','SnapshotService','Cannot\x20Save\x20Metadata\x20Items','retrieve','values','errors','Is_Error__c','map','3080799ddbycP','successfully','_selectedComponentMap','ATTACHMENT','Snapshot__c/','_logger','Cannot\x20retrieve\x20','join','jszip','ENDPOINT_UPSERT_RECORD','331247jyippI','Metadata_Item__c','../dtos/metadata-item.dto','set','saveAttachments','Snapshot\x20completed\x20','PackageExportService'];a363_0x1df1=function(){return _0x2eb58d;};return a363_0x1df1();}Object[a363_0x1d5663(0xf9)](exports,'__esModule',{'value':!![]}),exports[a363_0x1d5663(0x109)]=void 0x0;const jszip_1=__importDefault(require(a363_0x1d5663(0x118))),flosum_constants_1=require(a363_0x1d5663(0xd0)),veeva_service_1=require(a363_0x1d5663(0xb5)),metadata_item_dto_1=require(a363_0x1d5663(0x9b)),constants_1=require(a363_0x1d5663(0x102)),salesforce_service_1=require(a363_0x1d5663(0xd9)),status_enums_1=require('../enums/status.enums'),salesforce_dml_error_1=require(a363_0x1d5663(0xc5)),package_export_service_1=require('./package-export.service'),type_and_name_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever'),type_veeva_component_retriever_1=require(a363_0x1d5663(0xe4)),sync_1=require(a363_0x1d5663(0xad)),sync_2=require('csv-stringify/sync'),veeva_constants_1=require(a363_0x1d5663(0xbe)),path_1=__importDefault(require(a363_0x1d5663(0xed)));class SnapshotService{constructor({snapshotId:_0x5e9209,metadataLogId:_0x139132,selectedMetaTypes:_0x490731,selectedComponentMap:_0x46326a,whereClause:_0x4e7392},_0x482fd9,_0x284fe2,_0x2e5333){const _0x14d7d3=a363_0x1d5663;this[_0x14d7d3(0xd7)]=_0x482fd9,this[_0x14d7d3(0xf5)]=_0x284fe2,this['_logger']=_0x2e5333,this['_snapshotId']=_0x5e9209,this[_0x14d7d3(0xcc)]=_0x139132,this['_selectedMetaTypes']=_0x490731,this[_0x14d7d3(0x112)]=_0x46326a,this['_whereClause']=_0x4e7392,this[_0x14d7d3(0xa2)]=new veeva_service_1[(_0x14d7d3(0x107))]({'connection':this['_connectionVeeva'],'logger':this[_0x14d7d3(0x115)]}),this[_0x14d7d3(0xb7)]=new salesforce_service_1[(_0x14d7d3(0xf4))]({'connection':this[_0x14d7d3(0xd7)]}),this[_0x14d7d3(0xff)]=new package_export_service_1[(_0x14d7d3(0x9f))]({'veevaService':this[_0x14d7d3(0xa2)],'connection':this[_0x14d7d3(0xf5)],'logger':this['_logger']});}async[a363_0x1d5663(0xa7)](){const _0x10d4c7=a363_0x1d5663;try{this[_0x10d4c7(0x115)]['log']('Snapshot\x20started.');const _0x681bce=await this[_0x10d4c7(0xda)]();await this[_0x10d4c7(0x115)][_0x10d4c7(0x103)]();const _0x1b22c2=await this[_0x10d4c7(0xff)]['export'](_0x681bce,SnapshotService[_0x10d4c7(0xe3)]);await this[_0x10d4c7(0x115)]['updateLog']();const _0x57a2d6=await this[_0x10d4c7(0xa1)](_0x681bce,_0x1b22c2);await this[_0x10d4c7(0xea)](_0x57a2d6),await this['_logger'][_0x10d4c7(0x103)](),await this[_0x10d4c7(0xfa)](!![]);}catch(_0x348a81){this[_0x10d4c7(0x115)]['logError'](_0x348a81),await this[_0x10d4c7(0xfa)](![])[_0x10d4c7(0xfc)](_0x446e55=>this['_systemLogger'][_0x10d4c7(0xc9)](_0x446e55));}}async[a363_0x1d5663(0xda)](){const _0x2cd99=a363_0x1d5663,_0x45d428={'veevaService':this[_0x2cd99(0xa2)],'logger':this['_logger']},_0x25b411=Array[_0x2cd99(0x108)](Object[_0x2cd99(0x10c)](this['_selectedComponentMap']))[_0x2cd99(0xde)]?new type_and_name_veeva_component_retriever_1['TypeAndNameVeevaComponentRetriever']({'value':this[_0x2cd99(0x112)],..._0x45d428}):new type_veeva_component_retriever_1[(_0x2cd99(0xa5))]({'value':this[_0x2cd99(0x100)],'whereClause':this[_0x2cd99(0x104)],..._0x45d428});return _0x25b411[_0x2cd99(0x10b)]();}async[a363_0x1d5663(0xa1)](_0x9788c3,_0x3cd83d){const _0x31aba0=a363_0x1d5663;var _0x2be0a5,_0x1f37bd;this[_0x31aba0(0x115)][_0x31aba0(0xc1)](_0x31aba0(0xe8));const _0x14031b=this[_0x31aba0(0xf6)](_0x9788c3),_0x5bd40d=_0x14031b[_0x31aba0(0x106)]((_0x576e84,_0x44e84b)=>_0x576e84[_0x31aba0(0x9c)](_0x44e84b[_0x31aba0(0xaa)],_0x44e84b),new Map());for(const _0x5d9b11 of _0x3cd83d){for(const _0x2eb578 in _0x5d9b11['files']){const {base:_0x4009d7,name:_0x21cc88,dir:_0x202001}=path_1[_0x31aba0(0xe6)]['parse'](_0x2eb578),_0x12e073=_0x21cc88+veeva_constants_1[_0x31aba0(0xb9)][_0x31aba0(0xc8)];if(_0x5bd40d[_0x31aba0(0xd3)](_0x4009d7)){const _0x2fb712=await((_0x2be0a5=_0x5d9b11['file']([_0x202001,_0x4009d7][_0x31aba0(0x117)](path_1[_0x31aba0(0xe6)]['posix']['sep'])))===null||_0x2be0a5===void 0x0?void 0x0:_0x2be0a5[_0x31aba0(0xf0)](_0x31aba0(0xca))),_0x1d5581=await((_0x1f37bd=_0x5d9b11['file']([_0x202001,_0x12e073][_0x31aba0(0x117)](path_1[_0x31aba0(0xe6)][_0x31aba0(0xac)][_0x31aba0(0xc6)])))===null||_0x1f37bd===void 0x0?void 0x0:_0x1f37bd[_0x31aba0(0xf0)]('string'));if(_0x2fb712){const _0x839bfa=new jszip_1[(_0x31aba0(0xe6))]();_0x839bfa[_0x31aba0(0xb6)](_0x4009d7,_0x2fb712),_0x1d5581&&_0x839bfa[_0x31aba0(0xb6)](_0x12e073,this[_0x31aba0(0xdf)](_0x1d5581)),_0x5bd40d[_0x31aba0(0xf7)](_0x4009d7)[_0x31aba0(0xb0)]=await _0x839bfa[_0x31aba0(0xbb)]({'type':_0x31aba0(0xa0)});}}}}return _0x14031b['filter'](_0x278a3c=>!_0x278a3c[_0x31aba0(0xb0)])[_0x31aba0(0xfb)](_0x3344a7=>{const _0x11154c=_0x31aba0;this[_0x11154c(0x115)]['log'](_0x11154c(0x116)+_0x3344a7['veevaComponentType']+'.'+_0x3344a7[_0x11154c(0xf8)]+_0x11154c(0xc7));}),_0x14031b[_0x31aba0(0xdb)](_0x19539d=>_0x19539d[_0x31aba0(0xb0)]);}['transformDependencyFile'](_0xd3a1e7){const _0x58231e=a363_0x1d5663,_0x3285d8=(0x0,sync_1['parse'])(_0xd3a1e7,{'columns':!![],'skip_empty_lines':!![]}),_0x4f112b=_0x3285d8[_0x58231e(0x10f)](({'In\x20Package':_0x3e4c54,..._0x1c1a4f})=>_0x1c1a4f);return(0x0,sync_2['stringify'])(_0x4f112b,{'header':!![]});}['formMetadataItemDtoList'](_0x4d291a){const _0x32ed74=a363_0x1d5663;return _0x4d291a[_0x32ed74(0x10f)](_0x117672=>{const _0x417317=_0x32ed74,_0x1a7bcb=new metadata_item_dto_1[(_0x417317(0xcb))]();return _0x1a7bcb[_0x417317(0xf8)]=_0x117672[_0x417317(0xf8)],_0x1a7bcb[_0x417317(0xce)]=_0x117672['name'],_0x1a7bcb[_0x417317(0xbc)]=this[_0x417317(0xcd)],_0x1a7bcb[_0x417317(0xaa)]=_0x117672[_0x417317(0xd8)]+'.'+_0x117672[_0x417317(0xf8)]+veeva_constants_1[_0x417317(0xb9)][_0x417317(0xe2)],_0x1a7bcb[_0x417317(0xc0)]=_0x117672[_0x417317(0xd8)],_0x1a7bcb[_0x417317(0xef)]=_0x117672[_0x417317(0xef)],_0x1a7bcb[_0x417317(0xc4)]=![],_0x1a7bcb;});}async[a363_0x1d5663(0xea)](_0x2fb54d){const _0x1714c0=a363_0x1d5663;this['_logger'][_0x1714c0(0xc1)]('Saving\x20Attachments.'),await this[_0x1714c0(0x9d)](_0x2fb54d),this[_0x1714c0(0x115)][_0x1714c0(0xc1)](_0x1714c0(0xcf)+_0x2fb54d['length']+_0x1714c0(0xc2));const _0x263d87=_0x2fb54d['map'](_0x44e1aa=>{const _0xec7f96=_0x1714c0;return{[constants_1['FLOSUM_NAMESPACE']+'Name__c']:_0x44e1aa[_0xec7f96(0xf8)],[constants_1['FLOSUM_NAMESPACE']+_0xec7f96(0xa3)]:_0x44e1aa['apiName'],[constants_1[_0xec7f96(0xb3)]+_0xec7f96(0x101)]:_0x44e1aa[_0xec7f96(0xbc)],[constants_1[_0xec7f96(0xb3)]+_0xec7f96(0xa9)]:_0x44e1aa[_0xec7f96(0xaa)],[constants_1[_0xec7f96(0xb3)]+_0xec7f96(0xe9)]:_0x44e1aa[_0xec7f96(0xc4)],[constants_1[_0xec7f96(0xb3)]+_0xec7f96(0xd5)]:_0x44e1aa['veevaComponentType'],[constants_1['FLOSUM_NAMESPACE']+_0xec7f96(0xba)]:_0x44e1aa[_0xec7f96(0xb4)],[constants_1[_0xec7f96(0xb3)]+_0xec7f96(0xae)]:_0x44e1aa['lastModifiedDate']};}),_0x17b672=await this['_salesforceService'][_0x1714c0(0x105)](constants_1[_0x1714c0(0xb3)]+_0x1714c0(0x9a),_0x263d87);let _0x1b624a=!![];_0x17b672['forEach']((_0x515ec7,_0x375233)=>{const _0x2f5cc2=_0x1714c0;this[_0x2f5cc2(0x115)][_0x2f5cc2(0xc1)](_0x2f5cc2(0xcf)+_0x2fb54d[_0x375233][_0x2f5cc2(0xc0)]+'.'+_0x2fb54d[_0x375233][_0x2f5cc2(0xf8)]);if(!_0x515ec7[_0x2f5cc2(0xfe)]){_0x1b624a=![];const _0x242ffd=new salesforce_dml_error_1[(_0x2f5cc2(0xec))](_0x515ec7[_0x2f5cc2(0x10d)]);this[_0x2f5cc2(0x115)][_0x2f5cc2(0xc3)](_0x242ffd);}});if(!_0x1b624a)throw new Error(_0x1714c0(0x10a));}async[a363_0x1d5663(0x9d)](_0x19cc12){const _0x36d6c6=a363_0x1d5663,_0xa8b6f6=this[_0x36d6c6(0xee)](_0x19cc12),_0x470f52=await this['_salesforceService'][_0x36d6c6(0x105)](SnapshotService[_0x36d6c6(0x113)],_0xa8b6f6),_0x401e03=[];_0x470f52[_0x36d6c6(0xfb)]((_0x25c17c,_0x451b28)=>{const _0x33dad6=_0x36d6c6;_0x25c17c[_0x33dad6(0xfe)]?(_0x19cc12[_0x451b28][_0x33dad6(0xb4)]=_0x25c17c['id'],_0x19cc12[_0x451b28]['isRetrieved']=!![]):_0x401e03[_0x33dad6(0xf1)](..._0x25c17c[_0x33dad6(0x10d)]);});if(_0x401e03[_0x36d6c6(0xde)])throw new salesforce_dml_error_1[(_0x36d6c6(0xec))](_0x401e03);}[a363_0x1d5663(0xee)](_0x25a4b6){const _0x32c891=a363_0x1d5663;return _0x25a4b6['map'](_0x1b3208=>({'ParentId':this[_0x32c891(0xcd)],'Name':_0x1b3208[_0x32c891(0xc0)],'ContentType':_0x32c891(0xd1),'Body':_0x1b3208['body'],'Description':_0x1b3208[_0x32c891(0xc0)]}));}async[a363_0x1d5663(0xfa)](_0x44f37d){const _0x1f042d=a363_0x1d5663,_0xa8867a={[constants_1[_0x1f042d(0xb3)]+_0x1f042d(0xb8)]:!![],[constants_1[_0x1f042d(0xb3)]+'Is_Error__c']:!_0x44f37d},_0x429c02={[constants_1[_0x1f042d(0xb3)]+_0x1f042d(0x10e)]:!_0x44f37d,[constants_1[_0x1f042d(0xb3)]+'Succeed__c']:_0x44f37d,[constants_1[_0x1f042d(0xb3)]+'Status__c']:_0x44f37d?status_enums_1['MetadataLogStatus'][_0x1f042d(0xa4)]:status_enums_1[_0x1f042d(0xd2)][_0x1f042d(0xa8)],[constants_1[_0x1f042d(0xb3)]+_0x1f042d(0xd4)]:!![]};await this[_0x1f042d(0xd7)][_0x1f042d(0xe1)](flosum_constants_1['FlosumConstants'][_0x1f042d(0x119)]+'/'+constants_1[_0x1f042d(0xb3)]+_0x1f042d(0x114)+this[_0x1f042d(0xcd)],_0xa8867a),await this[_0x1f042d(0xd7)]['patch'](flosum_constants_1[_0x1f042d(0xab)][_0x1f042d(0x119)]+'/'+constants_1[_0x1f042d(0xb3)]+'Metadata_Log__c/'+this['_metadataLogId'],_0x429c02),this['_logger'][_0x1f042d(0xc1)](_0x1f042d(0x9e)+(_0x44f37d?_0x1f042d(0x111):_0x1f042d(0xe0))+'.'),await this[_0x1f042d(0x115)]['updateLog']();}}function a363_0x186c(_0xe6b33b,_0x339bc7){const _0x344827=a363_0x1df1();return a363_0x186c=function(_0x1dd83b,_0x267c7e){_0x1dd83b=_0x1dd83b-0x99;let _0x1df14d=_0x344827[_0x1dd83b];return _0x1df14d;},a363_0x186c(_0xe6b33b,_0x339bc7);}exports[a363_0x1d5663(0x109)]=SnapshotService,SnapshotService[a363_0x1d5663(0xe3)]=a363_0x1d5663(0xbd),SnapshotService[a363_0x1d5663(0x113)]='Attachment';