const a362_0x4872ba=a362_0x1ee0;(function(_0x3608cb,_0x28b3ca){const _0x9f6da0=a362_0x1ee0,_0xdccf96=_0x3608cb();while(!![]){try{const _0x54aa66=parseInt(_0x9f6da0(0xf7))/0x1*(-parseInt(_0x9f6da0(0xe2))/0x2)+parseInt(_0x9f6da0(0xcc))/0x3*(-parseInt(_0x9f6da0(0xc6))/0x4)+parseInt(_0x9f6da0(0xe7))/0x5*(-parseInt(_0x9f6da0(0xfb))/0x6)+parseInt(_0x9f6da0(0x89))/0x7*(-parseInt(_0x9f6da0(0xbb))/0x8)+-parseInt(_0x9f6da0(0xc7))/0x9+-parseInt(_0x9f6da0(0xd7))/0xa+parseInt(_0x9f6da0(0xad))/0xb;if(_0x54aa66===_0x28b3ca)break;else _0xdccf96['push'](_0xdccf96['shift']());}catch(_0x1bd303){_0xdccf96['push'](_0xdccf96['shift']());}}}(a362_0x21b8,0x6b63a));const a362_0x12643f=(function(){let _0x3d0f92=!![];return function(_0x22252c,_0x30c4fd){const _0x33335d=_0x3d0f92?function(){if(_0x30c4fd){const _0x3a6285=_0x30c4fd['apply'](_0x22252c,arguments);return _0x30c4fd=null,_0x3a6285;}}:function(){};return _0x3d0f92=![],_0x33335d;};}()),a362_0x2d0e74=a362_0x12643f(this,function(){const _0x1149e6=a362_0x1ee0;return a362_0x2d0e74[_0x1149e6(0xd5)]()[_0x1149e6(0x97)](_0x1149e6(0xa2))[_0x1149e6(0xd5)]()['constructor'](a362_0x2d0e74)['search']('(((.+)+)+)+$');});function a362_0x21b8(){const _0x16f2ac=['search','Snapshot__c','__esModule','Veeva_Component_Type__c','MetadataLogStatus','Label__c','length','saveAttachments','Name__c','has','createMetadataItemListWithBody','(((.+)+)+)+$','with\x20error','logError','_salesforceService','Is_Error__c','./veeva.service','Metadata_Log__c/','../enums/status.enums','./package-export.service','selectedComponentMap','isRetrieved','24152414lWaEum','_connectionVeeva','transformDependencyFile','file','finishSnapshot','\x20Metadata\x20Items','defineProperty','_packageExportService','../../../constants','retrieve','Cannot\x20retrieve\x20','string','_logger','../classes/retrievers/veeva-components/type-and-name.veeva-component.retriever','248neRJaJ','Cannot\x20Save\x20Metadata\x20Items','apiName','ATTACHMENT','metadataLogId','_timeZone','snapshotId','MetadataItemDto','filter','../classes/errors/salesforce-dml-error','path','4GSijIZ','1082655DGIRii','success','export','successfully','csv-stringify/sync','122652WHTzjW','TypeAndNameVeevaComponentRetriever','application/zip','_systemLogger','default','lastModifiedDate','saveComponentsInSalesforce','_connectionSalesforce','\x20from\x20outbound\x20package','toString','forEach','8603440KhlOyR','SnapshotService','VeevaConstants','error','Attachment_ID__c','files','csv-parse/sync','Status__c','Is_Completed__c','execute','ENDPOINT_UPSERT_RECORD','2bmTCWl','Unpack\x20zip\x20and\x20create\x20metadata\x20items.','parse','errors','get','10heyWcG','name','insertMultipleRecords','label','Saving\x20','_attachmentLogId','set','join','DEPENDENCY_EXTENSION','posix','formAttachments','formMetadataItemDtoList','VeevaService','catch','jszip','_selectedMetaTypes','13622RGVSLY','patch','from','body','885750Pcwxlu','OUTBOUND_PACKAGE_NAME','stringify','FLOSUM_NAMESPACE','attachmentId','values','sep','_metadataLogId','reduce','FlosumConstants','retrieveVeevaComponents','96061vGPOmS','_snapshotId','async','_veevaService','updateLog','Snapshot\x20completed\x20','map','selectedMetaTypes','_selectedComponentMap','log','veevaComponentType','SalesforceDmlError','EXCEPTION','SalesforceService'];a362_0x21b8=function(){return _0x16f2ac;};return a362_0x21b8();}a362_0x2d0e74();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x303bd8){const _0xc19f37=a362_0x1ee0;return _0x303bd8&&_0x303bd8[_0xc19f37(0x99)]?_0x303bd8:{'default':_0x303bd8};};function a362_0x1ee0(_0x4414d0,_0x4139bc){const _0x3b5e1a=a362_0x21b8();return a362_0x1ee0=function(_0x2d0e74,_0x12643f){_0x2d0e74=_0x2d0e74-0x84;let _0x21b860=_0x3b5e1a[_0x2d0e74];return _0x21b860;},a362_0x1ee0(_0x4414d0,_0x4139bc);}Object[a362_0x4872ba(0xb3)](exports,'__esModule',{'value':!![]}),exports[a362_0x4872ba(0xd8)]=void 0x0;const jszip_1=__importDefault(require(a362_0x4872ba(0xf5))),flosum_constants_1=require('../constants/flosum.constants'),veeva_service_1=require(a362_0x4872ba(0xa7)),metadata_item_dto_1=require('../dtos/metadata-item.dto'),constants_1=require(a362_0x4872ba(0xb5)),salesforce_service_1=require('./salesforce.service'),status_enums_1=require(a362_0x4872ba(0xa9)),salesforce_dml_error_1=require(a362_0x4872ba(0xc4)),package_export_service_1=require(a362_0x4872ba(0xaa)),type_and_name_veeva_component_retriever_1=require(a362_0x4872ba(0xba)),type_veeva_component_retriever_1=require('../classes/retrievers/veeva-components/type.veeva-component.retriever'),sync_1=require(a362_0x4872ba(0xdd)),sync_2=require(a362_0x4872ba(0xcb)),veeva_constants_1=require('../constants/veeva.constants'),path_1=__importDefault(require(a362_0x4872ba(0xc5)));class SnapshotService{constructor(_0x1806c7,_0x40c2d2,_0x17eaca,_0x477381){const _0xfa40ad=a362_0x4872ba;this[_0xfa40ad(0xd3)]=_0x40c2d2,this['_connectionVeeva']=_0x17eaca,this[_0xfa40ad(0xb9)]=_0x477381,this[_0xfa40ad(0x8a)]=_0x1806c7['snapshotId'],this[_0xfa40ad(0x85)]=_0x1806c7[_0xfa40ad(0xbf)],this[_0xfa40ad(0xec)]=_0x1806c7['attachmentLogId'],this[_0xfa40ad(0xc0)]=_0x1806c7['timeZone'],this[_0xfa40ad(0xf6)]=_0x1806c7[_0xfa40ad(0x90)],this[_0xfa40ad(0x91)]=_0x1806c7[_0xfa40ad(0xab)],this[_0xfa40ad(0x8c)]=new veeva_service_1[(_0xfa40ad(0xf3))]({'connection':this[_0xfa40ad(0xae)],'logger':this['_logger']}),this[_0xfa40ad(0xa5)]=new salesforce_service_1[(_0xfa40ad(0x96))]({'connection':this['_connectionSalesforce']}),this[_0xfa40ad(0xb4)]=new package_export_service_1['PackageExportService']({'veevaService':this[_0xfa40ad(0x8c)],'connection':this[_0xfa40ad(0xae)],'logger':this[_0xfa40ad(0xb9)]});}async[a362_0x4872ba(0xe0)](){const _0x225ba5=a362_0x4872ba;try{this[_0x225ba5(0xb9)][_0x225ba5(0x92)]('Snapshot\x20started.');const _0x517be9=await this[_0x225ba5(0x88)]();await this[_0x225ba5(0xb9)]['updateLog']();const _0x4bfbb3=await this[_0x225ba5(0xb4)][_0x225ba5(0xc9)](_0x517be9,SnapshotService[_0x225ba5(0xfc)]);await this['_logger']['updateLog']();const _0x39796e=await this['createMetadataItemListWithBody'](_0x517be9,_0x4bfbb3);await this[_0x225ba5(0xd2)](_0x39796e),await this[_0x225ba5(0xb9)][_0x225ba5(0x8d)](),await this['finishSnapshot'](!![]);}catch(_0x3dd6d3){this['_logger'][_0x225ba5(0xa4)](_0x3dd6d3),await this[_0x225ba5(0xb1)](![])[_0x225ba5(0xf4)](_0x2c9e17=>this[_0x225ba5(0xcf)][_0x225ba5(0xda)](_0x2c9e17));}}async[a362_0x4872ba(0x88)](){const _0x4f7f46=a362_0x4872ba,_0x1339f3={'veevaService':this[_0x4f7f46(0x8c)],'logger':this['_logger']},_0x4824d7=Array[_0x4f7f46(0xf9)](Object[_0x4f7f46(0x100)](this[_0x4f7f46(0x91)]))['length']?new type_and_name_veeva_component_retriever_1[(_0x4f7f46(0xcd))]({'value':this[_0x4f7f46(0x91)],..._0x1339f3}):new type_veeva_component_retriever_1['TypeVeevaComponentRetriever']({'value':this['_selectedMetaTypes'],..._0x1339f3});return _0x4824d7[_0x4f7f46(0xb6)]();}async[a362_0x4872ba(0xa1)](_0x4e9511,_0x4d5276){const _0xc6f2e=a362_0x4872ba;var _0xda2482,_0x425b83;this[_0xc6f2e(0xb9)]['log'](_0xc6f2e(0xe3));const _0x442011=this[_0xc6f2e(0xf2)](_0x4e9511),_0x52f149=_0x442011[_0xc6f2e(0x86)]((_0x41c845,_0x204209)=>_0x41c845[_0xc6f2e(0xed)](_0x204209[_0xc6f2e(0xea)],_0x204209),new Map());for(const _0x4da749 of _0x4d5276){for(const _0x52831a in _0x4da749[_0xc6f2e(0xdc)]){const {base:_0x48870b,name:_0x3c60d6,dir:_0x5cca4b}=path_1[_0xc6f2e(0xd0)][_0xc6f2e(0xe4)](_0x52831a),_0x4d39cd=_0x3c60d6+veeva_constants_1[_0xc6f2e(0xd9)][_0xc6f2e(0xef)];if(_0x52f149[_0xc6f2e(0xa0)](_0x48870b)){const _0x86620d=await((_0xda2482=_0x4da749[_0xc6f2e(0xb0)]([_0x5cca4b,_0x48870b]['join'](path_1[_0xc6f2e(0xd0)][_0xc6f2e(0xf0)]['sep'])))===null||_0xda2482===void 0x0?void 0x0:_0xda2482[_0xc6f2e(0x8b)](_0xc6f2e(0xb8))),_0x3788b6=await((_0x425b83=_0x4da749[_0xc6f2e(0xb0)]([_0x5cca4b,_0x4d39cd][_0xc6f2e(0xee)](path_1[_0xc6f2e(0xd0)]['posix'][_0xc6f2e(0x84)])))===null||_0x425b83===void 0x0?void 0x0:_0x425b83['async'](_0xc6f2e(0xb8)));if(_0x86620d){const _0x309f27=new jszip_1[(_0xc6f2e(0xd0))]();_0x309f27[_0xc6f2e(0xb0)](_0x48870b,_0x86620d),_0x3788b6&&_0x309f27[_0xc6f2e(0xb0)](_0x4d39cd,this['transformDependencyFile'](_0x3788b6)),_0x52f149[_0xc6f2e(0xe6)](_0x48870b)['body']=await _0x309f27['generateAsync']({'type':'base64'});}}}}return _0x442011[_0xc6f2e(0xc3)](_0x285f19=>!_0x285f19['body'])['forEach'](_0x1a3868=>{const _0x5a39d8=_0xc6f2e;this[_0x5a39d8(0xb9)][_0x5a39d8(0x92)](_0x5a39d8(0xb7)+_0x1a3868['veevaComponentType']+'.'+_0x1a3868[_0x5a39d8(0xe8)]+_0x5a39d8(0xd4));}),_0x442011['filter'](_0x23243c=>_0x23243c[_0xc6f2e(0xfa)]);}[a362_0x4872ba(0xaf)](_0x44627){const _0x87d4ac=a362_0x4872ba,_0xeadc5=(0x0,sync_1[_0x87d4ac(0xe4)])(_0x44627,{'columns':!![],'skip_empty_lines':!![]}),_0x91a871=_0xeadc5['map'](({'In\x20Package':_0x14e930,..._0x367b3b})=>_0x367b3b);return(0x0,sync_2[_0x87d4ac(0xfd)])(_0x91a871,{'header':!![]});}[a362_0x4872ba(0xf2)](_0x31ce9d){return _0x31ce9d['map'](_0x45011e=>{const _0x11996b=a362_0x1ee0,_0x1bf2dc=new metadata_item_dto_1[(_0x11996b(0xc2))]();return _0x1bf2dc[_0x11996b(0xe8)]=_0x45011e[_0x11996b(0xe8)],_0x1bf2dc[_0x11996b(0xbd)]=_0x45011e[_0x11996b(0xe8)],_0x1bf2dc[_0x11996b(0xc1)]=this[_0x11996b(0x8a)],_0x1bf2dc[_0x11996b(0xea)]=_0x45011e['type']+'.'+_0x45011e[_0x11996b(0xe8)]+veeva_constants_1[_0x11996b(0xd9)]['MDL_EXTENSION'],_0x1bf2dc[_0x11996b(0x93)]=_0x45011e['type'],_0x1bf2dc[_0x11996b(0xd1)]=_0x45011e[_0x11996b(0xd1)],_0x1bf2dc[_0x11996b(0xac)]=![],_0x1bf2dc;});}async[a362_0x4872ba(0xd2)](_0x1f9d01){const _0x2ba8ab=a362_0x4872ba;this[_0x2ba8ab(0xb9)][_0x2ba8ab(0x92)]('Saving\x20Attachments.'),await this[_0x2ba8ab(0x9e)](_0x1f9d01),this[_0x2ba8ab(0xb9)][_0x2ba8ab(0x92)](_0x2ba8ab(0xeb)+_0x1f9d01[_0x2ba8ab(0x9d)]+_0x2ba8ab(0xb2));const _0x97c31e=_0x1f9d01[_0x2ba8ab(0x8f)](_0x7c93c7=>{const _0x202fe2=_0x2ba8ab;return{[constants_1[_0x202fe2(0xfe)]+_0x202fe2(0x9f)]:_0x7c93c7[_0x202fe2(0xe8)],[constants_1['FLOSUM_NAMESPACE']+'API_Name__c']:_0x7c93c7[_0x202fe2(0xbd)],[constants_1[_0x202fe2(0xfe)]+_0x202fe2(0x98)]:_0x7c93c7[_0x202fe2(0xc1)],[constants_1[_0x202fe2(0xfe)]+_0x202fe2(0x9c)]:_0x7c93c7[_0x202fe2(0xea)],[constants_1['FLOSUM_NAMESPACE']+'Is_Retrieved__c']:_0x7c93c7[_0x202fe2(0xac)],[constants_1[_0x202fe2(0xfe)]+_0x202fe2(0x9a)]:_0x7c93c7[_0x202fe2(0x93)],[constants_1[_0x202fe2(0xfe)]+_0x202fe2(0xdb)]:_0x7c93c7[_0x202fe2(0xff)],[constants_1[_0x202fe2(0xfe)]+'Last_Modified_Date__c']:_0x7c93c7[_0x202fe2(0xd1)]};}),_0x35c1aa=await this[_0x2ba8ab(0xa5)][_0x2ba8ab(0xe9)](constants_1[_0x2ba8ab(0xfe)]+'Metadata_Item__c',_0x97c31e);let _0x3203e9=!![];_0x35c1aa[_0x2ba8ab(0xd6)]((_0x4c70ce,_0x48c138)=>{const _0x50e186=_0x2ba8ab;this[_0x50e186(0xb9)]['log'](_0x50e186(0xeb)+_0x1f9d01[_0x48c138][_0x50e186(0x93)]+'.'+_0x1f9d01[_0x48c138][_0x50e186(0xe8)]);if(!_0x4c70ce[_0x50e186(0xc8)]){_0x3203e9=![];const _0x440f4c=new salesforce_dml_error_1[(_0x50e186(0x94))](_0x4c70ce[_0x50e186(0xe5)]);this[_0x50e186(0xb9)][_0x50e186(0xa4)](_0x440f4c);}});if(!_0x3203e9)throw new Error(_0x2ba8ab(0xbc));}async[a362_0x4872ba(0x9e)](_0x25836a){const _0x22cc55=a362_0x4872ba,_0x52c0c3=this[_0x22cc55(0xf1)](_0x25836a),_0x315820=await this[_0x22cc55(0xa5)][_0x22cc55(0xe9)](SnapshotService[_0x22cc55(0xbe)],_0x52c0c3),_0x3dd50f=[];_0x315820[_0x22cc55(0xd6)]((_0x1c0a1f,_0x71e00)=>{const _0x3fb280=_0x22cc55;_0x1c0a1f[_0x3fb280(0xc8)]?(_0x25836a[_0x71e00][_0x3fb280(0xff)]=_0x1c0a1f['id'],_0x25836a[_0x71e00][_0x3fb280(0xac)]=!![]):_0x3dd50f['push'](..._0x1c0a1f[_0x3fb280(0xe5)]);});if(_0x3dd50f[_0x22cc55(0x9d)])throw new salesforce_dml_error_1[(_0x22cc55(0x94))](_0x3dd50f);}['formAttachments'](_0x544236){const _0x20a4bd=a362_0x4872ba;return _0x544236['map'](_0x4ca07a=>({'ParentId':this[_0x20a4bd(0x8a)],'Name':_0x4ca07a[_0x20a4bd(0x93)],'ContentType':_0x20a4bd(0xce),'Body':_0x4ca07a['body'],'Description':_0x4ca07a['veevaComponentType']}));}async[a362_0x4872ba(0xb1)](_0x41ef82){const _0x1212a0=a362_0x4872ba,_0x4166fe={[constants_1[_0x1212a0(0xfe)]+_0x1212a0(0xdf)]:!![],[constants_1[_0x1212a0(0xfe)]+'Is_Error__c']:!_0x41ef82},_0x47f338={[constants_1[_0x1212a0(0xfe)]+_0x1212a0(0xa6)]:!_0x41ef82,[constants_1[_0x1212a0(0xfe)]+'Succeed__c']:_0x41ef82,[constants_1[_0x1212a0(0xfe)]+_0x1212a0(0xde)]:_0x41ef82?status_enums_1[_0x1212a0(0x9b)]['COMPLETED']:status_enums_1[_0x1212a0(0x9b)][_0x1212a0(0x95)],[constants_1['FLOSUM_NAMESPACE']+'Job_Completed__c']:!![]};await this['_connectionSalesforce']['patch'](flosum_constants_1[_0x1212a0(0x87)]['ENDPOINT_UPSERT_RECORD']+'/'+constants_1[_0x1212a0(0xfe)]+'Snapshot__c/'+this['_snapshotId'],_0x4166fe),await this[_0x1212a0(0xd3)][_0x1212a0(0xf8)](flosum_constants_1['FlosumConstants'][_0x1212a0(0xe1)]+'/'+constants_1['FLOSUM_NAMESPACE']+_0x1212a0(0xa8)+this[_0x1212a0(0x85)],_0x47f338),this[_0x1212a0(0xb9)]['log'](_0x1212a0(0x8e)+(_0x41ef82?_0x1212a0(0xca):_0x1212a0(0xa3))+'.'),await this['_logger'][_0x1212a0(0x8d)]();}}exports['SnapshotService']=SnapshotService,SnapshotService[a362_0x4872ba(0xfc)]='Snapshot',SnapshotService[a362_0x4872ba(0xbe)]='Attachment';