const a391_0x11db49=a391_0x2aa9;function a391_0x1349(){const _0x3cb304=['VeevaConstants','filter','map','default','put','7032JJMnXK','responseStatus','file','getJobDetailUrl','../classes/errors/veeva-error','deploymentAction','1035090bCEXsE','data','responseDetails','import','1485605gjgQua','includes','_veevaService','search','PackageComponentStatus','_connection','name__v','VERIFIED','ArrayUtils','getValidationDetailsAndSaveLog','find','1981VqBInD','Deployment.log','deployment_status__v','Package\x20not\x20verified','Validation\x20Log','log','toString','artifacts','filename','formPackageComponentList','12jQItaQ','Get\x20validation\x20details.','replace','(((.+)+)+)+$','groupToMap','apply','../enums/status.enums','getJobResult','37POpEOH','PackageDetailsDto','packageComponentList','Import\x20package','convertDeploymentAction','get','updateVeevaConnection','length','url','VeevaResponseStatus','2942751cHMwld','deployPackage','status','_saveLog','importVpk','uniqueName','text','vaultPackage','getLogResultText','VeevaPackageStatus','form-data','21095767xkqbQb','errors','defineProperty','../utils/veeva-auth.utils','package_components','__esModule','Deploy\x20package','reduce','SUCCESS','fillPackageDeploymentAction','packageId','Cannot\x20find\x20deployment\x20results','createReadStream','__importDefault','VeevaError','19148sAtQYR','DEPLOYED','Deploy\x20Log','_logger','40TiMYqm','links','append','endsWith','Wait\x20Executing\x20job','DEPLOYED_WITH_WARNINGS','multipart/form-data','post','{package_id}','3052352dfkFdg','getDeployDetailsAndSaveLog','../constants/veeva.constants','Validation.log'];a391_0x1349=function(){return _0x3cb304;};return a391_0x1349();}(function(_0x556379,_0x591c46){const _0x8e0f4c=a391_0x2aa9,_0x509fad=_0x556379();while(!![]){try{const _0x367c58=-parseInt(_0x8e0f4c(0x92))/0x1*(-parseInt(_0x8e0f4c(0xb6))/0x2)+parseInt(_0x8e0f4c(0x9c))/0x3+parseInt(_0x8e0f4c(0xc3))/0x4+parseInt(_0x8e0f4c(0x75))/0x5*(parseInt(_0x8e0f4c(0x8a))/0x6)+parseInt(_0x8e0f4c(0x80))/0x7*(parseInt(_0x8e0f4c(0xcc))/0x8)+-parseInt(_0x8e0f4c(0x71))/0x9*(parseInt(_0x8e0f4c(0xba))/0xa)+-parseInt(_0x8e0f4c(0xa7))/0xb;if(_0x367c58===_0x591c46)break;else _0x509fad['push'](_0x509fad['shift']());}catch(_0x45c05e){_0x509fad['push'](_0x509fad['shift']());}}}(a391_0x1349,0x898cd));function a391_0x2aa9(_0x2f7de8,_0x24a883){const _0x1074db=a391_0x1349();return a391_0x2aa9=function(_0x559550,_0x50963c){_0x559550=_0x559550-0x6f;let _0x1349a6=_0x1074db[_0x559550];return _0x1349a6;},a391_0x2aa9(_0x2f7de8,_0x24a883);}const a391_0x50963c=(function(){let _0x29d54d=!![];return function(_0x141e97,_0x18b223){const _0x25a3ce=_0x29d54d?function(){const _0x1332b7=a391_0x2aa9;if(_0x18b223){const _0x5cb261=_0x18b223[_0x1332b7(0x8f)](_0x141e97,arguments);return _0x18b223=null,_0x5cb261;}}:function(){};return _0x29d54d=![],_0x25a3ce;};}()),a391_0x559550=a391_0x50963c(this,function(){const _0x564a42=a391_0x2aa9;return a391_0x559550[_0x564a42(0x86)]()[_0x564a42(0x78)](_0x564a42(0x8d))[_0x564a42(0x86)]()['constructor'](a391_0x559550)[_0x564a42(0x78)](_0x564a42(0x8d));});a391_0x559550();'use strict';var __importDefault=this&&this[a391_0x11db49(0xb4)]||function(_0x3485da){const _0x1bca80=a391_0x11db49;return _0x3485da&&_0x3485da[_0x1bca80(0xac)]?_0x3485da:{'default':_0x3485da};};Object[a391_0x11db49(0xa9)](exports,a391_0x11db49(0xac),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require(a391_0x11db49(0xc5)),status_enums_1=require(a391_0x11db49(0x90)),veeva_error_1=require(a391_0x11db49(0x6f)),form_data_1=__importDefault(require(a391_0x11db49(0xa6))),fs_1=require('fs'),veeva_auth_utils_1=require(a391_0x11db49(0xaa)),package_details_dto_1=require('../dtos/package-details.dto'),package_component_dto_1=require('../dtos/package-component.dto'),array_utils_1=require('../utils/array.utils');class PackageImportService{constructor({veevaService:_0x46360b,connection:_0x2f2340,logger:_0x4d3baa,saveLog:_0x50953e}){const _0x1297b7=a391_0x11db49;this[_0x1297b7(0x77)]=_0x46360b,this[_0x1297b7(0x7a)]=_0x2f2340,this[_0x1297b7(0xb9)]=_0x4d3baa,this[_0x1297b7(0x9f)]=_0x50953e;}async['importVpk'](_0x1c0e84,_0x176481=0x1){const _0xb4e9a2=a391_0x11db49;this['_logger'][_0xb4e9a2(0x85)](_0xb4e9a2(0x95));const _0x5400a4=new form_data_1[(_0xb4e9a2(0xca))]();_0x5400a4[_0xb4e9a2(0xbc)](_0xb4e9a2(0xce),(0x0,fs_1[_0xb4e9a2(0xb3)])(_0x1c0e84));const _0x39240e=await this['_connection'][_0xb4e9a2(0xcb)](veeva_constants_1[_0xb4e9a2(0xc7)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x5400a4,{'headers':{'Content-Type':_0xb4e9a2(0xc0)}}),_0x1864ba=_0x39240e[_0xb4e9a2(0x72)];if(_0x1864ba[_0xb4e9a2(0xcd)]===status_enums_1[_0xb4e9a2(0x9b)][_0xb4e9a2(0xaf)])return _0x1864ba[_0xb4e9a2(0x9a)];else{if(_0x176481>0x0)return await(0x0,veeva_auth_utils_1[_0xb4e9a2(0x98)])(this[_0xb4e9a2(0x7a)]),await this[_0xb4e9a2(0xa0)](_0x1c0e84,_0x176481-0x1);throw new veeva_error_1['VeevaError'](_0x1864ba[_0xb4e9a2(0xa8)]);}}async[a391_0x11db49(0x9d)](_0xc56d2a){const _0x1a10ca=a391_0x11db49;this[_0x1a10ca(0xb9)][_0x1a10ca(0x85)](_0x1a10ca(0xad));const _0x936e2a=await this[_0x1a10ca(0x7a)]['post'](veeva_constants_1[_0x1a10ca(0xc7)]['ENDPOINT_DEPLOY_PACKAGE']['replace'](_0x1a10ca(0xc2),_0xc56d2a)),_0x464cfe=await _0x936e2a[_0x1a10ca(0x72)];if(_0x464cfe[_0x1a10ca(0xcd)]===status_enums_1[_0x1a10ca(0x9b)][_0x1a10ca(0xaf)])return _0x464cfe[_0x1a10ca(0x9a)];else throw new veeva_error_1[(_0x1a10ca(0xb5))](_0x464cfe[_0x1a10ca(0xa8)]);}async['getJobDetailUrl'](_0x12cc8c){const _0x2de9bc=a391_0x11db49;this[_0x2de9bc(0xb9)][_0x2de9bc(0x85)](_0x2de9bc(0xbe));const [_0x55ad47]=await this[_0x2de9bc(0x77)][_0x2de9bc(0x91)]([_0x12cc8c]);return _0x55ad47[_0x2de9bc(0xbb)][_0x2de9bc(0x7f)](_0x1abb43=>_0x1abb43['rel']===_0x2de9bc(0x87))['href'];}async['getValidationDetailsAndSaveLog'](_0x3faf10){const _0x2da05f=a391_0x11db49;this[_0x2da05f(0xb9)][_0x2da05f(0x85)](_0x2da05f(0x8b));const {data:_0xb990d4}=await this['_connection'][_0x2da05f(0x97)](_0x3faf10);if(_0xb990d4[_0x2da05f(0xcd)]===status_enums_1['VeevaResponseStatus'][_0x2da05f(0xaf)]){const _0x42b1c9=new package_details_dto_1[(_0x2da05f(0x93))](),{log:_0x184ac4,id:_0x536fe3,package_status:_0x3fcbf7,package_steps:_0x2c5c30}=_0xb990d4[_0x2da05f(0xa3)],_0x5deb8f=_0x184ac4['filter'](_0x134534=>_0x134534['filename'][_0x2da05f(0xbd)](_0x2da05f(0xc6))),_0xbaad7f=await this['getLogResultText'](_0x5deb8f[0x0][_0x2da05f(0x9a)]);await this[_0x2da05f(0x9f)](_0xbaad7f,_0x2da05f(0x84)),_0x42b1c9[_0x2da05f(0xb1)]=_0x536fe3,_0x42b1c9[_0x2da05f(0x94)]=this[_0x2da05f(0x89)](_0x2c5c30),await this[_0x2da05f(0xb0)](_0x42b1c9);if(_0x3fcbf7!==status_enums_1[_0x2da05f(0xa5)][_0x2da05f(0x7c)])throw new Error(_0x2da05f(0x83));return _0x42b1c9;}else throw new veeva_error_1[(_0x2da05f(0xb5))](_0xb990d4['errors']);}async[a391_0x11db49(0xc4)](_0x8979f5,_0x4afaee){const _0x58b3c3=a391_0x11db49;var _0x5172b9;this[_0x58b3c3(0xb9)][_0x58b3c3(0x85)]('Get\x20deploy\x20result');const {data:_0x118a78}=await this[_0x58b3c3(0x7a)][_0x58b3c3(0x97)](_0x8979f5);if(_0x118a78[_0x58b3c3(0xcd)]===status_enums_1[_0x58b3c3(0x9b)][_0x58b3c3(0xaf)]){const {responseDetails:{deployment_log:_0x282910,package_status__v:_0xfc6ab3},package_steps:_0x331457}=_0x118a78,_0x4fc40a=_0x282910[_0x58b3c3(0xc8)](_0x22970f=>_0x22970f[_0x58b3c3(0x88)][_0x58b3c3(0xbd)](_0x58b3c3(0x81))),_0x5f5805=await this[_0x58b3c3(0xa4)](_0x4fc40a[0x0][_0x58b3c3(0x9a)]);await this['_saveLog'](_0x5f5805,_0x58b3c3(0xb8)),_0x4afaee['isDeployed']=[status_enums_1[_0x58b3c3(0xa5)][_0x58b3c3(0xb7)],status_enums_1[_0x58b3c3(0xa5)][_0x58b3c3(0xbf)]][_0x58b3c3(0x76)](_0xfc6ab3);const _0x27cd0b=array_utils_1[_0x58b3c3(0x7d)]['groupUniqueToMap'](this['formPackageComponentList'](_0x331457),({uniqueName:_0x525541})=>_0x525541);for(const _0x2a3fc6 of _0x4afaee[_0x58b3c3(0x94)]){const _0x532903=(_0x5172b9=_0x27cd0b[_0x58b3c3(0x97)](_0x2a3fc6[_0x58b3c3(0xa1)]))===null||_0x5172b9===void 0x0?void 0x0:_0x5172b9[_0x58b3c3(0x9e)];_0x532903&&(_0x2a3fc6[_0x58b3c3(0x9e)]=_0x532903);}_0x4afaee[_0x58b3c3(0x94)]=_0x4afaee[_0x58b3c3(0x94)][_0x58b3c3(0xc8)](_0x3b2782=>_0x3b2782['status']!==status_enums_1[_0x58b3c3(0x79)]['VERIFIED']);if(!_0x4afaee[_0x58b3c3(0x94)][_0x58b3c3(0x99)])throw new Error(_0x58b3c3(0xb2));return _0x4afaee;}else throw new veeva_error_1[(_0x58b3c3(0xb5))](_0x118a78[_0x58b3c3(0xa8)]);}async['getLogResultText'](_0xac4eb){const _0x50e7a2=a391_0x11db49,{data:_0x244e81}=await this[_0x50e7a2(0x7a)][_0x50e7a2(0x97)](_0xac4eb,{'responseType':_0x50e7a2(0xa2)});return _0x244e81;}[a391_0x11db49(0x89)](_0x66998f){const _0x5b914c=a391_0x11db49;return _0x66998f[_0x5b914c(0xae)]((_0x347f22,_0x328d02)=>{const _0x2d504f=_0x5b914c,_0x1ab5f8=_0x328d02[_0x2d504f(0xab)][_0x2d504f(0xc9)](_0x5f41c1=>new package_component_dto_1['PackageComponentDto']({'status':_0x328d02[_0x2d504f(0x82)],'stepName':_0x328d02[_0x2d504f(0x7b)],'component':_0x5f41c1}));return[..._0x347f22,..._0x1ab5f8];},[]);}async[a391_0x11db49(0xb0)](_0x806f37){const _0x2a2ab0=a391_0x11db49,{data:_0x56dbb1}=await this[_0x2a2ab0(0x7a)][_0x2a2ab0(0xc1)](veeva_constants_1[_0x2a2ab0(0xc7)]['ENDPOINT_VALIDATE_PACKAGE'][_0x2a2ab0(0x8c)](_0x2a2ab0(0xc2),_0x806f37['packageId']));if(_0x56dbb1[_0x2a2ab0(0xcd)]===status_enums_1['VeevaResponseStatus'][_0x2a2ab0(0xaf)]){const {package_steps:_0x214e20}=_0x56dbb1[_0x2a2ab0(0x73)],_0x536459=array_utils_1[_0x2a2ab0(0x7d)][_0x2a2ab0(0x8e)](_0x806f37['packageComponentList'],({stepName:_0x1e0362})=>_0x1e0362);for(const {name__v:_0x498f84,deployment_action:_0x1aa9ca}of _0x214e20){for(const _0xba2307 of _0x536459['get'](_0x498f84)||[]){_0xba2307[_0x2a2ab0(0x70)]=package_component_dto_1['PackageComponentDto'][_0x2a2ab0(0x96)](_0x1aa9ca);}}}else throw new veeva_error_1[(_0x2a2ab0(0xb5))](_0x56dbb1['errors']);}async[a391_0x11db49(0x74)](_0x403b4c){const _0x23b7df=a391_0x11db49,_0x285966=await this[_0x23b7df(0xa0)](_0x403b4c),_0x2d7ebd=await this[_0x23b7df(0xcf)](_0x285966),_0x5da14d=await this[_0x23b7df(0x7e)](_0x2d7ebd),_0x71d950=await this[_0x23b7df(0x9d)](_0x5da14d['packageId']),_0xa55f12=await this[_0x23b7df(0xcf)](_0x71d950);return this['getDeployDetailsAndSaveLog'](_0xa55f12,_0x5da14d);}}exports['PackageImportService']=PackageImportService;