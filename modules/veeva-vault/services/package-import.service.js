const a359_0x4c1ab0=a359_0x317f;(function(_0x18e0f9,_0x4cae13){const _0x25c8f2=a359_0x317f,_0x31ea72=_0x18e0f9();while(!![]){try{const _0x48e604=parseInt(_0x25c8f2(0x16f))/0x1+-parseInt(_0x25c8f2(0x159))/0x2+parseInt(_0x25c8f2(0x160))/0x3*(-parseInt(_0x25c8f2(0x16c))/0x4)+-parseInt(_0x25c8f2(0x19a))/0x5*(-parseInt(_0x25c8f2(0x183))/0x6)+-parseInt(_0x25c8f2(0x1a0))/0x7+-parseInt(_0x25c8f2(0x172))/0x8+-parseInt(_0x25c8f2(0x150))/0x9*(-parseInt(_0x25c8f2(0x182))/0xa);if(_0x48e604===_0x4cae13)break;else _0x31ea72['push'](_0x31ea72['shift']());}catch(_0x28215d){_0x31ea72['push'](_0x31ea72['shift']());}}}(a359_0x622a,0x68489));const a359_0x8511ce=(function(){let _0x548338=!![];return function(_0x4e38b6,_0x1ca62c){const _0x45a2d7=_0x548338?function(){const _0x4ce982=a359_0x317f;if(_0x1ca62c){const _0x2c9acf=_0x1ca62c[_0x4ce982(0x192)](_0x4e38b6,arguments);return _0x1ca62c=null,_0x2c9acf;}}:function(){};return _0x548338=![],_0x45a2d7;};}()),a359_0x273f1f=a359_0x8511ce(this,function(){const _0x5de5c2=a359_0x317f;return a359_0x273f1f[_0x5de5c2(0x1a4)]()[_0x5de5c2(0x18b)](_0x5de5c2(0x162))[_0x5de5c2(0x1a4)]()['constructor'](a359_0x273f1f)[_0x5de5c2(0x18b)]('(((.+)+)+)+$');});a359_0x273f1f();'use strict';function a359_0x622a(){const _0x169ad0=['../enums/status.enums','isDeployed','packageComponentList','352431dDoaNj','append','(((.+)+)+)+$','Validation.log','Deploy\x20Log','href','responseDetails','form-data','DEPLOYED','rel','get','deploymentAction','12APYgLL','Cannot\x20find\x20deployment\x20results','status','361502GAikam','multipart/form-data','url','3742776oMiWjw','_logger','links','vaultPackage','ArrayUtils','VeevaPackageStatus','../utils/array.utils','{package_id}','file','Deployment.log','defineProperty','groupToMap','_veevaService','getValidationDetailsAndSaveLog','Deploy\x20package','replace','250mUMibh','6MCJxRG','PackageDetailsDto','PackageComponentStatus','reduce','default','VERIFIED','responseStatus','endsWith','search','filter','importVpk','../dtos/package-component.dto','VeevaResponseStatus','getLogResultText','DEPLOYED_WITH_WARNINGS','apply','../constants/veeva.constants','map','import','log','../utils/veeva-auth.utils','formPackageComponentList','length','2943875FNRFxj','data','filename','PackageComponentDto','fillPackageDeploymentAction','Validation\x20Log','1120448McAulS','ENDPOINT_DEPLOY_PACKAGE','groupUniqueToMap','getDeployDetailsAndSaveLog','toString','_connection','__importDefault','SUCCESS','__esModule','Get\x20deploy\x20result','PackageImportService','../dtos/package-details.dto','errors','ENDPOINT_EXPORT_IMPORT_PACKAGE','199116LCRVKr','packageId','deployPackage','_saveLog','VeevaConstants','post','updateVeevaConnection','deployment_status__v','convertDeploymentAction','191780vemBit','VeevaError','includes','../classes/errors/veeva-error'];a359_0x622a=function(){return _0x169ad0;};return a359_0x622a();}var __importDefault=this&&this[a359_0x4c1ab0(0x1a6)]||function(_0x1f2da){const _0xd07dd3=a359_0x4c1ab0;return _0x1f2da&&_0x1f2da[_0xd07dd3(0x1a8)]?_0x1f2da:{'default':_0x1f2da};};function a359_0x317f(_0x13c371,_0x22b67c){const _0xc359c=a359_0x622a();return a359_0x317f=function(_0x273f1f,_0x8511ce){_0x273f1f=_0x273f1f-0x14b;let _0x622a4f=_0xc359c[_0x273f1f];return _0x622a4f;},a359_0x317f(_0x13c371,_0x22b67c);}Object[a359_0x4c1ab0(0x17c)](exports,a359_0x4c1ab0(0x1a8),{'value':!![]}),exports[a359_0x4c1ab0(0x14c)]=void 0x0;const veeva_constants_1=require(a359_0x4c1ab0(0x193)),status_enums_1=require(a359_0x4c1ab0(0x15d)),veeva_error_1=require(a359_0x4c1ab0(0x15c)),form_data_1=__importDefault(require(a359_0x4c1ab0(0x167))),fs_1=require('fs'),veeva_auth_utils_1=require(a359_0x4c1ab0(0x197)),package_details_dto_1=require(a359_0x4c1ab0(0x14d)),package_component_dto_1=require(a359_0x4c1ab0(0x18e)),array_utils_1=require(a359_0x4c1ab0(0x178));class PackageImportService{constructor({veevaService:_0x84a1c,connection:_0x46d5bf,logger:_0x9586af,saveLog:_0x2c9cfe}){const _0x252df8=a359_0x4c1ab0;this[_0x252df8(0x17e)]=_0x84a1c,this[_0x252df8(0x1a5)]=_0x46d5bf,this[_0x252df8(0x173)]=_0x9586af,this[_0x252df8(0x153)]=_0x2c9cfe;}async[a359_0x4c1ab0(0x18d)](_0x499491,_0x9dca3f=0x1){const _0x3534c7=a359_0x4c1ab0;this[_0x3534c7(0x173)][_0x3534c7(0x196)]('Import\x20package');const _0x166096=new form_data_1[(_0x3534c7(0x187))]();_0x166096[_0x3534c7(0x161)](_0x3534c7(0x17a),(0x0,fs_1['createReadStream'])(_0x499491));const _0x4e6137=await this[_0x3534c7(0x1a5)]['put'](veeva_constants_1['VeevaConstants'][_0x3534c7(0x14f)],_0x166096,{'headers':{'Content-Type':_0x3534c7(0x170)}}),_0x51bed1=_0x4e6137['data'];if(_0x51bed1[_0x3534c7(0x189)]===status_enums_1[_0x3534c7(0x18f)][_0x3534c7(0x1a7)])return _0x51bed1[_0x3534c7(0x171)];else{if(_0x9dca3f>0x0)return await(0x0,veeva_auth_utils_1[_0x3534c7(0x156)])(this[_0x3534c7(0x1a5)]),await this[_0x3534c7(0x18d)](_0x499491,_0x9dca3f-0x1);throw new veeva_error_1[(_0x3534c7(0x15a))](_0x51bed1[_0x3534c7(0x14e)]);}}async[a359_0x4c1ab0(0x152)](_0xe5d0e9){const _0x52d724=a359_0x4c1ab0;this['_logger'][_0x52d724(0x196)](_0x52d724(0x180));const _0x48c5f5=await this[_0x52d724(0x1a5)]['post'](veeva_constants_1[_0x52d724(0x154)][_0x52d724(0x1a1)][_0x52d724(0x181)](_0x52d724(0x179),_0xe5d0e9)),_0x40ccb7=await _0x48c5f5[_0x52d724(0x19b)];if(_0x40ccb7[_0x52d724(0x189)]===status_enums_1['VeevaResponseStatus'][_0x52d724(0x1a7)])return _0x40ccb7['url'];else throw new veeva_error_1['VeevaError'](_0x40ccb7['errors']);}async['getJobDetailUrl'](_0x30ae59){const _0x1c1773=a359_0x4c1ab0;this[_0x1c1773(0x173)]['log']('Wait\x20Executing\x20job');const [_0x21402d]=await this[_0x1c1773(0x17e)]['getJobResult']([_0x30ae59]);return _0x21402d[_0x1c1773(0x174)]['find'](_0x5a3c2f=>_0x5a3c2f[_0x1c1773(0x169)]==='artifacts')[_0x1c1773(0x165)];}async[a359_0x4c1ab0(0x17f)](_0x4c1c51){const _0x36bd18=a359_0x4c1ab0;this['_logger'][_0x36bd18(0x196)]('Get\x20validation\x20details.');const {data:_0x1eb62a}=await this[_0x36bd18(0x1a5)]['get'](_0x4c1c51);if(_0x1eb62a[_0x36bd18(0x189)]===status_enums_1[_0x36bd18(0x18f)][_0x36bd18(0x1a7)]){const _0x243c24=new package_details_dto_1[(_0x36bd18(0x184))](),{log:_0x369d1b,id:_0x5ab925,package_status:_0x16e79c,package_steps:_0x3b81e3}=_0x1eb62a[_0x36bd18(0x175)],_0x510ea0=_0x369d1b[_0x36bd18(0x18c)](_0x32e22e=>_0x32e22e[_0x36bd18(0x19c)][_0x36bd18(0x18a)](_0x36bd18(0x163))),_0x1985d1=await this[_0x36bd18(0x190)](_0x510ea0[0x0][_0x36bd18(0x171)]);await this[_0x36bd18(0x153)](_0x1985d1,_0x36bd18(0x19f)),_0x243c24[_0x36bd18(0x151)]=_0x5ab925,_0x243c24[_0x36bd18(0x15f)]=this[_0x36bd18(0x198)](_0x3b81e3),await this[_0x36bd18(0x19e)](_0x243c24);if(_0x16e79c!==status_enums_1[_0x36bd18(0x177)]['VERIFIED'])throw new Error('Package\x20not\x20verified');return _0x243c24;}else throw new veeva_error_1['VeevaError'](_0x1eb62a['errors']);}async[a359_0x4c1ab0(0x1a3)](_0x396c16,_0x4b212f){const _0x33ecad=a359_0x4c1ab0;var _0x323a3f;this[_0x33ecad(0x173)]['log'](_0x33ecad(0x14b));const {data:_0x2c0064}=await this[_0x33ecad(0x1a5)]['get'](_0x396c16);if(_0x2c0064['responseStatus']===status_enums_1[_0x33ecad(0x18f)][_0x33ecad(0x1a7)]){const {responseDetails:{deployment_log:_0x3bd086,package_status__v:_0x680eed},package_steps:_0x3c487a}=_0x2c0064,_0xeb475e=_0x3bd086[_0x33ecad(0x18c)](_0x14a67a=>_0x14a67a[_0x33ecad(0x19c)][_0x33ecad(0x18a)](_0x33ecad(0x17b))),_0x256bbc=await this[_0x33ecad(0x190)](_0xeb475e[0x0][_0x33ecad(0x171)]);await this[_0x33ecad(0x153)](_0x256bbc,_0x33ecad(0x164)),_0x4b212f[_0x33ecad(0x15e)]=[status_enums_1['VeevaPackageStatus'][_0x33ecad(0x168)],status_enums_1[_0x33ecad(0x177)][_0x33ecad(0x191)]][_0x33ecad(0x15b)](_0x680eed);const _0xb65a68=array_utils_1[_0x33ecad(0x176)][_0x33ecad(0x1a2)](this['formPackageComponentList'](_0x3c487a),({uniqueName:_0x5569f3})=>_0x5569f3);for(const _0x19a77e of _0x4b212f['packageComponentList']){const _0x20f785=(_0x323a3f=_0xb65a68[_0x33ecad(0x16a)](_0x19a77e['uniqueName']))===null||_0x323a3f===void 0x0?void 0x0:_0x323a3f[_0x33ecad(0x16e)];_0x20f785&&(_0x19a77e['status']=_0x20f785);}_0x4b212f[_0x33ecad(0x15f)]=_0x4b212f[_0x33ecad(0x15f)][_0x33ecad(0x18c)](_0x6a1314=>_0x6a1314[_0x33ecad(0x16e)]!==status_enums_1[_0x33ecad(0x185)][_0x33ecad(0x188)]);if(!_0x4b212f[_0x33ecad(0x15f)][_0x33ecad(0x199)])throw new Error(_0x33ecad(0x16d));return _0x4b212f;}else throw new veeva_error_1[(_0x33ecad(0x15a))](_0x2c0064['errors']);}async[a359_0x4c1ab0(0x190)](_0x3dc00b){const _0x16692e=a359_0x4c1ab0,{data:_0x5db61f}=await this['_connection'][_0x16692e(0x16a)](_0x3dc00b,{'responseType':'text'});return _0x5db61f;}['formPackageComponentList'](_0x584a2c){const _0x623fe1=a359_0x4c1ab0;return _0x584a2c[_0x623fe1(0x186)]((_0x40fff0,_0xc48672)=>{const _0x40a6ca=_0x623fe1,_0x3695e4=_0xc48672['package_components'][_0x40a6ca(0x194)](_0x2d5b1d=>new package_component_dto_1[(_0x40a6ca(0x19d))]({'status':_0xc48672[_0x40a6ca(0x157)],'stepName':_0xc48672['name__v'],'component':_0x2d5b1d}));return[..._0x40fff0,..._0x3695e4];},[]);}async[a359_0x4c1ab0(0x19e)](_0xec4d7e){const _0x364b5b=a359_0x4c1ab0,{data:_0x529fda}=await this[_0x364b5b(0x1a5)][_0x364b5b(0x155)](veeva_constants_1[_0x364b5b(0x154)]['ENDPOINT_VALIDATE_PACKAGE']['replace']('{package_id}',_0xec4d7e[_0x364b5b(0x151)]));if(_0x529fda['responseStatus']===status_enums_1[_0x364b5b(0x18f)][_0x364b5b(0x1a7)]){const {package_steps:_0x2bae9f}=_0x529fda[_0x364b5b(0x166)],_0x31752e=array_utils_1[_0x364b5b(0x176)][_0x364b5b(0x17d)](_0xec4d7e[_0x364b5b(0x15f)],({stepName:_0x4eb3ab})=>_0x4eb3ab);for(const {name__v:_0x407eae,deployment_action:_0x32e94b}of _0x2bae9f){for(const _0x55d6f8 of _0x31752e['get'](_0x407eae)||[]){_0x55d6f8[_0x364b5b(0x16b)]=package_component_dto_1[_0x364b5b(0x19d)][_0x364b5b(0x158)](_0x32e94b);}}}else throw new veeva_error_1[(_0x364b5b(0x15a))](_0x529fda['errors']);}async[a359_0x4c1ab0(0x195)](_0x50e439){const _0x28cb22=a359_0x4c1ab0,_0x3e6c1f=await this[_0x28cb22(0x18d)](_0x50e439),_0x4cf00e=await this['getJobDetailUrl'](_0x3e6c1f),_0x3f5c2d=await this[_0x28cb22(0x17f)](_0x4cf00e),_0x97483d=await this[_0x28cb22(0x152)](_0x3f5c2d[_0x28cb22(0x151)]),_0x599438=await this['getJobDetailUrl'](_0x97483d);return this['getDeployDetailsAndSaveLog'](_0x599438,_0x3f5c2d);}}exports[a359_0x4c1ab0(0x14c)]=PackageImportService;