const a403_0x58e883=a403_0x23b6;(function(_0x41d241,_0x363637){const _0x399c3e=a403_0x23b6,_0x253d04=_0x41d241();while(!![]){try{const _0x593f0b=parseInt(_0x399c3e(0x1fd))/0x1*(parseInt(_0x399c3e(0x1bd))/0x2)+parseInt(_0x399c3e(0x1ce))/0x3+-parseInt(_0x399c3e(0x1e7))/0x4*(-parseInt(_0x399c3e(0x1e1))/0x5)+-parseInt(_0x399c3e(0x218))/0x6*(-parseInt(_0x399c3e(0x1cb))/0x7)+parseInt(_0x399c3e(0x1bb))/0x8*(parseInt(_0x399c3e(0x1df))/0x9)+parseInt(_0x399c3e(0x1fc))/0xa+-parseInt(_0x399c3e(0x1e3))/0xb*(parseInt(_0x399c3e(0x1d2))/0xc);if(_0x593f0b===_0x363637)break;else _0x253d04['push'](_0x253d04['shift']());}catch(_0x18e7b8){_0x253d04['push'](_0x253d04['shift']());}}}(a403_0x174c,0x6f729));const a403_0x2a350a=(function(){let _0x5d7bd5=!![];return function(_0x28d86b,_0x1cb33d){const _0x411b7f=_0x5d7bd5?function(){const _0x2701b1=a403_0x23b6;if(_0x1cb33d){const _0x4635aa=_0x1cb33d[_0x2701b1(0x1dc)](_0x28d86b,arguments);return _0x1cb33d=null,_0x4635aa;}}:function(){};return _0x5d7bd5=![],_0x411b7f;};}()),a403_0x32900e=a403_0x2a350a(this,function(){const _0x57fdbb=a403_0x23b6;return a403_0x32900e['toString']()[_0x57fdbb(0x1de)](_0x57fdbb(0x1c2))[_0x57fdbb(0x1ea)]()[_0x57fdbb(0x217)](a403_0x32900e)[_0x57fdbb(0x1de)]('(((.+)+)+)+$');});a403_0x32900e();'use strict';var __importDefault=this&&this[a403_0x58e883(0x1e2)]||function(_0x43e742){const _0x54316b=a403_0x58e883;return _0x43e742&&_0x43e742[_0x54316b(0x1ff)]?_0x43e742:{'default':_0x43e742};};function a403_0x174c(){const _0x2003c4=['filename','deploymentAction','name__v','2244130ykIhJg','281793qGhOKD','../classes/errors/veeva-error','__esModule','Deploy\x20Log','filter','get','VeevaError','deployment_status__v','form-data','ENDPOINT_DEPLOY_PACKAGE','Get\x20validation\x20details.','Validation\x20Log','reduce','Import\x20package','responseStatus','data','../dtos/package-component.dto','fillPackageDeploymentAction','Validation.log','vaultPackage','formPackageComponentList','{package_id}','_connection','packageComponentList','PackageComponentStatus','isDeployed','constructor','3062310GtXKfO','Get\x20deploy\x20result','_veevaService','importVpk','url','responseDetails','PackageComponentDto','1432bjeSuN','ArrayUtils','2imIDDH','packageId','Wait\x20Executing\x20job','../utils/veeva-auth.utils','links','(((.+)+)+)+$','updateVeevaConnection','createReadStream','VeevaConstants','text','Cannot\x20find\x20deployment\x20results','endsWith','rel','convertDeploymentAction','7ePSuEL','PackageDetailsDto','groupUniqueToMap','195747jRbFKV','VeevaPackageStatus','../enums/status.enums','_saveLog','289908qXzqgp','getDeployDetailsAndSaveLog','defineProperty','errors','Package\x20not\x20verified','VeevaResponseStatus','href','length','log','DEPLOYED','apply','ENDPOINT_VALIDATE_PACKAGE','search','19494WwZBHn','multipart/form-data','70tLtAop','__importDefault','561VdTHPv','Deploy\x20package','Deployment.log','post','62584payGFm','getValidationDetailsAndSaveLog','file','toString','replace','put','includes','PackageImportService','DEPLOYED_WITH_WARNINGS','getLogResultText','deployPackage','import','find','_logger','status','SUCCESS','groupToMap','getJobDetailUrl'];a403_0x174c=function(){return _0x2003c4;};return a403_0x174c();}function a403_0x23b6(_0xb6b59d,_0x27588e){const _0x371944=a403_0x174c();return a403_0x23b6=function(_0x32900e,_0x2a350a){_0x32900e=_0x32900e-0x1bb;let _0x174cc1=_0x371944[_0x32900e];return _0x174cc1;},a403_0x23b6(_0xb6b59d,_0x27588e);}Object[a403_0x58e883(0x1d4)](exports,a403_0x58e883(0x1ff),{'value':!![]}),exports[a403_0x58e883(0x1ee)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),status_enums_1=require(a403_0x58e883(0x1d0)),veeva_error_1=require(a403_0x58e883(0x1fe)),form_data_1=__importDefault(require(a403_0x58e883(0x205))),fs_1=require('fs'),veeva_auth_utils_1=require(a403_0x58e883(0x1c0)),package_details_dto_1=require('../dtos/package-details.dto'),package_component_dto_1=require(a403_0x58e883(0x20d)),array_utils_1=require('../utils/array.utils');class PackageImportService{constructor({veevaService:_0x3c2024,connection:_0x194e5f,logger:_0x183730,saveLog:_0x4e16af}){const _0x452733=a403_0x58e883;this[_0x452733(0x21a)]=_0x3c2024,this['_connection']=_0x194e5f,this['_logger']=_0x183730,this[_0x452733(0x1d1)]=_0x4e16af;}async[a403_0x58e883(0x21b)](_0x20dc55,_0x511d53=0x1){const _0x4dda78=a403_0x58e883;this[_0x4dda78(0x1f4)][_0x4dda78(0x1da)](_0x4dda78(0x20a));const _0x2cf133=new form_data_1['default']();_0x2cf133['append'](_0x4dda78(0x1e9),(0x0,fs_1[_0x4dda78(0x1c4)])(_0x20dc55));const _0x23744c=await this['_connection'][_0x4dda78(0x1ec)](veeva_constants_1['VeevaConstants']['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x2cf133,{'headers':{'Content-Type':_0x4dda78(0x1e0)}}),_0x1f668b=_0x23744c['data'];if(_0x1f668b['responseStatus']===status_enums_1[_0x4dda78(0x1d7)]['SUCCESS'])return _0x1f668b[_0x4dda78(0x21c)];else{if(_0x511d53>0x0)return await(0x0,veeva_auth_utils_1[_0x4dda78(0x1c3)])(this['_connection']),await this[_0x4dda78(0x21b)](_0x20dc55,_0x511d53-0x1);throw new veeva_error_1[(_0x4dda78(0x203))](_0x1f668b['errors']);}}async[a403_0x58e883(0x1f1)](_0x3565d8){const _0x26d57f=a403_0x58e883;this[_0x26d57f(0x1f4)][_0x26d57f(0x1da)](_0x26d57f(0x1e4));const _0x2358a7=await this[_0x26d57f(0x213)][_0x26d57f(0x1e6)](veeva_constants_1[_0x26d57f(0x1c5)][_0x26d57f(0x206)][_0x26d57f(0x1eb)](_0x26d57f(0x212),_0x3565d8)),_0x4398b3=await _0x2358a7[_0x26d57f(0x20c)];if(_0x4398b3[_0x26d57f(0x20b)]===status_enums_1[_0x26d57f(0x1d7)][_0x26d57f(0x1f6)])return _0x4398b3[_0x26d57f(0x21c)];else throw new veeva_error_1[(_0x26d57f(0x203))](_0x4398b3['errors']);}async['getJobDetailUrl'](_0x1b6991){const _0x5d3d91=a403_0x58e883;this[_0x5d3d91(0x1f4)][_0x5d3d91(0x1da)](_0x5d3d91(0x1bf));const [_0x2f0d2c]=await this[_0x5d3d91(0x21a)]['getJobResult']([_0x1b6991]);return _0x2f0d2c[_0x5d3d91(0x1c1)][_0x5d3d91(0x1f3)](_0x281a36=>_0x281a36[_0x5d3d91(0x1c9)]==='artifacts')[_0x5d3d91(0x1d8)];}async[a403_0x58e883(0x1e8)](_0x218444){const _0x21b95b=a403_0x58e883;this['_logger'][_0x21b95b(0x1da)](_0x21b95b(0x207));const {data:_0x1d31e6}=await this[_0x21b95b(0x213)][_0x21b95b(0x202)](_0x218444);if(_0x1d31e6[_0x21b95b(0x20b)]===status_enums_1[_0x21b95b(0x1d7)][_0x21b95b(0x1f6)]){const _0x2368ce=new package_details_dto_1[(_0x21b95b(0x1cc))](),{log:_0x1a998b,id:_0x455b59,package_status:_0x1123aa,package_steps:_0x5465d3}=_0x1d31e6[_0x21b95b(0x210)],_0x5bea39=_0x1a998b[_0x21b95b(0x201)](_0x1079e2=>_0x1079e2[_0x21b95b(0x1f9)][_0x21b95b(0x1c8)](_0x21b95b(0x20f))),_0x17a0f3=await this[_0x21b95b(0x1f0)](_0x5bea39[0x0][_0x21b95b(0x21c)]);await this[_0x21b95b(0x1d1)](_0x17a0f3,_0x21b95b(0x208)),_0x2368ce['packageId']=_0x455b59,_0x2368ce[_0x21b95b(0x214)]=this[_0x21b95b(0x211)](_0x5465d3),await this['fillPackageDeploymentAction'](_0x2368ce);if(_0x1123aa!==status_enums_1[_0x21b95b(0x1cf)]['VERIFIED'])throw new Error(_0x21b95b(0x1d6));return _0x2368ce;}else throw new veeva_error_1[(_0x21b95b(0x203))](_0x1d31e6['errors']);}async[a403_0x58e883(0x1d3)](_0x1f64e7,_0x4ded0e){const _0x55fce7=a403_0x58e883;var _0xdd0db7;this[_0x55fce7(0x1f4)]['log'](_0x55fce7(0x219));const {data:_0x2e840f}=await this[_0x55fce7(0x213)][_0x55fce7(0x202)](_0x1f64e7);if(_0x2e840f['responseStatus']===status_enums_1[_0x55fce7(0x1d7)][_0x55fce7(0x1f6)]){const {responseDetails:{deployment_log:_0x5e5cd1,package_status__v:_0x1e8fe7},package_steps:_0x45f7a2}=_0x2e840f,_0x596f0d=_0x5e5cd1[_0x55fce7(0x201)](_0x434d8b=>_0x434d8b['filename'][_0x55fce7(0x1c8)](_0x55fce7(0x1e5))),_0x390445=await this[_0x55fce7(0x1f0)](_0x596f0d[0x0][_0x55fce7(0x21c)]);await this[_0x55fce7(0x1d1)](_0x390445,_0x55fce7(0x200)),_0x4ded0e[_0x55fce7(0x216)]=[status_enums_1['VeevaPackageStatus'][_0x55fce7(0x1db)],status_enums_1['VeevaPackageStatus'][_0x55fce7(0x1ef)]][_0x55fce7(0x1ed)](_0x1e8fe7);const _0x5393e5=array_utils_1['ArrayUtils'][_0x55fce7(0x1cd)](this[_0x55fce7(0x211)](_0x45f7a2),({uniqueName:_0x544420})=>_0x544420);for(const _0x4c42e7 of _0x4ded0e['packageComponentList']){const _0x307200=(_0xdd0db7=_0x5393e5[_0x55fce7(0x202)](_0x4c42e7['uniqueName']))===null||_0xdd0db7===void 0x0?void 0x0:_0xdd0db7[_0x55fce7(0x1f5)];_0x307200&&(_0x4c42e7[_0x55fce7(0x1f5)]=_0x307200);}_0x4ded0e[_0x55fce7(0x214)]=_0x4ded0e[_0x55fce7(0x214)]['filter'](_0x918e95=>_0x918e95[_0x55fce7(0x1f5)]!==status_enums_1[_0x55fce7(0x215)]['VERIFIED']);if(!_0x4ded0e[_0x55fce7(0x214)][_0x55fce7(0x1d9)])throw new Error(_0x55fce7(0x1c7));return _0x4ded0e;}else throw new veeva_error_1[(_0x55fce7(0x203))](_0x2e840f[_0x55fce7(0x1d5)]);}async['getLogResultText'](_0x5233f6){const _0x14e1e8=a403_0x58e883,{data:_0x583bef}=await this[_0x14e1e8(0x213)]['get'](_0x5233f6,{'responseType':_0x14e1e8(0x1c6)});return _0x583bef;}[a403_0x58e883(0x211)](_0x340ccb){const _0x23449e=a403_0x58e883;return _0x340ccb[_0x23449e(0x209)]((_0x1be9d7,_0x2c85a1)=>{const _0x443387=_0x23449e,_0x52276c=_0x2c85a1['package_components']['map'](_0x391a48=>new package_component_dto_1[(_0x443387(0x21e))]({'status':_0x2c85a1[_0x443387(0x204)],'stepName':_0x2c85a1[_0x443387(0x1fb)],'component':_0x391a48}));return[..._0x1be9d7,..._0x52276c];},[]);}async[a403_0x58e883(0x20e)](_0xcd163d){const _0x24132d=a403_0x58e883,{data:_0x39c5ba}=await this['_connection']['post'](veeva_constants_1[_0x24132d(0x1c5)][_0x24132d(0x1dd)][_0x24132d(0x1eb)](_0x24132d(0x212),_0xcd163d['packageId']));if(_0x39c5ba[_0x24132d(0x20b)]===status_enums_1[_0x24132d(0x1d7)][_0x24132d(0x1f6)]){const {package_steps:_0x8dd38b}=_0x39c5ba[_0x24132d(0x21d)],_0x47f49d=array_utils_1[_0x24132d(0x1bc)][_0x24132d(0x1f7)](_0xcd163d[_0x24132d(0x214)],({stepName:_0x134ca7})=>_0x134ca7);for(const {name__v:_0x17fc0f,deployment_action:_0x7327f3}of _0x8dd38b){for(const _0x24a553 of _0x47f49d[_0x24132d(0x202)](_0x17fc0f)||[]){_0x24a553[_0x24132d(0x1fa)]=package_component_dto_1[_0x24132d(0x21e)][_0x24132d(0x1ca)](_0x7327f3);}}}else throw new veeva_error_1['VeevaError'](_0x39c5ba[_0x24132d(0x1d5)]);}async[a403_0x58e883(0x1f2)](_0x71cf73){const _0x259f80=a403_0x58e883,_0x3f8ed9=await this['importVpk'](_0x71cf73),_0x11bb3f=await this['getJobDetailUrl'](_0x3f8ed9),_0x365efc=await this[_0x259f80(0x1e8)](_0x11bb3f),_0x76f3b5=await this[_0x259f80(0x1f1)](_0x365efc[_0x259f80(0x1be)]),_0x504d02=await this[_0x259f80(0x1f8)](_0x76f3b5);return this[_0x259f80(0x1d3)](_0x504d02,_0x365efc);}}exports['PackageImportService']=PackageImportService;