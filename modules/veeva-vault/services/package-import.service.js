const a404_0x22fb94=a404_0x1646;(function(_0x545efb,_0x573989){const _0x3f18e5=a404_0x1646,_0x54d7f8=_0x545efb();while(!![]){try{const _0x449f87=parseInt(_0x3f18e5(0x15c))/0x1+-parseInt(_0x3f18e5(0x1b9))/0x2+-parseInt(_0x3f18e5(0x1ab))/0x3*(parseInt(_0x3f18e5(0x16a))/0x4)+parseInt(_0x3f18e5(0x178))/0x5*(-parseInt(_0x3f18e5(0x192))/0x6)+-parseInt(_0x3f18e5(0x17f))/0x7*(parseInt(_0x3f18e5(0x1b7))/0x8)+-parseInt(_0x3f18e5(0x1a2))/0x9*(-parseInt(_0x3f18e5(0x166))/0xa)+parseInt(_0x3f18e5(0x181))/0xb*(parseInt(_0x3f18e5(0x17d))/0xc);if(_0x449f87===_0x573989)break;else _0x54d7f8['push'](_0x54d7f8['shift']());}catch(_0x18d179){_0x54d7f8['push'](_0x54d7f8['shift']());}}}(a404_0xdc16,0xb18d5));const a404_0x2d9f70=(function(){let _0x2e95a6=!![];return function(_0x5b48ee,_0x8a5406){const _0x36162d=_0x2e95a6?function(){if(_0x8a5406){const _0x526e49=_0x8a5406['apply'](_0x5b48ee,arguments);return _0x8a5406=null,_0x526e49;}}:function(){};return _0x2e95a6=![],_0x36162d;};}()),a404_0x35a5c8=a404_0x2d9f70(this,function(){const _0x2b357b=a404_0x1646;return a404_0x35a5c8['toString']()[_0x2b357b(0x164)](_0x2b357b(0x19a))[_0x2b357b(0x1ad)]()[_0x2b357b(0x1aa)](a404_0x35a5c8)[_0x2b357b(0x164)]('(((.+)+)+)+$');});a404_0x35a5c8();function a404_0x1646(_0x89f218,_0x47b919){const _0x4b5191=a404_0xdc16();return a404_0x1646=function(_0x35a5c8,_0x2d9f70){_0x35a5c8=_0x35a5c8-0x15b;let _0xdc160c=_0x4b5191[_0x35a5c8];return _0xdc160c;},a404_0x1646(_0x89f218,_0x47b919);}'use strict';var __importDefault=this&&this[a404_0x22fb94(0x16b)]||function(_0x108660){const _0x1a6fe5=a404_0x22fb94;return _0x108660&&_0x108660[_0x1a6fe5(0x19d)]?_0x108660:{'default':_0x108660};};function a404_0xdc16(){const _0x26d921=['defineProperty','includes','find','_saveLog','responseStatus','responseDetails','PackageComponentDto','multipart/form-data','VeevaResponseStatus','get','links','162opvgsK','Import\x20package','name__v','_connection','put','replace','post','rel','(((.+)+)+)+$','Validation.log','filter','__esModule','getJobDetailUrl','importVpk','../constants/veeva.constants','deployPackage','3654HfJHlJ','uniqueName','PackageComponentStatus','_veevaService','Cannot\x20find\x20deployment\x20results','../utils/veeva-auth.utils','filename','deploymentAction','constructor','228495odtrcJ','getJobResult','toString','text','errors','ENDPOINT_DEPLOY_PACKAGE','createReadStream','../dtos/package-component.dto','Wait\x20Executing\x20job','VERIFIED','../dtos/package-details.dto','VeevaPackageStatus','479104UkBSND','deployment_status__v','2447984FKtAMX','map','href','1158664UbpqYP','vaultPackage','formPackageComponentList','ENDPOINT_EXPORT_IMPORT_PACKAGE','../utils/array.utils','DEPLOYED','url','convertDeploymentAction','search','packageComponentList','6660mJaYux','SUCCESS','getLogResultText','import','20kMXDTd','__importDefault','getDeployDetailsAndSaveLog','getValidationDetailsAndSaveLog','default','data','package_components','Get\x20deploy\x20result','Deploy\x20Log','Get\x20validation\x20details.','groupUniqueToMap','PackageImportService','packageId','_logger','103760LRajfq','endsWith','PackageDetailsDto','updateVeevaConnection','../classes/errors/veeva-error','4459176dcxvyS','reduce','133moekEE','{package_id}','77XGeCUU','log','fillPackageDeploymentAction','VeevaConstants','VeevaError','status'];a404_0xdc16=function(){return _0x26d921;};return a404_0xdc16();}Object[a404_0x22fb94(0x187)](exports,'__esModule',{'value':!![]}),exports[a404_0x22fb94(0x175)]=void 0x0;const veeva_constants_1=require(a404_0x22fb94(0x1a0)),status_enums_1=require('../enums/status.enums'),veeva_error_1=require(a404_0x22fb94(0x17c)),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),veeva_auth_utils_1=require(a404_0x22fb94(0x1a7)),package_details_dto_1=require(a404_0x22fb94(0x1b5)),package_component_dto_1=require(a404_0x22fb94(0x1b2)),array_utils_1=require(a404_0x22fb94(0x160));class PackageImportService{constructor({veevaService:_0x29bc83,connection:_0x268843,logger:_0x505399,saveLog:_0xb1b75e}){const _0x2592fe=a404_0x22fb94;this['_veevaService']=_0x29bc83,this['_connection']=_0x268843,this[_0x2592fe(0x177)]=_0x505399,this[_0x2592fe(0x18a)]=_0xb1b75e;}async[a404_0x22fb94(0x19f)](_0x340de9,_0x35cd23=0x1){const _0x28c62d=a404_0x22fb94;this[_0x28c62d(0x177)][_0x28c62d(0x182)](_0x28c62d(0x193));const _0x3ca1d1=new form_data_1[(_0x28c62d(0x16e))]();_0x3ca1d1['append']('file',(0x0,fs_1[_0x28c62d(0x1b1)])(_0x340de9));const _0x3bf10a=await this[_0x28c62d(0x195)][_0x28c62d(0x196)](veeva_constants_1['VeevaConstants'][_0x28c62d(0x15f)],_0x3ca1d1,{'headers':{'Content-Type':_0x28c62d(0x18e)}}),_0x48831e=_0x3bf10a[_0x28c62d(0x16f)];if(_0x48831e[_0x28c62d(0x18b)]===status_enums_1[_0x28c62d(0x18f)][_0x28c62d(0x167)])return _0x48831e[_0x28c62d(0x162)];else{if(_0x35cd23>0x0)return await(0x0,veeva_auth_utils_1[_0x28c62d(0x17b)])(this[_0x28c62d(0x195)]),await this[_0x28c62d(0x19f)](_0x340de9,_0x35cd23-0x1);throw new veeva_error_1['VeevaError'](_0x48831e[_0x28c62d(0x1af)]);}}async[a404_0x22fb94(0x1a1)](_0x52f259){const _0x2aa166=a404_0x22fb94;this[_0x2aa166(0x177)]['log']('Deploy\x20package');const _0x235547=await this[_0x2aa166(0x195)][_0x2aa166(0x198)](veeva_constants_1['VeevaConstants'][_0x2aa166(0x1b0)][_0x2aa166(0x197)](_0x2aa166(0x180),_0x52f259)),_0x277f0f=await _0x235547[_0x2aa166(0x16f)];if(_0x277f0f['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x2aa166(0x167)])return _0x277f0f[_0x2aa166(0x162)];else throw new veeva_error_1[(_0x2aa166(0x185))](_0x277f0f[_0x2aa166(0x1af)]);}async[a404_0x22fb94(0x19e)](_0x415538){const _0xdd2dfc=a404_0x22fb94;this[_0xdd2dfc(0x177)][_0xdd2dfc(0x182)](_0xdd2dfc(0x1b3));const [_0x1df8d3]=await this[_0xdd2dfc(0x1a5)][_0xdd2dfc(0x1ac)]([_0x415538]);return _0x1df8d3[_0xdd2dfc(0x191)][_0xdd2dfc(0x189)](_0x5d2c6c=>_0x5d2c6c[_0xdd2dfc(0x199)]==='artifacts')[_0xdd2dfc(0x15b)];}async[a404_0x22fb94(0x16d)](_0x113ed8){const _0x188a16=a404_0x22fb94;this[_0x188a16(0x177)][_0x188a16(0x182)](_0x188a16(0x173));const {data:_0x9f3180}=await this[_0x188a16(0x195)][_0x188a16(0x190)](_0x113ed8);if(_0x9f3180['responseStatus']===status_enums_1[_0x188a16(0x18f)][_0x188a16(0x167)]){const _0x381cb7=new package_details_dto_1[(_0x188a16(0x17a))](),{log:_0x2d6b00,id:_0x5d2aff,package_status:_0x2f023e,package_steps:_0x2270cb}=_0x9f3180[_0x188a16(0x15d)],_0x13ec02=_0x2d6b00['filter'](_0x4e8aa7=>_0x4e8aa7[_0x188a16(0x1a8)][_0x188a16(0x179)](_0x188a16(0x19b))),_0x4aad05=await this[_0x188a16(0x168)](_0x13ec02[0x0][_0x188a16(0x162)]);await this[_0x188a16(0x18a)](_0x4aad05,'Validation\x20Log'),_0x381cb7['packageId']=_0x5d2aff,_0x381cb7['packageComponentList']=this[_0x188a16(0x15e)](_0x2270cb),await this['fillPackageDeploymentAction'](_0x381cb7);if(_0x2f023e!==status_enums_1[_0x188a16(0x1b6)][_0x188a16(0x1b4)])throw new Error('Package\x20not\x20verified');return _0x381cb7;}else throw new veeva_error_1[(_0x188a16(0x185))](_0x9f3180[_0x188a16(0x1af)]);}async[a404_0x22fb94(0x16c)](_0x1d04bc,_0x177ef5){const _0x4b36e3=a404_0x22fb94;var _0x2846e5;this[_0x4b36e3(0x177)][_0x4b36e3(0x182)](_0x4b36e3(0x171));const {data:_0x47b247}=await this[_0x4b36e3(0x195)][_0x4b36e3(0x190)](_0x1d04bc);if(_0x47b247[_0x4b36e3(0x18b)]===status_enums_1[_0x4b36e3(0x18f)][_0x4b36e3(0x167)]){const {responseDetails:{deployment_log:_0x47e578,package_status__v:_0x3f8fc3},package_steps:_0x2dbaf6}=_0x47b247,_0x1f227d=_0x47e578[_0x4b36e3(0x19c)](_0xcb13a5=>_0xcb13a5[_0x4b36e3(0x1a8)]['endsWith']('Deployment.log')),_0x1043e0=await this[_0x4b36e3(0x168)](_0x1f227d[0x0][_0x4b36e3(0x162)]);await this[_0x4b36e3(0x18a)](_0x1043e0,_0x4b36e3(0x172)),_0x177ef5['isDeployed']=[status_enums_1['VeevaPackageStatus'][_0x4b36e3(0x161)],status_enums_1[_0x4b36e3(0x1b6)]['DEPLOYED_WITH_WARNINGS']][_0x4b36e3(0x188)](_0x3f8fc3);const _0x3d999f=array_utils_1['ArrayUtils'][_0x4b36e3(0x174)](this[_0x4b36e3(0x15e)](_0x2dbaf6),({uniqueName:_0x1cf1e2})=>_0x1cf1e2);for(const _0x3e86db of _0x177ef5[_0x4b36e3(0x165)]){const _0xba1824=(_0x2846e5=_0x3d999f[_0x4b36e3(0x190)](_0x3e86db[_0x4b36e3(0x1a3)]))===null||_0x2846e5===void 0x0?void 0x0:_0x2846e5['status'];_0xba1824&&(_0x3e86db[_0x4b36e3(0x186)]=_0xba1824);}_0x177ef5[_0x4b36e3(0x165)]=_0x177ef5[_0x4b36e3(0x165)][_0x4b36e3(0x19c)](_0x54bdb9=>_0x54bdb9[_0x4b36e3(0x186)]!==status_enums_1[_0x4b36e3(0x1a4)][_0x4b36e3(0x1b4)]);if(!_0x177ef5[_0x4b36e3(0x165)]['length'])throw new Error(_0x4b36e3(0x1a6));return _0x177ef5;}else throw new veeva_error_1[(_0x4b36e3(0x185))](_0x47b247[_0x4b36e3(0x1af)]);}async[a404_0x22fb94(0x168)](_0x37f3c6){const _0x41f4bb=a404_0x22fb94,{data:_0x57ce6d}=await this[_0x41f4bb(0x195)][_0x41f4bb(0x190)](_0x37f3c6,{'responseType':_0x41f4bb(0x1ae)});return _0x57ce6d;}['formPackageComponentList'](_0x5e70e5){const _0x88b30b=a404_0x22fb94;return _0x5e70e5[_0x88b30b(0x17e)]((_0x47ea84,_0x13273b)=>{const _0x219a6d=_0x88b30b,_0x44fe10=_0x13273b[_0x219a6d(0x170)][_0x219a6d(0x1ba)](_0x56975f=>new package_component_dto_1[(_0x219a6d(0x18d))]({'status':_0x13273b[_0x219a6d(0x1b8)],'stepName':_0x13273b[_0x219a6d(0x194)],'component':_0x56975f}));return[..._0x47ea84,..._0x44fe10];},[]);}async[a404_0x22fb94(0x183)](_0x470dc9){const _0x568dca=a404_0x22fb94,{data:_0x414264}=await this[_0x568dca(0x195)]['post'](veeva_constants_1[_0x568dca(0x184)]['ENDPOINT_VALIDATE_PACKAGE'][_0x568dca(0x197)]('{package_id}',_0x470dc9['packageId']));if(_0x414264[_0x568dca(0x18b)]===status_enums_1['VeevaResponseStatus'][_0x568dca(0x167)]){const {package_steps:_0x15c15c}=_0x414264[_0x568dca(0x18c)],_0x35f02=array_utils_1['ArrayUtils']['groupToMap'](_0x470dc9[_0x568dca(0x165)],({stepName:_0x5ab4cd})=>_0x5ab4cd);for(const {name__v:_0x98d080,deployment_action:_0x1f10b4}of _0x15c15c){for(const _0x85c5e of _0x35f02[_0x568dca(0x190)](_0x98d080)||[]){_0x85c5e[_0x568dca(0x1a9)]=package_component_dto_1[_0x568dca(0x18d)][_0x568dca(0x163)](_0x1f10b4);}}}else throw new veeva_error_1['VeevaError'](_0x414264[_0x568dca(0x1af)]);}async[a404_0x22fb94(0x169)](_0x5dcb0d){const _0xdaa640=a404_0x22fb94,_0x2ca187=await this['importVpk'](_0x5dcb0d),_0x12606d=await this[_0xdaa640(0x19e)](_0x2ca187),_0x2159a7=await this[_0xdaa640(0x16d)](_0x12606d),_0x25359f=await this[_0xdaa640(0x1a1)](_0x2159a7[_0xdaa640(0x176)]),_0xe58ac2=await this['getJobDetailUrl'](_0x25359f);return this[_0xdaa640(0x16c)](_0xe58ac2,_0x2159a7);}}exports[a404_0x22fb94(0x175)]=PackageImportService;