const a359_0x1f9487=a359_0x2034;(function(_0x43816d,_0x12e062){const _0x18f283=a359_0x2034,_0x3ee2f3=_0x43816d();while(!![]){try{const _0x3b1a54=-parseInt(_0x18f283(0xa5))/0x1+parseInt(_0x18f283(0x6a))/0x2*(parseInt(_0x18f283(0x88))/0x3)+-parseInt(_0x18f283(0x69))/0x4+parseInt(_0x18f283(0xb1))/0x5+parseInt(_0x18f283(0xbf))/0x6*(parseInt(_0x18f283(0xbc))/0x7)+-parseInt(_0x18f283(0x72))/0x8*(parseInt(_0x18f283(0x9a))/0x9)+-parseInt(_0x18f283(0x85))/0xa*(parseInt(_0x18f283(0x94))/0xb);if(_0x3b1a54===_0x12e062)break;else _0x3ee2f3['push'](_0x3ee2f3['shift']());}catch(_0x59072e){_0x3ee2f3['push'](_0x3ee2f3['shift']());}}}(a359_0x4937,0x8e3d2));const a359_0x1f1668=(function(){let _0x2f9561=!![];return function(_0x1bccb9,_0x259750){const _0x2127a2=_0x2f9561?function(){const _0x3bee10=a359_0x2034;if(_0x259750){const _0x55b3ab=_0x259750[_0x3bee10(0x65)](_0x1bccb9,arguments);return _0x259750=null,_0x55b3ab;}}:function(){};return _0x2f9561=![],_0x2127a2;};}()),a359_0x162b88=a359_0x1f1668(this,function(){const _0x25a6aa=a359_0x2034;return a359_0x162b88[_0x25a6aa(0x68)]()[_0x25a6aa(0xae)]('(((.+)+)+)+$')[_0x25a6aa(0x68)]()[_0x25a6aa(0xb2)](a359_0x162b88)[_0x25a6aa(0xae)](_0x25a6aa(0x7e));});a359_0x162b88();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5e5e41){return _0x5e5e41&&_0x5e5e41['__esModule']?_0x5e5e41:{'default':_0x5e5e41};};function a359_0x4937(){const _0x79fda3=['../enums/status.enums','get','Package\x20not\x20verified','search','PackageDetailsDto','filename','4125390XGCnvq','constructor','SUCCESS','includes','log','Validation.log','DEPLOYED','DEPLOYED_WITH_WARNINGS','responseStatus','Get\x20validation\x20details.','__esModule','1891603eKbJPy','ENDPOINT_EXPORT_IMPORT_PACKAGE','PackageComponentDto','12BBIRfL','{package_id}','apply','length','vaultPackage','toString','3916832rGmIMV','324034oDxiAx','getValidationDetailsAndSaveLog','_logger','VeevaPackageStatus','getJobDetailUrl','../constants/veeva.constants','Validation\x20Log','_saveLog','1176992TnRcYx','fillPackageDeploymentAction','Deployment.log','packageComponentList','post','package_components','Get\x20deploy\x20result','multipart/form-data','VERIFIED','isDeployed','groupUniqueToMap','replace','(((.+)+)+)+$','data','ArrayUtils','ENDPOINT_DEPLOY_PACKAGE','find','endsWith','formPackageComponentList','18310PBPhmv','../utils/veeva-auth.utils','../classes/errors/veeva-error','15whMtLX','_veevaService','defineProperty','filter','errors','updateVeevaConnection','VeevaError','VeevaConstants','deployPackage','getJobResult','PackageComponentStatus','PackageImportService','1353fbghVN','reduce','importVpk','import','../dtos/package-component.dto','_connection','18qifHtM','getLogResultText','../dtos/package-details.dto','VeevaResponseStatus','text','ENDPOINT_VALIDATE_PACKAGE','deploymentAction','packageId','map','status','Wait\x20Executing\x20job','94342hGUHIi','url','getDeployDetailsAndSaveLog','responseDetails','../utils/array.utils','artifacts'];a359_0x4937=function(){return _0x79fda3;};return a359_0x4937();}function a359_0x2034(_0xbe701c,_0xec72d){const _0x5ac017=a359_0x4937();return a359_0x2034=function(_0x162b88,_0x1f1668){_0x162b88=_0x162b88-0x65;let _0x4937fa=_0x5ac017[_0x162b88];return _0x4937fa;},a359_0x2034(_0xbe701c,_0xec72d);}Object[a359_0x1f9487(0x8a)](exports,a359_0x1f9487(0xbb),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require(a359_0x1f9487(0x6f)),status_enums_1=require(a359_0x1f9487(0xab)),veeva_error_1=require(a359_0x1f9487(0x87)),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),veeva_auth_utils_1=require(a359_0x1f9487(0x86)),package_details_dto_1=require(a359_0x1f9487(0x9c)),package_component_dto_1=require(a359_0x1f9487(0x98)),array_utils_1=require(a359_0x1f9487(0xa9));class PackageImportService{constructor({veevaService:_0x2b2229,connection:_0x2f07be,logger:_0x15b2f5,saveLog:_0x5dd905}){const _0x2b6c6c=a359_0x1f9487;this[_0x2b6c6c(0x89)]=_0x2b2229,this[_0x2b6c6c(0x99)]=_0x2f07be,this['_logger']=_0x15b2f5,this[_0x2b6c6c(0x71)]=_0x5dd905;}async[a359_0x1f9487(0x96)](_0x355c16,_0x1623ee=0x1){const _0x447543=a359_0x1f9487;this[_0x447543(0x6c)]['log']('Import\x20package');const _0x55e854=new form_data_1['default']();_0x55e854['append']('file',(0x0,fs_1['createReadStream'])(_0x355c16));const _0x2c35b5=await this[_0x447543(0x99)]['put'](veeva_constants_1[_0x447543(0x8f)][_0x447543(0xbd)],_0x55e854,{'headers':{'Content-Type':_0x447543(0x79)}}),_0x4e933b=_0x2c35b5[_0x447543(0x7f)];if(_0x4e933b['responseStatus']===status_enums_1[_0x447543(0x9d)][_0x447543(0xb3)])return _0x4e933b[_0x447543(0xa6)];else{if(_0x1623ee>0x0)return await(0x0,veeva_auth_utils_1[_0x447543(0x8d)])(this[_0x447543(0x99)]),await this[_0x447543(0x96)](_0x355c16,_0x1623ee-0x1);throw new veeva_error_1['VeevaError'](_0x4e933b[_0x447543(0x8c)]);}}async[a359_0x1f9487(0x90)](_0x30851f){const _0x23bc81=a359_0x1f9487;this[_0x23bc81(0x6c)][_0x23bc81(0xb5)]('Deploy\x20package');const _0x4a4226=await this[_0x23bc81(0x99)][_0x23bc81(0x76)](veeva_constants_1['VeevaConstants'][_0x23bc81(0x81)][_0x23bc81(0x7d)](_0x23bc81(0xc0),_0x30851f)),_0x34467e=await _0x4a4226[_0x23bc81(0x7f)];if(_0x34467e[_0x23bc81(0xb9)]===status_enums_1[_0x23bc81(0x9d)][_0x23bc81(0xb3)])return _0x34467e[_0x23bc81(0xa6)];else throw new veeva_error_1[(_0x23bc81(0x8e))](_0x34467e[_0x23bc81(0x8c)]);}async[a359_0x1f9487(0x6e)](_0x276175){const _0x5ca53a=a359_0x1f9487;this[_0x5ca53a(0x6c)][_0x5ca53a(0xb5)](_0x5ca53a(0xa4));const [_0x16dda3]=await this[_0x5ca53a(0x89)][_0x5ca53a(0x91)]([_0x276175]);return _0x16dda3['links'][_0x5ca53a(0x82)](_0x24f090=>_0x24f090['rel']===_0x5ca53a(0xaa))['href'];}async[a359_0x1f9487(0x6b)](_0x3178fe){const _0x59e9e8=a359_0x1f9487;this[_0x59e9e8(0x6c)][_0x59e9e8(0xb5)](_0x59e9e8(0xba));const {data:_0x19a18c}=await this[_0x59e9e8(0x99)][_0x59e9e8(0xac)](_0x3178fe);if(_0x19a18c['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x59e9e8(0xb3)]){const _0x3899c4=new package_details_dto_1[(_0x59e9e8(0xaf))](),{log:_0x7fc952,id:_0x4ce0f7,package_status:_0x2b6f19,package_steps:_0x2174b9}=_0x19a18c[_0x59e9e8(0x67)],_0xd1e0b0=_0x7fc952['filter'](_0x4b6da6=>_0x4b6da6[_0x59e9e8(0xb0)][_0x59e9e8(0x83)](_0x59e9e8(0xb6))),_0x3cb530=await this[_0x59e9e8(0x9b)](_0xd1e0b0[0x0][_0x59e9e8(0xa6)]);await this['_saveLog'](_0x3cb530,_0x59e9e8(0x70)),_0x3899c4['packageId']=_0x4ce0f7,_0x3899c4[_0x59e9e8(0x75)]=this[_0x59e9e8(0x84)](_0x2174b9),await this[_0x59e9e8(0x73)](_0x3899c4);if(_0x2b6f19!==status_enums_1['VeevaPackageStatus']['VERIFIED'])throw new Error(_0x59e9e8(0xad));return _0x3899c4;}else throw new veeva_error_1[(_0x59e9e8(0x8e))](_0x19a18c[_0x59e9e8(0x8c)]);}async[a359_0x1f9487(0xa7)](_0x290ccc,_0x298d4b){const _0x1ab1f8=a359_0x1f9487;var _0x3f7a48;this[_0x1ab1f8(0x6c)][_0x1ab1f8(0xb5)](_0x1ab1f8(0x78));const {data:_0x5e5cd7}=await this['_connection'][_0x1ab1f8(0xac)](_0x290ccc);if(_0x5e5cd7[_0x1ab1f8(0xb9)]===status_enums_1['VeevaResponseStatus'][_0x1ab1f8(0xb3)]){const {responseDetails:{deployment_log:_0x42adb4,package_status__v:_0x3d48dc},package_steps:_0x69b644}=_0x5e5cd7,_0x12ae96=_0x42adb4[_0x1ab1f8(0x8b)](_0x324107=>_0x324107['filename']['endsWith'](_0x1ab1f8(0x74))),_0x4e60ae=await this[_0x1ab1f8(0x9b)](_0x12ae96[0x0][_0x1ab1f8(0xa6)]);await this[_0x1ab1f8(0x71)](_0x4e60ae,'Deploy\x20Log'),_0x298d4b[_0x1ab1f8(0x7b)]=[status_enums_1[_0x1ab1f8(0x6d)][_0x1ab1f8(0xb7)],status_enums_1[_0x1ab1f8(0x6d)][_0x1ab1f8(0xb8)]][_0x1ab1f8(0xb4)](_0x3d48dc);const _0x5e0be2=array_utils_1[_0x1ab1f8(0x80)][_0x1ab1f8(0x7c)](this[_0x1ab1f8(0x84)](_0x69b644),({uniqueName:_0x172b43})=>_0x172b43);for(const _0x22b27d of _0x298d4b['packageComponentList']){const _0xd3d7c3=(_0x3f7a48=_0x5e0be2[_0x1ab1f8(0xac)](_0x22b27d['uniqueName']))===null||_0x3f7a48===void 0x0?void 0x0:_0x3f7a48[_0x1ab1f8(0xa3)];_0xd3d7c3&&(_0x22b27d[_0x1ab1f8(0xa3)]=_0xd3d7c3);}_0x298d4b[_0x1ab1f8(0x75)]=_0x298d4b[_0x1ab1f8(0x75)][_0x1ab1f8(0x8b)](_0x3ef2a7=>_0x3ef2a7['status']!==status_enums_1[_0x1ab1f8(0x92)][_0x1ab1f8(0x7a)]);if(!_0x298d4b[_0x1ab1f8(0x75)][_0x1ab1f8(0x66)])throw new Error('Cannot\x20find\x20deployment\x20results');return _0x298d4b;}else throw new veeva_error_1['VeevaError'](_0x5e5cd7[_0x1ab1f8(0x8c)]);}async['getLogResultText'](_0x5c6a12){const _0x38216b=a359_0x1f9487,{data:_0x2ad43c}=await this[_0x38216b(0x99)][_0x38216b(0xac)](_0x5c6a12,{'responseType':_0x38216b(0x9e)});return _0x2ad43c;}[a359_0x1f9487(0x84)](_0x8ec18e){const _0x5ad3f6=a359_0x1f9487;return _0x8ec18e[_0x5ad3f6(0x95)]((_0x46063f,_0x3fa505)=>{const _0x4cccf5=_0x5ad3f6,_0x5e61fc=_0x3fa505[_0x4cccf5(0x77)][_0x4cccf5(0xa2)](_0x1a37c8=>new package_component_dto_1[(_0x4cccf5(0xbe))]({'status':_0x3fa505['deployment_status__v'],'stepName':_0x3fa505['name__v'],'component':_0x1a37c8}));return[..._0x46063f,..._0x5e61fc];},[]);}async['fillPackageDeploymentAction'](_0x10bdc9){const _0x2215f5=a359_0x1f9487,{data:_0xefbb4b}=await this['_connection'][_0x2215f5(0x76)](veeva_constants_1[_0x2215f5(0x8f)][_0x2215f5(0x9f)]['replace'](_0x2215f5(0xc0),_0x10bdc9[_0x2215f5(0xa1)]));if(_0xefbb4b[_0x2215f5(0xb9)]===status_enums_1[_0x2215f5(0x9d)][_0x2215f5(0xb3)]){const {package_steps:_0x4b737e}=_0xefbb4b[_0x2215f5(0xa8)],_0x4ef013=array_utils_1[_0x2215f5(0x80)]['groupToMap'](_0x10bdc9['packageComponentList'],({stepName:_0x439d71})=>_0x439d71);for(const {name__v:_0x5bdbfe,deployment_action:_0x1dce27}of _0x4b737e){for(const _0x4434bd of _0x4ef013[_0x2215f5(0xac)](_0x5bdbfe)||[]){_0x4434bd[_0x2215f5(0xa0)]=package_component_dto_1[_0x2215f5(0xbe)]['convertDeploymentAction'](_0x1dce27);}}}else throw new veeva_error_1['VeevaError'](_0xefbb4b[_0x2215f5(0x8c)]);}async[a359_0x1f9487(0x97)](_0x29b039){const _0x3764d9=a359_0x1f9487,_0x4b7768=await this[_0x3764d9(0x96)](_0x29b039),_0x176271=await this[_0x3764d9(0x6e)](_0x4b7768),_0x51de1e=await this[_0x3764d9(0x6b)](_0x176271),_0x3d3ae2=await this['deployPackage'](_0x51de1e['packageId']),_0x3b390f=await this[_0x3764d9(0x6e)](_0x3d3ae2);return this[_0x3764d9(0xa7)](_0x3b390f,_0x51de1e);}}exports[a359_0x1f9487(0x93)]=PackageImportService;