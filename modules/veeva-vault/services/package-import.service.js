const a403_0x4f214b=a403_0x1f87;(function(_0x359c7d,_0x92f608){const _0x3f27a3=a403_0x1f87,_0x28a32c=_0x359c7d();while(!![]){try{const _0x583fb0=parseInt(_0x3f27a3(0xd7))/0x1+-parseInt(_0x3f27a3(0xd5))/0x2+parseInt(_0x3f27a3(0x11d))/0x3+parseInt(_0x3f27a3(0x133))/0x4*(-parseInt(_0x3f27a3(0xf4))/0x5)+parseInt(_0x3f27a3(0xf0))/0x6+-parseInt(_0x3f27a3(0x112))/0x7*(parseInt(_0x3f27a3(0x12c))/0x8)+parseInt(_0x3f27a3(0xe2))/0x9;if(_0x583fb0===_0x92f608)break;else _0x28a32c['push'](_0x28a32c['shift']());}catch(_0x31c5db){_0x28a32c['push'](_0x28a32c['shift']());}}}(a403_0x2802,0x82c6d));const a403_0x51cdbf=(function(){let _0x518bc3=!![];return function(_0x70a74a,_0x5d03e7){const _0x30969f=_0x518bc3?function(){const _0x54d66e=a403_0x1f87;if(_0x5d03e7){const _0x218918=_0x5d03e7[_0x54d66e(0xe0)](_0x70a74a,arguments);return _0x5d03e7=null,_0x218918;}}:function(){};return _0x518bc3=![],_0x30969f;};}()),a403_0x4a105a=a403_0x51cdbf(this,function(){const _0x48a160=a403_0x1f87;return a403_0x4a105a[_0x48a160(0x104)]()[_0x48a160(0x124)]('(((.+)+)+)+$')[_0x48a160(0x104)]()['constructor'](a403_0x4a105a)[_0x48a160(0x124)](_0x48a160(0xd9));});function a403_0x1f87(_0x2aa1d2,_0x2c032a){const _0x130b68=a403_0x2802();return a403_0x1f87=function(_0x4a105a,_0x51cdbf){_0x4a105a=_0x4a105a-0xd4;let _0x280237=_0x130b68[_0x4a105a];return _0x280237;},a403_0x1f87(_0x2aa1d2,_0x2c032a);}a403_0x4a105a();function a403_0x2802(){const _0x2b321c=['find','groupUniqueToMap','deploymentAction','__esModule','VERIFIED','VeevaError','groupToMap','SUCCESS','formPackageComponentList','errors','_logger','href','{package_id}','reduce','toString','defineProperty','../dtos/package-component.dto','_saveLog','log','Package\x20not\x20verified','getValidationDetailsAndSaveLog','packageId','default','Deploy\x20Log','ArrayUtils','includes','responseStatus','packageComponentList','5920509ykkFGq','form-data','Validation\x20Log','get','../classes/errors/veeva-error','getDeployDetailsAndSaveLog','Get\x20deploy\x20result','PackageComponentStatus','filename','post','PackageImportService','1601748qlbtVp','status','importVpk','deployment_status__v','getJobDetailUrl','isDeployed','replace','search','PackageComponentDto','Cannot\x20find\x20deployment\x20results','_veevaService','length','__importDefault','append','rel','8vvBlJy','vaultPackage','endsWith','../utils/veeva-auth.utils','_connection','VeevaResponseStatus','ENDPOINT_VALIDATE_PACKAGE','92TopEwA','../constants/veeva.constants','Wait\x20Executing\x20job','getLogResultText','Deploy\x20package','2133384IjUtyz','../dtos/package-details.dto','430519ZjEfsc','responseDetails','(((.+)+)+)+$','Get\x20validation\x20details.','name__v','../enums/status.enums','links','multipart/form-data','filter','apply','VeevaConstants','14090274TDgwRf','DEPLOYED','convertDeploymentAction','url','Import\x20package','data','put','../utils/array.utils','updateVeevaConnection','VeevaPackageStatus','createReadStream','file','getJobResult','artifacts','2586804aXPcst','map','fillPackageDeploymentAction','ENDPOINT_DEPLOY_PACKAGE','111525ZpIvpt','import'];a403_0x2802=function(){return _0x2b321c;};return a403_0x2802();}'use strict';var __importDefault=this&&this[a403_0x4f214b(0x129)]||function(_0x5be6f7){const _0x4ae72e=a403_0x4f214b;return _0x5be6f7&&_0x5be6f7[_0x4ae72e(0xf9)]?_0x5be6f7:{'default':_0x5be6f7};};Object[a403_0x4f214b(0x105)](exports,a403_0x4f214b(0xf9),{'value':!![]}),exports[a403_0x4f214b(0x11c)]=void 0x0;const veeva_constants_1=require(a403_0x4f214b(0x134)),status_enums_1=require(a403_0x4f214b(0xdc)),veeva_error_1=require(a403_0x4f214b(0x116)),form_data_1=__importDefault(require(a403_0x4f214b(0x113))),fs_1=require('fs'),veeva_auth_utils_1=require(a403_0x4f214b(0x12f)),package_details_dto_1=require(a403_0x4f214b(0xd6)),package_component_dto_1=require(a403_0x4f214b(0x106)),array_utils_1=require(a403_0x4f214b(0xe9));class PackageImportService{constructor({veevaService:_0x21c393,connection:_0x3b34d5,logger:_0x1f7ab2,saveLog:_0x413f8d}){const _0x47d05a=a403_0x4f214b;this[_0x47d05a(0x127)]=_0x21c393,this[_0x47d05a(0x130)]=_0x3b34d5,this['_logger']=_0x1f7ab2,this['_saveLog']=_0x413f8d;}async[a403_0x4f214b(0x11f)](_0x1f644d,_0x2742c0=0x1){const _0x1d8ab1=a403_0x4f214b;this['_logger'][_0x1d8ab1(0x108)](_0x1d8ab1(0xe6));const _0x19500e=new form_data_1[(_0x1d8ab1(0x10c))]();_0x19500e[_0x1d8ab1(0x12a)](_0x1d8ab1(0xed),(0x0,fs_1[_0x1d8ab1(0xec)])(_0x1f644d));const _0x852743=await this['_connection'][_0x1d8ab1(0xe8)](veeva_constants_1[_0x1d8ab1(0xe1)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x19500e,{'headers':{'Content-Type':_0x1d8ab1(0xde)}}),_0x7c5340=_0x852743[_0x1d8ab1(0xe7)];if(_0x7c5340[_0x1d8ab1(0x110)]===status_enums_1['VeevaResponseStatus'][_0x1d8ab1(0xfd)])return _0x7c5340[_0x1d8ab1(0xe5)];else{if(_0x2742c0>0x0)return await(0x0,veeva_auth_utils_1[_0x1d8ab1(0xea)])(this[_0x1d8ab1(0x130)]),await this['importVpk'](_0x1f644d,_0x2742c0-0x1);throw new veeva_error_1[(_0x1d8ab1(0xfb))](_0x7c5340[_0x1d8ab1(0xff)]);}}async['deployPackage'](_0x2681b4){const _0x4e9dbb=a403_0x4f214b;this['_logger'][_0x4e9dbb(0x108)](_0x4e9dbb(0xd4));const _0x55a4fd=await this['_connection'][_0x4e9dbb(0x11b)](veeva_constants_1[_0x4e9dbb(0xe1)][_0x4e9dbb(0xf3)][_0x4e9dbb(0x123)](_0x4e9dbb(0x102),_0x2681b4)),_0x254c18=await _0x55a4fd[_0x4e9dbb(0xe7)];if(_0x254c18['responseStatus']===status_enums_1[_0x4e9dbb(0x131)][_0x4e9dbb(0xfd)])return _0x254c18['url'];else throw new veeva_error_1[(_0x4e9dbb(0xfb))](_0x254c18[_0x4e9dbb(0xff)]);}async[a403_0x4f214b(0x121)](_0x2de9bc){const _0x677771=a403_0x4f214b;this['_logger'][_0x677771(0x108)](_0x677771(0x135));const [_0x14a80e]=await this[_0x677771(0x127)][_0x677771(0xee)]([_0x2de9bc]);return _0x14a80e[_0x677771(0xdd)][_0x677771(0xf6)](_0x417aa7=>_0x417aa7[_0x677771(0x12b)]===_0x677771(0xef))[_0x677771(0x101)];}async[a403_0x4f214b(0x10a)](_0x135da7){const _0x5b7e8a=a403_0x4f214b;this[_0x5b7e8a(0x100)][_0x5b7e8a(0x108)](_0x5b7e8a(0xda));const {data:_0x35be08}=await this[_0x5b7e8a(0x130)][_0x5b7e8a(0x115)](_0x135da7);if(_0x35be08['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x5b7e8a(0xfd)]){const _0xeeceed=new package_details_dto_1['PackageDetailsDto'](),{log:_0x5619f9,id:_0x3ee0ae,package_status:_0x88f649,package_steps:_0x1bf070}=_0x35be08[_0x5b7e8a(0x12d)],_0x31c70e=_0x5619f9[_0x5b7e8a(0xdf)](_0xac2e27=>_0xac2e27[_0x5b7e8a(0x11a)][_0x5b7e8a(0x12e)]('Validation.log')),_0x222ffc=await this[_0x5b7e8a(0x136)](_0x31c70e[0x0][_0x5b7e8a(0xe5)]);await this['_saveLog'](_0x222ffc,_0x5b7e8a(0x114)),_0xeeceed[_0x5b7e8a(0x10b)]=_0x3ee0ae,_0xeeceed[_0x5b7e8a(0x111)]=this[_0x5b7e8a(0xfe)](_0x1bf070),await this[_0x5b7e8a(0xf2)](_0xeeceed);if(_0x88f649!==status_enums_1[_0x5b7e8a(0xeb)][_0x5b7e8a(0xfa)])throw new Error(_0x5b7e8a(0x109));return _0xeeceed;}else throw new veeva_error_1['VeevaError'](_0x35be08[_0x5b7e8a(0xff)]);}async[a403_0x4f214b(0x117)](_0x197c99,_0x11370e){const _0x119bcc=a403_0x4f214b;var _0x2b785e;this[_0x119bcc(0x100)][_0x119bcc(0x108)](_0x119bcc(0x118));const {data:_0x41d40a}=await this['_connection'][_0x119bcc(0x115)](_0x197c99);if(_0x41d40a[_0x119bcc(0x110)]===status_enums_1[_0x119bcc(0x131)][_0x119bcc(0xfd)]){const {responseDetails:{deployment_log:_0x134beb,package_status__v:_0x451af8},package_steps:_0x34135c}=_0x41d40a,_0x4482f0=_0x134beb[_0x119bcc(0xdf)](_0x591372=>_0x591372['filename'][_0x119bcc(0x12e)]('Deployment.log')),_0x46a25c=await this[_0x119bcc(0x136)](_0x4482f0[0x0][_0x119bcc(0xe5)]);await this[_0x119bcc(0x107)](_0x46a25c,_0x119bcc(0x10d)),_0x11370e[_0x119bcc(0x122)]=[status_enums_1[_0x119bcc(0xeb)][_0x119bcc(0xe3)],status_enums_1['VeevaPackageStatus']['DEPLOYED_WITH_WARNINGS']][_0x119bcc(0x10f)](_0x451af8);const _0x41442a=array_utils_1['ArrayUtils'][_0x119bcc(0xf7)](this[_0x119bcc(0xfe)](_0x34135c),({uniqueName:_0x2c8928})=>_0x2c8928);for(const _0x23ecb2 of _0x11370e[_0x119bcc(0x111)]){const _0x40fce3=(_0x2b785e=_0x41442a['get'](_0x23ecb2['uniqueName']))===null||_0x2b785e===void 0x0?void 0x0:_0x2b785e[_0x119bcc(0x11e)];_0x40fce3&&(_0x23ecb2[_0x119bcc(0x11e)]=_0x40fce3);}_0x11370e[_0x119bcc(0x111)]=_0x11370e[_0x119bcc(0x111)][_0x119bcc(0xdf)](_0x1bb708=>_0x1bb708[_0x119bcc(0x11e)]!==status_enums_1[_0x119bcc(0x119)][_0x119bcc(0xfa)]);if(!_0x11370e['packageComponentList'][_0x119bcc(0x128)])throw new Error(_0x119bcc(0x126));return _0x11370e;}else throw new veeva_error_1[(_0x119bcc(0xfb))](_0x41d40a[_0x119bcc(0xff)]);}async['getLogResultText'](_0x2854f5){const _0x2ffcd5=a403_0x4f214b,{data:_0x28247a}=await this[_0x2ffcd5(0x130)][_0x2ffcd5(0x115)](_0x2854f5,{'responseType':'text'});return _0x28247a;}[a403_0x4f214b(0xfe)](_0x27bf50){const _0x16f710=a403_0x4f214b;return _0x27bf50[_0x16f710(0x103)]((_0x3cc124,_0x22baa5)=>{const _0x738e28=_0x16f710,_0x40890f=_0x22baa5['package_components'][_0x738e28(0xf1)](_0x2b6351=>new package_component_dto_1[(_0x738e28(0x125))]({'status':_0x22baa5[_0x738e28(0x120)],'stepName':_0x22baa5[_0x738e28(0xdb)],'component':_0x2b6351}));return[..._0x3cc124,..._0x40890f];},[]);}async['fillPackageDeploymentAction'](_0x5befb7){const _0x146850=a403_0x4f214b,{data:_0x415528}=await this[_0x146850(0x130)][_0x146850(0x11b)](veeva_constants_1[_0x146850(0xe1)][_0x146850(0x132)]['replace'](_0x146850(0x102),_0x5befb7['packageId']));if(_0x415528[_0x146850(0x110)]===status_enums_1[_0x146850(0x131)][_0x146850(0xfd)]){const {package_steps:_0x197387}=_0x415528[_0x146850(0xd8)],_0x2f23b6=array_utils_1[_0x146850(0x10e)][_0x146850(0xfc)](_0x5befb7[_0x146850(0x111)],({stepName:_0x104a88})=>_0x104a88);for(const {name__v:_0x121049,deployment_action:_0x166947}of _0x197387){for(const _0x4d7054 of _0x2f23b6[_0x146850(0x115)](_0x121049)||[]){_0x4d7054[_0x146850(0xf8)]=package_component_dto_1['PackageComponentDto'][_0x146850(0xe4)](_0x166947);}}}else throw new veeva_error_1[(_0x146850(0xfb))](_0x415528[_0x146850(0xff)]);}async[a403_0x4f214b(0xf5)](_0x3b2dd6){const _0x196eb9=a403_0x4f214b,_0x4f75f=await this['importVpk'](_0x3b2dd6),_0x2ab966=await this[_0x196eb9(0x121)](_0x4f75f),_0x420c67=await this[_0x196eb9(0x10a)](_0x2ab966),_0x56f7f4=await this['deployPackage'](_0x420c67[_0x196eb9(0x10b)]),_0xb583bb=await this[_0x196eb9(0x121)](_0x56f7f4);return this['getDeployDetailsAndSaveLog'](_0xb583bb,_0x420c67);}}exports[a403_0x4f214b(0x11c)]=PackageImportService;