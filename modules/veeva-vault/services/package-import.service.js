const a392_0x1bfa68=a392_0x5063;(function(_0x36e614,_0x9b1e46){const _0x14a880=a392_0x5063,_0x49355e=_0x36e614();while(!![]){try{const _0x866357=parseInt(_0x14a880(0x129))/0x1+-parseInt(_0x14a880(0x109))/0x2+-parseInt(_0x14a880(0x11d))/0x3+parseInt(_0x14a880(0xf0))/0x4+-parseInt(_0x14a880(0xe8))/0x5*(-parseInt(_0x14a880(0x112))/0x6)+parseInt(_0x14a880(0xe1))/0x7*(-parseInt(_0x14a880(0x101))/0x8)+parseInt(_0x14a880(0x130))/0x9;if(_0x866357===_0x9b1e46)break;else _0x49355e['push'](_0x49355e['shift']());}catch(_0x524c02){_0x49355e['push'](_0x49355e['shift']());}}}(a392_0x1143,0x87d5c));const a392_0x6c18d2=(function(){let _0x13e80c=!![];return function(_0x29e250,_0x3e3965){const _0x5245de=_0x13e80c?function(){const _0x2ce937=a392_0x5063;if(_0x3e3965){const _0xc6a641=_0x3e3965[_0x2ce937(0xda)](_0x29e250,arguments);return _0x3e3965=null,_0xc6a641;}}:function(){};return _0x13e80c=![],_0x5245de;};}()),a392_0x1742e5=a392_0x6c18d2(this,function(){const _0x1e586d=a392_0x5063;return a392_0x1742e5['toString']()[_0x1e586d(0xd7)](_0x1e586d(0x10c))[_0x1e586d(0xf3)]()[_0x1e586d(0xdc)](a392_0x1742e5)[_0x1e586d(0xd7)](_0x1e586d(0x10c));});a392_0x1742e5();function a392_0x5063(_0x69de0f,_0x4029f1){const _0x428dad=a392_0x1143();return a392_0x5063=function(_0x1742e5,_0x6c18d2){_0x1742e5=_0x1742e5-0xd7;let _0x114356=_0x428dad[_0x1742e5];return _0x114356;},a392_0x5063(_0x69de0f,_0x4029f1);}function a392_0x1143(){const _0x4373ca=['2113896usLFYJ','href','Wait\x20Executing\x20job','data','SUCCESS','isDeployed','PackageComponentStatus','ENDPOINT_DEPLOY_PACKAGE','post','multipart/form-data','links','getValidationDetailsAndSaveLog','23466ZXWUtn','get','Import\x20package','endsWith','replace','ENDPOINT_VALIDATE_PACKAGE','_veevaService','24696504LWzfNx','uniqueName','DEPLOYED_WITH_WARNINGS','__esModule','ArrayUtils','filename','createReadStream','Cannot\x20find\x20deployment\x20results','search','getLogResultText','includes','apply','formPackageComponentList','constructor','default','deployPackage','packageComponentList','__importDefault','41776daYagn','VERIFIED','../dtos/package-component.dto','{package_id}','package_components','filter','rel','861795CTybRV','Validation\x20Log','importVpk','responseStatus','log','VeevaError','fillPackageDeploymentAction','getJobResult','409296XNmqMY','put','_connection','toString','Package\x20not\x20verified','deploymentAction','reduce','_logger','VeevaPackageStatus','PackageDetailsDto','Deploy\x20Log','errors','updateVeevaConnection','../utils/array.utils','artifacts','defineProperty','form-data','1392ttCrst','length','../enums/status.enums','getJobDetailUrl','Get\x20deploy\x20result','url','VeevaConstants','text','1485522YlNZIU','status','import','(((.+)+)+)+$','PackageComponentDto','vaultPackage','PackageImportService','../classes/errors/veeva-error','Deployment.log','6XcSBBu','_saveLog','find','groupUniqueToMap','groupToMap','ENDPOINT_EXPORT_IMPORT_PACKAGE','getDeployDetailsAndSaveLog','../dtos/package-details.dto','name__v','VeevaResponseStatus','convertDeploymentAction'];a392_0x1143=function(){return _0x4373ca;};return a392_0x1143();}'use strict';var __importDefault=this&&this[a392_0x1bfa68(0xe0)]||function(_0x5435a0){const _0x481287=a392_0x1bfa68;return _0x5435a0&&_0x5435a0[_0x481287(0x133)]?_0x5435a0:{'default':_0x5435a0};};Object[a392_0x1bfa68(0xff)](exports,a392_0x1bfa68(0x133),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),status_enums_1=require(a392_0x1bfa68(0x103)),veeva_error_1=require(a392_0x1bfa68(0x110)),form_data_1=__importDefault(require(a392_0x1bfa68(0x100))),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require(a392_0x1bfa68(0x119)),package_component_dto_1=require(a392_0x1bfa68(0xe3)),array_utils_1=require(a392_0x1bfa68(0xfd));class PackageImportService{constructor({veevaService:_0x36866a,connection:_0x242966,logger:_0x220e18,saveLog:_0x5bd238}){const _0x308c98=a392_0x1bfa68;this[_0x308c98(0x12f)]=_0x36866a,this[_0x308c98(0xf2)]=_0x242966,this['_logger']=_0x220e18,this[_0x308c98(0x113)]=_0x5bd238;}async[a392_0x1bfa68(0xea)](_0x3493e0,_0x55c4e4=0x1){const _0x55dfe9=a392_0x1bfa68;this[_0x55dfe9(0xf7)]['log'](_0x55dfe9(0x12b));const _0x1b5df5=new form_data_1[(_0x55dfe9(0xdd))]();_0x1b5df5['append']('file',(0x0,fs_1[_0x55dfe9(0x136)])(_0x3493e0));const _0x57fa1e=await this[_0x55dfe9(0xf2)][_0x55dfe9(0xf1)](veeva_constants_1[_0x55dfe9(0x107)][_0x55dfe9(0x117)],_0x1b5df5,{'headers':{'Content-Type':_0x55dfe9(0x126)}}),_0x51ad84=_0x57fa1e[_0x55dfe9(0x120)];if(_0x51ad84[_0x55dfe9(0xeb)]===status_enums_1[_0x55dfe9(0x11b)][_0x55dfe9(0x121)])return _0x51ad84[_0x55dfe9(0x106)];else{if(_0x55c4e4>0x0)return await(0x0,veeva_auth_utils_1[_0x55dfe9(0xfc)])(this[_0x55dfe9(0xf2)]),await this['importVpk'](_0x3493e0,_0x55c4e4-0x1);throw new veeva_error_1[(_0x55dfe9(0xed))](_0x51ad84[_0x55dfe9(0xfb)]);}}async[a392_0x1bfa68(0xde)](_0x6cf8fa){const _0x22959d=a392_0x1bfa68;this[_0x22959d(0xf7)][_0x22959d(0xec)]('Deploy\x20package');const _0x2153b0=await this[_0x22959d(0xf2)]['post'](veeva_constants_1[_0x22959d(0x107)][_0x22959d(0x124)][_0x22959d(0x12d)](_0x22959d(0xe4),_0x6cf8fa)),_0x2db262=await _0x2153b0[_0x22959d(0x120)];if(_0x2db262[_0x22959d(0xeb)]===status_enums_1[_0x22959d(0x11b)][_0x22959d(0x121)])return _0x2db262[_0x22959d(0x106)];else throw new veeva_error_1[(_0x22959d(0xed))](_0x2db262[_0x22959d(0xfb)]);}async[a392_0x1bfa68(0x104)](_0xa98066){const _0xe8b494=a392_0x1bfa68;this[_0xe8b494(0xf7)][_0xe8b494(0xec)](_0xe8b494(0x11f));const [_0x3722d3]=await this[_0xe8b494(0x12f)][_0xe8b494(0xef)]([_0xa98066]);return _0x3722d3[_0xe8b494(0x127)][_0xe8b494(0x114)](_0x22e2d1=>_0x22e2d1[_0xe8b494(0xe7)]===_0xe8b494(0xfe))[_0xe8b494(0x11e)];}async['getValidationDetailsAndSaveLog'](_0x5a11ad){const _0x9436e7=a392_0x1bfa68;this[_0x9436e7(0xf7)][_0x9436e7(0xec)]('Get\x20validation\x20details.');const {data:_0x238c65}=await this[_0x9436e7(0xf2)][_0x9436e7(0x12a)](_0x5a11ad);if(_0x238c65[_0x9436e7(0xeb)]===status_enums_1['VeevaResponseStatus'][_0x9436e7(0x121)]){const _0x237b6c=new package_details_dto_1[(_0x9436e7(0xf9))](),{log:_0x427454,id:_0xa4267a,package_status:_0x144869,package_steps:_0x366838}=_0x238c65[_0x9436e7(0x10e)],_0xc0523d=_0x427454[_0x9436e7(0xe6)](_0x3bf3b7=>_0x3bf3b7[_0x9436e7(0x135)][_0x9436e7(0x12c)]('Validation.log')),_0x3564f1=await this['getLogResultText'](_0xc0523d[0x0][_0x9436e7(0x106)]);await this[_0x9436e7(0x113)](_0x3564f1,_0x9436e7(0xe9)),_0x237b6c['packageId']=_0xa4267a,_0x237b6c[_0x9436e7(0xdf)]=this['formPackageComponentList'](_0x366838),await this[_0x9436e7(0xee)](_0x237b6c);if(_0x144869!==status_enums_1[_0x9436e7(0xf8)][_0x9436e7(0xe2)])throw new Error(_0x9436e7(0xf4));return _0x237b6c;}else throw new veeva_error_1[(_0x9436e7(0xed))](_0x238c65[_0x9436e7(0xfb)]);}async[a392_0x1bfa68(0x118)](_0xdcb9f8,_0xfa168f){const _0x5a79fb=a392_0x1bfa68;var _0x5b2611;this[_0x5a79fb(0xf7)][_0x5a79fb(0xec)](_0x5a79fb(0x105));const {data:_0x369589}=await this['_connection']['get'](_0xdcb9f8);if(_0x369589[_0x5a79fb(0xeb)]===status_enums_1['VeevaResponseStatus'][_0x5a79fb(0x121)]){const {responseDetails:{deployment_log:_0x13a05c,package_status__v:_0x11990c},package_steps:_0x12e37a}=_0x369589,_0x4c9743=_0x13a05c[_0x5a79fb(0xe6)](_0x2a98db=>_0x2a98db[_0x5a79fb(0x135)][_0x5a79fb(0x12c)](_0x5a79fb(0x111))),_0x3a6317=await this[_0x5a79fb(0xd8)](_0x4c9743[0x0][_0x5a79fb(0x106)]);await this[_0x5a79fb(0x113)](_0x3a6317,_0x5a79fb(0xfa)),_0xfa168f[_0x5a79fb(0x122)]=[status_enums_1[_0x5a79fb(0xf8)]['DEPLOYED'],status_enums_1['VeevaPackageStatus'][_0x5a79fb(0x132)]][_0x5a79fb(0xd9)](_0x11990c);const _0x5d4d2b=array_utils_1[_0x5a79fb(0x134)][_0x5a79fb(0x115)](this[_0x5a79fb(0xdb)](_0x12e37a),({uniqueName:_0x82a061})=>_0x82a061);for(const _0x235818 of _0xfa168f['packageComponentList']){const _0x3433a1=(_0x5b2611=_0x5d4d2b[_0x5a79fb(0x12a)](_0x235818[_0x5a79fb(0x131)]))===null||_0x5b2611===void 0x0?void 0x0:_0x5b2611[_0x5a79fb(0x10a)];_0x3433a1&&(_0x235818['status']=_0x3433a1);}_0xfa168f[_0x5a79fb(0xdf)]=_0xfa168f['packageComponentList'][_0x5a79fb(0xe6)](_0x389a5a=>_0x389a5a[_0x5a79fb(0x10a)]!==status_enums_1[_0x5a79fb(0x123)][_0x5a79fb(0xe2)]);if(!_0xfa168f[_0x5a79fb(0xdf)][_0x5a79fb(0x102)])throw new Error(_0x5a79fb(0x137));return _0xfa168f;}else throw new veeva_error_1[(_0x5a79fb(0xed))](_0x369589[_0x5a79fb(0xfb)]);}async[a392_0x1bfa68(0xd8)](_0x5c5dac){const _0x225d27=a392_0x1bfa68,{data:_0x4731fb}=await this[_0x225d27(0xf2)]['get'](_0x5c5dac,{'responseType':_0x225d27(0x108)});return _0x4731fb;}[a392_0x1bfa68(0xdb)](_0x470a7d){const _0x4cb1f7=a392_0x1bfa68;return _0x470a7d[_0x4cb1f7(0xf6)]((_0x3bd548,_0x178f07)=>{const _0x35a800=_0x4cb1f7,_0x196f2a=_0x178f07[_0x35a800(0xe5)]['map'](_0x6c4541=>new package_component_dto_1[(_0x35a800(0x10d))]({'status':_0x178f07['deployment_status__v'],'stepName':_0x178f07[_0x35a800(0x11a)],'component':_0x6c4541}));return[..._0x3bd548,..._0x196f2a];},[]);}async[a392_0x1bfa68(0xee)](_0x536b2d){const _0x5f4adb=a392_0x1bfa68,{data:_0x58ae9c}=await this[_0x5f4adb(0xf2)][_0x5f4adb(0x125)](veeva_constants_1[_0x5f4adb(0x107)][_0x5f4adb(0x12e)][_0x5f4adb(0x12d)]('{package_id}',_0x536b2d['packageId']));if(_0x58ae9c[_0x5f4adb(0xeb)]===status_enums_1[_0x5f4adb(0x11b)][_0x5f4adb(0x121)]){const {package_steps:_0x50d976}=_0x58ae9c['responseDetails'],_0x280e79=array_utils_1[_0x5f4adb(0x134)][_0x5f4adb(0x116)](_0x536b2d[_0x5f4adb(0xdf)],({stepName:_0x413a9c})=>_0x413a9c);for(const {name__v:_0xfd0449,deployment_action:_0x260ba0}of _0x50d976){for(const _0x97951b of _0x280e79[_0x5f4adb(0x12a)](_0xfd0449)||[]){_0x97951b[_0x5f4adb(0xf5)]=package_component_dto_1['PackageComponentDto'][_0x5f4adb(0x11c)](_0x260ba0);}}}else throw new veeva_error_1['VeevaError'](_0x58ae9c[_0x5f4adb(0xfb)]);}async[a392_0x1bfa68(0x10b)](_0x4cbaf6){const _0x1e76b7=a392_0x1bfa68,_0x205a65=await this[_0x1e76b7(0xea)](_0x4cbaf6),_0x5a4a99=await this[_0x1e76b7(0x104)](_0x205a65),_0x4d021e=await this[_0x1e76b7(0x128)](_0x5a4a99),_0x4310f4=await this[_0x1e76b7(0xde)](_0x4d021e['packageId']),_0x34e0d8=await this[_0x1e76b7(0x104)](_0x4310f4);return this[_0x1e76b7(0x118)](_0x34e0d8,_0x4d021e);}}exports[a392_0x1bfa68(0x10f)]=PackageImportService;