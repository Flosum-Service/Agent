const a404_0x30a87c=a404_0x2450;(function(_0x3a7ae7,_0x2d215e){const _0x26cc72=a404_0x2450,_0x34b5e1=_0x3a7ae7();while(!![]){try{const _0x893f47=parseInt(_0x26cc72(0x1c0))/0x1+parseInt(_0x26cc72(0x1ca))/0x2+parseInt(_0x26cc72(0x1b1))/0x3+parseInt(_0x26cc72(0x1a5))/0x4+parseInt(_0x26cc72(0x1d3))/0x5+-parseInt(_0x26cc72(0x18f))/0x6*(parseInt(_0x26cc72(0x18e))/0x7)+parseInt(_0x26cc72(0x198))/0x8*(-parseInt(_0x26cc72(0x194))/0x9);if(_0x893f47===_0x2d215e)break;else _0x34b5e1['push'](_0x34b5e1['shift']());}catch(_0x1b8076){_0x34b5e1['push'](_0x34b5e1['shift']());}}}(a404_0x337a,0x7ffe0));const a404_0x1cd725=(function(){let _0x3e59d1=!![];return function(_0x3e1888,_0xad5a6b){const _0x26d554=_0x3e59d1?function(){if(_0xad5a6b){const _0x273d72=_0xad5a6b['apply'](_0x3e1888,arguments);return _0xad5a6b=null,_0x273d72;}}:function(){};return _0x3e59d1=![],_0x26d554;};}()),a404_0x597e7e=a404_0x1cd725(this,function(){const _0x31b8d8=a404_0x2450;return a404_0x597e7e[_0x31b8d8(0x1d7)]()[_0x31b8d8(0x19f)](_0x31b8d8(0x1a7))[_0x31b8d8(0x1d7)]()[_0x31b8d8(0x1ba)](a404_0x597e7e)['search']('(((.+)+)+)+$');});a404_0x597e7e();function a404_0x2450(_0x409c40,_0x52b262){const _0x135a84=a404_0x337a();return a404_0x2450=function(_0x597e7e,_0x1cd725){_0x597e7e=_0x597e7e-0x188;let _0x337abe=_0x135a84[_0x597e7e];return _0x337abe;},a404_0x2450(_0x409c40,_0x52b262);}'use strict';var __importDefault=this&&this[a404_0x30a87c(0x1bd)]||function(_0xd0c39e){const _0x146cdb=a404_0x30a87c;return _0xd0c39e&&_0xd0c39e[_0x146cdb(0x1b5)]?_0xd0c39e:{'default':_0xd0c39e};};Object['defineProperty'](exports,a404_0x30a87c(0x1b5),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require(a404_0x30a87c(0x1cd)),status_enums_1=require(a404_0x30a87c(0x1d0)),veeva_error_1=require('../classes/errors/veeva-error'),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require('../dtos/package-details.dto'),package_component_dto_1=require(a404_0x30a87c(0x190)),array_utils_1=require(a404_0x30a87c(0x1c4));class PackageImportService{constructor({veevaService:_0x47f4e5,connection:_0x38a42f,logger:_0x3a4a79,saveLog:_0x412280}){const _0xda3052=a404_0x30a87c;this[_0xda3052(0x1ab)]=_0x47f4e5,this['_connection']=_0x38a42f,this[_0xda3052(0x1d9)]=_0x3a4a79,this[_0xda3052(0x1a0)]=_0x412280;}async['importVpk'](_0x281c6f,_0x4fa77e=0x1){const _0x35cd72=a404_0x30a87c;this[_0x35cd72(0x1d9)][_0x35cd72(0x18d)](_0x35cd72(0x1e1));const _0x283bfc=new form_data_1[(_0x35cd72(0x1b0))]();_0x283bfc[_0x35cd72(0x1e0)](_0x35cd72(0x18a),(0x0,fs_1['createReadStream'])(_0x281c6f));const _0x124056=await this[_0x35cd72(0x1bb)][_0x35cd72(0x1b3)](veeva_constants_1[_0x35cd72(0x1af)][_0x35cd72(0x19d)],_0x283bfc,{'headers':{'Content-Type':_0x35cd72(0x1cb)}}),_0x52f313=_0x124056[_0x35cd72(0x1be)];if(_0x52f313['responseStatus']===status_enums_1['VeevaResponseStatus']['SUCCESS'])return _0x52f313[_0x35cd72(0x196)];else{if(_0x4fa77e>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x35cd72(0x1bb)]),await this[_0x35cd72(0x1b2)](_0x281c6f,_0x4fa77e-0x1);throw new veeva_error_1[(_0x35cd72(0x19a))](_0x52f313[_0x35cd72(0x1b6)]);}}async['deployPackage'](_0x4a791b){const _0x589318=a404_0x30a87c;this[_0x589318(0x1d9)][_0x589318(0x18d)](_0x589318(0x1b9));const _0x2f617f=await this[_0x589318(0x1bb)][_0x589318(0x1d8)](veeva_constants_1[_0x589318(0x1af)][_0x589318(0x1c7)][_0x589318(0x1a8)](_0x589318(0x1cf),_0x4a791b)),_0x355dbc=await _0x2f617f[_0x589318(0x1be)];if(_0x355dbc['responseStatus']===status_enums_1[_0x589318(0x1dc)]['SUCCESS'])return _0x355dbc[_0x589318(0x196)];else throw new veeva_error_1[(_0x589318(0x19a))](_0x355dbc[_0x589318(0x1b6)]);}async[a404_0x30a87c(0x1c5)](_0x4d0a8f){const _0x1a01ae=a404_0x30a87c;this[_0x1a01ae(0x1d9)][_0x1a01ae(0x18d)](_0x1a01ae(0x1b4));const [_0x5d58d0]=await this[_0x1a01ae(0x1ab)][_0x1a01ae(0x1d4)]([_0x4d0a8f]);return _0x5d58d0[_0x1a01ae(0x1d5)][_0x1a01ae(0x1c6)](_0x20ff23=>_0x20ff23[_0x1a01ae(0x1bc)]==='artifacts')[_0x1a01ae(0x197)];}async[a404_0x30a87c(0x1df)](_0x3b14a6){const _0x1c2392=a404_0x30a87c;this[_0x1c2392(0x1d9)][_0x1c2392(0x18d)]('Get\x20validation\x20details.');const {data:_0x5007ea}=await this[_0x1c2392(0x1bb)][_0x1c2392(0x19b)](_0x3b14a6);if(_0x5007ea[_0x1c2392(0x1d6)]===status_enums_1[_0x1c2392(0x1dc)]['SUCCESS']){const _0x3b3a1c=new package_details_dto_1[(_0x1c2392(0x1c9))](),{log:_0x37b4c4,id:_0xc3b358,package_status:_0x398653,package_steps:_0x4f6bae}=_0x5007ea[_0x1c2392(0x1a9)],_0x41b110=_0x37b4c4[_0x1c2392(0x193)](_0x191538=>_0x191538[_0x1c2392(0x1ac)][_0x1c2392(0x18c)](_0x1c2392(0x191))),_0x31d5ff=await this[_0x1c2392(0x195)](_0x41b110[0x0][_0x1c2392(0x196)]);await this[_0x1c2392(0x1a0)](_0x31d5ff,_0x1c2392(0x1a1)),_0x3b3a1c[_0x1c2392(0x1e2)]=_0xc3b358,_0x3b3a1c['packageComponentList']=this[_0x1c2392(0x1bf)](_0x4f6bae),await this['fillPackageDeploymentAction'](_0x3b3a1c);if(_0x398653!==status_enums_1[_0x1c2392(0x199)][_0x1c2392(0x1b8)])throw new Error(_0x1c2392(0x1ce));return _0x3b3a1c;}else throw new veeva_error_1['VeevaError'](_0x5007ea[_0x1c2392(0x1b6)]);}async['getDeployDetailsAndSaveLog'](_0x174abb,_0x3252a8){const _0x315260=a404_0x30a87c;var _0x306db0;this[_0x315260(0x1d9)][_0x315260(0x18d)](_0x315260(0x1dd));const {data:_0x26e797}=await this[_0x315260(0x1bb)][_0x315260(0x19b)](_0x174abb);if(_0x26e797[_0x315260(0x1d6)]===status_enums_1[_0x315260(0x1dc)][_0x315260(0x1aa)]){const {responseDetails:{deployment_log:_0x3b356e,package_status__v:_0x20ff34},package_steps:_0x53d4a2}=_0x26e797,_0xf561cb=_0x3b356e[_0x315260(0x193)](_0x2b40ea=>_0x2b40ea[_0x315260(0x1ac)][_0x315260(0x18c)](_0x315260(0x1e3))),_0x3a7b6f=await this[_0x315260(0x195)](_0xf561cb[0x0][_0x315260(0x196)]);await this[_0x315260(0x1a0)](_0x3a7b6f,_0x315260(0x1a6)),_0x3252a8['isDeployed']=[status_enums_1[_0x315260(0x199)][_0x315260(0x1da)],status_enums_1[_0x315260(0x199)]['DEPLOYED_WITH_WARNINGS']][_0x315260(0x1c1)](_0x20ff34);const _0x33e353=array_utils_1[_0x315260(0x1a3)][_0x315260(0x1ae)](this[_0x315260(0x1bf)](_0x53d4a2),({uniqueName:_0x5cc16a})=>_0x5cc16a);for(const _0x5602fb of _0x3252a8[_0x315260(0x1d1)]){const _0x38578d=(_0x306db0=_0x33e353[_0x315260(0x19b)](_0x5602fb['uniqueName']))===null||_0x306db0===void 0x0?void 0x0:_0x306db0[_0x315260(0x1db)];_0x38578d&&(_0x5602fb['status']=_0x38578d);}_0x3252a8['packageComponentList']=_0x3252a8['packageComponentList'][_0x315260(0x193)](_0x138f50=>_0x138f50[_0x315260(0x1db)]!==status_enums_1['PackageComponentStatus'][_0x315260(0x1b8)]);if(!_0x3252a8[_0x315260(0x1d1)][_0x315260(0x1cc)])throw new Error(_0x315260(0x1de));return _0x3252a8;}else throw new veeva_error_1['VeevaError'](_0x26e797[_0x315260(0x1b6)]);}async[a404_0x30a87c(0x195)](_0x57a206){const _0x3c62c5=a404_0x30a87c,{data:_0x1383b7}=await this[_0x3c62c5(0x1bb)][_0x3c62c5(0x19b)](_0x57a206,{'responseType':'text'});return _0x1383b7;}['formPackageComponentList'](_0x41cbda){const _0x3b8ca6=a404_0x30a87c;return _0x41cbda[_0x3b8ca6(0x18b)]((_0x148ad6,_0x168d7b)=>{const _0x445545=_0x3b8ca6,_0x436ab4=_0x168d7b[_0x445545(0x1d2)][_0x445545(0x1c2)](_0x5cfa64=>new package_component_dto_1[(_0x445545(0x188))]({'status':_0x168d7b[_0x445545(0x1b7)],'stepName':_0x168d7b[_0x445545(0x1ad)],'component':_0x5cfa64}));return[..._0x148ad6,..._0x436ab4];},[]);}async['fillPackageDeploymentAction'](_0xf92f73){const _0x1bd118=a404_0x30a87c,{data:_0x357ca5}=await this['_connection'][_0x1bd118(0x1d8)](veeva_constants_1[_0x1bd118(0x1af)]['ENDPOINT_VALIDATE_PACKAGE'][_0x1bd118(0x1a8)](_0x1bd118(0x1cf),_0xf92f73[_0x1bd118(0x1e2)]));if(_0x357ca5[_0x1bd118(0x1d6)]===status_enums_1[_0x1bd118(0x1dc)][_0x1bd118(0x1aa)]){const {package_steps:_0x234c0f}=_0x357ca5[_0x1bd118(0x1c8)],_0x25323d=array_utils_1[_0x1bd118(0x1a3)][_0x1bd118(0x1a2)](_0xf92f73[_0x1bd118(0x1d1)],({stepName:_0x1b3cb6})=>_0x1b3cb6);for(const {name__v:_0x1cf51d,deployment_action:_0x273b7d}of _0x234c0f){for(const _0x639efc of _0x25323d[_0x1bd118(0x19b)](_0x1cf51d)||[]){_0x639efc[_0x1bd118(0x19c)]=package_component_dto_1[_0x1bd118(0x188)][_0x1bd118(0x189)](_0x273b7d);}}}else throw new veeva_error_1[(_0x1bd118(0x19a))](_0x357ca5['errors']);}async[a404_0x30a87c(0x1a4)](_0x2613c5){const _0x40763b=a404_0x30a87c,_0x13628e=await this['importVpk'](_0x2613c5),_0x3e8a22=await this[_0x40763b(0x1c5)](_0x13628e),_0x2b5469=await this['getValidationDetailsAndSaveLog'](_0x3e8a22),_0x48c9d3=await this[_0x40763b(0x19e)](_0x2b5469[_0x40763b(0x1e2)]),_0x5378b3=await this[_0x40763b(0x1c5)](_0x48c9d3);return this[_0x40763b(0x192)](_0x5378b3,_0x2b5469);}}function a404_0x337a(){const _0x1077f0=['VeevaConstants','default','1342983mgOMGZ','importVpk','put','Wait\x20Executing\x20job','__esModule','errors','deployment_status__v','VERIFIED','Deploy\x20package','constructor','_connection','rel','__importDefault','data','formPackageComponentList','273673gbvzpn','includes','map','PackageImportService','../utils/array.utils','getJobDetailUrl','find','ENDPOINT_DEPLOY_PACKAGE','responseDetails','PackageDetailsDto','1299736sPSWQt','multipart/form-data','length','../constants/veeva.constants','Package\x20not\x20verified','{package_id}','../enums/status.enums','packageComponentList','package_components','4750425trzdmY','getJobResult','links','responseStatus','toString','post','_logger','DEPLOYED','status','VeevaResponseStatus','Get\x20deploy\x20result','Cannot\x20find\x20deployment\x20results','getValidationDetailsAndSaveLog','append','Import\x20package','packageId','Deployment.log','PackageComponentDto','convertDeploymentAction','file','reduce','endsWith','log','7GMjoQn','190290ulaEZY','../dtos/package-component.dto','Validation.log','getDeployDetailsAndSaveLog','filter','126XslSrC','getLogResultText','url','href','1245256EPIXEt','VeevaPackageStatus','VeevaError','get','deploymentAction','ENDPOINT_EXPORT_IMPORT_PACKAGE','deployPackage','search','_saveLog','Validation\x20Log','groupToMap','ArrayUtils','import','1655528kebvzg','Deploy\x20Log','(((.+)+)+)+$','replace','vaultPackage','SUCCESS','_veevaService','filename','name__v','groupUniqueToMap'];a404_0x337a=function(){return _0x1077f0;};return a404_0x337a();}exports[a404_0x30a87c(0x1c3)]=PackageImportService;