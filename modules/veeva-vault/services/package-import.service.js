const a360_0x229395=a360_0x5575;(function(_0x41568e,_0x2c84f9){const _0x455b1e=a360_0x5575,_0x409318=_0x41568e();while(!![]){try{const _0x56137d=parseInt(_0x455b1e(0xe9))/0x1*(-parseInt(_0x455b1e(0xc5))/0x2)+parseInt(_0x455b1e(0xad))/0x3+-parseInt(_0x455b1e(0xe4))/0x4+-parseInt(_0x455b1e(0xb4))/0x5+parseInt(_0x455b1e(0xb5))/0x6+parseInt(_0x455b1e(0xa6))/0x7*(-parseInt(_0x455b1e(0xbe))/0x8)+parseInt(_0x455b1e(0xb9))/0x9;if(_0x56137d===_0x2c84f9)break;else _0x409318['push'](_0x409318['shift']());}catch(_0x491f60){_0x409318['push'](_0x409318['shift']());}}}(a360_0x5069,0x2e214));const a360_0xd7f2fc=(function(){let _0x3b771d=!![];return function(_0x108561,_0x263769){const _0x37f90c=_0x3b771d?function(){const _0x502ba4=a360_0x5575;if(_0x263769){const _0x45bbfe=_0x263769[_0x502ba4(0x9f)](_0x108561,arguments);return _0x263769=null,_0x45bbfe;}}:function(){};return _0x3b771d=![],_0x37f90c;};}()),a360_0x32f1b0=a360_0xd7f2fc(this,function(){const _0x12319d=a360_0x5575;return a360_0x32f1b0[_0x12319d(0xb7)]()[_0x12319d(0xe2)]('(((.+)+)+)+$')['toString']()[_0x12319d(0xa8)](a360_0x32f1b0)[_0x12319d(0xe2)](_0x12319d(0xf3));});function a360_0x5069(){const _0x158adb=['get','Wait\x20Executing\x20job','apply','responseDetails','_connection','getJobResult','endsWith','defineProperty','getValidationDetailsAndSaveLog','14WCcUft','getJobDetailUrl','constructor','status','map','groupUniqueToMap','deploymentAction','755376SWyLgx','Deployment.log','data','VERIFIED','log','vaultPackage','Validation\x20Log','188525CxWCvm','395292uhAXuT','Deploy\x20package','toString','Cannot\x20find\x20deployment\x20results','3102264aXqvsj','{package_id}','default','responseStatus','append','678176etVPOu','__esModule','filename','../utils/veeva-auth.utils','uniqueName','VeevaPackageStatus','filter','14sMgPNB','put','DEPLOYED','VeevaResponseStatus','artifacts','_saveLog','formPackageComponentList','Validation.log','VeevaConstants','Get\x20deploy\x20result','Package\x20not\x20verified','ArrayUtils','PackageComponentStatus','multipart/form-data','Deploy\x20Log','packageComponentList','includes','replace','fillPackageDeploymentAction','getDeployDetailsAndSaveLog','../enums/status.enums','getLogResultText','VeevaError','package_components','SUCCESS','text','import','PackageDetailsDto','packageId','search','groupToMap','848280nLxWbQ','PackageImportService','Import\x20package','errors','url','7729MwvqcS','deployment_status__v','_logger','ENDPOINT_EXPORT_IMPORT_PACKAGE','form-data','../classes/errors/veeva-error','DEPLOYED_WITH_WARNINGS','href','deployPackage','find','(((.+)+)+)+$','_veevaService','../dtos/package-details.dto','links','file','importVpk','rel','post'];a360_0x5069=function(){return _0x158adb;};return a360_0x5069();}a360_0x32f1b0();'use strict';function a360_0x5575(_0x4fd514,_0x49eefe){const _0x44a612=a360_0x5069();return a360_0x5575=function(_0x32f1b0,_0xd7f2fc){_0x32f1b0=_0x32f1b0-0x99;let _0x50690d=_0x44a612[_0x32f1b0];return _0x50690d;},a360_0x5575(_0x4fd514,_0x49eefe);}var __importDefault=this&&this['__importDefault']||function(_0x547aa9){const _0x222b19=a360_0x5575;return _0x547aa9&&_0x547aa9[_0x222b19(0xbf)]?_0x547aa9:{'default':_0x547aa9};};Object[a360_0x229395(0xa4)](exports,a360_0x229395(0xbf),{'value':!![]}),exports[a360_0x229395(0xe5)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),status_enums_1=require(a360_0x229395(0xd9)),veeva_error_1=require(a360_0x229395(0xee)),form_data_1=__importDefault(require(a360_0x229395(0xed))),fs_1=require('fs'),veeva_auth_utils_1=require(a360_0x229395(0xc1)),package_details_dto_1=require(a360_0x229395(0xf5)),package_component_dto_1=require('../dtos/package-component.dto'),array_utils_1=require('../utils/array.utils');class PackageImportService{constructor({veevaService:_0x519076,connection:_0x3e2464,logger:_0x481961,saveLog:_0x15c669}){const _0x596d89=a360_0x229395;this[_0x596d89(0xf4)]=_0x519076,this['_connection']=_0x3e2464,this[_0x596d89(0xeb)]=_0x481961,this[_0x596d89(0xca)]=_0x15c669;}async[a360_0x229395(0x9a)](_0x84d374,_0x118073=0x1){const _0x56e3f2=a360_0x229395;this[_0x56e3f2(0xeb)][_0x56e3f2(0xb1)](_0x56e3f2(0xe6));const _0x5b815f=new form_data_1[(_0x56e3f2(0xbb))]();_0x5b815f[_0x56e3f2(0xbd)](_0x56e3f2(0x99),(0x0,fs_1['createReadStream'])(_0x84d374));const _0x3b91cb=await this[_0x56e3f2(0xa1)][_0x56e3f2(0xc6)](veeva_constants_1[_0x56e3f2(0xcd)][_0x56e3f2(0xec)],_0x5b815f,{'headers':{'Content-Type':_0x56e3f2(0xd2)}}),_0xa65c22=_0x3b91cb[_0x56e3f2(0xaf)];if(_0xa65c22['responseStatus']===status_enums_1[_0x56e3f2(0xc8)][_0x56e3f2(0xdd)])return _0xa65c22[_0x56e3f2(0xe8)];else{if(_0x118073>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x56e3f2(0xa1)]),await this[_0x56e3f2(0x9a)](_0x84d374,_0x118073-0x1);throw new veeva_error_1[(_0x56e3f2(0xdb))](_0xa65c22[_0x56e3f2(0xe7)]);}}async[a360_0x229395(0xf1)](_0x41c642){const _0x544749=a360_0x229395;this[_0x544749(0xeb)]['log'](_0x544749(0xb6));const _0x2efb91=await this[_0x544749(0xa1)][_0x544749(0x9c)](veeva_constants_1['VeevaConstants']['ENDPOINT_DEPLOY_PACKAGE'][_0x544749(0xd6)](_0x544749(0xba),_0x41c642)),_0x4aa134=await _0x2efb91[_0x544749(0xaf)];if(_0x4aa134[_0x544749(0xbc)]===status_enums_1[_0x544749(0xc8)]['SUCCESS'])return _0x4aa134[_0x544749(0xe8)];else throw new veeva_error_1[(_0x544749(0xdb))](_0x4aa134['errors']);}async[a360_0x229395(0xa7)](_0x2c0668){const _0x4b1cd8=a360_0x229395;this[_0x4b1cd8(0xeb)][_0x4b1cd8(0xb1)](_0x4b1cd8(0x9e));const [_0x5d3c55]=await this['_veevaService'][_0x4b1cd8(0xa2)]([_0x2c0668]);return _0x5d3c55[_0x4b1cd8(0xf6)][_0x4b1cd8(0xf2)](_0x15e8bf=>_0x15e8bf[_0x4b1cd8(0x9b)]===_0x4b1cd8(0xc9))[_0x4b1cd8(0xf0)];}async['getValidationDetailsAndSaveLog'](_0x29459c){const _0x5e73be=a360_0x229395;this['_logger']['log']('Get\x20validation\x20details.');const {data:_0x438abc}=await this['_connection'][_0x5e73be(0x9d)](_0x29459c);if(_0x438abc[_0x5e73be(0xbc)]===status_enums_1[_0x5e73be(0xc8)][_0x5e73be(0xdd)]){const _0x3ec180=new package_details_dto_1[(_0x5e73be(0xe0))](),{log:_0x53d06f,id:_0x2aa682,package_status:_0x27428d,package_steps:_0x131708}=_0x438abc[_0x5e73be(0xb2)],_0x1b8a31=_0x53d06f[_0x5e73be(0xc4)](_0x3d920b=>_0x3d920b[_0x5e73be(0xc0)][_0x5e73be(0xa3)](_0x5e73be(0xcc))),_0x8c2a66=await this[_0x5e73be(0xda)](_0x1b8a31[0x0][_0x5e73be(0xe8)]);await this[_0x5e73be(0xca)](_0x8c2a66,_0x5e73be(0xb3)),_0x3ec180[_0x5e73be(0xe1)]=_0x2aa682,_0x3ec180[_0x5e73be(0xd4)]=this[_0x5e73be(0xcb)](_0x131708),await this[_0x5e73be(0xd7)](_0x3ec180);if(_0x27428d!==status_enums_1[_0x5e73be(0xc3)][_0x5e73be(0xb0)])throw new Error(_0x5e73be(0xcf));return _0x3ec180;}else throw new veeva_error_1[(_0x5e73be(0xdb))](_0x438abc[_0x5e73be(0xe7)]);}async['getDeployDetailsAndSaveLog'](_0x549d15,_0x553224){const _0xd74ed=a360_0x229395;var _0x156cfb;this[_0xd74ed(0xeb)]['log'](_0xd74ed(0xce));const {data:_0x5b656c}=await this[_0xd74ed(0xa1)]['get'](_0x549d15);if(_0x5b656c[_0xd74ed(0xbc)]===status_enums_1[_0xd74ed(0xc8)]['SUCCESS']){const {responseDetails:{deployment_log:_0x36e02d,package_status__v:_0x9fd9b5},package_steps:_0x5391d4}=_0x5b656c,_0x279d1d=_0x36e02d[_0xd74ed(0xc4)](_0x43f9ee=>_0x43f9ee[_0xd74ed(0xc0)][_0xd74ed(0xa3)](_0xd74ed(0xae))),_0x574f13=await this[_0xd74ed(0xda)](_0x279d1d[0x0]['url']);await this['_saveLog'](_0x574f13,_0xd74ed(0xd3)),_0x553224['isDeployed']=[status_enums_1[_0xd74ed(0xc3)][_0xd74ed(0xc7)],status_enums_1['VeevaPackageStatus'][_0xd74ed(0xef)]][_0xd74ed(0xd5)](_0x9fd9b5);const _0x1aa757=array_utils_1['ArrayUtils'][_0xd74ed(0xab)](this[_0xd74ed(0xcb)](_0x5391d4),({uniqueName:_0x54a2b0})=>_0x54a2b0);for(const _0x341fb2 of _0x553224[_0xd74ed(0xd4)]){const _0x1bda59=(_0x156cfb=_0x1aa757[_0xd74ed(0x9d)](_0x341fb2[_0xd74ed(0xc2)]))===null||_0x156cfb===void 0x0?void 0x0:_0x156cfb[_0xd74ed(0xa9)];_0x1bda59&&(_0x341fb2[_0xd74ed(0xa9)]=_0x1bda59);}_0x553224[_0xd74ed(0xd4)]=_0x553224['packageComponentList'][_0xd74ed(0xc4)](_0x21d904=>_0x21d904['status']!==status_enums_1[_0xd74ed(0xd1)][_0xd74ed(0xb0)]);if(!_0x553224[_0xd74ed(0xd4)]['length'])throw new Error(_0xd74ed(0xb8));return _0x553224;}else throw new veeva_error_1['VeevaError'](_0x5b656c[_0xd74ed(0xe7)]);}async['getLogResultText'](_0x370aad){const _0x59074b=a360_0x229395,{data:_0x16ceee}=await this[_0x59074b(0xa1)][_0x59074b(0x9d)](_0x370aad,{'responseType':_0x59074b(0xde)});return _0x16ceee;}['formPackageComponentList'](_0x10adfc){return _0x10adfc['reduce']((_0x4ae32c,_0x596bb9)=>{const _0x14702c=a360_0x5575,_0x313075=_0x596bb9[_0x14702c(0xdc)][_0x14702c(0xaa)](_0x557176=>new package_component_dto_1['PackageComponentDto']({'status':_0x596bb9[_0x14702c(0xea)],'stepName':_0x596bb9['name__v'],'component':_0x557176}));return[..._0x4ae32c,..._0x313075];},[]);}async['fillPackageDeploymentAction'](_0x25d18a){const _0x15d918=a360_0x229395,{data:_0x45c1c2}=await this[_0x15d918(0xa1)][_0x15d918(0x9c)](veeva_constants_1[_0x15d918(0xcd)]['ENDPOINT_VALIDATE_PACKAGE']['replace']('{package_id}',_0x25d18a[_0x15d918(0xe1)]));if(_0x45c1c2[_0x15d918(0xbc)]===status_enums_1[_0x15d918(0xc8)][_0x15d918(0xdd)]){const {package_steps:_0x1ab0ca}=_0x45c1c2[_0x15d918(0xa0)],_0x4cc15a=array_utils_1[_0x15d918(0xd0)][_0x15d918(0xe3)](_0x25d18a['packageComponentList'],({stepName:_0x1665da})=>_0x1665da);for(const {name__v:_0x5e9a15,deployment_action:_0x465e2a}of _0x1ab0ca){for(const _0x130a0e of _0x4cc15a['get'](_0x5e9a15)||[]){_0x130a0e[_0x15d918(0xac)]=package_component_dto_1['PackageComponentDto']['convertDeploymentAction'](_0x465e2a);}}}else throw new veeva_error_1[(_0x15d918(0xdb))](_0x45c1c2[_0x15d918(0xe7)]);}async[a360_0x229395(0xdf)](_0x54c0a3){const _0x39acdf=a360_0x229395,_0x3d4029=await this['importVpk'](_0x54c0a3),_0xee9604=await this[_0x39acdf(0xa7)](_0x3d4029),_0x532107=await this[_0x39acdf(0xa5)](_0xee9604),_0x916300=await this['deployPackage'](_0x532107[_0x39acdf(0xe1)]),_0x54bf26=await this[_0x39acdf(0xa7)](_0x916300);return this[_0x39acdf(0xd8)](_0x54bf26,_0x532107);}}exports[a360_0x229395(0xe5)]=PackageImportService;