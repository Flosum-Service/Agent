const a404_0x1d393c=a404_0x47d4;function a404_0x37c6(){const _0x2cd4e7=['responseDetails','groupUniqueToMap','rel','Deploy\x20package','1664rVvAXS','77aLJyFN','uniqueName','deploymentAction','length','Cannot\x20find\x20deployment\x20results','get','145912YtVevC','__esModule','Get\x20validation\x20details.','data','1619097xdBRLk','apply','getLogResultText','updateVeevaConnection','_logger','PackageComponentStatus','getValidationDetailsAndSaveLog','VeevaPackageStatus','import','reduce','{package_id}','PackageImportService','Package\x20not\x20verified','861012Euupxy','582338pqDcht','ArrayUtils','SUCCESS','(((.+)+)+)+$','replace','name__v','Deployment.log','url','packageId','PackageDetailsDto','formPackageComponentList','find','file','fillPackageDeploymentAction','vaultPackage','isDeployed','deployPackage','status','ENDPOINT_DEPLOY_PACKAGE','_saveLog','getDeployDetailsAndSaveLog','Validation.log','deployment_status__v','groupToMap','form-data','PackageComponentDto','2441104JpZjQw','__importDefault','toString','../constants/veeva.constants','responseStatus','getJobDetailUrl','multipart/form-data','importVpk','VeevaError','createReadStream','../classes/errors/veeva-error','VERIFIED','includes','_connection','../enums/status.enums','getJobResult','errors','log','VeevaResponseStatus','put','map','../dtos/package-details.dto','435hiHbcT','19662723XNLXod','../dtos/package-component.dto','../utils/veeva-auth.utils','filename','_veevaService','Get\x20deploy\x20result','packageComponentList','Wait\x20Executing\x20job','VeevaConstants','links','endsWith','append','href','filter'];a404_0x37c6=function(){return _0x2cd4e7;};return a404_0x37c6();}(function(_0x72ba2b,_0x4a00e9){const _0x3a4a61=a404_0x47d4,_0x5233e4=_0x72ba2b();while(!![]){try{const _0x16a265=parseInt(_0x3a4a61(0x1b6))/0x1+parseInt(_0x3a4a61(0x1c8))/0x2+-parseInt(_0x3a4a61(0x1ba))/0x3+parseInt(_0x3a4a61(0x1af))/0x4*(parseInt(_0x3a4a61(0x19c))/0x5)+-parseInt(_0x3a4a61(0x1c7))/0x6*(parseInt(_0x3a4a61(0x1b0))/0x7)+parseInt(_0x3a4a61(0x186))/0x8+parseInt(_0x3a4a61(0x19d))/0x9;if(_0x16a265===_0x4a00e9)break;else _0x5233e4['push'](_0x5233e4['shift']());}catch(_0x40ca07){_0x5233e4['push'](_0x5233e4['shift']());}}}(a404_0x37c6,0xce489));const a404_0x1a4104=(function(){let _0x35368c=!![];return function(_0xfd67e6,_0x1464bf){const _0x4b29cc=_0x35368c?function(){const _0x320a7f=a404_0x47d4;if(_0x1464bf){const _0x110a28=_0x1464bf[_0x320a7f(0x1bb)](_0xfd67e6,arguments);return _0x1464bf=null,_0x110a28;}}:function(){};return _0x35368c=![],_0x4b29cc;};}()),a404_0x272d4c=a404_0x1a4104(this,function(){const _0x158663=a404_0x47d4;return a404_0x272d4c[_0x158663(0x188)]()['search'](_0x158663(0x1cb))[_0x158663(0x188)]()['constructor'](a404_0x272d4c)['search'](_0x158663(0x1cb));});a404_0x272d4c();'use strict';var __importDefault=this&&this[a404_0x1d393c(0x187)]||function(_0x45bc0b){const _0x650fb9=a404_0x1d393c;return _0x45bc0b&&_0x45bc0b[_0x650fb9(0x1b7)]?_0x45bc0b:{'default':_0x45bc0b};};Object['defineProperty'](exports,a404_0x1d393c(0x1b7),{'value':!![]}),exports[a404_0x1d393c(0x1c5)]=void 0x0;const veeva_constants_1=require(a404_0x1d393c(0x189)),status_enums_1=require(a404_0x1d393c(0x194)),veeva_error_1=require(a404_0x1d393c(0x190)),form_data_1=__importDefault(require(a404_0x1d393c(0x184))),fs_1=require('fs'),veeva_auth_utils_1=require(a404_0x1d393c(0x19f)),package_details_dto_1=require(a404_0x1d393c(0x19b)),package_component_dto_1=require(a404_0x1d393c(0x19e)),array_utils_1=require('../utils/array.utils');function a404_0x47d4(_0x4e3e7b,_0x153c2e){const _0x510925=a404_0x37c6();return a404_0x47d4=function(_0x272d4c,_0x1a4104){_0x272d4c=_0x272d4c-0x180;let _0x37c6f9=_0x510925[_0x272d4c];return _0x37c6f9;},a404_0x47d4(_0x4e3e7b,_0x153c2e);}class PackageImportService{constructor({veevaService:_0x56d005,connection:_0x4c9066,logger:_0x2b22f5,saveLog:_0x45f857}){const _0x514474=a404_0x1d393c;this[_0x514474(0x1a1)]=_0x56d005,this[_0x514474(0x193)]=_0x4c9066,this[_0x514474(0x1be)]=_0x2b22f5,this[_0x514474(0x1db)]=_0x45f857;}async[a404_0x1d393c(0x18d)](_0x2f88d9,_0x4b0f20=0x1){const _0x8a2b45=a404_0x1d393c;this['_logger'][_0x8a2b45(0x197)]('Import\x20package');const _0xcdfd5c=new form_data_1['default']();_0xcdfd5c[_0x8a2b45(0x1a8)](_0x8a2b45(0x1d4),(0x0,fs_1[_0x8a2b45(0x18f)])(_0x2f88d9));const _0x26b85a=await this[_0x8a2b45(0x193)][_0x8a2b45(0x199)](veeva_constants_1[_0x8a2b45(0x1a5)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0xcdfd5c,{'headers':{'Content-Type':_0x8a2b45(0x18c)}}),_0x96d7f5=_0x26b85a[_0x8a2b45(0x1b9)];if(_0x96d7f5['responseStatus']===status_enums_1[_0x8a2b45(0x198)][_0x8a2b45(0x1ca)])return _0x96d7f5[_0x8a2b45(0x1cf)];else{if(_0x4b0f20>0x0)return await(0x0,veeva_auth_utils_1[_0x8a2b45(0x1bd)])(this[_0x8a2b45(0x193)]),await this[_0x8a2b45(0x18d)](_0x2f88d9,_0x4b0f20-0x1);throw new veeva_error_1[(_0x8a2b45(0x18e))](_0x96d7f5[_0x8a2b45(0x196)]);}}async[a404_0x1d393c(0x1d8)](_0x2eeb2a){const _0x2f1a8e=a404_0x1d393c;this['_logger'][_0x2f1a8e(0x197)](_0x2f1a8e(0x1ae));const _0x4fa598=await this['_connection']['post'](veeva_constants_1[_0x2f1a8e(0x1a5)][_0x2f1a8e(0x1da)][_0x2f1a8e(0x1cc)](_0x2f1a8e(0x1c4),_0x2eeb2a)),_0x3ef3ae=await _0x4fa598['data'];if(_0x3ef3ae[_0x2f1a8e(0x18a)]===status_enums_1['VeevaResponseStatus']['SUCCESS'])return _0x3ef3ae[_0x2f1a8e(0x1cf)];else throw new veeva_error_1[(_0x2f1a8e(0x18e))](_0x3ef3ae[_0x2f1a8e(0x196)]);}async[a404_0x1d393c(0x18b)](_0x2d4678){const _0x30d9d3=a404_0x1d393c;this[_0x30d9d3(0x1be)]['log'](_0x30d9d3(0x1a4));const [_0x3921ed]=await this[_0x30d9d3(0x1a1)][_0x30d9d3(0x195)]([_0x2d4678]);return _0x3921ed[_0x30d9d3(0x1a6)][_0x30d9d3(0x1d3)](_0x244b03=>_0x244b03[_0x30d9d3(0x1ad)]==='artifacts')[_0x30d9d3(0x1a9)];}async[a404_0x1d393c(0x1c0)](_0x1b640b){const _0xc62f6b=a404_0x1d393c;this[_0xc62f6b(0x1be)][_0xc62f6b(0x197)](_0xc62f6b(0x1b8));const {data:_0x566936}=await this[_0xc62f6b(0x193)]['get'](_0x1b640b);if(_0x566936[_0xc62f6b(0x18a)]===status_enums_1['VeevaResponseStatus'][_0xc62f6b(0x1ca)]){const _0x1bf9d3=new package_details_dto_1[(_0xc62f6b(0x1d1))](),{log:_0x222f65,id:_0x111b27,package_status:_0x1c3730,package_steps:_0x230490}=_0x566936[_0xc62f6b(0x1d6)],_0x1c07fc=_0x222f65[_0xc62f6b(0x1aa)](_0x48b805=>_0x48b805[_0xc62f6b(0x1a0)][_0xc62f6b(0x1a7)](_0xc62f6b(0x181))),_0x20d828=await this[_0xc62f6b(0x1bc)](_0x1c07fc[0x0][_0xc62f6b(0x1cf)]);await this[_0xc62f6b(0x1db)](_0x20d828,'Validation\x20Log'),_0x1bf9d3[_0xc62f6b(0x1d0)]=_0x111b27,_0x1bf9d3[_0xc62f6b(0x1a3)]=this['formPackageComponentList'](_0x230490),await this[_0xc62f6b(0x1d5)](_0x1bf9d3);if(_0x1c3730!==status_enums_1[_0xc62f6b(0x1c1)]['VERIFIED'])throw new Error(_0xc62f6b(0x1c6));return _0x1bf9d3;}else throw new veeva_error_1[(_0xc62f6b(0x18e))](_0x566936[_0xc62f6b(0x196)]);}async['getDeployDetailsAndSaveLog'](_0x40fd2c,_0x3cbc0f){const _0x471505=a404_0x1d393c;var _0x1a37b1;this[_0x471505(0x1be)][_0x471505(0x197)](_0x471505(0x1a2));const {data:_0x4925d8}=await this[_0x471505(0x193)]['get'](_0x40fd2c);if(_0x4925d8['responseStatus']===status_enums_1[_0x471505(0x198)][_0x471505(0x1ca)]){const {responseDetails:{deployment_log:_0x29e5fb,package_status__v:_0x22ad65},package_steps:_0xf87a84}=_0x4925d8,_0x337214=_0x29e5fb['filter'](_0x2dee7a=>_0x2dee7a[_0x471505(0x1a0)][_0x471505(0x1a7)](_0x471505(0x1ce))),_0x389951=await this[_0x471505(0x1bc)](_0x337214[0x0]['url']);await this[_0x471505(0x1db)](_0x389951,'Deploy\x20Log'),_0x3cbc0f[_0x471505(0x1d7)]=[status_enums_1[_0x471505(0x1c1)]['DEPLOYED'],status_enums_1['VeevaPackageStatus']['DEPLOYED_WITH_WARNINGS']][_0x471505(0x192)](_0x22ad65);const _0x233de1=array_utils_1[_0x471505(0x1c9)][_0x471505(0x1ac)](this[_0x471505(0x1d2)](_0xf87a84),({uniqueName:_0x5d164c})=>_0x5d164c);for(const _0x1b6a77 of _0x3cbc0f['packageComponentList']){const _0x293242=(_0x1a37b1=_0x233de1[_0x471505(0x1b5)](_0x1b6a77[_0x471505(0x1b1)]))===null||_0x1a37b1===void 0x0?void 0x0:_0x1a37b1[_0x471505(0x1d9)];_0x293242&&(_0x1b6a77['status']=_0x293242);}_0x3cbc0f['packageComponentList']=_0x3cbc0f[_0x471505(0x1a3)]['filter'](_0x3f03fc=>_0x3f03fc[_0x471505(0x1d9)]!==status_enums_1[_0x471505(0x1bf)][_0x471505(0x191)]);if(!_0x3cbc0f['packageComponentList'][_0x471505(0x1b3)])throw new Error(_0x471505(0x1b4));return _0x3cbc0f;}else throw new veeva_error_1[(_0x471505(0x18e))](_0x4925d8[_0x471505(0x196)]);}async[a404_0x1d393c(0x1bc)](_0x3a0b79){const _0x1315ad=a404_0x1d393c,{data:_0x3481e8}=await this[_0x1315ad(0x193)][_0x1315ad(0x1b5)](_0x3a0b79,{'responseType':'text'});return _0x3481e8;}[a404_0x1d393c(0x1d2)](_0x224364){const _0x44990e=a404_0x1d393c;return _0x224364[_0x44990e(0x1c3)]((_0x450c7d,_0x52d306)=>{const _0x10409f=_0x44990e,_0x5b7c35=_0x52d306['package_components'][_0x10409f(0x19a)](_0x36e6d6=>new package_component_dto_1[(_0x10409f(0x185))]({'status':_0x52d306[_0x10409f(0x182)],'stepName':_0x52d306[_0x10409f(0x1cd)],'component':_0x36e6d6}));return[..._0x450c7d,..._0x5b7c35];},[]);}async[a404_0x1d393c(0x1d5)](_0x2154e3){const _0x2d7b49=a404_0x1d393c,{data:_0x136f2c}=await this[_0x2d7b49(0x193)]['post'](veeva_constants_1['VeevaConstants']['ENDPOINT_VALIDATE_PACKAGE'][_0x2d7b49(0x1cc)](_0x2d7b49(0x1c4),_0x2154e3[_0x2d7b49(0x1d0)]));if(_0x136f2c['responseStatus']===status_enums_1[_0x2d7b49(0x198)][_0x2d7b49(0x1ca)]){const {package_steps:_0x4aa753}=_0x136f2c[_0x2d7b49(0x1ab)],_0x492c68=array_utils_1[_0x2d7b49(0x1c9)][_0x2d7b49(0x183)](_0x2154e3[_0x2d7b49(0x1a3)],({stepName:_0x3a302b})=>_0x3a302b);for(const {name__v:_0x2399fd,deployment_action:_0x49aa31}of _0x4aa753){for(const _0x4a0d67 of _0x492c68['get'](_0x2399fd)||[]){_0x4a0d67[_0x2d7b49(0x1b2)]=package_component_dto_1[_0x2d7b49(0x185)]['convertDeploymentAction'](_0x49aa31);}}}else throw new veeva_error_1[(_0x2d7b49(0x18e))](_0x136f2c[_0x2d7b49(0x196)]);}async[a404_0x1d393c(0x1c2)](_0x5272f1){const _0x3bcae7=a404_0x1d393c,_0x142f5a=await this['importVpk'](_0x5272f1),_0x56b8f8=await this[_0x3bcae7(0x18b)](_0x142f5a),_0x5b1616=await this['getValidationDetailsAndSaveLog'](_0x56b8f8),_0x2f8782=await this[_0x3bcae7(0x1d8)](_0x5b1616['packageId']),_0x172036=await this[_0x3bcae7(0x18b)](_0x2f8782);return this[_0x3bcae7(0x180)](_0x172036,_0x5b1616);}}exports['PackageImportService']=PackageImportService;