function a404_0x33d0(){const _0x433f13=['PackageImportService','11962UgYhEV','_connection','6658729egUknS','655990oQVNeR','_saveLog','getJobDetailUrl','(((.+)+)+)+$','convertDeploymentAction','import','status','fillPackageDeploymentAction','VeevaPackageStatus','put','data','VeevaResponseStatus','multipart/form-data','createReadStream','file','../dtos/package-component.dto','3058940mtnWwg','artifacts','../utils/array.utils','url','links','getLogResultText','packageComponentList','filter','Validation.log','../dtos/package-details.dto','groupUniqueToMap','vaultPackage','isDeployed','defineProperty','../constants/veeva.constants','Get\x20validation\x20details.','../utils/veeva-auth.utils','importVpk','search','log','packageId','{package_id}','text','uniqueName','PackageDetailsDto','PackageComponentDto','updateVeevaConnection','DEPLOYED','Get\x20deploy\x20result','473346XfqTFf','apply','8557542sUQHvs','toString','name__v','SUCCESS','8pvExMz','deployment_status__v','form-data','_logger','__esModule','22zyJNws','responseDetails','VERIFIED','package_components','formPackageComponentList','Deployment.log','DEPLOYED_WITH_WARNINGS','_veevaService','reduce','Import\x20package','28150944zvABMd','append','__importDefault','Cannot\x20find\x20deployment\x20results','find','responseStatus','length','deploymentAction','constructor','VeevaError','post','endsWith','getValidationDetailsAndSaveLog','VeevaConstants','getDeployDetailsAndSaveLog','65jbYCpe','ArrayUtils','Deploy\x20package','get','map','errors','rel','replace','187ItiNXH','3psiNmO'];a404_0x33d0=function(){return _0x433f13;};return a404_0x33d0();}const a404_0x3308c1=a404_0x39fa;(function(_0x80ac20,_0x3c97ae){const _0x13b7e2=a404_0x39fa,_0x1327b8=_0x80ac20();while(!![]){try{const _0x33bb2d=-parseInt(_0x13b7e2(0xdf))/0x1*(-parseInt(_0x13b7e2(0x103))/0x2)+parseInt(_0x13b7e2(0x101))/0x3*(parseInt(_0x13b7e2(0xb7))/0x4)+parseInt(_0x13b7e2(0xf8))/0x5*(parseInt(_0x13b7e2(0xd4))/0x6)+parseInt(_0x13b7e2(0x105))/0x7*(-parseInt(_0x13b7e2(0xda))/0x8)+parseInt(_0x13b7e2(0xd6))/0x9+parseInt(_0x13b7e2(0x106))/0xa*(parseInt(_0x13b7e2(0x100))/0xb)+-parseInt(_0x13b7e2(0xe9))/0xc;if(_0x33bb2d===_0x3c97ae)break;else _0x1327b8['push'](_0x1327b8['shift']());}catch(_0x1b9dba){_0x1327b8['push'](_0x1327b8['shift']());}}}(a404_0x33d0,0xa8a4a));const a404_0x55acac=(function(){let _0x20d9aa=!![];return function(_0x3a1d2e,_0x5d6886){const _0x20918c=_0x20d9aa?function(){const _0xef5473=a404_0x39fa;if(_0x5d6886){const _0x4c6d1f=_0x5d6886[_0xef5473(0xd5)](_0x3a1d2e,arguments);return _0x5d6886=null,_0x4c6d1f;}}:function(){};return _0x20d9aa=![],_0x20918c;};}()),a404_0x2825d0=a404_0x55acac(this,function(){const _0x5989b7=a404_0x39fa;return a404_0x2825d0[_0x5989b7(0xd7)]()[_0x5989b7(0xc9)]('(((.+)+)+)+$')[_0x5989b7(0xd7)]()[_0x5989b7(0xf1)](a404_0x2825d0)[_0x5989b7(0xc9)](_0x5989b7(0x109));});a404_0x2825d0();'use strict';var __importDefault=this&&this[a404_0x3308c1(0xeb)]||function(_0x36cacc){return _0x36cacc&&_0x36cacc['__esModule']?_0x36cacc:{'default':_0x36cacc};};function a404_0x39fa(_0x8a3e0d,_0x108985){const _0x49baff=a404_0x33d0();return a404_0x39fa=function(_0x2825d0,_0x55acac){_0x2825d0=_0x2825d0-0xaf;let _0x33d0a8=_0x49baff[_0x2825d0];return _0x33d0a8;},a404_0x39fa(_0x8a3e0d,_0x108985);}Object[a404_0x3308c1(0xc4)](exports,a404_0x3308c1(0xde),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require(a404_0x3308c1(0xc5)),status_enums_1=require('../enums/status.enums'),veeva_error_1=require('../classes/errors/veeva-error'),form_data_1=__importDefault(require(a404_0x3308c1(0xdc))),fs_1=require('fs'),veeva_auth_utils_1=require(a404_0x3308c1(0xc7)),package_details_dto_1=require(a404_0x3308c1(0xc0)),package_component_dto_1=require(a404_0x3308c1(0xb6)),array_utils_1=require(a404_0x3308c1(0xb9));class PackageImportService{constructor({veevaService:_0x31f368,connection:_0x1d1ae4,logger:_0x3de923,saveLog:_0x255ba5}){const _0x22fe4a=a404_0x3308c1;this[_0x22fe4a(0xe6)]=_0x31f368,this[_0x22fe4a(0x104)]=_0x1d1ae4,this[_0x22fe4a(0xdd)]=_0x3de923,this[_0x22fe4a(0x107)]=_0x255ba5;}async[a404_0x3308c1(0xc8)](_0x282365,_0x38e7a9=0x1){const _0xd4300c=a404_0x3308c1;this[_0xd4300c(0xdd)][_0xd4300c(0xca)](_0xd4300c(0xe8));const _0x5775ef=new form_data_1['default']();_0x5775ef[_0xd4300c(0xea)](_0xd4300c(0xb5),(0x0,fs_1[_0xd4300c(0xb4)])(_0x282365));const _0x410227=await this[_0xd4300c(0x104)][_0xd4300c(0xb0)](veeva_constants_1[_0xd4300c(0xf6)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x5775ef,{'headers':{'Content-Type':_0xd4300c(0xb3)}}),_0x5ef5da=_0x410227[_0xd4300c(0xb1)];if(_0x5ef5da[_0xd4300c(0xee)]===status_enums_1[_0xd4300c(0xb2)][_0xd4300c(0xd9)])return _0x5ef5da['url'];else{if(_0x38e7a9>0x0)return await(0x0,veeva_auth_utils_1[_0xd4300c(0xd1)])(this[_0xd4300c(0x104)]),await this['importVpk'](_0x282365,_0x38e7a9-0x1);throw new veeva_error_1[(_0xd4300c(0xf2))](_0x5ef5da[_0xd4300c(0xfd)]);}}async['deployPackage'](_0x3e1ca9){const _0x3907dc=a404_0x3308c1;this[_0x3907dc(0xdd)][_0x3907dc(0xca)](_0x3907dc(0xfa));const _0x59c461=await this[_0x3907dc(0x104)]['post'](veeva_constants_1['VeevaConstants']['ENDPOINT_DEPLOY_PACKAGE']['replace'](_0x3907dc(0xcc),_0x3e1ca9)),_0x3ca1ae=await _0x59c461[_0x3907dc(0xb1)];if(_0x3ca1ae[_0x3907dc(0xee)]===status_enums_1[_0x3907dc(0xb2)][_0x3907dc(0xd9)])return _0x3ca1ae[_0x3907dc(0xba)];else throw new veeva_error_1[(_0x3907dc(0xf2))](_0x3ca1ae['errors']);}async[a404_0x3308c1(0x108)](_0x1082a6){const _0x23cc7a=a404_0x3308c1;this[_0x23cc7a(0xdd)]['log']('Wait\x20Executing\x20job');const [_0x43469b]=await this[_0x23cc7a(0xe6)]['getJobResult']([_0x1082a6]);return _0x43469b[_0x23cc7a(0xbb)][_0x23cc7a(0xed)](_0x5048b9=>_0x5048b9[_0x23cc7a(0xfe)]===_0x23cc7a(0xb8))['href'];}async[a404_0x3308c1(0xf5)](_0x43c483){const _0x28f599=a404_0x3308c1;this[_0x28f599(0xdd)][_0x28f599(0xca)](_0x28f599(0xc6));const {data:_0x42d6e2}=await this['_connection'][_0x28f599(0xfb)](_0x43c483);if(_0x42d6e2['responseStatus']===status_enums_1[_0x28f599(0xb2)][_0x28f599(0xd9)]){const _0x4b59d=new package_details_dto_1[(_0x28f599(0xcf))](),{log:_0xf68e7a,id:_0x9cbbe9,package_status:_0x3d6694,package_steps:_0x19605e}=_0x42d6e2[_0x28f599(0xc2)],_0x26bd17=_0xf68e7a['filter'](_0x289357=>_0x289357['filename'][_0x28f599(0xf4)](_0x28f599(0xbf))),_0x299a57=await this[_0x28f599(0xbc)](_0x26bd17[0x0][_0x28f599(0xba)]);await this[_0x28f599(0x107)](_0x299a57,'Validation\x20Log'),_0x4b59d[_0x28f599(0xcb)]=_0x9cbbe9,_0x4b59d[_0x28f599(0xbd)]=this[_0x28f599(0xe3)](_0x19605e),await this[_0x28f599(0x10d)](_0x4b59d);if(_0x3d6694!==status_enums_1[_0x28f599(0xaf)][_0x28f599(0xe1)])throw new Error('Package\x20not\x20verified');return _0x4b59d;}else throw new veeva_error_1[(_0x28f599(0xf2))](_0x42d6e2[_0x28f599(0xfd)]);}async[a404_0x3308c1(0xf7)](_0x477a37,_0x2205a4){const _0x71534b=a404_0x3308c1;var _0x5b023d;this['_logger'][_0x71534b(0xca)](_0x71534b(0xd3));const {data:_0x39ed33}=await this[_0x71534b(0x104)]['get'](_0x477a37);if(_0x39ed33[_0x71534b(0xee)]===status_enums_1['VeevaResponseStatus'][_0x71534b(0xd9)]){const {responseDetails:{deployment_log:_0x1f7db5,package_status__v:_0x548e48},package_steps:_0x53c204}=_0x39ed33,_0x1837e5=_0x1f7db5[_0x71534b(0xbe)](_0x5b9625=>_0x5b9625['filename'][_0x71534b(0xf4)](_0x71534b(0xe4))),_0xc49247=await this['getLogResultText'](_0x1837e5[0x0][_0x71534b(0xba)]);await this[_0x71534b(0x107)](_0xc49247,'Deploy\x20Log'),_0x2205a4[_0x71534b(0xc3)]=[status_enums_1[_0x71534b(0xaf)][_0x71534b(0xd2)],status_enums_1[_0x71534b(0xaf)][_0x71534b(0xe5)]]['includes'](_0x548e48);const _0xda33ec=array_utils_1[_0x71534b(0xf9)][_0x71534b(0xc1)](this[_0x71534b(0xe3)](_0x53c204),({uniqueName:_0x32e3d9})=>_0x32e3d9);for(const _0x398c6c of _0x2205a4[_0x71534b(0xbd)]){const _0x419764=(_0x5b023d=_0xda33ec[_0x71534b(0xfb)](_0x398c6c[_0x71534b(0xce)]))===null||_0x5b023d===void 0x0?void 0x0:_0x5b023d[_0x71534b(0x10c)];_0x419764&&(_0x398c6c[_0x71534b(0x10c)]=_0x419764);}_0x2205a4[_0x71534b(0xbd)]=_0x2205a4[_0x71534b(0xbd)][_0x71534b(0xbe)](_0x3a6060=>_0x3a6060[_0x71534b(0x10c)]!==status_enums_1['PackageComponentStatus'][_0x71534b(0xe1)]);if(!_0x2205a4[_0x71534b(0xbd)][_0x71534b(0xef)])throw new Error(_0x71534b(0xec));return _0x2205a4;}else throw new veeva_error_1['VeevaError'](_0x39ed33[_0x71534b(0xfd)]);}async[a404_0x3308c1(0xbc)](_0x4b67e0){const _0x1b3b28=a404_0x3308c1,{data:_0xd4f063}=await this['_connection'][_0x1b3b28(0xfb)](_0x4b67e0,{'responseType':_0x1b3b28(0xcd)});return _0xd4f063;}[a404_0x3308c1(0xe3)](_0x3affc8){const _0x4a9e2d=a404_0x3308c1;return _0x3affc8[_0x4a9e2d(0xe7)]((_0x2a54c1,_0x3533a1)=>{const _0x4fc8b5=_0x4a9e2d,_0x387610=_0x3533a1[_0x4fc8b5(0xe2)][_0x4fc8b5(0xfc)](_0x489ff8=>new package_component_dto_1[(_0x4fc8b5(0xd0))]({'status':_0x3533a1[_0x4fc8b5(0xdb)],'stepName':_0x3533a1[_0x4fc8b5(0xd8)],'component':_0x489ff8}));return[..._0x2a54c1,..._0x387610];},[]);}async[a404_0x3308c1(0x10d)](_0x593192){const _0x18a24d=a404_0x3308c1,{data:_0x490e44}=await this[_0x18a24d(0x104)][_0x18a24d(0xf3)](veeva_constants_1[_0x18a24d(0xf6)]['ENDPOINT_VALIDATE_PACKAGE'][_0x18a24d(0xff)](_0x18a24d(0xcc),_0x593192[_0x18a24d(0xcb)]));if(_0x490e44[_0x18a24d(0xee)]===status_enums_1[_0x18a24d(0xb2)][_0x18a24d(0xd9)]){const {package_steps:_0xa6cd30}=_0x490e44[_0x18a24d(0xe0)],_0x311d36=array_utils_1['ArrayUtils']['groupToMap'](_0x593192[_0x18a24d(0xbd)],({stepName:_0x4f2f05})=>_0x4f2f05);for(const {name__v:_0x59b0d5,deployment_action:_0x2a3907}of _0xa6cd30){for(const _0x1433ab of _0x311d36[_0x18a24d(0xfb)](_0x59b0d5)||[]){_0x1433ab[_0x18a24d(0xf0)]=package_component_dto_1[_0x18a24d(0xd0)][_0x18a24d(0x10a)](_0x2a3907);}}}else throw new veeva_error_1[(_0x18a24d(0xf2))](_0x490e44['errors']);}async[a404_0x3308c1(0x10b)](_0x4ee761){const _0x2a4bd1=a404_0x3308c1,_0x4e79e9=await this['importVpk'](_0x4ee761),_0x25804c=await this['getJobDetailUrl'](_0x4e79e9),_0xf1969c=await this[_0x2a4bd1(0xf5)](_0x25804c),_0x4e0d85=await this['deployPackage'](_0xf1969c[_0x2a4bd1(0xcb)]),_0x2c21f3=await this['getJobDetailUrl'](_0x4e0d85);return this[_0x2a4bd1(0xf7)](_0x2c21f3,_0xf1969c);}}exports[a404_0x3308c1(0x102)]=PackageImportService;