const a404_0x5f1761=a404_0x4229;(function(_0x4260a6,_0x5cf60d){const _0x5bd1dc=a404_0x4229,_0x188021=_0x4260a6();while(!![]){try{const _0x3e2bea=parseInt(_0x5bd1dc(0x1c1))/0x1*(parseInt(_0x5bd1dc(0x18a))/0x2)+-parseInt(_0x5bd1dc(0x1a6))/0x3*(parseInt(_0x5bd1dc(0x1d2))/0x4)+-parseInt(_0x5bd1dc(0x1de))/0x5+-parseInt(_0x5bd1dc(0x1d6))/0x6*(-parseInt(_0x5bd1dc(0x1ad))/0x7)+parseInt(_0x5bd1dc(0x1b6))/0x8*(parseInt(_0x5bd1dc(0x1aa))/0x9)+-parseInt(_0x5bd1dc(0x1a1))/0xa*(-parseInt(_0x5bd1dc(0x1e3))/0xb)+parseInt(_0x5bd1dc(0x1a5))/0xc;if(_0x3e2bea===_0x5cf60d)break;else _0x188021['push'](_0x188021['shift']());}catch(_0x397763){_0x188021['push'](_0x188021['shift']());}}}(a404_0x2fe1,0x78956));const a404_0x3a62b5=(function(){let _0x1c911c=!![];return function(_0x36375e,_0x35682e){const _0x1cb6af=_0x1c911c?function(){if(_0x35682e){const _0x4a5534=_0x35682e['apply'](_0x36375e,arguments);return _0x35682e=null,_0x4a5534;}}:function(){};return _0x1c911c=![],_0x1cb6af;};}()),a404_0x40f27b=a404_0x3a62b5(this,function(){const _0x1b5a9f=a404_0x4229;return a404_0x40f27b[_0x1b5a9f(0x1cd)]()[_0x1b5a9f(0x1bd)](_0x1b5a9f(0x197))[_0x1b5a9f(0x1cd)]()[_0x1b5a9f(0x196)](a404_0x40f27b)[_0x1b5a9f(0x1bd)]('(((.+)+)+)+$');});function a404_0x4229(_0x2564aa,_0x4df676){const _0xe84e49=a404_0x2fe1();return a404_0x4229=function(_0x40f27b,_0x3a62b5){_0x40f27b=_0x40f27b-0x189;let _0x2fe151=_0xe84e49[_0x40f27b];return _0x2fe151;},a404_0x4229(_0x2564aa,_0x4df676);}a404_0x40f27b();function a404_0x2fe1(){const _0x18801b=['PackageDetailsDto','data','endsWith','search','../utils/array.utils','PackageImportService','createReadStream','34PNAxJB','Validation\x20Log','text','PackageComponentDto','packageId','../classes/errors/veeva-error','fillPackageDeploymentAction','__importDefault','packageComponentList','DEPLOYED','errors','filter','toString','Deployment.log','default','../dtos/package-details.dto','getJobDetailUrl','2779204GJcyFA','map','ENDPOINT_EXPORT_IMPORT_PACKAGE','status','6kbRRay','SUCCESS','Get\x20deploy\x20result','importVpk','getValidationDetailsAndSaveLog','VeevaConstants','file','../enums/status.enums','2421070ttTLNl','PackageComponentStatus','isDeployed','includes','DEPLOYED_WITH_WARNINGS','33GhbMtY','groupUniqueToMap','responseStatus','7816PbfpXf','../constants/veeva.constants','rel','ENDPOINT_VALIDATE_PACKAGE','multipart/form-data','../utils/veeva-auth.utils','VeevaError','deploymentAction','_logger','reduce','_veevaService','post','constructor','(((.+)+)+)+$','_connection','ArrayUtils','updateVeevaConnection','artifacts','groupToMap','Deploy\x20package','VeevaPackageStatus','put','../dtos/package-component.dto','1271630vZvmfv','getLogResultText','Wait\x20Executing\x20job','replace','12428064qvRyRh','3sxiUli','_saveLog','{package_id}','deployment_status__v','4203SSFyFS','get','Import\x20package','20111WKtMrO','append','VeevaResponseStatus','VERIFIED','__esModule','log','url','uniqueName','getDeployDetailsAndSaveLog','2056GIToVt','Validation.log','formPackageComponentList','Cannot\x20find\x20deployment\x20results'];a404_0x2fe1=function(){return _0x18801b;};return a404_0x2fe1();}'use strict';var __importDefault=this&&this[a404_0x5f1761(0x1c8)]||function(_0x31afb4){const _0x42a403=a404_0x5f1761;return _0x31afb4&&_0x31afb4[_0x42a403(0x1b1)]?_0x31afb4:{'default':_0x31afb4};};Object['defineProperty'](exports,a404_0x5f1761(0x1b1),{'value':!![]}),exports[a404_0x5f1761(0x1bf)]=void 0x0;const veeva_constants_1=require(a404_0x5f1761(0x18b)),status_enums_1=require(a404_0x5f1761(0x1dd)),veeva_error_1=require(a404_0x5f1761(0x1c6)),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),veeva_auth_utils_1=require(a404_0x5f1761(0x18f)),package_details_dto_1=require(a404_0x5f1761(0x1d0)),package_component_dto_1=require(a404_0x5f1761(0x1a0)),array_utils_1=require(a404_0x5f1761(0x1be));class PackageImportService{constructor({veevaService:_0x359ff7,connection:_0x33f7a5,logger:_0x515be9,saveLog:_0x49b303}){const _0x143a32=a404_0x5f1761;this[_0x143a32(0x194)]=_0x359ff7,this[_0x143a32(0x198)]=_0x33f7a5,this[_0x143a32(0x192)]=_0x515be9,this[_0x143a32(0x1a7)]=_0x49b303;}async[a404_0x5f1761(0x1d9)](_0x1b98d4,_0x4d15fc=0x1){const _0x420fec=a404_0x5f1761;this[_0x420fec(0x192)][_0x420fec(0x1b2)](_0x420fec(0x1ac));const _0x7d128f=new form_data_1[(_0x420fec(0x1cf))]();_0x7d128f[_0x420fec(0x1ae)](_0x420fec(0x1dc),(0x0,fs_1[_0x420fec(0x1c0)])(_0x1b98d4));const _0x5551ea=await this['_connection'][_0x420fec(0x19f)](veeva_constants_1[_0x420fec(0x1db)][_0x420fec(0x1d4)],_0x7d128f,{'headers':{'Content-Type':_0x420fec(0x18e)}}),_0x293535=_0x5551ea[_0x420fec(0x1bb)];if(_0x293535[_0x420fec(0x189)]===status_enums_1['VeevaResponseStatus'][_0x420fec(0x1d7)])return _0x293535[_0x420fec(0x1b3)];else{if(_0x4d15fc>0x0)return await(0x0,veeva_auth_utils_1[_0x420fec(0x19a)])(this[_0x420fec(0x198)]),await this[_0x420fec(0x1d9)](_0x1b98d4,_0x4d15fc-0x1);throw new veeva_error_1[(_0x420fec(0x190))](_0x293535[_0x420fec(0x1cb)]);}}async['deployPackage'](_0x1f0151){const _0x4842f6=a404_0x5f1761;this[_0x4842f6(0x192)][_0x4842f6(0x1b2)](_0x4842f6(0x19d));const _0x40ca4f=await this[_0x4842f6(0x198)][_0x4842f6(0x195)](veeva_constants_1[_0x4842f6(0x1db)]['ENDPOINT_DEPLOY_PACKAGE'][_0x4842f6(0x1a4)]('{package_id}',_0x1f0151)),_0x4e32e2=await _0x40ca4f['data'];if(_0x4e32e2[_0x4842f6(0x189)]===status_enums_1[_0x4842f6(0x1af)][_0x4842f6(0x1d7)])return _0x4e32e2[_0x4842f6(0x1b3)];else throw new veeva_error_1[(_0x4842f6(0x190))](_0x4e32e2['errors']);}async[a404_0x5f1761(0x1d1)](_0x1e8069){const _0x345a61=a404_0x5f1761;this[_0x345a61(0x192)][_0x345a61(0x1b2)](_0x345a61(0x1a3));const [_0x4def7f]=await this[_0x345a61(0x194)]['getJobResult']([_0x1e8069]);return _0x4def7f['links']['find'](_0x2041e5=>_0x2041e5[_0x345a61(0x18c)]===_0x345a61(0x19b))['href'];}async['getValidationDetailsAndSaveLog'](_0x214fc3){const _0x2b418a=a404_0x5f1761;this['_logger'][_0x2b418a(0x1b2)]('Get\x20validation\x20details.');const {data:_0x4889a9}=await this[_0x2b418a(0x198)][_0x2b418a(0x1ab)](_0x214fc3);if(_0x4889a9['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x2b418a(0x1d7)]){const _0x2ba6ec=new package_details_dto_1[(_0x2b418a(0x1ba))](),{log:_0x2fae83,id:_0xe10231,package_status:_0x513cdf,package_steps:_0x37ff74}=_0x4889a9['vaultPackage'],_0x423cab=_0x2fae83[_0x2b418a(0x1cc)](_0x15dfe0=>_0x15dfe0['filename']['endsWith'](_0x2b418a(0x1b7))),_0x42c2a=await this[_0x2b418a(0x1a2)](_0x423cab[0x0]['url']);await this[_0x2b418a(0x1a7)](_0x42c2a,_0x2b418a(0x1c2)),_0x2ba6ec['packageId']=_0xe10231,_0x2ba6ec[_0x2b418a(0x1c9)]=this[_0x2b418a(0x1b8)](_0x37ff74),await this['fillPackageDeploymentAction'](_0x2ba6ec);if(_0x513cdf!==status_enums_1['VeevaPackageStatus']['VERIFIED'])throw new Error('Package\x20not\x20verified');return _0x2ba6ec;}else throw new veeva_error_1[(_0x2b418a(0x190))](_0x4889a9[_0x2b418a(0x1cb)]);}async[a404_0x5f1761(0x1b5)](_0xfda7a7,_0x4688c8){const _0x550cfe=a404_0x5f1761;var _0x3a7be4;this[_0x550cfe(0x192)]['log'](_0x550cfe(0x1d8));const {data:_0x51068e}=await this[_0x550cfe(0x198)][_0x550cfe(0x1ab)](_0xfda7a7);if(_0x51068e['responseStatus']===status_enums_1[_0x550cfe(0x1af)]['SUCCESS']){const {responseDetails:{deployment_log:_0x15f0ea,package_status__v:_0x259f56},package_steps:_0x494ddb}=_0x51068e,_0x5c0b9f=_0x15f0ea[_0x550cfe(0x1cc)](_0x2017cd=>_0x2017cd['filename'][_0x550cfe(0x1bc)](_0x550cfe(0x1ce))),_0x17dc61=await this[_0x550cfe(0x1a2)](_0x5c0b9f[0x0][_0x550cfe(0x1b3)]);await this[_0x550cfe(0x1a7)](_0x17dc61,'Deploy\x20Log'),_0x4688c8[_0x550cfe(0x1e0)]=[status_enums_1[_0x550cfe(0x19e)][_0x550cfe(0x1ca)],status_enums_1[_0x550cfe(0x19e)][_0x550cfe(0x1e2)]][_0x550cfe(0x1e1)](_0x259f56);const _0x2ac4bb=array_utils_1[_0x550cfe(0x199)][_0x550cfe(0x1e4)](this[_0x550cfe(0x1b8)](_0x494ddb),({uniqueName:_0x2e1fff})=>_0x2e1fff);for(const _0x147f54 of _0x4688c8[_0x550cfe(0x1c9)]){const _0x451907=(_0x3a7be4=_0x2ac4bb[_0x550cfe(0x1ab)](_0x147f54[_0x550cfe(0x1b4)]))===null||_0x3a7be4===void 0x0?void 0x0:_0x3a7be4[_0x550cfe(0x1d5)];_0x451907&&(_0x147f54[_0x550cfe(0x1d5)]=_0x451907);}_0x4688c8[_0x550cfe(0x1c9)]=_0x4688c8['packageComponentList'][_0x550cfe(0x1cc)](_0x100f06=>_0x100f06['status']!==status_enums_1[_0x550cfe(0x1df)][_0x550cfe(0x1b0)]);if(!_0x4688c8[_0x550cfe(0x1c9)]['length'])throw new Error(_0x550cfe(0x1b9));return _0x4688c8;}else throw new veeva_error_1[(_0x550cfe(0x190))](_0x51068e['errors']);}async[a404_0x5f1761(0x1a2)](_0x2ecb68){const _0x7a17eb=a404_0x5f1761,{data:_0x2579b2}=await this[_0x7a17eb(0x198)][_0x7a17eb(0x1ab)](_0x2ecb68,{'responseType':_0x7a17eb(0x1c3)});return _0x2579b2;}['formPackageComponentList'](_0x55d8b9){const _0x1487bf=a404_0x5f1761;return _0x55d8b9[_0x1487bf(0x193)]((_0xe3cb38,_0x47a442)=>{const _0x58a476=_0x1487bf,_0x248615=_0x47a442['package_components'][_0x58a476(0x1d3)](_0x5208fd=>new package_component_dto_1[(_0x58a476(0x1c4))]({'status':_0x47a442[_0x58a476(0x1a9)],'stepName':_0x47a442['name__v'],'component':_0x5208fd}));return[..._0xe3cb38,..._0x248615];},[]);}async[a404_0x5f1761(0x1c7)](_0x3aad59){const _0x24e272=a404_0x5f1761,{data:_0x139331}=await this[_0x24e272(0x198)][_0x24e272(0x195)](veeva_constants_1[_0x24e272(0x1db)][_0x24e272(0x18d)][_0x24e272(0x1a4)](_0x24e272(0x1a8),_0x3aad59[_0x24e272(0x1c5)]));if(_0x139331[_0x24e272(0x189)]===status_enums_1[_0x24e272(0x1af)][_0x24e272(0x1d7)]){const {package_steps:_0x6e2ecf}=_0x139331['responseDetails'],_0x1c83ca=array_utils_1[_0x24e272(0x199)][_0x24e272(0x19c)](_0x3aad59[_0x24e272(0x1c9)],({stepName:_0x1d3809})=>_0x1d3809);for(const {name__v:_0x4d4509,deployment_action:_0x1ae4fe}of _0x6e2ecf){for(const _0x141f96 of _0x1c83ca[_0x24e272(0x1ab)](_0x4d4509)||[]){_0x141f96[_0x24e272(0x191)]=package_component_dto_1[_0x24e272(0x1c4)]['convertDeploymentAction'](_0x1ae4fe);}}}else throw new veeva_error_1[(_0x24e272(0x190))](_0x139331[_0x24e272(0x1cb)]);}async['import'](_0x53b978){const _0xdd71c6=a404_0x5f1761,_0x978d65=await this[_0xdd71c6(0x1d9)](_0x53b978),_0x216156=await this[_0xdd71c6(0x1d1)](_0x978d65),_0x56315d=await this[_0xdd71c6(0x1da)](_0x216156),_0x25fa76=await this['deployPackage'](_0x56315d['packageId']),_0x1c8623=await this[_0xdd71c6(0x1d1)](_0x25fa76);return this['getDeployDetailsAndSaveLog'](_0x1c8623,_0x56315d);}}exports[a404_0x5f1761(0x1bf)]=PackageImportService;