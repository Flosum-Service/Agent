const a391_0x44d410=a391_0x16b1;(function(_0x44128f,_0x4f0267){const _0x11e95e=a391_0x16b1,_0x12b8e4=_0x44128f();while(!![]){try{const _0x318d3f=parseInt(_0x11e95e(0x15f))/0x1*(parseInt(_0x11e95e(0x17b))/0x2)+parseInt(_0x11e95e(0x166))/0x3*(parseInt(_0x11e95e(0x18b))/0x4)+parseInt(_0x11e95e(0x142))/0x5+-parseInt(_0x11e95e(0x139))/0x6+parseInt(_0x11e95e(0x161))/0x7+-parseInt(_0x11e95e(0x193))/0x8*(-parseInt(_0x11e95e(0x18e))/0x9)+-parseInt(_0x11e95e(0x187))/0xa*(parseInt(_0x11e95e(0x198))/0xb);if(_0x318d3f===_0x4f0267)break;else _0x12b8e4['push'](_0x12b8e4['shift']());}catch(_0xf60047){_0x12b8e4['push'](_0x12b8e4['shift']());}}}(a391_0x4d21,0xbd7cc));const a391_0x21a087=(function(){let _0x4f2f35=!![];return function(_0x202b42,_0x141cae){const _0x1c6910=_0x4f2f35?function(){const _0x5efa78=a391_0x16b1;if(_0x141cae){const _0x3ee47a=_0x141cae[_0x5efa78(0x141)](_0x202b42,arguments);return _0x141cae=null,_0x3ee47a;}}:function(){};return _0x4f2f35=![],_0x1c6910;};}()),a391_0x472d9e=a391_0x21a087(this,function(){const _0x2c3ed6=a391_0x16b1;return a391_0x472d9e[_0x2c3ed6(0x181)]()['search']('(((.+)+)+)+$')[_0x2c3ed6(0x181)]()[_0x2c3ed6(0x14a)](a391_0x472d9e)[_0x2c3ed6(0x13e)](_0x2c3ed6(0x13f));});function a391_0x4d21(){const _0xc279f5=['get','endsWith','uniqueName','../enums/status.enums','deploymentAction','VeevaPackageStatus','__esModule','links','name__v','formPackageComponentList','{package_id}','_logger','text','default','groupUniqueToMap','SUCCESS','Import\x20package','filter','Validation\x20Log','4TFTsFD','_saveLog','10718036TXbroA','Deploy\x20package','filename','DEPLOYED','replace','5946yhYBwF','find','importVpk','deployPackage','Wait\x20Executing\x20job','getJobDetailUrl','getDeployDetailsAndSaveLog','url','isDeployed','append','PackageImportService','../utils/array.utils','includes','errors','status','_connection','VERIFIED','defineProperty','Get\x20validation\x20details.','DEPLOYED_WITH_WARNINGS','artifacts','71578jfYGYN','href','_veevaService','data','getValidationDetailsAndSaveLog','responseStatus','toString','../constants/veeva.constants','Deployment.log','log','packageId','file','14660dUMwRv','responseDetails','import','VeevaConstants','1916bmfPOR','ArrayUtils','VeevaResponseStatus','9HQvXml','getLogResultText','reduce','post','../classes/errors/veeva-error','4763768VfVGBO','__importDefault','../utils/veeva-auth.utils','ENDPOINT_DEPLOY_PACKAGE','../dtos/package-details.dto','24739DOCshn','Package\x20not\x20verified','3580554jkOzWQ','packageComponentList','createReadStream','ENDPOINT_VALIDATE_PACKAGE','put','search','(((.+)+)+)+$','PackageComponentStatus','apply','7253900ZDaYNN','groupToMap','fillPackageDeploymentAction','VeevaError','form-data','rel','updateVeevaConnection','PackageComponentDto','constructor','Cannot\x20find\x20deployment\x20results'];a391_0x4d21=function(){return _0xc279f5;};return a391_0x4d21();}a391_0x472d9e();'use strict';var __importDefault=this&&this[a391_0x44d410(0x194)]||function(_0x924196){const _0x3eb8ce=a391_0x44d410;return _0x924196&&_0x924196[_0x3eb8ce(0x152)]?_0x924196:{'default':_0x924196};};function a391_0x16b1(_0x4ab92d,_0x339e71){const _0x15e2e4=a391_0x4d21();return a391_0x16b1=function(_0x472d9e,_0x21a087){_0x472d9e=_0x472d9e-0x138;let _0x4d21b4=_0x15e2e4[_0x472d9e];return _0x4d21b4;},a391_0x16b1(_0x4ab92d,_0x339e71);}Object[a391_0x44d410(0x177)](exports,a391_0x44d410(0x152),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require(a391_0x44d410(0x182)),status_enums_1=require(a391_0x44d410(0x14f)),veeva_error_1=require(a391_0x44d410(0x192)),form_data_1=__importDefault(require(a391_0x44d410(0x146))),fs_1=require('fs'),veeva_auth_utils_1=require(a391_0x44d410(0x195)),package_details_dto_1=require(a391_0x44d410(0x197)),package_component_dto_1=require('../dtos/package-component.dto'),array_utils_1=require(a391_0x44d410(0x171));class PackageImportService{constructor({veevaService:_0x4ae3f1,connection:_0x1e6f9d,logger:_0x35038f,saveLog:_0x522eb0}){const _0x2b8a24=a391_0x44d410;this[_0x2b8a24(0x17d)]=_0x4ae3f1,this[_0x2b8a24(0x175)]=_0x1e6f9d,this[_0x2b8a24(0x157)]=_0x35038f,this[_0x2b8a24(0x160)]=_0x522eb0;}async['importVpk'](_0x434e81,_0x535770=0x1){const _0x29a0e6=a391_0x44d410;this[_0x29a0e6(0x157)][_0x29a0e6(0x184)](_0x29a0e6(0x15c));const _0xb5a4a5=new form_data_1[(_0x29a0e6(0x159))]();_0xb5a4a5[_0x29a0e6(0x16f)](_0x29a0e6(0x186),(0x0,fs_1[_0x29a0e6(0x13b)])(_0x434e81));const _0x580633=await this['_connection'][_0x29a0e6(0x13d)](veeva_constants_1[_0x29a0e6(0x18a)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0xb5a4a5,{'headers':{'Content-Type':'multipart/form-data'}}),_0xe6a7e=_0x580633[_0x29a0e6(0x17e)];if(_0xe6a7e['responseStatus']===status_enums_1[_0x29a0e6(0x18d)][_0x29a0e6(0x15b)])return _0xe6a7e[_0x29a0e6(0x16d)];else{if(_0x535770>0x0)return await(0x0,veeva_auth_utils_1[_0x29a0e6(0x148)])(this[_0x29a0e6(0x175)]),await this[_0x29a0e6(0x168)](_0x434e81,_0x535770-0x1);throw new veeva_error_1[(_0x29a0e6(0x145))](_0xe6a7e['errors']);}}async[a391_0x44d410(0x169)](_0x2c4f9d){const _0x3fe89f=a391_0x44d410;this[_0x3fe89f(0x157)][_0x3fe89f(0x184)](_0x3fe89f(0x162));const _0x34dd67=await this[_0x3fe89f(0x175)][_0x3fe89f(0x191)](veeva_constants_1[_0x3fe89f(0x18a)][_0x3fe89f(0x196)]['replace'](_0x3fe89f(0x156),_0x2c4f9d)),_0x54810a=await _0x34dd67[_0x3fe89f(0x17e)];if(_0x54810a[_0x3fe89f(0x180)]===status_enums_1[_0x3fe89f(0x18d)]['SUCCESS'])return _0x54810a[_0x3fe89f(0x16d)];else throw new veeva_error_1[(_0x3fe89f(0x145))](_0x54810a[_0x3fe89f(0x173)]);}async[a391_0x44d410(0x16b)](_0x25eb8f){const _0x54e938=a391_0x44d410;this['_logger'][_0x54e938(0x184)](_0x54e938(0x16a));const [_0x1c7c4c]=await this['_veevaService']['getJobResult']([_0x25eb8f]);return _0x1c7c4c[_0x54e938(0x153)][_0x54e938(0x167)](_0x2452d8=>_0x2452d8[_0x54e938(0x147)]===_0x54e938(0x17a))[_0x54e938(0x17c)];}async['getValidationDetailsAndSaveLog'](_0x439307){const _0x3536cd=a391_0x44d410;this[_0x3536cd(0x157)][_0x3536cd(0x184)](_0x3536cd(0x178));const {data:_0x40c112}=await this['_connection'][_0x3536cd(0x14c)](_0x439307);if(_0x40c112[_0x3536cd(0x180)]===status_enums_1['VeevaResponseStatus'][_0x3536cd(0x15b)]){const _0x10e0c2=new package_details_dto_1['PackageDetailsDto'](),{log:_0x1de296,id:_0x4b1264,package_status:_0x25230a,package_steps:_0x386736}=_0x40c112['vaultPackage'],_0x4a5440=_0x1de296['filter'](_0x1b5bbb=>_0x1b5bbb[_0x3536cd(0x163)][_0x3536cd(0x14d)]('Validation.log')),_0x9d7917=await this[_0x3536cd(0x18f)](_0x4a5440[0x0][_0x3536cd(0x16d)]);await this[_0x3536cd(0x160)](_0x9d7917,_0x3536cd(0x15e)),_0x10e0c2[_0x3536cd(0x185)]=_0x4b1264,_0x10e0c2[_0x3536cd(0x13a)]=this[_0x3536cd(0x155)](_0x386736),await this[_0x3536cd(0x144)](_0x10e0c2);if(_0x25230a!==status_enums_1[_0x3536cd(0x151)][_0x3536cd(0x176)])throw new Error(_0x3536cd(0x138));return _0x10e0c2;}else throw new veeva_error_1[(_0x3536cd(0x145))](_0x40c112[_0x3536cd(0x173)]);}async[a391_0x44d410(0x16c)](_0x4c815c,_0x3df376){const _0xa966b2=a391_0x44d410;var _0x397034;this[_0xa966b2(0x157)][_0xa966b2(0x184)]('Get\x20deploy\x20result');const {data:_0x3a0ed3}=await this[_0xa966b2(0x175)][_0xa966b2(0x14c)](_0x4c815c);if(_0x3a0ed3[_0xa966b2(0x180)]===status_enums_1[_0xa966b2(0x18d)][_0xa966b2(0x15b)]){const {responseDetails:{deployment_log:_0x28acf0,package_status__v:_0x395a39},package_steps:_0x5b7faa}=_0x3a0ed3,_0x48ab87=_0x28acf0['filter'](_0x27ca01=>_0x27ca01[_0xa966b2(0x163)][_0xa966b2(0x14d)](_0xa966b2(0x183))),_0x3028d1=await this[_0xa966b2(0x18f)](_0x48ab87[0x0][_0xa966b2(0x16d)]);await this['_saveLog'](_0x3028d1,'Deploy\x20Log'),_0x3df376[_0xa966b2(0x16e)]=[status_enums_1[_0xa966b2(0x151)][_0xa966b2(0x164)],status_enums_1[_0xa966b2(0x151)][_0xa966b2(0x179)]][_0xa966b2(0x172)](_0x395a39);const _0x21944f=array_utils_1['ArrayUtils'][_0xa966b2(0x15a)](this['formPackageComponentList'](_0x5b7faa),({uniqueName:_0x536bc7})=>_0x536bc7);for(const _0x23f829 of _0x3df376['packageComponentList']){const _0x52f21d=(_0x397034=_0x21944f[_0xa966b2(0x14c)](_0x23f829[_0xa966b2(0x14e)]))===null||_0x397034===void 0x0?void 0x0:_0x397034[_0xa966b2(0x174)];_0x52f21d&&(_0x23f829['status']=_0x52f21d);}_0x3df376[_0xa966b2(0x13a)]=_0x3df376['packageComponentList'][_0xa966b2(0x15d)](_0x8b9b70=>_0x8b9b70[_0xa966b2(0x174)]!==status_enums_1[_0xa966b2(0x140)][_0xa966b2(0x176)]);if(!_0x3df376[_0xa966b2(0x13a)]['length'])throw new Error(_0xa966b2(0x14b));return _0x3df376;}else throw new veeva_error_1[(_0xa966b2(0x145))](_0x3a0ed3[_0xa966b2(0x173)]);}async[a391_0x44d410(0x18f)](_0x4895ee){const _0x16f0e3=a391_0x44d410,{data:_0x29fef8}=await this[_0x16f0e3(0x175)][_0x16f0e3(0x14c)](_0x4895ee,{'responseType':_0x16f0e3(0x158)});return _0x29fef8;}['formPackageComponentList'](_0x3c7635){const _0x5b0fdd=a391_0x44d410;return _0x3c7635[_0x5b0fdd(0x190)]((_0x23cf5a,_0x3e5d0e)=>{const _0x49912a=_0x5b0fdd,_0x11cde8=_0x3e5d0e['package_components']['map'](_0x4f43f4=>new package_component_dto_1[(_0x49912a(0x149))]({'status':_0x3e5d0e['deployment_status__v'],'stepName':_0x3e5d0e[_0x49912a(0x154)],'component':_0x4f43f4}));return[..._0x23cf5a,..._0x11cde8];},[]);}async['fillPackageDeploymentAction'](_0x4b6c6d){const _0x43bd5e=a391_0x44d410,{data:_0xfbbb20}=await this[_0x43bd5e(0x175)][_0x43bd5e(0x191)](veeva_constants_1['VeevaConstants'][_0x43bd5e(0x13c)][_0x43bd5e(0x165)](_0x43bd5e(0x156),_0x4b6c6d[_0x43bd5e(0x185)]));if(_0xfbbb20[_0x43bd5e(0x180)]===status_enums_1[_0x43bd5e(0x18d)]['SUCCESS']){const {package_steps:_0x164c92}=_0xfbbb20[_0x43bd5e(0x188)],_0x3f4742=array_utils_1[_0x43bd5e(0x18c)][_0x43bd5e(0x143)](_0x4b6c6d[_0x43bd5e(0x13a)],({stepName:_0x416d38})=>_0x416d38);for(const {name__v:_0x4dfb89,deployment_action:_0x599bef}of _0x164c92){for(const _0x18f99a of _0x3f4742[_0x43bd5e(0x14c)](_0x4dfb89)||[]){_0x18f99a[_0x43bd5e(0x150)]=package_component_dto_1[_0x43bd5e(0x149)]['convertDeploymentAction'](_0x599bef);}}}else throw new veeva_error_1[(_0x43bd5e(0x145))](_0xfbbb20[_0x43bd5e(0x173)]);}async[a391_0x44d410(0x189)](_0x4f7969){const _0x4969f4=a391_0x44d410,_0x19050c=await this[_0x4969f4(0x168)](_0x4f7969),_0x1a7e73=await this[_0x4969f4(0x16b)](_0x19050c),_0x4917bc=await this[_0x4969f4(0x17f)](_0x1a7e73),_0x1077a0=await this['deployPackage'](_0x4917bc[_0x4969f4(0x185)]),_0x5ba9d0=await this[_0x4969f4(0x16b)](_0x1077a0);return this[_0x4969f4(0x16c)](_0x5ba9d0,_0x4917bc);}}exports[a391_0x44d410(0x170)]=PackageImportService;