const a352_0x57fcef=a352_0x4d54;(function(_0x2e680d,_0x463bb2){const _0x1a488c=a352_0x4d54,_0x62e311=_0x2e680d();while(!![]){try{const _0xe15674=-parseInt(_0x1a488c(0xd2))/0x1*(parseInt(_0x1a488c(0xd8))/0x2)+parseInt(_0x1a488c(0xf5))/0x3*(parseInt(_0x1a488c(0xd9))/0x4)+-parseInt(_0x1a488c(0xb9))/0x5*(parseInt(_0x1a488c(0x105))/0x6)+parseInt(_0x1a488c(0xff))/0x7*(-parseInt(_0x1a488c(0xee))/0x8)+parseInt(_0x1a488c(0xd4))/0x9+parseInt(_0x1a488c(0x108))/0xa+parseInt(_0x1a488c(0xf0))/0xb*(parseInt(_0x1a488c(0x103))/0xc);if(_0xe15674===_0x463bb2)break;else _0x62e311['push'](_0x62e311['shift']());}catch(_0x5c0e54){_0x62e311['push'](_0x62e311['shift']());}}}(a352_0x18e4,0x64753));const a352_0x124933=(function(){let _0x27cb26=!![];return function(_0x2bc663,_0x2b6ddf){const _0x28b778=_0x27cb26?function(){const _0x2d5b90=a352_0x4d54;if(_0x2b6ddf){const _0x25e716=_0x2b6ddf[_0x2d5b90(0xfe)](_0x2bc663,arguments);return _0x2b6ddf=null,_0x25e716;}}:function(){};return _0x27cb26=![],_0x28b778;};}()),a352_0xeb916=a352_0x124933(this,function(){const _0x380122=a352_0x4d54;return a352_0xeb916[_0x380122(0x104)]()[_0x380122(0x116)](_0x380122(0xf3))['toString']()['constructor'](a352_0xeb916)['search'](_0x380122(0xf3));});a352_0xeb916();'use strict';var __importDefault=this&&this[a352_0x57fcef(0xb7)]||function(_0x5c511a){const _0x238aad=a352_0x57fcef;return _0x5c511a&&_0x5c511a[_0x238aad(0x10c)]?_0x5c511a:{'default':_0x5c511a};};function a352_0x4d54(_0x3f8cb7,_0x40574f){const _0x457594=a352_0x18e4();return a352_0x4d54=function(_0xeb916,_0x124933){_0xeb916=_0xeb916-0xb5;let _0x18e4f5=_0x457594[_0xeb916];return _0x18e4f5;},a352_0x4d54(_0x3f8cb7,_0x40574f);}Object['defineProperty'](exports,a352_0x57fcef(0x10c),{'value':!![]}),exports[a352_0x57fcef(0xdb)]=void 0x0;const veeva_constants_1=require(a352_0x57fcef(0xe4)),status_enums_1=require(a352_0x57fcef(0xfc)),veeva_error_1=require(a352_0x57fcef(0xcb)),form_data_1=__importDefault(require(a352_0x57fcef(0xf8))),fs_1=require('fs'),veeva_auth_utils_1=require(a352_0x57fcef(0xf1)),package_details_dto_1=require(a352_0x57fcef(0x10e)),package_component_dto_1=require(a352_0x57fcef(0xe7)),array_utils_1=require(a352_0x57fcef(0xd0));class PackageImportService{constructor({veevaService:_0x280b0e,connection:_0x949d9c,logger:_0x5d7a98,saveLog:_0x2dbe9e}){const _0x17ac31=a352_0x57fcef;this[_0x17ac31(0xbc)]=_0x280b0e,this[_0x17ac31(0xf9)]=_0x949d9c,this[_0x17ac31(0xc8)]=_0x5d7a98,this['_saveLog']=_0x2dbe9e;}async[a352_0x57fcef(0xbf)](_0x100689,_0x2aef21=0x1){const _0x55d9af=a352_0x57fcef;this[_0x55d9af(0xc8)][_0x55d9af(0x111)](_0x55d9af(0xd7));const _0x3bd8ff=new form_data_1[(_0x55d9af(0xd3))]();_0x3bd8ff[_0x55d9af(0x106)](_0x55d9af(0xdf),(0x0,fs_1[_0x55d9af(0xc1)])(_0x100689));const _0x1a4226=await this[_0x55d9af(0xf9)][_0x55d9af(0x107)](veeva_constants_1['VeevaConstants'][_0x55d9af(0xf4)],_0x3bd8ff,{'headers':{'Content-Type':_0x55d9af(0xda)}}),_0x42d94e=_0x1a4226[_0x55d9af(0xbd)];if(_0x42d94e['responseStatus']===status_enums_1[_0x55d9af(0xcd)][_0x55d9af(0x113)])return _0x42d94e[_0x55d9af(0xdc)];else{if(_0x2aef21>0x0)return await(0x0,veeva_auth_utils_1[_0x55d9af(0xc2)])(this[_0x55d9af(0xf9)]),await this[_0x55d9af(0xbf)](_0x100689,_0x2aef21-0x1);throw new veeva_error_1[(_0x55d9af(0xca))](_0x42d94e[_0x55d9af(0xf7)]);}}async[a352_0x57fcef(0xc0)](_0x4cd832){const _0x17799d=a352_0x57fcef;this[_0x17799d(0xc8)][_0x17799d(0x111)](_0x17799d(0xe8));const _0x2484a2=await this[_0x17799d(0xf9)][_0x17799d(0x114)](veeva_constants_1[_0x17799d(0xc6)][_0x17799d(0xef)][_0x17799d(0xe5)](_0x17799d(0xfa),_0x4cd832)),_0x484b42=await _0x2484a2['data'];if(_0x484b42[_0x17799d(0xed)]===status_enums_1[_0x17799d(0xcd)]['SUCCESS'])return _0x484b42[_0x17799d(0xdc)];else throw new veeva_error_1[(_0x17799d(0xca))](_0x484b42['errors']);}async[a352_0x57fcef(0x10f)](_0x2c61e6){const _0x62a712=a352_0x57fcef;this[_0x62a712(0xc8)][_0x62a712(0x111)](_0x62a712(0xc4));const [_0x54463f]=await this[_0x62a712(0xbc)][_0x62a712(0xce)]([_0x2c61e6]);return _0x54463f[_0x62a712(0xe9)][_0x62a712(0xe3)](_0x23d1a9=>_0x23d1a9[_0x62a712(0xec)]===_0x62a712(0xd1))[_0x62a712(0xd5)];}async['getValidationDetailsAndSaveLog'](_0x34b60c){const _0x454f07=a352_0x57fcef;this[_0x454f07(0xc8)][_0x454f07(0x111)]('Get\x20validation\x20details.');const {data:_0x176d37}=await this[_0x454f07(0xf9)]['get'](_0x34b60c);if(_0x176d37[_0x454f07(0xed)]===status_enums_1[_0x454f07(0xcd)][_0x454f07(0x113)]){const _0x9b8755=new package_details_dto_1[(_0x454f07(0x109))](),{log:_0x13029e,id:_0x53d3eb,package_status:_0x217066,package_steps:_0x81bb29}=_0x176d37[_0x454f07(0xb6)],_0x4b0cff=_0x13029e[_0x454f07(0xe0)](_0x1768d7=>_0x1768d7[_0x454f07(0xfd)][_0x454f07(0x115)](_0x454f07(0xdd))),_0x3bc4f=await this[_0x454f07(0xfb)](_0x4b0cff[0x0][_0x454f07(0xdc)]);await this[_0x454f07(0xf6)](_0x3bc4f,_0x454f07(0xba)),_0x9b8755[_0x454f07(0xde)]=_0x53d3eb,_0x9b8755[_0x454f07(0x101)]=this[_0x454f07(0x112)](_0x81bb29),await this[_0x454f07(0xe2)](_0x9b8755);if(_0x217066!==status_enums_1['VeevaPackageStatus'][_0x454f07(0xe6)])throw new Error(_0x454f07(0xcf));return _0x9b8755;}else throw new veeva_error_1['VeevaError'](_0x176d37[_0x454f07(0xf7)]);}async[a352_0x57fcef(0xc9)](_0x52169d,_0x2ca3fd){const _0x3f531c=a352_0x57fcef;var _0x98983a;this[_0x3f531c(0xc8)][_0x3f531c(0x111)](_0x3f531c(0xb5));const {data:_0x119b46}=await this[_0x3f531c(0xf9)][_0x3f531c(0xeb)](_0x52169d);if(_0x119b46[_0x3f531c(0xed)]===status_enums_1[_0x3f531c(0xcd)][_0x3f531c(0x113)]){const {responseDetails:{deployment_log:_0x28102f,package_status__v:_0x3d8a21},package_steps:_0x656362}=_0x119b46,_0x144a22=_0x28102f[_0x3f531c(0xe0)](_0x364b46=>_0x364b46['filename']['endsWith'](_0x3f531c(0x100))),_0x31b994=await this[_0x3f531c(0xfb)](_0x144a22[0x0][_0x3f531c(0xdc)]);await this[_0x3f531c(0xf6)](_0x31b994,'Deploy\x20Log'),_0x2ca3fd['isDeployed']=[status_enums_1[_0x3f531c(0xcc)]['DEPLOYED'],status_enums_1[_0x3f531c(0xcc)][_0x3f531c(0xc7)]]['includes'](_0x3d8a21);const _0x2182dd=array_utils_1['ArrayUtils']['groupUniqueToMap'](this[_0x3f531c(0x112)](_0x656362),({uniqueName:_0x50cde6})=>_0x50cde6);for(const _0x4e7a86 of _0x2ca3fd[_0x3f531c(0x101)]){const _0x4865fd=(_0x98983a=_0x2182dd['get'](_0x4e7a86[_0x3f531c(0xe1)]))===null||_0x98983a===void 0x0?void 0x0:_0x98983a['status'];_0x4865fd&&(_0x4e7a86[_0x3f531c(0x10d)]=_0x4865fd);}_0x2ca3fd[_0x3f531c(0x101)]=_0x2ca3fd['packageComponentList'][_0x3f531c(0xe0)](_0x7a84ab=>_0x7a84ab['status']!==status_enums_1[_0x3f531c(0xf2)][_0x3f531c(0xe6)]);if(!_0x2ca3fd[_0x3f531c(0x101)][_0x3f531c(0xbb)])throw new Error('Cannot\x20find\x20deployment\x20results');return _0x2ca3fd;}else throw new veeva_error_1[(_0x3f531c(0xca))](_0x119b46[_0x3f531c(0xf7)]);}async[a352_0x57fcef(0xfb)](_0x3c1477){const _0x9bd7d8=a352_0x57fcef,{data:_0x2e3cc3}=await this[_0x9bd7d8(0xf9)][_0x9bd7d8(0xeb)](_0x3c1477,{'responseType':_0x9bd7d8(0x10a)});return _0x2e3cc3;}[a352_0x57fcef(0x112)](_0x510d79){const _0x5ba71e=a352_0x57fcef;return _0x510d79[_0x5ba71e(0xbe)]((_0x125f0d,_0x374afa)=>{const _0x82974f=_0x5ba71e,_0x2f748d=_0x374afa[_0x82974f(0x102)][_0x82974f(0xc5)](_0x276d0d=>new package_component_dto_1['PackageComponentDto']({'status':_0x374afa[_0x82974f(0xd6)],'stepName':_0x374afa[_0x82974f(0xb8)],'component':_0x276d0d}));return[..._0x125f0d,..._0x2f748d];},[]);}async[a352_0x57fcef(0xe2)](_0x2939d8){const _0x50d6ed=a352_0x57fcef,{data:_0x32443e}=await this['_connection']['post'](veeva_constants_1[_0x50d6ed(0xc6)]['ENDPOINT_VALIDATE_PACKAGE'][_0x50d6ed(0xe5)](_0x50d6ed(0xfa),_0x2939d8[_0x50d6ed(0xde)]));if(_0x32443e[_0x50d6ed(0xed)]===status_enums_1[_0x50d6ed(0xcd)][_0x50d6ed(0x113)]){const {package_steps:_0x217090}=_0x32443e['responseDetails'],_0x35d40a=array_utils_1[_0x50d6ed(0x110)][_0x50d6ed(0xea)](_0x2939d8['packageComponentList'],({stepName:_0x43a401})=>_0x43a401);for(const {name__v:_0x1ae511,deployment_action:_0x4ff03f}of _0x217090){for(const _0x59b4cd of _0x35d40a[_0x50d6ed(0xeb)](_0x1ae511)||[]){_0x59b4cd[_0x50d6ed(0xc3)]=package_component_dto_1['PackageComponentDto'][_0x50d6ed(0x10b)](_0x4ff03f);}}}else throw new veeva_error_1[(_0x50d6ed(0xca))](_0x32443e['errors']);}async['import'](_0x58a470){const _0x2cb0ca=a352_0x57fcef,_0x4afb11=await this[_0x2cb0ca(0xbf)](_0x58a470),_0x3cb298=await this['getJobDetailUrl'](_0x4afb11),_0xd93900=await this['getValidationDetailsAndSaveLog'](_0x3cb298),_0x122c92=await this[_0x2cb0ca(0xc0)](_0xd93900[_0x2cb0ca(0xde)]),_0x3d5591=await this[_0x2cb0ca(0x10f)](_0x122c92);return this['getDeployDetailsAndSaveLog'](_0x3d5591,_0xd93900);}}function a352_0x18e4(){const _0x5e5a2a=['responseStatus','760MrFLoc','ENDPOINT_DEPLOY_PACKAGE','99KuIfAV','../utils/veeva-auth.utils','PackageComponentStatus','(((.+)+)+)+$','ENDPOINT_EXPORT_IMPORT_PACKAGE','1548483FHkpTD','_saveLog','errors','form-data','_connection','{package_id}','getLogResultText','../enums/status.enums','filename','apply','26964vAugkO','Deployment.log','packageComponentList','package_components','1043868hGjSHI','toString','24pwtBec','append','put','236910CMxegs','PackageDetailsDto','text','convertDeploymentAction','__esModule','status','../dtos/package-details.dto','getJobDetailUrl','ArrayUtils','log','formPackageComponentList','SUCCESS','post','endsWith','search','Get\x20deploy\x20result','vaultPackage','__importDefault','name__v','771170ZfLvKr','Validation\x20Log','length','_veevaService','data','reduce','importVpk','deployPackage','createReadStream','updateVeevaConnection','deploymentAction','Wait\x20Executing\x20job','map','VeevaConstants','DEPLOYED_WITH_WARNINGS','_logger','getDeployDetailsAndSaveLog','VeevaError','../classes/errors/veeva-error','VeevaPackageStatus','VeevaResponseStatus','getJobResult','Package\x20not\x20verified','../utils/array.utils','artifacts','45CoXKTc','default','2756052gGfRoB','href','deployment_status__v','Import\x20package','10428lkMvfP','4oNbzJp','multipart/form-data','PackageImportService','url','Validation.log','packageId','file','filter','uniqueName','fillPackageDeploymentAction','find','../constants/veeva.constants','replace','VERIFIED','../dtos/package-component.dto','Deploy\x20package','links','groupToMap','get','rel'];a352_0x18e4=function(){return _0x5e5a2a;};return a352_0x18e4();}exports[a352_0x57fcef(0xdb)]=PackageImportService;