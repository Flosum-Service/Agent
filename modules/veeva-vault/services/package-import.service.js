function a403_0x212e(_0x1ce5d3,_0x40bd51){const _0x565a26=a403_0x170b();return a403_0x212e=function(_0x9feabc,_0x499af5){_0x9feabc=_0x9feabc-0x143;let _0x170bfb=_0x565a26[_0x9feabc];return _0x170bfb;},a403_0x212e(_0x1ce5d3,_0x40bd51);}const a403_0x6483cf=a403_0x212e;(function(_0x2e4b9f,_0x39680e){const _0x6a5727=a403_0x212e,_0x21e0f6=_0x2e4b9f();while(!![]){try{const _0x3630e1=-parseInt(_0x6a5727(0x162))/0x1*(-parseInt(_0x6a5727(0x163))/0x2)+-parseInt(_0x6a5727(0x16e))/0x3*(parseInt(_0x6a5727(0x157))/0x4)+parseInt(_0x6a5727(0x169))/0x5*(parseInt(_0x6a5727(0x159))/0x6)+-parseInt(_0x6a5727(0x166))/0x7*(parseInt(_0x6a5727(0x19f))/0x8)+-parseInt(_0x6a5727(0x172))/0x9+parseInt(_0x6a5727(0x177))/0xa+parseInt(_0x6a5727(0x1a1))/0xb;if(_0x3630e1===_0x39680e)break;else _0x21e0f6['push'](_0x21e0f6['shift']());}catch(_0x4be63f){_0x21e0f6['push'](_0x21e0f6['shift']());}}}(a403_0x170b,0xb0c26));const a403_0x499af5=(function(){let _0x31c1c1=!![];return function(_0x40659b,_0x16796d){const _0x482f11=_0x31c1c1?function(){const _0x5b654c=a403_0x212e;if(_0x16796d){const _0x4baf46=_0x16796d[_0x5b654c(0x174)](_0x40659b,arguments);return _0x16796d=null,_0x4baf46;}}:function(){};return _0x31c1c1=![],_0x482f11;};}()),a403_0x9feabc=a403_0x499af5(this,function(){const _0x56ae26=a403_0x212e;return a403_0x9feabc[_0x56ae26(0x19a)]()[_0x56ae26(0x155)]('(((.+)+)+)+$')[_0x56ae26(0x19a)]()[_0x56ae26(0x19c)](a403_0x9feabc)[_0x56ae26(0x155)]('(((.+)+)+)+$');});a403_0x9feabc();'use strict';function a403_0x170b(){const _0x7eb4ba=['reduce','responseStatus','714028dsyvVg','vaultPackage','DEPLOYED_WITH_WARNINGS','1747455nFNwta','../utils/array.utils','endsWith','_connection','getValidationDetailsAndSaveLog','4126299fidwqj','filename','put','convertDeploymentAction','9098946ckBimw','uniqueName','apply','replace','Wait\x20Executing\x20job','5643770UtMxvT','find','Import\x20package','VeevaPackageStatus','formPackageComponentList','url','get','updateVeevaConnection','getDeployDetailsAndSaveLog','Deploy\x20package','filter','package_components','file','../utils/veeva-auth.utils','getLogResultText','artifacts','status','map','multipart/form-data','getJobDetailUrl','fillPackageDeploymentAction','default','VeevaConstants','VeevaResponseStatus','errors','_saveLog','SUCCESS','packageId','packageComponentList','Get\x20deploy\x20result','PackageImportService','Deployment.log','getJobResult','{package_id}','responseDetails','toString','form-data','constructor','import','importVpk','64hnPWJg','deployment_status__v','23301168tZyscM','deployPackage','PackageComponentDto','createReadStream','isDeployed','__esModule','_veevaService','_logger','post','../enums/status.enums','append','data','../classes/errors/veeva-error','ArrayUtils','Deploy\x20Log','ENDPOINT_EXPORT_IMPORT_PACKAGE','../dtos/package-component.dto','deploymentAction','groupUniqueToMap','groupToMap','name__v','ENDPOINT_VALIDATE_PACKAGE','search','log','4CQzwhY','length','6kaniej','Package\x20not\x20verified','VERIFIED','DEPLOYED','ENDPOINT_DEPLOY_PACKAGE','VeevaError','../constants/veeva.constants','__importDefault','Validation.log','39JkrYjG','45862actKub'];a403_0x170b=function(){return _0x7eb4ba;};return a403_0x170b();}var __importDefault=this&&this[a403_0x6483cf(0x160)]||function(_0x3d34f){const _0x27dc72=a403_0x6483cf;return _0x3d34f&&_0x3d34f[_0x27dc72(0x144)]?_0x3d34f:{'default':_0x3d34f};};Object['defineProperty'](exports,a403_0x6483cf(0x144),{'value':!![]}),exports[a403_0x6483cf(0x195)]=void 0x0;const veeva_constants_1=require(a403_0x6483cf(0x15f)),status_enums_1=require(a403_0x6483cf(0x148)),veeva_error_1=require(a403_0x6483cf(0x14b)),form_data_1=__importDefault(require(a403_0x6483cf(0x19b))),fs_1=require('fs'),veeva_auth_utils_1=require(a403_0x6483cf(0x184)),package_details_dto_1=require('../dtos/package-details.dto'),package_component_dto_1=require(a403_0x6483cf(0x14f)),array_utils_1=require(a403_0x6483cf(0x16a));class PackageImportService{constructor({veevaService:_0x53bb9e,connection:_0x30325b,logger:_0x53e0b6,saveLog:_0x1b1436}){const _0x26eb80=a403_0x6483cf;this[_0x26eb80(0x145)]=_0x53bb9e,this[_0x26eb80(0x16c)]=_0x30325b,this[_0x26eb80(0x146)]=_0x53e0b6,this[_0x26eb80(0x190)]=_0x1b1436;}async[a403_0x6483cf(0x19e)](_0x2ad9f5,_0x14d1c9=0x1){const _0x1803ce=a403_0x6483cf;this[_0x1803ce(0x146)][_0x1803ce(0x156)](_0x1803ce(0x179));const _0x495d24=new form_data_1[(_0x1803ce(0x18c))]();_0x495d24[_0x1803ce(0x149)](_0x1803ce(0x183),(0x0,fs_1[_0x1803ce(0x1a4)])(_0x2ad9f5));const _0x5f26a4=await this[_0x1803ce(0x16c)][_0x1803ce(0x170)](veeva_constants_1[_0x1803ce(0x18d)][_0x1803ce(0x14e)],_0x495d24,{'headers':{'Content-Type':_0x1803ce(0x189)}}),_0x5d7694=_0x5f26a4[_0x1803ce(0x14a)];if(_0x5d7694[_0x1803ce(0x165)]===status_enums_1[_0x1803ce(0x18e)][_0x1803ce(0x191)])return _0x5d7694[_0x1803ce(0x17c)];else{if(_0x14d1c9>0x0)return await(0x0,veeva_auth_utils_1[_0x1803ce(0x17e)])(this[_0x1803ce(0x16c)]),await this['importVpk'](_0x2ad9f5,_0x14d1c9-0x1);throw new veeva_error_1[(_0x1803ce(0x15e))](_0x5d7694[_0x1803ce(0x18f)]);}}async[a403_0x6483cf(0x1a2)](_0x336cc1){const _0x12a467=a403_0x6483cf;this[_0x12a467(0x146)][_0x12a467(0x156)](_0x12a467(0x180));const _0x5f37d0=await this[_0x12a467(0x16c)][_0x12a467(0x147)](veeva_constants_1['VeevaConstants'][_0x12a467(0x15d)][_0x12a467(0x175)](_0x12a467(0x198),_0x336cc1)),_0x15f5bd=await _0x5f37d0[_0x12a467(0x14a)];if(_0x15f5bd['responseStatus']===status_enums_1[_0x12a467(0x18e)][_0x12a467(0x191)])return _0x15f5bd[_0x12a467(0x17c)];else throw new veeva_error_1[(_0x12a467(0x15e))](_0x15f5bd[_0x12a467(0x18f)]);}async['getJobDetailUrl'](_0x2218c1){const _0x46358f=a403_0x6483cf;this[_0x46358f(0x146)][_0x46358f(0x156)](_0x46358f(0x176));const [_0x274993]=await this[_0x46358f(0x145)][_0x46358f(0x197)]([_0x2218c1]);return _0x274993['links'][_0x46358f(0x178)](_0x37942b=>_0x37942b['rel']===_0x46358f(0x186))['href'];}async[a403_0x6483cf(0x16d)](_0x2fd573){const _0x391215=a403_0x6483cf;this[_0x391215(0x146)][_0x391215(0x156)]('Get\x20validation\x20details.');const {data:_0x47ef2a}=await this[_0x391215(0x16c)]['get'](_0x2fd573);if(_0x47ef2a[_0x391215(0x165)]===status_enums_1[_0x391215(0x18e)][_0x391215(0x191)]){const _0x4ba68c=new package_details_dto_1['PackageDetailsDto'](),{log:_0xa5a3bf,id:_0x32a97d,package_status:_0x17744f,package_steps:_0x46805c}=_0x47ef2a[_0x391215(0x167)],_0x3bfa67=_0xa5a3bf['filter'](_0x5b1972=>_0x5b1972[_0x391215(0x16f)][_0x391215(0x16b)](_0x391215(0x161))),_0x2363a5=await this[_0x391215(0x185)](_0x3bfa67[0x0]['url']);await this['_saveLog'](_0x2363a5,'Validation\x20Log'),_0x4ba68c['packageId']=_0x32a97d,_0x4ba68c['packageComponentList']=this[_0x391215(0x17b)](_0x46805c),await this[_0x391215(0x18b)](_0x4ba68c);if(_0x17744f!==status_enums_1[_0x391215(0x17a)]['VERIFIED'])throw new Error(_0x391215(0x15a));return _0x4ba68c;}else throw new veeva_error_1[(_0x391215(0x15e))](_0x47ef2a[_0x391215(0x18f)]);}async[a403_0x6483cf(0x17f)](_0x5deb09,_0x2b3fbb){const _0x42cba2=a403_0x6483cf;var _0x4cbb2b;this[_0x42cba2(0x146)][_0x42cba2(0x156)](_0x42cba2(0x194));const {data:_0x315f4e}=await this[_0x42cba2(0x16c)]['get'](_0x5deb09);if(_0x315f4e[_0x42cba2(0x165)]===status_enums_1['VeevaResponseStatus']['SUCCESS']){const {responseDetails:{deployment_log:_0x51f877,package_status__v:_0x239d13},package_steps:_0x43d055}=_0x315f4e,_0x5609a4=_0x51f877[_0x42cba2(0x181)](_0x3047cd=>_0x3047cd[_0x42cba2(0x16f)]['endsWith'](_0x42cba2(0x196))),_0x141444=await this[_0x42cba2(0x185)](_0x5609a4[0x0][_0x42cba2(0x17c)]);await this['_saveLog'](_0x141444,_0x42cba2(0x14d)),_0x2b3fbb[_0x42cba2(0x143)]=[status_enums_1['VeevaPackageStatus'][_0x42cba2(0x15c)],status_enums_1['VeevaPackageStatus'][_0x42cba2(0x168)]]['includes'](_0x239d13);const _0x45762d=array_utils_1[_0x42cba2(0x14c)][_0x42cba2(0x151)](this[_0x42cba2(0x17b)](_0x43d055),({uniqueName:_0x4c78c9})=>_0x4c78c9);for(const _0x30580f of _0x2b3fbb[_0x42cba2(0x193)]){const _0x46aa02=(_0x4cbb2b=_0x45762d['get'](_0x30580f[_0x42cba2(0x173)]))===null||_0x4cbb2b===void 0x0?void 0x0:_0x4cbb2b[_0x42cba2(0x187)];_0x46aa02&&(_0x30580f[_0x42cba2(0x187)]=_0x46aa02);}_0x2b3fbb['packageComponentList']=_0x2b3fbb[_0x42cba2(0x193)][_0x42cba2(0x181)](_0x462f2f=>_0x462f2f[_0x42cba2(0x187)]!==status_enums_1['PackageComponentStatus'][_0x42cba2(0x15b)]);if(!_0x2b3fbb[_0x42cba2(0x193)][_0x42cba2(0x158)])throw new Error('Cannot\x20find\x20deployment\x20results');return _0x2b3fbb;}else throw new veeva_error_1[(_0x42cba2(0x15e))](_0x315f4e['errors']);}async['getLogResultText'](_0x1a9ad9){const _0x4acda0=a403_0x6483cf,{data:_0x483ea7}=await this['_connection'][_0x4acda0(0x17d)](_0x1a9ad9,{'responseType':'text'});return _0x483ea7;}[a403_0x6483cf(0x17b)](_0x369b6e){const _0x18aed1=a403_0x6483cf;return _0x369b6e[_0x18aed1(0x164)]((_0x20ccb7,_0x2ca6c7)=>{const _0x1e3269=_0x18aed1,_0x482c23=_0x2ca6c7[_0x1e3269(0x182)][_0x1e3269(0x188)](_0x3d6506=>new package_component_dto_1['PackageComponentDto']({'status':_0x2ca6c7[_0x1e3269(0x1a0)],'stepName':_0x2ca6c7[_0x1e3269(0x153)],'component':_0x3d6506}));return[..._0x20ccb7,..._0x482c23];},[]);}async[a403_0x6483cf(0x18b)](_0x5e9472){const _0x45c82d=a403_0x6483cf,{data:_0x2ab6c2}=await this[_0x45c82d(0x16c)]['post'](veeva_constants_1[_0x45c82d(0x18d)][_0x45c82d(0x154)][_0x45c82d(0x175)](_0x45c82d(0x198),_0x5e9472[_0x45c82d(0x192)]));if(_0x2ab6c2[_0x45c82d(0x165)]===status_enums_1[_0x45c82d(0x18e)][_0x45c82d(0x191)]){const {package_steps:_0x2fac11}=_0x2ab6c2[_0x45c82d(0x199)],_0xcae42e=array_utils_1[_0x45c82d(0x14c)][_0x45c82d(0x152)](_0x5e9472[_0x45c82d(0x193)],({stepName:_0x52167f})=>_0x52167f);for(const {name__v:_0x308c7d,deployment_action:_0x1c31cd}of _0x2fac11){for(const _0x1f978d of _0xcae42e[_0x45c82d(0x17d)](_0x308c7d)||[]){_0x1f978d[_0x45c82d(0x150)]=package_component_dto_1[_0x45c82d(0x1a3)][_0x45c82d(0x171)](_0x1c31cd);}}}else throw new veeva_error_1[(_0x45c82d(0x15e))](_0x2ab6c2['errors']);}async[a403_0x6483cf(0x19d)](_0x2155a4){const _0x532199=a403_0x6483cf,_0x343a5e=await this[_0x532199(0x19e)](_0x2155a4),_0x117eb2=await this[_0x532199(0x18a)](_0x343a5e),_0x4bd42f=await this[_0x532199(0x16d)](_0x117eb2),_0x4b348a=await this[_0x532199(0x1a2)](_0x4bd42f[_0x532199(0x192)]),_0x279a37=await this[_0x532199(0x18a)](_0x4b348a);return this[_0x532199(0x17f)](_0x279a37,_0x4bd42f);}}exports['PackageImportService']=PackageImportService;