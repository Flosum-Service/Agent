const a360_0x259496=a360_0x2891;(function(_0x2868a3,_0x245731){const _0x9d93bf=a360_0x2891,_0xf119fc=_0x2868a3();while(!![]){try{const _0x1b8e41=parseInt(_0x9d93bf(0x96))/0x1+parseInt(_0x9d93bf(0xb3))/0x2*(parseInt(_0x9d93bf(0xb9))/0x3)+-parseInt(_0x9d93bf(0xd2))/0x4*(parseInt(_0x9d93bf(0x81))/0x5)+-parseInt(_0x9d93bf(0x90))/0x6+-parseInt(_0x9d93bf(0x80))/0x7+parseInt(_0x9d93bf(0x9e))/0x8*(-parseInt(_0x9d93bf(0xcb))/0x9)+parseInt(_0x9d93bf(0xb8))/0xa;if(_0x1b8e41===_0x245731)break;else _0xf119fc['push'](_0xf119fc['shift']());}catch(_0x13d917){_0xf119fc['push'](_0xf119fc['shift']());}}}(a360_0x130d,0x8aad0));const a360_0x2a6a72=(function(){let _0x5635db=!![];return function(_0x3cc91c,_0x5ce044){const _0x554569=_0x5635db?function(){if(_0x5ce044){const _0x1abe2f=_0x5ce044['apply'](_0x3cc91c,arguments);return _0x5ce044=null,_0x1abe2f;}}:function(){};return _0x5635db=![],_0x554569;};}()),a360_0x709a16=a360_0x2a6a72(this,function(){const _0x228f40=a360_0x2891;return a360_0x709a16[_0x228f40(0xa8)]()[_0x228f40(0xa4)](_0x228f40(0xb5))[_0x228f40(0xa8)]()[_0x228f40(0xa6)](a360_0x709a16)[_0x228f40(0xa4)](_0x228f40(0xb5));});function a360_0x130d(){const _0x4eff54=['map','PackageImportService','PackageComponentDto','fillPackageDeploymentAction','ENDPOINT_DEPLOY_PACKAGE','379196zGqedB','convertDeploymentAction','updateVeevaConnection','filter','text','groupToMap','get','replace','../utils/array.utils','7906087gQeEJN','30BTIYMY','DEPLOYED','Deployment.log','Wait\x20Executing\x20job','importVpk','errors','DEPLOYED_WITH_WARNINGS','package_components','defineProperty','ArrayUtils','reduce','isDeployed','PackageDetailsDto','deployPackage','includes','6136908qBljtM','getValidationDetailsAndSaveLog','import','../enums/status.enums','post','../utils/veeva-auth.utils','663637OkxTek','find','VeevaConstants','file','Deploy\x20package','packageComponentList','status','rel','5340728EbZeDF','getDeployDetailsAndSaveLog','{package_id}','SUCCESS','formPackageComponentList','data','search','getJobDetailUrl','constructor','put','toString','filename','../dtos/package-component.dto','_veevaService','createReadStream','log','../classes/errors/veeva-error','VeevaError','packageId','VeevaPackageStatus','__esModule','93754TvbQZh','VeevaResponseStatus','(((.+)+)+)+$','form-data','links','29648840SQYUPP','21sltQfd','_saveLog','_logger','endsWith','../dtos/package-details.dto','_connection','deployment_status__v','href','getLogResultText','groupUniqueToMap','VERIFIED','responseStatus','__importDefault','getJobResult','Deploy\x20Log','PackageComponentStatus','url','Validation\x20Log','9XSCDMD','artifacts'];a360_0x130d=function(){return _0x4eff54;};return a360_0x130d();}a360_0x709a16();'use strict';var __importDefault=this&&this[a360_0x259496(0xc5)]||function(_0x24a226){const _0x4d40b5=a360_0x259496;return _0x24a226&&_0x24a226[_0x4d40b5(0xb2)]?_0x24a226:{'default':_0x24a226};};Object[a360_0x259496(0x89)](exports,'__esModule',{'value':!![]}),exports[a360_0x259496(0xce)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),status_enums_1=require(a360_0x259496(0x93)),veeva_error_1=require(a360_0x259496(0xae)),form_data_1=__importDefault(require(a360_0x259496(0xb6))),fs_1=require('fs'),veeva_auth_utils_1=require(a360_0x259496(0x95)),package_details_dto_1=require(a360_0x259496(0xbd)),package_component_dto_1=require(a360_0x259496(0xaa)),array_utils_1=require(a360_0x259496(0x7f));class PackageImportService{constructor({veevaService:_0x13c0d0,connection:_0x525099,logger:_0x3a6fe4,saveLog:_0x515d71}){const _0x2020fd=a360_0x259496;this[_0x2020fd(0xab)]=_0x13c0d0,this[_0x2020fd(0xbe)]=_0x525099,this['_logger']=_0x3a6fe4,this['_saveLog']=_0x515d71;}async[a360_0x259496(0x85)](_0x7bfea8,_0x19bf45=0x1){const _0x330755=a360_0x259496;this[_0x330755(0xbb)][_0x330755(0xad)]('Import\x20package');const _0x29ca16=new form_data_1['default']();_0x29ca16['append'](_0x330755(0x99),(0x0,fs_1[_0x330755(0xac)])(_0x7bfea8));const _0x3676e9=await this[_0x330755(0xbe)][_0x330755(0xa7)](veeva_constants_1[_0x330755(0x98)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x29ca16,{'headers':{'Content-Type':'multipart/form-data'}}),_0x2e6c4c=_0x3676e9['data'];if(_0x2e6c4c[_0x330755(0xc4)]===status_enums_1[_0x330755(0xb4)][_0x330755(0xa1)])return _0x2e6c4c[_0x330755(0xc9)];else{if(_0x19bf45>0x0)return await(0x0,veeva_auth_utils_1[_0x330755(0xd4)])(this[_0x330755(0xbe)]),await this[_0x330755(0x85)](_0x7bfea8,_0x19bf45-0x1);throw new veeva_error_1[(_0x330755(0xaf))](_0x2e6c4c[_0x330755(0x86)]);}}async[a360_0x259496(0x8e)](_0xeccf53){const _0x5f2fac=a360_0x259496;this[_0x5f2fac(0xbb)][_0x5f2fac(0xad)](_0x5f2fac(0x9a));const _0x1bd75f=await this[_0x5f2fac(0xbe)][_0x5f2fac(0x94)](veeva_constants_1[_0x5f2fac(0x98)][_0x5f2fac(0xd1)][_0x5f2fac(0xd9)](_0x5f2fac(0xa0),_0xeccf53)),_0x39f4e6=await _0x1bd75f[_0x5f2fac(0xa3)];if(_0x39f4e6[_0x5f2fac(0xc4)]===status_enums_1['VeevaResponseStatus'][_0x5f2fac(0xa1)])return _0x39f4e6[_0x5f2fac(0xc9)];else throw new veeva_error_1[(_0x5f2fac(0xaf))](_0x39f4e6[_0x5f2fac(0x86)]);}async[a360_0x259496(0xa5)](_0xa2eab1){const _0x54ac94=a360_0x259496;this[_0x54ac94(0xbb)][_0x54ac94(0xad)](_0x54ac94(0x84));const [_0x2b2c5a]=await this['_veevaService'][_0x54ac94(0xc6)]([_0xa2eab1]);return _0x2b2c5a[_0x54ac94(0xb7)][_0x54ac94(0x97)](_0x379ed7=>_0x379ed7[_0x54ac94(0x9d)]===_0x54ac94(0xcc))[_0x54ac94(0xc0)];}async[a360_0x259496(0x91)](_0x48fe1e){const _0x38928e=a360_0x259496;this['_logger'][_0x38928e(0xad)]('Get\x20validation\x20details.');const {data:_0x5b6bb2}=await this[_0x38928e(0xbe)][_0x38928e(0xd8)](_0x48fe1e);if(_0x5b6bb2['responseStatus']===status_enums_1[_0x38928e(0xb4)][_0x38928e(0xa1)]){const _0x973c47=new package_details_dto_1[(_0x38928e(0x8d))](),{log:_0x35a0d8,id:_0x35e185,package_status:_0x29f7c4,package_steps:_0x3a2d8e}=_0x5b6bb2['vaultPackage'],_0x297f65=_0x35a0d8[_0x38928e(0xd5)](_0x1fc695=>_0x1fc695[_0x38928e(0xa9)][_0x38928e(0xbc)]('Validation.log')),_0x31ab4e=await this[_0x38928e(0xc1)](_0x297f65[0x0]['url']);await this['_saveLog'](_0x31ab4e,_0x38928e(0xca)),_0x973c47['packageId']=_0x35e185,_0x973c47[_0x38928e(0x9b)]=this[_0x38928e(0xa2)](_0x3a2d8e),await this['fillPackageDeploymentAction'](_0x973c47);if(_0x29f7c4!==status_enums_1[_0x38928e(0xb1)][_0x38928e(0xc3)])throw new Error('Package\x20not\x20verified');return _0x973c47;}else throw new veeva_error_1[(_0x38928e(0xaf))](_0x5b6bb2[_0x38928e(0x86)]);}async[a360_0x259496(0x9f)](_0x49954c,_0x33b30a){const _0x43dba4=a360_0x259496;var _0x1a15fc;this[_0x43dba4(0xbb)]['log']('Get\x20deploy\x20result');const {data:_0xaba995}=await this[_0x43dba4(0xbe)][_0x43dba4(0xd8)](_0x49954c);if(_0xaba995['responseStatus']===status_enums_1[_0x43dba4(0xb4)]['SUCCESS']){const {responseDetails:{deployment_log:_0x53f1c4,package_status__v:_0x5a1bb8},package_steps:_0x58c8b5}=_0xaba995,_0xc08b22=_0x53f1c4[_0x43dba4(0xd5)](_0x1b011d=>_0x1b011d[_0x43dba4(0xa9)]['endsWith'](_0x43dba4(0x83))),_0x4d9602=await this[_0x43dba4(0xc1)](_0xc08b22[0x0][_0x43dba4(0xc9)]);await this[_0x43dba4(0xba)](_0x4d9602,_0x43dba4(0xc7)),_0x33b30a[_0x43dba4(0x8c)]=[status_enums_1[_0x43dba4(0xb1)][_0x43dba4(0x82)],status_enums_1[_0x43dba4(0xb1)][_0x43dba4(0x87)]][_0x43dba4(0x8f)](_0x5a1bb8);const _0x227804=array_utils_1[_0x43dba4(0x8a)][_0x43dba4(0xc2)](this[_0x43dba4(0xa2)](_0x58c8b5),({uniqueName:_0xb2caef})=>_0xb2caef);for(const _0x3f0755 of _0x33b30a['packageComponentList']){const _0x3f3ccd=(_0x1a15fc=_0x227804[_0x43dba4(0xd8)](_0x3f0755['uniqueName']))===null||_0x1a15fc===void 0x0?void 0x0:_0x1a15fc[_0x43dba4(0x9c)];_0x3f3ccd&&(_0x3f0755[_0x43dba4(0x9c)]=_0x3f3ccd);}_0x33b30a[_0x43dba4(0x9b)]=_0x33b30a[_0x43dba4(0x9b)]['filter'](_0x1ea93e=>_0x1ea93e[_0x43dba4(0x9c)]!==status_enums_1[_0x43dba4(0xc8)][_0x43dba4(0xc3)]);if(!_0x33b30a[_0x43dba4(0x9b)]['length'])throw new Error('Cannot\x20find\x20deployment\x20results');return _0x33b30a;}else throw new veeva_error_1[(_0x43dba4(0xaf))](_0xaba995[_0x43dba4(0x86)]);}async[a360_0x259496(0xc1)](_0x3b51db){const _0x35f4bc=a360_0x259496,{data:_0x375094}=await this[_0x35f4bc(0xbe)]['get'](_0x3b51db,{'responseType':_0x35f4bc(0xd6)});return _0x375094;}['formPackageComponentList'](_0x437077){const _0x709b0=a360_0x259496;return _0x437077[_0x709b0(0x8b)]((_0xa97892,_0x34742e)=>{const _0x335c0e=_0x709b0,_0x2bfdc6=_0x34742e[_0x335c0e(0x88)][_0x335c0e(0xcd)](_0x2a3b39=>new package_component_dto_1[(_0x335c0e(0xcf))]({'status':_0x34742e[_0x335c0e(0xbf)],'stepName':_0x34742e['name__v'],'component':_0x2a3b39}));return[..._0xa97892,..._0x2bfdc6];},[]);}async[a360_0x259496(0xd0)](_0x3501bd){const _0x1d8672=a360_0x259496,{data:_0x3fec79}=await this[_0x1d8672(0xbe)][_0x1d8672(0x94)](veeva_constants_1[_0x1d8672(0x98)]['ENDPOINT_VALIDATE_PACKAGE'][_0x1d8672(0xd9)](_0x1d8672(0xa0),_0x3501bd['packageId']));if(_0x3fec79[_0x1d8672(0xc4)]===status_enums_1[_0x1d8672(0xb4)][_0x1d8672(0xa1)]){const {package_steps:_0x53d912}=_0x3fec79['responseDetails'],_0x49f9bb=array_utils_1['ArrayUtils'][_0x1d8672(0xd7)](_0x3501bd[_0x1d8672(0x9b)],({stepName:_0x4dd414})=>_0x4dd414);for(const {name__v:_0x1151c2,deployment_action:_0x160f79}of _0x53d912){for(const _0x2946ed of _0x49f9bb[_0x1d8672(0xd8)](_0x1151c2)||[]){_0x2946ed['deploymentAction']=package_component_dto_1[_0x1d8672(0xcf)][_0x1d8672(0xd3)](_0x160f79);}}}else throw new veeva_error_1['VeevaError'](_0x3fec79[_0x1d8672(0x86)]);}async[a360_0x259496(0x92)](_0x2cacbd){const _0x4407e3=a360_0x259496,_0x2949a6=await this[_0x4407e3(0x85)](_0x2cacbd),_0x442678=await this['getJobDetailUrl'](_0x2949a6),_0x46296f=await this[_0x4407e3(0x91)](_0x442678),_0x40dd89=await this[_0x4407e3(0x8e)](_0x46296f[_0x4407e3(0xb0)]),_0x4edc19=await this[_0x4407e3(0xa5)](_0x40dd89);return this[_0x4407e3(0x9f)](_0x4edc19,_0x46296f);}}function a360_0x2891(_0x3ae06e,_0x548e30){const _0x1c47d=a360_0x130d();return a360_0x2891=function(_0x709a16,_0x2a6a72){_0x709a16=_0x709a16-0x7f;let _0x130d62=_0x1c47d[_0x709a16];return _0x130d62;},a360_0x2891(_0x3ae06e,_0x548e30);}exports[a360_0x259496(0xce)]=PackageImportService;