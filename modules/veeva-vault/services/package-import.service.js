const a355_0x5a475c=a355_0x3254;(function(_0x47a897,_0x3ac777){const _0x400a52=a355_0x3254,_0x180cac=_0x47a897();while(!![]){try{const _0x158475=-parseInt(_0x400a52(0x19a))/0x1*(parseInt(_0x400a52(0x18f))/0x2)+-parseInt(_0x400a52(0x1aa))/0x3+-parseInt(_0x400a52(0x1b9))/0x4+-parseInt(_0x400a52(0x1ad))/0x5*(parseInt(_0x400a52(0x1a1))/0x6)+-parseInt(_0x400a52(0x1b7))/0x7*(-parseInt(_0x400a52(0x1cd))/0x8)+parseInt(_0x400a52(0x197))/0x9+parseInt(_0x400a52(0x1a7))/0xa*(parseInt(_0x400a52(0x1b5))/0xb);if(_0x158475===_0x3ac777)break;else _0x180cac['push'](_0x180cac['shift']());}catch(_0x146c91){_0x180cac['push'](_0x180cac['shift']());}}}(a355_0x541c,0x6c6d2));function a355_0x541c(){const _0x20a08d=['rel','updateVeevaConnection','package_components','Cannot\x20find\x20deployment\x20results','7130180JPremf','responseStatus','href','860754dvKTlT','errors','form-data','6670invVIB','default','importVpk','{package_id}','VeevaConstants','packageComponentList','ArrayUtils','artifacts','11affKUJ','uniqueName','7WsxXVN','(((.+)+)+)+$','576000ljUBHl','PackageImportService','fillPackageDeploymentAction','filename','replace','packageId','append','Deploy\x20package','getJobDetailUrl','groupUniqueToMap','status','deployPackage','ENDPOINT_VALIDATE_PACKAGE','Import\x20package','VeevaResponseStatus','VeevaError','length','_connection','getJobResult','Validation.log','2946056CgjuDW','__importDefault','VERIFIED','convertDeploymentAction','_saveLog','apply','get','deployment_status__v','PackageComponentStatus','Deployment.log','log','getLogResultText','post','Wait\x20Executing\x20job','put','name__v','url','data','ENDPOINT_EXPORT_IMPORT_PACKAGE','SUCCESS','_logger','getDeployDetailsAndSaveLog','file','../enums/status.enums','responseDetails','search','../constants/veeva.constants','__esModule','PackageDetailsDto','16602RQeBce','getValidationDetailsAndSaveLog','toString','formPackageComponentList','ENDPOINT_DEPLOY_PACKAGE','deploymentAction','PackageComponentDto','endsWith','6271920OStwcj','Get\x20validation\x20details.','find','9vjkMgH','filter','_veevaService','createReadStream','VeevaPackageStatus','vaultPackage','reduce','3726rHKkJV','groupToMap'];a355_0x541c=function(){return _0x20a08d;};return a355_0x541c();}function a355_0x3254(_0x2375d3,_0x5266d9){const _0x512506=a355_0x541c();return a355_0x3254=function(_0x5844c2,_0x300691){_0x5844c2=_0x5844c2-0x185;let _0x541c1a=_0x512506[_0x5844c2];return _0x541c1a;},a355_0x3254(_0x2375d3,_0x5266d9);}const a355_0x300691=(function(){let _0x45ba4f=!![];return function(_0x4e7c69,_0x5ad7e8){const _0x1caca5=_0x45ba4f?function(){const _0x4aabf0=a355_0x3254;if(_0x5ad7e8){const _0xe09847=_0x5ad7e8[_0x4aabf0(0x1d2)](_0x4e7c69,arguments);return _0x5ad7e8=null,_0xe09847;}}:function(){};return _0x45ba4f=![],_0x1caca5;};}()),a355_0x5844c2=a355_0x300691(this,function(){const _0xc3d210=a355_0x3254;return a355_0x5844c2[_0xc3d210(0x191)]()[_0xc3d210(0x18b)](_0xc3d210(0x1b8))['toString']()['constructor'](a355_0x5844c2)[_0xc3d210(0x18b)](_0xc3d210(0x1b8));});a355_0x5844c2();'use strict';var __importDefault=this&&this[a355_0x5a475c(0x1ce)]||function(_0xcd3a9c){return _0xcd3a9c&&_0xcd3a9c['__esModule']?_0xcd3a9c:{'default':_0xcd3a9c};};Object['defineProperty'](exports,a355_0x5a475c(0x18d),{'value':!![]}),exports[a355_0x5a475c(0x1ba)]=void 0x0;const veeva_constants_1=require(a355_0x5a475c(0x18c)),status_enums_1=require(a355_0x5a475c(0x189)),veeva_error_1=require('../classes/errors/veeva-error'),form_data_1=__importDefault(require(a355_0x5a475c(0x1ac))),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require('../dtos/package-details.dto'),package_component_dto_1=require('../dtos/package-component.dto'),array_utils_1=require('../utils/array.utils');class PackageImportService{constructor({veevaService:_0x3bbdbc,connection:_0x18b73e,logger:_0x3c65c7,saveLog:_0x2951d5}){const _0x532693=a355_0x5a475c;this[_0x532693(0x19c)]=_0x3bbdbc,this[_0x532693(0x1ca)]=_0x18b73e,this['_logger']=_0x3c65c7,this[_0x532693(0x1d1)]=_0x2951d5;}async[a355_0x5a475c(0x1af)](_0x3e8665,_0x38b63c=0x1){const _0x512242=a355_0x5a475c;this['_logger'][_0x512242(0x1d7)](_0x512242(0x1c6));const _0x592689=new form_data_1[(_0x512242(0x1ae))]();_0x592689[_0x512242(0x1bf)](_0x512242(0x188),(0x0,fs_1[_0x512242(0x19d)])(_0x3e8665));const _0x5a7c57=await this[_0x512242(0x1ca)][_0x512242(0x1db)](veeva_constants_1[_0x512242(0x1b1)][_0x512242(0x1df)],_0x592689,{'headers':{'Content-Type':'multipart/form-data'}}),_0x273018=_0x5a7c57[_0x512242(0x1de)];if(_0x273018[_0x512242(0x1a8)]===status_enums_1[_0x512242(0x1c7)]['SUCCESS'])return _0x273018[_0x512242(0x1dd)];else{if(_0x38b63c>0x0)return await(0x0,veeva_auth_utils_1[_0x512242(0x1a4)])(this['_connection']),await this['importVpk'](_0x3e8665,_0x38b63c-0x1);throw new veeva_error_1[(_0x512242(0x1c8))](_0x273018[_0x512242(0x1ab)]);}}async[a355_0x5a475c(0x1c4)](_0x9c1e73){const _0x2956b5=a355_0x5a475c;this[_0x2956b5(0x186)][_0x2956b5(0x1d7)](_0x2956b5(0x1c0));const _0x3bb2f9=await this['_connection'][_0x2956b5(0x1d9)](veeva_constants_1[_0x2956b5(0x1b1)][_0x2956b5(0x193)]['replace'](_0x2956b5(0x1b0),_0x9c1e73)),_0x4b1fc5=await _0x3bb2f9[_0x2956b5(0x1de)];if(_0x4b1fc5[_0x2956b5(0x1a8)]===status_enums_1['VeevaResponseStatus'][_0x2956b5(0x185)])return _0x4b1fc5['url'];else throw new veeva_error_1['VeevaError'](_0x4b1fc5[_0x2956b5(0x1ab)]);}async['getJobDetailUrl'](_0x41e18b){const _0x185fda=a355_0x5a475c;this[_0x185fda(0x186)][_0x185fda(0x1d7)](_0x185fda(0x1da));const [_0x3a2a5b]=await this[_0x185fda(0x19c)][_0x185fda(0x1cb)]([_0x41e18b]);return _0x3a2a5b['links'][_0x185fda(0x199)](_0x554248=>_0x554248[_0x185fda(0x1a3)]===_0x185fda(0x1b4))[_0x185fda(0x1a9)];}async[a355_0x5a475c(0x190)](_0x59a193){const _0x4d2856=a355_0x5a475c;this[_0x4d2856(0x186)][_0x4d2856(0x1d7)](_0x4d2856(0x198));const {data:_0x3a0cb9}=await this['_connection'][_0x4d2856(0x1d3)](_0x59a193);if(_0x3a0cb9[_0x4d2856(0x1a8)]===status_enums_1[_0x4d2856(0x1c7)][_0x4d2856(0x185)]){const _0x53c455=new package_details_dto_1[(_0x4d2856(0x18e))](),{log:_0x516910,id:_0x3cc62c,package_status:_0x50bc43,package_steps:_0x5131ae}=_0x3a0cb9[_0x4d2856(0x19f)],_0x11cee0=_0x516910[_0x4d2856(0x19b)](_0x5ddf9d=>_0x5ddf9d[_0x4d2856(0x1bc)][_0x4d2856(0x196)](_0x4d2856(0x1cc))),_0x504378=await this[_0x4d2856(0x1d8)](_0x11cee0[0x0]['url']);await this[_0x4d2856(0x1d1)](_0x504378,'Validation\x20Log'),_0x53c455[_0x4d2856(0x1be)]=_0x3cc62c,_0x53c455[_0x4d2856(0x1b2)]=this[_0x4d2856(0x192)](_0x5131ae),await this[_0x4d2856(0x1bb)](_0x53c455);if(_0x50bc43!==status_enums_1['VeevaPackageStatus'][_0x4d2856(0x1cf)])throw new Error('Package\x20not\x20verified');return _0x53c455;}else throw new veeva_error_1[(_0x4d2856(0x1c8))](_0x3a0cb9[_0x4d2856(0x1ab)]);}async[a355_0x5a475c(0x187)](_0x2965e4,_0x2656f5){const _0x50b084=a355_0x5a475c;var _0xe1f389;this[_0x50b084(0x186)][_0x50b084(0x1d7)]('Get\x20deploy\x20result');const {data:_0x318338}=await this[_0x50b084(0x1ca)]['get'](_0x2965e4);if(_0x318338['responseStatus']===status_enums_1[_0x50b084(0x1c7)][_0x50b084(0x185)]){const {responseDetails:{deployment_log:_0x3a4cf1,package_status__v:_0x5a4e67},package_steps:_0x43fd2d}=_0x318338,_0x236e32=_0x3a4cf1[_0x50b084(0x19b)](_0x72d3e2=>_0x72d3e2[_0x50b084(0x1bc)][_0x50b084(0x196)](_0x50b084(0x1d6))),_0x2d0324=await this[_0x50b084(0x1d8)](_0x236e32[0x0][_0x50b084(0x1dd)]);await this[_0x50b084(0x1d1)](_0x2d0324,'Deploy\x20Log'),_0x2656f5['isDeployed']=[status_enums_1['VeevaPackageStatus']['DEPLOYED'],status_enums_1[_0x50b084(0x19e)]['DEPLOYED_WITH_WARNINGS']]['includes'](_0x5a4e67);const _0x2561b5=array_utils_1[_0x50b084(0x1b3)][_0x50b084(0x1c2)](this[_0x50b084(0x192)](_0x43fd2d),({uniqueName:_0x45fff8})=>_0x45fff8);for(const _0x2b5a05 of _0x2656f5[_0x50b084(0x1b2)]){const _0x3a8cd1=(_0xe1f389=_0x2561b5[_0x50b084(0x1d3)](_0x2b5a05[_0x50b084(0x1b6)]))===null||_0xe1f389===void 0x0?void 0x0:_0xe1f389[_0x50b084(0x1c3)];_0x3a8cd1&&(_0x2b5a05[_0x50b084(0x1c3)]=_0x3a8cd1);}_0x2656f5[_0x50b084(0x1b2)]=_0x2656f5[_0x50b084(0x1b2)]['filter'](_0x2a994a=>_0x2a994a[_0x50b084(0x1c3)]!==status_enums_1[_0x50b084(0x1d5)][_0x50b084(0x1cf)]);if(!_0x2656f5[_0x50b084(0x1b2)][_0x50b084(0x1c9)])throw new Error(_0x50b084(0x1a6));return _0x2656f5;}else throw new veeva_error_1[(_0x50b084(0x1c8))](_0x318338[_0x50b084(0x1ab)]);}async[a355_0x5a475c(0x1d8)](_0x43ad7e){const _0x280338=a355_0x5a475c,{data:_0x42287c}=await this[_0x280338(0x1ca)][_0x280338(0x1d3)](_0x43ad7e,{'responseType':'text'});return _0x42287c;}[a355_0x5a475c(0x192)](_0x4c36e0){const _0xf2d6e4=a355_0x5a475c;return _0x4c36e0[_0xf2d6e4(0x1a0)]((_0x46d598,_0x3c2a66)=>{const _0x52fcc0=_0xf2d6e4,_0x4d631b=_0x3c2a66[_0x52fcc0(0x1a5)]['map'](_0xdfc89c=>new package_component_dto_1[(_0x52fcc0(0x195))]({'status':_0x3c2a66[_0x52fcc0(0x1d4)],'stepName':_0x3c2a66[_0x52fcc0(0x1dc)],'component':_0xdfc89c}));return[..._0x46d598,..._0x4d631b];},[]);}async[a355_0x5a475c(0x1bb)](_0x4b99e0){const _0x1f0b97=a355_0x5a475c,{data:_0x49caca}=await this[_0x1f0b97(0x1ca)][_0x1f0b97(0x1d9)](veeva_constants_1[_0x1f0b97(0x1b1)][_0x1f0b97(0x1c5)][_0x1f0b97(0x1bd)](_0x1f0b97(0x1b0),_0x4b99e0[_0x1f0b97(0x1be)]));if(_0x49caca[_0x1f0b97(0x1a8)]===status_enums_1[_0x1f0b97(0x1c7)][_0x1f0b97(0x185)]){const {package_steps:_0x199efb}=_0x49caca[_0x1f0b97(0x18a)],_0x2afbac=array_utils_1['ArrayUtils'][_0x1f0b97(0x1a2)](_0x4b99e0['packageComponentList'],({stepName:_0x1e7676})=>_0x1e7676);for(const {name__v:_0x7e9b44,deployment_action:_0x3d5a5e}of _0x199efb){for(const _0x1e7f88 of _0x2afbac[_0x1f0b97(0x1d3)](_0x7e9b44)||[]){_0x1e7f88[_0x1f0b97(0x194)]=package_component_dto_1['PackageComponentDto'][_0x1f0b97(0x1d0)](_0x3d5a5e);}}}else throw new veeva_error_1[(_0x1f0b97(0x1c8))](_0x49caca[_0x1f0b97(0x1ab)]);}async['import'](_0xa39817){const _0xa5b943=a355_0x5a475c,_0x511827=await this['importVpk'](_0xa39817),_0x403f3d=await this[_0xa5b943(0x1c1)](_0x511827),_0x375c64=await this[_0xa5b943(0x190)](_0x403f3d),_0x2aaebe=await this[_0xa5b943(0x1c4)](_0x375c64[_0xa5b943(0x1be)]),_0x4df366=await this[_0xa5b943(0x1c1)](_0x2aaebe);return this[_0xa5b943(0x187)](_0x4df366,_0x375c64);}}exports[a355_0x5a475c(0x1ba)]=PackageImportService;