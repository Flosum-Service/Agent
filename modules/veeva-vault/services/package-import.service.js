const a360_0x4b785f=a360_0x157d;(function(_0x3f661f,_0x129e08){const _0x107422=a360_0x157d,_0x3ddbe9=_0x3f661f();while(!![]){try{const _0x16d162=-parseInt(_0x107422(0xf7))/0x1*(parseInt(_0x107422(0xe4))/0x2)+parseInt(_0x107422(0x101))/0x3*(-parseInt(_0x107422(0xe8))/0x4)+parseInt(_0x107422(0x12e))/0x5+-parseInt(_0x107422(0x134))/0x6*(parseInt(_0x107422(0x112))/0x7)+parseInt(_0x107422(0xfb))/0x8*(-parseInt(_0x107422(0xdc))/0x9)+-parseInt(_0x107422(0x137))/0xa*(-parseInt(_0x107422(0x109))/0xb)+-parseInt(_0x107422(0x100))/0xc*(-parseInt(_0x107422(0xef))/0xd);if(_0x16d162===_0x129e08)break;else _0x3ddbe9['push'](_0x3ddbe9['shift']());}catch(_0x4288e2){_0x3ddbe9['push'](_0x3ddbe9['shift']());}}}(a360_0x2168,0xbd44a));const a360_0x861996=(function(){let _0x4f0146=!![];return function(_0x137fad,_0x5620b4){const _0x46a55d=_0x4f0146?function(){if(_0x5620b4){const _0x5bfbd7=_0x5620b4['apply'](_0x137fad,arguments);return _0x5620b4=null,_0x5bfbd7;}}:function(){};return _0x4f0146=![],_0x46a55d;};}()),a360_0x4bac0c=a360_0x861996(this,function(){const _0x90f015=a360_0x157d;return a360_0x4bac0c[_0x90f015(0xf9)]()[_0x90f015(0xf5)](_0x90f015(0xf4))[_0x90f015(0xf9)]()[_0x90f015(0x115)](a360_0x4bac0c)[_0x90f015(0xf5)](_0x90f015(0xf4));});a360_0x4bac0c();function a360_0x2168(){const _0x2b5d46=['name__v','5743705fLEKqz','../dtos/package-component.dto','../utils/veeva-auth.utils','groupUniqueToMap','VeevaError','SUCCESS','4926BDwxfE','{package_id}','getDeployDetailsAndSaveLog','11098830uFGRjG','Package\x20not\x20verified','ENDPOINT_DEPLOY_PACKAGE','uniqueName','_connection','4335111nAKrqY','ENDPOINT_EXPORT_IMPORT_PACKAGE','includes','VeevaResponseStatus','Cannot\x20find\x20deployment\x20results','endsWith','url','artifacts','189446rUXlxh','Wait\x20Executing\x20job','PackageComponentStatus','Import\x20package','4BRIQRx','form-data','import','getJobDetailUrl','responseStatus','updateVeevaConnection','data','280670KpCKHo','PackageImportService','__importDefault','getJobResult','href','(((.+)+)+)+$','search','package_components','4TELHkM','Deployment.log','toString','filename','16EogyGN','VERIFIED','map','Deploy\x20package','formPackageComponentList','648BrFKVu','1603293NUoHJX','default','find','_logger','../utils/array.utils','errors','replace','../enums/status.enums','11nRUtOl','rel','deployPackage','multipart/form-data','_saveLog','packageId','deployment_status__v','responseDetails','packageComponentList','6587JAthow','__esModule','get','constructor','links','DEPLOYED_WITH_WARNINGS','put','log','VeevaConstants','../classes/errors/veeva-error','../dtos/package-details.dto','post','getLogResultText','status','importVpk','PackageDetailsDto','vaultPackage','Validation.log','PackageComponentDto','filter','_veevaService','../constants/veeva.constants','getValidationDetailsAndSaveLog','Get\x20deploy\x20result','fillPackageDeploymentAction','VeevaPackageStatus','reduce'];a360_0x2168=function(){return _0x2b5d46;};return a360_0x2168();}'use strict';var __importDefault=this&&this[a360_0x4b785f(0xf1)]||function(_0x4c4e44){const _0x562322=a360_0x4b785f;return _0x4c4e44&&_0x4c4e44[_0x562322(0x113)]?_0x4c4e44:{'default':_0x4c4e44};};Object['defineProperty'](exports,a360_0x4b785f(0x113),{'value':!![]}),exports[a360_0x4b785f(0xf0)]=void 0x0;const veeva_constants_1=require(a360_0x4b785f(0x127)),status_enums_1=require(a360_0x4b785f(0x108)),veeva_error_1=require(a360_0x4b785f(0x11b)),form_data_1=__importDefault(require(a360_0x4b785f(0xe9))),fs_1=require('fs'),veeva_auth_utils_1=require(a360_0x4b785f(0x130)),package_details_dto_1=require(a360_0x4b785f(0x11c)),package_component_dto_1=require(a360_0x4b785f(0x12f)),array_utils_1=require(a360_0x4b785f(0x105));function a360_0x157d(_0x437753,_0x2ccab8){const _0x521121=a360_0x2168();return a360_0x157d=function(_0x4bac0c,_0x861996){_0x4bac0c=_0x4bac0c-0xda;let _0x216881=_0x521121[_0x4bac0c];return _0x216881;},a360_0x157d(_0x437753,_0x2ccab8);}class PackageImportService{constructor({veevaService:_0x48a9c3,connection:_0x3bc808,logger:_0x482506,saveLog:_0x382e4c}){const _0x11c3ce=a360_0x4b785f;this[_0x11c3ce(0x126)]=_0x48a9c3,this[_0x11c3ce(0xdb)]=_0x3bc808,this['_logger']=_0x482506,this[_0x11c3ce(0x10d)]=_0x382e4c;}async[a360_0x4b785f(0x120)](_0x39b318,_0x307f6f=0x1){const _0x154a92=a360_0x4b785f;this[_0x154a92(0x104)][_0x154a92(0x119)](_0x154a92(0xe7));const _0x101005=new form_data_1[(_0x154a92(0x102))]();_0x101005['append']('file',(0x0,fs_1['createReadStream'])(_0x39b318));const _0x46aad9=await this[_0x154a92(0xdb)][_0x154a92(0x118)](veeva_constants_1[_0x154a92(0x11a)][_0x154a92(0xdd)],_0x101005,{'headers':{'Content-Type':_0x154a92(0x10c)}}),_0x46f033=_0x46aad9[_0x154a92(0xee)];if(_0x46f033[_0x154a92(0xec)]===status_enums_1[_0x154a92(0xdf)][_0x154a92(0x133)])return _0x46f033['url'];else{if(_0x307f6f>0x0)return await(0x0,veeva_auth_utils_1[_0x154a92(0xed)])(this['_connection']),await this[_0x154a92(0x120)](_0x39b318,_0x307f6f-0x1);throw new veeva_error_1[(_0x154a92(0x132))](_0x46f033['errors']);}}async[a360_0x4b785f(0x10b)](_0xe66747){const _0x22967c=a360_0x4b785f;this[_0x22967c(0x104)][_0x22967c(0x119)](_0x22967c(0xfe));const _0x5f016b=await this[_0x22967c(0xdb)]['post'](veeva_constants_1[_0x22967c(0x11a)][_0x22967c(0x139)][_0x22967c(0x107)](_0x22967c(0x135),_0xe66747)),_0x1816fa=await _0x5f016b[_0x22967c(0xee)];if(_0x1816fa['responseStatus']===status_enums_1['VeevaResponseStatus']['SUCCESS'])return _0x1816fa[_0x22967c(0xe2)];else throw new veeva_error_1[(_0x22967c(0x132))](_0x1816fa[_0x22967c(0x106)]);}async[a360_0x4b785f(0xeb)](_0x19bf99){const _0x2cf756=a360_0x4b785f;this[_0x2cf756(0x104)]['log'](_0x2cf756(0xe5));const [_0x5db541]=await this[_0x2cf756(0x126)][_0x2cf756(0xf2)]([_0x19bf99]);return _0x5db541[_0x2cf756(0x116)][_0x2cf756(0x103)](_0x11f124=>_0x11f124[_0x2cf756(0x10a)]===_0x2cf756(0xe3))[_0x2cf756(0xf3)];}async[a360_0x4b785f(0x128)](_0x84ed43){const _0x2d35e6=a360_0x4b785f;this[_0x2d35e6(0x104)][_0x2d35e6(0x119)]('Get\x20validation\x20details.');const {data:_0x460b12}=await this[_0x2d35e6(0xdb)]['get'](_0x84ed43);if(_0x460b12[_0x2d35e6(0xec)]===status_enums_1[_0x2d35e6(0xdf)][_0x2d35e6(0x133)]){const _0x17d05d=new package_details_dto_1[(_0x2d35e6(0x121))](),{log:_0x557e14,id:_0x1abbd4,package_status:_0x4654d1,package_steps:_0x308353}=_0x460b12[_0x2d35e6(0x122)],_0xcf2c85=_0x557e14[_0x2d35e6(0x125)](_0x3c0e0b=>_0x3c0e0b[_0x2d35e6(0xfa)][_0x2d35e6(0xe1)](_0x2d35e6(0x123))),_0x336ad8=await this[_0x2d35e6(0x11e)](_0xcf2c85[0x0][_0x2d35e6(0xe2)]);await this['_saveLog'](_0x336ad8,'Validation\x20Log'),_0x17d05d[_0x2d35e6(0x10e)]=_0x1abbd4,_0x17d05d[_0x2d35e6(0x111)]=this[_0x2d35e6(0xff)](_0x308353),await this[_0x2d35e6(0x12a)](_0x17d05d);if(_0x4654d1!==status_enums_1[_0x2d35e6(0x12b)][_0x2d35e6(0xfc)])throw new Error(_0x2d35e6(0x138));return _0x17d05d;}else throw new veeva_error_1['VeevaError'](_0x460b12[_0x2d35e6(0x106)]);}async[a360_0x4b785f(0x136)](_0x1519a2,_0x198847){const _0x3fcecd=a360_0x4b785f;var _0x4efb4e;this[_0x3fcecd(0x104)][_0x3fcecd(0x119)](_0x3fcecd(0x129));const {data:_0xa8e3e0}=await this[_0x3fcecd(0xdb)][_0x3fcecd(0x114)](_0x1519a2);if(_0xa8e3e0[_0x3fcecd(0xec)]===status_enums_1[_0x3fcecd(0xdf)][_0x3fcecd(0x133)]){const {responseDetails:{deployment_log:_0x16aef5,package_status__v:_0x33b01d},package_steps:_0x65e3de}=_0xa8e3e0,_0x506732=_0x16aef5['filter'](_0x22342d=>_0x22342d[_0x3fcecd(0xfa)][_0x3fcecd(0xe1)](_0x3fcecd(0xf8))),_0x5f1530=await this['getLogResultText'](_0x506732[0x0][_0x3fcecd(0xe2)]);await this[_0x3fcecd(0x10d)](_0x5f1530,'Deploy\x20Log'),_0x198847['isDeployed']=[status_enums_1['VeevaPackageStatus']['DEPLOYED'],status_enums_1[_0x3fcecd(0x12b)][_0x3fcecd(0x117)]][_0x3fcecd(0xde)](_0x33b01d);const _0x3f42a8=array_utils_1['ArrayUtils'][_0x3fcecd(0x131)](this[_0x3fcecd(0xff)](_0x65e3de),({uniqueName:_0x106b5d})=>_0x106b5d);for(const _0x129dee of _0x198847['packageComponentList']){const _0x8298ba=(_0x4efb4e=_0x3f42a8[_0x3fcecd(0x114)](_0x129dee[_0x3fcecd(0xda)]))===null||_0x4efb4e===void 0x0?void 0x0:_0x4efb4e[_0x3fcecd(0x11f)];_0x8298ba&&(_0x129dee[_0x3fcecd(0x11f)]=_0x8298ba);}_0x198847[_0x3fcecd(0x111)]=_0x198847['packageComponentList']['filter'](_0x546a60=>_0x546a60[_0x3fcecd(0x11f)]!==status_enums_1[_0x3fcecd(0xe6)]['VERIFIED']);if(!_0x198847[_0x3fcecd(0x111)]['length'])throw new Error(_0x3fcecd(0xe0));return _0x198847;}else throw new veeva_error_1['VeevaError'](_0xa8e3e0[_0x3fcecd(0x106)]);}async[a360_0x4b785f(0x11e)](_0x28b02f){const _0x374c67=a360_0x4b785f,{data:_0x564df3}=await this['_connection'][_0x374c67(0x114)](_0x28b02f,{'responseType':'text'});return _0x564df3;}[a360_0x4b785f(0xff)](_0x40094a){const _0x19e18f=a360_0x4b785f;return _0x40094a[_0x19e18f(0x12c)]((_0x6244a3,_0x4bd273)=>{const _0x39589c=_0x19e18f,_0x4b05fc=_0x4bd273[_0x39589c(0xf6)][_0x39589c(0xfd)](_0x8a5d1f=>new package_component_dto_1[(_0x39589c(0x124))]({'status':_0x4bd273[_0x39589c(0x10f)],'stepName':_0x4bd273[_0x39589c(0x12d)],'component':_0x8a5d1f}));return[..._0x6244a3,..._0x4b05fc];},[]);}async[a360_0x4b785f(0x12a)](_0x3c02f9){const _0x132903=a360_0x4b785f,{data:_0x195f84}=await this[_0x132903(0xdb)][_0x132903(0x11d)](veeva_constants_1[_0x132903(0x11a)]['ENDPOINT_VALIDATE_PACKAGE'][_0x132903(0x107)](_0x132903(0x135),_0x3c02f9[_0x132903(0x10e)]));if(_0x195f84[_0x132903(0xec)]===status_enums_1[_0x132903(0xdf)][_0x132903(0x133)]){const {package_steps:_0x50ed0a}=_0x195f84[_0x132903(0x110)],_0x5b2658=array_utils_1['ArrayUtils']['groupToMap'](_0x3c02f9[_0x132903(0x111)],({stepName:_0x5dc16f})=>_0x5dc16f);for(const {name__v:_0x1ba28e,deployment_action:_0x22a9ca}of _0x50ed0a){for(const _0x756055 of _0x5b2658[_0x132903(0x114)](_0x1ba28e)||[]){_0x756055['deploymentAction']=package_component_dto_1[_0x132903(0x124)]['convertDeploymentAction'](_0x22a9ca);}}}else throw new veeva_error_1[(_0x132903(0x132))](_0x195f84[_0x132903(0x106)]);}async[a360_0x4b785f(0xea)](_0x283a99){const _0x34e2a2=a360_0x4b785f,_0x1dab62=await this[_0x34e2a2(0x120)](_0x283a99),_0x2377f1=await this[_0x34e2a2(0xeb)](_0x1dab62),_0x7711e=await this[_0x34e2a2(0x128)](_0x2377f1),_0x36ccb7=await this['deployPackage'](_0x7711e[_0x34e2a2(0x10e)]),_0x2b135a=await this[_0x34e2a2(0xeb)](_0x36ccb7);return this[_0x34e2a2(0x136)](_0x2b135a,_0x7711e);}}exports['PackageImportService']=PackageImportService;