const a404_0x1e84c8=a404_0xd2ac;(function(_0x33fe2b,_0x5a3c4d){const _0x42b6b8=a404_0xd2ac,_0x41efde=_0x33fe2b();while(!![]){try{const _0x595026=-parseInt(_0x42b6b8(0x1f6))/0x1*(parseInt(_0x42b6b8(0x20c))/0x2)+parseInt(_0x42b6b8(0x204))/0x3+-parseInt(_0x42b6b8(0x20f))/0x4+-parseInt(_0x42b6b8(0x224))/0x5+parseInt(_0x42b6b8(0x214))/0x6+-parseInt(_0x42b6b8(0x1ff))/0x7+parseInt(_0x42b6b8(0x243))/0x8;if(_0x595026===_0x5a3c4d)break;else _0x41efde['push'](_0x41efde['shift']());}catch(_0x3b6d29){_0x41efde['push'](_0x41efde['shift']());}}}(a404_0x28e5,0x7309f));const a404_0x57a69d=(function(){let _0xfcf92c=!![];return function(_0x237d42,_0x206150){const _0x285cb4=_0xfcf92c?function(){if(_0x206150){const _0x92f337=_0x206150['apply'](_0x237d42,arguments);return _0x206150=null,_0x92f337;}}:function(){};return _0xfcf92c=![],_0x285cb4;};}()),a404_0x1401ad=a404_0x57a69d(this,function(){const _0x551544=a404_0xd2ac;return a404_0x1401ad[_0x551544(0x220)]()[_0x551544(0x22f)](_0x551544(0x23f))['toString']()['constructor'](a404_0x1401ad)[_0x551544(0x22f)](_0x551544(0x23f));});a404_0x1401ad();'use strict';var __importDefault=this&&this[a404_0x1e84c8(0x1fd)]||function(_0x35bb68){return _0x35bb68&&_0x35bb68['__esModule']?_0x35bb68:{'default':_0x35bb68};};Object[a404_0x1e84c8(0x218)](exports,a404_0x1e84c8(0x1fe),{'value':!![]}),exports[a404_0x1e84c8(0x212)]=void 0x0;const veeva_constants_1=require(a404_0x1e84c8(0x221)),status_enums_1=require(a404_0x1e84c8(0x234)),veeva_error_1=require(a404_0x1e84c8(0x229)),form_data_1=__importDefault(require(a404_0x1e84c8(0x21f))),fs_1=require('fs'),veeva_auth_utils_1=require(a404_0x1e84c8(0x215)),package_details_dto_1=require('../dtos/package-details.dto'),package_component_dto_1=require('../dtos/package-component.dto'),array_utils_1=require(a404_0x1e84c8(0x245));function a404_0xd2ac(_0x3d25b7,_0x1050bb){const _0x95bc5a=a404_0x28e5();return a404_0xd2ac=function(_0x1401ad,_0x57a69d){_0x1401ad=_0x1401ad-0x1f2;let _0x28e537=_0x95bc5a[_0x1401ad];return _0x28e537;},a404_0xd2ac(_0x3d25b7,_0x1050bb);}class PackageImportService{constructor({veevaService:_0x62a284,connection:_0xe624e,logger:_0x4aa41b,saveLog:_0x1654db}){const _0x57b556=a404_0x1e84c8;this[_0x57b556(0x217)]=_0x62a284,this[_0x57b556(0x1f5)]=_0xe624e,this[_0x57b556(0x1f7)]=_0x4aa41b,this[_0x57b556(0x1f8)]=_0x1654db;}async[a404_0x1e84c8(0x209)](_0x31ca58,_0xb0450e=0x1){const _0x57930f=a404_0x1e84c8;this[_0x57930f(0x1f7)][_0x57930f(0x20e)](_0x57930f(0x20d));const _0x2dbab8=new form_data_1['default']();_0x2dbab8['append'](_0x57930f(0x1f3),(0x0,fs_1[_0x57930f(0x1fa)])(_0x31ca58));const _0x5c7c2d=await this['_connection']['put'](veeva_constants_1[_0x57930f(0x236)][_0x57930f(0x216)],_0x2dbab8,{'headers':{'Content-Type':'multipart/form-data'}}),_0x9e3a29=_0x5c7c2d['data'];if(_0x9e3a29['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x57930f(0x226)])return _0x9e3a29[_0x57930f(0x228)];else{if(_0xb0450e>0x0)return await(0x0,veeva_auth_utils_1[_0x57930f(0x20a)])(this['_connection']),await this['importVpk'](_0x31ca58,_0xb0450e-0x1);throw new veeva_error_1['VeevaError'](_0x9e3a29['errors']);}}async[a404_0x1e84c8(0x213)](_0x205f34){const _0x1b1ce0=a404_0x1e84c8;this['_logger'][_0x1b1ce0(0x20e)](_0x1b1ce0(0x205));const _0x5d2d75=await this[_0x1b1ce0(0x1f5)][_0x1b1ce0(0x208)](veeva_constants_1['VeevaConstants'][_0x1b1ce0(0x24b)][_0x1b1ce0(0x206)](_0x1b1ce0(0x1f4),_0x205f34)),_0x356f3d=await _0x5d2d75[_0x1b1ce0(0x237)];if(_0x356f3d['responseStatus']===status_enums_1[_0x1b1ce0(0x222)][_0x1b1ce0(0x226)])return _0x356f3d[_0x1b1ce0(0x228)];else throw new veeva_error_1[(_0x1b1ce0(0x210))](_0x356f3d[_0x1b1ce0(0x207)]);}async[a404_0x1e84c8(0x225)](_0x2e5eb6){const _0x344810=a404_0x1e84c8;this['_logger']['log'](_0x344810(0x203));const [_0x1783dd]=await this[_0x344810(0x217)][_0x344810(0x23b)]([_0x2e5eb6]);return _0x1783dd['links'][_0x344810(0x223)](_0x1fed59=>_0x1fed59[_0x344810(0x22d)]===_0x344810(0x249))[_0x344810(0x1fc)];}async[a404_0x1e84c8(0x22e)](_0x2b219b){const _0x40e33b=a404_0x1e84c8;this[_0x40e33b(0x1f7)][_0x40e33b(0x20e)]('Get\x20validation\x20details.');const {data:_0x544c34}=await this['_connection']['get'](_0x2b219b);if(_0x544c34['responseStatus']===status_enums_1[_0x40e33b(0x222)]['SUCCESS']){const _0x3668ac=new package_details_dto_1['PackageDetailsDto'](),{log:_0x206938,id:_0x40fbda,package_status:_0x520af7,package_steps:_0x415dd3}=_0x544c34[_0x40e33b(0x201)],_0x290729=_0x206938[_0x40e33b(0x20b)](_0x5c2280=>_0x5c2280[_0x40e33b(0x247)]['endsWith'](_0x40e33b(0x240))),_0x5cc315=await this[_0x40e33b(0x241)](_0x290729[0x0][_0x40e33b(0x228)]);await this['_saveLog'](_0x5cc315,_0x40e33b(0x219)),_0x3668ac[_0x40e33b(0x232)]=_0x40fbda,_0x3668ac[_0x40e33b(0x23c)]=this['formPackageComponentList'](_0x415dd3),await this[_0x40e33b(0x1f2)](_0x3668ac);if(_0x520af7!==status_enums_1['VeevaPackageStatus'][_0x40e33b(0x235)])throw new Error('Package\x20not\x20verified');return _0x3668ac;}else throw new veeva_error_1[(_0x40e33b(0x210))](_0x544c34['errors']);}async['getDeployDetailsAndSaveLog'](_0x459fd5,_0x22175c){const _0x528cbe=a404_0x1e84c8;var _0x27be40;this['_logger']['log']('Get\x20deploy\x20result');const {data:_0x4294c8}=await this[_0x528cbe(0x1f5)]['get'](_0x459fd5);if(_0x4294c8[_0x528cbe(0x242)]===status_enums_1[_0x528cbe(0x222)][_0x528cbe(0x226)]){const {responseDetails:{deployment_log:_0x1a6ba0,package_status__v:_0x5d0015},package_steps:_0x4b3d14}=_0x4294c8,_0x407d33=_0x1a6ba0[_0x528cbe(0x20b)](_0x4727fa=>_0x4727fa['filename'][_0x528cbe(0x230)](_0x528cbe(0x1f9))),_0x4e010=await this[_0x528cbe(0x241)](_0x407d33[0x0]['url']);await this[_0x528cbe(0x1f8)](_0x4e010,'Deploy\x20Log'),_0x22175c[_0x528cbe(0x21d)]=[status_enums_1[_0x528cbe(0x21c)][_0x528cbe(0x227)],status_enums_1['VeevaPackageStatus'][_0x528cbe(0x21e)]][_0x528cbe(0x200)](_0x5d0015);const _0x91f511=array_utils_1[_0x528cbe(0x231)][_0x528cbe(0x233)](this[_0x528cbe(0x24a)](_0x4b3d14),({uniqueName:_0x314cd0})=>_0x314cd0);for(const _0x207263 of _0x22175c[_0x528cbe(0x23c)]){const _0x149a32=(_0x27be40=_0x91f511[_0x528cbe(0x23e)](_0x207263[_0x528cbe(0x238)]))===null||_0x27be40===void 0x0?void 0x0:_0x27be40[_0x528cbe(0x244)];_0x149a32&&(_0x207263[_0x528cbe(0x244)]=_0x149a32);}_0x22175c['packageComponentList']=_0x22175c[_0x528cbe(0x23c)][_0x528cbe(0x20b)](_0x1dcba5=>_0x1dcba5[_0x528cbe(0x244)]!==status_enums_1['PackageComponentStatus']['VERIFIED']);if(!_0x22175c[_0x528cbe(0x23c)][_0x528cbe(0x22c)])throw new Error(_0x528cbe(0x23a));return _0x22175c;}else throw new veeva_error_1['VeevaError'](_0x4294c8[_0x528cbe(0x207)]);}async[a404_0x1e84c8(0x241)](_0x15ccca){const _0x910a3a=a404_0x1e84c8,{data:_0x136087}=await this[_0x910a3a(0x1f5)]['get'](_0x15ccca,{'responseType':'text'});return _0x136087;}[a404_0x1e84c8(0x24a)](_0x1c003b){const _0x3edcb9=a404_0x1e84c8;return _0x1c003b[_0x3edcb9(0x246)]((_0x12e9c3,_0x3e5853)=>{const _0x2342a9=_0x3edcb9,_0x51f06c=_0x3e5853[_0x2342a9(0x22b)][_0x2342a9(0x248)](_0x3db874=>new package_component_dto_1[(_0x2342a9(0x202))]({'status':_0x3e5853['deployment_status__v'],'stepName':_0x3e5853[_0x2342a9(0x21b)],'component':_0x3db874}));return[..._0x12e9c3,..._0x51f06c];},[]);}async[a404_0x1e84c8(0x1f2)](_0x2e2109){const _0x3aa2a5=a404_0x1e84c8,{data:_0x4f905d}=await this['_connection'][_0x3aa2a5(0x208)](veeva_constants_1[_0x3aa2a5(0x236)][_0x3aa2a5(0x21a)][_0x3aa2a5(0x206)](_0x3aa2a5(0x1f4),_0x2e2109[_0x3aa2a5(0x232)]));if(_0x4f905d[_0x3aa2a5(0x242)]===status_enums_1[_0x3aa2a5(0x222)][_0x3aa2a5(0x226)]){const {package_steps:_0x40c774}=_0x4f905d[_0x3aa2a5(0x1fb)],_0x1c81bd=array_utils_1['ArrayUtils'][_0x3aa2a5(0x239)](_0x2e2109[_0x3aa2a5(0x23c)],({stepName:_0x58859})=>_0x58859);for(const {name__v:_0x44dd9a,deployment_action:_0x30f97f}of _0x40c774){for(const _0x320278 of _0x1c81bd[_0x3aa2a5(0x23e)](_0x44dd9a)||[]){_0x320278['deploymentAction']=package_component_dto_1['PackageComponentDto'][_0x3aa2a5(0x22a)](_0x30f97f);}}}else throw new veeva_error_1[(_0x3aa2a5(0x210))](_0x4f905d['errors']);}async[a404_0x1e84c8(0x23d)](_0xaad924){const _0x54da6a=a404_0x1e84c8,_0x225225=await this['importVpk'](_0xaad924),_0x44199c=await this['getJobDetailUrl'](_0x225225),_0xcca429=await this[_0x54da6a(0x22e)](_0x44199c),_0x496361=await this['deployPackage'](_0xcca429[_0x54da6a(0x232)]),_0x1ed742=await this['getJobDetailUrl'](_0x496361);return this[_0x54da6a(0x211)](_0x1ed742,_0xcca429);}}exports[a404_0x1e84c8(0x212)]=PackageImportService;function a404_0x28e5(){const _0x30279f=['responseDetails','href','__importDefault','__esModule','4861283mqCwnt','includes','vaultPackage','PackageComponentDto','Wait\x20Executing\x20job','1655916VSqLHP','Deploy\x20package','replace','errors','post','importVpk','updateVeevaConnection','filter','36TBzVWi','Import\x20package','log','2416136HUbQZs','VeevaError','getDeployDetailsAndSaveLog','PackageImportService','deployPackage','2003652DOLpJU','../utils/veeva-auth.utils','ENDPOINT_EXPORT_IMPORT_PACKAGE','_veevaService','defineProperty','Validation\x20Log','ENDPOINT_VALIDATE_PACKAGE','name__v','VeevaPackageStatus','isDeployed','DEPLOYED_WITH_WARNINGS','form-data','toString','../constants/veeva.constants','VeevaResponseStatus','find','4483170EubcEm','getJobDetailUrl','SUCCESS','DEPLOYED','url','../classes/errors/veeva-error','convertDeploymentAction','package_components','length','rel','getValidationDetailsAndSaveLog','search','endsWith','ArrayUtils','packageId','groupUniqueToMap','../enums/status.enums','VERIFIED','VeevaConstants','data','uniqueName','groupToMap','Cannot\x20find\x20deployment\x20results','getJobResult','packageComponentList','import','get','(((.+)+)+)+$','Validation.log','getLogResultText','responseStatus','19738848ufKRFk','status','../utils/array.utils','reduce','filename','map','artifacts','formPackageComponentList','ENDPOINT_DEPLOY_PACKAGE','fillPackageDeploymentAction','file','{package_id}','_connection','38163VtvYzH','_logger','_saveLog','Deployment.log','createReadStream'];a404_0x28e5=function(){return _0x30279f;};return a404_0x28e5();}