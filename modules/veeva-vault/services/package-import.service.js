const a392_0x495b8e=a392_0x3c45;(function(_0x1dd2c9,_0x2ea03b){const _0x41cd97=a392_0x3c45,_0x4c347c=_0x1dd2c9();while(!![]){try{const _0x48dc00=-parseInt(_0x41cd97(0x18a))/0x1+parseInt(_0x41cd97(0x190))/0x2*(parseInt(_0x41cd97(0x19b))/0x3)+-parseInt(_0x41cd97(0x181))/0x4*(-parseInt(_0x41cd97(0x169))/0x5)+parseInt(_0x41cd97(0x17b))/0x6*(-parseInt(_0x41cd97(0x1a8))/0x7)+-parseInt(_0x41cd97(0x17e))/0x8+parseInt(_0x41cd97(0x1a9))/0x9+parseInt(_0x41cd97(0x1aa))/0xa;if(_0x48dc00===_0x2ea03b)break;else _0x4c347c['push'](_0x4c347c['shift']());}catch(_0x3f3bf0){_0x4c347c['push'](_0x4c347c['shift']());}}}(a392_0x244c,0x6a666));const a392_0x5e6548=(function(){let _0x5da920=!![];return function(_0x449624,_0x466b40){const _0x2ee69d=_0x5da920?function(){const _0x246060=a392_0x3c45;if(_0x466b40){const _0x1fbc6c=_0x466b40[_0x246060(0x1b4)](_0x449624,arguments);return _0x466b40=null,_0x1fbc6c;}}:function(){};return _0x5da920=![],_0x2ee69d;};}()),a392_0x56237b=a392_0x5e6548(this,function(){const _0x1c12d8=a392_0x3c45;return a392_0x56237b[_0x1c12d8(0x176)]()['search'](_0x1c12d8(0x158))[_0x1c12d8(0x176)]()['constructor'](a392_0x56237b)[_0x1c12d8(0x166)](_0x1c12d8(0x158));});a392_0x56237b();'use strict';function a392_0x244c(){const _0x53908d=['length','SUCCESS','VeevaError','getJobResult','formPackageComponentList','groupToMap','filename','apply','{package_id}','VERIFIED','Cannot\x20find\x20deployment\x20results','../utils/array.utils','includes','status','(((.+)+)+)+$','file','find','defineProperty','rel','PackageDetailsDto','package_components','fillPackageDeploymentAction','url','form-data','put','packageComponentList','getJobDetailUrl','getDeployDetailsAndSaveLog','search','import','map','15pBLCBU','VeevaResponseStatus','href','Deployment.log','PackageImportService','multipart/form-data','../dtos/package-details.dto','Deploy\x20package','reduce','../enums/status.enums','endsWith','_saveLog','ENDPOINT_VALIDATE_PACKAGE','toString','data','ENDPOINT_EXPORT_IMPORT_PACKAGE','Import\x20package','log','2811678yTOyfS','filter','default','4136072eLkYiu','groupUniqueToMap','VeevaPackageStatus','974076nsvwgv','createReadStream','_logger','_connection','links','getValidationDetailsAndSaveLog','__importDefault','Validation\x20Log','Package\x20not\x20verified','703796iqUlZv','../classes/errors/veeva-error','Get\x20validation\x20details.','get','post','packageId','6hcTayh','updateVeevaConnection','errors','getLogResultText','responseStatus','importVpk','responseDetails','vaultPackage','ArrayUtils','VeevaConstants','text','659511wewEcT','replace','PackageComponentDto','ENDPOINT_DEPLOY_PACKAGE','uniqueName','deployPackage','Wait\x20Executing\x20job','DEPLOYED','append','PackageComponentStatus','deploymentAction','Deploy\x20Log','Get\x20deploy\x20result','7qwKTmr','2228931blbKyD','4875050WhpwWs','name__v','__esModule'];a392_0x244c=function(){return _0x53908d;};return a392_0x244c();}function a392_0x3c45(_0x3f0bbe,_0x352086){const _0x46d764=a392_0x244c();return a392_0x3c45=function(_0x56237b,_0x5e6548){_0x56237b=_0x56237b-0x153;let _0x244c2a=_0x46d764[_0x56237b];return _0x244c2a;},a392_0x3c45(_0x3f0bbe,_0x352086);}var __importDefault=this&&this[a392_0x495b8e(0x187)]||function(_0x1bdc85){const _0xa104c5=a392_0x495b8e;return _0x1bdc85&&_0x1bdc85[_0xa104c5(0x1ac)]?_0x1bdc85:{'default':_0x1bdc85};};Object[a392_0x495b8e(0x15b)](exports,'__esModule',{'value':!![]}),exports[a392_0x495b8e(0x16d)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),status_enums_1=require(a392_0x495b8e(0x172)),veeva_error_1=require(a392_0x495b8e(0x18b)),form_data_1=__importDefault(require(a392_0x495b8e(0x161))),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require(a392_0x495b8e(0x16f)),package_component_dto_1=require('../dtos/package-component.dto'),array_utils_1=require(a392_0x495b8e(0x155));class PackageImportService{constructor({veevaService:_0xbd0d10,connection:_0x55cadf,logger:_0x514685,saveLog:_0x5586bf}){const _0x3a49bc=a392_0x495b8e;this['_veevaService']=_0xbd0d10,this['_connection']=_0x55cadf,this[_0x3a49bc(0x183)]=_0x514685,this[_0x3a49bc(0x174)]=_0x5586bf;}async[a392_0x495b8e(0x195)](_0x55fb08,_0xfbace6=0x1){const _0x325151=a392_0x495b8e;this[_0x325151(0x183)]['log'](_0x325151(0x179));const _0x382c99=new form_data_1[(_0x325151(0x17d))]();_0x382c99[_0x325151(0x1a3)](_0x325151(0x159),(0x0,fs_1[_0x325151(0x182)])(_0x55fb08));const _0x3dfecb=await this[_0x325151(0x184)][_0x325151(0x162)](veeva_constants_1[_0x325151(0x199)][_0x325151(0x178)],_0x382c99,{'headers':{'Content-Type':_0x325151(0x16e)}}),_0x1c54ba=_0x3dfecb[_0x325151(0x177)];if(_0x1c54ba[_0x325151(0x194)]===status_enums_1[_0x325151(0x16a)][_0x325151(0x1ae)])return _0x1c54ba[_0x325151(0x160)];else{if(_0xfbace6>0x0)return await(0x0,veeva_auth_utils_1[_0x325151(0x191)])(this[_0x325151(0x184)]),await this[_0x325151(0x195)](_0x55fb08,_0xfbace6-0x1);throw new veeva_error_1[(_0x325151(0x1af))](_0x1c54ba[_0x325151(0x192)]);}}async[a392_0x495b8e(0x1a0)](_0x1d55a5){const _0x1acbcc=a392_0x495b8e;this[_0x1acbcc(0x183)][_0x1acbcc(0x17a)](_0x1acbcc(0x170));const _0x5c6b06=await this[_0x1acbcc(0x184)]['post'](veeva_constants_1[_0x1acbcc(0x199)][_0x1acbcc(0x19e)][_0x1acbcc(0x19c)](_0x1acbcc(0x1b5),_0x1d55a5)),_0x2148ee=await _0x5c6b06['data'];if(_0x2148ee[_0x1acbcc(0x194)]===status_enums_1['VeevaResponseStatus'][_0x1acbcc(0x1ae)])return _0x2148ee[_0x1acbcc(0x160)];else throw new veeva_error_1[(_0x1acbcc(0x1af))](_0x2148ee[_0x1acbcc(0x192)]);}async[a392_0x495b8e(0x164)](_0xeed5c1){const _0x1086bf=a392_0x495b8e;this['_logger'][_0x1086bf(0x17a)](_0x1086bf(0x1a1));const [_0x416d1b]=await this['_veevaService'][_0x1086bf(0x1b0)]([_0xeed5c1]);return _0x416d1b[_0x1086bf(0x185)][_0x1086bf(0x15a)](_0x3cc595=>_0x3cc595[_0x1086bf(0x15c)]==='artifacts')[_0x1086bf(0x16b)];}async['getValidationDetailsAndSaveLog'](_0x52bda6){const _0x4bcb03=a392_0x495b8e;this['_logger'][_0x4bcb03(0x17a)](_0x4bcb03(0x18c));const {data:_0x28baa5}=await this['_connection'][_0x4bcb03(0x18d)](_0x52bda6);if(_0x28baa5[_0x4bcb03(0x194)]===status_enums_1[_0x4bcb03(0x16a)][_0x4bcb03(0x1ae)]){const _0x1e6b45=new package_details_dto_1[(_0x4bcb03(0x15d))](),{log:_0xb6c32f,id:_0x1d9aea,package_status:_0x52a221,package_steps:_0x74a01e}=_0x28baa5[_0x4bcb03(0x197)],_0x58aecc=_0xb6c32f[_0x4bcb03(0x17c)](_0x4a6e58=>_0x4a6e58[_0x4bcb03(0x1b3)][_0x4bcb03(0x173)]('Validation.log')),_0x1ded99=await this[_0x4bcb03(0x193)](_0x58aecc[0x0]['url']);await this[_0x4bcb03(0x174)](_0x1ded99,_0x4bcb03(0x188)),_0x1e6b45[_0x4bcb03(0x18f)]=_0x1d9aea,_0x1e6b45[_0x4bcb03(0x163)]=this[_0x4bcb03(0x1b1)](_0x74a01e),await this[_0x4bcb03(0x15f)](_0x1e6b45);if(_0x52a221!==status_enums_1['VeevaPackageStatus'][_0x4bcb03(0x153)])throw new Error(_0x4bcb03(0x189));return _0x1e6b45;}else throw new veeva_error_1['VeevaError'](_0x28baa5['errors']);}async[a392_0x495b8e(0x165)](_0x4a19ef,_0x265277){const _0x560a6a=a392_0x495b8e;var _0x44e7;this[_0x560a6a(0x183)][_0x560a6a(0x17a)](_0x560a6a(0x1a7));const {data:_0x200338}=await this['_connection'][_0x560a6a(0x18d)](_0x4a19ef);if(_0x200338['responseStatus']===status_enums_1[_0x560a6a(0x16a)][_0x560a6a(0x1ae)]){const {responseDetails:{deployment_log:_0x55e825,package_status__v:_0x52de86},package_steps:_0x5a73ea}=_0x200338,_0x14c99b=_0x55e825[_0x560a6a(0x17c)](_0x31b24e=>_0x31b24e[_0x560a6a(0x1b3)]['endsWith'](_0x560a6a(0x16c))),_0x12755a=await this[_0x560a6a(0x193)](_0x14c99b[0x0]['url']);await this[_0x560a6a(0x174)](_0x12755a,_0x560a6a(0x1a6)),_0x265277['isDeployed']=[status_enums_1['VeevaPackageStatus'][_0x560a6a(0x1a2)],status_enums_1[_0x560a6a(0x180)]['DEPLOYED_WITH_WARNINGS']][_0x560a6a(0x156)](_0x52de86);const _0x2cbff7=array_utils_1[_0x560a6a(0x198)][_0x560a6a(0x17f)](this[_0x560a6a(0x1b1)](_0x5a73ea),({uniqueName:_0x146dda})=>_0x146dda);for(const _0x3dce02 of _0x265277[_0x560a6a(0x163)]){const _0xd65a7e=(_0x44e7=_0x2cbff7[_0x560a6a(0x18d)](_0x3dce02[_0x560a6a(0x19f)]))===null||_0x44e7===void 0x0?void 0x0:_0x44e7[_0x560a6a(0x157)];_0xd65a7e&&(_0x3dce02[_0x560a6a(0x157)]=_0xd65a7e);}_0x265277['packageComponentList']=_0x265277['packageComponentList'][_0x560a6a(0x17c)](_0x41816c=>_0x41816c[_0x560a6a(0x157)]!==status_enums_1[_0x560a6a(0x1a4)][_0x560a6a(0x153)]);if(!_0x265277['packageComponentList'][_0x560a6a(0x1ad)])throw new Error(_0x560a6a(0x154));return _0x265277;}else throw new veeva_error_1[(_0x560a6a(0x1af))](_0x200338['errors']);}async[a392_0x495b8e(0x193)](_0x2747a2){const _0x409452=a392_0x495b8e,{data:_0x4b7095}=await this[_0x409452(0x184)]['get'](_0x2747a2,{'responseType':_0x409452(0x19a)});return _0x4b7095;}[a392_0x495b8e(0x1b1)](_0x1a9ab0){const _0x47c739=a392_0x495b8e;return _0x1a9ab0[_0x47c739(0x171)]((_0x5c7366,_0x578b4a)=>{const _0x1546ff=_0x47c739,_0x2cae1f=_0x578b4a[_0x1546ff(0x15e)][_0x1546ff(0x168)](_0x31d6df=>new package_component_dto_1[(_0x1546ff(0x19d))]({'status':_0x578b4a['deployment_status__v'],'stepName':_0x578b4a[_0x1546ff(0x1ab)],'component':_0x31d6df}));return[..._0x5c7366,..._0x2cae1f];},[]);}async[a392_0x495b8e(0x15f)](_0x3ef9d7){const _0x4785fb=a392_0x495b8e,{data:_0x505160}=await this['_connection'][_0x4785fb(0x18e)](veeva_constants_1[_0x4785fb(0x199)][_0x4785fb(0x175)][_0x4785fb(0x19c)]('{package_id}',_0x3ef9d7[_0x4785fb(0x18f)]));if(_0x505160[_0x4785fb(0x194)]===status_enums_1[_0x4785fb(0x16a)][_0x4785fb(0x1ae)]){const {package_steps:_0x43dec2}=_0x505160[_0x4785fb(0x196)],_0x420b51=array_utils_1['ArrayUtils'][_0x4785fb(0x1b2)](_0x3ef9d7[_0x4785fb(0x163)],({stepName:_0x48c9d8})=>_0x48c9d8);for(const {name__v:_0x9b64b9,deployment_action:_0x576665}of _0x43dec2){for(const _0xb57698 of _0x420b51[_0x4785fb(0x18d)](_0x9b64b9)||[]){_0xb57698[_0x4785fb(0x1a5)]=package_component_dto_1['PackageComponentDto']['convertDeploymentAction'](_0x576665);}}}else throw new veeva_error_1[(_0x4785fb(0x1af))](_0x505160[_0x4785fb(0x192)]);}async[a392_0x495b8e(0x167)](_0x442133){const _0x375d32=a392_0x495b8e,_0x5920b4=await this[_0x375d32(0x195)](_0x442133),_0x57a11e=await this[_0x375d32(0x164)](_0x5920b4),_0x474215=await this[_0x375d32(0x186)](_0x57a11e),_0x248e42=await this[_0x375d32(0x1a0)](_0x474215[_0x375d32(0x18f)]),_0x5835fe=await this[_0x375d32(0x164)](_0x248e42);return this[_0x375d32(0x165)](_0x5835fe,_0x474215);}}exports['PackageImportService']=PackageImportService;