function a376_0x2814(){const _0x2a9093=['Cannot\x20find\x20deployment\x20results','Deploy\x20package','importVpk','packageComponentList','VeevaResponseStatus','ENDPOINT_VALIDATE_PACKAGE','fillPackageDeploymentAction','deploymentAction','getLogResultText','replace','url','VeevaConstants','errors','deployment_status__v','getValidationDetailsAndSaveLog','find','formPackageComponentList','deployPackage','DEPLOYED','(((.+)+)+)+$','_logger','../dtos/package-component.dto','1785qQyyhI','VeevaError','default','PackageComponentDto','Package\x20not\x20verified','toString','rel','get','PackageComponentStatus','responseDetails','log','Get\x20deploy\x20result','form-data','text','ArrayUtils','Validation.log','isDeployed','endsWith','Deployment.log','_saveLog','5303045aRZNvK','4TSncNI','artifacts','ENDPOINT_DEPLOY_PACKAGE','post','{package_id}','filename','getDeployDetailsAndSaveLog','responseStatus','_veevaService','convertDeploymentAction','groupToMap','multipart/form-data','../classes/errors/veeva-error','3535512oRqyxL','2915280lAmgpU','1wlNcwK','groupUniqueToMap','_connection','links','VeevaPackageStatus','9860210IShpDR','status','updateVeevaConnection','../enums/status.enums','data','118056gBbZWM','getJobDetailUrl','append','14634DXkzEN','name__v','Wait\x20Executing\x20job','Validation\x20Log','../dtos/package-details.dto','Import\x20package','search','constructor','__importDefault','1152674tTKbgz','reduce','__esModule','Deploy\x20Log','SUCCESS','getJobResult','packageId','uniqueName','../utils/veeva-auth.utils','filter','Get\x20validation\x20details.'];a376_0x2814=function(){return _0x2a9093;};return a376_0x2814();}const a376_0x14938d=a376_0x3d3a;(function(_0x3da831,_0xd46fdc){const _0x1b75b3=a376_0x3d3a,_0x491035=_0x3da831();while(!![]){try{const _0x4de5a4=-parseInt(_0x1b75b3(0x1d4))/0x1*(-parseInt(_0x1b75b3(0x18f))/0x2)+parseInt(_0x1b75b3(0x1de))/0x3+-parseInt(_0x1b75b3(0x1c5))/0x4*(-parseInt(_0x1b75b3(0x1c4))/0x5)+parseInt(_0x1b75b3(0x1e1))/0x6*(parseInt(_0x1b75b3(0x1b0))/0x7)+-parseInt(_0x1b75b3(0x1d2))/0x8+-parseInt(_0x1b75b3(0x1d3))/0x9+-parseInt(_0x1b75b3(0x1d9))/0xa;if(_0x4de5a4===_0xd46fdc)break;else _0x491035['push'](_0x491035['shift']());}catch(_0x2c7c02){_0x491035['push'](_0x491035['shift']());}}}(a376_0x2814,0x8563b));const a376_0x579913=(function(){let _0x28097d=!![];return function(_0x1fa34b,_0xe82855){const _0x20d3c3=_0x28097d?function(){if(_0xe82855){const _0x228c35=_0xe82855['apply'](_0x1fa34b,arguments);return _0xe82855=null,_0x228c35;}}:function(){};return _0x28097d=![],_0x20d3c3;};}()),a376_0x55459c=a376_0x579913(this,function(){const _0x33018c=a376_0x3d3a;return a376_0x55459c[_0x33018c(0x1b5)]()['search'](_0x33018c(0x1ad))[_0x33018c(0x1b5)]()[_0x33018c(0x18d)](a376_0x55459c)[_0x33018c(0x18c)](_0x33018c(0x1ad));});a376_0x55459c();'use strict';var __importDefault=this&&this[a376_0x14938d(0x18e)]||function(_0x4c28e2){const _0x2669a1=a376_0x14938d;return _0x4c28e2&&_0x4c28e2[_0x2669a1(0x191)]?_0x4c28e2:{'default':_0x4c28e2};};Object['defineProperty'](exports,a376_0x14938d(0x191),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),status_enums_1=require(a376_0x14938d(0x1dc)),veeva_error_1=require(a376_0x14938d(0x1d1)),form_data_1=__importDefault(require(a376_0x14938d(0x1bc))),fs_1=require('fs'),veeva_auth_utils_1=require(a376_0x14938d(0x197)),package_details_dto_1=require(a376_0x14938d(0x18a)),package_component_dto_1=require(a376_0x14938d(0x1af)),array_utils_1=require('../utils/array.utils');class PackageImportService{constructor({veevaService:_0x52191e,connection:_0x160a03,logger:_0x5d3047,saveLog:_0x2082f4}){const _0xbc382d=a376_0x14938d;this[_0xbc382d(0x1cd)]=_0x52191e,this[_0xbc382d(0x1d6)]=_0x160a03,this['_logger']=_0x5d3047,this[_0xbc382d(0x1c3)]=_0x2082f4;}async[a376_0x14938d(0x19c)](_0x4a3591,_0xe216a2=0x1){const _0x3d6a3a=a376_0x14938d;this[_0x3d6a3a(0x1ae)][_0x3d6a3a(0x1ba)](_0x3d6a3a(0x18b));const _0x33bdc5=new form_data_1[(_0x3d6a3a(0x1b2))]();_0x33bdc5[_0x3d6a3a(0x1e0)]('file',(0x0,fs_1['createReadStream'])(_0x4a3591));const _0x541d06=await this['_connection']['put'](veeva_constants_1[_0x3d6a3a(0x1a5)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x33bdc5,{'headers':{'Content-Type':_0x3d6a3a(0x1d0)}}),_0x2eb354=_0x541d06[_0x3d6a3a(0x1dd)];if(_0x2eb354[_0x3d6a3a(0x1cc)]===status_enums_1[_0x3d6a3a(0x19e)]['SUCCESS'])return _0x2eb354['url'];else{if(_0xe216a2>0x0)return await(0x0,veeva_auth_utils_1[_0x3d6a3a(0x1db)])(this[_0x3d6a3a(0x1d6)]),await this[_0x3d6a3a(0x19c)](_0x4a3591,_0xe216a2-0x1);throw new veeva_error_1[(_0x3d6a3a(0x1b1))](_0x2eb354[_0x3d6a3a(0x1a6)]);}}async[a376_0x14938d(0x1ab)](_0x44f847){const _0x497659=a376_0x14938d;this[_0x497659(0x1ae)][_0x497659(0x1ba)](_0x497659(0x19b));const _0x51b6f1=await this['_connection'][_0x497659(0x1c8)](veeva_constants_1[_0x497659(0x1a5)][_0x497659(0x1c7)][_0x497659(0x1a3)](_0x497659(0x1c9),_0x44f847)),_0x4b7582=await _0x51b6f1[_0x497659(0x1dd)];if(_0x4b7582[_0x497659(0x1cc)]===status_enums_1['VeevaResponseStatus'][_0x497659(0x193)])return _0x4b7582[_0x497659(0x1a4)];else throw new veeva_error_1['VeevaError'](_0x4b7582['errors']);}async[a376_0x14938d(0x1df)](_0x3970bf){const _0x57c569=a376_0x14938d;this[_0x57c569(0x1ae)][_0x57c569(0x1ba)](_0x57c569(0x188));const [_0x45fa05]=await this['_veevaService'][_0x57c569(0x194)]([_0x3970bf]);return _0x45fa05[_0x57c569(0x1d7)][_0x57c569(0x1a9)](_0xe2fe58=>_0xe2fe58[_0x57c569(0x1b6)]===_0x57c569(0x1c6))['href'];}async[a376_0x14938d(0x1a8)](_0x13f0a7){const _0x1d2c27=a376_0x14938d;this[_0x1d2c27(0x1ae)][_0x1d2c27(0x1ba)](_0x1d2c27(0x199));const {data:_0x4962e9}=await this[_0x1d2c27(0x1d6)]['get'](_0x13f0a7);if(_0x4962e9[_0x1d2c27(0x1cc)]===status_enums_1[_0x1d2c27(0x19e)][_0x1d2c27(0x193)]){const _0x377306=new package_details_dto_1['PackageDetailsDto'](),{log:_0x334e99,id:_0x164aca,package_status:_0x421be8,package_steps:_0x1b2ac7}=_0x4962e9['vaultPackage'],_0x35a7b2=_0x334e99[_0x1d2c27(0x198)](_0x2f0b7d=>_0x2f0b7d['filename'][_0x1d2c27(0x1c1)](_0x1d2c27(0x1bf))),_0xdbd911=await this[_0x1d2c27(0x1a2)](_0x35a7b2[0x0]['url']);await this[_0x1d2c27(0x1c3)](_0xdbd911,_0x1d2c27(0x189)),_0x377306[_0x1d2c27(0x195)]=_0x164aca,_0x377306[_0x1d2c27(0x19d)]=this[_0x1d2c27(0x1aa)](_0x1b2ac7),await this[_0x1d2c27(0x1a0)](_0x377306);if(_0x421be8!==status_enums_1[_0x1d2c27(0x1d8)]['VERIFIED'])throw new Error(_0x1d2c27(0x1b4));return _0x377306;}else throw new veeva_error_1[(_0x1d2c27(0x1b1))](_0x4962e9[_0x1d2c27(0x1a6)]);}async[a376_0x14938d(0x1cb)](_0x42d592,_0x5ef8ea){const _0x340a5c=a376_0x14938d;var _0x72931b;this[_0x340a5c(0x1ae)]['log'](_0x340a5c(0x1bb));const {data:_0x4fa8c7}=await this[_0x340a5c(0x1d6)]['get'](_0x42d592);if(_0x4fa8c7['responseStatus']===status_enums_1[_0x340a5c(0x19e)][_0x340a5c(0x193)]){const {responseDetails:{deployment_log:_0x826765,package_status__v:_0x1ebf8d},package_steps:_0x16c57c}=_0x4fa8c7,_0x3400c8=_0x826765[_0x340a5c(0x198)](_0x880d42=>_0x880d42[_0x340a5c(0x1ca)]['endsWith'](_0x340a5c(0x1c2))),_0x56b319=await this[_0x340a5c(0x1a2)](_0x3400c8[0x0][_0x340a5c(0x1a4)]);await this[_0x340a5c(0x1c3)](_0x56b319,_0x340a5c(0x192)),_0x5ef8ea[_0x340a5c(0x1c0)]=[status_enums_1[_0x340a5c(0x1d8)][_0x340a5c(0x1ac)],status_enums_1['VeevaPackageStatus']['DEPLOYED_WITH_WARNINGS']]['includes'](_0x1ebf8d);const _0x391608=array_utils_1[_0x340a5c(0x1be)][_0x340a5c(0x1d5)](this[_0x340a5c(0x1aa)](_0x16c57c),({uniqueName:_0x590a31})=>_0x590a31);for(const _0x5395bb of _0x5ef8ea[_0x340a5c(0x19d)]){const _0xe4dc04=(_0x72931b=_0x391608['get'](_0x5395bb[_0x340a5c(0x196)]))===null||_0x72931b===void 0x0?void 0x0:_0x72931b[_0x340a5c(0x1da)];_0xe4dc04&&(_0x5395bb[_0x340a5c(0x1da)]=_0xe4dc04);}_0x5ef8ea[_0x340a5c(0x19d)]=_0x5ef8ea['packageComponentList'][_0x340a5c(0x198)](_0xf2e8f9=>_0xf2e8f9[_0x340a5c(0x1da)]!==status_enums_1[_0x340a5c(0x1b8)]['VERIFIED']);if(!_0x5ef8ea[_0x340a5c(0x19d)]['length'])throw new Error(_0x340a5c(0x19a));return _0x5ef8ea;}else throw new veeva_error_1[(_0x340a5c(0x1b1))](_0x4fa8c7[_0x340a5c(0x1a6)]);}async[a376_0x14938d(0x1a2)](_0x148478){const _0x39f0d0=a376_0x14938d,{data:_0x1aa5a9}=await this[_0x39f0d0(0x1d6)]['get'](_0x148478,{'responseType':_0x39f0d0(0x1bd)});return _0x1aa5a9;}[a376_0x14938d(0x1aa)](_0x237bdb){const _0x4bbc07=a376_0x14938d;return _0x237bdb[_0x4bbc07(0x190)]((_0x394097,_0x38e56b)=>{const _0x3dac9e=_0x4bbc07,_0x158ca7=_0x38e56b['package_components']['map'](_0x3cf9d2=>new package_component_dto_1[(_0x3dac9e(0x1b3))]({'status':_0x38e56b[_0x3dac9e(0x1a7)],'stepName':_0x38e56b[_0x3dac9e(0x187)],'component':_0x3cf9d2}));return[..._0x394097,..._0x158ca7];},[]);}async[a376_0x14938d(0x1a0)](_0x3983c2){const _0x47dfe6=a376_0x14938d,{data:_0x1b9353}=await this[_0x47dfe6(0x1d6)][_0x47dfe6(0x1c8)](veeva_constants_1[_0x47dfe6(0x1a5)][_0x47dfe6(0x19f)][_0x47dfe6(0x1a3)]('{package_id}',_0x3983c2['packageId']));if(_0x1b9353[_0x47dfe6(0x1cc)]===status_enums_1[_0x47dfe6(0x19e)][_0x47dfe6(0x193)]){const {package_steps:_0x4e58d3}=_0x1b9353[_0x47dfe6(0x1b9)],_0x58bcb9=array_utils_1['ArrayUtils'][_0x47dfe6(0x1cf)](_0x3983c2[_0x47dfe6(0x19d)],({stepName:_0x34011b})=>_0x34011b);for(const {name__v:_0x393e83,deployment_action:_0x2cde46}of _0x4e58d3){for(const _0x332891 of _0x58bcb9[_0x47dfe6(0x1b7)](_0x393e83)||[]){_0x332891[_0x47dfe6(0x1a1)]=package_component_dto_1['PackageComponentDto'][_0x47dfe6(0x1ce)](_0x2cde46);}}}else throw new veeva_error_1['VeevaError'](_0x1b9353[_0x47dfe6(0x1a6)]);}async['import'](_0x4c10b7){const _0x13de14=a376_0x14938d,_0x3e57a2=await this[_0x13de14(0x19c)](_0x4c10b7),_0x54ce9=await this['getJobDetailUrl'](_0x3e57a2),_0x2c48f7=await this[_0x13de14(0x1a8)](_0x54ce9),_0x42e57f=await this[_0x13de14(0x1ab)](_0x2c48f7[_0x13de14(0x195)]),_0x4f7c16=await this['getJobDetailUrl'](_0x42e57f);return this[_0x13de14(0x1cb)](_0x4f7c16,_0x2c48f7);}}function a376_0x3d3a(_0x490924,_0x31f203){const _0x565a11=a376_0x2814();return a376_0x3d3a=function(_0x55459c,_0x579913){_0x55459c=_0x55459c-0x187;let _0x28141a=_0x565a11[_0x55459c];return _0x28141a;},a376_0x3d3a(_0x490924,_0x31f203);}exports['PackageImportService']=PackageImportService;