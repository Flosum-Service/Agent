const a359_0x7a794a=a359_0x2408;(function(_0x18f8b8,_0xa5b990){const _0x1c8ce1=a359_0x2408,_0x269395=_0x18f8b8();while(!![]){try{const _0x513705=parseInt(_0x1c8ce1(0x126))/0x1+-parseInt(_0x1c8ce1(0x15c))/0x2*(-parseInt(_0x1c8ce1(0x160))/0x3)+parseInt(_0x1c8ce1(0x15d))/0x4*(parseInt(_0x1c8ce1(0x123))/0x5)+-parseInt(_0x1c8ce1(0x151))/0x6+parseInt(_0x1c8ce1(0x16e))/0x7+parseInt(_0x1c8ce1(0x155))/0x8*(parseInt(_0x1c8ce1(0x166))/0x9)+-parseInt(_0x1c8ce1(0x14d))/0xa*(parseInt(_0x1c8ce1(0x119))/0xb);if(_0x513705===_0xa5b990)break;else _0x269395['push'](_0x269395['shift']());}catch(_0x43962f){_0x269395['push'](_0x269395['shift']());}}}(a359_0x3c33,0x66a89));const a359_0x666fd9=(function(){let _0x24fbb7=!![];return function(_0x25a0f9,_0x208c7a){const _0x5acead=_0x24fbb7?function(){const _0x56c7da=a359_0x2408;if(_0x208c7a){const _0xa42b91=_0x208c7a[_0x56c7da(0x13f)](_0x25a0f9,arguments);return _0x208c7a=null,_0xa42b91;}}:function(){};return _0x24fbb7=![],_0x5acead;};}()),a359_0x264cc2=a359_0x666fd9(this,function(){const _0x7f4d51=a359_0x2408;return a359_0x264cc2[_0x7f4d51(0x129)]()[_0x7f4d51(0x146)]('(((.+)+)+)+$')[_0x7f4d51(0x129)]()[_0x7f4d51(0x11e)](a359_0x264cc2)[_0x7f4d51(0x146)]('(((.+)+)+)+$');});a359_0x264cc2();'use strict';var __importDefault=this&&this[a359_0x7a794a(0x154)]||function(_0x372606){const _0x5a3cab=a359_0x7a794a;return _0x372606&&_0x372606[_0x5a3cab(0x121)]?_0x372606:{'default':_0x372606};};function a359_0x2408(_0x1e081e,_0x3861e7){const _0xbc2261=a359_0x3c33();return a359_0x2408=function(_0x264cc2,_0x666fd9){_0x264cc2=_0x264cc2-0x117;let _0x3c3352=_0xbc2261[_0x264cc2];return _0x3c3352;},a359_0x2408(_0x1e081e,_0x3861e7);}Object[a359_0x7a794a(0x172)](exports,a359_0x7a794a(0x121),{'value':!![]}),exports[a359_0x7a794a(0x174)]=void 0x0;const veeva_constants_1=require(a359_0x7a794a(0x13a)),status_enums_1=require(a359_0x7a794a(0x13c)),veeva_error_1=require(a359_0x7a794a(0x165)),form_data_1=__importDefault(require(a359_0x7a794a(0x136))),fs_1=require('fs'),veeva_auth_utils_1=require(a359_0x7a794a(0x133)),package_details_dto_1=require(a359_0x7a794a(0x176)),package_component_dto_1=require(a359_0x7a794a(0x153)),array_utils_1=require(a359_0x7a794a(0x13e));function a359_0x3c33(){const _0xb278de=['PackageComponentStatus','map','Import\x20package','Validation.log','createReadStream','search','_logger','groupToMap','responseStatus','_connection','Deploy\x20Log','Get\x20deploy\x20result','10EGYcRq','Cannot\x20find\x20deployment\x20results','filename','errors','1708386DshSya','href','../dtos/package-component.dto','__importDefault','85912ZKWBVo','multipart/form-data','status','getLogResultText','Deployment.log','length','PackageComponentDto','52406jqJKKX','1116744AMFdBV','post','getJobDetailUrl','72xuRjHI','importVpk','deploymentAction','find','endsWith','../classes/errors/veeva-error','549symesY','import','ArrayUtils','SUCCESS','getValidationDetailsAndSaveLog','_saveLog','package_components','VeevaResponseStatus','4564889CMlLRe','name__v','filter','VeevaError','defineProperty','{package_id}','PackageImportService','log','../dtos/package-details.dto','getJobResult','groupUniqueToMap','url','VeevaConstants','22307802nOrBoG','_veevaService','Validation\x20Log','packageId','rel','constructor','PackageDetailsDto','file','__esModule','append','10vQruPh','replace','updateVeevaConnection','238752fAUmso','fillPackageDeploymentAction','Package\x20not\x20verified','toString','includes','responseDetails','packageComponentList','deployment_status__v','put','uniqueName','formPackageComponentList','deployPackage','Wait\x20Executing\x20job','../utils/veeva-auth.utils','Get\x20validation\x20details.','VeevaPackageStatus','form-data','Deploy\x20package','links','data','../constants/veeva.constants','vaultPackage','../enums/status.enums','get','../utils/array.utils','apply','isDeployed'];a359_0x3c33=function(){return _0xb278de;};return a359_0x3c33();}class PackageImportService{constructor({veevaService:_0x2271c2,connection:_0x586081,logger:_0xab7028,saveLog:_0x480fc5}){const _0x365fb8=a359_0x7a794a;this[_0x365fb8(0x11a)]=_0x2271c2,this['_connection']=_0x586081,this[_0x365fb8(0x147)]=_0xab7028,this['_saveLog']=_0x480fc5;}async[a359_0x7a794a(0x161)](_0x4b9e1c,_0xf67d93=0x1){const _0x49c721=a359_0x7a794a;this['_logger'][_0x49c721(0x175)](_0x49c721(0x143));const _0x37717e=new form_data_1['default']();_0x37717e[_0x49c721(0x122)](_0x49c721(0x120),(0x0,fs_1[_0x49c721(0x145)])(_0x4b9e1c));const _0x1b187b=await this[_0x49c721(0x14a)][_0x49c721(0x12e)](veeva_constants_1[_0x49c721(0x118)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x37717e,{'headers':{'Content-Type':_0x49c721(0x156)}}),_0x50ac09=_0x1b187b['data'];if(_0x50ac09[_0x49c721(0x149)]===status_enums_1['VeevaResponseStatus'][_0x49c721(0x169)])return _0x50ac09[_0x49c721(0x117)];else{if(_0xf67d93>0x0)return await(0x0,veeva_auth_utils_1[_0x49c721(0x125)])(this[_0x49c721(0x14a)]),await this['importVpk'](_0x4b9e1c,_0xf67d93-0x1);throw new veeva_error_1[(_0x49c721(0x171))](_0x50ac09[_0x49c721(0x150)]);}}async[a359_0x7a794a(0x131)](_0x3b057a){const _0x3a3b15=a359_0x7a794a;this[_0x3a3b15(0x147)]['log'](_0x3a3b15(0x137));const _0x2682a5=await this[_0x3a3b15(0x14a)]['post'](veeva_constants_1[_0x3a3b15(0x118)]['ENDPOINT_DEPLOY_PACKAGE'][_0x3a3b15(0x124)](_0x3a3b15(0x173),_0x3b057a)),_0x4472e7=await _0x2682a5[_0x3a3b15(0x139)];if(_0x4472e7['responseStatus']===status_enums_1[_0x3a3b15(0x16d)]['SUCCESS'])return _0x4472e7[_0x3a3b15(0x117)];else throw new veeva_error_1['VeevaError'](_0x4472e7[_0x3a3b15(0x150)]);}async[a359_0x7a794a(0x15f)](_0x3b9a5e){const _0x330d68=a359_0x7a794a;this[_0x330d68(0x147)][_0x330d68(0x175)](_0x330d68(0x132));const [_0x328a2c]=await this['_veevaService'][_0x330d68(0x177)]([_0x3b9a5e]);return _0x328a2c[_0x330d68(0x138)][_0x330d68(0x163)](_0x4e81e3=>_0x4e81e3[_0x330d68(0x11d)]==='artifacts')[_0x330d68(0x152)];}async[a359_0x7a794a(0x16a)](_0x23c1f5){const _0x5233f6=a359_0x7a794a;this['_logger'][_0x5233f6(0x175)](_0x5233f6(0x134));const {data:_0x2ab276}=await this[_0x5233f6(0x14a)][_0x5233f6(0x13d)](_0x23c1f5);if(_0x2ab276[_0x5233f6(0x149)]===status_enums_1[_0x5233f6(0x16d)][_0x5233f6(0x169)]){const _0x412c33=new package_details_dto_1[(_0x5233f6(0x11f))](),{log:_0x9a2b5f,id:_0x3030e6,package_status:_0x46a965,package_steps:_0x2758e5}=_0x2ab276[_0x5233f6(0x13b)],_0x15a4e6=_0x9a2b5f['filter'](_0x314690=>_0x314690[_0x5233f6(0x14f)][_0x5233f6(0x164)](_0x5233f6(0x144))),_0x2aa6e6=await this['getLogResultText'](_0x15a4e6[0x0][_0x5233f6(0x117)]);await this['_saveLog'](_0x2aa6e6,_0x5233f6(0x11b)),_0x412c33[_0x5233f6(0x11c)]=_0x3030e6,_0x412c33[_0x5233f6(0x12c)]=this[_0x5233f6(0x130)](_0x2758e5),await this[_0x5233f6(0x127)](_0x412c33);if(_0x46a965!==status_enums_1[_0x5233f6(0x135)]['VERIFIED'])throw new Error(_0x5233f6(0x128));return _0x412c33;}else throw new veeva_error_1[(_0x5233f6(0x171))](_0x2ab276[_0x5233f6(0x150)]);}async['getDeployDetailsAndSaveLog'](_0x484897,_0xeb0b3e){const _0x5133dc=a359_0x7a794a;var _0x4695a6;this[_0x5133dc(0x147)][_0x5133dc(0x175)](_0x5133dc(0x14c));const {data:_0x3b9038}=await this[_0x5133dc(0x14a)]['get'](_0x484897);if(_0x3b9038[_0x5133dc(0x149)]===status_enums_1[_0x5133dc(0x16d)][_0x5133dc(0x169)]){const {responseDetails:{deployment_log:_0x4ef3fb,package_status__v:_0x19df97},package_steps:_0xb89415}=_0x3b9038,_0xa10182=_0x4ef3fb[_0x5133dc(0x170)](_0x28dc05=>_0x28dc05[_0x5133dc(0x14f)][_0x5133dc(0x164)](_0x5133dc(0x159))),_0x3a69bd=await this[_0x5133dc(0x158)](_0xa10182[0x0][_0x5133dc(0x117)]);await this[_0x5133dc(0x16b)](_0x3a69bd,_0x5133dc(0x14b)),_0xeb0b3e[_0x5133dc(0x140)]=[status_enums_1[_0x5133dc(0x135)]['DEPLOYED'],status_enums_1[_0x5133dc(0x135)]['DEPLOYED_WITH_WARNINGS']][_0x5133dc(0x12a)](_0x19df97);const _0x82b80f=array_utils_1[_0x5133dc(0x168)][_0x5133dc(0x178)](this['formPackageComponentList'](_0xb89415),({uniqueName:_0x273540})=>_0x273540);for(const _0x1f20f2 of _0xeb0b3e[_0x5133dc(0x12c)]){const _0x165cad=(_0x4695a6=_0x82b80f[_0x5133dc(0x13d)](_0x1f20f2[_0x5133dc(0x12f)]))===null||_0x4695a6===void 0x0?void 0x0:_0x4695a6[_0x5133dc(0x157)];_0x165cad&&(_0x1f20f2[_0x5133dc(0x157)]=_0x165cad);}_0xeb0b3e[_0x5133dc(0x12c)]=_0xeb0b3e[_0x5133dc(0x12c)][_0x5133dc(0x170)](_0x2754de=>_0x2754de['status']!==status_enums_1[_0x5133dc(0x141)]['VERIFIED']);if(!_0xeb0b3e['packageComponentList'][_0x5133dc(0x15a)])throw new Error(_0x5133dc(0x14e));return _0xeb0b3e;}else throw new veeva_error_1[(_0x5133dc(0x171))](_0x3b9038[_0x5133dc(0x150)]);}async[a359_0x7a794a(0x158)](_0x5262b7){const _0x9cbaf=a359_0x7a794a,{data:_0x571e57}=await this[_0x9cbaf(0x14a)][_0x9cbaf(0x13d)](_0x5262b7,{'responseType':'text'});return _0x571e57;}[a359_0x7a794a(0x130)](_0xc038a){return _0xc038a['reduce']((_0x30ac78,_0x5bb568)=>{const _0x369b0c=a359_0x2408,_0x3c7c11=_0x5bb568[_0x369b0c(0x16c)][_0x369b0c(0x142)](_0x11c42f=>new package_component_dto_1[(_0x369b0c(0x15b))]({'status':_0x5bb568[_0x369b0c(0x12d)],'stepName':_0x5bb568[_0x369b0c(0x16f)],'component':_0x11c42f}));return[..._0x30ac78,..._0x3c7c11];},[]);}async[a359_0x7a794a(0x127)](_0x16d8d9){const _0x49ef55=a359_0x7a794a,{data:_0x11aa7e}=await this['_connection'][_0x49ef55(0x15e)](veeva_constants_1[_0x49ef55(0x118)]['ENDPOINT_VALIDATE_PACKAGE'][_0x49ef55(0x124)](_0x49ef55(0x173),_0x16d8d9[_0x49ef55(0x11c)]));if(_0x11aa7e[_0x49ef55(0x149)]===status_enums_1['VeevaResponseStatus'][_0x49ef55(0x169)]){const {package_steps:_0x150816}=_0x11aa7e[_0x49ef55(0x12b)],_0x597ab6=array_utils_1['ArrayUtils'][_0x49ef55(0x148)](_0x16d8d9[_0x49ef55(0x12c)],({stepName:_0x279c40})=>_0x279c40);for(const {name__v:_0x5110df,deployment_action:_0x6c5b42}of _0x150816){for(const _0x38e62a of _0x597ab6[_0x49ef55(0x13d)](_0x5110df)||[]){_0x38e62a[_0x49ef55(0x162)]=package_component_dto_1[_0x49ef55(0x15b)]['convertDeploymentAction'](_0x6c5b42);}}}else throw new veeva_error_1[(_0x49ef55(0x171))](_0x11aa7e[_0x49ef55(0x150)]);}async[a359_0x7a794a(0x167)](_0x580fe2){const _0x1506be=a359_0x7a794a,_0x41e4d0=await this['importVpk'](_0x580fe2),_0x178541=await this[_0x1506be(0x15f)](_0x41e4d0),_0x241b0f=await this[_0x1506be(0x16a)](_0x178541),_0x14908e=await this['deployPackage'](_0x241b0f[_0x1506be(0x11c)]),_0x2a420d=await this['getJobDetailUrl'](_0x14908e);return this['getDeployDetailsAndSaveLog'](_0x2a420d,_0x241b0f);}}exports[a359_0x7a794a(0x174)]=PackageImportService;