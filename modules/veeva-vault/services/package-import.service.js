const a336_0x22b732=a336_0x4038;(function(_0x1c7f23,_0x58a8db){const _0xef1f22=a336_0x4038,_0x19bab8=_0x1c7f23();while(!![]){try{const _0x4b09ce=-parseInt(_0xef1f22(0x18a))/0x1+-parseInt(_0xef1f22(0x19d))/0x2*(parseInt(_0xef1f22(0x1bf))/0x3)+-parseInt(_0xef1f22(0x187))/0x4+parseInt(_0xef1f22(0x1aa))/0x5*(parseInt(_0xef1f22(0x18f))/0x6)+parseInt(_0xef1f22(0x183))/0x7*(-parseInt(_0xef1f22(0x16b))/0x8)+parseInt(_0xef1f22(0x169))/0x9+-parseInt(_0xef1f22(0x1a9))/0xa*(-parseInt(_0xef1f22(0x18b))/0xb);if(_0x4b09ce===_0x58a8db)break;else _0x19bab8['push'](_0x19bab8['shift']());}catch(_0x3ef8c2){_0x19bab8['push'](_0x19bab8['shift']());}}}(a336_0x51fe,0x40f0a));const a336_0x3dc57d=(function(){let _0x530a7f=!![];return function(_0x55db8d,_0xfd9c73){const _0x262c79=_0x530a7f?function(){const _0x8cebcb=a336_0x4038;if(_0xfd9c73){const _0x729fe1=_0xfd9c73[_0x8cebcb(0x1be)](_0x55db8d,arguments);return _0xfd9c73=null,_0x729fe1;}}:function(){};return _0x530a7f=![],_0x262c79;};}()),a336_0x11806d=a336_0x3dc57d(this,function(){const _0x86c38b=a336_0x4038;return a336_0x11806d[_0x86c38b(0x1c3)]()[_0x86c38b(0x16a)](_0x86c38b(0x1b3))[_0x86c38b(0x1c3)]()[_0x86c38b(0x1ac)](a336_0x11806d)[_0x86c38b(0x16a)]('(((.+)+)+)+$');});function a336_0x51fe(){const _0x27302a=['_veevaService','replace','status','packageId','apply','207087MSrFbS','links','../enums/status.enums','convertDeploymentAction','toString','length','deployPackage','responseStatus','../classes/errors/veeva-error','_connection','deployment_status__v','getValidationDetailsAndSaveLog','url','post','4588578URYEAB','search','32ECKygT','VERIFIED','{package_id}','Get\x20validation\x20details.','importVpk','formPackageComponentList','VeevaError','endsWith','Deploy\x20package','href','_saveLog','PackageDetailsDto','find','get','VeevaConstants','default','groupUniqueToMap','DEPLOYED_WITH_WARNINGS','log','packageComponentList','form-data','ENDPOINT_VALIDATE_PACKAGE','getDeployDetailsAndSaveLog','SUCCESS','724199VLrvri','../dtos/package-component.dto','file','Validation\x20Log','1978480KPBwTP','PackageComponentDto','map','3646CdFHwB','495eUFaOi','VeevaPackageStatus','PackageImportService','Deployment.log','2942664lHfYAo','defineProperty','name__v','reduce','text','ENDPOINT_DEPLOY_PACKAGE','Deploy\x20Log','ENDPOINT_EXPORT_IMPORT_PACKAGE','getLogResultText','DEPLOYED','includes','../utils/array.utils','../dtos/package-details.dto','ArrayUtils','14PhRONm','append','Validation.log','package_components','uniqueName','__esModule','Get\x20deploy\x20result','responseDetails','Cannot\x20find\x20deployment\x20results','fillPackageDeploymentAction','Wait\x20Executing\x20job','updateVeevaConnection','146890KvThxy','5wDuWiW','data','constructor','put','Package\x20not\x20verified','errors','getJobResult','PackageComponentStatus','rel','(((.+)+)+)+$','_logger','VeevaResponseStatus','multipart/form-data','filter','import','getJobDetailUrl'];a336_0x51fe=function(){return _0x27302a;};return a336_0x51fe();}a336_0x11806d();'use strict';function a336_0x4038(_0x5cfc0a,_0x535533){const _0x2a104c=a336_0x51fe();return a336_0x4038=function(_0x11806d,_0x3dc57d){_0x11806d=_0x11806d-0x167;let _0x51feb0=_0x2a104c[_0x11806d];return _0x51feb0;},a336_0x4038(_0x5cfc0a,_0x535533);}var __importDefault=this&&this['__importDefault']||function(_0x1b2a26){return _0x1b2a26&&_0x1b2a26['__esModule']?_0x1b2a26:{'default':_0x1b2a26};};Object[a336_0x22b732(0x190)](exports,a336_0x22b732(0x1a2),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),status_enums_1=require(a336_0x22b732(0x1c1)),veeva_error_1=require(a336_0x22b732(0x1c7)),form_data_1=__importDefault(require(a336_0x22b732(0x17f))),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require(a336_0x22b732(0x19b)),package_component_dto_1=require(a336_0x22b732(0x184)),array_utils_1=require(a336_0x22b732(0x19a));class PackageImportService{constructor({veevaService:_0x39bff1,connection:_0x4f5441,logger:_0x2f3e20,saveLog:_0x55cd96}){const _0x2be7e7=a336_0x22b732;this['_veevaService']=_0x39bff1,this['_connection']=_0x4f5441,this['_logger']=_0x2f3e20,this[_0x2be7e7(0x175)]=_0x55cd96;}async[a336_0x22b732(0x16f)](_0xb3f6b6,_0x521f08=0x1){const _0x3d48d9=a336_0x22b732;this[_0x3d48d9(0x1b4)]['log']('Import\x20package');const _0x4b75bd=new form_data_1[(_0x3d48d9(0x17a))]();_0x4b75bd[_0x3d48d9(0x19e)](_0x3d48d9(0x185),(0x0,fs_1['createReadStream'])(_0xb3f6b6));const _0xb187da=await this[_0x3d48d9(0x1c8)][_0x3d48d9(0x1ad)](veeva_constants_1[_0x3d48d9(0x179)][_0x3d48d9(0x196)],_0x4b75bd,{'headers':{'Content-Type':_0x3d48d9(0x1b6)}}),_0x47dc16=_0xb187da[_0x3d48d9(0x1ab)];if(_0x47dc16['responseStatus']===status_enums_1[_0x3d48d9(0x1b5)]['SUCCESS'])return _0x47dc16['url'];else{if(_0x521f08>0x0)return await(0x0,veeva_auth_utils_1[_0x3d48d9(0x1a8)])(this['_connection']),await this[_0x3d48d9(0x16f)](_0xb3f6b6,_0x521f08-0x1);throw new veeva_error_1[(_0x3d48d9(0x171))](_0x47dc16[_0x3d48d9(0x1af)]);}}async['deployPackage'](_0x1ad0f3){const _0x1cf58c=a336_0x22b732;this[_0x1cf58c(0x1b4)][_0x1cf58c(0x17d)](_0x1cf58c(0x173));const _0x3a195c=await this[_0x1cf58c(0x1c8)]['post'](veeva_constants_1[_0x1cf58c(0x179)][_0x1cf58c(0x194)][_0x1cf58c(0x1bb)](_0x1cf58c(0x16d),_0x1ad0f3)),_0x2304db=await _0x3a195c[_0x1cf58c(0x1ab)];if(_0x2304db['responseStatus']===status_enums_1[_0x1cf58c(0x1b5)][_0x1cf58c(0x182)])return _0x2304db[_0x1cf58c(0x167)];else throw new veeva_error_1[(_0x1cf58c(0x171))](_0x2304db[_0x1cf58c(0x1af)]);}async[a336_0x22b732(0x1b9)](_0x19702b){const _0x4035bb=a336_0x22b732;this[_0x4035bb(0x1b4)][_0x4035bb(0x17d)](_0x4035bb(0x1a7));const [_0x499d5c]=await this[_0x4035bb(0x1ba)][_0x4035bb(0x1b0)]([_0x19702b]);return _0x499d5c[_0x4035bb(0x1c0)][_0x4035bb(0x177)](_0x2d84ad=>_0x2d84ad[_0x4035bb(0x1b2)]==='artifacts')[_0x4035bb(0x174)];}async[a336_0x22b732(0x1ca)](_0x8cb11b){const _0x1f8ef9=a336_0x22b732;this[_0x1f8ef9(0x1b4)][_0x1f8ef9(0x17d)](_0x1f8ef9(0x16e));const {data:_0x5ed5d8}=await this['_connection']['get'](_0x8cb11b);if(_0x5ed5d8[_0x1f8ef9(0x1c6)]===status_enums_1[_0x1f8ef9(0x1b5)][_0x1f8ef9(0x182)]){const _0x5061c0=new package_details_dto_1[(_0x1f8ef9(0x176))](),{log:_0x554f3c,id:_0xa93e42,package_status:_0xbe78f5,package_steps:_0x128ad9}=_0x5ed5d8['vaultPackage'],_0xdd89f5=_0x554f3c[_0x1f8ef9(0x1b7)](_0x4edd8e=>_0x4edd8e['filename'][_0x1f8ef9(0x172)](_0x1f8ef9(0x19f))),_0x42d2e6=await this[_0x1f8ef9(0x197)](_0xdd89f5[0x0][_0x1f8ef9(0x167)]);await this['_saveLog'](_0x42d2e6,_0x1f8ef9(0x186)),_0x5061c0[_0x1f8ef9(0x1bd)]=_0xa93e42,_0x5061c0[_0x1f8ef9(0x17e)]=this[_0x1f8ef9(0x170)](_0x128ad9),await this[_0x1f8ef9(0x1a6)](_0x5061c0);if(_0xbe78f5!==status_enums_1['VeevaPackageStatus'][_0x1f8ef9(0x16c)])throw new Error(_0x1f8ef9(0x1ae));return _0x5061c0;}else throw new veeva_error_1['VeevaError'](_0x5ed5d8['errors']);}async[a336_0x22b732(0x181)](_0x6ee021,_0x313fa5){const _0x4313db=a336_0x22b732;var _0x3c5e07;this[_0x4313db(0x1b4)][_0x4313db(0x17d)](_0x4313db(0x1a3));const {data:_0x1603b6}=await this['_connection'][_0x4313db(0x178)](_0x6ee021);if(_0x1603b6[_0x4313db(0x1c6)]===status_enums_1[_0x4313db(0x1b5)][_0x4313db(0x182)]){const {responseDetails:{deployment_log:_0x234939,package_status__v:_0x49ea4c},package_steps:_0x3b87cf}=_0x1603b6,_0x8e2851=_0x234939[_0x4313db(0x1b7)](_0xa78c51=>_0xa78c51['filename']['endsWith'](_0x4313db(0x18e))),_0x3d03f7=await this[_0x4313db(0x197)](_0x8e2851[0x0][_0x4313db(0x167)]);await this[_0x4313db(0x175)](_0x3d03f7,_0x4313db(0x195)),_0x313fa5['isDeployed']=[status_enums_1[_0x4313db(0x18c)][_0x4313db(0x198)],status_enums_1[_0x4313db(0x18c)][_0x4313db(0x17c)]][_0x4313db(0x199)](_0x49ea4c);const _0x3030a9=array_utils_1['ArrayUtils'][_0x4313db(0x17b)](this[_0x4313db(0x170)](_0x3b87cf),({uniqueName:_0x1720aa})=>_0x1720aa);for(const _0x58c35b of _0x313fa5[_0x4313db(0x17e)]){const _0x5a265f=(_0x3c5e07=_0x3030a9['get'](_0x58c35b[_0x4313db(0x1a1)]))===null||_0x3c5e07===void 0x0?void 0x0:_0x3c5e07[_0x4313db(0x1bc)];_0x5a265f&&(_0x58c35b[_0x4313db(0x1bc)]=_0x5a265f);}_0x313fa5[_0x4313db(0x17e)]=_0x313fa5['packageComponentList']['filter'](_0x2692fc=>_0x2692fc[_0x4313db(0x1bc)]!==status_enums_1[_0x4313db(0x1b1)][_0x4313db(0x16c)]);if(!_0x313fa5[_0x4313db(0x17e)][_0x4313db(0x1c4)])throw new Error(_0x4313db(0x1a5));return _0x313fa5;}else throw new veeva_error_1['VeevaError'](_0x1603b6[_0x4313db(0x1af)]);}async['getLogResultText'](_0x34d6de){const _0x4b39dc=a336_0x22b732,{data:_0x445427}=await this['_connection']['get'](_0x34d6de,{'responseType':_0x4b39dc(0x193)});return _0x445427;}[a336_0x22b732(0x170)](_0x10441d){const _0x441129=a336_0x22b732;return _0x10441d[_0x441129(0x192)]((_0x4d6269,_0x5b5242)=>{const _0x48a68c=_0x441129,_0x276f5e=_0x5b5242[_0x48a68c(0x1a0)][_0x48a68c(0x189)](_0xd7c3d7=>new package_component_dto_1['PackageComponentDto']({'status':_0x5b5242[_0x48a68c(0x1c9)],'stepName':_0x5b5242[_0x48a68c(0x191)],'component':_0xd7c3d7}));return[..._0x4d6269,..._0x276f5e];},[]);}async[a336_0x22b732(0x1a6)](_0x5898fd){const _0x11e328=a336_0x22b732,{data:_0x4967a6}=await this[_0x11e328(0x1c8)][_0x11e328(0x168)](veeva_constants_1[_0x11e328(0x179)][_0x11e328(0x180)][_0x11e328(0x1bb)]('{package_id}',_0x5898fd[_0x11e328(0x1bd)]));if(_0x4967a6['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x11e328(0x182)]){const {package_steps:_0x570a95}=_0x4967a6[_0x11e328(0x1a4)],_0x1dda95=array_utils_1[_0x11e328(0x19c)]['groupToMap'](_0x5898fd[_0x11e328(0x17e)],({stepName:_0x1ee5e7})=>_0x1ee5e7);for(const {name__v:_0x88de66,deployment_action:_0x1b51ed}of _0x570a95){for(const _0x30f51a of _0x1dda95['get'](_0x88de66)||[]){_0x30f51a['deploymentAction']=package_component_dto_1[_0x11e328(0x188)][_0x11e328(0x1c2)](_0x1b51ed);}}}else throw new veeva_error_1[(_0x11e328(0x171))](_0x4967a6[_0x11e328(0x1af)]);}async[a336_0x22b732(0x1b8)](_0x391087){const _0x3f1c1c=a336_0x22b732,_0x1eeeb4=await this[_0x3f1c1c(0x16f)](_0x391087),_0x1c517f=await this[_0x3f1c1c(0x1b9)](_0x1eeeb4),_0x4ba44a=await this['getValidationDetailsAndSaveLog'](_0x1c517f),_0x316d0d=await this[_0x3f1c1c(0x1c5)](_0x4ba44a[_0x3f1c1c(0x1bd)]),_0x19f7f9=await this[_0x3f1c1c(0x1b9)](_0x316d0d);return this[_0x3f1c1c(0x181)](_0x19f7f9,_0x4ba44a);}}exports[a336_0x22b732(0x18d)]=PackageImportService;