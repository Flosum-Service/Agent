const a403_0x3376bc=a403_0x1239;(function(_0x515b4d,_0x2c77be){const _0x4c2978=a403_0x1239,_0x32e655=_0x515b4d();while(!![]){try{const _0x5cdec2=parseInt(_0x4c2978(0x1c0))/0x1*(-parseInt(_0x4c2978(0x19e))/0x2)+-parseInt(_0x4c2978(0x1bb))/0x3*(parseInt(_0x4c2978(0x1b2))/0x4)+-parseInt(_0x4c2978(0x19f))/0x5+parseInt(_0x4c2978(0x1c7))/0x6*(parseInt(_0x4c2978(0x1ad))/0x7)+parseInt(_0x4c2978(0x1b0))/0x8+parseInt(_0x4c2978(0x184))/0x9+parseInt(_0x4c2978(0x1c9))/0xa;if(_0x5cdec2===_0x2c77be)break;else _0x32e655['push'](_0x32e655['shift']());}catch(_0xa1fde5){_0x32e655['push'](_0x32e655['shift']());}}}(a403_0x4d30,0xd8998));function a403_0x1239(_0x12bec1,_0x5b958b){const _0x5b7836=a403_0x4d30();return a403_0x1239=function(_0xf2a403,_0x500ef5){_0xf2a403=_0xf2a403-0x181;let _0x4d30ed=_0x5b7836[_0xf2a403];return _0x4d30ed;},a403_0x1239(_0x12bec1,_0x5b958b);}const a403_0x500ef5=(function(){let _0x598ac6=!![];return function(_0x424572,_0x21f9c3){const _0x1a50e2=_0x598ac6?function(){const _0x16c046=a403_0x1239;if(_0x21f9c3){const _0x10673a=_0x21f9c3[_0x16c046(0x1d8)](_0x424572,arguments);return _0x21f9c3=null,_0x10673a;}}:function(){};return _0x598ac6=![],_0x1a50e2;};}()),a403_0xf2a403=a403_0x500ef5(this,function(){const _0x2e5a0e=a403_0x1239;return a403_0xf2a403[_0x2e5a0e(0x1a0)]()[_0x2e5a0e(0x1c5)](_0x2e5a0e(0x185))[_0x2e5a0e(0x1a0)]()[_0x2e5a0e(0x1a5)](a403_0xf2a403)['search'](_0x2e5a0e(0x185));});function a403_0x4d30(){const _0x529052=['find','endsWith','Validation\x20Log','filter','Deployment.log','replace','includes','DEPLOYED','786QJATaB','7527260AAepMf','toString','uniqueName','../enums/status.enums','Cannot\x20find\x20deployment\x20results','_logger','constructor','../classes/errors/veeva-error','../utils/veeva-auth.utils','getJobDetailUrl','../constants/veeva.constants','VeevaResponseStatus','Import\x20package','log','24717nvOIVM','text','Package\x20not\x20verified','12484968iOnzvF','import','6616604ltWopw','append','VERIFIED','Deploy\x20Log','../dtos/package-details.dto','DEPLOYED_WITH_WARNINGS','Get\x20deploy\x20result','Wait\x20Executing\x20job','updateVeevaConnection','3cFzACF','Validation.log','SUCCESS','getLogResultText','PackageImportService','746tbBOTI','artifacts','responseDetails','PackageComponentDto','vaultPackage','search','deploymentAction','546cpTjBY','href','11515560fnKXNV','VeevaError','defineProperty','_saveLog','ENDPOINT_DEPLOY_PACKAGE','url','groupUniqueToMap','getValidationDetailsAndSaveLog','PackageComponentStatus','fillPackageDeploymentAction','name__v','links','createReadStream','getDeployDetailsAndSaveLog','form-data','apply','packageComponentList','ArrayUtils','importVpk','reduce','VeevaPackageStatus','../utils/array.utils','getJobResult','__esModule','VeevaConstants','formPackageComponentList','ENDPOINT_EXPORT_IMPORT_PACKAGE','11758275AWhppk','(((.+)+)+)+$','deployPackage','filename','status','__importDefault','../dtos/package-component.dto','ENDPOINT_VALIDATE_PACKAGE','errors','convertDeploymentAction','get','data','_connection','{package_id}','packageId','Deploy\x20package','responseStatus','post'];a403_0x4d30=function(){return _0x529052;};return a403_0x4d30();}a403_0xf2a403();'use strict';var __importDefault=this&&this[a403_0x3376bc(0x189)]||function(_0x6ea1fd){const _0x22cb71=a403_0x3376bc;return _0x6ea1fd&&_0x6ea1fd[_0x22cb71(0x1e0)]?_0x6ea1fd:{'default':_0x6ea1fd};};Object[a403_0x3376bc(0x1cb)](exports,a403_0x3376bc(0x1e0),{'value':!![]}),exports[a403_0x3376bc(0x1bf)]=void 0x0;const veeva_constants_1=require(a403_0x3376bc(0x1a9)),status_enums_1=require(a403_0x3376bc(0x1a2)),veeva_error_1=require(a403_0x3376bc(0x1a6)),form_data_1=__importDefault(require(a403_0x3376bc(0x1d7))),fs_1=require('fs'),veeva_auth_utils_1=require(a403_0x3376bc(0x1a7)),package_details_dto_1=require(a403_0x3376bc(0x1b6)),package_component_dto_1=require(a403_0x3376bc(0x18a)),array_utils_1=require(a403_0x3376bc(0x1de));class PackageImportService{constructor({veevaService:_0x448d68,connection:_0x2c099b,logger:_0x2f99a9,saveLog:_0x5aadc8}){const _0x3424c6=a403_0x3376bc;this['_veevaService']=_0x448d68,this[_0x3424c6(0x190)]=_0x2c099b,this[_0x3424c6(0x1a4)]=_0x2f99a9,this[_0x3424c6(0x1cc)]=_0x5aadc8;}async['importVpk'](_0xb028b8,_0x4f6097=0x1){const _0x43e0a7=a403_0x3376bc;this[_0x43e0a7(0x1a4)][_0x43e0a7(0x1ac)](_0x43e0a7(0x1ab));const _0x5e8606=new form_data_1['default']();_0x5e8606[_0x43e0a7(0x1b3)]('file',(0x0,fs_1[_0x43e0a7(0x1d5)])(_0xb028b8));const _0x84d862=await this[_0x43e0a7(0x190)]['put'](veeva_constants_1[_0x43e0a7(0x181)][_0x43e0a7(0x183)],_0x5e8606,{'headers':{'Content-Type':'multipart/form-data'}}),_0x323067=_0x84d862[_0x43e0a7(0x18f)];if(_0x323067['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x43e0a7(0x1bd)])return _0x323067['url'];else{if(_0x4f6097>0x0)return await(0x0,veeva_auth_utils_1[_0x43e0a7(0x1ba)])(this[_0x43e0a7(0x190)]),await this['importVpk'](_0xb028b8,_0x4f6097-0x1);throw new veeva_error_1['VeevaError'](_0x323067['errors']);}}async[a403_0x3376bc(0x186)](_0x39b06e){const _0x5f1345=a403_0x3376bc;this[_0x5f1345(0x1a4)][_0x5f1345(0x1ac)](_0x5f1345(0x193));const _0x5d0342=await this[_0x5f1345(0x190)][_0x5f1345(0x195)](veeva_constants_1['VeevaConstants'][_0x5f1345(0x1cd)][_0x5f1345(0x19b)](_0x5f1345(0x191),_0x39b06e)),_0x378561=await _0x5d0342[_0x5f1345(0x18f)];if(_0x378561[_0x5f1345(0x194)]===status_enums_1[_0x5f1345(0x1aa)]['SUCCESS'])return _0x378561[_0x5f1345(0x1ce)];else throw new veeva_error_1[(_0x5f1345(0x1ca))](_0x378561[_0x5f1345(0x18c)]);}async['getJobDetailUrl'](_0xe37b07){const _0x346f97=a403_0x3376bc;this[_0x346f97(0x1a4)]['log'](_0x346f97(0x1b9));const [_0x4da937]=await this['_veevaService'][_0x346f97(0x1df)]([_0xe37b07]);return _0x4da937[_0x346f97(0x1d4)][_0x346f97(0x196)](_0x33b73b=>_0x33b73b['rel']===_0x346f97(0x1c1))[_0x346f97(0x1c8)];}async[a403_0x3376bc(0x1d0)](_0x5c3325){const _0x4384c4=a403_0x3376bc;this[_0x4384c4(0x1a4)]['log']('Get\x20validation\x20details.');const {data:_0x3adfe1}=await this[_0x4384c4(0x190)]['get'](_0x5c3325);if(_0x3adfe1[_0x4384c4(0x194)]===status_enums_1['VeevaResponseStatus'][_0x4384c4(0x1bd)]){const _0xb49bdd=new package_details_dto_1['PackageDetailsDto'](),{log:_0x1f49fc,id:_0x848594,package_status:_0x274833,package_steps:_0x24b2a6}=_0x3adfe1[_0x4384c4(0x1c4)],_0x264b0f=_0x1f49fc['filter'](_0x163ff6=>_0x163ff6[_0x4384c4(0x187)][_0x4384c4(0x197)](_0x4384c4(0x1bc))),_0x12e977=await this['getLogResultText'](_0x264b0f[0x0][_0x4384c4(0x1ce)]);await this[_0x4384c4(0x1cc)](_0x12e977,_0x4384c4(0x198)),_0xb49bdd['packageId']=_0x848594,_0xb49bdd[_0x4384c4(0x1d9)]=this[_0x4384c4(0x182)](_0x24b2a6),await this[_0x4384c4(0x1d2)](_0xb49bdd);if(_0x274833!==status_enums_1['VeevaPackageStatus']['VERIFIED'])throw new Error(_0x4384c4(0x1af));return _0xb49bdd;}else throw new veeva_error_1[(_0x4384c4(0x1ca))](_0x3adfe1['errors']);}async[a403_0x3376bc(0x1d6)](_0x1b2999,_0x2faeea){const _0x29cb3e=a403_0x3376bc;var _0x49f936;this[_0x29cb3e(0x1a4)][_0x29cb3e(0x1ac)](_0x29cb3e(0x1b8));const {data:_0xc8539b}=await this[_0x29cb3e(0x190)][_0x29cb3e(0x18e)](_0x1b2999);if(_0xc8539b[_0x29cb3e(0x194)]===status_enums_1[_0x29cb3e(0x1aa)]['SUCCESS']){const {responseDetails:{deployment_log:_0x2b6091,package_status__v:_0x54073c},package_steps:_0xb5d7c3}=_0xc8539b,_0x7a78d4=_0x2b6091[_0x29cb3e(0x199)](_0x2370a5=>_0x2370a5[_0x29cb3e(0x187)]['endsWith'](_0x29cb3e(0x19a))),_0x29dfb8=await this['getLogResultText'](_0x7a78d4[0x0]['url']);await this['_saveLog'](_0x29dfb8,_0x29cb3e(0x1b5)),_0x2faeea['isDeployed']=[status_enums_1[_0x29cb3e(0x1dd)][_0x29cb3e(0x19d)],status_enums_1[_0x29cb3e(0x1dd)][_0x29cb3e(0x1b7)]][_0x29cb3e(0x19c)](_0x54073c);const _0xf470d7=array_utils_1[_0x29cb3e(0x1da)][_0x29cb3e(0x1cf)](this[_0x29cb3e(0x182)](_0xb5d7c3),({uniqueName:_0x434f3d})=>_0x434f3d);for(const _0x187ccb of _0x2faeea['packageComponentList']){const _0x2f00b7=(_0x49f936=_0xf470d7[_0x29cb3e(0x18e)](_0x187ccb[_0x29cb3e(0x1a1)]))===null||_0x49f936===void 0x0?void 0x0:_0x49f936['status'];_0x2f00b7&&(_0x187ccb[_0x29cb3e(0x188)]=_0x2f00b7);}_0x2faeea[_0x29cb3e(0x1d9)]=_0x2faeea[_0x29cb3e(0x1d9)]['filter'](_0x4c22cf=>_0x4c22cf['status']!==status_enums_1[_0x29cb3e(0x1d1)][_0x29cb3e(0x1b4)]);if(!_0x2faeea['packageComponentList']['length'])throw new Error(_0x29cb3e(0x1a3));return _0x2faeea;}else throw new veeva_error_1[(_0x29cb3e(0x1ca))](_0xc8539b['errors']);}async[a403_0x3376bc(0x1be)](_0x106959){const _0x567dd7=a403_0x3376bc,{data:_0x57bf64}=await this['_connection'][_0x567dd7(0x18e)](_0x106959,{'responseType':_0x567dd7(0x1ae)});return _0x57bf64;}[a403_0x3376bc(0x182)](_0x536aff){const _0x9c92ad=a403_0x3376bc;return _0x536aff[_0x9c92ad(0x1dc)]((_0x4f9f50,_0x26c732)=>{const _0x2a77c3=_0x9c92ad,_0x3eb0d4=_0x26c732['package_components']['map'](_0x248780=>new package_component_dto_1[(_0x2a77c3(0x1c3))]({'status':_0x26c732['deployment_status__v'],'stepName':_0x26c732[_0x2a77c3(0x1d3)],'component':_0x248780}));return[..._0x4f9f50,..._0x3eb0d4];},[]);}async[a403_0x3376bc(0x1d2)](_0x20137e){const _0x24ec0b=a403_0x3376bc,{data:_0x249327}=await this[_0x24ec0b(0x190)]['post'](veeva_constants_1[_0x24ec0b(0x181)][_0x24ec0b(0x18b)][_0x24ec0b(0x19b)](_0x24ec0b(0x191),_0x20137e[_0x24ec0b(0x192)]));if(_0x249327['responseStatus']===status_enums_1[_0x24ec0b(0x1aa)]['SUCCESS']){const {package_steps:_0x3837de}=_0x249327[_0x24ec0b(0x1c2)],_0x150209=array_utils_1[_0x24ec0b(0x1da)]['groupToMap'](_0x20137e[_0x24ec0b(0x1d9)],({stepName:_0xe53b6d})=>_0xe53b6d);for(const {name__v:_0x568e23,deployment_action:_0x23db30}of _0x3837de){for(const _0x2db107 of _0x150209[_0x24ec0b(0x18e)](_0x568e23)||[]){_0x2db107[_0x24ec0b(0x1c6)]=package_component_dto_1[_0x24ec0b(0x1c3)][_0x24ec0b(0x18d)](_0x23db30);}}}else throw new veeva_error_1['VeevaError'](_0x249327[_0x24ec0b(0x18c)]);}async[a403_0x3376bc(0x1b1)](_0xda2467){const _0x45abbc=a403_0x3376bc,_0x26c58b=await this[_0x45abbc(0x1db)](_0xda2467),_0x393150=await this[_0x45abbc(0x1a8)](_0x26c58b),_0x1e11b4=await this[_0x45abbc(0x1d0)](_0x393150),_0x2f1f7f=await this[_0x45abbc(0x186)](_0x1e11b4[_0x45abbc(0x192)]),_0x13a9ee=await this[_0x45abbc(0x1a8)](_0x2f1f7f);return this[_0x45abbc(0x1d6)](_0x13a9ee,_0x1e11b4);}}exports['PackageImportService']=PackageImportService;