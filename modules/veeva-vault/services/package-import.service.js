const a404_0xade755=a404_0x1d62;(function(_0x995314,_0x388848){const _0x2df786=a404_0x1d62,_0x2fdae7=_0x995314();while(!![]){try{const _0x41a071=parseInt(_0x2df786(0x140))/0x1+parseInt(_0x2df786(0x13d))/0x2*(parseInt(_0x2df786(0x117))/0x3)+-parseInt(_0x2df786(0x116))/0x4*(-parseInt(_0x2df786(0x10b))/0x5)+-parseInt(_0x2df786(0x119))/0x6*(-parseInt(_0x2df786(0x11c))/0x7)+parseInt(_0x2df786(0x150))/0x8*(parseInt(_0x2df786(0x152))/0x9)+parseInt(_0x2df786(0x145))/0xa+-parseInt(_0x2df786(0x108))/0xb;if(_0x41a071===_0x388848)break;else _0x2fdae7['push'](_0x2fdae7['shift']());}catch(_0x44bf3c){_0x2fdae7['push'](_0x2fdae7['shift']());}}}(a404_0x2317,0x20b11));function a404_0x2317(){const _0x4c2c14=['getDeployDetailsAndSaveLog','status','ENDPOINT_EXPORT_IMPORT_PACKAGE','responseDetails','_logger','../classes/errors/veeva-error','7019749DtEciW','errors','ArrayUtils','15lUKYJR','ENDPOINT_VALIDATE_PACKAGE','uniqueName','Deploy\x20Log','deploymentAction','importVpk','artifacts','multipart/form-data','updateVeevaConnection','_veevaService','data','81036yeVZwV','123708AXbSMA','isDeployed','6RJgjic','Validation.log','getJobDetailUrl','1694707HKjDaq','PackageComponentDto','vaultPackage','includes','fillPackageDeploymentAction','defineProperty','filename','Package\x20not\x20verified','package_components','get','../utils/array.utils','text','VeevaResponseStatus','append','_saveLog','VERIFIED','log','convertDeploymentAction','getLogResultText','reduce','Deployment.log','VeevaError','DEPLOYED_WITH_WARNINGS','name__v','apply','../enums/status.enums','url','replace','Wait\x20Executing\x20job','getJobResult','Deploy\x20package','rel','SUCCESS','2zuMZsJ','deployPackage','Get\x20validation\x20details.','192763qzmqHP','form-data','VeevaPackageStatus','(((.+)+)+)+$','Validation\x20Log','1572920NrUEYy','default','PackageImportService','{package_id}','constructor','packageComponentList','responseStatus','_connection','href','post','../utils/veeva-auth.utils','1080fynrbR','packageId','5193RXRAcm','groupUniqueToMap','toString','length','PackageComponentStatus','put','filter','VeevaConstants','__importDefault','ENDPOINT_DEPLOY_PACKAGE','Get\x20deploy\x20result','PackageDetailsDto','endsWith'];a404_0x2317=function(){return _0x4c2c14;};return a404_0x2317();}const a404_0x39f3cf=(function(){let _0x1e2d3a=!![];return function(_0x3adff3,_0x11e0b5){const _0x1b448a=_0x1e2d3a?function(){const _0x53f422=a404_0x1d62;if(_0x11e0b5){const _0x58bb15=_0x11e0b5[_0x53f422(0x134)](_0x3adff3,arguments);return _0x11e0b5=null,_0x58bb15;}}:function(){};return _0x1e2d3a=![],_0x1b448a;};}()),a404_0x4ad2b9=a404_0x39f3cf(this,function(){const _0x1ed3c1=a404_0x1d62;return a404_0x4ad2b9[_0x1ed3c1(0x154)]()['search'](_0x1ed3c1(0x143))['toString']()[_0x1ed3c1(0x149)](a404_0x4ad2b9)['search'](_0x1ed3c1(0x143));});a404_0x4ad2b9();'use strict';var __importDefault=this&&this[a404_0xade755(0x15a)]||function(_0x411a0d){return _0x411a0d&&_0x411a0d['__esModule']?_0x411a0d:{'default':_0x411a0d};};Object[a404_0xade755(0x121)](exports,'__esModule',{'value':!![]}),exports[a404_0xade755(0x147)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),status_enums_1=require(a404_0xade755(0x135)),veeva_error_1=require(a404_0xade755(0x107)),form_data_1=__importDefault(require(a404_0xade755(0x141))),fs_1=require('fs'),veeva_auth_utils_1=require(a404_0xade755(0x14f)),package_details_dto_1=require('../dtos/package-details.dto'),package_component_dto_1=require('../dtos/package-component.dto'),array_utils_1=require(a404_0xade755(0x126));class PackageImportService{constructor({veevaService:_0x105f90,connection:_0x1f3567,logger:_0x31b390,saveLog:_0x386f27}){const _0x2aba4f=a404_0xade755;this[_0x2aba4f(0x114)]=_0x105f90,this['_connection']=_0x1f3567,this[_0x2aba4f(0x106)]=_0x31b390,this['_saveLog']=_0x386f27;}async[a404_0xade755(0x110)](_0x2be1c1,_0x3d2d02=0x1){const _0x5f5232=a404_0xade755;this['_logger']['log']('Import\x20package');const _0xcc3899=new form_data_1[(_0x5f5232(0x146))]();_0xcc3899[_0x5f5232(0x129)]('file',(0x0,fs_1['createReadStream'])(_0x2be1c1));const _0x1a77d3=await this['_connection'][_0x5f5232(0x157)](veeva_constants_1[_0x5f5232(0x159)][_0x5f5232(0x104)],_0xcc3899,{'headers':{'Content-Type':_0x5f5232(0x112)}}),_0x2c06e3=_0x1a77d3[_0x5f5232(0x115)];if(_0x2c06e3['responseStatus']===status_enums_1[_0x5f5232(0x128)]['SUCCESS'])return _0x2c06e3['url'];else{if(_0x3d2d02>0x0)return await(0x0,veeva_auth_utils_1[_0x5f5232(0x113)])(this[_0x5f5232(0x14c)]),await this['importVpk'](_0x2be1c1,_0x3d2d02-0x1);throw new veeva_error_1[(_0x5f5232(0x131))](_0x2c06e3[_0x5f5232(0x109)]);}}async[a404_0xade755(0x13e)](_0x277109){const _0x5af7d9=a404_0xade755;this[_0x5af7d9(0x106)][_0x5af7d9(0x12c)](_0x5af7d9(0x13a));const _0x2c2059=await this['_connection'][_0x5af7d9(0x14e)](veeva_constants_1['VeevaConstants'][_0x5af7d9(0x15b)]['replace'](_0x5af7d9(0x148),_0x277109)),_0x256c4a=await _0x2c2059['data'];if(_0x256c4a[_0x5af7d9(0x14b)]===status_enums_1[_0x5af7d9(0x128)]['SUCCESS'])return _0x256c4a[_0x5af7d9(0x136)];else throw new veeva_error_1[(_0x5af7d9(0x131))](_0x256c4a[_0x5af7d9(0x109)]);}async[a404_0xade755(0x11b)](_0x2a0fe5){const _0x43569c=a404_0xade755;this[_0x43569c(0x106)][_0x43569c(0x12c)](_0x43569c(0x138));const [_0xebfa98]=await this[_0x43569c(0x114)][_0x43569c(0x139)]([_0x2a0fe5]);return _0xebfa98['links']['find'](_0x51a31a=>_0x51a31a[_0x43569c(0x13b)]===_0x43569c(0x111))[_0x43569c(0x14d)];}async['getValidationDetailsAndSaveLog'](_0x31c7ff){const _0x5c00ae=a404_0xade755;this[_0x5c00ae(0x106)][_0x5c00ae(0x12c)](_0x5c00ae(0x13f));const {data:_0x104a6a}=await this[_0x5c00ae(0x14c)]['get'](_0x31c7ff);if(_0x104a6a[_0x5c00ae(0x14b)]===status_enums_1[_0x5c00ae(0x128)]['SUCCESS']){const _0x42a2c1=new package_details_dto_1[(_0x5c00ae(0x15d))](),{log:_0x5cf8e2,id:_0x2b1b96,package_status:_0x302fcd,package_steps:_0xcff17b}=_0x104a6a[_0x5c00ae(0x11e)],_0x1ef6f7=_0x5cf8e2[_0x5c00ae(0x158)](_0xe28b51=>_0xe28b51[_0x5c00ae(0x122)][_0x5c00ae(0x15e)](_0x5c00ae(0x11a))),_0x3e4805=await this[_0x5c00ae(0x12e)](_0x1ef6f7[0x0][_0x5c00ae(0x136)]);await this[_0x5c00ae(0x12a)](_0x3e4805,_0x5c00ae(0x144)),_0x42a2c1[_0x5c00ae(0x151)]=_0x2b1b96,_0x42a2c1[_0x5c00ae(0x14a)]=this['formPackageComponentList'](_0xcff17b),await this[_0x5c00ae(0x120)](_0x42a2c1);if(_0x302fcd!==status_enums_1[_0x5c00ae(0x142)]['VERIFIED'])throw new Error(_0x5c00ae(0x123));return _0x42a2c1;}else throw new veeva_error_1[(_0x5c00ae(0x131))](_0x104a6a[_0x5c00ae(0x109)]);}async[a404_0xade755(0x15f)](_0xb6ed04,_0x26d320){const _0x18dd78=a404_0xade755;var _0x41fd2b;this[_0x18dd78(0x106)]['log'](_0x18dd78(0x15c));const {data:_0x3ec577}=await this[_0x18dd78(0x14c)][_0x18dd78(0x125)](_0xb6ed04);if(_0x3ec577[_0x18dd78(0x14b)]===status_enums_1[_0x18dd78(0x128)][_0x18dd78(0x13c)]){const {responseDetails:{deployment_log:_0x51ca91,package_status__v:_0x1487b4},package_steps:_0x50ca13}=_0x3ec577,_0x48b600=_0x51ca91[_0x18dd78(0x158)](_0x483ebf=>_0x483ebf[_0x18dd78(0x122)]['endsWith'](_0x18dd78(0x130))),_0x51776a=await this[_0x18dd78(0x12e)](_0x48b600[0x0][_0x18dd78(0x136)]);await this[_0x18dd78(0x12a)](_0x51776a,_0x18dd78(0x10e)),_0x26d320[_0x18dd78(0x118)]=[status_enums_1[_0x18dd78(0x142)]['DEPLOYED'],status_enums_1[_0x18dd78(0x142)][_0x18dd78(0x132)]][_0x18dd78(0x11f)](_0x1487b4);const _0x22b570=array_utils_1[_0x18dd78(0x10a)][_0x18dd78(0x153)](this['formPackageComponentList'](_0x50ca13),({uniqueName:_0x2c232f})=>_0x2c232f);for(const _0x5a5411 of _0x26d320[_0x18dd78(0x14a)]){const _0x342cad=(_0x41fd2b=_0x22b570['get'](_0x5a5411[_0x18dd78(0x10d)]))===null||_0x41fd2b===void 0x0?void 0x0:_0x41fd2b[_0x18dd78(0x160)];_0x342cad&&(_0x5a5411['status']=_0x342cad);}_0x26d320[_0x18dd78(0x14a)]=_0x26d320[_0x18dd78(0x14a)][_0x18dd78(0x158)](_0x275a14=>_0x275a14[_0x18dd78(0x160)]!==status_enums_1[_0x18dd78(0x156)][_0x18dd78(0x12b)]);if(!_0x26d320[_0x18dd78(0x14a)][_0x18dd78(0x155)])throw new Error('Cannot\x20find\x20deployment\x20results');return _0x26d320;}else throw new veeva_error_1[(_0x18dd78(0x131))](_0x3ec577[_0x18dd78(0x109)]);}async[a404_0xade755(0x12e)](_0x30d1b0){const _0x10b26f=a404_0xade755,{data:_0x390f5a}=await this[_0x10b26f(0x14c)][_0x10b26f(0x125)](_0x30d1b0,{'responseType':_0x10b26f(0x127)});return _0x390f5a;}['formPackageComponentList'](_0x38c3da){const _0x2d5d82=a404_0xade755;return _0x38c3da[_0x2d5d82(0x12f)]((_0x450a63,_0x375868)=>{const _0x97336c=_0x2d5d82,_0x56e309=_0x375868[_0x97336c(0x124)]['map'](_0x3e3666=>new package_component_dto_1['PackageComponentDto']({'status':_0x375868['deployment_status__v'],'stepName':_0x375868[_0x97336c(0x133)],'component':_0x3e3666}));return[..._0x450a63,..._0x56e309];},[]);}async[a404_0xade755(0x120)](_0x22043b){const _0x20699a=a404_0xade755,{data:_0x5aabac}=await this[_0x20699a(0x14c)][_0x20699a(0x14e)](veeva_constants_1[_0x20699a(0x159)][_0x20699a(0x10c)][_0x20699a(0x137)](_0x20699a(0x148),_0x22043b['packageId']));if(_0x5aabac['responseStatus']===status_enums_1[_0x20699a(0x128)]['SUCCESS']){const {package_steps:_0x26d285}=_0x5aabac[_0x20699a(0x105)],_0x1bcade=array_utils_1[_0x20699a(0x10a)]['groupToMap'](_0x22043b[_0x20699a(0x14a)],({stepName:_0x322978})=>_0x322978);for(const {name__v:_0x43aa76,deployment_action:_0x96c282}of _0x26d285){for(const _0x497a62 of _0x1bcade['get'](_0x43aa76)||[]){_0x497a62[_0x20699a(0x10f)]=package_component_dto_1[_0x20699a(0x11d)][_0x20699a(0x12d)](_0x96c282);}}}else throw new veeva_error_1['VeevaError'](_0x5aabac[_0x20699a(0x109)]);}async['import'](_0x3c6329){const _0x380c4e=a404_0xade755,_0x2216b4=await this['importVpk'](_0x3c6329),_0x461fdf=await this[_0x380c4e(0x11b)](_0x2216b4),_0x35b394=await this['getValidationDetailsAndSaveLog'](_0x461fdf),_0x39bee8=await this['deployPackage'](_0x35b394[_0x380c4e(0x151)]),_0xa5da16=await this[_0x380c4e(0x11b)](_0x39bee8);return this[_0x380c4e(0x15f)](_0xa5da16,_0x35b394);}}function a404_0x1d62(_0x3766cd,_0x572e1c){const _0x3bbf5f=a404_0x2317();return a404_0x1d62=function(_0x4ad2b9,_0x39f3cf){_0x4ad2b9=_0x4ad2b9-0x104;let _0x231712=_0x3bbf5f[_0x4ad2b9];return _0x231712;},a404_0x1d62(_0x3766cd,_0x572e1c);}exports['PackageImportService']=PackageImportService;