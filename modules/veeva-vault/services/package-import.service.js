const a403_0x5c9611=a403_0x2654;(function(_0x563c54,_0x4456a7){const _0x5b7b95=a403_0x2654,_0x3a5ecf=_0x563c54();while(!![]){try{const _0x10e84b=parseInt(_0x5b7b95(0x1dd))/0x1*(-parseInt(_0x5b7b95(0x1ca))/0x2)+parseInt(_0x5b7b95(0x1ce))/0x3*(-parseInt(_0x5b7b95(0x204))/0x4)+parseInt(_0x5b7b95(0x1c2))/0x5+-parseInt(_0x5b7b95(0x1fd))/0x6*(-parseInt(_0x5b7b95(0x1e2))/0x7)+parseInt(_0x5b7b95(0x1f8))/0x8*(-parseInt(_0x5b7b95(0x203))/0x9)+-parseInt(_0x5b7b95(0x1da))/0xa+parseInt(_0x5b7b95(0x1d1))/0xb;if(_0x10e84b===_0x4456a7)break;else _0x3a5ecf['push'](_0x3a5ecf['shift']());}catch(_0x45be5b){_0x3a5ecf['push'](_0x3a5ecf['shift']());}}}(a403_0x16f0,0x4a010));function a403_0x2654(_0x34e4b9,_0x48126a){const _0x258f10=a403_0x16f0();return a403_0x2654=function(_0x1f1b70,_0x48f900){_0x1f1b70=_0x1f1b70-0x1a6;let _0x16f027=_0x258f10[_0x1f1b70];return _0x16f027;},a403_0x2654(_0x34e4b9,_0x48126a);}const a403_0x48f900=(function(){let _0x423564=!![];return function(_0x5cba20,_0x1b354e){const _0x956082=_0x423564?function(){const _0x5d2ae8=a403_0x2654;if(_0x1b354e){const _0x3e6021=_0x1b354e[_0x5d2ae8(0x1ed)](_0x5cba20,arguments);return _0x1b354e=null,_0x3e6021;}}:function(){};return _0x423564=![],_0x956082;};}()),a403_0x1f1b70=a403_0x48f900(this,function(){const _0x4ed261=a403_0x2654;return a403_0x1f1b70['toString']()['search']('(((.+)+)+)+$')[_0x4ed261(0x1cf)]()['constructor'](a403_0x1f1b70)[_0x4ed261(0x1ea)](_0x4ed261(0x20a));});function a403_0x16f0(){const _0x4456f5=['apply','file','deployPackage','status','Cannot\x20find\x20deployment\x20results','../enums/status.enums','text','PackageDetailsDto','vaultPackage','Deploy\x20Log','Wait\x20Executing\x20job','1569880ingKOb','createReadStream','find','_connection','SUCCESS','1590gZXONN','getDeployDetailsAndSaveLog','import','includes','ArrayUtils','convertDeploymentAction','9VKCIvP','165124cdHywl','updateVeevaConnection','VeevaPackageStatus','VeevaConstants','default','append','(((.+)+)+)+$','log','responseDetails','responseStatus','fillPackageDeploymentAction','ENDPOINT_DEPLOY_PACKAGE','reduce','get','links','_veevaService','Deploy\x20package','../dtos/package-component.dto','package_components','PackageComponentDto','Validation\x20Log','replace','_logger','endsWith','deploymentAction','getLogResultText','getJobDetailUrl','VeevaError','multipart/form-data','VERIFIED','post','_saveLog','__importDefault','DEPLOYED','{package_id}','2195520tcSicj','filter','length','Deployment.log','ENDPOINT_EXPORT_IMPORT_PACKAGE','getValidationDetailsAndSaveLog','Get\x20deploy\x20result','importVpk','2LNeGuc','PackageImportService','DEPLOYED_WITH_WARNINGS','getJobResult','24OcKyaI','toString','Get\x20validation\x20details.','12316953wPJNwG','__esModule','put','errors','packageComponentList','VeevaResponseStatus','../dtos/package-details.dto','packageId','deployment_status__v','4474020MShSad','../utils/array.utils','filename','552917djRsVD','ENDPOINT_VALIDATE_PACKAGE','formPackageComponentList','name__v','groupToMap','7161vHOCah','Validation.log','data','form-data','Import\x20package','defineProperty','url','Package\x20not\x20verified','search','groupUniqueToMap','../constants/veeva.constants'];a403_0x16f0=function(){return _0x4456f5;};return a403_0x16f0();}a403_0x1f1b70();'use strict';var __importDefault=this&&this[a403_0x5c9611(0x1bf)]||function(_0x7abe0f){const _0x448fbc=a403_0x5c9611;return _0x7abe0f&&_0x7abe0f[_0x448fbc(0x1d2)]?_0x7abe0f:{'default':_0x7abe0f};};Object[a403_0x5c9611(0x1e7)](exports,a403_0x5c9611(0x1d2),{'value':!![]}),exports[a403_0x5c9611(0x1cb)]=void 0x0;const veeva_constants_1=require(a403_0x5c9611(0x1ec)),status_enums_1=require(a403_0x5c9611(0x1f2)),veeva_error_1=require('../classes/errors/veeva-error'),form_data_1=__importDefault(require(a403_0x5c9611(0x1e5))),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require(a403_0x5c9611(0x1d7)),package_component_dto_1=require(a403_0x5c9611(0x1b0)),array_utils_1=require(a403_0x5c9611(0x1db));class PackageImportService{constructor({veevaService:_0x4712ed,connection:_0x4c9891,logger:_0x69535b,saveLog:_0x8001a8}){const _0x1433c7=a403_0x5c9611;this[_0x1433c7(0x1ae)]=_0x4712ed,this[_0x1433c7(0x1fb)]=_0x4c9891,this['_logger']=_0x69535b,this[_0x1433c7(0x1be)]=_0x8001a8;}async['importVpk'](_0x853706,_0x9a662f=0x1){const _0x2ce032=a403_0x5c9611;this['_logger']['log'](_0x2ce032(0x1e6));const _0x37e66b=new form_data_1[(_0x2ce032(0x208))]();_0x37e66b[_0x2ce032(0x209)](_0x2ce032(0x1ee),(0x0,fs_1[_0x2ce032(0x1f9)])(_0x853706));const _0x273b69=await this[_0x2ce032(0x1fb)][_0x2ce032(0x1d3)](veeva_constants_1[_0x2ce032(0x207)][_0x2ce032(0x1c6)],_0x37e66b,{'headers':{'Content-Type':_0x2ce032(0x1bb)}}),_0x1d3a0c=_0x273b69['data'];if(_0x1d3a0c[_0x2ce032(0x1a8)]===status_enums_1[_0x2ce032(0x1d6)][_0x2ce032(0x1fc)])return _0x1d3a0c[_0x2ce032(0x1e8)];else{if(_0x9a662f>0x0)return await(0x0,veeva_auth_utils_1[_0x2ce032(0x205)])(this['_connection']),await this['importVpk'](_0x853706,_0x9a662f-0x1);throw new veeva_error_1[(_0x2ce032(0x1ba))](_0x1d3a0c[_0x2ce032(0x1d4)]);}}async[a403_0x5c9611(0x1ef)](_0xb6ddd){const _0x28b6ac=a403_0x5c9611;this[_0x28b6ac(0x1b5)][_0x28b6ac(0x1a6)](_0x28b6ac(0x1af));const _0x58fa5a=await this[_0x28b6ac(0x1fb)][_0x28b6ac(0x1bd)](veeva_constants_1[_0x28b6ac(0x207)][_0x28b6ac(0x1aa)][_0x28b6ac(0x1b4)](_0x28b6ac(0x1c1),_0xb6ddd)),_0x3995dd=await _0x58fa5a[_0x28b6ac(0x1e4)];if(_0x3995dd[_0x28b6ac(0x1a8)]===status_enums_1[_0x28b6ac(0x1d6)][_0x28b6ac(0x1fc)])return _0x3995dd[_0x28b6ac(0x1e8)];else throw new veeva_error_1[(_0x28b6ac(0x1ba))](_0x3995dd['errors']);}async[a403_0x5c9611(0x1b9)](_0x313e1c){const _0x3504af=a403_0x5c9611;this[_0x3504af(0x1b5)]['log'](_0x3504af(0x1f7));const [_0x4aeda7]=await this[_0x3504af(0x1ae)][_0x3504af(0x1cd)]([_0x313e1c]);return _0x4aeda7[_0x3504af(0x1ad)][_0x3504af(0x1fa)](_0x5e7c33=>_0x5e7c33['rel']==='artifacts')['href'];}async[a403_0x5c9611(0x1c7)](_0x3ddb91){const _0x3767a0=a403_0x5c9611;this[_0x3767a0(0x1b5)]['log'](_0x3767a0(0x1d0));const {data:_0x60401f}=await this[_0x3767a0(0x1fb)][_0x3767a0(0x1ac)](_0x3ddb91);if(_0x60401f[_0x3767a0(0x1a8)]===status_enums_1[_0x3767a0(0x1d6)][_0x3767a0(0x1fc)]){const _0x14f53f=new package_details_dto_1[(_0x3767a0(0x1f4))](),{log:_0x39d626,id:_0x5ea121,package_status:_0x17d51a,package_steps:_0x414c87}=_0x60401f[_0x3767a0(0x1f5)],_0x3d587d=_0x39d626[_0x3767a0(0x1c3)](_0x19b23a=>_0x19b23a[_0x3767a0(0x1dc)][_0x3767a0(0x1b6)](_0x3767a0(0x1e3))),_0x5ecd1b=await this[_0x3767a0(0x1b8)](_0x3d587d[0x0]['url']);await this[_0x3767a0(0x1be)](_0x5ecd1b,_0x3767a0(0x1b3)),_0x14f53f[_0x3767a0(0x1d8)]=_0x5ea121,_0x14f53f[_0x3767a0(0x1d5)]=this[_0x3767a0(0x1df)](_0x414c87),await this[_0x3767a0(0x1a9)](_0x14f53f);if(_0x17d51a!==status_enums_1['VeevaPackageStatus'][_0x3767a0(0x1bc)])throw new Error(_0x3767a0(0x1e9));return _0x14f53f;}else throw new veeva_error_1[(_0x3767a0(0x1ba))](_0x60401f[_0x3767a0(0x1d4)]);}async[a403_0x5c9611(0x1fe)](_0x10a8b6,_0x11592a){const _0x5cdeb5=a403_0x5c9611;var _0x508b79;this[_0x5cdeb5(0x1b5)][_0x5cdeb5(0x1a6)](_0x5cdeb5(0x1c8));const {data:_0x3d048a}=await this[_0x5cdeb5(0x1fb)][_0x5cdeb5(0x1ac)](_0x10a8b6);if(_0x3d048a[_0x5cdeb5(0x1a8)]===status_enums_1[_0x5cdeb5(0x1d6)][_0x5cdeb5(0x1fc)]){const {responseDetails:{deployment_log:_0x1ad378,package_status__v:_0x5ca8c6},package_steps:_0x590373}=_0x3d048a,_0x8db8d=_0x1ad378[_0x5cdeb5(0x1c3)](_0x4e27c8=>_0x4e27c8[_0x5cdeb5(0x1dc)]['endsWith'](_0x5cdeb5(0x1c5))),_0x487c8b=await this[_0x5cdeb5(0x1b8)](_0x8db8d[0x0][_0x5cdeb5(0x1e8)]);await this[_0x5cdeb5(0x1be)](_0x487c8b,_0x5cdeb5(0x1f6)),_0x11592a['isDeployed']=[status_enums_1[_0x5cdeb5(0x206)][_0x5cdeb5(0x1c0)],status_enums_1[_0x5cdeb5(0x206)][_0x5cdeb5(0x1cc)]][_0x5cdeb5(0x200)](_0x5ca8c6);const _0x4714b7=array_utils_1[_0x5cdeb5(0x201)][_0x5cdeb5(0x1eb)](this[_0x5cdeb5(0x1df)](_0x590373),({uniqueName:_0x84aa27})=>_0x84aa27);for(const _0x5b87c6 of _0x11592a[_0x5cdeb5(0x1d5)]){const _0x11df54=(_0x508b79=_0x4714b7[_0x5cdeb5(0x1ac)](_0x5b87c6['uniqueName']))===null||_0x508b79===void 0x0?void 0x0:_0x508b79[_0x5cdeb5(0x1f0)];_0x11df54&&(_0x5b87c6[_0x5cdeb5(0x1f0)]=_0x11df54);}_0x11592a[_0x5cdeb5(0x1d5)]=_0x11592a[_0x5cdeb5(0x1d5)][_0x5cdeb5(0x1c3)](_0x485de1=>_0x485de1[_0x5cdeb5(0x1f0)]!==status_enums_1['PackageComponentStatus']['VERIFIED']);if(!_0x11592a[_0x5cdeb5(0x1d5)][_0x5cdeb5(0x1c4)])throw new Error(_0x5cdeb5(0x1f1));return _0x11592a;}else throw new veeva_error_1[(_0x5cdeb5(0x1ba))](_0x3d048a[_0x5cdeb5(0x1d4)]);}async[a403_0x5c9611(0x1b8)](_0x53a110){const _0x10c644=a403_0x5c9611,{data:_0x3234a4}=await this['_connection']['get'](_0x53a110,{'responseType':_0x10c644(0x1f3)});return _0x3234a4;}[a403_0x5c9611(0x1df)](_0xe43916){const _0x2a3dbe=a403_0x5c9611;return _0xe43916[_0x2a3dbe(0x1ab)]((_0x1f2ebc,_0xd2d155)=>{const _0x16be9c=_0x2a3dbe,_0xec09cb=_0xd2d155[_0x16be9c(0x1b1)]['map'](_0x55f9ab=>new package_component_dto_1[(_0x16be9c(0x1b2))]({'status':_0xd2d155[_0x16be9c(0x1d9)],'stepName':_0xd2d155[_0x16be9c(0x1e0)],'component':_0x55f9ab}));return[..._0x1f2ebc,..._0xec09cb];},[]);}async['fillPackageDeploymentAction'](_0x61ba89){const _0x5654c2=a403_0x5c9611,{data:_0x360a44}=await this[_0x5654c2(0x1fb)][_0x5654c2(0x1bd)](veeva_constants_1[_0x5654c2(0x207)][_0x5654c2(0x1de)][_0x5654c2(0x1b4)](_0x5654c2(0x1c1),_0x61ba89[_0x5654c2(0x1d8)]));if(_0x360a44[_0x5654c2(0x1a8)]===status_enums_1[_0x5654c2(0x1d6)]['SUCCESS']){const {package_steps:_0x395484}=_0x360a44[_0x5654c2(0x1a7)],_0x5b269c=array_utils_1[_0x5654c2(0x201)][_0x5654c2(0x1e1)](_0x61ba89['packageComponentList'],({stepName:_0x763501})=>_0x763501);for(const {name__v:_0xe642e8,deployment_action:_0x5ad718}of _0x395484){for(const _0x19bf32 of _0x5b269c[_0x5654c2(0x1ac)](_0xe642e8)||[]){_0x19bf32[_0x5654c2(0x1b7)]=package_component_dto_1['PackageComponentDto'][_0x5654c2(0x202)](_0x5ad718);}}}else throw new veeva_error_1[(_0x5654c2(0x1ba))](_0x360a44[_0x5654c2(0x1d4)]);}async[a403_0x5c9611(0x1ff)](_0x2e30c6){const _0x2a61fd=a403_0x5c9611,_0x5efed3=await this[_0x2a61fd(0x1c9)](_0x2e30c6),_0x3229a2=await this[_0x2a61fd(0x1b9)](_0x5efed3),_0x8e85c4=await this[_0x2a61fd(0x1c7)](_0x3229a2),_0xcc074c=await this[_0x2a61fd(0x1ef)](_0x8e85c4['packageId']),_0x399707=await this[_0x2a61fd(0x1b9)](_0xcc074c);return this[_0x2a61fd(0x1fe)](_0x399707,_0x8e85c4);}}exports[a403_0x5c9611(0x1cb)]=PackageImportService;