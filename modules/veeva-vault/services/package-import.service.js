function a375_0x30bf(){const _0xeab03=['DEPLOYED_WITH_WARNINGS','getValidationDetailsAndSaveLog','__esModule','filter','DEPLOYED','status','../utils/veeva-auth.utils','fillPackageDeploymentAction','ENDPOINT_EXPORT_IMPORT_PACKAGE','_logger','PackageComponentDto','getJobDetailUrl','Deployment.log','defineProperty','filename','Package\x20not\x20verified','Cannot\x20find\x20deployment\x20results','VERIFIED','replace','PackageComponentStatus','formPackageComponentList','../enums/status.enums','1977088uFgSTc','VeevaResponseStatus','search','vaultPackage','32HrWcTa','ENDPOINT_DEPLOY_PACKAGE','../constants/veeva.constants','Get\x20validation\x20details.','VeevaConstants','import','ENDPOINT_VALIDATE_PACKAGE','Wait\x20Executing\x20job','376129FaTTfl','responseStatus','importVpk','_veevaService','deploymentAction','deployment_status__v','../classes/errors/veeva-error','log','913098qeBdFo','{package_id}','VeevaPackageStatus','uniqueName','artifacts','post','2117943betDOY','ArrayUtils','errors','toString','data','(((.+)+)+)+$','groupUniqueToMap','_connection','VeevaError','responseDetails','_saveLog','endsWith','__importDefault','Deploy\x20package','655782mmWhRk','find','getDeployDetailsAndSaveLog','default','file','packageComponentList','Get\x20deploy\x20result','SUCCESS','14rcEdeZ','packageId','reduce','Import\x20package','updateVeevaConnection','append','get','package_components','deployPackage','name__v','getJobResult','1085652itRBZB','382115GzRWzF','PackageDetailsDto','apply','Deploy\x20Log','includes','text','map','../dtos/package-details.dto','convertDeploymentAction','url','Validation.log'];a375_0x30bf=function(){return _0xeab03;};return a375_0x30bf();}function a375_0x12f9(_0x250da2,_0x4123c2){const _0x27572b=a375_0x30bf();return a375_0x12f9=function(_0xbe2a28,_0x366dbd){_0xbe2a28=_0xbe2a28-0x142;let _0x30bf6a=_0x27572b[_0xbe2a28];return _0x30bf6a;},a375_0x12f9(_0x250da2,_0x4123c2);}const a375_0x343169=a375_0x12f9;(function(_0x436e2e,_0x4eb542){const _0x4a4acc=a375_0x12f9,_0x572324=_0x436e2e();while(!![]){try{const _0x21a9e7=parseInt(_0x4a4acc(0x180))/0x1+-parseInt(_0x4a4acc(0x188))/0x2+-parseInt(_0x4a4acc(0x152))/0x3+-parseInt(_0x4a4acc(0x178))/0x4*(-parseInt(_0x4a4acc(0x153))/0x5)+parseInt(_0x4a4acc(0x19c))/0x6*(parseInt(_0x4a4acc(0x147))/0x7)+-parseInt(_0x4a4acc(0x174))/0x8+parseInt(_0x4a4acc(0x18e))/0x9;if(_0x21a9e7===_0x4eb542)break;else _0x572324['push'](_0x572324['shift']());}catch(_0x5ea5d6){_0x572324['push'](_0x572324['shift']());}}}(a375_0x30bf,0x5bc39));const a375_0x366dbd=(function(){let _0x2aa36a=!![];return function(_0x410934,_0x146831){const _0x14b9be=_0x2aa36a?function(){const _0x50ccce=a375_0x12f9;if(_0x146831){const _0xae6be9=_0x146831[_0x50ccce(0x155)](_0x410934,arguments);return _0x146831=null,_0xae6be9;}}:function(){};return _0x2aa36a=![],_0x14b9be;};}()),a375_0xbe2a28=a375_0x366dbd(this,function(){const _0x36d487=a375_0x12f9;return a375_0xbe2a28[_0x36d487(0x191)]()[_0x36d487(0x176)](_0x36d487(0x193))[_0x36d487(0x191)]()['constructor'](a375_0xbe2a28)['search'](_0x36d487(0x193));});a375_0xbe2a28();'use strict';var __importDefault=this&&this[a375_0x343169(0x19a)]||function(_0x58f4be){const _0x1a2c56=a375_0x343169;return _0x58f4be&&_0x58f4be[_0x1a2c56(0x160)]?_0x58f4be:{'default':_0x58f4be};};Object[a375_0x343169(0x16b)](exports,a375_0x343169(0x160),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require(a375_0x343169(0x17a)),status_enums_1=require(a375_0x343169(0x173)),veeva_error_1=require(a375_0x343169(0x186)),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),veeva_auth_utils_1=require(a375_0x343169(0x164)),package_details_dto_1=require(a375_0x343169(0x15a)),package_component_dto_1=require('../dtos/package-component.dto'),array_utils_1=require('../utils/array.utils');class PackageImportService{constructor({veevaService:_0x244b54,connection:_0x455664,logger:_0x4f50ad,saveLog:_0x364937}){const _0x452e92=a375_0x343169;this[_0x452e92(0x183)]=_0x244b54,this['_connection']=_0x455664,this[_0x452e92(0x167)]=_0x4f50ad,this[_0x452e92(0x198)]=_0x364937;}async['importVpk'](_0x3298d5,_0x53dbd3=0x1){const _0x2d0a40=a375_0x343169;this['_logger']['log'](_0x2d0a40(0x14a));const _0x288178=new form_data_1[(_0x2d0a40(0x142))]();_0x288178[_0x2d0a40(0x14c)](_0x2d0a40(0x143),(0x0,fs_1['createReadStream'])(_0x3298d5));const _0x5cffce=await this[_0x2d0a40(0x195)]['put'](veeva_constants_1[_0x2d0a40(0x17c)][_0x2d0a40(0x166)],_0x288178,{'headers':{'Content-Type':'multipart/form-data'}}),_0x3134de=_0x5cffce[_0x2d0a40(0x192)];if(_0x3134de[_0x2d0a40(0x181)]===status_enums_1[_0x2d0a40(0x175)][_0x2d0a40(0x146)])return _0x3134de[_0x2d0a40(0x15c)];else{if(_0x53dbd3>0x0)return await(0x0,veeva_auth_utils_1[_0x2d0a40(0x14b)])(this[_0x2d0a40(0x195)]),await this[_0x2d0a40(0x182)](_0x3298d5,_0x53dbd3-0x1);throw new veeva_error_1[(_0x2d0a40(0x196))](_0x3134de['errors']);}}async['deployPackage'](_0x3cb9fa){const _0x5333ef=a375_0x343169;this[_0x5333ef(0x167)][_0x5333ef(0x187)](_0x5333ef(0x19b));const _0x277adf=await this[_0x5333ef(0x195)][_0x5333ef(0x18d)](veeva_constants_1[_0x5333ef(0x17c)][_0x5333ef(0x179)][_0x5333ef(0x170)](_0x5333ef(0x189),_0x3cb9fa)),_0x5c0ec8=await _0x277adf['data'];if(_0x5c0ec8['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x5333ef(0x146)])return _0x5c0ec8['url'];else throw new veeva_error_1['VeevaError'](_0x5c0ec8[_0x5333ef(0x190)]);}async[a375_0x343169(0x169)](_0x19ba90){const _0x1c8531=a375_0x343169;this['_logger']['log'](_0x1c8531(0x17f));const [_0x1864bb]=await this[_0x1c8531(0x183)][_0x1c8531(0x151)]([_0x19ba90]);return _0x1864bb['links'][_0x1c8531(0x19d)](_0x2e63f7=>_0x2e63f7['rel']===_0x1c8531(0x18c))['href'];}async['getValidationDetailsAndSaveLog'](_0x4ed013){const _0x5a933a=a375_0x343169;this[_0x5a933a(0x167)][_0x5a933a(0x187)](_0x5a933a(0x17b));const {data:_0x5490ad}=await this['_connection'][_0x5a933a(0x14d)](_0x4ed013);if(_0x5490ad[_0x5a933a(0x181)]===status_enums_1[_0x5a933a(0x175)][_0x5a933a(0x146)]){const _0x15ca02=new package_details_dto_1[(_0x5a933a(0x154))](),{log:_0x10aa44,id:_0x5532b6,package_status:_0x131838,package_steps:_0x3d03f6}=_0x5490ad[_0x5a933a(0x177)],_0x5159b4=_0x10aa44[_0x5a933a(0x161)](_0x18da50=>_0x18da50[_0x5a933a(0x16c)][_0x5a933a(0x199)](_0x5a933a(0x15d))),_0x5b0e4d=await this['getLogResultText'](_0x5159b4[0x0]['url']);await this[_0x5a933a(0x198)](_0x5b0e4d,'Validation\x20Log'),_0x15ca02[_0x5a933a(0x148)]=_0x5532b6,_0x15ca02[_0x5a933a(0x144)]=this['formPackageComponentList'](_0x3d03f6),await this[_0x5a933a(0x165)](_0x15ca02);if(_0x131838!==status_enums_1[_0x5a933a(0x18a)][_0x5a933a(0x16f)])throw new Error(_0x5a933a(0x16d));return _0x15ca02;}else throw new veeva_error_1[(_0x5a933a(0x196))](_0x5490ad['errors']);}async[a375_0x343169(0x19e)](_0x1fc3f5,_0x51eef7){const _0x28d16e=a375_0x343169;var _0x133ea;this[_0x28d16e(0x167)]['log'](_0x28d16e(0x145));const {data:_0x2c09e3}=await this[_0x28d16e(0x195)][_0x28d16e(0x14d)](_0x1fc3f5);if(_0x2c09e3[_0x28d16e(0x181)]===status_enums_1['VeevaResponseStatus'][_0x28d16e(0x146)]){const {responseDetails:{deployment_log:_0x1b9040,package_status__v:_0x469e91},package_steps:_0x3b1e4c}=_0x2c09e3,_0x588cb5=_0x1b9040[_0x28d16e(0x161)](_0xa7b85b=>_0xa7b85b[_0x28d16e(0x16c)][_0x28d16e(0x199)](_0x28d16e(0x16a))),_0x53b438=await this['getLogResultText'](_0x588cb5[0x0][_0x28d16e(0x15c)]);await this['_saveLog'](_0x53b438,_0x28d16e(0x156)),_0x51eef7['isDeployed']=[status_enums_1[_0x28d16e(0x18a)][_0x28d16e(0x162)],status_enums_1[_0x28d16e(0x18a)][_0x28d16e(0x15e)]][_0x28d16e(0x157)](_0x469e91);const _0x2aca3c=array_utils_1[_0x28d16e(0x18f)][_0x28d16e(0x194)](this[_0x28d16e(0x172)](_0x3b1e4c),({uniqueName:_0x599fb3})=>_0x599fb3);for(const _0x4d5ae2 of _0x51eef7[_0x28d16e(0x144)]){const _0x551e09=(_0x133ea=_0x2aca3c[_0x28d16e(0x14d)](_0x4d5ae2[_0x28d16e(0x18b)]))===null||_0x133ea===void 0x0?void 0x0:_0x133ea[_0x28d16e(0x163)];_0x551e09&&(_0x4d5ae2['status']=_0x551e09);}_0x51eef7[_0x28d16e(0x144)]=_0x51eef7[_0x28d16e(0x144)][_0x28d16e(0x161)](_0xf020f2=>_0xf020f2[_0x28d16e(0x163)]!==status_enums_1[_0x28d16e(0x171)][_0x28d16e(0x16f)]);if(!_0x51eef7[_0x28d16e(0x144)]['length'])throw new Error(_0x28d16e(0x16e));return _0x51eef7;}else throw new veeva_error_1['VeevaError'](_0x2c09e3[_0x28d16e(0x190)]);}async['getLogResultText'](_0x1235c1){const _0x239930=a375_0x343169,{data:_0x1e87c3}=await this['_connection'][_0x239930(0x14d)](_0x1235c1,{'responseType':_0x239930(0x158)});return _0x1e87c3;}[a375_0x343169(0x172)](_0x13f197){const _0x4690c3=a375_0x343169;return _0x13f197[_0x4690c3(0x149)]((_0x1b35b8,_0x12544e)=>{const _0x5905e5=_0x4690c3,_0x4c48d4=_0x12544e[_0x5905e5(0x14e)][_0x5905e5(0x159)](_0x4581b7=>new package_component_dto_1[(_0x5905e5(0x168))]({'status':_0x12544e[_0x5905e5(0x185)],'stepName':_0x12544e[_0x5905e5(0x150)],'component':_0x4581b7}));return[..._0x1b35b8,..._0x4c48d4];},[]);}async[a375_0x343169(0x165)](_0x21d98c){const _0xf256a5=a375_0x343169,{data:_0x8dc52d}=await this[_0xf256a5(0x195)][_0xf256a5(0x18d)](veeva_constants_1[_0xf256a5(0x17c)][_0xf256a5(0x17e)][_0xf256a5(0x170)](_0xf256a5(0x189),_0x21d98c[_0xf256a5(0x148)]));if(_0x8dc52d[_0xf256a5(0x181)]===status_enums_1[_0xf256a5(0x175)][_0xf256a5(0x146)]){const {package_steps:_0x5bd505}=_0x8dc52d[_0xf256a5(0x197)],_0x430e1f=array_utils_1[_0xf256a5(0x18f)]['groupToMap'](_0x21d98c[_0xf256a5(0x144)],({stepName:_0x52801e})=>_0x52801e);for(const {name__v:_0x118746,deployment_action:_0xa1cb51}of _0x5bd505){for(const _0x22cd76 of _0x430e1f[_0xf256a5(0x14d)](_0x118746)||[]){_0x22cd76[_0xf256a5(0x184)]=package_component_dto_1[_0xf256a5(0x168)][_0xf256a5(0x15b)](_0xa1cb51);}}}else throw new veeva_error_1[(_0xf256a5(0x196))](_0x8dc52d['errors']);}async[a375_0x343169(0x17d)](_0x45ece6){const _0x4ef453=a375_0x343169,_0x4d6b64=await this[_0x4ef453(0x182)](_0x45ece6),_0x3083fd=await this[_0x4ef453(0x169)](_0x4d6b64),_0x4e6ea9=await this[_0x4ef453(0x15f)](_0x3083fd),_0x372045=await this[_0x4ef453(0x14f)](_0x4e6ea9['packageId']),_0x511aac=await this[_0x4ef453(0x169)](_0x372045);return this[_0x4ef453(0x19e)](_0x511aac,_0x4e6ea9);}}exports['PackageImportService']=PackageImportService;