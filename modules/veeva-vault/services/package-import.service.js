const a375_0x323810=a375_0x40d2;(function(_0x5a7ea0,_0x360e41){const _0x3f168f=a375_0x40d2,_0x1872d1=_0x5a7ea0();while(!![]){try{const _0x1337a3=parseInt(_0x3f168f(0x1bf))/0x1*(-parseInt(_0x3f168f(0x170))/0x2)+parseInt(_0x3f168f(0x1c3))/0x3+parseInt(_0x3f168f(0x17b))/0x4*(parseInt(_0x3f168f(0x1be))/0x5)+-parseInt(_0x3f168f(0x18d))/0x6*(-parseInt(_0x3f168f(0x175))/0x7)+parseInt(_0x3f168f(0x1c5))/0x8+parseInt(_0x3f168f(0x1ab))/0x9*(-parseInt(_0x3f168f(0x188))/0xa)+-parseInt(_0x3f168f(0x179))/0xb;if(_0x1337a3===_0x360e41)break;else _0x1872d1['push'](_0x1872d1['shift']());}catch(_0x3ec2c4){_0x1872d1['push'](_0x1872d1['shift']());}}}(a375_0x1347,0x4ca2f));const a375_0x2bd76b=(function(){let _0x3a7018=!![];return function(_0xa14516,_0x1c744d){const _0x5034c8=_0x3a7018?function(){const _0x58416c=a375_0x40d2;if(_0x1c744d){const _0x440c5a=_0x1c744d[_0x58416c(0x1aa)](_0xa14516,arguments);return _0x1c744d=null,_0x440c5a;}}:function(){};return _0x3a7018=![],_0x5034c8;};}()),a375_0x33b162=a375_0x2bd76b(this,function(){const _0x28f147=a375_0x40d2;return a375_0x33b162[_0x28f147(0x1b1)]()[_0x28f147(0x184)](_0x28f147(0x171))[_0x28f147(0x1b1)]()[_0x28f147(0x197)](a375_0x33b162)[_0x28f147(0x184)]('(((.+)+)+)+$');});a375_0x33b162();'use strict';function a375_0x1347(){const _0xb03c7b=['filter','{package_id}','5045nKUYbj','766TWdKgz','text','Deploy\x20package','Deployment.log','401643CGzEdh','Package\x20not\x20verified','4075608chHqJq','artifacts','../constants/veeva.constants','Cannot\x20find\x20deployment\x20results','file','_saveLog','data','replace','1218YuCmpq','(((.+)+)+)+$','defineProperty','find','PackageImportService','7XRiVtx','default','deployment_status__v','Validation\x20Log','6808043RttUOB','importVpk','2092YcvcVo','getLogResultText','reduce','responseStatus','convertDeploymentAction','getJobResult','groupUniqueToMap','errors','log','search','updateVeevaConnection','status','Get\x20validation\x20details.','6060qxbNix','../utils/array.utils','deployPackage','_veevaService','PackageComponentDto','3191262mEbumt','__esModule','url','packageId','deploymentAction','VeevaPackageStatus','formPackageComponentList','vaultPackage','isDeployed','PackageDetailsDto','constructor','fillPackageDeploymentAction','VeevaConstants','VeevaResponseStatus','ENDPOINT_DEPLOY_PACKAGE','responseDetails','getJobDetailUrl','DEPLOYED_WITH_WARNINGS','form-data','Import\x20package','../dtos/package-details.dto','filename','getDeployDetailsAndSaveLog','endsWith','VeevaError','uniqueName','_logger','href','ArrayUtils','apply','4509DJaQfR','ENDPOINT_EXPORT_IMPORT_PACKAGE','append','VERIFIED','getValidationDetailsAndSaveLog','post','toString','SUCCESS','includes','get','_connection','rel','DEPLOYED','Validation.log','packageComponentList','groupToMap','package_components'];a375_0x1347=function(){return _0xb03c7b;};return a375_0x1347();}var __importDefault=this&&this['__importDefault']||function(_0x232190){const _0x5a6b3f=a375_0x40d2;return _0x232190&&_0x232190[_0x5a6b3f(0x18e)]?_0x232190:{'default':_0x232190};};function a375_0x40d2(_0x542cbc,_0x3a4980){const _0x1f9ad0=a375_0x1347();return a375_0x40d2=function(_0x33b162,_0x2bd76b){_0x33b162=_0x33b162-0x16d;let _0x1347d8=_0x1f9ad0[_0x33b162];return _0x1347d8;},a375_0x40d2(_0x542cbc,_0x3a4980);}Object[a375_0x323810(0x172)](exports,a375_0x323810(0x18e),{'value':!![]}),exports[a375_0x323810(0x174)]=void 0x0;const veeva_constants_1=require(a375_0x323810(0x1c7)),status_enums_1=require('../enums/status.enums'),veeva_error_1=require('../classes/errors/veeva-error'),form_data_1=__importDefault(require(a375_0x323810(0x19f))),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require(a375_0x323810(0x1a1)),package_component_dto_1=require('../dtos/package-component.dto'),array_utils_1=require(a375_0x323810(0x189));class PackageImportService{constructor({veevaService:_0x556c08,connection:_0x3bc828,logger:_0x1db9a6,saveLog:_0x29d6d5}){const _0x3a6ec2=a375_0x323810;this[_0x3a6ec2(0x18b)]=_0x556c08,this[_0x3a6ec2(0x1b5)]=_0x3bc828,this['_logger']=_0x1db9a6,this[_0x3a6ec2(0x16d)]=_0x29d6d5;}async[a375_0x323810(0x17a)](_0x1fdb30,_0x591f68=0x1){const _0x3404d0=a375_0x323810;this[_0x3404d0(0x1a7)][_0x3404d0(0x183)](_0x3404d0(0x1a0));const _0xa0d59b=new form_data_1[(_0x3404d0(0x176))]();_0xa0d59b[_0x3404d0(0x1ad)](_0x3404d0(0x1c9),(0x0,fs_1['createReadStream'])(_0x1fdb30));const _0x3ce454=await this[_0x3404d0(0x1b5)]['put'](veeva_constants_1['VeevaConstants'][_0x3404d0(0x1ac)],_0xa0d59b,{'headers':{'Content-Type':'multipart/form-data'}}),_0x1bc99b=_0x3ce454[_0x3404d0(0x16e)];if(_0x1bc99b[_0x3404d0(0x17e)]===status_enums_1[_0x3404d0(0x19a)][_0x3404d0(0x1b2)])return _0x1bc99b[_0x3404d0(0x18f)];else{if(_0x591f68>0x0)return await(0x0,veeva_auth_utils_1[_0x3404d0(0x185)])(this[_0x3404d0(0x1b5)]),await this[_0x3404d0(0x17a)](_0x1fdb30,_0x591f68-0x1);throw new veeva_error_1[(_0x3404d0(0x1a5))](_0x1bc99b[_0x3404d0(0x182)]);}}async[a375_0x323810(0x18a)](_0x26a69b){const _0x286e23=a375_0x323810;this[_0x286e23(0x1a7)][_0x286e23(0x183)](_0x286e23(0x1c1));const _0xbe9b5d=await this[_0x286e23(0x1b5)]['post'](veeva_constants_1[_0x286e23(0x199)][_0x286e23(0x19b)][_0x286e23(0x16f)](_0x286e23(0x1bd),_0x26a69b)),_0x3e18cc=await _0xbe9b5d[_0x286e23(0x16e)];if(_0x3e18cc[_0x286e23(0x17e)]===status_enums_1[_0x286e23(0x19a)][_0x286e23(0x1b2)])return _0x3e18cc[_0x286e23(0x18f)];else throw new veeva_error_1[(_0x286e23(0x1a5))](_0x3e18cc[_0x286e23(0x182)]);}async[a375_0x323810(0x19d)](_0x35b1c){const _0x3f93ca=a375_0x323810;this[_0x3f93ca(0x1a7)][_0x3f93ca(0x183)]('Wait\x20Executing\x20job');const [_0x2c60c7]=await this[_0x3f93ca(0x18b)][_0x3f93ca(0x180)]([_0x35b1c]);return _0x2c60c7['links'][_0x3f93ca(0x173)](_0x5ab153=>_0x5ab153[_0x3f93ca(0x1b6)]===_0x3f93ca(0x1c6))[_0x3f93ca(0x1a8)];}async[a375_0x323810(0x1af)](_0x5bc3af){const _0x5384a5=a375_0x323810;this[_0x5384a5(0x1a7)]['log'](_0x5384a5(0x187));const {data:_0x43b7dd}=await this[_0x5384a5(0x1b5)][_0x5384a5(0x1b4)](_0x5bc3af);if(_0x43b7dd[_0x5384a5(0x17e)]===status_enums_1[_0x5384a5(0x19a)][_0x5384a5(0x1b2)]){const _0x9158bf=new package_details_dto_1[(_0x5384a5(0x196))](),{log:_0x5d619b,id:_0x45e750,package_status:_0x412edc,package_steps:_0x273735}=_0x43b7dd[_0x5384a5(0x194)],_0x2ed898=_0x5d619b[_0x5384a5(0x1bc)](_0x1c172b=>_0x1c172b[_0x5384a5(0x1a2)][_0x5384a5(0x1a4)](_0x5384a5(0x1b8))),_0x55165a=await this[_0x5384a5(0x17c)](_0x2ed898[0x0]['url']);await this['_saveLog'](_0x55165a,_0x5384a5(0x178)),_0x9158bf[_0x5384a5(0x190)]=_0x45e750,_0x9158bf[_0x5384a5(0x1b9)]=this[_0x5384a5(0x193)](_0x273735),await this[_0x5384a5(0x198)](_0x9158bf);if(_0x412edc!==status_enums_1[_0x5384a5(0x192)][_0x5384a5(0x1ae)])throw new Error(_0x5384a5(0x1c4));return _0x9158bf;}else throw new veeva_error_1[(_0x5384a5(0x1a5))](_0x43b7dd[_0x5384a5(0x182)]);}async['getDeployDetailsAndSaveLog'](_0x34b19e,_0x15dfd4){const _0x171309=a375_0x323810;var _0x27b5ac;this['_logger'][_0x171309(0x183)]('Get\x20deploy\x20result');const {data:_0x5984fa}=await this['_connection']['get'](_0x34b19e);if(_0x5984fa[_0x171309(0x17e)]===status_enums_1[_0x171309(0x19a)][_0x171309(0x1b2)]){const {responseDetails:{deployment_log:_0x6e6b8e,package_status__v:_0x469896},package_steps:_0x587b6e}=_0x5984fa,_0x615fc5=_0x6e6b8e['filter'](_0x1700ef=>_0x1700ef[_0x171309(0x1a2)]['endsWith'](_0x171309(0x1c2))),_0x85648=await this[_0x171309(0x17c)](_0x615fc5[0x0][_0x171309(0x18f)]);await this[_0x171309(0x16d)](_0x85648,'Deploy\x20Log'),_0x15dfd4[_0x171309(0x195)]=[status_enums_1[_0x171309(0x192)][_0x171309(0x1b7)],status_enums_1[_0x171309(0x192)][_0x171309(0x19e)]][_0x171309(0x1b3)](_0x469896);const _0x57c29d=array_utils_1['ArrayUtils'][_0x171309(0x181)](this[_0x171309(0x193)](_0x587b6e),({uniqueName:_0x5c85cb})=>_0x5c85cb);for(const _0x357c26 of _0x15dfd4[_0x171309(0x1b9)]){const _0x50f591=(_0x27b5ac=_0x57c29d['get'](_0x357c26[_0x171309(0x1a6)]))===null||_0x27b5ac===void 0x0?void 0x0:_0x27b5ac[_0x171309(0x186)];_0x50f591&&(_0x357c26[_0x171309(0x186)]=_0x50f591);}_0x15dfd4[_0x171309(0x1b9)]=_0x15dfd4[_0x171309(0x1b9)][_0x171309(0x1bc)](_0x37c0fb=>_0x37c0fb['status']!==status_enums_1['PackageComponentStatus'][_0x171309(0x1ae)]);if(!_0x15dfd4['packageComponentList']['length'])throw new Error(_0x171309(0x1c8));return _0x15dfd4;}else throw new veeva_error_1[(_0x171309(0x1a5))](_0x5984fa['errors']);}async[a375_0x323810(0x17c)](_0x1d8527){const _0x5d38c9=a375_0x323810,{data:_0xf6f6c2}=await this[_0x5d38c9(0x1b5)][_0x5d38c9(0x1b4)](_0x1d8527,{'responseType':_0x5d38c9(0x1c0)});return _0xf6f6c2;}[a375_0x323810(0x193)](_0x2ceb78){const _0x436ff8=a375_0x323810;return _0x2ceb78[_0x436ff8(0x17d)]((_0x211f9a,_0xc9d524)=>{const _0x3af6a2=_0x436ff8,_0x17773c=_0xc9d524[_0x3af6a2(0x1bb)]['map'](_0xe8b34f=>new package_component_dto_1[(_0x3af6a2(0x18c))]({'status':_0xc9d524[_0x3af6a2(0x177)],'stepName':_0xc9d524['name__v'],'component':_0xe8b34f}));return[..._0x211f9a,..._0x17773c];},[]);}async[a375_0x323810(0x198)](_0x53aef2){const _0x5d3cfd=a375_0x323810,{data:_0x25d779}=await this[_0x5d3cfd(0x1b5)][_0x5d3cfd(0x1b0)](veeva_constants_1[_0x5d3cfd(0x199)]['ENDPOINT_VALIDATE_PACKAGE'][_0x5d3cfd(0x16f)](_0x5d3cfd(0x1bd),_0x53aef2[_0x5d3cfd(0x190)]));if(_0x25d779['responseStatus']===status_enums_1[_0x5d3cfd(0x19a)][_0x5d3cfd(0x1b2)]){const {package_steps:_0x3e5d1b}=_0x25d779[_0x5d3cfd(0x19c)],_0x26a9d9=array_utils_1[_0x5d3cfd(0x1a9)][_0x5d3cfd(0x1ba)](_0x53aef2[_0x5d3cfd(0x1b9)],({stepName:_0x4dd7f5})=>_0x4dd7f5);for(const {name__v:_0x59e0e5,deployment_action:_0xe7caae}of _0x3e5d1b){for(const _0x3f8c0d of _0x26a9d9[_0x5d3cfd(0x1b4)](_0x59e0e5)||[]){_0x3f8c0d[_0x5d3cfd(0x191)]=package_component_dto_1[_0x5d3cfd(0x18c)][_0x5d3cfd(0x17f)](_0xe7caae);}}}else throw new veeva_error_1[(_0x5d3cfd(0x1a5))](_0x25d779[_0x5d3cfd(0x182)]);}async['import'](_0x5d9179){const _0x19225b=a375_0x323810,_0x5279cb=await this[_0x19225b(0x17a)](_0x5d9179),_0x433f17=await this[_0x19225b(0x19d)](_0x5279cb),_0x1aed14=await this[_0x19225b(0x1af)](_0x433f17),_0x38d565=await this[_0x19225b(0x18a)](_0x1aed14[_0x19225b(0x190)]),_0x2be683=await this[_0x19225b(0x19d)](_0x38d565);return this[_0x19225b(0x1a3)](_0x2be683,_0x1aed14);}}exports['PackageImportService']=PackageImportService;