const a403_0x2c8998=a403_0x4b88;(function(_0x39c102,_0x10d0d8){const _0x38de50=a403_0x4b88,_0x3201da=_0x39c102();while(!![]){try{const _0x4aa4dd=-parseInt(_0x38de50(0x1f7))/0x1*(parseInt(_0x38de50(0x1f9))/0x2)+parseInt(_0x38de50(0x1d8))/0x3+-parseInt(_0x38de50(0x230))/0x4*(-parseInt(_0x38de50(0x1e0))/0x5)+-parseInt(_0x38de50(0x224))/0x6+parseInt(_0x38de50(0x1ec))/0x7*(-parseInt(_0x38de50(0x1fa))/0x8)+parseInt(_0x38de50(0x1fd))/0x9+parseInt(_0x38de50(0x1f2))/0xa*(parseInt(_0x38de50(0x207))/0xb);if(_0x4aa4dd===_0x10d0d8)break;else _0x3201da['push'](_0x3201da['shift']());}catch(_0x36d727){_0x3201da['push'](_0x3201da['shift']());}}}(a403_0xc8f1,0x28e29));function a403_0x4b88(_0x1f3ea3,_0x267950){const _0x21c36e=a403_0xc8f1();return a403_0x4b88=function(_0x503c31,_0x30cea7){_0x503c31=_0x503c31-0x1d7;let _0xc8f16c=_0x21c36e[_0x503c31];return _0xc8f16c;},a403_0x4b88(_0x1f3ea3,_0x267950);}const a403_0x30cea7=(function(){let _0x53acd3=!![];return function(_0x27f236,_0x56bbcf){const _0x17c018=_0x53acd3?function(){const _0xf75be2=a403_0x4b88;if(_0x56bbcf){const _0x2b70f4=_0x56bbcf[_0xf75be2(0x209)](_0x27f236,arguments);return _0x56bbcf=null,_0x2b70f4;}}:function(){};return _0x53acd3=![],_0x17c018;};}()),a403_0x503c31=a403_0x30cea7(this,function(){const _0x557a23=a403_0x4b88;return a403_0x503c31[_0x557a23(0x21d)]()[_0x557a23(0x203)](_0x557a23(0x1ef))[_0x557a23(0x21d)]()['constructor'](a403_0x503c31)[_0x557a23(0x203)](_0x557a23(0x1ef));});a403_0x503c31();'use strict';var __importDefault=this&&this[a403_0x2c8998(0x20b)]||function(_0x10391a){const _0x4c471a=a403_0x2c8998;return _0x10391a&&_0x10391a[_0x4c471a(0x1fc)]?_0x10391a:{'default':_0x10391a};};Object[a403_0x2c8998(0x22c)](exports,a403_0x2c8998(0x1fc),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),status_enums_1=require(a403_0x2c8998(0x1da)),veeva_error_1=require(a403_0x2c8998(0x1f3)),form_data_1=__importDefault(require(a403_0x2c8998(0x204))),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require(a403_0x2c8998(0x1e5)),package_component_dto_1=require('../dtos/package-component.dto'),array_utils_1=require(a403_0x2c8998(0x1dc));class PackageImportService{constructor({veevaService:_0x31c39d,connection:_0x65c10a,logger:_0x2a8e1b,saveLog:_0x85b3ae}){const _0x483b3c=a403_0x2c8998;this[_0x483b3c(0x22b)]=_0x31c39d,this[_0x483b3c(0x22d)]=_0x65c10a,this[_0x483b3c(0x1d9)]=_0x2a8e1b,this[_0x483b3c(0x1e2)]=_0x85b3ae;}async[a403_0x2c8998(0x231)](_0x295ff1,_0x80c401=0x1){const _0x577cea=a403_0x2c8998;this[_0x577cea(0x1d9)][_0x577cea(0x205)](_0x577cea(0x21a));const _0x59d3fa=new form_data_1[(_0x577cea(0x22a))]();_0x59d3fa['append']('file',(0x0,fs_1[_0x577cea(0x223)])(_0x295ff1));const _0x1a52cc=await this[_0x577cea(0x22d)][_0x577cea(0x219)](veeva_constants_1[_0x577cea(0x1fb)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x59d3fa,{'headers':{'Content-Type':_0x577cea(0x225)}}),_0x63af59=_0x1a52cc[_0x577cea(0x1e4)];if(_0x63af59[_0x577cea(0x1dd)]===status_enums_1['VeevaResponseStatus']['SUCCESS'])return _0x63af59[_0x577cea(0x21e)];else{if(_0x80c401>0x0)return await(0x0,veeva_auth_utils_1[_0x577cea(0x20c)])(this[_0x577cea(0x22d)]),await this[_0x577cea(0x231)](_0x295ff1,_0x80c401-0x1);throw new veeva_error_1[(_0x577cea(0x1de))](_0x63af59[_0x577cea(0x1e6)]);}}async[a403_0x2c8998(0x221)](_0xfd6501){const _0x56af09=a403_0x2c8998;this['_logger'][_0x56af09(0x205)](_0x56af09(0x1ff));const _0x2d6935=await this[_0x56af09(0x22d)][_0x56af09(0x213)](veeva_constants_1['VeevaConstants'][_0x56af09(0x201)]['replace'](_0x56af09(0x1ed),_0xfd6501)),_0x32a626=await _0x2d6935['data'];if(_0x32a626[_0x56af09(0x1dd)]===status_enums_1['VeevaResponseStatus'][_0x56af09(0x1f4)])return _0x32a626[_0x56af09(0x21e)];else throw new veeva_error_1[(_0x56af09(0x1de))](_0x32a626[_0x56af09(0x1e6)]);}async[a403_0x2c8998(0x1fe)](_0x5764e2){const _0x6af774=a403_0x2c8998;this[_0x6af774(0x1d9)][_0x6af774(0x205)]('Wait\x20Executing\x20job');const [_0x5eb001]=await this[_0x6af774(0x22b)][_0x6af774(0x22e)]([_0x5764e2]);return _0x5eb001['links']['find'](_0x301755=>_0x301755[_0x6af774(0x1e3)]==='artifacts')[_0x6af774(0x1d7)];}async['getValidationDetailsAndSaveLog'](_0x3d73ab){const _0x52a2c9=a403_0x2c8998;this[_0x52a2c9(0x1d9)]['log'](_0x52a2c9(0x21c));const {data:_0x125b39}=await this[_0x52a2c9(0x22d)]['get'](_0x3d73ab);if(_0x125b39[_0x52a2c9(0x1dd)]===status_enums_1['VeevaResponseStatus'][_0x52a2c9(0x1f4)]){const _0x13a245=new package_details_dto_1[(_0x52a2c9(0x21f))](),{log:_0x5eec5f,id:_0x2935a4,package_status:_0x4cf6bd,package_steps:_0x40dcce}=_0x125b39[_0x52a2c9(0x217)],_0x1e897d=_0x5eec5f['filter'](_0x40f85b=>_0x40f85b['filename'][_0x52a2c9(0x206)]('Validation.log')),_0x4dd0f8=await this[_0x52a2c9(0x208)](_0x1e897d[0x0][_0x52a2c9(0x21e)]);await this[_0x52a2c9(0x1e2)](_0x4dd0f8,_0x52a2c9(0x214)),_0x13a245[_0x52a2c9(0x1e7)]=_0x2935a4,_0x13a245[_0x52a2c9(0x226)]=this[_0x52a2c9(0x1e8)](_0x40dcce),await this['fillPackageDeploymentAction'](_0x13a245);if(_0x4cf6bd!==status_enums_1[_0x52a2c9(0x212)][_0x52a2c9(0x202)])throw new Error(_0x52a2c9(0x20f));return _0x13a245;}else throw new veeva_error_1[(_0x52a2c9(0x1de))](_0x125b39[_0x52a2c9(0x1e6)]);}async['getDeployDetailsAndSaveLog'](_0x58e1d8,_0x2827c2){const _0xc3dbb5=a403_0x2c8998;var _0x1d8395;this[_0xc3dbb5(0x1d9)][_0xc3dbb5(0x205)]('Get\x20deploy\x20result');const {data:_0x344daf}=await this[_0xc3dbb5(0x22d)][_0xc3dbb5(0x218)](_0x58e1d8);if(_0x344daf[_0xc3dbb5(0x1dd)]===status_enums_1[_0xc3dbb5(0x1eb)][_0xc3dbb5(0x1f4)]){const {responseDetails:{deployment_log:_0x45e6d6,package_status__v:_0x12a37c},package_steps:_0x48df97}=_0x344daf,_0x27a2b0=_0x45e6d6[_0xc3dbb5(0x211)](_0x29c179=>_0x29c179[_0xc3dbb5(0x1f1)][_0xc3dbb5(0x206)](_0xc3dbb5(0x200))),_0x3196b3=await this[_0xc3dbb5(0x208)](_0x27a2b0[0x0]['url']);await this[_0xc3dbb5(0x1e2)](_0x3196b3,'Deploy\x20Log'),_0x2827c2[_0xc3dbb5(0x21b)]=[status_enums_1['VeevaPackageStatus']['DEPLOYED'],status_enums_1[_0xc3dbb5(0x212)][_0xc3dbb5(0x1e9)]][_0xc3dbb5(0x229)](_0x12a37c);const _0x14fec3=array_utils_1[_0xc3dbb5(0x1ea)]['groupUniqueToMap'](this[_0xc3dbb5(0x1e8)](_0x48df97),({uniqueName:_0xf8157})=>_0xf8157);for(const _0x1ef6da of _0x2827c2[_0xc3dbb5(0x226)]){const _0x534945=(_0x1d8395=_0x14fec3[_0xc3dbb5(0x218)](_0x1ef6da[_0xc3dbb5(0x227)]))===null||_0x1d8395===void 0x0?void 0x0:_0x1d8395[_0xc3dbb5(0x1df)];_0x534945&&(_0x1ef6da[_0xc3dbb5(0x1df)]=_0x534945);}_0x2827c2[_0xc3dbb5(0x226)]=_0x2827c2[_0xc3dbb5(0x226)][_0xc3dbb5(0x211)](_0x272d91=>_0x272d91['status']!==status_enums_1[_0xc3dbb5(0x1e1)]['VERIFIED']);if(!_0x2827c2['packageComponentList'][_0xc3dbb5(0x215)])throw new Error(_0xc3dbb5(0x20e));return _0x2827c2;}else throw new veeva_error_1['VeevaError'](_0x344daf[_0xc3dbb5(0x1e6)]);}async['getLogResultText'](_0x2358e4){const _0x5e1e0c=a403_0x2c8998,{data:_0x9a8891}=await this[_0x5e1e0c(0x22d)][_0x5e1e0c(0x218)](_0x2358e4,{'responseType':_0x5e1e0c(0x216)});return _0x9a8891;}[a403_0x2c8998(0x1e8)](_0x353803){const _0x349d15=a403_0x2c8998;return _0x353803[_0x349d15(0x1f0)]((_0x31475d,_0x3013ca)=>{const _0x3e3cb9=_0x349d15,_0x57d41b=_0x3013ca['package_components'][_0x3e3cb9(0x20a)](_0x2904bb=>new package_component_dto_1[(_0x3e3cb9(0x220))]({'status':_0x3013ca[_0x3e3cb9(0x1f5)],'stepName':_0x3013ca[_0x3e3cb9(0x20d)],'component':_0x2904bb}));return[..._0x31475d,..._0x57d41b];},[]);}async['fillPackageDeploymentAction'](_0x2b46ea){const _0x473a8b=a403_0x2c8998,{data:_0x23fc6f}=await this[_0x473a8b(0x22d)][_0x473a8b(0x213)](veeva_constants_1[_0x473a8b(0x1fb)][_0x473a8b(0x210)][_0x473a8b(0x1f8)](_0x473a8b(0x1ed),_0x2b46ea[_0x473a8b(0x1e7)]));if(_0x23fc6f[_0x473a8b(0x1dd)]===status_enums_1['VeevaResponseStatus'][_0x473a8b(0x1f4)]){const {package_steps:_0x351ce8}=_0x23fc6f[_0x473a8b(0x1ee)],_0x5d98ed=array_utils_1[_0x473a8b(0x1ea)]['groupToMap'](_0x2b46ea['packageComponentList'],({stepName:_0x38118f})=>_0x38118f);for(const {name__v:_0x53dbad,deployment_action:_0xb7d688}of _0x351ce8){for(const _0x431aa1 of _0x5d98ed[_0x473a8b(0x218)](_0x53dbad)||[]){_0x431aa1[_0x473a8b(0x1db)]=package_component_dto_1[_0x473a8b(0x220)][_0x473a8b(0x222)](_0xb7d688);}}}else throw new veeva_error_1[(_0x473a8b(0x1de))](_0x23fc6f[_0x473a8b(0x1e6)]);}async[a403_0x2c8998(0x228)](_0x412441){const _0x484336=a403_0x2c8998,_0x13f6cb=await this[_0x484336(0x231)](_0x412441),_0x4d7ad6=await this['getJobDetailUrl'](_0x13f6cb),_0x207a9a=await this[_0x484336(0x1f6)](_0x4d7ad6),_0x2cf116=await this[_0x484336(0x221)](_0x207a9a[_0x484336(0x1e7)]),_0x20d817=await this[_0x484336(0x1fe)](_0x2cf116);return this[_0x484336(0x22f)](_0x20d817,_0x207a9a);}}exports['PackageImportService']=PackageImportService;function a403_0xc8f1(){const _0x285f43=['getJobResult','getDeployDetailsAndSaveLog','793040wNzgQs','importVpk','href','569478peMcsu','_logger','../enums/status.enums','deploymentAction','../utils/array.utils','responseStatus','VeevaError','status','5YpUcyu','PackageComponentStatus','_saveLog','rel','data','../dtos/package-details.dto','errors','packageId','formPackageComponentList','DEPLOYED_WITH_WARNINGS','ArrayUtils','VeevaResponseStatus','7DdXpOK','{package_id}','responseDetails','(((.+)+)+)+$','reduce','filename','1680nfwbBt','../classes/errors/veeva-error','SUCCESS','deployment_status__v','getValidationDetailsAndSaveLog','1jotPDX','replace','326508Skmypr','579288iLmJHI','VeevaConstants','__esModule','733707iHustd','getJobDetailUrl','Deploy\x20package','Deployment.log','ENDPOINT_DEPLOY_PACKAGE','VERIFIED','search','form-data','log','endsWith','16522FeVPWD','getLogResultText','apply','map','__importDefault','updateVeevaConnection','name__v','Cannot\x20find\x20deployment\x20results','Package\x20not\x20verified','ENDPOINT_VALIDATE_PACKAGE','filter','VeevaPackageStatus','post','Validation\x20Log','length','text','vaultPackage','get','put','Import\x20package','isDeployed','Get\x20validation\x20details.','toString','url','PackageDetailsDto','PackageComponentDto','deployPackage','convertDeploymentAction','createReadStream','1912890UUbLnw','multipart/form-data','packageComponentList','uniqueName','import','includes','default','_veevaService','defineProperty','_connection'];a403_0xc8f1=function(){return _0x285f43;};return a403_0xc8f1();}