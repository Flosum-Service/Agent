const a404_0x154147=a404_0x231f;(function(_0x5d06cb,_0x11bcf0){const _0x10604d=a404_0x231f,_0x5d21f7=_0x5d06cb();while(!![]){try{const _0x2d2fde=parseInt(_0x10604d(0x13e))/0x1+-parseInt(_0x10604d(0x128))/0x2*(parseInt(_0x10604d(0x15e))/0x3)+-parseInt(_0x10604d(0x15a))/0x4*(parseInt(_0x10604d(0x140))/0x5)+parseInt(_0x10604d(0x124))/0x6*(parseInt(_0x10604d(0x158))/0x7)+-parseInt(_0x10604d(0x166))/0x8*(parseInt(_0x10604d(0x127))/0x9)+parseInt(_0x10604d(0x15d))/0xa+-parseInt(_0x10604d(0x13f))/0xb*(-parseInt(_0x10604d(0x10d))/0xc);if(_0x2d2fde===_0x11bcf0)break;else _0x5d21f7['push'](_0x5d21f7['shift']());}catch(_0x3487c1){_0x5d21f7['push'](_0x5d21f7['shift']());}}}(a404_0x199a,0x1c879));const a404_0x2e1d31=(function(){let _0x326713=!![];return function(_0x4e0903,_0x2fd6b6){const _0x190bc9=_0x326713?function(){const _0x39a614=a404_0x231f;if(_0x2fd6b6){const _0x4f1e44=_0x2fd6b6[_0x39a614(0x11a)](_0x4e0903,arguments);return _0x2fd6b6=null,_0x4f1e44;}}:function(){};return _0x326713=![],_0x190bc9;};}()),a404_0x88fb89=a404_0x2e1d31(this,function(){const _0x8f9d6f=a404_0x231f;return a404_0x88fb89['toString']()[_0x8f9d6f(0x161)](_0x8f9d6f(0x138))[_0x8f9d6f(0x13a)]()['constructor'](a404_0x88fb89)[_0x8f9d6f(0x161)]('(((.+)+)+)+$');});a404_0x88fb89();'use strict';var __importDefault=this&&this[a404_0x154147(0x112)]||function(_0x377a10){const _0x3547a0=a404_0x154147;return _0x377a10&&_0x377a10[_0x3547a0(0x150)]?_0x377a10:{'default':_0x377a10};};function a404_0x231f(_0x2b631f,_0x1031c3){const _0x50d3ac=a404_0x199a();return a404_0x231f=function(_0x88fb89,_0x2e1d31){_0x88fb89=_0x88fb89-0x109;let _0x199ab4=_0x50d3ac[_0x88fb89];return _0x199ab4;},a404_0x231f(_0x2b631f,_0x1031c3);}function a404_0x199a(){const _0x376c3f=['../enums/status.enums','getDeployDetailsAndSaveLog','packageId','VeevaPackageStatus','12Rclabx','length','Validation.log','_veevaService','log','__importDefault','_connection','post','convertDeploymentAction','DEPLOYED_WITH_WARNINGS','isDeployed','errors','Get\x20validation\x20details.','apply','../utils/array.utils','file','name__v','includes','../dtos/package-component.dto','Package\x20not\x20verified','DEPLOYED','get','createReadStream','685914hosXpl','{package_id}','../classes/errors/veeva-error','108xLuewe','8iqKAXk','status','Validation\x20Log','Deploy\x20Log','Deployment.log','filter','multipart/form-data','vaultPackage','Import\x20package','SUCCESS','filename','responseStatus','artifacts','href','../utils/veeva-auth.utils','getLogResultText','(((.+)+)+)+$','VERIFIED','toString','formPackageComponentList','../dtos/package-details.dto','ENDPOINT_EXPORT_IMPORT_PACKAGE','21663DDwlxf','924011MkXCZx','40sddEVG','deployPackage','getJobResult','replace','responseDetails','rel','updateVeevaConnection','links','fillPackageDeploymentAction','Deploy\x20package','ENDPOINT_VALIDATE_PACKAGE','data','form-data','reduce','find','uniqueName','__esModule','endsWith','deployment_status__v','../constants/veeva.constants','VeevaResponseStatus','packageComponentList','PackageDetailsDto','_saveLog','7YzqWcI','_logger','22328VVdKtp','importVpk','PackageComponentDto','669940PgZfRV','41475BBsHYf','deploymentAction','url','search','ArrayUtils','getValidationDetailsAndSaveLog','import','Get\x20deploy\x20result','46776BlqWzZ','put','map','defineProperty','getJobDetailUrl','Wait\x20Executing\x20job','default','VeevaError','VeevaConstants','PackageImportService','ENDPOINT_DEPLOY_PACKAGE'];a404_0x199a=function(){return _0x376c3f;};return a404_0x199a();}Object[a404_0x154147(0x169)](exports,a404_0x154147(0x150),{'value':!![]}),exports[a404_0x154147(0x16f)]=void 0x0;const veeva_constants_1=require(a404_0x154147(0x153)),status_enums_1=require(a404_0x154147(0x109)),veeva_error_1=require(a404_0x154147(0x126)),form_data_1=__importDefault(require(a404_0x154147(0x14c))),fs_1=require('fs'),veeva_auth_utils_1=require(a404_0x154147(0x136)),package_details_dto_1=require(a404_0x154147(0x13c)),package_component_dto_1=require(a404_0x154147(0x11f)),array_utils_1=require(a404_0x154147(0x11b));class PackageImportService{constructor({veevaService:_0x57eb02,connection:_0x40b265,logger:_0x960663,saveLog:_0x3b9c07}){const _0x202be8=a404_0x154147;this[_0x202be8(0x110)]=_0x57eb02,this[_0x202be8(0x113)]=_0x40b265,this[_0x202be8(0x159)]=_0x960663,this[_0x202be8(0x157)]=_0x3b9c07;}async[a404_0x154147(0x15b)](_0x754a05,_0x5c0d7d=0x1){const _0x1bf9ab=a404_0x154147;this['_logger'][_0x1bf9ab(0x111)](_0x1bf9ab(0x130));const _0x548267=new form_data_1[(_0x1bf9ab(0x16c))]();_0x548267['append'](_0x1bf9ab(0x11c),(0x0,fs_1[_0x1bf9ab(0x123)])(_0x754a05));const _0x29ffec=await this[_0x1bf9ab(0x113)][_0x1bf9ab(0x167)](veeva_constants_1[_0x1bf9ab(0x16e)][_0x1bf9ab(0x13d)],_0x548267,{'headers':{'Content-Type':_0x1bf9ab(0x12e)}}),_0x56d091=_0x29ffec[_0x1bf9ab(0x14b)];if(_0x56d091[_0x1bf9ab(0x133)]===status_enums_1[_0x1bf9ab(0x154)][_0x1bf9ab(0x131)])return _0x56d091[_0x1bf9ab(0x160)];else{if(_0x5c0d7d>0x0)return await(0x0,veeva_auth_utils_1[_0x1bf9ab(0x146)])(this['_connection']),await this[_0x1bf9ab(0x15b)](_0x754a05,_0x5c0d7d-0x1);throw new veeva_error_1[(_0x1bf9ab(0x16d))](_0x56d091['errors']);}}async[a404_0x154147(0x141)](_0xe4e911){const _0x1928d5=a404_0x154147;this[_0x1928d5(0x159)]['log'](_0x1928d5(0x149));const _0x5ad810=await this['_connection']['post'](veeva_constants_1['VeevaConstants'][_0x1928d5(0x170)][_0x1928d5(0x143)](_0x1928d5(0x125),_0xe4e911)),_0x13ac49=await _0x5ad810[_0x1928d5(0x14b)];if(_0x13ac49[_0x1928d5(0x133)]===status_enums_1[_0x1928d5(0x154)][_0x1928d5(0x131)])return _0x13ac49[_0x1928d5(0x160)];else throw new veeva_error_1[(_0x1928d5(0x16d))](_0x13ac49[_0x1928d5(0x118)]);}async[a404_0x154147(0x16a)](_0x37afab){const _0x450790=a404_0x154147;this[_0x450790(0x159)][_0x450790(0x111)](_0x450790(0x16b));const [_0x390355]=await this[_0x450790(0x110)][_0x450790(0x142)]([_0x37afab]);return _0x390355[_0x450790(0x147)][_0x450790(0x14e)](_0x50d794=>_0x50d794[_0x450790(0x145)]===_0x450790(0x134))[_0x450790(0x135)];}async[a404_0x154147(0x163)](_0x3cd771){const _0x194428=a404_0x154147;this[_0x194428(0x159)][_0x194428(0x111)](_0x194428(0x119));const {data:_0x5df2de}=await this[_0x194428(0x113)][_0x194428(0x122)](_0x3cd771);if(_0x5df2de[_0x194428(0x133)]===status_enums_1[_0x194428(0x154)][_0x194428(0x131)]){const _0x5093e8=new package_details_dto_1[(_0x194428(0x156))](),{log:_0x388047,id:_0x3804fb,package_status:_0x5245f3,package_steps:_0x38a0b5}=_0x5df2de[_0x194428(0x12f)],_0x3f4103=_0x388047[_0x194428(0x12d)](_0x1e234e=>_0x1e234e[_0x194428(0x132)][_0x194428(0x151)](_0x194428(0x10f))),_0x1d1aea=await this[_0x194428(0x137)](_0x3f4103[0x0][_0x194428(0x160)]);await this[_0x194428(0x157)](_0x1d1aea,_0x194428(0x12a)),_0x5093e8[_0x194428(0x10b)]=_0x3804fb,_0x5093e8[_0x194428(0x155)]=this[_0x194428(0x13b)](_0x38a0b5),await this[_0x194428(0x148)](_0x5093e8);if(_0x5245f3!==status_enums_1[_0x194428(0x10c)]['VERIFIED'])throw new Error(_0x194428(0x120));return _0x5093e8;}else throw new veeva_error_1[(_0x194428(0x16d))](_0x5df2de[_0x194428(0x118)]);}async[a404_0x154147(0x10a)](_0x3b0e7e,_0x4be7ea){const _0x42799f=a404_0x154147;var _0x5ec9e9;this[_0x42799f(0x159)]['log'](_0x42799f(0x165));const {data:_0x401f04}=await this['_connection'][_0x42799f(0x122)](_0x3b0e7e);if(_0x401f04['responseStatus']===status_enums_1[_0x42799f(0x154)]['SUCCESS']){const {responseDetails:{deployment_log:_0x404e52,package_status__v:_0x5d0a54},package_steps:_0x531757}=_0x401f04,_0x107b26=_0x404e52[_0x42799f(0x12d)](_0x1eb25a=>_0x1eb25a[_0x42799f(0x132)][_0x42799f(0x151)](_0x42799f(0x12c))),_0x290bac=await this[_0x42799f(0x137)](_0x107b26[0x0][_0x42799f(0x160)]);await this[_0x42799f(0x157)](_0x290bac,_0x42799f(0x12b)),_0x4be7ea[_0x42799f(0x117)]=[status_enums_1[_0x42799f(0x10c)][_0x42799f(0x121)],status_enums_1[_0x42799f(0x10c)][_0x42799f(0x116)]][_0x42799f(0x11e)](_0x5d0a54);const _0x2600b4=array_utils_1[_0x42799f(0x162)]['groupUniqueToMap'](this[_0x42799f(0x13b)](_0x531757),({uniqueName:_0x46ecd6})=>_0x46ecd6);for(const _0x48fb5e of _0x4be7ea[_0x42799f(0x155)]){const _0x515abf=(_0x5ec9e9=_0x2600b4[_0x42799f(0x122)](_0x48fb5e[_0x42799f(0x14f)]))===null||_0x5ec9e9===void 0x0?void 0x0:_0x5ec9e9[_0x42799f(0x129)];_0x515abf&&(_0x48fb5e[_0x42799f(0x129)]=_0x515abf);}_0x4be7ea[_0x42799f(0x155)]=_0x4be7ea[_0x42799f(0x155)][_0x42799f(0x12d)](_0x37e93f=>_0x37e93f[_0x42799f(0x129)]!==status_enums_1['PackageComponentStatus'][_0x42799f(0x139)]);if(!_0x4be7ea[_0x42799f(0x155)][_0x42799f(0x10e)])throw new Error('Cannot\x20find\x20deployment\x20results');return _0x4be7ea;}else throw new veeva_error_1[(_0x42799f(0x16d))](_0x401f04[_0x42799f(0x118)]);}async['getLogResultText'](_0x12ed49){const _0x557b84=a404_0x154147,{data:_0x4261e6}=await this['_connection'][_0x557b84(0x122)](_0x12ed49,{'responseType':'text'});return _0x4261e6;}['formPackageComponentList'](_0x233dd0){const _0x3ab920=a404_0x154147;return _0x233dd0[_0x3ab920(0x14d)]((_0x147cc3,_0x2b2d8c)=>{const _0x5f3c26=_0x3ab920,_0x318885=_0x2b2d8c['package_components'][_0x5f3c26(0x168)](_0x3ae25e=>new package_component_dto_1['PackageComponentDto']({'status':_0x2b2d8c[_0x5f3c26(0x152)],'stepName':_0x2b2d8c[_0x5f3c26(0x11d)],'component':_0x3ae25e}));return[..._0x147cc3,..._0x318885];},[]);}async[a404_0x154147(0x148)](_0x385839){const _0x4ae2fb=a404_0x154147,{data:_0x233df0}=await this[_0x4ae2fb(0x113)][_0x4ae2fb(0x114)](veeva_constants_1[_0x4ae2fb(0x16e)][_0x4ae2fb(0x14a)][_0x4ae2fb(0x143)](_0x4ae2fb(0x125),_0x385839[_0x4ae2fb(0x10b)]));if(_0x233df0[_0x4ae2fb(0x133)]===status_enums_1[_0x4ae2fb(0x154)]['SUCCESS']){const {package_steps:_0x6b1b6c}=_0x233df0[_0x4ae2fb(0x144)],_0x475010=array_utils_1['ArrayUtils']['groupToMap'](_0x385839[_0x4ae2fb(0x155)],({stepName:_0x45c8cd})=>_0x45c8cd);for(const {name__v:_0x28cba4,deployment_action:_0x587635}of _0x6b1b6c){for(const _0x32853e of _0x475010[_0x4ae2fb(0x122)](_0x28cba4)||[]){_0x32853e[_0x4ae2fb(0x15f)]=package_component_dto_1[_0x4ae2fb(0x15c)][_0x4ae2fb(0x115)](_0x587635);}}}else throw new veeva_error_1[(_0x4ae2fb(0x16d))](_0x233df0[_0x4ae2fb(0x118)]);}async[a404_0x154147(0x164)](_0x298205){const _0x428074=a404_0x154147,_0x35adf1=await this[_0x428074(0x15b)](_0x298205),_0x26aec7=await this[_0x428074(0x16a)](_0x35adf1),_0x4d316c=await this['getValidationDetailsAndSaveLog'](_0x26aec7),_0x47c050=await this[_0x428074(0x141)](_0x4d316c['packageId']),_0x3daff4=await this[_0x428074(0x16a)](_0x47c050);return this['getDeployDetailsAndSaveLog'](_0x3daff4,_0x4d316c);}}exports[a404_0x154147(0x16f)]=PackageImportService;