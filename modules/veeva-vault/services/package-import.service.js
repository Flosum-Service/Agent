function a359_0xad7c(_0xe3222c,_0x457134){const _0x4fe9fc=a359_0xdd00();return a359_0xad7c=function(_0x33d8f,_0x284090){_0x33d8f=_0x33d8f-0x70;let _0xdd00af=_0x4fe9fc[_0x33d8f];return _0xdd00af;},a359_0xad7c(_0xe3222c,_0x457134);}const a359_0x2e7e95=a359_0xad7c;(function(_0x3c8d86,_0x29f9ec){const _0x548383=a359_0xad7c,_0x24138a=_0x3c8d86();while(!![]){try{const _0x5c7728=parseInt(_0x548383(0xa5))/0x1+-parseInt(_0x548383(0x8d))/0x2+-parseInt(_0x548383(0xc1))/0x3+parseInt(_0x548383(0x70))/0x4*(-parseInt(_0x548383(0x71))/0x5)+parseInt(_0x548383(0xb0))/0x6*(parseInt(_0x548383(0x74))/0x7)+parseInt(_0x548383(0x84))/0x8+parseInt(_0x548383(0x9a))/0x9*(parseInt(_0x548383(0xaf))/0xa);if(_0x5c7728===_0x29f9ec)break;else _0x24138a['push'](_0x24138a['shift']());}catch(_0x396d23){_0x24138a['push'](_0x24138a['shift']());}}}(a359_0xdd00,0x21c92));const a359_0x284090=(function(){let _0x5df9b3=!![];return function(_0x39aca8,_0x1af1f9){const _0x39e3b6=_0x5df9b3?function(){if(_0x1af1f9){const _0x57cc16=_0x1af1f9['apply'](_0x39aca8,arguments);return _0x1af1f9=null,_0x57cc16;}}:function(){};return _0x5df9b3=![],_0x39e3b6;};}()),a359_0x33d8f=a359_0x284090(this,function(){const _0x14e1e9=a359_0xad7c;return a359_0x33d8f[_0x14e1e9(0xac)]()[_0x14e1e9(0x96)](_0x14e1e9(0x7d))[_0x14e1e9(0xac)]()[_0x14e1e9(0x90)](a359_0x33d8f)[_0x14e1e9(0x96)](_0x14e1e9(0x7d));});a359_0x33d8f();function a359_0xdd00(){const _0x1a3d0a=['getValidationDetailsAndSaveLog','packageComponentList','map','{package_id}','PackageImportService','search','_saveLog','getJobDetailUrl','name__v','13077DdKwjp','status','Get\x20deploy\x20result','data','ENDPOINT_DEPLOY_PACKAGE','DEPLOYED_WITH_WARNINGS','getDeployDetailsAndSaveLog','url','../constants/veeva.constants','_veevaService','../classes/errors/veeva-error','21242rvMpRb','filename','../dtos/package-details.dto','groupToMap','Deploy\x20Log','SUCCESS','../enums/status.enums','toString','uniqueName','file','710kdSdAJ','1243806rqPMVH','VeevaResponseStatus','Validation\x20Log','../dtos/package-component.dto','isDeployed','defineProperty','VeevaPackageStatus','package_components','includes','convertDeploymentAction','PackageComponentStatus','importVpk','put','endsWith','deployPackage','getLogResultText','createReadStream','41718Pqzpvc','fillPackageDeploymentAction','updateVeevaConnection','replace','__importDefault','VeevaError','errors','responseStatus','get','multipart/form-data','href','2696HTcwsr','410FhSvxM','packageId','Import\x20package','7eeMWjQ','_logger','PackageComponentDto','default','artifacts','groupUniqueToMap','VERIFIED','Cannot\x20find\x20deployment\x20results','Deploy\x20package','(((.+)+)+)+$','filter','post','reduce','Package\x20not\x20verified','import','length','249104paNZCe','find','_connection','formPackageComponentList','__esModule','ENDPOINT_EXPORT_IMPORT_PACKAGE','Wait\x20Executing\x20job','VeevaConstants','ArrayUtils','310568LfilGf','deploymentAction','log','constructor'];a359_0xdd00=function(){return _0x1a3d0a;};return a359_0xdd00();}'use strict';var __importDefault=this&&this[a359_0x2e7e95(0xc5)]||function(_0x107a0e){return _0x107a0e&&_0x107a0e['__esModule']?_0x107a0e:{'default':_0x107a0e};};Object[a359_0x2e7e95(0xb5)](exports,a359_0x2e7e95(0x88),{'value':!![]}),exports[a359_0x2e7e95(0x95)]=void 0x0;const veeva_constants_1=require(a359_0x2e7e95(0xa2)),status_enums_1=require(a359_0x2e7e95(0xab)),veeva_error_1=require(a359_0x2e7e95(0xa4)),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require(a359_0x2e7e95(0xa7)),package_component_dto_1=require(a359_0x2e7e95(0xb3)),array_utils_1=require('../utils/array.utils');class PackageImportService{constructor({veevaService:_0x3238c3,connection:_0x57346b,logger:_0xfe84ef,saveLog:_0xd61044}){const _0x5c6486=a359_0x2e7e95;this[_0x5c6486(0xa3)]=_0x3238c3,this[_0x5c6486(0x86)]=_0x57346b,this['_logger']=_0xfe84ef,this[_0x5c6486(0x97)]=_0xd61044;}async[a359_0x2e7e95(0xbb)](_0x5f4b12,_0x3d9345=0x1){const _0xbec023=a359_0x2e7e95;this[_0xbec023(0x75)][_0xbec023(0x8f)](_0xbec023(0x73));const _0x1f08d7=new form_data_1[(_0xbec023(0x77))]();_0x1f08d7['append'](_0xbec023(0xae),(0x0,fs_1[_0xbec023(0xc0)])(_0x5f4b12));const _0x2cbeaf=await this[_0xbec023(0x86)][_0xbec023(0xbc)](veeva_constants_1['VeevaConstants'][_0xbec023(0x89)],_0x1f08d7,{'headers':{'Content-Type':_0xbec023(0xca)}}),_0x2d8a08=_0x2cbeaf[_0xbec023(0x9d)];if(_0x2d8a08[_0xbec023(0xc8)]===status_enums_1['VeevaResponseStatus']['SUCCESS'])return _0x2d8a08[_0xbec023(0xa1)];else{if(_0x3d9345>0x0)return await(0x0,veeva_auth_utils_1[_0xbec023(0xc3)])(this[_0xbec023(0x86)]),await this[_0xbec023(0xbb)](_0x5f4b12,_0x3d9345-0x1);throw new veeva_error_1['VeevaError'](_0x2d8a08[_0xbec023(0xc7)]);}}async[a359_0x2e7e95(0xbe)](_0x93c8bf){const _0x1e5270=a359_0x2e7e95;this[_0x1e5270(0x75)][_0x1e5270(0x8f)](_0x1e5270(0x7c));const _0x3cf942=await this['_connection'][_0x1e5270(0x7f)](veeva_constants_1[_0x1e5270(0x8b)][_0x1e5270(0x9e)][_0x1e5270(0xc4)](_0x1e5270(0x94),_0x93c8bf)),_0x3439d9=await _0x3cf942[_0x1e5270(0x9d)];if(_0x3439d9[_0x1e5270(0xc8)]===status_enums_1[_0x1e5270(0xb1)][_0x1e5270(0xaa)])return _0x3439d9[_0x1e5270(0xa1)];else throw new veeva_error_1[(_0x1e5270(0xc6))](_0x3439d9[_0x1e5270(0xc7)]);}async[a359_0x2e7e95(0x98)](_0x3a7d4d){const _0x3c0e06=a359_0x2e7e95;this[_0x3c0e06(0x75)][_0x3c0e06(0x8f)](_0x3c0e06(0x8a));const [_0x49f28f]=await this[_0x3c0e06(0xa3)]['getJobResult']([_0x3a7d4d]);return _0x49f28f['links'][_0x3c0e06(0x85)](_0x121989=>_0x121989['rel']===_0x3c0e06(0x78))[_0x3c0e06(0xcb)];}async[a359_0x2e7e95(0x91)](_0x5b118e){const _0x5d3af6=a359_0x2e7e95;this[_0x5d3af6(0x75)]['log']('Get\x20validation\x20details.');const {data:_0x5cbb07}=await this[_0x5d3af6(0x86)][_0x5d3af6(0xc9)](_0x5b118e);if(_0x5cbb07[_0x5d3af6(0xc8)]===status_enums_1[_0x5d3af6(0xb1)]['SUCCESS']){const _0x20f705=new package_details_dto_1['PackageDetailsDto'](),{log:_0x3af5ef,id:_0x216265,package_status:_0x3243c2,package_steps:_0x33f020}=_0x5cbb07['vaultPackage'],_0x11eb46=_0x3af5ef[_0x5d3af6(0x7e)](_0x5345b1=>_0x5345b1[_0x5d3af6(0xa6)][_0x5d3af6(0xbd)]('Validation.log')),_0x2a3d33=await this['getLogResultText'](_0x11eb46[0x0]['url']);await this['_saveLog'](_0x2a3d33,_0x5d3af6(0xb2)),_0x20f705[_0x5d3af6(0x72)]=_0x216265,_0x20f705[_0x5d3af6(0x92)]=this['formPackageComponentList'](_0x33f020),await this[_0x5d3af6(0xc2)](_0x20f705);if(_0x3243c2!==status_enums_1[_0x5d3af6(0xb6)]['VERIFIED'])throw new Error(_0x5d3af6(0x81));return _0x20f705;}else throw new veeva_error_1[(_0x5d3af6(0xc6))](_0x5cbb07['errors']);}async[a359_0x2e7e95(0xa0)](_0x4b96a3,_0x1111d2){const _0x329877=a359_0x2e7e95;var _0x21df9a;this[_0x329877(0x75)][_0x329877(0x8f)](_0x329877(0x9c));const {data:_0x4a3166}=await this[_0x329877(0x86)]['get'](_0x4b96a3);if(_0x4a3166[_0x329877(0xc8)]===status_enums_1['VeevaResponseStatus'][_0x329877(0xaa)]){const {responseDetails:{deployment_log:_0x3ac368,package_status__v:_0xbe333},package_steps:_0x3c1d29}=_0x4a3166,_0x56feb9=_0x3ac368[_0x329877(0x7e)](_0x15abdf=>_0x15abdf['filename'][_0x329877(0xbd)]('Deployment.log')),_0x193fe4=await this[_0x329877(0xbf)](_0x56feb9[0x0][_0x329877(0xa1)]);await this[_0x329877(0x97)](_0x193fe4,_0x329877(0xa9)),_0x1111d2[_0x329877(0xb4)]=[status_enums_1[_0x329877(0xb6)]['DEPLOYED'],status_enums_1['VeevaPackageStatus'][_0x329877(0x9f)]][_0x329877(0xb8)](_0xbe333);const _0x1c5a56=array_utils_1['ArrayUtils'][_0x329877(0x79)](this[_0x329877(0x87)](_0x3c1d29),({uniqueName:_0x3c1c11})=>_0x3c1c11);for(const _0x494325 of _0x1111d2['packageComponentList']){const _0x33e5c5=(_0x21df9a=_0x1c5a56['get'](_0x494325[_0x329877(0xad)]))===null||_0x21df9a===void 0x0?void 0x0:_0x21df9a[_0x329877(0x9b)];_0x33e5c5&&(_0x494325[_0x329877(0x9b)]=_0x33e5c5);}_0x1111d2[_0x329877(0x92)]=_0x1111d2[_0x329877(0x92)][_0x329877(0x7e)](_0x5e9d82=>_0x5e9d82['status']!==status_enums_1[_0x329877(0xba)][_0x329877(0x7a)]);if(!_0x1111d2[_0x329877(0x92)][_0x329877(0x83)])throw new Error(_0x329877(0x7b));return _0x1111d2;}else throw new veeva_error_1[(_0x329877(0xc6))](_0x4a3166[_0x329877(0xc7)]);}async[a359_0x2e7e95(0xbf)](_0x1685b1){const _0x54a56c=a359_0x2e7e95,{data:_0xebfa53}=await this['_connection'][_0x54a56c(0xc9)](_0x1685b1,{'responseType':'text'});return _0xebfa53;}[a359_0x2e7e95(0x87)](_0x56a75a){const _0xac3acb=a359_0x2e7e95;return _0x56a75a[_0xac3acb(0x80)]((_0x4bf3a3,_0x5c8e2e)=>{const _0xd218a5=_0xac3acb,_0x39fb39=_0x5c8e2e[_0xd218a5(0xb7)][_0xd218a5(0x93)](_0x4a8e4e=>new package_component_dto_1[(_0xd218a5(0x76))]({'status':_0x5c8e2e['deployment_status__v'],'stepName':_0x5c8e2e[_0xd218a5(0x99)],'component':_0x4a8e4e}));return[..._0x4bf3a3,..._0x39fb39];},[]);}async[a359_0x2e7e95(0xc2)](_0x3d8684){const _0xb31076=a359_0x2e7e95,{data:_0x186b6e}=await this[_0xb31076(0x86)]['post'](veeva_constants_1[_0xb31076(0x8b)]['ENDPOINT_VALIDATE_PACKAGE']['replace'](_0xb31076(0x94),_0x3d8684[_0xb31076(0x72)]));if(_0x186b6e[_0xb31076(0xc8)]===status_enums_1[_0xb31076(0xb1)][_0xb31076(0xaa)]){const {package_steps:_0x5956ce}=_0x186b6e['responseDetails'],_0x101c4e=array_utils_1[_0xb31076(0x8c)][_0xb31076(0xa8)](_0x3d8684[_0xb31076(0x92)],({stepName:_0x189ff2})=>_0x189ff2);for(const {name__v:_0x5d28eb,deployment_action:_0x556523}of _0x5956ce){for(const _0x4303ee of _0x101c4e[_0xb31076(0xc9)](_0x5d28eb)||[]){_0x4303ee[_0xb31076(0x8e)]=package_component_dto_1[_0xb31076(0x76)][_0xb31076(0xb9)](_0x556523);}}}else throw new veeva_error_1[(_0xb31076(0xc6))](_0x186b6e[_0xb31076(0xc7)]);}async[a359_0x2e7e95(0x82)](_0x2ce2e1){const _0x4a5e29=a359_0x2e7e95,_0x1f6f5f=await this[_0x4a5e29(0xbb)](_0x2ce2e1),_0xce733f=await this[_0x4a5e29(0x98)](_0x1f6f5f),_0x4a6b47=await this[_0x4a5e29(0x91)](_0xce733f),_0x32893a=await this[_0x4a5e29(0xbe)](_0x4a6b47[_0x4a5e29(0x72)]),_0x17f147=await this['getJobDetailUrl'](_0x32893a);return this[_0x4a5e29(0xa0)](_0x17f147,_0x4a6b47);}}exports['PackageImportService']=PackageImportService;