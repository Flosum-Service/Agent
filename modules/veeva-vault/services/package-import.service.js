const a403_0x4d6c76=a403_0x39ac;(function(_0x5e1371,_0x1785e1){const _0x20f7ed=a403_0x39ac,_0x5769cd=_0x5e1371();while(!![]){try{const _0x2ca297=parseInt(_0x20f7ed(0x1b6))/0x1*(parseInt(_0x20f7ed(0x181))/0x2)+-parseInt(_0x20f7ed(0x178))/0x3*(-parseInt(_0x20f7ed(0x1a6))/0x4)+parseInt(_0x20f7ed(0x1b5))/0x5*(parseInt(_0x20f7ed(0x15f))/0x6)+parseInt(_0x20f7ed(0x17b))/0x7*(-parseInt(_0x20f7ed(0x166))/0x8)+parseInt(_0x20f7ed(0x1ba))/0x9*(parseInt(_0x20f7ed(0x188))/0xa)+-parseInt(_0x20f7ed(0x1ae))/0xb*(-parseInt(_0x20f7ed(0x1b7))/0xc)+-parseInt(_0x20f7ed(0x1a8))/0xd*(parseInt(_0x20f7ed(0x1bb))/0xe);if(_0x2ca297===_0x1785e1)break;else _0x5769cd['push'](_0x5769cd['shift']());}catch(_0x41e7fe){_0x5769cd['push'](_0x5769cd['shift']());}}}(a403_0x5729,0x61bb3));const a403_0x33bbd1=(function(){let _0x58cdc9=!![];return function(_0x529beb,_0x306f78){const _0x23e086=_0x58cdc9?function(){const _0x89fed9=a403_0x39ac;if(_0x306f78){const _0x3abdf6=_0x306f78[_0x89fed9(0x199)](_0x529beb,arguments);return _0x306f78=null,_0x3abdf6;}}:function(){};return _0x58cdc9=![],_0x23e086;};}()),a403_0x20bc34=a403_0x33bbd1(this,function(){const _0x42cf3f=a403_0x39ac;return a403_0x20bc34[_0x42cf3f(0x18a)]()['search'](_0x42cf3f(0x1b2))[_0x42cf3f(0x18a)]()[_0x42cf3f(0x15e)](a403_0x20bc34)[_0x42cf3f(0x17a)]('(((.+)+)+)+$');});a403_0x20bc34();function a403_0x5729(){const _0x5164ee=['Import\x20package','packageId','ENDPOINT_EXPORT_IMPORT_PACKAGE','PackageComponentDto','_veevaService','PackageImportService','status','1308jAYZUL','../dtos/package-component.dto','53937jGpLNL','Deploy\x20package','importVpk','url','get','responseStatus','11QjJbNP','fillPackageDeploymentAction','deployPackage','Package\x20not\x20verified','(((.+)+)+)+$','defineProperty','post','112435cRirmb','331uPErtR','3003096PnHdpM','ArrayUtils','_logger','416934BKHpcW','7616WFlrUH','ENDPOINT_VALIDATE_PACKAGE','log','replace','import','../utils/array.utils','Get\x20validation\x20details.','filter','SUCCESS','getJobResult','default','constructor','174jevVWx','groupToMap','Cannot\x20find\x20deployment\x20results','uniqueName','vaultPackage','../enums/status.enums','VeevaPackageStatus','2136pcTDFG','Deployment.log','Get\x20deploy\x20result','includes','deployment_status__v','put','__esModule','rel','PackageComponentStatus','errors','getJobDetailUrl','VeevaError','getDeployDetailsAndSaveLog','../constants/veeva.constants','formPackageComponentList','Deploy\x20Log','Validation\x20Log','map','5331GVjIEi','href','search','7105oHxAWK','{package_id}','deploymentAction','getValidationDetailsAndSaveLog','Wait\x20Executing\x20job','isDeployed','3972uwVeAt','PackageDetailsDto','groupUniqueToMap','file','ENDPOINT_DEPLOY_PACKAGE','reduce','artifacts','170XrbJCO','filename','toString','name__v','../dtos/package-details.dto','VeevaResponseStatus','Validation.log','_saveLog','text','append','links','_connection','endsWith','VERIFIED','packageComponentList','../utils/veeva-auth.utils','find','apply','data','getLogResultText','VeevaConstants','form-data','DEPLOYED'];a403_0x5729=function(){return _0x5164ee;};return a403_0x5729();}function a403_0x39ac(_0x6f60fb,_0x1b98c9){const _0x783909=a403_0x5729();return a403_0x39ac=function(_0x20bc34,_0x33bbd1){_0x20bc34=_0x20bc34-0x15e;let _0x5729e6=_0x783909[_0x20bc34];return _0x5729e6;},a403_0x39ac(_0x6f60fb,_0x1b98c9);}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x431cfb){const _0x13d254=a403_0x39ac;return _0x431cfb&&_0x431cfb[_0x13d254(0x16c)]?_0x431cfb:{'default':_0x431cfb};};Object[a403_0x4d6c76(0x1b3)](exports,'__esModule',{'value':!![]}),exports[a403_0x4d6c76(0x1a4)]=void 0x0;const veeva_constants_1=require(a403_0x4d6c76(0x173)),status_enums_1=require(a403_0x4d6c76(0x164)),veeva_error_1=require('../classes/errors/veeva-error'),form_data_1=__importDefault(require(a403_0x4d6c76(0x19d))),fs_1=require('fs'),veeva_auth_utils_1=require(a403_0x4d6c76(0x197)),package_details_dto_1=require(a403_0x4d6c76(0x18c)),package_component_dto_1=require(a403_0x4d6c76(0x1a7)),array_utils_1=require(a403_0x4d6c76(0x1c0));class PackageImportService{constructor({veevaService:_0x48e45d,connection:_0x1281f9,logger:_0x4216f0,saveLog:_0xf08482}){const _0x4ab737=a403_0x4d6c76;this[_0x4ab737(0x1a3)]=_0x48e45d,this[_0x4ab737(0x193)]=_0x1281f9,this[_0x4ab737(0x1b9)]=_0x4216f0,this[_0x4ab737(0x18f)]=_0xf08482;}async[a403_0x4d6c76(0x1aa)](_0x23786f,_0x2cecf0=0x1){const _0x21189b=a403_0x4d6c76;this['_logger']['log'](_0x21189b(0x19f));const _0x664f18=new form_data_1[(_0x21189b(0x1c5))]();_0x664f18[_0x21189b(0x191)](_0x21189b(0x184),(0x0,fs_1['createReadStream'])(_0x23786f));const _0x3ea597=await this['_connection'][_0x21189b(0x16b)](veeva_constants_1['VeevaConstants'][_0x21189b(0x1a1)],_0x664f18,{'headers':{'Content-Type':'multipart/form-data'}}),_0x60d431=_0x3ea597['data'];if(_0x60d431['responseStatus']===status_enums_1[_0x21189b(0x18d)][_0x21189b(0x1c3)])return _0x60d431['url'];else{if(_0x2cecf0>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x21189b(0x193)]),await this[_0x21189b(0x1aa)](_0x23786f,_0x2cecf0-0x1);throw new veeva_error_1[(_0x21189b(0x171))](_0x60d431['errors']);}}async[a403_0x4d6c76(0x1b0)](_0x2eab76){const _0x4de28f=a403_0x4d6c76;this['_logger'][_0x4de28f(0x1bd)](_0x4de28f(0x1a9));const _0x3d4a9b=await this[_0x4de28f(0x193)][_0x4de28f(0x1b4)](veeva_constants_1[_0x4de28f(0x19c)][_0x4de28f(0x185)][_0x4de28f(0x1be)](_0x4de28f(0x17c),_0x2eab76)),_0x253881=await _0x3d4a9b[_0x4de28f(0x19a)];if(_0x253881[_0x4de28f(0x1ad)]===status_enums_1['VeevaResponseStatus'][_0x4de28f(0x1c3)])return _0x253881[_0x4de28f(0x1ab)];else throw new veeva_error_1[(_0x4de28f(0x171))](_0x253881[_0x4de28f(0x16f)]);}async[a403_0x4d6c76(0x170)](_0x3f391f){const _0x584fcc=a403_0x4d6c76;this['_logger'][_0x584fcc(0x1bd)](_0x584fcc(0x17f));const [_0xb78d7e]=await this['_veevaService'][_0x584fcc(0x1c4)]([_0x3f391f]);return _0xb78d7e[_0x584fcc(0x192)][_0x584fcc(0x198)](_0xc645ee=>_0xc645ee[_0x584fcc(0x16d)]===_0x584fcc(0x187))[_0x584fcc(0x179)];}async[a403_0x4d6c76(0x17e)](_0x2cf210){const _0x53c478=a403_0x4d6c76;this[_0x53c478(0x1b9)][_0x53c478(0x1bd)](_0x53c478(0x1c1));const {data:_0x5be68a}=await this['_connection'][_0x53c478(0x1ac)](_0x2cf210);if(_0x5be68a[_0x53c478(0x1ad)]===status_enums_1[_0x53c478(0x18d)]['SUCCESS']){const _0x5c72c2=new package_details_dto_1[(_0x53c478(0x182))](),{log:_0x594a32,id:_0x2382fa,package_status:_0x424717,package_steps:_0x5dfe8a}=_0x5be68a[_0x53c478(0x163)],_0x29d52d=_0x594a32['filter'](_0x163f81=>_0x163f81[_0x53c478(0x189)][_0x53c478(0x194)](_0x53c478(0x18e))),_0x35e2e4=await this[_0x53c478(0x19b)](_0x29d52d[0x0][_0x53c478(0x1ab)]);await this['_saveLog'](_0x35e2e4,_0x53c478(0x176)),_0x5c72c2[_0x53c478(0x1a0)]=_0x2382fa,_0x5c72c2['packageComponentList']=this['formPackageComponentList'](_0x5dfe8a),await this[_0x53c478(0x1af)](_0x5c72c2);if(_0x424717!==status_enums_1[_0x53c478(0x165)][_0x53c478(0x195)])throw new Error(_0x53c478(0x1b1));return _0x5c72c2;}else throw new veeva_error_1[(_0x53c478(0x171))](_0x5be68a[_0x53c478(0x16f)]);}async[a403_0x4d6c76(0x172)](_0x5beb05,_0x281c0a){const _0x1229cc=a403_0x4d6c76;var _0x4692c7;this[_0x1229cc(0x1b9)][_0x1229cc(0x1bd)](_0x1229cc(0x168));const {data:_0x5a50dd}=await this[_0x1229cc(0x193)]['get'](_0x5beb05);if(_0x5a50dd[_0x1229cc(0x1ad)]===status_enums_1[_0x1229cc(0x18d)][_0x1229cc(0x1c3)]){const {responseDetails:{deployment_log:_0x46f9df,package_status__v:_0x4a6b91},package_steps:_0x150a97}=_0x5a50dd,_0x67b3c3=_0x46f9df[_0x1229cc(0x1c2)](_0x40a4c6=>_0x40a4c6[_0x1229cc(0x189)][_0x1229cc(0x194)](_0x1229cc(0x167))),_0x45fe7d=await this['getLogResultText'](_0x67b3c3[0x0][_0x1229cc(0x1ab)]);await this[_0x1229cc(0x18f)](_0x45fe7d,_0x1229cc(0x175)),_0x281c0a[_0x1229cc(0x180)]=[status_enums_1[_0x1229cc(0x165)][_0x1229cc(0x19e)],status_enums_1[_0x1229cc(0x165)]['DEPLOYED_WITH_WARNINGS']][_0x1229cc(0x169)](_0x4a6b91);const _0x5e6089=array_utils_1[_0x1229cc(0x1b8)][_0x1229cc(0x183)](this[_0x1229cc(0x174)](_0x150a97),({uniqueName:_0x5a8eca})=>_0x5a8eca);for(const _0x5ef363 of _0x281c0a[_0x1229cc(0x196)]){const _0x9e20a5=(_0x4692c7=_0x5e6089[_0x1229cc(0x1ac)](_0x5ef363[_0x1229cc(0x162)]))===null||_0x4692c7===void 0x0?void 0x0:_0x4692c7['status'];_0x9e20a5&&(_0x5ef363[_0x1229cc(0x1a5)]=_0x9e20a5);}_0x281c0a[_0x1229cc(0x196)]=_0x281c0a[_0x1229cc(0x196)][_0x1229cc(0x1c2)](_0xbf6410=>_0xbf6410[_0x1229cc(0x1a5)]!==status_enums_1[_0x1229cc(0x16e)][_0x1229cc(0x195)]);if(!_0x281c0a[_0x1229cc(0x196)]['length'])throw new Error(_0x1229cc(0x161));return _0x281c0a;}else throw new veeva_error_1['VeevaError'](_0x5a50dd[_0x1229cc(0x16f)]);}async['getLogResultText'](_0x391e5b){const _0x29f19b=a403_0x4d6c76,{data:_0x36dfe0}=await this[_0x29f19b(0x193)][_0x29f19b(0x1ac)](_0x391e5b,{'responseType':_0x29f19b(0x190)});return _0x36dfe0;}['formPackageComponentList'](_0x235fd2){const _0x2a8f72=a403_0x4d6c76;return _0x235fd2[_0x2a8f72(0x186)]((_0x1ffaa2,_0x279e8e)=>{const _0x31889a=_0x2a8f72,_0xa0abb4=_0x279e8e['package_components'][_0x31889a(0x177)](_0x2d2830=>new package_component_dto_1['PackageComponentDto']({'status':_0x279e8e[_0x31889a(0x16a)],'stepName':_0x279e8e[_0x31889a(0x18b)],'component':_0x2d2830}));return[..._0x1ffaa2,..._0xa0abb4];},[]);}async[a403_0x4d6c76(0x1af)](_0x150b47){const _0x2c36a6=a403_0x4d6c76,{data:_0x1fe58f}=await this['_connection']['post'](veeva_constants_1['VeevaConstants'][_0x2c36a6(0x1bc)][_0x2c36a6(0x1be)](_0x2c36a6(0x17c),_0x150b47[_0x2c36a6(0x1a0)]));if(_0x1fe58f[_0x2c36a6(0x1ad)]===status_enums_1['VeevaResponseStatus']['SUCCESS']){const {package_steps:_0x251532}=_0x1fe58f['responseDetails'],_0x1092e1=array_utils_1[_0x2c36a6(0x1b8)][_0x2c36a6(0x160)](_0x150b47[_0x2c36a6(0x196)],({stepName:_0x3124dc})=>_0x3124dc);for(const {name__v:_0x363221,deployment_action:_0x423e8f}of _0x251532){for(const _0x2c69a8 of _0x1092e1[_0x2c36a6(0x1ac)](_0x363221)||[]){_0x2c69a8[_0x2c36a6(0x17d)]=package_component_dto_1[_0x2c36a6(0x1a2)]['convertDeploymentAction'](_0x423e8f);}}}else throw new veeva_error_1['VeevaError'](_0x1fe58f[_0x2c36a6(0x16f)]);}async[a403_0x4d6c76(0x1bf)](_0x265f54){const _0x204f2e=a403_0x4d6c76,_0x28c166=await this['importVpk'](_0x265f54),_0x39f126=await this[_0x204f2e(0x170)](_0x28c166),_0x2262ac=await this['getValidationDetailsAndSaveLog'](_0x39f126),_0x34466e=await this[_0x204f2e(0x1b0)](_0x2262ac['packageId']),_0x20f819=await this[_0x204f2e(0x170)](_0x34466e);return this[_0x204f2e(0x172)](_0x20f819,_0x2262ac);}}exports[a403_0x4d6c76(0x1a4)]=PackageImportService;