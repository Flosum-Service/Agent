const a360_0xcb9b3d=a360_0xe5a0;function a360_0xe5a0(_0x4b2be5,_0x1a6c75){const _0x5c9c2c=a360_0x37ba();return a360_0xe5a0=function(_0x31ea52,_0x4cb69d){_0x31ea52=_0x31ea52-0xa7;let _0x37bad7=_0x5c9c2c[_0x31ea52];return _0x37bad7;},a360_0xe5a0(_0x4b2be5,_0x1a6c75);}(function(_0x5aaea5,_0x5b12ea){const _0x5d94c3=a360_0xe5a0,_0x19dd5e=_0x5aaea5();while(!![]){try{const _0x875d46=parseInt(_0x5d94c3(0xff))/0x1+-parseInt(_0x5d94c3(0xcb))/0x2+parseInt(_0x5d94c3(0xe2))/0x3+parseInt(_0x5d94c3(0xb5))/0x4*(-parseInt(_0x5d94c3(0xbc))/0x5)+parseInt(_0x5d94c3(0xcf))/0x6+-parseInt(_0x5d94c3(0xea))/0x7+parseInt(_0x5d94c3(0xe9))/0x8*(parseInt(_0x5d94c3(0xaf))/0x9);if(_0x875d46===_0x5b12ea)break;else _0x19dd5e['push'](_0x19dd5e['shift']());}catch(_0x162df8){_0x19dd5e['push'](_0x19dd5e['shift']());}}}(a360_0x37ba,0x2df19));const a360_0x4cb69d=(function(){let _0x1f7ecc=!![];return function(_0x1a91bf,_0x393152){const _0x1f876d=_0x1f7ecc?function(){const _0x42e752=a360_0xe5a0;if(_0x393152){const _0x2861ec=_0x393152[_0x42e752(0xb0)](_0x1a91bf,arguments);return _0x393152=null,_0x2861ec;}}:function(){};return _0x1f7ecc=![],_0x1f876d;};}()),a360_0x31ea52=a360_0x4cb69d(this,function(){const _0x24a4dc=a360_0xe5a0;return a360_0x31ea52[_0x24a4dc(0xab)]()[_0x24a4dc(0xe5)]('(((.+)+)+)+$')[_0x24a4dc(0xab)]()[_0x24a4dc(0xc9)](a360_0x31ea52)['search'](_0x24a4dc(0xf3));});a360_0x31ea52();'use strict';var __importDefault=this&&this[a360_0xcb9b3d(0xf4)]||function(_0x1cde92){const _0x4adf66=a360_0xcb9b3d;return _0x1cde92&&_0x1cde92[_0x4adf66(0xb2)]?_0x1cde92:{'default':_0x1cde92};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a360_0xcb9b3d(0xa7)]=void 0x0;const veeva_constants_1=require(a360_0xcb9b3d(0xdc)),status_enums_1=require(a360_0xcb9b3d(0xe4)),veeva_error_1=require(a360_0xcb9b3d(0xb7)),form_data_1=__importDefault(require(a360_0xcb9b3d(0xdf))),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require(a360_0xcb9b3d(0xe1)),package_component_dto_1=require(a360_0xcb9b3d(0xc5)),array_utils_1=require(a360_0xcb9b3d(0xa8));class PackageImportService{constructor({veevaService:_0x475745,connection:_0x52e91f,logger:_0x25239e,saveLog:_0x1774ba}){const _0x130da4=a360_0xcb9b3d;this['_veevaService']=_0x475745,this['_connection']=_0x52e91f,this[_0x130da4(0xfb)]=_0x25239e,this[_0x130da4(0xc7)]=_0x1774ba;}async[a360_0xcb9b3d(0xbf)](_0x594582,_0x1239b4=0x1){const _0x5d75c3=a360_0xcb9b3d;this[_0x5d75c3(0xfb)]['log']('Import\x20package');const _0x228781=new form_data_1[(_0x5d75c3(0xb4))]();_0x228781[_0x5d75c3(0xc8)](_0x5d75c3(0xbd),(0x0,fs_1[_0x5d75c3(0xb9)])(_0x594582));const _0xb86a85=await this[_0x5d75c3(0xf1)][_0x5d75c3(0xdd)](veeva_constants_1[_0x5d75c3(0xca)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x228781,{'headers':{'Content-Type':'multipart/form-data'}}),_0xab38b=_0xb86a85[_0x5d75c3(0xb3)];if(_0xab38b[_0x5d75c3(0xe0)]===status_enums_1[_0x5d75c3(0xf9)]['SUCCESS'])return _0xab38b['url'];else{if(_0x1239b4>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x5d75c3(0xf1)]),await this['importVpk'](_0x594582,_0x1239b4-0x1);throw new veeva_error_1['VeevaError'](_0xab38b['errors']);}}async[a360_0xcb9b3d(0xf5)](_0x32e887){const _0x38acfa=a360_0xcb9b3d;this[_0x38acfa(0xfb)][_0x38acfa(0xeb)]('Deploy\x20package');const _0x14c62a=await this[_0x38acfa(0xf1)][_0x38acfa(0xcd)](veeva_constants_1[_0x38acfa(0xca)][_0x38acfa(0xaa)][_0x38acfa(0xf2)](_0x38acfa(0xf6),_0x32e887)),_0x557781=await _0x14c62a[_0x38acfa(0xb3)];if(_0x557781['responseStatus']===status_enums_1[_0x38acfa(0xf9)][_0x38acfa(0xda)])return _0x557781[_0x38acfa(0xa9)];else throw new veeva_error_1[(_0x38acfa(0xfe))](_0x557781[_0x38acfa(0xd3)]);}async[a360_0xcb9b3d(0xcc)](_0x453ea6){const _0x5051ee=a360_0xcb9b3d;this[_0x5051ee(0xfb)][_0x5051ee(0xeb)](_0x5051ee(0xb6));const [_0x20d5f4]=await this[_0x5051ee(0xed)][_0x5051ee(0xd7)]([_0x453ea6]);return _0x20d5f4[_0x5051ee(0xf0)][_0x5051ee(0xd1)](_0x34d7d3=>_0x34d7d3[_0x5051ee(0x102)]===_0x5051ee(0xc0))[_0x5051ee(0xdb)];}async[a360_0xcb9b3d(0xec)](_0x1c2377){const _0x30ac7b=a360_0xcb9b3d;this[_0x30ac7b(0xfb)][_0x30ac7b(0xeb)](_0x30ac7b(0xce));const {data:_0x85d8ba}=await this['_connection'][_0x30ac7b(0xd6)](_0x1c2377);if(_0x85d8ba[_0x30ac7b(0xe0)]===status_enums_1[_0x30ac7b(0xf9)][_0x30ac7b(0xda)]){const _0x5bb64c=new package_details_dto_1[(_0x30ac7b(0xe6))](),{log:_0x1695c4,id:_0x3ca3ad,package_status:_0x3e1df2,package_steps:_0x184dee}=_0x85d8ba[_0x30ac7b(0xd2)],_0x3ad05e=_0x1695c4[_0x30ac7b(0xee)](_0x3ee21f=>_0x3ee21f[_0x30ac7b(0xe7)][_0x30ac7b(0xc1)]('Validation.log')),_0xfe393c=await this[_0x30ac7b(0xac)](_0x3ad05e[0x0][_0x30ac7b(0xa9)]);await this[_0x30ac7b(0xc7)](_0xfe393c,'Validation\x20Log'),_0x5bb64c[_0x30ac7b(0xd8)]=_0x3ca3ad,_0x5bb64c['packageComponentList']=this['formPackageComponentList'](_0x184dee),await this[_0x30ac7b(0xd4)](_0x5bb64c);if(_0x3e1df2!==status_enums_1['VeevaPackageStatus'][_0x30ac7b(0xe3)])throw new Error(_0x30ac7b(0xae));return _0x5bb64c;}else throw new veeva_error_1[(_0x30ac7b(0xfe))](_0x85d8ba[_0x30ac7b(0xd3)]);}async[a360_0xcb9b3d(0xc4)](_0x58655b,_0x592cfe){const _0x5dc54a=a360_0xcb9b3d;var _0x29aee0;this['_logger']['log']('Get\x20deploy\x20result');const {data:_0x3fb1c2}=await this[_0x5dc54a(0xf1)]['get'](_0x58655b);if(_0x3fb1c2['responseStatus']===status_enums_1[_0x5dc54a(0xf9)][_0x5dc54a(0xda)]){const {responseDetails:{deployment_log:_0xc5b032,package_status__v:_0x314ac9},package_steps:_0x9d387d}=_0x3fb1c2,_0x303a92=_0xc5b032['filter'](_0x1a2e60=>_0x1a2e60[_0x5dc54a(0xe7)][_0x5dc54a(0xc1)]('Deployment.log')),_0x589639=await this[_0x5dc54a(0xac)](_0x303a92[0x0][_0x5dc54a(0xa9)]);await this[_0x5dc54a(0xc7)](_0x589639,_0x5dc54a(0x101)),_0x592cfe[_0x5dc54a(0xef)]=[status_enums_1[_0x5dc54a(0xb1)][_0x5dc54a(0xf7)],status_enums_1['VeevaPackageStatus'][_0x5dc54a(0xb8)]][_0x5dc54a(0xc3)](_0x314ac9);const _0x188d0f=array_utils_1[_0x5dc54a(0xd9)][_0x5dc54a(0xc2)](this[_0x5dc54a(0xc6)](_0x9d387d),({uniqueName:_0x13f78d})=>_0x13f78d);for(const _0xd5e2d8 of _0x592cfe[_0x5dc54a(0xf8)]){const _0x5bc28a=(_0x29aee0=_0x188d0f[_0x5dc54a(0xd6)](_0xd5e2d8['uniqueName']))===null||_0x29aee0===void 0x0?void 0x0:_0x29aee0[_0x5dc54a(0xfc)];_0x5bc28a&&(_0xd5e2d8[_0x5dc54a(0xfc)]=_0x5bc28a);}_0x592cfe[_0x5dc54a(0xf8)]=_0x592cfe['packageComponentList'][_0x5dc54a(0xee)](_0x356fec=>_0x356fec['status']!==status_enums_1[_0x5dc54a(0xfa)]['VERIFIED']);if(!_0x592cfe[_0x5dc54a(0xf8)][_0x5dc54a(0xde)])throw new Error(_0x5dc54a(0xd5));return _0x592cfe;}else throw new veeva_error_1['VeevaError'](_0x3fb1c2['errors']);}async[a360_0xcb9b3d(0xac)](_0x23b394){const _0x569a68=a360_0xcb9b3d,{data:_0xccf06e}=await this[_0x569a68(0xf1)][_0x569a68(0xd6)](_0x23b394,{'responseType':_0x569a68(0xbb)});return _0xccf06e;}[a360_0xcb9b3d(0xc6)](_0x2ad0ae){const _0x28d7a8=a360_0xcb9b3d;return _0x2ad0ae[_0x28d7a8(0x100)]((_0x5abe2f,_0x1443dc)=>{const _0x12dd41=_0x28d7a8,_0x4ef403=_0x1443dc['package_components'][_0x12dd41(0xfd)](_0x2f4a83=>new package_component_dto_1[(_0x12dd41(0xba))]({'status':_0x1443dc[_0x12dd41(0xe8)],'stepName':_0x1443dc['name__v'],'component':_0x2f4a83}));return[..._0x5abe2f,..._0x4ef403];},[]);}async[a360_0xcb9b3d(0xd4)](_0x5aa3b6){const _0x112b7e=a360_0xcb9b3d,{data:_0x1af1e0}=await this['_connection'][_0x112b7e(0xcd)](veeva_constants_1[_0x112b7e(0xca)]['ENDPOINT_VALIDATE_PACKAGE']['replace'](_0x112b7e(0xf6),_0x5aa3b6['packageId']));if(_0x1af1e0[_0x112b7e(0xe0)]===status_enums_1[_0x112b7e(0xf9)][_0x112b7e(0xda)]){const {package_steps:_0x2799c8}=_0x1af1e0['responseDetails'],_0x1fa811=array_utils_1[_0x112b7e(0xd9)]['groupToMap'](_0x5aa3b6[_0x112b7e(0xf8)],({stepName:_0x40ffe8})=>_0x40ffe8);for(const {name__v:_0x129862,deployment_action:_0x2c32fa}of _0x2799c8){for(const _0x176363 of _0x1fa811['get'](_0x129862)||[]){_0x176363[_0x112b7e(0xbe)]=package_component_dto_1['PackageComponentDto'][_0x112b7e(0xd0)](_0x2c32fa);}}}else throw new veeva_error_1['VeevaError'](_0x1af1e0['errors']);}async[a360_0xcb9b3d(0xad)](_0x1efc0e){const _0x94dbc=a360_0xcb9b3d,_0x994061=await this['importVpk'](_0x1efc0e),_0x1511eb=await this[_0x94dbc(0xcc)](_0x994061),_0x3970a8=await this[_0x94dbc(0xec)](_0x1511eb),_0x2fae77=await this[_0x94dbc(0xf5)](_0x3970a8[_0x94dbc(0xd8)]),_0x800c09=await this[_0x94dbc(0xcc)](_0x2fae77);return this[_0x94dbc(0xc4)](_0x800c09,_0x3970a8);}}function a360_0x37ba(){const _0x448221=['search','PackageDetailsDto','filename','deployment_status__v','625072gIbhXb','542878MGjUHx','log','getValidationDetailsAndSaveLog','_veevaService','filter','isDeployed','links','_connection','replace','(((.+)+)+)+$','__importDefault','deployPackage','{package_id}','DEPLOYED','packageComponentList','VeevaResponseStatus','PackageComponentStatus','_logger','status','map','VeevaError','12279aLAOSz','reduce','Deploy\x20Log','rel','PackageImportService','../utils/array.utils','url','ENDPOINT_DEPLOY_PACKAGE','toString','getLogResultText','import','Package\x20not\x20verified','63UGxhTT','apply','VeevaPackageStatus','__esModule','data','default','67580ljRVhC','Wait\x20Executing\x20job','../classes/errors/veeva-error','DEPLOYED_WITH_WARNINGS','createReadStream','PackageComponentDto','text','55iSvqwC','file','deploymentAction','importVpk','artifacts','endsWith','groupUniqueToMap','includes','getDeployDetailsAndSaveLog','../dtos/package-component.dto','formPackageComponentList','_saveLog','append','constructor','VeevaConstants','617408Solyjp','getJobDetailUrl','post','Get\x20validation\x20details.','107466dIDiFE','convertDeploymentAction','find','vaultPackage','errors','fillPackageDeploymentAction','Cannot\x20find\x20deployment\x20results','get','getJobResult','packageId','ArrayUtils','SUCCESS','href','../constants/veeva.constants','put','length','form-data','responseStatus','../dtos/package-details.dto','549480oWjFJd','VERIFIED','../enums/status.enums'];a360_0x37ba=function(){return _0x448221;};return a360_0x37ba();}exports[a360_0xcb9b3d(0xa7)]=PackageImportService;