const a360_0x515037=a360_0x587f;(function(_0x3aad7f,_0x45bed6){const _0x233539=a360_0x587f,_0x50d6b9=_0x3aad7f();while(!![]){try{const _0x4021ca=parseInt(_0x233539(0xfe))/0x1+-parseInt(_0x233539(0x126))/0x2*(parseInt(_0x233539(0x12c))/0x3)+parseInt(_0x233539(0xfb))/0x4+-parseInt(_0x233539(0x116))/0x5+parseInt(_0x233539(0x11a))/0x6*(-parseInt(_0x233539(0xf7))/0x7)+-parseInt(_0x233539(0x136))/0x8+-parseInt(_0x233539(0x102))/0x9;if(_0x4021ca===_0x45bed6)break;else _0x50d6b9['push'](_0x50d6b9['shift']());}catch(_0x547518){_0x50d6b9['push'](_0x50d6b9['shift']());}}}(a360_0x3385,0x8a2c3));const a360_0xfc7120=(function(){let _0x3e2ee9=!![];return function(_0x5c6721,_0xebecc3){const _0x57eee5=_0x3e2ee9?function(){const _0x42f979=a360_0x587f;if(_0xebecc3){const _0x11841e=_0xebecc3[_0x42f979(0x127)](_0x5c6721,arguments);return _0xebecc3=null,_0x11841e;}}:function(){};return _0x3e2ee9=![],_0x57eee5;};}()),a360_0x3989eb=a360_0xfc7120(this,function(){const _0x3fd49c=a360_0x587f;return a360_0x3989eb[_0x3fd49c(0x149)]()[_0x3fd49c(0x10b)](_0x3fd49c(0x11f))['toString']()[_0x3fd49c(0xff)](a360_0x3989eb)['search'](_0x3fd49c(0x11f));});a360_0x3989eb();function a360_0x3385(){const _0x42d9bf=['1857768lovbIj','convertDeploymentAction','filename','groupToMap','fillPackageDeploymentAction','_veevaService','put','append','status','PackageDetailsDto','getDeployDetailsAndSaveLog','getJobDetailUrl','includes','defineProperty','Deploy\x20package','ArrayUtils','packageId','DEPLOYED','deployPackage','toString','packageComponentList','uniqueName','deployment_status__v','_saveLog','Deploy\x20Log','responseDetails','VeevaPackageStatus','vaultPackage','package_components','../utils/veeva-auth.utils','VERIFIED','../utils/array.utils','isDeployed','log','1756993oYQnSJ','createReadStream','url','SUCCESS','3758300RyqnUm','find','updateVeevaConnection','1048947JbUuJQ','constructor','{package_id}','deploymentAction','5160411ehKemT','__esModule','getLogResultText','Wait\x20Executing\x20job','map','VeevaError','DEPLOYED_WITH_WARNINGS','../dtos/package-details.dto','formPackageComponentList','search','import','filter','artifacts','../enums/status.enums','groupUniqueToMap','Package\x20not\x20verified','get','_logger','default','VeevaResponseStatus','354615jXngrJ','endsWith','PackageComponentDto','PackageComponentStatus','6YOIyLv','reduce','responseStatus','Validation\x20Log','ENDPOINT_VALIDATE_PACKAGE','(((.+)+)+)+$','VeevaConstants','errors','Deployment.log','replace','../constants/veeva.constants','getJobResult','590090KKjGOF','apply','Get\x20validation\x20details.','post','links','__importDefault','3KpXirJ','importVpk','Import\x20package','rel','../dtos/package-component.dto','_connection','ENDPOINT_DEPLOY_PACKAGE','name__v','href','Cannot\x20find\x20deployment\x20results'];a360_0x3385=function(){return _0x42d9bf;};return a360_0x3385();}'use strict';function a360_0x587f(_0xfd5e52,_0x54bbef){const _0x425b6c=a360_0x3385();return a360_0x587f=function(_0x3989eb,_0xfc7120){_0x3989eb=_0x3989eb-0xf2;let _0x3385e4=_0x425b6c[_0x3989eb];return _0x3385e4;},a360_0x587f(_0xfd5e52,_0x54bbef);}var __importDefault=this&&this[a360_0x515037(0x12b)]||function(_0x3c1d58){return _0x3c1d58&&_0x3c1d58['__esModule']?_0x3c1d58:{'default':_0x3c1d58};};Object[a360_0x515037(0x143)](exports,a360_0x515037(0x103),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require(a360_0x515037(0x124)),status_enums_1=require(a360_0x515037(0x10f)),veeva_error_1=require('../classes/errors/veeva-error'),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),veeva_auth_utils_1=require(a360_0x515037(0xf2)),package_details_dto_1=require(a360_0x515037(0x109)),package_component_dto_1=require(a360_0x515037(0x130)),array_utils_1=require(a360_0x515037(0xf4));class PackageImportService{constructor({veevaService:_0x486c6d,connection:_0x11114d,logger:_0x3e5e9d,saveLog:_0xecb2b1}){const _0x87dcc9=a360_0x515037;this[_0x87dcc9(0x13b)]=_0x486c6d,this[_0x87dcc9(0x131)]=_0x11114d,this[_0x87dcc9(0x113)]=_0x3e5e9d,this[_0x87dcc9(0x14d)]=_0xecb2b1;}async[a360_0x515037(0x12d)](_0x47ec90,_0x4b7994=0x1){const _0x1bd8d0=a360_0x515037;this[_0x1bd8d0(0x113)][_0x1bd8d0(0xf6)](_0x1bd8d0(0x12e));const _0x3db014=new form_data_1[(_0x1bd8d0(0x114))]();_0x3db014[_0x1bd8d0(0x13d)]('file',(0x0,fs_1[_0x1bd8d0(0xf8)])(_0x47ec90));const _0x2e0162=await this[_0x1bd8d0(0x131)][_0x1bd8d0(0x13c)](veeva_constants_1[_0x1bd8d0(0x120)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x3db014,{'headers':{'Content-Type':'multipart/form-data'}}),_0x440d1a=_0x2e0162['data'];if(_0x440d1a['responseStatus']===status_enums_1[_0x1bd8d0(0x115)]['SUCCESS'])return _0x440d1a[_0x1bd8d0(0xf9)];else{if(_0x4b7994>0x0)return await(0x0,veeva_auth_utils_1[_0x1bd8d0(0xfd)])(this[_0x1bd8d0(0x131)]),await this[_0x1bd8d0(0x12d)](_0x47ec90,_0x4b7994-0x1);throw new veeva_error_1['VeevaError'](_0x440d1a[_0x1bd8d0(0x121)]);}}async[a360_0x515037(0x148)](_0x2ad05d){const _0xff1899=a360_0x515037;this[_0xff1899(0x113)][_0xff1899(0xf6)](_0xff1899(0x144));const _0x14a5f4=await this[_0xff1899(0x131)][_0xff1899(0x129)](veeva_constants_1[_0xff1899(0x120)][_0xff1899(0x132)][_0xff1899(0x123)](_0xff1899(0x100),_0x2ad05d)),_0x5898dc=await _0x14a5f4['data'];if(_0x5898dc[_0xff1899(0x11c)]===status_enums_1[_0xff1899(0x115)]['SUCCESS'])return _0x5898dc[_0xff1899(0xf9)];else throw new veeva_error_1['VeevaError'](_0x5898dc[_0xff1899(0x121)]);}async[a360_0x515037(0x141)](_0x46a263){const _0x17795c=a360_0x515037;this['_logger'][_0x17795c(0xf6)](_0x17795c(0x105));const [_0x5d3277]=await this[_0x17795c(0x13b)][_0x17795c(0x125)]([_0x46a263]);return _0x5d3277[_0x17795c(0x12a)][_0x17795c(0xfc)](_0xa66913=>_0xa66913[_0x17795c(0x12f)]===_0x17795c(0x10e))[_0x17795c(0x134)];}async['getValidationDetailsAndSaveLog'](_0x5cd24d){const _0x4afda9=a360_0x515037;this[_0x4afda9(0x113)][_0x4afda9(0xf6)](_0x4afda9(0x128));const {data:_0x59b18d}=await this[_0x4afda9(0x131)]['get'](_0x5cd24d);if(_0x59b18d[_0x4afda9(0x11c)]===status_enums_1[_0x4afda9(0x115)][_0x4afda9(0xfa)]){const _0x2955cd=new package_details_dto_1[(_0x4afda9(0x13f))](),{log:_0x5171c8,id:_0x46e1d9,package_status:_0x341342,package_steps:_0x2ce22d}=_0x59b18d[_0x4afda9(0x151)],_0x89b04a=_0x5171c8[_0x4afda9(0x10d)](_0x2eae45=>_0x2eae45[_0x4afda9(0x138)]['endsWith']('Validation.log')),_0x353de3=await this[_0x4afda9(0x104)](_0x89b04a[0x0]['url']);await this[_0x4afda9(0x14d)](_0x353de3,_0x4afda9(0x11d)),_0x2955cd[_0x4afda9(0x146)]=_0x46e1d9,_0x2955cd[_0x4afda9(0x14a)]=this[_0x4afda9(0x10a)](_0x2ce22d),await this[_0x4afda9(0x13a)](_0x2955cd);if(_0x341342!==status_enums_1['VeevaPackageStatus'][_0x4afda9(0xf3)])throw new Error(_0x4afda9(0x111));return _0x2955cd;}else throw new veeva_error_1[(_0x4afda9(0x107))](_0x59b18d[_0x4afda9(0x121)]);}async[a360_0x515037(0x140)](_0x3603e7,_0x1bc712){const _0x181582=a360_0x515037;var _0x5ac932;this[_0x181582(0x113)]['log']('Get\x20deploy\x20result');const {data:_0x4363a0}=await this[_0x181582(0x131)]['get'](_0x3603e7);if(_0x4363a0[_0x181582(0x11c)]===status_enums_1[_0x181582(0x115)][_0x181582(0xfa)]){const {responseDetails:{deployment_log:_0x128ffe,package_status__v:_0x57c050},package_steps:_0xecdbf0}=_0x4363a0,_0x1a3c45=_0x128ffe['filter'](_0x26c028=>_0x26c028[_0x181582(0x138)][_0x181582(0x117)](_0x181582(0x122))),_0x8704d0=await this[_0x181582(0x104)](_0x1a3c45[0x0]['url']);await this[_0x181582(0x14d)](_0x8704d0,_0x181582(0x14e)),_0x1bc712[_0x181582(0xf5)]=[status_enums_1[_0x181582(0x150)][_0x181582(0x147)],status_enums_1[_0x181582(0x150)][_0x181582(0x108)]][_0x181582(0x142)](_0x57c050);const _0x5f0834=array_utils_1[_0x181582(0x145)][_0x181582(0x110)](this[_0x181582(0x10a)](_0xecdbf0),({uniqueName:_0x3e2129})=>_0x3e2129);for(const _0x32c845 of _0x1bc712[_0x181582(0x14a)]){const _0x51622f=(_0x5ac932=_0x5f0834['get'](_0x32c845[_0x181582(0x14b)]))===null||_0x5ac932===void 0x0?void 0x0:_0x5ac932[_0x181582(0x13e)];_0x51622f&&(_0x32c845[_0x181582(0x13e)]=_0x51622f);}_0x1bc712[_0x181582(0x14a)]=_0x1bc712[_0x181582(0x14a)]['filter'](_0x98baa2=>_0x98baa2['status']!==status_enums_1[_0x181582(0x119)][_0x181582(0xf3)]);if(!_0x1bc712['packageComponentList']['length'])throw new Error(_0x181582(0x135));return _0x1bc712;}else throw new veeva_error_1[(_0x181582(0x107))](_0x4363a0[_0x181582(0x121)]);}async['getLogResultText'](_0xa677c6){const _0x554f0a=a360_0x515037,{data:_0x241415}=await this[_0x554f0a(0x131)][_0x554f0a(0x112)](_0xa677c6,{'responseType':'text'});return _0x241415;}['formPackageComponentList'](_0x5c4c7d){const _0xb9edf7=a360_0x515037;return _0x5c4c7d[_0xb9edf7(0x11b)]((_0x5450c1,_0x227f62)=>{const _0x46bc0c=_0xb9edf7,_0x5d58db=_0x227f62[_0x46bc0c(0x152)][_0x46bc0c(0x106)](_0x39f401=>new package_component_dto_1[(_0x46bc0c(0x118))]({'status':_0x227f62[_0x46bc0c(0x14c)],'stepName':_0x227f62[_0x46bc0c(0x133)],'component':_0x39f401}));return[..._0x5450c1,..._0x5d58db];},[]);}async[a360_0x515037(0x13a)](_0x52f986){const _0x54aca6=a360_0x515037,{data:_0x2ccc0e}=await this['_connection'][_0x54aca6(0x129)](veeva_constants_1[_0x54aca6(0x120)][_0x54aca6(0x11e)]['replace']('{package_id}',_0x52f986[_0x54aca6(0x146)]));if(_0x2ccc0e[_0x54aca6(0x11c)]===status_enums_1['VeevaResponseStatus'][_0x54aca6(0xfa)]){const {package_steps:_0x3c3bbb}=_0x2ccc0e[_0x54aca6(0x14f)],_0x35b9cb=array_utils_1['ArrayUtils'][_0x54aca6(0x139)](_0x52f986[_0x54aca6(0x14a)],({stepName:_0x1f44a8})=>_0x1f44a8);for(const {name__v:_0x455e2e,deployment_action:_0x377249}of _0x3c3bbb){for(const _0x2bf88f of _0x35b9cb[_0x54aca6(0x112)](_0x455e2e)||[]){_0x2bf88f[_0x54aca6(0x101)]=package_component_dto_1['PackageComponentDto'][_0x54aca6(0x137)](_0x377249);}}}else throw new veeva_error_1[(_0x54aca6(0x107))](_0x2ccc0e[_0x54aca6(0x121)]);}async[a360_0x515037(0x10c)](_0x112932){const _0x26411c=a360_0x515037,_0x48b55d=await this[_0x26411c(0x12d)](_0x112932),_0x6a1526=await this[_0x26411c(0x141)](_0x48b55d),_0x5849ca=await this['getValidationDetailsAndSaveLog'](_0x6a1526),_0x1ff9b5=await this[_0x26411c(0x148)](_0x5849ca['packageId']),_0x25b4cb=await this['getJobDetailUrl'](_0x1ff9b5);return this[_0x26411c(0x140)](_0x25b4cb,_0x5849ca);}}exports['PackageImportService']=PackageImportService;