const a359_0x5eeac5=a359_0xc7d1;(function(_0x17d5e4,_0x39a0f4){const _0xf0af62=a359_0xc7d1,_0x2de904=_0x17d5e4();while(!![]){try{const _0x41d7f3=-parseInt(_0xf0af62(0x1ea))/0x1+-parseInt(_0xf0af62(0x1e4))/0x2*(-parseInt(_0xf0af62(0x1cb))/0x3)+-parseInt(_0xf0af62(0x1ca))/0x4+-parseInt(_0xf0af62(0x202))/0x5+-parseInt(_0xf0af62(0x1ac))/0x6+-parseInt(_0xf0af62(0x1da))/0x7*(-parseInt(_0xf0af62(0x1a9))/0x8)+-parseInt(_0xf0af62(0x1fb))/0x9*(-parseInt(_0xf0af62(0x203))/0xa);if(_0x41d7f3===_0x39a0f4)break;else _0x2de904['push'](_0x2de904['shift']());}catch(_0x182e43){_0x2de904['push'](_0x2de904['shift']());}}}(a359_0x52c7,0xa8b17));const a359_0x1014c0=(function(){let _0x22fa1a=!![];return function(_0x506d10,_0xbd0ee9){const _0x10f9b4=_0x22fa1a?function(){const _0xa37faf=a359_0xc7d1;if(_0xbd0ee9){const _0x3d6222=_0xbd0ee9[_0xa37faf(0x1c8)](_0x506d10,arguments);return _0xbd0ee9=null,_0x3d6222;}}:function(){};return _0x22fa1a=![],_0x10f9b4;};}()),a359_0x5189b9=a359_0x1014c0(this,function(){const _0x4280dc=a359_0xc7d1;return a359_0x5189b9['toString']()['search'](_0x4280dc(0x200))[_0x4280dc(0x1eb)]()[_0x4280dc(0x1f9)](a359_0x5189b9)[_0x4280dc(0x1f2)](_0x4280dc(0x200));});function a359_0xc7d1(_0x246e57,_0x4e4478){const _0x557f8c=a359_0x52c7();return a359_0xc7d1=function(_0x5189b9,_0x1014c0){_0x5189b9=_0x5189b9-0x1a1;let _0x52c75a=_0x557f8c[_0x5189b9];return _0x52c75a;},a359_0xc7d1(_0x246e57,_0x4e4478);}a359_0x5189b9();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x381206){return _0x381206&&_0x381206['__esModule']?_0x381206:{'default':_0x381206};};Object[a359_0x5eeac5(0x1e8)](exports,a359_0x5eeac5(0x1ec),{'value':!![]}),exports[a359_0x5eeac5(0x1f7)]=void 0x0;const veeva_constants_1=require(a359_0x5eeac5(0x1b8)),status_enums_1=require(a359_0x5eeac5(0x1c7)),veeva_error_1=require(a359_0x5eeac5(0x1bf)),form_data_1=__importDefault(require(a359_0x5eeac5(0x1e1))),fs_1=require('fs'),veeva_auth_utils_1=require(a359_0x5eeac5(0x1fa)),package_details_dto_1=require(a359_0x5eeac5(0x1b3)),package_component_dto_1=require(a359_0x5eeac5(0x1ee)),array_utils_1=require(a359_0x5eeac5(0x1de));class PackageImportService{constructor({veevaService:_0x47ea9,connection:_0x36e997,logger:_0x5677a2,saveLog:_0x5bffd6}){const _0x1108e2=a359_0x5eeac5;this[_0x1108e2(0x1db)]=_0x47ea9,this[_0x1108e2(0x1c4)]=_0x36e997,this[_0x1108e2(0x1e2)]=_0x5677a2,this['_saveLog']=_0x5bffd6;}async['importVpk'](_0x3cdc86,_0x346d9d=0x1){const _0x4d043b=a359_0x5eeac5;this[_0x4d043b(0x1e2)][_0x4d043b(0x1af)](_0x4d043b(0x1b2));const _0x6cd4dd=new form_data_1[(_0x4d043b(0x1a4))]();_0x6cd4dd['append'](_0x4d043b(0x1f1),(0x0,fs_1['createReadStream'])(_0x3cdc86));const _0x4fd491=await this[_0x4d043b(0x1c4)][_0x4d043b(0x1d4)](veeva_constants_1[_0x4d043b(0x1dd)][_0x4d043b(0x1e7)],_0x6cd4dd,{'headers':{'Content-Type':'multipart/form-data'}}),_0x4d4c52=_0x4fd491[_0x4d043b(0x1ab)];if(_0x4d4c52[_0x4d043b(0x1bd)]===status_enums_1[_0x4d043b(0x1ad)][_0x4d043b(0x1b7)])return _0x4d4c52[_0x4d043b(0x1a3)];else{if(_0x346d9d>0x0)return await(0x0,veeva_auth_utils_1[_0x4d043b(0x1a8)])(this['_connection']),await this[_0x4d043b(0x1d0)](_0x3cdc86,_0x346d9d-0x1);throw new veeva_error_1[(_0x4d043b(0x1b6))](_0x4d4c52[_0x4d043b(0x1cd)]);}}async[a359_0x5eeac5(0x1ae)](_0x112200){const _0x1494e3=a359_0x5eeac5;this[_0x1494e3(0x1e2)]['log'](_0x1494e3(0x1b4));const _0x3faf76=await this[_0x1494e3(0x1c4)][_0x1494e3(0x1d3)](veeva_constants_1['VeevaConstants'][_0x1494e3(0x1ef)][_0x1494e3(0x1a6)](_0x1494e3(0x1a1),_0x112200)),_0x17bb13=await _0x3faf76[_0x1494e3(0x1ab)];if(_0x17bb13[_0x1494e3(0x1bd)]===status_enums_1[_0x1494e3(0x1ad)][_0x1494e3(0x1b7)])return _0x17bb13[_0x1494e3(0x1a3)];else throw new veeva_error_1[(_0x1494e3(0x1b6))](_0x17bb13['errors']);}async[a359_0x5eeac5(0x1fe)](_0x2c0d4e){const _0x457411=a359_0x5eeac5;this[_0x457411(0x1e2)][_0x457411(0x1af)](_0x457411(0x1b1));const [_0x50b588]=await this[_0x457411(0x1db)][_0x457411(0x1d7)]([_0x2c0d4e]);return _0x50b588[_0x457411(0x1e5)][_0x457411(0x1e6)](_0x3090e0=>_0x3090e0[_0x457411(0x1d9)]===_0x457411(0x1df))[_0x457411(0x1d5)];}async[a359_0x5eeac5(0x1a2)](_0x500cd5){const _0x363342=a359_0x5eeac5;this[_0x363342(0x1e2)][_0x363342(0x1af)](_0x363342(0x1f5));const {data:_0x878cb6}=await this['_connection']['get'](_0x500cd5);if(_0x878cb6[_0x363342(0x1bd)]===status_enums_1[_0x363342(0x1ad)][_0x363342(0x1b7)]){const _0x1b0a11=new package_details_dto_1[(_0x363342(0x1e9))](),{log:_0xdde28d,id:_0x586916,package_status:_0x3591b2,package_steps:_0x33bec6}=_0x878cb6[_0x363342(0x1a5)],_0x519ca8=_0xdde28d[_0x363342(0x1fd)](_0x513da8=>_0x513da8[_0x363342(0x1be)][_0x363342(0x1a7)]('Validation.log')),_0x431db6=await this[_0x363342(0x1c3)](_0x519ca8[0x0][_0x363342(0x1a3)]);await this['_saveLog'](_0x431db6,'Validation\x20Log'),_0x1b0a11[_0x363342(0x1e3)]=_0x586916,_0x1b0a11[_0x363342(0x1f4)]=this[_0x363342(0x1cc)](_0x33bec6),await this[_0x363342(0x1e0)](_0x1b0a11);if(_0x3591b2!==status_enums_1['VeevaPackageStatus'][_0x363342(0x1c0)])throw new Error(_0x363342(0x1c1));return _0x1b0a11;}else throw new veeva_error_1['VeevaError'](_0x878cb6[_0x363342(0x1cd)]);}async[a359_0x5eeac5(0x1c6)](_0x558f9b,_0x230052){const _0x1b7aba=a359_0x5eeac5;var _0x224ba1;this['_logger'][_0x1b7aba(0x1af)](_0x1b7aba(0x201));const {data:_0x20f166}=await this[_0x1b7aba(0x1c4)][_0x1b7aba(0x1f8)](_0x558f9b);if(_0x20f166[_0x1b7aba(0x1bd)]===status_enums_1[_0x1b7aba(0x1ad)][_0x1b7aba(0x1b7)]){const {responseDetails:{deployment_log:_0x2f221c,package_status__v:_0x35e657},package_steps:_0x8a64c4}=_0x20f166,_0x3d3ea9=_0x2f221c[_0x1b7aba(0x1fd)](_0x3cd211=>_0x3cd211[_0x1b7aba(0x1be)][_0x1b7aba(0x1a7)]('Deployment.log')),_0x330a74=await this[_0x1b7aba(0x1c3)](_0x3d3ea9[0x0][_0x1b7aba(0x1a3)]);await this[_0x1b7aba(0x1d8)](_0x330a74,_0x1b7aba(0x1dc)),_0x230052[_0x1b7aba(0x1cf)]=[status_enums_1['VeevaPackageStatus'][_0x1b7aba(0x1bc)],status_enums_1[_0x1b7aba(0x1c5)][_0x1b7aba(0x1ff)]][_0x1b7aba(0x1aa)](_0x35e657);const _0x1c8026=array_utils_1[_0x1b7aba(0x1ed)]['groupUniqueToMap'](this[_0x1b7aba(0x1cc)](_0x8a64c4),({uniqueName:_0x5f511d})=>_0x5f511d);for(const _0xea10aa of _0x230052[_0x1b7aba(0x1f4)]){const _0x244aa7=(_0x224ba1=_0x1c8026[_0x1b7aba(0x1f8)](_0xea10aa['uniqueName']))===null||_0x224ba1===void 0x0?void 0x0:_0x224ba1[_0x1b7aba(0x1ba)];_0x244aa7&&(_0xea10aa['status']=_0x244aa7);}_0x230052[_0x1b7aba(0x1f4)]=_0x230052[_0x1b7aba(0x1f4)][_0x1b7aba(0x1fd)](_0x33c704=>_0x33c704[_0x1b7aba(0x1ba)]!==status_enums_1[_0x1b7aba(0x1b9)][_0x1b7aba(0x1c0)]);if(!_0x230052[_0x1b7aba(0x1f4)][_0x1b7aba(0x204)])throw new Error(_0x1b7aba(0x1bb));return _0x230052;}else throw new veeva_error_1[(_0x1b7aba(0x1b6))](_0x20f166[_0x1b7aba(0x1cd)]);}async[a359_0x5eeac5(0x1c3)](_0x2198c1){const _0x5384dd=a359_0x5eeac5,{data:_0x14bbdb}=await this['_connection'][_0x5384dd(0x1f8)](_0x2198c1,{'responseType':_0x5384dd(0x1f0)});return _0x14bbdb;}[a359_0x5eeac5(0x1cc)](_0x39e0ad){const _0x3d9a13=a359_0x5eeac5;return _0x39e0ad[_0x3d9a13(0x1d6)]((_0x4111dc,_0x3aa32f)=>{const _0x345342=_0x3d9a13,_0x1548b7=_0x3aa32f[_0x345342(0x1c9)][_0x345342(0x1fc)](_0x4df2ff=>new package_component_dto_1[(_0x345342(0x1ce))]({'status':_0x3aa32f[_0x345342(0x1b5)],'stepName':_0x3aa32f[_0x345342(0x1d2)],'component':_0x4df2ff}));return[..._0x4111dc,..._0x1548b7];},[]);}async[a359_0x5eeac5(0x1e0)](_0x28e4c4){const _0x23a944=a359_0x5eeac5,{data:_0x2e1c04}=await this[_0x23a944(0x1c4)]['post'](veeva_constants_1[_0x23a944(0x1dd)]['ENDPOINT_VALIDATE_PACKAGE'][_0x23a944(0x1a6)](_0x23a944(0x1a1),_0x28e4c4[_0x23a944(0x1e3)]));if(_0x2e1c04[_0x23a944(0x1bd)]===status_enums_1[_0x23a944(0x1ad)][_0x23a944(0x1b7)]){const {package_steps:_0x26f34e}=_0x2e1c04[_0x23a944(0x1b0)],_0x1a9ed8=array_utils_1['ArrayUtils'][_0x23a944(0x1c2)](_0x28e4c4[_0x23a944(0x1f4)],({stepName:_0x1f6f7f})=>_0x1f6f7f);for(const {name__v:_0x259624,deployment_action:_0x122bb5}of _0x26f34e){for(const _0x11d9a4 of _0x1a9ed8[_0x23a944(0x1f8)](_0x259624)||[]){_0x11d9a4[_0x23a944(0x1d1)]=package_component_dto_1[_0x23a944(0x1ce)][_0x23a944(0x1f6)](_0x122bb5);}}}else throw new veeva_error_1[(_0x23a944(0x1b6))](_0x2e1c04[_0x23a944(0x1cd)]);}async[a359_0x5eeac5(0x1f3)](_0x4169b1){const _0x1be418=a359_0x5eeac5,_0x2d28fd=await this[_0x1be418(0x1d0)](_0x4169b1),_0x2fe28c=await this[_0x1be418(0x1fe)](_0x2d28fd),_0x4c7c1f=await this[_0x1be418(0x1a2)](_0x2fe28c),_0x48a221=await this[_0x1be418(0x1ae)](_0x4c7c1f[_0x1be418(0x1e3)]),_0x58df28=await this['getJobDetailUrl'](_0x48a221);return this[_0x1be418(0x1c6)](_0x58df28,_0x4c7c1f);}}function a359_0x52c7(){const _0x50de28=['deployment_status__v','VeevaError','SUCCESS','../constants/veeva.constants','PackageComponentStatus','status','Cannot\x20find\x20deployment\x20results','DEPLOYED','responseStatus','filename','../classes/errors/veeva-error','VERIFIED','Package\x20not\x20verified','groupToMap','getLogResultText','_connection','VeevaPackageStatus','getDeployDetailsAndSaveLog','../enums/status.enums','apply','package_components','5429600tauzHP','3630522NboUGK','formPackageComponentList','errors','PackageComponentDto','isDeployed','importVpk','deploymentAction','name__v','post','put','href','reduce','getJobResult','_saveLog','rel','4795bVpFSl','_veevaService','Deploy\x20Log','VeevaConstants','../utils/array.utils','artifacts','fillPackageDeploymentAction','form-data','_logger','packageId','2xvpRsi','links','find','ENDPOINT_EXPORT_IMPORT_PACKAGE','defineProperty','PackageDetailsDto','910909XQfzdG','toString','__esModule','ArrayUtils','../dtos/package-component.dto','ENDPOINT_DEPLOY_PACKAGE','text','file','search','import','packageComponentList','Get\x20validation\x20details.','convertDeploymentAction','PackageImportService','get','constructor','../utils/veeva-auth.utils','6238233tpKcbq','map','filter','getJobDetailUrl','DEPLOYED_WITH_WARNINGS','(((.+)+)+)+$','Get\x20deploy\x20result','4042660iMYBGO','30clTHhz','length','{package_id}','getValidationDetailsAndSaveLog','url','default','vaultPackage','replace','endsWith','updateVeevaConnection','13808qHsakc','includes','data','4224522DDKpff','VeevaResponseStatus','deployPackage','log','responseDetails','Wait\x20Executing\x20job','Import\x20package','../dtos/package-details.dto','Deploy\x20package'];a359_0x52c7=function(){return _0x50de28;};return a359_0x52c7();}exports[a359_0x5eeac5(0x1f7)]=PackageImportService;