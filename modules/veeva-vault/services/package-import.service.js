const a360_0x160802=a360_0x42a1;(function(_0x36ead1,_0x1cff9f){const _0x294178=a360_0x42a1,_0x3854fc=_0x36ead1();while(!![]){try{const _0x1c467d=-parseInt(_0x294178(0x1df))/0x1*(parseInt(_0x294178(0x22f))/0x2)+parseInt(_0x294178(0x1eb))/0x3+-parseInt(_0x294178(0x228))/0x4+-parseInt(_0x294178(0x1d9))/0x5+-parseInt(_0x294178(0x21a))/0x6*(-parseInt(_0x294178(0x1fc))/0x7)+-parseInt(_0x294178(0x216))/0x8+parseInt(_0x294178(0x220))/0x9;if(_0x1c467d===_0x1cff9f)break;else _0x3854fc['push'](_0x3854fc['shift']());}catch(_0x531e9d){_0x3854fc['push'](_0x3854fc['shift']());}}}(a360_0x4707,0x19bee));const a360_0x3d6e3f=(function(){let _0x181b6b=!![];return function(_0x187e6c,_0x18ffdf){const _0x43c4ad=_0x181b6b?function(){const _0x96771a=a360_0x42a1;if(_0x18ffdf){const _0x5a5174=_0x18ffdf[_0x96771a(0x1fd)](_0x187e6c,arguments);return _0x18ffdf=null,_0x5a5174;}}:function(){};return _0x181b6b=![],_0x43c4ad;};}()),a360_0x36e96b=a360_0x3d6e3f(this,function(){const _0x42e17f=a360_0x42a1;return a360_0x36e96b[_0x42e17f(0x22a)]()[_0x42e17f(0x1f2)]('(((.+)+)+)+$')[_0x42e17f(0x22a)]()[_0x42e17f(0x1e3)](a360_0x36e96b)[_0x42e17f(0x1f2)](_0x42e17f(0x236));});function a360_0x4707(){const _0x3a8df8=['fillPackageDeploymentAction','PackageComponentDto','(((.+)+)+)+$','764455zIYluJ','__importDefault','log','form-data','packageId','Validation\x20Log','2bpQdrF','../enums/status.enums','post','getDeployDetailsAndSaveLog','constructor','Import\x20package','text','Deployment.log','vaultPackage','groupToMap','put','reduce','74676PIFcnT','VeevaConstants','importVpk','updateVeevaConnection','SUCCESS','uniqueName','responseStatus','search','Wait\x20Executing\x20job','VeevaPackageStatus','packageComponentList','_logger','_veevaService','getLogResultText','_saveLog','../constants/veeva.constants','formPackageComponentList','581szkHeh','apply','isDeployed','import','map','includes','errors','Cannot\x20find\x20deployment\x20results','length','DEPLOYED','getValidationDetailsAndSaveLog','replace','{package_id}','PackageDetailsDto','filter','../utils/array.utils','Deploy\x20package','_connection','artifacts','defineProperty','deployPackage','ENDPOINT_VALIDATE_PACKAGE','ENDPOINT_DEPLOY_PACKAGE','DEPLOYED_WITH_WARNINGS','name__v','../utils/veeva-auth.utils','181352aijVus','deployment_status__v','VeevaError','__esModule','6030OZtxcK','filename','getJobResult','PackageImportService','VERIFIED','ENDPOINT_EXPORT_IMPORT_PACKAGE','3863349bNFUHl','url','groupUniqueToMap','ArrayUtils','rel','getJobDetailUrl','createReadStream','VeevaResponseStatus','575832bIDjfc','../dtos/package-component.dto','toString','status','data','get','file','112596fEazLJ','find','href','endsWith','package_components'];a360_0x4707=function(){return _0x3a8df8;};return a360_0x4707();}a360_0x36e96b();'use strict';var __importDefault=this&&this[a360_0x160802(0x1da)]||function(_0x7d091e){const _0x2346e=a360_0x160802;return _0x7d091e&&_0x7d091e[_0x2346e(0x219)]?_0x7d091e:{'default':_0x7d091e};};Object[a360_0x160802(0x20f)](exports,a360_0x160802(0x219),{'value':!![]}),exports[a360_0x160802(0x21d)]=void 0x0;const veeva_constants_1=require(a360_0x160802(0x1fa)),status_enums_1=require(a360_0x160802(0x1e0)),veeva_error_1=require('../classes/errors/veeva-error'),form_data_1=__importDefault(require(a360_0x160802(0x1dc))),fs_1=require('fs'),veeva_auth_utils_1=require(a360_0x160802(0x215)),package_details_dto_1=require('../dtos/package-details.dto'),package_component_dto_1=require(a360_0x160802(0x229)),array_utils_1=require(a360_0x160802(0x20b));function a360_0x42a1(_0x2a395a,_0x27b633){const _0x38e292=a360_0x4707();return a360_0x42a1=function(_0x36e96b,_0x3d6e3f){_0x36e96b=_0x36e96b-0x1d9;let _0x470751=_0x38e292[_0x36e96b];return _0x470751;},a360_0x42a1(_0x2a395a,_0x27b633);}class PackageImportService{constructor({veevaService:_0x28f319,connection:_0x1a083c,logger:_0x5921b9,saveLog:_0x4ba744}){const _0x52d24e=a360_0x160802;this['_veevaService']=_0x28f319,this[_0x52d24e(0x20d)]=_0x1a083c,this['_logger']=_0x5921b9,this[_0x52d24e(0x1f9)]=_0x4ba744;}async[a360_0x160802(0x1ed)](_0x7bb717,_0x15d053=0x1){const _0x5cd84d=a360_0x160802;this[_0x5cd84d(0x1f6)]['log'](_0x5cd84d(0x1e4));const _0x46f200=new form_data_1['default']();_0x46f200['append'](_0x5cd84d(0x22e),(0x0,fs_1[_0x5cd84d(0x226)])(_0x7bb717));const _0x422fa0=await this['_connection'][_0x5cd84d(0x1e9)](veeva_constants_1['VeevaConstants'][_0x5cd84d(0x21f)],_0x46f200,{'headers':{'Content-Type':'multipart/form-data'}}),_0x8cd704=_0x422fa0[_0x5cd84d(0x22c)];if(_0x8cd704['responseStatus']===status_enums_1[_0x5cd84d(0x227)]['SUCCESS'])return _0x8cd704[_0x5cd84d(0x221)];else{if(_0x15d053>0x0)return await(0x0,veeva_auth_utils_1[_0x5cd84d(0x1ee)])(this[_0x5cd84d(0x20d)]),await this['importVpk'](_0x7bb717,_0x15d053-0x1);throw new veeva_error_1[(_0x5cd84d(0x218))](_0x8cd704[_0x5cd84d(0x202)]);}}async[a360_0x160802(0x210)](_0x45105d){const _0x5596ce=a360_0x160802;this[_0x5596ce(0x1f6)][_0x5596ce(0x1db)](_0x5596ce(0x20c));const _0x243f46=await this[_0x5596ce(0x20d)]['post'](veeva_constants_1[_0x5596ce(0x1ec)][_0x5596ce(0x212)][_0x5596ce(0x207)](_0x5596ce(0x208),_0x45105d)),_0x432c6f=await _0x243f46['data'];if(_0x432c6f[_0x5596ce(0x1f1)]===status_enums_1[_0x5596ce(0x227)][_0x5596ce(0x1ef)])return _0x432c6f[_0x5596ce(0x221)];else throw new veeva_error_1[(_0x5596ce(0x218))](_0x432c6f[_0x5596ce(0x202)]);}async[a360_0x160802(0x225)](_0x3206ec){const _0x45db9c=a360_0x160802;this[_0x45db9c(0x1f6)][_0x45db9c(0x1db)](_0x45db9c(0x1f3));const [_0xaff0da]=await this[_0x45db9c(0x1f7)][_0x45db9c(0x21c)]([_0x3206ec]);return _0xaff0da['links'][_0x45db9c(0x230)](_0x1c7fa4=>_0x1c7fa4[_0x45db9c(0x224)]===_0x45db9c(0x20e))[_0x45db9c(0x231)];}async[a360_0x160802(0x206)](_0x6e9446){const _0x398639=a360_0x160802;this[_0x398639(0x1f6)][_0x398639(0x1db)]('Get\x20validation\x20details.');const {data:_0x1bd014}=await this[_0x398639(0x20d)][_0x398639(0x22d)](_0x6e9446);if(_0x1bd014[_0x398639(0x1f1)]===status_enums_1['VeevaResponseStatus'][_0x398639(0x1ef)]){const _0x1ac226=new package_details_dto_1[(_0x398639(0x209))](),{log:_0x5737b9,id:_0x584bff,package_status:_0x5b33ab,package_steps:_0x9be6ab}=_0x1bd014[_0x398639(0x1e7)],_0x159d7b=_0x5737b9[_0x398639(0x20a)](_0xd58a24=>_0xd58a24[_0x398639(0x21b)][_0x398639(0x232)]('Validation.log')),_0x3ccfe0=await this['getLogResultText'](_0x159d7b[0x0][_0x398639(0x221)]);await this[_0x398639(0x1f9)](_0x3ccfe0,_0x398639(0x1de)),_0x1ac226[_0x398639(0x1dd)]=_0x584bff,_0x1ac226[_0x398639(0x1f5)]=this['formPackageComponentList'](_0x9be6ab),await this[_0x398639(0x234)](_0x1ac226);if(_0x5b33ab!==status_enums_1[_0x398639(0x1f4)][_0x398639(0x21e)])throw new Error('Package\x20not\x20verified');return _0x1ac226;}else throw new veeva_error_1['VeevaError'](_0x1bd014[_0x398639(0x202)]);}async[a360_0x160802(0x1e2)](_0x35c123,_0x2557b5){const _0x1a4b36=a360_0x160802;var _0x46dd32;this[_0x1a4b36(0x1f6)][_0x1a4b36(0x1db)]('Get\x20deploy\x20result');const {data:_0x4f8222}=await this[_0x1a4b36(0x20d)][_0x1a4b36(0x22d)](_0x35c123);if(_0x4f8222['responseStatus']===status_enums_1[_0x1a4b36(0x227)][_0x1a4b36(0x1ef)]){const {responseDetails:{deployment_log:_0x4c5c30,package_status__v:_0x508e81},package_steps:_0x5f566f}=_0x4f8222,_0x468210=_0x4c5c30[_0x1a4b36(0x20a)](_0x163025=>_0x163025['filename'][_0x1a4b36(0x232)](_0x1a4b36(0x1e6))),_0x20b8e6=await this[_0x1a4b36(0x1f8)](_0x468210[0x0][_0x1a4b36(0x221)]);await this[_0x1a4b36(0x1f9)](_0x20b8e6,'Deploy\x20Log'),_0x2557b5[_0x1a4b36(0x1fe)]=[status_enums_1[_0x1a4b36(0x1f4)][_0x1a4b36(0x205)],status_enums_1['VeevaPackageStatus'][_0x1a4b36(0x213)]][_0x1a4b36(0x201)](_0x508e81);const _0x422919=array_utils_1['ArrayUtils'][_0x1a4b36(0x222)](this[_0x1a4b36(0x1fb)](_0x5f566f),({uniqueName:_0xf1ac89})=>_0xf1ac89);for(const _0x1932e1 of _0x2557b5[_0x1a4b36(0x1f5)]){const _0x1448da=(_0x46dd32=_0x422919['get'](_0x1932e1[_0x1a4b36(0x1f0)]))===null||_0x46dd32===void 0x0?void 0x0:_0x46dd32[_0x1a4b36(0x22b)];_0x1448da&&(_0x1932e1[_0x1a4b36(0x22b)]=_0x1448da);}_0x2557b5['packageComponentList']=_0x2557b5['packageComponentList'][_0x1a4b36(0x20a)](_0x2f464b=>_0x2f464b['status']!==status_enums_1['PackageComponentStatus']['VERIFIED']);if(!_0x2557b5[_0x1a4b36(0x1f5)][_0x1a4b36(0x204)])throw new Error(_0x1a4b36(0x203));return _0x2557b5;}else throw new veeva_error_1[(_0x1a4b36(0x218))](_0x4f8222[_0x1a4b36(0x202)]);}async[a360_0x160802(0x1f8)](_0x295c92){const _0x5e441e=a360_0x160802,{data:_0x326d1d}=await this['_connection'][_0x5e441e(0x22d)](_0x295c92,{'responseType':_0x5e441e(0x1e5)});return _0x326d1d;}[a360_0x160802(0x1fb)](_0x5dd306){const _0xfa83e3=a360_0x160802;return _0x5dd306[_0xfa83e3(0x1ea)]((_0x3ad3cb,_0x830016)=>{const _0xaaf149=_0xfa83e3,_0x20d7a7=_0x830016[_0xaaf149(0x233)][_0xaaf149(0x200)](_0x1e61d3=>new package_component_dto_1['PackageComponentDto']({'status':_0x830016[_0xaaf149(0x217)],'stepName':_0x830016[_0xaaf149(0x214)],'component':_0x1e61d3}));return[..._0x3ad3cb,..._0x20d7a7];},[]);}async[a360_0x160802(0x234)](_0x1cc19a){const _0x118f88=a360_0x160802,{data:_0x28ef6e}=await this[_0x118f88(0x20d)][_0x118f88(0x1e1)](veeva_constants_1['VeevaConstants'][_0x118f88(0x211)][_0x118f88(0x207)]('{package_id}',_0x1cc19a[_0x118f88(0x1dd)]));if(_0x28ef6e[_0x118f88(0x1f1)]===status_enums_1[_0x118f88(0x227)]['SUCCESS']){const {package_steps:_0x32d04b}=_0x28ef6e['responseDetails'],_0x2526ab=array_utils_1[_0x118f88(0x223)][_0x118f88(0x1e8)](_0x1cc19a[_0x118f88(0x1f5)],({stepName:_0x5f27eb})=>_0x5f27eb);for(const {name__v:_0x4770ec,deployment_action:_0x10c325}of _0x32d04b){for(const _0x442e79 of _0x2526ab[_0x118f88(0x22d)](_0x4770ec)||[]){_0x442e79['deploymentAction']=package_component_dto_1[_0x118f88(0x235)]['convertDeploymentAction'](_0x10c325);}}}else throw new veeva_error_1[(_0x118f88(0x218))](_0x28ef6e[_0x118f88(0x202)]);}async[a360_0x160802(0x1ff)](_0x3b327c){const _0x4b9b32=a360_0x160802,_0x2908d4=await this['importVpk'](_0x3b327c),_0x248070=await this[_0x4b9b32(0x225)](_0x2908d4),_0x50f0a1=await this[_0x4b9b32(0x206)](_0x248070),_0x223129=await this[_0x4b9b32(0x210)](_0x50f0a1[_0x4b9b32(0x1dd)]),_0x211c8d=await this[_0x4b9b32(0x225)](_0x223129);return this['getDeployDetailsAndSaveLog'](_0x211c8d,_0x50f0a1);}}exports[a360_0x160802(0x21d)]=PackageImportService;