const a360_0x33dd64=a360_0x5aa9;(function(_0x202a9f,_0x31dd09){const _0x23c365=a360_0x5aa9,_0x31d13c=_0x202a9f();while(!![]){try{const _0x4e3d3c=parseInt(_0x23c365(0x1a3))/0x1+parseInt(_0x23c365(0x193))/0x2*(parseInt(_0x23c365(0x1b6))/0x3)+parseInt(_0x23c365(0x199))/0x4*(parseInt(_0x23c365(0x194))/0x5)+-parseInt(_0x23c365(0x1a6))/0x6+-parseInt(_0x23c365(0x1ac))/0x7*(parseInt(_0x23c365(0x186))/0x8)+-parseInt(_0x23c365(0x175))/0x9*(parseInt(_0x23c365(0x18e))/0xa)+parseInt(_0x23c365(0x1af))/0xb;if(_0x4e3d3c===_0x31dd09)break;else _0x31d13c['push'](_0x31d13c['shift']());}catch(_0x3a0522){_0x31d13c['push'](_0x31d13c['shift']());}}}(a360_0x37a4,0x553a2));const a360_0x4f0f0c=(function(){let _0x477a11=!![];return function(_0x19241a,_0x2399d0){const _0x3e20c5=_0x477a11?function(){const _0xe80df1=a360_0x5aa9;if(_0x2399d0){const _0x3e38c3=_0x2399d0[_0xe80df1(0x1a5)](_0x19241a,arguments);return _0x2399d0=null,_0x3e38c3;}}:function(){};return _0x477a11=![],_0x3e20c5;};}()),a360_0x120717=a360_0x4f0f0c(this,function(){const _0x11db87=a360_0x5aa9;return a360_0x120717[_0x11db87(0x1c5)]()[_0x11db87(0x18a)](_0x11db87(0x181))[_0x11db87(0x1c5)]()[_0x11db87(0x173)](a360_0x120717)[_0x11db87(0x18a)]('(((.+)+)+)+$');});function a360_0x37a4(){const _0x44dd97=['status','put','fillPackageDeploymentAction','../dtos/package-details.dto','deployPackage','package_components','packageId','name__v','toString','log','{package_id}','get','uniqueName','_connection','SUCCESS','vaultPackage','deployment_status__v','Wait\x20Executing\x20job','_logger','url','getDeployDetailsAndSaveLog','filename','responseStatus','constructor','PackageComponentDto','54stzIPN','VeevaConstants','href','Get\x20deploy\x20result','map','Validation\x20Log','VeevaError','../dtos/package-component.dto','formPackageComponentList','ENDPOINT_DEPLOY_PACKAGE','Deployment.log','data','(((.+)+)+)+$','../constants/veeva.constants','__esModule','file','reduce','8BxTqeB','errors','convertDeploymentAction','text','search','deploymentAction','ArrayUtils','filter','848580HzlokH','getLogResultText','Cannot\x20find\x20deployment\x20results','post','ENDPOINT_EXPORT_IMPORT_PACKAGE','32310MNsMMq','40GNqSkD','rel','VeevaPackageStatus','find','replace','306564MCYuYm','ENDPOINT_VALIDATE_PACKAGE','append','Deploy\x20Log','Import\x20package','length','default','VERIFIED','DEPLOYED_WITH_WARNINGS','groupToMap','475361GtgbGs','VeevaResponseStatus','apply','1588764UAobrW','createReadStream','Get\x20validation\x20details.','importVpk','getValidationDetailsAndSaveLog','PackageImportService','2892029hlPCdK','_veevaService','__importDefault','2969835ePJXwO','packageComponentList','../classes/errors/veeva-error','form-data','endsWith','_saveLog','getJobDetailUrl','33XtmIQB','getJobResult','Validation.log','multipart/form-data','artifacts','../enums/status.enums','Package\x20not\x20verified'];a360_0x37a4=function(){return _0x44dd97;};return a360_0x37a4();}a360_0x120717();'use strict';function a360_0x5aa9(_0x199b79,_0x22c6fc){const _0x19f12c=a360_0x37a4();return a360_0x5aa9=function(_0x120717,_0x4f0f0c){_0x120717=_0x120717-0x16f;let _0x37a40a=_0x19f12c[_0x120717];return _0x37a40a;},a360_0x5aa9(_0x199b79,_0x22c6fc);}var __importDefault=this&&this[a360_0x33dd64(0x1ae)]||function(_0x5a6399){const _0x1e1785=a360_0x33dd64;return _0x5a6399&&_0x5a6399[_0x1e1785(0x183)]?_0x5a6399:{'default':_0x5a6399};};Object['defineProperty'](exports,a360_0x33dd64(0x183),{'value':!![]}),exports[a360_0x33dd64(0x1ab)]=void 0x0;const veeva_constants_1=require(a360_0x33dd64(0x182)),status_enums_1=require(a360_0x33dd64(0x1bb)),veeva_error_1=require(a360_0x33dd64(0x1b1)),form_data_1=__importDefault(require(a360_0x33dd64(0x1b2))),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require(a360_0x33dd64(0x1c0)),package_component_dto_1=require(a360_0x33dd64(0x17c)),array_utils_1=require('../utils/array.utils');class PackageImportService{constructor({veevaService:_0x515329,connection:_0x1846f4,logger:_0x365275,saveLog:_0x34d868}){const _0x4945d5=a360_0x33dd64;this[_0x4945d5(0x1ad)]=_0x515329,this[_0x4945d5(0x1ca)]=_0x1846f4,this[_0x4945d5(0x1cf)]=_0x365275,this[_0x4945d5(0x1b4)]=_0x34d868;}async[a360_0x33dd64(0x1a9)](_0x8cfb69,_0x5e3b76=0x1){const _0x2847b4=a360_0x33dd64;this[_0x2847b4(0x1cf)]['log'](_0x2847b4(0x19d));const _0x59b3e1=new form_data_1[(_0x2847b4(0x19f))]();_0x59b3e1[_0x2847b4(0x19b)](_0x2847b4(0x184),(0x0,fs_1[_0x2847b4(0x1a7)])(_0x8cfb69));const _0x524165=await this[_0x2847b4(0x1ca)][_0x2847b4(0x1be)](veeva_constants_1[_0x2847b4(0x176)][_0x2847b4(0x192)],_0x59b3e1,{'headers':{'Content-Type':_0x2847b4(0x1b9)}}),_0xc8f5cf=_0x524165[_0x2847b4(0x180)];if(_0xc8f5cf[_0x2847b4(0x172)]===status_enums_1[_0x2847b4(0x1a4)][_0x2847b4(0x1cb)])return _0xc8f5cf['url'];else{if(_0x5e3b76>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this['_connection']),await this[_0x2847b4(0x1a9)](_0x8cfb69,_0x5e3b76-0x1);throw new veeva_error_1[(_0x2847b4(0x17b))](_0xc8f5cf[_0x2847b4(0x187)]);}}async[a360_0x33dd64(0x1c1)](_0x58dfe0){const _0x4caddf=a360_0x33dd64;this['_logger'][_0x4caddf(0x1c6)]('Deploy\x20package');const _0x26f0d5=await this[_0x4caddf(0x1ca)][_0x4caddf(0x191)](veeva_constants_1[_0x4caddf(0x176)][_0x4caddf(0x17e)][_0x4caddf(0x198)]('{package_id}',_0x58dfe0)),_0x2156ca=await _0x26f0d5[_0x4caddf(0x180)];if(_0x2156ca[_0x4caddf(0x172)]===status_enums_1['VeevaResponseStatus'][_0x4caddf(0x1cb)])return _0x2156ca[_0x4caddf(0x16f)];else throw new veeva_error_1['VeevaError'](_0x2156ca['errors']);}async[a360_0x33dd64(0x1b5)](_0x1cb8aa){const _0x4afd49=a360_0x33dd64;this[_0x4afd49(0x1cf)]['log'](_0x4afd49(0x1ce));const [_0x31820f]=await this[_0x4afd49(0x1ad)][_0x4afd49(0x1b7)]([_0x1cb8aa]);return _0x31820f['links'][_0x4afd49(0x197)](_0x20cc76=>_0x20cc76[_0x4afd49(0x195)]===_0x4afd49(0x1ba))[_0x4afd49(0x177)];}async[a360_0x33dd64(0x1aa)](_0x5a1819){const _0x3a6ea4=a360_0x33dd64;this[_0x3a6ea4(0x1cf)][_0x3a6ea4(0x1c6)](_0x3a6ea4(0x1a8));const {data:_0x37ab94}=await this[_0x3a6ea4(0x1ca)][_0x3a6ea4(0x1c8)](_0x5a1819);if(_0x37ab94[_0x3a6ea4(0x172)]===status_enums_1['VeevaResponseStatus'][_0x3a6ea4(0x1cb)]){const _0x8870cf=new package_details_dto_1['PackageDetailsDto'](),{log:_0x2d2ab9,id:_0x34eb82,package_status:_0x15f5da,package_steps:_0x5a380c}=_0x37ab94[_0x3a6ea4(0x1cc)],_0x4e47d3=_0x2d2ab9[_0x3a6ea4(0x18d)](_0x41dbd6=>_0x41dbd6[_0x3a6ea4(0x171)][_0x3a6ea4(0x1b3)](_0x3a6ea4(0x1b8))),_0x29c7b8=await this[_0x3a6ea4(0x18f)](_0x4e47d3[0x0][_0x3a6ea4(0x16f)]);await this['_saveLog'](_0x29c7b8,_0x3a6ea4(0x17a)),_0x8870cf[_0x3a6ea4(0x1c3)]=_0x34eb82,_0x8870cf[_0x3a6ea4(0x1b0)]=this[_0x3a6ea4(0x17d)](_0x5a380c),await this[_0x3a6ea4(0x1bf)](_0x8870cf);if(_0x15f5da!==status_enums_1[_0x3a6ea4(0x196)][_0x3a6ea4(0x1a0)])throw new Error(_0x3a6ea4(0x1bc));return _0x8870cf;}else throw new veeva_error_1[(_0x3a6ea4(0x17b))](_0x37ab94['errors']);}async[a360_0x33dd64(0x170)](_0x4cceda,_0x15893e){const _0xf412c=a360_0x33dd64;var _0x157f2d;this[_0xf412c(0x1cf)]['log'](_0xf412c(0x178));const {data:_0x27c369}=await this[_0xf412c(0x1ca)][_0xf412c(0x1c8)](_0x4cceda);if(_0x27c369[_0xf412c(0x172)]===status_enums_1[_0xf412c(0x1a4)][_0xf412c(0x1cb)]){const {responseDetails:{deployment_log:_0xf37f5e,package_status__v:_0x1c3fc0},package_steps:_0x34f23e}=_0x27c369,_0x2c6279=_0xf37f5e[_0xf412c(0x18d)](_0x560fb8=>_0x560fb8[_0xf412c(0x171)][_0xf412c(0x1b3)](_0xf412c(0x17f))),_0x278002=await this[_0xf412c(0x18f)](_0x2c6279[0x0]['url']);await this[_0xf412c(0x1b4)](_0x278002,_0xf412c(0x19c)),_0x15893e['isDeployed']=[status_enums_1[_0xf412c(0x196)]['DEPLOYED'],status_enums_1['VeevaPackageStatus'][_0xf412c(0x1a1)]]['includes'](_0x1c3fc0);const _0x38aec5=array_utils_1[_0xf412c(0x18c)]['groupUniqueToMap'](this[_0xf412c(0x17d)](_0x34f23e),({uniqueName:_0xc7d638})=>_0xc7d638);for(const _0x3be383 of _0x15893e[_0xf412c(0x1b0)]){const _0x1d6fc8=(_0x157f2d=_0x38aec5['get'](_0x3be383[_0xf412c(0x1c9)]))===null||_0x157f2d===void 0x0?void 0x0:_0x157f2d['status'];_0x1d6fc8&&(_0x3be383[_0xf412c(0x1bd)]=_0x1d6fc8);}_0x15893e[_0xf412c(0x1b0)]=_0x15893e[_0xf412c(0x1b0)][_0xf412c(0x18d)](_0x19cd77=>_0x19cd77['status']!==status_enums_1['PackageComponentStatus'][_0xf412c(0x1a0)]);if(!_0x15893e[_0xf412c(0x1b0)][_0xf412c(0x19e)])throw new Error(_0xf412c(0x190));return _0x15893e;}else throw new veeva_error_1['VeevaError'](_0x27c369[_0xf412c(0x187)]);}async[a360_0x33dd64(0x18f)](_0x200980){const _0x423b7b=a360_0x33dd64,{data:_0x298a06}=await this[_0x423b7b(0x1ca)][_0x423b7b(0x1c8)](_0x200980,{'responseType':_0x423b7b(0x189)});return _0x298a06;}[a360_0x33dd64(0x17d)](_0x3bdf9b){const _0x3bf228=a360_0x33dd64;return _0x3bdf9b[_0x3bf228(0x185)]((_0x517fcf,_0x3d6ca2)=>{const _0x5516ed=_0x3bf228,_0x3fcd1c=_0x3d6ca2[_0x5516ed(0x1c2)][_0x5516ed(0x179)](_0x2a6348=>new package_component_dto_1[(_0x5516ed(0x174))]({'status':_0x3d6ca2[_0x5516ed(0x1cd)],'stepName':_0x3d6ca2[_0x5516ed(0x1c4)],'component':_0x2a6348}));return[..._0x517fcf,..._0x3fcd1c];},[]);}async[a360_0x33dd64(0x1bf)](_0x5a7bdc){const _0x4dd8f1=a360_0x33dd64,{data:_0x520ca6}=await this['_connection'][_0x4dd8f1(0x191)](veeva_constants_1[_0x4dd8f1(0x176)][_0x4dd8f1(0x19a)][_0x4dd8f1(0x198)](_0x4dd8f1(0x1c7),_0x5a7bdc[_0x4dd8f1(0x1c3)]));if(_0x520ca6[_0x4dd8f1(0x172)]===status_enums_1[_0x4dd8f1(0x1a4)]['SUCCESS']){const {package_steps:_0x1a5258}=_0x520ca6['responseDetails'],_0x1e5388=array_utils_1[_0x4dd8f1(0x18c)][_0x4dd8f1(0x1a2)](_0x5a7bdc[_0x4dd8f1(0x1b0)],({stepName:_0x2c6c6e})=>_0x2c6c6e);for(const {name__v:_0x518744,deployment_action:_0x57fc2f}of _0x1a5258){for(const _0x4a6933 of _0x1e5388['get'](_0x518744)||[]){_0x4a6933[_0x4dd8f1(0x18b)]=package_component_dto_1['PackageComponentDto'][_0x4dd8f1(0x188)](_0x57fc2f);}}}else throw new veeva_error_1[(_0x4dd8f1(0x17b))](_0x520ca6[_0x4dd8f1(0x187)]);}async['import'](_0x5327a1){const _0x364792=a360_0x33dd64,_0x3456f1=await this[_0x364792(0x1a9)](_0x5327a1),_0x495c5a=await this[_0x364792(0x1b5)](_0x3456f1),_0x42e1b2=await this[_0x364792(0x1aa)](_0x495c5a),_0x588fba=await this[_0x364792(0x1c1)](_0x42e1b2['packageId']),_0xe94b42=await this[_0x364792(0x1b5)](_0x588fba);return this[_0x364792(0x170)](_0xe94b42,_0x42e1b2);}}exports['PackageImportService']=PackageImportService;