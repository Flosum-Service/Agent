function a360_0x4b90(_0x7e564f,_0x57fe26){const _0x218552=a360_0x4bfa();return a360_0x4b90=function(_0x45adf6,_0x1425c3){_0x45adf6=_0x45adf6-0xdf;let _0x4bfa38=_0x218552[_0x45adf6];return _0x4bfa38;},a360_0x4b90(_0x7e564f,_0x57fe26);}const a360_0x23f7b2=a360_0x4b90;(function(_0x18009b,_0x9171d9){const _0x402327=a360_0x4b90,_0x48b7a2=_0x18009b();while(!![]){try{const _0x501d8c=parseInt(_0x402327(0x129))/0x1+-parseInt(_0x402327(0x10a))/0x2*(parseInt(_0x402327(0x120))/0x3)+-parseInt(_0x402327(0x10e))/0x4*(parseInt(_0x402327(0x122))/0x5)+-parseInt(_0x402327(0xf2))/0x6+parseInt(_0x402327(0xe9))/0x7+parseInt(_0x402327(0xf7))/0x8*(-parseInt(_0x402327(0x108))/0x9)+parseInt(_0x402327(0x11d))/0xa*(parseInt(_0x402327(0x133))/0xb);if(_0x501d8c===_0x9171d9)break;else _0x48b7a2['push'](_0x48b7a2['shift']());}catch(_0x45fe47){_0x48b7a2['push'](_0x48b7a2['shift']());}}}(a360_0x4bfa,0x311c1));function a360_0x4bfa(){const _0x267b3d=['3sPbzON','find','395kraRac','constructor','put','vaultPackage','formPackageComponentList','__esModule','Deployment.log','28391aMKXiW','../dtos/package-details.dto','../utils/veeva-auth.utils','__importDefault','{package_id}','includes','VeevaConstants','../constants/veeva.constants','reduce','deployPackage','352SEckzt','_veevaService','Get\x20deploy\x20result','search','endsWith','packageComponentList','Cannot\x20find\x20deployment\x20results','packageId','ArrayUtils','default','filter','data','ENDPOINT_DEPLOY_PACKAGE','../utils/array.utils','errors','VERIFIED','text','_connection','groupUniqueToMap','18354SjZMUN','VeevaResponseStatus','Validation\x20Log','_logger','post','../classes/errors/veeva-error','filename','map','Validation.log','1301244gCXxXc','apply','PackageImportService','deployment_status__v','import','2385104dDHQgW','fillPackageDeploymentAction','../dtos/package-component.dto','ENDPOINT_EXPORT_IMPORT_PACKAGE','form-data','file','package_components','defineProperty','status','multipart/form-data','getJobResult','replace','importVpk','../enums/status.enums','(((.+)+)+)+$','SUCCESS','_saveLog','9dATeMp','url','362234fHvpCl','convertDeploymentAction','VeevaError','links','7860NkAVPe','rel','append','responseDetails','responseStatus','getLogResultText','toString','VeevaPackageStatus','getDeployDetailsAndSaveLog','getValidationDetailsAndSaveLog','getJobDetailUrl','log','Deploy\x20Log','PackageComponentDto','get','319220fhaAlF','Deploy\x20package','updateVeevaConnection'];a360_0x4bfa=function(){return _0x267b3d;};return a360_0x4bfa();}const a360_0x1425c3=(function(){let _0x325f14=!![];return function(_0x91d916,_0x4dcf8e){const _0x152a57=_0x325f14?function(){const _0xad936e=a360_0x4b90;if(_0x4dcf8e){const _0xf7e487=_0x4dcf8e[_0xad936e(0xf3)](_0x91d916,arguments);return _0x4dcf8e=null,_0xf7e487;}}:function(){};return _0x325f14=![],_0x152a57;};}()),a360_0x45adf6=a360_0x1425c3(this,function(){const _0x5ba906=a360_0x4b90;return a360_0x45adf6[_0x5ba906(0x114)]()[_0x5ba906(0x136)](_0x5ba906(0x105))['toString']()[_0x5ba906(0x123)](a360_0x45adf6)[_0x5ba906(0x136)]('(((.+)+)+)+$');});a360_0x45adf6();'use strict';var __importDefault=this&&this[a360_0x23f7b2(0x12c)]||function(_0x2833aa){const _0xfdfc30=a360_0x23f7b2;return _0x2833aa&&_0x2833aa[_0xfdfc30(0x127)]?_0x2833aa:{'default':_0x2833aa};};Object[a360_0x23f7b2(0xfe)](exports,'__esModule',{'value':!![]}),exports[a360_0x23f7b2(0xf4)]=void 0x0;const veeva_constants_1=require(a360_0x23f7b2(0x130)),status_enums_1=require(a360_0x23f7b2(0x104)),veeva_error_1=require(a360_0x23f7b2(0xee)),form_data_1=__importDefault(require(a360_0x23f7b2(0xfb))),fs_1=require('fs'),veeva_auth_utils_1=require(a360_0x23f7b2(0x12b)),package_details_dto_1=require(a360_0x23f7b2(0x12a)),package_component_dto_1=require(a360_0x23f7b2(0xf9)),array_utils_1=require(a360_0x23f7b2(0xe3));class PackageImportService{constructor({veevaService:_0x3c798b,connection:_0x164758,logger:_0x2e7644,saveLog:_0x3b5d9b}){const _0x57f6cb=a360_0x23f7b2;this[_0x57f6cb(0x134)]=_0x3c798b,this[_0x57f6cb(0xe7)]=_0x164758,this[_0x57f6cb(0xec)]=_0x2e7644,this[_0x57f6cb(0x107)]=_0x3b5d9b;}async[a360_0x23f7b2(0x103)](_0x5cbf74,_0x191be4=0x1){const _0x29f93e=a360_0x23f7b2;this['_logger'][_0x29f93e(0x119)]('Import\x20package');const _0x1b144f=new form_data_1[(_0x29f93e(0xdf))]();_0x1b144f[_0x29f93e(0x110)](_0x29f93e(0xfc),(0x0,fs_1['createReadStream'])(_0x5cbf74));const _0x8513d4=await this[_0x29f93e(0xe7)][_0x29f93e(0x124)](veeva_constants_1['VeevaConstants'][_0x29f93e(0xfa)],_0x1b144f,{'headers':{'Content-Type':_0x29f93e(0x100)}}),_0x443578=_0x8513d4[_0x29f93e(0xe1)];if(_0x443578[_0x29f93e(0x112)]===status_enums_1['VeevaResponseStatus'][_0x29f93e(0x106)])return _0x443578[_0x29f93e(0x109)];else{if(_0x191be4>0x0)return await(0x0,veeva_auth_utils_1[_0x29f93e(0x11f)])(this[_0x29f93e(0xe7)]),await this[_0x29f93e(0x103)](_0x5cbf74,_0x191be4-0x1);throw new veeva_error_1[(_0x29f93e(0x10c))](_0x443578[_0x29f93e(0xe4)]);}}async['deployPackage'](_0x179ea0){const _0x74a55d=a360_0x23f7b2;this['_logger'][_0x74a55d(0x119)](_0x74a55d(0x11e));const _0x2bb6d7=await this['_connection'][_0x74a55d(0xed)](veeva_constants_1[_0x74a55d(0x12f)][_0x74a55d(0xe2)][_0x74a55d(0x102)](_0x74a55d(0x12d),_0x179ea0)),_0x4645fe=await _0x2bb6d7['data'];if(_0x4645fe[_0x74a55d(0x112)]===status_enums_1[_0x74a55d(0xea)][_0x74a55d(0x106)])return _0x4645fe['url'];else throw new veeva_error_1['VeevaError'](_0x4645fe[_0x74a55d(0xe4)]);}async['getJobDetailUrl'](_0x595db1){const _0x351f08=a360_0x23f7b2;this['_logger']['log']('Wait\x20Executing\x20job');const [_0x245ada]=await this[_0x351f08(0x134)][_0x351f08(0x101)]([_0x595db1]);return _0x245ada[_0x351f08(0x10d)][_0x351f08(0x121)](_0x4f8ddf=>_0x4f8ddf[_0x351f08(0x10f)]==='artifacts')['href'];}async['getValidationDetailsAndSaveLog'](_0x106e7c){const _0x181614=a360_0x23f7b2;this[_0x181614(0xec)][_0x181614(0x119)]('Get\x20validation\x20details.');const {data:_0x2d6ba1}=await this['_connection']['get'](_0x106e7c);if(_0x2d6ba1[_0x181614(0x112)]===status_enums_1[_0x181614(0xea)][_0x181614(0x106)]){const _0x2d6037=new package_details_dto_1['PackageDetailsDto'](),{log:_0x2d00e5,id:_0x48e1ed,package_status:_0x413d58,package_steps:_0x19afd7}=_0x2d6ba1[_0x181614(0x125)],_0x11502d=_0x2d00e5[_0x181614(0xe0)](_0x54684e=>_0x54684e[_0x181614(0xef)][_0x181614(0x137)](_0x181614(0xf1))),_0x48a195=await this[_0x181614(0x113)](_0x11502d[0x0][_0x181614(0x109)]);await this[_0x181614(0x107)](_0x48a195,_0x181614(0xeb)),_0x2d6037['packageId']=_0x48e1ed,_0x2d6037[_0x181614(0x138)]=this['formPackageComponentList'](_0x19afd7),await this[_0x181614(0xf8)](_0x2d6037);if(_0x413d58!==status_enums_1['VeevaPackageStatus'][_0x181614(0xe5)])throw new Error('Package\x20not\x20verified');return _0x2d6037;}else throw new veeva_error_1['VeevaError'](_0x2d6ba1[_0x181614(0xe4)]);}async[a360_0x23f7b2(0x116)](_0x140e83,_0x2ab2d3){const _0xbb9dd1=a360_0x23f7b2;var _0x111505;this[_0xbb9dd1(0xec)][_0xbb9dd1(0x119)](_0xbb9dd1(0x135));const {data:_0x243be3}=await this['_connection'][_0xbb9dd1(0x11c)](_0x140e83);if(_0x243be3['responseStatus']===status_enums_1['VeevaResponseStatus'][_0xbb9dd1(0x106)]){const {responseDetails:{deployment_log:_0x8ffd9b,package_status__v:_0x27ff7f},package_steps:_0x3d2745}=_0x243be3,_0x594ec1=_0x8ffd9b[_0xbb9dd1(0xe0)](_0x305a9c=>_0x305a9c[_0xbb9dd1(0xef)][_0xbb9dd1(0x137)](_0xbb9dd1(0x128))),_0x5b6058=await this[_0xbb9dd1(0x113)](_0x594ec1[0x0][_0xbb9dd1(0x109)]);await this[_0xbb9dd1(0x107)](_0x5b6058,_0xbb9dd1(0x11a)),_0x2ab2d3['isDeployed']=[status_enums_1[_0xbb9dd1(0x115)]['DEPLOYED'],status_enums_1[_0xbb9dd1(0x115)]['DEPLOYED_WITH_WARNINGS']][_0xbb9dd1(0x12e)](_0x27ff7f);const _0x2e7770=array_utils_1[_0xbb9dd1(0x13b)][_0xbb9dd1(0xe8)](this['formPackageComponentList'](_0x3d2745),({uniqueName:_0x169cd7})=>_0x169cd7);for(const _0x2fb872 of _0x2ab2d3[_0xbb9dd1(0x138)]){const _0x461b7f=(_0x111505=_0x2e7770[_0xbb9dd1(0x11c)](_0x2fb872['uniqueName']))===null||_0x111505===void 0x0?void 0x0:_0x111505[_0xbb9dd1(0xff)];_0x461b7f&&(_0x2fb872[_0xbb9dd1(0xff)]=_0x461b7f);}_0x2ab2d3[_0xbb9dd1(0x138)]=_0x2ab2d3['packageComponentList'][_0xbb9dd1(0xe0)](_0x56145e=>_0x56145e['status']!==status_enums_1['PackageComponentStatus']['VERIFIED']);if(!_0x2ab2d3[_0xbb9dd1(0x138)]['length'])throw new Error(_0xbb9dd1(0x139));return _0x2ab2d3;}else throw new veeva_error_1[(_0xbb9dd1(0x10c))](_0x243be3['errors']);}async[a360_0x23f7b2(0x113)](_0x55a410){const _0x2ef92b=a360_0x23f7b2,{data:_0x2ab130}=await this[_0x2ef92b(0xe7)]['get'](_0x55a410,{'responseType':_0x2ef92b(0xe6)});return _0x2ab130;}[a360_0x23f7b2(0x126)](_0x4526d4){const _0xf875ee=a360_0x23f7b2;return _0x4526d4[_0xf875ee(0x131)]((_0xcafb1c,_0x2bb806)=>{const _0x97fa10=_0xf875ee,_0x4561cf=_0x2bb806[_0x97fa10(0xfd)][_0x97fa10(0xf0)](_0x253438=>new package_component_dto_1[(_0x97fa10(0x11b))]({'status':_0x2bb806[_0x97fa10(0xf5)],'stepName':_0x2bb806['name__v'],'component':_0x253438}));return[..._0xcafb1c,..._0x4561cf];},[]);}async[a360_0x23f7b2(0xf8)](_0x1ce9df){const _0x38f9c7=a360_0x23f7b2,{data:_0x10e9b3}=await this[_0x38f9c7(0xe7)]['post'](veeva_constants_1[_0x38f9c7(0x12f)]['ENDPOINT_VALIDATE_PACKAGE']['replace'](_0x38f9c7(0x12d),_0x1ce9df[_0x38f9c7(0x13a)]));if(_0x10e9b3[_0x38f9c7(0x112)]===status_enums_1['VeevaResponseStatus']['SUCCESS']){const {package_steps:_0x31a156}=_0x10e9b3[_0x38f9c7(0x111)],_0x3d4246=array_utils_1[_0x38f9c7(0x13b)]['groupToMap'](_0x1ce9df['packageComponentList'],({stepName:_0x59e964})=>_0x59e964);for(const {name__v:_0x4bc36c,deployment_action:_0xb20739}of _0x31a156){for(const _0x1289bc of _0x3d4246['get'](_0x4bc36c)||[]){_0x1289bc['deploymentAction']=package_component_dto_1[_0x38f9c7(0x11b)][_0x38f9c7(0x10b)](_0xb20739);}}}else throw new veeva_error_1[(_0x38f9c7(0x10c))](_0x10e9b3[_0x38f9c7(0xe4)]);}async[a360_0x23f7b2(0xf6)](_0x1e5ad3){const _0x4e7e34=a360_0x23f7b2,_0x47b840=await this[_0x4e7e34(0x103)](_0x1e5ad3),_0x47f1af=await this[_0x4e7e34(0x118)](_0x47b840),_0x1e071e=await this[_0x4e7e34(0x117)](_0x47f1af),_0x5653e1=await this[_0x4e7e34(0x132)](_0x1e071e['packageId']),_0x389e25=await this[_0x4e7e34(0x118)](_0x5653e1);return this[_0x4e7e34(0x116)](_0x389e25,_0x1e071e);}}exports[a360_0x23f7b2(0xf4)]=PackageImportService;