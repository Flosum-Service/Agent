function a360_0x4221(){const _0x5af5e1=['ENDPOINT_EXPORT_IMPORT_PACKAGE','length','deploymentAction','VERIFIED','getLogResultText','831996CyGVfV','9bCqwRA','filter','apply','responseStatus','Deployment.log','5489155hYTdxL','convertDeploymentAction','../constants/veeva.constants','getJobResult','Deploy\x20package','endsWith','ENDPOINT_VALIDATE_PACKAGE','4024080ZNRZry','__esModule','data','PackageComponentStatus','fillPackageDeploymentAction','artifacts','package_components','getJobDetailUrl','_connection','file','default','PackageDetailsDto','importVpk','ArrayUtils','responseDetails','ENDPOINT_DEPLOY_PACKAGE','PackageImportService','PackageComponentDto','defineProperty','../classes/errors/veeva-error','VeevaPackageStatus','status','get','constructor','toString','log','../dtos/package-component.dto','links','_saveLog','../enums/status.enums','VeevaConstants','getDeployDetailsAndSaveLog','import','Wait\x20Executing\x20job','getValidationDetailsAndSaveLog','VeevaError','17835640dwRzuX','43438pvEXZB','Import\x20package','groupToMap','packageId','4FBBJSk','VeevaResponseStatus','createReadStream','../utils/veeva-auth.utils','packageComponentList','DEPLOYED','{package_id}','multipart/form-data','filename','SUCCESS','href','append','rel','name__v','../dtos/package-details.dto','formPackageComponentList','Get\x20deploy\x20result','Get\x20validation\x20details.','4023120QEoopF','(((.+)+)+)+$','deployPackage','url','4112076rcACoi','replace','errors','find','put','Validation.log','deployment_status__v','vaultPackage','form-data','includes','_logger','post'];a360_0x4221=function(){return _0x5af5e1;};return a360_0x4221();}const a360_0x210490=a360_0x4e0b;(function(_0x1b7e05,_0x51b88f){const _0x11ec4f=a360_0x4e0b,_0x1a1c06=_0x1b7e05();while(!![]){try{const _0x35b033=-parseInt(_0x11ec4f(0x140))/0x1*(parseInt(_0x11ec4f(0x13c))/0x2)+parseInt(_0x11ec4f(0x167))/0x3+-parseInt(_0x11ec4f(0x152))/0x4+-parseInt(_0x11ec4f(0x174))/0x5+parseInt(_0x11ec4f(0x156))/0x6+-parseInt(_0x11ec4f(0x16d))/0x7+parseInt(_0x11ec4f(0x13b))/0x8*(parseInt(_0x11ec4f(0x168))/0x9);if(_0x35b033===_0x51b88f)break;else _0x1a1c06['push'](_0x1a1c06['shift']());}catch(_0x451bd3){_0x1a1c06['push'](_0x1a1c06['shift']());}}}(a360_0x4221,0x7ca20));const a360_0x2141cf=(function(){let _0xfb0169=!![];return function(_0xac23c6,_0x731d80){const _0x2089cb=_0xfb0169?function(){const _0x2b9090=a360_0x4e0b;if(_0x731d80){const _0x266630=_0x731d80[_0x2b9090(0x16a)](_0xac23c6,arguments);return _0x731d80=null,_0x266630;}}:function(){};return _0xfb0169=![],_0x2089cb;};}()),a360_0xaaa24=a360_0x2141cf(this,function(){const _0x32654a=a360_0x4e0b;return a360_0xaaa24[_0x32654a(0x12f)]()['search'](_0x32654a(0x153))[_0x32654a(0x12f)]()[_0x32654a(0x12e)](a360_0xaaa24)['search'](_0x32654a(0x153));});a360_0xaaa24();'use strict';function a360_0x4e0b(_0x52574f,_0x2743fb){const _0x28499c=a360_0x4221();return a360_0x4e0b=function(_0xaaa24,_0x2141cf){_0xaaa24=_0xaaa24-0x11e;let _0x42218a=_0x28499c[_0xaaa24];return _0x42218a;},a360_0x4e0b(_0x52574f,_0x2743fb);}var __importDefault=this&&this['__importDefault']||function(_0x571b1c){const _0x5185b4=a360_0x4e0b;return _0x571b1c&&_0x571b1c[_0x5185b4(0x175)]?_0x571b1c:{'default':_0x571b1c};};Object[a360_0x210490(0x129)](exports,a360_0x210490(0x175),{'value':!![]}),exports[a360_0x210490(0x127)]=void 0x0;const veeva_constants_1=require(a360_0x210490(0x16f)),status_enums_1=require(a360_0x210490(0x134)),veeva_error_1=require(a360_0x210490(0x12a)),form_data_1=__importDefault(require(a360_0x210490(0x15e))),fs_1=require('fs'),veeva_auth_utils_1=require(a360_0x210490(0x143)),package_details_dto_1=require(a360_0x210490(0x14e)),package_component_dto_1=require(a360_0x210490(0x131)),array_utils_1=require('../utils/array.utils');class PackageImportService{constructor({veevaService:_0x553b40,connection:_0x266980,logger:_0x5ec213,saveLog:_0x34692f}){const _0x471564=a360_0x210490;this['_veevaService']=_0x553b40,this[_0x471564(0x11f)]=_0x266980,this[_0x471564(0x160)]=_0x5ec213,this[_0x471564(0x133)]=_0x34692f;}async['importVpk'](_0x336532,_0x28b1cf=0x1){const _0x7c21f4=a360_0x210490;this['_logger'][_0x7c21f4(0x130)](_0x7c21f4(0x13d));const _0x280ad8=new form_data_1[(_0x7c21f4(0x121))]();_0x280ad8[_0x7c21f4(0x14b)](_0x7c21f4(0x120),(0x0,fs_1[_0x7c21f4(0x142)])(_0x336532));const _0x243439=await this[_0x7c21f4(0x11f)][_0x7c21f4(0x15a)](veeva_constants_1[_0x7c21f4(0x135)][_0x7c21f4(0x162)],_0x280ad8,{'headers':{'Content-Type':_0x7c21f4(0x147)}}),_0x178f2d=_0x243439[_0x7c21f4(0x176)];if(_0x178f2d[_0x7c21f4(0x16b)]===status_enums_1[_0x7c21f4(0x141)]['SUCCESS'])return _0x178f2d['url'];else{if(_0x28b1cf>0x0)return await(0x0,veeva_auth_utils_1['updateVeevaConnection'])(this[_0x7c21f4(0x11f)]),await this[_0x7c21f4(0x123)](_0x336532,_0x28b1cf-0x1);throw new veeva_error_1[(_0x7c21f4(0x13a))](_0x178f2d[_0x7c21f4(0x158)]);}}async[a360_0x210490(0x154)](_0x55900f){const _0x18d577=a360_0x210490;this['_logger'][_0x18d577(0x130)](_0x18d577(0x171));const _0xd533f7=await this['_connection'][_0x18d577(0x161)](veeva_constants_1[_0x18d577(0x135)][_0x18d577(0x126)][_0x18d577(0x157)](_0x18d577(0x146),_0x55900f)),_0x2c0cd0=await _0xd533f7[_0x18d577(0x176)];if(_0x2c0cd0['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x18d577(0x149)])return _0x2c0cd0[_0x18d577(0x155)];else throw new veeva_error_1['VeevaError'](_0x2c0cd0['errors']);}async[a360_0x210490(0x11e)](_0x573fea){const _0x5c89ef=a360_0x210490;this['_logger'][_0x5c89ef(0x130)](_0x5c89ef(0x138));const [_0x1f0d5a]=await this['_veevaService'][_0x5c89ef(0x170)]([_0x573fea]);return _0x1f0d5a[_0x5c89ef(0x132)][_0x5c89ef(0x159)](_0x5f5629=>_0x5f5629[_0x5c89ef(0x14c)]===_0x5c89ef(0x179))[_0x5c89ef(0x14a)];}async[a360_0x210490(0x139)](_0x525497){const _0x11528f=a360_0x210490;this[_0x11528f(0x160)]['log'](_0x11528f(0x151));const {data:_0x27085b}=await this[_0x11528f(0x11f)]['get'](_0x525497);if(_0x27085b['responseStatus']===status_enums_1['VeevaResponseStatus']['SUCCESS']){const _0x2d8a83=new package_details_dto_1[(_0x11528f(0x122))](),{log:_0x5d4812,id:_0x110697,package_status:_0x3fa7ac,package_steps:_0x4fff85}=_0x27085b[_0x11528f(0x15d)],_0x1644db=_0x5d4812[_0x11528f(0x169)](_0x3cb15e=>_0x3cb15e[_0x11528f(0x148)]['endsWith'](_0x11528f(0x15b))),_0x59dfb5=await this['getLogResultText'](_0x1644db[0x0][_0x11528f(0x155)]);await this[_0x11528f(0x133)](_0x59dfb5,'Validation\x20Log'),_0x2d8a83['packageId']=_0x110697,_0x2d8a83[_0x11528f(0x144)]=this[_0x11528f(0x14f)](_0x4fff85),await this[_0x11528f(0x178)](_0x2d8a83);if(_0x3fa7ac!==status_enums_1[_0x11528f(0x12b)][_0x11528f(0x165)])throw new Error('Package\x20not\x20verified');return _0x2d8a83;}else throw new veeva_error_1[(_0x11528f(0x13a))](_0x27085b[_0x11528f(0x158)]);}async['getDeployDetailsAndSaveLog'](_0xd9800b,_0x54c490){const _0x16b23b=a360_0x210490;var _0x3091e9;this[_0x16b23b(0x160)][_0x16b23b(0x130)](_0x16b23b(0x150));const {data:_0x4ee5cc}=await this[_0x16b23b(0x11f)]['get'](_0xd9800b);if(_0x4ee5cc['responseStatus']===status_enums_1[_0x16b23b(0x141)]['SUCCESS']){const {responseDetails:{deployment_log:_0x4f9bf5,package_status__v:_0x7b17de},package_steps:_0x320c69}=_0x4ee5cc,_0xf4f9f1=_0x4f9bf5[_0x16b23b(0x169)](_0x57d48e=>_0x57d48e['filename'][_0x16b23b(0x172)](_0x16b23b(0x16c))),_0x3433c0=await this[_0x16b23b(0x166)](_0xf4f9f1[0x0]['url']);await this[_0x16b23b(0x133)](_0x3433c0,'Deploy\x20Log'),_0x54c490['isDeployed']=[status_enums_1['VeevaPackageStatus'][_0x16b23b(0x145)],status_enums_1[_0x16b23b(0x12b)]['DEPLOYED_WITH_WARNINGS']][_0x16b23b(0x15f)](_0x7b17de);const _0x3104ee=array_utils_1[_0x16b23b(0x124)]['groupUniqueToMap'](this[_0x16b23b(0x14f)](_0x320c69),({uniqueName:_0x372b6d})=>_0x372b6d);for(const _0x2208b6 of _0x54c490[_0x16b23b(0x144)]){const _0x1d632=(_0x3091e9=_0x3104ee[_0x16b23b(0x12d)](_0x2208b6['uniqueName']))===null||_0x3091e9===void 0x0?void 0x0:_0x3091e9['status'];_0x1d632&&(_0x2208b6[_0x16b23b(0x12c)]=_0x1d632);}_0x54c490[_0x16b23b(0x144)]=_0x54c490['packageComponentList'][_0x16b23b(0x169)](_0x59963c=>_0x59963c[_0x16b23b(0x12c)]!==status_enums_1[_0x16b23b(0x177)][_0x16b23b(0x165)]);if(!_0x54c490['packageComponentList'][_0x16b23b(0x163)])throw new Error('Cannot\x20find\x20deployment\x20results');return _0x54c490;}else throw new veeva_error_1[(_0x16b23b(0x13a))](_0x4ee5cc[_0x16b23b(0x158)]);}async[a360_0x210490(0x166)](_0x326d9a){const _0x2fede6=a360_0x210490,{data:_0x5e9ca3}=await this[_0x2fede6(0x11f)][_0x2fede6(0x12d)](_0x326d9a,{'responseType':'text'});return _0x5e9ca3;}[a360_0x210490(0x14f)](_0x3406c3){return _0x3406c3['reduce']((_0x3e24d8,_0x23f038)=>{const _0x18d6cf=a360_0x4e0b,_0x4e28dc=_0x23f038[_0x18d6cf(0x17a)]['map'](_0x1cd943=>new package_component_dto_1[(_0x18d6cf(0x128))]({'status':_0x23f038[_0x18d6cf(0x15c)],'stepName':_0x23f038[_0x18d6cf(0x14d)],'component':_0x1cd943}));return[..._0x3e24d8,..._0x4e28dc];},[]);}async[a360_0x210490(0x178)](_0x23b8f3){const _0x9f5c96=a360_0x210490,{data:_0x114774}=await this['_connection'][_0x9f5c96(0x161)](veeva_constants_1[_0x9f5c96(0x135)][_0x9f5c96(0x173)][_0x9f5c96(0x157)](_0x9f5c96(0x146),_0x23b8f3['packageId']));if(_0x114774[_0x9f5c96(0x16b)]===status_enums_1[_0x9f5c96(0x141)]['SUCCESS']){const {package_steps:_0x588912}=_0x114774[_0x9f5c96(0x125)],_0x203480=array_utils_1[_0x9f5c96(0x124)][_0x9f5c96(0x13e)](_0x23b8f3[_0x9f5c96(0x144)],({stepName:_0x57cead})=>_0x57cead);for(const {name__v:_0x29ee27,deployment_action:_0x388fda}of _0x588912){for(const _0x2f295c of _0x203480[_0x9f5c96(0x12d)](_0x29ee27)||[]){_0x2f295c[_0x9f5c96(0x164)]=package_component_dto_1['PackageComponentDto'][_0x9f5c96(0x16e)](_0x388fda);}}}else throw new veeva_error_1[(_0x9f5c96(0x13a))](_0x114774[_0x9f5c96(0x158)]);}async[a360_0x210490(0x137)](_0x51f914){const _0x2eb430=a360_0x210490,_0x3c93e5=await this[_0x2eb430(0x123)](_0x51f914),_0x190bb3=await this[_0x2eb430(0x11e)](_0x3c93e5),_0x12dc38=await this[_0x2eb430(0x139)](_0x190bb3),_0x298e73=await this[_0x2eb430(0x154)](_0x12dc38[_0x2eb430(0x13f)]),_0x592222=await this['getJobDetailUrl'](_0x298e73);return this[_0x2eb430(0x136)](_0x592222,_0x12dc38);}}exports['PackageImportService']=PackageImportService;