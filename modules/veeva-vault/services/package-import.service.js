function a376_0x5ae6(){const _0x6eac1f=['toString','1450456hDtcFU','Get\x20deploy\x20result','__importDefault','25930umSZWD','artifacts','55996kNRvsF','Validation\x20Log','_veevaService','DEPLOYED_WITH_WARNINGS','post','(((.+)+)+)+$','links','text','ENDPOINT_EXPORT_IMPORT_PACKAGE','Package\x20not\x20verified','Deployment.log','status','getJobResult','groupToMap','../constants/veeva.constants','1170092aVtoFL','VERIFIED','get','formPackageComponentList','uniqueName','errors','vaultPackage','PackageDetailsDto','30954ezMgnP','deploymentAction','PackageComponentDto','responseStatus','filename','getDeployDetailsAndSaveLog','_logger','getValidationDetailsAndSaveLog','2007ipiNMf','replace','215229MxsokN','importVpk','ENDPOINT_VALIDATE_PACKAGE','rel','DEPLOYED','name__v','default','packageId','data','VeevaConstants','put','filter','href','../classes/errors/veeva-error','_connection','Deploy\x20Log','log','SUCCESS','Wait\x20Executing\x20job','../dtos/package-details.dto','40gZUZVk','file','__esModule','VeevaError','updateVeevaConnection','map','responseDetails','reduce','VeevaPackageStatus','convertDeploymentAction','getLogResultText','ArrayUtils','Import\x20package','_saveLog','endsWith','../dtos/package-component.dto','isDeployed','packageComponentList','VeevaResponseStatus','fillPackageDeploymentAction','form-data','package_components','Validation.log','length','append','multipart/form-data','getJobDetailUrl','defineProperty','1097220WGwrXv','PackageComponentStatus','url','11JWuWqT'];a376_0x5ae6=function(){return _0x6eac1f;};return a376_0x5ae6();}const a376_0x13dcc9=a376_0x49b4;(function(_0x496a2a,_0x480dfe){const _0x1ac644=a376_0x49b4,_0xe27740=_0x496a2a();while(!![]){try{const _0x23b678=parseInt(_0x1ac644(0x19c))/0x1*(-parseInt(_0x1ac644(0x1ba))/0x2)+parseInt(_0x1ac644(0x1c4))/0x3+parseInt(_0x1ac644(0x1a3))/0x4*(-parseInt(_0x1ac644(0x1d8))/0x5)+-parseInt(_0x1ac644(0x199))/0x6+parseInt(_0x1ac644(0x1b2))/0x7+-parseInt(_0x1ac644(0x19e))/0x8+parseInt(_0x1ac644(0x1c2))/0x9*(parseInt(_0x1ac644(0x1a1))/0xa);if(_0x23b678===_0x480dfe)break;else _0xe27740['push'](_0xe27740['shift']());}catch(_0x1007c3){_0xe27740['push'](_0xe27740['shift']());}}}(a376_0x5ae6,0x29ae2));const a376_0x5210ea=(function(){let _0x121d8e=!![];return function(_0x158ecd,_0x22ca42){const _0x52a35e=_0x121d8e?function(){if(_0x22ca42){const _0x321423=_0x22ca42['apply'](_0x158ecd,arguments);return _0x22ca42=null,_0x321423;}}:function(){};return _0x121d8e=![],_0x52a35e;};}()),a376_0x109006=a376_0x5210ea(this,function(){const _0x1d258b=a376_0x49b4;return a376_0x109006[_0x1d258b(0x19d)]()['search'](_0x1d258b(0x1a8))[_0x1d258b(0x19d)]()['constructor'](a376_0x109006)['search']('(((.+)+)+)+$');});a376_0x109006();'use strict';var __importDefault=this&&this[a376_0x13dcc9(0x1a0)]||function(_0x16d132){const _0x5b384f=a376_0x13dcc9;return _0x16d132&&_0x16d132[_0x5b384f(0x1da)]?_0x16d132:{'default':_0x16d132};};Object[a376_0x13dcc9(0x198)](exports,a376_0x13dcc9(0x1da),{'value':!![]}),exports['PackageImportService']=void 0x0;const veeva_constants_1=require(a376_0x13dcc9(0x1b1)),status_enums_1=require('../enums/status.enums'),veeva_error_1=require(a376_0x13dcc9(0x1d1)),form_data_1=__importDefault(require(a376_0x13dcc9(0x191))),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require(a376_0x13dcc9(0x1d7)),package_component_dto_1=require(a376_0x13dcc9(0x1e7)),array_utils_1=require('../utils/array.utils');class PackageImportService{constructor({veevaService:_0x43ffc6,connection:_0x30a94a,logger:_0x12c08e,saveLog:_0x241477}){const _0x3ae2e9=a376_0x13dcc9;this[_0x3ae2e9(0x1a5)]=_0x43ffc6,this[_0x3ae2e9(0x1d2)]=_0x30a94a,this['_logger']=_0x12c08e,this[_0x3ae2e9(0x1e5)]=_0x241477;}async[a376_0x13dcc9(0x1c5)](_0x4a3f35,_0x496b05=0x1){const _0x9d11d4=a376_0x13dcc9;this[_0x9d11d4(0x1c0)][_0x9d11d4(0x1d4)](_0x9d11d4(0x1e4));const _0x1d0459=new form_data_1[(_0x9d11d4(0x1ca))]();_0x1d0459[_0x9d11d4(0x195)](_0x9d11d4(0x1d9),(0x0,fs_1['createReadStream'])(_0x4a3f35));const _0xe495cc=await this['_connection'][_0x9d11d4(0x1ce)](veeva_constants_1['VeevaConstants'][_0x9d11d4(0x1ab)],_0x1d0459,{'headers':{'Content-Type':_0x9d11d4(0x196)}}),_0x24883a=_0xe495cc['data'];if(_0x24883a[_0x9d11d4(0x1bd)]===status_enums_1['VeevaResponseStatus']['SUCCESS'])return _0x24883a[_0x9d11d4(0x19b)];else{if(_0x496b05>0x0)return await(0x0,veeva_auth_utils_1[_0x9d11d4(0x1dc)])(this['_connection']),await this['importVpk'](_0x4a3f35,_0x496b05-0x1);throw new veeva_error_1[(_0x9d11d4(0x1db))](_0x24883a[_0x9d11d4(0x1b7)]);}}async['deployPackage'](_0x67d229){const _0x186f83=a376_0x13dcc9;this[_0x186f83(0x1c0)][_0x186f83(0x1d4)]('Deploy\x20package');const _0x8556b8=await this['_connection'][_0x186f83(0x1a7)](veeva_constants_1[_0x186f83(0x1cd)]['ENDPOINT_DEPLOY_PACKAGE'][_0x186f83(0x1c3)]('{package_id}',_0x67d229)),_0x22b04b=await _0x8556b8[_0x186f83(0x1cc)];if(_0x22b04b[_0x186f83(0x1bd)]===status_enums_1[_0x186f83(0x18f)][_0x186f83(0x1d5)])return _0x22b04b['url'];else throw new veeva_error_1[(_0x186f83(0x1db))](_0x22b04b[_0x186f83(0x1b7)]);}async[a376_0x13dcc9(0x197)](_0x2ef77e){const _0x234fe1=a376_0x13dcc9;this[_0x234fe1(0x1c0)]['log'](_0x234fe1(0x1d6));const [_0x1caf6c]=await this[_0x234fe1(0x1a5)][_0x234fe1(0x1af)]([_0x2ef77e]);return _0x1caf6c[_0x234fe1(0x1a9)]['find'](_0x2c8734=>_0x2c8734[_0x234fe1(0x1c7)]===_0x234fe1(0x1a2))[_0x234fe1(0x1d0)];}async[a376_0x13dcc9(0x1c1)](_0x534262){const _0xb4ce57=a376_0x13dcc9;this['_logger']['log']('Get\x20validation\x20details.');const {data:_0x22e67f}=await this['_connection'][_0xb4ce57(0x1b4)](_0x534262);if(_0x22e67f[_0xb4ce57(0x1bd)]===status_enums_1[_0xb4ce57(0x18f)]['SUCCESS']){const _0x1ad2f9=new package_details_dto_1[(_0xb4ce57(0x1b9))](),{log:_0x7894f8,id:_0x52f6cf,package_status:_0x5dc482,package_steps:_0x3fd847}=_0x22e67f[_0xb4ce57(0x1b8)],_0x1d0225=_0x7894f8[_0xb4ce57(0x1cf)](_0x28e514=>_0x28e514[_0xb4ce57(0x1be)][_0xb4ce57(0x1e6)](_0xb4ce57(0x193))),_0x139085=await this[_0xb4ce57(0x1e2)](_0x1d0225[0x0][_0xb4ce57(0x19b)]);await this[_0xb4ce57(0x1e5)](_0x139085,_0xb4ce57(0x1a4)),_0x1ad2f9[_0xb4ce57(0x1cb)]=_0x52f6cf,_0x1ad2f9[_0xb4ce57(0x1e9)]=this['formPackageComponentList'](_0x3fd847),await this[_0xb4ce57(0x190)](_0x1ad2f9);if(_0x5dc482!==status_enums_1[_0xb4ce57(0x1e0)]['VERIFIED'])throw new Error(_0xb4ce57(0x1ac));return _0x1ad2f9;}else throw new veeva_error_1['VeevaError'](_0x22e67f[_0xb4ce57(0x1b7)]);}async['getDeployDetailsAndSaveLog'](_0x1f5286,_0x3a7d98){const _0x524abe=a376_0x13dcc9;var _0x1ea8b1;this['_logger']['log'](_0x524abe(0x19f));const {data:_0x2c7ee6}=await this[_0x524abe(0x1d2)][_0x524abe(0x1b4)](_0x1f5286);if(_0x2c7ee6['responseStatus']===status_enums_1[_0x524abe(0x18f)][_0x524abe(0x1d5)]){const {responseDetails:{deployment_log:_0x14d490,package_status__v:_0x486c28},package_steps:_0x6202e0}=_0x2c7ee6,_0x43a6d4=_0x14d490[_0x524abe(0x1cf)](_0x4ec45f=>_0x4ec45f[_0x524abe(0x1be)]['endsWith'](_0x524abe(0x1ad))),_0x277c2c=await this[_0x524abe(0x1e2)](_0x43a6d4[0x0]['url']);await this[_0x524abe(0x1e5)](_0x277c2c,_0x524abe(0x1d3)),_0x3a7d98[_0x524abe(0x1e8)]=[status_enums_1[_0x524abe(0x1e0)][_0x524abe(0x1c8)],status_enums_1[_0x524abe(0x1e0)][_0x524abe(0x1a6)]]['includes'](_0x486c28);const _0xf76bc1=array_utils_1['ArrayUtils']['groupUniqueToMap'](this['formPackageComponentList'](_0x6202e0),({uniqueName:_0x5280ec})=>_0x5280ec);for(const _0x3c4ad3 of _0x3a7d98[_0x524abe(0x1e9)]){const _0x2d6c62=(_0x1ea8b1=_0xf76bc1[_0x524abe(0x1b4)](_0x3c4ad3[_0x524abe(0x1b6)]))===null||_0x1ea8b1===void 0x0?void 0x0:_0x1ea8b1['status'];_0x2d6c62&&(_0x3c4ad3[_0x524abe(0x1ae)]=_0x2d6c62);}_0x3a7d98[_0x524abe(0x1e9)]=_0x3a7d98[_0x524abe(0x1e9)][_0x524abe(0x1cf)](_0x583de3=>_0x583de3[_0x524abe(0x1ae)]!==status_enums_1[_0x524abe(0x19a)][_0x524abe(0x1b3)]);if(!_0x3a7d98[_0x524abe(0x1e9)][_0x524abe(0x194)])throw new Error('Cannot\x20find\x20deployment\x20results');return _0x3a7d98;}else throw new veeva_error_1[(_0x524abe(0x1db))](_0x2c7ee6[_0x524abe(0x1b7)]);}async['getLogResultText'](_0x536778){const _0x438e82=a376_0x13dcc9,{data:_0x348cf2}=await this[_0x438e82(0x1d2)][_0x438e82(0x1b4)](_0x536778,{'responseType':_0x438e82(0x1aa)});return _0x348cf2;}[a376_0x13dcc9(0x1b5)](_0x58bed4){const _0x52402f=a376_0x13dcc9;return _0x58bed4[_0x52402f(0x1df)]((_0x14af5c,_0x576364)=>{const _0x34d0ea=_0x52402f,_0x558131=_0x576364[_0x34d0ea(0x192)][_0x34d0ea(0x1dd)](_0x108e7c=>new package_component_dto_1['PackageComponentDto']({'status':_0x576364['deployment_status__v'],'stepName':_0x576364[_0x34d0ea(0x1c9)],'component':_0x108e7c}));return[..._0x14af5c,..._0x558131];},[]);}async[a376_0x13dcc9(0x190)](_0x50b948){const _0x3eb242=a376_0x13dcc9,{data:_0xb7aa0c}=await this[_0x3eb242(0x1d2)][_0x3eb242(0x1a7)](veeva_constants_1[_0x3eb242(0x1cd)][_0x3eb242(0x1c6)][_0x3eb242(0x1c3)]('{package_id}',_0x50b948['packageId']));if(_0xb7aa0c[_0x3eb242(0x1bd)]===status_enums_1[_0x3eb242(0x18f)][_0x3eb242(0x1d5)]){const {package_steps:_0xf55b88}=_0xb7aa0c[_0x3eb242(0x1de)],_0x5133c9=array_utils_1[_0x3eb242(0x1e3)][_0x3eb242(0x1b0)](_0x50b948['packageComponentList'],({stepName:_0x2a3d7e})=>_0x2a3d7e);for(const {name__v:_0x40280d,deployment_action:_0x4ad3e0}of _0xf55b88){for(const _0x3dfa5f of _0x5133c9[_0x3eb242(0x1b4)](_0x40280d)||[]){_0x3dfa5f[_0x3eb242(0x1bb)]=package_component_dto_1[_0x3eb242(0x1bc)][_0x3eb242(0x1e1)](_0x4ad3e0);}}}else throw new veeva_error_1['VeevaError'](_0xb7aa0c[_0x3eb242(0x1b7)]);}async['import'](_0x2b70f6){const _0x3f4fcf=a376_0x13dcc9,_0x27025f=await this[_0x3f4fcf(0x1c5)](_0x2b70f6),_0x5dcd43=await this[_0x3f4fcf(0x197)](_0x27025f),_0x224302=await this[_0x3f4fcf(0x1c1)](_0x5dcd43),_0x20689e=await this['deployPackage'](_0x224302[_0x3f4fcf(0x1cb)]),_0x541a32=await this[_0x3f4fcf(0x197)](_0x20689e);return this[_0x3f4fcf(0x1bf)](_0x541a32,_0x224302);}}function a376_0x49b4(_0x459b38,_0x5ed06c){const _0x4a9b9b=a376_0x5ae6();return a376_0x49b4=function(_0x109006,_0x5210ea){_0x109006=_0x109006-0x18f;let _0x5ae602=_0x4a9b9b[_0x109006];return _0x5ae602;},a376_0x49b4(_0x459b38,_0x5ed06c);}exports['PackageImportService']=PackageImportService;