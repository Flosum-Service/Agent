const a403_0x262a54=a403_0x1cc6;(function(_0x3ec465,_0x1e0eaa){const _0x70456=a403_0x1cc6,_0x99dfe0=_0x3ec465();while(!![]){try{const _0x49cac5=parseInt(_0x70456(0xff))/0x1+parseInt(_0x70456(0x125))/0x2*(parseInt(_0x70456(0x108))/0x3)+-parseInt(_0x70456(0xeb))/0x4+parseInt(_0x70456(0x109))/0x5+-parseInt(_0x70456(0xf1))/0x6*(-parseInt(_0x70456(0x104))/0x7)+-parseInt(_0x70456(0x119))/0x8*(-parseInt(_0x70456(0x10e))/0x9)+-parseInt(_0x70456(0x103))/0xa*(parseInt(_0x70456(0x117))/0xb);if(_0x49cac5===_0x1e0eaa)break;else _0x99dfe0['push'](_0x99dfe0['shift']());}catch(_0x149155){_0x99dfe0['push'](_0x99dfe0['shift']());}}}(a403_0x4c3f,0xbba42));const a403_0x48b35a=(function(){let _0x3c0531=!![];return function(_0x39964c,_0x2da94c){const _0x59eb3e=_0x3c0531?function(){if(_0x2da94c){const _0x36a1b1=_0x2da94c['apply'](_0x39964c,arguments);return _0x2da94c=null,_0x36a1b1;}}:function(){};return _0x3c0531=![],_0x59eb3e;};}()),a403_0x19120a=a403_0x48b35a(this,function(){const _0x444ffe=a403_0x1cc6;return a403_0x19120a[_0x444ffe(0x100)]()[_0x444ffe(0x114)]('(((.+)+)+)+$')[_0x444ffe(0x100)]()['constructor'](a403_0x19120a)[_0x444ffe(0x114)](_0x444ffe(0xd4));});a403_0x19120a();function a403_0x1cc6(_0x1dcdc2,_0x295b53){const _0x3adda4=a403_0x4c3f();return a403_0x1cc6=function(_0x19120a,_0x48b35a){_0x19120a=_0x19120a-0xd2;let _0x4c3f30=_0x3adda4[_0x19120a];return _0x4c3f30;},a403_0x1cc6(_0x1dcdc2,_0x295b53);}'use strict';var __importDefault=this&&this[a403_0x262a54(0xea)]||function(_0x4578ca){const _0x3b8e4c=a403_0x262a54;return _0x4578ca&&_0x4578ca[_0x3b8e4c(0xdd)]?_0x4578ca:{'default':_0x4578ca};};Object[a403_0x262a54(0xef)](exports,a403_0x262a54(0xdd),{'value':!![]}),exports[a403_0x262a54(0x102)]=void 0x0;const veeva_constants_1=require(a403_0x262a54(0xd6)),status_enums_1=require(a403_0x262a54(0x11f)),veeva_error_1=require(a403_0x262a54(0x12a)),form_data_1=__importDefault(require(a403_0x262a54(0x112))),fs_1=require('fs'),veeva_auth_utils_1=require('../utils/veeva-auth.utils'),package_details_dto_1=require(a403_0x262a54(0x126)),package_component_dto_1=require(a403_0x262a54(0xd5)),array_utils_1=require('../utils/array.utils');class PackageImportService{constructor({veevaService:_0x3e7c3d,connection:_0x2c47ae,logger:_0x4bfc63,saveLog:_0xf54255}){const _0x4e2a7e=a403_0x262a54;this[_0x4e2a7e(0x11c)]=_0x3e7c3d,this['_connection']=_0x2c47ae,this[_0x4e2a7e(0xec)]=_0x4bfc63,this[_0x4e2a7e(0xf3)]=_0xf54255;}async[a403_0x262a54(0x121)](_0x39e3f4,_0x16fcc3=0x1){const _0x5e637e=a403_0x262a54;this[_0x5e637e(0xec)][_0x5e637e(0xe4)](_0x5e637e(0xe9));const _0x47f7a9=new form_data_1[(_0x5e637e(0xf2))]();_0x47f7a9[_0x5e637e(0x107)]('file',(0x0,fs_1[_0x5e637e(0xd8)])(_0x39e3f4));const _0x15daa3=await this['_connection'][_0x5e637e(0x10c)](veeva_constants_1[_0x5e637e(0x10b)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],_0x47f7a9,{'headers':{'Content-Type':_0x5e637e(0xfa)}}),_0x3055a1=_0x15daa3['data'];if(_0x3055a1[_0x5e637e(0x11b)]===status_enums_1[_0x5e637e(0x105)][_0x5e637e(0x115)])return _0x3055a1[_0x5e637e(0xd3)];else{if(_0x16fcc3>0x0)return await(0x0,veeva_auth_utils_1[_0x5e637e(0x110)])(this[_0x5e637e(0x123)]),await this[_0x5e637e(0x121)](_0x39e3f4,_0x16fcc3-0x1);throw new veeva_error_1[(_0x5e637e(0xf4))](_0x3055a1[_0x5e637e(0x118)]);}}async[a403_0x262a54(0xe6)](_0x436d57){const _0x2c38c1=a403_0x262a54;this[_0x2c38c1(0xec)][_0x2c38c1(0xe4)](_0x2c38c1(0x122));const _0x378708=await this[_0x2c38c1(0x123)]['post'](veeva_constants_1[_0x2c38c1(0x10b)][_0x2c38c1(0x120)]['replace']('{package_id}',_0x436d57)),_0x549f6f=await _0x378708['data'];if(_0x549f6f[_0x2c38c1(0x11b)]===status_enums_1['VeevaResponseStatus'][_0x2c38c1(0x115)])return _0x549f6f[_0x2c38c1(0xd3)];else throw new veeva_error_1[(_0x2c38c1(0xf4))](_0x549f6f['errors']);}async[a403_0x262a54(0xfd)](_0x223567){const _0x40242d=a403_0x262a54;this['_logger'][_0x40242d(0xe4)](_0x40242d(0x113));const [_0x41d449]=await this[_0x40242d(0x11c)][_0x40242d(0xda)]([_0x223567]);return _0x41d449[_0x40242d(0xe3)]['find'](_0x2fa362=>_0x2fa362[_0x40242d(0x116)]==='artifacts')['href'];}async[a403_0x262a54(0x11d)](_0x471bff){const _0x24799b=a403_0x262a54;this['_logger'][_0x24799b(0xe4)]('Get\x20validation\x20details.');const {data:_0x344985}=await this[_0x24799b(0x123)][_0x24799b(0xe0)](_0x471bff);if(_0x344985[_0x24799b(0x11b)]===status_enums_1[_0x24799b(0x105)][_0x24799b(0x115)]){const _0x2b7bf8=new package_details_dto_1[(_0x24799b(0x106))](),{log:_0x46ab42,id:_0x174d4d,package_status:_0x2ff13e,package_steps:_0xf7446f}=_0x344985[_0x24799b(0xe2)],_0x32a5b0=_0x46ab42[_0x24799b(0x127)](_0x3c960e=>_0x3c960e[_0x24799b(0xd7)][_0x24799b(0xe7)]('Validation.log')),_0x43f0a2=await this[_0x24799b(0xf7)](_0x32a5b0[0x0][_0x24799b(0xd3)]);await this['_saveLog'](_0x43f0a2,_0x24799b(0xf0)),_0x2b7bf8[_0x24799b(0x10a)]=_0x174d4d,_0x2b7bf8['packageComponentList']=this[_0x24799b(0x10d)](_0xf7446f),await this[_0x24799b(0xfe)](_0x2b7bf8);if(_0x2ff13e!==status_enums_1[_0x24799b(0xf5)][_0x24799b(0xed)])throw new Error(_0x24799b(0xdb));return _0x2b7bf8;}else throw new veeva_error_1['VeevaError'](_0x344985[_0x24799b(0x118)]);}async[a403_0x262a54(0xde)](_0x2b475b,_0x3bb5ce){const _0x3a870e=a403_0x262a54;var _0x4d80fa;this['_logger']['log']('Get\x20deploy\x20result');const {data:_0x33dd79}=await this[_0x3a870e(0x123)][_0x3a870e(0xe0)](_0x2b475b);if(_0x33dd79[_0x3a870e(0x11b)]===status_enums_1[_0x3a870e(0x105)][_0x3a870e(0x115)]){const {responseDetails:{deployment_log:_0x3b75b7,package_status__v:_0x3e3340},package_steps:_0x8c0ef5}=_0x33dd79,_0x37c1c5=_0x3b75b7[_0x3a870e(0x127)](_0x1cc373=>_0x1cc373[_0x3a870e(0xd7)]['endsWith'](_0x3a870e(0x10f))),_0x5d7cc7=await this[_0x3a870e(0xf7)](_0x37c1c5[0x0][_0x3a870e(0xd3)]);await this[_0x3a870e(0xf3)](_0x5d7cc7,_0x3a870e(0x129)),_0x3bb5ce['isDeployed']=[status_enums_1[_0x3a870e(0xf5)][_0x3a870e(0xe8)],status_enums_1['VeevaPackageStatus'][_0x3a870e(0xe1)]][_0x3a870e(0xf6)](_0x3e3340);const _0x206c7c=array_utils_1['ArrayUtils'][_0x3a870e(0x128)](this[_0x3a870e(0x10d)](_0x8c0ef5),({uniqueName:_0x353691})=>_0x353691);for(const _0x31f2b8 of _0x3bb5ce['packageComponentList']){const _0xc1c00f=(_0x4d80fa=_0x206c7c[_0x3a870e(0xe0)](_0x31f2b8[_0x3a870e(0xd9)]))===null||_0x4d80fa===void 0x0?void 0x0:_0x4d80fa[_0x3a870e(0xf8)];_0xc1c00f&&(_0x31f2b8[_0x3a870e(0xf8)]=_0xc1c00f);}_0x3bb5ce[_0x3a870e(0x124)]=_0x3bb5ce[_0x3a870e(0x124)][_0x3a870e(0x127)](_0x403146=>_0x403146['status']!==status_enums_1[_0x3a870e(0x11a)]['VERIFIED']);if(!_0x3bb5ce['packageComponentList'][_0x3a870e(0xee)])throw new Error(_0x3a870e(0x11e));return _0x3bb5ce;}else throw new veeva_error_1[(_0x3a870e(0xf4))](_0x33dd79[_0x3a870e(0x118)]);}async[a403_0x262a54(0xf7)](_0x355dea){const _0x2d3f5d=a403_0x262a54,{data:_0x392580}=await this[_0x2d3f5d(0x123)][_0x2d3f5d(0xe0)](_0x355dea,{'responseType':_0x2d3f5d(0xe5)});return _0x392580;}[a403_0x262a54(0x10d)](_0x583343){return _0x583343['reduce']((_0x215ef4,_0x76a90c)=>{const _0x5b1b0f=a403_0x1cc6,_0x383554=_0x76a90c['package_components']['map'](_0x55f08e=>new package_component_dto_1['PackageComponentDto']({'status':_0x76a90c['deployment_status__v'],'stepName':_0x76a90c[_0x5b1b0f(0xfb)],'component':_0x55f08e}));return[..._0x215ef4,..._0x383554];},[]);}async[a403_0x262a54(0xfe)](_0x4cb69a){const _0x54ebcd=a403_0x262a54,{data:_0x27da38}=await this[_0x54ebcd(0x123)][_0x54ebcd(0xf9)](veeva_constants_1[_0x54ebcd(0x10b)]['ENDPOINT_VALIDATE_PACKAGE'][_0x54ebcd(0xd2)]('{package_id}',_0x4cb69a[_0x54ebcd(0x10a)]));if(_0x27da38['responseStatus']===status_enums_1['VeevaResponseStatus']['SUCCESS']){const {package_steps:_0x4b7240}=_0x27da38[_0x54ebcd(0xdc)],_0x313b06=array_utils_1[_0x54ebcd(0xdf)][_0x54ebcd(0x111)](_0x4cb69a[_0x54ebcd(0x124)],({stepName:_0x3ab934})=>_0x3ab934);for(const {name__v:_0x13a1e7,deployment_action:_0x432684}of _0x4b7240){for(const _0x5a607c of _0x313b06[_0x54ebcd(0xe0)](_0x13a1e7)||[]){_0x5a607c['deploymentAction']=package_component_dto_1['PackageComponentDto'][_0x54ebcd(0xfc)](_0x432684);}}}else throw new veeva_error_1[(_0x54ebcd(0xf4))](_0x27da38['errors']);}async[a403_0x262a54(0x101)](_0x38bf5){const _0x2da221=a403_0x262a54,_0x1a3563=await this[_0x2da221(0x121)](_0x38bf5),_0x4039fa=await this[_0x2da221(0xfd)](_0x1a3563),_0x54ac1e=await this[_0x2da221(0x11d)](_0x4039fa),_0x3d874e=await this[_0x2da221(0xe6)](_0x54ac1e[_0x2da221(0x10a)]),_0x3ab5b8=await this[_0x2da221(0xfd)](_0x3d874e);return this[_0x2da221(0xde)](_0x3ab5b8,_0x54ac1e);}}function a403_0x4c3f(){const _0x3806e0=['Deployment.log','updateVeevaConnection','groupToMap','form-data','Wait\x20Executing\x20job','search','SUCCESS','rel','350823KKNkmk','errors','3016TTtytM','PackageComponentStatus','responseStatus','_veevaService','getValidationDetailsAndSaveLog','Cannot\x20find\x20deployment\x20results','../enums/status.enums','ENDPOINT_DEPLOY_PACKAGE','importVpk','Deploy\x20package','_connection','packageComponentList','414546qYljMa','../dtos/package-details.dto','filter','groupUniqueToMap','Deploy\x20Log','../classes/errors/veeva-error','replace','url','(((.+)+)+)+$','../dtos/package-component.dto','../constants/veeva.constants','filename','createReadStream','uniqueName','getJobResult','Package\x20not\x20verified','responseDetails','__esModule','getDeployDetailsAndSaveLog','ArrayUtils','get','DEPLOYED_WITH_WARNINGS','vaultPackage','links','log','text','deployPackage','endsWith','DEPLOYED','Import\x20package','__importDefault','2907788xCTAyJ','_logger','VERIFIED','length','defineProperty','Validation\x20Log','6yDFOzp','default','_saveLog','VeevaError','VeevaPackageStatus','includes','getLogResultText','status','post','multipart/form-data','name__v','convertDeploymentAction','getJobDetailUrl','fillPackageDeploymentAction','195588JKjQPz','toString','import','PackageImportService','890MmrJED','8356474srZVES','VeevaResponseStatus','PackageDetailsDto','append','15HifdBP','3842980cqEqfb','packageId','VeevaConstants','put','formPackageComponentList','27207cVjKQR'];a403_0x4c3f=function(){return _0x3806e0;};return a403_0x4c3f();}exports['PackageImportService']=PackageImportService;