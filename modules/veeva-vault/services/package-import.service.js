const a404_0x593553=a404_0x3770;function a404_0x3770(_0x187dae,_0x53c0c7){const _0x39cd5e=a404_0x3522();return a404_0x3770=function(_0x2ba300,_0x38b99b){_0x2ba300=_0x2ba300-0x1d9;let _0x35222b=_0x39cd5e[_0x2ba300];return _0x35222b;},a404_0x3770(_0x187dae,_0x53c0c7);}(function(_0xadbad3,_0x41ab6c){const _0x28330f=a404_0x3770,_0x1b9e2d=_0xadbad3();while(!![]){try{const _0x34b96b=-parseInt(_0x28330f(0x238))/0x1*(parseInt(_0x28330f(0x22e))/0x2)+-parseInt(_0x28330f(0x1db))/0x3*(parseInt(_0x28330f(0x1eb))/0x4)+parseInt(_0x28330f(0x23d))/0x5+parseInt(_0x28330f(0x200))/0x6+parseInt(_0x28330f(0x1ed))/0x7*(-parseInt(_0x28330f(0x202))/0x8)+parseInt(_0x28330f(0x1fd))/0x9*(-parseInt(_0x28330f(0x201))/0xa)+parseInt(_0x28330f(0x1de))/0xb*(parseInt(_0x28330f(0x226))/0xc);if(_0x34b96b===_0x41ab6c)break;else _0x1b9e2d['push'](_0x1b9e2d['shift']());}catch(_0x589fc3){_0x1b9e2d['push'](_0x1b9e2d['shift']());}}}(a404_0x3522,0x8ce0b));const a404_0x38b99b=(function(){let _0x2b53a7=!![];return function(_0x5f3987,_0x4a6a76){const _0x4edf81=_0x2b53a7?function(){const _0x8039a2=a404_0x3770;if(_0x4a6a76){const _0x41d490=_0x4a6a76[_0x8039a2(0x1dc)](_0x5f3987,arguments);return _0x4a6a76=null,_0x41d490;}}:function(){};return _0x2b53a7=![],_0x4edf81;};}()),a404_0x2ba300=a404_0x38b99b(this,function(){const _0x403beb=a404_0x3770;return a404_0x2ba300[_0x403beb(0x235)]()[_0x403beb(0x227)](_0x403beb(0x1e2))[_0x403beb(0x235)]()['constructor'](a404_0x2ba300)[_0x403beb(0x227)]('(((.+)+)+)+$');});a404_0x2ba300();function a404_0x3522(){const _0x2f3bd3=['isDeployed','../enums/status.enums','text','../dtos/package-component.dto','href','Package\x20not\x20verified','name__v','SUCCESS','responseDetails','updateVeevaConnection','default','artifacts','VERIFIED','filename','{package_id}','Validation\x20Log','responseStatus','formPackageComponentList','uniqueName','groupUniqueToMap','VeevaError','url','errors','form-data','status','fillPackageDeploymentAction','importVpk','data','Deploy\x20Log','_logger','get','createReadStream','PackageImportService','_veevaService','132SiLKdU','search','deployPackage','endsWith','post','ENDPOINT_EXPORT_IMPORT_PACKAGE','_connection','VeevaConstants','6YHjUqR','VeevaPackageStatus','../dtos/package-details.dto','PackageDetailsDto','getDeployDetailsAndSaveLog','ENDPOINT_VALIDATE_PACKAGE','_saveLog','toString','packageComponentList','Import\x20package','108671aNVtLF','log','deploymentAction','ArrayUtils','Validation.log','5542785gXzxEt','map','includes','27dXWpxz','apply','convertDeploymentAction','1013683XEObRr','put','getValidationDetailsAndSaveLog','PackageComponentDto','(((.+)+)+)+$','DEPLOYED_WITH_WARNINGS','ENDPOINT_DEPLOY_PACKAGE','Cannot\x20find\x20deployment\x20results','defineProperty','DEPLOYED','groupToMap','Wait\x20Executing\x20job','packageId','429964XxTpmB','../utils/veeva-auth.utils','18018BGYNev','replace','links','getLogResultText','vaultPackage','file','reduce','getJobResult','__esModule','../utils/array.utils','getJobDetailUrl','Deployment.log','import','../classes/errors/veeva-error','rel','package_components','1476EbiyZN','VeevaResponseStatus','multipart/form-data','4118562kCmdmr','29270XyXZhZ','1424wDETGG','filter'];a404_0x3522=function(){return _0x2f3bd3;};return a404_0x3522();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x7ef3e4){return _0x7ef3e4&&_0x7ef3e4['__esModule']?_0x7ef3e4:{'default':_0x7ef3e4};};Object[a404_0x593553(0x1e6)](exports,a404_0x593553(0x1f5),{'value':!![]}),exports[a404_0x593553(0x224)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),status_enums_1=require(a404_0x593553(0x205)),veeva_error_1=require(a404_0x593553(0x1fa)),form_data_1=__importDefault(require(a404_0x593553(0x21b))),fs_1=require('fs'),veeva_auth_utils_1=require(a404_0x593553(0x1ec)),package_details_dto_1=require(a404_0x593553(0x230)),package_component_dto_1=require(a404_0x593553(0x207)),array_utils_1=require(a404_0x593553(0x1f6));class PackageImportService{constructor({veevaService:_0x1a2912,connection:_0x5a378b,logger:_0x6828e6,saveLog:_0x5b6105}){const _0x48ce09=a404_0x593553;this[_0x48ce09(0x225)]=_0x1a2912,this['_connection']=_0x5a378b,this[_0x48ce09(0x221)]=_0x6828e6,this['_saveLog']=_0x5b6105;}async[a404_0x593553(0x21e)](_0x2f92d9,_0x2e7dbc=0x1){const _0x4b65b1=a404_0x593553;this['_logger'][_0x4b65b1(0x239)](_0x4b65b1(0x237));const _0x3ff48b=new form_data_1[(_0x4b65b1(0x20e))]();_0x3ff48b['append'](_0x4b65b1(0x1f2),(0x0,fs_1[_0x4b65b1(0x223)])(_0x2f92d9));const _0x201d92=await this[_0x4b65b1(0x22c)][_0x4b65b1(0x1df)](veeva_constants_1[_0x4b65b1(0x22d)][_0x4b65b1(0x22b)],_0x3ff48b,{'headers':{'Content-Type':_0x4b65b1(0x1ff)}}),_0x3097da=_0x201d92[_0x4b65b1(0x21f)];if(_0x3097da[_0x4b65b1(0x214)]===status_enums_1[_0x4b65b1(0x1fe)]['SUCCESS'])return _0x3097da['url'];else{if(_0x2e7dbc>0x0)return await(0x0,veeva_auth_utils_1[_0x4b65b1(0x20d)])(this[_0x4b65b1(0x22c)]),await this[_0x4b65b1(0x21e)](_0x2f92d9,_0x2e7dbc-0x1);throw new veeva_error_1[(_0x4b65b1(0x218))](_0x3097da[_0x4b65b1(0x21a)]);}}async[a404_0x593553(0x228)](_0x350180){const _0x313be=a404_0x593553;this['_logger'][_0x313be(0x239)]('Deploy\x20package');const _0xfab736=await this['_connection'][_0x313be(0x22a)](veeva_constants_1[_0x313be(0x22d)][_0x313be(0x1e4)]['replace'](_0x313be(0x212),_0x350180)),_0x309ea9=await _0xfab736['data'];if(_0x309ea9['responseStatus']===status_enums_1[_0x313be(0x1fe)][_0x313be(0x20b)])return _0x309ea9['url'];else throw new veeva_error_1[(_0x313be(0x218))](_0x309ea9[_0x313be(0x21a)]);}async[a404_0x593553(0x1f7)](_0x40b4d9){const _0x27f4bb=a404_0x593553;this[_0x27f4bb(0x221)][_0x27f4bb(0x239)](_0x27f4bb(0x1e9));const [_0x53dae9]=await this['_veevaService'][_0x27f4bb(0x1f4)]([_0x40b4d9]);return _0x53dae9[_0x27f4bb(0x1ef)]['find'](_0xbfec94=>_0xbfec94[_0x27f4bb(0x1fb)]===_0x27f4bb(0x20f))[_0x27f4bb(0x208)];}async[a404_0x593553(0x1e0)](_0x240da4){const _0x4803ae=a404_0x593553;this[_0x4803ae(0x221)]['log']('Get\x20validation\x20details.');const {data:_0x48687b}=await this[_0x4803ae(0x22c)][_0x4803ae(0x222)](_0x240da4);if(_0x48687b[_0x4803ae(0x214)]===status_enums_1['VeevaResponseStatus'][_0x4803ae(0x20b)]){const _0x28121a=new package_details_dto_1[(_0x4803ae(0x231))](),{log:_0x273979,id:_0x50d8ae,package_status:_0x463f2d,package_steps:_0xb5076f}=_0x48687b[_0x4803ae(0x1f1)],_0x39a8e1=_0x273979[_0x4803ae(0x203)](_0x42fc61=>_0x42fc61[_0x4803ae(0x211)][_0x4803ae(0x229)](_0x4803ae(0x23c))),_0x350b90=await this['getLogResultText'](_0x39a8e1[0x0][_0x4803ae(0x219)]);await this[_0x4803ae(0x234)](_0x350b90,_0x4803ae(0x213)),_0x28121a[_0x4803ae(0x1ea)]=_0x50d8ae,_0x28121a[_0x4803ae(0x236)]=this[_0x4803ae(0x215)](_0xb5076f),await this[_0x4803ae(0x21d)](_0x28121a);if(_0x463f2d!==status_enums_1[_0x4803ae(0x22f)][_0x4803ae(0x210)])throw new Error(_0x4803ae(0x209));return _0x28121a;}else throw new veeva_error_1['VeevaError'](_0x48687b[_0x4803ae(0x21a)]);}async[a404_0x593553(0x232)](_0x231706,_0x4ac5cb){const _0x593302=a404_0x593553;var _0x27892c;this[_0x593302(0x221)][_0x593302(0x239)]('Get\x20deploy\x20result');const {data:_0x2bbda5}=await this[_0x593302(0x22c)][_0x593302(0x222)](_0x231706);if(_0x2bbda5[_0x593302(0x214)]===status_enums_1[_0x593302(0x1fe)]['SUCCESS']){const {responseDetails:{deployment_log:_0x5e74bd,package_status__v:_0x265856},package_steps:_0x32b3b8}=_0x2bbda5,_0x287f4d=_0x5e74bd[_0x593302(0x203)](_0xbf1219=>_0xbf1219['filename'][_0x593302(0x229)](_0x593302(0x1f8))),_0x1767c4=await this[_0x593302(0x1f0)](_0x287f4d[0x0][_0x593302(0x219)]);await this[_0x593302(0x234)](_0x1767c4,_0x593302(0x220)),_0x4ac5cb[_0x593302(0x204)]=[status_enums_1[_0x593302(0x22f)][_0x593302(0x1e7)],status_enums_1[_0x593302(0x22f)][_0x593302(0x1e3)]][_0x593302(0x1da)](_0x265856);const _0x2fdf70=array_utils_1[_0x593302(0x23b)][_0x593302(0x217)](this[_0x593302(0x215)](_0x32b3b8),({uniqueName:_0x274f26})=>_0x274f26);for(const _0x1922d5 of _0x4ac5cb[_0x593302(0x236)]){const _0x2b5eed=(_0x27892c=_0x2fdf70[_0x593302(0x222)](_0x1922d5[_0x593302(0x216)]))===null||_0x27892c===void 0x0?void 0x0:_0x27892c[_0x593302(0x21c)];_0x2b5eed&&(_0x1922d5[_0x593302(0x21c)]=_0x2b5eed);}_0x4ac5cb[_0x593302(0x236)]=_0x4ac5cb[_0x593302(0x236)][_0x593302(0x203)](_0x89d24f=>_0x89d24f[_0x593302(0x21c)]!==status_enums_1['PackageComponentStatus'][_0x593302(0x210)]);if(!_0x4ac5cb['packageComponentList']['length'])throw new Error(_0x593302(0x1e5));return _0x4ac5cb;}else throw new veeva_error_1[(_0x593302(0x218))](_0x2bbda5[_0x593302(0x21a)]);}async[a404_0x593553(0x1f0)](_0x9a831d){const _0x38079f=a404_0x593553,{data:_0x98dbd2}=await this[_0x38079f(0x22c)]['get'](_0x9a831d,{'responseType':_0x38079f(0x206)});return _0x98dbd2;}['formPackageComponentList'](_0x342586){const _0x20d5c7=a404_0x593553;return _0x342586[_0x20d5c7(0x1f3)]((_0x43ae50,_0x3a89ec)=>{const _0x311674=_0x20d5c7,_0x25c20a=_0x3a89ec[_0x311674(0x1fc)][_0x311674(0x1d9)](_0x2edb49=>new package_component_dto_1['PackageComponentDto']({'status':_0x3a89ec['deployment_status__v'],'stepName':_0x3a89ec[_0x311674(0x20a)],'component':_0x2edb49}));return[..._0x43ae50,..._0x25c20a];},[]);}async[a404_0x593553(0x21d)](_0x18a2ce){const _0x3d4c07=a404_0x593553,{data:_0x434cc2}=await this[_0x3d4c07(0x22c)][_0x3d4c07(0x22a)](veeva_constants_1[_0x3d4c07(0x22d)][_0x3d4c07(0x233)][_0x3d4c07(0x1ee)](_0x3d4c07(0x212),_0x18a2ce[_0x3d4c07(0x1ea)]));if(_0x434cc2[_0x3d4c07(0x214)]===status_enums_1[_0x3d4c07(0x1fe)][_0x3d4c07(0x20b)]){const {package_steps:_0x336229}=_0x434cc2[_0x3d4c07(0x20c)],_0x3f9780=array_utils_1[_0x3d4c07(0x23b)][_0x3d4c07(0x1e8)](_0x18a2ce[_0x3d4c07(0x236)],({stepName:_0x48c6f2})=>_0x48c6f2);for(const {name__v:_0x4eec36,deployment_action:_0x359184}of _0x336229){for(const _0x247241 of _0x3f9780[_0x3d4c07(0x222)](_0x4eec36)||[]){_0x247241[_0x3d4c07(0x23a)]=package_component_dto_1[_0x3d4c07(0x1e1)][_0x3d4c07(0x1dd)](_0x359184);}}}else throw new veeva_error_1[(_0x3d4c07(0x218))](_0x434cc2[_0x3d4c07(0x21a)]);}async[a404_0x593553(0x1f9)](_0x30c67b){const _0x2d8b09=a404_0x593553,_0x2c5fa8=await this[_0x2d8b09(0x21e)](_0x30c67b),_0x400ef8=await this[_0x2d8b09(0x1f7)](_0x2c5fa8),_0xfa3b4e=await this[_0x2d8b09(0x1e0)](_0x400ef8),_0x4a7a9d=await this[_0x2d8b09(0x228)](_0xfa3b4e['packageId']),_0x1435c3=await this[_0x2d8b09(0x1f7)](_0x4a7a9d);return this[_0x2d8b09(0x232)](_0x1435c3,_0xfa3b4e);}}exports['PackageImportService']=PackageImportService;