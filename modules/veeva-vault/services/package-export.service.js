const a375_0x42f45c=a375_0x1114;(function(_0x47e80d,_0x295b46){const _0x3372b3=a375_0x1114,_0x30c57f=_0x47e80d();while(!![]){try{const _0x1e3087=-parseInt(_0x3372b3(0x1f7))/0x1+-parseInt(_0x3372b3(0x1ec))/0x2+-parseInt(_0x3372b3(0x1f3))/0x3+parseInt(_0x3372b3(0x21a))/0x4*(-parseInt(_0x3372b3(0x22e))/0x5)+-parseInt(_0x3372b3(0x1ea))/0x6+-parseInt(_0x3372b3(0x1fd))/0x7+parseInt(_0x3372b3(0x1f4))/0x8;if(_0x1e3087===_0x295b46)break;else _0x30c57f['push'](_0x30c57f['shift']());}catch(_0x5c6ea0){_0x30c57f['push'](_0x30c57f['shift']());}}}(a375_0x4f34,0xf2f4d));const a375_0x4b2617=(function(){let _0x47e49f=!![];return function(_0x5da94d,_0x2208ae){const _0x4044d7=_0x47e49f?function(){const _0xa0bbd6=a375_0x1114;if(_0x2208ae){const _0x773369=_0x2208ae[_0xa0bbd6(0x21c)](_0x5da94d,arguments);return _0x2208ae=null,_0x773369;}}:function(){};return _0x47e49f=![],_0x4044d7;};}()),a375_0x3400d7=a375_0x4b2617(this,function(){const _0x4f536d=a375_0x1114;return a375_0x3400d7[_0x4f536d(0x226)]()['search'](_0x4f536d(0x22d))[_0x4f536d(0x226)]()[_0x4f536d(0x1eb)](a375_0x3400d7)['search'](_0x4f536d(0x22d));});a375_0x3400d7();function a375_0x4f34(){const _0x5e216d=['(((.+)+)+)+$','60575AjsyyQ','../enums/status.enums','length','4697400SNcOXc','constructor','935190DoLYWP','Getting\x20names\x20of\x20outbound\x20packages','_connection','ENDPOINT_CREATE_RECORDS','_veevaService','map','getEndpointArtifactList','3682368JUjzgS','39728712wbwTGA','fill','Removing\x20components\x20from\x20outbound\x20packages.','239765afXuTw','set','export','name__v','../classes/errors/veeva-error','createOutboundPackages','7754908FLHYea','ceil','VeevaError','push','createVeevaObjectRecords','outbound_package__v','join','Creating\x20outbound\x20packages','retrieveVPKList','getPackageNames','content-type','createPackageComponents','artifacts','reduce','jszip','application/x-www-form-urlencoded','package_component__v','VeevaConstants','links','application/json','__importDefault','deleteOutboundPackages','VeevaResponseStatus','\x27,\x27','Deleting\x20outbound\x20packages.','getJobResult','filter','defineProperty','PackageExportService','48QPxIxh','Retrieve\x20Jobs\x20Status','apply','Create\x20Export\x20outbound\x20packages.','includes','_logger','log','executeVQL','responseStatus','all','__esModule','createExportOutboundPackages','toString','../constants/veeva.constants','get','ENDPOINT_EXPORT_IMPORT_PACKAGE','default','errors','post'];a375_0x4f34=function(){return _0x5e216d;};return a375_0x4f34();}'use strict';var __importDefault=this&&this[a375_0x42f45c(0x211)]||function(_0x3cc549){const _0xf5d88b=a375_0x42f45c;return _0x3cc549&&_0x3cc549[_0xf5d88b(0x224)]?_0x3cc549:{'default':_0x3cc549};};Object[a375_0x42f45c(0x218)](exports,a375_0x42f45c(0x224),{'value':!![]}),exports[a375_0x42f45c(0x219)]=void 0x0;const veeva_constants_1=require(a375_0x42f45c(0x227)),jszip_1=__importDefault(require(a375_0x42f45c(0x20b))),status_enums_1=require(a375_0x42f45c(0x22f)),veeva_error_1=require(a375_0x42f45c(0x1fb));function a375_0x1114(_0x2ec801,_0x439848){const _0x3ac2fb=a375_0x4f34();return a375_0x1114=function(_0x3400d7,_0x4b2617){_0x3400d7=_0x3400d7-0x1e9;let _0x4f3447=_0x3ac2fb[_0x3400d7];return _0x4f3447;},a375_0x1114(_0x2ec801,_0x439848);}class PackageExportService{constructor({veevaService:_0x406fac,connection:_0xaf600e,logger:_0x4ea9b1}){const _0x3b24cc=a375_0x42f45c;this[_0x3b24cc(0x1f0)]=_0x406fac,this[_0x3b24cc(0x1ee)]=_0xaf600e,this['_logger']=_0x4ea9b1;}async[a375_0x42f45c(0x1fc)](_0x42248a,_0x2d8f82){const _0x13bb2c=a375_0x42f45c;this[_0x13bb2c(0x21f)][_0x13bb2c(0x220)](_0x13bb2c(0x204));const _0x1e2ad2=veeva_constants_1[_0x13bb2c(0x20e)]['ENDPOINT_CREATE_RECORDS']+_0x13bb2c(0x202),_0x3aec30=new Array(_0x42248a)[_0x13bb2c(0x1f5)]({'summary__v':_0x2d8f82,'object_type__v.api__name__v':'migration__sys'});return await this['_veevaService'][_0x13bb2c(0x201)](_0x1e2ad2,_0x3aec30);}async[a375_0x42f45c(0x208)](_0x172bd4,_0x1991ed){const _0x1e84a2=a375_0x42f45c;this[_0x1e84a2(0x21f)]['log']('Adding\x20components\x20to\x20outbound\x20package');const _0x45a317=veeva_constants_1[_0x1e84a2(0x20e)][_0x1e84a2(0x1ef)]+_0x1e84a2(0x20d),_0x35e22e=_0x172bd4[_0x1e84a2(0x1f1)]((_0x37f1f9,_0x2521c6)=>({'vault_component__v':_0x37f1f9['id'],'outbound_package__v':_0x1991ed[Math[_0x1e84a2(0x1fe)]((_0x2521c6+0x1)/veeva_constants_1[_0x1e84a2(0x20e)]['MAXIMUM_SIZE_OF_PACKAGE'])-0x1]}));return await this[_0x1e84a2(0x1f0)][_0x1e84a2(0x201)](_0x45a317,_0x35e22e);}async[a375_0x42f45c(0x206)](_0x2102c7){const _0x3805f9=a375_0x42f45c;this[_0x3805f9(0x21f)][_0x3805f9(0x220)](_0x3805f9(0x1ed));const _0x4550d8='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x2102c7[_0x3805f9(0x203)](_0x3805f9(0x214))+'\x27)',_0x1cc1b6=await this[_0x3805f9(0x1f0)][_0x3805f9(0x221)](_0x4550d8);return _0x1cc1b6[_0x3805f9(0x20a)]((_0x3d4770,_0x1debaa)=>_0x3d4770[_0x3805f9(0x1f8)](_0x1debaa['id'],_0x1debaa[_0x3805f9(0x1fa)]),new Map());}async[a375_0x42f45c(0x225)](_0x37807f){const _0x1ea4d3=a375_0x42f45c;this[_0x1ea4d3(0x21f)]['log'](_0x1ea4d3(0x21d));const _0x1d3e40=[],_0x14ee34=_0x37807f['map'](_0x40ccfa=>{const _0x56e864=_0x1ea4d3;return this[_0x56e864(0x1ee)][_0x56e864(0x22c)](veeva_constants_1[_0x56e864(0x20e)][_0x56e864(0x229)],encodeURI('packageName')+'='+encodeURI(_0x40ccfa),{'headers':{'Content-Type':_0x56e864(0x20c)}});}),_0x434eb7=await Promise[_0x1ea4d3(0x223)](_0x14ee34);for(const {data:_0x3236ee}of _0x434eb7){if(_0x3236ee[_0x1ea4d3(0x222)]===status_enums_1[_0x1ea4d3(0x213)]['SUCCESS']){const {url:_0x1cb0d1}=_0x3236ee;_0x1d3e40[_0x1ea4d3(0x200)](_0x1cb0d1);}else throw new veeva_error_1[(_0x1ea4d3(0x1ff))](_0x3236ee['errors']);}return _0x1d3e40;}async[a375_0x42f45c(0x1f2)](_0x24e18f){const _0x50ca7f=a375_0x42f45c;this[_0x50ca7f(0x21f)][_0x50ca7f(0x220)](_0x50ca7f(0x21b));const _0x45098f=[],_0x13d699=await this['_veevaService'][_0x50ca7f(0x216)](_0x24e18f);for(const _0x1e233a of _0x13d699){const _0x117a8a=_0x1e233a[_0x50ca7f(0x20f)][_0x50ca7f(0x217)](_0x149b3d=>_0x149b3d['rel']===_0x50ca7f(0x209))[_0x50ca7f(0x1f1)](_0x250c82=>_0x250c82['href']);_0x45098f[_0x50ca7f(0x200)](..._0x117a8a);}return _0x45098f;}async['retrieveVPKList'](_0x2e5c6a){const _0xe821d6=a375_0x42f45c;var _0x3302b8;const _0x27cbe4=[];this[_0xe821d6(0x21f)][_0xe821d6(0x220)]('Retrieve\x20Outbound\x20Package\x20zip\x20list');for(const _0x4e4dcb of _0x2e5c6a){const {data:_0x44f5aa,headers:_0x4d9590}=await this[_0xe821d6(0x1ee)][_0xe821d6(0x228)](_0x4e4dcb,{'responseType':'arraybuffer'}),_0x5120fe=(_0x3302b8=_0x4d9590[_0xe821d6(0x207)])===null||_0x3302b8===void 0x0?void 0x0:_0x3302b8[_0xe821d6(0x21e)](_0xe821d6(0x210));if(!_0x5120fe){const _0x4895ec=_0x44f5aa,_0x1c20f8=new jszip_1[(_0xe821d6(0x22a))]();await _0x1c20f8['loadAsync'](_0x4895ec),_0x27cbe4[_0xe821d6(0x200)](_0x1c20f8);}else{const _0x1ebe83=JSON['parse'](_0x44f5aa);throw new veeva_error_1[(_0xe821d6(0x1ff))](_0x1ebe83[_0xe821d6(0x22b)]);}}return _0x27cbe4;}async['deletePackageComponents'](_0x3726db){const _0x278fcd=a375_0x42f45c;this[_0x278fcd(0x21f)]['log'](_0x278fcd(0x1f6));const _0x5e35e4=veeva_constants_1['VeevaConstants'][_0x278fcd(0x1ef)]+_0x278fcd(0x20d);await this[_0x278fcd(0x1f0)]['deleteVeevaObjectRecords'](_0x5e35e4,_0x3726db);}async[a375_0x42f45c(0x212)](_0x396c5a){const _0x5218cb=a375_0x42f45c;this[_0x5218cb(0x21f)]['log'](_0x5218cb(0x215));const _0x2883af=veeva_constants_1['VeevaConstants'][_0x5218cb(0x1ef)]+'outbound_package__v';await this['_veevaService']['deleteVeevaObjectRecords'](_0x2883af,_0x396c5a);}async[a375_0x42f45c(0x1f9)](_0x5df52f,_0x5d54fd){const _0x5215aa=a375_0x42f45c,_0x1cd555=await this[_0x5215aa(0x1fc)](Math[_0x5215aa(0x1fe)](_0x5df52f[_0x5215aa(0x1e9)]/veeva_constants_1['VeevaConstants']['MAXIMUM_SIZE_OF_PACKAGE']),_0x5d54fd),_0x2183d0=await this['createPackageComponents'](_0x5df52f,_0x1cd555),_0x29aa0f=await this[_0x5215aa(0x206)](_0x1cd555),_0x2fce1e=await this['createExportOutboundPackages'](Array['from'](_0x29aa0f['values']())),_0xe0537d=await this['getEndpointArtifactList'](_0x2fce1e),_0x24aba0=await this[_0x5215aa(0x205)](_0xe0537d);return await this['deletePackageComponents'](_0x2183d0),await this[_0x5215aa(0x212)](_0x1cd555),_0x24aba0;}}exports[a375_0x42f45c(0x219)]=PackageExportService;