const a375_0x438181=a375_0x14f9;(function(_0x361d00,_0x15ca99){const _0x1ff679=a375_0x14f9,_0x5be5a9=_0x361d00();while(!![]){try{const _0x49eb80=parseInt(_0x1ff679(0x11d))/0x1*(-parseInt(_0x1ff679(0x133))/0x2)+parseInt(_0x1ff679(0x11b))/0x3*(parseInt(_0x1ff679(0x112))/0x4)+parseInt(_0x1ff679(0x12b))/0x5*(-parseInt(_0x1ff679(0x156))/0x6)+parseInt(_0x1ff679(0x147))/0x7*(parseInt(_0x1ff679(0x151))/0x8)+parseInt(_0x1ff679(0x119))/0x9+-parseInt(_0x1ff679(0x11c))/0xa+-parseInt(_0x1ff679(0x148))/0xb;if(_0x49eb80===_0x15ca99)break;else _0x5be5a9['push'](_0x5be5a9['shift']());}catch(_0x210e13){_0x5be5a9['push'](_0x5be5a9['shift']());}}}(a375_0x3c28,0xd3955));const a375_0x5c31ea=(function(){let _0x2c5e81=!![];return function(_0x420415,_0x453e57){const _0x23ffdf=_0x2c5e81?function(){const _0x19e145=a375_0x14f9;if(_0x453e57){const _0x2165ac=_0x453e57[_0x19e145(0x123)](_0x420415,arguments);return _0x453e57=null,_0x2165ac;}}:function(){};return _0x2c5e81=![],_0x23ffdf;};}()),a375_0x4d952a=a375_0x5c31ea(this,function(){const _0x546ec1=a375_0x14f9;return a375_0x4d952a[_0x546ec1(0x130)]()[_0x546ec1(0x116)](_0x546ec1(0x157))[_0x546ec1(0x130)]()[_0x546ec1(0x13d)](a375_0x4d952a)[_0x546ec1(0x116)]('(((.+)+)+)+$');});a375_0x4d952a();function a375_0x14f9(_0x157b85,_0x5f52b8){const _0x3c77b3=a375_0x3c28();return a375_0x14f9=function(_0x4d952a,_0x5c31ea){_0x4d952a=_0x4d952a-0x10d;let _0x3c285f=_0x3c77b3[_0x4d952a];return _0x3c285f;},a375_0x14f9(_0x157b85,_0x5f52b8);}'use strict';var __importDefault=this&&this[a375_0x438181(0x14b)]||function(_0x40d9b8){const _0x13706f=a375_0x438181;return _0x40d9b8&&_0x40d9b8[_0x13706f(0x127)]?_0x40d9b8:{'default':_0x40d9b8};};function a375_0x3c28(){const _0x2a64c3=['../constants/veeva.constants','name__v','6472JNwgNk','Adding\x20components\x20to\x20outbound\x20package','outbound_package__v','ceil','content-type','107742BcvuwG','(((.+)+)+)+$','values','getEndpointArtifactList','createPackageComponents','PackageExportService','_veevaService','SUCCESS','MAXIMUM_SIZE_OF_PACKAGE','push','_connection','3057304RZlUTB','responseStatus','filter','reduce','search','Creating\x20outbound\x20packages','VeevaResponseStatus','12499992MAAfqB','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','3LYNOAu','7431080WJpVKn','95401yLHAoD','deletePackageComponents','_logger','getPackageNames','getJobResult','set','apply','includes','Removing\x20components\x20from\x20outbound\x20packages.','artifacts','__esModule','links','ENDPOINT_EXPORT_IMPORT_PACKAGE','href','145mVjqxs','application/x-www-form-urlencoded','join','parse','deleteOutboundPackages','toString','migration__sys','get','2MRrXPH','VeevaError','default','createExportOutboundPackages','post','package_component__v','Retrieve\x20Outbound\x20Package\x20zip\x20list','ENDPOINT_CREATE_RECORDS','executeVQL','packageName','constructor','map','length','errors','VeevaConstants','../enums/status.enums','export','Getting\x20names\x20of\x20outbound\x20packages','from','rel','5495vaLMwk','6186092ZUvJvc','retrieveVPKList','Retrieve\x20Jobs\x20Status','__importDefault','createOutboundPackages','log','createVeevaObjectRecords'];a375_0x3c28=function(){return _0x2a64c3;};return a375_0x3c28();}Object['defineProperty'](exports,a375_0x438181(0x127),{'value':!![]}),exports[a375_0x438181(0x15b)]=void 0x0;const veeva_constants_1=require(a375_0x438181(0x14f)),jszip_1=__importDefault(require('jszip')),status_enums_1=require(a375_0x438181(0x142)),veeva_error_1=require('../classes/errors/veeva-error');class PackageExportService{constructor({veevaService:_0x22a624,connection:_0x412a67,logger:_0x55745e}){const _0x34f1c2=a375_0x438181;this[_0x34f1c2(0x10d)]=_0x22a624,this[_0x34f1c2(0x111)]=_0x412a67,this[_0x34f1c2(0x11f)]=_0x55745e;}async['createOutboundPackages'](_0x5ed93e,_0x40fcb0){const _0x151c97=a375_0x438181;this['_logger'][_0x151c97(0x14d)](_0x151c97(0x117));const _0x1771e1=veeva_constants_1[_0x151c97(0x141)][_0x151c97(0x13a)]+_0x151c97(0x153),_0x40b0bb=new Array(_0x5ed93e)['fill']({'summary__v':_0x40fcb0,'object_type__v.api__name__v':_0x151c97(0x131)});return await this[_0x151c97(0x10d)]['createVeevaObjectRecords'](_0x1771e1,_0x40b0bb);}async[a375_0x438181(0x15a)](_0x2cc653,_0xa13fe0){const _0x174f84=a375_0x438181;this['_logger'][_0x174f84(0x14d)](_0x174f84(0x152));const _0x2cbe31=veeva_constants_1[_0x174f84(0x141)][_0x174f84(0x13a)]+_0x174f84(0x138),_0x3e119b=_0x2cc653[_0x174f84(0x13e)]((_0xcc6dd0,_0x2210af)=>({'vault_component__v':_0xcc6dd0['id'],'outbound_package__v':_0xa13fe0[Math[_0x174f84(0x154)]((_0x2210af+0x1)/veeva_constants_1[_0x174f84(0x141)][_0x174f84(0x10f)])-0x1]}));return await this[_0x174f84(0x10d)][_0x174f84(0x14e)](_0x2cbe31,_0x3e119b);}async['getPackageNames'](_0x1494b7){const _0x2bdadb=a375_0x438181;this[_0x2bdadb(0x11f)][_0x2bdadb(0x14d)](_0x2bdadb(0x144));const _0x109d30=_0x2bdadb(0x11a)+_0x1494b7[_0x2bdadb(0x12d)]('\x27,\x27')+'\x27)',_0x25781e=await this[_0x2bdadb(0x10d)][_0x2bdadb(0x13b)](_0x109d30);return _0x25781e[_0x2bdadb(0x115)]((_0x3e6b84,_0xea20c7)=>_0x3e6b84[_0x2bdadb(0x122)](_0xea20c7['id'],_0xea20c7[_0x2bdadb(0x150)]),new Map());}async['createExportOutboundPackages'](_0x5c9b18){const _0x40d452=a375_0x438181;this['_logger'][_0x40d452(0x14d)]('Create\x20Export\x20outbound\x20packages.');const _0x794af2=[],_0x21e5f4=_0x5c9b18[_0x40d452(0x13e)](_0x3a603f=>{const _0xfe5c7e=_0x40d452;return this['_connection'][_0xfe5c7e(0x137)](veeva_constants_1[_0xfe5c7e(0x141)][_0xfe5c7e(0x129)],encodeURI(_0xfe5c7e(0x13c))+'='+encodeURI(_0x3a603f),{'headers':{'Content-Type':_0xfe5c7e(0x12c)}});}),_0x44d41f=await Promise['all'](_0x21e5f4);for(const {data:_0x19f1bc}of _0x44d41f){if(_0x19f1bc[_0x40d452(0x113)]===status_enums_1[_0x40d452(0x118)][_0x40d452(0x10e)]){const {url:_0xc2a963}=_0x19f1bc;_0x794af2[_0x40d452(0x110)](_0xc2a963);}else throw new veeva_error_1[(_0x40d452(0x134))](_0x19f1bc['errors']);}return _0x794af2;}async['getEndpointArtifactList'](_0x54f25a){const _0x47388d=a375_0x438181;this['_logger'][_0x47388d(0x14d)](_0x47388d(0x14a));const _0x552789=[],_0x3aaca9=await this['_veevaService'][_0x47388d(0x121)](_0x54f25a);for(const _0x29a460 of _0x3aaca9){const _0x2e4c43=_0x29a460[_0x47388d(0x128)][_0x47388d(0x114)](_0xec74dd=>_0xec74dd[_0x47388d(0x146)]===_0x47388d(0x126))[_0x47388d(0x13e)](_0x349cee=>_0x349cee[_0x47388d(0x12a)]);_0x552789[_0x47388d(0x110)](..._0x2e4c43);}return _0x552789;}async[a375_0x438181(0x149)](_0x5ad827){const _0x54ff07=a375_0x438181;var _0x1e78e8;const _0x383c6b=[];this['_logger'][_0x54ff07(0x14d)](_0x54ff07(0x139));for(const _0x4a74ed of _0x5ad827){const {data:_0x3fe104,headers:_0x33d291}=await this[_0x54ff07(0x111)][_0x54ff07(0x132)](_0x4a74ed,{'responseType':'arraybuffer'}),_0x13c62f=(_0x1e78e8=_0x33d291[_0x54ff07(0x155)])===null||_0x1e78e8===void 0x0?void 0x0:_0x1e78e8[_0x54ff07(0x124)]('application/json');if(!_0x13c62f){const _0x10c99d=_0x3fe104,_0x42555d=new jszip_1[(_0x54ff07(0x135))]();await _0x42555d['loadAsync'](_0x10c99d),_0x383c6b[_0x54ff07(0x110)](_0x42555d);}else{const _0x3e2ced=JSON[_0x54ff07(0x12e)](_0x3fe104);throw new veeva_error_1[(_0x54ff07(0x134))](_0x3e2ced[_0x54ff07(0x140)]);}}return _0x383c6b;}async[a375_0x438181(0x11e)](_0x2257bb){const _0x38e9f0=a375_0x438181;this[_0x38e9f0(0x11f)]['log'](_0x38e9f0(0x125));const _0x52ab05=veeva_constants_1['VeevaConstants'][_0x38e9f0(0x13a)]+'package_component__v';await this[_0x38e9f0(0x10d)]['deleteVeevaObjectRecords'](_0x52ab05,_0x2257bb);}async[a375_0x438181(0x12f)](_0x3cfcb4){const _0x6078e7=a375_0x438181;this[_0x6078e7(0x11f)]['log']('Deleting\x20outbound\x20packages.');const _0x161dd0=veeva_constants_1[_0x6078e7(0x141)][_0x6078e7(0x13a)]+_0x6078e7(0x153);await this[_0x6078e7(0x10d)]['deleteVeevaObjectRecords'](_0x161dd0,_0x3cfcb4);}async[a375_0x438181(0x143)](_0x1933d1,_0x154f21){const _0x166911=a375_0x438181,_0x385f53=await this[_0x166911(0x14c)](Math[_0x166911(0x154)](_0x1933d1[_0x166911(0x13f)]/veeva_constants_1[_0x166911(0x141)][_0x166911(0x10f)]),_0x154f21),_0x1f03ec=await this[_0x166911(0x15a)](_0x1933d1,_0x385f53),_0x4c90c2=await this[_0x166911(0x120)](_0x385f53),_0x3fb74c=await this[_0x166911(0x136)](Array[_0x166911(0x145)](_0x4c90c2[_0x166911(0x158)]())),_0x1ab339=await this[_0x166911(0x159)](_0x3fb74c),_0x30cef6=await this[_0x166911(0x149)](_0x1ab339);return await this[_0x166911(0x11e)](_0x1f03ec),await this[_0x166911(0x12f)](_0x385f53),_0x30cef6;}}exports[a375_0x438181(0x15b)]=PackageExportService;