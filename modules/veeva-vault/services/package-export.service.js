const a335_0x59594a=a335_0x34fe;function a335_0x479d(){const _0x34b906=['log','Creating\x20outbound\x20packages','push','MAXIMUM_SIZE_OF_PACKAGE','set','../constants/veeva.constants','getJobResult','_logger','package_component__v','all','50EGWZvs','ENDPOINT_VQL','getPackageNames','\x27,\x27','arraybuffer','VeevaResponseStatus','createVeevaObjectRecords','2002065dLdZiM','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','ENDPOINT_CREATE_RECORDS','406860UhrGKi','createPackageComponents','184GlKbdv','map','includes','export','deleteVeevaObjectRecords','(((.+)+)+)+$','55ZIDwCs','__esModule','248051sHrRdV','artifacts','from','501822rypNOF','retrieveVPKList','VeevaConstants','outbound_package__v','SUCCESS','_connection','get','toString','createOutboundPackages','application/json','content-type','migration__sys','deleteOutboundPackages','default','ENDPOINT_EXPORT_IMPORT_PACKAGE','search','Retrieve\x20Jobs\x20Status','Getting\x20names\x20of\x20outbound\x20packages','defineProperty','length','_veevaService','reduce','Deleting\x20outbound\x20packages.','3585444OjsPhc','Retrieve\x20Outbound\x20Package\x20zip\x20list','rel','2RtalNb','__importDefault','VeevaError','jszip','getEndpointArtifactList','ceil','executeVQL','4wuuFsC','3477698drwLbd','251595dVgHKU','links','values','createExportOutboundPackages','join','responseStatus','../enums/status.enums','fill'];a335_0x479d=function(){return _0x34b906;};return a335_0x479d();}(function(_0x18b7ae,_0x25c457){const _0x4449cd=a335_0x34fe,_0x5b61bb=_0x18b7ae();while(!![]){try{const _0x142211=parseInt(_0x4449cd(0x191))/0x1*(parseInt(_0x4449cd(0x162))/0x2)+-parseInt(_0x4449cd(0x184))/0x3*(parseInt(_0x4449cd(0x169))/0x4)+-parseInt(_0x4449cd(0x17d))/0x5*(parseInt(_0x4449cd(0x194))/0x6)+-parseInt(_0x4449cd(0x16a))/0x7+parseInt(_0x4449cd(0x189))/0x8*(parseInt(_0x4449cd(0x16b))/0x9)+parseInt(_0x4449cd(0x187))/0xa+parseInt(_0x4449cd(0x18f))/0xb*(parseInt(_0x4449cd(0x15f))/0xc);if(_0x142211===_0x25c457)break;else _0x5b61bb['push'](_0x5b61bb['shift']());}catch(_0x3026f3){_0x5b61bb['push'](_0x5b61bb['shift']());}}}(a335_0x479d,0x67c8a));const a335_0x57d67d=(function(){let _0x472353=!![];return function(_0x490f2b,_0x4b746a){const _0x53cda8=_0x472353?function(){if(_0x4b746a){const _0x243cef=_0x4b746a['apply'](_0x490f2b,arguments);return _0x4b746a=null,_0x243cef;}}:function(){};return _0x472353=![],_0x53cda8;};}()),a335_0x121491=a335_0x57d67d(this,function(){const _0x4f7ae5=a335_0x34fe;return a335_0x121491['toString']()[_0x4f7ae5(0x1a3)](_0x4f7ae5(0x18e))[_0x4f7ae5(0x19b)]()['constructor'](a335_0x121491)['search'](_0x4f7ae5(0x18e));});a335_0x121491();'use strict';var __importDefault=this&&this[a335_0x59594a(0x163)]||function(_0x5f521d){const _0x141639=a335_0x59594a;return _0x5f521d&&_0x5f521d[_0x141639(0x190)]?_0x5f521d:{'default':_0x5f521d};};Object[a335_0x59594a(0x1a6)](exports,a335_0x59594a(0x190),{'value':!![]}),exports['PackageExportService']=void 0x0;const veeva_constants_1=require(a335_0x59594a(0x178)),jszip_1=__importDefault(require(a335_0x59594a(0x165))),status_enums_1=require(a335_0x59594a(0x171)),veeva_error_1=require('../classes/errors/veeva-error');function a335_0x34fe(_0x16d406,_0x1bd0b7){const _0x16f0f1=a335_0x479d();return a335_0x34fe=function(_0x121491,_0x57d67d){_0x121491=_0x121491-0x15f;let _0x479d9e=_0x16f0f1[_0x121491];return _0x479d9e;},a335_0x34fe(_0x16d406,_0x1bd0b7);}class PackageExportService{constructor({veevaService:_0x1fb3d3,connection:_0x52c9ef,logger:_0x3a623c}){const _0x586dbe=a335_0x59594a;this['_veevaService']=_0x1fb3d3,this[_0x586dbe(0x199)]=_0x52c9ef,this[_0x586dbe(0x17a)]=_0x3a623c;}async[a335_0x59594a(0x19c)](_0x1dde87,_0x4ee7f0){const _0x68b39c=a335_0x59594a;this[_0x68b39c(0x17a)][_0x68b39c(0x173)](_0x68b39c(0x174));const _0x566cae=veeva_constants_1[_0x68b39c(0x196)][_0x68b39c(0x186)]+'outbound_package__v',_0x19c257=new Array(_0x1dde87)[_0x68b39c(0x172)]({'summary__v':_0x4ee7f0,'object_type__v.api__name__v':_0x68b39c(0x19f)});return await this['_veevaService'][_0x68b39c(0x183)](_0x566cae,_0x19c257);}async[a335_0x59594a(0x188)](_0x40cbe2,_0x544b95){const _0x34df7f=a335_0x59594a;this[_0x34df7f(0x17a)][_0x34df7f(0x173)]('Adding\x20components\x20to\x20outbound\x20package');const _0xcc9f1f=veeva_constants_1[_0x34df7f(0x196)][_0x34df7f(0x186)]+_0x34df7f(0x17b),_0x59d15d=_0x40cbe2[_0x34df7f(0x18a)]((_0x3a7e30,_0xda1ba8)=>({'vault_component__v':_0x3a7e30['id'],'outbound_package__v':_0x544b95[Math['ceil']((_0xda1ba8+0x1)/veeva_constants_1[_0x34df7f(0x196)][_0x34df7f(0x176)])-0x1]}));return await this[_0x34df7f(0x1a8)][_0x34df7f(0x183)](_0xcc9f1f,_0x59d15d);}async[a335_0x59594a(0x17f)](_0x11328b){const _0x3f8f00=a335_0x59594a;this[_0x3f8f00(0x17a)][_0x3f8f00(0x173)](_0x3f8f00(0x1a5));const _0x524bb9=_0x3f8f00(0x185)+_0x11328b[_0x3f8f00(0x16f)](_0x3f8f00(0x180))+'\x27)',_0x40b1ef=veeva_constants_1['VeevaConstants'][_0x3f8f00(0x17e)]+_0x524bb9,_0x828ae0=await this[_0x3f8f00(0x1a8)][_0x3f8f00(0x168)](_0x40b1ef);return _0x828ae0[_0x3f8f00(0x1a9)]((_0x41ad52,_0x38104b)=>_0x41ad52[_0x3f8f00(0x177)](_0x38104b['id'],_0x38104b['name__v']),new Map());}async[a335_0x59594a(0x16e)](_0x15409a){const _0x1b407d=a335_0x59594a;this[_0x1b407d(0x17a)]['log']('Create\x20Export\x20outbound\x20packages.');const _0x2ab2be=[],_0x48d454=_0x15409a[_0x1b407d(0x18a)](_0x2fa86b=>{const _0x39525a=_0x1b407d;return this[_0x39525a(0x199)]['post'](veeva_constants_1[_0x39525a(0x196)][_0x39525a(0x1a2)],encodeURI('packageName')+'='+encodeURI(_0x2fa86b),{'headers':{'Content-Type':'application/x-www-form-urlencoded'}});}),_0x1cd549=await Promise[_0x1b407d(0x17c)](_0x48d454);for(const {data:_0x21e188}of _0x1cd549){if(_0x21e188[_0x1b407d(0x170)]===status_enums_1[_0x1b407d(0x182)][_0x1b407d(0x198)]){const {url:_0x4fe4f2}=_0x21e188;_0x2ab2be[_0x1b407d(0x175)](_0x4fe4f2);}else throw new veeva_error_1[(_0x1b407d(0x164))](_0x21e188['errors']);}return _0x2ab2be;}async[a335_0x59594a(0x166)](_0x3c31ea){const _0x2c254c=a335_0x59594a;this[_0x2c254c(0x17a)]['log'](_0x2c254c(0x1a4));const _0x586eeb=[],_0x5c6e46=await this[_0x2c254c(0x1a8)][_0x2c254c(0x179)](_0x3c31ea);for(const _0x48d92c of _0x5c6e46){const _0x28f471=_0x48d92c[_0x2c254c(0x16c)]['filter'](_0x123524=>_0x123524[_0x2c254c(0x161)]===_0x2c254c(0x192))[_0x2c254c(0x18a)](_0x17b238=>_0x17b238['href']);_0x586eeb[_0x2c254c(0x175)](..._0x28f471);}return _0x586eeb;}async[a335_0x59594a(0x195)](_0x3410ac){const _0x58dc7b=a335_0x59594a;var _0x4058c0;const _0x26c88f=[];this[_0x58dc7b(0x17a)][_0x58dc7b(0x173)](_0x58dc7b(0x160));for(const _0x2218ee of _0x3410ac){const {data:_0x558ab3,headers:_0x2a40c2}=await this[_0x58dc7b(0x199)][_0x58dc7b(0x19a)](_0x2218ee,{'responseType':_0x58dc7b(0x181)}),_0x1aa263=(_0x4058c0=_0x2a40c2[_0x58dc7b(0x19e)])===null||_0x4058c0===void 0x0?void 0x0:_0x4058c0[_0x58dc7b(0x18b)](_0x58dc7b(0x19d));if(!_0x1aa263){const _0xb71736=_0x558ab3,_0x306255=new jszip_1[(_0x58dc7b(0x1a1))]();await _0x306255['loadAsync'](_0xb71736),_0x26c88f[_0x58dc7b(0x175)](_0x306255);}else{const _0x5068dc=JSON['parse'](_0x558ab3);throw new veeva_error_1[(_0x58dc7b(0x164))](_0x5068dc['errors']);}}return _0x26c88f;}async['deletePackageComponents'](_0x5d6675){const _0x5e1872=a335_0x59594a;this[_0x5e1872(0x17a)][_0x5e1872(0x173)]('Removing\x20components\x20from\x20outbound\x20packages.');const _0x1aaa1d=veeva_constants_1['VeevaConstants'][_0x5e1872(0x186)]+_0x5e1872(0x17b);await this['_veevaService'][_0x5e1872(0x18d)](_0x1aaa1d,_0x5d6675);}async[a335_0x59594a(0x1a0)](_0x15e4b){const _0x2226e9=a335_0x59594a;this[_0x2226e9(0x17a)]['log'](_0x2226e9(0x1aa));const _0x2a5226=veeva_constants_1['VeevaConstants'][_0x2226e9(0x186)]+_0x2226e9(0x197);await this[_0x2226e9(0x1a8)][_0x2226e9(0x18d)](_0x2a5226,_0x15e4b);}async[a335_0x59594a(0x18c)](_0x5b7655,_0x5907b7){const _0x33ea0d=a335_0x59594a,_0x286f48=await this[_0x33ea0d(0x19c)](Math[_0x33ea0d(0x167)](_0x5b7655[_0x33ea0d(0x1a7)]/veeva_constants_1[_0x33ea0d(0x196)][_0x33ea0d(0x176)]),_0x5907b7),_0x2062c9=await this[_0x33ea0d(0x188)](_0x5b7655,_0x286f48),_0x2850be=await this[_0x33ea0d(0x17f)](_0x286f48),_0x4af94e=await this[_0x33ea0d(0x16e)](Array[_0x33ea0d(0x193)](_0x2850be[_0x33ea0d(0x16d)]())),_0x587e85=await this[_0x33ea0d(0x166)](_0x4af94e),_0x48b903=await this[_0x33ea0d(0x195)](_0x587e85);return await this['deletePackageComponents'](_0x2062c9),await this['deleteOutboundPackages'](_0x286f48),_0x48b903;}}exports['PackageExportService']=PackageExportService;