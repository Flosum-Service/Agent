const a359_0x1f804d=a359_0x593c;(function(_0x4f6e26,_0x1a0a80){const _0xf859f0=a359_0x593c,_0x1f3d21=_0x4f6e26();while(!![]){try{const _0x5de50f=parseInt(_0xf859f0(0x88))/0x1*(parseInt(_0xf859f0(0xa3))/0x2)+-parseInt(_0xf859f0(0x85))/0x3*(-parseInt(_0xf859f0(0xa8))/0x4)+parseInt(_0xf859f0(0x96))/0x5+-parseInt(_0xf859f0(0x99))/0x6+-parseInt(_0xf859f0(0x75))/0x7+-parseInt(_0xf859f0(0xaa))/0x8+parseInt(_0xf859f0(0x82))/0x9;if(_0x5de50f===_0x1a0a80)break;else _0x1f3d21['push'](_0x1f3d21['shift']());}catch(_0x56d4eb){_0x1f3d21['push'](_0x1f3d21['shift']());}}}(a359_0x3337,0x325bf));function a359_0x3337(){const _0x298463=['__importDefault','1047088gVxUdl','log','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','migration__sys','MAXIMUM_SIZE_OF_PACKAGE','fill','from','apply','package_component__v','post','map','ceil','toString','1730700HYbNbA','ENDPOINT_CREATE_RECORDS','Removing\x20components\x20from\x20outbound\x20packages.','39bcfzCB','loadAsync','values','358331iBbBuh','arraybuffer','Adding\x20components\x20to\x20outbound\x20package','ENDPOINT_EXPORT_IMPORT_PACKAGE','application/json','filter','packageName','defineProperty','VeevaConstants','links','_connection','search','getEndpointArtifactList','Retrieve\x20Outbound\x20Package\x20zip\x20list','1997980GvfOMP','length','__esModule','2258574EWCrul','../enums/status.enums','rel','push','executeVQL','reduce','artifacts','Retrieve\x20Jobs\x20Status','createOutboundPackages','errors','2uCqEwr','getJobResult','default','constructor','parse','28648FWNGtf','../classes/errors/veeva-error','2488392mIVYro','ENDPOINT_VQL','Deleting\x20outbound\x20packages.','retrieveVPKList','createVeevaObjectRecords','Getting\x20names\x20of\x20outbound\x20packages','deleteOutboundPackages','outbound_package__v','join','VeevaError','getPackageNames','(((.+)+)+)+$','content-type','_logger','_veevaService','PackageExportService','deleteVeevaObjectRecords','set','Create\x20Export\x20outbound\x20packages.','application/x-www-form-urlencoded','createExportOutboundPackages','export','\x27,\x27','createPackageComponents','VeevaResponseStatus'];a359_0x3337=function(){return _0x298463;};return a359_0x3337();}const a359_0x335675=(function(){let _0x555732=!![];return function(_0x25015c,_0x20e3d6){const _0x21f969=_0x555732?function(){const _0xbc585f=a359_0x593c;if(_0x20e3d6){const _0x3807b1=_0x20e3d6[_0xbc585f(0x7c)](_0x25015c,arguments);return _0x20e3d6=null,_0x3807b1;}}:function(){};return _0x555732=![],_0x21f969;};}()),a359_0x2f3b80=a359_0x335675(this,function(){const _0x4d2443=a359_0x593c;return a359_0x2f3b80['toString']()[_0x4d2443(0x93)](_0x4d2443(0xb5))[_0x4d2443(0x81)]()[_0x4d2443(0xa6)](a359_0x2f3b80)[_0x4d2443(0x93)](_0x4d2443(0xb5));});a359_0x2f3b80();function a359_0x593c(_0x37576e,_0x546588){const _0x94763f=a359_0x3337();return a359_0x593c=function(_0x2f3b80,_0x335675){_0x2f3b80=_0x2f3b80-0x71;let _0x3337d7=_0x94763f[_0x2f3b80];return _0x3337d7;},a359_0x593c(_0x37576e,_0x546588);}'use strict';var __importDefault=this&&this[a359_0x1f804d(0x74)]||function(_0x53e15e){return _0x53e15e&&_0x53e15e['__esModule']?_0x53e15e:{'default':_0x53e15e};};Object[a359_0x1f804d(0x8f)](exports,a359_0x1f804d(0x98),{'value':!![]}),exports[a359_0x1f804d(0xb9)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require('jszip')),status_enums_1=require(a359_0x1f804d(0x9a)),veeva_error_1=require(a359_0x1f804d(0xa9));class PackageExportService{constructor({veevaService:_0x27374b,connection:_0x3c4f87,logger:_0x4411a8}){const _0x56c35a=a359_0x1f804d;this[_0x56c35a(0xb8)]=_0x27374b,this[_0x56c35a(0x92)]=_0x3c4f87,this[_0x56c35a(0xb7)]=_0x4411a8;}async[a359_0x1f804d(0xa1)](_0x2bbd97,_0x1888ea){const _0x5af42c=a359_0x1f804d;this['_logger'][_0x5af42c(0x76)]('Creating\x20outbound\x20packages');const _0x10d77e=veeva_constants_1[_0x5af42c(0x90)]['ENDPOINT_CREATE_RECORDS']+_0x5af42c(0xb1),_0x5ae105=new Array(_0x2bbd97)[_0x5af42c(0x7a)]({'summary__v':_0x1888ea,'object_type__v.api__name__v':_0x5af42c(0x78)});return await this['_veevaService'][_0x5af42c(0xae)](_0x10d77e,_0x5ae105);}async[a359_0x1f804d(0x72)](_0x1061cd,_0x24ae33){const _0x33fd86=a359_0x1f804d;this['_logger'][_0x33fd86(0x76)](_0x33fd86(0x8a));const _0x50d5d0=veeva_constants_1[_0x33fd86(0x90)][_0x33fd86(0x83)]+_0x33fd86(0x7d),_0x5bb38e=_0x1061cd['map']((_0x146c26,_0x176beb)=>({'vault_component__v':_0x146c26['id'],'outbound_package__v':_0x24ae33[Math[_0x33fd86(0x80)]((_0x176beb+0x1)/veeva_constants_1['VeevaConstants'][_0x33fd86(0x79)])-0x1]}));return await this['_veevaService']['createVeevaObjectRecords'](_0x50d5d0,_0x5bb38e);}async[a359_0x1f804d(0xb4)](_0x59430b){const _0x23fdfc=a359_0x1f804d;this[_0x23fdfc(0xb7)][_0x23fdfc(0x76)](_0x23fdfc(0xaf));const _0x410387=_0x23fdfc(0x77)+_0x59430b[_0x23fdfc(0xb2)](_0x23fdfc(0x71))+'\x27)',_0x1fe25a=veeva_constants_1[_0x23fdfc(0x90)][_0x23fdfc(0xab)]+_0x410387,_0x3bfb39=await this[_0x23fdfc(0xb8)][_0x23fdfc(0x9d)](_0x1fe25a);return _0x3bfb39[_0x23fdfc(0x9e)]((_0x561fff,_0x5ee642)=>_0x561fff[_0x23fdfc(0xbb)](_0x5ee642['id'],_0x5ee642['name__v']),new Map());}async[a359_0x1f804d(0xbe)](_0x4eb484){const _0x281271=a359_0x1f804d;this['_logger'][_0x281271(0x76)](_0x281271(0xbc));const _0x30305c=[],_0x4b2c38=_0x4eb484[_0x281271(0x7f)](_0x471f46=>{const _0x5d2063=_0x281271;return this['_connection'][_0x5d2063(0x7e)](veeva_constants_1[_0x5d2063(0x90)][_0x5d2063(0x8b)],encodeURI(_0x5d2063(0x8e))+'='+encodeURI(_0x471f46),{'headers':{'Content-Type':_0x5d2063(0xbd)}});}),_0x35c3f5=await Promise['all'](_0x4b2c38);for(const {data:_0x10a417}of _0x35c3f5){if(_0x10a417['responseStatus']===status_enums_1[_0x281271(0x73)]['SUCCESS']){const {url:_0x56cb81}=_0x10a417;_0x30305c['push'](_0x56cb81);}else throw new veeva_error_1[(_0x281271(0xb3))](_0x10a417[_0x281271(0xa2)]);}return _0x30305c;}async['getEndpointArtifactList'](_0x1b348b){const _0x197123=a359_0x1f804d;this[_0x197123(0xb7)][_0x197123(0x76)](_0x197123(0xa0));const _0x327ddd=[],_0x282e07=await this['_veevaService'][_0x197123(0xa4)](_0x1b348b);for(const _0x44c001 of _0x282e07){const _0x1b5c5f=_0x44c001[_0x197123(0x91)][_0x197123(0x8d)](_0x4e5086=>_0x4e5086[_0x197123(0x9b)]===_0x197123(0x9f))[_0x197123(0x7f)](_0xc3b2b0=>_0xc3b2b0['href']);_0x327ddd[_0x197123(0x9c)](..._0x1b5c5f);}return _0x327ddd;}async[a359_0x1f804d(0xad)](_0x4204c3){const _0x43e40f=a359_0x1f804d;var _0x34bc61;const _0x436faa=[];this[_0x43e40f(0xb7)][_0x43e40f(0x76)](_0x43e40f(0x95));for(const _0x2b242f of _0x4204c3){const {data:_0x246ac6,headers:_0x10cc68}=await this[_0x43e40f(0x92)]['get'](_0x2b242f,{'responseType':_0x43e40f(0x89)}),_0x216d7b=(_0x34bc61=_0x10cc68[_0x43e40f(0xb6)])===null||_0x34bc61===void 0x0?void 0x0:_0x34bc61['includes'](_0x43e40f(0x8c));if(!_0x216d7b){const _0x53f937=_0x246ac6,_0x2886a2=new jszip_1[(_0x43e40f(0xa5))]();await _0x2886a2[_0x43e40f(0x86)](_0x53f937),_0x436faa[_0x43e40f(0x9c)](_0x2886a2);}else{const _0x174bf0=JSON[_0x43e40f(0xa7)](_0x246ac6);throw new veeva_error_1['VeevaError'](_0x174bf0['errors']);}}return _0x436faa;}async['deletePackageComponents'](_0x3c4f0d){const _0x21bd88=a359_0x1f804d;this[_0x21bd88(0xb7)][_0x21bd88(0x76)](_0x21bd88(0x84));const _0x2174c3=veeva_constants_1[_0x21bd88(0x90)]['ENDPOINT_CREATE_RECORDS']+'package_component__v';await this[_0x21bd88(0xb8)]['deleteVeevaObjectRecords'](_0x2174c3,_0x3c4f0d);}async['deleteOutboundPackages'](_0x4f18f7){const _0x313389=a359_0x1f804d;this[_0x313389(0xb7)][_0x313389(0x76)](_0x313389(0xac));const _0x278b8e=veeva_constants_1['VeevaConstants'][_0x313389(0x83)]+_0x313389(0xb1);await this[_0x313389(0xb8)][_0x313389(0xba)](_0x278b8e,_0x4f18f7);}async[a359_0x1f804d(0xbf)](_0x4854d4,_0x45e377){const _0x545667=a359_0x1f804d,_0x465f7c=await this[_0x545667(0xa1)](Math['ceil'](_0x4854d4[_0x545667(0x97)]/veeva_constants_1[_0x545667(0x90)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x45e377),_0x12c58c=await this[_0x545667(0x72)](_0x4854d4,_0x465f7c),_0x266818=await this[_0x545667(0xb4)](_0x465f7c),_0x20211a=await this['createExportOutboundPackages'](Array[_0x545667(0x7b)](_0x266818[_0x545667(0x87)]())),_0x69a840=await this[_0x545667(0x94)](_0x20211a),_0x1ea097=await this[_0x545667(0xad)](_0x69a840);return await this['deletePackageComponents'](_0x12c58c),await this[_0x545667(0xb0)](_0x465f7c),_0x1ea097;}}exports[a359_0x1f804d(0xb9)]=PackageExportService;