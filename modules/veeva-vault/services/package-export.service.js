const a403_0x53ce17=a403_0xcb48;(function(_0x5c59bc,_0x4e2864){const _0x54d906=a403_0xcb48,_0x415451=_0x5c59bc();while(!![]){try{const _0x21e4ae=-parseInt(_0x54d906(0x164))/0x1+-parseInt(_0x54d906(0x145))/0x2*(parseInt(_0x54d906(0x135))/0x3)+parseInt(_0x54d906(0x14c))/0x4*(parseInt(_0x54d906(0x16a))/0x5)+parseInt(_0x54d906(0x162))/0x6*(-parseInt(_0x54d906(0x126))/0x7)+parseInt(_0x54d906(0x12e))/0x8+-parseInt(_0x54d906(0x14a))/0x9*(-parseInt(_0x54d906(0x128))/0xa)+parseInt(_0x54d906(0x154))/0xb;if(_0x21e4ae===_0x4e2864)break;else _0x415451['push'](_0x415451['shift']());}catch(_0x364828){_0x415451['push'](_0x415451['shift']());}}}(a403_0x2719,0x28918));const a403_0x238fa7=(function(){let _0x4023c9=!![];return function(_0x39060f,_0x4ddf0a){const _0x549482=_0x4023c9?function(){if(_0x4ddf0a){const _0x331675=_0x4ddf0a['apply'](_0x39060f,arguments);return _0x4ddf0a=null,_0x331675;}}:function(){};return _0x4023c9=![],_0x549482;};}()),a403_0x4d6c89=a403_0x238fa7(this,function(){const _0x1768a9=a403_0xcb48;return a403_0x4d6c89[_0x1768a9(0x161)]()['search'](_0x1768a9(0x16d))['toString']()[_0x1768a9(0x132)](a403_0x4d6c89)[_0x1768a9(0x136)]('(((.+)+)+)+$');});a403_0x4d6c89();function a403_0x2719(){const _0x1b3942=['MAXIMUM_SIZE_OF_PACKAGE','href','SUCCESS','getEndpointArtifactList','default','8380JkxabU','__esModule','Creating\x20outbound\x20packages','(((.+)+)+)+$','post','deletePackageComponents','../classes/errors/veeva-error','package_component__v','__importDefault','231KktUXr','_veevaService','10ABdIOx','content-type','createExportOutboundPackages','reduce','createVeevaObjectRecords','retrieveVPKList','1791160kHOZjF','deleteVeevaObjectRecords','outbound_package__v','loadAsync','constructor','join','VeevaError','8598CiaEmr','search','ceil','migration__sys','ENDPOINT_EXPORT_IMPORT_PACKAGE','ENDPOINT_CREATE_RECORDS','values','createPackageComponents','\x27,\x27','Retrieve\x20Jobs\x20Status','includes','name__v','VeevaResponseStatus','createOutboundPackages','_connection','errors','44feFPOx','getPackageNames','fill','jszip','arraybuffer','1434951iQraXa','set','256shqBOE','Retrieve\x20Outbound\x20Package\x20zip\x20list','log','from','parse','deleteOutboundPackages','push','application/x-www-form-urlencoded','501270nOhNwG','responseStatus','packageName','getJobResult','all','PackageExportService','map','Adding\x20components\x20to\x20outbound\x20package','_logger','VeevaConstants','executeVQL','../constants/veeva.constants','get','toString','44070iPzXWa','defineProperty','64563HkGvZO'];a403_0x2719=function(){return _0x1b3942;};return a403_0x2719();}'use strict';var __importDefault=this&&this[a403_0x53ce17(0x125)]||function(_0x585cc5){const _0x3b1425=a403_0x53ce17;return _0x585cc5&&_0x585cc5[_0x3b1425(0x16b)]?_0x585cc5:{'default':_0x585cc5};};Object[a403_0x53ce17(0x163)](exports,a403_0x53ce17(0x16b),{'value':!![]}),exports['PackageExportService']=void 0x0;const veeva_constants_1=require(a403_0x53ce17(0x15f)),jszip_1=__importDefault(require(a403_0x53ce17(0x148))),status_enums_1=require('../enums/status.enums'),veeva_error_1=require(a403_0x53ce17(0x170));class PackageExportService{constructor({veevaService:_0x521806,connection:_0x56a9a3,logger:_0x29f65e}){const _0x3d45db=a403_0x53ce17;this[_0x3d45db(0x127)]=_0x521806,this[_0x3d45db(0x143)]=_0x56a9a3,this[_0x3d45db(0x15c)]=_0x29f65e;}async[a403_0x53ce17(0x142)](_0x2c2cdc,_0x58c9b3){const _0x3d5c7a=a403_0x53ce17;this['_logger'][_0x3d5c7a(0x14e)](_0x3d5c7a(0x16c));const _0x3030c4=veeva_constants_1[_0x3d5c7a(0x15d)][_0x3d5c7a(0x13a)]+'outbound_package__v',_0x15b10c=new Array(_0x2c2cdc)[_0x3d5c7a(0x147)]({'summary__v':_0x58c9b3,'object_type__v.api__name__v':_0x3d5c7a(0x138)});return await this[_0x3d5c7a(0x127)][_0x3d5c7a(0x12c)](_0x3030c4,_0x15b10c);}async[a403_0x53ce17(0x13c)](_0x56cb71,_0x75673b){const _0x5f2fd0=a403_0x53ce17;this[_0x5f2fd0(0x15c)][_0x5f2fd0(0x14e)](_0x5f2fd0(0x15b));const _0x49b5ed=veeva_constants_1[_0x5f2fd0(0x15d)]['ENDPOINT_CREATE_RECORDS']+_0x5f2fd0(0x171),_0x2f3df0=_0x56cb71[_0x5f2fd0(0x15a)]((_0x26a62e,_0x2ad5c9)=>({'vault_component__v':_0x26a62e['id'],'outbound_package__v':_0x75673b[Math[_0x5f2fd0(0x137)]((_0x2ad5c9+0x1)/veeva_constants_1[_0x5f2fd0(0x15d)][_0x5f2fd0(0x165)])-0x1]}));return await this[_0x5f2fd0(0x127)][_0x5f2fd0(0x12c)](_0x49b5ed,_0x2f3df0);}async[a403_0x53ce17(0x146)](_0x398343){const _0x23dbe6=a403_0x53ce17;this[_0x23dbe6(0x15c)][_0x23dbe6(0x14e)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x1a14ae='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x398343[_0x23dbe6(0x133)](_0x23dbe6(0x13d))+'\x27)',_0x46f040=await this['_veevaService'][_0x23dbe6(0x15e)](_0x1a14ae);return _0x46f040[_0x23dbe6(0x12b)]((_0x22e76c,_0x534c3a)=>_0x22e76c[_0x23dbe6(0x14b)](_0x534c3a['id'],_0x534c3a[_0x23dbe6(0x140)]),new Map());}async[a403_0x53ce17(0x12a)](_0x5c2fa0){const _0x3b5b21=a403_0x53ce17;this[_0x3b5b21(0x15c)]['log']('Create\x20Export\x20outbound\x20packages.');const _0x282cdd=[],_0x32c309=_0x5c2fa0['map'](_0x4ec158=>{const _0x5910c3=_0x3b5b21;return this[_0x5910c3(0x143)][_0x5910c3(0x16e)](veeva_constants_1[_0x5910c3(0x15d)][_0x5910c3(0x139)],encodeURI(_0x5910c3(0x156))+'='+encodeURI(_0x4ec158),{'headers':{'Content-Type':_0x5910c3(0x153)}});}),_0x5ece6d=await Promise[_0x3b5b21(0x158)](_0x32c309);for(const {data:_0x49a09a}of _0x5ece6d){if(_0x49a09a[_0x3b5b21(0x155)]===status_enums_1[_0x3b5b21(0x141)][_0x3b5b21(0x167)]){const {url:_0x5aab4a}=_0x49a09a;_0x282cdd[_0x3b5b21(0x152)](_0x5aab4a);}else throw new veeva_error_1[(_0x3b5b21(0x134))](_0x49a09a['errors']);}return _0x282cdd;}async[a403_0x53ce17(0x168)](_0x2dcf86){const _0x3461dc=a403_0x53ce17;this[_0x3461dc(0x15c)][_0x3461dc(0x14e)](_0x3461dc(0x13e));const _0x23e351=[],_0x6fe433=await this['_veevaService'][_0x3461dc(0x157)](_0x2dcf86);for(const _0x452d74 of _0x6fe433){const _0x1c6d1a=_0x452d74['links']['filter'](_0x2144ed=>_0x2144ed['rel']==='artifacts')[_0x3461dc(0x15a)](_0x297807=>_0x297807[_0x3461dc(0x166)]);_0x23e351[_0x3461dc(0x152)](..._0x1c6d1a);}return _0x23e351;}async[a403_0x53ce17(0x12d)](_0x23c6df){const _0xa0907=a403_0x53ce17;var _0x2aac46;const _0x175a01=[];this['_logger']['log'](_0xa0907(0x14d));for(const _0x1e8b0e of _0x23c6df){const {data:_0x5124b6,headers:_0x14828c}=await this[_0xa0907(0x143)][_0xa0907(0x160)](_0x1e8b0e,{'responseType':_0xa0907(0x149)}),_0x83983e=(_0x2aac46=_0x14828c[_0xa0907(0x129)])===null||_0x2aac46===void 0x0?void 0x0:_0x2aac46[_0xa0907(0x13f)]('application/json');if(!_0x83983e){const _0x515cd9=_0x5124b6,_0x131fe3=new jszip_1[(_0xa0907(0x169))]();await _0x131fe3[_0xa0907(0x131)](_0x515cd9),_0x175a01[_0xa0907(0x152)](_0x131fe3);}else{const _0x28d19d=JSON[_0xa0907(0x150)](_0x5124b6);throw new veeva_error_1[(_0xa0907(0x134))](_0x28d19d[_0xa0907(0x144)]);}}return _0x175a01;}async[a403_0x53ce17(0x16f)](_0xb92103){const _0x3ae427=a403_0x53ce17;this[_0x3ae427(0x15c)][_0x3ae427(0x14e)]('Removing\x20components\x20from\x20outbound\x20packages.');const _0x1b0c6a=veeva_constants_1[_0x3ae427(0x15d)][_0x3ae427(0x13a)]+_0x3ae427(0x171);await this[_0x3ae427(0x127)][_0x3ae427(0x12f)](_0x1b0c6a,_0xb92103);}async['deleteOutboundPackages'](_0x56fc5f){const _0x1f5a44=a403_0x53ce17;this[_0x1f5a44(0x15c)]['log']('Deleting\x20outbound\x20packages.');const _0x5f0e72=veeva_constants_1[_0x1f5a44(0x15d)][_0x1f5a44(0x13a)]+_0x1f5a44(0x130);await this[_0x1f5a44(0x127)]['deleteVeevaObjectRecords'](_0x5f0e72,_0x56fc5f);}async['export'](_0x1cdc35,_0x277440){const _0x2c97ce=a403_0x53ce17,_0x5bdd46=await this['createOutboundPackages'](Math[_0x2c97ce(0x137)](_0x1cdc35['length']/veeva_constants_1[_0x2c97ce(0x15d)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x277440),_0x80dad9=await this[_0x2c97ce(0x13c)](_0x1cdc35,_0x5bdd46),_0x3b16e6=await this['getPackageNames'](_0x5bdd46),_0x392653=await this['createExportOutboundPackages'](Array[_0x2c97ce(0x14f)](_0x3b16e6[_0x2c97ce(0x13b)]())),_0x49b575=await this[_0x2c97ce(0x168)](_0x392653),_0x7ed30a=await this[_0x2c97ce(0x12d)](_0x49b575);return await this['deletePackageComponents'](_0x80dad9),await this[_0x2c97ce(0x151)](_0x5bdd46),_0x7ed30a;}}function a403_0xcb48(_0x1e3fbf,_0x5820af){const _0xe4041a=a403_0x2719();return a403_0xcb48=function(_0x4d6c89,_0x238fa7){_0x4d6c89=_0x4d6c89-0x125;let _0x271961=_0xe4041a[_0x4d6c89];return _0x271961;},a403_0xcb48(_0x1e3fbf,_0x5820af);}exports[a403_0x53ce17(0x159)]=PackageExportService;