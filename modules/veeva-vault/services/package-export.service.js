const a351_0x8b4ab3=a351_0x1a4c;function a351_0x745e(){const _0x414bb4=['_logger','filter','log','Removing\x20components\x20from\x20outbound\x20packages.','Retrieve\x20Jobs\x20Status','deleteOutboundPackages','content-type','defineProperty','outbound_package__v','responseStatus','_veevaService','5ovRveW','reduce','createExportOutboundPackages','join','8001882LXXFcH','createVeevaObjectRecords','toString','search','VeevaError','parse','all','12ciZkNZ','ENDPOINT_CREATE_RECORDS','name__v','links','executeVQL','fill','jszip','length','retrieveVPKList','from','getEndpointArtifactList','(((.+)+)+)+$','Adding\x20components\x20to\x20outbound\x20package','Retrieve\x20Outbound\x20Package\x20zip\x20list','deletePackageComponents','getJobResult','231700yeRxga','VeevaConstants','\x27,\x27','package_component__v','application/json','deleteVeevaObjectRecords','apply','values','MAXIMUM_SIZE_OF_PACKAGE','../classes/errors/veeva-error','default','8727krhrqL','ENDPOINT_VQL','Create\x20Export\x20outbound\x20packages.','getPackageNames','ceil','1625250sJlOFB','post','Getting\x20names\x20of\x20outbound\x20packages','map','279920FUkICd','createOutboundPackages','errors','2897576JmAaAx','packageName','export','../constants/veeva.constants','2718996FREfvT','../enums/status.enums','Deleting\x20outbound\x20packages.','createPackageComponents','__importDefault','__esModule','push','artifacts','_connection','constructor','PackageExportService','Creating\x20outbound\x20packages','ENDPOINT_EXPORT_IMPORT_PACKAGE'];a351_0x745e=function(){return _0x414bb4;};return a351_0x745e();}(function(_0xc1879,_0x1f6c93){const _0x3989a5=a351_0x1a4c,_0x19f15c=_0xc1879();while(!![]){try{const _0x27a7b4=parseInt(_0x3989a5(0x184))/0x1+parseInt(_0x3989a5(0x170))/0x2+parseInt(_0x3989a5(0x17b))/0x3*(parseInt(_0x3989a5(0x1ae))/0x4)+parseInt(_0x3989a5(0x1a3))/0x5*(-parseInt(_0x3989a5(0x180))/0x6)+-parseInt(_0x3989a5(0x18b))/0x7+-parseInt(_0x3989a5(0x187))/0x8+parseInt(_0x3989a5(0x1a7))/0x9;if(_0x27a7b4===_0x1f6c93)break;else _0x19f15c['push'](_0x19f15c['shift']());}catch(_0xabd101){_0x19f15c['push'](_0x19f15c['shift']());}}}(a351_0x745e,0x426df));function a351_0x1a4c(_0x233a82,_0x4ce390){const _0x2530e3=a351_0x745e();return a351_0x1a4c=function(_0x32007f,_0xef4da4){_0x32007f=_0x32007f-0x16e;let _0x745ece=_0x2530e3[_0x32007f];return _0x745ece;},a351_0x1a4c(_0x233a82,_0x4ce390);}const a351_0xef4da4=(function(){let _0x14fbec=!![];return function(_0x11afc5,_0x4f402f){const _0x18bf27=_0x14fbec?function(){const _0x4d3bfb=a351_0x1a4c;if(_0x4f402f){const _0x639944=_0x4f402f[_0x4d3bfb(0x176)](_0x11afc5,arguments);return _0x4f402f=null,_0x639944;}}:function(){};return _0x14fbec=![],_0x18bf27;};}()),a351_0x32007f=a351_0xef4da4(this,function(){const _0x3ca2e6=a351_0x1a4c;return a351_0x32007f[_0x3ca2e6(0x1a9)]()[_0x3ca2e6(0x1aa)]('(((.+)+)+)+$')[_0x3ca2e6(0x1a9)]()[_0x3ca2e6(0x194)](a351_0x32007f)[_0x3ca2e6(0x1aa)](_0x3ca2e6(0x1b9));});a351_0x32007f();'use strict';var __importDefault=this&&this[a351_0x8b4ab3(0x18f)]||function(_0x56e341){const _0x53812d=a351_0x8b4ab3;return _0x56e341&&_0x56e341[_0x53812d(0x190)]?_0x56e341:{'default':_0x56e341};};Object[a351_0x8b4ab3(0x19f)](exports,a351_0x8b4ab3(0x190),{'value':!![]}),exports[a351_0x8b4ab3(0x195)]=void 0x0;const veeva_constants_1=require(a351_0x8b4ab3(0x18a)),jszip_1=__importDefault(require(a351_0x8b4ab3(0x1b4))),status_enums_1=require(a351_0x8b4ab3(0x18c)),veeva_error_1=require(a351_0x8b4ab3(0x179));class PackageExportService{constructor({veevaService:_0x3b5433,connection:_0x1c5dd2,logger:_0x172ca5}){const _0x1df5dd=a351_0x8b4ab3;this[_0x1df5dd(0x1a2)]=_0x3b5433,this[_0x1df5dd(0x193)]=_0x1c5dd2,this[_0x1df5dd(0x198)]=_0x172ca5;}async[a351_0x8b4ab3(0x185)](_0x1dc517,_0x5600f7){const _0x56029c=a351_0x8b4ab3;this[_0x56029c(0x198)][_0x56029c(0x19a)](_0x56029c(0x196));const _0x36804e=veeva_constants_1[_0x56029c(0x171)][_0x56029c(0x1af)]+_0x56029c(0x1a0),_0x3d1385=new Array(_0x1dc517)[_0x56029c(0x1b3)]({'summary__v':_0x5600f7,'object_type__v.api__name__v':'migration__sys'});return await this['_veevaService'][_0x56029c(0x1a8)](_0x36804e,_0x3d1385);}async[a351_0x8b4ab3(0x18e)](_0x39f123,_0xb98fa){const _0x10ca72=a351_0x8b4ab3;this[_0x10ca72(0x198)][_0x10ca72(0x19a)](_0x10ca72(0x1ba));const _0x1a1cb7=veeva_constants_1[_0x10ca72(0x171)][_0x10ca72(0x1af)]+_0x10ca72(0x173),_0x39ce85=_0x39f123[_0x10ca72(0x183)]((_0x2927f3,_0x53ebb1)=>({'vault_component__v':_0x2927f3['id'],'outbound_package__v':_0xb98fa[Math[_0x10ca72(0x17f)]((_0x53ebb1+0x1)/veeva_constants_1[_0x10ca72(0x171)]['MAXIMUM_SIZE_OF_PACKAGE'])-0x1]}));return await this[_0x10ca72(0x1a2)][_0x10ca72(0x1a8)](_0x1a1cb7,_0x39ce85);}async[a351_0x8b4ab3(0x17e)](_0x2bdef5){const _0x113bc0=a351_0x8b4ab3;this[_0x113bc0(0x198)][_0x113bc0(0x19a)](_0x113bc0(0x182));const _0x402755='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x2bdef5[_0x113bc0(0x1a6)](_0x113bc0(0x172))+'\x27)',_0x59d3ee=veeva_constants_1[_0x113bc0(0x171)][_0x113bc0(0x17c)]+_0x402755,_0x492f15=await this['_veevaService'][_0x113bc0(0x1b2)](_0x59d3ee);return _0x492f15[_0x113bc0(0x1a4)]((_0x5a7223,_0x111044)=>_0x5a7223['set'](_0x111044['id'],_0x111044[_0x113bc0(0x1b0)]),new Map());}async[a351_0x8b4ab3(0x1a5)](_0x1fa95a){const _0x482c1a=a351_0x8b4ab3;this[_0x482c1a(0x198)][_0x482c1a(0x19a)](_0x482c1a(0x17d));const _0x10ee82=[],_0x597530=_0x1fa95a[_0x482c1a(0x183)](_0x4cc2db=>{const _0x4feab3=_0x482c1a;return this[_0x4feab3(0x193)][_0x4feab3(0x181)](veeva_constants_1['VeevaConstants'][_0x4feab3(0x197)],encodeURI(_0x4feab3(0x188))+'='+encodeURI(_0x4cc2db),{'headers':{'Content-Type':'application/x-www-form-urlencoded'}});}),_0x4bdc76=await Promise[_0x482c1a(0x1ad)](_0x597530);for(const {data:_0x8b6af4}of _0x4bdc76){if(_0x8b6af4[_0x482c1a(0x1a1)]===status_enums_1['VeevaResponseStatus']['SUCCESS']){const {url:_0x403b11}=_0x8b6af4;_0x10ee82[_0x482c1a(0x191)](_0x403b11);}else throw new veeva_error_1[(_0x482c1a(0x1ab))](_0x8b6af4['errors']);}return _0x10ee82;}async[a351_0x8b4ab3(0x1b8)](_0x4cbfb5){const _0x23d372=a351_0x8b4ab3;this[_0x23d372(0x198)][_0x23d372(0x19a)](_0x23d372(0x19c));const _0x3e7502=[],_0x5a7f7d=await this[_0x23d372(0x1a2)][_0x23d372(0x16f)](_0x4cbfb5);for(const _0x7f3e3 of _0x5a7f7d){const _0x2a94a5=_0x7f3e3[_0x23d372(0x1b1)][_0x23d372(0x199)](_0x5974f7=>_0x5974f7['rel']===_0x23d372(0x192))[_0x23d372(0x183)](_0x431ee6=>_0x431ee6['href']);_0x3e7502[_0x23d372(0x191)](..._0x2a94a5);}return _0x3e7502;}async[a351_0x8b4ab3(0x1b6)](_0x3e6c34){const _0x324f5c=a351_0x8b4ab3;var _0x5342b2;const _0x915957=[];this[_0x324f5c(0x198)][_0x324f5c(0x19a)](_0x324f5c(0x1bb));for(const _0x1e77f4 of _0x3e6c34){const {data:_0x52d38a,headers:_0x46bfcc}=await this[_0x324f5c(0x193)]['get'](_0x1e77f4,{'responseType':'arraybuffer'}),_0x24fb8f=(_0x5342b2=_0x46bfcc[_0x324f5c(0x19e)])===null||_0x5342b2===void 0x0?void 0x0:_0x5342b2['includes'](_0x324f5c(0x174));if(!_0x24fb8f){const _0x4c4633=_0x52d38a,_0x15f673=new jszip_1[(_0x324f5c(0x17a))]();await _0x15f673['loadAsync'](_0x4c4633),_0x915957[_0x324f5c(0x191)](_0x15f673);}else{const _0x47c454=JSON[_0x324f5c(0x1ac)](_0x52d38a);throw new veeva_error_1['VeevaError'](_0x47c454[_0x324f5c(0x186)]);}}return _0x915957;}async[a351_0x8b4ab3(0x16e)](_0x222174){const _0x2cad8e=a351_0x8b4ab3;this['_logger'][_0x2cad8e(0x19a)](_0x2cad8e(0x19b));const _0x2a94e8=veeva_constants_1['VeevaConstants'][_0x2cad8e(0x1af)]+_0x2cad8e(0x173);await this[_0x2cad8e(0x1a2)][_0x2cad8e(0x175)](_0x2a94e8,_0x222174);}async[a351_0x8b4ab3(0x19d)](_0x3d4c1f){const _0x26db39=a351_0x8b4ab3;this[_0x26db39(0x198)]['log'](_0x26db39(0x18d));const _0x4bf486=veeva_constants_1[_0x26db39(0x171)][_0x26db39(0x1af)]+_0x26db39(0x1a0);await this[_0x26db39(0x1a2)][_0x26db39(0x175)](_0x4bf486,_0x3d4c1f);}async[a351_0x8b4ab3(0x189)](_0x1bdb99,_0x3848ef){const _0x38c959=a351_0x8b4ab3,_0x5239e3=await this['createOutboundPackages'](Math[_0x38c959(0x17f)](_0x1bdb99[_0x38c959(0x1b5)]/veeva_constants_1[_0x38c959(0x171)][_0x38c959(0x178)]),_0x3848ef),_0x1c7538=await this[_0x38c959(0x18e)](_0x1bdb99,_0x5239e3),_0x9240e=await this['getPackageNames'](_0x5239e3),_0x2abcd3=await this[_0x38c959(0x1a5)](Array[_0x38c959(0x1b7)](_0x9240e[_0x38c959(0x177)]())),_0x59900c=await this[_0x38c959(0x1b8)](_0x2abcd3),_0x428ab4=await this[_0x38c959(0x1b6)](_0x59900c);return await this[_0x38c959(0x16e)](_0x1c7538),await this[_0x38c959(0x19d)](_0x5239e3),_0x428ab4;}}exports[a351_0x8b4ab3(0x195)]=PackageExportService;