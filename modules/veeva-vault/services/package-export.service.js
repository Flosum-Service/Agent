const a359_0x3bcfd4=a359_0x3eea;(function(_0x205e62,_0x5c9025){const _0xad4e37=a359_0x3eea,_0x486eb9=_0x205e62();while(!![]){try{const _0x4bdba0=-parseInt(_0xad4e37(0x1ae))/0x1*(-parseInt(_0xad4e37(0x1a7))/0x2)+parseInt(_0xad4e37(0x1e2))/0x3+-parseInt(_0xad4e37(0x1e9))/0x4+-parseInt(_0xad4e37(0x1b5))/0x5*(-parseInt(_0xad4e37(0x1db))/0x6)+parseInt(_0xad4e37(0x1c9))/0x7*(parseInt(_0xad4e37(0x1b4))/0x8)+-parseInt(_0xad4e37(0x1ab))/0x9+parseInt(_0xad4e37(0x1da))/0xa*(parseInt(_0xad4e37(0x1d5))/0xb);if(_0x4bdba0===_0x5c9025)break;else _0x486eb9['push'](_0x486eb9['shift']());}catch(_0x598d8a){_0x486eb9['push'](_0x486eb9['shift']());}}}(a359_0x51db,0x7ecbf));const a359_0x40679d=(function(){let _0x5d497a=!![];return function(_0x40077a,_0x3e7fad){const _0x3748fe=_0x5d497a?function(){const _0xed5aab=a359_0x3eea;if(_0x3e7fad){const _0x2c7e43=_0x3e7fad[_0xed5aab(0x1cb)](_0x40077a,arguments);return _0x3e7fad=null,_0x2c7e43;}}:function(){};return _0x5d497a=![],_0x3748fe;};}()),a359_0x1a10b1=a359_0x40679d(this,function(){const _0x36e8d3=a359_0x3eea;return a359_0x1a10b1[_0x36e8d3(0x1e1)]()[_0x36e8d3(0x1b3)](_0x36e8d3(0x1b0))[_0x36e8d3(0x1e1)]()['constructor'](a359_0x1a10b1)[_0x36e8d3(0x1b3)](_0x36e8d3(0x1b0));});a359_0x1a10b1();'use strict';var __importDefault=this&&this[a359_0x3bcfd4(0x1e7)]||function(_0x1bdde4){const _0x452a82=a359_0x3bcfd4;return _0x1bdde4&&_0x1bdde4[_0x452a82(0x1de)]?_0x1bdde4:{'default':_0x1bdde4};};function a359_0x51db(){const _0x2654ca=['loadAsync','SUCCESS','post','join','createExportOutboundPackages','fill','outbound_package__v','27302QIIFKR','Retrieve\x20Outbound\x20Package\x20zip\x20list','artifacts','createPackageComponents','links','1450cxGuBO','6WOKfnP','../constants/veeva.constants','log','__esModule','jszip','get','toString','65313kzOAsA','Adding\x20components\x20to\x20outbound\x20package','../enums/status.enums','ceil','set','__importDefault','default','3246544qheeqM','name__v','_logger','_veevaService','ENDPOINT_CREATE_RECORDS','migration__sys','MAXIMUM_SIZE_OF_PACKAGE','../classes/errors/veeva-error','includes','getPackageNames','push','getJobResult','15714IEmTru','parse','responseStatus','retrieveVPKList','2821995DmHlNM','getEndpointArtifactList','Retrieve\x20Jobs\x20Status','36BnKiKz','Deleting\x20outbound\x20packages.','(((.+)+)+)+$','rel','application/json','search','12008WHCwPi','2303455xHsBcq','arraybuffer','content-type','map','ENDPOINT_EXPORT_IMPORT_PACKAGE','deleteVeevaObjectRecords','packageName','all','_connection','VeevaConstants','createOutboundPackages','deleteOutboundPackages','Create\x20Export\x20outbound\x20packages.','createVeevaObjectRecords','length','VeevaError','PackageExportService','deletePackageComponents','application/x-www-form-urlencoded','errors','2422HNvMyS','package_component__v','apply','defineProperty','VeevaResponseStatus'];a359_0x51db=function(){return _0x2654ca;};return a359_0x51db();}Object[a359_0x3bcfd4(0x1cc)](exports,a359_0x3bcfd4(0x1de),{'value':!![]}),exports[a359_0x3bcfd4(0x1c5)]=void 0x0;function a359_0x3eea(_0x4482a8,_0x9629aa){const _0x28ae0b=a359_0x51db();return a359_0x3eea=function(_0x1a10b1,_0x40679d){_0x1a10b1=_0x1a10b1-0x1a1;let _0x51dbf1=_0x28ae0b[_0x1a10b1];return _0x51dbf1;},a359_0x3eea(_0x4482a8,_0x9629aa);}const veeva_constants_1=require(a359_0x3bcfd4(0x1dc)),jszip_1=__importDefault(require(a359_0x3bcfd4(0x1df))),status_enums_1=require(a359_0x3bcfd4(0x1e4)),veeva_error_1=require(a359_0x3bcfd4(0x1a2));class PackageExportService{constructor({veevaService:_0x4c7046,connection:_0xc68b83,logger:_0x25651a}){const _0x44f23e=a359_0x3bcfd4;this[_0x44f23e(0x1ec)]=_0x4c7046,this[_0x44f23e(0x1bd)]=_0xc68b83,this[_0x44f23e(0x1eb)]=_0x25651a;}async['createOutboundPackages'](_0x33c453,_0x269167){const _0x3eb884=a359_0x3bcfd4;this[_0x3eb884(0x1eb)]['log']('Creating\x20outbound\x20packages');const _0x2d352b=veeva_constants_1[_0x3eb884(0x1be)][_0x3eb884(0x1ed)]+_0x3eb884(0x1d4),_0x1f4f81=new Array(_0x33c453)[_0x3eb884(0x1d3)]({'summary__v':_0x269167,'object_type__v.api__name__v':_0x3eb884(0x1ee)});return await this[_0x3eb884(0x1ec)][_0x3eb884(0x1c2)](_0x2d352b,_0x1f4f81);}async[a359_0x3bcfd4(0x1d8)](_0x3d2bc9,_0x554c5b){const _0x101c8c=a359_0x3bcfd4;this[_0x101c8c(0x1eb)][_0x101c8c(0x1dd)](_0x101c8c(0x1e3));const _0x3eb7e7=veeva_constants_1[_0x101c8c(0x1be)][_0x101c8c(0x1ed)]+_0x101c8c(0x1ca),_0x535d4a=_0x3d2bc9['map']((_0x58aa9e,_0x251f39)=>({'vault_component__v':_0x58aa9e['id'],'outbound_package__v':_0x554c5b[Math[_0x101c8c(0x1e5)]((_0x251f39+0x1)/veeva_constants_1[_0x101c8c(0x1be)]['MAXIMUM_SIZE_OF_PACKAGE'])-0x1]}));return await this[_0x101c8c(0x1ec)][_0x101c8c(0x1c2)](_0x3eb7e7,_0x535d4a);}async[a359_0x3bcfd4(0x1a4)](_0x3c5367){const _0x41e563=a359_0x3bcfd4;this[_0x41e563(0x1eb)][_0x41e563(0x1dd)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x24581a='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x3c5367[_0x41e563(0x1d1)]('\x27,\x27')+'\x27)',_0x2aefe0=await this[_0x41e563(0x1ec)]['executeVQL'](_0x24581a);return _0x2aefe0['reduce']((_0x33f56a,_0x6783bf)=>_0x33f56a[_0x41e563(0x1e6)](_0x6783bf['id'],_0x6783bf[_0x41e563(0x1ea)]),new Map());}async[a359_0x3bcfd4(0x1d2)](_0x2605a9){const _0x1f2321=a359_0x3bcfd4;this[_0x1f2321(0x1eb)][_0x1f2321(0x1dd)](_0x1f2321(0x1c1));const _0x87d000=[],_0x9d1b89=_0x2605a9[_0x1f2321(0x1b8)](_0x42f8b6=>{const _0x3cd479=_0x1f2321;return this[_0x3cd479(0x1bd)][_0x3cd479(0x1d0)](veeva_constants_1[_0x3cd479(0x1be)][_0x3cd479(0x1b9)],encodeURI(_0x3cd479(0x1bb))+'='+encodeURI(_0x42f8b6),{'headers':{'Content-Type':_0x3cd479(0x1c7)}});}),_0x48fe6f=await Promise[_0x1f2321(0x1bc)](_0x9d1b89);for(const {data:_0x2c1790}of _0x48fe6f){if(_0x2c1790[_0x1f2321(0x1a9)]===status_enums_1[_0x1f2321(0x1cd)][_0x1f2321(0x1cf)]){const {url:_0x45a0c7}=_0x2c1790;_0x87d000[_0x1f2321(0x1a5)](_0x45a0c7);}else throw new veeva_error_1['VeevaError'](_0x2c1790[_0x1f2321(0x1c8)]);}return _0x87d000;}async[a359_0x3bcfd4(0x1ac)](_0x28e642){const _0x179748=a359_0x3bcfd4;this[_0x179748(0x1eb)][_0x179748(0x1dd)](_0x179748(0x1ad));const _0x189aeb=[],_0x17bfd4=await this[_0x179748(0x1ec)][_0x179748(0x1a6)](_0x28e642);for(const _0xe98c74 of _0x17bfd4){const _0x25a5d6=_0xe98c74[_0x179748(0x1d9)]['filter'](_0x282c1e=>_0x282c1e[_0x179748(0x1b1)]===_0x179748(0x1d7))[_0x179748(0x1b8)](_0x295654=>_0x295654['href']);_0x189aeb[_0x179748(0x1a5)](..._0x25a5d6);}return _0x189aeb;}async['retrieveVPKList'](_0x2c31a0){const _0x43414f=a359_0x3bcfd4;var _0x35fd45;const _0x5caebe=[];this['_logger'][_0x43414f(0x1dd)](_0x43414f(0x1d6));for(const _0xef3cd4 of _0x2c31a0){const {data:_0x5c02da,headers:_0x47cf1d}=await this[_0x43414f(0x1bd)][_0x43414f(0x1e0)](_0xef3cd4,{'responseType':_0x43414f(0x1b6)}),_0x110e3a=(_0x35fd45=_0x47cf1d[_0x43414f(0x1b7)])===null||_0x35fd45===void 0x0?void 0x0:_0x35fd45[_0x43414f(0x1a3)](_0x43414f(0x1b2));if(!_0x110e3a){const _0x3a1de4=_0x5c02da,_0x377d56=new jszip_1[(_0x43414f(0x1e8))]();await _0x377d56[_0x43414f(0x1ce)](_0x3a1de4),_0x5caebe[_0x43414f(0x1a5)](_0x377d56);}else{const _0x34f57a=JSON[_0x43414f(0x1a8)](_0x5c02da);throw new veeva_error_1[(_0x43414f(0x1c4))](_0x34f57a[_0x43414f(0x1c8)]);}}return _0x5caebe;}async[a359_0x3bcfd4(0x1c6)](_0x110a13){const _0x2c9d2d=a359_0x3bcfd4;this['_logger'][_0x2c9d2d(0x1dd)]('Removing\x20components\x20from\x20outbound\x20packages.');const _0x24569b=veeva_constants_1['VeevaConstants'][_0x2c9d2d(0x1ed)]+_0x2c9d2d(0x1ca);await this[_0x2c9d2d(0x1ec)][_0x2c9d2d(0x1ba)](_0x24569b,_0x110a13);}async[a359_0x3bcfd4(0x1c0)](_0x364506){const _0xd6cbd7=a359_0x3bcfd4;this['_logger'][_0xd6cbd7(0x1dd)](_0xd6cbd7(0x1af));const _0x13c949=veeva_constants_1[_0xd6cbd7(0x1be)][_0xd6cbd7(0x1ed)]+'outbound_package__v';await this['_veevaService'][_0xd6cbd7(0x1ba)](_0x13c949,_0x364506);}async['export'](_0x2059a4,_0x135e32){const _0x5253fe=a359_0x3bcfd4,_0x11bc47=await this[_0x5253fe(0x1bf)](Math['ceil'](_0x2059a4[_0x5253fe(0x1c3)]/veeva_constants_1['VeevaConstants'][_0x5253fe(0x1a1)]),_0x135e32),_0xe52633=await this[_0x5253fe(0x1d8)](_0x2059a4,_0x11bc47),_0x221fe4=await this[_0x5253fe(0x1a4)](_0x11bc47),_0x5672b7=await this[_0x5253fe(0x1d2)](Array['from'](_0x221fe4['values']())),_0x186b9d=await this['getEndpointArtifactList'](_0x5672b7),_0x2ad701=await this[_0x5253fe(0x1aa)](_0x186b9d);return await this[_0x5253fe(0x1c6)](_0xe52633),await this['deleteOutboundPackages'](_0x11bc47),_0x2ad701;}}exports[a359_0x3bcfd4(0x1c5)]=PackageExportService;