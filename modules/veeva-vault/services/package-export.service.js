const a358_0x46d43c=a358_0x3c60;(function(_0x5c3951,_0x1e7a18){const _0x1a2b4f=a358_0x3c60,_0x45fb2a=_0x5c3951();while(!![]){try{const _0xe147be=-parseInt(_0x1a2b4f(0x1e1))/0x1+-parseInt(_0x1a2b4f(0x1ed))/0x2*(parseInt(_0x1a2b4f(0x1f7))/0x3)+-parseInt(_0x1a2b4f(0x1c8))/0x4*(-parseInt(_0x1a2b4f(0x1cd))/0x5)+-parseInt(_0x1a2b4f(0x1cf))/0x6*(-parseInt(_0x1a2b4f(0x1c9))/0x7)+-parseInt(_0x1a2b4f(0x1e5))/0x8+-parseInt(_0x1a2b4f(0x1bd))/0x9+parseInt(_0x1a2b4f(0x1bb))/0xa*(parseInt(_0x1a2b4f(0x1aa))/0xb);if(_0xe147be===_0x1e7a18)break;else _0x45fb2a['push'](_0x45fb2a['shift']());}catch(_0x92c00b){_0x45fb2a['push'](_0x45fb2a['shift']());}}}(a358_0x38c1,0x1b55a));function a358_0x3c60(_0x3cd790,_0x181108){const _0x573129=a358_0x38c1();return a358_0x3c60=function(_0x233efc,_0x2c67a8){_0x233efc=_0x233efc-0x1a8;let _0x38c17d=_0x573129[_0x233efc];return _0x38c17d;},a358_0x3c60(_0x3cd790,_0x181108);}const a358_0x2c67a8=(function(){let _0x39f1cd=!![];return function(_0x5c17fa,_0x1cbe63){const _0x15f532=_0x39f1cd?function(){const _0x309e8c=a358_0x3c60;if(_0x1cbe63){const _0x48bb63=_0x1cbe63[_0x309e8c(0x1bc)](_0x5c17fa,arguments);return _0x1cbe63=null,_0x48bb63;}}:function(){};return _0x39f1cd=![],_0x15f532;};}()),a358_0x233efc=a358_0x2c67a8(this,function(){const _0x5effb3=a358_0x3c60;return a358_0x233efc[_0x5effb3(0x1f1)]()[_0x5effb3(0x1d2)](_0x5effb3(0x1e9))['toString']()[_0x5effb3(0x1c3)](a358_0x233efc)[_0x5effb3(0x1d2)](_0x5effb3(0x1e9));});a358_0x233efc();'use strict';function a358_0x38c1(){const _0x5e221d=['80NmJmWc','apply','279657TxzFyO','outbound_package__v','rel','join','links','createVeevaObjectRecords','constructor','ceil','filter','deleteVeevaObjectRecords','get','16RvGpYT','7nptxCD','log','Create\x20Export\x20outbound\x20packages.','MAXIMUM_SIZE_OF_PACKAGE','215980ixlFgN','push','120144yXzZcF','content-type','getEndpointArtifactList','search','../classes/errors/veeva-error','ENDPOINT_CREATE_RECORDS','length','fill','Adding\x20components\x20to\x20outbound\x20package','PackageExportService','_veevaService','loadAsync','getPackageNames','../enums/status.enums','createOutboundPackages','jszip','__esModule','href','100207MjsIRq','Removing\x20components\x20from\x20outbound\x20packages.','getJobResult','application/x-www-form-urlencoded','567352PPxgyO','Creating\x20outbound\x20packages','createPackageComponents','export','(((.+)+)+)+$','arraybuffer','artifacts','_logger','139678gNZwuW','ENDPOINT_VQL','\x27,\x27','retrieveVPKList','toString','errors','set','map','from','_connection','3UtVQiu','VeevaResponseStatus','Getting\x20names\x20of\x20outbound\x20packages','VeevaConstants','deletePackageComponents','all','262889IqKyre','ENDPOINT_EXPORT_IMPORT_PACKAGE','name__v','executeVQL','parse','SUCCESS','post','Retrieve\x20Outbound\x20Package\x20zip\x20list','application/json','package_component__v','migration__sys','createExportOutboundPackages','deleteOutboundPackages','reduce','VeevaError','__importDefault','values'];a358_0x38c1=function(){return _0x5e221d;};return a358_0x38c1();}var __importDefault=this&&this[a358_0x46d43c(0x1b9)]||function(_0x2aad43){const _0x1d25b3=a358_0x46d43c;return _0x2aad43&&_0x2aad43[_0x1d25b3(0x1df)]?_0x2aad43:{'default':_0x2aad43};};Object['defineProperty'](exports,a358_0x46d43c(0x1df),{'value':!![]}),exports[a358_0x46d43c(0x1d8)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require(a358_0x46d43c(0x1de))),status_enums_1=require(a358_0x46d43c(0x1dc)),veeva_error_1=require(a358_0x46d43c(0x1d3));class PackageExportService{constructor({veevaService:_0x96a920,connection:_0x3d03bc,logger:_0x2c22bc}){const _0x4f775f=a358_0x46d43c;this['_veevaService']=_0x96a920,this[_0x4f775f(0x1f6)]=_0x3d03bc,this[_0x4f775f(0x1ec)]=_0x2c22bc;}async[a358_0x46d43c(0x1dd)](_0x568071,_0x5413d7){const _0x3a103a=a358_0x46d43c;this[_0x3a103a(0x1ec)]['log'](_0x3a103a(0x1e6));const _0x17f547=veeva_constants_1['VeevaConstants'][_0x3a103a(0x1d4)]+_0x3a103a(0x1be),_0x283307=new Array(_0x568071)[_0x3a103a(0x1d6)]({'summary__v':_0x5413d7,'object_type__v.api__name__v':_0x3a103a(0x1b4)});return await this[_0x3a103a(0x1d9)][_0x3a103a(0x1c2)](_0x17f547,_0x283307);}async[a358_0x46d43c(0x1e7)](_0xa0549a,_0x10a594){const _0x2a55a9=a358_0x46d43c;this[_0x2a55a9(0x1ec)][_0x2a55a9(0x1ca)](_0x2a55a9(0x1d7));const _0x25e61f=veeva_constants_1[_0x2a55a9(0x1fa)][_0x2a55a9(0x1d4)]+_0x2a55a9(0x1b3),_0xe342d9=_0xa0549a[_0x2a55a9(0x1f4)]((_0x626c3a,_0x18505b)=>({'vault_component__v':_0x626c3a['id'],'outbound_package__v':_0x10a594[Math[_0x2a55a9(0x1c4)]((_0x18505b+0x1)/veeva_constants_1[_0x2a55a9(0x1fa)][_0x2a55a9(0x1cc)])-0x1]}));return await this[_0x2a55a9(0x1d9)][_0x2a55a9(0x1c2)](_0x25e61f,_0xe342d9);}async[a358_0x46d43c(0x1db)](_0x616fc9){const _0x51326b=a358_0x46d43c;this[_0x51326b(0x1ec)]['log'](_0x51326b(0x1f9));const _0x15fba2='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x616fc9[_0x51326b(0x1c0)](_0x51326b(0x1ef))+'\x27)',_0x4ebf7b=veeva_constants_1[_0x51326b(0x1fa)][_0x51326b(0x1ee)]+_0x15fba2,_0x17f0f0=await this['_veevaService'][_0x51326b(0x1ad)](_0x4ebf7b);return _0x17f0f0[_0x51326b(0x1b7)]((_0x4a4c57,_0x2486f0)=>_0x4a4c57[_0x51326b(0x1f3)](_0x2486f0['id'],_0x2486f0[_0x51326b(0x1ac)]),new Map());}async[a358_0x46d43c(0x1b5)](_0x2b553f){const _0x54f299=a358_0x46d43c;this[_0x54f299(0x1ec)][_0x54f299(0x1ca)](_0x54f299(0x1cb));const _0xf9305a=[],_0x314a5a=_0x2b553f[_0x54f299(0x1f4)](_0x2aaeee=>{const _0x3bf758=_0x54f299;return this[_0x3bf758(0x1f6)][_0x3bf758(0x1b0)](veeva_constants_1[_0x3bf758(0x1fa)][_0x3bf758(0x1ab)],encodeURI('packageName')+'='+encodeURI(_0x2aaeee),{'headers':{'Content-Type':_0x3bf758(0x1e4)}});}),_0x54c05b=await Promise[_0x54f299(0x1a9)](_0x314a5a);for(const {data:_0x506245}of _0x54c05b){if(_0x506245['responseStatus']===status_enums_1[_0x54f299(0x1f8)][_0x54f299(0x1af)]){const {url:_0xd21abd}=_0x506245;_0xf9305a[_0x54f299(0x1ce)](_0xd21abd);}else throw new veeva_error_1[(_0x54f299(0x1b8))](_0x506245[_0x54f299(0x1f2)]);}return _0xf9305a;}async[a358_0x46d43c(0x1d1)](_0x478467){const _0x3c5941=a358_0x46d43c;this[_0x3c5941(0x1ec)]['log']('Retrieve\x20Jobs\x20Status');const _0x4d353a=[],_0x34206f=await this[_0x3c5941(0x1d9)][_0x3c5941(0x1e3)](_0x478467);for(const _0x3094c9 of _0x34206f){const _0x4bd223=_0x3094c9[_0x3c5941(0x1c1)][_0x3c5941(0x1c5)](_0x413ec7=>_0x413ec7[_0x3c5941(0x1bf)]===_0x3c5941(0x1eb))['map'](_0x4a884b=>_0x4a884b[_0x3c5941(0x1e0)]);_0x4d353a[_0x3c5941(0x1ce)](..._0x4bd223);}return _0x4d353a;}async[a358_0x46d43c(0x1f0)](_0x5ed3c8){const _0x465e3c=a358_0x46d43c;var _0x4c4ee7;const _0x123c8f=[];this[_0x465e3c(0x1ec)][_0x465e3c(0x1ca)](_0x465e3c(0x1b1));for(const _0x50224c of _0x5ed3c8){const {data:_0x398e53,headers:_0x5a6851}=await this[_0x465e3c(0x1f6)][_0x465e3c(0x1c7)](_0x50224c,{'responseType':_0x465e3c(0x1ea)}),_0x322a55=(_0x4c4ee7=_0x5a6851[_0x465e3c(0x1d0)])===null||_0x4c4ee7===void 0x0?void 0x0:_0x4c4ee7['includes'](_0x465e3c(0x1b2));if(!_0x322a55){const _0x3d0737=_0x398e53,_0x5a535a=new jszip_1['default']();await _0x5a535a[_0x465e3c(0x1da)](_0x3d0737),_0x123c8f[_0x465e3c(0x1ce)](_0x5a535a);}else{const _0x569869=JSON[_0x465e3c(0x1ae)](_0x398e53);throw new veeva_error_1[(_0x465e3c(0x1b8))](_0x569869[_0x465e3c(0x1f2)]);}}return _0x123c8f;}async[a358_0x46d43c(0x1a8)](_0x55904a){const _0x4aeff6=a358_0x46d43c;this[_0x4aeff6(0x1ec)][_0x4aeff6(0x1ca)](_0x4aeff6(0x1e2));const _0x445a44=veeva_constants_1[_0x4aeff6(0x1fa)][_0x4aeff6(0x1d4)]+_0x4aeff6(0x1b3);await this[_0x4aeff6(0x1d9)][_0x4aeff6(0x1c6)](_0x445a44,_0x55904a);}async[a358_0x46d43c(0x1b6)](_0x389523){const _0x5b01c0=a358_0x46d43c;this['_logger'][_0x5b01c0(0x1ca)]('Deleting\x20outbound\x20packages.');const _0x235108=veeva_constants_1['VeevaConstants'][_0x5b01c0(0x1d4)]+_0x5b01c0(0x1be);await this['_veevaService'][_0x5b01c0(0x1c6)](_0x235108,_0x389523);}async[a358_0x46d43c(0x1e8)](_0x574f30,_0x29e764){const _0x297620=a358_0x46d43c,_0x5eb4f8=await this['createOutboundPackages'](Math[_0x297620(0x1c4)](_0x574f30[_0x297620(0x1d5)]/veeva_constants_1[_0x297620(0x1fa)][_0x297620(0x1cc)]),_0x29e764),_0xc54a9d=await this['createPackageComponents'](_0x574f30,_0x5eb4f8),_0x3e974d=await this['getPackageNames'](_0x5eb4f8),_0x2cb6cf=await this[_0x297620(0x1b5)](Array[_0x297620(0x1f5)](_0x3e974d[_0x297620(0x1ba)]())),_0x260c0a=await this['getEndpointArtifactList'](_0x2cb6cf),_0x5db39b=await this[_0x297620(0x1f0)](_0x260c0a);return await this[_0x297620(0x1a8)](_0xc54a9d),await this[_0x297620(0x1b6)](_0x5eb4f8),_0x5db39b;}}exports[a358_0x46d43c(0x1d8)]=PackageExportService;