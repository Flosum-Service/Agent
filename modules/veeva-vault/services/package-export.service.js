const a374_0x5c778f=a374_0x4df5;(function(_0x10c671,_0x173a1d){const _0x342536=a374_0x4df5,_0xa8ab21=_0x10c671();while(!![]){try{const _0x176cbf=-parseInt(_0x342536(0x19a))/0x1+parseInt(_0x342536(0x198))/0x2*(-parseInt(_0x342536(0x1a4))/0x3)+-parseInt(_0x342536(0x18c))/0x4*(parseInt(_0x342536(0x176))/0x5)+-parseInt(_0x342536(0x18a))/0x6+parseInt(_0x342536(0x16c))/0x7+-parseInt(_0x342536(0x1a7))/0x8*(parseInt(_0x342536(0x196))/0x9)+parseInt(_0x342536(0x17e))/0xa*(parseInt(_0x342536(0x172))/0xb);if(_0x176cbf===_0x173a1d)break;else _0xa8ab21['push'](_0xa8ab21['shift']());}catch(_0x2b1bf3){_0xa8ab21['push'](_0xa8ab21['shift']());}}}(a374_0x5037,0x70915));const a374_0x129d3b=(function(){let _0x19502e=!![];return function(_0x19080d,_0x154d26){const _0xff899a=_0x19502e?function(){const _0x22a9d0=a374_0x4df5;if(_0x154d26){const _0xe66061=_0x154d26[_0x22a9d0(0x1b2)](_0x19080d,arguments);return _0x154d26=null,_0xe66061;}}:function(){};return _0x19502e=![],_0xff899a;};}()),a374_0x47319e=a374_0x129d3b(this,function(){const _0x58b6ba=a374_0x4df5;return a374_0x47319e['toString']()[_0x58b6ba(0x1a9)](_0x58b6ba(0x185))[_0x58b6ba(0x1aa)]()[_0x58b6ba(0x17a)](a374_0x47319e)[_0x58b6ba(0x1a9)](_0x58b6ba(0x185));});a374_0x47319e();'use strict';function a374_0x5037(){const _0x11b72d=['getPackageNames','values','44RulxeO','export','name__v','ceil','2430455YaOzYR','all','Adding\x20components\x20to\x20outbound\x20package','join','constructor','artifacts','__importDefault','PackageExportService','4506020mdSkww','package_component__v','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','VeevaError','deleteOutboundPackages','Retrieve\x20Jobs\x20Status','includes','(((.+)+)+)+$','__esModule','fill','Create\x20Export\x20outbound\x20packages.','jszip','3016770qCCACm','log','4PKggKU','loadAsync','_connection','Deleting\x20outbound\x20packages.','VeevaConstants','deleteVeevaObjectRecords','content-type','application/x-www-form-urlencoded','post','SUCCESS','426537eMaWBP','responseStatus','2fIYvTL','set','177391kSaeYX','executeVQL','../classes/errors/veeva-error','Getting\x20names\x20of\x20outbound\x20packages','../enums/status.enums','MAXIMUM_SIZE_OF_PACKAGE','createPackageComponents','createVeevaObjectRecords','_logger','get','1775106aXVtEC','rel','push','80pXxzaO','Removing\x20components\x20from\x20outbound\x20packages.','search','toString','ENDPOINT_EXPORT_IMPORT_PACKAGE','outbound_package__v','createOutboundPackages','reduce','retrieveVPKList','links','map','apply','deletePackageComponents','errors','from','filter','Creating\x20outbound\x20packages','ENDPOINT_CREATE_RECORDS','6234046CvWGvO','createExportOutboundPackages','_veevaService','getEndpointArtifactList'];a374_0x5037=function(){return _0x11b72d;};return a374_0x5037();}var __importDefault=this&&this[a374_0x5c778f(0x17c)]||function(_0x255fa0){return _0x255fa0&&_0x255fa0['__esModule']?_0x255fa0:{'default':_0x255fa0};};Object['defineProperty'](exports,a374_0x5c778f(0x186),{'value':!![]}),exports[a374_0x5c778f(0x17d)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require(a374_0x5c778f(0x189))),status_enums_1=require(a374_0x5c778f(0x19e)),veeva_error_1=require(a374_0x5c778f(0x19c));function a374_0x4df5(_0x1f39f5,_0x423d53){const _0x1d54f0=a374_0x5037();return a374_0x4df5=function(_0x47319e,_0x129d3b){_0x47319e=_0x47319e-0x166;let _0x503729=_0x1d54f0[_0x47319e];return _0x503729;},a374_0x4df5(_0x1f39f5,_0x423d53);}class PackageExportService{constructor({veevaService:_0xe29d86,connection:_0x53b2bf,logger:_0x189819}){const _0x36b6b0=a374_0x5c778f;this['_veevaService']=_0xe29d86,this[_0x36b6b0(0x18e)]=_0x53b2bf,this[_0x36b6b0(0x1a2)]=_0x189819;}async[a374_0x5c778f(0x1ad)](_0x4d4858,_0x30c5d3){const _0x181127=a374_0x5c778f;this[_0x181127(0x1a2)][_0x181127(0x18b)](_0x181127(0x16a));const _0x3ad463=veeva_constants_1[_0x181127(0x190)][_0x181127(0x16b)]+_0x181127(0x1ac),_0x1e75d7=new Array(_0x4d4858)[_0x181127(0x187)]({'summary__v':_0x30c5d3,'object_type__v.api__name__v':'migration__sys'});return await this['_veevaService'][_0x181127(0x1a1)](_0x3ad463,_0x1e75d7);}async[a374_0x5c778f(0x1a0)](_0x468761,_0x9832a7){const _0x32f0ec=a374_0x5c778f;this['_logger']['log'](_0x32f0ec(0x178));const _0x2dcb2d=veeva_constants_1[_0x32f0ec(0x190)][_0x32f0ec(0x16b)]+_0x32f0ec(0x17f),_0xe1e5d4=_0x468761['map']((_0x31534f,_0x4972bb)=>({'vault_component__v':_0x31534f['id'],'outbound_package__v':_0x9832a7[Math[_0x32f0ec(0x175)]((_0x4972bb+0x1)/veeva_constants_1[_0x32f0ec(0x190)][_0x32f0ec(0x19f)])-0x1]}));return await this[_0x32f0ec(0x16e)][_0x32f0ec(0x1a1)](_0x2dcb2d,_0xe1e5d4);}async[a374_0x5c778f(0x170)](_0x12eb22){const _0x25c3ae=a374_0x5c778f;this[_0x25c3ae(0x1a2)][_0x25c3ae(0x18b)](_0x25c3ae(0x19d));const _0x4692a8=_0x25c3ae(0x180)+_0x12eb22[_0x25c3ae(0x179)]('\x27,\x27')+'\x27)',_0x5dc771=await this[_0x25c3ae(0x16e)][_0x25c3ae(0x19b)](_0x4692a8);return _0x5dc771[_0x25c3ae(0x1ae)]((_0x5cb636,_0x159d76)=>_0x5cb636[_0x25c3ae(0x199)](_0x159d76['id'],_0x159d76[_0x25c3ae(0x174)]),new Map());}async[a374_0x5c778f(0x16d)](_0x4587e2){const _0x51ea46=a374_0x5c778f;this[_0x51ea46(0x1a2)][_0x51ea46(0x18b)](_0x51ea46(0x188));const _0x7a4a7d=[],_0x439e7f=_0x4587e2[_0x51ea46(0x1b1)](_0x4fe11b=>{const _0x19f218=_0x51ea46;return this[_0x19f218(0x18e)][_0x19f218(0x194)](veeva_constants_1[_0x19f218(0x190)][_0x19f218(0x1ab)],encodeURI('packageName')+'='+encodeURI(_0x4fe11b),{'headers':{'Content-Type':_0x19f218(0x193)}});}),_0x40c7bf=await Promise[_0x51ea46(0x177)](_0x439e7f);for(const {data:_0x34cc6a}of _0x40c7bf){if(_0x34cc6a[_0x51ea46(0x197)]===status_enums_1['VeevaResponseStatus'][_0x51ea46(0x195)]){const {url:_0x487893}=_0x34cc6a;_0x7a4a7d['push'](_0x487893);}else throw new veeva_error_1[(_0x51ea46(0x181))](_0x34cc6a[_0x51ea46(0x167)]);}return _0x7a4a7d;}async[a374_0x5c778f(0x16f)](_0x1f1056){const _0xc69891=a374_0x5c778f;this[_0xc69891(0x1a2)]['log'](_0xc69891(0x183));const _0x34f55b=[],_0x251e7e=await this[_0xc69891(0x16e)]['getJobResult'](_0x1f1056);for(const _0x44d154 of _0x251e7e){const _0x86507d=_0x44d154[_0xc69891(0x1b0)][_0xc69891(0x169)](_0x372a32=>_0x372a32[_0xc69891(0x1a5)]===_0xc69891(0x17b))[_0xc69891(0x1b1)](_0xb7a1c5=>_0xb7a1c5['href']);_0x34f55b['push'](..._0x86507d);}return _0x34f55b;}async[a374_0x5c778f(0x1af)](_0x435acf){const _0x5654ad=a374_0x5c778f;var _0x426162;const _0xffb74b=[];this[_0x5654ad(0x1a2)]['log']('Retrieve\x20Outbound\x20Package\x20zip\x20list');for(const _0x4d39b8 of _0x435acf){const {data:_0x5aa358,headers:_0x15ddd6}=await this[_0x5654ad(0x18e)][_0x5654ad(0x1a3)](_0x4d39b8,{'responseType':'arraybuffer'}),_0x3e7a14=(_0x426162=_0x15ddd6[_0x5654ad(0x192)])===null||_0x426162===void 0x0?void 0x0:_0x426162[_0x5654ad(0x184)]('application/json');if(!_0x3e7a14){const _0x5133a8=_0x5aa358,_0x1d5de8=new jszip_1['default']();await _0x1d5de8[_0x5654ad(0x18d)](_0x5133a8),_0xffb74b[_0x5654ad(0x1a6)](_0x1d5de8);}else{const _0x5d55da=JSON['parse'](_0x5aa358);throw new veeva_error_1[(_0x5654ad(0x181))](_0x5d55da[_0x5654ad(0x167)]);}}return _0xffb74b;}async['deletePackageComponents'](_0x20b172){const _0x3f2b1d=a374_0x5c778f;this[_0x3f2b1d(0x1a2)][_0x3f2b1d(0x18b)](_0x3f2b1d(0x1a8));const _0x50d872=veeva_constants_1[_0x3f2b1d(0x190)][_0x3f2b1d(0x16b)]+'package_component__v';await this[_0x3f2b1d(0x16e)][_0x3f2b1d(0x191)](_0x50d872,_0x20b172);}async[a374_0x5c778f(0x182)](_0x1a141b){const _0x35de09=a374_0x5c778f;this[_0x35de09(0x1a2)][_0x35de09(0x18b)](_0x35de09(0x18f));const _0x2af41d=veeva_constants_1[_0x35de09(0x190)][_0x35de09(0x16b)]+_0x35de09(0x1ac);await this[_0x35de09(0x16e)]['deleteVeevaObjectRecords'](_0x2af41d,_0x1a141b);}async[a374_0x5c778f(0x173)](_0x4abce2,_0x2e1872){const _0x1bd686=a374_0x5c778f,_0x32d512=await this[_0x1bd686(0x1ad)](Math[_0x1bd686(0x175)](_0x4abce2['length']/veeva_constants_1['VeevaConstants'][_0x1bd686(0x19f)]),_0x2e1872),_0xae3eab=await this[_0x1bd686(0x1a0)](_0x4abce2,_0x32d512),_0x51f72c=await this[_0x1bd686(0x170)](_0x32d512),_0x35129b=await this['createExportOutboundPackages'](Array[_0x1bd686(0x168)](_0x51f72c[_0x1bd686(0x171)]())),_0x4d1475=await this[_0x1bd686(0x16f)](_0x35129b),_0xada5ad=await this['retrieveVPKList'](_0x4d1475);return await this[_0x1bd686(0x166)](_0xae3eab),await this['deleteOutboundPackages'](_0x32d512),_0xada5ad;}}exports[a374_0x5c778f(0x17d)]=PackageExportService;