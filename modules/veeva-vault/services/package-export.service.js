const a402_0x25a60d=a402_0x415e;(function(_0x3aaeea,_0x53d3f5){const _0x1a8578=a402_0x415e,_0x582dd9=_0x3aaeea();while(!![]){try{const _0x56cd58=parseInt(_0x1a8578(0x1a5))/0x1*(parseInt(_0x1a8578(0x191))/0x2)+parseInt(_0x1a8578(0x19e))/0x3*(parseInt(_0x1a8578(0x1a2))/0x4)+parseInt(_0x1a8578(0x199))/0x5+parseInt(_0x1a8578(0x1ad))/0x6*(-parseInt(_0x1a8578(0x1b3))/0x7)+-parseInt(_0x1a8578(0x1cc))/0x8*(-parseInt(_0x1a8578(0x1a3))/0x9)+parseInt(_0x1a8578(0x1a1))/0xa+-parseInt(_0x1a8578(0x1b8))/0xb*(parseInt(_0x1a8578(0x1d3))/0xc);if(_0x56cd58===_0x53d3f5)break;else _0x582dd9['push'](_0x582dd9['shift']());}catch(_0x2893d1){_0x582dd9['push'](_0x582dd9['shift']());}}}(a402_0xc8a8,0xa472b));const a402_0x25a9ca=(function(){let _0x1eee7f=!![];return function(_0x4d078e,_0x2eaaaa){const _0xa95400=_0x1eee7f?function(){const _0x3ab642=a402_0x415e;if(_0x2eaaaa){const _0x5b67c7=_0x2eaaaa[_0x3ab642(0x1a0)](_0x4d078e,arguments);return _0x2eaaaa=null,_0x5b67c7;}}:function(){};return _0x1eee7f=![],_0xa95400;};}()),a402_0x5bb2a0=a402_0x25a9ca(this,function(){const _0x51df19=a402_0x415e;return a402_0x5bb2a0[_0x51df19(0x1ac)]()[_0x51df19(0x1b5)](_0x51df19(0x192))[_0x51df19(0x1ac)]()[_0x51df19(0x18c)](a402_0x5bb2a0)[_0x51df19(0x1b5)](_0x51df19(0x192));});function a402_0xc8a8(){const _0xef120e=['artifacts','254DEfPPv','post','packageName','../constants/veeva.constants','SUCCESS','_connection','Removing\x20components\x20from\x20outbound\x20packages.','toString','330hrCXIu','VeevaError','ENDPOINT_CREATE_RECORDS','reduce','parse','createPackageComponents','154105lNPLom','Deleting\x20outbound\x20packages.','search','map','log','121PmoxsY','getEndpointArtifactList','ENDPOINT_EXPORT_IMPORT_PACKAGE','__importDefault','__esModule','getJobResult','ceil','length','defineProperty','deletePackageComponents','join','getPackageNames','Creating\x20outbound\x20packages','package_component__v','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','migration__sys','application/x-www-form-urlencoded','deleteOutboundPackages','rel','_veevaService','8tFDvHX','export','get','MAXIMUM_SIZE_OF_PACKAGE','set','deleteVeevaObjectRecords','Retrieve\x20Jobs\x20Status','1869828QoDBAg','Getting\x20names\x20of\x20outbound\x20packages','_logger','filter','constructor','push','values','href','PackageExportService','998kqjQYx','(((.+)+)+)+$','VeevaConstants','jszip','Create\x20Export\x20outbound\x20packages.','outbound_package__v','../classes/errors/veeva-error','all','1129020oOIgfc','application/json','Retrieve\x20Outbound\x20Package\x20zip\x20list','includes','createVeevaObjectRecords','1318899VqyCxw','arraybuffer','apply','12854310dtYjTO','8uOofLV','9730494MQtiPN'];a402_0xc8a8=function(){return _0xef120e;};return a402_0xc8a8();}a402_0x5bb2a0();'use strict';var __importDefault=this&&this[a402_0x25a60d(0x1bb)]||function(_0x1ade15){const _0xc6d6f1=a402_0x25a60d;return _0x1ade15&&_0x1ade15[_0xc6d6f1(0x1bc)]?_0x1ade15:{'default':_0x1ade15};};Object[a402_0x25a60d(0x1c0)](exports,a402_0x25a60d(0x1bc),{'value':!![]}),exports[a402_0x25a60d(0x190)]=void 0x0;const veeva_constants_1=require(a402_0x25a60d(0x1a8)),jszip_1=__importDefault(require(a402_0x25a60d(0x194))),status_enums_1=require('../enums/status.enums'),veeva_error_1=require(a402_0x25a60d(0x197));function a402_0x415e(_0x46a3c0,_0x4552e8){const _0x2be6ee=a402_0xc8a8();return a402_0x415e=function(_0x5bb2a0,_0x25a9ca){_0x5bb2a0=_0x5bb2a0-0x18a;let _0xc8a84a=_0x2be6ee[_0x5bb2a0];return _0xc8a84a;},a402_0x415e(_0x46a3c0,_0x4552e8);}class PackageExportService{constructor({veevaService:_0x415e82,connection:_0x16ac17,logger:_0x7b6c76}){const _0x1785b8=a402_0x25a60d;this[_0x1785b8(0x1cb)]=_0x415e82,this[_0x1785b8(0x1aa)]=_0x16ac17,this[_0x1785b8(0x18a)]=_0x7b6c76;}async['createOutboundPackages'](_0x34293c,_0x20e3e2){const _0x40f1c8=a402_0x25a60d;this[_0x40f1c8(0x18a)][_0x40f1c8(0x1b7)](_0x40f1c8(0x1c4));const _0x211b98=veeva_constants_1[_0x40f1c8(0x193)][_0x40f1c8(0x1af)]+_0x40f1c8(0x196),_0x706388=new Array(_0x34293c)['fill']({'summary__v':_0x20e3e2,'object_type__v.api__name__v':_0x40f1c8(0x1c7)});return await this['_veevaService'][_0x40f1c8(0x19d)](_0x211b98,_0x706388);}async[a402_0x25a60d(0x1b2)](_0x1ccab5,_0x4b965e){const _0x4198bb=a402_0x25a60d;this[_0x4198bb(0x18a)][_0x4198bb(0x1b7)]('Adding\x20components\x20to\x20outbound\x20package');const _0x5a7304=veeva_constants_1['VeevaConstants'][_0x4198bb(0x1af)]+_0x4198bb(0x1c5),_0x4391ac=_0x1ccab5[_0x4198bb(0x1b6)]((_0x572f67,_0x16e265)=>({'vault_component__v':_0x572f67['id'],'outbound_package__v':_0x4b965e[Math[_0x4198bb(0x1be)]((_0x16e265+0x1)/veeva_constants_1[_0x4198bb(0x193)][_0x4198bb(0x1cf)])-0x1]}));return await this[_0x4198bb(0x1cb)][_0x4198bb(0x19d)](_0x5a7304,_0x4391ac);}async[a402_0x25a60d(0x1c3)](_0x2075f8){const _0x2bb613=a402_0x25a60d;this[_0x2bb613(0x18a)][_0x2bb613(0x1b7)](_0x2bb613(0x1d4));const _0x57dd70=_0x2bb613(0x1c6)+_0x2075f8[_0x2bb613(0x1c2)]('\x27,\x27')+'\x27)',_0x54e96d=await this['_veevaService']['executeVQL'](_0x57dd70);return _0x54e96d[_0x2bb613(0x1b0)]((_0x523686,_0x490894)=>_0x523686[_0x2bb613(0x1d0)](_0x490894['id'],_0x490894['name__v']),new Map());}async['createExportOutboundPackages'](_0x518f3a){const _0x5b2ff1=a402_0x25a60d;this[_0x5b2ff1(0x18a)][_0x5b2ff1(0x1b7)](_0x5b2ff1(0x195));const _0x1ac19d=[],_0x5e8c02=_0x518f3a[_0x5b2ff1(0x1b6)](_0x27afa8=>{const _0xb3b242=_0x5b2ff1;return this[_0xb3b242(0x1aa)][_0xb3b242(0x1a6)](veeva_constants_1[_0xb3b242(0x193)][_0xb3b242(0x1ba)],encodeURI(_0xb3b242(0x1a7))+'='+encodeURI(_0x27afa8),{'headers':{'Content-Type':_0xb3b242(0x1c8)}});}),_0x35eff0=await Promise[_0x5b2ff1(0x198)](_0x5e8c02);for(const {data:_0x3c4707}of _0x35eff0){if(_0x3c4707['responseStatus']===status_enums_1['VeevaResponseStatus'][_0x5b2ff1(0x1a9)]){const {url:_0x59d1dc}=_0x3c4707;_0x1ac19d[_0x5b2ff1(0x18d)](_0x59d1dc);}else throw new veeva_error_1[(_0x5b2ff1(0x1ae))](_0x3c4707['errors']);}return _0x1ac19d;}async[a402_0x25a60d(0x1b9)](_0x2e9758){const _0x500d49=a402_0x25a60d;this['_logger'][_0x500d49(0x1b7)](_0x500d49(0x1d2));const _0x59832f=[],_0x3d741c=await this[_0x500d49(0x1cb)][_0x500d49(0x1bd)](_0x2e9758);for(const _0x41ca02 of _0x3d741c){const _0x5b5430=_0x41ca02['links'][_0x500d49(0x18b)](_0xa631b2=>_0xa631b2[_0x500d49(0x1ca)]===_0x500d49(0x1a4))['map'](_0x19f7c7=>_0x19f7c7[_0x500d49(0x18f)]);_0x59832f[_0x500d49(0x18d)](..._0x5b5430);}return _0x59832f;}async['retrieveVPKList'](_0x342136){const _0x2d4074=a402_0x25a60d;var _0x3e0ab0;const _0x14029a=[];this[_0x2d4074(0x18a)][_0x2d4074(0x1b7)](_0x2d4074(0x19b));for(const _0x3620a1 of _0x342136){const {data:_0x8cc310,headers:_0x10b471}=await this[_0x2d4074(0x1aa)][_0x2d4074(0x1ce)](_0x3620a1,{'responseType':_0x2d4074(0x19f)}),_0x5503b5=(_0x3e0ab0=_0x10b471['content-type'])===null||_0x3e0ab0===void 0x0?void 0x0:_0x3e0ab0[_0x2d4074(0x19c)](_0x2d4074(0x19a));if(!_0x5503b5){const _0x40fde2=_0x8cc310,_0x25ba00=new jszip_1['default']();await _0x25ba00['loadAsync'](_0x40fde2),_0x14029a['push'](_0x25ba00);}else{const _0x524abe=JSON[_0x2d4074(0x1b1)](_0x8cc310);throw new veeva_error_1[(_0x2d4074(0x1ae))](_0x524abe['errors']);}}return _0x14029a;}async[a402_0x25a60d(0x1c1)](_0x648ee6){const _0x51cfe5=a402_0x25a60d;this['_logger'][_0x51cfe5(0x1b7)](_0x51cfe5(0x1ab));const _0xd2fc65=veeva_constants_1[_0x51cfe5(0x193)]['ENDPOINT_CREATE_RECORDS']+_0x51cfe5(0x1c5);await this[_0x51cfe5(0x1cb)][_0x51cfe5(0x1d1)](_0xd2fc65,_0x648ee6);}async[a402_0x25a60d(0x1c9)](_0x3a1f4d){const _0x5a57a9=a402_0x25a60d;this[_0x5a57a9(0x18a)][_0x5a57a9(0x1b7)](_0x5a57a9(0x1b4));const _0x2ca83a=veeva_constants_1[_0x5a57a9(0x193)]['ENDPOINT_CREATE_RECORDS']+_0x5a57a9(0x196);await this[_0x5a57a9(0x1cb)][_0x5a57a9(0x1d1)](_0x2ca83a,_0x3a1f4d);}async[a402_0x25a60d(0x1cd)](_0x1f32c7,_0x4400e1){const _0x1d958c=a402_0x25a60d,_0x130381=await this['createOutboundPackages'](Math[_0x1d958c(0x1be)](_0x1f32c7[_0x1d958c(0x1bf)]/veeva_constants_1[_0x1d958c(0x193)][_0x1d958c(0x1cf)]),_0x4400e1),_0x32bc2f=await this[_0x1d958c(0x1b2)](_0x1f32c7,_0x130381),_0x359ede=await this['getPackageNames'](_0x130381),_0x147b9a=await this['createExportOutboundPackages'](Array['from'](_0x359ede[_0x1d958c(0x18e)]())),_0x4d5b71=await this[_0x1d958c(0x1b9)](_0x147b9a),_0x3430fc=await this['retrieveVPKList'](_0x4d5b71);return await this[_0x1d958c(0x1c1)](_0x32bc2f),await this['deleteOutboundPackages'](_0x130381),_0x3430fc;}}exports[a402_0x25a60d(0x190)]=PackageExportService;