const a358_0x5c1c8e=a358_0xc481;(function(_0x560a14,_0x16451c){const _0x2e2028=a358_0xc481,_0x1791d8=_0x560a14();while(!![]){try{const _0x1a82c2=parseInt(_0x2e2028(0x1ab))/0x1+-parseInt(_0x2e2028(0x178))/0x2+parseInt(_0x2e2028(0x198))/0x3+-parseInt(_0x2e2028(0x196))/0x4+parseInt(_0x2e2028(0x16c))/0x5+parseInt(_0x2e2028(0x1a2))/0x6*(-parseInt(_0x2e2028(0x17d))/0x7)+parseInt(_0x2e2028(0x18d))/0x8;if(_0x1a82c2===_0x16451c)break;else _0x1791d8['push'](_0x1791d8['shift']());}catch(_0x1e96cd){_0x1791d8['push'](_0x1791d8['shift']());}}}(a358_0x5cb8,0xc9e76));const a358_0x2bb99a=(function(){let _0x32a4fe=!![];return function(_0x3f8b2b,_0x368e53){const _0x406435=_0x32a4fe?function(){const _0x272c9e=a358_0xc481;if(_0x368e53){const _0x20c311=_0x368e53[_0x272c9e(0x16b)](_0x3f8b2b,arguments);return _0x368e53=null,_0x20c311;}}:function(){};return _0x32a4fe=![],_0x406435;};}()),a358_0x3c87d9=a358_0x2bb99a(this,function(){const _0x40aa9d=a358_0xc481;return a358_0x3c87d9['toString']()[_0x40aa9d(0x173)](_0x40aa9d(0x18f))[_0x40aa9d(0x17b)]()[_0x40aa9d(0x19e)](a358_0x3c87d9)[_0x40aa9d(0x173)](_0x40aa9d(0x18f));});function a358_0x5cb8(){const _0x16b175=['Adding\x20components\x20to\x20outbound\x20package','packageName','search','_connection','name__v','getEndpointArtifactList','createPackageComponents','2082730JEfSUk','executeVQL','ceil','toString','errors','630cXqTCa','deleteOutboundPackages','jszip','retrieveVPKList','_veevaService','includes','arraybuffer','../classes/errors/veeva-error','__importDefault','Retrieve\x20Jobs\x20Status','application/x-www-form-urlencoded','get','reduce','Retrieve\x20Outbound\x20Package\x20zip\x20list','links','push','2251000CdnmjU','length','(((.+)+)+)+$','outbound_package__v','Deleting\x20outbound\x20packages.','deletePackageComponents','getJobResult','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','PackageExportService','153840zozVud','fill','2402151fscVKT','join','package_component__v','createExportOutboundPackages','values','artifacts','constructor','VeevaConstants','__esModule','default','53292jiSgRg','href','rel','application/json','ENDPOINT_VQL','set','all','../constants/veeva.constants','migration__sys','396651RJsgoX','Removing\x20components\x20from\x20outbound\x20packages.','getPackageNames','from','map','responseStatus','VeevaError','parse','createVeevaObjectRecords','log','deleteVeevaObjectRecords','_logger','createOutboundPackages','post','export','apply','6137300nNwDKJ','Create\x20Export\x20outbound\x20packages.','MAXIMUM_SIZE_OF_PACKAGE','loadAsync','ENDPOINT_CREATE_RECORDS'];a358_0x5cb8=function(){return _0x16b175;};return a358_0x5cb8();}a358_0x3c87d9();'use strict';var __importDefault=this&&this[a358_0x5c1c8e(0x185)]||function(_0x5c07b7){const _0x125093=a358_0x5c1c8e;return _0x5c07b7&&_0x5c07b7[_0x125093(0x1a0)]?_0x5c07b7:{'default':_0x5c07b7};};Object['defineProperty'](exports,a358_0x5c1c8e(0x1a0),{'value':!![]}),exports[a358_0x5c1c8e(0x195)]=void 0x0;function a358_0xc481(_0x21610f,_0x5d13a1){const _0x5849de=a358_0x5cb8();return a358_0xc481=function(_0x3c87d9,_0x2bb99a){_0x3c87d9=_0x3c87d9-0x16a;let _0x5cb81e=_0x5849de[_0x3c87d9];return _0x5cb81e;},a358_0xc481(_0x21610f,_0x5d13a1);}const veeva_constants_1=require(a358_0x5c1c8e(0x1a9)),jszip_1=__importDefault(require(a358_0x5c1c8e(0x17f))),status_enums_1=require('../enums/status.enums'),veeva_error_1=require(a358_0x5c1c8e(0x184));class PackageExportService{constructor({veevaService:_0x21f26e,connection:_0x16cd1a,logger:_0x472c4e}){const _0x4855e0=a358_0x5c1c8e;this['_veevaService']=_0x21f26e,this[_0x4855e0(0x174)]=_0x16cd1a,this['_logger']=_0x472c4e;}async[a358_0x5c1c8e(0x1b7)](_0x20f6ba,_0xf37f7){const _0x55dd77=a358_0x5c1c8e;this['_logger'][_0x55dd77(0x1b4)]('Creating\x20outbound\x20packages');const _0x5b6d77=veeva_constants_1[_0x55dd77(0x19f)][_0x55dd77(0x170)]+_0x55dd77(0x190),_0x1f38ad=new Array(_0x20f6ba)[_0x55dd77(0x197)]({'summary__v':_0xf37f7,'object_type__v.api__name__v':_0x55dd77(0x1aa)});return await this['_veevaService'][_0x55dd77(0x1b3)](_0x5b6d77,_0x1f38ad);}async[a358_0x5c1c8e(0x177)](_0x2a1e82,_0x10f369){const _0xe9a825=a358_0x5c1c8e;this['_logger'][_0xe9a825(0x1b4)](_0xe9a825(0x171));const _0x4e4026=veeva_constants_1[_0xe9a825(0x19f)][_0xe9a825(0x170)]+_0xe9a825(0x19a),_0x32f253=_0x2a1e82[_0xe9a825(0x1af)]((_0xaf55c5,_0x22f898)=>({'vault_component__v':_0xaf55c5['id'],'outbound_package__v':_0x10f369[Math['ceil']((_0x22f898+0x1)/veeva_constants_1[_0xe9a825(0x19f)][_0xe9a825(0x16e)])-0x1]}));return await this[_0xe9a825(0x181)][_0xe9a825(0x1b3)](_0x4e4026,_0x32f253);}async[a358_0x5c1c8e(0x1ad)](_0x3786b2){const _0x30cfc3=a358_0x5c1c8e;this[_0x30cfc3(0x1b6)][_0x30cfc3(0x1b4)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x356dcf=_0x30cfc3(0x194)+_0x3786b2[_0x30cfc3(0x199)]('\x27,\x27')+'\x27)',_0x504dbc=veeva_constants_1[_0x30cfc3(0x19f)][_0x30cfc3(0x1a6)]+_0x356dcf,_0x1c88a8=await this[_0x30cfc3(0x181)][_0x30cfc3(0x179)](_0x504dbc);return _0x1c88a8[_0x30cfc3(0x189)]((_0x296278,_0x2ae111)=>_0x296278[_0x30cfc3(0x1a7)](_0x2ae111['id'],_0x2ae111[_0x30cfc3(0x175)]),new Map());}async[a358_0x5c1c8e(0x19b)](_0x45e82a){const _0x56e912=a358_0x5c1c8e;this[_0x56e912(0x1b6)][_0x56e912(0x1b4)](_0x56e912(0x16d));const _0x38ecce=[],_0x33088a=_0x45e82a[_0x56e912(0x1af)](_0x165448=>{const _0xbf82a3=_0x56e912;return this['_connection'][_0xbf82a3(0x1b8)](veeva_constants_1['VeevaConstants']['ENDPOINT_EXPORT_IMPORT_PACKAGE'],encodeURI(_0xbf82a3(0x172))+'='+encodeURI(_0x165448),{'headers':{'Content-Type':_0xbf82a3(0x187)}});}),_0x4673fc=await Promise[_0x56e912(0x1a8)](_0x33088a);for(const {data:_0x2cfbc9}of _0x4673fc){if(_0x2cfbc9[_0x56e912(0x1b0)]===status_enums_1['VeevaResponseStatus']['SUCCESS']){const {url:_0x90b144}=_0x2cfbc9;_0x38ecce[_0x56e912(0x18c)](_0x90b144);}else throw new veeva_error_1[(_0x56e912(0x1b1))](_0x2cfbc9[_0x56e912(0x17c)]);}return _0x38ecce;}async['getEndpointArtifactList'](_0x51c612){const _0x4d2ad1=a358_0x5c1c8e;this[_0x4d2ad1(0x1b6)]['log'](_0x4d2ad1(0x186));const _0x57ac12=[],_0x352f44=await this[_0x4d2ad1(0x181)][_0x4d2ad1(0x193)](_0x51c612);for(const _0x1bd1e0 of _0x352f44){const _0x1407d1=_0x1bd1e0[_0x4d2ad1(0x18b)]['filter'](_0x1f17ce=>_0x1f17ce[_0x4d2ad1(0x1a4)]===_0x4d2ad1(0x19d))['map'](_0x2bf64c=>_0x2bf64c[_0x4d2ad1(0x1a3)]);_0x57ac12[_0x4d2ad1(0x18c)](..._0x1407d1);}return _0x57ac12;}async[a358_0x5c1c8e(0x180)](_0x395c1c){const _0x1ea03e=a358_0x5c1c8e;var _0x221cc5;const _0xf5c08a=[];this[_0x1ea03e(0x1b6)][_0x1ea03e(0x1b4)](_0x1ea03e(0x18a));for(const _0x3193a7 of _0x395c1c){const {data:_0x2cabf4,headers:_0x1bc5f7}=await this[_0x1ea03e(0x174)][_0x1ea03e(0x188)](_0x3193a7,{'responseType':_0x1ea03e(0x183)}),_0x5d2da8=(_0x221cc5=_0x1bc5f7['content-type'])===null||_0x221cc5===void 0x0?void 0x0:_0x221cc5[_0x1ea03e(0x182)](_0x1ea03e(0x1a5));if(!_0x5d2da8){const _0x47839a=_0x2cabf4,_0x3db40c=new jszip_1[(_0x1ea03e(0x1a1))]();await _0x3db40c[_0x1ea03e(0x16f)](_0x47839a),_0xf5c08a['push'](_0x3db40c);}else{const _0x5cefd3=JSON[_0x1ea03e(0x1b2)](_0x2cabf4);throw new veeva_error_1[(_0x1ea03e(0x1b1))](_0x5cefd3[_0x1ea03e(0x17c)]);}}return _0xf5c08a;}async[a358_0x5c1c8e(0x192)](_0x50ee89){const _0x99a0a6=a358_0x5c1c8e;this[_0x99a0a6(0x1b6)][_0x99a0a6(0x1b4)](_0x99a0a6(0x1ac));const _0x1a6535=veeva_constants_1[_0x99a0a6(0x19f)][_0x99a0a6(0x170)]+_0x99a0a6(0x19a);await this['_veevaService'][_0x99a0a6(0x1b5)](_0x1a6535,_0x50ee89);}async[a358_0x5c1c8e(0x17e)](_0x470ebc){const _0x2c916d=a358_0x5c1c8e;this[_0x2c916d(0x1b6)]['log'](_0x2c916d(0x191));const _0x435b74=veeva_constants_1[_0x2c916d(0x19f)][_0x2c916d(0x170)]+_0x2c916d(0x190);await this['_veevaService'][_0x2c916d(0x1b5)](_0x435b74,_0x470ebc);}async[a358_0x5c1c8e(0x16a)](_0x464284,_0x2de57e){const _0x20f339=a358_0x5c1c8e,_0x39c8e5=await this[_0x20f339(0x1b7)](Math[_0x20f339(0x17a)](_0x464284[_0x20f339(0x18e)]/veeva_constants_1[_0x20f339(0x19f)][_0x20f339(0x16e)]),_0x2de57e),_0xf04bb8=await this[_0x20f339(0x177)](_0x464284,_0x39c8e5),_0x45dac8=await this[_0x20f339(0x1ad)](_0x39c8e5),_0x2968=await this[_0x20f339(0x19b)](Array[_0x20f339(0x1ae)](_0x45dac8[_0x20f339(0x19c)]())),_0x587de4=await this[_0x20f339(0x176)](_0x2968),_0x4afd3a=await this['retrieveVPKList'](_0x587de4);return await this[_0x20f339(0x192)](_0xf04bb8),await this[_0x20f339(0x17e)](_0x39c8e5),_0x4afd3a;}}exports['PackageExportService']=PackageExportService;