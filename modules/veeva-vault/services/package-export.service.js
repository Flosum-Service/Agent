const a359_0xbd30d4=a359_0x2c6c;(function(_0x318ef0,_0x105279){const _0x4b127f=a359_0x2c6c,_0x11f6b3=_0x318ef0();while(!![]){try{const _0x14a023=parseInt(_0x4b127f(0xeb))/0x1+-parseInt(_0x4b127f(0x114))/0x2+-parseInt(_0x4b127f(0xf4))/0x3+parseInt(_0x4b127f(0xd5))/0x4+parseInt(_0x4b127f(0xfb))/0x5+parseInt(_0x4b127f(0xce))/0x6*(parseInt(_0x4b127f(0xf2))/0x7)+-parseInt(_0x4b127f(0xf3))/0x8;if(_0x14a023===_0x105279)break;else _0x11f6b3['push'](_0x11f6b3['shift']());}catch(_0x225779){_0x11f6b3['push'](_0x11f6b3['shift']());}}}(a359_0x503d,0xc53ed));const a359_0x48d5c4=(function(){let _0x1bdc66=!![];return function(_0x220047,_0x4f1d9d){const _0x23863d=_0x1bdc66?function(){const _0xd1cc0f=a359_0x2c6c;if(_0x4f1d9d){const _0x273d1d=_0x4f1d9d[_0xd1cc0f(0x108)](_0x220047,arguments);return _0x4f1d9d=null,_0x273d1d;}}:function(){};return _0x1bdc66=![],_0x23863d;};}()),a359_0x9d8fce=a359_0x48d5c4(this,function(){const _0x4bdc4f=a359_0x2c6c;return a359_0x9d8fce[_0x4bdc4f(0xf8)]()[_0x4bdc4f(0xf9)](_0x4bdc4f(0xe4))['toString']()[_0x4bdc4f(0xfa)](a359_0x9d8fce)[_0x4bdc4f(0xf9)](_0x4bdc4f(0xe4));});a359_0x9d8fce();'use strict';function a359_0x2c6c(_0x22b7ab,_0x2cfded){const _0x459fde=a359_0x503d();return a359_0x2c6c=function(_0x9d8fce,_0x48d5c4){_0x9d8fce=_0x9d8fce-0xca;let _0x503d10=_0x459fde[_0x9d8fce];return _0x503d10;},a359_0x2c6c(_0x22b7ab,_0x2cfded);}var __importDefault=this&&this[a359_0xbd30d4(0xed)]||function(_0x8f97b8){const _0x2cc4c6=a359_0xbd30d4;return _0x8f97b8&&_0x8f97b8[_0x2cc4c6(0x100)]?_0x8f97b8:{'default':_0x8f97b8};};function a359_0x503d(){const _0xaf8754=['getJobResult','retrieveVPKList','push','set','951606dQDwRb','ENDPOINT_VQL','__importDefault','../enums/status.enums','filter','defineProperty','map','14mBELOS','10178168QujjWp','3349782XSECSD','\x27,\x27','content-type','export','toString','search','constructor','5911965PzktZK','outbound_package__v','_logger','getPackageNames','deletePackageComponents','__esModule','VeevaError','parse','errors','deleteVeevaObjectRecords','log','../classes/errors/veeva-error','_veevaService','apply','VeevaConstants','from','deleteOutboundPackages','createPackageComponents','loadAsync','package_component__v','createOutboundPackages','Retrieve\x20Outbound\x20Package\x20zip\x20list','get','ceil','ENDPOINT_CREATE_RECORDS','2509420lmgkKH','Adding\x20components\x20to\x20outbound\x20package','Creating\x20outbound\x20packages','length','PackageExportService','migration__sys','rel','3872508TsDutr','Removing\x20components\x20from\x20outbound\x20packages.','getEndpointArtifactList','post','_connection','all','application/x-www-form-urlencoded','4106628JojAks','includes','executeVQL','Create\x20Export\x20outbound\x20packages.','fill','MAXIMUM_SIZE_OF_PACKAGE','createExportOutboundPackages','responseStatus','packageName','join','reduce','Deleting\x20outbound\x20packages.','application/json','name__v','createVeevaObjectRecords','(((.+)+)+)+$','ENDPOINT_EXPORT_IMPORT_PACKAGE','Getting\x20names\x20of\x20outbound\x20packages'];a359_0x503d=function(){return _0xaf8754;};return a359_0x503d();}Object[a359_0xbd30d4(0xf0)](exports,a359_0xbd30d4(0x100),{'value':!![]}),exports['PackageExportService']=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require('jszip')),status_enums_1=require(a359_0xbd30d4(0xee)),veeva_error_1=require(a359_0xbd30d4(0x106));class PackageExportService{constructor({veevaService:_0x44e5d2,connection:_0x1463d0,logger:_0x587a0d}){const _0x183ee1=a359_0xbd30d4;this[_0x183ee1(0x107)]=_0x44e5d2,this[_0x183ee1(0xd2)]=_0x1463d0,this[_0x183ee1(0xfd)]=_0x587a0d;}async[a359_0xbd30d4(0x10f)](_0x44489e,_0x3cd44b){const _0x367d82=a359_0xbd30d4;this[_0x367d82(0xfd)][_0x367d82(0x105)](_0x367d82(0x116));const _0x18c13d=veeva_constants_1[_0x367d82(0x109)][_0x367d82(0x113)]+_0x367d82(0xfc),_0x9e154=new Array(_0x44489e)[_0x367d82(0xd9)]({'summary__v':_0x3cd44b,'object_type__v.api__name__v':_0x367d82(0xcc)});return await this[_0x367d82(0x107)]['createVeevaObjectRecords'](_0x18c13d,_0x9e154);}async[a359_0xbd30d4(0x10c)](_0x419f36,_0x578c3a){const _0x4ae85a=a359_0xbd30d4;this[_0x4ae85a(0xfd)][_0x4ae85a(0x105)](_0x4ae85a(0x115));const _0x3f18ed=veeva_constants_1[_0x4ae85a(0x109)][_0x4ae85a(0x113)]+_0x4ae85a(0x10e),_0xd1be71=_0x419f36[_0x4ae85a(0xf1)]((_0xed4f6c,_0x1e44c3)=>({'vault_component__v':_0xed4f6c['id'],'outbound_package__v':_0x578c3a[Math[_0x4ae85a(0x112)]((_0x1e44c3+0x1)/veeva_constants_1[_0x4ae85a(0x109)][_0x4ae85a(0xda)])-0x1]}));return await this[_0x4ae85a(0x107)][_0x4ae85a(0xe3)](_0x3f18ed,_0xd1be71);}async['getPackageNames'](_0x284368){const _0x5b35cc=a359_0xbd30d4;this[_0x5b35cc(0xfd)][_0x5b35cc(0x105)](_0x5b35cc(0xe6));const _0x17e294='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x284368[_0x5b35cc(0xde)](_0x5b35cc(0xf5))+'\x27)',_0x18bb4f=veeva_constants_1['VeevaConstants'][_0x5b35cc(0xec)]+_0x17e294,_0x3c05b6=await this[_0x5b35cc(0x107)][_0x5b35cc(0xd7)](_0x18bb4f);return _0x3c05b6[_0x5b35cc(0xdf)]((_0x5674d4,_0x15f832)=>_0x5674d4[_0x5b35cc(0xea)](_0x15f832['id'],_0x15f832[_0x5b35cc(0xe2)]),new Map());}async[a359_0xbd30d4(0xdb)](_0x28dab6){const _0x25d82c=a359_0xbd30d4;this['_logger'][_0x25d82c(0x105)](_0x25d82c(0xd8));const _0x11ce85=[],_0x5432af=_0x28dab6[_0x25d82c(0xf1)](_0x18b47d=>{const _0xf20c2c=_0x25d82c;return this[_0xf20c2c(0xd2)][_0xf20c2c(0xd1)](veeva_constants_1[_0xf20c2c(0x109)][_0xf20c2c(0xe5)],encodeURI(_0xf20c2c(0xdd))+'='+encodeURI(_0x18b47d),{'headers':{'Content-Type':_0xf20c2c(0xd4)}});}),_0x5b9088=await Promise[_0x25d82c(0xd3)](_0x5432af);for(const {data:_0x1ad8b7}of _0x5b9088){if(_0x1ad8b7[_0x25d82c(0xdc)]===status_enums_1['VeevaResponseStatus']['SUCCESS']){const {url:_0x7d0025}=_0x1ad8b7;_0x11ce85[_0x25d82c(0xe9)](_0x7d0025);}else throw new veeva_error_1['VeevaError'](_0x1ad8b7['errors']);}return _0x11ce85;}async[a359_0xbd30d4(0xd0)](_0x3443c4){const _0x4212cd=a359_0xbd30d4;this['_logger'][_0x4212cd(0x105)]('Retrieve\x20Jobs\x20Status');const _0x12c62d=[],_0x248ac1=await this[_0x4212cd(0x107)][_0x4212cd(0xe7)](_0x3443c4);for(const _0x2b1ae7 of _0x248ac1){const _0x2c30f2=_0x2b1ae7['links'][_0x4212cd(0xef)](_0x4845a4=>_0x4845a4[_0x4212cd(0xcd)]==='artifacts')['map'](_0x446244=>_0x446244['href']);_0x12c62d[_0x4212cd(0xe9)](..._0x2c30f2);}return _0x12c62d;}async['retrieveVPKList'](_0x4de28f){const _0x5572ca=a359_0xbd30d4;var _0x3b621a;const _0x6104ba=[];this['_logger'][_0x5572ca(0x105)](_0x5572ca(0x110));for(const _0x5a24dc of _0x4de28f){const {data:_0x31617f,headers:_0x24256b}=await this['_connection'][_0x5572ca(0x111)](_0x5a24dc,{'responseType':'arraybuffer'}),_0x1ee555=(_0x3b621a=_0x24256b[_0x5572ca(0xf6)])===null||_0x3b621a===void 0x0?void 0x0:_0x3b621a[_0x5572ca(0xd6)](_0x5572ca(0xe1));if(!_0x1ee555){const _0x55c3c7=_0x31617f,_0x44b659=new jszip_1['default']();await _0x44b659[_0x5572ca(0x10d)](_0x55c3c7),_0x6104ba[_0x5572ca(0xe9)](_0x44b659);}else{const _0x3b10c7=JSON[_0x5572ca(0x102)](_0x31617f);throw new veeva_error_1[(_0x5572ca(0x101))](_0x3b10c7[_0x5572ca(0x103)]);}}return _0x6104ba;}async[a359_0xbd30d4(0xff)](_0x4acddf){const _0x5088c5=a359_0xbd30d4;this[_0x5088c5(0xfd)][_0x5088c5(0x105)](_0x5088c5(0xcf));const _0xcf007c=veeva_constants_1[_0x5088c5(0x109)][_0x5088c5(0x113)]+_0x5088c5(0x10e);await this[_0x5088c5(0x107)]['deleteVeevaObjectRecords'](_0xcf007c,_0x4acddf);}async[a359_0xbd30d4(0x10b)](_0x184257){const _0x53001d=a359_0xbd30d4;this[_0x53001d(0xfd)]['log'](_0x53001d(0xe0));const _0x59d48d=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+_0x53001d(0xfc);await this[_0x53001d(0x107)][_0x53001d(0x104)](_0x59d48d,_0x184257);}async[a359_0xbd30d4(0xf7)](_0x17e512,_0x1a289d){const _0x1c9a64=a359_0xbd30d4,_0x8a920a=await this[_0x1c9a64(0x10f)](Math['ceil'](_0x17e512[_0x1c9a64(0xca)]/veeva_constants_1['VeevaConstants'][_0x1c9a64(0xda)]),_0x1a289d),_0x2b902a=await this['createPackageComponents'](_0x17e512,_0x8a920a),_0x37841e=await this[_0x1c9a64(0xfe)](_0x8a920a),_0x11ffd7=await this[_0x1c9a64(0xdb)](Array[_0x1c9a64(0x10a)](_0x37841e['values']())),_0xb39dee=await this['getEndpointArtifactList'](_0x11ffd7),_0x3a37de=await this[_0x1c9a64(0xe8)](_0xb39dee);return await this['deletePackageComponents'](_0x2b902a),await this[_0x1c9a64(0x10b)](_0x8a920a),_0x3a37de;}}exports[a359_0xbd30d4(0xcb)]=PackageExportService;