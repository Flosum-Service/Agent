const a403_0x388759=a403_0x5be6;function a403_0x5222(){const _0x458528=['33526tDHcMC','Retrieve\x20Outbound\x20Package\x20zip\x20list','Getting\x20names\x20of\x20outbound\x20packages','__esModule','VeevaResponseStatus','Create\x20Export\x20outbound\x20packages.','post','deletePackageComponents','migration__sys','application/x-www-form-urlencoded','constructor','deleteVeevaObjectRecords','rel','packageName','name__v','loadAsync','(((.+)+)+)+$','21231lJHjOU','href','Retrieve\x20Jobs\x20Status','4251159wJdujc','1189097xXSSgT','reduce','export','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','ENDPOINT_EXPORT_IMPORT_PACKAGE','Adding\x20components\x20to\x20outbound\x20package','fill','errors','retrieveVPKList','_logger','createExportOutboundPackages','apply','ENDPOINT_CREATE_RECORDS','content-type','log','createOutboundPackages','filter','../classes/errors/veeva-error','join','getEndpointArtifactList','Creating\x20outbound\x20packages','ceil','includes','responseStatus','package_component__v','_connection','arraybuffer','VeevaConstants','get','deleteOutboundPackages','from','__importDefault','values','\x27,\x27','getPackageNames','PackageExportService','_veevaService','MAXIMUM_SIZE_OF_PACKAGE','getJobResult','createPackageComponents','../enums/status.enums','set','createVeevaObjectRecords','Deleting\x20outbound\x20packages.','push','jszip','2797912wKagnd','VeevaError','map','8488980OtbUpt','toString','default','artifacts','472UkFLJW','47LNphcd','links','12TkmXZi','search','outbound_package__v','2760730WKGHye'];a403_0x5222=function(){return _0x458528;};return a403_0x5222();}(function(_0x99ba50,_0x826ee4){const _0x2728d7=a403_0x5be6,_0x2f2d52=_0x99ba50();while(!![]){try{const _0x3a6abb=-parseInt(_0x2728d7(0x1f3))/0x1*(-parseInt(_0x2728d7(0x1f9))/0x2)+-parseInt(_0x2728d7(0x1b9))/0x3*(-parseInt(_0x2728d7(0x1f2))/0x4)+-parseInt(_0x2728d7(0x1f8))/0x5+-parseInt(_0x2728d7(0x1f5))/0x6*(-parseInt(_0x2728d7(0x1bd))/0x7)+parseInt(_0x2728d7(0x1eb))/0x8+-parseInt(_0x2728d7(0x1bc))/0x9+-parseInt(_0x2728d7(0x1ee))/0xa;if(_0x3a6abb===_0x826ee4)break;else _0x2f2d52['push'](_0x2f2d52['shift']());}catch(_0x1174f0){_0x2f2d52['push'](_0x2f2d52['shift']());}}}(a403_0x5222,0x6b2f9));const a403_0x159087=(function(){let _0x378125=!![];return function(_0x5de7fe,_0x4ea961){const _0x46e8e3=_0x378125?function(){const _0x3acf57=a403_0x5be6;if(_0x4ea961){const _0x2e9985=_0x4ea961[_0x3acf57(0x1c8)](_0x5de7fe,arguments);return _0x4ea961=null,_0x2e9985;}}:function(){};return _0x378125=![],_0x46e8e3;};}()),a403_0x48fedc=a403_0x159087(this,function(){const _0x591964=a403_0x5be6;return a403_0x48fedc[_0x591964(0x1ef)]()['search']('(((.+)+)+)+$')[_0x591964(0x1ef)]()[_0x591964(0x1b2)](a403_0x48fedc)[_0x591964(0x1f6)](_0x591964(0x1b8));});function a403_0x5be6(_0x176c05,_0x538d2d){const _0x3fc66a=a403_0x5222();return a403_0x5be6=function(_0x48fedc,_0x159087){_0x48fedc=_0x48fedc-0x1ac;let _0x5222a6=_0x3fc66a[_0x48fedc];return _0x5222a6;},a403_0x5be6(_0x176c05,_0x538d2d);}a403_0x48fedc();'use strict';var __importDefault=this&&this[a403_0x388759(0x1dc)]||function(_0x467199){const _0x583f2e=a403_0x388759;return _0x467199&&_0x467199[_0x583f2e(0x1fc)]?_0x467199:{'default':_0x467199};};Object['defineProperty'](exports,a403_0x388759(0x1fc),{'value':!![]}),exports[a403_0x388759(0x1e0)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require(a403_0x388759(0x1ea))),status_enums_1=require(a403_0x388759(0x1e5)),veeva_error_1=require(a403_0x388759(0x1ce));class PackageExportService{constructor({veevaService:_0xbc8b75,connection:_0x53f5ec,logger:_0x1f8bb3}){const _0x331558=a403_0x388759;this['_veevaService']=_0xbc8b75,this[_0x331558(0x1d6)]=_0x53f5ec,this[_0x331558(0x1c6)]=_0x1f8bb3;}async[a403_0x388759(0x1cc)](_0x2b66f5,_0x4ff093){const _0x405f44=a403_0x388759;this['_logger']['log'](_0x405f44(0x1d1));const _0x56926a=veeva_constants_1[_0x405f44(0x1d8)][_0x405f44(0x1c9)]+_0x405f44(0x1f7),_0x32334b=new Array(_0x2b66f5)[_0x405f44(0x1c3)]({'summary__v':_0x4ff093,'object_type__v.api__name__v':_0x405f44(0x1b0)});return await this[_0x405f44(0x1e1)][_0x405f44(0x1e7)](_0x56926a,_0x32334b);}async[a403_0x388759(0x1e4)](_0x2428fa,_0x3e8369){const _0xa28fdf=a403_0x388759;this[_0xa28fdf(0x1c6)]['log'](_0xa28fdf(0x1c2));const _0x3e48c9=veeva_constants_1[_0xa28fdf(0x1d8)][_0xa28fdf(0x1c9)]+_0xa28fdf(0x1d5),_0x3215cc=_0x2428fa[_0xa28fdf(0x1ed)]((_0x29380e,_0x4d70b0)=>({'vault_component__v':_0x29380e['id'],'outbound_package__v':_0x3e8369[Math[_0xa28fdf(0x1d2)]((_0x4d70b0+0x1)/veeva_constants_1['VeevaConstants'][_0xa28fdf(0x1e2)])-0x1]}));return await this[_0xa28fdf(0x1e1)][_0xa28fdf(0x1e7)](_0x3e48c9,_0x3215cc);}async['getPackageNames'](_0x5d4f67){const _0x164ae3=a403_0x388759;this['_logger'][_0x164ae3(0x1cb)](_0x164ae3(0x1fb));const _0x167f71=_0x164ae3(0x1c0)+_0x5d4f67[_0x164ae3(0x1cf)](_0x164ae3(0x1de))+'\x27)',_0x251bd9=await this['_veevaService']['executeVQL'](_0x167f71);return _0x251bd9[_0x164ae3(0x1be)]((_0x173919,_0x1c494a)=>_0x173919[_0x164ae3(0x1e6)](_0x1c494a['id'],_0x1c494a[_0x164ae3(0x1b6)]),new Map());}async['createExportOutboundPackages'](_0x415d9f){const _0x3395c3=a403_0x388759;this['_logger'][_0x3395c3(0x1cb)](_0x3395c3(0x1ad));const _0x2297ba=[],_0x1e8bec=_0x415d9f[_0x3395c3(0x1ed)](_0x24e7af=>{const _0x9ae776=_0x3395c3;return this[_0x9ae776(0x1d6)][_0x9ae776(0x1ae)](veeva_constants_1[_0x9ae776(0x1d8)][_0x9ae776(0x1c1)],encodeURI(_0x9ae776(0x1b5))+'='+encodeURI(_0x24e7af),{'headers':{'Content-Type':_0x9ae776(0x1b1)}});}),_0x59c8a1=await Promise['all'](_0x1e8bec);for(const {data:_0x229884}of _0x59c8a1){if(_0x229884[_0x3395c3(0x1d4)]===status_enums_1[_0x3395c3(0x1ac)]['SUCCESS']){const {url:_0x494820}=_0x229884;_0x2297ba[_0x3395c3(0x1e9)](_0x494820);}else throw new veeva_error_1['VeevaError'](_0x229884['errors']);}return _0x2297ba;}async[a403_0x388759(0x1d0)](_0x4a9132){const _0x1adaf8=a403_0x388759;this[_0x1adaf8(0x1c6)][_0x1adaf8(0x1cb)](_0x1adaf8(0x1bb));const _0x1eb72b=[],_0x4598f6=await this[_0x1adaf8(0x1e1)][_0x1adaf8(0x1e3)](_0x4a9132);for(const _0x4b450a of _0x4598f6){const _0x23e67c=_0x4b450a[_0x1adaf8(0x1f4)][_0x1adaf8(0x1cd)](_0x7f51e5=>_0x7f51e5[_0x1adaf8(0x1b4)]===_0x1adaf8(0x1f1))[_0x1adaf8(0x1ed)](_0x382a24=>_0x382a24[_0x1adaf8(0x1ba)]);_0x1eb72b['push'](..._0x23e67c);}return _0x1eb72b;}async[a403_0x388759(0x1c5)](_0x13682b){const _0x379cd8=a403_0x388759;var _0x9897f6;const _0x3b4e23=[];this[_0x379cd8(0x1c6)][_0x379cd8(0x1cb)](_0x379cd8(0x1fa));for(const _0x445c7f of _0x13682b){const {data:_0x4a89fb,headers:_0x18bbb2}=await this[_0x379cd8(0x1d6)][_0x379cd8(0x1d9)](_0x445c7f,{'responseType':_0x379cd8(0x1d7)}),_0x4cb73f=(_0x9897f6=_0x18bbb2[_0x379cd8(0x1ca)])===null||_0x9897f6===void 0x0?void 0x0:_0x9897f6[_0x379cd8(0x1d3)]('application/json');if(!_0x4cb73f){const _0x145022=_0x4a89fb,_0x2438f7=new jszip_1[(_0x379cd8(0x1f0))]();await _0x2438f7[_0x379cd8(0x1b7)](_0x145022),_0x3b4e23['push'](_0x2438f7);}else{const _0xc3d509=JSON['parse'](_0x4a89fb);throw new veeva_error_1[(_0x379cd8(0x1ec))](_0xc3d509[_0x379cd8(0x1c4)]);}}return _0x3b4e23;}async['deletePackageComponents'](_0x1ef3be){const _0x219e22=a403_0x388759;this[_0x219e22(0x1c6)]['log']('Removing\x20components\x20from\x20outbound\x20packages.');const _0x19e4f2=veeva_constants_1[_0x219e22(0x1d8)]['ENDPOINT_CREATE_RECORDS']+'package_component__v';await this[_0x219e22(0x1e1)][_0x219e22(0x1b3)](_0x19e4f2,_0x1ef3be);}async[a403_0x388759(0x1da)](_0x46148d){const _0x9e3c46=a403_0x388759;this[_0x9e3c46(0x1c6)][_0x9e3c46(0x1cb)](_0x9e3c46(0x1e8));const _0x51e89b=veeva_constants_1[_0x9e3c46(0x1d8)]['ENDPOINT_CREATE_RECORDS']+'outbound_package__v';await this[_0x9e3c46(0x1e1)]['deleteVeevaObjectRecords'](_0x51e89b,_0x46148d);}async[a403_0x388759(0x1bf)](_0x766d27,_0x3f33a9){const _0x5adc2b=a403_0x388759,_0x24e8ca=await this['createOutboundPackages'](Math[_0x5adc2b(0x1d2)](_0x766d27['length']/veeva_constants_1[_0x5adc2b(0x1d8)][_0x5adc2b(0x1e2)]),_0x3f33a9),_0x756218=await this[_0x5adc2b(0x1e4)](_0x766d27,_0x24e8ca),_0x520fa5=await this[_0x5adc2b(0x1df)](_0x24e8ca),_0x45a487=await this[_0x5adc2b(0x1c7)](Array[_0x5adc2b(0x1db)](_0x520fa5[_0x5adc2b(0x1dd)]())),_0x17bda6=await this[_0x5adc2b(0x1d0)](_0x45a487),_0x2427e0=await this[_0x5adc2b(0x1c5)](_0x17bda6);return await this[_0x5adc2b(0x1af)](_0x756218),await this['deleteOutboundPackages'](_0x24e8ca),_0x2427e0;}}exports[a403_0x388759(0x1e0)]=PackageExportService;