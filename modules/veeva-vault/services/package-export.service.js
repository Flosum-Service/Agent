const a335_0x1acd39=a335_0x10e4;(function(_0x2c5bad,_0x4ca729){const _0x5033b0=a335_0x10e4,_0x3e7b9b=_0x2c5bad();while(!![]){try{const _0xc6a99f=parseInt(_0x5033b0(0x1bd))/0x1*(parseInt(_0x5033b0(0x1f6))/0x2)+parseInt(_0x5033b0(0x1ec))/0x3+parseInt(_0x5033b0(0x1c4))/0x4*(parseInt(_0x5033b0(0x1fc))/0x5)+-parseInt(_0x5033b0(0x1e5))/0x6+-parseInt(_0x5033b0(0x1c8))/0x7*(parseInt(_0x5033b0(0x1d9))/0x8)+parseInt(_0x5033b0(0x1be))/0x9+-parseInt(_0x5033b0(0x1f3))/0xa;if(_0xc6a99f===_0x4ca729)break;else _0x3e7b9b['push'](_0x3e7b9b['shift']());}catch(_0x653047){_0x3e7b9b['push'](_0x3e7b9b['shift']());}}}(a335_0x5ecf,0x8d675));const a335_0x419d3c=(function(){let _0x508751=!![];return function(_0x4be999,_0xa5735b){const _0x308e53=_0x508751?function(){const _0x2bc7c9=a335_0x10e4;if(_0xa5735b){const _0x27d331=_0xa5735b[_0x2bc7c9(0x1ef)](_0x4be999,arguments);return _0xa5735b=null,_0x27d331;}}:function(){};return _0x508751=![],_0x308e53;};}()),a335_0x4322c6=a335_0x419d3c(this,function(){const _0x557206=a335_0x10e4;return a335_0x4322c6[_0x557206(0x1ff)]()[_0x557206(0x1e6)](_0x557206(0x1df))['toString']()['constructor'](a335_0x4322c6)[_0x557206(0x1e6)]('(((.+)+)+)+$');});a335_0x4322c6();function a335_0x10e4(_0x1e2beb,_0x4d1c37){const _0x28f997=a335_0x5ecf();return a335_0x10e4=function(_0x4322c6,_0x419d3c){_0x4322c6=_0x4322c6-0x1bb;let _0x5ecf5a=_0x28f997[_0x4322c6];return _0x5ecf5a;},a335_0x10e4(_0x1e2beb,_0x4d1c37);}'use strict';var __importDefault=this&&this[a335_0x1acd39(0x1f4)]||function(_0x5f3362){const _0x26601c=a335_0x1acd39;return _0x5f3362&&_0x5f3362[_0x26601c(0x1c1)]?_0x5f3362:{'default':_0x5f3362};};function a335_0x5ecf(){const _0x4bc782=['application/x-www-form-urlencoded','createPackageComponents','MAXIMUM_SIZE_OF_PACKAGE','createOutboundPackages','set','8130BipRjT','values','content-type','toString','createExportOutboundPackages','all','includes','getEndpointArtifactList','Retrieve\x20Outbound\x20Package\x20zip\x20list','2069kFbxFQ','10417455pOJPnE','VeevaResponseStatus','package_component__v','__esModule','deletePackageComponents','VeevaConstants','804aKIVvn','ENDPOINT_CREATE_RECORDS','Retrieve\x20Jobs\x20Status','parse','798gCjqgr','map','default','rel','get','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','jszip','reduce','retrieveVPKList','outbound_package__v','push','\x27,\x27','../constants/veeva.constants','Deleting\x20outbound\x20packages.','join','ceil','export','67168HxCaiD','Getting\x20names\x20of\x20outbound\x20packages','fill','SUCCESS','ENDPOINT_EXPORT_IMPORT_PACKAGE','_connection','(((.+)+)+)+$','Create\x20Export\x20outbound\x20packages.','log','_veevaService','href','../enums/status.enums','4855464SVvBEK','search','defineProperty','deleteOutboundPackages','createVeevaObjectRecords','links','PackageExportService','64290AcGBZc','responseStatus','Removing\x20components\x20from\x20outbound\x20packages.','apply','getJobResult','arraybuffer','loadAsync','1739840ScKTpI','__importDefault','_logger','980asqoyu'];a335_0x5ecf=function(){return _0x4bc782;};return a335_0x5ecf();}Object[a335_0x1acd39(0x1e7)](exports,'__esModule',{'value':!![]}),exports[a335_0x1acd39(0x1eb)]=void 0x0;const veeva_constants_1=require(a335_0x1acd39(0x1d4)),jszip_1=__importDefault(require(a335_0x1acd39(0x1ce))),status_enums_1=require(a335_0x1acd39(0x1e4)),veeva_error_1=require('../classes/errors/veeva-error');class PackageExportService{constructor({veevaService:_0x1113f9,connection:_0x5059aa,logger:_0x2e8ac6}){const _0x4cd749=a335_0x1acd39;this['_veevaService']=_0x1113f9,this[_0x4cd749(0x1de)]=_0x5059aa,this[_0x4cd749(0x1f5)]=_0x2e8ac6;}async[a335_0x1acd39(0x1fa)](_0x42f401,_0x173c12){const _0x1447f0=a335_0x1acd39;this['_logger'][_0x1447f0(0x1e1)]('Creating\x20outbound\x20packages');const _0xcd9154=veeva_constants_1[_0x1447f0(0x1c3)][_0x1447f0(0x1c5)]+_0x1447f0(0x1d1),_0x37d8a0=new Array(_0x42f401)[_0x1447f0(0x1db)]({'summary__v':_0x173c12,'object_type__v.api__name__v':'migration__sys'});return await this[_0x1447f0(0x1e2)][_0x1447f0(0x1e9)](_0xcd9154,_0x37d8a0);}async[a335_0x1acd39(0x1f8)](_0x5cdbf0,_0xc9c279){const _0x1b23fa=a335_0x1acd39;this[_0x1b23fa(0x1f5)][_0x1b23fa(0x1e1)]('Adding\x20components\x20to\x20outbound\x20package');const _0x641474=veeva_constants_1['VeevaConstants'][_0x1b23fa(0x1c5)]+_0x1b23fa(0x1c0),_0x268689=_0x5cdbf0[_0x1b23fa(0x1c9)]((_0xade067,_0x29a80c)=>({'vault_component__v':_0xade067['id'],'outbound_package__v':_0xc9c279[Math[_0x1b23fa(0x1d7)]((_0x29a80c+0x1)/veeva_constants_1[_0x1b23fa(0x1c3)][_0x1b23fa(0x1f9)])-0x1]}));return await this['_veevaService'][_0x1b23fa(0x1e9)](_0x641474,_0x268689);}async['getPackageNames'](_0x4dc468){const _0x383636=a335_0x1acd39;this[_0x383636(0x1f5)]['log'](_0x383636(0x1da));const _0x222755=_0x383636(0x1cd)+_0x4dc468[_0x383636(0x1d6)](_0x383636(0x1d3))+'\x27)',_0x3f1d43=veeva_constants_1['VeevaConstants']['ENDPOINT_VQL']+_0x222755,_0x4ee0ad=await this['_veevaService']['executeVQL'](_0x3f1d43);return _0x4ee0ad[_0x383636(0x1cf)]((_0x26b5ad,_0x383918)=>_0x26b5ad[_0x383636(0x1fb)](_0x383918['id'],_0x383918['name__v']),new Map());}async['createExportOutboundPackages'](_0x41ad1d){const _0x1d8cad=a335_0x1acd39;this[_0x1d8cad(0x1f5)]['log'](_0x1d8cad(0x1e0));const _0x413512=[],_0x39546f=_0x41ad1d['map'](_0x1817e5=>{const _0x193c2e=_0x1d8cad;return this[_0x193c2e(0x1de)]['post'](veeva_constants_1[_0x193c2e(0x1c3)][_0x193c2e(0x1dd)],encodeURI('packageName')+'='+encodeURI(_0x1817e5),{'headers':{'Content-Type':_0x193c2e(0x1f7)}});}),_0x248ea0=await Promise[_0x1d8cad(0x201)](_0x39546f);for(const {data:_0x324367}of _0x248ea0){if(_0x324367[_0x1d8cad(0x1ed)]===status_enums_1[_0x1d8cad(0x1bf)][_0x1d8cad(0x1dc)]){const {url:_0x41c3df}=_0x324367;_0x413512[_0x1d8cad(0x1d2)](_0x41c3df);}else throw new veeva_error_1['VeevaError'](_0x324367['errors']);}return _0x413512;}async['getEndpointArtifactList'](_0x518cb3){const _0x5e0b58=a335_0x1acd39;this[_0x5e0b58(0x1f5)]['log'](_0x5e0b58(0x1c6));const _0x145814=[],_0x4dfcd3=await this['_veevaService'][_0x5e0b58(0x1f0)](_0x518cb3);for(const _0xe3c757 of _0x4dfcd3){const _0x43a27e=_0xe3c757[_0x5e0b58(0x1ea)]['filter'](_0x3ae7ec=>_0x3ae7ec[_0x5e0b58(0x1cb)]==='artifacts')[_0x5e0b58(0x1c9)](_0xe79e93=>_0xe79e93[_0x5e0b58(0x1e3)]);_0x145814[_0x5e0b58(0x1d2)](..._0x43a27e);}return _0x145814;}async[a335_0x1acd39(0x1d0)](_0x2b8d1b){const _0x1873dc=a335_0x1acd39;var _0x320682;const _0x4fcfe9=[];this['_logger'][_0x1873dc(0x1e1)](_0x1873dc(0x1bc));for(const _0x3c3847 of _0x2b8d1b){const {data:_0x335dc1,headers:_0x22ad48}=await this[_0x1873dc(0x1de)][_0x1873dc(0x1cc)](_0x3c3847,{'responseType':_0x1873dc(0x1f1)}),_0x5344d3=(_0x320682=_0x22ad48[_0x1873dc(0x1fe)])===null||_0x320682===void 0x0?void 0x0:_0x320682[_0x1873dc(0x202)]('application/json');if(!_0x5344d3){const _0x5c712a=_0x335dc1,_0x412ce3=new jszip_1[(_0x1873dc(0x1ca))]();await _0x412ce3[_0x1873dc(0x1f2)](_0x5c712a),_0x4fcfe9[_0x1873dc(0x1d2)](_0x412ce3);}else{const _0x1d81da=JSON[_0x1873dc(0x1c7)](_0x335dc1);throw new veeva_error_1['VeevaError'](_0x1d81da['errors']);}}return _0x4fcfe9;}async[a335_0x1acd39(0x1c2)](_0x50e3d8){const _0x1ed10=a335_0x1acd39;this[_0x1ed10(0x1f5)][_0x1ed10(0x1e1)](_0x1ed10(0x1ee));const _0x3d004a=veeva_constants_1['VeevaConstants'][_0x1ed10(0x1c5)]+'package_component__v';await this[_0x1ed10(0x1e2)]['deleteVeevaObjectRecords'](_0x3d004a,_0x50e3d8);}async['deleteOutboundPackages'](_0x270130){const _0x38c827=a335_0x1acd39;this[_0x38c827(0x1f5)][_0x38c827(0x1e1)](_0x38c827(0x1d5));const _0xb5f85b=veeva_constants_1['VeevaConstants'][_0x38c827(0x1c5)]+_0x38c827(0x1d1);await this[_0x38c827(0x1e2)]['deleteVeevaObjectRecords'](_0xb5f85b,_0x270130);}async[a335_0x1acd39(0x1d8)](_0x4b5531,_0xcfee71){const _0x586b06=a335_0x1acd39,_0x1a4c10=await this[_0x586b06(0x1fa)](Math['ceil'](_0x4b5531['length']/veeva_constants_1['VeevaConstants'][_0x586b06(0x1f9)]),_0xcfee71),_0x256d1d=await this[_0x586b06(0x1f8)](_0x4b5531,_0x1a4c10),_0x5a7615=await this['getPackageNames'](_0x1a4c10),_0x14631f=await this[_0x586b06(0x200)](Array['from'](_0x5a7615[_0x586b06(0x1fd)]())),_0x9642d3=await this[_0x586b06(0x1bb)](_0x14631f),_0x3c98e3=await this['retrieveVPKList'](_0x9642d3);return await this[_0x586b06(0x1c2)](_0x256d1d),await this[_0x586b06(0x1e8)](_0x1a4c10),_0x3c98e3;}}exports['PackageExportService']=PackageExportService;