const a402_0x514c55=a402_0x3fc1;(function(_0x487b9c,_0x4ebccd){const _0x12d8c6=a402_0x3fc1,_0x33115b=_0x487b9c();while(!![]){try{const _0x2c9954=-parseInt(_0x12d8c6(0x19b))/0x1+-parseInt(_0x12d8c6(0x196))/0x2*(-parseInt(_0x12d8c6(0x184))/0x3)+-parseInt(_0x12d8c6(0x1c1))/0x4+parseInt(_0x12d8c6(0x19d))/0x5+-parseInt(_0x12d8c6(0x1a8))/0x6+-parseInt(_0x12d8c6(0x1c4))/0x7+parseInt(_0x12d8c6(0x1b9))/0x8;if(_0x2c9954===_0x4ebccd)break;else _0x33115b['push'](_0x33115b['shift']());}catch(_0x172c37){_0x33115b['push'](_0x33115b['shift']());}}}(a402_0x4760,0x6e24e));const a402_0x46ca3f=(function(){let _0x2fb315=!![];return function(_0x15141e,_0x283a14){const _0x4a97a8=_0x2fb315?function(){if(_0x283a14){const _0x42eaeb=_0x283a14['apply'](_0x15141e,arguments);return _0x283a14=null,_0x42eaeb;}}:function(){};return _0x2fb315=![],_0x4a97a8;};}()),a402_0x4f8efd=a402_0x46ca3f(this,function(){const _0x27441e=a402_0x3fc1;return a402_0x4f8efd['toString']()[_0x27441e(0x1a0)](_0x27441e(0x192))[_0x27441e(0x18a)]()[_0x27441e(0x1b7)](a402_0x4f8efd)[_0x27441e(0x1a0)](_0x27441e(0x192));});a402_0x4f8efd();'use strict';function a402_0x3fc1(_0x1403cf,_0x34867b){const _0x1b9bea=a402_0x4760();return a402_0x3fc1=function(_0x4f8efd,_0x46ca3f){_0x4f8efd=_0x4f8efd-0x180;let _0x4760ec=_0x1b9bea[_0x4f8efd];return _0x4760ec;},a402_0x3fc1(_0x1403cf,_0x34867b);}var __importDefault=this&&this['__importDefault']||function(_0x4c2c1d){const _0x128773=a402_0x3fc1;return _0x4c2c1d&&_0x4c2c1d[_0x128773(0x19e)]?_0x4c2c1d:{'default':_0x4c2c1d};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a402_0x514c55(0x182)]=void 0x0;function a402_0x4760(){const _0x45e376=['loadAsync','createPackageComponents','631644LrZHJE','push','parse','\x27,\x27','../enums/status.enums','165977mEBDRZ','get','2833785jwgMVp','__esModule','href','search','from','Retrieve\x20Outbound\x20Package\x20zip\x20list','Deleting\x20outbound\x20packages.','values','createExportOutboundPackages','../classes/errors/veeva-error','includes','2666190lTieSY','deleteVeevaObjectRecords','_veevaService','createOutboundPackages','application/json','ENDPOINT_EXPORT_IMPORT_PACKAGE','createVeevaObjectRecords','artifacts','jszip','ENDPOINT_CREATE_RECORDS','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','_logger','migration__sys','_connection','VeevaConstants','constructor','reduce','15029392LkKBOT','export','outbound_package__v','content-type','responseStatus','all','Retrieve\x20Jobs\x20Status','errors','3421844ExCXuq','VeevaError','getEndpointArtifactList','5910100JaAzjm','length','rel','PackageExportService','Removing\x20components\x20from\x20outbound\x20packages.','3NIzPtd','retrieveVPKList','getPackageNames','Creating\x20outbound\x20packages','getJobResult','log','toString','ceil','Create\x20Export\x20outbound\x20packages.','MAXIMUM_SIZE_OF_PACKAGE','package_component__v','VeevaResponseStatus','default','map','(((.+)+)+)+$','deleteOutboundPackages'];a402_0x4760=function(){return _0x45e376;};return a402_0x4760();}const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require(a402_0x514c55(0x1b0))),status_enums_1=require(a402_0x514c55(0x19a)),veeva_error_1=require(a402_0x514c55(0x1a6));class PackageExportService{constructor({veevaService:_0x23be51,connection:_0x294540,logger:_0x33b5f4}){this['_veevaService']=_0x23be51,this['_connection']=_0x294540,this['_logger']=_0x33b5f4;}async[a402_0x514c55(0x1ab)](_0x10004d,_0x56ce07){const _0x24eafa=a402_0x514c55;this[_0x24eafa(0x1b3)][_0x24eafa(0x189)](_0x24eafa(0x187));const _0x5c9f24=veeva_constants_1[_0x24eafa(0x1b6)][_0x24eafa(0x1b1)]+_0x24eafa(0x1bb),_0x3cdacb=new Array(_0x10004d)['fill']({'summary__v':_0x56ce07,'object_type__v.api__name__v':_0x24eafa(0x1b4)});return await this['_veevaService']['createVeevaObjectRecords'](_0x5c9f24,_0x3cdacb);}async[a402_0x514c55(0x195)](_0x54ce9b,_0x3c1266){const _0x2bda47=a402_0x514c55;this[_0x2bda47(0x1b3)][_0x2bda47(0x189)]('Adding\x20components\x20to\x20outbound\x20package');const _0x205f15=veeva_constants_1[_0x2bda47(0x1b6)]['ENDPOINT_CREATE_RECORDS']+_0x2bda47(0x18e),_0x3f861e=_0x54ce9b['map']((_0x22c23a,_0x1d5d5c)=>({'vault_component__v':_0x22c23a['id'],'outbound_package__v':_0x3c1266[Math[_0x2bda47(0x18b)]((_0x1d5d5c+0x1)/veeva_constants_1[_0x2bda47(0x1b6)]['MAXIMUM_SIZE_OF_PACKAGE'])-0x1]}));return await this['_veevaService'][_0x2bda47(0x1ae)](_0x205f15,_0x3f861e);}async[a402_0x514c55(0x186)](_0x121712){const _0x39634a=a402_0x514c55;this[_0x39634a(0x1b3)][_0x39634a(0x189)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x1af9b5=_0x39634a(0x1b2)+_0x121712['join'](_0x39634a(0x199))+'\x27)',_0x20a558=await this[_0x39634a(0x1aa)]['executeVQL'](_0x1af9b5);return _0x20a558[_0x39634a(0x1b8)]((_0x2e13a3,_0x41ce4d)=>_0x2e13a3['set'](_0x41ce4d['id'],_0x41ce4d['name__v']),new Map());}async[a402_0x514c55(0x1a5)](_0x1b4867){const _0x8dd4f0=a402_0x514c55;this['_logger'][_0x8dd4f0(0x189)](_0x8dd4f0(0x18c));const _0x2e1f9b=[],_0x5b29d4=_0x1b4867['map'](_0x5c6704=>{const _0x1cc90a=_0x8dd4f0;return this['_connection']['post'](veeva_constants_1['VeevaConstants'][_0x1cc90a(0x1ad)],encodeURI('packageName')+'='+encodeURI(_0x5c6704),{'headers':{'Content-Type':'application/x-www-form-urlencoded'}});}),_0x32a81c=await Promise[_0x8dd4f0(0x1be)](_0x5b29d4);for(const {data:_0x2dbeb5}of _0x32a81c){if(_0x2dbeb5[_0x8dd4f0(0x1bd)]===status_enums_1[_0x8dd4f0(0x18f)]['SUCCESS']){const {url:_0x3ea5bf}=_0x2dbeb5;_0x2e1f9b[_0x8dd4f0(0x197)](_0x3ea5bf);}else throw new veeva_error_1[(_0x8dd4f0(0x1c2))](_0x2dbeb5[_0x8dd4f0(0x1c0)]);}return _0x2e1f9b;}async[a402_0x514c55(0x1c3)](_0x4f7012){const _0x3936ee=a402_0x514c55;this[_0x3936ee(0x1b3)]['log'](_0x3936ee(0x1bf));const _0x146b33=[],_0x1d0154=await this['_veevaService'][_0x3936ee(0x188)](_0x4f7012);for(const _0x589c75 of _0x1d0154){const _0x84cc5e=_0x589c75['links']['filter'](_0x503593=>_0x503593[_0x3936ee(0x181)]===_0x3936ee(0x1af))[_0x3936ee(0x191)](_0x25a82a=>_0x25a82a[_0x3936ee(0x19f)]);_0x146b33[_0x3936ee(0x197)](..._0x84cc5e);}return _0x146b33;}async[a402_0x514c55(0x185)](_0xe9223){const _0x211700=a402_0x514c55;var _0x5f0dbe;const _0x2c4fb3=[];this[_0x211700(0x1b3)]['log'](_0x211700(0x1a2));for(const _0x202b05 of _0xe9223){const {data:_0x50051b,headers:_0x502091}=await this[_0x211700(0x1b5)][_0x211700(0x19c)](_0x202b05,{'responseType':'arraybuffer'}),_0x809326=(_0x5f0dbe=_0x502091[_0x211700(0x1bc)])===null||_0x5f0dbe===void 0x0?void 0x0:_0x5f0dbe[_0x211700(0x1a7)](_0x211700(0x1ac));if(!_0x809326){const _0x235ca0=_0x50051b,_0x5015a0=new jszip_1[(_0x211700(0x190))]();await _0x5015a0[_0x211700(0x194)](_0x235ca0),_0x2c4fb3['push'](_0x5015a0);}else{const _0x11ea4d=JSON[_0x211700(0x198)](_0x50051b);throw new veeva_error_1['VeevaError'](_0x11ea4d[_0x211700(0x1c0)]);}}return _0x2c4fb3;}async['deletePackageComponents'](_0x2f2d33){const _0x43c3f3=a402_0x514c55;this['_logger']['log'](_0x43c3f3(0x183));const _0x5e8885=veeva_constants_1['VeevaConstants'][_0x43c3f3(0x1b1)]+'package_component__v';await this['_veevaService'][_0x43c3f3(0x1a9)](_0x5e8885,_0x2f2d33);}async[a402_0x514c55(0x193)](_0x555478){const _0x3d9bda=a402_0x514c55;this[_0x3d9bda(0x1b3)][_0x3d9bda(0x189)](_0x3d9bda(0x1a3));const _0x10f3d4=veeva_constants_1[_0x3d9bda(0x1b6)][_0x3d9bda(0x1b1)]+_0x3d9bda(0x1bb);await this[_0x3d9bda(0x1aa)][_0x3d9bda(0x1a9)](_0x10f3d4,_0x555478);}async[a402_0x514c55(0x1ba)](_0x421892,_0x5a59b8){const _0x52b630=a402_0x514c55,_0x3f53cf=await this[_0x52b630(0x1ab)](Math[_0x52b630(0x18b)](_0x421892[_0x52b630(0x180)]/veeva_constants_1['VeevaConstants'][_0x52b630(0x18d)]),_0x5a59b8),_0x3ce049=await this[_0x52b630(0x195)](_0x421892,_0x3f53cf),_0x46ac1e=await this['getPackageNames'](_0x3f53cf),_0x34a551=await this['createExportOutboundPackages'](Array[_0x52b630(0x1a1)](_0x46ac1e[_0x52b630(0x1a4)]())),_0x3731fc=await this['getEndpointArtifactList'](_0x34a551),_0x209107=await this[_0x52b630(0x185)](_0x3731fc);return await this['deletePackageComponents'](_0x3ce049),await this[_0x52b630(0x193)](_0x3f53cf),_0x209107;}}exports[a402_0x514c55(0x182)]=PackageExportService;