const a403_0x4f5818=a403_0x2a6e;(function(_0x57bda4,_0x5b5678){const _0x55d32e=a403_0x2a6e,_0x4246a5=_0x57bda4();while(!![]){try{const _0x118567=parseInt(_0x55d32e(0xdb))/0x1*(-parseInt(_0x55d32e(0x8e))/0x2)+-parseInt(_0x55d32e(0xc4))/0x3*(parseInt(_0x55d32e(0xc9))/0x4)+parseInt(_0x55d32e(0xb4))/0x5+parseInt(_0x55d32e(0xd4))/0x6+parseInt(_0x55d32e(0xd8))/0x7*(-parseInt(_0x55d32e(0xa0))/0x8)+parseInt(_0x55d32e(0xd3))/0x9+-parseInt(_0x55d32e(0xca))/0xa;if(_0x118567===_0x5b5678)break;else _0x4246a5['push'](_0x4246a5['shift']());}catch(_0x1e2199){_0x4246a5['push'](_0x4246a5['shift']());}}}(a403_0x5e24,0x2df88));const a403_0x30c4f3=(function(){let _0x3d49a0=!![];return function(_0x55f194,_0x4a3905){const _0x458706=_0x3d49a0?function(){const _0x569bff=a403_0x2a6e;if(_0x4a3905){const _0x4452f5=_0x4a3905[_0x569bff(0xd6)](_0x55f194,arguments);return _0x4a3905=null,_0x4452f5;}}:function(){};return _0x3d49a0=![],_0x458706;};}()),a403_0x662d0=a403_0x30c4f3(this,function(){const _0x32a280=a403_0x2a6e;return a403_0x662d0['toString']()[_0x32a280(0xbc)](_0x32a280(0xb2))[_0x32a280(0xb8)]()[_0x32a280(0xd5)](a403_0x662d0)[_0x32a280(0xbc)]('(((.+)+)+)+$');});a403_0x662d0();'use strict';var __importDefault=this&&this[a403_0x4f5818(0x9c)]||function(_0x4bd235){const _0x314570=a403_0x4f5818;return _0x4bd235&&_0x4bd235[_0x314570(0xb3)]?_0x4bd235:{'default':_0x4bd235};};function a403_0x5e24(){const _0x1c4fb4=['arraybuffer','createExportOutboundPackages','413VVrvZI','get','Getting\x20names\x20of\x20outbound\x20packages','452gJQCXv','retrieveVPKList','Creating\x20outbound\x20packages','Create\x20Export\x20outbound\x20packages.','set','length','../constants/veeva.constants','getPackageNames','application/x-www-form-urlencoded','from','VeevaResponseStatus','getJobResult','content-type','parse','__importDefault','createOutboundPackages','href','Removing\x20components\x20from\x20outbound\x20packages.','16WBIwLZ','default','../classes/errors/veeva-error','application/json','executeVQL','SUCCESS','responseStatus','deletePackageComponents','join','rel','_veevaService','deleteVeevaObjectRecords','../enums/status.enums','map','packageName','ENDPOINT_CREATE_RECORDS','links','artifacts','(((.+)+)+)+$','__esModule','558685ZtsCfQ','errors','reduce','getEndpointArtifactList','toString','migration__sys','createVeevaObjectRecords','MAXIMUM_SIZE_OF_PACKAGE','search','fill','Retrieve\x20Jobs\x20Status','VeevaError','Retrieve\x20Outbound\x20Package\x20zip\x20list','_logger','_connection','outbound_package__v','577605sQsRsh','Deleting\x20outbound\x20packages.','\x27,\x27','name__v','createPackageComponents','4jhtVCh','326350nVmYpz','package_component__v','ceil','push','defineProperty','log','deleteOutboundPackages','export','VeevaConstants','1328877cRxFRT','1595820BMIvTR','constructor','apply','PackageExportService','64946COmGsP'];a403_0x5e24=function(){return _0x1c4fb4;};return a403_0x5e24();}Object[a403_0x4f5818(0xce)](exports,'__esModule',{'value':!![]}),exports[a403_0x4f5818(0xd7)]=void 0x0;const veeva_constants_1=require(a403_0x4f5818(0x94)),jszip_1=__importDefault(require('jszip')),status_enums_1=require(a403_0x4f5818(0xac)),veeva_error_1=require(a403_0x4f5818(0xa2));function a403_0x2a6e(_0x1f91c3,_0x44b644){const _0x193272=a403_0x5e24();return a403_0x2a6e=function(_0x662d0,_0x30c4f3){_0x662d0=_0x662d0-0x8d;let _0x5e24e6=_0x193272[_0x662d0];return _0x5e24e6;},a403_0x2a6e(_0x1f91c3,_0x44b644);}class PackageExportService{constructor({veevaService:_0x3aeb57,connection:_0x447fff,logger:_0x267274}){const _0x394cb3=a403_0x4f5818;this['_veevaService']=_0x3aeb57,this[_0x394cb3(0xc2)]=_0x447fff,this[_0x394cb3(0xc1)]=_0x267274;}async[a403_0x4f5818(0x9d)](_0x599478,_0x4bac19){const _0x367634=a403_0x4f5818;this[_0x367634(0xc1)][_0x367634(0xcf)](_0x367634(0x90));const _0x2a7124=veeva_constants_1[_0x367634(0xd2)][_0x367634(0xaf)]+_0x367634(0xc3),_0x187002=new Array(_0x599478)[_0x367634(0xbd)]({'summary__v':_0x4bac19,'object_type__v.api__name__v':_0x367634(0xb9)});return await this[_0x367634(0xaa)][_0x367634(0xba)](_0x2a7124,_0x187002);}async[a403_0x4f5818(0xc8)](_0x3980f2,_0x453f93){const _0x589c3b=a403_0x4f5818;this['_logger'][_0x589c3b(0xcf)]('Adding\x20components\x20to\x20outbound\x20package');const _0x26ed7e=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+_0x589c3b(0xcb),_0x3062a9=_0x3980f2[_0x589c3b(0xad)]((_0x54f089,_0x7936f3)=>({'vault_component__v':_0x54f089['id'],'outbound_package__v':_0x453f93[Math[_0x589c3b(0xcc)]((_0x7936f3+0x1)/veeva_constants_1[_0x589c3b(0xd2)][_0x589c3b(0xbb)])-0x1]}));return await this[_0x589c3b(0xaa)][_0x589c3b(0xba)](_0x26ed7e,_0x3062a9);}async[a403_0x4f5818(0x95)](_0x509095){const _0x1fb6a6=a403_0x4f5818;this['_logger'][_0x1fb6a6(0xcf)](_0x1fb6a6(0x8d));const _0x2890eb='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x509095[_0x1fb6a6(0xa8)](_0x1fb6a6(0xc6))+'\x27)',_0x8b515f=await this['_veevaService'][_0x1fb6a6(0xa4)](_0x2890eb);return _0x8b515f[_0x1fb6a6(0xb6)]((_0x144b2b,_0x3fd73c)=>_0x144b2b[_0x1fb6a6(0x92)](_0x3fd73c['id'],_0x3fd73c[_0x1fb6a6(0xc7)]),new Map());}async[a403_0x4f5818(0xda)](_0x42b781){const _0x10c56f=a403_0x4f5818;this[_0x10c56f(0xc1)]['log'](_0x10c56f(0x91));const _0x459c5c=[],_0x93c1e7=_0x42b781[_0x10c56f(0xad)](_0x362cd0=>{const _0xb4a02a=_0x10c56f;return this[_0xb4a02a(0xc2)]['post'](veeva_constants_1[_0xb4a02a(0xd2)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],encodeURI(_0xb4a02a(0xae))+'='+encodeURI(_0x362cd0),{'headers':{'Content-Type':_0xb4a02a(0x96)}});}),_0x40e97d=await Promise['all'](_0x93c1e7);for(const {data:_0x41325d}of _0x40e97d){if(_0x41325d[_0x10c56f(0xa6)]===status_enums_1[_0x10c56f(0x98)][_0x10c56f(0xa5)]){const {url:_0x4bccee}=_0x41325d;_0x459c5c[_0x10c56f(0xcd)](_0x4bccee);}else throw new veeva_error_1['VeevaError'](_0x41325d[_0x10c56f(0xb5)]);}return _0x459c5c;}async[a403_0x4f5818(0xb7)](_0x4203e6){const _0x248b1f=a403_0x4f5818;this[_0x248b1f(0xc1)][_0x248b1f(0xcf)](_0x248b1f(0xbe));const _0x46c721=[],_0x490b00=await this[_0x248b1f(0xaa)][_0x248b1f(0x99)](_0x4203e6);for(const _0x30847d of _0x490b00){const _0x40473f=_0x30847d[_0x248b1f(0xb0)]['filter'](_0x1996cc=>_0x1996cc[_0x248b1f(0xa9)]===_0x248b1f(0xb1))[_0x248b1f(0xad)](_0x13971e=>_0x13971e[_0x248b1f(0x9e)]);_0x46c721[_0x248b1f(0xcd)](..._0x40473f);}return _0x46c721;}async[a403_0x4f5818(0x8f)](_0x3865f2){const _0x4c2c20=a403_0x4f5818;var _0x4f9621;const _0xf7d67a=[];this[_0x4c2c20(0xc1)][_0x4c2c20(0xcf)](_0x4c2c20(0xc0));for(const _0x2a9155 of _0x3865f2){const {data:_0x203996,headers:_0x363a0}=await this[_0x4c2c20(0xc2)][_0x4c2c20(0xdc)](_0x2a9155,{'responseType':_0x4c2c20(0xd9)}),_0x45cfee=(_0x4f9621=_0x363a0[_0x4c2c20(0x9a)])===null||_0x4f9621===void 0x0?void 0x0:_0x4f9621['includes'](_0x4c2c20(0xa3));if(!_0x45cfee){const _0x3e4089=_0x203996,_0x352caf=new jszip_1[(_0x4c2c20(0xa1))]();await _0x352caf['loadAsync'](_0x3e4089),_0xf7d67a[_0x4c2c20(0xcd)](_0x352caf);}else{const _0x369216=JSON[_0x4c2c20(0x9b)](_0x203996);throw new veeva_error_1[(_0x4c2c20(0xbf))](_0x369216[_0x4c2c20(0xb5)]);}}return _0xf7d67a;}async['deletePackageComponents'](_0x49ef0e){const _0x42ea3c=a403_0x4f5818;this[_0x42ea3c(0xc1)][_0x42ea3c(0xcf)](_0x42ea3c(0x9f));const _0x152a2a=veeva_constants_1[_0x42ea3c(0xd2)][_0x42ea3c(0xaf)]+'package_component__v';await this[_0x42ea3c(0xaa)][_0x42ea3c(0xab)](_0x152a2a,_0x49ef0e);}async[a403_0x4f5818(0xd0)](_0x3b10b2){const _0x236896=a403_0x4f5818;this['_logger'][_0x236896(0xcf)](_0x236896(0xc5));const _0x1e3285=veeva_constants_1[_0x236896(0xd2)]['ENDPOINT_CREATE_RECORDS']+_0x236896(0xc3);await this['_veevaService']['deleteVeevaObjectRecords'](_0x1e3285,_0x3b10b2);}async[a403_0x4f5818(0xd1)](_0x1a28ad,_0x2c9139){const _0x207534=a403_0x4f5818,_0x22de8a=await this[_0x207534(0x9d)](Math[_0x207534(0xcc)](_0x1a28ad[_0x207534(0x93)]/veeva_constants_1[_0x207534(0xd2)][_0x207534(0xbb)]),_0x2c9139),_0x5757c2=await this['createPackageComponents'](_0x1a28ad,_0x22de8a),_0x5506a8=await this[_0x207534(0x95)](_0x22de8a),_0x4a2f81=await this[_0x207534(0xda)](Array[_0x207534(0x97)](_0x5506a8['values']())),_0x2fd515=await this['getEndpointArtifactList'](_0x4a2f81),_0x3c0c8b=await this[_0x207534(0x8f)](_0x2fd515);return await this[_0x207534(0xa7)](_0x5757c2),await this[_0x207534(0xd0)](_0x22de8a),_0x3c0c8b;}}exports[a403_0x4f5818(0xd7)]=PackageExportService;