const a359_0x5d76a9=a359_0x5a50;function a359_0x7f2d(){const _0x2bfadb=['package_component__v','1505XCpdEP','10903221soPaSf','fill','VeevaResponseStatus','constructor','getPackageNames','errors','map','ceil','links','ENDPOINT_CREATE_RECORDS','includes','arraybuffer','VeevaConstants','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','outbound_package__v','default','migration__sys','611364zxFdTX','toString','responseStatus','_connection','Retrieve\x20Outbound\x20Package\x20zip\x20list','15ecFSDw','deleteOutboundPackages','reduce','\x27,\x27','log','_logger','2004WFpcim','push','9tWmzaQ','createPackageComponents','1384924JgRYuC','filter','post','VeevaError','_veevaService','2074120wdiuFZ','__importDefault','export','PackageExportService','length','../classes/errors/veeva-error','Removing\x20components\x20from\x20outbound\x20packages.','MAXIMUM_SIZE_OF_PACKAGE','__esModule','parse','../constants/veeva.constants','packageName','deletePackageComponents','createExportOutboundPackages','Retrieve\x20Jobs\x20Status','createOutboundPackages','values','createVeevaObjectRecords','Getting\x20names\x20of\x20outbound\x20packages','content-type','all','ENDPOINT_EXPORT_IMPORT_PACKAGE','Create\x20Export\x20outbound\x20packages.','(((.+)+)+)+$','getEndpointArtifactList','SUCCESS','application/x-www-form-urlencoded','join','get','30439790xFZWHs','application/json','607885ECPeRT','name__v','search','jszip','executeVQL'];a359_0x7f2d=function(){return _0x2bfadb;};return a359_0x7f2d();}(function(_0x50b414,_0x3d1e55){const _0x4c17f5=a359_0x5a50,_0x5ddadd=_0x50b414();while(!![]){try{const _0x20e719=-parseInt(_0x4c17f5(0xe8))/0x1+-parseInt(_0x4c17f5(0xc4))/0x2+-parseInt(_0x4c17f5(0xba))/0x3*(-parseInt(_0x4c17f5(0x100))/0x4)+-parseInt(_0x4c17f5(0xee))/0x5*(-parseInt(_0x4c17f5(0xc0))/0x6)+-parseInt(_0x4c17f5(0xef))/0x7+-parseInt(_0x4c17f5(0xc9))/0x8+parseInt(_0x4c17f5(0xc2))/0x9*(parseInt(_0x4c17f5(0xe6))/0xa);if(_0x20e719===_0x3d1e55)break;else _0x5ddadd['push'](_0x5ddadd['shift']());}catch(_0x4c5b3c){_0x5ddadd['push'](_0x5ddadd['shift']());}}}(a359_0x7f2d,0xc13cf));const a359_0xeaad3=(function(){let _0x32bb02=!![];return function(_0x4af8e1,_0x1a62ff){const _0x11078f=_0x32bb02?function(){if(_0x1a62ff){const _0xba560e=_0x1a62ff['apply'](_0x4af8e1,arguments);return _0x1a62ff=null,_0xba560e;}}:function(){};return _0x32bb02=![],_0x11078f;};}()),a359_0x3b202d=a359_0xeaad3(this,function(){const _0x27c776=a359_0x5a50;return a359_0x3b202d[_0x27c776(0xb6)]()[_0x27c776(0xea)](_0x27c776(0xe0))[_0x27c776(0xb6)]()[_0x27c776(0xf2)](a359_0x3b202d)[_0x27c776(0xea)](_0x27c776(0xe0));});a359_0x3b202d();'use strict';var __importDefault=this&&this[a359_0x5d76a9(0xca)]||function(_0x2f383b){const _0x4e72ab=a359_0x5d76a9;return _0x2f383b&&_0x2f383b[_0x4e72ab(0xd1)]?_0x2f383b:{'default':_0x2f383b};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a359_0x5d76a9(0xcc)]=void 0x0;function a359_0x5a50(_0x1edaaf,_0xaad7ab){const _0x1b6711=a359_0x7f2d();return a359_0x5a50=function(_0x3b202d,_0xeaad3){_0x3b202d=_0x3b202d-0xb6;let _0x7f2da3=_0x1b6711[_0x3b202d];return _0x7f2da3;},a359_0x5a50(_0x1edaaf,_0xaad7ab);}const veeva_constants_1=require(a359_0x5d76a9(0xd3)),jszip_1=__importDefault(require(a359_0x5d76a9(0xeb))),status_enums_1=require('../enums/status.enums'),veeva_error_1=require(a359_0x5d76a9(0xce));class PackageExportService{constructor({veevaService:_0x551cb0,connection:_0x17af6c,logger:_0x137824}){const _0x39ed3a=a359_0x5d76a9;this[_0x39ed3a(0xc8)]=_0x551cb0,this[_0x39ed3a(0xb8)]=_0x17af6c,this[_0x39ed3a(0xbf)]=_0x137824;}async[a359_0x5d76a9(0xd8)](_0x5358a9,_0x20f176){const _0x5d4ecc=a359_0x5d76a9;this[_0x5d4ecc(0xbf)][_0x5d4ecc(0xbe)]('Creating\x20outbound\x20packages');const _0xc39d48=veeva_constants_1[_0x5d4ecc(0xfb)][_0x5d4ecc(0xf8)]+_0x5d4ecc(0xfd),_0x405abd=new Array(_0x5358a9)[_0x5d4ecc(0xf0)]({'summary__v':_0x20f176,'object_type__v.api__name__v':_0x5d4ecc(0xff)});return await this[_0x5d4ecc(0xc8)]['createVeevaObjectRecords'](_0xc39d48,_0x405abd);}async['createPackageComponents'](_0x131bd8,_0x1cb88d){const _0x368261=a359_0x5d76a9;this[_0x368261(0xbf)][_0x368261(0xbe)]('Adding\x20components\x20to\x20outbound\x20package');const _0xa5caa1=veeva_constants_1[_0x368261(0xfb)][_0x368261(0xf8)]+_0x368261(0xed),_0x3dd9ac=_0x131bd8[_0x368261(0xf5)]((_0x523bcf,_0x28400d)=>({'vault_component__v':_0x523bcf['id'],'outbound_package__v':_0x1cb88d[Math[_0x368261(0xf6)]((_0x28400d+0x1)/veeva_constants_1[_0x368261(0xfb)][_0x368261(0xd0)])-0x1]}));return await this['_veevaService'][_0x368261(0xda)](_0xa5caa1,_0x3dd9ac);}async[a359_0x5d76a9(0xf3)](_0x1cad46){const _0x5ee8b9=a359_0x5d76a9;this['_logger'][_0x5ee8b9(0xbe)](_0x5ee8b9(0xdb));const _0x5497bd=_0x5ee8b9(0xfc)+_0x1cad46[_0x5ee8b9(0xe4)](_0x5ee8b9(0xbd))+'\x27)',_0x303c22=await this['_veevaService'][_0x5ee8b9(0xec)](_0x5497bd);return _0x303c22[_0x5ee8b9(0xbc)]((_0x9f141a,_0x5a07a6)=>_0x9f141a['set'](_0x5a07a6['id'],_0x5a07a6[_0x5ee8b9(0xe9)]),new Map());}async[a359_0x5d76a9(0xd6)](_0x394d83){const _0x58f068=a359_0x5d76a9;this[_0x58f068(0xbf)][_0x58f068(0xbe)](_0x58f068(0xdf));const _0x29796c=[],_0x2b1f20=_0x394d83['map'](_0x3932ed=>{const _0x26ceb4=_0x58f068;return this['_connection'][_0x26ceb4(0xc6)](veeva_constants_1[_0x26ceb4(0xfb)][_0x26ceb4(0xde)],encodeURI(_0x26ceb4(0xd4))+'='+encodeURI(_0x3932ed),{'headers':{'Content-Type':_0x26ceb4(0xe3)}});}),_0x3da3cd=await Promise[_0x58f068(0xdd)](_0x2b1f20);for(const {data:_0x59a3e7}of _0x3da3cd){if(_0x59a3e7[_0x58f068(0xb7)]===status_enums_1[_0x58f068(0xf1)][_0x58f068(0xe2)]){const {url:_0x53895f}=_0x59a3e7;_0x29796c[_0x58f068(0xc1)](_0x53895f);}else throw new veeva_error_1[(_0x58f068(0xc7))](_0x59a3e7[_0x58f068(0xf4)]);}return _0x29796c;}async[a359_0x5d76a9(0xe1)](_0x35753e){const _0x52f6fc=a359_0x5d76a9;this[_0x52f6fc(0xbf)][_0x52f6fc(0xbe)](_0x52f6fc(0xd7));const _0x229042=[],_0x4e618b=await this['_veevaService']['getJobResult'](_0x35753e);for(const _0x406128 of _0x4e618b){const _0x425c06=_0x406128[_0x52f6fc(0xf7)][_0x52f6fc(0xc5)](_0x5c7e7c=>_0x5c7e7c['rel']==='artifacts')[_0x52f6fc(0xf5)](_0x518677=>_0x518677['href']);_0x229042[_0x52f6fc(0xc1)](..._0x425c06);}return _0x229042;}async['retrieveVPKList'](_0x5e833c){const _0x28ba0b=a359_0x5d76a9;var _0x2a1c8d;const _0x240678=[];this[_0x28ba0b(0xbf)]['log'](_0x28ba0b(0xb9));for(const _0x1351ab of _0x5e833c){const {data:_0x9a6b71,headers:_0x1f4e2c}=await this[_0x28ba0b(0xb8)][_0x28ba0b(0xe5)](_0x1351ab,{'responseType':_0x28ba0b(0xfa)}),_0x598471=(_0x2a1c8d=_0x1f4e2c[_0x28ba0b(0xdc)])===null||_0x2a1c8d===void 0x0?void 0x0:_0x2a1c8d[_0x28ba0b(0xf9)](_0x28ba0b(0xe7));if(!_0x598471){const _0x23716f=_0x9a6b71,_0x54ca90=new jszip_1[(_0x28ba0b(0xfe))]();await _0x54ca90['loadAsync'](_0x23716f),_0x240678[_0x28ba0b(0xc1)](_0x54ca90);}else{const _0x2ba04f=JSON[_0x28ba0b(0xd2)](_0x9a6b71);throw new veeva_error_1[(_0x28ba0b(0xc7))](_0x2ba04f[_0x28ba0b(0xf4)]);}}return _0x240678;}async[a359_0x5d76a9(0xd5)](_0x39086f){const _0x11209e=a359_0x5d76a9;this['_logger'][_0x11209e(0xbe)](_0x11209e(0xcf));const _0xffb536=veeva_constants_1[_0x11209e(0xfb)]['ENDPOINT_CREATE_RECORDS']+_0x11209e(0xed);await this['_veevaService']['deleteVeevaObjectRecords'](_0xffb536,_0x39086f);}async[a359_0x5d76a9(0xbb)](_0x3b146a){const _0x2cbf6c=a359_0x5d76a9;this[_0x2cbf6c(0xbf)]['log']('Deleting\x20outbound\x20packages.');const _0xffdd43=veeva_constants_1['VeevaConstants'][_0x2cbf6c(0xf8)]+'outbound_package__v';await this[_0x2cbf6c(0xc8)]['deleteVeevaObjectRecords'](_0xffdd43,_0x3b146a);}async[a359_0x5d76a9(0xcb)](_0x4d2975,_0x2e1192){const _0x1b3102=a359_0x5d76a9,_0x190123=await this[_0x1b3102(0xd8)](Math[_0x1b3102(0xf6)](_0x4d2975[_0x1b3102(0xcd)]/veeva_constants_1[_0x1b3102(0xfb)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x2e1192),_0x8c6a4a=await this[_0x1b3102(0xc3)](_0x4d2975,_0x190123),_0x151678=await this[_0x1b3102(0xf3)](_0x190123),_0x5331fc=await this[_0x1b3102(0xd6)](Array['from'](_0x151678[_0x1b3102(0xd9)]())),_0x445f3e=await this[_0x1b3102(0xe1)](_0x5331fc),_0x3127ce=await this['retrieveVPKList'](_0x445f3e);return await this[_0x1b3102(0xd5)](_0x8c6a4a),await this['deleteOutboundPackages'](_0x190123),_0x3127ce;}}exports[a359_0x5d76a9(0xcc)]=PackageExportService;