const a402_0xeb1f7a=a402_0x1e5b;function a402_0x1e5b(_0x5980cb,_0x20c27f){const _0x112779=a402_0x43ae();return a402_0x1e5b=function(_0x35ea6a,_0x4db7bb){_0x35ea6a=_0x35ea6a-0x1d9;let _0x43ae46=_0x112779[_0x35ea6a];return _0x43ae46;},a402_0x1e5b(_0x5980cb,_0x20c27f);}(function(_0x36be97,_0x19bed3){const _0x44f2f4=a402_0x1e5b,_0x32627c=_0x36be97();while(!![]){try{const _0x32b7c2=-parseInt(_0x44f2f4(0x21b))/0x1*(parseInt(_0x44f2f4(0x1dc))/0x2)+parseInt(_0x44f2f4(0x1f2))/0x3*(-parseInt(_0x44f2f4(0x205))/0x4)+parseInt(_0x44f2f4(0x1f3))/0x5+-parseInt(_0x44f2f4(0x1fb))/0x6+-parseInt(_0x44f2f4(0x1ec))/0x7*(-parseInt(_0x44f2f4(0x215))/0x8)+-parseInt(_0x44f2f4(0x220))/0x9+parseInt(_0x44f2f4(0x21a))/0xa*(parseInt(_0x44f2f4(0x1fc))/0xb);if(_0x32b7c2===_0x19bed3)break;else _0x32627c['push'](_0x32627c['shift']());}catch(_0x48b0e6){_0x32627c['push'](_0x32627c['shift']());}}}(a402_0x43ae,0xf10af));const a402_0x4db7bb=(function(){let _0x3939a4=!![];return function(_0x8c6489,_0x52be6e){const _0x347161=_0x3939a4?function(){const _0x3f74ad=a402_0x1e5b;if(_0x52be6e){const _0x4fc3e5=_0x52be6e[_0x3f74ad(0x1ed)](_0x8c6489,arguments);return _0x52be6e=null,_0x4fc3e5;}}:function(){};return _0x3939a4=![],_0x347161;};}()),a402_0x35ea6a=a402_0x4db7bb(this,function(){const _0x35036d=a402_0x1e5b;return a402_0x35ea6a['toString']()[_0x35036d(0x1f5)]('(((.+)+)+)+$')['toString']()['constructor'](a402_0x35ea6a)[_0x35036d(0x1f5)]('(((.+)+)+)+$');});a402_0x35ea6a();'use strict';function a402_0x43ae(){const _0x271fa2=['4oYYmlE','package_component__v','loadAsync','\x27,\x27','Create\x20Export\x20outbound\x20packages.','1351242KghRSx','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','PackageExportService','application/x-www-form-urlencoded','createVeevaObjectRecords','ceil','VeevaConstants','527476iQmUgc','VeevaError','defineProperty','../constants/veeva.constants','retrieveVPKList','join','getEndpointArtifactList','get','parse','fill','createExportOutboundPackages','createPackageComponents','includes','reduce','set','Adding\x20components\x20to\x20outbound\x20package','483JKdGxI','apply','ENDPOINT_EXPORT_IMPORT_PACKAGE','errors','jszip','map','318OEavLs','8371945goBfhj','values','search','default','_connection','SUCCESS','__esModule','getPackageNames','10575048GuXEyf','11MGLLlh','deleteOutboundPackages','artifacts','VeevaResponseStatus','__importDefault','_veevaService','length','post','deleteVeevaObjectRecords','45176NDnvoG','deletePackageComponents','all','Retrieve\x20Outbound\x20Package\x20zip\x20list','links','Removing\x20components\x20from\x20outbound\x20packages.','responseStatus','packageName','from','name__v','rel','ENDPOINT_CREATE_RECORDS','outbound_package__v','getJobResult','push','_logger','180216nbhRqT','application/json','log','href','createOutboundPackages','19233210CGHstF'];a402_0x43ae=function(){return _0x271fa2;};return a402_0x43ae();}var __importDefault=this&&this[a402_0xeb1f7a(0x200)]||function(_0x52954f){const _0x2ea2a7=a402_0xeb1f7a;return _0x52954f&&_0x52954f[_0x2ea2a7(0x1f9)]?_0x52954f:{'default':_0x52954f};};Object[a402_0xeb1f7a(0x1de)](exports,'__esModule',{'value':!![]}),exports[a402_0xeb1f7a(0x222)]=void 0x0;const veeva_constants_1=require(a402_0xeb1f7a(0x1df)),jszip_1=__importDefault(require(a402_0xeb1f7a(0x1f0))),status_enums_1=require('../enums/status.enums'),veeva_error_1=require('../classes/errors/veeva-error');class PackageExportService{constructor({veevaService:_0x19abee,connection:_0x168f50,logger:_0x43bf27}){const _0x51922c=a402_0xeb1f7a;this[_0x51922c(0x201)]=_0x19abee,this[_0x51922c(0x1f7)]=_0x168f50,this[_0x51922c(0x214)]=_0x43bf27;}async[a402_0xeb1f7a(0x219)](_0x24cde7,_0x17f494){const _0x322fc4=a402_0xeb1f7a;this[_0x322fc4(0x214)][_0x322fc4(0x217)]('Creating\x20outbound\x20packages');const _0x14bb26=veeva_constants_1[_0x322fc4(0x1db)][_0x322fc4(0x210)]+'outbound_package__v',_0x4506ff=new Array(_0x24cde7)[_0x322fc4(0x1e5)]({'summary__v':_0x17f494,'object_type__v.api__name__v':'migration__sys'});return await this['_veevaService'][_0x322fc4(0x1d9)](_0x14bb26,_0x4506ff);}async['createPackageComponents'](_0x5eaffe,_0x4b6156){const _0x4fdfa3=a402_0xeb1f7a;this[_0x4fdfa3(0x214)][_0x4fdfa3(0x217)](_0x4fdfa3(0x1eb));const _0x45d2f8=veeva_constants_1[_0x4fdfa3(0x1db)][_0x4fdfa3(0x210)]+_0x4fdfa3(0x21c),_0x2ae723=_0x5eaffe[_0x4fdfa3(0x1f1)]((_0x5a5139,_0x333cb9)=>({'vault_component__v':_0x5a5139['id'],'outbound_package__v':_0x4b6156[Math[_0x4fdfa3(0x1da)]((_0x333cb9+0x1)/veeva_constants_1[_0x4fdfa3(0x1db)]['MAXIMUM_SIZE_OF_PACKAGE'])-0x1]}));return await this[_0x4fdfa3(0x201)]['createVeevaObjectRecords'](_0x45d2f8,_0x2ae723);}async[a402_0xeb1f7a(0x1fa)](_0x516837){const _0x56c96b=a402_0xeb1f7a;this[_0x56c96b(0x214)][_0x56c96b(0x217)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x5ef4cc=_0x56c96b(0x221)+_0x516837[_0x56c96b(0x1e1)](_0x56c96b(0x21e))+'\x27)',_0x463d3c=await this['_veevaService']['executeVQL'](_0x5ef4cc);return _0x463d3c[_0x56c96b(0x1e9)]((_0x4c84c2,_0xca4f1d)=>_0x4c84c2[_0x56c96b(0x1ea)](_0xca4f1d['id'],_0xca4f1d[_0x56c96b(0x20e)]),new Map());}async[a402_0xeb1f7a(0x1e6)](_0x35c25b){const _0x1b6078=a402_0xeb1f7a;this[_0x1b6078(0x214)]['log'](_0x1b6078(0x21f));const _0x19074e=[],_0xcfe7d0=_0x35c25b[_0x1b6078(0x1f1)](_0x1e2566=>{const _0x2e6e76=_0x1b6078;return this[_0x2e6e76(0x1f7)][_0x2e6e76(0x203)](veeva_constants_1[_0x2e6e76(0x1db)][_0x2e6e76(0x1ee)],encodeURI(_0x2e6e76(0x20c))+'='+encodeURI(_0x1e2566),{'headers':{'Content-Type':_0x2e6e76(0x223)}});}),_0x2a12f8=await Promise[_0x1b6078(0x207)](_0xcfe7d0);for(const {data:_0x341dff}of _0x2a12f8){if(_0x341dff[_0x1b6078(0x20b)]===status_enums_1[_0x1b6078(0x1ff)][_0x1b6078(0x1f8)]){const {url:_0x324b1e}=_0x341dff;_0x19074e[_0x1b6078(0x213)](_0x324b1e);}else throw new veeva_error_1[(_0x1b6078(0x1dd))](_0x341dff[_0x1b6078(0x1ef)]);}return _0x19074e;}async[a402_0xeb1f7a(0x1e2)](_0x5409f3){const _0x235fad=a402_0xeb1f7a;this[_0x235fad(0x214)][_0x235fad(0x217)]('Retrieve\x20Jobs\x20Status');const _0x361276=[],_0x315a1a=await this['_veevaService'][_0x235fad(0x212)](_0x5409f3);for(const _0x19cf24 of _0x315a1a){const _0x5370b3=_0x19cf24[_0x235fad(0x209)]['filter'](_0x2459fe=>_0x2459fe[_0x235fad(0x20f)]===_0x235fad(0x1fe))['map'](_0x144691=>_0x144691[_0x235fad(0x218)]);_0x361276[_0x235fad(0x213)](..._0x5370b3);}return _0x361276;}async[a402_0xeb1f7a(0x1e0)](_0x3c6d3b){const _0x52643d=a402_0xeb1f7a;var _0x3133a8;const _0x2a07a6=[];this[_0x52643d(0x214)][_0x52643d(0x217)](_0x52643d(0x208));for(const _0xb29109 of _0x3c6d3b){const {data:_0x3cc68a,headers:_0x1c7573}=await this['_connection'][_0x52643d(0x1e3)](_0xb29109,{'responseType':'arraybuffer'}),_0x27cfbb=(_0x3133a8=_0x1c7573['content-type'])===null||_0x3133a8===void 0x0?void 0x0:_0x3133a8[_0x52643d(0x1e8)](_0x52643d(0x216));if(!_0x27cfbb){const _0x208a42=_0x3cc68a,_0x1d8e5a=new jszip_1[(_0x52643d(0x1f6))]();await _0x1d8e5a[_0x52643d(0x21d)](_0x208a42),_0x2a07a6['push'](_0x1d8e5a);}else{const _0x39e5fc=JSON[_0x52643d(0x1e4)](_0x3cc68a);throw new veeva_error_1[(_0x52643d(0x1dd))](_0x39e5fc[_0x52643d(0x1ef)]);}}return _0x2a07a6;}async[a402_0xeb1f7a(0x206)](_0x3af57a){const _0x20d45a=a402_0xeb1f7a;this[_0x20d45a(0x214)][_0x20d45a(0x217)](_0x20d45a(0x20a));const _0x3c409f=veeva_constants_1['VeevaConstants'][_0x20d45a(0x210)]+_0x20d45a(0x21c);await this[_0x20d45a(0x201)][_0x20d45a(0x204)](_0x3c409f,_0x3af57a);}async[a402_0xeb1f7a(0x1fd)](_0x133c70){const _0x5ed102=a402_0xeb1f7a;this[_0x5ed102(0x214)][_0x5ed102(0x217)]('Deleting\x20outbound\x20packages.');const _0x4d9ac2=veeva_constants_1[_0x5ed102(0x1db)][_0x5ed102(0x210)]+_0x5ed102(0x211);await this[_0x5ed102(0x201)][_0x5ed102(0x204)](_0x4d9ac2,_0x133c70);}async['export'](_0x4062ea,_0x5d1576){const _0x1dc37a=a402_0xeb1f7a,_0x23be79=await this['createOutboundPackages'](Math['ceil'](_0x4062ea[_0x1dc37a(0x202)]/veeva_constants_1[_0x1dc37a(0x1db)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x5d1576),_0x1d4fcf=await this[_0x1dc37a(0x1e7)](_0x4062ea,_0x23be79),_0x41fbe7=await this[_0x1dc37a(0x1fa)](_0x23be79),_0xc66038=await this[_0x1dc37a(0x1e6)](Array[_0x1dc37a(0x20d)](_0x41fbe7[_0x1dc37a(0x1f4)]())),_0x2c79e2=await this['getEndpointArtifactList'](_0xc66038),_0x2d54b9=await this[_0x1dc37a(0x1e0)](_0x2c79e2);return await this['deletePackageComponents'](_0x1d4fcf),await this[_0x1dc37a(0x1fd)](_0x23be79),_0x2d54b9;}}exports[a402_0xeb1f7a(0x222)]=PackageExportService;