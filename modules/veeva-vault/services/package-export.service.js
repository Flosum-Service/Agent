const a391_0x29de68=a391_0x1a0b;(function(_0x313124,_0xaead4f){const _0x5bcddf=a391_0x1a0b,_0x1e8a0c=_0x313124();while(!![]){try{const _0x17db28=parseInt(_0x5bcddf(0x78))/0x1+parseInt(_0x5bcddf(0xa3))/0x2*(parseInt(_0x5bcddf(0xb1))/0x3)+parseInt(_0x5bcddf(0x80))/0x4+-parseInt(_0x5bcddf(0x7d))/0x5+-parseInt(_0x5bcddf(0x76))/0x6+parseInt(_0x5bcddf(0xa6))/0x7*(parseInt(_0x5bcddf(0x7f))/0x8)+-parseInt(_0x5bcddf(0x94))/0x9;if(_0x17db28===_0xaead4f)break;else _0x1e8a0c['push'](_0x1e8a0c['shift']());}catch(_0xae95cc){_0x1e8a0c['push'](_0x1e8a0c['shift']());}}}(a391_0x1520,0x218c9));const a391_0x2d69b2=(function(){let _0x3ca1a5=!![];return function(_0x15a14f,_0x2cf983){const _0x38f612=_0x3ca1a5?function(){const _0x1d78bd=a391_0x1a0b;if(_0x2cf983){const _0x5ac51a=_0x2cf983[_0x1d78bd(0x85)](_0x15a14f,arguments);return _0x2cf983=null,_0x5ac51a;}}:function(){};return _0x3ca1a5=![],_0x38f612;};}()),a391_0x6e2fe2=a391_0x2d69b2(this,function(){const _0x5c2990=a391_0x1a0b;return a391_0x6e2fe2[_0x5c2990(0x88)]()[_0x5c2990(0x98)]('(((.+)+)+)+$')['toString']()[_0x5c2990(0x87)](a391_0x6e2fe2)[_0x5c2990(0x98)](_0x5c2990(0xa5));});a391_0x6e2fe2();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5670a2){const _0x389a9c=a391_0x1a0b;return _0x5670a2&&_0x5670a2[_0x389a9c(0xab)]?_0x5670a2:{'default':_0x5670a2};};Object[a391_0x29de68(0x83)](exports,'__esModule',{'value':!![]}),exports[a391_0x29de68(0xac)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require(a391_0x29de68(0x79))),status_enums_1=require(a391_0x29de68(0xb3)),veeva_error_1=require(a391_0x29de68(0x95));function a391_0x1520(){const _0x315f58=['Getting\x20names\x20of\x20outbound\x20packages','reduce','2635479WdlBbP','../classes/errors/veeva-error','fill','deletePackageComponents','search','loadAsync','Creating\x20outbound\x20packages','createVeevaObjectRecords','Retrieve\x20Jobs\x20Status','SUCCESS','get','values','MAXIMUM_SIZE_OF_PACKAGE','export','includes','138IxTsit','getEndpointArtifactList','(((.+)+)+)+$','364EbhXJG','getPackageNames','executeVQL','Deleting\x20outbound\x20packages.','Adding\x20components\x20to\x20outbound\x20package','__esModule','PackageExportService','createOutboundPackages','errors','Retrieve\x20Outbound\x20Package\x20zip\x20list','outbound_package__v','2073GfByoF','arraybuffer','../enums/status.enums','_logger','application/x-www-form-urlencoded','Create\x20Export\x20outbound\x20packages.','_veevaService','_connection','package_component__v','ENDPOINT_CREATE_RECORDS','VeevaConstants','getJobResult','responseStatus','application/json','VeevaResponseStatus','627888DUNIks','filter','214774hVInTD','jszip','content-type','VeevaError','map','462435lcvEbP','rel','16136rAsrwQ','1040184OPiriD','deleteOutboundPackages','Removing\x20components\x20from\x20outbound\x20packages.','defineProperty','retrieveVPKList','apply','href','constructor','toString','join','log','migration__sys','ceil','createPackageComponents','\x27,\x27','push','packageName','deleteVeevaObjectRecords'];a391_0x1520=function(){return _0x315f58;};return a391_0x1520();}class PackageExportService{constructor({veevaService:_0x4bdd61,connection:_0x4d03b9,logger:_0x4a39c4}){const _0x616cc0=a391_0x29de68;this[_0x616cc0(0x6d)]=_0x4bdd61,this[_0x616cc0(0x6e)]=_0x4d03b9,this[_0x616cc0(0xb4)]=_0x4a39c4;}async[a391_0x29de68(0xad)](_0x13847d,_0x38f837){const _0x59860b=a391_0x29de68;this['_logger'][_0x59860b(0x8a)](_0x59860b(0x9a));const _0x3425a0=veeva_constants_1[_0x59860b(0x71)][_0x59860b(0x70)]+_0x59860b(0xb0),_0x46035b=new Array(_0x13847d)[_0x59860b(0x96)]({'summary__v':_0x38f837,'object_type__v.api__name__v':_0x59860b(0x8b)});return await this[_0x59860b(0x6d)][_0x59860b(0x9b)](_0x3425a0,_0x46035b);}async['createPackageComponents'](_0x2631ae,_0x4d6112){const _0x27455e=a391_0x29de68;this[_0x27455e(0xb4)][_0x27455e(0x8a)](_0x27455e(0xaa));const _0x354dd8=veeva_constants_1[_0x27455e(0x71)][_0x27455e(0x70)]+'package_component__v',_0x95f0ac=_0x2631ae['map']((_0x1a4951,_0x590351)=>({'vault_component__v':_0x1a4951['id'],'outbound_package__v':_0x4d6112[Math['ceil']((_0x590351+0x1)/veeva_constants_1['VeevaConstants'][_0x27455e(0xa0)])-0x1]}));return await this['_veevaService'][_0x27455e(0x9b)](_0x354dd8,_0x95f0ac);}async[a391_0x29de68(0xa7)](_0x31fe9c){const _0x59d845=a391_0x29de68;this[_0x59d845(0xb4)][_0x59d845(0x8a)](_0x59d845(0x92));const _0x4a36d0='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x31fe9c[_0x59d845(0x89)](_0x59d845(0x8e))+'\x27)',_0x227e1a=await this[_0x59d845(0x6d)][_0x59d845(0xa8)](_0x4a36d0);return _0x227e1a[_0x59d845(0x93)]((_0x156048,_0x552047)=>_0x156048['set'](_0x552047['id'],_0x552047['name__v']),new Map());}async['createExportOutboundPackages'](_0x107c1a){const _0x337e8a=a391_0x29de68;this[_0x337e8a(0xb4)]['log'](_0x337e8a(0x6c));const _0x1eef37=[],_0x2536f9=_0x107c1a[_0x337e8a(0x7c)](_0x4cffb0=>{const _0x30b2b5=_0x337e8a;return this['_connection']['post'](veeva_constants_1[_0x30b2b5(0x71)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],encodeURI(_0x30b2b5(0x90))+'='+encodeURI(_0x4cffb0),{'headers':{'Content-Type':_0x30b2b5(0xb5)}});}),_0x484b24=await Promise['all'](_0x2536f9);for(const {data:_0x3677ca}of _0x484b24){if(_0x3677ca[_0x337e8a(0x73)]===status_enums_1[_0x337e8a(0x75)][_0x337e8a(0x9d)]){const {url:_0x5f26f9}=_0x3677ca;_0x1eef37[_0x337e8a(0x8f)](_0x5f26f9);}else throw new veeva_error_1[(_0x337e8a(0x7b))](_0x3677ca[_0x337e8a(0xae)]);}return _0x1eef37;}async[a391_0x29de68(0xa4)](_0x820c17){const _0x5c74da=a391_0x29de68;this[_0x5c74da(0xb4)][_0x5c74da(0x8a)](_0x5c74da(0x9c));const _0x56e057=[],_0x233aa3=await this[_0x5c74da(0x6d)][_0x5c74da(0x72)](_0x820c17);for(const _0x24b3bd of _0x233aa3){const _0x3251f0=_0x24b3bd['links'][_0x5c74da(0x77)](_0x17f577=>_0x17f577[_0x5c74da(0x7e)]==='artifacts')[_0x5c74da(0x7c)](_0x136c49=>_0x136c49[_0x5c74da(0x86)]);_0x56e057[_0x5c74da(0x8f)](..._0x3251f0);}return _0x56e057;}async[a391_0x29de68(0x84)](_0x57c834){const _0x3188d1=a391_0x29de68;var _0x4be441;const _0x2ee4c4=[];this[_0x3188d1(0xb4)][_0x3188d1(0x8a)](_0x3188d1(0xaf));for(const _0x3126fe of _0x57c834){const {data:_0x5dd585,headers:_0xbe4d92}=await this[_0x3188d1(0x6e)][_0x3188d1(0x9e)](_0x3126fe,{'responseType':_0x3188d1(0xb2)}),_0x3de3d4=(_0x4be441=_0xbe4d92[_0x3188d1(0x7a)])===null||_0x4be441===void 0x0?void 0x0:_0x4be441[_0x3188d1(0xa2)](_0x3188d1(0x74));if(!_0x3de3d4){const _0x31cf1e=_0x5dd585,_0x39dfb8=new jszip_1['default']();await _0x39dfb8[_0x3188d1(0x99)](_0x31cf1e),_0x2ee4c4[_0x3188d1(0x8f)](_0x39dfb8);}else{const _0x5a8117=JSON['parse'](_0x5dd585);throw new veeva_error_1[(_0x3188d1(0x7b))](_0x5a8117['errors']);}}return _0x2ee4c4;}async[a391_0x29de68(0x97)](_0x2e5aac){const _0x94a7c0=a391_0x29de68;this[_0x94a7c0(0xb4)][_0x94a7c0(0x8a)](_0x94a7c0(0x82));const _0x4d0af8=veeva_constants_1[_0x94a7c0(0x71)][_0x94a7c0(0x70)]+_0x94a7c0(0x6f);await this['_veevaService'][_0x94a7c0(0x91)](_0x4d0af8,_0x2e5aac);}async[a391_0x29de68(0x81)](_0x5e3dec){const _0x2ce3fc=a391_0x29de68;this[_0x2ce3fc(0xb4)][_0x2ce3fc(0x8a)](_0x2ce3fc(0xa9));const _0x1104f0=veeva_constants_1['VeevaConstants'][_0x2ce3fc(0x70)]+_0x2ce3fc(0xb0);await this[_0x2ce3fc(0x6d)][_0x2ce3fc(0x91)](_0x1104f0,_0x5e3dec);}async[a391_0x29de68(0xa1)](_0x30ede1,_0xc6edce){const _0x37609f=a391_0x29de68,_0x5d2821=await this[_0x37609f(0xad)](Math[_0x37609f(0x8c)](_0x30ede1['length']/veeva_constants_1[_0x37609f(0x71)][_0x37609f(0xa0)]),_0xc6edce),_0x5f03c7=await this[_0x37609f(0x8d)](_0x30ede1,_0x5d2821),_0x411f6a=await this[_0x37609f(0xa7)](_0x5d2821),_0x4b7fe9=await this['createExportOutboundPackages'](Array['from'](_0x411f6a[_0x37609f(0x9f)]())),_0x24126c=await this[_0x37609f(0xa4)](_0x4b7fe9),_0x265ad2=await this[_0x37609f(0x84)](_0x24126c);return await this[_0x37609f(0x97)](_0x5f03c7),await this[_0x37609f(0x81)](_0x5d2821),_0x265ad2;}}function a391_0x1a0b(_0x4fd464,_0xe2361f){const _0x2109e2=a391_0x1520();return a391_0x1a0b=function(_0x6e2fe2,_0x2d69b2){_0x6e2fe2=_0x6e2fe2-0x6c;let _0x152033=_0x2109e2[_0x6e2fe2];return _0x152033;},a391_0x1a0b(_0x4fd464,_0xe2361f);}exports[a391_0x29de68(0xac)]=PackageExportService;