const a390_0x516705=a390_0x660f;(function(_0x5713dd,_0x4bf0d7){const _0x33292e=a390_0x660f,_0x5d3415=_0x5713dd();while(!![]){try{const _0x32f823=parseInt(_0x33292e(0x9f))/0x1+parseInt(_0x33292e(0xb6))/0x2*(parseInt(_0x33292e(0x9a))/0x3)+-parseInt(_0x33292e(0xa8))/0x4*(-parseInt(_0x33292e(0x96))/0x5)+parseInt(_0x33292e(0xa7))/0x6*(-parseInt(_0x33292e(0xc7))/0x7)+-parseInt(_0x33292e(0xcb))/0x8*(parseInt(_0x33292e(0xa2))/0x9)+-parseInt(_0x33292e(0xaf))/0xa+parseInt(_0x33292e(0x90))/0xb;if(_0x32f823===_0x4bf0d7)break;else _0x5d3415['push'](_0x5d3415['shift']());}catch(_0x5532d5){_0x5d3415['push'](_0x5d3415['shift']());}}}(a390_0x4598,0xc9e4a));const a390_0x4ccc0c=(function(){let _0x37d772=!![];return function(_0x47bb6e,_0x325759){const _0x56d2aa=_0x37d772?function(){if(_0x325759){const _0xac6f36=_0x325759['apply'](_0x47bb6e,arguments);return _0x325759=null,_0xac6f36;}}:function(){};return _0x37d772=![],_0x56d2aa;};}()),a390_0x48ddfb=a390_0x4ccc0c(this,function(){const _0x2baedc=a390_0x660f;return a390_0x48ddfb[_0x2baedc(0xb1)]()['search'](_0x2baedc(0xbc))[_0x2baedc(0xb1)]()[_0x2baedc(0xbf)](a390_0x48ddfb)[_0x2baedc(0xa5)](_0x2baedc(0xbc));});a390_0x48ddfb();function a390_0x4598(){const _0x51c4b5=['VeevaConstants','11282381mZFLuY','filter','log','createOutboundPackages','packageName','href','5Mjltei','executeVQL','from','getPackageNames','21AWZICu','deletePackageComponents','ENDPOINT_CREATE_RECORDS','set','getJobResult','1548192USOllP','application/x-www-form-urlencoded','post','110493adfUEK','includes','Retrieve\x20Outbound\x20Package\x20zip\x20list','search','PackageExportService','6667158mmGFZe','362172sysYCU','parse','artifacts','reduce','Removing\x20components\x20from\x20outbound\x20packages.','SUCCESS','__esModule','11817190nIutZu','Create\x20Export\x20outbound\x20packages.','toString','length','VeevaError','createExportOutboundPackages','push','147670UmIAFa','deleteVeevaObjectRecords','responseStatus','_veevaService','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','name__v','(((.+)+)+)+$','createVeevaObjectRecords','values','constructor','createPackageComponents','export','Adding\x20components\x20to\x20outbound\x20package','Deleting\x20outbound\x20packages.','deleteOutboundPackages','ENDPOINT_EXPORT_IMPORT_PACKAGE','../constants/veeva.constants','7dGvdGT','jszip','map','../enums/status.enums','40gLtVDr','application/json','default','_connection','MAXIMUM_SIZE_OF_PACKAGE','_logger','retrieveVPKList','Getting\x20names\x20of\x20outbound\x20packages','get','errors','package_component__v','Creating\x20outbound\x20packages','content-type','getEndpointArtifactList'];a390_0x4598=function(){return _0x51c4b5;};return a390_0x4598();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x15e0a5){const _0xcf691d=a390_0x660f;return _0x15e0a5&&_0x15e0a5[_0xcf691d(0xae)]?_0x15e0a5:{'default':_0x15e0a5};};Object['defineProperty'](exports,a390_0x516705(0xae),{'value':!![]}),exports[a390_0x516705(0xa6)]=void 0x0;function a390_0x660f(_0x27cdf7,_0x28fb15){const _0x36cd76=a390_0x4598();return a390_0x660f=function(_0x48ddfb,_0x4ccc0c){_0x48ddfb=_0x48ddfb-0x8c;let _0x459856=_0x36cd76[_0x48ddfb];return _0x459856;},a390_0x660f(_0x27cdf7,_0x28fb15);}const veeva_constants_1=require(a390_0x516705(0xc6)),jszip_1=__importDefault(require(a390_0x516705(0xc8))),status_enums_1=require(a390_0x516705(0xca)),veeva_error_1=require('../classes/errors/veeva-error');class PackageExportService{constructor({veevaService:_0x325f8b,connection:_0x2e03bf,logger:_0x30c4ba}){const _0x17ff03=a390_0x516705;this['_veevaService']=_0x325f8b,this[_0x17ff03(0xce)]=_0x2e03bf,this[_0x17ff03(0xd0)]=_0x30c4ba;}async[a390_0x516705(0x93)](_0x2cc31b,_0x3d3a1a){const _0x1ff4b5=a390_0x516705;this[_0x1ff4b5(0xd0)]['log'](_0x1ff4b5(0x8c));const _0x30cdae=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+'outbound_package__v',_0xc597cf=new Array(_0x2cc31b)['fill']({'summary__v':_0x3d3a1a,'object_type__v.api__name__v':'migration__sys'});return await this[_0x1ff4b5(0xb9)][_0x1ff4b5(0xbd)](_0x30cdae,_0xc597cf);}async[a390_0x516705(0xc0)](_0x2020fa,_0x5966cf){const _0x28ac1=a390_0x516705;this[_0x28ac1(0xd0)][_0x28ac1(0x92)](_0x28ac1(0xc2));const _0x4744db=veeva_constants_1['VeevaConstants'][_0x28ac1(0x9c)]+_0x28ac1(0xd5),_0x2e7d0d=_0x2020fa['map']((_0x4b363c,_0x3b68cf)=>({'vault_component__v':_0x4b363c['id'],'outbound_package__v':_0x5966cf[Math['ceil']((_0x3b68cf+0x1)/veeva_constants_1[_0x28ac1(0x8f)]['MAXIMUM_SIZE_OF_PACKAGE'])-0x1]}));return await this[_0x28ac1(0xb9)]['createVeevaObjectRecords'](_0x4744db,_0x2e7d0d);}async[a390_0x516705(0x99)](_0x10141b){const _0x1404a4=a390_0x516705;this[_0x1404a4(0xd0)][_0x1404a4(0x92)](_0x1404a4(0xd2));const _0x517c44=_0x1404a4(0xba)+_0x10141b['join']('\x27,\x27')+'\x27)',_0x1661a4=await this[_0x1404a4(0xb9)][_0x1404a4(0x97)](_0x517c44);return _0x1661a4[_0x1404a4(0xab)]((_0x34982a,_0xcff1ed)=>_0x34982a[_0x1404a4(0x9d)](_0xcff1ed['id'],_0xcff1ed[_0x1404a4(0xbb)]),new Map());}async[a390_0x516705(0xb4)](_0x3fc65d){const _0x2a8d10=a390_0x516705;this[_0x2a8d10(0xd0)]['log'](_0x2a8d10(0xb0));const _0x4fa77d=[],_0x917ef2=_0x3fc65d[_0x2a8d10(0xc9)](_0x37cb69=>{const _0x3a3b72=_0x2a8d10;return this[_0x3a3b72(0xce)][_0x3a3b72(0xa1)](veeva_constants_1[_0x3a3b72(0x8f)][_0x3a3b72(0xc5)],encodeURI(_0x3a3b72(0x94))+'='+encodeURI(_0x37cb69),{'headers':{'Content-Type':_0x3a3b72(0xa0)}});}),_0x106bdb=await Promise['all'](_0x917ef2);for(const {data:_0x1958a0}of _0x106bdb){if(_0x1958a0[_0x2a8d10(0xb8)]===status_enums_1['VeevaResponseStatus'][_0x2a8d10(0xad)]){const {url:_0x222917}=_0x1958a0;_0x4fa77d[_0x2a8d10(0xb5)](_0x222917);}else throw new veeva_error_1[(_0x2a8d10(0xb3))](_0x1958a0['errors']);}return _0x4fa77d;}async[a390_0x516705(0x8e)](_0x45124d){const _0x246166=a390_0x516705;this[_0x246166(0xd0)][_0x246166(0x92)]('Retrieve\x20Jobs\x20Status');const _0x5b2257=[],_0x56efab=await this[_0x246166(0xb9)][_0x246166(0x9e)](_0x45124d);for(const _0x3cea of _0x56efab){const _0x19f0b5=_0x3cea['links'][_0x246166(0x91)](_0x3cc81b=>_0x3cc81b['rel']===_0x246166(0xaa))[_0x246166(0xc9)](_0x2f0f65=>_0x2f0f65[_0x246166(0x95)]);_0x5b2257[_0x246166(0xb5)](..._0x19f0b5);}return _0x5b2257;}async['retrieveVPKList'](_0xf897d4){const _0x2bbd56=a390_0x516705;var _0x290bf7;const _0x3f60e6=[];this[_0x2bbd56(0xd0)]['log'](_0x2bbd56(0xa4));for(const _0x43a06b of _0xf897d4){const {data:_0x724919,headers:_0x442fda}=await this[_0x2bbd56(0xce)][_0x2bbd56(0xd3)](_0x43a06b,{'responseType':'arraybuffer'}),_0x3cc185=(_0x290bf7=_0x442fda[_0x2bbd56(0x8d)])===null||_0x290bf7===void 0x0?void 0x0:_0x290bf7[_0x2bbd56(0xa3)](_0x2bbd56(0xcc));if(!_0x3cc185){const _0x4aafa5=_0x724919,_0x34ba42=new jszip_1[(_0x2bbd56(0xcd))]();await _0x34ba42['loadAsync'](_0x4aafa5),_0x3f60e6['push'](_0x34ba42);}else{const _0x1438f9=JSON[_0x2bbd56(0xa9)](_0x724919);throw new veeva_error_1[(_0x2bbd56(0xb3))](_0x1438f9[_0x2bbd56(0xd4)]);}}return _0x3f60e6;}async[a390_0x516705(0x9b)](_0x1b8073){const _0x5e66c1=a390_0x516705;this[_0x5e66c1(0xd0)][_0x5e66c1(0x92)](_0x5e66c1(0xac));const _0x3bd64e=veeva_constants_1[_0x5e66c1(0x8f)][_0x5e66c1(0x9c)]+_0x5e66c1(0xd5);await this[_0x5e66c1(0xb9)]['deleteVeevaObjectRecords'](_0x3bd64e,_0x1b8073);}async[a390_0x516705(0xc4)](_0x3714fc){const _0x42629a=a390_0x516705;this[_0x42629a(0xd0)][_0x42629a(0x92)](_0x42629a(0xc3));const _0x41acb7=veeva_constants_1[_0x42629a(0x8f)]['ENDPOINT_CREATE_RECORDS']+'outbound_package__v';await this[_0x42629a(0xb9)][_0x42629a(0xb7)](_0x41acb7,_0x3714fc);}async[a390_0x516705(0xc1)](_0x4ee48b,_0x5274d5){const _0x194e1a=a390_0x516705,_0x59833a=await this['createOutboundPackages'](Math['ceil'](_0x4ee48b[_0x194e1a(0xb2)]/veeva_constants_1[_0x194e1a(0x8f)][_0x194e1a(0xcf)]),_0x5274d5),_0x3bdc34=await this[_0x194e1a(0xc0)](_0x4ee48b,_0x59833a),_0x3dc8d1=await this[_0x194e1a(0x99)](_0x59833a),_0x68b0f8=await this[_0x194e1a(0xb4)](Array[_0x194e1a(0x98)](_0x3dc8d1[_0x194e1a(0xbe)]())),_0x26f000=await this[_0x194e1a(0x8e)](_0x68b0f8),_0x593a70=await this[_0x194e1a(0xd1)](_0x26f000);return await this['deletePackageComponents'](_0x3bdc34),await this['deleteOutboundPackages'](_0x59833a),_0x593a70;}}exports['PackageExportService']=PackageExportService;