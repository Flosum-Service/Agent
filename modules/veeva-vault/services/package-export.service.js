const a358_0x135055=a358_0x3d83;(function(_0x352900,_0x414596){const _0x414e04=a358_0x3d83,_0x97fb4f=_0x352900();while(!![]){try{const _0x6009e4=parseInt(_0x414e04(0x179))/0x1*(-parseInt(_0x414e04(0x1b2))/0x2)+-parseInt(_0x414e04(0x199))/0x3+-parseInt(_0x414e04(0x178))/0x4*(-parseInt(_0x414e04(0x1bc))/0x5)+-parseInt(_0x414e04(0x196))/0x6+parseInt(_0x414e04(0x197))/0x7*(-parseInt(_0x414e04(0x185))/0x8)+-parseInt(_0x414e04(0x194))/0x9+parseInt(_0x414e04(0x17a))/0xa;if(_0x6009e4===_0x414596)break;else _0x97fb4f['push'](_0x97fb4f['shift']());}catch(_0x34bbd6){_0x97fb4f['push'](_0x97fb4f['shift']());}}}(a358_0x55ae,0xa078d));const a358_0x2bb62c=(function(){let _0xda4734=!![];return function(_0x1a3752,_0x32a42e){const _0x5e1127=_0xda4734?function(){if(_0x32a42e){const _0xa9b307=_0x32a42e['apply'](_0x1a3752,arguments);return _0x32a42e=null,_0xa9b307;}}:function(){};return _0xda4734=![],_0x5e1127;};}()),a358_0x30319f=a358_0x2bb62c(this,function(){const _0x1f1636=a358_0x3d83;return a358_0x30319f[_0x1f1636(0x1b9)]()[_0x1f1636(0x175)](_0x1f1636(0x1ab))[_0x1f1636(0x1b9)]()[_0x1f1636(0x177)](a358_0x30319f)[_0x1f1636(0x175)](_0x1f1636(0x1ab));});function a358_0x3d83(_0x12074d,_0xf5cf84){const _0x2f486d=a358_0x55ae();return a358_0x3d83=function(_0x30319f,_0x2bb62c){_0x30319f=_0x30319f-0x16e;let _0x55ae1e=_0x2f486d[_0x30319f];return _0x55ae1e;},a358_0x3d83(_0x12074d,_0xf5cf84);}a358_0x30319f();'use strict';var __importDefault=this&&this[a358_0x135055(0x1ac)]||function(_0x42f058){const _0x1abbda=a358_0x135055;return _0x42f058&&_0x42f058[_0x1abbda(0x1bb)]?_0x42f058:{'default':_0x42f058};};Object[a358_0x135055(0x19a)](exports,a358_0x135055(0x1bb),{'value':!![]}),exports['PackageExportService']=void 0x0;function a358_0x55ae(){const _0x163e51=['set','href','8sXqtvM','createOutboundPackages','../constants/veeva.constants','push','parse','ENDPOINT_CREATE_RECORDS','VeevaResponseStatus','name__v','_veevaService','\x27,\x27','createPackageComponents','getJobResult','post','responseStatus','retrieveVPKList','3587535JwbGyT','all','4652106GCCDsB','8591338rJYOda','default','1788207BJLBfi','defineProperty','values','ENDPOINT_EXPORT_IMPORT_PACKAGE','Getting\x20names\x20of\x20outbound\x20packages','map','migration__sys','from','VeevaError','Create\x20Export\x20outbound\x20packages.','deleteOutboundPackages','_logger','Removing\x20components\x20from\x20outbound\x20packages.','content-type','MAXIMUM_SIZE_OF_PACKAGE','deleteVeevaObjectRecords','get','Retrieve\x20Outbound\x20Package\x20zip\x20list','(((.+)+)+)+$','__importDefault','createExportOutboundPackages','deletePackageComponents','log','application/json','packageName','270hoScHO','ENDPOINT_VQL','Creating\x20outbound\x20packages','application/x-www-form-urlencoded','createVeevaObjectRecords','outbound_package__v','getEndpointArtifactList','toString','../classes/errors/veeva-error','__esModule','3309395HexYih','jszip','SUCCESS','PackageExportService','errors','_connection','includes','VeevaConstants','search','length','constructor','4AUhbtA','1609qpBYmw','32099980rroBRQ','getPackageNames','reduce','package_component__v','filter','arraybuffer','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','loadAsync','ceil'];a358_0x55ae=function(){return _0x163e51;};return a358_0x55ae();}const veeva_constants_1=require(a358_0x135055(0x187)),jszip_1=__importDefault(require(a358_0x135055(0x16e))),status_enums_1=require('../enums/status.enums'),veeva_error_1=require(a358_0x135055(0x1ba));class PackageExportService{constructor({veevaService:_0x5bf818,connection:_0x2b618c,logger:_0x151e70}){const _0x213f18=a358_0x135055;this[_0x213f18(0x18d)]=_0x5bf818,this[_0x213f18(0x172)]=_0x2b618c,this['_logger']=_0x151e70;}async[a358_0x135055(0x186)](_0x5dd00c,_0x456ece){const _0x6755e8=a358_0x135055;this[_0x6755e8(0x1a4)][_0x6755e8(0x1af)](_0x6755e8(0x1b4));const _0x34a70a=veeva_constants_1[_0x6755e8(0x174)][_0x6755e8(0x18a)]+_0x6755e8(0x1b7),_0x60507c=new Array(_0x5dd00c)['fill']({'summary__v':_0x456ece,'object_type__v.api__name__v':_0x6755e8(0x19f)});return await this[_0x6755e8(0x18d)][_0x6755e8(0x1b6)](_0x34a70a,_0x60507c);}async['createPackageComponents'](_0x1d8e02,_0x3f3ff8){const _0x2c17db=a358_0x135055;this['_logger'][_0x2c17db(0x1af)]('Adding\x20components\x20to\x20outbound\x20package');const _0x5e0e22=veeva_constants_1[_0x2c17db(0x174)]['ENDPOINT_CREATE_RECORDS']+'package_component__v',_0x38a88e=_0x1d8e02[_0x2c17db(0x19e)]((_0x14af00,_0x125d39)=>({'vault_component__v':_0x14af00['id'],'outbound_package__v':_0x3f3ff8[Math[_0x2c17db(0x182)]((_0x125d39+0x1)/veeva_constants_1[_0x2c17db(0x174)][_0x2c17db(0x1a7)])-0x1]}));return await this[_0x2c17db(0x18d)][_0x2c17db(0x1b6)](_0x5e0e22,_0x38a88e);}async[a358_0x135055(0x17b)](_0xa8b2){const _0x2e93e9=a358_0x135055;this['_logger'][_0x2e93e9(0x1af)](_0x2e93e9(0x19d));const _0x179307=_0x2e93e9(0x180)+_0xa8b2['join'](_0x2e93e9(0x18e))+'\x27)',_0x1cc9fe=veeva_constants_1['VeevaConstants'][_0x2e93e9(0x1b3)]+_0x179307,_0x1b0638=await this[_0x2e93e9(0x18d)]['executeVQL'](_0x1cc9fe);return _0x1b0638[_0x2e93e9(0x17c)]((_0x2a2b57,_0x28a808)=>_0x2a2b57[_0x2e93e9(0x183)](_0x28a808['id'],_0x28a808[_0x2e93e9(0x18c)]),new Map());}async[a358_0x135055(0x1ad)](_0x5a530e){const _0x3464be=a358_0x135055;this[_0x3464be(0x1a4)][_0x3464be(0x1af)](_0x3464be(0x1a2));const _0x3b435a=[],_0x50d0a4=_0x5a530e['map'](_0x372d9c=>{const _0x5de0cd=_0x3464be;return this[_0x5de0cd(0x172)][_0x5de0cd(0x191)](veeva_constants_1[_0x5de0cd(0x174)][_0x5de0cd(0x19c)],encodeURI(_0x5de0cd(0x1b1))+'='+encodeURI(_0x372d9c),{'headers':{'Content-Type':_0x5de0cd(0x1b5)}});}),_0x5e1b10=await Promise[_0x3464be(0x195)](_0x50d0a4);for(const {data:_0x5a8724}of _0x5e1b10){if(_0x5a8724[_0x3464be(0x192)]===status_enums_1[_0x3464be(0x18b)][_0x3464be(0x16f)]){const {url:_0x1feebb}=_0x5a8724;_0x3b435a['push'](_0x1feebb);}else throw new veeva_error_1[(_0x3464be(0x1a1))](_0x5a8724[_0x3464be(0x171)]);}return _0x3b435a;}async[a358_0x135055(0x1b8)](_0x484c14){const _0x2abea0=a358_0x135055;this['_logger']['log']('Retrieve\x20Jobs\x20Status');const _0x275618=[],_0x21c3c7=await this[_0x2abea0(0x18d)][_0x2abea0(0x190)](_0x484c14);for(const _0x6ec972 of _0x21c3c7){const _0x15d192=_0x6ec972['links'][_0x2abea0(0x17e)](_0xdcf99e=>_0xdcf99e['rel']==='artifacts')[_0x2abea0(0x19e)](_0xfffe5a=>_0xfffe5a[_0x2abea0(0x184)]);_0x275618[_0x2abea0(0x188)](..._0x15d192);}return _0x275618;}async[a358_0x135055(0x193)](_0x29c606){const _0x54bc05=a358_0x135055;var _0x21dc10;const _0x287377=[];this[_0x54bc05(0x1a4)]['log'](_0x54bc05(0x1aa));for(const _0x39a1ac of _0x29c606){const {data:_0x387223,headers:_0x483918}=await this['_connection'][_0x54bc05(0x1a9)](_0x39a1ac,{'responseType':_0x54bc05(0x17f)}),_0x39796c=(_0x21dc10=_0x483918[_0x54bc05(0x1a6)])===null||_0x21dc10===void 0x0?void 0x0:_0x21dc10[_0x54bc05(0x173)](_0x54bc05(0x1b0));if(!_0x39796c){const _0x173dc6=_0x387223,_0x227dc0=new jszip_1[(_0x54bc05(0x198))]();await _0x227dc0[_0x54bc05(0x181)](_0x173dc6),_0x287377['push'](_0x227dc0);}else{const _0x2bb1a2=JSON[_0x54bc05(0x189)](_0x387223);throw new veeva_error_1['VeevaError'](_0x2bb1a2[_0x54bc05(0x171)]);}}return _0x287377;}async['deletePackageComponents'](_0x1927c4){const _0x3f62b7=a358_0x135055;this[_0x3f62b7(0x1a4)][_0x3f62b7(0x1af)](_0x3f62b7(0x1a5));const _0x1e1f66=veeva_constants_1['VeevaConstants'][_0x3f62b7(0x18a)]+_0x3f62b7(0x17d);await this[_0x3f62b7(0x18d)][_0x3f62b7(0x1a8)](_0x1e1f66,_0x1927c4);}async[a358_0x135055(0x1a3)](_0x3496bf){const _0x544ab5=a358_0x135055;this[_0x544ab5(0x1a4)][_0x544ab5(0x1af)]('Deleting\x20outbound\x20packages.');const _0x178dc7=veeva_constants_1[_0x544ab5(0x174)][_0x544ab5(0x18a)]+'outbound_package__v';await this[_0x544ab5(0x18d)][_0x544ab5(0x1a8)](_0x178dc7,_0x3496bf);}async['export'](_0x53adde,_0x2045c3){const _0x1724a2=a358_0x135055,_0x533d30=await this[_0x1724a2(0x186)](Math[_0x1724a2(0x182)](_0x53adde[_0x1724a2(0x176)]/veeva_constants_1[_0x1724a2(0x174)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x2045c3),_0x2f7b9c=await this[_0x1724a2(0x18f)](_0x53adde,_0x533d30),_0x58034c=await this[_0x1724a2(0x17b)](_0x533d30),_0x5a01cf=await this[_0x1724a2(0x1ad)](Array[_0x1724a2(0x1a0)](_0x58034c[_0x1724a2(0x19b)]())),_0x4e66db=await this[_0x1724a2(0x1b8)](_0x5a01cf),_0x4fc756=await this[_0x1724a2(0x193)](_0x4e66db);return await this[_0x1724a2(0x1ae)](_0x2f7b9c),await this[_0x1724a2(0x1a3)](_0x533d30),_0x4fc756;}}exports[a358_0x135055(0x170)]=PackageExportService;