const a359_0x2a6f71=a359_0x4d56;(function(_0x8e07b1,_0x549a45){const _0x412ac3=a359_0x4d56,_0x32210b=_0x8e07b1();while(!![]){try{const _0x5c3338=-parseInt(_0x412ac3(0x9e))/0x1*(-parseInt(_0x412ac3(0x89))/0x2)+parseInt(_0x412ac3(0x82))/0x3*(-parseInt(_0x412ac3(0x9a))/0x4)+parseInt(_0x412ac3(0x8b))/0x5*(-parseInt(_0x412ac3(0x98))/0x6)+-parseInt(_0x412ac3(0x93))/0x7+parseInt(_0x412ac3(0xbc))/0x8+-parseInt(_0x412ac3(0xbd))/0x9*(parseInt(_0x412ac3(0x8d))/0xa)+parseInt(_0x412ac3(0x85))/0xb*(parseInt(_0x412ac3(0xa7))/0xc);if(_0x5c3338===_0x549a45)break;else _0x32210b['push'](_0x32210b['shift']());}catch(_0x1462e8){_0x32210b['push'](_0x32210b['shift']());}}}(a359_0x1c8b,0xe9225));const a359_0x523f80=(function(){let _0x36cfb2=!![];return function(_0x3874d7,_0x35e253){const _0x35c749=_0x36cfb2?function(){if(_0x35e253){const _0x2b3654=_0x35e253['apply'](_0x3874d7,arguments);return _0x35e253=null,_0x2b3654;}}:function(){};return _0x36cfb2=![],_0x35c749;};}()),a359_0x18648a=a359_0x523f80(this,function(){const _0x1ae27e=a359_0x4d56;return a359_0x18648a[_0x1ae27e(0xa3)]()['search']('(((.+)+)+)+$')[_0x1ae27e(0xa3)]()[_0x1ae27e(0x95)](a359_0x18648a)[_0x1ae27e(0xc4)](_0x1ae27e(0xa1));});function a359_0x4d56(_0x3c705b,_0x29ba74){const _0x2d058d=a359_0x1c8b();return a359_0x4d56=function(_0x18648a,_0x523f80){_0x18648a=_0x18648a-0x7c;let _0x1c8b1a=_0x2d058d[_0x18648a];return _0x1c8b1a;},a359_0x4d56(_0x3c705b,_0x29ba74);}a359_0x18648a();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x51e800){const _0x4b6510=a359_0x4d56;return _0x51e800&&_0x51e800[_0x4b6510(0x92)]?_0x51e800:{'default':_0x51e800};};function a359_0x1c8b(){const _0x54c0b8=['retrieveVPKList','10GDCFTp','MAXIMUM_SIZE_OF_PACKAGE','errors','push','href','__esModule','12884858jgZeVP','ENDPOINT_VQL','constructor','map','_logger','3085986raBwlM','deleteVeevaObjectRecords','4maynvF','packageName','jszip','content-type','1ELjYGw','post','createVeevaObjectRecords','(((.+)+)+)+$','_connection','toString','outbound_package__v','reduce','defineProperty','3495348cQeltC','deletePackageComponents','responseStatus','log','\x27,\x27','PackageExportService','Retrieve\x20Jobs\x20Status','getEndpointArtifactList','ENDPOINT_EXPORT_IMPORT_PACKAGE','Retrieve\x20Outbound\x20Package\x20zip\x20list','name__v','rel','Getting\x20names\x20of\x20outbound\x20packages','get','Deleting\x20outbound\x20packages.','application/json','createOutboundPackages','arraybuffer','ENDPOINT_CREATE_RECORDS','migration__sys','includes','463392jZNVyd','14225877lLIRQG','executeVQL','from','ceil','values','getPackageNames','default','search','VeevaError','createPackageComponents','artifacts','loadAsync','links','VeevaConstants','1226877RJcNfF','deleteOutboundPackages','application/x-www-form-urlencoded','187KBGErA','_veevaService','VeevaResponseStatus','createExportOutboundPackages','2637098FxGAuQ','Creating\x20outbound\x20packages','15PBZYqk'];a359_0x1c8b=function(){return _0x54c0b8;};return a359_0x1c8b();}Object[a359_0x2a6f71(0xa6)](exports,a359_0x2a6f71(0x92),{'value':!![]}),exports['PackageExportService']=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require(a359_0x2a6f71(0x9c))),status_enums_1=require('../enums/status.enums'),veeva_error_1=require('../classes/errors/veeva-error');class PackageExportService{constructor({veevaService:_0x21596e,connection:_0x366599,logger:_0x225801}){const _0x4a39f9=a359_0x2a6f71;this[_0x4a39f9(0x86)]=_0x21596e,this[_0x4a39f9(0xa2)]=_0x366599,this[_0x4a39f9(0x97)]=_0x225801;}async[a359_0x2a6f71(0xb7)](_0x37e47,_0x11452d){const _0x4b3e61=a359_0x2a6f71;this[_0x4b3e61(0x97)][_0x4b3e61(0xaa)](_0x4b3e61(0x8a));const _0x5d31c0=veeva_constants_1[_0x4b3e61(0x81)][_0x4b3e61(0xb9)]+'outbound_package__v',_0x2db921=new Array(_0x37e47)['fill']({'summary__v':_0x11452d,'object_type__v.api__name__v':_0x4b3e61(0xba)});return await this[_0x4b3e61(0x86)][_0x4b3e61(0xa0)](_0x5d31c0,_0x2db921);}async[a359_0x2a6f71(0x7d)](_0x10fcce,_0x1f64f9){const _0x1d5792=a359_0x2a6f71;this[_0x1d5792(0x97)][_0x1d5792(0xaa)]('Adding\x20components\x20to\x20outbound\x20package');const _0x5ecae9=veeva_constants_1[_0x1d5792(0x81)][_0x1d5792(0xb9)]+'package_component__v',_0x2f9e76=_0x10fcce[_0x1d5792(0x96)]((_0x28c6ee,_0xd6093a)=>({'vault_component__v':_0x28c6ee['id'],'outbound_package__v':_0x1f64f9[Math[_0x1d5792(0xc0)]((_0xd6093a+0x1)/veeva_constants_1[_0x1d5792(0x81)][_0x1d5792(0x8e)])-0x1]}));return await this['_veevaService'][_0x1d5792(0xa0)](_0x5ecae9,_0x2f9e76);}async['getPackageNames'](_0x11d63f){const _0x243f62=a359_0x2a6f71;this['_logger'][_0x243f62(0xaa)](_0x243f62(0xb3));const _0x174b51='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x11d63f['join'](_0x243f62(0xab))+'\x27)',_0x1febea=veeva_constants_1['VeevaConstants'][_0x243f62(0x94)]+_0x174b51,_0x8674b4=await this['_veevaService'][_0x243f62(0xbe)](_0x1febea);return _0x8674b4[_0x243f62(0xa5)]((_0xb81fe0,_0x426ac1)=>_0xb81fe0['set'](_0x426ac1['id'],_0x426ac1[_0x243f62(0xb1)]),new Map());}async[a359_0x2a6f71(0x88)](_0x485b50){const _0x37a85b=a359_0x2a6f71;this[_0x37a85b(0x97)][_0x37a85b(0xaa)]('Create\x20Export\x20outbound\x20packages.');const _0x1a609a=[],_0x115438=_0x485b50['map'](_0x123122=>{const _0x2db55f=_0x37a85b;return this[_0x2db55f(0xa2)][_0x2db55f(0x9f)](veeva_constants_1['VeevaConstants'][_0x2db55f(0xaf)],encodeURI(_0x2db55f(0x9b))+'='+encodeURI(_0x123122),{'headers':{'Content-Type':_0x2db55f(0x84)}});}),_0x3b636e=await Promise['all'](_0x115438);for(const {data:_0x46118b}of _0x3b636e){if(_0x46118b[_0x37a85b(0xa9)]===status_enums_1[_0x37a85b(0x87)]['SUCCESS']){const {url:_0x47e913}=_0x46118b;_0x1a609a[_0x37a85b(0x90)](_0x47e913);}else throw new veeva_error_1[(_0x37a85b(0x7c))](_0x46118b['errors']);}return _0x1a609a;}async[a359_0x2a6f71(0xae)](_0x3a758a){const _0x51cc64=a359_0x2a6f71;this[_0x51cc64(0x97)][_0x51cc64(0xaa)](_0x51cc64(0xad));const _0x4252af=[],_0x554d05=await this[_0x51cc64(0x86)]['getJobResult'](_0x3a758a);for(const _0x3ce8d8 of _0x554d05){const _0x4c7ebf=_0x3ce8d8[_0x51cc64(0x80)]['filter'](_0x354ad4=>_0x354ad4[_0x51cc64(0xb2)]===_0x51cc64(0x7e))['map'](_0x51aee9=>_0x51aee9[_0x51cc64(0x91)]);_0x4252af[_0x51cc64(0x90)](..._0x4c7ebf);}return _0x4252af;}async[a359_0x2a6f71(0x8c)](_0x2bb995){const _0x40b276=a359_0x2a6f71;var _0x1a59b3;const _0x18a7d4=[];this['_logger'][_0x40b276(0xaa)](_0x40b276(0xb0));for(const _0x53dde2 of _0x2bb995){const {data:_0x3f540b,headers:_0x2f6310}=await this[_0x40b276(0xa2)][_0x40b276(0xb4)](_0x53dde2,{'responseType':_0x40b276(0xb8)}),_0x35f1ae=(_0x1a59b3=_0x2f6310[_0x40b276(0x9d)])===null||_0x1a59b3===void 0x0?void 0x0:_0x1a59b3[_0x40b276(0xbb)](_0x40b276(0xb6));if(!_0x35f1ae){const _0xdd1d36=_0x3f540b,_0x50b6a3=new jszip_1[(_0x40b276(0xc3))]();await _0x50b6a3[_0x40b276(0x7f)](_0xdd1d36),_0x18a7d4[_0x40b276(0x90)](_0x50b6a3);}else{const _0x3f03e6=JSON['parse'](_0x3f540b);throw new veeva_error_1[(_0x40b276(0x7c))](_0x3f03e6[_0x40b276(0x8f)]);}}return _0x18a7d4;}async['deletePackageComponents'](_0x171e20){const _0x2a3824=a359_0x2a6f71;this[_0x2a3824(0x97)]['log']('Removing\x20components\x20from\x20outbound\x20packages.');const _0x3807ad=veeva_constants_1[_0x2a3824(0x81)]['ENDPOINT_CREATE_RECORDS']+'package_component__v';await this[_0x2a3824(0x86)][_0x2a3824(0x99)](_0x3807ad,_0x171e20);}async[a359_0x2a6f71(0x83)](_0x251a38){const _0x207dd6=a359_0x2a6f71;this[_0x207dd6(0x97)][_0x207dd6(0xaa)](_0x207dd6(0xb5));const _0x46a6c6=veeva_constants_1[_0x207dd6(0x81)][_0x207dd6(0xb9)]+_0x207dd6(0xa4);await this[_0x207dd6(0x86)][_0x207dd6(0x99)](_0x46a6c6,_0x251a38);}async['export'](_0x2d15c2,_0x5139a3){const _0x43f3bc=a359_0x2a6f71,_0x1c1a90=await this[_0x43f3bc(0xb7)](Math['ceil'](_0x2d15c2['length']/veeva_constants_1['VeevaConstants'][_0x43f3bc(0x8e)]),_0x5139a3),_0xaf4244=await this[_0x43f3bc(0x7d)](_0x2d15c2,_0x1c1a90),_0x1779ca=await this[_0x43f3bc(0xc2)](_0x1c1a90),_0xb4af64=await this['createExportOutboundPackages'](Array[_0x43f3bc(0xbf)](_0x1779ca[_0x43f3bc(0xc1)]())),_0x3945eb=await this['getEndpointArtifactList'](_0xb4af64),_0x2248ef=await this[_0x43f3bc(0x8c)](_0x3945eb);return await this[_0x43f3bc(0xa8)](_0xaf4244),await this[_0x43f3bc(0x83)](_0x1c1a90),_0x2248ef;}}exports[a359_0x2a6f71(0xac)]=PackageExportService;