const a359_0x1d33ba=a359_0x5370;function a359_0x29c9(){const _0x3f8733=['VeevaResponseStatus','_veevaService','30701YXbyHS','Adding\x20components\x20to\x20outbound\x20package','560604xXqRcZ','fill','../constants/veeva.constants','migration__sys','7599360tfZKIf','197135yKHuxu','MAXIMUM_SIZE_OF_PACKAGE','_connection','deleteOutboundPackages','log','artifacts','retrieveVPKList','_logger','name__v','VeevaConstants','packageName','createExportOutboundPackages','VeevaError','outbound_package__v','executeVQL','includes','set','SUCCESS','application/json','links','Getting\x20names\x20of\x20outbound\x20packages','deletePackageComponents','ENDPOINT_VQL','ceil','length','filter','errors','../enums/status.enums','\x27,\x27','constructor','createOutboundPackages','export','createPackageComponents','createVeevaObjectRecords','parse','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','getPackageNames','jszip','Removing\x20components\x20from\x20outbound\x20packages.','rel','map','deleteVeevaObjectRecords','753002irRnvE','ENDPOINT_CREATE_RECORDS','responseStatus','join','Create\x20Export\x20outbound\x20packages.','2176230ZyxniF','../classes/errors/veeva-error','from','1670832QXOFvd','PackageExportService','3XzRTBk','href','search','(((.+)+)+)+$','toString','push','Deleting\x20outbound\x20packages.','reduce','default','post','arraybuffer','getJobResult','getEndpointArtifactList','package_component__v','apply','get'];a359_0x29c9=function(){return _0x3f8733;};return a359_0x29c9();}(function(_0x2885a0,_0x9916b){const _0x364b94=a359_0x5370,_0x18f806=_0x2885a0();while(!![]){try{const _0x996c29=parseInt(_0x364b94(0x210))/0x1+-parseInt(_0x364b94(0x1f4))/0x2*(parseInt(_0x364b94(0x1fe))/0x3)+parseInt(_0x364b94(0x212))/0x4+parseInt(_0x364b94(0x217))/0x5+-parseInt(_0x364b94(0x1fc))/0x6+-parseInt(_0x364b94(0x1f9))/0x7+parseInt(_0x364b94(0x216))/0x8;if(_0x996c29===_0x9916b)break;else _0x18f806['push'](_0x18f806['shift']());}catch(_0x4b1ef1){_0x18f806['push'](_0x18f806['shift']());}}}(a359_0x29c9,0x2f720));const a359_0x160e9d=(function(){let _0x1e37f8=!![];return function(_0x4b2c02,_0x5a900c){const _0x4979b3=_0x1e37f8?function(){const _0x5c0834=a359_0x5370;if(_0x5a900c){const _0x304d5d=_0x5a900c[_0x5c0834(0x20c)](_0x4b2c02,arguments);return _0x5a900c=null,_0x304d5d;}}:function(){};return _0x1e37f8=![],_0x4979b3;};}()),a359_0x43be70=a359_0x160e9d(this,function(){const _0xf7bbc3=a359_0x5370;return a359_0x43be70[_0xf7bbc3(0x202)]()[_0xf7bbc3(0x200)](_0xf7bbc3(0x201))[_0xf7bbc3(0x202)]()[_0xf7bbc3(0x234)](a359_0x43be70)[_0xf7bbc3(0x200)](_0xf7bbc3(0x201));});a359_0x43be70();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2d2a58){return _0x2d2a58&&_0x2d2a58['__esModule']?_0x2d2a58:{'default':_0x2d2a58};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a359_0x1d33ba(0x1fd)]=void 0x0;function a359_0x5370(_0xfbb26f,_0x50806f){const _0xdf2d5d=a359_0x29c9();return a359_0x5370=function(_0x43be70,_0x160e9d){_0x43be70=_0x43be70-0x1f4;let _0x29c980=_0xdf2d5d[_0x43be70];return _0x29c980;},a359_0x5370(_0xfbb26f,_0x50806f);}const veeva_constants_1=require(a359_0x1d33ba(0x214)),jszip_1=__importDefault(require(a359_0x1d33ba(0x23c))),status_enums_1=require(a359_0x1d33ba(0x232)),veeva_error_1=require(a359_0x1d33ba(0x1fa));class PackageExportService{constructor({veevaService:_0x429bc0,connection:_0xa3408e,logger:_0x2eb7d8}){const _0x22e9fd=a359_0x1d33ba;this['_veevaService']=_0x429bc0,this[_0x22e9fd(0x219)]=_0xa3408e,this[_0x22e9fd(0x21e)]=_0x2eb7d8;}async[a359_0x1d33ba(0x235)](_0x9b3698,_0x4973ce){const _0xbee7a4=a359_0x1d33ba;this[_0xbee7a4(0x21e)][_0xbee7a4(0x21b)]('Creating\x20outbound\x20packages');const _0x25ec0a=veeva_constants_1[_0xbee7a4(0x220)]['ENDPOINT_CREATE_RECORDS']+_0xbee7a4(0x224),_0x19c850=new Array(_0x9b3698)[_0xbee7a4(0x213)]({'summary__v':_0x4973ce,'object_type__v.api__name__v':_0xbee7a4(0x215)});return await this[_0xbee7a4(0x20f)][_0xbee7a4(0x238)](_0x25ec0a,_0x19c850);}async[a359_0x1d33ba(0x237)](_0x6608c8,_0x1b2346){const _0x2362bb=a359_0x1d33ba;this[_0x2362bb(0x21e)][_0x2362bb(0x21b)](_0x2362bb(0x211));const _0x2c903c=veeva_constants_1[_0x2362bb(0x220)][_0x2362bb(0x1f5)]+_0x2362bb(0x20b),_0x33e6c1=_0x6608c8[_0x2362bb(0x23f)]((_0x5e44e0,_0x48d3cd)=>({'vault_component__v':_0x5e44e0['id'],'outbound_package__v':_0x1b2346[Math[_0x2362bb(0x22e)]((_0x48d3cd+0x1)/veeva_constants_1[_0x2362bb(0x220)][_0x2362bb(0x218)])-0x1]}));return await this[_0x2362bb(0x20f)][_0x2362bb(0x238)](_0x2c903c,_0x33e6c1);}async['getPackageNames'](_0x24f3f8){const _0x1be298=a359_0x1d33ba;this['_logger'][_0x1be298(0x21b)](_0x1be298(0x22b));const _0x81001a=_0x1be298(0x23a)+_0x24f3f8[_0x1be298(0x1f7)](_0x1be298(0x233))+'\x27)',_0x51f9a7=veeva_constants_1[_0x1be298(0x220)][_0x1be298(0x22d)]+_0x81001a,_0x23abc7=await this[_0x1be298(0x20f)][_0x1be298(0x225)](_0x51f9a7);return _0x23abc7[_0x1be298(0x205)]((_0x4be2a5,_0x3584c7)=>_0x4be2a5[_0x1be298(0x227)](_0x3584c7['id'],_0x3584c7[_0x1be298(0x21f)]),new Map());}async[a359_0x1d33ba(0x222)](_0x66c0a2){const _0x420ae6=a359_0x1d33ba;this[_0x420ae6(0x21e)][_0x420ae6(0x21b)](_0x420ae6(0x1f8));const _0x105d84=[],_0x5477bf=_0x66c0a2['map'](_0x469a65=>{const _0xe05b47=_0x420ae6;return this['_connection'][_0xe05b47(0x207)](veeva_constants_1[_0xe05b47(0x220)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],encodeURI(_0xe05b47(0x221))+'='+encodeURI(_0x469a65),{'headers':{'Content-Type':'application/x-www-form-urlencoded'}});}),_0x3b709e=await Promise['all'](_0x5477bf);for(const {data:_0x528a14}of _0x3b709e){if(_0x528a14[_0x420ae6(0x1f6)]===status_enums_1[_0x420ae6(0x20e)][_0x420ae6(0x228)]){const {url:_0x647b1a}=_0x528a14;_0x105d84['push'](_0x647b1a);}else throw new veeva_error_1[(_0x420ae6(0x223))](_0x528a14[_0x420ae6(0x231)]);}return _0x105d84;}async[a359_0x1d33ba(0x20a)](_0x3e8274){const _0x520ba4=a359_0x1d33ba;this[_0x520ba4(0x21e)][_0x520ba4(0x21b)]('Retrieve\x20Jobs\x20Status');const _0x3ea3fa=[],_0x13270b=await this[_0x520ba4(0x20f)][_0x520ba4(0x209)](_0x3e8274);for(const _0x3dc731 of _0x13270b){const _0x2a53d8=_0x3dc731[_0x520ba4(0x22a)][_0x520ba4(0x230)](_0x3e95a8=>_0x3e95a8[_0x520ba4(0x23e)]===_0x520ba4(0x21c))['map'](_0x3391b1=>_0x3391b1[_0x520ba4(0x1ff)]);_0x3ea3fa[_0x520ba4(0x203)](..._0x2a53d8);}return _0x3ea3fa;}async['retrieveVPKList'](_0xfd5f70){const _0x5098d5=a359_0x1d33ba;var _0x3ffc07;const _0x11ef33=[];this[_0x5098d5(0x21e)][_0x5098d5(0x21b)]('Retrieve\x20Outbound\x20Package\x20zip\x20list');for(const _0x103783 of _0xfd5f70){const {data:_0x3f0bd3,headers:_0x59c8db}=await this[_0x5098d5(0x219)][_0x5098d5(0x20d)](_0x103783,{'responseType':_0x5098d5(0x208)}),_0x1d68ff=(_0x3ffc07=_0x59c8db['content-type'])===null||_0x3ffc07===void 0x0?void 0x0:_0x3ffc07[_0x5098d5(0x226)](_0x5098d5(0x229));if(!_0x1d68ff){const _0x3973c5=_0x3f0bd3,_0x172f00=new jszip_1[(_0x5098d5(0x206))]();await _0x172f00['loadAsync'](_0x3973c5),_0x11ef33[_0x5098d5(0x203)](_0x172f00);}else{const _0x15bf7b=JSON[_0x5098d5(0x239)](_0x3f0bd3);throw new veeva_error_1[(_0x5098d5(0x223))](_0x15bf7b[_0x5098d5(0x231)]);}}return _0x11ef33;}async[a359_0x1d33ba(0x22c)](_0x2a75b0){const _0x4f6653=a359_0x1d33ba;this[_0x4f6653(0x21e)][_0x4f6653(0x21b)](_0x4f6653(0x23d));const _0x2256c1=veeva_constants_1[_0x4f6653(0x220)][_0x4f6653(0x1f5)]+_0x4f6653(0x20b);await this[_0x4f6653(0x20f)][_0x4f6653(0x240)](_0x2256c1,_0x2a75b0);}async[a359_0x1d33ba(0x21a)](_0x510c39){const _0x27b58e=a359_0x1d33ba;this[_0x27b58e(0x21e)][_0x27b58e(0x21b)](_0x27b58e(0x204));const _0xf1dd16=veeva_constants_1[_0x27b58e(0x220)][_0x27b58e(0x1f5)]+'outbound_package__v';await this[_0x27b58e(0x20f)]['deleteVeevaObjectRecords'](_0xf1dd16,_0x510c39);}async[a359_0x1d33ba(0x236)](_0x337533,_0x3669c9){const _0x426dc3=a359_0x1d33ba,_0x482a98=await this[_0x426dc3(0x235)](Math[_0x426dc3(0x22e)](_0x337533[_0x426dc3(0x22f)]/veeva_constants_1[_0x426dc3(0x220)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x3669c9),_0xc486ae=await this[_0x426dc3(0x237)](_0x337533,_0x482a98),_0x286e04=await this[_0x426dc3(0x23b)](_0x482a98),_0x16725f=await this['createExportOutboundPackages'](Array[_0x426dc3(0x1fb)](_0x286e04['values']())),_0x4b93c3=await this[_0x426dc3(0x20a)](_0x16725f),_0x13baa5=await this[_0x426dc3(0x21d)](_0x4b93c3);return await this[_0x426dc3(0x22c)](_0xc486ae),await this[_0x426dc3(0x21a)](_0x482a98),_0x13baa5;}}exports[a359_0x1d33ba(0x1fd)]=PackageExportService;