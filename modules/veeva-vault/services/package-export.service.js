const a403_0xbdd1ce=a403_0x1d97;function a403_0x2ea2(){const _0x45cc82=['MAXIMUM_SIZE_OF_PACKAGE','ceil','href','getPackageNames','Getting\x20names\x20of\x20outbound\x20packages','ENDPOINT_EXPORT_IMPORT_PACKAGE','rel','VeevaConstants','createPackageComponents','46140fkSRMy','default','createOutboundPackages','arraybuffer','reduce','jszip','Creating\x20outbound\x20packages','responseStatus','Create\x20Export\x20outbound\x20packages.','executeVQL','VeevaResponseStatus','includes','getEndpointArtifactList','artifacts','PackageExportService','parse','SUCCESS','\x27,\x27','get','loadAsync','__importDefault','migration__sys','../constants/veeva.constants','212838joBXwI','constructor','_veevaService','ENDPOINT_CREATE_RECORDS','1013025mJqGJa','log','Retrieve\x20Jobs\x20Status','VeevaError','apply','Deleting\x20outbound\x20packages.','createVeevaObjectRecords','(((.+)+)+)+$','_connection','deleteVeevaObjectRecords','Retrieve\x20Outbound\x20Package\x20zip\x20list','package_component__v','retrieveVPKList','post','defineProperty','from','__esModule','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','push','685118UGZOxO','map','581034VrtXco','createExportOutboundPackages','toString','content-type','errors','_logger','application/json','search','application/x-www-form-urlencoded','deletePackageComponents','859135SUbPSU','length','282948SqAocX'];a403_0x2ea2=function(){return _0x45cc82;};return a403_0x2ea2();}(function(_0xefe7f0,_0x52e877){const _0x2426dd=a403_0x1d97,_0x458409=_0xefe7f0();while(!![]){try{const _0x411d5f=parseInt(_0x2426dd(0x19d))/0x1+-parseInt(_0x2426dd(0x1b4))/0x2+parseInt(_0x2426dd(0x1b8))/0x3+-parseInt(_0x2426dd(0x193))/0x4+-parseInt(_0x2426dd(0x191))/0x5+parseInt(_0x2426dd(0x187))/0x6+parseInt(_0x2426dd(0x1cb))/0x7;if(_0x411d5f===_0x52e877)break;else _0x458409['push'](_0x458409['shift']());}catch(_0x14c1fc){_0x458409['push'](_0x458409['shift']());}}}(a403_0x2ea2,0x380a9));const a403_0x4b4a0d=(function(){let _0x4d1359=!![];return function(_0x35c607,_0x308807){const _0x5e1d7b=_0x4d1359?function(){const _0x2b78b8=a403_0x1d97;if(_0x308807){const _0x4b1e46=_0x308807[_0x2b78b8(0x1bc)](_0x35c607,arguments);return _0x308807=null,_0x4b1e46;}}:function(){};return _0x4d1359=![],_0x5e1d7b;};}()),a403_0xcc9519=a403_0x4b4a0d(this,function(){const _0x4b1dd7=a403_0x1d97;return a403_0xcc9519['toString']()[_0x4b1dd7(0x18e)](_0x4b1dd7(0x1bf))[_0x4b1dd7(0x189)]()[_0x4b1dd7(0x1b5)](a403_0xcc9519)[_0x4b1dd7(0x18e)](_0x4b1dd7(0x1bf));});a403_0xcc9519();'use strict';var __importDefault=this&&this[a403_0xbdd1ce(0x1b1)]||function(_0x2a567b){const _0x35098c=a403_0xbdd1ce;return _0x2a567b&&_0x2a567b[_0x35098c(0x1c8)]?_0x2a567b:{'default':_0x2a567b};};Object[a403_0xbdd1ce(0x1c6)](exports,a403_0xbdd1ce(0x1c8),{'value':!![]}),exports['PackageExportService']=void 0x0;const veeva_constants_1=require(a403_0xbdd1ce(0x1b3)),jszip_1=__importDefault(require(a403_0xbdd1ce(0x1a2))),status_enums_1=require('../enums/status.enums'),veeva_error_1=require('../classes/errors/veeva-error');function a403_0x1d97(_0x2784c9,_0x3e00a1){const _0x13c720=a403_0x2ea2();return a403_0x1d97=function(_0xcc9519,_0x4b4a0d){_0xcc9519=_0xcc9519-0x187;let _0x2ea28b=_0x13c720[_0xcc9519];return _0x2ea28b;},a403_0x1d97(_0x2784c9,_0x3e00a1);}class PackageExportService{constructor({veevaService:_0x5871c2,connection:_0x167a02,logger:_0x1d3545}){const _0x58251c=a403_0xbdd1ce;this[_0x58251c(0x1b6)]=_0x5871c2,this['_connection']=_0x167a02,this['_logger']=_0x1d3545;}async['createOutboundPackages'](_0x38fb7f,_0x1a6853){const _0x165bd6=a403_0xbdd1ce;this[_0x165bd6(0x18c)][_0x165bd6(0x1b9)](_0x165bd6(0x1a3));const _0x37734a=veeva_constants_1['VeevaConstants'][_0x165bd6(0x1b7)]+'outbound_package__v',_0x374fd3=new Array(_0x38fb7f)['fill']({'summary__v':_0x1a6853,'object_type__v.api__name__v':_0x165bd6(0x1b2)});return await this['_veevaService'][_0x165bd6(0x1be)](_0x37734a,_0x374fd3);}async[a403_0xbdd1ce(0x19c)](_0x443195,_0x53da06){const _0x5a14e2=a403_0xbdd1ce;this[_0x5a14e2(0x18c)][_0x5a14e2(0x1b9)]('Adding\x20components\x20to\x20outbound\x20package');const _0x24ade3=veeva_constants_1[_0x5a14e2(0x19b)][_0x5a14e2(0x1b7)]+'package_component__v',_0x269e8c=_0x443195[_0x5a14e2(0x1cc)]((_0x16e8e0,_0x2fc6b3)=>({'vault_component__v':_0x16e8e0['id'],'outbound_package__v':_0x53da06[Math[_0x5a14e2(0x195)]((_0x2fc6b3+0x1)/veeva_constants_1[_0x5a14e2(0x19b)][_0x5a14e2(0x194)])-0x1]}));return await this['_veevaService']['createVeevaObjectRecords'](_0x24ade3,_0x269e8c);}async[a403_0xbdd1ce(0x197)](_0x14c4ec){const _0x3e1fae=a403_0xbdd1ce;this[_0x3e1fae(0x18c)]['log'](_0x3e1fae(0x198));const _0x2268e3=_0x3e1fae(0x1c9)+_0x14c4ec['join'](_0x3e1fae(0x1ae))+'\x27)',_0x5b631f=await this['_veevaService'][_0x3e1fae(0x1a6)](_0x2268e3);return _0x5b631f[_0x3e1fae(0x1a1)]((_0x4d36f1,_0x1d1dd1)=>_0x4d36f1['set'](_0x1d1dd1['id'],_0x1d1dd1['name__v']),new Map());}async[a403_0xbdd1ce(0x188)](_0x38e10d){const _0x4906db=a403_0xbdd1ce;this[_0x4906db(0x18c)][_0x4906db(0x1b9)](_0x4906db(0x1a5));const _0x33a3ac=[],_0x162d1f=_0x38e10d[_0x4906db(0x1cc)](_0x37aaec=>{const _0xb4fc22=_0x4906db;return this[_0xb4fc22(0x1c0)][_0xb4fc22(0x1c5)](veeva_constants_1[_0xb4fc22(0x19b)][_0xb4fc22(0x199)],encodeURI('packageName')+'='+encodeURI(_0x37aaec),{'headers':{'Content-Type':_0xb4fc22(0x18f)}});}),_0x224c1f=await Promise['all'](_0x162d1f);for(const {data:_0x3e3715}of _0x224c1f){if(_0x3e3715[_0x4906db(0x1a4)]===status_enums_1[_0x4906db(0x1a7)][_0x4906db(0x1ad)]){const {url:_0x9e8c02}=_0x3e3715;_0x33a3ac[_0x4906db(0x1ca)](_0x9e8c02);}else throw new veeva_error_1[(_0x4906db(0x1bb))](_0x3e3715[_0x4906db(0x18b)]);}return _0x33a3ac;}async[a403_0xbdd1ce(0x1a9)](_0x24bbbe){const _0x139f9e=a403_0xbdd1ce;this[_0x139f9e(0x18c)][_0x139f9e(0x1b9)](_0x139f9e(0x1ba));const _0x3c83ff=[],_0x51a595=await this[_0x139f9e(0x1b6)]['getJobResult'](_0x24bbbe);for(const _0x141cb3 of _0x51a595){const _0x406ffd=_0x141cb3['links']['filter'](_0xfb4e6a=>_0xfb4e6a[_0x139f9e(0x19a)]===_0x139f9e(0x1aa))[_0x139f9e(0x1cc)](_0x112ff0=>_0x112ff0[_0x139f9e(0x196)]);_0x3c83ff[_0x139f9e(0x1ca)](..._0x406ffd);}return _0x3c83ff;}async[a403_0xbdd1ce(0x1c4)](_0xa0c4f1){const _0x2dea9c=a403_0xbdd1ce;var _0x411630;const _0x1aaceb=[];this[_0x2dea9c(0x18c)]['log'](_0x2dea9c(0x1c2));for(const _0x4ff4a6 of _0xa0c4f1){const {data:_0x2e8ae0,headers:_0x49efae}=await this['_connection'][_0x2dea9c(0x1af)](_0x4ff4a6,{'responseType':_0x2dea9c(0x1a0)}),_0x5d8b5c=(_0x411630=_0x49efae[_0x2dea9c(0x18a)])===null||_0x411630===void 0x0?void 0x0:_0x411630[_0x2dea9c(0x1a8)](_0x2dea9c(0x18d));if(!_0x5d8b5c){const _0x4584a4=_0x2e8ae0,_0x3265b6=new jszip_1[(_0x2dea9c(0x19e))]();await _0x3265b6[_0x2dea9c(0x1b0)](_0x4584a4),_0x1aaceb[_0x2dea9c(0x1ca)](_0x3265b6);}else{const _0x3d8f49=JSON[_0x2dea9c(0x1ac)](_0x2e8ae0);throw new veeva_error_1['VeevaError'](_0x3d8f49[_0x2dea9c(0x18b)]);}}return _0x1aaceb;}async[a403_0xbdd1ce(0x190)](_0x35998a){const _0x67fbd8=a403_0xbdd1ce;this[_0x67fbd8(0x18c)][_0x67fbd8(0x1b9)]('Removing\x20components\x20from\x20outbound\x20packages.');const _0x27a4a2=veeva_constants_1[_0x67fbd8(0x19b)][_0x67fbd8(0x1b7)]+_0x67fbd8(0x1c3);await this[_0x67fbd8(0x1b6)]['deleteVeevaObjectRecords'](_0x27a4a2,_0x35998a);}async['deleteOutboundPackages'](_0x4c363d){const _0x38cea6=a403_0xbdd1ce;this[_0x38cea6(0x18c)]['log'](_0x38cea6(0x1bd));const _0x138237=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+'outbound_package__v';await this[_0x38cea6(0x1b6)][_0x38cea6(0x1c1)](_0x138237,_0x4c363d);}async['export'](_0x1e2584,_0x5bac49){const _0x5767fe=a403_0xbdd1ce,_0x7ebb1=await this[_0x5767fe(0x19f)](Math[_0x5767fe(0x195)](_0x1e2584[_0x5767fe(0x192)]/veeva_constants_1[_0x5767fe(0x19b)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x5bac49),_0x6ca102=await this['createPackageComponents'](_0x1e2584,_0x7ebb1),_0x111e69=await this[_0x5767fe(0x197)](_0x7ebb1),_0x383982=await this['createExportOutboundPackages'](Array[_0x5767fe(0x1c7)](_0x111e69['values']())),_0x5827a5=await this[_0x5767fe(0x1a9)](_0x383982),_0x59bc69=await this[_0x5767fe(0x1c4)](_0x5827a5);return await this[_0x5767fe(0x190)](_0x6ca102),await this['deleteOutboundPackages'](_0x7ebb1),_0x59bc69;}}exports[a403_0xbdd1ce(0x1ab)]=PackageExportService;