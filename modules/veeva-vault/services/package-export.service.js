const a358_0x4346c2=a358_0x1b05;(function(_0x3f35ad,_0xcf0a2b){const _0x11923e=a358_0x1b05,_0x1d81cf=_0x3f35ad();while(!![]){try{const _0x540ec8=-parseInt(_0x11923e(0x142))/0x1*(parseInt(_0x11923e(0x160))/0x2)+parseInt(_0x11923e(0x181))/0x3+parseInt(_0x11923e(0x17a))/0x4*(parseInt(_0x11923e(0x140))/0x5)+-parseInt(_0x11923e(0x14b))/0x6*(-parseInt(_0x11923e(0x173))/0x7)+parseInt(_0x11923e(0x189))/0x8*(-parseInt(_0x11923e(0x158))/0x9)+-parseInt(_0x11923e(0x141))/0xa+parseInt(_0x11923e(0x147))/0xb*(-parseInt(_0x11923e(0x187))/0xc);if(_0x540ec8===_0xcf0a2b)break;else _0x1d81cf['push'](_0x1d81cf['shift']());}catch(_0x3c2998){_0x1d81cf['push'](_0x1d81cf['shift']());}}}(a358_0x586c,0x3c42c));const a358_0x2bdcd4=(function(){let _0x5a1838=!![];return function(_0x197433,_0x58239c){const _0x12417d=_0x5a1838?function(){const _0x53bfec=a358_0x1b05;if(_0x58239c){const _0x3f9eb7=_0x58239c[_0x53bfec(0x14d)](_0x197433,arguments);return _0x58239c=null,_0x3f9eb7;}}:function(){};return _0x5a1838=![],_0x12417d;};}()),a358_0x592a72=a358_0x2bdcd4(this,function(){const _0x5767ab=a358_0x1b05;return a358_0x592a72[_0x5767ab(0x145)]()['search'](_0x5767ab(0x149))['toString']()[_0x5767ab(0x172)](a358_0x592a72)[_0x5767ab(0x148)](_0x5767ab(0x149));});a358_0x592a72();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x42a685){const _0xcbcc77=a358_0x1b05;return _0x42a685&&_0x42a685[_0xcbcc77(0x17f)]?_0x42a685:{'default':_0x42a685};};function a358_0x1b05(_0x1e9c25,_0x10dc44){const _0x188ebb=a358_0x586c();return a358_0x1b05=function(_0x592a72,_0x2bdcd4){_0x592a72=_0x592a72-0x13d;let _0x586c7e=_0x188ebb[_0x592a72];return _0x586c7e;},a358_0x1b05(_0x1e9c25,_0x10dc44);}Object[a358_0x4346c2(0x17e)](exports,'__esModule',{'value':!![]}),exports[a358_0x4346c2(0x14e)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require(a358_0x4346c2(0x171))),status_enums_1=require(a358_0x4346c2(0x15b)),veeva_error_1=require(a358_0x4346c2(0x161));function a358_0x586c(){const _0x28ea7b=['../enums/status.enums','arraybuffer','deletePackageComponents','Creating\x20outbound\x20packages','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','2iyfsqu','../classes/errors/veeva-error','ENDPOINT_EXPORT_IMPORT_PACKAGE','VeevaResponseStatus','ceil','ENDPOINT_CREATE_RECORDS','get','outbound_package__v','artifacts','post','export','Adding\x20components\x20to\x20outbound\x20package','retrieveVPKList','join','log','executeVQL','Removing\x20components\x20from\x20outbound\x20packages.','jszip','constructor','19600vlYHvf','push','deleteOutboundPackages','Retrieve\x20Outbound\x20Package\x20zip\x20list','MAXIMUM_SIZE_OF_PACKAGE','loadAsync','VeevaConstants','4YqIyko','default','Create\x20Export\x20outbound\x20packages.','name__v','defineProperty','__esModule','_logger','581538NxrYYb','getPackageNames','createOutboundPackages','_veevaService','includes','links','814020guCfLL','createExportOutboundPackages','1208AOrEQS','createPackageComponents','package_component__v','ENDPOINT_VQL','Retrieve\x20Jobs\x20Status','1487595khCoPN','2967040WCdFsM','10889HoKkFY','rel','deleteVeevaObjectRecords','toString','migration__sys','33xTVZne','search','(((.+)+)+)+$','fill','600KyVgHA','getEndpointArtifactList','apply','PackageExportService','length','errors','map','SUCCESS','VeevaError','createVeevaObjectRecords','all','responseStatus','content-type','801HBozpG','set','_connection'];a358_0x586c=function(){return _0x28ea7b;};return a358_0x586c();}class PackageExportService{constructor({veevaService:_0x1400b8,connection:_0x3c39bb,logger:_0x13b071}){const _0x303ecb=a358_0x4346c2;this[_0x303ecb(0x184)]=_0x1400b8,this[_0x303ecb(0x15a)]=_0x3c39bb,this[_0x303ecb(0x180)]=_0x13b071;}async[a358_0x4346c2(0x183)](_0x5d2202,_0x53075f){const _0x245453=a358_0x4346c2;this['_logger'][_0x245453(0x16e)](_0x245453(0x15e));const _0x1a74c6=veeva_constants_1[_0x245453(0x179)][_0x245453(0x165)]+_0x245453(0x167),_0x272d82=new Array(_0x5d2202)[_0x245453(0x14a)]({'summary__v':_0x53075f,'object_type__v.api__name__v':_0x245453(0x146)});return await this[_0x245453(0x184)][_0x245453(0x154)](_0x1a74c6,_0x272d82);}async['createPackageComponents'](_0x28f835,_0x4b027f){const _0x52fccc=a358_0x4346c2;this[_0x52fccc(0x180)][_0x52fccc(0x16e)](_0x52fccc(0x16b));const _0x560703=veeva_constants_1[_0x52fccc(0x179)][_0x52fccc(0x165)]+_0x52fccc(0x13d),_0x261241=_0x28f835[_0x52fccc(0x151)]((_0x52cdb9,_0x4518cb)=>({'vault_component__v':_0x52cdb9['id'],'outbound_package__v':_0x4b027f[Math[_0x52fccc(0x164)]((_0x4518cb+0x1)/veeva_constants_1['VeevaConstants'][_0x52fccc(0x177)])-0x1]}));return await this[_0x52fccc(0x184)][_0x52fccc(0x154)](_0x560703,_0x261241);}async['getPackageNames'](_0x55a11c){const _0x51da60=a358_0x4346c2;this[_0x51da60(0x180)][_0x51da60(0x16e)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x58e773=_0x51da60(0x15f)+_0x55a11c[_0x51da60(0x16d)]('\x27,\x27')+'\x27)',_0x5e7414=veeva_constants_1[_0x51da60(0x179)][_0x51da60(0x13e)]+_0x58e773,_0x5e15a4=await this[_0x51da60(0x184)][_0x51da60(0x16f)](_0x5e7414);return _0x5e15a4['reduce']((_0x27e02f,_0x5d662f)=>_0x27e02f[_0x51da60(0x159)](_0x5d662f['id'],_0x5d662f[_0x51da60(0x17d)]),new Map());}async[a358_0x4346c2(0x188)](_0x22b649){const _0x870f72=a358_0x4346c2;this[_0x870f72(0x180)][_0x870f72(0x16e)](_0x870f72(0x17c));const _0x1264a3=[],_0x43c19a=_0x22b649[_0x870f72(0x151)](_0x4fd5fa=>{const _0x306684=_0x870f72;return this[_0x306684(0x15a)][_0x306684(0x169)](veeva_constants_1[_0x306684(0x179)][_0x306684(0x162)],encodeURI('packageName')+'='+encodeURI(_0x4fd5fa),{'headers':{'Content-Type':'application/x-www-form-urlencoded'}});}),_0x554297=await Promise[_0x870f72(0x155)](_0x43c19a);for(const {data:_0x340797}of _0x554297){if(_0x340797[_0x870f72(0x156)]===status_enums_1[_0x870f72(0x163)][_0x870f72(0x152)]){const {url:_0x22d74d}=_0x340797;_0x1264a3[_0x870f72(0x174)](_0x22d74d);}else throw new veeva_error_1[(_0x870f72(0x153))](_0x340797[_0x870f72(0x150)]);}return _0x1264a3;}async['getEndpointArtifactList'](_0x22fa2a){const _0x2a13ed=a358_0x4346c2;this['_logger'][_0x2a13ed(0x16e)](_0x2a13ed(0x13f));const _0x4b9c39=[],_0x5c9e99=await this[_0x2a13ed(0x184)]['getJobResult'](_0x22fa2a);for(const _0x4a68ec of _0x5c9e99){const _0x328c9d=_0x4a68ec[_0x2a13ed(0x186)]['filter'](_0x21e70=>_0x21e70[_0x2a13ed(0x143)]===_0x2a13ed(0x168))[_0x2a13ed(0x151)](_0x5dd410=>_0x5dd410['href']);_0x4b9c39['push'](..._0x328c9d);}return _0x4b9c39;}async['retrieveVPKList'](_0x2780f5){const _0x22190a=a358_0x4346c2;var _0x4b1fa8;const _0x76af64=[];this[_0x22190a(0x180)][_0x22190a(0x16e)](_0x22190a(0x176));for(const _0x48e0af of _0x2780f5){const {data:_0xd11242,headers:_0xb6654}=await this[_0x22190a(0x15a)][_0x22190a(0x166)](_0x48e0af,{'responseType':_0x22190a(0x15c)}),_0x223c84=(_0x4b1fa8=_0xb6654[_0x22190a(0x157)])===null||_0x4b1fa8===void 0x0?void 0x0:_0x4b1fa8[_0x22190a(0x185)]('application/json');if(!_0x223c84){const _0x2c5357=_0xd11242,_0x5b0a5b=new jszip_1[(_0x22190a(0x17b))]();await _0x5b0a5b[_0x22190a(0x178)](_0x2c5357),_0x76af64[_0x22190a(0x174)](_0x5b0a5b);}else{const _0x39b8bc=JSON['parse'](_0xd11242);throw new veeva_error_1[(_0x22190a(0x153))](_0x39b8bc[_0x22190a(0x150)]);}}return _0x76af64;}async[a358_0x4346c2(0x15d)](_0x52c827){const _0x4ae847=a358_0x4346c2;this[_0x4ae847(0x180)][_0x4ae847(0x16e)](_0x4ae847(0x170));const _0x45beea=veeva_constants_1['VeevaConstants'][_0x4ae847(0x165)]+'package_component__v';await this['_veevaService'][_0x4ae847(0x144)](_0x45beea,_0x52c827);}async[a358_0x4346c2(0x175)](_0x5c6b85){const _0x533860=a358_0x4346c2;this[_0x533860(0x180)][_0x533860(0x16e)]('Deleting\x20outbound\x20packages.');const _0x5713b5=veeva_constants_1['VeevaConstants'][_0x533860(0x165)]+'outbound_package__v';await this[_0x533860(0x184)]['deleteVeevaObjectRecords'](_0x5713b5,_0x5c6b85);}async[a358_0x4346c2(0x16a)](_0x5c14d2,_0x3d9353){const _0x3c1e72=a358_0x4346c2,_0x3cad9a=await this['createOutboundPackages'](Math[_0x3c1e72(0x164)](_0x5c14d2[_0x3c1e72(0x14f)]/veeva_constants_1[_0x3c1e72(0x179)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x3d9353),_0x2f3f4a=await this[_0x3c1e72(0x18a)](_0x5c14d2,_0x3cad9a),_0x47b8de=await this[_0x3c1e72(0x182)](_0x3cad9a),_0x176d59=await this[_0x3c1e72(0x188)](Array['from'](_0x47b8de['values']())),_0x3abd60=await this[_0x3c1e72(0x14c)](_0x176d59),_0x1c9a1d=await this[_0x3c1e72(0x16c)](_0x3abd60);return await this['deletePackageComponents'](_0x2f3f4a),await this[_0x3c1e72(0x175)](_0x3cad9a),_0x1c9a1d;}}exports[a358_0x4346c2(0x14e)]=PackageExportService;