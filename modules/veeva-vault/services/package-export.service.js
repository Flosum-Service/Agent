const a358_0xf3269c=a358_0x2920;function a358_0x2920(_0x3b701e,_0x5c11cb){const _0x38c2e2=a358_0x1e29();return a358_0x2920=function(_0xaaaf5c,_0x33e212){_0xaaaf5c=_0xaaaf5c-0x165;let _0x1e2963=_0x38c2e2[_0xaaaf5c];return _0x1e2963;},a358_0x2920(_0x3b701e,_0x5c11cb);}(function(_0x54c9f0,_0x5bdac5){const _0x264b05=a358_0x2920,_0xe25be2=_0x54c9f0();while(!![]){try{const _0x8f307b=parseInt(_0x264b05(0x1a3))/0x1+parseInt(_0x264b05(0x18e))/0x2+parseInt(_0x264b05(0x194))/0x3+parseInt(_0x264b05(0x182))/0x4+parseInt(_0x264b05(0x199))/0x5*(-parseInt(_0x264b05(0x169))/0x6)+-parseInt(_0x264b05(0x186))/0x7+-parseInt(_0x264b05(0x19c))/0x8;if(_0x8f307b===_0x5bdac5)break;else _0xe25be2['push'](_0xe25be2['shift']());}catch(_0x4e1e9b){_0xe25be2['push'](_0xe25be2['shift']());}}}(a358_0x1e29,0xc39dc));const a358_0x33e212=(function(){let _0x3d0300=!![];return function(_0x51738b,_0x5add6e){const _0x6f1ac4=_0x3d0300?function(){const _0x132e4c=a358_0x2920;if(_0x5add6e){const _0x1e5811=_0x5add6e[_0x132e4c(0x188)](_0x51738b,arguments);return _0x5add6e=null,_0x1e5811;}}:function(){};return _0x3d0300=![],_0x6f1ac4;};}()),a358_0xaaaf5c=a358_0x33e212(this,function(){const _0x143911=a358_0x2920;return a358_0xaaaf5c[_0x143911(0x1a6)]()[_0x143911(0x174)](_0x143911(0x1a7))[_0x143911(0x1a6)]()[_0x143911(0x1a9)](a358_0xaaaf5c)[_0x143911(0x174)](_0x143911(0x1a7));});a358_0xaaaf5c();'use strict';var __importDefault=this&&this[a358_0xf3269c(0x16b)]||function(_0x4c5d97){const _0x12cd87=a358_0xf3269c;return _0x4c5d97&&_0x4c5d97[_0x12cd87(0x195)]?_0x4c5d97:{'default':_0x4c5d97};};function a358_0x1e29(){const _0x293b81=['constructor','VeevaConstants','Deleting\x20outbound\x20packages.','map','filter','SUCCESS','createPackageComponents','750ZAWQyW','deleteOutboundPackages','__importDefault','MAXIMUM_SIZE_OF_PACKAGE','PackageExportService','createOutboundPackages','deletePackageComponents','includes','getPackageNames','get','Adding\x20components\x20to\x20outbound\x20package','search','values','join','post','ceil','_logger','ENDPOINT_CREATE_RECORDS','packageName','rel','links','_veevaService','Creating\x20outbound\x20packages','migration__sys','parse','197440fSQyjG','default','getEndpointArtifactList','outbound_package__v','4322486VcTJyt','package_component__v','apply','_connection','executeVQL','retrieveVPKList','name__v','../classes/errors/veeva-error','366298zjpgnx','href','../constants/veeva.constants','Removing\x20components\x20from\x20outbound\x20packages.','content-type','push','3809961mRmJVZ','__esModule','errors','arraybuffer','application/x-www-form-urlencoded','18965uhkeZg','deleteVeevaObjectRecords','loadAsync','2181136RghQYc','createExportOutboundPackages','Retrieve\x20Outbound\x20Package\x20zip\x20list','createVeevaObjectRecords','artifacts','Retrieve\x20Jobs\x20Status','VeevaResponseStatus','663013lbZjcg','defineProperty','log','toString','(((.+)+)+)+$','Getting\x20names\x20of\x20outbound\x20packages'];a358_0x1e29=function(){return _0x293b81;};return a358_0x1e29();}Object[a358_0xf3269c(0x1a4)](exports,a358_0xf3269c(0x195),{'value':!![]}),exports[a358_0xf3269c(0x16d)]=void 0x0;const veeva_constants_1=require(a358_0xf3269c(0x190)),jszip_1=__importDefault(require('jszip')),status_enums_1=require('../enums/status.enums'),veeva_error_1=require(a358_0xf3269c(0x18d));class PackageExportService{constructor({veevaService:_0x7619a9,connection:_0x37ff9b,logger:_0x5485e6}){const _0x1baca1=a358_0xf3269c;this[_0x1baca1(0x17e)]=_0x7619a9,this[_0x1baca1(0x189)]=_0x37ff9b,this[_0x1baca1(0x179)]=_0x5485e6;}async['createOutboundPackages'](_0x1b7761,_0x1f46c5){const _0x401ba9=a358_0xf3269c;this['_logger'][_0x401ba9(0x1a5)](_0x401ba9(0x17f));const _0x19da93=veeva_constants_1['VeevaConstants'][_0x401ba9(0x17a)]+'outbound_package__v',_0x1dac3c=new Array(_0x1b7761)['fill']({'summary__v':_0x1f46c5,'object_type__v.api__name__v':_0x401ba9(0x180)});return await this['_veevaService']['createVeevaObjectRecords'](_0x19da93,_0x1dac3c);}async[a358_0xf3269c(0x168)](_0x1cb624,_0x779bf4){const _0x3e022f=a358_0xf3269c;this[_0x3e022f(0x179)][_0x3e022f(0x1a5)](_0x3e022f(0x173));const _0x4499ea=veeva_constants_1[_0x3e022f(0x1aa)][_0x3e022f(0x17a)]+'package_component__v',_0xf018de=_0x1cb624[_0x3e022f(0x165)]((_0x38614e,_0x171916)=>({'vault_component__v':_0x38614e['id'],'outbound_package__v':_0x779bf4[Math[_0x3e022f(0x178)]((_0x171916+0x1)/veeva_constants_1[_0x3e022f(0x1aa)][_0x3e022f(0x16c)])-0x1]}));return await this['_veevaService'][_0x3e022f(0x19f)](_0x4499ea,_0xf018de);}async[a358_0xf3269c(0x171)](_0x77cb7c){const _0x13f242=a358_0xf3269c;this[_0x13f242(0x179)]['log'](_0x13f242(0x1a8));const _0x1d6e68='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x77cb7c[_0x13f242(0x176)]('\x27,\x27')+'\x27)',_0x3c0935=veeva_constants_1[_0x13f242(0x1aa)]['ENDPOINT_VQL']+_0x1d6e68,_0x4288de=await this[_0x13f242(0x17e)][_0x13f242(0x18a)](_0x3c0935);return _0x4288de['reduce']((_0xf25484,_0x4b7935)=>_0xf25484['set'](_0x4b7935['id'],_0x4b7935[_0x13f242(0x18c)]),new Map());}async[a358_0xf3269c(0x19d)](_0x36346c){const _0x36a6ee=a358_0xf3269c;this[_0x36a6ee(0x179)][_0x36a6ee(0x1a5)]('Create\x20Export\x20outbound\x20packages.');const _0x249dd2=[],_0x22ef34=_0x36346c[_0x36a6ee(0x165)](_0x2c076d=>{const _0x5d5006=_0x36a6ee;return this['_connection'][_0x5d5006(0x177)](veeva_constants_1[_0x5d5006(0x1aa)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],encodeURI(_0x5d5006(0x17b))+'='+encodeURI(_0x2c076d),{'headers':{'Content-Type':_0x5d5006(0x198)}});}),_0x70b126=await Promise['all'](_0x22ef34);for(const {data:_0x26be6f}of _0x70b126){if(_0x26be6f['responseStatus']===status_enums_1[_0x36a6ee(0x1a2)][_0x36a6ee(0x167)]){const {url:_0x34282e}=_0x26be6f;_0x249dd2[_0x36a6ee(0x193)](_0x34282e);}else throw new veeva_error_1['VeevaError'](_0x26be6f[_0x36a6ee(0x196)]);}return _0x249dd2;}async[a358_0xf3269c(0x184)](_0x57493c){const _0x52c4a2=a358_0xf3269c;this[_0x52c4a2(0x179)][_0x52c4a2(0x1a5)](_0x52c4a2(0x1a1));const _0x5bd2a3=[],_0x81055f=await this[_0x52c4a2(0x17e)]['getJobResult'](_0x57493c);for(const _0x1d4fba of _0x81055f){const _0x13be1c=_0x1d4fba[_0x52c4a2(0x17d)][_0x52c4a2(0x166)](_0xfae4d7=>_0xfae4d7[_0x52c4a2(0x17c)]===_0x52c4a2(0x1a0))[_0x52c4a2(0x165)](_0x481dfd=>_0x481dfd[_0x52c4a2(0x18f)]);_0x5bd2a3[_0x52c4a2(0x193)](..._0x13be1c);}return _0x5bd2a3;}async['retrieveVPKList'](_0x54a986){const _0x5b481c=a358_0xf3269c;var _0x480e92;const _0x1d9bc1=[];this['_logger']['log'](_0x5b481c(0x19e));for(const _0x282cba of _0x54a986){const {data:_0x1ad35f,headers:_0x1ffea7}=await this[_0x5b481c(0x189)][_0x5b481c(0x172)](_0x282cba,{'responseType':_0x5b481c(0x197)}),_0x590dba=(_0x480e92=_0x1ffea7[_0x5b481c(0x192)])===null||_0x480e92===void 0x0?void 0x0:_0x480e92[_0x5b481c(0x170)]('application/json');if(!_0x590dba){const _0x479918=_0x1ad35f,_0x4e1e14=new jszip_1[(_0x5b481c(0x183))]();await _0x4e1e14[_0x5b481c(0x19b)](_0x479918),_0x1d9bc1[_0x5b481c(0x193)](_0x4e1e14);}else{const _0x4aade=JSON[_0x5b481c(0x181)](_0x1ad35f);throw new veeva_error_1['VeevaError'](_0x4aade[_0x5b481c(0x196)]);}}return _0x1d9bc1;}async[a358_0xf3269c(0x16f)](_0x4d2ed1){const _0x50a4e2=a358_0xf3269c;this['_logger']['log'](_0x50a4e2(0x191));const _0x112704=veeva_constants_1[_0x50a4e2(0x1aa)][_0x50a4e2(0x17a)]+_0x50a4e2(0x187);await this[_0x50a4e2(0x17e)][_0x50a4e2(0x19a)](_0x112704,_0x4d2ed1);}async[a358_0xf3269c(0x16a)](_0x4de300){const _0x34455f=a358_0xf3269c;this[_0x34455f(0x179)][_0x34455f(0x1a5)](_0x34455f(0x1ab));const _0x25ae82=veeva_constants_1[_0x34455f(0x1aa)][_0x34455f(0x17a)]+_0x34455f(0x185);await this['_veevaService'][_0x34455f(0x19a)](_0x25ae82,_0x4de300);}async['export'](_0x58e5ac,_0x223b55){const _0x2dda95=a358_0xf3269c,_0x360087=await this[_0x2dda95(0x16e)](Math[_0x2dda95(0x178)](_0x58e5ac['length']/veeva_constants_1[_0x2dda95(0x1aa)][_0x2dda95(0x16c)]),_0x223b55),_0x314f2e=await this['createPackageComponents'](_0x58e5ac,_0x360087),_0x263f88=await this[_0x2dda95(0x171)](_0x360087),_0x2d95ee=await this[_0x2dda95(0x19d)](Array['from'](_0x263f88[_0x2dda95(0x175)]())),_0x5783ea=await this[_0x2dda95(0x184)](_0x2d95ee),_0x37ca36=await this[_0x2dda95(0x18b)](_0x5783ea);return await this[_0x2dda95(0x16f)](_0x314f2e),await this['deleteOutboundPackages'](_0x360087),_0x37ca36;}}exports[a358_0xf3269c(0x16d)]=PackageExportService;