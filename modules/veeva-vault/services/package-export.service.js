const a391_0x221dd9=a391_0x6982;function a391_0x42c1(){const _0xbf33f7=['getEndpointArtifactList','ENDPOINT_CREATE_RECORDS','defineProperty','_veevaService','../enums/status.enums','export','Adding\x20components\x20to\x20outbound\x20package','search','Retrieve\x20Outbound\x20Package\x20zip\x20list','reduce','fill','outbound_package__v','VeevaError','default','deleteVeevaObjectRecords','values','_logger','application/x-www-form-urlencoded','5751612lNEFde','21530sUqOqd','1805270WvojNk','constructor','filter','(((.+)+)+)+$','push','VeevaResponseStatus','SUCCESS','from','set','arraybuffer','../constants/veeva.constants','27680922IDendV','Removing\x20components\x20from\x20outbound\x20packages.','apply','getPackageNames','../classes/errors/veeva-error','_connection','parse','PackageExportService','deleteOutboundPackages','log','3227cnwEFh','__esModule','application/json','Creating\x20outbound\x20packages','get','packageName','5198610Idoyol','Retrieve\x20Jobs\x20Status','__importDefault','href','retrieveVPKList','post','artifacts','errors','rel','MAXIMUM_SIZE_OF_PACKAGE','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','toString','501YVeEfZ','createExportOutboundPackages','all','VeevaConstants','map','package_component__v','4624dQuxhV','Deleting\x20outbound\x20packages.','1716296JGtVAz','links','Create\x20Export\x20outbound\x20packages.','includes','content-type','createVeevaObjectRecords','deletePackageComponents','jszip','migration__sys','ceil'];a391_0x42c1=function(){return _0xbf33f7;};return a391_0x42c1();}(function(_0x278ce6,_0x520024){const _0x4811e9=a391_0x6982,_0x1125c=_0x278ce6();while(!![]){try{const _0x788d1b=-parseInt(_0x4811e9(0xcf))/0x1+-parseInt(_0x4811e9(0xec))/0x2*(-parseInt(_0x4811e9(0xc7))/0x3)+-parseInt(_0x4811e9(0xeb))/0x4+parseInt(_0x4811e9(0xed))/0x5+-parseInt(_0x4811e9(0xbb))/0x6+parseInt(_0x4811e9(0x102))/0x7*(-parseInt(_0x4811e9(0xcd))/0x8)+parseInt(_0x4811e9(0xf8))/0x9;if(_0x788d1b===_0x520024)break;else _0x1125c['push'](_0x1125c['shift']());}catch(_0x304edf){_0x1125c['push'](_0x1125c['shift']());}}}(a391_0x42c1,0xe74af));const a391_0x3a8d49=(function(){let _0xd6667b=!![];return function(_0x5a13dc,_0x2b42f3){const _0x30c981=_0xd6667b?function(){const _0x5f28cf=a391_0x6982;if(_0x2b42f3){const _0x3de48d=_0x2b42f3[_0x5f28cf(0xfa)](_0x5a13dc,arguments);return _0x2b42f3=null,_0x3de48d;}}:function(){};return _0xd6667b=![],_0x30c981;};}()),a391_0x21e50f=a391_0x3a8d49(this,function(){const _0x563a14=a391_0x6982;return a391_0x21e50f[_0x563a14(0xc6)]()[_0x563a14(0xe0)](_0x563a14(0xf0))[_0x563a14(0xc6)]()[_0x563a14(0xee)](a391_0x21e50f)[_0x563a14(0xe0)](_0x563a14(0xf0));});a391_0x21e50f();'use strict';var __importDefault=this&&this[a391_0x221dd9(0xbd)]||function(_0x598ea6){return _0x598ea6&&_0x598ea6['__esModule']?_0x598ea6:{'default':_0x598ea6};};function a391_0x6982(_0x3bfff4,_0x5457d0){const _0x2b945d=a391_0x42c1();return a391_0x6982=function(_0x21e50f,_0x3a8d49){_0x21e50f=_0x21e50f-0xb9;let _0x42c133=_0x2b945d[_0x21e50f];return _0x42c133;},a391_0x6982(_0x3bfff4,_0x5457d0);}Object[a391_0x221dd9(0xdb)](exports,a391_0x221dd9(0x103),{'value':!![]}),exports[a391_0x221dd9(0xff)]=void 0x0;const veeva_constants_1=require(a391_0x221dd9(0xf7)),jszip_1=__importDefault(require(a391_0x221dd9(0xd6))),status_enums_1=require(a391_0x221dd9(0xdd)),veeva_error_1=require(a391_0x221dd9(0xfc));class PackageExportService{constructor({veevaService:_0x23c401,connection:_0x29e10a,logger:_0x37a456}){const _0x243d03=a391_0x221dd9;this[_0x243d03(0xdc)]=_0x23c401,this[_0x243d03(0xfd)]=_0x29e10a,this[_0x243d03(0xe9)]=_0x37a456;}async['createOutboundPackages'](_0x45545e,_0x2e77b4){const _0x19ea54=a391_0x221dd9;this[_0x19ea54(0xe9)][_0x19ea54(0x101)](_0x19ea54(0x105));const _0x1b1a89=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+_0x19ea54(0xe4),_0x25eb51=new Array(_0x45545e)[_0x19ea54(0xe3)]({'summary__v':_0x2e77b4,'object_type__v.api__name__v':_0x19ea54(0xd7)});return await this['_veevaService'][_0x19ea54(0xd4)](_0x1b1a89,_0x25eb51);}async['createPackageComponents'](_0x3d1140,_0x70fb89){const _0x1ba13e=a391_0x221dd9;this[_0x1ba13e(0xe9)][_0x1ba13e(0x101)](_0x1ba13e(0xdf));const _0x2a92da=veeva_constants_1[_0x1ba13e(0xca)][_0x1ba13e(0xda)]+_0x1ba13e(0xcc),_0x17c6df=_0x3d1140[_0x1ba13e(0xcb)]((_0xe85695,_0x632c82)=>({'vault_component__v':_0xe85695['id'],'outbound_package__v':_0x70fb89[Math[_0x1ba13e(0xd8)]((_0x632c82+0x1)/veeva_constants_1[_0x1ba13e(0xca)][_0x1ba13e(0xc4)])-0x1]}));return await this['_veevaService'][_0x1ba13e(0xd4)](_0x2a92da,_0x17c6df);}async[a391_0x221dd9(0xfb)](_0x2af15d){const _0x4f6b8f=a391_0x221dd9;this[_0x4f6b8f(0xe9)][_0x4f6b8f(0x101)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x45c8fe=_0x4f6b8f(0xc5)+_0x2af15d['join']('\x27,\x27')+'\x27)',_0x294f06=await this[_0x4f6b8f(0xdc)]['executeVQL'](_0x45c8fe);return _0x294f06[_0x4f6b8f(0xe2)]((_0x688b3e,_0x56bc0a)=>_0x688b3e[_0x4f6b8f(0xf5)](_0x56bc0a['id'],_0x56bc0a['name__v']),new Map());}async[a391_0x221dd9(0xc8)](_0x4fcb71){const _0x21f210=a391_0x221dd9;this[_0x21f210(0xe9)]['log'](_0x21f210(0xd1));const _0x56c58d=[],_0x424f2b=_0x4fcb71[_0x21f210(0xcb)](_0x3b760b=>{const _0x2eb15b=_0x21f210;return this[_0x2eb15b(0xfd)][_0x2eb15b(0xc0)](veeva_constants_1[_0x2eb15b(0xca)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],encodeURI(_0x2eb15b(0xba))+'='+encodeURI(_0x3b760b),{'headers':{'Content-Type':_0x2eb15b(0xea)}});}),_0x34cbe7=await Promise[_0x21f210(0xc9)](_0x424f2b);for(const {data:_0x4af055}of _0x34cbe7){if(_0x4af055['responseStatus']===status_enums_1[_0x21f210(0xf2)][_0x21f210(0xf3)]){const {url:_0x20bc31}=_0x4af055;_0x56c58d[_0x21f210(0xf1)](_0x20bc31);}else throw new veeva_error_1[(_0x21f210(0xe5))](_0x4af055[_0x21f210(0xc2)]);}return _0x56c58d;}async[a391_0x221dd9(0xd9)](_0x2ca9b5){const _0x264922=a391_0x221dd9;this[_0x264922(0xe9)]['log'](_0x264922(0xbc));const _0x3a8fe6=[],_0x59630a=await this[_0x264922(0xdc)]['getJobResult'](_0x2ca9b5);for(const _0x23ea5a of _0x59630a){const _0x3b56bc=_0x23ea5a[_0x264922(0xd0)][_0x264922(0xef)](_0x4f3a4e=>_0x4f3a4e[_0x264922(0xc3)]===_0x264922(0xc1))[_0x264922(0xcb)](_0x4db760=>_0x4db760[_0x264922(0xbe)]);_0x3a8fe6[_0x264922(0xf1)](..._0x3b56bc);}return _0x3a8fe6;}async['retrieveVPKList'](_0x7b276f){const _0x791b4=a391_0x221dd9;var _0x446a41;const _0x2bf5e7=[];this[_0x791b4(0xe9)][_0x791b4(0x101)](_0x791b4(0xe1));for(const _0x335c94 of _0x7b276f){const {data:_0x28263c,headers:_0x5ea105}=await this[_0x791b4(0xfd)][_0x791b4(0xb9)](_0x335c94,{'responseType':_0x791b4(0xf6)}),_0x19a438=(_0x446a41=_0x5ea105[_0x791b4(0xd3)])===null||_0x446a41===void 0x0?void 0x0:_0x446a41[_0x791b4(0xd2)](_0x791b4(0x104));if(!_0x19a438){const _0x5c5ea1=_0x28263c,_0x1b1e6c=new jszip_1[(_0x791b4(0xe6))]();await _0x1b1e6c['loadAsync'](_0x5c5ea1),_0x2bf5e7['push'](_0x1b1e6c);}else{const _0x572200=JSON[_0x791b4(0xfe)](_0x28263c);throw new veeva_error_1[(_0x791b4(0xe5))](_0x572200[_0x791b4(0xc2)]);}}return _0x2bf5e7;}async[a391_0x221dd9(0xd5)](_0x2b7c1f){const _0x396ca8=a391_0x221dd9;this[_0x396ca8(0xe9)][_0x396ca8(0x101)](_0x396ca8(0xf9));const _0x3aa1ce=veeva_constants_1[_0x396ca8(0xca)][_0x396ca8(0xda)]+_0x396ca8(0xcc);await this[_0x396ca8(0xdc)][_0x396ca8(0xe7)](_0x3aa1ce,_0x2b7c1f);}async['deleteOutboundPackages'](_0x22755d){const _0x56f5a7=a391_0x221dd9;this[_0x56f5a7(0xe9)][_0x56f5a7(0x101)](_0x56f5a7(0xce));const _0x123ab0=veeva_constants_1[_0x56f5a7(0xca)][_0x56f5a7(0xda)]+_0x56f5a7(0xe4);await this[_0x56f5a7(0xdc)]['deleteVeevaObjectRecords'](_0x123ab0,_0x22755d);}async[a391_0x221dd9(0xde)](_0x12f282,_0x1d96d7){const _0x40acce=a391_0x221dd9,_0x2744e6=await this['createOutboundPackages'](Math[_0x40acce(0xd8)](_0x12f282['length']/veeva_constants_1['VeevaConstants'][_0x40acce(0xc4)]),_0x1d96d7),_0x261f98=await this['createPackageComponents'](_0x12f282,_0x2744e6),_0x59b791=await this[_0x40acce(0xfb)](_0x2744e6),_0x19c5ee=await this[_0x40acce(0xc8)](Array[_0x40acce(0xf4)](_0x59b791[_0x40acce(0xe8)]())),_0x44468d=await this[_0x40acce(0xd9)](_0x19c5ee),_0x3f16ed=await this[_0x40acce(0xbf)](_0x44468d);return await this['deletePackageComponents'](_0x261f98),await this[_0x40acce(0x100)](_0x2744e6),_0x3f16ed;}}exports[a391_0x221dd9(0xff)]=PackageExportService;