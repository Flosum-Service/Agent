const a375_0x18182f=a375_0x5eec;(function(_0x8b980e,_0x4c79eb){const _0x1fe700=a375_0x5eec,_0x39ee37=_0x8b980e();while(!![]){try{const _0x1006c7=-parseInt(_0x1fe700(0x139))/0x1+-parseInt(_0x1fe700(0x107))/0x2+parseInt(_0x1fe700(0x137))/0x3+-parseInt(_0x1fe700(0x13d))/0x4+parseInt(_0x1fe700(0x10c))/0x5*(parseInt(_0x1fe700(0x125))/0x6)+parseInt(_0x1fe700(0x12c))/0x7+-parseInt(_0x1fe700(0x122))/0x8;if(_0x1006c7===_0x4c79eb)break;else _0x39ee37['push'](_0x39ee37['shift']());}catch(_0x3ba6b8){_0x39ee37['push'](_0x39ee37['shift']());}}}(a375_0x4121,0xb569a));const a375_0x176cbf=(function(){let _0x2647ae=!![];return function(_0x899723,_0x1aada4){const _0x1914c0=_0x2647ae?function(){if(_0x1aada4){const _0x8f210b=_0x1aada4['apply'](_0x899723,arguments);return _0x1aada4=null,_0x8f210b;}}:function(){};return _0x2647ae=![],_0x1914c0;};}()),a375_0x1a1cef=a375_0x176cbf(this,function(){const _0x1abc6f=a375_0x5eec;return a375_0x1a1cef[_0x1abc6f(0x13f)]()[_0x1abc6f(0x12d)](_0x1abc6f(0x138))[_0x1abc6f(0x13f)]()['constructor'](a375_0x1a1cef)['search'](_0x1abc6f(0x138));});a375_0x1a1cef();'use strict';var __importDefault=this&&this[a375_0x18182f(0x131)]||function(_0x26923c){const _0x576081=a375_0x18182f;return _0x26923c&&_0x26923c[_0x576081(0x120)]?_0x26923c:{'default':_0x26923c};};Object[a375_0x18182f(0x115)](exports,a375_0x18182f(0x120),{'value':!![]}),exports[a375_0x18182f(0x132)]=void 0x0;const veeva_constants_1=require(a375_0x18182f(0x109)),jszip_1=__importDefault(require(a375_0x18182f(0x144))),status_enums_1=require(a375_0x18182f(0x124)),veeva_error_1=require('../classes/errors/veeva-error');class PackageExportService{constructor({veevaService:_0x692175,connection:_0x137fd4,logger:_0x51cc3a}){const _0xc5a28=a375_0x18182f;this['_veevaService']=_0x692175,this['_connection']=_0x137fd4,this[_0xc5a28(0x141)]=_0x51cc3a;}async[a375_0x18182f(0x11c)](_0x5054ef,_0x15bc7c){const _0x9f987f=a375_0x18182f;this[_0x9f987f(0x141)][_0x9f987f(0x143)](_0x9f987f(0x114));const _0x5520d1=veeva_constants_1[_0x9f987f(0x12a)]['ENDPOINT_CREATE_RECORDS']+_0x9f987f(0x118),_0x8c5b8e=new Array(_0x5054ef)[_0x9f987f(0x140)]({'summary__v':_0x15bc7c,'object_type__v.api__name__v':_0x9f987f(0x104)});return await this['_veevaService'][_0x9f987f(0x11a)](_0x5520d1,_0x8c5b8e);}async[a375_0x18182f(0x13e)](_0xb804f4,_0x49cf22){const _0x54003d=a375_0x18182f;this[_0x54003d(0x141)][_0x54003d(0x143)]('Adding\x20components\x20to\x20outbound\x20package');const _0x39dfca=veeva_constants_1[_0x54003d(0x12a)][_0x54003d(0x112)]+'package_component__v',_0x4a9f54=_0xb804f4[_0x54003d(0x12e)]((_0x86f3d7,_0x37d34a)=>({'vault_component__v':_0x86f3d7['id'],'outbound_package__v':_0x49cf22[Math['ceil']((_0x37d34a+0x1)/veeva_constants_1[_0x54003d(0x12a)]['MAXIMUM_SIZE_OF_PACKAGE'])-0x1]}));return await this[_0x54003d(0x110)][_0x54003d(0x11a)](_0x39dfca,_0x4a9f54);}async[a375_0x18182f(0x105)](_0x34e3a3){const _0xd68855=a375_0x18182f;this['_logger'][_0xd68855(0x143)](_0xd68855(0x111));const _0x53d489='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x34e3a3['join']('\x27,\x27')+'\x27)',_0x39b356=await this['_veevaService'][_0xd68855(0x119)](_0x53d489);return _0x39b356['reduce']((_0x38f640,_0x4a1468)=>_0x38f640[_0xd68855(0x133)](_0x4a1468['id'],_0x4a1468[_0xd68855(0x145)]),new Map());}async['createExportOutboundPackages'](_0x56917c){const _0x4b201c=a375_0x18182f;this[_0x4b201c(0x141)]['log']('Create\x20Export\x20outbound\x20packages.');const _0x1e588f=[],_0x8e3732=_0x56917c[_0x4b201c(0x12e)](_0x176385=>{const _0xf53fbd=_0x4b201c;return this[_0xf53fbd(0x117)][_0xf53fbd(0x12f)](veeva_constants_1[_0xf53fbd(0x12a)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],encodeURI(_0xf53fbd(0x13b))+'='+encodeURI(_0x176385),{'headers':{'Content-Type':'application/x-www-form-urlencoded'}});}),_0x559c9f=await Promise[_0x4b201c(0x10b)](_0x8e3732);for(const {data:_0x2749b2}of _0x559c9f){if(_0x2749b2[_0x4b201c(0x116)]===status_enums_1['VeevaResponseStatus'][_0x4b201c(0x135)]){const {url:_0x37f619}=_0x2749b2;_0x1e588f[_0x4b201c(0x11d)](_0x37f619);}else throw new veeva_error_1[(_0x4b201c(0x108))](_0x2749b2[_0x4b201c(0x128)]);}return _0x1e588f;}async[a375_0x18182f(0x121)](_0xddab5c){const _0x3dd297=a375_0x18182f;this[_0x3dd297(0x141)][_0x3dd297(0x143)](_0x3dd297(0x10d));const _0x4eeb4a=[],_0x446575=await this[_0x3dd297(0x110)][_0x3dd297(0x136)](_0xddab5c);for(const _0x5d1457 of _0x446575){const _0x541dcb=_0x5d1457['links'][_0x3dd297(0x103)](_0xe14093=>_0xe14093['rel']===_0x3dd297(0x134))[_0x3dd297(0x12e)](_0x3dd105=>_0x3dd105[_0x3dd297(0x11f)]);_0x4eeb4a[_0x3dd297(0x11d)](..._0x541dcb);}return _0x4eeb4a;}async[a375_0x18182f(0x106)](_0x3d55e9){const _0x273125=a375_0x18182f;var _0x3eb39b;const _0x5a033a=[];this[_0x273125(0x141)][_0x273125(0x143)]('Retrieve\x20Outbound\x20Package\x20zip\x20list');for(const _0x2425b6 of _0x3d55e9){const {data:_0x71147c,headers:_0x2d75cb}=await this[_0x273125(0x117)][_0x273125(0x129)](_0x2425b6,{'responseType':_0x273125(0x113)}),_0x32e4be=(_0x3eb39b=_0x2d75cb['content-type'])===null||_0x3eb39b===void 0x0?void 0x0:_0x3eb39b['includes'](_0x273125(0x123));if(!_0x32e4be){const _0x109a35=_0x71147c,_0x515908=new jszip_1[(_0x273125(0x127))]();await _0x515908['loadAsync'](_0x109a35),_0x5a033a[_0x273125(0x11d)](_0x515908);}else{const _0x543811=JSON['parse'](_0x71147c);throw new veeva_error_1[(_0x273125(0x108))](_0x543811[_0x273125(0x128)]);}}return _0x5a033a;}async[a375_0x18182f(0x13a)](_0x59ea88){const _0x3db298=a375_0x18182f;this[_0x3db298(0x141)]['log'](_0x3db298(0x10a));const _0x22ed1e=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+_0x3db298(0x13c);await this[_0x3db298(0x110)]['deleteVeevaObjectRecords'](_0x22ed1e,_0x59ea88);}async[a375_0x18182f(0x142)](_0x307f77){const _0x4adcc7=a375_0x18182f;this[_0x4adcc7(0x141)][_0x4adcc7(0x143)](_0x4adcc7(0x11e));const _0x58f127=veeva_constants_1[_0x4adcc7(0x12a)][_0x4adcc7(0x112)]+_0x4adcc7(0x118);await this[_0x4adcc7(0x110)][_0x4adcc7(0x11b)](_0x58f127,_0x307f77);}async['export'](_0x20ad9f,_0x5d5c2a){const _0x8e4129=a375_0x18182f,_0x3c6fec=await this[_0x8e4129(0x11c)](Math[_0x8e4129(0x12b)](_0x20ad9f[_0x8e4129(0x10e)]/veeva_constants_1['VeevaConstants'][_0x8e4129(0x10f)]),_0x5d5c2a),_0x3ddce0=await this[_0x8e4129(0x13e)](_0x20ad9f,_0x3c6fec),_0x5881ad=await this['getPackageNames'](_0x3c6fec),_0x34e480=await this[_0x8e4129(0x126)](Array['from'](_0x5881ad[_0x8e4129(0x130)]())),_0x3d2a99=await this[_0x8e4129(0x121)](_0x34e480),_0x5bd7eb=await this[_0x8e4129(0x106)](_0x3d2a99);return await this['deletePackageComponents'](_0x3ddce0),await this[_0x8e4129(0x142)](_0x3c6fec),_0x5bd7eb;}}function a375_0x5eec(_0x796280,_0x21156f){const _0x2475dd=a375_0x4121();return a375_0x5eec=function(_0x1a1cef,_0x176cbf){_0x1a1cef=_0x1a1cef-0x103;let _0x4121e1=_0x2475dd[_0x1a1cef];return _0x4121e1;},a375_0x5eec(_0x796280,_0x21156f);}function a375_0x4121(){const _0x51401b=['__importDefault','PackageExportService','set','artifacts','SUCCESS','getJobResult','2390634WMSoWi','(((.+)+)+)+$','1151893LsgcwK','deletePackageComponents','packageName','package_component__v','1467252EVlXfv','createPackageComponents','toString','fill','_logger','deleteOutboundPackages','log','jszip','name__v','filter','migration__sys','getPackageNames','retrieveVPKList','405266CSWjDH','VeevaError','../constants/veeva.constants','Removing\x20components\x20from\x20outbound\x20packages.','all','10PjttWQ','Retrieve\x20Jobs\x20Status','length','MAXIMUM_SIZE_OF_PACKAGE','_veevaService','Getting\x20names\x20of\x20outbound\x20packages','ENDPOINT_CREATE_RECORDS','arraybuffer','Creating\x20outbound\x20packages','defineProperty','responseStatus','_connection','outbound_package__v','executeVQL','createVeevaObjectRecords','deleteVeevaObjectRecords','createOutboundPackages','push','Deleting\x20outbound\x20packages.','href','__esModule','getEndpointArtifactList','1747800lJIZpL','application/json','../enums/status.enums','4224354ccILKn','createExportOutboundPackages','default','errors','get','VeevaConstants','ceil','3345188aBATpb','search','map','post','values'];a375_0x4121=function(){return _0x51401b;};return a375_0x4121();}exports['PackageExportService']=PackageExportService;