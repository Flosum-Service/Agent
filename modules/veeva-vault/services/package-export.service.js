const a402_0x3a081b=a402_0x4e05;(function(_0x8d0670,_0x3d7623){const _0x187762=a402_0x4e05,_0x263e3e=_0x8d0670();while(!![]){try{const _0x15f442=parseInt(_0x187762(0xaa))/0x1*(-parseInt(_0x187762(0xd7))/0x2)+parseInt(_0x187762(0xb0))/0x3*(parseInt(_0x187762(0xc6))/0x4)+-parseInt(_0x187762(0x96))/0x5+-parseInt(_0x187762(0xba))/0x6*(parseInt(_0x187762(0xcb))/0x7)+parseInt(_0x187762(0xc4))/0x8+parseInt(_0x187762(0xa0))/0x9+parseInt(_0x187762(0xc5))/0xa;if(_0x15f442===_0x3d7623)break;else _0x263e3e['push'](_0x263e3e['shift']());}catch(_0x3e72b8){_0x263e3e['push'](_0x263e3e['shift']());}}}(a402_0x35d6,0x65bb0));const a402_0x53fed=(function(){let _0x1cb2ee=!![];return function(_0x346aba,_0xf26b5f){const _0xba62a6=_0x1cb2ee?function(){const _0x976600=a402_0x4e05;if(_0xf26b5f){const _0x44155c=_0xf26b5f[_0x976600(0xcf)](_0x346aba,arguments);return _0xf26b5f=null,_0x44155c;}}:function(){};return _0x1cb2ee=![],_0xba62a6;};}()),a402_0x4773c6=a402_0x53fed(this,function(){const _0x15da8f=a402_0x4e05;return a402_0x4773c6[_0x15da8f(0xc2)]()[_0x15da8f(0xd5)]('(((.+)+)+)+$')[_0x15da8f(0xc2)]()['constructor'](a402_0x4773c6)['search'](_0x15da8f(0xd4));});function a402_0x35d6(){const _0x121a39=['Retrieve\x20Jobs\x20Status','(((.+)+)+)+$','search','VeevaConstants','827566clOIFt','Creating\x20outbound\x20packages','responseStatus','name__v','arraybuffer','3291180egtwnE','ENDPOINT_CREATE_RECORDS','createExportOutboundPackages','map','ceil','length','../enums/status.enums','rel','../classes/errors/veeva-error','log','4688307ndsubb','parse','application/x-www-form-urlencoded','values','package_component__v','Retrieve\x20Outbound\x20Package\x20zip\x20list','VeevaError','filter','retrieveVPKList','getJobResult','1HxMXfO','get','defineProperty','VeevaResponseStatus','_veevaService','__esModule','7605QEuyfc','createOutboundPackages','default','includes','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','\x27,\x27','Create\x20Export\x20outbound\x20packages.','content-type','Deleting\x20outbound\x20packages.','outbound_package__v','314010PCVUnk','errors','deleteVeevaObjectRecords','Adding\x20components\x20to\x20outbound\x20package','deleteOutboundPackages','push','_logger','_connection','toString','jszip','3538648gXZhYd','3431730JGHgCy','1196klBraD','all','MAXIMUM_SIZE_OF_PACKAGE','__importDefault','from','77UrrJxR','deletePackageComponents','migration__sys','getPackageNames','apply','PackageExportService','getEndpointArtifactList','createVeevaObjectRecords'];a402_0x35d6=function(){return _0x121a39;};return a402_0x35d6();}function a402_0x4e05(_0x5a2fec,_0x57a4cd){const _0x3b0c06=a402_0x35d6();return a402_0x4e05=function(_0x4773c6,_0x53fed){_0x4773c6=_0x4773c6-0x93;let _0x35d6f5=_0x3b0c06[_0x4773c6];return _0x35d6f5;},a402_0x4e05(_0x5a2fec,_0x57a4cd);}a402_0x4773c6();'use strict';var __importDefault=this&&this[a402_0x3a081b(0xc9)]||function(_0x3a437e){return _0x3a437e&&_0x3a437e['__esModule']?_0x3a437e:{'default':_0x3a437e};};Object[a402_0x3a081b(0xac)](exports,a402_0x3a081b(0xaf),{'value':!![]}),exports[a402_0x3a081b(0xd0)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require(a402_0x3a081b(0xc3))),status_enums_1=require(a402_0x3a081b(0x9c)),veeva_error_1=require(a402_0x3a081b(0x9e));class PackageExportService{constructor({veevaService:_0x23a06a,connection:_0x129f79,logger:_0x1fd94f}){const _0x1fecd1=a402_0x3a081b;this[_0x1fecd1(0xae)]=_0x23a06a,this[_0x1fecd1(0xc1)]=_0x129f79,this[_0x1fecd1(0xc0)]=_0x1fd94f;}async['createOutboundPackages'](_0x4c252b,_0x426057){const _0x104704=a402_0x3a081b;this['_logger'][_0x104704(0x9f)](_0x104704(0xd8));const _0x4eff3c=veeva_constants_1[_0x104704(0xd6)][_0x104704(0x97)]+_0x104704(0xb9),_0x358932=new Array(_0x4c252b)['fill']({'summary__v':_0x426057,'object_type__v.api__name__v':_0x104704(0xcd)});return await this[_0x104704(0xae)][_0x104704(0xd2)](_0x4eff3c,_0x358932);}async['createPackageComponents'](_0x2160e5,_0x558807){const _0x414730=a402_0x3a081b;this[_0x414730(0xc0)]['log'](_0x414730(0xbd));const _0x1f69e0=veeva_constants_1[_0x414730(0xd6)]['ENDPOINT_CREATE_RECORDS']+_0x414730(0xa4),_0x3869f8=_0x2160e5['map']((_0x50be8d,_0x3228f7)=>({'vault_component__v':_0x50be8d['id'],'outbound_package__v':_0x558807[Math[_0x414730(0x9a)]((_0x3228f7+0x1)/veeva_constants_1[_0x414730(0xd6)][_0x414730(0xc8)])-0x1]}));return await this[_0x414730(0xae)]['createVeevaObjectRecords'](_0x1f69e0,_0x3869f8);}async[a402_0x3a081b(0xce)](_0x5e5832){const _0xbb050b=a402_0x3a081b;this[_0xbb050b(0xc0)][_0xbb050b(0x9f)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x2d9cbe=_0xbb050b(0xb4)+_0x5e5832['join'](_0xbb050b(0xb5))+'\x27)',_0x323b49=await this['_veevaService']['executeVQL'](_0x2d9cbe);return _0x323b49['reduce']((_0x1bf032,_0x32a1e5)=>_0x1bf032['set'](_0x32a1e5['id'],_0x32a1e5[_0xbb050b(0x94)]),new Map());}async[a402_0x3a081b(0x98)](_0x2ae2e1){const _0xb9a16f=a402_0x3a081b;this[_0xb9a16f(0xc0)][_0xb9a16f(0x9f)](_0xb9a16f(0xb6));const _0x23f022=[],_0x2f988b=_0x2ae2e1[_0xb9a16f(0x99)](_0x42a2d5=>{const _0x44b2b6=_0xb9a16f;return this[_0x44b2b6(0xc1)]['post'](veeva_constants_1[_0x44b2b6(0xd6)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],encodeURI('packageName')+'='+encodeURI(_0x42a2d5),{'headers':{'Content-Type':_0x44b2b6(0xa2)}});}),_0x1a3fc6=await Promise[_0xb9a16f(0xc7)](_0x2f988b);for(const {data:_0x572441}of _0x1a3fc6){if(_0x572441[_0xb9a16f(0x93)]===status_enums_1[_0xb9a16f(0xad)]['SUCCESS']){const {url:_0x2d8712}=_0x572441;_0x23f022['push'](_0x2d8712);}else throw new veeva_error_1[(_0xb9a16f(0xa6))](_0x572441[_0xb9a16f(0xbb)]);}return _0x23f022;}async[a402_0x3a081b(0xd1)](_0x1fbc24){const _0x5d0749=a402_0x3a081b;this[_0x5d0749(0xc0)][_0x5d0749(0x9f)](_0x5d0749(0xd3));const _0x301ffb=[],_0x11616e=await this[_0x5d0749(0xae)][_0x5d0749(0xa9)](_0x1fbc24);for(const _0x292269 of _0x11616e){const _0x30a0c1=_0x292269['links'][_0x5d0749(0xa7)](_0x33d64a=>_0x33d64a[_0x5d0749(0x9d)]==='artifacts')[_0x5d0749(0x99)](_0x1aeddd=>_0x1aeddd['href']);_0x301ffb[_0x5d0749(0xbf)](..._0x30a0c1);}return _0x301ffb;}async['retrieveVPKList'](_0x48a0a4){const _0x3f85a5=a402_0x3a081b;var _0x2a41f4;const _0x2cb5b5=[];this[_0x3f85a5(0xc0)][_0x3f85a5(0x9f)](_0x3f85a5(0xa5));for(const _0x11263a of _0x48a0a4){const {data:_0x47d82b,headers:_0x26b2ad}=await this[_0x3f85a5(0xc1)][_0x3f85a5(0xab)](_0x11263a,{'responseType':_0x3f85a5(0x95)}),_0x1ef44e=(_0x2a41f4=_0x26b2ad[_0x3f85a5(0xb7)])===null||_0x2a41f4===void 0x0?void 0x0:_0x2a41f4[_0x3f85a5(0xb3)]('application/json');if(!_0x1ef44e){const _0x44c23e=_0x47d82b,_0x341199=new jszip_1[(_0x3f85a5(0xb2))]();await _0x341199['loadAsync'](_0x44c23e),_0x2cb5b5[_0x3f85a5(0xbf)](_0x341199);}else{const _0x4c47ec=JSON[_0x3f85a5(0xa1)](_0x47d82b);throw new veeva_error_1['VeevaError'](_0x4c47ec['errors']);}}return _0x2cb5b5;}async[a402_0x3a081b(0xcc)](_0x5d407d){const _0x39c4ac=a402_0x3a081b;this[_0x39c4ac(0xc0)][_0x39c4ac(0x9f)]('Removing\x20components\x20from\x20outbound\x20packages.');const _0x47f1b5=veeva_constants_1[_0x39c4ac(0xd6)][_0x39c4ac(0x97)]+'package_component__v';await this[_0x39c4ac(0xae)][_0x39c4ac(0xbc)](_0x47f1b5,_0x5d407d);}async['deleteOutboundPackages'](_0x92feb3){const _0x17927b=a402_0x3a081b;this['_logger'][_0x17927b(0x9f)](_0x17927b(0xb8));const _0x33452a=veeva_constants_1[_0x17927b(0xd6)][_0x17927b(0x97)]+_0x17927b(0xb9);await this[_0x17927b(0xae)][_0x17927b(0xbc)](_0x33452a,_0x92feb3);}async['export'](_0x298a19,_0x4e3670){const _0x56bc43=a402_0x3a081b,_0x53440e=await this[_0x56bc43(0xb1)](Math[_0x56bc43(0x9a)](_0x298a19[_0x56bc43(0x9b)]/veeva_constants_1[_0x56bc43(0xd6)][_0x56bc43(0xc8)]),_0x4e3670),_0x53280b=await this['createPackageComponents'](_0x298a19,_0x53440e),_0x1b464d=await this['getPackageNames'](_0x53440e),_0x204035=await this[_0x56bc43(0x98)](Array[_0x56bc43(0xca)](_0x1b464d[_0x56bc43(0xa3)]())),_0x2f4e86=await this['getEndpointArtifactList'](_0x204035),_0x56dfc4=await this[_0x56bc43(0xa8)](_0x2f4e86);return await this[_0x56bc43(0xcc)](_0x53280b),await this[_0x56bc43(0xbe)](_0x53440e),_0x56dfc4;}}exports[a402_0x3a081b(0xd0)]=PackageExportService;