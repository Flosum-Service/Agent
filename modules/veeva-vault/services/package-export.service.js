const a402_0x3cfd9b=a402_0xfbb3;(function(_0x15e625,_0x4563dd){const _0xf360ae=a402_0xfbb3,_0x213e76=_0x15e625();while(!![]){try{const _0x5e0d9b=-parseInt(_0xf360ae(0xda))/0x1*(parseInt(_0xf360ae(0xa0))/0x2)+parseInt(_0xf360ae(0xdf))/0x3*(-parseInt(_0xf360ae(0xd2))/0x4)+parseInt(_0xf360ae(0xa6))/0x5*(parseInt(_0xf360ae(0xa3))/0x6)+parseInt(_0xf360ae(0xea))/0x7+parseInt(_0xf360ae(0xd4))/0x8+-parseInt(_0xf360ae(0xbe))/0x9*(parseInt(_0xf360ae(0xbb))/0xa)+parseInt(_0xf360ae(0xae))/0xb;if(_0x5e0d9b===_0x4563dd)break;else _0x213e76['push'](_0x213e76['shift']());}catch(_0x1cf8ae){_0x213e76['push'](_0x213e76['shift']());}}}(a402_0x4716,0x468bd));function a402_0xfbb3(_0x450f9f,_0x1b0b12){const _0x42becc=a402_0x4716();return a402_0xfbb3=function(_0x37373f,_0x1a932f){_0x37373f=_0x37373f-0xa0;let _0x471625=_0x42becc[_0x37373f];return _0x471625;},a402_0xfbb3(_0x450f9f,_0x1b0b12);}function a402_0x4716(){const _0x33f456=['links','errors','executeVQL','_connection','filter','\x27,\x27','28TsTIfu','Retrieve\x20Outbound\x20Package\x20zip\x20list','1913240vuitiY','getPackageNames','../classes/errors/veeva-error','includes','log','retrieveVPKList','1fPUHBw','outbound_package__v','(((.+)+)+)+$','map','post','238671dOgWvI','Creating\x20outbound\x20packages','set','__importDefault','artifacts','deletePackageComponents','parse','createOutboundPackages','PackageExportService','createPackageComponents','VeevaConstants','1152123TDoxMm','Retrieve\x20Jobs\x20Status','38842ZmFePZ','deleteVeevaObjectRecords','all','12JaJYon','apply','constructor','346075xnFopk','SUCCESS','search','reduce','application/x-www-form-urlencoded','ceil','application/json','deleteOutboundPackages','6359254gaduGS','createExportOutboundPackages','VeevaError','getEndpointArtifactList','../enums/status.enums','arraybuffer','package_component__v','ENDPOINT_EXPORT_IMPORT_PACKAGE','content-type','default','Deleting\x20outbound\x20packages.','length','jszip','9410yEtfFE','_logger','_veevaService','2439vkmNkN','MAXIMUM_SIZE_OF_PACKAGE','defineProperty','Adding\x20components\x20to\x20outbound\x20package','push','__esModule','ENDPOINT_CREATE_RECORDS','rel','responseStatus','../constants/veeva.constants','values','migration__sys','name__v','toString'];a402_0x4716=function(){return _0x33f456;};return a402_0x4716();}const a402_0x1a932f=(function(){let _0x43a118=!![];return function(_0x98d3ec,_0x532eb7){const _0x3e508c=_0x43a118?function(){const _0x19ea5e=a402_0xfbb3;if(_0x532eb7){const _0x3337cb=_0x532eb7[_0x19ea5e(0xa4)](_0x98d3ec,arguments);return _0x532eb7=null,_0x3337cb;}}:function(){};return _0x43a118=![],_0x3e508c;};}()),a402_0x37373f=a402_0x1a932f(this,function(){const _0x4dc6db=a402_0xfbb3;return a402_0x37373f['toString']()[_0x4dc6db(0xa8)]('(((.+)+)+)+$')[_0x4dc6db(0xcb)]()[_0x4dc6db(0xa5)](a402_0x37373f)[_0x4dc6db(0xa8)](_0x4dc6db(0xdc));});a402_0x37373f();'use strict';var __importDefault=this&&this[a402_0x3cfd9b(0xe2)]||function(_0x56d723){return _0x56d723&&_0x56d723['__esModule']?_0x56d723:{'default':_0x56d723};};Object[a402_0x3cfd9b(0xc0)](exports,a402_0x3cfd9b(0xc3),{'value':!![]}),exports['PackageExportService']=void 0x0;const veeva_constants_1=require(a402_0x3cfd9b(0xc7)),jszip_1=__importDefault(require(a402_0x3cfd9b(0xba))),status_enums_1=require(a402_0x3cfd9b(0xb2)),veeva_error_1=require(a402_0x3cfd9b(0xd6));class PackageExportService{constructor({veevaService:_0x131afc,connection:_0x5645c7,logger:_0x90e411}){const _0x21dde9=a402_0x3cfd9b;this[_0x21dde9(0xbd)]=_0x131afc,this['_connection']=_0x5645c7,this[_0x21dde9(0xbc)]=_0x90e411;}async[a402_0x3cfd9b(0xe6)](_0xeb523d,_0x3022d7){const _0x3e2b7f=a402_0x3cfd9b;this['_logger'][_0x3e2b7f(0xd8)](_0x3e2b7f(0xe0));const _0x4384b7=veeva_constants_1[_0x3e2b7f(0xe9)][_0x3e2b7f(0xc4)]+_0x3e2b7f(0xdb),_0x5370e3=new Array(_0xeb523d)['fill']({'summary__v':_0x3022d7,'object_type__v.api__name__v':_0x3e2b7f(0xc9)});return await this[_0x3e2b7f(0xbd)]['createVeevaObjectRecords'](_0x4384b7,_0x5370e3);}async[a402_0x3cfd9b(0xe8)](_0x3a21e6,_0x26b2f2){const _0x169d67=a402_0x3cfd9b;this[_0x169d67(0xbc)][_0x169d67(0xd8)](_0x169d67(0xc1));const _0x7a824d=veeva_constants_1[_0x169d67(0xe9)][_0x169d67(0xc4)]+_0x169d67(0xb4),_0x2cfa25=_0x3a21e6[_0x169d67(0xdd)]((_0x5e1889,_0x149894)=>({'vault_component__v':_0x5e1889['id'],'outbound_package__v':_0x26b2f2[Math[_0x169d67(0xab)]((_0x149894+0x1)/veeva_constants_1[_0x169d67(0xe9)][_0x169d67(0xbf)])-0x1]}));return await this[_0x169d67(0xbd)]['createVeevaObjectRecords'](_0x7a824d,_0x2cfa25);}async[a402_0x3cfd9b(0xd5)](_0x462e01){const _0x22cec0=a402_0x3cfd9b;this[_0x22cec0(0xbc)]['log']('Getting\x20names\x20of\x20outbound\x20packages');const _0x32b7b6='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x462e01['join'](_0x22cec0(0xd1))+'\x27)',_0x481313=await this[_0x22cec0(0xbd)][_0x22cec0(0xce)](_0x32b7b6);return _0x481313[_0x22cec0(0xa9)]((_0x40a42f,_0x1669fa)=>_0x40a42f[_0x22cec0(0xe1)](_0x1669fa['id'],_0x1669fa[_0x22cec0(0xca)]),new Map());}async[a402_0x3cfd9b(0xaf)](_0x134421){const _0x33ca10=a402_0x3cfd9b;this[_0x33ca10(0xbc)][_0x33ca10(0xd8)]('Create\x20Export\x20outbound\x20packages.');const _0x53e5fc=[],_0x46d598=_0x134421[_0x33ca10(0xdd)](_0x1eb87f=>{const _0x368ebd=_0x33ca10;return this[_0x368ebd(0xcf)][_0x368ebd(0xde)](veeva_constants_1[_0x368ebd(0xe9)][_0x368ebd(0xb5)],encodeURI('packageName')+'='+encodeURI(_0x1eb87f),{'headers':{'Content-Type':_0x368ebd(0xaa)}});}),_0x4599c5=await Promise[_0x33ca10(0xa2)](_0x46d598);for(const {data:_0x8a5901}of _0x4599c5){if(_0x8a5901[_0x33ca10(0xc6)]===status_enums_1['VeevaResponseStatus'][_0x33ca10(0xa7)]){const {url:_0x585f4f}=_0x8a5901;_0x53e5fc['push'](_0x585f4f);}else throw new veeva_error_1[(_0x33ca10(0xb0))](_0x8a5901[_0x33ca10(0xcd)]);}return _0x53e5fc;}async[a402_0x3cfd9b(0xb1)](_0x43dd7a){const _0x57815d=a402_0x3cfd9b;this['_logger'][_0x57815d(0xd8)](_0x57815d(0xeb));const _0x45ffd8=[],_0x111d09=await this[_0x57815d(0xbd)]['getJobResult'](_0x43dd7a);for(const _0x1b2762 of _0x111d09){const _0x570890=_0x1b2762[_0x57815d(0xcc)][_0x57815d(0xd0)](_0x207f6c=>_0x207f6c[_0x57815d(0xc5)]===_0x57815d(0xe3))['map'](_0x56ae5b=>_0x56ae5b['href']);_0x45ffd8[_0x57815d(0xc2)](..._0x570890);}return _0x45ffd8;}async[a402_0x3cfd9b(0xd9)](_0x39bcd2){const _0x445e7e=a402_0x3cfd9b;var _0x3c0e01;const _0xea0938=[];this[_0x445e7e(0xbc)]['log'](_0x445e7e(0xd3));for(const _0x27e3bd of _0x39bcd2){const {data:_0x42d9e0,headers:_0x47410a}=await this[_0x445e7e(0xcf)]['get'](_0x27e3bd,{'responseType':_0x445e7e(0xb3)}),_0xe99342=(_0x3c0e01=_0x47410a[_0x445e7e(0xb6)])===null||_0x3c0e01===void 0x0?void 0x0:_0x3c0e01[_0x445e7e(0xd7)](_0x445e7e(0xac));if(!_0xe99342){const _0x3ab072=_0x42d9e0,_0xc12eb9=new jszip_1[(_0x445e7e(0xb7))]();await _0xc12eb9['loadAsync'](_0x3ab072),_0xea0938['push'](_0xc12eb9);}else{const _0x5ddb33=JSON[_0x445e7e(0xe5)](_0x42d9e0);throw new veeva_error_1['VeevaError'](_0x5ddb33[_0x445e7e(0xcd)]);}}return _0xea0938;}async[a402_0x3cfd9b(0xe4)](_0xc20f39){const _0x5b97a9=a402_0x3cfd9b;this[_0x5b97a9(0xbc)]['log']('Removing\x20components\x20from\x20outbound\x20packages.');const _0x555ed7=veeva_constants_1[_0x5b97a9(0xe9)][_0x5b97a9(0xc4)]+_0x5b97a9(0xb4);await this[_0x5b97a9(0xbd)][_0x5b97a9(0xa1)](_0x555ed7,_0xc20f39);}async[a402_0x3cfd9b(0xad)](_0x6a0d1f){const _0x1bc124=a402_0x3cfd9b;this[_0x1bc124(0xbc)][_0x1bc124(0xd8)](_0x1bc124(0xb8));const _0xd2d7c=veeva_constants_1[_0x1bc124(0xe9)][_0x1bc124(0xc4)]+_0x1bc124(0xdb);await this[_0x1bc124(0xbd)][_0x1bc124(0xa1)](_0xd2d7c,_0x6a0d1f);}async['export'](_0x382294,_0x2de703){const _0x160cf3=a402_0x3cfd9b,_0x2fc527=await this[_0x160cf3(0xe6)](Math[_0x160cf3(0xab)](_0x382294[_0x160cf3(0xb9)]/veeva_constants_1[_0x160cf3(0xe9)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x2de703),_0xcfa75f=await this[_0x160cf3(0xe8)](_0x382294,_0x2fc527),_0x72fe51=await this['getPackageNames'](_0x2fc527),_0x40851c=await this[_0x160cf3(0xaf)](Array['from'](_0x72fe51[_0x160cf3(0xc8)]())),_0x6b6fa8=await this[_0x160cf3(0xb1)](_0x40851c),_0x2f6a89=await this[_0x160cf3(0xd9)](_0x6b6fa8);return await this['deletePackageComponents'](_0xcfa75f),await this[_0x160cf3(0xad)](_0x2fc527),_0x2f6a89;}}exports[a402_0x3cfd9b(0xe7)]=PackageExportService;