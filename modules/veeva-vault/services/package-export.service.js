const a391_0x10390a=a391_0x547c;(function(_0x218d2d,_0x2371fa){const _0x3243f7=a391_0x547c,_0x13080a=_0x218d2d();while(!![]){try{const _0x18e31c=-parseInt(_0x3243f7(0x205))/0x1*(-parseInt(_0x3243f7(0x1fb))/0x2)+-parseInt(_0x3243f7(0x219))/0x3+parseInt(_0x3243f7(0x225))/0x4+parseInt(_0x3243f7(0x222))/0x5*(parseInt(_0x3243f7(0x1fc))/0x6)+-parseInt(_0x3243f7(0x204))/0x7+parseInt(_0x3243f7(0x20f))/0x8+parseInt(_0x3243f7(0x224))/0x9*(parseInt(_0x3243f7(0x213))/0xa);if(_0x18e31c===_0x2371fa)break;else _0x13080a['push'](_0x13080a['shift']());}catch(_0x541e0d){_0x13080a['push'](_0x13080a['shift']());}}}(a391_0x5586,0x749db));function a391_0x5586(){const _0x1fc45b=['length','href','all','deleteVeevaObjectRecords','__esModule','PackageExportService','from','join','(((.+)+)+)+$','jszip','\x27,\x27','push','toString','deletePackageComponents','get','package_component__v','VeevaConstants','../enums/status.enums','VeevaResponseStatus','24vMAuVm','642Hiblrf','../constants/veeva.constants','map','fill','createOutboundPackages','log','_connection','application/json','5540017yPeRkY','17498CFWRlF','_veevaService','ENDPOINT_EXPORT_IMPORT_PACKAGE','getEndpointArtifactList','post','loadAsync','deleteOutboundPackages','ceil','createVeevaObjectRecords','Removing\x20components\x20from\x20outbound\x20packages.','3577344fDedoj','Creating\x20outbound\x20packages','search','Create\x20Export\x20outbound\x20packages.','40hJpZeQ','artifacts','set','SUCCESS','getPackageNames','packageName','2640177XldsHU','application/x-www-form-urlencoded','retrieveVPKList','createExportOutboundPackages','ENDPOINT_CREATE_RECORDS','name__v','outbound_package__v','errors','Adding\x20components\x20to\x20outbound\x20package','16195vpAIjh','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','1602819GsOfvI','1732272blypFH','arraybuffer','Deleting\x20outbound\x20packages.','createPackageComponents','MAXIMUM_SIZE_OF_PACKAGE','Retrieve\x20Jobs\x20Status','VeevaError','_logger','content-type','default','values'];a391_0x5586=function(){return _0x1fc45b;};return a391_0x5586();}const a391_0x465a67=(function(){let _0x1deab5=!![];return function(_0x3bca0,_0xfb8d3c){const _0x4fe6f3=_0x1deab5?function(){if(_0xfb8d3c){const _0x21b453=_0xfb8d3c['apply'](_0x3bca0,arguments);return _0xfb8d3c=null,_0x21b453;}}:function(){};return _0x1deab5=![],_0x4fe6f3;};}()),a391_0x3150fc=a391_0x465a67(this,function(){const _0x2d85c7=a391_0x547c;return a391_0x3150fc['toString']()[_0x2d85c7(0x211)]('(((.+)+)+)+$')[_0x2d85c7(0x1f4)]()['constructor'](a391_0x3150fc)['search'](_0x2d85c7(0x1f0));});a391_0x3150fc();'use strict';var __importDefault=this&&this['__importDefault']||function(_0xfe515c){const _0x49f4bc=a391_0x547c;return _0xfe515c&&_0xfe515c[_0x49f4bc(0x1ec)]?_0xfe515c:{'default':_0xfe515c};};Object['defineProperty'](exports,a391_0x10390a(0x1ec),{'value':!![]}),exports[a391_0x10390a(0x1ed)]=void 0x0;const veeva_constants_1=require(a391_0x10390a(0x1fd)),jszip_1=__importDefault(require(a391_0x10390a(0x1f1))),status_enums_1=require(a391_0x10390a(0x1f9)),veeva_error_1=require('../classes/errors/veeva-error');class PackageExportService{constructor({veevaService:_0x4d0da7,connection:_0x54fb5c,logger:_0x3d4628}){const _0x540dfd=a391_0x10390a;this[_0x540dfd(0x206)]=_0x4d0da7,this['_connection']=_0x54fb5c,this[_0x540dfd(0x22c)]=_0x3d4628;}async['createOutboundPackages'](_0x5b03fb,_0x37900b){const _0x277e10=a391_0x10390a;this[_0x277e10(0x22c)][_0x277e10(0x201)](_0x277e10(0x210));const _0x5e3033=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+'outbound_package__v',_0x393e2d=new Array(_0x5b03fb)[_0x277e10(0x1ff)]({'summary__v':_0x37900b,'object_type__v.api__name__v':'migration__sys'});return await this['_veevaService'][_0x277e10(0x20d)](_0x5e3033,_0x393e2d);}async['createPackageComponents'](_0x115610,_0x1a0ab2){const _0x168b9b=a391_0x10390a;this[_0x168b9b(0x22c)]['log'](_0x168b9b(0x221));const _0xd6ac05=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+_0x168b9b(0x1f7),_0x3f852f=_0x115610[_0x168b9b(0x1fe)]((_0x144b0b,_0x12d3c3)=>({'vault_component__v':_0x144b0b['id'],'outbound_package__v':_0x1a0ab2[Math[_0x168b9b(0x20c)]((_0x12d3c3+0x1)/veeva_constants_1[_0x168b9b(0x1f8)][_0x168b9b(0x229)])-0x1]}));return await this[_0x168b9b(0x206)][_0x168b9b(0x20d)](_0xd6ac05,_0x3f852f);}async[a391_0x10390a(0x217)](_0x5246dd){const _0x57c61b=a391_0x10390a;this[_0x57c61b(0x22c)][_0x57c61b(0x201)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x14170a=_0x57c61b(0x223)+_0x5246dd[_0x57c61b(0x1ef)](_0x57c61b(0x1f2))+'\x27)',_0x5c613c=await this[_0x57c61b(0x206)]['executeVQL'](_0x14170a);return _0x5c613c['reduce']((_0x4e23b4,_0x4ee1e2)=>_0x4e23b4[_0x57c61b(0x215)](_0x4ee1e2['id'],_0x4ee1e2[_0x57c61b(0x21e)]),new Map());}async[a391_0x10390a(0x21c)](_0x5487cb){const _0x5cc89d=a391_0x10390a;this['_logger'][_0x5cc89d(0x201)](_0x5cc89d(0x212));const _0x739939=[],_0x785475=_0x5487cb[_0x5cc89d(0x1fe)](_0x30be12=>{const _0x51f557=_0x5cc89d;return this[_0x51f557(0x202)][_0x51f557(0x209)](veeva_constants_1[_0x51f557(0x1f8)][_0x51f557(0x207)],encodeURI(_0x51f557(0x218))+'='+encodeURI(_0x30be12),{'headers':{'Content-Type':_0x51f557(0x21a)}});}),_0xbb48c2=await Promise[_0x5cc89d(0x1ea)](_0x785475);for(const {data:_0x316e7f}of _0xbb48c2){if(_0x316e7f['responseStatus']===status_enums_1[_0x5cc89d(0x1fa)][_0x5cc89d(0x216)]){const {url:_0xed1cd9}=_0x316e7f;_0x739939[_0x5cc89d(0x1f3)](_0xed1cd9);}else throw new veeva_error_1[(_0x5cc89d(0x22b))](_0x316e7f[_0x5cc89d(0x220)]);}return _0x739939;}async[a391_0x10390a(0x208)](_0x5cbabe){const _0x1e67d4=a391_0x10390a;this[_0x1e67d4(0x22c)][_0x1e67d4(0x201)](_0x1e67d4(0x22a));const _0x1c895b=[],_0x4d47a1=await this[_0x1e67d4(0x206)]['getJobResult'](_0x5cbabe);for(const _0x103a77 of _0x4d47a1){const _0x409e69=_0x103a77['links']['filter'](_0x11b1a2=>_0x11b1a2['rel']===_0x1e67d4(0x214))['map'](_0x5df9c5=>_0x5df9c5[_0x1e67d4(0x1e9)]);_0x1c895b[_0x1e67d4(0x1f3)](..._0x409e69);}return _0x1c895b;}async[a391_0x10390a(0x21b)](_0x22a282){const _0xf513f2=a391_0x10390a;var _0xd018ca;const _0x1a9790=[];this['_logger'][_0xf513f2(0x201)]('Retrieve\x20Outbound\x20Package\x20zip\x20list');for(const _0x3f58cd of _0x22a282){const {data:_0x390147,headers:_0x412fcd}=await this['_connection'][_0xf513f2(0x1f6)](_0x3f58cd,{'responseType':_0xf513f2(0x226)}),_0x3fd07a=(_0xd018ca=_0x412fcd[_0xf513f2(0x22d)])===null||_0xd018ca===void 0x0?void 0x0:_0xd018ca['includes'](_0xf513f2(0x203));if(!_0x3fd07a){const _0x1618ff=_0x390147,_0x2194e8=new jszip_1[(_0xf513f2(0x22e))]();await _0x2194e8[_0xf513f2(0x20a)](_0x1618ff),_0x1a9790[_0xf513f2(0x1f3)](_0x2194e8);}else{const _0x29d3b5=JSON['parse'](_0x390147);throw new veeva_error_1[(_0xf513f2(0x22b))](_0x29d3b5[_0xf513f2(0x220)]);}}return _0x1a9790;}async['deletePackageComponents'](_0x32a5d2){const _0x10b10f=a391_0x10390a;this[_0x10b10f(0x22c)][_0x10b10f(0x201)](_0x10b10f(0x20e));const _0x365c2c=veeva_constants_1['VeevaConstants'][_0x10b10f(0x21d)]+_0x10b10f(0x1f7);await this[_0x10b10f(0x206)][_0x10b10f(0x1eb)](_0x365c2c,_0x32a5d2);}async[a391_0x10390a(0x20b)](_0x475c8e){const _0x4904fe=a391_0x10390a;this['_logger'][_0x4904fe(0x201)](_0x4904fe(0x227));const _0x1f7046=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+_0x4904fe(0x21f);await this[_0x4904fe(0x206)][_0x4904fe(0x1eb)](_0x1f7046,_0x475c8e);}async['export'](_0x19a20d,_0x549988){const _0x46f42a=a391_0x10390a,_0x4588d6=await this[_0x46f42a(0x200)](Math[_0x46f42a(0x20c)](_0x19a20d[_0x46f42a(0x1e8)]/veeva_constants_1[_0x46f42a(0x1f8)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x549988),_0x16037d=await this[_0x46f42a(0x228)](_0x19a20d,_0x4588d6),_0x48ebf3=await this[_0x46f42a(0x217)](_0x4588d6),_0x318d93=await this[_0x46f42a(0x21c)](Array[_0x46f42a(0x1ee)](_0x48ebf3[_0x46f42a(0x22f)]())),_0x55eb75=await this[_0x46f42a(0x208)](_0x318d93),_0x13907a=await this[_0x46f42a(0x21b)](_0x55eb75);return await this[_0x46f42a(0x1f5)](_0x16037d),await this[_0x46f42a(0x20b)](_0x4588d6),_0x13907a;}}function a391_0x547c(_0x4ebd39,_0x62a822){const _0x40eac9=a391_0x5586();return a391_0x547c=function(_0x3150fc,_0x465a67){_0x3150fc=_0x3150fc-0x1e8;let _0x55863d=_0x40eac9[_0x3150fc];return _0x55863d;},a391_0x547c(_0x4ebd39,_0x62a822);}exports[a391_0x10390a(0x1ed)]=PackageExportService;