const a403_0x6f499a=a403_0x5314;(function(_0x266b6b,_0x2c756f){const _0x21551b=a403_0x5314,_0x8a3203=_0x266b6b();while(!![]){try{const _0x5dc407=-parseInt(_0x21551b(0x93))/0x1+-parseInt(_0x21551b(0x72))/0x2+-parseInt(_0x21551b(0x7b))/0x3*(parseInt(_0x21551b(0x9f))/0x4)+-parseInt(_0x21551b(0x6d))/0x5*(parseInt(_0x21551b(0x95))/0x6)+parseInt(_0x21551b(0x6e))/0x7+-parseInt(_0x21551b(0x85))/0x8+parseInt(_0x21551b(0x8c))/0x9;if(_0x5dc407===_0x2c756f)break;else _0x8a3203['push'](_0x8a3203['shift']());}catch(_0x35ce94){_0x8a3203['push'](_0x8a3203['shift']());}}}(a403_0x484f,0x264bd));const a403_0x17e69c=(function(){let _0x26476e=!![];return function(_0x73b5f4,_0xb477df){const _0x3eaef3=_0x26476e?function(){const _0x476c8c=a403_0x5314;if(_0xb477df){const _0x5b30a3=_0xb477df[_0x476c8c(0xad)](_0x73b5f4,arguments);return _0xb477df=null,_0x5b30a3;}}:function(){};return _0x26476e=![],_0x3eaef3;};}()),a403_0x11cb2b=a403_0x17e69c(this,function(){const _0x24e5d4=a403_0x5314;return a403_0x11cb2b[_0x24e5d4(0xa6)]()[_0x24e5d4(0xa2)](_0x24e5d4(0xb3))[_0x24e5d4(0xa6)]()[_0x24e5d4(0x97)](a403_0x11cb2b)['search']('(((.+)+)+)+$');});function a403_0x5314(_0x38a37f,_0x437e71){const _0x44abf5=a403_0x484f();return a403_0x5314=function(_0x11cb2b,_0x17e69c){_0x11cb2b=_0x11cb2b-0x6c;let _0x484ff6=_0x44abf5[_0x11cb2b];return _0x484ff6;},a403_0x5314(_0x38a37f,_0x437e71);}a403_0x11cb2b();function a403_0x484f(){const _0x5877cf=['retrieveVPKList','log','artifacts','VeevaError','PackageExportService','31949fVUSCt','Create\x20Export\x20outbound\x20packages.','42OkHgFC','MAXIMUM_SIZE_OF_PACKAGE','constructor','packageName','from','application/x-www-form-urlencoded','responseStatus','Adding\x20components\x20to\x20outbound\x20package','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','filter','602324BKlUHc','getPackageNames','../constants/veeva.constants','search','push','href','content-type','toString','errors','createVeevaObjectRecords','Deleting\x20outbound\x20packages.','_connection','package_component__v','fill','apply','ceil','_veevaService','jszip','Retrieve\x20Outbound\x20Package\x20zip\x20list','deleteVeevaObjectRecords','(((.+)+)+)+$','VeevaConstants','46115mLggsc','1695575YvdGvL','map','createOutboundPackages','_logger','38248txSqhR','ENDPOINT_CREATE_RECORDS','getEndpointArtifactList','post','createExportOutboundPackages','../enums/status.enums','VeevaResponseStatus','join','__esModule','3Ecntbr','set','loadAsync','deletePackageComponents','\x27,\x27','all','deleteOutboundPackages','migration__sys','getJobResult','default','1561736lMIpND','createPackageComponents','includes','Creating\x20outbound\x20packages','rel','../classes/errors/veeva-error','Getting\x20names\x20of\x20outbound\x20packages','3384612wLiKjP','links'];a403_0x484f=function(){return _0x5877cf;};return a403_0x484f();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0xc22829){const _0x1e3e81=a403_0x5314;return _0xc22829&&_0xc22829[_0x1e3e81(0x7a)]?_0xc22829:{'default':_0xc22829};};Object['defineProperty'](exports,a403_0x6f499a(0x7a),{'value':!![]}),exports[a403_0x6f499a(0x92)]=void 0x0;const veeva_constants_1=require(a403_0x6f499a(0xa1)),jszip_1=__importDefault(require(a403_0x6f499a(0xb0))),status_enums_1=require(a403_0x6f499a(0x77)),veeva_error_1=require(a403_0x6f499a(0x8a));class PackageExportService{constructor({veevaService:_0xbc7b6b,connection:_0x4e8623,logger:_0x5e3bdd}){const _0x2f2f1e=a403_0x6f499a;this[_0x2f2f1e(0xaf)]=_0xbc7b6b,this[_0x2f2f1e(0xaa)]=_0x4e8623,this['_logger']=_0x5e3bdd;}async[a403_0x6f499a(0x70)](_0x276f87,_0x22729c){const _0x189612=a403_0x6f499a;this[_0x189612(0x71)][_0x189612(0x8f)](_0x189612(0x88));const _0x39c300=veeva_constants_1['VeevaConstants'][_0x189612(0x73)]+'outbound_package__v',_0x230fc2=new Array(_0x276f87)[_0x189612(0xac)]({'summary__v':_0x22729c,'object_type__v.api__name__v':_0x189612(0x82)});return await this[_0x189612(0xaf)][_0x189612(0xa8)](_0x39c300,_0x230fc2);}async['createPackageComponents'](_0x365936,_0x46f1a4){const _0xb6fef5=a403_0x6f499a;this[_0xb6fef5(0x71)][_0xb6fef5(0x8f)](_0xb6fef5(0x9c));const _0x3c17ee=veeva_constants_1[_0xb6fef5(0x6c)][_0xb6fef5(0x73)]+_0xb6fef5(0xab),_0x4286b4=_0x365936['map']((_0x53bfbc,_0x2513cc)=>({'vault_component__v':_0x53bfbc['id'],'outbound_package__v':_0x46f1a4[Math[_0xb6fef5(0xae)]((_0x2513cc+0x1)/veeva_constants_1[_0xb6fef5(0x6c)][_0xb6fef5(0x96)])-0x1]}));return await this[_0xb6fef5(0xaf)]['createVeevaObjectRecords'](_0x3c17ee,_0x4286b4);}async[a403_0x6f499a(0xa0)](_0x3a3285){const _0x1a17b5=a403_0x6f499a;this[_0x1a17b5(0x71)][_0x1a17b5(0x8f)](_0x1a17b5(0x8b));const _0x392e63=_0x1a17b5(0x9d)+_0x3a3285[_0x1a17b5(0x79)](_0x1a17b5(0x7f))+'\x27)',_0x7e1647=await this[_0x1a17b5(0xaf)]['executeVQL'](_0x392e63);return _0x7e1647['reduce']((_0x49ce5c,_0x13f178)=>_0x49ce5c[_0x1a17b5(0x7c)](_0x13f178['id'],_0x13f178['name__v']),new Map());}async[a403_0x6f499a(0x76)](_0x2ba97f){const _0x4a8ba0=a403_0x6f499a;this[_0x4a8ba0(0x71)]['log'](_0x4a8ba0(0x94));const _0x37bb95=[],_0xa86ca4=_0x2ba97f[_0x4a8ba0(0x6f)](_0x2b6d27=>{const _0x468d71=_0x4a8ba0;return this[_0x468d71(0xaa)][_0x468d71(0x75)](veeva_constants_1[_0x468d71(0x6c)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],encodeURI(_0x468d71(0x98))+'='+encodeURI(_0x2b6d27),{'headers':{'Content-Type':_0x468d71(0x9a)}});}),_0x40fe34=await Promise[_0x4a8ba0(0x80)](_0xa86ca4);for(const {data:_0x11191c}of _0x40fe34){if(_0x11191c[_0x4a8ba0(0x9b)]===status_enums_1[_0x4a8ba0(0x78)]['SUCCESS']){const {url:_0x126589}=_0x11191c;_0x37bb95[_0x4a8ba0(0xa3)](_0x126589);}else throw new veeva_error_1[(_0x4a8ba0(0x91))](_0x11191c[_0x4a8ba0(0xa7)]);}return _0x37bb95;}async[a403_0x6f499a(0x74)](_0x33650d){const _0x16ce83=a403_0x6f499a;this['_logger'][_0x16ce83(0x8f)]('Retrieve\x20Jobs\x20Status');const _0x4822ab=[],_0x4ea7a4=await this[_0x16ce83(0xaf)][_0x16ce83(0x83)](_0x33650d);for(const _0x154545 of _0x4ea7a4){const _0x407b49=_0x154545[_0x16ce83(0x8d)][_0x16ce83(0x9e)](_0x1cf5ae=>_0x1cf5ae[_0x16ce83(0x89)]===_0x16ce83(0x90))[_0x16ce83(0x6f)](_0x516aef=>_0x516aef[_0x16ce83(0xa4)]);_0x4822ab['push'](..._0x407b49);}return _0x4822ab;}async[a403_0x6f499a(0x8e)](_0x15616c){const _0x46d803=a403_0x6f499a;var _0x73b3e3;const _0x9af347=[];this[_0x46d803(0x71)][_0x46d803(0x8f)](_0x46d803(0xb1));for(const _0x265a03 of _0x15616c){const {data:_0x8f3fed,headers:_0x3b6d72}=await this[_0x46d803(0xaa)]['get'](_0x265a03,{'responseType':'arraybuffer'}),_0x3aaca8=(_0x73b3e3=_0x3b6d72[_0x46d803(0xa5)])===null||_0x73b3e3===void 0x0?void 0x0:_0x73b3e3[_0x46d803(0x87)]('application/json');if(!_0x3aaca8){const _0x573c67=_0x8f3fed,_0x28f2a3=new jszip_1[(_0x46d803(0x84))]();await _0x28f2a3[_0x46d803(0x7d)](_0x573c67),_0x9af347['push'](_0x28f2a3);}else{const _0x324b6f=JSON['parse'](_0x8f3fed);throw new veeva_error_1['VeevaError'](_0x324b6f['errors']);}}return _0x9af347;}async[a403_0x6f499a(0x7e)](_0x1ea223){const _0x1942db=a403_0x6f499a;this['_logger'][_0x1942db(0x8f)]('Removing\x20components\x20from\x20outbound\x20packages.');const _0x49616d=veeva_constants_1[_0x1942db(0x6c)][_0x1942db(0x73)]+_0x1942db(0xab);await this[_0x1942db(0xaf)][_0x1942db(0xb2)](_0x49616d,_0x1ea223);}async[a403_0x6f499a(0x81)](_0x1efe42){const _0x566a09=a403_0x6f499a;this[_0x566a09(0x71)][_0x566a09(0x8f)](_0x566a09(0xa9));const _0x278b03=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+'outbound_package__v';await this['_veevaService'][_0x566a09(0xb2)](_0x278b03,_0x1efe42);}async['export'](_0x5ca595,_0x18ebe2){const _0x3f837d=a403_0x6f499a,_0x146103=await this[_0x3f837d(0x70)](Math[_0x3f837d(0xae)](_0x5ca595['length']/veeva_constants_1['VeevaConstants'][_0x3f837d(0x96)]),_0x18ebe2),_0x57a5e9=await this[_0x3f837d(0x86)](_0x5ca595,_0x146103),_0x5dfcbc=await this['getPackageNames'](_0x146103),_0x271fb6=await this[_0x3f837d(0x76)](Array[_0x3f837d(0x99)](_0x5dfcbc['values']())),_0x13cabf=await this[_0x3f837d(0x74)](_0x271fb6),_0x2ac12a=await this['retrieveVPKList'](_0x13cabf);return await this[_0x3f837d(0x7e)](_0x57a5e9),await this['deleteOutboundPackages'](_0x146103),_0x2ac12a;}}exports[a403_0x6f499a(0x92)]=PackageExportService;