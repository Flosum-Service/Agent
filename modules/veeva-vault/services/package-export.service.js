const a359_0x27db23=a359_0x3198;(function(_0x299f7d,_0x3ac292){const _0x1f0b3a=a359_0x3198,_0x35387b=_0x299f7d();while(!![]){try{const _0x4d80d8=-parseInt(_0x1f0b3a(0x196))/0x1*(parseInt(_0x1f0b3a(0x1a7))/0x2)+-parseInt(_0x1f0b3a(0x1b9))/0x3*(-parseInt(_0x1f0b3a(0x1b1))/0x4)+-parseInt(_0x1f0b3a(0x18e))/0x5+parseInt(_0x1f0b3a(0x19b))/0x6+-parseInt(_0x1f0b3a(0x1b5))/0x7+-parseInt(_0x1f0b3a(0x1b6))/0x8+parseInt(_0x1f0b3a(0x1b7))/0x9;if(_0x4d80d8===_0x3ac292)break;else _0x35387b['push'](_0x35387b['shift']());}catch(_0x5ca04a){_0x35387b['push'](_0x35387b['shift']());}}}(a359_0x1792,0xe9967));const a359_0x30a9dd=(function(){let _0x135a36=!![];return function(_0x2dd4e7,_0x471461){const _0x185c72=_0x135a36?function(){const _0x2f225a=a359_0x3198;if(_0x471461){const _0x4eeeb5=_0x471461[_0x2f225a(0x1a4)](_0x2dd4e7,arguments);return _0x471461=null,_0x4eeeb5;}}:function(){};return _0x135a36=![],_0x185c72;};}()),a359_0x5072bf=a359_0x30a9dd(this,function(){const _0x250cdb=a359_0x3198;return a359_0x5072bf[_0x250cdb(0x1c3)]()[_0x250cdb(0x1c7)](_0x250cdb(0x1bc))[_0x250cdb(0x1c3)]()[_0x250cdb(0x184)](a359_0x5072bf)[_0x250cdb(0x1c7)](_0x250cdb(0x1bc));});a359_0x5072bf();'use strict';var __importDefault=this&&this[a359_0x27db23(0x1aa)]||function(_0x723901){const _0xc9f7fe=a359_0x27db23;return _0x723901&&_0x723901[_0xc9f7fe(0x19c)]?_0x723901:{'default':_0x723901};};Object[a359_0x27db23(0x187)](exports,'__esModule',{'value':!![]}),exports[a359_0x27db23(0x1a3)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require(a359_0x27db23(0x18f))),status_enums_1=require('../enums/status.enums'),veeva_error_1=require('../classes/errors/veeva-error');function a359_0x3198(_0x1f76dc,_0x14dfa8){const _0x20ccbb=a359_0x1792();return a359_0x3198=function(_0x5072bf,_0x30a9dd){_0x5072bf=_0x5072bf-0x182;let _0x1792ee=_0x20ccbb[_0x5072bf];return _0x1792ee;},a359_0x3198(_0x1f76dc,_0x14dfa8);}class PackageExportService{constructor({veevaService:_0x269584,connection:_0xc0c89e,logger:_0x351701}){const _0x235cff=a359_0x27db23;this[_0x235cff(0x193)]=_0x269584,this[_0x235cff(0x182)]=_0xc0c89e,this['_logger']=_0x351701;}async[a359_0x27db23(0x18c)](_0x29ec1c,_0x198906){const _0x19f236=a359_0x27db23;this[_0x19f236(0x19e)][_0x19f236(0x1a1)](_0x19f236(0x1c0));const _0x15140d=veeva_constants_1[_0x19f236(0x1a2)][_0x19f236(0x1c9)]+_0x19f236(0x1b3),_0x111384=new Array(_0x29ec1c)[_0x19f236(0x1ac)]({'summary__v':_0x198906,'object_type__v.api__name__v':_0x19f236(0x185)});return await this['_veevaService'][_0x19f236(0x1b0)](_0x15140d,_0x111384);}async[a359_0x27db23(0x190)](_0x1995c4,_0x2a9d1c){const _0x5afc89=a359_0x27db23;this[_0x5afc89(0x19e)]['log'](_0x5afc89(0x18b));const _0x4414b9=veeva_constants_1[_0x5afc89(0x1a2)][_0x5afc89(0x1c9)]+_0x5afc89(0x1ba),_0x124203=_0x1995c4[_0x5afc89(0x183)]((_0x44403a,_0x56466)=>({'vault_component__v':_0x44403a['id'],'outbound_package__v':_0x2a9d1c[Math['ceil']((_0x56466+0x1)/veeva_constants_1[_0x5afc89(0x1a2)][_0x5afc89(0x1a5)])-0x1]}));return await this[_0x5afc89(0x193)]['createVeevaObjectRecords'](_0x4414b9,_0x124203);}async[a359_0x27db23(0x1c6)](_0x138e32){const _0x337792=a359_0x27db23;this['_logger']['log']('Getting\x20names\x20of\x20outbound\x20packages');const _0x4efeb8=_0x337792(0x1c2)+_0x138e32[_0x337792(0x188)](_0x337792(0x1c4))+'\x27)',_0x5f2509=veeva_constants_1[_0x337792(0x1a2)]['ENDPOINT_VQL']+_0x4efeb8,_0x5528c4=await this[_0x337792(0x193)]['executeVQL'](_0x5f2509);return _0x5528c4[_0x337792(0x1ab)]((_0x1660ee,_0x120b5b)=>_0x1660ee[_0x337792(0x186)](_0x120b5b['id'],_0x120b5b['name__v']),new Map());}async[a359_0x27db23(0x1bf)](_0x24c90a){const _0x545e8d=a359_0x27db23;this[_0x545e8d(0x19e)][_0x545e8d(0x1a1)](_0x545e8d(0x1b4));const _0x540c70=[],_0x8adbdb=_0x24c90a[_0x545e8d(0x183)](_0x54e50b=>{const _0x54dbd7=_0x545e8d;return this[_0x54dbd7(0x182)]['post'](veeva_constants_1[_0x54dbd7(0x1a2)][_0x54dbd7(0x191)],encodeURI('packageName')+'='+encodeURI(_0x54e50b),{'headers':{'Content-Type':_0x54dbd7(0x1b2)}});}),_0x52efa7=await Promise[_0x545e8d(0x19a)](_0x8adbdb);for(const {data:_0x3f27b7}of _0x52efa7){if(_0x3f27b7[_0x545e8d(0x1a0)]===status_enums_1[_0x545e8d(0x19f)]['SUCCESS']){const {url:_0x1395d0}=_0x3f27b7;_0x540c70[_0x545e8d(0x1ae)](_0x1395d0);}else throw new veeva_error_1[(_0x545e8d(0x194))](_0x3f27b7[_0x545e8d(0x19d)]);}return _0x540c70;}async['getEndpointArtifactList'](_0x591890){const _0xac01df=a359_0x27db23;this[_0xac01df(0x19e)][_0xac01df(0x1a1)]('Retrieve\x20Jobs\x20Status');const _0xefc94b=[],_0x9ba21c=await this[_0xac01df(0x193)]['getJobResult'](_0x591890);for(const _0x938086 of _0x9ba21c){const _0x10eba1=_0x938086[_0xac01df(0x1c1)][_0xac01df(0x1bd)](_0x469572=>_0x469572[_0xac01df(0x18a)]==='artifacts')[_0xac01df(0x183)](_0x1c578c=>_0x1c578c[_0xac01df(0x1b8)]);_0xefc94b[_0xac01df(0x1ae)](..._0x10eba1);}return _0xefc94b;}async['retrieveVPKList'](_0x31730e){const _0x1c8e84=a359_0x27db23;var _0x15ff98;const _0x3feea7=[];this['_logger'][_0x1c8e84(0x1a1)](_0x1c8e84(0x1a8));for(const _0xab90c6 of _0x31730e){const {data:_0x3e32cd,headers:_0x280975}=await this[_0x1c8e84(0x182)][_0x1c8e84(0x1c5)](_0xab90c6,{'responseType':'arraybuffer'}),_0x48690b=(_0x15ff98=_0x280975[_0x1c8e84(0x189)])===null||_0x15ff98===void 0x0?void 0x0:_0x15ff98[_0x1c8e84(0x1af)]('application/json');if(!_0x48690b){const _0x1a8ef1=_0x3e32cd,_0xd45439=new jszip_1['default']();await _0xd45439[_0x1c8e84(0x1a9)](_0x1a8ef1),_0x3feea7[_0x1c8e84(0x1ae)](_0xd45439);}else{const _0x701b48=JSON[_0x1c8e84(0x1bb)](_0x3e32cd);throw new veeva_error_1[(_0x1c8e84(0x194))](_0x701b48['errors']);}}return _0x3feea7;}async[a359_0x27db23(0x1ad)](_0x5b2b63){const _0x2b90db=a359_0x27db23;this[_0x2b90db(0x19e)]['log'](_0x2b90db(0x1be));const _0x3f95d0=veeva_constants_1[_0x2b90db(0x1a2)][_0x2b90db(0x1c9)]+_0x2b90db(0x1ba);await this[_0x2b90db(0x193)][_0x2b90db(0x199)](_0x3f95d0,_0x5b2b63);}async['deleteOutboundPackages'](_0xa5a8d9){const _0x960c03=a359_0x27db23;this['_logger'][_0x960c03(0x1a1)](_0x960c03(0x198));const _0x443c0d=veeva_constants_1[_0x960c03(0x1a2)][_0x960c03(0x1c9)]+_0x960c03(0x1b3);await this[_0x960c03(0x193)][_0x960c03(0x199)](_0x443c0d,_0xa5a8d9);}async[a359_0x27db23(0x192)](_0x70dcc5,_0x25a44a){const _0x44202e=a359_0x27db23,_0xa61bbd=await this[_0x44202e(0x18c)](Math[_0x44202e(0x18d)](_0x70dcc5[_0x44202e(0x197)]/veeva_constants_1[_0x44202e(0x1a2)][_0x44202e(0x1a5)]),_0x25a44a),_0xa0f0f0=await this['createPackageComponents'](_0x70dcc5,_0xa61bbd),_0x3f6cfd=await this[_0x44202e(0x1c6)](_0xa61bbd),_0x2e2c09=await this[_0x44202e(0x1bf)](Array[_0x44202e(0x1a6)](_0x3f6cfd[_0x44202e(0x1c8)]())),_0x4f0e13=await this['getEndpointArtifactList'](_0x2e2c09),_0x366622=await this['retrieveVPKList'](_0x4f0e13);return await this['deletePackageComponents'](_0xa0f0f0),await this[_0x44202e(0x195)](_0xa61bbd),_0x366622;}}exports[a359_0x27db23(0x1a3)]=PackageExportService;function a359_0x1792(){const _0x2b4d49=['apply','MAXIMUM_SIZE_OF_PACKAGE','from','601452YPHuPm','Retrieve\x20Outbound\x20Package\x20zip\x20list','loadAsync','__importDefault','reduce','fill','deletePackageComponents','push','includes','createVeevaObjectRecords','4rJPfhw','application/x-www-form-urlencoded','outbound_package__v','Create\x20Export\x20outbound\x20packages.','9582790oPiMMB','10459584ROmCxv','33284763VDJJDJ','href','4155681RnZAWh','package_component__v','parse','(((.+)+)+)+$','filter','Removing\x20components\x20from\x20outbound\x20packages.','createExportOutboundPackages','Creating\x20outbound\x20packages','links','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','toString','\x27,\x27','get','getPackageNames','search','values','ENDPOINT_CREATE_RECORDS','_connection','map','constructor','migration__sys','set','defineProperty','join','content-type','rel','Adding\x20components\x20to\x20outbound\x20package','createOutboundPackages','ceil','4044905USzWSy','jszip','createPackageComponents','ENDPOINT_EXPORT_IMPORT_PACKAGE','export','_veevaService','VeevaError','deleteOutboundPackages','5wHDGGg','length','Deleting\x20outbound\x20packages.','deleteVeevaObjectRecords','all','5173620CnUKPs','__esModule','errors','_logger','VeevaResponseStatus','responseStatus','log','VeevaConstants','PackageExportService'];a359_0x1792=function(){return _0x2b4d49;};return a359_0x1792();}