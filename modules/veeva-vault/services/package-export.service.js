const a390_0x365f6d=a390_0x3935;(function(_0x10e44c,_0x118b11){const _0xdd6799=a390_0x3935,_0x1809e3=_0x10e44c();while(!![]){try{const _0x4abb21=-parseInt(_0xdd6799(0x1f3))/0x1+parseInt(_0xdd6799(0x1d8))/0x2+-parseInt(_0xdd6799(0x1c5))/0x3*(-parseInt(_0xdd6799(0x1bb))/0x4)+-parseInt(_0xdd6799(0x1f0))/0x5+-parseInt(_0xdd6799(0x1de))/0x6+parseInt(_0xdd6799(0x1ad))/0x7+-parseInt(_0xdd6799(0x1bf))/0x8*(-parseInt(_0xdd6799(0x1e0))/0x9);if(_0x4abb21===_0x118b11)break;else _0x1809e3['push'](_0x1809e3['shift']());}catch(_0x43d140){_0x1809e3['push'](_0x1809e3['shift']());}}}(a390_0x2549,0xe73c4));const a390_0x143432=(function(){let _0x3ab986=!![];return function(_0x152a88,_0x374b98){const _0x23021c=_0x3ab986?function(){const _0x2e9ad3=a390_0x3935;if(_0x374b98){const _0x542029=_0x374b98[_0x2e9ad3(0x1ac)](_0x152a88,arguments);return _0x374b98=null,_0x542029;}}:function(){};return _0x3ab986=![],_0x23021c;};}()),a390_0x4a91d3=a390_0x143432(this,function(){const _0x26ddbb=a390_0x3935;return a390_0x4a91d3['toString']()['search'](_0x26ddbb(0x1ae))[_0x26ddbb(0x1ba)]()[_0x26ddbb(0x1f1)](a390_0x4a91d3)[_0x26ddbb(0x1ab)]('(((.+)+)+)+$');});a390_0x4a91d3();'use strict';function a390_0x2549(){const _0x55484f=['deletePackageComponents','MAXIMUM_SIZE_OF_PACKAGE','1121496JPjYXO','parse','__importDefault','../enums/status.enums','log','packageName','application/json','createOutboundPackages','getJobResult','retrieveVPKList','application/x-www-form-urlencoded','ceil','Getting\x20names\x20of\x20outbound\x20packages','../constants/veeva.constants','ENDPOINT_CREATE_RECORDS','errors','Creating\x20outbound\x20packages','all','href','3676176KXiTfq','join','includes','__esModule','package_component__v','set','11292564qTMWBt','export','9yruREX','length','default','name__v','createPackageComponents','PackageExportService','getPackageNames','push','VeevaConstants','deleteVeevaObjectRecords','map','deleteOutboundPackages','VeevaError','_veevaService','getEndpointArtifactList','fill','7910170FFgGkz','constructor','Retrieve\x20Jobs\x20Status','1208744yllqco','from','_connection','outbound_package__v','search','apply','12429151VNPKZK','(((.+)+)+)+$','artifacts','../classes/errors/veeva-error','migration__sys','loadAsync','createExportOutboundPackages','jszip','createVeevaObjectRecords','responseStatus','Adding\x20components\x20to\x20outbound\x20package','_logger','Removing\x20components\x20from\x20outbound\x20packages.','toString','8rlHVUG','Deleting\x20outbound\x20packages.','content-type','arraybuffer','10069336JDDBRQ','reduce','Retrieve\x20Outbound\x20Package\x20zip\x20list','values'];a390_0x2549=function(){return _0x55484f;};return a390_0x2549();}var __importDefault=this&&this[a390_0x365f6d(0x1c7)]||function(_0x1ed780){const _0x14d26e=a390_0x365f6d;return _0x1ed780&&_0x1ed780[_0x14d26e(0x1db)]?_0x1ed780:{'default':_0x1ed780};};Object['defineProperty'](exports,a390_0x365f6d(0x1db),{'value':!![]}),exports['PackageExportService']=void 0x0;const veeva_constants_1=require(a390_0x365f6d(0x1d2)),jszip_1=__importDefault(require(a390_0x365f6d(0x1b4))),status_enums_1=require(a390_0x365f6d(0x1c8)),veeva_error_1=require(a390_0x365f6d(0x1b0));function a390_0x3935(_0x5abe09,_0x5cbb1c){const _0x5c264c=a390_0x2549();return a390_0x3935=function(_0x4a91d3,_0x143432){_0x4a91d3=_0x4a91d3-0x1ab;let _0x254909=_0x5c264c[_0x4a91d3];return _0x254909;},a390_0x3935(_0x5abe09,_0x5cbb1c);}class PackageExportService{constructor({veevaService:_0x2352de,connection:_0x2a9549,logger:_0x1fb0b4}){const _0x5b2e2d=a390_0x365f6d;this[_0x5b2e2d(0x1ed)]=_0x2352de,this[_0x5b2e2d(0x1f5)]=_0x2a9549,this['_logger']=_0x1fb0b4;}async['createOutboundPackages'](_0x1043dd,_0x308a7b){const _0x2ac553=a390_0x365f6d;this[_0x2ac553(0x1b8)]['log'](_0x2ac553(0x1d5));const _0x1052b4=veeva_constants_1[_0x2ac553(0x1e8)][_0x2ac553(0x1d3)]+_0x2ac553(0x1f6),_0x1894fd=new Array(_0x1043dd)[_0x2ac553(0x1ef)]({'summary__v':_0x308a7b,'object_type__v.api__name__v':_0x2ac553(0x1b1)});return await this['_veevaService'][_0x2ac553(0x1b5)](_0x1052b4,_0x1894fd);}async[a390_0x365f6d(0x1e4)](_0x742f07,_0x59dbb4){const _0x114d6a=a390_0x365f6d;this[_0x114d6a(0x1b8)][_0x114d6a(0x1c9)](_0x114d6a(0x1b7));const _0x9040a5=veeva_constants_1[_0x114d6a(0x1e8)][_0x114d6a(0x1d3)]+_0x114d6a(0x1dc),_0x17df14=_0x742f07[_0x114d6a(0x1ea)]((_0x564531,_0x475e0f)=>({'vault_component__v':_0x564531['id'],'outbound_package__v':_0x59dbb4[Math[_0x114d6a(0x1d0)]((_0x475e0f+0x1)/veeva_constants_1[_0x114d6a(0x1e8)][_0x114d6a(0x1c4)])-0x1]}));return await this['_veevaService']['createVeevaObjectRecords'](_0x9040a5,_0x17df14);}async[a390_0x365f6d(0x1e6)](_0xe8a25e){const _0x4d61bb=a390_0x365f6d;this[_0x4d61bb(0x1b8)]['log'](_0x4d61bb(0x1d1));const _0x39c655='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0xe8a25e[_0x4d61bb(0x1d9)]('\x27,\x27')+'\x27)',_0x2b1932=await this[_0x4d61bb(0x1ed)]['executeVQL'](_0x39c655);return _0x2b1932[_0x4d61bb(0x1c0)]((_0x295c66,_0x53810b)=>_0x295c66[_0x4d61bb(0x1dd)](_0x53810b['id'],_0x53810b[_0x4d61bb(0x1e3)]),new Map());}async['createExportOutboundPackages'](_0x141501){const _0x7ab576=a390_0x365f6d;this[_0x7ab576(0x1b8)][_0x7ab576(0x1c9)]('Create\x20Export\x20outbound\x20packages.');const _0x1c023d=[],_0x15c2be=_0x141501['map'](_0xd4c14c=>{const _0x3a2c29=_0x7ab576;return this[_0x3a2c29(0x1f5)]['post'](veeva_constants_1[_0x3a2c29(0x1e8)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],encodeURI(_0x3a2c29(0x1ca))+'='+encodeURI(_0xd4c14c),{'headers':{'Content-Type':_0x3a2c29(0x1cf)}});}),_0xb427d7=await Promise[_0x7ab576(0x1d6)](_0x15c2be);for(const {data:_0x169fc7}of _0xb427d7){if(_0x169fc7[_0x7ab576(0x1b6)]===status_enums_1['VeevaResponseStatus']['SUCCESS']){const {url:_0x3d3483}=_0x169fc7;_0x1c023d[_0x7ab576(0x1e7)](_0x3d3483);}else throw new veeva_error_1['VeevaError'](_0x169fc7[_0x7ab576(0x1d4)]);}return _0x1c023d;}async[a390_0x365f6d(0x1ee)](_0x4c1d02){const _0x4fc9f3=a390_0x365f6d;this[_0x4fc9f3(0x1b8)][_0x4fc9f3(0x1c9)](_0x4fc9f3(0x1f2));const _0x40a388=[],_0x372d76=await this[_0x4fc9f3(0x1ed)][_0x4fc9f3(0x1cd)](_0x4c1d02);for(const _0x316f8c of _0x372d76){const _0xdc2cd1=_0x316f8c['links']['filter'](_0x3b58f4=>_0x3b58f4['rel']===_0x4fc9f3(0x1af))[_0x4fc9f3(0x1ea)](_0x121640=>_0x121640[_0x4fc9f3(0x1d7)]);_0x40a388[_0x4fc9f3(0x1e7)](..._0xdc2cd1);}return _0x40a388;}async['retrieveVPKList'](_0x1081b1){const _0x17ca5c=a390_0x365f6d;var _0x1fe8fc;const _0x57e9ed=[];this[_0x17ca5c(0x1b8)][_0x17ca5c(0x1c9)](_0x17ca5c(0x1c1));for(const _0x191e9e of _0x1081b1){const {data:_0x5a34da,headers:_0x497690}=await this['_connection']['get'](_0x191e9e,{'responseType':_0x17ca5c(0x1be)}),_0x31b494=(_0x1fe8fc=_0x497690[_0x17ca5c(0x1bd)])===null||_0x1fe8fc===void 0x0?void 0x0:_0x1fe8fc[_0x17ca5c(0x1da)](_0x17ca5c(0x1cb));if(!_0x31b494){const _0x4569e9=_0x5a34da,_0x3c5dd1=new jszip_1[(_0x17ca5c(0x1e2))]();await _0x3c5dd1[_0x17ca5c(0x1b2)](_0x4569e9),_0x57e9ed[_0x17ca5c(0x1e7)](_0x3c5dd1);}else{const _0x4aeb6a=JSON[_0x17ca5c(0x1c6)](_0x5a34da);throw new veeva_error_1[(_0x17ca5c(0x1ec))](_0x4aeb6a[_0x17ca5c(0x1d4)]);}}return _0x57e9ed;}async['deletePackageComponents'](_0x509778){const _0x5b99a0=a390_0x365f6d;this[_0x5b99a0(0x1b8)][_0x5b99a0(0x1c9)](_0x5b99a0(0x1b9));const _0x1fa945=veeva_constants_1['VeevaConstants'][_0x5b99a0(0x1d3)]+_0x5b99a0(0x1dc);await this[_0x5b99a0(0x1ed)][_0x5b99a0(0x1e9)](_0x1fa945,_0x509778);}async[a390_0x365f6d(0x1eb)](_0x5c88f9){const _0x57cc8b=a390_0x365f6d;this[_0x57cc8b(0x1b8)][_0x57cc8b(0x1c9)](_0x57cc8b(0x1bc));const _0x37301d=veeva_constants_1['VeevaConstants'][_0x57cc8b(0x1d3)]+_0x57cc8b(0x1f6);await this[_0x57cc8b(0x1ed)][_0x57cc8b(0x1e9)](_0x37301d,_0x5c88f9);}async[a390_0x365f6d(0x1df)](_0x4a052b,_0x40a810){const _0x43e25d=a390_0x365f6d,_0x17d050=await this[_0x43e25d(0x1cc)](Math[_0x43e25d(0x1d0)](_0x4a052b[_0x43e25d(0x1e1)]/veeva_constants_1['VeevaConstants'][_0x43e25d(0x1c4)]),_0x40a810),_0x473b6f=await this[_0x43e25d(0x1e4)](_0x4a052b,_0x17d050),_0x20c999=await this['getPackageNames'](_0x17d050),_0x54d235=await this[_0x43e25d(0x1b3)](Array[_0x43e25d(0x1f4)](_0x20c999[_0x43e25d(0x1c2)]())),_0x3594dc=await this['getEndpointArtifactList'](_0x54d235),_0x4fde1f=await this[_0x43e25d(0x1ce)](_0x3594dc);return await this[_0x43e25d(0x1c3)](_0x473b6f),await this[_0x43e25d(0x1eb)](_0x17d050),_0x4fde1f;}}exports[a390_0x365f6d(0x1e5)]=PackageExportService;