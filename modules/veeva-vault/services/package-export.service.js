const a374_0x25d8e3=a374_0x5c37;(function(_0x15bfe9,_0x2677ed){const _0x691351=a374_0x5c37,_0xf1edb9=_0x15bfe9();while(!![]){try{const _0x251b13=parseInt(_0x691351(0xbc))/0x1+parseInt(_0x691351(0xad))/0x2*(-parseInt(_0x691351(0xcd))/0x3)+-parseInt(_0x691351(0xaf))/0x4+parseInt(_0x691351(0xc4))/0x5+parseInt(_0x691351(0x97))/0x6*(parseInt(_0x691351(0xb0))/0x7)+-parseInt(_0x691351(0xc7))/0x8*(-parseInt(_0x691351(0xba))/0x9)+-parseInt(_0x691351(0x95))/0xa;if(_0x251b13===_0x2677ed)break;else _0xf1edb9['push'](_0xf1edb9['shift']());}catch(_0x53d815){_0xf1edb9['push'](_0xf1edb9['shift']());}}}(a374_0x3a90,0xdbdfc));const a374_0x2419b6=(function(){let _0x2cd419=!![];return function(_0x197933,_0x510fcd){const _0x15a001=_0x2cd419?function(){const _0x5c470b=a374_0x5c37;if(_0x510fcd){const _0x43d6af=_0x510fcd[_0x5c470b(0xc0)](_0x197933,arguments);return _0x510fcd=null,_0x43d6af;}}:function(){};return _0x2cd419=![],_0x15a001;};}()),a374_0x1e4e74=a374_0x2419b6(this,function(){const _0x2587ed=a374_0x5c37;return a374_0x1e4e74[_0x2587ed(0x8f)]()[_0x2587ed(0x9c)](_0x2587ed(0xd1))['toString']()[_0x2587ed(0xab)](a374_0x1e4e74)[_0x2587ed(0x9c)](_0x2587ed(0xd1));});a374_0x1e4e74();'use strict';var __importDefault=this&&this[a374_0x25d8e3(0xc2)]||function(_0x501600){const _0x2b8031=a374_0x25d8e3;return _0x501600&&_0x501600[_0x2b8031(0x8b)]?_0x501600:{'default':_0x501600};};function a374_0x5c37(_0x53f4c0,_0x6e5b02){const _0x11cdfc=a374_0x3a90();return a374_0x5c37=function(_0x1e4e74,_0x2419b6){_0x1e4e74=_0x1e4e74-0x88;let _0x3a9009=_0x11cdfc[_0x1e4e74];return _0x3a9009;},a374_0x5c37(_0x53f4c0,_0x6e5b02);}function a374_0x3a90(){const _0x24ce11=['jszip','4121838rpucCu','all','filter','VeevaResponseStatus','deletePackageComponents','search','rel','MAXIMUM_SIZE_OF_PACKAGE','../classes/errors/veeva-error','name__v','map','application/json','length','retrieveVPKList','ENDPOINT_EXPORT_IMPORT_PACKAGE','getJobResult','../constants/veeva.constants','createPackageComponents','deleteVeevaObjectRecords','PackageExportService','constructor','getEndpointArtifactList','92266rvXXpz','ENDPOINT_CREATE_RECORDS','5260724VwJFrh','7bGVUvM','createVeevaObjectRecords','outbound_package__v','getPackageNames','arraybuffer','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','../enums/status.enums','fill','content-type','_veevaService','18XYQcwU','Adding\x20components\x20to\x20outbound\x20package','1772473eoTAau','\x27,\x27','_logger','includes','apply','deleteOutboundPackages','__importDefault','_connection','5384735RRXfbu','parse','href','2155960zcHrSu','application/x-www-form-urlencoded','executeVQL','Retrieve\x20Outbound\x20Package\x20zip\x20list','VeevaConstants','Creating\x20outbound\x20packages','93RnhXJQ','SUCCESS','loadAsync','Create\x20Export\x20outbound\x20packages.','(((.+)+)+)+$','Getting\x20names\x20of\x20outbound\x20packages','from','package_component__v','__esModule','log','VeevaError','Removing\x20components\x20from\x20outbound\x20packages.','toString','export','ceil','push','createOutboundPackages','errors','4294750EPARED'];a374_0x3a90=function(){return _0x24ce11;};return a374_0x3a90();}Object['defineProperty'](exports,a374_0x25d8e3(0x8b),{'value':!![]}),exports[a374_0x25d8e3(0xaa)]=void 0x0;const veeva_constants_1=require(a374_0x25d8e3(0xa7)),jszip_1=__importDefault(require(a374_0x25d8e3(0x96))),status_enums_1=require(a374_0x25d8e3(0xb6)),veeva_error_1=require(a374_0x25d8e3(0x9f));class PackageExportService{constructor({veevaService:_0x11af8e,connection:_0x345d05,logger:_0xe2698c}){const _0x4345b5=a374_0x25d8e3;this['_veevaService']=_0x11af8e,this[_0x4345b5(0xc3)]=_0x345d05,this['_logger']=_0xe2698c;}async[a374_0x25d8e3(0x93)](_0x37f0ae,_0x2fef5e){const _0x55d134=a374_0x25d8e3;this[_0x55d134(0xbe)][_0x55d134(0x8c)](_0x55d134(0xcc));const _0x5362e8=veeva_constants_1['VeevaConstants'][_0x55d134(0xae)]+_0x55d134(0xb2),_0x47d5c8=new Array(_0x37f0ae)[_0x55d134(0xb7)]({'summary__v':_0x2fef5e,'object_type__v.api__name__v':'migration__sys'});return await this[_0x55d134(0xb9)][_0x55d134(0xb1)](_0x5362e8,_0x47d5c8);}async[a374_0x25d8e3(0xa8)](_0x17d19e,_0xea339a){const _0x217ad7=a374_0x25d8e3;this['_logger'][_0x217ad7(0x8c)](_0x217ad7(0xbb));const _0x2a1bd3=veeva_constants_1[_0x217ad7(0xcb)][_0x217ad7(0xae)]+_0x217ad7(0x8a),_0x3e66c4=_0x17d19e['map']((_0x2e13d3,_0x4bd041)=>({'vault_component__v':_0x2e13d3['id'],'outbound_package__v':_0xea339a[Math[_0x217ad7(0x91)]((_0x4bd041+0x1)/veeva_constants_1[_0x217ad7(0xcb)][_0x217ad7(0x9e)])-0x1]}));return await this[_0x217ad7(0xb9)]['createVeevaObjectRecords'](_0x2a1bd3,_0x3e66c4);}async[a374_0x25d8e3(0xb3)](_0x3de298){const _0x1dd66a=a374_0x25d8e3;this[_0x1dd66a(0xbe)][_0x1dd66a(0x8c)](_0x1dd66a(0x88));const _0x5cafc0=_0x1dd66a(0xb5)+_0x3de298['join'](_0x1dd66a(0xbd))+'\x27)',_0x3e5383=await this[_0x1dd66a(0xb9)][_0x1dd66a(0xc9)](_0x5cafc0);return _0x3e5383['reduce']((_0x3124de,_0x3b2e04)=>_0x3124de['set'](_0x3b2e04['id'],_0x3b2e04[_0x1dd66a(0xa0)]),new Map());}async['createExportOutboundPackages'](_0x4f515a){const _0x4fd83d=a374_0x25d8e3;this[_0x4fd83d(0xbe)][_0x4fd83d(0x8c)](_0x4fd83d(0xd0));const _0x4f0952=[],_0x4c300c=_0x4f515a['map'](_0x48a4d3=>{const _0x50e459=_0x4fd83d;return this['_connection']['post'](veeva_constants_1['VeevaConstants'][_0x50e459(0xa5)],encodeURI('packageName')+'='+encodeURI(_0x48a4d3),{'headers':{'Content-Type':_0x50e459(0xc8)}});}),_0x27d72f=await Promise[_0x4fd83d(0x98)](_0x4c300c);for(const {data:_0x536732}of _0x27d72f){if(_0x536732['responseStatus']===status_enums_1[_0x4fd83d(0x9a)][_0x4fd83d(0xce)]){const {url:_0x305942}=_0x536732;_0x4f0952['push'](_0x305942);}else throw new veeva_error_1['VeevaError'](_0x536732[_0x4fd83d(0x94)]);}return _0x4f0952;}async[a374_0x25d8e3(0xac)](_0x40153f){const _0x44e265=a374_0x25d8e3;this[_0x44e265(0xbe)][_0x44e265(0x8c)]('Retrieve\x20Jobs\x20Status');const _0x24f933=[],_0x117d96=await this[_0x44e265(0xb9)][_0x44e265(0xa6)](_0x40153f);for(const _0x5bc8df of _0x117d96){const _0x31b486=_0x5bc8df['links'][_0x44e265(0x99)](_0x3ca2a6=>_0x3ca2a6[_0x44e265(0x9d)]==='artifacts')[_0x44e265(0xa1)](_0x5cb6d3=>_0x5cb6d3[_0x44e265(0xc6)]);_0x24f933[_0x44e265(0x92)](..._0x31b486);}return _0x24f933;}async[a374_0x25d8e3(0xa4)](_0x230c82){const _0xef4a57=a374_0x25d8e3;var _0x4bdb5c;const _0x49a4b6=[];this[_0xef4a57(0xbe)]['log'](_0xef4a57(0xca));for(const _0x4d8d04 of _0x230c82){const {data:_0xe42d87,headers:_0xedbaa1}=await this[_0xef4a57(0xc3)]['get'](_0x4d8d04,{'responseType':_0xef4a57(0xb4)}),_0x45a622=(_0x4bdb5c=_0xedbaa1[_0xef4a57(0xb8)])===null||_0x4bdb5c===void 0x0?void 0x0:_0x4bdb5c[_0xef4a57(0xbf)](_0xef4a57(0xa2));if(!_0x45a622){const _0x59b4ba=_0xe42d87,_0x3e2bbc=new jszip_1['default']();await _0x3e2bbc[_0xef4a57(0xcf)](_0x59b4ba),_0x49a4b6['push'](_0x3e2bbc);}else{const _0x17884a=JSON[_0xef4a57(0xc5)](_0xe42d87);throw new veeva_error_1[(_0xef4a57(0x8d))](_0x17884a[_0xef4a57(0x94)]);}}return _0x49a4b6;}async[a374_0x25d8e3(0x9b)](_0xe20d){const _0xe61c27=a374_0x25d8e3;this[_0xe61c27(0xbe)]['log'](_0xe61c27(0x8e));const _0x496136=veeva_constants_1['VeevaConstants'][_0xe61c27(0xae)]+'package_component__v';await this[_0xe61c27(0xb9)]['deleteVeevaObjectRecords'](_0x496136,_0xe20d);}async[a374_0x25d8e3(0xc1)](_0x151b65){const _0x3683b8=a374_0x25d8e3;this[_0x3683b8(0xbe)]['log']('Deleting\x20outbound\x20packages.');const _0x4680bd=veeva_constants_1[_0x3683b8(0xcb)][_0x3683b8(0xae)]+_0x3683b8(0xb2);await this[_0x3683b8(0xb9)][_0x3683b8(0xa9)](_0x4680bd,_0x151b65);}async[a374_0x25d8e3(0x90)](_0x39c74c,_0x58f834){const _0x42a9f8=a374_0x25d8e3,_0x3381e0=await this[_0x42a9f8(0x93)](Math[_0x42a9f8(0x91)](_0x39c74c[_0x42a9f8(0xa3)]/veeva_constants_1[_0x42a9f8(0xcb)][_0x42a9f8(0x9e)]),_0x58f834),_0x40eae0=await this['createPackageComponents'](_0x39c74c,_0x3381e0),_0x4a95ca=await this['getPackageNames'](_0x3381e0),_0x4cf170=await this['createExportOutboundPackages'](Array[_0x42a9f8(0x89)](_0x4a95ca['values']())),_0x351fe5=await this[_0x42a9f8(0xac)](_0x4cf170),_0xfc31c6=await this[_0x42a9f8(0xa4)](_0x351fe5);return await this[_0x42a9f8(0x9b)](_0x40eae0),await this['deleteOutboundPackages'](_0x3381e0),_0xfc31c6;}}exports[a374_0x25d8e3(0xaa)]=PackageExportService;