const a359_0x181ffe=a359_0x4161;(function(_0xd213bb,_0x3adfd1){const _0x202db8=a359_0x4161,_0x11ca17=_0xd213bb();while(!![]){try{const _0x478781=-parseInt(_0x202db8(0x18b))/0x1+-parseInt(_0x202db8(0x1a3))/0x2+parseInt(_0x202db8(0x172))/0x3*(-parseInt(_0x202db8(0x19a))/0x4)+-parseInt(_0x202db8(0x189))/0x5+parseInt(_0x202db8(0x184))/0x6*(-parseInt(_0x202db8(0x18e))/0x7)+parseInt(_0x202db8(0x171))/0x8+parseInt(_0x202db8(0x1af))/0x9*(parseInt(_0x202db8(0x195))/0xa);if(_0x478781===_0x3adfd1)break;else _0x11ca17['push'](_0x11ca17['shift']());}catch(_0x15286c){_0x11ca17['push'](_0x11ca17['shift']());}}}(a359_0x49ae,0xb5c19));const a359_0x43f81a=(function(){let _0x251399=!![];return function(_0x202b02,_0x5e03ed){const _0x16971b=_0x251399?function(){const _0x5589c6=a359_0x4161;if(_0x5e03ed){const _0x444b68=_0x5e03ed[_0x5589c6(0x1a9)](_0x202b02,arguments);return _0x5e03ed=null,_0x444b68;}}:function(){};return _0x251399=![],_0x16971b;};}()),a359_0x275544=a359_0x43f81a(this,function(){const _0x362e15=a359_0x4161;return a359_0x275544[_0x362e15(0x1a0)]()[_0x362e15(0x17b)](_0x362e15(0x1a7))[_0x362e15(0x1a0)]()[_0x362e15(0x180)](a359_0x275544)[_0x362e15(0x17b)](_0x362e15(0x1a7));});a359_0x275544();'use strict';var __importDefault=this&&this[a359_0x181ffe(0x18d)]||function(_0x1dbf5a){return _0x1dbf5a&&_0x1dbf5a['__esModule']?_0x1dbf5a:{'default':_0x1dbf5a};};Object['defineProperty'](exports,a359_0x181ffe(0x169),{'value':!![]}),exports[a359_0x181ffe(0x18f)]=void 0x0;const veeva_constants_1=require(a359_0x181ffe(0x174)),jszip_1=__importDefault(require('jszip')),status_enums_1=require('../enums/status.enums'),veeva_error_1=require(a359_0x181ffe(0x181));class PackageExportService{constructor({veevaService:_0x11311f,connection:_0x36934c,logger:_0x4cd286}){const _0x17e274=a359_0x181ffe;this[_0x17e274(0x1b1)]=_0x11311f,this[_0x17e274(0x190)]=_0x36934c,this['_logger']=_0x4cd286;}async[a359_0x181ffe(0x182)](_0x329680,_0x559728){const _0x2e8549=a359_0x181ffe;this[_0x2e8549(0x192)][_0x2e8549(0x1a2)](_0x2e8549(0x1a6));const _0x41ef1e=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+_0x2e8549(0x19b),_0x5131fb=new Array(_0x329680)[_0x2e8549(0x199)]({'summary__v':_0x559728,'object_type__v.api__name__v':'migration__sys'});return await this[_0x2e8549(0x1b1)][_0x2e8549(0x194)](_0x41ef1e,_0x5131fb);}async[a359_0x181ffe(0x1ac)](_0x407b0d,_0x17a8df){const _0x5adc8d=a359_0x181ffe;this[_0x5adc8d(0x192)]['log'](_0x5adc8d(0x168));const _0x2c7bd0=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+'package_component__v',_0x1ed652=_0x407b0d[_0x5adc8d(0x1aa)]((_0x9291dc,_0x8202d9)=>({'vault_component__v':_0x9291dc['id'],'outbound_package__v':_0x17a8df[Math[_0x5adc8d(0x167)]((_0x8202d9+0x1)/veeva_constants_1['VeevaConstants']['MAXIMUM_SIZE_OF_PACKAGE'])-0x1]}));return await this['_veevaService']['createVeevaObjectRecords'](_0x2c7bd0,_0x1ed652);}async[a359_0x181ffe(0x19d)](_0x305f52){const _0x3a84eb=a359_0x181ffe;this[_0x3a84eb(0x192)][_0x3a84eb(0x1a2)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x556a45=_0x3a84eb(0x1ab)+_0x305f52[_0x3a84eb(0x1ad)](_0x3a84eb(0x16e))+'\x27)',_0x8a55a1=veeva_constants_1[_0x3a84eb(0x1b0)][_0x3a84eb(0x19e)]+_0x556a45,_0x4f1fb6=await this['_veevaService'][_0x3a84eb(0x185)](_0x8a55a1);return _0x4f1fb6[_0x3a84eb(0x1b3)]((_0x217c8a,_0x5f0713)=>_0x217c8a['set'](_0x5f0713['id'],_0x5f0713['name__v']),new Map());}async[a359_0x181ffe(0x1b2)](_0x22867f){const _0x19cbc1=a359_0x181ffe;this['_logger'][_0x19cbc1(0x1a2)](_0x19cbc1(0x16a));const _0x3841df=[],_0xf918cb=_0x22867f[_0x19cbc1(0x1aa)](_0x9f3a18=>{const _0x1f542e=_0x19cbc1;return this[_0x1f542e(0x190)][_0x1f542e(0x16b)](veeva_constants_1[_0x1f542e(0x1b0)][_0x1f542e(0x179)],encodeURI(_0x1f542e(0x175))+'='+encodeURI(_0x9f3a18),{'headers':{'Content-Type':_0x1f542e(0x1ae)}});}),_0x46737d=await Promise[_0x19cbc1(0x191)](_0xf918cb);for(const {data:_0x4a6833}of _0x46737d){if(_0x4a6833[_0x19cbc1(0x18c)]===status_enums_1['VeevaResponseStatus'][_0x19cbc1(0x19f)]){const {url:_0xccccfd}=_0x4a6833;_0x3841df[_0x19cbc1(0x1a8)](_0xccccfd);}else throw new veeva_error_1[(_0x19cbc1(0x19c))](_0x4a6833[_0x19cbc1(0x173)]);}return _0x3841df;}async[a359_0x181ffe(0x17a)](_0x5d2568){const _0x202846=a359_0x181ffe;this['_logger'][_0x202846(0x1a2)](_0x202846(0x178));const _0x506bba=[],_0x349c0a=await this[_0x202846(0x1b1)][_0x202846(0x183)](_0x5d2568);for(const _0x4a64fe of _0x349c0a){const _0x25a5f4=_0x4a64fe[_0x202846(0x17f)]['filter'](_0x5f3a01=>_0x5f3a01[_0x202846(0x193)]===_0x202846(0x197))['map'](_0x53897a=>_0x53897a[_0x202846(0x1a1)]);_0x506bba[_0x202846(0x1a8)](..._0x25a5f4);}return _0x506bba;}async['retrieveVPKList'](_0x5e7929){const _0x4f6f6b=a359_0x181ffe;var _0x12d9b3;const _0x100b6a=[];this[_0x4f6f6b(0x192)]['log'](_0x4f6f6b(0x18a));for(const _0x5def09 of _0x5e7929){const {data:_0xf66534,headers:_0x14c200}=await this[_0x4f6f6b(0x190)][_0x4f6f6b(0x17d)](_0x5def09,{'responseType':'arraybuffer'}),_0x3983f0=(_0x12d9b3=_0x14c200[_0x4f6f6b(0x16f)])===null||_0x12d9b3===void 0x0?void 0x0:_0x12d9b3[_0x4f6f6b(0x196)]('application/json');if(!_0x3983f0){const _0x22a07d=_0xf66534,_0x39940c=new jszip_1[(_0x4f6f6b(0x1a5))]();await _0x39940c['loadAsync'](_0x22a07d),_0x100b6a[_0x4f6f6b(0x1a8)](_0x39940c);}else{const _0x340245=JSON['parse'](_0xf66534);throw new veeva_error_1[(_0x4f6f6b(0x19c))](_0x340245[_0x4f6f6b(0x173)]);}}return _0x100b6a;}async[a359_0x181ffe(0x186)](_0x558df8){const _0x3650c0=a359_0x181ffe;this[_0x3650c0(0x192)][_0x3650c0(0x1a2)](_0x3650c0(0x16c));const _0x24b2e1=veeva_constants_1[_0x3650c0(0x1b0)][_0x3650c0(0x17e)]+_0x3650c0(0x17c);await this[_0x3650c0(0x1b1)][_0x3650c0(0x198)](_0x24b2e1,_0x558df8);}async['deleteOutboundPackages'](_0x54012f){const _0x125119=a359_0x181ffe;this[_0x125119(0x192)][_0x125119(0x1a2)]('Deleting\x20outbound\x20packages.');const _0x127d72=veeva_constants_1[_0x125119(0x1b0)]['ENDPOINT_CREATE_RECORDS']+_0x125119(0x19b);await this['_veevaService'][_0x125119(0x198)](_0x127d72,_0x54012f);}async[a359_0x181ffe(0x177)](_0x1eb8e6,_0x30f22d){const _0x1dfc7a=a359_0x181ffe,_0x569f83=await this[_0x1dfc7a(0x182)](Math[_0x1dfc7a(0x167)](_0x1eb8e6[_0x1dfc7a(0x170)]/veeva_constants_1[_0x1dfc7a(0x1b0)][_0x1dfc7a(0x187)]),_0x30f22d),_0x54fda5=await this[_0x1dfc7a(0x1ac)](_0x1eb8e6,_0x569f83),_0x13453c=await this[_0x1dfc7a(0x19d)](_0x569f83),_0xd74232=await this[_0x1dfc7a(0x1b2)](Array[_0x1dfc7a(0x1a4)](_0x13453c[_0x1dfc7a(0x188)]())),_0x7ec842=await this[_0x1dfc7a(0x17a)](_0xd74232),_0x9307c0=await this[_0x1dfc7a(0x176)](_0x7ec842);return await this[_0x1dfc7a(0x186)](_0x54fda5),await this[_0x1dfc7a(0x16d)](_0x569f83),_0x9307c0;}}function a359_0x4161(_0x4ab4e4,_0x79d913){const _0x3b7d6d=a359_0x49ae();return a359_0x4161=function(_0x275544,_0x43f81a){_0x275544=_0x275544-0x167;let _0x49ae3f=_0x3b7d6d[_0x275544];return _0x49ae3f;},a359_0x4161(_0x4ab4e4,_0x79d913);}function a359_0x49ae(){const _0x4a9bcb=['../constants/veeva.constants','packageName','retrieveVPKList','export','Retrieve\x20Jobs\x20Status','ENDPOINT_EXPORT_IMPORT_PACKAGE','getEndpointArtifactList','search','package_component__v','get','ENDPOINT_CREATE_RECORDS','links','constructor','../classes/errors/veeva-error','createOutboundPackages','getJobResult','973404YFHxhU','executeVQL','deletePackageComponents','MAXIMUM_SIZE_OF_PACKAGE','values','6593740MNbzyc','Retrieve\x20Outbound\x20Package\x20zip\x20list','1352309CxUFZa','responseStatus','__importDefault','42vbhkbn','PackageExportService','_connection','all','_logger','rel','createVeevaObjectRecords','131770yQIAfN','includes','artifacts','deleteVeevaObjectRecords','fill','2212588ixVCHC','outbound_package__v','VeevaError','getPackageNames','ENDPOINT_VQL','SUCCESS','toString','href','log','2546886WKatvp','from','default','Creating\x20outbound\x20packages','(((.+)+)+)+$','push','apply','map','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','createPackageComponents','join','application/x-www-form-urlencoded','4491EHFarr','VeevaConstants','_veevaService','createExportOutboundPackages','reduce','ceil','Adding\x20components\x20to\x20outbound\x20package','__esModule','Create\x20Export\x20outbound\x20packages.','post','Removing\x20components\x20from\x20outbound\x20packages.','deleteOutboundPackages','\x27,\x27','content-type','length','1546784QQPBGB','6iqXyop','errors'];a359_0x49ae=function(){return _0x4a9bcb;};return a359_0x49ae();}exports[a359_0x181ffe(0x18f)]=PackageExportService;