const a374_0xf03f3f=a374_0x13e2;(function(_0x2f9751,_0x4a42ab){const _0x44c8c4=a374_0x13e2,_0x1adbe9=_0x2f9751();while(!![]){try{const _0x6f4fd8=-parseInt(_0x44c8c4(0x150))/0x1*(-parseInt(_0x44c8c4(0x153))/0x2)+-parseInt(_0x44c8c4(0x13a))/0x3+parseInt(_0x44c8c4(0x164))/0x4*(parseInt(_0x44c8c4(0x177))/0x5)+-parseInt(_0x44c8c4(0x17a))/0x6*(parseInt(_0x44c8c4(0x148))/0x7)+-parseInt(_0x44c8c4(0x171))/0x8*(-parseInt(_0x44c8c4(0x14f))/0x9)+-parseInt(_0x44c8c4(0x143))/0xa*(-parseInt(_0x44c8c4(0x163))/0xb)+-parseInt(_0x44c8c4(0x17d))/0xc;if(_0x6f4fd8===_0x4a42ab)break;else _0x1adbe9['push'](_0x1adbe9['shift']());}catch(_0x4b4689){_0x1adbe9['push'](_0x1adbe9['shift']());}}}(a374_0x5dc4,0x30aeb));const a374_0x338838=(function(){let _0x4414da=!![];return function(_0x4ae47d,_0x5559f3){const _0x4704c4=_0x4414da?function(){const _0x4a1d8a=a374_0x13e2;if(_0x5559f3){const _0x54c32b=_0x5559f3[_0x4a1d8a(0x179)](_0x4ae47d,arguments);return _0x5559f3=null,_0x54c32b;}}:function(){};return _0x4414da=![],_0x4704c4;};}()),a374_0x10f349=a374_0x338838(this,function(){const _0x24ebac=a374_0x13e2;return a374_0x10f349['toString']()['search'](_0x24ebac(0x158))[_0x24ebac(0x169)]()['constructor'](a374_0x10f349)[_0x24ebac(0x141)](_0x24ebac(0x158));});a374_0x10f349();'use strict';var __importDefault=this&&this[a374_0xf03f3f(0x155)]||function(_0x417b47){const _0x504897=a374_0xf03f3f;return _0x417b47&&_0x417b47[_0x504897(0x14a)]?_0x417b47:{'default':_0x417b47};};function a374_0x13e2(_0x40deee,_0x2e329a){const _0x5d2ea7=a374_0x5dc4();return a374_0x13e2=function(_0x10f349,_0x338838){_0x10f349=_0x10f349-0x137;let _0x5dc46e=_0x5d2ea7[_0x10f349];return _0x5dc46e;},a374_0x13e2(_0x40deee,_0x2e329a);}function a374_0x5dc4(){const _0x584c4d=['package_component__v','search','outbound_package__v','110fdrkSt','parse','_veevaService','getPackageNames','_connection','481537YdnYBF','getEndpointArtifactList','__esModule','Create\x20Export\x20outbound\x20packages.','VeevaError','createOutboundPackages','includes','1710630UcXhgn','5sHVdKJ','name__v','Adding\x20components\x20to\x20outbound\x20package','127730YvldDQ','migration__sys','__importDefault','Creating\x20outbound\x20packages','application/json','(((.+)+)+)+$','ceil','../constants/veeva.constants','VeevaConstants','map','log','default','packageName','loadAsync','retrieveVPKList','createVeevaObjectRecords','19635tVtQzZ','29816vgmFYX','all','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','content-type','reduce','toString','VeevaResponseStatus','links','SUCCESS','_logger','createPackageComponents','errors','fill','16AffWor','deletePackageComponents','executeVQL','Retrieve\x20Jobs\x20Status','PackageExportService','getJobResult','5DBukAb','from','apply','6aXQTJT','Removing\x20components\x20from\x20outbound\x20packages.','MAXIMUM_SIZE_OF_PACKAGE','1697244sPEwkP','deleteOutboundPackages','get','push','href','\x27,\x27','../classes/errors/veeva-error','950769QHCTbM','../enums/status.enums','length','ENDPOINT_CREATE_RECORDS','responseStatus','set'];a374_0x5dc4=function(){return _0x584c4d;};return a374_0x5dc4();}Object['defineProperty'](exports,a374_0xf03f3f(0x14a),{'value':!![]}),exports[a374_0xf03f3f(0x175)]=void 0x0;const veeva_constants_1=require(a374_0xf03f3f(0x15a)),jszip_1=__importDefault(require('jszip')),status_enums_1=require(a374_0xf03f3f(0x13b)),veeva_error_1=require(a374_0xf03f3f(0x139));class PackageExportService{constructor({veevaService:_0x24dd2d,connection:_0x4a7e54,logger:_0x596d75}){const _0x219d58=a374_0xf03f3f;this[_0x219d58(0x145)]=_0x24dd2d,this[_0x219d58(0x147)]=_0x4a7e54,this['_logger']=_0x596d75;}async[a374_0xf03f3f(0x14d)](_0x127f8f,_0x4f8915){const _0x3f349b=a374_0xf03f3f;this[_0x3f349b(0x16d)][_0x3f349b(0x15d)](_0x3f349b(0x156));const _0x31701f=veeva_constants_1[_0x3f349b(0x15b)][_0x3f349b(0x13d)]+_0x3f349b(0x142),_0x2c602a=new Array(_0x127f8f)[_0x3f349b(0x170)]({'summary__v':_0x4f8915,'object_type__v.api__name__v':_0x3f349b(0x154)});return await this[_0x3f349b(0x145)][_0x3f349b(0x162)](_0x31701f,_0x2c602a);}async[a374_0xf03f3f(0x16e)](_0x2aa57b,_0x529178){const _0x3e93a3=a374_0xf03f3f;this['_logger'][_0x3e93a3(0x15d)](_0x3e93a3(0x152));const _0x4c3345=veeva_constants_1[_0x3e93a3(0x15b)]['ENDPOINT_CREATE_RECORDS']+_0x3e93a3(0x140),_0x4ccc01=_0x2aa57b[_0x3e93a3(0x15c)]((_0x863eec,_0x2db9d8)=>({'vault_component__v':_0x863eec['id'],'outbound_package__v':_0x529178[Math[_0x3e93a3(0x159)]((_0x2db9d8+0x1)/veeva_constants_1[_0x3e93a3(0x15b)][_0x3e93a3(0x17c)])-0x1]}));return await this[_0x3e93a3(0x145)]['createVeevaObjectRecords'](_0x4c3345,_0x4ccc01);}async[a374_0xf03f3f(0x146)](_0x4a7169){const _0x19b6ef=a374_0xf03f3f;this[_0x19b6ef(0x16d)][_0x19b6ef(0x15d)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x124cda=_0x19b6ef(0x166)+_0x4a7169['join'](_0x19b6ef(0x138))+'\x27)',_0x28100f=await this[_0x19b6ef(0x145)][_0x19b6ef(0x173)](_0x124cda);return _0x28100f[_0x19b6ef(0x168)]((_0x4d8166,_0x21368f)=>_0x4d8166[_0x19b6ef(0x13f)](_0x21368f['id'],_0x21368f[_0x19b6ef(0x151)]),new Map());}async['createExportOutboundPackages'](_0x32b49c){const _0x51a978=a374_0xf03f3f;this[_0x51a978(0x16d)][_0x51a978(0x15d)](_0x51a978(0x14b));const _0x43be0c=[],_0x3bde76=_0x32b49c[_0x51a978(0x15c)](_0x1dad9b=>{const _0x2cc58c=_0x51a978;return this[_0x2cc58c(0x147)]['post'](veeva_constants_1[_0x2cc58c(0x15b)]['ENDPOINT_EXPORT_IMPORT_PACKAGE'],encodeURI(_0x2cc58c(0x15f))+'='+encodeURI(_0x1dad9b),{'headers':{'Content-Type':'application/x-www-form-urlencoded'}});}),_0x5bf698=await Promise[_0x51a978(0x165)](_0x3bde76);for(const {data:_0x3db483}of _0x5bf698){if(_0x3db483[_0x51a978(0x13e)]===status_enums_1[_0x51a978(0x16a)][_0x51a978(0x16c)]){const {url:_0x4a9686}=_0x3db483;_0x43be0c['push'](_0x4a9686);}else throw new veeva_error_1[(_0x51a978(0x14c))](_0x3db483[_0x51a978(0x16f)]);}return _0x43be0c;}async['getEndpointArtifactList'](_0x4f16e3){const _0x7eec28=a374_0xf03f3f;this[_0x7eec28(0x16d)][_0x7eec28(0x15d)](_0x7eec28(0x174));const _0x153427=[],_0x3627a4=await this[_0x7eec28(0x145)][_0x7eec28(0x176)](_0x4f16e3);for(const _0x53fcb6 of _0x3627a4){const _0x1aa54e=_0x53fcb6[_0x7eec28(0x16b)]['filter'](_0x502d51=>_0x502d51['rel']==='artifacts')[_0x7eec28(0x15c)](_0xbbf590=>_0xbbf590[_0x7eec28(0x137)]);_0x153427[_0x7eec28(0x180)](..._0x1aa54e);}return _0x153427;}async[a374_0xf03f3f(0x161)](_0x584ea4){const _0x476095=a374_0xf03f3f;var _0x4081ef;const _0x11a50c=[];this[_0x476095(0x16d)][_0x476095(0x15d)]('Retrieve\x20Outbound\x20Package\x20zip\x20list');for(const _0x899dd1 of _0x584ea4){const {data:_0x508dce,headers:_0x5dc5a5}=await this[_0x476095(0x147)][_0x476095(0x17f)](_0x899dd1,{'responseType':'arraybuffer'}),_0x5cde4d=(_0x4081ef=_0x5dc5a5[_0x476095(0x167)])===null||_0x4081ef===void 0x0?void 0x0:_0x4081ef[_0x476095(0x14e)](_0x476095(0x157));if(!_0x5cde4d){const _0x134107=_0x508dce,_0x4b2371=new jszip_1[(_0x476095(0x15e))]();await _0x4b2371[_0x476095(0x160)](_0x134107),_0x11a50c[_0x476095(0x180)](_0x4b2371);}else{const _0x52a887=JSON[_0x476095(0x144)](_0x508dce);throw new veeva_error_1[(_0x476095(0x14c))](_0x52a887['errors']);}}return _0x11a50c;}async[a374_0xf03f3f(0x172)](_0x27251b){const _0x309371=a374_0xf03f3f;this[_0x309371(0x16d)][_0x309371(0x15d)](_0x309371(0x17b));const _0x59cc9e=veeva_constants_1[_0x309371(0x15b)][_0x309371(0x13d)]+_0x309371(0x140);await this[_0x309371(0x145)]['deleteVeevaObjectRecords'](_0x59cc9e,_0x27251b);}async[a374_0xf03f3f(0x17e)](_0x427a11){const _0x4db9de=a374_0xf03f3f;this[_0x4db9de(0x16d)][_0x4db9de(0x15d)]('Deleting\x20outbound\x20packages.');const _0x3c7f96=veeva_constants_1['VeevaConstants'][_0x4db9de(0x13d)]+_0x4db9de(0x142);await this['_veevaService']['deleteVeevaObjectRecords'](_0x3c7f96,_0x427a11);}async['export'](_0x229255,_0x1743a4){const _0x31fbce=a374_0xf03f3f,_0x2597f7=await this[_0x31fbce(0x14d)](Math['ceil'](_0x229255[_0x31fbce(0x13c)]/veeva_constants_1[_0x31fbce(0x15b)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x1743a4),_0x20932b=await this[_0x31fbce(0x16e)](_0x229255,_0x2597f7),_0x434531=await this[_0x31fbce(0x146)](_0x2597f7),_0x5323b6=await this['createExportOutboundPackages'](Array[_0x31fbce(0x178)](_0x434531['values']())),_0x52f2fe=await this[_0x31fbce(0x149)](_0x5323b6),_0x1383ec=await this['retrieveVPKList'](_0x52f2fe);return await this[_0x31fbce(0x172)](_0x20932b),await this[_0x31fbce(0x17e)](_0x2597f7),_0x1383ec;}}exports['PackageExportService']=PackageExportService;