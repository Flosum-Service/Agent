const a403_0x14ee22=a403_0xf75e;(function(_0x44c528,_0x5b4e94){const _0xed37fd=a403_0xf75e,_0x570283=_0x44c528();while(!![]){try{const _0x5a2bc7=parseInt(_0xed37fd(0x12e))/0x1+-parseInt(_0xed37fd(0x109))/0x2+-parseInt(_0xed37fd(0x10d))/0x3+-parseInt(_0xed37fd(0xfd))/0x4*(parseInt(_0xed37fd(0x136))/0x5)+-parseInt(_0xed37fd(0x12a))/0x6+-parseInt(_0xed37fd(0x131))/0x7+parseInt(_0xed37fd(0x10c))/0x8;if(_0x5a2bc7===_0x5b4e94)break;else _0x570283['push'](_0x570283['shift']());}catch(_0x1c4c55){_0x570283['push'](_0x570283['shift']());}}}(a403_0x3268,0x556b7));const a403_0x34fd88=(function(){let _0x371c7c=!![];return function(_0x26ac78,_0x3dfdad){const _0x95c292=_0x371c7c?function(){if(_0x3dfdad){const _0x43d396=_0x3dfdad['apply'](_0x26ac78,arguments);return _0x3dfdad=null,_0x43d396;}}:function(){};return _0x371c7c=![],_0x95c292;};}()),a403_0x25c35c=a403_0x34fd88(this,function(){const _0x37b78a=a403_0xf75e;return a403_0x25c35c[_0x37b78a(0x11a)]()[_0x37b78a(0xff)]('(((.+)+)+)+$')[_0x37b78a(0x11a)]()[_0x37b78a(0x11b)](a403_0x25c35c)[_0x37b78a(0xff)](_0x37b78a(0x10a));});a403_0x25c35c();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x490e36){return _0x490e36&&_0x490e36['__esModule']?_0x490e36:{'default':_0x490e36};};Object[a403_0x14ee22(0x135)](exports,a403_0x14ee22(0x106),{'value':!![]}),exports['PackageExportService']=void 0x0;function a403_0xf75e(_0x27891d,_0x4311ed){const _0x886160=a403_0x3268();return a403_0xf75e=function(_0x25c35c,_0x34fd88){_0x25c35c=_0x25c35c-0xf6;let _0x326836=_0x886160[_0x25c35c];return _0x326836;},a403_0xf75e(_0x27891d,_0x4311ed);}const veeva_constants_1=require(a403_0x14ee22(0x114)),jszip_1=__importDefault(require(a403_0x14ee22(0x134))),status_enums_1=require('../enums/status.enums'),veeva_error_1=require('../classes/errors/veeva-error');class PackageExportService{constructor({veevaService:_0x4e7c6e,connection:_0x344ca1,logger:_0x3bc667}){const _0x2c50f4=a403_0x14ee22;this[_0x2c50f4(0x11f)]=_0x4e7c6e,this[_0x2c50f4(0x119)]=_0x344ca1,this[_0x2c50f4(0x110)]=_0x3bc667;}async['createOutboundPackages'](_0x28ba73,_0x2f975e){const _0x4560ac=a403_0x14ee22;this[_0x4560ac(0x110)][_0x4560ac(0xf7)]('Creating\x20outbound\x20packages');const _0x2720ac=veeva_constants_1[_0x4560ac(0x123)][_0x4560ac(0x10e)]+_0x4560ac(0xf9),_0x1b7d92=new Array(_0x28ba73)[_0x4560ac(0x126)]({'summary__v':_0x2f975e,'object_type__v.api__name__v':_0x4560ac(0x132)});return await this[_0x4560ac(0x11f)]['createVeevaObjectRecords'](_0x2720ac,_0x1b7d92);}async[a403_0x14ee22(0x120)](_0x5a8865,_0x2ec30d){const _0x3b1cee=a403_0x14ee22;this['_logger'][_0x3b1cee(0xf7)]('Adding\x20components\x20to\x20outbound\x20package');const _0x521e0a=veeva_constants_1[_0x3b1cee(0x123)][_0x3b1cee(0x10e)]+_0x3b1cee(0x115),_0x46cedb=_0x5a8865[_0x3b1cee(0xfb)]((_0x573cb2,_0xc41961)=>({'vault_component__v':_0x573cb2['id'],'outbound_package__v':_0x2ec30d[Math['ceil']((_0xc41961+0x1)/veeva_constants_1['VeevaConstants'][_0x3b1cee(0x122)])-0x1]}));return await this[_0x3b1cee(0x11f)][_0x3b1cee(0xfc)](_0x521e0a,_0x46cedb);}async[a403_0x14ee22(0x129)](_0x1d077c){const _0x1b0353=a403_0x14ee22;this[_0x1b0353(0x110)][_0x1b0353(0xf7)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x2214f3='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27'+_0x1d077c[_0x1b0353(0x125)]('\x27,\x27')+'\x27)',_0x507ce0=await this[_0x1b0353(0x11f)]['executeVQL'](_0x2214f3);return _0x507ce0['reduce']((_0x15a1fd,_0x2ae1a2)=>_0x15a1fd[_0x1b0353(0x112)](_0x2ae1a2['id'],_0x2ae1a2[_0x1b0353(0x111)]),new Map());}async[a403_0x14ee22(0xf8)](_0x313b69){const _0x217c49=a403_0x14ee22;this[_0x217c49(0x110)][_0x217c49(0xf7)](_0x217c49(0x12f));const _0x12be79=[],_0xb67151=_0x313b69[_0x217c49(0xfb)](_0x272ac2=>{const _0x483dbb=_0x217c49;return this[_0x483dbb(0x119)][_0x483dbb(0x107)](veeva_constants_1[_0x483dbb(0x123)][_0x483dbb(0x103)],encodeURI('packageName')+'='+encodeURI(_0x272ac2),{'headers':{'Content-Type':_0x483dbb(0xfe)}});}),_0x2f2470=await Promise['all'](_0xb67151);for(const {data:_0x3295ea}of _0x2f2470){if(_0x3295ea[_0x217c49(0x102)]===status_enums_1[_0x217c49(0x104)][_0x217c49(0x10f)]){const {url:_0x86bede}=_0x3295ea;_0x12be79[_0x217c49(0x12b)](_0x86bede);}else throw new veeva_error_1[(_0x217c49(0x100))](_0x3295ea[_0x217c49(0x118)]);}return _0x12be79;}async[a403_0x14ee22(0x101)](_0x3d3fc2){const _0x183277=a403_0x14ee22;this['_logger'][_0x183277(0xf7)]('Retrieve\x20Jobs\x20Status');const _0x3ced93=[],_0x58814c=await this['_veevaService'][_0x183277(0x11c)](_0x3d3fc2);for(const _0x18ad09 of _0x58814c){const _0x53e732=_0x18ad09[_0x183277(0x124)][_0x183277(0x11e)](_0x17ae7c=>_0x17ae7c[_0x183277(0x113)]===_0x183277(0x116))[_0x183277(0xfb)](_0x4583d6=>_0x4583d6[_0x183277(0x12d)]);_0x3ced93[_0x183277(0x12b)](..._0x53e732);}return _0x3ced93;}async['retrieveVPKList'](_0x16595f){const _0x583b44=a403_0x14ee22;var _0x11cf88;const _0x40261d=[];this[_0x583b44(0x110)][_0x583b44(0xf7)](_0x583b44(0x130));for(const _0x597417 of _0x16595f){const {data:_0x307e58,headers:_0x5231ec}=await this[_0x583b44(0x119)]['get'](_0x597417,{'responseType':_0x583b44(0x11d)}),_0x2a3846=(_0x11cf88=_0x5231ec[_0x583b44(0x117)])===null||_0x11cf88===void 0x0?void 0x0:_0x11cf88[_0x583b44(0x12c)]('application/json');if(!_0x2a3846){const _0x151739=_0x307e58,_0x3946b3=new jszip_1['default']();await _0x3946b3[_0x583b44(0x108)](_0x151739),_0x40261d[_0x583b44(0x12b)](_0x3946b3);}else{const _0x4deee3=JSON[_0x583b44(0x127)](_0x307e58);throw new veeva_error_1[(_0x583b44(0x100))](_0x4deee3[_0x583b44(0x118)]);}}return _0x40261d;}async[a403_0x14ee22(0x133)](_0x2434bc){const _0x1d165b=a403_0x14ee22;this[_0x1d165b(0x110)]['log'](_0x1d165b(0x105));const _0x35125f=veeva_constants_1[_0x1d165b(0x123)][_0x1d165b(0x10e)]+'package_component__v';await this[_0x1d165b(0x11f)][_0x1d165b(0xf6)](_0x35125f,_0x2434bc);}async[a403_0x14ee22(0x121)](_0x580116){const _0x58e78f=a403_0x14ee22;this[_0x58e78f(0x110)][_0x58e78f(0xf7)](_0x58e78f(0x128));const _0x35ae2a=veeva_constants_1['VeevaConstants'][_0x58e78f(0x10e)]+_0x58e78f(0xf9);await this[_0x58e78f(0x11f)][_0x58e78f(0xf6)](_0x35ae2a,_0x580116);}async['export'](_0x1c5cac,_0x39c216){const _0x586ab7=a403_0x14ee22,_0x310e7a=await this['createOutboundPackages'](Math['ceil'](_0x1c5cac['length']/veeva_constants_1['VeevaConstants'][_0x586ab7(0x122)]),_0x39c216),_0x148797=await this[_0x586ab7(0x120)](_0x1c5cac,_0x310e7a),_0x8ab2d3=await this[_0x586ab7(0x129)](_0x310e7a),_0x2f8d1f=await this[_0x586ab7(0xf8)](Array[_0x586ab7(0x10b)](_0x8ab2d3['values']())),_0x2c9a1d=await this['getEndpointArtifactList'](_0x2f8d1f),_0x411915=await this['retrieveVPKList'](_0x2c9a1d);return await this[_0x586ab7(0x133)](_0x148797),await this['deleteOutboundPackages'](_0x310e7a),_0x411915;}}exports[a403_0x14ee22(0xfa)]=PackageExportService;function a403_0x3268(){const _0xcc0c88=['filter','_veevaService','createPackageComponents','deleteOutboundPackages','MAXIMUM_SIZE_OF_PACKAGE','VeevaConstants','links','join','fill','parse','Deleting\x20outbound\x20packages.','getPackageNames','1125228nnRoeh','push','includes','href','567954XHfztD','Create\x20Export\x20outbound\x20packages.','Retrieve\x20Outbound\x20Package\x20zip\x20list','902734rPwdIR','migration__sys','deletePackageComponents','jszip','defineProperty','5xcKVCn','deleteVeevaObjectRecords','log','createExportOutboundPackages','outbound_package__v','PackageExportService','map','createVeevaObjectRecords','2733868yhszej','application/x-www-form-urlencoded','search','VeevaError','getEndpointArtifactList','responseStatus','ENDPOINT_EXPORT_IMPORT_PACKAGE','VeevaResponseStatus','Removing\x20components\x20from\x20outbound\x20packages.','__esModule','post','loadAsync','830602sOELSy','(((.+)+)+)+$','from','10321840GOUXYp','279111jFyrEf','ENDPOINT_CREATE_RECORDS','SUCCESS','_logger','name__v','set','rel','../constants/veeva.constants','package_component__v','artifacts','content-type','errors','_connection','toString','constructor','getJobResult','arraybuffer'];a403_0x3268=function(){return _0xcc0c88;};return a403_0x3268();}