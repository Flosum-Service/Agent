const a335_0x2572e6=a335_0x4834;(function(_0x5d3e21,_0x5e3cd){const _0x31794e=a335_0x4834,_0x5e73d7=_0x5d3e21();while(!![]){try{const _0x466849=-parseInt(_0x31794e(0x17e))/0x1*(parseInt(_0x31794e(0x160))/0x2)+parseInt(_0x31794e(0x16d))/0x3+parseInt(_0x31794e(0x173))/0x4*(-parseInt(_0x31794e(0x170))/0x5)+parseInt(_0x31794e(0x16a))/0x6+-parseInt(_0x31794e(0x15e))/0x7+-parseInt(_0x31794e(0x184))/0x8+parseInt(_0x31794e(0x146))/0x9;if(_0x466849===_0x5e3cd)break;else _0x5e73d7['push'](_0x5e73d7['shift']());}catch(_0x5ad6a2){_0x5e73d7['push'](_0x5e73d7['shift']());}}}(a335_0x193b,0x21b39));const a335_0x6f5448=(function(){let _0x1024ed=!![];return function(_0x4f89b6,_0x1d32a2){const _0x34b775=_0x1024ed?function(){const _0x40361d=a335_0x4834;if(_0x1d32a2){const _0x36cd8d=_0x1d32a2[_0x40361d(0x175)](_0x4f89b6,arguments);return _0x1d32a2=null,_0x36cd8d;}}:function(){};return _0x1024ed=![],_0x34b775;};}()),a335_0x2a259a=a335_0x6f5448(this,function(){const _0x266b46=a335_0x4834;return a335_0x2a259a[_0x266b46(0x16e)]()[_0x266b46(0x18a)](_0x266b46(0x156))[_0x266b46(0x16e)]()[_0x266b46(0x17c)](a335_0x2a259a)['search'](_0x266b46(0x156));});a335_0x2a259a();'use strict';var __importDefault=this&&this[a335_0x2572e6(0x150)]||function(_0x93c27e){const _0x1be479=a335_0x2572e6;return _0x93c27e&&_0x93c27e[_0x1be479(0x161)]?_0x93c27e:{'default':_0x93c27e};};function a335_0x193b(){const _0x4d8518=['search','ceil','outbound_package__v','VeevaConstants','retrieveVPKList','packageName','rel','filter','5161005wRonWF','join','application/x-www-form-urlencoded','responseStatus','errors','values','from','PackageExportService','../classes/errors/veeva-error','artifacts','__importDefault','VeevaResponseStatus','deleteVeevaObjectRecords','ENDPOINT_CREATE_RECORDS','executeVQL','get','(((.+)+)+)+$','createOutboundPackages','default','createExportOutboundPackages','getJobResult','migration__sys','push','Creating\x20outbound\x20packages','528822LFlnIF','SUCCESS','2WfrVNL','__esModule','arraybuffer','_veevaService','defineProperty','set','_logger','_connection','createPackageComponents','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','111624MAnair','getEndpointArtifactList','Retrieve\x20Jobs\x20Status','322989ZTHNKe','toString','parse','83645wQuXvq','content-type','loadAsync','60wUjUAi','package_component__v','apply','../enums/status.enums','\x27,\x27','reduce','MAXIMUM_SIZE_OF_PACKAGE','ENDPOINT_EXPORT_IMPORT_PACKAGE','fill','constructor','createVeevaObjectRecords','199799HSibjN','deleteOutboundPackages','Adding\x20components\x20to\x20outbound\x20package','Deleting\x20outbound\x20packages.','getPackageNames','href','283128HLYPHU','VeevaError','map','log','ENDPOINT_VQL','deletePackageComponents'];a335_0x193b=function(){return _0x4d8518;};return a335_0x193b();}Object[a335_0x2572e6(0x164)](exports,a335_0x2572e6(0x161),{'value':!![]}),exports[a335_0x2572e6(0x14d)]=void 0x0;const veeva_constants_1=require('../constants/veeva.constants'),jszip_1=__importDefault(require('jszip')),status_enums_1=require(a335_0x2572e6(0x176)),veeva_error_1=require(a335_0x2572e6(0x14e));class PackageExportService{constructor({veevaService:_0x123e3f,connection:_0x517184,logger:_0x1f6e35}){const _0x40f7b5=a335_0x2572e6;this['_veevaService']=_0x123e3f,this[_0x40f7b5(0x167)]=_0x517184,this[_0x40f7b5(0x166)]=_0x1f6e35;}async[a335_0x2572e6(0x157)](_0x2d2e14,_0x4abc33){const _0x562e68=a335_0x2572e6;this[_0x562e68(0x166)][_0x562e68(0x187)](_0x562e68(0x15d));const _0x3a1b35=veeva_constants_1['VeevaConstants'][_0x562e68(0x153)]+'outbound_package__v',_0x34c919=new Array(_0x2d2e14)[_0x562e68(0x17b)]({'summary__v':_0x4abc33,'object_type__v.api__name__v':_0x562e68(0x15b)});return await this['_veevaService'][_0x562e68(0x17d)](_0x3a1b35,_0x34c919);}async['createPackageComponents'](_0x2be7ef,_0x16d91d){const _0x27974c=a335_0x2572e6;this[_0x27974c(0x166)][_0x27974c(0x187)](_0x27974c(0x180));const _0x333772=veeva_constants_1[_0x27974c(0x141)][_0x27974c(0x153)]+_0x27974c(0x174),_0x471f98=_0x2be7ef[_0x27974c(0x186)]((_0x63c2dd,_0x1c4a29)=>({'vault_component__v':_0x63c2dd['id'],'outbound_package__v':_0x16d91d[Math[_0x27974c(0x18b)]((_0x1c4a29+0x1)/veeva_constants_1[_0x27974c(0x141)][_0x27974c(0x179)])-0x1]}));return await this['_veevaService']['createVeevaObjectRecords'](_0x333772,_0x471f98);}async[a335_0x2572e6(0x182)](_0x4b84ca){const _0x54e781=a335_0x2572e6;this[_0x54e781(0x166)][_0x54e781(0x187)]('Getting\x20names\x20of\x20outbound\x20packages');const _0x47227f=_0x54e781(0x169)+_0x4b84ca[_0x54e781(0x147)](_0x54e781(0x177))+'\x27)',_0x457e2b=veeva_constants_1[_0x54e781(0x141)][_0x54e781(0x188)]+_0x47227f,_0x11316d=await this[_0x54e781(0x163)][_0x54e781(0x154)](_0x457e2b);return _0x11316d[_0x54e781(0x178)]((_0x301544,_0x2894b7)=>_0x301544[_0x54e781(0x165)](_0x2894b7['id'],_0x2894b7['name__v']),new Map());}async[a335_0x2572e6(0x159)](_0x5f50f3){const _0x39d4c8=a335_0x2572e6;this[_0x39d4c8(0x166)]['log']('Create\x20Export\x20outbound\x20packages.');const _0x21df82=[],_0x5e8102=_0x5f50f3['map'](_0x1dad24=>{const _0x3b844f=_0x39d4c8;return this[_0x3b844f(0x167)]['post'](veeva_constants_1[_0x3b844f(0x141)][_0x3b844f(0x17a)],encodeURI(_0x3b844f(0x143))+'='+encodeURI(_0x1dad24),{'headers':{'Content-Type':_0x3b844f(0x148)}});}),_0x331fca=await Promise['all'](_0x5e8102);for(const {data:_0x42406a}of _0x331fca){if(_0x42406a[_0x39d4c8(0x149)]===status_enums_1[_0x39d4c8(0x151)][_0x39d4c8(0x15f)]){const {url:_0x368bf8}=_0x42406a;_0x21df82[_0x39d4c8(0x15c)](_0x368bf8);}else throw new veeva_error_1[(_0x39d4c8(0x185))](_0x42406a['errors']);}return _0x21df82;}async[a335_0x2572e6(0x16b)](_0x1d4490){const _0x2cd8b7=a335_0x2572e6;this['_logger'][_0x2cd8b7(0x187)](_0x2cd8b7(0x16c));const _0x376f2b=[],_0x2f7e65=await this[_0x2cd8b7(0x163)][_0x2cd8b7(0x15a)](_0x1d4490);for(const _0x59c459 of _0x2f7e65){const _0x2bb116=_0x59c459['links'][_0x2cd8b7(0x145)](_0x40c7fc=>_0x40c7fc[_0x2cd8b7(0x144)]===_0x2cd8b7(0x14f))[_0x2cd8b7(0x186)](_0x2ea343=>_0x2ea343[_0x2cd8b7(0x183)]);_0x376f2b[_0x2cd8b7(0x15c)](..._0x2bb116);}return _0x376f2b;}async[a335_0x2572e6(0x142)](_0x5b7c95){const _0x4e6df3=a335_0x2572e6;var _0x3c698c;const _0x5868f8=[];this[_0x4e6df3(0x166)][_0x4e6df3(0x187)]('Retrieve\x20Outbound\x20Package\x20zip\x20list');for(const _0x1dce59 of _0x5b7c95){const {data:_0x21e8eb,headers:_0x1ab2ce}=await this['_connection'][_0x4e6df3(0x155)](_0x1dce59,{'responseType':_0x4e6df3(0x162)}),_0x26c42c=(_0x3c698c=_0x1ab2ce[_0x4e6df3(0x171)])===null||_0x3c698c===void 0x0?void 0x0:_0x3c698c['includes']('application/json');if(!_0x26c42c){const _0x34f705=_0x21e8eb,_0x2a76bc=new jszip_1[(_0x4e6df3(0x158))]();await _0x2a76bc[_0x4e6df3(0x172)](_0x34f705),_0x5868f8[_0x4e6df3(0x15c)](_0x2a76bc);}else{const _0x58f2d6=JSON[_0x4e6df3(0x16f)](_0x21e8eb);throw new veeva_error_1['VeevaError'](_0x58f2d6[_0x4e6df3(0x14a)]);}}return _0x5868f8;}async[a335_0x2572e6(0x189)](_0x356eba){const _0x3c9fc6=a335_0x2572e6;this[_0x3c9fc6(0x166)]['log']('Removing\x20components\x20from\x20outbound\x20packages.');const _0x231a89=veeva_constants_1[_0x3c9fc6(0x141)][_0x3c9fc6(0x153)]+_0x3c9fc6(0x174);await this[_0x3c9fc6(0x163)][_0x3c9fc6(0x152)](_0x231a89,_0x356eba);}async[a335_0x2572e6(0x17f)](_0x17e082){const _0x28bd37=a335_0x2572e6;this['_logger'][_0x28bd37(0x187)](_0x28bd37(0x181));const _0x579580=veeva_constants_1[_0x28bd37(0x141)][_0x28bd37(0x153)]+_0x28bd37(0x18c);await this[_0x28bd37(0x163)]['deleteVeevaObjectRecords'](_0x579580,_0x17e082);}async['export'](_0x3be9d4,_0x43a3da){const _0x4f48d0=a335_0x2572e6,_0xe91f3c=await this[_0x4f48d0(0x157)](Math['ceil'](_0x3be9d4['length']/veeva_constants_1[_0x4f48d0(0x141)]['MAXIMUM_SIZE_OF_PACKAGE']),_0x43a3da),_0x34a10e=await this[_0x4f48d0(0x168)](_0x3be9d4,_0xe91f3c),_0x307a8e=await this[_0x4f48d0(0x182)](_0xe91f3c),_0x37d478=await this[_0x4f48d0(0x159)](Array[_0x4f48d0(0x14c)](_0x307a8e[_0x4f48d0(0x14b)]())),_0x11aad5=await this[_0x4f48d0(0x16b)](_0x37d478),_0x174486=await this[_0x4f48d0(0x142)](_0x11aad5);return await this[_0x4f48d0(0x189)](_0x34a10e),await this['deleteOutboundPackages'](_0xe91f3c),_0x174486;}}function a335_0x4834(_0x112c4d,_0x58ee5b){const _0x424e3c=a335_0x193b();return a335_0x4834=function(_0x2a259a,_0x6f5448){_0x2a259a=_0x2a259a-0x141;let _0x193bf5=_0x424e3c[_0x2a259a];return _0x193bf5;},a335_0x4834(_0x112c4d,_0x58ee5b);}exports[a335_0x2572e6(0x14d)]=PackageExportService;