const a359_0x9c828=a359_0x2718;(function(_0x43f96a,_0x4e2c6d){const _0x5d7e27=a359_0x2718,_0x1665af=_0x43f96a();while(!![]){try{const _0x2baf70=parseInt(_0x5d7e27(0xed))/0x1*(parseInt(_0x5d7e27(0x100))/0x2)+-parseInt(_0x5d7e27(0x105))/0x3+-parseInt(_0x5d7e27(0x133))/0x4+-parseInt(_0x5d7e27(0x119))/0x5+parseInt(_0x5d7e27(0x12f))/0x6+-parseInt(_0x5d7e27(0x134))/0x7+parseInt(_0x5d7e27(0x104))/0x8*(-parseInt(_0x5d7e27(0x11f))/0x9);if(_0x2baf70===_0x4e2c6d)break;else _0x1665af['push'](_0x1665af['shift']());}catch(_0x1c7d24){_0x1665af['push'](_0x1665af['shift']());}}}(a359_0x2b98,0x1c4fa));function a359_0x2718(_0x368202,_0x3b7350){const _0x203bd1=a359_0x2b98();return a359_0x2718=function(_0x3966b2,_0x371efc){_0x3966b2=_0x3966b2-0xea;let _0x2b98bd=_0x203bd1[_0x3966b2];return _0x2b98bd;},a359_0x2718(_0x368202,_0x3b7350);}function a359_0x2b98(){const _0x255edd=['215733ltLpUO','constructor','deleteVeevaObjectRecords','getEndpointArtifactList','ENDPOINT_VQL','join','apply','4304RlCAdF','from','../enums/status.enums','artifacts','filter','parse','VeevaError','loadAsync','deletePackageComponents','responseStatus','log','jszip','outbound_package__v','set','VeevaConstants','Retrieve\x20Outbound\x20Package\x20zip\x20list','package_component__v','search','VeevaResponseStatus','78MaqDTt','getJobResult','Deleting\x20outbound\x20packages.','application/json','224184etKEXD','48372eZdTDq','errors','MAXIMUM_SIZE_OF_PACKAGE','get','_connection','createExportOutboundPackages','createVeevaObjectRecords','Creating\x20outbound\x20packages','_veevaService','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20outbound_package__v\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20CONTAINS\x20(\x27','length','toString','_logger','map','createPackageComponents','rel','executeVQL','Retrieve\x20Jobs\x20Status','fill','ENDPOINT_CREATE_RECORDS','359020jjJwgu','push','arraybuffer','Getting\x20names\x20of\x20outbound\x20packages','\x27,\x27','content-type','18BYhCpd','retrieveVPKList','packageName','defineProperty','post','getPackageNames','ENDPOINT_EXPORT_IMPORT_PACKAGE','(((.+)+)+)+$','application/x-www-form-urlencoded','Adding\x20components\x20to\x20outbound\x20package','Removing\x20components\x20from\x20outbound\x20packages.','ceil','name__v','../classes/errors/veeva-error','createOutboundPackages','all','1350552ZVFAtT','../constants/veeva.constants','deleteOutboundPackages','links','408772kDIFbD'];a359_0x2b98=function(){return _0x255edd;};return a359_0x2b98();}const a359_0x371efc=(function(){let _0x324c07=!![];return function(_0x3a44a6,_0x587a15){const _0x48ab3c=_0x324c07?function(){const _0x20b240=a359_0x2718;if(_0x587a15){const _0x1d8e00=_0x587a15[_0x20b240(0xec)](_0x3a44a6,arguments);return _0x587a15=null,_0x1d8e00;}}:function(){};return _0x324c07=![],_0x48ab3c;};}()),a359_0x3966b2=a359_0x371efc(this,function(){const _0x2d32fe=a359_0x2718;return a359_0x3966b2['toString']()[_0x2d32fe(0xfe)](_0x2d32fe(0x126))[_0x2d32fe(0x110)]()[_0x2d32fe(0x135)](a359_0x3966b2)[_0x2d32fe(0xfe)](_0x2d32fe(0x126));});a359_0x3966b2();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x593b3d){return _0x593b3d&&_0x593b3d['__esModule']?_0x593b3d:{'default':_0x593b3d};};Object[a359_0x9c828(0x122)](exports,'__esModule',{'value':!![]}),exports['PackageExportService']=void 0x0;const veeva_constants_1=require(a359_0x9c828(0x130)),jszip_1=__importDefault(require(a359_0x9c828(0xf8))),status_enums_1=require(a359_0x9c828(0xef)),veeva_error_1=require(a359_0x9c828(0x12c));class PackageExportService{constructor({veevaService:_0x4e7dde,connection:_0x21088e,logger:_0x537dfa}){const _0x5980bf=a359_0x9c828;this[_0x5980bf(0x10d)]=_0x4e7dde,this[_0x5980bf(0x109)]=_0x21088e,this['_logger']=_0x537dfa;}async[a359_0x9c828(0x12d)](_0x16a806,_0x59c134){const _0x210fd9=a359_0x9c828;this[_0x210fd9(0x111)][_0x210fd9(0xf7)](_0x210fd9(0x10c));const _0x43bc42=veeva_constants_1[_0x210fd9(0xfb)][_0x210fd9(0x118)]+_0x210fd9(0xf9),_0x114520=new Array(_0x16a806)[_0x210fd9(0x117)]({'summary__v':_0x59c134,'object_type__v.api__name__v':'migration__sys'});return await this['_veevaService'][_0x210fd9(0x10b)](_0x43bc42,_0x114520);}async[a359_0x9c828(0x113)](_0x43a929,_0x31ce82){const _0x399c5=a359_0x9c828;this['_logger'][_0x399c5(0xf7)](_0x399c5(0x128));const _0x3baba=veeva_constants_1[_0x399c5(0xfb)][_0x399c5(0x118)]+_0x399c5(0xfd),_0xdc06e2=_0x43a929[_0x399c5(0x112)]((_0x32cbc0,_0x7d14d8)=>({'vault_component__v':_0x32cbc0['id'],'outbound_package__v':_0x31ce82[Math[_0x399c5(0x12a)]((_0x7d14d8+0x1)/veeva_constants_1[_0x399c5(0xfb)][_0x399c5(0x107)])-0x1]}));return await this[_0x399c5(0x10d)][_0x399c5(0x10b)](_0x3baba,_0xdc06e2);}async[a359_0x9c828(0x124)](_0x35a137){const _0x15fc32=a359_0x9c828;this[_0x15fc32(0x111)][_0x15fc32(0xf7)](_0x15fc32(0x11c));const _0x189875=_0x15fc32(0x10e)+_0x35a137[_0x15fc32(0xeb)](_0x15fc32(0x11d))+'\x27)',_0x3e7d41=veeva_constants_1[_0x15fc32(0xfb)][_0x15fc32(0xea)]+_0x189875,_0x57abc9=await this[_0x15fc32(0x10d)][_0x15fc32(0x115)](_0x3e7d41);return _0x57abc9['reduce']((_0x138311,_0x457e55)=>_0x138311[_0x15fc32(0xfa)](_0x457e55['id'],_0x457e55[_0x15fc32(0x12b)]),new Map());}async[a359_0x9c828(0x10a)](_0x458b56){const _0x493d2d=a359_0x9c828;this[_0x493d2d(0x111)][_0x493d2d(0xf7)]('Create\x20Export\x20outbound\x20packages.');const _0x10dd02=[],_0x42b24d=_0x458b56[_0x493d2d(0x112)](_0x428745=>{const _0x213e3b=_0x493d2d;return this[_0x213e3b(0x109)][_0x213e3b(0x123)](veeva_constants_1[_0x213e3b(0xfb)][_0x213e3b(0x125)],encodeURI(_0x213e3b(0x121))+'='+encodeURI(_0x428745),{'headers':{'Content-Type':_0x213e3b(0x127)}});}),_0x2a04e5=await Promise[_0x493d2d(0x12e)](_0x42b24d);for(const {data:_0x3efb10}of _0x2a04e5){if(_0x3efb10[_0x493d2d(0xf6)]===status_enums_1[_0x493d2d(0xff)]['SUCCESS']){const {url:_0x217e82}=_0x3efb10;_0x10dd02[_0x493d2d(0x11a)](_0x217e82);}else throw new veeva_error_1[(_0x493d2d(0xf3))](_0x3efb10[_0x493d2d(0x106)]);}return _0x10dd02;}async[a359_0x9c828(0x137)](_0x24eee7){const _0x93ad65=a359_0x9c828;this[_0x93ad65(0x111)][_0x93ad65(0xf7)](_0x93ad65(0x116));const _0x4ee472=[],_0x41d5a5=await this[_0x93ad65(0x10d)][_0x93ad65(0x101)](_0x24eee7);for(const _0xe4cbf8 of _0x41d5a5){const _0x3edef2=_0xe4cbf8[_0x93ad65(0x132)][_0x93ad65(0xf1)](_0x1e1155=>_0x1e1155[_0x93ad65(0x114)]===_0x93ad65(0xf0))[_0x93ad65(0x112)](_0x63c782=>_0x63c782['href']);_0x4ee472['push'](..._0x3edef2);}return _0x4ee472;}async['retrieveVPKList'](_0x5d9c24){const _0x14105c=a359_0x9c828;var _0x127104;const _0x40fac0=[];this[_0x14105c(0x111)][_0x14105c(0xf7)](_0x14105c(0xfc));for(const _0x394c75 of _0x5d9c24){const {data:_0x172b3d,headers:_0x30b7b2}=await this[_0x14105c(0x109)][_0x14105c(0x108)](_0x394c75,{'responseType':_0x14105c(0x11b)}),_0x2b9e9f=(_0x127104=_0x30b7b2[_0x14105c(0x11e)])===null||_0x127104===void 0x0?void 0x0:_0x127104['includes'](_0x14105c(0x103));if(!_0x2b9e9f){const _0x1f5e95=_0x172b3d,_0x347cc3=new jszip_1['default']();await _0x347cc3[_0x14105c(0xf4)](_0x1f5e95),_0x40fac0[_0x14105c(0x11a)](_0x347cc3);}else{const _0x353aa5=JSON[_0x14105c(0xf2)](_0x172b3d);throw new veeva_error_1[(_0x14105c(0xf3))](_0x353aa5[_0x14105c(0x106)]);}}return _0x40fac0;}async[a359_0x9c828(0xf5)](_0x2be4a9){const _0x4bf772=a359_0x9c828;this[_0x4bf772(0x111)]['log'](_0x4bf772(0x129));const _0x594f9b=veeva_constants_1[_0x4bf772(0xfb)][_0x4bf772(0x118)]+'package_component__v';await this[_0x4bf772(0x10d)]['deleteVeevaObjectRecords'](_0x594f9b,_0x2be4a9);}async[a359_0x9c828(0x131)](_0xaba7ed){const _0x41000e=a359_0x9c828;this[_0x41000e(0x111)]['log'](_0x41000e(0x102));const _0x46f9d8=veeva_constants_1['VeevaConstants']['ENDPOINT_CREATE_RECORDS']+_0x41000e(0xf9);await this[_0x41000e(0x10d)][_0x41000e(0x136)](_0x46f9d8,_0xaba7ed);}async['export'](_0x4ee85f,_0x29d78e){const _0x262bdb=a359_0x9c828,_0x1eb82e=await this[_0x262bdb(0x12d)](Math[_0x262bdb(0x12a)](_0x4ee85f[_0x262bdb(0x10f)]/veeva_constants_1[_0x262bdb(0xfb)][_0x262bdb(0x107)]),_0x29d78e),_0x42803a=await this[_0x262bdb(0x113)](_0x4ee85f,_0x1eb82e),_0x362c1d=await this[_0x262bdb(0x124)](_0x1eb82e),_0x4a7c04=await this[_0x262bdb(0x10a)](Array[_0x262bdb(0xee)](_0x362c1d['values']())),_0x3941f9=await this['getEndpointArtifactList'](_0x4a7c04),_0x1eab77=await this[_0x262bdb(0x120)](_0x3941f9);return await this['deletePackageComponents'](_0x42803a),await this['deleteOutboundPackages'](_0x1eb82e),_0x1eab77;}}exports['PackageExportService']=PackageExportService;