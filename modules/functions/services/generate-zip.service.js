function a86_0x59ec(){const _0x324e7c=['destructiveChangesPost.xml','Profile','../../../constants','4018710QaGRXD','files','ComponentsApi','start','/sobjects/Attachment','DEPLOYZIP','11HKWpfW','search','7eTzVHc','replace','__esModule','find','2791020hyfmbs','cwd','xml2js','orgId','map','(((.+)+)+)+$','async','2241184QdeTDp','createZip','src','type','PermissionSet','Builder','writeFile','fileName','.temp','post','__importDefault','length','unzip','after\x20create\x20second\x20zip','values','dir','keys','substring','toString','/services/data/','http://soap.sforce.com/2006/04/metadata','SALESFORCE_API_VERSION','generateAsync','Body','fetchAttachmentBody','generateAndDeployZip','toBuffer','splitZip','path','types','4174371WDqmCP','fetchComponentsDetailsByComponentsHistory','BUILD','package.xml','367848MCnKag','retrieveAttachments','extractComponentPermissions','285188dMJoHq','MAX_ZIP_SIZE','log','26hJCjpF','adm-zip','exists','../utils/extract-component-permissions','default','ParentId','join','Component__r','removeNamespacePrefix','Component_Name__c','../utils/components-api','Name','addLocalFolder','file','1.0','15KZCXpD','text','apply','buildObject','constructor','after\x20create\x20zip','Zip','then','Package','1389xqDANo','filter','push','base64','../../shared/utils/fetch-attachments','destructiveChangesPre.xml','UTF-8','fileType','body'];a86_0x59ec=function(){return _0x324e7c;};return a86_0x59ec();}const a86_0x1dda91=a86_0x3acd;(function(_0x251a41,_0x43135c){const _0x3473a7=a86_0x3acd,_0x345b85=_0x251a41();while(!![]){try{const _0x5168f5=-parseInt(_0x3473a7(0x128))/0x1*(-parseInt(_0x3473a7(0x110))/0x2)+-parseInt(_0x3473a7(0x11f))/0x3*(-parseInt(_0x3473a7(0x10d))/0x4)+parseInt(_0x3473a7(0x140))/0x5+parseInt(_0x3473a7(0x10a))/0x6*(-parseInt(_0x3473a7(0x13c))/0x7)+parseInt(_0x3473a7(0x147))/0x8+-parseInt(_0x3473a7(0x106))/0x9+parseInt(_0x3473a7(0x134))/0xa*(-parseInt(_0x3473a7(0x13a))/0xb);if(_0x5168f5===_0x43135c)break;else _0x345b85['push'](_0x345b85['shift']());}catch(_0x56bbd1){_0x345b85['push'](_0x345b85['shift']());}}}(a86_0x59ec,0x45cc8));const a86_0x41bd17=(function(){let _0x552a2d=!![];return function(_0x3f6236,_0x4d1b06){const _0x1e3749=_0x552a2d?function(){const _0x8234e8=a86_0x3acd;if(_0x4d1b06){const _0xa1ae7c=_0x4d1b06[_0x8234e8(0x121)](_0x3f6236,arguments);return _0x4d1b06=null,_0xa1ae7c;}}:function(){};return _0x552a2d=![],_0x1e3749;};}()),a86_0x3cb485=a86_0x41bd17(this,function(){const _0x3b4a8b=a86_0x3acd;return a86_0x3cb485[_0x3b4a8b(0xfa)]()[_0x3b4a8b(0x13b)](_0x3b4a8b(0x145))[_0x3b4a8b(0xfa)]()[_0x3b4a8b(0x123)](a86_0x3cb485)[_0x3b4a8b(0x13b)]('(((.+)+)+)+$');});a86_0x3cb485();'use strict';var __importDefault=this&&this[a86_0x1dda91(0xf2)]||function(_0x4b8ce9){const _0x4f5a7b=a86_0x1dda91;return _0x4b8ce9&&_0x4b8ce9[_0x4f5a7b(0x13e)]?_0x4b8ce9:{'default':_0x4b8ce9};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['generateAndDeployZip']=void 0x0;const constants_1=require(a86_0x1dda91(0x133)),path_1=__importDefault(require(a86_0x1dda91(0x104))),extract_component_permissions_1=require(a86_0x1dda91(0x113)),xml2js_1=require(a86_0x1dda91(0x142)),zip_1=require('../../git/parsers/utils/zip'),mdapi_1=require('../../git/parsers/mdapi'),fs_internal_1=require('../../git/internal/fs.internal'),promises_1=require('fs/promises'),components_api_1=require(a86_0x1dda91(0x11a)),adm_zip_1=__importDefault(require(a86_0x1dda91(0x111))),uuid_1=require('uuid'),fetch_attachments_1=require(a86_0x1dda91(0x12c)),DESTRUCTIVE_CHANGES_PER_NAME=a86_0x1dda91(0x12d),DESTRUCTIVE_CHANGES_POST_NAME=a86_0x1dda91(0x131),DEPLOY_DIR_NAME=a86_0x1dda91(0x139);async function generateAndDeployZip({attachmentsId:_0x5afcbc,isExtractComponentsPermissions:_0x3aa60e,preDestructiveAttachmentId:_0x56b421,postDestructiveAttachmentId:_0x6bed2,branchId:_0xdbc94d,credentials:_0x4d4fc9,metadataLogId:_0xadfdd9,environments:_0x905812,metaTypes:_0x12db94},_0x56d319){const _0x565f47=a86_0x1dda91,_0x397558=(0x0,uuid_1['v4'])();try{const _0x3a6dd5=await(0x0,fetch_attachments_1['fetchAttachmentsDetailsById'])(_0x56d319,_0x5afcbc),_0x21d510=_0x3a6dd5['reduce']((_0x614cf3,_0xf7ab47)=>({..._0x614cf3,[_0xf7ab47['Id']]:_0xf7ab47[_0x565f47(0x11b)]}),{}),_0x4fd3dc=await getComponents(_0x3a6dd5,_0x56d319,_0x21d510),_0x667afd=await components_api_1[_0x565f47(0x136)][_0x565f47(0x107)](_0x56d319,_0x3a6dd5[_0x565f47(0x144)](({ParentId:_0x497529})=>_0x497529))[_0x565f47(0x126)](_0xae741a=>components_api_1[_0x565f47(0x136)][_0x565f47(0x118)](_0xae741a));if(_0x3aa60e){const _0x357448=_0x4fd3dc[_0x565f47(0x129)](({fileType:_0x4bd638})=>_0x4bd638===_0x565f47(0x132)||_0x4bd638===_0x565f47(0x14b));await removePermission(_0x357448,_0x667afd);}await replaceEnvironments(_0x12db94,_0x905812,_0x4fd3dc),await writeZip(_0x4fd3dc,_0x397558),await generateAndWritePackageXML(_0x3a6dd5,_0x667afd,_0x397558);_0x56b421&&await saveDestructiveChanges(_0x56d319,_0x56b421,DESTRUCTIVE_CHANGES_PER_NAME,_0x397558);_0x6bed2&&await saveDestructiveChanges(_0x56d319,_0x6bed2,DESTRUCTIVE_CHANGES_POST_NAME,_0x397558);const _0xf898aa=(await createDeployZip(_0x397558)['then'](_0x5a5bcb=>{return _0x5a5bcb;}))[_0x565f47(0x102)]()[_0x565f47(0xfa)](_0x565f47(0x12b));console[_0x565f47(0x10f)](_0x565f47(0x124));const _0x433c3f=_0xf898aa[_0x565f47(0xf3)];if(_0x433c3f>=components_api_1[_0x565f47(0x10e)]){const _0x2222d7=await createDeployZip(_0x397558);console[_0x565f47(0x10f)](_0x565f47(0xf5));const [_0x5cba03,_0x2b4f9a]=await components_api_1[_0x565f47(0x136)][_0x565f47(0x103)](_0x2222d7,_0x433c3f),_0x45b4af=await insertZip(_0x56d319,_0xdbc94d,_0x4d4fc9['orgId'],_0xadfdd9,_0x5cba03[_0x565f47(0x102)]()[_0x565f47(0xfa)](_0x565f47(0x12b))),_0x2a7519=await insertZip(_0x56d319,_0xdbc94d,_0x4d4fc9[_0x565f47(0x143)],_0xadfdd9,_0x2b4f9a['toBuffer']()[_0x565f47(0xfa)]('base64'));return _0x45b4af+','+_0x2a7519;}else return await insertZip(_0x56d319,_0xdbc94d,_0x4d4fc9[_0x565f47(0x143)],_0xadfdd9,_0xf898aa);}catch(_0x3496d7){throw _0x3496d7;}finally{if(await fs_internal_1['FS'][_0x565f47(0x112)](path_1[_0x565f47(0x114)][_0x565f47(0x116)](process[_0x565f47(0x141)](),_0x565f47(0x14f),_0x397558)))await(0x0,promises_1['rm'])(path_1['default'][_0x565f47(0x116)](process[_0x565f47(0x141)](),_0x565f47(0x14f),_0x397558),{'recursive':!![]});}}exports[a86_0x1dda91(0x101)]=generateAndDeployZip;async function getComponents(_0x333bc2,_0x3382c3,_0x58a7b2){const _0x15317d=a86_0x1dda91,_0x2adcf8=[],_0x214f9c=await(0x0,fetch_attachments_1[_0x15317d(0x10b)])(_0x333bc2,_0x3382c3);return await getComponentFromZip(_0x214f9c,_0x58a7b2)['then'](_0x59b78e=>{const _0x35bf7e=_0x15317d;_0x2adcf8[_0x35bf7e(0x12a)](..._0x59b78e);}),_0x2adcf8;}async function getComponentFromZip(_0x3d455f,_0x5f1515){const _0x1c4212=a86_0x1dda91,_0x5a144e=[];for(const _0x1e388f of _0x3d455f){const _0x433e14=await zip_1[_0x1c4212(0x125)][_0x1c4212(0xf4)](_0x1e388f[_0x1c4212(0xf6)][_0x1c4212(0xff)]);for(const _0xd59748 in _0x433e14[_0x1c4212(0x135)]){!_0x433e14[_0x1c4212(0x135)][_0xd59748][_0x1c4212(0xf7)]&&_0x5a144e[_0x1c4212(0x12a)]({'fileName':_0xd59748[_0x1c4212(0xf9)](_0xd59748['indexOf']('/')+0x1),'fileType':_0x5f1515[_0x1e388f['id']],'body':_0x1e388f[_0x1c4212(0xf6)][_0x1c4212(0xff)]});}}return _0x5a144e;}async function removePermission(_0x3d1d68,_0x455cd4){const _0x3df19e=a86_0x1dda91;for(const _0x1e5646 of _0x3d1d68){const _0x2b83ef=await zip_1[_0x3df19e(0x125)][_0x3df19e(0xf4)](_0x1e5646[_0x3df19e(0x130)]),_0x582b00=[];for(const _0x1b0621 in _0x2b83ef[_0x3df19e(0x135)]){!_0x2b83ef[_0x3df19e(0x135)][_0x1b0621]['dir']&&_0x582b00['push']({'fileName':_0x1b0621,'body':await _0x2b83ef[_0x3df19e(0x135)][_0x1b0621][_0x3df19e(0x146)](_0x3df19e(0x120))});}const _0x5491a1=await(0x0,extract_component_permissions_1[_0x3df19e(0x10c)])(_0x582b00[0x0][_0x3df19e(0x130)][_0x3df19e(0xfa)](),_0x455cd4,_0x1e5646[_0x3df19e(0x12f)]),_0x431619=new xml2js_1[(_0x3df19e(0x14c))]({'xmldec':{'version':'1.0','encoding':_0x3df19e(0x12e)}}),_0x2a24cc=_0x431619[_0x3df19e(0x122)](_0x5491a1),_0x25067c=zip_1[_0x3df19e(0x125)][_0x3df19e(0x148)]();_0x25067c[_0x3df19e(0x11d)](_0x582b00[0x0][_0x3df19e(0x14e)],_0x2a24cc),_0x1e5646[_0x3df19e(0x130)]=await _0x25067c[_0x3df19e(0xfe)]({'type':'base64','compression':'DEFLATE','compressionOptions':{'level':0x6}});}}async function replaceEnvironments(_0x1f1394,_0x58cb56,_0xe05bd3){const _0x5ac7d4=a86_0x1dda91;for(const _0x147d3c of _0xe05bd3){if(_0x1f1394['every'](_0x35ad39=>_0x35ad39!==_0x147d3c[_0x5ac7d4(0x12f)]))continue;const _0x5ac6f9=await zip_1[_0x5ac7d4(0x125)][_0x5ac7d4(0xf4)](_0x147d3c[_0x5ac7d4(0x130)]);for(const _0x96ddb8 in _0x5ac6f9[_0x5ac7d4(0x135)]){if(!_0x5ac6f9[_0x5ac7d4(0x135)][_0x96ddb8]['dir']){let _0x3f297d=await _0x5ac6f9['files'][_0x96ddb8][_0x5ac7d4(0x146)](_0x5ac7d4(0x120));for(const _0x390dd3 of Object[_0x5ac7d4(0xf8)](_0x58cb56)){const _0x232db5=new RegExp('%%'+_0x390dd3+'%%','g');_0x3f297d=_0x3f297d[_0x5ac7d4(0x13d)](_0x232db5,_0x58cb56[_0x390dd3]);}_0x5ac6f9['file'](_0x96ddb8,_0x3f297d);}}_0x147d3c[_0x5ac7d4(0x130)]=await _0x5ac6f9[_0x5ac7d4(0xfe)]({'type':_0x5ac7d4(0x12b),'compression':'DEFLATE','compressionOptions':{'level':0x6}});}}async function writeZip(_0x48146b,_0x209017){const _0xd21902=a86_0x1dda91,_0x5052b9=new mdapi_1['MDApiWriter']({'components':_0x48146b,'sourceDir':path_1[_0xd21902(0x114)][_0xd21902(0x116)](process['cwd'](),'.temp',_0x209017,DEPLOY_DIR_NAME,'src'),'skipChildErrors':![]});await _0x5052b9[_0xd21902(0x137)]();}function a86_0x3acd(_0x384097,_0x238ab0){const _0x258729=a86_0x59ec();return a86_0x3acd=function(_0x3cb485,_0x41bd17){_0x3cb485=_0x3cb485-0xf1;let _0x59ec6b=_0x258729[_0x3cb485];return _0x59ec6b;},a86_0x3acd(_0x384097,_0x238ab0);}async function generateAndWritePackageXML(_0x5f433a,_0x4b2676,_0x521bd3){const _0x1fce3e=a86_0x1dda91,_0x5e3ed4=getComponentsTypeAndName(_0x5f433a,_0x4b2676),_0x5debe1=[...new Set(_0x5e3ed4[_0x1fce3e(0x144)](_0x4ea4c2=>_0x4ea4c2[_0x1fce3e(0x14a)]))],_0x28311f={'Package':{'$':{'xmlns':_0x1fce3e(0xfc)},'types':[],'version':''+constants_1[_0x1fce3e(0xfd)][_0x1fce3e(0xf9)](0x1)}};for(const _0x1465f5 of _0x5debe1){const _0x2a2996=_0x5e3ed4[_0x1fce3e(0x129)](_0x440831=>_0x440831[_0x1fce3e(0x14a)]===_0x1465f5)[_0x1fce3e(0x144)](_0x3b4df8=>_0x3b4df8['name']),_0x59ede1={'members':_0x2a2996,'name':_0x1465f5};_0x28311f[_0x1fce3e(0x127)][_0x1fce3e(0x105)][_0x1fce3e(0x12a)](_0x59ede1);}const _0x1f29dc=new xml2js_1['Builder']({'xmldec':{'version':_0x1fce3e(0x11e),'encoding':_0x1fce3e(0x12e)}}),_0x36da78=_0x1f29dc[_0x1fce3e(0x122)](_0x28311f);await fs_internal_1['FS'][_0x1fce3e(0x14d)](path_1[_0x1fce3e(0x114)][_0x1fce3e(0x116)](process['cwd'](),_0x1fce3e(0x14f),_0x521bd3,DEPLOY_DIR_NAME,_0x1fce3e(0x149),_0x1fce3e(0x109)),_0x36da78);}function getComponentsTypeAndName(_0x1fd3d1,_0x11e3e7){return _0x1fd3d1['reduce']((_0x22070e,_0x355512)=>{const _0x19dd16=a86_0x3acd,_0x5ca754=_0x11e3e7[_0x19dd16(0x13f)](_0x53cb2c=>_0x53cb2c['Id']===_0x355512[_0x19dd16(0x115)]);return _0x5ca754&&_0x22070e['push']({'name':_0x5ca754[_0x19dd16(0x117)][_0x19dd16(0x119)],'type':_0x355512[_0x19dd16(0x11b)]}),_0x22070e;},[]);}async function saveDestructiveChanges(_0x2ae0f4,_0x1c2108,_0x1513f0,_0x6801ad){const _0xa4a52=a86_0x1dda91,_0xa52f7f=(await(0x0,fetch_attachments_1[_0xa4a52(0x100)])(_0x2ae0f4,_0x1c2108))[_0xa4a52(0xfa)]();await fs_internal_1['FS']['writeFile'](path_1[_0xa4a52(0x114)][_0xa4a52(0x116)](process[_0xa4a52(0x141)](),_0xa4a52(0x14f),_0x6801ad,DEPLOY_DIR_NAME,_0xa4a52(0x149),_0x1513f0),_0xa52f7f);}async function createDeployZip(_0x326cd7){const _0x9163f2=a86_0x1dda91,_0x167787=new adm_zip_1[(_0x9163f2(0x114))]();return await _0x167787[_0x9163f2(0x11c)](path_1['default'][_0x9163f2(0x116)](process[_0x9163f2(0x141)](),_0x9163f2(0x14f),_0x326cd7,DEPLOY_DIR_NAME)),_0x167787;}async function insertZip(_0x1b75fc,_0x20cba7,_0x41ed4e,_0x3a4f75,_0x5b05c4){const _0x193022=a86_0x1dda91,_0x490f62={'ParentId':_0x20cba7,'Name':_0x193022(0x108)+_0x41ed4e,'Description':'BUILD'+_0x3a4f75,'Body':_0x5b05c4},{data:_0x3472b4}=await _0x1b75fc[_0x193022(0xf1)](_0x193022(0xfb)+constants_1[_0x193022(0xfd)]+_0x193022(0x138),_0x490f62);return _0x3472b4['id'];}