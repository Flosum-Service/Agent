function a86_0x46b4(_0x18f2ba,_0x387697){const _0x365218=a86_0x514a();return a86_0x46b4=function(_0x3e3326,_0xaf5839){_0x3e3326=_0x3e3326-0xd9;let _0x514a76=_0x365218[_0x3e3326];return _0x514a76;},a86_0x46b4(_0x18f2ba,_0x387697);}const a86_0x5e4fc3=a86_0x46b4;(function(_0x23a9e3,_0x2833e3){const _0x54675c=a86_0x46b4,_0x593af0=_0x23a9e3();while(!![]){try{const _0x3b7b0f=-parseInt(_0x54675c(0x12f))/0x1+parseInt(_0x54675c(0x103))/0x2+parseInt(_0x54675c(0x104))/0x3+-parseInt(_0x54675c(0xf8))/0x4*(parseInt(_0x54675c(0x12c))/0x5)+-parseInt(_0x54675c(0x131))/0x6*(parseInt(_0x54675c(0x113))/0x7)+parseInt(_0x54675c(0x111))/0x8+parseInt(_0x54675c(0x110))/0x9*(parseInt(_0x54675c(0xf5))/0xa);if(_0x3b7b0f===_0x2833e3)break;else _0x593af0['push'](_0x593af0['shift']());}catch(_0x56ecc7){_0x593af0['push'](_0x593af0['shift']());}}}(a86_0x514a,0xe562c));const a86_0xaf5839=(function(){let _0x10cdb8=!![];return function(_0x553fd6,_0x36c86a){const _0x44e297=_0x10cdb8?function(){const _0x1efeb2=a86_0x46b4;if(_0x36c86a){const _0xf82c11=_0x36c86a[_0x1efeb2(0xdd)](_0x553fd6,arguments);return _0x36c86a=null,_0xf82c11;}}:function(){};return _0x10cdb8=![],_0x44e297;};}()),a86_0x3e3326=a86_0xaf5839(this,function(){const _0x2b3d95=a86_0x46b4;return a86_0x3e3326['toString']()['search'](_0x2b3d95(0x109))[_0x2b3d95(0x126)]()[_0x2b3d95(0x11a)](a86_0x3e3326)['search'](_0x2b3d95(0x109));});function a86_0x514a(){const _0x108864=['MDApiWriter','every','toString','substring','../utils/components-api','../../shared/utils/fetch-attachments','.temp','writeFile','2985420lKXlgi','files','ComponentsApi','983917RPakJg','/sobjects/Attachment','6DnjCYF','BUILD','Profile','base64','MAX_ZIP_SIZE','Component_Name__c','removeNamespacePrefix','text','file','apply','keys','__esModule','http://soap.sforce.com/2006/04/metadata','fileType','src','map','splitZip','orgId','dir','replace','fetchAttachmentsDetailsById','fetchAttachmentBody','UTF-8','Body','uuid','1.0','Name','types','type','ParentId','fetchComponentsDetailsByComponentsHistory','SALESFORCE_API_VERSION','extractComponentPermissions','180FgYEAm','destructiveChangesPre.xml','join','4ftDztq','start','buildObject','name','adm-zip','default','../../git/parsers/mdapi','after\x20create\x20zip','generateAsync','cwd','generateAndDeployZip','1423428fycwIV','558699EqTpZO','../../../constants','../../git/parsers/utils/zip','Package','path','(((.+)+)+)+$','log','../../git/internal/fs.internal','toBuffer','body','DEFLATE','values','1129869JrIoPt','4849640iPaZxB','exists','8703275lGTejq','length','reduce','post','fs/promises','Zip','package.xml','constructor','xml2js','PermissionSet','unzip','push','Builder','defineProperty','../utils/extract-component-permissions','retrieveAttachments','then'];a86_0x514a=function(){return _0x108864;};return a86_0x514a();}a86_0x3e3326();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x129452){return _0x129452&&_0x129452['__esModule']?_0x129452:{'default':_0x129452};};Object[a86_0x5e4fc3(0x120)](exports,a86_0x5e4fc3(0xdf),{'value':!![]}),exports[a86_0x5e4fc3(0x102)]=void 0x0;const constants_1=require(a86_0x5e4fc3(0x105)),path_1=__importDefault(require(a86_0x5e4fc3(0x108))),extract_component_permissions_1=require(a86_0x5e4fc3(0x121)),xml2js_1=require(a86_0x5e4fc3(0x11b)),zip_1=require(a86_0x5e4fc3(0x106)),mdapi_1=require(a86_0x5e4fc3(0xfe)),fs_internal_1=require(a86_0x5e4fc3(0x10b)),promises_1=require(a86_0x5e4fc3(0x117)),components_api_1=require(a86_0x5e4fc3(0x128)),adm_zip_1=__importDefault(require(a86_0x5e4fc3(0xfc))),uuid_1=require(a86_0x5e4fc3(0xec)),fetch_attachments_1=require(a86_0x5e4fc3(0x129)),DESTRUCTIVE_CHANGES_PER_NAME=a86_0x5e4fc3(0xf6),DESTRUCTIVE_CHANGES_POST_NAME='destructiveChangesPost.xml',DEPLOY_DIR_NAME='DEPLOYZIP';async function generateAndDeployZip({attachmentsId:_0x593aa1,isExtractComponentsPermissions:_0xea5cfc,preDestructiveAttachmentId:_0x4067fd,postDestructiveAttachmentId:_0x10c3d4,branchId:_0x27cf84,credentials:_0x421322,metadataLogId:_0x49909a,environments:_0x3fefe7,metaTypes:_0x423d8a},_0x4a13bf){const _0x38df31=a86_0x5e4fc3,_0xfc296a=(0x0,uuid_1['v4'])();try{const _0x10587b=await(0x0,fetch_attachments_1[_0x38df31(0xe8)])(_0x4a13bf,_0x593aa1),_0x4df48a=_0x10587b['reduce']((_0x23ab7f,_0x1313bf)=>({..._0x23ab7f,[_0x1313bf['Id']]:_0x1313bf[_0x38df31(0xee)]}),{}),_0x52dd85=await getComponents(_0x10587b,_0x4a13bf,_0x4df48a),_0x4c641e=await components_api_1[_0x38df31(0x12e)][_0x38df31(0xf2)](_0x4a13bf,_0x10587b[_0x38df31(0xe3)](({ParentId:_0x5ed8a4})=>_0x5ed8a4))['then'](_0x51f7d0=>components_api_1[_0x38df31(0x12e)][_0x38df31(0xda)](_0x51f7d0));if(_0xea5cfc){const _0xde643e=_0x52dd85['filter'](({fileType:_0x34f911})=>_0x34f911===_0x38df31(0x133)||_0x34f911===_0x38df31(0x11c));await removePermission(_0xde643e,_0x4c641e);}await replaceEnvironments(_0x423d8a,_0x3fefe7,_0x52dd85),await writeZip(_0x52dd85,_0xfc296a),await generateAndWritePackageXML(_0x10587b,_0x4c641e,_0xfc296a);_0x4067fd&&await saveDestructiveChanges(_0x4a13bf,_0x4067fd,DESTRUCTIVE_CHANGES_PER_NAME,_0xfc296a);_0x10c3d4&&await saveDestructiveChanges(_0x4a13bf,_0x10c3d4,DESTRUCTIVE_CHANGES_POST_NAME,_0xfc296a);const _0x4ba3cf=(await createDeployZip(_0xfc296a)[_0x38df31(0x123)](_0x3d7d1c=>{return _0x3d7d1c;}))[_0x38df31(0x10c)]()[_0x38df31(0x126)]('base64');console[_0x38df31(0x10a)](_0x38df31(0xff));const _0x5c6e02=_0x4ba3cf[_0x38df31(0x114)];if(_0x5c6e02>=components_api_1[_0x38df31(0x135)]){const _0x535d3f=await createDeployZip(_0xfc296a);console['log']('after\x20create\x20second\x20zip');const [_0x1d403e,_0x3ef5c5]=await components_api_1[_0x38df31(0x12e)][_0x38df31(0xe4)](_0x535d3f,_0x5c6e02),_0x218698=await insertZip(_0x4a13bf,_0x27cf84,_0x421322['orgId'],_0x49909a,_0x1d403e[_0x38df31(0x10c)]()[_0x38df31(0x126)](_0x38df31(0x134))),_0x28eafa=await insertZip(_0x4a13bf,_0x27cf84,_0x421322[_0x38df31(0xe5)],_0x49909a,_0x3ef5c5['toBuffer']()[_0x38df31(0x126)]('base64'));return _0x218698+','+_0x28eafa;}else return await insertZip(_0x4a13bf,_0x27cf84,_0x421322[_0x38df31(0xe5)],_0x49909a,_0x4ba3cf);}catch(_0x5aa48b){throw _0x5aa48b;}finally{if(await fs_internal_1['FS'][_0x38df31(0x112)](path_1['default'][_0x38df31(0xf7)](process[_0x38df31(0x101)](),'.temp',_0xfc296a)))await(0x0,promises_1['rm'])(path_1[_0x38df31(0xfd)][_0x38df31(0xf7)](process['cwd'](),_0x38df31(0x12a),_0xfc296a),{'recursive':!![]});}}exports[a86_0x5e4fc3(0x102)]=generateAndDeployZip;async function getComponents(_0x2aa8e3,_0x4baa4a,_0x2bcddb){const _0x5c753a=a86_0x5e4fc3,_0x10bf59=[],_0x264173=await(0x0,fetch_attachments_1[_0x5c753a(0x122)])(_0x2aa8e3,_0x4baa4a);return await getComponentFromZip(_0x264173,_0x2bcddb)[_0x5c753a(0x123)](_0xf248bc=>{const _0x7c1da6=_0x5c753a;_0x10bf59[_0x7c1da6(0x11e)](..._0xf248bc);}),_0x10bf59;}async function getComponentFromZip(_0x2a745b,_0x217e4b){const _0x145998=a86_0x5e4fc3,_0x45a87e=[];for(const _0x4bc577 of _0x2a745b){const _0xf92443=await zip_1['Zip'][_0x145998(0x11d)](_0x4bc577[_0x145998(0x10f)]['Body']);for(const _0x38c667 in _0xf92443[_0x145998(0x12d)]){!_0xf92443[_0x145998(0x12d)][_0x38c667]['dir']&&_0x45a87e[_0x145998(0x11e)]({'fileName':_0x38c667['substring'](_0x38c667['indexOf']('/')+0x1),'fileType':_0x217e4b[_0x4bc577['id']],'body':_0x4bc577[_0x145998(0x10f)][_0x145998(0xeb)]});}}return _0x45a87e;}async function removePermission(_0x266e9f,_0x5d5ef1){const _0x25b1ec=a86_0x5e4fc3;for(const _0x47236f of _0x266e9f){const _0x346120=await zip_1['Zip']['unzip'](_0x47236f['body']),_0x405918=[];for(const _0x1fe4f6 in _0x346120['files']){!_0x346120[_0x25b1ec(0x12d)][_0x1fe4f6][_0x25b1ec(0xe6)]&&_0x405918['push']({'fileName':_0x1fe4f6,'body':await _0x346120['files'][_0x1fe4f6]['async'](_0x25b1ec(0xdb))});}const _0x29ad5e=await(0x0,extract_component_permissions_1[_0x25b1ec(0xf4)])(_0x405918[0x0][_0x25b1ec(0x10d)]['toString'](),_0x5d5ef1,_0x47236f[_0x25b1ec(0xe1)]),_0x67af4d=new xml2js_1[(_0x25b1ec(0x11f))]({'xmldec':{'version':_0x25b1ec(0xed),'encoding':_0x25b1ec(0xea)}}),_0x19227b=_0x67af4d[_0x25b1ec(0xfa)](_0x29ad5e),_0x260d2e=zip_1[_0x25b1ec(0x118)]['createZip']();_0x260d2e[_0x25b1ec(0xdc)](_0x405918[0x0]['fileName'],_0x19227b),_0x47236f[_0x25b1ec(0x10d)]=await _0x260d2e[_0x25b1ec(0x100)]({'type':_0x25b1ec(0x134),'compression':_0x25b1ec(0x10e),'compressionOptions':{'level':0x6}});}}async function replaceEnvironments(_0x38cc96,_0x1f32d8,_0x2a6ea9){const _0x59345d=a86_0x5e4fc3;for(const _0x26ce5a of _0x2a6ea9){if(_0x38cc96[_0x59345d(0x125)](_0x5995c4=>_0x5995c4!==_0x26ce5a[_0x59345d(0xe1)]))continue;const _0x222ef5=await zip_1[_0x59345d(0x118)][_0x59345d(0x11d)](_0x26ce5a['body']);for(const _0x309d13 in _0x222ef5[_0x59345d(0x12d)]){if(!_0x222ef5[_0x59345d(0x12d)][_0x309d13][_0x59345d(0xe6)]){let _0x32a24f=await _0x222ef5[_0x59345d(0x12d)][_0x309d13]['async']('text');for(const _0x3bbf7a of Object[_0x59345d(0xde)](_0x1f32d8)){const _0x398a42=new RegExp('%%'+_0x3bbf7a+'%%','g');_0x32a24f=_0x32a24f[_0x59345d(0xe7)](_0x398a42,_0x1f32d8[_0x3bbf7a]);}_0x222ef5['file'](_0x309d13,_0x32a24f);}}_0x26ce5a[_0x59345d(0x10d)]=await _0x222ef5['generateAsync']({'type':_0x59345d(0x134),'compression':'DEFLATE','compressionOptions':{'level':0x6}});}}async function writeZip(_0x5f149e,_0x4cda03){const _0x1e81d7=a86_0x5e4fc3,_0x5eb2cf=new mdapi_1[(_0x1e81d7(0x124))]({'components':_0x5f149e,'sourceDir':path_1[_0x1e81d7(0xfd)][_0x1e81d7(0xf7)](process[_0x1e81d7(0x101)](),_0x1e81d7(0x12a),_0x4cda03,DEPLOY_DIR_NAME,_0x1e81d7(0xe2)),'skipChildErrors':![]});await _0x5eb2cf[_0x1e81d7(0xf9)]();}async function generateAndWritePackageXML(_0x451c09,_0x2317bf,_0xd6ed42){const _0x508561=a86_0x5e4fc3,_0x5707ff=getComponentsTypeAndName(_0x451c09,_0x2317bf),_0x216368=[...new Set(_0x5707ff[_0x508561(0xe3)](_0x17548f=>_0x17548f[_0x508561(0xf0)]))],_0x2d92c5={'Package':{'$':{'xmlns':_0x508561(0xe0)},'types':[],'version':''+constants_1[_0x508561(0xf3)][_0x508561(0x127)](0x1)}};for(const _0x262601 of _0x216368){const _0x45716c=_0x5707ff['filter'](_0x4c6039=>_0x4c6039[_0x508561(0xf0)]===_0x262601)[_0x508561(0xe3)](_0x5d1786=>_0x5d1786[_0x508561(0xfb)]),_0x112e44={'members':_0x45716c,'name':_0x262601};_0x2d92c5[_0x508561(0x107)][_0x508561(0xef)][_0x508561(0x11e)](_0x112e44);}const _0x16c781=new xml2js_1[(_0x508561(0x11f))]({'xmldec':{'version':_0x508561(0xed),'encoding':'UTF-8'}}),_0x193131=_0x16c781[_0x508561(0xfa)](_0x2d92c5);await fs_internal_1['FS'][_0x508561(0x12b)](path_1[_0x508561(0xfd)][_0x508561(0xf7)](process[_0x508561(0x101)](),'.temp',_0xd6ed42,DEPLOY_DIR_NAME,'src',_0x508561(0x119)),_0x193131);}function getComponentsTypeAndName(_0x227693,_0x26a1cd){const _0x14dabe=a86_0x5e4fc3;return _0x227693[_0x14dabe(0x115)]((_0x4d5f71,_0x2f6152)=>{const _0x38e477=_0x14dabe,_0x196a88=_0x26a1cd['find'](_0x41c05c=>_0x41c05c['Id']===_0x2f6152[_0x38e477(0xf1)]);return _0x196a88&&_0x4d5f71[_0x38e477(0x11e)]({'name':_0x196a88['Component__r'][_0x38e477(0xd9)],'type':_0x2f6152[_0x38e477(0xee)]}),_0x4d5f71;},[]);}async function saveDestructiveChanges(_0x10de83,_0x11af4a,_0x105469,_0x437199){const _0x56af68=a86_0x5e4fc3,_0x41d51f=(await(0x0,fetch_attachments_1[_0x56af68(0xe9)])(_0x10de83,_0x11af4a))[_0x56af68(0x126)]();await fs_internal_1['FS'][_0x56af68(0x12b)](path_1['default'][_0x56af68(0xf7)](process[_0x56af68(0x101)](),_0x56af68(0x12a),_0x437199,DEPLOY_DIR_NAME,_0x56af68(0xe2),_0x105469),_0x41d51f);}async function createDeployZip(_0x4f4bc8){const _0x7f8b48=a86_0x5e4fc3,_0x21de08=new adm_zip_1[(_0x7f8b48(0xfd))]();return await _0x21de08['addLocalFolder'](path_1[_0x7f8b48(0xfd)][_0x7f8b48(0xf7)](process[_0x7f8b48(0x101)](),_0x7f8b48(0x12a),_0x4f4bc8,DEPLOY_DIR_NAME)),_0x21de08;}async function insertZip(_0x21bbfe,_0x4e4621,_0x1ac393,_0x54ae61,_0x1b2959){const _0x24a6f7=a86_0x5e4fc3,_0x5141cb={'ParentId':_0x4e4621,'Name':'BUILD'+_0x1ac393,'Description':_0x24a6f7(0x132)+_0x54ae61,'Body':_0x1b2959},{data:_0xa4c272}=await _0x21bbfe[_0x24a6f7(0x116)]('/services/data/'+constants_1[_0x24a6f7(0xf3)]+_0x24a6f7(0x130),_0x5141cb);return _0xa4c272['id'];}