function a86_0x2552(_0xc740e9,_0xbdbc52){const _0x298dd7=a86_0x2e9f();return a86_0x2552=function(_0x2279a0,_0x177496){_0x2279a0=_0x2279a0-0xb4;let _0x2e9f31=_0x298dd7[_0x2279a0];return _0x2e9f31;},a86_0x2552(_0xc740e9,_0xbdbc52);}const a86_0xa87e1b=a86_0x2552;(function(_0x480ce5,_0x443d0b){const _0x34b61d=a86_0x2552,_0x21804a=_0x480ce5();while(!![]){try{const _0x3a09c2=-parseInt(_0x34b61d(0xd1))/0x1*(parseInt(_0x34b61d(0xf3))/0x2)+-parseInt(_0x34b61d(0xe7))/0x3*(-parseInt(_0x34b61d(0xf5))/0x4)+parseInt(_0x34b61d(0xf1))/0x5+-parseInt(_0x34b61d(0xda))/0x6+-parseInt(_0x34b61d(0xb6))/0x7+-parseInt(_0x34b61d(0xf0))/0x8+parseInt(_0x34b61d(0xfb))/0x9*(parseInt(_0x34b61d(0x100))/0xa);if(_0x3a09c2===_0x443d0b)break;else _0x21804a['push'](_0x21804a['shift']());}catch(_0x44aa7e){_0x21804a['push'](_0x21804a['shift']());}}}(a86_0x2e9f,0xa8e7e));const a86_0x177496=(function(){let _0x283584=!![];return function(_0x1d7a40,_0x24221b){const _0x175a2e=_0x283584?function(){const _0x5eb511=a86_0x2552;if(_0x24221b){const _0x10588d=_0x24221b[_0x5eb511(0xcd)](_0x1d7a40,arguments);return _0x24221b=null,_0x10588d;}}:function(){};return _0x283584=![],_0x175a2e;};}()),a86_0x2279a0=a86_0x177496(this,function(){const _0x5b6e9c=a86_0x2552;return a86_0x2279a0[_0x5b6e9c(0xd2)]()[_0x5b6e9c(0xce)](_0x5b6e9c(0xb8))[_0x5b6e9c(0xd2)]()[_0x5b6e9c(0xfe)](a86_0x2279a0)[_0x5b6e9c(0xce)](_0x5b6e9c(0xb8));});a86_0x2279a0();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5bc25e){const _0x13d4cb=a86_0x2552;return _0x5bc25e&&_0x5bc25e[_0x13d4cb(0xc1)]?_0x5bc25e:{'default':_0x5bc25e};};Object['defineProperty'](exports,a86_0xa87e1b(0xc1),{'value':!![]}),exports[a86_0xa87e1b(0xcf)]=void 0x0;const path_1=__importDefault(require(a86_0xa87e1b(0xd8))),extract_component_permissions_1=require(a86_0xa87e1b(0xbf)),xml2js_1=require('xml2js'),zip_1=require(a86_0xa87e1b(0x10c)),mdapi_writer_1=require(a86_0xa87e1b(0xee)),fs_internal_1=require(a86_0xa87e1b(0x10a)),promises_1=require(a86_0xa87e1b(0xf9)),components_api_1=require(a86_0xa87e1b(0xb4)),adm_zip_1=__importDefault(require(a86_0xa87e1b(0xbb))),uuid_1=require(a86_0xa87e1b(0xf2)),fetch_attachments_1=require(a86_0xa87e1b(0xe0)),salesforce_1=require(a86_0xa87e1b(0xeb)),DESTRUCTIVE_CHANGES_PER_NAME=a86_0xa87e1b(0xf8),DESTRUCTIVE_CHANGES_POST_NAME=a86_0xa87e1b(0x104),DEPLOY_DIR_NAME=a86_0xa87e1b(0xc9);async function generateAndDeployZip({attachmentsId:_0x566d72,isExtractComponentsPermissions:_0x58d22d,preDestructiveAttachmentId:_0x138fc0,postDestructiveAttachmentId:_0x5a329e,branchId:_0x5c7aee,credentials:_0x1da585,metadataLogId:_0x150117,environments:_0x3dd8e5,metaTypes:_0x3757b2,apiVersion:_0x4760d7},_0xe09053){const _0x4e9ce6=a86_0xa87e1b,_0x1d089e=(0x0,uuid_1['v4'])();try{const _0x55ebc4=await(0x0,fetch_attachments_1[_0x4e9ce6(0xe1)])(_0xe09053,_0x566d72),_0x31ee9c=_0x55ebc4[_0x4e9ce6(0xdf)]((_0x263c62,_0x586655)=>({..._0x263c62,[_0x586655['Id']]:_0x586655[_0x4e9ce6(0xe9)]}),{}),_0x108abf=await getComponents(_0x55ebc4,_0xe09053,_0x31ee9c),_0x615dba=await components_api_1[_0x4e9ce6(0xc6)][_0x4e9ce6(0xf4)](_0xe09053,_0x55ebc4[_0x4e9ce6(0xdd)](({ParentId:_0x35dae5})=>_0x35dae5),_0x4760d7)[_0x4e9ce6(0x103)](_0x42b56c=>components_api_1[_0x4e9ce6(0xc6)][_0x4e9ce6(0xd7)](_0x42b56c));if(_0x58d22d){const _0x216a4c=_0x108abf['filter'](({fileType:_0x49181f})=>_0x49181f===_0x4e9ce6(0xc2));await removePermission(_0x216a4c,_0x615dba);}await replaceEnvironments(_0x3757b2,_0x3dd8e5,_0x108abf),await writeZip(_0x108abf,_0x1d089e),await generateAndWritePackageXML(_0x55ebc4,_0x615dba,_0x1d089e,_0x4760d7);_0x138fc0&&await saveDestructiveChanges(_0xe09053,_0x138fc0,DESTRUCTIVE_CHANGES_PER_NAME,_0x1d089e);_0x5a329e&&await saveDestructiveChanges(_0xe09053,_0x5a329e,DESTRUCTIVE_CHANGES_POST_NAME,_0x1d089e);const _0xd91118=(await createDeployZip(_0x1d089e)[_0x4e9ce6(0x103)](_0x30ebc2=>{return _0x30ebc2;}))[_0x4e9ce6(0x108)]()['toString'](_0x4e9ce6(0x106)),_0x541160=_0xd91118['length'];if(_0x541160>=components_api_1[_0x4e9ce6(0xea)]){const _0x958c87=await createDeployZip(_0x1d089e),[_0x5bc279,_0x1bffa9]=await components_api_1[_0x4e9ce6(0xc6)]['splitZip'](_0x958c87,_0x541160),_0x50c362=await insertZip(_0xe09053,_0x5c7aee,_0x1da585[_0x4e9ce6(0xd5)],_0x150117,_0x5bc279[_0x4e9ce6(0x108)]()[_0x4e9ce6(0xd2)](_0x4e9ce6(0x106)),_0x4760d7),_0x310814=await insertZip(_0xe09053,_0x5c7aee,_0x1da585[_0x4e9ce6(0xd5)],_0x150117,_0x1bffa9['toBuffer']()[_0x4e9ce6(0xd2)](_0x4e9ce6(0x106)),_0x4760d7);return _0x50c362+','+_0x310814;}else return await insertZip(_0xe09053,_0x5c7aee,_0x1da585[_0x4e9ce6(0xd5)],_0x150117,_0xd91118,_0x4760d7);}catch(_0x5e6b11){throw _0x5e6b11;}finally{if(await fs_internal_1['FS'][_0x4e9ce6(0xb5)](path_1[_0x4e9ce6(0xfa)][_0x4e9ce6(0xd3)](process[_0x4e9ce6(0xc7)](),_0x4e9ce6(0xd6),_0x1d089e)))await(0x0,promises_1['rm'])(path_1[_0x4e9ce6(0xfa)]['join'](process[_0x4e9ce6(0xc7)](),_0x4e9ce6(0xd6),_0x1d089e),{'recursive':!![]});}}exports['generateAndDeployZip']=generateAndDeployZip;async function getComponents(_0x563727,_0xc9b68c,_0x2c8b7e){const _0x1fb016=a86_0xa87e1b,_0x248d53=[],_0x126b07=await(0x0,fetch_attachments_1[_0x1fb016(0xca)])(_0x563727,_0xc9b68c);return await getComponentFromZip(_0x126b07,_0x2c8b7e)[_0x1fb016(0x103)](_0x2779a9=>{const _0x361b45=_0x1fb016;_0x248d53[_0x361b45(0xe4)](..._0x2779a9);}),_0x248d53;}async function getComponentFromZip(_0x301b2a,_0x3fb20b){const _0x2bb135=a86_0xa87e1b,_0xbbb588=[];for(const _0x21fab9 of _0x301b2a){const _0x5ca164=await zip_1[_0x2bb135(0xbd)]['unzip'](_0x21fab9[_0x2bb135(0xe6)][_0x2bb135(0xdb)]);for(const _0x4f3c1b in _0x5ca164[_0x2bb135(0xc4)]){!_0x5ca164['files'][_0x4f3c1b]['dir']&&_0xbbb588[_0x2bb135(0xe4)]({'fileName':_0x4f3c1b[_0x2bb135(0x10d)](_0x4f3c1b['indexOf']('/')+0x1),'fileType':_0x3fb20b[_0x21fab9['id']],'body':_0x21fab9['values']['Body']});}}return _0xbbb588;}async function removePermission(_0x309a22,_0xc9b8){const _0x4bafc6=a86_0xa87e1b;for(const _0x3f3681 of _0x309a22){const _0xf084b5=await zip_1[_0x4bafc6(0xbd)]['unzip'](_0x3f3681[_0x4bafc6(0x102)]),_0x156aca=[];for(const _0x278ca0 in _0xf084b5[_0x4bafc6(0xc4)]){!_0xf084b5[_0x4bafc6(0xc4)][_0x278ca0][_0x4bafc6(0x101)]&&_0x156aca['push']({'fileName':_0x278ca0,'body':await _0xf084b5['files'][_0x278ca0][_0x4bafc6(0x109)](_0x4bafc6(0xff))});}const _0xe6103b=await(0x0,extract_component_permissions_1[_0x4bafc6(0xfc)])(_0x156aca[0x0][_0x4bafc6(0x102)][_0x4bafc6(0xd2)](),_0xc9b8,_0x3f3681[_0x4bafc6(0xe8)]),_0x5b8aa5=new xml2js_1[(_0x4bafc6(0x107))]({'xmldec':{'version':_0x4bafc6(0xfd),'encoding':_0x4bafc6(0xf7)}}),_0x29b457=_0x5b8aa5[_0x4bafc6(0xd9)](_0xe6103b),_0x7d03bd=zip_1[_0x4bafc6(0xbd)]['createZip']();_0x7d03bd[_0x4bafc6(0xec)](_0x156aca[0x0]['fileName'],_0x29b457),_0x3f3681['body']=await _0x7d03bd[_0x4bafc6(0x10b)]({'type':_0x4bafc6(0x106),'compression':_0x4bafc6(0xcc),'compressionOptions':{'level':0x6}});}}async function replaceEnvironments(_0x57bd0c,_0x5119b4,_0x719e78){const _0x5f11cb=a86_0xa87e1b;for(const _0xfeabb7 of _0x719e78){if(_0x57bd0c[_0x5f11cb(0xbc)](_0xd80b95=>_0xd80b95!==_0xfeabb7[_0x5f11cb(0xe8)]))continue;const _0x5d00f8=await zip_1[_0x5f11cb(0xbd)][_0x5f11cb(0xc8)](_0xfeabb7[_0x5f11cb(0x102)]);for(const _0x4ee06a in _0x5d00f8[_0x5f11cb(0xc4)]){if(!_0x5d00f8[_0x5f11cb(0xc4)][_0x4ee06a]['dir']){let _0x9992fb=await _0x5d00f8[_0x5f11cb(0xc4)][_0x4ee06a][_0x5f11cb(0x109)](_0x5f11cb(0xff));for(const _0x2acedd of Object[_0x5f11cb(0xf6)](_0x5119b4)){const _0x13cb4a=new RegExp('%%'+_0x2acedd+'%%','g');_0x9992fb=_0x9992fb[_0x5f11cb(0xb9)](_0x13cb4a,_0x5119b4[_0x2acedd]);}_0x5d00f8['file'](_0x4ee06a,_0x9992fb);}}_0xfeabb7[_0x5f11cb(0x102)]=await _0x5d00f8[_0x5f11cb(0x10b)]({'type':'base64','compression':'DEFLATE','compressionOptions':{'level':0x6}});}}async function writeZip(_0x2ed42e,_0x1dcf49){const _0x140ecb=a86_0xa87e1b,_0x335a6b=new mdapi_writer_1[(_0x140ecb(0xef))]({'components':_0x2ed42e,'sourceDir':path_1[_0x140ecb(0xfa)][_0x140ecb(0xd3)](process[_0x140ecb(0xc7)](),_0x140ecb(0xd6),_0x1dcf49,DEPLOY_DIR_NAME,_0x140ecb(0xed)),'skipChildErrors':![]});await _0x335a6b[_0x140ecb(0xcb)]();}function a86_0x2e9f(){const _0x587261=['retrieveAttachments','execute','DEFLATE','apply','search','generateAndDeployZip','find','2471UZxezb','toString','join','types','orgId','.temp','removeNamespacePrefix','path','buildObject','2981676ugxgzQ','Body','post','map','filter','reduce','../../shared/utils/fetch-attachments','fetchAttachmentsDetailsById','/sobjects/Attachment','type','push','/services/data/v','values','3YufftZ','fileType','Name','MAX_ZIP_SIZE','@flosum/salesforce','file','src','../../git/writers/mdapi.writer','MDApiWriter','2559536UvlwpO','2484785pWggJx','uuid','378IpNwNu','fetchComponentsDetailsByComponentsHistory','2157992qDSrel','keys','UTF-8','destructiveChangesPre.xml','fs/promises','default','9TnzeLw','extractComponentPermissions','1.0','constructor','text','12064600sDBNqC','dir','body','then','destructiveChangesPost.xml','addLocalFolder','base64','Builder','toBuffer','async','../../git/internal/fs.internal','generateAsync','../../git/parsers/utils/zip','substring','writeFile','../utils/components-api','exists','1870190qxnkCf','package.xml','(((.+)+)+)+$','replace','Component_Name__c','adm-zip','every','Zip','MetadataConstants','../utils/extract-component-permissions','http://soap.sforce.com/2006/04/metadata','__esModule','Profile','ParentId','files','fetchAttachmentBody','ComponentsApi','cwd','unzip','DEPLOYZIP'];a86_0x2e9f=function(){return _0x587261;};return a86_0x2e9f();}async function generateAndWritePackageXML(_0x2bc194,_0x47291d,_0x386cc4,_0x18d732){const _0x295068=a86_0xa87e1b,_0x5b7b4b=getComponentsTypeAndName(_0x2bc194,_0x47291d),_0x1ca9fc=[...new Set(_0x5b7b4b[_0x295068(0xdd)](_0xb0a3a8=>_0xb0a3a8[_0x295068(0xe3)]))],_0x17e4b1={'Package':{'$':{'xmlns':_0x295068(0xc0)},'types':[],'version':''+_0x18d732}};for(const _0x2d80f6 of _0x1ca9fc){const _0x107e88=_0x5b7b4b[_0x295068(0xde)](_0x542e67=>_0x542e67[_0x295068(0xe3)]===_0x2d80f6)[_0x295068(0xdd)](_0x52a7af=>_0x52a7af['name']),_0x2bf63e={'members':_0x107e88,'name':_0x2d80f6};_0x17e4b1['Package'][_0x295068(0xd4)][_0x295068(0xe4)](_0x2bf63e);}const _0x1e8c10=new xml2js_1[(_0x295068(0x107))]({'xmldec':{'version':'1.0','encoding':_0x295068(0xf7)}}),_0x3c5089=_0x1e8c10[_0x295068(0xd9)](_0x17e4b1);await fs_internal_1['FS'][_0x295068(0x10e)](path_1['default'][_0x295068(0xd3)](process[_0x295068(0xc7)](),_0x295068(0xd6),_0x386cc4,DEPLOY_DIR_NAME,_0x295068(0xed),_0x295068(0xb7)),_0x3c5089);}function getComponentsTypeAndName(_0x1d2888,_0x4ddf4b){const _0x47be7b=a86_0xa87e1b;return _0x1d2888[_0x47be7b(0xdf)]((_0x77bbc0,_0x38517b)=>{const _0x1f12f2=_0x47be7b,_0x4acc9c=_0x4ddf4b[_0x1f12f2(0xd0)](_0x4a9f31=>_0x4a9f31['Id']===_0x38517b[_0x1f12f2(0xc3)]);return _0x4acc9c&&_0x77bbc0[_0x1f12f2(0xe4)]({'name':_0x4acc9c['Component__r'][_0x1f12f2(0xba)],'type':salesforce_1[_0x1f12f2(0xbe)]['FOLDER_TO_METADATA_TYPE_MAP'][_0x38517b[_0x1f12f2(0xe9)]]||_0x38517b[_0x1f12f2(0xe9)]}),_0x77bbc0;},[]);}async function saveDestructiveChanges(_0x249a03,_0x2b43d9,_0x266410,_0x35fabd){const _0x41d450=a86_0xa87e1b,_0x27256c=(await(0x0,fetch_attachments_1[_0x41d450(0xc5)])(_0x249a03,_0x2b43d9))['toString']();await fs_internal_1['FS'][_0x41d450(0x10e)](path_1[_0x41d450(0xfa)]['join'](process[_0x41d450(0xc7)](),_0x41d450(0xd6),_0x35fabd,DEPLOY_DIR_NAME,_0x41d450(0xed),_0x266410),_0x27256c);}async function createDeployZip(_0x193b8a){const _0x4e0fce=a86_0xa87e1b,_0x3aefa9=new adm_zip_1[(_0x4e0fce(0xfa))]();return await _0x3aefa9[_0x4e0fce(0x105)](path_1[_0x4e0fce(0xfa)]['join'](process[_0x4e0fce(0xc7)](),_0x4e0fce(0xd6),_0x193b8a,DEPLOY_DIR_NAME)),_0x3aefa9;}async function insertZip(_0x194586,_0x1052f8,_0x97a91c,_0x108b69,_0x244723,_0x4cb62a){const _0x44ff35=a86_0xa87e1b,_0x50e743={'ParentId':_0x1052f8,'Name':'BUILD'+_0x97a91c,'Description':'BUILD'+_0x108b69,'Body':_0x244723},{data:_0x1fa1f4}=await _0x194586[_0x44ff35(0xdc)](_0x44ff35(0xe5)+_0x4cb62a+_0x44ff35(0xe2),_0x50e743);return _0x1fa1f4['id'];}