const a86_0x5a1d26=a86_0x46f5;(function(_0x58a038,_0x4a31b8){const _0xe5d10c=a86_0x46f5,_0x1b8a2e=_0x58a038();while(!![]){try{const _0xd5a44=parseInt(_0xe5d10c(0x1b0))/0x1*(-parseInt(_0xe5d10c(0x19c))/0x2)+parseInt(_0xe5d10c(0x1a7))/0x3+parseInt(_0xe5d10c(0x18b))/0x4*(parseInt(_0xe5d10c(0x1b9))/0x5)+parseInt(_0xe5d10c(0x1a4))/0x6*(parseInt(_0xe5d10c(0x195))/0x7)+parseInt(_0xe5d10c(0x1a9))/0x8+-parseInt(_0xe5d10c(0x1b8))/0x9*(parseInt(_0xe5d10c(0x186))/0xa)+-parseInt(_0xe5d10c(0x18f))/0xb*(-parseInt(_0xe5d10c(0x1c9))/0xc);if(_0xd5a44===_0x4a31b8)break;else _0x1b8a2e['push'](_0x1b8a2e['shift']());}catch(_0x394893){_0x1b8a2e['push'](_0x1b8a2e['shift']());}}}(a86_0x2f4a,0x954c9));const a86_0x362c99=(function(){let _0x482b5c=!![];return function(_0x5a4d1f,_0x55bb0b){const _0x4971d1=_0x482b5c?function(){if(_0x55bb0b){const _0x1e21d8=_0x55bb0b['apply'](_0x5a4d1f,arguments);return _0x55bb0b=null,_0x1e21d8;}}:function(){};return _0x482b5c=![],_0x4971d1;};}()),a86_0x355588=a86_0x362c99(this,function(){const _0xf19bcb=a86_0x46f5;return a86_0x355588[_0xf19bcb(0x1da)]()[_0xf19bcb(0x19b)]('(((.+)+)+)+$')[_0xf19bcb(0x1da)]()[_0xf19bcb(0x189)](a86_0x355588)[_0xf19bcb(0x19b)]('(((.+)+)+)+$');});a86_0x355588();'use strict';var __importDefault=this&&this[a86_0x5a1d26(0x19f)]||function(_0x3a3cb0){const _0xe269b3=a86_0x5a1d26;return _0x3a3cb0&&_0x3a3cb0[_0xe269b3(0x1a6)]?_0x3a3cb0:{'default':_0x3a3cb0};};Object[a86_0x5a1d26(0x18c)](exports,'__esModule',{'value':!![]}),exports[a86_0x5a1d26(0x1b6)]=void 0x0;const constants_1=require('../../../constants'),path_1=__importDefault(require('path')),extract_component_permissions_1=require(a86_0x5a1d26(0x1cf)),xml2js_1=require(a86_0x5a1d26(0x1d5)),zip_1=require('../../git/parsers/utils/zip'),mdapi_1=require(a86_0x5a1d26(0x1d6)),fs_internal_1=require(a86_0x5a1d26(0x1af)),promises_1=require(a86_0x5a1d26(0x1d7)),components_api_1=require(a86_0x5a1d26(0x1d8)),adm_zip_1=__importDefault(require('adm-zip')),uuid_1=require(a86_0x5a1d26(0x18d)),fetch_attachments_1=require(a86_0x5a1d26(0x1ca)),DESTRUCTIVE_CHANGES_PER_NAME=a86_0x5a1d26(0x1bf),DESTRUCTIVE_CHANGES_POST_NAME=a86_0x5a1d26(0x1a2),DEPLOY_DIR_NAME=a86_0x5a1d26(0x1c1);async function generateAndDeployZip({attachmentsId:_0x8ae9,isExtractComponentsPermissions:_0x59d4fb,preDestructiveAttachmentId:_0x3f5cb6,postDestructiveAttachmentId:_0x127e6e,branchId:_0x4cc1f0,credentials:_0x2d4bb7,metadataLogId:_0x4153d7,environments:_0x28de5d,metaTypes:_0x1d41ac},_0x7fb578){const _0x4626af=a86_0x5a1d26,_0x252697=(0x0,uuid_1['v4'])();try{const _0x7b3ec6=await(0x0,fetch_attachments_1['fetchAttachmentsDetailsById'])(_0x7fb578,_0x8ae9),_0x2022b1=_0x7b3ec6[_0x4626af(0x1db)]((_0xed0a1a,_0x6a236a)=>({..._0xed0a1a,[_0x6a236a['Id']]:_0x6a236a['Name']}),{}),_0x3d1fd8=await getComponents(_0x7b3ec6,_0x7fb578,_0x2022b1),_0x56f4e4=await components_api_1[_0x4626af(0x196)][_0x4626af(0x1a1)](_0x7fb578,_0x7b3ec6['map'](({ParentId:_0x5db7a9})=>_0x5db7a9))[_0x4626af(0x1c8)](_0x16d6b9=>components_api_1[_0x4626af(0x196)][_0x4626af(0x1c5)](_0x16d6b9));if(_0x59d4fb){const _0x1cf020=_0x3d1fd8[_0x4626af(0x1c4)](({fileType:_0x5a58d0})=>_0x5a58d0==='Profile'||_0x5a58d0===_0x4626af(0x1ad));await removePermission(_0x1cf020,_0x56f4e4);}await replaceEnvironments(_0x1d41ac,_0x28de5d,_0x3d1fd8),await writeZip(_0x3d1fd8,_0x252697),await generateAndWritePackageXML(_0x7b3ec6,_0x56f4e4,_0x252697);_0x3f5cb6&&await saveDestructiveChanges(_0x7fb578,_0x3f5cb6,DESTRUCTIVE_CHANGES_PER_NAME,_0x252697);_0x127e6e&&await saveDestructiveChanges(_0x7fb578,_0x127e6e,DESTRUCTIVE_CHANGES_POST_NAME,_0x252697);const _0x9efe1b=(await createDeployZip(_0x252697)[_0x4626af(0x1c8)](_0x5a3373=>{return _0x5a3373;}))[_0x4626af(0x180)]()['toString'](_0x4626af(0x194));console[_0x4626af(0x1cd)](_0x4626af(0x1b3));const _0x49fc8b=_0x9efe1b[_0x4626af(0x187)];if(_0x49fc8b>=components_api_1[_0x4626af(0x1ab)]){const _0x3c5798=await createDeployZip(_0x252697);console['log'](_0x4626af(0x1ce));const [_0x30ebd2,_0x5e5214]=await components_api_1[_0x4626af(0x196)][_0x4626af(0x1d1)](_0x3c5798,_0x49fc8b),_0x4389ea=await insertZip(_0x7fb578,_0x4cc1f0,_0x2d4bb7[_0x4626af(0x190)],_0x4153d7,_0x30ebd2[_0x4626af(0x180)]()['toString'](_0x4626af(0x194))),_0x35e244=await insertZip(_0x7fb578,_0x4cc1f0,_0x2d4bb7[_0x4626af(0x190)],_0x4153d7,_0x5e5214[_0x4626af(0x180)]()[_0x4626af(0x1da)](_0x4626af(0x194)));return _0x4389ea+','+_0x35e244;}else return await insertZip(_0x7fb578,_0x4cc1f0,_0x2d4bb7[_0x4626af(0x190)],_0x4153d7,_0x9efe1b);}catch(_0x47dc08){throw _0x47dc08;}finally{if(await fs_internal_1['FS'][_0x4626af(0x1ac)](path_1[_0x4626af(0x1ae)][_0x4626af(0x197)](process['cwd'](),_0x4626af(0x1a3),_0x252697)))await(0x0,promises_1['rm'])(path_1['default'][_0x4626af(0x197)](process[_0x4626af(0x19a)](),_0x4626af(0x1a3),_0x252697),{'recursive':!![]});}}exports[a86_0x5a1d26(0x1b6)]=generateAndDeployZip;async function getComponents(_0x20226d,_0x780161,_0x2192c1){const _0x2dcb9c=a86_0x5a1d26,_0x4d87d0=[],_0x1b47f3=await(0x0,fetch_attachments_1[_0x2dcb9c(0x1d0)])(_0x20226d,_0x780161);return await getComponentFromZip(_0x1b47f3,_0x2192c1)[_0x2dcb9c(0x1c8)](_0x42deae=>{const _0x101b54=_0x2dcb9c;_0x4d87d0[_0x101b54(0x1c7)](..._0x42deae);}),_0x4d87d0;}async function getComponentFromZip(_0x110aad,_0x2c7c19){const _0x163dc6=a86_0x5a1d26,_0x332d51=[];for(const _0x33b4af of _0x110aad){const _0x395c7a=await zip_1[_0x163dc6(0x185)]['unzip'](_0x33b4af[_0x163dc6(0x183)][_0x163dc6(0x1aa)]);for(const _0x38cdf6 in _0x395c7a[_0x163dc6(0x18a)]){!_0x395c7a[_0x163dc6(0x18a)][_0x38cdf6][_0x163dc6(0x181)]&&_0x332d51[_0x163dc6(0x1c7)]({'fileName':_0x38cdf6[_0x163dc6(0x191)](_0x38cdf6['indexOf']('/')+0x1),'fileType':_0x2c7c19[_0x33b4af['id']],'body':_0x33b4af[_0x163dc6(0x183)][_0x163dc6(0x1aa)]});}}return _0x332d51;}async function removePermission(_0x58f737,_0x2a0f9c){const _0x56fe67=a86_0x5a1d26;for(const _0x3eaefc of _0x58f737){const _0x55bce0=await zip_1['Zip']['unzip'](_0x3eaefc[_0x56fe67(0x188)]),_0x4bde5c=[];for(const _0x3eb702 in _0x55bce0[_0x56fe67(0x18a)]){!_0x55bce0['files'][_0x3eb702][_0x56fe67(0x181)]&&_0x4bde5c['push']({'fileName':_0x3eb702,'body':await _0x55bce0[_0x56fe67(0x18a)][_0x3eb702]['async'](_0x56fe67(0x1d4))});}const _0x2287e2=await(0x0,extract_component_permissions_1[_0x56fe67(0x199)])(_0x4bde5c[0x0]['body'][_0x56fe67(0x1da)](),_0x2a0f9c,_0x3eaefc[_0x56fe67(0x18e)]),_0x5f0b8d=new xml2js_1[(_0x56fe67(0x193))]({'xmldec':{'version':'1.0','encoding':_0x56fe67(0x1c2)}}),_0x5dee84=_0x5f0b8d[_0x56fe67(0x1be)](_0x2287e2),_0x1f2be1=zip_1[_0x56fe67(0x185)][_0x56fe67(0x1bc)]();_0x1f2be1['file'](_0x4bde5c[0x0][_0x56fe67(0x19e)],_0x5dee84),_0x3eaefc[_0x56fe67(0x188)]=await _0x1f2be1[_0x56fe67(0x192)]({'type':_0x56fe67(0x194),'compression':_0x56fe67(0x1bb),'compressionOptions':{'level':0x6}});}}async function replaceEnvironments(_0x52a374,_0x3a018a,_0x11b720){const _0x2f4db8=a86_0x5a1d26;for(const _0x5bd379 of _0x11b720){if(_0x52a374[_0x2f4db8(0x182)](_0x2b24d5=>_0x2b24d5!==_0x5bd379['fileType']))continue;const _0xc445ee=await zip_1[_0x2f4db8(0x185)][_0x2f4db8(0x1c6)](_0x5bd379[_0x2f4db8(0x188)]);for(const _0x35b7f1 in _0xc445ee['files']){if(!_0xc445ee[_0x2f4db8(0x18a)][_0x35b7f1]['dir']){let _0x33c0af=await _0xc445ee[_0x2f4db8(0x18a)][_0x35b7f1]['async'](_0x2f4db8(0x1d4));for(const _0x21dac4 of Object[_0x2f4db8(0x1d9)](_0x3a018a)){const _0x23ffd6=new RegExp('%%'+_0x21dac4+'%%','g');_0x33c0af=_0x33c0af[_0x2f4db8(0x1b4)](_0x23ffd6,_0x3a018a[_0x21dac4]);}_0xc445ee[_0x2f4db8(0x1c3)](_0x35b7f1,_0x33c0af);}}_0x5bd379[_0x2f4db8(0x188)]=await _0xc445ee[_0x2f4db8(0x192)]({'type':_0x2f4db8(0x194),'compression':_0x2f4db8(0x1bb),'compressionOptions':{'level':0x6}});}}async function writeZip(_0x537820,_0x196c4c){const _0x35e80c=a86_0x5a1d26,_0x54e52c=new mdapi_1[(_0x35e80c(0x1b2))]({'components':_0x537820,'sourceDir':path_1['default'][_0x35e80c(0x197)](process[_0x35e80c(0x19a)](),_0x35e80c(0x1a3),_0x196c4c,DEPLOY_DIR_NAME,'src'),'skipChildErrors':![]});await _0x54e52c['start']();}async function generateAndWritePackageXML(_0x47c8ea,_0x2e658c,_0x4ccddb){const _0x1bb48d=a86_0x5a1d26,_0x5e3617=getComponentsTypeAndName(_0x47c8ea,_0x2e658c),_0x1793ca=[...new Set(_0x5e3617[_0x1bb48d(0x1d3)](_0x2499bc=>_0x2499bc[_0x1bb48d(0x17f)]))],_0x2ccff6={'Package':{'$':{'xmlns':'http://soap.sforce.com/2006/04/metadata'},'types':[],'version':''+constants_1[_0x1bb48d(0x1cc)][_0x1bb48d(0x191)](0x1)}};for(const _0x3d257f of _0x1793ca){const _0x2f0846=_0x5e3617[_0x1bb48d(0x1c4)](_0x384179=>_0x384179[_0x1bb48d(0x17f)]===_0x3d257f)[_0x1bb48d(0x1d3)](_0x37592c=>_0x37592c[_0x1bb48d(0x1d2)]),_0x26c8fe={'members':_0x2f0846,'name':_0x3d257f};_0x2ccff6[_0x1bb48d(0x198)]['types'][_0x1bb48d(0x1c7)](_0x26c8fe);}const _0x491ca9=new xml2js_1[(_0x1bb48d(0x193))]({'xmldec':{'version':_0x1bb48d(0x1b5),'encoding':_0x1bb48d(0x1c2)}}),_0x1f9656=_0x491ca9['buildObject'](_0x2ccff6);await fs_internal_1['FS']['writeFile'](path_1[_0x1bb48d(0x1ae)][_0x1bb48d(0x197)](process[_0x1bb48d(0x19a)](),'.temp',_0x4ccddb,DEPLOY_DIR_NAME,'src','package.xml'),_0x1f9656);}function getComponentsTypeAndName(_0x3e3ad0,_0x3d9872){const _0x487674=a86_0x5a1d26;return _0x3e3ad0[_0x487674(0x1db)]((_0x10ebe0,_0x417637)=>{const _0x2456f6=_0x487674,_0x56eda1=_0x3d9872[_0x2456f6(0x1bd)](_0xd6e657=>_0xd6e657['Id']===_0x417637[_0x2456f6(0x1a8)]);return _0x56eda1&&_0x10ebe0[_0x2456f6(0x1c7)]({'name':_0x56eda1[_0x2456f6(0x1ba)][_0x2456f6(0x1b7)],'type':_0x417637[_0x2456f6(0x184)]}),_0x10ebe0;},[]);}async function saveDestructiveChanges(_0x30c277,_0x6bb5dc,_0x48a60e,_0xe38cba){const _0x1ecf8a=a86_0x5a1d26,_0x4c78b6=(await(0x0,fetch_attachments_1[_0x1ecf8a(0x1c0)])(_0x30c277,_0x6bb5dc))[_0x1ecf8a(0x1da)]();await fs_internal_1['FS'][_0x1ecf8a(0x1a5)](path_1[_0x1ecf8a(0x1ae)][_0x1ecf8a(0x197)](process['cwd'](),'.temp',_0xe38cba,DEPLOY_DIR_NAME,'src',_0x48a60e),_0x4c78b6);}function a86_0x46f5(_0x30087a,_0x5e62e6){const _0x15b706=a86_0x2f4a();return a86_0x46f5=function(_0x355588,_0x362c99){_0x355588=_0x355588-0x17f;let _0x2f4ade=_0x15b706[_0x355588];return _0x2f4ade;},a86_0x46f5(_0x30087a,_0x5e62e6);}async function createDeployZip(_0x4c689c){const _0x2da3c8=a86_0x5a1d26,_0x388ef9=new adm_zip_1[(_0x2da3c8(0x1ae))]();return await _0x388ef9[_0x2da3c8(0x1b1)](path_1[_0x2da3c8(0x1ae)][_0x2da3c8(0x197)](process['cwd'](),_0x2da3c8(0x1a3),_0x4c689c,DEPLOY_DIR_NAME)),_0x388ef9;}async function insertZip(_0x32e56c,_0x27660c,_0xaeb643,_0x50c0e4,_0x167d8a){const _0x4ec5fd=a86_0x5a1d26,_0x32d8dd={'ParentId':_0x27660c,'Name':_0x4ec5fd(0x1a0)+_0xaeb643,'Description':_0x4ec5fd(0x1a0)+_0x50c0e4,'Body':_0x167d8a},{data:_0x2eb7e0}=await _0x32e56c['post'](_0x4ec5fd(0x19d)+constants_1[_0x4ec5fd(0x1cc)]+_0x4ec5fd(0x1cb),_0x32d8dd);return _0x2eb7e0['id'];}function a86_0x2f4a(){const _0x39d13a=['file','filter','removeNamespacePrefix','unzip','push','then','72qpQHhU','../../shared/utils/fetch-attachments','/sobjects/Attachment','SALESFORCE_API_VERSION','log','after\x20create\x20second\x20zip','../utils/extract-component-permissions','retrieveAttachments','splitZip','name','map','text','xml2js','../../git/parsers/mdapi','fs/promises','../utils/components-api','keys','toString','reduce','type','toBuffer','dir','every','values','Name','Zip','4658330Etkmvw','length','body','constructor','files','505772kXCZYQ','defineProperty','uuid','fileType','1032394SrxQzX','orgId','substring','generateAsync','Builder','base64','7lJqMqv','ComponentsApi','join','Package','extractComponentPermissions','cwd','search','8392FomWQW','/services/data/','fileName','__importDefault','BUILD','fetchComponentsDetailsByComponentsHistory','destructiveChangesPost.xml','.temp','1416426GtUbpf','writeFile','__esModule','1359957YZECDO','ParentId','4140160FfAYnj','Body','MAX_ZIP_SIZE','exists','PermissionSet','default','../../git/internal/fs.internal','265indRel','addLocalFolder','MDApiWriter','after\x20create\x20zip','replace','1.0','generateAndDeployZip','Component_Name__c','18GEBbMt','35KLSVHW','Component__r','DEFLATE','createZip','find','buildObject','destructiveChangesPre.xml','fetchAttachmentBody','DEPLOYZIP','UTF-8'];a86_0x2f4a=function(){return _0x39d13a;};return a86_0x2f4a();}