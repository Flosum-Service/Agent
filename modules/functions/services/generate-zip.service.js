const a54_0x2fc512=a54_0x249f;(function(_0x1a281c,_0x549a23){const _0x47550b=a54_0x249f,_0x46db0a=_0x1a281c();while(!![]){try{const _0x5a2014=parseInt(_0x47550b(0xb4))/0x1*(-parseInt(_0x47550b(0xdc))/0x2)+-parseInt(_0x47550b(0xd0))/0x3*(-parseInt(_0x47550b(0xc8))/0x4)+-parseInt(_0x47550b(0xb3))/0x5*(parseInt(_0x47550b(0xf3))/0x6)+parseInt(_0x47550b(0xe4))/0x7+-parseInt(_0x47550b(0xd6))/0x8+-parseInt(_0x47550b(0xc2))/0x9*(parseInt(_0x47550b(0xcc))/0xa)+parseInt(_0x47550b(0xa9))/0xb;if(_0x5a2014===_0x549a23)break;else _0x46db0a['push'](_0x46db0a['shift']());}catch(_0x2b9094){_0x46db0a['push'](_0x46db0a['shift']());}}}(a54_0x44be,0x575b2));const a54_0x107bfd=(function(){let _0x2a4cea=!![];return function(_0x284583,_0x13ced9){const _0x1edfc2=_0x2a4cea?function(){if(_0x13ced9){const _0x2888ab=_0x13ced9['apply'](_0x284583,arguments);return _0x13ced9=null,_0x2888ab;}}:function(){};return _0x2a4cea=![],_0x1edfc2;};}()),a54_0x5207f9=a54_0x107bfd(this,function(){const _0x31ccca=a54_0x249f;return a54_0x5207f9[_0x31ccca(0xda)]()[_0x31ccca(0xab)]('(((.+)+)+)+$')['toString']()[_0x31ccca(0xcf)](a54_0x5207f9)[_0x31ccca(0xab)](_0x31ccca(0xb2));});a54_0x5207f9();'use strict';var __importDefault=this&&this[a54_0x2fc512(0xdd)]||function(_0x1b230f){return _0x1b230f&&_0x1b230f['__esModule']?_0x1b230f:{'default':_0x1b230f};};Object[a54_0x2fc512(0xb9)](exports,a54_0x2fc512(0xb1),{'value':!![]}),exports[a54_0x2fc512(0xaf)]=void 0x0;const constants_1=require(a54_0x2fc512(0xe5)),path_1=__importDefault(require(a54_0x2fc512(0xdf))),extract_component_permissions_1=require('../utils/extract-component-permissions'),xml2js_1=require('xml2js'),zip_1=require(a54_0x2fc512(0xa8)),mdapi_1=require(a54_0x2fc512(0xd7)),fs_internal_1=require('../../git/internal/fs.internal'),promises_1=require(a54_0x2fc512(0xc5)),components_api_1=require(a54_0x2fc512(0xe3)),adm_zip_1=__importDefault(require(a54_0x2fc512(0xf6))),uuid_1=require(a54_0x2fc512(0xba)),DESTRUCTIVE_CHANGES_PER_NAME=a54_0x2fc512(0xa2),DESTRUCTIVE_CHANGES_POST_NAME=a54_0x2fc512(0xbc),DEPLOY_DIR_NAME=a54_0x2fc512(0xb5);async function generateAndDeployZip({attachmentsId:_0x274f59,isExtractComponentsPermissions:_0x546f45,preDestructiveAttachmentId:_0x1d73a5,postDestructiveAttachmentId:_0x25663e,branchId:_0x4c7b10,credentials:_0x53fea9,metadataLogId:_0x524226,environments:_0x4ed84f,metaTypes:_0x5e38b9},_0x17ed90){const _0x5cbe13=a54_0x2fc512,_0x3b78f8=(0x0,uuid_1['v4'])();try{const _0x1862aa=await components_api_1['ComponentsApi'][_0x5cbe13(0xc0)](_0x17ed90,_0x274f59),_0x55dcc1=_0x1862aa[_0x5cbe13(0xb0)]((_0x21f56b,_0x4069a0)=>({..._0x21f56b,[_0x4069a0['Id']]:_0x4069a0[_0x5cbe13(0xce)]}),{}),_0x5041a0=await getComponents(_0x1862aa,_0x17ed90,_0x55dcc1),_0x1d0412=await components_api_1[_0x5cbe13(0xae)][_0x5cbe13(0xd9)](_0x17ed90,_0x1862aa[_0x5cbe13(0xc9)](({ParentId:_0x22fbed})=>_0x22fbed))[_0x5cbe13(0xb7)](_0x46730f=>components_api_1[_0x5cbe13(0xae)][_0x5cbe13(0xfd)](_0x46730f));if(_0x546f45){const _0x36612d=_0x5041a0[_0x5cbe13(0xb8)](({fileType:_0x950120})=>_0x950120===_0x5cbe13(0xf0)||_0x950120==='PermissionSet');await removePermission(_0x36612d,_0x1d0412);}await replaceEnvironments(_0x5e38b9,_0x4ed84f,_0x5041a0),await writeZip(_0x5041a0,_0x3b78f8),await generateAndWritePackageXML(_0x1862aa,_0x1d0412,_0x3b78f8);_0x1d73a5&&await saveDestructiveChanges(_0x17ed90,_0x1d73a5,DESTRUCTIVE_CHANGES_PER_NAME,_0x3b78f8);_0x25663e&&await saveDestructiveChanges(_0x17ed90,_0x25663e,DESTRUCTIVE_CHANGES_POST_NAME,_0x3b78f8);const _0x58568f=(await createDeployZip(_0x3b78f8)['then'](_0x5667ca=>{return _0x5667ca;}))[_0x5cbe13(0xd5)]()[_0x5cbe13(0xda)](_0x5cbe13(0xe1));console[_0x5cbe13(0xd4)]('after\x20create\x20zip');const _0x38273a=_0x58568f[_0x5cbe13(0xe7)];if(_0x38273a>=components_api_1[_0x5cbe13(0xac)]){const _0x54e2f2=await createDeployZip(_0x3b78f8);console[_0x5cbe13(0xd4)](_0x5cbe13(0xfb));const [_0x41baab,_0x4adef2]=await components_api_1[_0x5cbe13(0xae)][_0x5cbe13(0xa4)](_0x54e2f2,_0x38273a),_0x31d58f=await insertZip(_0x17ed90,_0x4c7b10,_0x53fea9['orgId'],_0x524226,_0x41baab[_0x5cbe13(0xd5)]()['toString'](_0x5cbe13(0xe1))),_0x25bd56=await insertZip(_0x17ed90,_0x4c7b10,_0x53fea9['orgId'],_0x524226,_0x4adef2[_0x5cbe13(0xd5)]()[_0x5cbe13(0xda)]('base64'));return _0x31d58f+','+_0x25bd56;}else return await insertZip(_0x17ed90,_0x4c7b10,_0x53fea9[_0x5cbe13(0xc4)],_0x524226,_0x58568f);}catch(_0x370172){throw _0x370172;}finally{if(await fs_internal_1['FS'][_0x5cbe13(0xe0)](path_1[_0x5cbe13(0xf9)][_0x5cbe13(0xf2)](process['cwd'](),'.temp',_0x3b78f8)))await(0x0,promises_1['rm'])(path_1[_0x5cbe13(0xf9)]['join'](process[_0x5cbe13(0xd3)](),'.temp',_0x3b78f8),{'recursive':!![]});}}exports[a54_0x2fc512(0xaf)]=generateAndDeployZip;async function getComponents(_0x6750d0,_0x547ac6,_0x3fae38){const _0x289deb=a54_0x2fc512,_0x59bf29=[],_0x5b6ea9=await components_api_1[_0x289deb(0xae)][_0x289deb(0xa7)](_0x6750d0,_0x547ac6);return await getComponentFromZip(_0x5b6ea9,_0x3fae38)[_0x289deb(0xb7)](_0x375d76=>{_0x59bf29['push'](..._0x375d76);}),_0x59bf29;}async function getComponentFromZip(_0x155e62,_0xdfd4c){const _0x501617=a54_0x2fc512,_0x52eaea=[];for(const _0x479e52 of _0x155e62){const _0x29a0f3=await zip_1[_0x501617(0xef)]['unzip'](_0x479e52['values']['Body']);for(const _0x3f77ec in _0x29a0f3[_0x501617(0xe2)]){!_0x29a0f3[_0x501617(0xe2)][_0x3f77ec][_0x501617(0xad)]&&_0x52eaea[_0x501617(0xed)]({'fileName':_0x3f77ec[_0x501617(0xc3)](_0x3f77ec[_0x501617(0xd1)]('/')+0x1),'fileType':_0xdfd4c[_0x479e52['id']],'body':_0x479e52[_0x501617(0xd8)][_0x501617(0xfc)]});}}return _0x52eaea;}async function removePermission(_0x5a9c84,_0x2dafae){const _0x4a5d68=a54_0x2fc512;for(const _0x36ddb2 of _0x5a9c84){const _0x4c386d=await zip_1[_0x4a5d68(0xef)][_0x4a5d68(0xf8)](_0x36ddb2['body']),_0x47ff8a=[];for(const _0x5ad0e1 in _0x4c386d[_0x4a5d68(0xe2)]){!_0x4c386d[_0x4a5d68(0xe2)][_0x5ad0e1]['dir']&&_0x47ff8a[_0x4a5d68(0xed)]({'fileName':_0x5ad0e1,'body':await _0x4c386d['files'][_0x5ad0e1][_0x4a5d68(0xf5)](_0x4a5d68(0xf1))});}const _0x567734=await(0x0,extract_component_permissions_1[_0x4a5d68(0xe6)])(_0x47ff8a[0x0]['body'][_0x4a5d68(0xda)](),_0x2dafae,_0x36ddb2[_0x4a5d68(0xe8)]),_0x3a9e2a=new xml2js_1[(_0x4a5d68(0xbe))]({'xmldec':{'version':_0x4a5d68(0xbb),'encoding':_0x4a5d68(0xd2)}}),_0x437043=_0x3a9e2a['buildObject'](_0x567734),_0x4895d9=zip_1[_0x4a5d68(0xef)]['createZip']();_0x4895d9[_0x4a5d68(0xec)](_0x47ff8a[0x0][_0x4a5d68(0x100)],_0x437043),_0x36ddb2['body']=await _0x4895d9[_0x4a5d68(0xdb)]({'type':'base64','compression':_0x4a5d68(0xc7),'compressionOptions':{'level':0x6}});}}function a54_0x249f(_0x2a2d8d,_0x30a72f){const _0x176719=a54_0x44be();return a54_0x249f=function(_0x5207f9,_0x107bfd){_0x5207f9=_0x5207f9-0xa1;let _0x44befe=_0x176719[_0x5207f9];return _0x44befe;},a54_0x249f(_0x2a2d8d,_0x30a72f);}async function replaceEnvironments(_0x484b47,_0x8f4f19,_0x33d2a9){const _0x157f8d=a54_0x2fc512;for(const _0x1a345e of _0x33d2a9){if(_0x484b47[_0x157f8d(0xff)](_0x15ef81=>_0x15ef81!==_0x1a345e[_0x157f8d(0xe8)]))continue;const _0x127bbb=await zip_1[_0x157f8d(0xef)][_0x157f8d(0xf8)](_0x1a345e[_0x157f8d(0xcd)]);for(const _0x5c3cf4 in _0x127bbb[_0x157f8d(0xe2)]){if(!_0x127bbb['files'][_0x5c3cf4][_0x157f8d(0xad)]){let _0x394c1e=await _0x127bbb[_0x157f8d(0xe2)][_0x5c3cf4]['async'](_0x157f8d(0xf1));for(const _0x2a71d8 of Object[_0x157f8d(0xc1)](_0x8f4f19)){const _0x5483dd=new RegExp('%%'+_0x2a71d8+'%%','g');_0x394c1e=_0x394c1e[_0x157f8d(0xe9)](_0x5483dd,_0x8f4f19[_0x2a71d8]);}_0x127bbb[_0x157f8d(0xec)](_0x5c3cf4,_0x394c1e);}}_0x1a345e['body']=await _0x127bbb[_0x157f8d(0xdb)]({'type':_0x157f8d(0xe1),'compression':_0x157f8d(0xc7),'compressionOptions':{'level':0x6}});}}async function writeZip(_0xe2ed04,_0x53ca9f){const _0xc23725=a54_0x2fc512,_0xbcde1a=new mdapi_1[(_0xc23725(0xa5))]({'components':_0xe2ed04,'sourceDir':path_1['default'][_0xc23725(0xf2)](process[_0xc23725(0xd3)](),_0xc23725(0xfa),_0x53ca9f,DEPLOY_DIR_NAME,_0xc23725(0x101)),'skipChildErrors':![]});await _0xbcde1a[_0xc23725(0xde)]();}async function generateAndWritePackageXML(_0x2d541e,_0x5b105e,_0x3fecbe){const _0x208864=a54_0x2fc512,_0x3ef220=getComponentsTypeAndName(_0x2d541e,_0x5b105e),_0x51c3db=[...new Set(_0x3ef220[_0x208864(0xc9)](_0x994c73=>_0x994c73[_0x208864(0xf7)]))],_0xeab45={'Package':{'$':{'xmlns':_0x208864(0xcb)},'types':[],'version':''+constants_1['SALESFORCE_API_VERSION'][_0x208864(0xc3)](0x1)}};for(const _0x5cbe14 of _0x51c3db){const _0x513cda=_0x3ef220['filter'](_0x2a09f9=>_0x2a09f9['type']===_0x5cbe14)[_0x208864(0xc9)](_0x4aad06=>_0x4aad06[_0x208864(0xf4)]),_0x5f1a1d={'members':_0x513cda,'name':_0x5cbe14};_0xeab45['Package'][_0x208864(0xa6)]['push'](_0x5f1a1d);}const _0x12b630=new xml2js_1['Builder']({'xmldec':{'version':_0x208864(0xbb),'encoding':_0x208864(0xd2)}}),_0x4ec21c=_0x12b630[_0x208864(0xb6)](_0xeab45);await fs_internal_1['FS'][_0x208864(0xaa)](path_1[_0x208864(0xf9)][_0x208864(0xf2)](process[_0x208864(0xd3)](),'.temp',_0x3fecbe,DEPLOY_DIR_NAME,_0x208864(0x101),'package.xml'),_0x4ec21c);}function getComponentsTypeAndName(_0x106375,_0x311803){const _0x13190d=a54_0x2fc512;return _0x106375[_0x13190d(0xb0)]((_0x1a8a13,_0x3e55ef)=>{const _0x3a6796=_0x13190d,_0x2467fc=_0x311803[_0x3a6796(0xfe)](_0x1ac1a0=>_0x1ac1a0['Id']===_0x3e55ef[_0x3a6796(0xc6)]);return _0x2467fc&&_0x1a8a13[_0x3a6796(0xed)]({'name':_0x2467fc[_0x3a6796(0xa1)][_0x3a6796(0xea)],'type':_0x3e55ef[_0x3a6796(0xce)]}),_0x1a8a13;},[]);}async function saveDestructiveChanges(_0x9c7690,_0x435cf1,_0xf6beb7,_0xa83da7){const _0x404e68=a54_0x2fc512,_0xbfa61e=(await components_api_1[_0x404e68(0xae)][_0x404e68(0xa3)](_0x9c7690,_0x435cf1))['toString']();await fs_internal_1['FS']['writeFile'](path_1['default'][_0x404e68(0xf2)](process['cwd'](),_0x404e68(0xfa),_0xa83da7,DEPLOY_DIR_NAME,_0x404e68(0x101),_0xf6beb7),_0xbfa61e);}function a54_0x44be(){const _0x19b2ff=['join','32652cDclVh','name','async','adm-zip','type','unzip','default','.temp','after\x20create\x20second\x20zip','Body','removeNamespacePrefix','find','every','fileName','src','Component__r','destructiveChangesPre.xml','fetchAttachmentBody','splitZip','MDApiWriter','types','retrieveAttachments','../../git/parsers/utils/zip','14571194mFQJyS','writeFile','search','MAX_ZIP_SIZE','dir','ComponentsApi','generateAndDeployZip','reduce','__esModule','(((.+)+)+)+$','480BxWALg','18vjHVOv','DEPLOYZIP','buildObject','then','filter','defineProperty','uuid','1.0','destructiveChangesPost.xml','post','Builder','SALESFORCE_API_VERSION','fetchAttachmentsDetails','keys','96219NnCsff','substring','orgId','fs/promises','ParentId','DEFLATE','236CGqUCh','map','BUILD','http://soap.sforce.com/2006/04/metadata','190MYiQxL','body','Name','constructor','219hbxWPy','indexOf','UTF-8','cwd','log','toBuffer','3931368eqzHxF','../../git/parsers/mdapi','values','fetchComponentsDetailsByComponentsHistory','toString','generateAsync','45862QiiJIL','__importDefault','start','path','exists','base64','files','../utils/components-api','4610123hDrrRk','../../../constants','extractComponentPermissions','length','fileType','replace','Component_Name__c','addLocalFolder','file','push','/services/data/','Zip','Profile','text'];a54_0x44be=function(){return _0x19b2ff;};return a54_0x44be();}async function createDeployZip(_0x11a61b){const _0x26a426=a54_0x2fc512,_0x4675b2=new adm_zip_1[(_0x26a426(0xf9))]();return await _0x4675b2[_0x26a426(0xeb)](path_1['default']['join'](process[_0x26a426(0xd3)](),_0x26a426(0xfa),_0x11a61b,DEPLOY_DIR_NAME)),_0x4675b2;}async function insertZip(_0x5e2463,_0x37086e,_0x5c4646,_0x4d69b8,_0x3f4c3b){const _0x440273=a54_0x2fc512,_0x3dadfc={'ParentId':_0x37086e,'Name':_0x440273(0xca)+_0x5c4646,'Description':'BUILD'+_0x4d69b8,'Body':_0x3f4c3b},{data:_0x47589c}=await _0x5e2463[_0x440273(0xbd)](_0x440273(0xee)+constants_1[_0x440273(0xbf)]+'/sobjects/Attachment',_0x3dadfc);return _0x47589c['id'];}