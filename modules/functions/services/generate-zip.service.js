const a105_0x4094d0=a105_0x1e5b;(function(_0x115f60,_0x393545){const _0x3dc49a=a105_0x1e5b,_0x3fe18c=_0x115f60();while(!![]){try{const _0x135184=-parseInt(_0x3dc49a(0xdf))/0x1*(-parseInt(_0x3dc49a(0xa6))/0x2)+-parseInt(_0x3dc49a(0xda))/0x3*(parseInt(_0x3dc49a(0xe0))/0x4)+-parseInt(_0x3dc49a(0xc1))/0x5+-parseInt(_0x3dc49a(0xd6))/0x6+-parseInt(_0x3dc49a(0xd0))/0x7*(parseInt(_0x3dc49a(0xa4))/0x8)+parseInt(_0x3dc49a(0xee))/0x9*(parseInt(_0x3dc49a(0xd7))/0xa)+parseInt(_0x3dc49a(0xa7))/0xb;if(_0x135184===_0x393545)break;else _0x3fe18c['push'](_0x3fe18c['shift']());}catch(_0x5118e3){_0x3fe18c['push'](_0x3fe18c['shift']());}}}(a105_0x3565,0x5f99e));const a105_0x29375a=(function(){let _0xd9219f=!![];return function(_0x276475,_0x3ab838){const _0x381c4d=_0xd9219f?function(){const _0x46d3df=a105_0x1e5b;if(_0x3ab838){const _0x45d1fc=_0x3ab838[_0x46d3df(0xe9)](_0x276475,arguments);return _0x3ab838=null,_0x45d1fc;}}:function(){};return _0xd9219f=![],_0x381c4d;};}()),a105_0x55b3f5=a105_0x29375a(this,function(){const _0x3e3fc3=a105_0x1e5b;return a105_0x55b3f5['toString']()[_0x3e3fc3(0xb0)](_0x3e3fc3(0xe5))[_0x3e3fc3(0xa0)]()['constructor'](a105_0x55b3f5)[_0x3e3fc3(0xb0)](_0x3e3fc3(0xe5));});function a105_0x3565(){const _0x2d053a=['get','fetchAttachmentBody','search','components','values','Name','writeFile','generateAsync','generateAndDeployZip','fileName','dir','MetadataType','fs/promises','DEPLOYZIP','keys','buildObject','MAX_ZIP_SIZE','addLocalFolder','Component_Name__c','2751220cNsjxA','extractComponentPermissions','Body','map','permissionsets','createZip','../../shared/utils/fetch-attachments','@flosum/salesforce','Builder','splitZip','PartialRetrieve','fetchAttachmentsDetailsById','xml2js','Zip','name','460187oJbYDF','../utils/extract-component-permissions','unzip','../../git/internal/fs.internal','file','set','2047470YJujXu','895330dztsQQ','text','../../git/parsers/utils/zip','21kPqtAP','filter','Package','indexOf','replace','9507yaEjQF','206548yMXudX','__esModule','push','.temp','fileType','(((.+)+)+)+$','ParentId','removeNamespacePrefix','Component__r','apply','1.0','../../git/writers/mdapi.writer','BUILD','body','27waxIoq','DEFLATE','type','execute','MDApiWriter','mergeComponentPermissions','async','uuid','package.xml','destructiveChangesPre.xml','default','base64','UTF-8','__importDefault','cwd','Profile','retrieveAttachments','then','defineProperty','fetchComponentsDetailsByComponentsHistory','FOLDER_TO_METADATA_TYPE_MAP','substring','PermissionSet','MetadataConstants','files','toBuffer','toString','adm-zip','find','path','32XMhbSk','exists','122VbrsvZ','11648648GoINQg','orgId','listMetadataItem','join','/services/data/v','reduce','ComponentsApi'];a105_0x3565=function(){return _0x2d053a;};return a105_0x3565();}a105_0x55b3f5();'use strict';var __importDefault=this&&this[a105_0x4094d0(0x93)]||function(_0x51faa1){const _0x3b9b6e=a105_0x4094d0;return _0x51faa1&&_0x51faa1[_0x3b9b6e(0xe1)]?_0x51faa1:{'default':_0x51faa1};};Object[a105_0x4094d0(0x98)](exports,'__esModule',{'value':!![]}),exports[a105_0x4094d0(0xb6)]=void 0x0;const path_1=__importDefault(require(a105_0x4094d0(0xa3))),extract_component_permissions_1=require(a105_0x4094d0(0xd1)),logger_1=require('../classes/logger'),xml2js_1=require(a105_0x4094d0(0xcd)),zip_1=require(a105_0x4094d0(0xd9)),mdapi_writer_1=require(a105_0x4094d0(0xeb)),fs_internal_1=require(a105_0x4094d0(0xd3)),promises_1=require(a105_0x4094d0(0xba)),components_api_1=require('../utils/components-api'),adm_zip_1=__importDefault(require(a105_0x4094d0(0xa1))),uuid_1=require(a105_0x4094d0(0x8d)),fetch_attachments_1=require(a105_0x4094d0(0xc7)),salesforce_1=require(a105_0x4094d0(0xc8)),DESTRUCTIVE_CHANGES_PER_NAME=a105_0x4094d0(0x8f),DESTRUCTIVE_CHANGES_POST_NAME='destructiveChangesPost.xml',DEPLOY_DIR_NAME=a105_0x4094d0(0xbb),PERMISSION_SET_FOLDER_NAME=a105_0x4094d0(0xc5);async function generateAndDeployZip({attachmentsId:_0x1a93c7,isExtractComponentsPermissionSets:_0x529a28,isExtractComponentsProfiles:_0x599574,preDestructiveAttachmentId:_0x4773cf,postDestructiveAttachmentId:_0x218dbb,branchId:_0x3d7a7e,credentials:_0xf4d053,metadataLogId:_0x4bf5f1,environments:_0xd2b192,metaTypes:_0x57ab04,apiVersion:_0x36ff14},_0x474f8b,_0x3f91c7){const _0x3ac187=a105_0x4094d0;var _0x304eef;const _0x2abcb3=(0x0,uuid_1['v4'])();try{const _0x4890ee=await(0x0,fetch_attachments_1[_0x3ac187(0xcc)])(_0x474f8b,_0x1a93c7),_0x42fdb0=_0x4890ee[_0x3ac187(0xac)]((_0x377f42,_0x33cd62)=>({..._0x377f42,[_0x33cd62['Id']]:_0x33cd62[_0x3ac187(0xb3)]}),{}),_0x1dd527=await getComponents(_0x4890ee,_0x474f8b,_0x42fdb0),_0x44d611=await components_api_1['ComponentsApi'][_0x3ac187(0x99)](_0x474f8b,_0x4890ee['map'](({ParentId:_0x2abce4})=>_0x2abce4),_0x36ff14)[_0x3ac187(0x97)](_0x26f24c=>components_api_1[_0x3ac187(0xad)][_0x3ac187(0xe7)](_0x26f24c));if(_0x599574){const _0x1cfe5c=_0x1dd527['filter'](({fileType:_0x40cadc})=>_0x40cadc===_0x3ac187(0x95));await removePermission(_0x1cfe5c,_0x44d611);}const _0x48d08e=_0x1dd527['filter'](({fileType:_0x381d93})=>_0x381d93===_0x3ac187(0x9c));if(_0x48d08e['length']&&_0x529a28){await removePermission(_0x48d08e,_0x44d611);const {items:_0x54e256}=await retrieveTargetPermissionSets(_0x48d08e,_0x36ff14,_0x3f91c7);await mergePermissionSets(_0x48d08e,((_0x304eef=_0x54e256[_0x3ac187(0x9c)])===null||_0x304eef===void 0x0?void 0x0:_0x304eef[_0x3ac187(0xb1)])||[]);}await replaceEnvironments(_0x57ab04,_0xd2b192,_0x1dd527),await writeZip(_0x1dd527,_0x2abcb3),await generateAndWritePackageXML(_0x4890ee,_0x44d611,_0x2abcb3,_0x36ff14);_0x4773cf&&await saveDestructiveChanges(_0x474f8b,_0x4773cf,DESTRUCTIVE_CHANGES_PER_NAME,_0x2abcb3);_0x218dbb&&await saveDestructiveChanges(_0x474f8b,_0x218dbb,DESTRUCTIVE_CHANGES_POST_NAME,_0x2abcb3);const _0x37b1e7=(await createDeployZip(_0x2abcb3)[_0x3ac187(0x97)](_0x27535f=>{return _0x27535f;}))[_0x3ac187(0x9f)]()['toString'](_0x3ac187(0x91)),_0x2f0baa=_0x37b1e7['length'];if(_0x2f0baa>=components_api_1[_0x3ac187(0xbe)]){const _0x2285d8=await createDeployZip(_0x2abcb3),[_0x4547ea,_0x3f8e22]=await components_api_1[_0x3ac187(0xad)][_0x3ac187(0xca)](_0x2285d8,_0x2f0baa),_0x541f0c=await insertZip(_0x474f8b,_0x3d7a7e,_0xf4d053[_0x3ac187(0xa8)],_0x4bf5f1,_0x4547ea['toBuffer']()[_0x3ac187(0xa0)](_0x3ac187(0x91)),_0x36ff14),_0x8d464e=await insertZip(_0x474f8b,_0x3d7a7e,_0xf4d053[_0x3ac187(0xa8)],_0x4bf5f1,_0x3f8e22[_0x3ac187(0x9f)]()[_0x3ac187(0xa0)](_0x3ac187(0x91)),_0x36ff14);return _0x541f0c+','+_0x8d464e;}else return await insertZip(_0x474f8b,_0x3d7a7e,_0xf4d053['orgId'],_0x4bf5f1,_0x37b1e7,_0x36ff14);}catch(_0x152abe){throw _0x152abe;}finally{if(await fs_internal_1['FS'][_0x3ac187(0xa5)](path_1[_0x3ac187(0x90)][_0x3ac187(0xaa)](process[_0x3ac187(0x94)](),_0x3ac187(0xe3),_0x2abcb3)))await(0x0,promises_1['rm'])(path_1[_0x3ac187(0x90)][_0x3ac187(0xaa)](process[_0x3ac187(0x94)](),_0x3ac187(0xe3),_0x2abcb3),{'recursive':!![]});}}exports['generateAndDeployZip']=generateAndDeployZip;async function getComponents(_0x479066,_0x504da6,_0x28c6da){const _0x5f5b6d=a105_0x4094d0,_0x387e4e=[],_0x232113=await(0x0,fetch_attachments_1[_0x5f5b6d(0x96)])(_0x479066,_0x504da6);return await getComponentFromZip(_0x232113,_0x28c6da)[_0x5f5b6d(0x97)](_0x2ea861=>{const _0x5b6ee8=_0x5f5b6d;_0x387e4e[_0x5b6ee8(0xe2)](..._0x2ea861);}),_0x387e4e;}async function getComponentFromZip(_0x23ff58,_0x1ddb80){const _0x23e5c4=a105_0x4094d0,_0x4257a2=[];for(const _0x35c4af of _0x23ff58){const _0xd079ff=await zip_1[_0x23e5c4(0xce)][_0x23e5c4(0xd2)](_0x35c4af[_0x23e5c4(0xb2)][_0x23e5c4(0xc3)]);for(const _0x4a1b51 in _0xd079ff[_0x23e5c4(0x9e)]){!_0xd079ff[_0x23e5c4(0x9e)][_0x4a1b51][_0x23e5c4(0xb8)]&&_0x4257a2[_0x23e5c4(0xe2)]({'fileName':_0x4a1b51[_0x23e5c4(0x9b)](_0x4a1b51[_0x23e5c4(0xdd)]('/')+0x1),'fileType':_0x1ddb80[_0x35c4af['id']],'body':_0x35c4af[_0x23e5c4(0xb2)][_0x23e5c4(0xc3)]});}}return _0x4257a2;}async function removePermission(_0x363675,_0xf2a36d){const _0x4526ee=a105_0x4094d0;for(const _0x560180 of _0x363675){const _0x41301e=await zip_1[_0x4526ee(0xce)][_0x4526ee(0xd2)](_0x560180[_0x4526ee(0xed)]),_0x493a48=[];for(const _0x325ae7 in _0x41301e[_0x4526ee(0x9e)]){!_0x41301e[_0x4526ee(0x9e)][_0x325ae7][_0x4526ee(0xb8)]&&_0x493a48['push']({'fileName':_0x325ae7,'body':await _0x41301e[_0x4526ee(0x9e)][_0x325ae7][_0x4526ee(0x8c)]('text')});}const _0x23cbfc=await(0x0,extract_component_permissions_1[_0x4526ee(0xc2)])(_0x493a48[0x0]['body'][_0x4526ee(0xa0)](),_0xf2a36d,_0x560180[_0x4526ee(0xe4)]),_0x3e7cff=new xml2js_1[(_0x4526ee(0xc9))]({'xmldec':{'version':_0x4526ee(0xea),'encoding':_0x4526ee(0x92)}}),_0x5a9a9d=_0x3e7cff[_0x4526ee(0xbd)](_0x23cbfc),_0xc0a6e2=zip_1[_0x4526ee(0xce)]['createZip']();_0xc0a6e2[_0x4526ee(0xd4)](_0x493a48[0x0][_0x4526ee(0xb7)],_0x5a9a9d),_0x560180[_0x4526ee(0xed)]=await _0xc0a6e2[_0x4526ee(0xb5)]({'type':_0x4526ee(0x91),'compression':_0x4526ee(0xef),'compressionOptions':{'level':0x6}});}}async function retrieveTargetPermissionSets(_0x89eae5,_0x546bb3,_0x4367ac){const _0x3310fa=a105_0x4094d0,_0x449ae9=_0x89eae5['map'](_0x4258db=>PERMISSION_SET_FOLDER_NAME+'/'+_0x4258db[_0x3310fa(0xb7)])[_0x3310fa(0xaa)](';'),_0x4b5eb6=[{'field':_0x3310fa(0xb7),'option':salesforce_1['DeclarativeFilterOptions']['IN'],'value':_0x449ae9}],_0x268d89=new logger_1['Logger']();return new salesforce_1[(_0x3310fa(0xcb))](_0x546bb3,_0x4367ac,_0x268d89,_0x4b5eb6,null,[salesforce_1[_0x3310fa(0xb9)]['PERMISSION_SET']])[_0x3310fa(0x89)]();}async function mergePermissionSets(_0x1c512e,_0x153549){const _0x4f77fb=a105_0x4094d0,_0x230397=_0x153549[_0x4f77fb(0xac)]((_0xda23cf,_0xcc8cf5)=>_0xda23cf[_0x4f77fb(0xd5)](_0xcc8cf5[_0x4f77fb(0xa9)][_0x4f77fb(0xb7)],_0xcc8cf5),new Map());for(const _0x55f2ae of _0x1c512e){const _0x10781f=PERMISSION_SET_FOLDER_NAME+'/'+_0x55f2ae[_0x4f77fb(0xb7)],_0xcd9d70=_0x230397[_0x4f77fb(0xae)](_0x10781f);if(!_0xcd9d70)continue;const _0x458530=await zip_1['Zip'][_0x4f77fb(0xd2)](_0x55f2ae[_0x4f77fb(0xed)]),_0x4b9c47=await _0x458530[_0x4f77fb(0x9e)][_0x10781f][_0x4f77fb(0x8c)]('text'),_0x5ef1d5=_0xcd9d70[_0x4f77fb(0x9e)][_0x10781f][_0x4f77fb(0xa0)](),_0x554e0e=await(0x0,extract_component_permissions_1[_0x4f77fb(0x8b)])(_0x4b9c47,_0x5ef1d5,_0x55f2ae[_0x4f77fb(0xe4)]),_0x54e837=zip_1[_0x4f77fb(0xce)][_0x4f77fb(0xc6)]();_0x54e837[_0x4f77fb(0xd4)](_0x10781f,_0x554e0e),_0x55f2ae['body']=await _0x54e837[_0x4f77fb(0xb5)]({'type':_0x4f77fb(0x91),'compression':'DEFLATE','compressionOptions':{'level':0x6}});}}async function replaceEnvironments(_0x9a67c5,_0x4fde2a,_0x97ab79){const _0x1884c3=a105_0x4094d0;for(const _0x1b3132 of _0x97ab79){if(_0x9a67c5['every'](_0x6026d8=>_0x6026d8!==_0x1b3132[_0x1884c3(0xe4)]))continue;const _0x34c8f8=await zip_1[_0x1884c3(0xce)][_0x1884c3(0xd2)](_0x1b3132[_0x1884c3(0xed)]);for(const _0x27f565 in _0x34c8f8['files']){if(!_0x34c8f8[_0x1884c3(0x9e)][_0x27f565][_0x1884c3(0xb8)]){let _0x14f06a=await _0x34c8f8['files'][_0x27f565]['async'](_0x1884c3(0xd8));for(const _0x2b46f9 of Object[_0x1884c3(0xbc)](_0x4fde2a)){const _0x36a9d7=new RegExp('%%'+_0x2b46f9+'%%','g');_0x14f06a=_0x14f06a[_0x1884c3(0xde)](_0x36a9d7,_0x4fde2a[_0x2b46f9]);}_0x34c8f8[_0x1884c3(0xd4)](_0x27f565,_0x14f06a);}}_0x1b3132[_0x1884c3(0xed)]=await _0x34c8f8['generateAsync']({'type':_0x1884c3(0x91),'compression':_0x1884c3(0xef),'compressionOptions':{'level':0x6}});}}async function writeZip(_0x5bcd0f,_0x549c8c){const _0x34c121=a105_0x4094d0,_0x39a3aa=new mdapi_writer_1[(_0x34c121(0x8a))]({'components':_0x5bcd0f,'sourceDir':path_1[_0x34c121(0x90)][_0x34c121(0xaa)](process[_0x34c121(0x94)](),_0x34c121(0xe3),_0x549c8c,DEPLOY_DIR_NAME),'skipChildErrors':![]});await _0x39a3aa['execute']();}function a105_0x1e5b(_0x243375,_0x312694){const _0x1fb7bd=a105_0x3565();return a105_0x1e5b=function(_0x55b3f5,_0x29375a){_0x55b3f5=_0x55b3f5-0x88;let _0x3565d2=_0x1fb7bd[_0x55b3f5];return _0x3565d2;},a105_0x1e5b(_0x243375,_0x312694);}async function generateAndWritePackageXML(_0x2ea7f9,_0x1de082,_0x5ef4a1,_0xd50a3){const _0x475cbf=a105_0x4094d0,_0x536e82=getComponentsTypeAndName(_0x2ea7f9,_0x1de082),_0x401a84=[...new Set(_0x536e82[_0x475cbf(0xc4)](_0xb58e17=>_0xb58e17[_0x475cbf(0x88)]))],_0x31ed08={'Package':{'$':{'xmlns':'http://soap.sforce.com/2006/04/metadata'},'types':[],'version':''+_0xd50a3}};for(const _0x8e9195 of _0x401a84){const _0x216ccc=_0x536e82[_0x475cbf(0xdb)](_0x239854=>_0x239854[_0x475cbf(0x88)]===_0x8e9195)['map'](_0x5bdaac=>_0x5bdaac[_0x475cbf(0xcf)]),_0x18a0f0={'members':_0x216ccc,'name':_0x8e9195};_0x31ed08[_0x475cbf(0xdc)]['types'][_0x475cbf(0xe2)](_0x18a0f0);}const _0x3301c9=new xml2js_1['Builder']({'xmldec':{'version':_0x475cbf(0xea),'encoding':_0x475cbf(0x92)}}),_0x21c86f=_0x3301c9[_0x475cbf(0xbd)](_0x31ed08);await fs_internal_1['FS'][_0x475cbf(0xb4)](path_1['default'][_0x475cbf(0xaa)](process['cwd'](),_0x475cbf(0xe3),_0x5ef4a1,DEPLOY_DIR_NAME,_0x475cbf(0x8e)),_0x21c86f);}function getComponentsTypeAndName(_0x206d59,_0x4db694){const _0x3e362c=a105_0x4094d0;return _0x206d59[_0x3e362c(0xac)]((_0x581ad3,_0x5883a0)=>{const _0x24b208=_0x3e362c,_0x403c6e=_0x4db694[_0x24b208(0xa2)](_0x3caf73=>_0x3caf73['Id']===_0x5883a0[_0x24b208(0xe6)]);return _0x403c6e&&_0x581ad3[_0x24b208(0xe2)]({'name':_0x403c6e[_0x24b208(0xe8)][_0x24b208(0xc0)],'type':salesforce_1[_0x24b208(0x9d)][_0x24b208(0x9a)][_0x5883a0[_0x24b208(0xb3)]]||_0x5883a0['Name']}),_0x581ad3;},[]);}async function saveDestructiveChanges(_0x2c241f,_0x9a6c55,_0x356d46,_0x5efd3b){const _0x40a652=a105_0x4094d0,_0x23dc9e=(await(0x0,fetch_attachments_1[_0x40a652(0xaf)])(_0x2c241f,_0x9a6c55))['toString']();await fs_internal_1['FS'][_0x40a652(0xb4)](path_1[_0x40a652(0x90)]['join'](process[_0x40a652(0x94)](),_0x40a652(0xe3),_0x5efd3b,DEPLOY_DIR_NAME,_0x356d46),_0x23dc9e);}async function createDeployZip(_0x30991e){const _0x5b09cf=a105_0x4094d0,_0x269c33=new adm_zip_1[(_0x5b09cf(0x90))]();return await _0x269c33[_0x5b09cf(0xbf)](path_1['default'][_0x5b09cf(0xaa)](process[_0x5b09cf(0x94)](),_0x5b09cf(0xe3),_0x30991e,DEPLOY_DIR_NAME)),_0x269c33;}async function insertZip(_0x20f0c0,_0x388d7d,_0x2c1fba,_0x47dc13,_0x14ccd3,_0x12583d){const _0xefe61d=a105_0x4094d0,_0x4d95e1={'ParentId':_0x388d7d,'Name':_0xefe61d(0xec)+_0x2c1fba,'Description':_0xefe61d(0xec)+_0x47dc13,'Body':_0x14ccd3},{data:_0x10bf25}=await _0x20f0c0['post'](_0xefe61d(0xab)+_0x12583d+'/sobjects/Attachment',_0x4d95e1);return _0x10bf25['id'];}