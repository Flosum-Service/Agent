const a85_0x56efca=a85_0x3aa1;(function(_0x102329,_0x1610d2){const _0x1673f4=a85_0x3aa1,_0x416ab2=_0x102329();while(!![]){try{const _0x3deb26=-parseInt(_0x1673f4(0x101))/0x1+-parseInt(_0x1673f4(0x10d))/0x2*(parseInt(_0x1673f4(0x113))/0x3)+parseInt(_0x1673f4(0xf7))/0x4*(-parseInt(_0x1673f4(0x14a))/0x5)+-parseInt(_0x1673f4(0x125))/0x6+parseInt(_0x1673f4(0xfa))/0x7*(parseInt(_0x1673f4(0x102))/0x8)+parseInt(_0x1673f4(0x115))/0x9*(-parseInt(_0x1673f4(0x117))/0xa)+parseInt(_0x1673f4(0x142))/0xb;if(_0x3deb26===_0x1610d2)break;else _0x416ab2['push'](_0x416ab2['shift']());}catch(_0x5e9e23){_0x416ab2['push'](_0x416ab2['shift']());}}}(a85_0x4e0f,0xf310a));const a85_0x473c2e=(function(){let _0x2c7993=!![];return function(_0x2e4742,_0x532b63){const _0x1b0f76=_0x2c7993?function(){const _0x5c2f49=a85_0x3aa1;if(_0x532b63){const _0x2cac1d=_0x532b63[_0x5c2f49(0xf5)](_0x2e4742,arguments);return _0x532b63=null,_0x2cac1d;}}:function(){};return _0x2c7993=![],_0x1b0f76;};}()),a85_0x16c061=a85_0x473c2e(this,function(){const _0x59092c=a85_0x3aa1;return a85_0x16c061[_0x59092c(0xfe)]()['search']('(((.+)+)+)+$')[_0x59092c(0xfe)]()[_0x59092c(0x126)](a85_0x16c061)[_0x59092c(0x13d)]('(((.+)+)+)+$');});a85_0x16c061();function a85_0x4e0f(){const _0x3bfb64=['async','../utils/extract-component-permissions','adm-zip','86031770CAsWFf','../utils/components-api','src','writeFile','toBuffer','UTF-8','keys','name','8648755GTqcoK','then','/sobjects/Attachment','substring','files','apply','SALESFORCE_API_VERSION','4lTdBPl','post','join','6314329brCulp','fetchAttachmentBody','destructiveChangesPost.xml','MAX_ZIP_SIZE','toString','Body','start','618002JtJBVv','8gcmREr','../../shared/utils/fetch-attachments','extractComponentPermissions','../../../constants','__importDefault','addLocalFolder','after\x20create\x20second\x20zip','1.0','ComponentsApi','filter','buildObject','51178AceCwD','__esModule','MDApiWriter','body','length','fileName','204CTVMDm','types','198LNMqgw','text','870420BonPlr','default','dir','.temp','Builder','fetchComponentsDetailsByComponentsHistory','../../git/parsers/utils/zip','Name','push','type','orgId','path','replace','map','10348764qtlPfy','constructor','PermissionSet','defineProperty','base64','reduce','fetchAttachmentsDetailsById','BUILD','../../git/parsers/mdapi','indexOf','generateAndDeployZip','../../git/internal/fs.internal','every','file','DEPLOYZIP','values','fileType','cwd','unzip','/services/data/','DEFLATE','uuid','Zip','after\x20create\x20zip','search','Profile'];a85_0x4e0f=function(){return _0x3bfb64;};return a85_0x4e0f();}'use strict';var __importDefault=this&&this[a85_0x56efca(0x106)]||function(_0x4f3410){const _0x30859a=a85_0x56efca;return _0x4f3410&&_0x4f3410[_0x30859a(0x10e)]?_0x4f3410:{'default':_0x4f3410};};Object[a85_0x56efca(0x128)](exports,a85_0x56efca(0x10e),{'value':!![]}),exports[a85_0x56efca(0x12f)]=void 0x0;const constants_1=require(a85_0x56efca(0x105)),path_1=__importDefault(require(a85_0x56efca(0x122))),extract_component_permissions_1=require(a85_0x56efca(0x140)),xml2js_1=require('xml2js'),zip_1=require(a85_0x56efca(0x11d)),mdapi_1=require(a85_0x56efca(0x12d)),fs_internal_1=require(a85_0x56efca(0x130)),promises_1=require('fs/promises'),components_api_1=require(a85_0x56efca(0x143)),adm_zip_1=__importDefault(require(a85_0x56efca(0x141))),uuid_1=require(a85_0x56efca(0x13a)),fetch_attachments_1=require(a85_0x56efca(0x103)),DESTRUCTIVE_CHANGES_PER_NAME='destructiveChangesPre.xml',DESTRUCTIVE_CHANGES_POST_NAME=a85_0x56efca(0xfc),DEPLOY_DIR_NAME=a85_0x56efca(0x133);async function generateAndDeployZip({attachmentsId:_0x41abbf,isExtractComponentsPermissions:_0x6cf5f4,preDestructiveAttachmentId:_0x25afde,postDestructiveAttachmentId:_0x4f59fb,branchId:_0xed10dc,credentials:_0x225304,metadataLogId:_0x37e36b,environments:_0x190f3d,metaTypes:_0x595c4d},_0x36b2d5){const _0x499f12=a85_0x56efca,_0x327eec=(0x0,uuid_1['v4'])();try{const _0x476a41=await(0x0,fetch_attachments_1[_0x499f12(0x12b)])(_0x36b2d5,_0x41abbf),_0x5c468e=_0x476a41[_0x499f12(0x12a)]((_0x3420d2,_0x27b1cc)=>({..._0x3420d2,[_0x27b1cc['Id']]:_0x27b1cc['Name']}),{}),_0xd5524d=await getComponents(_0x476a41,_0x36b2d5,_0x5c468e),_0x26526e=await components_api_1[_0x499f12(0x10a)][_0x499f12(0x11c)](_0x36b2d5,_0x476a41[_0x499f12(0x124)](({ParentId:_0x44b31c})=>_0x44b31c))[_0x499f12(0xf1)](_0x59b875=>components_api_1[_0x499f12(0x10a)]['removeNamespacePrefix'](_0x59b875));if(_0x6cf5f4){const _0x37cea5=_0xd5524d[_0x499f12(0x10b)](({fileType:_0x504443})=>_0x504443===_0x499f12(0x13e)||_0x504443===_0x499f12(0x127));await removePermission(_0x37cea5,_0x26526e);}await replaceEnvironments(_0x595c4d,_0x190f3d,_0xd5524d),await writeZip(_0xd5524d,_0x327eec),await generateAndWritePackageXML(_0x476a41,_0x26526e,_0x327eec);_0x25afde&&await saveDestructiveChanges(_0x36b2d5,_0x25afde,DESTRUCTIVE_CHANGES_PER_NAME,_0x327eec);_0x4f59fb&&await saveDestructiveChanges(_0x36b2d5,_0x4f59fb,DESTRUCTIVE_CHANGES_POST_NAME,_0x327eec);const _0x3f9bc6=(await createDeployZip(_0x327eec)[_0x499f12(0xf1)](_0x2c853a=>{return _0x2c853a;}))[_0x499f12(0x146)]()[_0x499f12(0xfe)](_0x499f12(0x129));console['log'](_0x499f12(0x13c));const _0x1ad3b7=_0x3f9bc6[_0x499f12(0x111)];if(_0x1ad3b7>=components_api_1[_0x499f12(0xfd)]){const _0x15c3fe=await createDeployZip(_0x327eec);console['log'](_0x499f12(0x108));const [_0xf0007c,_0x1a963f]=await components_api_1[_0x499f12(0x10a)]['splitZip'](_0x15c3fe,_0x1ad3b7),_0x41175e=await insertZip(_0x36b2d5,_0xed10dc,_0x225304[_0x499f12(0x121)],_0x37e36b,_0xf0007c['toBuffer']()[_0x499f12(0xfe)](_0x499f12(0x129))),_0x22c258=await insertZip(_0x36b2d5,_0xed10dc,_0x225304[_0x499f12(0x121)],_0x37e36b,_0x1a963f['toBuffer']()[_0x499f12(0xfe)](_0x499f12(0x129)));return _0x41175e+','+_0x22c258;}else return await insertZip(_0x36b2d5,_0xed10dc,_0x225304[_0x499f12(0x121)],_0x37e36b,_0x3f9bc6);}catch(_0x37e88c){throw _0x37e88c;}finally{if(await fs_internal_1['FS']['exists'](path_1[_0x499f12(0x118)][_0x499f12(0xf9)](process[_0x499f12(0x136)](),_0x499f12(0x11a),_0x327eec)))await(0x0,promises_1['rm'])(path_1[_0x499f12(0x118)][_0x499f12(0xf9)](process['cwd'](),_0x499f12(0x11a),_0x327eec),{'recursive':!![]});}}exports['generateAndDeployZip']=generateAndDeployZip;async function getComponents(_0x536ac3,_0x11fa7f,_0x194c91){const _0x57762c=a85_0x56efca,_0x18c2fc=[],_0x4529fa=await(0x0,fetch_attachments_1['retrieveAttachments'])(_0x536ac3,_0x11fa7f);return await getComponentFromZip(_0x4529fa,_0x194c91)[_0x57762c(0xf1)](_0x25e314=>{_0x18c2fc['push'](..._0x25e314);}),_0x18c2fc;}async function getComponentFromZip(_0x51bf5a,_0x2742ff){const _0x1c5f7e=a85_0x56efca,_0x3c9b8a=[];for(const _0x57817d of _0x51bf5a){const _0x432831=await zip_1['Zip'][_0x1c5f7e(0x137)](_0x57817d[_0x1c5f7e(0x134)]['Body']);for(const _0x21b663 in _0x432831[_0x1c5f7e(0xf4)]){!_0x432831['files'][_0x21b663][_0x1c5f7e(0x119)]&&_0x3c9b8a[_0x1c5f7e(0x11f)]({'fileName':_0x21b663['substring'](_0x21b663[_0x1c5f7e(0x12e)]('/')+0x1),'fileType':_0x2742ff[_0x57817d['id']],'body':_0x57817d['values'][_0x1c5f7e(0xff)]});}}return _0x3c9b8a;}async function removePermission(_0x3ea5d6,_0x4e6b1f){const _0x30fae4=a85_0x56efca;for(const _0xdbfebc of _0x3ea5d6){const _0x4c53f2=await zip_1[_0x30fae4(0x13b)]['unzip'](_0xdbfebc[_0x30fae4(0x110)]),_0x5a6ced=[];for(const _0x278f55 in _0x4c53f2[_0x30fae4(0xf4)]){!_0x4c53f2['files'][_0x278f55][_0x30fae4(0x119)]&&_0x5a6ced[_0x30fae4(0x11f)]({'fileName':_0x278f55,'body':await _0x4c53f2[_0x30fae4(0xf4)][_0x278f55]['async'](_0x30fae4(0x116))});}const _0x43049b=await(0x0,extract_component_permissions_1[_0x30fae4(0x104)])(_0x5a6ced[0x0][_0x30fae4(0x110)][_0x30fae4(0xfe)](),_0x4e6b1f,_0xdbfebc[_0x30fae4(0x135)]),_0x3fb52c=new xml2js_1[(_0x30fae4(0x11b))]({'xmldec':{'version':_0x30fae4(0x109),'encoding':_0x30fae4(0x147)}}),_0x488dbf=_0x3fb52c[_0x30fae4(0x10c)](_0x43049b),_0x486e75=zip_1[_0x30fae4(0x13b)]['createZip']();_0x486e75['file'](_0x5a6ced[0x0][_0x30fae4(0x112)],_0x488dbf),_0xdbfebc[_0x30fae4(0x110)]=await _0x486e75['generateAsync']({'type':_0x30fae4(0x129),'compression':_0x30fae4(0x139),'compressionOptions':{'level':0x6}});}}async function replaceEnvironments(_0x5aadd6,_0x4a20dc,_0x50b755){const _0x33b48e=a85_0x56efca;for(const _0x56326c of _0x50b755){if(_0x5aadd6[_0x33b48e(0x131)](_0x4cfad3=>_0x4cfad3!==_0x56326c[_0x33b48e(0x135)]))continue;const _0x746872=await zip_1['Zip']['unzip'](_0x56326c[_0x33b48e(0x110)]);for(const _0x3605cb in _0x746872['files']){if(!_0x746872[_0x33b48e(0xf4)][_0x3605cb][_0x33b48e(0x119)]){let _0x40c0b1=await _0x746872[_0x33b48e(0xf4)][_0x3605cb][_0x33b48e(0x13f)](_0x33b48e(0x116));for(const _0x294166 of Object[_0x33b48e(0x148)](_0x4a20dc)){const _0x2ec063=new RegExp('%%'+_0x294166+'%%','g');_0x40c0b1=_0x40c0b1[_0x33b48e(0x123)](_0x2ec063,_0x4a20dc[_0x294166]);}_0x746872[_0x33b48e(0x132)](_0x3605cb,_0x40c0b1);}}_0x56326c[_0x33b48e(0x110)]=await _0x746872['generateAsync']({'type':'base64','compression':_0x33b48e(0x139),'compressionOptions':{'level':0x6}});}}async function writeZip(_0x5a2935,_0x2e1112){const _0x4f207c=a85_0x56efca,_0x5755bf=new mdapi_1[(_0x4f207c(0x10f))]({'components':_0x5a2935,'sourceDir':path_1[_0x4f207c(0x118)][_0x4f207c(0xf9)](process[_0x4f207c(0x136)](),_0x4f207c(0x11a),_0x2e1112,DEPLOY_DIR_NAME,_0x4f207c(0x144)),'skipChildErrors':![]});await _0x5755bf[_0x4f207c(0x100)]();}async function generateAndWritePackageXML(_0x464edf,_0x3c2fc1,_0x1c00c9){const _0x5a3ef0=a85_0x56efca,_0x1488aa=getComponentsTypeAndName(_0x464edf,_0x3c2fc1),_0x59e1c3=[...new Set(_0x1488aa['map'](_0xaca2eb=>_0xaca2eb[_0x5a3ef0(0x120)]))],_0xa2c0dd={'Package':{'$':{'xmlns':'http://soap.sforce.com/2006/04/metadata'},'types':[],'version':''+constants_1['SALESFORCE_API_VERSION'][_0x5a3ef0(0xf3)](0x1)}};for(const _0x4b49a0 of _0x59e1c3){const _0x4b3c2f=_0x1488aa[_0x5a3ef0(0x10b)](_0x5aaf5f=>_0x5aaf5f['type']===_0x4b49a0)[_0x5a3ef0(0x124)](_0x1c527b=>_0x1c527b[_0x5a3ef0(0x149)]),_0x12c5ba={'members':_0x4b3c2f,'name':_0x4b49a0};_0xa2c0dd['Package'][_0x5a3ef0(0x114)][_0x5a3ef0(0x11f)](_0x12c5ba);}const _0x3e1aa3=new xml2js_1[(_0x5a3ef0(0x11b))]({'xmldec':{'version':_0x5a3ef0(0x109),'encoding':_0x5a3ef0(0x147)}}),_0x3d9d71=_0x3e1aa3[_0x5a3ef0(0x10c)](_0xa2c0dd);await fs_internal_1['FS'][_0x5a3ef0(0x145)](path_1[_0x5a3ef0(0x118)][_0x5a3ef0(0xf9)](process[_0x5a3ef0(0x136)](),'.temp',_0x1c00c9,DEPLOY_DIR_NAME,_0x5a3ef0(0x144),'package.xml'),_0x3d9d71);}function getComponentsTypeAndName(_0x3f4c8a,_0xa1a478){const _0x4c620f=a85_0x56efca;return _0x3f4c8a[_0x4c620f(0x12a)]((_0x250be3,_0x3bfaf9)=>{const _0xa2e505=_0x4c620f,_0x124d70=_0xa1a478['find'](_0x3f7f34=>_0x3f7f34['Id']===_0x3bfaf9['ParentId']);return _0x124d70&&_0x250be3[_0xa2e505(0x11f)]({'name':_0x124d70['Component__r']['Component_Name__c'],'type':_0x3bfaf9[_0xa2e505(0x11e)]}),_0x250be3;},[]);}async function saveDestructiveChanges(_0x21a7d5,_0x32e018,_0x479bca,_0x250e11){const _0x30654e=a85_0x56efca,_0x2842e1=(await(0x0,fetch_attachments_1[_0x30654e(0xfb)])(_0x21a7d5,_0x32e018))['toString']();await fs_internal_1['FS'][_0x30654e(0x145)](path_1[_0x30654e(0x118)][_0x30654e(0xf9)](process['cwd'](),_0x30654e(0x11a),_0x250e11,DEPLOY_DIR_NAME,_0x30654e(0x144),_0x479bca),_0x2842e1);}function a85_0x3aa1(_0x269f04,_0x1b77c8){const _0x1fb772=a85_0x4e0f();return a85_0x3aa1=function(_0x16c061,_0x473c2e){_0x16c061=_0x16c061-0xf1;let _0x4e0fa4=_0x1fb772[_0x16c061];return _0x4e0fa4;},a85_0x3aa1(_0x269f04,_0x1b77c8);}async function createDeployZip(_0x175d76){const _0x1ce871=a85_0x56efca,_0x3a07b1=new adm_zip_1[(_0x1ce871(0x118))]();return await _0x3a07b1[_0x1ce871(0x107)](path_1[_0x1ce871(0x118)][_0x1ce871(0xf9)](process['cwd'](),_0x1ce871(0x11a),_0x175d76,DEPLOY_DIR_NAME)),_0x3a07b1;}async function insertZip(_0x3ac94b,_0xd58445,_0x1400ab,_0x5e94c3,_0x3e56de){const _0x12370d=a85_0x56efca,_0x2af1a9={'ParentId':_0xd58445,'Name':_0x12370d(0x12c)+_0x1400ab,'Description':_0x12370d(0x12c)+_0x5e94c3,'Body':_0x3e56de},{data:_0x29ea6b}=await _0x3ac94b[_0x12370d(0xf8)](_0x12370d(0x138)+constants_1[_0x12370d(0xf6)]+_0x12370d(0xf2),_0x2af1a9);return _0x29ea6b['id'];}