const a105_0x14348f=a105_0x3ba0;(function(_0x561c52,_0x100457){const _0x6ff90f=a105_0x3ba0,_0x491b27=_0x561c52();while(!![]){try{const _0x587b45=-parseInt(_0x6ff90f(0xd2))/0x1*(parseInt(_0x6ff90f(0xa9))/0x2)+parseInt(_0x6ff90f(0xaf))/0x3+-parseInt(_0x6ff90f(0xe4))/0x4*(-parseInt(_0x6ff90f(0xef))/0x5)+parseInt(_0x6ff90f(0xf9))/0x6*(parseInt(_0x6ff90f(0xa4))/0x7)+-parseInt(_0x6ff90f(0xb2))/0x8*(-parseInt(_0x6ff90f(0xe9))/0x9)+parseInt(_0x6ff90f(0xdc))/0xa*(parseInt(_0x6ff90f(0xfa))/0xb)+parseInt(_0x6ff90f(0x101))/0xc*(-parseInt(_0x6ff90f(0xe3))/0xd);if(_0x587b45===_0x100457)break;else _0x491b27['push'](_0x491b27['shift']());}catch(_0x58b82c){_0x491b27['push'](_0x491b27['shift']());}}}(a105_0x5bee,0x6ca96));const a105_0xf1f7dd=(function(){let _0x9c328a=!![];return function(_0x360210,_0x3ea57e){const _0x4e8b5f=_0x9c328a?function(){if(_0x3ea57e){const _0x97cfb3=_0x3ea57e['apply'](_0x360210,arguments);return _0x3ea57e=null,_0x97cfb3;}}:function(){};return _0x9c328a=![],_0x4e8b5f;};}()),a105_0x2e12c6=a105_0xf1f7dd(this,function(){const _0x5aee5b=a105_0x3ba0;return a105_0x2e12c6[_0x5aee5b(0xf8)]()[_0x5aee5b(0xba)]('(((.+)+)+)+$')[_0x5aee5b(0xf8)]()['constructor'](a105_0x2e12c6)[_0x5aee5b(0xba)](_0x5aee5b(0xd4));});a105_0x2e12c6();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x199228){const _0x59d700=a105_0x3ba0;return _0x199228&&_0x199228[_0x59d700(0xc8)]?_0x199228:{'default':_0x199228};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a105_0x14348f(0xf1)]=void 0x0;const path_1=__importDefault(require(a105_0x14348f(0xb8))),extract_component_permissions_1=require(a105_0x14348f(0xf4)),logger_1=require(a105_0x14348f(0xa6)),xml2js_1=require(a105_0x14348f(0xb6)),zip_1=require('../../git/parsers/utils/zip'),mdapi_writer_1=require(a105_0x14348f(0x102)),fs_internal_1=require('../../git/internal/fs.internal'),promises_1=require(a105_0x14348f(0xe7)),components_api_1=require(a105_0x14348f(0xf2)),adm_zip_1=__importDefault(require(a105_0x14348f(0xd9))),uuid_1=require(a105_0x14348f(0x104)),fetch_attachments_1=require(a105_0x14348f(0xbb)),salesforce_1=require(a105_0x14348f(0xfb)),DESTRUCTIVE_CHANGES_PER_NAME=a105_0x14348f(0xb1),DESTRUCTIVE_CHANGES_POST_NAME=a105_0x14348f(0xfd),DEPLOY_DIR_NAME='DEPLOYZIP',PERMISSION_SET_FOLDER_NAME=a105_0x14348f(0xec);function a105_0x5bee(){const _0x429dd4=['Component_Name__c','1188813coCQHm','Builder','destructiveChangesPre.xml','7208RGAoNH','DeclarativeFilterOptions','retrieveAttachments','body','xml2js','async','path','MDApiWriter','search','../../shared/utils/fetch-attachments','buildObject','reduce','FOLDER_TO_METADATA_TYPE_MAP','unzip','files','cwd','fetchAttachmentBody','exists','mergeComponentPermissions','set','/services/data/v','src','__esModule','MAX_ZIP_SIZE','name','fetchAttachmentsDetailsById','dir','MetadataType','Logger','1.0','execute','get','107ufzxbm','base64','(((.+)+)+)+$','extractComponentPermissions','UTF-8','keys','Package','adm-zip','join','map','400jnXsnE','orgId','fileName','createZip','Name','PERMISSION_SET','then','286QzoZtX','580588pfhOHy','post','toBuffer','fs/promises','/sobjects/Attachment','1935jmeIBz','ComponentsApi','package.xml','permissionsets','text','addLocalFolder','5FkGMym','BUILD','generateAndDeployZip','../utils/components-api','generateAsync','../utils/extract-component-permissions','Zip','types','MetadataConstants','toString','9102zptqKD','188947mVcakt','@flosum/salesforce','fileType','destructiveChangesPost.xml','.temp','listMetadataItem','writeFile','430476kDcStv','../../git/writers/mdapi.writer','removeNamespacePrefix','uuid','Profile','push','filter','1169NahjDZ','values','../classes/logger','substring','file','8248tdQOKp','default','DEFLATE','type','replace'];a105_0x5bee=function(){return _0x429dd4;};return a105_0x5bee();}function a105_0x3ba0(_0x2efb8d,_0xf9a2f3){const _0x1b8523=a105_0x5bee();return a105_0x3ba0=function(_0x2e12c6,_0xf1f7dd){_0x2e12c6=_0x2e12c6-0xa1;let _0x5bee41=_0x1b8523[_0x2e12c6];return _0x5bee41;},a105_0x3ba0(_0x2efb8d,_0xf9a2f3);}async function generateAndDeployZip({attachmentsId:_0x4220b7,isExtractComponentsPermissionSets:_0x29a7a3,isExtractComponentsProfiles:_0x283bcc,preDestructiveAttachmentId:_0xaa2e85,postDestructiveAttachmentId:_0x4402b8,branchId:_0x2ae509,credentials:_0x2f1a74,metadataLogId:_0xffc3da,environments:_0x3c6673,metaTypes:_0x191be6,apiVersion:_0x3a6ad4},_0xa682e6,_0x596b70){const _0x26c651=a105_0x14348f;var _0x2a8de1;const _0x1300bc=(0x0,uuid_1['v4'])();try{const _0x36f6f0=await(0x0,fetch_attachments_1[_0x26c651(0xcb)])(_0xa682e6,_0x4220b7),_0x41b684=_0x36f6f0['reduce']((_0x419a82,_0x2f4a38)=>({..._0x419a82,[_0x2f4a38['Id']]:_0x2f4a38['Name']}),{}),_0x42eb92=await getComponents(_0x36f6f0,_0xa682e6,_0x41b684),_0x11798d=await components_api_1[_0x26c651(0xea)]['fetchComponentsDetailsByComponentsHistory'](_0xa682e6,_0x36f6f0['map'](({ParentId:_0x2df734})=>_0x2df734),_0x3a6ad4)[_0x26c651(0xe2)](_0x16f0af=>components_api_1[_0x26c651(0xea)][_0x26c651(0x103)](_0x16f0af));if(_0x283bcc){const _0x51c34f=_0x42eb92[_0x26c651(0xa3)](({fileType:_0x1720fc})=>_0x1720fc===_0x26c651(0xa1));await removePermission(_0x51c34f,_0x11798d);}const _0x3dc511=_0x42eb92[_0x26c651(0xa3)](({fileType:_0x117d0e})=>_0x117d0e==='PermissionSet');if(_0x3dc511['length']&&_0x29a7a3){await removePermission(_0x3dc511,_0x11798d);const {items:_0x430a0b}=await retrieveTargetPermissionSets(_0x3dc511,_0x3a6ad4,_0x596b70);await mergePermissionSets(_0x3dc511,((_0x2a8de1=_0x430a0b['PermissionSet'])===null||_0x2a8de1===void 0x0?void 0x0:_0x2a8de1['components'])||[]);}await replaceEnvironments(_0x191be6,_0x3c6673,_0x42eb92),await writeZip(_0x42eb92,_0x1300bc),await generateAndWritePackageXML(_0x36f6f0,_0x11798d,_0x1300bc,_0x3a6ad4);_0xaa2e85&&await saveDestructiveChanges(_0xa682e6,_0xaa2e85,DESTRUCTIVE_CHANGES_PER_NAME,_0x1300bc);_0x4402b8&&await saveDestructiveChanges(_0xa682e6,_0x4402b8,DESTRUCTIVE_CHANGES_POST_NAME,_0x1300bc);const _0x51aab8=(await createDeployZip(_0x1300bc)[_0x26c651(0xe2)](_0x3af8d0=>{return _0x3af8d0;}))[_0x26c651(0xe6)]()['toString'](_0x26c651(0xd3)),_0x252536=_0x51aab8['length'];if(_0x252536>=components_api_1[_0x26c651(0xc9)]){const _0x15d4a3=await createDeployZip(_0x1300bc),[_0x4e7ca6,_0x3f2a9a]=await components_api_1[_0x26c651(0xea)]['splitZip'](_0x15d4a3,_0x252536),_0x59d153=await insertZip(_0xa682e6,_0x2ae509,_0x2f1a74[_0x26c651(0xdd)],_0xffc3da,_0x4e7ca6[_0x26c651(0xe6)]()[_0x26c651(0xf8)](_0x26c651(0xd3)),_0x3a6ad4),_0x1eb3e6=await insertZip(_0xa682e6,_0x2ae509,_0x2f1a74[_0x26c651(0xdd)],_0xffc3da,_0x3f2a9a[_0x26c651(0xe6)]()[_0x26c651(0xf8)](_0x26c651(0xd3)),_0x3a6ad4);return _0x59d153+','+_0x1eb3e6;}else return await insertZip(_0xa682e6,_0x2ae509,_0x2f1a74[_0x26c651(0xdd)],_0xffc3da,_0x51aab8,_0x3a6ad4);}catch(_0x20cbea){throw _0x20cbea;}finally{if(await fs_internal_1['FS'][_0x26c651(0xc3)](path_1[_0x26c651(0xaa)]['join'](process[_0x26c651(0xc1)](),_0x26c651(0xfe),_0x1300bc)))await(0x0,promises_1['rm'])(path_1[_0x26c651(0xaa)][_0x26c651(0xda)](process[_0x26c651(0xc1)](),_0x26c651(0xfe),_0x1300bc),{'recursive':!![]});}}exports['generateAndDeployZip']=generateAndDeployZip;async function getComponents(_0x5bd71a,_0x4d7c59,_0x3f1221){const _0x2a200=a105_0x14348f,_0x20b3ac=[],_0xde3baf=await(0x0,fetch_attachments_1[_0x2a200(0xb4)])(_0x5bd71a,_0x4d7c59);return await getComponentFromZip(_0xde3baf,_0x3f1221)[_0x2a200(0xe2)](_0x11fa39=>{const _0x223657=_0x2a200;_0x20b3ac[_0x223657(0xa2)](..._0x11fa39);}),_0x20b3ac;}async function getComponentFromZip(_0x282f,_0x591b0b){const _0x95b4d0=a105_0x14348f,_0x3e31bd=[];for(const _0x23b9f5 of _0x282f){const _0x28fa84=await zip_1['Zip'][_0x95b4d0(0xbf)](_0x23b9f5['values']['Body']);for(const _0x22923b in _0x28fa84[_0x95b4d0(0xc0)]){!_0x28fa84[_0x95b4d0(0xc0)][_0x22923b][_0x95b4d0(0xcc)]&&_0x3e31bd['push']({'fileName':_0x22923b[_0x95b4d0(0xa7)](_0x22923b['indexOf']('/')+0x1),'fileType':_0x591b0b[_0x23b9f5['id']],'body':_0x23b9f5[_0x95b4d0(0xa5)]['Body']});}}return _0x3e31bd;}async function removePermission(_0x171860,_0x2a39c6){const _0x4576ab=a105_0x14348f;for(const _0x2494a6 of _0x171860){const _0x4c5e4e=await zip_1['Zip'][_0x4576ab(0xbf)](_0x2494a6[_0x4576ab(0xb5)]),_0x287e3f=[];for(const _0x134fee in _0x4c5e4e[_0x4576ab(0xc0)]){!_0x4c5e4e[_0x4576ab(0xc0)][_0x134fee][_0x4576ab(0xcc)]&&_0x287e3f[_0x4576ab(0xa2)]({'fileName':_0x134fee,'body':await _0x4c5e4e['files'][_0x134fee][_0x4576ab(0xb7)](_0x4576ab(0xed))});}const _0x46b7fc=await(0x0,extract_component_permissions_1[_0x4576ab(0xd5)])(_0x287e3f[0x0]['body'][_0x4576ab(0xf8)](),_0x2a39c6,_0x2494a6['fileType']),_0x374fdf=new xml2js_1[(_0x4576ab(0xb0))]({'xmldec':{'version':_0x4576ab(0xcf),'encoding':_0x4576ab(0xd6)}}),_0x33cfb0=_0x374fdf[_0x4576ab(0xbc)](_0x46b7fc),_0x317fd4=zip_1[_0x4576ab(0xf5)]['createZip']();_0x317fd4[_0x4576ab(0xa8)](_0x287e3f[0x0][_0x4576ab(0xde)],_0x33cfb0),_0x2494a6[_0x4576ab(0xb5)]=await _0x317fd4['generateAsync']({'type':_0x4576ab(0xd3),'compression':_0x4576ab(0xab),'compressionOptions':{'level':0x6}});}}async function retrieveTargetPermissionSets(_0xcc47b6,_0x23fb5a,_0x268e7c){const _0x495c80=a105_0x14348f,_0x1d0ff4=_0xcc47b6[_0x495c80(0xdb)](_0x5e2b43=>PERMISSION_SET_FOLDER_NAME+'/'+_0x5e2b43[_0x495c80(0xde)])[_0x495c80(0xda)](';'),_0x1a5621=[{'field':_0x495c80(0xde),'option':salesforce_1[_0x495c80(0xb3)]['IN'],'value':_0x1d0ff4}],_0x4ed016=new logger_1[(_0x495c80(0xce))]();return new salesforce_1['PartialRetrieve'](_0x23fb5a,_0x268e7c,_0x4ed016,_0x1a5621,null,[salesforce_1[_0x495c80(0xcd)][_0x495c80(0xe1)]])['execute']();}async function mergePermissionSets(_0x36d6b8,_0x19aa22){const _0x1be139=a105_0x14348f,_0x5ffcac=_0x19aa22['reduce']((_0x27a854,_0x2d31e7)=>_0x27a854[_0x1be139(0xc5)](_0x2d31e7[_0x1be139(0xff)][_0x1be139(0xde)],_0x2d31e7),new Map());for(const _0x2e8d47 of _0x36d6b8){const _0x3f969c=PERMISSION_SET_FOLDER_NAME+'/'+_0x2e8d47[_0x1be139(0xde)],_0x3f241f=_0x5ffcac[_0x1be139(0xd1)](_0x3f969c);if(!_0x3f241f)continue;const _0x3ca6d8=await zip_1[_0x1be139(0xf5)]['unzip'](_0x2e8d47[_0x1be139(0xb5)]),_0x21e997=await _0x3ca6d8[_0x1be139(0xc0)][_0x3f969c][_0x1be139(0xb7)](_0x1be139(0xed)),_0x174655=_0x3f241f[_0x1be139(0xc0)][_0x3f969c][_0x1be139(0xf8)](),_0x7951cf=await(0x0,extract_component_permissions_1[_0x1be139(0xc4)])(_0x21e997,_0x174655,_0x2e8d47['fileType']),_0x3231f2=zip_1[_0x1be139(0xf5)][_0x1be139(0xdf)]();_0x3231f2['file'](_0x3f969c,_0x7951cf),_0x2e8d47['body']=await _0x3231f2[_0x1be139(0xf3)]({'type':_0x1be139(0xd3),'compression':'DEFLATE','compressionOptions':{'level':0x6}});}}async function replaceEnvironments(_0x3a5038,_0x2ecd24,_0x204157){const _0xe4396=a105_0x14348f;for(const _0x3c524f of _0x204157){if(_0x3a5038['every'](_0x2ddc8d=>_0x2ddc8d!==_0x3c524f[_0xe4396(0xfc)]))continue;const _0x5103bf=await zip_1[_0xe4396(0xf5)][_0xe4396(0xbf)](_0x3c524f[_0xe4396(0xb5)]);for(const _0x2b69d8 in _0x5103bf['files']){if(!_0x5103bf['files'][_0x2b69d8]['dir']){let _0x30840c=await _0x5103bf['files'][_0x2b69d8][_0xe4396(0xb7)](_0xe4396(0xed));for(const _0x429a8d of Object[_0xe4396(0xd7)](_0x2ecd24)){const _0x438370=new RegExp('%%'+_0x429a8d+'%%','g');_0x30840c=_0x30840c[_0xe4396(0xad)](_0x438370,_0x2ecd24[_0x429a8d]);}_0x5103bf[_0xe4396(0xa8)](_0x2b69d8,_0x30840c);}}_0x3c524f[_0xe4396(0xb5)]=await _0x5103bf[_0xe4396(0xf3)]({'type':'base64','compression':_0xe4396(0xab),'compressionOptions':{'level':0x6}});}}async function writeZip(_0x29790d,_0x4d5a71){const _0x129220=a105_0x14348f,_0x35044e=new mdapi_writer_1[(_0x129220(0xb9))]({'components':_0x29790d,'sourceDir':path_1[_0x129220(0xaa)]['join'](process['cwd'](),_0x129220(0xfe),_0x4d5a71,DEPLOY_DIR_NAME,_0x129220(0xc7)),'skipChildErrors':![]});await _0x35044e[_0x129220(0xd0)]();}async function generateAndWritePackageXML(_0x44e6c6,_0x25399b,_0x392188,_0x5d2659){const _0x337cc6=a105_0x14348f,_0x3afaf9=getComponentsTypeAndName(_0x44e6c6,_0x25399b),_0xe16167=[...new Set(_0x3afaf9['map'](_0x5759ce=>_0x5759ce[_0x337cc6(0xac)]))],_0x32cd10={'Package':{'$':{'xmlns':'http://soap.sforce.com/2006/04/metadata'},'types':[],'version':''+_0x5d2659}};for(const _0x15bc8c of _0xe16167){const _0x395b0d=_0x3afaf9[_0x337cc6(0xa3)](_0x194e89=>_0x194e89[_0x337cc6(0xac)]===_0x15bc8c)[_0x337cc6(0xdb)](_0x3933c1=>_0x3933c1[_0x337cc6(0xca)]),_0x4f41cc={'members':_0x395b0d,'name':_0x15bc8c};_0x32cd10[_0x337cc6(0xd8)][_0x337cc6(0xf6)][_0x337cc6(0xa2)](_0x4f41cc);}const _0x3b636b=new xml2js_1[(_0x337cc6(0xb0))]({'xmldec':{'version':'1.0','encoding':'UTF-8'}}),_0x5af0c6=_0x3b636b['buildObject'](_0x32cd10);await fs_internal_1['FS'][_0x337cc6(0x100)](path_1[_0x337cc6(0xaa)][_0x337cc6(0xda)](process['cwd'](),_0x337cc6(0xfe),_0x392188,DEPLOY_DIR_NAME,_0x337cc6(0xc7),_0x337cc6(0xeb)),_0x5af0c6);}function getComponentsTypeAndName(_0x56c1f1,_0x25c09b){const _0x4aa8fb=a105_0x14348f;return _0x56c1f1[_0x4aa8fb(0xbd)]((_0x2633b1,_0x4ddee7)=>{const _0x29e66c=_0x4aa8fb,_0x2fc4ac=_0x25c09b['find'](_0x523bac=>_0x523bac['Id']===_0x4ddee7['ParentId']);return _0x2fc4ac&&_0x2633b1[_0x29e66c(0xa2)]({'name':_0x2fc4ac['Component__r'][_0x29e66c(0xae)],'type':salesforce_1[_0x29e66c(0xf7)][_0x29e66c(0xbe)][_0x4ddee7[_0x29e66c(0xe0)]]||_0x4ddee7[_0x29e66c(0xe0)]}),_0x2633b1;},[]);}async function saveDestructiveChanges(_0x567376,_0x578e33,_0x337052,_0x38af4f){const _0x5f13fe=a105_0x14348f,_0x478c26=(await(0x0,fetch_attachments_1[_0x5f13fe(0xc2)])(_0x567376,_0x578e33))[_0x5f13fe(0xf8)]();await fs_internal_1['FS'][_0x5f13fe(0x100)](path_1['default']['join'](process[_0x5f13fe(0xc1)](),_0x5f13fe(0xfe),_0x38af4f,DEPLOY_DIR_NAME,_0x5f13fe(0xc7),_0x337052),_0x478c26);}async function createDeployZip(_0x5871c8){const _0xce0867=a105_0x14348f,_0x385145=new adm_zip_1[(_0xce0867(0xaa))]();return await _0x385145[_0xce0867(0xee)](path_1[_0xce0867(0xaa)][_0xce0867(0xda)](process[_0xce0867(0xc1)](),_0xce0867(0xfe),_0x5871c8,DEPLOY_DIR_NAME)),_0x385145;}async function insertZip(_0x20bc52,_0x35cc0e,_0x46b040,_0x1e7084,_0x2983b9,_0x58ba21){const _0x11767a=a105_0x14348f,_0x8e61c1={'ParentId':_0x35cc0e,'Name':_0x11767a(0xf0)+_0x46b040,'Description':_0x11767a(0xf0)+_0x1e7084,'Body':_0x2983b9},{data:_0x1b06f3}=await _0x20bc52[_0x11767a(0xe5)](_0x11767a(0xc6)+_0x58ba21+_0x11767a(0xe8),_0x8e61c1);return _0x1b06f3['id'];}