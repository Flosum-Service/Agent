const a54_0x24b2dd=a54_0x5983;(function(_0x482a55,_0x25bb70){const _0x2a5e4a=a54_0x5983,_0x38e749=_0x482a55();while(!![]){try{const _0x53e5db=-parseInt(_0x2a5e4a(0x162))/0x1*(-parseInt(_0x2a5e4a(0x18d))/0x2)+-parseInt(_0x2a5e4a(0x193))/0x3+parseInt(_0x2a5e4a(0x156))/0x4*(-parseInt(_0x2a5e4a(0x196))/0x5)+parseInt(_0x2a5e4a(0x178))/0x6*(-parseInt(_0x2a5e4a(0x179))/0x7)+parseInt(_0x2a5e4a(0x16f))/0x8*(parseInt(_0x2a5e4a(0x15f))/0x9)+-parseInt(_0x2a5e4a(0x17d))/0xa*(-parseInt(_0x2a5e4a(0x190))/0xb)+-parseInt(_0x2a5e4a(0x155))/0xc*(-parseInt(_0x2a5e4a(0x163))/0xd);if(_0x53e5db===_0x25bb70)break;else _0x38e749['push'](_0x38e749['shift']());}catch(_0x9eedb1){_0x38e749['push'](_0x38e749['shift']());}}}(a54_0x1354,0xa3f66));const a54_0x201a53=(function(){let _0x2e11eb=!![];return function(_0x56e098,_0x54af9c){const _0x32b4d5=_0x2e11eb?function(){const _0x2929db=a54_0x5983;if(_0x54af9c){const _0x24949c=_0x54af9c[_0x2929db(0x18a)](_0x56e098,arguments);return _0x54af9c=null,_0x24949c;}}:function(){};return _0x2e11eb=![],_0x32b4d5;};}()),a54_0x134ecd=a54_0x201a53(this,function(){const _0x1116f2=a54_0x5983;return a54_0x134ecd[_0x1116f2(0x1a8)]()[_0x1116f2(0x1a1)](_0x1116f2(0x19a))['toString']()[_0x1116f2(0x171)](a54_0x134ecd)['search'](_0x1116f2(0x19a));});a54_0x134ecd();'use strict';function a54_0x5983(_0x470f17,_0x5a2e8c){const _0x3a41b6=a54_0x1354();return a54_0x5983=function(_0x134ecd,_0x201a53){_0x134ecd=_0x134ecd-0x14f;let _0x13545d=_0x3a41b6[_0x134ecd];return _0x13545d;},a54_0x5983(_0x470f17,_0x5a2e8c);}var __importDefault=this&&this['__importDefault']||function(_0x5c9ec6){const _0x52b98a=a54_0x5983;return _0x5c9ec6&&_0x5c9ec6[_0x52b98a(0x177)]?_0x5c9ec6:{'default':_0x5c9ec6};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a54_0x24b2dd(0x153)]=void 0x0;const constants_1=require(a54_0x24b2dd(0x16a)),path_1=__importDefault(require(a54_0x24b2dd(0x189))),extract_component_permissions_1=require(a54_0x24b2dd(0x172)),xml2js_1=require('xml2js'),zip_1=require(a54_0x24b2dd(0x198)),mdapi_1=require(a54_0x24b2dd(0x199)),fs_internal_1=require(a54_0x24b2dd(0x15c)),promises_1=require('fs/promises'),components_api_1=require(a54_0x24b2dd(0x17f)),adm_zip_1=__importDefault(require(a54_0x24b2dd(0x1a9))),uuid_1=require(a54_0x24b2dd(0x161)),DESTRUCTIVE_CHANGES_PER_NAME=a54_0x24b2dd(0x15e),DESTRUCTIVE_CHANGES_POST_NAME=a54_0x24b2dd(0x19c),DEPLOY_DIR_NAME=a54_0x24b2dd(0x186);async function generateAndDeployZip({attachmentsId:_0x25c139,isExtractComponentsPermissions:_0x560477,preDestructiveAttachmentId:_0x19c73a,postDestructiveAttachmentId:_0x5d5476,branchId:_0x23cac6,credentials:_0x1da4cf,metadataLogId:_0x4402b8,environments:_0x593b77,metaTypes:_0x5047f6},_0x5e6324){const _0x235d75=a54_0x24b2dd,_0x4dd595=(0x0,uuid_1['v4'])();try{const _0x47fbc9=await components_api_1['ComponentsApi']['fetchAttachmentsDetails'](_0x5e6324,_0x25c139),_0x4e556c=_0x47fbc9['reduce']((_0x5a6cdf,_0x319acc)=>({..._0x5a6cdf,[_0x319acc['Id']]:_0x319acc[_0x235d75(0x166)]}),{}),_0x5794a9=await getComponents(_0x47fbc9,_0x5e6324,_0x4e556c),_0x448dcc=await components_api_1[_0x235d75(0x18b)][_0x235d75(0x17b)](_0x5e6324,_0x47fbc9[_0x235d75(0x19f)](({ParentId:_0x1c186c})=>_0x1c186c))[_0x235d75(0x152)](_0x1814eb=>components_api_1[_0x235d75(0x18b)][_0x235d75(0x169)](_0x1814eb));if(_0x560477){const _0x24bdbd=_0x5794a9[_0x235d75(0x1ad)](({fileType:_0x10be75})=>_0x10be75==='Profile'||_0x10be75===_0x235d75(0x15d));await removePermission(_0x24bdbd,_0x448dcc);}await replaceEnvironments(_0x5047f6,_0x593b77,_0x5794a9),await writeZip(_0x5794a9,_0x4dd595),await generateAndWritePackageXML(_0x47fbc9,_0x448dcc,_0x4dd595);_0x19c73a&&await saveDestructiveChanges(_0x5e6324,_0x19c73a,DESTRUCTIVE_CHANGES_PER_NAME,_0x4dd595);_0x5d5476&&await saveDestructiveChanges(_0x5e6324,_0x5d5476,DESTRUCTIVE_CHANGES_POST_NAME,_0x4dd595);const _0x14728f=(await createDeployZip(_0x4dd595)[_0x235d75(0x152)](_0x472281=>{return _0x472281;}))[_0x235d75(0x1a5)]()[_0x235d75(0x1a8)](_0x235d75(0x176));console[_0x235d75(0x16d)]('after\x20create\x20zip');const _0x32a227=_0x14728f[_0x235d75(0x175)];if(_0x32a227>=components_api_1[_0x235d75(0x19d)]){const _0x5a799b=await createDeployZip(_0x4dd595);console['log'](_0x235d75(0x19e));const [_0x4041a4,_0xf7351b]=await components_api_1[_0x235d75(0x18b)][_0x235d75(0x154)](_0x5a799b,_0x32a227),_0x44262b=await insertZip(_0x5e6324,_0x23cac6,_0x1da4cf['orgId'],_0x4402b8,_0x4041a4[_0x235d75(0x1a5)]()[_0x235d75(0x1a8)](_0x235d75(0x176))),_0x1edd1d=await insertZip(_0x5e6324,_0x23cac6,_0x1da4cf['orgId'],_0x4402b8,_0xf7351b[_0x235d75(0x1a5)]()[_0x235d75(0x1a8)](_0x235d75(0x176)));return _0x44262b+','+_0x1edd1d;}else return await insertZip(_0x5e6324,_0x23cac6,_0x1da4cf['orgId'],_0x4402b8,_0x14728f);}catch(_0x1366a8){throw _0x1366a8;}finally{if(await fs_internal_1['FS'][_0x235d75(0x1a3)](path_1['default'][_0x235d75(0x192)](process[_0x235d75(0x188)](),_0x235d75(0x167),_0x4dd595)))await(0x0,promises_1['rm'])(path_1[_0x235d75(0x17e)][_0x235d75(0x192)](process[_0x235d75(0x188)](),'.temp',_0x4dd595),{'recursive':!![]});}}exports[a54_0x24b2dd(0x153)]=generateAndDeployZip;async function getComponents(_0x368fc2,_0x1434cc,_0x1a4eb5){const _0x5e4f80=a54_0x24b2dd,_0x531841=[],_0x1372c9=await components_api_1[_0x5e4f80(0x18b)][_0x5e4f80(0x16e)](_0x368fc2,_0x1434cc);return await getComponentFromZip(_0x1372c9,_0x1a4eb5)['then'](_0x5b3bd4=>{const _0x5eafeb=_0x5e4f80;_0x531841[_0x5eafeb(0x1a2)](..._0x5b3bd4);}),_0x531841;}async function getComponentFromZip(_0x31a685,_0x46e606){const _0x2e5088=a54_0x24b2dd,_0x2a7932=[];for(const _0x2a6c29 of _0x31a685){const _0x7f09d2=await zip_1[_0x2e5088(0x164)]['unzip'](_0x2a6c29['values'][_0x2e5088(0x16c)]);for(const _0x3957dc in _0x7f09d2[_0x2e5088(0x1ae)]){!_0x7f09d2['files'][_0x3957dc][_0x2e5088(0x197)]&&_0x2a7932[_0x2e5088(0x1a2)]({'fileName':_0x3957dc[_0x2e5088(0x183)](_0x3957dc[_0x2e5088(0x187)]('/')+0x1),'fileType':_0x46e606[_0x2a6c29['id']],'body':_0x2a6c29[_0x2e5088(0x18f)][_0x2e5088(0x16c)]});}}return _0x2a7932;}async function removePermission(_0x56915d,_0x3411d5){const _0x5a60f4=a54_0x24b2dd;for(const _0x2de9fd of _0x56915d){const _0x34cd13=await zip_1[_0x5a60f4(0x164)][_0x5a60f4(0x1ac)](_0x2de9fd[_0x5a60f4(0x194)]),_0x17b013=[];for(const _0x316c89 in _0x34cd13[_0x5a60f4(0x1ae)]){!_0x34cd13[_0x5a60f4(0x1ae)][_0x316c89][_0x5a60f4(0x197)]&&_0x17b013['push']({'fileName':_0x316c89,'body':await _0x34cd13[_0x5a60f4(0x1ae)][_0x316c89][_0x5a60f4(0x181)](_0x5a60f4(0x19b))});}const _0x309872=await(0x0,extract_component_permissions_1[_0x5a60f4(0x191)])(_0x17b013[0x0][_0x5a60f4(0x194)][_0x5a60f4(0x1a8)](),_0x3411d5,_0x2de9fd[_0x5a60f4(0x1a4)]),_0x519e9a=new xml2js_1[(_0x5a60f4(0x151))]({'xmldec':{'version':_0x5a60f4(0x17c),'encoding':_0x5a60f4(0x1ab)}}),_0x5e7246=_0x519e9a[_0x5a60f4(0x18c)](_0x309872),_0x55352b=zip_1['Zip'][_0x5a60f4(0x150)]();_0x55352b[_0x5a60f4(0x18e)](_0x17b013[0x0][_0x5a60f4(0x1a6)],_0x5e7246),_0x2de9fd['body']=await _0x55352b[_0x5a60f4(0x195)]({'type':_0x5a60f4(0x176),'compression':_0x5a60f4(0x173),'compressionOptions':{'level':0x6}});}}async function replaceEnvironments(_0x5169fd,_0x1bf63d,_0x1d7c4e){const _0x395f28=a54_0x24b2dd;for(const _0x3fd2a8 of _0x1d7c4e){if(_0x5169fd[_0x395f28(0x1a7)](_0x6fcb73=>_0x6fcb73!==_0x3fd2a8[_0x395f28(0x1a4)]))continue;const _0x338a81=await zip_1[_0x395f28(0x164)][_0x395f28(0x1ac)](_0x3fd2a8[_0x395f28(0x194)]);for(const _0xa19cc9 in _0x338a81[_0x395f28(0x1ae)]){if(!_0x338a81['files'][_0xa19cc9][_0x395f28(0x197)]){let _0x322312=await _0x338a81[_0x395f28(0x1ae)][_0xa19cc9][_0x395f28(0x181)](_0x395f28(0x19b));for(const _0xffe846 of Object[_0x395f28(0x170)](_0x1bf63d)){const _0x5eab93=new RegExp('%%'+_0xffe846+'%%','g');_0x322312=_0x322312[_0x395f28(0x168)](_0x5eab93,_0x1bf63d[_0xffe846]);}_0x338a81['file'](_0xa19cc9,_0x322312);}}_0x3fd2a8['body']=await _0x338a81['generateAsync']({'type':'base64','compression':'DEFLATE','compressionOptions':{'level':0x6}});}}function a54_0x1354(){const _0x255fd0=['generateAsync','10ArEKhE','dir','../../git/parsers/utils/zip','../../git/parsers/mdapi','(((.+)+)+)+$','text','destructiveChangesPost.xml','MAX_ZIP_SIZE','after\x20create\x20second\x20zip','map','Component_Name__c','search','push','exists','fileType','toBuffer','fileName','every','toString','adm-zip','types','UTF-8','unzip','filter','files','find','createZip','Builder','then','generateAndDeployZip','splitZip','48NrMtgO','1903856aAwwvK','writeFile','src','type','name','ParentId','../../git/internal/fs.internal','PermissionSet','destructiveChangesPre.xml','40239dyKGNl','BUILD','uuid','1733krlpdW','2483429Lebbjl','Zip','MDApiWriter','Name','.temp','replace','removeNamespacePrefix','../../../constants','/services/data/','Body','log','retrieveAttachments','872PgVeIt','keys','constructor','../utils/extract-component-permissions','DEFLATE','package.xml','length','base64','__esModule','6YnlzhJ','8638sWkxTU','/sobjects/Attachment','fetchComponentsDetailsByComponentsHistory','1.0','590950kCplUR','default','../utils/components-api','http://soap.sforce.com/2006/04/metadata','async','SALESFORCE_API_VERSION','substring','Component__r','addLocalFolder','DEPLOYZIP','indexOf','cwd','path','apply','ComponentsApi','buildObject','1042pRasHS','file','values','44VHPlhv','extractComponentPermissions','join','2297976XdblYC','body'];a54_0x1354=function(){return _0x255fd0;};return a54_0x1354();}async function writeZip(_0x50daa3,_0x5ab861){const _0x53dc59=a54_0x24b2dd,_0x28badc=new mdapi_1[(_0x53dc59(0x165))]({'components':_0x50daa3,'sourceDir':path_1[_0x53dc59(0x17e)][_0x53dc59(0x192)](process[_0x53dc59(0x188)](),_0x53dc59(0x167),_0x5ab861,DEPLOY_DIR_NAME,'src'),'skipChildErrors':![]});await _0x28badc['start']();}async function generateAndWritePackageXML(_0x18df32,_0x4fdc84,_0x38dfa0){const _0x2c7891=a54_0x24b2dd,_0x4f6a89=getComponentsTypeAndName(_0x18df32,_0x4fdc84),_0x5437e2=[...new Set(_0x4f6a89[_0x2c7891(0x19f)](_0x3fccad=>_0x3fccad[_0x2c7891(0x159)]))],_0xa916b7={'Package':{'$':{'xmlns':_0x2c7891(0x180)},'types':[],'version':''+constants_1[_0x2c7891(0x182)][_0x2c7891(0x183)](0x1)}};for(const _0x232450 of _0x5437e2){const _0xb9377=_0x4f6a89[_0x2c7891(0x1ad)](_0x5e67e7=>_0x5e67e7[_0x2c7891(0x159)]===_0x232450)[_0x2c7891(0x19f)](_0x2a0e67=>_0x2a0e67[_0x2c7891(0x15a)]),_0xead283={'members':_0xb9377,'name':_0x232450};_0xa916b7['Package'][_0x2c7891(0x1aa)][_0x2c7891(0x1a2)](_0xead283);}const _0x5c4d71=new xml2js_1[(_0x2c7891(0x151))]({'xmldec':{'version':_0x2c7891(0x17c),'encoding':_0x2c7891(0x1ab)}}),_0x46bed8=_0x5c4d71[_0x2c7891(0x18c)](_0xa916b7);await fs_internal_1['FS'][_0x2c7891(0x157)](path_1[_0x2c7891(0x17e)][_0x2c7891(0x192)](process[_0x2c7891(0x188)](),_0x2c7891(0x167),_0x38dfa0,DEPLOY_DIR_NAME,_0x2c7891(0x158),_0x2c7891(0x174)),_0x46bed8);}function getComponentsTypeAndName(_0x3ba51d,_0x599e18){return _0x3ba51d['reduce']((_0x247dca,_0x132778)=>{const _0x11dcd6=a54_0x5983,_0x108efc=_0x599e18[_0x11dcd6(0x14f)](_0x2f8bc8=>_0x2f8bc8['Id']===_0x132778[_0x11dcd6(0x15b)]);return _0x108efc&&_0x247dca[_0x11dcd6(0x1a2)]({'name':_0x108efc[_0x11dcd6(0x184)][_0x11dcd6(0x1a0)],'type':_0x132778[_0x11dcd6(0x166)]}),_0x247dca;},[]);}async function saveDestructiveChanges(_0x417837,_0x54fa4b,_0x4c7fc0,_0x3f7074){const _0x1b2971=a54_0x24b2dd,_0x436cbd=(await components_api_1[_0x1b2971(0x18b)]['fetchAttachmentBody'](_0x417837,_0x54fa4b))[_0x1b2971(0x1a8)]();await fs_internal_1['FS'][_0x1b2971(0x157)](path_1['default'][_0x1b2971(0x192)](process[_0x1b2971(0x188)](),_0x1b2971(0x167),_0x3f7074,DEPLOY_DIR_NAME,_0x1b2971(0x158),_0x4c7fc0),_0x436cbd);}async function createDeployZip(_0x28ccb8){const _0x7df7b0=a54_0x24b2dd,_0xdd5744=new adm_zip_1[(_0x7df7b0(0x17e))]();return await _0xdd5744[_0x7df7b0(0x185)](path_1['default'][_0x7df7b0(0x192)](process['cwd'](),'.temp',_0x28ccb8,DEPLOY_DIR_NAME)),_0xdd5744;}async function insertZip(_0x3e9f68,_0x31677a,_0x5e08ec,_0x3b7532,_0x1a6958){const _0x12ab89=a54_0x24b2dd,_0x426c11={'ParentId':_0x31677a,'Name':_0x12ab89(0x160)+_0x5e08ec,'Description':_0x12ab89(0x160)+_0x3b7532,'Body':_0x1a6958},{data:_0x5bdd90}=await _0x3e9f68['post'](_0x12ab89(0x16b)+constants_1['SALESFORCE_API_VERSION']+_0x12ab89(0x17a),_0x426c11);return _0x5bdd90['id'];}