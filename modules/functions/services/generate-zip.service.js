function a85_0x2415(_0x4c9ee1,_0x2bb75f){const _0xec7bde=a85_0x4d51();return a85_0x2415=function(_0x494d22,_0x3ab62c){_0x494d22=_0x494d22-0xee;let _0x4d5164=_0xec7bde[_0x494d22];return _0x4d5164;},a85_0x2415(_0x4c9ee1,_0x2bb75f);}const a85_0x1d8cf0=a85_0x2415;(function(_0x575a47,_0x442f59){const _0x2e1c23=a85_0x2415,_0x4d3157=_0x575a47();while(!![]){try{const _0x2fd03d=-parseInt(_0x2e1c23(0x119))/0x1+-parseInt(_0x2e1c23(0xf5))/0x2*(parseInt(_0x2e1c23(0xf1))/0x3)+-parseInt(_0x2e1c23(0x11d))/0x4*(parseInt(_0x2e1c23(0x141))/0x5)+-parseInt(_0x2e1c23(0x114))/0x6*(parseInt(_0x2e1c23(0x101))/0x7)+-parseInt(_0x2e1c23(0xfb))/0x8+parseInt(_0x2e1c23(0xef))/0x9+parseInt(_0x2e1c23(0x128))/0xa*(parseInt(_0x2e1c23(0x129))/0xb);if(_0x2fd03d===_0x442f59)break;else _0x4d3157['push'](_0x4d3157['shift']());}catch(_0x49d3c2){_0x4d3157['push'](_0x4d3157['shift']());}}}(a85_0x4d51,0x605cb));const a85_0x3ab62c=(function(){let _0x4ad332=!![];return function(_0x5c8dd7,_0x3a972f){const _0x5468a9=_0x4ad332?function(){const _0x5a63b1=a85_0x2415;if(_0x3a972f){const _0xbcb574=_0x3a972f[_0x5a63b1(0x12f)](_0x5c8dd7,arguments);return _0x3a972f=null,_0xbcb574;}}:function(){};return _0x4ad332=![],_0x5468a9;};}()),a85_0x494d22=a85_0x3ab62c(this,function(){const _0x386e16=a85_0x2415;return a85_0x494d22[_0x386e16(0x147)]()[_0x386e16(0x143)]('(((.+)+)+)+$')['toString']()['constructor'](a85_0x494d22)['search']('(((.+)+)+)+$');});a85_0x494d22();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4defa7){const _0x4ecfa6=a85_0x2415;return _0x4defa7&&_0x4defa7[_0x4ecfa6(0x118)]?_0x4defa7:{'default':_0x4defa7};};Object[a85_0x1d8cf0(0x116)](exports,a85_0x1d8cf0(0x118),{'value':!![]}),exports[a85_0x1d8cf0(0x134)]=void 0x0;const constants_1=require(a85_0x1d8cf0(0x125)),path_1=__importDefault(require(a85_0x1d8cf0(0x106))),extract_component_permissions_1=require(a85_0x1d8cf0(0x137)),xml2js_1=require(a85_0x1d8cf0(0x10a)),zip_1=require(a85_0x1d8cf0(0x13a)),mdapi_1=require('../../git/parsers/mdapi'),fs_internal_1=require(a85_0x1d8cf0(0xf7)),promises_1=require(a85_0x1d8cf0(0x127)),components_api_1=require(a85_0x1d8cf0(0x115)),adm_zip_1=__importDefault(require('adm-zip')),uuid_1=require('uuid'),fetch_attachments_1=require('../../shared/utils/fetch-attachments'),DESTRUCTIVE_CHANGES_PER_NAME=a85_0x1d8cf0(0x11e),DESTRUCTIVE_CHANGES_POST_NAME='destructiveChangesPost.xml',DEPLOY_DIR_NAME=a85_0x1d8cf0(0x10e);function a85_0x4d51(){const _0x2a47e0=['body','../../git/parsers/utils/zip','Component__r','src','fileName','log','filter','addLocalFolder','10wrKUlk','buildObject','search','type','name','Body','toString','PermissionSet','Name','451467FXNQuP','base64','3SAzIqF','cwd','fileType','types','1534514gxwIMB','writeFile','../../git/internal/fs.internal','.temp','Zip','default','6172424lynNlc','UTF-8','DEFLATE','post','/services/data/','after\x20create\x20second\x20zip','6111pFggxZ','async','1.0','generateAsync','reduce','path','after\x20create\x20zip','Component_Name__c','length','xml2js','replace','Package','fetchAttachmentsDetailsById','DEPLOYZIP','indexOf','exists','start','BUILD','fetchAttachmentBody','2328rWXWAf','../utils/components-api','defineProperty','package.xml','__esModule','358784mnNZlb','files','/sobjects/Attachment','values','415060vvrcoy','destructiveChangesPre.xml','dir','file','fetchComponentsDetailsByComponentsHistory','push','SALESFORCE_API_VERSION','splitZip','../../../constants','Builder','fs/promises','11030xSCvTI','27808MHjeZU','toBuffer','extractComponentPermissions','MDApiWriter','map','ComponentsApi','apply','join','unzip','orgId','keys','generateAndDeployZip','then','text','../utils/extract-component-permissions','substring'];a85_0x4d51=function(){return _0x2a47e0;};return a85_0x4d51();}async function generateAndDeployZip({attachmentsId:_0x5def82,isExtractComponentsPermissions:_0x3361a9,preDestructiveAttachmentId:_0x3d013f,postDestructiveAttachmentId:_0xfdd9ee,branchId:_0x473357,credentials:_0x4073be,metadataLogId:_0x2f43bf,environments:_0x51ceb6,metaTypes:_0x490dd1},_0x3813f9){const _0x14128a=a85_0x1d8cf0,_0x9fd7e=(0x0,uuid_1['v4'])();try{const _0x4da194=await(0x0,fetch_attachments_1[_0x14128a(0x10d)])(_0x3813f9,_0x5def82),_0x2d6a1d=_0x4da194[_0x14128a(0x105)]((_0x5679dd,_0x42eee6)=>({..._0x5679dd,[_0x42eee6['Id']]:_0x42eee6['Name']}),{}),_0x506e40=await getComponents(_0x4da194,_0x3813f9,_0x2d6a1d),_0x2ae69d=await components_api_1[_0x14128a(0x12e)][_0x14128a(0x121)](_0x3813f9,_0x4da194[_0x14128a(0x12d)](({ParentId:_0xc0c104})=>_0xc0c104))[_0x14128a(0x135)](_0x2acac5=>components_api_1[_0x14128a(0x12e)]['removeNamespacePrefix'](_0x2acac5));if(_0x3361a9){const _0x5cd64c=_0x506e40['filter'](({fileType:_0x18c87d})=>_0x18c87d==='Profile'||_0x18c87d===_0x14128a(0x148));await removePermission(_0x5cd64c,_0x2ae69d);}await replaceEnvironments(_0x490dd1,_0x51ceb6,_0x506e40),await writeZip(_0x506e40,_0x9fd7e),await generateAndWritePackageXML(_0x4da194,_0x2ae69d,_0x9fd7e);_0x3d013f&&await saveDestructiveChanges(_0x3813f9,_0x3d013f,DESTRUCTIVE_CHANGES_PER_NAME,_0x9fd7e);_0xfdd9ee&&await saveDestructiveChanges(_0x3813f9,_0xfdd9ee,DESTRUCTIVE_CHANGES_POST_NAME,_0x9fd7e);const _0x455949=(await createDeployZip(_0x9fd7e)[_0x14128a(0x135)](_0x353739=>{return _0x353739;}))[_0x14128a(0x12a)]()[_0x14128a(0x147)](_0x14128a(0xf0));console[_0x14128a(0x13e)](_0x14128a(0x107));const _0x26f786=_0x455949[_0x14128a(0x109)];if(_0x26f786>=components_api_1['MAX_ZIP_SIZE']){const _0x5980e1=await createDeployZip(_0x9fd7e);console[_0x14128a(0x13e)](_0x14128a(0x100));const [_0x4284c2,_0x25e1bf]=await components_api_1[_0x14128a(0x12e)][_0x14128a(0x124)](_0x5980e1,_0x26f786),_0x46ede6=await insertZip(_0x3813f9,_0x473357,_0x4073be[_0x14128a(0x132)],_0x2f43bf,_0x4284c2[_0x14128a(0x12a)]()[_0x14128a(0x147)](_0x14128a(0xf0))),_0x2fbd2f=await insertZip(_0x3813f9,_0x473357,_0x4073be[_0x14128a(0x132)],_0x2f43bf,_0x25e1bf[_0x14128a(0x12a)]()[_0x14128a(0x147)](_0x14128a(0xf0)));return _0x46ede6+','+_0x2fbd2f;}else return await insertZip(_0x3813f9,_0x473357,_0x4073be[_0x14128a(0x132)],_0x2f43bf,_0x455949);}catch(_0x647273){throw _0x647273;}finally{if(await fs_internal_1['FS'][_0x14128a(0x110)](path_1['default']['join'](process['cwd'](),_0x14128a(0xf8),_0x9fd7e)))await(0x0,promises_1['rm'])(path_1[_0x14128a(0xfa)][_0x14128a(0x130)](process[_0x14128a(0xf2)](),_0x14128a(0xf8),_0x9fd7e),{'recursive':!![]});}}exports[a85_0x1d8cf0(0x134)]=generateAndDeployZip;async function getComponents(_0x44017e,_0x5db917,_0x577497){const _0x4670a1=[],_0x12222f=await(0x0,fetch_attachments_1['retrieveAttachments'])(_0x44017e,_0x5db917);return await getComponentFromZip(_0x12222f,_0x577497)['then'](_0x39cdd9=>{const _0x39b66b=a85_0x2415;_0x4670a1[_0x39b66b(0x122)](..._0x39cdd9);}),_0x4670a1;}async function getComponentFromZip(_0x4cdb0c,_0xba2b1a){const _0x15893e=a85_0x1d8cf0,_0x10c187=[];for(const _0x2e1a80 of _0x4cdb0c){const _0x247948=await zip_1['Zip'][_0x15893e(0x131)](_0x2e1a80['values'][_0x15893e(0x146)]);for(const _0x4f8856 in _0x247948[_0x15893e(0x11a)]){!_0x247948[_0x15893e(0x11a)][_0x4f8856]['dir']&&_0x10c187[_0x15893e(0x122)]({'fileName':_0x4f8856[_0x15893e(0x138)](_0x4f8856[_0x15893e(0x10f)]('/')+0x1),'fileType':_0xba2b1a[_0x2e1a80['id']],'body':_0x2e1a80[_0x15893e(0x11c)]['Body']});}}return _0x10c187;}async function removePermission(_0x21d21e,_0x315b6f){const _0x1153e8=a85_0x1d8cf0;for(const _0x445014 of _0x21d21e){const _0x4315fd=await zip_1[_0x1153e8(0xf9)]['unzip'](_0x445014['body']),_0x12adf0=[];for(const _0x3dae55 in _0x4315fd[_0x1153e8(0x11a)]){!_0x4315fd[_0x1153e8(0x11a)][_0x3dae55][_0x1153e8(0x11f)]&&_0x12adf0['push']({'fileName':_0x3dae55,'body':await _0x4315fd['files'][_0x3dae55]['async'](_0x1153e8(0x136))});}const _0x1c96f9=await(0x0,extract_component_permissions_1[_0x1153e8(0x12b)])(_0x12adf0[0x0][_0x1153e8(0x139)][_0x1153e8(0x147)](),_0x315b6f,_0x445014[_0x1153e8(0xf3)]),_0x210b45=new xml2js_1[(_0x1153e8(0x126))]({'xmldec':{'version':_0x1153e8(0x103),'encoding':_0x1153e8(0xfc)}}),_0x483df0=_0x210b45[_0x1153e8(0x142)](_0x1c96f9),_0x2d958d=zip_1['Zip']['createZip']();_0x2d958d[_0x1153e8(0x120)](_0x12adf0[0x0][_0x1153e8(0x13d)],_0x483df0),_0x445014[_0x1153e8(0x139)]=await _0x2d958d[_0x1153e8(0x104)]({'type':_0x1153e8(0xf0),'compression':_0x1153e8(0xfd),'compressionOptions':{'level':0x6}});}}async function replaceEnvironments(_0x40a109,_0x597dd4,_0x36d4a8){const _0x195cf1=a85_0x1d8cf0;for(const _0x165c8e of _0x36d4a8){if(_0x40a109['every'](_0x22e3ee=>_0x22e3ee!==_0x165c8e[_0x195cf1(0xf3)]))continue;const _0x1ebf3b=await zip_1['Zip'][_0x195cf1(0x131)](_0x165c8e['body']);for(const _0x3ed427 in _0x1ebf3b['files']){if(!_0x1ebf3b[_0x195cf1(0x11a)][_0x3ed427]['dir']){let _0x2b8b7b=await _0x1ebf3b[_0x195cf1(0x11a)][_0x3ed427][_0x195cf1(0x102)](_0x195cf1(0x136));for(const _0x467abc of Object[_0x195cf1(0x133)](_0x597dd4)){const _0x525178=new RegExp('%%'+_0x467abc+'%%','g');_0x2b8b7b=_0x2b8b7b[_0x195cf1(0x10b)](_0x525178,_0x597dd4[_0x467abc]);}_0x1ebf3b[_0x195cf1(0x120)](_0x3ed427,_0x2b8b7b);}}_0x165c8e[_0x195cf1(0x139)]=await _0x1ebf3b[_0x195cf1(0x104)]({'type':_0x195cf1(0xf0),'compression':_0x195cf1(0xfd),'compressionOptions':{'level':0x6}});}}async function writeZip(_0xbd272f,_0x7fa614){const _0x4f809c=a85_0x1d8cf0,_0x274700=new mdapi_1[(_0x4f809c(0x12c))]({'components':_0xbd272f,'sourceDir':path_1[_0x4f809c(0xfa)]['join'](process[_0x4f809c(0xf2)](),'.temp',_0x7fa614,DEPLOY_DIR_NAME,_0x4f809c(0x13c)),'skipChildErrors':![]});await _0x274700[_0x4f809c(0x111)]();}async function generateAndWritePackageXML(_0xf3c190,_0x103ef8,_0x232493){const _0x402949=a85_0x1d8cf0,_0x3c58f6=getComponentsTypeAndName(_0xf3c190,_0x103ef8),_0x4be84b=[...new Set(_0x3c58f6[_0x402949(0x12d)](_0x21e3b9=>_0x21e3b9[_0x402949(0x144)]))],_0x26cac6={'Package':{'$':{'xmlns':'http://soap.sforce.com/2006/04/metadata'},'types':[],'version':''+constants_1[_0x402949(0x123)][_0x402949(0x138)](0x1)}};for(const _0x22da83 of _0x4be84b){const _0x44c2b9=_0x3c58f6[_0x402949(0x13f)](_0x3646b5=>_0x3646b5[_0x402949(0x144)]===_0x22da83)['map'](_0x361a21=>_0x361a21[_0x402949(0x145)]),_0x26f4ba={'members':_0x44c2b9,'name':_0x22da83};_0x26cac6[_0x402949(0x10c)][_0x402949(0xf4)][_0x402949(0x122)](_0x26f4ba);}const _0x1e6ce4=new xml2js_1[(_0x402949(0x126))]({'xmldec':{'version':'1.0','encoding':_0x402949(0xfc)}}),_0x3be37c=_0x1e6ce4[_0x402949(0x142)](_0x26cac6);await fs_internal_1['FS'][_0x402949(0xf6)](path_1[_0x402949(0xfa)][_0x402949(0x130)](process['cwd'](),'.temp',_0x232493,DEPLOY_DIR_NAME,_0x402949(0x13c),_0x402949(0x117)),_0x3be37c);}function getComponentsTypeAndName(_0x298618,_0x147091){const _0x510c97=a85_0x1d8cf0;return _0x298618[_0x510c97(0x105)]((_0x2e4c15,_0x54177b)=>{const _0x478597=_0x510c97,_0x3bcc17=_0x147091['find'](_0x39e7da=>_0x39e7da['Id']===_0x54177b['ParentId']);return _0x3bcc17&&_0x2e4c15[_0x478597(0x122)]({'name':_0x3bcc17[_0x478597(0x13b)][_0x478597(0x108)],'type':_0x54177b[_0x478597(0xee)]}),_0x2e4c15;},[]);}async function saveDestructiveChanges(_0x3d25d3,_0xf69e50,_0x5cbe67,_0x152d0e){const _0x487398=a85_0x1d8cf0,_0x2a6493=(await(0x0,fetch_attachments_1[_0x487398(0x113)])(_0x3d25d3,_0xf69e50))[_0x487398(0x147)]();await fs_internal_1['FS'][_0x487398(0xf6)](path_1[_0x487398(0xfa)][_0x487398(0x130)](process[_0x487398(0xf2)](),_0x487398(0xf8),_0x152d0e,DEPLOY_DIR_NAME,_0x487398(0x13c),_0x5cbe67),_0x2a6493);}async function createDeployZip(_0x377a1d){const _0x264920=a85_0x1d8cf0,_0x33d5ea=new adm_zip_1[(_0x264920(0xfa))]();return await _0x33d5ea[_0x264920(0x140)](path_1[_0x264920(0xfa)]['join'](process['cwd'](),_0x264920(0xf8),_0x377a1d,DEPLOY_DIR_NAME)),_0x33d5ea;}async function insertZip(_0x161fda,_0x27857b,_0x3a63a0,_0x190d7e,_0x4cf6ff){const _0x30e5ee=a85_0x1d8cf0,_0x270d4e={'ParentId':_0x27857b,'Name':_0x30e5ee(0x112)+_0x3a63a0,'Description':_0x30e5ee(0x112)+_0x190d7e,'Body':_0x4cf6ff},{data:_0x5beab8}=await _0x161fda[_0x30e5ee(0xfe)](_0x30e5ee(0xff)+constants_1[_0x30e5ee(0x123)]+_0x30e5ee(0x11b),_0x270d4e);return _0x5beab8['id'];}