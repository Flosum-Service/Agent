const a111_0x48df6b=a111_0xd105;(function(_0x4fb09d,_0x405bf1){const _0x3874a9=a111_0xd105,_0x453ece=_0x4fb09d();while(!![]){try{const _0xd36884=parseInt(_0x3874a9(0xdc))/0x1+-parseInt(_0x3874a9(0x9a))/0x2*(-parseInt(_0x3874a9(0xfd))/0x3)+-parseInt(_0x3874a9(0x9b))/0x4+-parseInt(_0x3874a9(0x101))/0x5*(-parseInt(_0x3874a9(0xc7))/0x6)+parseInt(_0x3874a9(0xcf))/0x7+parseInt(_0x3874a9(0x106))/0x8*(-parseInt(_0x3874a9(0xe6))/0x9)+-parseInt(_0x3874a9(0x109))/0xa;if(_0xd36884===_0x405bf1)break;else _0x453ece['push'](_0x453ece['shift']());}catch(_0x1f8f92){_0x453ece['push'](_0x453ece['shift']());}}}(a111_0x2bb5,0xe7999));const a111_0x59d100=(function(){let _0x9e51fa=!![];return function(_0xe1de67,_0x323d81){const _0x34c4ad=_0x9e51fa?function(){const _0x5f11ed=a111_0xd105;if(_0x323d81){const _0x5054b5=_0x323d81[_0x5f11ed(0xab)](_0xe1de67,arguments);return _0x323d81=null,_0x5054b5;}}:function(){};return _0x9e51fa=![],_0x34c4ad;};}()),a111_0x157e05=a111_0x59d100(this,function(){const _0x23393f=a111_0xd105;return a111_0x157e05[_0x23393f(0xbe)]()[_0x23393f(0x8c)]('(((.+)+)+)+$')[_0x23393f(0xbe)]()[_0x23393f(0xd6)](a111_0x157e05)[_0x23393f(0x8c)](_0x23393f(0xce));});a111_0x157e05();function a111_0x2bb5(){const _0x25f058=['get','\x27\x20[','salesforceSync','Service','SalesforceSyncService','apply','catch','getBranchRecords',']\x20branch.','object','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','name','../errors/git-branch-not-found.error','getOrCreateRepo','../../providers/providers.tokens','Error','../../../../core/errors/bad-request.error','../jobs/flosum-sync.job','create','join','metadata','\x20Completed\x20prepare\x20to\x20syncing.','repoList','FlosumSyncJob','toString','connectionId','getOwnPropertyDescriptor','../../salesforce/dto/flosum-repository-sync.dto','getAll','../../../../core',']\x20due\x20error\x20-\x20','GitBranchNotFoundError','design:paramtypes','1465278YjWtME','applicationUrl','gitApiService','getLoggerId','SyncDirection','Logger','repositoriesIntersections','(((.+)+)+)+$','5712560REIePK','BadRequestError','gitUrl','hooks','toLowerCase','toUpperCase','\x20Syncing\x20repository:\x20\x22','constructor','repoService','send','SalesforceError','../../salesforce/services/salesforce-sync.service','find','1176758NZVZaI','__esModule','run','Waiting','sfLogger','isIntersects','../../salesforce/services/salesforce.service','prefix','url','setLoggerId','6917112thuDxT','Container','gitProvider','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','Not\x20Synchronized','\x20Checking\x20valid\x20name.','handleRecordSyncError','HooksUtils','SyncService','GitSyncJob','\x20No\x20repositories\x20to\x20sync.','Unable\x20to\x20synchronize\x20branch\x20\x27','REPOSITORY_NAME_REGEXP','log','\x22\x20branch:\x20\x22','isBidirectionalSynchronization','repositoryId','\x27\x20-\x20\x27','\x20Getting\x20Flosum\x20repository','Syncing\x20','defineProperty','BRANCH_NAME_REGEXP','setStatus','45nPyOrA','config','map','checkValidNaming','10XpvFFw','Unable\x20to\x20synchronize\x20repository\x20\x27','TooManyRequests','Tokens','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','16aCZmcm','createHookPayload','salesforceService','9075660reqUPa','__decorate','getRepositoryRecords','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','disableSync','search','test','branchName','\x20Getting\x20branch\x20records.','../../salesforce/errors/salesforce.error','../../../shared/utils','\x20Getting\x20repository\x20records.','function','\x20Repository\x20\x22','decorate','FlosumToGit','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','typedi','../../providers/web-hooks/hooks.utils','168004SwefcL','1391836XDEWnU','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','../../../../core/errors/too-many-requests.error','length','\x20branches.','logger','error','repositoryName','gitRepoService','\x20Stop\x20sync\x20job\x20for\x20\x27','\x20Checking\x20intersects.'];a111_0x2bb5=function(){return _0x25f058;};return a111_0x2bb5();}'use strict';function a111_0xd105(_0x5b33fd,_0x711c5a){const _0x452b58=a111_0x2bb5();return a111_0xd105=function(_0x157e05,_0x59d100){_0x157e05=_0x157e05-0x8b;let _0x2bb5e7=_0x452b58[_0x157e05];return _0x2bb5e7;},a111_0xd105(_0x5b33fd,_0x711c5a);}var __decorate=this&&this[a111_0x48df6b(0x10a)]||function(_0x1b7d76,_0x152aea,_0x1b11b7,_0x470ec4){const _0x368e29=a111_0x48df6b;var _0x3b31e4=arguments[_0x368e29(0x9e)],_0x4fc525=_0x3b31e4<0x3?_0x152aea:_0x470ec4===null?_0x470ec4=Object[_0x368e29(0xc0)](_0x152aea,_0x1b11b7):_0x470ec4,_0xf61409;if(typeof Reflect===_0x368e29(0xaf)&&typeof Reflect['decorate']===_0x368e29(0x93))_0x4fc525=Reflect[_0x368e29(0x95)](_0x1b7d76,_0x152aea,_0x1b11b7,_0x470ec4);else{for(var _0x2f01a5=_0x1b7d76['length']-0x1;_0x2f01a5>=0x0;_0x2f01a5--)if(_0xf61409=_0x1b7d76[_0x2f01a5])_0x4fc525=(_0x3b31e4<0x3?_0xf61409(_0x4fc525):_0x3b31e4>0x3?_0xf61409(_0x152aea,_0x1b11b7,_0x4fc525):_0xf61409(_0x152aea,_0x1b11b7))||_0x4fc525;}return _0x3b31e4>0x3&&_0x4fc525&&Object[_0x368e29(0xfa)](_0x152aea,_0x1b11b7,_0x4fc525),_0x4fc525;},__metadata=this&&this['__metadata']||function(_0x2aacc3,_0x3c846e){const _0x1c1be9=a111_0x48df6b;if(typeof Reflect===_0x1c1be9(0xaf)&&typeof Reflect[_0x1c1be9(0xba)]===_0x1c1be9(0x93))return Reflect[_0x1c1be9(0xba)](_0x2aacc3,_0x3c846e);},SyncService_1;Object[a111_0x48df6b(0xfa)](exports,a111_0x48df6b(0xdd),{'value':!![]}),exports[a111_0x48df6b(0xee)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a111_0x48df6b(0xc3)),too_many_requests_error_1=require(a111_0x48df6b(0x9d)),flosum_repository_sync_dto_1=require(a111_0x48df6b(0xc1)),salesforce_error_1=require(a111_0x48df6b(0x90)),salesforce_sync_service_1=require(a111_0x48df6b(0xda)),salesforce_service_1=require(a111_0x48df6b(0xe2)),utils_1=require(a111_0x48df6b(0x91)),typedi_1=require(a111_0x48df6b(0x98)),hooks_utils_1=require(a111_0x48df6b(0x99)),git_branch_not_found_error_1=require(a111_0x48df6b(0xb2)),flosum_sync_job_1=require(a111_0x48df6b(0xb7)),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require(a111_0x48df6b(0xb4)),bad_request_error_1=require(a111_0x48df6b(0xb6));let SyncService=SyncService_1=class SyncService{constructor(_0x7889f5,_0x574dc4){const _0x2ce66a=a111_0x48df6b;this[_0x2ce66a(0x108)]=_0x7889f5,this['salesforceSync']=_0x574dc4,this[_0x2ce66a(0xa0)]=new core_1[(_0x2ce66a(0xcc))](SyncService_1[_0x2ce66a(0xb1)]),this[_0x2ce66a(0xcd)]={},this[_0x2ce66a(0xbc)]=[];}async[a111_0x48df6b(0xec)](_0x85969b,_0x1ee15b){const _0x5b54ba=a111_0x48df6b;if(_0x1ee15b instanceof git_branch_not_found_error_1[_0x5b54ba(0xc5)]){await this[_0x5b54ba(0xa8)][_0x5b54ba(0xfc)](_0x85969b,_0x5b54ba(0xea));return;}if(_0x1ee15b instanceof too_many_requests_error_1[_0x5b54ba(0x103)]){await this[_0x5b54ba(0xa8)][_0x5b54ba(0xfc)](_0x85969b,_0x5b54ba(0xdf));throw _0x1ee15b;}try{await this[_0x5b54ba(0xe0)][_0x5b54ba(0xa1)](this[_0x5b54ba(0xe3)]+_0x5b54ba(0xa4)+_0x85969b[_0x5b54ba(0xa2)]+_0x5b54ba(0xa7)+_0x85969b[_0x5b54ba(0x8e)]+_0x5b54ba(0xc4)+_0x1ee15b+'.')[_0x5b54ba(0xd8)](),await this['salesforceSync']['updateRemoteState'](_0x85969b,{}),await this[_0x5b54ba(0xa8)]['setStatus'](_0x85969b,_0x5b54ba(0xb5));}catch(_0x617bc3){if(_0x617bc3 instanceof salesforce_error_1[_0x5b54ba(0xd9)])throw _0x617bc3;}}async[a111_0x48df6b(0xe1)](_0xffbd06){const _0x54413d=a111_0x48df6b;if(_0xffbd06[_0x54413d(0xf6)]){const _0xee0f3c=_0xffbd06[_0x54413d(0xa2)][_0x54413d(0xd3)](),_0x5ba058=this[_0x54413d(0xcd)][_0xee0f3c];if(!_0x5ba058)this['repositoriesIntersections'][_0xee0f3c]=_0xffbd06['repositoryName'];else{if(_0x5ba058&&_0x5ba058!==_0xffbd06[_0x54413d(0xa2)])return await this['handleRecordSyncError'](_0xffbd06,new Error(_0x54413d(0x102)+_0xffbd06['repositoryName']+_0x54413d(0xe9)+_0xee0f3c+_0x54413d(0xf7)+_0x5ba058+'\x27')),!![];}}return![];}async[a111_0x48df6b(0x100)](_0x6b9c35){const _0x1a276c=a111_0x48df6b;if(!constants_1[_0x1a276c(0xf2)]['test'](_0x6b9c35[_0x1a276c(0xa2)]))return await this[_0x1a276c(0xec)](_0x6b9c35,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x6b9c35['repositoryName']+_0x1a276c(0x105))),![];if(!constants_1[_0x1a276c(0xfb)][_0x1a276c(0x8d)](_0x6b9c35[_0x1a276c(0x8e)]))return await this['handleRecordSyncError'](_0x6b9c35,new Error(_0x1a276c(0xf1)+_0x6b9c35[_0x1a276c(0x8e)]+'\x27\x20in\x20repository\x20\x27'+_0x6b9c35[_0x1a276c(0xa2)]+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async['getOrCreateRepo'](_0x36b1ee,_0x4c0db4){const _0x5724aa=a111_0x48df6b;let _0x503d63=this[_0x5724aa(0xbc)][_0x5724aa(0xdb)](_0x10c7b6=>_0x36b1ee[_0x5724aa(0xa2)]===_0x10c7b6[_0x5724aa(0xb1)]);!_0x503d63&&(this['sfLogger']['log'](this[_0x5724aa(0xe3)]+_0x5724aa(0x94)+_0x36b1ee[_0x5724aa(0xa2)]+_0x5724aa(0x10c)),_0x503d63=await this['repoService'][_0x5724aa(0xb8)]({'name':_0x36b1ee[_0x5724aa(0xa2)],'autoInit':!![],'defaultBranch':_0x36b1ee[_0x5724aa(0x8e)],'private':!![],'createHook':typedi_1[_0x5724aa(0xe7)]['get'](providers_tokens_1['Tokens'][_0x5724aa(0xfe)])[_0x5724aa(0xf5)]}));if(this[_0x5724aa(0xfe)][_0x5724aa(0xf5)]){const _0x59fa80=await _0x503d63[_0x5724aa(0xd2)][_0x5724aa(0xc2)]();!_0x59fa80[_0x5724aa(0xdb)](_0x5a07cc=>_0x5a07cc[_0x5724aa(0xe4)]===hooks_utils_1['HooksUtils']['getHookLinkFor'](this[_0x5724aa(0xfe)][_0x5724aa(0xe8)],this[_0x5724aa(0xfe)]['applicationUrl'],_0x4c0db4))&&(this[_0x5724aa(0xe0)][_0x5724aa(0xf3)](this[_0x5724aa(0xe3)]+_0x5724aa(0x94)+_0x36b1ee['repositoryName']+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x503d63['hooks']['create'](hooks_utils_1[_0x5724aa(0xed)][_0x5724aa(0x107)](this[_0x5724aa(0xfe)]['gitProvider'],_0x503d63['hooks'],this[_0x5724aa(0xfe)][_0x5724aa(0xc8)],_0x4c0db4)));}return this[_0x5724aa(0xbc)]['push'](_0x503d63),_0x503d63;}async['run'](){const _0x3d43a4=a111_0x48df6b;this[_0x3d43a4(0xc9)]=typedi_1[_0x3d43a4(0xe7)][_0x3d43a4(0xa6)](providers_tokens_1[_0x3d43a4(0x104)][_0x3d43a4(0xc9)]),this[_0x3d43a4(0xd7)]=typedi_1[_0x3d43a4(0xe7)]['get'](providers_tokens_1[_0x3d43a4(0x104)][_0x3d43a4(0xa3)]),this[_0x3d43a4(0xfe)]=typedi_1[_0x3d43a4(0xe7)][_0x3d43a4(0xa6)](providers_tokens_1[_0x3d43a4(0x104)][_0x3d43a4(0xfe)]),this[_0x3d43a4(0xe0)]=typedi_1[_0x3d43a4(0xe7)][_0x3d43a4(0xa6)](providers_tokens_1[_0x3d43a4(0x104)][_0x3d43a4(0xa0)]),this[_0x3d43a4(0xe3)]='['+SyncService_1[_0x3d43a4(0xb1)]+']\x20['+this[_0x3d43a4(0xfe)][_0x3d43a4(0xe8)][_0x3d43a4(0xd4)]()+']',this[_0x3d43a4(0x108)][_0x3d43a4(0xe5)](this[_0x3d43a4(0xe0)][_0x3d43a4(0xca)]());try{this[_0x3d43a4(0xe0)][_0x3d43a4(0xf3)](this[_0x3d43a4(0xe3)]+'\x20Start\x20sync\x20job.'),await this[_0x3d43a4(0xe0)][_0x3d43a4(0xf3)](this[_0x3d43a4(0xe3)]+_0x3d43a4(0x92))['send']();const _0x18c9a7=await this[_0x3d43a4(0xa8)][_0x3d43a4(0x10b)](typedi_1[_0x3d43a4(0xe7)][_0x3d43a4(0xa6)](providers_tokens_1[_0x3d43a4(0x104)][_0x3d43a4(0xbf)]));if(!_0x18c9a7[_0x3d43a4(0x9e)])throw new bad_request_error_1[(_0x3d43a4(0xd0))](this[_0x3d43a4(0xe3)]+_0x3d43a4(0xf0));await this[_0x3d43a4(0xe0)][_0x3d43a4(0xf3)](this[_0x3d43a4(0xe3)]+_0x3d43a4(0x8f))[_0x3d43a4(0xd8)]();const _0x370d02=await this[_0x3d43a4(0xa8)][_0x3d43a4(0xad)](_0x18c9a7[_0x3d43a4(0xff)](_0x114e2d=>'\x27'+_0x114e2d[_0x3d43a4(0xf6)]+'\x27')[_0x3d43a4(0xb9)](','));await this['sfLogger'][_0x3d43a4(0xf3)](this['prefix']+'\x20Getting\x20repositories\x20from\x20git\x20service.')[_0x3d43a4(0xd8)](),this[_0x3d43a4(0xbc)]=await this[_0x3d43a4(0xd7)][_0x3d43a4(0xc2)]();const _0x2255cc=[..._0x18c9a7,..._0x370d02];this[_0x3d43a4(0xe0)]['log'](this[_0x3d43a4(0xe3)]+'\x20Have\x20to\x20synchronize\x20'+_0x2255cc[_0x3d43a4(0x9e)]+_0x3d43a4(0x9f));for(const _0x5e78ab of _0x2255cc){this[_0x3d43a4(0xa0)][_0x3d43a4(0xf3)](_0x3d43a4(0xf9)+_0x5e78ab['repositoryName']+'['+_0x5e78ab[_0x3d43a4(0xf6)]+']\x20repository\x20'+_0x5e78ab[_0x3d43a4(0x8e)]+'['+_0x5e78ab['branchId']+_0x3d43a4(0xae)),this[_0x3d43a4(0xe0)]['log'](this[_0x3d43a4(0xe3)]+_0x3d43a4(0xd5)+_0x5e78ab['repositoryName']+_0x3d43a4(0xf4)+_0x5e78ab[_0x3d43a4(0x8e)]+'\x22.'),this[_0x3d43a4(0xe0)][_0x3d43a4(0xf3)](this['prefix']+_0x3d43a4(0xeb));const _0x5b8f28=await this[_0x3d43a4(0x100)](_0x5e78ab);if(!_0x5b8f28)continue;this[_0x3d43a4(0xe0)]['log'](this[_0x3d43a4(0xe3)]+_0x3d43a4(0xa5));const _0x82acd5=await this[_0x3d43a4(0xe1)](_0x5e78ab);if(_0x82acd5)continue;await this[_0x3d43a4(0xe0)]['send']();let _0x12fc4f;try{await this[_0x3d43a4(0xe0)][_0x3d43a4(0xf3)](this[_0x3d43a4(0xe3)]+_0x3d43a4(0xf8))[_0x3d43a4(0xd8)](),_0x12fc4f=await this[_0x3d43a4(0xb3)](_0x5e78ab,typedi_1[_0x3d43a4(0xe7)][_0x3d43a4(0xa6)](providers_tokens_1[_0x3d43a4(0x104)][_0x3d43a4(0xbf)]));}catch(_0x4e287f){await this[_0x3d43a4(0xec)](_0x5e78ab,_0x4e287f instanceof too_many_requests_error_1[_0x3d43a4(0x103)]?_0x4e287f:new Error(_0x3d43a4(0xb0)+_0x4e287f));continue;}await this[_0x3d43a4(0xe0)][_0x3d43a4(0xf3)](this['prefix']+_0x3d43a4(0xbb))[_0x3d43a4(0xd8)]();if(_0x5e78ab['direction']===flosum_repository_sync_dto_1[_0x3d43a4(0xcb)][_0x3d43a4(0x96)]){const _0x323352=typedi_1[_0x3d43a4(0xe7)][_0x3d43a4(0xa6)](flosum_sync_job_1[_0x3d43a4(0xbd)]);await _0x323352['run']({'repository':_0x12fc4f,'convertToSFDX':this[_0x3d43a4(0xfe)]['isConvertToSfdx'],'syncRecord':_0x5e78ab,'provider':this[_0x3d43a4(0xfe)][_0x3d43a4(0xe8)]})[_0x3d43a4(0xac)](_0x328775=>this[_0x3d43a4(0xec)](_0x5e78ab,_0x328775));}else{const _0x255df9=typedi_1[_0x3d43a4(0xe7)][_0x3d43a4(0xa6)](git_sync_job_1[_0x3d43a4(0xef)]);await _0x255df9[_0x3d43a4(0xde)]({'repository':_0x12fc4f,'branch':_0x5e78ab[_0x3d43a4(0x8e)],'provider':this[_0x3d43a4(0xfe)]['gitProvider'],'repositoryGit':_0x12fc4f[_0x3d43a4(0xd1)],'syncRecord':_0x5e78ab})['catch'](_0x2579b1=>this[_0x3d43a4(0xec)](_0x5e78ab,_0x2579b1));}}}catch(_0x1ddb2b){this[_0x3d43a4(0xa0)][_0x3d43a4(0xa1)](_0x1ddb2b);_0x1ddb2b instanceof too_many_requests_error_1[_0x3d43a4(0x103)]?(await this['sfLogger'][_0x3d43a4(0xf3)](this[_0x3d43a4(0xe3)]+_0x3d43a4(0x9c))['send'](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0x3d43a4(0xde)]()):await this[_0x3d43a4(0xe0)]['error'](this[_0x3d43a4(0xe3)]+_0x3d43a4(0x97)+_0x1ddb2b)[_0x3d43a4(0xd8)]();return;}await this['sfLogger'][_0x3d43a4(0xf3)](this['prefix']+'\x20Sync\x20job\x20done.')[_0x3d43a4(0xd8)](),await this[_0x3d43a4(0xa8)][_0x3d43a4(0x8b)](typedi_1[_0x3d43a4(0xe7)]['get'](providers_tokens_1[_0x3d43a4(0x104)][_0x3d43a4(0xbf)]))[_0x3d43a4(0xac)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x48df6b(0xa9)])({'transient':!![]}),__metadata(a111_0x48df6b(0xc6),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a111_0x48df6b(0xaa)]])],SyncService),exports[a111_0x48df6b(0xee)]=SyncService;