const a128_0x316574=a128_0x3f9a;function a128_0x5393(){const _0x5e6232=['getAll','\x20Getting\x20repository\x20records.','../../salesforce/errors/salesforce.error',']\x20due\x20error\x20-\x20','object','test','FlosumToGit','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','SyncService',']\x20[','toLowerCase','__decorate','isConvertToSfdx','GitBranchNotFoundError','get','hooks','send','10gMEkIE','313806rTKVkp','../../../../constants','toUpperCase','config','4853805QtJNfY','\x20Syncing\x20repository:\x20\x22','\x20Getting\x20branch\x20records.','getBranchRecords','34041ZgPHPT','Waiting','\x20Checking\x20valid\x20name.','logger','defineProperty','REPOSITORY_NAME_REGEXP','createHookPayload','../../../../core/errors/bad-request.error','length','\x20Have\x20to\x20synchronize\x20','checkValidNaming','64744iXaXKH','\x20Start\x20sync\x20job.','gitProvider','Unable\x20to\x20synchronize\x20repository\x20\x27','error','push','getRepositoryRecords','metadata','__metadata','repositoryId','../jobs/git-sync.job','join','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','__esModule','salesforceService','repoService','repositoryName','../../salesforce/services/salesforce-sync.service','repoList','TooManyRequests','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','sfLogger','handleRecordSyncError','\x20Completed\x20prepare\x20to\x20syncing.','sleep','Not\x20Synchronized','../errors/git-branch-not-found.error','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','catch','3IjSjHf','BadRequestError','gitUrl','gitApiService','44664vlTJdZ','getHookLinkFor','find','\x20No\x20repositories\x20to\x20sync.','applicationUrl','function','isBidirectionalSynchronization','decorate','isIntersects','../../salesforce/services/salesforce.service','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','\x27\x20in\x20repository\x20\x27','getLoggerId','133gFRyoI','\x22\x20branch:\x20\x22','url','SyncDirection','name','branchName','\x27\x20-\x20\x27','map','prefix','(((.+)+)+)+$','run','Container','\x20Getting\x20repositories\x20from\x20git\x20service.','branchId','HooksUtils','177006PrSzeE','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','search','create','Logger','\x20branches.','../../../shared/utils','15zOVenF',']\x20branch.','salesforceSync','\x20Repository\x20\x22','repositoriesIntersections','../../providers/web-hooks/hooks.utils','1977237gUGRgk','log','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','../../providers/providers.tokens','connectionId','Unable\x20to\x20synchronize\x20branch\x20\x27','setStatus','../jobs/flosum-sync.job','Service','apply','getOrCreateRepo','\x20Sync\x20job\x20done.','SalesforceService','Tokens'];a128_0x5393=function(){return _0x5e6232;};return a128_0x5393();}(function(_0x40e763,_0x3b2fba){const _0x330e93=a128_0x3f9a,_0x21364c=_0x40e763();while(!![]){try{const _0x4be754=-parseInt(_0x330e93(0x1eb))/0x1+parseInt(_0x330e93(0x1e3))/0x2+parseInt(_0x330e93(0x213))/0x3*(parseInt(_0x330e93(0x217))/0x4)+parseInt(_0x330e93(0x1bd))/0x5*(-parseInt(_0x330e93(0x1b6))/0x6)+parseInt(_0x330e93(0x1a7))/0x7*(-parseInt(_0x330e93(0x1f6))/0x8)+-parseInt(_0x330e93(0x1c3))/0x9*(parseInt(_0x330e93(0x1e2))/0xa)+parseInt(_0x330e93(0x1e7))/0xb;if(_0x4be754===_0x3b2fba)break;else _0x21364c['push'](_0x21364c['shift']());}catch(_0x106ebc){_0x21364c['push'](_0x21364c['shift']());}}}(a128_0x5393,0x1baa8));const a128_0x15b3fb=(function(){let _0x38debb=!![];return function(_0x2dec37,_0x27cc3a){const _0x37cce7=_0x38debb?function(){const _0x2a970d=a128_0x3f9a;if(_0x27cc3a){const _0x285f0d=_0x27cc3a[_0x2a970d(0x1cc)](_0x2dec37,arguments);return _0x27cc3a=null,_0x285f0d;}}:function(){};return _0x38debb=![],_0x37cce7;};}()),a128_0xb7b3f0=a128_0x15b3fb(this,function(){const _0x10f380=a128_0x3f9a;return a128_0xb7b3f0['toString']()[_0x10f380(0x1b8)](_0x10f380(0x1b0))['toString']()['constructor'](a128_0xb7b3f0)[_0x10f380(0x1b8)](_0x10f380(0x1b0));});a128_0xb7b3f0();'use strict';function a128_0x3f9a(_0x9ce7c,_0x43fbc3){const _0x20dbe6=a128_0x5393();return a128_0x3f9a=function(_0xb7b3f0,_0x15b3fb){_0xb7b3f0=_0xb7b3f0-0x1a3;let _0x539311=_0x20dbe6[_0xb7b3f0];return _0x539311;},a128_0x3f9a(_0x9ce7c,_0x43fbc3);}var __decorate=this&&this[a128_0x316574(0x1dc)]||function(_0xe9f9aa,_0x126bb1,_0x660e7c,_0x1544d0){const _0x26ced7=a128_0x316574;var _0x24f490=arguments[_0x26ced7(0x1f3)],_0x39994d=_0x24f490<0x3?_0x126bb1:_0x1544d0===null?_0x1544d0=Object['getOwnPropertyDescriptor'](_0x126bb1,_0x660e7c):_0x1544d0,_0x2c73a9;if(typeof Reflect==='object'&&typeof Reflect[_0x26ced7(0x21e)]===_0x26ced7(0x21c))_0x39994d=Reflect[_0x26ced7(0x21e)](_0xe9f9aa,_0x126bb1,_0x660e7c,_0x1544d0);else{for(var _0x56c3a6=_0xe9f9aa['length']-0x1;_0x56c3a6>=0x0;_0x56c3a6--)if(_0x2c73a9=_0xe9f9aa[_0x56c3a6])_0x39994d=(_0x24f490<0x3?_0x2c73a9(_0x39994d):_0x24f490>0x3?_0x2c73a9(_0x126bb1,_0x660e7c,_0x39994d):_0x2c73a9(_0x126bb1,_0x660e7c))||_0x39994d;}return _0x24f490>0x3&&_0x39994d&&Object[_0x26ced7(0x1ef)](_0x126bb1,_0x660e7c,_0x39994d),_0x39994d;},__metadata=this&&this[a128_0x316574(0x1fe)]||function(_0x46d51c,_0x4cdf11){const _0x21e966=a128_0x316574;if(typeof Reflect===_0x21e966(0x1d5)&&typeof Reflect[_0x21e966(0x1fd)]===_0x21e966(0x21c))return Reflect[_0x21e966(0x1fd)](_0x46d51c,_0x4cdf11);},SyncService_1;Object[a128_0x316574(0x1ef)](exports,a128_0x316574(0x203),{'value':!![]}),exports[a128_0x316574(0x1d9)]=void 0x0;const constants_1=require(a128_0x316574(0x1e4)),core_1=require('../../../../core'),too_many_requests_error_1=require('../../../../core/errors/too-many-requests.error'),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require(a128_0x316574(0x1d3)),salesforce_sync_service_1=require(a128_0x316574(0x207)),salesforce_service_1=require(a128_0x316574(0x1a3)),utils_1=require(a128_0x316574(0x1bc)),typedi_1=require('typedi'),hooks_utils_1=require(a128_0x316574(0x1c2)),git_branch_not_found_error_1=require(a128_0x316574(0x210)),flosum_sync_job_1=require(a128_0x316574(0x1ca)),git_sync_job_1=require(a128_0x316574(0x200)),providers_tokens_1=require(a128_0x316574(0x1c6)),bad_request_error_1=require(a128_0x316574(0x1f2));let SyncService=SyncService_1=class SyncService{constructor(_0x197f15,_0xa5d775){const _0x30844a=a128_0x316574;this[_0x30844a(0x204)]=_0x197f15,this[_0x30844a(0x1bf)]=_0xa5d775,this[_0x30844a(0x1ee)]=new core_1[(_0x30844a(0x1ba))](SyncService_1[_0x30844a(0x1ab)]),this[_0x30844a(0x1c1)]={},this['repoList']=[];}async[a128_0x316574(0x20c)](_0x5ddfc1,_0x4b3c6c){const _0x3b91a4=a128_0x316574;if(_0x4b3c6c instanceof git_branch_not_found_error_1[_0x3b91a4(0x1de)]){await this['salesforceSync'][_0x3b91a4(0x1c9)](_0x5ddfc1,_0x3b91a4(0x20f));return;}if(_0x4b3c6c instanceof too_many_requests_error_1[_0x3b91a4(0x209)]){await this[_0x3b91a4(0x1bf)][_0x3b91a4(0x1c9)](_0x5ddfc1,_0x3b91a4(0x1ec));throw _0x4b3c6c;}try{await this[_0x3b91a4(0x20b)]['error'](this[_0x3b91a4(0x1af)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x5ddfc1['repositoryName']+'\x27\x20['+_0x5ddfc1['branchName']+_0x3b91a4(0x1d4)+_0x4b3c6c+'.')['send'](),await this[_0x3b91a4(0x1bf)]['updateRemoteState'](_0x5ddfc1,{}),await this[_0x3b91a4(0x1bf)][_0x3b91a4(0x1c9)](_0x5ddfc1,'Error');}catch(_0x731203){if(_0x731203 instanceof salesforce_error_1['SalesforceError'])throw _0x731203;}}async[a128_0x316574(0x21f)](_0x80f2c6){const _0x1caeeb=a128_0x316574;if(_0x80f2c6[_0x1caeeb(0x1ff)]){const _0x40309d=_0x80f2c6[_0x1caeeb(0x206)][_0x1caeeb(0x1db)](),_0x340c5d=this['repositoriesIntersections'][_0x40309d];if(!_0x340c5d)this['repositoriesIntersections'][_0x40309d]=_0x80f2c6[_0x1caeeb(0x206)];else{if(_0x340c5d&&_0x340c5d!==_0x80f2c6[_0x1caeeb(0x206)])return await this[_0x1caeeb(0x20c)](_0x80f2c6,new Error(_0x1caeeb(0x1f9)+_0x80f2c6[_0x1caeeb(0x206)]+_0x1caeeb(0x1d8)+_0x40309d+_0x1caeeb(0x1ad)+_0x340c5d+'\x27')),!![];}}return![];}async[a128_0x316574(0x1f5)](_0x527813){const _0x26deae=a128_0x316574;if(!constants_1[_0x26deae(0x1f0)][_0x26deae(0x1d6)](_0x527813[_0x26deae(0x206)]))return await this['handleRecordSyncError'](_0x527813,new Error(_0x26deae(0x1f9)+_0x527813['repositoryName']+_0x26deae(0x211))),![];if(!constants_1['BRANCH_NAME_REGEXP']['test'](_0x527813[_0x26deae(0x1ac)]))return await this[_0x26deae(0x20c)](_0x527813,new Error(_0x26deae(0x1c8)+_0x527813[_0x26deae(0x1ac)]+_0x26deae(0x1a5)+_0x527813[_0x26deae(0x206)]+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async[a128_0x316574(0x1cd)](_0x81ff93,_0x1b3d34){const _0x31f83e=a128_0x316574;let _0x25eccb=this[_0x31f83e(0x208)][_0x31f83e(0x219)](_0x3838aa=>_0x81ff93[_0x31f83e(0x206)]===_0x3838aa['name']);!_0x25eccb&&(this['sfLogger']['log'](this[_0x31f83e(0x1af)]+_0x31f83e(0x1c0)+_0x81ff93[_0x31f83e(0x206)]+_0x31f83e(0x20a)),_0x25eccb=await this[_0x31f83e(0x205)][_0x31f83e(0x1b9)]({'name':_0x81ff93[_0x31f83e(0x206)],'autoInit':!![],'defaultBranch':_0x81ff93[_0x31f83e(0x1ac)],'private':!![],'createHook':typedi_1['Container']['get'](providers_tokens_1[_0x31f83e(0x1d0)][_0x31f83e(0x1e6)])[_0x31f83e(0x21d)]}));if(this[_0x31f83e(0x1e6)][_0x31f83e(0x21d)]){const _0x454870=await _0x25eccb[_0x31f83e(0x1e0)][_0x31f83e(0x1d1)]();!_0x454870[_0x31f83e(0x219)](_0x256fd5=>_0x256fd5[_0x31f83e(0x1a9)]===hooks_utils_1['HooksUtils'][_0x31f83e(0x218)](this[_0x31f83e(0x1e6)][_0x31f83e(0x1f8)],this['config']['applicationUrl'],_0x1b3d34))&&(this[_0x31f83e(0x20b)][_0x31f83e(0x1c4)](this[_0x31f83e(0x1af)]+_0x31f83e(0x1c0)+_0x81ff93['repositoryName']+_0x31f83e(0x202)),await _0x25eccb[_0x31f83e(0x1e0)][_0x31f83e(0x1b9)](hooks_utils_1[_0x31f83e(0x1b5)][_0x31f83e(0x1f1)](this[_0x31f83e(0x1e6)]['gitProvider'],_0x25eccb['hooks'],this[_0x31f83e(0x1e6)][_0x31f83e(0x21b)],_0x1b3d34)));}return this[_0x31f83e(0x208)][_0x31f83e(0x1fb)](_0x25eccb),_0x25eccb;}async[a128_0x316574(0x1b1)](){const _0x52853e=a128_0x316574;this[_0x52853e(0x216)]=typedi_1['Container'][_0x52853e(0x1df)](providers_tokens_1[_0x52853e(0x1d0)][_0x52853e(0x216)]),this[_0x52853e(0x205)]=typedi_1[_0x52853e(0x1b2)]['get'](providers_tokens_1['Tokens']['gitRepoService']),this[_0x52853e(0x1e6)]=typedi_1[_0x52853e(0x1b2)][_0x52853e(0x1df)](providers_tokens_1['Tokens'][_0x52853e(0x1e6)]),this['sfLogger']=typedi_1[_0x52853e(0x1b2)]['get'](providers_tokens_1[_0x52853e(0x1d0)][_0x52853e(0x1ee)]),this[_0x52853e(0x1af)]='['+SyncService_1[_0x52853e(0x1ab)]+_0x52853e(0x1da)+this[_0x52853e(0x1e6)][_0x52853e(0x1f8)][_0x52853e(0x1e5)]()+']',this[_0x52853e(0x204)]['setLoggerId'](this[_0x52853e(0x20b)][_0x52853e(0x1a6)]());try{this[_0x52853e(0x20b)][_0x52853e(0x1c4)](this[_0x52853e(0x1af)]+_0x52853e(0x1f7)),await this[_0x52853e(0x20b)][_0x52853e(0x1c4)](this['prefix']+_0x52853e(0x1d2))[_0x52853e(0x1e1)]();const _0x26345e=await this[_0x52853e(0x1bf)][_0x52853e(0x1fc)](typedi_1[_0x52853e(0x1b2)][_0x52853e(0x1df)](providers_tokens_1[_0x52853e(0x1d0)][_0x52853e(0x1c7)]));if(!_0x26345e['length'])throw new bad_request_error_1[(_0x52853e(0x214))](this[_0x52853e(0x1af)]+_0x52853e(0x21a));await this[_0x52853e(0x20b)][_0x52853e(0x1c4)](this[_0x52853e(0x1af)]+_0x52853e(0x1e9))[_0x52853e(0x1e1)]();const _0x291e19=await this['salesforceSync'][_0x52853e(0x1ea)](_0x26345e[_0x52853e(0x1ae)](_0x4e6458=>'\x27'+_0x4e6458[_0x52853e(0x1ff)]+'\x27')[_0x52853e(0x201)](','));await this['sfLogger'][_0x52853e(0x1c4)](this[_0x52853e(0x1af)]+_0x52853e(0x1b3))[_0x52853e(0x1e1)](),this['repoList']=await this[_0x52853e(0x205)]['getAll']();const _0x5d24cc=[..._0x26345e,..._0x291e19];this['sfLogger']['log'](this[_0x52853e(0x1af)]+_0x52853e(0x1f4)+_0x5d24cc[_0x52853e(0x1f3)]+_0x52853e(0x1bb));for(const _0x6af604 of _0x5d24cc){this[_0x52853e(0x1ee)][_0x52853e(0x1c4)]('Syncing\x20'+_0x6af604['repositoryName']+'['+_0x6af604[_0x52853e(0x1ff)]+']\x20repository\x20'+_0x6af604['branchName']+'['+_0x6af604[_0x52853e(0x1b4)]+_0x52853e(0x1be)),this['sfLogger'][_0x52853e(0x1c4)](this[_0x52853e(0x1af)]+_0x52853e(0x1e8)+_0x6af604[_0x52853e(0x206)]+_0x52853e(0x1a8)+_0x6af604[_0x52853e(0x1ac)]+'\x22.'),this[_0x52853e(0x20b)][_0x52853e(0x1c4)](this[_0x52853e(0x1af)]+_0x52853e(0x1ed));const _0x46da54=await this['checkValidNaming'](_0x6af604);if(!_0x46da54)continue;this[_0x52853e(0x20b)][_0x52853e(0x1c4)](this[_0x52853e(0x1af)]+'\x20Checking\x20intersects.');const _0x4f061e=await this[_0x52853e(0x21f)](_0x6af604);if(_0x4f061e)continue;await this[_0x52853e(0x20b)]['send']();let _0xb86c15;try{await this[_0x52853e(0x20b)][_0x52853e(0x1c4)](this[_0x52853e(0x1af)]+'\x20Getting\x20Flosum\x20repository')[_0x52853e(0x1e1)](),_0xb86c15=await this[_0x52853e(0x1cd)](_0x6af604,typedi_1[_0x52853e(0x1b2)]['get'](providers_tokens_1['Tokens'][_0x52853e(0x1c7)]));}catch(_0x48636b){await this[_0x52853e(0x20c)](_0x6af604,_0x48636b instanceof too_many_requests_error_1['TooManyRequests']?_0x48636b:new Error(_0x52853e(0x1c5)+_0x48636b));continue;}await this[_0x52853e(0x20b)][_0x52853e(0x1c4)](this['prefix']+_0x52853e(0x20d))[_0x52853e(0x1e1)]();if(_0x6af604['direction']===flosum_repository_sync_dto_1[_0x52853e(0x1aa)][_0x52853e(0x1d7)]){const _0x1969fb=typedi_1[_0x52853e(0x1b2)][_0x52853e(0x1df)](flosum_sync_job_1['FlosumSyncJob']);await _0x1969fb[_0x52853e(0x1b1)]({'repository':_0xb86c15,'convertToSFDX':this[_0x52853e(0x1e6)][_0x52853e(0x1dd)],'syncRecord':_0x6af604,'provider':this[_0x52853e(0x1e6)]['gitProvider']})[_0x52853e(0x212)](_0xb786be=>this[_0x52853e(0x20c)](_0x6af604,_0xb786be));}else{const _0x2fecd5=typedi_1[_0x52853e(0x1b2)][_0x52853e(0x1df)](git_sync_job_1['GitSyncJob']);await _0x2fecd5[_0x52853e(0x1b1)]({'repository':_0xb86c15,'branch':_0x6af604[_0x52853e(0x1ac)],'provider':this[_0x52853e(0x1e6)][_0x52853e(0x1f8)],'repositoryGit':_0xb86c15[_0x52853e(0x215)],'syncRecord':_0x6af604})[_0x52853e(0x212)](_0x45c966=>this[_0x52853e(0x20c)](_0x6af604,_0x45c966));}}}catch(_0x3f956a){this[_0x52853e(0x1ee)]['error'](_0x3f956a);_0x3f956a instanceof too_many_requests_error_1[_0x52853e(0x209)]?(await this[_0x52853e(0x20b)][_0x52853e(0x1c4)](this[_0x52853e(0x1af)]+_0x52853e(0x1b7))[_0x52853e(0x1e1)](),await(0x0,utils_1[_0x52853e(0x20e)])(0x3c*0x3c*0x3e8),this[_0x52853e(0x1b1)]()):await this['sfLogger'][_0x52853e(0x1fa)](this[_0x52853e(0x1af)]+_0x52853e(0x1a4)+_0x3f956a)['send']();return;}await this[_0x52853e(0x20b)][_0x52853e(0x1c4)](this[_0x52853e(0x1af)]+_0x52853e(0x1ce))['send'](),await this[_0x52853e(0x1bf)]['disableSync'](typedi_1['Container']['get'](providers_tokens_1[_0x52853e(0x1d0)][_0x52853e(0x1c7)]))[_0x52853e(0x212)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a128_0x316574(0x1cb)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a128_0x316574(0x1cf)],salesforce_sync_service_1['SalesforceSyncService']])],SyncService),exports[a128_0x316574(0x1d9)]=SyncService;