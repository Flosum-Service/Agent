const a128_0x1ca796=a128_0x5ade;function a128_0x2793(){const _0x476ab1=['connectionId','join','../../salesforce/errors/salesforce.error','checkValidNaming','create','get','repositoriesIntersections','metadata','setLoggerId','hooks','push','isBidirectionalSynchronization','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','Not\x20Synchronized','isIntersects','length','\x20Getting\x20repository\x20records.','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','../../../../constants','send','repoService','\x20Getting\x20Flosum\x20repository','\x20Getting\x20branch\x20records.','getOrCreateRepo','applicationUrl','setStatus','FlosumSyncJob','\x20Have\x20to\x20synchronize\x20','TooManyRequests','\x20Repository\x20\x22','sfLogger','getLoggerId','handleRecordSyncError','\x20Stop\x20sync\x20job\x20for\x20\x27','run','catch','salesforceService','object','\x20Getting\x20repositories\x20from\x20git\x20service.','gitUrl','Syncing\x20','FlosumToGit','877860pFgppx','design:paramtypes','\x27\x20-\x20\x27','function','\x27\x20[','branchName','createHookPayload','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','getOwnPropertyDescriptor','\x22\x20branch:\x20\x22','SalesforceError','2890992HPRTuJ','2146821jiDDqg','updateRemoteState','gitProvider','\x20branches.','../../../../core/errors/too-many-requests.error',']\x20due\x20error\x20-\x20',']\x20branch.','config','../jobs/git-sync.job','isConvertToSfdx','SalesforceService','../../../../core/errors/bad-request.error','error','find','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','\x27\x20in\x20repository\x20\x27','../../salesforce/services/salesforce-sync.service','7786712sSMsuT','apply','Unable\x20to\x20synchronize\x20repository\x20\x27','logger','\x20Completed\x20prepare\x20to\x20syncing.','__esModule','12lynkJf','constructor','gitRepoService','../../salesforce/dto/flosum-repository-sync.dto','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','SalesforceSyncService','../errors/git-branch-not-found.error','(((.+)+)+)+$','log','prefix','repositoryName','BRANCH_NAME_REGEXP','Container','name','defineProperty','567240hPqQmJ','\x20No\x20repositories\x20to\x20sync.',']\x20repository\x20','getRepositoryRecords','direction','\x20Start\x20sync\x20job.','decorate','HooksUtils','salesforceSync','SyncService','url','getAll','repoList','getBranchRecords','Logger','branchId','toString','917455JkcUGT','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','toLowerCase','SyncDirection','Tokens','../jobs/flosum-sync.job','sleep','repositoryId','test','\x20Checking\x20intersects.','REPOSITORY_NAME_REGEXP','1590886isOxLi',']\x20[','disableSync','map','\x20Checking\x20valid\x20name.'];a128_0x2793=function(){return _0x476ab1;};return a128_0x2793();}(function(_0x1e28b1,_0x50479d){const _0x2d7506=a128_0x5ade,_0x479075=_0x1e28b1();while(!![]){try{const _0x11a724=parseInt(_0x2d7506(0xf7))/0x1+-parseInt(_0x2d7506(0x113))/0x2+parseInt(_0x2d7506(0xd1))/0x3+parseInt(_0x2d7506(0xe8))/0x4*(parseInt(_0x2d7506(0xc5))/0x5)+parseInt(_0x2d7506(0xd0))/0x6+parseInt(_0x2d7506(0x108))/0x7+-parseInt(_0x2d7506(0xe2))/0x8;if(_0x11a724===_0x50479d)break;else _0x479075['push'](_0x479075['shift']());}catch(_0x2ea652){_0x479075['push'](_0x479075['shift']());}}}(a128_0x2793,0x9f96e));const a128_0xdfce49=(function(){let _0x4e152e=!![];return function(_0x36c097,_0x3b38e5){const _0x468afe=_0x4e152e?function(){const _0x55b5dc=a128_0x5ade;if(_0x3b38e5){const _0x4e9509=_0x3b38e5[_0x55b5dc(0xe3)](_0x36c097,arguments);return _0x3b38e5=null,_0x4e9509;}}:function(){};return _0x4e152e=![],_0x468afe;};}()),a128_0x38dda2=a128_0xdfce49(this,function(){const _0x318830=a128_0x5ade;return a128_0x38dda2[_0x318830(0x107)]()['search'](_0x318830(0xef))[_0x318830(0x107)]()[_0x318830(0xe9)](a128_0x38dda2)['search']('(((.+)+)+)+$');});a128_0x38dda2();'use strict';function a128_0x5ade(_0x245269,_0x56e40d){const _0x3f1fec=a128_0x2793();return a128_0x5ade=function(_0x38dda2,_0xdfce49){_0x38dda2=_0x38dda2-0x9e;let _0x279361=_0x3f1fec[_0x38dda2];return _0x279361;},a128_0x5ade(_0x245269,_0x56e40d);}var __decorate=this&&this['__decorate']||function(_0x5c9376,_0x15e5f3,_0x62b89f,_0x1e8c05){const _0x30ddf5=a128_0x5ade;var _0x146a8d=arguments[_0x30ddf5(0xaa)],_0x4eefb8=_0x146a8d<0x3?_0x15e5f3:_0x1e8c05===null?_0x1e8c05=Object[_0x30ddf5(0xcd)](_0x15e5f3,_0x62b89f):_0x1e8c05,_0x1b4d55;if(typeof Reflect==='object'&&typeof Reflect[_0x30ddf5(0xfd)]===_0x30ddf5(0xc8))_0x4eefb8=Reflect[_0x30ddf5(0xfd)](_0x5c9376,_0x15e5f3,_0x62b89f,_0x1e8c05);else{for(var _0x1ab1bf=_0x5c9376[_0x30ddf5(0xaa)]-0x1;_0x1ab1bf>=0x0;_0x1ab1bf--)if(_0x1b4d55=_0x5c9376[_0x1ab1bf])_0x4eefb8=(_0x146a8d<0x3?_0x1b4d55(_0x4eefb8):_0x146a8d>0x3?_0x1b4d55(_0x15e5f3,_0x62b89f,_0x4eefb8):_0x1b4d55(_0x15e5f3,_0x62b89f))||_0x4eefb8;}return _0x146a8d>0x3&&_0x4eefb8&&Object[_0x30ddf5(0xf6)](_0x15e5f3,_0x62b89f,_0x4eefb8),_0x4eefb8;},__metadata=this&&this['__metadata']||function(_0x40ea76,_0x97b0fe){const _0x258e91=a128_0x5ade;if(typeof Reflect===_0x258e91(0xc0)&&typeof Reflect[_0x258e91(0xa2)]===_0x258e91(0xc8))return Reflect[_0x258e91(0xa2)](_0x40ea76,_0x97b0fe);},SyncService_1;Object[a128_0x1ca796(0xf6)](exports,a128_0x1ca796(0xe7),{'value':!![]}),exports[a128_0x1ca796(0x100)]=void 0x0;const constants_1=require(a128_0x1ca796(0xad)),core_1=require('../../../../core'),too_many_requests_error_1=require(a128_0x1ca796(0xd5)),flosum_repository_sync_dto_1=require(a128_0x1ca796(0xeb)),salesforce_error_1=require(a128_0x1ca796(0x11a)),salesforce_sync_service_1=require(a128_0x1ca796(0xe1)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),utils_1=require('../../../shared/utils'),typedi_1=require('typedi'),hooks_utils_1=require('../../providers/web-hooks/hooks.utils'),git_branch_not_found_error_1=require(a128_0x1ca796(0xee)),flosum_sync_job_1=require(a128_0x1ca796(0x10d)),git_sync_job_1=require(a128_0x1ca796(0xd9)),providers_tokens_1=require('../../providers/providers.tokens'),bad_request_error_1=require(a128_0x1ca796(0xdc));let SyncService=SyncService_1=class SyncService{constructor(_0x223253,_0x3606ce){const _0x93b1bf=a128_0x1ca796;this[_0x93b1bf(0xbf)]=_0x223253,this['salesforceSync']=_0x3606ce,this[_0x93b1bf(0xe5)]=new core_1[(_0x93b1bf(0x105))](SyncService_1[_0x93b1bf(0xf5)]),this[_0x93b1bf(0xa1)]={},this[_0x93b1bf(0x103)]=[];}async[a128_0x1ca796(0xbb)](_0x296264,_0x481b2a){const _0x411dd6=a128_0x1ca796;if(_0x481b2a instanceof git_branch_not_found_error_1['GitBranchNotFoundError']){await this[_0x411dd6(0xff)]['setStatus'](_0x296264,_0x411dd6(0xa8));return;}if(_0x481b2a instanceof too_many_requests_error_1[_0x411dd6(0xb7)]){await this[_0x411dd6(0xff)][_0x411dd6(0xb4)](_0x296264,'Waiting');throw _0x481b2a;}try{await this[_0x411dd6(0xb9)]['error'](this[_0x411dd6(0xf1)]+_0x411dd6(0xbc)+_0x296264['repositoryName']+_0x411dd6(0xc9)+_0x296264['branchName']+_0x411dd6(0xd6)+_0x481b2a+'.')[_0x411dd6(0xae)](),await this[_0x411dd6(0xff)][_0x411dd6(0xd2)](_0x296264,{}),await this[_0x411dd6(0xff)][_0x411dd6(0xb4)](_0x296264,'Error');}catch(_0x34ee51){if(_0x34ee51 instanceof salesforce_error_1[_0x411dd6(0xcf)])throw _0x34ee51;}}async[a128_0x1ca796(0xa9)](_0x2847b1){const _0x232409=a128_0x1ca796;if(_0x2847b1[_0x232409(0x10f)]){const _0x299972=_0x2847b1[_0x232409(0xf2)][_0x232409(0x10a)](),_0x87fb5d=this[_0x232409(0xa1)][_0x299972];if(!_0x87fb5d)this['repositoriesIntersections'][_0x299972]=_0x2847b1['repositoryName'];else{if(_0x87fb5d&&_0x87fb5d!==_0x2847b1[_0x232409(0xf2)])return await this[_0x232409(0xbb)](_0x2847b1,new Error(_0x232409(0xe4)+_0x2847b1['repositoryName']+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x299972+_0x232409(0xc7)+_0x87fb5d+'\x27')),!![];}}return![];}async[a128_0x1ca796(0x9e)](_0x3ecfa8){const _0x148a50=a128_0x1ca796;if(!constants_1[_0x148a50(0x112)]['test'](_0x3ecfa8[_0x148a50(0xf2)]))return await this[_0x148a50(0xbb)](_0x3ecfa8,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x3ecfa8[_0x148a50(0xf2)]+_0x148a50(0xa7))),![];if(!constants_1[_0x148a50(0xf3)][_0x148a50(0x110)](_0x3ecfa8[_0x148a50(0xca)]))return await this['handleRecordSyncError'](_0x3ecfa8,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x3ecfa8[_0x148a50(0xca)]+_0x148a50(0xe0)+_0x3ecfa8[_0x148a50(0xf2)]+_0x148a50(0xec))),![];return!![];}async[a128_0x1ca796(0xb2)](_0x15937f,_0x13a7dc){const _0x46f2f4=a128_0x1ca796;let _0x5a6487=this[_0x46f2f4(0x103)][_0x46f2f4(0xde)](_0x4d0778=>_0x15937f[_0x46f2f4(0xf2)]===_0x4d0778[_0x46f2f4(0xf5)]);!_0x5a6487&&(this[_0x46f2f4(0xb9)][_0x46f2f4(0xf0)](this['prefix']+_0x46f2f4(0xb8)+_0x15937f['repositoryName']+_0x46f2f4(0x109)),_0x5a6487=await this[_0x46f2f4(0xaf)][_0x46f2f4(0x9f)]({'name':_0x15937f[_0x46f2f4(0xf2)],'autoInit':!![],'defaultBranch':_0x15937f[_0x46f2f4(0xca)],'private':!![],'createHook':typedi_1[_0x46f2f4(0xf4)][_0x46f2f4(0xa0)](providers_tokens_1[_0x46f2f4(0x10c)][_0x46f2f4(0xd8)])[_0x46f2f4(0xa6)]}));if(this[_0x46f2f4(0xd8)][_0x46f2f4(0xa6)]){const _0x4db749=await _0x5a6487[_0x46f2f4(0xa4)]['getAll']();!_0x4db749[_0x46f2f4(0xde)](_0xcaf8d8=>_0xcaf8d8[_0x46f2f4(0x101)]===hooks_utils_1[_0x46f2f4(0xfe)]['getHookLinkFor'](this[_0x46f2f4(0xd8)][_0x46f2f4(0xd3)],this[_0x46f2f4(0xd8)][_0x46f2f4(0xb3)],_0x13a7dc))&&(this[_0x46f2f4(0xb9)][_0x46f2f4(0xf0)](this['prefix']+_0x46f2f4(0xb8)+_0x15937f['repositoryName']+_0x46f2f4(0xac)),await _0x5a6487['hooks'][_0x46f2f4(0x9f)](hooks_utils_1[_0x46f2f4(0xfe)][_0x46f2f4(0xcb)](this[_0x46f2f4(0xd8)][_0x46f2f4(0xd3)],_0x5a6487[_0x46f2f4(0xa4)],this[_0x46f2f4(0xd8)][_0x46f2f4(0xb3)],_0x13a7dc)));}return this[_0x46f2f4(0x103)][_0x46f2f4(0xa5)](_0x5a6487),_0x5a6487;}async[a128_0x1ca796(0xbd)](){const _0x2acef2=a128_0x1ca796;this['gitApiService']=typedi_1[_0x2acef2(0xf4)]['get'](providers_tokens_1[_0x2acef2(0x10c)]['gitApiService']),this[_0x2acef2(0xaf)]=typedi_1['Container'][_0x2acef2(0xa0)](providers_tokens_1[_0x2acef2(0x10c)][_0x2acef2(0xea)]),this[_0x2acef2(0xd8)]=typedi_1['Container'][_0x2acef2(0xa0)](providers_tokens_1['Tokens'][_0x2acef2(0xd8)]),this[_0x2acef2(0xb9)]=typedi_1[_0x2acef2(0xf4)]['get'](providers_tokens_1[_0x2acef2(0x10c)]['logger']),this[_0x2acef2(0xf1)]='['+SyncService_1['name']+_0x2acef2(0x114)+this['config']['gitProvider']['toUpperCase']()+']',this[_0x2acef2(0xbf)][_0x2acef2(0xa3)](this[_0x2acef2(0xb9)][_0x2acef2(0xba)]());try{this[_0x2acef2(0xb9)][_0x2acef2(0xf0)](this[_0x2acef2(0xf1)]+_0x2acef2(0xfc)),await this[_0x2acef2(0xb9)][_0x2acef2(0xf0)](this[_0x2acef2(0xf1)]+_0x2acef2(0xab))['send']();const _0x8e6263=await this[_0x2acef2(0xff)][_0x2acef2(0xfa)](typedi_1['Container'][_0x2acef2(0xa0)](providers_tokens_1[_0x2acef2(0x10c)][_0x2acef2(0x118)]));if(!_0x8e6263[_0x2acef2(0xaa)])throw new bad_request_error_1['BadRequestError'](this[_0x2acef2(0xf1)]+_0x2acef2(0xf8));await this[_0x2acef2(0xb9)][_0x2acef2(0xf0)](this[_0x2acef2(0xf1)]+_0x2acef2(0xb1))[_0x2acef2(0xae)]();const _0x1edbd5=await this[_0x2acef2(0xff)][_0x2acef2(0x104)](_0x8e6263[_0x2acef2(0x116)](_0x2fb3d7=>'\x27'+_0x2fb3d7[_0x2acef2(0x10f)]+'\x27')[_0x2acef2(0x119)](','));await this[_0x2acef2(0xb9)][_0x2acef2(0xf0)](this['prefix']+_0x2acef2(0xc1))[_0x2acef2(0xae)](),this[_0x2acef2(0x103)]=await this[_0x2acef2(0xaf)][_0x2acef2(0x102)]();const _0x34786b=[..._0x8e6263,..._0x1edbd5];this['sfLogger'][_0x2acef2(0xf0)](this['prefix']+_0x2acef2(0xb6)+_0x34786b['length']+_0x2acef2(0xd4));for(const _0x3bd7f8 of _0x34786b){this[_0x2acef2(0xe5)][_0x2acef2(0xf0)](_0x2acef2(0xc3)+_0x3bd7f8['repositoryName']+'['+_0x3bd7f8[_0x2acef2(0x10f)]+_0x2acef2(0xf9)+_0x3bd7f8[_0x2acef2(0xca)]+'['+_0x3bd7f8[_0x2acef2(0x106)]+_0x2acef2(0xd7)),this[_0x2acef2(0xb9)]['log'](this[_0x2acef2(0xf1)]+'\x20Syncing\x20repository:\x20\x22'+_0x3bd7f8[_0x2acef2(0xf2)]+_0x2acef2(0xce)+_0x3bd7f8[_0x2acef2(0xca)]+'\x22.'),this[_0x2acef2(0xb9)][_0x2acef2(0xf0)](this[_0x2acef2(0xf1)]+_0x2acef2(0x117));const _0x2c1636=await this[_0x2acef2(0x9e)](_0x3bd7f8);if(!_0x2c1636)continue;this['sfLogger']['log'](this[_0x2acef2(0xf1)]+_0x2acef2(0x111));const _0x524a02=await this[_0x2acef2(0xa9)](_0x3bd7f8);if(_0x524a02)continue;await this['sfLogger'][_0x2acef2(0xae)]();let _0x123524;try{await this[_0x2acef2(0xb9)]['log'](this[_0x2acef2(0xf1)]+_0x2acef2(0xb0))[_0x2acef2(0xae)](),_0x123524=await this[_0x2acef2(0xb2)](_0x3bd7f8,typedi_1[_0x2acef2(0xf4)][_0x2acef2(0xa0)](providers_tokens_1[_0x2acef2(0x10c)][_0x2acef2(0x118)]));}catch(_0x693139){await this['handleRecordSyncError'](_0x3bd7f8,_0x693139 instanceof too_many_requests_error_1[_0x2acef2(0xb7)]?_0x693139:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x693139));continue;}await this[_0x2acef2(0xb9)][_0x2acef2(0xf0)](this[_0x2acef2(0xf1)]+_0x2acef2(0xe6))[_0x2acef2(0xae)]();if(_0x3bd7f8[_0x2acef2(0xfb)]===flosum_repository_sync_dto_1[_0x2acef2(0x10b)][_0x2acef2(0xc4)]){const _0x56c722=typedi_1[_0x2acef2(0xf4)][_0x2acef2(0xa0)](flosum_sync_job_1[_0x2acef2(0xb5)]);await _0x56c722[_0x2acef2(0xbd)]({'repository':_0x123524,'convertToSFDX':this[_0x2acef2(0xd8)][_0x2acef2(0xda)],'syncRecord':_0x3bd7f8,'provider':this[_0x2acef2(0xd8)][_0x2acef2(0xd3)]})[_0x2acef2(0xbe)](_0x204e70=>this[_0x2acef2(0xbb)](_0x3bd7f8,_0x204e70));}else{const _0xc7f695=typedi_1[_0x2acef2(0xf4)][_0x2acef2(0xa0)](git_sync_job_1['GitSyncJob']);await _0xc7f695[_0x2acef2(0xbd)]({'repository':_0x123524,'branch':_0x3bd7f8['branchName'],'provider':this[_0x2acef2(0xd8)][_0x2acef2(0xd3)],'repositoryGit':_0x123524[_0x2acef2(0xc2)],'syncRecord':_0x3bd7f8})[_0x2acef2(0xbe)](_0x5ebd71=>this[_0x2acef2(0xbb)](_0x3bd7f8,_0x5ebd71));}}}catch(_0x35adb6){this[_0x2acef2(0xe5)][_0x2acef2(0xdd)](_0x35adb6);_0x35adb6 instanceof too_many_requests_error_1[_0x2acef2(0xb7)]?(await this[_0x2acef2(0xb9)][_0x2acef2(0xf0)](this['prefix']+_0x2acef2(0xdf))[_0x2acef2(0xae)](),await(0x0,utils_1[_0x2acef2(0x10e)])(0x3c*0x3c*0x3e8),this['run']()):await this[_0x2acef2(0xb9)]['error'](this[_0x2acef2(0xf1)]+_0x2acef2(0xcc)+_0x35adb6)[_0x2acef2(0xae)]();return;}await this['sfLogger'][_0x2acef2(0xf0)](this[_0x2acef2(0xf1)]+'\x20Sync\x20job\x20done.')[_0x2acef2(0xae)](),await this[_0x2acef2(0xff)][_0x2acef2(0x115)](typedi_1[_0x2acef2(0xf4)][_0x2acef2(0xa0)](providers_tokens_1[_0x2acef2(0x10c)][_0x2acef2(0x118)]))[_0x2acef2(0xbe)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a128_0x1ca796(0xc6),[salesforce_service_1[a128_0x1ca796(0xdb)],salesforce_sync_service_1[a128_0x1ca796(0xed)]])],SyncService),exports[a128_0x1ca796(0x100)]=SyncService;