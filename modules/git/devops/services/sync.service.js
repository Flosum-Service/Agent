const a111_0x4ecb98=a111_0x45cc;(function(_0x543319,_0x115b17){const _0x4adf24=a111_0x45cc,_0x56e732=_0x543319();while(!![]){try{const _0x515cf0=parseInt(_0x4adf24(0x196))/0x1+-parseInt(_0x4adf24(0x159))/0x2*(-parseInt(_0x4adf24(0x177))/0x3)+-parseInt(_0x4adf24(0x193))/0x4*(parseInt(_0x4adf24(0x1a6))/0x5)+-parseInt(_0x4adf24(0x161))/0x6+parseInt(_0x4adf24(0x19a))/0x7+parseInt(_0x4adf24(0x1b7))/0x8+-parseInt(_0x4adf24(0x1a2))/0x9;if(_0x515cf0===_0x115b17)break;else _0x56e732['push'](_0x56e732['shift']());}catch(_0x17cd8a){_0x56e732['push'](_0x56e732['shift']());}}}(a111_0x41bd,0x24e12));const a111_0x426bf2=(function(){let _0x74d83f=!![];return function(_0x3862d1,_0x1dc7b0){const _0x2f3958=_0x74d83f?function(){const _0x43da51=a111_0x45cc;if(_0x1dc7b0){const _0x15e79e=_0x1dc7b0[_0x43da51(0x183)](_0x3862d1,arguments);return _0x1dc7b0=null,_0x15e79e;}}:function(){};return _0x74d83f=![],_0x2f3958;};}()),a111_0x3d1ca5=a111_0x426bf2(this,function(){const _0x40ccb2=a111_0x45cc;return a111_0x3d1ca5[_0x40ccb2(0x179)]()[_0x40ccb2(0x185)](_0x40ccb2(0x172))[_0x40ccb2(0x179)]()[_0x40ccb2(0x1ad)](a111_0x3d1ca5)[_0x40ccb2(0x185)]('(((.+)+)+)+$');});a111_0x3d1ca5();'use strict';function a111_0x45cc(_0x1df15d,_0x3f5ee4){const _0x2af649=a111_0x41bd();return a111_0x45cc=function(_0x3d1ca5,_0x426bf2){_0x3d1ca5=_0x3d1ca5-0x146;let _0x41bd62=_0x2af649[_0x3d1ca5];return _0x41bd62;},a111_0x45cc(_0x1df15d,_0x3f5ee4);}var __decorate=this&&this['__decorate']||function(_0x5565a7,_0x40783c,_0x2dd25b,_0x40baeb){const _0xf3e24b=a111_0x45cc;var _0x4db3ec=arguments[_0xf3e24b(0x152)],_0x2e7562=_0x4db3ec<0x3?_0x40783c:_0x40baeb===null?_0x40baeb=Object['getOwnPropertyDescriptor'](_0x40783c,_0x2dd25b):_0x40baeb,_0x35e71e;if(typeof Reflect===_0xf3e24b(0x168)&&typeof Reflect[_0xf3e24b(0x173)]===_0xf3e24b(0x1a7))_0x2e7562=Reflect[_0xf3e24b(0x173)](_0x5565a7,_0x40783c,_0x2dd25b,_0x40baeb);else{for(var _0x20cdae=_0x5565a7['length']-0x1;_0x20cdae>=0x0;_0x20cdae--)if(_0x35e71e=_0x5565a7[_0x20cdae])_0x2e7562=(_0x4db3ec<0x3?_0x35e71e(_0x2e7562):_0x4db3ec>0x3?_0x35e71e(_0x40783c,_0x2dd25b,_0x2e7562):_0x35e71e(_0x40783c,_0x2dd25b))||_0x2e7562;}return _0x4db3ec>0x3&&_0x2e7562&&Object[_0xf3e24b(0x191)](_0x40783c,_0x2dd25b,_0x2e7562),_0x2e7562;},__metadata=this&&this[a111_0x4ecb98(0x1c3)]||function(_0x41293,_0x3e7880){const _0x584ef8=a111_0x4ecb98;if(typeof Reflect===_0x584ef8(0x168)&&typeof Reflect['metadata']===_0x584ef8(0x1a7))return Reflect[_0x584ef8(0x1b8)](_0x41293,_0x3e7880);},SyncService_1;function a111_0x41bd(){const _0x201462=['repositoriesIntersections','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','SalesforceError','Container','apply','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','search','../../salesforce/errors/salesforce.error','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','repoList','checkValidNaming','getRepositoryRecords','gitProvider','../../../../core','\x20No\x20repositories\x20to\x20sync.','name','salesforceService','map','defineProperty','Waiting','3536ZgwNKa','test','Tokens','11615uItAME','catch','Error','toUpperCase','983857LjdbLZ','getAll',']\x20repository\x20','design:paramtypes','HooksUtils','../../salesforce/services/salesforce-sync.service','Unable\x20to\x20synchronize\x20branch\x20\x27','setStatus','3153258oatkub','\x20branches.','\x20Sync\x20job\x20done.','repositoryName','355YbbENr','function','toLowerCase','\x20Start\x20sync\x20job.','../../salesforce/dto/flosum-repository-sync.dto','../../providers/providers.tokens','salesforceSync','constructor','gitApiService','isBidirectionalSynchronization','TooManyRequests','join','\x20Repository\x20\x22','getLoggerId','branchId','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','\x20Getting\x20repository\x20records.','2130464oYYzvc','metadata','logger','branchName','repositoryId','push','FlosumToGit','error','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','sleep','handleRecordSyncError','setLoggerId','__metadata','../jobs/git-sync.job','getOrCreateRepo','connectionId','typedi','../../../shared/utils','direction','config',']\x20[','isConvertToSfdx','hooks','BRANCH_NAME_REGEXP','\x22\x20branch:\x20\x22','../../../../constants','length','\x20Checking\x20valid\x20name.','\x20Have\x20to\x20synchronize\x20','disableSync','find','__esModule','\x20Getting\x20Flosum\x20repository','400404incMjL','REPOSITORY_NAME_REGEXP','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','send','prefix','run','\x20Getting\x20branch\x20records.',']\x20due\x20error\x20-\x20','326952TtcnuQ','SalesforceSyncService','repoService','gitRepoService','BadRequestError','isIntersects','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','object','../jobs/flosum-sync.job','../../../../core/errors/too-many-requests.error','../../providers/web-hooks/hooks.utils','log','Service','get','GitSyncJob','FlosumSyncJob','\x27\x20-\x20\x27','(((.+)+)+)+$','decorate','gitUrl','Unable\x20to\x20synchronize\x20repository\x20\x27','getHookLinkFor','3pcrPEb','../errors/git-branch-not-found.error','toString',']\x20branch.','\x27\x20[','applicationUrl','sfLogger','create'];a111_0x41bd=function(){return _0x201462;};return a111_0x41bd();}Object[a111_0x4ecb98(0x191)](exports,a111_0x4ecb98(0x157),{'value':!![]}),exports['SyncService']=void 0x0;const constants_1=require(a111_0x4ecb98(0x151)),core_1=require(a111_0x4ecb98(0x18c)),too_many_requests_error_1=require(a111_0x4ecb98(0x16a)),flosum_repository_sync_dto_1=require(a111_0x4ecb98(0x1aa)),salesforce_error_1=require(a111_0x4ecb98(0x186)),salesforce_sync_service_1=require(a111_0x4ecb98(0x19f)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),utils_1=require(a111_0x4ecb98(0x149)),typedi_1=require(a111_0x4ecb98(0x148)),hooks_utils_1=require(a111_0x4ecb98(0x16b)),git_branch_not_found_error_1=require(a111_0x4ecb98(0x178)),flosum_sync_job_1=require(a111_0x4ecb98(0x169)),git_sync_job_1=require(a111_0x4ecb98(0x1c4)),providers_tokens_1=require(a111_0x4ecb98(0x1ab)),bad_request_error_1=require('../../../../core/errors/bad-request.error');let SyncService=SyncService_1=class SyncService{constructor(_0x5ac6bf,_0x4f1b74){const _0x22f176=a111_0x4ecb98;this[_0x22f176(0x18f)]=_0x5ac6bf,this[_0x22f176(0x1ac)]=_0x4f1b74,this[_0x22f176(0x1b9)]=new core_1['Logger'](SyncService_1[_0x22f176(0x18e)]),this[_0x22f176(0x17f)]={},this[_0x22f176(0x188)]=[];}async['handleRecordSyncError'](_0x590ad1,_0x2c1108){const _0x3c83fe=a111_0x4ecb98;if(_0x2c1108 instanceof git_branch_not_found_error_1['GitBranchNotFoundError']){await this[_0x3c83fe(0x1ac)][_0x3c83fe(0x1a1)](_0x590ad1,'Not\x20Synchronized');return;}if(_0x2c1108 instanceof too_many_requests_error_1[_0x3c83fe(0x1b0)]){await this['salesforceSync'][_0x3c83fe(0x1a1)](_0x590ad1,_0x3c83fe(0x192));throw _0x2c1108;}try{await this[_0x3c83fe(0x17d)][_0x3c83fe(0x1be)](this[_0x3c83fe(0x15d)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x590ad1[_0x3c83fe(0x1a5)]+_0x3c83fe(0x17b)+_0x590ad1['branchName']+_0x3c83fe(0x160)+_0x2c1108+'.')['send'](),await this['salesforceSync']['updateRemoteState'](_0x590ad1,{}),await this[_0x3c83fe(0x1ac)][_0x3c83fe(0x1a1)](_0x590ad1,_0x3c83fe(0x198));}catch(_0x434b8b){if(_0x434b8b instanceof salesforce_error_1[_0x3c83fe(0x181)])throw _0x434b8b;}}async[a111_0x4ecb98(0x166)](_0x1c4a2f){const _0x352233=a111_0x4ecb98;if(_0x1c4a2f[_0x352233(0x1bb)]){const _0xd926e6=_0x1c4a2f[_0x352233(0x1a5)][_0x352233(0x1a8)](),_0x46a7ba=this['repositoriesIntersections'][_0xd926e6];if(!_0x46a7ba)this[_0x352233(0x17f)][_0xd926e6]=_0x1c4a2f[_0x352233(0x1a5)];else{if(_0x46a7ba&&_0x46a7ba!==_0x1c4a2f[_0x352233(0x1a5)])return await this['handleRecordSyncError'](_0x1c4a2f,new Error(_0x352233(0x175)+_0x1c4a2f[_0x352233(0x1a5)]+_0x352233(0x1b5)+_0xd926e6+_0x352233(0x171)+_0x46a7ba+'\x27')),!![];}}return![];}async[a111_0x4ecb98(0x189)](_0x87afc7){const _0x48ec94=a111_0x4ecb98;if(!constants_1[_0x48ec94(0x15a)]['test'](_0x87afc7[_0x48ec94(0x1a5)]))return await this[_0x48ec94(0x1c1)](_0x87afc7,new Error(_0x48ec94(0x175)+_0x87afc7['repositoryName']+_0x48ec94(0x1bf))),![];if(!constants_1[_0x48ec94(0x14f)][_0x48ec94(0x194)](_0x87afc7[_0x48ec94(0x1ba)]))return await this[_0x48ec94(0x1c1)](_0x87afc7,new Error(_0x48ec94(0x1a0)+_0x87afc7[_0x48ec94(0x1ba)]+'\x27\x20in\x20repository\x20\x27'+_0x87afc7[_0x48ec94(0x1a5)]+_0x48ec94(0x187))),![];return!![];}async[a111_0x4ecb98(0x146)](_0x5da2e6,_0x2f7832){const _0x298f98=a111_0x4ecb98;let _0x3451e6=this[_0x298f98(0x188)][_0x298f98(0x156)](_0x5de31a=>_0x5da2e6[_0x298f98(0x1a5)]===_0x5de31a[_0x298f98(0x18e)]);!_0x3451e6&&(this['sfLogger'][_0x298f98(0x16c)](this[_0x298f98(0x15d)]+_0x298f98(0x1b2)+_0x5da2e6[_0x298f98(0x1a5)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x3451e6=await this[_0x298f98(0x163)][_0x298f98(0x17e)]({'name':_0x5da2e6['repositoryName'],'autoInit':!![],'defaultBranch':_0x5da2e6[_0x298f98(0x1ba)],'private':!![],'createHook':typedi_1[_0x298f98(0x182)][_0x298f98(0x16e)](providers_tokens_1[_0x298f98(0x195)][_0x298f98(0x14b)])[_0x298f98(0x1af)]}));if(this['config']['isBidirectionalSynchronization']){const _0x3ab268=await _0x3451e6[_0x298f98(0x14e)][_0x298f98(0x19b)]();!_0x3ab268[_0x298f98(0x156)](_0x183b1c=>_0x183b1c['url']===hooks_utils_1[_0x298f98(0x19e)][_0x298f98(0x176)](this[_0x298f98(0x14b)]['gitProvider'],this['config'][_0x298f98(0x17c)],_0x2f7832))&&(this[_0x298f98(0x17d)]['log'](this[_0x298f98(0x15d)]+'\x20Repository\x20\x22'+_0x5da2e6[_0x298f98(0x1a5)]+_0x298f98(0x15b)),await _0x3451e6[_0x298f98(0x14e)][_0x298f98(0x17e)](hooks_utils_1[_0x298f98(0x19e)]['createHookPayload'](this[_0x298f98(0x14b)][_0x298f98(0x18b)],_0x3451e6[_0x298f98(0x14e)],this[_0x298f98(0x14b)][_0x298f98(0x17c)],_0x2f7832)));}return this[_0x298f98(0x188)][_0x298f98(0x1bc)](_0x3451e6),_0x3451e6;}async['run'](){const _0x31c023=a111_0x4ecb98;this[_0x31c023(0x1ae)]=typedi_1[_0x31c023(0x182)][_0x31c023(0x16e)](providers_tokens_1[_0x31c023(0x195)][_0x31c023(0x1ae)]),this[_0x31c023(0x163)]=typedi_1[_0x31c023(0x182)]['get'](providers_tokens_1[_0x31c023(0x195)][_0x31c023(0x164)]),this[_0x31c023(0x14b)]=typedi_1[_0x31c023(0x182)]['get'](providers_tokens_1[_0x31c023(0x195)][_0x31c023(0x14b)]),this['sfLogger']=typedi_1[_0x31c023(0x182)][_0x31c023(0x16e)](providers_tokens_1[_0x31c023(0x195)]['logger']),this[_0x31c023(0x15d)]='['+SyncService_1['name']+_0x31c023(0x14c)+this[_0x31c023(0x14b)][_0x31c023(0x18b)][_0x31c023(0x199)]()+']',this[_0x31c023(0x18f)][_0x31c023(0x1c2)](this[_0x31c023(0x17d)][_0x31c023(0x1b3)]());try{this[_0x31c023(0x17d)][_0x31c023(0x16c)](this[_0x31c023(0x15d)]+_0x31c023(0x1a9)),await this[_0x31c023(0x17d)][_0x31c023(0x16c)](this[_0x31c023(0x15d)]+_0x31c023(0x1b6))[_0x31c023(0x15c)]();const _0x559b3e=await this[_0x31c023(0x1ac)][_0x31c023(0x18a)](typedi_1[_0x31c023(0x182)]['get'](providers_tokens_1[_0x31c023(0x195)]['connectionId']));if(!_0x559b3e[_0x31c023(0x152)])throw new bad_request_error_1[(_0x31c023(0x165))](this[_0x31c023(0x15d)]+_0x31c023(0x18d));await this[_0x31c023(0x17d)]['log'](this[_0x31c023(0x15d)]+_0x31c023(0x15f))['send']();const _0x13bfbe=await this[_0x31c023(0x1ac)]['getBranchRecords'](_0x559b3e[_0x31c023(0x190)](_0xb64ce3=>'\x27'+_0xb64ce3['repositoryId']+'\x27')[_0x31c023(0x1b1)](','));await this['sfLogger'][_0x31c023(0x16c)](this[_0x31c023(0x15d)]+'\x20Getting\x20repositories\x20from\x20git\x20service.')['send'](),this[_0x31c023(0x188)]=await this[_0x31c023(0x163)][_0x31c023(0x19b)]();const _0xb7a24=[..._0x559b3e,..._0x13bfbe];this[_0x31c023(0x17d)][_0x31c023(0x16c)](this[_0x31c023(0x15d)]+_0x31c023(0x154)+_0xb7a24[_0x31c023(0x152)]+_0x31c023(0x1a3));for(const _0x2dcb0e of _0xb7a24){this[_0x31c023(0x1b9)]['log']('Syncing\x20'+_0x2dcb0e['repositoryName']+'['+_0x2dcb0e[_0x31c023(0x1bb)]+_0x31c023(0x19c)+_0x2dcb0e[_0x31c023(0x1ba)]+'['+_0x2dcb0e[_0x31c023(0x1b4)]+_0x31c023(0x17a)),this['sfLogger'][_0x31c023(0x16c)](this['prefix']+'\x20Syncing\x20repository:\x20\x22'+_0x2dcb0e[_0x31c023(0x1a5)]+_0x31c023(0x150)+_0x2dcb0e[_0x31c023(0x1ba)]+'\x22.'),this[_0x31c023(0x17d)][_0x31c023(0x16c)](this[_0x31c023(0x15d)]+_0x31c023(0x153));const _0x14f684=await this[_0x31c023(0x189)](_0x2dcb0e);if(!_0x14f684)continue;this[_0x31c023(0x17d)][_0x31c023(0x16c)](this[_0x31c023(0x15d)]+'\x20Checking\x20intersects.');const _0x54e2af=await this[_0x31c023(0x166)](_0x2dcb0e);if(_0x54e2af)continue;await this[_0x31c023(0x17d)][_0x31c023(0x15c)]();let _0x406d1e;try{await this[_0x31c023(0x17d)]['log'](this[_0x31c023(0x15d)]+_0x31c023(0x158))[_0x31c023(0x15c)](),_0x406d1e=await this[_0x31c023(0x146)](_0x2dcb0e,typedi_1[_0x31c023(0x182)][_0x31c023(0x16e)](providers_tokens_1[_0x31c023(0x195)][_0x31c023(0x147)]));}catch(_0x14edda){await this[_0x31c023(0x1c1)](_0x2dcb0e,_0x14edda instanceof too_many_requests_error_1['TooManyRequests']?_0x14edda:new Error(_0x31c023(0x167)+_0x14edda));continue;}await this[_0x31c023(0x17d)][_0x31c023(0x16c)](this[_0x31c023(0x15d)]+'\x20Completed\x20prepare\x20to\x20syncing.')[_0x31c023(0x15c)]();if(_0x2dcb0e[_0x31c023(0x14a)]===flosum_repository_sync_dto_1['SyncDirection'][_0x31c023(0x1bd)]){const _0x4f5c03=typedi_1[_0x31c023(0x182)]['get'](flosum_sync_job_1[_0x31c023(0x170)]);await _0x4f5c03['run']({'repository':_0x406d1e,'convertToSFDX':this[_0x31c023(0x14b)][_0x31c023(0x14d)],'syncRecord':_0x2dcb0e,'provider':this[_0x31c023(0x14b)][_0x31c023(0x18b)]})[_0x31c023(0x197)](_0x50c472=>this[_0x31c023(0x1c1)](_0x2dcb0e,_0x50c472));}else{const _0x297169=typedi_1['Container'][_0x31c023(0x16e)](git_sync_job_1[_0x31c023(0x16f)]);await _0x297169[_0x31c023(0x15e)]({'repository':_0x406d1e,'branch':_0x2dcb0e[_0x31c023(0x1ba)],'provider':this[_0x31c023(0x14b)]['gitProvider'],'repositoryGit':_0x406d1e[_0x31c023(0x174)],'syncRecord':_0x2dcb0e})[_0x31c023(0x197)](_0x2b6c15=>this[_0x31c023(0x1c1)](_0x2dcb0e,_0x2b6c15));}}}catch(_0x2e5eef){this[_0x31c023(0x1b9)][_0x31c023(0x1be)](_0x2e5eef);_0x2e5eef instanceof too_many_requests_error_1[_0x31c023(0x1b0)]?(await this[_0x31c023(0x17d)][_0x31c023(0x16c)](this[_0x31c023(0x15d)]+_0x31c023(0x180))[_0x31c023(0x15c)](),await(0x0,utils_1[_0x31c023(0x1c0)])(0x3c*0x3c*0x3e8),this[_0x31c023(0x15e)]()):await this['sfLogger'][_0x31c023(0x1be)](this['prefix']+_0x31c023(0x184)+_0x2e5eef)['send']();return;}await this[_0x31c023(0x17d)][_0x31c023(0x16c)](this[_0x31c023(0x15d)]+_0x31c023(0x1a4))[_0x31c023(0x15c)](),await this[_0x31c023(0x1ac)][_0x31c023(0x155)](typedi_1[_0x31c023(0x182)]['get'](providers_tokens_1[_0x31c023(0x195)][_0x31c023(0x147)]))['catch'](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x4ecb98(0x16d)])({'transient':!![]}),__metadata(a111_0x4ecb98(0x19d),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a111_0x4ecb98(0x162)]])],SyncService),exports['SyncService']=SyncService;