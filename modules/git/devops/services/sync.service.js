const a80_0x54b210=a80_0x5a2e;function a80_0x5a2e(_0xc89305,_0xf18548){const _0x7cf525=a80_0x4854();return a80_0x5a2e=function(_0x37b408,_0x224add){_0x37b408=_0x37b408-0x158;let _0x485473=_0x7cf525[_0x37b408];return _0x485473;},a80_0x5a2e(_0xc89305,_0xf18548);}(function(_0x475adb,_0x2af736){const _0x494b03=a80_0x5a2e,_0x4c2cd5=_0x475adb();while(!![]){try{const _0x7fa604=parseInt(_0x494b03(0x1ab))/0x1*(-parseInt(_0x494b03(0x1bd))/0x2)+parseInt(_0x494b03(0x182))/0x3+-parseInt(_0x494b03(0x1c4))/0x4+-parseInt(_0x494b03(0x192))/0x5*(parseInt(_0x494b03(0x16b))/0x6)+-parseInt(_0x494b03(0x174))/0x7*(-parseInt(_0x494b03(0x160))/0x8)+parseInt(_0x494b03(0x199))/0x9*(-parseInt(_0x494b03(0x16d))/0xa)+parseInt(_0x494b03(0x17c))/0xb;if(_0x7fa604===_0x2af736)break;else _0x4c2cd5['push'](_0x4c2cd5['shift']());}catch(_0x329cd3){_0x4c2cd5['push'](_0x4c2cd5['shift']());}}}(a80_0x4854,0x1f055));const a80_0x224add=(function(){let _0x1b86bb=!![];return function(_0x38c996,_0x3f1f7e){const _0x505d9e=_0x1b86bb?function(){if(_0x3f1f7e){const _0x167794=_0x3f1f7e['apply'](_0x38c996,arguments);return _0x3f1f7e=null,_0x167794;}}:function(){};return _0x1b86bb=![],_0x505d9e;};}()),a80_0x37b408=a80_0x224add(this,function(){const _0x24d4d5=a80_0x5a2e;return a80_0x37b408[_0x24d4d5(0x15e)]()[_0x24d4d5(0x18a)](_0x24d4d5(0x1cd))[_0x24d4d5(0x15e)]()[_0x24d4d5(0x1c7)](a80_0x37b408)[_0x24d4d5(0x18a)]('(((.+)+)+)+$');});function a80_0x4854(){const _0x37d915=['gitUrl','GitBranchNotFoundError','Error','typedi','\x20branches.','Unable\x20to\x20synchronize\x20branch\x20\x27','join',']\x20[','test','prefix','toString','length','48zqiJZk','setStatus','disableSync','sleep','../../providers/web-hooks/hooks.utils','decorate','\x27\x20in\x20repository\x20\x27','__esModule','__metadata','\x20Completed\x20prepare\x20to\x20syncing.','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','6btcgNs','Waiting','67190lxrEJQ','TooManyRequests','url','gitProvider','config','gitRepoService','../jobs/flosum-sync.job','19670PpsgkT','repositoryId','../../../shared/utils','create','\x20No\x20repositories\x20to\x20sync.',']\x20due\x20error\x20-\x20','Syncing\x20','Unable\x20to\x20synchronize\x20repository\x20\x27','3696836bspODS','BadRequestError','\x20Sync\x20job\x20done.','repoService','gitApiService','direction','433551VDrzyL','Service','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','log','\x20Start\x20sync\x20job.','../../../../constants','SalesforceService','handleRecordSyncError','search','getOrCreateRepo','\x27\x20[','design:paramtypes','SyncDirection','connectionId','applicationUrl','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','865645uPSawH','name','\x20Getting\x20branch\x20records.','setLoggerId','repositoriesIntersections','\x20Checking\x20valid\x20name.','hooks','117IlQVyB','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','object','find','getLoggerId','GitSyncJob','Container','error','../../../../core','sfLogger','__decorate','metadata','defineProperty','push','get','run','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','Not\x20Synchronized','11629kKfUxv','\x20Have\x20to\x20synchronize\x20','HooksUtils','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','\x20Repository\x20\x22',']\x20branch.','updateRemoteState','SyncService',']\x20repository\x20','\x22\x20branch:\x20\x22','send','isIntersects','../../salesforce/errors/salesforce.error','\x20Getting\x20repository\x20records.','logger','branchName','../../salesforce/services/salesforce.service','Tokens','18pZjIAE','function','repositoryName','\x20Stop\x20sync\x20job\x20for\x20\x27','isBidirectionalSynchronization','getBranchRecords','createHookPayload','21020OaxsYd','repoList','salesforceSync','constructor','getAll','toUpperCase','../errors/git-branch-not-found.error','catch','getHookLinkFor','(((.+)+)+)+$'];a80_0x4854=function(){return _0x37d915;};return a80_0x4854();}a80_0x37b408();'use strict';var __decorate=this&&this[a80_0x54b210(0x1a3)]||function(_0x49ab26,_0x43c294,_0x5be717,_0x23fdf5){const _0xb3bae1=a80_0x54b210;var _0x4f710e=arguments['length'],_0x463efe=_0x4f710e<0x3?_0x43c294:_0x23fdf5===null?_0x23fdf5=Object['getOwnPropertyDescriptor'](_0x43c294,_0x5be717):_0x23fdf5,_0x13b676;if(typeof Reflect===_0xb3bae1(0x19b)&&typeof Reflect[_0xb3bae1(0x165)]==='function')_0x463efe=Reflect[_0xb3bae1(0x165)](_0x49ab26,_0x43c294,_0x5be717,_0x23fdf5);else{for(var _0x3f7f35=_0x49ab26[_0xb3bae1(0x15f)]-0x1;_0x3f7f35>=0x0;_0x3f7f35--)if(_0x13b676=_0x49ab26[_0x3f7f35])_0x463efe=(_0x4f710e<0x3?_0x13b676(_0x463efe):_0x4f710e>0x3?_0x13b676(_0x43c294,_0x5be717,_0x463efe):_0x13b676(_0x43c294,_0x5be717))||_0x463efe;}return _0x4f710e>0x3&&_0x463efe&&Object[_0xb3bae1(0x1a5)](_0x43c294,_0x5be717,_0x463efe),_0x463efe;},__metadata=this&&this[a80_0x54b210(0x168)]||function(_0x24c10e,_0x328a5e){const _0x48e829=a80_0x54b210;if(typeof Reflect===_0x48e829(0x19b)&&typeof Reflect[_0x48e829(0x1a4)]===_0x48e829(0x1be))return Reflect['metadata'](_0x24c10e,_0x328a5e);},SyncService_1;Object[a80_0x54b210(0x1a5)](exports,a80_0x54b210(0x167),{'value':!![]}),exports[a80_0x54b210(0x1b2)]=void 0x0;const constants_1=require(a80_0x54b210(0x187)),core_1=require(a80_0x54b210(0x1a1)),too_many_requests_error_1=require('../../../../core/errors/too-many-requests.error'),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require(a80_0x54b210(0x1b7)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a80_0x54b210(0x1bb)),utils_1=require(a80_0x54b210(0x176)),typedi_1=require(a80_0x54b210(0x1d1)),hooks_utils_1=require(a80_0x54b210(0x164)),git_branch_not_found_error_1=require(a80_0x54b210(0x1ca)),flosum_sync_job_1=require(a80_0x54b210(0x173)),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require('../../providers/providers.tokens'),bad_request_error_1=require('../../../../core/errors/bad-request.error');let SyncService=SyncService_1=class SyncService{constructor(_0x1842e5,_0x2caebd){const _0x42d5cf=a80_0x54b210;this['salesforceService']=_0x1842e5,this[_0x42d5cf(0x1c6)]=_0x2caebd,this[_0x42d5cf(0x1b9)]=new core_1['Logger'](SyncService_1[_0x42d5cf(0x193)]),this['repositoriesIntersections']={},this[_0x42d5cf(0x1c5)]=[];}async[a80_0x54b210(0x189)](_0x53d63e,_0x5149ce){const _0x2683f5=a80_0x54b210;if(_0x5149ce instanceof git_branch_not_found_error_1[_0x2683f5(0x1cf)]){await this[_0x2683f5(0x1c6)][_0x2683f5(0x161)](_0x53d63e,_0x2683f5(0x1aa));return;}if(_0x5149ce instanceof too_many_requests_error_1[_0x2683f5(0x16e)]){await this[_0x2683f5(0x1c6)]['setStatus'](_0x53d63e,_0x2683f5(0x16c));throw _0x5149ce;}try{await this[_0x2683f5(0x1a2)][_0x2683f5(0x1a0)](this[_0x2683f5(0x15d)]+_0x2683f5(0x1c0)+_0x53d63e['repositoryName']+_0x2683f5(0x18c)+_0x53d63e[_0x2683f5(0x1ba)]+_0x2683f5(0x179)+_0x5149ce+'.')['send'](),await this['salesforceSync'][_0x2683f5(0x1b1)](_0x53d63e,{}),await this['salesforceSync'][_0x2683f5(0x161)](_0x53d63e,_0x2683f5(0x1d0));}catch(_0x52bcfa){if(_0x52bcfa instanceof salesforce_error_1['SalesforceError'])throw _0x52bcfa;}}async['isIntersects'](_0x87e83a){const _0x3f78ec=a80_0x54b210;if(_0x87e83a[_0x3f78ec(0x175)]){const _0x52d300=_0x87e83a[_0x3f78ec(0x1bf)]['toLowerCase'](),_0x20dbd0=this[_0x3f78ec(0x196)][_0x52d300];if(!_0x20dbd0)this['repositoriesIntersections'][_0x52d300]=_0x87e83a[_0x3f78ec(0x1bf)];else{if(_0x20dbd0&&_0x20dbd0!==_0x87e83a[_0x3f78ec(0x1bf)])return await this['handleRecordSyncError'](_0x87e83a,new Error(_0x3f78ec(0x17b)+_0x87e83a[_0x3f78ec(0x1bf)]+_0x3f78ec(0x19a)+_0x52d300+'\x27\x20-\x20\x27'+_0x20dbd0+'\x27')),!![];}}return![];}async['checkValidNaming'](_0x503737){const _0x10f219=a80_0x54b210;if(!constants_1['REPOSITORY_NAME_REGEXP'][_0x10f219(0x15c)](_0x503737['repositoryName']))return await this[_0x10f219(0x189)](_0x503737,new Error(_0x10f219(0x17b)+_0x503737[_0x10f219(0x1bf)]+_0x10f219(0x191))),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x10f219(0x15c)](_0x503737[_0x10f219(0x1ba)]))return await this[_0x10f219(0x189)](_0x503737,new Error(_0x10f219(0x159)+_0x503737['branchName']+_0x10f219(0x166)+_0x503737[_0x10f219(0x1bf)]+_0x10f219(0x1a9))),![];return!![];}async[a80_0x54b210(0x18b)](_0x51b3aa,_0x388c04){const _0x35a4dc=a80_0x54b210;let _0x3306c7=this['repoList'][_0x35a4dc(0x19c)](_0x12fded=>_0x51b3aa[_0x35a4dc(0x1bf)]===_0x12fded[_0x35a4dc(0x193)]);!_0x3306c7&&(this['sfLogger'][_0x35a4dc(0x185)](this['prefix']+_0x35a4dc(0x1af)+_0x51b3aa[_0x35a4dc(0x1bf)]+_0x35a4dc(0x16a)),_0x3306c7=await this[_0x35a4dc(0x17f)][_0x35a4dc(0x177)]({'name':_0x51b3aa[_0x35a4dc(0x1bf)],'autoInit':!![],'defaultBranch':_0x51b3aa['branchName'],'private':!![],'createHook':typedi_1[_0x35a4dc(0x19f)][_0x35a4dc(0x1a7)](providers_tokens_1['Tokens'][_0x35a4dc(0x171)])['isBidirectionalSynchronization']}));if(this['config'][_0x35a4dc(0x1c1)]){const _0x2e05f4=await _0x3306c7['hooks'][_0x35a4dc(0x1c8)]();!_0x2e05f4[_0x35a4dc(0x19c)](_0x5387e6=>_0x5387e6[_0x35a4dc(0x16f)]===hooks_utils_1[_0x35a4dc(0x1ad)][_0x35a4dc(0x1cc)](this[_0x35a4dc(0x171)][_0x35a4dc(0x170)],this[_0x35a4dc(0x171)][_0x35a4dc(0x190)],_0x388c04))&&(this[_0x35a4dc(0x1a2)][_0x35a4dc(0x185)](this[_0x35a4dc(0x15d)]+_0x35a4dc(0x1af)+_0x51b3aa[_0x35a4dc(0x1bf)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x3306c7[_0x35a4dc(0x198)][_0x35a4dc(0x177)](hooks_utils_1[_0x35a4dc(0x1ad)][_0x35a4dc(0x1c3)](this[_0x35a4dc(0x171)][_0x35a4dc(0x170)],_0x3306c7['hooks'],this['config'][_0x35a4dc(0x190)],_0x388c04)));}return this[_0x35a4dc(0x1c5)][_0x35a4dc(0x1a6)](_0x3306c7),_0x3306c7;}async['run'](){const _0x53eca9=a80_0x54b210;this[_0x53eca9(0x180)]=typedi_1[_0x53eca9(0x19f)]['get'](providers_tokens_1['Tokens'][_0x53eca9(0x180)]),this['repoService']=typedi_1[_0x53eca9(0x19f)]['get'](providers_tokens_1[_0x53eca9(0x1bc)][_0x53eca9(0x172)]),this[_0x53eca9(0x171)]=typedi_1[_0x53eca9(0x19f)][_0x53eca9(0x1a7)](providers_tokens_1[_0x53eca9(0x1bc)][_0x53eca9(0x171)]),this[_0x53eca9(0x1a2)]=typedi_1[_0x53eca9(0x19f)][_0x53eca9(0x1a7)](providers_tokens_1[_0x53eca9(0x1bc)][_0x53eca9(0x1b9)]),this[_0x53eca9(0x15d)]='['+SyncService_1['name']+_0x53eca9(0x15b)+this[_0x53eca9(0x171)][_0x53eca9(0x170)][_0x53eca9(0x1c9)]()+']',this['salesforceService'][_0x53eca9(0x195)](this[_0x53eca9(0x1a2)][_0x53eca9(0x19d)]());try{this[_0x53eca9(0x1a2)][_0x53eca9(0x185)](this[_0x53eca9(0x15d)]+_0x53eca9(0x186)),await this[_0x53eca9(0x1a2)][_0x53eca9(0x185)](this[_0x53eca9(0x15d)]+_0x53eca9(0x1b8))[_0x53eca9(0x1b5)]();const _0x502ccb=await this[_0x53eca9(0x1c6)]['getRepositoryRecords'](typedi_1[_0x53eca9(0x19f)][_0x53eca9(0x1a7)](providers_tokens_1[_0x53eca9(0x1bc)]['connectionId']));if(!_0x502ccb[_0x53eca9(0x15f)])throw new bad_request_error_1[(_0x53eca9(0x17d))](this[_0x53eca9(0x15d)]+_0x53eca9(0x178));await this[_0x53eca9(0x1a2)][_0x53eca9(0x185)](this[_0x53eca9(0x15d)]+_0x53eca9(0x194))[_0x53eca9(0x1b5)]();const _0x560700=await this[_0x53eca9(0x1c6)][_0x53eca9(0x1c2)](_0x502ccb['map'](_0x435aba=>'\x27'+_0x435aba[_0x53eca9(0x175)]+'\x27')[_0x53eca9(0x15a)](','));await this['sfLogger']['log'](this['prefix']+'\x20Getting\x20repositories\x20from\x20git\x20service.')[_0x53eca9(0x1b5)](),this['repoList']=await this[_0x53eca9(0x17f)][_0x53eca9(0x1c8)]();const _0x24d794=[..._0x502ccb,..._0x560700];this['sfLogger'][_0x53eca9(0x185)](this[_0x53eca9(0x15d)]+_0x53eca9(0x1ac)+_0x24d794[_0x53eca9(0x15f)]+_0x53eca9(0x158));for(const _0x418e58 of _0x24d794){this[_0x53eca9(0x1b9)]['log'](_0x53eca9(0x17a)+_0x418e58[_0x53eca9(0x1bf)]+'['+_0x418e58[_0x53eca9(0x175)]+_0x53eca9(0x1b3)+_0x418e58['branchName']+'['+_0x418e58['branchId']+_0x53eca9(0x1b0)),this[_0x53eca9(0x1a2)][_0x53eca9(0x185)](this[_0x53eca9(0x15d)]+'\x20Syncing\x20repository:\x20\x22'+_0x418e58['repositoryName']+_0x53eca9(0x1b4)+_0x418e58['branchName']+'\x22.'),this[_0x53eca9(0x1a2)][_0x53eca9(0x185)](this['prefix']+_0x53eca9(0x197));const _0x4f9feb=await this['checkValidNaming'](_0x418e58);if(!_0x4f9feb)continue;this[_0x53eca9(0x1a2)][_0x53eca9(0x185)](this[_0x53eca9(0x15d)]+'\x20Checking\x20intersects.');const _0x2d073b=await this[_0x53eca9(0x1b6)](_0x418e58);if(_0x2d073b)continue;await this[_0x53eca9(0x1a2)][_0x53eca9(0x1b5)]();let _0x20b1c7;try{await this[_0x53eca9(0x1a2)][_0x53eca9(0x185)](this['prefix']+'\x20Getting\x20Flosum\x20repository')[_0x53eca9(0x1b5)](),_0x20b1c7=await this['getOrCreateRepo'](_0x418e58,typedi_1[_0x53eca9(0x19f)][_0x53eca9(0x1a7)](providers_tokens_1[_0x53eca9(0x1bc)]['connectionId']));}catch(_0x335413){await this[_0x53eca9(0x189)](_0x418e58,_0x335413 instanceof too_many_requests_error_1['TooManyRequests']?_0x335413:new Error(_0x53eca9(0x184)+_0x335413));continue;}await this[_0x53eca9(0x1a2)][_0x53eca9(0x185)](this['prefix']+_0x53eca9(0x169))['send']();if(_0x418e58[_0x53eca9(0x181)]===flosum_repository_sync_dto_1[_0x53eca9(0x18e)]['FlosumToGit']){const _0x26b412=typedi_1[_0x53eca9(0x19f)][_0x53eca9(0x1a7)](flosum_sync_job_1['FlosumSyncJob']);await _0x26b412[_0x53eca9(0x1a8)]({'repository':_0x20b1c7,'convertToSFDX':this[_0x53eca9(0x171)]['isConvertToSfdx'],'syncRecord':_0x418e58,'provider':this[_0x53eca9(0x171)][_0x53eca9(0x170)]})[_0x53eca9(0x1cb)](_0x43276a=>this[_0x53eca9(0x189)](_0x418e58,_0x43276a));}else{const _0x7bf8b=typedi_1[_0x53eca9(0x19f)][_0x53eca9(0x1a7)](git_sync_job_1[_0x53eca9(0x19e)]);await _0x7bf8b[_0x53eca9(0x1a8)]({'repository':_0x20b1c7,'branch':_0x418e58['branchName'],'provider':this[_0x53eca9(0x171)]['gitProvider'],'repositoryGit':_0x20b1c7[_0x53eca9(0x1ce)],'syncRecord':_0x418e58})[_0x53eca9(0x1cb)](_0xf72c73=>this[_0x53eca9(0x189)](_0x418e58,_0xf72c73));}}}catch(_0x5b9a59){this['logger']['error'](_0x5b9a59);_0x5b9a59 instanceof too_many_requests_error_1[_0x53eca9(0x16e)]?(await this[_0x53eca9(0x1a2)][_0x53eca9(0x185)](this[_0x53eca9(0x15d)]+_0x53eca9(0x1ae))[_0x53eca9(0x1b5)](),await(0x0,utils_1[_0x53eca9(0x163)])(0x3c*0x3c*0x3e8),this[_0x53eca9(0x1a8)]()):await this[_0x53eca9(0x1a2)][_0x53eca9(0x1a0)](this[_0x53eca9(0x15d)]+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x5b9a59)[_0x53eca9(0x1b5)]();return;}await this['sfLogger']['log'](this[_0x53eca9(0x15d)]+_0x53eca9(0x17e))[_0x53eca9(0x1b5)](),await this[_0x53eca9(0x1c6)][_0x53eca9(0x162)](typedi_1['Container']['get'](providers_tokens_1[_0x53eca9(0x1bc)][_0x53eca9(0x18f)]))[_0x53eca9(0x1cb)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a80_0x54b210(0x183)])({'transient':!![]}),__metadata(a80_0x54b210(0x18d),[salesforce_service_1[a80_0x54b210(0x188)],salesforce_sync_service_1['SalesforceSyncService']])],SyncService),exports[a80_0x54b210(0x1b2)]=SyncService;