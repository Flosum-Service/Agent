const a111_0x100d05=a111_0x42b0;(function(_0xa3f7b9,_0x574b59){const _0x535ebc=a111_0x42b0,_0x31aa05=_0xa3f7b9();while(!![]){try{const _0x3ef8f2=parseInt(_0x535ebc(0x24e))/0x1+-parseInt(_0x535ebc(0x221))/0x2+parseInt(_0x535ebc(0x252))/0x3+-parseInt(_0x535ebc(0x220))/0x4+parseInt(_0x535ebc(0x1e4))/0x5+-parseInt(_0x535ebc(0x200))/0x6*(-parseInt(_0x535ebc(0x206))/0x7)+-parseInt(_0x535ebc(0x21a))/0x8*(parseInt(_0x535ebc(0x240))/0x9);if(_0x3ef8f2===_0x574b59)break;else _0x31aa05['push'](_0x31aa05['shift']());}catch(_0x566d6e){_0x31aa05['push'](_0x31aa05['shift']());}}}(a111_0x1de1,0x6e59d));const a111_0x55b17b=(function(){let _0x289f2=!![];return function(_0x3acf0c,_0xfa57c6){const _0x3ad77c=_0x289f2?function(){const _0x2f61ad=a111_0x42b0;if(_0xfa57c6){const _0x3d2981=_0xfa57c6[_0x2f61ad(0x247)](_0x3acf0c,arguments);return _0xfa57c6=null,_0x3d2981;}}:function(){};return _0x289f2=![],_0x3ad77c;};}()),a111_0x1a054c=a111_0x55b17b(this,function(){const _0x492539=a111_0x42b0;return a111_0x1a054c[_0x492539(0x1fe)]()['search'](_0x492539(0x24c))[_0x492539(0x1fe)]()[_0x492539(0x1de)](a111_0x1a054c)['search'](_0x492539(0x24c));});a111_0x1a054c();function a111_0x42b0(_0x2bec27,_0x329cdd){const _0x187130=a111_0x1de1();return a111_0x42b0=function(_0x1a054c,_0x55b17b){_0x1a054c=_0x1a054c-0x1dd;let _0x1de1ae=_0x187130[_0x1a054c];return _0x1de1ae;},a111_0x42b0(_0x2bec27,_0x329cdd);}'use strict';var __decorate=this&&this[a111_0x100d05(0x22c)]||function(_0x1e0302,_0x74edfe,_0x1f4a2d,_0x1e0ec0){const _0x4767fa=a111_0x100d05;var _0x58b855=arguments[_0x4767fa(0x244)],_0xc204e9=_0x58b855<0x3?_0x74edfe:_0x1e0ec0===null?_0x1e0ec0=Object['getOwnPropertyDescriptor'](_0x74edfe,_0x1f4a2d):_0x1e0ec0,_0x176084;if(typeof Reflect===_0x4767fa(0x215)&&typeof Reflect[_0x4767fa(0x20b)]==='function')_0xc204e9=Reflect[_0x4767fa(0x20b)](_0x1e0302,_0x74edfe,_0x1f4a2d,_0x1e0ec0);else{for(var _0x10eaeb=_0x1e0302[_0x4767fa(0x244)]-0x1;_0x10eaeb>=0x0;_0x10eaeb--)if(_0x176084=_0x1e0302[_0x10eaeb])_0xc204e9=(_0x58b855<0x3?_0x176084(_0xc204e9):_0x58b855>0x3?_0x176084(_0x74edfe,_0x1f4a2d,_0xc204e9):_0x176084(_0x74edfe,_0x1f4a2d))||_0xc204e9;}return _0x58b855>0x3&&_0xc204e9&&Object[_0x4767fa(0x1ec)](_0x74edfe,_0x1f4a2d,_0xc204e9),_0xc204e9;},__metadata=this&&this[a111_0x100d05(0x230)]||function(_0x1a5d10,_0x39f783){const _0x45171b=a111_0x100d05;if(typeof Reflect==='object'&&typeof Reflect[_0x45171b(0x253)]==='function')return Reflect[_0x45171b(0x253)](_0x1a5d10,_0x39f783);},SyncService_1;Object[a111_0x100d05(0x1ec)](exports,'__esModule',{'value':!![]}),exports[a111_0x100d05(0x23d)]=void 0x0;function a111_0x1de1(){const _0x2b1d08=['\x20Syncing\x20repository:\x20\x22','SalesforceError','updateRemoteState','gitUrl','repoList','push','get','defineProperty','url','hooks','FlosumSyncJob','\x20No\x20repositories\x20to\x20sync.','\x27\x20in\x20repository\x20\x27','\x20Checking\x20valid\x20name.','../../providers/web-hooks/hooks.utils',']\x20repository\x20','setStatus','sfLogger','run','\x27\x20[','Unable\x20to\x20synchronize\x20repository\x20\x27','../jobs/flosum-sync.job','REPOSITORY_NAME_REGEXP','error','\x27\x20-\x20\x27','toString','create','1601718xoGYki','repoService','../../../shared/utils','../../salesforce/errors/salesforce.error','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','logger','21NHtUaH','Error','\x20Getting\x20branch\x20records.','GitSyncJob','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','decorate','Unable\x20to\x20synchronize\x20branch\x20\x27','\x20Getting\x20repositories\x20from\x20git\x20service.','\x20Checking\x20intersects.','GitBranchNotFoundError','createHookPayload','handleRecordSyncError','connectionId','getAll','Tokens','object','name','sleep','BadRequestError','\x20branches.','37400RDFVwI','disableSync','\x20Repository\x20\x22','Service','\x20Start\x20sync\x20job.','repositoryId','3256588sHbkHW','1283184TBViBB','BRANCH_NAME_REGEXP','../../salesforce/services/salesforce.service','toUpperCase','HooksUtils','SyncDirection','../../salesforce/services/salesforce-sync.service','../../../../core/errors/bad-request.error','repositoriesIntersections',']\x20branch.','find','__decorate','config','getOrCreateRepo','prefix','__metadata','getBranchRecords','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','\x20Stop\x20sync\x20job\x20for\x20\x27','\x20Completed\x20prepare\x20to\x20syncing.','test','salesforceSync',']\x20[','\x20Getting\x20repository\x20records.','checkValidNaming','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','isBidirectionalSynchronization','isIntersects','SyncService','TooManyRequests','applicationUrl','945FLYujj','gitRepoService','../../providers/providers.tokens','toLowerCase','length','Waiting','log','apply','map','typedi','gitProvider','\x22\x20branch:\x20\x22','(((.+)+)+)+$','repositoryName','733103slAStV','isConvertToSfdx','salesforceService','FlosumToGit','2168541fVjwXR','metadata','send','Container','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','constructor','../../../../core','catch','getRepositoryRecords','branchName','Syncing\x20','709010amMUZZ'];a111_0x1de1=function(){return _0x2b1d08;};return a111_0x1de1();}const constants_1=require('../../../../constants'),core_1=require(a111_0x100d05(0x1df)),too_many_requests_error_1=require('../../../../core/errors/too-many-requests.error'),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require(a111_0x100d05(0x203)),salesforce_sync_service_1=require(a111_0x100d05(0x227)),salesforce_service_1=require(a111_0x100d05(0x223)),utils_1=require(a111_0x100d05(0x202)),typedi_1=require(a111_0x100d05(0x249)),hooks_utils_1=require(a111_0x100d05(0x1f3)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require(a111_0x100d05(0x1fa)),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require(a111_0x100d05(0x242)),bad_request_error_1=require(a111_0x100d05(0x228));let SyncService=SyncService_1=class SyncService{constructor(_0x17084b,_0x2d1943){const _0x4e4bb6=a111_0x100d05;this[_0x4e4bb6(0x250)]=_0x17084b,this['salesforceSync']=_0x2d1943,this[_0x4e4bb6(0x205)]=new core_1['Logger'](SyncService_1[_0x4e4bb6(0x216)]),this['repositoriesIntersections']={},this[_0x4e4bb6(0x1e9)]=[];}async[a111_0x100d05(0x211)](_0x459da9,_0x2a5893){const _0x4a0037=a111_0x100d05;if(_0x2a5893 instanceof git_branch_not_found_error_1[_0x4a0037(0x20f)]){await this[_0x4a0037(0x236)][_0x4a0037(0x1f5)](_0x459da9,'Not\x20Synchronized');return;}if(_0x2a5893 instanceof too_many_requests_error_1[_0x4a0037(0x23e)]){await this[_0x4a0037(0x236)]['setStatus'](_0x459da9,_0x4a0037(0x245));throw _0x2a5893;}try{await this[_0x4a0037(0x1f6)][_0x4a0037(0x1fc)](this['prefix']+_0x4a0037(0x233)+_0x459da9[_0x4a0037(0x24d)]+_0x4a0037(0x1f8)+_0x459da9['branchName']+']\x20due\x20error\x20-\x20'+_0x2a5893+'.')[_0x4a0037(0x254)](),await this[_0x4a0037(0x236)][_0x4a0037(0x1e7)](_0x459da9,{}),await this['salesforceSync']['setStatus'](_0x459da9,_0x4a0037(0x207));}catch(_0x1182f7){if(_0x1182f7 instanceof salesforce_error_1[_0x4a0037(0x1e6)])throw _0x1182f7;}}async[a111_0x100d05(0x23c)](_0x162e76){const _0x330562=a111_0x100d05;if(_0x162e76[_0x330562(0x21f)]){const _0x579916=_0x162e76[_0x330562(0x24d)][_0x330562(0x243)](),_0x106023=this[_0x330562(0x229)][_0x579916];if(!_0x106023)this['repositoriesIntersections'][_0x579916]=_0x162e76[_0x330562(0x24d)];else{if(_0x106023&&_0x106023!==_0x162e76[_0x330562(0x24d)])return await this['handleRecordSyncError'](_0x162e76,new Error(_0x330562(0x1f9)+_0x162e76[_0x330562(0x24d)]+_0x330562(0x204)+_0x579916+_0x330562(0x1fd)+_0x106023+'\x27')),!![];}}return![];}async[a111_0x100d05(0x239)](_0x46efa8){const _0x3b7d8c=a111_0x100d05;if(!constants_1[_0x3b7d8c(0x1fb)][_0x3b7d8c(0x235)](_0x46efa8[_0x3b7d8c(0x24d)]))return await this['handleRecordSyncError'](_0x46efa8,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x46efa8[_0x3b7d8c(0x24d)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x3b7d8c(0x222)][_0x3b7d8c(0x235)](_0x46efa8['branchName']))return await this[_0x3b7d8c(0x211)](_0x46efa8,new Error(_0x3b7d8c(0x20c)+_0x46efa8[_0x3b7d8c(0x1e2)]+_0x3b7d8c(0x1f1)+_0x46efa8[_0x3b7d8c(0x24d)]+_0x3b7d8c(0x1dd))),![];return!![];}async[a111_0x100d05(0x22e)](_0x5bb84d,_0x52e842){const _0x1c66b4=a111_0x100d05;let _0x7b9307=this[_0x1c66b4(0x1e9)][_0x1c66b4(0x22b)](_0xab9677=>_0x5bb84d[_0x1c66b4(0x24d)]===_0xab9677['name']);!_0x7b9307&&(this[_0x1c66b4(0x1f6)]['log'](this[_0x1c66b4(0x22f)]+_0x1c66b4(0x21c)+_0x5bb84d[_0x1c66b4(0x24d)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x7b9307=await this[_0x1c66b4(0x201)]['create']({'name':_0x5bb84d['repositoryName'],'autoInit':!![],'defaultBranch':_0x5bb84d['branchName'],'private':!![],'createHook':typedi_1[_0x1c66b4(0x255)][_0x1c66b4(0x1eb)](providers_tokens_1['Tokens'][_0x1c66b4(0x22d)])[_0x1c66b4(0x23b)]}));if(this[_0x1c66b4(0x22d)]['isBidirectionalSynchronization']){const _0x7bdcba=await _0x7b9307[_0x1c66b4(0x1ee)][_0x1c66b4(0x213)]();!_0x7bdcba['find'](_0x37bf79=>_0x37bf79[_0x1c66b4(0x1ed)]===hooks_utils_1[_0x1c66b4(0x225)]['getHookLinkFor'](this[_0x1c66b4(0x22d)][_0x1c66b4(0x24a)],this[_0x1c66b4(0x22d)][_0x1c66b4(0x23f)],_0x52e842))&&(this[_0x1c66b4(0x1f6)][_0x1c66b4(0x246)](this['prefix']+_0x1c66b4(0x21c)+_0x5bb84d[_0x1c66b4(0x24d)]+_0x1c66b4(0x20a)),await _0x7b9307[_0x1c66b4(0x1ee)][_0x1c66b4(0x1ff)](hooks_utils_1['HooksUtils'][_0x1c66b4(0x210)](this[_0x1c66b4(0x22d)]['gitProvider'],_0x7b9307[_0x1c66b4(0x1ee)],this[_0x1c66b4(0x22d)][_0x1c66b4(0x23f)],_0x52e842)));}return this[_0x1c66b4(0x1e9)][_0x1c66b4(0x1ea)](_0x7b9307),_0x7b9307;}async[a111_0x100d05(0x1f7)](){const _0x2090a1=a111_0x100d05;this['gitApiService']=typedi_1[_0x2090a1(0x255)]['get'](providers_tokens_1[_0x2090a1(0x214)]['gitApiService']),this[_0x2090a1(0x201)]=typedi_1[_0x2090a1(0x255)]['get'](providers_tokens_1[_0x2090a1(0x214)][_0x2090a1(0x241)]),this['config']=typedi_1[_0x2090a1(0x255)][_0x2090a1(0x1eb)](providers_tokens_1[_0x2090a1(0x214)][_0x2090a1(0x22d)]),this[_0x2090a1(0x1f6)]=typedi_1[_0x2090a1(0x255)][_0x2090a1(0x1eb)](providers_tokens_1[_0x2090a1(0x214)]['logger']),this['prefix']='['+SyncService_1[_0x2090a1(0x216)]+_0x2090a1(0x237)+this[_0x2090a1(0x22d)][_0x2090a1(0x24a)][_0x2090a1(0x224)]()+']',this[_0x2090a1(0x250)]['setLoggerId'](this[_0x2090a1(0x1f6)]['getLoggerId']());try{this[_0x2090a1(0x1f6)][_0x2090a1(0x246)](this[_0x2090a1(0x22f)]+_0x2090a1(0x21e)),await this['sfLogger']['log'](this[_0x2090a1(0x22f)]+_0x2090a1(0x238))[_0x2090a1(0x254)]();const _0x1187d6=await this['salesforceSync'][_0x2090a1(0x1e1)](typedi_1[_0x2090a1(0x255)]['get'](providers_tokens_1['Tokens'][_0x2090a1(0x212)]));if(!_0x1187d6[_0x2090a1(0x244)])throw new bad_request_error_1[(_0x2090a1(0x218))](this[_0x2090a1(0x22f)]+_0x2090a1(0x1f0));await this['sfLogger'][_0x2090a1(0x246)](this['prefix']+_0x2090a1(0x208))['send']();const _0xdf5be1=await this[_0x2090a1(0x236)][_0x2090a1(0x231)](_0x1187d6[_0x2090a1(0x248)](_0x1d2e64=>'\x27'+_0x1d2e64[_0x2090a1(0x21f)]+'\x27')['join'](','));await this['sfLogger']['log'](this[_0x2090a1(0x22f)]+_0x2090a1(0x20d))[_0x2090a1(0x254)](),this[_0x2090a1(0x1e9)]=await this[_0x2090a1(0x201)][_0x2090a1(0x213)]();const _0x20da65=[..._0x1187d6,..._0xdf5be1];this[_0x2090a1(0x1f6)][_0x2090a1(0x246)](this[_0x2090a1(0x22f)]+'\x20Have\x20to\x20synchronize\x20'+_0x20da65[_0x2090a1(0x244)]+_0x2090a1(0x219));for(const _0x4c93fb of _0x20da65){this['logger'][_0x2090a1(0x246)](_0x2090a1(0x1e3)+_0x4c93fb[_0x2090a1(0x24d)]+'['+_0x4c93fb[_0x2090a1(0x21f)]+_0x2090a1(0x1f4)+_0x4c93fb['branchName']+'['+_0x4c93fb['branchId']+_0x2090a1(0x22a)),this[_0x2090a1(0x1f6)][_0x2090a1(0x246)](this[_0x2090a1(0x22f)]+_0x2090a1(0x1e5)+_0x4c93fb['repositoryName']+_0x2090a1(0x24b)+_0x4c93fb[_0x2090a1(0x1e2)]+'\x22.'),this['sfLogger']['log'](this['prefix']+_0x2090a1(0x1f2));const _0x6e27b9=await this[_0x2090a1(0x239)](_0x4c93fb);if(!_0x6e27b9)continue;this[_0x2090a1(0x1f6)][_0x2090a1(0x246)](this[_0x2090a1(0x22f)]+_0x2090a1(0x20e));const _0x39325e=await this[_0x2090a1(0x23c)](_0x4c93fb);if(_0x39325e)continue;await this[_0x2090a1(0x1f6)][_0x2090a1(0x254)]();let _0x1e3d38;try{await this[_0x2090a1(0x1f6)][_0x2090a1(0x246)](this[_0x2090a1(0x22f)]+'\x20Getting\x20Flosum\x20repository')[_0x2090a1(0x254)](),_0x1e3d38=await this[_0x2090a1(0x22e)](_0x4c93fb,typedi_1['Container'][_0x2090a1(0x1eb)](providers_tokens_1['Tokens'][_0x2090a1(0x212)]));}catch(_0xfa26fe){await this[_0x2090a1(0x211)](_0x4c93fb,_0xfa26fe instanceof too_many_requests_error_1[_0x2090a1(0x23e)]?_0xfa26fe:new Error(_0x2090a1(0x232)+_0xfa26fe));continue;}await this[_0x2090a1(0x1f6)][_0x2090a1(0x246)](this[_0x2090a1(0x22f)]+_0x2090a1(0x234))[_0x2090a1(0x254)]();if(_0x4c93fb['direction']===flosum_repository_sync_dto_1[_0x2090a1(0x226)][_0x2090a1(0x251)]){const _0x5b0b02=typedi_1[_0x2090a1(0x255)][_0x2090a1(0x1eb)](flosum_sync_job_1[_0x2090a1(0x1ef)]);await _0x5b0b02['run']({'repository':_0x1e3d38,'convertToSFDX':this[_0x2090a1(0x22d)][_0x2090a1(0x24f)],'syncRecord':_0x4c93fb,'provider':this[_0x2090a1(0x22d)][_0x2090a1(0x24a)]})['catch'](_0x34587f=>this[_0x2090a1(0x211)](_0x4c93fb,_0x34587f));}else{const _0x42649f=typedi_1['Container'][_0x2090a1(0x1eb)](git_sync_job_1[_0x2090a1(0x209)]);await _0x42649f['run']({'repository':_0x1e3d38,'branch':_0x4c93fb[_0x2090a1(0x1e2)],'provider':this[_0x2090a1(0x22d)][_0x2090a1(0x24a)],'repositoryGit':_0x1e3d38[_0x2090a1(0x1e8)],'syncRecord':_0x4c93fb})[_0x2090a1(0x1e0)](_0x1d8271=>this[_0x2090a1(0x211)](_0x4c93fb,_0x1d8271));}}}catch(_0x37d9e8){this[_0x2090a1(0x205)]['error'](_0x37d9e8);_0x37d9e8 instanceof too_many_requests_error_1[_0x2090a1(0x23e)]?(await this['sfLogger'][_0x2090a1(0x246)](this[_0x2090a1(0x22f)]+_0x2090a1(0x23a))['send'](),await(0x0,utils_1[_0x2090a1(0x217)])(0x3c*0x3c*0x3e8),this['run']()):await this[_0x2090a1(0x1f6)][_0x2090a1(0x1fc)](this[_0x2090a1(0x22f)]+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x37d9e8)[_0x2090a1(0x254)]();return;}await this['sfLogger'][_0x2090a1(0x246)](this['prefix']+'\x20Sync\x20job\x20done.')[_0x2090a1(0x254)](),await this[_0x2090a1(0x236)][_0x2090a1(0x21b)](typedi_1[_0x2090a1(0x255)][_0x2090a1(0x1eb)](providers_tokens_1['Tokens'][_0x2090a1(0x212)]))[_0x2090a1(0x1e0)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x100d05(0x21d)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1['SalesforceService'],salesforce_sync_service_1['SalesforceSyncService']])],SyncService),exports[a111_0x100d05(0x23d)]=SyncService;