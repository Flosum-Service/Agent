const a110_0x17e0e5=a110_0x3a86;(function(_0x279bac,_0xafbf1f){const _0x37531c=a110_0x3a86,_0x58be15=_0x279bac();while(!![]){try{const _0x56bae0=-parseInt(_0x37531c(0xf9))/0x1+-parseInt(_0x37531c(0xea))/0x2+parseInt(_0x37531c(0xa8))/0x3+parseInt(_0x37531c(0xd1))/0x4*(-parseInt(_0x37531c(0xbe))/0x5)+parseInt(_0x37531c(0x117))/0x6+-parseInt(_0x37531c(0x111))/0x7*(-parseInt(_0x37531c(0xd2))/0x8)+parseInt(_0x37531c(0xee))/0x9;if(_0x56bae0===_0xafbf1f)break;else _0x58be15['push'](_0x58be15['shift']());}catch(_0xb693be){_0x58be15['push'](_0x58be15['shift']());}}}(a110_0x5ed1,0x3d4ae));function a110_0x3a86(_0x136788,_0x12bad8){const _0x52d5c5=a110_0x5ed1();return a110_0x3a86=function(_0x512d7c,_0x141f99){_0x512d7c=_0x512d7c-0xa8;let _0x5ed1f=_0x52d5c5[_0x512d7c];return _0x5ed1f;},a110_0x3a86(_0x136788,_0x12bad8);}const a110_0x141f99=(function(){let _0xeade8b=!![];return function(_0x15c6c9,_0x371c3c){const _0xd71495=_0xeade8b?function(){if(_0x371c3c){const _0x105581=_0x371c3c['apply'](_0x15c6c9,arguments);return _0x371c3c=null,_0x105581;}}:function(){};return _0xeade8b=![],_0xd71495;};}()),a110_0x512d7c=a110_0x141f99(this,function(){const _0x109aac=a110_0x3a86;return a110_0x512d7c['toString']()['search'](_0x109aac(0xcb))['toString']()['constructor'](a110_0x512d7c)[_0x109aac(0xd9)]('(((.+)+)+)+$');});a110_0x512d7c();'use strict';function a110_0x5ed1(){const _0x2b24f9=['repositoryName','GitBranchNotFoundError','Not\x20Synchronized','repoService','../../../../core/errors/too-many-requests.error','getHookLinkFor','Service','isIntersects','\x27\x20-\x20\x27','repoList','\x20Repository\x20\x22','437585vAMJDd','run','\x20Syncing\x20repository:\x20\x22','../../salesforce/dto/flosum-repository-sync.dto','setStatus','Unable\x20to\x20synchronize\x20repository\x20\x27','connectionId','name','\x20Sync\x20job\x20done.','getRepositoryRecords','function','disableSync','map','(((.+)+)+)+$','config','catch','gitProvider','SyncService','branchName','20EyeSnN','659504IYKOIo',']\x20branch.','push','log','decorate',']\x20repository\x20','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','search','prefix','find','\x20No\x20repositories\x20to\x20sync.','HooksUtils','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','../../../shared/utils','repositoriesIntersections','applicationUrl','salesforceSync','FlosumToGit','GitSyncJob','../../providers/web-hooks/hooks.utils','setLoggerId','typedi','\x27\x20in\x20repository\x20\x27','defineProperty','817232cCRRcU','logger','__esModule','repositoryId','8570610fjbTsg','direction','\x20Getting\x20branch\x20records.','\x20Start\x20sync\x20job.','length','Error','\x20Have\x20to\x20synchronize\x20','SalesforceError','../../salesforce/errors/salesforce.error','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','send','367180HUtWnM','Tokens','__decorate','create','design:paramtypes','BRANCH_NAME_REGEXP','toLowerCase',']\x20due\x20error\x20-\x20','../../../../core','../errors/git-branch-not-found.error','salesforceService','checkValidNaming','error','__metadata','sfLogger','updateRemoteState','SalesforceSyncService','isBidirectionalSynchronization','BadRequestError','handleRecordSyncError','object','\x20branches.','\x20Stop\x20sync\x20job\x20for\x20\x27','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','7NMbEJf','\x20Getting\x20repository\x20records.','../../salesforce/services/salesforce.service','url','../../../../core/errors/bad-request.error','Unable\x20to\x20synchronize\x20branch\x20\x27','531570zEmFDo','Container','gitApiService','\x20Getting\x20repositories\x20from\x20git\x20service.','Syncing\x20','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','metadata',']\x20[','isConvertToSfdx','../jobs/git-sync.job','getAll','TooManyRequests','toUpperCase','get','1023336CjcFxz','FlosumSyncJob','getBranchRecords','../../../../constants','SyncDirection','Waiting','gitRepoService','test','\x20Checking\x20valid\x20name.','sleep','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'];a110_0x5ed1=function(){return _0x2b24f9;};return a110_0x5ed1();}var __decorate=this&&this[a110_0x17e0e5(0xfb)]||function(_0x27ceac,_0x28352b,_0x26268f,_0x362421){const _0x283b1d=a110_0x17e0e5;var _0x35fcbc=arguments[_0x283b1d(0xf2)],_0x1f9118=_0x35fcbc<0x3?_0x28352b:_0x362421===null?_0x362421=Object['getOwnPropertyDescriptor'](_0x28352b,_0x26268f):_0x362421,_0x46bbc7;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x283b1d(0xc8))_0x1f9118=Reflect[_0x283b1d(0xd6)](_0x27ceac,_0x28352b,_0x26268f,_0x362421);else{for(var _0x4357b0=_0x27ceac[_0x283b1d(0xf2)]-0x1;_0x4357b0>=0x0;_0x4357b0--)if(_0x46bbc7=_0x27ceac[_0x4357b0])_0x1f9118=(_0x35fcbc<0x3?_0x46bbc7(_0x1f9118):_0x35fcbc>0x3?_0x46bbc7(_0x28352b,_0x26268f,_0x1f9118):_0x46bbc7(_0x28352b,_0x26268f))||_0x1f9118;}return _0x35fcbc>0x3&&_0x1f9118&&Object['defineProperty'](_0x28352b,_0x26268f,_0x1f9118),_0x1f9118;},__metadata=this&&this[a110_0x17e0e5(0x106)]||function(_0x3a033a,_0x4037a0){const _0x558e9e=a110_0x17e0e5;if(typeof Reflect===_0x558e9e(0x10d)&&typeof Reflect[_0x558e9e(0x11d)]===_0x558e9e(0xc8))return Reflect['metadata'](_0x3a033a,_0x4037a0);},SyncService_1;Object[a110_0x17e0e5(0xe9)](exports,a110_0x17e0e5(0xec),{'value':!![]}),exports[a110_0x17e0e5(0xcf)]=void 0x0;const constants_1=require(a110_0x17e0e5(0xab)),core_1=require(a110_0x17e0e5(0x101)),too_many_requests_error_1=require(a110_0x17e0e5(0xb7)),flosum_repository_sync_dto_1=require(a110_0x17e0e5(0xc1)),salesforce_error_1=require(a110_0x17e0e5(0xf6)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a110_0x17e0e5(0x113)),utils_1=require(a110_0x17e0e5(0xdf)),typedi_1=require(a110_0x17e0e5(0xe7)),hooks_utils_1=require(a110_0x17e0e5(0xe5)),git_branch_not_found_error_1=require(a110_0x17e0e5(0x102)),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require(a110_0x17e0e5(0x120)),providers_tokens_1=require('../../providers/providers.tokens'),bad_request_error_1=require(a110_0x17e0e5(0x115));let SyncService=SyncService_1=class SyncService{constructor(_0x117b04,_0x3f536f){const _0x3392e7=a110_0x17e0e5;this[_0x3392e7(0x103)]=_0x117b04,this['salesforceSync']=_0x3f536f,this[_0x3392e7(0xeb)]=new core_1['Logger'](SyncService_1[_0x3392e7(0xc5)]),this[_0x3392e7(0xe0)]={},this[_0x3392e7(0xbc)]=[];}async['handleRecordSyncError'](_0x473a84,_0x5bc11b){const _0x55e555=a110_0x17e0e5;if(_0x5bc11b instanceof git_branch_not_found_error_1[_0x55e555(0xb4)]){await this[_0x55e555(0xe2)][_0x55e555(0xc2)](_0x473a84,_0x55e555(0xb5));return;}if(_0x5bc11b instanceof too_many_requests_error_1['TooManyRequests']){await this[_0x55e555(0xe2)][_0x55e555(0xc2)](_0x473a84,_0x55e555(0xad));throw _0x5bc11b;}try{await this[_0x55e555(0x107)][_0x55e555(0x105)](this[_0x55e555(0xda)]+_0x55e555(0x10f)+_0x473a84['repositoryName']+'\x27\x20['+_0x473a84[_0x55e555(0xd0)]+_0x55e555(0x100)+_0x5bc11b+'.')[_0x55e555(0xf8)](),await this[_0x55e555(0xe2)][_0x55e555(0x108)](_0x473a84,{}),await this[_0x55e555(0xe2)][_0x55e555(0xc2)](_0x473a84,_0x55e555(0xf3));}catch(_0x43559f){if(_0x43559f instanceof salesforce_error_1[_0x55e555(0xf5)])throw _0x43559f;}}async[a110_0x17e0e5(0xba)](_0x400042){const _0xb1d7dd=a110_0x17e0e5;if(_0x400042[_0xb1d7dd(0xed)]){const _0x4d7e9a=_0x400042[_0xb1d7dd(0xb3)][_0xb1d7dd(0xff)](),_0x568f70=this[_0xb1d7dd(0xe0)][_0x4d7e9a];if(!_0x568f70)this[_0xb1d7dd(0xe0)][_0x4d7e9a]=_0x400042[_0xb1d7dd(0xb3)];else{if(_0x568f70&&_0x568f70!==_0x400042[_0xb1d7dd(0xb3)])return await this[_0xb1d7dd(0x10c)](_0x400042,new Error(_0xb1d7dd(0xc3)+_0x400042[_0xb1d7dd(0xb3)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x4d7e9a+_0xb1d7dd(0xbb)+_0x568f70+'\x27')),!![];}}return![];}async['checkValidNaming'](_0x1f8013){const _0x5da074=a110_0x17e0e5;if(!constants_1['REPOSITORY_NAME_REGEXP']['test'](_0x1f8013[_0x5da074(0xb3)]))return await this[_0x5da074(0x10c)](_0x1f8013,new Error(_0x5da074(0xc3)+_0x1f8013[_0x5da074(0xb3)]+_0x5da074(0xd8))),![];if(!constants_1[_0x5da074(0xfe)][_0x5da074(0xaf)](_0x1f8013[_0x5da074(0xd0)]))return await this[_0x5da074(0x10c)](_0x1f8013,new Error(_0x5da074(0x116)+_0x1f8013[_0x5da074(0xd0)]+_0x5da074(0xe8)+_0x1f8013[_0x5da074(0xb3)]+_0x5da074(0xde))),![];return!![];}async['getOrCreateRepo'](_0x3da6ba,_0x56e7fe){const _0x51c3b7=a110_0x17e0e5;let _0x11ddce=this[_0x51c3b7(0xbc)][_0x51c3b7(0xdb)](_0x130f14=>_0x3da6ba[_0x51c3b7(0xb3)]===_0x130f14[_0x51c3b7(0xc5)]);!_0x11ddce&&(this[_0x51c3b7(0x107)][_0x51c3b7(0xd5)](this[_0x51c3b7(0xda)]+_0x51c3b7(0xbd)+_0x3da6ba[_0x51c3b7(0xb3)]+_0x51c3b7(0xf7)),_0x11ddce=await this['repoService']['create']({'name':_0x3da6ba[_0x51c3b7(0xb3)],'autoInit':!![],'defaultBranch':_0x3da6ba[_0x51c3b7(0xd0)],'private':!![],'createHook':typedi_1[_0x51c3b7(0x118)]['get'](providers_tokens_1['Tokens'][_0x51c3b7(0xcc)])[_0x51c3b7(0x10a)]}));if(this[_0x51c3b7(0xcc)][_0x51c3b7(0x10a)]){const _0x26ad91=await _0x11ddce['hooks'][_0x51c3b7(0x121)]();!_0x26ad91[_0x51c3b7(0xdb)](_0xf1cc89=>_0xf1cc89[_0x51c3b7(0x114)]===hooks_utils_1[_0x51c3b7(0xdd)][_0x51c3b7(0xb8)](this[_0x51c3b7(0xcc)][_0x51c3b7(0xce)],this[_0x51c3b7(0xcc)][_0x51c3b7(0xe1)],_0x56e7fe))&&(this[_0x51c3b7(0x107)]['log'](this[_0x51c3b7(0xda)]+_0x51c3b7(0xbd)+_0x3da6ba[_0x51c3b7(0xb3)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x11ddce['hooks'][_0x51c3b7(0xfc)](hooks_utils_1[_0x51c3b7(0xdd)]['createHookPayload'](this['config'][_0x51c3b7(0xce)],_0x11ddce['hooks'],this[_0x51c3b7(0xcc)][_0x51c3b7(0xe1)],_0x56e7fe)));}return this[_0x51c3b7(0xbc)][_0x51c3b7(0xd4)](_0x11ddce),_0x11ddce;}async[a110_0x17e0e5(0xbf)](){const _0x18ce1=a110_0x17e0e5;this[_0x18ce1(0x119)]=typedi_1[_0x18ce1(0x118)][_0x18ce1(0x124)](providers_tokens_1['Tokens'][_0x18ce1(0x119)]),this[_0x18ce1(0xb6)]=typedi_1['Container'][_0x18ce1(0x124)](providers_tokens_1[_0x18ce1(0xfa)][_0x18ce1(0xae)]),this[_0x18ce1(0xcc)]=typedi_1[_0x18ce1(0x118)][_0x18ce1(0x124)](providers_tokens_1['Tokens'][_0x18ce1(0xcc)]),this[_0x18ce1(0x107)]=typedi_1['Container'][_0x18ce1(0x124)](providers_tokens_1[_0x18ce1(0xfa)][_0x18ce1(0xeb)]),this[_0x18ce1(0xda)]='['+SyncService_1[_0x18ce1(0xc5)]+_0x18ce1(0x11e)+this[_0x18ce1(0xcc)][_0x18ce1(0xce)][_0x18ce1(0x123)]()+']',this[_0x18ce1(0x103)][_0x18ce1(0xe6)](this[_0x18ce1(0x107)]['getLoggerId']());try{this[_0x18ce1(0x107)]['log'](this['prefix']+_0x18ce1(0xf1)),await this[_0x18ce1(0x107)][_0x18ce1(0xd5)](this[_0x18ce1(0xda)]+_0x18ce1(0x112))[_0x18ce1(0xf8)]();const _0x5e6caa=await this[_0x18ce1(0xe2)][_0x18ce1(0xc7)](typedi_1[_0x18ce1(0x118)]['get'](providers_tokens_1['Tokens'][_0x18ce1(0xc4)]));if(!_0x5e6caa[_0x18ce1(0xf2)])throw new bad_request_error_1[(_0x18ce1(0x10b))](this[_0x18ce1(0xda)]+_0x18ce1(0xdc));await this[_0x18ce1(0x107)][_0x18ce1(0xd5)](this[_0x18ce1(0xda)]+_0x18ce1(0xf0))['send']();const _0x21ae10=await this[_0x18ce1(0xe2)][_0x18ce1(0xaa)](_0x5e6caa[_0x18ce1(0xca)](_0x57eca9=>'\x27'+_0x57eca9['repositoryId']+'\x27')['join'](','));await this['sfLogger'][_0x18ce1(0xd5)](this[_0x18ce1(0xda)]+_0x18ce1(0x11a))[_0x18ce1(0xf8)](),this[_0x18ce1(0xbc)]=await this['repoService'][_0x18ce1(0x121)]();const _0x3fc282=[..._0x5e6caa,..._0x21ae10];this['sfLogger'][_0x18ce1(0xd5)](this[_0x18ce1(0xda)]+_0x18ce1(0xf4)+_0x3fc282[_0x18ce1(0xf2)]+_0x18ce1(0x10e));for(const _0x5b18db of _0x3fc282){this[_0x18ce1(0xeb)][_0x18ce1(0xd5)](_0x18ce1(0x11b)+_0x5b18db[_0x18ce1(0xb3)]+'['+_0x5b18db[_0x18ce1(0xed)]+_0x18ce1(0xd7)+_0x5b18db[_0x18ce1(0xd0)]+'['+_0x5b18db['branchId']+_0x18ce1(0xd3)),this[_0x18ce1(0x107)][_0x18ce1(0xd5)](this['prefix']+_0x18ce1(0xc0)+_0x5b18db[_0x18ce1(0xb3)]+'\x22\x20branch:\x20\x22'+_0x5b18db[_0x18ce1(0xd0)]+'\x22.'),this[_0x18ce1(0x107)]['log'](this[_0x18ce1(0xda)]+_0x18ce1(0xb0));const _0x37b46a=await this[_0x18ce1(0x104)](_0x5b18db);if(!_0x37b46a)continue;this[_0x18ce1(0x107)][_0x18ce1(0xd5)](this[_0x18ce1(0xda)]+'\x20Checking\x20intersects.');const _0x282602=await this[_0x18ce1(0xba)](_0x5b18db);if(_0x282602)continue;await this[_0x18ce1(0x107)][_0x18ce1(0xf8)]();let _0x4637a3;try{await this[_0x18ce1(0x107)]['log'](this[_0x18ce1(0xda)]+'\x20Getting\x20Flosum\x20repository')[_0x18ce1(0xf8)](),_0x4637a3=await this['getOrCreateRepo'](_0x5b18db,typedi_1['Container'][_0x18ce1(0x124)](providers_tokens_1['Tokens'][_0x18ce1(0xc4)]));}catch(_0x55e1eb){await this[_0x18ce1(0x10c)](_0x5b18db,_0x55e1eb instanceof too_many_requests_error_1[_0x18ce1(0x122)]?_0x55e1eb:new Error(_0x18ce1(0x110)+_0x55e1eb));continue;}await this[_0x18ce1(0x107)][_0x18ce1(0xd5)](this[_0x18ce1(0xda)]+'\x20Completed\x20prepare\x20to\x20syncing.')[_0x18ce1(0xf8)]();if(_0x5b18db[_0x18ce1(0xef)]===flosum_repository_sync_dto_1[_0x18ce1(0xac)][_0x18ce1(0xe3)]){const _0x5a2059=typedi_1[_0x18ce1(0x118)]['get'](flosum_sync_job_1[_0x18ce1(0xa9)]);await _0x5a2059[_0x18ce1(0xbf)]({'repository':_0x4637a3,'convertToSFDX':this[_0x18ce1(0xcc)][_0x18ce1(0x11f)],'syncRecord':_0x5b18db,'provider':this[_0x18ce1(0xcc)][_0x18ce1(0xce)]})['catch'](_0x203ab9=>this['handleRecordSyncError'](_0x5b18db,_0x203ab9));}else{const _0x2e07c2=typedi_1[_0x18ce1(0x118)][_0x18ce1(0x124)](git_sync_job_1[_0x18ce1(0xe4)]);await _0x2e07c2[_0x18ce1(0xbf)]({'repository':_0x4637a3,'branch':_0x5b18db[_0x18ce1(0xd0)],'provider':this[_0x18ce1(0xcc)][_0x18ce1(0xce)],'repositoryGit':_0x4637a3['gitUrl'],'syncRecord':_0x5b18db})['catch'](_0x13c324=>this[_0x18ce1(0x10c)](_0x5b18db,_0x13c324));}}}catch(_0x17d949){this['logger']['error'](_0x17d949);_0x17d949 instanceof too_many_requests_error_1[_0x18ce1(0x122)]?(await this[_0x18ce1(0x107)][_0x18ce1(0xd5)](this[_0x18ce1(0xda)]+_0x18ce1(0x11c))['send'](),await(0x0,utils_1[_0x18ce1(0xb1)])(0x3c*0x3c*0x3e8),this['run']()):await this[_0x18ce1(0x107)][_0x18ce1(0x105)](this[_0x18ce1(0xda)]+_0x18ce1(0xb2)+_0x17d949)[_0x18ce1(0xf8)]();return;}await this[_0x18ce1(0x107)][_0x18ce1(0xd5)](this['prefix']+_0x18ce1(0xc6))[_0x18ce1(0xf8)](),await this[_0x18ce1(0xe2)][_0x18ce1(0xc9)](typedi_1[_0x18ce1(0x118)][_0x18ce1(0x124)](providers_tokens_1[_0x18ce1(0xfa)][_0x18ce1(0xc4)]))[_0x18ce1(0xcd)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a110_0x17e0e5(0xb9)])({'transient':!![]}),__metadata(a110_0x17e0e5(0xfd),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a110_0x17e0e5(0x109)]])],SyncService),exports[a110_0x17e0e5(0xcf)]=SyncService;