const a111_0x354285=a111_0x3fb6;(function(_0x14779d,_0x3f0487){const _0x210d32=a111_0x3fb6,_0x5075da=_0x14779d();while(!![]){try{const _0x3ff467=-parseInt(_0x210d32(0x18e))/0x1*(-parseInt(_0x210d32(0x1bf))/0x2)+parseInt(_0x210d32(0x1ec))/0x3+-parseInt(_0x210d32(0x1eb))/0x4+parseInt(_0x210d32(0x172))/0x5*(-parseInt(_0x210d32(0x176))/0x6)+parseInt(_0x210d32(0x1cb))/0x7*(-parseInt(_0x210d32(0x19a))/0x8)+parseInt(_0x210d32(0x1ab))/0x9+-parseInt(_0x210d32(0x1d5))/0xa*(-parseInt(_0x210d32(0x1d9))/0xb);if(_0x3ff467===_0x3f0487)break;else _0x5075da['push'](_0x5075da['shift']());}catch(_0x3ee057){_0x5075da['push'](_0x5075da['shift']());}}}(a111_0x18b4,0x3768b));function a111_0x3fb6(_0x3ff83a,_0x2c0bc2){const _0xc31b6d=a111_0x18b4();return a111_0x3fb6=function(_0x56cee9,_0x1b3852){_0x56cee9=_0x56cee9-0x16f;let _0x18b418=_0xc31b6d[_0x56cee9];return _0x18b418;},a111_0x3fb6(_0x3ff83a,_0x2c0bc2);}const a111_0x1b3852=(function(){let _0x570b7f=!![];return function(_0x5ae1a3,_0x452afa){const _0x1bac96=_0x570b7f?function(){const _0x37a502=a111_0x3fb6;if(_0x452afa){const _0x1f9e27=_0x452afa[_0x37a502(0x192)](_0x5ae1a3,arguments);return _0x452afa=null,_0x1f9e27;}}:function(){};return _0x570b7f=![],_0x1bac96;};}()),a111_0x56cee9=a111_0x1b3852(this,function(){const _0x5e436c=a111_0x3fb6;return a111_0x56cee9[_0x5e436c(0x1bb)]()[_0x5e436c(0x1b8)](_0x5e436c(0x1e2))[_0x5e436c(0x1bb)]()[_0x5e436c(0x19d)](a111_0x56cee9)[_0x5e436c(0x1b8)]('(((.+)+)+)+$');});function a111_0x18b4(){const _0x29d81e=['length','11MIyylR','design:paramtypes','__decorate','Error','repoList','\x20Have\x20to\x20synchronize\x20','applicationUrl','\x20Getting\x20repositories\x20from\x20git\x20service.','updateRemoteState','(((.+)+)+)+$','\x20Checking\x20intersects.','salesforceService','../errors/git-branch-not-found.error','name','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','\x20Checking\x20valid\x20name.','hooks','Container','893552QNHzFn','1325823jRMhyX','\x20Stop\x20sync\x20job\x20for\x20\x27','SalesforceError','test','createHookPayload','send','sfLogger','getLoggerId','15ToIkKB','../../salesforce/dto/flosum-repository-sync.dto','BadRequestError','gitUrl','484530eNFTAB','\x20branches.','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','decorate','FlosumToGit','\x27\x20in\x20repository\x20\x27','\x20Completed\x20prepare\x20to\x20syncing.','defineProperty','repoService',']\x20due\x20error\x20-\x20','branchId','SyncDirection','salesforceSync','../jobs/git-sync.job','REPOSITORY_NAME_REGEXP','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','function','getHookLinkFor','Service','BRANCH_NAME_REGEXP','TooManyRequests','gitApiService','Unable\x20to\x20synchronize\x20repository\x20\x27','getOrCreateRepo','4NMMNsk','getAll','direction',']\x20[','apply','repositoryName','../../../../core','logger','\x22\x20branch:\x20\x22','catch','Not\x20Synchronized','getOwnPropertyDescriptor','12720YRCOBe','connectionId','SyncService','constructor','../jobs/flosum-sync.job','run','create','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','../../salesforce/services/salesforce.service','config','\x20Repository\x20\x22','isBidirectionalSynchronization','\x20Getting\x20repository\x20records.','gitProvider','repositoryId','find','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','1347696oDdYpo','Tokens','object','Unable\x20to\x20synchronize\x20branch\x20\x27','map','__metadata','handleRecordSyncError',']\x20branch.','log','checkValidNaming','prefix','Logger','../../../../constants','search','disableSync','\x27\x20-\x20\x27','toString','../../../../core/errors/bad-request.error','isIntersects','error','88888ygHvpI','get','Syncing\x20','\x20Syncing\x20repository:\x20\x22','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','push','SalesforceService','GitSyncJob','\x20Sync\x20job\x20done.','\x27\x20[','../../salesforce/errors/salesforce.error','\x20Start\x20sync\x20job.','1190MNYZDi','HooksUtils','../../../../core/errors/too-many-requests.error','../../providers/web-hooks/hooks.utils','setStatus','Waiting','GitBranchNotFoundError','branchName','SalesforceSyncService','../../providers/providers.tokens','1934470xnPUrO',']\x20repository\x20','FlosumSyncJob'];a111_0x18b4=function(){return _0x29d81e;};return a111_0x18b4();}a111_0x56cee9();'use strict';var __decorate=this&&this[a111_0x354285(0x1db)]||function(_0x2062ec,_0x564a24,_0x58a1a0,_0x5270da){const _0x9d8269=a111_0x354285;var _0x247e43=arguments[_0x9d8269(0x1d8)],_0x51e909=_0x247e43<0x3?_0x564a24:_0x5270da===null?_0x5270da=Object[_0x9d8269(0x199)](_0x564a24,_0x58a1a0):_0x5270da,_0x202e21;if(typeof Reflect==='object'&&typeof Reflect[_0x9d8269(0x179)]==='function')_0x51e909=Reflect[_0x9d8269(0x179)](_0x2062ec,_0x564a24,_0x58a1a0,_0x5270da);else{for(var _0x5326d0=_0x2062ec[_0x9d8269(0x1d8)]-0x1;_0x5326d0>=0x0;_0x5326d0--)if(_0x202e21=_0x2062ec[_0x5326d0])_0x51e909=(_0x247e43<0x3?_0x202e21(_0x51e909):_0x247e43>0x3?_0x202e21(_0x564a24,_0x58a1a0,_0x51e909):_0x202e21(_0x564a24,_0x58a1a0))||_0x51e909;}return _0x247e43>0x3&&_0x51e909&&Object[_0x9d8269(0x17d)](_0x564a24,_0x58a1a0,_0x51e909),_0x51e909;},__metadata=this&&this[a111_0x354285(0x1b0)]||function(_0x22e5ed,_0x1bd059){const _0x128bac=a111_0x354285;if(typeof Reflect===_0x128bac(0x1ad)&&typeof Reflect['metadata']===_0x128bac(0x186))return Reflect['metadata'](_0x22e5ed,_0x1bd059);},SyncService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a111_0x354285(0x19c)]=void 0x0;const constants_1=require(a111_0x354285(0x1b7)),core_1=require(a111_0x354285(0x194)),too_many_requests_error_1=require(a111_0x354285(0x1cd)),flosum_repository_sync_dto_1=require(a111_0x354285(0x173)),salesforce_error_1=require(a111_0x354285(0x1c9)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a111_0x354285(0x1a2)),utils_1=require('../../../shared/utils'),typedi_1=require('typedi'),hooks_utils_1=require(a111_0x354285(0x1ce)),git_branch_not_found_error_1=require(a111_0x354285(0x1e5)),flosum_sync_job_1=require(a111_0x354285(0x19e)),git_sync_job_1=require(a111_0x354285(0x183)),providers_tokens_1=require(a111_0x354285(0x1d4)),bad_request_error_1=require(a111_0x354285(0x1bc));let SyncService=SyncService_1=class SyncService{constructor(_0x436318,_0x5da907){const _0x440d05=a111_0x354285;this[_0x440d05(0x1e4)]=_0x436318,this[_0x440d05(0x182)]=_0x5da907,this[_0x440d05(0x195)]=new core_1[(_0x440d05(0x1b6))](SyncService_1[_0x440d05(0x1e6)]),this['repositoriesIntersections']={},this['repoList']=[];}async['handleRecordSyncError'](_0x3447c5,_0x4e38f7){const _0x5efac4=a111_0x354285;if(_0x4e38f7 instanceof git_branch_not_found_error_1[_0x5efac4(0x1d1)]){await this[_0x5efac4(0x182)][_0x5efac4(0x1cf)](_0x3447c5,_0x5efac4(0x198));return;}if(_0x4e38f7 instanceof too_many_requests_error_1[_0x5efac4(0x18a)]){await this['salesforceSync']['setStatus'](_0x3447c5,_0x5efac4(0x1d0));throw _0x4e38f7;}try{await this['sfLogger']['error'](this[_0x5efac4(0x1b5)]+_0x5efac4(0x1ed)+_0x3447c5[_0x5efac4(0x193)]+_0x5efac4(0x1c8)+_0x3447c5[_0x5efac4(0x1d2)]+_0x5efac4(0x17f)+_0x4e38f7+'.')['send'](),await this[_0x5efac4(0x182)][_0x5efac4(0x1e1)](_0x3447c5,{}),await this[_0x5efac4(0x182)]['setStatus'](_0x3447c5,_0x5efac4(0x1dc));}catch(_0x515f77){if(_0x515f77 instanceof salesforce_error_1[_0x5efac4(0x1ee)])throw _0x515f77;}}async[a111_0x354285(0x1bd)](_0x16c826){const _0x30e816=a111_0x354285;if(_0x16c826['repositoryId']){const _0x899518=_0x16c826[_0x30e816(0x193)]['toLowerCase'](),_0x1f097b=this['repositoriesIntersections'][_0x899518];if(!_0x1f097b)this['repositoriesIntersections'][_0x899518]=_0x16c826[_0x30e816(0x193)];else{if(_0x1f097b&&_0x1f097b!==_0x16c826['repositoryName'])return await this['handleRecordSyncError'](_0x16c826,new Error(_0x30e816(0x18c)+_0x16c826[_0x30e816(0x193)]+_0x30e816(0x178)+_0x899518+_0x30e816(0x1ba)+_0x1f097b+'\x27')),!![];}}return![];}async[a111_0x354285(0x1b4)](_0x3b4380){const _0x15e4a0=a111_0x354285;if(!constants_1[_0x15e4a0(0x184)][_0x15e4a0(0x1ef)](_0x3b4380[_0x15e4a0(0x193)]))return await this[_0x15e4a0(0x1b1)](_0x3b4380,new Error(_0x15e4a0(0x18c)+_0x3b4380[_0x15e4a0(0x193)]+_0x15e4a0(0x1aa))),![];if(!constants_1[_0x15e4a0(0x189)]['test'](_0x3b4380[_0x15e4a0(0x1d2)]))return await this['handleRecordSyncError'](_0x3b4380,new Error(_0x15e4a0(0x1ae)+_0x3b4380['branchName']+_0x15e4a0(0x17b)+_0x3b4380['repositoryName']+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async[a111_0x354285(0x18d)](_0x366c9c,_0x461681){const _0x5c0f70=a111_0x354285;let _0xa464=this['repoList'][_0x5c0f70(0x1a9)](_0x40a3af=>_0x366c9c[_0x5c0f70(0x193)]===_0x40a3af[_0x5c0f70(0x1e6)]);!_0xa464&&(this[_0x5c0f70(0x170)][_0x5c0f70(0x1b3)](this['prefix']+_0x5c0f70(0x1a4)+_0x366c9c['repositoryName']+_0x5c0f70(0x1a1)),_0xa464=await this[_0x5c0f70(0x17e)][_0x5c0f70(0x1a0)]({'name':_0x366c9c[_0x5c0f70(0x193)],'autoInit':!![],'defaultBranch':_0x366c9c['branchName'],'private':!![],'createHook':typedi_1[_0x5c0f70(0x1ea)][_0x5c0f70(0x1c0)](providers_tokens_1['Tokens'][_0x5c0f70(0x1a3)])[_0x5c0f70(0x1a5)]}));if(this['config'][_0x5c0f70(0x1a5)]){const _0x17e1ab=await _0xa464[_0x5c0f70(0x1e9)][_0x5c0f70(0x18f)]();!_0x17e1ab[_0x5c0f70(0x1a9)](_0x469697=>_0x469697['url']===hooks_utils_1[_0x5c0f70(0x1cc)][_0x5c0f70(0x187)](this[_0x5c0f70(0x1a3)][_0x5c0f70(0x1a7)],this[_0x5c0f70(0x1a3)][_0x5c0f70(0x1df)],_0x461681))&&(this[_0x5c0f70(0x170)][_0x5c0f70(0x1b3)](this[_0x5c0f70(0x1b5)]+'\x20Repository\x20\x22'+_0x366c9c['repositoryName']+_0x5c0f70(0x185)),await _0xa464[_0x5c0f70(0x1e9)]['create'](hooks_utils_1['HooksUtils'][_0x5c0f70(0x1f0)](this[_0x5c0f70(0x1a3)][_0x5c0f70(0x1a7)],_0xa464[_0x5c0f70(0x1e9)],this['config'][_0x5c0f70(0x1df)],_0x461681)));}return this[_0x5c0f70(0x1dd)][_0x5c0f70(0x1c4)](_0xa464),_0xa464;}async[a111_0x354285(0x19f)](){const _0x320812=a111_0x354285;this[_0x320812(0x18b)]=typedi_1[_0x320812(0x1ea)][_0x320812(0x1c0)](providers_tokens_1[_0x320812(0x1ac)][_0x320812(0x18b)]),this[_0x320812(0x17e)]=typedi_1[_0x320812(0x1ea)][_0x320812(0x1c0)](providers_tokens_1[_0x320812(0x1ac)]['gitRepoService']),this[_0x320812(0x1a3)]=typedi_1[_0x320812(0x1ea)][_0x320812(0x1c0)](providers_tokens_1[_0x320812(0x1ac)]['config']),this[_0x320812(0x170)]=typedi_1[_0x320812(0x1ea)][_0x320812(0x1c0)](providers_tokens_1[_0x320812(0x1ac)][_0x320812(0x195)]),this[_0x320812(0x1b5)]='['+SyncService_1[_0x320812(0x1e6)]+_0x320812(0x191)+this[_0x320812(0x1a3)]['gitProvider']['toUpperCase']()+']',this[_0x320812(0x1e4)]['setLoggerId'](this[_0x320812(0x170)][_0x320812(0x171)]());try{this['sfLogger']['log'](this[_0x320812(0x1b5)]+_0x320812(0x1ca)),await this[_0x320812(0x170)]['log'](this[_0x320812(0x1b5)]+_0x320812(0x1a6))['send']();const _0x5c01c4=await this[_0x320812(0x182)]['getRepositoryRecords'](typedi_1['Container'][_0x320812(0x1c0)](providers_tokens_1[_0x320812(0x1ac)][_0x320812(0x19b)]));if(!_0x5c01c4[_0x320812(0x1d8)])throw new bad_request_error_1[(_0x320812(0x174))](this[_0x320812(0x1b5)]+'\x20No\x20repositories\x20to\x20sync.');await this[_0x320812(0x170)][_0x320812(0x1b3)](this[_0x320812(0x1b5)]+'\x20Getting\x20branch\x20records.')[_0x320812(0x16f)]();const _0xde76db=await this[_0x320812(0x182)]['getBranchRecords'](_0x5c01c4[_0x320812(0x1af)](_0x24c9b9=>'\x27'+_0x24c9b9[_0x320812(0x1a8)]+'\x27')['join'](','));await this['sfLogger']['log'](this[_0x320812(0x1b5)]+_0x320812(0x1e0))[_0x320812(0x16f)](),this[_0x320812(0x1dd)]=await this['repoService'][_0x320812(0x18f)]();const _0x2c8129=[..._0x5c01c4,..._0xde76db];this[_0x320812(0x170)][_0x320812(0x1b3)](this[_0x320812(0x1b5)]+_0x320812(0x1de)+_0x2c8129['length']+_0x320812(0x177));for(const _0x4a1db9 of _0x2c8129){this[_0x320812(0x195)][_0x320812(0x1b3)](_0x320812(0x1c1)+_0x4a1db9[_0x320812(0x193)]+'['+_0x4a1db9['repositoryId']+_0x320812(0x1d6)+_0x4a1db9[_0x320812(0x1d2)]+'['+_0x4a1db9[_0x320812(0x180)]+_0x320812(0x1b2)),this[_0x320812(0x170)][_0x320812(0x1b3)](this[_0x320812(0x1b5)]+_0x320812(0x1c2)+_0x4a1db9[_0x320812(0x193)]+_0x320812(0x196)+_0x4a1db9[_0x320812(0x1d2)]+'\x22.'),this['sfLogger'][_0x320812(0x1b3)](this[_0x320812(0x1b5)]+_0x320812(0x1e8));const _0x4f39f7=await this[_0x320812(0x1b4)](_0x4a1db9);if(!_0x4f39f7)continue;this['sfLogger'][_0x320812(0x1b3)](this[_0x320812(0x1b5)]+_0x320812(0x1e3));const _0x3974a9=await this[_0x320812(0x1bd)](_0x4a1db9);if(_0x3974a9)continue;await this[_0x320812(0x170)]['send']();let _0x1f7d56;try{await this[_0x320812(0x170)]['log'](this['prefix']+'\x20Getting\x20Flosum\x20repository')[_0x320812(0x16f)](),_0x1f7d56=await this[_0x320812(0x18d)](_0x4a1db9,typedi_1['Container'][_0x320812(0x1c0)](providers_tokens_1[_0x320812(0x1ac)][_0x320812(0x19b)]));}catch(_0x59c8c1){await this[_0x320812(0x1b1)](_0x4a1db9,_0x59c8c1 instanceof too_many_requests_error_1[_0x320812(0x18a)]?_0x59c8c1:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x59c8c1));continue;}await this[_0x320812(0x170)][_0x320812(0x1b3)](this[_0x320812(0x1b5)]+_0x320812(0x17c))[_0x320812(0x16f)]();if(_0x4a1db9[_0x320812(0x190)]===flosum_repository_sync_dto_1[_0x320812(0x181)][_0x320812(0x17a)]){const _0xe45883=typedi_1[_0x320812(0x1ea)][_0x320812(0x1c0)](flosum_sync_job_1[_0x320812(0x1d7)]);await _0xe45883[_0x320812(0x19f)]({'repository':_0x1f7d56,'convertToSFDX':this[_0x320812(0x1a3)]['isConvertToSfdx'],'syncRecord':_0x4a1db9,'provider':this['config'][_0x320812(0x1a7)]})[_0x320812(0x197)](_0x2cbbd2=>this['handleRecordSyncError'](_0x4a1db9,_0x2cbbd2));}else{const _0x337aec=typedi_1[_0x320812(0x1ea)][_0x320812(0x1c0)](git_sync_job_1[_0x320812(0x1c6)]);await _0x337aec[_0x320812(0x19f)]({'repository':_0x1f7d56,'branch':_0x4a1db9[_0x320812(0x1d2)],'provider':this[_0x320812(0x1a3)][_0x320812(0x1a7)],'repositoryGit':_0x1f7d56[_0x320812(0x175)],'syncRecord':_0x4a1db9})['catch'](_0x569e1e=>this[_0x320812(0x1b1)](_0x4a1db9,_0x569e1e));}}}catch(_0x1e0948){this[_0x320812(0x195)][_0x320812(0x1be)](_0x1e0948);_0x1e0948 instanceof too_many_requests_error_1[_0x320812(0x18a)]?(await this[_0x320812(0x170)][_0x320812(0x1b3)](this[_0x320812(0x1b5)]+_0x320812(0x1c3))['send'](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0x320812(0x19f)]()):await this[_0x320812(0x170)][_0x320812(0x1be)](this[_0x320812(0x1b5)]+_0x320812(0x1e7)+_0x1e0948)['send']();return;}await this[_0x320812(0x170)][_0x320812(0x1b3)](this[_0x320812(0x1b5)]+_0x320812(0x1c7))[_0x320812(0x16f)](),await this['salesforceSync'][_0x320812(0x1b9)](typedi_1[_0x320812(0x1ea)][_0x320812(0x1c0)](providers_tokens_1[_0x320812(0x1ac)][_0x320812(0x19b)]))[_0x320812(0x197)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x354285(0x188)])({'transient':!![]}),__metadata(a111_0x354285(0x1da),[salesforce_service_1[a111_0x354285(0x1c5)],salesforce_sync_service_1[a111_0x354285(0x1d3)]])],SyncService),exports[a111_0x354285(0x19c)]=SyncService;