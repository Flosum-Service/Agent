const a67_0x2a20f9=a67_0x22b4;(function(_0x3ffa0f,_0x5e70eb){const _0x3a1884=a67_0x22b4,_0x3f7221=_0x3ffa0f();while(!![]){try{const _0x5ec580=parseInt(_0x3a1884(0x12e))/0x1+-parseInt(_0x3a1884(0xd7))/0x2+-parseInt(_0x3a1884(0x119))/0x3*(parseInt(_0x3a1884(0xe2))/0x4)+-parseInt(_0x3a1884(0x11a))/0x5+-parseInt(_0x3a1884(0xb5))/0x6*(-parseInt(_0x3a1884(0x130))/0x7)+parseInt(_0x3a1884(0xcb))/0x8*(parseInt(_0x3a1884(0x128))/0x9)+-parseInt(_0x3a1884(0xc6))/0xa*(-parseInt(_0x3a1884(0xd9))/0xb);if(_0x5ec580===_0x5e70eb)break;else _0x3f7221['push'](_0x3f7221['shift']());}catch(_0x28723a){_0x3f7221['push'](_0x3f7221['shift']());}}}(a67_0x3029,0x22f54));const a67_0x529edc=(function(){let _0x44c7c6=!![];return function(_0x2b16bd,_0x4703ef){const _0x5283d9=_0x44c7c6?function(){if(_0x4703ef){const _0x4a5ab0=_0x4703ef['apply'](_0x2b16bd,arguments);return _0x4703ef=null,_0x4a5ab0;}}:function(){};return _0x44c7c6=![],_0x5283d9;};}()),a67_0x2bdbd9=a67_0x529edc(this,function(){const _0x1fc2ca=a67_0x22b4;return a67_0x2bdbd9[_0x1fc2ca(0xc7)]()[_0x1fc2ca(0xc4)](_0x1fc2ca(0xdc))[_0x1fc2ca(0xc7)]()[_0x1fc2ca(0xe3)](a67_0x2bdbd9)[_0x1fc2ca(0xc4)](_0x1fc2ca(0xdc));});a67_0x2bdbd9();'use strict';var __decorate=this&&this[a67_0x2a20f9(0xc3)]||function(_0x399d39,_0x53bde0,_0x2857ab,_0x5a8f22){const _0x4274bb=a67_0x2a20f9;var _0x5e6c29=arguments[_0x4274bb(0x11f)],_0x14ae5f=_0x5e6c29<0x3?_0x53bde0:_0x5a8f22===null?_0x5a8f22=Object['getOwnPropertyDescriptor'](_0x53bde0,_0x2857ab):_0x5a8f22,_0x3734a2;if(typeof Reflect===_0x4274bb(0x11e)&&typeof Reflect['decorate']===_0x4274bb(0xd1))_0x14ae5f=Reflect['decorate'](_0x399d39,_0x53bde0,_0x2857ab,_0x5a8f22);else{for(var _0x1e0d43=_0x399d39[_0x4274bb(0x11f)]-0x1;_0x1e0d43>=0x0;_0x1e0d43--)if(_0x3734a2=_0x399d39[_0x1e0d43])_0x14ae5f=(_0x5e6c29<0x3?_0x3734a2(_0x14ae5f):_0x5e6c29>0x3?_0x3734a2(_0x53bde0,_0x2857ab,_0x14ae5f):_0x3734a2(_0x53bde0,_0x2857ab))||_0x14ae5f;}return _0x5e6c29>0x3&&_0x14ae5f&&Object[_0x4274bb(0x103)](_0x53bde0,_0x2857ab,_0x14ae5f),_0x14ae5f;},__metadata=this&&this['__metadata']||function(_0x4556c9,_0x3febeb){const _0x557a59=a67_0x2a20f9;if(typeof Reflect===_0x557a59(0x11e)&&typeof Reflect[_0x557a59(0xd4)]===_0x557a59(0xd1))return Reflect[_0x557a59(0xd4)](_0x4556c9,_0x3febeb);},SyncService_1;Object['defineProperty'](exports,a67_0x2a20f9(0x10b),{'value':!![]}),exports[a67_0x2a20f9(0x10f)]=void 0x0;const constants_1=require(a67_0x2a20f9(0x123)),core_1=require(a67_0x2a20f9(0x115)),too_many_requests_error_1=require(a67_0x2a20f9(0x12c)),flosum_repository_sync_dto_1=require(a67_0x2a20f9(0x107)),salesforce_error_1=require(a67_0x2a20f9(0xcd)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require('../../salesforce/services/salesforce.service'),utils_1=require(a67_0x2a20f9(0xec)),typedi_1=require(a67_0x2a20f9(0xb7)),hooks_utils_1=require(a67_0x2a20f9(0x111)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require(a67_0x2a20f9(0xf2)),git_sync_job_1=require(a67_0x2a20f9(0xbd)),providers_tokens_1=require(a67_0x2a20f9(0xcf)),bad_request_error_1=require(a67_0x2a20f9(0xc1));function a67_0x3029(){const _0x19edc1=['function','repoList',']\x20branch.','metadata','FlosumSyncJob','getRepositoryRecords','570892sVKwHp','repoService','5964398ATgccP','SyncDirection','getHookLinkFor','(((.+)+)+)+$','\x20Repository\x20\x22','direction','gitUrl','gitRepoService','Container','933288pMYcCC','constructor','logger','\x27\x20in\x20repository\x20\x27','BRANCH_NAME_REGEXP','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','test','repositoryId',']\x20repository\x20','Logger','../../../shared/utils','\x20Sync\x20job\x20done.','Syncing\x20',']\x20[','SalesforceService','Error','../jobs/flosum-sync.job','log','run','\x20Completed\x20prepare\x20to\x20syncing.','checkValidNaming','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','map','\x20Getting\x20Flosum\x20repository','GitSyncJob','prefix','connectionId','getBranchRecords','name','setStatus','design:paramtypes','toLowerCase','branchName','defineProperty','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','hooks','push','../../salesforce/dto/flosum-repository-sync.dto','getLoggerId','updateRemoteState','join','__esModule','\x20Getting\x20repository\x20records.','create','Tokens','SyncService','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','../../providers/web-hooks/hooks.utils','setLoggerId','sfLogger','gitProvider','../../../../core','\x20Getting\x20branch\x20records.','branchId','catch','3OvAhXD','1290975unlZQc','isBidirectionalSynchronization',']\x20due\x20error\x20-\x20','\x20Getting\x20repositories\x20from\x20git\x20service.','object','length','find','Unable\x20to\x20synchronize\x20repository\x20\x27','FlosumToGit','../../../../constants','createHookPayload','SalesforceSyncService','repositoryName','repositoriesIntersections','9fQvPwA','isConvertToSfdx','getOrCreateRepo','handleRecordSyncError','../../../../core/errors/too-many-requests.error','\x27\x20-\x20\x27','71970FEAeis','\x20Start\x20sync\x20job.','573307Ewtyfp','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','\x20Checking\x20valid\x20name.','6jnPftb','getAll','typedi','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','applicationUrl','\x20branches.','salesforceSync','gitApiService','../jobs/git-sync.job','error','HooksUtils','\x20Syncing\x20repository:\x20\x22','../../../../core/errors/bad-request.error','isIntersects','__decorate','search','Waiting','10XPPyBc','toString','send','sleep','TooManyRequests','1792496NiYCus','salesforceService','../../salesforce/errors/salesforce.error','config','../../providers/providers.tokens','get'];a67_0x3029=function(){return _0x19edc1;};return a67_0x3029();}function a67_0x22b4(_0x130ae2,_0x5e1c38){const _0x3b41fc=a67_0x3029();return a67_0x22b4=function(_0x2bdbd9,_0x529edc){_0x2bdbd9=_0x2bdbd9-0xb2;let _0x3029f4=_0x3b41fc[_0x2bdbd9];return _0x3029f4;},a67_0x22b4(_0x130ae2,_0x5e1c38);}let SyncService=SyncService_1=class SyncService{constructor(_0x3d5225,_0x49e1c2){const _0x2ddca4=a67_0x2a20f9;this['salesforceService']=_0x3d5225,this[_0x2ddca4(0xbb)]=_0x49e1c2,this['logger']=new core_1[(_0x2ddca4(0xeb))](SyncService_1['name']),this[_0x2ddca4(0x127)]={},this[_0x2ddca4(0xd2)]=[];}async[a67_0x2a20f9(0x12b)](_0x328d2d,_0x58725f){const _0x5b611d=a67_0x2a20f9;if(_0x58725f instanceof git_branch_not_found_error_1['GitBranchNotFoundError']){await this[_0x5b611d(0xbb)][_0x5b611d(0xff)](_0x328d2d,'Not\x20Synchronized');return;}if(_0x58725f instanceof too_many_requests_error_1[_0x5b611d(0xca)]){await this[_0x5b611d(0xbb)][_0x5b611d(0xff)](_0x328d2d,_0x5b611d(0xc5));throw _0x58725f;}try{await this['sfLogger'][_0x5b611d(0xbe)](this[_0x5b611d(0xfb)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x328d2d['repositoryName']+'\x27\x20['+_0x328d2d[_0x5b611d(0x102)]+_0x5b611d(0x11c)+_0x58725f+'.')[_0x5b611d(0xc8)](),await this[_0x5b611d(0xbb)][_0x5b611d(0x109)](_0x328d2d,{}),await this[_0x5b611d(0xbb)][_0x5b611d(0xff)](_0x328d2d,_0x5b611d(0xf1));}catch(_0x386a67){if(_0x386a67 instanceof salesforce_error_1['SalesforceError'])throw _0x386a67;}}async['isIntersects'](_0x10bc03){const _0x1e3019=a67_0x2a20f9;if(_0x10bc03[_0x1e3019(0xe9)]){const _0x561583=_0x10bc03[_0x1e3019(0x126)][_0x1e3019(0x101)](),_0x33e4ea=this[_0x1e3019(0x127)][_0x561583];if(!_0x33e4ea)this[_0x1e3019(0x127)][_0x561583]=_0x10bc03[_0x1e3019(0x126)];else{if(_0x33e4ea&&_0x33e4ea!==_0x10bc03['repositoryName'])return await this[_0x1e3019(0x12b)](_0x10bc03,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x10bc03['repositoryName']+_0x1e3019(0x110)+_0x561583+_0x1e3019(0x12d)+_0x33e4ea+'\x27')),!![];}}return![];}async[a67_0x2a20f9(0xf6)](_0x5ee23c){const _0x1bc02d=a67_0x2a20f9;if(!constants_1['REPOSITORY_NAME_REGEXP'][_0x1bc02d(0xe8)](_0x5ee23c[_0x1bc02d(0x126)]))return await this[_0x1bc02d(0x12b)](_0x5ee23c,new Error(_0x1bc02d(0x121)+_0x5ee23c['repositoryName']+_0x1bc02d(0xb8))),![];if(!constants_1[_0x1bc02d(0xe6)][_0x1bc02d(0xe8)](_0x5ee23c[_0x1bc02d(0x102)]))return await this['handleRecordSyncError'](_0x5ee23c,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x5ee23c[_0x1bc02d(0x102)]+_0x1bc02d(0xe5)+_0x5ee23c[_0x1bc02d(0x126)]+_0x1bc02d(0xb3))),![];return!![];}async[a67_0x2a20f9(0x12a)](_0xeebd37,_0x3ee3b5){const _0x3acd9c=a67_0x2a20f9;let _0x21f978=this[_0x3acd9c(0xd2)][_0x3acd9c(0x120)](_0xeb39d=>_0xeebd37[_0x3acd9c(0x126)]===_0xeb39d[_0x3acd9c(0xfe)]);!_0x21f978&&(this[_0x3acd9c(0x113)][_0x3acd9c(0xf3)](this[_0x3acd9c(0xfb)]+_0x3acd9c(0xdd)+_0xeebd37[_0x3acd9c(0x126)]+_0x3acd9c(0xe7)),_0x21f978=await this[_0x3acd9c(0xd8)][_0x3acd9c(0x10d)]({'name':_0xeebd37[_0x3acd9c(0x126)],'autoInit':!![],'defaultBranch':_0xeebd37[_0x3acd9c(0x102)],'private':!![],'createHook':typedi_1['Container'][_0x3acd9c(0xd0)](providers_tokens_1[_0x3acd9c(0x10e)][_0x3acd9c(0xce)])[_0x3acd9c(0x11b)]}));if(this[_0x3acd9c(0xce)][_0x3acd9c(0x11b)]){const _0x254ef3=await _0x21f978[_0x3acd9c(0x105)][_0x3acd9c(0xb6)]();!_0x254ef3['find'](_0x268a5f=>_0x268a5f['url']===hooks_utils_1[_0x3acd9c(0xbf)][_0x3acd9c(0xdb)](this[_0x3acd9c(0xce)][_0x3acd9c(0x114)],this['config'][_0x3acd9c(0xb9)],_0x3ee3b5))&&(this[_0x3acd9c(0x113)][_0x3acd9c(0xf3)](this[_0x3acd9c(0xfb)]+_0x3acd9c(0xdd)+_0xeebd37[_0x3acd9c(0x126)]+_0x3acd9c(0xb2)),await _0x21f978[_0x3acd9c(0x105)][_0x3acd9c(0x10d)](hooks_utils_1['HooksUtils'][_0x3acd9c(0x124)](this['config'][_0x3acd9c(0x114)],_0x21f978[_0x3acd9c(0x105)],this[_0x3acd9c(0xce)][_0x3acd9c(0xb9)],_0x3ee3b5)));}return this[_0x3acd9c(0xd2)][_0x3acd9c(0x106)](_0x21f978),_0x21f978;}async[a67_0x2a20f9(0xf4)](){const _0x11dd5d=a67_0x2a20f9;this[_0x11dd5d(0xbc)]=typedi_1['Container'][_0x11dd5d(0xd0)](providers_tokens_1[_0x11dd5d(0x10e)][_0x11dd5d(0xbc)]),this['repoService']=typedi_1['Container'][_0x11dd5d(0xd0)](providers_tokens_1[_0x11dd5d(0x10e)][_0x11dd5d(0xe0)]),this['config']=typedi_1[_0x11dd5d(0xe1)][_0x11dd5d(0xd0)](providers_tokens_1[_0x11dd5d(0x10e)]['config']),this[_0x11dd5d(0x113)]=typedi_1[_0x11dd5d(0xe1)][_0x11dd5d(0xd0)](providers_tokens_1[_0x11dd5d(0x10e)][_0x11dd5d(0xe4)]),this[_0x11dd5d(0xfb)]='['+SyncService_1[_0x11dd5d(0xfe)]+_0x11dd5d(0xef)+this[_0x11dd5d(0xce)][_0x11dd5d(0x114)]['toUpperCase']()+']',this[_0x11dd5d(0xcc)][_0x11dd5d(0x112)](this['sfLogger'][_0x11dd5d(0x108)]());try{this[_0x11dd5d(0x113)][_0x11dd5d(0xf3)](this[_0x11dd5d(0xfb)]+_0x11dd5d(0x12f)),await this[_0x11dd5d(0x113)][_0x11dd5d(0xf3)](this[_0x11dd5d(0xfb)]+_0x11dd5d(0x10c))[_0x11dd5d(0xc8)]();const _0x339968=await this[_0x11dd5d(0xbb)][_0x11dd5d(0xd6)](typedi_1[_0x11dd5d(0xe1)][_0x11dd5d(0xd0)](providers_tokens_1['Tokens'][_0x11dd5d(0xfc)]));if(!_0x339968['length'])throw new bad_request_error_1['BadRequestError'](this[_0x11dd5d(0xfb)]+'\x20No\x20repositories\x20to\x20sync.');await this[_0x11dd5d(0x113)]['log'](this['prefix']+_0x11dd5d(0x116))[_0x11dd5d(0xc8)]();const _0x2140a9=await this[_0x11dd5d(0xbb)][_0x11dd5d(0xfd)](_0x339968[_0x11dd5d(0xf8)](_0x12ebef=>'\x27'+_0x12ebef['repositoryId']+'\x27')[_0x11dd5d(0x10a)](','));await this[_0x11dd5d(0x113)][_0x11dd5d(0xf3)](this[_0x11dd5d(0xfb)]+_0x11dd5d(0x11d))['send'](),this[_0x11dd5d(0xd2)]=await this[_0x11dd5d(0xd8)][_0x11dd5d(0xb6)]();const _0x3aea8c=[..._0x339968,..._0x2140a9];this['sfLogger']['log'](this[_0x11dd5d(0xfb)]+'\x20Have\x20to\x20synchronize\x20'+_0x3aea8c[_0x11dd5d(0x11f)]+_0x11dd5d(0xba));for(const _0x2b8a5b of _0x3aea8c){this[_0x11dd5d(0xe4)][_0x11dd5d(0xf3)](_0x11dd5d(0xee)+_0x2b8a5b['repositoryName']+'['+_0x2b8a5b[_0x11dd5d(0xe9)]+_0x11dd5d(0xea)+_0x2b8a5b[_0x11dd5d(0x102)]+'['+_0x2b8a5b[_0x11dd5d(0x117)]+_0x11dd5d(0xd3)),this[_0x11dd5d(0x113)]['log'](this[_0x11dd5d(0xfb)]+_0x11dd5d(0xc0)+_0x2b8a5b['repositoryName']+'\x22\x20branch:\x20\x22'+_0x2b8a5b['branchName']+'\x22.'),this['sfLogger'][_0x11dd5d(0xf3)](this[_0x11dd5d(0xfb)]+_0x11dd5d(0xb4));const _0x343205=await this['checkValidNaming'](_0x2b8a5b);if(!_0x343205)continue;this[_0x11dd5d(0x113)]['log'](this[_0x11dd5d(0xfb)]+'\x20Checking\x20intersects.');const _0x1011bf=await this[_0x11dd5d(0xc2)](_0x2b8a5b);if(_0x1011bf)continue;await this[_0x11dd5d(0x113)][_0x11dd5d(0xc8)]();let _0x2267f7;try{await this[_0x11dd5d(0x113)]['log'](this['prefix']+_0x11dd5d(0xf9))[_0x11dd5d(0xc8)](),_0x2267f7=await this[_0x11dd5d(0x12a)](_0x2b8a5b,typedi_1[_0x11dd5d(0xe1)][_0x11dd5d(0xd0)](providers_tokens_1[_0x11dd5d(0x10e)][_0x11dd5d(0xfc)]));}catch(_0x104360){await this['handleRecordSyncError'](_0x2b8a5b,_0x104360 instanceof too_many_requests_error_1[_0x11dd5d(0xca)]?_0x104360:new Error(_0x11dd5d(0x104)+_0x104360));continue;}await this[_0x11dd5d(0x113)][_0x11dd5d(0xf3)](this['prefix']+_0x11dd5d(0xf5))['send']();if(_0x2b8a5b[_0x11dd5d(0xde)]===flosum_repository_sync_dto_1[_0x11dd5d(0xda)][_0x11dd5d(0x122)]){const _0x2dec42=typedi_1[_0x11dd5d(0xe1)][_0x11dd5d(0xd0)](flosum_sync_job_1[_0x11dd5d(0xd5)]);await _0x2dec42[_0x11dd5d(0xf4)]({'repository':_0x2267f7,'convertToSFDX':this[_0x11dd5d(0xce)][_0x11dd5d(0x129)],'syncRecord':_0x2b8a5b,'provider':this['config'][_0x11dd5d(0x114)]})[_0x11dd5d(0x118)](_0x296917=>this[_0x11dd5d(0x12b)](_0x2b8a5b,_0x296917));}else{const _0x317e76=typedi_1[_0x11dd5d(0xe1)][_0x11dd5d(0xd0)](git_sync_job_1[_0x11dd5d(0xfa)]);await _0x317e76[_0x11dd5d(0xf4)]({'repository':_0x2267f7,'branch':_0x2b8a5b[_0x11dd5d(0x102)],'provider':this[_0x11dd5d(0xce)][_0x11dd5d(0x114)],'repositoryGit':_0x2267f7[_0x11dd5d(0xdf)],'syncRecord':_0x2b8a5b})[_0x11dd5d(0x118)](_0x114d9f=>this[_0x11dd5d(0x12b)](_0x2b8a5b,_0x114d9f));}}}catch(_0x2800f7){this[_0x11dd5d(0xe4)]['error'](_0x2800f7);_0x2800f7 instanceof too_many_requests_error_1[_0x11dd5d(0xca)]?(await this[_0x11dd5d(0x113)][_0x11dd5d(0xf3)](this[_0x11dd5d(0xfb)]+_0x11dd5d(0xf7))[_0x11dd5d(0xc8)](),await utils_1[_0x11dd5d(0xc9)](0x3c*0x3c*0x3e8),this[_0x11dd5d(0xf4)]()):await this[_0x11dd5d(0x113)][_0x11dd5d(0xbe)](this['prefix']+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x2800f7)[_0x11dd5d(0xc8)]();return;}await this['sfLogger'][_0x11dd5d(0xf3)](this['prefix']+_0x11dd5d(0xed))['send'](),await this[_0x11dd5d(0xbb)]['disableSync'](typedi_1[_0x11dd5d(0xe1)][_0x11dd5d(0xd0)](providers_tokens_1[_0x11dd5d(0x10e)][_0x11dd5d(0xfc)]))[_0x11dd5d(0x118)](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a67_0x2a20f9(0x100),[salesforce_service_1[a67_0x2a20f9(0xf0)],salesforce_sync_service_1[a67_0x2a20f9(0x125)]])],SyncService),exports[a67_0x2a20f9(0x10f)]=SyncService;