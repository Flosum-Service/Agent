const a80_0xd025c9=a80_0x66e6;(function(_0x5194a5,_0x16118c){const _0x72dd7f=a80_0x66e6,_0x1168e1=_0x5194a5();while(!![]){try{const _0x357833=-parseInt(_0x72dd7f(0xcd))/0x1*(-parseInt(_0x72dd7f(0x116))/0x2)+-parseInt(_0x72dd7f(0x100))/0x3*(parseInt(_0x72dd7f(0xd0))/0x4)+-parseInt(_0x72dd7f(0xc5))/0x5*(parseInt(_0x72dd7f(0x125))/0x6)+parseInt(_0x72dd7f(0x114))/0x7*(-parseInt(_0x72dd7f(0x131))/0x8)+-parseInt(_0x72dd7f(0xf0))/0x9+parseInt(_0x72dd7f(0xc7))/0xa*(-parseInt(_0x72dd7f(0xf9))/0xb)+parseInt(_0x72dd7f(0x11b))/0xc;if(_0x357833===_0x16118c)break;else _0x1168e1['push'](_0x1168e1['shift']());}catch(_0x201635){_0x1168e1['push'](_0x1168e1['shift']());}}}(a80_0x3d6b,0xc1d03));const a80_0x2665cd=(function(){let _0xae8637=!![];return function(_0x194d35,_0x365144){const _0x114107=_0xae8637?function(){const _0x3f40a2=a80_0x66e6;if(_0x365144){const _0x4f20b2=_0x365144[_0x3f40a2(0x112)](_0x194d35,arguments);return _0x365144=null,_0x4f20b2;}}:function(){};return _0xae8637=![],_0x114107;};}()),a80_0xe1bac5=a80_0x2665cd(this,function(){const _0x4e06b6=a80_0x66e6;return a80_0xe1bac5[_0x4e06b6(0x105)]()['search'](_0x4e06b6(0x113))[_0x4e06b6(0x105)]()[_0x4e06b6(0xe3)](a80_0xe1bac5)['search']('(((.+)+)+)+$');});a80_0xe1bac5();function a80_0x66e6(_0x16f817,_0x4e2bfd){const _0x17df05=a80_0x3d6b();return a80_0x66e6=function(_0xe1bac5,_0x2665cd){_0xe1bac5=_0xe1bac5-0xb5;let _0x3d6b6a=_0x17df05[_0xe1bac5];return _0x3d6b6a;},a80_0x66e6(_0x16f817,_0x4e2bfd);}'use strict';var __decorate=this&&this[a80_0xd025c9(0xfe)]||function(_0x20f7a2,_0xe2da31,_0x369d0a,_0x3c3a89){const _0x1bd044=a80_0xd025c9;var _0x2b3bef=arguments[_0x1bd044(0x130)],_0x5529f6=_0x2b3bef<0x3?_0xe2da31:_0x3c3a89===null?_0x3c3a89=Object[_0x1bd044(0xbf)](_0xe2da31,_0x369d0a):_0x3c3a89,_0x37cbc5;if(typeof Reflect==='object'&&typeof Reflect[_0x1bd044(0x10f)]===_0x1bd044(0x118))_0x5529f6=Reflect[_0x1bd044(0x10f)](_0x20f7a2,_0xe2da31,_0x369d0a,_0x3c3a89);else{for(var _0x1f9b05=_0x20f7a2[_0x1bd044(0x130)]-0x1;_0x1f9b05>=0x0;_0x1f9b05--)if(_0x37cbc5=_0x20f7a2[_0x1f9b05])_0x5529f6=(_0x2b3bef<0x3?_0x37cbc5(_0x5529f6):_0x2b3bef>0x3?_0x37cbc5(_0xe2da31,_0x369d0a,_0x5529f6):_0x37cbc5(_0xe2da31,_0x369d0a))||_0x5529f6;}return _0x2b3bef>0x3&&_0x5529f6&&Object['defineProperty'](_0xe2da31,_0x369d0a,_0x5529f6),_0x5529f6;},__metadata=this&&this['__metadata']||function(_0x5a4db4,_0x37b351){const _0x2c4aff=a80_0xd025c9;if(typeof Reflect==='object'&&typeof Reflect[_0x2c4aff(0xd2)]===_0x2c4aff(0x118))return Reflect[_0x2c4aff(0xd2)](_0x5a4db4,_0x37b351);},SyncService_1;Object[a80_0xd025c9(0x11d)](exports,a80_0xd025c9(0x120),{'value':!![]}),exports[a80_0xd025c9(0xdc)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a80_0xd025c9(0x123)),too_many_requests_error_1=require(a80_0xd025c9(0x12a)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require(a80_0xd025c9(0xe0)),salesforce_sync_service_1=require(a80_0xd025c9(0x10a)),salesforce_service_1=require(a80_0xd025c9(0xc0)),utils_1=require(a80_0xd025c9(0xdf)),typedi_1=require(a80_0xd025c9(0xf6)),hooks_utils_1=require(a80_0xd025c9(0x11a)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require(a80_0xd025c9(0xb5)),git_sync_job_1=require(a80_0xd025c9(0xc3)),providers_tokens_1=require('../../providers/providers.tokens'),bad_request_error_1=require(a80_0xd025c9(0xf5));let SyncService=SyncService_1=class SyncService{constructor(_0x58cc58,_0x4f62ca){const _0x2785f8=a80_0xd025c9;this[_0x2785f8(0x10c)]=_0x58cc58,this[_0x2785f8(0x110)]=_0x4f62ca,this['logger']=new core_1[(_0x2785f8(0xc8))](SyncService_1[_0x2785f8(0x111)]),this['repositoriesIntersections']={},this['repoList']=[];}async['handleRecordSyncError'](_0x5c0430,_0x3346b7){const _0xa8f847=a80_0xd025c9;if(_0x3346b7 instanceof git_branch_not_found_error_1[_0xa8f847(0x119)]){await this['salesforceSync']['setStatus'](_0x5c0430,_0xa8f847(0xe7));return;}if(_0x3346b7 instanceof too_many_requests_error_1[_0xa8f847(0xde)]){await this[_0xa8f847(0x110)][_0xa8f847(0x108)](_0x5c0430,_0xa8f847(0x101));throw _0x3346b7;}try{await this[_0xa8f847(0xb6)][_0xa8f847(0xfd)](this[_0xa8f847(0x106)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x5c0430[_0xa8f847(0xf7)]+'\x27\x20['+_0x5c0430[_0xa8f847(0xb7)]+_0xa8f847(0xe9)+_0x3346b7+'.')[_0xa8f847(0x128)](),await this[_0xa8f847(0x110)]['updateRemoteState'](_0x5c0430,{}),await this[_0xa8f847(0x110)][_0xa8f847(0x108)](_0x5c0430,'Error');}catch(_0x2a21af){if(_0x2a21af instanceof salesforce_error_1[_0xa8f847(0xcb)])throw _0x2a21af;}}async[a80_0xd025c9(0xc9)](_0x53ed99){const _0x1de358=a80_0xd025c9;if(_0x53ed99['repositoryId']){const _0x429864=_0x53ed99['repositoryName'][_0x1de358(0xc4)](),_0x1e839b=this['repositoriesIntersections'][_0x429864];if(!_0x1e839b)this['repositoriesIntersections'][_0x429864]=_0x53ed99['repositoryName'];else{if(_0x1e839b&&_0x1e839b!==_0x53ed99['repositoryName'])return await this[_0x1de358(0x11c)](_0x53ed99,new Error(_0x1de358(0xbe)+_0x53ed99[_0x1de358(0xf7)]+_0x1de358(0xfa)+_0x429864+_0x1de358(0xf2)+_0x1e839b+'\x27')),!![];}}return![];}async[a80_0xd025c9(0x121)](_0x1a115a){const _0x5dabda=a80_0xd025c9;if(!constants_1[_0x5dabda(0x12d)]['test'](_0x1a115a[_0x5dabda(0xf7)]))return await this[_0x5dabda(0x11c)](_0x1a115a,new Error(_0x5dabda(0xbe)+_0x1a115a[_0x5dabda(0xf7)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x5dabda(0xe8)][_0x5dabda(0x11e)](_0x1a115a[_0x5dabda(0xb7)]))return await this[_0x5dabda(0x11c)](_0x1a115a,new Error(_0x5dabda(0xb9)+_0x1a115a[_0x5dabda(0xb7)]+_0x5dabda(0x12e)+_0x1a115a[_0x5dabda(0xf7)]+_0x5dabda(0xf8))),![];return!![];}async[a80_0xd025c9(0x124)](_0x338a15,_0x25afb0){const _0x88302e=a80_0xd025c9;let _0x39b128=this[_0x88302e(0xcf)][_0x88302e(0x115)](_0x57eb4a=>_0x338a15[_0x88302e(0xf7)]===_0x57eb4a[_0x88302e(0x111)]);!_0x39b128&&(this[_0x88302e(0xb6)][_0x88302e(0xf1)](this[_0x88302e(0x106)]+_0x88302e(0x107)+_0x338a15[_0x88302e(0xf7)]+_0x88302e(0xe4)),_0x39b128=await this[_0x88302e(0x132)]['create']({'name':_0x338a15[_0x88302e(0xf7)],'autoInit':!![],'defaultBranch':_0x338a15['branchName'],'private':!![],'createHook':typedi_1['Container'][_0x88302e(0xec)](providers_tokens_1['Tokens']['config'])['isBidirectionalSynchronization']}));if(this[_0x88302e(0xe5)][_0x88302e(0xf4)]){const _0x30b82d=await _0x39b128[_0x88302e(0xdb)][_0x88302e(0x126)]();!_0x30b82d['find'](_0x1e802f=>_0x1e802f[_0x88302e(0x117)]===hooks_utils_1[_0x88302e(0xe2)][_0x88302e(0x103)](this[_0x88302e(0xe5)][_0x88302e(0xbb)],this[_0x88302e(0xe5)]['applicationUrl'],_0x25afb0))&&(this[_0x88302e(0xb6)]['log'](this[_0x88302e(0x106)]+_0x88302e(0x107)+_0x338a15['repositoryName']+_0x88302e(0x11f)),await _0x39b128[_0x88302e(0xdb)][_0x88302e(0x10d)](hooks_utils_1[_0x88302e(0xe2)][_0x88302e(0xed)](this[_0x88302e(0xe5)][_0x88302e(0xbb)],_0x39b128[_0x88302e(0xdb)],this['config']['applicationUrl'],_0x25afb0)));}return this[_0x88302e(0xcf)][_0x88302e(0xd8)](_0x39b128),_0x39b128;}async[a80_0xd025c9(0xef)](){const _0x114439=a80_0xd025c9;this[_0x114439(0xc6)]=typedi_1[_0x114439(0x10b)]['get'](providers_tokens_1['Tokens'][_0x114439(0xc6)]),this[_0x114439(0x132)]=typedi_1[_0x114439(0x10b)][_0x114439(0xec)](providers_tokens_1[_0x114439(0xfb)][_0x114439(0xcc)]),this[_0x114439(0xe5)]=typedi_1[_0x114439(0x10b)][_0x114439(0xec)](providers_tokens_1[_0x114439(0xfb)][_0x114439(0xe5)]),this[_0x114439(0xb6)]=typedi_1[_0x114439(0x10b)][_0x114439(0xec)](providers_tokens_1['Tokens'][_0x114439(0xd6)]),this['prefix']='['+SyncService_1[_0x114439(0x111)]+_0x114439(0xd4)+this[_0x114439(0xe5)][_0x114439(0xbb)][_0x114439(0x10e)]()+']',this[_0x114439(0x10c)][_0x114439(0x12c)](this[_0x114439(0xb6)][_0x114439(0xee)]());try{this['sfLogger'][_0x114439(0xf1)](this[_0x114439(0x106)]+'\x20Start\x20sync\x20job.'),await this['sfLogger'][_0x114439(0xf1)](this[_0x114439(0x106)]+_0x114439(0x122))[_0x114439(0x128)]();const _0x4789dd=await this['salesforceSync'][_0x114439(0x102)](typedi_1[_0x114439(0x10b)]['get'](providers_tokens_1[_0x114439(0xfb)]['connectionId']));if(!_0x4789dd[_0x114439(0x130)])throw new bad_request_error_1[(_0x114439(0xea))](this[_0x114439(0x106)]+'\x20No\x20repositories\x20to\x20sync.');await this['sfLogger'][_0x114439(0xf1)](this[_0x114439(0x106)]+'\x20Getting\x20branch\x20records.')['send']();const _0x2cc2b9=await this['salesforceSync'][_0x114439(0x104)](_0x4789dd[_0x114439(0xce)](_0x5d5f3c=>'\x27'+_0x5d5f3c[_0x114439(0xd3)]+'\x27')['join'](','));await this['sfLogger'][_0x114439(0xf1)](this[_0x114439(0x106)]+_0x114439(0x12b))[_0x114439(0x128)](),this[_0x114439(0xcf)]=await this[_0x114439(0x132)][_0x114439(0x126)]();const _0x1f8735=[..._0x4789dd,..._0x2cc2b9];this[_0x114439(0xb6)]['log'](this[_0x114439(0x106)]+_0x114439(0xeb)+_0x1f8735[_0x114439(0x130)]+'\x20branches.');for(const _0x35e35a of _0x1f8735){this['logger']['log']('Syncing\x20'+_0x35e35a[_0x114439(0xf7)]+'['+_0x35e35a[_0x114439(0xd3)]+_0x114439(0xca)+_0x35e35a[_0x114439(0xb7)]+'['+_0x35e35a[_0x114439(0xc2)]+']\x20branch.'),this[_0x114439(0xb6)][_0x114439(0xf1)](this['prefix']+_0x114439(0xdd)+_0x35e35a[_0x114439(0xf7)]+'\x22\x20branch:\x20\x22'+_0x35e35a[_0x114439(0xb7)]+'\x22.'),this[_0x114439(0xb6)]['log'](this[_0x114439(0x106)]+_0x114439(0xd7));const _0x5e924d=await this[_0x114439(0x121)](_0x35e35a);if(!_0x5e924d)continue;this[_0x114439(0xb6)]['log'](this[_0x114439(0x106)]+'\x20Checking\x20intersects.');const _0x3191d6=await this['isIntersects'](_0x35e35a);if(_0x3191d6)continue;await this['sfLogger'][_0x114439(0x128)]();let _0x217a7a;try{await this[_0x114439(0xb6)][_0x114439(0xf1)](this[_0x114439(0x106)]+'\x20Getting\x20Flosum\x20repository')[_0x114439(0x128)](),_0x217a7a=await this['getOrCreateRepo'](_0x35e35a,typedi_1[_0x114439(0x10b)][_0x114439(0xec)](providers_tokens_1['Tokens'][_0x114439(0xd5)]));}catch(_0x12a92d){await this[_0x114439(0x11c)](_0x35e35a,_0x12a92d instanceof too_many_requests_error_1[_0x114439(0xde)]?_0x12a92d:new Error(_0x114439(0xe1)+_0x12a92d));continue;}await this['sfLogger']['log'](this['prefix']+_0x114439(0xff))[_0x114439(0x128)]();if(_0x35e35a[_0x114439(0xfc)]===flosum_repository_sync_dto_1['SyncDirection'][_0x114439(0xf3)]){const _0x1a9f9e=typedi_1[_0x114439(0x10b)][_0x114439(0xec)](flosum_sync_job_1[_0x114439(0xba)]);await _0x1a9f9e[_0x114439(0xef)]({'repository':_0x217a7a,'convertToSFDX':this[_0x114439(0xe5)][_0x114439(0x129)],'syncRecord':_0x35e35a,'provider':this['config']['gitProvider']})[_0x114439(0xe6)](_0x270949=>this['handleRecordSyncError'](_0x35e35a,_0x270949));}else{const _0x343bf0=typedi_1[_0x114439(0x10b)][_0x114439(0xec)](git_sync_job_1[_0x114439(0xd9)]);await _0x343bf0['run']({'repository':_0x217a7a,'branch':_0x35e35a[_0x114439(0xb7)],'provider':this[_0x114439(0xe5)][_0x114439(0xbb)],'repositoryGit':_0x217a7a['gitUrl'],'syncRecord':_0x35e35a})[_0x114439(0xe6)](_0xe76677=>this[_0x114439(0x11c)](_0x35e35a,_0xe76677));}}}catch(_0x43fcd8){this[_0x114439(0xd6)]['error'](_0x43fcd8);_0x43fcd8 instanceof too_many_requests_error_1[_0x114439(0xde)]?(await this[_0x114439(0xb6)][_0x114439(0xf1)](this[_0x114439(0x106)]+_0x114439(0x109))[_0x114439(0x128)](),await(0x0,utils_1[_0x114439(0xb8)])(0x3c*0x3c*0x3e8),this[_0x114439(0xef)]()):await this[_0x114439(0xb6)]['error'](this[_0x114439(0x106)]+_0x114439(0xda)+_0x43fcd8)[_0x114439(0x128)]();return;}await this[_0x114439(0xb6)][_0x114439(0xf1)](this[_0x114439(0x106)]+_0x114439(0x127))[_0x114439(0x128)](),await this[_0x114439(0x110)][_0x114439(0xc1)](typedi_1[_0x114439(0x10b)][_0x114439(0xec)](providers_tokens_1[_0x114439(0xfb)][_0x114439(0xd5)]))[_0x114439(0xe6)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a80_0xd025c9(0xbc)])({'transient':!![]}),__metadata(a80_0xd025c9(0x12f),[salesforce_service_1[a80_0xd025c9(0xbd)],salesforce_sync_service_1[a80_0xd025c9(0xd1)]])],SyncService),exports[a80_0xd025c9(0xdc)]=SyncService;function a80_0x3d6b(){const _0x62bdc8=['getRepositoryRecords','getHookLinkFor','getBranchRecords','toString','prefix','\x20Repository\x20\x22','setStatus','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','../../salesforce/services/salesforce-sync.service','Container','salesforceService','create','toUpperCase','decorate','salesforceSync','name','apply','(((.+)+)+)+$','14KyCtHe','find','562jCalhh','url','function','GitBranchNotFoundError','../../providers/web-hooks/hooks.utils','53354676YaAMVn','handleRecordSyncError','defineProperty','test','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','__esModule','checkValidNaming','\x20Getting\x20repository\x20records.','../../../../core','getOrCreateRepo','457032AdzjFe','getAll','\x20Sync\x20job\x20done.','send','isConvertToSfdx','../../../../core/errors/too-many-requests.error','\x20Getting\x20repositories\x20from\x20git\x20service.','setLoggerId','REPOSITORY_NAME_REGEXP','\x27\x20in\x20repository\x20\x27','design:paramtypes','length','1009208PoPoCn','repoService','../jobs/flosum-sync.job','sfLogger','branchName','sleep','Unable\x20to\x20synchronize\x20branch\x20\x27','FlosumSyncJob','gitProvider','Service','SalesforceService','Unable\x20to\x20synchronize\x20repository\x20\x27','getOwnPropertyDescriptor','../../salesforce/services/salesforce.service','disableSync','branchId','../jobs/git-sync.job','toLowerCase','80PHRwEG','gitApiService','8378530aXRbGF','Logger','isIntersects',']\x20repository\x20','SalesforceError','gitRepoService','2642pBlVTL','map','repoList','14460rlrxfL','SalesforceSyncService','metadata','repositoryId',']\x20[','connectionId','logger','\x20Checking\x20valid\x20name.','push','GitSyncJob','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','hooks','SyncService','\x20Syncing\x20repository:\x20\x22','TooManyRequests','../../../shared/utils','../../salesforce/errors/salesforce.error','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','HooksUtils','constructor','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','config','catch','Not\x20Synchronized','BRANCH_NAME_REGEXP',']\x20due\x20error\x20-\x20','BadRequestError','\x20Have\x20to\x20synchronize\x20','get','createHookPayload','getLoggerId','run','5173101YPHLor','log','\x27\x20-\x20\x27','FlosumToGit','isBidirectionalSynchronization','../../../../core/errors/bad-request.error','typedi','repositoryName','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','11LbNvTF','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','Tokens','direction','error','__decorate','\x20Completed\x20prepare\x20to\x20syncing.','1254cLOTHi','Waiting'];a80_0x3d6b=function(){return _0x62bdc8;};return a80_0x3d6b();}