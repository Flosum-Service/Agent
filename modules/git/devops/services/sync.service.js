const a80_0x2413c6=a80_0x1f99;(function(_0x4dd9e2,_0x312a2a){const _0x5f1aed=a80_0x1f99,_0x504ac8=_0x4dd9e2();while(!![]){try{const _0x1592bd=parseInt(_0x5f1aed(0x1a4))/0x1*(-parseInt(_0x5f1aed(0x1e7))/0x2)+-parseInt(_0x5f1aed(0x1b4))/0x3+-parseInt(_0x5f1aed(0x1c0))/0x4+parseInt(_0x5f1aed(0x197))/0x5+parseInt(_0x5f1aed(0x1ab))/0x6*(parseInt(_0x5f1aed(0x1df))/0x7)+-parseInt(_0x5f1aed(0x1d8))/0x8*(-parseInt(_0x5f1aed(0x1bf))/0x9)+-parseInt(_0x5f1aed(0x1db))/0xa*(-parseInt(_0x5f1aed(0x193))/0xb);if(_0x1592bd===_0x312a2a)break;else _0x504ac8['push'](_0x504ac8['shift']());}catch(_0x2866f6){_0x504ac8['push'](_0x504ac8['shift']());}}}(a80_0x3b32,0x646e8));const a80_0xaafff=(function(){let _0x5e0167=!![];return function(_0x212a47,_0x51e5c2){const _0x3ff623=_0x5e0167?function(){if(_0x51e5c2){const _0x4f4e5e=_0x51e5c2['apply'](_0x212a47,arguments);return _0x51e5c2=null,_0x4f4e5e;}}:function(){};return _0x5e0167=![],_0x3ff623;};}()),a80_0x35adca=a80_0xaafff(this,function(){const _0x41add1=a80_0x1f99;return a80_0x35adca[_0x41add1(0x1da)]()['search'](_0x41add1(0x1a2))[_0x41add1(0x1da)]()[_0x41add1(0x187)](a80_0x35adca)['search'](_0x41add1(0x1a2));});a80_0x35adca();'use strict';function a80_0x1f99(_0x53231a,_0x1e45ef){const _0x3f0607=a80_0x3b32();return a80_0x1f99=function(_0x35adca,_0xaafff){_0x35adca=_0x35adca-0x186;let _0x3b32c2=_0x3f0607[_0x35adca];return _0x3b32c2;},a80_0x1f99(_0x53231a,_0x1e45ef);}var __decorate=this&&this[a80_0x2413c6(0x1fe)]||function(_0x42c2ae,_0x5aca58,_0x25d248,_0x278f0c){const _0x508550=a80_0x2413c6;var _0x209506=arguments[_0x508550(0x1ef)],_0xbbd290=_0x209506<0x3?_0x5aca58:_0x278f0c===null?_0x278f0c=Object['getOwnPropertyDescriptor'](_0x5aca58,_0x25d248):_0x278f0c,_0x7fa032;if(typeof Reflect===_0x508550(0x1a7)&&typeof Reflect[_0x508550(0x198)]==='function')_0xbbd290=Reflect[_0x508550(0x198)](_0x42c2ae,_0x5aca58,_0x25d248,_0x278f0c);else{for(var _0x48d4c2=_0x42c2ae[_0x508550(0x1ef)]-0x1;_0x48d4c2>=0x0;_0x48d4c2--)if(_0x7fa032=_0x42c2ae[_0x48d4c2])_0xbbd290=(_0x209506<0x3?_0x7fa032(_0xbbd290):_0x209506>0x3?_0x7fa032(_0x5aca58,_0x25d248,_0xbbd290):_0x7fa032(_0x5aca58,_0x25d248))||_0xbbd290;}return _0x209506>0x3&&_0xbbd290&&Object[_0x508550(0x1a5)](_0x5aca58,_0x25d248,_0xbbd290),_0xbbd290;},__metadata=this&&this[a80_0x2413c6(0x1c8)]||function(_0x5a7bd0,_0x167a3b){const _0xfb6d1c=a80_0x2413c6;if(typeof Reflect==='object'&&typeof Reflect[_0xfb6d1c(0x1dc)]===_0xfb6d1c(0x1d4))return Reflect[_0xfb6d1c(0x1dc)](_0x5a7bd0,_0x167a3b);},SyncService_1;Object[a80_0x2413c6(0x1a5)](exports,'__esModule',{'value':!![]}),exports[a80_0x2413c6(0x1ce)]=void 0x0;const constants_1=require(a80_0x2413c6(0x1b5)),core_1=require(a80_0x2413c6(0x1d5)),too_many_requests_error_1=require(a80_0x2413c6(0x1cf)),flosum_repository_sync_dto_1=require(a80_0x2413c6(0x1e5)),salesforce_error_1=require(a80_0x2413c6(0x1c7)),salesforce_sync_service_1=require(a80_0x2413c6(0x18b)),salesforce_service_1=require(a80_0x2413c6(0x1a6)),utils_1=require(a80_0x2413c6(0x1ac)),typedi_1=require(a80_0x2413c6(0x1d3)),hooks_utils_1=require(a80_0x2413c6(0x1c6)),git_branch_not_found_error_1=require(a80_0x2413c6(0x1d0)),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require('../../providers/providers.tokens'),bad_request_error_1=require('../../../../core/errors/bad-request.error');function a80_0x3b32(){const _0x50082c=['BRANCH_NAME_REGEXP','\x20Checking\x20valid\x20name.','2348394IAkjGV','../../../../constants','branchId','createHookPayload','design:paramtypes',']\x20[','GitBranchNotFoundError','catch','gitProvider','getAll','repoService','9KbMNzq','1251900cwGIzw','find','isIntersects','\x20Completed\x20prepare\x20to\x20syncing.','push','disableSync','../../providers/web-hooks/hooks.utils','../../salesforce/errors/salesforce.error','__metadata','REPOSITORY_NAME_REGEXP','TooManyRequests',']\x20due\x20error\x20-\x20','updateRemoteState','error','SyncService','../../../../core/errors/too-many-requests.error','../errors/git-branch-not-found.error','getBranchRecords','isBidirectionalSynchronization','typedi','function','../../../../core','join','handleRecordSyncError','5929016aYgpzZ','Tokens','toString','2451710SxxRWY','metadata','logger','\x20Getting\x20repositories\x20from\x20git\x20service.','1897hdyaBg','create','\x20branches.','\x20No\x20repositories\x20to\x20sync.','Not\x20Synchronized','hooks','../../salesforce/dto/flosum-repository-sync.dto','\x20Getting\x20repository\x20records.','314150kGHANy','gitUrl','prefix','Logger','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','\x22\x20branch:\x20\x22','BadRequestError','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','length','config','HooksUtils','\x20Have\x20to\x20synchronize\x20','repoList','get','FlosumToGit','isConvertToSfdx','send','FlosumSyncJob','log','repositoryId','\x27\x20in\x20repository\x20\x27','getOrCreateRepo','salesforceSync','__decorate','map','constructor','SyncDirection','getLoggerId','gitApiService','../../salesforce/services/salesforce-sync.service','SalesforceError','Error','setLoggerId','salesforceService','\x20Sync\x20job\x20done.','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','getHookLinkFor','11lpfeTF','setStatus','branchName','gitRepoService','3341115GnKESM','decorate','getRepositoryRecords','repositoryName','repositoriesIntersections','run','name','\x27\x20-\x20\x27','Unable\x20to\x20synchronize\x20branch\x20\x27','SalesforceSyncService','Unable\x20to\x20synchronize\x20repository\x20\x27','(((.+)+)+)+$','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','3owKcgd','defineProperty','../../salesforce/services/salesforce.service','object','\x20Getting\x20Flosum\x20repository','Container','checkValidNaming','7170pEUawT','../../../shared/utils','sfLogger','\x20Repository\x20\x22','url','\x20Start\x20sync\x20job.','applicationUrl'];a80_0x3b32=function(){return _0x50082c;};return a80_0x3b32();}let SyncService=SyncService_1=class SyncService{constructor(_0x2983e5,_0x1c06cd){const _0xc84a21=a80_0x2413c6;this[_0xc84a21(0x18f)]=_0x2983e5,this[_0xc84a21(0x1fd)]=_0x1c06cd,this[_0xc84a21(0x1dd)]=new core_1[(_0xc84a21(0x1ea))](SyncService_1[_0xc84a21(0x19d)]),this[_0xc84a21(0x19b)]={},this['repoList']=[];}async[a80_0x2413c6(0x1d7)](_0x1367c9,_0x4c2d53){const _0x587446=a80_0x2413c6;if(_0x4c2d53 instanceof git_branch_not_found_error_1[_0x587446(0x1ba)]){await this[_0x587446(0x1fd)]['setStatus'](_0x1367c9,_0x587446(0x1e3));return;}if(_0x4c2d53 instanceof too_many_requests_error_1['TooManyRequests']){await this['salesforceSync'][_0x587446(0x194)](_0x1367c9,'Waiting');throw _0x4c2d53;}try{await this['sfLogger'][_0x587446(0x1cd)](this['prefix']+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x1367c9[_0x587446(0x19a)]+'\x27\x20['+_0x1367c9[_0x587446(0x195)]+_0x587446(0x1cb)+_0x4c2d53+'.')['send'](),await this[_0x587446(0x1fd)][_0x587446(0x1cc)](_0x1367c9,{}),await this[_0x587446(0x1fd)][_0x587446(0x194)](_0x1367c9,_0x587446(0x18d));}catch(_0x5799ff){if(_0x5799ff instanceof salesforce_error_1[_0x587446(0x18c)])throw _0x5799ff;}}async[a80_0x2413c6(0x1c2)](_0x41c832){const _0x51f937=a80_0x2413c6;if(_0x41c832[_0x51f937(0x1fa)]){const _0x488c87=_0x41c832[_0x51f937(0x19a)]['toLowerCase'](),_0x2c5c17=this[_0x51f937(0x19b)][_0x488c87];if(!_0x2c5c17)this[_0x51f937(0x19b)][_0x488c87]=_0x41c832[_0x51f937(0x19a)];else{if(_0x2c5c17&&_0x2c5c17!==_0x41c832[_0x51f937(0x19a)])return await this[_0x51f937(0x1d7)](_0x41c832,new Error(_0x51f937(0x1a1)+_0x41c832[_0x51f937(0x19a)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x488c87+_0x51f937(0x19e)+_0x2c5c17+'\x27')),!![];}}return![];}async[a80_0x2413c6(0x1aa)](_0x525b9f){const _0x13849d=a80_0x2413c6;if(!constants_1[_0x13849d(0x1c9)]['test'](_0x525b9f[_0x13849d(0x19a)]))return await this['handleRecordSyncError'](_0x525b9f,new Error(_0x13849d(0x1a1)+_0x525b9f[_0x13849d(0x19a)]+_0x13849d(0x191))),![];if(!constants_1[_0x13849d(0x1b2)]['test'](_0x525b9f[_0x13849d(0x195)]))return await this[_0x13849d(0x1d7)](_0x525b9f,new Error(_0x13849d(0x19f)+_0x525b9f[_0x13849d(0x195)]+_0x13849d(0x1fb)+_0x525b9f[_0x13849d(0x19a)]+_0x13849d(0x1eb))),![];return!![];}async[a80_0x2413c6(0x1fc)](_0x2385cb,_0x445f55){const _0x1d8849=a80_0x2413c6;let _0x10e576=this['repoList'][_0x1d8849(0x1c1)](_0x504c09=>_0x2385cb[_0x1d8849(0x19a)]===_0x504c09[_0x1d8849(0x19d)]);!_0x10e576&&(this[_0x1d8849(0x1ad)][_0x1d8849(0x1f9)](this[_0x1d8849(0x1e9)]+_0x1d8849(0x1ae)+_0x2385cb[_0x1d8849(0x19a)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x10e576=await this['repoService'][_0x1d8849(0x1e0)]({'name':_0x2385cb[_0x1d8849(0x19a)],'autoInit':!![],'defaultBranch':_0x2385cb[_0x1d8849(0x195)],'private':!![],'createHook':typedi_1[_0x1d8849(0x1a9)][_0x1d8849(0x1f4)](providers_tokens_1[_0x1d8849(0x1d9)][_0x1d8849(0x1f0)])[_0x1d8849(0x1d2)]}));if(this[_0x1d8849(0x1f0)]['isBidirectionalSynchronization']){const _0x4cdd51=await _0x10e576[_0x1d8849(0x1e4)][_0x1d8849(0x1bd)]();!_0x4cdd51['find'](_0x40b284=>_0x40b284[_0x1d8849(0x1af)]===hooks_utils_1[_0x1d8849(0x1f1)][_0x1d8849(0x192)](this['config'][_0x1d8849(0x1bc)],this[_0x1d8849(0x1f0)]['applicationUrl'],_0x445f55))&&(this[_0x1d8849(0x1ad)][_0x1d8849(0x1f9)](this['prefix']+_0x1d8849(0x1ae)+_0x2385cb[_0x1d8849(0x19a)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x10e576[_0x1d8849(0x1e4)][_0x1d8849(0x1e0)](hooks_utils_1['HooksUtils'][_0x1d8849(0x1b7)](this[_0x1d8849(0x1f0)][_0x1d8849(0x1bc)],_0x10e576[_0x1d8849(0x1e4)],this['config'][_0x1d8849(0x1b1)],_0x445f55)));}return this[_0x1d8849(0x1f3)][_0x1d8849(0x1c4)](_0x10e576),_0x10e576;}async[a80_0x2413c6(0x19c)](){const _0x395019=a80_0x2413c6;this[_0x395019(0x18a)]=typedi_1[_0x395019(0x1a9)][_0x395019(0x1f4)](providers_tokens_1[_0x395019(0x1d9)][_0x395019(0x18a)]),this[_0x395019(0x1be)]=typedi_1[_0x395019(0x1a9)][_0x395019(0x1f4)](providers_tokens_1['Tokens'][_0x395019(0x196)]),this['config']=typedi_1[_0x395019(0x1a9)]['get'](providers_tokens_1[_0x395019(0x1d9)][_0x395019(0x1f0)]),this[_0x395019(0x1ad)]=typedi_1[_0x395019(0x1a9)][_0x395019(0x1f4)](providers_tokens_1[_0x395019(0x1d9)]['logger']),this['prefix']='['+SyncService_1['name']+_0x395019(0x1b9)+this[_0x395019(0x1f0)][_0x395019(0x1bc)]['toUpperCase']()+']',this['salesforceService'][_0x395019(0x18e)](this[_0x395019(0x1ad)][_0x395019(0x189)]());try{this[_0x395019(0x1ad)][_0x395019(0x1f9)](this[_0x395019(0x1e9)]+_0x395019(0x1b0)),await this['sfLogger']['log'](this[_0x395019(0x1e9)]+_0x395019(0x1e6))[_0x395019(0x1f7)]();const _0x36bd32=await this[_0x395019(0x1fd)][_0x395019(0x199)](typedi_1[_0x395019(0x1a9)]['get'](providers_tokens_1[_0x395019(0x1d9)]['connectionId']));if(!_0x36bd32['length'])throw new bad_request_error_1[(_0x395019(0x1ed))](this['prefix']+_0x395019(0x1e2));await this[_0x395019(0x1ad)][_0x395019(0x1f9)](this[_0x395019(0x1e9)]+'\x20Getting\x20branch\x20records.')['send']();const _0x1bedca=await this['salesforceSync'][_0x395019(0x1d1)](_0x36bd32[_0x395019(0x186)](_0x5591e5=>'\x27'+_0x5591e5[_0x395019(0x1fa)]+'\x27')[_0x395019(0x1d6)](','));await this[_0x395019(0x1ad)]['log'](this[_0x395019(0x1e9)]+_0x395019(0x1de))[_0x395019(0x1f7)](),this[_0x395019(0x1f3)]=await this['repoService']['getAll']();const _0x1cd86b=[..._0x36bd32,..._0x1bedca];this['sfLogger'][_0x395019(0x1f9)](this['prefix']+_0x395019(0x1f2)+_0x1cd86b[_0x395019(0x1ef)]+_0x395019(0x1e1));for(const _0x25b0c2 of _0x1cd86b){this[_0x395019(0x1dd)]['log']('Syncing\x20'+_0x25b0c2['repositoryName']+'['+_0x25b0c2[_0x395019(0x1fa)]+']\x20repository\x20'+_0x25b0c2[_0x395019(0x195)]+'['+_0x25b0c2[_0x395019(0x1b6)]+']\x20branch.'),this[_0x395019(0x1ad)][_0x395019(0x1f9)](this[_0x395019(0x1e9)]+'\x20Syncing\x20repository:\x20\x22'+_0x25b0c2['repositoryName']+_0x395019(0x1ec)+_0x25b0c2[_0x395019(0x195)]+'\x22.'),this[_0x395019(0x1ad)][_0x395019(0x1f9)](this[_0x395019(0x1e9)]+_0x395019(0x1b3));const _0x5e1561=await this['checkValidNaming'](_0x25b0c2);if(!_0x5e1561)continue;this[_0x395019(0x1ad)]['log'](this[_0x395019(0x1e9)]+'\x20Checking\x20intersects.');const _0xa99a1=await this[_0x395019(0x1c2)](_0x25b0c2);if(_0xa99a1)continue;await this['sfLogger'][_0x395019(0x1f7)]();let _0x4e8091;try{await this[_0x395019(0x1ad)][_0x395019(0x1f9)](this[_0x395019(0x1e9)]+_0x395019(0x1a8))[_0x395019(0x1f7)](),_0x4e8091=await this[_0x395019(0x1fc)](_0x25b0c2,typedi_1[_0x395019(0x1a9)][_0x395019(0x1f4)](providers_tokens_1[_0x395019(0x1d9)]['connectionId']));}catch(_0x460f5e){await this[_0x395019(0x1d7)](_0x25b0c2,_0x460f5e instanceof too_many_requests_error_1[_0x395019(0x1ca)]?_0x460f5e:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x460f5e));continue;}await this[_0x395019(0x1ad)][_0x395019(0x1f9)](this[_0x395019(0x1e9)]+_0x395019(0x1c3))['send']();if(_0x25b0c2['direction']===flosum_repository_sync_dto_1[_0x395019(0x188)][_0x395019(0x1f5)]){const _0x17a6f3=typedi_1[_0x395019(0x1a9)]['get'](flosum_sync_job_1[_0x395019(0x1f8)]);await _0x17a6f3[_0x395019(0x19c)]({'repository':_0x4e8091,'convertToSFDX':this['config'][_0x395019(0x1f6)],'syncRecord':_0x25b0c2,'provider':this[_0x395019(0x1f0)]['gitProvider']})['catch'](_0x370fbd=>this[_0x395019(0x1d7)](_0x25b0c2,_0x370fbd));}else{const _0x2d56e4=typedi_1['Container'][_0x395019(0x1f4)](git_sync_job_1['GitSyncJob']);await _0x2d56e4[_0x395019(0x19c)]({'repository':_0x4e8091,'branch':_0x25b0c2['branchName'],'provider':this['config'][_0x395019(0x1bc)],'repositoryGit':_0x4e8091[_0x395019(0x1e8)],'syncRecord':_0x25b0c2})[_0x395019(0x1bb)](_0x520407=>this[_0x395019(0x1d7)](_0x25b0c2,_0x520407));}}}catch(_0x2369a8){this['logger'][_0x395019(0x1cd)](_0x2369a8);_0x2369a8 instanceof too_many_requests_error_1['TooManyRequests']?(await this[_0x395019(0x1ad)]['log'](this[_0x395019(0x1e9)]+_0x395019(0x1a3))[_0x395019(0x1f7)](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0x395019(0x19c)]()):await this['sfLogger'][_0x395019(0x1cd)](this[_0x395019(0x1e9)]+_0x395019(0x1ee)+_0x2369a8)['send']();return;}await this[_0x395019(0x1ad)]['log'](this[_0x395019(0x1e9)]+_0x395019(0x190))[_0x395019(0x1f7)](),await this[_0x395019(0x1fd)][_0x395019(0x1c5)](typedi_1[_0x395019(0x1a9)][_0x395019(0x1f4)](providers_tokens_1['Tokens']['connectionId']))[_0x395019(0x1bb)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a80_0x2413c6(0x1b8),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a80_0x2413c6(0x1a0)]])],SyncService),exports[a80_0x2413c6(0x1ce)]=SyncService;