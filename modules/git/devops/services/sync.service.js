const a111_0x1491bf=a111_0x3057;(function(_0x3595eb,_0x1adad9){const _0x269ad4=a111_0x3057,_0x1e13b1=_0x3595eb();while(!![]){try{const _0x4dfc27=parseInt(_0x269ad4(0x1bb))/0x1*(-parseInt(_0x269ad4(0x1fb))/0x2)+-parseInt(_0x269ad4(0x211))/0x3+-parseInt(_0x269ad4(0x209))/0x4+-parseInt(_0x269ad4(0x22e))/0x5+-parseInt(_0x269ad4(0x1f2))/0x6+parseInt(_0x269ad4(0x1cb))/0x7*(parseInt(_0x269ad4(0x1d3))/0x8)+parseInt(_0x269ad4(0x200))/0x9;if(_0x4dfc27===_0x1adad9)break;else _0x1e13b1['push'](_0x1e13b1['shift']());}catch(_0x1de1cd){_0x1e13b1['push'](_0x1e13b1['shift']());}}}(a111_0x51fa,0xabfe3));const a111_0x1e9967=(function(){let _0x4d3850=!![];return function(_0x57d3e6,_0x3162c7){const _0x42f63f=_0x4d3850?function(){const _0x582984=a111_0x3057;if(_0x3162c7){const _0x2c2d02=_0x3162c7[_0x582984(0x231)](_0x57d3e6,arguments);return _0x3162c7=null,_0x2c2d02;}}:function(){};return _0x4d3850=![],_0x42f63f;};}()),a111_0x5b4a7e=a111_0x1e9967(this,function(){const _0x30b1a1=a111_0x3057;return a111_0x5b4a7e[_0x30b1a1(0x20f)]()[_0x30b1a1(0x1cd)]('(((.+)+)+)+$')[_0x30b1a1(0x20f)]()[_0x30b1a1(0x1f1)](a111_0x5b4a7e)['search'](_0x30b1a1(0x1d9));});a111_0x5b4a7e();'use strict';function a111_0x51fa(){const _0x185f87=['Syncing\x20','createHookPayload','1215299QUjFSB','repositoryName','../../providers/providers.tokens','GitBranchNotFoundError','\x20Getting\x20branch\x20records.','\x20Stop\x20sync\x20job\x20for\x20\x27','__metadata','length','\x20Getting\x20Flosum\x20repository','gitProvider','Not\x20Synchronized','\x27\x20-\x20\x27','BRANCH_NAME_REGEXP','\x20No\x20repositories\x20to\x20sync.','repositoriesIntersections','\x20Checking\x20intersects.','62104SFLuFH',']\x20[','search','__decorate','log','toUpperCase','TooManyRequests','getAll','992BHUQdZ','repositoryId','send','run','getBranchRecords','push','(((.+)+)+)+$','gitUrl','getHookLinkFor','gitRepoService','join','SalesforceError','../../../shared/utils','handleRecordSyncError','../jobs/flosum-sync.job','Waiting','logger','isConvertToSfdx','repoList','../../providers/web-hooks/hooks.utils','\x20Repository\x20\x22','isIntersects','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','error','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','salesforceSync','checkValidNaming','../../salesforce/errors/salesforce.error','defineProperty','constructor','1434072vTGkbT','metadata','get','name','hooks','../../../../core/errors/too-many-requests.error','FlosumToGit','Service','gitApiService','2FarsSs','../../../../core/errors/bad-request.error','toLowerCase','BadRequestError','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','22311405AHMVse','SyncDirection','Unable\x20to\x20synchronize\x20repository\x20\x27','Container','\x27\x20[','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','../errors/git-branch-not-found.error','../../salesforce/services/salesforce.service','\x20branches.','2438512oXwolm','url','config','\x20Getting\x20repository\x20records.',']\x20repository\x20','repoService','toString','direction','1377993ttHfPh','getOrCreateRepo','decorate','connectionId','catch','\x20Getting\x20repositories\x20from\x20git\x20service.','Tokens','isBidirectionalSynchronization','SalesforceSyncService','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','\x20Sync\x20job\x20done.','prefix','\x20Completed\x20prepare\x20to\x20syncing.','object','applicationUrl','FlosumSyncJob','map','../../salesforce/dto/flosum-repository-sync.dto','test','create','branchName','branchId','setLoggerId','SyncService','GitSyncJob','sleep','typedi','design:paramtypes','\x22\x20branch:\x20\x22','1757100KVkhIJ','find','\x20Start\x20sync\x20job.','apply','salesforceService','sfLogger','\x20Checking\x20valid\x20name.'];a111_0x51fa=function(){return _0x185f87;};return a111_0x51fa();}var __decorate=this&&this[a111_0x1491bf(0x1ce)]||function(_0x4b08b1,_0xf7c54,_0x5d40b4,_0x5d2188){const _0x496a1d=a111_0x1491bf;var _0x2ddfbe=arguments[_0x496a1d(0x1c2)],_0x234f4e=_0x2ddfbe<0x3?_0xf7c54:_0x5d2188===null?_0x5d2188=Object['getOwnPropertyDescriptor'](_0xf7c54,_0x5d40b4):_0x5d2188,_0x4b88e0;if(typeof Reflect===_0x496a1d(0x21e)&&typeof Reflect[_0x496a1d(0x213)]==='function')_0x234f4e=Reflect['decorate'](_0x4b08b1,_0xf7c54,_0x5d40b4,_0x5d2188);else{for(var _0x350674=_0x4b08b1[_0x496a1d(0x1c2)]-0x1;_0x350674>=0x0;_0x350674--)if(_0x4b88e0=_0x4b08b1[_0x350674])_0x234f4e=(_0x2ddfbe<0x3?_0x4b88e0(_0x234f4e):_0x2ddfbe>0x3?_0x4b88e0(_0xf7c54,_0x5d40b4,_0x234f4e):_0x4b88e0(_0xf7c54,_0x5d40b4))||_0x234f4e;}return _0x2ddfbe>0x3&&_0x234f4e&&Object[_0x496a1d(0x1f0)](_0xf7c54,_0x5d40b4,_0x234f4e),_0x234f4e;},__metadata=this&&this[a111_0x1491bf(0x1c1)]||function(_0x278749,_0x22906f){const _0x4b1628=a111_0x1491bf;if(typeof Reflect===_0x4b1628(0x21e)&&typeof Reflect[_0x4b1628(0x1f3)]==='function')return Reflect['metadata'](_0x278749,_0x22906f);},SyncService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a111_0x1491bf(0x228)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require('../../../../core'),too_many_requests_error_1=require(a111_0x1491bf(0x1f7)),flosum_repository_sync_dto_1=require(a111_0x1491bf(0x222)),salesforce_error_1=require(a111_0x1491bf(0x1ef)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a111_0x1491bf(0x207)),utils_1=require(a111_0x1491bf(0x1df)),typedi_1=require(a111_0x1491bf(0x22b)),hooks_utils_1=require(a111_0x1491bf(0x1e6)),git_branch_not_found_error_1=require(a111_0x1491bf(0x206)),flosum_sync_job_1=require(a111_0x1491bf(0x1e1)),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require(a111_0x1491bf(0x1bd)),bad_request_error_1=require(a111_0x1491bf(0x1fc));let SyncService=SyncService_1=class SyncService{constructor(_0x4684b3,_0x46be47){const _0x398240=a111_0x1491bf;this[_0x398240(0x232)]=_0x4684b3,this[_0x398240(0x1ed)]=_0x46be47,this[_0x398240(0x1e3)]=new core_1['Logger'](SyncService_1[_0x398240(0x1f5)]),this[_0x398240(0x1c9)]={},this[_0x398240(0x1e5)]=[];}async[a111_0x1491bf(0x1e0)](_0x2dbcdb,_0x2c2cf8){const _0x5f2c9b=a111_0x1491bf;if(_0x2c2cf8 instanceof git_branch_not_found_error_1[_0x5f2c9b(0x1be)]){await this['salesforceSync']['setStatus'](_0x2dbcdb,_0x5f2c9b(0x1c5));return;}if(_0x2c2cf8 instanceof too_many_requests_error_1[_0x5f2c9b(0x1d1)]){await this['salesforceSync']['setStatus'](_0x2dbcdb,_0x5f2c9b(0x1e2));throw _0x2c2cf8;}try{await this[_0x5f2c9b(0x233)]['error'](this[_0x5f2c9b(0x21c)]+_0x5f2c9b(0x1c0)+_0x2dbcdb['repositoryName']+_0x5f2c9b(0x204)+_0x2dbcdb[_0x5f2c9b(0x225)]+']\x20due\x20error\x20-\x20'+_0x2c2cf8+'.')[_0x5f2c9b(0x1d5)](),await this[_0x5f2c9b(0x1ed)]['updateRemoteState'](_0x2dbcdb,{}),await this[_0x5f2c9b(0x1ed)]['setStatus'](_0x2dbcdb,'Error');}catch(_0x54fd2d){if(_0x54fd2d instanceof salesforce_error_1[_0x5f2c9b(0x1de)])throw _0x54fd2d;}}async[a111_0x1491bf(0x1e8)](_0x44f9a2){const _0x3d0a88=a111_0x1491bf;if(_0x44f9a2[_0x3d0a88(0x1d4)]){const _0x459717=_0x44f9a2[_0x3d0a88(0x1bc)][_0x3d0a88(0x1fd)](),_0x25b5b0=this['repositoriesIntersections'][_0x459717];if(!_0x25b5b0)this[_0x3d0a88(0x1c9)][_0x459717]=_0x44f9a2[_0x3d0a88(0x1bc)];else{if(_0x25b5b0&&_0x25b5b0!==_0x44f9a2[_0x3d0a88(0x1bc)])return await this[_0x3d0a88(0x1e0)](_0x44f9a2,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x44f9a2[_0x3d0a88(0x1bc)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x459717+_0x3d0a88(0x1c6)+_0x25b5b0+'\x27')),!![];}}return![];}async[a111_0x1491bf(0x1ee)](_0x287135){const _0x4639eb=a111_0x1491bf;if(!constants_1['REPOSITORY_NAME_REGEXP'][_0x4639eb(0x223)](_0x287135['repositoryName']))return await this[_0x4639eb(0x1e0)](_0x287135,new Error(_0x4639eb(0x202)+_0x287135[_0x4639eb(0x1bc)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x4639eb(0x1c7)][_0x4639eb(0x223)](_0x287135[_0x4639eb(0x225)]))return await this[_0x4639eb(0x1e0)](_0x287135,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x287135[_0x4639eb(0x225)]+'\x27\x20in\x20repository\x20\x27'+_0x287135['repositoryName']+_0x4639eb(0x205))),![];return!![];}async['getOrCreateRepo'](_0x388f3e,_0x407625){const _0x4c309d=a111_0x1491bf;let _0x1b638f=this['repoList'][_0x4c309d(0x22f)](_0x24152e=>_0x388f3e[_0x4c309d(0x1bc)]===_0x24152e[_0x4c309d(0x1f5)]);!_0x1b638f&&(this['sfLogger'][_0x4c309d(0x1cf)](this['prefix']+_0x4c309d(0x1e7)+_0x388f3e[_0x4c309d(0x1bc)]+_0x4c309d(0x1ff)),_0x1b638f=await this[_0x4c309d(0x20e)][_0x4c309d(0x224)]({'name':_0x388f3e[_0x4c309d(0x1bc)],'autoInit':!![],'defaultBranch':_0x388f3e[_0x4c309d(0x225)],'private':!![],'createHook':typedi_1[_0x4c309d(0x203)][_0x4c309d(0x1f4)](providers_tokens_1[_0x4c309d(0x217)][_0x4c309d(0x20b)])['isBidirectionalSynchronization']}));if(this[_0x4c309d(0x20b)][_0x4c309d(0x218)]){const _0x203071=await _0x1b638f[_0x4c309d(0x1f6)][_0x4c309d(0x1d2)]();!_0x203071[_0x4c309d(0x22f)](_0x8d47a8=>_0x8d47a8[_0x4c309d(0x20a)]===hooks_utils_1['HooksUtils'][_0x4c309d(0x1db)](this[_0x4c309d(0x20b)]['gitProvider'],this[_0x4c309d(0x20b)][_0x4c309d(0x21f)],_0x407625))&&(this['sfLogger'][_0x4c309d(0x1cf)](this['prefix']+_0x4c309d(0x1e7)+_0x388f3e[_0x4c309d(0x1bc)]+_0x4c309d(0x1ec)),await _0x1b638f[_0x4c309d(0x1f6)]['create'](hooks_utils_1['HooksUtils'][_0x4c309d(0x1ba)](this[_0x4c309d(0x20b)][_0x4c309d(0x1c4)],_0x1b638f['hooks'],this[_0x4c309d(0x20b)][_0x4c309d(0x21f)],_0x407625)));}return this[_0x4c309d(0x1e5)][_0x4c309d(0x1d8)](_0x1b638f),_0x1b638f;}async[a111_0x1491bf(0x1d6)](){const _0x394af1=a111_0x1491bf;this[_0x394af1(0x1fa)]=typedi_1[_0x394af1(0x203)][_0x394af1(0x1f4)](providers_tokens_1['Tokens'][_0x394af1(0x1fa)]),this[_0x394af1(0x20e)]=typedi_1[_0x394af1(0x203)][_0x394af1(0x1f4)](providers_tokens_1[_0x394af1(0x217)][_0x394af1(0x1dc)]),this['config']=typedi_1['Container']['get'](providers_tokens_1['Tokens'][_0x394af1(0x20b)]),this[_0x394af1(0x233)]=typedi_1[_0x394af1(0x203)]['get'](providers_tokens_1[_0x394af1(0x217)]['logger']),this[_0x394af1(0x21c)]='['+SyncService_1[_0x394af1(0x1f5)]+_0x394af1(0x1cc)+this[_0x394af1(0x20b)][_0x394af1(0x1c4)][_0x394af1(0x1d0)]()+']',this[_0x394af1(0x232)][_0x394af1(0x227)](this[_0x394af1(0x233)]['getLoggerId']());try{this[_0x394af1(0x233)]['log'](this[_0x394af1(0x21c)]+_0x394af1(0x230)),await this[_0x394af1(0x233)][_0x394af1(0x1cf)](this[_0x394af1(0x21c)]+_0x394af1(0x20c))[_0x394af1(0x1d5)]();const _0x53c7e3=await this['salesforceSync']['getRepositoryRecords'](typedi_1[_0x394af1(0x203)][_0x394af1(0x1f4)](providers_tokens_1[_0x394af1(0x217)][_0x394af1(0x214)]));if(!_0x53c7e3[_0x394af1(0x1c2)])throw new bad_request_error_1[(_0x394af1(0x1fe))](this[_0x394af1(0x21c)]+_0x394af1(0x1c8));await this[_0x394af1(0x233)][_0x394af1(0x1cf)](this['prefix']+_0x394af1(0x1bf))['send']();const _0x152ed7=await this['salesforceSync'][_0x394af1(0x1d7)](_0x53c7e3[_0x394af1(0x221)](_0x26934b=>'\x27'+_0x26934b[_0x394af1(0x1d4)]+'\x27')[_0x394af1(0x1dd)](','));await this['sfLogger'][_0x394af1(0x1cf)](this[_0x394af1(0x21c)]+_0x394af1(0x216))[_0x394af1(0x1d5)](),this[_0x394af1(0x1e5)]=await this[_0x394af1(0x20e)][_0x394af1(0x1d2)]();const _0x2d3da2=[..._0x53c7e3,..._0x152ed7];this[_0x394af1(0x233)]['log'](this[_0x394af1(0x21c)]+'\x20Have\x20to\x20synchronize\x20'+_0x2d3da2[_0x394af1(0x1c2)]+_0x394af1(0x208));for(const _0x46c93f of _0x2d3da2){this[_0x394af1(0x1e3)][_0x394af1(0x1cf)](_0x394af1(0x1b9)+_0x46c93f['repositoryName']+'['+_0x46c93f[_0x394af1(0x1d4)]+_0x394af1(0x20d)+_0x46c93f[_0x394af1(0x225)]+'['+_0x46c93f[_0x394af1(0x226)]+']\x20branch.'),this[_0x394af1(0x233)][_0x394af1(0x1cf)](this[_0x394af1(0x21c)]+'\x20Syncing\x20repository:\x20\x22'+_0x46c93f['repositoryName']+_0x394af1(0x22d)+_0x46c93f['branchName']+'\x22.'),this[_0x394af1(0x233)][_0x394af1(0x1cf)](this['prefix']+_0x394af1(0x1b8));const _0xf2b70e=await this[_0x394af1(0x1ee)](_0x46c93f);if(!_0xf2b70e)continue;this['sfLogger'][_0x394af1(0x1cf)](this[_0x394af1(0x21c)]+_0x394af1(0x1ca));const _0x4015e3=await this[_0x394af1(0x1e8)](_0x46c93f);if(_0x4015e3)continue;await this['sfLogger'][_0x394af1(0x1d5)]();let _0x2287a5;try{await this[_0x394af1(0x233)][_0x394af1(0x1cf)](this['prefix']+_0x394af1(0x1c3))[_0x394af1(0x1d5)](),_0x2287a5=await this[_0x394af1(0x212)](_0x46c93f,typedi_1[_0x394af1(0x203)][_0x394af1(0x1f4)](providers_tokens_1[_0x394af1(0x217)][_0x394af1(0x214)]));}catch(_0x37784a){await this[_0x394af1(0x1e0)](_0x46c93f,_0x37784a instanceof too_many_requests_error_1[_0x394af1(0x1d1)]?_0x37784a:new Error(_0x394af1(0x1e9)+_0x37784a));continue;}await this[_0x394af1(0x233)]['log'](this[_0x394af1(0x21c)]+_0x394af1(0x21d))[_0x394af1(0x1d5)]();if(_0x46c93f[_0x394af1(0x210)]===flosum_repository_sync_dto_1[_0x394af1(0x201)][_0x394af1(0x1f8)]){const _0x217685=typedi_1['Container']['get'](flosum_sync_job_1[_0x394af1(0x220)]);await _0x217685[_0x394af1(0x1d6)]({'repository':_0x2287a5,'convertToSFDX':this[_0x394af1(0x20b)][_0x394af1(0x1e4)],'syncRecord':_0x46c93f,'provider':this[_0x394af1(0x20b)][_0x394af1(0x1c4)]})['catch'](_0x567adb=>this[_0x394af1(0x1e0)](_0x46c93f,_0x567adb));}else{const _0x16406a=typedi_1['Container'][_0x394af1(0x1f4)](git_sync_job_1[_0x394af1(0x229)]);await _0x16406a[_0x394af1(0x1d6)]({'repository':_0x2287a5,'branch':_0x46c93f[_0x394af1(0x225)],'provider':this[_0x394af1(0x20b)][_0x394af1(0x1c4)],'repositoryGit':_0x2287a5[_0x394af1(0x1da)],'syncRecord':_0x46c93f})[_0x394af1(0x215)](_0x52d61d=>this[_0x394af1(0x1e0)](_0x46c93f,_0x52d61d));}}}catch(_0x53d43e){this[_0x394af1(0x1e3)][_0x394af1(0x1eb)](_0x53d43e);_0x53d43e instanceof too_many_requests_error_1['TooManyRequests']?(await this[_0x394af1(0x233)][_0x394af1(0x1cf)](this['prefix']+_0x394af1(0x1ea))['send'](),await(0x0,utils_1[_0x394af1(0x22a)])(0x3c*0x3c*0x3e8),this[_0x394af1(0x1d6)]()):await this[_0x394af1(0x233)][_0x394af1(0x1eb)](this['prefix']+_0x394af1(0x21a)+_0x53d43e)[_0x394af1(0x1d5)]();return;}await this[_0x394af1(0x233)][_0x394af1(0x1cf)](this['prefix']+_0x394af1(0x21b))['send'](),await this[_0x394af1(0x1ed)]['disableSync'](typedi_1[_0x394af1(0x203)][_0x394af1(0x1f4)](providers_tokens_1[_0x394af1(0x217)][_0x394af1(0x214)]))[_0x394af1(0x215)](()=>null);}};function a111_0x3057(_0x230ad3,_0x5155fa){const _0x4eaef9=a111_0x51fa();return a111_0x3057=function(_0x5b4a7e,_0x1e9967){_0x5b4a7e=_0x5b4a7e-0x1b8;let _0x51faaf=_0x4eaef9[_0x5b4a7e];return _0x51faaf;},a111_0x3057(_0x230ad3,_0x5155fa);}SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x1491bf(0x1f9)])({'transient':!![]}),__metadata(a111_0x1491bf(0x22c),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a111_0x1491bf(0x219)]])],SyncService),exports[a111_0x1491bf(0x228)]=SyncService;