const a79_0x4ab9f6=a79_0x32c4;(function(_0x115fee,_0x4b6bf5){const _0x153f8f=a79_0x32c4,_0x4a453d=_0x115fee();while(!![]){try{const _0x4315f2=-parseInt(_0x153f8f(0x10a))/0x1+parseInt(_0x153f8f(0x148))/0x2*(-parseInt(_0x153f8f(0x14c))/0x3)+-parseInt(_0x153f8f(0x149))/0x4+-parseInt(_0x153f8f(0x176))/0x5*(-parseInt(_0x153f8f(0x16a))/0x6)+parseInt(_0x153f8f(0x145))/0x7*(parseInt(_0x153f8f(0x14d))/0x8)+-parseInt(_0x153f8f(0x14a))/0x9*(-parseInt(_0x153f8f(0x167))/0xa)+parseInt(_0x153f8f(0x13b))/0xb;if(_0x4315f2===_0x4b6bf5)break;else _0x4a453d['push'](_0x4a453d['shift']());}catch(_0x424449){_0x4a453d['push'](_0x4a453d['shift']());}}}(a79_0x21c0,0x39ca0));function a79_0x32c4(_0x1c54c6,_0x1da042){const _0xc21edf=a79_0x21c0();return a79_0x32c4=function(_0xe7eee3,_0x34cd86){_0xe7eee3=_0xe7eee3-0x108;let _0x21c081=_0xc21edf[_0xe7eee3];return _0x21c081;},a79_0x32c4(_0x1c54c6,_0x1da042);}function a79_0x21c0(){const _0x5965a1=['repoList','search','\x27\x20[','getOwnPropertyDescriptor',']\x20[','\x20No\x20repositories\x20to\x20sync.','join',']\x20due\x20error\x20-\x20','Container','disableSync','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','\x20Syncing\x20repository:\x20\x22','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','326524evfNMh','../../salesforce/errors/salesforce.error','run','../errors/git-branch-not-found.error','isBidirectionalSynchronization','toLowerCase','name','log','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','handleRecordSyncError','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','Not\x20Synchronized','gitApiService','\x20Have\x20to\x20synchronize\x20','decorate',']\x20branch.','SalesforceSyncService','\x20Stop\x20sync\x20job\x20for\x20\x27','object','\x20Sync\x20job\x20done.','gitProvider','apply','__decorate','setStatus','\x22\x20branch:\x20\x22','prefix','function','Tokens','../../salesforce/services/salesforce-sync.service','catch','salesforceSync','../../providers/providers.tokens','metadata','find','getRepositoryRecords','../../../shared/utils','FlosumSyncJob','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','gitRepoService','BadRequestError','SyncDirection','repoService','isIntersects','../jobs/git-sync.job','gitUrl','repositoriesIntersections','applicationUrl','\x20Repository\x20\x22','Error','3112065dEvUnT','Syncing\x20','getAll','design:paramtypes',']\x20repository\x20','get','SalesforceError','../../../../core/errors/bad-request.error','createHookPayload','__metadata','729001TpXcFi','logger','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','250xZLurs','1274480YuNJDs','118089mIRDSW','push','2157GNwarl','8KwYGRN','SalesforceService','toUpperCase','\x20Getting\x20repositories\x20from\x20git\x20service.','config','length','setLoggerId','direction','salesforceService','getHookLinkFor','send','isConvertToSfdx','\x27\x20in\x20repository\x20\x27','SyncService','(((.+)+)+)+$','hooks','GitSyncJob','../../../../constants','repositoryId','connectionId','test','\x20Checking\x20valid\x20name.','HooksUtils','__esModule','defineProperty','repositoryName','210vbUeHm','getLoggerId','GitBranchNotFoundError','4254GSwrdq','Unable\x20to\x20synchronize\x20repository\x20\x27','branchName','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','getOrCreateRepo','error','constructor','TooManyRequests','sfLogger','toString','../../providers/web-hooks/hooks.utils','\x20Checking\x20intersects.','2180gmXKeF','../../salesforce/dto/flosum-repository-sync.dto','checkValidNaming','typedi'];a79_0x21c0=function(){return _0x5965a1;};return a79_0x21c0();}const a79_0x34cd86=(function(){let _0x2e804a=!![];return function(_0x2f1d9f,_0x1bf8bb){const _0x30edca=_0x2e804a?function(){const _0x4e0785=a79_0x32c4;if(_0x1bf8bb){const _0x378ade=_0x1bf8bb[_0x4e0785(0x11f)](_0x2f1d9f,arguments);return _0x1bf8bb=null,_0x378ade;}}:function(){};return _0x2e804a=![],_0x30edca;};}()),a79_0xe7eee3=a79_0x34cd86(this,function(){const _0x5ad732=a79_0x32c4;return a79_0xe7eee3[_0x5ad732(0x173)]()[_0x5ad732(0x17b)](_0x5ad732(0x15b))[_0x5ad732(0x173)]()[_0x5ad732(0x170)](a79_0xe7eee3)[_0x5ad732(0x17b)](_0x5ad732(0x15b));});a79_0xe7eee3();'use strict';var __decorate=this&&this[a79_0x4ab9f6(0x120)]||function(_0x107963,_0x4b9c34,_0x5cc691,_0x223d10){const _0x568aa8=a79_0x4ab9f6;var _0x52abed=arguments['length'],_0x39247a=_0x52abed<0x3?_0x4b9c34:_0x223d10===null?_0x223d10=Object[_0x568aa8(0x17d)](_0x4b9c34,_0x5cc691):_0x223d10,_0x2e9ab9;if(typeof Reflect==='object'&&typeof Reflect[_0x568aa8(0x118)]==='function')_0x39247a=Reflect[_0x568aa8(0x118)](_0x107963,_0x4b9c34,_0x5cc691,_0x223d10);else{for(var _0x35b822=_0x107963['length']-0x1;_0x35b822>=0x0;_0x35b822--)if(_0x2e9ab9=_0x107963[_0x35b822])_0x39247a=(_0x52abed<0x3?_0x2e9ab9(_0x39247a):_0x52abed>0x3?_0x2e9ab9(_0x4b9c34,_0x5cc691,_0x39247a):_0x2e9ab9(_0x4b9c34,_0x5cc691))||_0x39247a;}return _0x52abed>0x3&&_0x39247a&&Object[_0x568aa8(0x165)](_0x4b9c34,_0x5cc691,_0x39247a),_0x39247a;},__metadata=this&&this[a79_0x4ab9f6(0x144)]||function(_0x4c13da,_0x113c8f){const _0x77574d=a79_0x4ab9f6;if(typeof Reflect===_0x77574d(0x11c)&&typeof Reflect[_0x77574d(0x12a)]===_0x77574d(0x124))return Reflect[_0x77574d(0x12a)](_0x4c13da,_0x113c8f);},SyncService_1;Object['defineProperty'](exports,a79_0x4ab9f6(0x164),{'value':!![]}),exports[a79_0x4ab9f6(0x15a)]=void 0x0;const constants_1=require(a79_0x4ab9f6(0x15e)),core_1=require('../../../../core'),too_many_requests_error_1=require('../../../../core/errors/too-many-requests.error'),flosum_repository_sync_dto_1=require(a79_0x4ab9f6(0x177)),salesforce_error_1=require(a79_0x4ab9f6(0x10b)),salesforce_sync_service_1=require(a79_0x4ab9f6(0x126)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),utils_1=require(a79_0x4ab9f6(0x12d)),typedi_1=require(a79_0x4ab9f6(0x179)),hooks_utils_1=require(a79_0x4ab9f6(0x174)),git_branch_not_found_error_1=require(a79_0x4ab9f6(0x10d)),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require(a79_0x4ab9f6(0x135)),providers_tokens_1=require(a79_0x4ab9f6(0x129)),bad_request_error_1=require(a79_0x4ab9f6(0x142));let SyncService=SyncService_1=class SyncService{constructor(_0x57d6cf,_0x43e0c0){const _0x5da06b=a79_0x4ab9f6;this[_0x5da06b(0x155)]=_0x57d6cf,this[_0x5da06b(0x128)]=_0x43e0c0,this['logger']=new core_1['Logger'](SyncService_1[_0x5da06b(0x110)]),this[_0x5da06b(0x137)]={},this['repoList']=[];}async['handleRecordSyncError'](_0x2a2e76,_0x429e84){const _0x16c314=a79_0x4ab9f6;if(_0x429e84 instanceof git_branch_not_found_error_1[_0x16c314(0x169)]){await this[_0x16c314(0x128)][_0x16c314(0x121)](_0x2a2e76,_0x16c314(0x115));return;}if(_0x429e84 instanceof too_many_requests_error_1[_0x16c314(0x171)]){await this[_0x16c314(0x128)][_0x16c314(0x121)](_0x2a2e76,'Waiting');throw _0x429e84;}try{await this['sfLogger'][_0x16c314(0x16f)](this[_0x16c314(0x123)]+_0x16c314(0x11b)+_0x2a2e76[_0x16c314(0x166)]+_0x16c314(0x17c)+_0x2a2e76[_0x16c314(0x16c)]+_0x16c314(0x181)+_0x429e84+'.')[_0x16c314(0x157)](),await this['salesforceSync']['updateRemoteState'](_0x2a2e76,{}),await this[_0x16c314(0x128)][_0x16c314(0x121)](_0x2a2e76,_0x16c314(0x13a));}catch(_0x50e4ed){if(_0x50e4ed instanceof salesforce_error_1[_0x16c314(0x141)])throw _0x50e4ed;}}async[a79_0x4ab9f6(0x134)](_0x3a335d){const _0xd79625=a79_0x4ab9f6;if(_0x3a335d[_0xd79625(0x15f)]){const _0x2445ab=_0x3a335d[_0xd79625(0x166)][_0xd79625(0x10f)](),_0x4e8cf4=this['repositoriesIntersections'][_0x2445ab];if(!_0x4e8cf4)this['repositoriesIntersections'][_0x2445ab]=_0x3a335d[_0xd79625(0x166)];else{if(_0x4e8cf4&&_0x4e8cf4!==_0x3a335d[_0xd79625(0x166)])return await this['handleRecordSyncError'](_0x3a335d,new Error(_0xd79625(0x16b)+_0x3a335d[_0xd79625(0x166)]+_0xd79625(0x112)+_0x2445ab+'\x27\x20-\x20\x27'+_0x4e8cf4+'\x27')),!![];}}return![];}async[a79_0x4ab9f6(0x178)](_0x57af9f){const _0x47f9b8=a79_0x4ab9f6;if(!constants_1['REPOSITORY_NAME_REGEXP']['test'](_0x57af9f[_0x47f9b8(0x166)]))return await this['handleRecordSyncError'](_0x57af9f,new Error(_0x47f9b8(0x16b)+_0x57af9f['repositoryName']+_0x47f9b8(0x12f))),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x47f9b8(0x161)](_0x57af9f[_0x47f9b8(0x16c)]))return await this[_0x47f9b8(0x113)](_0x57af9f,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x57af9f[_0x47f9b8(0x16c)]+_0x47f9b8(0x159)+_0x57af9f[_0x47f9b8(0x166)]+_0x47f9b8(0x16d))),![];return!![];}async[a79_0x4ab9f6(0x16e)](_0x3a6eec,_0x245713){const _0x363ec=a79_0x4ab9f6;let _0x2c0b34=this[_0x363ec(0x17a)][_0x363ec(0x12b)](_0x1f3df4=>_0x3a6eec[_0x363ec(0x166)]===_0x1f3df4['name']);!_0x2c0b34&&(this[_0x363ec(0x172)][_0x363ec(0x111)](this[_0x363ec(0x123)]+_0x363ec(0x139)+_0x3a6eec[_0x363ec(0x166)]+_0x363ec(0x109)),_0x2c0b34=await this[_0x363ec(0x133)]['create']({'name':_0x3a6eec[_0x363ec(0x166)],'autoInit':!![],'defaultBranch':_0x3a6eec[_0x363ec(0x16c)],'private':!![],'createHook':typedi_1['Container']['get'](providers_tokens_1[_0x363ec(0x125)][_0x363ec(0x151)])['isBidirectionalSynchronization']}));if(this[_0x363ec(0x151)][_0x363ec(0x10e)]){const _0x537cfe=await _0x2c0b34[_0x363ec(0x15c)][_0x363ec(0x13d)]();!_0x537cfe[_0x363ec(0x12b)](_0x1a2369=>_0x1a2369['url']===hooks_utils_1[_0x363ec(0x163)][_0x363ec(0x156)](this[_0x363ec(0x151)][_0x363ec(0x11e)],this['config'][_0x363ec(0x138)],_0x245713))&&(this[_0x363ec(0x172)]['log'](this[_0x363ec(0x123)]+_0x363ec(0x139)+_0x3a6eec[_0x363ec(0x166)]+_0x363ec(0x147)),await _0x2c0b34[_0x363ec(0x15c)]['create'](hooks_utils_1['HooksUtils'][_0x363ec(0x143)](this[_0x363ec(0x151)]['gitProvider'],_0x2c0b34[_0x363ec(0x15c)],this['config'][_0x363ec(0x138)],_0x245713)));}return this[_0x363ec(0x17a)][_0x363ec(0x14b)](_0x2c0b34),_0x2c0b34;}async[a79_0x4ab9f6(0x10c)](){const _0x4c12f4=a79_0x4ab9f6;this[_0x4c12f4(0x116)]=typedi_1[_0x4c12f4(0x182)][_0x4c12f4(0x140)](providers_tokens_1[_0x4c12f4(0x125)][_0x4c12f4(0x116)]),this[_0x4c12f4(0x133)]=typedi_1[_0x4c12f4(0x182)]['get'](providers_tokens_1[_0x4c12f4(0x125)][_0x4c12f4(0x130)]),this[_0x4c12f4(0x151)]=typedi_1[_0x4c12f4(0x182)][_0x4c12f4(0x140)](providers_tokens_1['Tokens']['config']),this[_0x4c12f4(0x172)]=typedi_1[_0x4c12f4(0x182)][_0x4c12f4(0x140)](providers_tokens_1[_0x4c12f4(0x125)][_0x4c12f4(0x146)]),this[_0x4c12f4(0x123)]='['+SyncService_1[_0x4c12f4(0x110)]+_0x4c12f4(0x17e)+this[_0x4c12f4(0x151)][_0x4c12f4(0x11e)][_0x4c12f4(0x14f)]()+']',this[_0x4c12f4(0x155)][_0x4c12f4(0x153)](this[_0x4c12f4(0x172)][_0x4c12f4(0x168)]());try{this['sfLogger'][_0x4c12f4(0x111)](this['prefix']+'\x20Start\x20sync\x20job.'),await this[_0x4c12f4(0x172)][_0x4c12f4(0x111)](this[_0x4c12f4(0x123)]+'\x20Getting\x20repository\x20records.')[_0x4c12f4(0x157)]();const _0x3ccab7=await this[_0x4c12f4(0x128)][_0x4c12f4(0x12c)](typedi_1[_0x4c12f4(0x182)][_0x4c12f4(0x140)](providers_tokens_1[_0x4c12f4(0x125)][_0x4c12f4(0x160)]));if(!_0x3ccab7[_0x4c12f4(0x152)])throw new bad_request_error_1[(_0x4c12f4(0x131))](this[_0x4c12f4(0x123)]+_0x4c12f4(0x17f));await this[_0x4c12f4(0x172)]['log'](this[_0x4c12f4(0x123)]+'\x20Getting\x20branch\x20records.')['send']();const _0x4178bf=await this[_0x4c12f4(0x128)]['getBranchRecords'](_0x3ccab7['map'](_0x1771d4=>'\x27'+_0x1771d4[_0x4c12f4(0x15f)]+'\x27')[_0x4c12f4(0x180)](','));await this[_0x4c12f4(0x172)][_0x4c12f4(0x111)](this[_0x4c12f4(0x123)]+_0x4c12f4(0x150))['send'](),this[_0x4c12f4(0x17a)]=await this[_0x4c12f4(0x133)]['getAll']();const _0x2e1791=[..._0x3ccab7,..._0x4178bf];this[_0x4c12f4(0x172)][_0x4c12f4(0x111)](this['prefix']+_0x4c12f4(0x117)+_0x2e1791[_0x4c12f4(0x152)]+'\x20branches.');for(const _0x69cb62 of _0x2e1791){this['logger'][_0x4c12f4(0x111)](_0x4c12f4(0x13c)+_0x69cb62[_0x4c12f4(0x166)]+'['+_0x69cb62['repositoryId']+_0x4c12f4(0x13f)+_0x69cb62[_0x4c12f4(0x16c)]+'['+_0x69cb62['branchId']+_0x4c12f4(0x119)),this[_0x4c12f4(0x172)]['log'](this[_0x4c12f4(0x123)]+_0x4c12f4(0x108)+_0x69cb62[_0x4c12f4(0x166)]+_0x4c12f4(0x122)+_0x69cb62[_0x4c12f4(0x16c)]+'\x22.'),this[_0x4c12f4(0x172)][_0x4c12f4(0x111)](this[_0x4c12f4(0x123)]+_0x4c12f4(0x162));const _0x48e2b9=await this[_0x4c12f4(0x178)](_0x69cb62);if(!_0x48e2b9)continue;this[_0x4c12f4(0x172)]['log'](this['prefix']+_0x4c12f4(0x175));const _0x375897=await this[_0x4c12f4(0x134)](_0x69cb62);if(_0x375897)continue;await this[_0x4c12f4(0x172)]['send']();let _0x27750c;try{await this['sfLogger']['log'](this['prefix']+'\x20Getting\x20Flosum\x20repository')[_0x4c12f4(0x157)](),_0x27750c=await this[_0x4c12f4(0x16e)](_0x69cb62,typedi_1[_0x4c12f4(0x182)][_0x4c12f4(0x140)](providers_tokens_1[_0x4c12f4(0x125)][_0x4c12f4(0x160)]));}catch(_0x16b9f3){await this[_0x4c12f4(0x113)](_0x69cb62,_0x16b9f3 instanceof too_many_requests_error_1['TooManyRequests']?_0x16b9f3:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x16b9f3));continue;}await this['sfLogger']['log'](this[_0x4c12f4(0x123)]+'\x20Completed\x20prepare\x20to\x20syncing.')[_0x4c12f4(0x157)]();if(_0x69cb62[_0x4c12f4(0x154)]===flosum_repository_sync_dto_1[_0x4c12f4(0x132)]['FlosumToGit']){const _0x2dcfed=typedi_1['Container'][_0x4c12f4(0x140)](flosum_sync_job_1[_0x4c12f4(0x12e)]);await _0x2dcfed[_0x4c12f4(0x10c)]({'repository':_0x27750c,'convertToSFDX':this[_0x4c12f4(0x151)][_0x4c12f4(0x158)],'syncRecord':_0x69cb62,'provider':this[_0x4c12f4(0x151)][_0x4c12f4(0x11e)]})[_0x4c12f4(0x127)](_0x3195d9=>this['handleRecordSyncError'](_0x69cb62,_0x3195d9));}else{const _0x3bea5a=typedi_1['Container']['get'](git_sync_job_1[_0x4c12f4(0x15d)]);await _0x3bea5a['run']({'repository':_0x27750c,'branch':_0x69cb62[_0x4c12f4(0x16c)],'provider':this['config']['gitProvider'],'repositoryGit':_0x27750c[_0x4c12f4(0x136)],'syncRecord':_0x69cb62})['catch'](_0x110640=>this[_0x4c12f4(0x113)](_0x69cb62,_0x110640));}}}catch(_0x117fe1){this[_0x4c12f4(0x146)][_0x4c12f4(0x16f)](_0x117fe1);_0x117fe1 instanceof too_many_requests_error_1[_0x4c12f4(0x171)]?(await this['sfLogger'][_0x4c12f4(0x111)](this[_0x4c12f4(0x123)]+_0x4c12f4(0x184))[_0x4c12f4(0x157)](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0x4c12f4(0x10c)]()):await this[_0x4c12f4(0x172)][_0x4c12f4(0x16f)](this[_0x4c12f4(0x123)]+_0x4c12f4(0x114)+_0x117fe1)[_0x4c12f4(0x157)]();return;}await this[_0x4c12f4(0x172)][_0x4c12f4(0x111)](this['prefix']+_0x4c12f4(0x11d))['send'](),await this[_0x4c12f4(0x128)][_0x4c12f4(0x183)](typedi_1[_0x4c12f4(0x182)]['get'](providers_tokens_1['Tokens'][_0x4c12f4(0x160)]))[_0x4c12f4(0x127)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a79_0x4ab9f6(0x13e),[salesforce_service_1[a79_0x4ab9f6(0x14e)],salesforce_sync_service_1[a79_0x4ab9f6(0x11a)]])],SyncService),exports['SyncService']=SyncService;