const a67_0x45bd94=a67_0x11f9;(function(_0x7a100c,_0x518440){const _0x812305=a67_0x11f9,_0xc1a32a=_0x7a100c();while(!![]){try{const _0x5077a9=parseInt(_0x812305(0x1b5))/0x1+-parseInt(_0x812305(0x201))/0x2+parseInt(_0x812305(0x19c))/0x3+parseInt(_0x812305(0x1be))/0x4+parseInt(_0x812305(0x209))/0x5*(parseInt(_0x812305(0x1b8))/0x6)+parseInt(_0x812305(0x1d8))/0x7*(-parseInt(_0x812305(0x1e1))/0x8)+-parseInt(_0x812305(0x1dc))/0x9*(parseInt(_0x812305(0x1f0))/0xa);if(_0x5077a9===_0x518440)break;else _0xc1a32a['push'](_0xc1a32a['shift']());}catch(_0x3ab5be){_0xc1a32a['push'](_0xc1a32a['shift']());}}}(a67_0x5482,0x3914d));const a67_0x27d1aa=(function(){let _0x34047a=!![];return function(_0x5d887d,_0x571c31){const _0xceede6=_0x34047a?function(){if(_0x571c31){const _0xe2b21d=_0x571c31['apply'](_0x5d887d,arguments);return _0x571c31=null,_0xe2b21d;}}:function(){};return _0x34047a=![],_0xceede6;};}()),a67_0x1922b5=a67_0x27d1aa(this,function(){const _0x417833=a67_0x11f9;return a67_0x1922b5[_0x417833(0x1db)]()[_0x417833(0x18f)]('(((.+)+)+)+$')[_0x417833(0x1db)]()['constructor'](a67_0x1922b5)[_0x417833(0x18f)](_0x417833(0x1e0));});a67_0x1922b5();'use strict';var __decorate=this&&this['__decorate']||function(_0x4e9244,_0x13b977,_0x55e091,_0xbe7c00){const _0x552b6b=a67_0x11f9;var _0x3f153c=arguments['length'],_0x584eee=_0x3f153c<0x3?_0x13b977:_0xbe7c00===null?_0xbe7c00=Object[_0x552b6b(0x1ef)](_0x13b977,_0x55e091):_0xbe7c00,_0x1aefd0;if(typeof Reflect===_0x552b6b(0x1ff)&&typeof Reflect[_0x552b6b(0x1bc)]===_0x552b6b(0x185))_0x584eee=Reflect[_0x552b6b(0x1bc)](_0x4e9244,_0x13b977,_0x55e091,_0xbe7c00);else{for(var _0x4da45d=_0x4e9244[_0x552b6b(0x1f5)]-0x1;_0x4da45d>=0x0;_0x4da45d--)if(_0x1aefd0=_0x4e9244[_0x4da45d])_0x584eee=(_0x3f153c<0x3?_0x1aefd0(_0x584eee):_0x3f153c>0x3?_0x1aefd0(_0x13b977,_0x55e091,_0x584eee):_0x1aefd0(_0x13b977,_0x55e091))||_0x584eee;}return _0x3f153c>0x3&&_0x584eee&&Object[_0x552b6b(0x208)](_0x13b977,_0x55e091,_0x584eee),_0x584eee;},__metadata=this&&this[a67_0x45bd94(0x1b1)]||function(_0x207599,_0xfa2034){const _0x52ee7d=a67_0x45bd94;if(typeof Reflect===_0x52ee7d(0x1ff)&&typeof Reflect[_0x52ee7d(0x18e)]===_0x52ee7d(0x185))return Reflect[_0x52ee7d(0x18e)](_0x207599,_0xfa2034);},SyncService_1;function a67_0x11f9(_0x2fb2b5,_0x9cbfa){const _0x1b3e91=a67_0x5482();return a67_0x11f9=function(_0x1922b5,_0x27d1aa){_0x1922b5=_0x1922b5-0x185;let _0x5482fc=_0x1b3e91[_0x1922b5];return _0x5482fc;},a67_0x11f9(_0x2fb2b5,_0x9cbfa);}Object[a67_0x45bd94(0x208)](exports,a67_0x45bd94(0x1d7),{'value':!![]}),exports['SyncService']=void 0x0;function a67_0x5482(){const _0x10d7a6=['sfLogger','sleep','../jobs/git-sync.job','gitProvider','Container','\x27\x20in\x20repository\x20\x27','../../../shared/utils','BadRequestError','\x20Checking\x20valid\x20name.','catch','repositoryId','find','get','branchId','Waiting','SalesforceService','HooksUtils','../jobs/flosum-sync.job','toLowerCase','isBidirectionalSynchronization','__metadata','prefix','\x20branches.','url','106608apdmwJ','Unable\x20to\x20synchronize\x20repository\x20\x27','getRepositoryRecords','12468TLglAj','\x20Getting\x20repositories\x20from\x20git\x20service.','create','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','decorate','isIntersects','300956rbBBHM','\x20Completed\x20prepare\x20to\x20syncing.','Error','getHookLinkFor','../../salesforce/services/salesforce.service','branchName','\x20Checking\x20intersects.','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','\x27\x20[','log','Not\x20Synchronized','map','repositoryName','\x20Start\x20sync\x20job.','toUpperCase','getOrCreateRepo','handleRecordSyncError','repoService','FlosumToGit','test','../../../../core/errors/bad-request.error','../../providers/providers.tokens','FlosumSyncJob','getAll','SalesforceError','__esModule','19551SVQYjx','GitSyncJob','../../../../core/errors/too-many-requests.error','toString','18JuxtwB','../../salesforce/dto/flosum-repository-sync.dto','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','error','(((.+)+)+)+$','984vWjKcP','Unable\x20to\x20synchronize\x20branch\x20\x27','connectionId','config','setStatus','run','gitRepoService','Tokens','direction','../errors/git-branch-not-found.error','send','checkValidNaming','\x20Repository\x20\x22','GitBranchNotFoundError','getOwnPropertyDescriptor','422830iPurgf',']\x20branch.','REPOSITORY_NAME_REGEXP','\x27\x20-\x20\x27','\x22\x20branch:\x20\x22','length','repoList','salesforceSync','logger','\x20Getting\x20repository\x20records.','createHookPayload','\x20No\x20repositories\x20to\x20sync.','typedi','push','join','object','hooks','458404LzYUvL','applicationUrl','getBranchRecords','salesforceService','TooManyRequests',']\x20[','repositoriesIntersections','defineProperty','1085ZxxDxq','SalesforceSyncService','function','../../providers/web-hooks/hooks.utils','Service','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','../../../../constants','SyncDirection','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','getLoggerId','disableSync','metadata','search','gitApiService','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','\x20Have\x20to\x20synchronize\x20','gitUrl','\x20Getting\x20branch\x20records.','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.',']\x20due\x20error\x20-\x20','SyncService','\x20Syncing\x20repository:\x20\x22','isConvertToSfdx',']\x20repository\x20','../../salesforce/errors/salesforce.error','775017OlhNil'];a67_0x5482=function(){return _0x10d7a6;};return a67_0x5482();}const constants_1=require(a67_0x45bd94(0x189)),core_1=require('../../../../core'),too_many_requests_error_1=require(a67_0x45bd94(0x1da)),flosum_repository_sync_dto_1=require(a67_0x45bd94(0x1dd)),salesforce_error_1=require(a67_0x45bd94(0x19b)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a67_0x45bd94(0x1c2)),utils_1=require(a67_0x45bd94(0x1a3)),typedi_1=require(a67_0x45bd94(0x1fc)),hooks_utils_1=require(a67_0x45bd94(0x186)),git_branch_not_found_error_1=require(a67_0x45bd94(0x1ea)),flosum_sync_job_1=require(a67_0x45bd94(0x1ae)),git_sync_job_1=require(a67_0x45bd94(0x19f)),providers_tokens_1=require(a67_0x45bd94(0x1d3)),bad_request_error_1=require(a67_0x45bd94(0x1d2));let SyncService=SyncService_1=class SyncService{constructor(_0x17ca77,_0x432d8e){const _0x5266c5=a67_0x45bd94;this[_0x5266c5(0x204)]=_0x17ca77,this[_0x5266c5(0x1f7)]=_0x432d8e,this['logger']=new core_1['Logger'](SyncService_1['name']),this[_0x5266c5(0x207)]={},this[_0x5266c5(0x1f6)]=[];}async[a67_0x45bd94(0x1ce)](_0x167b69,_0x1d8da2){const _0xe4b47e=a67_0x45bd94;if(_0x1d8da2 instanceof git_branch_not_found_error_1[_0xe4b47e(0x1ee)]){await this[_0xe4b47e(0x1f7)][_0xe4b47e(0x1e5)](_0x167b69,_0xe4b47e(0x1c8));return;}if(_0x1d8da2 instanceof too_many_requests_error_1[_0xe4b47e(0x205)]){await this[_0xe4b47e(0x1f7)][_0xe4b47e(0x1e5)](_0x167b69,_0xe4b47e(0x1ab));throw _0x1d8da2;}try{await this[_0xe4b47e(0x19d)]['error'](this['prefix']+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x167b69[_0xe4b47e(0x1ca)]+_0xe4b47e(0x1c6)+_0x167b69[_0xe4b47e(0x1c3)]+_0xe4b47e(0x196)+_0x1d8da2+'.')['send'](),await this[_0xe4b47e(0x1f7)]['updateRemoteState'](_0x167b69,{}),await this[_0xe4b47e(0x1f7)][_0xe4b47e(0x1e5)](_0x167b69,_0xe4b47e(0x1c0));}catch(_0x1a607f){if(_0x1a607f instanceof salesforce_error_1[_0xe4b47e(0x1d6)])throw _0x1a607f;}}async[a67_0x45bd94(0x1bd)](_0x3b9930){const _0x242928=a67_0x45bd94;if(_0x3b9930[_0x242928(0x1a7)]){const _0x48b8b4=_0x3b9930[_0x242928(0x1ca)][_0x242928(0x1af)](),_0x58a6a0=this['repositoriesIntersections'][_0x48b8b4];if(!_0x58a6a0)this['repositoriesIntersections'][_0x48b8b4]=_0x3b9930['repositoryName'];else{if(_0x58a6a0&&_0x58a6a0!==_0x3b9930['repositoryName'])return await this['handleRecordSyncError'](_0x3b9930,new Error(_0x242928(0x1b6)+_0x3b9930[_0x242928(0x1ca)]+_0x242928(0x18b)+_0x48b8b4+_0x242928(0x1f3)+_0x58a6a0+'\x27')),!![];}}return![];}async[a67_0x45bd94(0x1ec)](_0x4d1590){const _0x4e89c1=a67_0x45bd94;if(!constants_1[_0x4e89c1(0x1f2)][_0x4e89c1(0x1d1)](_0x4d1590[_0x4e89c1(0x1ca)]))return await this[_0x4e89c1(0x1ce)](_0x4d1590,new Error(_0x4e89c1(0x1b6)+_0x4d1590['repositoryName']+_0x4e89c1(0x1de))),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x4e89c1(0x1d1)](_0x4d1590[_0x4e89c1(0x1c3)]))return await this[_0x4e89c1(0x1ce)](_0x4d1590,new Error(_0x4e89c1(0x1e2)+_0x4d1590[_0x4e89c1(0x1c3)]+_0x4e89c1(0x1a2)+_0x4d1590[_0x4e89c1(0x1ca)]+_0x4e89c1(0x195))),![];return!![];}async[a67_0x45bd94(0x1cd)](_0x206fab,_0xf0193e){const _0xe5bcd7=a67_0x45bd94;let _0x268ef7=this[_0xe5bcd7(0x1f6)]['find'](_0x50baea=>_0x206fab['repositoryName']===_0x50baea['name']);!_0x268ef7&&(this[_0xe5bcd7(0x19d)][_0xe5bcd7(0x1c7)](this['prefix']+_0xe5bcd7(0x1ed)+_0x206fab[_0xe5bcd7(0x1ca)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x268ef7=await this[_0xe5bcd7(0x1cf)]['create']({'name':_0x206fab[_0xe5bcd7(0x1ca)],'autoInit':!![],'defaultBranch':_0x206fab[_0xe5bcd7(0x1c3)],'private':!![],'createHook':typedi_1['Container'][_0xe5bcd7(0x1a9)](providers_tokens_1['Tokens'][_0xe5bcd7(0x1e4)])[_0xe5bcd7(0x1b0)]}));if(this[_0xe5bcd7(0x1e4)][_0xe5bcd7(0x1b0)]){const _0x4da3b2=await _0x268ef7[_0xe5bcd7(0x200)]['getAll']();!_0x4da3b2[_0xe5bcd7(0x1a8)](_0x24657e=>_0x24657e[_0xe5bcd7(0x1b4)]===hooks_utils_1[_0xe5bcd7(0x1ad)][_0xe5bcd7(0x1c1)](this['config'][_0xe5bcd7(0x1a0)],this[_0xe5bcd7(0x1e4)][_0xe5bcd7(0x202)],_0xf0193e))&&(this['sfLogger']['log'](this['prefix']+_0xe5bcd7(0x1ed)+_0x206fab[_0xe5bcd7(0x1ca)]+_0xe5bcd7(0x1bb)),await _0x268ef7['hooks'][_0xe5bcd7(0x1ba)](hooks_utils_1[_0xe5bcd7(0x1ad)][_0xe5bcd7(0x1fa)](this['config'][_0xe5bcd7(0x1a0)],_0x268ef7[_0xe5bcd7(0x200)],this[_0xe5bcd7(0x1e4)]['applicationUrl'],_0xf0193e)));}return this[_0xe5bcd7(0x1f6)][_0xe5bcd7(0x1fd)](_0x268ef7),_0x268ef7;}async[a67_0x45bd94(0x1e6)](){const _0x3cb14a=a67_0x45bd94;this[_0x3cb14a(0x190)]=typedi_1['Container'][_0x3cb14a(0x1a9)](providers_tokens_1['Tokens'][_0x3cb14a(0x190)]),this[_0x3cb14a(0x1cf)]=typedi_1['Container']['get'](providers_tokens_1[_0x3cb14a(0x1e8)][_0x3cb14a(0x1e7)]),this[_0x3cb14a(0x1e4)]=typedi_1[_0x3cb14a(0x1a1)]['get'](providers_tokens_1['Tokens'][_0x3cb14a(0x1e4)]),this[_0x3cb14a(0x19d)]=typedi_1[_0x3cb14a(0x1a1)][_0x3cb14a(0x1a9)](providers_tokens_1[_0x3cb14a(0x1e8)][_0x3cb14a(0x1f8)]),this[_0x3cb14a(0x1b2)]='['+SyncService_1['name']+_0x3cb14a(0x206)+this['config'][_0x3cb14a(0x1a0)][_0x3cb14a(0x1cc)]()+']',this[_0x3cb14a(0x204)]['setLoggerId'](this[_0x3cb14a(0x19d)][_0x3cb14a(0x18c)]());try{this[_0x3cb14a(0x19d)]['log'](this['prefix']+_0x3cb14a(0x1cb)),await this[_0x3cb14a(0x19d)]['log'](this[_0x3cb14a(0x1b2)]+_0x3cb14a(0x1f9))['send']();const _0x247019=await this[_0x3cb14a(0x1f7)][_0x3cb14a(0x1b7)](typedi_1[_0x3cb14a(0x1a1)]['get'](providers_tokens_1['Tokens'][_0x3cb14a(0x1e3)]));if(!_0x247019[_0x3cb14a(0x1f5)])throw new bad_request_error_1[(_0x3cb14a(0x1a4))](this[_0x3cb14a(0x1b2)]+_0x3cb14a(0x1fb));await this[_0x3cb14a(0x19d)]['log'](this[_0x3cb14a(0x1b2)]+_0x3cb14a(0x194))[_0x3cb14a(0x1eb)]();const _0xa4106c=await this[_0x3cb14a(0x1f7)][_0x3cb14a(0x203)](_0x247019[_0x3cb14a(0x1c9)](_0x198533=>'\x27'+_0x198533[_0x3cb14a(0x1a7)]+'\x27')[_0x3cb14a(0x1fe)](','));await this[_0x3cb14a(0x19d)][_0x3cb14a(0x1c7)](this['prefix']+_0x3cb14a(0x1b9))[_0x3cb14a(0x1eb)](),this[_0x3cb14a(0x1f6)]=await this[_0x3cb14a(0x1cf)][_0x3cb14a(0x1d5)]();const _0x1c5ec1=[..._0x247019,..._0xa4106c];this[_0x3cb14a(0x19d)][_0x3cb14a(0x1c7)](this['prefix']+_0x3cb14a(0x192)+_0x1c5ec1['length']+_0x3cb14a(0x1b3));for(const _0x52f8c7 of _0x1c5ec1){this[_0x3cb14a(0x1f8)]['log']('Syncing\x20'+_0x52f8c7[_0x3cb14a(0x1ca)]+'['+_0x52f8c7[_0x3cb14a(0x1a7)]+_0x3cb14a(0x19a)+_0x52f8c7[_0x3cb14a(0x1c3)]+'['+_0x52f8c7[_0x3cb14a(0x1aa)]+_0x3cb14a(0x1f1)),this[_0x3cb14a(0x19d)][_0x3cb14a(0x1c7)](this[_0x3cb14a(0x1b2)]+_0x3cb14a(0x198)+_0x52f8c7[_0x3cb14a(0x1ca)]+_0x3cb14a(0x1f4)+_0x52f8c7[_0x3cb14a(0x1c3)]+'\x22.'),this[_0x3cb14a(0x19d)][_0x3cb14a(0x1c7)](this[_0x3cb14a(0x1b2)]+_0x3cb14a(0x1a5));const _0xa522fd=await this[_0x3cb14a(0x1ec)](_0x52f8c7);if(!_0xa522fd)continue;this[_0x3cb14a(0x19d)]['log'](this[_0x3cb14a(0x1b2)]+_0x3cb14a(0x1c4));const _0xf83ad=await this[_0x3cb14a(0x1bd)](_0x52f8c7);if(_0xf83ad)continue;await this[_0x3cb14a(0x19d)]['send']();let _0x278d9c;try{await this[_0x3cb14a(0x19d)][_0x3cb14a(0x1c7)](this[_0x3cb14a(0x1b2)]+'\x20Getting\x20Flosum\x20repository')[_0x3cb14a(0x1eb)](),_0x278d9c=await this[_0x3cb14a(0x1cd)](_0x52f8c7,typedi_1[_0x3cb14a(0x1a1)][_0x3cb14a(0x1a9)](providers_tokens_1[_0x3cb14a(0x1e8)]['connectionId']));}catch(_0x45087f){await this[_0x3cb14a(0x1ce)](_0x52f8c7,_0x45087f instanceof too_many_requests_error_1[_0x3cb14a(0x205)]?_0x45087f:new Error(_0x3cb14a(0x1c5)+_0x45087f));continue;}await this[_0x3cb14a(0x19d)][_0x3cb14a(0x1c7)](this['prefix']+_0x3cb14a(0x1bf))[_0x3cb14a(0x1eb)]();if(_0x52f8c7[_0x3cb14a(0x1e9)]===flosum_repository_sync_dto_1[_0x3cb14a(0x18a)][_0x3cb14a(0x1d0)]){const _0xdd751f=typedi_1['Container']['get'](flosum_sync_job_1[_0x3cb14a(0x1d4)]);await _0xdd751f[_0x3cb14a(0x1e6)]({'repository':_0x278d9c,'convertToSFDX':this[_0x3cb14a(0x1e4)][_0x3cb14a(0x199)],'syncRecord':_0x52f8c7,'provider':this[_0x3cb14a(0x1e4)][_0x3cb14a(0x1a0)]})[_0x3cb14a(0x1a6)](_0x1565da=>this['handleRecordSyncError'](_0x52f8c7,_0x1565da));}else{const _0x37fd6a=typedi_1[_0x3cb14a(0x1a1)]['get'](git_sync_job_1[_0x3cb14a(0x1d9)]);await _0x37fd6a['run']({'repository':_0x278d9c,'branch':_0x52f8c7[_0x3cb14a(0x1c3)],'provider':this[_0x3cb14a(0x1e4)][_0x3cb14a(0x1a0)],'repositoryGit':_0x278d9c[_0x3cb14a(0x193)],'syncRecord':_0x52f8c7})[_0x3cb14a(0x1a6)](_0x458208=>this[_0x3cb14a(0x1ce)](_0x52f8c7,_0x458208));}}}catch(_0x15e12c){this['logger'][_0x3cb14a(0x1df)](_0x15e12c);_0x15e12c instanceof too_many_requests_error_1[_0x3cb14a(0x205)]?(await this[_0x3cb14a(0x19d)][_0x3cb14a(0x1c7)](this[_0x3cb14a(0x1b2)]+_0x3cb14a(0x188))[_0x3cb14a(0x1eb)](),await utils_1[_0x3cb14a(0x19e)](0x3c*0x3c*0x3e8),this['run']()):await this[_0x3cb14a(0x19d)][_0x3cb14a(0x1df)](this['prefix']+_0x3cb14a(0x191)+_0x15e12c)['send']();return;}await this['sfLogger'][_0x3cb14a(0x1c7)](this[_0x3cb14a(0x1b2)]+'\x20Sync\x20job\x20done.')[_0x3cb14a(0x1eb)](),await this[_0x3cb14a(0x1f7)][_0x3cb14a(0x18d)](typedi_1[_0x3cb14a(0x1a1)][_0x3cb14a(0x1a9)](providers_tokens_1[_0x3cb14a(0x1e8)][_0x3cb14a(0x1e3)]))['catch'](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1[a67_0x45bd94(0x187)]({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a67_0x45bd94(0x1ac)],salesforce_sync_service_1[a67_0x45bd94(0x20a)]])],SyncService),exports[a67_0x45bd94(0x197)]=SyncService;