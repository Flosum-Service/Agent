const a80_0x48556a=a80_0x21d8;(function(_0x3c2342,_0x2a0b8c){const _0x41507a=a80_0x21d8,_0x2acbb5=_0x3c2342();while(!![]){try{const _0x22e09a=parseInt(_0x41507a(0x96))/0x1+parseInt(_0x41507a(0xb2))/0x2+parseInt(_0x41507a(0x75))/0x3*(parseInt(_0x41507a(0xba))/0x4)+-parseInt(_0x41507a(0xa4))/0x5*(-parseInt(_0x41507a(0xe6))/0x6)+parseInt(_0x41507a(0x83))/0x7*(-parseInt(_0x41507a(0x7c))/0x8)+parseInt(_0x41507a(0xd1))/0x9*(-parseInt(_0x41507a(0xab))/0xa)+-parseInt(_0x41507a(0x79))/0xb*(parseInt(_0x41507a(0x80))/0xc);if(_0x22e09a===_0x2a0b8c)break;else _0x2acbb5['push'](_0x2acbb5['shift']());}catch(_0x5799e3){_0x2acbb5['push'](_0x2acbb5['shift']());}}}(a80_0x3a2a,0xe8a0d));function a80_0x3a2a(){const _0x4ea0aa=['1720IeGSOy','\x20Completed\x20prepare\x20to\x20syncing.','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','salesforceSync','../../../../core/errors/bad-request.error','GitBranchNotFoundError','repositoryId','1602622Thdrqg',']\x20branch.','direction','error','find','catch','(((.+)+)+)+$','FlosumToGit','692ctHuug','TooManyRequests','getAll','\x27\x20in\x20repository\x20\x27','Unable\x20to\x20synchronize\x20repository\x20\x27','SyncDirection','apply','get','../../../../constants','getLoggerId','test','name','prefix','Waiting','\x22\x20branch:\x20\x22','isBidirectionalSynchronization','applicationUrl','send','gitRepoService','repoService','\x20Stop\x20sync\x20job\x20for\x20\x27','getOrCreateRepo','search','57501ygBiEz','\x20Repository\x20\x22','push','../jobs/git-sync.job','../../../../core/errors/too-many-requests.error','constructor','__metadata','connectionId','join','SalesforceError','branchId','sfLogger','Service','\x20Start\x20sync\x20job.','\x20Getting\x20branch\x20records.','setStatus','Tokens','typedi','gitUrl','SyncService','SalesforceSyncService','6558tPfccx','../../providers/web-hooks/hooks.utils','sleep','function','checkValidNaming','../jobs/flosum-sync.job','defineProperty','../../providers/providers.tokens','run','getHookLinkFor','28353nxeezR','\x20branches.','setLoggerId','toString','1309088EjMzLG','GitSyncJob','../../../shared/utils','7143368IDbsKd','Logger','handleRecordSyncError','repoList','84ECcgPm','Error','../../salesforce/services/salesforce.service','7shPock','design:paramtypes','FlosumSyncJob','hooks','getOwnPropertyDescriptor','create','toUpperCase','metadata','gitApiService','log','\x20Checking\x20valid\x20name.','repositoryName','updateRemoteState','branchName','salesforceService','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','\x20No\x20repositories\x20to\x20sync.','decorate','length','578482uAYTja','logger','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','\x20Sync\x20job\x20done.','\x20Getting\x20Flosum\x20repository','__decorate','gitProvider','../../salesforce/dto/flosum-repository-sync.dto','config','Not\x20Synchronized','isIntersects','../errors/git-branch-not-found.error','Container','repositoriesIntersections','3490SvSRub','HooksUtils',']\x20[','\x27\x20-\x20\x27','REPOSITORY_NAME_REGEXP','disableSync','../../salesforce/services/salesforce-sync.service'];a80_0x3a2a=function(){return _0x4ea0aa;};return a80_0x3a2a();}const a80_0x1b7dca=(function(){let _0x2f4478=!![];return function(_0x40a469,_0x2f9661){const _0x3db2ff=_0x2f4478?function(){const _0x28cc6e=a80_0x21d8;if(_0x2f9661){const _0x343b09=_0x2f9661[_0x28cc6e(0xc0)](_0x40a469,arguments);return _0x2f9661=null,_0x343b09;}}:function(){};return _0x2f4478=![],_0x3db2ff;};}()),a80_0x4cc9ee=a80_0x1b7dca(this,function(){const _0x4cffaf=a80_0x21d8;return a80_0x4cc9ee[_0x4cffaf(0x78)]()['search'](_0x4cffaf(0xb8))[_0x4cffaf(0x78)]()[_0x4cffaf(0xd6)](a80_0x4cc9ee)[_0x4cffaf(0xd0)]('(((.+)+)+)+$');});a80_0x4cc9ee();'use strict';function a80_0x21d8(_0x56fdc8,_0x1062e0){const _0x19db7f=a80_0x3a2a();return a80_0x21d8=function(_0x4cc9ee,_0x1b7dca){_0x4cc9ee=_0x4cc9ee-0x72;let _0x3a2a4e=_0x19db7f[_0x4cc9ee];return _0x3a2a4e;},a80_0x21d8(_0x56fdc8,_0x1062e0);}var __decorate=this&&this[a80_0x48556a(0x9b)]||function(_0x1e1006,_0x181c12,_0xa8552a,_0x3a5b41){const _0x5c56a8=a80_0x48556a;var _0x524696=arguments[_0x5c56a8(0x95)],_0x1b2317=_0x524696<0x3?_0x181c12:_0x3a5b41===null?_0x3a5b41=Object[_0x5c56a8(0x87)](_0x181c12,_0xa8552a):_0x3a5b41,_0x1d415e;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x1b2317=Reflect[_0x5c56a8(0x94)](_0x1e1006,_0x181c12,_0xa8552a,_0x3a5b41);else{for(var _0x18e4a2=_0x1e1006['length']-0x1;_0x18e4a2>=0x0;_0x18e4a2--)if(_0x1d415e=_0x1e1006[_0x18e4a2])_0x1b2317=(_0x524696<0x3?_0x1d415e(_0x1b2317):_0x524696>0x3?_0x1d415e(_0x181c12,_0xa8552a,_0x1b2317):_0x1d415e(_0x181c12,_0xa8552a))||_0x1b2317;}return _0x524696>0x3&&_0x1b2317&&Object[_0x5c56a8(0xec)](_0x181c12,_0xa8552a,_0x1b2317),_0x1b2317;},__metadata=this&&this[a80_0x48556a(0xd7)]||function(_0x1bced9,_0x3ebae3){const _0x364c27=a80_0x48556a;if(typeof Reflect==='object'&&typeof Reflect[_0x364c27(0x8a)]===_0x364c27(0xe9))return Reflect[_0x364c27(0x8a)](_0x1bced9,_0x3ebae3);},SyncService_1;Object[a80_0x48556a(0xec)](exports,'__esModule',{'value':!![]}),exports['SyncService']=void 0x0;const constants_1=require(a80_0x48556a(0xc2)),core_1=require('../../../../core'),too_many_requests_error_1=require(a80_0x48556a(0xd5)),flosum_repository_sync_dto_1=require(a80_0x48556a(0x9d)),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require(a80_0x48556a(0xaa)),salesforce_service_1=require(a80_0x48556a(0x82)),utils_1=require(a80_0x48556a(0x7b)),typedi_1=require(a80_0x48556a(0xe2)),hooks_utils_1=require(a80_0x48556a(0xe7)),git_branch_not_found_error_1=require(a80_0x48556a(0xa1)),flosum_sync_job_1=require(a80_0x48556a(0xeb)),git_sync_job_1=require(a80_0x48556a(0xd4)),providers_tokens_1=require(a80_0x48556a(0x72)),bad_request_error_1=require(a80_0x48556a(0xaf));let SyncService=SyncService_1=class SyncService{constructor(_0x43f8b9,_0x351b5d){const _0xdfe313=a80_0x48556a;this[_0xdfe313(0x91)]=_0x43f8b9,this['salesforceSync']=_0x351b5d,this[_0xdfe313(0x97)]=new core_1[(_0xdfe313(0x7d))](SyncService_1[_0xdfe313(0xc5)]),this['repositoriesIntersections']={},this['repoList']=[];}async[a80_0x48556a(0x7e)](_0x3fba4d,_0xf5dbe1){const _0x1b2048=a80_0x48556a;if(_0xf5dbe1 instanceof git_branch_not_found_error_1[_0x1b2048(0xb0)]){await this[_0x1b2048(0xae)][_0x1b2048(0xe0)](_0x3fba4d,_0x1b2048(0x9f));return;}if(_0xf5dbe1 instanceof too_many_requests_error_1['TooManyRequests']){await this[_0x1b2048(0xae)][_0x1b2048(0xe0)](_0x3fba4d,_0x1b2048(0xc7));throw _0xf5dbe1;}try{await this[_0x1b2048(0xdc)]['error'](this['prefix']+_0x1b2048(0xce)+_0x3fba4d[_0x1b2048(0x8e)]+'\x27\x20['+_0x3fba4d[_0x1b2048(0x90)]+']\x20due\x20error\x20-\x20'+_0xf5dbe1+'.')[_0x1b2048(0xcb)](),await this[_0x1b2048(0xae)][_0x1b2048(0x8f)](_0x3fba4d,{}),await this[_0x1b2048(0xae)][_0x1b2048(0xe0)](_0x3fba4d,_0x1b2048(0x81));}catch(_0x38b450){if(_0x38b450 instanceof salesforce_error_1[_0x1b2048(0xda)])throw _0x38b450;}}async[a80_0x48556a(0xa0)](_0x12f067){const _0x94697b=a80_0x48556a;if(_0x12f067[_0x94697b(0xb1)]){const _0x49e024=_0x12f067[_0x94697b(0x8e)]['toLowerCase'](),_0x112aad=this[_0x94697b(0xa3)][_0x49e024];if(!_0x112aad)this[_0x94697b(0xa3)][_0x49e024]=_0x12f067['repositoryName'];else{if(_0x112aad&&_0x112aad!==_0x12f067[_0x94697b(0x8e)])return await this[_0x94697b(0x7e)](_0x12f067,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x12f067[_0x94697b(0x8e)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x49e024+_0x94697b(0xa7)+_0x112aad+'\x27')),!![];}}return![];}async[a80_0x48556a(0xea)](_0xb9bbbe){const _0x3a3a36=a80_0x48556a;if(!constants_1[_0x3a3a36(0xa8)][_0x3a3a36(0xc4)](_0xb9bbbe[_0x3a3a36(0x8e)]))return await this['handleRecordSyncError'](_0xb9bbbe,new Error(_0x3a3a36(0xbe)+_0xb9bbbe[_0x3a3a36(0x8e)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x3a3a36(0xc4)](_0xb9bbbe[_0x3a3a36(0x90)]))return await this['handleRecordSyncError'](_0xb9bbbe,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0xb9bbbe[_0x3a3a36(0x90)]+_0x3a3a36(0xbd)+_0xb9bbbe[_0x3a3a36(0x8e)]+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async[a80_0x48556a(0xcf)](_0xeec56f,_0x7ae909){const _0x1b7ef6=a80_0x48556a;let _0x2c2680=this[_0x1b7ef6(0x7f)]['find'](_0x16ad9b=>_0xeec56f['repositoryName']===_0x16ad9b[_0x1b7ef6(0xc5)]);!_0x2c2680&&(this[_0x1b7ef6(0xdc)][_0x1b7ef6(0x8c)](this[_0x1b7ef6(0xc6)]+'\x20Repository\x20\x22'+_0xeec56f[_0x1b7ef6(0x8e)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x2c2680=await this[_0x1b7ef6(0xcd)][_0x1b7ef6(0x88)]({'name':_0xeec56f['repositoryName'],'autoInit':!![],'defaultBranch':_0xeec56f[_0x1b7ef6(0x90)],'private':!![],'createHook':typedi_1[_0x1b7ef6(0xa2)][_0x1b7ef6(0xc1)](providers_tokens_1['Tokens'][_0x1b7ef6(0x9e)])[_0x1b7ef6(0xc9)]}));if(this[_0x1b7ef6(0x9e)][_0x1b7ef6(0xc9)]){const _0x3f8d56=await _0x2c2680['hooks']['getAll']();!_0x3f8d56[_0x1b7ef6(0xb6)](_0x3eb2b8=>_0x3eb2b8['url']===hooks_utils_1[_0x1b7ef6(0xa5)][_0x1b7ef6(0x74)](this[_0x1b7ef6(0x9e)][_0x1b7ef6(0x9c)],this[_0x1b7ef6(0x9e)][_0x1b7ef6(0xca)],_0x7ae909))&&(this[_0x1b7ef6(0xdc)][_0x1b7ef6(0x8c)](this[_0x1b7ef6(0xc6)]+_0x1b7ef6(0xd2)+_0xeec56f[_0x1b7ef6(0x8e)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x2c2680[_0x1b7ef6(0x86)]['create'](hooks_utils_1[_0x1b7ef6(0xa5)]['createHookPayload'](this[_0x1b7ef6(0x9e)][_0x1b7ef6(0x9c)],_0x2c2680['hooks'],this[_0x1b7ef6(0x9e)][_0x1b7ef6(0xca)],_0x7ae909)));}return this[_0x1b7ef6(0x7f)][_0x1b7ef6(0xd3)](_0x2c2680),_0x2c2680;}async['run'](){const _0x580254=a80_0x48556a;this[_0x580254(0x8b)]=typedi_1[_0x580254(0xa2)][_0x580254(0xc1)](providers_tokens_1[_0x580254(0xe1)]['gitApiService']),this[_0x580254(0xcd)]=typedi_1['Container'][_0x580254(0xc1)](providers_tokens_1[_0x580254(0xe1)][_0x580254(0xcc)]),this[_0x580254(0x9e)]=typedi_1[_0x580254(0xa2)][_0x580254(0xc1)](providers_tokens_1['Tokens'][_0x580254(0x9e)]),this['sfLogger']=typedi_1[_0x580254(0xa2)][_0x580254(0xc1)](providers_tokens_1['Tokens'][_0x580254(0x97)]),this[_0x580254(0xc6)]='['+SyncService_1[_0x580254(0xc5)]+_0x580254(0xa6)+this[_0x580254(0x9e)][_0x580254(0x9c)][_0x580254(0x89)]()+']',this['salesforceService'][_0x580254(0x77)](this[_0x580254(0xdc)][_0x580254(0xc3)]());try{this[_0x580254(0xdc)]['log'](this[_0x580254(0xc6)]+_0x580254(0xde)),await this[_0x580254(0xdc)][_0x580254(0x8c)](this[_0x580254(0xc6)]+'\x20Getting\x20repository\x20records.')[_0x580254(0xcb)]();const _0x30d7b8=await this[_0x580254(0xae)]['getRepositoryRecords'](typedi_1['Container'][_0x580254(0xc1)](providers_tokens_1[_0x580254(0xe1)][_0x580254(0xd8)]));if(!_0x30d7b8['length'])throw new bad_request_error_1['BadRequestError'](this['prefix']+_0x580254(0x93));await this[_0x580254(0xdc)][_0x580254(0x8c)](this['prefix']+_0x580254(0xdf))['send']();const _0x4776cc=await this[_0x580254(0xae)]['getBranchRecords'](_0x30d7b8['map'](_0x28891c=>'\x27'+_0x28891c[_0x580254(0xb1)]+'\x27')[_0x580254(0xd9)](','));await this[_0x580254(0xdc)]['log'](this[_0x580254(0xc6)]+'\x20Getting\x20repositories\x20from\x20git\x20service.')[_0x580254(0xcb)](),this[_0x580254(0x7f)]=await this[_0x580254(0xcd)][_0x580254(0xbc)]();const _0x10ddce=[..._0x30d7b8,..._0x4776cc];this[_0x580254(0xdc)]['log'](this['prefix']+'\x20Have\x20to\x20synchronize\x20'+_0x10ddce[_0x580254(0x95)]+_0x580254(0x76));for(const _0x54f45a of _0x10ddce){this['logger'][_0x580254(0x8c)]('Syncing\x20'+_0x54f45a[_0x580254(0x8e)]+'['+_0x54f45a['repositoryId']+']\x20repository\x20'+_0x54f45a[_0x580254(0x90)]+'['+_0x54f45a[_0x580254(0xdb)]+_0x580254(0xb3)),this['sfLogger'][_0x580254(0x8c)](this[_0x580254(0xc6)]+'\x20Syncing\x20repository:\x20\x22'+_0x54f45a[_0x580254(0x8e)]+_0x580254(0xc8)+_0x54f45a[_0x580254(0x90)]+'\x22.'),this[_0x580254(0xdc)][_0x580254(0x8c)](this[_0x580254(0xc6)]+_0x580254(0x8d));const _0x2418c7=await this['checkValidNaming'](_0x54f45a);if(!_0x2418c7)continue;this[_0x580254(0xdc)]['log'](this[_0x580254(0xc6)]+'\x20Checking\x20intersects.');const _0x520db9=await this[_0x580254(0xa0)](_0x54f45a);if(_0x520db9)continue;await this[_0x580254(0xdc)][_0x580254(0xcb)]();let _0x1378a1;try{await this[_0x580254(0xdc)][_0x580254(0x8c)](this['prefix']+_0x580254(0x9a))[_0x580254(0xcb)](),_0x1378a1=await this[_0x580254(0xcf)](_0x54f45a,typedi_1[_0x580254(0xa2)][_0x580254(0xc1)](providers_tokens_1[_0x580254(0xe1)][_0x580254(0xd8)]));}catch(_0x1900ad){await this[_0x580254(0x7e)](_0x54f45a,_0x1900ad instanceof too_many_requests_error_1[_0x580254(0xbb)]?_0x1900ad:new Error(_0x580254(0x98)+_0x1900ad));continue;}await this[_0x580254(0xdc)]['log'](this[_0x580254(0xc6)]+_0x580254(0xac))[_0x580254(0xcb)]();if(_0x54f45a[_0x580254(0xb4)]===flosum_repository_sync_dto_1[_0x580254(0xbf)][_0x580254(0xb9)]){const _0x561033=typedi_1[_0x580254(0xa2)][_0x580254(0xc1)](flosum_sync_job_1[_0x580254(0x85)]);await _0x561033[_0x580254(0x73)]({'repository':_0x1378a1,'convertToSFDX':this[_0x580254(0x9e)]['isConvertToSfdx'],'syncRecord':_0x54f45a,'provider':this[_0x580254(0x9e)][_0x580254(0x9c)]})[_0x580254(0xb7)](_0x133f15=>this[_0x580254(0x7e)](_0x54f45a,_0x133f15));}else{const _0x45c73b=typedi_1[_0x580254(0xa2)][_0x580254(0xc1)](git_sync_job_1[_0x580254(0x7a)]);await _0x45c73b['run']({'repository':_0x1378a1,'branch':_0x54f45a['branchName'],'provider':this[_0x580254(0x9e)][_0x580254(0x9c)],'repositoryGit':_0x1378a1[_0x580254(0xe3)],'syncRecord':_0x54f45a})[_0x580254(0xb7)](_0x4b0ec6=>this[_0x580254(0x7e)](_0x54f45a,_0x4b0ec6));}}}catch(_0x5e6e0a){this['logger'][_0x580254(0xb5)](_0x5e6e0a);_0x5e6e0a instanceof too_many_requests_error_1['TooManyRequests']?(await this[_0x580254(0xdc)][_0x580254(0x8c)](this[_0x580254(0xc6)]+_0x580254(0x92))[_0x580254(0xcb)](),await(0x0,utils_1[_0x580254(0xe8)])(0x3c*0x3c*0x3e8),this[_0x580254(0x73)]()):await this[_0x580254(0xdc)][_0x580254(0xb5)](this[_0x580254(0xc6)]+_0x580254(0xad)+_0x5e6e0a)['send']();return;}await this['sfLogger'][_0x580254(0x8c)](this[_0x580254(0xc6)]+_0x580254(0x99))['send'](),await this[_0x580254(0xae)][_0x580254(0xa9)](typedi_1[_0x580254(0xa2)][_0x580254(0xc1)](providers_tokens_1[_0x580254(0xe1)][_0x580254(0xd8)]))[_0x580254(0xb7)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a80_0x48556a(0xdd)])({'transient':!![]}),__metadata(a80_0x48556a(0x84),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a80_0x48556a(0xe5)]])],SyncService),exports[a80_0x48556a(0xe4)]=SyncService;