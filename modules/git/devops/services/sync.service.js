const a111_0x1173c3=a111_0x4832;function a111_0x413c(){const _0x3ab720=['\x20Repository\x20\x22','Service','apply','getAll','name','isBidirectionalSynchronization','branchId','Logger','toString','\x20Have\x20to\x20synchronize\x20','248526rEWLjE','direction','getOrCreateRepo','map','799173tGkPlW','Unable\x20to\x20synchronize\x20repository\x20\x27','Unable\x20to\x20synchronize\x20branch\x20\x27','defineProperty',']\x20branch.','run','\x20Checking\x20intersects.','TooManyRequests','length','sleep','\x20Completed\x20prepare\x20to\x20syncing.','test','getRepositoryRecords','salesforceService','2894823EpHtnI','\x20branches.','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','setStatus','metadata','BRANCH_NAME_REGEXP','object','305756XXmcUU','63BZKyys','function','setLoggerId','find','SalesforceService','SalesforceSyncService','../../providers/web-hooks/hooks.utils','\x20Getting\x20repositories\x20from\x20git\x20service.','gitRepoService','__decorate','../jobs/git-sync.job','\x20Getting\x20Flosum\x20repository','__esModule','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','../../../shared/utils','sfLogger',']\x20repository\x20','log','\x20Sync\x20job\x20done.','isIntersects','config','../../providers/providers.tokens','getOwnPropertyDescriptor','isConvertToSfdx','Not\x20Synchronized','error','handleRecordSyncError','\x20Start\x20sync\x20job.','gitProvider','get','connectionId','70xjKIdd','repositoryId','__metadata','repositoryName','getHookLinkFor','4666XseWem','prefix','Tokens','\x20Syncing\x20repository:\x20\x22','hooks','checkValidNaming','branchName','repositoriesIntersections','REPOSITORY_NAME_REGEXP','../../../../core/errors/too-many-requests.error','FlosumToGit','HooksUtils','GitBranchNotFoundError','\x27\x20in\x20repository\x20\x27','BadRequestError','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','constructor','../../salesforce/services/salesforce.service','\x20No\x20repositories\x20to\x20sync.','url','../../salesforce/dto/flosum-repository-sync.dto',']\x20[','applicationUrl','gitApiService','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','SalesforceError','Error','Container','catch','FlosumSyncJob','repoList','push','getBranchRecords','createHookPayload','design:paramtypes','\x22\x20branch:\x20\x22','Syncing\x20','typedi','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','toUpperCase','(((.+)+)+)+$','../../../../core/errors/bad-request.error','\x27\x20[','send','salesforceSync','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','SyncService','\x20Getting\x20branch\x20records.','GitSyncJob','37nZTEzn',']\x20due\x20error\x20-\x20','repoService','create','toLowerCase','3512160wESoTX','../../salesforce/services/salesforce-sync.service','search','3388905hNiMXb','\x20Checking\x20valid\x20name.','logger','8lYmxXh','\x27\x20-\x20\x27','SyncDirection'];a111_0x413c=function(){return _0x3ab720;};return a111_0x413c();}(function(_0x350760,_0x43eb0e){const _0x224572=a111_0x4832,_0x3b3759=_0x350760();while(!![]){try{const _0x17b3bf=parseInt(_0x224572(0x11c))/0x1*(parseInt(_0x224572(0xea))/0x2)+-parseInt(_0x224572(0xb0))/0x3*(parseInt(_0x224572(0x127))/0x4)+parseInt(_0x224572(0x124))/0x5+-parseInt(_0x224572(0xac))/0x6*(parseInt(_0x224572(0xc6))/0x7)+parseInt(_0x224572(0x121))/0x8+parseInt(_0x224572(0xbe))/0x9+-parseInt(_0x224572(0xe5))/0xa*(parseInt(_0x224572(0xc5))/0xb);if(_0x17b3bf===_0x43eb0e)break;else _0x3b3759['push'](_0x3b3759['shift']());}catch(_0x58d876){_0x3b3759['push'](_0x3b3759['shift']());}}}(a111_0x413c,0x67ab2));const a111_0x5cc5f2=(function(){let _0x509d52=!![];return function(_0x370e2e,_0x2cc735){const _0x57aea7=_0x509d52?function(){const _0x1a51ac=a111_0x4832;if(_0x2cc735){const _0x44a1e3=_0x2cc735[_0x1a51ac(0xa4)](_0x370e2e,arguments);return _0x2cc735=null,_0x44a1e3;}}:function(){};return _0x509d52=![],_0x57aea7;};}()),a111_0x540a88=a111_0x5cc5f2(this,function(){const _0x589eca=a111_0x4832;return a111_0x540a88[_0x589eca(0xaa)]()[_0x589eca(0x123)](_0x589eca(0x113))[_0x589eca(0xaa)]()[_0x589eca(0xfa)](a111_0x540a88)[_0x589eca(0x123)](_0x589eca(0x113));});a111_0x540a88();'use strict';var __decorate=this&&this[a111_0x1173c3(0xcf)]||function(_0x55e557,_0x5aa8c6,_0x26ebeb,_0x1079c5){const _0x126361=a111_0x1173c3;var _0xf2cc5=arguments[_0x126361(0xb8)],_0xe82160=_0xf2cc5<0x3?_0x5aa8c6:_0x1079c5===null?_0x1079c5=Object[_0x126361(0xdc)](_0x5aa8c6,_0x26ebeb):_0x1079c5,_0x21d048;if(typeof Reflect===_0x126361(0xc4)&&typeof Reflect['decorate']===_0x126361(0xc7))_0xe82160=Reflect['decorate'](_0x55e557,_0x5aa8c6,_0x26ebeb,_0x1079c5);else{for(var _0x4ba413=_0x55e557['length']-0x1;_0x4ba413>=0x0;_0x4ba413--)if(_0x21d048=_0x55e557[_0x4ba413])_0xe82160=(_0xf2cc5<0x3?_0x21d048(_0xe82160):_0xf2cc5>0x3?_0x21d048(_0x5aa8c6,_0x26ebeb,_0xe82160):_0x21d048(_0x5aa8c6,_0x26ebeb))||_0xe82160;}return _0xf2cc5>0x3&&_0xe82160&&Object['defineProperty'](_0x5aa8c6,_0x26ebeb,_0xe82160),_0xe82160;},__metadata=this&&this[a111_0x1173c3(0xe7)]||function(_0x7fa176,_0x26d21b){const _0xcdb8d8=a111_0x1173c3;if(typeof Reflect===_0xcdb8d8(0xc4)&&typeof Reflect[_0xcdb8d8(0xc2)]===_0xcdb8d8(0xc7))return Reflect[_0xcdb8d8(0xc2)](_0x7fa176,_0x26d21b);},SyncService_1;Object[a111_0x1173c3(0xb3)](exports,a111_0x1173c3(0xd2),{'value':!![]}),exports['SyncService']=void 0x0;const constants_1=require('../../../../constants'),core_1=require('../../../../core'),too_many_requests_error_1=require(a111_0x1173c3(0xf3)),flosum_repository_sync_dto_1=require(a111_0x1173c3(0xfe)),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require(a111_0x1173c3(0x122)),salesforce_service_1=require(a111_0x1173c3(0xfb)),utils_1=require(a111_0x1173c3(0xd4)),typedi_1=require(a111_0x1173c3(0x10f)),hooks_utils_1=require(a111_0x1173c3(0xcc)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require(a111_0x1173c3(0xd0)),providers_tokens_1=require(a111_0x1173c3(0xdb)),bad_request_error_1=require(a111_0x1173c3(0x114));let SyncService=SyncService_1=class SyncService{constructor(_0x258797,_0x2447e9){const _0xdfe57a=a111_0x1173c3;this[_0xdfe57a(0xbd)]=_0x258797,this[_0xdfe57a(0x117)]=_0x2447e9,this[_0xdfe57a(0x126)]=new core_1[(_0xdfe57a(0xa9))](SyncService_1[_0xdfe57a(0xa6)]),this['repositoriesIntersections']={},this[_0xdfe57a(0x108)]=[];}async[a111_0x1173c3(0xe0)](_0x5dbff1,_0x5cff88){const _0x57624e=a111_0x1173c3;if(_0x5cff88 instanceof git_branch_not_found_error_1[_0x57624e(0xf6)]){await this[_0x57624e(0x117)][_0x57624e(0xc1)](_0x5dbff1,_0x57624e(0xde));return;}if(_0x5cff88 instanceof too_many_requests_error_1[_0x57624e(0xb7)]){await this[_0x57624e(0x117)][_0x57624e(0xc1)](_0x5dbff1,'Waiting');throw _0x5cff88;}try{await this[_0x57624e(0xd5)][_0x57624e(0xdf)](this['prefix']+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x5dbff1['repositoryName']+_0x57624e(0x115)+_0x5dbff1[_0x57624e(0xf0)]+_0x57624e(0x11d)+_0x5cff88+'.')[_0x57624e(0x116)](),await this[_0x57624e(0x117)]['updateRemoteState'](_0x5dbff1,{}),await this[_0x57624e(0x117)]['setStatus'](_0x5dbff1,_0x57624e(0x104));}catch(_0x2ecc1a){if(_0x2ecc1a instanceof salesforce_error_1[_0x57624e(0x103)])throw _0x2ecc1a;}}async[a111_0x1173c3(0xd9)](_0x42d60f){const _0x5812d0=a111_0x1173c3;if(_0x42d60f[_0x5812d0(0xe6)]){const _0x1de2fd=_0x42d60f['repositoryName'][_0x5812d0(0x120)](),_0x340b5c=this[_0x5812d0(0xf1)][_0x1de2fd];if(!_0x340b5c)this[_0x5812d0(0xf1)][_0x1de2fd]=_0x42d60f[_0x5812d0(0xe8)];else{if(_0x340b5c&&_0x340b5c!==_0x42d60f[_0x5812d0(0xe8)])return await this[_0x5812d0(0xe0)](_0x42d60f,new Error(_0x5812d0(0xb1)+_0x42d60f[_0x5812d0(0xe8)]+_0x5812d0(0xc0)+_0x1de2fd+_0x5812d0(0xa0)+_0x340b5c+'\x27')),!![];}}return![];}async['checkValidNaming'](_0x592a47){const _0x53c71c=a111_0x1173c3;if(!constants_1[_0x53c71c(0xf2)][_0x53c71c(0xbb)](_0x592a47[_0x53c71c(0xe8)]))return await this[_0x53c71c(0xe0)](_0x592a47,new Error(_0x53c71c(0xb1)+_0x592a47[_0x53c71c(0xe8)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x53c71c(0xc3)]['test'](_0x592a47[_0x53c71c(0xf0)]))return await this[_0x53c71c(0xe0)](_0x592a47,new Error(_0x53c71c(0xb2)+_0x592a47[_0x53c71c(0xf0)]+_0x53c71c(0xf7)+_0x592a47[_0x53c71c(0xe8)]+_0x53c71c(0xf9))),![];return!![];}async['getOrCreateRepo'](_0x3b8237,_0x4b6fd0){const _0x56ee77=a111_0x1173c3;let _0x1fa258=this[_0x56ee77(0x108)]['find'](_0x36123f=>_0x3b8237[_0x56ee77(0xe8)]===_0x36123f[_0x56ee77(0xa6)]);!_0x1fa258&&(this[_0x56ee77(0xd5)][_0x56ee77(0xd7)](this[_0x56ee77(0xeb)]+_0x56ee77(0xa2)+_0x3b8237[_0x56ee77(0xe8)]+_0x56ee77(0x102)),_0x1fa258=await this[_0x56ee77(0x11e)][_0x56ee77(0x11f)]({'name':_0x3b8237[_0x56ee77(0xe8)],'autoInit':!![],'defaultBranch':_0x3b8237['branchName'],'private':!![],'createHook':typedi_1[_0x56ee77(0x105)][_0x56ee77(0xe3)](providers_tokens_1[_0x56ee77(0xec)][_0x56ee77(0xda)])[_0x56ee77(0xa7)]}));if(this[_0x56ee77(0xda)][_0x56ee77(0xa7)]){const _0x26f992=await _0x1fa258[_0x56ee77(0xee)][_0x56ee77(0xa5)]();!_0x26f992[_0x56ee77(0xc9)](_0x36eaba=>_0x36eaba[_0x56ee77(0xfd)]===hooks_utils_1[_0x56ee77(0xf5)][_0x56ee77(0xe9)](this[_0x56ee77(0xda)]['gitProvider'],this[_0x56ee77(0xda)][_0x56ee77(0x100)],_0x4b6fd0))&&(this[_0x56ee77(0xd5)][_0x56ee77(0xd7)](this[_0x56ee77(0xeb)]+_0x56ee77(0xa2)+_0x3b8237[_0x56ee77(0xe8)]+_0x56ee77(0x118)),await _0x1fa258[_0x56ee77(0xee)][_0x56ee77(0x11f)](hooks_utils_1[_0x56ee77(0xf5)][_0x56ee77(0x10b)](this[_0x56ee77(0xda)][_0x56ee77(0xe2)],_0x1fa258['hooks'],this['config'][_0x56ee77(0x100)],_0x4b6fd0)));}return this['repoList'][_0x56ee77(0x109)](_0x1fa258),_0x1fa258;}async['run'](){const _0x308d27=a111_0x1173c3;this[_0x308d27(0x101)]=typedi_1[_0x308d27(0x105)]['get'](providers_tokens_1[_0x308d27(0xec)][_0x308d27(0x101)]),this[_0x308d27(0x11e)]=typedi_1[_0x308d27(0x105)][_0x308d27(0xe3)](providers_tokens_1[_0x308d27(0xec)][_0x308d27(0xce)]),this[_0x308d27(0xda)]=typedi_1[_0x308d27(0x105)][_0x308d27(0xe3)](providers_tokens_1['Tokens']['config']),this[_0x308d27(0xd5)]=typedi_1[_0x308d27(0x105)][_0x308d27(0xe3)](providers_tokens_1['Tokens'][_0x308d27(0x126)]),this[_0x308d27(0xeb)]='['+SyncService_1['name']+_0x308d27(0xff)+this[_0x308d27(0xda)]['gitProvider'][_0x308d27(0x112)]()+']',this['salesforceService'][_0x308d27(0xc8)](this['sfLogger']['getLoggerId']());try{this[_0x308d27(0xd5)][_0x308d27(0xd7)](this['prefix']+_0x308d27(0xe1)),await this[_0x308d27(0xd5)][_0x308d27(0xd7)](this[_0x308d27(0xeb)]+'\x20Getting\x20repository\x20records.')[_0x308d27(0x116)]();const _0xe21ec7=await this[_0x308d27(0x117)][_0x308d27(0xbc)](typedi_1[_0x308d27(0x105)][_0x308d27(0xe3)](providers_tokens_1['Tokens'][_0x308d27(0xe4)]));if(!_0xe21ec7[_0x308d27(0xb8)])throw new bad_request_error_1[(_0x308d27(0xf8))](this[_0x308d27(0xeb)]+_0x308d27(0xfc));await this[_0x308d27(0xd5)][_0x308d27(0xd7)](this['prefix']+_0x308d27(0x11a))[_0x308d27(0x116)]();const _0x3ab49f=await this[_0x308d27(0x117)][_0x308d27(0x10a)](_0xe21ec7[_0x308d27(0xaf)](_0xafb108=>'\x27'+_0xafb108[_0x308d27(0xe6)]+'\x27')['join'](','));await this[_0x308d27(0xd5)][_0x308d27(0xd7)](this[_0x308d27(0xeb)]+_0x308d27(0xcd))[_0x308d27(0x116)](),this['repoList']=await this['repoService'][_0x308d27(0xa5)]();const _0x292739=[..._0xe21ec7,..._0x3ab49f];this['sfLogger'][_0x308d27(0xd7)](this[_0x308d27(0xeb)]+_0x308d27(0xab)+_0x292739['length']+_0x308d27(0xbf));for(const _0x4e685a of _0x292739){this[_0x308d27(0x126)]['log'](_0x308d27(0x10e)+_0x4e685a[_0x308d27(0xe8)]+'['+_0x4e685a[_0x308d27(0xe6)]+_0x308d27(0xd6)+_0x4e685a['branchName']+'['+_0x4e685a[_0x308d27(0xa8)]+_0x308d27(0xb4)),this[_0x308d27(0xd5)][_0x308d27(0xd7)](this[_0x308d27(0xeb)]+_0x308d27(0xed)+_0x4e685a['repositoryName']+_0x308d27(0x10d)+_0x4e685a[_0x308d27(0xf0)]+'\x22.'),this[_0x308d27(0xd5)][_0x308d27(0xd7)](this[_0x308d27(0xeb)]+_0x308d27(0x125));const _0xbc8a0f=await this[_0x308d27(0xef)](_0x4e685a);if(!_0xbc8a0f)continue;this[_0x308d27(0xd5)]['log'](this[_0x308d27(0xeb)]+_0x308d27(0xb6));const _0x1e42e4=await this[_0x308d27(0xd9)](_0x4e685a);if(_0x1e42e4)continue;await this['sfLogger'][_0x308d27(0x116)]();let _0x450a7d;try{await this[_0x308d27(0xd5)][_0x308d27(0xd7)](this[_0x308d27(0xeb)]+_0x308d27(0xd1))['send'](),_0x450a7d=await this[_0x308d27(0xae)](_0x4e685a,typedi_1[_0x308d27(0x105)][_0x308d27(0xe3)](providers_tokens_1[_0x308d27(0xec)][_0x308d27(0xe4)]));}catch(_0x5233c9){await this[_0x308d27(0xe0)](_0x4e685a,_0x5233c9 instanceof too_many_requests_error_1[_0x308d27(0xb7)]?_0x5233c9:new Error(_0x308d27(0x110)+_0x5233c9));continue;}await this[_0x308d27(0xd5)][_0x308d27(0xd7)](this[_0x308d27(0xeb)]+_0x308d27(0xba))['send']();if(_0x4e685a[_0x308d27(0xad)]===flosum_repository_sync_dto_1[_0x308d27(0xa1)][_0x308d27(0xf4)]){const _0x3241c9=typedi_1['Container'][_0x308d27(0xe3)](flosum_sync_job_1[_0x308d27(0x107)]);await _0x3241c9[_0x308d27(0xb5)]({'repository':_0x450a7d,'convertToSFDX':this[_0x308d27(0xda)][_0x308d27(0xdd)],'syncRecord':_0x4e685a,'provider':this[_0x308d27(0xda)][_0x308d27(0xe2)]})[_0x308d27(0x106)](_0x537027=>this[_0x308d27(0xe0)](_0x4e685a,_0x537027));}else{const _0x58c35a=typedi_1[_0x308d27(0x105)][_0x308d27(0xe3)](git_sync_job_1[_0x308d27(0x11b)]);await _0x58c35a[_0x308d27(0xb5)]({'repository':_0x450a7d,'branch':_0x4e685a[_0x308d27(0xf0)],'provider':this[_0x308d27(0xda)][_0x308d27(0xe2)],'repositoryGit':_0x450a7d['gitUrl'],'syncRecord':_0x4e685a})[_0x308d27(0x106)](_0x1f991a=>this[_0x308d27(0xe0)](_0x4e685a,_0x1f991a));}}}catch(_0x4efa28){this[_0x308d27(0x126)]['error'](_0x4efa28);_0x4efa28 instanceof too_many_requests_error_1[_0x308d27(0xb7)]?(await this[_0x308d27(0xd5)][_0x308d27(0xd7)](this[_0x308d27(0xeb)]+_0x308d27(0xd3))[_0x308d27(0x116)](),await(0x0,utils_1[_0x308d27(0xb9)])(0x3c*0x3c*0x3e8),this['run']()):await this[_0x308d27(0xd5)][_0x308d27(0xdf)](this[_0x308d27(0xeb)]+_0x308d27(0x111)+_0x4efa28)['send']();return;}await this['sfLogger'][_0x308d27(0xd7)](this['prefix']+_0x308d27(0xd8))[_0x308d27(0x116)](),await this['salesforceSync']['disableSync'](typedi_1[_0x308d27(0x105)][_0x308d27(0xe3)](providers_tokens_1[_0x308d27(0xec)]['connectionId']))['catch'](()=>null);}};function a111_0x4832(_0x1a2df7,_0x18485f){const _0x465520=a111_0x413c();return a111_0x4832=function(_0x540a88,_0x5cc5f2){_0x540a88=_0x540a88-0xa0;let _0x413c6f=_0x465520[_0x540a88];return _0x413c6f;},a111_0x4832(_0x1a2df7,_0x18485f);}SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x1173c3(0xa3)])({'transient':!![]}),__metadata(a111_0x1173c3(0x10c),[salesforce_service_1[a111_0x1173c3(0xca)],salesforce_sync_service_1[a111_0x1173c3(0xcb)]])],SyncService),exports[a111_0x1173c3(0x119)]=SyncService;