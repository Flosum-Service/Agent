const a111_0x1e810e=a111_0x4e86;function a111_0x4e86(_0x2943eb,_0x1b5b51){const _0x5158a1=a111_0x1aa3();return a111_0x4e86=function(_0x5796e0,_0x4d259c){_0x5796e0=_0x5796e0-0xb9;let _0x1aa3c3=_0x5158a1[_0x5796e0];return _0x1aa3c3;},a111_0x4e86(_0x2943eb,_0x1b5b51);}(function(_0x1217a6,_0x70387c){const _0x56510b=a111_0x4e86,_0x3bc6eb=_0x1217a6();while(!![]){try{const _0x3a1ee0=parseInt(_0x56510b(0xbe))/0x1+-parseInt(_0x56510b(0xf2))/0x2*(parseInt(_0x56510b(0x12e))/0x3)+-parseInt(_0x56510b(0xce))/0x4+parseInt(_0x56510b(0xfe))/0x5+parseInt(_0x56510b(0xbc))/0x6*(parseInt(_0x56510b(0x112))/0x7)+parseInt(_0x56510b(0xe3))/0x8*(parseInt(_0x56510b(0x11f))/0x9)+-parseInt(_0x56510b(0xe8))/0xa;if(_0x3a1ee0===_0x70387c)break;else _0x3bc6eb['push'](_0x3bc6eb['shift']());}catch(_0x1da782){_0x3bc6eb['push'](_0x3bc6eb['shift']());}}}(a111_0x1aa3,0xe7b2d));const a111_0x4d259c=(function(){let _0x1b3645=!![];return function(_0x40f6aa,_0x2843e7){const _0x42ccd0=_0x1b3645?function(){const _0x4690f0=a111_0x4e86;if(_0x2843e7){const _0x422ad0=_0x2843e7[_0x4690f0(0x125)](_0x40f6aa,arguments);return _0x2843e7=null,_0x422ad0;}}:function(){};return _0x1b3645=![],_0x42ccd0;};}()),a111_0x5796e0=a111_0x4d259c(this,function(){const _0x212007=a111_0x4e86;return a111_0x5796e0['toString']()[_0x212007(0xc1)]('(((.+)+)+)+$')[_0x212007(0x126)]()[_0x212007(0xec)](a111_0x5796e0)[_0x212007(0xc1)](_0x212007(0xbb));});a111_0x5796e0();function a111_0x1aa3(){const _0x28a8da=['SyncService','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','test','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','131684BYOKMd','\x20No\x20repositories\x20to\x20sync.','Not\x20Synchronized','isBidirectionalSynchronization','getRepositoryRecords','repoService','\x20Start\x20sync\x20job.','Error','\x27\x20[','gitProvider','typedi','logger','isIntersects','723033sVroct','find','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','Unable\x20to\x20synchronize\x20repository\x20\x27','\x20Stop\x20sync\x20job\x20for\x20\x27','SalesforceService','apply','toString','../../providers/web-hooks/hooks.utils','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','../../salesforce/services/salesforce.service','../../salesforce/dto/flosum-repository-sync.dto','BadRequestError','getOwnPropertyDescriptor','metadata','154821qunDTR','url','\x20Getting\x20repositories\x20from\x20git\x20service.','disableSync','Container','join','config','SyncDirection','FlosumToGit',']\x20due\x20error\x20-\x20','repositoryName','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','branchId','Unable\x20to\x20synchronize\x20branch\x20\x27','(((.+)+)+)+$','198cfoAkG','../errors/git-branch-not-found.error','1666047qedCoG','gitRepoService','SalesforceSyncService','search','catch','name','Tokens','length','\x20Getting\x20Flosum\x20repository','hooks','direction','sfLogger','checkValidNaming','getHookLinkFor','BRANCH_NAME_REGEXP','applicationUrl','6438364eqelJB','branchName','../../../../constants','\x20branches.','salesforceSync','getAll',']\x20[','isConvertToSfdx','gitApiService','decorate','TooManyRequests','function','getLoggerId','get','create','design:paramtypes','__decorate','\x20Getting\x20branch\x20records.','HooksUtils','\x20Getting\x20repository\x20records.','error','120LhuhVa','connectionId','repositoryId','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','prefix','13250110dbKndr','object','getOrCreateRepo','run','constructor','repositoriesIntersections','../../salesforce/errors/salesforce.error','\x20Repository\x20\x22','Syncing\x20','\x20Checking\x20valid\x20name.','22fgTVdv','REPOSITORY_NAME_REGEXP','\x20Syncing\x20repository:\x20\x22','map','\x20Sync\x20job\x20done.','toUpperCase','__esModule','defineProperty','\x20Completed\x20prepare\x20to\x20syncing.','push','gitUrl','log','4797090hULziG','../../../../core/errors/too-many-requests.error',']\x20branch.','repoList','send','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','../../../shared/utils','setStatus','../../../../core','getBranchRecords','Waiting','handleRecordSyncError','SalesforceError','\x20Checking\x20intersects.','createHookPayload','Service'];a111_0x1aa3=function(){return _0x28a8da;};return a111_0x1aa3();}'use strict';var __decorate=this&&this[a111_0x1e810e(0xde)]||function(_0x28a319,_0x2e561d,_0x22657b,_0x38772d){const _0x3b0c1f=a111_0x1e810e;var _0xb956f0=arguments['length'],_0x377d24=_0xb956f0<0x3?_0x2e561d:_0x38772d===null?_0x38772d=Object[_0x3b0c1f(0x12c)](_0x2e561d,_0x22657b):_0x38772d,_0x4661f6;if(typeof Reflect===_0x3b0c1f(0xe9)&&typeof Reflect['decorate']===_0x3b0c1f(0xd9))_0x377d24=Reflect[_0x3b0c1f(0xd7)](_0x28a319,_0x2e561d,_0x22657b,_0x38772d);else{for(var _0x4866c3=_0x28a319[_0x3b0c1f(0xc5)]-0x1;_0x4866c3>=0x0;_0x4866c3--)if(_0x4661f6=_0x28a319[_0x4866c3])_0x377d24=(_0xb956f0<0x3?_0x4661f6(_0x377d24):_0xb956f0>0x3?_0x4661f6(_0x2e561d,_0x22657b,_0x377d24):_0x4661f6(_0x2e561d,_0x22657b))||_0x377d24;}return _0xb956f0>0x3&&_0x377d24&&Object[_0x3b0c1f(0xf9)](_0x2e561d,_0x22657b,_0x377d24),_0x377d24;},__metadata=this&&this['__metadata']||function(_0x539fe2,_0x36d01e){const _0x38515c=a111_0x1e810e;if(typeof Reflect===_0x38515c(0xe9)&&typeof Reflect['metadata']===_0x38515c(0xd9))return Reflect[_0x38515c(0x12d)](_0x539fe2,_0x36d01e);},SyncService_1;Object[a111_0x1e810e(0xf9)](exports,a111_0x1e810e(0xf8),{'value':!![]}),exports[a111_0x1e810e(0x10e)]=void 0x0;const constants_1=require(a111_0x1e810e(0xd0)),core_1=require(a111_0x1e810e(0x106)),too_many_requests_error_1=require(a111_0x1e810e(0xff)),flosum_repository_sync_dto_1=require(a111_0x1e810e(0x12a)),salesforce_error_1=require(a111_0x1e810e(0xee)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a111_0x1e810e(0x129)),utils_1=require(a111_0x1e810e(0x104)),typedi_1=require(a111_0x1e810e(0x11c)),hooks_utils_1=require(a111_0x1e810e(0x127)),git_branch_not_found_error_1=require(a111_0x1e810e(0xbd)),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require('../../providers/providers.tokens'),bad_request_error_1=require('../../../../core/errors/bad-request.error');let SyncService=SyncService_1=class SyncService{constructor(_0x251c43,_0x407c22){const _0x48d68d=a111_0x1e810e;this['salesforceService']=_0x251c43,this[_0x48d68d(0xd2)]=_0x407c22,this[_0x48d68d(0x11d)]=new core_1['Logger'](SyncService_1[_0x48d68d(0xc3)]),this[_0x48d68d(0xed)]={},this[_0x48d68d(0x101)]=[];}async['handleRecordSyncError'](_0x3ec575,_0x41c871){const _0x3f1405=a111_0x1e810e;if(_0x41c871 instanceof git_branch_not_found_error_1['GitBranchNotFoundError']){await this[_0x3f1405(0xd2)]['setStatus'](_0x3ec575,_0x3f1405(0x114));return;}if(_0x41c871 instanceof too_many_requests_error_1[_0x3f1405(0xd8)]){await this[_0x3f1405(0xd2)][_0x3f1405(0x105)](_0x3ec575,_0x3f1405(0x108));throw _0x41c871;}try{await this[_0x3f1405(0xc9)][_0x3f1405(0xe2)](this['prefix']+_0x3f1405(0x123)+_0x3ec575[_0x3f1405(0x138)]+_0x3f1405(0x11a)+_0x3ec575[_0x3f1405(0xcf)]+_0x3f1405(0x137)+_0x41c871+'.')[_0x3f1405(0x102)](),await this[_0x3f1405(0xd2)]['updateRemoteState'](_0x3ec575,{}),await this[_0x3f1405(0xd2)][_0x3f1405(0x105)](_0x3ec575,_0x3f1405(0x119));}catch(_0x202b5d){if(_0x202b5d instanceof salesforce_error_1[_0x3f1405(0x10a)])throw _0x202b5d;}}async[a111_0x1e810e(0x11e)](_0x306f24){const _0x4c6f51=a111_0x1e810e;if(_0x306f24['repositoryId']){const _0x1b666e=_0x306f24[_0x4c6f51(0x138)]['toLowerCase'](),_0x1db3c6=this[_0x4c6f51(0xed)][_0x1b666e];if(!_0x1db3c6)this[_0x4c6f51(0xed)][_0x1b666e]=_0x306f24['repositoryName'];else{if(_0x1db3c6&&_0x1db3c6!==_0x306f24[_0x4c6f51(0x138)])return await this[_0x4c6f51(0x109)](_0x306f24,new Error(_0x4c6f51(0x122)+_0x306f24[_0x4c6f51(0x138)]+_0x4c6f51(0x139)+_0x1b666e+'\x27\x20-\x20\x27'+_0x1db3c6+'\x27')),!![];}}return![];}async[a111_0x1e810e(0xca)](_0x6cc8ba){const _0x445192=a111_0x1e810e;if(!constants_1[_0x445192(0xf3)][_0x445192(0x110)](_0x6cc8ba[_0x445192(0x138)]))return await this[_0x445192(0x109)](_0x6cc8ba,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x6cc8ba[_0x445192(0x138)]+_0x445192(0x121))),![];if(!constants_1[_0x445192(0xcc)]['test'](_0x6cc8ba[_0x445192(0xcf)]))return await this[_0x445192(0x109)](_0x6cc8ba,new Error(_0x445192(0xba)+_0x6cc8ba['branchName']+'\x27\x20in\x20repository\x20\x27'+_0x6cc8ba[_0x445192(0x138)]+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async[a111_0x1e810e(0xea)](_0x5eff22,_0x4a9266){const _0x5d00f9=a111_0x1e810e;let _0x458328=this[_0x5d00f9(0x101)][_0x5d00f9(0x120)](_0x1eef2e=>_0x5eff22[_0x5d00f9(0x138)]===_0x1eef2e[_0x5d00f9(0xc3)]);!_0x458328&&(this[_0x5d00f9(0xc9)][_0x5d00f9(0xfd)](this[_0x5d00f9(0xe7)]+_0x5d00f9(0xef)+_0x5eff22[_0x5d00f9(0x138)]+_0x5d00f9(0x10f)),_0x458328=await this[_0x5d00f9(0x117)]['create']({'name':_0x5eff22[_0x5d00f9(0x138)],'autoInit':!![],'defaultBranch':_0x5eff22[_0x5d00f9(0xcf)],'private':!![],'createHook':typedi_1[_0x5d00f9(0x132)][_0x5d00f9(0xdb)](providers_tokens_1['Tokens'][_0x5d00f9(0x134)])['isBidirectionalSynchronization']}));if(this[_0x5d00f9(0x134)][_0x5d00f9(0x115)]){const _0x35364c=await _0x458328[_0x5d00f9(0xc7)][_0x5d00f9(0xd3)]();!_0x35364c['find'](_0x3f19bd=>_0x3f19bd[_0x5d00f9(0x12f)]===hooks_utils_1[_0x5d00f9(0xe0)][_0x5d00f9(0xcb)](this[_0x5d00f9(0x134)]['gitProvider'],this['config'][_0x5d00f9(0xcd)],_0x4a9266))&&(this[_0x5d00f9(0xc9)][_0x5d00f9(0xfd)](this[_0x5d00f9(0xe7)]+'\x20Repository\x20\x22'+_0x5eff22[_0x5d00f9(0x138)]+_0x5d00f9(0x111)),await _0x458328[_0x5d00f9(0xc7)][_0x5d00f9(0xdc)](hooks_utils_1[_0x5d00f9(0xe0)][_0x5d00f9(0x10c)](this[_0x5d00f9(0x134)][_0x5d00f9(0x11b)],_0x458328[_0x5d00f9(0xc7)],this[_0x5d00f9(0x134)][_0x5d00f9(0xcd)],_0x4a9266)));}return this[_0x5d00f9(0x101)][_0x5d00f9(0xfb)](_0x458328),_0x458328;}async[a111_0x1e810e(0xeb)](){const _0xb4be15=a111_0x1e810e;this['gitApiService']=typedi_1[_0xb4be15(0x132)][_0xb4be15(0xdb)](providers_tokens_1[_0xb4be15(0xc4)][_0xb4be15(0xd6)]),this[_0xb4be15(0x117)]=typedi_1[_0xb4be15(0x132)][_0xb4be15(0xdb)](providers_tokens_1['Tokens'][_0xb4be15(0xbf)]),this[_0xb4be15(0x134)]=typedi_1[_0xb4be15(0x132)]['get'](providers_tokens_1[_0xb4be15(0xc4)][_0xb4be15(0x134)]),this[_0xb4be15(0xc9)]=typedi_1[_0xb4be15(0x132)]['get'](providers_tokens_1[_0xb4be15(0xc4)][_0xb4be15(0x11d)]),this[_0xb4be15(0xe7)]='['+SyncService_1[_0xb4be15(0xc3)]+_0xb4be15(0xd4)+this['config']['gitProvider'][_0xb4be15(0xf7)]()+']',this['salesforceService']['setLoggerId'](this[_0xb4be15(0xc9)][_0xb4be15(0xda)]());try{this[_0xb4be15(0xc9)][_0xb4be15(0xfd)](this[_0xb4be15(0xe7)]+_0xb4be15(0x118)),await this['sfLogger'][_0xb4be15(0xfd)](this[_0xb4be15(0xe7)]+_0xb4be15(0xe1))[_0xb4be15(0x102)]();const _0x4f0d19=await this[_0xb4be15(0xd2)][_0xb4be15(0x116)](typedi_1[_0xb4be15(0x132)][_0xb4be15(0xdb)](providers_tokens_1[_0xb4be15(0xc4)][_0xb4be15(0xe4)]));if(!_0x4f0d19['length'])throw new bad_request_error_1[(_0xb4be15(0x12b))](this[_0xb4be15(0xe7)]+_0xb4be15(0x113));await this['sfLogger'][_0xb4be15(0xfd)](this[_0xb4be15(0xe7)]+_0xb4be15(0xdf))[_0xb4be15(0x102)]();const _0x16f284=await this[_0xb4be15(0xd2)][_0xb4be15(0x107)](_0x4f0d19[_0xb4be15(0xf5)](_0x1867a9=>'\x27'+_0x1867a9[_0xb4be15(0xe5)]+'\x27')[_0xb4be15(0x133)](','));await this['sfLogger'][_0xb4be15(0xfd)](this['prefix']+_0xb4be15(0x130))[_0xb4be15(0x102)](),this['repoList']=await this[_0xb4be15(0x117)]['getAll']();const _0x4b1865=[..._0x4f0d19,..._0x16f284];this[_0xb4be15(0xc9)][_0xb4be15(0xfd)](this[_0xb4be15(0xe7)]+'\x20Have\x20to\x20synchronize\x20'+_0x4b1865[_0xb4be15(0xc5)]+_0xb4be15(0xd1));for(const _0xddf697 of _0x4b1865){this['logger'][_0xb4be15(0xfd)](_0xb4be15(0xf0)+_0xddf697['repositoryName']+'['+_0xddf697[_0xb4be15(0xe5)]+']\x20repository\x20'+_0xddf697['branchName']+'['+_0xddf697[_0xb4be15(0xb9)]+_0xb4be15(0x100)),this[_0xb4be15(0xc9)]['log'](this[_0xb4be15(0xe7)]+_0xb4be15(0xf4)+_0xddf697['repositoryName']+'\x22\x20branch:\x20\x22'+_0xddf697[_0xb4be15(0xcf)]+'\x22.'),this[_0xb4be15(0xc9)][_0xb4be15(0xfd)](this[_0xb4be15(0xe7)]+_0xb4be15(0xf1));const _0x21b744=await this['checkValidNaming'](_0xddf697);if(!_0x21b744)continue;this['sfLogger'][_0xb4be15(0xfd)](this[_0xb4be15(0xe7)]+_0xb4be15(0x10b));const _0x2fcfb0=await this[_0xb4be15(0x11e)](_0xddf697);if(_0x2fcfb0)continue;await this[_0xb4be15(0xc9)][_0xb4be15(0x102)]();let _0x16e6fb;try{await this[_0xb4be15(0xc9)][_0xb4be15(0xfd)](this['prefix']+_0xb4be15(0xc6))[_0xb4be15(0x102)](),_0x16e6fb=await this['getOrCreateRepo'](_0xddf697,typedi_1[_0xb4be15(0x132)][_0xb4be15(0xdb)](providers_tokens_1[_0xb4be15(0xc4)][_0xb4be15(0xe4)]));}catch(_0xabd52a){await this[_0xb4be15(0x109)](_0xddf697,_0xabd52a instanceof too_many_requests_error_1[_0xb4be15(0xd8)]?_0xabd52a:new Error(_0xb4be15(0x103)+_0xabd52a));continue;}await this[_0xb4be15(0xc9)][_0xb4be15(0xfd)](this[_0xb4be15(0xe7)]+_0xb4be15(0xfa))['send']();if(_0xddf697[_0xb4be15(0xc8)]===flosum_repository_sync_dto_1[_0xb4be15(0x135)][_0xb4be15(0x136)]){const _0x44df22=typedi_1[_0xb4be15(0x132)][_0xb4be15(0xdb)](flosum_sync_job_1['FlosumSyncJob']);await _0x44df22[_0xb4be15(0xeb)]({'repository':_0x16e6fb,'convertToSFDX':this[_0xb4be15(0x134)][_0xb4be15(0xd5)],'syncRecord':_0xddf697,'provider':this[_0xb4be15(0x134)][_0xb4be15(0x11b)]})[_0xb4be15(0xc2)](_0x43b0f1=>this['handleRecordSyncError'](_0xddf697,_0x43b0f1));}else{const _0x201255=typedi_1[_0xb4be15(0x132)][_0xb4be15(0xdb)](git_sync_job_1['GitSyncJob']);await _0x201255['run']({'repository':_0x16e6fb,'branch':_0xddf697[_0xb4be15(0xcf)],'provider':this['config'][_0xb4be15(0x11b)],'repositoryGit':_0x16e6fb[_0xb4be15(0xfc)],'syncRecord':_0xddf697})[_0xb4be15(0xc2)](_0x172647=>this[_0xb4be15(0x109)](_0xddf697,_0x172647));}}}catch(_0x21f67b){this[_0xb4be15(0x11d)][_0xb4be15(0xe2)](_0x21f67b);_0x21f67b instanceof too_many_requests_error_1['TooManyRequests']?(await this[_0xb4be15(0xc9)][_0xb4be15(0xfd)](this[_0xb4be15(0xe7)]+_0xb4be15(0x128))[_0xb4be15(0x102)](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0xb4be15(0xeb)]()):await this[_0xb4be15(0xc9)]['error'](this[_0xb4be15(0xe7)]+_0xb4be15(0xe6)+_0x21f67b)[_0xb4be15(0x102)]();return;}await this[_0xb4be15(0xc9)][_0xb4be15(0xfd)](this['prefix']+_0xb4be15(0xf6))[_0xb4be15(0x102)](),await this[_0xb4be15(0xd2)][_0xb4be15(0x131)](typedi_1[_0xb4be15(0x132)][_0xb4be15(0xdb)](providers_tokens_1['Tokens']['connectionId']))[_0xb4be15(0xc2)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x1e810e(0x10d)])({'transient':!![]}),__metadata(a111_0x1e810e(0xdd),[salesforce_service_1[a111_0x1e810e(0x124)],salesforce_sync_service_1[a111_0x1e810e(0xc0)]])],SyncService),exports['SyncService']=SyncService;