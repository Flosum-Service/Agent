const a110_0xb71225=a110_0x4890;(function(_0x616d37,_0x25ac50){const _0x14f9a9=a110_0x4890,_0x14a07c=_0x616d37();while(!![]){try{const _0x3903c9=parseInt(_0x14f9a9(0xac))/0x1*(parseInt(_0x14f9a9(0x102))/0x2)+parseInt(_0x14f9a9(0x107))/0x3+parseInt(_0x14f9a9(0x118))/0x4*(parseInt(_0x14f9a9(0xf3))/0x5)+parseInt(_0x14f9a9(0xd7))/0x6+-parseInt(_0x14f9a9(0xb8))/0x7*(parseInt(_0x14f9a9(0x101))/0x8)+-parseInt(_0x14f9a9(0x111))/0x9*(-parseInt(_0x14f9a9(0xe8))/0xa)+parseInt(_0x14f9a9(0x105))/0xb*(-parseInt(_0x14f9a9(0x120))/0xc);if(_0x3903c9===_0x25ac50)break;else _0x14a07c['push'](_0x14a07c['shift']());}catch(_0x2d9edb){_0x14a07c['push'](_0x14a07c['shift']());}}}(a110_0x28b0,0x66ebc));const a110_0x13f5ea=(function(){let _0x3eecba=!![];return function(_0x2c061a,_0x13a6bd){const _0x15f6c1=_0x3eecba?function(){const _0x5776bb=a110_0x4890;if(_0x13a6bd){const _0x154be1=_0x13a6bd[_0x5776bb(0xab)](_0x2c061a,arguments);return _0x13a6bd=null,_0x154be1;}}:function(){};return _0x3eecba=![],_0x15f6c1;};}()),a110_0x4997ce=a110_0x13f5ea(this,function(){const _0x4e54f4=a110_0x4890;return a110_0x4997ce[_0x4e54f4(0xec)]()[_0x4e54f4(0xfe)]('(((.+)+)+)+$')['toString']()[_0x4e54f4(0xd6)](a110_0x4997ce)['search'](_0x4e54f4(0xda));});function a110_0x4890(_0x4efe59,_0x49926c){const _0x5a1635=a110_0x28b0();return a110_0x4890=function(_0x4997ce,_0x13f5ea){_0x4997ce=_0x4997ce-0xa3;let _0x28b067=_0x5a1635[_0x4997ce];return _0x28b067;},a110_0x4890(_0x4efe59,_0x49926c);}a110_0x4997ce();'use strict';var __decorate=this&&this['__decorate']||function(_0x17e8d3,_0x298ea2,_0x1db964,_0x12588f){const _0x259cfb=a110_0x4890;var _0x3ba7b3=arguments['length'],_0x19aa12=_0x3ba7b3<0x3?_0x298ea2:_0x12588f===null?_0x12588f=Object['getOwnPropertyDescriptor'](_0x298ea2,_0x1db964):_0x12588f,_0x13fb7f;if(typeof Reflect===_0x259cfb(0xeb)&&typeof Reflect[_0x259cfb(0xa3)]===_0x259cfb(0xe7))_0x19aa12=Reflect[_0x259cfb(0xa3)](_0x17e8d3,_0x298ea2,_0x1db964,_0x12588f);else{for(var _0x42f966=_0x17e8d3['length']-0x1;_0x42f966>=0x0;_0x42f966--)if(_0x13fb7f=_0x17e8d3[_0x42f966])_0x19aa12=(_0x3ba7b3<0x3?_0x13fb7f(_0x19aa12):_0x3ba7b3>0x3?_0x13fb7f(_0x298ea2,_0x1db964,_0x19aa12):_0x13fb7f(_0x298ea2,_0x1db964))||_0x19aa12;}return _0x3ba7b3>0x3&&_0x19aa12&&Object['defineProperty'](_0x298ea2,_0x1db964,_0x19aa12),_0x19aa12;},__metadata=this&&this[a110_0xb71225(0xd4)]||function(_0x27ef7e,_0x316e5d){const _0x50c362=a110_0xb71225;if(typeof Reflect==='object'&&typeof Reflect[_0x50c362(0x10a)]===_0x50c362(0xe7))return Reflect[_0x50c362(0x10a)](_0x27ef7e,_0x316e5d);},SyncService_1;function a110_0x28b0(){const _0x4f4c7b=['REPOSITORY_NAME_REGEXP','Tokens','__metadata','\x20branches.','constructor','358806KmPytc','../../providers/web-hooks/hooks.utils','\x20Getting\x20repositories\x20from\x20git\x20service.','(((.+)+)+)+$','BRANCH_NAME_REGEXP','repoList','HooksUtils','isBidirectionalSynchronization','TooManyRequests','run','config',']\x20due\x20error\x20-\x20','getHookLinkFor','error','../../../shared/utils','Service','function','765520FVOZbt','../../salesforce/dto/flosum-repository-sync.dto','find','object','toString','SalesforceService','Logger','repositoryName',']\x20repository\x20','join','applicationUrl','3285oxYcIS','design:paramtypes','../../salesforce/errors/salesforce.error','getOrCreateRepo','length','send','GitBranchNotFoundError','\x22\x20branch:\x20\x22','\x20Stop\x20sync\x20job\x20for\x20\x27','Container','repoService','search','\x20Getting\x20branch\x20records.','logger','216eLOwAr','134pGUvMZ','defineProperty','connectionId','39523AQBJVt','salesforceSync','1529217GNXZRM','\x20Sync\x20job\x20done.','log','metadata','SyncDirection','disableSync','getAll','getRepositoryRecords','../errors/git-branch-not-found.error','handleRecordSyncError','45RsClPX','branchName','\x20Have\x20to\x20synchronize\x20','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','../../salesforce/services/salesforce-sync.service','FlosumToGit','2456awujkP','\x20No\x20repositories\x20to\x20sync.','\x20Start\x20sync\x20job.','\x27\x20-\x20\x27','checkValidNaming','gitRepoService','salesforceService','Unable\x20to\x20synchronize\x20branch\x20\x27','3144nyMIlD','createHookPayload','\x20Syncing\x20repository:\x20\x22','decorate','gitProvider','isIntersects','isConvertToSfdx','\x20Checking\x20intersects.','direction','GitSyncJob','gitUrl','apply','4409qVGtNy','toUpperCase','updateRemoteState','repositoriesIntersections','sleep','Syncing\x20','typedi','gitApiService','setStatus','setLoggerId','test','SalesforceSyncService','74711GbWGBG','sfLogger','repositoryId',']\x20[','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','prefix','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','name','__esModule','Error','\x27\x20[','../../../../core/errors/too-many-requests.error','\x20Repository\x20\x22','create','../../salesforce/services/salesforce.service','toLowerCase','../../providers/providers.tokens','get','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','Not\x20Synchronized','url','\x20Checking\x20valid\x20name.','SyncService','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','../jobs/flosum-sync.job','hooks'];a110_0x28b0=function(){return _0x4f4c7b;};return a110_0x28b0();}Object[a110_0xb71225(0x103)](exports,a110_0xb71225(0xc0),{'value':!![]}),exports[a110_0xb71225(0xce)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require('../../../../core'),too_many_requests_error_1=require(a110_0xb71225(0xc3)),flosum_repository_sync_dto_1=require(a110_0xb71225(0xe9)),salesforce_error_1=require(a110_0xb71225(0xf5)),salesforce_sync_service_1=require(a110_0xb71225(0x116)),salesforce_service_1=require(a110_0xb71225(0xc6)),utils_1=require(a110_0xb71225(0xe5)),typedi_1=require(a110_0xb71225(0xb2)),hooks_utils_1=require(a110_0xb71225(0xd8)),git_branch_not_found_error_1=require(a110_0xb71225(0x10f)),flosum_sync_job_1=require(a110_0xb71225(0xd0)),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require(a110_0xb71225(0xc8)),bad_request_error_1=require('../../../../core/errors/bad-request.error');let SyncService=SyncService_1=class SyncService{constructor(_0x37f5c5,_0x2bd740){const _0x3d88b7=a110_0xb71225;this['salesforceService']=_0x37f5c5,this[_0x3d88b7(0x106)]=_0x2bd740,this[_0x3d88b7(0x100)]=new core_1[(_0x3d88b7(0xee))](SyncService_1[_0x3d88b7(0xbf)]),this[_0x3d88b7(0xaf)]={},this[_0x3d88b7(0xdc)]=[];}async[a110_0xb71225(0x110)](_0x2b7876,_0x415b81){const _0x175b69=a110_0xb71225;if(_0x415b81 instanceof git_branch_not_found_error_1[_0x175b69(0xf9)]){await this[_0x175b69(0x106)]['setStatus'](_0x2b7876,_0x175b69(0xcb));return;}if(_0x415b81 instanceof too_many_requests_error_1[_0x175b69(0xdf)]){await this[_0x175b69(0x106)][_0x175b69(0xb4)](_0x2b7876,'Waiting');throw _0x415b81;}try{await this[_0x175b69(0xb9)][_0x175b69(0xe4)](this[_0x175b69(0xbd)]+_0x175b69(0xfb)+_0x2b7876[_0x175b69(0xef)]+_0x175b69(0xc2)+_0x2b7876[_0x175b69(0x112)]+_0x175b69(0xe2)+_0x415b81+'.')[_0x175b69(0xf8)](),await this[_0x175b69(0x106)][_0x175b69(0xae)](_0x2b7876,{}),await this[_0x175b69(0x106)][_0x175b69(0xb4)](_0x2b7876,_0x175b69(0xc1));}catch(_0x56edf0){if(_0x56edf0 instanceof salesforce_error_1['SalesforceError'])throw _0x56edf0;}}async['isIntersects'](_0x4591d6){const _0x356551=a110_0xb71225;if(_0x4591d6[_0x356551(0xba)]){const _0x2881b7=_0x4591d6[_0x356551(0xef)][_0x356551(0xc7)](),_0x50b376=this[_0x356551(0xaf)][_0x2881b7];if(!_0x50b376)this[_0x356551(0xaf)][_0x2881b7]=_0x4591d6[_0x356551(0xef)];else{if(_0x50b376&&_0x50b376!==_0x4591d6[_0x356551(0xef)])return await this[_0x356551(0x110)](_0x4591d6,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x4591d6[_0x356551(0xef)]+_0x356551(0xca)+_0x2881b7+_0x356551(0x11b)+_0x50b376+'\x27')),!![];}}return![];}async['checkValidNaming'](_0x41f583){const _0xb0b975=a110_0xb71225;if(!constants_1[_0xb0b975(0xd2)][_0xb0b975(0xb6)](_0x41f583[_0xb0b975(0xef)]))return await this[_0xb0b975(0x110)](_0x41f583,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x41f583[_0xb0b975(0xef)]+_0xb0b975(0x114))),![];if(!constants_1[_0xb0b975(0xdb)]['test'](_0x41f583[_0xb0b975(0x112)]))return await this[_0xb0b975(0x110)](_0x41f583,new Error(_0xb0b975(0x11f)+_0x41f583[_0xb0b975(0x112)]+'\x27\x20in\x20repository\x20\x27'+_0x41f583[_0xb0b975(0xef)]+_0xb0b975(0x115))),![];return!![];}async['getOrCreateRepo'](_0x3a26a6,_0xff20aa){const _0x386e9f=a110_0xb71225;let _0xf7095a=this[_0x386e9f(0xdc)][_0x386e9f(0xea)](_0x5b0d34=>_0x3a26a6[_0x386e9f(0xef)]===_0x5b0d34[_0x386e9f(0xbf)]);!_0xf7095a&&(this[_0x386e9f(0xb9)][_0x386e9f(0x109)](this[_0x386e9f(0xbd)]+'\x20Repository\x20\x22'+_0x3a26a6[_0x386e9f(0xef)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0xf7095a=await this['repoService'][_0x386e9f(0xc5)]({'name':_0x3a26a6[_0x386e9f(0xef)],'autoInit':!![],'defaultBranch':_0x3a26a6['branchName'],'private':!![],'createHook':typedi_1[_0x386e9f(0xfc)][_0x386e9f(0xc9)](providers_tokens_1['Tokens']['config'])[_0x386e9f(0xde)]}));if(this['config'][_0x386e9f(0xde)]){const _0x20035f=await _0xf7095a['hooks']['getAll']();!_0x20035f['find'](_0x28c8cc=>_0x28c8cc[_0x386e9f(0xcc)]===hooks_utils_1[_0x386e9f(0xdd)][_0x386e9f(0xe3)](this[_0x386e9f(0xe1)]['gitProvider'],this[_0x386e9f(0xe1)][_0x386e9f(0xf2)],_0xff20aa))&&(this[_0x386e9f(0xb9)][_0x386e9f(0x109)](this[_0x386e9f(0xbd)]+_0x386e9f(0xc4)+_0x3a26a6[_0x386e9f(0xef)]+_0x386e9f(0xbc)),await _0xf7095a[_0x386e9f(0xd1)]['create'](hooks_utils_1[_0x386e9f(0xdd)][_0x386e9f(0x121)](this[_0x386e9f(0xe1)][_0x386e9f(0xa4)],_0xf7095a['hooks'],this[_0x386e9f(0xe1)][_0x386e9f(0xf2)],_0xff20aa)));}return this[_0x386e9f(0xdc)]['push'](_0xf7095a),_0xf7095a;}async[a110_0xb71225(0xe0)](){const _0x371161=a110_0xb71225;this[_0x371161(0xb3)]=typedi_1[_0x371161(0xfc)]['get'](providers_tokens_1[_0x371161(0xd3)][_0x371161(0xb3)]),this[_0x371161(0xfd)]=typedi_1[_0x371161(0xfc)][_0x371161(0xc9)](providers_tokens_1[_0x371161(0xd3)][_0x371161(0x11d)]),this[_0x371161(0xe1)]=typedi_1['Container'][_0x371161(0xc9)](providers_tokens_1[_0x371161(0xd3)]['config']),this['sfLogger']=typedi_1[_0x371161(0xfc)][_0x371161(0xc9)](providers_tokens_1[_0x371161(0xd3)][_0x371161(0x100)]),this['prefix']='['+SyncService_1['name']+_0x371161(0xbb)+this[_0x371161(0xe1)][_0x371161(0xa4)][_0x371161(0xad)]()+']',this[_0x371161(0x11e)][_0x371161(0xb5)](this[_0x371161(0xb9)]['getLoggerId']());try{this[_0x371161(0xb9)][_0x371161(0x109)](this[_0x371161(0xbd)]+_0x371161(0x11a)),await this[_0x371161(0xb9)]['log'](this[_0x371161(0xbd)]+'\x20Getting\x20repository\x20records.')[_0x371161(0xf8)]();const _0x54c685=await this[_0x371161(0x106)][_0x371161(0x10e)](typedi_1[_0x371161(0xfc)][_0x371161(0xc9)](providers_tokens_1[_0x371161(0xd3)][_0x371161(0x104)]));if(!_0x54c685[_0x371161(0xf7)])throw new bad_request_error_1['BadRequestError'](this[_0x371161(0xbd)]+_0x371161(0x119));await this['sfLogger']['log'](this['prefix']+_0x371161(0xff))['send']();const _0x1fbf4d=await this[_0x371161(0x106)]['getBranchRecords'](_0x54c685['map'](_0x1b5ec5=>'\x27'+_0x1b5ec5['repositoryId']+'\x27')[_0x371161(0xf1)](','));await this['sfLogger'][_0x371161(0x109)](this['prefix']+_0x371161(0xd9))[_0x371161(0xf8)](),this[_0x371161(0xdc)]=await this['repoService'][_0x371161(0x10d)]();const _0x11e912=[..._0x54c685,..._0x1fbf4d];this['sfLogger'][_0x371161(0x109)](this[_0x371161(0xbd)]+_0x371161(0x113)+_0x11e912[_0x371161(0xf7)]+_0x371161(0xd5));for(const _0x491d85 of _0x11e912){this[_0x371161(0x100)][_0x371161(0x109)](_0x371161(0xb1)+_0x491d85[_0x371161(0xef)]+'['+_0x491d85[_0x371161(0xba)]+_0x371161(0xf0)+_0x491d85[_0x371161(0x112)]+'['+_0x491d85['branchId']+']\x20branch.'),this['sfLogger']['log'](this['prefix']+_0x371161(0x122)+_0x491d85[_0x371161(0xef)]+_0x371161(0xfa)+_0x491d85[_0x371161(0x112)]+'\x22.'),this[_0x371161(0xb9)]['log'](this[_0x371161(0xbd)]+_0x371161(0xcd));const _0x24c71d=await this[_0x371161(0x11c)](_0x491d85);if(!_0x24c71d)continue;this[_0x371161(0xb9)][_0x371161(0x109)](this[_0x371161(0xbd)]+_0x371161(0xa7));const _0x13147f=await this[_0x371161(0xa5)](_0x491d85);if(_0x13147f)continue;await this[_0x371161(0xb9)][_0x371161(0xf8)]();let _0x595421;try{await this[_0x371161(0xb9)][_0x371161(0x109)](this[_0x371161(0xbd)]+'\x20Getting\x20Flosum\x20repository')[_0x371161(0xf8)](),_0x595421=await this[_0x371161(0xf6)](_0x491d85,typedi_1[_0x371161(0xfc)]['get'](providers_tokens_1[_0x371161(0xd3)]['connectionId']));}catch(_0xba311d){await this['handleRecordSyncError'](_0x491d85,_0xba311d instanceof too_many_requests_error_1['TooManyRequests']?_0xba311d:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0xba311d));continue;}await this[_0x371161(0xb9)]['log'](this['prefix']+'\x20Completed\x20prepare\x20to\x20syncing.')['send']();if(_0x491d85[_0x371161(0xa8)]===flosum_repository_sync_dto_1[_0x371161(0x10b)][_0x371161(0x117)]){const _0x53c5a5=typedi_1[_0x371161(0xfc)][_0x371161(0xc9)](flosum_sync_job_1['FlosumSyncJob']);await _0x53c5a5['run']({'repository':_0x595421,'convertToSFDX':this[_0x371161(0xe1)][_0x371161(0xa6)],'syncRecord':_0x491d85,'provider':this[_0x371161(0xe1)][_0x371161(0xa4)]})['catch'](_0x1bc097=>this[_0x371161(0x110)](_0x491d85,_0x1bc097));}else{const _0x4998d9=typedi_1[_0x371161(0xfc)][_0x371161(0xc9)](git_sync_job_1[_0x371161(0xa9)]);await _0x4998d9['run']({'repository':_0x595421,'branch':_0x491d85[_0x371161(0x112)],'provider':this['config'][_0x371161(0xa4)],'repositoryGit':_0x595421[_0x371161(0xaa)],'syncRecord':_0x491d85})['catch'](_0x3cf415=>this[_0x371161(0x110)](_0x491d85,_0x3cf415));}}}catch(_0x224eed){this[_0x371161(0x100)][_0x371161(0xe4)](_0x224eed);_0x224eed instanceof too_many_requests_error_1['TooManyRequests']?(await this['sfLogger'][_0x371161(0x109)](this[_0x371161(0xbd)]+_0x371161(0xbe))[_0x371161(0xf8)](),await(0x0,utils_1[_0x371161(0xb0)])(0x3c*0x3c*0x3e8),this[_0x371161(0xe0)]()):await this['sfLogger']['error'](this[_0x371161(0xbd)]+_0x371161(0xcf)+_0x224eed)[_0x371161(0xf8)]();return;}await this['sfLogger'][_0x371161(0x109)](this[_0x371161(0xbd)]+_0x371161(0x108))[_0x371161(0xf8)](),await this['salesforceSync'][_0x371161(0x10c)](typedi_1[_0x371161(0xfc)][_0x371161(0xc9)](providers_tokens_1[_0x371161(0xd3)][_0x371161(0x104)]))['catch'](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a110_0xb71225(0xe6)])({'transient':!![]}),__metadata(a110_0xb71225(0xf4),[salesforce_service_1[a110_0xb71225(0xed)],salesforce_sync_service_1[a110_0xb71225(0xb7)]])],SyncService),exports['SyncService']=SyncService;