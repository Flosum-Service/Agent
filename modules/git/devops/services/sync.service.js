const a80_0x20b13f=a80_0x5bbc;function a80_0xf0b9(){const _0x4da922=['../../salesforce/errors/salesforce.error','repoList','\x27\x20in\x20repository\x20\x27','HooksUtils','\x20Getting\x20repository\x20records.','Container','\x20Repository\x20\x22','typedi','1007442VzuPET','\x20Checking\x20valid\x20name.','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','isBidirectionalSynchronization','../../../shared/utils','../../salesforce/services/salesforce-sync.service','repositoryId','GitSyncJob','setStatus','../../salesforce/services/salesforce.service','\x20Completed\x20prepare\x20to\x20syncing.','19155deeiTC','length','(((.+)+)+)+$','search','TooManyRequests','error','97512TZmmNo','send','Unable\x20to\x20synchronize\x20repository\x20\x27','apply','prefix','push','Syncing\x20','salesforceSync','FlosumSyncJob','getOrCreateRepo','repoService','map','\x20Sync\x20job\x20done.','../errors/git-branch-not-found.error','getLoggerId','../../../../core/errors/too-many-requests.error','isIntersects','direction','../../providers/web-hooks/hooks.utils','\x20branches.','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','gitRepoService','connectionId','catch','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','hooks','SalesforceSyncService','object','toLowerCase',']\x20due\x20error\x20-\x20','GitBranchNotFoundError','repositoryName','REPOSITORY_NAME_REGEXP','branchName','logger','design:paramtypes','isConvertToSfdx','metadata','178733fGqCKb','\x20Checking\x20intersects.','SyncService','test','189900QnuSSo','../../providers/providers.tokens','gitUrl','gitProvider','create','url','336HTPkYJ','SalesforceService','checkValidNaming','Unable\x20to\x20synchronize\x20branch\x20\x27','../../../../constants','../../../../core','\x27\x20-\x20\x27','salesforceService','FlosumToGit','Logger',']\x20[','find','toUpperCase','getRepositoryRecords','\x20Stop\x20sync\x20job\x20for\x20\x27','SyncDirection','__decorate','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','792544JBgglq','Service','function','\x20Getting\x20repositories\x20from\x20git\x20service.','decorate','setLoggerId','Not\x20Synchronized','constructor','\x20Getting\x20Flosum\x20repository','164505mufnLI','__metadata','defineProperty','log','name','applicationUrl','\x27\x20[','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','BadRequestError','gitApiService','handleRecordSyncError','join','config','toString','getBranchRecords',']\x20repository\x20','Tokens','sfLogger','branchId','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','\x20Start\x20sync\x20job.','\x20Have\x20to\x20synchronize\x20','getAll','get','\x20Getting\x20branch\x20records.','run','repositoriesIntersections'];a80_0xf0b9=function(){return _0x4da922;};return a80_0xf0b9();}(function(_0x42815e,_0x71ae6a){const _0x3cc8ff=a80_0x5bbc,_0xbc8ef2=_0x42815e();while(!![]){try{const _0x4747fe=-parseInt(_0x3cc8ff(0x95))/0x1+parseInt(_0x3cc8ff(0x99))/0x2+-parseInt(_0x3cc8ff(0xe8))/0x3+-parseInt(_0x3cc8ff(0xb1))/0x4+parseInt(_0x3cc8ff(0xba))/0x5+-parseInt(_0x3cc8ff(0xdd))/0x6+parseInt(_0x3cc8ff(0x9f))/0x7*(parseInt(_0x3cc8ff(0xee))/0x8);if(_0x4747fe===_0x71ae6a)break;else _0xbc8ef2['push'](_0xbc8ef2['shift']());}catch(_0x5044f3){_0xbc8ef2['push'](_0xbc8ef2['shift']());}}}(a80_0xf0b9,0x277e2));const a80_0x5d34f9=(function(){let _0x157e1b=!![];return function(_0x260f74,_0x4b2625){const _0x50b7c9=_0x157e1b?function(){const _0x50373b=a80_0x5bbc;if(_0x4b2625){const _0x436edb=_0x4b2625[_0x50373b(0xf1)](_0x260f74,arguments);return _0x4b2625=null,_0x436edb;}}:function(){};return _0x157e1b=![],_0x50b7c9;};}()),a80_0x5f060a=a80_0x5d34f9(this,function(){const _0x7bf9b8=a80_0x5bbc;return a80_0x5f060a['toString']()[_0x7bf9b8(0xeb)](_0x7bf9b8(0xea))[_0x7bf9b8(0xc7)]()[_0x7bf9b8(0xb8)](a80_0x5f060a)[_0x7bf9b8(0xeb)](_0x7bf9b8(0xea));});a80_0x5f060a();'use strict';var __decorate=this&&this[a80_0x20b13f(0xaf)]||function(_0x24db0c,_0x5efdec,_0x2442ab,_0x17e1e4){const _0x32127e=a80_0x20b13f;var _0x4a440e=arguments[_0x32127e(0xe9)],_0x581c5b=_0x4a440e<0x3?_0x5efdec:_0x17e1e4===null?_0x17e1e4=Object['getOwnPropertyDescriptor'](_0x5efdec,_0x2442ab):_0x17e1e4,_0x154fe1;if(typeof Reflect===_0x32127e(0x8a)&&typeof Reflect['decorate']===_0x32127e(0xb3))_0x581c5b=Reflect[_0x32127e(0xb5)](_0x24db0c,_0x5efdec,_0x2442ab,_0x17e1e4);else{for(var _0x15d922=_0x24db0c[_0x32127e(0xe9)]-0x1;_0x15d922>=0x0;_0x15d922--)if(_0x154fe1=_0x24db0c[_0x15d922])_0x581c5b=(_0x4a440e<0x3?_0x154fe1(_0x581c5b):_0x4a440e>0x3?_0x154fe1(_0x5efdec,_0x2442ab,_0x581c5b):_0x154fe1(_0x5efdec,_0x2442ab))||_0x581c5b;}return _0x4a440e>0x3&&_0x581c5b&&Object[_0x32127e(0xbc)](_0x5efdec,_0x2442ab,_0x581c5b),_0x581c5b;},__metadata=this&&this[a80_0x20b13f(0xbb)]||function(_0x48956a,_0x140f71){const _0x14711e=a80_0x20b13f;if(typeof Reflect===_0x14711e(0x8a)&&typeof Reflect[_0x14711e(0x94)]===_0x14711e(0xb3))return Reflect[_0x14711e(0x94)](_0x48956a,_0x140f71);},SyncService_1;Object[a80_0x20b13f(0xbc)](exports,'__esModule',{'value':!![]}),exports[a80_0x20b13f(0x97)]=void 0x0;function a80_0x5bbc(_0x23d1eb,_0x7fb652){const _0x3c1f49=a80_0xf0b9();return a80_0x5bbc=function(_0x5f060a,_0x5d34f9){_0x5f060a=_0x5f060a-0x83;let _0xf0b918=_0x3c1f49[_0x5f060a];return _0xf0b918;},a80_0x5bbc(_0x23d1eb,_0x7fb652);}const constants_1=require(a80_0x20b13f(0xa3)),core_1=require(a80_0x20b13f(0xa4)),too_many_requests_error_1=require(a80_0x20b13f(0xfd)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require(a80_0x20b13f(0xd5)),salesforce_sync_service_1=require(a80_0x20b13f(0xe2)),salesforce_service_1=require(a80_0x20b13f(0xe6)),utils_1=require(a80_0x20b13f(0xe1)),typedi_1=require(a80_0x20b13f(0xdc)),hooks_utils_1=require(a80_0x20b13f(0x100)),git_branch_not_found_error_1=require(a80_0x20b13f(0xfb)),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require(a80_0x20b13f(0x9a)),bad_request_error_1=require('../../../../core/errors/bad-request.error');let SyncService=SyncService_1=class SyncService{constructor(_0x408c25,_0xcf38eb){const _0x5d8041=a80_0x20b13f;this['salesforceService']=_0x408c25,this[_0x5d8041(0xf5)]=_0xcf38eb,this[_0x5d8041(0x91)]=new core_1[(_0x5d8041(0xa8))](SyncService_1[_0x5d8041(0xbe)]),this[_0x5d8041(0xd4)]={},this[_0x5d8041(0xd6)]=[];}async[a80_0x20b13f(0xc4)](_0x4385b3,_0x114902){const _0x1ae8c4=a80_0x20b13f;if(_0x114902 instanceof git_branch_not_found_error_1[_0x1ae8c4(0x8d)]){await this[_0x1ae8c4(0xf5)][_0x1ae8c4(0xe5)](_0x4385b3,_0x1ae8c4(0xb7));return;}if(_0x114902 instanceof too_many_requests_error_1[_0x1ae8c4(0xec)]){await this['salesforceSync'][_0x1ae8c4(0xe5)](_0x4385b3,'Waiting');throw _0x114902;}try{await this['sfLogger'][_0x1ae8c4(0xed)](this[_0x1ae8c4(0xf2)]+_0x1ae8c4(0xad)+_0x4385b3[_0x1ae8c4(0x8e)]+_0x1ae8c4(0xc0)+_0x4385b3[_0x1ae8c4(0x90)]+_0x1ae8c4(0x8c)+_0x114902+'.')[_0x1ae8c4(0xef)](),await this['salesforceSync']['updateRemoteState'](_0x4385b3,{}),await this[_0x1ae8c4(0xf5)]['setStatus'](_0x4385b3,'Error');}catch(_0x434915){if(_0x434915 instanceof salesforce_error_1['SalesforceError'])throw _0x434915;}}async[a80_0x20b13f(0xfe)](_0x3df276){const _0x3c0249=a80_0x20b13f;if(_0x3df276[_0x3c0249(0xe3)]){const _0x34e34f=_0x3df276[_0x3c0249(0x8e)][_0x3c0249(0x8b)](),_0x1fd215=this[_0x3c0249(0xd4)][_0x34e34f];if(!_0x1fd215)this['repositoriesIntersections'][_0x34e34f]=_0x3df276['repositoryName'];else{if(_0x1fd215&&_0x1fd215!==_0x3df276[_0x3c0249(0x8e)])return await this[_0x3c0249(0xc4)](_0x3df276,new Error(_0x3c0249(0xf0)+_0x3df276[_0x3c0249(0x8e)]+_0x3c0249(0xdf)+_0x34e34f+_0x3c0249(0xa5)+_0x1fd215+'\x27')),!![];}}return![];}async[a80_0x20b13f(0xa1)](_0x31b81d){const _0x3edcdf=a80_0x20b13f;if(!constants_1[_0x3edcdf(0x8f)][_0x3edcdf(0x98)](_0x31b81d[_0x3edcdf(0x8e)]))return await this[_0x3edcdf(0xc4)](_0x31b81d,new Error(_0x3edcdf(0xf0)+_0x31b81d[_0x3edcdf(0x8e)]+_0x3edcdf(0xb0))),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x3edcdf(0x98)](_0x31b81d['branchName']))return await this[_0x3edcdf(0xc4)](_0x31b81d,new Error(_0x3edcdf(0xa2)+_0x31b81d[_0x3edcdf(0x90)]+_0x3edcdf(0xd7)+_0x31b81d['repositoryName']+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async[a80_0x20b13f(0xf7)](_0x226e1e,_0x3f4f47){const _0x97b920=a80_0x20b13f;let _0x144a01=this[_0x97b920(0xd6)][_0x97b920(0xaa)](_0xca2e96=>_0x226e1e['repositoryName']===_0xca2e96['name']);!_0x144a01&&(this[_0x97b920(0xcb)][_0x97b920(0xbd)](this[_0x97b920(0xf2)]+_0x97b920(0xdb)+_0x226e1e[_0x97b920(0x8e)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x144a01=await this[_0x97b920(0xf8)][_0x97b920(0x9d)]({'name':_0x226e1e[_0x97b920(0x8e)],'autoInit':!![],'defaultBranch':_0x226e1e['branchName'],'private':!![],'createHook':typedi_1[_0x97b920(0xda)][_0x97b920(0xd1)](providers_tokens_1[_0x97b920(0xca)]['config'])[_0x97b920(0xe0)]}));if(this['config']['isBidirectionalSynchronization']){const _0x423365=await _0x144a01[_0x97b920(0x88)]['getAll']();!_0x423365[_0x97b920(0xaa)](_0xd83793=>_0xd83793[_0x97b920(0x9e)]===hooks_utils_1[_0x97b920(0xd8)]['getHookLinkFor'](this['config'][_0x97b920(0x9c)],this['config'][_0x97b920(0xbf)],_0x3f4f47))&&(this['sfLogger']['log'](this['prefix']+_0x97b920(0xdb)+_0x226e1e[_0x97b920(0x8e)]+_0x97b920(0x83)),await _0x144a01['hooks'][_0x97b920(0x9d)](hooks_utils_1[_0x97b920(0xd8)]['createHookPayload'](this[_0x97b920(0xc6)]['gitProvider'],_0x144a01['hooks'],this['config'][_0x97b920(0xbf)],_0x3f4f47)));}return this[_0x97b920(0xd6)][_0x97b920(0xf3)](_0x144a01),_0x144a01;}async[a80_0x20b13f(0xd3)](){const _0x238f31=a80_0x20b13f;this[_0x238f31(0xc3)]=typedi_1['Container'][_0x238f31(0xd1)](providers_tokens_1[_0x238f31(0xca)]['gitApiService']),this['repoService']=typedi_1[_0x238f31(0xda)][_0x238f31(0xd1)](providers_tokens_1[_0x238f31(0xca)][_0x238f31(0x84)]),this[_0x238f31(0xc6)]=typedi_1[_0x238f31(0xda)][_0x238f31(0xd1)](providers_tokens_1[_0x238f31(0xca)][_0x238f31(0xc6)]),this[_0x238f31(0xcb)]=typedi_1['Container'][_0x238f31(0xd1)](providers_tokens_1[_0x238f31(0xca)][_0x238f31(0x91)]),this['prefix']='['+SyncService_1[_0x238f31(0xbe)]+_0x238f31(0xa9)+this[_0x238f31(0xc6)][_0x238f31(0x9c)][_0x238f31(0xab)]()+']',this[_0x238f31(0xa6)][_0x238f31(0xb6)](this[_0x238f31(0xcb)][_0x238f31(0xfc)]());try{this[_0x238f31(0xcb)][_0x238f31(0xbd)](this[_0x238f31(0xf2)]+_0x238f31(0xce)),await this[_0x238f31(0xcb)]['log'](this[_0x238f31(0xf2)]+_0x238f31(0xd9))[_0x238f31(0xef)]();const _0x35110f=await this[_0x238f31(0xf5)][_0x238f31(0xac)](typedi_1[_0x238f31(0xda)]['get'](providers_tokens_1[_0x238f31(0xca)][_0x238f31(0x85)]));if(!_0x35110f[_0x238f31(0xe9)])throw new bad_request_error_1[(_0x238f31(0xc2))](this[_0x238f31(0xf2)]+'\x20No\x20repositories\x20to\x20sync.');await this[_0x238f31(0xcb)][_0x238f31(0xbd)](this[_0x238f31(0xf2)]+_0x238f31(0xd2))['send']();const _0x550d6e=await this[_0x238f31(0xf5)][_0x238f31(0xc8)](_0x35110f[_0x238f31(0xf9)](_0x42bc47=>'\x27'+_0x42bc47[_0x238f31(0xe3)]+'\x27')[_0x238f31(0xc5)](','));await this[_0x238f31(0xcb)][_0x238f31(0xbd)](this[_0x238f31(0xf2)]+_0x238f31(0xb4))[_0x238f31(0xef)](),this[_0x238f31(0xd6)]=await this['repoService'][_0x238f31(0xd0)]();const _0x17f890=[..._0x35110f,..._0x550d6e];this[_0x238f31(0xcb)][_0x238f31(0xbd)](this[_0x238f31(0xf2)]+_0x238f31(0xcf)+_0x17f890['length']+_0x238f31(0x101));for(const _0x2697b0 of _0x17f890){this[_0x238f31(0x91)][_0x238f31(0xbd)](_0x238f31(0xf4)+_0x2697b0[_0x238f31(0x8e)]+'['+_0x2697b0[_0x238f31(0xe3)]+_0x238f31(0xc9)+_0x2697b0['branchName']+'['+_0x2697b0[_0x238f31(0xcc)]+']\x20branch.'),this[_0x238f31(0xcb)]['log'](this[_0x238f31(0xf2)]+'\x20Syncing\x20repository:\x20\x22'+_0x2697b0['repositoryName']+'\x22\x20branch:\x20\x22'+_0x2697b0[_0x238f31(0x90)]+'\x22.'),this['sfLogger']['log'](this[_0x238f31(0xf2)]+_0x238f31(0xde));const _0x4d8c90=await this['checkValidNaming'](_0x2697b0);if(!_0x4d8c90)continue;this[_0x238f31(0xcb)]['log'](this['prefix']+_0x238f31(0x96));const _0x380a61=await this['isIntersects'](_0x2697b0);if(_0x380a61)continue;await this[_0x238f31(0xcb)][_0x238f31(0xef)]();let _0x453247;try{await this[_0x238f31(0xcb)][_0x238f31(0xbd)](this[_0x238f31(0xf2)]+_0x238f31(0xb9))[_0x238f31(0xef)](),_0x453247=await this[_0x238f31(0xf7)](_0x2697b0,typedi_1[_0x238f31(0xda)][_0x238f31(0xd1)](providers_tokens_1[_0x238f31(0xca)]['connectionId']));}catch(_0xa396a6){await this['handleRecordSyncError'](_0x2697b0,_0xa396a6 instanceof too_many_requests_error_1[_0x238f31(0xec)]?_0xa396a6:new Error(_0x238f31(0xcd)+_0xa396a6));continue;}await this[_0x238f31(0xcb)][_0x238f31(0xbd)](this[_0x238f31(0xf2)]+_0x238f31(0xe7))[_0x238f31(0xef)]();if(_0x2697b0[_0x238f31(0xff)]===flosum_repository_sync_dto_1[_0x238f31(0xae)][_0x238f31(0xa7)]){const _0x56d570=typedi_1[_0x238f31(0xda)]['get'](flosum_sync_job_1[_0x238f31(0xf6)]);await _0x56d570[_0x238f31(0xd3)]({'repository':_0x453247,'convertToSFDX':this[_0x238f31(0xc6)][_0x238f31(0x93)],'syncRecord':_0x2697b0,'provider':this[_0x238f31(0xc6)][_0x238f31(0x9c)]})['catch'](_0x5d56ee=>this['handleRecordSyncError'](_0x2697b0,_0x5d56ee));}else{const _0x2981f9=typedi_1[_0x238f31(0xda)][_0x238f31(0xd1)](git_sync_job_1[_0x238f31(0xe4)]);await _0x2981f9['run']({'repository':_0x453247,'branch':_0x2697b0['branchName'],'provider':this[_0x238f31(0xc6)][_0x238f31(0x9c)],'repositoryGit':_0x453247[_0x238f31(0x9b)],'syncRecord':_0x2697b0})[_0x238f31(0x86)](_0x51c21d=>this[_0x238f31(0xc4)](_0x2697b0,_0x51c21d));}}}catch(_0x421529){this['logger'][_0x238f31(0xed)](_0x421529);_0x421529 instanceof too_many_requests_error_1[_0x238f31(0xec)]?(await this['sfLogger'][_0x238f31(0xbd)](this['prefix']+_0x238f31(0xc1))[_0x238f31(0xef)](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0x238f31(0xd3)]()):await this[_0x238f31(0xcb)][_0x238f31(0xed)](this[_0x238f31(0xf2)]+_0x238f31(0x87)+_0x421529)[_0x238f31(0xef)]();return;}await this['sfLogger']['log'](this[_0x238f31(0xf2)]+_0x238f31(0xfa))[_0x238f31(0xef)](),await this['salesforceSync']['disableSync'](typedi_1[_0x238f31(0xda)][_0x238f31(0xd1)](providers_tokens_1[_0x238f31(0xca)][_0x238f31(0x85)]))['catch'](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a80_0x20b13f(0xb2)])({'transient':!![]}),__metadata(a80_0x20b13f(0x92),[salesforce_service_1[a80_0x20b13f(0xa0)],salesforce_sync_service_1[a80_0x20b13f(0x89)]])],SyncService),exports[a80_0x20b13f(0x97)]=SyncService;