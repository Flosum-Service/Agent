const a112_0x58f55c=a112_0xe45b;function a112_0xe45b(_0x2f736c,_0x2ff864){const _0x3a10dc=a112_0x242b();return a112_0xe45b=function(_0x34f536,_0xca4853){_0x34f536=_0x34f536-0x91;let _0x242bff=_0x3a10dc[_0x34f536];return _0x242bff;},a112_0xe45b(_0x2f736c,_0x2ff864);}(function(_0x22e67a,_0x338ecc){const _0x5d63e9=a112_0xe45b,_0xdc55a7=_0x22e67a();while(!![]){try{const _0x15bb87=parseInt(_0x5d63e9(0x9f))/0x1+parseInt(_0x5d63e9(0xae))/0x2+parseInt(_0x5d63e9(0xb4))/0x3+-parseInt(_0x5d63e9(0xf9))/0x4+-parseInt(_0x5d63e9(0xc7))/0x5*(-parseInt(_0x5d63e9(0xcb))/0x6)+parseInt(_0x5d63e9(0x96))/0x7+-parseInt(_0x5d63e9(0x95))/0x8;if(_0x15bb87===_0x338ecc)break;else _0xdc55a7['push'](_0xdc55a7['shift']());}catch(_0x43ff19){_0xdc55a7['push'](_0xdc55a7['shift']());}}}(a112_0x242b,0x5ac9f));const a112_0xca4853=(function(){let _0x592032=!![];return function(_0x33b21a,_0x7e3e43){const _0x499c33=_0x592032?function(){const _0x592409=a112_0xe45b;if(_0x7e3e43){const _0xb6fcd7=_0x7e3e43[_0x592409(0xb9)](_0x33b21a,arguments);return _0x7e3e43=null,_0xb6fcd7;}}:function(){};return _0x592032=![],_0x499c33;};}()),a112_0x34f536=a112_0xca4853(this,function(){const _0x328bb4=a112_0xe45b;return a112_0x34f536[_0x328bb4(0xfa)]()[_0x328bb4(0x98)](_0x328bb4(0xcf))['toString']()['constructor'](a112_0x34f536)[_0x328bb4(0x98)](_0x328bb4(0xcf));});a112_0x34f536();'use strict';function a112_0x242b(){const _0x20f4a9=['branchId','branchName','salesforceService','name','decorate','11750zQqlWT','SyncService','design:paramtypes','prefix','6jbElGg','../../providers/providers.tokens','direction','create','(((.+)+)+)+$','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','\x20Checking\x20valid\x20name.','gitApiService','join','applicationUrl','SalesforceError','\x20Have\x20to\x20synchronize\x20','repoService','TooManyRequests','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','../../salesforce/dto/flosum-repository-sync.dto','getHookLinkFor','\x20Getting\x20repository\x20records.','\x20Repository\x20\x22','\x20Syncing\x20repository:\x20\x22',']\x20[','\x20Start\x20sync\x20job.','run','map','isIntersects','repoList','getRepositoryRecords','Unable\x20to\x20synchronize\x20branch\x20\x27','connectionId','handleRecordSyncError','sleep','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','SalesforceSyncService','sfLogger','send','\x27\x20-\x20\x27','getLoggerId','../../salesforce/services/salesforce.service','typedi','REPOSITORY_NAME_REGEXP','../../../shared/utils','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','\x20Getting\x20Flosum\x20repository','checkValidNaming','getOrCreateRepo',']\x20repository\x20','2374172IKLLjT','toString','repositoriesIntersections','\x22\x20branch:\x20\x22','get','config','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','function','../../salesforce/services/salesforce-sync.service','disableSync','Unable\x20to\x20synchronize\x20repository\x20\x27','toLowerCase','HooksUtils','\x20No\x20repositories\x20to\x20sync.','__esModule','log','repositoryId','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','hooks','getBranchRecords','3405896HcYwaY','1265285LysqyB','toUpperCase','search','find','\x20branches.','\x20Sync\x20job\x20done.','__decorate','createHookPayload','Service','74520RBaOtB','isBidirectionalSynchronization','../jobs/git-sync.job','metadata','test','../../../../core/errors/bad-request.error','length','object','setLoggerId','defineProperty','gitProvider','Container','error','Tokens','repositoryName','1226378dZjndg','../../../../core/errors/too-many-requests.error','Logger','Error','\x20Completed\x20prepare\x20to\x20syncing.','salesforceSync','1561011LyHBVz','\x20Getting\x20branch\x20records.','setStatus','Waiting',']\x20branch.','apply','catch','getAll','GitBranchNotFoundError','../../../../core','../../providers/web-hooks/hooks.utils','logger','updateRemoteState','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.'];a112_0x242b=function(){return _0x20f4a9;};return a112_0x242b();}var __decorate=this&&this[a112_0x58f55c(0x9c)]||function(_0x228144,_0x13486f,_0x36f037,_0x531ab2){const _0x387280=a112_0x58f55c;var _0x1c4ead=arguments[_0x387280(0xa5)],_0x33615f=_0x1c4ead<0x3?_0x13486f:_0x531ab2===null?_0x531ab2=Object['getOwnPropertyDescriptor'](_0x13486f,_0x36f037):_0x531ab2,_0x57b948;if(typeof Reflect==='object'&&typeof Reflect[_0x387280(0xc6)]==='function')_0x33615f=Reflect[_0x387280(0xc6)](_0x228144,_0x13486f,_0x36f037,_0x531ab2);else{for(var _0x193232=_0x228144[_0x387280(0xa5)]-0x1;_0x193232>=0x0;_0x193232--)if(_0x57b948=_0x228144[_0x193232])_0x33615f=(_0x1c4ead<0x3?_0x57b948(_0x33615f):_0x1c4ead>0x3?_0x57b948(_0x13486f,_0x36f037,_0x33615f):_0x57b948(_0x13486f,_0x36f037))||_0x33615f;}return _0x1c4ead>0x3&&_0x33615f&&Object[_0x387280(0xa8)](_0x13486f,_0x36f037,_0x33615f),_0x33615f;},__metadata=this&&this['__metadata']||function(_0x10dbbd,_0x23bf55){const _0x2431ad=a112_0x58f55c;if(typeof Reflect===_0x2431ad(0xa6)&&typeof Reflect[_0x2431ad(0xa2)]===_0x2431ad(0x100))return Reflect[_0x2431ad(0xa2)](_0x10dbbd,_0x23bf55);},SyncService_1;Object['defineProperty'](exports,a112_0x58f55c(0x107),{'value':!![]}),exports[a112_0x58f55c(0xc8)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a112_0x58f55c(0xbd)),too_many_requests_error_1=require(a112_0x58f55c(0xaf)),flosum_repository_sync_dto_1=require(a112_0x58f55c(0xda)),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require(a112_0x58f55c(0x101)),salesforce_service_1=require(a112_0x58f55c(0xf0)),utils_1=require(a112_0x58f55c(0xf3)),typedi_1=require(a112_0x58f55c(0xf1)),hooks_utils_1=require(a112_0x58f55c(0xbe)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require(a112_0x58f55c(0xa1)),providers_tokens_1=require(a112_0x58f55c(0xcc)),bad_request_error_1=require(a112_0x58f55c(0xa4));let SyncService=SyncService_1=class SyncService{constructor(_0x269a02,_0xb87154){const _0x26659e=a112_0x58f55c;this[_0x26659e(0xc4)]=_0x269a02,this['salesforceSync']=_0xb87154,this[_0x26659e(0xbf)]=new core_1[(_0x26659e(0xb0))](SyncService_1[_0x26659e(0xc5)]),this[_0x26659e(0xfb)]={},this[_0x26659e(0xe4)]=[];}async[a112_0x58f55c(0xe8)](_0x56ca15,_0x55f250){const _0x1debb0=a112_0x58f55c;if(_0x55f250 instanceof git_branch_not_found_error_1[_0x1debb0(0xbc)]){await this[_0x1debb0(0xb3)]['setStatus'](_0x56ca15,'Not\x20Synchronized');return;}if(_0x55f250 instanceof too_many_requests_error_1[_0x1debb0(0xd8)]){await this['salesforceSync'][_0x1debb0(0xb6)](_0x56ca15,_0x1debb0(0xb7));throw _0x55f250;}try{await this[_0x1debb0(0xec)]['error'](this[_0x1debb0(0xca)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x56ca15['repositoryName']+'\x27\x20['+_0x56ca15[_0x1debb0(0xc3)]+']\x20due\x20error\x20-\x20'+_0x55f250+'.')[_0x1debb0(0xed)](),await this[_0x1debb0(0xb3)][_0x1debb0(0xc0)](_0x56ca15,{}),await this[_0x1debb0(0xb3)][_0x1debb0(0xb6)](_0x56ca15,_0x1debb0(0xb1));}catch(_0xc19bf0){if(_0xc19bf0 instanceof salesforce_error_1[_0x1debb0(0xd5)])throw _0xc19bf0;}}async[a112_0x58f55c(0xe3)](_0x45b501){const _0x2ad077=a112_0x58f55c;if(_0x45b501[_0x2ad077(0x91)]){const _0x3a91c9=_0x45b501['repositoryName'][_0x2ad077(0x104)](),_0x5a9bc6=this[_0x2ad077(0xfb)][_0x3a91c9];if(!_0x5a9bc6)this[_0x2ad077(0xfb)][_0x3a91c9]=_0x45b501[_0x2ad077(0xad)];else{if(_0x5a9bc6&&_0x5a9bc6!==_0x45b501['repositoryName'])return await this[_0x2ad077(0xe8)](_0x45b501,new Error(_0x2ad077(0x103)+_0x45b501['repositoryName']+_0x2ad077(0x92)+_0x3a91c9+_0x2ad077(0xee)+_0x5a9bc6+'\x27')),!![];}}return![];}async[a112_0x58f55c(0xf6)](_0x133d84){const _0x5b716d=a112_0x58f55c;if(!constants_1[_0x5b716d(0xf2)]['test'](_0x133d84[_0x5b716d(0xad)]))return await this[_0x5b716d(0xe8)](_0x133d84,new Error(_0x5b716d(0x103)+_0x133d84[_0x5b716d(0xad)]+_0x5b716d(0xea))),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x5b716d(0xa3)](_0x133d84[_0x5b716d(0xc3)]))return await this['handleRecordSyncError'](_0x133d84,new Error(_0x5b716d(0xe6)+_0x133d84[_0x5b716d(0xc3)]+'\x27\x20in\x20repository\x20\x27'+_0x133d84[_0x5b716d(0xad)]+_0x5b716d(0xc1))),![];return!![];}async[a112_0x58f55c(0xf7)](_0x162ec8,_0x27c014){const _0x4633f3=a112_0x58f55c;let _0x7a98a=this[_0x4633f3(0xe4)][_0x4633f3(0x99)](_0xf86c49=>_0x162ec8[_0x4633f3(0xad)]===_0xf86c49['name']);!_0x7a98a&&(this['sfLogger'][_0x4633f3(0x108)](this['prefix']+'\x20Repository\x20\x22'+_0x162ec8[_0x4633f3(0xad)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x7a98a=await this[_0x4633f3(0xd7)]['create']({'name':_0x162ec8[_0x4633f3(0xad)],'autoInit':!![],'defaultBranch':_0x162ec8[_0x4633f3(0xc3)],'private':!![],'createHook':typedi_1[_0x4633f3(0xaa)][_0x4633f3(0xfd)](providers_tokens_1[_0x4633f3(0xac)]['config'])[_0x4633f3(0xa0)]}));if(this[_0x4633f3(0xfe)][_0x4633f3(0xa0)]){const _0x2b7d04=await _0x7a98a[_0x4633f3(0x93)]['getAll']();!_0x2b7d04[_0x4633f3(0x99)](_0x6869c4=>_0x6869c4['url']===hooks_utils_1[_0x4633f3(0x105)][_0x4633f3(0xdb)](this[_0x4633f3(0xfe)]['gitProvider'],this['config'][_0x4633f3(0xd4)],_0x27c014))&&(this[_0x4633f3(0xec)]['log'](this[_0x4633f3(0xca)]+_0x4633f3(0xdd)+_0x162ec8[_0x4633f3(0xad)]+_0x4633f3(0xd0)),await _0x7a98a[_0x4633f3(0x93)][_0x4633f3(0xce)](hooks_utils_1[_0x4633f3(0x105)][_0x4633f3(0x9d)](this[_0x4633f3(0xfe)][_0x4633f3(0xa9)],_0x7a98a[_0x4633f3(0x93)],this['config'][_0x4633f3(0xd4)],_0x27c014)));}return this[_0x4633f3(0xe4)]['push'](_0x7a98a),_0x7a98a;}async[a112_0x58f55c(0xe1)](){const _0x239c72=a112_0x58f55c;this[_0x239c72(0xd2)]=typedi_1[_0x239c72(0xaa)][_0x239c72(0xfd)](providers_tokens_1['Tokens'][_0x239c72(0xd2)]),this['repoService']=typedi_1[_0x239c72(0xaa)][_0x239c72(0xfd)](providers_tokens_1[_0x239c72(0xac)]['gitRepoService']),this[_0x239c72(0xfe)]=typedi_1[_0x239c72(0xaa)][_0x239c72(0xfd)](providers_tokens_1[_0x239c72(0xac)][_0x239c72(0xfe)]),this[_0x239c72(0xec)]=typedi_1[_0x239c72(0xaa)][_0x239c72(0xfd)](providers_tokens_1[_0x239c72(0xac)]['logger']),this[_0x239c72(0xca)]='['+SyncService_1['name']+_0x239c72(0xdf)+this[_0x239c72(0xfe)][_0x239c72(0xa9)][_0x239c72(0x97)]()+']',this['salesforceService'][_0x239c72(0xa7)](this[_0x239c72(0xec)][_0x239c72(0xef)]());try{this[_0x239c72(0xec)]['log'](this['prefix']+_0x239c72(0xe0)),await this['sfLogger'][_0x239c72(0x108)](this[_0x239c72(0xca)]+_0x239c72(0xdc))[_0x239c72(0xed)]();const _0x40d64d=await this[_0x239c72(0xb3)][_0x239c72(0xe5)](typedi_1[_0x239c72(0xaa)][_0x239c72(0xfd)](providers_tokens_1[_0x239c72(0xac)]['connectionId']));if(!_0x40d64d['length'])throw new bad_request_error_1['BadRequestError'](this['prefix']+_0x239c72(0x106));await this[_0x239c72(0xec)]['log'](this[_0x239c72(0xca)]+_0x239c72(0xb5))['send']();const _0x25062e=await this[_0x239c72(0xb3)][_0x239c72(0x94)](_0x40d64d[_0x239c72(0xe2)](_0x35d943=>'\x27'+_0x35d943[_0x239c72(0x91)]+'\x27')[_0x239c72(0xd3)](','));await this[_0x239c72(0xec)][_0x239c72(0x108)](this[_0x239c72(0xca)]+'\x20Getting\x20repositories\x20from\x20git\x20service.')[_0x239c72(0xed)](),this[_0x239c72(0xe4)]=await this[_0x239c72(0xd7)][_0x239c72(0xbb)]();const _0x4c768b=[..._0x40d64d,..._0x25062e];this[_0x239c72(0xec)][_0x239c72(0x108)](this['prefix']+_0x239c72(0xd6)+_0x4c768b[_0x239c72(0xa5)]+_0x239c72(0x9a));for(const _0x287f4c of _0x4c768b){this['logger'][_0x239c72(0x108)]('Syncing\x20'+_0x287f4c[_0x239c72(0xad)]+'['+_0x287f4c['repositoryId']+_0x239c72(0xf8)+_0x287f4c['branchName']+'['+_0x287f4c[_0x239c72(0xc2)]+_0x239c72(0xb8)),this['sfLogger'][_0x239c72(0x108)](this[_0x239c72(0xca)]+_0x239c72(0xde)+_0x287f4c['repositoryName']+_0x239c72(0xfc)+_0x287f4c[_0x239c72(0xc3)]+'\x22.'),this[_0x239c72(0xec)][_0x239c72(0x108)](this[_0x239c72(0xca)]+_0x239c72(0xd1));const _0x2caa78=await this[_0x239c72(0xf6)](_0x287f4c);if(!_0x2caa78)continue;this[_0x239c72(0xec)]['log'](this['prefix']+'\x20Checking\x20intersects.');const _0xd35cb0=await this['isIntersects'](_0x287f4c);if(_0xd35cb0)continue;await this['sfLogger'][_0x239c72(0xed)]();let _0x52b989;try{await this[_0x239c72(0xec)]['log'](this[_0x239c72(0xca)]+_0x239c72(0xf5))[_0x239c72(0xed)](),_0x52b989=await this[_0x239c72(0xf7)](_0x287f4c,typedi_1['Container']['get'](providers_tokens_1['Tokens']['connectionId']));}catch(_0x40f38d){await this[_0x239c72(0xe8)](_0x287f4c,_0x40f38d instanceof too_many_requests_error_1[_0x239c72(0xd8)]?_0x40f38d:new Error(_0x239c72(0xd9)+_0x40f38d));continue;}await this[_0x239c72(0xec)][_0x239c72(0x108)](this['prefix']+_0x239c72(0xb2))[_0x239c72(0xed)]();if(_0x287f4c[_0x239c72(0xcd)]===flosum_repository_sync_dto_1['SyncDirection']['FlosumToGit']){const _0x291877=typedi_1[_0x239c72(0xaa)]['get'](flosum_sync_job_1['FlosumSyncJob']);await _0x291877['run']({'repository':_0x52b989,'convertToSFDX':this['config']['isConvertToSfdx'],'syncRecord':_0x287f4c,'provider':this[_0x239c72(0xfe)][_0x239c72(0xa9)]})[_0x239c72(0xba)](_0x107d7f=>this[_0x239c72(0xe8)](_0x287f4c,_0x107d7f));}else{const _0x54cb3c=typedi_1[_0x239c72(0xaa)]['get'](git_sync_job_1['GitSyncJob']);await _0x54cb3c[_0x239c72(0xe1)]({'repository':_0x52b989,'branch':_0x287f4c[_0x239c72(0xc3)],'provider':this[_0x239c72(0xfe)]['gitProvider'],'repositoryGit':_0x52b989['gitUrl'],'syncRecord':_0x287f4c})[_0x239c72(0xba)](_0x39b4ce=>this[_0x239c72(0xe8)](_0x287f4c,_0x39b4ce));}}}catch(_0x28c90d){this['logger'][_0x239c72(0xab)](_0x28c90d);_0x28c90d instanceof too_many_requests_error_1[_0x239c72(0xd8)]?(await this['sfLogger']['log'](this[_0x239c72(0xca)]+_0x239c72(0xff))[_0x239c72(0xed)](),await(0x0,utils_1[_0x239c72(0xe9)])(0x3c*0x3c*0x3e8),this['run']()):await this[_0x239c72(0xec)][_0x239c72(0xab)](this['prefix']+_0x239c72(0xf4)+_0x28c90d)['send']();return;}await this['sfLogger'][_0x239c72(0x108)](this[_0x239c72(0xca)]+_0x239c72(0x9b))[_0x239c72(0xed)](),await this[_0x239c72(0xb3)][_0x239c72(0x102)](typedi_1[_0x239c72(0xaa)][_0x239c72(0xfd)](providers_tokens_1[_0x239c72(0xac)][_0x239c72(0xe7)]))[_0x239c72(0xba)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a112_0x58f55c(0x9e)])({'transient':!![]}),__metadata(a112_0x58f55c(0xc9),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a112_0x58f55c(0xeb)]])],SyncService),exports[a112_0x58f55c(0xc8)]=SyncService;