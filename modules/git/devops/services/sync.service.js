const a113_0xf0c276=a113_0x5172;function a113_0x3c0a(){const _0x5df227=['test','6wyqDLF','__decorate','applicationUrl','sleep','../../../../core/errors/bad-request.error','BRANCH_NAME_REGEXP','Error','getOrCreateRepo','Unable\x20to\x20synchronize\x20repository\x20\x27','create','connectionId','log','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','Container','FlosumSyncJob','apply','../../../shared/utils','TooManyRequests',']\x20branch.','getLoggerId','\x20Checking\x20valid\x20name.','decorate','getBranchRecords','sfLogger','getOwnPropertyDescriptor','repositoryName','map','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','SyncService','20881450synSvb','3PMVmbK','metadata','updateRemoteState','\x20Getting\x20repositories\x20from\x20git\x20service.','url','\x20branches.','../jobs/git-sync.job','salesforceSync','\x20Getting\x20branch\x20records.','logger','checkValidNaming','toLowerCase','toUpperCase','\x27\x20in\x20repository\x20\x27','branchName','error','branchId','1287906ydByGx','../../salesforce/services/salesforce.service','SyncDirection','disableSync','4853880OIJZvf','handleRecordSyncError','length','5526381YdSyni','function','__metadata','name','Service','Logger','getHookLinkFor','catch','../../../../core/errors/too-many-requests.error','salesforceService','../jobs/flosum-sync.job','setLoggerId','GitBranchNotFoundError','Not\x20Synchronized','object','send','\x20Repository\x20\x22','get','(((.+)+)+)+$','../../providers/web-hooks/hooks.utils','\x20Syncing\x20repository:\x20\x22','gitProvider','repoService','config','\x20Start\x20sync\x20job.','BadRequestError','__esModule','Unable\x20to\x20synchronize\x20branch\x20\x27','isIntersects',']\x20repository\x20','setStatus','../../../../constants',']\x20due\x20error\x20-\x20','design:paramtypes','651560kCXTCh','getAll','REPOSITORY_NAME_REGEXP',']\x20[','gitApiService','927436zZAOuG','HooksUtils','repoList','direction','FlosumToGit','defineProperty','8gBtEBy','createHookPayload','GitSyncJob','../../../../core','../../salesforce/services/salesforce-sync.service','Tokens','\x20Have\x20to\x20synchronize\x20','\x20Sync\x20job\x20done.','\x20Getting\x20Flosum\x20repository','run','prefix','SalesforceSyncService','constructor','repositoryId','gitUrl','search','SalesforceError','2235663lVPtoh','hooks','find','isConvertToSfdx','repositoriesIntersections','join','typedi','../../providers/providers.tokens','push'];a113_0x3c0a=function(){return _0x5df227;};return a113_0x3c0a();}(function(_0x53415f,_0x43458a){const _0x715e9a=a113_0x5172,_0xd77c8b=_0x53415f();while(!![]){try{const _0x131d32=-parseInt(_0x715e9a(0x122))/0x1+-parseInt(_0x715e9a(0xf9))/0x2+parseInt(_0x715e9a(0xe8))/0x3*(-parseInt(_0x715e9a(0x127))/0x4)+parseInt(_0x715e9a(0xfd))/0x5+-parseInt(_0x715e9a(0x148))/0x6*(parseInt(_0x715e9a(0x100))/0x7)+-parseInt(_0x715e9a(0x12d))/0x8*(parseInt(_0x715e9a(0x13e))/0x9)+parseInt(_0x715e9a(0x165))/0xa;if(_0x131d32===_0x43458a)break;else _0xd77c8b['push'](_0xd77c8b['shift']());}catch(_0x36d21b){_0xd77c8b['push'](_0xd77c8b['shift']());}}}(a113_0x3c0a,0x7885b));const a113_0x3fe6bb=(function(){let _0x5c418c=!![];return function(_0x36117d,_0x5ea575){const _0x5bcf4b=_0x5c418c?function(){const _0x1fcdcb=a113_0x5172;if(_0x5ea575){const _0x1d0e61=_0x5ea575[_0x1fcdcb(0x157)](_0x36117d,arguments);return _0x5ea575=null,_0x1d0e61;}}:function(){};return _0x5c418c=![],_0x5bcf4b;};}()),a113_0x25bfdd=a113_0x3fe6bb(this,function(){const _0x448bd6=a113_0x5172;return a113_0x25bfdd['toString']()[_0x448bd6(0x13c)](_0x448bd6(0x112))['toString']()[_0x448bd6(0x139)](a113_0x25bfdd)[_0x448bd6(0x13c)](_0x448bd6(0x112));});a113_0x25bfdd();'use strict';var __decorate=this&&this[a113_0xf0c276(0x149)]||function(_0x5eebaf,_0x57d035,_0x8bdea9,_0x4703df){const _0x69c255=a113_0xf0c276;var _0x150afd=arguments['length'],_0x48e4f8=_0x150afd<0x3?_0x57d035:_0x4703df===null?_0x4703df=Object[_0x69c255(0x160)](_0x57d035,_0x8bdea9):_0x4703df,_0x49bdc3;if(typeof Reflect===_0x69c255(0x10e)&&typeof Reflect[_0x69c255(0x15d)]===_0x69c255(0x101))_0x48e4f8=Reflect['decorate'](_0x5eebaf,_0x57d035,_0x8bdea9,_0x4703df);else{for(var _0x197672=_0x5eebaf['length']-0x1;_0x197672>=0x0;_0x197672--)if(_0x49bdc3=_0x5eebaf[_0x197672])_0x48e4f8=(_0x150afd<0x3?_0x49bdc3(_0x48e4f8):_0x150afd>0x3?_0x49bdc3(_0x57d035,_0x8bdea9,_0x48e4f8):_0x49bdc3(_0x57d035,_0x8bdea9))||_0x48e4f8;}return _0x150afd>0x3&&_0x48e4f8&&Object['defineProperty'](_0x57d035,_0x8bdea9,_0x48e4f8),_0x48e4f8;},__metadata=this&&this[a113_0xf0c276(0x102)]||function(_0x135145,_0x2e8790){const _0xf1f49f=a113_0xf0c276;if(typeof Reflect===_0xf1f49f(0x10e)&&typeof Reflect[_0xf1f49f(0xe9)]==='function')return Reflect[_0xf1f49f(0xe9)](_0x135145,_0x2e8790);},SyncService_1;Object[a113_0xf0c276(0x12c)](exports,a113_0xf0c276(0x11a),{'value':!![]}),exports[a113_0xf0c276(0x164)]=void 0x0;const constants_1=require(a113_0xf0c276(0x11f)),core_1=require(a113_0xf0c276(0x130)),too_many_requests_error_1=require(a113_0xf0c276(0x108)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require(a113_0xf0c276(0x131)),salesforce_service_1=require(a113_0xf0c276(0xfa)),utils_1=require(a113_0xf0c276(0x158)),typedi_1=require(a113_0xf0c276(0x144)),hooks_utils_1=require(a113_0xf0c276(0x113)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require(a113_0xf0c276(0x10a)),git_sync_job_1=require(a113_0xf0c276(0xee)),providers_tokens_1=require(a113_0xf0c276(0x145)),bad_request_error_1=require(a113_0xf0c276(0x14c));let SyncService=SyncService_1=class SyncService{constructor(_0x18a8ff,_0x546e21){const _0x4e48a2=a113_0xf0c276;this[_0x4e48a2(0x109)]=_0x18a8ff,this[_0x4e48a2(0xef)]=_0x546e21,this[_0x4e48a2(0xf1)]=new core_1[(_0x4e48a2(0x105))](SyncService_1[_0x4e48a2(0x103)]),this[_0x4e48a2(0x142)]={},this[_0x4e48a2(0x129)]=[];}async[a113_0xf0c276(0xfe)](_0x4d15fd,_0x33315e){const _0x406d11=a113_0xf0c276;if(_0x33315e instanceof git_branch_not_found_error_1[_0x406d11(0x10c)]){await this[_0x406d11(0xef)][_0x406d11(0x11e)](_0x4d15fd,_0x406d11(0x10d));return;}if(_0x33315e instanceof too_many_requests_error_1[_0x406d11(0x159)]){await this[_0x406d11(0xef)][_0x406d11(0x11e)](_0x4d15fd,'Waiting');throw _0x33315e;}try{await this[_0x406d11(0x15f)]['error'](this['prefix']+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x4d15fd[_0x406d11(0x161)]+'\x27\x20['+_0x4d15fd[_0x406d11(0xf6)]+_0x406d11(0x120)+_0x33315e+'.')[_0x406d11(0x10f)](),await this[_0x406d11(0xef)][_0x406d11(0xea)](_0x4d15fd,{}),await this[_0x406d11(0xef)][_0x406d11(0x11e)](_0x4d15fd,_0x406d11(0x14e));}catch(_0x160140){if(_0x160140 instanceof salesforce_error_1[_0x406d11(0x13d)])throw _0x160140;}}async['isIntersects'](_0x44c5c8){const _0x33e708=a113_0xf0c276;if(_0x44c5c8[_0x33e708(0x13a)]){const _0x4c88db=_0x44c5c8[_0x33e708(0x161)][_0x33e708(0xf3)](),_0x21c075=this[_0x33e708(0x142)][_0x4c88db];if(!_0x21c075)this[_0x33e708(0x142)][_0x4c88db]=_0x44c5c8['repositoryName'];else{if(_0x21c075&&_0x21c075!==_0x44c5c8['repositoryName'])return await this[_0x33e708(0xfe)](_0x44c5c8,new Error(_0x33e708(0x150)+_0x44c5c8['repositoryName']+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x4c88db+'\x27\x20-\x20\x27'+_0x21c075+'\x27')),!![];}}return![];}async[a113_0xf0c276(0xf2)](_0x1c6852){const _0x4b8194=a113_0xf0c276;if(!constants_1[_0x4b8194(0x124)][_0x4b8194(0x147)](_0x1c6852['repositoryName']))return await this[_0x4b8194(0xfe)](_0x1c6852,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x1c6852[_0x4b8194(0x161)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x4b8194(0x14d)][_0x4b8194(0x147)](_0x1c6852[_0x4b8194(0xf6)]))return await this[_0x4b8194(0xfe)](_0x1c6852,new Error(_0x4b8194(0x11b)+_0x1c6852['branchName']+_0x4b8194(0xf5)+_0x1c6852[_0x4b8194(0x161)]+_0x4b8194(0x163))),![];return!![];}async[a113_0xf0c276(0x14f)](_0x4af03e,_0x427bbd){const _0x443eee=a113_0xf0c276;let _0x47701d=this['repoList'][_0x443eee(0x140)](_0x280256=>_0x4af03e[_0x443eee(0x161)]===_0x280256[_0x443eee(0x103)]);!_0x47701d&&(this[_0x443eee(0x15f)][_0x443eee(0x153)](this[_0x443eee(0x137)]+'\x20Repository\x20\x22'+_0x4af03e[_0x443eee(0x161)]+_0x443eee(0x154)),_0x47701d=await this[_0x443eee(0x116)][_0x443eee(0x151)]({'name':_0x4af03e['repositoryName'],'autoInit':!![],'defaultBranch':_0x4af03e[_0x443eee(0xf6)],'private':!![],'createHook':typedi_1['Container'][_0x443eee(0x111)](providers_tokens_1[_0x443eee(0x132)][_0x443eee(0x117)])['isBidirectionalSynchronization']}));if(this[_0x443eee(0x117)]['isBidirectionalSynchronization']){const _0x410b2b=await _0x47701d[_0x443eee(0x13f)][_0x443eee(0x123)]();!_0x410b2b['find'](_0x3da9b7=>_0x3da9b7[_0x443eee(0xec)]===hooks_utils_1[_0x443eee(0x128)][_0x443eee(0x106)](this[_0x443eee(0x117)][_0x443eee(0x115)],this[_0x443eee(0x117)][_0x443eee(0x14a)],_0x427bbd))&&(this['sfLogger'][_0x443eee(0x153)](this[_0x443eee(0x137)]+_0x443eee(0x110)+_0x4af03e[_0x443eee(0x161)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x47701d['hooks']['create'](hooks_utils_1[_0x443eee(0x128)][_0x443eee(0x12e)](this[_0x443eee(0x117)][_0x443eee(0x115)],_0x47701d[_0x443eee(0x13f)],this[_0x443eee(0x117)]['applicationUrl'],_0x427bbd)));}return this[_0x443eee(0x129)][_0x443eee(0x146)](_0x47701d),_0x47701d;}async[a113_0xf0c276(0x136)](){const _0x222422=a113_0xf0c276;this['gitApiService']=typedi_1[_0x222422(0x155)]['get'](providers_tokens_1['Tokens'][_0x222422(0x126)]),this[_0x222422(0x116)]=typedi_1[_0x222422(0x155)][_0x222422(0x111)](providers_tokens_1[_0x222422(0x132)]['gitRepoService']),this[_0x222422(0x117)]=typedi_1[_0x222422(0x155)][_0x222422(0x111)](providers_tokens_1[_0x222422(0x132)]['config']),this[_0x222422(0x15f)]=typedi_1[_0x222422(0x155)][_0x222422(0x111)](providers_tokens_1[_0x222422(0x132)][_0x222422(0xf1)]),this[_0x222422(0x137)]='['+SyncService_1['name']+_0x222422(0x125)+this[_0x222422(0x117)][_0x222422(0x115)][_0x222422(0xf4)]()+']',this['salesforceService'][_0x222422(0x10b)](this[_0x222422(0x15f)][_0x222422(0x15b)]());try{this['sfLogger'][_0x222422(0x153)](this[_0x222422(0x137)]+_0x222422(0x118)),await this[_0x222422(0x15f)]['log'](this['prefix']+'\x20Getting\x20repository\x20records.')[_0x222422(0x10f)]();const _0x47d83c=await this[_0x222422(0xef)]['getRepositoryRecords'](typedi_1[_0x222422(0x155)][_0x222422(0x111)](providers_tokens_1[_0x222422(0x132)][_0x222422(0x152)]));if(!_0x47d83c[_0x222422(0xff)])throw new bad_request_error_1[(_0x222422(0x119))](this[_0x222422(0x137)]+'\x20No\x20repositories\x20to\x20sync.');await this['sfLogger'][_0x222422(0x153)](this['prefix']+_0x222422(0xf0))[_0x222422(0x10f)]();const _0x495cf1=await this[_0x222422(0xef)][_0x222422(0x15e)](_0x47d83c[_0x222422(0x162)](_0x1fc169=>'\x27'+_0x1fc169[_0x222422(0x13a)]+'\x27')[_0x222422(0x143)](','));await this['sfLogger'][_0x222422(0x153)](this[_0x222422(0x137)]+_0x222422(0xeb))[_0x222422(0x10f)](),this['repoList']=await this[_0x222422(0x116)][_0x222422(0x123)]();const _0x2fee8f=[..._0x47d83c,..._0x495cf1];this[_0x222422(0x15f)][_0x222422(0x153)](this[_0x222422(0x137)]+_0x222422(0x133)+_0x2fee8f['length']+_0x222422(0xed));for(const _0x4fc91b of _0x2fee8f){this[_0x222422(0xf1)]['log']('Syncing\x20'+_0x4fc91b[_0x222422(0x161)]+'['+_0x4fc91b[_0x222422(0x13a)]+_0x222422(0x11d)+_0x4fc91b[_0x222422(0xf6)]+'['+_0x4fc91b[_0x222422(0xf8)]+_0x222422(0x15a)),this[_0x222422(0x15f)][_0x222422(0x153)](this[_0x222422(0x137)]+_0x222422(0x114)+_0x4fc91b['repositoryName']+'\x22\x20branch:\x20\x22'+_0x4fc91b[_0x222422(0xf6)]+'\x22.'),this[_0x222422(0x15f)][_0x222422(0x153)](this[_0x222422(0x137)]+_0x222422(0x15c));const _0x58dd45=await this['checkValidNaming'](_0x4fc91b);if(!_0x58dd45)continue;this[_0x222422(0x15f)][_0x222422(0x153)](this['prefix']+'\x20Checking\x20intersects.');const _0x299f88=await this[_0x222422(0x11c)](_0x4fc91b);if(_0x299f88)continue;await this[_0x222422(0x15f)][_0x222422(0x10f)]();let _0x5d267e;try{await this['sfLogger']['log'](this[_0x222422(0x137)]+_0x222422(0x135))[_0x222422(0x10f)](),_0x5d267e=await this[_0x222422(0x14f)](_0x4fc91b,typedi_1[_0x222422(0x155)][_0x222422(0x111)](providers_tokens_1[_0x222422(0x132)][_0x222422(0x152)]));}catch(_0x5a3349){await this[_0x222422(0xfe)](_0x4fc91b,_0x5a3349 instanceof too_many_requests_error_1[_0x222422(0x159)]?_0x5a3349:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x5a3349));continue;}await this[_0x222422(0x15f)][_0x222422(0x153)](this[_0x222422(0x137)]+'\x20Completed\x20prepare\x20to\x20syncing.')['send']();if(_0x4fc91b[_0x222422(0x12a)]===flosum_repository_sync_dto_1[_0x222422(0xfb)][_0x222422(0x12b)]){const _0x6d5cc7=typedi_1[_0x222422(0x155)]['get'](flosum_sync_job_1[_0x222422(0x156)]);await _0x6d5cc7['run']({'repository':_0x5d267e,'convertToSFDX':this[_0x222422(0x117)][_0x222422(0x141)],'syncRecord':_0x4fc91b,'provider':this['config'][_0x222422(0x115)]})['catch'](_0x54e6a5=>this[_0x222422(0xfe)](_0x4fc91b,_0x54e6a5));}else{const _0x2f22a8=typedi_1[_0x222422(0x155)]['get'](git_sync_job_1[_0x222422(0x12f)]);await _0x2f22a8[_0x222422(0x136)]({'repository':_0x5d267e,'branch':_0x4fc91b[_0x222422(0xf6)],'provider':this[_0x222422(0x117)][_0x222422(0x115)],'repositoryGit':_0x5d267e[_0x222422(0x13b)],'syncRecord':_0x4fc91b})[_0x222422(0x107)](_0x278221=>this[_0x222422(0xfe)](_0x4fc91b,_0x278221));}}}catch(_0x4faf4d){this[_0x222422(0xf1)][_0x222422(0xf7)](_0x4faf4d);_0x4faf4d instanceof too_many_requests_error_1[_0x222422(0x159)]?(await this[_0x222422(0x15f)][_0x222422(0x153)](this['prefix']+'\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.')[_0x222422(0x10f)](),await(0x0,utils_1[_0x222422(0x14b)])(0x3c*0x3c*0x3e8),this['run']()):await this['sfLogger'][_0x222422(0xf7)](this['prefix']+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x4faf4d)[_0x222422(0x10f)]();return;}await this['sfLogger']['log'](this[_0x222422(0x137)]+_0x222422(0x134))['send'](),await this[_0x222422(0xef)][_0x222422(0xfc)](typedi_1[_0x222422(0x155)][_0x222422(0x111)](providers_tokens_1[_0x222422(0x132)][_0x222422(0x152)]))['catch'](()=>null);}};function a113_0x5172(_0x4c6c68,_0x268f46){const _0x3dad96=a113_0x3c0a();return a113_0x5172=function(_0x25bfdd,_0x3fe6bb){_0x25bfdd=_0x25bfdd-0xe8;let _0x3c0a77=_0x3dad96[_0x25bfdd];return _0x3c0a77;},a113_0x5172(_0x4c6c68,_0x268f46);}SyncService=SyncService_1=__decorate([(0x0,typedi_1[a113_0xf0c276(0x104)])({'transient':!![]}),__metadata(a113_0xf0c276(0x121),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a113_0xf0c276(0x138)]])],SyncService),exports[a113_0xf0c276(0x164)]=SyncService;