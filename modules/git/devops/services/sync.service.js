const a111_0x1f0eb5=a111_0x1dc9;(function(_0x195210,_0x28d333){const _0x4d8356=a111_0x1dc9,_0x311ff3=_0x195210();while(!![]){try{const _0x298c79=parseInt(_0x4d8356(0x174))/0x1*(-parseInt(_0x4d8356(0x151))/0x2)+-parseInt(_0x4d8356(0x10d))/0x3+-parseInt(_0x4d8356(0x165))/0x4*(-parseInt(_0x4d8356(0x15c))/0x5)+-parseInt(_0x4d8356(0x127))/0x6+-parseInt(_0x4d8356(0x178))/0x7*(-parseInt(_0x4d8356(0x166))/0x8)+-parseInt(_0x4d8356(0x177))/0x9+parseInt(_0x4d8356(0x15b))/0xa*(parseInt(_0x4d8356(0x17a))/0xb);if(_0x298c79===_0x28d333)break;else _0x311ff3['push'](_0x311ff3['shift']());}catch(_0x3a6f1e){_0x311ff3['push'](_0x311ff3['shift']());}}}(a111_0x2367,0x66753));const a111_0x5cff4d=(function(){let _0x2e1c87=!![];return function(_0x43a312,_0x2e206e){const _0x264661=_0x2e1c87?function(){const _0x4a9bb1=a111_0x1dc9;if(_0x2e206e){const _0x40e030=_0x2e206e[_0x4a9bb1(0x16a)](_0x43a312,arguments);return _0x2e206e=null,_0x40e030;}}:function(){};return _0x2e1c87=![],_0x264661;};}()),a111_0x41232a=a111_0x5cff4d(this,function(){const _0x4c5047=a111_0x1dc9;return a111_0x41232a['toString']()[_0x4c5047(0x139)](_0x4c5047(0x16b))[_0x4c5047(0x16c)]()[_0x4c5047(0x12b)](a111_0x41232a)[_0x4c5047(0x139)]('(((.+)+)+)+$');});a111_0x41232a();'use strict';var __decorate=this&&this[a111_0x1f0eb5(0x113)]||function(_0xfa7325,_0x130025,_0x2bd524,_0x4ce286){const _0x1d0868=a111_0x1f0eb5;var _0x23c9ef=arguments['length'],_0x3cfbb1=_0x23c9ef<0x3?_0x130025:_0x4ce286===null?_0x4ce286=Object[_0x1d0868(0x14e)](_0x130025,_0x2bd524):_0x4ce286,_0x19ed8a;if(typeof Reflect===_0x1d0868(0x137)&&typeof Reflect[_0x1d0868(0x135)]===_0x1d0868(0x17c))_0x3cfbb1=Reflect[_0x1d0868(0x135)](_0xfa7325,_0x130025,_0x2bd524,_0x4ce286);else{for(var _0x51f2e4=_0xfa7325[_0x1d0868(0x181)]-0x1;_0x51f2e4>=0x0;_0x51f2e4--)if(_0x19ed8a=_0xfa7325[_0x51f2e4])_0x3cfbb1=(_0x23c9ef<0x3?_0x19ed8a(_0x3cfbb1):_0x23c9ef>0x3?_0x19ed8a(_0x130025,_0x2bd524,_0x3cfbb1):_0x19ed8a(_0x130025,_0x2bd524))||_0x3cfbb1;}return _0x23c9ef>0x3&&_0x3cfbb1&&Object[_0x1d0868(0x123)](_0x130025,_0x2bd524,_0x3cfbb1),_0x3cfbb1;},__metadata=this&&this[a111_0x1f0eb5(0x11f)]||function(_0x12a5c1,_0x4997d8){const _0x575b22=a111_0x1f0eb5;if(typeof Reflect===_0x575b22(0x137)&&typeof Reflect['metadata']==='function')return Reflect[_0x575b22(0x104)](_0x12a5c1,_0x4997d8);},SyncService_1;Object[a111_0x1f0eb5(0x123)](exports,'__esModule',{'value':!![]}),exports[a111_0x1f0eb5(0x145)]=void 0x0;function a111_0x2367(){const _0x38f823=['SyncService','../../../../constants','sfLogger','HooksUtils','typedi','\x20Checking\x20intersects.','Service','prefix','name','getOwnPropertyDescriptor','../../../../core/errors/too-many-requests.error','repoService','2gTCiOG','\x20Repository\x20\x22','repositoriesIntersections','\x20Sync\x20job\x20done.',']\x20repository\x20','branchName','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','getOrCreateRepo','../../salesforce/services/salesforce.service','Unable\x20to\x20synchronize\x20branch\x20\x27','10YJZeci','3890BhIqKc','gitRepoService','Tokens','../../../../core/errors/bad-request.error','SalesforceService','\x20Getting\x20Flosum\x20repository','\x20Have\x20to\x20synchronize\x20','repoList','createHookPayload','4080tVwYye','220040PziYsz','\x27\x20-\x20\x27','../../../../core','url','apply','(((.+)+)+)+$','toString','setStatus','\x27\x20[','\x20No\x20repositories\x20to\x20sync.','isBidirectionalSynchronization','../../providers/web-hooks/hooks.utils','../errors/git-branch-not-found.error','logger','401939CTqztd','push','gitApiService','524421TlBRrj','91GXRwUV','../jobs/flosum-sync.job','10129383mLqjFq','find','function','log','FlosumToGit','gitProvider','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','length','toLowerCase','GitBranchNotFoundError','getAll','disableSync','\x22\x20branch:\x20\x22','salesforceService','isIntersects','../../../shared/utils','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','getHookLinkFor','Container','metadata','isConvertToSfdx','Error','catch','Syncing\x20','\x27\x20in\x20repository\x20\x27','\x20Syncing\x20repository:\x20\x22','BRANCH_NAME_REGEXP','hooks','2371569pTYlNe','SyncDirection','create','\x20Getting\x20repositories\x20from\x20git\x20service.','error','test','__decorate',']\x20branch.','salesforceSync','../../salesforce/errors/salesforce.error','send','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','Waiting','get','connectionId','repositoryName','handleRecordSyncError','SalesforceSyncService','__metadata','updateRemoteState','checkValidNaming','\x20Getting\x20repository\x20records.','defineProperty','GitSyncJob','gitUrl','\x20Start\x20sync\x20job.','2409480LniaqN','../../salesforce/services/salesforce-sync.service','\x20Checking\x20valid\x20name.',']\x20[','constructor','applicationUrl','\x20branches.','getLoggerId','FlosumSyncJob','join','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','toUpperCase','config','design:paramtypes','decorate','Not\x20Synchronized','object','Logger','search','../../salesforce/dto/flosum-repository-sync.dto','\x20Stop\x20sync\x20job\x20for\x20\x27','Unable\x20to\x20synchronize\x20repository\x20\x27','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.',']\x20due\x20error\x20-\x20','branchId','run','TooManyRequests','setLoggerId','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','sleep'];a111_0x2367=function(){return _0x38f823;};return a111_0x2367();}const constants_1=require(a111_0x1f0eb5(0x146)),core_1=require(a111_0x1f0eb5(0x168)),too_many_requests_error_1=require(a111_0x1f0eb5(0x14f)),flosum_repository_sync_dto_1=require(a111_0x1f0eb5(0x13a)),salesforce_error_1=require(a111_0x1f0eb5(0x116)),salesforce_sync_service_1=require(a111_0x1f0eb5(0x128)),salesforce_service_1=require(a111_0x1f0eb5(0x159)),utils_1=require(a111_0x1f0eb5(0x100)),typedi_1=require(a111_0x1f0eb5(0x149)),hooks_utils_1=require(a111_0x1f0eb5(0x171)),git_branch_not_found_error_1=require(a111_0x1f0eb5(0x172)),flosum_sync_job_1=require(a111_0x1f0eb5(0x179)),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require('../../providers/providers.tokens'),bad_request_error_1=require(a111_0x1f0eb5(0x15f));let SyncService=SyncService_1=class SyncService{constructor(_0x228e25,_0x11f2de){const _0x16394d=a111_0x1f0eb5;this['salesforceService']=_0x228e25,this[_0x16394d(0x115)]=_0x11f2de,this[_0x16394d(0x173)]=new core_1[(_0x16394d(0x138))](SyncService_1['name']),this['repositoriesIntersections']={},this[_0x16394d(0x163)]=[];}async[a111_0x1f0eb5(0x11d)](_0x43c873,_0x55b9ca){const _0x4afc5a=a111_0x1f0eb5;if(_0x55b9ca instanceof git_branch_not_found_error_1[_0x4afc5a(0x183)]){await this[_0x4afc5a(0x115)][_0x4afc5a(0x16d)](_0x43c873,_0x4afc5a(0x136));return;}if(_0x55b9ca instanceof too_many_requests_error_1[_0x4afc5a(0x141)]){await this[_0x4afc5a(0x115)][_0x4afc5a(0x16d)](_0x43c873,_0x4afc5a(0x119));throw _0x55b9ca;}try{await this['sfLogger'][_0x4afc5a(0x111)](this[_0x4afc5a(0x14c)]+_0x4afc5a(0x13b)+_0x43c873[_0x4afc5a(0x11c)]+_0x4afc5a(0x16e)+_0x43c873[_0x4afc5a(0x156)]+_0x4afc5a(0x13e)+_0x55b9ca+'.')['send'](),await this[_0x4afc5a(0x115)][_0x4afc5a(0x120)](_0x43c873,{}),await this['salesforceSync'][_0x4afc5a(0x16d)](_0x43c873,_0x4afc5a(0x106));}catch(_0x1d5266){if(_0x1d5266 instanceof salesforce_error_1['SalesforceError'])throw _0x1d5266;}}async[a111_0x1f0eb5(0x188)](_0x9f7d6a){const _0x587492=a111_0x1f0eb5;if(_0x9f7d6a['repositoryId']){const _0x2aeac9=_0x9f7d6a[_0x587492(0x11c)][_0x587492(0x182)](),_0x1c4e8c=this[_0x587492(0x153)][_0x2aeac9];if(!_0x1c4e8c)this[_0x587492(0x153)][_0x2aeac9]=_0x9f7d6a[_0x587492(0x11c)];else{if(_0x1c4e8c&&_0x1c4e8c!==_0x9f7d6a['repositoryName'])return await this[_0x587492(0x11d)](_0x9f7d6a,new Error(_0x587492(0x13c)+_0x9f7d6a[_0x587492(0x11c)]+_0x587492(0x180)+_0x2aeac9+_0x587492(0x167)+_0x1c4e8c+'\x27')),!![];}}return![];}async[a111_0x1f0eb5(0x121)](_0x5c360c){const _0x5d925b=a111_0x1f0eb5;if(!constants_1['REPOSITORY_NAME_REGEXP'][_0x5d925b(0x112)](_0x5c360c['repositoryName']))return await this[_0x5d925b(0x11d)](_0x5c360c,new Error(_0x5d925b(0x13c)+_0x5c360c[_0x5d925b(0x11c)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x5d925b(0x10b)][_0x5d925b(0x112)](_0x5c360c[_0x5d925b(0x156)]))return await this[_0x5d925b(0x11d)](_0x5c360c,new Error(_0x5d925b(0x15a)+_0x5c360c['branchName']+_0x5d925b(0x109)+_0x5c360c[_0x5d925b(0x11c)]+_0x5d925b(0x13d))),![];return!![];}async[a111_0x1f0eb5(0x158)](_0x479296,_0x10ab1b){const _0x53ed24=a111_0x1f0eb5;let _0x55b957=this[_0x53ed24(0x163)][_0x53ed24(0x17b)](_0x2f1865=>_0x479296[_0x53ed24(0x11c)]===_0x2f1865[_0x53ed24(0x14d)]);!_0x55b957&&(this['sfLogger']['log'](this['prefix']+_0x53ed24(0x152)+_0x479296[_0x53ed24(0x11c)]+_0x53ed24(0x157)),_0x55b957=await this[_0x53ed24(0x150)]['create']({'name':_0x479296['repositoryName'],'autoInit':!![],'defaultBranch':_0x479296[_0x53ed24(0x156)],'private':!![],'createHook':typedi_1[_0x53ed24(0x103)][_0x53ed24(0x11a)](providers_tokens_1['Tokens'][_0x53ed24(0x133)])[_0x53ed24(0x170)]}));if(this[_0x53ed24(0x133)]['isBidirectionalSynchronization']){const _0x41eb28=await _0x55b957['hooks'][_0x53ed24(0x184)]();!_0x41eb28[_0x53ed24(0x17b)](_0x494514=>_0x494514[_0x53ed24(0x169)]===hooks_utils_1[_0x53ed24(0x148)][_0x53ed24(0x102)](this[_0x53ed24(0x133)][_0x53ed24(0x17f)],this[_0x53ed24(0x133)][_0x53ed24(0x12c)],_0x10ab1b))&&(this[_0x53ed24(0x147)][_0x53ed24(0x17d)](this[_0x53ed24(0x14c)]+_0x53ed24(0x152)+_0x479296[_0x53ed24(0x11c)]+_0x53ed24(0x143)),await _0x55b957[_0x53ed24(0x10c)][_0x53ed24(0x10f)](hooks_utils_1[_0x53ed24(0x148)][_0x53ed24(0x164)](this['config'][_0x53ed24(0x17f)],_0x55b957[_0x53ed24(0x10c)],this[_0x53ed24(0x133)][_0x53ed24(0x12c)],_0x10ab1b)));}return this[_0x53ed24(0x163)][_0x53ed24(0x175)](_0x55b957),_0x55b957;}async['run'](){const _0xd4c02f=a111_0x1f0eb5;this[_0xd4c02f(0x176)]=typedi_1[_0xd4c02f(0x103)][_0xd4c02f(0x11a)](providers_tokens_1[_0xd4c02f(0x15e)]['gitApiService']),this[_0xd4c02f(0x150)]=typedi_1[_0xd4c02f(0x103)][_0xd4c02f(0x11a)](providers_tokens_1[_0xd4c02f(0x15e)][_0xd4c02f(0x15d)]),this[_0xd4c02f(0x133)]=typedi_1[_0xd4c02f(0x103)][_0xd4c02f(0x11a)](providers_tokens_1[_0xd4c02f(0x15e)][_0xd4c02f(0x133)]),this['sfLogger']=typedi_1[_0xd4c02f(0x103)][_0xd4c02f(0x11a)](providers_tokens_1[_0xd4c02f(0x15e)][_0xd4c02f(0x173)]),this['prefix']='['+SyncService_1[_0xd4c02f(0x14d)]+_0xd4c02f(0x12a)+this[_0xd4c02f(0x133)][_0xd4c02f(0x17f)][_0xd4c02f(0x132)]()+']',this[_0xd4c02f(0x187)][_0xd4c02f(0x142)](this[_0xd4c02f(0x147)][_0xd4c02f(0x12e)]());try{this['sfLogger'][_0xd4c02f(0x17d)](this[_0xd4c02f(0x14c)]+_0xd4c02f(0x126)),await this[_0xd4c02f(0x147)]['log'](this[_0xd4c02f(0x14c)]+_0xd4c02f(0x122))[_0xd4c02f(0x117)]();const _0x335128=await this[_0xd4c02f(0x115)]['getRepositoryRecords'](typedi_1['Container'][_0xd4c02f(0x11a)](providers_tokens_1[_0xd4c02f(0x15e)]['connectionId']));if(!_0x335128['length'])throw new bad_request_error_1['BadRequestError'](this[_0xd4c02f(0x14c)]+_0xd4c02f(0x16f));await this[_0xd4c02f(0x147)]['log'](this[_0xd4c02f(0x14c)]+'\x20Getting\x20branch\x20records.')['send']();const _0x19e302=await this[_0xd4c02f(0x115)]['getBranchRecords'](_0x335128['map'](_0x2299b=>'\x27'+_0x2299b['repositoryId']+'\x27')[_0xd4c02f(0x130)](','));await this['sfLogger'][_0xd4c02f(0x17d)](this[_0xd4c02f(0x14c)]+_0xd4c02f(0x110))[_0xd4c02f(0x117)](),this[_0xd4c02f(0x163)]=await this[_0xd4c02f(0x150)][_0xd4c02f(0x184)]();const _0x456a51=[..._0x335128,..._0x19e302];this[_0xd4c02f(0x147)][_0xd4c02f(0x17d)](this[_0xd4c02f(0x14c)]+_0xd4c02f(0x162)+_0x456a51['length']+_0xd4c02f(0x12d));for(const _0x504c47 of _0x456a51){this[_0xd4c02f(0x173)][_0xd4c02f(0x17d)](_0xd4c02f(0x108)+_0x504c47['repositoryName']+'['+_0x504c47['repositoryId']+_0xd4c02f(0x155)+_0x504c47[_0xd4c02f(0x156)]+'['+_0x504c47[_0xd4c02f(0x13f)]+_0xd4c02f(0x114)),this[_0xd4c02f(0x147)][_0xd4c02f(0x17d)](this[_0xd4c02f(0x14c)]+_0xd4c02f(0x10a)+_0x504c47[_0xd4c02f(0x11c)]+_0xd4c02f(0x186)+_0x504c47[_0xd4c02f(0x156)]+'\x22.'),this['sfLogger'][_0xd4c02f(0x17d)](this[_0xd4c02f(0x14c)]+_0xd4c02f(0x129));const _0x2ce885=await this['checkValidNaming'](_0x504c47);if(!_0x2ce885)continue;this['sfLogger'][_0xd4c02f(0x17d)](this['prefix']+_0xd4c02f(0x14a));const _0x28ff9f=await this[_0xd4c02f(0x188)](_0x504c47);if(_0x28ff9f)continue;await this[_0xd4c02f(0x147)][_0xd4c02f(0x117)]();let _0x109d1e;try{await this[_0xd4c02f(0x147)][_0xd4c02f(0x17d)](this[_0xd4c02f(0x14c)]+_0xd4c02f(0x161))[_0xd4c02f(0x117)](),_0x109d1e=await this['getOrCreateRepo'](_0x504c47,typedi_1[_0xd4c02f(0x103)][_0xd4c02f(0x11a)](providers_tokens_1[_0xd4c02f(0x15e)][_0xd4c02f(0x11b)]));}catch(_0x567acb){await this['handleRecordSyncError'](_0x504c47,_0x567acb instanceof too_many_requests_error_1[_0xd4c02f(0x141)]?_0x567acb:new Error(_0xd4c02f(0x118)+_0x567acb));continue;}await this[_0xd4c02f(0x147)]['log'](this[_0xd4c02f(0x14c)]+'\x20Completed\x20prepare\x20to\x20syncing.')[_0xd4c02f(0x117)]();if(_0x504c47['direction']===flosum_repository_sync_dto_1[_0xd4c02f(0x10e)][_0xd4c02f(0x17e)]){const _0x528e3a=typedi_1[_0xd4c02f(0x103)][_0xd4c02f(0x11a)](flosum_sync_job_1[_0xd4c02f(0x12f)]);await _0x528e3a['run']({'repository':_0x109d1e,'convertToSFDX':this[_0xd4c02f(0x133)][_0xd4c02f(0x105)],'syncRecord':_0x504c47,'provider':this[_0xd4c02f(0x133)][_0xd4c02f(0x17f)]})[_0xd4c02f(0x107)](_0x5042bf=>this[_0xd4c02f(0x11d)](_0x504c47,_0x5042bf));}else{const _0x1cbbb7=typedi_1[_0xd4c02f(0x103)][_0xd4c02f(0x11a)](git_sync_job_1[_0xd4c02f(0x124)]);await _0x1cbbb7[_0xd4c02f(0x140)]({'repository':_0x109d1e,'branch':_0x504c47[_0xd4c02f(0x156)],'provider':this[_0xd4c02f(0x133)][_0xd4c02f(0x17f)],'repositoryGit':_0x109d1e[_0xd4c02f(0x125)],'syncRecord':_0x504c47})[_0xd4c02f(0x107)](_0xfda690=>this['handleRecordSyncError'](_0x504c47,_0xfda690));}}}catch(_0x183b65){this[_0xd4c02f(0x173)][_0xd4c02f(0x111)](_0x183b65);_0x183b65 instanceof too_many_requests_error_1[_0xd4c02f(0x141)]?(await this[_0xd4c02f(0x147)][_0xd4c02f(0x17d)](this[_0xd4c02f(0x14c)]+_0xd4c02f(0x101))[_0xd4c02f(0x117)](),await(0x0,utils_1[_0xd4c02f(0x144)])(0x3c*0x3c*0x3e8),this['run']()):await this[_0xd4c02f(0x147)][_0xd4c02f(0x111)](this[_0xd4c02f(0x14c)]+_0xd4c02f(0x131)+_0x183b65)['send']();return;}await this[_0xd4c02f(0x147)][_0xd4c02f(0x17d)](this['prefix']+_0xd4c02f(0x154))[_0xd4c02f(0x117)](),await this['salesforceSync'][_0xd4c02f(0x185)](typedi_1['Container'][_0xd4c02f(0x11a)](providers_tokens_1[_0xd4c02f(0x15e)][_0xd4c02f(0x11b)]))['catch'](()=>null);}};function a111_0x1dc9(_0x3f2d11,_0x3472ef){const _0x2b48f7=a111_0x2367();return a111_0x1dc9=function(_0x41232a,_0x5cff4d){_0x41232a=_0x41232a-0x100;let _0x23672b=_0x2b48f7[_0x41232a];return _0x23672b;},a111_0x1dc9(_0x3f2d11,_0x3472ef);}SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x1f0eb5(0x14b)])({'transient':!![]}),__metadata(a111_0x1f0eb5(0x134),[salesforce_service_1[a111_0x1f0eb5(0x160)],salesforce_sync_service_1[a111_0x1f0eb5(0x11e)]])],SyncService),exports[a111_0x1f0eb5(0x145)]=SyncService;