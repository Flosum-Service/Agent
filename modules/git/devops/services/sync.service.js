const a67_0xcd3ec=a67_0x53fd;(function(_0x562eda,_0x20336b){const _0x3568af=a67_0x53fd,_0x1a71c8=_0x562eda();while(!![]){try{const _0x4eaac6=-parseInt(_0x3568af(0xd3))/0x1+parseInt(_0x3568af(0xb0))/0x2*(parseInt(_0x3568af(0xba))/0x3)+parseInt(_0x3568af(0xec))/0x4*(-parseInt(_0x3568af(0x100))/0x5)+parseInt(_0x3568af(0xfd))/0x6+parseInt(_0x3568af(0xc0))/0x7+parseInt(_0x3568af(0xc6))/0x8*(-parseInt(_0x3568af(0xe1))/0x9)+parseInt(_0x3568af(0x106))/0xa;if(_0x4eaac6===_0x20336b)break;else _0x1a71c8['push'](_0x1a71c8['shift']());}catch(_0x1119ba){_0x1a71c8['push'](_0x1a71c8['shift']());}}}(a67_0x5c64,0xe254e));const a67_0x4eacf3=(function(){let _0x183252=!![];return function(_0x204afe,_0x41f07c){const _0x3a6175=_0x183252?function(){const _0x305508=a67_0x53fd;if(_0x41f07c){const _0x2ea82c=_0x41f07c[_0x305508(0xe3)](_0x204afe,arguments);return _0x41f07c=null,_0x2ea82c;}}:function(){};return _0x183252=![],_0x3a6175;};}()),a67_0x249959=a67_0x4eacf3(this,function(){const _0x4c2e23=a67_0x53fd;return a67_0x249959[_0x4c2e23(0x99)]()[_0x4c2e23(0xf3)](_0x4c2e23(0xfc))['toString']()[_0x4c2e23(0xe0)](a67_0x249959)[_0x4c2e23(0xf3)]('(((.+)+)+)+$');});a67_0x249959();'use strict';function a67_0x53fd(_0x285bc8,_0x20a433){const _0x2909c5=a67_0x5c64();return a67_0x53fd=function(_0x249959,_0x4eacf3){_0x249959=_0x249959-0x96;let _0x5c640c=_0x2909c5[_0x249959];return _0x5c640c;},a67_0x53fd(_0x285bc8,_0x20a433);}var __decorate=this&&this[a67_0xcd3ec(0xce)]||function(_0x45d7c5,_0x14f4a8,_0xffc53b,_0x2a0820){const _0x514e44=a67_0xcd3ec;var _0xb48938=arguments[_0x514e44(0xcf)],_0xe97f71=_0xb48938<0x3?_0x14f4a8:_0x2a0820===null?_0x2a0820=Object[_0x514e44(0xf0)](_0x14f4a8,_0xffc53b):_0x2a0820,_0x21252d;if(typeof Reflect===_0x514e44(0xf6)&&typeof Reflect[_0x514e44(0xae)]==='function')_0xe97f71=Reflect['decorate'](_0x45d7c5,_0x14f4a8,_0xffc53b,_0x2a0820);else{for(var _0x10b3c2=_0x45d7c5[_0x514e44(0xcf)]-0x1;_0x10b3c2>=0x0;_0x10b3c2--)if(_0x21252d=_0x45d7c5[_0x10b3c2])_0xe97f71=(_0xb48938<0x3?_0x21252d(_0xe97f71):_0xb48938>0x3?_0x21252d(_0x14f4a8,_0xffc53b,_0xe97f71):_0x21252d(_0x14f4a8,_0xffc53b))||_0xe97f71;}return _0xb48938>0x3&&_0xe97f71&&Object[_0x514e44(0xb7)](_0x14f4a8,_0xffc53b,_0xe97f71),_0xe97f71;},__metadata=this&&this[a67_0xcd3ec(0xc4)]||function(_0x5826ec,_0x23d5f5){const _0x4e43ce=a67_0xcd3ec;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x4e43ce(0xa3))return Reflect['metadata'](_0x5826ec,_0x23d5f5);},SyncService_1;function a67_0x5c64(){const _0x1a32f0=['getOwnPropertyDescriptor','Unable\x20to\x20synchronize\x20repository\x20\x27','repoService','search','BadRequestError','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','object','Container','GitSyncJob','gitProvider','\x20Have\x20to\x20synchronize\x20','catch','(((.+)+)+)+$','398304QKIFIc','prefix','../../../shared/utils','15HWAkcL','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','Tokens','Not\x20Synchronized','__esModule','getAll','25379360lcNTfM','\x27\x20-\x20\x27','design:paramtypes','\x22\x20branch:\x20\x22','join','updateRemoteState','applicationUrl','TooManyRequests','repositoryName','GitBranchNotFoundError','Waiting','find','BRANCH_NAME_REGEXP',']\x20branch.','toString','SalesforceService','get','isIntersects','Service','getHookLinkFor','FlosumToGit','branchName','\x20Getting\x20branch\x20records.','SalesforceError','function','test','handleRecordSyncError','connectionId','repositoryId','isConvertToSfdx','hooks','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','salesforceService','push','repoList','decorate','../../salesforce/services/salesforce-sync.service','872swhPvb','toLowerCase','REPOSITORY_NAME_REGEXP','getOrCreateRepo','SyncService','createHookPayload','sfLogger','defineProperty','\x20branches.','config','2406amwAcr','getLoggerId','\x27\x20in\x20repository\x20\x27','../../providers/providers.tokens','getBranchRecords','HooksUtils','8098839NAVjTc','repositoriesIntersections','\x20Getting\x20Flosum\x20repository','name','__metadata','create','8CRtdPI','setStatus','isBidirectionalSynchronization','../../providers/web-hooks/hooks.utils','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','\x20Getting\x20repositories\x20from\x20git\x20service.','SyncDirection','error','__decorate','length','Syncing\x20','FlosumSyncJob','Logger','1323422MVnljS','\x20Checking\x20valid\x20name.','../jobs/flosum-sync.job','send',']\x20[','\x20Getting\x20repository\x20records.','logger','run','sleep','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','disableSync','\x20Start\x20sync\x20job.','url','constructor','12903201mWZiOO','\x20No\x20repositories\x20to\x20sync.','apply','../../salesforce/services/salesforce.service','salesforceSync','\x20Repository\x20\x22','\x20Completed\x20prepare\x20to\x20syncing.','checkValidNaming',']\x20repository\x20','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','Error','569072jqxNmY','log','\x20Syncing\x20repository:\x20\x22','../../../../constants'];a67_0x5c64=function(){return _0x1a32f0;};return a67_0x5c64();}Object[a67_0xcd3ec(0xb7)](exports,a67_0xcd3ec(0x104),{'value':!![]}),exports[a67_0xcd3ec(0xb4)]=void 0x0;const constants_1=require(a67_0xcd3ec(0xef)),core_1=require('../../../../core'),too_many_requests_error_1=require('../../../../core/errors/too-many-requests.error'),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require(a67_0xcd3ec(0xaf)),salesforce_service_1=require(a67_0xcd3ec(0xe4)),utils_1=require(a67_0xcd3ec(0xff)),typedi_1=require('typedi'),hooks_utils_1=require(a67_0xcd3ec(0xc9)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require(a67_0xcd3ec(0xd5)),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require(a67_0xcd3ec(0xbd)),bad_request_error_1=require('../../../../core/errors/bad-request.error');let SyncService=SyncService_1=class SyncService{constructor(_0x23954c,_0x297ad4){const _0x586845=a67_0xcd3ec;this[_0x586845(0xab)]=_0x23954c,this[_0x586845(0xe5)]=_0x297ad4,this[_0x586845(0xd9)]=new core_1[(_0x586845(0xd2))](SyncService_1[_0x586845(0xc3)]),this['repositoriesIntersections']={},this[_0x586845(0xad)]=[];}async['handleRecordSyncError'](_0x50b5aa,_0x58c2cd){const _0x1a6932=a67_0xcd3ec;if(_0x58c2cd instanceof git_branch_not_found_error_1[_0x1a6932(0x10f)]){await this[_0x1a6932(0xe5)]['setStatus'](_0x50b5aa,_0x1a6932(0x103));return;}if(_0x58c2cd instanceof too_many_requests_error_1[_0x1a6932(0x10d)]){await this[_0x1a6932(0xe5)][_0x1a6932(0xc7)](_0x50b5aa,_0x1a6932(0x110));throw _0x58c2cd;}try{await this[_0x1a6932(0xb6)]['error'](this[_0x1a6932(0xfe)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x50b5aa[_0x1a6932(0x10e)]+'\x27\x20['+_0x50b5aa[_0x1a6932(0xa0)]+']\x20due\x20error\x20-\x20'+_0x58c2cd+'.')[_0x1a6932(0xd6)](),await this['salesforceSync'][_0x1a6932(0x10b)](_0x50b5aa,{}),await this[_0x1a6932(0xe5)]['setStatus'](_0x50b5aa,_0x1a6932(0xeb));}catch(_0x40feb2){if(_0x40feb2 instanceof salesforce_error_1[_0x1a6932(0xa2)])throw _0x40feb2;}}async[a67_0xcd3ec(0x9c)](_0x4bdfba){const _0x2cd8ee=a67_0xcd3ec;if(_0x4bdfba[_0x2cd8ee(0xa7)]){const _0x3930bc=_0x4bdfba[_0x2cd8ee(0x10e)][_0x2cd8ee(0xb1)](),_0x1126fe=this[_0x2cd8ee(0xc1)][_0x3930bc];if(!_0x1126fe)this[_0x2cd8ee(0xc1)][_0x3930bc]=_0x4bdfba[_0x2cd8ee(0x10e)];else{if(_0x1126fe&&_0x1126fe!==_0x4bdfba[_0x2cd8ee(0x10e)])return await this[_0x2cd8ee(0xa5)](_0x4bdfba,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x4bdfba[_0x2cd8ee(0x10e)]+_0x2cd8ee(0xdc)+_0x3930bc+_0x2cd8ee(0x107)+_0x1126fe+'\x27')),!![];}}return![];}async[a67_0xcd3ec(0xe8)](_0x4c1c1e){const _0x3d7568=a67_0xcd3ec;if(!constants_1[_0x3d7568(0xb2)][_0x3d7568(0xa4)](_0x4c1c1e[_0x3d7568(0x10e)]))return await this[_0x3d7568(0xa5)](_0x4c1c1e,new Error(_0x3d7568(0xf1)+_0x4c1c1e[_0x3d7568(0x10e)]+_0x3d7568(0xca))),![];if(!constants_1[_0x3d7568(0x97)][_0x3d7568(0xa4)](_0x4c1c1e[_0x3d7568(0xa0)]))return await this[_0x3d7568(0xa5)](_0x4c1c1e,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x4c1c1e[_0x3d7568(0xa0)]+_0x3d7568(0xbc)+_0x4c1c1e[_0x3d7568(0x10e)]+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async[a67_0xcd3ec(0xb3)](_0x437ef7,_0x7b9f68){const _0x189616=a67_0xcd3ec;let _0x38ca77=this[_0x189616(0xad)][_0x189616(0x96)](_0x697a95=>_0x437ef7[_0x189616(0x10e)]===_0x697a95['name']);!_0x38ca77&&(this[_0x189616(0xb6)][_0x189616(0xed)](this[_0x189616(0xfe)]+_0x189616(0xe6)+_0x437ef7[_0x189616(0x10e)]+_0x189616(0xf5)),_0x38ca77=await this['repoService'][_0x189616(0xc5)]({'name':_0x437ef7[_0x189616(0x10e)],'autoInit':!![],'defaultBranch':_0x437ef7[_0x189616(0xa0)],'private':!![],'createHook':typedi_1[_0x189616(0xf7)]['get'](providers_tokens_1[_0x189616(0x102)][_0x189616(0xb9)])[_0x189616(0xc8)]}));if(this[_0x189616(0xb9)]['isBidirectionalSynchronization']){const _0x24db9d=await _0x38ca77[_0x189616(0xa9)][_0x189616(0x105)]();!_0x24db9d[_0x189616(0x96)](_0x37852b=>_0x37852b[_0x189616(0xdf)]===hooks_utils_1['HooksUtils'][_0x189616(0x9e)](this[_0x189616(0xb9)][_0x189616(0xf9)],this[_0x189616(0xb9)][_0x189616(0x10c)],_0x7b9f68))&&(this[_0x189616(0xb6)]['log'](this[_0x189616(0xfe)]+_0x189616(0xe6)+_0x437ef7[_0x189616(0x10e)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x38ca77[_0x189616(0xa9)][_0x189616(0xc5)](hooks_utils_1[_0x189616(0xbf)][_0x189616(0xb5)](this[_0x189616(0xb9)][_0x189616(0xf9)],_0x38ca77[_0x189616(0xa9)],this[_0x189616(0xb9)][_0x189616(0x10c)],_0x7b9f68)));}return this[_0x189616(0xad)][_0x189616(0xac)](_0x38ca77),_0x38ca77;}async[a67_0xcd3ec(0xda)](){const _0x3cc18f=a67_0xcd3ec;this['gitApiService']=typedi_1[_0x3cc18f(0xf7)][_0x3cc18f(0x9b)](providers_tokens_1[_0x3cc18f(0x102)]['gitApiService']),this['repoService']=typedi_1['Container'][_0x3cc18f(0x9b)](providers_tokens_1[_0x3cc18f(0x102)]['gitRepoService']),this[_0x3cc18f(0xb9)]=typedi_1['Container']['get'](providers_tokens_1[_0x3cc18f(0x102)][_0x3cc18f(0xb9)]),this[_0x3cc18f(0xb6)]=typedi_1[_0x3cc18f(0xf7)]['get'](providers_tokens_1[_0x3cc18f(0x102)]['logger']),this['prefix']='['+SyncService_1[_0x3cc18f(0xc3)]+_0x3cc18f(0xd7)+this[_0x3cc18f(0xb9)][_0x3cc18f(0xf9)]['toUpperCase']()+']',this[_0x3cc18f(0xab)]['setLoggerId'](this[_0x3cc18f(0xb6)][_0x3cc18f(0xbb)]());try{this[_0x3cc18f(0xb6)]['log'](this[_0x3cc18f(0xfe)]+_0x3cc18f(0xde)),await this['sfLogger'][_0x3cc18f(0xed)](this['prefix']+_0x3cc18f(0xd8))[_0x3cc18f(0xd6)]();const _0x38be09=await this['salesforceSync']['getRepositoryRecords'](typedi_1[_0x3cc18f(0xf7)][_0x3cc18f(0x9b)](providers_tokens_1[_0x3cc18f(0x102)]['connectionId']));if(!_0x38be09[_0x3cc18f(0xcf)])throw new bad_request_error_1[(_0x3cc18f(0xf4))](this[_0x3cc18f(0xfe)]+_0x3cc18f(0xe2));await this[_0x3cc18f(0xb6)]['log'](this['prefix']+_0x3cc18f(0xa1))[_0x3cc18f(0xd6)]();const _0x234a51=await this[_0x3cc18f(0xe5)][_0x3cc18f(0xbe)](_0x38be09['map'](_0x364a01=>'\x27'+_0x364a01[_0x3cc18f(0xa7)]+'\x27')[_0x3cc18f(0x10a)](','));await this['sfLogger'][_0x3cc18f(0xed)](this[_0x3cc18f(0xfe)]+_0x3cc18f(0xcb))[_0x3cc18f(0xd6)](),this[_0x3cc18f(0xad)]=await this[_0x3cc18f(0xf2)]['getAll']();const _0x222d47=[..._0x38be09,..._0x234a51];this['sfLogger'][_0x3cc18f(0xed)](this['prefix']+_0x3cc18f(0xfa)+_0x222d47[_0x3cc18f(0xcf)]+_0x3cc18f(0xb8));for(const _0x46a77c of _0x222d47){this[_0x3cc18f(0xd9)][_0x3cc18f(0xed)](_0x3cc18f(0xd0)+_0x46a77c['repositoryName']+'['+_0x46a77c['repositoryId']+_0x3cc18f(0xe9)+_0x46a77c['branchName']+'['+_0x46a77c['branchId']+_0x3cc18f(0x98)),this[_0x3cc18f(0xb6)][_0x3cc18f(0xed)](this[_0x3cc18f(0xfe)]+_0x3cc18f(0xee)+_0x46a77c['repositoryName']+_0x3cc18f(0x109)+_0x46a77c[_0x3cc18f(0xa0)]+'\x22.'),this[_0x3cc18f(0xb6)][_0x3cc18f(0xed)](this['prefix']+_0x3cc18f(0xd4));const _0x93d1f=await this['checkValidNaming'](_0x46a77c);if(!_0x93d1f)continue;this[_0x3cc18f(0xb6)]['log'](this[_0x3cc18f(0xfe)]+'\x20Checking\x20intersects.');const _0x6ce07a=await this['isIntersects'](_0x46a77c);if(_0x6ce07a)continue;await this[_0x3cc18f(0xb6)][_0x3cc18f(0xd6)]();let _0x5692af;try{await this[_0x3cc18f(0xb6)]['log'](this[_0x3cc18f(0xfe)]+_0x3cc18f(0xc2))[_0x3cc18f(0xd6)](),_0x5692af=await this['getOrCreateRepo'](_0x46a77c,typedi_1[_0x3cc18f(0xf7)][_0x3cc18f(0x9b)](providers_tokens_1['Tokens'][_0x3cc18f(0xa6)]));}catch(_0xe21cbd){await this[_0x3cc18f(0xa5)](_0x46a77c,_0xe21cbd instanceof too_many_requests_error_1[_0x3cc18f(0x10d)]?_0xe21cbd:new Error(_0x3cc18f(0xea)+_0xe21cbd));continue;}await this[_0x3cc18f(0xb6)]['log'](this[_0x3cc18f(0xfe)]+_0x3cc18f(0xe7))[_0x3cc18f(0xd6)]();if(_0x46a77c['direction']===flosum_repository_sync_dto_1[_0x3cc18f(0xcc)][_0x3cc18f(0x9f)]){const _0x5e4114=typedi_1[_0x3cc18f(0xf7)]['get'](flosum_sync_job_1[_0x3cc18f(0xd1)]);await _0x5e4114[_0x3cc18f(0xda)]({'repository':_0x5692af,'convertToSFDX':this['config'][_0x3cc18f(0xa8)],'syncRecord':_0x46a77c,'provider':this[_0x3cc18f(0xb9)][_0x3cc18f(0xf9)]})[_0x3cc18f(0xfb)](_0x1934ac=>this[_0x3cc18f(0xa5)](_0x46a77c,_0x1934ac));}else{const _0x64348c=typedi_1[_0x3cc18f(0xf7)][_0x3cc18f(0x9b)](git_sync_job_1[_0x3cc18f(0xf8)]);await _0x64348c[_0x3cc18f(0xda)]({'repository':_0x5692af,'branch':_0x46a77c[_0x3cc18f(0xa0)],'provider':this[_0x3cc18f(0xb9)]['gitProvider'],'repositoryGit':_0x5692af['gitUrl'],'syncRecord':_0x46a77c})[_0x3cc18f(0xfb)](_0x895268=>this[_0x3cc18f(0xa5)](_0x46a77c,_0x895268));}}}catch(_0x2a0d54){this['logger'][_0x3cc18f(0xcd)](_0x2a0d54);_0x2a0d54 instanceof too_many_requests_error_1[_0x3cc18f(0x10d)]?(await this[_0x3cc18f(0xb6)][_0x3cc18f(0xed)](this[_0x3cc18f(0xfe)]+_0x3cc18f(0xaa))['send'](),await utils_1[_0x3cc18f(0xdb)](0x3c*0x3c*0x3e8),this[_0x3cc18f(0xda)]()):await this[_0x3cc18f(0xb6)][_0x3cc18f(0xcd)](this[_0x3cc18f(0xfe)]+_0x3cc18f(0x101)+_0x2a0d54)[_0x3cc18f(0xd6)]();return;}await this[_0x3cc18f(0xb6)][_0x3cc18f(0xed)](this[_0x3cc18f(0xfe)]+'\x20Sync\x20job\x20done.')[_0x3cc18f(0xd6)](),await this[_0x3cc18f(0xe5)][_0x3cc18f(0xdd)](typedi_1['Container'][_0x3cc18f(0x9b)](providers_tokens_1[_0x3cc18f(0x102)]['connectionId']))[_0x3cc18f(0xfb)](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1[a67_0xcd3ec(0x9d)]({'transient':!![]}),__metadata(a67_0xcd3ec(0x108),[salesforce_service_1[a67_0xcd3ec(0x9a)],salesforce_sync_service_1['SalesforceSyncService']])],SyncService),exports[a67_0xcd3ec(0xb4)]=SyncService;