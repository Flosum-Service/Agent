const a111_0x551041=a111_0x6260;(function(_0x5ea63d,_0x4a4590){const _0x3aa02e=a111_0x6260,_0x1134de=_0x5ea63d();while(!![]){try{const _0x50836a=-parseInt(_0x3aa02e(0x1dd))/0x1*(-parseInt(_0x3aa02e(0x20b))/0x2)+parseInt(_0x3aa02e(0x1df))/0x3*(-parseInt(_0x3aa02e(0x248))/0x4)+parseInt(_0x3aa02e(0x1e7))/0x5+parseInt(_0x3aa02e(0x215))/0x6*(parseInt(_0x3aa02e(0x24d))/0x7)+parseInt(_0x3aa02e(0x22d))/0x8*(-parseInt(_0x3aa02e(0x23f))/0x9)+parseInt(_0x3aa02e(0x238))/0xa*(-parseInt(_0x3aa02e(0x207))/0xb)+-parseInt(_0x3aa02e(0x21b))/0xc*(-parseInt(_0x3aa02e(0x214))/0xd);if(_0x50836a===_0x4a4590)break;else _0x1134de['push'](_0x1134de['shift']());}catch(_0x4d46da){_0x1134de['push'](_0x1134de['shift']());}}}(a111_0x21e1,0xa1b2b));const a111_0x54f5c2=(function(){let _0x547c98=!![];return function(_0x4a9810,_0x11ac78){const _0x37c713=_0x547c98?function(){if(_0x11ac78){const _0x17fcdb=_0x11ac78['apply'](_0x4a9810,arguments);return _0x11ac78=null,_0x17fcdb;}}:function(){};return _0x547c98=![],_0x37c713;};}()),a111_0xcfdef5=a111_0x54f5c2(this,function(){const _0x3910bf=a111_0x6260;return a111_0xcfdef5[_0x3910bf(0x1f6)]()[_0x3910bf(0x211)](_0x3910bf(0x22c))[_0x3910bf(0x1f6)]()[_0x3910bf(0x1ee)](a111_0xcfdef5)['search'](_0x3910bf(0x22c));});a111_0xcfdef5();'use strict';var __decorate=this&&this[a111_0x551041(0x1ff)]||function(_0x2570f6,_0x262886,_0x52429a,_0x57379c){const _0x435b62=a111_0x551041;var _0x3deeac=arguments[_0x435b62(0x229)],_0x182d58=_0x3deeac<0x3?_0x262886:_0x57379c===null?_0x57379c=Object['getOwnPropertyDescriptor'](_0x262886,_0x52429a):_0x57379c,_0xa9e47b;if(typeof Reflect===_0x435b62(0x1f2)&&typeof Reflect[_0x435b62(0x1f7)]===_0x435b62(0x1f3))_0x182d58=Reflect[_0x435b62(0x1f7)](_0x2570f6,_0x262886,_0x52429a,_0x57379c);else{for(var _0x46ff9f=_0x2570f6[_0x435b62(0x229)]-0x1;_0x46ff9f>=0x0;_0x46ff9f--)if(_0xa9e47b=_0x2570f6[_0x46ff9f])_0x182d58=(_0x3deeac<0x3?_0xa9e47b(_0x182d58):_0x3deeac>0x3?_0xa9e47b(_0x262886,_0x52429a,_0x182d58):_0xa9e47b(_0x262886,_0x52429a))||_0x182d58;}return _0x3deeac>0x3&&_0x182d58&&Object['defineProperty'](_0x262886,_0x52429a,_0x182d58),_0x182d58;},__metadata=this&&this['__metadata']||function(_0x51b59e,_0x165dbb){const _0xea2f25=a111_0x551041;if(typeof Reflect==='object'&&typeof Reflect[_0xea2f25(0x20c)]===_0xea2f25(0x1f3))return Reflect[_0xea2f25(0x20c)](_0x51b59e,_0x165dbb);},SyncService_1;function a111_0x6260(_0x8e7bdf,_0x40a27f){const _0x67733f=a111_0x21e1();return a111_0x6260=function(_0xcfdef5,_0x54f5c2){_0xcfdef5=_0xcfdef5-0x1d2;let _0x21e16f=_0x67733f[_0xcfdef5];return _0x21e16f;},a111_0x6260(_0x8e7bdf,_0x40a27f);}Object['defineProperty'](exports,a111_0x551041(0x23a),{'value':!![]}),exports[a111_0x551041(0x1ef)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a111_0x551041(0x1d2)),too_many_requests_error_1=require(a111_0x551041(0x1e3)),flosum_repository_sync_dto_1=require(a111_0x551041(0x227)),salesforce_error_1=require(a111_0x551041(0x21e)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a111_0x551041(0x246)),utils_1=require(a111_0x551041(0x1e1)),typedi_1=require(a111_0x551041(0x1f1)),hooks_utils_1=require(a111_0x551041(0x24b)),git_branch_not_found_error_1=require(a111_0x551041(0x213)),flosum_sync_job_1=require(a111_0x551041(0x200)),git_sync_job_1=require(a111_0x551041(0x20f)),providers_tokens_1=require('../../providers/providers.tokens'),bad_request_error_1=require('../../../../core/errors/bad-request.error');let SyncService=SyncService_1=class SyncService{constructor(_0x54e9ca,_0x288a9a){const _0x7209f3=a111_0x551041;this[_0x7209f3(0x1ec)]=_0x54e9ca,this['salesforceSync']=_0x288a9a,this['logger']=new core_1[(_0x7209f3(0x1dc))](SyncService_1[_0x7209f3(0x1d6)]),this[_0x7209f3(0x20d)]={},this['repoList']=[];}async['handleRecordSyncError'](_0x2dd9a4,_0x2e1437){const _0x54c841=a111_0x551041;if(_0x2e1437 instanceof git_branch_not_found_error_1[_0x54c841(0x21c)]){await this[_0x54c841(0x208)][_0x54c841(0x21a)](_0x2dd9a4,'Not\x20Synchronized');return;}if(_0x2e1437 instanceof too_many_requests_error_1[_0x54c841(0x241)]){await this[_0x54c841(0x208)][_0x54c841(0x21a)](_0x2dd9a4,_0x54c841(0x1f0));throw _0x2e1437;}try{await this[_0x54c841(0x232)][_0x54c841(0x240)](this[_0x54c841(0x202)]+_0x54c841(0x230)+_0x2dd9a4[_0x54c841(0x24e)]+_0x54c841(0x1fa)+_0x2dd9a4['branchName']+']\x20due\x20error\x20-\x20'+_0x2e1437+'.')[_0x54c841(0x205)](),await this['salesforceSync'][_0x54c841(0x22b)](_0x2dd9a4,{}),await this[_0x54c841(0x208)][_0x54c841(0x21a)](_0x2dd9a4,_0x54c841(0x1eb));}catch(_0xaca094){if(_0xaca094 instanceof salesforce_error_1[_0x54c841(0x231)])throw _0xaca094;}}async['isIntersects'](_0xb830d0){const _0x534444=a111_0x551041;if(_0xb830d0['repositoryId']){const _0x596abc=_0xb830d0[_0x534444(0x24e)][_0x534444(0x243)](),_0xa14ace=this[_0x534444(0x20d)][_0x596abc];if(!_0xa14ace)this[_0x534444(0x20d)][_0x596abc]=_0xb830d0[_0x534444(0x24e)];else{if(_0xa14ace&&_0xa14ace!==_0xb830d0[_0x534444(0x24e)])return await this[_0x534444(0x1e9)](_0xb830d0,new Error(_0x534444(0x1ea)+_0xb830d0[_0x534444(0x24e)]+_0x534444(0x245)+_0x596abc+_0x534444(0x1da)+_0xa14ace+'\x27')),!![];}}return![];}async[a111_0x551041(0x1ed)](_0x4f3360){const _0x2fcf6d=a111_0x551041;if(!constants_1[_0x2fcf6d(0x1e2)][_0x2fcf6d(0x1e8)](_0x4f3360['repositoryName']))return await this[_0x2fcf6d(0x1e9)](_0x4f3360,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x4f3360[_0x2fcf6d(0x24e)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x2fcf6d(0x1d5)][_0x2fcf6d(0x1e8)](_0x4f3360[_0x2fcf6d(0x226)]))return await this[_0x2fcf6d(0x1e9)](_0x4f3360,new Error(_0x2fcf6d(0x217)+_0x4f3360['branchName']+'\x27\x20in\x20repository\x20\x27'+_0x4f3360['repositoryName']+_0x2fcf6d(0x1e5))),![];return!![];}async[a111_0x551041(0x1fe)](_0x2e7866,_0x3a673b){const _0x3cbdf0=a111_0x551041;let _0x4b1a20=this[_0x3cbdf0(0x221)][_0x3cbdf0(0x1fd)](_0x28a6be=>_0x2e7866[_0x3cbdf0(0x24e)]===_0x28a6be[_0x3cbdf0(0x1d6)]);!_0x4b1a20&&(this[_0x3cbdf0(0x232)]['log'](this[_0x3cbdf0(0x202)]+_0x3cbdf0(0x236)+_0x2e7866['repositoryName']+_0x3cbdf0(0x24c)),_0x4b1a20=await this[_0x3cbdf0(0x23c)][_0x3cbdf0(0x1fc)]({'name':_0x2e7866[_0x3cbdf0(0x24e)],'autoInit':!![],'defaultBranch':_0x2e7866[_0x3cbdf0(0x226)],'private':!![],'createHook':typedi_1[_0x3cbdf0(0x22a)][_0x3cbdf0(0x223)](providers_tokens_1[_0x3cbdf0(0x1d3)][_0x3cbdf0(0x228)])['isBidirectionalSynchronization']}));if(this[_0x3cbdf0(0x228)]['isBidirectionalSynchronization']){const _0x55497d=await _0x4b1a20[_0x3cbdf0(0x20a)][_0x3cbdf0(0x1e4)]();!_0x55497d[_0x3cbdf0(0x1fd)](_0x53605c=>_0x53605c[_0x3cbdf0(0x23d)]===hooks_utils_1[_0x3cbdf0(0x249)][_0x3cbdf0(0x216)](this[_0x3cbdf0(0x228)][_0x3cbdf0(0x203)],this[_0x3cbdf0(0x228)][_0x3cbdf0(0x1e6)],_0x3a673b))&&(this['sfLogger']['log'](this[_0x3cbdf0(0x202)]+_0x3cbdf0(0x236)+_0x2e7866[_0x3cbdf0(0x24e)]+_0x3cbdf0(0x212)),await _0x4b1a20[_0x3cbdf0(0x20a)][_0x3cbdf0(0x1fc)](hooks_utils_1[_0x3cbdf0(0x249)][_0x3cbdf0(0x24a)](this[_0x3cbdf0(0x228)][_0x3cbdf0(0x203)],_0x4b1a20['hooks'],this['config'][_0x3cbdf0(0x1e6)],_0x3a673b)));}return this[_0x3cbdf0(0x221)][_0x3cbdf0(0x1de)](_0x4b1a20),_0x4b1a20;}async[a111_0x551041(0x22e)](){const _0x58cb84=a111_0x551041;this[_0x58cb84(0x234)]=typedi_1[_0x58cb84(0x22a)][_0x58cb84(0x223)](providers_tokens_1[_0x58cb84(0x1d3)][_0x58cb84(0x234)]),this[_0x58cb84(0x23c)]=typedi_1[_0x58cb84(0x22a)][_0x58cb84(0x223)](providers_tokens_1[_0x58cb84(0x1d3)][_0x58cb84(0x1d4)]),this['config']=typedi_1['Container'][_0x58cb84(0x223)](providers_tokens_1[_0x58cb84(0x1d3)][_0x58cb84(0x228)]),this['sfLogger']=typedi_1[_0x58cb84(0x22a)]['get'](providers_tokens_1[_0x58cb84(0x1d3)][_0x58cb84(0x1e0)]),this[_0x58cb84(0x202)]='['+SyncService_1[_0x58cb84(0x1d6)]+']\x20['+this[_0x58cb84(0x228)][_0x58cb84(0x203)]['toUpperCase']()+']',this['salesforceService']['setLoggerId'](this[_0x58cb84(0x232)]['getLoggerId']());try{this['sfLogger'][_0x58cb84(0x235)](this[_0x58cb84(0x202)]+_0x58cb84(0x20e)),await this[_0x58cb84(0x232)]['log'](this['prefix']+'\x20Getting\x20repository\x20records.')[_0x58cb84(0x205)]();const _0xfb7fdf=await this[_0x58cb84(0x208)][_0x58cb84(0x23b)](typedi_1[_0x58cb84(0x22a)]['get'](providers_tokens_1['Tokens']['connectionId']));if(!_0xfb7fdf[_0x58cb84(0x229)])throw new bad_request_error_1[(_0x58cb84(0x1f9))](this['prefix']+'\x20No\x20repositories\x20to\x20sync.');await this[_0x58cb84(0x232)]['log'](this['prefix']+_0x58cb84(0x237))['send']();const _0x359d58=await this[_0x58cb84(0x208)]['getBranchRecords'](_0xfb7fdf[_0x58cb84(0x204)](_0x9ca867=>'\x27'+_0x9ca867[_0x58cb84(0x22f)]+'\x27')[_0x58cb84(0x244)](','));await this['sfLogger'][_0x58cb84(0x235)](this[_0x58cb84(0x202)]+_0x58cb84(0x210))[_0x58cb84(0x205)](),this['repoList']=await this['repoService']['getAll']();const _0x6e987b=[..._0xfb7fdf,..._0x359d58];this[_0x58cb84(0x232)][_0x58cb84(0x235)](this[_0x58cb84(0x202)]+_0x58cb84(0x201)+_0x6e987b['length']+_0x58cb84(0x1d9));for(const _0x8ac867 of _0x6e987b){this['logger'][_0x58cb84(0x235)]('Syncing\x20'+_0x8ac867[_0x58cb84(0x24e)]+'['+_0x8ac867['repositoryId']+_0x58cb84(0x1f8)+_0x8ac867[_0x58cb84(0x226)]+'['+_0x8ac867[_0x58cb84(0x1d8)]+_0x58cb84(0x218)),this[_0x58cb84(0x232)]['log'](this[_0x58cb84(0x202)]+'\x20Syncing\x20repository:\x20\x22'+_0x8ac867['repositoryName']+_0x58cb84(0x1d7)+_0x8ac867[_0x58cb84(0x226)]+'\x22.'),this['sfLogger'][_0x58cb84(0x235)](this[_0x58cb84(0x202)]+_0x58cb84(0x21d));const _0x5bc1e3=await this[_0x58cb84(0x1ed)](_0x8ac867);if(!_0x5bc1e3)continue;this[_0x58cb84(0x232)]['log'](this[_0x58cb84(0x202)]+_0x58cb84(0x1f4));const _0x337a29=await this[_0x58cb84(0x220)](_0x8ac867);if(_0x337a29)continue;await this[_0x58cb84(0x232)][_0x58cb84(0x205)]();let _0x4b1aed;try{await this[_0x58cb84(0x232)][_0x58cb84(0x235)](this['prefix']+_0x58cb84(0x1db))[_0x58cb84(0x205)](),_0x4b1aed=await this['getOrCreateRepo'](_0x8ac867,typedi_1[_0x58cb84(0x22a)][_0x58cb84(0x223)](providers_tokens_1[_0x58cb84(0x1d3)][_0x58cb84(0x247)]));}catch(_0x5087bf){await this[_0x58cb84(0x1e9)](_0x8ac867,_0x5087bf instanceof too_many_requests_error_1['TooManyRequests']?_0x5087bf:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x5087bf));continue;}await this[_0x58cb84(0x232)][_0x58cb84(0x235)](this[_0x58cb84(0x202)]+_0x58cb84(0x233))[_0x58cb84(0x205)]();if(_0x8ac867['direction']===flosum_repository_sync_dto_1[_0x58cb84(0x242)][_0x58cb84(0x206)]){const _0x9fbe2a=typedi_1[_0x58cb84(0x22a)][_0x58cb84(0x223)](flosum_sync_job_1['FlosumSyncJob']);await _0x9fbe2a['run']({'repository':_0x4b1aed,'convertToSFDX':this[_0x58cb84(0x228)]['isConvertToSfdx'],'syncRecord':_0x8ac867,'provider':this[_0x58cb84(0x228)][_0x58cb84(0x203)]})[_0x58cb84(0x1fb)](_0x3fc86c=>this['handleRecordSyncError'](_0x8ac867,_0x3fc86c));}else{const _0x3bde53=typedi_1['Container']['get'](git_sync_job_1[_0x58cb84(0x222)]);await _0x3bde53[_0x58cb84(0x22e)]({'repository':_0x4b1aed,'branch':_0x8ac867['branchName'],'provider':this[_0x58cb84(0x228)]['gitProvider'],'repositoryGit':_0x4b1aed[_0x58cb84(0x224)],'syncRecord':_0x8ac867})['catch'](_0x202fc7=>this[_0x58cb84(0x1e9)](_0x8ac867,_0x202fc7));}}}catch(_0x134eb2){this[_0x58cb84(0x1e0)][_0x58cb84(0x240)](_0x134eb2);_0x134eb2 instanceof too_many_requests_error_1[_0x58cb84(0x241)]?(await this[_0x58cb84(0x232)]['log'](this[_0x58cb84(0x202)]+_0x58cb84(0x239))[_0x58cb84(0x205)](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0x58cb84(0x22e)]()):await this['sfLogger']['error'](this[_0x58cb84(0x202)]+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x134eb2)[_0x58cb84(0x205)]();return;}await this['sfLogger'][_0x58cb84(0x235)](this[_0x58cb84(0x202)]+_0x58cb84(0x219))[_0x58cb84(0x205)](),await this[_0x58cb84(0x208)][_0x58cb84(0x225)](typedi_1[_0x58cb84(0x22a)][_0x58cb84(0x223)](providers_tokens_1[_0x58cb84(0x1d3)][_0x58cb84(0x247)]))['catch'](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x551041(0x1f5)])({'transient':!![]}),__metadata(a111_0x551041(0x209),[salesforce_service_1[a111_0x551041(0x21f)],salesforce_sync_service_1[a111_0x551041(0x23e)]])],SyncService),exports[a111_0x551041(0x1ef)]=SyncService;function a111_0x21e1(){const _0x1f616c=['SalesforceService','isIntersects','repoList','GitSyncJob','get','gitUrl','disableSync','branchName','../../salesforce/dto/flosum-repository-sync.dto','config','length','Container','updateRemoteState','(((.+)+)+)+$','128LMxHSF','run','repositoryId','\x20Stop\x20sync\x20job\x20for\x20\x27','SalesforceError','sfLogger','\x20Completed\x20prepare\x20to\x20syncing.','gitApiService','log','\x20Repository\x20\x22','\x20Getting\x20branch\x20records.','20uSIwnC','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','__esModule','getRepositoryRecords','repoService','url','SalesforceSyncService','340668ZhbDwt','error','TooManyRequests','SyncDirection','toLowerCase','join','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','../../salesforce/services/salesforce.service','connectionId','86820aLWsvI','HooksUtils','createHookPayload','../../providers/web-hooks/hooks.utils','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','1637328oPkVin','repositoryName','../../../../core','Tokens','gitRepoService','BRANCH_NAME_REGEXP','name','\x22\x20branch:\x20\x22','branchId','\x20branches.','\x27\x20-\x20\x27','\x20Getting\x20Flosum\x20repository','Logger','7901hWiHhb','push','87aNUNFb','logger','../../../shared/utils','REPOSITORY_NAME_REGEXP','../../../../core/errors/too-many-requests.error','getAll','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','applicationUrl','2202455FBOBkT','test','handleRecordSyncError','Unable\x20to\x20synchronize\x20repository\x20\x27','Error','salesforceService','checkValidNaming','constructor','SyncService','Waiting','typedi','object','function','\x20Checking\x20intersects.','Service','toString','decorate',']\x20repository\x20','BadRequestError','\x27\x20[','catch','create','find','getOrCreateRepo','__decorate','../jobs/flosum-sync.job','\x20Have\x20to\x20synchronize\x20','prefix','gitProvider','map','send','FlosumToGit','769582vCUVIm','salesforceSync','design:paramtypes','hooks','134pWpsqr','metadata','repositoriesIntersections','\x20Start\x20sync\x20job.','../jobs/git-sync.job','\x20Getting\x20repositories\x20from\x20git\x20service.','search','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','../errors/git-branch-not-found.error','26xxAJqW','18ITwqJB','getHookLinkFor','Unable\x20to\x20synchronize\x20branch\x20\x27',']\x20branch.','\x20Sync\x20job\x20done.','setStatus','2194476TkbHQm','GitBranchNotFoundError','\x20Checking\x20valid\x20name.','../../salesforce/errors/salesforce.error'];a111_0x21e1=function(){return _0x1f616c;};return a111_0x21e1();}