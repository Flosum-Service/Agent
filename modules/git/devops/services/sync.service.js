const a110_0x3554c6=a110_0x6e3a;(function(_0x2f0449,_0x5bbe6e){const _0x2b17a4=a110_0x6e3a,_0x9e4737=_0x2f0449();while(!![]){try{const _0x4049f0=-parseInt(_0x2b17a4(0x22d))/0x1+parseInt(_0x2b17a4(0x20a))/0x2+parseInt(_0x2b17a4(0x249))/0x3+-parseInt(_0x2b17a4(0x1fb))/0x4+parseInt(_0x2b17a4(0x230))/0x5+-parseInt(_0x2b17a4(0x22a))/0x6*(-parseInt(_0x2b17a4(0x233))/0x7)+parseInt(_0x2b17a4(0x225))/0x8*(-parseInt(_0x2b17a4(0x252))/0x9);if(_0x4049f0===_0x5bbe6e)break;else _0x9e4737['push'](_0x9e4737['shift']());}catch(_0x219700){_0x9e4737['push'](_0x9e4737['shift']());}}}(a110_0x3e0e,0x2b97e));const a110_0x353e17=(function(){let _0x3352c1=!![];return function(_0xd307a9,_0x33f288){const _0x1a27b0=_0x3352c1?function(){const _0x10321c=a110_0x6e3a;if(_0x33f288){const _0x55a1fb=_0x33f288[_0x10321c(0x23b)](_0xd307a9,arguments);return _0x33f288=null,_0x55a1fb;}}:function(){};return _0x3352c1=![],_0x1a27b0;};}()),a110_0x1e3209=a110_0x353e17(this,function(){const _0x24023d=a110_0x6e3a;return a110_0x1e3209[_0x24023d(0x231)]()['search'](_0x24023d(0x24a))[_0x24023d(0x231)]()['constructor'](a110_0x1e3209)['search'](_0x24023d(0x24a));});a110_0x1e3209();function a110_0x6e3a(_0x561974,_0xef0253){const _0x38d520=a110_0x3e0e();return a110_0x6e3a=function(_0x1e3209,_0x353e17){_0x1e3209=_0x1e3209-0x1df;let _0x3e0e81=_0x38d520[_0x1e3209];return _0x3e0e81;},a110_0x6e3a(_0x561974,_0xef0253);}'use strict';var __decorate=this&&this[a110_0x3554c6(0x20b)]||function(_0x21db76,_0x2d3636,_0x57e9b9,_0x16a483){const _0x5c7aea=a110_0x3554c6;var _0x9474e7=arguments[_0x5c7aea(0x202)],_0x3b5f29=_0x9474e7<0x3?_0x2d3636:_0x16a483===null?_0x16a483=Object[_0x5c7aea(0x201)](_0x2d3636,_0x57e9b9):_0x16a483,_0x165e72;if(typeof Reflect===_0x5c7aea(0x205)&&typeof Reflect[_0x5c7aea(0x20c)]===_0x5c7aea(0x21e))_0x3b5f29=Reflect[_0x5c7aea(0x20c)](_0x21db76,_0x2d3636,_0x57e9b9,_0x16a483);else{for(var _0x554dee=_0x21db76['length']-0x1;_0x554dee>=0x0;_0x554dee--)if(_0x165e72=_0x21db76[_0x554dee])_0x3b5f29=(_0x9474e7<0x3?_0x165e72(_0x3b5f29):_0x9474e7>0x3?_0x165e72(_0x2d3636,_0x57e9b9,_0x3b5f29):_0x165e72(_0x2d3636,_0x57e9b9))||_0x3b5f29;}return _0x9474e7>0x3&&_0x3b5f29&&Object[_0x5c7aea(0x22e)](_0x2d3636,_0x57e9b9,_0x3b5f29),_0x3b5f29;},__metadata=this&&this[a110_0x3554c6(0x1ea)]||function(_0x4dad89,_0x5f3afb){const _0x3590a4=a110_0x3554c6;if(typeof Reflect===_0x3590a4(0x205)&&typeof Reflect[_0x3590a4(0x239)]===_0x3590a4(0x21e))return Reflect[_0x3590a4(0x239)](_0x4dad89,_0x5f3afb);},SyncService_1;function a110_0x3e0e(){const _0x36f157=[']\x20due\x20error\x20-\x20','FlosumToGit','BadRequestError','prefix','run','\x20No\x20repositories\x20to\x20sync.','\x27\x20-\x20\x27','234417wTJUwM','(((.+)+)+)+$','Waiting','SyncService','repositoriesIntersections','repositoryName','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','setLoggerId','\x20Start\x20sync\x20job.','45wwGLMj','repositoryId','../errors/git-branch-not-found.error','\x20Getting\x20Flosum\x20repository','map','design:paramtypes','gitApiService','GitBranchNotFoundError','\x20Sync\x20job\x20done.','typedi','toLowerCase','getLoggerId','log','sleep','logger','getRepositoryRecords','__metadata','\x20Getting\x20repository\x20records.','connectionId','sfLogger','\x20branches.','url','getOrCreateRepo','../jobs/git-sync.job','updateRemoteState','gitRepoService','checkValidNaming','\x20Completed\x20prepare\x20to\x20syncing.','test','../../salesforce/errors/salesforce.error','getAll','Tokens','config','152236FzZnsc','Unable\x20to\x20synchronize\x20repository\x20\x27','handleRecordSyncError','\x20Stop\x20sync\x20job\x20for\x20\x27','\x20Getting\x20branch\x20records.','branchId','getOwnPropertyDescriptor','length','\x20Checking\x20valid\x20name.','get','object','salesforceSync','Service','setStatus','createHookPayload','242032BFEPDc','__decorate','decorate','TooManyRequests','\x27\x20[','FlosumSyncJob','../../../../core/errors/too-many-requests.error','BRANCH_NAME_REGEXP','\x20Syncing\x20repository:\x20\x22','repoService','create','catch','find','../../salesforce/services/salesforce.service',']\x20[','salesforceService','\x27\x20in\x20repository\x20\x27','branchName','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','hooks','function','../../salesforce/dto/flosum-repository-sync.dto','REPOSITORY_NAME_REGEXP','GitSyncJob','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','repoList','Container','633712JHnxYl','direction','../../../../core','Logger','Error','318VHhbFK','../../../../core/errors/bad-request.error','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','191823fJTtTZ','defineProperty','gitProvider','1261080yuLOer','toString','disableSync','46641lkBtzA','HooksUtils','SalesforceService','error','applicationUrl','isConvertToSfdx','metadata','name','apply','SalesforceSyncService','../jobs/flosum-sync.job','send','../../providers/providers.tokens',']\x20branch.','\x20Have\x20to\x20synchronize\x20'];a110_0x3e0e=function(){return _0x36f157;};return a110_0x3e0e();}Object[a110_0x3554c6(0x22e)](exports,'__esModule',{'value':!![]}),exports[a110_0x3554c6(0x24c)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a110_0x3554c6(0x227)),too_many_requests_error_1=require(a110_0x3554c6(0x210)),flosum_repository_sync_dto_1=require(a110_0x3554c6(0x21f)),salesforce_error_1=require(a110_0x3554c6(0x1f7)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a110_0x3554c6(0x217)),utils_1=require('../../../shared/utils'),typedi_1=require(a110_0x3554c6(0x1e3)),hooks_utils_1=require('../../providers/web-hooks/hooks.utils'),git_branch_not_found_error_1=require(a110_0x3554c6(0x254)),flosum_sync_job_1=require(a110_0x3554c6(0x23d)),git_sync_job_1=require(a110_0x3554c6(0x1f1)),providers_tokens_1=require(a110_0x3554c6(0x23f)),bad_request_error_1=require(a110_0x3554c6(0x22b));let SyncService=SyncService_1=class SyncService{constructor(_0x50ed06,_0x20992e){const _0xd34487=a110_0x3554c6;this[_0xd34487(0x219)]=_0x50ed06,this[_0xd34487(0x206)]=_0x20992e,this['logger']=new core_1[(_0xd34487(0x228))](SyncService_1[_0xd34487(0x23a)]),this[_0xd34487(0x24d)]={},this[_0xd34487(0x223)]=[];}async['handleRecordSyncError'](_0x2f7d75,_0x46414d){const _0x233dd9=a110_0x3554c6;if(_0x46414d instanceof git_branch_not_found_error_1[_0x233dd9(0x1e1)]){await this[_0x233dd9(0x206)][_0x233dd9(0x208)](_0x2f7d75,'Not\x20Synchronized');return;}if(_0x46414d instanceof too_many_requests_error_1[_0x233dd9(0x20d)]){await this[_0x233dd9(0x206)][_0x233dd9(0x208)](_0x2f7d75,_0x233dd9(0x24b));throw _0x46414d;}try{await this[_0x233dd9(0x1ed)][_0x233dd9(0x236)](this[_0x233dd9(0x245)]+_0x233dd9(0x1fe)+_0x2f7d75['repositoryName']+_0x233dd9(0x20e)+_0x2f7d75['branchName']+_0x233dd9(0x242)+_0x46414d+'.')[_0x233dd9(0x23e)](),await this[_0x233dd9(0x206)][_0x233dd9(0x1f2)](_0x2f7d75,{}),await this[_0x233dd9(0x206)][_0x233dd9(0x208)](_0x2f7d75,_0x233dd9(0x229));}catch(_0x1dd1ed){if(_0x1dd1ed instanceof salesforce_error_1['SalesforceError'])throw _0x1dd1ed;}}async['isIntersects'](_0x6ac17f){const _0x7e2f=a110_0x3554c6;if(_0x6ac17f[_0x7e2f(0x253)]){const _0x3f9d2e=_0x6ac17f['repositoryName'][_0x7e2f(0x1e4)](),_0x536f31=this[_0x7e2f(0x24d)][_0x3f9d2e];if(!_0x536f31)this[_0x7e2f(0x24d)][_0x3f9d2e]=_0x6ac17f[_0x7e2f(0x24e)];else{if(_0x536f31&&_0x536f31!==_0x6ac17f[_0x7e2f(0x24e)])return await this[_0x7e2f(0x1fd)](_0x6ac17f,new Error(_0x7e2f(0x1fc)+_0x6ac17f[_0x7e2f(0x24e)]+_0x7e2f(0x22c)+_0x3f9d2e+_0x7e2f(0x248)+_0x536f31+'\x27')),!![];}}return![];}async[a110_0x3554c6(0x1f4)](_0x2b41c3){const _0xd3121f=a110_0x3554c6;if(!constants_1[_0xd3121f(0x220)]['test'](_0x2b41c3['repositoryName']))return await this[_0xd3121f(0x1fd)](_0x2b41c3,new Error(_0xd3121f(0x1fc)+_0x2b41c3[_0xd3121f(0x24e)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0xd3121f(0x211)][_0xd3121f(0x1f6)](_0x2b41c3[_0xd3121f(0x21b)]))return await this[_0xd3121f(0x1fd)](_0x2b41c3,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x2b41c3[_0xd3121f(0x21b)]+_0xd3121f(0x21a)+_0x2b41c3[_0xd3121f(0x24e)]+_0xd3121f(0x24f))),![];return!![];}async[a110_0x3554c6(0x1f0)](_0xfa8c6c,_0x5591cc){const _0x54af06=a110_0x3554c6;let _0x600f9b=this[_0x54af06(0x223)][_0x54af06(0x216)](_0x47a247=>_0xfa8c6c[_0x54af06(0x24e)]===_0x47a247[_0x54af06(0x23a)]);!_0x600f9b&&(this[_0x54af06(0x1ed)]['log'](this[_0x54af06(0x245)]+'\x20Repository\x20\x22'+_0xfa8c6c['repositoryName']+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x600f9b=await this[_0x54af06(0x213)][_0x54af06(0x214)]({'name':_0xfa8c6c[_0x54af06(0x24e)],'autoInit':!![],'defaultBranch':_0xfa8c6c[_0x54af06(0x21b)],'private':!![],'createHook':typedi_1[_0x54af06(0x224)]['get'](providers_tokens_1[_0x54af06(0x1f9)][_0x54af06(0x1fa)])['isBidirectionalSynchronization']}));if(this[_0x54af06(0x1fa)]['isBidirectionalSynchronization']){const _0x5b9b32=await _0x600f9b[_0x54af06(0x21d)][_0x54af06(0x1f8)]();!_0x5b9b32[_0x54af06(0x216)](_0x1c7762=>_0x1c7762[_0x54af06(0x1ef)]===hooks_utils_1[_0x54af06(0x234)]['getHookLinkFor'](this[_0x54af06(0x1fa)][_0x54af06(0x22f)],this['config'][_0x54af06(0x237)],_0x5591cc))&&(this[_0x54af06(0x1ed)][_0x54af06(0x1e6)](this[_0x54af06(0x245)]+'\x20Repository\x20\x22'+_0xfa8c6c[_0x54af06(0x24e)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x600f9b[_0x54af06(0x21d)]['create'](hooks_utils_1[_0x54af06(0x234)][_0x54af06(0x209)](this['config']['gitProvider'],_0x600f9b[_0x54af06(0x21d)],this[_0x54af06(0x1fa)][_0x54af06(0x237)],_0x5591cc)));}return this[_0x54af06(0x223)]['push'](_0x600f9b),_0x600f9b;}async[a110_0x3554c6(0x246)](){const _0xac3dba=a110_0x3554c6;this[_0xac3dba(0x1e0)]=typedi_1['Container'][_0xac3dba(0x204)](providers_tokens_1[_0xac3dba(0x1f9)][_0xac3dba(0x1e0)]),this[_0xac3dba(0x213)]=typedi_1[_0xac3dba(0x224)][_0xac3dba(0x204)](providers_tokens_1['Tokens'][_0xac3dba(0x1f3)]),this['config']=typedi_1[_0xac3dba(0x224)][_0xac3dba(0x204)](providers_tokens_1[_0xac3dba(0x1f9)]['config']),this[_0xac3dba(0x1ed)]=typedi_1[_0xac3dba(0x224)][_0xac3dba(0x204)](providers_tokens_1['Tokens'][_0xac3dba(0x1e8)]),this[_0xac3dba(0x245)]='['+SyncService_1[_0xac3dba(0x23a)]+_0xac3dba(0x218)+this[_0xac3dba(0x1fa)][_0xac3dba(0x22f)]['toUpperCase']()+']',this[_0xac3dba(0x219)][_0xac3dba(0x250)](this[_0xac3dba(0x1ed)][_0xac3dba(0x1e5)]());try{this[_0xac3dba(0x1ed)][_0xac3dba(0x1e6)](this[_0xac3dba(0x245)]+_0xac3dba(0x251)),await this[_0xac3dba(0x1ed)]['log'](this[_0xac3dba(0x245)]+_0xac3dba(0x1eb))[_0xac3dba(0x23e)]();const _0x4975da=await this[_0xac3dba(0x206)][_0xac3dba(0x1e9)](typedi_1[_0xac3dba(0x224)][_0xac3dba(0x204)](providers_tokens_1[_0xac3dba(0x1f9)][_0xac3dba(0x1ec)]));if(!_0x4975da[_0xac3dba(0x202)])throw new bad_request_error_1[(_0xac3dba(0x244))](this[_0xac3dba(0x245)]+_0xac3dba(0x247));await this[_0xac3dba(0x1ed)]['log'](this[_0xac3dba(0x245)]+_0xac3dba(0x1ff))[_0xac3dba(0x23e)]();const _0x52b405=await this['salesforceSync']['getBranchRecords'](_0x4975da[_0xac3dba(0x256)](_0x1fb97e=>'\x27'+_0x1fb97e[_0xac3dba(0x253)]+'\x27')['join'](','));await this[_0xac3dba(0x1ed)]['log'](this[_0xac3dba(0x245)]+'\x20Getting\x20repositories\x20from\x20git\x20service.')['send'](),this['repoList']=await this[_0xac3dba(0x213)]['getAll']();const _0x3c080e=[..._0x4975da,..._0x52b405];this[_0xac3dba(0x1ed)][_0xac3dba(0x1e6)](this[_0xac3dba(0x245)]+_0xac3dba(0x241)+_0x3c080e['length']+_0xac3dba(0x1ee));for(const _0x41e994 of _0x3c080e){this['logger'][_0xac3dba(0x1e6)]('Syncing\x20'+_0x41e994[_0xac3dba(0x24e)]+'['+_0x41e994[_0xac3dba(0x253)]+']\x20repository\x20'+_0x41e994[_0xac3dba(0x21b)]+'['+_0x41e994[_0xac3dba(0x200)]+_0xac3dba(0x240)),this[_0xac3dba(0x1ed)][_0xac3dba(0x1e6)](this[_0xac3dba(0x245)]+_0xac3dba(0x212)+_0x41e994[_0xac3dba(0x24e)]+'\x22\x20branch:\x20\x22'+_0x41e994['branchName']+'\x22.'),this[_0xac3dba(0x1ed)][_0xac3dba(0x1e6)](this['prefix']+_0xac3dba(0x203));const _0x341269=await this[_0xac3dba(0x1f4)](_0x41e994);if(!_0x341269)continue;this['sfLogger']['log'](this['prefix']+'\x20Checking\x20intersects.');const _0x49c1da=await this['isIntersects'](_0x41e994);if(_0x49c1da)continue;await this[_0xac3dba(0x1ed)][_0xac3dba(0x23e)]();let _0x4c1cd8;try{await this[_0xac3dba(0x1ed)][_0xac3dba(0x1e6)](this[_0xac3dba(0x245)]+_0xac3dba(0x255))['send'](),_0x4c1cd8=await this[_0xac3dba(0x1f0)](_0x41e994,typedi_1[_0xac3dba(0x224)][_0xac3dba(0x204)](providers_tokens_1[_0xac3dba(0x1f9)][_0xac3dba(0x1ec)]));}catch(_0x15d69d){await this[_0xac3dba(0x1fd)](_0x41e994,_0x15d69d instanceof too_many_requests_error_1['TooManyRequests']?_0x15d69d:new Error(_0xac3dba(0x21c)+_0x15d69d));continue;}await this['sfLogger']['log'](this[_0xac3dba(0x245)]+_0xac3dba(0x1f5))[_0xac3dba(0x23e)]();if(_0x41e994[_0xac3dba(0x226)]===flosum_repository_sync_dto_1['SyncDirection'][_0xac3dba(0x243)]){const _0x1dd21f=typedi_1['Container'][_0xac3dba(0x204)](flosum_sync_job_1[_0xac3dba(0x20f)]);await _0x1dd21f[_0xac3dba(0x246)]({'repository':_0x4c1cd8,'convertToSFDX':this[_0xac3dba(0x1fa)][_0xac3dba(0x238)],'syncRecord':_0x41e994,'provider':this[_0xac3dba(0x1fa)][_0xac3dba(0x22f)]})['catch'](_0x4976d5=>this['handleRecordSyncError'](_0x41e994,_0x4976d5));}else{const _0x42f77a=typedi_1[_0xac3dba(0x224)][_0xac3dba(0x204)](git_sync_job_1[_0xac3dba(0x221)]);await _0x42f77a[_0xac3dba(0x246)]({'repository':_0x4c1cd8,'branch':_0x41e994[_0xac3dba(0x21b)],'provider':this[_0xac3dba(0x1fa)][_0xac3dba(0x22f)],'repositoryGit':_0x4c1cd8['gitUrl'],'syncRecord':_0x41e994})[_0xac3dba(0x215)](_0x5bc43b=>this[_0xac3dba(0x1fd)](_0x41e994,_0x5bc43b));}}}catch(_0x58b716){this['logger'][_0xac3dba(0x236)](_0x58b716);_0x58b716 instanceof too_many_requests_error_1[_0xac3dba(0x20d)]?(await this[_0xac3dba(0x1ed)][_0xac3dba(0x1e6)](this[_0xac3dba(0x245)]+'\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.')[_0xac3dba(0x23e)](),await(0x0,utils_1[_0xac3dba(0x1e7)])(0x3c*0x3c*0x3e8),this[_0xac3dba(0x246)]()):await this['sfLogger']['error'](this['prefix']+_0xac3dba(0x222)+_0x58b716)['send']();return;}await this[_0xac3dba(0x1ed)][_0xac3dba(0x1e6)](this[_0xac3dba(0x245)]+_0xac3dba(0x1e2))['send'](),await this[_0xac3dba(0x206)][_0xac3dba(0x232)](typedi_1[_0xac3dba(0x224)]['get'](providers_tokens_1[_0xac3dba(0x1f9)][_0xac3dba(0x1ec)]))[_0xac3dba(0x215)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a110_0x3554c6(0x207)])({'transient':!![]}),__metadata(a110_0x3554c6(0x1df),[salesforce_service_1[a110_0x3554c6(0x235)],salesforce_sync_service_1[a110_0x3554c6(0x23c)]])],SyncService),exports[a110_0x3554c6(0x24c)]=SyncService;