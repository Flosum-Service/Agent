const a80_0x592d78=a80_0x3b89;function a80_0x3b89(_0x3aecbc,_0x237dc1){const _0x17ca6f=a80_0x55b4();return a80_0x3b89=function(_0x2880f6,_0xbb55a3){_0x2880f6=_0x2880f6-0x17c;let _0x55b41a=_0x17ca6f[_0x2880f6];return _0x55b41a;},a80_0x3b89(_0x3aecbc,_0x237dc1);}function a80_0x55b4(){const _0x36ce58=['../../providers/providers.tokens','HooksUtils','(((.+)+)+)+$','toString','10497084bGFlmR','join','connectionId','config','../jobs/git-sync.job','../../salesforce/dto/flosum-repository-sync.dto','17624pIOyoV','toLowerCase','SalesforceService','applicationUrl','apply','1504530KAQifR','gitApiService','SyncService','\x27\x20in\x20repository\x20\x27','getHookLinkFor','\x20Getting\x20Flosum\x20repository','metadata','catch','../errors/git-branch-not-found.error','run','getLoggerId','disableSync','updateRemoteState','Not\x20Synchronized','SalesforceError','REPOSITORY_NAME_REGEXP','7263135WwLsgZ','repositoryName','../../providers/web-hooks/hooks.utils','get','error','__decorate','salesforceService','\x27\x20[','../jobs/flosum-sync.job','repoList','\x20Getting\x20repositories\x20from\x20git\x20service.','setLoggerId','test','handleRecordSyncError','\x20Start\x20sync\x20job.','Service','\x20branches.','send','\x20Repository\x20\x22','2uHwRTk','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20',']\x20[','getRepositoryRecords','BRANCH_NAME_REGEXP','1652597KtfxAP','getOrCreateRepo','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','\x20Checking\x20valid\x20name.','object','\x27\x20-\x20\x27','__metadata','name','FlosumSyncJob','\x20Getting\x20branch\x20records.','../../../../core/errors/bad-request.error','\x20Completed\x20prepare\x20to\x20syncing.','find','SyncDirection','url','hooks','decorate','GitBranchNotFoundError','Logger','log','function','1660MXBdQP','19033003sxibFQ','sfLogger','create','gitProvider','TooManyRequests','Error','branchId','map','12968iUwXYO','repositoriesIntersections',']\x20branch.','repoService','getAll','Waiting','design:paramtypes','typedi','../../../../constants','../../../../core','Unable\x20to\x20synchronize\x20branch\x20\x27','\x20Syncing\x20repository:\x20\x22','search',']\x20repository\x20','prefix','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','Container','3143PFeCrB','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.',']\x20due\x20error\x20-\x20','getOwnPropertyDescriptor','setStatus','repositoryId','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','isIntersects','push','\x22\x20branch:\x20\x22','Tokens','length','branchName','Syncing\x20','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','logger','10HmQOsP','defineProperty','../../salesforce/errors/salesforce.error','sleep','salesforceSync','checkValidNaming','createHookPayload','toUpperCase'];a80_0x55b4=function(){return _0x36ce58;};return a80_0x55b4();}(function(_0x362010,_0x339bfd){const _0x279399=a80_0x3b89,_0x4c1c02=_0x362010();while(!![]){try{const _0x2a98d5=parseInt(_0x279399(0x1bb))/0x1*(parseInt(_0x279399(0x1b6))/0x2)+parseInt(_0x279399(0x193))/0x3+parseInt(_0x279399(0x1d9))/0x4*(-parseInt(_0x279399(0x1d0))/0x5)+-parseInt(_0x279399(0x188))/0x6+-parseInt(_0x279399(0x1ea))/0x7*(parseInt(_0x279399(0x18e))/0x8)+parseInt(_0x279399(0x1a3))/0x9+-parseInt(_0x279399(0x17c))/0xa*(-parseInt(_0x279399(0x1d1))/0xb);if(_0x2a98d5===_0x339bfd)break;else _0x4c1c02['push'](_0x4c1c02['shift']());}catch(_0x20c27a){_0x4c1c02['push'](_0x4c1c02['shift']());}}}(a80_0x55b4,0xd5f66));const a80_0xbb55a3=(function(){let _0x53319e=!![];return function(_0x802f46,_0x1aa0a3){const _0x283bca=_0x53319e?function(){const _0x142e38=a80_0x3b89;if(_0x1aa0a3){const _0x5c7383=_0x1aa0a3[_0x142e38(0x192)](_0x802f46,arguments);return _0x1aa0a3=null,_0x5c7383;}}:function(){};return _0x53319e=![],_0x283bca;};}()),a80_0x2880f6=a80_0xbb55a3(this,function(){const _0x40233e=a80_0x3b89;return a80_0x2880f6[_0x40233e(0x187)]()['search'](_0x40233e(0x186))[_0x40233e(0x187)]()['constructor'](a80_0x2880f6)[_0x40233e(0x1e5)](_0x40233e(0x186));});a80_0x2880f6();'use strict';var __decorate=this&&this[a80_0x592d78(0x1a8)]||function(_0x3da198,_0x2a0bd4,_0x162126,_0x15b668){const _0x263123=a80_0x592d78;var _0x331344=arguments['length'],_0x39a5ac=_0x331344<0x3?_0x2a0bd4:_0x15b668===null?_0x15b668=Object[_0x263123(0x1ed)](_0x2a0bd4,_0x162126):_0x15b668,_0x518427;if(typeof Reflect===_0x263123(0x1bf)&&typeof Reflect[_0x263123(0x1cb)]===_0x263123(0x1cf))_0x39a5ac=Reflect[_0x263123(0x1cb)](_0x3da198,_0x2a0bd4,_0x162126,_0x15b668);else{for(var _0x54ed64=_0x3da198['length']-0x1;_0x54ed64>=0x0;_0x54ed64--)if(_0x518427=_0x3da198[_0x54ed64])_0x39a5ac=(_0x331344<0x3?_0x518427(_0x39a5ac):_0x331344>0x3?_0x518427(_0x2a0bd4,_0x162126,_0x39a5ac):_0x518427(_0x2a0bd4,_0x162126))||_0x39a5ac;}return _0x331344>0x3&&_0x39a5ac&&Object[_0x263123(0x17d)](_0x2a0bd4,_0x162126,_0x39a5ac),_0x39a5ac;},__metadata=this&&this[a80_0x592d78(0x1c1)]||function(_0x107a8c,_0x5ce644){const _0x7aef2b=a80_0x592d78;if(typeof Reflect===_0x7aef2b(0x1bf)&&typeof Reflect[_0x7aef2b(0x199)]===_0x7aef2b(0x1cf))return Reflect[_0x7aef2b(0x199)](_0x107a8c,_0x5ce644);},SyncService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a80_0x592d78(0x195)]=void 0x0;const constants_1=require(a80_0x592d78(0x1e1)),core_1=require(a80_0x592d78(0x1e2)),too_many_requests_error_1=require('../../../../core/errors/too-many-requests.error'),flosum_repository_sync_dto_1=require(a80_0x592d78(0x18d)),salesforce_error_1=require(a80_0x592d78(0x17e)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require('../../salesforce/services/salesforce.service'),utils_1=require('../../../shared/utils'),typedi_1=require(a80_0x592d78(0x1e0)),hooks_utils_1=require(a80_0x592d78(0x1a5)),git_branch_not_found_error_1=require(a80_0x592d78(0x19b)),flosum_sync_job_1=require(a80_0x592d78(0x1ab)),git_sync_job_1=require(a80_0x592d78(0x18c)),providers_tokens_1=require(a80_0x592d78(0x184)),bad_request_error_1=require(a80_0x592d78(0x1c5));let SyncService=SyncService_1=class SyncService{constructor(_0x19bf1a,_0x2801d){const _0x39dcc9=a80_0x592d78;this[_0x39dcc9(0x1a9)]=_0x19bf1a,this[_0x39dcc9(0x180)]=_0x2801d,this[_0x39dcc9(0x1f9)]=new core_1[(_0x39dcc9(0x1cd))](SyncService_1[_0x39dcc9(0x1c2)]),this[_0x39dcc9(0x1da)]={},this['repoList']=[];}async['handleRecordSyncError'](_0x359088,_0x1d2cec){const _0x3f7823=a80_0x592d78;if(_0x1d2cec instanceof git_branch_not_found_error_1[_0x3f7823(0x1cc)]){await this[_0x3f7823(0x180)][_0x3f7823(0x1ee)](_0x359088,_0x3f7823(0x1a0));return;}if(_0x1d2cec instanceof too_many_requests_error_1[_0x3f7823(0x1d5)]){await this[_0x3f7823(0x180)][_0x3f7823(0x1ee)](_0x359088,_0x3f7823(0x1de));throw _0x1d2cec;}try{await this[_0x3f7823(0x1d2)][_0x3f7823(0x1a7)](this[_0x3f7823(0x1e7)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x359088[_0x3f7823(0x1a4)]+_0x3f7823(0x1aa)+_0x359088[_0x3f7823(0x1f6)]+_0x3f7823(0x1ec)+_0x1d2cec+'.')[_0x3f7823(0x1b4)](),await this[_0x3f7823(0x180)][_0x3f7823(0x19f)](_0x359088,{}),await this[_0x3f7823(0x180)][_0x3f7823(0x1ee)](_0x359088,_0x3f7823(0x1d6));}catch(_0x41bc20){if(_0x41bc20 instanceof salesforce_error_1[_0x3f7823(0x1a1)])throw _0x41bc20;}}async[a80_0x592d78(0x1f1)](_0x240e6f){const _0x51edb3=a80_0x592d78;if(_0x240e6f[_0x51edb3(0x1ef)]){const _0x1c80d2=_0x240e6f[_0x51edb3(0x1a4)][_0x51edb3(0x18f)](),_0xa67279=this[_0x51edb3(0x1da)][_0x1c80d2];if(!_0xa67279)this['repositoriesIntersections'][_0x1c80d2]=_0x240e6f['repositoryName'];else{if(_0xa67279&&_0xa67279!==_0x240e6f[_0x51edb3(0x1a4)])return await this[_0x51edb3(0x1b0)](_0x240e6f,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x240e6f[_0x51edb3(0x1a4)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x1c80d2+_0x51edb3(0x1c0)+_0xa67279+'\x27')),!![];}}return![];}async[a80_0x592d78(0x181)](_0x3b9e48){const _0x196376=a80_0x592d78;if(!constants_1[_0x196376(0x1a2)][_0x196376(0x1af)](_0x3b9e48[_0x196376(0x1a4)]))return await this[_0x196376(0x1b0)](_0x3b9e48,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x3b9e48['repositoryName']+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x196376(0x1ba)][_0x196376(0x1af)](_0x3b9e48[_0x196376(0x1f6)]))return await this[_0x196376(0x1b0)](_0x3b9e48,new Error(_0x196376(0x1e3)+_0x3b9e48[_0x196376(0x1f6)]+_0x196376(0x196)+_0x3b9e48[_0x196376(0x1a4)]+_0x196376(0x1f0))),![];return!![];}async[a80_0x592d78(0x1bc)](_0x1459d7,_0x5b0250){const _0x4ed468=a80_0x592d78;let _0x545b2b=this[_0x4ed468(0x1ac)][_0x4ed468(0x1c7)](_0x1050ed=>_0x1459d7[_0x4ed468(0x1a4)]===_0x1050ed[_0x4ed468(0x1c2)]);!_0x545b2b&&(this['sfLogger']['log'](this[_0x4ed468(0x1e7)]+_0x4ed468(0x1b5)+_0x1459d7['repositoryName']+_0x4ed468(0x1bd)),_0x545b2b=await this[_0x4ed468(0x1dc)][_0x4ed468(0x1d3)]({'name':_0x1459d7[_0x4ed468(0x1a4)],'autoInit':!![],'defaultBranch':_0x1459d7[_0x4ed468(0x1f6)],'private':!![],'createHook':typedi_1[_0x4ed468(0x1e9)][_0x4ed468(0x1a6)](providers_tokens_1[_0x4ed468(0x1f4)][_0x4ed468(0x18b)])['isBidirectionalSynchronization']}));if(this[_0x4ed468(0x18b)]['isBidirectionalSynchronization']){const _0x595f55=await _0x545b2b[_0x4ed468(0x1ca)][_0x4ed468(0x1dd)]();!_0x595f55[_0x4ed468(0x1c7)](_0x1e5f82=>_0x1e5f82[_0x4ed468(0x1c9)]===hooks_utils_1['HooksUtils'][_0x4ed468(0x197)](this[_0x4ed468(0x18b)][_0x4ed468(0x1d4)],this[_0x4ed468(0x18b)][_0x4ed468(0x191)],_0x5b0250))&&(this['sfLogger'][_0x4ed468(0x1ce)](this[_0x4ed468(0x1e7)]+_0x4ed468(0x1b5)+_0x1459d7[_0x4ed468(0x1a4)]+_0x4ed468(0x1e8)),await _0x545b2b[_0x4ed468(0x1ca)][_0x4ed468(0x1d3)](hooks_utils_1[_0x4ed468(0x185)][_0x4ed468(0x182)](this['config']['gitProvider'],_0x545b2b[_0x4ed468(0x1ca)],this['config'][_0x4ed468(0x191)],_0x5b0250)));}return this[_0x4ed468(0x1ac)][_0x4ed468(0x1f2)](_0x545b2b),_0x545b2b;}async[a80_0x592d78(0x19c)](){const _0x29584b=a80_0x592d78;this[_0x29584b(0x194)]=typedi_1[_0x29584b(0x1e9)][_0x29584b(0x1a6)](providers_tokens_1[_0x29584b(0x1f4)]['gitApiService']),this['repoService']=typedi_1['Container'][_0x29584b(0x1a6)](providers_tokens_1[_0x29584b(0x1f4)]['gitRepoService']),this[_0x29584b(0x18b)]=typedi_1[_0x29584b(0x1e9)][_0x29584b(0x1a6)](providers_tokens_1[_0x29584b(0x1f4)]['config']),this[_0x29584b(0x1d2)]=typedi_1[_0x29584b(0x1e9)]['get'](providers_tokens_1['Tokens']['logger']),this['prefix']='['+SyncService_1[_0x29584b(0x1c2)]+_0x29584b(0x1b8)+this[_0x29584b(0x18b)]['gitProvider'][_0x29584b(0x183)]()+']',this[_0x29584b(0x1a9)][_0x29584b(0x1ae)](this[_0x29584b(0x1d2)][_0x29584b(0x19d)]());try{this['sfLogger'][_0x29584b(0x1ce)](this['prefix']+_0x29584b(0x1b1)),await this[_0x29584b(0x1d2)][_0x29584b(0x1ce)](this[_0x29584b(0x1e7)]+'\x20Getting\x20repository\x20records.')[_0x29584b(0x1b4)]();const _0x4895fa=await this['salesforceSync'][_0x29584b(0x1b9)](typedi_1['Container'][_0x29584b(0x1a6)](providers_tokens_1['Tokens'][_0x29584b(0x18a)]));if(!_0x4895fa['length'])throw new bad_request_error_1['BadRequestError'](this[_0x29584b(0x1e7)]+'\x20No\x20repositories\x20to\x20sync.');await this[_0x29584b(0x1d2)][_0x29584b(0x1ce)](this[_0x29584b(0x1e7)]+_0x29584b(0x1c4))[_0x29584b(0x1b4)]();const _0x22d12d=await this['salesforceSync']['getBranchRecords'](_0x4895fa[_0x29584b(0x1d8)](_0x5ab9dd=>'\x27'+_0x5ab9dd[_0x29584b(0x1ef)]+'\x27')[_0x29584b(0x189)](','));await this[_0x29584b(0x1d2)][_0x29584b(0x1ce)](this['prefix']+_0x29584b(0x1ad))[_0x29584b(0x1b4)](),this[_0x29584b(0x1ac)]=await this[_0x29584b(0x1dc)][_0x29584b(0x1dd)]();const _0x3aba8f=[..._0x4895fa,..._0x22d12d];this[_0x29584b(0x1d2)][_0x29584b(0x1ce)](this['prefix']+'\x20Have\x20to\x20synchronize\x20'+_0x3aba8f[_0x29584b(0x1f5)]+_0x29584b(0x1b3));for(const _0x5b2ad7 of _0x3aba8f){this[_0x29584b(0x1f9)]['log'](_0x29584b(0x1f7)+_0x5b2ad7['repositoryName']+'['+_0x5b2ad7[_0x29584b(0x1ef)]+_0x29584b(0x1e6)+_0x5b2ad7['branchName']+'['+_0x5b2ad7[_0x29584b(0x1d7)]+_0x29584b(0x1db)),this[_0x29584b(0x1d2)][_0x29584b(0x1ce)](this[_0x29584b(0x1e7)]+_0x29584b(0x1e4)+_0x5b2ad7[_0x29584b(0x1a4)]+_0x29584b(0x1f3)+_0x5b2ad7[_0x29584b(0x1f6)]+'\x22.'),this[_0x29584b(0x1d2)][_0x29584b(0x1ce)](this[_0x29584b(0x1e7)]+_0x29584b(0x1be));const _0x5cc394=await this[_0x29584b(0x181)](_0x5b2ad7);if(!_0x5cc394)continue;this[_0x29584b(0x1d2)][_0x29584b(0x1ce)](this[_0x29584b(0x1e7)]+'\x20Checking\x20intersects.');const _0x4f3236=await this['isIntersects'](_0x5b2ad7);if(_0x4f3236)continue;await this[_0x29584b(0x1d2)][_0x29584b(0x1b4)]();let _0x182534;try{await this['sfLogger'][_0x29584b(0x1ce)](this[_0x29584b(0x1e7)]+_0x29584b(0x198))['send'](),_0x182534=await this[_0x29584b(0x1bc)](_0x5b2ad7,typedi_1['Container'][_0x29584b(0x1a6)](providers_tokens_1[_0x29584b(0x1f4)][_0x29584b(0x18a)]));}catch(_0x59cfc0){await this['handleRecordSyncError'](_0x5b2ad7,_0x59cfc0 instanceof too_many_requests_error_1[_0x29584b(0x1d5)]?_0x59cfc0:new Error(_0x29584b(0x1f8)+_0x59cfc0));continue;}await this['sfLogger']['log'](this[_0x29584b(0x1e7)]+_0x29584b(0x1c6))[_0x29584b(0x1b4)]();if(_0x5b2ad7['direction']===flosum_repository_sync_dto_1[_0x29584b(0x1c8)]['FlosumToGit']){const _0x891cba=typedi_1['Container'][_0x29584b(0x1a6)](flosum_sync_job_1[_0x29584b(0x1c3)]);await _0x891cba[_0x29584b(0x19c)]({'repository':_0x182534,'convertToSFDX':this['config']['isConvertToSfdx'],'syncRecord':_0x5b2ad7,'provider':this[_0x29584b(0x18b)][_0x29584b(0x1d4)]})[_0x29584b(0x19a)](_0x11e262=>this[_0x29584b(0x1b0)](_0x5b2ad7,_0x11e262));}else{const _0x13515b=typedi_1[_0x29584b(0x1e9)][_0x29584b(0x1a6)](git_sync_job_1['GitSyncJob']);await _0x13515b[_0x29584b(0x19c)]({'repository':_0x182534,'branch':_0x5b2ad7[_0x29584b(0x1f6)],'provider':this[_0x29584b(0x18b)]['gitProvider'],'repositoryGit':_0x182534['gitUrl'],'syncRecord':_0x5b2ad7})['catch'](_0xa71e3b=>this[_0x29584b(0x1b0)](_0x5b2ad7,_0xa71e3b));}}}catch(_0x17b147){this[_0x29584b(0x1f9)][_0x29584b(0x1a7)](_0x17b147);_0x17b147 instanceof too_many_requests_error_1[_0x29584b(0x1d5)]?(await this[_0x29584b(0x1d2)][_0x29584b(0x1ce)](this[_0x29584b(0x1e7)]+_0x29584b(0x1eb))[_0x29584b(0x1b4)](),await(0x0,utils_1[_0x29584b(0x17f)])(0x3c*0x3c*0x3e8),this['run']()):await this[_0x29584b(0x1d2)]['error'](this[_0x29584b(0x1e7)]+_0x29584b(0x1b7)+_0x17b147)['send']();return;}await this[_0x29584b(0x1d2)]['log'](this[_0x29584b(0x1e7)]+'\x20Sync\x20job\x20done.')[_0x29584b(0x1b4)](),await this['salesforceSync'][_0x29584b(0x19e)](typedi_1['Container'][_0x29584b(0x1a6)](providers_tokens_1['Tokens'][_0x29584b(0x18a)]))['catch'](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a80_0x592d78(0x1b2)])({'transient':!![]}),__metadata(a80_0x592d78(0x1df),[salesforce_service_1[a80_0x592d78(0x190)],salesforce_sync_service_1['SalesforceSyncService']])],SyncService),exports['SyncService']=SyncService;