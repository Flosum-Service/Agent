const a113_0x383881=a113_0x20fc;function a113_0x20fc(_0x2fed9b,_0x27dec6){const _0x106d69=a113_0x3768();return a113_0x20fc=function(_0x29ce75,_0x2ef769){_0x29ce75=_0x29ce75-0x12f;let _0x376823=_0x106d69[_0x29ce75];return _0x376823;},a113_0x20fc(_0x2fed9b,_0x27dec6);}(function(_0x2ca2e6,_0xf765f0){const _0xb409e=a113_0x20fc,_0xa7c91f=_0x2ca2e6();while(!![]){try{const _0x5d3a0f=-parseInt(_0xb409e(0x132))/0x1*(parseInt(_0xb409e(0x19a))/0x2)+parseInt(_0xb409e(0x197))/0x3*(parseInt(_0xb409e(0x184))/0x4)+-parseInt(_0xb409e(0x173))/0x5*(-parseInt(_0xb409e(0x13d))/0x6)+parseInt(_0xb409e(0x18a))/0x7*(-parseInt(_0xb409e(0x14c))/0x8)+parseInt(_0xb409e(0x142))/0x9+parseInt(_0xb409e(0x195))/0xa*(-parseInt(_0xb409e(0x162))/0xb)+parseInt(_0xb409e(0x1ad))/0xc;if(_0x5d3a0f===_0xf765f0)break;else _0xa7c91f['push'](_0xa7c91f['shift']());}catch(_0x264bd2){_0xa7c91f['push'](_0xa7c91f['shift']());}}}(a113_0x3768,0x92c2e));const a113_0x2ef769=(function(){let _0x360ed4=!![];return function(_0x1f06cd,_0x21a43a){const _0x2e550d=_0x360ed4?function(){const _0x50e2a7=a113_0x20fc;if(_0x21a43a){const _0x213de3=_0x21a43a[_0x50e2a7(0x172)](_0x1f06cd,arguments);return _0x21a43a=null,_0x213de3;}}:function(){};return _0x360ed4=![],_0x2e550d;};}()),a113_0x29ce75=a113_0x2ef769(this,function(){const _0x4d7aab=a113_0x20fc;return a113_0x29ce75[_0x4d7aab(0x199)]()[_0x4d7aab(0x165)](_0x4d7aab(0x1a7))['toString']()[_0x4d7aab(0x138)](a113_0x29ce75)[_0x4d7aab(0x165)]('(((.+)+)+)+$');});a113_0x29ce75();'use strict';var __decorate=this&&this[a113_0x383881(0x17f)]||function(_0x1a3f9e,_0x288003,_0x3abff8,_0x1c0e4e){const _0x53b0a2=a113_0x383881;var _0x5c75f6=arguments[_0x53b0a2(0x1a9)],_0x3bb610=_0x5c75f6<0x3?_0x288003:_0x1c0e4e===null?_0x1c0e4e=Object['getOwnPropertyDescriptor'](_0x288003,_0x3abff8):_0x1c0e4e,_0x39260d;if(typeof Reflect==='object'&&typeof Reflect[_0x53b0a2(0x137)]===_0x53b0a2(0x13f))_0x3bb610=Reflect[_0x53b0a2(0x137)](_0x1a3f9e,_0x288003,_0x3abff8,_0x1c0e4e);else{for(var _0x2bffa1=_0x1a3f9e[_0x53b0a2(0x1a9)]-0x1;_0x2bffa1>=0x0;_0x2bffa1--)if(_0x39260d=_0x1a3f9e[_0x2bffa1])_0x3bb610=(_0x5c75f6<0x3?_0x39260d(_0x3bb610):_0x5c75f6>0x3?_0x39260d(_0x288003,_0x3abff8,_0x3bb610):_0x39260d(_0x288003,_0x3abff8))||_0x3bb610;}return _0x5c75f6>0x3&&_0x3bb610&&Object[_0x53b0a2(0x13b)](_0x288003,_0x3abff8,_0x3bb610),_0x3bb610;},__metadata=this&&this[a113_0x383881(0x14a)]||function(_0xdfe9f9,_0x12888e){const _0x567a1e=a113_0x383881;if(typeof Reflect===_0x567a1e(0x193)&&typeof Reflect[_0x567a1e(0x18e)]===_0x567a1e(0x13f))return Reflect['metadata'](_0xdfe9f9,_0x12888e);},SyncService_1;Object[a113_0x383881(0x13b)](exports,a113_0x383881(0x1a8),{'value':!![]}),exports[a113_0x383881(0x157)]=void 0x0;function a113_0x3768(){const _0x1acb47=['REPOSITORY_NAME_REGEXP','190OIwqSc','\x20Checking\x20valid\x20name.','48gXXtDA','../../salesforce/errors/salesforce.error','toString','761126wasQxX','gitUrl','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','HooksUtils','\x20branches.','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','catch','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','\x20Checking\x20intersects.','isBidirectionalSynchronization','../jobs/flosum-sync.job','sfLogger','repositoryId','(((.+)+)+)+$','__esModule','length','Tokens','config','\x20No\x20repositories\x20to\x20sync.','11576388kpYFSh','\x20Completed\x20prepare\x20to\x20syncing.','setStatus','../../../../constants','1NqFFmr','\x20Repository\x20\x22','\x20Stop\x20sync\x20job\x20for\x20\x27','getOrCreateRepo','Unable\x20to\x20synchronize\x20repository\x20\x27','decorate','constructor','Service','connectionId','defineProperty','run','825780GQsQmm','join','function','salesforceService','SalesforceError','293751RnneJu','gitProvider',']\x20repository\x20','toLowerCase','\x27\x20-\x20\x27','getLoggerId','get','\x20Have\x20to\x20synchronize\x20','__metadata','test','104RRTCLf','disableSync','../../salesforce/services/salesforce.service','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','applicationUrl','\x20Getting\x20repositories\x20from\x20git\x20service.',']\x20due\x20error\x20-\x20','gitRepoService','SyncDirection','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','SyncService','Not\x20Synchronized','send','push','branchName','../../../../core','create','hooks',']\x20branch.','\x20Getting\x20branch\x20records.','isIntersects','424952Atadlv','../../../../core/errors/too-many-requests.error','TooManyRequests','search','checkValidNaming','getAll','branchId','isConvertToSfdx','url','GitSyncJob','getHookLinkFor','../errors/git-branch-not-found.error','\x27\x20in\x20repository\x20\x27','repoList','../../providers/providers.tokens','../../../../core/errors/bad-request.error','apply','25KRaQgK','gitApiService','SalesforceSyncService','\x20Syncing\x20repository:\x20\x22','find','error','repoService','getRepositoryRecords','prefix','BRANCH_NAME_REGEXP','Container','repositoriesIntersections','__decorate','createHookPayload','\x27\x20[','log','typedi','31120QpKava','BadRequestError','repositoryName','name','Logger',']\x20[','50757sXdcpN','Syncing\x20','logger','salesforceSync','metadata','\x20Getting\x20Flosum\x20repository','handleRecordSyncError','../../salesforce/services/salesforce-sync.service','\x20Sync\x20job\x20done.','object'];a113_0x3768=function(){return _0x1acb47;};return a113_0x3768();}const constants_1=require(a113_0x383881(0x131)),core_1=require(a113_0x383881(0x15c)),too_many_requests_error_1=require(a113_0x383881(0x163)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require(a113_0x383881(0x198)),salesforce_sync_service_1=require(a113_0x383881(0x191)),salesforce_service_1=require(a113_0x383881(0x14e)),utils_1=require('../../../shared/utils'),typedi_1=require(a113_0x383881(0x183)),hooks_utils_1=require('../../providers/web-hooks/hooks.utils'),git_branch_not_found_error_1=require(a113_0x383881(0x16d)),flosum_sync_job_1=require(a113_0x383881(0x1a4)),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require(a113_0x383881(0x170)),bad_request_error_1=require(a113_0x383881(0x171));let SyncService=SyncService_1=class SyncService{constructor(_0x47bf4d,_0x270d95){const _0x23bc66=a113_0x383881;this[_0x23bc66(0x140)]=_0x47bf4d,this['salesforceSync']=_0x270d95,this[_0x23bc66(0x18c)]=new core_1[(_0x23bc66(0x188))](SyncService_1[_0x23bc66(0x187)]),this['repositoriesIntersections']={},this[_0x23bc66(0x16f)]=[];}async[a113_0x383881(0x190)](_0x23a913,_0x3998aa){const _0x1b2320=a113_0x383881;if(_0x3998aa instanceof git_branch_not_found_error_1['GitBranchNotFoundError']){await this['salesforceSync']['setStatus'](_0x23a913,_0x1b2320(0x158));return;}if(_0x3998aa instanceof too_many_requests_error_1[_0x1b2320(0x164)]){await this[_0x1b2320(0x18d)][_0x1b2320(0x130)](_0x23a913,'Waiting');throw _0x3998aa;}try{await this[_0x1b2320(0x1a5)][_0x1b2320(0x178)](this[_0x1b2320(0x17b)]+_0x1b2320(0x134)+_0x23a913[_0x1b2320(0x186)]+_0x1b2320(0x181)+_0x23a913[_0x1b2320(0x15b)]+_0x1b2320(0x153)+_0x3998aa+'.')[_0x1b2320(0x159)](),await this[_0x1b2320(0x18d)]['updateRemoteState'](_0x23a913,{}),await this[_0x1b2320(0x18d)][_0x1b2320(0x130)](_0x23a913,'Error');}catch(_0x180b10){if(_0x180b10 instanceof salesforce_error_1[_0x1b2320(0x141)])throw _0x180b10;}}async[a113_0x383881(0x161)](_0x58328e){const _0x5bd6e4=a113_0x383881;if(_0x58328e[_0x5bd6e4(0x1a6)]){const _0x27d27f=_0x58328e[_0x5bd6e4(0x186)][_0x5bd6e4(0x145)](),_0x56e752=this[_0x5bd6e4(0x17e)][_0x27d27f];if(!_0x56e752)this[_0x5bd6e4(0x17e)][_0x27d27f]=_0x58328e[_0x5bd6e4(0x186)];else{if(_0x56e752&&_0x56e752!==_0x58328e[_0x5bd6e4(0x186)])return await this['handleRecordSyncError'](_0x58328e,new Error(_0x5bd6e4(0x136)+_0x58328e[_0x5bd6e4(0x186)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x27d27f+_0x5bd6e4(0x146)+_0x56e752+'\x27')),!![];}}return![];}async[a113_0x383881(0x166)](_0x1deccd){const _0x397705=a113_0x383881;if(!constants_1[_0x397705(0x194)]['test'](_0x1deccd[_0x397705(0x186)]))return await this[_0x397705(0x190)](_0x1deccd,new Error(_0x397705(0x136)+_0x1deccd[_0x397705(0x186)]+_0x397705(0x19c))),![];if(!constants_1[_0x397705(0x17c)][_0x397705(0x14b)](_0x1deccd['branchName']))return await this['handleRecordSyncError'](_0x1deccd,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x1deccd[_0x397705(0x15b)]+_0x397705(0x16e)+_0x1deccd[_0x397705(0x186)]+_0x397705(0x19f))),![];return!![];}async[a113_0x383881(0x135)](_0x26bdfa,_0x3fc0e4){const _0x58549b=a113_0x383881;let _0x3d9c7d=this['repoList'][_0x58549b(0x177)](_0x451748=>_0x26bdfa[_0x58549b(0x186)]===_0x451748[_0x58549b(0x187)]);!_0x3d9c7d&&(this[_0x58549b(0x1a5)][_0x58549b(0x182)](this[_0x58549b(0x17b)]+_0x58549b(0x133)+_0x26bdfa[_0x58549b(0x186)]+_0x58549b(0x150)),_0x3d9c7d=await this[_0x58549b(0x179)][_0x58549b(0x15d)]({'name':_0x26bdfa['repositoryName'],'autoInit':!![],'defaultBranch':_0x26bdfa['branchName'],'private':!![],'createHook':typedi_1[_0x58549b(0x17d)][_0x58549b(0x148)](providers_tokens_1[_0x58549b(0x1aa)]['config'])[_0x58549b(0x1a3)]}));if(this[_0x58549b(0x1ab)]['isBidirectionalSynchronization']){const _0x3c9e96=await _0x3d9c7d[_0x58549b(0x15e)][_0x58549b(0x167)]();!_0x3c9e96[_0x58549b(0x177)](_0x1d7201=>_0x1d7201[_0x58549b(0x16a)]===hooks_utils_1['HooksUtils'][_0x58549b(0x16c)](this[_0x58549b(0x1ab)][_0x58549b(0x143)],this[_0x58549b(0x1ab)][_0x58549b(0x151)],_0x3fc0e4))&&(this[_0x58549b(0x1a5)][_0x58549b(0x182)](this[_0x58549b(0x17b)]+_0x58549b(0x133)+_0x26bdfa[_0x58549b(0x186)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x3d9c7d[_0x58549b(0x15e)][_0x58549b(0x15d)](hooks_utils_1[_0x58549b(0x19d)][_0x58549b(0x180)](this[_0x58549b(0x1ab)][_0x58549b(0x143)],_0x3d9c7d[_0x58549b(0x15e)],this[_0x58549b(0x1ab)][_0x58549b(0x151)],_0x3fc0e4)));}return this[_0x58549b(0x16f)][_0x58549b(0x15a)](_0x3d9c7d),_0x3d9c7d;}async['run'](){const _0x53a1b5=a113_0x383881;this[_0x53a1b5(0x174)]=typedi_1[_0x53a1b5(0x17d)][_0x53a1b5(0x148)](providers_tokens_1['Tokens']['gitApiService']),this['repoService']=typedi_1[_0x53a1b5(0x17d)][_0x53a1b5(0x148)](providers_tokens_1[_0x53a1b5(0x1aa)][_0x53a1b5(0x154)]),this['config']=typedi_1[_0x53a1b5(0x17d)]['get'](providers_tokens_1[_0x53a1b5(0x1aa)]['config']),this[_0x53a1b5(0x1a5)]=typedi_1[_0x53a1b5(0x17d)]['get'](providers_tokens_1[_0x53a1b5(0x1aa)][_0x53a1b5(0x18c)]),this['prefix']='['+SyncService_1[_0x53a1b5(0x187)]+_0x53a1b5(0x189)+this[_0x53a1b5(0x1ab)][_0x53a1b5(0x143)]['toUpperCase']()+']',this[_0x53a1b5(0x140)]['setLoggerId'](this['sfLogger'][_0x53a1b5(0x147)]());try{this[_0x53a1b5(0x1a5)][_0x53a1b5(0x182)](this[_0x53a1b5(0x17b)]+'\x20Start\x20sync\x20job.'),await this['sfLogger']['log'](this[_0x53a1b5(0x17b)]+'\x20Getting\x20repository\x20records.')[_0x53a1b5(0x159)]();const _0x2bb25a=await this[_0x53a1b5(0x18d)][_0x53a1b5(0x17a)](typedi_1[_0x53a1b5(0x17d)]['get'](providers_tokens_1[_0x53a1b5(0x1aa)][_0x53a1b5(0x13a)]));if(!_0x2bb25a['length'])throw new bad_request_error_1[(_0x53a1b5(0x185))](this[_0x53a1b5(0x17b)]+_0x53a1b5(0x1ac));await this[_0x53a1b5(0x1a5)][_0x53a1b5(0x182)](this['prefix']+_0x53a1b5(0x160))[_0x53a1b5(0x159)]();const _0x1a95b7=await this[_0x53a1b5(0x18d)]['getBranchRecords'](_0x2bb25a['map'](_0x535e91=>'\x27'+_0x535e91[_0x53a1b5(0x1a6)]+'\x27')[_0x53a1b5(0x13e)](','));await this[_0x53a1b5(0x1a5)]['log'](this[_0x53a1b5(0x17b)]+_0x53a1b5(0x152))[_0x53a1b5(0x159)](),this[_0x53a1b5(0x16f)]=await this[_0x53a1b5(0x179)][_0x53a1b5(0x167)]();const _0x13fd86=[..._0x2bb25a,..._0x1a95b7];this[_0x53a1b5(0x1a5)][_0x53a1b5(0x182)](this['prefix']+_0x53a1b5(0x149)+_0x13fd86['length']+_0x53a1b5(0x19e));for(const _0x322763 of _0x13fd86){this[_0x53a1b5(0x18c)][_0x53a1b5(0x182)](_0x53a1b5(0x18b)+_0x322763[_0x53a1b5(0x186)]+'['+_0x322763[_0x53a1b5(0x1a6)]+_0x53a1b5(0x144)+_0x322763[_0x53a1b5(0x15b)]+'['+_0x322763[_0x53a1b5(0x168)]+_0x53a1b5(0x15f)),this[_0x53a1b5(0x1a5)][_0x53a1b5(0x182)](this[_0x53a1b5(0x17b)]+_0x53a1b5(0x176)+_0x322763[_0x53a1b5(0x186)]+'\x22\x20branch:\x20\x22'+_0x322763[_0x53a1b5(0x15b)]+'\x22.'),this[_0x53a1b5(0x1a5)][_0x53a1b5(0x182)](this[_0x53a1b5(0x17b)]+_0x53a1b5(0x196));const _0x2b855b=await this[_0x53a1b5(0x166)](_0x322763);if(!_0x2b855b)continue;this[_0x53a1b5(0x1a5)]['log'](this[_0x53a1b5(0x17b)]+_0x53a1b5(0x1a2));const _0x2ea705=await this['isIntersects'](_0x322763);if(_0x2ea705)continue;await this['sfLogger']['send']();let _0x38a9a7;try{await this[_0x53a1b5(0x1a5)][_0x53a1b5(0x182)](this[_0x53a1b5(0x17b)]+_0x53a1b5(0x18f))['send'](),_0x38a9a7=await this[_0x53a1b5(0x135)](_0x322763,typedi_1[_0x53a1b5(0x17d)][_0x53a1b5(0x148)](providers_tokens_1['Tokens'][_0x53a1b5(0x13a)]));}catch(_0x4361b4){await this['handleRecordSyncError'](_0x322763,_0x4361b4 instanceof too_many_requests_error_1[_0x53a1b5(0x164)]?_0x4361b4:new Error(_0x53a1b5(0x14f)+_0x4361b4));continue;}await this[_0x53a1b5(0x1a5)][_0x53a1b5(0x182)](this[_0x53a1b5(0x17b)]+_0x53a1b5(0x12f))[_0x53a1b5(0x159)]();if(_0x322763['direction']===flosum_repository_sync_dto_1[_0x53a1b5(0x155)]['FlosumToGit']){const _0x12a0d3=typedi_1[_0x53a1b5(0x17d)]['get'](flosum_sync_job_1['FlosumSyncJob']);await _0x12a0d3[_0x53a1b5(0x13c)]({'repository':_0x38a9a7,'convertToSFDX':this['config'][_0x53a1b5(0x169)],'syncRecord':_0x322763,'provider':this[_0x53a1b5(0x1ab)][_0x53a1b5(0x143)]})[_0x53a1b5(0x1a0)](_0x28965a=>this[_0x53a1b5(0x190)](_0x322763,_0x28965a));}else{const _0x4eb420=typedi_1[_0x53a1b5(0x17d)][_0x53a1b5(0x148)](git_sync_job_1[_0x53a1b5(0x16b)]);await _0x4eb420[_0x53a1b5(0x13c)]({'repository':_0x38a9a7,'branch':_0x322763[_0x53a1b5(0x15b)],'provider':this[_0x53a1b5(0x1ab)][_0x53a1b5(0x143)],'repositoryGit':_0x38a9a7[_0x53a1b5(0x19b)],'syncRecord':_0x322763})['catch'](_0x66375f=>this[_0x53a1b5(0x190)](_0x322763,_0x66375f));}}}catch(_0x145bac){this[_0x53a1b5(0x18c)][_0x53a1b5(0x178)](_0x145bac);_0x145bac instanceof too_many_requests_error_1[_0x53a1b5(0x164)]?(await this[_0x53a1b5(0x1a5)]['log'](this[_0x53a1b5(0x17b)]+_0x53a1b5(0x156))[_0x53a1b5(0x159)](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0x53a1b5(0x13c)]()):await this[_0x53a1b5(0x1a5)][_0x53a1b5(0x178)](this['prefix']+_0x53a1b5(0x1a1)+_0x145bac)[_0x53a1b5(0x159)]();return;}await this['sfLogger'][_0x53a1b5(0x182)](this[_0x53a1b5(0x17b)]+_0x53a1b5(0x192))['send'](),await this['salesforceSync'][_0x53a1b5(0x14d)](typedi_1[_0x53a1b5(0x17d)][_0x53a1b5(0x148)](providers_tokens_1[_0x53a1b5(0x1aa)][_0x53a1b5(0x13a)]))[_0x53a1b5(0x1a0)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a113_0x383881(0x139)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a113_0x383881(0x175)]])],SyncService),exports['SyncService']=SyncService;