const a110_0x10830f=a110_0x3ca1;(function(_0x582583,_0x20a937){const _0x146c1d=a110_0x3ca1,_0x1e0512=_0x582583();while(!![]){try{const _0x24ba1b=parseInt(_0x146c1d(0x1ae))/0x1+-parseInt(_0x146c1d(0x1a0))/0x2+parseInt(_0x146c1d(0x19b))/0x3*(parseInt(_0x146c1d(0x1e4))/0x4)+parseInt(_0x146c1d(0x200))/0x5+parseInt(_0x146c1d(0x1cd))/0x6*(-parseInt(_0x146c1d(0x1b0))/0x7)+parseInt(_0x146c1d(0x19e))/0x8*(-parseInt(_0x146c1d(0x1a5))/0x9)+-parseInt(_0x146c1d(0x1a1))/0xa*(-parseInt(_0x146c1d(0x18f))/0xb);if(_0x24ba1b===_0x20a937)break;else _0x1e0512['push'](_0x1e0512['shift']());}catch(_0x527877){_0x1e0512['push'](_0x1e0512['shift']());}}}(a110_0x5e22,0xe66e8));const a110_0x317921=(function(){let _0x579178=!![];return function(_0x574812,_0x29085d){const _0x3360bb=_0x579178?function(){const _0x53369=a110_0x3ca1;if(_0x29085d){const _0x220c5b=_0x29085d[_0x53369(0x195)](_0x574812,arguments);return _0x29085d=null,_0x220c5b;}}:function(){};return _0x579178=![],_0x3360bb;};}()),a110_0x35d0de=a110_0x317921(this,function(){const _0x589a6b=a110_0x3ca1;return a110_0x35d0de['toString']()[_0x589a6b(0x1ea)]('(((.+)+)+)+$')[_0x589a6b(0x1ca)]()[_0x589a6b(0x1f1)](a110_0x35d0de)[_0x589a6b(0x1ea)]('(((.+)+)+)+$');});a110_0x35d0de();'use strict';function a110_0x3ca1(_0x1edef4,_0x5aafed){const _0x41f51f=a110_0x5e22();return a110_0x3ca1=function(_0x35d0de,_0x317921){_0x35d0de=_0x35d0de-0x18c;let _0x5e22fa=_0x41f51f[_0x35d0de];return _0x5e22fa;},a110_0x3ca1(_0x1edef4,_0x5aafed);}var __decorate=this&&this[a110_0x10830f(0x196)]||function(_0x343eb8,_0x37872b,_0x2433c9,_0x870108){const _0x446643=a110_0x10830f;var _0x2c33d1=arguments['length'],_0x359ae7=_0x2c33d1<0x3?_0x37872b:_0x870108===null?_0x870108=Object[_0x446643(0x1c1)](_0x37872b,_0x2433c9):_0x870108,_0x59c1cd;if(typeof Reflect===_0x446643(0x1d2)&&typeof Reflect[_0x446643(0x19a)]===_0x446643(0x1cb))_0x359ae7=Reflect[_0x446643(0x19a)](_0x343eb8,_0x37872b,_0x2433c9,_0x870108);else{for(var _0x409122=_0x343eb8['length']-0x1;_0x409122>=0x0;_0x409122--)if(_0x59c1cd=_0x343eb8[_0x409122])_0x359ae7=(_0x2c33d1<0x3?_0x59c1cd(_0x359ae7):_0x2c33d1>0x3?_0x59c1cd(_0x37872b,_0x2433c9,_0x359ae7):_0x59c1cd(_0x37872b,_0x2433c9))||_0x359ae7;}return _0x2c33d1>0x3&&_0x359ae7&&Object[_0x446643(0x193)](_0x37872b,_0x2433c9,_0x359ae7),_0x359ae7;},__metadata=this&&this[a110_0x10830f(0x1f9)]||function(_0x11aabe,_0x29388b){const _0x3c330e=a110_0x10830f;if(typeof Reflect===_0x3c330e(0x1d2)&&typeof Reflect[_0x3c330e(0x203)]===_0x3c330e(0x1cb))return Reflect[_0x3c330e(0x203)](_0x11aabe,_0x29388b);},SyncService_1;Object['defineProperty'](exports,a110_0x10830f(0x1c2),{'value':!![]}),exports[a110_0x10830f(0x1bb)]=void 0x0;function a110_0x5e22(){const _0x2af46d=['repositoryName','toLowerCase','getBranchRecords','SalesforceService','Unable\x20to\x20synchronize\x20branch\x20\x27',']\x20[','map','208142nXdtPn','sfLogger','../../../../core/errors/too-many-requests.error',']\x20due\x20error\x20-\x20','defineProperty','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','apply','__decorate','config','repoList','\x20Checking\x20valid\x20name.','decorate','1463829eJCCTW','HooksUtils','BRANCH_NAME_REGEXP','117424YduAlJ','\x20Repository\x20\x22','2601234QXEBKN','310nEVOgu','length','setStatus','prefix','342ArzqGH','\x22\x20branch:\x20\x22','../jobs/git-sync.job','../../providers/providers.tokens','push','get','\x27\x20-\x20\x27','direction','../errors/git-branch-not-found.error','981126DIaIRa','isConvertToSfdx','7Enktsb','getOrCreateRepo','branchName','../../../shared/utils',']\x20repository\x20',']\x20branch.','../../../../core','../../salesforce/errors/salesforce.error','SyncDirection','FlosumSyncJob','isBidirectionalSynchronization','SyncService','createHookPayload','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','\x20Getting\x20branch\x20records.','branchId','Container','getOwnPropertyDescriptor','__esModule','GitSyncJob','getAll','run','getRepositoryRecords','TooManyRequests','../../salesforce/services/salesforce-sync.service','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','toString','function','checkValidNaming','8518098NpfwJJ','name','../../providers/web-hooks/hooks.utils','repositoriesIntersections','\x20Stop\x20sync\x20job\x20for\x20\x27','object','../jobs/flosum-sync.job','error','setLoggerId','REPOSITORY_NAME_REGEXP','BadRequestError','send','catch','hooks','\x20Sync\x20job\x20done.','Syncing\x20','logger','typedi','Error','../../../../core/errors/bad-request.error','\x20branches.','Waiting','connectionId','8RDFOZD','log','GitBranchNotFoundError','Service','sleep','salesforceService','search','../../salesforce/dto/flosum-repository-sync.dto','SalesforceSyncService','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','handleRecordSyncError','applicationUrl','updateRemoteState','constructor','gitApiService','\x20Syncing\x20repository:\x20\x22','gitRepoService','repositoryId','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','\x20Start\x20sync\x20job.','Tokens','__metadata','find','\x20Completed\x20prepare\x20to\x20syncing.','Unable\x20to\x20synchronize\x20repository\x20\x27','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','create','8391590eSNIWw','gitProvider','repoService','metadata','salesforceSync','test','gitUrl','../../salesforce/services/salesforce.service','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','isIntersects','\x20Have\x20to\x20synchronize\x20'];a110_0x5e22=function(){return _0x2af46d;};return a110_0x5e22();}const constants_1=require('../../../../constants'),core_1=require(a110_0x10830f(0x1b6)),too_many_requests_error_1=require(a110_0x10830f(0x191)),flosum_repository_sync_dto_1=require(a110_0x10830f(0x1eb)),salesforce_error_1=require(a110_0x10830f(0x1b7)),salesforce_sync_service_1=require(a110_0x10830f(0x1c8)),salesforce_service_1=require(a110_0x10830f(0x207)),utils_1=require(a110_0x10830f(0x1b3)),typedi_1=require(a110_0x10830f(0x1de)),hooks_utils_1=require(a110_0x10830f(0x1cf)),git_branch_not_found_error_1=require(a110_0x10830f(0x1ad)),flosum_sync_job_1=require(a110_0x10830f(0x1d3)),git_sync_job_1=require(a110_0x10830f(0x1a7)),providers_tokens_1=require(a110_0x10830f(0x1a8)),bad_request_error_1=require(a110_0x10830f(0x1e0));let SyncService=SyncService_1=class SyncService{constructor(_0x106890,_0x3ad754){const _0x29288e=a110_0x10830f;this[_0x29288e(0x1e9)]=_0x106890,this['salesforceSync']=_0x3ad754,this[_0x29288e(0x1dd)]=new core_1['Logger'](SyncService_1[_0x29288e(0x1ce)]),this['repositoriesIntersections']={},this[_0x29288e(0x198)]=[];}async[a110_0x10830f(0x1ee)](_0x3e3561,_0x567ac3){const _0x423e3a=a110_0x10830f;if(_0x567ac3 instanceof git_branch_not_found_error_1[_0x423e3a(0x1e6)]){await this['salesforceSync'][_0x423e3a(0x1a3)](_0x3e3561,'Not\x20Synchronized');return;}if(_0x567ac3 instanceof too_many_requests_error_1[_0x423e3a(0x1c7)]){await this[_0x423e3a(0x204)][_0x423e3a(0x1a3)](_0x3e3561,_0x423e3a(0x1e2));throw _0x567ac3;}try{await this['sfLogger'][_0x423e3a(0x1d4)](this[_0x423e3a(0x1a4)]+_0x423e3a(0x1d1)+_0x3e3561[_0x423e3a(0x20b)]+'\x27\x20['+_0x3e3561['branchName']+_0x423e3a(0x192)+_0x567ac3+'.')[_0x423e3a(0x1d8)](),await this[_0x423e3a(0x204)][_0x423e3a(0x1f0)](_0x3e3561,{}),await this['salesforceSync'][_0x423e3a(0x1a3)](_0x3e3561,_0x423e3a(0x1df));}catch(_0x81e232){if(_0x81e232 instanceof salesforce_error_1['SalesforceError'])throw _0x81e232;}}async[a110_0x10830f(0x209)](_0x5b0621){const _0x361f0e=a110_0x10830f;if(_0x5b0621[_0x361f0e(0x1f5)]){const _0x1656ae=_0x5b0621[_0x361f0e(0x20b)][_0x361f0e(0x20c)](),_0x5d346b=this[_0x361f0e(0x1d0)][_0x1656ae];if(!_0x5d346b)this[_0x361f0e(0x1d0)][_0x1656ae]=_0x5b0621[_0x361f0e(0x20b)];else{if(_0x5d346b&&_0x5d346b!==_0x5b0621['repositoryName'])return await this[_0x361f0e(0x1ee)](_0x5b0621,new Error(_0x361f0e(0x1fc)+_0x5b0621['repositoryName']+_0x361f0e(0x1f6)+_0x1656ae+_0x361f0e(0x1ab)+_0x5d346b+'\x27')),!![];}}return![];}async[a110_0x10830f(0x1cc)](_0x3570bd){const _0x3f1dd5=a110_0x10830f;if(!constants_1[_0x3f1dd5(0x1d6)][_0x3f1dd5(0x205)](_0x3570bd[_0x3f1dd5(0x20b)]))return await this[_0x3f1dd5(0x1ee)](_0x3570bd,new Error(_0x3f1dd5(0x1fc)+_0x3570bd[_0x3f1dd5(0x20b)]+_0x3f1dd5(0x1fd))),![];if(!constants_1[_0x3f1dd5(0x19d)]['test'](_0x3570bd[_0x3f1dd5(0x1b2)]))return await this[_0x3f1dd5(0x1ee)](_0x3570bd,new Error(_0x3f1dd5(0x18c)+_0x3570bd[_0x3f1dd5(0x1b2)]+'\x27\x20in\x20repository\x20\x27'+_0x3570bd[_0x3f1dd5(0x20b)]+_0x3f1dd5(0x1fe))),![];return!![];}async['getOrCreateRepo'](_0x145011,_0x15e2b7){const _0x492139=a110_0x10830f;let _0x52c41e=this[_0x492139(0x198)][_0x492139(0x1fa)](_0x1afaa6=>_0x145011[_0x492139(0x20b)]===_0x1afaa6[_0x492139(0x1ce)]);!_0x52c41e&&(this[_0x492139(0x190)][_0x492139(0x1e5)](this[_0x492139(0x1a4)]+'\x20Repository\x20\x22'+_0x145011['repositoryName']+_0x492139(0x1c9)),_0x52c41e=await this['repoService'][_0x492139(0x1ff)]({'name':_0x145011[_0x492139(0x20b)],'autoInit':!![],'defaultBranch':_0x145011[_0x492139(0x1b2)],'private':!![],'createHook':typedi_1['Container'][_0x492139(0x1aa)](providers_tokens_1[_0x492139(0x1f8)][_0x492139(0x197)])['isBidirectionalSynchronization']}));if(this[_0x492139(0x197)][_0x492139(0x1ba)]){const _0x42eab6=await _0x52c41e['hooks'][_0x492139(0x1c4)]();!_0x42eab6[_0x492139(0x1fa)](_0x46fe0c=>_0x46fe0c['url']===hooks_utils_1[_0x492139(0x19c)]['getHookLinkFor'](this['config']['gitProvider'],this[_0x492139(0x197)][_0x492139(0x1ef)],_0x15e2b7))&&(this[_0x492139(0x190)][_0x492139(0x1e5)](this[_0x492139(0x1a4)]+_0x492139(0x19f)+_0x145011[_0x492139(0x20b)]+_0x492139(0x208)),await _0x52c41e[_0x492139(0x1da)][_0x492139(0x1ff)](hooks_utils_1[_0x492139(0x19c)][_0x492139(0x1bc)](this[_0x492139(0x197)][_0x492139(0x201)],_0x52c41e[_0x492139(0x1da)],this[_0x492139(0x197)]['applicationUrl'],_0x15e2b7)));}return this[_0x492139(0x198)][_0x492139(0x1a9)](_0x52c41e),_0x52c41e;}async[a110_0x10830f(0x1c5)](){const _0x232540=a110_0x10830f;this['gitApiService']=typedi_1['Container'][_0x232540(0x1aa)](providers_tokens_1[_0x232540(0x1f8)][_0x232540(0x1f2)]),this[_0x232540(0x202)]=typedi_1['Container'][_0x232540(0x1aa)](providers_tokens_1[_0x232540(0x1f8)][_0x232540(0x1f4)]),this[_0x232540(0x197)]=typedi_1[_0x232540(0x1c0)][_0x232540(0x1aa)](providers_tokens_1[_0x232540(0x1f8)][_0x232540(0x197)]),this[_0x232540(0x190)]=typedi_1[_0x232540(0x1c0)][_0x232540(0x1aa)](providers_tokens_1[_0x232540(0x1f8)][_0x232540(0x1dd)]),this['prefix']='['+SyncService_1[_0x232540(0x1ce)]+_0x232540(0x18d)+this[_0x232540(0x197)][_0x232540(0x201)]['toUpperCase']()+']',this[_0x232540(0x1e9)][_0x232540(0x1d5)](this[_0x232540(0x190)]['getLoggerId']());try{this[_0x232540(0x190)][_0x232540(0x1e5)](this[_0x232540(0x1a4)]+_0x232540(0x1f7)),await this[_0x232540(0x190)][_0x232540(0x1e5)](this[_0x232540(0x1a4)]+'\x20Getting\x20repository\x20records.')['send']();const _0x3fa6e3=await this[_0x232540(0x204)][_0x232540(0x1c6)](typedi_1[_0x232540(0x1c0)][_0x232540(0x1aa)](providers_tokens_1[_0x232540(0x1f8)]['connectionId']));if(!_0x3fa6e3[_0x232540(0x1a2)])throw new bad_request_error_1[(_0x232540(0x1d7))](this['prefix']+'\x20No\x20repositories\x20to\x20sync.');await this[_0x232540(0x190)][_0x232540(0x1e5)](this[_0x232540(0x1a4)]+_0x232540(0x1be))[_0x232540(0x1d8)]();const _0xdac819=await this['salesforceSync'][_0x232540(0x20d)](_0x3fa6e3[_0x232540(0x18e)](_0x3d2c20=>'\x27'+_0x3d2c20[_0x232540(0x1f5)]+'\x27')['join'](','));await this['sfLogger']['log'](this[_0x232540(0x1a4)]+'\x20Getting\x20repositories\x20from\x20git\x20service.')[_0x232540(0x1d8)](),this[_0x232540(0x198)]=await this[_0x232540(0x202)]['getAll']();const _0x414db3=[..._0x3fa6e3,..._0xdac819];this[_0x232540(0x190)]['log'](this['prefix']+_0x232540(0x20a)+_0x414db3[_0x232540(0x1a2)]+_0x232540(0x1e1));for(const _0x119d1d of _0x414db3){this[_0x232540(0x1dd)][_0x232540(0x1e5)](_0x232540(0x1dc)+_0x119d1d[_0x232540(0x20b)]+'['+_0x119d1d[_0x232540(0x1f5)]+_0x232540(0x1b4)+_0x119d1d[_0x232540(0x1b2)]+'['+_0x119d1d[_0x232540(0x1bf)]+_0x232540(0x1b5)),this[_0x232540(0x190)][_0x232540(0x1e5)](this['prefix']+_0x232540(0x1f3)+_0x119d1d[_0x232540(0x20b)]+_0x232540(0x1a6)+_0x119d1d[_0x232540(0x1b2)]+'\x22.'),this[_0x232540(0x190)]['log'](this[_0x232540(0x1a4)]+_0x232540(0x199));const _0x189e8f=await this[_0x232540(0x1cc)](_0x119d1d);if(!_0x189e8f)continue;this[_0x232540(0x190)][_0x232540(0x1e5)](this[_0x232540(0x1a4)]+'\x20Checking\x20intersects.');const _0x3c88db=await this[_0x232540(0x209)](_0x119d1d);if(_0x3c88db)continue;await this[_0x232540(0x190)][_0x232540(0x1d8)]();let _0x2c496f;try{await this[_0x232540(0x190)][_0x232540(0x1e5)](this[_0x232540(0x1a4)]+'\x20Getting\x20Flosum\x20repository')[_0x232540(0x1d8)](),_0x2c496f=await this[_0x232540(0x1b1)](_0x119d1d,typedi_1['Container'][_0x232540(0x1aa)](providers_tokens_1['Tokens'][_0x232540(0x1e3)]));}catch(_0xa52c03){await this['handleRecordSyncError'](_0x119d1d,_0xa52c03 instanceof too_many_requests_error_1[_0x232540(0x1c7)]?_0xa52c03:new Error(_0x232540(0x194)+_0xa52c03));continue;}await this[_0x232540(0x190)][_0x232540(0x1e5)](this[_0x232540(0x1a4)]+_0x232540(0x1fb))['send']();if(_0x119d1d[_0x232540(0x1ac)]===flosum_repository_sync_dto_1[_0x232540(0x1b8)]['FlosumToGit']){const _0xa0243=typedi_1[_0x232540(0x1c0)][_0x232540(0x1aa)](flosum_sync_job_1[_0x232540(0x1b9)]);await _0xa0243[_0x232540(0x1c5)]({'repository':_0x2c496f,'convertToSFDX':this[_0x232540(0x197)][_0x232540(0x1af)],'syncRecord':_0x119d1d,'provider':this[_0x232540(0x197)]['gitProvider']})[_0x232540(0x1d9)](_0x299c09=>this[_0x232540(0x1ee)](_0x119d1d,_0x299c09));}else{const _0x3df795=typedi_1[_0x232540(0x1c0)][_0x232540(0x1aa)](git_sync_job_1[_0x232540(0x1c3)]);await _0x3df795['run']({'repository':_0x2c496f,'branch':_0x119d1d[_0x232540(0x1b2)],'provider':this[_0x232540(0x197)][_0x232540(0x201)],'repositoryGit':_0x2c496f[_0x232540(0x206)],'syncRecord':_0x119d1d})[_0x232540(0x1d9)](_0xbd3ce4=>this[_0x232540(0x1ee)](_0x119d1d,_0xbd3ce4));}}}catch(_0x3fa71b){this[_0x232540(0x1dd)]['error'](_0x3fa71b);_0x3fa71b instanceof too_many_requests_error_1['TooManyRequests']?(await this[_0x232540(0x190)][_0x232540(0x1e5)](this[_0x232540(0x1a4)]+_0x232540(0x1ed))[_0x232540(0x1d8)](),await(0x0,utils_1[_0x232540(0x1e8)])(0x3c*0x3c*0x3e8),this['run']()):await this[_0x232540(0x190)][_0x232540(0x1d4)](this[_0x232540(0x1a4)]+_0x232540(0x1bd)+_0x3fa71b)[_0x232540(0x1d8)]();return;}await this['sfLogger'][_0x232540(0x1e5)](this[_0x232540(0x1a4)]+_0x232540(0x1db))[_0x232540(0x1d8)](),await this['salesforceSync']['disableSync'](typedi_1[_0x232540(0x1c0)][_0x232540(0x1aa)](providers_tokens_1[_0x232540(0x1f8)][_0x232540(0x1e3)]))['catch'](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a110_0x10830f(0x1e7)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a110_0x10830f(0x20e)],salesforce_sync_service_1[a110_0x10830f(0x1ec)]])],SyncService),exports[a110_0x10830f(0x1bb)]=SyncService;