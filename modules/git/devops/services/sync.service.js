const a111_0x585992=a111_0x45ce;(function(_0x4f58e9,_0x222f01){const _0x438089=a111_0x45ce,_0x446dcc=_0x4f58e9();while(!![]){try{const _0x4e7341=parseInt(_0x438089(0x193))/0x1*(-parseInt(_0x438089(0x16d))/0x2)+parseInt(_0x438089(0x1ac))/0x3*(parseInt(_0x438089(0x188))/0x4)+-parseInt(_0x438089(0x158))/0x5*(-parseInt(_0x438089(0x195))/0x6)+-parseInt(_0x438089(0x191))/0x7*(-parseInt(_0x438089(0x1d3))/0x8)+parseInt(_0x438089(0x1b6))/0x9*(parseInt(_0x438089(0x180))/0xa)+parseInt(_0x438089(0x1c6))/0xb+-parseInt(_0x438089(0x16f))/0xc;if(_0x4e7341===_0x222f01)break;else _0x446dcc['push'](_0x446dcc['shift']());}catch(_0x3df031){_0x446dcc['push'](_0x446dcc['shift']());}}}(a111_0x49ce,0xb8266));function a111_0x49ce(){const _0x594e9d=['gitUrl','send','GitBranchNotFoundError','gitProvider','updateRemoteState','toLowerCase','direction','prefix','\x20Checking\x20intersects.','name','TooManyRequests','5930snDFCq','\x22\x20branch:\x20\x22','Unable\x20to\x20synchronize\x20branch\x20\x27','../jobs/git-sync.job','../../providers/providers.tokens','setStatus','../../../../core/errors/too-many-requests.error','handleRecordSyncError','304vninYL','apply','search','Tokens','find','../../providers/web-hooks/hooks.utils','metadata','\x27\x20-\x20\x27','join','40649hGuzTT','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','2ZcTaGC',']\x20due\x20error\x20-\x20','48qFUaFL','\x20No\x20repositories\x20to\x20sync.','Service','GitSyncJob','BadRequestError','error','../../../../core','SyncService',']\x20repository\x20','hooks','function','SyncDirection','\x20Getting\x20Flosum\x20repository','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','gitRepoService','decorate','push','getBranchRecords','branchName','applicationUrl','../errors/git-branch-not-found.error','salesforceSync','__metadata','36201XDSriO','Waiting','repoService','salesforceService','object','setLoggerId','createHookPayload','../../../../core/errors/bad-request.error','__decorate','sfLogger','2628fxZvYD','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','REPOSITORY_NAME_REGEXP','repositoriesIntersections','log',']\x20branch.','../../../../constants','design:paramtypes','typedi','\x20Repository\x20\x22','isConvertToSfdx','test','../../salesforce/services/salesforce.service','getLoggerId','getAll','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','9870520sYxcEG','isBidirectionalSynchronization','\x27\x20[','repositoryId','gitApiService','FlosumSyncJob','SalesforceService','Logger','Not\x20Synchronized','\x20branches.','config','SalesforceError','disableSync','1128jdUpOE','Unable\x20to\x20synchronize\x20repository\x20\x27','348455hqidZa','../../../shared/utils','length','connectionId','logger','\x20Start\x20sync\x20job.','get','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','catch','../jobs/flosum-sync.job','\x27\x20in\x20repository\x20\x27','url','checkValidNaming','HooksUtils','Container','\x20Completed\x20prepare\x20to\x20syncing.','\x20Getting\x20repository\x20records.','getHookLinkFor','isIntersects','\x20Getting\x20repositories\x20from\x20git\x20service.','FlosumToGit','1146214jlfFBu','(((.+)+)+)+$','17560692fpHVYu','__esModule','create','run','repositoryName','Syncing\x20'];a111_0x49ce=function(){return _0x594e9d;};return a111_0x49ce();}function a111_0x45ce(_0x1d8885,_0x3856c3){const _0x5a4908=a111_0x49ce();return a111_0x45ce=function(_0x3e73a9,_0x1603b5){_0x3e73a9=_0x3e73a9-0x157;let _0x49ce0e=_0x5a4908[_0x3e73a9];return _0x49ce0e;},a111_0x45ce(_0x1d8885,_0x3856c3);}const a111_0x1603b5=(function(){let _0x5a182d=!![];return function(_0x2f2cfb,_0x3b6468){const _0x2e4a28=_0x5a182d?function(){const _0x4e55d0=a111_0x45ce;if(_0x3b6468){const _0x526ce0=_0x3b6468[_0x4e55d0(0x189)](_0x2f2cfb,arguments);return _0x3b6468=null,_0x526ce0;}}:function(){};return _0x5a182d=![],_0x2e4a28;};}()),a111_0x3e73a9=a111_0x1603b5(this,function(){const _0x33b412=a111_0x45ce;return a111_0x3e73a9['toString']()[_0x33b412(0x18a)](_0x33b412(0x16e))['toString']()['constructor'](a111_0x3e73a9)[_0x33b412(0x18a)](_0x33b412(0x16e));});a111_0x3e73a9();'use strict';var __decorate=this&&this[a111_0x585992(0x1b4)]||function(_0x33e138,_0x3ab493,_0x4effda,_0x5cf736){const _0x2e4633=a111_0x585992;var _0x3a0a23=arguments['length'],_0x32f760=_0x3a0a23<0x3?_0x3ab493:_0x5cf736===null?_0x5cf736=Object['getOwnPropertyDescriptor'](_0x3ab493,_0x4effda):_0x5cf736,_0x1d5c20;if(typeof Reflect===_0x2e4633(0x1b0)&&typeof Reflect[_0x2e4633(0x1a4)]==='function')_0x32f760=Reflect[_0x2e4633(0x1a4)](_0x33e138,_0x3ab493,_0x4effda,_0x5cf736);else{for(var _0x169f70=_0x33e138['length']-0x1;_0x169f70>=0x0;_0x169f70--)if(_0x1d5c20=_0x33e138[_0x169f70])_0x32f760=(_0x3a0a23<0x3?_0x1d5c20(_0x32f760):_0x3a0a23>0x3?_0x1d5c20(_0x3ab493,_0x4effda,_0x32f760):_0x1d5c20(_0x3ab493,_0x4effda))||_0x32f760;}return _0x3a0a23>0x3&&_0x32f760&&Object['defineProperty'](_0x3ab493,_0x4effda,_0x32f760),_0x32f760;},__metadata=this&&this[a111_0x585992(0x1ab)]||function(_0x2b0266,_0x3786d4){const _0x2f20f1=a111_0x585992;if(typeof Reflect===_0x2f20f1(0x1b0)&&typeof Reflect[_0x2f20f1(0x18e)]===_0x2f20f1(0x19f))return Reflect[_0x2f20f1(0x18e)](_0x2b0266,_0x3786d4);},SyncService_1;Object['defineProperty'](exports,a111_0x585992(0x170),{'value':!![]}),exports[a111_0x585992(0x19c)]=void 0x0;const constants_1=require(a111_0x585992(0x1bc)),core_1=require(a111_0x585992(0x19b)),too_many_requests_error_1=require(a111_0x585992(0x186)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a111_0x585992(0x1c2)),utils_1=require(a111_0x585992(0x159)),typedi_1=require(a111_0x585992(0x1be)),hooks_utils_1=require(a111_0x585992(0x18d)),git_branch_not_found_error_1=require(a111_0x585992(0x1a9)),flosum_sync_job_1=require(a111_0x585992(0x161)),git_sync_job_1=require(a111_0x585992(0x183)),providers_tokens_1=require(a111_0x585992(0x184)),bad_request_error_1=require(a111_0x585992(0x1b3));let SyncService=SyncService_1=class SyncService{constructor(_0x298708,_0x44140b){const _0x19904d=a111_0x585992;this[_0x19904d(0x1af)]=_0x298708,this[_0x19904d(0x1aa)]=_0x44140b,this[_0x19904d(0x15c)]=new core_1[(_0x19904d(0x1cd))](SyncService_1[_0x19904d(0x17e)]),this[_0x19904d(0x1b9)]={},this['repoList']=[];}async[a111_0x585992(0x187)](_0x467547,_0x5d6692){const _0x228e1a=a111_0x585992;if(_0x5d6692 instanceof git_branch_not_found_error_1[_0x228e1a(0x177)]){await this[_0x228e1a(0x1aa)][_0x228e1a(0x185)](_0x467547,_0x228e1a(0x1ce));return;}if(_0x5d6692 instanceof too_many_requests_error_1[_0x228e1a(0x17f)]){await this[_0x228e1a(0x1aa)][_0x228e1a(0x185)](_0x467547,_0x228e1a(0x1ad));throw _0x5d6692;}try{await this[_0x228e1a(0x1b5)]['error'](this[_0x228e1a(0x17c)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x467547[_0x228e1a(0x173)]+_0x228e1a(0x1c8)+_0x467547['branchName']+_0x228e1a(0x194)+_0x5d6692+'.')[_0x228e1a(0x176)](),await this[_0x228e1a(0x1aa)][_0x228e1a(0x179)](_0x467547,{}),await this[_0x228e1a(0x1aa)]['setStatus'](_0x467547,'Error');}catch(_0x4238b7){if(_0x4238b7 instanceof salesforce_error_1[_0x228e1a(0x1d1)])throw _0x4238b7;}}async[a111_0x585992(0x16a)](_0x1e3cd2){const _0x21ea9a=a111_0x585992;if(_0x1e3cd2[_0x21ea9a(0x1c9)]){const _0x5276a=_0x1e3cd2[_0x21ea9a(0x173)][_0x21ea9a(0x17a)](),_0x2a3d94=this[_0x21ea9a(0x1b9)][_0x5276a];if(!_0x2a3d94)this['repositoriesIntersections'][_0x5276a]=_0x1e3cd2['repositoryName'];else{if(_0x2a3d94&&_0x2a3d94!==_0x1e3cd2[_0x21ea9a(0x173)])return await this[_0x21ea9a(0x187)](_0x1e3cd2,new Error(_0x21ea9a(0x157)+_0x1e3cd2[_0x21ea9a(0x173)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x5276a+_0x21ea9a(0x18f)+_0x2a3d94+'\x27')),!![];}}return![];}async[a111_0x585992(0x164)](_0x48e283){const _0x475b09=a111_0x585992;if(!constants_1[_0x475b09(0x1b8)][_0x475b09(0x1c1)](_0x48e283[_0x475b09(0x173)]))return await this[_0x475b09(0x187)](_0x48e283,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x48e283[_0x475b09(0x173)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x475b09(0x1c1)](_0x48e283[_0x475b09(0x1a7)]))return await this[_0x475b09(0x187)](_0x48e283,new Error(_0x475b09(0x182)+_0x48e283[_0x475b09(0x1a7)]+_0x475b09(0x162)+_0x48e283[_0x475b09(0x173)]+_0x475b09(0x192))),![];return!![];}async['getOrCreateRepo'](_0x1ca86b,_0x1b20df){const _0x2c83fa=a111_0x585992;let _0x5bcb74=this['repoList'][_0x2c83fa(0x18c)](_0x13c1a5=>_0x1ca86b[_0x2c83fa(0x173)]===_0x13c1a5[_0x2c83fa(0x17e)]);!_0x5bcb74&&(this[_0x2c83fa(0x1b5)][_0x2c83fa(0x1ba)](this[_0x2c83fa(0x17c)]+_0x2c83fa(0x1bf)+_0x1ca86b[_0x2c83fa(0x173)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x5bcb74=await this[_0x2c83fa(0x1ae)][_0x2c83fa(0x171)]({'name':_0x1ca86b[_0x2c83fa(0x173)],'autoInit':!![],'defaultBranch':_0x1ca86b[_0x2c83fa(0x1a7)],'private':!![],'createHook':typedi_1[_0x2c83fa(0x166)][_0x2c83fa(0x15e)](providers_tokens_1['Tokens'][_0x2c83fa(0x1d0)])[_0x2c83fa(0x1c7)]}));if(this[_0x2c83fa(0x1d0)]['isBidirectionalSynchronization']){const _0x557684=await _0x5bcb74[_0x2c83fa(0x19e)][_0x2c83fa(0x1c4)]();!_0x557684['find'](_0x5729ac=>_0x5729ac[_0x2c83fa(0x163)]===hooks_utils_1['HooksUtils'][_0x2c83fa(0x169)](this['config'][_0x2c83fa(0x178)],this['config']['applicationUrl'],_0x1b20df))&&(this[_0x2c83fa(0x1b5)][_0x2c83fa(0x1ba)](this[_0x2c83fa(0x17c)]+'\x20Repository\x20\x22'+_0x1ca86b[_0x2c83fa(0x173)]+_0x2c83fa(0x1c5)),await _0x5bcb74['hooks'][_0x2c83fa(0x171)](hooks_utils_1[_0x2c83fa(0x165)][_0x2c83fa(0x1b2)](this[_0x2c83fa(0x1d0)][_0x2c83fa(0x178)],_0x5bcb74[_0x2c83fa(0x19e)],this[_0x2c83fa(0x1d0)][_0x2c83fa(0x1a8)],_0x1b20df)));}return this['repoList'][_0x2c83fa(0x1a5)](_0x5bcb74),_0x5bcb74;}async[a111_0x585992(0x172)](){const _0x6cafee=a111_0x585992;this[_0x6cafee(0x1ca)]=typedi_1[_0x6cafee(0x166)][_0x6cafee(0x15e)](providers_tokens_1[_0x6cafee(0x18b)][_0x6cafee(0x1ca)]),this[_0x6cafee(0x1ae)]=typedi_1['Container'][_0x6cafee(0x15e)](providers_tokens_1[_0x6cafee(0x18b)][_0x6cafee(0x1a3)]),this[_0x6cafee(0x1d0)]=typedi_1[_0x6cafee(0x166)][_0x6cafee(0x15e)](providers_tokens_1[_0x6cafee(0x18b)][_0x6cafee(0x1d0)]),this[_0x6cafee(0x1b5)]=typedi_1[_0x6cafee(0x166)][_0x6cafee(0x15e)](providers_tokens_1[_0x6cafee(0x18b)][_0x6cafee(0x15c)]),this[_0x6cafee(0x17c)]='['+SyncService_1[_0x6cafee(0x17e)]+']\x20['+this[_0x6cafee(0x1d0)][_0x6cafee(0x178)]['toUpperCase']()+']',this[_0x6cafee(0x1af)][_0x6cafee(0x1b1)](this['sfLogger'][_0x6cafee(0x1c3)]());try{this[_0x6cafee(0x1b5)][_0x6cafee(0x1ba)](this[_0x6cafee(0x17c)]+_0x6cafee(0x15d)),await this[_0x6cafee(0x1b5)][_0x6cafee(0x1ba)](this[_0x6cafee(0x17c)]+_0x6cafee(0x168))[_0x6cafee(0x176)]();const _0x20e4eb=await this[_0x6cafee(0x1aa)]['getRepositoryRecords'](typedi_1['Container'][_0x6cafee(0x15e)](providers_tokens_1[_0x6cafee(0x18b)][_0x6cafee(0x15b)]));if(!_0x20e4eb[_0x6cafee(0x15a)])throw new bad_request_error_1[(_0x6cafee(0x199))](this[_0x6cafee(0x17c)]+_0x6cafee(0x196));await this['sfLogger'][_0x6cafee(0x1ba)](this[_0x6cafee(0x17c)]+'\x20Getting\x20branch\x20records.')['send']();const _0x3989c6=await this['salesforceSync'][_0x6cafee(0x1a6)](_0x20e4eb['map'](_0x580f4b=>'\x27'+_0x580f4b[_0x6cafee(0x1c9)]+'\x27')[_0x6cafee(0x190)](','));await this['sfLogger'][_0x6cafee(0x1ba)](this[_0x6cafee(0x17c)]+_0x6cafee(0x16b))['send'](),this['repoList']=await this[_0x6cafee(0x1ae)][_0x6cafee(0x1c4)]();const _0xb3f562=[..._0x20e4eb,..._0x3989c6];this[_0x6cafee(0x1b5)]['log'](this['prefix']+'\x20Have\x20to\x20synchronize\x20'+_0xb3f562['length']+_0x6cafee(0x1cf));for(const _0x489dc0 of _0xb3f562){this[_0x6cafee(0x15c)][_0x6cafee(0x1ba)](_0x6cafee(0x174)+_0x489dc0['repositoryName']+'['+_0x489dc0[_0x6cafee(0x1c9)]+_0x6cafee(0x19d)+_0x489dc0[_0x6cafee(0x1a7)]+'['+_0x489dc0['branchId']+_0x6cafee(0x1bb)),this[_0x6cafee(0x1b5)][_0x6cafee(0x1ba)](this[_0x6cafee(0x17c)]+'\x20Syncing\x20repository:\x20\x22'+_0x489dc0['repositoryName']+_0x6cafee(0x181)+_0x489dc0[_0x6cafee(0x1a7)]+'\x22.'),this[_0x6cafee(0x1b5)][_0x6cafee(0x1ba)](this['prefix']+'\x20Checking\x20valid\x20name.');const _0x16f6ea=await this['checkValidNaming'](_0x489dc0);if(!_0x16f6ea)continue;this['sfLogger'][_0x6cafee(0x1ba)](this['prefix']+_0x6cafee(0x17d));const _0x5006ca=await this['isIntersects'](_0x489dc0);if(_0x5006ca)continue;await this[_0x6cafee(0x1b5)]['send']();let _0x167baa;try{await this[_0x6cafee(0x1b5)]['log'](this[_0x6cafee(0x17c)]+_0x6cafee(0x1a1))[_0x6cafee(0x176)](),_0x167baa=await this['getOrCreateRepo'](_0x489dc0,typedi_1[_0x6cafee(0x166)][_0x6cafee(0x15e)](providers_tokens_1[_0x6cafee(0x18b)][_0x6cafee(0x15b)]));}catch(_0x113e26){await this[_0x6cafee(0x187)](_0x489dc0,_0x113e26 instanceof too_many_requests_error_1['TooManyRequests']?_0x113e26:new Error(_0x6cafee(0x15f)+_0x113e26));continue;}await this[_0x6cafee(0x1b5)][_0x6cafee(0x1ba)](this['prefix']+_0x6cafee(0x167))['send']();if(_0x489dc0[_0x6cafee(0x17b)]===flosum_repository_sync_dto_1[_0x6cafee(0x1a0)][_0x6cafee(0x16c)]){const _0x42af2a=typedi_1[_0x6cafee(0x166)][_0x6cafee(0x15e)](flosum_sync_job_1[_0x6cafee(0x1cb)]);await _0x42af2a['run']({'repository':_0x167baa,'convertToSFDX':this[_0x6cafee(0x1d0)][_0x6cafee(0x1c0)],'syncRecord':_0x489dc0,'provider':this[_0x6cafee(0x1d0)][_0x6cafee(0x178)]})[_0x6cafee(0x160)](_0x3b9299=>this[_0x6cafee(0x187)](_0x489dc0,_0x3b9299));}else{const _0x694387=typedi_1['Container'][_0x6cafee(0x15e)](git_sync_job_1[_0x6cafee(0x198)]);await _0x694387[_0x6cafee(0x172)]({'repository':_0x167baa,'branch':_0x489dc0[_0x6cafee(0x1a7)],'provider':this[_0x6cafee(0x1d0)][_0x6cafee(0x178)],'repositoryGit':_0x167baa[_0x6cafee(0x175)],'syncRecord':_0x489dc0})[_0x6cafee(0x160)](_0x584d2a=>this[_0x6cafee(0x187)](_0x489dc0,_0x584d2a));}}}catch(_0x3898ef){this['logger']['error'](_0x3898ef);_0x3898ef instanceof too_many_requests_error_1[_0x6cafee(0x17f)]?(await this[_0x6cafee(0x1b5)][_0x6cafee(0x1ba)](this['prefix']+_0x6cafee(0x1a2))[_0x6cafee(0x176)](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0x6cafee(0x172)]()):await this[_0x6cafee(0x1b5)][_0x6cafee(0x19a)](this['prefix']+_0x6cafee(0x1b7)+_0x3898ef)[_0x6cafee(0x176)]();return;}await this[_0x6cafee(0x1b5)][_0x6cafee(0x1ba)](this[_0x6cafee(0x17c)]+'\x20Sync\x20job\x20done.')['send'](),await this['salesforceSync'][_0x6cafee(0x1d2)](typedi_1[_0x6cafee(0x166)][_0x6cafee(0x15e)](providers_tokens_1[_0x6cafee(0x18b)][_0x6cafee(0x15b)]))['catch'](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x585992(0x197)])({'transient':!![]}),__metadata(a111_0x585992(0x1bd),[salesforce_service_1[a111_0x585992(0x1cc)],salesforce_sync_service_1['SalesforceSyncService']])],SyncService),exports[a111_0x585992(0x19c)]=SyncService;