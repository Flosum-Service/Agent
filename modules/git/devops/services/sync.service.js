const a80_0x111491=a80_0x50c9;(function(_0x21ba16,_0x4eba5c){const _0x12762c=a80_0x50c9,_0xcab852=_0x21ba16();while(!![]){try{const _0x5d8898=-parseInt(_0x12762c(0x1c8))/0x1*(parseInt(_0x12762c(0x1d9))/0x2)+-parseInt(_0x12762c(0x1d3))/0x3+parseInt(_0x12762c(0x1c0))/0x4+parseInt(_0x12762c(0x1de))/0x5*(-parseInt(_0x12762c(0x1c9))/0x6)+parseInt(_0x12762c(0x209))/0x7*(-parseInt(_0x12762c(0x1fe))/0x8)+parseInt(_0x12762c(0x213))/0x9*(-parseInt(_0x12762c(0x1c4))/0xa)+parseInt(_0x12762c(0x1b9))/0xb;if(_0x5d8898===_0x4eba5c)break;else _0xcab852['push'](_0xcab852['shift']());}catch(_0x3ee394){_0xcab852['push'](_0xcab852['shift']());}}}(a80_0x20a1,0x77833));const a80_0x5d0fb1=(function(){let _0x24e537=!![];return function(_0x22f421,_0x8cc946){const _0x26a729=_0x24e537?function(){const _0x5ab2c7=a80_0x50c9;if(_0x8cc946){const _0x302f85=_0x8cc946[_0x5ab2c7(0x1bd)](_0x22f421,arguments);return _0x8cc946=null,_0x302f85;}}:function(){};return _0x24e537=![],_0x26a729;};}()),a80_0x501ed8=a80_0x5d0fb1(this,function(){const _0x2ee1ab=a80_0x50c9;return a80_0x501ed8['toString']()[_0x2ee1ab(0x1e2)](_0x2ee1ab(0x205))['toString']()[_0x2ee1ab(0x21b)](a80_0x501ed8)[_0x2ee1ab(0x1e2)](_0x2ee1ab(0x205));});a80_0x501ed8();'use strict';function a80_0x50c9(_0x53fdcd,_0x5a6a5c){const _0x15a763=a80_0x20a1();return a80_0x50c9=function(_0x501ed8,_0x5d0fb1){_0x501ed8=_0x501ed8-0x1b1;let _0x20a18a=_0x15a763[_0x501ed8];return _0x20a18a;},a80_0x50c9(_0x53fdcd,_0x5a6a5c);}var __decorate=this&&this[a80_0x111491(0x20e)]||function(_0x22bdef,_0x2e21f0,_0x5d4c9c,_0x61df6c){const _0x531ed6=a80_0x111491;var _0x204558=arguments[_0x531ed6(0x210)],_0x573262=_0x204558<0x3?_0x2e21f0:_0x61df6c===null?_0x61df6c=Object['getOwnPropertyDescriptor'](_0x2e21f0,_0x5d4c9c):_0x61df6c,_0x28fdac;if(typeof Reflect===_0x531ed6(0x217)&&typeof Reflect['decorate']==='function')_0x573262=Reflect['decorate'](_0x22bdef,_0x2e21f0,_0x5d4c9c,_0x61df6c);else{for(var _0x1bb4d0=_0x22bdef[_0x531ed6(0x210)]-0x1;_0x1bb4d0>=0x0;_0x1bb4d0--)if(_0x28fdac=_0x22bdef[_0x1bb4d0])_0x573262=(_0x204558<0x3?_0x28fdac(_0x573262):_0x204558>0x3?_0x28fdac(_0x2e21f0,_0x5d4c9c,_0x573262):_0x28fdac(_0x2e21f0,_0x5d4c9c))||_0x573262;}return _0x204558>0x3&&_0x573262&&Object[_0x531ed6(0x1f5)](_0x2e21f0,_0x5d4c9c,_0x573262),_0x573262;},__metadata=this&&this['__metadata']||function(_0x3dfc28,_0x327040){const _0x578744=a80_0x111491;if(typeof Reflect===_0x578744(0x217)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x3dfc28,_0x327040);},SyncService_1;Object[a80_0x111491(0x1f5)](exports,a80_0x111491(0x1d8),{'value':!![]}),exports['SyncService']=void 0x0;function a80_0x20a1(){const _0x5282f6=['1402910Zonnrn','\x27\x20[','gitApiService','\x20Checking\x20intersects.','search','SalesforceSyncService','../../salesforce/services/salesforce.service','setStatus','GitSyncJob','hooks','isConvertToSfdx','prefix','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','error','Tokens','\x20Getting\x20Flosum\x20repository','HooksUtils','getRepositoryRecords','\x20No\x20repositories\x20to\x20sync.','test','../jobs/git-sync.job','\x20Start\x20sync\x20job.','applicationUrl','defineProperty','getOrCreateRepo','repositoryName','catch','\x20Getting\x20repositories\x20from\x20git\x20service.','name','getHookLinkFor','\x20branches.','Unable\x20to\x20synchronize\x20repository\x20\x27','7774904NGgJxp','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','Not\x20Synchronized','find','Syncing\x20','BRANCH_NAME_REGEXP','../errors/git-branch-not-found.error','(((.+)+)+)+$','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','Logger','Container','7weikrb','typedi','repositoriesIntersections','Waiting','salesforceService','__decorate','handleRecordSyncError','length','sleep','../../../../core/errors/too-many-requests.error','1098LcAcNC','logger','Unable\x20to\x20synchronize\x20branch\x20\x27','run','object',']\x20[','create','../jobs/flosum-sync.job','constructor','isBidirectionalSynchronization','../../../../core/errors/bad-request.error','\x20Repository\x20\x22','TooManyRequests','BadRequestError','map','GitBranchNotFoundError','getLoggerId','26597054gBMfWe','repositoryId','../../salesforce/dto/flosum-repository-sync.dto','repoService','apply','checkValidNaming','branchName','2208980KlhmnN','gitProvider','FlosumSyncJob','../../providers/providers.tokens','9710fNlzHR','SalesforceError','sfLogger','\x27\x20in\x20repository\x20\x27','1CYfLgY','6VZpKOA','join','send','Error','connectionId','config','updateRemoteState','getAll','salesforceSync','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','2784540vylDqE','design:paramtypes','repoList','\x20Have\x20to\x20synchronize\x20','toUpperCase','__esModule','363098zXvBdh','disableSync','branchId','get','log'];a80_0x20a1=function(){return _0x5282f6;};return a80_0x20a1();}const constants_1=require('../../../../constants'),core_1=require('../../../../core'),too_many_requests_error_1=require(a80_0x111491(0x212)),flosum_repository_sync_dto_1=require(a80_0x111491(0x1bb)),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a80_0x111491(0x1e4)),utils_1=require('../../../shared/utils'),typedi_1=require(a80_0x111491(0x20a)),hooks_utils_1=require('../../providers/web-hooks/hooks.utils'),git_branch_not_found_error_1=require(a80_0x111491(0x204)),flosum_sync_job_1=require(a80_0x111491(0x21a)),git_sync_job_1=require(a80_0x111491(0x1f2)),providers_tokens_1=require(a80_0x111491(0x1c3)),bad_request_error_1=require(a80_0x111491(0x1b2));let SyncService=SyncService_1=class SyncService{constructor(_0x33cb03,_0x4afda2){const _0xf3696c=a80_0x111491;this['salesforceService']=_0x33cb03,this[_0xf3696c(0x1d1)]=_0x4afda2,this[_0xf3696c(0x214)]=new core_1[(_0xf3696c(0x207))](SyncService_1[_0xf3696c(0x1fa)]),this[_0xf3696c(0x20b)]={},this[_0xf3696c(0x1d5)]=[];}async['handleRecordSyncError'](_0x2dc2da,_0x4d97fd){const _0x386e48=a80_0x111491;if(_0x4d97fd instanceof git_branch_not_found_error_1[_0x386e48(0x1b7)]){await this[_0x386e48(0x1d1)]['setStatus'](_0x2dc2da,_0x386e48(0x200));return;}if(_0x4d97fd instanceof too_many_requests_error_1['TooManyRequests']){await this['salesforceSync'][_0x386e48(0x1e5)](_0x2dc2da,_0x386e48(0x20c));throw _0x4d97fd;}try{await this[_0x386e48(0x1c6)][_0x386e48(0x1eb)](this[_0x386e48(0x1e9)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x2dc2da['repositoryName']+_0x386e48(0x1df)+_0x2dc2da[_0x386e48(0x1bf)]+']\x20due\x20error\x20-\x20'+_0x4d97fd+'.')[_0x386e48(0x1cb)](),await this[_0x386e48(0x1d1)][_0x386e48(0x1cf)](_0x2dc2da,{}),await this[_0x386e48(0x1d1)][_0x386e48(0x1e5)](_0x2dc2da,_0x386e48(0x1cc));}catch(_0xf751a8){if(_0xf751a8 instanceof salesforce_error_1[_0x386e48(0x1c5)])throw _0xf751a8;}}async['isIntersects'](_0x5d89dc){const _0x3a9fc7=a80_0x111491;if(_0x5d89dc['repositoryId']){const _0x3ba3ba=_0x5d89dc['repositoryName']['toLowerCase'](),_0x2ecded=this[_0x3a9fc7(0x20b)][_0x3ba3ba];if(!_0x2ecded)this['repositoriesIntersections'][_0x3ba3ba]=_0x5d89dc[_0x3a9fc7(0x1f7)];else{if(_0x2ecded&&_0x2ecded!==_0x5d89dc['repositoryName'])return await this[_0x3a9fc7(0x20f)](_0x5d89dc,new Error(_0x3a9fc7(0x1fd)+_0x5d89dc[_0x3a9fc7(0x1f7)]+_0x3a9fc7(0x1ea)+_0x3ba3ba+'\x27\x20-\x20\x27'+_0x2ecded+'\x27')),!![];}}return![];}async[a80_0x111491(0x1be)](_0x192a02){const _0x155d4e=a80_0x111491;if(!constants_1['REPOSITORY_NAME_REGEXP'][_0x155d4e(0x1f1)](_0x192a02[_0x155d4e(0x1f7)]))return await this[_0x155d4e(0x20f)](_0x192a02,new Error(_0x155d4e(0x1fd)+_0x192a02[_0x155d4e(0x1f7)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x155d4e(0x203)][_0x155d4e(0x1f1)](_0x192a02[_0x155d4e(0x1bf)]))return await this[_0x155d4e(0x20f)](_0x192a02,new Error(_0x155d4e(0x215)+_0x192a02[_0x155d4e(0x1bf)]+_0x155d4e(0x1c7)+_0x192a02[_0x155d4e(0x1f7)]+_0x155d4e(0x206))),![];return!![];}async[a80_0x111491(0x1f6)](_0x2f065a,_0x2c6726){const _0x3eeb31=a80_0x111491;let _0x458efc=this['repoList'][_0x3eeb31(0x201)](_0x312c9c=>_0x2f065a[_0x3eeb31(0x1f7)]===_0x312c9c['name']);!_0x458efc&&(this['sfLogger'][_0x3eeb31(0x1dd)](this['prefix']+_0x3eeb31(0x1b3)+_0x2f065a[_0x3eeb31(0x1f7)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x458efc=await this[_0x3eeb31(0x1bc)][_0x3eeb31(0x219)]({'name':_0x2f065a[_0x3eeb31(0x1f7)],'autoInit':!![],'defaultBranch':_0x2f065a[_0x3eeb31(0x1bf)],'private':!![],'createHook':typedi_1['Container'][_0x3eeb31(0x1dc)](providers_tokens_1[_0x3eeb31(0x1ec)][_0x3eeb31(0x1ce)])['isBidirectionalSynchronization']}));if(this[_0x3eeb31(0x1ce)][_0x3eeb31(0x1b1)]){const _0x2c9e82=await _0x458efc['hooks'][_0x3eeb31(0x1d0)]();!_0x2c9e82[_0x3eeb31(0x201)](_0x315223=>_0x315223['url']===hooks_utils_1[_0x3eeb31(0x1ee)][_0x3eeb31(0x1fb)](this[_0x3eeb31(0x1ce)][_0x3eeb31(0x1c1)],this[_0x3eeb31(0x1ce)][_0x3eeb31(0x1f4)],_0x2c6726))&&(this[_0x3eeb31(0x1c6)][_0x3eeb31(0x1dd)](this[_0x3eeb31(0x1e9)]+_0x3eeb31(0x1b3)+_0x2f065a[_0x3eeb31(0x1f7)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x458efc['hooks'][_0x3eeb31(0x219)](hooks_utils_1[_0x3eeb31(0x1ee)]['createHookPayload'](this[_0x3eeb31(0x1ce)][_0x3eeb31(0x1c1)],_0x458efc[_0x3eeb31(0x1e7)],this['config'][_0x3eeb31(0x1f4)],_0x2c6726)));}return this[_0x3eeb31(0x1d5)]['push'](_0x458efc),_0x458efc;}async['run'](){const _0x480db8=a80_0x111491;this[_0x480db8(0x1e0)]=typedi_1[_0x480db8(0x208)][_0x480db8(0x1dc)](providers_tokens_1[_0x480db8(0x1ec)][_0x480db8(0x1e0)]),this[_0x480db8(0x1bc)]=typedi_1[_0x480db8(0x208)][_0x480db8(0x1dc)](providers_tokens_1[_0x480db8(0x1ec)]['gitRepoService']),this['config']=typedi_1[_0x480db8(0x208)]['get'](providers_tokens_1[_0x480db8(0x1ec)][_0x480db8(0x1ce)]),this[_0x480db8(0x1c6)]=typedi_1['Container']['get'](providers_tokens_1[_0x480db8(0x1ec)]['logger']),this[_0x480db8(0x1e9)]='['+SyncService_1[_0x480db8(0x1fa)]+_0x480db8(0x218)+this[_0x480db8(0x1ce)][_0x480db8(0x1c1)][_0x480db8(0x1d7)]()+']',this[_0x480db8(0x20d)]['setLoggerId'](this[_0x480db8(0x1c6)][_0x480db8(0x1b8)]());try{this[_0x480db8(0x1c6)][_0x480db8(0x1dd)](this['prefix']+_0x480db8(0x1f3)),await this['sfLogger'][_0x480db8(0x1dd)](this[_0x480db8(0x1e9)]+'\x20Getting\x20repository\x20records.')[_0x480db8(0x1cb)]();const _0x35af2b=await this[_0x480db8(0x1d1)][_0x480db8(0x1ef)](typedi_1[_0x480db8(0x208)]['get'](providers_tokens_1['Tokens'][_0x480db8(0x1cd)]));if(!_0x35af2b[_0x480db8(0x210)])throw new bad_request_error_1[(_0x480db8(0x1b5))](this[_0x480db8(0x1e9)]+_0x480db8(0x1f0));await this['sfLogger'][_0x480db8(0x1dd)](this[_0x480db8(0x1e9)]+'\x20Getting\x20branch\x20records.')['send']();const _0x560789=await this[_0x480db8(0x1d1)]['getBranchRecords'](_0x35af2b[_0x480db8(0x1b6)](_0x5b4066=>'\x27'+_0x5b4066[_0x480db8(0x1ba)]+'\x27')[_0x480db8(0x1ca)](','));await this[_0x480db8(0x1c6)][_0x480db8(0x1dd)](this[_0x480db8(0x1e9)]+_0x480db8(0x1f9))[_0x480db8(0x1cb)](),this['repoList']=await this[_0x480db8(0x1bc)]['getAll']();const _0xdae922=[..._0x35af2b,..._0x560789];this[_0x480db8(0x1c6)]['log'](this['prefix']+_0x480db8(0x1d6)+_0xdae922[_0x480db8(0x210)]+_0x480db8(0x1fc));for(const _0x476a44 of _0xdae922){this[_0x480db8(0x214)][_0x480db8(0x1dd)](_0x480db8(0x202)+_0x476a44['repositoryName']+'['+_0x476a44['repositoryId']+']\x20repository\x20'+_0x476a44[_0x480db8(0x1bf)]+'['+_0x476a44[_0x480db8(0x1db)]+']\x20branch.'),this[_0x480db8(0x1c6)]['log'](this['prefix']+'\x20Syncing\x20repository:\x20\x22'+_0x476a44[_0x480db8(0x1f7)]+'\x22\x20branch:\x20\x22'+_0x476a44[_0x480db8(0x1bf)]+'\x22.'),this['sfLogger'][_0x480db8(0x1dd)](this['prefix']+'\x20Checking\x20valid\x20name.');const _0x2b173d=await this[_0x480db8(0x1be)](_0x476a44);if(!_0x2b173d)continue;this[_0x480db8(0x1c6)][_0x480db8(0x1dd)](this['prefix']+_0x480db8(0x1e1));const _0x290c02=await this['isIntersects'](_0x476a44);if(_0x290c02)continue;await this['sfLogger'][_0x480db8(0x1cb)]();let _0x1cc3c0;try{await this[_0x480db8(0x1c6)][_0x480db8(0x1dd)](this[_0x480db8(0x1e9)]+_0x480db8(0x1ed))[_0x480db8(0x1cb)](),_0x1cc3c0=await this[_0x480db8(0x1f6)](_0x476a44,typedi_1[_0x480db8(0x208)][_0x480db8(0x1dc)](providers_tokens_1[_0x480db8(0x1ec)][_0x480db8(0x1cd)]));}catch(_0x37daae){await this[_0x480db8(0x20f)](_0x476a44,_0x37daae instanceof too_many_requests_error_1[_0x480db8(0x1b4)]?_0x37daae:new Error(_0x480db8(0x1d2)+_0x37daae));continue;}await this['sfLogger']['log'](this['prefix']+'\x20Completed\x20prepare\x20to\x20syncing.')[_0x480db8(0x1cb)]();if(_0x476a44['direction']===flosum_repository_sync_dto_1['SyncDirection']['FlosumToGit']){const _0x1a90a8=typedi_1[_0x480db8(0x208)][_0x480db8(0x1dc)](flosum_sync_job_1[_0x480db8(0x1c2)]);await _0x1a90a8[_0x480db8(0x216)]({'repository':_0x1cc3c0,'convertToSFDX':this[_0x480db8(0x1ce)][_0x480db8(0x1e8)],'syncRecord':_0x476a44,'provider':this['config'][_0x480db8(0x1c1)]})[_0x480db8(0x1f8)](_0x23e8eb=>this[_0x480db8(0x20f)](_0x476a44,_0x23e8eb));}else{const _0xe0501c=typedi_1[_0x480db8(0x208)]['get'](git_sync_job_1[_0x480db8(0x1e6)]);await _0xe0501c['run']({'repository':_0x1cc3c0,'branch':_0x476a44[_0x480db8(0x1bf)],'provider':this['config']['gitProvider'],'repositoryGit':_0x1cc3c0['gitUrl'],'syncRecord':_0x476a44})[_0x480db8(0x1f8)](_0x274c97=>this[_0x480db8(0x20f)](_0x476a44,_0x274c97));}}}catch(_0x17b04d){this[_0x480db8(0x214)]['error'](_0x17b04d);_0x17b04d instanceof too_many_requests_error_1[_0x480db8(0x1b4)]?(await this['sfLogger']['log'](this[_0x480db8(0x1e9)]+_0x480db8(0x1ff))[_0x480db8(0x1cb)](),await(0x0,utils_1[_0x480db8(0x211)])(0x3c*0x3c*0x3e8),this[_0x480db8(0x216)]()):await this['sfLogger'][_0x480db8(0x1eb)](this[_0x480db8(0x1e9)]+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x17b04d)[_0x480db8(0x1cb)]();return;}await this['sfLogger'][_0x480db8(0x1dd)](this[_0x480db8(0x1e9)]+'\x20Sync\x20job\x20done.')[_0x480db8(0x1cb)](),await this[_0x480db8(0x1d1)][_0x480db8(0x1da)](typedi_1['Container'][_0x480db8(0x1dc)](providers_tokens_1[_0x480db8(0x1ec)][_0x480db8(0x1cd)]))[_0x480db8(0x1f8)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a80_0x111491(0x1d4),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a80_0x111491(0x1e3)]])],SyncService),exports['SyncService']=SyncService;