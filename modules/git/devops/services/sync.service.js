const a111_0x55d973=a111_0x3667;(function(_0x46a221,_0x53804a){const _0x4dbd9a=a111_0x3667,_0x14e781=_0x46a221();while(!![]){try{const _0x2a72e0=-parseInt(_0x4dbd9a(0x1f2))/0x1+parseInt(_0x4dbd9a(0x1dd))/0x2+parseInt(_0x4dbd9a(0x1ee))/0x3*(parseInt(_0x4dbd9a(0x206))/0x4)+parseInt(_0x4dbd9a(0x1fe))/0x5+-parseInt(_0x4dbd9a(0x1d0))/0x6*(parseInt(_0x4dbd9a(0x207))/0x7)+parseInt(_0x4dbd9a(0x1da))/0x8+-parseInt(_0x4dbd9a(0x221))/0x9*(-parseInt(_0x4dbd9a(0x1e0))/0xa);if(_0x2a72e0===_0x53804a)break;else _0x14e781['push'](_0x14e781['shift']());}catch(_0x4a2118){_0x14e781['push'](_0x14e781['shift']());}}}(a111_0xb63e,0x2d452));const a111_0xdb87a5=(function(){let _0x2d36d0=!![];return function(_0x18b756,_0x16c87b){const _0x3b24d6=_0x2d36d0?function(){const _0x5245f7=a111_0x3667;if(_0x16c87b){const _0x5e81d0=_0x16c87b[_0x5245f7(0x1d5)](_0x18b756,arguments);return _0x16c87b=null,_0x5e81d0;}}:function(){};return _0x2d36d0=![],_0x3b24d6;};}()),a111_0x32cb60=a111_0xdb87a5(this,function(){const _0x27b04a=a111_0x3667;return a111_0x32cb60[_0x27b04a(0x22a)]()['search'](_0x27b04a(0x208))[_0x27b04a(0x22a)]()['constructor'](a111_0x32cb60)['search'](_0x27b04a(0x208));});a111_0x32cb60();'use strict';var __decorate=this&&this[a111_0x55d973(0x1bb)]||function(_0x50d5f9,_0x5edcba,_0xd1b715,_0x1dc573){const _0x3ac429=a111_0x55d973;var _0x5d7b64=arguments[_0x3ac429(0x1cd)],_0x3cef0d=_0x5d7b64<0x3?_0x5edcba:_0x1dc573===null?_0x1dc573=Object[_0x3ac429(0x21b)](_0x5edcba,_0xd1b715):_0x1dc573,_0x5994b1;if(typeof Reflect===_0x3ac429(0x20b)&&typeof Reflect[_0x3ac429(0x211)]===_0x3ac429(0x230))_0x3cef0d=Reflect[_0x3ac429(0x211)](_0x50d5f9,_0x5edcba,_0xd1b715,_0x1dc573);else{for(var _0x439b53=_0x50d5f9[_0x3ac429(0x1cd)]-0x1;_0x439b53>=0x0;_0x439b53--)if(_0x5994b1=_0x50d5f9[_0x439b53])_0x3cef0d=(_0x5d7b64<0x3?_0x5994b1(_0x3cef0d):_0x5d7b64>0x3?_0x5994b1(_0x5edcba,_0xd1b715,_0x3cef0d):_0x5994b1(_0x5edcba,_0xd1b715))||_0x3cef0d;}return _0x5d7b64>0x3&&_0x3cef0d&&Object[_0x3ac429(0x1ba)](_0x5edcba,_0xd1b715,_0x3cef0d),_0x3cef0d;},__metadata=this&&this['__metadata']||function(_0x20d295,_0x1ffb1c){const _0xaadf5e=a111_0x55d973;if(typeof Reflect===_0xaadf5e(0x20b)&&typeof Reflect[_0xaadf5e(0x1f7)]===_0xaadf5e(0x230))return Reflect[_0xaadf5e(0x1f7)](_0x20d295,_0x1ffb1c);},SyncService_1;Object[a111_0x55d973(0x1ba)](exports,a111_0x55d973(0x220),{'value':!![]}),exports['SyncService']=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a111_0x55d973(0x22e)),too_many_requests_error_1=require('../../../../core/errors/too-many-requests.error'),flosum_repository_sync_dto_1=require(a111_0x55d973(0x1ce)),salesforce_error_1=require(a111_0x55d973(0x213)),salesforce_sync_service_1=require(a111_0x55d973(0x1e5)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),utils_1=require(a111_0x55d973(0x1f6)),typedi_1=require('typedi'),hooks_utils_1=require(a111_0x55d973(0x1c3)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require(a111_0x55d973(0x228)),git_sync_job_1=require(a111_0x55d973(0x222)),providers_tokens_1=require(a111_0x55d973(0x226)),bad_request_error_1=require('../../../../core/errors/bad-request.error');let SyncService=SyncService_1=class SyncService{constructor(_0x5a5b72,_0x274513){const _0x36eba4=a111_0x55d973;this[_0x36eba4(0x20f)]=_0x5a5b72,this['salesforceSync']=_0x274513,this['logger']=new core_1[(_0x36eba4(0x1f8))](SyncService_1[_0x36eba4(0x1dc)]),this['repositoriesIntersections']={},this['repoList']=[];}async['handleRecordSyncError'](_0x5ab4b2,_0x4ba774){const _0x2a017d=a111_0x55d973;if(_0x4ba774 instanceof git_branch_not_found_error_1['GitBranchNotFoundError']){await this['salesforceSync'][_0x2a017d(0x1ca)](_0x5ab4b2,_0x2a017d(0x225));return;}if(_0x4ba774 instanceof too_many_requests_error_1[_0x2a017d(0x1d4)]){await this[_0x2a017d(0x1c4)][_0x2a017d(0x1ca)](_0x5ab4b2,'Waiting');throw _0x4ba774;}try{await this[_0x2a017d(0x212)][_0x2a017d(0x1e9)](this[_0x2a017d(0x217)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x5ab4b2[_0x2a017d(0x218)]+'\x27\x20['+_0x5ab4b2['branchName']+']\x20due\x20error\x20-\x20'+_0x4ba774+'.')[_0x2a017d(0x216)](),await this[_0x2a017d(0x1c4)][_0x2a017d(0x1e1)](_0x5ab4b2,{}),await this[_0x2a017d(0x1c4)]['setStatus'](_0x5ab4b2,'Error');}catch(_0x5885d2){if(_0x5885d2 instanceof salesforce_error_1['SalesforceError'])throw _0x5885d2;}}async[a111_0x55d973(0x1ff)](_0x104b07){const _0xe54891=a111_0x55d973;if(_0x104b07[_0xe54891(0x1c2)]){const _0x35a961=_0x104b07[_0xe54891(0x218)][_0xe54891(0x201)](),_0x2825fa=this['repositoriesIntersections'][_0x35a961];if(!_0x2825fa)this[_0xe54891(0x21e)][_0x35a961]=_0x104b07['repositoryName'];else{if(_0x2825fa&&_0x2825fa!==_0x104b07[_0xe54891(0x218)])return await this[_0xe54891(0x21d)](_0x104b07,new Error(_0xe54891(0x1c1)+_0x104b07[_0xe54891(0x218)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x35a961+_0xe54891(0x1ea)+_0x2825fa+'\x27')),!![];}}return![];}async[a111_0x55d973(0x223)](_0x43ad8e){const _0x4181e2=a111_0x55d973;if(!constants_1['REPOSITORY_NAME_REGEXP'][_0x4181e2(0x1f3)](_0x43ad8e[_0x4181e2(0x218)]))return await this[_0x4181e2(0x21d)](_0x43ad8e,new Error(_0x4181e2(0x1c1)+_0x43ad8e[_0x4181e2(0x218)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x4181e2(0x1eb)][_0x4181e2(0x1f3)](_0x43ad8e[_0x4181e2(0x204)]))return await this[_0x4181e2(0x21d)](_0x43ad8e,new Error(_0x4181e2(0x1e2)+_0x43ad8e['branchName']+_0x4181e2(0x1c7)+_0x43ad8e[_0x4181e2(0x218)]+_0x4181e2(0x1cc))),![];return!![];}async[a111_0x55d973(0x1ed)](_0x123261,_0x49bdc5){const _0x436334=a111_0x55d973;let _0x2927cb=this[_0x436334(0x1f9)][_0x436334(0x1f4)](_0x4157f8=>_0x123261[_0x436334(0x218)]===_0x4157f8[_0x436334(0x1dc)]);!_0x2927cb&&(this[_0x436334(0x212)]['log'](this[_0x436334(0x217)]+_0x436334(0x227)+_0x123261[_0x436334(0x218)]+_0x436334(0x1db)),_0x2927cb=await this[_0x436334(0x20a)][_0x436334(0x1d8)]({'name':_0x123261['repositoryName'],'autoInit':!![],'defaultBranch':_0x123261[_0x436334(0x204)],'private':!![],'createHook':typedi_1[_0x436334(0x20d)][_0x436334(0x1c0)](providers_tokens_1[_0x436334(0x214)][_0x436334(0x1fc)])[_0x436334(0x21c)]}));if(this[_0x436334(0x1fc)]['isBidirectionalSynchronization']){const _0x44c2c1=await _0x2927cb['hooks'][_0x436334(0x231)]();!_0x44c2c1[_0x436334(0x1f4)](_0x4492f4=>_0x4492f4['url']===hooks_utils_1['HooksUtils'][_0x436334(0x21a)](this[_0x436334(0x1fc)]['gitProvider'],this[_0x436334(0x1fc)][_0x436334(0x215)],_0x49bdc5))&&(this[_0x436334(0x212)][_0x436334(0x22d)](this[_0x436334(0x217)]+_0x436334(0x227)+_0x123261[_0x436334(0x218)]+_0x436334(0x1b9)),await _0x2927cb['hooks'][_0x436334(0x1d8)](hooks_utils_1[_0x436334(0x1fb)][_0x436334(0x202)](this[_0x436334(0x1fc)][_0x436334(0x1bf)],_0x2927cb[_0x436334(0x205)],this['config'][_0x436334(0x215)],_0x49bdc5)));}return this['repoList']['push'](_0x2927cb),_0x2927cb;}async[a111_0x55d973(0x1d9)](){const _0x184c27=a111_0x55d973;this[_0x184c27(0x219)]=typedi_1[_0x184c27(0x20d)][_0x184c27(0x1c0)](providers_tokens_1[_0x184c27(0x214)][_0x184c27(0x219)]),this[_0x184c27(0x20a)]=typedi_1[_0x184c27(0x20d)][_0x184c27(0x1c0)](providers_tokens_1[_0x184c27(0x214)][_0x184c27(0x1f1)]),this[_0x184c27(0x1fc)]=typedi_1[_0x184c27(0x20d)][_0x184c27(0x1c0)](providers_tokens_1[_0x184c27(0x214)][_0x184c27(0x1fc)]),this[_0x184c27(0x212)]=typedi_1[_0x184c27(0x20d)]['get'](providers_tokens_1['Tokens'][_0x184c27(0x22c)]),this['prefix']='['+SyncService_1[_0x184c27(0x1dc)]+_0x184c27(0x1bd)+this['config'][_0x184c27(0x1bf)][_0x184c27(0x1cf)]()+']',this['salesforceService']['setLoggerId'](this[_0x184c27(0x212)][_0x184c27(0x200)]());try{this['sfLogger'][_0x184c27(0x22d)](this[_0x184c27(0x217)]+_0x184c27(0x1c6)),await this[_0x184c27(0x212)][_0x184c27(0x22d)](this[_0x184c27(0x217)]+_0x184c27(0x1fd))[_0x184c27(0x216)]();const _0x23800b=await this[_0x184c27(0x1c4)]['getRepositoryRecords'](typedi_1[_0x184c27(0x20d)][_0x184c27(0x1c0)](providers_tokens_1[_0x184c27(0x214)][_0x184c27(0x229)]));if(!_0x23800b[_0x184c27(0x1cd)])throw new bad_request_error_1[(_0x184c27(0x1c8))](this[_0x184c27(0x217)]+_0x184c27(0x1e7));await this[_0x184c27(0x212)][_0x184c27(0x22d)](this['prefix']+_0x184c27(0x209))['send']();const _0x27a6ea=await this['salesforceSync'][_0x184c27(0x1bc)](_0x23800b[_0x184c27(0x1f5)](_0x5d0fe1=>'\x27'+_0x5d0fe1[_0x184c27(0x1c2)]+'\x27')['join'](','));await this[_0x184c27(0x212)][_0x184c27(0x22d)](this['prefix']+_0x184c27(0x1d6))[_0x184c27(0x216)](),this[_0x184c27(0x1f9)]=await this[_0x184c27(0x20a)][_0x184c27(0x231)]();const _0x23af0b=[..._0x23800b,..._0x27a6ea];this[_0x184c27(0x212)][_0x184c27(0x22d)](this['prefix']+_0x184c27(0x22b)+_0x23af0b[_0x184c27(0x1cd)]+_0x184c27(0x1ec));for(const _0x4b6156 of _0x23af0b){this[_0x184c27(0x22c)][_0x184c27(0x22d)]('Syncing\x20'+_0x4b6156[_0x184c27(0x218)]+'['+_0x4b6156[_0x184c27(0x1c2)]+']\x20repository\x20'+_0x4b6156[_0x184c27(0x204)]+'['+_0x4b6156[_0x184c27(0x1e4)]+_0x184c27(0x1df)),this['sfLogger']['log'](this[_0x184c27(0x217)]+_0x184c27(0x1be)+_0x4b6156[_0x184c27(0x218)]+_0x184c27(0x22f)+_0x4b6156[_0x184c27(0x204)]+'\x22.'),this[_0x184c27(0x212)][_0x184c27(0x22d)](this['prefix']+_0x184c27(0x203));const _0x464b21=await this['checkValidNaming'](_0x4b6156);if(!_0x464b21)continue;this[_0x184c27(0x212)]['log'](this['prefix']+_0x184c27(0x1f0));const _0x213055=await this['isIntersects'](_0x4b6156);if(_0x213055)continue;await this[_0x184c27(0x212)][_0x184c27(0x216)]();let _0x1c36bc;try{await this[_0x184c27(0x212)][_0x184c27(0x22d)](this[_0x184c27(0x217)]+_0x184c27(0x20e))[_0x184c27(0x216)](),_0x1c36bc=await this['getOrCreateRepo'](_0x4b6156,typedi_1[_0x184c27(0x20d)][_0x184c27(0x1c0)](providers_tokens_1[_0x184c27(0x214)][_0x184c27(0x229)]));}catch(_0xbc0fc6){await this[_0x184c27(0x21d)](_0x4b6156,_0xbc0fc6 instanceof too_many_requests_error_1[_0x184c27(0x1d4)]?_0xbc0fc6:new Error(_0x184c27(0x1d7)+_0xbc0fc6));continue;}await this[_0x184c27(0x212)][_0x184c27(0x22d)](this[_0x184c27(0x217)]+_0x184c27(0x1b8))[_0x184c27(0x216)]();if(_0x4b6156[_0x184c27(0x21f)]===flosum_repository_sync_dto_1[_0x184c27(0x1cb)][_0x184c27(0x1e8)]){const _0x279c18=typedi_1[_0x184c27(0x20d)][_0x184c27(0x1c0)](flosum_sync_job_1[_0x184c27(0x1d1)]);await _0x279c18[_0x184c27(0x1d9)]({'repository':_0x1c36bc,'convertToSFDX':this[_0x184c27(0x1fc)][_0x184c27(0x20c)],'syncRecord':_0x4b6156,'provider':this[_0x184c27(0x1fc)][_0x184c27(0x1bf)]})[_0x184c27(0x1ef)](_0x46feed=>this['handleRecordSyncError'](_0x4b6156,_0x46feed));}else{const _0x53814c=typedi_1[_0x184c27(0x20d)]['get'](git_sync_job_1[_0x184c27(0x1e3)]);await _0x53814c[_0x184c27(0x1d9)]({'repository':_0x1c36bc,'branch':_0x4b6156[_0x184c27(0x204)],'provider':this[_0x184c27(0x1fc)][_0x184c27(0x1bf)],'repositoryGit':_0x1c36bc[_0x184c27(0x1e6)],'syncRecord':_0x4b6156})[_0x184c27(0x1ef)](_0x3449dd=>this['handleRecordSyncError'](_0x4b6156,_0x3449dd));}}}catch(_0x5820f5){this['logger'][_0x184c27(0x1e9)](_0x5820f5);_0x5820f5 instanceof too_many_requests_error_1[_0x184c27(0x1d4)]?(await this['sfLogger'][_0x184c27(0x22d)](this['prefix']+_0x184c27(0x1c9))['send'](),await(0x0,utils_1[_0x184c27(0x1de)])(0x3c*0x3c*0x3e8),this['run']()):await this['sfLogger']['error'](this['prefix']+_0x184c27(0x224)+_0x5820f5)[_0x184c27(0x216)]();return;}await this[_0x184c27(0x212)][_0x184c27(0x22d)](this[_0x184c27(0x217)]+_0x184c27(0x1d3))[_0x184c27(0x216)](),await this[_0x184c27(0x1c4)]['disableSync'](typedi_1[_0x184c27(0x20d)][_0x184c27(0x1c0)](providers_tokens_1['Tokens'][_0x184c27(0x229)]))[_0x184c27(0x1ef)](()=>null);}};function a111_0x3667(_0x57fb00,_0x10b48d){const _0x419df5=a111_0xb63e();return a111_0x3667=function(_0x32cb60,_0xdb87a5){_0x32cb60=_0x32cb60-0x1b8;let _0xb63ec0=_0x419df5[_0x32cb60];return _0xb63ec0;},a111_0x3667(_0x57fb00,_0x10b48d);}function a111_0xb63e(){const _0x4e7f02=['\x20Syncing\x20repository:\x20\x22','gitProvider','get','Unable\x20to\x20synchronize\x20repository\x20\x27','repositoryId','../../providers/web-hooks/hooks.utils','salesforceSync','design:paramtypes','\x20Start\x20sync\x20job.','\x27\x20in\x20repository\x20\x27','BadRequestError','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','setStatus','SyncDirection','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','length','../../salesforce/dto/flosum-repository-sync.dto','toUpperCase','6OntEZd','FlosumSyncJob','SalesforceService','\x20Sync\x20job\x20done.','TooManyRequests','apply','\x20Getting\x20repositories\x20from\x20git\x20service.','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','create','run','1353000zJSFyl','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','name','184556XMDcxo','sleep',']\x20branch.','10hRWawo','updateRemoteState','Unable\x20to\x20synchronize\x20branch\x20\x27','GitSyncJob','branchId','../../salesforce/services/salesforce-sync.service','gitUrl','\x20No\x20repositories\x20to\x20sync.','FlosumToGit','error','\x27\x20-\x20\x27','BRANCH_NAME_REGEXP','\x20branches.','getOrCreateRepo','6kMGuSs','catch','\x20Checking\x20intersects.','gitRepoService','300688ZugcWY','test','find','map','../../../shared/utils','metadata','Logger','repoList','SalesforceSyncService','HooksUtils','config','\x20Getting\x20repository\x20records.','780705wFwxqT','isIntersects','getLoggerId','toLowerCase','createHookPayload','\x20Checking\x20valid\x20name.','branchName','hooks','277556ULMobO','1948303apizuS','(((.+)+)+)+$','\x20Getting\x20branch\x20records.','repoService','object','isConvertToSfdx','Container','\x20Getting\x20Flosum\x20repository','salesforceService','Service','decorate','sfLogger','../../salesforce/errors/salesforce.error','Tokens','applicationUrl','send','prefix','repositoryName','gitApiService','getHookLinkFor','getOwnPropertyDescriptor','isBidirectionalSynchronization','handleRecordSyncError','repositoriesIntersections','direction','__esModule','1873089ByWprV','../jobs/git-sync.job','checkValidNaming','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','Not\x20Synchronized','../../providers/providers.tokens','\x20Repository\x20\x22','../jobs/flosum-sync.job','connectionId','toString','\x20Have\x20to\x20synchronize\x20','logger','log','../../../../core','\x22\x20branch:\x20\x22','function','getAll','\x20Completed\x20prepare\x20to\x20syncing.','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','defineProperty','__decorate','getBranchRecords',']\x20['];a111_0xb63e=function(){return _0x4e7f02;};return a111_0xb63e();}SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x55d973(0x210)])({'transient':!![]}),__metadata(a111_0x55d973(0x1c5),[salesforce_service_1[a111_0x55d973(0x1d2)],salesforce_sync_service_1[a111_0x55d973(0x1fa)]])],SyncService),exports['SyncService']=SyncService;