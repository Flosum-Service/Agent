const a111_0x36a3df=a111_0x515a;(function(_0x51d342,_0xb7a9e){const _0x18d2f5=a111_0x515a,_0x3fe101=_0x51d342();while(!![]){try{const _0x10bd74=-parseInt(_0x18d2f5(0x1fa))/0x1*(parseInt(_0x18d2f5(0x217))/0x2)+parseInt(_0x18d2f5(0x1ff))/0x3*(parseInt(_0x18d2f5(0x1df))/0x4)+parseInt(_0x18d2f5(0x1fc))/0x5+parseInt(_0x18d2f5(0x24f))/0x6*(-parseInt(_0x18d2f5(0x24c))/0x7)+parseInt(_0x18d2f5(0x258))/0x8*(-parseInt(_0x18d2f5(0x1fd))/0x9)+-parseInt(_0x18d2f5(0x1f7))/0xa+-parseInt(_0x18d2f5(0x213))/0xb*(-parseInt(_0x18d2f5(0x241))/0xc);if(_0x10bd74===_0xb7a9e)break;else _0x3fe101['push'](_0x3fe101['shift']());}catch(_0x5f1648){_0x3fe101['push'](_0x3fe101['shift']());}}}(a111_0x414a,0xa5dbd));function a111_0x414a(){const _0x261f65=['\x20Getting\x20repository\x20records.','\x20Stop\x20sync\x20job\x20for\x20\x27','isIntersects','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','function','getBranchRecords','length','search',']\x20[','\x27\x20-\x20\x27','get','branchId','2648670PwJQum','SalesforceSyncService','\x20Checking\x20intersects.','337103iKQQSI','FlosumToGit','4327615LjAgUh','72GpSqHu','checkValidNaming','2764167SaQrcy','updateRemoteState','sleep','getHookLinkFor','prefix','BadRequestError','isBidirectionalSynchronization','__metadata','__esModule','repositoriesIntersections','metadata','logger','setLoggerId','../../salesforce/dto/flosum-repository-sync.dto','toLowerCase','name','\x20Checking\x20valid\x20name.','gitRepoService','direction','GitBranchNotFoundError','33jWlJMW','disableSync','\x27\x20[','send','2stBXLv','toString','../errors/git-branch-not-found.error','getRepositoryRecords','hooks','FlosumSyncJob','../../salesforce/services/salesforce.service','\x22\x20branch:\x20\x22','map','salesforceService','(((.+)+)+)+$','HooksUtils','setStatus','catch','Syncing\x20','handleRecordSyncError','create','\x20Getting\x20branch\x20records.','GitSyncJob','isConvertToSfdx','repoService','url','Error','../../../../constants','SalesforceError','object','branchName','salesforceSync','../../../../core/errors/bad-request.error','decorate','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','gitUrl','typedi','sfLogger','log','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','../../providers/web-hooks/hooks.utils','design:paramtypes','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','getOwnPropertyDescriptor','toUpperCase','connectionId','4699944jWcYli','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','Not\x20Synchronized','repoList','../jobs/git-sync.job','../../../../core','\x27\x20in\x20repository\x20\x27','gitProvider','Unable\x20to\x20synchronize\x20repository\x20\x27','run','6156773SxDeZD',']\x20branch.','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','6EWwaXG','SyncService','repositoryId','gitApiService','test',']\x20due\x20error\x20-\x20','\x20Syncing\x20repository:\x20\x22','config','Container','801032uZHseH','repositoryName','find','getOrCreateRepo','applicationUrl','4GVDgql','\x20Completed\x20prepare\x20to\x20syncing.','\x20Repository\x20\x22','TooManyRequests','../../../shared/utils','getAll','Tokens','SyncDirection','apply','../jobs/flosum-sync.job','\x20Start\x20sync\x20job.','error'];a111_0x414a=function(){return _0x261f65;};return a111_0x414a();}const a111_0x1834e6=(function(){let _0x189b3a=!![];return function(_0x21a15f,_0x1c0472){const _0x880590=_0x189b3a?function(){const _0x81082e=a111_0x515a;if(_0x1c0472){const _0xa26806=_0x1c0472[_0x81082e(0x1e7)](_0x21a15f,arguments);return _0x1c0472=null,_0xa26806;}}:function(){};return _0x189b3a=![],_0x880590;};}()),a111_0x30551c=a111_0x1834e6(this,function(){const _0x5126e5=a111_0x515a;return a111_0x30551c[_0x5126e5(0x218)]()[_0x5126e5(0x1f2)](_0x5126e5(0x221))[_0x5126e5(0x218)]()['constructor'](a111_0x30551c)['search'](_0x5126e5(0x221));});a111_0x30551c();function a111_0x515a(_0x29fa76,_0xa5db12){const _0x1458d3=a111_0x414a();return a111_0x515a=function(_0x30551c,_0x1834e6){_0x30551c=_0x30551c-0x1df;let _0x414a04=_0x1458d3[_0x30551c];return _0x414a04;},a111_0x515a(_0x29fa76,_0xa5db12);}'use strict';var __decorate=this&&this['__decorate']||function(_0x31f3e2,_0x5a79ca,_0x90d6c8,_0x40be92){const _0x2729ff=a111_0x515a;var _0x57b052=arguments[_0x2729ff(0x1f1)],_0x5b50df=_0x57b052<0x3?_0x5a79ca:_0x40be92===null?_0x40be92=Object[_0x2729ff(0x23e)](_0x5a79ca,_0x90d6c8):_0x40be92,_0x1b3c76;if(typeof Reflect===_0x2729ff(0x230)&&typeof Reflect[_0x2729ff(0x234)]===_0x2729ff(0x1ef))_0x5b50df=Reflect[_0x2729ff(0x234)](_0x31f3e2,_0x5a79ca,_0x90d6c8,_0x40be92);else{for(var _0x551a7f=_0x31f3e2[_0x2729ff(0x1f1)]-0x1;_0x551a7f>=0x0;_0x551a7f--)if(_0x1b3c76=_0x31f3e2[_0x551a7f])_0x5b50df=(_0x57b052<0x3?_0x1b3c76(_0x5b50df):_0x57b052>0x3?_0x1b3c76(_0x5a79ca,_0x90d6c8,_0x5b50df):_0x1b3c76(_0x5a79ca,_0x90d6c8))||_0x5b50df;}return _0x57b052>0x3&&_0x5b50df&&Object['defineProperty'](_0x5a79ca,_0x90d6c8,_0x5b50df),_0x5b50df;},__metadata=this&&this[a111_0x36a3df(0x206)]||function(_0x1a89dd,_0x3630ad){const _0xd64424=a111_0x36a3df;if(typeof Reflect===_0xd64424(0x230)&&typeof Reflect[_0xd64424(0x209)]===_0xd64424(0x1ef))return Reflect[_0xd64424(0x209)](_0x1a89dd,_0x3630ad);},SyncService_1;Object['defineProperty'](exports,a111_0x36a3df(0x207),{'value':!![]}),exports[a111_0x36a3df(0x250)]=void 0x0;const constants_1=require(a111_0x36a3df(0x22e)),core_1=require(a111_0x36a3df(0x247)),too_many_requests_error_1=require('../../../../core/errors/too-many-requests.error'),flosum_repository_sync_dto_1=require(a111_0x36a3df(0x20c)),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a111_0x36a3df(0x21d)),utils_1=require(a111_0x36a3df(0x1e3)),typedi_1=require(a111_0x36a3df(0x237)),hooks_utils_1=require(a111_0x36a3df(0x23b)),git_branch_not_found_error_1=require(a111_0x36a3df(0x219)),flosum_sync_job_1=require(a111_0x36a3df(0x1e8)),git_sync_job_1=require(a111_0x36a3df(0x246)),providers_tokens_1=require('../../providers/providers.tokens'),bad_request_error_1=require(a111_0x36a3df(0x233));let SyncService=SyncService_1=class SyncService{constructor(_0x14baea,_0x2884d8){const _0x36b62e=a111_0x36a3df;this[_0x36b62e(0x220)]=_0x14baea,this['salesforceSync']=_0x2884d8,this['logger']=new core_1['Logger'](SyncService_1[_0x36b62e(0x20e)]),this[_0x36b62e(0x208)]={},this[_0x36b62e(0x245)]=[];}async[a111_0x36a3df(0x226)](_0x24d46b,_0x1503ae){const _0x1ca642=a111_0x36a3df;if(_0x1503ae instanceof git_branch_not_found_error_1[_0x1ca642(0x212)]){await this[_0x1ca642(0x232)][_0x1ca642(0x223)](_0x24d46b,_0x1ca642(0x244));return;}if(_0x1503ae instanceof too_many_requests_error_1[_0x1ca642(0x1e2)]){await this[_0x1ca642(0x232)][_0x1ca642(0x223)](_0x24d46b,'Waiting');throw _0x1503ae;}try{await this[_0x1ca642(0x238)][_0x1ca642(0x1ea)](this['prefix']+_0x1ca642(0x1ec)+_0x24d46b[_0x1ca642(0x259)]+_0x1ca642(0x215)+_0x24d46b[_0x1ca642(0x231)]+_0x1ca642(0x254)+_0x1503ae+'.')['send'](),await this[_0x1ca642(0x232)][_0x1ca642(0x200)](_0x24d46b,{}),await this[_0x1ca642(0x232)][_0x1ca642(0x223)](_0x24d46b,_0x1ca642(0x22d));}catch(_0x5947e9){if(_0x5947e9 instanceof salesforce_error_1[_0x1ca642(0x22f)])throw _0x5947e9;}}async[a111_0x36a3df(0x1ed)](_0x13c1a3){const _0x543485=a111_0x36a3df;if(_0x13c1a3[_0x543485(0x251)]){const _0x476568=_0x13c1a3['repositoryName'][_0x543485(0x20d)](),_0x1efbf8=this[_0x543485(0x208)][_0x476568];if(!_0x1efbf8)this['repositoriesIntersections'][_0x476568]=_0x13c1a3[_0x543485(0x259)];else{if(_0x1efbf8&&_0x1efbf8!==_0x13c1a3['repositoryName'])return await this[_0x543485(0x226)](_0x13c1a3,new Error(_0x543485(0x24a)+_0x13c1a3[_0x543485(0x259)]+_0x543485(0x23d)+_0x476568+_0x543485(0x1f4)+_0x1efbf8+'\x27')),!![];}}return![];}async[a111_0x36a3df(0x1fe)](_0x4a51b4){const _0x55c3c0=a111_0x36a3df;if(!constants_1['REPOSITORY_NAME_REGEXP'][_0x55c3c0(0x253)](_0x4a51b4[_0x55c3c0(0x259)]))return await this[_0x55c3c0(0x226)](_0x4a51b4,new Error(_0x55c3c0(0x24a)+_0x4a51b4[_0x55c3c0(0x259)]+_0x55c3c0(0x23a))),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x55c3c0(0x253)](_0x4a51b4[_0x55c3c0(0x231)]))return await this[_0x55c3c0(0x226)](_0x4a51b4,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x4a51b4['branchName']+_0x55c3c0(0x248)+_0x4a51b4[_0x55c3c0(0x259)]+_0x55c3c0(0x1ee))),![];return!![];}async[a111_0x36a3df(0x25b)](_0x2eed2a,_0x1f8b50){const _0x47edc3=a111_0x36a3df;let _0x5eaa4b=this[_0x47edc3(0x245)]['find'](_0x31d947=>_0x2eed2a[_0x47edc3(0x259)]===_0x31d947['name']);!_0x5eaa4b&&(this[_0x47edc3(0x238)][_0x47edc3(0x239)](this[_0x47edc3(0x203)]+'\x20Repository\x20\x22'+_0x2eed2a['repositoryName']+_0x47edc3(0x243)),_0x5eaa4b=await this[_0x47edc3(0x22b)][_0x47edc3(0x227)]({'name':_0x2eed2a[_0x47edc3(0x259)],'autoInit':!![],'defaultBranch':_0x2eed2a[_0x47edc3(0x231)],'private':!![],'createHook':typedi_1[_0x47edc3(0x257)][_0x47edc3(0x1f5)](providers_tokens_1[_0x47edc3(0x1e5)]['config'])[_0x47edc3(0x205)]}));if(this[_0x47edc3(0x256)][_0x47edc3(0x205)]){const _0x519673=await _0x5eaa4b[_0x47edc3(0x21b)][_0x47edc3(0x1e4)]();!_0x519673[_0x47edc3(0x25a)](_0x15ed8e=>_0x15ed8e[_0x47edc3(0x22c)]===hooks_utils_1['HooksUtils'][_0x47edc3(0x202)](this[_0x47edc3(0x256)]['gitProvider'],this[_0x47edc3(0x256)][_0x47edc3(0x25c)],_0x1f8b50))&&(this[_0x47edc3(0x238)][_0x47edc3(0x239)](this[_0x47edc3(0x203)]+_0x47edc3(0x1e1)+_0x2eed2a[_0x47edc3(0x259)]+_0x47edc3(0x24e)),await _0x5eaa4b[_0x47edc3(0x21b)][_0x47edc3(0x227)](hooks_utils_1[_0x47edc3(0x222)]['createHookPayload'](this[_0x47edc3(0x256)]['gitProvider'],_0x5eaa4b[_0x47edc3(0x21b)],this['config'][_0x47edc3(0x25c)],_0x1f8b50)));}return this[_0x47edc3(0x245)]['push'](_0x5eaa4b),_0x5eaa4b;}async[a111_0x36a3df(0x24b)](){const _0x121be6=a111_0x36a3df;this[_0x121be6(0x252)]=typedi_1[_0x121be6(0x257)][_0x121be6(0x1f5)](providers_tokens_1[_0x121be6(0x1e5)][_0x121be6(0x252)]),this[_0x121be6(0x22b)]=typedi_1['Container'][_0x121be6(0x1f5)](providers_tokens_1['Tokens'][_0x121be6(0x210)]),this[_0x121be6(0x256)]=typedi_1[_0x121be6(0x257)]['get'](providers_tokens_1[_0x121be6(0x1e5)][_0x121be6(0x256)]),this[_0x121be6(0x238)]=typedi_1[_0x121be6(0x257)][_0x121be6(0x1f5)](providers_tokens_1['Tokens'][_0x121be6(0x20a)]),this['prefix']='['+SyncService_1[_0x121be6(0x20e)]+_0x121be6(0x1f3)+this[_0x121be6(0x256)][_0x121be6(0x249)][_0x121be6(0x23f)]()+']',this[_0x121be6(0x220)][_0x121be6(0x20b)](this['sfLogger']['getLoggerId']());try{this[_0x121be6(0x238)][_0x121be6(0x239)](this[_0x121be6(0x203)]+_0x121be6(0x1e9)),await this[_0x121be6(0x238)][_0x121be6(0x239)](this['prefix']+_0x121be6(0x1eb))[_0x121be6(0x216)]();const _0x198308=await this[_0x121be6(0x232)][_0x121be6(0x21a)](typedi_1[_0x121be6(0x257)]['get'](providers_tokens_1[_0x121be6(0x1e5)][_0x121be6(0x240)]));if(!_0x198308['length'])throw new bad_request_error_1[(_0x121be6(0x204))](this[_0x121be6(0x203)]+'\x20No\x20repositories\x20to\x20sync.');await this[_0x121be6(0x238)][_0x121be6(0x239)](this['prefix']+_0x121be6(0x228))[_0x121be6(0x216)]();const _0x1074f7=await this[_0x121be6(0x232)][_0x121be6(0x1f0)](_0x198308[_0x121be6(0x21f)](_0x57484e=>'\x27'+_0x57484e[_0x121be6(0x251)]+'\x27')['join'](','));await this[_0x121be6(0x238)]['log'](this[_0x121be6(0x203)]+'\x20Getting\x20repositories\x20from\x20git\x20service.')[_0x121be6(0x216)](),this['repoList']=await this[_0x121be6(0x22b)]['getAll']();const _0x179788=[..._0x198308,..._0x1074f7];this[_0x121be6(0x238)][_0x121be6(0x239)](this[_0x121be6(0x203)]+'\x20Have\x20to\x20synchronize\x20'+_0x179788[_0x121be6(0x1f1)]+'\x20branches.');for(const _0xcb9e1d of _0x179788){this[_0x121be6(0x20a)][_0x121be6(0x239)](_0x121be6(0x225)+_0xcb9e1d[_0x121be6(0x259)]+'['+_0xcb9e1d[_0x121be6(0x251)]+']\x20repository\x20'+_0xcb9e1d[_0x121be6(0x231)]+'['+_0xcb9e1d[_0x121be6(0x1f6)]+_0x121be6(0x24d)),this[_0x121be6(0x238)]['log'](this[_0x121be6(0x203)]+_0x121be6(0x255)+_0xcb9e1d['repositoryName']+_0x121be6(0x21e)+_0xcb9e1d['branchName']+'\x22.'),this['sfLogger'][_0x121be6(0x239)](this[_0x121be6(0x203)]+_0x121be6(0x20f));const _0x2328ab=await this[_0x121be6(0x1fe)](_0xcb9e1d);if(!_0x2328ab)continue;this[_0x121be6(0x238)][_0x121be6(0x239)](this['prefix']+_0x121be6(0x1f9));const _0x2daad5=await this[_0x121be6(0x1ed)](_0xcb9e1d);if(_0x2daad5)continue;await this[_0x121be6(0x238)][_0x121be6(0x216)]();let _0xb3d3e8;try{await this[_0x121be6(0x238)][_0x121be6(0x239)](this[_0x121be6(0x203)]+'\x20Getting\x20Flosum\x20repository')['send'](),_0xb3d3e8=await this[_0x121be6(0x25b)](_0xcb9e1d,typedi_1[_0x121be6(0x257)][_0x121be6(0x1f5)](providers_tokens_1[_0x121be6(0x1e5)][_0x121be6(0x240)]));}catch(_0x5e7f36){await this[_0x121be6(0x226)](_0xcb9e1d,_0x5e7f36 instanceof too_many_requests_error_1[_0x121be6(0x1e2)]?_0x5e7f36:new Error(_0x121be6(0x235)+_0x5e7f36));continue;}await this[_0x121be6(0x238)][_0x121be6(0x239)](this[_0x121be6(0x203)]+_0x121be6(0x1e0))[_0x121be6(0x216)]();if(_0xcb9e1d[_0x121be6(0x211)]===flosum_repository_sync_dto_1[_0x121be6(0x1e6)][_0x121be6(0x1fb)]){const _0x522ce8=typedi_1['Container'][_0x121be6(0x1f5)](flosum_sync_job_1[_0x121be6(0x21c)]);await _0x522ce8[_0x121be6(0x24b)]({'repository':_0xb3d3e8,'convertToSFDX':this['config'][_0x121be6(0x22a)],'syncRecord':_0xcb9e1d,'provider':this[_0x121be6(0x256)][_0x121be6(0x249)]})[_0x121be6(0x224)](_0x5fa9ac=>this[_0x121be6(0x226)](_0xcb9e1d,_0x5fa9ac));}else{const _0x5e4c49=typedi_1['Container'][_0x121be6(0x1f5)](git_sync_job_1[_0x121be6(0x229)]);await _0x5e4c49[_0x121be6(0x24b)]({'repository':_0xb3d3e8,'branch':_0xcb9e1d['branchName'],'provider':this[_0x121be6(0x256)][_0x121be6(0x249)],'repositoryGit':_0xb3d3e8[_0x121be6(0x236)],'syncRecord':_0xcb9e1d})[_0x121be6(0x224)](_0x2588d4=>this[_0x121be6(0x226)](_0xcb9e1d,_0x2588d4));}}}catch(_0x3b68cc){this['logger'][_0x121be6(0x1ea)](_0x3b68cc);_0x3b68cc instanceof too_many_requests_error_1[_0x121be6(0x1e2)]?(await this[_0x121be6(0x238)][_0x121be6(0x239)](this[_0x121be6(0x203)]+_0x121be6(0x242))[_0x121be6(0x216)](),await(0x0,utils_1[_0x121be6(0x201)])(0x3c*0x3c*0x3e8),this[_0x121be6(0x24b)]()):await this['sfLogger']['error'](this[_0x121be6(0x203)]+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x3b68cc)['send']();return;}await this['sfLogger'][_0x121be6(0x239)](this[_0x121be6(0x203)]+'\x20Sync\x20job\x20done.')[_0x121be6(0x216)](),await this[_0x121be6(0x232)][_0x121be6(0x214)](typedi_1['Container'][_0x121be6(0x1f5)](providers_tokens_1['Tokens'][_0x121be6(0x240)]))[_0x121be6(0x224)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a111_0x36a3df(0x23c),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a111_0x36a3df(0x1f8)]])],SyncService),exports[a111_0x36a3df(0x250)]=SyncService;