const a80_0x5eafab=a80_0xf14b;(function(_0xf35843,_0x35608e){const _0x1b0be3=a80_0xf14b,_0x57a0f2=_0xf35843();while(!![]){try{const _0x4ea726=parseInt(_0x1b0be3(0x103))/0x1+parseInt(_0x1b0be3(0x11f))/0x2+-parseInt(_0x1b0be3(0x129))/0x3+parseInt(_0x1b0be3(0x15c))/0x4*(parseInt(_0x1b0be3(0x168))/0x5)+-parseInt(_0x1b0be3(0x148))/0x6+-parseInt(_0x1b0be3(0x119))/0x7+parseInt(_0x1b0be3(0x145))/0x8;if(_0x4ea726===_0x35608e)break;else _0x57a0f2['push'](_0x57a0f2['shift']());}catch(_0x2db32a){_0x57a0f2['push'](_0x57a0f2['shift']());}}}(a80_0x2874,0x41725));const a80_0x5a98a7=(function(){let _0x4abf66=!![];return function(_0xd5856b,_0x5f4bd0){const _0x2b8c5a=_0x4abf66?function(){const _0x23d3c7=a80_0xf14b;if(_0x5f4bd0){const _0x33468c=_0x5f4bd0[_0x23d3c7(0x161)](_0xd5856b,arguments);return _0x5f4bd0=null,_0x33468c;}}:function(){};return _0x4abf66=![],_0x2b8c5a;};}()),a80_0x436341=a80_0x5a98a7(this,function(){const _0x60d94=a80_0xf14b;return a80_0x436341[_0x60d94(0x153)]()[_0x60d94(0x173)](_0x60d94(0x12d))[_0x60d94(0x153)]()[_0x60d94(0x10e)](a80_0x436341)[_0x60d94(0x173)]('(((.+)+)+)+$');});function a80_0xf14b(_0x24273b,_0x1d56e8){const _0x2f8d5e=a80_0x2874();return a80_0xf14b=function(_0x436341,_0x5a98a7){_0x436341=_0x436341-0x100;let _0x28740b=_0x2f8d5e[_0x436341];return _0x28740b;},a80_0xf14b(_0x24273b,_0x1d56e8);}a80_0x436341();function a80_0x2874(){const _0xe4d7f2=['toString','SalesforceSyncService','typedi','\x27\x20[','metadata','\x20branches.','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','Waiting','logger','786392RELNgf','SalesforceError','../../salesforce/services/salesforce.service','../../salesforce/dto/flosum-repository-sync.dto','\x20Syncing\x20repository:\x20\x22','apply','repoList','toUpperCase','sfLogger','test','find','GitBranchNotFoundError','10Kmghxa','TooManyRequests','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','decorate','length','name','GitSyncJob','config','checkValidNaming','__esModule','object','search','HooksUtils','gitUrl','Logger','direction','../../../../core','\x20Have\x20to\x20synchronize\x20','../jobs/flosum-sync.job',']\x20branch.','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','gitRepoService','Unable\x20to\x20synchronize\x20repository\x20\x27','hooks','repositoriesIntersections','18136knqUpL','run','repoService',']\x20due\x20error\x20-\x20','../../salesforce/errors/salesforce.error','repositoryId','\x20Repository\x20\x22','SalesforceService','../../../shared/utils','createHookPayload','isIntersects','constructor','\x20Completed\x20prepare\x20to\x20syncing.','\x27\x20-\x20\x27','\x20Getting\x20repository\x20records.','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20',']\x20[','getLoggerId','getOrCreateRepo','function','isConvertToSfdx','getBranchRecords','3711918Cqqjux','salesforceService','setLoggerId','\x20Start\x20sync\x20job.','isBidirectionalSynchronization','error','78180yddBdx','push','Service','url','disableSync','map','getRepositoryRecords','\x20Checking\x20intersects.','../../../../core/errors/too-many-requests.error','connectionId','478857zjjSmG','../../salesforce/services/salesforce-sync.service','getHookLinkFor','\x20Checking\x20valid\x20name.','(((.+)+)+)+$','\x20Sync\x20job\x20done.','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','Syncing\x20','create','applicationUrl','BadRequestError','Error','Unable\x20to\x20synchronize\x20branch\x20\x27','Container','toLowerCase','prefix','\x20Getting\x20repositories\x20from\x20git\x20service.','REPOSITORY_NAME_REGEXP','../../providers/web-hooks/hooks.utils','log','gitApiService','\x20No\x20repositories\x20to\x20sync.','defineProperty','FlosumSyncJob','getAll','repositoryName','Tokens','catch','5791816EqSyXs','getOwnPropertyDescriptor','../../../../constants','1298622rGorhB','__metadata','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','SyncDirection','handleRecordSyncError','branchName','get','salesforceSync','SyncService','\x27\x20in\x20repository\x20\x27','send'];a80_0x2874=function(){return _0xe4d7f2;};return a80_0x2874();}'use strict';var __decorate=this&&this['__decorate']||function(_0x6509a3,_0xfe0c34,_0x2968e3,_0x41824b){const _0x25007a=a80_0xf14b;var _0x12a0d1=arguments[_0x25007a(0x16c)],_0x2637b1=_0x12a0d1<0x3?_0xfe0c34:_0x41824b===null?_0x41824b=Object[_0x25007a(0x146)](_0xfe0c34,_0x2968e3):_0x41824b,_0x5026aa;if(typeof Reflect===_0x25007a(0x172)&&typeof Reflect[_0x25007a(0x16b)]===_0x25007a(0x116))_0x2637b1=Reflect[_0x25007a(0x16b)](_0x6509a3,_0xfe0c34,_0x2968e3,_0x41824b);else{for(var _0x289c35=_0x6509a3[_0x25007a(0x16c)]-0x1;_0x289c35>=0x0;_0x289c35--)if(_0x5026aa=_0x6509a3[_0x289c35])_0x2637b1=(_0x12a0d1<0x3?_0x5026aa(_0x2637b1):_0x12a0d1>0x3?_0x5026aa(_0xfe0c34,_0x2968e3,_0x2637b1):_0x5026aa(_0xfe0c34,_0x2968e3))||_0x2637b1;}return _0x12a0d1>0x3&&_0x2637b1&&Object['defineProperty'](_0xfe0c34,_0x2968e3,_0x2637b1),_0x2637b1;},__metadata=this&&this[a80_0x5eafab(0x149)]||function(_0x56513d,_0x1a90c7){const _0x51d866=a80_0x5eafab;if(typeof Reflect===_0x51d866(0x172)&&typeof Reflect[_0x51d866(0x157)]===_0x51d866(0x116))return Reflect['metadata'](_0x56513d,_0x1a90c7);},SyncService_1;Object[a80_0x5eafab(0x13f)](exports,a80_0x5eafab(0x171),{'value':!![]}),exports['SyncService']=void 0x0;const constants_1=require(a80_0x5eafab(0x147)),core_1=require(a80_0x5eafab(0x178)),too_many_requests_error_1=require(a80_0x5eafab(0x127)),flosum_repository_sync_dto_1=require(a80_0x5eafab(0x15f)),salesforce_error_1=require(a80_0x5eafab(0x107)),salesforce_sync_service_1=require(a80_0x5eafab(0x12a)),salesforce_service_1=require(a80_0x5eafab(0x15e)),utils_1=require(a80_0x5eafab(0x10b)),typedi_1=require(a80_0x5eafab(0x155)),hooks_utils_1=require(a80_0x5eafab(0x13b)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require(a80_0x5eafab(0x17a)),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require('../../providers/providers.tokens'),bad_request_error_1=require('../../../../core/errors/bad-request.error');let SyncService=SyncService_1=class SyncService{constructor(_0x2fafc4,_0x57743d){const _0x541f83=a80_0x5eafab;this['salesforceService']=_0x2fafc4,this[_0x541f83(0x14f)]=_0x57743d,this[_0x541f83(0x15b)]=new core_1[(_0x541f83(0x176))](SyncService_1['name']),this[_0x541f83(0x102)]={},this[_0x541f83(0x162)]=[];}async['handleRecordSyncError'](_0x572b63,_0x461831){const _0x3e8a0f=a80_0x5eafab;if(_0x461831 instanceof git_branch_not_found_error_1[_0x3e8a0f(0x167)]){await this['salesforceSync']['setStatus'](_0x572b63,'Not\x20Synchronized');return;}if(_0x461831 instanceof too_many_requests_error_1[_0x3e8a0f(0x169)]){await this[_0x3e8a0f(0x14f)]['setStatus'](_0x572b63,_0x3e8a0f(0x15a));throw _0x461831;}try{await this[_0x3e8a0f(0x164)][_0x3e8a0f(0x11e)](this[_0x3e8a0f(0x138)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x572b63['repositoryName']+_0x3e8a0f(0x156)+_0x572b63['branchName']+_0x3e8a0f(0x106)+_0x461831+'.')[_0x3e8a0f(0x152)](),await this[_0x3e8a0f(0x14f)]['updateRemoteState'](_0x572b63,{}),await this[_0x3e8a0f(0x14f)]['setStatus'](_0x572b63,_0x3e8a0f(0x134));}catch(_0x2830bc){if(_0x2830bc instanceof salesforce_error_1[_0x3e8a0f(0x15d)])throw _0x2830bc;}}async[a80_0x5eafab(0x10d)](_0x4759ed){const _0x295035=a80_0x5eafab;if(_0x4759ed[_0x295035(0x108)]){const _0x2a9029=_0x4759ed[_0x295035(0x142)][_0x295035(0x137)](),_0x4d9a88=this[_0x295035(0x102)][_0x2a9029];if(!_0x4d9a88)this[_0x295035(0x102)][_0x2a9029]=_0x4759ed[_0x295035(0x142)];else{if(_0x4d9a88&&_0x4d9a88!==_0x4759ed[_0x295035(0x142)])return await this[_0x295035(0x14c)](_0x4759ed,new Error(_0x295035(0x100)+_0x4759ed[_0x295035(0x142)]+_0x295035(0x16a)+_0x2a9029+_0x295035(0x110)+_0x4d9a88+'\x27')),!![];}}return![];}async[a80_0x5eafab(0x170)](_0x1beb4d){const _0x26047c=a80_0x5eafab;if(!constants_1[_0x26047c(0x13a)]['test'](_0x1beb4d[_0x26047c(0x142)]))return await this['handleRecordSyncError'](_0x1beb4d,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x1beb4d['repositoryName']+_0x26047c(0x159))),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x26047c(0x165)](_0x1beb4d[_0x26047c(0x14d)]))return await this['handleRecordSyncError'](_0x1beb4d,new Error(_0x26047c(0x135)+_0x1beb4d['branchName']+_0x26047c(0x151)+_0x1beb4d[_0x26047c(0x142)]+_0x26047c(0x12f))),![];return!![];}async[a80_0x5eafab(0x115)](_0x286baf,_0x387471){const _0x3e6761=a80_0x5eafab;let _0x3ba898=this[_0x3e6761(0x162)][_0x3e6761(0x166)](_0x2bd7ea=>_0x286baf[_0x3e6761(0x142)]===_0x2bd7ea[_0x3e6761(0x16d)]);!_0x3ba898&&(this['sfLogger'][_0x3e6761(0x13c)](this['prefix']+'\x20Repository\x20\x22'+_0x286baf[_0x3e6761(0x142)]+_0x3e6761(0x17c)),_0x3ba898=await this[_0x3e6761(0x105)][_0x3e6761(0x131)]({'name':_0x286baf[_0x3e6761(0x142)],'autoInit':!![],'defaultBranch':_0x286baf['branchName'],'private':!![],'createHook':typedi_1[_0x3e6761(0x136)][_0x3e6761(0x14e)](providers_tokens_1[_0x3e6761(0x143)][_0x3e6761(0x16f)])[_0x3e6761(0x11d)]}));if(this['config'][_0x3e6761(0x11d)]){const _0x569b81=await _0x3ba898[_0x3e6761(0x101)][_0x3e6761(0x141)]();!_0x569b81[_0x3e6761(0x166)](_0x45573c=>_0x45573c[_0x3e6761(0x122)]===hooks_utils_1[_0x3e6761(0x174)][_0x3e6761(0x12b)](this[_0x3e6761(0x16f)]['gitProvider'],this[_0x3e6761(0x16f)][_0x3e6761(0x132)],_0x387471))&&(this['sfLogger']['log'](this[_0x3e6761(0x138)]+_0x3e6761(0x109)+_0x286baf[_0x3e6761(0x142)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x3ba898[_0x3e6761(0x101)][_0x3e6761(0x131)](hooks_utils_1['HooksUtils'][_0x3e6761(0x10c)](this[_0x3e6761(0x16f)]['gitProvider'],_0x3ba898[_0x3e6761(0x101)],this['config'][_0x3e6761(0x132)],_0x387471)));}return this[_0x3e6761(0x162)][_0x3e6761(0x120)](_0x3ba898),_0x3ba898;}async[a80_0x5eafab(0x104)](){const _0x5bb823=a80_0x5eafab;this[_0x5bb823(0x13d)]=typedi_1[_0x5bb823(0x136)]['get'](providers_tokens_1['Tokens'][_0x5bb823(0x13d)]),this['repoService']=typedi_1[_0x5bb823(0x136)][_0x5bb823(0x14e)](providers_tokens_1['Tokens'][_0x5bb823(0x17d)]),this[_0x5bb823(0x16f)]=typedi_1[_0x5bb823(0x136)]['get'](providers_tokens_1[_0x5bb823(0x143)][_0x5bb823(0x16f)]),this[_0x5bb823(0x164)]=typedi_1[_0x5bb823(0x136)]['get'](providers_tokens_1[_0x5bb823(0x143)]['logger']),this['prefix']='['+SyncService_1[_0x5bb823(0x16d)]+_0x5bb823(0x113)+this[_0x5bb823(0x16f)]['gitProvider'][_0x5bb823(0x163)]()+']',this[_0x5bb823(0x11a)][_0x5bb823(0x11b)](this[_0x5bb823(0x164)][_0x5bb823(0x114)]());try{this['sfLogger'][_0x5bb823(0x13c)](this[_0x5bb823(0x138)]+_0x5bb823(0x11c)),await this[_0x5bb823(0x164)]['log'](this[_0x5bb823(0x138)]+_0x5bb823(0x111))[_0x5bb823(0x152)]();const _0x464782=await this['salesforceSync'][_0x5bb823(0x125)](typedi_1[_0x5bb823(0x136)]['get'](providers_tokens_1['Tokens'][_0x5bb823(0x128)]));if(!_0x464782[_0x5bb823(0x16c)])throw new bad_request_error_1[(_0x5bb823(0x133))](this['prefix']+_0x5bb823(0x13e));await this['sfLogger'][_0x5bb823(0x13c)](this['prefix']+'\x20Getting\x20branch\x20records.')[_0x5bb823(0x152)]();const _0x1b3659=await this[_0x5bb823(0x14f)][_0x5bb823(0x118)](_0x464782[_0x5bb823(0x124)](_0xf45fd4=>'\x27'+_0xf45fd4[_0x5bb823(0x108)]+'\x27')['join'](','));await this[_0x5bb823(0x164)][_0x5bb823(0x13c)](this[_0x5bb823(0x138)]+_0x5bb823(0x139))[_0x5bb823(0x152)](),this[_0x5bb823(0x162)]=await this[_0x5bb823(0x105)][_0x5bb823(0x141)]();const _0xfa2eb3=[..._0x464782,..._0x1b3659];this[_0x5bb823(0x164)][_0x5bb823(0x13c)](this[_0x5bb823(0x138)]+_0x5bb823(0x179)+_0xfa2eb3['length']+_0x5bb823(0x158));for(const _0x3c8033 of _0xfa2eb3){this[_0x5bb823(0x15b)][_0x5bb823(0x13c)](_0x5bb823(0x130)+_0x3c8033['repositoryName']+'['+_0x3c8033[_0x5bb823(0x108)]+']\x20repository\x20'+_0x3c8033[_0x5bb823(0x14d)]+'['+_0x3c8033['branchId']+_0x5bb823(0x17b)),this[_0x5bb823(0x164)][_0x5bb823(0x13c)](this['prefix']+_0x5bb823(0x160)+_0x3c8033[_0x5bb823(0x142)]+'\x22\x20branch:\x20\x22'+_0x3c8033[_0x5bb823(0x14d)]+'\x22.'),this['sfLogger'][_0x5bb823(0x13c)](this[_0x5bb823(0x138)]+_0x5bb823(0x12c));const _0x4f28e8=await this[_0x5bb823(0x170)](_0x3c8033);if(!_0x4f28e8)continue;this['sfLogger']['log'](this[_0x5bb823(0x138)]+_0x5bb823(0x126));const _0x35d4cb=await this[_0x5bb823(0x10d)](_0x3c8033);if(_0x35d4cb)continue;await this[_0x5bb823(0x164)]['send']();let _0x26938c;try{await this[_0x5bb823(0x164)][_0x5bb823(0x13c)](this[_0x5bb823(0x138)]+'\x20Getting\x20Flosum\x20repository')[_0x5bb823(0x152)](),_0x26938c=await this['getOrCreateRepo'](_0x3c8033,typedi_1['Container'][_0x5bb823(0x14e)](providers_tokens_1[_0x5bb823(0x143)]['connectionId']));}catch(_0x47b16b){await this[_0x5bb823(0x14c)](_0x3c8033,_0x47b16b instanceof too_many_requests_error_1['TooManyRequests']?_0x47b16b:new Error(_0x5bb823(0x112)+_0x47b16b));continue;}await this[_0x5bb823(0x164)][_0x5bb823(0x13c)](this[_0x5bb823(0x138)]+_0x5bb823(0x10f))[_0x5bb823(0x152)]();if(_0x3c8033[_0x5bb823(0x177)]===flosum_repository_sync_dto_1[_0x5bb823(0x14b)]['FlosumToGit']){const _0x5f1f11=typedi_1['Container'][_0x5bb823(0x14e)](flosum_sync_job_1[_0x5bb823(0x140)]);await _0x5f1f11[_0x5bb823(0x104)]({'repository':_0x26938c,'convertToSFDX':this[_0x5bb823(0x16f)][_0x5bb823(0x117)],'syncRecord':_0x3c8033,'provider':this['config']['gitProvider']})[_0x5bb823(0x144)](_0x34c5ef=>this[_0x5bb823(0x14c)](_0x3c8033,_0x34c5ef));}else{const _0x19191e=typedi_1[_0x5bb823(0x136)][_0x5bb823(0x14e)](git_sync_job_1[_0x5bb823(0x16e)]);await _0x19191e[_0x5bb823(0x104)]({'repository':_0x26938c,'branch':_0x3c8033[_0x5bb823(0x14d)],'provider':this[_0x5bb823(0x16f)]['gitProvider'],'repositoryGit':_0x26938c[_0x5bb823(0x175)],'syncRecord':_0x3c8033})['catch'](_0x35914a=>this['handleRecordSyncError'](_0x3c8033,_0x35914a));}}}catch(_0x1deadd){this['logger'][_0x5bb823(0x11e)](_0x1deadd);_0x1deadd instanceof too_many_requests_error_1[_0x5bb823(0x169)]?(await this['sfLogger'][_0x5bb823(0x13c)](this['prefix']+_0x5bb823(0x14a))['send'](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0x5bb823(0x104)]()):await this[_0x5bb823(0x164)][_0x5bb823(0x11e)](this[_0x5bb823(0x138)]+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x1deadd)['send']();return;}await this['sfLogger'][_0x5bb823(0x13c)](this[_0x5bb823(0x138)]+_0x5bb823(0x12e))[_0x5bb823(0x152)](),await this[_0x5bb823(0x14f)][_0x5bb823(0x123)](typedi_1[_0x5bb823(0x136)][_0x5bb823(0x14e)](providers_tokens_1['Tokens'][_0x5bb823(0x128)]))[_0x5bb823(0x144)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a80_0x5eafab(0x121)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a80_0x5eafab(0x10a)],salesforce_sync_service_1[a80_0x5eafab(0x154)]])],SyncService),exports[a80_0x5eafab(0x150)]=SyncService;