const a113_0x462940=a113_0x2a8b;(function(_0x42f145,_0xba5d5c){const _0x3610e2=a113_0x2a8b,_0x1453bf=_0x42f145();while(!![]){try{const _0x58def8=-parseInt(_0x3610e2(0x19d))/0x1*(parseInt(_0x3610e2(0x13a))/0x2)+parseInt(_0x3610e2(0x142))/0x3*(-parseInt(_0x3610e2(0x1a6))/0x4)+parseInt(_0x3610e2(0x1b4))/0x5+-parseInt(_0x3610e2(0x182))/0x6+-parseInt(_0x3610e2(0x176))/0x7*(parseInt(_0x3610e2(0x179))/0x8)+parseInt(_0x3610e2(0x144))/0x9*(-parseInt(_0x3610e2(0x187))/0xa)+parseInt(_0x3610e2(0x16a))/0xb;if(_0x58def8===_0xba5d5c)break;else _0x1453bf['push'](_0x1453bf['shift']());}catch(_0x55405e){_0x1453bf['push'](_0x1453bf['shift']());}}}(a113_0x1d30,0xc374b));function a113_0x2a8b(_0x365ac1,_0x1e85d9){const _0xcbe11a=a113_0x1d30();return a113_0x2a8b=function(_0x225bb1,_0x16e608){_0x225bb1=_0x225bb1-0x133;let _0x1d30e3=_0xcbe11a[_0x225bb1];return _0x1d30e3;},a113_0x2a8b(_0x365ac1,_0x1e85d9);}const a113_0x16e608=(function(){let _0x5ae2bd=!![];return function(_0x4bb04f,_0xd24c85){const _0x50d287=_0x5ae2bd?function(){const _0x5dd2e6=a113_0x2a8b;if(_0xd24c85){const _0x4b0338=_0xd24c85[_0x5dd2e6(0x1a8)](_0x4bb04f,arguments);return _0xd24c85=null,_0x4b0338;}}:function(){};return _0x5ae2bd=![],_0x50d287;};}()),a113_0x225bb1=a113_0x16e608(this,function(){const _0x1b39a4=a113_0x2a8b;return a113_0x225bb1[_0x1b39a4(0x1a4)]()[_0x1b39a4(0x164)]('(((.+)+)+)+$')['toString']()[_0x1b39a4(0x13d)](a113_0x225bb1)[_0x1b39a4(0x164)](_0x1b39a4(0x180));});a113_0x225bb1();'use strict';var __decorate=this&&this[a113_0x462940(0x184)]||function(_0x3da256,_0x214b68,_0x11f653,_0x9d11d0){const _0xb43f9b=a113_0x462940;var _0x48d75a=arguments[_0xb43f9b(0x16c)],_0x231325=_0x48d75a<0x3?_0x214b68:_0x9d11d0===null?_0x9d11d0=Object[_0xb43f9b(0x1ab)](_0x214b68,_0x11f653):_0x9d11d0,_0x547337;if(typeof Reflect===_0xb43f9b(0x170)&&typeof Reflect[_0xb43f9b(0x172)]==='function')_0x231325=Reflect[_0xb43f9b(0x172)](_0x3da256,_0x214b68,_0x11f653,_0x9d11d0);else{for(var _0x57bac3=_0x3da256[_0xb43f9b(0x16c)]-0x1;_0x57bac3>=0x0;_0x57bac3--)if(_0x547337=_0x3da256[_0x57bac3])_0x231325=(_0x48d75a<0x3?_0x547337(_0x231325):_0x48d75a>0x3?_0x547337(_0x214b68,_0x11f653,_0x231325):_0x547337(_0x214b68,_0x11f653))||_0x231325;}return _0x48d75a>0x3&&_0x231325&&Object[_0xb43f9b(0x18a)](_0x214b68,_0x11f653,_0x231325),_0x231325;},__metadata=this&&this[a113_0x462940(0x18e)]||function(_0x15ef5a,_0x47c427){const _0x3c5017=a113_0x462940;if(typeof Reflect===_0x3c5017(0x170)&&typeof Reflect[_0x3c5017(0x1af)]==='function')return Reflect['metadata'](_0x15ef5a,_0x47c427);},SyncService_1;function a113_0x1d30(){const _0x4c4425=['search','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','design:paramtypes','test','../../providers/web-hooks/hooks.utils','\x27\x20-\x20\x27','37892910kQmYua','../../providers/providers.tokens','length','updateRemoteState','Waiting','../../../../core','object','\x20Completed\x20prepare\x20to\x20syncing.','decorate','Logger','SalesforceService','getLoggerId','400421cJNwfC','log','config','72EjnwNn','get','applicationUrl','handleRecordSyncError','HooksUtils','\x20Start\x20sync\x20job.','branchName','(((.+)+)+)+$','../../salesforce/services/salesforce-sync.service','4892028GmAasq','salesforceSync','__decorate','Container','Error','462910iNqfEQ','repositoriesIntersections','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','defineProperty','Service','repositoryId','\x20Getting\x20repository\x20records.','__metadata','\x20Getting\x20repositories\x20from\x20git\x20service.','url','\x22\x20branch:\x20\x22','repositoryName','create','\x20Getting\x20branch\x20records.','createHookPayload','isConvertToSfdx','isIntersects','../jobs/git-sync.job','getRepositoryRecords','error','../jobs/flosum-sync.job','find','189tpJKgA','map','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','salesforceService','\x20No\x20repositories\x20to\x20sync.','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','push','toString','SyncDirection','4CjSpcu','checkValidNaming','apply','\x20Stop\x20sync\x20job\x20for\x20\x27','SalesforceSyncService','getOwnPropertyDescriptor','BRANCH_NAME_REGEXP','\x20Repository\x20\x22','gitApiService','metadata','\x27\x20[','../../../../core/errors/bad-request.error','name','\x20Getting\x20Flosum\x20repository','6691185OYRotg','Tokens','../../../shared/utils','Unable\x20to\x20synchronize\x20branch\x20\x27','repoList','branchId','direction','sleep','__esModule','15660LzghYx','getAll','sfLogger','constructor','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','../errors/git-branch-not-found.error','isBidirectionalSynchronization','../../../../constants','2961783flNVzw','TooManyRequests','36wkhHkC','hooks','\x20Syncing\x20repository:\x20\x22','join','gitProvider','../../../../core/errors/too-many-requests.error','logger','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.',']\x20due\x20error\x20-\x20','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','toUpperCase','catch','\x20Checking\x20intersects.','setStatus','BadRequestError','disableSync','\x20Have\x20to\x20synchronize\x20','connectionId','send','repoService',']\x20repository\x20','FlosumToGit','SalesforceError','\x20Sync\x20job\x20done.',']\x20[','prefix','\x20Checking\x20valid\x20name.','toLowerCase','getOrCreateRepo','gitUrl','run','SyncService'];a113_0x1d30=function(){return _0x4c4425;};return a113_0x1d30();}Object[a113_0x462940(0x18a)](exports,a113_0x462940(0x139),{'value':!![]}),exports[a113_0x462940(0x163)]=void 0x0;const constants_1=require(a113_0x462940(0x141)),core_1=require(a113_0x462940(0x16f)),too_many_requests_error_1=require(a113_0x462940(0x149)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require(a113_0x462940(0x181)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),utils_1=require(a113_0x462940(0x133)),typedi_1=require('typedi'),hooks_utils_1=require(a113_0x462940(0x168)),git_branch_not_found_error_1=require(a113_0x462940(0x13f)),flosum_sync_job_1=require(a113_0x462940(0x19b)),git_sync_job_1=require(a113_0x462940(0x198)),providers_tokens_1=require(a113_0x462940(0x16b)),bad_request_error_1=require(a113_0x462940(0x1b1));let SyncService=SyncService_1=class SyncService{constructor(_0x46e08f,_0xd8ca4f){const _0x508c5b=a113_0x462940;this[_0x508c5b(0x1a0)]=_0x46e08f,this[_0x508c5b(0x183)]=_0xd8ca4f,this[_0x508c5b(0x14a)]=new core_1[(_0x508c5b(0x173))](SyncService_1[_0x508c5b(0x1b2)]),this[_0x508c5b(0x188)]={},this[_0x508c5b(0x135)]=[];}async[a113_0x462940(0x17c)](_0x52c5dd,_0x4362f2){const _0x4825ce=a113_0x462940;if(_0x4362f2 instanceof git_branch_not_found_error_1['GitBranchNotFoundError']){await this[_0x4825ce(0x183)][_0x4825ce(0x151)](_0x52c5dd,'Not\x20Synchronized');return;}if(_0x4362f2 instanceof too_many_requests_error_1[_0x4825ce(0x143)]){await this[_0x4825ce(0x183)][_0x4825ce(0x151)](_0x52c5dd,_0x4825ce(0x16e));throw _0x4362f2;}try{await this['sfLogger']['error'](this[_0x4825ce(0x15d)]+_0x4825ce(0x1a9)+_0x52c5dd[_0x4825ce(0x192)]+_0x4825ce(0x1b0)+_0x52c5dd[_0x4825ce(0x17f)]+_0x4825ce(0x14c)+_0x4362f2+'.')[_0x4825ce(0x156)](),await this[_0x4825ce(0x183)][_0x4825ce(0x16d)](_0x52c5dd,{}),await this['salesforceSync'][_0x4825ce(0x151)](_0x52c5dd,_0x4825ce(0x186));}catch(_0x22e22f){if(_0x22e22f instanceof salesforce_error_1[_0x4825ce(0x15a)])throw _0x22e22f;}}async[a113_0x462940(0x197)](_0x212df7){const _0x35f978=a113_0x462940;if(_0x212df7[_0x35f978(0x18c)]){const _0x36d80c=_0x212df7[_0x35f978(0x192)][_0x35f978(0x15f)](),_0x8c54e9=this[_0x35f978(0x188)][_0x36d80c];if(!_0x8c54e9)this[_0x35f978(0x188)][_0x36d80c]=_0x212df7[_0x35f978(0x192)];else{if(_0x8c54e9&&_0x8c54e9!==_0x212df7[_0x35f978(0x192)])return await this['handleRecordSyncError'](_0x212df7,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x212df7['repositoryName']+_0x35f978(0x14d)+_0x36d80c+_0x35f978(0x169)+_0x8c54e9+'\x27')),!![];}}return![];}async[a113_0x462940(0x1a7)](_0x2a24e8){const _0x1da950=a113_0x462940;if(!constants_1['REPOSITORY_NAME_REGEXP'][_0x1da950(0x167)](_0x2a24e8[_0x1da950(0x192)]))return await this[_0x1da950(0x17c)](_0x2a24e8,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x2a24e8['repositoryName']+_0x1da950(0x13e))),![];if(!constants_1[_0x1da950(0x1ac)][_0x1da950(0x167)](_0x2a24e8[_0x1da950(0x17f)]))return await this['handleRecordSyncError'](_0x2a24e8,new Error(_0x1da950(0x134)+_0x2a24e8[_0x1da950(0x17f)]+'\x27\x20in\x20repository\x20\x27'+_0x2a24e8[_0x1da950(0x192)]+_0x1da950(0x19f))),![];return!![];}async[a113_0x462940(0x160)](_0x8641ac,_0x3223e5){const _0x14e736=a113_0x462940;let _0x806de6=this[_0x14e736(0x135)][_0x14e736(0x19c)](_0x527d81=>_0x8641ac[_0x14e736(0x192)]===_0x527d81[_0x14e736(0x1b2)]);!_0x806de6&&(this[_0x14e736(0x13c)][_0x14e736(0x177)](this[_0x14e736(0x15d)]+_0x14e736(0x1ad)+_0x8641ac[_0x14e736(0x192)]+_0x14e736(0x165)),_0x806de6=await this[_0x14e736(0x157)]['create']({'name':_0x8641ac['repositoryName'],'autoInit':!![],'defaultBranch':_0x8641ac['branchName'],'private':!![],'createHook':typedi_1[_0x14e736(0x185)][_0x14e736(0x17a)](providers_tokens_1[_0x14e736(0x1b5)][_0x14e736(0x178)])[_0x14e736(0x140)]}));if(this[_0x14e736(0x178)][_0x14e736(0x140)]){const _0x818a98=await _0x806de6['hooks'][_0x14e736(0x13b)]();!_0x818a98[_0x14e736(0x19c)](_0x523b69=>_0x523b69[_0x14e736(0x190)]===hooks_utils_1[_0x14e736(0x17d)]['getHookLinkFor'](this['config'][_0x14e736(0x148)],this['config']['applicationUrl'],_0x3223e5))&&(this['sfLogger'][_0x14e736(0x177)](this[_0x14e736(0x15d)]+_0x14e736(0x1ad)+_0x8641ac['repositoryName']+_0x14e736(0x14b)),await _0x806de6[_0x14e736(0x145)][_0x14e736(0x193)](hooks_utils_1[_0x14e736(0x17d)][_0x14e736(0x195)](this['config'][_0x14e736(0x148)],_0x806de6[_0x14e736(0x145)],this[_0x14e736(0x178)][_0x14e736(0x17b)],_0x3223e5)));}return this[_0x14e736(0x135)][_0x14e736(0x1a3)](_0x806de6),_0x806de6;}async[a113_0x462940(0x162)](){const _0x365a3c=a113_0x462940;this[_0x365a3c(0x1ae)]=typedi_1[_0x365a3c(0x185)][_0x365a3c(0x17a)](providers_tokens_1[_0x365a3c(0x1b5)][_0x365a3c(0x1ae)]),this[_0x365a3c(0x157)]=typedi_1[_0x365a3c(0x185)]['get'](providers_tokens_1[_0x365a3c(0x1b5)]['gitRepoService']),this[_0x365a3c(0x178)]=typedi_1[_0x365a3c(0x185)][_0x365a3c(0x17a)](providers_tokens_1['Tokens'][_0x365a3c(0x178)]),this[_0x365a3c(0x13c)]=typedi_1[_0x365a3c(0x185)][_0x365a3c(0x17a)](providers_tokens_1[_0x365a3c(0x1b5)][_0x365a3c(0x14a)]),this[_0x365a3c(0x15d)]='['+SyncService_1[_0x365a3c(0x1b2)]+_0x365a3c(0x15c)+this[_0x365a3c(0x178)][_0x365a3c(0x148)][_0x365a3c(0x14e)]()+']',this[_0x365a3c(0x1a0)]['setLoggerId'](this[_0x365a3c(0x13c)][_0x365a3c(0x175)]());try{this['sfLogger'][_0x365a3c(0x177)](this[_0x365a3c(0x15d)]+_0x365a3c(0x17e)),await this[_0x365a3c(0x13c)][_0x365a3c(0x177)](this['prefix']+_0x365a3c(0x18d))['send']();const _0x2c1a5a=await this[_0x365a3c(0x183)][_0x365a3c(0x199)](typedi_1[_0x365a3c(0x185)][_0x365a3c(0x17a)](providers_tokens_1['Tokens'][_0x365a3c(0x155)]));if(!_0x2c1a5a['length'])throw new bad_request_error_1[(_0x365a3c(0x152))](this[_0x365a3c(0x15d)]+_0x365a3c(0x1a1));await this[_0x365a3c(0x13c)][_0x365a3c(0x177)](this[_0x365a3c(0x15d)]+_0x365a3c(0x194))['send']();const _0x92bf80=await this[_0x365a3c(0x183)]['getBranchRecords'](_0x2c1a5a[_0x365a3c(0x19e)](_0x400135=>'\x27'+_0x400135[_0x365a3c(0x18c)]+'\x27')[_0x365a3c(0x147)](','));await this[_0x365a3c(0x13c)]['log'](this[_0x365a3c(0x15d)]+_0x365a3c(0x18f))[_0x365a3c(0x156)](),this[_0x365a3c(0x135)]=await this[_0x365a3c(0x157)][_0x365a3c(0x13b)]();const _0x272c97=[..._0x2c1a5a,..._0x92bf80];this[_0x365a3c(0x13c)][_0x365a3c(0x177)](this[_0x365a3c(0x15d)]+_0x365a3c(0x154)+_0x272c97[_0x365a3c(0x16c)]+'\x20branches.');for(const _0x188e64 of _0x272c97){this[_0x365a3c(0x14a)]['log']('Syncing\x20'+_0x188e64['repositoryName']+'['+_0x188e64[_0x365a3c(0x18c)]+_0x365a3c(0x158)+_0x188e64['branchName']+'['+_0x188e64[_0x365a3c(0x136)]+']\x20branch.'),this['sfLogger'][_0x365a3c(0x177)](this['prefix']+_0x365a3c(0x146)+_0x188e64['repositoryName']+_0x365a3c(0x191)+_0x188e64[_0x365a3c(0x17f)]+'\x22.'),this[_0x365a3c(0x13c)][_0x365a3c(0x177)](this['prefix']+_0x365a3c(0x15e));const _0x1e5a75=await this[_0x365a3c(0x1a7)](_0x188e64);if(!_0x1e5a75)continue;this[_0x365a3c(0x13c)][_0x365a3c(0x177)](this[_0x365a3c(0x15d)]+_0x365a3c(0x150));const _0x52253b=await this['isIntersects'](_0x188e64);if(_0x52253b)continue;await this[_0x365a3c(0x13c)][_0x365a3c(0x156)]();let _0x190b07;try{await this[_0x365a3c(0x13c)][_0x365a3c(0x177)](this['prefix']+_0x365a3c(0x1b3))[_0x365a3c(0x156)](),_0x190b07=await this['getOrCreateRepo'](_0x188e64,typedi_1[_0x365a3c(0x185)][_0x365a3c(0x17a)](providers_tokens_1['Tokens'][_0x365a3c(0x155)]));}catch(_0x4872b5){await this[_0x365a3c(0x17c)](_0x188e64,_0x4872b5 instanceof too_many_requests_error_1['TooManyRequests']?_0x4872b5:new Error(_0x365a3c(0x1a2)+_0x4872b5));continue;}await this[_0x365a3c(0x13c)][_0x365a3c(0x177)](this[_0x365a3c(0x15d)]+_0x365a3c(0x171))[_0x365a3c(0x156)]();if(_0x188e64[_0x365a3c(0x137)]===flosum_repository_sync_dto_1[_0x365a3c(0x1a5)][_0x365a3c(0x159)]){const _0x4838d1=typedi_1[_0x365a3c(0x185)]['get'](flosum_sync_job_1['FlosumSyncJob']);await _0x4838d1['run']({'repository':_0x190b07,'convertToSFDX':this[_0x365a3c(0x178)][_0x365a3c(0x196)],'syncRecord':_0x188e64,'provider':this[_0x365a3c(0x178)][_0x365a3c(0x148)]})[_0x365a3c(0x14f)](_0x39bf35=>this[_0x365a3c(0x17c)](_0x188e64,_0x39bf35));}else{const _0x124745=typedi_1[_0x365a3c(0x185)][_0x365a3c(0x17a)](git_sync_job_1['GitSyncJob']);await _0x124745[_0x365a3c(0x162)]({'repository':_0x190b07,'branch':_0x188e64[_0x365a3c(0x17f)],'provider':this[_0x365a3c(0x178)]['gitProvider'],'repositoryGit':_0x190b07[_0x365a3c(0x161)],'syncRecord':_0x188e64})[_0x365a3c(0x14f)](_0x38a665=>this['handleRecordSyncError'](_0x188e64,_0x38a665));}}}catch(_0x5ef436){this[_0x365a3c(0x14a)][_0x365a3c(0x19a)](_0x5ef436);_0x5ef436 instanceof too_many_requests_error_1['TooManyRequests']?(await this['sfLogger'][_0x365a3c(0x177)](this[_0x365a3c(0x15d)]+_0x365a3c(0x189))[_0x365a3c(0x156)](),await(0x0,utils_1[_0x365a3c(0x138)])(0x3c*0x3c*0x3e8),this[_0x365a3c(0x162)]()):await this['sfLogger'][_0x365a3c(0x19a)](this[_0x365a3c(0x15d)]+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x5ef436)[_0x365a3c(0x156)]();return;}await this[_0x365a3c(0x13c)][_0x365a3c(0x177)](this['prefix']+_0x365a3c(0x15b))['send'](),await this[_0x365a3c(0x183)][_0x365a3c(0x153)](typedi_1[_0x365a3c(0x185)][_0x365a3c(0x17a)](providers_tokens_1[_0x365a3c(0x1b5)][_0x365a3c(0x155)]))[_0x365a3c(0x14f)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a113_0x462940(0x18b)])({'transient':!![]}),__metadata(a113_0x462940(0x166),[salesforce_service_1[a113_0x462940(0x174)],salesforce_sync_service_1[a113_0x462940(0x1aa)]])],SyncService),exports[a113_0x462940(0x163)]=SyncService;