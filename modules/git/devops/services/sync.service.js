const a80_0x12d89f=a80_0x55db;(function(_0x668b85,_0x2327fc){const _0x5f53f1=a80_0x55db,_0x70b8b5=_0x668b85();while(!![]){try{const _0x411869=-parseInt(_0x5f53f1(0x124))/0x1+parseInt(_0x5f53f1(0x147))/0x2+-parseInt(_0x5f53f1(0x126))/0x3*(parseInt(_0x5f53f1(0xe3))/0x4)+-parseInt(_0x5f53f1(0xe4))/0x5+parseInt(_0x5f53f1(0x11a))/0x6+-parseInt(_0x5f53f1(0xe2))/0x7+parseInt(_0x5f53f1(0x153))/0x8;if(_0x411869===_0x2327fc)break;else _0x70b8b5['push'](_0x70b8b5['shift']());}catch(_0x4e67a1){_0x70b8b5['push'](_0x70b8b5['shift']());}}}(a80_0x148f,0x28ce1));const a80_0x5a67e7=(function(){let _0x20cd83=!![];return function(_0x236d9f,_0x9cb70e){const _0x55454d=_0x20cd83?function(){const _0x3deae1=a80_0x55db;if(_0x9cb70e){const _0xb23a15=_0x9cb70e[_0x3deae1(0xe9)](_0x236d9f,arguments);return _0x9cb70e=null,_0xb23a15;}}:function(){};return _0x20cd83=![],_0x55454d;};}()),a80_0x2c11f0=a80_0x5a67e7(this,function(){const _0x4b2bf7=a80_0x55db;return a80_0x2c11f0[_0x4b2bf7(0x137)]()['search'](_0x4b2bf7(0x12c))['toString']()[_0x4b2bf7(0x11e)](a80_0x2c11f0)['search'](_0x4b2bf7(0x12c));});a80_0x2c11f0();'use strict';var __decorate=this&&this[a80_0x12d89f(0x114)]||function(_0x563372,_0xb751b2,_0xe16d6d,_0x366995){const _0xb5d5ef=a80_0x12d89f;var _0x3c9075=arguments[_0xb5d5ef(0xff)],_0x33e83e=_0x3c9075<0x3?_0xb751b2:_0x366995===null?_0x366995=Object[_0xb5d5ef(0x158)](_0xb751b2,_0xe16d6d):_0x366995,_0x47ddb5;if(typeof Reflect===_0xb5d5ef(0xe6)&&typeof Reflect[_0xb5d5ef(0xf5)]===_0xb5d5ef(0x110))_0x33e83e=Reflect[_0xb5d5ef(0xf5)](_0x563372,_0xb751b2,_0xe16d6d,_0x366995);else{for(var _0x6b2d50=_0x563372[_0xb5d5ef(0xff)]-0x1;_0x6b2d50>=0x0;_0x6b2d50--)if(_0x47ddb5=_0x563372[_0x6b2d50])_0x33e83e=(_0x3c9075<0x3?_0x47ddb5(_0x33e83e):_0x3c9075>0x3?_0x47ddb5(_0xb751b2,_0xe16d6d,_0x33e83e):_0x47ddb5(_0xb751b2,_0xe16d6d))||_0x33e83e;}return _0x3c9075>0x3&&_0x33e83e&&Object[_0xb5d5ef(0x11d)](_0xb751b2,_0xe16d6d,_0x33e83e),_0x33e83e;},__metadata=this&&this[a80_0x12d89f(0xfc)]||function(_0x46465f,_0x2907bd){const _0x41467c=a80_0x12d89f;if(typeof Reflect===_0x41467c(0xe6)&&typeof Reflect[_0x41467c(0x100)]===_0x41467c(0x110))return Reflect[_0x41467c(0x100)](_0x46465f,_0x2907bd);},SyncService_1;Object[a80_0x12d89f(0x11d)](exports,'__esModule',{'value':!![]}),exports[a80_0x12d89f(0x122)]=void 0x0;const constants_1=require(a80_0x12d89f(0x152)),core_1=require(a80_0x12d89f(0x145)),too_many_requests_error_1=require(a80_0x12d89f(0x119)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require(a80_0x12d89f(0xfa)),salesforce_service_1=require(a80_0x12d89f(0x12f)),utils_1=require(a80_0x12d89f(0x116)),typedi_1=require(a80_0x12d89f(0xed)),hooks_utils_1=require('../../providers/web-hooks/hooks.utils'),git_branch_not_found_error_1=require(a80_0x12d89f(0x113)),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require(a80_0x12d89f(0xdf)),bad_request_error_1=require(a80_0x12d89f(0x105));let SyncService=SyncService_1=class SyncService{constructor(_0x16b612,_0x3112c0){const _0x412e46=a80_0x12d89f;this[_0x412e46(0x115)]=_0x16b612,this[_0x412e46(0x135)]=_0x3112c0,this[_0x412e46(0x10f)]=new core_1[(_0x412e46(0x13b))](SyncService_1[_0x412e46(0x112)]),this[_0x412e46(0x146)]={},this[_0x412e46(0x12a)]=[];}async['handleRecordSyncError'](_0x4a5e65,_0x220772){const _0x519de1=a80_0x12d89f;if(_0x220772 instanceof git_branch_not_found_error_1[_0x519de1(0xf4)]){await this[_0x519de1(0x135)][_0x519de1(0x109)](_0x4a5e65,_0x519de1(0x144));return;}if(_0x220772 instanceof too_many_requests_error_1[_0x519de1(0x151)]){await this[_0x519de1(0x135)][_0x519de1(0x109)](_0x4a5e65,_0x519de1(0x131));throw _0x220772;}try{await this[_0x519de1(0x141)][_0x519de1(0x11c)](this['prefix']+_0x519de1(0x108)+_0x4a5e65[_0x519de1(0xf2)]+'\x27\x20['+_0x4a5e65[_0x519de1(0xfb)]+']\x20due\x20error\x20-\x20'+_0x220772+'.')[_0x519de1(0x103)](),await this['salesforceSync'][_0x519de1(0xeb)](_0x4a5e65,{}),await this['salesforceSync'][_0x519de1(0x109)](_0x4a5e65,_0x519de1(0x14d));}catch(_0x4ffb67){if(_0x4ffb67 instanceof salesforce_error_1['SalesforceError'])throw _0x4ffb67;}}async[a80_0x12d89f(0xe0)](_0x2e6f41){const _0x40782d=a80_0x12d89f;if(_0x2e6f41[_0x40782d(0x11f)]){const _0x3fd06d=_0x2e6f41[_0x40782d(0xf2)][_0x40782d(0x136)](),_0x389c9f=this[_0x40782d(0x146)][_0x3fd06d];if(!_0x389c9f)this[_0x40782d(0x146)][_0x3fd06d]=_0x2e6f41[_0x40782d(0xf2)];else{if(_0x389c9f&&_0x389c9f!==_0x2e6f41['repositoryName'])return await this[_0x40782d(0x129)](_0x2e6f41,new Error(_0x40782d(0xf6)+_0x2e6f41['repositoryName']+_0x40782d(0x12e)+_0x3fd06d+_0x40782d(0x143)+_0x389c9f+'\x27')),!![];}}return![];}async[a80_0x12d89f(0x104)](_0x5d7ade){const _0xde10ae=a80_0x12d89f;if(!constants_1[_0xde10ae(0x14b)][_0xde10ae(0x159)](_0x5d7ade[_0xde10ae(0xf2)]))return await this['handleRecordSyncError'](_0x5d7ade,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x5d7ade[_0xde10ae(0xf2)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0xde10ae(0xf9)][_0xde10ae(0x159)](_0x5d7ade['branchName']))return await this[_0xde10ae(0x129)](_0x5d7ade,new Error(_0xde10ae(0x134)+_0x5d7ade[_0xde10ae(0xfb)]+_0xde10ae(0x142)+_0x5d7ade[_0xde10ae(0xf2)]+_0xde10ae(0x155))),![];return!![];}async['getOrCreateRepo'](_0xb97fa3,_0x5d8bbc){const _0x310c5d=a80_0x12d89f;let _0x5b0810=this[_0x310c5d(0x12a)][_0x310c5d(0x150)](_0x2cc05a=>_0xb97fa3['repositoryName']===_0x2cc05a[_0x310c5d(0x112)]);!_0x5b0810&&(this[_0x310c5d(0x141)]['log'](this['prefix']+_0x310c5d(0x127)+_0xb97fa3[_0x310c5d(0xf2)]+_0x310c5d(0xec)),_0x5b0810=await this[_0x310c5d(0xea)][_0x310c5d(0xf0)]({'name':_0xb97fa3[_0x310c5d(0xf2)],'autoInit':!![],'defaultBranch':_0xb97fa3[_0x310c5d(0xfb)],'private':!![],'createHook':typedi_1[_0x310c5d(0xef)][_0x310c5d(0xfd)](providers_tokens_1[_0x310c5d(0xe8)][_0x310c5d(0x139)])[_0x310c5d(0x10e)]}));if(this[_0x310c5d(0x139)][_0x310c5d(0x10e)]){const _0x30dee7=await _0x5b0810[_0x310c5d(0xf3)][_0x310c5d(0x13d)]();!_0x30dee7[_0x310c5d(0x150)](_0x29830c=>_0x29830c['url']===hooks_utils_1[_0x310c5d(0x12b)]['getHookLinkFor'](this[_0x310c5d(0x139)][_0x310c5d(0x111)],this[_0x310c5d(0x139)][_0x310c5d(0x101)],_0x5d8bbc))&&(this['sfLogger']['log'](this[_0x310c5d(0x14e)]+_0x310c5d(0x127)+_0xb97fa3[_0x310c5d(0xf2)]+_0x310c5d(0x12d)),await _0x5b0810[_0x310c5d(0xf3)][_0x310c5d(0xf0)](hooks_utils_1[_0x310c5d(0x12b)]['createHookPayload'](this[_0x310c5d(0x139)]['gitProvider'],_0x5b0810['hooks'],this[_0x310c5d(0x139)][_0x310c5d(0x101)],_0x5d8bbc)));}return this[_0x310c5d(0x12a)][_0x310c5d(0x118)](_0x5b0810),_0x5b0810;}async[a80_0x12d89f(0x11b)](){const _0xa08b6e=a80_0x12d89f;this[_0xa08b6e(0x154)]=typedi_1[_0xa08b6e(0xef)]['get'](providers_tokens_1[_0xa08b6e(0xe8)][_0xa08b6e(0x154)]),this['repoService']=typedi_1[_0xa08b6e(0xef)][_0xa08b6e(0xfd)](providers_tokens_1[_0xa08b6e(0xe8)][_0xa08b6e(0x156)]),this['config']=typedi_1[_0xa08b6e(0xef)][_0xa08b6e(0xfd)](providers_tokens_1[_0xa08b6e(0xe8)][_0xa08b6e(0x139)]),this[_0xa08b6e(0x141)]=typedi_1[_0xa08b6e(0xef)][_0xa08b6e(0xfd)](providers_tokens_1[_0xa08b6e(0xe8)][_0xa08b6e(0x10f)]),this['prefix']='['+SyncService_1[_0xa08b6e(0x112)]+_0xa08b6e(0x130)+this[_0xa08b6e(0x139)]['gitProvider'][_0xa08b6e(0x13f)]()+']',this[_0xa08b6e(0x115)][_0xa08b6e(0x121)](this[_0xa08b6e(0x141)][_0xa08b6e(0x128)]());try{this['sfLogger'][_0xa08b6e(0x140)](this[_0xa08b6e(0x14e)]+_0xa08b6e(0x106)),await this[_0xa08b6e(0x141)][_0xa08b6e(0x140)](this['prefix']+_0xa08b6e(0xe7))[_0xa08b6e(0x103)]();const _0xc0c9ad=await this['salesforceSync'][_0xa08b6e(0x123)](typedi_1[_0xa08b6e(0xef)][_0xa08b6e(0xfd)](providers_tokens_1['Tokens'][_0xa08b6e(0xe5)]));if(!_0xc0c9ad[_0xa08b6e(0xff)])throw new bad_request_error_1[(_0xa08b6e(0x132))](this[_0xa08b6e(0x14e)]+_0xa08b6e(0x138));await this[_0xa08b6e(0x141)][_0xa08b6e(0x140)](this[_0xa08b6e(0x14e)]+'\x20Getting\x20branch\x20records.')[_0xa08b6e(0x103)]();const _0x550aaf=await this[_0xa08b6e(0x135)][_0xa08b6e(0x125)](_0xc0c9ad[_0xa08b6e(0x149)](_0x40a65d=>'\x27'+_0x40a65d[_0xa08b6e(0x11f)]+'\x27')[_0xa08b6e(0x15a)](','));await this['sfLogger'][_0xa08b6e(0x140)](this[_0xa08b6e(0x14e)]+_0xa08b6e(0x14f))['send'](),this[_0xa08b6e(0x12a)]=await this[_0xa08b6e(0xea)][_0xa08b6e(0x13d)]();const _0x4286c8=[..._0xc0c9ad,..._0x550aaf];this[_0xa08b6e(0x141)][_0xa08b6e(0x140)](this[_0xa08b6e(0x14e)]+_0xa08b6e(0xee)+_0x4286c8[_0xa08b6e(0xff)]+_0xa08b6e(0x157));for(const _0x7c168a of _0x4286c8){this[_0xa08b6e(0x10f)][_0xa08b6e(0x140)](_0xa08b6e(0x13a)+_0x7c168a[_0xa08b6e(0xf2)]+'['+_0x7c168a['repositoryId']+_0xa08b6e(0x13e)+_0x7c168a['branchName']+'['+_0x7c168a['branchId']+']\x20branch.'),this[_0xa08b6e(0x141)][_0xa08b6e(0x140)](this[_0xa08b6e(0x14e)]+_0xa08b6e(0xf8)+_0x7c168a['repositoryName']+_0xa08b6e(0x148)+_0x7c168a[_0xa08b6e(0xfb)]+'\x22.'),this[_0xa08b6e(0x141)][_0xa08b6e(0x140)](this['prefix']+'\x20Checking\x20valid\x20name.');const _0x24cbe6=await this[_0xa08b6e(0x104)](_0x7c168a);if(!_0x24cbe6)continue;this[_0xa08b6e(0x141)]['log'](this[_0xa08b6e(0x14e)]+_0xa08b6e(0x120));const _0x1725d5=await this[_0xa08b6e(0xe0)](_0x7c168a);if(_0x1725d5)continue;await this[_0xa08b6e(0x141)][_0xa08b6e(0x103)]();let _0x37f5d1;try{await this[_0xa08b6e(0x141)][_0xa08b6e(0x140)](this[_0xa08b6e(0x14e)]+_0xa08b6e(0x10b))[_0xa08b6e(0x103)](),_0x37f5d1=await this[_0xa08b6e(0x13c)](_0x7c168a,typedi_1[_0xa08b6e(0xef)][_0xa08b6e(0xfd)](providers_tokens_1[_0xa08b6e(0xe8)][_0xa08b6e(0xe5)]));}catch(_0x1e4a19){await this[_0xa08b6e(0x129)](_0x7c168a,_0x1e4a19 instanceof too_many_requests_error_1[_0xa08b6e(0x151)]?_0x1e4a19:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x1e4a19));continue;}await this[_0xa08b6e(0x141)][_0xa08b6e(0x140)](this['prefix']+'\x20Completed\x20prepare\x20to\x20syncing.')[_0xa08b6e(0x103)]();if(_0x7c168a[_0xa08b6e(0x102)]===flosum_repository_sync_dto_1[_0xa08b6e(0x10d)][_0xa08b6e(0x14c)]){const _0xf920a5=typedi_1['Container']['get'](flosum_sync_job_1[_0xa08b6e(0x107)]);await _0xf920a5[_0xa08b6e(0x11b)]({'repository':_0x37f5d1,'convertToSFDX':this['config'][_0xa08b6e(0xf1)],'syncRecord':_0x7c168a,'provider':this[_0xa08b6e(0x139)][_0xa08b6e(0x111)]})[_0xa08b6e(0x10c)](_0x3a660e=>this[_0xa08b6e(0x129)](_0x7c168a,_0x3a660e));}else{const _0x105dbc=typedi_1[_0xa08b6e(0xef)]['get'](git_sync_job_1[_0xa08b6e(0x133)]);await _0x105dbc['run']({'repository':_0x37f5d1,'branch':_0x7c168a[_0xa08b6e(0xfb)],'provider':this[_0xa08b6e(0x139)][_0xa08b6e(0x111)],'repositoryGit':_0x37f5d1[_0xa08b6e(0x10a)],'syncRecord':_0x7c168a})[_0xa08b6e(0x10c)](_0x2e7ffc=>this['handleRecordSyncError'](_0x7c168a,_0x2e7ffc));}}}catch(_0x5a9996){this[_0xa08b6e(0x10f)]['error'](_0x5a9996);_0x5a9996 instanceof too_many_requests_error_1[_0xa08b6e(0x151)]?(await this[_0xa08b6e(0x141)][_0xa08b6e(0x140)](this[_0xa08b6e(0x14e)]+'\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.')[_0xa08b6e(0x103)](),await(0x0,utils_1[_0xa08b6e(0xf7)])(0x3c*0x3c*0x3e8),this[_0xa08b6e(0x11b)]()):await this[_0xa08b6e(0x141)][_0xa08b6e(0x11c)](this[_0xa08b6e(0x14e)]+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x5a9996)['send']();return;}await this[_0xa08b6e(0x141)]['log'](this[_0xa08b6e(0x14e)]+_0xa08b6e(0x117))['send'](),await this[_0xa08b6e(0x135)][_0xa08b6e(0x14a)](typedi_1[_0xa08b6e(0xef)][_0xa08b6e(0xfd)](providers_tokens_1['Tokens'][_0xa08b6e(0xe5)]))['catch'](()=>null);}};function a80_0x55db(_0x51a1bc,_0x18edba){const _0x4941ae=a80_0x148f();return a80_0x55db=function(_0x2c11f0,_0x5a67e7){_0x2c11f0=_0x2c11f0-0xdf;let _0x148f57=_0x4941ae[_0x2c11f0];return _0x148f57;},a80_0x55db(_0x51a1bc,_0x18edba);}function a80_0x148f(){const _0x585f6d=['5864832yXLsZy','gitApiService','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','gitRepoService','\x20branches.','getOwnPropertyDescriptor','test','join','../../providers/providers.tokens','isIntersects','design:paramtypes','1357251BhmjbI','691884ZxwCNr','1451985UkdRVO','connectionId','object','\x20Getting\x20repository\x20records.','Tokens','apply','repoService','updateRemoteState','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','typedi','\x20Have\x20to\x20synchronize\x20','Container','create','isConvertToSfdx','repositoryName','hooks','GitBranchNotFoundError','decorate','Unable\x20to\x20synchronize\x20repository\x20\x27','sleep','\x20Syncing\x20repository:\x20\x22','BRANCH_NAME_REGEXP','../../salesforce/services/salesforce-sync.service','branchName','__metadata','get','SalesforceService','length','metadata','applicationUrl','direction','send','checkValidNaming','../../../../core/errors/bad-request.error','\x20Start\x20sync\x20job.','FlosumSyncJob','\x20Stop\x20sync\x20job\x20for\x20\x27','setStatus','gitUrl','\x20Getting\x20Flosum\x20repository','catch','SyncDirection','isBidirectionalSynchronization','logger','function','gitProvider','name','../errors/git-branch-not-found.error','__decorate','salesforceService','../../../shared/utils','\x20Sync\x20job\x20done.','push','../../../../core/errors/too-many-requests.error','914646XPqYBE','run','error','defineProperty','constructor','repositoryId','\x20Checking\x20intersects.','setLoggerId','SyncService','getRepositoryRecords','315471zfkfqx','getBranchRecords','3OsAsgW','\x20Repository\x20\x22','getLoggerId','handleRecordSyncError','repoList','HooksUtils','(((.+)+)+)+$','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','../../salesforce/services/salesforce.service',']\x20[','Waiting','BadRequestError','GitSyncJob','Unable\x20to\x20synchronize\x20branch\x20\x27','salesforceSync','toLowerCase','toString','\x20No\x20repositories\x20to\x20sync.','config','Syncing\x20','Logger','getOrCreateRepo','getAll',']\x20repository\x20','toUpperCase','log','sfLogger','\x27\x20in\x20repository\x20\x27','\x27\x20-\x20\x27','Not\x20Synchronized','../../../../core','repositoriesIntersections','508648UvRgbd','\x22\x20branch:\x20\x22','map','disableSync','REPOSITORY_NAME_REGEXP','FlosumToGit','Error','prefix','\x20Getting\x20repositories\x20from\x20git\x20service.','find','TooManyRequests','../../../../constants'];a80_0x148f=function(){return _0x585f6d;};return a80_0x148f();}SyncService=SyncService_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a80_0x12d89f(0xe1),[salesforce_service_1[a80_0x12d89f(0xfe)],salesforce_sync_service_1['SalesforceSyncService']])],SyncService),exports[a80_0x12d89f(0x122)]=SyncService;