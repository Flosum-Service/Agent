const a111_0x5bf024=a111_0x5570;(function(_0x5ad873,_0x3b6a53){const _0x25998b=a111_0x5570,_0x160ca9=_0x5ad873();while(!![]){try{const _0x54ffcc=parseInt(_0x25998b(0x12c))/0x1*(-parseInt(_0x25998b(0x15c))/0x2)+-parseInt(_0x25998b(0x14c))/0x3+parseInt(_0x25998b(0x175))/0x4*(-parseInt(_0x25998b(0x173))/0x5)+-parseInt(_0x25998b(0x155))/0x6*(parseInt(_0x25998b(0x14b))/0x7)+-parseInt(_0x25998b(0x170))/0x8+-parseInt(_0x25998b(0x124))/0x9+parseInt(_0x25998b(0x158))/0xa;if(_0x54ffcc===_0x3b6a53)break;else _0x160ca9['push'](_0x160ca9['shift']());}catch(_0x36cfd1){_0x160ca9['push'](_0x160ca9['shift']());}}}(a111_0x4f11,0xa5be0));const a111_0x159f32=(function(){let _0x5bc5ae=!![];return function(_0x5d3da1,_0x4a787e){const _0x141b1d=_0x5bc5ae?function(){const _0x3b005a=a111_0x5570;if(_0x4a787e){const _0x40a14a=_0x4a787e[_0x3b005a(0x108)](_0x5d3da1,arguments);return _0x4a787e=null,_0x40a14a;}}:function(){};return _0x5bc5ae=![],_0x141b1d;};}()),a111_0x430642=a111_0x159f32(this,function(){const _0x39ab5b=a111_0x5570;return a111_0x430642[_0x39ab5b(0x16f)]()[_0x39ab5b(0x166)](_0x39ab5b(0x12d))[_0x39ab5b(0x16f)]()[_0x39ab5b(0x162)](a111_0x430642)['search'](_0x39ab5b(0x12d));});a111_0x430642();'use strict';var __decorate=this&&this[a111_0x5bf024(0x154)]||function(_0x2388c9,_0x57f406,_0x1c354b,_0x2803a6){const _0x1335dc=a111_0x5bf024;var _0x35554e=arguments['length'],_0xf2184c=_0x35554e<0x3?_0x57f406:_0x2803a6===null?_0x2803a6=Object['getOwnPropertyDescriptor'](_0x57f406,_0x1c354b):_0x2803a6,_0x2f1562;if(typeof Reflect===_0x1335dc(0x16c)&&typeof Reflect[_0x1335dc(0x148)]==='function')_0xf2184c=Reflect[_0x1335dc(0x148)](_0x2388c9,_0x57f406,_0x1c354b,_0x2803a6);else{for(var _0x114771=_0x2388c9[_0x1335dc(0x133)]-0x1;_0x114771>=0x0;_0x114771--)if(_0x2f1562=_0x2388c9[_0x114771])_0xf2184c=(_0x35554e<0x3?_0x2f1562(_0xf2184c):_0x35554e>0x3?_0x2f1562(_0x57f406,_0x1c354b,_0xf2184c):_0x2f1562(_0x57f406,_0x1c354b))||_0xf2184c;}return _0x35554e>0x3&&_0xf2184c&&Object['defineProperty'](_0x57f406,_0x1c354b,_0xf2184c),_0xf2184c;},__metadata=this&&this['__metadata']||function(_0x1fb9b7,_0x3313ae){const _0x21edea=a111_0x5bf024;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x21edea(0x167))return Reflect['metadata'](_0x1fb9b7,_0x3313ae);},SyncService_1;Object[a111_0x5bf024(0x153)](exports,'__esModule',{'value':!![]}),exports[a111_0x5bf024(0x138)]=void 0x0;function a111_0x5570(_0x364115,_0x531306){const _0x34b83b=a111_0x4f11();return a111_0x5570=function(_0x430642,_0x159f32){_0x430642=_0x430642-0x104;let _0x4f11c7=_0x34b83b[_0x430642];return _0x4f11c7;},a111_0x5570(_0x364115,_0x531306);}const constants_1=require(a111_0x5bf024(0x159)),core_1=require('../../../../core'),too_many_requests_error_1=require(a111_0x5bf024(0x140)),flosum_repository_sync_dto_1=require(a111_0x5bf024(0x122)),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require(a111_0x5bf024(0x160)),salesforce_service_1=require(a111_0x5bf024(0x13d)),utils_1=require('../../../shared/utils'),typedi_1=require(a111_0x5bf024(0x150)),hooks_utils_1=require(a111_0x5bf024(0x113)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require(a111_0x5bf024(0x127)),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require('../../providers/providers.tokens'),bad_request_error_1=require(a111_0x5bf024(0x10c));let SyncService=SyncService_1=class SyncService{constructor(_0x14fb55,_0x2b2d77){const _0x41964e=a111_0x5bf024;this[_0x41964e(0x15e)]=_0x14fb55,this[_0x41964e(0x15d)]=_0x2b2d77,this[_0x41964e(0x11f)]=new core_1[(_0x41964e(0x119))](SyncService_1[_0x41964e(0x128)]),this[_0x41964e(0x14a)]={},this['repoList']=[];}async['handleRecordSyncError'](_0x18c7d3,_0x13896e){const _0x1a3efd=a111_0x5bf024;if(_0x13896e instanceof git_branch_not_found_error_1[_0x1a3efd(0x123)]){await this[_0x1a3efd(0x15d)][_0x1a3efd(0x10b)](_0x18c7d3,_0x1a3efd(0x149));return;}if(_0x13896e instanceof too_many_requests_error_1[_0x1a3efd(0x105)]){await this[_0x1a3efd(0x15d)][_0x1a3efd(0x10b)](_0x18c7d3,_0x1a3efd(0x120));throw _0x13896e;}try{await this[_0x1a3efd(0x144)][_0x1a3efd(0x141)](this[_0x1a3efd(0x11e)]+_0x1a3efd(0x151)+_0x18c7d3[_0x1a3efd(0x110)]+'\x27\x20['+_0x18c7d3[_0x1a3efd(0x164)]+_0x1a3efd(0x177)+_0x13896e+'.')[_0x1a3efd(0x11d)](),await this[_0x1a3efd(0x15d)][_0x1a3efd(0x11a)](_0x18c7d3,{}),await this['salesforceSync']['setStatus'](_0x18c7d3,'Error');}catch(_0x2f86ae){if(_0x2f86ae instanceof salesforce_error_1[_0x1a3efd(0x169)])throw _0x2f86ae;}}async['isIntersects'](_0x5e3aa5){const _0x511149=a111_0x5bf024;if(_0x5e3aa5['repositoryId']){const _0x436f14=_0x5e3aa5[_0x511149(0x110)][_0x511149(0x134)](),_0x11e376=this[_0x511149(0x14a)][_0x436f14];if(!_0x11e376)this['repositoriesIntersections'][_0x436f14]=_0x5e3aa5['repositoryName'];else{if(_0x11e376&&_0x11e376!==_0x5e3aa5[_0x511149(0x110)])return await this[_0x511149(0x14e)](_0x5e3aa5,new Error(_0x511149(0x179)+_0x5e3aa5[_0x511149(0x110)]+_0x511149(0x171)+_0x436f14+_0x511149(0x156)+_0x11e376+'\x27')),!![];}}return![];}async[a111_0x5bf024(0x16a)](_0x2780a9){const _0x1c1e7e=a111_0x5bf024;if(!constants_1[_0x1c1e7e(0x107)]['test'](_0x2780a9[_0x1c1e7e(0x110)]))return await this[_0x1c1e7e(0x14e)](_0x2780a9,new Error(_0x1c1e7e(0x179)+_0x2780a9[_0x1c1e7e(0x110)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x1c1e7e(0x165)][_0x1c1e7e(0x14d)](_0x2780a9['branchName']))return await this['handleRecordSyncError'](_0x2780a9,new Error(_0x1c1e7e(0x131)+_0x2780a9[_0x1c1e7e(0x164)]+'\x27\x20in\x20repository\x20\x27'+_0x2780a9[_0x1c1e7e(0x110)]+_0x1c1e7e(0x163))),![];return!![];}async['getOrCreateRepo'](_0x47cbf9,_0x5b7b69){const _0xd2f935=a111_0x5bf024;let _0xdadea3=this[_0xd2f935(0x12a)][_0xd2f935(0x143)](_0x52ab01=>_0x47cbf9[_0xd2f935(0x110)]===_0x52ab01[_0xd2f935(0x128)]);!_0xdadea3&&(this['sfLogger'][_0xd2f935(0x136)](this['prefix']+_0xd2f935(0x17a)+_0x47cbf9['repositoryName']+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0xdadea3=await this[_0xd2f935(0x178)][_0xd2f935(0x16d)]({'name':_0x47cbf9[_0xd2f935(0x110)],'autoInit':!![],'defaultBranch':_0x47cbf9[_0xd2f935(0x164)],'private':!![],'createHook':typedi_1['Container'][_0xd2f935(0x118)](providers_tokens_1[_0xd2f935(0x152)][_0xd2f935(0x115)])[_0xd2f935(0x146)]}));if(this[_0xd2f935(0x115)][_0xd2f935(0x146)]){const _0x450809=await _0xdadea3['hooks']['getAll']();!_0x450809[_0xd2f935(0x143)](_0x30eb1e=>_0x30eb1e[_0xd2f935(0x137)]===hooks_utils_1['HooksUtils'][_0xd2f935(0x129)](this['config']['gitProvider'],this[_0xd2f935(0x115)][_0xd2f935(0x11c)],_0x5b7b69))&&(this[_0xd2f935(0x144)][_0xd2f935(0x136)](this[_0xd2f935(0x11e)]+_0xd2f935(0x17a)+_0x47cbf9['repositoryName']+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0xdadea3[_0xd2f935(0x135)][_0xd2f935(0x16d)](hooks_utils_1[_0xd2f935(0x15a)][_0xd2f935(0x109)](this[_0xd2f935(0x115)]['gitProvider'],_0xdadea3['hooks'],this[_0xd2f935(0x115)][_0xd2f935(0x11c)],_0x5b7b69)));}return this[_0xd2f935(0x12a)]['push'](_0xdadea3),_0xdadea3;}async[a111_0x5bf024(0x12e)](){const _0x4df589=a111_0x5bf024;this['gitApiService']=typedi_1[_0x4df589(0x121)]['get'](providers_tokens_1['Tokens'][_0x4df589(0x12b)]),this['repoService']=typedi_1['Container'][_0x4df589(0x118)](providers_tokens_1[_0x4df589(0x152)][_0x4df589(0x16b)]),this['config']=typedi_1[_0x4df589(0x121)][_0x4df589(0x118)](providers_tokens_1[_0x4df589(0x152)]['config']),this['sfLogger']=typedi_1['Container'][_0x4df589(0x118)](providers_tokens_1[_0x4df589(0x152)][_0x4df589(0x11f)]),this[_0x4df589(0x11e)]='['+SyncService_1['name']+']\x20['+this['config'][_0x4df589(0x14f)]['toUpperCase']()+']',this[_0x4df589(0x15e)][_0x4df589(0x106)](this[_0x4df589(0x144)]['getLoggerId']());try{this[_0x4df589(0x144)][_0x4df589(0x136)](this[_0x4df589(0x11e)]+_0x4df589(0x176)),await this[_0x4df589(0x144)][_0x4df589(0x136)](this[_0x4df589(0x11e)]+_0x4df589(0x10d))['send']();const _0x2cf5b8=await this[_0x4df589(0x15d)][_0x4df589(0x10f)](typedi_1[_0x4df589(0x121)]['get'](providers_tokens_1['Tokens'][_0x4df589(0x142)]));if(!_0x2cf5b8['length'])throw new bad_request_error_1[(_0x4df589(0x13e))](this[_0x4df589(0x11e)]+'\x20No\x20repositories\x20to\x20sync.');await this[_0x4df589(0x144)][_0x4df589(0x136)](this[_0x4df589(0x11e)]+_0x4df589(0x16e))[_0x4df589(0x11d)]();const _0x4da303=await this[_0x4df589(0x15d)][_0x4df589(0x174)](_0x2cf5b8['map'](_0x1b914f=>'\x27'+_0x1b914f[_0x4df589(0x104)]+'\x27')['join'](','));await this[_0x4df589(0x144)][_0x4df589(0x136)](this[_0x4df589(0x11e)]+_0x4df589(0x13a))[_0x4df589(0x11d)](),this[_0x4df589(0x12a)]=await this[_0x4df589(0x178)][_0x4df589(0x168)]();const _0x2286a8=[..._0x2cf5b8,..._0x4da303];this[_0x4df589(0x144)][_0x4df589(0x136)](this['prefix']+_0x4df589(0x112)+_0x2286a8[_0x4df589(0x133)]+_0x4df589(0x147));for(const _0x2fd12a of _0x2286a8){this[_0x4df589(0x11f)][_0x4df589(0x136)](_0x4df589(0x114)+_0x2fd12a[_0x4df589(0x110)]+'['+_0x2fd12a[_0x4df589(0x104)]+']\x20repository\x20'+_0x2fd12a[_0x4df589(0x164)]+'['+_0x2fd12a[_0x4df589(0x13b)]+_0x4df589(0x172)),this[_0x4df589(0x144)][_0x4df589(0x136)](this['prefix']+_0x4df589(0x125)+_0x2fd12a[_0x4df589(0x110)]+'\x22\x20branch:\x20\x22'+_0x2fd12a['branchName']+'\x22.'),this[_0x4df589(0x144)][_0x4df589(0x136)](this[_0x4df589(0x11e)]+_0x4df589(0x117));const _0x34b081=await this[_0x4df589(0x16a)](_0x2fd12a);if(!_0x34b081)continue;this['sfLogger']['log'](this[_0x4df589(0x11e)]+'\x20Checking\x20intersects.');const _0xca4a25=await this[_0x4df589(0x145)](_0x2fd12a);if(_0xca4a25)continue;await this[_0x4df589(0x144)][_0x4df589(0x11d)]();let _0x15a1f0;try{await this[_0x4df589(0x144)][_0x4df589(0x136)](this[_0x4df589(0x11e)]+_0x4df589(0x126))['send'](),_0x15a1f0=await this[_0x4df589(0x130)](_0x2fd12a,typedi_1[_0x4df589(0x121)][_0x4df589(0x118)](providers_tokens_1[_0x4df589(0x152)][_0x4df589(0x142)]));}catch(_0x50bfb4){await this[_0x4df589(0x14e)](_0x2fd12a,_0x50bfb4 instanceof too_many_requests_error_1[_0x4df589(0x105)]?_0x50bfb4:new Error(_0x4df589(0x157)+_0x50bfb4));continue;}await this[_0x4df589(0x144)][_0x4df589(0x136)](this['prefix']+_0x4df589(0x12f))['send']();if(_0x2fd12a[_0x4df589(0x10e)]===flosum_repository_sync_dto_1[_0x4df589(0x13f)][_0x4df589(0x10a)]){const _0x3398d6=typedi_1['Container']['get'](flosum_sync_job_1[_0x4df589(0x139)]);await _0x3398d6['run']({'repository':_0x15a1f0,'convertToSFDX':this['config'][_0x4df589(0x161)],'syncRecord':_0x2fd12a,'provider':this[_0x4df589(0x115)][_0x4df589(0x14f)]})[_0x4df589(0x11b)](_0x2d3bf9=>this[_0x4df589(0x14e)](_0x2fd12a,_0x2d3bf9));}else{const _0xd02ab8=typedi_1[_0x4df589(0x121)]['get'](git_sync_job_1[_0x4df589(0x116)]);await _0xd02ab8['run']({'repository':_0x15a1f0,'branch':_0x2fd12a[_0x4df589(0x164)],'provider':this['config']['gitProvider'],'repositoryGit':_0x15a1f0[_0x4df589(0x15f)],'syncRecord':_0x2fd12a})[_0x4df589(0x11b)](_0x4851d3=>this['handleRecordSyncError'](_0x2fd12a,_0x4851d3));}}}catch(_0x559818){this[_0x4df589(0x11f)][_0x4df589(0x141)](_0x559818);_0x559818 instanceof too_many_requests_error_1['TooManyRequests']?(await this['sfLogger'][_0x4df589(0x136)](this[_0x4df589(0x11e)]+_0x4df589(0x13c))[_0x4df589(0x11d)](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0x4df589(0x12e)]()):await this[_0x4df589(0x144)][_0x4df589(0x141)](this[_0x4df589(0x11e)]+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x559818)[_0x4df589(0x11d)]();return;}await this['sfLogger'][_0x4df589(0x136)](this[_0x4df589(0x11e)]+_0x4df589(0x15b))['send'](),await this[_0x4df589(0x15d)]['disableSync'](typedi_1[_0x4df589(0x121)][_0x4df589(0x118)](providers_tokens_1[_0x4df589(0x152)][_0x4df589(0x142)]))[_0x4df589(0x11b)](()=>null);}};function a111_0x4f11(){const _0x4882bf=['isIntersects','isBidirectionalSynchronization','\x20branches.','decorate','Not\x20Synchronized','repositoriesIntersections','20181fTIFzY','3675795gpFbyG','test','handleRecordSyncError','gitProvider','typedi','\x20Stop\x20sync\x20job\x20for\x20\x27','Tokens','defineProperty','__decorate','2622HfpQbI','\x27\x20-\x20\x27','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','63398010dBusKp','../../../../constants','HooksUtils','\x20Sync\x20job\x20done.','52qqzaRD','salesforceSync','salesforceService','gitUrl','../../salesforce/services/salesforce-sync.service','isConvertToSfdx','constructor','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','branchName','BRANCH_NAME_REGEXP','search','function','getAll','SalesforceError','checkValidNaming','gitRepoService','object','create','\x20Getting\x20branch\x20records.','toString','9865440eDAevE','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27',']\x20branch.','3830YhFIqz','getBranchRecords','4496cgMCuX','\x20Start\x20sync\x20job.',']\x20due\x20error\x20-\x20','repoService','Unable\x20to\x20synchronize\x20repository\x20\x27','\x20Repository\x20\x22','repositoryId','TooManyRequests','setLoggerId','REPOSITORY_NAME_REGEXP','apply','createHookPayload','FlosumToGit','setStatus','../../../../core/errors/bad-request.error','\x20Getting\x20repository\x20records.','direction','getRepositoryRecords','repositoryName','SalesforceSyncService','\x20Have\x20to\x20synchronize\x20','../../providers/web-hooks/hooks.utils','Syncing\x20','config','GitSyncJob','\x20Checking\x20valid\x20name.','get','Logger','updateRemoteState','catch','applicationUrl','send','prefix','logger','Waiting','Container','../../salesforce/dto/flosum-repository-sync.dto','GitBranchNotFoundError','5692005JEBGWu','\x20Syncing\x20repository:\x20\x22','\x20Getting\x20Flosum\x20repository','../jobs/flosum-sync.job','name','getHookLinkFor','repoList','gitApiService','17276VlXPfv','(((.+)+)+)+$','run','\x20Completed\x20prepare\x20to\x20syncing.','getOrCreateRepo','Unable\x20to\x20synchronize\x20branch\x20\x27','SalesforceService','length','toLowerCase','hooks','log','url','SyncService','FlosumSyncJob','\x20Getting\x20repositories\x20from\x20git\x20service.','branchId','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','../../salesforce/services/salesforce.service','BadRequestError','SyncDirection','../../../../core/errors/too-many-requests.error','error','connectionId','find','sfLogger'];a111_0x4f11=function(){return _0x4882bf;};return a111_0x4f11();}SyncService=SyncService_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a111_0x5bf024(0x132)],salesforce_sync_service_1[a111_0x5bf024(0x111)]])],SyncService),exports[a111_0x5bf024(0x138)]=SyncService;