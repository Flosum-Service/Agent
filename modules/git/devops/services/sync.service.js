const a111_0x10e4ce=a111_0x3749;(function(_0xf89ab0,_0x324880){const _0x1624a5=a111_0x3749,_0x1f2000=_0xf89ab0();while(!![]){try{const _0x3a6cab=-parseInt(_0x1624a5(0x146))/0x1*(parseInt(_0x1624a5(0x176))/0x2)+-parseInt(_0x1624a5(0x135))/0x3*(-parseInt(_0x1624a5(0x19b))/0x4)+-parseInt(_0x1624a5(0x177))/0x5*(parseInt(_0x1624a5(0x11e))/0x6)+parseInt(_0x1624a5(0x173))/0x7+parseInt(_0x1624a5(0x188))/0x8+-parseInt(_0x1624a5(0x18a))/0x9*(-parseInt(_0x1624a5(0x190))/0xa)+-parseInt(_0x1624a5(0x187))/0xb;if(_0x3a6cab===_0x324880)break;else _0x1f2000['push'](_0x1f2000['shift']());}catch(_0x3dcfc2){_0x1f2000['push'](_0x1f2000['shift']());}}}(a111_0x5752,0xabc42));function a111_0x3749(_0x4fffcd,_0x4eb69d){const _0x3a7150=a111_0x5752();return a111_0x3749=function(_0x434399,_0x2bbf1a){_0x434399=_0x434399-0x11d;let _0x575289=_0x3a7150[_0x434399];return _0x575289;},a111_0x3749(_0x4fffcd,_0x4eb69d);}const a111_0x2bbf1a=(function(){let _0x454c27=!![];return function(_0x278e69,_0x571608){const _0x468947=_0x454c27?function(){const _0xc68f12=a111_0x3749;if(_0x571608){const _0x51f2c1=_0x571608[_0xc68f12(0x179)](_0x278e69,arguments);return _0x571608=null,_0x51f2c1;}}:function(){};return _0x454c27=![],_0x468947;};}()),a111_0x434399=a111_0x2bbf1a(this,function(){const _0x5ea09b=a111_0x3749;return a111_0x434399['toString']()[_0x5ea09b(0x155)](_0x5ea09b(0x157))[_0x5ea09b(0x134)]()[_0x5ea09b(0x121)](a111_0x434399)[_0x5ea09b(0x155)](_0x5ea09b(0x157));});a111_0x434399();'use strict';var __decorate=this&&this[a111_0x10e4ce(0x141)]||function(_0x4afce8,_0x11e046,_0x50015d,_0x980cde){const _0x31ef9f=a111_0x10e4ce;var _0x50004f=arguments['length'],_0x1804e2=_0x50004f<0x3?_0x11e046:_0x980cde===null?_0x980cde=Object[_0x31ef9f(0x143)](_0x11e046,_0x50015d):_0x980cde,_0x3785a4;if(typeof Reflect==='object'&&typeof Reflect[_0x31ef9f(0x161)]===_0x31ef9f(0x16c))_0x1804e2=Reflect[_0x31ef9f(0x161)](_0x4afce8,_0x11e046,_0x50015d,_0x980cde);else{for(var _0x33f811=_0x4afce8[_0x31ef9f(0x17e)]-0x1;_0x33f811>=0x0;_0x33f811--)if(_0x3785a4=_0x4afce8[_0x33f811])_0x1804e2=(_0x50004f<0x3?_0x3785a4(_0x1804e2):_0x50004f>0x3?_0x3785a4(_0x11e046,_0x50015d,_0x1804e2):_0x3785a4(_0x11e046,_0x50015d))||_0x1804e2;}return _0x50004f>0x3&&_0x1804e2&&Object[_0x31ef9f(0x12a)](_0x11e046,_0x50015d,_0x1804e2),_0x1804e2;},__metadata=this&&this[a111_0x10e4ce(0x142)]||function(_0x1a2c8d,_0x915258){const _0x433927=a111_0x10e4ce;if(typeof Reflect===_0x433927(0x158)&&typeof Reflect[_0x433927(0x167)]===_0x433927(0x16c))return Reflect[_0x433927(0x167)](_0x1a2c8d,_0x915258);},SyncService_1;function a111_0x5752(){const _0x4ddef1=['FlosumSyncJob','getHookLinkFor','../../../../core','\x20Checking\x20valid\x20name.','__esModule','branchName','repoList','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','16456550OGfuyk','9565328jiViot','\x20Checking\x20intersects.','65061MnFEOV','isConvertToSfdx','Unable\x20to\x20synchronize\x20repository\x20\x27',']\x20[','../../salesforce/services/salesforce.service','test','590TaQjiS','createHookPayload','branchId','get','design:paramtypes','gitUrl','send','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','../../salesforce/services/salesforce-sync.service',']\x20repository\x20','typedi','3113564KfRxUe','join','SalesforceSyncService','sfLogger','applicationUrl','868884fJAwBB','hooks','\x20Repository\x20\x22','constructor','\x22\x20branch:\x20\x22','gitApiService','BadRequestError','\x27\x20in\x20repository\x20\x27','getAll','repoService','direction','../../../../core/errors/bad-request.error','defineProperty','repositoriesIntersections','GitSyncJob','../../../../core/errors/too-many-requests.error','Not\x20Synchronized','gitRepoService','disableSync','create','HooksUtils','log','toString','3efztMG','\x20Syncing\x20repository:\x20\x22','Unable\x20to\x20synchronize\x20branch\x20\x27','../../providers/web-hooks/hooks.utils','\x20Getting\x20Flosum\x20repository','name','getRepositoryRecords','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','catch','SyncService','salesforceSync','find','__decorate','__metadata','getOwnPropertyDescriptor','\x20Completed\x20prepare\x20to\x20syncing.',']\x20due\x20error\x20-\x20','16094BTczJD','getLoggerId','checkValidNaming','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','updateRemoteState','isBidirectionalSynchronization','TooManyRequests','gitProvider','push','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','../../../shared/utils','GitBranchNotFoundError','map','isIntersects','setStatus','search','\x20Start\x20sync\x20job.','(((.+)+)+)+$','object','run','Container','url','toUpperCase','repositoryId','getBranchRecords',']\x20branch.','../../salesforce/errors/salesforce.error','decorate','toLowerCase','repositoryName','\x20branches.','Syncing\x20','FlosumToGit','metadata','Tokens','\x27\x20[','logger','config','function','../../providers/providers.tokens','prefix','connectionId','../../salesforce/dto/flosum-repository-sync.dto','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','handleRecordSyncError','7942970BmHcpl','error','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','94WmKGzD','20WtDCSX','SalesforceService','apply','Error','Logger','../../../../constants','salesforceService','length'];a111_0x5752=function(){return _0x4ddef1;};return a111_0x5752();}Object[a111_0x10e4ce(0x12a)](exports,a111_0x10e4ce(0x183),{'value':!![]}),exports[a111_0x10e4ce(0x13e)]=void 0x0;const constants_1=require(a111_0x10e4ce(0x17c)),core_1=require(a111_0x10e4ce(0x181)),too_many_requests_error_1=require(a111_0x10e4ce(0x12d)),flosum_repository_sync_dto_1=require(a111_0x10e4ce(0x170)),salesforce_error_1=require(a111_0x10e4ce(0x160)),salesforce_sync_service_1=require(a111_0x10e4ce(0x198)),salesforce_service_1=require(a111_0x10e4ce(0x18e)),utils_1=require(a111_0x10e4ce(0x150)),typedi_1=require(a111_0x10e4ce(0x19a)),hooks_utils_1=require(a111_0x10e4ce(0x138)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require('../jobs/git-sync.job'),providers_tokens_1=require(a111_0x10e4ce(0x16d)),bad_request_error_1=require(a111_0x10e4ce(0x129));let SyncService=SyncService_1=class SyncService{constructor(_0x6e4b9a,_0x541364){const _0x18c2db=a111_0x10e4ce;this[_0x18c2db(0x17d)]=_0x6e4b9a,this[_0x18c2db(0x13f)]=_0x541364,this['logger']=new core_1[(_0x18c2db(0x17b))](SyncService_1[_0x18c2db(0x13a)]),this[_0x18c2db(0x12b)]={},this[_0x18c2db(0x185)]=[];}async[a111_0x10e4ce(0x172)](_0x3911e0,_0x4ba856){const _0x589322=a111_0x10e4ce;if(_0x4ba856 instanceof git_branch_not_found_error_1[_0x589322(0x151)]){await this['salesforceSync'][_0x589322(0x154)](_0x3911e0,_0x589322(0x12e));return;}if(_0x4ba856 instanceof too_many_requests_error_1[_0x589322(0x14c)]){await this[_0x589322(0x13f)][_0x589322(0x154)](_0x3911e0,'Waiting');throw _0x4ba856;}try{await this[_0x589322(0x19e)][_0x589322(0x174)](this['prefix']+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x3911e0[_0x589322(0x163)]+_0x589322(0x169)+_0x3911e0[_0x589322(0x184)]+_0x589322(0x145)+_0x4ba856+'.')[_0x589322(0x196)](),await this[_0x589322(0x13f)][_0x589322(0x14a)](_0x3911e0,{}),await this[_0x589322(0x13f)][_0x589322(0x154)](_0x3911e0,_0x589322(0x17a));}catch(_0x1ede19){if(_0x1ede19 instanceof salesforce_error_1['SalesforceError'])throw _0x1ede19;}}async[a111_0x10e4ce(0x153)](_0x560f9b){const _0x284a8e=a111_0x10e4ce;if(_0x560f9b[_0x284a8e(0x15d)]){const _0x29c6b3=_0x560f9b[_0x284a8e(0x163)][_0x284a8e(0x162)](),_0x1494cd=this[_0x284a8e(0x12b)][_0x29c6b3];if(!_0x1494cd)this['repositoriesIntersections'][_0x29c6b3]=_0x560f9b[_0x284a8e(0x163)];else{if(_0x1494cd&&_0x1494cd!==_0x560f9b[_0x284a8e(0x163)])return await this['handleRecordSyncError'](_0x560f9b,new Error(_0x284a8e(0x18c)+_0x560f9b[_0x284a8e(0x163)]+_0x284a8e(0x186)+_0x29c6b3+'\x27\x20-\x20\x27'+_0x1494cd+'\x27')),!![];}}return![];}async[a111_0x10e4ce(0x148)](_0x390872){const _0x388df9=a111_0x10e4ce;if(!constants_1['REPOSITORY_NAME_REGEXP'][_0x388df9(0x18f)](_0x390872[_0x388df9(0x163)]))return await this[_0x388df9(0x172)](_0x390872,new Error(_0x388df9(0x18c)+_0x390872['repositoryName']+_0x388df9(0x14f))),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x388df9(0x18f)](_0x390872[_0x388df9(0x184)]))return await this['handleRecordSyncError'](_0x390872,new Error(_0x388df9(0x137)+_0x390872['branchName']+_0x388df9(0x125)+_0x390872[_0x388df9(0x163)]+_0x388df9(0x13c))),![];return!![];}async['getOrCreateRepo'](_0x2096d4,_0x67f568){const _0x18a394=a111_0x10e4ce;let _0x16a742=this['repoList']['find'](_0x214112=>_0x2096d4['repositoryName']===_0x214112['name']);!_0x16a742&&(this[_0x18a394(0x19e)][_0x18a394(0x133)](this[_0x18a394(0x16e)]+_0x18a394(0x120)+_0x2096d4[_0x18a394(0x163)]+_0x18a394(0x171)),_0x16a742=await this['repoService'][_0x18a394(0x131)]({'name':_0x2096d4['repositoryName'],'autoInit':!![],'defaultBranch':_0x2096d4[_0x18a394(0x184)],'private':!![],'createHook':typedi_1['Container'][_0x18a394(0x193)](providers_tokens_1[_0x18a394(0x168)][_0x18a394(0x16b)])[_0x18a394(0x14b)]}));if(this['config'][_0x18a394(0x14b)]){const _0x1ce513=await _0x16a742['hooks'][_0x18a394(0x126)]();!_0x1ce513[_0x18a394(0x140)](_0x3bf6f2=>_0x3bf6f2[_0x18a394(0x15b)]===hooks_utils_1[_0x18a394(0x132)][_0x18a394(0x180)](this['config'][_0x18a394(0x14d)],this[_0x18a394(0x16b)][_0x18a394(0x11d)],_0x67f568))&&(this[_0x18a394(0x19e)]['log'](this[_0x18a394(0x16e)]+_0x18a394(0x120)+_0x2096d4[_0x18a394(0x163)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x16a742[_0x18a394(0x11f)][_0x18a394(0x131)](hooks_utils_1['HooksUtils'][_0x18a394(0x191)](this[_0x18a394(0x16b)]['gitProvider'],_0x16a742[_0x18a394(0x11f)],this[_0x18a394(0x16b)]['applicationUrl'],_0x67f568)));}return this[_0x18a394(0x185)][_0x18a394(0x14e)](_0x16a742),_0x16a742;}async['run'](){const _0xcfb44c=a111_0x10e4ce;this[_0xcfb44c(0x123)]=typedi_1[_0xcfb44c(0x15a)][_0xcfb44c(0x193)](providers_tokens_1[_0xcfb44c(0x168)][_0xcfb44c(0x123)]),this['repoService']=typedi_1[_0xcfb44c(0x15a)][_0xcfb44c(0x193)](providers_tokens_1[_0xcfb44c(0x168)][_0xcfb44c(0x12f)]),this[_0xcfb44c(0x16b)]=typedi_1['Container'][_0xcfb44c(0x193)](providers_tokens_1[_0xcfb44c(0x168)]['config']),this[_0xcfb44c(0x19e)]=typedi_1[_0xcfb44c(0x15a)][_0xcfb44c(0x193)](providers_tokens_1[_0xcfb44c(0x168)]['logger']),this['prefix']='['+SyncService_1[_0xcfb44c(0x13a)]+_0xcfb44c(0x18d)+this[_0xcfb44c(0x16b)][_0xcfb44c(0x14d)][_0xcfb44c(0x15c)]()+']',this['salesforceService']['setLoggerId'](this[_0xcfb44c(0x19e)][_0xcfb44c(0x147)]());try{this[_0xcfb44c(0x19e)][_0xcfb44c(0x133)](this[_0xcfb44c(0x16e)]+_0xcfb44c(0x156)),await this['sfLogger'][_0xcfb44c(0x133)](this[_0xcfb44c(0x16e)]+'\x20Getting\x20repository\x20records.')[_0xcfb44c(0x196)]();const _0x57a9bf=await this[_0xcfb44c(0x13f)][_0xcfb44c(0x13b)](typedi_1[_0xcfb44c(0x15a)][_0xcfb44c(0x193)](providers_tokens_1[_0xcfb44c(0x168)][_0xcfb44c(0x16f)]));if(!_0x57a9bf[_0xcfb44c(0x17e)])throw new bad_request_error_1[(_0xcfb44c(0x124))](this['prefix']+'\x20No\x20repositories\x20to\x20sync.');await this['sfLogger']['log'](this['prefix']+'\x20Getting\x20branch\x20records.')[_0xcfb44c(0x196)]();const _0x5e7420=await this['salesforceSync'][_0xcfb44c(0x15e)](_0x57a9bf[_0xcfb44c(0x152)](_0x5ccc5c=>'\x27'+_0x5ccc5c[_0xcfb44c(0x15d)]+'\x27')[_0xcfb44c(0x19c)](','));await this[_0xcfb44c(0x19e)][_0xcfb44c(0x133)](this[_0xcfb44c(0x16e)]+'\x20Getting\x20repositories\x20from\x20git\x20service.')[_0xcfb44c(0x196)](),this['repoList']=await this[_0xcfb44c(0x127)][_0xcfb44c(0x126)]();const _0x4a43c2=[..._0x57a9bf,..._0x5e7420];this['sfLogger']['log'](this['prefix']+'\x20Have\x20to\x20synchronize\x20'+_0x4a43c2[_0xcfb44c(0x17e)]+_0xcfb44c(0x164));for(const _0x353e54 of _0x4a43c2){this[_0xcfb44c(0x16a)]['log'](_0xcfb44c(0x165)+_0x353e54[_0xcfb44c(0x163)]+'['+_0x353e54[_0xcfb44c(0x15d)]+_0xcfb44c(0x199)+_0x353e54['branchName']+'['+_0x353e54[_0xcfb44c(0x192)]+_0xcfb44c(0x15f)),this[_0xcfb44c(0x19e)][_0xcfb44c(0x133)](this[_0xcfb44c(0x16e)]+_0xcfb44c(0x136)+_0x353e54[_0xcfb44c(0x163)]+_0xcfb44c(0x122)+_0x353e54[_0xcfb44c(0x184)]+'\x22.'),this[_0xcfb44c(0x19e)][_0xcfb44c(0x133)](this[_0xcfb44c(0x16e)]+_0xcfb44c(0x182));const _0x52cece=await this[_0xcfb44c(0x148)](_0x353e54);if(!_0x52cece)continue;this[_0xcfb44c(0x19e)][_0xcfb44c(0x133)](this[_0xcfb44c(0x16e)]+_0xcfb44c(0x189));const _0x45e07f=await this[_0xcfb44c(0x153)](_0x353e54);if(_0x45e07f)continue;await this[_0xcfb44c(0x19e)][_0xcfb44c(0x196)]();let _0x1829b0;try{await this[_0xcfb44c(0x19e)][_0xcfb44c(0x133)](this['prefix']+_0xcfb44c(0x139))[_0xcfb44c(0x196)](),_0x1829b0=await this['getOrCreateRepo'](_0x353e54,typedi_1['Container'][_0xcfb44c(0x193)](providers_tokens_1[_0xcfb44c(0x168)]['connectionId']));}catch(_0x32a877){await this['handleRecordSyncError'](_0x353e54,_0x32a877 instanceof too_many_requests_error_1[_0xcfb44c(0x14c)]?_0x32a877:new Error(_0xcfb44c(0x197)+_0x32a877));continue;}await this[_0xcfb44c(0x19e)][_0xcfb44c(0x133)](this[_0xcfb44c(0x16e)]+_0xcfb44c(0x144))[_0xcfb44c(0x196)]();if(_0x353e54[_0xcfb44c(0x128)]===flosum_repository_sync_dto_1['SyncDirection'][_0xcfb44c(0x166)]){const _0x2d90b4=typedi_1[_0xcfb44c(0x15a)][_0xcfb44c(0x193)](flosum_sync_job_1[_0xcfb44c(0x17f)]);await _0x2d90b4[_0xcfb44c(0x159)]({'repository':_0x1829b0,'convertToSFDX':this[_0xcfb44c(0x16b)][_0xcfb44c(0x18b)],'syncRecord':_0x353e54,'provider':this[_0xcfb44c(0x16b)][_0xcfb44c(0x14d)]})[_0xcfb44c(0x13d)](_0x11d96d=>this[_0xcfb44c(0x172)](_0x353e54,_0x11d96d));}else{const _0x3d43ac=typedi_1[_0xcfb44c(0x15a)][_0xcfb44c(0x193)](git_sync_job_1[_0xcfb44c(0x12c)]);await _0x3d43ac['run']({'repository':_0x1829b0,'branch':_0x353e54[_0xcfb44c(0x184)],'provider':this[_0xcfb44c(0x16b)]['gitProvider'],'repositoryGit':_0x1829b0[_0xcfb44c(0x195)],'syncRecord':_0x353e54})['catch'](_0x37a8a3=>this[_0xcfb44c(0x172)](_0x353e54,_0x37a8a3));}}}catch(_0x4f22cd){this[_0xcfb44c(0x16a)][_0xcfb44c(0x174)](_0x4f22cd);_0x4f22cd instanceof too_many_requests_error_1[_0xcfb44c(0x14c)]?(await this[_0xcfb44c(0x19e)][_0xcfb44c(0x133)](this[_0xcfb44c(0x16e)]+_0xcfb44c(0x175))[_0xcfb44c(0x196)](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0xcfb44c(0x159)]()):await this[_0xcfb44c(0x19e)]['error'](this[_0xcfb44c(0x16e)]+_0xcfb44c(0x149)+_0x4f22cd)[_0xcfb44c(0x196)]();return;}await this[_0xcfb44c(0x19e)][_0xcfb44c(0x133)](this[_0xcfb44c(0x16e)]+'\x20Sync\x20job\x20done.')[_0xcfb44c(0x196)](),await this[_0xcfb44c(0x13f)][_0xcfb44c(0x130)](typedi_1[_0xcfb44c(0x15a)][_0xcfb44c(0x193)](providers_tokens_1[_0xcfb44c(0x168)][_0xcfb44c(0x16f)]))['catch'](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a111_0x10e4ce(0x194),[salesforce_service_1[a111_0x10e4ce(0x178)],salesforce_sync_service_1[a111_0x10e4ce(0x19d)]])],SyncService),exports[a111_0x10e4ce(0x13e)]=SyncService;