const a113_0x14c461=a113_0x426f;(function(_0x4be432,_0x342f6){const _0x26872a=a113_0x426f,_0x5e0b1c=_0x4be432();while(!![]){try{const _0x1001dd=-parseInt(_0x26872a(0x1d6))/0x1+-parseInt(_0x26872a(0x1ab))/0x2+-parseInt(_0x26872a(0x1cd))/0x3+parseInt(_0x26872a(0x176))/0x4*(parseInt(_0x26872a(0x1e7))/0x5)+-parseInt(_0x26872a(0x1a8))/0x6*(parseInt(_0x26872a(0x1d4))/0x7)+-parseInt(_0x26872a(0x1cb))/0x8+parseInt(_0x26872a(0x1dd))/0x9;if(_0x1001dd===_0x342f6)break;else _0x5e0b1c['push'](_0x5e0b1c['shift']());}catch(_0x1b06c3){_0x5e0b1c['push'](_0x5e0b1c['shift']());}}}(a113_0x1db1,0x90a5e));const a113_0x4dd45a=(function(){let _0x269f75=!![];return function(_0x13f1fc,_0x1018b5){const _0x58655d=_0x269f75?function(){const _0x52affb=a113_0x426f;if(_0x1018b5){const _0x334ff8=_0x1018b5[_0x52affb(0x1eb)](_0x13f1fc,arguments);return _0x1018b5=null,_0x334ff8;}}:function(){};return _0x269f75=![],_0x58655d;};}()),a113_0x3e3760=a113_0x4dd45a(this,function(){const _0x53db6d=a113_0x426f;return a113_0x3e3760[_0x53db6d(0x190)]()[_0x53db6d(0x170)]('(((.+)+)+)+$')[_0x53db6d(0x190)]()[_0x53db6d(0x1ed)](a113_0x3e3760)[_0x53db6d(0x170)](_0x53db6d(0x171));});function a113_0x426f(_0x4a6604,_0x3cef77){const _0xbc1d3a=a113_0x1db1();return a113_0x426f=function(_0x3e3760,_0x4dd45a){_0x3e3760=_0x3e3760-0x16e;let _0x1db1d4=_0xbc1d3a[_0x3e3760];return _0x1db1d4;},a113_0x426f(_0x4a6604,_0x3cef77);}a113_0x3e3760();function a113_0x1db1(){const _0x12fe30=['setLoggerId','2370966kjlKdZ','prefix','../../salesforce/errors/salesforce.error','265732pZlyGv','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','name','gitUrl','__esModule','find','hooks','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','\x20Syncing\x20repository:\x20\x22','map','function','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','join','repositoryName','getLoggerId','createHookPayload','error','TooManyRequests','../../../../constants','branchName','GitBranchNotFoundError','gitProvider','\x20Getting\x20repositories\x20from\x20git\x20service.','isIntersects','\x20Sync\x20job\x20done.','../../../../core/errors/too-many-requests.error',']\x20[','\x20Getting\x20repository\x20records.','../jobs/git-sync.job','setStatus','Waiting',']\x20branch.','5949360wtmdFR',']\x20repository\x20','258651FWznQX','Container','GitSyncJob','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','get','toLowerCase','SyncService','7ACaTvX','__metadata','1076193iqcOGp','repoService','SalesforceError','metadata','getOwnPropertyDescriptor','\x20No\x20repositories\x20to\x20sync.','sfLogger','21135339ahFzGn','test','\x20Repository\x20\x22','decorate','../jobs/flosum-sync.job','FlosumToGit','sleep','isBidirectionalSynchronization','Unable\x20to\x20synchronize\x20branch\x20\x27','applicationUrl','3391070tRCnlc','\x20Getting\x20branch\x20records.','../../../../core/errors/bad-request.error','toUpperCase','apply','branchId','constructor','send','getOrCreateRepo','\x20Start\x20sync\x20job.','Service','search','(((.+)+)+)+$','Unable\x20to\x20synchronize\x20repository\x20\x27','\x20Have\x20to\x20synchronize\x20','\x20branches.','../../salesforce/dto/flosum-repository-sync.dto','4Jwgfbb','design:paramtypes','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','repositoriesIntersections','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','gitRepoService','defineProperty','\x27\x20in\x20repository\x20\x27','checkValidNaming','\x20Stop\x20sync\x20job\x20for\x20\x27','getBranchRecords','Tokens','../../../../core','url','handleRecordSyncError','updateRemoteState','BadRequestError','getAll','create','isConvertToSfdx','object','HooksUtils','getRepositoryRecords','log','repoList','\x27\x20[','toString','SalesforceService','../../providers/providers.tokens','gitApiService','../../../shared/utils','push','config','salesforceService','direction','run','logger','../errors/git-branch-not-found.error','SalesforceSyncService','Syncing\x20','connectionId','catch','\x20Checking\x20valid\x20name.','disableSync','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','length','../../providers/web-hooks/hooks.utils','\x22\x20branch:\x20\x22','salesforceSync'];a113_0x1db1=function(){return _0x12fe30;};return a113_0x1db1();}'use strict';var __decorate=this&&this['__decorate']||function(_0x51bdab,_0x3e9acd,_0x141aa2,_0x1a5033){const _0x207a46=a113_0x426f;var _0x13e01e=arguments['length'],_0x30799e=_0x13e01e<0x3?_0x3e9acd:_0x1a5033===null?_0x1a5033=Object[_0x207a46(0x1da)](_0x3e9acd,_0x141aa2):_0x1a5033,_0x35b1b1;if(typeof Reflect===_0x207a46(0x18a)&&typeof Reflect[_0x207a46(0x1e0)]===_0x207a46(0x1b5))_0x30799e=Reflect[_0x207a46(0x1e0)](_0x51bdab,_0x3e9acd,_0x141aa2,_0x1a5033);else{for(var _0x2b772a=_0x51bdab[_0x207a46(0x1a3)]-0x1;_0x2b772a>=0x0;_0x2b772a--)if(_0x35b1b1=_0x51bdab[_0x2b772a])_0x30799e=(_0x13e01e<0x3?_0x35b1b1(_0x30799e):_0x13e01e>0x3?_0x35b1b1(_0x3e9acd,_0x141aa2,_0x30799e):_0x35b1b1(_0x3e9acd,_0x141aa2))||_0x30799e;}return _0x13e01e>0x3&&_0x30799e&&Object[_0x207a46(0x17c)](_0x3e9acd,_0x141aa2,_0x30799e),_0x30799e;},__metadata=this&&this[a113_0x14c461(0x1d5)]||function(_0xd869d4,_0x53b6c2){const _0x4b4e05=a113_0x14c461;if(typeof Reflect===_0x4b4e05(0x18a)&&typeof Reflect[_0x4b4e05(0x1d9)]===_0x4b4e05(0x1b5))return Reflect[_0x4b4e05(0x1d9)](_0xd869d4,_0x53b6c2);},SyncService_1;Object[a113_0x14c461(0x17c)](exports,a113_0x14c461(0x1af),{'value':!![]}),exports[a113_0x14c461(0x1d3)]=void 0x0;const constants_1=require(a113_0x14c461(0x1bd)),core_1=require(a113_0x14c461(0x182)),too_many_requests_error_1=require(a113_0x14c461(0x1c4)),flosum_repository_sync_dto_1=require(a113_0x14c461(0x175)),salesforce_error_1=require(a113_0x14c461(0x1aa)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require('../../salesforce/services/salesforce.service'),utils_1=require(a113_0x14c461(0x194)),typedi_1=require('typedi'),hooks_utils_1=require(a113_0x14c461(0x1a4)),git_branch_not_found_error_1=require(a113_0x14c461(0x19b)),flosum_sync_job_1=require(a113_0x14c461(0x1e1)),git_sync_job_1=require(a113_0x14c461(0x1c7)),providers_tokens_1=require(a113_0x14c461(0x192)),bad_request_error_1=require(a113_0x14c461(0x1e9));let SyncService=SyncService_1=class SyncService{constructor(_0x589448,_0x1d5854){const _0x4a03a4=a113_0x14c461;this[_0x4a03a4(0x197)]=_0x589448,this['salesforceSync']=_0x1d5854,this['logger']=new core_1['Logger'](SyncService_1[_0x4a03a4(0x1ad)]),this['repositoriesIntersections']={},this['repoList']=[];}async[a113_0x14c461(0x184)](_0xeb1e79,_0x4760d9){const _0x183857=a113_0x14c461;if(_0x4760d9 instanceof git_branch_not_found_error_1[_0x183857(0x1bf)]){await this[_0x183857(0x1a6)][_0x183857(0x1c8)](_0xeb1e79,'Not\x20Synchronized');return;}if(_0x4760d9 instanceof too_many_requests_error_1[_0x183857(0x1bc)]){await this[_0x183857(0x1a6)]['setStatus'](_0xeb1e79,_0x183857(0x1c9));throw _0x4760d9;}try{await this[_0x183857(0x1dc)][_0x183857(0x1bb)](this[_0x183857(0x1a9)]+_0x183857(0x17f)+_0xeb1e79[_0x183857(0x1b8)]+_0x183857(0x18f)+_0xeb1e79[_0x183857(0x1be)]+']\x20due\x20error\x20-\x20'+_0x4760d9+'.')[_0x183857(0x1ee)](),await this['salesforceSync'][_0x183857(0x185)](_0xeb1e79,{}),await this['salesforceSync'][_0x183857(0x1c8)](_0xeb1e79,'Error');}catch(_0x54d94e){if(_0x54d94e instanceof salesforce_error_1[_0x183857(0x1d8)])throw _0x54d94e;}}async[a113_0x14c461(0x1c2)](_0x4ebeab){const _0x5dfba8=a113_0x14c461;if(_0x4ebeab['repositoryId']){const _0x4b27c7=_0x4ebeab[_0x5dfba8(0x1b8)][_0x5dfba8(0x1d2)](),_0x42bcfd=this[_0x5dfba8(0x179)][_0x4b27c7];if(!_0x42bcfd)this['repositoriesIntersections'][_0x4b27c7]=_0x4ebeab[_0x5dfba8(0x1b8)];else{if(_0x42bcfd&&_0x42bcfd!==_0x4ebeab[_0x5dfba8(0x1b8)])return await this['handleRecordSyncError'](_0x4ebeab,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x4ebeab[_0x5dfba8(0x1b8)]+_0x5dfba8(0x1b6)+_0x4b27c7+'\x27\x20-\x20\x27'+_0x42bcfd+'\x27')),!![];}}return![];}async['checkValidNaming'](_0x5a1e57){const _0x305b25=a113_0x14c461;if(!constants_1['REPOSITORY_NAME_REGEXP']['test'](_0x5a1e57[_0x305b25(0x1b8)]))return await this[_0x305b25(0x184)](_0x5a1e57,new Error(_0x305b25(0x172)+_0x5a1e57[_0x305b25(0x1b8)]+_0x305b25(0x17a))),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x305b25(0x1de)](_0x5a1e57[_0x305b25(0x1be)]))return await this[_0x305b25(0x184)](_0x5a1e57,new Error(_0x305b25(0x1e5)+_0x5a1e57[_0x305b25(0x1be)]+_0x305b25(0x17d)+_0x5a1e57[_0x305b25(0x1b8)]+_0x305b25(0x1b2))),![];return!![];}async[a113_0x14c461(0x1ef)](_0xc1633,_0x4336b4){const _0x9fbed2=a113_0x14c461;let _0xe67380=this[_0x9fbed2(0x18e)][_0x9fbed2(0x1b0)](_0x409efd=>_0xc1633['repositoryName']===_0x409efd[_0x9fbed2(0x1ad)]);!_0xe67380&&(this[_0x9fbed2(0x1dc)][_0x9fbed2(0x18d)](this[_0x9fbed2(0x1a9)]+_0x9fbed2(0x1df)+_0xc1633[_0x9fbed2(0x1b8)]+_0x9fbed2(0x178)),_0xe67380=await this['repoService']['create']({'name':_0xc1633[_0x9fbed2(0x1b8)],'autoInit':!![],'defaultBranch':_0xc1633['branchName'],'private':!![],'createHook':typedi_1[_0x9fbed2(0x1ce)][_0x9fbed2(0x1d1)](providers_tokens_1[_0x9fbed2(0x181)][_0x9fbed2(0x196)])[_0x9fbed2(0x1e4)]}));if(this[_0x9fbed2(0x196)][_0x9fbed2(0x1e4)]){const _0x4ef94d=await _0xe67380['hooks']['getAll']();!_0x4ef94d[_0x9fbed2(0x1b0)](_0x2221e0=>_0x2221e0[_0x9fbed2(0x183)]===hooks_utils_1[_0x9fbed2(0x18b)]['getHookLinkFor'](this[_0x9fbed2(0x196)][_0x9fbed2(0x1c0)],this[_0x9fbed2(0x196)]['applicationUrl'],_0x4336b4))&&(this[_0x9fbed2(0x1dc)][_0x9fbed2(0x18d)](this[_0x9fbed2(0x1a9)]+_0x9fbed2(0x1df)+_0xc1633[_0x9fbed2(0x1b8)]+_0x9fbed2(0x1d0)),await _0xe67380['hooks'][_0x9fbed2(0x188)](hooks_utils_1[_0x9fbed2(0x18b)][_0x9fbed2(0x1ba)](this[_0x9fbed2(0x196)][_0x9fbed2(0x1c0)],_0xe67380[_0x9fbed2(0x1b1)],this[_0x9fbed2(0x196)][_0x9fbed2(0x1e6)],_0x4336b4)));}return this[_0x9fbed2(0x18e)][_0x9fbed2(0x195)](_0xe67380),_0xe67380;}async[a113_0x14c461(0x199)](){const _0x21757c=a113_0x14c461;this[_0x21757c(0x193)]=typedi_1[_0x21757c(0x1ce)][_0x21757c(0x1d1)](providers_tokens_1[_0x21757c(0x181)][_0x21757c(0x193)]),this[_0x21757c(0x1d7)]=typedi_1[_0x21757c(0x1ce)]['get'](providers_tokens_1['Tokens'][_0x21757c(0x17b)]),this[_0x21757c(0x196)]=typedi_1[_0x21757c(0x1ce)]['get'](providers_tokens_1[_0x21757c(0x181)]['config']),this['sfLogger']=typedi_1[_0x21757c(0x1ce)][_0x21757c(0x1d1)](providers_tokens_1[_0x21757c(0x181)][_0x21757c(0x19a)]),this[_0x21757c(0x1a9)]='['+SyncService_1[_0x21757c(0x1ad)]+_0x21757c(0x1c5)+this[_0x21757c(0x196)][_0x21757c(0x1c0)][_0x21757c(0x1ea)]()+']',this[_0x21757c(0x197)][_0x21757c(0x1a7)](this['sfLogger'][_0x21757c(0x1b9)]());try{this[_0x21757c(0x1dc)]['log'](this['prefix']+_0x21757c(0x16e)),await this['sfLogger'][_0x21757c(0x18d)](this['prefix']+_0x21757c(0x1c6))[_0x21757c(0x1ee)]();const _0x5d874c=await this[_0x21757c(0x1a6)][_0x21757c(0x18c)](typedi_1[_0x21757c(0x1ce)][_0x21757c(0x1d1)](providers_tokens_1[_0x21757c(0x181)][_0x21757c(0x19e)]));if(!_0x5d874c['length'])throw new bad_request_error_1[(_0x21757c(0x186))](this['prefix']+_0x21757c(0x1db));await this[_0x21757c(0x1dc)][_0x21757c(0x18d)](this[_0x21757c(0x1a9)]+_0x21757c(0x1e8))[_0x21757c(0x1ee)]();const _0x149813=await this['salesforceSync'][_0x21757c(0x180)](_0x5d874c[_0x21757c(0x1b4)](_0x1effe0=>'\x27'+_0x1effe0['repositoryId']+'\x27')[_0x21757c(0x1b7)](','));await this[_0x21757c(0x1dc)][_0x21757c(0x18d)](this[_0x21757c(0x1a9)]+_0x21757c(0x1c1))['send'](),this['repoList']=await this['repoService'][_0x21757c(0x187)]();const _0x157c90=[..._0x5d874c,..._0x149813];this[_0x21757c(0x1dc)][_0x21757c(0x18d)](this[_0x21757c(0x1a9)]+_0x21757c(0x173)+_0x157c90[_0x21757c(0x1a3)]+_0x21757c(0x174));for(const _0x4ebd7c of _0x157c90){this[_0x21757c(0x19a)][_0x21757c(0x18d)](_0x21757c(0x19d)+_0x4ebd7c[_0x21757c(0x1b8)]+'['+_0x4ebd7c['repositoryId']+_0x21757c(0x1cc)+_0x4ebd7c[_0x21757c(0x1be)]+'['+_0x4ebd7c[_0x21757c(0x1ec)]+_0x21757c(0x1ca)),this[_0x21757c(0x1dc)][_0x21757c(0x18d)](this[_0x21757c(0x1a9)]+_0x21757c(0x1b3)+_0x4ebd7c[_0x21757c(0x1b8)]+_0x21757c(0x1a5)+_0x4ebd7c[_0x21757c(0x1be)]+'\x22.'),this['sfLogger'][_0x21757c(0x18d)](this[_0x21757c(0x1a9)]+_0x21757c(0x1a0));const _0x538814=await this[_0x21757c(0x17e)](_0x4ebd7c);if(!_0x538814)continue;this[_0x21757c(0x1dc)][_0x21757c(0x18d)](this['prefix']+'\x20Checking\x20intersects.');const _0x90d8b=await this[_0x21757c(0x1c2)](_0x4ebd7c);if(_0x90d8b)continue;await this[_0x21757c(0x1dc)][_0x21757c(0x1ee)]();let _0x1b6803;try{await this['sfLogger'][_0x21757c(0x18d)](this[_0x21757c(0x1a9)]+'\x20Getting\x20Flosum\x20repository')['send'](),_0x1b6803=await this[_0x21757c(0x1ef)](_0x4ebd7c,typedi_1[_0x21757c(0x1ce)][_0x21757c(0x1d1)](providers_tokens_1[_0x21757c(0x181)][_0x21757c(0x19e)]));}catch(_0x249e0f){await this[_0x21757c(0x184)](_0x4ebd7c,_0x249e0f instanceof too_many_requests_error_1[_0x21757c(0x1bc)]?_0x249e0f:new Error(_0x21757c(0x1ac)+_0x249e0f));continue;}await this[_0x21757c(0x1dc)][_0x21757c(0x18d)](this[_0x21757c(0x1a9)]+'\x20Completed\x20prepare\x20to\x20syncing.')['send']();if(_0x4ebd7c[_0x21757c(0x198)]===flosum_repository_sync_dto_1['SyncDirection'][_0x21757c(0x1e2)]){const _0x4f269e=typedi_1[_0x21757c(0x1ce)][_0x21757c(0x1d1)](flosum_sync_job_1['FlosumSyncJob']);await _0x4f269e[_0x21757c(0x199)]({'repository':_0x1b6803,'convertToSFDX':this[_0x21757c(0x196)][_0x21757c(0x189)],'syncRecord':_0x4ebd7c,'provider':this[_0x21757c(0x196)]['gitProvider']})[_0x21757c(0x19f)](_0x195038=>this['handleRecordSyncError'](_0x4ebd7c,_0x195038));}else{const _0x21ce55=typedi_1[_0x21757c(0x1ce)][_0x21757c(0x1d1)](git_sync_job_1[_0x21757c(0x1cf)]);await _0x21ce55[_0x21757c(0x199)]({'repository':_0x1b6803,'branch':_0x4ebd7c['branchName'],'provider':this[_0x21757c(0x196)]['gitProvider'],'repositoryGit':_0x1b6803[_0x21757c(0x1ae)],'syncRecord':_0x4ebd7c})[_0x21757c(0x19f)](_0x4fb000=>this[_0x21757c(0x184)](_0x4ebd7c,_0x4fb000));}}}catch(_0x1e8de3){this['logger']['error'](_0x1e8de3);_0x1e8de3 instanceof too_many_requests_error_1[_0x21757c(0x1bc)]?(await this[_0x21757c(0x1dc)][_0x21757c(0x18d)](this['prefix']+_0x21757c(0x1a2))[_0x21757c(0x1ee)](),await(0x0,utils_1[_0x21757c(0x1e3)])(0x3c*0x3c*0x3e8),this['run']()):await this[_0x21757c(0x1dc)]['error'](this[_0x21757c(0x1a9)]+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x1e8de3)[_0x21757c(0x1ee)]();return;}await this['sfLogger'][_0x21757c(0x18d)](this[_0x21757c(0x1a9)]+_0x21757c(0x1c3))[_0x21757c(0x1ee)](),await this[_0x21757c(0x1a6)][_0x21757c(0x1a1)](typedi_1[_0x21757c(0x1ce)][_0x21757c(0x1d1)](providers_tokens_1[_0x21757c(0x181)]['connectionId']))[_0x21757c(0x19f)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a113_0x14c461(0x16f)])({'transient':!![]}),__metadata(a113_0x14c461(0x177),[salesforce_service_1[a113_0x14c461(0x191)],salesforce_sync_service_1[a113_0x14c461(0x19c)]])],SyncService),exports['SyncService']=SyncService;