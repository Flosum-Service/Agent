const a111_0x494ddd=a111_0x336c;(function(_0x46f5c2,_0x4784c9){const _0x3abe5f=a111_0x336c,_0x4cec83=_0x46f5c2();while(!![]){try{const _0x11a823=-parseInt(_0x3abe5f(0xa5))/0x1+parseInt(_0x3abe5f(0xae))/0x2*(parseInt(_0x3abe5f(0xff))/0x3)+-parseInt(_0x3abe5f(0xb3))/0x4+-parseInt(_0x3abe5f(0x10e))/0x5*(parseInt(_0x3abe5f(0xc7))/0x6)+-parseInt(_0x3abe5f(0xfd))/0x7*(-parseInt(_0x3abe5f(0x113))/0x8)+parseInt(_0x3abe5f(0x10b))/0x9*(-parseInt(_0x3abe5f(0xc6))/0xa)+parseInt(_0x3abe5f(0xe8))/0xb;if(_0x11a823===_0x4784c9)break;else _0x4cec83['push'](_0x4cec83['shift']());}catch(_0x5476bf){_0x4cec83['push'](_0x4cec83['shift']());}}}(a111_0x2cca,0x970af));const a111_0x3f95a9=(function(){let _0x320076=!![];return function(_0x2226de,_0x404f46){const _0x498e58=_0x320076?function(){const _0x5b66f5=a111_0x336c;if(_0x404f46){const _0x44761b=_0x404f46[_0x5b66f5(0xbf)](_0x2226de,arguments);return _0x404f46=null,_0x44761b;}}:function(){};return _0x320076=![],_0x498e58;};}()),a111_0x220d10=a111_0x3f95a9(this,function(){const _0x31135c=a111_0x336c;return a111_0x220d10[_0x31135c(0xe4)]()[_0x31135c(0xa1)](_0x31135c(0xeb))['toString']()[_0x31135c(0x10c)](a111_0x220d10)[_0x31135c(0xa1)]('(((.+)+)+)+$');});a111_0x220d10();'use strict';var __decorate=this&&this[a111_0x494ddd(0x109)]||function(_0x42082a,_0x3405fa,_0x17ccf9,_0x442f72){const _0x119c24=a111_0x494ddd;var _0x46c6e7=arguments[_0x119c24(0xf3)],_0x4cd0f9=_0x46c6e7<0x3?_0x3405fa:_0x442f72===null?_0x442f72=Object['getOwnPropertyDescriptor'](_0x3405fa,_0x17ccf9):_0x442f72,_0x4fcebd;if(typeof Reflect==='object'&&typeof Reflect[_0x119c24(0x117)]===_0x119c24(0xd6))_0x4cd0f9=Reflect[_0x119c24(0x117)](_0x42082a,_0x3405fa,_0x17ccf9,_0x442f72);else{for(var _0x362230=_0x42082a[_0x119c24(0xf3)]-0x1;_0x362230>=0x0;_0x362230--)if(_0x4fcebd=_0x42082a[_0x362230])_0x4cd0f9=(_0x46c6e7<0x3?_0x4fcebd(_0x4cd0f9):_0x46c6e7>0x3?_0x4fcebd(_0x3405fa,_0x17ccf9,_0x4cd0f9):_0x4fcebd(_0x3405fa,_0x17ccf9))||_0x4cd0f9;}return _0x46c6e7>0x3&&_0x4cd0f9&&Object[_0x119c24(0xd3)](_0x3405fa,_0x17ccf9,_0x4cd0f9),_0x4cd0f9;},__metadata=this&&this[a111_0x494ddd(0x11e)]||function(_0x159ba3,_0x33a29f){const _0x3d374d=a111_0x494ddd;if(typeof Reflect==='object'&&typeof Reflect[_0x3d374d(0xc5)]===_0x3d374d(0xd6))return Reflect['metadata'](_0x159ba3,_0x33a29f);},SyncService_1;Object[a111_0x494ddd(0xd3)](exports,a111_0x494ddd(0x110),{'value':!![]}),exports[a111_0x494ddd(0xe9)]=void 0x0;const constants_1=require(a111_0x494ddd(0xc9)),core_1=require(a111_0x494ddd(0xe1)),too_many_requests_error_1=require(a111_0x494ddd(0xba)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a111_0x494ddd(0xc1)),utils_1=require(a111_0x494ddd(0xb2)),typedi_1=require(a111_0x494ddd(0xb6)),hooks_utils_1=require(a111_0x494ddd(0xa7)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require(a111_0x494ddd(0xc4)),git_sync_job_1=require(a111_0x494ddd(0x118)),providers_tokens_1=require(a111_0x494ddd(0xbd)),bad_request_error_1=require(a111_0x494ddd(0xee));let SyncService=SyncService_1=class SyncService{constructor(_0xce2445,_0x9de819){const _0x1c9cb2=a111_0x494ddd;this[_0x1c9cb2(0xaa)]=_0xce2445,this['salesforceSync']=_0x9de819,this[_0x1c9cb2(0xf2)]=new core_1[(_0x1c9cb2(0xb5))](SyncService_1['name']),this[_0x1c9cb2(0xec)]={},this[_0x1c9cb2(0xfa)]=[];}async[a111_0x494ddd(0x115)](_0x3585d6,_0x2f548d){const _0x1fc095=a111_0x494ddd;if(_0x2f548d instanceof git_branch_not_found_error_1[_0x1fc095(0x11f)]){await this['salesforceSync']['setStatus'](_0x3585d6,_0x1fc095(0xf0));return;}if(_0x2f548d instanceof too_many_requests_error_1[_0x1fc095(0xd1)]){await this['salesforceSync'][_0x1fc095(0xbc)](_0x3585d6,_0x1fc095(0x101));throw _0x2f548d;}try{await this[_0x1fc095(0x10d)][_0x1fc095(0xf4)](this['prefix']+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x3585d6[_0x1fc095(0x111)]+_0x1fc095(0xa2)+_0x3585d6[_0x1fc095(0xfc)]+']\x20due\x20error\x20-\x20'+_0x2f548d+'.')[_0x1fc095(0xd5)](),await this['salesforceSync'][_0x1fc095(0xdd)](_0x3585d6,{}),await this[_0x1fc095(0x10a)][_0x1fc095(0xbc)](_0x3585d6,_0x1fc095(0x120));}catch(_0x1cebad){if(_0x1cebad instanceof salesforce_error_1[_0x1fc095(0x103)])throw _0x1cebad;}}async[a111_0x494ddd(0xaf)](_0x5ce320){const _0x58137b=a111_0x494ddd;if(_0x5ce320[_0x58137b(0xfe)]){const _0x24a80b=_0x5ce320[_0x58137b(0x111)][_0x58137b(0x10f)](),_0xc515e3=this[_0x58137b(0xec)][_0x24a80b];if(!_0xc515e3)this[_0x58137b(0xec)][_0x24a80b]=_0x5ce320[_0x58137b(0x111)];else{if(_0xc515e3&&_0xc515e3!==_0x5ce320['repositoryName'])return await this[_0x58137b(0x115)](_0x5ce320,new Error(_0x58137b(0xf7)+_0x5ce320[_0x58137b(0x111)]+_0x58137b(0x100)+_0x24a80b+_0x58137b(0xcf)+_0xc515e3+'\x27')),!![];}}return![];}async[a111_0x494ddd(0xd0)](_0x2fe801){const _0x58e716=a111_0x494ddd;if(!constants_1[_0x58e716(0xd4)][_0x58e716(0xcb)](_0x2fe801['repositoryName']))return await this['handleRecordSyncError'](_0x2fe801,new Error(_0x58e716(0xf7)+_0x2fe801[_0x58e716(0x111)]+_0x58e716(0xac))),![];if(!constants_1[_0x58e716(0xed)][_0x58e716(0xcb)](_0x2fe801['branchName']))return await this[_0x58e716(0x115)](_0x2fe801,new Error(_0x58e716(0xfb)+_0x2fe801[_0x58e716(0xfc)]+'\x27\x20in\x20repository\x20\x27'+_0x2fe801[_0x58e716(0x111)]+_0x58e716(0xb1))),![];return!![];}async['getOrCreateRepo'](_0x314dc3,_0x4b76ec){const _0x4b1e3a=a111_0x494ddd;let _0x52475f=this[_0x4b1e3a(0xfa)][_0x4b1e3a(0xd2)](_0x30c2c9=>_0x314dc3[_0x4b1e3a(0x111)]===_0x30c2c9['name']);!_0x52475f&&(this['sfLogger']['log'](this[_0x4b1e3a(0x108)]+_0x4b1e3a(0xdb)+_0x314dc3[_0x4b1e3a(0x111)]+_0x4b1e3a(0xd8)),_0x52475f=await this['repoService'][_0x4b1e3a(0xcd)]({'name':_0x314dc3['repositoryName'],'autoInit':!![],'defaultBranch':_0x314dc3[_0x4b1e3a(0xfc)],'private':!![],'createHook':typedi_1[_0x4b1e3a(0xb4)][_0x4b1e3a(0x11d)](providers_tokens_1[_0x4b1e3a(0xe2)]['config'])[_0x4b1e3a(0xb9)]}));if(this[_0x4b1e3a(0xf8)][_0x4b1e3a(0xb9)]){const _0x59f26d=await _0x52475f[_0x4b1e3a(0xad)]['getAll']();!_0x59f26d['find'](_0x113424=>_0x113424[_0x4b1e3a(0xb8)]===hooks_utils_1[_0x4b1e3a(0xe5)][_0x4b1e3a(0xc0)](this[_0x4b1e3a(0xf8)][_0x4b1e3a(0xb7)],this[_0x4b1e3a(0xf8)]['applicationUrl'],_0x4b76ec))&&(this[_0x4b1e3a(0x10d)][_0x4b1e3a(0xa9)](this[_0x4b1e3a(0x108)]+'\x20Repository\x20\x22'+_0x314dc3[_0x4b1e3a(0x111)]+_0x4b1e3a(0xc3)),await _0x52475f[_0x4b1e3a(0xad)][_0x4b1e3a(0xcd)](hooks_utils_1[_0x4b1e3a(0xe5)]['createHookPayload'](this[_0x4b1e3a(0xf8)]['gitProvider'],_0x52475f['hooks'],this['config']['applicationUrl'],_0x4b76ec)));}return this[_0x4b1e3a(0xfa)][_0x4b1e3a(0x119)](_0x52475f),_0x52475f;}async[a111_0x494ddd(0xe0)](){const _0x44ba6e=a111_0x494ddd;this[_0x44ba6e(0xea)]=typedi_1[_0x44ba6e(0xb4)]['get'](providers_tokens_1[_0x44ba6e(0xe2)]['gitApiService']),this[_0x44ba6e(0xe3)]=typedi_1[_0x44ba6e(0xb4)][_0x44ba6e(0x11d)](providers_tokens_1[_0x44ba6e(0xe2)][_0x44ba6e(0xa0)]),this['config']=typedi_1[_0x44ba6e(0xb4)][_0x44ba6e(0x11d)](providers_tokens_1[_0x44ba6e(0xe2)][_0x44ba6e(0xf8)]),this[_0x44ba6e(0x10d)]=typedi_1[_0x44ba6e(0xb4)]['get'](providers_tokens_1[_0x44ba6e(0xe2)][_0x44ba6e(0xf2)]),this[_0x44ba6e(0x108)]='['+SyncService_1[_0x44ba6e(0xf1)]+_0x44ba6e(0xda)+this[_0x44ba6e(0xf8)]['gitProvider'][_0x44ba6e(0x116)]()+']',this['salesforceService'][_0x44ba6e(0xe6)](this['sfLogger'][_0x44ba6e(0xca)]());try{this['sfLogger'][_0x44ba6e(0xa9)](this[_0x44ba6e(0x108)]+_0x44ba6e(0x121)),await this[_0x44ba6e(0x10d)][_0x44ba6e(0xa9)](this[_0x44ba6e(0x108)]+'\x20Getting\x20repository\x20records.')['send']();const _0x6795bd=await this[_0x44ba6e(0x10a)][_0x44ba6e(0xbe)](typedi_1[_0x44ba6e(0xb4)][_0x44ba6e(0x11d)](providers_tokens_1[_0x44ba6e(0xe2)]['connectionId']));if(!_0x6795bd[_0x44ba6e(0xf3)])throw new bad_request_error_1[(_0x44ba6e(0x11c))](this[_0x44ba6e(0x108)]+_0x44ba6e(0x114));await this[_0x44ba6e(0x10d)][_0x44ba6e(0xa9)](this[_0x44ba6e(0x108)]+_0x44ba6e(0x105))[_0x44ba6e(0xd5)]();const _0x523532=await this['salesforceSync'][_0x44ba6e(0x11b)](_0x6795bd[_0x44ba6e(0x11a)](_0x723cec=>'\x27'+_0x723cec['repositoryId']+'\x27')[_0x44ba6e(0xb0)](','));await this[_0x44ba6e(0x10d)][_0x44ba6e(0xa9)](this[_0x44ba6e(0x108)]+'\x20Getting\x20repositories\x20from\x20git\x20service.')[_0x44ba6e(0xd5)](),this[_0x44ba6e(0xfa)]=await this[_0x44ba6e(0xe3)][_0x44ba6e(0x104)]();const _0x1df7d9=[..._0x6795bd,..._0x523532];this[_0x44ba6e(0x10d)][_0x44ba6e(0xa9)](this[_0x44ba6e(0x108)]+_0x44ba6e(0xd7)+_0x1df7d9[_0x44ba6e(0xf3)]+'\x20branches.');for(const _0x1e9e00 of _0x1df7d9){this[_0x44ba6e(0xf2)][_0x44ba6e(0xa9)](_0x44ba6e(0xde)+_0x1e9e00[_0x44ba6e(0x111)]+'['+_0x1e9e00[_0x44ba6e(0xfe)]+']\x20repository\x20'+_0x1e9e00[_0x44ba6e(0xfc)]+'['+_0x1e9e00[_0x44ba6e(0x107)]+_0x44ba6e(0x102)),this[_0x44ba6e(0x10d)]['log'](this[_0x44ba6e(0x108)]+_0x44ba6e(0xd9)+_0x1e9e00[_0x44ba6e(0x111)]+_0x44ba6e(0x122)+_0x1e9e00['branchName']+'\x22.'),this[_0x44ba6e(0x10d)][_0x44ba6e(0xa9)](this[_0x44ba6e(0x108)]+_0x44ba6e(0xcc));const _0x112d98=await this[_0x44ba6e(0xd0)](_0x1e9e00);if(!_0x112d98)continue;this[_0x44ba6e(0x10d)][_0x44ba6e(0xa9)](this['prefix']+_0x44ba6e(0xf5));const _0x5a8a23=await this[_0x44ba6e(0xaf)](_0x1e9e00);if(_0x5a8a23)continue;await this['sfLogger']['send']();let _0x38caf4;try{await this[_0x44ba6e(0x10d)][_0x44ba6e(0xa9)](this[_0x44ba6e(0x108)]+_0x44ba6e(0xa4))[_0x44ba6e(0xd5)](),_0x38caf4=await this[_0x44ba6e(0x112)](_0x1e9e00,typedi_1[_0x44ba6e(0xb4)]['get'](providers_tokens_1['Tokens'][_0x44ba6e(0xa8)]));}catch(_0xd0d525){await this[_0x44ba6e(0x115)](_0x1e9e00,_0xd0d525 instanceof too_many_requests_error_1[_0x44ba6e(0xd1)]?_0xd0d525:new Error(_0x44ba6e(0xf6)+_0xd0d525));continue;}await this['sfLogger']['log'](this[_0x44ba6e(0x108)]+_0x44ba6e(0x106))[_0x44ba6e(0xd5)]();if(_0x1e9e00[_0x44ba6e(0xc8)]===flosum_repository_sync_dto_1[_0x44ba6e(0xf9)][_0x44ba6e(0xe7)]){const _0x4c2cd7=typedi_1[_0x44ba6e(0xb4)][_0x44ba6e(0x11d)](flosum_sync_job_1[_0x44ba6e(0xef)]);await _0x4c2cd7[_0x44ba6e(0xe0)]({'repository':_0x38caf4,'convertToSFDX':this[_0x44ba6e(0xf8)][_0x44ba6e(0xc2)],'syncRecord':_0x1e9e00,'provider':this[_0x44ba6e(0xf8)]['gitProvider']})[_0x44ba6e(0xab)](_0x32523d=>this['handleRecordSyncError'](_0x1e9e00,_0x32523d));}else{const _0x4dab90=typedi_1['Container']['get'](git_sync_job_1['GitSyncJob']);await _0x4dab90['run']({'repository':_0x38caf4,'branch':_0x1e9e00[_0x44ba6e(0xfc)],'provider':this[_0x44ba6e(0xf8)][_0x44ba6e(0xb7)],'repositoryGit':_0x38caf4['gitUrl'],'syncRecord':_0x1e9e00})[_0x44ba6e(0xab)](_0x1c902b=>this[_0x44ba6e(0x115)](_0x1e9e00,_0x1c902b));}}}catch(_0xd474e){this['logger'][_0x44ba6e(0xf4)](_0xd474e);_0xd474e instanceof too_many_requests_error_1[_0x44ba6e(0xd1)]?(await this['sfLogger']['log'](this[_0x44ba6e(0x108)]+_0x44ba6e(0xa3))[_0x44ba6e(0xd5)](),await(0x0,utils_1['sleep'])(0x3c*0x3c*0x3e8),this[_0x44ba6e(0xe0)]()):await this[_0x44ba6e(0x10d)][_0x44ba6e(0xf4)](this[_0x44ba6e(0x108)]+_0x44ba6e(0xa6)+_0xd474e)[_0x44ba6e(0xd5)]();return;}await this[_0x44ba6e(0x10d)][_0x44ba6e(0xa9)](this['prefix']+_0x44ba6e(0xce))[_0x44ba6e(0xd5)](),await this[_0x44ba6e(0x10a)][_0x44ba6e(0xbb)](typedi_1['Container'][_0x44ba6e(0x11d)](providers_tokens_1['Tokens'][_0x44ba6e(0xa8)]))[_0x44ba6e(0xab)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x494ddd(0xdc)])({'transient':!![]}),__metadata(a111_0x494ddd(0xdf),[salesforce_service_1[a111_0x494ddd(0x9f)],salesforce_sync_service_1['SalesforceSyncService']])],SyncService),exports[a111_0x494ddd(0xe9)]=SyncService;function a111_0x336c(_0xed62c9,_0x534c90){const _0x5e562c=a111_0x2cca();return a111_0x336c=function(_0x220d10,_0x3f95a9){_0x220d10=_0x220d10-0x9f;let _0x2ccaa2=_0x5e562c[_0x220d10];return _0x2ccaa2;},a111_0x336c(_0xed62c9,_0x534c90);}function a111_0x2cca(){const _0x4eecc5=['\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','\x20Syncing\x20repository:\x20\x22',']\x20[','\x20Repository\x20\x22','Service','updateRemoteState','Syncing\x20','design:paramtypes','run','../../../../core','Tokens','repoService','toString','HooksUtils','setLoggerId','FlosumToGit','22546557AZlGfV','SyncService','gitApiService','(((.+)+)+)+$','repositoriesIntersections','BRANCH_NAME_REGEXP','../../../../core/errors/bad-request.error','FlosumSyncJob','Not\x20Synchronized','name','logger','length','error','\x20Checking\x20intersects.','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','Unable\x20to\x20synchronize\x20repository\x20\x27','config','SyncDirection','repoList','Unable\x20to\x20synchronize\x20branch\x20\x27','branchName','889RDpKuJ','repositoryId','9WqewTz','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','Waiting',']\x20branch.','SalesforceError','getAll','\x20Getting\x20branch\x20records.','\x20Completed\x20prepare\x20to\x20syncing.','branchId','prefix','__decorate','salesforceSync','99nQhNkN','constructor','sfLogger','8595dkctWE','toLowerCase','__esModule','repositoryName','getOrCreateRepo','25768tvreVp','\x20No\x20repositories\x20to\x20sync.','handleRecordSyncError','toUpperCase','decorate','../jobs/git-sync.job','push','map','getBranchRecords','BadRequestError','get','__metadata','GitBranchNotFoundError','Error','\x20Start\x20sync\x20job.','\x22\x20branch:\x20\x22','SalesforceService','gitRepoService','search','\x27\x20[','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','\x20Getting\x20Flosum\x20repository','202723jzzvcB','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','../../providers/web-hooks/hooks.utils','connectionId','log','salesforceService','catch','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','hooks','544670rQlDcX','isIntersects','join','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','../../../shared/utils','4102708AXCUYv','Container','Logger','typedi','gitProvider','url','isBidirectionalSynchronization','../../../../core/errors/too-many-requests.error','disableSync','setStatus','../../providers/providers.tokens','getRepositoryRecords','apply','getHookLinkFor','../../salesforce/services/salesforce.service','isConvertToSfdx','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','../jobs/flosum-sync.job','metadata','750290ukZNUm','2106psNBUJ','direction','../../../../constants','getLoggerId','test','\x20Checking\x20valid\x20name.','create','\x20Sync\x20job\x20done.','\x27\x20-\x20\x27','checkValidNaming','TooManyRequests','find','defineProperty','REPOSITORY_NAME_REGEXP','send','function','\x20Have\x20to\x20synchronize\x20'];a111_0x2cca=function(){return _0x4eecc5;};return a111_0x2cca();}