const a128_0x31152e=a128_0x545d;(function(_0xe9bdd3,_0x471b4c){const _0x2d9d41=a128_0x545d,_0x183afe=_0xe9bdd3();while(!![]){try{const _0x2f8a73=parseInt(_0x2d9d41(0x1ad))/0x1+parseInt(_0x2d9d41(0x20f))/0x2*(-parseInt(_0x2d9d41(0x1ea))/0x3)+-parseInt(_0x2d9d41(0x1dc))/0x4+parseInt(_0x2d9d41(0x202))/0x5+-parseInt(_0x2d9d41(0x1ff))/0x6*(-parseInt(_0x2d9d41(0x1d4))/0x7)+parseInt(_0x2d9d41(0x1d1))/0x8+parseInt(_0x2d9d41(0x203))/0x9*(-parseInt(_0x2d9d41(0x1e7))/0xa);if(_0x2f8a73===_0x471b4c)break;else _0x183afe['push'](_0x183afe['shift']());}catch(_0x26fdaf){_0x183afe['push'](_0x183afe['shift']());}}}(a128_0x2058,0xd5c5a));function a128_0x2058(){const _0x291caa=['Logger','getAll','../../salesforce/services/salesforce.service','log','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','handleRecordSyncError','../../providers/web-hooks/hooks.utils','updateRemoteState','../../providers/providers.tokens','repositoryName','../../salesforce/errors/salesforce.error','createHookPayload','__esModule','BRANCH_NAME_REGEXP','map','FlosumSyncJob','Unable\x20to\x20synchronize\x20branch\x20\x27','../jobs/flosum-sync.job','isBidirectionalSynchronization','toUpperCase','sfLogger','SalesforceService','typedi','\x20Syncing\x20repository:\x20\x22','../../../shared/utils','branchId','(((.+)+)+)+$','join','FlosumToGit','../../../../core','config','1312932ojODGK','object','checkValidNaming','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','repoList','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','\x20Have\x20to\x20synchronize\x20','../jobs/git-sync.job','\x20Repository\x20\x22','error','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','send','BadRequestError','gitApiService','isConvertToSfdx','sleep','../errors/git-branch-not-found.error','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','gitProvider','metadata','TooManyRequests','Container','applicationUrl','Service','design:paramtypes','GitSyncJob','disableSync','\x22\x20branch:\x20\x22','decorate','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','HooksUtils','apply','Tokens','../../../../core/errors/bad-request.error','SalesforceError','\x27\x20-\x20\x27','12974448jvqjYk','repositoryId','logger','49uuLUkM','../../../../core/errors/too-many-requests.error','url','REPOSITORY_NAME_REGEXP','repositoriesIntersections','\x20Completed\x20prepare\x20to\x20syncing.','find','isIntersects','4666800EljDgB','constructor','Unable\x20to\x20synchronize\x20repository\x20\x27','\x20Getting\x20repositories\x20from\x20git\x20service.','GitBranchNotFoundError','Not\x20Synchronized','../../salesforce/services/salesforce-sync.service','repoService','function','direction','salesforceSync','10809060XkBODB','\x20Checking\x20intersects.','length','5156007EKiiMM','getOwnPropertyDescriptor','\x20Sync\x20job\x20done.','SyncService','connectionId','hooks','\x20Stop\x20sync\x20job\x20for\x20\x27','search','__metadata','branchName','name','setLoggerId','catch','getHookLinkFor','prefix','getLoggerId','\x20Checking\x20valid\x20name.','Syncing\x20','\x20Getting\x20branch\x20records.','run','get','161790LDlAAx','salesforceService','create','8591960tsHYkP','9COmQGY','\x20No\x20repositories\x20to\x20sync.','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','defineProperty','getOrCreateRepo','\x20Start\x20sync\x20job.','\x20Getting\x20repository\x20records.','setStatus','toString','../../../../constants','test',']\x20repository\x20','2fscZgg'];a128_0x2058=function(){return _0x291caa;};return a128_0x2058();}const a128_0x2f27fe=(function(){let _0x5c212d=!![];return function(_0x1f5e6d,_0xd82ba4){const _0x2ac545=_0x5c212d?function(){const _0x85064d=a128_0x545d;if(_0xd82ba4){const _0x1bf332=_0xd82ba4[_0x85064d(0x1cc)](_0x1f5e6d,arguments);return _0xd82ba4=null,_0x1bf332;}}:function(){};return _0x5c212d=![],_0x2ac545;};}()),a128_0x5aeef2=a128_0x2f27fe(this,function(){const _0x24a707=a128_0x545d;return a128_0x5aeef2[_0x24a707(0x20b)]()['search'](_0x24a707(0x22a))[_0x24a707(0x20b)]()[_0x24a707(0x1dd)](a128_0x5aeef2)[_0x24a707(0x1f1)](_0x24a707(0x22a));});a128_0x5aeef2();'use strict';function a128_0x545d(_0x1b54fa,_0x47792c){const _0x3b7190=a128_0x2058();return a128_0x545d=function(_0x5aeef2,_0x2f27fe){_0x5aeef2=_0x5aeef2-0x1ac;let _0x205876=_0x3b7190[_0x5aeef2];return _0x205876;},a128_0x545d(_0x1b54fa,_0x47792c);}var __decorate=this&&this['__decorate']||function(_0x472ba2,_0x13459f,_0x101bd9,_0x5be061){const _0x50ef6d=a128_0x545d;var _0x2bafdd=arguments[_0x50ef6d(0x1e9)],_0x549e04=_0x2bafdd<0x3?_0x13459f:_0x5be061===null?_0x5be061=Object[_0x50ef6d(0x1eb)](_0x13459f,_0x101bd9):_0x5be061,_0x532ed1;if(typeof Reflect===_0x50ef6d(0x1ae)&&typeof Reflect[_0x50ef6d(0x1c9)]===_0x50ef6d(0x1e4))_0x549e04=Reflect[_0x50ef6d(0x1c9)](_0x472ba2,_0x13459f,_0x101bd9,_0x5be061);else{for(var _0x5e059a=_0x472ba2[_0x50ef6d(0x1e9)]-0x1;_0x5e059a>=0x0;_0x5e059a--)if(_0x532ed1=_0x472ba2[_0x5e059a])_0x549e04=(_0x2bafdd<0x3?_0x532ed1(_0x549e04):_0x2bafdd>0x3?_0x532ed1(_0x13459f,_0x101bd9,_0x549e04):_0x532ed1(_0x13459f,_0x101bd9))||_0x549e04;}return _0x2bafdd>0x3&&_0x549e04&&Object[_0x50ef6d(0x206)](_0x13459f,_0x101bd9,_0x549e04),_0x549e04;},__metadata=this&&this[a128_0x31152e(0x1f2)]||function(_0x42b2ab,_0x4a9474){const _0x57321d=a128_0x31152e;if(typeof Reflect===_0x57321d(0x1ae)&&typeof Reflect[_0x57321d(0x1c0)]===_0x57321d(0x1e4))return Reflect[_0x57321d(0x1c0)](_0x42b2ab,_0x4a9474);},SyncService_1;Object[a128_0x31152e(0x206)](exports,a128_0x31152e(0x21c),{'value':!![]}),exports[a128_0x31152e(0x1ed)]=void 0x0;const constants_1=require(a128_0x31152e(0x20c)),core_1=require(a128_0x31152e(0x22d)),too_many_requests_error_1=require(a128_0x31152e(0x1d5)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require(a128_0x31152e(0x21a)),salesforce_sync_service_1=require(a128_0x31152e(0x1e2)),salesforce_service_1=require(a128_0x31152e(0x212)),utils_1=require(a128_0x31152e(0x228)),typedi_1=require(a128_0x31152e(0x226)),hooks_utils_1=require(a128_0x31152e(0x216)),git_branch_not_found_error_1=require(a128_0x31152e(0x1bd)),flosum_sync_job_1=require(a128_0x31152e(0x221)),git_sync_job_1=require(a128_0x31152e(0x1b4)),providers_tokens_1=require(a128_0x31152e(0x218)),bad_request_error_1=require(a128_0x31152e(0x1ce));let SyncService=SyncService_1=class SyncService{constructor(_0x41a5e9,_0xdcda5c){const _0x22555e=a128_0x31152e;this['salesforceService']=_0x41a5e9,this[_0x22555e(0x1e6)]=_0xdcda5c,this[_0x22555e(0x1d3)]=new core_1[(_0x22555e(0x210))](SyncService_1[_0x22555e(0x1f4)]),this[_0x22555e(0x1d8)]={},this[_0x22555e(0x1b1)]=[];}async['handleRecordSyncError'](_0x48f957,_0x324d2f){const _0x6a14ee=a128_0x31152e;if(_0x324d2f instanceof git_branch_not_found_error_1[_0x6a14ee(0x1e0)]){await this['salesforceSync'][_0x6a14ee(0x20a)](_0x48f957,_0x6a14ee(0x1e1));return;}if(_0x324d2f instanceof too_many_requests_error_1[_0x6a14ee(0x1c1)]){await this[_0x6a14ee(0x1e6)][_0x6a14ee(0x20a)](_0x48f957,'Waiting');throw _0x324d2f;}try{await this[_0x6a14ee(0x224)][_0x6a14ee(0x1b6)](this[_0x6a14ee(0x1f8)]+_0x6a14ee(0x1f0)+_0x48f957[_0x6a14ee(0x219)]+'\x27\x20['+_0x48f957[_0x6a14ee(0x1f3)]+']\x20due\x20error\x20-\x20'+_0x324d2f+'.')[_0x6a14ee(0x1b8)](),await this[_0x6a14ee(0x1e6)][_0x6a14ee(0x217)](_0x48f957,{}),await this[_0x6a14ee(0x1e6)][_0x6a14ee(0x20a)](_0x48f957,'Error');}catch(_0x4d9d47){if(_0x4d9d47 instanceof salesforce_error_1[_0x6a14ee(0x1cf)])throw _0x4d9d47;}}async[a128_0x31152e(0x1db)](_0xe8db5d){const _0x3c3a96=a128_0x31152e;if(_0xe8db5d['repositoryId']){const _0x168083=_0xe8db5d[_0x3c3a96(0x219)]['toLowerCase'](),_0x33b190=this['repositoriesIntersections'][_0x168083];if(!_0x33b190)this[_0x3c3a96(0x1d8)][_0x168083]=_0xe8db5d[_0x3c3a96(0x219)];else{if(_0x33b190&&_0x33b190!==_0xe8db5d['repositoryName'])return await this[_0x3c3a96(0x215)](_0xe8db5d,new Error(_0x3c3a96(0x1de)+_0xe8db5d[_0x3c3a96(0x219)]+_0x3c3a96(0x1b0)+_0x168083+_0x3c3a96(0x1d0)+_0x33b190+'\x27')),!![];}}return![];}async[a128_0x31152e(0x1af)](_0x979a3f){const _0x5a8af4=a128_0x31152e;if(!constants_1[_0x5a8af4(0x1d7)][_0x5a8af4(0x20d)](_0x979a3f[_0x5a8af4(0x219)]))return await this[_0x5a8af4(0x215)](_0x979a3f,new Error(_0x5a8af4(0x1de)+_0x979a3f['repositoryName']+_0x5a8af4(0x214))),![];if(!constants_1[_0x5a8af4(0x21d)]['test'](_0x979a3f[_0x5a8af4(0x1f3)]))return await this[_0x5a8af4(0x215)](_0x979a3f,new Error(_0x5a8af4(0x220)+_0x979a3f[_0x5a8af4(0x1f3)]+'\x27\x20in\x20repository\x20\x27'+_0x979a3f[_0x5a8af4(0x219)]+_0x5a8af4(0x1be))),![];return!![];}async['getOrCreateRepo'](_0x370810,_0x278082){const _0x631a02=a128_0x31152e;let _0x4b291e=this['repoList'][_0x631a02(0x1da)](_0x1eb4e7=>_0x370810[_0x631a02(0x219)]===_0x1eb4e7['name']);!_0x4b291e&&(this[_0x631a02(0x224)][_0x631a02(0x213)](this[_0x631a02(0x1f8)]+_0x631a02(0x1b5)+_0x370810[_0x631a02(0x219)]+_0x631a02(0x1b7)),_0x4b291e=await this['repoService'][_0x631a02(0x201)]({'name':_0x370810[_0x631a02(0x219)],'autoInit':!![],'defaultBranch':_0x370810[_0x631a02(0x1f3)],'private':!![],'createHook':typedi_1['Container']['get'](providers_tokens_1[_0x631a02(0x1cd)][_0x631a02(0x1ac)])['isBidirectionalSynchronization']}));if(this[_0x631a02(0x1ac)][_0x631a02(0x222)]){const _0x5c1584=await _0x4b291e[_0x631a02(0x1ef)][_0x631a02(0x211)]();!_0x5c1584['find'](_0x496cdc=>_0x496cdc[_0x631a02(0x1d6)]===hooks_utils_1[_0x631a02(0x1cb)][_0x631a02(0x1f7)](this[_0x631a02(0x1ac)][_0x631a02(0x1bf)],this[_0x631a02(0x1ac)][_0x631a02(0x1c3)],_0x278082))&&(this[_0x631a02(0x224)]['log'](this['prefix']+_0x631a02(0x1b5)+_0x370810[_0x631a02(0x219)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x4b291e[_0x631a02(0x1ef)][_0x631a02(0x201)](hooks_utils_1[_0x631a02(0x1cb)][_0x631a02(0x21b)](this['config'][_0x631a02(0x1bf)],_0x4b291e[_0x631a02(0x1ef)],this[_0x631a02(0x1ac)][_0x631a02(0x1c3)],_0x278082)));}return this[_0x631a02(0x1b1)]['push'](_0x4b291e),_0x4b291e;}async[a128_0x31152e(0x1fd)](){const _0x51c6e3=a128_0x31152e;this[_0x51c6e3(0x1ba)]=typedi_1[_0x51c6e3(0x1c2)][_0x51c6e3(0x1fe)](providers_tokens_1[_0x51c6e3(0x1cd)]['gitApiService']),this[_0x51c6e3(0x1e3)]=typedi_1[_0x51c6e3(0x1c2)][_0x51c6e3(0x1fe)](providers_tokens_1['Tokens']['gitRepoService']),this[_0x51c6e3(0x1ac)]=typedi_1[_0x51c6e3(0x1c2)][_0x51c6e3(0x1fe)](providers_tokens_1[_0x51c6e3(0x1cd)][_0x51c6e3(0x1ac)]),this['sfLogger']=typedi_1[_0x51c6e3(0x1c2)][_0x51c6e3(0x1fe)](providers_tokens_1[_0x51c6e3(0x1cd)][_0x51c6e3(0x1d3)]),this[_0x51c6e3(0x1f8)]='['+SyncService_1['name']+']\x20['+this[_0x51c6e3(0x1ac)][_0x51c6e3(0x1bf)][_0x51c6e3(0x223)]()+']',this[_0x51c6e3(0x200)][_0x51c6e3(0x1f5)](this[_0x51c6e3(0x224)][_0x51c6e3(0x1f9)]());try{this[_0x51c6e3(0x224)][_0x51c6e3(0x213)](this['prefix']+_0x51c6e3(0x208)),await this[_0x51c6e3(0x224)][_0x51c6e3(0x213)](this['prefix']+_0x51c6e3(0x209))[_0x51c6e3(0x1b8)]();const _0x39bd27=await this[_0x51c6e3(0x1e6)]['getRepositoryRecords'](typedi_1[_0x51c6e3(0x1c2)][_0x51c6e3(0x1fe)](providers_tokens_1['Tokens'][_0x51c6e3(0x1ee)]));if(!_0x39bd27[_0x51c6e3(0x1e9)])throw new bad_request_error_1[(_0x51c6e3(0x1b9))](this[_0x51c6e3(0x1f8)]+_0x51c6e3(0x204));await this[_0x51c6e3(0x224)][_0x51c6e3(0x213)](this[_0x51c6e3(0x1f8)]+_0x51c6e3(0x1fc))[_0x51c6e3(0x1b8)]();const _0x49be70=await this[_0x51c6e3(0x1e6)]['getBranchRecords'](_0x39bd27[_0x51c6e3(0x21e)](_0x4322c3=>'\x27'+_0x4322c3[_0x51c6e3(0x1d2)]+'\x27')[_0x51c6e3(0x22b)](','));await this['sfLogger'][_0x51c6e3(0x213)](this[_0x51c6e3(0x1f8)]+_0x51c6e3(0x1df))['send'](),this['repoList']=await this[_0x51c6e3(0x1e3)]['getAll']();const _0x1e2457=[..._0x39bd27,..._0x49be70];this[_0x51c6e3(0x224)][_0x51c6e3(0x213)](this['prefix']+_0x51c6e3(0x1b3)+_0x1e2457[_0x51c6e3(0x1e9)]+'\x20branches.');for(const _0x4794b3 of _0x1e2457){this[_0x51c6e3(0x1d3)][_0x51c6e3(0x213)](_0x51c6e3(0x1fb)+_0x4794b3['repositoryName']+'['+_0x4794b3['repositoryId']+_0x51c6e3(0x20e)+_0x4794b3[_0x51c6e3(0x1f3)]+'['+_0x4794b3[_0x51c6e3(0x229)]+']\x20branch.'),this[_0x51c6e3(0x224)][_0x51c6e3(0x213)](this[_0x51c6e3(0x1f8)]+_0x51c6e3(0x227)+_0x4794b3['repositoryName']+_0x51c6e3(0x1c8)+_0x4794b3[_0x51c6e3(0x1f3)]+'\x22.'),this['sfLogger'][_0x51c6e3(0x213)](this['prefix']+_0x51c6e3(0x1fa));const _0x5f38ae=await this[_0x51c6e3(0x1af)](_0x4794b3);if(!_0x5f38ae)continue;this[_0x51c6e3(0x224)][_0x51c6e3(0x213)](this['prefix']+_0x51c6e3(0x1e8));const _0x215061=await this[_0x51c6e3(0x1db)](_0x4794b3);if(_0x215061)continue;await this[_0x51c6e3(0x224)]['send']();let _0x977fa;try{await this[_0x51c6e3(0x224)][_0x51c6e3(0x213)](this[_0x51c6e3(0x1f8)]+'\x20Getting\x20Flosum\x20repository')[_0x51c6e3(0x1b8)](),_0x977fa=await this[_0x51c6e3(0x207)](_0x4794b3,typedi_1['Container']['get'](providers_tokens_1[_0x51c6e3(0x1cd)][_0x51c6e3(0x1ee)]));}catch(_0x9bb770){await this[_0x51c6e3(0x215)](_0x4794b3,_0x9bb770 instanceof too_many_requests_error_1['TooManyRequests']?_0x9bb770:new Error(_0x51c6e3(0x205)+_0x9bb770));continue;}await this[_0x51c6e3(0x224)][_0x51c6e3(0x213)](this[_0x51c6e3(0x1f8)]+_0x51c6e3(0x1d9))[_0x51c6e3(0x1b8)]();if(_0x4794b3[_0x51c6e3(0x1e5)]===flosum_repository_sync_dto_1['SyncDirection'][_0x51c6e3(0x22c)]){const _0x4ba16f=typedi_1[_0x51c6e3(0x1c2)]['get'](flosum_sync_job_1[_0x51c6e3(0x21f)]);await _0x4ba16f[_0x51c6e3(0x1fd)]({'repository':_0x977fa,'convertToSFDX':this[_0x51c6e3(0x1ac)][_0x51c6e3(0x1bb)],'syncRecord':_0x4794b3,'provider':this[_0x51c6e3(0x1ac)][_0x51c6e3(0x1bf)]})['catch'](_0x165b9a=>this[_0x51c6e3(0x215)](_0x4794b3,_0x165b9a));}else{const _0x578e82=typedi_1[_0x51c6e3(0x1c2)][_0x51c6e3(0x1fe)](git_sync_job_1[_0x51c6e3(0x1c6)]);await _0x578e82[_0x51c6e3(0x1fd)]({'repository':_0x977fa,'branch':_0x4794b3[_0x51c6e3(0x1f3)],'provider':this['config'][_0x51c6e3(0x1bf)],'repositoryGit':_0x977fa['gitUrl'],'syncRecord':_0x4794b3})[_0x51c6e3(0x1f6)](_0x479a01=>this[_0x51c6e3(0x215)](_0x4794b3,_0x479a01));}}}catch(_0x44bda4){this[_0x51c6e3(0x1d3)]['error'](_0x44bda4);_0x44bda4 instanceof too_many_requests_error_1[_0x51c6e3(0x1c1)]?(await this[_0x51c6e3(0x224)]['log'](this[_0x51c6e3(0x1f8)]+_0x51c6e3(0x1ca))[_0x51c6e3(0x1b8)](),await(0x0,utils_1[_0x51c6e3(0x1bc)])(0x3c*0x3c*0x3e8),this[_0x51c6e3(0x1fd)]()):await this[_0x51c6e3(0x224)][_0x51c6e3(0x1b6)](this['prefix']+_0x51c6e3(0x1b2)+_0x44bda4)['send']();return;}await this[_0x51c6e3(0x224)]['log'](this['prefix']+_0x51c6e3(0x1ec))[_0x51c6e3(0x1b8)](),await this[_0x51c6e3(0x1e6)][_0x51c6e3(0x1c7)](typedi_1[_0x51c6e3(0x1c2)][_0x51c6e3(0x1fe)](providers_tokens_1[_0x51c6e3(0x1cd)][_0x51c6e3(0x1ee)]))[_0x51c6e3(0x1f6)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a128_0x31152e(0x1c4)])({'transient':!![]}),__metadata(a128_0x31152e(0x1c5),[salesforce_service_1[a128_0x31152e(0x225)],salesforce_sync_service_1['SalesforceSyncService']])],SyncService),exports[a128_0x31152e(0x1ed)]=SyncService;