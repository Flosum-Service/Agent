const a111_0x382d59=a111_0x3938;(function(_0x433064,_0x3f1dea){const _0x5aaf95=a111_0x3938,_0x1418c7=_0x433064();while(!![]){try{const _0x5999e6=parseInt(_0x5aaf95(0xea))/0x1+parseInt(_0x5aaf95(0x115))/0x2*(parseInt(_0x5aaf95(0x151))/0x3)+-parseInt(_0x5aaf95(0xfa))/0x4*(-parseInt(_0x5aaf95(0x147))/0x5)+parseInt(_0x5aaf95(0xfe))/0x6+-parseInt(_0x5aaf95(0xf5))/0x7*(parseInt(_0x5aaf95(0x107))/0x8)+-parseInt(_0x5aaf95(0x133))/0x9*(-parseInt(_0x5aaf95(0x150))/0xa)+-parseInt(_0x5aaf95(0xec))/0xb;if(_0x5999e6===_0x3f1dea)break;else _0x1418c7['push'](_0x1418c7['shift']());}catch(_0x64ad8d){_0x1418c7['push'](_0x1418c7['shift']());}}}(a111_0x2b07,0x45245));const a111_0x2533fc=(function(){let _0x2c92a2=!![];return function(_0x371200,_0x48e135){const _0x3d1fcf=_0x2c92a2?function(){const _0x187b09=a111_0x3938;if(_0x48e135){const _0x452264=_0x48e135[_0x187b09(0x157)](_0x371200,arguments);return _0x48e135=null,_0x452264;}}:function(){};return _0x2c92a2=![],_0x3d1fcf;};}()),a111_0x1a5e88=a111_0x2533fc(this,function(){const _0x55e992=a111_0x3938;return a111_0x1a5e88[_0x55e992(0x104)]()[_0x55e992(0x114)](_0x55e992(0x13a))[_0x55e992(0x104)]()['constructor'](a111_0x1a5e88)[_0x55e992(0x114)](_0x55e992(0x13a));});a111_0x1a5e88();'use strict';var __decorate=this&&this['__decorate']||function(_0x2de44c,_0x27fc4f,_0x27942d,_0x3636d1){const _0x92cad3=a111_0x3938;var _0x370072=arguments[_0x92cad3(0x153)],_0x3650f2=_0x370072<0x3?_0x27fc4f:_0x3636d1===null?_0x3636d1=Object[_0x92cad3(0xe8)](_0x27fc4f,_0x27942d):_0x3636d1,_0xe42528;if(typeof Reflect===_0x92cad3(0x116)&&typeof Reflect['decorate']==='function')_0x3650f2=Reflect[_0x92cad3(0x149)](_0x2de44c,_0x27fc4f,_0x27942d,_0x3636d1);else{for(var _0x3be333=_0x2de44c[_0x92cad3(0x153)]-0x1;_0x3be333>=0x0;_0x3be333--)if(_0xe42528=_0x2de44c[_0x3be333])_0x3650f2=(_0x370072<0x3?_0xe42528(_0x3650f2):_0x370072>0x3?_0xe42528(_0x27fc4f,_0x27942d,_0x3650f2):_0xe42528(_0x27fc4f,_0x27942d))||_0x3650f2;}return _0x370072>0x3&&_0x3650f2&&Object[_0x92cad3(0x120)](_0x27fc4f,_0x27942d,_0x3650f2),_0x3650f2;},__metadata=this&&this['__metadata']||function(_0x20f040,_0xb7f849){const _0x13554f=a111_0x3938;if(typeof Reflect===_0x13554f(0x116)&&typeof Reflect[_0x13554f(0x10d)]===_0x13554f(0x123))return Reflect[_0x13554f(0x10d)](_0x20f040,_0xb7f849);},SyncService_1;function a111_0x2b07(){const _0x509547=['\x20Getting\x20Flosum\x20repository','getOrCreateRepo','REPOSITORY_NAME_REGEXP','2528MQdYfu','repositoryName','gitApiService','\x20No\x20repositories\x20to\x20sync.','1204314IxnCzB','../../../../core/errors/bad-request.error','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','url','SyncService','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','toString','../../../shared/utils','__esModule','8IJeoUw','repositoryId','FlosumSyncJob','branchName','../../providers/web-hooks/hooks.utils','disableSync','metadata','join','\x20Completed\x20prepare\x20to\x20syncing.','salesforceSync','name','Container','\x27\x20in\x20repository\x20\x27','search','295576TRfcvV','object','\x20Checking\x20intersects.','hooks','\x20Checking\x20valid\x20name.','../../salesforce/errors/salesforce.error','test','design:paramtypes','updateRemoteState','run','../jobs/git-sync.job','defineProperty','\x20Getting\x20branch\x20records.','Tokens','function','../errors/git-branch-not-found.error','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','toUpperCase','getLoggerId','toLowerCase','isIntersects','repoList','HooksUtils','find','\x20Syncing\x20repository:\x20\x22',']\x20[','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','Service','setStatus','BRANCH_NAME_REGEXP','27Mvkrkg','get','FlosumToGit','getRepositoryRecords','setLoggerId','isBidirectionalSynchronization','\x20Repository\x20\x22','(((.+)+)+)+$','\x20Have\x20to\x20synchronize\x20','Syncing\x20','\x20Getting\x20repository\x20records.','send','../../salesforce/dto/flosum-repository-sync.dto','../../../../constants','Error','gitProvider','Unable\x20to\x20synchronize\x20branch\x20\x27','SyncDirection','checkValidNaming','\x20Getting\x20repositories\x20from\x20git\x20service.','2085OFMnPx','\x20Stop\x20sync\x20job\x20for\x20\x27','decorate','Logger','repoService','logger','GitBranchNotFoundError','sfLogger',']\x20due\x20error\x20-\x20','475210gaSThY','6xYBXml','\x20branches.','length','getAll','connectionId','../../providers/providers.tokens','apply','Unable\x20to\x20synchronize\x20repository\x20\x27','createHookPayload','SalesforceSyncService','handleRecordSyncError','sleep','\x27\x20-\x20\x27','BadRequestError','TooManyRequests','salesforceService','Not\x20Synchronized','direction','applicationUrl','prefix','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','GitSyncJob','error','getOwnPropertyDescriptor','repositoriesIntersections','466117NdqlsJ','log','11619883ZVapiy','../../../../core/errors/too-many-requests.error',']\x20branch.','../jobs/flosum-sync.job','\x20Start\x20sync\x20job.','config','isConvertToSfdx','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','push','202727kkfSag','SalesforceService'];a111_0x2b07=function(){return _0x509547;};return a111_0x2b07();}Object[a111_0x382d59(0x120)](exports,a111_0x382d59(0x106),{'value':!![]}),exports[a111_0x382d59(0x102)]=void 0x0;const constants_1=require(a111_0x382d59(0x140)),core_1=require('../../../../core'),too_many_requests_error_1=require(a111_0x382d59(0xed)),flosum_repository_sync_dto_1=require(a111_0x382d59(0x13f)),salesforce_error_1=require(a111_0x382d59(0x11a)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require('../../salesforce/services/salesforce.service'),utils_1=require(a111_0x382d59(0x105)),typedi_1=require('typedi'),hooks_utils_1=require(a111_0x382d59(0x10b)),git_branch_not_found_error_1=require(a111_0x382d59(0x124)),flosum_sync_job_1=require(a111_0x382d59(0xef)),git_sync_job_1=require(a111_0x382d59(0x11f)),providers_tokens_1=require(a111_0x382d59(0x156)),bad_request_error_1=require(a111_0x382d59(0xff));let SyncService=SyncService_1=class SyncService{constructor(_0x5c961e,_0x25e144){const _0x514145=a111_0x382d59;this[_0x514145(0x160)]=_0x5c961e,this[_0x514145(0x110)]=_0x25e144,this[_0x514145(0x14c)]=new core_1[(_0x514145(0x14a))](SyncService_1[_0x514145(0x111)]),this[_0x514145(0xe9)]={},this[_0x514145(0x12a)]=[];}async['handleRecordSyncError'](_0x1f31dc,_0x19921d){const _0x582a2d=a111_0x382d59;if(_0x19921d instanceof git_branch_not_found_error_1[_0x582a2d(0x14d)]){await this[_0x582a2d(0x110)][_0x582a2d(0x131)](_0x1f31dc,_0x582a2d(0x161));return;}if(_0x19921d instanceof too_many_requests_error_1[_0x582a2d(0x15f)]){await this[_0x582a2d(0x110)][_0x582a2d(0x131)](_0x1f31dc,'Waiting');throw _0x19921d;}try{await this[_0x582a2d(0x14e)][_0x582a2d(0xe7)](this[_0x582a2d(0xe4)]+_0x582a2d(0x148)+_0x1f31dc[_0x582a2d(0xfb)]+'\x27\x20['+_0x1f31dc[_0x582a2d(0x10a)]+_0x582a2d(0x14f)+_0x19921d+'.')[_0x582a2d(0x13e)](),await this['salesforceSync'][_0x582a2d(0x11d)](_0x1f31dc,{}),await this[_0x582a2d(0x110)][_0x582a2d(0x131)](_0x1f31dc,_0x582a2d(0x141));}catch(_0x1eea7c){if(_0x1eea7c instanceof salesforce_error_1['SalesforceError'])throw _0x1eea7c;}}async['isIntersects'](_0x56f211){const _0x2139fc=a111_0x382d59;if(_0x56f211['repositoryId']){const _0x3056b2=_0x56f211[_0x2139fc(0xfb)][_0x2139fc(0x128)](),_0x3c82bd=this[_0x2139fc(0xe9)][_0x3056b2];if(!_0x3c82bd)this[_0x2139fc(0xe9)][_0x3056b2]=_0x56f211['repositoryName'];else{if(_0x3c82bd&&_0x3c82bd!==_0x56f211[_0x2139fc(0xfb)])return await this['handleRecordSyncError'](_0x56f211,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x56f211[_0x2139fc(0xfb)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x3056b2+_0x2139fc(0x15d)+_0x3c82bd+'\x27')),!![];}}return![];}async[a111_0x382d59(0x145)](_0x1428be){const _0x2db27a=a111_0x382d59;if(!constants_1[_0x2db27a(0xf9)][_0x2db27a(0x11b)](_0x1428be[_0x2db27a(0xfb)]))return await this[_0x2db27a(0x15b)](_0x1428be,new Error(_0x2db27a(0x158)+_0x1428be[_0x2db27a(0xfb)]+_0x2db27a(0x12f))),![];if(!constants_1[_0x2db27a(0x132)][_0x2db27a(0x11b)](_0x1428be[_0x2db27a(0x10a)]))return await this[_0x2db27a(0x15b)](_0x1428be,new Error(_0x2db27a(0x143)+_0x1428be[_0x2db27a(0x10a)]+_0x2db27a(0x113)+_0x1428be[_0x2db27a(0xfb)]+_0x2db27a(0x103))),![];return!![];}async[a111_0x382d59(0xf8)](_0x3fe21f,_0x483d69){const _0x3afbfd=a111_0x382d59;let _0x58e3e6=this['repoList'][_0x3afbfd(0x12c)](_0x32bee6=>_0x3fe21f[_0x3afbfd(0xfb)]===_0x32bee6[_0x3afbfd(0x111)]);!_0x58e3e6&&(this[_0x3afbfd(0x14e)][_0x3afbfd(0xeb)](this['prefix']+_0x3afbfd(0x139)+_0x3fe21f['repositoryName']+_0x3afbfd(0xe5)),_0x58e3e6=await this['repoService']['create']({'name':_0x3fe21f[_0x3afbfd(0xfb)],'autoInit':!![],'defaultBranch':_0x3fe21f['branchName'],'private':!![],'createHook':typedi_1[_0x3afbfd(0x112)][_0x3afbfd(0x134)](providers_tokens_1[_0x3afbfd(0x122)][_0x3afbfd(0xf1)])[_0x3afbfd(0x138)]}));if(this[_0x3afbfd(0xf1)][_0x3afbfd(0x138)]){const _0x2a37f3=await _0x58e3e6['hooks'][_0x3afbfd(0x154)]();!_0x2a37f3['find'](_0x488b10=>_0x488b10[_0x3afbfd(0x101)]===hooks_utils_1[_0x3afbfd(0x12b)]['getHookLinkFor'](this[_0x3afbfd(0xf1)]['gitProvider'],this[_0x3afbfd(0xf1)][_0x3afbfd(0xe3)],_0x483d69))&&(this['sfLogger'][_0x3afbfd(0xeb)](this[_0x3afbfd(0xe4)]+_0x3afbfd(0x139)+_0x3fe21f[_0x3afbfd(0xfb)]+_0x3afbfd(0x100)),await _0x58e3e6[_0x3afbfd(0x118)]['create'](hooks_utils_1[_0x3afbfd(0x12b)][_0x3afbfd(0x159)](this[_0x3afbfd(0xf1)]['gitProvider'],_0x58e3e6[_0x3afbfd(0x118)],this[_0x3afbfd(0xf1)]['applicationUrl'],_0x483d69)));}return this[_0x3afbfd(0x12a)][_0x3afbfd(0xf4)](_0x58e3e6),_0x58e3e6;}async[a111_0x382d59(0x11e)](){const _0x1eea9e=a111_0x382d59;this[_0x1eea9e(0xfc)]=typedi_1[_0x1eea9e(0x112)][_0x1eea9e(0x134)](providers_tokens_1[_0x1eea9e(0x122)][_0x1eea9e(0xfc)]),this[_0x1eea9e(0x14b)]=typedi_1[_0x1eea9e(0x112)]['get'](providers_tokens_1[_0x1eea9e(0x122)]['gitRepoService']),this[_0x1eea9e(0xf1)]=typedi_1['Container'][_0x1eea9e(0x134)](providers_tokens_1[_0x1eea9e(0x122)][_0x1eea9e(0xf1)]),this[_0x1eea9e(0x14e)]=typedi_1[_0x1eea9e(0x112)][_0x1eea9e(0x134)](providers_tokens_1[_0x1eea9e(0x122)]['logger']),this['prefix']='['+SyncService_1[_0x1eea9e(0x111)]+_0x1eea9e(0x12e)+this[_0x1eea9e(0xf1)]['gitProvider'][_0x1eea9e(0x126)]()+']',this['salesforceService'][_0x1eea9e(0x137)](this[_0x1eea9e(0x14e)][_0x1eea9e(0x127)]());try{this[_0x1eea9e(0x14e)][_0x1eea9e(0xeb)](this[_0x1eea9e(0xe4)]+_0x1eea9e(0xf0)),await this[_0x1eea9e(0x14e)][_0x1eea9e(0xeb)](this[_0x1eea9e(0xe4)]+_0x1eea9e(0x13d))[_0x1eea9e(0x13e)]();const _0x17af5d=await this[_0x1eea9e(0x110)][_0x1eea9e(0x136)](typedi_1[_0x1eea9e(0x112)]['get'](providers_tokens_1['Tokens']['connectionId']));if(!_0x17af5d[_0x1eea9e(0x153)])throw new bad_request_error_1[(_0x1eea9e(0x15e))](this['prefix']+_0x1eea9e(0xfd));await this[_0x1eea9e(0x14e)]['log'](this[_0x1eea9e(0xe4)]+_0x1eea9e(0x121))['send']();const _0x169a42=await this[_0x1eea9e(0x110)]['getBranchRecords'](_0x17af5d['map'](_0x4429f5=>'\x27'+_0x4429f5[_0x1eea9e(0x108)]+'\x27')[_0x1eea9e(0x10e)](','));await this[_0x1eea9e(0x14e)][_0x1eea9e(0xeb)](this[_0x1eea9e(0xe4)]+_0x1eea9e(0x146))[_0x1eea9e(0x13e)](),this[_0x1eea9e(0x12a)]=await this[_0x1eea9e(0x14b)][_0x1eea9e(0x154)]();const _0x202fc9=[..._0x17af5d,..._0x169a42];this[_0x1eea9e(0x14e)][_0x1eea9e(0xeb)](this['prefix']+_0x1eea9e(0x13b)+_0x202fc9[_0x1eea9e(0x153)]+_0x1eea9e(0x152));for(const _0x177a79 of _0x202fc9){this[_0x1eea9e(0x14c)][_0x1eea9e(0xeb)](_0x1eea9e(0x13c)+_0x177a79[_0x1eea9e(0xfb)]+'['+_0x177a79['repositoryId']+']\x20repository\x20'+_0x177a79[_0x1eea9e(0x10a)]+'['+_0x177a79['branchId']+_0x1eea9e(0xee)),this[_0x1eea9e(0x14e)][_0x1eea9e(0xeb)](this[_0x1eea9e(0xe4)]+_0x1eea9e(0x12d)+_0x177a79[_0x1eea9e(0xfb)]+'\x22\x20branch:\x20\x22'+_0x177a79['branchName']+'\x22.'),this[_0x1eea9e(0x14e)][_0x1eea9e(0xeb)](this[_0x1eea9e(0xe4)]+_0x1eea9e(0x119));const _0x3d5a66=await this[_0x1eea9e(0x145)](_0x177a79);if(!_0x3d5a66)continue;this[_0x1eea9e(0x14e)]['log'](this[_0x1eea9e(0xe4)]+_0x1eea9e(0x117));const _0x19b9fa=await this[_0x1eea9e(0x129)](_0x177a79);if(_0x19b9fa)continue;await this[_0x1eea9e(0x14e)][_0x1eea9e(0x13e)]();let _0x449075;try{await this[_0x1eea9e(0x14e)][_0x1eea9e(0xeb)](this[_0x1eea9e(0xe4)]+_0x1eea9e(0xf7))[_0x1eea9e(0x13e)](),_0x449075=await this[_0x1eea9e(0xf8)](_0x177a79,typedi_1['Container']['get'](providers_tokens_1['Tokens']['connectionId']));}catch(_0x94da35){await this[_0x1eea9e(0x15b)](_0x177a79,_0x94da35 instanceof too_many_requests_error_1['TooManyRequests']?_0x94da35:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x94da35));continue;}await this['sfLogger'][_0x1eea9e(0xeb)](this['prefix']+_0x1eea9e(0x10f))[_0x1eea9e(0x13e)]();if(_0x177a79[_0x1eea9e(0xe2)]===flosum_repository_sync_dto_1[_0x1eea9e(0x144)][_0x1eea9e(0x135)]){const _0x344671=typedi_1[_0x1eea9e(0x112)][_0x1eea9e(0x134)](flosum_sync_job_1[_0x1eea9e(0x109)]);await _0x344671[_0x1eea9e(0x11e)]({'repository':_0x449075,'convertToSFDX':this[_0x1eea9e(0xf1)][_0x1eea9e(0xf2)],'syncRecord':_0x177a79,'provider':this['config'][_0x1eea9e(0x142)]})['catch'](_0x2a5a7f=>this[_0x1eea9e(0x15b)](_0x177a79,_0x2a5a7f));}else{const _0x4d2048=typedi_1['Container'][_0x1eea9e(0x134)](git_sync_job_1[_0x1eea9e(0xe6)]);await _0x4d2048[_0x1eea9e(0x11e)]({'repository':_0x449075,'branch':_0x177a79[_0x1eea9e(0x10a)],'provider':this[_0x1eea9e(0xf1)][_0x1eea9e(0x142)],'repositoryGit':_0x449075['gitUrl'],'syncRecord':_0x177a79})['catch'](_0x3ff048=>this[_0x1eea9e(0x15b)](_0x177a79,_0x3ff048));}}}catch(_0x103751){this[_0x1eea9e(0x14c)][_0x1eea9e(0xe7)](_0x103751);_0x103751 instanceof too_many_requests_error_1[_0x1eea9e(0x15f)]?(await this[_0x1eea9e(0x14e)][_0x1eea9e(0xeb)](this['prefix']+_0x1eea9e(0xf3))[_0x1eea9e(0x13e)](),await(0x0,utils_1[_0x1eea9e(0x15c)])(0x3c*0x3c*0x3e8),this['run']()):await this[_0x1eea9e(0x14e)][_0x1eea9e(0xe7)](this['prefix']+_0x1eea9e(0x125)+_0x103751)[_0x1eea9e(0x13e)]();return;}await this[_0x1eea9e(0x14e)][_0x1eea9e(0xeb)](this[_0x1eea9e(0xe4)]+'\x20Sync\x20job\x20done.')[_0x1eea9e(0x13e)](),await this[_0x1eea9e(0x110)][_0x1eea9e(0x10c)](typedi_1[_0x1eea9e(0x112)][_0x1eea9e(0x134)](providers_tokens_1[_0x1eea9e(0x122)][_0x1eea9e(0x155)]))['catch'](()=>null);}};function a111_0x3938(_0x8e4d11,_0x4d9d0c){const _0x27bf36=a111_0x2b07();return a111_0x3938=function(_0x1a5e88,_0x2533fc){_0x1a5e88=_0x1a5e88-0xe2;let _0x2b07e4=_0x27bf36[_0x1a5e88];return _0x2b07e4;},a111_0x3938(_0x8e4d11,_0x4d9d0c);}SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x382d59(0x130)])({'transient':!![]}),__metadata(a111_0x382d59(0x11c),[salesforce_service_1[a111_0x382d59(0xf6)],salesforce_sync_service_1[a111_0x382d59(0x15a)]])],SyncService),exports[a111_0x382d59(0x102)]=SyncService;