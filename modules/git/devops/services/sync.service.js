const a79_0x384552=a79_0x5823;(function(_0x5b97d6,_0x27cb4c){const _0x16225a=a79_0x5823,_0x1de157=_0x5b97d6();while(!![]){try{const _0x43728f=parseInt(_0x16225a(0x1b0))/0x1*(parseInt(_0x16225a(0x185))/0x2)+-parseInt(_0x16225a(0x1cb))/0x3*(-parseInt(_0x16225a(0x1c1))/0x4)+parseInt(_0x16225a(0x1e1))/0x5*(-parseInt(_0x16225a(0x1d8))/0x6)+-parseInt(_0x16225a(0x18b))/0x7*(parseInt(_0x16225a(0x1a4))/0x8)+-parseInt(_0x16225a(0x1bb))/0x9+-parseInt(_0x16225a(0x1b5))/0xa*(parseInt(_0x16225a(0x1c6))/0xb)+parseInt(_0x16225a(0x1e4))/0xc;if(_0x43728f===_0x27cb4c)break;else _0x1de157['push'](_0x1de157['shift']());}catch(_0x5d9961){_0x1de157['push'](_0x1de157['shift']());}}}(a79_0x1986,0x20915));const a79_0xd31533=(function(){let _0x1a459b=!![];return function(_0x28e066,_0x5bbbf2){const _0xeb3701=_0x1a459b?function(){const _0x22b266=a79_0x5823;if(_0x5bbbf2){const _0x10bd29=_0x5bbbf2[_0x22b266(0x173)](_0x28e066,arguments);return _0x5bbbf2=null,_0x10bd29;}}:function(){};return _0x1a459b=![],_0xeb3701;};}()),a79_0x3baaa1=a79_0xd31533(this,function(){const _0x4b2829=a79_0x5823;return a79_0x3baaa1['toString']()[_0x4b2829(0x1ce)]('(((.+)+)+)+$')[_0x4b2829(0x1cc)]()['constructor'](a79_0x3baaa1)['search'](_0x4b2829(0x1bd));});function a79_0x5823(_0x5e1544,_0x1fa4c1){const _0x4bf797=a79_0x1986();return a79_0x5823=function(_0x3baaa1,_0xd31533){_0x3baaa1=_0x3baaa1-0x16e;let _0x1986cc=_0x4bf797[_0x3baaa1];return _0x1986cc;},a79_0x5823(_0x5e1544,_0x1fa4c1);}a79_0x3baaa1();function a79_0x1986(){const _0x5acc32=[']\x20branch.','FlosumToGit','7JHRIbh','salesforceService','sleep','metadata','__decorate','HooksUtils','get','getHookLinkFor','\x20Getting\x20repository\x20records.','SyncService','../errors/git-branch-not-found.error','branchId','isConvertToSfdx','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','create','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','setStatus','Service','\x20Syncing\x20repository:\x20\x22','length','\x20Start\x20sync\x20job.',']\x20due\x20error\x20-\x20','\x20Getting\x20branch\x20records.','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','../../salesforce/dto/flosum-repository-sync.dto','1969784FUtdCY','decorate','\x20Stop\x20sync\x20job\x20for\x20\x27','getRepositoryRecords',']\x20repository\x20','\x20Getting\x20repositories\x20from\x20git\x20service.','hooks','gitProvider','Unable\x20to\x20synchronize\x20repository\x20\x27','design:paramtypes','isIntersects','config','1IqsAQg','REPOSITORY_NAME_REGEXP','../../salesforce/services/salesforce.service',']\x20[','checkValidNaming','635060ehhLZS','typedi','send','../../../../core/errors/too-many-requests.error','handleRecordSyncError','isBidirectionalSynchronization','2004777LfhGwQ','run','(((.+)+)+)+$','defineProperty','salesforceSync','SalesforceSyncService','1940xsvyYI','Logger','../jobs/git-sync.job','name','Waiting','22tzPJVJ','getBranchRecords','connectionId','GitSyncJob','\x20Checking\x20valid\x20name.','1383mDBMpJ','toString','getOwnPropertyDescriptor','search','../../providers/web-hooks/hooks.utils','\x20branches.','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','\x20Sync\x20job\x20done.','TooManyRequests','find','../../salesforce/services/salesforce-sync.service','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','applicationUrl','6wxhCER','setLoggerId','repositoryName','\x22\x20branch:\x20\x22','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','../../providers/providers.tokens','test','repositoriesIntersections','error','268720yXYnFf','Container','Error','5386452OaQFEy','toUpperCase','SalesforceError','branchName','repositoryId','FlosumSyncJob','\x27\x20[','\x20Repository\x20\x22','GitBranchNotFoundError','../../../../core/errors/bad-request.error','object','apply','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','\x27\x20-\x20\x27','\x20Getting\x20Flosum\x20repository','logger','getLoggerId','sfLogger','updateRemoteState','direction','getAll','toLowerCase','log','__metadata','catch','prefix','../../salesforce/errors/salesforce.error','Tokens','function','221346JTJvck','\x20Completed\x20prepare\x20to\x20syncing.','gitApiService','repoService'];a79_0x1986=function(){return _0x5acc32;};return a79_0x1986();}'use strict';var __decorate=this&&this[a79_0x384552(0x18f)]||function(_0xd437d8,_0x31d186,_0x3d14f9,_0xa2645e){const _0x12c0ec=a79_0x384552;var _0x608129=arguments[_0x12c0ec(0x19e)],_0x44d7a4=_0x608129<0x3?_0x31d186:_0xa2645e===null?_0xa2645e=Object[_0x12c0ec(0x1cd)](_0x31d186,_0x3d14f9):_0xa2645e,_0x5d2f4d;if(typeof Reflect===_0x12c0ec(0x172)&&typeof Reflect[_0x12c0ec(0x1a5)]===_0x12c0ec(0x184))_0x44d7a4=Reflect[_0x12c0ec(0x1a5)](_0xd437d8,_0x31d186,_0x3d14f9,_0xa2645e);else{for(var _0x41d18d=_0xd437d8['length']-0x1;_0x41d18d>=0x0;_0x41d18d--)if(_0x5d2f4d=_0xd437d8[_0x41d18d])_0x44d7a4=(_0x608129<0x3?_0x5d2f4d(_0x44d7a4):_0x608129>0x3?_0x5d2f4d(_0x31d186,_0x3d14f9,_0x44d7a4):_0x5d2f4d(_0x31d186,_0x3d14f9))||_0x44d7a4;}return _0x608129>0x3&&_0x44d7a4&&Object[_0x12c0ec(0x1be)](_0x31d186,_0x3d14f9,_0x44d7a4),_0x44d7a4;},__metadata=this&&this[a79_0x384552(0x17f)]||function(_0x4ce46e,_0x383679){const _0x30fc22=a79_0x384552;if(typeof Reflect===_0x30fc22(0x172)&&typeof Reflect[_0x30fc22(0x18e)]===_0x30fc22(0x184))return Reflect['metadata'](_0x4ce46e,_0x383679);},SyncService_1;Object[a79_0x384552(0x1be)](exports,'__esModule',{'value':!![]}),exports['SyncService']=void 0x0;const constants_1=require('../../../../constants'),core_1=require('../../../../core'),too_many_requests_error_1=require(a79_0x384552(0x1b8)),flosum_repository_sync_dto_1=require(a79_0x384552(0x1a3)),salesforce_error_1=require(a79_0x384552(0x182)),salesforce_sync_service_1=require(a79_0x384552(0x1d5)),salesforce_service_1=require(a79_0x384552(0x1b2)),utils_1=require('../../../shared/utils'),typedi_1=require(a79_0x384552(0x1b6)),hooks_utils_1=require(a79_0x384552(0x1cf)),git_branch_not_found_error_1=require(a79_0x384552(0x195)),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require(a79_0x384552(0x1c3)),providers_tokens_1=require(a79_0x384552(0x1dd)),bad_request_error_1=require(a79_0x384552(0x171));let SyncService=SyncService_1=class SyncService{constructor(_0x495d91,_0x27a3ff){const _0x5a128d=a79_0x384552;this[_0x5a128d(0x18c)]=_0x495d91,this[_0x5a128d(0x1bf)]=_0x27a3ff,this[_0x5a128d(0x177)]=new core_1[(_0x5a128d(0x1c2))](SyncService_1[_0x5a128d(0x1c4)]),this['repositoriesIntersections']={},this['repoList']=[];}async[a79_0x384552(0x1b9)](_0x407421,_0x5bf096){const _0x3d3517=a79_0x384552;if(_0x5bf096 instanceof git_branch_not_found_error_1[_0x3d3517(0x170)]){await this['salesforceSync'][_0x3d3517(0x19b)](_0x407421,'Not\x20Synchronized');return;}if(_0x5bf096 instanceof too_many_requests_error_1[_0x3d3517(0x1d3)]){await this[_0x3d3517(0x1bf)][_0x3d3517(0x19b)](_0x407421,_0x3d3517(0x1c5));throw _0x5bf096;}try{await this[_0x3d3517(0x179)]['error'](this[_0x3d3517(0x181)]+_0x3d3517(0x1a6)+_0x407421[_0x3d3517(0x1da)]+_0x3d3517(0x16e)+_0x407421[_0x3d3517(0x1e7)]+_0x3d3517(0x1a0)+_0x5bf096+'.')[_0x3d3517(0x1b7)](),await this[_0x3d3517(0x1bf)][_0x3d3517(0x17a)](_0x407421,{}),await this[_0x3d3517(0x1bf)]['setStatus'](_0x407421,_0x3d3517(0x1e3));}catch(_0x28fb76){if(_0x28fb76 instanceof salesforce_error_1[_0x3d3517(0x1e6)])throw _0x28fb76;}}async[a79_0x384552(0x1ae)](_0x510ed0){const _0x482398=a79_0x384552;if(_0x510ed0['repositoryId']){const _0x3b039e=_0x510ed0[_0x482398(0x1da)][_0x482398(0x17d)](),_0x2e684f=this[_0x482398(0x1df)][_0x3b039e];if(!_0x2e684f)this[_0x482398(0x1df)][_0x3b039e]=_0x510ed0[_0x482398(0x1da)];else{if(_0x2e684f&&_0x2e684f!==_0x510ed0[_0x482398(0x1da)])return await this[_0x482398(0x1b9)](_0x510ed0,new Error(_0x482398(0x1ac)+_0x510ed0['repositoryName']+_0x482398(0x174)+_0x3b039e+_0x482398(0x175)+_0x2e684f+'\x27')),!![];}}return![];}async[a79_0x384552(0x1b4)](_0x2c256c){const _0x1123e0=a79_0x384552;if(!constants_1[_0x1123e0(0x1b1)][_0x1123e0(0x1de)](_0x2c256c['repositoryName']))return await this[_0x1123e0(0x1b9)](_0x2c256c,new Error(_0x1123e0(0x1ac)+_0x2c256c[_0x1123e0(0x1da)]+_0x1123e0(0x1a2))),![];if(!constants_1['BRANCH_NAME_REGEXP'][_0x1123e0(0x1de)](_0x2c256c[_0x1123e0(0x1e7)]))return await this[_0x1123e0(0x1b9)](_0x2c256c,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x2c256c['branchName']+'\x27\x20in\x20repository\x20\x27'+_0x2c256c[_0x1123e0(0x1da)]+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async['getOrCreateRepo'](_0xa0492e,_0x29e644){const _0x4b115b=a79_0x384552;let _0x2d205f=this['repoList'][_0x4b115b(0x1d4)](_0xb21f9=>_0xa0492e[_0x4b115b(0x1da)]===_0xb21f9[_0x4b115b(0x1c4)]);!_0x2d205f&&(this[_0x4b115b(0x179)][_0x4b115b(0x17e)](this[_0x4b115b(0x181)]+_0x4b115b(0x16f)+_0xa0492e[_0x4b115b(0x1da)]+_0x4b115b(0x1d1)),_0x2d205f=await this[_0x4b115b(0x188)]['create']({'name':_0xa0492e[_0x4b115b(0x1da)],'autoInit':!![],'defaultBranch':_0xa0492e[_0x4b115b(0x1e7)],'private':!![],'createHook':typedi_1['Container'][_0x4b115b(0x191)](providers_tokens_1[_0x4b115b(0x183)]['config'])[_0x4b115b(0x1ba)]}));if(this['config'][_0x4b115b(0x1ba)]){const _0x365241=await _0x2d205f['hooks']['getAll']();!_0x365241['find'](_0x2e81f3=>_0x2e81f3['url']===hooks_utils_1[_0x4b115b(0x190)][_0x4b115b(0x192)](this[_0x4b115b(0x1af)]['gitProvider'],this['config'][_0x4b115b(0x1d7)],_0x29e644))&&(this['sfLogger']['log'](this['prefix']+_0x4b115b(0x16f)+_0xa0492e[_0x4b115b(0x1da)]+_0x4b115b(0x1d6)),await _0x2d205f[_0x4b115b(0x1aa)][_0x4b115b(0x199)](hooks_utils_1[_0x4b115b(0x190)]['createHookPayload'](this[_0x4b115b(0x1af)][_0x4b115b(0x1ab)],_0x2d205f[_0x4b115b(0x1aa)],this[_0x4b115b(0x1af)][_0x4b115b(0x1d7)],_0x29e644)));}return this['repoList']['push'](_0x2d205f),_0x2d205f;}async[a79_0x384552(0x1bc)](){const _0x360c5d=a79_0x384552;this[_0x360c5d(0x187)]=typedi_1[_0x360c5d(0x1e2)]['get'](providers_tokens_1['Tokens']['gitApiService']),this[_0x360c5d(0x188)]=typedi_1[_0x360c5d(0x1e2)][_0x360c5d(0x191)](providers_tokens_1[_0x360c5d(0x183)]['gitRepoService']),this[_0x360c5d(0x1af)]=typedi_1['Container'][_0x360c5d(0x191)](providers_tokens_1[_0x360c5d(0x183)][_0x360c5d(0x1af)]),this[_0x360c5d(0x179)]=typedi_1[_0x360c5d(0x1e2)][_0x360c5d(0x191)](providers_tokens_1[_0x360c5d(0x183)][_0x360c5d(0x177)]),this[_0x360c5d(0x181)]='['+SyncService_1[_0x360c5d(0x1c4)]+_0x360c5d(0x1b3)+this['config'][_0x360c5d(0x1ab)][_0x360c5d(0x1e5)]()+']',this[_0x360c5d(0x18c)][_0x360c5d(0x1d9)](this[_0x360c5d(0x179)][_0x360c5d(0x178)]());try{this[_0x360c5d(0x179)][_0x360c5d(0x17e)](this[_0x360c5d(0x181)]+_0x360c5d(0x19f)),await this[_0x360c5d(0x179)]['log'](this[_0x360c5d(0x181)]+_0x360c5d(0x193))['send']();const _0x18b809=await this[_0x360c5d(0x1bf)][_0x360c5d(0x1a7)](typedi_1[_0x360c5d(0x1e2)][_0x360c5d(0x191)](providers_tokens_1[_0x360c5d(0x183)][_0x360c5d(0x1c8)]));if(!_0x18b809['length'])throw new bad_request_error_1['BadRequestError'](this[_0x360c5d(0x181)]+'\x20No\x20repositories\x20to\x20sync.');await this[_0x360c5d(0x179)][_0x360c5d(0x17e)](this[_0x360c5d(0x181)]+_0x360c5d(0x1a1))[_0x360c5d(0x1b7)]();const _0x5cc490=await this['salesforceSync'][_0x360c5d(0x1c7)](_0x18b809['map'](_0x4d9718=>'\x27'+_0x4d9718[_0x360c5d(0x1e8)]+'\x27')['join'](','));await this[_0x360c5d(0x179)][_0x360c5d(0x17e)](this[_0x360c5d(0x181)]+_0x360c5d(0x1a9))[_0x360c5d(0x1b7)](),this['repoList']=await this['repoService'][_0x360c5d(0x17c)]();const _0xb9d78a=[..._0x18b809,..._0x5cc490];this[_0x360c5d(0x179)][_0x360c5d(0x17e)](this['prefix']+'\x20Have\x20to\x20synchronize\x20'+_0xb9d78a[_0x360c5d(0x19e)]+_0x360c5d(0x1d0));for(const _0x5357e8 of _0xb9d78a){this['logger'][_0x360c5d(0x17e)]('Syncing\x20'+_0x5357e8[_0x360c5d(0x1da)]+'['+_0x5357e8[_0x360c5d(0x1e8)]+_0x360c5d(0x1a8)+_0x5357e8['branchName']+'['+_0x5357e8[_0x360c5d(0x196)]+_0x360c5d(0x189)),this[_0x360c5d(0x179)][_0x360c5d(0x17e)](this[_0x360c5d(0x181)]+_0x360c5d(0x19d)+_0x5357e8[_0x360c5d(0x1da)]+_0x360c5d(0x1db)+_0x5357e8[_0x360c5d(0x1e7)]+'\x22.'),this[_0x360c5d(0x179)][_0x360c5d(0x17e)](this[_0x360c5d(0x181)]+_0x360c5d(0x1ca));const _0xa4f94c=await this['checkValidNaming'](_0x5357e8);if(!_0xa4f94c)continue;this[_0x360c5d(0x179)]['log'](this[_0x360c5d(0x181)]+'\x20Checking\x20intersects.');const _0xabbdf=await this['isIntersects'](_0x5357e8);if(_0xabbdf)continue;await this[_0x360c5d(0x179)]['send']();let _0x51ed51;try{await this[_0x360c5d(0x179)][_0x360c5d(0x17e)](this[_0x360c5d(0x181)]+_0x360c5d(0x176))[_0x360c5d(0x1b7)](),_0x51ed51=await this['getOrCreateRepo'](_0x5357e8,typedi_1['Container'][_0x360c5d(0x191)](providers_tokens_1[_0x360c5d(0x183)][_0x360c5d(0x1c8)]));}catch(_0x590c66){await this['handleRecordSyncError'](_0x5357e8,_0x590c66 instanceof too_many_requests_error_1['TooManyRequests']?_0x590c66:new Error(_0x360c5d(0x198)+_0x590c66));continue;}await this[_0x360c5d(0x179)][_0x360c5d(0x17e)](this[_0x360c5d(0x181)]+_0x360c5d(0x186))[_0x360c5d(0x1b7)]();if(_0x5357e8[_0x360c5d(0x17b)]===flosum_repository_sync_dto_1['SyncDirection'][_0x360c5d(0x18a)]){const _0x50ba49=typedi_1[_0x360c5d(0x1e2)][_0x360c5d(0x191)](flosum_sync_job_1[_0x360c5d(0x1e9)]);await _0x50ba49[_0x360c5d(0x1bc)]({'repository':_0x51ed51,'convertToSFDX':this[_0x360c5d(0x1af)][_0x360c5d(0x197)],'syncRecord':_0x5357e8,'provider':this[_0x360c5d(0x1af)][_0x360c5d(0x1ab)]})[_0x360c5d(0x180)](_0x4022d2=>this[_0x360c5d(0x1b9)](_0x5357e8,_0x4022d2));}else{const _0x52c692=typedi_1[_0x360c5d(0x1e2)][_0x360c5d(0x191)](git_sync_job_1[_0x360c5d(0x1c9)]);await _0x52c692[_0x360c5d(0x1bc)]({'repository':_0x51ed51,'branch':_0x5357e8['branchName'],'provider':this[_0x360c5d(0x1af)][_0x360c5d(0x1ab)],'repositoryGit':_0x51ed51['gitUrl'],'syncRecord':_0x5357e8})[_0x360c5d(0x180)](_0x53f0bd=>this['handleRecordSyncError'](_0x5357e8,_0x53f0bd));}}}catch(_0x4a3b44){this[_0x360c5d(0x177)][_0x360c5d(0x1e0)](_0x4a3b44);_0x4a3b44 instanceof too_many_requests_error_1[_0x360c5d(0x1d3)]?(await this['sfLogger']['log'](this[_0x360c5d(0x181)]+_0x360c5d(0x1dc))['send'](),await(0x0,utils_1[_0x360c5d(0x18d)])(0x3c*0x3c*0x3e8),this[_0x360c5d(0x1bc)]()):await this[_0x360c5d(0x179)]['error'](this[_0x360c5d(0x181)]+_0x360c5d(0x19a)+_0x4a3b44)[_0x360c5d(0x1b7)]();return;}await this[_0x360c5d(0x179)]['log'](this['prefix']+_0x360c5d(0x1d2))[_0x360c5d(0x1b7)](),await this[_0x360c5d(0x1bf)]['disableSync'](typedi_1[_0x360c5d(0x1e2)][_0x360c5d(0x191)](providers_tokens_1[_0x360c5d(0x183)]['connectionId']))[_0x360c5d(0x180)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a79_0x384552(0x19c)])({'transient':!![]}),__metadata(a79_0x384552(0x1ad),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a79_0x384552(0x1c0)]])],SyncService),exports[a79_0x384552(0x194)]=SyncService;