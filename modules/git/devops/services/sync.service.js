const a67_0x1722d1=a67_0x1799;(function(_0xb371f6,_0x5a6de6){const _0x1ad97c=a67_0x1799,_0x4e47ca=_0xb371f6();while(!![]){try{const _0x57f3b5=-parseInt(_0x1ad97c(0x19c))/0x1*(parseInt(_0x1ad97c(0x197))/0x2)+-parseInt(_0x1ad97c(0x1ce))/0x3*(parseInt(_0x1ad97c(0x175))/0x4)+parseInt(_0x1ad97c(0x1cb))/0x5+parseInt(_0x1ad97c(0x1af))/0x6+parseInt(_0x1ad97c(0x18e))/0x7+parseInt(_0x1ad97c(0x18a))/0x8*(parseInt(_0x1ad97c(0x1d0))/0x9)+-parseInt(_0x1ad97c(0x1b9))/0xa*(parseInt(_0x1ad97c(0x1c0))/0xb);if(_0x57f3b5===_0x5a6de6)break;else _0x4e47ca['push'](_0x4e47ca['shift']());}catch(_0x1d932a){_0x4e47ca['push'](_0x4e47ca['shift']());}}}(a67_0x1a05,0x9bb66));function a67_0x1799(_0x735d51,_0x351908){const _0x2af37c=a67_0x1a05();return a67_0x1799=function(_0x59c86a,_0x3ccbfd){_0x59c86a=_0x59c86a-0x168;let _0x1a05ef=_0x2af37c[_0x59c86a];return _0x1a05ef;},a67_0x1799(_0x735d51,_0x351908);}const a67_0x3ccbfd=(function(){let _0x3d6340=!![];return function(_0x20bc92,_0x1721ec){const _0xbde56=_0x3d6340?function(){if(_0x1721ec){const _0x4c89f5=_0x1721ec['apply'](_0x20bc92,arguments);return _0x1721ec=null,_0x4c89f5;}}:function(){};return _0x3d6340=![],_0xbde56;};}()),a67_0x59c86a=a67_0x3ccbfd(this,function(){const _0x46c19b=a67_0x1799;return a67_0x59c86a[_0x46c19b(0x1b3)]()[_0x46c19b(0x195)](_0x46c19b(0x1b4))[_0x46c19b(0x1b3)]()[_0x46c19b(0x18f)](a67_0x59c86a)[_0x46c19b(0x195)](_0x46c19b(0x1b4));});a67_0x59c86a();'use strict';function a67_0x1a05(){const _0x9704f6=['getOrCreateRepo','../jobs/flosum-sync.job','createHookPayload','REPOSITORY_NAME_REGEXP','salesforceService','createFromConnection','catch','../../salesforce/errors/salesforce.error','\x20Start\x20sync\x20job.','8QuZZEO','getAll','../../salesforce/dto/flosum-repository-sync.dto','log','GitBranchNotFoundError','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','Unable\x20to\x20synchronize\x20repository\x20\x27','TooManyRequests','getLoggerId','repositoryId','__decorate','../../../../core','SyncService','../../../../core/errors/too-many-requests.error','gitApiService','FlosumSyncJob','\x20Completed\x20prepare\x20to\x20syncing.','run','disableSync','Logger','updateRemoteState','16qMYIqz','Error','repoService','config','8682660oMsGiP','constructor','Tokens','providersFactory','\x27\x20-\x20\x27','../errors/git-branch-not-found.error','join','search','\x20Checking\x20intersects.','422wTgbpl','checkValidNaming','setStatus','function','\x20branches.','2796cALHxB','getOwnPropertyDescriptor','logger','create','setLoggerId','SalesforceSyncService',']\x20[','typedi','branchName','repoList','\x20Syncing\x20repository:\x20\x22','repositoriesIntersections','salesforceSync','name','Not\x20Synchronized','map','send','gitProvider','defineProperty','572640TPtLNK','\x20Getting\x20repositories\x20from\x20git\x20service.','ProvidersFactory','get','toString','(((.+)+)+)+$','\x27\x20in\x20repository\x20\x27','getHookLinkFor','push','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','360970KeDAtg','object','isBidirectionalSynchronization','url','HooksUtils','hooks','handleRecordSyncError','176GIEEBJ',']\x20branch.','error','BRANCH_NAME_REGEXP','sleep','__esModule','gitUrl','design:paramtypes','length','SalesforceService','repositoryName','818030CXavic',']\x20due\x20error\x20-\x20','sfLogger','1138938zrqofw','\x20Sync\x20job\x20done.','4793274TaimQR',']\x20repository\x20','\x20Checking\x20valid\x20name.','../../providers/providers.tokens','\x20Have\x20to\x20synchronize\x20','\x20Repository\x20\x22','isIntersects','\x20Stop\x20sync\x20job\x20for\x20\x27','Container','find','applicationUrl','metadata','test','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','\x20Getting\x20Flosum\x20repository','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','toUpperCase','../utils/connection','prefix','Syncing\x20','FlosumToGit','direction','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','getRepositoryRecords','../../salesforce/services/salesforce.service','isConvertToSfdx','decorate'];a67_0x1a05=function(){return _0x9704f6;};return a67_0x1a05();}var __decorate=this&&this[a67_0x1722d1(0x17f)]||function(_0x5c82e3,_0x3911c4,_0x175b82,_0x5c1ac6){const _0x567d38=a67_0x1722d1;var _0xb3cb20=arguments[_0x567d38(0x1c8)],_0x557aa8=_0xb3cb20<0x3?_0x3911c4:_0x5c1ac6===null?_0x5c1ac6=Object[_0x567d38(0x19d)](_0x3911c4,_0x175b82):_0x5c1ac6,_0x92b496;if(typeof Reflect===_0x567d38(0x1ba)&&typeof Reflect[_0x567d38(0x16b)]===_0x567d38(0x19a))_0x557aa8=Reflect['decorate'](_0x5c82e3,_0x3911c4,_0x175b82,_0x5c1ac6);else{for(var _0x2b9f51=_0x5c82e3[_0x567d38(0x1c8)]-0x1;_0x2b9f51>=0x0;_0x2b9f51--)if(_0x92b496=_0x5c82e3[_0x2b9f51])_0x557aa8=(_0xb3cb20<0x3?_0x92b496(_0x557aa8):_0xb3cb20>0x3?_0x92b496(_0x3911c4,_0x175b82,_0x557aa8):_0x92b496(_0x3911c4,_0x175b82))||_0x557aa8;}return _0xb3cb20>0x3&&_0x557aa8&&Object[_0x567d38(0x1ae)](_0x3911c4,_0x175b82,_0x557aa8),_0x557aa8;},__metadata=this&&this['__metadata']||function(_0x588564,_0x3d23fa){const _0x27dfa2=a67_0x1722d1;if(typeof Reflect===_0x27dfa2(0x1ba)&&typeof Reflect[_0x27dfa2(0x1db)]===_0x27dfa2(0x19a))return Reflect[_0x27dfa2(0x1db)](_0x588564,_0x3d23fa);},SyncService_1;Object[a67_0x1722d1(0x1ae)](exports,a67_0x1722d1(0x1c5),{'value':!![]}),exports['SyncService']=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a67_0x1722d1(0x180)),too_many_requests_error_1=require(a67_0x1722d1(0x182)),flosum_repository_sync_dto_1=require(a67_0x1722d1(0x177)),salesforce_error_1=require(a67_0x1722d1(0x173)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a67_0x1722d1(0x169)),utils_1=require('../../../shared/utils'),typedi_1=require(a67_0x1722d1(0x1a3)),hooks_utils_1=require('../../providers/web-hooks/hooks.utils'),git_branch_not_found_error_1=require(a67_0x1722d1(0x193)),flosum_sync_job_1=require(a67_0x1722d1(0x16d)),git_sync_job_1=require('../jobs/git-sync.job'),repository_factory_1=require('../../providers/repositories/repository.factory'),connection_1=require(a67_0x1722d1(0x1e1)),providers_tokens_1=require(a67_0x1722d1(0x1d3));let SyncService=SyncService_1=class SyncService{constructor(_0x2f93c7,_0x16e6f4,_0x4c431d){const _0xcea0a0=a67_0x1722d1;this[_0xcea0a0(0x170)]=_0x2f93c7,this[_0xcea0a0(0x1a8)]=_0x16e6f4,this[_0xcea0a0(0x191)]=_0x4c431d,this[_0xcea0a0(0x19e)]=new core_1[(_0xcea0a0(0x188))](SyncService_1['name']),this[_0xcea0a0(0x1a7)]={},this['repoList']=[];}async[a67_0x1722d1(0x1bf)](_0x19660f,_0x168b8b){const _0x1d0db4=a67_0x1722d1;if(_0x168b8b instanceof git_branch_not_found_error_1[_0x1d0db4(0x179)]){await this[_0x1d0db4(0x1a8)][_0x1d0db4(0x199)](_0x19660f,_0x1d0db4(0x1aa));return;}if(_0x168b8b instanceof too_many_requests_error_1[_0x1d0db4(0x17c)]){await this['salesforceSync'][_0x1d0db4(0x199)](_0x19660f,'Waiting');throw _0x168b8b;}try{await this[_0x1d0db4(0x1cd)][_0x1d0db4(0x1c2)](this[_0x1d0db4(0x1e2)]+_0x1d0db4(0x1d7)+_0x19660f['repositoryName']+'\x27\x20['+_0x19660f[_0x1d0db4(0x1a4)]+_0x1d0db4(0x1cc)+_0x168b8b+'.')[_0x1d0db4(0x1ac)](),await this['salesforceSync'][_0x1d0db4(0x189)](_0x19660f,{}),await this[_0x1d0db4(0x1a8)][_0x1d0db4(0x199)](_0x19660f,_0x1d0db4(0x18b));}catch(_0x46a0b5){if(_0x46a0b5 instanceof salesforce_error_1['SalesforceError'])throw _0x46a0b5;}}async[a67_0x1722d1(0x1d6)](_0x1f4ef8){const _0x3319b8=a67_0x1722d1;if(_0x1f4ef8['repositoryId']){const _0x4b7f80=_0x1f4ef8[_0x3319b8(0x1ca)]['toLowerCase'](),_0x1a0118=this[_0x3319b8(0x1a7)][_0x4b7f80];if(!_0x1a0118)this[_0x3319b8(0x1a7)][_0x4b7f80]=_0x1f4ef8['repositoryName'];else{if(_0x1a0118&&_0x1a0118!==_0x1f4ef8['repositoryName'])return await this[_0x3319b8(0x1bf)](_0x1f4ef8,new Error(_0x3319b8(0x17b)+_0x1f4ef8[_0x3319b8(0x1ca)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x4b7f80+_0x3319b8(0x192)+_0x1a0118+'\x27')),!![];}}return![];}async['checkValidNaming'](_0x5b4847){const _0x3552b4=a67_0x1722d1;if(!constants_1[_0x3552b4(0x16f)][_0x3552b4(0x1dc)](_0x5b4847[_0x3552b4(0x1ca)]))return await this[_0x3552b4(0x1bf)](_0x5b4847,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x5b4847[_0x3552b4(0x1ca)]+_0x3552b4(0x17a))),![];if(!constants_1[_0x3552b4(0x1c3)][_0x3552b4(0x1dc)](_0x5b4847[_0x3552b4(0x1a4)]))return await this['handleRecordSyncError'](_0x5b4847,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x5b4847['branchName']+_0x3552b4(0x1b5)+_0x5b4847[_0x3552b4(0x1ca)]+_0x3552b4(0x1b8))),![];return!![];}async[a67_0x1722d1(0x16c)](_0x4598b8,_0x53de2a){const _0x134e7a=a67_0x1722d1;let _0x83b7e4=this[_0x134e7a(0x1a5)][_0x134e7a(0x1d9)](_0xf72791=>_0x4598b8[_0x134e7a(0x1ca)]===_0xf72791[_0x134e7a(0x1a9)]);!_0x83b7e4&&(this[_0x134e7a(0x1cd)][_0x134e7a(0x178)](this[_0x134e7a(0x1e2)]+_0x134e7a(0x1d5)+_0x4598b8[_0x134e7a(0x1ca)]+_0x134e7a(0x1e6)),_0x83b7e4=await this['repoService'][_0x134e7a(0x19f)]({'name':_0x4598b8[_0x134e7a(0x1ca)],'autoInit':!![],'defaultBranch':_0x4598b8[_0x134e7a(0x1a4)],'private':!![],'createHook':typedi_1['Container']['get'](providers_tokens_1['Tokens'][_0x134e7a(0x18d)])[_0x134e7a(0x1bb)]}));if(this['config']['isBidirectionalSynchronization']){const _0x14690a=await _0x83b7e4[_0x134e7a(0x1be)][_0x134e7a(0x176)]();!_0x14690a[_0x134e7a(0x1d9)](_0x1b15cc=>_0x1b15cc[_0x134e7a(0x1bc)]===hooks_utils_1['HooksUtils'][_0x134e7a(0x1b6)](this['config'][_0x134e7a(0x1ad)],this['config'][_0x134e7a(0x1da)],_0x53de2a))&&(this[_0x134e7a(0x1cd)][_0x134e7a(0x178)](this['prefix']+_0x134e7a(0x1d5)+_0x4598b8[_0x134e7a(0x1ca)]+_0x134e7a(0x1dd)),await _0x83b7e4[_0x134e7a(0x1be)][_0x134e7a(0x19f)](hooks_utils_1[_0x134e7a(0x1bd)][_0x134e7a(0x16e)](this[_0x134e7a(0x18d)][_0x134e7a(0x1ad)],_0x83b7e4[_0x134e7a(0x1be)],this[_0x134e7a(0x18d)][_0x134e7a(0x1da)],_0x53de2a)));}return this['repoList'][_0x134e7a(0x1b7)](_0x83b7e4),_0x83b7e4;}async[a67_0x1722d1(0x186)](_0x339e1b){const _0x5b0f71=a67_0x1722d1;this[_0x5b0f71(0x183)]=await this['providersFactory'][_0x5b0f71(0x171)](_0x339e1b),this[_0x5b0f71(0x18c)]=await repository_factory_1['RepositoryFactory']['createFromContext'](typedi_1[_0x5b0f71(0x1d8)]),this['config']=typedi_1[_0x5b0f71(0x1d8)][_0x5b0f71(0x1b2)](providers_tokens_1[_0x5b0f71(0x190)][_0x5b0f71(0x18d)]),this[_0x5b0f71(0x1cd)]=typedi_1[_0x5b0f71(0x1d8)][_0x5b0f71(0x1b2)](providers_tokens_1['Tokens']['logger']),this[_0x5b0f71(0x1e2)]='['+SyncService_1['name']+_0x5b0f71(0x1a2)+this[_0x5b0f71(0x18d)][_0x5b0f71(0x1ad)][_0x5b0f71(0x1e0)]()+']',this[_0x5b0f71(0x170)][_0x5b0f71(0x1a0)](this[_0x5b0f71(0x1cd)][_0x5b0f71(0x17d)]());try{this[_0x5b0f71(0x1cd)][_0x5b0f71(0x178)](this[_0x5b0f71(0x1e2)]+_0x5b0f71(0x174)),await this[_0x5b0f71(0x1cd)][_0x5b0f71(0x178)](this['prefix']+'\x20Getting\x20repository\x20records.')[_0x5b0f71(0x1ac)]();const _0x2af871=await this[_0x5b0f71(0x1a8)][_0x5b0f71(0x168)](_0x339e1b);await this[_0x5b0f71(0x1cd)][_0x5b0f71(0x178)](this[_0x5b0f71(0x1e2)]+'\x20Getting\x20branch\x20records.')[_0x5b0f71(0x1ac)]();const _0x1fca30=await this[_0x5b0f71(0x1a8)]['getBranchRecords'](_0x2af871[_0x5b0f71(0x1ab)](_0x352132=>'\x27'+_0x352132[_0x5b0f71(0x17e)]+'\x27')[_0x5b0f71(0x194)](','));await this[_0x5b0f71(0x1cd)]['log'](this[_0x5b0f71(0x1e2)]+_0x5b0f71(0x1b0))[_0x5b0f71(0x1ac)](),this[_0x5b0f71(0x1a5)]=await this['repoService'][_0x5b0f71(0x176)]();const _0x145cae=[..._0x2af871,..._0x1fca30];this[_0x5b0f71(0x1cd)][_0x5b0f71(0x178)](this[_0x5b0f71(0x1e2)]+_0x5b0f71(0x1d4)+_0x145cae[_0x5b0f71(0x1c8)]+_0x5b0f71(0x19b));for(const _0x178ef2 of _0x145cae){this[_0x5b0f71(0x19e)][_0x5b0f71(0x178)](_0x5b0f71(0x1e3)+_0x178ef2[_0x5b0f71(0x1ca)]+'['+_0x178ef2[_0x5b0f71(0x17e)]+_0x5b0f71(0x1d1)+_0x178ef2[_0x5b0f71(0x1a4)]+'['+_0x178ef2['branchId']+_0x5b0f71(0x1c1)),this[_0x5b0f71(0x1cd)][_0x5b0f71(0x178)](this[_0x5b0f71(0x1e2)]+_0x5b0f71(0x1a6)+_0x178ef2[_0x5b0f71(0x1ca)]+'\x22\x20branch:\x20\x22'+_0x178ef2[_0x5b0f71(0x1a4)]+'\x22.'),this['sfLogger'][_0x5b0f71(0x178)](this['prefix']+_0x5b0f71(0x1d2));const _0x54747a=await this[_0x5b0f71(0x198)](_0x178ef2);if(!_0x54747a)continue;this[_0x5b0f71(0x1cd)]['log'](this['prefix']+_0x5b0f71(0x196));const _0x579e6e=await this['isIntersects'](_0x178ef2);if(_0x579e6e)continue;await this[_0x5b0f71(0x1cd)][_0x5b0f71(0x1ac)]();let _0x5010f5;try{await this[_0x5b0f71(0x1cd)][_0x5b0f71(0x178)](this[_0x5b0f71(0x1e2)]+_0x5b0f71(0x1de))[_0x5b0f71(0x1ac)](),_0x5010f5=await this[_0x5b0f71(0x16c)](_0x178ef2,_0x339e1b);}catch(_0x5821b1){await this[_0x5b0f71(0x1bf)](_0x178ef2,_0x5821b1 instanceof too_many_requests_error_1[_0x5b0f71(0x17c)]?_0x5821b1:new Error('[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20'+_0x5821b1));continue;}await this['sfLogger'][_0x5b0f71(0x178)](this[_0x5b0f71(0x1e2)]+_0x5b0f71(0x185))[_0x5b0f71(0x1ac)]();if(_0x178ef2[_0x5b0f71(0x1e5)]===flosum_repository_sync_dto_1['SyncDirection'][_0x5b0f71(0x1e4)]){const _0x4761ff=typedi_1[_0x5b0f71(0x1d8)][_0x5b0f71(0x1b2)](flosum_sync_job_1[_0x5b0f71(0x184)]);await _0x4761ff[_0x5b0f71(0x186)]({'repository':_0x5010f5,'convertToSFDX':this[_0x5b0f71(0x18d)][_0x5b0f71(0x16a)],'syncRecord':_0x178ef2,'provider':this[_0x5b0f71(0x18d)][_0x5b0f71(0x1ad)]})['catch'](_0x410c86=>this[_0x5b0f71(0x1bf)](_0x178ef2,_0x410c86));}else{const _0x3cf069=typedi_1[_0x5b0f71(0x1d8)][_0x5b0f71(0x1b2)](git_sync_job_1['GitSyncJob']);await _0x3cf069['run']({'repository':_0x5010f5,'branch':_0x178ef2[_0x5b0f71(0x1a4)],'provider':this[_0x5b0f71(0x18d)][_0x5b0f71(0x1ad)],'repositoryGit':_0x5010f5[_0x5b0f71(0x1c6)],'syncRecord':_0x178ef2})['catch'](_0x357db4=>this[_0x5b0f71(0x1bf)](_0x178ef2,_0x357db4));}}}catch(_0x41792a){this[_0x5b0f71(0x19e)][_0x5b0f71(0x1c2)](_0x41792a);_0x41792a instanceof too_many_requests_error_1[_0x5b0f71(0x17c)]?(await this[_0x5b0f71(0x1cd)][_0x5b0f71(0x178)](this[_0x5b0f71(0x1e2)]+_0x5b0f71(0x1df))['send'](),await utils_1[_0x5b0f71(0x1c4)](0x3c*0x3c*0x3e8),this[_0x5b0f71(0x186)](this[_0x5b0f71(0x18d)][_0x5b0f71(0x1ad)])):await this[_0x5b0f71(0x1cd)][_0x5b0f71(0x1c2)](this['prefix']+'\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x41792a)['send']();return;}await this['sfLogger'][_0x5b0f71(0x178)](this[_0x5b0f71(0x1e2)]+_0x5b0f71(0x1cf))['send'](),await this[_0x5b0f71(0x1a8)][_0x5b0f71(0x187)](_0x339e1b)[_0x5b0f71(0x172)](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a67_0x1722d1(0x1c7),[salesforce_service_1[a67_0x1722d1(0x1c9)],salesforce_sync_service_1[a67_0x1722d1(0x1a1)],connection_1[a67_0x1722d1(0x1b1)]])],SyncService),exports[a67_0x1722d1(0x181)]=SyncService;