const a111_0x2206dc=a111_0x3e01;(function(_0x5cb107,_0x45583d){const _0xf9b243=a111_0x3e01,_0x207f8f=_0x5cb107();while(!![]){try{const _0x2b0123=parseInt(_0xf9b243(0x1df))/0x1*(parseInt(_0xf9b243(0x1eb))/0x2)+-parseInt(_0xf9b243(0x1d0))/0x3*(-parseInt(_0xf9b243(0x204))/0x4)+parseInt(_0xf9b243(0x1f0))/0x5+-parseInt(_0xf9b243(0x224))/0x6*(-parseInt(_0xf9b243(0x22b))/0x7)+parseInt(_0xf9b243(0x211))/0x8*(-parseInt(_0xf9b243(0x1d2))/0x9)+-parseInt(_0xf9b243(0x207))/0xa*(parseInt(_0xf9b243(0x23d))/0xb)+-parseInt(_0xf9b243(0x21f))/0xc;if(_0x2b0123===_0x45583d)break;else _0x207f8f['push'](_0x207f8f['shift']());}catch(_0x451d52){_0x207f8f['push'](_0x207f8f['shift']());}}}(a111_0x5c9f,0xd526b));const a111_0x882f3e=(function(){let _0x2e633d=!![];return function(_0x69f39,_0x1e2e3c){const _0x5e1818=_0x2e633d?function(){if(_0x1e2e3c){const _0x1f24aa=_0x1e2e3c['apply'](_0x69f39,arguments);return _0x1e2e3c=null,_0x1f24aa;}}:function(){};return _0x2e633d=![],_0x5e1818;};}()),a111_0x2b4f38=a111_0x882f3e(this,function(){const _0x201996=a111_0x3e01;return a111_0x2b4f38[_0x201996(0x1e8)]()[_0x201996(0x1f6)](_0x201996(0x1cd))['toString']()[_0x201996(0x206)](a111_0x2b4f38)[_0x201996(0x1f6)](_0x201996(0x1cd));});a111_0x2b4f38();'use strict';function a111_0x3e01(_0x5c8806,_0x2d1f8d){const _0x23f541=a111_0x5c9f();return a111_0x3e01=function(_0x2b4f38,_0x882f3e){_0x2b4f38=_0x2b4f38-0x1cc;let _0x5c9fd3=_0x23f541[_0x2b4f38];return _0x5c9fd3;},a111_0x3e01(_0x5c8806,_0x2d1f8d);}var __decorate=this&&this['__decorate']||function(_0x113b10,_0x4ce866,_0xe989e8,_0x386313){const _0x13740b=a111_0x3e01;var _0x4d9782=arguments[_0x13740b(0x1f7)],_0x4661f6=_0x4d9782<0x3?_0x4ce866:_0x386313===null?_0x386313=Object['getOwnPropertyDescriptor'](_0x4ce866,_0xe989e8):_0x386313,_0x2b5c1a;if(typeof Reflect===_0x13740b(0x1cc)&&typeof Reflect[_0x13740b(0x242)]===_0x13740b(0x230))_0x4661f6=Reflect[_0x13740b(0x242)](_0x113b10,_0x4ce866,_0xe989e8,_0x386313);else{for(var _0x2a8e3e=_0x113b10[_0x13740b(0x1f7)]-0x1;_0x2a8e3e>=0x0;_0x2a8e3e--)if(_0x2b5c1a=_0x113b10[_0x2a8e3e])_0x4661f6=(_0x4d9782<0x3?_0x2b5c1a(_0x4661f6):_0x4d9782>0x3?_0x2b5c1a(_0x4ce866,_0xe989e8,_0x4661f6):_0x2b5c1a(_0x4ce866,_0xe989e8))||_0x4661f6;}return _0x4d9782>0x3&&_0x4661f6&&Object[_0x13740b(0x1e9)](_0x4ce866,_0xe989e8,_0x4661f6),_0x4661f6;},__metadata=this&&this['__metadata']||function(_0x56e487,_0x54f5ca){const _0x38262e=a111_0x3e01;if(typeof Reflect===_0x38262e(0x1cc)&&typeof Reflect[_0x38262e(0x221)]==='function')return Reflect[_0x38262e(0x221)](_0x56e487,_0x54f5ca);},SyncService_1;Object[a111_0x2206dc(0x1e9)](exports,a111_0x2206dc(0x200),{'value':!![]}),exports[a111_0x2206dc(0x1f8)]=void 0x0;function a111_0x5c9f(){const _0x3e4a2f=['design:paramtypes','../../salesforce/services/salesforce.service','411056vEaqxE','typedi','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','toLowerCase','Service','sleep','checkValidNaming','gitProvider','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','../../../../core','branchId','../errors/git-branch-not-found.error','setStatus','hooks','30524832CMvdwa','createHookPayload','metadata','getLoggerId','\x27\x20[','6vkIwLT','run','sfLogger','\x20Checking\x20valid\x20name.','applicationUrl','salesforceSync','\x20branches.','9702329hEuGhy','BRANCH_NAME_REGEXP','branchName',']\x20due\x20error\x20-\x20','get','function','isIntersects','Tokens','direction','SalesforceError','../jobs/git-sync.job','repositoryId','gitApiService','REPOSITORY_NAME_REGEXP','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','Error','../../../shared/utils','create','3168WjqcbB','Container','name','../../../../constants','gitRepoService','decorate','logger','getRepositoryRecords','setLoggerId','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','test','HooksUtils','updateRemoteState','\x20Checking\x20intersects.','Syncing\x20','object','(((.+)+)+)+$','\x20Getting\x20repositories\x20from\x20git\x20service.','salesforceService','8031bkBwxb','../../../../core/errors/bad-request.error','126EgbcDb','push','isConvertToSfdx','\x20Start\x20sync\x20job.','../../providers/web-hooks/hooks.utils','FlosumSyncJob','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','connectionId','disableSync','../jobs/flosum-sync.job','getAll',']\x20[','gitUrl','1104853cbjddj','find','\x20Repository\x20\x22','\x20Have\x20to\x20synchronize\x20','toUpperCase','TooManyRequests','SalesforceSyncService','repositoryName','error','toString','defineProperty','Logger','2cmzFlb','repositoriesIntersections','Unable\x20to\x20synchronize\x20branch\x20\x27','config','prefix','8050760NJnjdl','Not\x20Synchronized','\x20Getting\x20repository\x20records.','join','repoList','../../salesforce/dto/flosum-repository-sync.dto','search','length','SyncService','catch','\x20Sync\x20job\x20done.','getOrCreateRepo','send','handleRecordSyncError','repoService','\x27\x20-\x20\x27','__esModule','Unable\x20to\x20synchronize\x20repository\x20\x27','../../salesforce/services/salesforce-sync.service','SyncDirection','188QbpPON','getBranchRecords','constructor','3150nMSVSJ','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','isBidirectionalSynchronization','log','\x22\x20branch:\x20\x22','map','\x20Getting\x20Flosum\x20repository','../../providers/providers.tokens'];a111_0x5c9f=function(){return _0x3e4a2f;};return a111_0x5c9f();}const constants_1=require(a111_0x2206dc(0x240)),core_1=require(a111_0x2206dc(0x21a)),too_many_requests_error_1=require('../../../../core/errors/too-many-requests.error'),flosum_repository_sync_dto_1=require(a111_0x2206dc(0x1f5)),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require(a111_0x2206dc(0x202)),salesforce_service_1=require(a111_0x2206dc(0x210)),utils_1=require(a111_0x2206dc(0x23b)),typedi_1=require(a111_0x2206dc(0x212)),hooks_utils_1=require(a111_0x2206dc(0x1d6)),git_branch_not_found_error_1=require(a111_0x2206dc(0x21c)),flosum_sync_job_1=require(a111_0x2206dc(0x1db)),git_sync_job_1=require(a111_0x2206dc(0x235)),providers_tokens_1=require(a111_0x2206dc(0x20e)),bad_request_error_1=require(a111_0x2206dc(0x1d1));let SyncService=SyncService_1=class SyncService{constructor(_0x1746be,_0x342a2e){const _0x70bee4=a111_0x2206dc;this[_0x70bee4(0x1cf)]=_0x1746be,this[_0x70bee4(0x229)]=_0x342a2e,this[_0x70bee4(0x243)]=new core_1[(_0x70bee4(0x1ea))](SyncService_1[_0x70bee4(0x23f)]),this['repositoriesIntersections']={},this[_0x70bee4(0x1f4)]=[];}async['handleRecordSyncError'](_0x3bfca4,_0x4ab5ba){const _0x54e50c=a111_0x2206dc;if(_0x4ab5ba instanceof git_branch_not_found_error_1['GitBranchNotFoundError']){await this[_0x54e50c(0x229)]['setStatus'](_0x3bfca4,_0x54e50c(0x1f1));return;}if(_0x4ab5ba instanceof too_many_requests_error_1[_0x54e50c(0x1e4)]){await this[_0x54e50c(0x229)][_0x54e50c(0x21d)](_0x3bfca4,'Waiting');throw _0x4ab5ba;}try{await this['sfLogger'][_0x54e50c(0x1e7)](this[_0x54e50c(0x1ef)]+'\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x3bfca4[_0x54e50c(0x1e6)]+_0x54e50c(0x223)+_0x3bfca4['branchName']+_0x54e50c(0x22e)+_0x4ab5ba+'.')['send'](),await this[_0x54e50c(0x229)][_0x54e50c(0x249)](_0x3bfca4,{}),await this[_0x54e50c(0x229)]['setStatus'](_0x3bfca4,_0x54e50c(0x23a));}catch(_0xe97766){if(_0xe97766 instanceof salesforce_error_1[_0x54e50c(0x234)])throw _0xe97766;}}async[a111_0x2206dc(0x231)](_0xa31d18){const _0x17e347=a111_0x2206dc;if(_0xa31d18[_0x17e347(0x236)]){const _0x2889fc=_0xa31d18[_0x17e347(0x1e6)][_0x17e347(0x214)](),_0x2382d6=this[_0x17e347(0x1ec)][_0x2889fc];if(!_0x2382d6)this['repositoriesIntersections'][_0x2889fc]=_0xa31d18[_0x17e347(0x1e6)];else{if(_0x2382d6&&_0x2382d6!==_0xa31d18[_0x17e347(0x1e6)])return await this[_0x17e347(0x1fd)](_0xa31d18,new Error(_0x17e347(0x201)+_0xa31d18['repositoryName']+_0x17e347(0x1d8)+_0x2889fc+_0x17e347(0x1ff)+_0x2382d6+'\x27')),!![];}}return![];}async[a111_0x2206dc(0x217)](_0x14870d){const _0x2337b4=a111_0x2206dc;if(!constants_1[_0x2337b4(0x238)]['test'](_0x14870d[_0x2337b4(0x1e6)]))return await this[_0x2337b4(0x1fd)](_0x14870d,new Error('Unable\x20to\x20synchronize\x20repository\x20\x27'+_0x14870d['repositoryName']+_0x2337b4(0x246))),![];if(!constants_1[_0x2337b4(0x22c)][_0x2337b4(0x247)](_0x14870d[_0x2337b4(0x22d)]))return await this[_0x2337b4(0x1fd)](_0x14870d,new Error(_0x2337b4(0x1ed)+_0x14870d[_0x2337b4(0x22d)]+'\x27\x20in\x20repository\x20\x27'+_0x14870d['repositoryName']+_0x2337b4(0x213))),![];return!![];}async[a111_0x2206dc(0x1fb)](_0x58b6ca,_0x2e87d9){const _0x5d1a62=a111_0x2206dc;let _0x51b7d6=this['repoList']['find'](_0x17958c=>_0x58b6ca[_0x5d1a62(0x1e6)]===_0x17958c[_0x5d1a62(0x23f)]);!_0x51b7d6&&(this[_0x5d1a62(0x226)][_0x5d1a62(0x20a)](this[_0x5d1a62(0x1ef)]+_0x5d1a62(0x1e1)+_0x58b6ca['repositoryName']+_0x5d1a62(0x219)),_0x51b7d6=await this[_0x5d1a62(0x1fe)]['create']({'name':_0x58b6ca[_0x5d1a62(0x1e6)],'autoInit':!![],'defaultBranch':_0x58b6ca[_0x5d1a62(0x22d)],'private':!![],'createHook':typedi_1[_0x5d1a62(0x23e)][_0x5d1a62(0x22f)](providers_tokens_1[_0x5d1a62(0x232)][_0x5d1a62(0x1ee)])[_0x5d1a62(0x209)]}));if(this[_0x5d1a62(0x1ee)][_0x5d1a62(0x209)]){const _0x11c47b=await _0x51b7d6['hooks'][_0x5d1a62(0x1dc)]();!_0x11c47b[_0x5d1a62(0x1e0)](_0x4b02a0=>_0x4b02a0['url']===hooks_utils_1['HooksUtils']['getHookLinkFor'](this[_0x5d1a62(0x1ee)][_0x5d1a62(0x218)],this['config'][_0x5d1a62(0x228)],_0x2e87d9))&&(this[_0x5d1a62(0x226)]['log'](this['prefix']+'\x20Repository\x20\x22'+_0x58b6ca[_0x5d1a62(0x1e6)]+'\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.'),await _0x51b7d6[_0x5d1a62(0x21e)][_0x5d1a62(0x23c)](hooks_utils_1[_0x5d1a62(0x248)][_0x5d1a62(0x220)](this['config'][_0x5d1a62(0x218)],_0x51b7d6['hooks'],this[_0x5d1a62(0x1ee)][_0x5d1a62(0x228)],_0x2e87d9)));}return this[_0x5d1a62(0x1f4)][_0x5d1a62(0x1d3)](_0x51b7d6),_0x51b7d6;}async[a111_0x2206dc(0x225)](){const _0x129c73=a111_0x2206dc;this[_0x129c73(0x237)]=typedi_1[_0x129c73(0x23e)]['get'](providers_tokens_1[_0x129c73(0x232)][_0x129c73(0x237)]),this[_0x129c73(0x1fe)]=typedi_1[_0x129c73(0x23e)][_0x129c73(0x22f)](providers_tokens_1[_0x129c73(0x232)][_0x129c73(0x241)]),this[_0x129c73(0x1ee)]=typedi_1[_0x129c73(0x23e)][_0x129c73(0x22f)](providers_tokens_1[_0x129c73(0x232)]['config']),this[_0x129c73(0x226)]=typedi_1['Container'][_0x129c73(0x22f)](providers_tokens_1[_0x129c73(0x232)][_0x129c73(0x243)]),this[_0x129c73(0x1ef)]='['+SyncService_1['name']+_0x129c73(0x1dd)+this[_0x129c73(0x1ee)]['gitProvider'][_0x129c73(0x1e3)]()+']',this[_0x129c73(0x1cf)][_0x129c73(0x245)](this[_0x129c73(0x226)][_0x129c73(0x222)]());try{this[_0x129c73(0x226)]['log'](this[_0x129c73(0x1ef)]+_0x129c73(0x1d5)),await this[_0x129c73(0x226)][_0x129c73(0x20a)](this[_0x129c73(0x1ef)]+_0x129c73(0x1f2))[_0x129c73(0x1fc)]();const _0x39bb4f=await this['salesforceSync'][_0x129c73(0x244)](typedi_1['Container'][_0x129c73(0x22f)](providers_tokens_1['Tokens'][_0x129c73(0x1d9)]));if(!_0x39bb4f[_0x129c73(0x1f7)])throw new bad_request_error_1['BadRequestError'](this[_0x129c73(0x1ef)]+'\x20No\x20repositories\x20to\x20sync.');await this[_0x129c73(0x226)][_0x129c73(0x20a)](this[_0x129c73(0x1ef)]+'\x20Getting\x20branch\x20records.')[_0x129c73(0x1fc)]();const _0x44569d=await this[_0x129c73(0x229)][_0x129c73(0x205)](_0x39bb4f[_0x129c73(0x20c)](_0x15da6a=>'\x27'+_0x15da6a[_0x129c73(0x236)]+'\x27')[_0x129c73(0x1f3)](','));await this['sfLogger']['log'](this[_0x129c73(0x1ef)]+_0x129c73(0x1ce))[_0x129c73(0x1fc)](),this['repoList']=await this['repoService'][_0x129c73(0x1dc)]();const _0x4d0b54=[..._0x39bb4f,..._0x44569d];this[_0x129c73(0x226)][_0x129c73(0x20a)](this[_0x129c73(0x1ef)]+_0x129c73(0x1e2)+_0x4d0b54['length']+_0x129c73(0x22a));for(const _0x170054 of _0x4d0b54){this['logger'][_0x129c73(0x20a)](_0x129c73(0x24b)+_0x170054['repositoryName']+'['+_0x170054[_0x129c73(0x236)]+']\x20repository\x20'+_0x170054[_0x129c73(0x22d)]+'['+_0x170054[_0x129c73(0x21b)]+']\x20branch.'),this['sfLogger']['log'](this[_0x129c73(0x1ef)]+'\x20Syncing\x20repository:\x20\x22'+_0x170054[_0x129c73(0x1e6)]+_0x129c73(0x20b)+_0x170054[_0x129c73(0x22d)]+'\x22.'),this[_0x129c73(0x226)][_0x129c73(0x20a)](this[_0x129c73(0x1ef)]+_0x129c73(0x227));const _0x2bd466=await this[_0x129c73(0x217)](_0x170054);if(!_0x2bd466)continue;this[_0x129c73(0x226)][_0x129c73(0x20a)](this['prefix']+_0x129c73(0x24a));const _0x34a7c6=await this[_0x129c73(0x231)](_0x170054);if(_0x34a7c6)continue;await this[_0x129c73(0x226)][_0x129c73(0x1fc)]();let _0x576723;try{await this[_0x129c73(0x226)][_0x129c73(0x20a)](this[_0x129c73(0x1ef)]+_0x129c73(0x20d))[_0x129c73(0x1fc)](),_0x576723=await this[_0x129c73(0x1fb)](_0x170054,typedi_1[_0x129c73(0x23e)][_0x129c73(0x22f)](providers_tokens_1[_0x129c73(0x232)][_0x129c73(0x1d9)]));}catch(_0x1cc49c){await this['handleRecordSyncError'](_0x170054,_0x1cc49c instanceof too_many_requests_error_1[_0x129c73(0x1e4)]?_0x1cc49c:new Error(_0x129c73(0x208)+_0x1cc49c));continue;}await this[_0x129c73(0x226)][_0x129c73(0x20a)](this['prefix']+'\x20Completed\x20prepare\x20to\x20syncing.')['send']();if(_0x170054[_0x129c73(0x233)]===flosum_repository_sync_dto_1[_0x129c73(0x203)]['FlosumToGit']){const _0xa7958=typedi_1[_0x129c73(0x23e)][_0x129c73(0x22f)](flosum_sync_job_1[_0x129c73(0x1d7)]);await _0xa7958[_0x129c73(0x225)]({'repository':_0x576723,'convertToSFDX':this[_0x129c73(0x1ee)][_0x129c73(0x1d4)],'syncRecord':_0x170054,'provider':this[_0x129c73(0x1ee)][_0x129c73(0x218)]})[_0x129c73(0x1f9)](_0x1cce72=>this[_0x129c73(0x1fd)](_0x170054,_0x1cce72));}else{const _0x115511=typedi_1['Container'][_0x129c73(0x22f)](git_sync_job_1['GitSyncJob']);await _0x115511[_0x129c73(0x225)]({'repository':_0x576723,'branch':_0x170054[_0x129c73(0x22d)],'provider':this[_0x129c73(0x1ee)][_0x129c73(0x218)],'repositoryGit':_0x576723[_0x129c73(0x1de)],'syncRecord':_0x170054})[_0x129c73(0x1f9)](_0x14e411=>this['handleRecordSyncError'](_0x170054,_0x14e411));}}}catch(_0xeb00f1){this[_0x129c73(0x243)][_0x129c73(0x1e7)](_0xeb00f1);_0xeb00f1 instanceof too_many_requests_error_1[_0x129c73(0x1e4)]?(await this['sfLogger'][_0x129c73(0x20a)](this[_0x129c73(0x1ef)]+'\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.')[_0x129c73(0x1fc)](),await(0x0,utils_1[_0x129c73(0x216)])(0x3c*0x3c*0x3e8),this[_0x129c73(0x225)]()):await this[_0x129c73(0x226)][_0x129c73(0x1e7)](this[_0x129c73(0x1ef)]+_0x129c73(0x239)+_0xeb00f1)[_0x129c73(0x1fc)]();return;}await this[_0x129c73(0x226)]['log'](this[_0x129c73(0x1ef)]+_0x129c73(0x1fa))[_0x129c73(0x1fc)](),await this['salesforceSync'][_0x129c73(0x1da)](typedi_1[_0x129c73(0x23e)][_0x129c73(0x22f)](providers_tokens_1['Tokens']['connectionId']))[_0x129c73(0x1f9)](()=>null);}};SyncService=SyncService_1=__decorate([(0x0,typedi_1[a111_0x2206dc(0x215)])({'transient':!![]}),__metadata(a111_0x2206dc(0x20f),[salesforce_service_1['SalesforceService'],salesforce_sync_service_1[a111_0x2206dc(0x1e5)]])],SyncService),exports[a111_0x2206dc(0x1f8)]=SyncService;