const a129_0xef56f8=a129_0x98cc;(function(_0x4357a1,_0x23a3a1){const _0x1884a1=a129_0x98cc,_0x21600c=_0x4357a1();while(!![]){try{const _0x40fba9=parseInt(_0x1884a1(0x176))/0x1+parseInt(_0x1884a1(0x161))/0x2+-parseInt(_0x1884a1(0x19d))/0x3+-parseInt(_0x1884a1(0x196))/0x4+parseInt(_0x1884a1(0x193))/0x5*(parseInt(_0x1884a1(0x182))/0x6)+-parseInt(_0x1884a1(0x1b6))/0x7*(parseInt(_0x1884a1(0x177))/0x8)+parseInt(_0x1884a1(0x17d))/0x9;if(_0x40fba9===_0x23a3a1)break;else _0x21600c['push'](_0x21600c['shift']());}catch(_0x34fc82){_0x21600c['push'](_0x21600c['shift']());}}}(a129_0x5d3c,0xebca7));const a129_0x55bee7=(function(){let _0x479b82=!![];return function(_0x2bfb74,_0x41d8f3){const _0x1b867c=_0x479b82?function(){const _0x1769ee=a129_0x98cc;if(_0x41d8f3){const _0xa4f04f=_0x41d8f3[_0x1769ee(0x190)](_0x2bfb74,arguments);return _0x41d8f3=null,_0xa4f04f;}}:function(){};return _0x479b82=![],_0x1b867c;};}()),a129_0x540582=a129_0x55bee7(this,function(){const _0x3063f8=a129_0x98cc;return a129_0x540582[_0x3063f8(0x144)]()[_0x3063f8(0x13f)](_0x3063f8(0x1af))[_0x3063f8(0x144)]()[_0x3063f8(0x191)](a129_0x540582)[_0x3063f8(0x13f)](_0x3063f8(0x1af));});function a129_0x5d3c(){const _0x1858e3=['name','getBranchRecords','isIntersects','\x20Completed\x20prepare\x20to\x20syncing.',']\x20[','create','salesforceSync','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','branchId','direction','sfLogger','\x20Getting\x20branch\x20records.','Service','../../../../core/errors/bad-request.error','find','BRANCH_NAME_REGEXP','932077DDATZI','40agTTan','../../../../core/errors/too-many-requests.error','\x20Getting\x20repository\x20records.','config','branchName','run','20120958bkGjUE',']\x20repository\x20','test','\x20branches.','../jobs/git-sync.job','629682mbWIiG','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','repositoryName','../../../shared/utils','SalesforceError','applicationUrl','object','getAll','repoService','decorate','isBidirectionalSynchronization','../../../../constants','updateRemoteState','HooksUtils','apply','constructor','Logger','10qtFdTH','catch','sleep','3247724acXfvH','GitBranchNotFoundError','log','../../providers/providers.tokens','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20',']\x20due\x20error\x20-\x20','getLoggerId','5171865CXjcyx','metadata','../errors/git-branch-not-found.error','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','disableSync','\x20Sync\x20job\x20done.','length','checkValidNaming','getOrCreateRepo','getOwnPropertyDescriptor','hooks','\x20Repository\x20\x22','../../salesforce/services/salesforce-sync.service','\x20Start\x20sync\x20job.','gitApiService','\x20No\x20repositories\x20to\x20sync.','setLoggerId','getRepositoryRecords','(((.+)+)+)+$','repositoryId','Unable\x20to\x20synchronize\x20repository\x20\x27','typedi','BadRequestError',']\x20branch.','\x22\x20branch:\x20\x22','131439ulgznI','repositoriesIntersections','get','design:paramtypes','SalesforceSyncService','FlosumToGit','prefix','\x20Stop\x20sync\x20job\x20for\x20\x27','search','gitRepoService','toLowerCase','\x27\x20[','join','toString','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','function','logger','../../providers/web-hooks/hooks.utils','setStatus','REPOSITORY_NAME_REGEXP','../../../../core','defineProperty','gitUrl','createHookPayload','isConvertToSfdx','Waiting','GitSyncJob','FlosumSyncJob','send','SalesforceService','Tokens','handleRecordSyncError','salesforceService','../../salesforce/services/salesforce.service','__decorate','\x27\x20-\x20\x27','error','\x20Checking\x20intersects.','\x20Getting\x20Flosum\x20repository','Container','__esModule','gitProvider','435874HyeKNk','SyncDirection','\x27\x20in\x20repository\x20\x27','TooManyRequests','repoList'];a129_0x5d3c=function(){return _0x1858e3;};return a129_0x5d3c();}a129_0x540582();'use strict';var __decorate=this&&this[a129_0xef56f8(0x159)]||function(_0x12dc22,_0x3237d9,_0x3df887,_0x2f2b70){const _0x536dfd=a129_0xef56f8;var _0x48796d=arguments[_0x536dfd(0x1a3)],_0x58d21a=_0x48796d<0x3?_0x3237d9:_0x2f2b70===null?_0x2f2b70=Object[_0x536dfd(0x1a6)](_0x3237d9,_0x3df887):_0x2f2b70,_0x186ba2;if(typeof Reflect===_0x536dfd(0x188)&&typeof Reflect[_0x536dfd(0x18b)]===_0x536dfd(0x146))_0x58d21a=Reflect[_0x536dfd(0x18b)](_0x12dc22,_0x3237d9,_0x3df887,_0x2f2b70);else{for(var _0x4ccfe1=_0x12dc22['length']-0x1;_0x4ccfe1>=0x0;_0x4ccfe1--)if(_0x186ba2=_0x12dc22[_0x4ccfe1])_0x58d21a=(_0x48796d<0x3?_0x186ba2(_0x58d21a):_0x48796d>0x3?_0x186ba2(_0x3237d9,_0x3df887,_0x58d21a):_0x186ba2(_0x3237d9,_0x3df887))||_0x58d21a;}return _0x48796d>0x3&&_0x58d21a&&Object[_0x536dfd(0x14c)](_0x3237d9,_0x3df887,_0x58d21a),_0x58d21a;},__metadata=this&&this['__metadata']||function(_0x2eef11,_0x50f34c){const _0x331a19=a129_0xef56f8;if(typeof Reflect===_0x331a19(0x188)&&typeof Reflect[_0x331a19(0x19e)]===_0x331a19(0x146))return Reflect['metadata'](_0x2eef11,_0x50f34c);},SyncService_1;Object['defineProperty'](exports,a129_0xef56f8(0x15f),{'value':!![]}),exports['SyncService']=void 0x0;const constants_1=require(a129_0xef56f8(0x18d)),core_1=require(a129_0xef56f8(0x14b)),too_many_requests_error_1=require(a129_0xef56f8(0x178)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_sync_service_1=require(a129_0xef56f8(0x1a9)),salesforce_service_1=require(a129_0xef56f8(0x158)),utils_1=require(a129_0xef56f8(0x185)),typedi_1=require(a129_0xef56f8(0x1b2)),hooks_utils_1=require(a129_0xef56f8(0x148)),git_branch_not_found_error_1=require(a129_0xef56f8(0x19f)),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require(a129_0xef56f8(0x181)),providers_tokens_1=require(a129_0xef56f8(0x199)),bad_request_error_1=require(a129_0xef56f8(0x173));let SyncService=SyncService_1=class SyncService{constructor(_0x5e714f,_0x1217ee){const _0x22abed=a129_0xef56f8;this[_0x22abed(0x157)]=_0x5e714f,this[_0x22abed(0x16c)]=_0x1217ee,this[_0x22abed(0x147)]=new core_1[(_0x22abed(0x192))](SyncService_1[_0x22abed(0x166)]),this[_0x22abed(0x1b7)]={},this[_0x22abed(0x165)]=[];}async[a129_0xef56f8(0x156)](_0x24226f,_0x2d6dba){const _0x1e7228=a129_0xef56f8;if(_0x2d6dba instanceof git_branch_not_found_error_1[_0x1e7228(0x197)]){await this[_0x1e7228(0x16c)][_0x1e7228(0x149)](_0x24226f,'Not\x20Synchronized');return;}if(_0x2d6dba instanceof too_many_requests_error_1[_0x1e7228(0x164)]){await this['salesforceSync'][_0x1e7228(0x149)](_0x24226f,_0x1e7228(0x150));throw _0x2d6dba;}try{await this[_0x1e7228(0x170)][_0x1e7228(0x15b)](this[_0x1e7228(0x13d)]+_0x1e7228(0x13e)+_0x24226f['repositoryName']+_0x1e7228(0x142)+_0x24226f[_0x1e7228(0x17b)]+_0x1e7228(0x19b)+_0x2d6dba+'.')[_0x1e7228(0x153)](),await this[_0x1e7228(0x16c)][_0x1e7228(0x18e)](_0x24226f,{}),await this[_0x1e7228(0x16c)][_0x1e7228(0x149)](_0x24226f,'Error');}catch(_0x201c74){if(_0x201c74 instanceof salesforce_error_1[_0x1e7228(0x186)])throw _0x201c74;}}async[a129_0xef56f8(0x168)](_0xbcd2f4){const _0x5bfaaa=a129_0xef56f8;if(_0xbcd2f4[_0x5bfaaa(0x1b0)]){const _0xc11628=_0xbcd2f4[_0x5bfaaa(0x184)][_0x5bfaaa(0x141)](),_0x514e81=this[_0x5bfaaa(0x1b7)][_0xc11628];if(!_0x514e81)this['repositoriesIntersections'][_0xc11628]=_0xbcd2f4[_0x5bfaaa(0x184)];else{if(_0x514e81&&_0x514e81!==_0xbcd2f4['repositoryName'])return await this[_0x5bfaaa(0x156)](_0xbcd2f4,new Error(_0x5bfaaa(0x1b1)+_0xbcd2f4['repositoryName']+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0xc11628+_0x5bfaaa(0x15a)+_0x514e81+'\x27')),!![];}}return![];}async[a129_0xef56f8(0x1a4)](_0x1f8240){const _0x337072=a129_0xef56f8;if(!constants_1[_0x337072(0x14a)][_0x337072(0x17f)](_0x1f8240[_0x337072(0x184)]))return await this[_0x337072(0x156)](_0x1f8240,new Error(_0x337072(0x1b1)+_0x1f8240[_0x337072(0x184)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1[_0x337072(0x175)][_0x337072(0x17f)](_0x1f8240[_0x337072(0x17b)]))return await this[_0x337072(0x156)](_0x1f8240,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x1f8240[_0x337072(0x17b)]+_0x337072(0x163)+_0x1f8240[_0x337072(0x184)]+_0x337072(0x16d))),![];return!![];}async['getOrCreateRepo'](_0x13c49a,_0x375162){const _0x40ccd2=a129_0xef56f8;let _0x281cf3=this[_0x40ccd2(0x165)][_0x40ccd2(0x174)](_0x452695=>_0x13c49a[_0x40ccd2(0x184)]===_0x452695[_0x40ccd2(0x166)]);!_0x281cf3&&(this[_0x40ccd2(0x170)][_0x40ccd2(0x198)](this['prefix']+_0x40ccd2(0x1a8)+_0x13c49a[_0x40ccd2(0x184)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x281cf3=await this[_0x40ccd2(0x18a)][_0x40ccd2(0x16b)]({'name':_0x13c49a['repositoryName'],'autoInit':!![],'defaultBranch':_0x13c49a[_0x40ccd2(0x17b)],'private':!![],'createHook':typedi_1[_0x40ccd2(0x15e)][_0x40ccd2(0x139)](providers_tokens_1[_0x40ccd2(0x155)]['config'])[_0x40ccd2(0x18c)]}));if(this[_0x40ccd2(0x17a)][_0x40ccd2(0x18c)]){const _0x206f2b=await _0x281cf3[_0x40ccd2(0x1a7)][_0x40ccd2(0x189)]();!_0x206f2b[_0x40ccd2(0x174)](_0x1e9495=>_0x1e9495['url']===hooks_utils_1[_0x40ccd2(0x18f)]['getHookLinkFor'](this[_0x40ccd2(0x17a)]['gitProvider'],this['config']['applicationUrl'],_0x375162))&&(this['sfLogger'][_0x40ccd2(0x198)](this['prefix']+_0x40ccd2(0x1a8)+_0x13c49a['repositoryName']+_0x40ccd2(0x1a0)),await _0x281cf3[_0x40ccd2(0x1a7)][_0x40ccd2(0x16b)](hooks_utils_1['HooksUtils'][_0x40ccd2(0x14e)](this[_0x40ccd2(0x17a)][_0x40ccd2(0x160)],_0x281cf3[_0x40ccd2(0x1a7)],this['config'][_0x40ccd2(0x187)],_0x375162)));}return this[_0x40ccd2(0x165)]['push'](_0x281cf3),_0x281cf3;}async[a129_0xef56f8(0x17c)](){const _0x29b345=a129_0xef56f8;this[_0x29b345(0x1ab)]=typedi_1[_0x29b345(0x15e)]['get'](providers_tokens_1['Tokens'][_0x29b345(0x1ab)]),this[_0x29b345(0x18a)]=typedi_1[_0x29b345(0x15e)]['get'](providers_tokens_1[_0x29b345(0x155)][_0x29b345(0x140)]),this['config']=typedi_1['Container']['get'](providers_tokens_1[_0x29b345(0x155)][_0x29b345(0x17a)]),this[_0x29b345(0x170)]=typedi_1[_0x29b345(0x15e)][_0x29b345(0x139)](providers_tokens_1[_0x29b345(0x155)][_0x29b345(0x147)]),this[_0x29b345(0x13d)]='['+SyncService_1[_0x29b345(0x166)]+_0x29b345(0x16a)+this[_0x29b345(0x17a)][_0x29b345(0x160)]['toUpperCase']()+']',this[_0x29b345(0x157)][_0x29b345(0x1ad)](this[_0x29b345(0x170)][_0x29b345(0x19c)]());try{this[_0x29b345(0x170)][_0x29b345(0x198)](this[_0x29b345(0x13d)]+_0x29b345(0x1aa)),await this[_0x29b345(0x170)]['log'](this[_0x29b345(0x13d)]+_0x29b345(0x179))['send']();const _0x574c1c=await this[_0x29b345(0x16c)][_0x29b345(0x1ae)](typedi_1[_0x29b345(0x15e)][_0x29b345(0x139)](providers_tokens_1[_0x29b345(0x155)]['connectionId']));if(!_0x574c1c[_0x29b345(0x1a3)])throw new bad_request_error_1[(_0x29b345(0x1b3))](this[_0x29b345(0x13d)]+_0x29b345(0x1ac));await this[_0x29b345(0x170)][_0x29b345(0x198)](this['prefix']+_0x29b345(0x171))['send']();const _0x4ae4e0=await this[_0x29b345(0x16c)][_0x29b345(0x167)](_0x574c1c['map'](_0xa2e331=>'\x27'+_0xa2e331[_0x29b345(0x1b0)]+'\x27')[_0x29b345(0x143)](','));await this['sfLogger']['log'](this[_0x29b345(0x13d)]+'\x20Getting\x20repositories\x20from\x20git\x20service.')[_0x29b345(0x153)](),this[_0x29b345(0x165)]=await this[_0x29b345(0x18a)][_0x29b345(0x189)]();const _0xdd50e5=[..._0x574c1c,..._0x4ae4e0];this[_0x29b345(0x170)][_0x29b345(0x198)](this[_0x29b345(0x13d)]+'\x20Have\x20to\x20synchronize\x20'+_0xdd50e5['length']+_0x29b345(0x180));for(const _0xb335ba of _0xdd50e5){this[_0x29b345(0x147)][_0x29b345(0x198)]('Syncing\x20'+_0xb335ba[_0x29b345(0x184)]+'['+_0xb335ba['repositoryId']+_0x29b345(0x17e)+_0xb335ba[_0x29b345(0x17b)]+'['+_0xb335ba[_0x29b345(0x16e)]+_0x29b345(0x1b4)),this['sfLogger']['log'](this['prefix']+'\x20Syncing\x20repository:\x20\x22'+_0xb335ba[_0x29b345(0x184)]+_0x29b345(0x1b5)+_0xb335ba[_0x29b345(0x17b)]+'\x22.'),this[_0x29b345(0x170)][_0x29b345(0x198)](this['prefix']+'\x20Checking\x20valid\x20name.');const _0x31e545=await this[_0x29b345(0x1a4)](_0xb335ba);if(!_0x31e545)continue;this[_0x29b345(0x170)][_0x29b345(0x198)](this[_0x29b345(0x13d)]+_0x29b345(0x15c));const _0x6d35b9=await this[_0x29b345(0x168)](_0xb335ba);if(_0x6d35b9)continue;await this[_0x29b345(0x170)][_0x29b345(0x153)]();let _0x21187c;try{await this[_0x29b345(0x170)][_0x29b345(0x198)](this[_0x29b345(0x13d)]+_0x29b345(0x15d))['send'](),_0x21187c=await this[_0x29b345(0x1a5)](_0xb335ba,typedi_1[_0x29b345(0x15e)][_0x29b345(0x139)](providers_tokens_1[_0x29b345(0x155)]['connectionId']));}catch(_0x593112){await this[_0x29b345(0x156)](_0xb335ba,_0x593112 instanceof too_many_requests_error_1[_0x29b345(0x164)]?_0x593112:new Error(_0x29b345(0x19a)+_0x593112));continue;}await this[_0x29b345(0x170)]['log'](this[_0x29b345(0x13d)]+_0x29b345(0x169))[_0x29b345(0x153)]();if(_0xb335ba[_0x29b345(0x16f)]===flosum_repository_sync_dto_1[_0x29b345(0x162)][_0x29b345(0x13c)]){const _0x1b3e8d=typedi_1[_0x29b345(0x15e)]['get'](flosum_sync_job_1[_0x29b345(0x152)]);await _0x1b3e8d[_0x29b345(0x17c)]({'repository':_0x21187c,'convertToSFDX':this['config'][_0x29b345(0x14f)],'syncRecord':_0xb335ba,'provider':this[_0x29b345(0x17a)][_0x29b345(0x160)]})['catch'](_0xf23d70=>this[_0x29b345(0x156)](_0xb335ba,_0xf23d70));}else{const _0x2e582f=typedi_1['Container']['get'](git_sync_job_1[_0x29b345(0x151)]);await _0x2e582f[_0x29b345(0x17c)]({'repository':_0x21187c,'branch':_0xb335ba['branchName'],'provider':this[_0x29b345(0x17a)]['gitProvider'],'repositoryGit':_0x21187c[_0x29b345(0x14d)],'syncRecord':_0xb335ba})[_0x29b345(0x194)](_0x1f7eb8=>this[_0x29b345(0x156)](_0xb335ba,_0x1f7eb8));}}}catch(_0x1855c6){this[_0x29b345(0x147)][_0x29b345(0x15b)](_0x1855c6);_0x1855c6 instanceof too_many_requests_error_1[_0x29b345(0x164)]?(await this['sfLogger'][_0x29b345(0x198)](this['prefix']+_0x29b345(0x183))[_0x29b345(0x153)](),await(0x0,utils_1[_0x29b345(0x195)])(0x3c*0x3c*0x3e8),this[_0x29b345(0x17c)]()):await this[_0x29b345(0x170)][_0x29b345(0x15b)](this['prefix']+_0x29b345(0x145)+_0x1855c6)[_0x29b345(0x153)]();return;}await this[_0x29b345(0x170)][_0x29b345(0x198)](this[_0x29b345(0x13d)]+_0x29b345(0x1a2))['send'](),await this[_0x29b345(0x16c)][_0x29b345(0x1a1)](typedi_1['Container'][_0x29b345(0x139)](providers_tokens_1['Tokens']['connectionId']))[_0x29b345(0x194)](()=>null);}};function a129_0x98cc(_0x5106fc,_0x48b153){const _0x3c06af=a129_0x5d3c();return a129_0x98cc=function(_0x540582,_0x55bee7){_0x540582=_0x540582-0x139;let _0x5d3cd0=_0x3c06af[_0x540582];return _0x5d3cd0;},a129_0x98cc(_0x5106fc,_0x48b153);}SyncService=SyncService_1=__decorate([(0x0,typedi_1[a129_0xef56f8(0x172)])({'transient':!![]}),__metadata(a129_0xef56f8(0x13a),[salesforce_service_1[a129_0xef56f8(0x154)],salesforce_sync_service_1[a129_0xef56f8(0x13b)]])],SyncService),exports['SyncService']=SyncService;