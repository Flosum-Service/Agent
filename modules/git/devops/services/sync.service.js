const a67_0x5ec1c2=a67_0x29ca;(function(_0x14349e,_0x4e8daf){const _0x4a77b0=a67_0x29ca,_0x119b83=_0x14349e();while(!![]){try{const _0x56cdf4=-parseInt(_0x4a77b0(0x169))/0x1+parseInt(_0x4a77b0(0x14f))/0x2*(parseInt(_0x4a77b0(0x141))/0x3)+parseInt(_0x4a77b0(0x198))/0x4*(parseInt(_0x4a77b0(0x15a))/0x5)+-parseInt(_0x4a77b0(0x194))/0x6+parseInt(_0x4a77b0(0x16d))/0x7+parseInt(_0x4a77b0(0x139))/0x8*(-parseInt(_0x4a77b0(0x128))/0x9)+parseInt(_0x4a77b0(0x13b))/0xa*(-parseInt(_0x4a77b0(0x132))/0xb);if(_0x56cdf4===_0x4e8daf)break;else _0x119b83['push'](_0x119b83['shift']());}catch(_0x280198){_0x119b83['push'](_0x119b83['shift']());}}}(a67_0x3093,0x698af));const a67_0x1d74bb=(function(){let _0x45683f=!![];return function(_0x42c54f,_0x558601){const _0x3978b3=_0x45683f?function(){if(_0x558601){const _0x4ef342=_0x558601['apply'](_0x42c54f,arguments);return _0x558601=null,_0x4ef342;}}:function(){};return _0x45683f=![],_0x3978b3;};}()),a67_0x2808ec=a67_0x1d74bb(this,function(){const _0x456f1a=a67_0x29ca;return a67_0x2808ec[_0x456f1a(0x13e)]()[_0x456f1a(0x154)](_0x456f1a(0x187))['toString']()[_0x456f1a(0x173)](a67_0x2808ec)[_0x456f1a(0x154)](_0x456f1a(0x187));});function a67_0x3093(){const _0x5f3b64=['setLoggerId','Syncing\x20','send','gitProvider','../../salesforce/dto/flosum-repository-sync.dto','sleep','repositoriesIntersections','510687svNgmy','Tokens','salesforceSync','../../salesforce/services/salesforce.service','\x20Getting\x20branch\x20records.','connectionId','push','repositoryName','prefix','FlosumSyncJob','11tziDmX','\x20Sync\x20job\x20done.','find','\x20Getting\x20Flosum\x20repository','decorate','repoList',']\x20due\x20error\x20-\x20','112WfgUKw','Error','3515630jfJxEO','getOwnPropertyDescriptor','metadata','toString','\x20branches.','getOrCreateRepo','620694ivJbNf','length','\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','logger','applicationUrl','../../salesforce/errors/salesforce.error','run','checkValidNaming','\x20[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','gitUrl','repositoryId','error','../../providers/providers.tokens','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','8siNJde','create','getAll','isBidirectionalSynchronization','Container','search','__esModule','SalesforceSyncService','\x20Have\x20to\x20synchronize\x20','TooManyRequests','isIntersects','4088275diCLoR','typedi','createHookPayload','../jobs/git-sync.job','url',']\x20repository\x20','Logger','log','../../../../core/errors/bad-request.error','\x20Getting\x20repositories\x20from\x20git\x20service.','Unable\x20to\x20synchronize\x20repository\x20\x27','GitSyncJob','handleRecordSyncError','SyncDirection','../../salesforce/services/salesforce-sync.service','360272lHmuyj','Unable\x20to\x20synchronize\x20branch\x20\x27','test','config','3904439usNvUr','\x20Syncing\x20repository:\x20\x22','name','\x20Completed\x20prepare\x20to\x20syncing.','../../providers/web-hooks/hooks.utils','../../../../constants','constructor','../../../../core/errors/too-many-requests.error','BRANCH_NAME_REGEXP','SalesforceService','join','map','\x22\x20branch:\x20\x22','setStatus','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','isConvertToSfdx','../jobs/flosum-sync.job','getLoggerId','catch','hooks','../../../../core','sfLogger','\x27\x20[','\x20Start\x20sync\x20job.','\x27\x20in\x20repository\x20\x27','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','(((.+)+)+)+$','\x20Repository\x20\x22','\x20No\x20repositories\x20to\x20sync.',']\x20[','repoService','gitApiService','branchName','\x20Checking\x20valid\x20name.','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','__decorate','\x22\x20does\x27t\x20has\x20the\x20agent\x20webhook.\x20Agent\x20will\x20create\x20new\x20repository\x20webhook\x20to\x20enable\x20back\x20sync.','SyncService','HooksUtils','1586904VDqImf','get','\x20Stop\x20sync\x20job\x20for\x20\x27','salesforceService','4nZxcGA','direction','Not\x20Synchronized','SalesforceError','branchId'];a67_0x3093=function(){return _0x5f3b64;};return a67_0x3093();}a67_0x2808ec();'use strict';function a67_0x29ca(_0x16c0c1,_0x5cad26){const _0x2f51c4=a67_0x3093();return a67_0x29ca=function(_0x2808ec,_0x1d74bb){_0x2808ec=_0x2808ec-0x122;let _0x30936f=_0x2f51c4[_0x2808ec];return _0x30936f;},a67_0x29ca(_0x16c0c1,_0x5cad26);}var __decorate=this&&this[a67_0x5ec1c2(0x190)]||function(_0x4c58d5,_0xe2f015,_0xf8851b,_0x535e13){const _0x579c86=a67_0x5ec1c2;var _0x32dab9=arguments['length'],_0x2b647d=_0x32dab9<0x3?_0xe2f015:_0x535e13===null?_0x535e13=Object[_0x579c86(0x13c)](_0xe2f015,_0xf8851b):_0x535e13,_0x4c46f4;if(typeof Reflect==='object'&&typeof Reflect[_0x579c86(0x136)]==='function')_0x2b647d=Reflect[_0x579c86(0x136)](_0x4c58d5,_0xe2f015,_0xf8851b,_0x535e13);else{for(var _0x556fd0=_0x4c58d5[_0x579c86(0x142)]-0x1;_0x556fd0>=0x0;_0x556fd0--)if(_0x4c46f4=_0x4c58d5[_0x556fd0])_0x2b647d=(_0x32dab9<0x3?_0x4c46f4(_0x2b647d):_0x32dab9>0x3?_0x4c46f4(_0xe2f015,_0xf8851b,_0x2b647d):_0x4c46f4(_0xe2f015,_0xf8851b))||_0x2b647d;}return _0x32dab9>0x3&&_0x2b647d&&Object['defineProperty'](_0xe2f015,_0xf8851b,_0x2b647d),_0x2b647d;},__metadata=this&&this['__metadata']||function(_0x2af2c5,_0xd30285){const _0x336c9d=a67_0x5ec1c2;if(typeof Reflect==='object'&&typeof Reflect[_0x336c9d(0x13d)]==='function')return Reflect[_0x336c9d(0x13d)](_0x2af2c5,_0xd30285);},SyncService_1;Object['defineProperty'](exports,a67_0x5ec1c2(0x155),{'value':!![]}),exports[a67_0x5ec1c2(0x192)]=void 0x0;const constants_1=require(a67_0x5ec1c2(0x172)),core_1=require(a67_0x5ec1c2(0x181)),too_many_requests_error_1=require(a67_0x5ec1c2(0x174)),flosum_repository_sync_dto_1=require(a67_0x5ec1c2(0x125)),salesforce_error_1=require(a67_0x5ec1c2(0x146)),salesforce_sync_service_1=require(a67_0x5ec1c2(0x168)),salesforce_service_1=require(a67_0x5ec1c2(0x12b)),utils_1=require('../../../shared/utils'),typedi_1=require(a67_0x5ec1c2(0x15b)),hooks_utils_1=require(a67_0x5ec1c2(0x171)),git_branch_not_found_error_1=require('../errors/git-branch-not-found.error'),flosum_sync_job_1=require(a67_0x5ec1c2(0x17d)),git_sync_job_1=require(a67_0x5ec1c2(0x15d)),providers_tokens_1=require(a67_0x5ec1c2(0x14d)),bad_request_error_1=require(a67_0x5ec1c2(0x162));let SyncService=SyncService_1=class SyncService{constructor(_0x1ddbe8,_0x3996e8){const _0x4d247d=a67_0x5ec1c2;this[_0x4d247d(0x197)]=_0x1ddbe8,this[_0x4d247d(0x12a)]=_0x3996e8,this[_0x4d247d(0x144)]=new core_1[(_0x4d247d(0x160))](SyncService_1[_0x4d247d(0x16f)]),this[_0x4d247d(0x127)]={},this[_0x4d247d(0x137)]=[];}async['handleRecordSyncError'](_0x568393,_0x176678){const _0xdf3b72=a67_0x5ec1c2;if(_0x176678 instanceof git_branch_not_found_error_1['GitBranchNotFoundError']){await this[_0xdf3b72(0x12a)][_0xdf3b72(0x17a)](_0x568393,_0xdf3b72(0x19a));return;}if(_0x176678 instanceof too_many_requests_error_1[_0xdf3b72(0x158)]){await this[_0xdf3b72(0x12a)][_0xdf3b72(0x17a)](_0x568393,'Waiting');throw _0x176678;}try{await this['sfLogger']['error'](this[_0xdf3b72(0x130)]+_0xdf3b72(0x196)+_0x568393[_0xdf3b72(0x12f)]+_0xdf3b72(0x183)+_0x568393['branchName']+_0xdf3b72(0x138)+_0x176678+'.')[_0xdf3b72(0x123)](),await this[_0xdf3b72(0x12a)]['updateRemoteState'](_0x568393,{}),await this[_0xdf3b72(0x12a)][_0xdf3b72(0x17a)](_0x568393,_0xdf3b72(0x13a));}catch(_0x391736){if(_0x391736 instanceof salesforce_error_1[_0xdf3b72(0x19b)])throw _0x391736;}}async[a67_0x5ec1c2(0x159)](_0x519604){const _0x170edf=a67_0x5ec1c2;if(_0x519604['repositoryId']){const _0x7bec65=_0x519604[_0x170edf(0x12f)]['toLowerCase'](),_0x2e7ac6=this[_0x170edf(0x127)][_0x7bec65];if(!_0x2e7ac6)this['repositoriesIntersections'][_0x7bec65]=_0x519604[_0x170edf(0x12f)];else{if(_0x2e7ac6&&_0x2e7ac6!==_0x519604[_0x170edf(0x12f)])return await this[_0x170edf(0x166)](_0x519604,new Error(_0x170edf(0x164)+_0x519604[_0x170edf(0x12f)]+_0x170edf(0x14e)+_0x7bec65+'\x27\x20-\x20\x27'+_0x2e7ac6+'\x27')),!![];}}return![];}async[a67_0x5ec1c2(0x148)](_0x381a3a){const _0x30a692=a67_0x5ec1c2;if(!constants_1['REPOSITORY_NAME_REGEXP'][_0x30a692(0x16b)](_0x381a3a[_0x30a692(0x12f)]))return await this[_0x30a692(0x166)](_0x381a3a,new Error(_0x30a692(0x164)+_0x381a3a[_0x30a692(0x12f)]+_0x30a692(0x17b))),![];if(!constants_1[_0x30a692(0x175)][_0x30a692(0x16b)](_0x381a3a[_0x30a692(0x18d)]))return await this[_0x30a692(0x166)](_0x381a3a,new Error(_0x30a692(0x16a)+_0x381a3a['branchName']+_0x30a692(0x185)+_0x381a3a[_0x30a692(0x12f)]+_0x30a692(0x186))),![];return!![];}async[a67_0x5ec1c2(0x140)](_0x510e76,_0x554a26){const _0x1c8c44=a67_0x5ec1c2;let _0x254b09=this[_0x1c8c44(0x137)][_0x1c8c44(0x134)](_0x258db3=>_0x510e76[_0x1c8c44(0x12f)]===_0x258db3['name']);!_0x254b09&&(this['sfLogger'][_0x1c8c44(0x161)](this[_0x1c8c44(0x130)]+_0x1c8c44(0x188)+_0x510e76[_0x1c8c44(0x12f)]+'\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.'),_0x254b09=await this['repoService'][_0x1c8c44(0x150)]({'name':_0x510e76[_0x1c8c44(0x12f)],'autoInit':!![],'defaultBranch':_0x510e76['branchName'],'private':!![],'createHook':typedi_1[_0x1c8c44(0x153)]['get'](providers_tokens_1['Tokens'][_0x1c8c44(0x16c)])[_0x1c8c44(0x152)]}));if(this[_0x1c8c44(0x16c)][_0x1c8c44(0x152)]){const _0x42f924=await _0x254b09[_0x1c8c44(0x180)]['getAll']();!_0x42f924[_0x1c8c44(0x134)](_0x2a1550=>_0x2a1550[_0x1c8c44(0x15e)]===hooks_utils_1[_0x1c8c44(0x193)]['getHookLinkFor'](this[_0x1c8c44(0x16c)]['gitProvider'],this[_0x1c8c44(0x16c)]['applicationUrl'],_0x554a26))&&(this[_0x1c8c44(0x182)][_0x1c8c44(0x161)](this[_0x1c8c44(0x130)]+_0x1c8c44(0x188)+_0x510e76['repositoryName']+_0x1c8c44(0x191)),await _0x254b09['hooks'][_0x1c8c44(0x150)](hooks_utils_1[_0x1c8c44(0x193)][_0x1c8c44(0x15c)](this[_0x1c8c44(0x16c)][_0x1c8c44(0x124)],_0x254b09[_0x1c8c44(0x180)],this[_0x1c8c44(0x16c)][_0x1c8c44(0x145)],_0x554a26)));}return this[_0x1c8c44(0x137)][_0x1c8c44(0x12e)](_0x254b09),_0x254b09;}async[a67_0x5ec1c2(0x147)](){const _0x2e3a47=a67_0x5ec1c2;this[_0x2e3a47(0x18c)]=typedi_1[_0x2e3a47(0x153)][_0x2e3a47(0x195)](providers_tokens_1[_0x2e3a47(0x129)]['gitApiService']),this[_0x2e3a47(0x18b)]=typedi_1['Container']['get'](providers_tokens_1[_0x2e3a47(0x129)]['gitRepoService']),this['config']=typedi_1[_0x2e3a47(0x153)][_0x2e3a47(0x195)](providers_tokens_1[_0x2e3a47(0x129)][_0x2e3a47(0x16c)]),this['sfLogger']=typedi_1[_0x2e3a47(0x153)][_0x2e3a47(0x195)](providers_tokens_1[_0x2e3a47(0x129)]['logger']),this[_0x2e3a47(0x130)]='['+SyncService_1[_0x2e3a47(0x16f)]+_0x2e3a47(0x18a)+this[_0x2e3a47(0x16c)][_0x2e3a47(0x124)]['toUpperCase']()+']',this['salesforceService'][_0x2e3a47(0x19d)](this[_0x2e3a47(0x182)][_0x2e3a47(0x17e)]());try{this[_0x2e3a47(0x182)][_0x2e3a47(0x161)](this[_0x2e3a47(0x130)]+_0x2e3a47(0x184)),await this[_0x2e3a47(0x182)][_0x2e3a47(0x161)](this[_0x2e3a47(0x130)]+'\x20Getting\x20repository\x20records.')['send']();const _0xd684cf=await this[_0x2e3a47(0x12a)]['getRepositoryRecords'](typedi_1['Container'][_0x2e3a47(0x195)](providers_tokens_1[_0x2e3a47(0x129)][_0x2e3a47(0x12d)]));if(!_0xd684cf['length'])throw new bad_request_error_1['BadRequestError'](this[_0x2e3a47(0x130)]+_0x2e3a47(0x189));await this[_0x2e3a47(0x182)][_0x2e3a47(0x161)](this['prefix']+_0x2e3a47(0x12c))[_0x2e3a47(0x123)]();const _0x415294=await this['salesforceSync']['getBranchRecords'](_0xd684cf[_0x2e3a47(0x178)](_0x11e446=>'\x27'+_0x11e446[_0x2e3a47(0x14b)]+'\x27')[_0x2e3a47(0x177)](','));await this[_0x2e3a47(0x182)][_0x2e3a47(0x161)](this['prefix']+_0x2e3a47(0x163))[_0x2e3a47(0x123)](),this[_0x2e3a47(0x137)]=await this[_0x2e3a47(0x18b)][_0x2e3a47(0x151)]();const _0x2f38b0=[..._0xd684cf,..._0x415294];this[_0x2e3a47(0x182)]['log'](this[_0x2e3a47(0x130)]+_0x2e3a47(0x157)+_0x2f38b0['length']+_0x2e3a47(0x13f));for(const _0x436c5f of _0x2f38b0){this[_0x2e3a47(0x144)][_0x2e3a47(0x161)](_0x2e3a47(0x122)+_0x436c5f[_0x2e3a47(0x12f)]+'['+_0x436c5f['repositoryId']+_0x2e3a47(0x15f)+_0x436c5f[_0x2e3a47(0x18d)]+'['+_0x436c5f[_0x2e3a47(0x19c)]+']\x20branch.'),this[_0x2e3a47(0x182)][_0x2e3a47(0x161)](this[_0x2e3a47(0x130)]+_0x2e3a47(0x16e)+_0x436c5f[_0x2e3a47(0x12f)]+_0x2e3a47(0x179)+_0x436c5f[_0x2e3a47(0x18d)]+'\x22.'),this[_0x2e3a47(0x182)]['log'](this[_0x2e3a47(0x130)]+_0x2e3a47(0x18e));const _0x2dbac8=await this['checkValidNaming'](_0x436c5f);if(!_0x2dbac8)continue;this['sfLogger'][_0x2e3a47(0x161)](this[_0x2e3a47(0x130)]+'\x20Checking\x20intersects.');const _0x507a9c=await this[_0x2e3a47(0x159)](_0x436c5f);if(_0x507a9c)continue;await this[_0x2e3a47(0x182)][_0x2e3a47(0x123)]();let _0x22511b;try{await this['sfLogger']['log'](this[_0x2e3a47(0x130)]+_0x2e3a47(0x135))['send'](),_0x22511b=await this[_0x2e3a47(0x140)](_0x436c5f,typedi_1['Container']['get'](providers_tokens_1['Tokens']['connectionId']));}catch(_0x2fd1ca){await this[_0x2e3a47(0x166)](_0x436c5f,_0x2fd1ca instanceof too_many_requests_error_1['TooManyRequests']?_0x2fd1ca:new Error(_0x2e3a47(0x18f)+_0x2fd1ca));continue;}await this[_0x2e3a47(0x182)][_0x2e3a47(0x161)](this[_0x2e3a47(0x130)]+_0x2e3a47(0x170))[_0x2e3a47(0x123)]();if(_0x436c5f[_0x2e3a47(0x199)]===flosum_repository_sync_dto_1[_0x2e3a47(0x167)]['FlosumToGit']){const _0x5124a9=typedi_1[_0x2e3a47(0x153)][_0x2e3a47(0x195)](flosum_sync_job_1[_0x2e3a47(0x131)]);await _0x5124a9['run']({'repository':_0x22511b,'convertToSFDX':this['config'][_0x2e3a47(0x17c)],'syncRecord':_0x436c5f,'provider':this[_0x2e3a47(0x16c)][_0x2e3a47(0x124)]})[_0x2e3a47(0x17f)](_0x594fed=>this[_0x2e3a47(0x166)](_0x436c5f,_0x594fed));}else{const _0xcdcc3d=typedi_1[_0x2e3a47(0x153)][_0x2e3a47(0x195)](git_sync_job_1[_0x2e3a47(0x165)]);await _0xcdcc3d[_0x2e3a47(0x147)]({'repository':_0x22511b,'branch':_0x436c5f[_0x2e3a47(0x18d)],'provider':this[_0x2e3a47(0x16c)]['gitProvider'],'repositoryGit':_0x22511b[_0x2e3a47(0x14a)],'syncRecord':_0x436c5f})[_0x2e3a47(0x17f)](_0x4fc696=>this[_0x2e3a47(0x166)](_0x436c5f,_0x4fc696));}}}catch(_0x230431){this['logger'][_0x2e3a47(0x14c)](_0x230431);_0x230431 instanceof too_many_requests_error_1[_0x2e3a47(0x158)]?(await this[_0x2e3a47(0x182)][_0x2e3a47(0x161)](this[_0x2e3a47(0x130)]+_0x2e3a47(0x149))['send'](),await utils_1[_0x2e3a47(0x126)](0x3c*0x3c*0x3e8),this[_0x2e3a47(0x147)]()):await this[_0x2e3a47(0x182)][_0x2e3a47(0x14c)](this[_0x2e3a47(0x130)]+_0x2e3a47(0x143)+_0x230431)[_0x2e3a47(0x123)]();return;}await this['sfLogger'][_0x2e3a47(0x161)](this[_0x2e3a47(0x130)]+_0x2e3a47(0x133))[_0x2e3a47(0x123)](),await this[_0x2e3a47(0x12a)]['disableSync'](typedi_1['Container'][_0x2e3a47(0x195)](providers_tokens_1[_0x2e3a47(0x129)]['connectionId']))[_0x2e3a47(0x17f)](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a67_0x5ec1c2(0x176)],salesforce_sync_service_1[a67_0x5ec1c2(0x156)]])],SyncService),exports['SyncService']=SyncService;