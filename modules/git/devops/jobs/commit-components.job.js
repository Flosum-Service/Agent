const a60_0x34d202=a60_0x447f;(function(_0x363b45,_0x13913e){const _0x3e9c22=a60_0x447f,_0x6897fc=_0x363b45();while(!![]){try{const _0x803688=parseInt(_0x3e9c22(0x169))/0x1+parseInt(_0x3e9c22(0x126))/0x2*(-parseInt(_0x3e9c22(0x16a))/0x3)+-parseInt(_0x3e9c22(0x172))/0x4*(parseInt(_0x3e9c22(0x154))/0x5)+-parseInt(_0x3e9c22(0x141))/0x6*(-parseInt(_0x3e9c22(0x11d))/0x7)+-parseInt(_0x3e9c22(0x14f))/0x8*(parseInt(_0x3e9c22(0x122))/0x9)+parseInt(_0x3e9c22(0x149))/0xa+-parseInt(_0x3e9c22(0x145))/0xb*(-parseInt(_0x3e9c22(0x11a))/0xc);if(_0x803688===_0x13913e)break;else _0x6897fc['push'](_0x6897fc['shift']());}catch(_0x3c0e9a){_0x6897fc['push'](_0x6897fc['shift']());}}}(a60_0x53d6,0x8a9bc));const a60_0x4ce9fd=(function(){let _0x4d5a83=!![];return function(_0x268ab0,_0x3251c6){const _0x2beff1=_0x4d5a83?function(){if(_0x3251c6){const _0x7ee7c5=_0x3251c6['apply'](_0x268ab0,arguments);return _0x3251c6=null,_0x7ee7c5;}}:function(){};return _0x4d5a83=![],_0x2beff1;};}()),a60_0x2aa46d=a60_0x4ce9fd(this,function(){const _0x3142a9=a60_0x447f;return a60_0x2aa46d[_0x3142a9(0x170)]()['search'](_0x3142a9(0x166))['toString']()['constructor'](a60_0x2aa46d)[_0x3142a9(0x11b)](_0x3142a9(0x166));});a60_0x2aa46d();'use strict';var __createBinding=this&&this[a60_0x34d202(0x15d)]||(Object[a60_0x34d202(0x118)]?function(_0x407e21,_0x38d143,_0x19c50a,_0x454d94){const _0x1cdf5b=a60_0x34d202;if(_0x454d94===undefined)_0x454d94=_0x19c50a;Object[_0x1cdf5b(0x130)](_0x407e21,_0x454d94,{'enumerable':!![],'get':function(){return _0x38d143[_0x19c50a];}});}:function(_0x2cebe7,_0x3aee88,_0x3ed6a6,_0x6bb774){if(_0x6bb774===undefined)_0x6bb774=_0x3ed6a6;_0x2cebe7[_0x6bb774]=_0x3aee88[_0x3ed6a6];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a60_0x34d202(0x118)]?function(_0x2de88b,_0x1d9c22){Object['defineProperty'](_0x2de88b,'default',{'enumerable':!![],'value':_0x1d9c22});}:function(_0x15d0cf,_0xe4e43e){const _0x4a969b=a60_0x34d202;_0x15d0cf[_0x4a969b(0x12e)]=_0xe4e43e;}),__decorate=this&&this[a60_0x34d202(0x168)]||function(_0x2c3153,_0x33b4f7,_0x2126e9,_0x4e14fa){const _0xe8216f=a60_0x34d202;var _0x5a9503=arguments['length'],_0x49e9cd=_0x5a9503<0x3?_0x33b4f7:_0x4e14fa===null?_0x4e14fa=Object[_0xe8216f(0x167)](_0x33b4f7,_0x2126e9):_0x4e14fa,_0x5f16ad;if(typeof Reflect===_0xe8216f(0x150)&&typeof Reflect[_0xe8216f(0x159)]===_0xe8216f(0x174))_0x49e9cd=Reflect['decorate'](_0x2c3153,_0x33b4f7,_0x2126e9,_0x4e14fa);else{for(var _0x35880c=_0x2c3153['length']-0x1;_0x35880c>=0x0;_0x35880c--)if(_0x5f16ad=_0x2c3153[_0x35880c])_0x49e9cd=(_0x5a9503<0x3?_0x5f16ad(_0x49e9cd):_0x5a9503>0x3?_0x5f16ad(_0x33b4f7,_0x2126e9,_0x49e9cd):_0x5f16ad(_0x33b4f7,_0x2126e9))||_0x49e9cd;}return _0x5a9503>0x3&&_0x49e9cd&&Object[_0xe8216f(0x130)](_0x33b4f7,_0x2126e9,_0x49e9cd),_0x49e9cd;},__importStar=this&&this['__importStar']||function(_0x6a31e7){const _0x48421f=a60_0x34d202;if(_0x6a31e7&&_0x6a31e7['__esModule'])return _0x6a31e7;var _0x3c5a82={};if(_0x6a31e7!=null){for(var _0x1c884e in _0x6a31e7)if(_0x1c884e!==_0x48421f(0x12e)&&Object[_0x48421f(0x10d)]['hasOwnProperty'][_0x48421f(0x11f)](_0x6a31e7,_0x1c884e))__createBinding(_0x3c5a82,_0x6a31e7,_0x1c884e);}return __setModuleDefault(_0x3c5a82,_0x6a31e7),_0x3c5a82;},__importDefault=this&&this['__importDefault']||function(_0x36f54b){const _0x57986c=a60_0x34d202;return _0x36f54b&&_0x36f54b[_0x57986c(0x10c)]?_0x36f54b:{'default':_0x36f54b};};Object[a60_0x34d202(0x130)](exports,a60_0x34d202(0x10c),{'value':!![]}),exports['CommitComponentsJob']=void 0x0;const commit_components_dto_1=require(a60_0x34d202(0x143)),events_1=__importDefault(require('events')),git_utils_1=require(a60_0x34d202(0x156)),mdapi_utils_1=require('../utils/mdapi.utils'),sfdx_utils_1=require(a60_0x34d202(0x11c)),typedi_1=__importStar(require(a60_0x34d202(0x121))),child_types_1=__importDefault(require(a60_0x34d202(0x129))),utils_1=require(a60_0x34d202(0x140)),constants_1=require(a60_0x34d202(0x124)),git_provider_1=require(a60_0x34d202(0x162)),bitbucket_api_service_1=require('../../providers/api/bitbucket-api.service'),sfdx_utils_2=require('../../salesforce/utils/sfdx.utils'),fs_internal_1=require('../../internal/fs.internal'),path_1=require(a60_0x34d202(0x16b)),providers_tokens_1=require(a60_0x34d202(0x15e));function a60_0x53d6(){const _0x122cb6=['../../../shared/utils','74442ePwFdO','writed','../dto/commit-components.dto','copyMdapiTo','3751qLomTB','createProjectFrom','\x20Start\x20cloning\x20repository.','\x20Checking\x20written\x20components.','2542290yCsNRa','deleted','\x20components','name','DEFAULT_GIT_USER_EMAIL','values','64ffMHXZ','object','Bitbucket','removeComponents','splice','13465BxKaRn','error','../utils/git.utils','includes','replace','decorate','gitUtils','reduce','prepareMdapi','__createBinding','../../providers/providers.tokens','get','force-app','sfLogger','../../providers/types/git-provider','components','commitAndPush','componentsToDelete','(((.+)+)+)+$','getOwnPropertyDescriptor','__decorate','465673XlyzGr','32397GVhXCh','path','getRemote','\x20Preparing\x20to\x20delete\x20components','writeComponents','prefix','toString','fileName','292VaDJER','removeDir','function','sfdxUtils','gitUrl','copyProjectTo','__esModule','prototype','BitbucketApiService','length','MDApiUtils','join','getProtocol','catch','SFDXUtils','startTime','isLoggedIn','COMPONENTS_PER_TICK','create','now','2628ROTNdz','search','../utils/sfdx.utils','154HQLoyE','branch','call','\x20Nothing\x20to\x20commit.\x20Skip.','typedi','25236cZuxeu','send','../../../../constants','\x20Commit\x20job\x20done.\x20Time\x20spent\x20-\x20','52XUeWJs','isEmptyDir','writeFlosumComponents','../../parsers/data/child-types','provider','GitUtils','ms.\x20Committed\x20components\x20-\x20','CommitComponentsDto','default','CommitComponentsJob','defineProperty','sort','\x20Wrote\x20','Tokens','\x20Checking\x20commit\x20components.','cleanUp','mdapiUtils','commitData','groupComponentsByFileName','Service','exec','dir','\x20Copying\x20mdapi\x20to\x20git\x20folder.','componentsToWrite','\x20Checking\x20deleted\x20components.','log'];a60_0x53d6=function(){return _0x122cb6;};return a60_0x53d6();}let CommitComponentsJob=class CommitComponentsJob extends events_1[a60_0x34d202(0x12e)]{constructor(){const _0x141206=a60_0x34d202;super(...arguments),this[_0x141206(0x117)]=0x3e8,this[_0x141206(0x13d)]=0x0,this[_0x141206(0x165)]=0x0,this[_0x141206(0x115)]=Date[_0x141206(0x119)]();}async[a60_0x34d202(0x16c)](){const _0x2d0a6d=a60_0x34d202,{repo:_0x30eba7}=this[_0x2d0a6d(0x137)],_0x372f02=typedi_1[_0x2d0a6d(0x12e)]['get'](providers_tokens_1[_0x2d0a6d(0x133)]['credentials']);if(this[_0x2d0a6d(0x137)][_0x2d0a6d(0x12a)]===git_provider_1['GitProvider'][_0x2d0a6d(0x151)]){const _0x2bfdbf=typedi_1[_0x2d0a6d(0x12e)]['get'](bitbucket_api_service_1[_0x2d0a6d(0x10e)]);await _0x2bfdbf[_0x2d0a6d(0x116)]();}return _0x30eba7[_0x2d0a6d(0x176)][_0x2d0a6d(0x158)](/http(s)?:\/\/(.+@)?/,utils_1[_0x2d0a6d(0x112)](_0x30eba7[_0x2d0a6d(0x176)])+'://'+_0x372f02['getGitShellAuthorizationString']()+'@');}[a60_0x34d202(0x138)](_0x11b168){const _0x3eab0d=a60_0x34d202;var _0x3cc5b;_0x11b168[_0x3eab0d(0x131)](_0x23cf62=>child_types_1[_0x3eab0d(0x12e)][_0x3eab0d(0x157)](_0x23cf62['fileType'])?0x1:-0x1);const _0x218312={};for(const _0xba7cd1 of _0x11b168){_0x218312[_0x3cc5b=_0xba7cd1[_0x3eab0d(0x171)]]||(_0x218312[_0x3cc5b]=[]),_0x218312[_0xba7cd1[_0x3eab0d(0x171)]]['push'](_0xba7cd1);}return Object[_0x3eab0d(0x14e)](_0x218312)[_0x3eab0d(0x15b)]((_0x55d4bd,_0x15078d)=>[..._0x55d4bd,..._0x15078d],[]);}async[a60_0x34d202(0x16e)](_0x332436){const _0x1f7ec2=a60_0x34d202;_0x332436=this['groupComponentsByFileName'](_0x332436);let _0x3174a5=0x0;while(_0x332436[_0x1f7ec2(0x10f)]){const _0x1fd89b=_0x332436[_0x1f7ec2(0x153)](0x0,this['COMPONENTS_PER_TICK']);await this[_0x1f7ec2(0x136)][_0x1f7ec2(0x128)](_0x1fd89b,{'skipChildErrors':this['commitData'][_0x1f7ec2(0x11e)][_0x1f7ec2(0x14c)]==='master'}),_0x3174a5+=_0x1fd89b['length'],this[_0x1f7ec2(0x161)][_0x1f7ec2(0x13f)](this[_0x1f7ec2(0x16f)]+_0x1f7ec2(0x132)+_0x3174a5+'/'+this['componentsToWrite']+_0x1f7ec2(0x14b)),await this[_0x1f7ec2(0x161)]['send']();}}async[a60_0x34d202(0x152)](_0x156779){const _0x54d51d=a60_0x34d202;_0x156779[_0x54d51d(0x131)](_0x386f79=>child_types_1['default'][_0x54d51d(0x157)](_0x386f79['type'])?-0x1:0x1);let _0x4cbe94=0x0;while(_0x156779[_0x54d51d(0x10f)]){const _0x169ce4=_0x156779[_0x54d51d(0x153)](0x0,this[_0x54d51d(0x117)]);await this[_0x54d51d(0x136)]['removeComponents'](_0x169ce4),_0x4cbe94+=_0x169ce4[_0x54d51d(0x10f)],this[_0x54d51d(0x161)][_0x54d51d(0x13f)](this[_0x54d51d(0x16f)]+'\x20Deleted\x20'+_0x4cbe94+'/'+this[_0x54d51d(0x165)]+'\x20components'),await this[_0x54d51d(0x161)][_0x54d51d(0x123)]();}}async[a60_0x34d202(0x135)](){const _0x547cc9=a60_0x34d202;this[_0x547cc9(0x15a)]&&await this['gitUtils']['removeDir']()[_0x547cc9(0x113)](()=>void 0x0),this[_0x547cc9(0x136)]&&await this[_0x547cc9(0x136)][_0x547cc9(0x173)]()[_0x547cc9(0x113)](()=>void 0x0),this['sfdxUtils']&&await this['sfdxUtils'][_0x547cc9(0x173)]()[_0x547cc9(0x113)](()=>void 0x0);}async['exec'](){const _0x45c0df=a60_0x34d202,{repo:_0x56e003,branch:_0x135253,components:_0x16fbce,convertToSFDX:_0x22563a,message:_0x35facb,user:_0x1d634a}=this[_0x45c0df(0x137)];this[_0x45c0df(0x136)]=new mdapi_utils_1[(_0x45c0df(0x110))](),this[_0x45c0df(0x15a)]=new git_utils_1[(_0x45c0df(0x12b))](await this[_0x45c0df(0x16c)]()),this[_0x45c0df(0x175)]=new sfdx_utils_1[(_0x45c0df(0x114))]();let _0x16420b=_0x22563a;try{await this['sfLogger'][_0x45c0df(0x13f)](this[_0x45c0df(0x16f)]+_0x45c0df(0x147))['send'](),await this['gitUtils']['clone'](_0x135253[_0x45c0df(0x14c)],_0x56e003[_0x45c0df(0x14c)]);!this[_0x45c0df(0x137)]['force']?(this[_0x45c0df(0x161)]['log'](this[_0x45c0df(0x16f)]+'\x20Prepare\x20mdapi\x20files.'),await this[_0x45c0df(0x136)][_0x45c0df(0x15c)](this[_0x45c0df(0x15a)][_0x45c0df(0x13b)])):this[_0x45c0df(0x161)][_0x45c0df(0x13f)](this[_0x45c0df(0x16f)]+'\x20Force\x20sync.\x20Skip\x20preparing\x20mdapi\x20from\x20repository.');await this['sfLogger'][_0x45c0df(0x13f)](this['prefix']+_0x45c0df(0x148))['send']();_0x16fbce[_0x45c0df(0x142)]&&(this['sfLogger'][_0x45c0df(0x13f)](this[_0x45c0df(0x16f)]+'\x20Preparing\x20to\x20write\x20components'),this[_0x45c0df(0x13d)]=_0x16fbce[_0x45c0df(0x142)][_0x45c0df(0x10f)],await this[_0x45c0df(0x16e)](_0x16fbce[_0x45c0df(0x142)]),await this[_0x45c0df(0x161)][_0x45c0df(0x123)]());await this[_0x45c0df(0x161)]['log'](this[_0x45c0df(0x16f)]+_0x45c0df(0x13e))[_0x45c0df(0x123)]();_0x16fbce['deleted']&&(this[_0x45c0df(0x161)][_0x45c0df(0x13f)](this[_0x45c0df(0x16f)]+_0x45c0df(0x16d)),this[_0x45c0df(0x165)]=_0x16fbce['deleted'][_0x45c0df(0x10f)],await this[_0x45c0df(0x152)](_0x16fbce['deleted']),await this[_0x45c0df(0x161)]['send']());await this['sfLogger'][_0x45c0df(0x123)]();const _0x31e1ac=await fs_internal_1['FS'][_0x45c0df(0x127)](this[_0x45c0df(0x15a)][_0x45c0df(0x13b)]);await sfdx_utils_2['SFDX']['isSFDXProject'](this[_0x45c0df(0x15a)][_0x45c0df(0x13b)])?(_0x16420b=!![],await fs_internal_1['FS'][_0x45c0df(0x173)](path_1[_0x45c0df(0x111)](this[_0x45c0df(0x15a)][_0x45c0df(0x13b)],_0x45c0df(0x160)))):(_0x16420b&&(!_0x31e1ac&&(_0x16420b=![])),await this['gitUtils']['clearDir']());_0x16420b?(await this[_0x45c0df(0x161)][_0x45c0df(0x13f)](this[_0x45c0df(0x16f)]+'\x20Start\x20converting\x20to\x20SFDX.')[_0x45c0df(0x123)](),await this[_0x45c0df(0x175)][_0x45c0df(0x146)](this[_0x45c0df(0x136)][_0x45c0df(0x13b)]),await this[_0x45c0df(0x175)][_0x45c0df(0x177)](this['gitUtils']['dir'],!_0x31e1ac),await this[_0x45c0df(0x175)][_0x45c0df(0x173)]()):(await this[_0x45c0df(0x161)][_0x45c0df(0x13f)](this[_0x45c0df(0x16f)]+_0x45c0df(0x13c))['send'](),await this[_0x45c0df(0x136)][_0x45c0df(0x144)](this[_0x45c0df(0x15a)]['dir']));await this[_0x45c0df(0x161)]['log'](this['prefix']+'\x20Committing\x20and\x20pushing\x20source\x20to\x20git.')[_0x45c0df(0x123)](),await this[_0x45c0df(0x15a)][_0x45c0df(0x164)](_0x35facb,{'email':constants_1[_0x45c0df(0x14d)],'name':_0x1d634a[_0x45c0df(0x14c)]},_0x135253[_0x45c0df(0x14c)]),await this['gitUtils'][_0x45c0df(0x173)](),await this['mdapiUtils'][_0x45c0df(0x173)]();const _0x3d13cf=this[_0x45c0df(0x13d)]+this[_0x45c0df(0x165)];await this[_0x45c0df(0x161)][_0x45c0df(0x13f)](this[_0x45c0df(0x16f)]+_0x45c0df(0x125)+(Date['now']()-this[_0x45c0df(0x115)])+_0x45c0df(0x12c)+_0x3d13cf+'.')[_0x45c0df(0x123)]();}catch(_0x2e568c){await this['cleanUp'](),await this[_0x45c0df(0x161)][_0x45c0df(0x155)](this[_0x45c0df(0x16f)]+'\x20'+_0x2e568c)[_0x45c0df(0x123)]();throw _0x2e568c;}}async['run'](_0x4a9ebb,_0x149b63){const _0x336f5d=a60_0x34d202;var _0x3643d5,_0x2ac254;this[_0x336f5d(0x161)]=typedi_1['default'][_0x336f5d(0x15f)](providers_tokens_1['Tokens']['logger']),this[_0x336f5d(0x16f)]=(_0x149b63?_0x149b63+'\x20':'')+'['+commit_components_dto_1[_0x336f5d(0x12d)][_0x336f5d(0x14c)]+']',await this[_0x336f5d(0x161)]['log'](this[_0x336f5d(0x16f)]+_0x336f5d(0x134));const _0x2484ad=!!((_0x3643d5=_0x4a9ebb[_0x336f5d(0x163)])===null||_0x3643d5===void 0x0?void 0x0:_0x3643d5[_0x336f5d(0x142)])||!!((_0x2ac254=_0x4a9ebb[_0x336f5d(0x163)])===null||_0x2ac254===void 0x0?void 0x0:_0x2ac254[_0x336f5d(0x14a)]);if(!_0x2484ad){await this['sfLogger'][_0x336f5d(0x13f)](this[_0x336f5d(0x16f)]+_0x336f5d(0x120))['send']();return;}this[_0x336f5d(0x137)]=_0x4a9ebb,await this[_0x336f5d(0x13a)]();}};function a60_0x447f(_0x141436,_0x1cd5a8){const _0xee17a=a60_0x53d6();return a60_0x447f=function(_0x2aa46d,_0x4ce9fd){_0x2aa46d=_0x2aa46d-0x10c;let _0x53d61f=_0xee17a[_0x2aa46d];return _0x53d61f;},a60_0x447f(_0x141436,_0x1cd5a8);}CommitComponentsJob=__decorate([typedi_1[a60_0x34d202(0x139)]({'transient':!![]})],CommitComponentsJob),exports[a60_0x34d202(0x12f)]=CommitComponentsJob;