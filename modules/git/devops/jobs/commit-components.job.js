const a60_0x522a75=a60_0x4def;(function(_0x539205,_0x343a8a){const _0x5d0b16=a60_0x4def,_0x52adb3=_0x539205();while(!![]){try{const _0x466df6=-parseInt(_0x5d0b16(0x15d))/0x1+parseInt(_0x5d0b16(0x15e))/0x2+parseInt(_0x5d0b16(0x10b))/0x3*(parseInt(_0x5d0b16(0x174))/0x4)+parseInt(_0x5d0b16(0x137))/0x5*(parseInt(_0x5d0b16(0x121))/0x6)+parseInt(_0x5d0b16(0x151))/0x7+-parseInt(_0x5d0b16(0x12f))/0x8*(-parseInt(_0x5d0b16(0x111))/0x9)+-parseInt(_0x5d0b16(0x10a))/0xa*(parseInt(_0x5d0b16(0x167))/0xb);if(_0x466df6===_0x343a8a)break;else _0x52adb3['push'](_0x52adb3['shift']());}catch(_0x49b1d0){_0x52adb3['push'](_0x52adb3['shift']());}}}(a60_0x1d61,0xd7b8c));const a60_0x3485c7=(function(){let _0x4cf315=!![];return function(_0x4bfc73,_0xe34e28){const _0x273921=_0x4cf315?function(){const _0x52871c=a60_0x4def;if(_0xe34e28){const _0x4c68da=_0xe34e28[_0x52871c(0x141)](_0x4bfc73,arguments);return _0xe34e28=null,_0x4c68da;}}:function(){};return _0x4cf315=![],_0x273921;};}()),a60_0x1c2ba0=a60_0x3485c7(this,function(){const _0x51f28e=a60_0x4def;return a60_0x1c2ba0['toString']()[_0x51f28e(0x113)](_0x51f28e(0x12e))[_0x51f28e(0x117)]()[_0x51f28e(0x11f)](a60_0x1c2ba0)[_0x51f28e(0x113)](_0x51f28e(0x12e));});a60_0x1c2ba0();'use strict';var __createBinding=this&&this[a60_0x522a75(0x11b)]||(Object[a60_0x522a75(0x154)]?function(_0x445813,_0x187503,_0x552f66,_0x2fef7b){const _0x4717c8=a60_0x522a75;if(_0x2fef7b===undefined)_0x2fef7b=_0x552f66;Object[_0x4717c8(0x13e)](_0x445813,_0x2fef7b,{'enumerable':!![],'get':function(){return _0x187503[_0x552f66];}});}:function(_0x588aba,_0x5bed3f,_0x3789fa,_0x3a5ae7){if(_0x3a5ae7===undefined)_0x3a5ae7=_0x3789fa;_0x588aba[_0x3a5ae7]=_0x5bed3f[_0x3789fa];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a60_0x522a75(0x154)]?function(_0x4b8afb,_0x5c62e3){const _0x4e7916=a60_0x522a75;Object['defineProperty'](_0x4b8afb,_0x4e7916(0x145),{'enumerable':!![],'value':_0x5c62e3});}:function(_0x125b37,_0x4212a9){_0x125b37['default']=_0x4212a9;}),__decorate=this&&this[a60_0x522a75(0x128)]||function(_0x245e32,_0x1fba8c,_0x2fc9a8,_0x6c2dd2){const _0x4102fd=a60_0x522a75;var _0x598526=arguments[_0x4102fd(0x14a)],_0x264b72=_0x598526<0x3?_0x1fba8c:_0x6c2dd2===null?_0x6c2dd2=Object['getOwnPropertyDescriptor'](_0x1fba8c,_0x2fc9a8):_0x6c2dd2,_0x4dc515;if(typeof Reflect===_0x4102fd(0x124)&&typeof Reflect[_0x4102fd(0x105)]===_0x4102fd(0x13c))_0x264b72=Reflect[_0x4102fd(0x105)](_0x245e32,_0x1fba8c,_0x2fc9a8,_0x6c2dd2);else{for(var _0xcb34a1=_0x245e32[_0x4102fd(0x14a)]-0x1;_0xcb34a1>=0x0;_0xcb34a1--)if(_0x4dc515=_0x245e32[_0xcb34a1])_0x264b72=(_0x598526<0x3?_0x4dc515(_0x264b72):_0x598526>0x3?_0x4dc515(_0x1fba8c,_0x2fc9a8,_0x264b72):_0x4dc515(_0x1fba8c,_0x2fc9a8))||_0x264b72;}return _0x598526>0x3&&_0x264b72&&Object['defineProperty'](_0x1fba8c,_0x2fc9a8,_0x264b72),_0x264b72;},__importStar=this&&this[a60_0x522a75(0x126)]||function(_0x4532cf){const _0x136d30=a60_0x522a75;if(_0x4532cf&&_0x4532cf[_0x136d30(0x13b)])return _0x4532cf;var _0x230704={};if(_0x4532cf!=null){for(var _0xcf4553 in _0x4532cf)if(_0xcf4553!==_0x136d30(0x145)&&Object[_0x136d30(0x106)]['hasOwnProperty'][_0x136d30(0x170)](_0x4532cf,_0xcf4553))__createBinding(_0x230704,_0x4532cf,_0xcf4553);}return __setModuleDefault(_0x230704,_0x4532cf),_0x230704;},__importDefault=this&&this['__importDefault']||function(_0x9ae470){return _0x9ae470&&_0x9ae470['__esModule']?_0x9ae470:{'default':_0x9ae470};};function a60_0x4def(_0x1f1e9f,_0x269a95){const _0x7599b9=a60_0x1d61();return a60_0x4def=function(_0x1c2ba0,_0x3485c7){_0x1c2ba0=_0x1c2ba0-0x102;let _0x1d6112=_0x7599b9[_0x1c2ba0];return _0x1d6112;},a60_0x4def(_0x1f1e9f,_0x269a95);}function a60_0x1d61(){const _0x283406=['force','\x20Prepare\x20mdapi\x20files.','../../providers/types/git-provider','catch','9999YeNpJt','../../parsers/data/child-types','search','componentsToWrite','sfLogger','createProjectFrom','toString','groupComponentsByFileName','prefix','clone','__createBinding','COMPONENTS_PER_TICK','isEmptyDir','\x20Copying\x20mdapi\x20to\x20git\x20folder.','constructor','\x20Preparing\x20to\x20write\x20components','216102tGKQTX','removeDir','componentsToDelete','object','\x20Start\x20cloning\x20repository.','__importStar','credentials','__decorate','join','\x20Checking\x20commit\x20components.','writeComponents','commitData','startTime','(((.+)+)+)+$','6568WXqROf','splice','writed','../../providers/providers.tokens','\x20Preparing\x20to\x20delete\x20components','\x20Commit\x20job\x20done.\x20Time\x20spent\x20-\x20','\x20Deleted\x20','exec','245NMnRyu','DEFAULT_GIT_USER_EMAIL','CommitComponentsDto','isLoggedIn','__esModule','function','error','defineProperty','\x20Force\x20sync.\x20Skip\x20preparing\x20mdapi\x20from\x20repository.','cleanUp','apply','type','CommitComponentsJob','typedi','default','reduce','getRemote','values','dir','length','Bitbucket','deleted','copyMdapiTo','path','../utils/sfdx.utils','send','10254986QsXPQJ','gitUrl','sfdxUtils','create','sort','gitUtils','../../providers/api/bitbucket-api.service','\x20Start\x20converting\x20to\x20SFDX.','../../../shared/utils','fileName','\x20Nothing\x20to\x20commit.\x20Skip.','\x20Wrote\x20','500345BdlEht','2754490EOeLGD','master','branch','BitbucketApiService','\x20components','SFDXUtils','mdapiUtils','name','removeComponents','301367HshdCg','log','\x20Checking\x20written\x20components.','provider','Service','now','MDApiUtils','../utils/mdapi.utils','Tokens','call','SFDX','getGitShellAuthorizationString','prepareMdapi','28cKowgj','../../../../constants','commitAndPush','logger','get','decorate','prototype','writeFlosumComponents','components','../../internal/fs.internal','1870qtSwPr','423417ZeQcem','../utils/git.utils'];a60_0x1d61=function(){return _0x283406;};return a60_0x1d61();}Object[a60_0x522a75(0x13e)](exports,'__esModule',{'value':!![]}),exports['CommitComponentsJob']=void 0x0;const commit_components_dto_1=require('../dto/commit-components.dto'),events_1=__importDefault(require('events')),git_utils_1=require(a60_0x522a75(0x10c)),mdapi_utils_1=require(a60_0x522a75(0x16e)),sfdx_utils_1=require(a60_0x522a75(0x14f)),typedi_1=__importStar(require(a60_0x522a75(0x144))),child_types_1=__importDefault(require(a60_0x522a75(0x112))),utils_1=require(a60_0x522a75(0x159)),constants_1=require(a60_0x522a75(0x175)),git_provider_1=require(a60_0x522a75(0x10f)),bitbucket_api_service_1=require(a60_0x522a75(0x157)),sfdx_utils_2=require('../../salesforce/utils/sfdx.utils'),fs_internal_1=require(a60_0x522a75(0x109)),path_1=require(a60_0x522a75(0x14e)),providers_tokens_1=require(a60_0x522a75(0x132));let CommitComponentsJob=class CommitComponentsJob extends events_1[a60_0x522a75(0x145)]{constructor(){const _0x18f50c=a60_0x522a75;super(...arguments),this[_0x18f50c(0x11c)]=0x3e8,this[_0x18f50c(0x114)]=0x0,this[_0x18f50c(0x123)]=0x0,this[_0x18f50c(0x12d)]=Date[_0x18f50c(0x16c)]();}async['getRemote'](){const _0x23d696=a60_0x522a75,{repo:_0x10e108}=this[_0x23d696(0x12c)],_0x496742=typedi_1[_0x23d696(0x145)][_0x23d696(0x104)](providers_tokens_1['Tokens'][_0x23d696(0x127)]);if(this[_0x23d696(0x12c)][_0x23d696(0x16a)]===git_provider_1['GitProvider'][_0x23d696(0x14b)]){const _0x211c45=typedi_1[_0x23d696(0x145)][_0x23d696(0x104)](bitbucket_api_service_1[_0x23d696(0x161)]);await _0x211c45[_0x23d696(0x13a)]();}return _0x10e108[_0x23d696(0x152)]['replace'](/http(s)?:\/\/(.+@)?/,utils_1['getProtocol'](_0x10e108[_0x23d696(0x152)])+'://'+_0x496742[_0x23d696(0x172)]()+'@');}[a60_0x522a75(0x118)](_0x38d728){const _0x521526=a60_0x522a75;var _0x431013;_0x38d728['sort'](_0x413823=>child_types_1[_0x521526(0x145)]['includes'](_0x413823['fileType'])?0x1:-0x1);const _0x11d2ee={};for(const _0x456def of _0x38d728){_0x11d2ee[_0x431013=_0x456def['fileName']]||(_0x11d2ee[_0x431013]=[]),_0x11d2ee[_0x456def[_0x521526(0x15a)]]['push'](_0x456def);}return Object[_0x521526(0x148)](_0x11d2ee)[_0x521526(0x146)]((_0x3e3c92,_0x5392c3)=>[..._0x3e3c92,..._0x5392c3],[]);}async[a60_0x522a75(0x12b)](_0x4dbebf){const _0x4dc445=a60_0x522a75;_0x4dbebf=this[_0x4dc445(0x118)](_0x4dbebf);let _0x51884c=0x0;while(_0x4dbebf[_0x4dc445(0x14a)]){const _0x19efc7=_0x4dbebf[_0x4dc445(0x130)](0x0,this[_0x4dc445(0x11c)]);await this['mdapiUtils'][_0x4dc445(0x107)](_0x19efc7,{'skipChildErrors':this[_0x4dc445(0x12c)][_0x4dc445(0x160)][_0x4dc445(0x165)]===_0x4dc445(0x15f)}),_0x51884c+=_0x19efc7[_0x4dc445(0x14a)],this[_0x4dc445(0x115)][_0x4dc445(0x168)](this[_0x4dc445(0x119)]+_0x4dc445(0x15c)+_0x51884c+'/'+this[_0x4dc445(0x114)]+_0x4dc445(0x162)),await this[_0x4dc445(0x115)][_0x4dc445(0x150)]();}}async['removeComponents'](_0x4da685){const _0xa44eb8=a60_0x522a75;_0x4da685[_0xa44eb8(0x155)](_0x57b6d0=>child_types_1['default']['includes'](_0x57b6d0[_0xa44eb8(0x142)])?-0x1:0x1);let _0x2f911f=0x0;while(_0x4da685['length']){const _0x644314=_0x4da685[_0xa44eb8(0x130)](0x0,this[_0xa44eb8(0x11c)]);await this[_0xa44eb8(0x164)][_0xa44eb8(0x166)](_0x644314),_0x2f911f+=_0x644314[_0xa44eb8(0x14a)],this[_0xa44eb8(0x115)][_0xa44eb8(0x168)](this[_0xa44eb8(0x119)]+_0xa44eb8(0x135)+_0x2f911f+'/'+this['componentsToDelete']+_0xa44eb8(0x162)),await this[_0xa44eb8(0x115)][_0xa44eb8(0x150)]();}}async[a60_0x522a75(0x140)](){const _0x5f42fc=a60_0x522a75;this['gitUtils']&&await this[_0x5f42fc(0x156)][_0x5f42fc(0x122)]()[_0x5f42fc(0x110)](()=>void 0x0),this['mdapiUtils']&&await this[_0x5f42fc(0x164)]['removeDir']()[_0x5f42fc(0x110)](()=>void 0x0),this[_0x5f42fc(0x153)]&&await this['sfdxUtils'][_0x5f42fc(0x122)]()[_0x5f42fc(0x110)](()=>void 0x0);}async[a60_0x522a75(0x136)](){const _0x3a70b5=a60_0x522a75,{repo:_0x5c7b84,branch:_0x3d5638,components:_0x1b7d28,convertToSFDX:_0x22cdff,message:_0x4a481a,user:_0x1bca12}=this['commitData'];this[_0x3a70b5(0x164)]=new mdapi_utils_1[(_0x3a70b5(0x16d))](),this[_0x3a70b5(0x156)]=new git_utils_1['GitUtils'](await this[_0x3a70b5(0x147)]()),this[_0x3a70b5(0x153)]=new sfdx_utils_1[(_0x3a70b5(0x163))]();let _0x384066=_0x22cdff;try{await this[_0x3a70b5(0x115)][_0x3a70b5(0x168)](this[_0x3a70b5(0x119)]+_0x3a70b5(0x125))['send'](),await this[_0x3a70b5(0x156)][_0x3a70b5(0x11a)](_0x3d5638['name'],_0x5c7b84[_0x3a70b5(0x165)]);!this[_0x3a70b5(0x12c)][_0x3a70b5(0x10d)]?(this[_0x3a70b5(0x115)]['log'](this[_0x3a70b5(0x119)]+_0x3a70b5(0x10e)),await this[_0x3a70b5(0x164)][_0x3a70b5(0x173)](this[_0x3a70b5(0x156)][_0x3a70b5(0x149)])):this[_0x3a70b5(0x115)][_0x3a70b5(0x168)](this[_0x3a70b5(0x119)]+_0x3a70b5(0x13f));await this[_0x3a70b5(0x115)][_0x3a70b5(0x168)](this[_0x3a70b5(0x119)]+_0x3a70b5(0x169))[_0x3a70b5(0x150)]();_0x1b7d28[_0x3a70b5(0x131)]&&(this['sfLogger'][_0x3a70b5(0x168)](this['prefix']+_0x3a70b5(0x120)),this['componentsToWrite']=_0x1b7d28[_0x3a70b5(0x131)][_0x3a70b5(0x14a)],await this[_0x3a70b5(0x12b)](_0x1b7d28[_0x3a70b5(0x131)]),await this[_0x3a70b5(0x115)]['send']());await this[_0x3a70b5(0x115)][_0x3a70b5(0x168)](this['prefix']+'\x20Checking\x20deleted\x20components.')[_0x3a70b5(0x150)]();_0x1b7d28[_0x3a70b5(0x14c)]&&(this['sfLogger'][_0x3a70b5(0x168)](this[_0x3a70b5(0x119)]+_0x3a70b5(0x133)),this[_0x3a70b5(0x123)]=_0x1b7d28[_0x3a70b5(0x14c)]['length'],await this[_0x3a70b5(0x166)](_0x1b7d28[_0x3a70b5(0x14c)]),await this[_0x3a70b5(0x115)][_0x3a70b5(0x150)]());await this['sfLogger'][_0x3a70b5(0x150)]();const _0x90bd7=await fs_internal_1['FS'][_0x3a70b5(0x11d)](this['gitUtils'][_0x3a70b5(0x149)]);await sfdx_utils_2[_0x3a70b5(0x171)]['isSFDXProject'](this[_0x3a70b5(0x156)][_0x3a70b5(0x149)])?(_0x384066=!![],await fs_internal_1['FS'][_0x3a70b5(0x122)](path_1[_0x3a70b5(0x129)](this[_0x3a70b5(0x156)][_0x3a70b5(0x149)],'force-app'))):(_0x384066&&(!_0x90bd7&&(_0x384066=![])),await this[_0x3a70b5(0x156)]['clearDir']());_0x384066?(await this[_0x3a70b5(0x115)]['log'](this['prefix']+_0x3a70b5(0x158))['send'](),await this[_0x3a70b5(0x153)][_0x3a70b5(0x116)](this[_0x3a70b5(0x164)]['dir']),await this[_0x3a70b5(0x153)]['copyProjectTo'](this[_0x3a70b5(0x156)][_0x3a70b5(0x149)],!_0x90bd7),await this[_0x3a70b5(0x153)][_0x3a70b5(0x122)]()):(await this[_0x3a70b5(0x115)][_0x3a70b5(0x168)](this[_0x3a70b5(0x119)]+_0x3a70b5(0x11e))[_0x3a70b5(0x150)](),await this['mdapiUtils'][_0x3a70b5(0x14d)](this[_0x3a70b5(0x156)][_0x3a70b5(0x149)]));await this['sfLogger'][_0x3a70b5(0x168)](this[_0x3a70b5(0x119)]+'\x20Committing\x20and\x20pushing\x20source\x20to\x20git.')[_0x3a70b5(0x150)](),await this[_0x3a70b5(0x156)][_0x3a70b5(0x102)](_0x4a481a,{'email':constants_1[_0x3a70b5(0x138)],'name':_0x1bca12[_0x3a70b5(0x165)]},_0x3d5638[_0x3a70b5(0x165)]),await this[_0x3a70b5(0x156)][_0x3a70b5(0x122)](),await this['mdapiUtils'][_0x3a70b5(0x122)]();const _0x4048d5=this[_0x3a70b5(0x114)]+this['componentsToDelete'];await this[_0x3a70b5(0x115)][_0x3a70b5(0x168)](this['prefix']+_0x3a70b5(0x134)+(Date['now']()-this[_0x3a70b5(0x12d)])+'ms.\x20Committed\x20components\x20-\x20'+_0x4048d5+'.')['send']();}catch(_0x178aa3){await this[_0x3a70b5(0x140)](),await this[_0x3a70b5(0x115)][_0x3a70b5(0x13d)](this['prefix']+'\x20'+_0x178aa3)[_0x3a70b5(0x150)]();throw _0x178aa3;}}async['run'](_0x3e91df,_0x3f0abb){const _0x53ff2c=a60_0x522a75;var _0x1855b7,_0x564bca;this[_0x53ff2c(0x115)]=typedi_1[_0x53ff2c(0x145)][_0x53ff2c(0x104)](providers_tokens_1[_0x53ff2c(0x16f)][_0x53ff2c(0x103)]),this[_0x53ff2c(0x119)]=(_0x3f0abb?_0x3f0abb+'\x20':'')+'['+commit_components_dto_1[_0x53ff2c(0x139)][_0x53ff2c(0x165)]+']',await this[_0x53ff2c(0x115)]['log'](this['prefix']+_0x53ff2c(0x12a));const _0x2e95ab=!!((_0x1855b7=_0x3e91df['components'])===null||_0x1855b7===void 0x0?void 0x0:_0x1855b7['writed'])||!!((_0x564bca=_0x3e91df[_0x53ff2c(0x108)])===null||_0x564bca===void 0x0?void 0x0:_0x564bca[_0x53ff2c(0x14c)]);if(!_0x2e95ab){await this[_0x53ff2c(0x115)][_0x53ff2c(0x168)](this[_0x53ff2c(0x119)]+_0x53ff2c(0x15b))[_0x53ff2c(0x150)]();return;}this[_0x53ff2c(0x12c)]=_0x3e91df,await this[_0x53ff2c(0x136)]();}};CommitComponentsJob=__decorate([typedi_1[a60_0x522a75(0x16b)]({'transient':!![]})],CommitComponentsJob),exports[a60_0x522a75(0x143)]=CommitComponentsJob;