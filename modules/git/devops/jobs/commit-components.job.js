const a104_0x59539e=a104_0x1ffe;(function(_0x5d0777,_0x2f48ac){const _0xc971d=a104_0x1ffe,_0x51a2f6=_0x5d0777();while(!![]){try{const _0x37cf45=parseInt(_0xc971d(0x12d))/0x1+-parseInt(_0xc971d(0x109))/0x2+-parseInt(_0xc971d(0x16f))/0x3+-parseInt(_0xc971d(0x13e))/0x4*(parseInt(_0xc971d(0x107))/0x5)+parseInt(_0xc971d(0x13b))/0x6+parseInt(_0xc971d(0x165))/0x7*(-parseInt(_0xc971d(0x14e))/0x8)+parseInt(_0xc971d(0x127))/0x9;if(_0x37cf45===_0x2f48ac)break;else _0x51a2f6['push'](_0x51a2f6['shift']());}catch(_0x4364e0){_0x51a2f6['push'](_0x51a2f6['shift']());}}}(a104_0x3004,0xe3dd2));const a104_0xedabad=(function(){let _0x4e28c5=!![];return function(_0xd2f297,_0xac8ffa){const _0x3939f0=_0x4e28c5?function(){const _0x5e0664=a104_0x1ffe;if(_0xac8ffa){const _0x5094de=_0xac8ffa[_0x5e0664(0x10d)](_0xd2f297,arguments);return _0xac8ffa=null,_0x5094de;}}:function(){};return _0x4e28c5=![],_0x3939f0;};}()),a104_0x22638b=a104_0xedabad(this,function(){const _0x564344=a104_0x1ffe;return a104_0x22638b['toString']()[_0x564344(0x157)]('(((.+)+)+)+$')[_0x564344(0x15c)]()[_0x564344(0x137)](a104_0x22638b)[_0x564344(0x157)](_0x564344(0x140));});a104_0x22638b();'use strict';function a104_0x1ffe(_0x18e947,_0x4f3986){const _0x33743c=a104_0x3004();return a104_0x1ffe=function(_0x22638b,_0xedabad){_0x22638b=_0x22638b-0x104;let _0x300466=_0x33743c[_0x22638b];return _0x300466;},a104_0x1ffe(_0x18e947,_0x4f3986);}var __createBinding=this&&this[a104_0x59539e(0x139)]||(Object[a104_0x59539e(0x12b)]?function(_0x25dee4,_0x3a04e6,_0x4018f4,_0x341ea5){const _0x262955=a104_0x59539e;if(_0x341ea5===undefined)_0x341ea5=_0x4018f4;var _0x158144=Object[_0x262955(0x148)](_0x3a04e6,_0x4018f4);(!_0x158144||('get'in _0x158144?!_0x3a04e6[_0x262955(0x14c)]:_0x158144[_0x262955(0x168)]||_0x158144[_0x262955(0x158)]))&&(_0x158144={'enumerable':!![],'get':function(){return _0x3a04e6[_0x4018f4];}}),Object[_0x262955(0x106)](_0x25dee4,_0x341ea5,_0x158144);}:function(_0x31fc6b,_0x24cd8c,_0x2ed9d4,_0x4b002f){if(_0x4b002f===undefined)_0x4b002f=_0x2ed9d4;_0x31fc6b[_0x4b002f]=_0x24cd8c[_0x2ed9d4];}),__setModuleDefault=this&&this[a104_0x59539e(0x166)]||(Object[a104_0x59539e(0x12b)]?function(_0x1e4d6d,_0x120c37){const _0x2d0431=a104_0x59539e;Object['defineProperty'](_0x1e4d6d,_0x2d0431(0x149),{'enumerable':!![],'value':_0x120c37});}:function(_0x43bc09,_0x4adffc){const _0x374417=a104_0x59539e;_0x43bc09[_0x374417(0x149)]=_0x4adffc;}),__decorate=this&&this[a104_0x59539e(0x13f)]||function(_0x44540,_0x25b484,_0xe6a453,_0x42bb67){const _0x4f7f29=a104_0x59539e;var _0x30d9f0=arguments[_0x4f7f29(0x169)],_0x314c2d=_0x30d9f0<0x3?_0x25b484:_0x42bb67===null?_0x42bb67=Object[_0x4f7f29(0x148)](_0x25b484,_0xe6a453):_0x42bb67,_0x32ddfa;if(typeof Reflect==='object'&&typeof Reflect[_0x4f7f29(0x11c)]===_0x4f7f29(0x161))_0x314c2d=Reflect[_0x4f7f29(0x11c)](_0x44540,_0x25b484,_0xe6a453,_0x42bb67);else{for(var _0x5ac242=_0x44540[_0x4f7f29(0x169)]-0x1;_0x5ac242>=0x0;_0x5ac242--)if(_0x32ddfa=_0x44540[_0x5ac242])_0x314c2d=(_0x30d9f0<0x3?_0x32ddfa(_0x314c2d):_0x30d9f0>0x3?_0x32ddfa(_0x25b484,_0xe6a453,_0x314c2d):_0x32ddfa(_0x25b484,_0xe6a453))||_0x314c2d;}return _0x30d9f0>0x3&&_0x314c2d&&Object[_0x4f7f29(0x106)](_0x25b484,_0xe6a453,_0x314c2d),_0x314c2d;},__importStar=this&&this[a104_0x59539e(0x11d)]||function(_0x3249b5){const _0x25fe8d=a104_0x59539e;if(_0x3249b5&&_0x3249b5[_0x25fe8d(0x14c)])return _0x3249b5;var _0x554803={};if(_0x3249b5!=null){for(var _0x25b247 in _0x3249b5)if(_0x25b247!==_0x25fe8d(0x149)&&Object[_0x25fe8d(0x15e)][_0x25fe8d(0x160)][_0x25fe8d(0x10b)](_0x3249b5,_0x25b247))__createBinding(_0x554803,_0x3249b5,_0x25b247);}return __setModuleDefault(_0x554803,_0x3249b5),_0x554803;},__importDefault=this&&this[a104_0x59539e(0x12f)]||function(_0x2c1e56){const _0x185b0e=a104_0x59539e;return _0x2c1e56&&_0x2c1e56[_0x185b0e(0x14c)]?_0x2c1e56:{'default':_0x2c1e56};};Object[a104_0x59539e(0x106)](exports,'__esModule',{'value':!![]}),exports[a104_0x59539e(0x117)]=void 0x0;const commit_components_dto_1=require(a104_0x59539e(0x15f)),events_1=__importDefault(require(a104_0x59539e(0x126))),git_utils_1=require('../utils/git.utils'),mdapi_utils_1=require('../utils/mdapi.utils'),sfdx_utils_1=require('../utils/sfdx.utils'),typedi_1=__importStar(require('typedi')),child_types_1=__importDefault(require(a104_0x59539e(0x176))),utils_1=require('../../../shared/utils'),constants_1=require(a104_0x59539e(0x16e)),git_provider_1=require(a104_0x59539e(0x110)),bitbucket_api_service_1=require(a104_0x59539e(0x14b)),sfdx_utils_2=require(a104_0x59539e(0x12e)),fs_internal_1=require('../../internal/fs.internal'),path_1=require(a104_0x59539e(0x116)),providers_tokens_1=require(a104_0x59539e(0x15b)),constants_2=require('../../../../constants');function a104_0x3004(){const _0x312c96=['\x20Checking\x20deleted\x20components.','../../providers/providers.tokens','toString','credentials','prototype','../dto/commit-components.dto','hasOwnProperty','function','splice','commitAndPush','\x20components','77hCiFcY','__setModuleDefault','CommitComponentsDto','writable','length','ms.\x20Committed\x20components\x20-\x20','\x20Nothing\x20to\x20commit.\x20Skip.','master','writeFlosumComponents','../../../../constants','1693902pHJays','\x20Deleted\x20','components','replace','DEFAULT_GIT_USER_EMAIL','name','writed','../../parsers/data/child-types','MDApiUtils','\x20Preparing\x20to\x20write\x20components','defineProperty','10545zSHRbl','dir','2361756kEvFDU','values','call','Service','apply','getGitShellAuthorizationString','://','../../providers/types/git-provider','GitProvider','sort','\x20Wrote\x20','\x20Force\x20sync.\x20Skip\x20preparing\x20mdapi\x20from\x20repository.','push','path','CommitComponentsJob','groupComponentsByFileName','removeComponents','FORCE_APP_DEFAULT_DIR','componentsToWrite','decorate','__importStar','Tokens','\x20Start\x20converting\x20to\x20SFDX.','log','gitUtils','isSFDXProject','copyProjectTo','send','fileName','events','33467481nGwHWH','copyMdapiTo','prefix','join','create','startTime','701688VYqUhH','../../salesforce/utils/sfdx.utils','__importDefault','getRemote','removeDir','catch','fileType','branch','sfdxUtils','\x20Copying\x20mdapi\x20to\x20git\x20folder.','constructor','exec','__createBinding','componentsToDelete','5161710KzigPT','Bitbucket','error','3244oGdzev','__decorate','(((.+)+)+)+$','COMPONENTS_PER_TICK','GitUtils','type','includes','\x20Checking\x20written\x20components.','prepareMdapi','\x20Checking\x20commit\x20components.','getOwnPropertyDescriptor','default','copyVlocityComponents','../../providers/api/bitbucket-api.service','__esModule','commitData','648248bBRcWz','mdapiUtils','isEmptyDir','sfLogger','now','get','SFDXUtils','SFDX','deleted','search','configurable','cleanUp'];a104_0x3004=function(){return _0x312c96;};return a104_0x3004();}let CommitComponentsJob=class CommitComponentsJob extends events_1['default']{constructor(){const _0x369b3f=a104_0x59539e;super(...arguments),this[_0x369b3f(0x141)]=0x3e8,this['componentsToWrite']=0x0,this[_0x369b3f(0x13a)]=0x0,this['startTime']=Date[_0x369b3f(0x152)]();}async['getRemote'](){const _0x40b04c=a104_0x59539e,{repo:_0x315447}=this[_0x40b04c(0x14d)],_0x41f014=typedi_1['default'][_0x40b04c(0x153)](providers_tokens_1['Tokens'][_0x40b04c(0x15d)]);if(this[_0x40b04c(0x14d)]['provider']===git_provider_1[_0x40b04c(0x111)][_0x40b04c(0x13c)]){const _0x1936fc=typedi_1['default'][_0x40b04c(0x153)](bitbucket_api_service_1['BitbucketApiService']);await _0x1936fc['isLoggedIn']();}return _0x315447['gitUrl'][_0x40b04c(0x172)](/http(s)?:\/\/(.+@)?/,(0x0,utils_1['getProtocol'])(_0x315447['gitUrl'])+_0x40b04c(0x10f)+_0x41f014[_0x40b04c(0x10e)]()+'@');}[a104_0x59539e(0x118)](_0x1ce279){const _0x3b08e0=a104_0x59539e;var _0x4fb23c;_0x1ce279['sort'](_0x2a0a25=>child_types_1[_0x3b08e0(0x149)][_0x3b08e0(0x144)](_0x2a0a25[_0x3b08e0(0x133)])?0x1:-0x1);const _0x1699df={};for(const _0x1ee696 of _0x1ce279){_0x1699df[_0x4fb23c=_0x1ee696['fileName']]||(_0x1699df[_0x4fb23c]=[]),_0x1699df[_0x1ee696[_0x3b08e0(0x125)]][_0x3b08e0(0x115)](_0x1ee696);}return Object[_0x3b08e0(0x10a)](_0x1699df)['reduce']((_0xc3eb8d,_0x552618)=>[..._0xc3eb8d,..._0x552618],[]);}async['writeComponents'](_0x358d56){const _0x2900cf=a104_0x59539e;_0x358d56=this[_0x2900cf(0x118)](_0x358d56);let _0x821083=0x0;while(_0x358d56['length']){const _0x33146c=_0x358d56[_0x2900cf(0x162)](0x0,this[_0x2900cf(0x141)]);await this['mdapiUtils'][_0x2900cf(0x16d)](_0x33146c,{'skipChildErrors':this[_0x2900cf(0x14d)][_0x2900cf(0x134)][_0x2900cf(0x174)]===_0x2900cf(0x16c)}),_0x821083+=_0x33146c[_0x2900cf(0x169)],this['sfLogger'][_0x2900cf(0x120)](this[_0x2900cf(0x129)]+_0x2900cf(0x113)+_0x821083+'/'+this['componentsToWrite']+_0x2900cf(0x164)),await this[_0x2900cf(0x151)][_0x2900cf(0x124)]();}}async[a104_0x59539e(0x119)](_0x36d32a){const _0x4f69f9=a104_0x59539e;_0x36d32a[_0x4f69f9(0x112)](_0x3c0166=>child_types_1[_0x4f69f9(0x149)][_0x4f69f9(0x144)](_0x3c0166[_0x4f69f9(0x143)])?-0x1:0x1);let _0x292cfb=0x0;while(_0x36d32a['length']){const _0x1cce0e=_0x36d32a[_0x4f69f9(0x162)](0x0,this['COMPONENTS_PER_TICK']);await this['mdapiUtils']['removeComponents'](_0x1cce0e),_0x292cfb+=_0x1cce0e[_0x4f69f9(0x169)],this['sfLogger'][_0x4f69f9(0x120)](this[_0x4f69f9(0x129)]+_0x4f69f9(0x170)+_0x292cfb+'/'+this[_0x4f69f9(0x13a)]+'\x20components'),await this[_0x4f69f9(0x151)][_0x4f69f9(0x124)]();}}async[a104_0x59539e(0x159)](){const _0x421596=a104_0x59539e;this[_0x421596(0x121)]&&await this['gitUtils'][_0x421596(0x131)]()[_0x421596(0x132)](()=>void 0x0),this[_0x421596(0x14f)]&&await this[_0x421596(0x14f)][_0x421596(0x131)]()['catch'](()=>void 0x0),this[_0x421596(0x135)]&&await this[_0x421596(0x135)][_0x421596(0x131)]()[_0x421596(0x132)](()=>void 0x0);}async[a104_0x59539e(0x138)](){const _0x5c71b9=a104_0x59539e,{repo:_0x4e64b3,branch:_0x930e6b,components:_0x113f26,convertToSFDX:_0x51d901,message:_0xd44ee,user:_0x1c1281}=this['commitData'];this[_0x5c71b9(0x14f)]=new mdapi_utils_1[(_0x5c71b9(0x104))](),this[_0x5c71b9(0x121)]=new git_utils_1[(_0x5c71b9(0x142))](await this[_0x5c71b9(0x130)]()),this['sfdxUtils']=new sfdx_utils_1[(_0x5c71b9(0x154))]();let _0x1f3a39=_0x51d901;try{await this[_0x5c71b9(0x151)][_0x5c71b9(0x120)](this['prefix']+'\x20Start\x20cloning\x20repository.')[_0x5c71b9(0x124)](),await this[_0x5c71b9(0x121)]['clone'](_0x930e6b[_0x5c71b9(0x174)],_0x4e64b3[_0x5c71b9(0x174)]);!this[_0x5c71b9(0x14d)]['force']?(this['sfLogger'][_0x5c71b9(0x120)](this[_0x5c71b9(0x129)]+'\x20Prepare\x20mdapi\x20files.'),await this[_0x5c71b9(0x14f)][_0x5c71b9(0x146)](this[_0x5c71b9(0x121)][_0x5c71b9(0x108)])):this[_0x5c71b9(0x151)][_0x5c71b9(0x120)](this[_0x5c71b9(0x129)]+_0x5c71b9(0x114));await this[_0x5c71b9(0x151)]['log'](this[_0x5c71b9(0x129)]+_0x5c71b9(0x145))[_0x5c71b9(0x124)]();_0x113f26[_0x5c71b9(0x175)]&&(this[_0x5c71b9(0x151)][_0x5c71b9(0x120)](this[_0x5c71b9(0x129)]+_0x5c71b9(0x105)),this[_0x5c71b9(0x11b)]=_0x113f26[_0x5c71b9(0x175)][_0x5c71b9(0x169)],await this['writeComponents'](_0x113f26['writed']),await this[_0x5c71b9(0x151)][_0x5c71b9(0x124)]());await this['sfLogger'][_0x5c71b9(0x120)](this[_0x5c71b9(0x129)]+_0x5c71b9(0x15a))[_0x5c71b9(0x124)]();_0x113f26[_0x5c71b9(0x156)]&&(this[_0x5c71b9(0x151)]['log'](this[_0x5c71b9(0x129)]+'\x20Preparing\x20to\x20delete\x20components'),this[_0x5c71b9(0x13a)]=_0x113f26[_0x5c71b9(0x156)][_0x5c71b9(0x169)],await this[_0x5c71b9(0x119)](_0x113f26['deleted']),await this[_0x5c71b9(0x151)][_0x5c71b9(0x124)]());await this[_0x5c71b9(0x151)]['send']();const _0x109c03=await fs_internal_1['FS'][_0x5c71b9(0x150)](this[_0x5c71b9(0x121)][_0x5c71b9(0x108)]);await sfdx_utils_2[_0x5c71b9(0x155)][_0x5c71b9(0x122)](this[_0x5c71b9(0x121)]['dir'])?(_0x1f3a39=!![],await fs_internal_1['FS']['removeDir']((0x0,path_1[_0x5c71b9(0x12a)])(this[_0x5c71b9(0x121)][_0x5c71b9(0x108)],'force-app'))):(_0x1f3a39&&(!_0x109c03&&(_0x1f3a39=![])),await this['gitUtils']['clearDir']());_0x1f3a39?(await this['sfLogger'][_0x5c71b9(0x120)](this[_0x5c71b9(0x129)]+_0x5c71b9(0x11f))[_0x5c71b9(0x124)](),await this[_0x5c71b9(0x135)]['createProjectFrom'](this[_0x5c71b9(0x14f)][_0x5c71b9(0x108)]),await this['sfdxUtils'][_0x5c71b9(0x123)](this['gitUtils']['dir'],!_0x109c03),await this[_0x5c71b9(0x135)][_0x5c71b9(0x14a)](this[_0x5c71b9(0x14f)][_0x5c71b9(0x108)],(0x0,path_1['join'])(this['gitUtils'][_0x5c71b9(0x108)],constants_2[_0x5c71b9(0x11a)])),await this['sfdxUtils'][_0x5c71b9(0x131)]()):(await this[_0x5c71b9(0x151)][_0x5c71b9(0x120)](this['prefix']+_0x5c71b9(0x136))['send'](),await this[_0x5c71b9(0x14f)][_0x5c71b9(0x128)](this['gitUtils'][_0x5c71b9(0x108)]));await this[_0x5c71b9(0x151)]['log'](this[_0x5c71b9(0x129)]+'\x20Committing\x20and\x20pushing\x20source\x20to\x20git.')[_0x5c71b9(0x124)](),await this[_0x5c71b9(0x121)][_0x5c71b9(0x163)](_0xd44ee,{'email':constants_1[_0x5c71b9(0x173)],'name':_0x1c1281[_0x5c71b9(0x174)]},_0x930e6b['name']),await this[_0x5c71b9(0x121)][_0x5c71b9(0x131)](),await this[_0x5c71b9(0x14f)][_0x5c71b9(0x131)]();const _0x13f58b=this['componentsToWrite']+this[_0x5c71b9(0x13a)];await this[_0x5c71b9(0x151)][_0x5c71b9(0x120)](this[_0x5c71b9(0x129)]+'\x20Commit\x20job\x20done.\x20Time\x20spent\x20-\x20'+(Date[_0x5c71b9(0x152)]()-this[_0x5c71b9(0x12c)])+_0x5c71b9(0x16a)+_0x13f58b+'.')['send']();}catch(_0x55c477){await this['cleanUp'](),await this[_0x5c71b9(0x151)][_0x5c71b9(0x13d)](this[_0x5c71b9(0x129)]+'\x20'+_0x55c477)['send']();throw _0x55c477;}}async['run'](_0x18b403,_0x5c2261){const _0x597160=a104_0x59539e;var _0xc27609,_0x403c92;this[_0x597160(0x151)]=typedi_1[_0x597160(0x149)][_0x597160(0x153)](providers_tokens_1[_0x597160(0x11e)]['logger']),this['prefix']=(_0x5c2261?_0x5c2261+'\x20':'')+'['+commit_components_dto_1[_0x597160(0x167)][_0x597160(0x174)]+']',await this[_0x597160(0x151)]['log'](this[_0x597160(0x129)]+_0x597160(0x147));const _0x33a3ca=!!((_0xc27609=_0x18b403[_0x597160(0x171)])===null||_0xc27609===void 0x0?void 0x0:_0xc27609[_0x597160(0x175)])||!!((_0x403c92=_0x18b403[_0x597160(0x171)])===null||_0x403c92===void 0x0?void 0x0:_0x403c92['deleted']);if(!_0x33a3ca){await this['sfLogger'][_0x597160(0x120)](this[_0x597160(0x129)]+_0x597160(0x16b))['send']();return;}this[_0x597160(0x14d)]=_0x18b403,await this[_0x597160(0x138)]();}};CommitComponentsJob=__decorate([(0x0,typedi_1[a104_0x59539e(0x10c)])({'transient':!![]})],CommitComponentsJob),exports[a104_0x59539e(0x117)]=CommitComponentsJob;