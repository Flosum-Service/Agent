const a104_0x1be904=a104_0x5da7;(function(_0xcc4591,_0x6cd71f){const _0x2e1162=a104_0x5da7,_0x12e9d5=_0xcc4591();while(!![]){try{const _0x14d517=-parseInt(_0x2e1162(0xf3))/0x1*(-parseInt(_0x2e1162(0xc5))/0x2)+parseInt(_0x2e1162(0x98))/0x3+-parseInt(_0x2e1162(0xf6))/0x4+-parseInt(_0x2e1162(0xd4))/0x5+-parseInt(_0x2e1162(0xe0))/0x6+-parseInt(_0x2e1162(0xaa))/0x7+parseInt(_0x2e1162(0x95))/0x8;if(_0x14d517===_0x6cd71f)break;else _0x12e9d5['push'](_0x12e9d5['shift']());}catch(_0x1cd49a){_0x12e9d5['push'](_0x12e9d5['shift']());}}}(a104_0x32c5,0x42caa));function a104_0x32c5(){const _0x587d86=['startTime','getGitShellAuthorizationString','\x20Preparing\x20to\x20write\x20components','error','type','\x20components','Service','provider','GitProvider','force','130848cTUbES','clearDir','configurable','://','defineProperty','writeFlosumComponents','writeComponents','GitUtils','isLoggedIn','catch','../../providers/providers.tokens','search','__importStar','\x20Wrote\x20','writed','1292970nTqsur','__createBinding','create','\x20Preparing\x20to\x20delete\x20components','sfdxUtils','../utils/mdapi.utils','DEFAULT_GIT_USER_EMAIL','componentsToWrite','../../providers/api/bitbucket-api.service','SFDXUtils','function','includes','75012fhoWxu','\x20Prepare\x20mdapi\x20files.','gitUtils','logger','../../parsers/data/child-types','send','copyMdapiTo','../utils/sfdx.utils','commitData','branch','copyProjectTo','decorate','\x20Commit\x20job\x20done.\x20Time\x20spent\x20-\x20','Tokens','getOwnPropertyDescriptor','gitUrl','\x20Deleted\x20','exec','__esModule','1UdzLYI','splice','__importDefault','758508aUYvLH','getRemote','componentsToDelete','commitAndPush','replace','ms.\x20Committed\x20components\x20-\x20','COMPONENTS_PER_TICK','writable','log','constructor','sfLogger','prefix','isSFDXProject','components','MDApiUtils','get','getProtocol','7222808FclWgS','hasOwnProperty','removeComponents','331449wuKDaX','\x20Committing\x20and\x20pushing\x20source\x20to\x20git.','now','CommitComponentsJob','join','BitbucketApiService','sort','__decorate','groupComponentsByFileName','values','deleted','length','\x20Nothing\x20to\x20commit.\x20Skip.','../../salesforce/utils/sfdx.utils','name','fileType','\x20Checking\x20written\x20components.','../dto/commit-components.dto','2411199JfvabE','mdapiUtils','removeDir','run','force-app','(((.+)+)+)+$','../../providers/types/git-provider','fileName','prototype','toString','\x20Force\x20sync.\x20Skip\x20preparing\x20mdapi\x20from\x20repository.','call','\x20Start\x20cloning\x20repository.','../../internal/fs.internal','dir','\x20Checking\x20deleted\x20components.','default'];a104_0x32c5=function(){return _0x587d86;};return a104_0x32c5();}const a104_0x504f26=(function(){let _0x3114d3=!![];return function(_0x8194d4,_0x455135){const _0x54131e=_0x3114d3?function(){if(_0x455135){const _0x1d6830=_0x455135['apply'](_0x8194d4,arguments);return _0x455135=null,_0x1d6830;}}:function(){};return _0x3114d3=![],_0x54131e;};}()),a104_0x37ea5c=a104_0x504f26(this,function(){const _0x50c40d=a104_0x5da7;return a104_0x37ea5c[_0x50c40d(0xb3)]()['search'](_0x50c40d(0xaf))['toString']()[_0x50c40d(0x8d)](a104_0x37ea5c)[_0x50c40d(0xd0)](_0x50c40d(0xaf));});a104_0x37ea5c();function a104_0x5da7(_0x526583,_0x90a781){const _0x5c2e00=a104_0x32c5();return a104_0x5da7=function(_0x37ea5c,_0x504f26){_0x37ea5c=_0x37ea5c-0x8a;let _0x32c5fc=_0x5c2e00[_0x37ea5c];return _0x32c5fc;},a104_0x5da7(_0x526583,_0x90a781);}'use strict';var __createBinding=this&&this[a104_0x1be904(0xd5)]||(Object[a104_0x1be904(0xd6)]?function(_0x124433,_0x27ec96,_0x562331,_0x7d88c6){const _0x51114e=a104_0x1be904;if(_0x7d88c6===undefined)_0x7d88c6=_0x562331;var _0x22c7e4=Object['getOwnPropertyDescriptor'](_0x27ec96,_0x562331);(!_0x22c7e4||(_0x51114e(0x93)in _0x22c7e4?!_0x27ec96[_0x51114e(0xf2)]:_0x22c7e4[_0x51114e(0x8b)]||_0x22c7e4[_0x51114e(0xc7)]))&&(_0x22c7e4={'enumerable':!![],'get':function(){return _0x27ec96[_0x562331];}}),Object[_0x51114e(0xc9)](_0x124433,_0x7d88c6,_0x22c7e4);}:function(_0x16fffb,_0x10544d,_0x50c11f,_0x2e6682){if(_0x2e6682===undefined)_0x2e6682=_0x50c11f;_0x16fffb[_0x2e6682]=_0x10544d[_0x50c11f];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a104_0x1be904(0xd6)]?function(_0x5d8542,_0x7f64f3){const _0x2709d3=a104_0x1be904;Object[_0x2709d3(0xc9)](_0x5d8542,_0x2709d3(0xba),{'enumerable':!![],'value':_0x7f64f3});}:function(_0x2c5d4f,_0x3502c3){const _0x35aee1=a104_0x1be904;_0x2c5d4f[_0x35aee1(0xba)]=_0x3502c3;}),__decorate=this&&this[a104_0x1be904(0x9f)]||function(_0x4ce17c,_0x3d31ee,_0x1f0301,_0x4214c1){const _0x195bf0=a104_0x1be904;var _0x1ccf56=arguments[_0x195bf0(0xa3)],_0xd59c27=_0x1ccf56<0x3?_0x3d31ee:_0x4214c1===null?_0x4214c1=Object[_0x195bf0(0xee)](_0x3d31ee,_0x1f0301):_0x4214c1,_0x332e85;if(typeof Reflect==='object'&&typeof Reflect[_0x195bf0(0xeb)]===_0x195bf0(0xde))_0xd59c27=Reflect[_0x195bf0(0xeb)](_0x4ce17c,_0x3d31ee,_0x1f0301,_0x4214c1);else{for(var _0x44deb5=_0x4ce17c[_0x195bf0(0xa3)]-0x1;_0x44deb5>=0x0;_0x44deb5--)if(_0x332e85=_0x4ce17c[_0x44deb5])_0xd59c27=(_0x1ccf56<0x3?_0x332e85(_0xd59c27):_0x1ccf56>0x3?_0x332e85(_0x3d31ee,_0x1f0301,_0xd59c27):_0x332e85(_0x3d31ee,_0x1f0301))||_0xd59c27;}return _0x1ccf56>0x3&&_0xd59c27&&Object[_0x195bf0(0xc9)](_0x3d31ee,_0x1f0301,_0xd59c27),_0xd59c27;},__importStar=this&&this[a104_0x1be904(0xd1)]||function(_0x4e699c){const _0x553c68=a104_0x1be904;if(_0x4e699c&&_0x4e699c['__esModule'])return _0x4e699c;var _0x344c1b={};if(_0x4e699c!=null){for(var _0x2462b9 in _0x4e699c)if(_0x2462b9!=='default'&&Object[_0x553c68(0xb2)][_0x553c68(0x96)][_0x553c68(0xb5)](_0x4e699c,_0x2462b9))__createBinding(_0x344c1b,_0x4e699c,_0x2462b9);}return __setModuleDefault(_0x344c1b,_0x4e699c),_0x344c1b;},__importDefault=this&&this[a104_0x1be904(0xf5)]||function(_0x130078){return _0x130078&&_0x130078['__esModule']?_0x130078:{'default':_0x130078};};Object[a104_0x1be904(0xc9)](exports,a104_0x1be904(0xf2),{'value':!![]}),exports['CommitComponentsJob']=void 0x0;const commit_components_dto_1=require(a104_0x1be904(0xa9)),events_1=__importDefault(require('events')),git_utils_1=require('../utils/git.utils'),mdapi_utils_1=require(a104_0x1be904(0xd9)),sfdx_utils_1=require(a104_0x1be904(0xe7)),typedi_1=__importStar(require('typedi')),child_types_1=__importDefault(require(a104_0x1be904(0xe4))),utils_1=require('../../../shared/utils'),constants_1=require('../../../../constants'),git_provider_1=require(a104_0x1be904(0xb0)),bitbucket_api_service_1=require(a104_0x1be904(0xdc)),sfdx_utils_2=require(a104_0x1be904(0xa5)),fs_internal_1=require(a104_0x1be904(0xb7)),path_1=require('path'),providers_tokens_1=require(a104_0x1be904(0xcf));let CommitComponentsJob=class CommitComponentsJob extends events_1[a104_0x1be904(0xba)]{constructor(){const _0x5ed596=a104_0x1be904;super(...arguments),this[_0x5ed596(0x8a)]=0x3e8,this[_0x5ed596(0xdb)]=0x0,this[_0x5ed596(0xf8)]=0x0,this['startTime']=Date[_0x5ed596(0x9a)]();}async[a104_0x1be904(0xf7)](){const _0x41622a=a104_0x1be904,{repo:_0x35f0a1}=this[_0x41622a(0xe8)],_0x3235d6=typedi_1[_0x41622a(0xba)]['get'](providers_tokens_1[_0x41622a(0xed)]['credentials']);if(this[_0x41622a(0xe8)][_0x41622a(0xc2)]===git_provider_1[_0x41622a(0xc3)]['Bitbucket']){const _0x7fc5df=typedi_1[_0x41622a(0xba)]['get'](bitbucket_api_service_1[_0x41622a(0x9d)]);await _0x7fc5df[_0x41622a(0xcd)]();}return _0x35f0a1[_0x41622a(0xef)][_0x41622a(0xfa)](/http(s)?:\/\/(.+@)?/,(0x0,utils_1[_0x41622a(0x94)])(_0x35f0a1[_0x41622a(0xef)])+_0x41622a(0xc8)+_0x3235d6[_0x41622a(0xbc)]()+'@');}[a104_0x1be904(0xa0)](_0x478d20){const _0x2a51bd=a104_0x1be904;var _0x5117cb;_0x478d20[_0x2a51bd(0x9e)](_0xc921d8=>child_types_1['default'][_0x2a51bd(0xdf)](_0xc921d8[_0x2a51bd(0xa7)])?0x1:-0x1);const _0x187815={};for(const _0xe058bb of _0x478d20){_0x187815[_0x5117cb=_0xe058bb[_0x2a51bd(0xb1)]]||(_0x187815[_0x5117cb]=[]),_0x187815[_0xe058bb[_0x2a51bd(0xb1)]]['push'](_0xe058bb);}return Object[_0x2a51bd(0xa1)](_0x187815)['reduce']((_0x2fe63b,_0x176d77)=>[..._0x2fe63b,..._0x176d77],[]);}async[a104_0x1be904(0xcb)](_0x29ba3f){const _0x2a723e=a104_0x1be904;_0x29ba3f=this[_0x2a723e(0xa0)](_0x29ba3f);let _0x42356d=0x0;while(_0x29ba3f[_0x2a723e(0xa3)]){const _0xfd5c11=_0x29ba3f[_0x2a723e(0xf4)](0x0,this[_0x2a723e(0x8a)]);await this[_0x2a723e(0xab)][_0x2a723e(0xca)](_0xfd5c11,{'skipChildErrors':this[_0x2a723e(0xe8)][_0x2a723e(0xe9)]['name']==='master'}),_0x42356d+=_0xfd5c11[_0x2a723e(0xa3)],this[_0x2a723e(0x8e)]['log'](this[_0x2a723e(0x8f)]+_0x2a723e(0xd2)+_0x42356d+'/'+this[_0x2a723e(0xdb)]+_0x2a723e(0xc0)),await this['sfLogger'][_0x2a723e(0xe5)]();}}async[a104_0x1be904(0x97)](_0x24a79c){const _0x44e917=a104_0x1be904;_0x24a79c['sort'](_0x118a0c=>child_types_1[_0x44e917(0xba)][_0x44e917(0xdf)](_0x118a0c[_0x44e917(0xbf)])?-0x1:0x1);let _0x985a19=0x0;while(_0x24a79c[_0x44e917(0xa3)]){const _0x4dd99e=_0x24a79c[_0x44e917(0xf4)](0x0,this[_0x44e917(0x8a)]);await this[_0x44e917(0xab)][_0x44e917(0x97)](_0x4dd99e),_0x985a19+=_0x4dd99e['length'],this[_0x44e917(0x8e)][_0x44e917(0x8c)](this[_0x44e917(0x8f)]+_0x44e917(0xf0)+_0x985a19+'/'+this['componentsToDelete']+_0x44e917(0xc0)),await this[_0x44e917(0x8e)][_0x44e917(0xe5)]();}}async['cleanUp'](){const _0x73c85c=a104_0x1be904;this[_0x73c85c(0xe2)]&&await this[_0x73c85c(0xe2)][_0x73c85c(0xac)]()[_0x73c85c(0xce)](()=>void 0x0),this[_0x73c85c(0xab)]&&await this['mdapiUtils']['removeDir']()[_0x73c85c(0xce)](()=>void 0x0),this[_0x73c85c(0xd8)]&&await this[_0x73c85c(0xd8)][_0x73c85c(0xac)]()[_0x73c85c(0xce)](()=>void 0x0);}async['exec'](){const _0x2a3e8a=a104_0x1be904,{repo:_0x32f8ad,branch:_0x3b58d9,components:_0x3e684b,convertToSFDX:_0x13e75c,message:_0xde0d99,user:_0x4b19d5}=this[_0x2a3e8a(0xe8)];this[_0x2a3e8a(0xab)]=new mdapi_utils_1[(_0x2a3e8a(0x92))](),this[_0x2a3e8a(0xe2)]=new git_utils_1[(_0x2a3e8a(0xcc))](await this[_0x2a3e8a(0xf7)]()),this['sfdxUtils']=new sfdx_utils_1[(_0x2a3e8a(0xdd))]();let _0x1a69f9=_0x13e75c;try{await this[_0x2a3e8a(0x8e)][_0x2a3e8a(0x8c)](this[_0x2a3e8a(0x8f)]+_0x2a3e8a(0xb6))[_0x2a3e8a(0xe5)](),await this['gitUtils']['clone'](_0x3b58d9[_0x2a3e8a(0xa6)],_0x32f8ad[_0x2a3e8a(0xa6)]);!this[_0x2a3e8a(0xe8)][_0x2a3e8a(0xc4)]?(this[_0x2a3e8a(0x8e)]['log'](this['prefix']+_0x2a3e8a(0xe1)),await this[_0x2a3e8a(0xab)]['prepareMdapi'](this[_0x2a3e8a(0xe2)][_0x2a3e8a(0xb8)])):this[_0x2a3e8a(0x8e)][_0x2a3e8a(0x8c)](this[_0x2a3e8a(0x8f)]+_0x2a3e8a(0xb4));await this['sfLogger']['log'](this[_0x2a3e8a(0x8f)]+_0x2a3e8a(0xa8))[_0x2a3e8a(0xe5)]();_0x3e684b['writed']&&(this[_0x2a3e8a(0x8e)][_0x2a3e8a(0x8c)](this['prefix']+_0x2a3e8a(0xbd)),this[_0x2a3e8a(0xdb)]=_0x3e684b[_0x2a3e8a(0xd3)]['length'],await this[_0x2a3e8a(0xcb)](_0x3e684b[_0x2a3e8a(0xd3)]),await this[_0x2a3e8a(0x8e)]['send']());await this[_0x2a3e8a(0x8e)][_0x2a3e8a(0x8c)](this[_0x2a3e8a(0x8f)]+_0x2a3e8a(0xb9))[_0x2a3e8a(0xe5)]();_0x3e684b[_0x2a3e8a(0xa2)]&&(this[_0x2a3e8a(0x8e)]['log'](this['prefix']+_0x2a3e8a(0xd7)),this['componentsToDelete']=_0x3e684b[_0x2a3e8a(0xa2)]['length'],await this[_0x2a3e8a(0x97)](_0x3e684b[_0x2a3e8a(0xa2)]),await this['sfLogger']['send']());await this[_0x2a3e8a(0x8e)][_0x2a3e8a(0xe5)]();const _0x204743=await fs_internal_1['FS']['isEmptyDir'](this[_0x2a3e8a(0xe2)][_0x2a3e8a(0xb8)]);await sfdx_utils_2['SFDX'][_0x2a3e8a(0x90)](this[_0x2a3e8a(0xe2)][_0x2a3e8a(0xb8)])?(_0x1a69f9=!![],await fs_internal_1['FS'][_0x2a3e8a(0xac)]((0x0,path_1[_0x2a3e8a(0x9c)])(this[_0x2a3e8a(0xe2)][_0x2a3e8a(0xb8)],_0x2a3e8a(0xae)))):(_0x1a69f9&&(!_0x204743&&(_0x1a69f9=![])),await this[_0x2a3e8a(0xe2)][_0x2a3e8a(0xc6)]());_0x1a69f9?(await this[_0x2a3e8a(0x8e)][_0x2a3e8a(0x8c)](this[_0x2a3e8a(0x8f)]+'\x20Start\x20converting\x20to\x20SFDX.')['send'](),await this['sfdxUtils']['createProjectFrom'](this[_0x2a3e8a(0xab)][_0x2a3e8a(0xb8)]),await this[_0x2a3e8a(0xd8)][_0x2a3e8a(0xea)](this['gitUtils'][_0x2a3e8a(0xb8)],!_0x204743),await this[_0x2a3e8a(0xd8)][_0x2a3e8a(0xac)]()):(await this[_0x2a3e8a(0x8e)]['log'](this[_0x2a3e8a(0x8f)]+'\x20Copying\x20mdapi\x20to\x20git\x20folder.')['send'](),await this[_0x2a3e8a(0xab)][_0x2a3e8a(0xe6)](this[_0x2a3e8a(0xe2)][_0x2a3e8a(0xb8)]));await this['sfLogger']['log'](this[_0x2a3e8a(0x8f)]+_0x2a3e8a(0x99))[_0x2a3e8a(0xe5)](),await this['gitUtils'][_0x2a3e8a(0xf9)](_0xde0d99,{'email':constants_1[_0x2a3e8a(0xda)],'name':_0x4b19d5[_0x2a3e8a(0xa6)]},_0x3b58d9[_0x2a3e8a(0xa6)]),await this['gitUtils'][_0x2a3e8a(0xac)](),await this[_0x2a3e8a(0xab)][_0x2a3e8a(0xac)]();const _0x2e37cf=this[_0x2a3e8a(0xdb)]+this[_0x2a3e8a(0xf8)];await this[_0x2a3e8a(0x8e)][_0x2a3e8a(0x8c)](this['prefix']+_0x2a3e8a(0xec)+(Date['now']()-this[_0x2a3e8a(0xbb)])+_0x2a3e8a(0xfb)+_0x2e37cf+'.')[_0x2a3e8a(0xe5)]();}catch(_0x25c1d0){await this['cleanUp'](),await this[_0x2a3e8a(0x8e)][_0x2a3e8a(0xbe)](this['prefix']+'\x20'+_0x25c1d0)['send']();throw _0x25c1d0;}}async[a104_0x1be904(0xad)](_0x391990,_0x995ba9){const _0x1aa1f7=a104_0x1be904;var _0x4760bb,_0x3639a6;this[_0x1aa1f7(0x8e)]=typedi_1['default'][_0x1aa1f7(0x93)](providers_tokens_1[_0x1aa1f7(0xed)][_0x1aa1f7(0xe3)]),this[_0x1aa1f7(0x8f)]=(_0x995ba9?_0x995ba9+'\x20':'')+'['+commit_components_dto_1['CommitComponentsDto'][_0x1aa1f7(0xa6)]+']',await this[_0x1aa1f7(0x8e)]['log'](this[_0x1aa1f7(0x8f)]+'\x20Checking\x20commit\x20components.');const _0x438957=!!((_0x4760bb=_0x391990[_0x1aa1f7(0x91)])===null||_0x4760bb===void 0x0?void 0x0:_0x4760bb[_0x1aa1f7(0xd3)])||!!((_0x3639a6=_0x391990['components'])===null||_0x3639a6===void 0x0?void 0x0:_0x3639a6['deleted']);if(!_0x438957){await this[_0x1aa1f7(0x8e)][_0x1aa1f7(0x8c)](this[_0x1aa1f7(0x8f)]+_0x1aa1f7(0xa4))[_0x1aa1f7(0xe5)]();return;}this[_0x1aa1f7(0xe8)]=_0x391990,await this[_0x1aa1f7(0xf1)]();}};CommitComponentsJob=__decorate([(0x0,typedi_1[a104_0x1be904(0xc1)])({'transient':!![]})],CommitComponentsJob),exports[a104_0x1be904(0x9b)]=CommitComponentsJob;