const a104_0x1bc95e=a104_0x22bf;(function(_0xc34b77,_0x5e04d1){const _0x2248c6=a104_0x22bf,_0x153f1c=_0xc34b77();while(!![]){try{const _0x2f5ccb=-parseInt(_0x2248c6(0x199))/0x1+-parseInt(_0x2248c6(0x1c4))/0x2+-parseInt(_0x2248c6(0x17e))/0x3+parseInt(_0x2248c6(0x1a5))/0x4+parseInt(_0x2248c6(0x1a0))/0x5*(-parseInt(_0x2248c6(0x190))/0x6)+parseInt(_0x2248c6(0x19b))/0x7*(parseInt(_0x2248c6(0x18c))/0x8)+parseInt(_0x2248c6(0x178))/0x9;if(_0x2f5ccb===_0x5e04d1)break;else _0x153f1c['push'](_0x153f1c['shift']());}catch(_0x201cf5){_0x153f1c['push'](_0x153f1c['shift']());}}}(a104_0x5d0d,0x575a8));function a104_0x22bf(_0x51fd2c,_0xd4beae){const _0xaff633=a104_0x5d0d();return a104_0x22bf=function(_0x35c480,_0x5a712a){_0x35c480=_0x35c480-0x166;let _0x5d0da5=_0xaff633[_0x35c480];return _0x5d0da5;},a104_0x22bf(_0x51fd2c,_0xd4beae);}const a104_0x5a712a=(function(){let _0x6df286=!![];return function(_0x400c0e,_0x34b22d){const _0x1568d6=_0x6df286?function(){if(_0x34b22d){const _0x3e2dfb=_0x34b22d['apply'](_0x400c0e,arguments);return _0x34b22d=null,_0x3e2dfb;}}:function(){};return _0x6df286=![],_0x1568d6;};}()),a104_0x35c480=a104_0x5a712a(this,function(){const _0x278b0d=a104_0x22bf;return a104_0x35c480[_0x278b0d(0x188)]()[_0x278b0d(0x19a)](_0x278b0d(0x1ad))[_0x278b0d(0x188)]()[_0x278b0d(0x17c)](a104_0x35c480)[_0x278b0d(0x19a)](_0x278b0d(0x1ad));});function a104_0x5d0d(){const _0x1f7abe=['12040731RdlQqQ','ERR_INVALID_SYNC_RECORD_ID','__importDefault','getRepositoryRecord','constructor','../../../../constants/errors','960267AhSPHM',']\x20[','function','branchName','Tokens','getComponentsToWrite','exec','all','syncRepositoryId','../../../../constants','toString','../../salesforce/services/salesforce-retriever.service','gitRepoService','toUpperCase','24176IaPxrS','CommitComponentsDto','../../salesforce/services/salesforce-sync.service','then','2046486EUGXWi','\x20Start\x20Flosum\x20commit\x20job.','Completed',']\x20[Branch:\x20','SalesforceSyncService','SalesforceRetrieverService','defineProperty','handleCommitJobError','CommitComponentsJob','389843XzMznJ','search','1351SIWphY','Logger','syncBranchId','repoService','log','10YoWuOs','user','gitApiService','send','provider','74640VElpEo','FlosumCommitJob','patchObject','deleteAttachmentId','retrieveAttachment','trim','setStatus','getOwnPropertyDescriptor','(((.+)+)+)+$','repo','../../../../core/errors/bad-request.error','decorate','BadRequestError','FLOSUM_ATTACHMENT','commitData','convertToSFDX','config','message','typedi','branch','commitJob','Container','object','./commit-components.job','getCommitDto','SalesforceService','__esModule','updateLastCommit','updateRemoteState','name','repositoryData','379742GasJEO','metadata','Error','../../providers/providers.tokens','salesforceService','commitAttachmentId','deleteAttachment','\x20Update\x20remote\x20state.','shortid','get','fetchRepositoryData','sfLogger','run','length','repository','gitProvider','salesforceSync','prefix','logger','default','__metadata','repositoryName','In\x20Progress','map',']\x20[Repository:\x20','getOne'];a104_0x5d0d=function(){return _0x1f7abe;};return a104_0x5d0d();}a104_0x35c480();'use strict';var __decorate=this&&this['__decorate']||function(_0x4c6ed3,_0x2d228d,_0x3ba676,_0x5b9e50){const _0x258822=a104_0x22bf;var _0x1a6da6=arguments[_0x258822(0x16b)],_0x38b7fe=_0x1a6da6<0x3?_0x2d228d:_0x5b9e50===null?_0x5b9e50=Object[_0x258822(0x1ac)](_0x2d228d,_0x3ba676):_0x5b9e50,_0x4be910;if(typeof Reflect===_0x258822(0x1bb)&&typeof Reflect[_0x258822(0x1b0)]===_0x258822(0x180))_0x38b7fe=Reflect[_0x258822(0x1b0)](_0x4c6ed3,_0x2d228d,_0x3ba676,_0x5b9e50);else{for(var _0x114b0d=_0x4c6ed3[_0x258822(0x16b)]-0x1;_0x114b0d>=0x0;_0x114b0d--)if(_0x4be910=_0x4c6ed3[_0x114b0d])_0x38b7fe=(_0x1a6da6<0x3?_0x4be910(_0x38b7fe):_0x1a6da6>0x3?_0x4be910(_0x2d228d,_0x3ba676,_0x38b7fe):_0x4be910(_0x2d228d,_0x3ba676))||_0x38b7fe;}return _0x1a6da6>0x3&&_0x38b7fe&&Object[_0x258822(0x196)](_0x2d228d,_0x3ba676,_0x38b7fe),_0x38b7fe;},__metadata=this&&this[a104_0x1bc95e(0x172)]||function(_0x191652,_0xdf9cd6){const _0x213042=a104_0x1bc95e;if(typeof Reflect===_0x213042(0x1bb)&&typeof Reflect[_0x213042(0x1c5)]===_0x213042(0x180))return Reflect['metadata'](_0x191652,_0xdf9cd6);},__importDefault=this&&this[a104_0x1bc95e(0x17a)]||function(_0x5adb44){const _0x10367b=a104_0x1bc95e;return _0x5adb44&&_0x5adb44[_0x10367b(0x1bf)]?_0x5adb44:{'default':_0x5adb44};},FlosumCommitJob_1;Object[a104_0x1bc95e(0x196)](exports,a104_0x1bc95e(0x1bf),{'value':!![]}),exports[a104_0x1bc95e(0x1a6)]=void 0x0;const core_1=require('../../../../core'),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a104_0x1bc95e(0x1b7)),errors_1=require(a104_0x1bc95e(0x17d)),bad_request_error_1=require(a104_0x1bc95e(0x1af)),salesforce_retriever_service_1=require(a104_0x1bc95e(0x189)),salesforce_sync_service_1=require(a104_0x1bc95e(0x18e)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a104_0x1bc95e(0x1bc)),constants_1=require(a104_0x1bc95e(0x187)),shortid_1=__importDefault(require(a104_0x1bc95e(0x166))),providers_tokens_1=require(a104_0x1bc95e(0x1c7));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x4bcc84,_0x182943,_0xad52f6){const _0xb1553b=a104_0x1bc95e;this[_0xb1553b(0x1c8)]=_0x4bcc84,this['commitJob']=_0x182943,this[_0xb1553b(0x16e)]=_0xad52f6,this[_0xb1553b(0x170)]=new core_1[(_0xb1553b(0x19c))](FlosumCommitJob_1[_0xb1553b(0x1c2)]);}async['fetchRepositoryData'](){const _0x3d773b=a104_0x1bc95e;try{if(this[_0x3d773b(0x1b3)][_0x3d773b(0x186)])this['repositoryData']=await this[_0x3d773b(0x16e)][_0x3d773b(0x17b)](this['commitData'][_0x3d773b(0x186)]);else this[_0x3d773b(0x1b3)]['syncBranchId']&&(this['repositoryData']=await this[_0x3d773b(0x16e)]['getBranchRecord'](this['commitData'][_0x3d773b(0x19d)]));}catch(_0x1578f8){throw new bad_request_error_1[(_0x3d773b(0x1b1))](errors_1[_0x3d773b(0x179)]);}}async[a104_0x1bc95e(0x183)](){const _0x468cda=a104_0x1bc95e;if(!this[_0x468cda(0x1b3)][_0x468cda(0x1c9)])return[];await this[_0x468cda(0x1c8)][_0x468cda(0x1a7)](constants_1['FLOSUM_ATTACHMENT'],this['commitData'][_0x468cda(0x1c9)],{'Name':(0x0,shortid_1[_0x468cda(0x171)])()});const _0x31afa0=await this['salesforceService'][_0x468cda(0x1a9)](this[_0x468cda(0x1b3)][_0x468cda(0x1c9)])[_0x468cda(0x18f)](_0xf66faa=>_0xf66faa['split']('\x20')[_0x468cda(0x175)](_0x46b50e=>_0x46b50e[_0x468cda(0x1aa)]()));await this[_0x468cda(0x1c8)]['deleteAttachment'](this[_0x468cda(0x1b3)][_0x468cda(0x1c9)]);const _0x22118f=new salesforce_retriever_service_1[(_0x468cda(0x195))](this[_0x468cda(0x1c8)]);return await _0x22118f[_0x468cda(0x16a)](_0x31afa0);}async['getComponentsToDelete'](){const _0x5a89da=a104_0x1bc95e;if(!this['commitData'][_0x5a89da(0x1a8)])return[];await this[_0x5a89da(0x1c8)][_0x5a89da(0x1a7)](constants_1[_0x5a89da(0x1b2)],this[_0x5a89da(0x1b3)][_0x5a89da(0x1a8)],{'Name':(0x0,shortid_1['default'])()});const _0x16300c=await this[_0x5a89da(0x1c8)][_0x5a89da(0x1a9)](this[_0x5a89da(0x1b3)]['deleteAttachmentId']);return await this[_0x5a89da(0x1c8)][_0x5a89da(0x1ca)](this[_0x5a89da(0x1b3)][_0x5a89da(0x1a8)]),_0x16300c;}async[a104_0x1bc95e(0x1bd)](){const _0x3f6b82=a104_0x1bc95e,_0x1d81dd=new commit_components_dto_1[(_0x3f6b82(0x18d))](),[_0x389cdf,_0x3bab44]=await Promise[_0x3f6b82(0x185)]([this[_0x3f6b82(0x183)](),this['getComponentsToDelete']()]);return _0x1d81dd[_0x3f6b82(0x1b6)]=this[_0x3f6b82(0x1b3)][_0x3f6b82(0x1b6)],_0x1d81dd['user']=this[_0x3f6b82(0x1b3)][_0x3f6b82(0x1a1)],_0x1d81dd['components']={'writed':_0x389cdf,'deleted':_0x3bab44},_0x1d81dd[_0x3f6b82(0x1b4)]=this[_0x3f6b82(0x1b5)]['isConvertToSfdx'],_0x1d81dd[_0x3f6b82(0x1ae)]=this[_0x3f6b82(0x16c)],_0x1d81dd['branch']=this['branch'],_0x1d81dd[_0x3f6b82(0x1a4)]=this[_0x3f6b82(0x1b5)][_0x3f6b82(0x16d)],_0x1d81dd;}async[a104_0x1bc95e(0x1c0)](_0x5cbff9=![]){const _0x342283=a104_0x1bc95e;if(_0x5cbff9)await this['salesforceSync']['updateRemoteState'](this[_0x342283(0x1c3)],{});else{const _0x1e1f8f=await this[_0x342283(0x16c)]['branches'][_0x342283(0x177)](this[_0x342283(0x1b8)][_0x342283(0x1c2)]);this[_0x342283(0x169)][_0x342283(0x19f)](this[_0x342283(0x16f)]+_0x342283(0x1cb));const _0x3f791c={[this[_0x342283(0x16c)]['gitUrl']]:{'lastCommit':_0x1e1f8f['sha']}};await this[_0x342283(0x16e)][_0x342283(0x1c1)](this[_0x342283(0x1c3)],_0x3f791c);}}async['exec'](){const _0x2141f7=a104_0x1bc95e,_0x4e6216=await this['getCommitDto']();await this[_0x2141f7(0x16e)][_0x2141f7(0x1ab)](this[_0x2141f7(0x1c3)],_0x2141f7(0x174)),await this[_0x2141f7(0x1b9)]['run'](_0x4e6216,this[_0x2141f7(0x16f)]),await this[_0x2141f7(0x1c0)](),await this[_0x2141f7(0x16e)]['setStatus'](this[_0x2141f7(0x1c3)],_0x2141f7(0x192));}async[a104_0x1bc95e(0x197)](_0x30e837){const _0x51e2c6=a104_0x1bc95e;try{this[_0x51e2c6(0x169)]['error'](''+_0x30e837),await this[_0x51e2c6(0x169)][_0x51e2c6(0x1a3)](),await this['updateLastCommit'](!![]),await this[_0x51e2c6(0x16e)][_0x51e2c6(0x1ab)](this['repositoryData'],_0x51e2c6(0x1c6));}catch(_0xe951dd){this['logger']['error'](_0xe951dd);}}async['run'](_0x3543e6){const _0x36b063=a104_0x1bc95e;try{this['commitData']=_0x3543e6,this[_0x36b063(0x1a2)]=typedi_1[_0x36b063(0x1ba)][_0x36b063(0x167)](providers_tokens_1[_0x36b063(0x182)][_0x36b063(0x1a2)]),this[_0x36b063(0x19e)]=typedi_1[_0x36b063(0x1ba)][_0x36b063(0x167)](providers_tokens_1['Tokens'][_0x36b063(0x18a)]),this[_0x36b063(0x1b5)]=typedi_1[_0x36b063(0x1ba)][_0x36b063(0x167)](providers_tokens_1[_0x36b063(0x182)][_0x36b063(0x1b5)]),await this[_0x36b063(0x168)](),this['repository']=await this[_0x36b063(0x19e)][_0x36b063(0x177)](this[_0x36b063(0x1c3)][_0x36b063(0x173)]),this[_0x36b063(0x1b8)]=await this['repository']['branches']['getOne'](this[_0x36b063(0x1c3)][_0x36b063(0x181)]),this[_0x36b063(0x169)]=typedi_1['Container'][_0x36b063(0x167)](providers_tokens_1[_0x36b063(0x182)][_0x36b063(0x170)]),this['prefix']='[FLOSUM\x20->\x20GIT]\x20['+this[_0x36b063(0x1b5)]['gitProvider'][_0x36b063(0x18b)]()+_0x36b063(0x176)+this[_0x36b063(0x1c3)][_0x36b063(0x173)]+_0x36b063(0x193)+this[_0x36b063(0x1c3)]['branchName']+_0x36b063(0x17f)+FlosumCommitJob_1[_0x36b063(0x1c2)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x36b063(0x1b1))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this['sfLogger']['log'](this[_0x36b063(0x16f)]+_0x36b063(0x191))[_0x36b063(0x1a3)](),await this[_0x36b063(0x184)]()['catch'](_0x48bb2d=>this['handleCommitJobError'](_0x48bb2d));}catch(_0x19d680){this['commitData']=undefined,this[_0x36b063(0x170)]['error'](_0x19d680);throw _0x19d680;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a104_0x1bc95e(0x1be)],commit_components_job_1[a104_0x1bc95e(0x198)],salesforce_sync_service_1[a104_0x1bc95e(0x194)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;