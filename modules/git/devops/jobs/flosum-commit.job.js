const a107_0x433592=a107_0x5bbd;function a107_0x5bbd(_0x3155a1,_0x4f5cb8){const _0x4a1427=a107_0x59b3();return a107_0x5bbd=function(_0x19eb57,_0x45414a){_0x19eb57=_0x19eb57-0xae;let _0x59b36c=_0x4a1427[_0x19eb57];return _0x59b36c;},a107_0x5bbd(_0x3155a1,_0x4f5cb8);}(function(_0x1e6526,_0x4426f4){const _0x40e6bd=a107_0x5bbd,_0x216e73=_0x1e6526();while(!![]){try{const _0x2218a5=parseInt(_0x40e6bd(0xfe))/0x1+parseInt(_0x40e6bd(0x113))/0x2+parseInt(_0x40e6bd(0xfd))/0x3*(-parseInt(_0x40e6bd(0x10f))/0x4)+-parseInt(_0x40e6bd(0xd3))/0x5*(-parseInt(_0x40e6bd(0xd0))/0x6)+parseInt(_0x40e6bd(0x10b))/0x7+-parseInt(_0x40e6bd(0xf3))/0x8+-parseInt(_0x40e6bd(0xb3))/0x9*(parseInt(_0x40e6bd(0x11c))/0xa);if(_0x2218a5===_0x4426f4)break;else _0x216e73['push'](_0x216e73['shift']());}catch(_0x22445d){_0x216e73['push'](_0x216e73['shift']());}}}(a107_0x59b3,0x63086));const a107_0x45414a=(function(){let _0x2be4f9=!![];return function(_0x14f11b,_0x1a1a08){const _0x551da9=_0x2be4f9?function(){const _0x2d2894=a107_0x5bbd;if(_0x1a1a08){const _0x598182=_0x1a1a08[_0x2d2894(0xf2)](_0x14f11b,arguments);return _0x1a1a08=null,_0x598182;}}:function(){};return _0x2be4f9=![],_0x551da9;};}()),a107_0x19eb57=a107_0x45414a(this,function(){const _0x1ab931=a107_0x5bbd;return a107_0x19eb57[_0x1ab931(0xd6)]()[_0x1ab931(0xe5)]('(((.+)+)+)+$')[_0x1ab931(0xd6)]()[_0x1ab931(0xba)](a107_0x19eb57)[_0x1ab931(0xe5)](_0x1ab931(0xdf));});a107_0x19eb57();'use strict';var __decorate=this&&this['__decorate']||function(_0x35205b,_0x515a84,_0x314b14,_0xfb9e06){const _0x40da03=a107_0x5bbd;var _0x128438=arguments['length'],_0x39fae1=_0x128438<0x3?_0x515a84:_0xfb9e06===null?_0xfb9e06=Object['getOwnPropertyDescriptor'](_0x515a84,_0x314b14):_0xfb9e06,_0x4a862f;if(typeof Reflect===_0x40da03(0xda)&&typeof Reflect[_0x40da03(0x106)]===_0x40da03(0xfa))_0x39fae1=Reflect[_0x40da03(0x106)](_0x35205b,_0x515a84,_0x314b14,_0xfb9e06);else{for(var _0x3ded74=_0x35205b['length']-0x1;_0x3ded74>=0x0;_0x3ded74--)if(_0x4a862f=_0x35205b[_0x3ded74])_0x39fae1=(_0x128438<0x3?_0x4a862f(_0x39fae1):_0x128438>0x3?_0x4a862f(_0x515a84,_0x314b14,_0x39fae1):_0x4a862f(_0x515a84,_0x314b14))||_0x39fae1;}return _0x128438>0x3&&_0x39fae1&&Object[_0x40da03(0x119)](_0x515a84,_0x314b14,_0x39fae1),_0x39fae1;},__metadata=this&&this[a107_0x433592(0xb9)]||function(_0xef0b59,_0x1fc781){const _0x49dcfc=a107_0x433592;if(typeof Reflect===_0x49dcfc(0xda)&&typeof Reflect[_0x49dcfc(0x109)]===_0x49dcfc(0xfa))return Reflect[_0x49dcfc(0x109)](_0xef0b59,_0x1fc781);},__importDefault=this&&this[a107_0x433592(0xb6)]||function(_0x2b2bcb){const _0x45eaa3=a107_0x433592;return _0x2b2bcb&&_0x2b2bcb[_0x45eaa3(0xbe)]?_0x2b2bcb:{'default':_0x2b2bcb};},FlosumCommitJob_1;Object[a107_0x433592(0x119)](exports,a107_0x433592(0xbe),{'value':!![]}),exports[a107_0x433592(0xb7)]=void 0x0;function a107_0x59b3(){const _0x3e35a7=['syncBranchId','ERR_INVALID_SYNC_RECORD_ID','__importDefault','FlosumCommitJob','split','__metadata','constructor','error','all','name','__esModule','commitData','getComponentsToWrite','BadRequestError','get','../../providers/providers.tokens','repoService','FLOSUM_ATTACHMENT','updateLastCommit','gitApiService','getCommitDto','getRepositoryRecord','exec','Tokens','components','[FLOSUM\x20->\x20GIT]\x20[','parse','\x20Start\x20Flosum\x20commit\x20job.','2636256aNQrTZ','user','default','5CipSRX','repositoryData','Service','toString','then',']\x20[Branch:\x20','patchObject','object','setStatus','commitAttachmentId','salesforceService','../../../../core/errors/bad-request.error','(((.+)+)+)+$','prefix','repository','repositoryName','getOne','deleteAttachment','search','salesforceSync','repo','recordType','log','SalesforceService','Container','sfLogger','trim','Error','CommitComponentsJob','../dto/commit-components.dto','../../salesforce/services/salesforce.service','apply','2007808kyccIv','toUpperCase','gitUrl','../../../../core','gitProvider','gitRepoService',']\x20[','function','recordTypeName','retrieveAttachment','9JSiMxX','341533fQPhOO','commitJob','getComponentsToDelete','In\x20Progress','ERR_UNKNOWN_SYNC_RECORD_ID','../../salesforce/services/salesforce-retriever.service','config','convertToSFDX','decorate','map','isConvertToSfdx','metadata','sha','4534775yqtxuL','provider','send','design:paramtypes','419500NcacBu','catch','branchName','shortid','1039232hOZQXy','branches','./commit-components.job','getBranchRecord','../../salesforce/services/salesforce-sync.service','CommitComponentsDto','defineProperty','run',']\x20[Repository:\x20','9771110JvVJkj','Logger','handleCommitJobError','syncRepositoryId','deleteAttachmentId','logger','branch','../../../../constants/errors','9beSuhc'];a107_0x59b3=function(){return _0x3e35a7;};return a107_0x59b3();}const core_1=require(a107_0x433592(0xf6)),salesforce_service_1=require(a107_0x433592(0xf1)),typedi_1=require('typedi'),errors_1=require(a107_0x433592(0xb2)),bad_request_error_1=require(a107_0x433592(0xde)),salesforce_retriever_service_1=require(a107_0x433592(0x103)),salesforce_sync_service_1=require(a107_0x433592(0x117)),commit_components_dto_1=require(a107_0x433592(0xf0)),commit_components_job_1=require(a107_0x433592(0x115)),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a107_0x433592(0x112))),providers_tokens_1=require(a107_0x433592(0xc3));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x398eef,_0x53084a,_0x58173d){const _0x5752cf=a107_0x433592;this['salesforceService']=_0x398eef,this[_0x5752cf(0xff)]=_0x53084a,this['salesforceSync']=_0x58173d,this[_0x5752cf(0xb0)]=new core_1[(_0x5752cf(0x11d))](FlosumCommitJob_1[_0x5752cf(0xbd)]);}async['fetchRepositoryData'](){const _0xa9690=a107_0x433592;try{if(this[_0xa9690(0xbf)][_0xa9690(0xae)])this[_0xa9690(0xd4)]=await this[_0xa9690(0xe6)][_0xa9690(0xc9)](this[_0xa9690(0xbf)][_0xa9690(0xae)]);else this[_0xa9690(0xbf)][_0xa9690(0xb4)]&&(this[_0xa9690(0xd4)]=await this['salesforceSync'][_0xa9690(0x116)](this['commitData'][_0xa9690(0xb4)]));}catch(_0x4b7d54){throw new bad_request_error_1[(_0xa9690(0xc1))](errors_1[_0xa9690(0xb5)]);}}async[a107_0x433592(0xc0)](){const _0x2df7ae=a107_0x433592;if(!this['commitData']['commitAttachmentId'])return[];await this[_0x2df7ae(0xdd)][_0x2df7ae(0xd9)](constants_1[_0x2df7ae(0xc5)],this['commitData'][_0x2df7ae(0xdc)],{'Name':(0x0,shortid_1['default'])()});const _0x4f8991=await this[_0x2df7ae(0xdd)]['retrieveAttachment'](this['commitData'][_0x2df7ae(0xdc)])[_0x2df7ae(0xd7)](_0x27856d=>_0x27856d[_0x2df7ae(0xb8)]('\x20')[_0x2df7ae(0x107)](_0x5a1f4e=>_0x5a1f4e[_0x2df7ae(0xed)]()));await this[_0x2df7ae(0xdd)]['deleteAttachment'](this['commitData'][_0x2df7ae(0xdc)]);const _0x304beb=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x2df7ae(0xdd)]);return await _0x304beb[_0x2df7ae(0x11a)](_0x4f8991);}async[a107_0x433592(0x100)](){const _0x51e6b7=a107_0x433592;if(!this[_0x51e6b7(0xbf)]['deleteAttachmentId'])return[];await this[_0x51e6b7(0xdd)][_0x51e6b7(0xd9)](constants_1['FLOSUM_ATTACHMENT'],this['commitData'][_0x51e6b7(0xaf)],{'Name':(0x0,shortid_1[_0x51e6b7(0xd2)])()});const _0x24185a=await this[_0x51e6b7(0xdd)][_0x51e6b7(0xfc)](this['commitData']['deleteAttachmentId']),_0x33b352=JSON[_0x51e6b7(0xce)](_0x24185a);return await this[_0x51e6b7(0xdd)][_0x51e6b7(0xe4)](this['commitData'][_0x51e6b7(0xaf)]),_0x33b352;}async['getCommitDto'](){const _0x3451db=a107_0x433592,_0x1e9888=new commit_components_dto_1[(_0x3451db(0x118))](),[_0x4f1d8d,_0x1530dc]=await Promise[_0x3451db(0xbc)]([this[_0x3451db(0xc0)](),this['getComponentsToDelete']()]);return _0x1e9888['message']=this[_0x3451db(0xbf)]['message'],_0x1e9888['user']=this[_0x3451db(0xbf)][_0x3451db(0xd1)],_0x1e9888[_0x3451db(0xcc)]={'writed':_0x4f1d8d,'deleted':_0x1530dc},_0x1e9888[_0x3451db(0x105)]=this[_0x3451db(0x104)][_0x3451db(0x108)],_0x1e9888[_0x3451db(0xe7)]=this[_0x3451db(0xe1)],_0x1e9888[_0x3451db(0xb1)]=this[_0x3451db(0xb1)],_0x1e9888[_0x3451db(0x10c)]=this[_0x3451db(0x104)][_0x3451db(0xf7)],_0x1e9888[_0x3451db(0xe8)]=this[_0x3451db(0xd4)][_0x3451db(0xfb)],_0x1e9888;}async[a107_0x433592(0xc6)](_0x145c42=![]){const _0x22074c=a107_0x433592;if(_0x145c42)await this['salesforceSync']['updateRemoteState'](this[_0x22074c(0xd4)],{});else{const _0x3507e4=await this['repository'][_0x22074c(0x114)][_0x22074c(0xe3)](this[_0x22074c(0xb1)][_0x22074c(0xbd)]);this[_0x22074c(0xec)][_0x22074c(0xe9)](this[_0x22074c(0xe0)]+'\x20Update\x20remote\x20state.');const _0x728aef={[this[_0x22074c(0xe1)][_0x22074c(0xf5)]]:{'lastCommit':_0x3507e4[_0x22074c(0x10a)]}};await this[_0x22074c(0xe6)]['updateRemoteState'](this[_0x22074c(0xd4)],_0x728aef);}}async['exec'](){const _0x2b2df3=a107_0x433592,_0x807195=await this[_0x2b2df3(0xc8)]();await this[_0x2b2df3(0xe6)][_0x2b2df3(0xdb)](this['repositoryData'],_0x2b2df3(0x101)),await this['commitJob']['run'](_0x807195,this['prefix']),await this['updateLastCommit'](),await this[_0x2b2df3(0xe6)][_0x2b2df3(0xdb)](this[_0x2b2df3(0xd4)],'Completed');}async[a107_0x433592(0x11e)](_0x21476e){const _0xb611f7=a107_0x433592;try{this[_0xb611f7(0xec)][_0xb611f7(0xbb)](''+_0x21476e),await this[_0xb611f7(0xec)]['send'](),await this[_0xb611f7(0xc6)](!![]),await this[_0xb611f7(0xe6)]['setStatus'](this[_0xb611f7(0xd4)],_0xb611f7(0xee));}catch(_0x42f5de){this[_0xb611f7(0xb0)][_0xb611f7(0xbb)](_0x42f5de);}}async['run'](_0xd2f8e6){const _0x245a1d=a107_0x433592;try{this[_0x245a1d(0xbf)]=_0xd2f8e6,this[_0x245a1d(0xc7)]=typedi_1['Container'][_0x245a1d(0xc2)](providers_tokens_1[_0x245a1d(0xcb)][_0x245a1d(0xc7)]),this[_0x245a1d(0xc4)]=typedi_1[_0x245a1d(0xeb)]['get'](providers_tokens_1[_0x245a1d(0xcb)][_0x245a1d(0xf8)]),this[_0x245a1d(0x104)]=typedi_1[_0x245a1d(0xeb)]['get'](providers_tokens_1['Tokens']['config']),await this['fetchRepositoryData'](),this[_0x245a1d(0xe1)]=await this[_0x245a1d(0xc4)][_0x245a1d(0xe3)](this[_0x245a1d(0xd4)]['repositoryName']),this[_0x245a1d(0xb1)]=await this[_0x245a1d(0xe1)][_0x245a1d(0x114)]['getOne'](this[_0x245a1d(0xd4)][_0x245a1d(0x111)]),this[_0x245a1d(0xec)]=typedi_1[_0x245a1d(0xeb)][_0x245a1d(0xc2)](providers_tokens_1['Tokens'][_0x245a1d(0xb0)]),this[_0x245a1d(0xe0)]=_0x245a1d(0xcd)+this['config'][_0x245a1d(0xf7)][_0x245a1d(0xf4)]()+_0x245a1d(0x11b)+this[_0x245a1d(0xd4)][_0x245a1d(0xe2)]+_0x245a1d(0xd8)+this[_0x245a1d(0xd4)][_0x245a1d(0x111)]+_0x245a1d(0xf9)+FlosumCommitJob_1[_0x245a1d(0xbd)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x245a1d(0xc1))](errors_1[_0x245a1d(0x102)]);await this[_0x245a1d(0xec)][_0x245a1d(0xe9)](this[_0x245a1d(0xe0)]+_0x245a1d(0xcf))[_0x245a1d(0x10d)](),await this[_0x245a1d(0xca)]()[_0x245a1d(0x110)](_0x5cff70=>this[_0x245a1d(0x11e)](_0x5cff70));}catch(_0x481541){this[_0x245a1d(0xbf)]=undefined,this['logger'][_0x245a1d(0xbb)](_0x481541);throw _0x481541;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a107_0x433592(0xd5)])({'transient':!![]}),__metadata(a107_0x433592(0x10e),[salesforce_service_1[a107_0x433592(0xea)],commit_components_job_1[a107_0x433592(0xef)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a107_0x433592(0xb7)]=FlosumCommitJob;