const a124_0x107d77=a124_0x1de7;function a124_0x1de7(_0x1bc3bc,_0xd52075){const _0x3e07fe=a124_0x3f56();return a124_0x1de7=function(_0x3e04af,_0xcba0d9){_0x3e04af=_0x3e04af-0xfe;let _0x3f5675=_0x3e07fe[_0x3e04af];return _0x3f5675;},a124_0x1de7(_0x1bc3bc,_0xd52075);}(function(_0x16bd27,_0x216ef2){const _0x174084=a124_0x1de7,_0x1eb917=_0x16bd27();while(!![]){try{const _0x22fbf0=parseInt(_0x174084(0x173))/0x1*(parseInt(_0x174084(0x109))/0x2)+-parseInt(_0x174084(0x143))/0x3+parseInt(_0x174084(0x127))/0x4+parseInt(_0x174084(0x15e))/0x5+-parseInt(_0x174084(0x107))/0x6+-parseInt(_0x174084(0x159))/0x7*(-parseInt(_0x174084(0x15a))/0x8)+parseInt(_0x174084(0x14a))/0x9*(parseInt(_0x174084(0x144))/0xa);if(_0x22fbf0===_0x216ef2)break;else _0x1eb917['push'](_0x1eb917['shift']());}catch(_0xfb06fa){_0x1eb917['push'](_0x1eb917['shift']());}}}(a124_0x3f56,0xd5314));const a124_0xcba0d9=(function(){let _0x404bd6=!![];return function(_0x565f8a,_0x4dcc06){const _0x2afaa8=_0x404bd6?function(){if(_0x4dcc06){const _0x250693=_0x4dcc06['apply'](_0x565f8a,arguments);return _0x4dcc06=null,_0x250693;}}:function(){};return _0x404bd6=![],_0x2afaa8;};}()),a124_0x3e04af=a124_0xcba0d9(this,function(){const _0x5d1536=a124_0x1de7;return a124_0x3e04af['toString']()['search']('(((.+)+)+)+$')['toString']()[_0x5d1536(0x13e)](a124_0x3e04af)[_0x5d1536(0x155)](_0x5d1536(0x112));});a124_0x3e04af();'use strict';var __decorate=this&&this['__decorate']||function(_0x2ff076,_0x5de286,_0xc62c19,_0x18c9b4){const _0x222b50=a124_0x1de7;var _0x52e761=arguments[_0x222b50(0x135)],_0x37c00e=_0x52e761<0x3?_0x5de286:_0x18c9b4===null?_0x18c9b4=Object[_0x222b50(0x10a)](_0x5de286,_0xc62c19):_0x18c9b4,_0x334173;if(typeof Reflect===_0x222b50(0x147)&&typeof Reflect[_0x222b50(0x123)]===_0x222b50(0x166))_0x37c00e=Reflect[_0x222b50(0x123)](_0x2ff076,_0x5de286,_0xc62c19,_0x18c9b4);else{for(var _0x5a2d7d=_0x2ff076[_0x222b50(0x135)]-0x1;_0x5a2d7d>=0x0;_0x5a2d7d--)if(_0x334173=_0x2ff076[_0x5a2d7d])_0x37c00e=(_0x52e761<0x3?_0x334173(_0x37c00e):_0x52e761>0x3?_0x334173(_0x5de286,_0xc62c19,_0x37c00e):_0x334173(_0x5de286,_0xc62c19))||_0x37c00e;}return _0x52e761>0x3&&_0x37c00e&&Object['defineProperty'](_0x5de286,_0xc62c19,_0x37c00e),_0x37c00e;},__metadata=this&&this['__metadata']||function(_0x5df0b7,_0x125bbe){const _0x533c9b=a124_0x1de7;if(typeof Reflect===_0x533c9b(0x147)&&typeof Reflect[_0x533c9b(0x11d)]===_0x533c9b(0x166))return Reflect[_0x533c9b(0x11d)](_0x5df0b7,_0x125bbe);},__importDefault=this&&this['__importDefault']||function(_0x9b5cde){const _0x1964cb=a124_0x1de7;return _0x9b5cde&&_0x9b5cde[_0x1964cb(0x16a)]?_0x9b5cde:{'default':_0x9b5cde};},FlosumCommitJob_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a124_0x107d77(0x139)]=void 0x0;function a124_0x3f56(){const _0x4ed403=['getComponentsToDelete','branch','email','10263432pwxrBj','../../../../core','14DXRuoo','getOwnPropertyDescriptor','getRepositoryRecord','convertToSFDX','message','recordTypeName','deleteAttachmentId','setStatus','sha','(((.+)+)+)+$','../../salesforce/services/salesforce-sync.service','fetchRepositoryData','./commit-components.job','provider',']\x20[Repository:\x20','exec','trim','default','log','CommitToGitCompletedNotification','metadata','typedi','then','ERR_INVALID_SYNC_RECORD_ID','salesforceService','../../notifications/commit-to-git-completed.notification','decorate','repoService','deleteAttachment','name','1031136FmGvmV','info',']\x20[','CommitComponentsJob','../../providers/providers.tokens','repository','run','Tokens','isEmailNotificationsEnabled','getBranchRecord','gitUrl','salesforceSync','../../../../core/errors/bad-request.error','toUpperCase','length','commitJob','branchName','commitAttachmentId','FlosumCommitJob','SalesforceService','syncRepositoryId','Logger','handleCommitJobError','constructor','retrieveAttachment','components','all','Email\x20notifications\x20are\x20disabled.','1820787JVURax','20vXYwfE','config','FLOSUM_ATTACHMENT','object','completeNotification','getOne','2417040xGEinu','send','shortid','syncBranchId','design:paramtypes','prefix','BadRequestError','updateRemoteState','../dto/commit-components.dto','getComponentsToWrite','execute','search','gitProvider','[FLOSUM\x20->\x20GIT]\x20[','repo','2198IWHLZL','4120MxenAR','Container','split','In\x20Progress','6895190aeAElK','../../../../constants','repositoryData','user','errorNotification','../../salesforce/services/salesforce.service','repositoryName','\x20Start\x20Flosum\x20commit\x20job.','function','branches','commitData','updateLastCommit','__esModule','SalesforceRetrieverService','CommitComponentsDto','parse','logger','../../salesforce/services/salesforce-retriever.service','CommitToGitErrorNotification','../../notifications/commit-to-git-error.notification','isConvertToSfdx','122155NWpVsn','sfLogger','get','gitApiService','recordType',']\x20[Branch:\x20','getCommitDto','SalesforceSyncService'];a124_0x3f56=function(){return _0x4ed403;};return a124_0x3f56();}const core_1=require(a124_0x107d77(0x108)),salesforce_service_1=require(a124_0x107d77(0x163)),typedi_1=require(a124_0x107d77(0x11e)),errors_1=require('../../../../constants/errors'),bad_request_error_1=require(a124_0x107d77(0x133)),salesforce_retriever_service_1=require(a124_0x107d77(0x16f)),salesforce_sync_service_1=require(a124_0x107d77(0x113)),commit_components_dto_1=require(a124_0x107d77(0x152)),commit_components_job_1=require(a124_0x107d77(0x115)),constants_1=require(a124_0x107d77(0x15f)),shortid_1=__importDefault(require(a124_0x107d77(0x14c))),providers_tokens_1=require(a124_0x107d77(0x12b)),commit_to_git_completed_notification_1=require(a124_0x107d77(0x122)),commit_to_git_error_notification_1=require(a124_0x107d77(0x171));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x245321,_0x585c7d,_0x35de7c){const _0x46ffa4=a124_0x107d77;this[_0x46ffa4(0x121)]=_0x245321,this[_0x46ffa4(0x136)]=_0x585c7d,this[_0x46ffa4(0x132)]=_0x35de7c,this[_0x46ffa4(0x16e)]=new core_1[(_0x46ffa4(0x13c))](FlosumCommitJob_1[_0x46ffa4(0x126)]);}async[a124_0x107d77(0x148)](_0x43446b,_0x413913,_0x3db33d,_0x135a2a){const _0x401c8f=a124_0x107d77;if(!this[_0x401c8f(0x168)]['isEmailNotificationsEnabled']){this['logger'][_0x401c8f(0x128)](_0x401c8f(0x142));return;}await new commit_to_git_completed_notification_1['CommitToGitCompletedNotification']({'emails':_0x43446b,'gitProvider':_0x413913,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1[_0x401c8f(0x11c)][_0x401c8f(0x126)],'repositoryName':_0x3db33d,'branchName':_0x135a2a})[_0x401c8f(0x154)]();}async[a124_0x107d77(0x162)](_0x290ea3,_0x27125d,_0x5cf1c6,_0x1f94a9){const _0x33d5a2=a124_0x107d77;if(!this[_0x33d5a2(0x168)][_0x33d5a2(0x12f)]){this[_0x33d5a2(0x16e)][_0x33d5a2(0x128)]('Email\x20notifications\x20are\x20disabled.');return;}await new commit_to_git_error_notification_1[(_0x33d5a2(0x170))]({'emails':_0x290ea3,'gitProvider':_0x27125d,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0x33d5a2(0x170)][_0x33d5a2(0x126)],'repositoryName':_0x5cf1c6,'branchName':_0x1f94a9})[_0x33d5a2(0x154)]();}async[a124_0x107d77(0x114)](){const _0x24f84a=a124_0x107d77;try{if(this[_0x24f84a(0x168)][_0x24f84a(0x13b)])this[_0x24f84a(0x160)]=await this[_0x24f84a(0x132)][_0x24f84a(0x10b)](this[_0x24f84a(0x168)][_0x24f84a(0x13b)]);else this['commitData']['syncBranchId']&&(this[_0x24f84a(0x160)]=await this[_0x24f84a(0x132)][_0x24f84a(0x130)](this[_0x24f84a(0x168)][_0x24f84a(0x14d)]));}catch(_0x50d3c7){throw new bad_request_error_1[(_0x24f84a(0x150))](errors_1[_0x24f84a(0x120)]);}}async['getComponentsToWrite'](){const _0x59c3f0=a124_0x107d77;if(!this[_0x59c3f0(0x168)]['commitAttachmentId'])return[];await this['salesforceService']['patchObject'](constants_1[_0x59c3f0(0x146)],this[_0x59c3f0(0x168)][_0x59c3f0(0x138)],{'Name':(0x0,shortid_1[_0x59c3f0(0x11a)])()});const _0xc97d23=await this[_0x59c3f0(0x121)][_0x59c3f0(0x13f)](this[_0x59c3f0(0x168)][_0x59c3f0(0x138)])[_0x59c3f0(0x11f)](_0x39b9db=>_0x39b9db[_0x59c3f0(0x15c)]('\x20')['map'](_0x382f1c=>_0x382f1c[_0x59c3f0(0x119)]()));await this['salesforceService'][_0x59c3f0(0x125)](this[_0x59c3f0(0x168)][_0x59c3f0(0x138)]);const _0x3be207=new salesforce_retriever_service_1[(_0x59c3f0(0x16b))](this[_0x59c3f0(0x121)]);return await _0x3be207[_0x59c3f0(0x12d)](_0xc97d23);}async[a124_0x107d77(0x104)](){const _0x33aaca=a124_0x107d77;if(!this[_0x33aaca(0x168)][_0x33aaca(0x10f)])return[];await this[_0x33aaca(0x121)]['patchObject'](constants_1[_0x33aaca(0x146)],this[_0x33aaca(0x168)][_0x33aaca(0x10f)],{'Name':(0x0,shortid_1['default'])()});const _0x5b0ec3=await this[_0x33aaca(0x121)][_0x33aaca(0x13f)](this[_0x33aaca(0x168)][_0x33aaca(0x10f)]),_0x1a3854=JSON[_0x33aaca(0x16d)](_0x5b0ec3);return await this[_0x33aaca(0x121)]['deleteAttachment'](this['commitData'][_0x33aaca(0x10f)]),_0x1a3854;}async[a124_0x107d77(0x102)](){const _0x179688=a124_0x107d77,_0x5d5d83=new commit_components_dto_1[(_0x179688(0x16c))](),[_0x1d954c,_0x57930a]=await Promise[_0x179688(0x141)]([this[_0x179688(0x153)](),this[_0x179688(0x104)]()]);return _0x5d5d83[_0x179688(0x10d)]=this[_0x179688(0x168)]['message'],_0x5d5d83[_0x179688(0x161)]=this[_0x179688(0x168)][_0x179688(0x161)],_0x5d5d83[_0x179688(0x140)]={'writed':_0x1d954c,'deleted':_0x57930a},_0x5d5d83[_0x179688(0x10c)]=this[_0x179688(0x145)][_0x179688(0x172)],_0x5d5d83[_0x179688(0x158)]=this[_0x179688(0x12c)],_0x5d5d83[_0x179688(0x105)]=this[_0x179688(0x105)],_0x5d5d83[_0x179688(0x116)]=this[_0x179688(0x145)][_0x179688(0x156)],_0x5d5d83[_0x179688(0x100)]=this[_0x179688(0x160)][_0x179688(0x10e)],_0x5d5d83;}async[a124_0x107d77(0x169)](_0x4b37a7=![]){const _0x5e32f1=a124_0x107d77;if(_0x4b37a7)await this[_0x5e32f1(0x132)][_0x5e32f1(0x151)](this[_0x5e32f1(0x160)],{});else{const _0x310ec9=await this[_0x5e32f1(0x12c)]['branches'][_0x5e32f1(0x149)](this[_0x5e32f1(0x105)][_0x5e32f1(0x126)]);this[_0x5e32f1(0x174)][_0x5e32f1(0x11b)](this[_0x5e32f1(0x14f)]+'\x20Update\x20remote\x20state.');const _0x4888f0={[this[_0x5e32f1(0x12c)][_0x5e32f1(0x131)]]:{'lastCommit':_0x310ec9[_0x5e32f1(0x111)]}};await this[_0x5e32f1(0x132)][_0x5e32f1(0x151)](this[_0x5e32f1(0x160)],_0x4888f0);}}async['exec'](){const _0x3877e4=a124_0x107d77,_0x49378a=await this[_0x3877e4(0x102)]();await this['salesforceSync']['setStatus'](this[_0x3877e4(0x160)],_0x3877e4(0x15d)),await this[_0x3877e4(0x136)]['run'](_0x49378a,this[_0x3877e4(0x14f)]),await this[_0x3877e4(0x169)](),await this[_0x3877e4(0x132)][_0x3877e4(0x110)](this['repositoryData'],'Completed');}async[a124_0x107d77(0x13d)](_0x4f6c05){const _0x4e2cf1=a124_0x107d77;try{this['sfLogger']['error'](''+_0x4f6c05),await this['sfLogger'][_0x4e2cf1(0x14b)](),await this['updateLastCommit'](!![]),await this[_0x4e2cf1(0x132)][_0x4e2cf1(0x110)](this[_0x4e2cf1(0x160)],'Error'),await this[_0x4e2cf1(0x148)]([this['commitData'][_0x4e2cf1(0x161)]['email']],this[_0x4e2cf1(0x145)]['gitProvider'],this[_0x4e2cf1(0x12c)][_0x4e2cf1(0x126)],this['branch'][_0x4e2cf1(0x126)]);}catch(_0xfaa539){this['logger']['error'](_0xfaa539),await this[_0x4e2cf1(0x162)]([this[_0x4e2cf1(0x168)][_0x4e2cf1(0x161)][_0x4e2cf1(0x106)]],this[_0x4e2cf1(0x145)][_0x4e2cf1(0x156)],this[_0x4e2cf1(0x12c)]['name'],this['branch'][_0x4e2cf1(0x126)]);}}async[a124_0x107d77(0x12d)](_0x51238a){const _0x2ff5f9=a124_0x107d77;try{this[_0x2ff5f9(0x168)]=_0x51238a,this['gitApiService']=typedi_1['Container']['get'](providers_tokens_1[_0x2ff5f9(0x12e)][_0x2ff5f9(0xff)]),this['repoService']=typedi_1[_0x2ff5f9(0x15b)][_0x2ff5f9(0xfe)](providers_tokens_1[_0x2ff5f9(0x12e)]['gitRepoService']),this[_0x2ff5f9(0x145)]=typedi_1[_0x2ff5f9(0x15b)][_0x2ff5f9(0xfe)](providers_tokens_1[_0x2ff5f9(0x12e)][_0x2ff5f9(0x145)]),await this[_0x2ff5f9(0x114)](),this['repository']=await this[_0x2ff5f9(0x124)]['getOne'](this[_0x2ff5f9(0x160)]['repositoryName']),this[_0x2ff5f9(0x105)]=await this[_0x2ff5f9(0x12c)][_0x2ff5f9(0x167)][_0x2ff5f9(0x149)](this[_0x2ff5f9(0x160)][_0x2ff5f9(0x137)]),this[_0x2ff5f9(0x174)]=typedi_1[_0x2ff5f9(0x15b)]['get'](providers_tokens_1['Tokens'][_0x2ff5f9(0x16e)]),this[_0x2ff5f9(0x14f)]=_0x2ff5f9(0x157)+this[_0x2ff5f9(0x145)]['gitProvider'][_0x2ff5f9(0x134)]()+_0x2ff5f9(0x117)+this[_0x2ff5f9(0x160)][_0x2ff5f9(0x164)]+_0x2ff5f9(0x101)+this[_0x2ff5f9(0x160)]['branchName']+_0x2ff5f9(0x129)+FlosumCommitJob_1[_0x2ff5f9(0x126)]+']';if(!this[_0x2ff5f9(0x160)])throw new bad_request_error_1[(_0x2ff5f9(0x150))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x2ff5f9(0x174)][_0x2ff5f9(0x11b)](this[_0x2ff5f9(0x14f)]+_0x2ff5f9(0x165))[_0x2ff5f9(0x14b)](),await this[_0x2ff5f9(0x118)]()['catch'](_0x4b74b0=>this[_0x2ff5f9(0x13d)](_0x4b74b0)),await this[_0x2ff5f9(0x148)]([this[_0x2ff5f9(0x168)][_0x2ff5f9(0x161)][_0x2ff5f9(0x106)]],this[_0x2ff5f9(0x145)][_0x2ff5f9(0x156)],this['repository'][_0x2ff5f9(0x126)],this['branch']['name']);}catch(_0x131baa){this[_0x2ff5f9(0x168)]=undefined,this['logger']['error'](_0x131baa),await this[_0x2ff5f9(0x162)]([this[_0x2ff5f9(0x168)]['user']['email']],this[_0x2ff5f9(0x145)][_0x2ff5f9(0x156)],this[_0x2ff5f9(0x12c)][_0x2ff5f9(0x126)],this[_0x2ff5f9(0x105)][_0x2ff5f9(0x126)]);throw _0x131baa;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a124_0x107d77(0x14e),[salesforce_service_1[a124_0x107d77(0x13a)],commit_components_job_1[a124_0x107d77(0x12a)],salesforce_sync_service_1[a124_0x107d77(0x103)]])],FlosumCommitJob),exports[a124_0x107d77(0x139)]=FlosumCommitJob;