const a126_0xc67636=a126_0x2439;(function(_0x584735,_0x43b417){const _0x266d59=a126_0x2439,_0x14933f=_0x584735();while(!![]){try{const _0x16f60e=parseInt(_0x266d59(0xd0))/0x1*(parseInt(_0x266d59(0xd8))/0x2)+-parseInt(_0x266d59(0xf0))/0x3*(parseInt(_0x266d59(0xb5))/0x4)+parseInt(_0x266d59(0xe3))/0x5*(-parseInt(_0x266d59(0xe0))/0x6)+-parseInt(_0x266d59(0xbb))/0x7+parseInt(_0x266d59(0xbd))/0x8*(-parseInt(_0x266d59(0xe1))/0x9)+parseInt(_0x266d59(0xf8))/0xa+-parseInt(_0x266d59(0xa0))/0xb*(-parseInt(_0x266d59(0xc3))/0xc);if(_0x16f60e===_0x43b417)break;else _0x14933f['push'](_0x14933f['shift']());}catch(_0x455202){_0x14933f['push'](_0x14933f['shift']());}}}(a126_0x138d,0xdb5ec));const a126_0x545f6b=(function(){let _0x4e705e=!![];return function(_0x4d7d17,_0x153042){const _0x20c3a2=_0x4e705e?function(){if(_0x153042){const _0x6b39f8=_0x153042['apply'](_0x4d7d17,arguments);return _0x153042=null,_0x6b39f8;}}:function(){};return _0x4e705e=![],_0x20c3a2;};}()),a126_0x3f49bd=a126_0x545f6b(this,function(){const _0x1aaab6=a126_0x2439;return a126_0x3f49bd['toString']()[_0x1aaab6(0xd5)]('(((.+)+)+)+$')[_0x1aaab6(0xe2)]()[_0x1aaab6(0xa3)](a126_0x3f49bd)[_0x1aaab6(0xd5)]('(((.+)+)+)+$');});a126_0x3f49bd();function a126_0x138d(){const _0x4becd9=['getBranchRecord','completeNotification','toUpperCase','components','error','decorate','branch','updateLastCommit','FLOSUM_ATTACHMENT','repositoryData','14837317xfnczh','__esModule','ERR_INVALID_SYNC_RECORD_ID','constructor','syncRepositoryId','../../notifications/commit-to-git-error.notification','getRepositoryRecord','syncBranchId','send','handleCommitJobError','repositoryName','patchObject','run','fetchRepositoryData','sha','In\x20Progress','Email\x20notifications\x20are\x20disabled.','defineProperty','split','FlosumCommitJob','commitAttachmentId','4TzgeJI','repo','Tokens','../dto/commit-components.dto','repository','all','1997142nklgLV','retrieveAttachment','16qXsGuB','name','recordType',']\x20[','logger','map','36emmxIW','user','length','email','message','BadRequestError','SalesforceRetrieverService','../../../../core/errors/bad-request.error','salesforceService',']\x20[Branch:\x20','config','gitApiService','prefix','7699haucwb','sfLogger','gitRepoService','commitJob','errorNotification','search','../../salesforce/services/salesforce-retriever.service','commitData','4DmPfnc','deleteAttachment','./commit-components.job','salesforceSync','CommitComponentsJob','branchName','execute','deleteAttachmentId','204xrlEyN','6828849wRFvax','toString','48025HhAHGK','../../../../constants/errors','metadata','../../notifications/commit-to-git-completed.notification','Logger','../../../../constants','../../../../core','CommitToGitErrorNotification','then',']\x20[Repository:\x20','repoService','[FLOSUM\x20->\x20GIT]\x20[','branches','5052282wyXbFJ','../../salesforce/services/salesforce.service','isConvertToSfdx','setStatus','trim','updateRemoteState','gitProvider','exec','6500930QPYfDl','__metadata','__importDefault','default','getComponentsToDelete','getOne','catch','\x20Update\x20remote\x20state.','Container','get','Service','SalesforceService','getCommitDto','getComponentsToWrite','SalesforceSyncService','function','recordTypeName','provider','CommitToGitCompletedNotification'];a126_0x138d=function(){return _0x4becd9;};return a126_0x138d();}'use strict';var __decorate=this&&this['__decorate']||function(_0x18ecc5,_0x4dbeef,_0x56c823,_0x5eeda2){const _0x2487ac=a126_0x2439;var _0x2a9c16=arguments[_0x2487ac(0xc5)],_0x2d8d31=_0x2a9c16<0x3?_0x4dbeef:_0x5eeda2===null?_0x5eeda2=Object['getOwnPropertyDescriptor'](_0x4dbeef,_0x56c823):_0x5eeda2,_0xe0aba5;if(typeof Reflect==='object'&&typeof Reflect[_0x2487ac(0x9b)]==='function')_0x2d8d31=Reflect[_0x2487ac(0x9b)](_0x18ecc5,_0x4dbeef,_0x56c823,_0x5eeda2);else{for(var _0x39812f=_0x18ecc5[_0x2487ac(0xc5)]-0x1;_0x39812f>=0x0;_0x39812f--)if(_0xe0aba5=_0x18ecc5[_0x39812f])_0x2d8d31=(_0x2a9c16<0x3?_0xe0aba5(_0x2d8d31):_0x2a9c16>0x3?_0xe0aba5(_0x4dbeef,_0x56c823,_0x2d8d31):_0xe0aba5(_0x4dbeef,_0x56c823))||_0x2d8d31;}return _0x2a9c16>0x3&&_0x2d8d31&&Object['defineProperty'](_0x4dbeef,_0x56c823,_0x2d8d31),_0x2d8d31;},__metadata=this&&this[a126_0xc67636(0xf9)]||function(_0x14765e,_0x1c2614){const _0x54c7e2=a126_0xc67636;if(typeof Reflect==='object'&&typeof Reflect[_0x54c7e2(0xe5)]===_0x54c7e2(0x92))return Reflect[_0x54c7e2(0xe5)](_0x14765e,_0x1c2614);},__importDefault=this&&this[a126_0xc67636(0xfa)]||function(_0x395b00){return _0x395b00&&_0x395b00['__esModule']?_0x395b00:{'default':_0x395b00};},FlosumCommitJob_1;Object[a126_0xc67636(0xb1)](exports,a126_0xc67636(0xa1),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a126_0xc67636(0xe9)),salesforce_service_1=require(a126_0xc67636(0xf1)),typedi_1=require('typedi'),errors_1=require(a126_0xc67636(0xe4)),bad_request_error_1=require(a126_0xc67636(0xca)),salesforce_retriever_service_1=require(a126_0xc67636(0xd6)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a126_0xc67636(0xb8)),commit_components_job_1=require(a126_0xc67636(0xda)),constants_1=require(a126_0xc67636(0xe8)),shortid_1=__importDefault(require('shortid')),providers_tokens_1=require('../../providers/providers.tokens'),commit_to_git_completed_notification_1=require(a126_0xc67636(0xe6)),commit_to_git_error_notification_1=require(a126_0xc67636(0xa5));function a126_0x2439(_0x55210a,_0x12cd61){const _0x4879d3=a126_0x138d();return a126_0x2439=function(_0x3f49bd,_0x545f6b){_0x3f49bd=_0x3f49bd-0x8b;let _0x138d44=_0x4879d3[_0x3f49bd];return _0x138d44;},a126_0x2439(_0x55210a,_0x12cd61);}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x1db532,_0x36ecc9,_0x3b70e1){const _0x6a8db=a126_0xc67636;this[_0x6a8db(0xcb)]=_0x1db532,this[_0x6a8db(0xd3)]=_0x36ecc9,this[_0x6a8db(0xdb)]=_0x3b70e1,this[_0x6a8db(0xc1)]=new core_1[(_0x6a8db(0xe7))](FlosumCommitJob_1[_0x6a8db(0xbe)]);}async['completeNotification'](_0x13f975,_0x31af80,_0x383213,_0x405fb1){const _0x3e4651=a126_0xc67636;if(!this[_0x3e4651(0xd7)]['isEmailNotificationsEnabled']){this[_0x3e4651(0xc1)]['info'](_0x3e4651(0xb0));return;}await new commit_to_git_completed_notification_1[(_0x3e4651(0x95))]({'emails':_0x13f975,'gitProvider':_0x31af80,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1[_0x3e4651(0x95)][_0x3e4651(0xbe)],'repositoryName':_0x383213,'branchName':_0x405fb1})[_0x3e4651(0xde)]();}async[a126_0xc67636(0xd4)](_0x22d0b8,_0x3244fe,_0xc25146,_0xac78b9){const _0x435a97=a126_0xc67636;if(!this[_0x435a97(0xd7)]['isEmailNotificationsEnabled']){this[_0x435a97(0xc1)]['info'](_0x435a97(0xb0));return;}await new commit_to_git_error_notification_1[(_0x435a97(0xea))]({'emails':_0x22d0b8,'gitProvider':_0x3244fe,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0x435a97(0xea)][_0x435a97(0xbe)],'repositoryName':_0xc25146,'branchName':_0xac78b9})[_0x435a97(0xde)]();}async['fetchRepositoryData'](){const _0x198260=a126_0xc67636;try{if(this[_0x198260(0xd7)]['syncRepositoryId'])this[_0x198260(0x9f)]=await this[_0x198260(0xdb)][_0x198260(0xa6)](this['commitData'][_0x198260(0xa4)]);else this['commitData'][_0x198260(0xa7)]&&(this['repositoryData']=await this[_0x198260(0xdb)][_0x198260(0x96)](this[_0x198260(0xd7)]['syncBranchId']));}catch(_0x276f0a){throw new bad_request_error_1['BadRequestError'](errors_1[_0x198260(0xa2)]);}}async[a126_0xc67636(0x90)](){const _0x8c8bdb=a126_0xc67636;if(!this[_0x8c8bdb(0xd7)][_0x8c8bdb(0xb4)])return[];await this[_0x8c8bdb(0xcb)][_0x8c8bdb(0xab)](constants_1[_0x8c8bdb(0x9e)],this[_0x8c8bdb(0xd7)][_0x8c8bdb(0xb4)],{'Name':(0x0,shortid_1[_0x8c8bdb(0xfb)])()});const _0x10de69=await this['salesforceService'][_0x8c8bdb(0xbc)](this['commitData']['commitAttachmentId'])[_0x8c8bdb(0xeb)](_0x4d1de2=>_0x4d1de2[_0x8c8bdb(0xb2)]('\x20')[_0x8c8bdb(0xc2)](_0x4f79f6=>_0x4f79f6[_0x8c8bdb(0xf4)]()));await this[_0x8c8bdb(0xcb)][_0x8c8bdb(0xd9)](this[_0x8c8bdb(0xd7)][_0x8c8bdb(0xb4)]);const _0x5e5387=new salesforce_retriever_service_1[(_0x8c8bdb(0xc9))](this[_0x8c8bdb(0xcb)]);return await _0x5e5387[_0x8c8bdb(0xac)](_0x10de69);}async[a126_0xc67636(0xfc)](){const _0x5f0e07=a126_0xc67636;if(!this['commitData'][_0x5f0e07(0xdf)])return[];await this[_0x5f0e07(0xcb)][_0x5f0e07(0xab)](constants_1[_0x5f0e07(0x9e)],this[_0x5f0e07(0xd7)][_0x5f0e07(0xdf)],{'Name':(0x0,shortid_1[_0x5f0e07(0xfb)])()});const _0x107187=await this[_0x5f0e07(0xcb)][_0x5f0e07(0xbc)](this[_0x5f0e07(0xd7)]['deleteAttachmentId']),_0x1ea8b1=JSON['parse'](_0x107187);return await this[_0x5f0e07(0xcb)][_0x5f0e07(0xd9)](this[_0x5f0e07(0xd7)][_0x5f0e07(0xdf)]),_0x1ea8b1;}async[a126_0xc67636(0x8f)](){const _0x21cabb=a126_0xc67636,_0x4d73eb=new commit_components_dto_1['CommitComponentsDto'](),[_0x4bacfb,_0x277440]=await Promise[_0x21cabb(0xba)]([this[_0x21cabb(0x90)](),this['getComponentsToDelete']()]);return _0x4d73eb['message']=this[_0x21cabb(0xd7)][_0x21cabb(0xc7)],_0x4d73eb[_0x21cabb(0xc4)]=this['commitData'][_0x21cabb(0xc4)],_0x4d73eb[_0x21cabb(0x99)]={'writed':_0x4bacfb,'deleted':_0x277440},_0x4d73eb['convertToSFDX']=this[_0x21cabb(0xcd)][_0x21cabb(0xf2)],_0x4d73eb[_0x21cabb(0xb6)]=this[_0x21cabb(0xb9)],_0x4d73eb[_0x21cabb(0x9c)]=this['branch'],_0x4d73eb[_0x21cabb(0x94)]=this[_0x21cabb(0xcd)][_0x21cabb(0xf6)],_0x4d73eb[_0x21cabb(0xbf)]=this[_0x21cabb(0x9f)][_0x21cabb(0x93)],_0x4d73eb;}async[a126_0xc67636(0x9d)](_0x50c02f=![]){const _0x5121d0=a126_0xc67636;if(_0x50c02f)await this[_0x5121d0(0xdb)]['updateRemoteState'](this[_0x5121d0(0x9f)],{});else{const _0x235fb4=await this[_0x5121d0(0xb9)][_0x5121d0(0xef)][_0x5121d0(0xfd)](this[_0x5121d0(0x9c)]['name']);this[_0x5121d0(0xd1)]['log'](this['prefix']+_0x5121d0(0xff));const _0x1a0424={[this[_0x5121d0(0xb9)]['gitUrl']]:{'lastCommit':_0x235fb4[_0x5121d0(0xae)]}};await this[_0x5121d0(0xdb)][_0x5121d0(0xf5)](this['repositoryData'],_0x1a0424);}}async['exec'](){const _0x1bf016=a126_0xc67636,_0x272729=await this['getCommitDto']();await this[_0x1bf016(0xdb)][_0x1bf016(0xf3)](this[_0x1bf016(0x9f)],_0x1bf016(0xaf)),await this['commitJob']['run'](_0x272729,this['prefix']),await this[_0x1bf016(0x9d)](),await this[_0x1bf016(0xdb)][_0x1bf016(0xf3)](this[_0x1bf016(0x9f)],'Completed');}async[a126_0xc67636(0xa9)](_0x12f4ad){const _0x4f47b4=a126_0xc67636;try{this[_0x4f47b4(0xd1)][_0x4f47b4(0x9a)](''+_0x12f4ad),await this[_0x4f47b4(0xd1)][_0x4f47b4(0xa8)](),await this['updateLastCommit'](!![]),await this[_0x4f47b4(0xdb)]['setStatus'](this[_0x4f47b4(0x9f)],'Error'),await this[_0x4f47b4(0x97)]([this[_0x4f47b4(0xd7)][_0x4f47b4(0xc4)][_0x4f47b4(0xc6)]],this[_0x4f47b4(0xcd)][_0x4f47b4(0xf6)],this['repository']['name'],this[_0x4f47b4(0x9c)][_0x4f47b4(0xbe)]);}catch(_0x112fd0){this['logger']['error'](_0x112fd0),await this[_0x4f47b4(0xd4)]([this[_0x4f47b4(0xd7)][_0x4f47b4(0xc4)][_0x4f47b4(0xc6)]],this[_0x4f47b4(0xcd)][_0x4f47b4(0xf6)],this[_0x4f47b4(0xb9)][_0x4f47b4(0xbe)],this[_0x4f47b4(0x9c)]['name']);}}async[a126_0xc67636(0xac)](_0x54e46b){const _0x2158c8=a126_0xc67636;try{this['commitData']=_0x54e46b,this['gitApiService']=typedi_1[_0x2158c8(0x8b)][_0x2158c8(0x8c)](providers_tokens_1['Tokens'][_0x2158c8(0xce)]),this[_0x2158c8(0xed)]=typedi_1[_0x2158c8(0x8b)]['get'](providers_tokens_1['Tokens'][_0x2158c8(0xd2)]),this['config']=typedi_1[_0x2158c8(0x8b)][_0x2158c8(0x8c)](providers_tokens_1[_0x2158c8(0xb7)][_0x2158c8(0xcd)]),await this[_0x2158c8(0xad)](),this[_0x2158c8(0xb9)]=await this[_0x2158c8(0xed)][_0x2158c8(0xfd)](this[_0x2158c8(0x9f)][_0x2158c8(0xaa)]),this['branch']=await this[_0x2158c8(0xb9)]['branches'][_0x2158c8(0xfd)](this[_0x2158c8(0x9f)][_0x2158c8(0xdd)]),this[_0x2158c8(0xd1)]=typedi_1[_0x2158c8(0x8b)][_0x2158c8(0x8c)](providers_tokens_1[_0x2158c8(0xb7)][_0x2158c8(0xc1)]),this[_0x2158c8(0xcf)]=_0x2158c8(0xee)+this['config'][_0x2158c8(0xf6)][_0x2158c8(0x98)]()+_0x2158c8(0xec)+this[_0x2158c8(0x9f)][_0x2158c8(0xaa)]+_0x2158c8(0xcc)+this[_0x2158c8(0x9f)]['branchName']+_0x2158c8(0xc0)+FlosumCommitJob_1[_0x2158c8(0xbe)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x2158c8(0xc8))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x2158c8(0xd1)]['log'](this[_0x2158c8(0xcf)]+'\x20Start\x20Flosum\x20commit\x20job.')[_0x2158c8(0xa8)](),await this[_0x2158c8(0xf7)]()[_0x2158c8(0xfe)](_0x4a6ee9=>this['handleCommitJobError'](_0x4a6ee9)),await this[_0x2158c8(0x97)]([this[_0x2158c8(0xd7)][_0x2158c8(0xc4)][_0x2158c8(0xc6)]],this['config'][_0x2158c8(0xf6)],this[_0x2158c8(0xb9)]['name'],this[_0x2158c8(0x9c)][_0x2158c8(0xbe)]);}catch(_0x4c7239){this['commitData']=undefined,this['logger'][_0x2158c8(0x9a)](_0x4c7239),await this['errorNotification']([this[_0x2158c8(0xd7)]['user']['email']],this[_0x2158c8(0xcd)][_0x2158c8(0xf6)],this[_0x2158c8(0xb9)]['name'],this[_0x2158c8(0x9c)][_0x2158c8(0xbe)]);throw _0x4c7239;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a126_0xc67636(0x8d)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a126_0xc67636(0x8e)],commit_components_job_1[a126_0xc67636(0xdc)],salesforce_sync_service_1[a126_0xc67636(0x91)]])],FlosumCommitJob),exports[a126_0xc67636(0xb3)]=FlosumCommitJob;