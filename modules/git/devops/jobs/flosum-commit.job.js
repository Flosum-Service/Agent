const a125_0x5e83c7=a125_0x54bc;(function(_0xa6b68e,_0x3a30d0){const _0x1ccdf6=a125_0x54bc,_0x5b05cb=_0xa6b68e();while(!![]){try{const _0x234015=-parseInt(_0x1ccdf6(0xfe))/0x1*(parseInt(_0x1ccdf6(0xf9))/0x2)+parseInt(_0x1ccdf6(0x13b))/0x3*(-parseInt(_0x1ccdf6(0x10b))/0x4)+parseInt(_0x1ccdf6(0x114))/0x5*(-parseInt(_0x1ccdf6(0x12f))/0x6)+parseInt(_0x1ccdf6(0x145))/0x7*(-parseInt(_0x1ccdf6(0x118))/0x8)+parseInt(_0x1ccdf6(0xfc))/0x9+-parseInt(_0x1ccdf6(0x106))/0xa*(parseInt(_0x1ccdf6(0x124))/0xb)+-parseInt(_0x1ccdf6(0x108))/0xc*(-parseInt(_0x1ccdf6(0xf0))/0xd);if(_0x234015===_0x3a30d0)break;else _0x5b05cb['push'](_0x5b05cb['shift']());}catch(_0x883feb){_0x5b05cb['push'](_0x5b05cb['shift']());}}}(a125_0x425a,0x91ca1));const a125_0x57496d=(function(){let _0x4794a5=!![];return function(_0x562b4b,_0x548df5){const _0x1a8497=_0x4794a5?function(){if(_0x548df5){const _0x154328=_0x548df5['apply'](_0x562b4b,arguments);return _0x548df5=null,_0x154328;}}:function(){};return _0x4794a5=![],_0x1a8497;};}()),a125_0x4b9200=a125_0x57496d(this,function(){const _0x48e579=a125_0x54bc;return a125_0x4b9200[_0x48e579(0x12e)]()['search'](_0x48e579(0x123))[_0x48e579(0x12e)]()[_0x48e579(0xf3)](a125_0x4b9200)[_0x48e579(0x137)]('(((.+)+)+)+$');});function a125_0x425a(){const _0x395abc=['commitData','Service','getOne','recordTypeName','repositoryData','name','branchName','handleCommitJobError','FlosumCommitJob','split','__esModule','deleteAttachment','default','__importDefault','1284803gsMLzV','repositoryName','gitProvider','constructor','repoService','./commit-components.job','Tokens','config','isEmailNotificationsEnabled','170CZMnic','Email\x20notifications\x20are\x20disabled.','prefix','4452129cWyTpX','send','12763VQgXYW','Error','../../../../core/errors/bad-request.error','execute','log','In\x20Progress','SalesforceSyncService','\x20Update\x20remote\x20state.','9090RFurdz','getOwnPropertyDescriptor','468MoyVQm','branch','getComponentsToDelete','8VcSssC','Completed','[FLOSUM\x20->\x20GIT]\x20[','completeNotification','repo','__metadata','decorate','object','patchObject','1360880MyFndC','../../providers/providers.tokens','provider','../../../../constants','662472XzvJqs','exec','info','SalesforceService','getComponentsToWrite','Container','../../../../constants/errors','retrieveAttachment','deleteAttachmentId',']\x20[Branch:\x20','commitJob','(((.+)+)+)+$','2684WeGxof',']\x20[','gitApiService','run','../../notifications/commit-to-git-error.notification','getCommitDto','trim','branches','map','metadata','toString','24bWmYut','user','syncRepositoryId',']\x20[Repository:\x20','all','../../../../core','recordType','toUpperCase','search','setStatus','design:paramtypes','typedi','1786446LAYrbo','__decorate','defineProperty','logger','get','syncBranchId','getRepositoryRecord','../dto/commit-components.dto','errorNotification','commitAttachmentId','14cZUcMu','message','email','fetchRepositoryData','sha','salesforceSync','CommitComponentsJob','error','updateRemoteState','BadRequestError','FLOSUM_ATTACHMENT','parse','\x20Start\x20Flosum\x20commit\x20job.','salesforceService','length','gitRepoService','sfLogger','getBranchRecord','repository','CommitToGitErrorNotification'];a125_0x425a=function(){return _0x395abc;};return a125_0x425a();}a125_0x4b9200();'use strict';var __decorate=this&&this[a125_0x5e83c7(0x13c)]||function(_0x14e4be,_0x3f4889,_0x444d22,_0x1ee8ce){const _0x340e6f=a125_0x5e83c7;var _0x10351e=arguments[_0x340e6f(0x153)],_0x57abfb=_0x10351e<0x3?_0x3f4889:_0x1ee8ce===null?_0x1ee8ce=Object[_0x340e6f(0x107)](_0x3f4889,_0x444d22):_0x1ee8ce,_0x148ba8;if(typeof Reflect===_0x340e6f(0x112)&&typeof Reflect[_0x340e6f(0x111)]==='function')_0x57abfb=Reflect[_0x340e6f(0x111)](_0x14e4be,_0x3f4889,_0x444d22,_0x1ee8ce);else{for(var _0xe799fd=_0x14e4be[_0x340e6f(0x153)]-0x1;_0xe799fd>=0x0;_0xe799fd--)if(_0x148ba8=_0x14e4be[_0xe799fd])_0x57abfb=(_0x10351e<0x3?_0x148ba8(_0x57abfb):_0x10351e>0x3?_0x148ba8(_0x3f4889,_0x444d22,_0x57abfb):_0x148ba8(_0x3f4889,_0x444d22))||_0x57abfb;}return _0x10351e>0x3&&_0x57abfb&&Object[_0x340e6f(0x13d)](_0x3f4889,_0x444d22,_0x57abfb),_0x57abfb;},__metadata=this&&this[a125_0x5e83c7(0x110)]||function(_0x4b33fb,_0x417eac){const _0x11098e=a125_0x5e83c7;if(typeof Reflect===_0x11098e(0x112)&&typeof Reflect[_0x11098e(0x12d)]==='function')return Reflect['metadata'](_0x4b33fb,_0x417eac);},__importDefault=this&&this[a125_0x5e83c7(0xef)]||function(_0x217f46){return _0x217f46&&_0x217f46['__esModule']?_0x217f46:{'default':_0x217f46};},FlosumCommitJob_1;Object['defineProperty'](exports,a125_0x5e83c7(0xec),{'value':!![]}),exports[a125_0x5e83c7(0xea)]=void 0x0;function a125_0x54bc(_0x105bf7,_0x56963c){const _0x56a996=a125_0x425a();return a125_0x54bc=function(_0x4b9200,_0x57496d){_0x4b9200=_0x4b9200-0xe4;let _0x425a15=_0x56a996[_0x4b9200];return _0x425a15;},a125_0x54bc(_0x105bf7,_0x56963c);}const core_1=require(a125_0x5e83c7(0x134)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a125_0x5e83c7(0x13a)),errors_1=require(a125_0x5e83c7(0x11e)),bad_request_error_1=require(a125_0x5e83c7(0x100)),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a125_0x5e83c7(0x142)),commit_components_job_1=require(a125_0x5e83c7(0xf5)),constants_1=require(a125_0x5e83c7(0x117)),shortid_1=__importDefault(require('shortid')),providers_tokens_1=require(a125_0x5e83c7(0x115)),commit_to_git_completed_notification_1=require('../../notifications/commit-to-git-completed.notification'),commit_to_git_error_notification_1=require(a125_0x5e83c7(0x128));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x260696,_0x509eca,_0xeca649){const _0x4d9e0=a125_0x5e83c7;this[_0x4d9e0(0x152)]=_0x260696,this[_0x4d9e0(0x122)]=_0x509eca,this['salesforceSync']=_0xeca649,this[_0x4d9e0(0x13e)]=new core_1['Logger'](FlosumCommitJob_1[_0x4d9e0(0xe7)]);}async[a125_0x5e83c7(0x10e)](_0x50a162,_0x593138,_0x42b5c1,_0x1a139e){const _0xe43f9d=a125_0x5e83c7;if(!this[_0xe43f9d(0x159)][_0xe43f9d(0xf8)]){this['logger']['info'](_0xe43f9d(0xfa));return;}await new commit_to_git_completed_notification_1['CommitToGitCompletedNotification']({'emails':_0x50a162,'gitProvider':_0x593138,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1['CommitToGitCompletedNotification'][_0xe43f9d(0xe7)],'repositoryName':_0x42b5c1,'branchName':_0x1a139e})[_0xe43f9d(0x101)]();}async[a125_0x5e83c7(0x143)](_0x21c530,_0x19ce63,_0x2723ea,_0x32febe){const _0x43754c=a125_0x5e83c7;if(!this['commitData'][_0x43754c(0xf8)]){this['logger'][_0x43754c(0x11a)](_0x43754c(0xfa));return;}await new commit_to_git_error_notification_1[(_0x43754c(0x158))]({'emails':_0x21c530,'gitProvider':_0x19ce63,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0x43754c(0x158)][_0x43754c(0xe7)],'repositoryName':_0x2723ea,'branchName':_0x32febe})['execute']();}async['fetchRepositoryData'](){const _0x17981e=a125_0x5e83c7;try{if(this[_0x17981e(0x159)]['syncRepositoryId'])this['repositoryData']=await this[_0x17981e(0x14a)][_0x17981e(0x141)](this[_0x17981e(0x159)][_0x17981e(0x131)]);else this['commitData'][_0x17981e(0x140)]&&(this['repositoryData']=await this[_0x17981e(0x14a)][_0x17981e(0x156)](this[_0x17981e(0x159)][_0x17981e(0x140)]));}catch(_0x377547){throw new bad_request_error_1[(_0x17981e(0x14e))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a125_0x5e83c7(0x11c)](){const _0x1a26af=a125_0x5e83c7;if(!this[_0x1a26af(0x159)][_0x1a26af(0x144)])return[];await this['salesforceService'][_0x1a26af(0x113)](constants_1['FLOSUM_ATTACHMENT'],this[_0x1a26af(0x159)][_0x1a26af(0x144)],{'Name':(0x0,shortid_1[_0x1a26af(0xee)])()});const _0x5f0a2f=await this[_0x1a26af(0x152)][_0x1a26af(0x11f)](this[_0x1a26af(0x159)]['commitAttachmentId'])['then'](_0x318a6c=>_0x318a6c[_0x1a26af(0xeb)]('\x20')[_0x1a26af(0x12c)](_0x21b546=>_0x21b546[_0x1a26af(0x12a)]()));await this[_0x1a26af(0x152)][_0x1a26af(0xed)](this[_0x1a26af(0x159)][_0x1a26af(0x144)]);const _0x582315=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x1a26af(0x152)]);return await _0x582315[_0x1a26af(0x127)](_0x5f0a2f);}async[a125_0x5e83c7(0x10a)](){const _0x152b1b=a125_0x5e83c7;if(!this['commitData'][_0x152b1b(0x120)])return[];await this[_0x152b1b(0x152)][_0x152b1b(0x113)](constants_1[_0x152b1b(0x14f)],this[_0x152b1b(0x159)]['deleteAttachmentId'],{'Name':(0x0,shortid_1['default'])()});const _0x3f2b18=await this[_0x152b1b(0x152)][_0x152b1b(0x11f)](this[_0x152b1b(0x159)]['deleteAttachmentId']),_0x37a09d=JSON[_0x152b1b(0x150)](_0x3f2b18);return await this[_0x152b1b(0x152)][_0x152b1b(0xed)](this[_0x152b1b(0x159)][_0x152b1b(0x120)]),_0x37a09d;}async[a125_0x5e83c7(0x129)](){const _0x5b6237=a125_0x5e83c7,_0x140a28=new commit_components_dto_1['CommitComponentsDto'](),[_0x263f1a,_0xf8116]=await Promise[_0x5b6237(0x133)]([this[_0x5b6237(0x11c)](),this[_0x5b6237(0x10a)]()]);return _0x140a28[_0x5b6237(0x146)]=this[_0x5b6237(0x159)][_0x5b6237(0x146)],_0x140a28[_0x5b6237(0x130)]=this[_0x5b6237(0x159)][_0x5b6237(0x130)],_0x140a28['components']={'writed':_0x263f1a,'deleted':_0xf8116},_0x140a28['convertToSFDX']=this[_0x5b6237(0xf7)]['isConvertToSfdx'],_0x140a28[_0x5b6237(0x10f)]=this[_0x5b6237(0x157)],_0x140a28[_0x5b6237(0x109)]=this[_0x5b6237(0x109)],_0x140a28[_0x5b6237(0x116)]=this[_0x5b6237(0xf7)][_0x5b6237(0xf2)],_0x140a28[_0x5b6237(0x135)]=this['repositoryData'][_0x5b6237(0xe5)],_0x140a28;}async['updateLastCommit'](_0x4a666d=![]){const _0x4e10ab=a125_0x5e83c7;if(_0x4a666d)await this[_0x4e10ab(0x14a)]['updateRemoteState'](this['repositoryData'],{});else{const _0x5dfc71=await this['repository'][_0x4e10ab(0x12b)][_0x4e10ab(0xe4)](this[_0x4e10ab(0x109)]['name']);this['sfLogger'][_0x4e10ab(0x102)](this['prefix']+_0x4e10ab(0x105));const _0x1923b7={[this['repository']['gitUrl']]:{'lastCommit':_0x5dfc71[_0x4e10ab(0x149)]}};await this['salesforceSync'][_0x4e10ab(0x14d)](this[_0x4e10ab(0xe6)],_0x1923b7);}}async['exec'](){const _0x5069f1=a125_0x5e83c7,_0x16b761=await this[_0x5069f1(0x129)]();await this[_0x5069f1(0x14a)][_0x5069f1(0x138)](this[_0x5069f1(0xe6)],_0x5069f1(0x103)),await this[_0x5069f1(0x122)][_0x5069f1(0x127)](_0x16b761,this[_0x5069f1(0xfb)]),await this['updateLastCommit'](),await this[_0x5069f1(0x14a)][_0x5069f1(0x138)](this['repositoryData'],_0x5069f1(0x10c));}async['handleCommitJobError'](_0x47f96f){const _0x48b9ff=a125_0x5e83c7;try{this[_0x48b9ff(0x155)][_0x48b9ff(0x14c)](''+_0x47f96f),await this[_0x48b9ff(0x155)][_0x48b9ff(0xfd)](),await this['updateLastCommit'](!![]),await this['salesforceSync'][_0x48b9ff(0x138)](this[_0x48b9ff(0xe6)],_0x48b9ff(0xff)),await this[_0x48b9ff(0x10e)]([this['commitData'][_0x48b9ff(0x130)][_0x48b9ff(0x147)]],this[_0x48b9ff(0xf7)][_0x48b9ff(0xf2)],this[_0x48b9ff(0x157)][_0x48b9ff(0xe7)],this[_0x48b9ff(0x109)][_0x48b9ff(0xe7)]);}catch(_0x225b64){this[_0x48b9ff(0x13e)][_0x48b9ff(0x14c)](_0x225b64),await this['errorNotification']([this[_0x48b9ff(0x159)]['user']['email']],this[_0x48b9ff(0xf7)][_0x48b9ff(0xf2)],this[_0x48b9ff(0x157)]['name'],this[_0x48b9ff(0x109)]['name']);}}async[a125_0x5e83c7(0x127)](_0xdc5f3d){const _0x1f483d=a125_0x5e83c7;try{this[_0x1f483d(0x159)]=_0xdc5f3d,this[_0x1f483d(0x126)]=typedi_1[_0x1f483d(0x11d)][_0x1f483d(0x13f)](providers_tokens_1[_0x1f483d(0xf6)]['gitApiService']),this['repoService']=typedi_1[_0x1f483d(0x11d)]['get'](providers_tokens_1[_0x1f483d(0xf6)][_0x1f483d(0x154)]),this[_0x1f483d(0xf7)]=typedi_1[_0x1f483d(0x11d)]['get'](providers_tokens_1['Tokens'][_0x1f483d(0xf7)]),await this[_0x1f483d(0x148)](),this[_0x1f483d(0x157)]=await this[_0x1f483d(0xf4)]['getOne'](this[_0x1f483d(0xe6)][_0x1f483d(0xf1)]),this[_0x1f483d(0x109)]=await this[_0x1f483d(0x157)][_0x1f483d(0x12b)][_0x1f483d(0xe4)](this['repositoryData'][_0x1f483d(0xe8)]),this[_0x1f483d(0x155)]=typedi_1[_0x1f483d(0x11d)]['get'](providers_tokens_1[_0x1f483d(0xf6)][_0x1f483d(0x13e)]),this[_0x1f483d(0xfb)]=_0x1f483d(0x10d)+this[_0x1f483d(0xf7)][_0x1f483d(0xf2)][_0x1f483d(0x136)]()+_0x1f483d(0x132)+this['repositoryData'][_0x1f483d(0xf1)]+_0x1f483d(0x121)+this[_0x1f483d(0xe6)]['branchName']+_0x1f483d(0x125)+FlosumCommitJob_1[_0x1f483d(0xe7)]+']';if(!this[_0x1f483d(0xe6)])throw new bad_request_error_1[(_0x1f483d(0x14e))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this['sfLogger'][_0x1f483d(0x102)](this[_0x1f483d(0xfb)]+_0x1f483d(0x151))[_0x1f483d(0xfd)](),await this[_0x1f483d(0x119)]()['catch'](_0x16ae3a=>this[_0x1f483d(0xe9)](_0x16ae3a)),await this[_0x1f483d(0x10e)]([this[_0x1f483d(0x159)][_0x1f483d(0x130)]['email']],this[_0x1f483d(0xf7)][_0x1f483d(0xf2)],this[_0x1f483d(0x157)][_0x1f483d(0xe7)],this['branch']['name']);}catch(_0x424328){this[_0x1f483d(0x159)]=undefined,this[_0x1f483d(0x13e)][_0x1f483d(0x14c)](_0x424328),await this[_0x1f483d(0x143)]([this[_0x1f483d(0x159)][_0x1f483d(0x130)][_0x1f483d(0x147)]],this[_0x1f483d(0xf7)][_0x1f483d(0xf2)],this[_0x1f483d(0x157)][_0x1f483d(0xe7)],this[_0x1f483d(0x109)][_0x1f483d(0xe7)]);throw _0x424328;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a125_0x5e83c7(0x15a)])({'transient':!![]}),__metadata(a125_0x5e83c7(0x139),[salesforce_service_1[a125_0x5e83c7(0x11b)],commit_components_job_1[a125_0x5e83c7(0x14b)],salesforce_sync_service_1[a125_0x5e83c7(0x104)]])],FlosumCommitJob),exports[a125_0x5e83c7(0xea)]=FlosumCommitJob;