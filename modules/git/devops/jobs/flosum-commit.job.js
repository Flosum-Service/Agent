const a105_0x4a12bf=a105_0x1155;(function(_0x1d270c,_0x98c15c){const _0x5c2ded=a105_0x1155,_0x3edecb=_0x1d270c();while(!![]){try{const _0x171fe0=-parseInt(_0x5c2ded(0x227))/0x1*(parseInt(_0x5c2ded(0x226))/0x2)+parseInt(_0x5c2ded(0x253))/0x3+-parseInt(_0x5c2ded(0x22d))/0x4+-parseInt(_0x5c2ded(0x229))/0x5+-parseInt(_0x5c2ded(0x217))/0x6+-parseInt(_0x5c2ded(0x233))/0x7+parseInt(_0x5c2ded(0x212))/0x8;if(_0x171fe0===_0x98c15c)break;else _0x3edecb['push'](_0x3edecb['shift']());}catch(_0x4cc376){_0x3edecb['push'](_0x3edecb['shift']());}}}(a105_0x5028,0xdedbb));const a105_0x3d34b3=(function(){let _0x191b0a=!![];return function(_0x227dee,_0x3bfa86){const _0x4b3e41=_0x191b0a?function(){const _0x355675=a105_0x1155;if(_0x3bfa86){const _0x2528fb=_0x3bfa86[_0x355675(0x230)](_0x227dee,arguments);return _0x3bfa86=null,_0x2528fb;}}:function(){};return _0x191b0a=![],_0x4b3e41;};}()),a105_0x5a30da=a105_0x3d34b3(this,function(){const _0x5352a0=a105_0x1155;return a105_0x5a30da[_0x5352a0(0x1f9)]()['search'](_0x5352a0(0x1f6))[_0x5352a0(0x1f9)]()[_0x5352a0(0x240)](a105_0x5a30da)['search']('(((.+)+)+)+$');});function a105_0x5028(){const _0x31742c=['../../salesforce/services/salesforce-retriever.service','(((.+)+)+)+$','salesforceSync','../../../../constants','toString','all','function','sha','provider','CommitComponentsDto','deleteAttachmentId','salesforceService','FLOSUM_ATTACHMENT','message','isConvertToSfdx',']\x20[Branch:\x20','repository','__esModule','\x20Start\x20Flosum\x20commit\x20job.','length','repo','getRepositoryRecord','BadRequestError','ERR_INVALID_SYNC_RECORD_ID','name','fetchRepositoryData','syncBranchId','SalesforceService','repositoryName','43457792PNqfCU','decorate','retrieveAttachment','getComponentsToDelete','metadata','2678958Lpedzg','commitData','../dto/commit-components.dto','error','repositoryData','handleCommitJobError','syncRepositoryId','ERR_UNKNOWN_SYNC_RECORD_ID','run','getCommitDto','gitRepoService','Completed','deleteAttachment','../../../../constants/errors','In\x20Progress','128QlYfJd','23413SjKqve','toUpperCase','6784960LBpkgY','config','FlosumCommitJob','convertToSFDX','6821608WAadSA','Logger','SalesforceRetrieverService','apply','Container','./commit-components.job','4195863HMCnkx','getComponentsToWrite','catch','CommitComponentsJob','patchObject','defineProperty','gitProvider','gitUrl','branchName','send','exec','updateLastCommit','commitAttachmentId','constructor','\x20Update\x20remote\x20state.','SalesforceSyncService','__metadata','sfLogger','typedi','__decorate','gitApiService','log','setStatus','components','../../../../core','getOwnPropertyDescriptor','default','repoService','getBranchRecord','branches','logger','commitJob','3261993INbALE','get','user',']\x20[','object','design:paramtypes',']\x20[Repository:\x20','updateRemoteState','prefix','getOne','Error','Tokens','Service'];a105_0x5028=function(){return _0x31742c;};return a105_0x5028();}a105_0x5a30da();'use strict';var __decorate=this&&this[a105_0x4a12bf(0x246)]||function(_0x92174b,_0xcbe9ab,_0x11d196,_0x11f5f7){const _0x2e1078=a105_0x4a12bf;var _0x30fad1=arguments[_0x2e1078(0x208)],_0x25ee62=_0x30fad1<0x3?_0xcbe9ab:_0x11f5f7===null?_0x11f5f7=Object[_0x2e1078(0x24c)](_0xcbe9ab,_0x11d196):_0x11f5f7,_0x463456;if(typeof Reflect===_0x2e1078(0x1ec)&&typeof Reflect[_0x2e1078(0x213)]==='function')_0x25ee62=Reflect[_0x2e1078(0x213)](_0x92174b,_0xcbe9ab,_0x11d196,_0x11f5f7);else{for(var _0x139a07=_0x92174b['length']-0x1;_0x139a07>=0x0;_0x139a07--)if(_0x463456=_0x92174b[_0x139a07])_0x25ee62=(_0x30fad1<0x3?_0x463456(_0x25ee62):_0x30fad1>0x3?_0x463456(_0xcbe9ab,_0x11d196,_0x25ee62):_0x463456(_0xcbe9ab,_0x11d196))||_0x25ee62;}return _0x30fad1>0x3&&_0x25ee62&&Object[_0x2e1078(0x238)](_0xcbe9ab,_0x11d196,_0x25ee62),_0x25ee62;},__metadata=this&&this[a105_0x4a12bf(0x243)]||function(_0x173464,_0x1b8fae){const _0x1ac6b5=a105_0x4a12bf;if(typeof Reflect===_0x1ac6b5(0x1ec)&&typeof Reflect['metadata']===_0x1ac6b5(0x1fb))return Reflect[_0x1ac6b5(0x216)](_0x173464,_0x1b8fae);},__importDefault=this&&this['__importDefault']||function(_0x2a1e9d){const _0x1a9c21=a105_0x4a12bf;return _0x2a1e9d&&_0x2a1e9d[_0x1a9c21(0x206)]?_0x2a1e9d:{'default':_0x2a1e9d};},FlosumCommitJob_1;Object[a105_0x4a12bf(0x238)](exports,a105_0x4a12bf(0x206),{'value':!![]}),exports[a105_0x4a12bf(0x22b)]=void 0x0;const core_1=require(a105_0x4a12bf(0x24b)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a105_0x4a12bf(0x245)),errors_1=require(a105_0x4a12bf(0x224)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a105_0x4a12bf(0x1f5)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a105_0x4a12bf(0x219)),commit_components_job_1=require(a105_0x4a12bf(0x232)),constants_1=require(a105_0x4a12bf(0x1f8)),shortid_1=__importDefault(require('shortid')),providers_tokens_1=require('../../providers/providers.tokens');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x25e328,_0x1f2df5,_0x35816a){const _0xf875c3=a105_0x4a12bf;this['salesforceService']=_0x25e328,this[_0xf875c3(0x252)]=_0x1f2df5,this[_0xf875c3(0x1f7)]=_0x35816a,this[_0xf875c3(0x251)]=new core_1[(_0xf875c3(0x22e))](FlosumCommitJob_1[_0xf875c3(0x20d)]);}async[a105_0x4a12bf(0x20e)](){const _0xba856b=a105_0x4a12bf;try{if(this['commitData']['syncRepositoryId'])this[_0xba856b(0x21b)]=await this[_0xba856b(0x1f7)][_0xba856b(0x20a)](this[_0xba856b(0x218)][_0xba856b(0x21d)]);else this['commitData'][_0xba856b(0x20f)]&&(this[_0xba856b(0x21b)]=await this[_0xba856b(0x1f7)][_0xba856b(0x24f)](this['commitData'][_0xba856b(0x20f)]));}catch(_0x3c5db2){throw new bad_request_error_1[(_0xba856b(0x20b))](errors_1[_0xba856b(0x20c)]);}}async[a105_0x4a12bf(0x234)](){const _0x708c29=a105_0x4a12bf;if(!this[_0x708c29(0x218)]['commitAttachmentId'])return[];await this[_0x708c29(0x200)][_0x708c29(0x237)](constants_1[_0x708c29(0x201)],this[_0x708c29(0x218)][_0x708c29(0x23f)],{'Name':(0x0,shortid_1[_0x708c29(0x24d)])()});const _0x42eda2=await this[_0x708c29(0x200)]['retrieveAttachment'](this['commitData']['commitAttachmentId'])['then'](_0x4c5e4b=>_0x4c5e4b['split']('\x20')['map'](_0x8529fc=>_0x8529fc['trim']()));await this['salesforceService'][_0x708c29(0x223)](this['commitData']['commitAttachmentId']);const _0x35b169=new salesforce_retriever_service_1[(_0x708c29(0x22f))](this['salesforceService']);return await _0x35b169[_0x708c29(0x21f)](_0x42eda2);}async[a105_0x4a12bf(0x215)](){const _0x2d7e9b=a105_0x4a12bf;if(!this[_0x2d7e9b(0x218)][_0x2d7e9b(0x1ff)])return[];await this[_0x2d7e9b(0x200)][_0x2d7e9b(0x237)](constants_1['FLOSUM_ATTACHMENT'],this[_0x2d7e9b(0x218)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0x2d7e9b(0x24d)])()});const _0x19da99=await this[_0x2d7e9b(0x200)][_0x2d7e9b(0x214)](this[_0x2d7e9b(0x218)]['deleteAttachmentId']);return await this[_0x2d7e9b(0x200)][_0x2d7e9b(0x223)](this[_0x2d7e9b(0x218)]['deleteAttachmentId']),_0x19da99;}async[a105_0x4a12bf(0x220)](){const _0x1ddf09=a105_0x4a12bf,_0x29e33d=new commit_components_dto_1[(_0x1ddf09(0x1fe))](),[_0x24cf97,_0x144d2a]=await Promise[_0x1ddf09(0x1fa)]([this['getComponentsToWrite'](),this[_0x1ddf09(0x215)]()]);return _0x29e33d['message']=this[_0x1ddf09(0x218)][_0x1ddf09(0x202)],_0x29e33d[_0x1ddf09(0x255)]=this[_0x1ddf09(0x218)][_0x1ddf09(0x255)],_0x29e33d[_0x1ddf09(0x24a)]={'writed':_0x24cf97,'deleted':_0x144d2a},_0x29e33d[_0x1ddf09(0x22c)]=this[_0x1ddf09(0x22a)][_0x1ddf09(0x203)],_0x29e33d[_0x1ddf09(0x209)]=this['repository'],_0x29e33d['branch']=this['branch'],_0x29e33d[_0x1ddf09(0x1fd)]=this[_0x1ddf09(0x22a)][_0x1ddf09(0x239)],_0x29e33d;}async[a105_0x4a12bf(0x23e)](_0x49a1a8=![]){const _0x2aca07=a105_0x4a12bf;if(_0x49a1a8)await this[_0x2aca07(0x1f7)][_0x2aca07(0x1ef)](this['repositoryData'],{});else{const _0x3fd38d=await this[_0x2aca07(0x205)][_0x2aca07(0x250)][_0x2aca07(0x1f1)](this['branch'][_0x2aca07(0x20d)]);this[_0x2aca07(0x244)]['log'](this[_0x2aca07(0x1f0)]+_0x2aca07(0x241));const _0x2bfe33={[this[_0x2aca07(0x205)][_0x2aca07(0x23a)]]:{'lastCommit':_0x3fd38d[_0x2aca07(0x1fc)]}};await this['salesforceSync'][_0x2aca07(0x1ef)](this[_0x2aca07(0x21b)],_0x2bfe33);}}async['exec'](){const _0x5b92fd=a105_0x4a12bf,_0x4377af=await this[_0x5b92fd(0x220)]();await this['salesforceSync'][_0x5b92fd(0x249)](this[_0x5b92fd(0x21b)],_0x5b92fd(0x225)),await this[_0x5b92fd(0x252)][_0x5b92fd(0x21f)](_0x4377af,this[_0x5b92fd(0x1f0)]),await this[_0x5b92fd(0x23e)](),await this[_0x5b92fd(0x1f7)][_0x5b92fd(0x249)](this[_0x5b92fd(0x21b)],_0x5b92fd(0x222));}async[a105_0x4a12bf(0x21c)](_0x27cd8d){const _0x1848ff=a105_0x4a12bf;try{this[_0x1848ff(0x244)][_0x1848ff(0x21a)](''+_0x27cd8d),await this[_0x1848ff(0x244)]['send'](),await this['updateLastCommit'](!![]),await this[_0x1848ff(0x1f7)][_0x1848ff(0x249)](this[_0x1848ff(0x21b)],_0x1848ff(0x1f2));}catch(_0x33fc94){this[_0x1848ff(0x251)][_0x1848ff(0x21a)](_0x33fc94);}}async[a105_0x4a12bf(0x21f)](_0x5f19d6){const _0x3e7eba=a105_0x4a12bf;try{this[_0x3e7eba(0x218)]=_0x5f19d6,this[_0x3e7eba(0x247)]=typedi_1[_0x3e7eba(0x231)]['get'](providers_tokens_1[_0x3e7eba(0x1f3)]['gitApiService']),this[_0x3e7eba(0x24e)]=typedi_1[_0x3e7eba(0x231)]['get'](providers_tokens_1[_0x3e7eba(0x1f3)][_0x3e7eba(0x221)]),this[_0x3e7eba(0x22a)]=typedi_1['Container'][_0x3e7eba(0x254)](providers_tokens_1[_0x3e7eba(0x1f3)]['config']),await this[_0x3e7eba(0x20e)](),this[_0x3e7eba(0x205)]=await this[_0x3e7eba(0x24e)][_0x3e7eba(0x1f1)](this['repositoryData']['repositoryName']),this['branch']=await this[_0x3e7eba(0x205)][_0x3e7eba(0x250)]['getOne'](this[_0x3e7eba(0x21b)][_0x3e7eba(0x23b)]),this['sfLogger']=typedi_1[_0x3e7eba(0x231)]['get'](providers_tokens_1['Tokens'][_0x3e7eba(0x251)]),this[_0x3e7eba(0x1f0)]='[FLOSUM\x20->\x20GIT]\x20['+this[_0x3e7eba(0x22a)][_0x3e7eba(0x239)][_0x3e7eba(0x228)]()+_0x3e7eba(0x1ee)+this[_0x3e7eba(0x21b)][_0x3e7eba(0x211)]+_0x3e7eba(0x204)+this[_0x3e7eba(0x21b)][_0x3e7eba(0x23b)]+_0x3e7eba(0x256)+FlosumCommitJob_1['name']+']';if(!this[_0x3e7eba(0x21b)])throw new bad_request_error_1[(_0x3e7eba(0x20b))](errors_1[_0x3e7eba(0x21e)]);await this[_0x3e7eba(0x244)][_0x3e7eba(0x248)](this[_0x3e7eba(0x1f0)]+_0x3e7eba(0x207))[_0x3e7eba(0x23c)](),await this[_0x3e7eba(0x23d)]()[_0x3e7eba(0x235)](_0x265648=>this[_0x3e7eba(0x21c)](_0x265648));}catch(_0x4d053f){this['commitData']=undefined,this['logger'][_0x3e7eba(0x21a)](_0x4d053f);throw _0x4d053f;}}};function a105_0x1155(_0x48523b,_0x1f171d){const _0x5caba8=a105_0x5028();return a105_0x1155=function(_0x5a30da,_0x3d34b3){_0x5a30da=_0x5a30da-0x1ec;let _0x502834=_0x5caba8[_0x5a30da];return _0x502834;},a105_0x1155(_0x48523b,_0x1f171d);}FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x4a12bf(0x1f4)])({'transient':!![]}),__metadata(a105_0x4a12bf(0x1ed),[salesforce_service_1[a105_0x4a12bf(0x210)],commit_components_job_1[a105_0x4a12bf(0x236)],salesforce_sync_service_1[a105_0x4a12bf(0x242)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;