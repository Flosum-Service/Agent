const a74_0x1604b3=a74_0x376b;function a74_0x376b(_0x204432,_0x83466e){const _0x13a4f7=a74_0xd527();return a74_0x376b=function(_0x42d0d5,_0x27e28c){_0x42d0d5=_0x42d0d5-0x1b9;let _0xd52734=_0x13a4f7[_0x42d0d5];return _0xd52734;},a74_0x376b(_0x204432,_0x83466e);}(function(_0xd9bcab,_0x50813d){const _0x23f40b=a74_0x376b,_0x17a159=_0xd9bcab();while(!![]){try{const _0x1d2491=parseInt(_0x23f40b(0x1e5))/0x1+-parseInt(_0x23f40b(0x203))/0x2*(parseInt(_0x23f40b(0x223))/0x3)+parseInt(_0x23f40b(0x1cd))/0x4+-parseInt(_0x23f40b(0x21c))/0x5*(-parseInt(_0x23f40b(0x21b))/0x6)+parseInt(_0x23f40b(0x1df))/0x7+parseInt(_0x23f40b(0x1e4))/0x8+-parseInt(_0x23f40b(0x1c7))/0x9;if(_0x1d2491===_0x50813d)break;else _0x17a159['push'](_0x17a159['shift']());}catch(_0x19dd1d){_0x17a159['push'](_0x17a159['shift']());}}}(a74_0xd527,0x98e84));const a74_0x27e28c=(function(){let _0x2e5fba=!![];return function(_0x450d13,_0x3d4f69){const _0x27683d=_0x2e5fba?function(){const _0x22ca89=a74_0x376b;if(_0x3d4f69){const _0xf2dbef=_0x3d4f69[_0x22ca89(0x1e8)](_0x450d13,arguments);return _0x3d4f69=null,_0xf2dbef;}}:function(){};return _0x2e5fba=![],_0x27683d;};}()),a74_0x42d0d5=a74_0x27e28c(this,function(){const _0x14317e=a74_0x376b;return a74_0x42d0d5[_0x14317e(0x1f2)]()[_0x14317e(0x208)](_0x14317e(0x1d8))[_0x14317e(0x1f2)]()['constructor'](a74_0x42d0d5)[_0x14317e(0x208)](_0x14317e(0x1d8));});a74_0x42d0d5();'use strict';var __decorate=this&&this['__decorate']||function(_0x36e078,_0x2c36b1,_0x20d4d7,_0xa4339c){const _0x3b9c5a=a74_0x376b;var _0x3f6cd7=arguments[_0x3b9c5a(0x1db)],_0x3b8ceb=_0x3f6cd7<0x3?_0x2c36b1:_0xa4339c===null?_0xa4339c=Object[_0x3b9c5a(0x1ce)](_0x2c36b1,_0x20d4d7):_0xa4339c,_0x4d1dc4;if(typeof Reflect===_0x3b9c5a(0x1f6)&&typeof Reflect[_0x3b9c5a(0x1f7)]===_0x3b9c5a(0x1c0))_0x3b8ceb=Reflect[_0x3b9c5a(0x1f7)](_0x36e078,_0x2c36b1,_0x20d4d7,_0xa4339c);else{for(var _0x5eb10b=_0x36e078[_0x3b9c5a(0x1db)]-0x1;_0x5eb10b>=0x0;_0x5eb10b--)if(_0x4d1dc4=_0x36e078[_0x5eb10b])_0x3b8ceb=(_0x3f6cd7<0x3?_0x4d1dc4(_0x3b8ceb):_0x3f6cd7>0x3?_0x4d1dc4(_0x2c36b1,_0x20d4d7,_0x3b8ceb):_0x4d1dc4(_0x2c36b1,_0x20d4d7))||_0x3b8ceb;}return _0x3f6cd7>0x3&&_0x3b8ceb&&Object[_0x3b9c5a(0x213)](_0x2c36b1,_0x20d4d7,_0x3b8ceb),_0x3b8ceb;},__metadata=this&&this[a74_0x1604b3(0x1ef)]||function(_0x2b6814,_0x3520e6){const _0x3677bc=a74_0x1604b3;if(typeof Reflect==='object'&&typeof Reflect[_0x3677bc(0x1d0)]===_0x3677bc(0x1c0))return Reflect[_0x3677bc(0x1d0)](_0x2b6814,_0x3520e6);},__importDefault=this&&this[a74_0x1604b3(0x207)]||function(_0x28852e){const _0x34b9b1=a74_0x1604b3;return _0x28852e&&_0x28852e[_0x34b9b1(0x1ba)]?_0x28852e:{'default':_0x28852e};},FlosumCommitJob_1;Object[a74_0x1604b3(0x213)](exports,'__esModule',{'value':!![]}),exports[a74_0x1604b3(0x1da)]=void 0x0;const core_1=require(a74_0x1604b3(0x1c8)),salesforce_service_1=require(a74_0x1604b3(0x1be)),typedi_1=require(a74_0x1604b3(0x1dc)),errors_1=require(a74_0x1604b3(0x1d9)),bad_request_error_1=require(a74_0x1604b3(0x1fe)),salesforce_retriever_service_1=require(a74_0x1604b3(0x1f5)),salesforce_sync_service_1=require(a74_0x1604b3(0x214)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a74_0x1604b3(0x1ed)),constants_1=require(a74_0x1604b3(0x202)),shortid_1=__importDefault(require(a74_0x1604b3(0x1f1))),providers_tokens_1=require(a74_0x1604b3(0x1f0));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x50280e,_0x2be68c,_0x56da34){const _0x94fe32=a74_0x1604b3;this[_0x94fe32(0x1d3)]=_0x50280e,this[_0x94fe32(0x1d1)]=_0x2be68c,this[_0x94fe32(0x1f4)]=_0x56da34,this['logger']=new core_1['Logger'](FlosumCommitJob_1[_0x94fe32(0x1dd)]);}async[a74_0x1604b3(0x1fc)](){const _0x464a31=a74_0x1604b3;try{if(this[_0x464a31(0x1fb)][_0x464a31(0x1e7)])this[_0x464a31(0x1c9)]=await this['salesforceSync'][_0x464a31(0x1bd)](this[_0x464a31(0x1fb)][_0x464a31(0x1e7)]);else this['commitData'][_0x464a31(0x1cf)]&&(this['repositoryData']=await this[_0x464a31(0x1f4)][_0x464a31(0x1bb)](this[_0x464a31(0x1fb)][_0x464a31(0x1cf)]));}catch(_0x275946){throw new bad_request_error_1[(_0x464a31(0x215))](errors_1[_0x464a31(0x1bc)]);}}async['getComponentsToWrite'](){const _0x3dfdb5=a74_0x1604b3;if(!this[_0x3dfdb5(0x1fb)][_0x3dfdb5(0x1ea)])return[];await this[_0x3dfdb5(0x1d3)][_0x3dfdb5(0x210)](constants_1[_0x3dfdb5(0x1eb)],this[_0x3dfdb5(0x1fb)]['commitAttachmentId'],{'Name':(0x0,shortid_1[_0x3dfdb5(0x212)])()});const _0x5e0245=await this[_0x3dfdb5(0x1d3)][_0x3dfdb5(0x21e)](this['commitData']['commitAttachmentId'])[_0x3dfdb5(0x1cc)](_0x571636=>_0x571636[_0x3dfdb5(0x216)]('\x20')[_0x3dfdb5(0x1d5)](_0x3c9c39=>_0x3c9c39[_0x3dfdb5(0x1cb)]()));await this[_0x3dfdb5(0x1d3)][_0x3dfdb5(0x1e3)](this[_0x3dfdb5(0x1fb)]['commitAttachmentId']);const _0x443a13=new salesforce_retriever_service_1[(_0x3dfdb5(0x1bf))](this[_0x3dfdb5(0x1d3)]);return await _0x443a13[_0x3dfdb5(0x1c2)](_0x5e0245);}async[a74_0x1604b3(0x225)](){const _0x2792e4=a74_0x1604b3;if(!this[_0x2792e4(0x1fb)][_0x2792e4(0x205)])return[];await this['salesforceService'][_0x2792e4(0x210)](constants_1[_0x2792e4(0x1eb)],this[_0x2792e4(0x1fb)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0x2792e4(0x212)])()});const _0x1f05ad=await this[_0x2792e4(0x1d3)][_0x2792e4(0x21e)](this[_0x2792e4(0x1fb)][_0x2792e4(0x205)]);return await this[_0x2792e4(0x1d3)][_0x2792e4(0x1e3)](this['commitData'][_0x2792e4(0x205)]),_0x1f05ad;}async[a74_0x1604b3(0x209)](){const _0x5ca62c=a74_0x1604b3,_0x302cb4=new commit_components_dto_1[(_0x5ca62c(0x201))](),[_0x39f816,_0x259d1c]=await Promise[_0x5ca62c(0x1c5)]([this[_0x5ca62c(0x1e6)](),this['getComponentsToDelete']()]);return _0x302cb4[_0x5ca62c(0x1c4)]=this['commitData'][_0x5ca62c(0x1c4)],_0x302cb4[_0x5ca62c(0x1e0)]=this[_0x5ca62c(0x1fb)][_0x5ca62c(0x1e0)],_0x302cb4['components']={'writed':_0x39f816,'deleted':_0x259d1c},_0x302cb4['convertToSFDX']=this[_0x5ca62c(0x1ec)]['isConvertToSfdx'],_0x302cb4[_0x5ca62c(0x200)]=this[_0x5ca62c(0x1fa)],_0x302cb4['branch']=this[_0x5ca62c(0x20e)],_0x302cb4[_0x5ca62c(0x217)]=this['config']['gitProvider'],_0x302cb4;}async[a74_0x1604b3(0x1f8)](_0x33d755=![]){const _0x1354f0=a74_0x1604b3;if(_0x33d755)await this[_0x1354f0(0x1f4)][_0x1354f0(0x211)](this['repositoryData'],{});else{const _0x256260=await this['repository']['branches'][_0x1354f0(0x20d)](this[_0x1354f0(0x20e)][_0x1354f0(0x1dd)]);this[_0x1354f0(0x1fd)]['log'](this[_0x1354f0(0x21a)]+_0x1354f0(0x219));const _0x3336b9={[this['repository'][_0x1354f0(0x21d)]]:{'lastCommit':_0x256260['sha']}};await this['salesforceSync']['updateRemoteState'](this[_0x1354f0(0x1c9)],_0x3336b9);}}async[a74_0x1604b3(0x204)](){const _0x252888=a74_0x1604b3,_0x3d6ee7=await this[_0x252888(0x209)]();await this[_0x252888(0x1f4)][_0x252888(0x218)](this[_0x252888(0x1c9)],'In\x20Progress'),await this[_0x252888(0x1d1)][_0x252888(0x1c2)](_0x3d6ee7,this[_0x252888(0x21a)]),await this[_0x252888(0x1f8)](),await this[_0x252888(0x1f4)][_0x252888(0x218)](this[_0x252888(0x1c9)],_0x252888(0x221));}async['handleCommitJobError'](_0x396131){const _0x41f897=a74_0x1604b3;try{this[_0x41f897(0x1fd)][_0x41f897(0x1e2)](''+_0x396131),await this['sfLogger'][_0x41f897(0x1e9)](),await this[_0x41f897(0x1f8)](!![]),await this[_0x41f897(0x1f4)][_0x41f897(0x218)](this['repositoryData'],_0x41f897(0x20f));}catch(_0x2a4ae0){this[_0x41f897(0x21f)][_0x41f897(0x1e2)](_0x2a4ae0);}}async[a74_0x1604b3(0x1c2)](_0x5808fa){const _0x27d559=a74_0x1604b3;try{this[_0x27d559(0x1fb)]=_0x5808fa,this['gitApiService']=typedi_1['Container']['get'](providers_tokens_1['Tokens'][_0x27d559(0x1c1)]),this[_0x27d559(0x1de)]=typedi_1[_0x27d559(0x1d2)][_0x27d559(0x1c6)](providers_tokens_1[_0x27d559(0x1d7)][_0x27d559(0x226)]),this['config']=typedi_1[_0x27d559(0x1d2)][_0x27d559(0x1c6)](providers_tokens_1['Tokens']['config']),await this[_0x27d559(0x1fc)](),this[_0x27d559(0x1fa)]=await this[_0x27d559(0x1de)][_0x27d559(0x20d)](this[_0x27d559(0x1c9)][_0x27d559(0x206)]),this[_0x27d559(0x20e)]=await this[_0x27d559(0x1fa)][_0x27d559(0x220)][_0x27d559(0x20d)](this[_0x27d559(0x1c9)]['branchName']),this[_0x27d559(0x1fd)]=typedi_1['Container'][_0x27d559(0x1c6)](providers_tokens_1[_0x27d559(0x1d7)][_0x27d559(0x21f)]),this[_0x27d559(0x21a)]=_0x27d559(0x1b9)+this['config'][_0x27d559(0x222)][_0x27d559(0x224)]()+_0x27d559(0x1ee)+this[_0x27d559(0x1c9)][_0x27d559(0x206)]+_0x27d559(0x20c)+this[_0x27d559(0x1c9)][_0x27d559(0x1c3)]+_0x27d559(0x20b)+FlosumCommitJob_1[_0x27d559(0x1dd)]+']';if(!this[_0x27d559(0x1c9)])throw new bad_request_error_1[(_0x27d559(0x215))](errors_1[_0x27d559(0x1e1)]);await this[_0x27d559(0x1fd)][_0x27d559(0x1ff)](this['prefix']+_0x27d559(0x1d4))[_0x27d559(0x1e9)](),await this['exec']()[_0x27d559(0x1ca)](_0x60f070=>this['handleCommitJobError'](_0x60f070));}catch(_0x20dd0d){this[_0x27d559(0x1fb)]=undefined,this[_0x27d559(0x21f)][_0x27d559(0x1e2)](_0x20dd0d);throw _0x20dd0d;}}};function a74_0xd527(){const _0x9feec9=['15buLWhY','gitUrl','retrieveAttachment','logger','branches','Completed','gitProvider','6ZceNNy','toUpperCase','getComponentsToDelete','gitRepoService','[FLOSUM\x20->\x20GIT]\x20[','__esModule','getBranchRecord','ERR_INVALID_SYNC_RECORD_ID','getRepositoryRecord','../../salesforce/services/salesforce.service','SalesforceRetrieverService','function','gitApiService','run','branchName','message','all','get','26250102FvRSKG','../../../../core','repositoryData','catch','trim','then','3756948cXAZJa','getOwnPropertyDescriptor','syncBranchId','metadata','commitJob','Container','salesforceService','\x20Start\x20Flosum\x20commit\x20job.','map','design:paramtypes','Tokens','(((.+)+)+)+$','../../../../constants/errors','FlosumCommitJob','length','typedi','name','repoService','5004146PoixLz','user','ERR_UNKNOWN_SYNC_RECORD_ID','error','deleteAttachment','5437784ypoQDG','1066185FZJMRR','getComponentsToWrite','syncRepositoryId','apply','send','commitAttachmentId','FLOSUM_ATTACHMENT','config','./commit-components.job',']\x20[Repository:\x20','__metadata','../../providers/providers.tokens','shortid','toString','Service','salesforceSync','../../salesforce/services/salesforce-retriever.service','object','decorate','updateLastCommit','SalesforceService','repository','commitData','fetchRepositoryData','sfLogger','../../../../core/errors/bad-request.error','log','repo','CommitComponentsDto','../../../../constants','1069214REiEFL','exec','deleteAttachmentId','repositoryName','__importDefault','search','getCommitDto','CommitComponentsJob',']\x20[',']\x20[Branch:\x20','getOne','branch','Error','patchObject','updateRemoteState','default','defineProperty','../../salesforce/services/salesforce-sync.service','BadRequestError','split','provider','setStatus','\x20Update\x20remote\x20state.','prefix','2424354fsewmP'];a74_0xd527=function(){return _0x9feec9;};return a74_0xd527();}FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a74_0x1604b3(0x1f3)])({'transient':!![]}),__metadata(a74_0x1604b3(0x1d6),[salesforce_service_1[a74_0x1604b3(0x1f9)],commit_components_job_1[a74_0x1604b3(0x20a)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a74_0x1604b3(0x1da)]=FlosumCommitJob;