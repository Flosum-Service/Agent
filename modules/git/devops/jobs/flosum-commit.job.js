const a61_0x35ea7b=a61_0x3759;function a61_0x4820(){const _0x3a222c=['BadRequestError','length','gitApiService','../../../../constants/errors','commitJob','typedi','config','Service','../dto/commit-components.dto','repoService','branches','updateLastCommit','metadata','all','syncBranchId','apply','ERR_UNKNOWN_SYNC_RECORD_ID','633136gtEuUg','./commit-components.job','commitAttachmentId','run','../../salesforce/services/salesforce.service','constructor','repository','(((.+)+)+)+$','trim','repositoryData','user','In\x20Progress','get','__metadata','getOne','getOwnPropertyDescriptor','search','branchName','getBranchRecord','split','CommitComponentsJob','../../../../core/errors/bad-request.error','map','__importDefault','deleteAttachmentId','470sZzKdZ','convertToSFDX','setStatus','shortid','[FLOSUM\x20->\x20GIT]\x20[','deleteAttachment','syncRepositoryId','logger','repositoryName','FLOSUM_ATTACHMENT','updateRemoteState','error','gitProvider',']\x20[','CommitComponentsDto','default','gitUrl','fetchRepositoryData','sfLogger','then','gitRepoService','getCommitDto','name','send','function','353881lJhNLu',']\x20[Repository:\x20','Error','7mWOnms','9jpVmuf','Container','1209190zffijU','decorate','components',']\x20[Branch:\x20','20BdItRv','FlosumCommitJob','SalesforceService','object','Tokens','getComponentsToDelete','exec','message','__decorate','../../../../constants','__esModule','../../salesforce/services/salesforce-retriever.service','branch','../../providers/providers.tokens','commitData','prefix','repo','getComponentsToWrite','defineProperty','256663PiNnlR','313476OPCvwn','patchObject','50760PbXXLJ','ERR_INVALID_SYNC_RECORD_ID','SalesforceRetrieverService','salesforceSync','1126002SdRCrd','salesforceService','retrieveAttachment'];a61_0x4820=function(){return _0x3a222c;};return a61_0x4820();}(function(_0x4a9ff0,_0x5aa4a5){const _0x35faf8=a61_0x3759,_0x31b43a=_0x4a9ff0();while(!![]){try{const _0x2019ac=parseInt(_0x35faf8(0x125))/0x1+-parseInt(_0x35faf8(0x145))/0x2+parseInt(_0x35faf8(0x143))/0x3*(parseInt(_0x35faf8(0x12f))/0x4)+parseInt(_0x35faf8(0x12b))/0x5+-parseInt(_0x35faf8(0x149))/0x6*(-parseInt(_0x35faf8(0x128))/0x7)+parseInt(_0x35faf8(0x15d))/0x8*(parseInt(_0x35faf8(0x129))/0x9)+-parseInt(_0x35faf8(0x10c))/0xa*(parseInt(_0x35faf8(0x142))/0xb);if(_0x2019ac===_0x5aa4a5)break;else _0x31b43a['push'](_0x31b43a['shift']());}catch(_0x3a45e3){_0x31b43a['push'](_0x31b43a['shift']());}}}(a61_0x4820,0x4032d));const a61_0x145574=(function(){let _0x230b47=!![];return function(_0xd6aa39,_0x5f388f){const _0x4b939e=_0x230b47?function(){const _0x2119c3=a61_0x3759;if(_0x5f388f){const _0x147a22=_0x5f388f[_0x2119c3(0x15b)](_0xd6aa39,arguments);return _0x5f388f=null,_0x147a22;}}:function(){};return _0x230b47=![],_0x4b939e;};}()),a61_0x4f78a0=a61_0x145574(this,function(){const _0x40ffd6=a61_0x3759;return a61_0x4f78a0['toString']()['search'](_0x40ffd6(0x164))['toString']()[_0x40ffd6(0x162)](a61_0x4f78a0)[_0x40ffd6(0x103)](_0x40ffd6(0x164));});a61_0x4f78a0();'use strict';var __decorate=this&&this[a61_0x35ea7b(0x137)]||function(_0x5d490c,_0x3731ac,_0x4d96fc,_0x2f2fb2){const _0x3ad9a3=a61_0x35ea7b;var _0x52de72=arguments[_0x3ad9a3(0x14d)],_0x21908f=_0x52de72<0x3?_0x3731ac:_0x2f2fb2===null?_0x2f2fb2=Object[_0x3ad9a3(0x102)](_0x3731ac,_0x4d96fc):_0x2f2fb2,_0x5b3000;if(typeof Reflect==='object'&&typeof Reflect[_0x3ad9a3(0x12c)]===_0x3ad9a3(0x124))_0x21908f=Reflect[_0x3ad9a3(0x12c)](_0x5d490c,_0x3731ac,_0x4d96fc,_0x2f2fb2);else{for(var _0xeaac23=_0x5d490c['length']-0x1;_0xeaac23>=0x0;_0xeaac23--)if(_0x5b3000=_0x5d490c[_0xeaac23])_0x21908f=(_0x52de72<0x3?_0x5b3000(_0x21908f):_0x52de72>0x3?_0x5b3000(_0x3731ac,_0x4d96fc,_0x21908f):_0x5b3000(_0x3731ac,_0x4d96fc))||_0x21908f;}return _0x52de72>0x3&&_0x21908f&&Object[_0x3ad9a3(0x141)](_0x3731ac,_0x4d96fc,_0x21908f),_0x21908f;},__metadata=this&&this[a61_0x35ea7b(0x16a)]||function(_0x2bb65f,_0x2924c5){const _0x3fc410=a61_0x35ea7b;if(typeof Reflect===_0x3fc410(0x132)&&typeof Reflect[_0x3fc410(0x158)]==='function')return Reflect[_0x3fc410(0x158)](_0x2bb65f,_0x2924c5);},__importDefault=this&&this[a61_0x35ea7b(0x10a)]||function(_0x42ccea){const _0x317d74=a61_0x35ea7b;return _0x42ccea&&_0x42ccea[_0x317d74(0x139)]?_0x42ccea:{'default':_0x42ccea};},FlosumCommitJob_1;Object['defineProperty'](exports,a61_0x35ea7b(0x139),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require('../../../../core'),salesforce_service_1=require(a61_0x35ea7b(0x161)),typedi_1=require(a61_0x35ea7b(0x151)),errors_1=require(a61_0x35ea7b(0x14f)),bad_request_error_1=require(a61_0x35ea7b(0x108)),salesforce_retriever_service_1=require(a61_0x35ea7b(0x13a)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a61_0x35ea7b(0x154)),commit_components_job_1=require(a61_0x35ea7b(0x15e)),constants_1=require(a61_0x35ea7b(0x138)),shortid_1=__importDefault(require(a61_0x35ea7b(0x10f))),providers_tokens_1=require(a61_0x35ea7b(0x13c));function a61_0x3759(_0x209628,_0x1a2a6a){const _0x5a43a2=a61_0x4820();return a61_0x3759=function(_0x4f78a0,_0x145574){_0x4f78a0=_0x4f78a0-0x102;let _0x4820ae=_0x5a43a2[_0x4f78a0];return _0x4820ae;},a61_0x3759(_0x209628,_0x1a2a6a);}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x19add2,_0x92028d,_0x43cfcf){const _0x1768e6=a61_0x35ea7b;this[_0x1768e6(0x14a)]=_0x19add2,this['commitJob']=_0x92028d,this['salesforceSync']=_0x43cfcf,this['logger']=new core_1['Logger'](FlosumCommitJob_1[_0x1768e6(0x122)]);}async[a61_0x35ea7b(0x11d)](){const _0x45942c=a61_0x35ea7b;try{if(this[_0x45942c(0x13d)]['syncRepositoryId'])this[_0x45942c(0x166)]=await this[_0x45942c(0x148)]['getRepositoryRecord'](this[_0x45942c(0x13d)][_0x45942c(0x112)]);else this[_0x45942c(0x13d)][_0x45942c(0x15a)]&&(this['repositoryData']=await this[_0x45942c(0x148)][_0x45942c(0x105)](this[_0x45942c(0x13d)]['syncBranchId']));}catch(_0x502960){throw new bad_request_error_1[(_0x45942c(0x14c))](errors_1[_0x45942c(0x146)]);}}async[a61_0x35ea7b(0x140)](){const _0x2491b8=a61_0x35ea7b;if(!this['commitData'][_0x2491b8(0x15f)])return[];await this['salesforceService'][_0x2491b8(0x144)](constants_1[_0x2491b8(0x115)],this[_0x2491b8(0x13d)]['commitAttachmentId'],{'Name':shortid_1[_0x2491b8(0x11b)]()});const _0x3e43f1=await this['salesforceService']['retrieveAttachment'](this[_0x2491b8(0x13d)]['commitAttachmentId'])[_0x2491b8(0x11f)](_0x2f90d8=>_0x2f90d8[_0x2491b8(0x106)]('\x20')[_0x2491b8(0x109)](_0x1e2a83=>_0x1e2a83[_0x2491b8(0x165)]()));await this[_0x2491b8(0x14a)][_0x2491b8(0x111)](this[_0x2491b8(0x13d)]['commitAttachmentId']);const _0x369689=new salesforce_retriever_service_1[(_0x2491b8(0x147))](this[_0x2491b8(0x14a)]);return await _0x369689[_0x2491b8(0x160)](_0x3e43f1);}async[a61_0x35ea7b(0x134)](){const _0x32aa6f=a61_0x35ea7b;if(!this['commitData'][_0x32aa6f(0x10b)])return[];await this[_0x32aa6f(0x14a)][_0x32aa6f(0x144)](constants_1[_0x32aa6f(0x115)],this[_0x32aa6f(0x13d)][_0x32aa6f(0x10b)],{'Name':shortid_1[_0x32aa6f(0x11b)]()});const _0x336d9e=await this[_0x32aa6f(0x14a)][_0x32aa6f(0x14b)](this[_0x32aa6f(0x13d)]['deleteAttachmentId']);return await this[_0x32aa6f(0x14a)][_0x32aa6f(0x111)](this[_0x32aa6f(0x13d)]['deleteAttachmentId']),_0x336d9e;}async[a61_0x35ea7b(0x121)](){const _0x3f9294=a61_0x35ea7b,_0x252cc5=new commit_components_dto_1[(_0x3f9294(0x11a))](),[_0x4b09ab,_0x5e587e]=await Promise[_0x3f9294(0x159)]([this[_0x3f9294(0x140)](),this[_0x3f9294(0x134)]()]);return _0x252cc5[_0x3f9294(0x136)]=this[_0x3f9294(0x13d)]['message'],_0x252cc5[_0x3f9294(0x167)]=this[_0x3f9294(0x13d)][_0x3f9294(0x167)],_0x252cc5[_0x3f9294(0x12d)]={'writed':_0x4b09ab,'deleted':_0x5e587e},_0x252cc5[_0x3f9294(0x10d)]=this[_0x3f9294(0x152)]['isConvertToSfdx'],_0x252cc5[_0x3f9294(0x13f)]=this[_0x3f9294(0x163)],_0x252cc5[_0x3f9294(0x13b)]=this['branch'],_0x252cc5['provider']=this['config'][_0x3f9294(0x118)],_0x252cc5;}async['updateLastCommit'](_0x455d63=![]){const _0x93148f=a61_0x35ea7b;if(_0x455d63)await this['salesforceSync'][_0x93148f(0x116)](this['repositoryData'],{});else{const _0x4806a5=await this[_0x93148f(0x163)]['branches']['getOne'](this['branch']['name']);this['sfLogger']['log'](this[_0x93148f(0x13e)]+'\x20Update\x20remote\x20state.');const _0x338643={[this[_0x93148f(0x163)][_0x93148f(0x11c)]]:{'lastCommit':_0x4806a5['sha']}};await this['salesforceSync'][_0x93148f(0x116)](this[_0x93148f(0x166)],_0x338643);}}async[a61_0x35ea7b(0x135)](){const _0x4cf6ad=a61_0x35ea7b,_0x2c03d1=await this[_0x4cf6ad(0x121)]();await this['salesforceSync'][_0x4cf6ad(0x10e)](this[_0x4cf6ad(0x166)],_0x4cf6ad(0x168)),await this[_0x4cf6ad(0x150)][_0x4cf6ad(0x160)](_0x2c03d1,this['prefix']),await this[_0x4cf6ad(0x157)](),await this[_0x4cf6ad(0x148)][_0x4cf6ad(0x10e)](this[_0x4cf6ad(0x166)],'Completed');}async['handleCommitJobError'](_0x4c7895){const _0x1fa4fe=a61_0x35ea7b;try{this[_0x1fa4fe(0x11e)]['error'](''+_0x4c7895),await this[_0x1fa4fe(0x11e)][_0x1fa4fe(0x123)](),await this[_0x1fa4fe(0x157)](!![]),await this[_0x1fa4fe(0x148)][_0x1fa4fe(0x10e)](this['repositoryData'],_0x1fa4fe(0x127));}catch(_0x5e90a6){this[_0x1fa4fe(0x113)][_0x1fa4fe(0x117)](_0x5e90a6);}}async[a61_0x35ea7b(0x160)](_0x201216){const _0x3181c4=a61_0x35ea7b;try{this['commitData']=_0x201216,this[_0x3181c4(0x14e)]=typedi_1[_0x3181c4(0x12a)][_0x3181c4(0x169)](providers_tokens_1[_0x3181c4(0x133)][_0x3181c4(0x14e)]),this['repoService']=typedi_1[_0x3181c4(0x12a)][_0x3181c4(0x169)](providers_tokens_1[_0x3181c4(0x133)][_0x3181c4(0x120)]),this['config']=typedi_1[_0x3181c4(0x12a)]['get'](providers_tokens_1['Tokens']['config']),await this['fetchRepositoryData'](),this[_0x3181c4(0x163)]=await this[_0x3181c4(0x155)][_0x3181c4(0x16b)](this[_0x3181c4(0x166)][_0x3181c4(0x114)]),this[_0x3181c4(0x13b)]=await this[_0x3181c4(0x163)][_0x3181c4(0x156)][_0x3181c4(0x16b)](this[_0x3181c4(0x166)][_0x3181c4(0x104)]),this[_0x3181c4(0x11e)]=typedi_1[_0x3181c4(0x12a)]['get'](providers_tokens_1['Tokens'][_0x3181c4(0x113)]),this[_0x3181c4(0x13e)]=_0x3181c4(0x110)+this[_0x3181c4(0x152)][_0x3181c4(0x118)]['toUpperCase']()+_0x3181c4(0x126)+this['repositoryData']['repositoryName']+_0x3181c4(0x12e)+this[_0x3181c4(0x166)][_0x3181c4(0x104)]+_0x3181c4(0x119)+FlosumCommitJob_1[_0x3181c4(0x122)]+']';if(!this[_0x3181c4(0x166)])throw new bad_request_error_1[(_0x3181c4(0x14c))](errors_1[_0x3181c4(0x15c)]);await this[_0x3181c4(0x11e)]['log'](this[_0x3181c4(0x13e)]+'\x20Start\x20Flosum\x20commit\x20job.')[_0x3181c4(0x123)](),await this['exec']()['catch'](_0x4ac6ad=>this['handleCommitJobError'](_0x4ac6ad));}catch(_0x145ebd){this[_0x3181c4(0x13d)]=undefined,this[_0x3181c4(0x113)][_0x3181c4(0x117)](_0x145ebd);throw _0x145ebd;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1[a61_0x35ea7b(0x153)]({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a61_0x35ea7b(0x131)],commit_components_job_1[a61_0x35ea7b(0x107)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a61_0x35ea7b(0x130)]=FlosumCommitJob;