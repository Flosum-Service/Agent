const a105_0x47da41=a105_0xc429;function a105_0x1470(){const _0x3ed100=['40858mmDlWz','commitData','\x20Update\x20remote\x20state.','157710knYqrC','getOne','isConvertToSfdx','get','error','fetchRepositoryData','repositoryName','handleCommitJobError','setStatus','../../salesforce/services/salesforce-sync.service','__metadata','getOwnPropertyDescriptor','getCommitDto','object','getComponentsToWrite','Completed',']\x20[Repository:\x20','1092760OidyFY','../../../../constants','Container','commitJob','syncRepositoryId','provider','3208203neXekJ','10LisqJY','apply','gitUrl','../../../../core/errors/bad-request.error','Tokens','config','map','constructor','1211357VXSzQo','name','ERR_UNKNOWN_SYNC_RECORD_ID','sha','\x20Start\x20Flosum\x20commit\x20job.','user','split','design:paramtypes','gitProvider','6XbOiky','708144SxyIUl','toUpperCase','../dto/commit-components.dto','FLOSUM_ATTACHMENT','../../providers/providers.tokens','message','defineProperty','decorate','convertToSFDX','getRepositoryRecord','trim','repository','exec','log','(((.+)+)+)+$','2rwHBeT','retrieveAttachment','../../../../core','default','commitAttachmentId','../../salesforce/services/salesforce.service','branches','metadata','BadRequestError','gitApiService','send','function','CommitComponentsDto','2002848qFCfTU','deleteAttachmentId','repoService','getComponentsToDelete','salesforceSync','salesforceService','Logger','Service','toString','../../salesforce/services/salesforce-retriever.service','deleteAttachment','then','syncBranchId','sfLogger','logger','search','repositoryData','run','shortid','FlosumCommitJob','__esModule','SalesforceRetrieverService','getBranchRecord','branch','prefix','__decorate','Error','branchName','length','updateLastCommit','repo','../../../../constants/errors'];a105_0x1470=function(){return _0x3ed100;};return a105_0x1470();}function a105_0xc429(_0x17ad70,_0x418597){const _0x3f23b8=a105_0x1470();return a105_0xc429=function(_0x3d1fbd,_0x32f2d1){_0x3d1fbd=_0x3d1fbd-0xd5;let _0x147089=_0x3f23b8[_0x3d1fbd];return _0x147089;},a105_0xc429(_0x17ad70,_0x418597);}(function(_0x197761,_0x56288b){const _0x3da0c3=a105_0xc429,_0x49e037=_0x197761();while(!![]){try{const _0x8c8693=parseInt(_0x3da0c3(0x100))/0x1*(parseInt(_0x3da0c3(0x13c))/0x2)+parseInt(_0x3da0c3(0x103))/0x3+-parseInt(_0x3da0c3(0x12d))/0x4+parseInt(_0x3da0c3(0x114))/0x5+parseInt(_0x3da0c3(0x12c))/0x6*(parseInt(_0x3da0c3(0x123))/0x7)+parseInt(_0x3da0c3(0xe0))/0x8+parseInt(_0x3da0c3(0x11a))/0x9*(-parseInt(_0x3da0c3(0x11b))/0xa);if(_0x8c8693===_0x56288b)break;else _0x49e037['push'](_0x49e037['shift']());}catch(_0x394e92){_0x49e037['push'](_0x49e037['shift']());}}}(a105_0x1470,0x3149c));const a105_0x32f2d1=(function(){let _0x42551a=!![];return function(_0x5e169a,_0x3d3179){const _0x1eadcf=_0x42551a?function(){const _0x1868d8=a105_0xc429;if(_0x3d3179){const _0x9b5cf8=_0x3d3179[_0x1868d8(0x11c)](_0x5e169a,arguments);return _0x3d3179=null,_0x9b5cf8;}}:function(){};return _0x42551a=![],_0x1eadcf;};}()),a105_0x3d1fbd=a105_0x32f2d1(this,function(){const _0x871653=a105_0xc429;return a105_0x3d1fbd[_0x871653(0xe8)]()[_0x871653(0xef)](_0x871653(0x13b))['toString']()[_0x871653(0x122)](a105_0x3d1fbd)['search'](_0x871653(0x13b));});a105_0x3d1fbd();'use strict';var __decorate=this&&this[a105_0x47da41(0xf9)]||function(_0x132988,_0x5a6195,_0x30a69f,_0xaf5e5c){const _0x45cce2=a105_0x47da41;var _0xd7c7aa=arguments[_0x45cce2(0xfc)],_0x10fdc1=_0xd7c7aa<0x3?_0x5a6195:_0xaf5e5c===null?_0xaf5e5c=Object[_0x45cce2(0x10e)](_0x5a6195,_0x30a69f):_0xaf5e5c,_0x560e4f;if(typeof Reflect==='object'&&typeof Reflect[_0x45cce2(0x134)]===_0x45cce2(0xde))_0x10fdc1=Reflect[_0x45cce2(0x134)](_0x132988,_0x5a6195,_0x30a69f,_0xaf5e5c);else{for(var _0x2c7994=_0x132988[_0x45cce2(0xfc)]-0x1;_0x2c7994>=0x0;_0x2c7994--)if(_0x560e4f=_0x132988[_0x2c7994])_0x10fdc1=(_0xd7c7aa<0x3?_0x560e4f(_0x10fdc1):_0xd7c7aa>0x3?_0x560e4f(_0x5a6195,_0x30a69f,_0x10fdc1):_0x560e4f(_0x5a6195,_0x30a69f))||_0x10fdc1;}return _0xd7c7aa>0x3&&_0x10fdc1&&Object[_0x45cce2(0x133)](_0x5a6195,_0x30a69f,_0x10fdc1),_0x10fdc1;},__metadata=this&&this[a105_0x47da41(0x10d)]||function(_0x3bcb6b,_0x593eff){const _0x407948=a105_0x47da41;if(typeof Reflect===_0x407948(0x110)&&typeof Reflect[_0x407948(0xda)]==='function')return Reflect[_0x407948(0xda)](_0x3bcb6b,_0x593eff);},__importDefault=this&&this['__importDefault']||function(_0x531996){const _0xf13532=a105_0x47da41;return _0x531996&&_0x531996[_0xf13532(0xf4)]?_0x531996:{'default':_0x531996};},FlosumCommitJob_1;Object[a105_0x47da41(0x133)](exports,'__esModule',{'value':!![]}),exports[a105_0x47da41(0xf3)]=void 0x0;const core_1=require(a105_0x47da41(0xd5)),salesforce_service_1=require(a105_0x47da41(0xd8)),typedi_1=require('typedi'),errors_1=require(a105_0x47da41(0xff)),bad_request_error_1=require(a105_0x47da41(0x11e)),salesforce_retriever_service_1=require(a105_0x47da41(0xe9)),salesforce_sync_service_1=require(a105_0x47da41(0x10c)),commit_components_dto_1=require(a105_0x47da41(0x12f)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a105_0x47da41(0x115)),shortid_1=__importDefault(require(a105_0x47da41(0xf2))),providers_tokens_1=require(a105_0x47da41(0x131));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x463daf,_0x4bcbad,_0x1e55f2){const _0x4eca36=a105_0x47da41;this[_0x4eca36(0xe5)]=_0x463daf,this[_0x4eca36(0x117)]=_0x4bcbad,this[_0x4eca36(0xe4)]=_0x1e55f2,this[_0x4eca36(0xee)]=new core_1[(_0x4eca36(0xe6))](FlosumCommitJob_1[_0x4eca36(0x124)]);}async[a105_0x47da41(0x108)](){const _0x2a8168=a105_0x47da41;try{if(this[_0x2a8168(0x101)][_0x2a8168(0x118)])this['repositoryData']=await this['salesforceSync'][_0x2a8168(0x136)](this[_0x2a8168(0x101)][_0x2a8168(0x118)]);else this[_0x2a8168(0x101)][_0x2a8168(0xec)]&&(this[_0x2a8168(0xf0)]=await this[_0x2a8168(0xe4)][_0x2a8168(0xf6)](this['commitData'][_0x2a8168(0xec)]));}catch(_0x4e84ec){throw new bad_request_error_1[(_0x2a8168(0xdb))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a105_0x47da41(0x111)](){const _0x4f5b5d=a105_0x47da41;if(!this[_0x4f5b5d(0x101)][_0x4f5b5d(0xd7)])return[];await this[_0x4f5b5d(0xe5)]['patchObject'](constants_1[_0x4f5b5d(0x130)],this[_0x4f5b5d(0x101)][_0x4f5b5d(0xd7)],{'Name':(0x0,shortid_1[_0x4f5b5d(0xd6)])()});const _0x2d2194=await this[_0x4f5b5d(0xe5)][_0x4f5b5d(0x13d)](this[_0x4f5b5d(0x101)][_0x4f5b5d(0xd7)])[_0x4f5b5d(0xeb)](_0x108fc2=>_0x108fc2[_0x4f5b5d(0x129)]('\x20')[_0x4f5b5d(0x121)](_0x18827d=>_0x18827d[_0x4f5b5d(0x137)]()));await this['salesforceService'][_0x4f5b5d(0xea)](this[_0x4f5b5d(0x101)][_0x4f5b5d(0xd7)]);const _0x4f558f=new salesforce_retriever_service_1[(_0x4f5b5d(0xf5))](this['salesforceService']);return await _0x4f558f[_0x4f5b5d(0xf1)](_0x2d2194);}async['getComponentsToDelete'](){const _0x397404=a105_0x47da41;if(!this[_0x397404(0x101)][_0x397404(0xe1)])return[];await this[_0x397404(0xe5)]['patchObject'](constants_1[_0x397404(0x130)],this[_0x397404(0x101)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0x397404(0xd6)])()});const _0x31be89=await this[_0x397404(0xe5)][_0x397404(0x13d)](this[_0x397404(0x101)]['deleteAttachmentId']);return await this[_0x397404(0xe5)][_0x397404(0xea)](this[_0x397404(0x101)]['deleteAttachmentId']),_0x31be89;}async['getCommitDto'](){const _0xbe3c14=a105_0x47da41,_0x27b6ad=new commit_components_dto_1[(_0xbe3c14(0xdf))](),[_0x24f270,_0x49ff1d]=await Promise['all']([this[_0xbe3c14(0x111)](),this[_0xbe3c14(0xe3)]()]);return _0x27b6ad[_0xbe3c14(0x132)]=this[_0xbe3c14(0x101)][_0xbe3c14(0x132)],_0x27b6ad[_0xbe3c14(0x128)]=this[_0xbe3c14(0x101)][_0xbe3c14(0x128)],_0x27b6ad['components']={'writed':_0x24f270,'deleted':_0x49ff1d},_0x27b6ad[_0xbe3c14(0x135)]=this[_0xbe3c14(0x120)][_0xbe3c14(0x105)],_0x27b6ad[_0xbe3c14(0xfe)]=this['repository'],_0x27b6ad[_0xbe3c14(0xf7)]=this[_0xbe3c14(0xf7)],_0x27b6ad[_0xbe3c14(0x119)]=this[_0xbe3c14(0x120)][_0xbe3c14(0x12b)],_0x27b6ad;}async[a105_0x47da41(0xfd)](_0x270aac=![]){const _0x2cd78f=a105_0x47da41;if(_0x270aac)await this[_0x2cd78f(0xe4)]['updateRemoteState'](this[_0x2cd78f(0xf0)],{});else{const _0x561f74=await this[_0x2cd78f(0x138)][_0x2cd78f(0xd9)][_0x2cd78f(0x104)](this['branch'][_0x2cd78f(0x124)]);this[_0x2cd78f(0xed)][_0x2cd78f(0x13a)](this['prefix']+_0x2cd78f(0x102));const _0x28bf77={[this['repository'][_0x2cd78f(0x11d)]]:{'lastCommit':_0x561f74[_0x2cd78f(0x126)]}};await this['salesforceSync']['updateRemoteState'](this[_0x2cd78f(0xf0)],_0x28bf77);}}async['exec'](){const _0xcbb428=a105_0x47da41,_0x280a20=await this[_0xcbb428(0x10f)]();await this['salesforceSync']['setStatus'](this['repositoryData'],'In\x20Progress'),await this['commitJob']['run'](_0x280a20,this['prefix']),await this['updateLastCommit'](),await this[_0xcbb428(0xe4)][_0xcbb428(0x10b)](this[_0xcbb428(0xf0)],_0xcbb428(0x112));}async['handleCommitJobError'](_0x2a74cc){const _0x21d1d7=a105_0x47da41;try{this[_0x21d1d7(0xed)][_0x21d1d7(0x107)](''+_0x2a74cc),await this['sfLogger'][_0x21d1d7(0xdd)](),await this[_0x21d1d7(0xfd)](!![]),await this['salesforceSync'][_0x21d1d7(0x10b)](this['repositoryData'],_0x21d1d7(0xfa));}catch(_0x1f0e0e){this[_0x21d1d7(0xee)][_0x21d1d7(0x107)](_0x1f0e0e);}}async[a105_0x47da41(0xf1)](_0x5a4c1b){const _0x4f22c4=a105_0x47da41;try{this[_0x4f22c4(0x101)]=_0x5a4c1b,this[_0x4f22c4(0xdc)]=typedi_1[_0x4f22c4(0x116)][_0x4f22c4(0x106)](providers_tokens_1[_0x4f22c4(0x11f)][_0x4f22c4(0xdc)]),this[_0x4f22c4(0xe2)]=typedi_1[_0x4f22c4(0x116)][_0x4f22c4(0x106)](providers_tokens_1['Tokens']['gitRepoService']),this[_0x4f22c4(0x120)]=typedi_1[_0x4f22c4(0x116)][_0x4f22c4(0x106)](providers_tokens_1[_0x4f22c4(0x11f)][_0x4f22c4(0x120)]),await this[_0x4f22c4(0x108)](),this[_0x4f22c4(0x138)]=await this['repoService'][_0x4f22c4(0x104)](this[_0x4f22c4(0xf0)][_0x4f22c4(0x109)]),this[_0x4f22c4(0xf7)]=await this['repository']['branches'][_0x4f22c4(0x104)](this[_0x4f22c4(0xf0)][_0x4f22c4(0xfb)]),this[_0x4f22c4(0xed)]=typedi_1[_0x4f22c4(0x116)][_0x4f22c4(0x106)](providers_tokens_1[_0x4f22c4(0x11f)][_0x4f22c4(0xee)]),this['prefix']='[FLOSUM\x20->\x20GIT]\x20['+this[_0x4f22c4(0x120)]['gitProvider'][_0x4f22c4(0x12e)]()+_0x4f22c4(0x113)+this['repositoryData']['repositoryName']+']\x20[Branch:\x20'+this[_0x4f22c4(0xf0)][_0x4f22c4(0xfb)]+']\x20['+FlosumCommitJob_1[_0x4f22c4(0x124)]+']';if(!this[_0x4f22c4(0xf0)])throw new bad_request_error_1[(_0x4f22c4(0xdb))](errors_1[_0x4f22c4(0x125)]);await this['sfLogger'][_0x4f22c4(0x13a)](this[_0x4f22c4(0xf8)]+_0x4f22c4(0x127))[_0x4f22c4(0xdd)](),await this[_0x4f22c4(0x139)]()['catch'](_0x18f716=>this[_0x4f22c4(0x10a)](_0x18f716));}catch(_0xf49097){this[_0x4f22c4(0x101)]=undefined,this[_0x4f22c4(0xee)][_0x4f22c4(0x107)](_0xf49097);throw _0xf49097;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x47da41(0xe7)])({'transient':!![]}),__metadata(a105_0x47da41(0x12a),[salesforce_service_1['SalesforceService'],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;