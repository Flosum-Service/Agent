const a105_0x397814=a105_0x34b8;function a105_0x2d92(){const _0x5755bc=['repoService','design:paramtypes','exec','repositoryName','Logger','../../../../constants/errors',']\x20[Repository:\x20',']\x20[','sfLogger','../../../../core','Container','In\x20Progress','[FLOSUM\x20->\x20GIT]\x20[','updateLastCommit','prefix','1mjoPGg','SalesforceSyncService','1614AcytEO','commitJob','branch','run','message','Tokens','toUpperCase','apply','branches','map','syncRepositoryId','branchName','SalesforceRetrieverService','deleteAttachment','__importDefault','650016RHFPDP','getComponentsToDelete','gitRepoService','send','all','CommitComponentsJob','log','\x20Start\x20Flosum\x20commit\x20job.','__decorate','gitUrl','../../providers/providers.tokens','../dto/commit-components.dto','default','salesforceService','1253mjsinP','updateRemoteState','metadata','../../../../constants','FLOSUM_ATTACHMENT','BadRequestError','decorate','deleteAttachmentId','ERR_UNKNOWN_SYNC_RECORD_ID','defineProperty','CommitComponentsDto',']\x20[Branch:\x20','patchObject','constructor','getRepositoryRecord','./commit-components.job','getOne','error','1606240FVhnNJ','logger','user','1689966mgorSw','salesforceSync','255134JDrAki','isConvertToSfdx','Error','get','Service','repositoryData','then','gitProvider','setStatus','212dEldGx','config','commitData','trim','4705TuHafS','repository','FlosumCommitJob','toString','\x20Update\x20remote\x20state.','commitAttachmentId','convertToSFDX','getOwnPropertyDescriptor','fetchRepositoryData','gitApiService','ERR_INVALID_SYNC_RECORD_ID','../../salesforce/services/salesforce-sync.service','(((.+)+)+)+$','length','components','__metadata','shortid','name','getCommitDto','typedi','object','handleCommitJobError','getComponentsToWrite','1802170iGPlNT','split'];a105_0x2d92=function(){return _0x5755bc;};return a105_0x2d92();}(function(_0x18129c,_0x5c8a32){const _0x26915a=a105_0x34b8,_0x5bb35b=_0x18129c();while(!![]){try{const _0x215ae2=parseInt(_0x26915a(0x178))/0x1*(parseInt(_0x26915a(0x143))/0x2)+parseInt(_0x26915a(0x189))/0x3+-parseInt(_0x26915a(0x14c))/0x4*(-parseInt(_0x26915a(0x150))/0x5)+-parseInt(_0x26915a(0x17a))/0x6*(parseInt(_0x26915a(0x197))/0x7)+-parseInt(_0x26915a(0x13e))/0x8+-parseInt(_0x26915a(0x141))/0x9+parseInt(_0x26915a(0x167))/0xa;if(_0x215ae2===_0x5c8a32)break;else _0x5bb35b['push'](_0x5bb35b['shift']());}catch(_0x235af0){_0x5bb35b['push'](_0x5bb35b['shift']());}}}(a105_0x2d92,0x21998));const a105_0x5b24c3=(function(){let _0x215969=!![];return function(_0x5abc9f,_0x20cec7){const _0x341215=_0x215969?function(){const _0x22020b=a105_0x34b8;if(_0x20cec7){const _0x5694cc=_0x20cec7[_0x22020b(0x181)](_0x5abc9f,arguments);return _0x20cec7=null,_0x5694cc;}}:function(){};return _0x215969=![],_0x341215;};}()),a105_0x1d3b76=a105_0x5b24c3(this,function(){const _0x408627=a105_0x34b8;return a105_0x1d3b76['toString']()['search'](_0x408627(0x15c))[_0x408627(0x153)]()[_0x408627(0x139)](a105_0x1d3b76)['search']('(((.+)+)+)+$');});a105_0x1d3b76();'use strict';var __decorate=this&&this[a105_0x397814(0x191)]||function(_0x209c2f,_0x2b471d,_0x156178,_0x4cf3d5){const _0x264955=a105_0x397814;var _0x362e87=arguments[_0x264955(0x15d)],_0x50b4a8=_0x362e87<0x3?_0x2b471d:_0x4cf3d5===null?_0x4cf3d5=Object[_0x264955(0x157)](_0x2b471d,_0x156178):_0x4cf3d5,_0x499950;if(typeof Reflect===_0x264955(0x164)&&typeof Reflect[_0x264955(0x19d)]==='function')_0x50b4a8=Reflect[_0x264955(0x19d)](_0x209c2f,_0x2b471d,_0x156178,_0x4cf3d5);else{for(var _0x3c8fa7=_0x209c2f['length']-0x1;_0x3c8fa7>=0x0;_0x3c8fa7--)if(_0x499950=_0x209c2f[_0x3c8fa7])_0x50b4a8=(_0x362e87<0x3?_0x499950(_0x50b4a8):_0x362e87>0x3?_0x499950(_0x2b471d,_0x156178,_0x50b4a8):_0x499950(_0x2b471d,_0x156178))||_0x50b4a8;}return _0x362e87>0x3&&_0x50b4a8&&Object[_0x264955(0x1a0)](_0x2b471d,_0x156178,_0x50b4a8),_0x50b4a8;},__metadata=this&&this[a105_0x397814(0x15f)]||function(_0x2af40a,_0x439a2f){const _0x219900=a105_0x397814;if(typeof Reflect===_0x219900(0x164)&&typeof Reflect[_0x219900(0x199)]==='function')return Reflect[_0x219900(0x199)](_0x2af40a,_0x439a2f);},__importDefault=this&&this[a105_0x397814(0x188)]||function(_0x5a9f7c){return _0x5a9f7c&&_0x5a9f7c['__esModule']?_0x5a9f7c:{'default':_0x5a9f7c};},FlosumCommitJob_1;Object[a105_0x397814(0x1a0)](exports,'__esModule',{'value':!![]}),exports[a105_0x397814(0x152)]=void 0x0;function a105_0x34b8(_0x47fbfd,_0x4488ef){const _0x4326d3=a105_0x2d92();return a105_0x34b8=function(_0x1d3b76,_0x5b24c3){_0x1d3b76=_0x1d3b76-0x138;let _0x2d921d=_0x4326d3[_0x1d3b76];return _0x2d921d;},a105_0x34b8(_0x47fbfd,_0x4488ef);}const core_1=require(a105_0x397814(0x172)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a105_0x397814(0x163)),errors_1=require(a105_0x397814(0x16e)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require(a105_0x397814(0x15b)),commit_components_dto_1=require(a105_0x397814(0x194)),commit_components_job_1=require(a105_0x397814(0x13b)),constants_1=require(a105_0x397814(0x19a)),shortid_1=__importDefault(require(a105_0x397814(0x160))),providers_tokens_1=require(a105_0x397814(0x193));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x1913ad,_0x1730fd,_0xcfc32){const _0x332508=a105_0x397814;this[_0x332508(0x196)]=_0x1913ad,this[_0x332508(0x17b)]=_0x1730fd,this['salesforceSync']=_0xcfc32,this[_0x332508(0x13f)]=new core_1[(_0x332508(0x16d))](FlosumCommitJob_1['name']);}async[a105_0x397814(0x158)](){const _0x17b376=a105_0x397814;try{if(this['commitData']['syncRepositoryId'])this[_0x17b376(0x148)]=await this[_0x17b376(0x142)][_0x17b376(0x13a)](this[_0x17b376(0x14e)][_0x17b376(0x184)]);else this['commitData']['syncBranchId']&&(this[_0x17b376(0x148)]=await this[_0x17b376(0x142)]['getBranchRecord'](this[_0x17b376(0x14e)]['syncBranchId']));}catch(_0x2a5fbe){throw new bad_request_error_1[(_0x17b376(0x19c))](errors_1[_0x17b376(0x15a)]);}}async[a105_0x397814(0x166)](){const _0x5a81b5=a105_0x397814;if(!this[_0x5a81b5(0x14e)][_0x5a81b5(0x155)])return[];await this['salesforceService'][_0x5a81b5(0x138)](constants_1[_0x5a81b5(0x19b)],this[_0x5a81b5(0x14e)][_0x5a81b5(0x155)],{'Name':(0x0,shortid_1[_0x5a81b5(0x195)])()});const _0x5ddc60=await this[_0x5a81b5(0x196)]['retrieveAttachment'](this['commitData'][_0x5a81b5(0x155)])[_0x5a81b5(0x149)](_0xf920c7=>_0xf920c7[_0x5a81b5(0x168)]('\x20')[_0x5a81b5(0x183)](_0x273a36=>_0x273a36[_0x5a81b5(0x14f)]()));await this[_0x5a81b5(0x196)][_0x5a81b5(0x187)](this[_0x5a81b5(0x14e)]['commitAttachmentId']);const _0x39ddcf=new salesforce_retriever_service_1[(_0x5a81b5(0x186))](this[_0x5a81b5(0x196)]);return await _0x39ddcf[_0x5a81b5(0x17d)](_0x5ddc60);}async[a105_0x397814(0x18a)](){const _0x59d51f=a105_0x397814;if(!this[_0x59d51f(0x14e)][_0x59d51f(0x19e)])return[];await this['salesforceService']['patchObject'](constants_1[_0x59d51f(0x19b)],this[_0x59d51f(0x14e)][_0x59d51f(0x19e)],{'Name':(0x0,shortid_1[_0x59d51f(0x195)])()});const _0x1049f6=await this[_0x59d51f(0x196)]['retrieveAttachment'](this[_0x59d51f(0x14e)][_0x59d51f(0x19e)]);return await this[_0x59d51f(0x196)][_0x59d51f(0x187)](this['commitData'][_0x59d51f(0x19e)]),_0x1049f6;}async[a105_0x397814(0x162)](){const _0x2bc362=a105_0x397814,_0x5f3617=new commit_components_dto_1[(_0x2bc362(0x1a1))](),[_0x46da0d,_0x1435e4]=await Promise[_0x2bc362(0x18d)]([this[_0x2bc362(0x166)](),this['getComponentsToDelete']()]);return _0x5f3617[_0x2bc362(0x17e)]=this['commitData'][_0x2bc362(0x17e)],_0x5f3617[_0x2bc362(0x140)]=this[_0x2bc362(0x14e)]['user'],_0x5f3617[_0x2bc362(0x15e)]={'writed':_0x46da0d,'deleted':_0x1435e4},_0x5f3617[_0x2bc362(0x156)]=this[_0x2bc362(0x14d)][_0x2bc362(0x144)],_0x5f3617['repo']=this['repository'],_0x5f3617['branch']=this[_0x2bc362(0x17c)],_0x5f3617['provider']=this[_0x2bc362(0x14d)][_0x2bc362(0x14a)],_0x5f3617;}async[a105_0x397814(0x176)](_0x4af157=![]){const _0x62690f=a105_0x397814;if(_0x4af157)await this[_0x62690f(0x142)][_0x62690f(0x198)](this[_0x62690f(0x148)],{});else{const _0x597e8c=await this[_0x62690f(0x151)][_0x62690f(0x182)][_0x62690f(0x13c)](this['branch'][_0x62690f(0x161)]);this[_0x62690f(0x171)][_0x62690f(0x18f)](this[_0x62690f(0x177)]+_0x62690f(0x154));const _0x2bfff5={[this[_0x62690f(0x151)][_0x62690f(0x192)]]:{'lastCommit':_0x597e8c['sha']}};await this['salesforceSync'][_0x62690f(0x198)](this[_0x62690f(0x148)],_0x2bfff5);}}async[a105_0x397814(0x16b)](){const _0x1f29e3=a105_0x397814,_0x46245a=await this[_0x1f29e3(0x162)]();await this['salesforceSync']['setStatus'](this[_0x1f29e3(0x148)],_0x1f29e3(0x174)),await this[_0x1f29e3(0x17b)][_0x1f29e3(0x17d)](_0x46245a,this[_0x1f29e3(0x177)]),await this[_0x1f29e3(0x176)](),await this[_0x1f29e3(0x142)]['setStatus'](this[_0x1f29e3(0x148)],'Completed');}async[a105_0x397814(0x165)](_0x35bdfd){const _0x5c9bcb=a105_0x397814;try{this[_0x5c9bcb(0x171)]['error'](''+_0x35bdfd),await this[_0x5c9bcb(0x171)][_0x5c9bcb(0x18c)](),await this['updateLastCommit'](!![]),await this['salesforceSync'][_0x5c9bcb(0x14b)](this[_0x5c9bcb(0x148)],_0x5c9bcb(0x145));}catch(_0x3bdb3a){this[_0x5c9bcb(0x13f)]['error'](_0x3bdb3a);}}async['run'](_0x13d510){const _0x24fd70=a105_0x397814;try{this[_0x24fd70(0x14e)]=_0x13d510,this[_0x24fd70(0x159)]=typedi_1[_0x24fd70(0x173)][_0x24fd70(0x146)](providers_tokens_1[_0x24fd70(0x17f)][_0x24fd70(0x159)]),this[_0x24fd70(0x169)]=typedi_1[_0x24fd70(0x173)][_0x24fd70(0x146)](providers_tokens_1[_0x24fd70(0x17f)][_0x24fd70(0x18b)]),this['config']=typedi_1['Container'][_0x24fd70(0x146)](providers_tokens_1[_0x24fd70(0x17f)][_0x24fd70(0x14d)]),await this[_0x24fd70(0x158)](),this['repository']=await this[_0x24fd70(0x169)][_0x24fd70(0x13c)](this[_0x24fd70(0x148)]['repositoryName']),this[_0x24fd70(0x17c)]=await this[_0x24fd70(0x151)][_0x24fd70(0x182)][_0x24fd70(0x13c)](this[_0x24fd70(0x148)][_0x24fd70(0x185)]),this['sfLogger']=typedi_1['Container'][_0x24fd70(0x146)](providers_tokens_1['Tokens'][_0x24fd70(0x13f)]),this[_0x24fd70(0x177)]=_0x24fd70(0x175)+this[_0x24fd70(0x14d)][_0x24fd70(0x14a)][_0x24fd70(0x180)]()+_0x24fd70(0x16f)+this['repositoryData'][_0x24fd70(0x16c)]+_0x24fd70(0x1a2)+this[_0x24fd70(0x148)][_0x24fd70(0x185)]+_0x24fd70(0x170)+FlosumCommitJob_1[_0x24fd70(0x161)]+']';if(!this[_0x24fd70(0x148)])throw new bad_request_error_1[(_0x24fd70(0x19c))](errors_1[_0x24fd70(0x19f)]);await this[_0x24fd70(0x171)]['log'](this[_0x24fd70(0x177)]+_0x24fd70(0x190))[_0x24fd70(0x18c)](),await this[_0x24fd70(0x16b)]()['catch'](_0x16a863=>this[_0x24fd70(0x165)](_0x16a863));}catch(_0xce0a53){this[_0x24fd70(0x14e)]=undefined,this['logger'][_0x24fd70(0x13d)](_0xce0a53);throw _0xce0a53;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x397814(0x147)])({'transient':!![]}),__metadata(a105_0x397814(0x16a),[salesforce_service_1['SalesforceService'],commit_components_job_1[a105_0x397814(0x18e)],salesforce_sync_service_1[a105_0x397814(0x179)]])],FlosumCommitJob),exports[a105_0x397814(0x152)]=FlosumCommitJob;