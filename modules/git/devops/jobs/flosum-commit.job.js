const a125_0x40e06f=a125_0x33bb;function a125_0x43e9(){const _0x3e751a=['gitUrl','trim','Error','run','repoService','message','7492243JMDQRl','commitData','exec','SalesforceRetrieverService','recordTypeName','(((.+)+)+)+$','catch','user','6855816XSpHsI','name','prefix','logger','length','repository','getCommitDto','get',']\x20[','CommitComponentsJob','email','toString','salesforceSync','typedi','Service','decorate','BadRequestError','CommitComponentsDto','deleteAttachment','getOwnPropertyDescriptor','CommitToGitErrorNotification','__metadata','branches','ERR_UNKNOWN_SYNC_RECORD_ID','syncBranchId','getComponentsToDelete','getBranchRecord','1506gdnkWb','updateRemoteState','Tokens','function','Email\x20notifications\x20are\x20disabled.','execute','getComponentsToWrite','deleteAttachmentId','ERR_INVALID_SYNC_RECORD_ID','error',']\x20[Repository:\x20','575746ZJUfLf','fetchRepositoryData','./commit-components.job','isEmailNotificationsEnabled','87984Uagbys','2STsqbA','150KroeGP','CommitToGitCompletedNotification','commitJob','sha','../../../../constants/errors','51544jxgVJZ','\x20Update\x20remote\x20state.','26306vqcCtu','search','Completed','patchObject','recordType','salesforceService','../../salesforce/services/salesforce.service','config','../../../../core','setStatus','updateLastCommit','default','3582520PMpiYs','shortid','../../notifications/commit-to-git-completed.notification','repo','syncRepositoryId','defineProperty','repositoryData','provider','SalesforceSyncService','map','gitRepoService','getOne','__esModule','Logger','branchName','6OxYzUG','split','design:paramtypes','FLOSUM_ATTACHMENT','apply','then','../../notifications/commit-to-git-error.notification',']\x20[Branch:\x20','\x20Start\x20Flosum\x20commit\x20job.','__decorate','Container','retrieveAttachment','gitProvider','FlosumCommitJob','errorNotification','../../salesforce/services/salesforce-retriever.service','[FLOSUM\x20->\x20GIT]\x20[','commitAttachmentId','info','log','branch','sfLogger','object','completeNotification','../../../../constants','toUpperCase','repositoryName'];a125_0x43e9=function(){return _0x3e751a;};return a125_0x43e9();}(function(_0x4590a4,_0x59dd3d){const _0x2828b5=a125_0x33bb,_0x29d3ea=_0x4590a4();while(!![]){try{const _0x5ccab9=-parseInt(_0x2828b5(0x21a))/0x1*(-parseInt(_0x2828b5(0x215))/0x2)+-parseInt(_0x2828b5(0x1c6))/0x3*(parseInt(_0x2828b5(0x220))/0x4)+parseInt(_0x2828b5(0x1b7))/0x5+-parseInt(_0x2828b5(0x20a))/0x6*(-parseInt(_0x2828b5(0x222))/0x7)+-parseInt(_0x2828b5(0x1ef))/0x8+-parseInt(_0x2828b5(0x219))/0x9*(parseInt(_0x2828b5(0x21b))/0xa)+-parseInt(_0x2828b5(0x1e7))/0xb;if(_0x5ccab9===_0x59dd3d)break;else _0x29d3ea['push'](_0x29d3ea['shift']());}catch(_0x4aa7b8){_0x29d3ea['push'](_0x29d3ea['shift']());}}}(a125_0x43e9,0x802ce));const a125_0x5802ea=(function(){let _0x45f3b7=!![];return function(_0x19e6ee,_0xba54f6){const _0x224800=_0x45f3b7?function(){const _0x651135=a125_0x33bb;if(_0xba54f6){const _0x543ec9=_0xba54f6[_0x651135(0x1ca)](_0x19e6ee,arguments);return _0xba54f6=null,_0x543ec9;}}:function(){};return _0x45f3b7=![],_0x224800;};}()),a125_0x16073b=a125_0x5802ea(this,function(){const _0x5058b3=a125_0x33bb;return a125_0x16073b[_0x5058b3(0x1fa)]()[_0x5058b3(0x223)]('(((.+)+)+)+$')[_0x5058b3(0x1fa)]()['constructor'](a125_0x16073b)[_0x5058b3(0x223)](_0x5058b3(0x1ec));});a125_0x16073b();'use strict';function a125_0x33bb(_0x188964,_0x34ddfd){const _0x486a97=a125_0x43e9();return a125_0x33bb=function(_0x16073b,_0x5802ea){_0x16073b=_0x16073b-0x1b3;let _0x43e99e=_0x486a97[_0x16073b];return _0x43e99e;},a125_0x33bb(_0x188964,_0x34ddfd);}var __decorate=this&&this[a125_0x40e06f(0x1cf)]||function(_0x2c69fa,_0x44fc67,_0xe5eca8,_0x2572dc){const _0xa9575d=a125_0x40e06f;var _0x4f0639=arguments[_0xa9575d(0x1f3)],_0x4f6161=_0x4f0639<0x3?_0x44fc67:_0x2572dc===null?_0x2572dc=Object[_0xa9575d(0x202)](_0x44fc67,_0xe5eca8):_0x2572dc,_0x2aa624;if(typeof Reflect==='object'&&typeof Reflect[_0xa9575d(0x1fe)]===_0xa9575d(0x20d))_0x4f6161=Reflect[_0xa9575d(0x1fe)](_0x2c69fa,_0x44fc67,_0xe5eca8,_0x2572dc);else{for(var _0x258bc5=_0x2c69fa[_0xa9575d(0x1f3)]-0x1;_0x258bc5>=0x0;_0x258bc5--)if(_0x2aa624=_0x2c69fa[_0x258bc5])_0x4f6161=(_0x4f0639<0x3?_0x2aa624(_0x4f6161):_0x4f0639>0x3?_0x2aa624(_0x44fc67,_0xe5eca8,_0x4f6161):_0x2aa624(_0x44fc67,_0xe5eca8))||_0x4f6161;}return _0x4f0639>0x3&&_0x4f6161&&Object[_0xa9575d(0x1bc)](_0x44fc67,_0xe5eca8,_0x4f6161),_0x4f6161;},__metadata=this&&this[a125_0x40e06f(0x204)]||function(_0x186691,_0x245cc5){const _0x1a3f59=a125_0x40e06f;if(typeof Reflect===_0x1a3f59(0x1dc)&&typeof Reflect['metadata']===_0x1a3f59(0x20d))return Reflect['metadata'](_0x186691,_0x245cc5);},__importDefault=this&&this['__importDefault']||function(_0x1b4ba4){return _0x1b4ba4&&_0x1b4ba4['__esModule']?_0x1b4ba4:{'default':_0x1b4ba4};},FlosumCommitJob_1;Object[a125_0x40e06f(0x1bc)](exports,a125_0x40e06f(0x1c3),{'value':!![]}),exports[a125_0x40e06f(0x1d3)]=void 0x0;const core_1=require(a125_0x40e06f(0x1b3)),salesforce_service_1=require(a125_0x40e06f(0x228)),typedi_1=require(a125_0x40e06f(0x1fc)),errors_1=require(a125_0x40e06f(0x21f)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a125_0x40e06f(0x1d5)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a125_0x40e06f(0x217)),constants_1=require(a125_0x40e06f(0x1de)),shortid_1=__importDefault(require(a125_0x40e06f(0x1b8))),providers_tokens_1=require('../../providers/providers.tokens'),commit_to_git_completed_notification_1=require(a125_0x40e06f(0x1b9)),commit_to_git_error_notification_1=require(a125_0x40e06f(0x1cc));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x37c09d,_0xb6f60e,_0x347b1e){const _0x543fcf=a125_0x40e06f;this['salesforceService']=_0x37c09d,this[_0x543fcf(0x21d)]=_0xb6f60e,this[_0x543fcf(0x1fb)]=_0x347b1e,this[_0x543fcf(0x1f2)]=new core_1[(_0x543fcf(0x1c4))](FlosumCommitJob_1['name']);}async[a125_0x40e06f(0x1dd)](_0x57734b,_0x1c12ca,_0x572bdb,_0x1d2679){const _0x10d402=a125_0x40e06f;if(!this[_0x10d402(0x1e8)]['isEmailNotificationsEnabled']){this[_0x10d402(0x1f2)]['info'](_0x10d402(0x20e));return;}await new commit_to_git_completed_notification_1[(_0x10d402(0x21c))]({'emails':_0x57734b,'gitProvider':_0x1c12ca,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1[_0x10d402(0x21c)]['name'],'repositoryName':_0x572bdb,'branchName':_0x1d2679})[_0x10d402(0x20f)]();}async[a125_0x40e06f(0x1d4)](_0xd72ed4,_0x445780,_0x5d6746,_0x2569bc){const _0x30f519=a125_0x40e06f;if(!this[_0x30f519(0x1e8)][_0x30f519(0x218)]){this[_0x30f519(0x1f2)][_0x30f519(0x1d8)]('Email\x20notifications\x20are\x20disabled.');return;}await new commit_to_git_error_notification_1[(_0x30f519(0x203))]({'emails':_0xd72ed4,'gitProvider':_0x445780,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0x30f519(0x203)][_0x30f519(0x1f0)],'repositoryName':_0x5d6746,'branchName':_0x2569bc})[_0x30f519(0x20f)]();}async[a125_0x40e06f(0x216)](){const _0x2ee085=a125_0x40e06f;try{if(this[_0x2ee085(0x1e8)][_0x2ee085(0x1bb)])this[_0x2ee085(0x1bd)]=await this[_0x2ee085(0x1fb)]['getRepositoryRecord'](this[_0x2ee085(0x1e8)]['syncRepositoryId']);else this[_0x2ee085(0x1e8)][_0x2ee085(0x207)]&&(this[_0x2ee085(0x1bd)]=await this['salesforceSync'][_0x2ee085(0x209)](this[_0x2ee085(0x1e8)][_0x2ee085(0x207)]));}catch(_0x3ccb6e){throw new bad_request_error_1[(_0x2ee085(0x1ff))](errors_1[_0x2ee085(0x212)]);}}async['getComponentsToWrite'](){const _0x3de47b=a125_0x40e06f;if(!this[_0x3de47b(0x1e8)]['commitAttachmentId'])return[];await this[_0x3de47b(0x227)][_0x3de47b(0x225)](constants_1[_0x3de47b(0x1c9)],this['commitData'][_0x3de47b(0x1d7)],{'Name':(0x0,shortid_1[_0x3de47b(0x1b6)])()});const _0x3f167b=await this['salesforceService'][_0x3de47b(0x1d1)](this[_0x3de47b(0x1e8)][_0x3de47b(0x1d7)])[_0x3de47b(0x1cb)](_0x17bf0f=>_0x17bf0f[_0x3de47b(0x1c7)]('\x20')[_0x3de47b(0x1c0)](_0x193821=>_0x193821[_0x3de47b(0x1e2)]()));await this[_0x3de47b(0x227)][_0x3de47b(0x201)](this[_0x3de47b(0x1e8)]['commitAttachmentId']);const _0x3effc5=new salesforce_retriever_service_1[(_0x3de47b(0x1ea))](this[_0x3de47b(0x227)]);return await _0x3effc5['run'](_0x3f167b);}async[a125_0x40e06f(0x208)](){const _0x110c2c=a125_0x40e06f;if(!this['commitData']['deleteAttachmentId'])return[];await this[_0x110c2c(0x227)][_0x110c2c(0x225)](constants_1[_0x110c2c(0x1c9)],this['commitData'][_0x110c2c(0x211)],{'Name':(0x0,shortid_1[_0x110c2c(0x1b6)])()});const _0x23a513=await this[_0x110c2c(0x227)][_0x110c2c(0x1d1)](this[_0x110c2c(0x1e8)]['deleteAttachmentId']),_0x16e035=JSON['parse'](_0x23a513);return await this[_0x110c2c(0x227)][_0x110c2c(0x201)](this['commitData'][_0x110c2c(0x211)]),_0x16e035;}async[a125_0x40e06f(0x1f5)](){const _0x3fc3d9=a125_0x40e06f,_0x3f13fd=new commit_components_dto_1[(_0x3fc3d9(0x200))](),[_0x1ac6ea,_0x136b2e]=await Promise['all']([this[_0x3fc3d9(0x210)](),this['getComponentsToDelete']()]);return _0x3f13fd['message']=this['commitData'][_0x3fc3d9(0x1e6)],_0x3f13fd[_0x3fc3d9(0x1ee)]=this[_0x3fc3d9(0x1e8)][_0x3fc3d9(0x1ee)],_0x3f13fd['components']={'writed':_0x1ac6ea,'deleted':_0x136b2e},_0x3f13fd['convertToSFDX']=this[_0x3fc3d9(0x229)]['isConvertToSfdx'],_0x3f13fd[_0x3fc3d9(0x1ba)]=this[_0x3fc3d9(0x1f4)],_0x3f13fd['branch']=this['branch'],_0x3f13fd[_0x3fc3d9(0x1be)]=this['config']['gitProvider'],_0x3f13fd[_0x3fc3d9(0x226)]=this[_0x3fc3d9(0x1bd)][_0x3fc3d9(0x1eb)],_0x3f13fd;}async['updateLastCommit'](_0x21f58a=![]){const _0x1a9b9c=a125_0x40e06f;if(_0x21f58a)await this[_0x1a9b9c(0x1fb)]['updateRemoteState'](this[_0x1a9b9c(0x1bd)],{});else{const _0x337d61=await this[_0x1a9b9c(0x1f4)][_0x1a9b9c(0x205)][_0x1a9b9c(0x1c2)](this['branch'][_0x1a9b9c(0x1f0)]);this['sfLogger'][_0x1a9b9c(0x1d9)](this[_0x1a9b9c(0x1f1)]+_0x1a9b9c(0x221));const _0x4fed08={[this[_0x1a9b9c(0x1f4)][_0x1a9b9c(0x1e1)]]:{'lastCommit':_0x337d61[_0x1a9b9c(0x21e)]}};await this['salesforceSync'][_0x1a9b9c(0x20b)](this[_0x1a9b9c(0x1bd)],_0x4fed08);}}async['exec'](){const _0x584bea=a125_0x40e06f,_0x4003f4=await this[_0x584bea(0x1f5)]();await this[_0x584bea(0x1fb)][_0x584bea(0x1b4)](this[_0x584bea(0x1bd)],'In\x20Progress'),await this['commitJob'][_0x584bea(0x1e4)](_0x4003f4,this[_0x584bea(0x1f1)]),await this[_0x584bea(0x1b5)](),await this[_0x584bea(0x1fb)][_0x584bea(0x1b4)](this[_0x584bea(0x1bd)],_0x584bea(0x224));}async['handleCommitJobError'](_0x10434f){const _0xe1b43b=a125_0x40e06f;try{this[_0xe1b43b(0x1db)][_0xe1b43b(0x213)](''+_0x10434f),await this[_0xe1b43b(0x1db)]['send'](),await this['updateLastCommit'](!![]),await this[_0xe1b43b(0x1fb)][_0xe1b43b(0x1b4)](this['repositoryData'],_0xe1b43b(0x1e3)),await this[_0xe1b43b(0x1dd)]([this['commitData'][_0xe1b43b(0x1ee)][_0xe1b43b(0x1f9)]],this[_0xe1b43b(0x229)][_0xe1b43b(0x1d2)],this[_0xe1b43b(0x1f4)][_0xe1b43b(0x1f0)],this['branch']['name']);}catch(_0x49aa06){this[_0xe1b43b(0x1f2)][_0xe1b43b(0x213)](_0x49aa06),await this[_0xe1b43b(0x1d4)]([this['commitData'][_0xe1b43b(0x1ee)]['email']],this[_0xe1b43b(0x229)][_0xe1b43b(0x1d2)],this[_0xe1b43b(0x1f4)][_0xe1b43b(0x1f0)],this[_0xe1b43b(0x1da)]['name']);}}async['run'](_0x36451f){const _0x20234a=a125_0x40e06f;try{this[_0x20234a(0x1e8)]=_0x36451f,this['gitApiService']=typedi_1[_0x20234a(0x1d0)][_0x20234a(0x1f6)](providers_tokens_1[_0x20234a(0x20c)]['gitApiService']),this[_0x20234a(0x1e5)]=typedi_1[_0x20234a(0x1d0)][_0x20234a(0x1f6)](providers_tokens_1['Tokens'][_0x20234a(0x1c1)]),this[_0x20234a(0x229)]=typedi_1[_0x20234a(0x1d0)][_0x20234a(0x1f6)](providers_tokens_1['Tokens']['config']),await this[_0x20234a(0x216)](),this[_0x20234a(0x1f4)]=await this[_0x20234a(0x1e5)]['getOne'](this[_0x20234a(0x1bd)][_0x20234a(0x1e0)]),this['branch']=await this[_0x20234a(0x1f4)][_0x20234a(0x205)][_0x20234a(0x1c2)](this[_0x20234a(0x1bd)][_0x20234a(0x1c5)]),this[_0x20234a(0x1db)]=typedi_1[_0x20234a(0x1d0)][_0x20234a(0x1f6)](providers_tokens_1['Tokens']['logger']),this[_0x20234a(0x1f1)]=_0x20234a(0x1d6)+this[_0x20234a(0x229)][_0x20234a(0x1d2)][_0x20234a(0x1df)]()+_0x20234a(0x214)+this[_0x20234a(0x1bd)][_0x20234a(0x1e0)]+_0x20234a(0x1cd)+this[_0x20234a(0x1bd)][_0x20234a(0x1c5)]+_0x20234a(0x1f7)+FlosumCommitJob_1[_0x20234a(0x1f0)]+']';if(!this['repositoryData'])throw new bad_request_error_1['BadRequestError'](errors_1[_0x20234a(0x206)]);await this[_0x20234a(0x1db)][_0x20234a(0x1d9)](this['prefix']+_0x20234a(0x1ce))['send'](),await this[_0x20234a(0x1e9)]()[_0x20234a(0x1ed)](_0x55cf62=>this['handleCommitJobError'](_0x55cf62)),await this['completeNotification']([this[_0x20234a(0x1e8)]['user']['email']],this[_0x20234a(0x229)][_0x20234a(0x1d2)],this[_0x20234a(0x1f4)]['name'],this[_0x20234a(0x1da)][_0x20234a(0x1f0)]);}catch(_0x3c326e){this[_0x20234a(0x1e8)]=undefined,this[_0x20234a(0x1f2)][_0x20234a(0x213)](_0x3c326e),await this['errorNotification']([this[_0x20234a(0x1e8)][_0x20234a(0x1ee)][_0x20234a(0x1f9)]],this[_0x20234a(0x229)][_0x20234a(0x1d2)],this['repository']['name'],this[_0x20234a(0x1da)][_0x20234a(0x1f0)]);throw _0x3c326e;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a125_0x40e06f(0x1fd)])({'transient':!![]}),__metadata(a125_0x40e06f(0x1c8),[salesforce_service_1['SalesforceService'],commit_components_job_1[a125_0x40e06f(0x1f8)],salesforce_sync_service_1[a125_0x40e06f(0x1bf)]])],FlosumCommitJob),exports[a125_0x40e06f(0x1d3)]=FlosumCommitJob;