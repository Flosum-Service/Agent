const a105_0x37e258=a105_0x3388;(function(_0x4c67b5,_0x1a707b){const _0x28ccda=a105_0x3388,_0x59cfca=_0x4c67b5();while(!![]){try{const _0x21be94=parseInt(_0x28ccda(0x1fd))/0x1*(-parseInt(_0x28ccda(0x199))/0x2)+-parseInt(_0x28ccda(0x196))/0x3+parseInt(_0x28ccda(0x1b8))/0x4+parseInt(_0x28ccda(0x1cb))/0x5+parseInt(_0x28ccda(0x1d3))/0x6+-parseInt(_0x28ccda(0x1fb))/0x7*(-parseInt(_0x28ccda(0x1ab))/0x8)+-parseInt(_0x28ccda(0x1f0))/0x9*(parseInt(_0x28ccda(0x1cf))/0xa);if(_0x21be94===_0x1a707b)break;else _0x59cfca['push'](_0x59cfca['shift']());}catch(_0xc6809d){_0x59cfca['push'](_0x59cfca['shift']());}}}(a105_0x4e0e,0x83a3b));const a105_0x1559ac=(function(){let _0xfba0e4=!![];return function(_0xc4e3b0,_0x423607){const _0xe5c388=_0xfba0e4?function(){const _0x352342=a105_0x3388;if(_0x423607){const _0x41cc35=_0x423607[_0x352342(0x1dd)](_0xc4e3b0,arguments);return _0x423607=null,_0x41cc35;}}:function(){};return _0xfba0e4=![],_0xe5c388;};}()),a105_0x358721=a105_0x1559ac(this,function(){const _0x1490d7=a105_0x3388;return a105_0x358721[_0x1490d7(0x1c9)]()[_0x1490d7(0x1c7)](_0x1490d7(0x1ac))[_0x1490d7(0x1c9)]()['constructor'](a105_0x358721)[_0x1490d7(0x1c7)](_0x1490d7(0x1ac));});function a105_0x3388(_0xb13545,_0x67135a){const _0x5286d5=a105_0x4e0e();return a105_0x3388=function(_0x358721,_0x1559ac){_0x358721=_0x358721-0x196;let _0x4e0ef4=_0x5286d5[_0x358721];return _0x4e0ef4;},a105_0x3388(_0xb13545,_0x67135a);}a105_0x358721();'use strict';function a105_0x4e0e(){const _0x2671a6=['user','salesforceService','map','__decorate','length','metadata','\x20Update\x20remote\x20state.','logger','commitData','35IpDzbL','branch','1JiTfNc','catch','salesforceSync','2279040kEEoIg','split','run','1607098IYuBRs','all','__metadata','getOwnPropertyDescriptor','gitProvider','Error','object','prefix','\x20Start\x20Flosum\x20commit\x20job.','gitApiService','sha','repository','getCommitDto','repositoryData','getOne','In\x20Progress','function','log','1391608mWEcvW','(((.+)+)+)+$','then','FLOSUM_ATTACHMENT','get','../../../../constants/errors','commitAttachmentId','Container','setStatus','FlosumCommitJob','config','../../../../core','typedi','2944304WdQtmk','branchName','getComponentsToWrite','provider','design:paramtypes','isConvertToSfdx','decorate','Service','deleteAttachment','message','ERR_UNKNOWN_SYNC_RECORD_ID','gitRepoService','Completed','getRepositoryRecord','updateRemoteState','search','convertToSFDX','toString','repositoryName','3600805HaYUcr','Tokens','__importDefault','repoService','9189060SGNHdZ','updateLastCommit','name','SalesforceService','4172028shYCzq','commitJob','../../salesforce/services/salesforce-retriever.service','exec','sfLogger','default','./commit-components.job','send',']\x20[',']\x20[Repository:\x20','apply','handleCommitJobError','../../salesforce/services/salesforce-sync.service','repo','trim','__esModule','fetchRepositoryData','Logger','deleteAttachmentId','getBranchRecord','../../providers/providers.tokens','syncRepositoryId','CommitComponentsDto','components','syncBranchId','CommitComponentsJob',']\x20[Branch:\x20','error','getComponentsToDelete','9HglMmZ','BadRequestError'];a105_0x4e0e=function(){return _0x2671a6;};return a105_0x4e0e();}var __decorate=this&&this[a105_0x37e258(0x1f5)]||function(_0x33627e,_0xaaeebb,_0x37c172,_0x1d5027){const _0x2a9143=a105_0x37e258;var _0x54d25e=arguments[_0x2a9143(0x1f6)],_0x3ec461=_0x54d25e<0x3?_0xaaeebb:_0x1d5027===null?_0x1d5027=Object[_0x2a9143(0x19c)](_0xaaeebb,_0x37c172):_0x1d5027,_0xdec237;if(typeof Reflect===_0x2a9143(0x19f)&&typeof Reflect[_0x2a9143(0x1be)]===_0x2a9143(0x1a9))_0x3ec461=Reflect['decorate'](_0x33627e,_0xaaeebb,_0x37c172,_0x1d5027);else{for(var _0x5ad43d=_0x33627e[_0x2a9143(0x1f6)]-0x1;_0x5ad43d>=0x0;_0x5ad43d--)if(_0xdec237=_0x33627e[_0x5ad43d])_0x3ec461=(_0x54d25e<0x3?_0xdec237(_0x3ec461):_0x54d25e>0x3?_0xdec237(_0xaaeebb,_0x37c172,_0x3ec461):_0xdec237(_0xaaeebb,_0x37c172))||_0x3ec461;}return _0x54d25e>0x3&&_0x3ec461&&Object['defineProperty'](_0xaaeebb,_0x37c172,_0x3ec461),_0x3ec461;},__metadata=this&&this[a105_0x37e258(0x19b)]||function(_0x49a3c7,_0x2cbe6c){const _0x305d07=a105_0x37e258;if(typeof Reflect===_0x305d07(0x19f)&&typeof Reflect[_0x305d07(0x1f7)]===_0x305d07(0x1a9))return Reflect['metadata'](_0x49a3c7,_0x2cbe6c);},__importDefault=this&&this[a105_0x37e258(0x1cd)]||function(_0x209922){const _0xce1836=a105_0x37e258;return _0x209922&&_0x209922[_0xce1836(0x1e2)]?_0x209922:{'default':_0x209922};},FlosumCommitJob_1;Object['defineProperty'](exports,a105_0x37e258(0x1e2),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a105_0x37e258(0x1b6)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a105_0x37e258(0x1b7)),errors_1=require(a105_0x37e258(0x1b0)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a105_0x37e258(0x1d5)),salesforce_sync_service_1=require(a105_0x37e258(0x1df)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a105_0x37e258(0x1d9)),constants_1=require('../../../../constants'),shortid_1=__importDefault(require('shortid')),providers_tokens_1=require(a105_0x37e258(0x1e7));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0xd960ff,_0x47d79b,_0x565143){const _0x2142a5=a105_0x37e258;this[_0x2142a5(0x1f3)]=_0xd960ff,this[_0x2142a5(0x1d4)]=_0x47d79b,this[_0x2142a5(0x1ff)]=_0x565143,this[_0x2142a5(0x1f9)]=new core_1[(_0x2142a5(0x1e4))](FlosumCommitJob_1[_0x2142a5(0x1d1)]);}async[a105_0x37e258(0x1e3)](){const _0x355b1f=a105_0x37e258;try{if(this[_0x355b1f(0x1fa)][_0x355b1f(0x1e8)])this['repositoryData']=await this['salesforceSync'][_0x355b1f(0x1c5)](this[_0x355b1f(0x1fa)]['syncRepositoryId']);else this[_0x355b1f(0x1fa)]['syncBranchId']&&(this[_0x355b1f(0x1a6)]=await this[_0x355b1f(0x1ff)][_0x355b1f(0x1e6)](this[_0x355b1f(0x1fa)][_0x355b1f(0x1eb)]));}catch(_0x586214){throw new bad_request_error_1[(_0x355b1f(0x1f1))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a105_0x37e258(0x1ba)](){const _0x40fe60=a105_0x37e258;if(!this[_0x40fe60(0x1fa)][_0x40fe60(0x1b1)])return[];await this[_0x40fe60(0x1f3)]['patchObject'](constants_1[_0x40fe60(0x1ae)],this[_0x40fe60(0x1fa)][_0x40fe60(0x1b1)],{'Name':(0x0,shortid_1[_0x40fe60(0x1d8)])()});const _0xb4001f=await this[_0x40fe60(0x1f3)]['retrieveAttachment'](this[_0x40fe60(0x1fa)][_0x40fe60(0x1b1)])[_0x40fe60(0x1ad)](_0x526543=>_0x526543[_0x40fe60(0x197)]('\x20')[_0x40fe60(0x1f4)](_0xbb9926=>_0xbb9926[_0x40fe60(0x1e1)]()));await this[_0x40fe60(0x1f3)][_0x40fe60(0x1c0)](this[_0x40fe60(0x1fa)][_0x40fe60(0x1b1)]);const _0x65f77b=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x40fe60(0x1f3)]);return await _0x65f77b[_0x40fe60(0x198)](_0xb4001f);}async[a105_0x37e258(0x1ef)](){const _0x5253dc=a105_0x37e258;if(!this['commitData'][_0x5253dc(0x1e5)])return[];await this[_0x5253dc(0x1f3)]['patchObject'](constants_1[_0x5253dc(0x1ae)],this[_0x5253dc(0x1fa)]['deleteAttachmentId'],{'Name':(0x0,shortid_1['default'])()});const _0x54a9b3=await this[_0x5253dc(0x1f3)]['retrieveAttachment'](this[_0x5253dc(0x1fa)][_0x5253dc(0x1e5)]);return await this['salesforceService'][_0x5253dc(0x1c0)](this[_0x5253dc(0x1fa)][_0x5253dc(0x1e5)]),_0x54a9b3;}async[a105_0x37e258(0x1a5)](){const _0x20371e=a105_0x37e258,_0x37b384=new commit_components_dto_1[(_0x20371e(0x1e9))](),[_0x258037,_0x51b84c]=await Promise[_0x20371e(0x19a)]([this['getComponentsToWrite'](),this[_0x20371e(0x1ef)]()]);return _0x37b384['message']=this[_0x20371e(0x1fa)][_0x20371e(0x1c1)],_0x37b384[_0x20371e(0x1f2)]=this[_0x20371e(0x1fa)][_0x20371e(0x1f2)],_0x37b384[_0x20371e(0x1ea)]={'writed':_0x258037,'deleted':_0x51b84c},_0x37b384[_0x20371e(0x1c8)]=this[_0x20371e(0x1b5)][_0x20371e(0x1bd)],_0x37b384[_0x20371e(0x1e0)]=this[_0x20371e(0x1a4)],_0x37b384[_0x20371e(0x1fc)]=this[_0x20371e(0x1fc)],_0x37b384[_0x20371e(0x1bb)]=this[_0x20371e(0x1b5)][_0x20371e(0x19d)],_0x37b384;}async['updateLastCommit'](_0x52a379=![]){const _0x2d6c87=a105_0x37e258;if(_0x52a379)await this[_0x2d6c87(0x1ff)][_0x2d6c87(0x1c6)](this[_0x2d6c87(0x1a6)],{});else{const _0x524fcf=await this[_0x2d6c87(0x1a4)]['branches'][_0x2d6c87(0x1a7)](this['branch'][_0x2d6c87(0x1d1)]);this[_0x2d6c87(0x1d7)][_0x2d6c87(0x1aa)](this[_0x2d6c87(0x1a0)]+_0x2d6c87(0x1f8));const _0x53237c={[this[_0x2d6c87(0x1a4)]['gitUrl']]:{'lastCommit':_0x524fcf[_0x2d6c87(0x1a3)]}};await this[_0x2d6c87(0x1ff)][_0x2d6c87(0x1c6)](this[_0x2d6c87(0x1a6)],_0x53237c);}}async[a105_0x37e258(0x1d6)](){const _0x3a3e4d=a105_0x37e258,_0x5ea876=await this[_0x3a3e4d(0x1a5)]();await this[_0x3a3e4d(0x1ff)]['setStatus'](this[_0x3a3e4d(0x1a6)],_0x3a3e4d(0x1a8)),await this[_0x3a3e4d(0x1d4)]['run'](_0x5ea876,this[_0x3a3e4d(0x1a0)]),await this[_0x3a3e4d(0x1d0)](),await this[_0x3a3e4d(0x1ff)][_0x3a3e4d(0x1b3)](this['repositoryData'],_0x3a3e4d(0x1c4));}async[a105_0x37e258(0x1de)](_0x252553){const _0x53a2e0=a105_0x37e258;try{this[_0x53a2e0(0x1d7)][_0x53a2e0(0x1ee)](''+_0x252553),await this[_0x53a2e0(0x1d7)]['send'](),await this[_0x53a2e0(0x1d0)](!![]),await this[_0x53a2e0(0x1ff)]['setStatus'](this[_0x53a2e0(0x1a6)],_0x53a2e0(0x19e));}catch(_0x43ff38){this[_0x53a2e0(0x1f9)]['error'](_0x43ff38);}}async['run'](_0x1850f9){const _0x2a8b53=a105_0x37e258;try{this[_0x2a8b53(0x1fa)]=_0x1850f9,this[_0x2a8b53(0x1a2)]=typedi_1[_0x2a8b53(0x1b2)][_0x2a8b53(0x1af)](providers_tokens_1[_0x2a8b53(0x1cc)][_0x2a8b53(0x1a2)]),this['repoService']=typedi_1[_0x2a8b53(0x1b2)][_0x2a8b53(0x1af)](providers_tokens_1[_0x2a8b53(0x1cc)][_0x2a8b53(0x1c3)]),this[_0x2a8b53(0x1b5)]=typedi_1[_0x2a8b53(0x1b2)]['get'](providers_tokens_1[_0x2a8b53(0x1cc)][_0x2a8b53(0x1b5)]),await this['fetchRepositoryData'](),this[_0x2a8b53(0x1a4)]=await this[_0x2a8b53(0x1ce)][_0x2a8b53(0x1a7)](this[_0x2a8b53(0x1a6)][_0x2a8b53(0x1ca)]),this[_0x2a8b53(0x1fc)]=await this[_0x2a8b53(0x1a4)]['branches'][_0x2a8b53(0x1a7)](this[_0x2a8b53(0x1a6)][_0x2a8b53(0x1b9)]),this['sfLogger']=typedi_1[_0x2a8b53(0x1b2)][_0x2a8b53(0x1af)](providers_tokens_1[_0x2a8b53(0x1cc)][_0x2a8b53(0x1f9)]),this['prefix']='[FLOSUM\x20->\x20GIT]\x20['+this[_0x2a8b53(0x1b5)][_0x2a8b53(0x19d)]['toUpperCase']()+_0x2a8b53(0x1dc)+this[_0x2a8b53(0x1a6)][_0x2a8b53(0x1ca)]+_0x2a8b53(0x1ed)+this[_0x2a8b53(0x1a6)]['branchName']+_0x2a8b53(0x1db)+FlosumCommitJob_1[_0x2a8b53(0x1d1)]+']';if(!this[_0x2a8b53(0x1a6)])throw new bad_request_error_1[(_0x2a8b53(0x1f1))](errors_1[_0x2a8b53(0x1c2)]);await this[_0x2a8b53(0x1d7)][_0x2a8b53(0x1aa)](this[_0x2a8b53(0x1a0)]+_0x2a8b53(0x1a1))[_0x2a8b53(0x1da)](),await this[_0x2a8b53(0x1d6)]()[_0x2a8b53(0x1fe)](_0x51ae85=>this['handleCommitJobError'](_0x51ae85));}catch(_0x52b5b4){this[_0x2a8b53(0x1fa)]=undefined,this[_0x2a8b53(0x1f9)][_0x2a8b53(0x1ee)](_0x52b5b4);throw _0x52b5b4;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x37e258(0x1bf)])({'transient':!![]}),__metadata(a105_0x37e258(0x1bc),[salesforce_service_1[a105_0x37e258(0x1d2)],commit_components_job_1[a105_0x37e258(0x1ec)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a105_0x37e258(0x1b4)]=FlosumCommitJob;