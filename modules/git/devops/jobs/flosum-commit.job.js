const a61_0x4f2b37=a61_0xecb9;(function(_0x9e61e7,_0x274cc8){const _0x2e09e6=a61_0xecb9,_0x2a3b7b=_0x9e61e7();while(!![]){try{const _0x143760=-parseInt(_0x2e09e6(0xcb))/0x1*(parseInt(_0x2e09e6(0x102))/0x2)+-parseInt(_0x2e09e6(0xa0))/0x3*(parseInt(_0x2e09e6(0xba))/0x4)+parseInt(_0x2e09e6(0xd7))/0x5+parseInt(_0x2e09e6(0xae))/0x6+-parseInt(_0x2e09e6(0xea))/0x7+parseInt(_0x2e09e6(0xee))/0x8*(parseInt(_0x2e09e6(0x106))/0x9)+parseInt(_0x2e09e6(0xf8))/0xa*(-parseInt(_0x2e09e6(0xf6))/0xb);if(_0x143760===_0x274cc8)break;else _0x2a3b7b['push'](_0x2a3b7b['shift']());}catch(_0x1e31c5){_0x2a3b7b['push'](_0x2a3b7b['shift']());}}}(a61_0x4d9e,0xc66fd));const a61_0x1bfea7=(function(){let _0x45d909=!![];return function(_0x516f16,_0xf17b01){const _0x44212c=_0x45d909?function(){if(_0xf17b01){const _0x5dc5bf=_0xf17b01['apply'](_0x516f16,arguments);return _0xf17b01=null,_0x5dc5bf;}}:function(){};return _0x45d909=![],_0x44212c;};}()),a61_0x369d33=a61_0x1bfea7(this,function(){const _0x26459b=a61_0xecb9;return a61_0x369d33[_0x26459b(0xd9)]()[_0x26459b(0x100)](_0x26459b(0xf4))[_0x26459b(0xd9)]()[_0x26459b(0xfa)](a61_0x369d33)[_0x26459b(0x100)](_0x26459b(0xf4));});a61_0x369d33();'use strict';var __decorate=this&&this[a61_0x4f2b37(0xd2)]||function(_0x58ecc3,_0x34ef10,_0xdaca4d,_0xc5d7c7){const _0x1d0543=a61_0x4f2b37;var _0x12d839=arguments[_0x1d0543(0xd0)],_0x1a839e=_0x12d839<0x3?_0x34ef10:_0xc5d7c7===null?_0xc5d7c7=Object[_0x1d0543(0xb6)](_0x34ef10,_0xdaca4d):_0xc5d7c7,_0x31d9d9;if(typeof Reflect===_0x1d0543(0xbe)&&typeof Reflect[_0x1d0543(0xe0)]===_0x1d0543(0xab))_0x1a839e=Reflect[_0x1d0543(0xe0)](_0x58ecc3,_0x34ef10,_0xdaca4d,_0xc5d7c7);else{for(var _0x3a89dc=_0x58ecc3[_0x1d0543(0xd0)]-0x1;_0x3a89dc>=0x0;_0x3a89dc--)if(_0x31d9d9=_0x58ecc3[_0x3a89dc])_0x1a839e=(_0x12d839<0x3?_0x31d9d9(_0x1a839e):_0x12d839>0x3?_0x31d9d9(_0x34ef10,_0xdaca4d,_0x1a839e):_0x31d9d9(_0x34ef10,_0xdaca4d))||_0x1a839e;}return _0x12d839>0x3&&_0x1a839e&&Object[_0x1d0543(0xc0)](_0x34ef10,_0xdaca4d,_0x1a839e),_0x1a839e;},__metadata=this&&this[a61_0x4f2b37(0xc3)]||function(_0x4d93f1,_0x4726b5){const _0x5b59b5=a61_0x4f2b37;if(typeof Reflect===_0x5b59b5(0xbe)&&typeof Reflect[_0x5b59b5(0xf2)]==='function')return Reflect[_0x5b59b5(0xf2)](_0x4d93f1,_0x4726b5);},__importDefault=this&&this['__importDefault']||function(_0x55803a){const _0x5c2db0=a61_0x4f2b37;return _0x55803a&&_0x55803a[_0x5c2db0(0xd6)]?_0x55803a:{'default':_0x55803a};},FlosumCommitJob_1;Object[a61_0x4f2b37(0xc0)](exports,a61_0x4f2b37(0xd6),{'value':!![]}),exports[a61_0x4f2b37(0xe5)]=void 0x0;function a61_0xecb9(_0x5601d4,_0x42bc08){const _0x44aa6a=a61_0x4d9e();return a61_0xecb9=function(_0x369d33,_0x1bfea7){_0x369d33=_0x369d33-0x9b;let _0x4d9e99=_0x44aa6a[_0x369d33];return _0x4d9e99;},a61_0xecb9(_0x5601d4,_0x42bc08);}function a61_0x4d9e(){const _0x3923dd=['4ElNepn','message','\x20Start\x20Flosum\x20commit\x20job.','commitData','object','shortid','defineProperty','logger','then','__metadata','Logger','commitJob','createFromContext','getComponentsToDelete','branchName','log','updateRemoteState','1yJAUms','SalesforceRetrieverService','createFromConnection','../dto/commit-components.dto','all','length','syncRepositoryId','__decorate','syncBranchId','user','run','__esModule','1085405oMsZJk','repoService','toString','Completed','[FLOSUM\x20->\x20GIT]\x20[','getRepositoryRecord','getCommitDto',']\x20[Repository:\x20','../../../../constants','decorate','../../providers/providers.tokens','./commit-components.job','prefix','../../salesforce/services/salesforce.service','FlosumCommitJob','retrieveAttachment','fetchRepositoryData',']\x20[','trim','6264524RVunmr','CommitComponentsDto','patchObject','updateLastCommit','200gpYyHJ','exec','Tokens','typedi','metadata','RepositoryFactory','(((.+)+)+)+$','components','22QNakmo','In\x20Progress','685940MayJjp','providersFactory','constructor','config','\x20Update\x20remote\x20state.','map','../../../../constants/errors','repositoryName','search','salesforceService','94502eeEtnc','send','setStatus','default','506403ELJMdI','CommitComponentsJob','SalesforceSyncService','repo','getBranchRecord','split','branch','handleCommitJobError','gitUrl','1425990zsUkni','repository','FLOSUM_ATTACHMENT','gitProvider','../../../../core/errors/bad-request.error','convertToSFDX','gitApiService','branches','commitAttachmentId','deleteAttachmentId','salesforceSync','function',']\x20[Branch:\x20','isConvertToSfdx','4462452avBwxr','repositoryData','error','get','deleteAttachment','SalesforceService','sfLogger','name','getOwnPropertyDescriptor','BadRequestError','Container','../../providers/repositories/repository.factory'];a61_0x4d9e=function(){return _0x3923dd;};return a61_0x4d9e();}const core_1=require('../../../../core'),salesforce_service_1=require(a61_0x4f2b37(0xe4)),typedi_1=require(a61_0x4f2b37(0xf1)),errors_1=require(a61_0x4f2b37(0xfe)),bad_request_error_1=require(a61_0x4f2b37(0xa4)),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a61_0x4f2b37(0xce)),commit_components_job_1=require(a61_0x4f2b37(0xe2)),constants_1=require(a61_0x4f2b37(0xdf)),shortid_1=__importDefault(require(a61_0x4f2b37(0xbf))),providers_tokens_1=require(a61_0x4f2b37(0xe1)),repository_factory_1=require(a61_0x4f2b37(0xb9)),connection_1=require('../utils/connection');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x27472b,_0x6c72b8,_0xc11142,_0x3f5a4b){const _0x4f271b=a61_0x4f2b37;this['salesforceService']=_0x27472b,this[_0x4f271b(0xc5)]=_0x6c72b8,this['salesforceSync']=_0xc11142,this[_0x4f271b(0xf9)]=_0x3f5a4b,this[_0x4f271b(0xc1)]=new core_1[(_0x4f271b(0xc4))](FlosumCommitJob_1['name']);}async[a61_0x4f2b37(0xe7)](){const _0x1c8bbd=a61_0x4f2b37;try{if(this[_0x1c8bbd(0xbd)]['syncRepositoryId'])this[_0x1c8bbd(0xaf)]=await this[_0x1c8bbd(0xaa)][_0x1c8bbd(0xdc)](this['commitData'][_0x1c8bbd(0xd1)]);else this['commitData'][_0x1c8bbd(0xd3)]&&(this[_0x1c8bbd(0xaf)]=await this[_0x1c8bbd(0xaa)][_0x1c8bbd(0x9b)](this[_0x1c8bbd(0xbd)][_0x1c8bbd(0xd3)]));}catch(_0x4520ca){throw new bad_request_error_1['BadRequestError'](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async['getComponentsToWrite'](){const _0x5dac04=a61_0x4f2b37;if(!this[_0x5dac04(0xbd)][_0x5dac04(0xa8)])return[];await this[_0x5dac04(0x101)][_0x5dac04(0xec)](constants_1[_0x5dac04(0xa2)],this[_0x5dac04(0xbd)][_0x5dac04(0xa8)],{'Name':shortid_1[_0x5dac04(0x105)]()});const _0x1e3af3=await this[_0x5dac04(0x101)][_0x5dac04(0xe6)](this[_0x5dac04(0xbd)]['commitAttachmentId'])[_0x5dac04(0xc2)](_0xb5c155=>_0xb5c155[_0x5dac04(0x9c)]('\x20')[_0x5dac04(0xfd)](_0x479523=>_0x479523[_0x5dac04(0xe9)]()));await this[_0x5dac04(0x101)][_0x5dac04(0xb2)](this[_0x5dac04(0xbd)][_0x5dac04(0xa8)]);const _0x3b986d=new salesforce_retriever_service_1[(_0x5dac04(0xcc))](this['salesforceService']);return await _0x3b986d[_0x5dac04(0xd5)](_0x1e3af3);}async['getComponentsToDelete'](){const _0x49bbfe=a61_0x4f2b37;if(!this[_0x49bbfe(0xbd)][_0x49bbfe(0xa9)])return[];await this[_0x49bbfe(0x101)][_0x49bbfe(0xec)](constants_1['FLOSUM_ATTACHMENT'],this[_0x49bbfe(0xbd)][_0x49bbfe(0xa9)],{'Name':shortid_1['default']()});const _0x367d9a=await this[_0x49bbfe(0x101)][_0x49bbfe(0xe6)](this[_0x49bbfe(0xbd)]['deleteAttachmentId']);return await this[_0x49bbfe(0x101)][_0x49bbfe(0xb2)](this['commitData'][_0x49bbfe(0xa9)]),_0x367d9a;}async[a61_0x4f2b37(0xdd)](){const _0x30addf=a61_0x4f2b37,_0x4534f6=new commit_components_dto_1[(_0x30addf(0xeb))](),[_0x1f962a,_0xf87caf]=await Promise[_0x30addf(0xcf)]([this['getComponentsToWrite'](),this[_0x30addf(0xc7)]()]);return _0x4534f6[_0x30addf(0xbb)]=this[_0x30addf(0xbd)]['message'],_0x4534f6[_0x30addf(0xd4)]=this[_0x30addf(0xbd)]['user'],_0x4534f6[_0x30addf(0xf5)]={'writed':_0x1f962a,'deleted':_0xf87caf},_0x4534f6[_0x30addf(0xa5)]=this[_0x30addf(0xfb)][_0x30addf(0xad)],_0x4534f6[_0x30addf(0x109)]=this[_0x30addf(0xa1)],_0x4534f6[_0x30addf(0x9d)]=this[_0x30addf(0x9d)],_0x4534f6['provider']=this[_0x30addf(0xfb)][_0x30addf(0xa3)],_0x4534f6;}async['updateLastCommit'](_0x2ddb38=![]){const _0x2618b7=a61_0x4f2b37;if(_0x2ddb38)await this['salesforceSync'][_0x2618b7(0xca)](this[_0x2618b7(0xaf)],{});else{const _0x9f6897=await this[_0x2618b7(0xa1)]['branches']['getOne'](this['branch'][_0x2618b7(0xb5)]);this[_0x2618b7(0xb4)][_0x2618b7(0xc9)](this['prefix']+_0x2618b7(0xfc));const _0x113826={[this[_0x2618b7(0xa1)][_0x2618b7(0x9f)]]:{'lastCommit':_0x9f6897['sha']}};await this[_0x2618b7(0xaa)]['updateRemoteState'](this['repositoryData'],_0x113826);}}async[a61_0x4f2b37(0xef)](){const _0x52e467=a61_0x4f2b37,_0x3fbf4f=await this[_0x52e467(0xdd)]();await this['salesforceSync'][_0x52e467(0x104)](this[_0x52e467(0xaf)],_0x52e467(0xf7)),await this[_0x52e467(0xc5)][_0x52e467(0xd5)](_0x3fbf4f,this[_0x52e467(0xe3)]),await this[_0x52e467(0xed)](),await this[_0x52e467(0xaa)][_0x52e467(0x104)](this['repositoryData'],_0x52e467(0xda));}async[a61_0x4f2b37(0x9e)](_0x45c9c4){const _0x32e658=a61_0x4f2b37;try{this[_0x32e658(0xb4)]['error'](''+_0x45c9c4),await this[_0x32e658(0xb4)][_0x32e658(0x103)](),await this[_0x32e658(0xed)](!![]),await this[_0x32e658(0xaa)]['setStatus'](this[_0x32e658(0xaf)],'Error');}catch(_0x2d4944){this['logger'][_0x32e658(0xb0)](_0x2d4944);}}async['run'](_0x534843,_0xaa69d8){const _0x57a33b=a61_0x4f2b37;try{this[_0x57a33b(0xbd)]=_0x534843,this[_0x57a33b(0xa6)]=await this[_0x57a33b(0xf9)][_0x57a33b(0xcd)](_0xaa69d8),this[_0x57a33b(0xd8)]=await repository_factory_1[_0x57a33b(0xf3)][_0x57a33b(0xc6)](typedi_1[_0x57a33b(0xb8)]),this[_0x57a33b(0xfb)]=typedi_1[_0x57a33b(0xb8)][_0x57a33b(0xb1)](providers_tokens_1[_0x57a33b(0xf0)][_0x57a33b(0xfb)]),await this[_0x57a33b(0xe7)](),this['repository']=await this[_0x57a33b(0xd8)]['getOne'](this[_0x57a33b(0xaf)]['repositoryName']),this[_0x57a33b(0x9d)]=await this['repository'][_0x57a33b(0xa7)]['getOne'](this[_0x57a33b(0xaf)]['branchName']),this[_0x57a33b(0xb4)]=typedi_1['Container'][_0x57a33b(0xb1)](providers_tokens_1[_0x57a33b(0xf0)]['logger']),this[_0x57a33b(0xe3)]=_0x57a33b(0xdb)+this[_0x57a33b(0xfb)][_0x57a33b(0xa3)]['toUpperCase']()+_0x57a33b(0xde)+this[_0x57a33b(0xaf)][_0x57a33b(0xff)]+_0x57a33b(0xac)+this['repositoryData'][_0x57a33b(0xc8)]+_0x57a33b(0xe8)+FlosumCommitJob_1['name']+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x57a33b(0xb7))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x57a33b(0xb4)]['log'](this[_0x57a33b(0xe3)]+_0x57a33b(0xbc))[_0x57a33b(0x103)](),await this['exec']()['catch'](_0xfaf8c=>this[_0x57a33b(0x9e)](_0xfaf8c));}catch(_0x3c6617){this['commitData']=undefined,this['logger'][_0x57a33b(0xb0)](_0x3c6617);throw _0x3c6617;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a61_0x4f2b37(0xb3)],commit_components_job_1[a61_0x4f2b37(0x107)],salesforce_sync_service_1[a61_0x4f2b37(0x108)],connection_1['ProvidersFactory']])],FlosumCommitJob),exports[a61_0x4f2b37(0xe5)]=FlosumCommitJob;