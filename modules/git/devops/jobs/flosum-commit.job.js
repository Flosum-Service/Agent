const a104_0xec49d2=a104_0x2fd9;(function(_0x489b34,_0x111dc3){const _0x49f77f=a104_0x2fd9,_0xe1d857=_0x489b34();while(!![]){try{const _0x3175be=-parseInt(_0x49f77f(0x18e))/0x1+-parseInt(_0x49f77f(0x17f))/0x2+-parseInt(_0x49f77f(0x18f))/0x3+parseInt(_0x49f77f(0x167))/0x4+parseInt(_0x49f77f(0x16f))/0x5+-parseInt(_0x49f77f(0x1b4))/0x6*(-parseInt(_0x49f77f(0x171))/0x7)+parseInt(_0x49f77f(0x165))/0x8;if(_0x3175be===_0x111dc3)break;else _0xe1d857['push'](_0xe1d857['shift']());}catch(_0x236de8){_0xe1d857['push'](_0xe1d857['shift']());}}}(a104_0x500f,0xd4f9e));const a104_0x14642a=(function(){let _0x2a7142=!![];return function(_0x5d1b3a,_0x1dc138){const _0x91fc5=_0x2a7142?function(){if(_0x1dc138){const _0xfb4d69=_0x1dc138['apply'](_0x5d1b3a,arguments);return _0x1dc138=null,_0xfb4d69;}}:function(){};return _0x2a7142=![],_0x91fc5;};}()),a104_0x1fbd44=a104_0x14642a(this,function(){const _0x1535ee=a104_0x2fd9;return a104_0x1fbd44[_0x1535ee(0x1ba)]()[_0x1535ee(0x1a5)](_0x1535ee(0x1a0))[_0x1535ee(0x1ba)]()['constructor'](a104_0x1fbd44)[_0x1535ee(0x1a5)](_0x1535ee(0x1a0));});function a104_0x500f(){const _0x35fc67=['function','gitRepoService','error',']\x20[','catch','Completed','../../providers/providers.tokens','split','Tokens','6496264YkBazV','patchObject','5986788qulNfM','Container','branch','gitApiService','getRepositoryRecord','object','config','../../../../constants/errors','2448365Uztunl','provider','1337QdKuAF','salesforceSync','../../salesforce/services/salesforce-sync.service','all','trim','repositoryName','fetchRepositoryData','retrieveAttachment','commitData','prefix','CommitComponentsDto','isConvertToSfdx','design:paramtypes','updateLastCommit','3316792QeBAqC','salesforceService','branchName','./commit-components.job','syncRepositoryId','repositoryData','SalesforceService','getOwnPropertyDescriptor','branches','updateRemoteState','__esModule','Error','Logger','user','defineProperty','405024RbCjjy','3533577mCwNSW','convertToSFDX','metadata','get','default','getComponentsToWrite','message','deleteAttachmentId','In\x20Progress','FLOSUM_ATTACHMENT','syncBranchId','sha','../../salesforce/services/salesforce-retriever.service','gitProvider','getCommitDto','commitAttachmentId','repository','(((.+)+)+)+$','deleteAttachment','../../../../core','components','decorate','search','FlosumCommitJob','commitJob','sfLogger','BadRequestError','\x20Start\x20Flosum\x20commit\x20job.','run','name','setStatus','log','repoService','handleCommitJobError','exec','logger','CommitComponentsJob','41316DCVQqt','getBranchRecord','length','getComponentsToDelete','__metadata','shortid','toString','map','ERR_UNKNOWN_SYNC_RECORD_ID','ERR_INVALID_SYNC_RECORD_ID','getOne'];a104_0x500f=function(){return _0x35fc67;};return a104_0x500f();}a104_0x1fbd44();'use strict';var __decorate=this&&this['__decorate']||function(_0x2c48cc,_0x35ddf8,_0x43a290,_0x1d0f45){const _0x2b1c7c=a104_0x2fd9;var _0x4c0d50=arguments[_0x2b1c7c(0x1b6)],_0x5b2d85=_0x4c0d50<0x3?_0x35ddf8:_0x1d0f45===null?_0x1d0f45=Object[_0x2b1c7c(0x186)](_0x35ddf8,_0x43a290):_0x1d0f45,_0x43a639;if(typeof Reflect===_0x2b1c7c(0x16c)&&typeof Reflect[_0x2b1c7c(0x1a4)]==='function')_0x5b2d85=Reflect[_0x2b1c7c(0x1a4)](_0x2c48cc,_0x35ddf8,_0x43a290,_0x1d0f45);else{for(var _0x22b9d8=_0x2c48cc['length']-0x1;_0x22b9d8>=0x0;_0x22b9d8--)if(_0x43a639=_0x2c48cc[_0x22b9d8])_0x5b2d85=(_0x4c0d50<0x3?_0x43a639(_0x5b2d85):_0x4c0d50>0x3?_0x43a639(_0x35ddf8,_0x43a290,_0x5b2d85):_0x43a639(_0x35ddf8,_0x43a290))||_0x5b2d85;}return _0x4c0d50>0x3&&_0x5b2d85&&Object[_0x2b1c7c(0x18d)](_0x35ddf8,_0x43a290,_0x5b2d85),_0x5b2d85;},__metadata=this&&this[a104_0xec49d2(0x1b8)]||function(_0x432312,_0x355884){const _0x359223=a104_0xec49d2;if(typeof Reflect===_0x359223(0x16c)&&typeof Reflect[_0x359223(0x191)]===_0x359223(0x15c))return Reflect[_0x359223(0x191)](_0x432312,_0x355884);},__importDefault=this&&this['__importDefault']||function(_0x1e6bcb){const _0x2a2690=a104_0xec49d2;return _0x1e6bcb&&_0x1e6bcb[_0x2a2690(0x189)]?_0x1e6bcb:{'default':_0x1e6bcb};},FlosumCommitJob_1;Object[a104_0xec49d2(0x18d)](exports,a104_0xec49d2(0x189),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;function a104_0x2fd9(_0x144f83,_0x26fb5c){const _0x48027e=a104_0x500f();return a104_0x2fd9=function(_0x1fbd44,_0x14642a){_0x1fbd44=_0x1fbd44-0x15b;let _0x500f51=_0x48027e[_0x1fbd44];return _0x500f51;},a104_0x2fd9(_0x144f83,_0x26fb5c);}const core_1=require(a104_0xec49d2(0x1a2)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require('typedi'),errors_1=require(a104_0xec49d2(0x16e)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a104_0xec49d2(0x19b)),salesforce_sync_service_1=require(a104_0xec49d2(0x173)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a104_0xec49d2(0x182)),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a104_0xec49d2(0x1b9))),providers_tokens_1=require(a104_0xec49d2(0x162));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x4e5408,_0x12a329,_0x30c3ad){const _0x5f2a0d=a104_0xec49d2;this[_0x5f2a0d(0x180)]=_0x4e5408,this[_0x5f2a0d(0x1a7)]=_0x12a329,this[_0x5f2a0d(0x172)]=_0x30c3ad,this['logger']=new core_1[(_0x5f2a0d(0x18b))](FlosumCommitJob_1[_0x5f2a0d(0x1ac)]);}async[a104_0xec49d2(0x177)](){const _0x145bed=a104_0xec49d2;try{if(this[_0x145bed(0x179)][_0x145bed(0x183)])this[_0x145bed(0x184)]=await this[_0x145bed(0x172)][_0x145bed(0x16b)](this[_0x145bed(0x179)][_0x145bed(0x183)]);else this[_0x145bed(0x179)][_0x145bed(0x199)]&&(this[_0x145bed(0x184)]=await this[_0x145bed(0x172)][_0x145bed(0x1b5)](this['commitData'][_0x145bed(0x199)]));}catch(_0x4527e7){throw new bad_request_error_1[(_0x145bed(0x1a9))](errors_1[_0x145bed(0x1bd)]);}}async[a104_0xec49d2(0x194)](){const _0x191a6a=a104_0xec49d2;if(!this['commitData'][_0x191a6a(0x19e)])return[];await this[_0x191a6a(0x180)][_0x191a6a(0x166)](constants_1['FLOSUM_ATTACHMENT'],this[_0x191a6a(0x179)][_0x191a6a(0x19e)],{'Name':(0x0,shortid_1[_0x191a6a(0x193)])()});const _0x409172=await this['salesforceService'][_0x191a6a(0x178)](this[_0x191a6a(0x179)][_0x191a6a(0x19e)])['then'](_0x2a76a8=>_0x2a76a8[_0x191a6a(0x163)]('\x20')[_0x191a6a(0x1bb)](_0x248dce=>_0x248dce[_0x191a6a(0x175)]()));await this['salesforceService'][_0x191a6a(0x1a1)](this['commitData'][_0x191a6a(0x19e)]);const _0x109219=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x191a6a(0x180)]);return await _0x109219[_0x191a6a(0x1ab)](_0x409172);}async[a104_0xec49d2(0x1b7)](){const _0x1b83f9=a104_0xec49d2;if(!this[_0x1b83f9(0x179)][_0x1b83f9(0x196)])return[];await this['salesforceService']['patchObject'](constants_1[_0x1b83f9(0x198)],this[_0x1b83f9(0x179)][_0x1b83f9(0x196)],{'Name':(0x0,shortid_1[_0x1b83f9(0x193)])()});const _0x5a0eea=await this[_0x1b83f9(0x180)]['retrieveAttachment'](this[_0x1b83f9(0x179)][_0x1b83f9(0x196)]);return await this[_0x1b83f9(0x180)][_0x1b83f9(0x1a1)](this[_0x1b83f9(0x179)][_0x1b83f9(0x196)]),_0x5a0eea;}async[a104_0xec49d2(0x19d)](){const _0x1702bb=a104_0xec49d2,_0x206616=new commit_components_dto_1[(_0x1702bb(0x17b))](),[_0x1ae108,_0xf16322]=await Promise[_0x1702bb(0x174)]([this[_0x1702bb(0x194)](),this['getComponentsToDelete']()]);return _0x206616[_0x1702bb(0x195)]=this[_0x1702bb(0x179)][_0x1702bb(0x195)],_0x206616[_0x1702bb(0x18c)]=this['commitData']['user'],_0x206616[_0x1702bb(0x1a3)]={'writed':_0x1ae108,'deleted':_0xf16322},_0x206616[_0x1702bb(0x190)]=this[_0x1702bb(0x16d)][_0x1702bb(0x17c)],_0x206616['repo']=this[_0x1702bb(0x19f)],_0x206616['branch']=this[_0x1702bb(0x169)],_0x206616[_0x1702bb(0x170)]=this[_0x1702bb(0x16d)][_0x1702bb(0x19c)],_0x206616;}async[a104_0xec49d2(0x17e)](_0x418e66=![]){const _0x539e23=a104_0xec49d2;if(_0x418e66)await this['salesforceSync'][_0x539e23(0x188)](this['repositoryData'],{});else{const _0x466700=await this[_0x539e23(0x19f)][_0x539e23(0x187)][_0x539e23(0x15b)](this[_0x539e23(0x169)][_0x539e23(0x1ac)]);this[_0x539e23(0x1a8)][_0x539e23(0x1ae)](this[_0x539e23(0x17a)]+'\x20Update\x20remote\x20state.');const _0x143d7b={[this[_0x539e23(0x19f)]['gitUrl']]:{'lastCommit':_0x466700[_0x539e23(0x19a)]}};await this[_0x539e23(0x172)]['updateRemoteState'](this[_0x539e23(0x184)],_0x143d7b);}}async[a104_0xec49d2(0x1b1)](){const _0x34fb69=a104_0xec49d2,_0xfbe42b=await this[_0x34fb69(0x19d)]();await this[_0x34fb69(0x172)][_0x34fb69(0x1ad)](this[_0x34fb69(0x184)],_0x34fb69(0x197)),await this['commitJob']['run'](_0xfbe42b,this[_0x34fb69(0x17a)]),await this[_0x34fb69(0x17e)](),await this[_0x34fb69(0x172)][_0x34fb69(0x1ad)](this['repositoryData'],_0x34fb69(0x161));}async[a104_0xec49d2(0x1b0)](_0x4752d4){const _0xc068fb=a104_0xec49d2;try{this[_0xc068fb(0x1a8)]['error'](''+_0x4752d4),await this['sfLogger']['send'](),await this[_0xc068fb(0x17e)](!![]),await this[_0xc068fb(0x172)][_0xc068fb(0x1ad)](this[_0xc068fb(0x184)],_0xc068fb(0x18a));}catch(_0x2f2f3b){this[_0xc068fb(0x1b2)][_0xc068fb(0x15e)](_0x2f2f3b);}}async[a104_0xec49d2(0x1ab)](_0xa96487){const _0x468770=a104_0xec49d2;try{this[_0x468770(0x179)]=_0xa96487,this[_0x468770(0x16a)]=typedi_1[_0x468770(0x168)]['get'](providers_tokens_1['Tokens']['gitApiService']),this[_0x468770(0x1af)]=typedi_1[_0x468770(0x168)][_0x468770(0x192)](providers_tokens_1[_0x468770(0x164)][_0x468770(0x15d)]),this['config']=typedi_1[_0x468770(0x168)][_0x468770(0x192)](providers_tokens_1[_0x468770(0x164)]['config']),await this[_0x468770(0x177)](),this['repository']=await this[_0x468770(0x1af)][_0x468770(0x15b)](this['repositoryData']['repositoryName']),this[_0x468770(0x169)]=await this['repository'][_0x468770(0x187)]['getOne'](this[_0x468770(0x184)][_0x468770(0x181)]),this['sfLogger']=typedi_1[_0x468770(0x168)][_0x468770(0x192)](providers_tokens_1[_0x468770(0x164)][_0x468770(0x1b2)]),this['prefix']='[FLOSUM\x20->\x20GIT]\x20['+this['config'][_0x468770(0x19c)]['toUpperCase']()+']\x20[Repository:\x20'+this[_0x468770(0x184)][_0x468770(0x176)]+']\x20[Branch:\x20'+this[_0x468770(0x184)][_0x468770(0x181)]+_0x468770(0x15f)+FlosumCommitJob_1[_0x468770(0x1ac)]+']';if(!this[_0x468770(0x184)])throw new bad_request_error_1[(_0x468770(0x1a9))](errors_1[_0x468770(0x1bc)]);await this['sfLogger'][_0x468770(0x1ae)](this['prefix']+_0x468770(0x1aa))['send'](),await this['exec']()[_0x468770(0x160)](_0x13c03d=>this['handleCommitJobError'](_0x13c03d));}catch(_0x51e746){this[_0x468770(0x179)]=undefined,this['logger'][_0x468770(0x15e)](_0x51e746);throw _0x51e746;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a104_0xec49d2(0x17d),[salesforce_service_1[a104_0xec49d2(0x185)],commit_components_job_1[a104_0xec49d2(0x1b3)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a104_0xec49d2(0x1a6)]=FlosumCommitJob;