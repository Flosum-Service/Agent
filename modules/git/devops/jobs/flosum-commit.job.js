const a122_0x10223d=a122_0x5c05;(function(_0x4a2516,_0x15fdeb){const _0x5e1633=a122_0x5c05,_0x2834d2=_0x4a2516();while(!![]){try{const _0x4c223c=parseInt(_0x5e1633(0x140))/0x1+-parseInt(_0x5e1633(0x113))/0x2+-parseInt(_0x5e1633(0x117))/0x3+parseInt(_0x5e1633(0x106))/0x4+parseInt(_0x5e1633(0xe6))/0x5+-parseInt(_0x5e1633(0x11a))/0x6*(parseInt(_0x5e1633(0x11d))/0x7)+parseInt(_0x5e1633(0x12d))/0x8;if(_0x4c223c===_0x15fdeb)break;else _0x2834d2['push'](_0x2834d2['shift']());}catch(_0x4058d9){_0x2834d2['push'](_0x2834d2['shift']());}}}(a122_0x274d,0x6c1b4));function a122_0x5c05(_0x5d4fdb,_0x4179c5){const _0x3d6546=a122_0x274d();return a122_0x5c05=function(_0x42d0a5,_0x3b3cd4){_0x42d0a5=_0x42d0a5-0xe4;let _0x274d39=_0x3d6546[_0x42d0a5];return _0x274d39;},a122_0x5c05(_0x5d4fdb,_0x4179c5);}const a122_0x3b3cd4=(function(){let _0x37510b=!![];return function(_0x3eb165,_0x42093c){const _0x3febde=_0x37510b?function(){const _0x12fd5f=a122_0x5c05;if(_0x42093c){const _0x2a042b=_0x42093c[_0x12fd5f(0x11b)](_0x3eb165,arguments);return _0x42093c=null,_0x2a042b;}}:function(){};return _0x37510b=![],_0x3febde;};}()),a122_0x42d0a5=a122_0x3b3cd4(this,function(){const _0x15cfb8=a122_0x5c05;return a122_0x42d0a5[_0x15cfb8(0x14d)]()[_0x15cfb8(0x123)](_0x15cfb8(0x149))[_0x15cfb8(0x14d)]()[_0x15cfb8(0x125)](a122_0x42d0a5)[_0x15cfb8(0x123)](_0x15cfb8(0x149));});function a122_0x274d(){const _0x524526=['metadata','branchName','(((.+)+)+)+$','getCommitDto','Logger','branches','toString','message','sha','deleteAttachmentId','3463660mQSOha','name','__importDefault','exec','shortid','../../../../constants',']\x20[','gitUrl','../../../../core/errors/bad-request.error','handleCommitJobError','logger','send','__decorate','../../salesforce/services/salesforce.service','function','getComponentsToDelete','decorate','ERR_UNKNOWN_SYNC_RECORD_ID','updateLastCommit','commitData','isConvertToSfdx','getOne','run','getBranchRecord','repositoryName','repository','patchObject','[FLOSUM\x20->\x20GIT]\x20[','getOwnPropertyDescriptor','convertToSFDX','toUpperCase','user','926748BRbuqJ','Container','components','commitAttachmentId','In\x20Progress','fetchRepositoryData','../../../../core','error','FlosumCommitJob','SalesforceSyncService','split','updateRemoteState','sfLogger','32690QPoIJH','./commit-components.job','default','repositoryData','2629698fTtcbI','recordType','commitJob','3414EmUWeK','apply','salesforceSync','8645MCQpnQ','get','SalesforceRetrieverService','salesforceService','BadRequestError','__metadata','search','../../salesforce/services/salesforce-sync.service','constructor','repo','syncRepositoryId','../../salesforce/services/salesforce-retriever.service','provider','CommitComponentsJob','gitRepoService',']\x20[Branch:\x20','8662248dwvhuF','gitProvider','trim','../dto/commit-components.dto','__esModule','deleteAttachment','getRepositoryRecord','Service','log','defineProperty','prefix','length','../../../../constants/errors','config',']\x20[Repository:\x20','getComponentsToWrite','repoService','FLOSUM_ATTACHMENT','gitApiService','31230SjemLU','object','setStatus','Tokens','syncBranchId','branch','parse'];a122_0x274d=function(){return _0x524526;};return a122_0x274d();}a122_0x42d0a5();'use strict';var __decorate=this&&this[a122_0x10223d(0xf2)]||function(_0x12d53f,_0x171af8,_0x3a5bd7,_0x36276b){const _0x12ad4b=a122_0x10223d;var _0x5cc914=arguments[_0x12ad4b(0x138)],_0x2a953a=_0x5cc914<0x3?_0x171af8:_0x36276b===null?_0x36276b=Object[_0x12ad4b(0x102)](_0x171af8,_0x3a5bd7):_0x36276b,_0x1e5676;if(typeof Reflect===_0x12ad4b(0x141)&&typeof Reflect['decorate']===_0x12ad4b(0xf4))_0x2a953a=Reflect[_0x12ad4b(0xf6)](_0x12d53f,_0x171af8,_0x3a5bd7,_0x36276b);else{for(var _0x16bfb8=_0x12d53f[_0x12ad4b(0x138)]-0x1;_0x16bfb8>=0x0;_0x16bfb8--)if(_0x1e5676=_0x12d53f[_0x16bfb8])_0x2a953a=(_0x5cc914<0x3?_0x1e5676(_0x2a953a):_0x5cc914>0x3?_0x1e5676(_0x171af8,_0x3a5bd7,_0x2a953a):_0x1e5676(_0x171af8,_0x3a5bd7))||_0x2a953a;}return _0x5cc914>0x3&&_0x2a953a&&Object[_0x12ad4b(0x136)](_0x171af8,_0x3a5bd7,_0x2a953a),_0x2a953a;},__metadata=this&&this[a122_0x10223d(0x122)]||function(_0x3fa2b9,_0x25a556){const _0x297501=a122_0x10223d;if(typeof Reflect===_0x297501(0x141)&&typeof Reflect[_0x297501(0x147)]===_0x297501(0xf4))return Reflect[_0x297501(0x147)](_0x3fa2b9,_0x25a556);},__importDefault=this&&this[a122_0x10223d(0xe8)]||function(_0x4177dc){const _0x4e6b5f=a122_0x10223d;return _0x4177dc&&_0x4177dc[_0x4e6b5f(0x131)]?_0x4177dc:{'default':_0x4177dc};},FlosumCommitJob_1;Object[a122_0x10223d(0x136)](exports,'__esModule',{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a122_0x10223d(0x10c)),salesforce_service_1=require(a122_0x10223d(0xf3)),typedi_1=require('typedi'),errors_1=require(a122_0x10223d(0x139)),bad_request_error_1=require(a122_0x10223d(0xee)),salesforce_retriever_service_1=require(a122_0x10223d(0x128)),salesforce_sync_service_1=require(a122_0x10223d(0x124)),commit_components_dto_1=require(a122_0x10223d(0x130)),commit_components_job_1=require(a122_0x10223d(0x114)),constants_1=require(a122_0x10223d(0xeb)),shortid_1=__importDefault(require(a122_0x10223d(0xea))),providers_tokens_1=require('../../providers/providers.tokens');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x2da9a0,_0x4e962f,_0x1fe82f){const _0x46be48=a122_0x10223d;this[_0x46be48(0x120)]=_0x2da9a0,this['commitJob']=_0x4e962f,this[_0x46be48(0x11c)]=_0x1fe82f,this[_0x46be48(0xf0)]=new core_1[(_0x46be48(0x14b))](FlosumCommitJob_1[_0x46be48(0xe7)]);}async[a122_0x10223d(0x10b)](){const _0x1966d0=a122_0x10223d;try{if(this['commitData']['syncRepositoryId'])this[_0x1966d0(0x116)]=await this['salesforceSync'][_0x1966d0(0x133)](this[_0x1966d0(0xf9)][_0x1966d0(0x127)]);else this['commitData'][_0x1966d0(0x144)]&&(this[_0x1966d0(0x116)]=await this[_0x1966d0(0x11c)][_0x1966d0(0xfd)](this['commitData'][_0x1966d0(0x144)]));}catch(_0x115d6c){throw new bad_request_error_1[(_0x1966d0(0x121))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a122_0x10223d(0x13c)](){const _0xbcca2c=a122_0x10223d;if(!this['commitData']['commitAttachmentId'])return[];await this[_0xbcca2c(0x120)][_0xbcca2c(0x100)](constants_1[_0xbcca2c(0x13e)],this[_0xbcca2c(0xf9)][_0xbcca2c(0x109)],{'Name':(0x0,shortid_1[_0xbcca2c(0x115)])()});const _0x2fa4f3=await this['salesforceService']['retrieveAttachment'](this[_0xbcca2c(0xf9)][_0xbcca2c(0x109)])['then'](_0x354cfc=>_0x354cfc[_0xbcca2c(0x110)]('\x20')['map'](_0x28bf4d=>_0x28bf4d[_0xbcca2c(0x12f)]()));await this[_0xbcca2c(0x120)][_0xbcca2c(0x132)](this[_0xbcca2c(0xf9)][_0xbcca2c(0x109)]);const _0xbe4d0b=new salesforce_retriever_service_1[(_0xbcca2c(0x11f))](this[_0xbcca2c(0x120)]);return await _0xbe4d0b['run'](_0x2fa4f3);}async[a122_0x10223d(0xf5)](){const _0x2af835=a122_0x10223d;if(!this[_0x2af835(0xf9)][_0x2af835(0xe5)])return[];await this[_0x2af835(0x120)][_0x2af835(0x100)](constants_1[_0x2af835(0x13e)],this[_0x2af835(0xf9)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0x2af835(0x115)])()});const _0x334d99=await this['salesforceService']['retrieveAttachment'](this[_0x2af835(0xf9)][_0x2af835(0xe5)]),_0x2b267c=JSON[_0x2af835(0x146)](_0x334d99);return await this['salesforceService'][_0x2af835(0x132)](this['commitData'][_0x2af835(0xe5)]),_0x2b267c;}async[a122_0x10223d(0x14a)](){const _0x37c49f=a122_0x10223d,_0x5400b4=new commit_components_dto_1['CommitComponentsDto'](),[_0x287515,_0x40e73b]=await Promise['all']([this[_0x37c49f(0x13c)](),this[_0x37c49f(0xf5)]()]);return _0x5400b4[_0x37c49f(0x14e)]=this[_0x37c49f(0xf9)][_0x37c49f(0x14e)],_0x5400b4[_0x37c49f(0x105)]=this[_0x37c49f(0xf9)][_0x37c49f(0x105)],_0x5400b4[_0x37c49f(0x108)]={'writed':_0x287515,'deleted':_0x40e73b},_0x5400b4[_0x37c49f(0x103)]=this[_0x37c49f(0x13a)][_0x37c49f(0xfa)],_0x5400b4[_0x37c49f(0x126)]=this[_0x37c49f(0xff)],_0x5400b4[_0x37c49f(0x145)]=this[_0x37c49f(0x145)],_0x5400b4[_0x37c49f(0x129)]=this['config'][_0x37c49f(0x12e)],_0x5400b4[_0x37c49f(0x118)]=this['repositoryData']['recordTypeName'],_0x5400b4;}async['updateLastCommit'](_0x4732c0=![]){const _0x3af4b1=a122_0x10223d;if(_0x4732c0)await this[_0x3af4b1(0x11c)][_0x3af4b1(0x111)](this[_0x3af4b1(0x116)],{});else{const _0x3c4909=await this[_0x3af4b1(0xff)][_0x3af4b1(0x14c)][_0x3af4b1(0xfb)](this[_0x3af4b1(0x145)]['name']);this[_0x3af4b1(0x112)][_0x3af4b1(0x135)](this[_0x3af4b1(0x137)]+'\x20Update\x20remote\x20state.');const _0x5e8372={[this[_0x3af4b1(0xff)][_0x3af4b1(0xed)]]:{'lastCommit':_0x3c4909[_0x3af4b1(0xe4)]}};await this[_0x3af4b1(0x11c)][_0x3af4b1(0x111)](this['repositoryData'],_0x5e8372);}}async[a122_0x10223d(0xe9)](){const _0x4d1344=a122_0x10223d,_0x37152c=await this[_0x4d1344(0x14a)]();await this[_0x4d1344(0x11c)]['setStatus'](this[_0x4d1344(0x116)],_0x4d1344(0x10a)),await this[_0x4d1344(0x119)]['run'](_0x37152c,this['prefix']),await this[_0x4d1344(0xf8)](),await this[_0x4d1344(0x11c)]['setStatus'](this[_0x4d1344(0x116)],'Completed');}async[a122_0x10223d(0xef)](_0x182b58){const _0x4ba4b2=a122_0x10223d;try{this[_0x4ba4b2(0x112)][_0x4ba4b2(0x10d)](''+_0x182b58),await this[_0x4ba4b2(0x112)]['send'](),await this['updateLastCommit'](!![]),await this[_0x4ba4b2(0x11c)][_0x4ba4b2(0x142)](this['repositoryData'],'Error');}catch(_0x426c49){this[_0x4ba4b2(0xf0)][_0x4ba4b2(0x10d)](_0x426c49);}}async[a122_0x10223d(0xfc)](_0x1ccc0f){const _0xcfec1d=a122_0x10223d;try{this[_0xcfec1d(0xf9)]=_0x1ccc0f,this[_0xcfec1d(0x13f)]=typedi_1[_0xcfec1d(0x107)][_0xcfec1d(0x11e)](providers_tokens_1['Tokens'][_0xcfec1d(0x13f)]),this[_0xcfec1d(0x13d)]=typedi_1[_0xcfec1d(0x107)]['get'](providers_tokens_1[_0xcfec1d(0x143)][_0xcfec1d(0x12b)]),this[_0xcfec1d(0x13a)]=typedi_1[_0xcfec1d(0x107)]['get'](providers_tokens_1['Tokens'][_0xcfec1d(0x13a)]),await this['fetchRepositoryData'](),this['repository']=await this[_0xcfec1d(0x13d)]['getOne'](this[_0xcfec1d(0x116)]['repositoryName']),this[_0xcfec1d(0x145)]=await this[_0xcfec1d(0xff)][_0xcfec1d(0x14c)]['getOne'](this[_0xcfec1d(0x116)][_0xcfec1d(0x148)]),this['sfLogger']=typedi_1[_0xcfec1d(0x107)][_0xcfec1d(0x11e)](providers_tokens_1[_0xcfec1d(0x143)][_0xcfec1d(0xf0)]),this['prefix']=_0xcfec1d(0x101)+this[_0xcfec1d(0x13a)][_0xcfec1d(0x12e)][_0xcfec1d(0x104)]()+_0xcfec1d(0x13b)+this[_0xcfec1d(0x116)][_0xcfec1d(0xfe)]+_0xcfec1d(0x12c)+this[_0xcfec1d(0x116)][_0xcfec1d(0x148)]+_0xcfec1d(0xec)+FlosumCommitJob_1[_0xcfec1d(0xe7)]+']';if(!this[_0xcfec1d(0x116)])throw new bad_request_error_1[(_0xcfec1d(0x121))](errors_1[_0xcfec1d(0xf7)]);await this[_0xcfec1d(0x112)][_0xcfec1d(0x135)](this[_0xcfec1d(0x137)]+'\x20Start\x20Flosum\x20commit\x20job.')[_0xcfec1d(0xf1)](),await this['exec']()['catch'](_0xd2e940=>this[_0xcfec1d(0xef)](_0xd2e940));}catch(_0x2c40f9){this['commitData']=undefined,this[_0xcfec1d(0xf0)]['error'](_0x2c40f9);throw _0x2c40f9;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a122_0x10223d(0x134)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1['SalesforceService'],commit_components_job_1[a122_0x10223d(0x12a)],salesforce_sync_service_1[a122_0x10223d(0x10f)]])],FlosumCommitJob),exports[a122_0x10223d(0x10e)]=FlosumCommitJob;