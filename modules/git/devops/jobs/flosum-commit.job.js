const a105_0x28d26e=a105_0x2c09;(function(_0x1ba1ff,_0x570713){const _0x570590=a105_0x2c09,_0x497aa3=_0x1ba1ff();while(!![]){try{const _0x1499b6=parseInt(_0x570590(0x166))/0x1*(parseInt(_0x570590(0x14d))/0x2)+parseInt(_0x570590(0x14f))/0x3+parseInt(_0x570590(0x14c))/0x4*(-parseInt(_0x570590(0x128))/0x5)+parseInt(_0x570590(0x12d))/0x6*(-parseInt(_0x570590(0x182))/0x7)+-parseInt(_0x570590(0x15e))/0x8+parseInt(_0x570590(0x171))/0x9+-parseInt(_0x570590(0x18d))/0xa*(-parseInt(_0x570590(0x14e))/0xb);if(_0x1499b6===_0x570713)break;else _0x497aa3['push'](_0x497aa3['shift']());}catch(_0x52da24){_0x497aa3['push'](_0x497aa3['shift']());}}}(a105_0x2e0d,0xba051));const a105_0x228c64=(function(){let _0x5c6ef3=!![];return function(_0x2d4dde,_0x51ff6c){const _0x848acb=_0x5c6ef3?function(){const _0x44e30d=a105_0x2c09;if(_0x51ff6c){const _0x1e7635=_0x51ff6c[_0x44e30d(0x170)](_0x2d4dde,arguments);return _0x51ff6c=null,_0x1e7635;}}:function(){};return _0x5c6ef3=![],_0x848acb;};}()),a105_0x309acf=a105_0x228c64(this,function(){const _0x51ebfe=a105_0x2c09;return a105_0x309acf['toString']()[_0x51ebfe(0x140)](_0x51ebfe(0x135))['toString']()[_0x51ebfe(0x137)](a105_0x309acf)['search']('(((.+)+)+)+$');});a105_0x309acf();'use strict';function a105_0x2e0d(){const _0x46b946=['apply','5836788dhLAiV','shortid','sfLogger','repositoryName','logger','ERR_INVALID_SYNC_RECORD_ID','deleteAttachmentId','./commit-components.job','updateRemoteState','\x20Update\x20remote\x20state.','retrieveAttachment','getCommitDto','syncBranchId','../../../../core','deleteAttachment','../../salesforce/services/salesforce-sync.service','setStatus','11326RfHfgG','../../../../constants','SalesforceRetrieverService','map','function','decorate','BadRequestError',']\x20[Branch:\x20','../../salesforce/services/salesforce.service','toUpperCase','length','10mhcvGo','gitApiService','gitProvider','SalesforceSyncService','getComponentsToDelete','syncRepositoryId','245540Snvsbq','get','catch','prefix','commitData','5286xefutg','Service','fetchRepositoryData','exec','error','FlosumCommitJob','split','isConvertToSfdx','(((.+)+)+)+$','getComponentsToWrite','constructor','all','components','message','branchName','branches','__metadata','getBranchRecord','gitUrl','search','run','object','log','getOne','Tokens','salesforceSync','../../salesforce/services/salesforce-retriever.service','handleCommitJobError','send','SalesforceService','../dto/commit-components.dto','8xtsbAW','658006mTfbNc','8529653wWzOuJ','1627023pvrfGS','commitAttachmentId','default','defineProperty','CommitComponentsDto','getOwnPropertyDescriptor','sha','Container','Logger','Completed','repositoryData','\x20Start\x20Flosum\x20commit\x20job.','In\x20Progress','__esModule','CommitComponentsJob','77504uNVyqQ','repo','config','repository','../../../../core/errors/bad-request.error','__importDefault','salesforceService','updateLastCommit','1ahRdRb','name','getRepositoryRecord','repoService','commitJob','convertToSFDX','patchObject','[FLOSUM\x20->\x20GIT]\x20[','branch','../../providers/providers.tokens'];a105_0x2e0d=function(){return _0x46b946;};return a105_0x2e0d();}var __decorate=this&&this['__decorate']||function(_0xe57b0d,_0x20d51b,_0x271dd0,_0x19db96){const _0x4780d3=a105_0x2c09;var _0x262538=arguments[_0x4780d3(0x18c)],_0x157ae3=_0x262538<0x3?_0x20d51b:_0x19db96===null?_0x19db96=Object[_0x4780d3(0x154)](_0x20d51b,_0x271dd0):_0x19db96,_0x3b4673;if(typeof Reflect==='object'&&typeof Reflect[_0x4780d3(0x187)]==='function')_0x157ae3=Reflect[_0x4780d3(0x187)](_0xe57b0d,_0x20d51b,_0x271dd0,_0x19db96);else{for(var _0x402b54=_0xe57b0d[_0x4780d3(0x18c)]-0x1;_0x402b54>=0x0;_0x402b54--)if(_0x3b4673=_0xe57b0d[_0x402b54])_0x157ae3=(_0x262538<0x3?_0x3b4673(_0x157ae3):_0x262538>0x3?_0x3b4673(_0x20d51b,_0x271dd0,_0x157ae3):_0x3b4673(_0x20d51b,_0x271dd0))||_0x157ae3;}return _0x262538>0x3&&_0x157ae3&&Object[_0x4780d3(0x152)](_0x20d51b,_0x271dd0,_0x157ae3),_0x157ae3;},__metadata=this&&this[a105_0x28d26e(0x13d)]||function(_0x419e65,_0xd0136b){const _0x257c38=a105_0x28d26e;if(typeof Reflect===_0x257c38(0x142)&&typeof Reflect['metadata']===_0x257c38(0x186))return Reflect['metadata'](_0x419e65,_0xd0136b);},__importDefault=this&&this[a105_0x28d26e(0x163)]||function(_0x5d8565){const _0x48e063=a105_0x28d26e;return _0x5d8565&&_0x5d8565[_0x48e063(0x15c)]?_0x5d8565:{'default':_0x5d8565};},FlosumCommitJob_1;function a105_0x2c09(_0x4ebaa2,_0x1879e7){const _0x5d215d=a105_0x2e0d();return a105_0x2c09=function(_0x309acf,_0x228c64){_0x309acf=_0x309acf-0x123;let _0x2e0d33=_0x5d215d[_0x309acf];return _0x2e0d33;},a105_0x2c09(_0x4ebaa2,_0x1879e7);}Object[a105_0x28d26e(0x152)](exports,a105_0x28d26e(0x15c),{'value':!![]}),exports[a105_0x28d26e(0x132)]=void 0x0;const core_1=require(a105_0x28d26e(0x17e)),salesforce_service_1=require(a105_0x28d26e(0x18a)),typedi_1=require('typedi'),errors_1=require('../../../../constants/errors'),bad_request_error_1=require(a105_0x28d26e(0x162)),salesforce_retriever_service_1=require(a105_0x28d26e(0x147)),salesforce_sync_service_1=require(a105_0x28d26e(0x180)),commit_components_dto_1=require(a105_0x28d26e(0x14b)),commit_components_job_1=require(a105_0x28d26e(0x178)),constants_1=require(a105_0x28d26e(0x183)),shortid_1=__importDefault(require(a105_0x28d26e(0x172))),providers_tokens_1=require(a105_0x28d26e(0x16f));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x1bb17c,_0x56dc71,_0x56d4e8){const _0x389d00=a105_0x28d26e;this[_0x389d00(0x164)]=_0x1bb17c,this['commitJob']=_0x56dc71,this[_0x389d00(0x146)]=_0x56d4e8,this['logger']=new core_1[(_0x389d00(0x157))](FlosumCommitJob_1[_0x389d00(0x167)]);}async[a105_0x28d26e(0x12f)](){const _0x399221=a105_0x28d26e;try{if(this[_0x399221(0x12c)]['syncRepositoryId'])this['repositoryData']=await this[_0x399221(0x146)][_0x399221(0x168)](this['commitData'][_0x399221(0x127)]);else this['commitData']['syncBranchId']&&(this[_0x399221(0x159)]=await this['salesforceSync'][_0x399221(0x13e)](this['commitData'][_0x399221(0x17d)]));}catch(_0x5cf575){throw new bad_request_error_1[(_0x399221(0x188))](errors_1[_0x399221(0x176)]);}}async[a105_0x28d26e(0x136)](){const _0x48fa2b=a105_0x28d26e;if(!this[_0x48fa2b(0x12c)]['commitAttachmentId'])return[];await this[_0x48fa2b(0x164)][_0x48fa2b(0x16c)](constants_1['FLOSUM_ATTACHMENT'],this[_0x48fa2b(0x12c)][_0x48fa2b(0x150)],{'Name':(0x0,shortid_1[_0x48fa2b(0x151)])()});const _0x30fd0f=await this[_0x48fa2b(0x164)][_0x48fa2b(0x17b)](this[_0x48fa2b(0x12c)][_0x48fa2b(0x150)])['then'](_0x782b04=>_0x782b04[_0x48fa2b(0x133)]('\x20')[_0x48fa2b(0x185)](_0x3514b0=>_0x3514b0['trim']()));await this[_0x48fa2b(0x164)][_0x48fa2b(0x17f)](this['commitData']['commitAttachmentId']);const _0x3c0141=new salesforce_retriever_service_1[(_0x48fa2b(0x184))](this['salesforceService']);return await _0x3c0141['run'](_0x30fd0f);}async[a105_0x28d26e(0x126)](){const _0xc18f90=a105_0x28d26e;if(!this['commitData']['deleteAttachmentId'])return[];await this[_0xc18f90(0x164)][_0xc18f90(0x16c)](constants_1['FLOSUM_ATTACHMENT'],this[_0xc18f90(0x12c)][_0xc18f90(0x177)],{'Name':(0x0,shortid_1['default'])()});const _0x245299=await this[_0xc18f90(0x164)][_0xc18f90(0x17b)](this['commitData']['deleteAttachmentId']);return await this[_0xc18f90(0x164)]['deleteAttachment'](this[_0xc18f90(0x12c)][_0xc18f90(0x177)]),_0x245299;}async[a105_0x28d26e(0x17c)](){const _0xfcbc43=a105_0x28d26e,_0x491f5e=new commit_components_dto_1[(_0xfcbc43(0x153))](),[_0x339b13,_0x40901a]=await Promise[_0xfcbc43(0x138)]([this['getComponentsToWrite'](),this[_0xfcbc43(0x126)]()]);return _0x491f5e[_0xfcbc43(0x13a)]=this[_0xfcbc43(0x12c)]['message'],_0x491f5e['user']=this[_0xfcbc43(0x12c)]['user'],_0x491f5e[_0xfcbc43(0x139)]={'writed':_0x339b13,'deleted':_0x40901a},_0x491f5e[_0xfcbc43(0x16b)]=this[_0xfcbc43(0x160)][_0xfcbc43(0x134)],_0x491f5e[_0xfcbc43(0x15f)]=this['repository'],_0x491f5e[_0xfcbc43(0x16e)]=this[_0xfcbc43(0x16e)],_0x491f5e['provider']=this[_0xfcbc43(0x160)][_0xfcbc43(0x124)],_0x491f5e;}async[a105_0x28d26e(0x165)](_0x43a236=![]){const _0x53e118=a105_0x28d26e;if(_0x43a236)await this['salesforceSync'][_0x53e118(0x179)](this[_0x53e118(0x159)],{});else{const _0x576489=await this[_0x53e118(0x161)]['branches'][_0x53e118(0x144)](this[_0x53e118(0x16e)][_0x53e118(0x167)]);this['sfLogger'][_0x53e118(0x143)](this[_0x53e118(0x12b)]+_0x53e118(0x17a));const _0x10a028={[this[_0x53e118(0x161)][_0x53e118(0x13f)]]:{'lastCommit':_0x576489[_0x53e118(0x155)]}};await this[_0x53e118(0x146)]['updateRemoteState'](this[_0x53e118(0x159)],_0x10a028);}}async[a105_0x28d26e(0x130)](){const _0x3c1813=a105_0x28d26e,_0x165625=await this[_0x3c1813(0x17c)]();await this[_0x3c1813(0x146)][_0x3c1813(0x181)](this[_0x3c1813(0x159)],_0x3c1813(0x15b)),await this[_0x3c1813(0x16a)][_0x3c1813(0x141)](_0x165625,this['prefix']),await this[_0x3c1813(0x165)](),await this[_0x3c1813(0x146)]['setStatus'](this['repositoryData'],_0x3c1813(0x158));}async[a105_0x28d26e(0x148)](_0x3c8d40){const _0x1a1674=a105_0x28d26e;try{this[_0x1a1674(0x173)]['error'](''+_0x3c8d40),await this[_0x1a1674(0x173)][_0x1a1674(0x149)](),await this[_0x1a1674(0x165)](!![]),await this[_0x1a1674(0x146)][_0x1a1674(0x181)](this['repositoryData'],'Error');}catch(_0x4821b0){this[_0x1a1674(0x175)][_0x1a1674(0x131)](_0x4821b0);}}async[a105_0x28d26e(0x141)](_0x27e636){const _0x1a6ac1=a105_0x28d26e;try{this[_0x1a6ac1(0x12c)]=_0x27e636,this[_0x1a6ac1(0x123)]=typedi_1[_0x1a6ac1(0x156)]['get'](providers_tokens_1[_0x1a6ac1(0x145)][_0x1a6ac1(0x123)]),this[_0x1a6ac1(0x169)]=typedi_1[_0x1a6ac1(0x156)][_0x1a6ac1(0x129)](providers_tokens_1[_0x1a6ac1(0x145)]['gitRepoService']),this[_0x1a6ac1(0x160)]=typedi_1[_0x1a6ac1(0x156)][_0x1a6ac1(0x129)](providers_tokens_1[_0x1a6ac1(0x145)][_0x1a6ac1(0x160)]),await this['fetchRepositoryData'](),this[_0x1a6ac1(0x161)]=await this[_0x1a6ac1(0x169)][_0x1a6ac1(0x144)](this[_0x1a6ac1(0x159)]['repositoryName']),this[_0x1a6ac1(0x16e)]=await this[_0x1a6ac1(0x161)][_0x1a6ac1(0x13c)][_0x1a6ac1(0x144)](this[_0x1a6ac1(0x159)][_0x1a6ac1(0x13b)]),this[_0x1a6ac1(0x173)]=typedi_1['Container'][_0x1a6ac1(0x129)](providers_tokens_1[_0x1a6ac1(0x145)][_0x1a6ac1(0x175)]),this['prefix']=_0x1a6ac1(0x16d)+this[_0x1a6ac1(0x160)][_0x1a6ac1(0x124)][_0x1a6ac1(0x18b)]()+']\x20[Repository:\x20'+this['repositoryData'][_0x1a6ac1(0x174)]+_0x1a6ac1(0x189)+this[_0x1a6ac1(0x159)][_0x1a6ac1(0x13b)]+']\x20['+FlosumCommitJob_1[_0x1a6ac1(0x167)]+']';if(!this[_0x1a6ac1(0x159)])throw new bad_request_error_1[(_0x1a6ac1(0x188))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this['sfLogger']['log'](this[_0x1a6ac1(0x12b)]+_0x1a6ac1(0x15a))['send'](),await this[_0x1a6ac1(0x130)]()[_0x1a6ac1(0x12a)](_0x27cb5b=>this['handleCommitJobError'](_0x27cb5b));}catch(_0x8dfccf){this[_0x1a6ac1(0x12c)]=undefined,this[_0x1a6ac1(0x175)][_0x1a6ac1(0x131)](_0x8dfccf);throw _0x8dfccf;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x28d26e(0x12e)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a105_0x28d26e(0x14a)],commit_components_job_1[a105_0x28d26e(0x15d)],salesforce_sync_service_1[a105_0x28d26e(0x125)]])],FlosumCommitJob),exports[a105_0x28d26e(0x132)]=FlosumCommitJob;