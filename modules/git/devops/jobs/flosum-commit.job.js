const a122_0x2ec2d5=a122_0x1ab6;(function(_0x37d37a,_0x54969f){const _0x565c14=a122_0x1ab6,_0x561f93=_0x37d37a();while(!![]){try{const _0x2dad42=parseInt(_0x565c14(0x175))/0x1*(parseInt(_0x565c14(0x13e))/0x2)+parseInt(_0x565c14(0x16d))/0x3+-parseInt(_0x565c14(0x165))/0x4+parseInt(_0x565c14(0x166))/0x5*(-parseInt(_0x565c14(0x14b))/0x6)+-parseInt(_0x565c14(0x19b))/0x7+parseInt(_0x565c14(0x193))/0x8+parseInt(_0x565c14(0x179))/0x9;if(_0x2dad42===_0x54969f)break;else _0x561f93['push'](_0x561f93['shift']());}catch(_0x128944){_0x561f93['push'](_0x561f93['shift']());}}}(a122_0xe383,0x85409));function a122_0xe383(){const _0x479770=['config','ERR_INVALID_SYNC_RECORD_ID','__decorate','10gNChGm','Service','(((.+)+)+)+$','exec','../../../../core','error','prefix','apply','user','logger','isConvertToSfdx','gitApiService','typedi','3644526AYGcZy','CommitComponentsJob','../../salesforce/services/salesforce-retriever.service','BadRequestError','getCommitDto','metadata','get','gitUrl','Logger','object','salesforceSync','map','FlosumCommitJob','convertToSFDX','design:paramtypes','all','deleteAttachment','message','Error','__metadata','log','sfLogger','Container','handleCommitJobError','repository','commitJob','2146752lRRAyt','5VHEGOT','gitProvider','../../providers/providers.tokens','branchName','gitRepoService','length','default','3186609TgtdJN','trim','__esModule','./commit-components.job','getComponentsToDelete','defineProperty','../dto/commit-components.dto','decorate','18617hsNAyk','getOne','updateLastCommit','SalesforceSyncService','773154vUxWTp','then','shortid','salesforceService','search','function','\x20Update\x20remote\x20state.','getOwnPropertyDescriptor','fetchRepositoryData','getComponentsToWrite','../../../../constants','setStatus','branches','split','provider',']\x20[','retrieveAttachment','parse','../../salesforce/services/salesforce.service','deleteAttachmentId','repositoryData','syncRepositoryId','updateRemoteState','SalesforceRetrieverService','syncBranchId','commitAttachmentId','7643760FjOAxe','__importDefault','constructor','Tokens','branch','send','CommitComponentsDto','patchObject','3547278bQpIqy','run','repositoryName','[FLOSUM\x20->\x20GIT]\x20[','name','recordType','FLOSUM_ATTACHMENT','commitData','repoService'];a122_0xe383=function(){return _0x479770;};return a122_0xe383();}const a122_0x1032ac=(function(){let _0x2a4ed5=!![];return function(_0x5061e0,_0x102696){const _0x2585ab=_0x2a4ed5?function(){const _0x24b27e=a122_0x1ab6;if(_0x102696){const _0xe8a558=_0x102696[_0x24b27e(0x145)](_0x5061e0,arguments);return _0x102696=null,_0xe8a558;}}:function(){};return _0x2a4ed5=![],_0x2585ab;};}()),a122_0x53741b=a122_0x1032ac(this,function(){const _0x51d149=a122_0x1ab6;return a122_0x53741b['toString']()[_0x51d149(0x17d)](_0x51d149(0x140))['toString']()[_0x51d149(0x195)](a122_0x53741b)[_0x51d149(0x17d)](_0x51d149(0x140));});a122_0x53741b();'use strict';var __decorate=this&&this[a122_0x2ec2d5(0x1a6)]||function(_0x27256e,_0x4b98af,_0x4612a8,_0x405eaf){const _0x12de30=a122_0x2ec2d5;var _0x2ab9e5=arguments[_0x12de30(0x16b)],_0x4d814d=_0x2ab9e5<0x3?_0x4b98af:_0x405eaf===null?_0x405eaf=Object[_0x12de30(0x180)](_0x4b98af,_0x4612a8):_0x405eaf,_0x496d3d;if(typeof Reflect===_0x12de30(0x154)&&typeof Reflect[_0x12de30(0x174)]===_0x12de30(0x17e))_0x4d814d=Reflect[_0x12de30(0x174)](_0x27256e,_0x4b98af,_0x4612a8,_0x405eaf);else{for(var _0x45b0e0=_0x27256e['length']-0x1;_0x45b0e0>=0x0;_0x45b0e0--)if(_0x496d3d=_0x27256e[_0x45b0e0])_0x4d814d=(_0x2ab9e5<0x3?_0x496d3d(_0x4d814d):_0x2ab9e5>0x3?_0x496d3d(_0x4b98af,_0x4612a8,_0x4d814d):_0x496d3d(_0x4b98af,_0x4612a8))||_0x4d814d;}return _0x2ab9e5>0x3&&_0x4d814d&&Object[_0x12de30(0x172)](_0x4b98af,_0x4612a8,_0x4d814d),_0x4d814d;},__metadata=this&&this[a122_0x2ec2d5(0x15e)]||function(_0xcdf685,_0x53e247){const _0xcbea7=a122_0x2ec2d5;if(typeof Reflect===_0xcbea7(0x154)&&typeof Reflect[_0xcbea7(0x150)]===_0xcbea7(0x17e))return Reflect[_0xcbea7(0x150)](_0xcdf685,_0x53e247);},__importDefault=this&&this[a122_0x2ec2d5(0x194)]||function(_0x3703cb){const _0x172453=a122_0x2ec2d5;return _0x3703cb&&_0x3703cb[_0x172453(0x16f)]?_0x3703cb:{'default':_0x3703cb};},FlosumCommitJob_1;Object[a122_0x2ec2d5(0x172)](exports,a122_0x2ec2d5(0x16f),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;function a122_0x1ab6(_0x172e31,_0x55397e){const _0x48d24e=a122_0xe383();return a122_0x1ab6=function(_0x53741b,_0x1032ac){_0x53741b=_0x53741b-0x13e;let _0xe38366=_0x48d24e[_0x53741b];return _0xe38366;},a122_0x1ab6(_0x172e31,_0x55397e);}const core_1=require(a122_0x2ec2d5(0x142)),salesforce_service_1=require(a122_0x2ec2d5(0x18b)),typedi_1=require(a122_0x2ec2d5(0x14a)),errors_1=require('../../../../constants/errors'),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a122_0x2ec2d5(0x14d)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a122_0x2ec2d5(0x173)),commit_components_job_1=require(a122_0x2ec2d5(0x170)),constants_1=require(a122_0x2ec2d5(0x183)),shortid_1=__importDefault(require(a122_0x2ec2d5(0x17b))),providers_tokens_1=require(a122_0x2ec2d5(0x168));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x59ee20,_0x52b987,_0x18af13){const _0x2d12a7=a122_0x2ec2d5;this['salesforceService']=_0x59ee20,this[_0x2d12a7(0x164)]=_0x52b987,this[_0x2d12a7(0x155)]=_0x18af13,this[_0x2d12a7(0x147)]=new core_1[(_0x2d12a7(0x153))](FlosumCommitJob_1[_0x2d12a7(0x19f)]);}async['fetchRepositoryData'](){const _0x5e9939=a122_0x2ec2d5;try{if(this[_0x5e9939(0x1a2)][_0x5e9939(0x18e)])this['repositoryData']=await this[_0x5e9939(0x155)]['getRepositoryRecord'](this[_0x5e9939(0x1a2)][_0x5e9939(0x18e)]);else this[_0x5e9939(0x1a2)][_0x5e9939(0x191)]&&(this[_0x5e9939(0x18d)]=await this[_0x5e9939(0x155)]['getBranchRecord'](this[_0x5e9939(0x1a2)]['syncBranchId']));}catch(_0x1553a2){throw new bad_request_error_1[(_0x5e9939(0x14e))](errors_1[_0x5e9939(0x1a5)]);}}async['getComponentsToWrite'](){const _0x2f8320=a122_0x2ec2d5;if(!this[_0x2f8320(0x1a2)]['commitAttachmentId'])return[];await this[_0x2f8320(0x17c)]['patchObject'](constants_1[_0x2f8320(0x1a1)],this['commitData'][_0x2f8320(0x192)],{'Name':(0x0,shortid_1[_0x2f8320(0x16c)])()});const _0x48a34b=await this[_0x2f8320(0x17c)][_0x2f8320(0x189)](this[_0x2f8320(0x1a2)][_0x2f8320(0x192)])[_0x2f8320(0x17a)](_0x27bb20=>_0x27bb20[_0x2f8320(0x186)]('\x20')[_0x2f8320(0x156)](_0x35b326=>_0x35b326[_0x2f8320(0x16e)]()));await this['salesforceService']['deleteAttachment'](this[_0x2f8320(0x1a2)][_0x2f8320(0x192)]);const _0x8b8dec=new salesforce_retriever_service_1[(_0x2f8320(0x190))](this[_0x2f8320(0x17c)]);return await _0x8b8dec['run'](_0x48a34b);}async[a122_0x2ec2d5(0x171)](){const _0x11a4a2=a122_0x2ec2d5;if(!this[_0x11a4a2(0x1a2)]['deleteAttachmentId'])return[];await this['salesforceService'][_0x11a4a2(0x19a)](constants_1['FLOSUM_ATTACHMENT'],this[_0x11a4a2(0x1a2)][_0x11a4a2(0x18c)],{'Name':(0x0,shortid_1[_0x11a4a2(0x16c)])()});const _0x30bcf8=await this['salesforceService']['retrieveAttachment'](this[_0x11a4a2(0x1a2)]['deleteAttachmentId']),_0x7f05ec=JSON[_0x11a4a2(0x18a)](_0x30bcf8);return await this[_0x11a4a2(0x17c)][_0x11a4a2(0x15b)](this[_0x11a4a2(0x1a2)][_0x11a4a2(0x18c)]),_0x7f05ec;}async[a122_0x2ec2d5(0x14f)](){const _0x116c8f=a122_0x2ec2d5,_0x2e8c91=new commit_components_dto_1[(_0x116c8f(0x199))](),[_0x404c8a,_0x5ebef7]=await Promise[_0x116c8f(0x15a)]([this[_0x116c8f(0x182)](),this['getComponentsToDelete']()]);return _0x2e8c91[_0x116c8f(0x15c)]=this[_0x116c8f(0x1a2)][_0x116c8f(0x15c)],_0x2e8c91[_0x116c8f(0x146)]=this['commitData'][_0x116c8f(0x146)],_0x2e8c91['components']={'writed':_0x404c8a,'deleted':_0x5ebef7},_0x2e8c91[_0x116c8f(0x158)]=this[_0x116c8f(0x1a4)][_0x116c8f(0x148)],_0x2e8c91['repo']=this[_0x116c8f(0x163)],_0x2e8c91['branch']=this[_0x116c8f(0x197)],_0x2e8c91[_0x116c8f(0x187)]=this['config']['gitProvider'],_0x2e8c91[_0x116c8f(0x1a0)]=this[_0x116c8f(0x18d)]['recordTypeName'],_0x2e8c91;}async[a122_0x2ec2d5(0x177)](_0x88aa28=![]){const _0x359ac6=a122_0x2ec2d5;if(_0x88aa28)await this[_0x359ac6(0x155)][_0x359ac6(0x18f)](this[_0x359ac6(0x18d)],{});else{const _0x5966f5=await this[_0x359ac6(0x163)]['branches'][_0x359ac6(0x176)](this['branch']['name']);this[_0x359ac6(0x160)][_0x359ac6(0x15f)](this['prefix']+_0x359ac6(0x17f));const _0x302096={[this[_0x359ac6(0x163)][_0x359ac6(0x152)]]:{'lastCommit':_0x5966f5['sha']}};await this['salesforceSync'][_0x359ac6(0x18f)](this[_0x359ac6(0x18d)],_0x302096);}}async['exec'](){const _0x36e88f=a122_0x2ec2d5,_0x500948=await this[_0x36e88f(0x14f)]();await this[_0x36e88f(0x155)]['setStatus'](this['repositoryData'],'In\x20Progress'),await this[_0x36e88f(0x164)][_0x36e88f(0x19c)](_0x500948,this['prefix']),await this[_0x36e88f(0x177)](),await this[_0x36e88f(0x155)][_0x36e88f(0x184)](this[_0x36e88f(0x18d)],'Completed');}async[a122_0x2ec2d5(0x162)](_0x1c1ac8){const _0x4706d3=a122_0x2ec2d5;try{this[_0x4706d3(0x160)][_0x4706d3(0x143)](''+_0x1c1ac8),await this[_0x4706d3(0x160)][_0x4706d3(0x198)](),await this['updateLastCommit'](!![]),await this[_0x4706d3(0x155)][_0x4706d3(0x184)](this[_0x4706d3(0x18d)],_0x4706d3(0x15d));}catch(_0x18884a){this[_0x4706d3(0x147)][_0x4706d3(0x143)](_0x18884a);}}async[a122_0x2ec2d5(0x19c)](_0x5141b0){const _0x3a539b=a122_0x2ec2d5;try{this[_0x3a539b(0x1a2)]=_0x5141b0,this[_0x3a539b(0x149)]=typedi_1[_0x3a539b(0x161)][_0x3a539b(0x151)](providers_tokens_1[_0x3a539b(0x196)][_0x3a539b(0x149)]),this['repoService']=typedi_1[_0x3a539b(0x161)][_0x3a539b(0x151)](providers_tokens_1['Tokens'][_0x3a539b(0x16a)]),this[_0x3a539b(0x1a4)]=typedi_1['Container'][_0x3a539b(0x151)](providers_tokens_1[_0x3a539b(0x196)]['config']),await this[_0x3a539b(0x181)](),this['repository']=await this[_0x3a539b(0x1a3)]['getOne'](this[_0x3a539b(0x18d)][_0x3a539b(0x19d)]),this[_0x3a539b(0x197)]=await this[_0x3a539b(0x163)][_0x3a539b(0x185)][_0x3a539b(0x176)](this['repositoryData'][_0x3a539b(0x169)]),this[_0x3a539b(0x160)]=typedi_1[_0x3a539b(0x161)][_0x3a539b(0x151)](providers_tokens_1[_0x3a539b(0x196)][_0x3a539b(0x147)]),this[_0x3a539b(0x144)]=_0x3a539b(0x19e)+this[_0x3a539b(0x1a4)][_0x3a539b(0x167)]['toUpperCase']()+']\x20[Repository:\x20'+this[_0x3a539b(0x18d)][_0x3a539b(0x19d)]+']\x20[Branch:\x20'+this['repositoryData'][_0x3a539b(0x169)]+_0x3a539b(0x188)+FlosumCommitJob_1[_0x3a539b(0x19f)]+']';if(!this[_0x3a539b(0x18d)])throw new bad_request_error_1[(_0x3a539b(0x14e))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x3a539b(0x160)]['log'](this[_0x3a539b(0x144)]+'\x20Start\x20Flosum\x20commit\x20job.')[_0x3a539b(0x198)](),await this[_0x3a539b(0x141)]()['catch'](_0x2a7827=>this[_0x3a539b(0x162)](_0x2a7827));}catch(_0x182a58){this[_0x3a539b(0x1a2)]=undefined,this[_0x3a539b(0x147)][_0x3a539b(0x143)](_0x182a58);throw _0x182a58;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a122_0x2ec2d5(0x13f)])({'transient':!![]}),__metadata(a122_0x2ec2d5(0x159),[salesforce_service_1['SalesforceService'],commit_components_job_1[a122_0x2ec2d5(0x14c)],salesforce_sync_service_1[a122_0x2ec2d5(0x178)]])],FlosumCommitJob),exports[a122_0x2ec2d5(0x157)]=FlosumCommitJob;