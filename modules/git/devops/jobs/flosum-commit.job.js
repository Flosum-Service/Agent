const a107_0x2adde3=a107_0x1a82;(function(_0x616c43,_0x23d579){const _0x25de52=a107_0x1a82,_0x2d2fb1=_0x616c43();while(!![]){try{const _0x1a8e99=-parseInt(_0x25de52(0x182))/0x1*(-parseInt(_0x25de52(0x1bb))/0x2)+-parseInt(_0x25de52(0x1d0))/0x3*(-parseInt(_0x25de52(0x1b2))/0x4)+-parseInt(_0x25de52(0x199))/0x5*(parseInt(_0x25de52(0x1ca))/0x6)+-parseInt(_0x25de52(0x1c5))/0x7*(parseInt(_0x25de52(0x184))/0x8)+-parseInt(_0x25de52(0x19b))/0x9*(parseInt(_0x25de52(0x1b3))/0xa)+parseInt(_0x25de52(0x1de))/0xb+-parseInt(_0x25de52(0x1a7))/0xc;if(_0x1a8e99===_0x23d579)break;else _0x2d2fb1['push'](_0x2d2fb1['shift']());}catch(_0x5605e3){_0x2d2fb1['push'](_0x2d2fb1['shift']());}}}(a107_0x23b3,0x8594e));const a107_0x587426=(function(){let _0xd5d7ce=!![];return function(_0x2ca2d0,_0x3464c7){const _0x9c87c1=_0xd5d7ce?function(){const _0x185b0e=a107_0x1a82;if(_0x3464c7){const _0x1c08f8=_0x3464c7[_0x185b0e(0x1b7)](_0x2ca2d0,arguments);return _0x3464c7=null,_0x1c08f8;}}:function(){};return _0xd5d7ce=![],_0x9c87c1;};}()),a107_0x31c466=a107_0x587426(this,function(){const _0x188dbd=a107_0x1a82;return a107_0x31c466['toString']()[_0x188dbd(0x1ae)](_0x188dbd(0x1dd))['toString']()[_0x188dbd(0x18b)](a107_0x31c466)[_0x188dbd(0x1ae)]('(((.+)+)+)+$');});a107_0x31c466();'use strict';function a107_0x23b3(){const _0x5b6de0=['log','repoService','isConvertToSfdx','SalesforceService','config','catch','../../salesforce/services/salesforce-sync.service','run','map',']\x20[','../../salesforce/services/salesforce-retriever.service','1KpsFhC','SalesforceRetrieverService','376cJXgkg','exec','send','updateRemoteState','name','shortid','salesforceSync','constructor','commitData','defineProperty','fetchRepositoryData','split','typedi','Tokens','__importDefault','setStatus','../../providers/providers.tokens','sfLogger','gitUrl','Container','components','623135DhoKen','object','90XHivFA','repository','branchName','[FLOSUM\x20->\x20GIT]\x20[','then','Error','updateLastCommit','recordTypeName','handleCommitJobError','gitProvider','metadata','branches','8018064byMeoo',']\x20[Repository:\x20','gitApiService','parse','getCommitDto','commitJob','retrieveAttachment','search','../../../../constants/errors','repositoryData','deleteAttachmentId','95964njNZYM','563610rvoouf','commitAttachmentId','prefix','\x20Update\x20remote\x20state.','apply','CommitComponentsDto','Logger','getRepositoryRecord','1900798KCPxpi','repositoryName','function','CommitComponentsJob','convertToSFDX','length','decorate','FlosumCommitJob','patchObject','../../../../core','55069jFgyWT','getComponentsToDelete','sha','getOwnPropertyDescriptor','syncRepositoryId','18bVscDy','salesforceService','provider','syncBranchId','branch','__esModule','84dodXyx','ERR_INVALID_SYNC_RECORD_ID','repo','error','all','getOne','user','logger','getComponentsToWrite','deleteAttachment',']\x20[Branch:\x20','Completed','get','(((.+)+)+)+$','9904565UtKYQn','message','default','FLOSUM_ATTACHMENT','getBranchRecord'];a107_0x23b3=function(){return _0x5b6de0;};return a107_0x23b3();}function a107_0x1a82(_0x3f028b,_0x1d6f22){const _0x4fc297=a107_0x23b3();return a107_0x1a82=function(_0x31c466,_0x587426){_0x31c466=_0x31c466-0x17a;let _0x23b3f8=_0x4fc297[_0x31c466];return _0x23b3f8;},a107_0x1a82(_0x3f028b,_0x1d6f22);}var __decorate=this&&this['__decorate']||function(_0x1864ee,_0x47b9cd,_0x17aabd,_0x3f3901){const _0x2b8563=a107_0x1a82;var _0x1e1a9f=arguments[_0x2b8563(0x1c0)],_0x170878=_0x1e1a9f<0x3?_0x47b9cd:_0x3f3901===null?_0x3f3901=Object[_0x2b8563(0x1c8)](_0x47b9cd,_0x17aabd):_0x3f3901,_0x2dac55;if(typeof Reflect===_0x2b8563(0x19a)&&typeof Reflect['decorate']===_0x2b8563(0x1bd))_0x170878=Reflect[_0x2b8563(0x1c1)](_0x1864ee,_0x47b9cd,_0x17aabd,_0x3f3901);else{for(var _0x54eff7=_0x1864ee[_0x2b8563(0x1c0)]-0x1;_0x54eff7>=0x0;_0x54eff7--)if(_0x2dac55=_0x1864ee[_0x54eff7])_0x170878=(_0x1e1a9f<0x3?_0x2dac55(_0x170878):_0x1e1a9f>0x3?_0x2dac55(_0x47b9cd,_0x17aabd,_0x170878):_0x2dac55(_0x47b9cd,_0x17aabd))||_0x170878;}return _0x1e1a9f>0x3&&_0x170878&&Object[_0x2b8563(0x18d)](_0x47b9cd,_0x17aabd,_0x170878),_0x170878;},__metadata=this&&this['__metadata']||function(_0x41fbee,_0x2f6c03){const _0x167cdb=a107_0x1a82;if(typeof Reflect===_0x167cdb(0x19a)&&typeof Reflect[_0x167cdb(0x1a5)]==='function')return Reflect['metadata'](_0x41fbee,_0x2f6c03);},__importDefault=this&&this[a107_0x2adde3(0x192)]||function(_0x760241){const _0x1fced8=a107_0x2adde3;return _0x760241&&_0x760241[_0x1fced8(0x1cf)]?_0x760241:{'default':_0x760241};},FlosumCommitJob_1;Object[a107_0x2adde3(0x18d)](exports,a107_0x2adde3(0x1cf),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a107_0x2adde3(0x1c4)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a107_0x2adde3(0x190)),errors_1=require(a107_0x2adde3(0x1af)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a107_0x2adde3(0x181)),salesforce_sync_service_1=require(a107_0x2adde3(0x17d)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require('./commit-components.job'),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a107_0x2adde3(0x189))),providers_tokens_1=require(a107_0x2adde3(0x194));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x3e53cc,_0x44319a,_0x2b6f87){const _0x45fa23=a107_0x2adde3;this[_0x45fa23(0x1cb)]=_0x3e53cc,this['commitJob']=_0x44319a,this[_0x45fa23(0x18a)]=_0x2b6f87,this[_0x45fa23(0x1d7)]=new core_1[(_0x45fa23(0x1b9))](FlosumCommitJob_1['name']);}async[a107_0x2adde3(0x18e)](){const _0x3d6aed=a107_0x2adde3;try{if(this['commitData'][_0x3d6aed(0x1c9)])this[_0x3d6aed(0x1b0)]=await this['salesforceSync'][_0x3d6aed(0x1ba)](this[_0x3d6aed(0x18c)][_0x3d6aed(0x1c9)]);else this['commitData']['syncBranchId']&&(this[_0x3d6aed(0x1b0)]=await this[_0x3d6aed(0x18a)][_0x3d6aed(0x1e2)](this['commitData'][_0x3d6aed(0x1cd)]));}catch(_0x53df14){throw new bad_request_error_1['BadRequestError'](errors_1[_0x3d6aed(0x1d1)]);}}async[a107_0x2adde3(0x1d8)](){const _0x28cf68=a107_0x2adde3;if(!this['commitData'][_0x28cf68(0x1b4)])return[];await this[_0x28cf68(0x1cb)]['patchObject'](constants_1[_0x28cf68(0x1e1)],this[_0x28cf68(0x18c)]['commitAttachmentId'],{'Name':(0x0,shortid_1[_0x28cf68(0x1e0)])()});const _0x4206c9=await this['salesforceService'][_0x28cf68(0x1ad)](this['commitData']['commitAttachmentId'])[_0x28cf68(0x19f)](_0x20634f=>_0x20634f[_0x28cf68(0x18f)]('\x20')[_0x28cf68(0x17f)](_0x2c4974=>_0x2c4974['trim']()));await this[_0x28cf68(0x1cb)][_0x28cf68(0x1d9)](this[_0x28cf68(0x18c)]['commitAttachmentId']);const _0x7252b0=new salesforce_retriever_service_1[(_0x28cf68(0x183))](this[_0x28cf68(0x1cb)]);return await _0x7252b0[_0x28cf68(0x17e)](_0x4206c9);}async[a107_0x2adde3(0x1c6)](){const _0x84bcc2=a107_0x2adde3;if(!this[_0x84bcc2(0x18c)][_0x84bcc2(0x1b1)])return[];await this[_0x84bcc2(0x1cb)][_0x84bcc2(0x1c3)](constants_1['FLOSUM_ATTACHMENT'],this[_0x84bcc2(0x18c)][_0x84bcc2(0x1b1)],{'Name':(0x0,shortid_1['default'])()});const _0x9c53af=await this['salesforceService'][_0x84bcc2(0x1ad)](this[_0x84bcc2(0x18c)][_0x84bcc2(0x1b1)]),_0x15a86a=JSON[_0x84bcc2(0x1aa)](_0x9c53af);return await this[_0x84bcc2(0x1cb)][_0x84bcc2(0x1d9)](this[_0x84bcc2(0x18c)]['deleteAttachmentId']),_0x15a86a;}async[a107_0x2adde3(0x1ab)](){const _0x4d96a3=a107_0x2adde3,_0x5333a2=new commit_components_dto_1[(_0x4d96a3(0x1b8))](),[_0x121282,_0x3f4b5c]=await Promise[_0x4d96a3(0x1d4)]([this[_0x4d96a3(0x1d8)](),this[_0x4d96a3(0x1c6)]()]);return _0x5333a2['message']=this[_0x4d96a3(0x18c)][_0x4d96a3(0x1df)],_0x5333a2['user']=this['commitData'][_0x4d96a3(0x1d6)],_0x5333a2[_0x4d96a3(0x198)]={'writed':_0x121282,'deleted':_0x3f4b5c},_0x5333a2[_0x4d96a3(0x1bf)]=this[_0x4d96a3(0x17b)][_0x4d96a3(0x1e5)],_0x5333a2[_0x4d96a3(0x1d2)]=this['repository'],_0x5333a2['branch']=this[_0x4d96a3(0x1ce)],_0x5333a2[_0x4d96a3(0x1cc)]=this[_0x4d96a3(0x17b)][_0x4d96a3(0x1a4)],_0x5333a2['recordType']=this[_0x4d96a3(0x1b0)][_0x4d96a3(0x1a2)],_0x5333a2;}async[a107_0x2adde3(0x1a1)](_0x52e708=![]){const _0x2df672=a107_0x2adde3;if(_0x52e708)await this['salesforceSync'][_0x2df672(0x187)](this[_0x2df672(0x1b0)],{});else{const _0x2d10e8=await this['repository'][_0x2df672(0x1a6)][_0x2df672(0x1d5)](this[_0x2df672(0x1ce)][_0x2df672(0x188)]);this[_0x2df672(0x195)][_0x2df672(0x1e3)](this['prefix']+_0x2df672(0x1b6));const _0x953ebe={[this[_0x2df672(0x19c)][_0x2df672(0x196)]]:{'lastCommit':_0x2d10e8[_0x2df672(0x1c7)]}};await this[_0x2df672(0x18a)]['updateRemoteState'](this['repositoryData'],_0x953ebe);}}async[a107_0x2adde3(0x185)](){const _0x5c574b=a107_0x2adde3,_0x201bf7=await this[_0x5c574b(0x1ab)]();await this['salesforceSync'][_0x5c574b(0x193)](this['repositoryData'],'In\x20Progress'),await this[_0x5c574b(0x1ac)]['run'](_0x201bf7,this[_0x5c574b(0x1b5)]),await this[_0x5c574b(0x1a1)](),await this[_0x5c574b(0x18a)]['setStatus'](this['repositoryData'],_0x5c574b(0x1db));}async['handleCommitJobError'](_0xd23de2){const _0x4ba070=a107_0x2adde3;try{this[_0x4ba070(0x195)][_0x4ba070(0x1d3)](''+_0xd23de2),await this['sfLogger'][_0x4ba070(0x186)](),await this[_0x4ba070(0x1a1)](!![]),await this[_0x4ba070(0x18a)][_0x4ba070(0x193)](this[_0x4ba070(0x1b0)],_0x4ba070(0x1a0));}catch(_0x2250d2){this[_0x4ba070(0x1d7)][_0x4ba070(0x1d3)](_0x2250d2);}}async[a107_0x2adde3(0x17e)](_0x57bd1d){const _0x20fc18=a107_0x2adde3;try{this['commitData']=_0x57bd1d,this[_0x20fc18(0x1a9)]=typedi_1['Container'][_0x20fc18(0x1dc)](providers_tokens_1[_0x20fc18(0x191)][_0x20fc18(0x1a9)]),this['repoService']=typedi_1[_0x20fc18(0x197)][_0x20fc18(0x1dc)](providers_tokens_1['Tokens']['gitRepoService']),this[_0x20fc18(0x17b)]=typedi_1[_0x20fc18(0x197)]['get'](providers_tokens_1['Tokens'][_0x20fc18(0x17b)]),await this[_0x20fc18(0x18e)](),this[_0x20fc18(0x19c)]=await this[_0x20fc18(0x1e4)][_0x20fc18(0x1d5)](this[_0x20fc18(0x1b0)][_0x20fc18(0x1bc)]),this['branch']=await this[_0x20fc18(0x19c)][_0x20fc18(0x1a6)][_0x20fc18(0x1d5)](this[_0x20fc18(0x1b0)][_0x20fc18(0x19d)]),this['sfLogger']=typedi_1[_0x20fc18(0x197)][_0x20fc18(0x1dc)](providers_tokens_1[_0x20fc18(0x191)]['logger']),this[_0x20fc18(0x1b5)]=_0x20fc18(0x19e)+this[_0x20fc18(0x17b)][_0x20fc18(0x1a4)]['toUpperCase']()+_0x20fc18(0x1a8)+this['repositoryData'][_0x20fc18(0x1bc)]+_0x20fc18(0x1da)+this[_0x20fc18(0x1b0)][_0x20fc18(0x19d)]+_0x20fc18(0x180)+FlosumCommitJob_1[_0x20fc18(0x188)]+']';if(!this[_0x20fc18(0x1b0)])throw new bad_request_error_1['BadRequestError'](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this['sfLogger']['log'](this[_0x20fc18(0x1b5)]+'\x20Start\x20Flosum\x20commit\x20job.')['send'](),await this[_0x20fc18(0x185)]()[_0x20fc18(0x17c)](_0x2af86b=>this[_0x20fc18(0x1a3)](_0x2af86b));}catch(_0xe119c8){this[_0x20fc18(0x18c)]=undefined,this['logger'][_0x20fc18(0x1d3)](_0xe119c8);throw _0xe119c8;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a107_0x2adde3(0x17a)],commit_components_job_1[a107_0x2adde3(0x1be)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a107_0x2adde3(0x1c2)]=FlosumCommitJob;