const a105_0x39495c=a105_0x4bce;function a105_0x191b(){const _0x4de6e3=['commitData','toString','../../../../constants','shortid','gitRepoService','branchName','updateLastCommit','8830843SnPBSP',']\x20[','CommitComponentsDto',']\x20[Repository:\x20','defineProperty','sfLogger','commitJob','handleCommitJobError','commitAttachmentId','log','repository','deleteAttachmentId','getComponentsToDelete','catch','[FLOSUM\x20->\x20GIT]\x20[','then','components','1ZVaWgg','216873pZhJki','getComponentsToWrite','updateRemoteState','gitUrl','In\x20Progress','gitProvider','../../../../core/errors/bad-request.error','ERR_UNKNOWN_SYNC_RECORD_ID','Logger','isConvertToSfdx','Error','send','getOwnPropertyDescriptor','Container','all','convertToSFDX','message','getOne','get','repositoryName','decorate','BadRequestError','error','setStatus','../../../../core','provider','typedi','user','FlosumCommitJob','__esModule','apply','name','9760608RtECrW','function','repo','Service','design:paramtypes','fetchRepositoryData','ERR_INVALID_SYNC_RECORD_ID','patchObject','search','./commit-components.job','../../salesforce/services/salesforce-retriever.service','repoService','trim','split','6uMaVGd','default','70632yFdukl','constructor','getCommitDto','\x20Update\x20remote\x20state.','279afUQzh','CommitComponentsJob','../dto/commit-components.dto','Tokens','27394378KFLCnh','../../../../constants/errors','salesforceSync','object','branch','config','exec','getRepositoryRecord','1501135gfWDbo','syncRepositoryId','getBranchRecord','run','logger','metadata','FLOSUM_ATTACHMENT','(((.+)+)+)+$',']\x20[Branch:\x20','retrieveAttachment','430xzzyQB','SalesforceRetrieverService','salesforceService','__importDefault','prefix','1019896YaZBsb','repositoryData'];a105_0x191b=function(){return _0x4de6e3;};return a105_0x191b();}(function(_0x2cf2cb,_0x2eca86){const _0xcb7e72=a105_0x4bce,_0x5b7014=_0x2cf2cb();while(!![]){try{const _0x5d310b=parseInt(_0xcb7e72(0x149))/0x1*(parseInt(_0xcb7e72(0x199))/0x2)+parseInt(_0xcb7e72(0x17e))/0x3*(parseInt(_0xcb7e72(0x17a))/0x4)+-parseInt(_0xcb7e72(0x18a))/0x5+parseInt(_0xcb7e72(0x178))/0x6*(-parseInt(_0xcb7e72(0x1a2))/0x7)+-parseInt(_0xcb7e72(0x16a))/0x8+parseInt(_0xcb7e72(0x14a))/0x9*(-parseInt(_0xcb7e72(0x194))/0xa)+parseInt(_0xcb7e72(0x182))/0xb;if(_0x5d310b===_0x2eca86)break;else _0x5b7014['push'](_0x5b7014['shift']());}catch(_0x45fa3a){_0x5b7014['push'](_0x5b7014['shift']());}}}(a105_0x191b,0xc94c5));const a105_0x3f32d6=(function(){let _0x110f1c=!![];return function(_0x2c1e36,_0x58c9db){const _0x32aadf=_0x110f1c?function(){const _0x544c8b=a105_0x4bce;if(_0x58c9db){const _0x818daf=_0x58c9db[_0x544c8b(0x168)](_0x2c1e36,arguments);return _0x58c9db=null,_0x818daf;}}:function(){};return _0x110f1c=![],_0x32aadf;};}()),a105_0x34efad=a105_0x3f32d6(this,function(){const _0xdf2025=a105_0x4bce;return a105_0x34efad[_0xdf2025(0x19c)]()[_0xdf2025(0x172)](_0xdf2025(0x191))[_0xdf2025(0x19c)]()[_0xdf2025(0x17b)](a105_0x34efad)[_0xdf2025(0x172)](_0xdf2025(0x191));});a105_0x34efad();'use strict';function a105_0x4bce(_0x3c6bc4,_0x545d3d){const _0x3e8cab=a105_0x191b();return a105_0x4bce=function(_0x34efad,_0x3f32d6){_0x34efad=_0x34efad-0x146;let _0x191b34=_0x3e8cab[_0x34efad];return _0x191b34;},a105_0x4bce(_0x3c6bc4,_0x545d3d);}var __decorate=this&&this['__decorate']||function(_0x4b7dca,_0x241a1b,_0x635da6,_0xd9c1e0){const _0x45bdbb=a105_0x4bce;var _0x58b0c8=arguments['length'],_0x517895=_0x58b0c8<0x3?_0x241a1b:_0xd9c1e0===null?_0xd9c1e0=Object[_0x45bdbb(0x156)](_0x241a1b,_0x635da6):_0xd9c1e0,_0x409739;if(typeof Reflect===_0x45bdbb(0x185)&&typeof Reflect[_0x45bdbb(0x15e)]===_0x45bdbb(0x16b))_0x517895=Reflect[_0x45bdbb(0x15e)](_0x4b7dca,_0x241a1b,_0x635da6,_0xd9c1e0);else{for(var _0xf89183=_0x4b7dca['length']-0x1;_0xf89183>=0x0;_0xf89183--)if(_0x409739=_0x4b7dca[_0xf89183])_0x517895=(_0x58b0c8<0x3?_0x409739(_0x517895):_0x58b0c8>0x3?_0x409739(_0x241a1b,_0x635da6,_0x517895):_0x409739(_0x241a1b,_0x635da6))||_0x517895;}return _0x58b0c8>0x3&&_0x517895&&Object['defineProperty'](_0x241a1b,_0x635da6,_0x517895),_0x517895;},__metadata=this&&this['__metadata']||function(_0x3c8534,_0x44cd94){const _0x278e33=a105_0x4bce;if(typeof Reflect===_0x278e33(0x185)&&typeof Reflect[_0x278e33(0x18f)]===_0x278e33(0x16b))return Reflect['metadata'](_0x3c8534,_0x44cd94);},__importDefault=this&&this[a105_0x39495c(0x197)]||function(_0x512aea){const _0x1bf1f4=a105_0x39495c;return _0x512aea&&_0x512aea[_0x1bf1f4(0x167)]?_0x512aea:{'default':_0x512aea};},FlosumCommitJob_1;Object[a105_0x39495c(0x1a6)](exports,a105_0x39495c(0x167),{'value':!![]}),exports[a105_0x39495c(0x166)]=void 0x0;const core_1=require(a105_0x39495c(0x162)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a105_0x39495c(0x164)),errors_1=require(a105_0x39495c(0x183)),bad_request_error_1=require(a105_0x39495c(0x150)),salesforce_retriever_service_1=require(a105_0x39495c(0x174)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a105_0x39495c(0x180)),commit_components_job_1=require(a105_0x39495c(0x173)),constants_1=require(a105_0x39495c(0x19d)),shortid_1=__importDefault(require(a105_0x39495c(0x19e))),providers_tokens_1=require('../../providers/providers.tokens');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0xca6371,_0x5b6825,_0x5c705b){const _0x561506=a105_0x39495c;this[_0x561506(0x196)]=_0xca6371,this[_0x561506(0x1a8)]=_0x5b6825,this[_0x561506(0x184)]=_0x5c705b,this[_0x561506(0x18e)]=new core_1[(_0x561506(0x152))](FlosumCommitJob_1[_0x561506(0x169)]);}async['fetchRepositoryData'](){const _0x5deae3=a105_0x39495c;try{if(this[_0x5deae3(0x19b)][_0x5deae3(0x18b)])this[_0x5deae3(0x19a)]=await this[_0x5deae3(0x184)][_0x5deae3(0x189)](this[_0x5deae3(0x19b)][_0x5deae3(0x18b)]);else this[_0x5deae3(0x19b)]['syncBranchId']&&(this[_0x5deae3(0x19a)]=await this[_0x5deae3(0x184)][_0x5deae3(0x18c)](this[_0x5deae3(0x19b)]['syncBranchId']));}catch(_0x40b96e){throw new bad_request_error_1[(_0x5deae3(0x15f))](errors_1[_0x5deae3(0x170)]);}}async[a105_0x39495c(0x14b)](){const _0x16ca11=a105_0x39495c;if(!this[_0x16ca11(0x19b)]['commitAttachmentId'])return[];await this['salesforceService'][_0x16ca11(0x171)](constants_1[_0x16ca11(0x190)],this[_0x16ca11(0x19b)][_0x16ca11(0x1aa)],{'Name':(0x0,shortid_1[_0x16ca11(0x179)])()});const _0x2c0d57=await this[_0x16ca11(0x196)][_0x16ca11(0x193)](this['commitData']['commitAttachmentId'])[_0x16ca11(0x147)](_0x4a2c25=>_0x4a2c25[_0x16ca11(0x177)]('\x20')['map'](_0x196c35=>_0x196c35[_0x16ca11(0x176)]()));await this[_0x16ca11(0x196)]['deleteAttachment'](this['commitData']['commitAttachmentId']);const _0x4e6d4b=new salesforce_retriever_service_1[(_0x16ca11(0x195))](this['salesforceService']);return await _0x4e6d4b[_0x16ca11(0x18d)](_0x2c0d57);}async['getComponentsToDelete'](){const _0x169b38=a105_0x39495c;if(!this[_0x169b38(0x19b)][_0x169b38(0x1ad)])return[];await this[_0x169b38(0x196)]['patchObject'](constants_1[_0x169b38(0x190)],this[_0x169b38(0x19b)][_0x169b38(0x1ad)],{'Name':(0x0,shortid_1['default'])()});const _0x91fcf=await this['salesforceService'][_0x169b38(0x193)](this['commitData'][_0x169b38(0x1ad)]);return await this[_0x169b38(0x196)]['deleteAttachment'](this['commitData'][_0x169b38(0x1ad)]),_0x91fcf;}async[a105_0x39495c(0x17c)](){const _0x579237=a105_0x39495c,_0x4c0635=new commit_components_dto_1[(_0x579237(0x1a4))](),[_0x3937e1,_0x233e59]=await Promise[_0x579237(0x158)]([this[_0x579237(0x14b)](),this[_0x579237(0x1ae)]()]);return _0x4c0635[_0x579237(0x15a)]=this[_0x579237(0x19b)][_0x579237(0x15a)],_0x4c0635[_0x579237(0x165)]=this[_0x579237(0x19b)][_0x579237(0x165)],_0x4c0635[_0x579237(0x148)]={'writed':_0x3937e1,'deleted':_0x233e59},_0x4c0635[_0x579237(0x159)]=this[_0x579237(0x187)][_0x579237(0x153)],_0x4c0635[_0x579237(0x16c)]=this['repository'],_0x4c0635[_0x579237(0x186)]=this[_0x579237(0x186)],_0x4c0635[_0x579237(0x163)]=this['config'][_0x579237(0x14f)],_0x4c0635;}async['updateLastCommit'](_0x21ea01=![]){const _0x37ef26=a105_0x39495c;if(_0x21ea01)await this[_0x37ef26(0x184)][_0x37ef26(0x14c)](this[_0x37ef26(0x19a)],{});else{const _0x2c7ebc=await this[_0x37ef26(0x1ac)]['branches'][_0x37ef26(0x15b)](this['branch'][_0x37ef26(0x169)]);this[_0x37ef26(0x1a7)][_0x37ef26(0x1ab)](this[_0x37ef26(0x198)]+_0x37ef26(0x17d));const _0x4d96d9={[this['repository'][_0x37ef26(0x14d)]]:{'lastCommit':_0x2c7ebc['sha']}};await this['salesforceSync']['updateRemoteState'](this[_0x37ef26(0x19a)],_0x4d96d9);}}async[a105_0x39495c(0x188)](){const _0xe955c3=a105_0x39495c,_0x59dc4c=await this[_0xe955c3(0x17c)]();await this[_0xe955c3(0x184)][_0xe955c3(0x161)](this['repositoryData'],_0xe955c3(0x14e)),await this[_0xe955c3(0x1a8)]['run'](_0x59dc4c,this[_0xe955c3(0x198)]),await this['updateLastCommit'](),await this[_0xe955c3(0x184)]['setStatus'](this['repositoryData'],'Completed');}async[a105_0x39495c(0x1a9)](_0x429d2a){const _0x3754bf=a105_0x39495c;try{this[_0x3754bf(0x1a7)][_0x3754bf(0x160)](''+_0x429d2a),await this[_0x3754bf(0x1a7)][_0x3754bf(0x155)](),await this[_0x3754bf(0x1a1)](!![]),await this['salesforceSync'][_0x3754bf(0x161)](this[_0x3754bf(0x19a)],_0x3754bf(0x154));}catch(_0x1748d9){this[_0x3754bf(0x18e)]['error'](_0x1748d9);}}async[a105_0x39495c(0x18d)](_0x2ab522){const _0xe152fe=a105_0x39495c;try{this[_0xe152fe(0x19b)]=_0x2ab522,this['gitApiService']=typedi_1[_0xe152fe(0x157)][_0xe152fe(0x15c)](providers_tokens_1[_0xe152fe(0x181)]['gitApiService']),this[_0xe152fe(0x175)]=typedi_1[_0xe152fe(0x157)]['get'](providers_tokens_1[_0xe152fe(0x181)][_0xe152fe(0x19f)]),this['config']=typedi_1[_0xe152fe(0x157)]['get'](providers_tokens_1[_0xe152fe(0x181)][_0xe152fe(0x187)]),await this[_0xe152fe(0x16f)](),this[_0xe152fe(0x1ac)]=await this[_0xe152fe(0x175)][_0xe152fe(0x15b)](this[_0xe152fe(0x19a)]['repositoryName']),this[_0xe152fe(0x186)]=await this[_0xe152fe(0x1ac)]['branches'][_0xe152fe(0x15b)](this[_0xe152fe(0x19a)]['branchName']),this[_0xe152fe(0x1a7)]=typedi_1['Container'][_0xe152fe(0x15c)](providers_tokens_1[_0xe152fe(0x181)][_0xe152fe(0x18e)]),this[_0xe152fe(0x198)]=_0xe152fe(0x146)+this[_0xe152fe(0x187)][_0xe152fe(0x14f)]['toUpperCase']()+_0xe152fe(0x1a5)+this[_0xe152fe(0x19a)][_0xe152fe(0x15d)]+_0xe152fe(0x192)+this['repositoryData'][_0xe152fe(0x1a0)]+_0xe152fe(0x1a3)+FlosumCommitJob_1[_0xe152fe(0x169)]+']';if(!this[_0xe152fe(0x19a)])throw new bad_request_error_1[(_0xe152fe(0x15f))](errors_1[_0xe152fe(0x151)]);await this[_0xe152fe(0x1a7)][_0xe152fe(0x1ab)](this[_0xe152fe(0x198)]+'\x20Start\x20Flosum\x20commit\x20job.')['send'](),await this[_0xe152fe(0x188)]()[_0xe152fe(0x1af)](_0x9b38cb=>this[_0xe152fe(0x1a9)](_0x9b38cb));}catch(_0x257380){this[_0xe152fe(0x19b)]=undefined,this[_0xe152fe(0x18e)][_0xe152fe(0x160)](_0x257380);throw _0x257380;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x39495c(0x16d)])({'transient':!![]}),__metadata(a105_0x39495c(0x16e),[salesforce_service_1['SalesforceService'],commit_components_job_1[a105_0x39495c(0x17f)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a105_0x39495c(0x166)]=FlosumCommitJob;