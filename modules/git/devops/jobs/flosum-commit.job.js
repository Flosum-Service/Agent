const a124_0x330038=a124_0x3619;function a124_0xc861(){const _0x4bd85a=['default','retrieveAttachment','errorNotification','function','getComponentsToDelete','decorate','setStatus','get','../../../../constants','salesforceSync','email','defineProperty','../dto/commit-components.dto','10644543lxaWYa','repoService','branch','../../providers/providers.tokens','deleteAttachmentId','user','info','syncBranchId','fetchRepositoryData','salesforceService','ERR_INVALID_SYNC_RECORD_ID','name','Container',']\x20[Repository:\x20','commitData','sfLogger','2762085XDRPyj','send','repositoryData',']\x20[','repository','__metadata','design:paramtypes','logger','handleCommitJobError','../../salesforce/services/salesforce-sync.service','trim','all','config','__decorate','Completed','getComponentsToWrite','\x20Update\x20remote\x20state.','recordTypeName','map',']\x20[Branch:\x20','__importDefault','typedi','recordType','1703566rmsZrc','gitApiService','231224hCUkpV','7719276VLleXa','Tokens','patchObject','length','Email\x20notifications\x20are\x20disabled.','SalesforceService','exec','../../notifications/commit-to-git-error.notification','run','In\x20Progress','[FLOSUM\x20->\x20GIT]\x20[','then','CommitToGitCompletedNotification','syncRepositoryId','4499889RwvBWC','Service','components','updateLastCommit','toUpperCase','updateRemoteState','prefix','getOne','CommitComponentsJob','commitJob','getRepositoryRecord','branchName','branches','../../../../constants/errors','gitProvider','FLOSUM_ATTACHMENT','shortid','Error','ERR_UNKNOWN_SYNC_RECORD_ID','Logger','../../../../core','error','SalesforceRetrieverService','repo','./commit-components.job','execute','split','parse','BadRequestError','toString','CommitComponentsDto','../../salesforce/services/salesforce.service','getCommitDto','deleteAttachment','../../salesforce/services/salesforce-retriever.service','completeNotification','search','CommitToGitErrorNotification','FlosumCommitJob','commitAttachmentId','SalesforceSyncService','__esModule','getOwnPropertyDescriptor','359812ppxjFr','sha'];a124_0xc861=function(){return _0x4bd85a;};return a124_0xc861();}(function(_0x22ab8c,_0x3fadc4){const _0x12236c=a124_0x3619,_0x25957a=_0x22ab8c();while(!![]){try{const _0x407881=-parseInt(_0x12236c(0xa1))/0x1+-parseInt(_0x12236c(0x9f))/0x2+parseInt(_0x12236c(0xb0))/0x3+parseInt(_0x12236c(0xdb))/0x4+parseInt(_0x12236c(0xfa))/0x5+parseInt(_0x12236c(0xa2))/0x6+-parseInt(_0x12236c(0xea))/0x7;if(_0x407881===_0x3fadc4)break;else _0x25957a['push'](_0x25957a['shift']());}catch(_0x51f111){_0x25957a['push'](_0x25957a['shift']());}}}(a124_0xc861,0xc9787));const a124_0x1c30be=(function(){let _0xd84bf4=!![];return function(_0x469d42,_0x43314e){const _0x208b61=_0xd84bf4?function(){if(_0x43314e){const _0x593d8c=_0x43314e['apply'](_0x469d42,arguments);return _0x43314e=null,_0x593d8c;}}:function(){};return _0xd84bf4=![],_0x208b61;};}()),a124_0x207db0=a124_0x1c30be(this,function(){const _0x32fec1=a124_0x3619;return a124_0x207db0[_0x32fec1(0xcd)]()[_0x32fec1(0xd4)]('(((.+)+)+)+$')[_0x32fec1(0xcd)]()['constructor'](a124_0x207db0)['search']('(((.+)+)+)+$');});a124_0x207db0();function a124_0x3619(_0x236de4,_0x2c8532){const _0x3dbcd6=a124_0xc861();return a124_0x3619=function(_0x207db0,_0x1c30be){_0x207db0=_0x207db0-0x8a;let _0xc861be=_0x3dbcd6[_0x207db0];return _0xc861be;},a124_0x3619(_0x236de4,_0x2c8532);}'use strict';var __decorate=this&&this[a124_0x330038(0x95)]||function(_0x33b690,_0x34746d,_0x442002,_0x4fd6df){const _0x28ebc5=a124_0x330038;var _0x4d18a5=arguments[_0x28ebc5(0xa5)],_0x8b1820=_0x4d18a5<0x3?_0x34746d:_0x4fd6df===null?_0x4fd6df=Object[_0x28ebc5(0xda)](_0x34746d,_0x442002):_0x4fd6df,_0x1ed515;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x28ebc5(0xe0))_0x8b1820=Reflect[_0x28ebc5(0xe2)](_0x33b690,_0x34746d,_0x442002,_0x4fd6df);else{for(var _0x107037=_0x33b690['length']-0x1;_0x107037>=0x0;_0x107037--)if(_0x1ed515=_0x33b690[_0x107037])_0x8b1820=(_0x4d18a5<0x3?_0x1ed515(_0x8b1820):_0x4d18a5>0x3?_0x1ed515(_0x34746d,_0x442002,_0x8b1820):_0x1ed515(_0x34746d,_0x442002))||_0x8b1820;}return _0x4d18a5>0x3&&_0x8b1820&&Object[_0x28ebc5(0xe8)](_0x34746d,_0x442002,_0x8b1820),_0x8b1820;},__metadata=this&&this[a124_0x330038(0x8d)]||function(_0x402082,_0x190963){const _0x50773c=a124_0x330038;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x50773c(0xe0))return Reflect['metadata'](_0x402082,_0x190963);},__importDefault=this&&this[a124_0x330038(0x9c)]||function(_0x16425a){const _0x5c609e=a124_0x330038;return _0x16425a&&_0x16425a[_0x5c609e(0xd9)]?_0x16425a:{'default':_0x16425a};},FlosumCommitJob_1;Object[a124_0x330038(0xe8)](exports,a124_0x330038(0xd9),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a124_0x330038(0xc4)),salesforce_service_1=require(a124_0x330038(0xcf)),typedi_1=require(a124_0x330038(0x9d)),errors_1=require(a124_0x330038(0xbd)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a124_0x330038(0xd2)),salesforce_sync_service_1=require(a124_0x330038(0x91)),commit_components_dto_1=require(a124_0x330038(0xe9)),commit_components_job_1=require(a124_0x330038(0xc8)),constants_1=require(a124_0x330038(0xe5)),shortid_1=__importDefault(require(a124_0x330038(0xc0))),providers_tokens_1=require(a124_0x330038(0xed)),commit_to_git_completed_notification_1=require('../../notifications/commit-to-git-completed.notification'),commit_to_git_error_notification_1=require(a124_0x330038(0xa9));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0xd2942e,_0x5635e9,_0x5eff9b){const _0x28be41=a124_0x330038;this[_0x28be41(0xf3)]=_0xd2942e,this['commitJob']=_0x5635e9,this['salesforceSync']=_0x5eff9b,this[_0x28be41(0x8f)]=new core_1[(_0x28be41(0xc3))](FlosumCommitJob_1[_0x28be41(0xf5)]);}async['completeNotification'](_0x3d4292,_0x5d6b79,_0x48fb15,_0x2d7ddc){const _0x3f60f3=a124_0x330038;if(!this[_0x3f60f3(0xf8)]['isEmailNotificationsEnabled']){this[_0x3f60f3(0x8f)]['info'](_0x3f60f3(0xa6));return;}await new commit_to_git_completed_notification_1[(_0x3f60f3(0xae))]({'emails':_0x3d4292,'gitProvider':_0x5d6b79,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1[_0x3f60f3(0xae)][_0x3f60f3(0xf5)],'repositoryName':_0x48fb15,'branchName':_0x2d7ddc})[_0x3f60f3(0xc9)]();}async[a124_0x330038(0xdf)](_0x384eb1,_0x524cc3,_0xd4e682,_0x270ea2){const _0x49b484=a124_0x330038;if(!this[_0x49b484(0xf8)]['isEmailNotificationsEnabled']){this[_0x49b484(0x8f)][_0x49b484(0xf0)](_0x49b484(0xa6));return;}await new commit_to_git_error_notification_1[(_0x49b484(0xd5))]({'emails':_0x384eb1,'gitProvider':_0x524cc3,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0x49b484(0xd5)][_0x49b484(0xf5)],'repositoryName':_0xd4e682,'branchName':_0x270ea2})[_0x49b484(0xc9)]();}async[a124_0x330038(0xf2)](){const _0x508101=a124_0x330038;try{if(this[_0x508101(0xf8)][_0x508101(0xaf)])this[_0x508101(0x8a)]=await this[_0x508101(0xe6)][_0x508101(0xba)](this[_0x508101(0xf8)][_0x508101(0xaf)]);else this['commitData'][_0x508101(0xf1)]&&(this[_0x508101(0x8a)]=await this[_0x508101(0xe6)]['getBranchRecord'](this['commitData'][_0x508101(0xf1)]));}catch(_0x116019){throw new bad_request_error_1['BadRequestError'](errors_1[_0x508101(0xf4)]);}}async['getComponentsToWrite'](){const _0xae280c=a124_0x330038;if(!this[_0xae280c(0xf8)][_0xae280c(0xd7)])return[];await this[_0xae280c(0xf3)]['patchObject'](constants_1[_0xae280c(0xbf)],this[_0xae280c(0xf8)][_0xae280c(0xd7)],{'Name':(0x0,shortid_1[_0xae280c(0xdd)])()});const _0x5b1364=await this[_0xae280c(0xf3)][_0xae280c(0xde)](this['commitData']['commitAttachmentId'])[_0xae280c(0xad)](_0x180efa=>_0x180efa[_0xae280c(0xca)]('\x20')[_0xae280c(0x9a)](_0x5a1044=>_0x5a1044[_0xae280c(0x92)]()));await this[_0xae280c(0xf3)][_0xae280c(0xd1)](this['commitData'][_0xae280c(0xd7)]);const _0x4db3d7=new salesforce_retriever_service_1[(_0xae280c(0xc6))](this[_0xae280c(0xf3)]);return await _0x4db3d7[_0xae280c(0xaa)](_0x5b1364);}async['getComponentsToDelete'](){const _0x2cce71=a124_0x330038;if(!this[_0x2cce71(0xf8)][_0x2cce71(0xee)])return[];await this['salesforceService'][_0x2cce71(0xa4)](constants_1[_0x2cce71(0xbf)],this[_0x2cce71(0xf8)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0x2cce71(0xdd)])()});const _0x4faba7=await this[_0x2cce71(0xf3)]['retrieveAttachment'](this[_0x2cce71(0xf8)][_0x2cce71(0xee)]),_0x29c2af=JSON[_0x2cce71(0xcb)](_0x4faba7);return await this['salesforceService'][_0x2cce71(0xd1)](this[_0x2cce71(0xf8)]['deleteAttachmentId']),_0x29c2af;}async['getCommitDto'](){const _0x3b7388=a124_0x330038,_0x4b5463=new commit_components_dto_1[(_0x3b7388(0xce))](),[_0x33617e,_0x3b9d14]=await Promise[_0x3b7388(0x93)]([this[_0x3b7388(0x97)](),this[_0x3b7388(0xe1)]()]);return _0x4b5463['message']=this[_0x3b7388(0xf8)]['message'],_0x4b5463[_0x3b7388(0xef)]=this[_0x3b7388(0xf8)]['user'],_0x4b5463[_0x3b7388(0xb2)]={'writed':_0x33617e,'deleted':_0x3b9d14},_0x4b5463['convertToSFDX']=this[_0x3b7388(0x94)]['isConvertToSfdx'],_0x4b5463[_0x3b7388(0xc7)]=this['repository'],_0x4b5463['branch']=this[_0x3b7388(0xec)],_0x4b5463['provider']=this['config']['gitProvider'],_0x4b5463[_0x3b7388(0x9e)]=this['repositoryData'][_0x3b7388(0x99)],_0x4b5463;}async[a124_0x330038(0xb3)](_0x135477=![]){const _0x55d952=a124_0x330038;if(_0x135477)await this[_0x55d952(0xe6)][_0x55d952(0xb5)](this[_0x55d952(0x8a)],{});else{const _0x29bafe=await this[_0x55d952(0x8c)][_0x55d952(0xbc)]['getOne'](this[_0x55d952(0xec)][_0x55d952(0xf5)]);this[_0x55d952(0xf9)]['log'](this['prefix']+_0x55d952(0x98));const _0x46d41d={[this[_0x55d952(0x8c)]['gitUrl']]:{'lastCommit':_0x29bafe[_0x55d952(0xdc)]}};await this[_0x55d952(0xe6)]['updateRemoteState'](this[_0x55d952(0x8a)],_0x46d41d);}}async[a124_0x330038(0xa8)](){const _0x55926a=a124_0x330038,_0x47658e=await this[_0x55926a(0xd0)]();await this[_0x55926a(0xe6)]['setStatus'](this[_0x55926a(0x8a)],_0x55926a(0xab)),await this[_0x55926a(0xb9)]['run'](_0x47658e,this[_0x55926a(0xb6)]),await this[_0x55926a(0xb3)](),await this['salesforceSync'][_0x55926a(0xe3)](this[_0x55926a(0x8a)],_0x55926a(0x96));}async['handleCommitJobError'](_0x540d92){const _0x1733f5=a124_0x330038;try{this[_0x1733f5(0xf9)][_0x1733f5(0xc5)](''+_0x540d92),await this[_0x1733f5(0xf9)]['send'](),await this[_0x1733f5(0xb3)](!![]),await this[_0x1733f5(0xe6)][_0x1733f5(0xe3)](this[_0x1733f5(0x8a)],_0x1733f5(0xc1)),await this[_0x1733f5(0xd3)]([this[_0x1733f5(0xf8)]['user'][_0x1733f5(0xe7)]],this['config'][_0x1733f5(0xbe)],this[_0x1733f5(0x8c)]['name'],this['branch'][_0x1733f5(0xf5)]);}catch(_0x572522){this[_0x1733f5(0x8f)][_0x1733f5(0xc5)](_0x572522),await this[_0x1733f5(0xdf)]([this[_0x1733f5(0xf8)][_0x1733f5(0xef)]['email']],this[_0x1733f5(0x94)][_0x1733f5(0xbe)],this[_0x1733f5(0x8c)]['name'],this[_0x1733f5(0xec)][_0x1733f5(0xf5)]);}}async[a124_0x330038(0xaa)](_0x14139a){const _0x2f46c0=a124_0x330038;try{this['commitData']=_0x14139a,this[_0x2f46c0(0xa0)]=typedi_1['Container'][_0x2f46c0(0xe4)](providers_tokens_1[_0x2f46c0(0xa3)][_0x2f46c0(0xa0)]),this[_0x2f46c0(0xeb)]=typedi_1[_0x2f46c0(0xf6)]['get'](providers_tokens_1[_0x2f46c0(0xa3)]['gitRepoService']),this['config']=typedi_1['Container'][_0x2f46c0(0xe4)](providers_tokens_1['Tokens'][_0x2f46c0(0x94)]),await this[_0x2f46c0(0xf2)](),this[_0x2f46c0(0x8c)]=await this[_0x2f46c0(0xeb)][_0x2f46c0(0xb7)](this[_0x2f46c0(0x8a)]['repositoryName']),this['branch']=await this[_0x2f46c0(0x8c)][_0x2f46c0(0xbc)]['getOne'](this[_0x2f46c0(0x8a)][_0x2f46c0(0xbb)]),this[_0x2f46c0(0xf9)]=typedi_1[_0x2f46c0(0xf6)][_0x2f46c0(0xe4)](providers_tokens_1[_0x2f46c0(0xa3)][_0x2f46c0(0x8f)]),this['prefix']=_0x2f46c0(0xac)+this['config'][_0x2f46c0(0xbe)][_0x2f46c0(0xb4)]()+_0x2f46c0(0xf7)+this['repositoryData']['repositoryName']+_0x2f46c0(0x9b)+this[_0x2f46c0(0x8a)][_0x2f46c0(0xbb)]+_0x2f46c0(0x8b)+FlosumCommitJob_1[_0x2f46c0(0xf5)]+']';if(!this[_0x2f46c0(0x8a)])throw new bad_request_error_1[(_0x2f46c0(0xcc))](errors_1[_0x2f46c0(0xc2)]);await this['sfLogger']['log'](this[_0x2f46c0(0xb6)]+'\x20Start\x20Flosum\x20commit\x20job.')[_0x2f46c0(0xfb)](),await this[_0x2f46c0(0xa8)]()['catch'](_0x82701d=>this[_0x2f46c0(0x90)](_0x82701d)),await this[_0x2f46c0(0xd3)]([this[_0x2f46c0(0xf8)]['user'][_0x2f46c0(0xe7)]],this['config'][_0x2f46c0(0xbe)],this[_0x2f46c0(0x8c)]['name'],this[_0x2f46c0(0xec)][_0x2f46c0(0xf5)]);}catch(_0x2aa820){this[_0x2f46c0(0xf8)]=undefined,this[_0x2f46c0(0x8f)][_0x2f46c0(0xc5)](_0x2aa820),await this['errorNotification']([this['commitData'][_0x2f46c0(0xef)][_0x2f46c0(0xe7)]],this[_0x2f46c0(0x94)]['gitProvider'],this[_0x2f46c0(0x8c)][_0x2f46c0(0xf5)],this[_0x2f46c0(0xec)][_0x2f46c0(0xf5)]);throw _0x2aa820;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a124_0x330038(0xb1)])({'transient':!![]}),__metadata(a124_0x330038(0x8e),[salesforce_service_1[a124_0x330038(0xa7)],commit_components_job_1[a124_0x330038(0xb8)],salesforce_sync_service_1[a124_0x330038(0xd8)]])],FlosumCommitJob),exports[a124_0x330038(0xd6)]=FlosumCommitJob;