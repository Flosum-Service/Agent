const a74_0x16c05d=a74_0x4566;(function(_0x3646dc,_0x24a0f9){const _0x174fbb=a74_0x4566,_0x44f53e=_0x3646dc();while(!![]){try{const _0x29074b=parseInt(_0x174fbb(0x195))/0x1+parseInt(_0x174fbb(0x152))/0x2+parseInt(_0x174fbb(0x19f))/0x3+-parseInt(_0x174fbb(0x181))/0x4+-parseInt(_0x174fbb(0x177))/0x5+parseInt(_0x174fbb(0x199))/0x6*(-parseInt(_0x174fbb(0x14c))/0x7)+parseInt(_0x174fbb(0x16a))/0x8*(-parseInt(_0x174fbb(0x184))/0x9);if(_0x29074b===_0x24a0f9)break;else _0x44f53e['push'](_0x44f53e['shift']());}catch(_0x1ea20b){_0x44f53e['push'](_0x44f53e['shift']());}}}(a74_0x513c,0x527cc));const a74_0x236564=(function(){let _0x146eac=!![];return function(_0x446066,_0x231f60){const _0x3ee146=_0x146eac?function(){const _0x380120=a74_0x4566;if(_0x231f60){const _0x38b492=_0x231f60[_0x380120(0x19a)](_0x446066,arguments);return _0x231f60=null,_0x38b492;}}:function(){};return _0x146eac=![],_0x3ee146;};}()),a74_0x2fea5b=a74_0x236564(this,function(){const _0x43f407=a74_0x4566;return a74_0x2fea5b[_0x43f407(0x158)]()[_0x43f407(0x137)](_0x43f407(0x164))[_0x43f407(0x158)]()[_0x43f407(0x197)](a74_0x2fea5b)[_0x43f407(0x137)](_0x43f407(0x164));});a74_0x2fea5b();'use strict';function a74_0x513c(){const _0x538f9b=['decorate',']\x20[Branch:\x20','repoService','exec','log','length','866485WjCjne','getCommitDto','defineProperty','getComponentsToDelete','typedi','BadRequestError','retrieveAttachment','then','../../salesforce/services/salesforce-sync.service','gitRepoService','2410328QoytGC','updateLastCommit','repo','78615hcdHbC','getOwnPropertyDescriptor','isConvertToSfdx','patchObject','branches','gitApiService','./commit-components.job','run','ERR_UNKNOWN_SYNC_RECORD_ID','all','gitProvider','getComponentsToWrite','getBranchRecord','Tokens','CommitComponentsJob','syncRepositoryId','branchName','526730BiBXoS','branch','constructor','../../salesforce/services/salesforce-retriever.service','12mPPglI','apply','syncBranchId','\x20Update\x20remote\x20state.','repositoryName','logger','1126770cQNVXy','sha','CommitComponentsDto','\x20Start\x20Flosum\x20commit\x20job.','search','__metadata','function','repository','SalesforceRetrieverService','prefix','trim','repositoryData','split','FLOSUM_ATTACHMENT','metadata','../dto/commit-components.dto','get','salesforceService','commitAttachmentId','default','__decorate','commitData','error','object','__esModule','371189SOlZWS','__importDefault','provider','map','../../providers/providers.tokens','user','669902sMNhjM','FlosumCommitJob','Container','fetchRepositoryData','Error','send','toString','getOne','catch','commitJob','SalesforceService','salesforceSync','handleCommitJobError','deleteAttachmentId','Service','../../../../core/errors/bad-request.error','[FLOSUM\x20->\x20GIT]\x20[',']\x20[Repository:\x20','(((.+)+)+)+$','setStatus','config','sfLogger','In\x20Progress','convertToSFDX','16KGdDzP','message','name','updateRemoteState','shortid','Logger','../../../../constants/errors'];a74_0x513c=function(){return _0x538f9b;};return a74_0x513c();}function a74_0x4566(_0x43403f,_0x129bc8){const _0x12dd95=a74_0x513c();return a74_0x4566=function(_0x2fea5b,_0x236564){_0x2fea5b=_0x2fea5b-0x135;let _0x513c9f=_0x12dd95[_0x2fea5b];return _0x513c9f;},a74_0x4566(_0x43403f,_0x129bc8);}var __decorate=this&&this[a74_0x16c05d(0x147)]||function(_0x1b2b5e,_0x42b1b8,_0x427ea6,_0x1fbd81){const _0x1f6de6=a74_0x16c05d;var _0xe0aafe=arguments['length'],_0x395097=_0xe0aafe<0x3?_0x42b1b8:_0x1fbd81===null?_0x1fbd81=Object[_0x1f6de6(0x185)](_0x42b1b8,_0x427ea6):_0x1fbd81,_0x555d90;if(typeof Reflect===_0x1f6de6(0x14a)&&typeof Reflect['decorate']===_0x1f6de6(0x139))_0x395097=Reflect[_0x1f6de6(0x171)](_0x1b2b5e,_0x42b1b8,_0x427ea6,_0x1fbd81);else{for(var _0x334d97=_0x1b2b5e[_0x1f6de6(0x176)]-0x1;_0x334d97>=0x0;_0x334d97--)if(_0x555d90=_0x1b2b5e[_0x334d97])_0x395097=(_0xe0aafe<0x3?_0x555d90(_0x395097):_0xe0aafe>0x3?_0x555d90(_0x42b1b8,_0x427ea6,_0x395097):_0x555d90(_0x42b1b8,_0x427ea6))||_0x395097;}return _0xe0aafe>0x3&&_0x395097&&Object['defineProperty'](_0x42b1b8,_0x427ea6,_0x395097),_0x395097;},__metadata=this&&this[a74_0x16c05d(0x138)]||function(_0x393a9e,_0x126fa2){const _0x112ab3=a74_0x16c05d;if(typeof Reflect==='object'&&typeof Reflect[_0x112ab3(0x141)]===_0x112ab3(0x139))return Reflect[_0x112ab3(0x141)](_0x393a9e,_0x126fa2);},__importDefault=this&&this[a74_0x16c05d(0x14d)]||function(_0x32f919){return _0x32f919&&_0x32f919['__esModule']?_0x32f919:{'default':_0x32f919};},FlosumCommitJob_1;Object[a74_0x16c05d(0x179)](exports,a74_0x16c05d(0x14b),{'value':!![]}),exports[a74_0x16c05d(0x153)]=void 0x0;const core_1=require('../../../../core'),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a74_0x16c05d(0x17b)),errors_1=require(a74_0x16c05d(0x170)),bad_request_error_1=require(a74_0x16c05d(0x161)),salesforce_retriever_service_1=require(a74_0x16c05d(0x198)),salesforce_sync_service_1=require(a74_0x16c05d(0x17f)),commit_components_dto_1=require(a74_0x16c05d(0x142)),commit_components_job_1=require(a74_0x16c05d(0x18a)),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a74_0x16c05d(0x16e))),providers_tokens_1=require(a74_0x16c05d(0x150));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x33f543,_0x4c534d,_0x19da55){const _0x5b3d1a=a74_0x16c05d;this[_0x5b3d1a(0x144)]=_0x33f543,this['commitJob']=_0x4c534d,this[_0x5b3d1a(0x15d)]=_0x19da55,this[_0x5b3d1a(0x19e)]=new core_1[(_0x5b3d1a(0x16f))](FlosumCommitJob_1[_0x5b3d1a(0x16c)]);}async[a74_0x16c05d(0x155)](){const _0xd00bfc=a74_0x16c05d;try{if(this[_0xd00bfc(0x148)][_0xd00bfc(0x193)])this['repositoryData']=await this[_0xd00bfc(0x15d)]['getRepositoryRecord'](this[_0xd00bfc(0x148)][_0xd00bfc(0x193)]);else this[_0xd00bfc(0x148)]['syncBranchId']&&(this[_0xd00bfc(0x13e)]=await this[_0xd00bfc(0x15d)][_0xd00bfc(0x190)](this[_0xd00bfc(0x148)][_0xd00bfc(0x19b)]));}catch(_0x25fd22){throw new bad_request_error_1[(_0xd00bfc(0x17c))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a74_0x16c05d(0x18f)](){const _0x10296f=a74_0x16c05d;if(!this['commitData']['commitAttachmentId'])return[];await this['salesforceService'][_0x10296f(0x187)](constants_1[_0x10296f(0x140)],this[_0x10296f(0x148)][_0x10296f(0x145)],{'Name':(0x0,shortid_1[_0x10296f(0x146)])()});const _0x130d13=await this[_0x10296f(0x144)][_0x10296f(0x17d)](this[_0x10296f(0x148)]['commitAttachmentId'])[_0x10296f(0x17e)](_0x14f9d7=>_0x14f9d7[_0x10296f(0x13f)]('\x20')[_0x10296f(0x14f)](_0x355dd0=>_0x355dd0[_0x10296f(0x13d)]()));await this[_0x10296f(0x144)]['deleteAttachment'](this['commitData']['commitAttachmentId']);const _0x58c075=new salesforce_retriever_service_1[(_0x10296f(0x13b))](this[_0x10296f(0x144)]);return await _0x58c075[_0x10296f(0x18b)](_0x130d13);}async[a74_0x16c05d(0x17a)](){const _0x2e7511=a74_0x16c05d;if(!this[_0x2e7511(0x148)][_0x2e7511(0x15f)])return[];await this[_0x2e7511(0x144)][_0x2e7511(0x187)](constants_1['FLOSUM_ATTACHMENT'],this[_0x2e7511(0x148)][_0x2e7511(0x15f)],{'Name':(0x0,shortid_1[_0x2e7511(0x146)])()});const _0x3f803b=await this[_0x2e7511(0x144)][_0x2e7511(0x17d)](this['commitData']['deleteAttachmentId']);return await this[_0x2e7511(0x144)]['deleteAttachment'](this[_0x2e7511(0x148)][_0x2e7511(0x15f)]),_0x3f803b;}async[a74_0x16c05d(0x178)](){const _0x3e4115=a74_0x16c05d,_0x5326e4=new commit_components_dto_1[(_0x3e4115(0x135))](),[_0x313bb9,_0x434cf2]=await Promise[_0x3e4115(0x18d)]([this['getComponentsToWrite'](),this['getComponentsToDelete']()]);return _0x5326e4[_0x3e4115(0x16b)]=this[_0x3e4115(0x148)][_0x3e4115(0x16b)],_0x5326e4[_0x3e4115(0x151)]=this[_0x3e4115(0x148)][_0x3e4115(0x151)],_0x5326e4['components']={'writed':_0x313bb9,'deleted':_0x434cf2},_0x5326e4[_0x3e4115(0x169)]=this[_0x3e4115(0x166)][_0x3e4115(0x186)],_0x5326e4[_0x3e4115(0x183)]=this['repository'],_0x5326e4[_0x3e4115(0x196)]=this[_0x3e4115(0x196)],_0x5326e4[_0x3e4115(0x14e)]=this[_0x3e4115(0x166)][_0x3e4115(0x18e)],_0x5326e4;}async[a74_0x16c05d(0x182)](_0x3bb5de=![]){const _0x49bcbb=a74_0x16c05d;if(_0x3bb5de)await this['salesforceSync'][_0x49bcbb(0x16d)](this[_0x49bcbb(0x13e)],{});else{const _0x11679a=await this[_0x49bcbb(0x13a)][_0x49bcbb(0x188)][_0x49bcbb(0x159)](this[_0x49bcbb(0x196)][_0x49bcbb(0x16c)]);this[_0x49bcbb(0x167)][_0x49bcbb(0x175)](this[_0x49bcbb(0x13c)]+_0x49bcbb(0x19c));const _0x4d331d={[this[_0x49bcbb(0x13a)]['gitUrl']]:{'lastCommit':_0x11679a[_0x49bcbb(0x1a0)]}};await this[_0x49bcbb(0x15d)][_0x49bcbb(0x16d)](this[_0x49bcbb(0x13e)],_0x4d331d);}}async[a74_0x16c05d(0x174)](){const _0x133078=a74_0x16c05d,_0x3bc4af=await this['getCommitDto']();await this[_0x133078(0x15d)][_0x133078(0x165)](this[_0x133078(0x13e)],_0x133078(0x168)),await this[_0x133078(0x15b)][_0x133078(0x18b)](_0x3bc4af,this[_0x133078(0x13c)]),await this['updateLastCommit'](),await this[_0x133078(0x15d)][_0x133078(0x165)](this[_0x133078(0x13e)],'Completed');}async[a74_0x16c05d(0x15e)](_0x2459bc){const _0x222f11=a74_0x16c05d;try{this[_0x222f11(0x167)][_0x222f11(0x149)](''+_0x2459bc),await this[_0x222f11(0x167)]['send'](),await this[_0x222f11(0x182)](!![]),await this['salesforceSync'][_0x222f11(0x165)](this[_0x222f11(0x13e)],_0x222f11(0x156));}catch(_0x5ca153){this[_0x222f11(0x19e)][_0x222f11(0x149)](_0x5ca153);}}async['run'](_0x98b0ec){const _0x41cbf0=a74_0x16c05d;try{this[_0x41cbf0(0x148)]=_0x98b0ec,this[_0x41cbf0(0x189)]=typedi_1[_0x41cbf0(0x154)]['get'](providers_tokens_1[_0x41cbf0(0x191)]['gitApiService']),this[_0x41cbf0(0x173)]=typedi_1[_0x41cbf0(0x154)]['get'](providers_tokens_1[_0x41cbf0(0x191)][_0x41cbf0(0x180)]),this['config']=typedi_1[_0x41cbf0(0x154)][_0x41cbf0(0x143)](providers_tokens_1[_0x41cbf0(0x191)]['config']),await this[_0x41cbf0(0x155)](),this[_0x41cbf0(0x13a)]=await this[_0x41cbf0(0x173)][_0x41cbf0(0x159)](this[_0x41cbf0(0x13e)][_0x41cbf0(0x19d)]),this[_0x41cbf0(0x196)]=await this[_0x41cbf0(0x13a)][_0x41cbf0(0x188)]['getOne'](this['repositoryData'][_0x41cbf0(0x194)]),this[_0x41cbf0(0x167)]=typedi_1[_0x41cbf0(0x154)][_0x41cbf0(0x143)](providers_tokens_1[_0x41cbf0(0x191)][_0x41cbf0(0x19e)]),this[_0x41cbf0(0x13c)]=_0x41cbf0(0x162)+this[_0x41cbf0(0x166)]['gitProvider']['toUpperCase']()+_0x41cbf0(0x163)+this[_0x41cbf0(0x13e)]['repositoryName']+_0x41cbf0(0x172)+this[_0x41cbf0(0x13e)]['branchName']+']\x20['+FlosumCommitJob_1[_0x41cbf0(0x16c)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x41cbf0(0x17c))](errors_1[_0x41cbf0(0x18c)]);await this[_0x41cbf0(0x167)][_0x41cbf0(0x175)](this[_0x41cbf0(0x13c)]+_0x41cbf0(0x136))[_0x41cbf0(0x157)](),await this[_0x41cbf0(0x174)]()[_0x41cbf0(0x15a)](_0x173d63=>this[_0x41cbf0(0x15e)](_0x173d63));}catch(_0x4adb1e){this['commitData']=undefined,this[_0x41cbf0(0x19e)][_0x41cbf0(0x149)](_0x4adb1e);throw _0x4adb1e;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a74_0x16c05d(0x160)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a74_0x16c05d(0x15c)],commit_components_job_1[a74_0x16c05d(0x192)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a74_0x16c05d(0x153)]=FlosumCommitJob;