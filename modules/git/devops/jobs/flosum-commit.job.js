const a122_0x47b90e=a122_0x3277;(function(_0x14702e,_0xc09639){const _0x6ef3d4=a122_0x3277,_0x25d6db=_0x14702e();while(!![]){try{const _0x595762=-parseInt(_0x6ef3d4(0x1c4))/0x1+parseInt(_0x6ef3d4(0x19a))/0x2+parseInt(_0x6ef3d4(0x1ab))/0x3*(-parseInt(_0x6ef3d4(0x170))/0x4)+-parseInt(_0x6ef3d4(0x17e))/0x5*(-parseInt(_0x6ef3d4(0x188))/0x6)+-parseInt(_0x6ef3d4(0x1be))/0x7*(-parseInt(_0x6ef3d4(0x1bf))/0x8)+parseInt(_0x6ef3d4(0x19b))/0x9*(-parseInt(_0x6ef3d4(0x1ad))/0xa)+parseInt(_0x6ef3d4(0x1d0))/0xb;if(_0x595762===_0xc09639)break;else _0x25d6db['push'](_0x25d6db['shift']());}catch(_0x575aef){_0x25d6db['push'](_0x25d6db['shift']());}}}(a122_0xb93e,0xcf6cf));const a122_0x39e208=(function(){let _0x10576f=!![];return function(_0x170aee,_0x406f10){const _0x23400a=_0x10576f?function(){if(_0x406f10){const _0x36a24c=_0x406f10['apply'](_0x170aee,arguments);return _0x406f10=null,_0x36a24c;}}:function(){};return _0x10576f=![],_0x23400a;};}()),a122_0x3d2eac=a122_0x39e208(this,function(){const _0x557eac=a122_0x3277;return a122_0x3d2eac[_0x557eac(0x1ac)]()[_0x557eac(0x19c)](_0x557eac(0x1a5))[_0x557eac(0x1ac)]()[_0x557eac(0x185)](a122_0x3d2eac)['search'](_0x557eac(0x1a5));});a122_0x3d2eac();'use strict';var __decorate=this&&this[a122_0x47b90e(0x197)]||function(_0x1de0cf,_0x308b23,_0x39d5cf,_0x33547a){const _0xc4d667=a122_0x47b90e;var _0x4facc7=arguments[_0xc4d667(0x1b6)],_0x4c0ba2=_0x4facc7<0x3?_0x308b23:_0x33547a===null?_0x33547a=Object[_0xc4d667(0x17a)](_0x308b23,_0x39d5cf):_0x33547a,_0x28b862;if(typeof Reflect===_0xc4d667(0x1bb)&&typeof Reflect['decorate']===_0xc4d667(0x1c1))_0x4c0ba2=Reflect[_0xc4d667(0x195)](_0x1de0cf,_0x308b23,_0x39d5cf,_0x33547a);else{for(var _0x5b31a2=_0x1de0cf[_0xc4d667(0x1b6)]-0x1;_0x5b31a2>=0x0;_0x5b31a2--)if(_0x28b862=_0x1de0cf[_0x5b31a2])_0x4c0ba2=(_0x4facc7<0x3?_0x28b862(_0x4c0ba2):_0x4facc7>0x3?_0x28b862(_0x308b23,_0x39d5cf,_0x4c0ba2):_0x28b862(_0x308b23,_0x39d5cf))||_0x4c0ba2;}return _0x4facc7>0x3&&_0x4c0ba2&&Object[_0xc4d667(0x1d7)](_0x308b23,_0x39d5cf,_0x4c0ba2),_0x4c0ba2;},__metadata=this&&this['__metadata']||function(_0x37c0e6,_0x199824){const _0x2b0881=a122_0x47b90e;if(typeof Reflect===_0x2b0881(0x1bb)&&typeof Reflect[_0x2b0881(0x1b5)]===_0x2b0881(0x1c1))return Reflect[_0x2b0881(0x1b5)](_0x37c0e6,_0x199824);},__importDefault=this&&this[a122_0x47b90e(0x199)]||function(_0x1da3c4){return _0x1da3c4&&_0x1da3c4['__esModule']?_0x1da3c4:{'default':_0x1da3c4};},FlosumCommitJob_1;Object['defineProperty'](exports,a122_0x47b90e(0x174),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;function a122_0xb93e(){const _0x482e9b=['length','deleteAttachment','ERR_INVALID_SYNC_RECORD_ID','user','components','object','retrieveAttachment','[FLOSUM\x20->\x20GIT]\x20[','3892497bIjbAI','16ctuyYK','../../../../constants/errors','function','Completed','repoService','1172989YtTfCJ','gitProvider','In\x20Progress','split','then','commitData','updateRemoteState','getComponentsToDelete','repo','gitApiService','name','\x20Start\x20Flosum\x20commit\x20job.','14604271jhvUGl','logger','SalesforceRetrieverService','syncBranchId','default','message','FlosumCommitJob','defineProperty','trim','config','1252KyZchl','getOne','Container','branch','__esModule','branches','getRepositoryRecord','exec','sha','deleteAttachmentId','getOwnPropertyDescriptor','sfLogger','SalesforceService','get','5VVhGKI','getBranchRecord','patchObject','error','repositoryData','provider','./commit-components.job','constructor','getComponentsToWrite','fetchRepositoryData','4688148ntGJid','CommitComponentsDto','setStatus','send','prefix','catch','parse','map','Service','../../providers/providers.tokens','gitUrl','ERR_UNKNOWN_SYNC_RECORD_ID','commitJob','decorate','run','__decorate','salesforceSync','__importDefault','3045174wFXZVU','891rWMXhP','search','handleCommitJobError','SalesforceSyncService','commitAttachmentId','repository','../../../../core/errors/bad-request.error',']\x20[','shortid','updateLastCommit','(((.+)+)+)+$','convertToSFDX','syncRepositoryId','log',']\x20[Repository:\x20','../../../../core','13185xvnwEI','toString','135910VUOnDG','Tokens','toUpperCase','recordType','repositoryName','FLOSUM_ATTACHMENT','salesforceService','BadRequestError','metadata'];a122_0xb93e=function(){return _0x482e9b;};return a122_0xb93e();}function a122_0x3277(_0x543e3c,_0x1d6fe5){const _0x37316b=a122_0xb93e();return a122_0x3277=function(_0x3d2eac,_0x39e208){_0x3d2eac=_0x3d2eac-0x16e;let _0xb93ec6=_0x37316b[_0x3d2eac];return _0xb93ec6;},a122_0x3277(_0x543e3c,_0x1d6fe5);}const core_1=require(a122_0x47b90e(0x1aa)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require('typedi'),errors_1=require(a122_0x47b90e(0x1c0)),bad_request_error_1=require(a122_0x47b90e(0x1a1)),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a122_0x47b90e(0x184)),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a122_0x47b90e(0x1a3))),providers_tokens_1=require(a122_0x47b90e(0x191));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x357167,_0x24487c,_0x406d51){const _0x57545d=a122_0x47b90e;this[_0x57545d(0x1b3)]=_0x357167,this[_0x57545d(0x194)]=_0x24487c,this[_0x57545d(0x198)]=_0x406d51,this[_0x57545d(0x1d1)]=new core_1['Logger'](FlosumCommitJob_1[_0x57545d(0x1ce)]);}async[a122_0x47b90e(0x187)](){const _0x37baea=a122_0x47b90e;try{if(this[_0x37baea(0x1c9)][_0x37baea(0x1a7)])this[_0x37baea(0x182)]=await this['salesforceSync'][_0x37baea(0x176)](this[_0x37baea(0x1c9)][_0x37baea(0x1a7)]);else this[_0x37baea(0x1c9)][_0x37baea(0x1d3)]&&(this[_0x37baea(0x182)]=await this[_0x37baea(0x198)][_0x37baea(0x17f)](this['commitData'][_0x37baea(0x1d3)]));}catch(_0x2e677c){throw new bad_request_error_1[(_0x37baea(0x1b4))](errors_1[_0x37baea(0x1b8)]);}}async[a122_0x47b90e(0x186)](){const _0x5b8ce1=a122_0x47b90e;if(!this[_0x5b8ce1(0x1c9)][_0x5b8ce1(0x19f)])return[];await this[_0x5b8ce1(0x1b3)][_0x5b8ce1(0x180)](constants_1[_0x5b8ce1(0x1b2)],this[_0x5b8ce1(0x1c9)][_0x5b8ce1(0x19f)],{'Name':(0x0,shortid_1[_0x5b8ce1(0x1d4)])()});const _0x15e8d8=await this[_0x5b8ce1(0x1b3)][_0x5b8ce1(0x1bc)](this[_0x5b8ce1(0x1c9)][_0x5b8ce1(0x19f)])[_0x5b8ce1(0x1c8)](_0x10d86d=>_0x10d86d[_0x5b8ce1(0x1c7)]('\x20')[_0x5b8ce1(0x18f)](_0x1e1b7d=>_0x1e1b7d[_0x5b8ce1(0x16e)]()));await this[_0x5b8ce1(0x1b3)][_0x5b8ce1(0x1b7)](this[_0x5b8ce1(0x1c9)][_0x5b8ce1(0x19f)]);const _0x23fd3a=new salesforce_retriever_service_1[(_0x5b8ce1(0x1d2))](this[_0x5b8ce1(0x1b3)]);return await _0x23fd3a['run'](_0x15e8d8);}async[a122_0x47b90e(0x1cb)](){const _0x5f52e7=a122_0x47b90e;if(!this[_0x5f52e7(0x1c9)]['deleteAttachmentId'])return[];await this[_0x5f52e7(0x1b3)]['patchObject'](constants_1[_0x5f52e7(0x1b2)],this[_0x5f52e7(0x1c9)][_0x5f52e7(0x179)],{'Name':(0x0,shortid_1[_0x5f52e7(0x1d4)])()});const _0x1be930=await this['salesforceService'][_0x5f52e7(0x1bc)](this[_0x5f52e7(0x1c9)]['deleteAttachmentId']),_0x119dd4=JSON[_0x5f52e7(0x18e)](_0x1be930);return await this[_0x5f52e7(0x1b3)]['deleteAttachment'](this[_0x5f52e7(0x1c9)][_0x5f52e7(0x179)]),_0x119dd4;}async['getCommitDto'](){const _0x5c463d=a122_0x47b90e,_0x25a668=new commit_components_dto_1[(_0x5c463d(0x189))](),[_0x198904,_0x314b15]=await Promise['all']([this[_0x5c463d(0x186)](),this['getComponentsToDelete']()]);return _0x25a668[_0x5c463d(0x1d5)]=this['commitData']['message'],_0x25a668[_0x5c463d(0x1b9)]=this[_0x5c463d(0x1c9)][_0x5c463d(0x1b9)],_0x25a668[_0x5c463d(0x1ba)]={'writed':_0x198904,'deleted':_0x314b15},_0x25a668[_0x5c463d(0x1a6)]=this[_0x5c463d(0x16f)]['isConvertToSfdx'],_0x25a668[_0x5c463d(0x1cc)]=this['repository'],_0x25a668['branch']=this[_0x5c463d(0x173)],_0x25a668[_0x5c463d(0x183)]=this[_0x5c463d(0x16f)][_0x5c463d(0x1c5)],_0x25a668[_0x5c463d(0x1b0)]=this['repositoryData']['recordTypeName'],_0x25a668;}async['updateLastCommit'](_0x21afa2=![]){const _0x470275=a122_0x47b90e;if(_0x21afa2)await this['salesforceSync'][_0x470275(0x1ca)](this['repositoryData'],{});else{const _0x3b499d=await this[_0x470275(0x1a0)][_0x470275(0x175)][_0x470275(0x171)](this[_0x470275(0x173)][_0x470275(0x1ce)]);this[_0x470275(0x17b)][_0x470275(0x1a8)](this['prefix']+'\x20Update\x20remote\x20state.');const _0xfc91cb={[this[_0x470275(0x1a0)][_0x470275(0x192)]]:{'lastCommit':_0x3b499d[_0x470275(0x178)]}};await this[_0x470275(0x198)][_0x470275(0x1ca)](this['repositoryData'],_0xfc91cb);}}async[a122_0x47b90e(0x177)](){const _0x1d7a30=a122_0x47b90e,_0x33d622=await this['getCommitDto']();await this[_0x1d7a30(0x198)][_0x1d7a30(0x18a)](this[_0x1d7a30(0x182)],_0x1d7a30(0x1c6)),await this[_0x1d7a30(0x194)][_0x1d7a30(0x196)](_0x33d622,this[_0x1d7a30(0x18c)]),await this['updateLastCommit'](),await this['salesforceSync']['setStatus'](this['repositoryData'],_0x1d7a30(0x1c2));}async[a122_0x47b90e(0x19d)](_0x567d64){const _0x4ffafb=a122_0x47b90e;try{this[_0x4ffafb(0x17b)]['error'](''+_0x567d64),await this['sfLogger'][_0x4ffafb(0x18b)](),await this[_0x4ffafb(0x1a4)](!![]),await this[_0x4ffafb(0x198)][_0x4ffafb(0x18a)](this[_0x4ffafb(0x182)],'Error');}catch(_0xe8e258){this['logger'][_0x4ffafb(0x181)](_0xe8e258);}}async[a122_0x47b90e(0x196)](_0x560396){const _0x4e62b0=a122_0x47b90e;try{this[_0x4e62b0(0x1c9)]=_0x560396,this[_0x4e62b0(0x1cd)]=typedi_1[_0x4e62b0(0x172)][_0x4e62b0(0x17d)](providers_tokens_1['Tokens'][_0x4e62b0(0x1cd)]),this[_0x4e62b0(0x1c3)]=typedi_1[_0x4e62b0(0x172)][_0x4e62b0(0x17d)](providers_tokens_1[_0x4e62b0(0x1ae)]['gitRepoService']),this[_0x4e62b0(0x16f)]=typedi_1[_0x4e62b0(0x172)][_0x4e62b0(0x17d)](providers_tokens_1['Tokens'][_0x4e62b0(0x16f)]),await this[_0x4e62b0(0x187)](),this['repository']=await this[_0x4e62b0(0x1c3)]['getOne'](this['repositoryData'][_0x4e62b0(0x1b1)]),this[_0x4e62b0(0x173)]=await this['repository']['branches'][_0x4e62b0(0x171)](this[_0x4e62b0(0x182)]['branchName']),this[_0x4e62b0(0x17b)]=typedi_1['Container'][_0x4e62b0(0x17d)](providers_tokens_1['Tokens'][_0x4e62b0(0x1d1)]),this['prefix']=_0x4e62b0(0x1bd)+this[_0x4e62b0(0x16f)]['gitProvider'][_0x4e62b0(0x1af)]()+_0x4e62b0(0x1a9)+this[_0x4e62b0(0x182)][_0x4e62b0(0x1b1)]+']\x20[Branch:\x20'+this[_0x4e62b0(0x182)]['branchName']+_0x4e62b0(0x1a2)+FlosumCommitJob_1['name']+']';if(!this['repositoryData'])throw new bad_request_error_1['BadRequestError'](errors_1[_0x4e62b0(0x193)]);await this['sfLogger'][_0x4e62b0(0x1a8)](this[_0x4e62b0(0x18c)]+_0x4e62b0(0x1cf))[_0x4e62b0(0x18b)](),await this['exec']()[_0x4e62b0(0x18d)](_0x5d5cc0=>this[_0x4e62b0(0x19d)](_0x5d5cc0));}catch(_0x18f7a6){this[_0x4e62b0(0x1c9)]=undefined,this[_0x4e62b0(0x1d1)][_0x4e62b0(0x181)](_0x18f7a6);throw _0x18f7a6;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a122_0x47b90e(0x190)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a122_0x47b90e(0x17c)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a122_0x47b90e(0x19e)]])],FlosumCommitJob),exports[a122_0x47b90e(0x1d6)]=FlosumCommitJob;