const a105_0x470bd2=a105_0x1ba0;function a105_0x187f(){const _0x205e9e=['BadRequestError','Completed','error','../dto/commit-components.dto','repository','Logger','\x20Update\x20remote\x20state.','getOne','repoService','convertToSFDX','commitJob','isConvertToSfdx','../../../../core/errors/bad-request.error','getComponentsToWrite','(((.+)+)+)+$','Tokens','prefix','metadata','../../salesforce/services/salesforce.service','../../../../constants','retrieveAttachment','shortid','ERR_UNKNOWN_SYNC_RECORD_ID','config','send','Error','gitApiService','log',']\x20[','default','defineProperty','FLOSUM_ATTACHMENT','709zDeEZm','name','1886lhYfdt','deleteAttachment','sfLogger','5264104XGFyYv','4128xchTsz','17104170hBjEVg','getComponentsToDelete','__importDefault',']\x20[Repository:\x20','length','exec','gitRepoService','updateLastCommit','4540716WNIkpB','CommitComponentsJob','FlosumCommitJob','toString','getCommitDto',']\x20[Branch:\x20','provider','../../../../constants/errors','gitUrl','Container','commitAttachmentId','get','ERR_INVALID_SYNC_RECORD_ID','In\x20Progress','11kqVjFC','branch','trim','Service','syncRepositoryId','salesforceSync','[FLOSUM\x20->\x20GIT]\x20[','all','gitProvider','repositoryData','2485GxwtqB','711660xENuPp','deleteAttachmentId','__esModule','setStatus','branches','__metadata','search','function','../../salesforce/services/salesforce-retriever.service','fetchRepositoryData','commitData','user','handleCommitJobError','constructor','patchObject','object','branchName','getRepositoryRecord','split','decorate','salesforceService','repo','repositoryName','catch','getBranchRecord','logger','syncBranchId','run','__decorate','7127350KingDe','then','updateRemoteState','18rzoyYh','getOwnPropertyDescriptor','message'];a105_0x187f=function(){return _0x205e9e;};return a105_0x187f();}(function(_0x4da206,_0x331bcd){const _0x55c8a7=a105_0x1ba0,_0x46d70d=_0x4da206();while(!![]){try{const _0x21af81=-parseInt(_0x55c8a7(0xff))/0x1*(-parseInt(_0x55c8a7(0x101))/0x2)+-parseInt(_0x55c8a7(0x127))/0x3+-parseInt(_0x55c8a7(0x10e))/0x4+parseInt(_0x55c8a7(0xd9))/0x5+-parseInt(_0x55c8a7(0x105))/0x6*(parseInt(_0x55c8a7(0x126))/0x7)+parseInt(_0x55c8a7(0x104))/0x8*(-parseInt(_0x55c8a7(0xdc))/0x9)+parseInt(_0x55c8a7(0x106))/0xa*(parseInt(_0x55c8a7(0x11c))/0xb);if(_0x21af81===_0x331bcd)break;else _0x46d70d['push'](_0x46d70d['shift']());}catch(_0x3cae6d){_0x46d70d['push'](_0x46d70d['shift']());}}}(a105_0x187f,0xd4d81));function a105_0x1ba0(_0x56bc41,_0x9c238){const _0x47feb1=a105_0x187f();return a105_0x1ba0=function(_0x3ab8e7,_0x3d3164){_0x3ab8e7=_0x3ab8e7-0xc8;let _0x187fb1=_0x47feb1[_0x3ab8e7];return _0x187fb1;},a105_0x1ba0(_0x56bc41,_0x9c238);}const a105_0x3d3164=(function(){let _0x5857b6=!![];return function(_0x4ca801,_0x17ae53){const _0x4b52ee=_0x5857b6?function(){if(_0x17ae53){const _0x2a137d=_0x17ae53['apply'](_0x4ca801,arguments);return _0x17ae53=null,_0x2a137d;}}:function(){};return _0x5857b6=![],_0x4b52ee;};}()),a105_0x3ab8e7=a105_0x3d3164(this,function(){const _0xafd1be=a105_0x1ba0;return a105_0x3ab8e7[_0xafd1be(0x111)]()[_0xafd1be(0x12d)](_0xafd1be(0xed))[_0xafd1be(0x111)]()[_0xafd1be(0xc9)](a105_0x3ab8e7)[_0xafd1be(0x12d)](_0xafd1be(0xed));});a105_0x3ab8e7();'use strict';var __decorate=this&&this[a105_0x470bd2(0xd8)]||function(_0x26d9ce,_0x54a2c6,_0x19b410,_0x15fd6d){const _0x2e6cdf=a105_0x470bd2;var _0x134ffa=arguments[_0x2e6cdf(0x10a)],_0x4a0d23=_0x134ffa<0x3?_0x54a2c6:_0x15fd6d===null?_0x15fd6d=Object[_0x2e6cdf(0xdd)](_0x54a2c6,_0x19b410):_0x15fd6d,_0x12000c;if(typeof Reflect===_0x2e6cdf(0xcb)&&typeof Reflect[_0x2e6cdf(0xcf)]===_0x2e6cdf(0x12e))_0x4a0d23=Reflect[_0x2e6cdf(0xcf)](_0x26d9ce,_0x54a2c6,_0x19b410,_0x15fd6d);else{for(var _0x4728e4=_0x26d9ce[_0x2e6cdf(0x10a)]-0x1;_0x4728e4>=0x0;_0x4728e4--)if(_0x12000c=_0x26d9ce[_0x4728e4])_0x4a0d23=(_0x134ffa<0x3?_0x12000c(_0x4a0d23):_0x134ffa>0x3?_0x12000c(_0x54a2c6,_0x19b410,_0x4a0d23):_0x12000c(_0x54a2c6,_0x19b410))||_0x4a0d23;}return _0x134ffa>0x3&&_0x4a0d23&&Object[_0x2e6cdf(0xfd)](_0x54a2c6,_0x19b410,_0x4a0d23),_0x4a0d23;},__metadata=this&&this[a105_0x470bd2(0x12c)]||function(_0x442e30,_0x1b09e3){const _0x40c426=a105_0x470bd2;if(typeof Reflect===_0x40c426(0xcb)&&typeof Reflect[_0x40c426(0xf0)]===_0x40c426(0x12e))return Reflect[_0x40c426(0xf0)](_0x442e30,_0x1b09e3);},__importDefault=this&&this[a105_0x470bd2(0x108)]||function(_0x4db342){return _0x4db342&&_0x4db342['__esModule']?_0x4db342:{'default':_0x4db342};},FlosumCommitJob_1;Object[a105_0x470bd2(0xfd)](exports,a105_0x470bd2(0x129),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require('../../../../core'),salesforce_service_1=require(a105_0x470bd2(0xf1)),typedi_1=require('typedi'),errors_1=require(a105_0x470bd2(0x115)),bad_request_error_1=require(a105_0x470bd2(0xeb)),salesforce_retriever_service_1=require(a105_0x470bd2(0x12f)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a105_0x470bd2(0xe2)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a105_0x470bd2(0xf2)),shortid_1=__importDefault(require(a105_0x470bd2(0xf4))),providers_tokens_1=require('../../providers/providers.tokens');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x3f8722,_0x4bc262,_0xd5f9f0){const _0x55dcd0=a105_0x470bd2;this[_0x55dcd0(0xd0)]=_0x3f8722,this[_0x55dcd0(0xe9)]=_0x4bc262,this[_0x55dcd0(0x121)]=_0xd5f9f0,this['logger']=new core_1[(_0x55dcd0(0xe4))](FlosumCommitJob_1[_0x55dcd0(0x100)]);}async[a105_0x470bd2(0x130)](){const _0x4395d6=a105_0x470bd2;try{if(this[_0x4395d6(0x131)][_0x4395d6(0x120)])this[_0x4395d6(0x125)]=await this[_0x4395d6(0x121)][_0x4395d6(0xcd)](this[_0x4395d6(0x131)][_0x4395d6(0x120)]);else this[_0x4395d6(0x131)][_0x4395d6(0xd6)]&&(this['repositoryData']=await this[_0x4395d6(0x121)][_0x4395d6(0xd4)](this[_0x4395d6(0x131)][_0x4395d6(0xd6)]));}catch(_0x41de92){throw new bad_request_error_1[(_0x4395d6(0xdf))](errors_1[_0x4395d6(0x11a)]);}}async[a105_0x470bd2(0xec)](){const _0x4090eb=a105_0x470bd2;if(!this[_0x4090eb(0x131)][_0x4090eb(0x118)])return[];await this[_0x4090eb(0xd0)][_0x4090eb(0xca)](constants_1[_0x4090eb(0xfe)],this[_0x4090eb(0x131)][_0x4090eb(0x118)],{'Name':(0x0,shortid_1[_0x4090eb(0xfc)])()});const _0x4ef443=await this[_0x4090eb(0xd0)]['retrieveAttachment'](this[_0x4090eb(0x131)][_0x4090eb(0x118)])[_0x4090eb(0xda)](_0x1f5de5=>_0x1f5de5[_0x4090eb(0xce)]('\x20')['map'](_0x597a9b=>_0x597a9b[_0x4090eb(0x11e)]()));await this[_0x4090eb(0xd0)][_0x4090eb(0x102)](this[_0x4090eb(0x131)][_0x4090eb(0x118)]);const _0x2aabd2=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x4090eb(0xd0)]);return await _0x2aabd2[_0x4090eb(0xd7)](_0x4ef443);}async[a105_0x470bd2(0x107)](){const _0x2e368b=a105_0x470bd2;if(!this['commitData'][_0x2e368b(0x128)])return[];await this[_0x2e368b(0xd0)][_0x2e368b(0xca)](constants_1['FLOSUM_ATTACHMENT'],this[_0x2e368b(0x131)][_0x2e368b(0x128)],{'Name':(0x0,shortid_1[_0x2e368b(0xfc)])()});const _0x246e02=await this[_0x2e368b(0xd0)][_0x2e368b(0xf3)](this['commitData'][_0x2e368b(0x128)]);return await this[_0x2e368b(0xd0)]['deleteAttachment'](this[_0x2e368b(0x131)][_0x2e368b(0x128)]),_0x246e02;}async[a105_0x470bd2(0x112)](){const _0x12cce6=a105_0x470bd2,_0xbdcf93=new commit_components_dto_1['CommitComponentsDto'](),[_0x51a9d5,_0x235ce8]=await Promise[_0x12cce6(0x123)]([this[_0x12cce6(0xec)](),this[_0x12cce6(0x107)]()]);return _0xbdcf93[_0x12cce6(0xde)]=this[_0x12cce6(0x131)][_0x12cce6(0xde)],_0xbdcf93[_0x12cce6(0x132)]=this[_0x12cce6(0x131)][_0x12cce6(0x132)],_0xbdcf93['components']={'writed':_0x51a9d5,'deleted':_0x235ce8},_0xbdcf93[_0x12cce6(0xe8)]=this[_0x12cce6(0xf6)][_0x12cce6(0xea)],_0xbdcf93[_0x12cce6(0xd1)]=this[_0x12cce6(0xe3)],_0xbdcf93['branch']=this[_0x12cce6(0x11d)],_0xbdcf93[_0x12cce6(0x114)]=this[_0x12cce6(0xf6)][_0x12cce6(0x124)],_0xbdcf93;}async['updateLastCommit'](_0x5adb2f=![]){const _0x3ea462=a105_0x470bd2;if(_0x5adb2f)await this['salesforceSync'][_0x3ea462(0xdb)](this[_0x3ea462(0x125)],{});else{const _0xb5a3cf=await this[_0x3ea462(0xe3)][_0x3ea462(0x12b)][_0x3ea462(0xe6)](this['branch'][_0x3ea462(0x100)]);this[_0x3ea462(0x103)][_0x3ea462(0xfa)](this['prefix']+_0x3ea462(0xe5));const _0x5c1a5={[this[_0x3ea462(0xe3)][_0x3ea462(0x116)]]:{'lastCommit':_0xb5a3cf['sha']}};await this[_0x3ea462(0x121)][_0x3ea462(0xdb)](this['repositoryData'],_0x5c1a5);}}async['exec'](){const _0x1e3d6c=a105_0x470bd2,_0x388e7f=await this['getCommitDto']();await this['salesforceSync'][_0x1e3d6c(0x12a)](this[_0x1e3d6c(0x125)],_0x1e3d6c(0x11b)),await this['commitJob']['run'](_0x388e7f,this['prefix']),await this[_0x1e3d6c(0x10d)](),await this[_0x1e3d6c(0x121)][_0x1e3d6c(0x12a)](this['repositoryData'],_0x1e3d6c(0xe0));}async[a105_0x470bd2(0xc8)](_0x5d600e){const _0x134cfa=a105_0x470bd2;try{this[_0x134cfa(0x103)][_0x134cfa(0xe1)](''+_0x5d600e),await this[_0x134cfa(0x103)][_0x134cfa(0xf7)](),await this[_0x134cfa(0x10d)](!![]),await this[_0x134cfa(0x121)][_0x134cfa(0x12a)](this[_0x134cfa(0x125)],_0x134cfa(0xf8));}catch(_0x216f57){this['logger'][_0x134cfa(0xe1)](_0x216f57);}}async[a105_0x470bd2(0xd7)](_0xe79809){const _0x28e698=a105_0x470bd2;try{this['commitData']=_0xe79809,this[_0x28e698(0xf9)]=typedi_1['Container']['get'](providers_tokens_1[_0x28e698(0xee)][_0x28e698(0xf9)]),this[_0x28e698(0xe7)]=typedi_1[_0x28e698(0x117)][_0x28e698(0x119)](providers_tokens_1['Tokens'][_0x28e698(0x10c)]),this[_0x28e698(0xf6)]=typedi_1['Container'][_0x28e698(0x119)](providers_tokens_1['Tokens'][_0x28e698(0xf6)]),await this['fetchRepositoryData'](),this['repository']=await this[_0x28e698(0xe7)][_0x28e698(0xe6)](this['repositoryData'][_0x28e698(0xd2)]),this[_0x28e698(0x11d)]=await this[_0x28e698(0xe3)][_0x28e698(0x12b)][_0x28e698(0xe6)](this['repositoryData'][_0x28e698(0xcc)]),this[_0x28e698(0x103)]=typedi_1[_0x28e698(0x117)][_0x28e698(0x119)](providers_tokens_1[_0x28e698(0xee)][_0x28e698(0xd5)]),this[_0x28e698(0xef)]=_0x28e698(0x122)+this[_0x28e698(0xf6)][_0x28e698(0x124)]['toUpperCase']()+_0x28e698(0x109)+this[_0x28e698(0x125)][_0x28e698(0xd2)]+_0x28e698(0x113)+this[_0x28e698(0x125)]['branchName']+_0x28e698(0xfb)+FlosumCommitJob_1[_0x28e698(0x100)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x28e698(0xdf))](errors_1[_0x28e698(0xf5)]);await this[_0x28e698(0x103)][_0x28e698(0xfa)](this['prefix']+'\x20Start\x20Flosum\x20commit\x20job.')[_0x28e698(0xf7)](),await this[_0x28e698(0x10b)]()[_0x28e698(0xd3)](_0x2c48c6=>this['handleCommitJobError'](_0x2c48c6));}catch(_0x40ca2e){this[_0x28e698(0x131)]=undefined,this[_0x28e698(0xd5)][_0x28e698(0xe1)](_0x40ca2e);throw _0x40ca2e;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x470bd2(0x11f)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1['SalesforceService'],commit_components_job_1[a105_0x470bd2(0x10f)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a105_0x470bd2(0x110)]=FlosumCommitJob;