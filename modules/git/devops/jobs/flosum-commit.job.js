const a73_0x4c973b=a73_0x4f19;(function(_0x4676c3,_0x524f73){const _0xb73c06=a73_0x4f19,_0x2d1e13=_0x4676c3();while(!![]){try{const _0x5ed660=parseInt(_0xb73c06(0x107))/0x1*(parseInt(_0xb73c06(0xdd))/0x2)+-parseInt(_0xb73c06(0xd9))/0x3*(-parseInt(_0xb73c06(0xd6))/0x4)+parseInt(_0xb73c06(0xe0))/0x5+-parseInt(_0xb73c06(0x103))/0x6+parseInt(_0xb73c06(0x11d))/0x7*(parseInt(_0xb73c06(0x10b))/0x8)+-parseInt(_0xb73c06(0xea))/0x9+-parseInt(_0xb73c06(0xe7))/0xa*(-parseInt(_0xb73c06(0x10e))/0xb);if(_0x5ed660===_0x524f73)break;else _0x2d1e13['push'](_0x2d1e13['shift']());}catch(_0x9b444a){_0x2d1e13['push'](_0x2d1e13['shift']());}}}(a73_0x1a97,0x1c5c1));function a73_0x1a97(){const _0x58e41c=['Error','components','SalesforceRetrieverService','1262670rFixVm','ERR_UNKNOWN_SYNC_RECORD_ID','object','BadRequestError','185927KkPRqk','commitData','apply','commitAttachmentId','146728hmJnuL','sfLogger','design:paramtypes','668437MGRVrN',']\x20[Branch:\x20','__importDefault','setStatus','split','handleCommitJobError','message','repo','./commit-components.job','__esModule','FLOSUM_ATTACHMENT','function','config','length','decorate','14lunFTR','repositoryName','branches','Tokens','deleteAttachmentId','(((.+)+)+)+$','\x20Start\x20Flosum\x20commit\x20job.','[FLOSUM\x20->\x20GIT]\x20[','../../../../core','isConvertToSfdx','../../salesforce/services/salesforce-sync.service','__decorate','__metadata','branchName','run','gitProvider','search','name','FlosumCommitJob','salesforceService','get','retrieveAttachment','provider','Completed','updateLastCommit','getRepositoryRecord','repoService','patchObject','then','trim','getOwnPropertyDescriptor','syncRepositoryId','catch','toUpperCase','log','metadata','2092aLicdH','map','commitJob','570HmjkLM','../../providers/providers.tokens','prefix','gitRepoService','2zthqln','../dto/commit-components.dto','../../../../constants/errors','553575drbBSp','exec','constructor','ERR_INVALID_SYNC_RECORD_ID','logger','updateRemoteState','default','10CrnkDK',']\x20[Repository:\x20','fetchRepositoryData','1501695WksWxb','salesforceSync','shortid','SalesforceSyncService','sha','deleteAttachment','repositoryData','convertToSFDX','../../salesforce/services/salesforce.service','CommitComponentsJob','gitUrl','toString','getOne','getComponentsToWrite','\x20Update\x20remote\x20state.','branch','all','repository','Container','user','defineProperty','gitApiService'];a73_0x1a97=function(){return _0x58e41c;};return a73_0x1a97();}const a73_0x34ff56=(function(){let _0x5b0532=!![];return function(_0x3e5f4f,_0x28fcfd){const _0x3fe670=_0x5b0532?function(){const _0x5400b8=a73_0x4f19;if(_0x28fcfd){const _0x1c5273=_0x28fcfd[_0x5400b8(0x109)](_0x3e5f4f,arguments);return _0x28fcfd=null,_0x1c5273;}}:function(){};return _0x5b0532=![],_0x3fe670;};}()),a73_0x4e0a0a=a73_0x34ff56(this,function(){const _0x244af3=a73_0x4f19;return a73_0x4e0a0a[_0x244af3(0xf5)]()[_0x244af3(0x12d)](_0x244af3(0x122))[_0x244af3(0xf5)]()[_0x244af3(0xe2)](a73_0x4e0a0a)['search'](_0x244af3(0x122));});a73_0x4e0a0a();'use strict';var __decorate=this&&this[a73_0x4c973b(0x128)]||function(_0x45d322,_0x1b5c9d,_0x636b47,_0x5af890){const _0x1dcb8b=a73_0x4c973b;var _0x3c58f6=arguments[_0x1dcb8b(0x11b)],_0x46aac2=_0x3c58f6<0x3?_0x1b5c9d:_0x5af890===null?_0x5af890=Object[_0x1dcb8b(0xd0)](_0x1b5c9d,_0x636b47):_0x5af890,_0x3b722a;if(typeof Reflect===_0x1dcb8b(0x105)&&typeof Reflect['decorate']==='function')_0x46aac2=Reflect[_0x1dcb8b(0x11c)](_0x45d322,_0x1b5c9d,_0x636b47,_0x5af890);else{for(var _0x34d508=_0x45d322[_0x1dcb8b(0x11b)]-0x1;_0x34d508>=0x0;_0x34d508--)if(_0x3b722a=_0x45d322[_0x34d508])_0x46aac2=(_0x3c58f6<0x3?_0x3b722a(_0x46aac2):_0x3c58f6>0x3?_0x3b722a(_0x1b5c9d,_0x636b47,_0x46aac2):_0x3b722a(_0x1b5c9d,_0x636b47))||_0x46aac2;}return _0x3c58f6>0x3&&_0x46aac2&&Object[_0x1dcb8b(0xfe)](_0x1b5c9d,_0x636b47,_0x46aac2),_0x46aac2;},__metadata=this&&this[a73_0x4c973b(0x129)]||function(_0x5395d8,_0x58bd08){const _0x1c4ed3=a73_0x4c973b;if(typeof Reflect===_0x1c4ed3(0x105)&&typeof Reflect[_0x1c4ed3(0xd5)]===_0x1c4ed3(0x119))return Reflect[_0x1c4ed3(0xd5)](_0x5395d8,_0x58bd08);},__importDefault=this&&this[a73_0x4c973b(0x110)]||function(_0x37ed8a){return _0x37ed8a&&_0x37ed8a['__esModule']?_0x37ed8a:{'default':_0x37ed8a};},FlosumCommitJob_1;Object['defineProperty'](exports,a73_0x4c973b(0x117),{'value':!![]}),exports[a73_0x4c973b(0x12f)]=void 0x0;const core_1=require(a73_0x4c973b(0x125)),salesforce_service_1=require(a73_0x4c973b(0xf2)),typedi_1=require('typedi'),errors_1=require(a73_0x4c973b(0xdf)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require(a73_0x4c973b(0x127)),commit_components_dto_1=require(a73_0x4c973b(0xde)),commit_components_job_1=require(a73_0x4c973b(0x116)),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a73_0x4c973b(0xec))),providers_tokens_1=require(a73_0x4c973b(0xda));function a73_0x4f19(_0x589f6f,_0x55c994){const _0x2d95de=a73_0x1a97();return a73_0x4f19=function(_0x4e0a0a,_0x34ff56){_0x4e0a0a=_0x4e0a0a-0xc7;let _0x1a97d5=_0x2d95de[_0x4e0a0a];return _0x1a97d5;},a73_0x4f19(_0x589f6f,_0x55c994);}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x3816ff,_0x28b6e7,_0x421bf2){const _0x33d4ca=a73_0x4c973b;this[_0x33d4ca(0x130)]=_0x3816ff,this[_0x33d4ca(0xd8)]=_0x28b6e7,this[_0x33d4ca(0xeb)]=_0x421bf2,this[_0x33d4ca(0xe4)]=new core_1['Logger'](FlosumCommitJob_1[_0x33d4ca(0x12e)]);}async[a73_0x4c973b(0xe9)](){const _0x3d7510=a73_0x4c973b;try{if(this[_0x3d7510(0x108)]['syncRepositoryId'])this['repositoryData']=await this['salesforceSync'][_0x3d7510(0xcb)](this['commitData'][_0x3d7510(0xd1)]);else this[_0x3d7510(0x108)]['syncBranchId']&&(this['repositoryData']=await this[_0x3d7510(0xeb)]['getBranchRecord'](this['commitData']['syncBranchId']));}catch(_0x2b8dbb){throw new bad_request_error_1[(_0x3d7510(0x106))](errors_1[_0x3d7510(0xe3)]);}}async['getComponentsToWrite'](){const _0x577e39=a73_0x4c973b;if(!this[_0x577e39(0x108)][_0x577e39(0x10a)])return[];await this[_0x577e39(0x130)][_0x577e39(0xcd)](constants_1['FLOSUM_ATTACHMENT'],this['commitData'][_0x577e39(0x10a)],{'Name':(0x0,shortid_1[_0x577e39(0xe6)])()});const _0x5a7557=await this[_0x577e39(0x130)][_0x577e39(0xc7)](this[_0x577e39(0x108)][_0x577e39(0x10a)])[_0x577e39(0xce)](_0x54a5b8=>_0x54a5b8[_0x577e39(0x112)]('\x20')[_0x577e39(0xd7)](_0x3236bc=>_0x3236bc[_0x577e39(0xcf)]()));await this['salesforceService']['deleteAttachment'](this['commitData'][_0x577e39(0x10a)]);const _0x455d25=new salesforce_retriever_service_1[(_0x577e39(0x102))](this['salesforceService']);return await _0x455d25[_0x577e39(0x12b)](_0x5a7557);}async['getComponentsToDelete'](){const _0x27b5d7=a73_0x4c973b;if(!this['commitData'][_0x27b5d7(0x121)])return[];await this[_0x27b5d7(0x130)][_0x27b5d7(0xcd)](constants_1[_0x27b5d7(0x118)],this[_0x27b5d7(0x108)][_0x27b5d7(0x121)],{'Name':(0x0,shortid_1[_0x27b5d7(0xe6)])()});const _0x128862=await this[_0x27b5d7(0x130)]['retrieveAttachment'](this[_0x27b5d7(0x108)]['deleteAttachmentId']);return await this[_0x27b5d7(0x130)][_0x27b5d7(0xef)](this[_0x27b5d7(0x108)][_0x27b5d7(0x121)]),_0x128862;}async['getCommitDto'](){const _0x3f2317=a73_0x4c973b,_0x7ffae9=new commit_components_dto_1['CommitComponentsDto'](),[_0x56d146,_0x12de31]=await Promise[_0x3f2317(0xfa)]([this[_0x3f2317(0xf7)](),this['getComponentsToDelete']()]);return _0x7ffae9[_0x3f2317(0x114)]=this['commitData'][_0x3f2317(0x114)],_0x7ffae9[_0x3f2317(0xfd)]=this[_0x3f2317(0x108)][_0x3f2317(0xfd)],_0x7ffae9[_0x3f2317(0x101)]={'writed':_0x56d146,'deleted':_0x12de31},_0x7ffae9[_0x3f2317(0xf1)]=this['config'][_0x3f2317(0x126)],_0x7ffae9[_0x3f2317(0x115)]=this[_0x3f2317(0xfb)],_0x7ffae9[_0x3f2317(0xf9)]=this[_0x3f2317(0xf9)],_0x7ffae9[_0x3f2317(0xc8)]=this['config'][_0x3f2317(0x12c)],_0x7ffae9;}async[a73_0x4c973b(0xca)](_0x4a81d5=![]){const _0x4e2d81=a73_0x4c973b;if(_0x4a81d5)await this[_0x4e2d81(0xeb)]['updateRemoteState'](this[_0x4e2d81(0xf0)],{});else{const _0x2c47d4=await this[_0x4e2d81(0xfb)]['branches'][_0x4e2d81(0xf6)](this[_0x4e2d81(0xf9)][_0x4e2d81(0x12e)]);this[_0x4e2d81(0x10c)][_0x4e2d81(0xd4)](this[_0x4e2d81(0xdb)]+_0x4e2d81(0xf8));const _0x3f8437={[this[_0x4e2d81(0xfb)][_0x4e2d81(0xf4)]]:{'lastCommit':_0x2c47d4[_0x4e2d81(0xee)]}};await this[_0x4e2d81(0xeb)][_0x4e2d81(0xe5)](this['repositoryData'],_0x3f8437);}}async[a73_0x4c973b(0xe1)](){const _0x57dd5e=a73_0x4c973b,_0x361bd6=await this['getCommitDto']();await this[_0x57dd5e(0xeb)][_0x57dd5e(0x111)](this[_0x57dd5e(0xf0)],'In\x20Progress'),await this[_0x57dd5e(0xd8)][_0x57dd5e(0x12b)](_0x361bd6,this[_0x57dd5e(0xdb)]),await this[_0x57dd5e(0xca)](),await this[_0x57dd5e(0xeb)][_0x57dd5e(0x111)](this[_0x57dd5e(0xf0)],_0x57dd5e(0xc9));}async[a73_0x4c973b(0x113)](_0x404d5d){const _0x50ee5c=a73_0x4c973b;try{this[_0x50ee5c(0x10c)]['error'](''+_0x404d5d),await this[_0x50ee5c(0x10c)]['send'](),await this[_0x50ee5c(0xca)](!![]),await this[_0x50ee5c(0xeb)][_0x50ee5c(0x111)](this[_0x50ee5c(0xf0)],_0x50ee5c(0x100));}catch(_0x59b7c6){this[_0x50ee5c(0xe4)]['error'](_0x59b7c6);}}async[a73_0x4c973b(0x12b)](_0x32b648){const _0x6f6ae6=a73_0x4c973b;try{this['commitData']=_0x32b648,this[_0x6f6ae6(0xff)]=typedi_1['Container'][_0x6f6ae6(0x131)](providers_tokens_1[_0x6f6ae6(0x120)][_0x6f6ae6(0xff)]),this['repoService']=typedi_1[_0x6f6ae6(0xfc)]['get'](providers_tokens_1[_0x6f6ae6(0x120)][_0x6f6ae6(0xdc)]),this[_0x6f6ae6(0x11a)]=typedi_1['Container'][_0x6f6ae6(0x131)](providers_tokens_1['Tokens']['config']),await this[_0x6f6ae6(0xe9)](),this[_0x6f6ae6(0xfb)]=await this[_0x6f6ae6(0xcc)][_0x6f6ae6(0xf6)](this[_0x6f6ae6(0xf0)][_0x6f6ae6(0x11e)]),this[_0x6f6ae6(0xf9)]=await this['repository'][_0x6f6ae6(0x11f)][_0x6f6ae6(0xf6)](this['repositoryData'][_0x6f6ae6(0x12a)]),this[_0x6f6ae6(0x10c)]=typedi_1[_0x6f6ae6(0xfc)][_0x6f6ae6(0x131)](providers_tokens_1[_0x6f6ae6(0x120)][_0x6f6ae6(0xe4)]),this[_0x6f6ae6(0xdb)]=_0x6f6ae6(0x124)+this[_0x6f6ae6(0x11a)][_0x6f6ae6(0x12c)][_0x6f6ae6(0xd3)]()+_0x6f6ae6(0xe8)+this['repositoryData'][_0x6f6ae6(0x11e)]+_0x6f6ae6(0x10f)+this[_0x6f6ae6(0xf0)]['branchName']+']\x20['+FlosumCommitJob_1['name']+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x6f6ae6(0x106))](errors_1[_0x6f6ae6(0x104)]);await this[_0x6f6ae6(0x10c)]['log'](this['prefix']+_0x6f6ae6(0x123))['send'](),await this[_0x6f6ae6(0xe1)]()[_0x6f6ae6(0xd2)](_0x7053da=>this[_0x6f6ae6(0x113)](_0x7053da));}catch(_0x4b7611){this['commitData']=undefined,this['logger']['error'](_0x4b7611);throw _0x4b7611;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a73_0x4c973b(0x10d),[salesforce_service_1['SalesforceService'],commit_components_job_1[a73_0x4c973b(0xf3)],salesforce_sync_service_1[a73_0x4c973b(0xed)]])],FlosumCommitJob),exports[a73_0x4c973b(0x12f)]=FlosumCommitJob;