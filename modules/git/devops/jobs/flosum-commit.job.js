const a104_0x5cf8f2=a104_0x4172;(function(_0x244412,_0x5bde87){const _0x4b27dc=a104_0x4172,_0x4096a8=_0x244412();while(!![]){try{const _0x2b8b9b=-parseInt(_0x4b27dc(0xe6))/0x1*(-parseInt(_0x4b27dc(0xf1))/0x2)+-parseInt(_0x4b27dc(0xbb))/0x3*(-parseInt(_0x4b27dc(0xd1))/0x4)+-parseInt(_0x4b27dc(0xbe))/0x5+-parseInt(_0x4b27dc(0x102))/0x6*(-parseInt(_0x4b27dc(0x100))/0x7)+parseInt(_0x4b27dc(0xc0))/0x8*(parseInt(_0x4b27dc(0xb9))/0x9)+-parseInt(_0x4b27dc(0xd8))/0xa*(-parseInt(_0x4b27dc(0xd4))/0xb)+-parseInt(_0x4b27dc(0xcd))/0xc;if(_0x2b8b9b===_0x5bde87)break;else _0x4096a8['push'](_0x4096a8['shift']());}catch(_0x26f87a){_0x4096a8['push'](_0x4096a8['shift']());}}}(a104_0x5b97,0xade31));const a104_0xae1098=(function(){let _0x44fd12=!![];return function(_0x4708ed,_0x2600b1){const _0x4e7c9c=_0x44fd12?function(){if(_0x2600b1){const _0x4bddc0=_0x2600b1['apply'](_0x4708ed,arguments);return _0x2600b1=null,_0x4bddc0;}}:function(){};return _0x44fd12=![],_0x4e7c9c;};}()),a104_0x5d3776=a104_0xae1098(this,function(){const _0x34f099=a104_0x4172;return a104_0x5d3776[_0x34f099(0xbf)]()[_0x34f099(0xa9)](_0x34f099(0xb4))[_0x34f099(0xbf)]()[_0x34f099(0xc4)](a104_0x5d3776)[_0x34f099(0xa9)](_0x34f099(0xb4));});a104_0x5d3776();function a104_0x5b97(){const _0x543d2e=['sfLogger','send','__esModule','salesforceSync','__importDefault','object','../dto/commit-components.dto','name','prefix','repoService','syncRepositoryId','logger','branch','toUpperCase','search','syncBranchId','getOne','defineProperty','repositoryData','exec','getComponentsToWrite','updateRemoteState','../../../../core/errors/bad-request.error','Container','../../../../core','(((.+)+)+)+$','convertToSFDX','metadata','SalesforceRetrieverService','all','18IRYhzB','../../salesforce/services/salesforce-sync.service','3WeoaLR','patchObject','../../salesforce/services/salesforce-retriever.service','3536180svOvOQ','toString','2443856vWixrJ','setStatus','message','__metadata','constructor','isConvertToSfdx','user','updateLastCommit','ERR_INVALID_SYNC_RECORD_ID','repositoryName','function','commitAttachmentId','repo','15203472kJlxLF','\x20Start\x20Flosum\x20commit\x20job.','../../salesforce/services/salesforce.service','run','975180YelMYr','getComponentsToDelete','design:paramtypes','12472273sEWQNu','retrieveAttachment','repository','Tokens','10EdETns','gitRepoService','deleteAttachmentId','catch','../../../../constants/errors','sha','deleteAttachment','default','getCommitDto','[FLOSUM\x20->\x20GIT]\x20[',']\x20[Branch:\x20','length','FLOSUM_ATTACHMENT','In\x20Progress','1PbSvYq','salesforceService','handleCommitJobError','../../providers/providers.tokens','config','Logger',']\x20[','decorate','gitApiService','branchName','gitUrl','479218PrRUdN','getBranchRecord','fetchRepositoryData','SalesforceSyncService','trim','commitData','gitProvider','\x20Update\x20remote\x20state.','error','get','CommitComponentsDto','components','BadRequestError','Service','ERR_UNKNOWN_SYNC_RECORD_ID','1379UoaVHZ','FlosumCommitJob','13956INOMqB','commitJob','log'];a104_0x5b97=function(){return _0x543d2e;};return a104_0x5b97();}'use strict';var __decorate=this&&this['__decorate']||function(_0x3d1004,_0x321aa6,_0x4d1fb6,_0x3fbb8d){const _0x2db28c=a104_0x4172;var _0x40230a=arguments[_0x2db28c(0xe3)],_0x282a4d=_0x40230a<0x3?_0x321aa6:_0x3fbb8d===null?_0x3fbb8d=Object['getOwnPropertyDescriptor'](_0x321aa6,_0x4d1fb6):_0x3fbb8d,_0x13ec0b;if(typeof Reflect===_0x2db28c(0xa0)&&typeof Reflect[_0x2db28c(0xed)]===_0x2db28c(0xca))_0x282a4d=Reflect[_0x2db28c(0xed)](_0x3d1004,_0x321aa6,_0x4d1fb6,_0x3fbb8d);else{for(var _0x399a15=_0x3d1004[_0x2db28c(0xe3)]-0x1;_0x399a15>=0x0;_0x399a15--)if(_0x13ec0b=_0x3d1004[_0x399a15])_0x282a4d=(_0x40230a<0x3?_0x13ec0b(_0x282a4d):_0x40230a>0x3?_0x13ec0b(_0x321aa6,_0x4d1fb6,_0x282a4d):_0x13ec0b(_0x321aa6,_0x4d1fb6))||_0x282a4d;}return _0x40230a>0x3&&_0x282a4d&&Object[_0x2db28c(0xac)](_0x321aa6,_0x4d1fb6,_0x282a4d),_0x282a4d;},__metadata=this&&this[a104_0x5cf8f2(0xc3)]||function(_0x308e4b,_0x1372a4){const _0x358f28=a104_0x5cf8f2;if(typeof Reflect===_0x358f28(0xa0)&&typeof Reflect['metadata']===_0x358f28(0xca))return Reflect[_0x358f28(0xb6)](_0x308e4b,_0x1372a4);},__importDefault=this&&this[a104_0x5cf8f2(0x9f)]||function(_0x4d39fe){const _0x5b1773=a104_0x5cf8f2;return _0x4d39fe&&_0x4d39fe[_0x5b1773(0x9d)]?_0x4d39fe:{'default':_0x4d39fe};},FlosumCommitJob_1;Object['defineProperty'](exports,a104_0x5cf8f2(0x9d),{'value':!![]}),exports[a104_0x5cf8f2(0x101)]=void 0x0;function a104_0x4172(_0x4ab08c,_0x1f7c67){const _0x39b4f3=a104_0x5b97();return a104_0x4172=function(_0x5d3776,_0xae1098){_0x5d3776=_0x5d3776-0x9a;let _0x5b97ef=_0x39b4f3[_0x5d3776];return _0x5b97ef;},a104_0x4172(_0x4ab08c,_0x1f7c67);}const core_1=require(a104_0x5cf8f2(0xb3)),salesforce_service_1=require(a104_0x5cf8f2(0xcf)),typedi_1=require('typedi'),errors_1=require(a104_0x5cf8f2(0xdc)),bad_request_error_1=require(a104_0x5cf8f2(0xb1)),salesforce_retriever_service_1=require(a104_0x5cf8f2(0xbd)),salesforce_sync_service_1=require(a104_0x5cf8f2(0xba)),commit_components_dto_1=require(a104_0x5cf8f2(0xa1)),commit_components_job_1=require('./commit-components.job'),constants_1=require('../../../../constants'),shortid_1=__importDefault(require('shortid')),providers_tokens_1=require(a104_0x5cf8f2(0xe9));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x12f6b2,_0x5aae71,_0x5d3504){const _0x4bd715=a104_0x5cf8f2;this[_0x4bd715(0xe7)]=_0x12f6b2,this[_0x4bd715(0x103)]=_0x5aae71,this['salesforceSync']=_0x5d3504,this[_0x4bd715(0xa6)]=new core_1[(_0x4bd715(0xeb))](FlosumCommitJob_1['name']);}async[a104_0x5cf8f2(0xf3)](){const _0x15cf84=a104_0x5cf8f2;try{if(this[_0x15cf84(0xf6)]['syncRepositoryId'])this[_0x15cf84(0xad)]=await this[_0x15cf84(0x9e)]['getRepositoryRecord'](this['commitData'][_0x15cf84(0xa5)]);else this[_0x15cf84(0xf6)][_0x15cf84(0xaa)]&&(this[_0x15cf84(0xad)]=await this['salesforceSync'][_0x15cf84(0xf2)](this[_0x15cf84(0xf6)][_0x15cf84(0xaa)]));}catch(_0x3dccec){throw new bad_request_error_1[(_0x15cf84(0xfd))](errors_1[_0x15cf84(0xc8)]);}}async['getComponentsToWrite'](){const _0xef9234=a104_0x5cf8f2;if(!this[_0xef9234(0xf6)][_0xef9234(0xcb)])return[];await this[_0xef9234(0xe7)][_0xef9234(0xbc)](constants_1[_0xef9234(0xe4)],this['commitData'][_0xef9234(0xcb)],{'Name':(0x0,shortid_1['default'])()});const _0x136284=await this[_0xef9234(0xe7)][_0xef9234(0xd5)](this[_0xef9234(0xf6)][_0xef9234(0xcb)])['then'](_0x4d0dc7=>_0x4d0dc7['split']('\x20')['map'](_0x2919bd=>_0x2919bd[_0xef9234(0xf5)]()));await this[_0xef9234(0xe7)][_0xef9234(0xde)](this[_0xef9234(0xf6)][_0xef9234(0xcb)]);const _0x10eb9c=new salesforce_retriever_service_1[(_0xef9234(0xb7))](this[_0xef9234(0xe7)]);return await _0x10eb9c[_0xef9234(0xd0)](_0x136284);}async[a104_0x5cf8f2(0xd2)](){const _0x21c25c=a104_0x5cf8f2;if(!this[_0x21c25c(0xf6)][_0x21c25c(0xda)])return[];await this['salesforceService'][_0x21c25c(0xbc)](constants_1[_0x21c25c(0xe4)],this[_0x21c25c(0xf6)][_0x21c25c(0xda)],{'Name':(0x0,shortid_1[_0x21c25c(0xdf)])()});const _0x20e92c=await this['salesforceService'][_0x21c25c(0xd5)](this['commitData']['deleteAttachmentId']);return await this[_0x21c25c(0xe7)][_0x21c25c(0xde)](this[_0x21c25c(0xf6)]['deleteAttachmentId']),_0x20e92c;}async[a104_0x5cf8f2(0xe0)](){const _0x1fc388=a104_0x5cf8f2,_0x2fadd9=new commit_components_dto_1[(_0x1fc388(0xfb))](),[_0x252ae3,_0x538842]=await Promise[_0x1fc388(0xb8)]([this[_0x1fc388(0xaf)](),this[_0x1fc388(0xd2)]()]);return _0x2fadd9[_0x1fc388(0xc2)]=this['commitData']['message'],_0x2fadd9[_0x1fc388(0xc6)]=this[_0x1fc388(0xf6)][_0x1fc388(0xc6)],_0x2fadd9[_0x1fc388(0xfc)]={'writed':_0x252ae3,'deleted':_0x538842},_0x2fadd9[_0x1fc388(0xb5)]=this[_0x1fc388(0xea)][_0x1fc388(0xc5)],_0x2fadd9[_0x1fc388(0xcc)]=this[_0x1fc388(0xd6)],_0x2fadd9[_0x1fc388(0xa7)]=this[_0x1fc388(0xa7)],_0x2fadd9['provider']=this['config'][_0x1fc388(0xf7)],_0x2fadd9;}async['updateLastCommit'](_0x5eb2ba=![]){const _0x314cee=a104_0x5cf8f2;if(_0x5eb2ba)await this[_0x314cee(0x9e)][_0x314cee(0xb0)](this['repositoryData'],{});else{const _0x9471fa=await this[_0x314cee(0xd6)]['branches'][_0x314cee(0xab)](this[_0x314cee(0xa7)][_0x314cee(0xa2)]);this[_0x314cee(0x9b)][_0x314cee(0x9a)](this[_0x314cee(0xa3)]+_0x314cee(0xf8));const _0x31e6b5={[this[_0x314cee(0xd6)][_0x314cee(0xf0)]]:{'lastCommit':_0x9471fa[_0x314cee(0xdd)]}};await this[_0x314cee(0x9e)][_0x314cee(0xb0)](this['repositoryData'],_0x31e6b5);}}async[a104_0x5cf8f2(0xae)](){const _0x4c5820=a104_0x5cf8f2,_0xeac44f=await this[_0x4c5820(0xe0)]();await this[_0x4c5820(0x9e)][_0x4c5820(0xc1)](this[_0x4c5820(0xad)],_0x4c5820(0xe5)),await this[_0x4c5820(0x103)]['run'](_0xeac44f,this[_0x4c5820(0xa3)]),await this['updateLastCommit'](),await this[_0x4c5820(0x9e)][_0x4c5820(0xc1)](this[_0x4c5820(0xad)],'Completed');}async['handleCommitJobError'](_0x502513){const _0x3c7b0e=a104_0x5cf8f2;try{this[_0x3c7b0e(0x9b)][_0x3c7b0e(0xf9)](''+_0x502513),await this['sfLogger'][_0x3c7b0e(0x9c)](),await this[_0x3c7b0e(0xc7)](!![]),await this[_0x3c7b0e(0x9e)][_0x3c7b0e(0xc1)](this[_0x3c7b0e(0xad)],'Error');}catch(_0x149f02){this[_0x3c7b0e(0xa6)]['error'](_0x149f02);}}async[a104_0x5cf8f2(0xd0)](_0x59f592){const _0x173a5c=a104_0x5cf8f2;try{this[_0x173a5c(0xf6)]=_0x59f592,this[_0x173a5c(0xee)]=typedi_1[_0x173a5c(0xb2)][_0x173a5c(0xfa)](providers_tokens_1[_0x173a5c(0xd7)]['gitApiService']),this[_0x173a5c(0xa4)]=typedi_1[_0x173a5c(0xb2)][_0x173a5c(0xfa)](providers_tokens_1[_0x173a5c(0xd7)][_0x173a5c(0xd9)]),this[_0x173a5c(0xea)]=typedi_1[_0x173a5c(0xb2)][_0x173a5c(0xfa)](providers_tokens_1[_0x173a5c(0xd7)][_0x173a5c(0xea)]),await this[_0x173a5c(0xf3)](),this['repository']=await this[_0x173a5c(0xa4)][_0x173a5c(0xab)](this[_0x173a5c(0xad)][_0x173a5c(0xc9)]),this['branch']=await this[_0x173a5c(0xd6)]['branches'][_0x173a5c(0xab)](this['repositoryData']['branchName']),this[_0x173a5c(0x9b)]=typedi_1['Container']['get'](providers_tokens_1[_0x173a5c(0xd7)][_0x173a5c(0xa6)]),this[_0x173a5c(0xa3)]=_0x173a5c(0xe1)+this[_0x173a5c(0xea)][_0x173a5c(0xf7)][_0x173a5c(0xa8)]()+']\x20[Repository:\x20'+this[_0x173a5c(0xad)][_0x173a5c(0xc9)]+_0x173a5c(0xe2)+this[_0x173a5c(0xad)][_0x173a5c(0xef)]+_0x173a5c(0xec)+FlosumCommitJob_1[_0x173a5c(0xa2)]+']';if(!this['repositoryData'])throw new bad_request_error_1['BadRequestError'](errors_1[_0x173a5c(0xff)]);await this[_0x173a5c(0x9b)][_0x173a5c(0x9a)](this['prefix']+_0x173a5c(0xce))[_0x173a5c(0x9c)](),await this[_0x173a5c(0xae)]()[_0x173a5c(0xdb)](_0x195345=>this[_0x173a5c(0xe8)](_0x195345));}catch(_0x2f47d8){this['commitData']=undefined,this['logger'][_0x173a5c(0xf9)](_0x2f47d8);throw _0x2f47d8;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a104_0x5cf8f2(0xfe)])({'transient':!![]}),__metadata(a104_0x5cf8f2(0xd3),[salesforce_service_1['SalesforceService'],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a104_0x5cf8f2(0xf4)]])],FlosumCommitJob),exports[a104_0x5cf8f2(0x101)]=FlosumCommitJob;