const a106_0x1a0e79=a106_0x45e8;function a106_0x2420(){const _0x1db685=['In\x20Progress','exec','__metadata','handleCommitJobError','commitAttachmentId','split','commitJob','then','SalesforceSyncService',']\x20[Branch:\x20','3388680YCXDFa','getOwnPropertyDescriptor','send','BadRequestError','repository','[FLOSUM\x20->\x20GIT]\x20[','constructor','map','defineProperty','decorate','getBranchRecord','prefix','\x20Start\x20Flosum\x20commit\x20job.','__esModule','sfLogger','../../../../core/errors/bad-request.error','updateRemoteState','all','../../salesforce/services/salesforce-retriever.service','getComponentsToWrite','gitApiService','FLOSUM_ATTACHMENT','660kjUjWc','\x20Update\x20remote\x20state.','search','ERR_INVALID_SYNC_RECORD_ID','55NDnekY','commitData','branches',']\x20[','updateLastCommit','763rSWoYy','65796CLlGVI','Logger','4869202hfROrC','syncRepositoryId','error','../../../../core','415aeQcHW','toString','parse','getCommitDto','28pDxcJh','getRepositoryRecord','CommitComponentsDto','gitRepoService','314028xJiSyv','salesforceSync','fetchRepositoryData','syncBranchId','message','repoService','SalesforceRetrieverService','apply','log','136341noWPGI','logger','Tokens','function','get','CommitComponentsJob','getOne','deleteAttachmentId','Service','../../salesforce/services/salesforce.service','recordType','isConvertToSfdx','object','config','run','gitUrl',']\x20[Repository:\x20','FlosumCommitJob','setStatus','default','metadata','25768NsLBMs','__importDefault','user','convertToSFDX','30tnaUjG','provider','catch','../dto/commit-components.dto','getComponentsToDelete','Container','Completed','repositoryName','repo','patchObject','branch','repositoryData','length','branchName','(((.+)+)+)+$','name','deleteAttachment','typedi','../../providers/providers.tokens','shortid','salesforceService','trim','85309ZXPTjr','recordTypeName'];a106_0x2420=function(){return _0x1db685;};return a106_0x2420();}(function(_0x208736,_0x557597){const _0x3c94ed=a106_0x45e8,_0x1a157a=_0x208736();while(!![]){try{const _0x59d767=parseInt(_0x3c94ed(0x12b))/0x1*(-parseInt(_0x3c94ed(0x115))/0x2)+-parseInt(_0x3c94ed(0xf3))/0x3*(-parseInt(_0x3c94ed(0xef))/0x4)+parseInt(_0x3c94ed(0x15d))/0x5*(parseInt(_0x3c94ed(0x157))/0x6)+-parseInt(_0x3c94ed(0x156))/0x7*(-parseInt(_0x3c94ed(0x111))/0x8)+-parseInt(_0x3c94ed(0xfc))/0x9*(parseInt(_0x3c94ed(0x14d))/0xa)+-parseInt(_0x3c94ed(0x151))/0xb*(-parseInt(_0x3c94ed(0x137))/0xc)+-parseInt(_0x3c94ed(0x159))/0xd;if(_0x59d767===_0x557597)break;else _0x1a157a['push'](_0x1a157a['shift']());}catch(_0x5be5cc){_0x1a157a['push'](_0x1a157a['shift']());}}}(a106_0x2420,0xb7936));const a106_0x23a71f=(function(){let _0x3131cc=!![];return function(_0x1b1fe8,_0xc5162e){const _0x4eee2f=_0x3131cc?function(){const _0x363013=a106_0x45e8;if(_0xc5162e){const _0x790e18=_0xc5162e[_0x363013(0xfa)](_0x1b1fe8,arguments);return _0xc5162e=null,_0x790e18;}}:function(){};return _0x3131cc=![],_0x4eee2f;};}()),a106_0x186540=a106_0x23a71f(this,function(){const _0x4d8d74=a106_0x45e8;return a106_0x186540[_0x4d8d74(0x15e)]()[_0x4d8d74(0x14f)]('(((.+)+)+)+$')[_0x4d8d74(0x15e)]()[_0x4d8d74(0x13d)](a106_0x186540)[_0x4d8d74(0x14f)](_0x4d8d74(0x123));});function a106_0x45e8(_0x3085dc,_0x163d15){const _0x49d727=a106_0x2420();return a106_0x45e8=function(_0x186540,_0x23a71f){_0x186540=_0x186540-0xef;let _0x242012=_0x49d727[_0x186540];return _0x242012;},a106_0x45e8(_0x3085dc,_0x163d15);}a106_0x186540();'use strict';var __decorate=this&&this['__decorate']||function(_0x6c423a,_0x49bbe8,_0x4ae13e,_0x469291){const _0x38b929=a106_0x45e8;var _0x18a044=arguments['length'],_0x309222=_0x18a044<0x3?_0x49bbe8:_0x469291===null?_0x469291=Object[_0x38b929(0x138)](_0x49bbe8,_0x4ae13e):_0x469291,_0x1f1678;if(typeof Reflect===_0x38b929(0x108)&&typeof Reflect[_0x38b929(0x140)]===_0x38b929(0xff))_0x309222=Reflect['decorate'](_0x6c423a,_0x49bbe8,_0x4ae13e,_0x469291);else{for(var _0x41b204=_0x6c423a[_0x38b929(0x121)]-0x1;_0x41b204>=0x0;_0x41b204--)if(_0x1f1678=_0x6c423a[_0x41b204])_0x309222=(_0x18a044<0x3?_0x1f1678(_0x309222):_0x18a044>0x3?_0x1f1678(_0x49bbe8,_0x4ae13e,_0x309222):_0x1f1678(_0x49bbe8,_0x4ae13e))||_0x309222;}return _0x18a044>0x3&&_0x309222&&Object[_0x38b929(0x13f)](_0x49bbe8,_0x4ae13e,_0x309222),_0x309222;},__metadata=this&&this[a106_0x1a0e79(0x12f)]||function(_0x2cb19c,_0x21ac40){const _0x27136b=a106_0x1a0e79;if(typeof Reflect===_0x27136b(0x108)&&typeof Reflect[_0x27136b(0x110)]===_0x27136b(0xff))return Reflect[_0x27136b(0x110)](_0x2cb19c,_0x21ac40);},__importDefault=this&&this[a106_0x1a0e79(0x112)]||function(_0x57d080){const _0x4bf060=a106_0x1a0e79;return _0x57d080&&_0x57d080[_0x4bf060(0x144)]?_0x57d080:{'default':_0x57d080};},FlosumCommitJob_1;Object[a106_0x1a0e79(0x13f)](exports,a106_0x1a0e79(0x144),{'value':!![]}),exports[a106_0x1a0e79(0x10d)]=void 0x0;const core_1=require(a106_0x1a0e79(0x15c)),salesforce_service_1=require(a106_0x1a0e79(0x105)),typedi_1=require(a106_0x1a0e79(0x126)),errors_1=require('../../../../constants/errors'),bad_request_error_1=require(a106_0x1a0e79(0x146)),salesforce_retriever_service_1=require(a106_0x1a0e79(0x149)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a106_0x1a0e79(0x118)),commit_components_job_1=require('./commit-components.job'),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a106_0x1a0e79(0x128))),providers_tokens_1=require(a106_0x1a0e79(0x127));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x57d9c5,_0x320fe1,_0x4529dc){const _0x4ed756=a106_0x1a0e79;this[_0x4ed756(0x129)]=_0x57d9c5,this[_0x4ed756(0x133)]=_0x320fe1,this['salesforceSync']=_0x4529dc,this[_0x4ed756(0xfd)]=new core_1[(_0x4ed756(0x158))](FlosumCommitJob_1[_0x4ed756(0x124)]);}async['fetchRepositoryData'](){const _0x376aa6=a106_0x1a0e79;try{if(this[_0x376aa6(0x152)][_0x376aa6(0x15a)])this['repositoryData']=await this[_0x376aa6(0xf4)][_0x376aa6(0xf0)](this[_0x376aa6(0x152)]['syncRepositoryId']);else this['commitData']['syncBranchId']&&(this[_0x376aa6(0x120)]=await this[_0x376aa6(0xf4)][_0x376aa6(0x141)](this['commitData'][_0x376aa6(0xf6)]));}catch(_0x5b7510){throw new bad_request_error_1['BadRequestError'](errors_1[_0x376aa6(0x150)]);}}async[a106_0x1a0e79(0x14a)](){const _0x395087=a106_0x1a0e79;if(!this[_0x395087(0x152)][_0x395087(0x131)])return[];await this['salesforceService'][_0x395087(0x11e)](constants_1['FLOSUM_ATTACHMENT'],this['commitData'][_0x395087(0x131)],{'Name':(0x0,shortid_1[_0x395087(0x10f)])()});const _0x45f929=await this[_0x395087(0x129)]['retrieveAttachment'](this[_0x395087(0x152)][_0x395087(0x131)])[_0x395087(0x134)](_0x48b44e=>_0x48b44e[_0x395087(0x132)]('\x20')[_0x395087(0x13e)](_0x557b09=>_0x557b09[_0x395087(0x12a)]()));await this[_0x395087(0x129)][_0x395087(0x125)](this[_0x395087(0x152)][_0x395087(0x131)]);const _0x3e5e5c=new salesforce_retriever_service_1[(_0x395087(0xf9))](this['salesforceService']);return await _0x3e5e5c[_0x395087(0x10a)](_0x45f929);}async[a106_0x1a0e79(0x119)](){const _0x3f189d=a106_0x1a0e79;if(!this[_0x3f189d(0x152)][_0x3f189d(0x103)])return[];await this[_0x3f189d(0x129)][_0x3f189d(0x11e)](constants_1[_0x3f189d(0x14c)],this[_0x3f189d(0x152)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0x3f189d(0x10f)])()});const _0x346bad=await this[_0x3f189d(0x129)]['retrieveAttachment'](this[_0x3f189d(0x152)][_0x3f189d(0x103)]),_0x22bbcc=JSON[_0x3f189d(0x15f)](_0x346bad);return await this[_0x3f189d(0x129)]['deleteAttachment'](this[_0x3f189d(0x152)]['deleteAttachmentId']),_0x22bbcc;}async[a106_0x1a0e79(0x160)](){const _0x2aa2c2=a106_0x1a0e79,_0x47b91b=new commit_components_dto_1[(_0x2aa2c2(0xf1))](),[_0x386dbd,_0x214ff0]=await Promise[_0x2aa2c2(0x148)]([this[_0x2aa2c2(0x14a)](),this[_0x2aa2c2(0x119)]()]);return _0x47b91b[_0x2aa2c2(0xf7)]=this[_0x2aa2c2(0x152)][_0x2aa2c2(0xf7)],_0x47b91b['user']=this[_0x2aa2c2(0x152)][_0x2aa2c2(0x113)],_0x47b91b['components']={'writed':_0x386dbd,'deleted':_0x214ff0},_0x47b91b[_0x2aa2c2(0x114)]=this[_0x2aa2c2(0x109)][_0x2aa2c2(0x107)],_0x47b91b[_0x2aa2c2(0x11d)]=this[_0x2aa2c2(0x13b)],_0x47b91b[_0x2aa2c2(0x11f)]=this[_0x2aa2c2(0x11f)],_0x47b91b[_0x2aa2c2(0x116)]=this[_0x2aa2c2(0x109)]['gitProvider'],_0x47b91b[_0x2aa2c2(0x106)]=this[_0x2aa2c2(0x120)][_0x2aa2c2(0x12c)],_0x47b91b;}async['updateLastCommit'](_0x9a5b7d=![]){const _0x3b0ae8=a106_0x1a0e79;if(_0x9a5b7d)await this[_0x3b0ae8(0xf4)]['updateRemoteState'](this[_0x3b0ae8(0x120)],{});else{const _0x35f5a8=await this[_0x3b0ae8(0x13b)][_0x3b0ae8(0x153)][_0x3b0ae8(0x102)](this[_0x3b0ae8(0x11f)][_0x3b0ae8(0x124)]);this[_0x3b0ae8(0x145)][_0x3b0ae8(0xfb)](this[_0x3b0ae8(0x142)]+_0x3b0ae8(0x14e));const _0x1de858={[this[_0x3b0ae8(0x13b)][_0x3b0ae8(0x10b)]]:{'lastCommit':_0x35f5a8['sha']}};await this[_0x3b0ae8(0xf4)][_0x3b0ae8(0x147)](this[_0x3b0ae8(0x120)],_0x1de858);}}async[a106_0x1a0e79(0x12e)](){const _0x29c71a=a106_0x1a0e79,_0x3cf3df=await this[_0x29c71a(0x160)]();await this[_0x29c71a(0xf4)][_0x29c71a(0x10e)](this[_0x29c71a(0x120)],_0x29c71a(0x12d)),await this[_0x29c71a(0x133)][_0x29c71a(0x10a)](_0x3cf3df,this['prefix']),await this['updateLastCommit'](),await this[_0x29c71a(0xf4)][_0x29c71a(0x10e)](this[_0x29c71a(0x120)],_0x29c71a(0x11b));}async[a106_0x1a0e79(0x130)](_0x4c1af7){const _0x70e58f=a106_0x1a0e79;try{this[_0x70e58f(0x145)]['error'](''+_0x4c1af7),await this[_0x70e58f(0x145)][_0x70e58f(0x139)](),await this[_0x70e58f(0x155)](!![]),await this[_0x70e58f(0xf4)][_0x70e58f(0x10e)](this[_0x70e58f(0x120)],'Error');}catch(_0x1d86c9){this['logger'][_0x70e58f(0x15b)](_0x1d86c9);}}async[a106_0x1a0e79(0x10a)](_0x52a630){const _0x227cb5=a106_0x1a0e79;try{this[_0x227cb5(0x152)]=_0x52a630,this[_0x227cb5(0x14b)]=typedi_1[_0x227cb5(0x11a)][_0x227cb5(0x100)](providers_tokens_1[_0x227cb5(0xfe)][_0x227cb5(0x14b)]),this[_0x227cb5(0xf8)]=typedi_1[_0x227cb5(0x11a)][_0x227cb5(0x100)](providers_tokens_1['Tokens'][_0x227cb5(0xf2)]),this['config']=typedi_1[_0x227cb5(0x11a)]['get'](providers_tokens_1['Tokens'][_0x227cb5(0x109)]),await this[_0x227cb5(0xf5)](),this[_0x227cb5(0x13b)]=await this['repoService'][_0x227cb5(0x102)](this[_0x227cb5(0x120)][_0x227cb5(0x11c)]),this[_0x227cb5(0x11f)]=await this[_0x227cb5(0x13b)]['branches'][_0x227cb5(0x102)](this[_0x227cb5(0x120)]['branchName']),this[_0x227cb5(0x145)]=typedi_1[_0x227cb5(0x11a)][_0x227cb5(0x100)](providers_tokens_1[_0x227cb5(0xfe)][_0x227cb5(0xfd)]),this[_0x227cb5(0x142)]=_0x227cb5(0x13c)+this[_0x227cb5(0x109)]['gitProvider']['toUpperCase']()+_0x227cb5(0x10c)+this[_0x227cb5(0x120)]['repositoryName']+_0x227cb5(0x136)+this[_0x227cb5(0x120)][_0x227cb5(0x122)]+_0x227cb5(0x154)+FlosumCommitJob_1[_0x227cb5(0x124)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x227cb5(0x13a))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x227cb5(0x145)][_0x227cb5(0xfb)](this[_0x227cb5(0x142)]+_0x227cb5(0x143))['send'](),await this[_0x227cb5(0x12e)]()[_0x227cb5(0x117)](_0x2fb74d=>this['handleCommitJobError'](_0x2fb74d));}catch(_0x486a0f){this[_0x227cb5(0x152)]=undefined,this[_0x227cb5(0xfd)][_0x227cb5(0x15b)](_0x486a0f);throw _0x486a0f;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a106_0x1a0e79(0x104)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1['SalesforceService'],commit_components_job_1[a106_0x1a0e79(0x101)],salesforce_sync_service_1[a106_0x1a0e79(0x135)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;