const a61_0x169476=a61_0x5646;(function(_0x7fe52e,_0x3dffd6){const _0x303333=a61_0x5646,_0x33fa83=_0x7fe52e();while(!![]){try{const _0x356a4c=-parseInt(_0x303333(0x1dd))/0x1+-parseInt(_0x303333(0x18f))/0x2*(-parseInt(_0x303333(0x1e1))/0x3)+parseInt(_0x303333(0x1b0))/0x4+-parseInt(_0x303333(0x1cc))/0x5*(parseInt(_0x303333(0x1e9))/0x6)+-parseInt(_0x303333(0x1b8))/0x7+-parseInt(_0x303333(0x193))/0x8*(-parseInt(_0x303333(0x1cd))/0x9)+parseInt(_0x303333(0x1b2))/0xa*(parseInt(_0x303333(0x1a2))/0xb);if(_0x356a4c===_0x3dffd6)break;else _0x33fa83['push'](_0x33fa83['shift']());}catch(_0x38825b){_0x33fa83['push'](_0x33fa83['shift']());}}}(a61_0x38cd,0x5d79c));function a61_0x5646(_0x219a15,_0x5cbd08){const _0xa5fbff=a61_0x38cd();return a61_0x5646=function(_0x33b916,_0x3c3e4e){_0x33b916=_0x33b916-0x185;let _0x38cdc6=_0xa5fbff[_0x33b916];return _0x38cdc6;},a61_0x5646(_0x219a15,_0x5cbd08);}const a61_0x3c3e4e=(function(){let _0x5f07fb=!![];return function(_0x5ca588,_0xe46500){const _0x30ad4d=_0x5f07fb?function(){const _0x3c88dd=a61_0x5646;if(_0xe46500){const _0x4fa273=_0xe46500[_0x3c88dd(0x1ba)](_0x5ca588,arguments);return _0xe46500=null,_0x4fa273;}}:function(){};return _0x5f07fb=![],_0x30ad4d;};}()),a61_0x33b916=a61_0x3c3e4e(this,function(){const _0xf59a62=a61_0x5646;return a61_0x33b916[_0xf59a62(0x1f0)]()['search'](_0xf59a62(0x1d9))[_0xf59a62(0x1f0)]()[_0xf59a62(0x1be)](a61_0x33b916)[_0xf59a62(0x1a7)](_0xf59a62(0x1d9));});a61_0x33b916();'use strict';var __decorate=this&&this[a61_0x169476(0x19b)]||function(_0x4b5bc5,_0x4af19b,_0x17a593,_0x51eae6){const _0x1ed439=a61_0x169476;var _0x470b3c=arguments[_0x1ed439(0x1c8)],_0x6a8aa7=_0x470b3c<0x3?_0x4af19b:_0x51eae6===null?_0x51eae6=Object[_0x1ed439(0x1b7)](_0x4af19b,_0x17a593):_0x51eae6,_0x24b6c3;if(typeof Reflect===_0x1ed439(0x1bc)&&typeof Reflect[_0x1ed439(0x1bb)]===_0x1ed439(0x1ef))_0x6a8aa7=Reflect[_0x1ed439(0x1bb)](_0x4b5bc5,_0x4af19b,_0x17a593,_0x51eae6);else{for(var _0x313503=_0x4b5bc5[_0x1ed439(0x1c8)]-0x1;_0x313503>=0x0;_0x313503--)if(_0x24b6c3=_0x4b5bc5[_0x313503])_0x6a8aa7=(_0x470b3c<0x3?_0x24b6c3(_0x6a8aa7):_0x470b3c>0x3?_0x24b6c3(_0x4af19b,_0x17a593,_0x6a8aa7):_0x24b6c3(_0x4af19b,_0x17a593))||_0x6a8aa7;}return _0x470b3c>0x3&&_0x6a8aa7&&Object['defineProperty'](_0x4af19b,_0x17a593,_0x6a8aa7),_0x6a8aa7;},__metadata=this&&this[a61_0x169476(0x1d3)]||function(_0x436dbb,_0x5c2ef3){const _0x3b11b9=a61_0x169476;if(typeof Reflect==='object'&&typeof Reflect[_0x3b11b9(0x1c4)]===_0x3b11b9(0x1ef))return Reflect['metadata'](_0x436dbb,_0x5c2ef3);},__importDefault=this&&this['__importDefault']||function(_0x2feb00){const _0x56dd0b=a61_0x169476;return _0x2feb00&&_0x2feb00[_0x56dd0b(0x1b5)]?_0x2feb00:{'default':_0x2feb00};},FlosumCommitJob_1;Object[a61_0x169476(0x197)](exports,a61_0x169476(0x1b5),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a61_0x169476(0x1ca)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a61_0x169476(0x1e4)),errors_1=require('../../../../constants/errors'),bad_request_error_1=require(a61_0x169476(0x1ad)),salesforce_retriever_service_1=require(a61_0x169476(0x1e7)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a61_0x169476(0x1d7)),commit_components_job_1=require(a61_0x169476(0x1aa)),constants_1=require(a61_0x169476(0x190)),shortid_1=__importDefault(require(a61_0x169476(0x1d1))),providers_tokens_1=require(a61_0x169476(0x1de));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x1f15ad,_0x114feb,_0x1e4fe9){const _0x228a09=a61_0x169476;this['salesforceService']=_0x1f15ad,this[_0x228a09(0x1d4)]=_0x114feb,this[_0x228a09(0x1c3)]=_0x1e4fe9,this[_0x228a09(0x1d8)]=new core_1[(_0x228a09(0x1e6))](FlosumCommitJob_1['name']);}async[a61_0x169476(0x1d6)](){const _0x386150=a61_0x169476;try{if(this['commitData'][_0x386150(0x1c6)])this[_0x386150(0x1a8)]=await this['salesforceSync'][_0x386150(0x1ae)](this[_0x386150(0x1e2)][_0x386150(0x1c6)]);else this['commitData']['syncBranchId']&&(this[_0x386150(0x1a8)]=await this[_0x386150(0x1c3)][_0x386150(0x199)](this['commitData'][_0x386150(0x1d5)]));}catch(_0x5e56df){throw new bad_request_error_1['BadRequestError'](errors_1[_0x386150(0x1c5)]);}}async['getComponentsToWrite'](){const _0x2469d7=a61_0x169476;if(!this[_0x2469d7(0x1e2)][_0x2469d7(0x1df)])return[];await this[_0x2469d7(0x18b)][_0x2469d7(0x1ea)](constants_1[_0x2469d7(0x1b3)],this[_0x2469d7(0x1e2)][_0x2469d7(0x1df)],{'Name':shortid_1['default']()});const _0x363231=await this[_0x2469d7(0x18b)][_0x2469d7(0x191)](this[_0x2469d7(0x1e2)][_0x2469d7(0x1df)])[_0x2469d7(0x18c)](_0x463b2e=>_0x463b2e[_0x2469d7(0x1da)]('\x20')[_0x2469d7(0x1bf)](_0xb79a1=>_0xb79a1[_0x2469d7(0x1b1)]()));await this[_0x2469d7(0x18b)]['deleteAttachment'](this[_0x2469d7(0x1e2)][_0x2469d7(0x1df)]);const _0x2d5fa0=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x2469d7(0x18b)]);return await _0x2d5fa0[_0x2469d7(0x1e3)](_0x363231);}async[a61_0x169476(0x189)](){const _0x53f5ae=a61_0x169476;if(!this[_0x53f5ae(0x1e2)][_0x53f5ae(0x1a6)])return[];await this[_0x53f5ae(0x18b)][_0x53f5ae(0x1ea)](constants_1[_0x53f5ae(0x1b3)],this[_0x53f5ae(0x1e2)][_0x53f5ae(0x1a6)],{'Name':shortid_1[_0x53f5ae(0x1c1)]()});const _0x2e0936=await this['salesforceService']['retrieveAttachment'](this[_0x53f5ae(0x1e2)][_0x53f5ae(0x1a6)]);return await this['salesforceService']['deleteAttachment'](this[_0x53f5ae(0x1e2)][_0x53f5ae(0x1a6)]),_0x2e0936;}async[a61_0x169476(0x194)](){const _0x515db4=a61_0x169476,_0x2d65e9=new commit_components_dto_1[(_0x515db4(0x1d0))](),[_0x1f3d26,_0x40b9b8]=await Promise[_0x515db4(0x1ec)]([this[_0x515db4(0x188)](),this[_0x515db4(0x189)]()]);return _0x2d65e9[_0x515db4(0x19e)]=this[_0x515db4(0x1e2)][_0x515db4(0x19e)],_0x2d65e9['user']=this[_0x515db4(0x1e2)]['user'],_0x2d65e9['components']={'writed':_0x1f3d26,'deleted':_0x40b9b8},_0x2d65e9['convertToSFDX']=this['config'][_0x515db4(0x18e)],_0x2d65e9[_0x515db4(0x195)]=this[_0x515db4(0x19f)],_0x2d65e9[_0x515db4(0x1c2)]=this[_0x515db4(0x1c2)],_0x2d65e9[_0x515db4(0x18d)]=this[_0x515db4(0x196)][_0x515db4(0x1c0)],_0x2d65e9;}async['updateLastCommit'](_0x320df3=![]){const _0x3a1a7f=a61_0x169476;if(_0x320df3)await this[_0x3a1a7f(0x1c3)][_0x3a1a7f(0x1b9)](this[_0x3a1a7f(0x1a8)],{});else{const _0x2dee6a=await this[_0x3a1a7f(0x19f)][_0x3a1a7f(0x1e8)]['getOne'](this[_0x3a1a7f(0x1c2)][_0x3a1a7f(0x1b6)]);this[_0x3a1a7f(0x1c7)][_0x3a1a7f(0x1a9)](this['prefix']+_0x3a1a7f(0x187));const _0x35a2de={[this['repository'][_0x3a1a7f(0x1e0)]]:{'lastCommit':_0x2dee6a[_0x3a1a7f(0x1af)]}};await this[_0x3a1a7f(0x1c3)][_0x3a1a7f(0x1b9)](this[_0x3a1a7f(0x1a8)],_0x35a2de);}}async['exec'](){const _0x6885c0=a61_0x169476,_0x179b60=await this[_0x6885c0(0x194)]();await this[_0x6885c0(0x1c3)]['setStatus'](this[_0x6885c0(0x1a8)],_0x6885c0(0x1b4)),await this['commitJob'][_0x6885c0(0x1e3)](_0x179b60,this[_0x6885c0(0x1ac)]),await this[_0x6885c0(0x1dc)](),await this[_0x6885c0(0x1c3)]['setStatus'](this['repositoryData'],_0x6885c0(0x19a));}async['handleCommitJobError'](_0x303811){const _0x5d8250=a61_0x169476;try{this[_0x5d8250(0x1c7)][_0x5d8250(0x192)](''+_0x303811),await this[_0x5d8250(0x1c7)][_0x5d8250(0x1cf)](),await this[_0x5d8250(0x1dc)](!![]),await this[_0x5d8250(0x1c3)][_0x5d8250(0x185)](this[_0x5d8250(0x1a8)],_0x5d8250(0x18a));}catch(_0x11c304){this[_0x5d8250(0x1d8)]['error'](_0x11c304);}}async[a61_0x169476(0x1e3)](_0x2a5f01){const _0x447f8a=a61_0x169476;try{this[_0x447f8a(0x1e2)]=_0x2a5f01,this[_0x447f8a(0x1e5)]=typedi_1[_0x447f8a(0x1d2)][_0x447f8a(0x186)](providers_tokens_1[_0x447f8a(0x1a0)]['gitApiService']),this[_0x447f8a(0x1a3)]=typedi_1[_0x447f8a(0x1d2)][_0x447f8a(0x186)](providers_tokens_1[_0x447f8a(0x1a0)][_0x447f8a(0x1db)]),this[_0x447f8a(0x196)]=typedi_1['Container'][_0x447f8a(0x186)](providers_tokens_1[_0x447f8a(0x1a0)][_0x447f8a(0x196)]),await this['fetchRepositoryData'](),this[_0x447f8a(0x19f)]=await this['repoService']['getOne'](this[_0x447f8a(0x1a8)][_0x447f8a(0x1a1)]),this[_0x447f8a(0x1c2)]=await this[_0x447f8a(0x19f)]['branches'][_0x447f8a(0x1ed)](this[_0x447f8a(0x1a8)]['branchName']),this[_0x447f8a(0x1c7)]=typedi_1[_0x447f8a(0x1d2)][_0x447f8a(0x186)](providers_tokens_1[_0x447f8a(0x1a0)][_0x447f8a(0x1d8)]),this['prefix']='[FLOSUM\x20->\x20GIT]\x20['+this[_0x447f8a(0x196)][_0x447f8a(0x1c0)][_0x447f8a(0x1ce)]()+_0x447f8a(0x19c)+this['repositoryData'][_0x447f8a(0x1a1)]+_0x447f8a(0x1c9)+this[_0x447f8a(0x1a8)]['branchName']+_0x447f8a(0x1cb)+FlosumCommitJob_1[_0x447f8a(0x1b6)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x447f8a(0x19d))](errors_1[_0x447f8a(0x1a5)]);await this[_0x447f8a(0x1c7)][_0x447f8a(0x1a9)](this[_0x447f8a(0x1ac)]+_0x447f8a(0x1ab))[_0x447f8a(0x1cf)](),await this['exec']()[_0x447f8a(0x1eb)](_0x283ab4=>this['handleCommitJobError'](_0x283ab4));}catch(_0x205b70){this[_0x447f8a(0x1e2)]=undefined,this[_0x447f8a(0x1d8)][_0x447f8a(0x192)](_0x205b70);throw _0x205b70;}}};function a61_0x38cd(){const _0x580bd3=['deleteAttachmentId','search','repositoryData','log','./commit-components.job','\x20Start\x20Flosum\x20commit\x20job.','prefix','../../../../core/errors/bad-request.error','getRepositoryRecord','sha','1935536kAynmM','trim','3034120TZpWUQ','FLOSUM_ATTACHMENT','In\x20Progress','__esModule','name','getOwnPropertyDescriptor','5038502LAHERz','updateRemoteState','apply','decorate','object','Service','constructor','map','gitProvider','default','branch','salesforceSync','metadata','ERR_INVALID_SYNC_RECORD_ID','syncRepositoryId','sfLogger','length',']\x20[Branch:\x20','../../../../core',']\x20[','340TPtRio','81XcpbOw','toUpperCase','send','CommitComponentsDto','shortid','Container','__metadata','commitJob','syncBranchId','fetchRepositoryData','../dto/commit-components.dto','logger','(((.+)+)+)+$','split','gitRepoService','updateLastCommit','523249KwEJqv','../../providers/providers.tokens','commitAttachmentId','gitUrl','174198GmZgOa','commitData','run','typedi','gitApiService','Logger','../../salesforce/services/salesforce-retriever.service','branches','8280qjCmYs','patchObject','catch','all','getOne','SalesforceSyncService','function','toString','setStatus','get','\x20Update\x20remote\x20state.','getComponentsToWrite','getComponentsToDelete','Error','salesforceService','then','provider','isConvertToSfdx','12mMBQno','../../../../constants','retrieveAttachment','error','249464LUQOJE','getCommitDto','repo','config','defineProperty','SalesforceService','getBranchRecord','Completed','__decorate',']\x20[Repository:\x20','BadRequestError','message','repository','Tokens','repositoryName','22kcjSnR','repoService','FlosumCommitJob','ERR_UNKNOWN_SYNC_RECORD_ID'];a61_0x38cd=function(){return _0x580bd3;};return a61_0x38cd();}FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1[a61_0x169476(0x1bd)]({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a61_0x169476(0x198)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a61_0x169476(0x1ee)]])],FlosumCommitJob),exports[a61_0x169476(0x1a4)]=FlosumCommitJob;