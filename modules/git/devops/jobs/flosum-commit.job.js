const a61_0x28bf22=a61_0x4634;(function(_0x5e53a4,_0x43a9f9){const _0x1e03d5=a61_0x4634,_0x5171e0=_0x5e53a4();while(!![]){try{const _0x503fc6=parseInt(_0x1e03d5(0x182))/0x1*(parseInt(_0x1e03d5(0x149))/0x2)+parseInt(_0x1e03d5(0x156))/0x3*(parseInt(_0x1e03d5(0x12f))/0x4)+parseInt(_0x1e03d5(0x196))/0x5+-parseInt(_0x1e03d5(0x13a))/0x6*(parseInt(_0x1e03d5(0x15e))/0x7)+parseInt(_0x1e03d5(0x14c))/0x8*(-parseInt(_0x1e03d5(0x187))/0x9)+parseInt(_0x1e03d5(0x16d))/0xa*(parseInt(_0x1e03d5(0x18c))/0xb)+-parseInt(_0x1e03d5(0x133))/0xc*(parseInt(_0x1e03d5(0x14e))/0xd);if(_0x503fc6===_0x43a9f9)break;else _0x5171e0['push'](_0x5171e0['shift']());}catch(_0x1b5708){_0x5171e0['push'](_0x5171e0['shift']());}}}(a61_0xa1ce,0x2187d));const a61_0x4fee08=(function(){let _0x32a57e=!![];return function(_0x7ad156,_0x5e3e26){const _0x3a7d44=_0x32a57e?function(){const _0x50e2fb=a61_0x4634;if(_0x5e3e26){const _0x4d3a6a=_0x5e3e26[_0x50e2fb(0x160)](_0x7ad156,arguments);return _0x5e3e26=null,_0x4d3a6a;}}:function(){};return _0x32a57e=![],_0x3a7d44;};}()),a61_0x58e80c=a61_0x4fee08(this,function(){const _0x851030=a61_0x4634;return a61_0x58e80c[_0x851030(0x197)]()[_0x851030(0x189)](_0x851030(0x13b))['toString']()[_0x851030(0x138)](a61_0x58e80c)[_0x851030(0x189)](_0x851030(0x13b));});a61_0x58e80c();'use strict';var __decorate=this&&this['__decorate']||function(_0x36717e,_0x4a26d5,_0x689171,_0x4c941a){const _0x349e43=a61_0x4634;var _0x50abb4=arguments[_0x349e43(0x17c)],_0x5e8e5c=_0x50abb4<0x3?_0x4a26d5:_0x4c941a===null?_0x4c941a=Object['getOwnPropertyDescriptor'](_0x4a26d5,_0x689171):_0x4c941a,_0x3aacd9;if(typeof Reflect===_0x349e43(0x162)&&typeof Reflect[_0x349e43(0x195)]===_0x349e43(0x14b))_0x5e8e5c=Reflect['decorate'](_0x36717e,_0x4a26d5,_0x689171,_0x4c941a);else{for(var _0x104c06=_0x36717e[_0x349e43(0x17c)]-0x1;_0x104c06>=0x0;_0x104c06--)if(_0x3aacd9=_0x36717e[_0x104c06])_0x5e8e5c=(_0x50abb4<0x3?_0x3aacd9(_0x5e8e5c):_0x50abb4>0x3?_0x3aacd9(_0x4a26d5,_0x689171,_0x5e8e5c):_0x3aacd9(_0x4a26d5,_0x689171))||_0x5e8e5c;}return _0x50abb4>0x3&&_0x5e8e5c&&Object['defineProperty'](_0x4a26d5,_0x689171,_0x5e8e5c),_0x5e8e5c;},__metadata=this&&this['__metadata']||function(_0x24e671,_0x206a3f){const _0x5b5b88=a61_0x4634;if(typeof Reflect===_0x5b5b88(0x162)&&typeof Reflect[_0x5b5b88(0x139)]===_0x5b5b88(0x14b))return Reflect['metadata'](_0x24e671,_0x206a3f);},__importDefault=this&&this['__importDefault']||function(_0x5d3827){const _0x20b0bb=a61_0x4634;return _0x5d3827&&_0x5d3827[_0x20b0bb(0x184)]?_0x5d3827:{'default':_0x5d3827};},FlosumCommitJob_1;Object[a61_0x28bf22(0x175)](exports,a61_0x28bf22(0x184),{'value':!![]}),exports[a61_0x28bf22(0x16e)]=void 0x0;const core_1=require(a61_0x28bf22(0x145)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a61_0x28bf22(0x185)),errors_1=require(a61_0x28bf22(0x13d)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a61_0x28bf22(0x18f)),salesforce_sync_service_1=require(a61_0x28bf22(0x161)),commit_components_dto_1=require(a61_0x28bf22(0x15b)),commit_components_job_1=require(a61_0x28bf22(0x14a)),constants_1=require(a61_0x28bf22(0x194)),shortid_1=__importDefault(require(a61_0x28bf22(0x13f))),providers_tokens_1=require(a61_0x28bf22(0x159));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x74d354,_0x261073,_0x971819){const _0x3c10d6=a61_0x28bf22;this['salesforceService']=_0x74d354,this[_0x3c10d6(0x17e)]=_0x261073,this['salesforceSync']=_0x971819,this[_0x3c10d6(0x176)]=new core_1['Logger'](FlosumCommitJob_1['name']);}async['fetchRepositoryData'](){const _0x40a20f=a61_0x28bf22;try{if(this['commitData'][_0x40a20f(0x17a)])this[_0x40a20f(0x167)]=await this['salesforceSync'][_0x40a20f(0x183)](this[_0x40a20f(0x169)][_0x40a20f(0x17a)]);else this[_0x40a20f(0x169)][_0x40a20f(0x154)]&&(this[_0x40a20f(0x167)]=await this[_0x40a20f(0x142)]['getBranchRecord'](this[_0x40a20f(0x169)]['syncBranchId']));}catch(_0x2e08d9){throw new bad_request_error_1[(_0x40a20f(0x191))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a61_0x28bf22(0x153)](){const _0x25f8a0=a61_0x28bf22;if(!this[_0x25f8a0(0x169)][_0x25f8a0(0x146)])return[];await this['salesforceService']['patchObject'](constants_1[_0x25f8a0(0x135)],this[_0x25f8a0(0x169)][_0x25f8a0(0x146)],{'Name':shortid_1[_0x25f8a0(0x16a)]()});const _0x57ca22=await this[_0x25f8a0(0x173)][_0x25f8a0(0x174)](this['commitData'][_0x25f8a0(0x146)])[_0x25f8a0(0x163)](_0x237cc0=>_0x237cc0['split']('\x20')['map'](_0x3eeb38=>_0x3eeb38[_0x25f8a0(0x16b)]()));await this[_0x25f8a0(0x173)]['deleteAttachment'](this[_0x25f8a0(0x169)]['commitAttachmentId']);const _0x4621ed=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x25f8a0(0x173)]);return await _0x4621ed[_0x25f8a0(0x137)](_0x57ca22);}async[a61_0x28bf22(0x177)](){const _0x15bfb2=a61_0x28bf22;if(!this[_0x15bfb2(0x169)][_0x15bfb2(0x18b)])return[];await this['salesforceService'][_0x15bfb2(0x131)](constants_1[_0x15bfb2(0x135)],this[_0x15bfb2(0x169)]['deleteAttachmentId'],{'Name':shortid_1['default']()});const _0x284fe0=await this[_0x15bfb2(0x173)]['retrieveAttachment'](this[_0x15bfb2(0x169)][_0x15bfb2(0x18b)]);return await this[_0x15bfb2(0x173)][_0x15bfb2(0x170)](this['commitData'][_0x15bfb2(0x18b)]),_0x284fe0;}async[a61_0x28bf22(0x16f)](){const _0x4a1dc1=a61_0x28bf22,_0x52ea43=new commit_components_dto_1[(_0x4a1dc1(0x17d))](),[_0x5034af,_0x2b5e1a]=await Promise[_0x4a1dc1(0x180)]([this[_0x4a1dc1(0x153)](),this['getComponentsToDelete']()]);return _0x52ea43[_0x4a1dc1(0x164)]=this[_0x4a1dc1(0x169)][_0x4a1dc1(0x164)],_0x52ea43[_0x4a1dc1(0x143)]=this[_0x4a1dc1(0x169)][_0x4a1dc1(0x143)],_0x52ea43[_0x4a1dc1(0x158)]={'writed':_0x5034af,'deleted':_0x2b5e1a},_0x52ea43[_0x4a1dc1(0x17f)]=this[_0x4a1dc1(0x14f)][_0x4a1dc1(0x171)],_0x52ea43[_0x4a1dc1(0x151)]=this[_0x4a1dc1(0x15d)],_0x52ea43[_0x4a1dc1(0x148)]=this[_0x4a1dc1(0x148)],_0x52ea43[_0x4a1dc1(0x150)]=this[_0x4a1dc1(0x14f)][_0x4a1dc1(0x186)],_0x52ea43;}async['updateLastCommit'](_0x5c938c=![]){const _0x175480=a61_0x28bf22;if(_0x5c938c)await this[_0x175480(0x142)]['updateRemoteState'](this[_0x175480(0x167)],{});else{const _0x5c9936=await this['repository'][_0x175480(0x168)][_0x175480(0x136)](this[_0x175480(0x148)][_0x175480(0x18d)]);this[_0x175480(0x130)]['log'](this[_0x175480(0x172)]+_0x175480(0x178));const _0x57b2c4={[this[_0x175480(0x15d)][_0x175480(0x144)]]:{'lastCommit':_0x5c9936['sha']}};await this[_0x175480(0x142)][_0x175480(0x141)](this['repositoryData'],_0x57b2c4);}}async[a61_0x28bf22(0x13e)](){const _0x5912cf=a61_0x28bf22,_0x3fb438=await this[_0x5912cf(0x16f)]();await this[_0x5912cf(0x142)]['setStatus'](this[_0x5912cf(0x167)],_0x5912cf(0x152)),await this['commitJob']['run'](_0x3fb438,this['prefix']),await this[_0x5912cf(0x18a)](),await this[_0x5912cf(0x142)][_0x5912cf(0x16c)](this[_0x5912cf(0x167)],_0x5912cf(0x155));}async[a61_0x28bf22(0x13c)](_0x2e5c79){const _0x53cc1c=a61_0x28bf22;try{this[_0x53cc1c(0x130)][_0x53cc1c(0x147)](''+_0x2e5c79),await this['sfLogger'][_0x53cc1c(0x179)](),await this[_0x53cc1c(0x18a)](!![]),await this[_0x53cc1c(0x142)][_0x53cc1c(0x16c)](this[_0x53cc1c(0x167)],_0x53cc1c(0x15f));}catch(_0x2043a9){this[_0x53cc1c(0x176)]['error'](_0x2043a9);}}async['run'](_0x314990){const _0x260338=a61_0x28bf22;try{this['commitData']=_0x314990,this['gitApiService']=typedi_1['Container'][_0x260338(0x157)](providers_tokens_1['Tokens']['gitApiService']),this['repoService']=typedi_1[_0x260338(0x188)]['get'](providers_tokens_1['Tokens'][_0x260338(0x132)]),this[_0x260338(0x14f)]=typedi_1[_0x260338(0x188)][_0x260338(0x157)](providers_tokens_1[_0x260338(0x140)][_0x260338(0x14f)]),await this[_0x260338(0x17b)](),this[_0x260338(0x15d)]=await this['repoService']['getOne'](this[_0x260338(0x167)]['repositoryName']),this['branch']=await this['repository']['branches']['getOne'](this[_0x260338(0x167)][_0x260338(0x199)]),this[_0x260338(0x130)]=typedi_1[_0x260338(0x188)][_0x260338(0x157)](providers_tokens_1['Tokens']['logger']),this[_0x260338(0x172)]=_0x260338(0x15c)+this[_0x260338(0x14f)][_0x260338(0x186)]['toUpperCase']()+_0x260338(0x18e)+this['repositoryData']['repositoryName']+_0x260338(0x193)+this['repositoryData'][_0x260338(0x199)]+_0x260338(0x190)+FlosumCommitJob_1[_0x260338(0x18d)]+']';if(!this[_0x260338(0x167)])throw new bad_request_error_1[(_0x260338(0x191))](errors_1[_0x260338(0x165)]);await this[_0x260338(0x130)][_0x260338(0x134)](this[_0x260338(0x172)]+_0x260338(0x198))[_0x260338(0x179)](),await this['exec']()[_0x260338(0x15a)](_0xaaa20c=>this[_0x260338(0x13c)](_0xaaa20c));}catch(_0x5ad08b){this['commitData']=undefined,this[_0x260338(0x176)][_0x260338(0x147)](_0x5ad08b);throw _0x5ad08b;}}};function a61_0xa1ce(){const _0x23cf07=['commitData','default','trim','setStatus','20BcFMop','FlosumCommitJob','getCommitDto','deleteAttachment','isConvertToSfdx','prefix','salesforceService','retrieveAttachment','defineProperty','logger','getComponentsToDelete','\x20Update\x20remote\x20state.','send','syncRepositoryId','fetchRepositoryData','length','CommitComponentsDto','commitJob','convertToSFDX','all','SalesforceSyncService','25RPZYbK','getRepositoryRecord','__esModule','typedi','gitProvider','712809NtZoJL','Container','search','updateLastCommit','deleteAttachmentId','416779BMUOcM','name',']\x20[Repository:\x20','../../salesforce/services/salesforce-retriever.service',']\x20[','BadRequestError','design:paramtypes',']\x20[Branch:\x20','../../../../constants','decorate','1339820TBqAVm','toString','\x20Start\x20Flosum\x20commit\x20job.','branchName','135328mSZdhp','sfLogger','patchObject','gitRepoService','744vDLuBp','log','FLOSUM_ATTACHMENT','getOne','run','constructor','metadata','42hLHzCQ','(((.+)+)+)+$','handleCommitJobError','../../../../constants/errors','exec','shortid','Tokens','updateRemoteState','salesforceSync','user','gitUrl','../../../../core','commitAttachmentId','error','branch','6610iDHmrA','./commit-components.job','function','8jyQaJN','SalesforceService','74737jbeLSx','config','provider','repo','In\x20Progress','getComponentsToWrite','syncBranchId','Completed','15uiqNFX','get','components','../../providers/providers.tokens','catch','../dto/commit-components.dto','[FLOSUM\x20->\x20GIT]\x20[','repository','22547Vxfsgj','Error','apply','../../salesforce/services/salesforce-sync.service','object','then','message','ERR_UNKNOWN_SYNC_RECORD_ID','CommitComponentsJob','repositoryData','branches'];a61_0xa1ce=function(){return _0x23cf07;};return a61_0xa1ce();}function a61_0x4634(_0x2fb9f5,_0x221b3a){const _0x139cf2=a61_0xa1ce();return a61_0x4634=function(_0x58e80c,_0x4fee08){_0x58e80c=_0x58e80c-0x12f;let _0xa1ce30=_0x139cf2[_0x58e80c];return _0xa1ce30;},a61_0x4634(_0x2fb9f5,_0x221b3a);}FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a61_0x28bf22(0x192),[salesforce_service_1[a61_0x28bf22(0x14d)],commit_components_job_1[a61_0x28bf22(0x166)],salesforce_sync_service_1[a61_0x28bf22(0x181)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;