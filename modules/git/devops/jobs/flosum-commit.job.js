const a125_0x455f0b=a125_0x5b0c;(function(_0x3909c6,_0x2c1594){const _0x4c4c63=a125_0x5b0c,_0x1d7f4f=_0x3909c6();while(!![]){try{const _0x5040eb=-parseInt(_0x4c4c63(0x1ae))/0x1*(-parseInt(_0x4c4c63(0x1dd))/0x2)+parseInt(_0x4c4c63(0x1a9))/0x3*(parseInt(_0x4c4c63(0x1dc))/0x4)+parseInt(_0x4c4c63(0x197))/0x5*(-parseInt(_0x4c4c63(0x1e8))/0x6)+parseInt(_0x4c4c63(0x1d1))/0x7*(-parseInt(_0x4c4c63(0x1b9))/0x8)+parseInt(_0x4c4c63(0x1a3))/0x9*(-parseInt(_0x4c4c63(0x1d7))/0xa)+parseInt(_0x4c4c63(0x196))/0xb+-parseInt(_0x4c4c63(0x1a0))/0xc;if(_0x5040eb===_0x2c1594)break;else _0x1d7f4f['push'](_0x1d7f4f['shift']());}catch(_0x29f7cc){_0x1d7f4f['push'](_0x1d7f4f['shift']());}}}(a125_0x4944,0x9d93e));const a125_0xf5cea5=(function(){let _0x1bfb0c=!![];return function(_0x3381f6,_0x268f85){const _0x428183=_0x1bfb0c?function(){const _0x3f3cbe=a125_0x5b0c;if(_0x268f85){const _0x441126=_0x268f85[_0x3f3cbe(0x20a)](_0x3381f6,arguments);return _0x268f85=null,_0x441126;}}:function(){};return _0x1bfb0c=![],_0x428183;};}()),a125_0x4ba3d5=a125_0xf5cea5(this,function(){const _0xb727be=a125_0x5b0c;return a125_0x4ba3d5[_0xb727be(0x1c5)]()[_0xb727be(0x1fa)]('(((.+)+)+)+$')[_0xb727be(0x1c5)]()['constructor'](a125_0x4ba3d5)[_0xb727be(0x1fa)](_0xb727be(0x1d9));});a125_0x4ba3d5();'use strict';var __decorate=this&&this['__decorate']||function(_0x27a553,_0x17de47,_0x2ac45f,_0x5ec35d){const _0x53a11f=a125_0x5b0c;var _0x554b64=arguments['length'],_0x5df536=_0x554b64<0x3?_0x17de47:_0x5ec35d===null?_0x5ec35d=Object['getOwnPropertyDescriptor'](_0x17de47,_0x2ac45f):_0x5ec35d,_0x469338;if(typeof Reflect===_0x53a11f(0x199)&&typeof Reflect[_0x53a11f(0x1ea)]==='function')_0x5df536=Reflect[_0x53a11f(0x1ea)](_0x27a553,_0x17de47,_0x2ac45f,_0x5ec35d);else{for(var _0x47e6f0=_0x27a553[_0x53a11f(0x1d3)]-0x1;_0x47e6f0>=0x0;_0x47e6f0--)if(_0x469338=_0x27a553[_0x47e6f0])_0x5df536=(_0x554b64<0x3?_0x469338(_0x5df536):_0x554b64>0x3?_0x469338(_0x17de47,_0x2ac45f,_0x5df536):_0x469338(_0x17de47,_0x2ac45f))||_0x5df536;}return _0x554b64>0x3&&_0x5df536&&Object[_0x53a11f(0x1e6)](_0x17de47,_0x2ac45f,_0x5df536),_0x5df536;},__metadata=this&&this[a125_0x455f0b(0x1e1)]||function(_0xaabc6e,_0x5c210e){const _0x2ded30=a125_0x455f0b;if(typeof Reflect===_0x2ded30(0x199)&&typeof Reflect['metadata']==='function')return Reflect[_0x2ded30(0x1b8)](_0xaabc6e,_0x5c210e);},__importDefault=this&&this[a125_0x455f0b(0x1ca)]||function(_0xf86de0){return _0xf86de0&&_0xf86de0['__esModule']?_0xf86de0:{'default':_0xf86de0};},FlosumCommitJob_1;function a125_0x5b0c(_0x19c56b,_0x13c953){const _0x52af6e=a125_0x4944();return a125_0x5b0c=function(_0x4ba3d5,_0xf5cea5){_0x4ba3d5=_0x4ba3d5-0x194;let _0x494428=_0x52af6e[_0x4ba3d5];return _0x494428;},a125_0x5b0c(_0x19c56b,_0x13c953);}Object['defineProperty'](exports,a125_0x455f0b(0x201),{'value':!![]}),exports[a125_0x455f0b(0x19b)]=void 0x0;function a125_0x4944(){const _0x2f1b58=['catch','4cdPIhG','106NymdcC','updateRemoteState','patchObject','salesforceService','__metadata','components','get','BadRequestError','gitUrl','defineProperty','FLOSUM_ATTACHMENT','1542pmLsio','In\x20Progress','decorate','[FLOSUM\x20->\x20GIT]\x20[','../../providers/providers.tokens','recordType','../../../../constants/errors','CommitComponentsJob','then','CommitToGitErrorNotification','handleCommitJobError','setStatus','repositoryName','name','repoService','branchName',']\x20[Repository:\x20','SalesforceSyncService','search','../../salesforce/services/salesforce-retriever.service','email','execute','fetchRepositoryData','retrieveAttachment','getComponentsToDelete','__esModule',']\x20[','isEmailNotificationsEnabled','sha','getOne','logger','SalesforceService','getCommitDto','isConvertToSfdx','apply','gitApiService','branches','9681562jgceQa','14745SKwFoh','toUpperCase','object','default','FlosumCommitJob','gitProvider','./commit-components.job','CommitToGitCompletedNotification','commitJob','6104652UMXyNo','salesforceSync','Email\x20notifications\x20are\x20disabled.','18KCDNtW','send','../../salesforce/services/salesforce-sync.service','all','syncBranchId','\x20Update\x20remote\x20state.','3063591KuCVJq','ERR_INVALID_SYNC_RECORD_ID','config','info','branch','8521qwWIYR','map','Tokens','message','\x20Start\x20Flosum\x20commit\x20job.','Container','updateLastCommit','design:paramtypes','Service','syncRepositoryId','metadata','1594936FGSfVT','typedi','SalesforceRetrieverService','shortid','exec','log','Completed','../../../../core','error','../../salesforce/services/salesforce.service','repositoryData','deleteAttachmentId','toString','repository','sfLogger','convertToSFDX','split','__importDefault','commitData','user','prefix','commitAttachmentId','deleteAttachment','run','14WJQGvs','errorNotification','length','../../../../constants','getRepositoryRecord','Error','210830fcrIsY','completeNotification','(((.+)+)+)+$','repo'];a125_0x4944=function(){return _0x2f1b58;};return a125_0x4944();}const core_1=require(a125_0x455f0b(0x1c0)),salesforce_service_1=require(a125_0x455f0b(0x1c2)),typedi_1=require(a125_0x455f0b(0x1ba)),errors_1=require(a125_0x455f0b(0x1ee)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a125_0x455f0b(0x1fb)),salesforce_sync_service_1=require(a125_0x455f0b(0x1a5)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a125_0x455f0b(0x19d)),constants_1=require(a125_0x455f0b(0x1d4)),shortid_1=__importDefault(require(a125_0x455f0b(0x1bc))),providers_tokens_1=require(a125_0x455f0b(0x1ec)),commit_to_git_completed_notification_1=require('../../notifications/commit-to-git-completed.notification'),commit_to_git_error_notification_1=require('../../notifications/commit-to-git-error.notification');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x31fde8,_0x19603b,_0x4af346){const _0x5258a3=a125_0x455f0b;this['salesforceService']=_0x31fde8,this[_0x5258a3(0x19f)]=_0x19603b,this[_0x5258a3(0x1a1)]=_0x4af346,this['logger']=new core_1['Logger'](FlosumCommitJob_1['name']);}async[a125_0x455f0b(0x1d8)](_0x5337df,_0x4a0538,_0x95b87f,_0xaf81b8){const _0x2e16e5=a125_0x455f0b;if(!this['commitData'][_0x2e16e5(0x203)]){this[_0x2e16e5(0x206)][_0x2e16e5(0x1ac)](_0x2e16e5(0x1a2));return;}await new commit_to_git_completed_notification_1['CommitToGitCompletedNotification']({'emails':_0x5337df,'gitProvider':_0x4a0538,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1[_0x2e16e5(0x19e)][_0x2e16e5(0x1f5)],'repositoryName':_0x95b87f,'branchName':_0xaf81b8})[_0x2e16e5(0x1fd)]();}async[a125_0x455f0b(0x1d2)](_0xf35928,_0x239c3f,_0x14df17,_0x5f05ae){const _0x83f1f0=a125_0x455f0b;if(!this['commitData']['isEmailNotificationsEnabled']){this[_0x83f1f0(0x206)][_0x83f1f0(0x1ac)](_0x83f1f0(0x1a2));return;}await new commit_to_git_error_notification_1[(_0x83f1f0(0x1f1))]({'emails':_0xf35928,'gitProvider':_0x239c3f,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1['CommitToGitErrorNotification'][_0x83f1f0(0x1f5)],'repositoryName':_0x14df17,'branchName':_0x5f05ae})['execute']();}async[a125_0x455f0b(0x1fe)](){const _0x50cf02=a125_0x455f0b;try{if(this['commitData'][_0x50cf02(0x1b7)])this[_0x50cf02(0x1c3)]=await this[_0x50cf02(0x1a1)][_0x50cf02(0x1d5)](this[_0x50cf02(0x1cb)][_0x50cf02(0x1b7)]);else this['commitData']['syncBranchId']&&(this['repositoryData']=await this['salesforceSync']['getBranchRecord'](this[_0x50cf02(0x1cb)][_0x50cf02(0x1a7)]));}catch(_0x37f853){throw new bad_request_error_1[(_0x50cf02(0x1e4))](errors_1[_0x50cf02(0x1aa)]);}}async['getComponentsToWrite'](){const _0x1d6741=a125_0x455f0b;if(!this[_0x1d6741(0x1cb)][_0x1d6741(0x1ce)])return[];await this[_0x1d6741(0x1e0)][_0x1d6741(0x1df)](constants_1[_0x1d6741(0x1e7)],this['commitData'][_0x1d6741(0x1ce)],{'Name':(0x0,shortid_1[_0x1d6741(0x19a)])()});const _0x2ae952=await this[_0x1d6741(0x1e0)][_0x1d6741(0x1ff)](this[_0x1d6741(0x1cb)][_0x1d6741(0x1ce)])[_0x1d6741(0x1f0)](_0x40eb2f=>_0x40eb2f[_0x1d6741(0x1c9)]('\x20')[_0x1d6741(0x1af)](_0x2424c6=>_0x2424c6['trim']()));await this['salesforceService']['deleteAttachment'](this[_0x1d6741(0x1cb)][_0x1d6741(0x1ce)]);const _0x28a119=new salesforce_retriever_service_1[(_0x1d6741(0x1bb))](this[_0x1d6741(0x1e0)]);return await _0x28a119[_0x1d6741(0x1d0)](_0x2ae952);}async[a125_0x455f0b(0x200)](){const _0x52eb06=a125_0x455f0b;if(!this[_0x52eb06(0x1cb)]['deleteAttachmentId'])return[];await this[_0x52eb06(0x1e0)]['patchObject'](constants_1[_0x52eb06(0x1e7)],this['commitData'][_0x52eb06(0x1c4)],{'Name':(0x0,shortid_1[_0x52eb06(0x19a)])()});const _0xd69bea=await this[_0x52eb06(0x1e0)][_0x52eb06(0x1ff)](this[_0x52eb06(0x1cb)][_0x52eb06(0x1c4)]),_0x43ecf6=JSON['parse'](_0xd69bea);return await this[_0x52eb06(0x1e0)][_0x52eb06(0x1cf)](this['commitData']['deleteAttachmentId']),_0x43ecf6;}async[a125_0x455f0b(0x208)](){const _0x1c0df9=a125_0x455f0b,_0x261ae4=new commit_components_dto_1['CommitComponentsDto'](),[_0x7634bc,_0x153a33]=await Promise[_0x1c0df9(0x1a6)]([this['getComponentsToWrite'](),this[_0x1c0df9(0x200)]()]);return _0x261ae4['message']=this[_0x1c0df9(0x1cb)][_0x1c0df9(0x1b1)],_0x261ae4[_0x1c0df9(0x1cc)]=this[_0x1c0df9(0x1cb)][_0x1c0df9(0x1cc)],_0x261ae4[_0x1c0df9(0x1e2)]={'writed':_0x7634bc,'deleted':_0x153a33},_0x261ae4[_0x1c0df9(0x1c8)]=this[_0x1c0df9(0x1ab)][_0x1c0df9(0x209)],_0x261ae4[_0x1c0df9(0x1da)]=this['repository'],_0x261ae4['branch']=this[_0x1c0df9(0x1ad)],_0x261ae4['provider']=this[_0x1c0df9(0x1ab)][_0x1c0df9(0x19c)],_0x261ae4[_0x1c0df9(0x1ed)]=this['repositoryData']['recordTypeName'],_0x261ae4;}async[a125_0x455f0b(0x1b4)](_0x503bf5=![]){const _0x528650=a125_0x455f0b;if(_0x503bf5)await this['salesforceSync'][_0x528650(0x1de)](this['repositoryData'],{});else{const _0x55ac11=await this[_0x528650(0x1c6)][_0x528650(0x195)]['getOne'](this['branch'][_0x528650(0x1f5)]);this[_0x528650(0x1c7)][_0x528650(0x1be)](this[_0x528650(0x1cd)]+_0x528650(0x1a8));const _0x25d0b3={[this['repository'][_0x528650(0x1e5)]]:{'lastCommit':_0x55ac11[_0x528650(0x204)]}};await this[_0x528650(0x1a1)][_0x528650(0x1de)](this[_0x528650(0x1c3)],_0x25d0b3);}}async[a125_0x455f0b(0x1bd)](){const _0x409c0e=a125_0x455f0b,_0x688090=await this[_0x409c0e(0x208)]();await this[_0x409c0e(0x1a1)][_0x409c0e(0x1f3)](this[_0x409c0e(0x1c3)],_0x409c0e(0x1e9)),await this[_0x409c0e(0x19f)]['run'](_0x688090,this[_0x409c0e(0x1cd)]),await this[_0x409c0e(0x1b4)](),await this['salesforceSync'][_0x409c0e(0x1f3)](this[_0x409c0e(0x1c3)],_0x409c0e(0x1bf));}async[a125_0x455f0b(0x1f2)](_0x17bc5a){const _0x5557f2=a125_0x455f0b;try{this[_0x5557f2(0x1c7)][_0x5557f2(0x1c1)](''+_0x17bc5a),await this[_0x5557f2(0x1c7)][_0x5557f2(0x1a4)](),await this[_0x5557f2(0x1b4)](!![]),await this['salesforceSync'][_0x5557f2(0x1f3)](this['repositoryData'],_0x5557f2(0x1d6)),await this[_0x5557f2(0x1d8)]([this[_0x5557f2(0x1cb)]['user'][_0x5557f2(0x1fc)]],this[_0x5557f2(0x1ab)][_0x5557f2(0x19c)],this[_0x5557f2(0x1c6)][_0x5557f2(0x1f5)],this[_0x5557f2(0x1ad)][_0x5557f2(0x1f5)]);}catch(_0x5c2f37){this['logger'][_0x5557f2(0x1c1)](_0x5c2f37),await this[_0x5557f2(0x1d2)]([this['commitData']['user'][_0x5557f2(0x1fc)]],this[_0x5557f2(0x1ab)]['gitProvider'],this[_0x5557f2(0x1c6)][_0x5557f2(0x1f5)],this[_0x5557f2(0x1ad)][_0x5557f2(0x1f5)]);}}async['run'](_0x1fea7e){const _0x10d8a0=a125_0x455f0b;try{this[_0x10d8a0(0x1cb)]=_0x1fea7e,this[_0x10d8a0(0x194)]=typedi_1[_0x10d8a0(0x1b3)][_0x10d8a0(0x1e3)](providers_tokens_1[_0x10d8a0(0x1b0)]['gitApiService']),this[_0x10d8a0(0x1f6)]=typedi_1[_0x10d8a0(0x1b3)]['get'](providers_tokens_1[_0x10d8a0(0x1b0)]['gitRepoService']),this[_0x10d8a0(0x1ab)]=typedi_1['Container'][_0x10d8a0(0x1e3)](providers_tokens_1[_0x10d8a0(0x1b0)]['config']),await this[_0x10d8a0(0x1fe)](),this[_0x10d8a0(0x1c6)]=await this[_0x10d8a0(0x1f6)][_0x10d8a0(0x205)](this['repositoryData'][_0x10d8a0(0x1f4)]),this[_0x10d8a0(0x1ad)]=await this[_0x10d8a0(0x1c6)][_0x10d8a0(0x195)][_0x10d8a0(0x205)](this[_0x10d8a0(0x1c3)][_0x10d8a0(0x1f7)]),this['sfLogger']=typedi_1[_0x10d8a0(0x1b3)][_0x10d8a0(0x1e3)](providers_tokens_1[_0x10d8a0(0x1b0)]['logger']),this['prefix']=_0x10d8a0(0x1eb)+this[_0x10d8a0(0x1ab)][_0x10d8a0(0x19c)][_0x10d8a0(0x198)]()+_0x10d8a0(0x1f8)+this['repositoryData'][_0x10d8a0(0x1f4)]+']\x20[Branch:\x20'+this[_0x10d8a0(0x1c3)][_0x10d8a0(0x1f7)]+_0x10d8a0(0x202)+FlosumCommitJob_1[_0x10d8a0(0x1f5)]+']';if(!this[_0x10d8a0(0x1c3)])throw new bad_request_error_1[(_0x10d8a0(0x1e4))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x10d8a0(0x1c7)]['log'](this[_0x10d8a0(0x1cd)]+_0x10d8a0(0x1b2))[_0x10d8a0(0x1a4)](),await this[_0x10d8a0(0x1bd)]()[_0x10d8a0(0x1db)](_0x68823e=>this[_0x10d8a0(0x1f2)](_0x68823e)),await this['completeNotification']([this[_0x10d8a0(0x1cb)]['user'][_0x10d8a0(0x1fc)]],this['config'][_0x10d8a0(0x19c)],this[_0x10d8a0(0x1c6)][_0x10d8a0(0x1f5)],this[_0x10d8a0(0x1ad)][_0x10d8a0(0x1f5)]);}catch(_0x274e45){this[_0x10d8a0(0x1cb)]=undefined,this[_0x10d8a0(0x206)]['error'](_0x274e45),await this[_0x10d8a0(0x1d2)]([this[_0x10d8a0(0x1cb)][_0x10d8a0(0x1cc)][_0x10d8a0(0x1fc)]],this[_0x10d8a0(0x1ab)][_0x10d8a0(0x19c)],this[_0x10d8a0(0x1c6)][_0x10d8a0(0x1f5)],this['branch'][_0x10d8a0(0x1f5)]);throw _0x274e45;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a125_0x455f0b(0x1b6)])({'transient':!![]}),__metadata(a125_0x455f0b(0x1b5),[salesforce_service_1[a125_0x455f0b(0x207)],commit_components_job_1[a125_0x455f0b(0x1ef)],salesforce_sync_service_1[a125_0x455f0b(0x1f9)]])],FlosumCommitJob),exports[a125_0x455f0b(0x19b)]=FlosumCommitJob;