const a74_0x56dea4=a74_0x455f;(function(_0x4e975f,_0x11f890){const _0x591606=a74_0x455f,_0x13ac0b=_0x4e975f();while(!![]){try{const _0xe42a20=parseInt(_0x591606(0x149))/0x1+parseInt(_0x591606(0xf7))/0x2*(parseInt(_0x591606(0x10a))/0x3)+-parseInt(_0x591606(0x125))/0x4+parseInt(_0x591606(0x115))/0x5*(-parseInt(_0x591606(0x10c))/0x6)+-parseInt(_0x591606(0x152))/0x7+parseInt(_0x591606(0x132))/0x8+parseInt(_0x591606(0xec))/0x9*(parseInt(_0x591606(0x143))/0xa);if(_0xe42a20===_0x11f890)break;else _0x13ac0b['push'](_0x13ac0b['shift']());}catch(_0xf26bc9){_0x13ac0b['push'](_0x13ac0b['shift']());}}}(a74_0x4139,0xe07fc));const a74_0x30a5ea=(function(){let _0x26b732=!![];return function(_0x372cb6,_0x4ad3f9){const _0x14e2eb=_0x26b732?function(){const _0x202fbe=a74_0x455f;if(_0x4ad3f9){const _0x47727b=_0x4ad3f9[_0x202fbe(0x104)](_0x372cb6,arguments);return _0x4ad3f9=null,_0x47727b;}}:function(){};return _0x26b732=![],_0x14e2eb;};}()),a74_0x9a7c1=a74_0x30a5ea(this,function(){const _0x44f716=a74_0x455f;return a74_0x9a7c1[_0x44f716(0xfc)]()[_0x44f716(0x13c)](_0x44f716(0x111))[_0x44f716(0xfc)]()[_0x44f716(0x102)](a74_0x9a7c1)[_0x44f716(0x13c)](_0x44f716(0x111));});a74_0x9a7c1();function a74_0x455f(_0x172768,_0x4bcdc9){const _0x15b4f3=a74_0x4139();return a74_0x455f=function(_0x9a7c1,_0x30a5ea){_0x9a7c1=_0x9a7c1-0xe9;let _0x4139a1=_0x15b4f3[_0x9a7c1];return _0x4139a1;},a74_0x455f(_0x172768,_0x4bcdc9);}'use strict';function a74_0x4139(){const _0x54c1d4=['6OqwpAV','retrieveAttachment','3534xHtPip','../../salesforce/services/salesforce-retriever.service','FLOSUM_ATTACHMENT','run','then','(((.+)+)+)+$','map','Logger','getCommitDto','7580vgVqWN','log','../../salesforce/services/salesforce.service','repoService','gitUrl','Container','__esModule','send','\x20Update\x20remote\x20state.','fetchRepositoryData','../dto/commit-components.dto','config','metadata','prefix','repository','branchName','6100744aAVRkW','getComponentsToWrite','SalesforceService','SalesforceRetrieverService','isConvertToSfdx','getOne','./commit-components.job',']\x20[Branch:\x20','logger','BadRequestError','syncBranchId','sfLogger','repositoryName','301512kyymPA','message','syncRepositoryId','Service','function','length','updateRemoteState','getBranchRecord','CommitComponentsJob','getComponentsToDelete','search','commitAttachmentId','setStatus','Error','error','ERR_INVALID_SYNC_RECORD_ID','repo','10YmLraW','defineProperty','provider','../../../../constants','split','salesforceSync','731947hkLtzo','gitApiService','deleteAttachmentId','shortid','salesforceService','[FLOSUM\x20->\x20GIT]\x20[','sha','__metadata','../../providers/providers.tokens','2190216OndxFN','__decorate','get',']\x20[Repository:\x20','CommitComponentsDto','name','12128472TzNAeF','exec','object','Tokens','../../../../core','../../salesforce/services/salesforce-sync.service','commitData','all','FlosumCommitJob','catch','commitJob','1533302hIuJMt','__importDefault','handleCommitJobError','user','trim','toString','\x20Start\x20Flosum\x20commit\x20job.','branch','updateLastCommit','convertToSFDX','patchObject','constructor','ERR_UNKNOWN_SYNC_RECORD_ID','apply','design:paramtypes','components','gitProvider','repositoryData','deleteAttachment'];a74_0x4139=function(){return _0x54c1d4;};return a74_0x4139();}var __decorate=this&&this[a74_0x56dea4(0x153)]||function(_0xe8d604,_0x40d982,_0x30ccbc,_0x232fbe){const _0x4675b4=a74_0x56dea4;var _0x48854e=arguments[_0x4675b4(0x137)],_0x5286b6=_0x48854e<0x3?_0x40d982:_0x232fbe===null?_0x232fbe=Object['getOwnPropertyDescriptor'](_0x40d982,_0x30ccbc):_0x232fbe,_0x1885ff;if(typeof Reflect===_0x4675b4(0xee)&&typeof Reflect['decorate']===_0x4675b4(0x136))_0x5286b6=Reflect['decorate'](_0xe8d604,_0x40d982,_0x30ccbc,_0x232fbe);else{for(var _0xc8e49b=_0xe8d604[_0x4675b4(0x137)]-0x1;_0xc8e49b>=0x0;_0xc8e49b--)if(_0x1885ff=_0xe8d604[_0xc8e49b])_0x5286b6=(_0x48854e<0x3?_0x1885ff(_0x5286b6):_0x48854e>0x3?_0x1885ff(_0x40d982,_0x30ccbc,_0x5286b6):_0x1885ff(_0x40d982,_0x30ccbc))||_0x5286b6;}return _0x48854e>0x3&&_0x5286b6&&Object[_0x4675b4(0x144)](_0x40d982,_0x30ccbc,_0x5286b6),_0x5286b6;},__metadata=this&&this[a74_0x56dea4(0x150)]||function(_0x42c4da,_0x1cd8f9){const _0x45dfa7=a74_0x56dea4;if(typeof Reflect==='object'&&typeof Reflect[_0x45dfa7(0x121)]==='function')return Reflect[_0x45dfa7(0x121)](_0x42c4da,_0x1cd8f9);},__importDefault=this&&this[a74_0x56dea4(0xf8)]||function(_0x4c03e9){const _0x1412c0=a74_0x56dea4;return _0x4c03e9&&_0x4c03e9[_0x1412c0(0x11b)]?_0x4c03e9:{'default':_0x4c03e9};},FlosumCommitJob_1;Object['defineProperty'](exports,a74_0x56dea4(0x11b),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a74_0x56dea4(0xf0)),salesforce_service_1=require(a74_0x56dea4(0x117)),typedi_1=require('typedi'),errors_1=require('../../../../constants/errors'),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a74_0x56dea4(0x10d)),salesforce_sync_service_1=require(a74_0x56dea4(0xf1)),commit_components_dto_1=require(a74_0x56dea4(0x11f)),commit_components_job_1=require(a74_0x56dea4(0x12b)),constants_1=require(a74_0x56dea4(0x146)),shortid_1=__importDefault(require(a74_0x56dea4(0x14c))),providers_tokens_1=require(a74_0x56dea4(0x151));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x1a6198,_0x1b9cff,_0x984ace){const _0x365540=a74_0x56dea4;this[_0x365540(0x14d)]=_0x1a6198,this['commitJob']=_0x1b9cff,this[_0x365540(0x148)]=_0x984ace,this[_0x365540(0x12d)]=new core_1[(_0x365540(0x113))](FlosumCommitJob_1[_0x365540(0xeb)]);}async[a74_0x56dea4(0x11e)](){const _0x48f0a8=a74_0x56dea4;try{if(this[_0x48f0a8(0xf2)][_0x48f0a8(0x134)])this[_0x48f0a8(0x108)]=await this[_0x48f0a8(0x148)]['getRepositoryRecord'](this[_0x48f0a8(0xf2)]['syncRepositoryId']);else this[_0x48f0a8(0xf2)][_0x48f0a8(0x12f)]&&(this['repositoryData']=await this[_0x48f0a8(0x148)][_0x48f0a8(0x139)](this['commitData'][_0x48f0a8(0x12f)]));}catch(_0x11cb69){throw new bad_request_error_1[(_0x48f0a8(0x12e))](errors_1[_0x48f0a8(0x141)]);}}async['getComponentsToWrite'](){const _0x19e2b8=a74_0x56dea4;if(!this[_0x19e2b8(0xf2)][_0x19e2b8(0x13d)])return[];await this[_0x19e2b8(0x14d)][_0x19e2b8(0x101)](constants_1[_0x19e2b8(0x10e)],this[_0x19e2b8(0xf2)]['commitAttachmentId'],{'Name':(0x0,shortid_1['default'])()});const _0xc45adf=await this[_0x19e2b8(0x14d)][_0x19e2b8(0x10b)](this['commitData'][_0x19e2b8(0x13d)])[_0x19e2b8(0x110)](_0x30968e=>_0x30968e[_0x19e2b8(0x147)]('\x20')[_0x19e2b8(0x112)](_0xb0f9ef=>_0xb0f9ef[_0x19e2b8(0xfb)]()));await this[_0x19e2b8(0x14d)][_0x19e2b8(0x109)](this[_0x19e2b8(0xf2)][_0x19e2b8(0x13d)]);const _0x209bab=new salesforce_retriever_service_1[(_0x19e2b8(0x128))](this[_0x19e2b8(0x14d)]);return await _0x209bab[_0x19e2b8(0x10f)](_0xc45adf);}async['getComponentsToDelete'](){const _0x1a5092=a74_0x56dea4;if(!this[_0x1a5092(0xf2)][_0x1a5092(0x14b)])return[];await this['salesforceService'][_0x1a5092(0x101)](constants_1[_0x1a5092(0x10e)],this[_0x1a5092(0xf2)][_0x1a5092(0x14b)],{'Name':(0x0,shortid_1['default'])()});const _0x3c0c7d=await this[_0x1a5092(0x14d)][_0x1a5092(0x10b)](this[_0x1a5092(0xf2)][_0x1a5092(0x14b)]);return await this[_0x1a5092(0x14d)][_0x1a5092(0x109)](this[_0x1a5092(0xf2)][_0x1a5092(0x14b)]),_0x3c0c7d;}async[a74_0x56dea4(0x114)](){const _0x55f715=a74_0x56dea4,_0x1ff11d=new commit_components_dto_1[(_0x55f715(0xea))](),[_0x55013c,_0x45f1b4]=await Promise[_0x55f715(0xf3)]([this[_0x55f715(0x126)](),this[_0x55f715(0x13b)]()]);return _0x1ff11d[_0x55f715(0x133)]=this['commitData']['message'],_0x1ff11d[_0x55f715(0xfa)]=this['commitData'][_0x55f715(0xfa)],_0x1ff11d[_0x55f715(0x106)]={'writed':_0x55013c,'deleted':_0x45f1b4},_0x1ff11d[_0x55f715(0x100)]=this['config'][_0x55f715(0x129)],_0x1ff11d[_0x55f715(0x142)]=this[_0x55f715(0x123)],_0x1ff11d[_0x55f715(0xfe)]=this[_0x55f715(0xfe)],_0x1ff11d[_0x55f715(0x145)]=this['config'][_0x55f715(0x107)],_0x1ff11d;}async[a74_0x56dea4(0xff)](_0x19306f=![]){const _0x1fd18d=a74_0x56dea4;if(_0x19306f)await this[_0x1fd18d(0x148)][_0x1fd18d(0x138)](this[_0x1fd18d(0x108)],{});else{const _0x340409=await this['repository']['branches']['getOne'](this['branch'][_0x1fd18d(0xeb)]);this[_0x1fd18d(0x130)][_0x1fd18d(0x116)](this['prefix']+_0x1fd18d(0x11d));const _0x25d13d={[this[_0x1fd18d(0x123)][_0x1fd18d(0x119)]]:{'lastCommit':_0x340409[_0x1fd18d(0x14f)]}};await this[_0x1fd18d(0x148)][_0x1fd18d(0x138)](this['repositoryData'],_0x25d13d);}}async[a74_0x56dea4(0xed)](){const _0x3ded5d=a74_0x56dea4,_0x56a206=await this['getCommitDto']();await this['salesforceSync']['setStatus'](this[_0x3ded5d(0x108)],'In\x20Progress'),await this[_0x3ded5d(0xf6)]['run'](_0x56a206,this[_0x3ded5d(0x122)]),await this[_0x3ded5d(0xff)](),await this[_0x3ded5d(0x148)][_0x3ded5d(0x13e)](this[_0x3ded5d(0x108)],'Completed');}async[a74_0x56dea4(0xf9)](_0x5d3608){const _0x4887e1=a74_0x56dea4;try{this[_0x4887e1(0x130)][_0x4887e1(0x140)](''+_0x5d3608),await this[_0x4887e1(0x130)]['send'](),await this['updateLastCommit'](!![]),await this['salesforceSync']['setStatus'](this[_0x4887e1(0x108)],_0x4887e1(0x13f));}catch(_0x3b101c){this['logger']['error'](_0x3b101c);}}async[a74_0x56dea4(0x10f)](_0x4d3b4e){const _0x8b565f=a74_0x56dea4;try{this[_0x8b565f(0xf2)]=_0x4d3b4e,this[_0x8b565f(0x14a)]=typedi_1['Container']['get'](providers_tokens_1[_0x8b565f(0xef)][_0x8b565f(0x14a)]),this['repoService']=typedi_1[_0x8b565f(0x11a)][_0x8b565f(0x154)](providers_tokens_1[_0x8b565f(0xef)]['gitRepoService']),this[_0x8b565f(0x120)]=typedi_1['Container'][_0x8b565f(0x154)](providers_tokens_1['Tokens'][_0x8b565f(0x120)]),await this[_0x8b565f(0x11e)](),this[_0x8b565f(0x123)]=await this[_0x8b565f(0x118)][_0x8b565f(0x12a)](this[_0x8b565f(0x108)]['repositoryName']),this[_0x8b565f(0xfe)]=await this[_0x8b565f(0x123)]['branches']['getOne'](this[_0x8b565f(0x108)][_0x8b565f(0x124)]),this[_0x8b565f(0x130)]=typedi_1['Container'][_0x8b565f(0x154)](providers_tokens_1[_0x8b565f(0xef)][_0x8b565f(0x12d)]),this[_0x8b565f(0x122)]=_0x8b565f(0x14e)+this['config'][_0x8b565f(0x107)]['toUpperCase']()+_0x8b565f(0xe9)+this[_0x8b565f(0x108)][_0x8b565f(0x131)]+_0x8b565f(0x12c)+this[_0x8b565f(0x108)][_0x8b565f(0x124)]+']\x20['+FlosumCommitJob_1['name']+']';if(!this[_0x8b565f(0x108)])throw new bad_request_error_1[(_0x8b565f(0x12e))](errors_1[_0x8b565f(0x103)]);await this['sfLogger']['log'](this['prefix']+_0x8b565f(0xfd))[_0x8b565f(0x11c)](),await this[_0x8b565f(0xed)]()[_0x8b565f(0xf5)](_0x2cec20=>this[_0x8b565f(0xf9)](_0x2cec20));}catch(_0x28f938){this['commitData']=undefined,this['logger'][_0x8b565f(0x140)](_0x28f938);throw _0x28f938;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a74_0x56dea4(0x135)])({'transient':!![]}),__metadata(a74_0x56dea4(0x105),[salesforce_service_1[a74_0x56dea4(0x127)],commit_components_job_1[a74_0x56dea4(0x13a)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a74_0x56dea4(0xf4)]=FlosumCommitJob;