const a126_0x3862df=a126_0x3aa7;(function(_0x324669,_0x42d266){const _0x3b205d=a126_0x3aa7,_0x30bc80=_0x324669();while(!![]){try{const _0x155a83=-parseInt(_0x3b205d(0xf5))/0x1*(-parseInt(_0x3b205d(0x15c))/0x2)+parseInt(_0x3b205d(0x11b))/0x3*(-parseInt(_0x3b205d(0x10a))/0x4)+-parseInt(_0x3b205d(0xed))/0x5+-parseInt(_0x3b205d(0x120))/0x6*(parseInt(_0x3b205d(0x111))/0x7)+parseInt(_0x3b205d(0x12e))/0x8*(parseInt(_0x3b205d(0x13d))/0x9)+parseInt(_0x3b205d(0x104))/0xa*(-parseInt(_0x3b205d(0x110))/0xb)+parseInt(_0x3b205d(0x134))/0xc;if(_0x155a83===_0x42d266)break;else _0x30bc80['push'](_0x30bc80['shift']());}catch(_0x17316e){_0x30bc80['push'](_0x30bc80['shift']());}}}(a126_0x3532,0xd2686));function a126_0x3532(){const _0x3adcd9=['\x20Start\x20Flosum\x20commit\x20job.','provider','570eWHxCr','branch','split','user','SalesforceRetrieverService','all','6575480WvYCzT','design:paramtypes','getOne','handleCommitJobError','Tokens','getComponentsToDelete','255739EbuEdf','14oEcaaL','repository','object','getComponentsToWrite','defineProperty','FlosumCommitJob','log','error','[FLOSUM\x20->\x20GIT]\x20[','repositoryName','3SqwHor','setStatus','FLOSUM_ATTACHMENT','trim','CommitToGitCompletedNotification','3048996PyJpjw','send','info','parse','isConvertToSfdx','shortid','../../notifications/commit-to-git-error.notification','../../../../constants/errors','(((.+)+)+)+$','branchName','Service','updateLastCommit','getOwnPropertyDescriptor','../../salesforce/services/salesforce.service','12976ESeoiU','syncRepositoryId','search','metadata','getBranchRecord','repo','59948328iRJubg','logger','convertToSFDX','__esModule','deleteAttachmentId',']\x20[Repository:\x20','patchObject','Email\x20notifications\x20are\x20disabled.','decorate','288RUzhjp','salesforceSync','../../../../core','ERR_INVALID_SYNC_RECORD_ID','getCommitDto','../../../../core/errors/bad-request.error','exec','repositoryData','execute','gitApiService','CommitToGitErrorNotification','__metadata','../../salesforce/services/salesforce-retriever.service','length','In\x20Progress','toString','isEmailNotificationsEnabled','branches','Container','getRepositoryRecord','Completed','SalesforceSyncService','config','retrieveAttachment','sha','BadRequestError','completeNotification','../../salesforce/services/salesforce-sync.service','name','catch','../../providers/providers.tokens','10uAcFQt','updateRemoteState','commitAttachmentId','\x20Update\x20remote\x20state.','email','fetchRepositoryData','recordType','../../notifications/commit-to-git-completed.notification','gitRepoService','7201640DYijhO','default','Error','SalesforceService','gitProvider','get','repoService','constructor','247991EGzLjg','../dto/commit-components.dto','run','prefix','function','salesforceService','deleteAttachment','map','sfLogger','commitData','message','typedi','CommitComponentsJob'];a126_0x3532=function(){return _0x3adcd9;};return a126_0x3532();}const a126_0x38fb60=(function(){let _0x2bb404=!![];return function(_0x4cada1,_0x550298){const _0x4e09af=_0x2bb404?function(){if(_0x550298){const _0x3b966f=_0x550298['apply'](_0x4cada1,arguments);return _0x550298=null,_0x3b966f;}}:function(){};return _0x2bb404=![],_0x4e09af;};}()),a126_0x4e1632=a126_0x38fb60(this,function(){const _0xb746e6=a126_0x3aa7;return a126_0x4e1632[_0xb746e6(0x14c)]()[_0xb746e6(0x130)](_0xb746e6(0x128))[_0xb746e6(0x14c)]()[_0xb746e6(0xf4)](a126_0x4e1632)[_0xb746e6(0x130)](_0xb746e6(0x128));});a126_0x4e1632();'use strict';var __decorate=this&&this['__decorate']||function(_0x3c5de1,_0x101de4,_0x47f0a4,_0xf80a6e){const _0x194b6a=a126_0x3aa7;var _0x30ca2f=arguments[_0x194b6a(0x14a)],_0x41b277=_0x30ca2f<0x3?_0x101de4:_0xf80a6e===null?_0xf80a6e=Object[_0x194b6a(0x12c)](_0x101de4,_0x47f0a4):_0xf80a6e,_0x4c7f42;if(typeof Reflect===_0x194b6a(0x113)&&typeof Reflect['decorate']===_0x194b6a(0xf9))_0x41b277=Reflect[_0x194b6a(0x13c)](_0x3c5de1,_0x101de4,_0x47f0a4,_0xf80a6e);else{for(var _0x38a2eb=_0x3c5de1[_0x194b6a(0x14a)]-0x1;_0x38a2eb>=0x0;_0x38a2eb--)if(_0x4c7f42=_0x3c5de1[_0x38a2eb])_0x41b277=(_0x30ca2f<0x3?_0x4c7f42(_0x41b277):_0x30ca2f>0x3?_0x4c7f42(_0x101de4,_0x47f0a4,_0x41b277):_0x4c7f42(_0x101de4,_0x47f0a4))||_0x41b277;}return _0x30ca2f>0x3&&_0x41b277&&Object[_0x194b6a(0x115)](_0x101de4,_0x47f0a4,_0x41b277),_0x41b277;},__metadata=this&&this[a126_0x3862df(0x148)]||function(_0x45be80,_0x33b3fb){const _0x351452=a126_0x3862df;if(typeof Reflect===_0x351452(0x113)&&typeof Reflect[_0x351452(0x131)]===_0x351452(0xf9))return Reflect[_0x351452(0x131)](_0x45be80,_0x33b3fb);},__importDefault=this&&this['__importDefault']||function(_0x51dc6f){const _0x7f3af1=a126_0x3862df;return _0x51dc6f&&_0x51dc6f[_0x7f3af1(0x137)]?_0x51dc6f:{'default':_0x51dc6f};},FlosumCommitJob_1;Object[a126_0x3862df(0x115)](exports,'__esModule',{'value':!![]}),exports[a126_0x3862df(0x116)]=void 0x0;function a126_0x3aa7(_0x2eaff3,_0xa362a1){const _0x392559=a126_0x3532();return a126_0x3aa7=function(_0x4e1632,_0x38fb60){_0x4e1632=_0x4e1632-0xe9;let _0x35321d=_0x392559[_0x4e1632];return _0x35321d;},a126_0x3aa7(_0x2eaff3,_0xa362a1);}const core_1=require(a126_0x3862df(0x13f)),salesforce_service_1=require(a126_0x3862df(0x12d)),typedi_1=require(a126_0x3862df(0x100)),errors_1=require(a126_0x3862df(0x127)),bad_request_error_1=require(a126_0x3862df(0x142)),salesforce_retriever_service_1=require(a126_0x3862df(0x149)),salesforce_sync_service_1=require(a126_0x3862df(0x158)),commit_components_dto_1=require(a126_0x3862df(0xf6)),commit_components_job_1=require('./commit-components.job'),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a126_0x3862df(0x125))),providers_tokens_1=require(a126_0x3862df(0x15b)),commit_to_git_completed_notification_1=require(a126_0x3862df(0xeb)),commit_to_git_error_notification_1=require(a126_0x3862df(0x126));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x1f1e94,_0x535452,_0x2227c0){const _0x22f748=a126_0x3862df;this['salesforceService']=_0x1f1e94,this['commitJob']=_0x535452,this[_0x22f748(0x13e)]=_0x2227c0,this['logger']=new core_1['Logger'](FlosumCommitJob_1[_0x22f748(0x159)]);}async[a126_0x3862df(0x157)](_0x12fb2e,_0x318043,_0x453202,_0x3fa5e8){const _0x46c5b0=a126_0x3862df;if(!this['commitData'][_0x46c5b0(0x14d)]){this[_0x46c5b0(0x135)]['info'](_0x46c5b0(0x13b));return;}await new commit_to_git_completed_notification_1[(_0x46c5b0(0x11f))]({'emails':_0x12fb2e,'gitProvider':_0x318043,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1['CommitToGitCompletedNotification'][_0x46c5b0(0x159)],'repositoryName':_0x453202,'branchName':_0x3fa5e8})['execute']();}async['errorNotification'](_0x3a7758,_0x482d4c,_0x3ad93c,_0x4679ea){const _0x57faeb=a126_0x3862df;if(!this['commitData'][_0x57faeb(0x14d)]){this[_0x57faeb(0x135)][_0x57faeb(0x122)](_0x57faeb(0x13b));return;}await new commit_to_git_error_notification_1[(_0x57faeb(0x147))]({'emails':_0x3a7758,'gitProvider':_0x482d4c,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0x57faeb(0x147)][_0x57faeb(0x159)],'repositoryName':_0x3ad93c,'branchName':_0x4679ea})[_0x57faeb(0x145)]();}async[a126_0x3862df(0xe9)](){const _0xe651ad=a126_0x3862df;try{if(this['commitData'][_0xe651ad(0x12f)])this[_0xe651ad(0x144)]=await this[_0xe651ad(0x13e)][_0xe651ad(0x150)](this['commitData'][_0xe651ad(0x12f)]);else this[_0xe651ad(0xfe)]['syncBranchId']&&(this[_0xe651ad(0x144)]=await this[_0xe651ad(0x13e)][_0xe651ad(0x132)](this[_0xe651ad(0xfe)]['syncBranchId']));}catch(_0x520b58){throw new bad_request_error_1[(_0xe651ad(0x156))](errors_1[_0xe651ad(0x140)]);}}async[a126_0x3862df(0x114)](){const _0x3a6104=a126_0x3862df;if(!this[_0x3a6104(0xfe)][_0x3a6104(0x15e)])return[];await this['salesforceService']['patchObject'](constants_1[_0x3a6104(0x11d)],this[_0x3a6104(0xfe)]['commitAttachmentId'],{'Name':(0x0,shortid_1[_0x3a6104(0xee)])()});const _0x395251=await this[_0x3a6104(0xfa)][_0x3a6104(0x154)](this['commitData']['commitAttachmentId'])['then'](_0x3993bf=>_0x3993bf[_0x3a6104(0x106)]('\x20')[_0x3a6104(0xfc)](_0x509299=>_0x509299[_0x3a6104(0x11e)]()));await this[_0x3a6104(0xfa)][_0x3a6104(0xfb)](this['commitData'][_0x3a6104(0x15e)]);const _0x4f3830=new salesforce_retriever_service_1[(_0x3a6104(0x108))](this['salesforceService']);return await _0x4f3830[_0x3a6104(0xf7)](_0x395251);}async['getComponentsToDelete'](){const _0x1e2844=a126_0x3862df;if(!this[_0x1e2844(0xfe)][_0x1e2844(0x138)])return[];await this[_0x1e2844(0xfa)][_0x1e2844(0x13a)](constants_1[_0x1e2844(0x11d)],this[_0x1e2844(0xfe)]['deleteAttachmentId'],{'Name':(0x0,shortid_1['default'])()});const _0x508be1=await this[_0x1e2844(0xfa)][_0x1e2844(0x154)](this[_0x1e2844(0xfe)][_0x1e2844(0x138)]),_0x1fbbad=JSON[_0x1e2844(0x123)](_0x508be1);return await this[_0x1e2844(0xfa)][_0x1e2844(0xfb)](this['commitData']['deleteAttachmentId']),_0x1fbbad;}async[a126_0x3862df(0x141)](){const _0x545e59=a126_0x3862df,_0x2a9f01=new commit_components_dto_1['CommitComponentsDto'](),[_0x27b449,_0x2d8bd6]=await Promise[_0x545e59(0x109)]([this['getComponentsToWrite'](),this[_0x545e59(0x10f)]()]);return _0x2a9f01[_0x545e59(0xff)]=this[_0x545e59(0xfe)]['message'],_0x2a9f01[_0x545e59(0x107)]=this[_0x545e59(0xfe)][_0x545e59(0x107)],_0x2a9f01['components']={'writed':_0x27b449,'deleted':_0x2d8bd6},_0x2a9f01[_0x545e59(0x136)]=this[_0x545e59(0x153)][_0x545e59(0x124)],_0x2a9f01[_0x545e59(0x133)]=this[_0x545e59(0x112)],_0x2a9f01[_0x545e59(0x105)]=this[_0x545e59(0x105)],_0x2a9f01[_0x545e59(0x103)]=this[_0x545e59(0x153)]['gitProvider'],_0x2a9f01[_0x545e59(0xea)]=this[_0x545e59(0x144)]['recordTypeName'],_0x2a9f01;}async[a126_0x3862df(0x12b)](_0x4fca6d=![]){const _0x7e07f8=a126_0x3862df;if(_0x4fca6d)await this['salesforceSync'][_0x7e07f8(0x15d)](this['repositoryData'],{});else{const _0x299d56=await this[_0x7e07f8(0x112)]['branches'][_0x7e07f8(0x10c)](this['branch'][_0x7e07f8(0x159)]);this['sfLogger'][_0x7e07f8(0x117)](this[_0x7e07f8(0xf8)]+_0x7e07f8(0x15f));const _0x39f3aa={[this[_0x7e07f8(0x112)]['gitUrl']]:{'lastCommit':_0x299d56[_0x7e07f8(0x155)]}};await this['salesforceSync'][_0x7e07f8(0x15d)](this[_0x7e07f8(0x144)],_0x39f3aa);}}async[a126_0x3862df(0x143)](){const _0x3f398f=a126_0x3862df,_0x28ff77=await this[_0x3f398f(0x141)]();await this[_0x3f398f(0x13e)][_0x3f398f(0x11c)](this[_0x3f398f(0x144)],_0x3f398f(0x14b)),await this['commitJob'][_0x3f398f(0xf7)](_0x28ff77,this[_0x3f398f(0xf8)]),await this[_0x3f398f(0x12b)](),await this[_0x3f398f(0x13e)][_0x3f398f(0x11c)](this[_0x3f398f(0x144)],_0x3f398f(0x151));}async[a126_0x3862df(0x10d)](_0x2d0178){const _0x2811d8=a126_0x3862df;try{this[_0x2811d8(0xfd)][_0x2811d8(0x118)](''+_0x2d0178),await this[_0x2811d8(0xfd)][_0x2811d8(0x121)](),await this[_0x2811d8(0x12b)](!![]),await this[_0x2811d8(0x13e)][_0x2811d8(0x11c)](this[_0x2811d8(0x144)],_0x2811d8(0xef)),await this['completeNotification']([this[_0x2811d8(0xfe)][_0x2811d8(0x107)][_0x2811d8(0x160)]],this['config'][_0x2811d8(0xf1)],this['repository'][_0x2811d8(0x159)],this['branch'][_0x2811d8(0x159)]);}catch(_0x13bfc3){this[_0x2811d8(0x135)][_0x2811d8(0x118)](_0x13bfc3),await this['errorNotification']([this[_0x2811d8(0xfe)]['user'][_0x2811d8(0x160)]],this[_0x2811d8(0x153)][_0x2811d8(0xf1)],this[_0x2811d8(0x112)][_0x2811d8(0x159)],this['branch'][_0x2811d8(0x159)]);}}async[a126_0x3862df(0xf7)](_0x1e8f18){const _0x484e3f=a126_0x3862df;try{this['commitData']=_0x1e8f18,this[_0x484e3f(0x146)]=typedi_1[_0x484e3f(0x14f)][_0x484e3f(0xf2)](providers_tokens_1['Tokens'][_0x484e3f(0x146)]),this[_0x484e3f(0xf3)]=typedi_1['Container']['get'](providers_tokens_1[_0x484e3f(0x10e)][_0x484e3f(0xec)]),this['config']=typedi_1[_0x484e3f(0x14f)][_0x484e3f(0xf2)](providers_tokens_1['Tokens'][_0x484e3f(0x153)]),await this['fetchRepositoryData'](),this[_0x484e3f(0x112)]=await this[_0x484e3f(0xf3)][_0x484e3f(0x10c)](this[_0x484e3f(0x144)][_0x484e3f(0x11a)]),this[_0x484e3f(0x105)]=await this[_0x484e3f(0x112)][_0x484e3f(0x14e)][_0x484e3f(0x10c)](this[_0x484e3f(0x144)]['branchName']),this[_0x484e3f(0xfd)]=typedi_1['Container'][_0x484e3f(0xf2)](providers_tokens_1[_0x484e3f(0x10e)]['logger']),this[_0x484e3f(0xf8)]=_0x484e3f(0x119)+this[_0x484e3f(0x153)][_0x484e3f(0xf1)]['toUpperCase']()+_0x484e3f(0x139)+this[_0x484e3f(0x144)]['repositoryName']+']\x20[Branch:\x20'+this['repositoryData'][_0x484e3f(0x129)]+']\x20['+FlosumCommitJob_1[_0x484e3f(0x159)]+']';if(!this[_0x484e3f(0x144)])throw new bad_request_error_1[(_0x484e3f(0x156))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x484e3f(0xfd)][_0x484e3f(0x117)](this[_0x484e3f(0xf8)]+_0x484e3f(0x102))['send'](),await this['exec']()[_0x484e3f(0x15a)](_0x7d37e2=>this[_0x484e3f(0x10d)](_0x7d37e2)),await this['completeNotification']([this[_0x484e3f(0xfe)]['user'][_0x484e3f(0x160)]],this[_0x484e3f(0x153)][_0x484e3f(0xf1)],this['repository'][_0x484e3f(0x159)],this[_0x484e3f(0x105)][_0x484e3f(0x159)]);}catch(_0x1330ae){this[_0x484e3f(0xfe)]=undefined,this[_0x484e3f(0x135)][_0x484e3f(0x118)](_0x1330ae),await this['errorNotification']([this[_0x484e3f(0xfe)][_0x484e3f(0x107)]['email']],this[_0x484e3f(0x153)]['gitProvider'],this[_0x484e3f(0x112)]['name'],this['branch']['name']);throw _0x1330ae;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a126_0x3862df(0x12a)])({'transient':!![]}),__metadata(a126_0x3862df(0x10b),[salesforce_service_1[a126_0x3862df(0xf0)],commit_components_job_1[a126_0x3862df(0x101)],salesforce_sync_service_1[a126_0x3862df(0x152)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;