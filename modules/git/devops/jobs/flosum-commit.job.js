const a125_0x4cc318=a125_0x3afe;(function(_0x3aa080,_0x29a9f1){const _0x225036=a125_0x3afe,_0x146eaf=_0x3aa080();while(!![]){try{const _0xc1fd0d=-parseInt(_0x225036(0x1f6))/0x1*(-parseInt(_0x225036(0x1d6))/0x2)+-parseInt(_0x225036(0x1ce))/0x3+-parseInt(_0x225036(0x1d9))/0x4*(-parseInt(_0x225036(0x20b))/0x5)+parseInt(_0x225036(0x1c1))/0x6+-parseInt(_0x225036(0x1fe))/0x7*(-parseInt(_0x225036(0x201))/0x8)+parseInt(_0x225036(0x21c))/0x9+-parseInt(_0x225036(0x1af))/0xa;if(_0xc1fd0d===_0x29a9f1)break;else _0x146eaf['push'](_0x146eaf['shift']());}catch(_0x2164aa){_0x146eaf['push'](_0x146eaf['shift']());}}}(a125_0x57b1,0x596bb));const a125_0x96f4e7=(function(){let _0x4058e7=!![];return function(_0xfe3fc0,_0x7ab58f){const _0x8db333=_0x4058e7?function(){const _0x40eebc=a125_0x3afe;if(_0x7ab58f){const _0xf0241b=_0x7ab58f[_0x40eebc(0x210)](_0xfe3fc0,arguments);return _0x7ab58f=null,_0xf0241b;}}:function(){};return _0x4058e7=![],_0x8db333;};}()),a125_0xb86f2b=a125_0x96f4e7(this,function(){const _0x24420c=a125_0x3afe;return a125_0xb86f2b[_0x24420c(0x1a9)]()[_0x24420c(0x1c5)]('(((.+)+)+)+$')[_0x24420c(0x1a9)]()[_0x24420c(0x1d3)](a125_0xb86f2b)[_0x24420c(0x1c5)](_0x24420c(0x1ff));});a125_0xb86f2b();'use strict';function a125_0x3afe(_0x378c32,_0x1672d3){const _0x21102b=a125_0x57b1();return a125_0x3afe=function(_0xb86f2b,_0x96f4e7){_0xb86f2b=_0xb86f2b-0x1a8;let _0x57b15f=_0x21102b[_0xb86f2b];return _0x57b15f;},a125_0x3afe(_0x378c32,_0x1672d3);}var __decorate=this&&this['__decorate']||function(_0x4fb767,_0x5e8f8a,_0x3f13e0,_0x5b785f){const _0xa097b7=a125_0x3afe;var _0x2d13b9=arguments[_0xa097b7(0x211)],_0x3bf6c7=_0x2d13b9<0x3?_0x5e8f8a:_0x5b785f===null?_0x5b785f=Object[_0xa097b7(0x1ef)](_0x5e8f8a,_0x3f13e0):_0x5b785f,_0x2417f5;if(typeof Reflect===_0xa097b7(0x1cd)&&typeof Reflect[_0xa097b7(0x202)]===_0xa097b7(0x21e))_0x3bf6c7=Reflect[_0xa097b7(0x202)](_0x4fb767,_0x5e8f8a,_0x3f13e0,_0x5b785f);else{for(var _0xeac5c=_0x4fb767['length']-0x1;_0xeac5c>=0x0;_0xeac5c--)if(_0x2417f5=_0x4fb767[_0xeac5c])_0x3bf6c7=(_0x2d13b9<0x3?_0x2417f5(_0x3bf6c7):_0x2d13b9>0x3?_0x2417f5(_0x5e8f8a,_0x3f13e0,_0x3bf6c7):_0x2417f5(_0x5e8f8a,_0x3f13e0))||_0x3bf6c7;}return _0x2d13b9>0x3&&_0x3bf6c7&&Object[_0xa097b7(0x1b9)](_0x5e8f8a,_0x3f13e0,_0x3bf6c7),_0x3bf6c7;},__metadata=this&&this[a125_0x4cc318(0x1f5)]||function(_0x52ec83,_0x336a6d){const _0x19ae04=a125_0x4cc318;if(typeof Reflect==='object'&&typeof Reflect[_0x19ae04(0x206)]==='function')return Reflect[_0x19ae04(0x206)](_0x52ec83,_0x336a6d);},__importDefault=this&&this[a125_0x4cc318(0x1b3)]||function(_0x1b403e){return _0x1b403e&&_0x1b403e['__esModule']?_0x1b403e:{'default':_0x1b403e};},FlosumCommitJob_1;function a125_0x57b1(){const _0x5c0ebe=['apply','length','../../../../core','parse','ERR_INVALID_SYNC_RECORD_ID','repo','gitRepoService','isEmailNotificationsEnabled','ERR_UNKNOWN_SYNC_RECORD_ID','repository','FLOSUM_ATTACHMENT','CommitToGitErrorNotification','6204204oSudHB','../../salesforce/services/salesforce-sync.service','function','then','toString','../../notifications/commit-to-git-completed.notification','commitData','getCommitDto','syncBranchId','Container','15615420jFREeR','repositoryName','In\x20Progress','BadRequestError','__importDefault','errorNotification','retrieveAttachment',']\x20[Branch:\x20','getOne','salesforceSync','defineProperty','get','getComponentsToDelete','patchObject','commitJob','isConvertToSfdx','../../../../constants/errors','gitApiService','2923518CepnBg','gitProvider','branchName','FlosumCommitJob','search','Tokens','map','updateLastCommit','[FLOSUM\x20->\x20GIT]\x20[','getRepositoryRecord','\x20Start\x20Flosum\x20commit\x20job.','../../../../constants','object','176823mdOUhF','run','user','shortid','getComponentsToWrite','constructor','Error','../../providers/providers.tokens','547160DZzYWZ','log','deleteAttachment','1226860fsyWzZ','updateRemoteState','completeNotification','email','sha','CommitToGitCompletedNotification','commitAttachmentId','SalesforceService','toUpperCase','recordTypeName','Logger','fetchRepositoryData','setStatus','../../salesforce/services/salesforce-retriever.service','repositoryData','exec','components','info','syncRepositoryId','prefix','../../../../core/errors/bad-request.error','Completed','getOwnPropertyDescriptor','getBranchRecord','CommitComponentsDto','config','error','provider','__metadata','1zYOKTb','CommitComponentsJob','name','default','deleteAttachmentId','branch','sfLogger','salesforceService','7enJuKK','(((.+)+)+)+$','execute','1838768eJNCgN','decorate','logger','split','typedi','metadata','message',']\x20[Repository:\x20','../../salesforce/services/salesforce.service','catch','5bWjuxg','branches','send','repoService','__esModule'];a125_0x57b1=function(){return _0x5c0ebe;};return a125_0x57b1();}Object[a125_0x4cc318(0x1b9)](exports,a125_0x4cc318(0x20f),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a125_0x4cc318(0x212)),salesforce_service_1=require(a125_0x4cc318(0x209)),typedi_1=require(a125_0x4cc318(0x205)),errors_1=require(a125_0x4cc318(0x1bf)),bad_request_error_1=require(a125_0x4cc318(0x1ed)),salesforce_retriever_service_1=require(a125_0x4cc318(0x1e6)),salesforce_sync_service_1=require(a125_0x4cc318(0x21d)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require('./commit-components.job'),constants_1=require(a125_0x4cc318(0x1cc)),shortid_1=__importDefault(require(a125_0x4cc318(0x1d1))),providers_tokens_1=require(a125_0x4cc318(0x1d5)),commit_to_git_completed_notification_1=require(a125_0x4cc318(0x1aa)),commit_to_git_error_notification_1=require('../../notifications/commit-to-git-error.notification');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0xa0f6ce,_0x25a1a0,_0x23cc86){const _0x16dc5d=a125_0x4cc318;this[_0x16dc5d(0x1fd)]=_0xa0f6ce,this[_0x16dc5d(0x1bd)]=_0x25a1a0,this[_0x16dc5d(0x1b8)]=_0x23cc86,this['logger']=new core_1[(_0x16dc5d(0x1e3))](FlosumCommitJob_1[_0x16dc5d(0x1f8)]);}async[a125_0x4cc318(0x1db)](_0x118a4a,_0x2869b3,_0x5791fe,_0x5503ad){const _0x2d6fb1=a125_0x4cc318;if(!this[_0x2d6fb1(0x1ab)][_0x2d6fb1(0x217)]){this['logger'][_0x2d6fb1(0x1ea)]('Email\x20notifications\x20are\x20disabled.');return;}await new commit_to_git_completed_notification_1[(_0x2d6fb1(0x1de))]({'emails':_0x118a4a,'gitProvider':_0x2869b3,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1[_0x2d6fb1(0x1de)][_0x2d6fb1(0x1f8)],'repositoryName':_0x5791fe,'branchName':_0x5503ad})['execute']();}async['errorNotification'](_0x5053d9,_0x5b2e5e,_0x7e8b9f,_0x585804){const _0x4252f8=a125_0x4cc318;if(!this[_0x4252f8(0x1ab)][_0x4252f8(0x217)]){this[_0x4252f8(0x203)][_0x4252f8(0x1ea)]('Email\x20notifications\x20are\x20disabled.');return;}await new commit_to_git_error_notification_1[(_0x4252f8(0x21b))]({'emails':_0x5053d9,'gitProvider':_0x5b2e5e,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0x4252f8(0x21b)][_0x4252f8(0x1f8)],'repositoryName':_0x7e8b9f,'branchName':_0x585804})[_0x4252f8(0x200)]();}async[a125_0x4cc318(0x1e4)](){const _0x2d053c=a125_0x4cc318;try{if(this[_0x2d053c(0x1ab)][_0x2d053c(0x1eb)])this[_0x2d053c(0x1e7)]=await this[_0x2d053c(0x1b8)][_0x2d053c(0x1ca)](this[_0x2d053c(0x1ab)][_0x2d053c(0x1eb)]);else this['commitData'][_0x2d053c(0x1ad)]&&(this[_0x2d053c(0x1e7)]=await this[_0x2d053c(0x1b8)][_0x2d053c(0x1f0)](this[_0x2d053c(0x1ab)][_0x2d053c(0x1ad)]));}catch(_0x362cf0){throw new bad_request_error_1[(_0x2d053c(0x1b2))](errors_1[_0x2d053c(0x214)]);}}async[a125_0x4cc318(0x1d2)](){const _0x3c4bc6=a125_0x4cc318;if(!this[_0x3c4bc6(0x1ab)]['commitAttachmentId'])return[];await this[_0x3c4bc6(0x1fd)][_0x3c4bc6(0x1bc)](constants_1[_0x3c4bc6(0x21a)],this[_0x3c4bc6(0x1ab)][_0x3c4bc6(0x1df)],{'Name':(0x0,shortid_1[_0x3c4bc6(0x1f9)])()});const _0x4ea97e=await this[_0x3c4bc6(0x1fd)][_0x3c4bc6(0x1b5)](this[_0x3c4bc6(0x1ab)][_0x3c4bc6(0x1df)])[_0x3c4bc6(0x1a8)](_0x5b669d=>_0x5b669d[_0x3c4bc6(0x204)]('\x20')[_0x3c4bc6(0x1c7)](_0x7405a5=>_0x7405a5['trim']()));await this['salesforceService'][_0x3c4bc6(0x1d8)](this['commitData'][_0x3c4bc6(0x1df)]);const _0x5bcc4d=new salesforce_retriever_service_1['SalesforceRetrieverService'](this['salesforceService']);return await _0x5bcc4d[_0x3c4bc6(0x1cf)](_0x4ea97e);}async[a125_0x4cc318(0x1bb)](){const _0x1fd8fb=a125_0x4cc318;if(!this['commitData'][_0x1fd8fb(0x1fa)])return[];await this[_0x1fd8fb(0x1fd)]['patchObject'](constants_1[_0x1fd8fb(0x21a)],this[_0x1fd8fb(0x1ab)][_0x1fd8fb(0x1fa)],{'Name':(0x0,shortid_1[_0x1fd8fb(0x1f9)])()});const _0x192d7b=await this[_0x1fd8fb(0x1fd)][_0x1fd8fb(0x1b5)](this[_0x1fd8fb(0x1ab)]['deleteAttachmentId']),_0x4a09cb=JSON[_0x1fd8fb(0x213)](_0x192d7b);return await this['salesforceService']['deleteAttachment'](this[_0x1fd8fb(0x1ab)][_0x1fd8fb(0x1fa)]),_0x4a09cb;}async['getCommitDto'](){const _0x9abc63=a125_0x4cc318,_0x23f7ea=new commit_components_dto_1[(_0x9abc63(0x1f1))](),[_0x378d56,_0x4617a4]=await Promise['all']([this['getComponentsToWrite'](),this['getComponentsToDelete']()]);return _0x23f7ea[_0x9abc63(0x207)]=this[_0x9abc63(0x1ab)]['message'],_0x23f7ea[_0x9abc63(0x1d0)]=this[_0x9abc63(0x1ab)][_0x9abc63(0x1d0)],_0x23f7ea[_0x9abc63(0x1e9)]={'writed':_0x378d56,'deleted':_0x4617a4},_0x23f7ea['convertToSFDX']=this[_0x9abc63(0x1f2)][_0x9abc63(0x1be)],_0x23f7ea[_0x9abc63(0x215)]=this[_0x9abc63(0x219)],_0x23f7ea[_0x9abc63(0x1fb)]=this[_0x9abc63(0x1fb)],_0x23f7ea[_0x9abc63(0x1f4)]=this[_0x9abc63(0x1f2)][_0x9abc63(0x1c2)],_0x23f7ea['recordType']=this[_0x9abc63(0x1e7)][_0x9abc63(0x1e2)],_0x23f7ea;}async[a125_0x4cc318(0x1c8)](_0x489694=![]){const _0x769cbd=a125_0x4cc318;if(_0x489694)await this[_0x769cbd(0x1b8)][_0x769cbd(0x1da)](this[_0x769cbd(0x1e7)],{});else{const _0x386100=await this['repository']['branches']['getOne'](this[_0x769cbd(0x1fb)][_0x769cbd(0x1f8)]);this[_0x769cbd(0x1fc)][_0x769cbd(0x1d7)](this[_0x769cbd(0x1ec)]+'\x20Update\x20remote\x20state.');const _0x406cbc={[this[_0x769cbd(0x219)]['gitUrl']]:{'lastCommit':_0x386100[_0x769cbd(0x1dd)]}};await this[_0x769cbd(0x1b8)][_0x769cbd(0x1da)](this[_0x769cbd(0x1e7)],_0x406cbc);}}async['exec'](){const _0x56ef11=a125_0x4cc318,_0x299c7a=await this[_0x56ef11(0x1ac)]();await this[_0x56ef11(0x1b8)][_0x56ef11(0x1e5)](this[_0x56ef11(0x1e7)],_0x56ef11(0x1b1)),await this[_0x56ef11(0x1bd)]['run'](_0x299c7a,this[_0x56ef11(0x1ec)]),await this[_0x56ef11(0x1c8)](),await this[_0x56ef11(0x1b8)][_0x56ef11(0x1e5)](this['repositoryData'],_0x56ef11(0x1ee));}async['handleCommitJobError'](_0xec5c10){const _0x1fad7c=a125_0x4cc318;try{this[_0x1fad7c(0x1fc)]['error'](''+_0xec5c10),await this[_0x1fad7c(0x1fc)][_0x1fad7c(0x20d)](),await this['updateLastCommit'](!![]),await this[_0x1fad7c(0x1b8)][_0x1fad7c(0x1e5)](this[_0x1fad7c(0x1e7)],_0x1fad7c(0x1d4)),await this[_0x1fad7c(0x1db)]([this[_0x1fad7c(0x1ab)][_0x1fad7c(0x1d0)][_0x1fad7c(0x1dc)]],this['config'][_0x1fad7c(0x1c2)],this[_0x1fad7c(0x219)][_0x1fad7c(0x1f8)],this[_0x1fad7c(0x1fb)][_0x1fad7c(0x1f8)]);}catch(_0x4e8293){this[_0x1fad7c(0x203)][_0x1fad7c(0x1f3)](_0x4e8293),await this['errorNotification']([this[_0x1fad7c(0x1ab)]['user']['email']],this['config'][_0x1fad7c(0x1c2)],this[_0x1fad7c(0x219)][_0x1fad7c(0x1f8)],this['branch']['name']);}}async['run'](_0x57b10a){const _0x2be81a=a125_0x4cc318;try{this[_0x2be81a(0x1ab)]=_0x57b10a,this[_0x2be81a(0x1c0)]=typedi_1[_0x2be81a(0x1ae)][_0x2be81a(0x1ba)](providers_tokens_1[_0x2be81a(0x1c6)]['gitApiService']),this[_0x2be81a(0x20e)]=typedi_1['Container'][_0x2be81a(0x1ba)](providers_tokens_1['Tokens'][_0x2be81a(0x216)]),this[_0x2be81a(0x1f2)]=typedi_1[_0x2be81a(0x1ae)][_0x2be81a(0x1ba)](providers_tokens_1[_0x2be81a(0x1c6)][_0x2be81a(0x1f2)]),await this[_0x2be81a(0x1e4)](),this[_0x2be81a(0x219)]=await this[_0x2be81a(0x20e)]['getOne'](this['repositoryData'][_0x2be81a(0x1b0)]),this[_0x2be81a(0x1fb)]=await this[_0x2be81a(0x219)][_0x2be81a(0x20c)][_0x2be81a(0x1b7)](this[_0x2be81a(0x1e7)][_0x2be81a(0x1c3)]),this[_0x2be81a(0x1fc)]=typedi_1[_0x2be81a(0x1ae)][_0x2be81a(0x1ba)](providers_tokens_1[_0x2be81a(0x1c6)]['logger']),this[_0x2be81a(0x1ec)]=_0x2be81a(0x1c9)+this[_0x2be81a(0x1f2)][_0x2be81a(0x1c2)][_0x2be81a(0x1e1)]()+_0x2be81a(0x208)+this[_0x2be81a(0x1e7)]['repositoryName']+_0x2be81a(0x1b6)+this[_0x2be81a(0x1e7)]['branchName']+']\x20['+FlosumCommitJob_1[_0x2be81a(0x1f8)]+']';if(!this[_0x2be81a(0x1e7)])throw new bad_request_error_1['BadRequestError'](errors_1[_0x2be81a(0x218)]);await this[_0x2be81a(0x1fc)][_0x2be81a(0x1d7)](this[_0x2be81a(0x1ec)]+_0x2be81a(0x1cb))[_0x2be81a(0x20d)](),await this[_0x2be81a(0x1e8)]()[_0x2be81a(0x20a)](_0x28aea6=>this['handleCommitJobError'](_0x28aea6)),await this['completeNotification']([this['commitData']['user'][_0x2be81a(0x1dc)]],this[_0x2be81a(0x1f2)][_0x2be81a(0x1c2)],this['repository'][_0x2be81a(0x1f8)],this[_0x2be81a(0x1fb)]['name']);}catch(_0x10c8fe){this[_0x2be81a(0x1ab)]=undefined,this[_0x2be81a(0x203)]['error'](_0x10c8fe),await this[_0x2be81a(0x1b4)]([this[_0x2be81a(0x1ab)][_0x2be81a(0x1d0)][_0x2be81a(0x1dc)]],this[_0x2be81a(0x1f2)][_0x2be81a(0x1c2)],this[_0x2be81a(0x219)][_0x2be81a(0x1f8)],this[_0x2be81a(0x1fb)][_0x2be81a(0x1f8)]);throw _0x10c8fe;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a125_0x4cc318(0x1e0)],commit_components_job_1[a125_0x4cc318(0x1f7)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a125_0x4cc318(0x1c4)]=FlosumCommitJob;