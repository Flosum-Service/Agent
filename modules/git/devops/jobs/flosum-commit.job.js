const a105_0x5c49a9=a105_0x12e8;(function(_0x50d5a2,_0x152c17){const _0x44c53d=a105_0x12e8,_0x8edf1f=_0x50d5a2();while(!![]){try{const _0x1d5551=parseInt(_0x44c53d(0x9f))/0x1*(-parseInt(_0x44c53d(0xc9))/0x2)+parseInt(_0x44c53d(0x72))/0x3*(-parseInt(_0x44c53d(0x9c))/0x4)+parseInt(_0x44c53d(0xb1))/0x5+-parseInt(_0x44c53d(0x88))/0x6*(-parseInt(_0x44c53d(0xa9))/0x7)+-parseInt(_0x44c53d(0x6e))/0x8*(parseInt(_0x44c53d(0xc6))/0x9)+parseInt(_0x44c53d(0xb0))/0xa*(parseInt(_0x44c53d(0x9d))/0xb)+-parseInt(_0x44c53d(0xb8))/0xc*(-parseInt(_0x44c53d(0xbd))/0xd);if(_0x1d5551===_0x152c17)break;else _0x8edf1f['push'](_0x8edf1f['shift']());}catch(_0x41450b){_0x8edf1f['push'](_0x8edf1f['shift']());}}}(a105_0x40af,0xe4dbb));function a105_0x12e8(_0x3a255e,_0xb79122){const _0x1c892c=a105_0x40af();return a105_0x12e8=function(_0x38a81e,_0x534772){_0x38a81e=_0x38a81e-0x6e;let _0x40af7f=_0x1c892c[_0x38a81e];return _0x40af7f;},a105_0x12e8(_0x3a255e,_0xb79122);}const a105_0x534772=(function(){let _0x261a5d=!![];return function(_0x59d1b0,_0x443b50){const _0x310d33=_0x261a5d?function(){const _0x5f1b2f=a105_0x12e8;if(_0x443b50){const _0x29dc3c=_0x443b50[_0x5f1b2f(0x93)](_0x59d1b0,arguments);return _0x443b50=null,_0x29dc3c;}}:function(){};return _0x261a5d=![],_0x310d33;};}()),a105_0x38a81e=a105_0x534772(this,function(){const _0x186358=a105_0x12e8;return a105_0x38a81e[_0x186358(0xb6)]()[_0x186358(0xc5)](_0x186358(0xa6))['toString']()['constructor'](a105_0x38a81e)[_0x186358(0xc5)](_0x186358(0xa6));});a105_0x38a81e();'use strict';var __decorate=this&&this['__decorate']||function(_0x1f40f8,_0x3cb01f,_0x171874,_0x5c89d7){const _0x16ee9e=a105_0x12e8;var _0x25ac16=arguments['length'],_0x552c41=_0x25ac16<0x3?_0x3cb01f:_0x5c89d7===null?_0x5c89d7=Object[_0x16ee9e(0xa5)](_0x3cb01f,_0x171874):_0x5c89d7,_0x2e7d44;if(typeof Reflect==='object'&&typeof Reflect[_0x16ee9e(0x74)]===_0x16ee9e(0xa0))_0x552c41=Reflect[_0x16ee9e(0x74)](_0x1f40f8,_0x3cb01f,_0x171874,_0x5c89d7);else{for(var _0x8ffcc8=_0x1f40f8[_0x16ee9e(0xb9)]-0x1;_0x8ffcc8>=0x0;_0x8ffcc8--)if(_0x2e7d44=_0x1f40f8[_0x8ffcc8])_0x552c41=(_0x25ac16<0x3?_0x2e7d44(_0x552c41):_0x25ac16>0x3?_0x2e7d44(_0x3cb01f,_0x171874,_0x552c41):_0x2e7d44(_0x3cb01f,_0x171874))||_0x552c41;}return _0x25ac16>0x3&&_0x552c41&&Object[_0x16ee9e(0x99)](_0x3cb01f,_0x171874,_0x552c41),_0x552c41;},__metadata=this&&this['__metadata']||function(_0x37ed4a,_0x2acc60){const _0x598408=a105_0x12e8;if(typeof Reflect===_0x598408(0x77)&&typeof Reflect[_0x598408(0xc8)]==='function')return Reflect['metadata'](_0x37ed4a,_0x2acc60);},__importDefault=this&&this[a105_0x5c49a9(0xc3)]||function(_0x4bb396){const _0x4fc74d=a105_0x5c49a9;return _0x4bb396&&_0x4bb396[_0x4fc74d(0xac)]?_0x4bb396:{'default':_0x4bb396};},FlosumCommitJob_1;Object[a105_0x5c49a9(0x99)](exports,'__esModule',{'value':!![]}),exports['FlosumCommitJob']=void 0x0;function a105_0x40af(){const _0x1a7748=['decorate','repositoryData','gitApiService','object','./commit-components.job','branches','isConvertToSfdx','updateRemoteState','run','../../salesforce/services/salesforce-retriever.service','CommitComponentsDto','branchName','syncRepositoryId','then','gitProvider','retrieveAttachment','prefix','patchObject','CommitComponentsJob','SalesforceRetrieverService','6dSoOkQ','split','name','deleteAttachmentId','repositoryName','logger','message','getComponentsToWrite','gitUrl','repo','salesforceSync','apply','send','setStatus','salesforceService','repoService','convertToSFDX','defineProperty','../../salesforce/services/salesforce.service','get','4862852TKHoGn','17220313VFvTUD','config','3191QEaHrv','function','user','getOne','FlosumCommitJob','commitData','getOwnPropertyDescriptor','(((.+)+)+)+$',']\x20[Branch:\x20','commitJob','10915856jvsevv','Service','branch','__esModule','getRepositoryRecord','Tokens','commitAttachmentId','10aJIlMr','4479680rkxovc','gitRepoService','getBranchRecord','fetchRepositoryData','error','toString','sfLogger','22836MVCfRC','length','typedi','In\x20Progress','getCommitDto','4589dbbjcI','getComponentsToDelete','\x20Update\x20remote\x20state.','Completed','trim','log','__importDefault','BadRequestError','search','9HcIiOl','../../../../core/errors/bad-request.error','metadata','1118CATPrG','map','all','Logger','deleteAttachment','../../../../core','handleCommitJobError','ERR_UNKNOWN_SYNC_RECORD_ID','toUpperCase','design:paramtypes','Error','FLOSUM_ATTACHMENT','syncBranchId','../../../../constants','updateLastCommit',']\x20[Repository:\x20','default','Container','sha','exec','SalesforceSyncService','6045608cGfjQu','components','\x20Start\x20Flosum\x20commit\x20job.','repository','3hkwQZV','SalesforceService'];a105_0x40af=function(){return _0x1a7748;};return a105_0x40af();}const core_1=require(a105_0x5c49a9(0xce)),salesforce_service_1=require(a105_0x5c49a9(0x9a)),typedi_1=require(a105_0x5c49a9(0xba)),errors_1=require('../../../../constants/errors'),bad_request_error_1=require(a105_0x5c49a9(0xc7)),salesforce_retriever_service_1=require(a105_0x5c49a9(0x7d)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a105_0x5c49a9(0x78)),constants_1=require(a105_0x5c49a9(0xd6)),shortid_1=__importDefault(require('shortid')),providers_tokens_1=require('../../providers/providers.tokens');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x59ca95,_0x1c2881,_0x3bd1a8){const _0x36da94=a105_0x5c49a9;this[_0x36da94(0x96)]=_0x59ca95,this[_0x36da94(0xa8)]=_0x1c2881,this[_0x36da94(0x92)]=_0x3bd1a8,this['logger']=new core_1[(_0x36da94(0xcc))](FlosumCommitJob_1['name']);}async[a105_0x5c49a9(0xb4)](){const _0x563740=a105_0x5c49a9;try{if(this[_0x563740(0xa4)]['syncRepositoryId'])this[_0x563740(0x75)]=await this[_0x563740(0x92)][_0x563740(0xad)](this[_0x563740(0xa4)][_0x563740(0x80)]);else this['commitData']['syncBranchId']&&(this[_0x563740(0x75)]=await this['salesforceSync'][_0x563740(0xb3)](this[_0x563740(0xa4)][_0x563740(0xd5)]));}catch(_0x25b195){throw new bad_request_error_1[(_0x563740(0xc4))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a105_0x5c49a9(0x8f)](){const _0x3d8b81=a105_0x5c49a9;if(!this['commitData'][_0x3d8b81(0xaf)])return[];await this[_0x3d8b81(0x96)][_0x3d8b81(0x85)](constants_1['FLOSUM_ATTACHMENT'],this[_0x3d8b81(0xa4)][_0x3d8b81(0xaf)],{'Name':(0x0,shortid_1[_0x3d8b81(0xd9)])()});const _0x201867=await this['salesforceService'][_0x3d8b81(0x83)](this[_0x3d8b81(0xa4)][_0x3d8b81(0xaf)])[_0x3d8b81(0x81)](_0x397ff7=>_0x397ff7[_0x3d8b81(0x89)]('\x20')[_0x3d8b81(0xca)](_0x9d167a=>_0x9d167a[_0x3d8b81(0xc1)]()));await this[_0x3d8b81(0x96)]['deleteAttachment'](this[_0x3d8b81(0xa4)][_0x3d8b81(0xaf)]);const _0x51ef44=new salesforce_retriever_service_1[(_0x3d8b81(0x87))](this[_0x3d8b81(0x96)]);return await _0x51ef44['run'](_0x201867);}async[a105_0x5c49a9(0xbe)](){const _0x528756=a105_0x5c49a9;if(!this[_0x528756(0xa4)][_0x528756(0x8b)])return[];await this['salesforceService'][_0x528756(0x85)](constants_1[_0x528756(0xd4)],this['commitData'][_0x528756(0x8b)],{'Name':(0x0,shortid_1[_0x528756(0xd9)])()});const _0x228a8a=await this['salesforceService'][_0x528756(0x83)](this[_0x528756(0xa4)]['deleteAttachmentId']);return await this[_0x528756(0x96)][_0x528756(0xcd)](this[_0x528756(0xa4)][_0x528756(0x8b)]),_0x228a8a;}async[a105_0x5c49a9(0xbc)](){const _0x3e2ffc=a105_0x5c49a9,_0x3260a5=new commit_components_dto_1[(_0x3e2ffc(0x7e))](),[_0x4ebf99,_0x2988b9]=await Promise[_0x3e2ffc(0xcb)]([this['getComponentsToWrite'](),this['getComponentsToDelete']()]);return _0x3260a5['message']=this[_0x3e2ffc(0xa4)][_0x3e2ffc(0x8e)],_0x3260a5['user']=this[_0x3e2ffc(0xa4)][_0x3e2ffc(0xa1)],_0x3260a5[_0x3e2ffc(0x6f)]={'writed':_0x4ebf99,'deleted':_0x2988b9},_0x3260a5[_0x3e2ffc(0x98)]=this['config'][_0x3e2ffc(0x7a)],_0x3260a5[_0x3e2ffc(0x91)]=this[_0x3e2ffc(0x71)],_0x3260a5['branch']=this[_0x3e2ffc(0xab)],_0x3260a5['provider']=this['config'][_0x3e2ffc(0x82)],_0x3260a5;}async[a105_0x5c49a9(0xd7)](_0x180cc9=![]){const _0x3552f6=a105_0x5c49a9;if(_0x180cc9)await this[_0x3552f6(0x92)][_0x3552f6(0x7b)](this[_0x3552f6(0x75)],{});else{const _0x41a552=await this['repository'][_0x3552f6(0x79)]['getOne'](this[_0x3552f6(0xab)][_0x3552f6(0x8a)]);this[_0x3552f6(0xb7)][_0x3552f6(0xc2)](this['prefix']+_0x3552f6(0xbf));const _0x1b7948={[this['repository'][_0x3552f6(0x90)]]:{'lastCommit':_0x41a552[_0x3552f6(0xdb)]}};await this[_0x3552f6(0x92)][_0x3552f6(0x7b)](this['repositoryData'],_0x1b7948);}}async[a105_0x5c49a9(0xdc)](){const _0x53c3ee=a105_0x5c49a9,_0x2d3817=await this[_0x53c3ee(0xbc)]();await this[_0x53c3ee(0x92)][_0x53c3ee(0x95)](this['repositoryData'],_0x53c3ee(0xbb)),await this[_0x53c3ee(0xa8)]['run'](_0x2d3817,this[_0x53c3ee(0x84)]),await this[_0x53c3ee(0xd7)](),await this[_0x53c3ee(0x92)]['setStatus'](this[_0x53c3ee(0x75)],_0x53c3ee(0xc0));}async[a105_0x5c49a9(0xcf)](_0xe2162a){const _0x473ee9=a105_0x5c49a9;try{this['sfLogger'][_0x473ee9(0xb5)](''+_0xe2162a),await this[_0x473ee9(0xb7)]['send'](),await this[_0x473ee9(0xd7)](!![]),await this[_0x473ee9(0x92)]['setStatus'](this['repositoryData'],_0x473ee9(0xd3));}catch(_0x23b8a8){this[_0x473ee9(0x8d)][_0x473ee9(0xb5)](_0x23b8a8);}}async[a105_0x5c49a9(0x7c)](_0x59f370){const _0x4b17db=a105_0x5c49a9;try{this['commitData']=_0x59f370,this[_0x4b17db(0x76)]=typedi_1[_0x4b17db(0xda)][_0x4b17db(0x9b)](providers_tokens_1[_0x4b17db(0xae)]['gitApiService']),this[_0x4b17db(0x97)]=typedi_1['Container'][_0x4b17db(0x9b)](providers_tokens_1['Tokens'][_0x4b17db(0xb2)]),this[_0x4b17db(0x9e)]=typedi_1['Container'][_0x4b17db(0x9b)](providers_tokens_1[_0x4b17db(0xae)][_0x4b17db(0x9e)]),await this[_0x4b17db(0xb4)](),this[_0x4b17db(0x71)]=await this['repoService'][_0x4b17db(0xa2)](this[_0x4b17db(0x75)]['repositoryName']),this['branch']=await this['repository'][_0x4b17db(0x79)][_0x4b17db(0xa2)](this[_0x4b17db(0x75)][_0x4b17db(0x7f)]),this[_0x4b17db(0xb7)]=typedi_1[_0x4b17db(0xda)][_0x4b17db(0x9b)](providers_tokens_1[_0x4b17db(0xae)][_0x4b17db(0x8d)]),this[_0x4b17db(0x84)]='[FLOSUM\x20->\x20GIT]\x20['+this['config'][_0x4b17db(0x82)][_0x4b17db(0xd1)]()+_0x4b17db(0xd8)+this[_0x4b17db(0x75)][_0x4b17db(0x8c)]+_0x4b17db(0xa7)+this['repositoryData'][_0x4b17db(0x7f)]+']\x20['+FlosumCommitJob_1[_0x4b17db(0x8a)]+']';if(!this[_0x4b17db(0x75)])throw new bad_request_error_1[(_0x4b17db(0xc4))](errors_1[_0x4b17db(0xd0)]);await this['sfLogger'][_0x4b17db(0xc2)](this[_0x4b17db(0x84)]+_0x4b17db(0x70))[_0x4b17db(0x94)](),await this[_0x4b17db(0xdc)]()['catch'](_0x34a8a0=>this[_0x4b17db(0xcf)](_0x34a8a0));}catch(_0x53b1c7){this[_0x4b17db(0xa4)]=undefined,this[_0x4b17db(0x8d)][_0x4b17db(0xb5)](_0x53b1c7);throw _0x53b1c7;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x5c49a9(0xaa)])({'transient':!![]}),__metadata(a105_0x5c49a9(0xd2),[salesforce_service_1[a105_0x5c49a9(0x73)],commit_components_job_1[a105_0x5c49a9(0x86)],salesforce_sync_service_1[a105_0x5c49a9(0xdd)]])],FlosumCommitJob),exports[a105_0x5c49a9(0xa3)]=FlosumCommitJob;