const a105_0x4e512b=a105_0x5881;(function(_0x114bb4,_0x21ab4e){const _0x589010=a105_0x5881,_0x3dd5b2=_0x114bb4();while(!![]){try{const _0x2ede42=-parseInt(_0x589010(0x13c))/0x1*(-parseInt(_0x589010(0x15e))/0x2)+-parseInt(_0x589010(0x13f))/0x3+parseInt(_0x589010(0x18e))/0x4+-parseInt(_0x589010(0x15a))/0x5*(parseInt(_0x589010(0x14d))/0x6)+-parseInt(_0x589010(0x17b))/0x7+-parseInt(_0x589010(0x149))/0x8*(parseInt(_0x589010(0x13e))/0x9)+parseInt(_0x589010(0x16b))/0xa;if(_0x2ede42===_0x21ab4e)break;else _0x3dd5b2['push'](_0x3dd5b2['shift']());}catch(_0x5e4560){_0x3dd5b2['push'](_0x3dd5b2['shift']());}}}(a105_0x4b24,0x3e455));function a105_0x4b24(){const _0x5bb0b5=['exec','../../../../core','getOne','getComponentsToDelete','fetchRepositoryData','gitRepoService','all','config','../../../../core/errors/bad-request.error','5cCqNGt','function','sfLogger','logger','10546MYdctV','repoService','commitAttachmentId','getRepositoryRecord','message','commitJob','patchObject','Tokens','gitApiService','In\x20Progress','send','branches','components','6284430cfJsHE','__importDefault','get','convertToSFDX','__esModule','design:paramtypes','name','./commit-components.job','repository','FLOSUM_ATTACHMENT','../../../../constants','Service','toUpperCase','SalesforceRetrieverService','repo','trim','2469355LlnFWI','commitData','provider','catch','getCommitDto','\x20Update\x20remote\x20state.','deleteAttachment','deleteAttachmentId','apply','error','toString','CommitComponentsDto','Error','updateRemoteState','SalesforceService','map','updateLastCommit','../../salesforce/services/salesforce-sync.service','__decorate','942220eDasCB','getBranchRecord','FlosumCommitJob','metadata','getOwnPropertyDescriptor','../../salesforce/services/salesforce-retriever.service','search','gitUrl','branchName','getComponentsToWrite','repositoryData','prefix','gitProvider','\x20Start\x20Flosum\x20commit\x20job.','syncRepositoryId','Logger','Container','../dto/commit-components.dto','log','decorate','setStatus','[FLOSUM\x20->\x20GIT]\x20[','shortid','1zvjYzT','repositoryName','297vaytSl','150804dsxSlD','default','defineProperty','BadRequestError','CommitComponentsJob','length','isConvertToSfdx','salesforceService','SalesforceSyncService','run','30496RcaYxE','object','../../salesforce/services/salesforce.service',']\x20[Branch:\x20','512286gIfDTl','branch','salesforceSync','(((.+)+)+)+$'];a105_0x4b24=function(){return _0x5bb0b5;};return a105_0x4b24();}const a105_0x513420=(function(){let _0x48417a=!![];return function(_0x489f9a,_0x53ee32){const _0x19e6f9=_0x48417a?function(){const _0xbf20e0=a105_0x5881;if(_0x53ee32){const _0x4892dc=_0x53ee32[_0xbf20e0(0x183)](_0x489f9a,arguments);return _0x53ee32=null,_0x4892dc;}}:function(){};return _0x48417a=![],_0x19e6f9;};}()),a105_0x478a2e=a105_0x513420(this,function(){const _0x461311=a105_0x5881;return a105_0x478a2e[_0x461311(0x185)]()[_0x461311(0x194)](_0x461311(0x150))[_0x461311(0x185)]()['constructor'](a105_0x478a2e)[_0x461311(0x194)](_0x461311(0x150));});a105_0x478a2e();'use strict';function a105_0x5881(_0x554d09,_0x3ba06d){const _0x430929=a105_0x4b24();return a105_0x5881=function(_0x478a2e,_0x513420){_0x478a2e=_0x478a2e-0x135;let _0x4b24ec=_0x430929[_0x478a2e];return _0x4b24ec;},a105_0x5881(_0x554d09,_0x3ba06d);}var __decorate=this&&this[a105_0x4e512b(0x18d)]||function(_0x360e35,_0x32b407,_0x4945b4,_0x3b680d){const _0x3f69e8=a105_0x4e512b;var _0x2da7e4=arguments[_0x3f69e8(0x144)],_0x524b1b=_0x2da7e4<0x3?_0x32b407:_0x3b680d===null?_0x3b680d=Object[_0x3f69e8(0x192)](_0x32b407,_0x4945b4):_0x3b680d,_0x97d432;if(typeof Reflect===_0x3f69e8(0x14a)&&typeof Reflect[_0x3f69e8(0x138)]===_0x3f69e8(0x15b))_0x524b1b=Reflect[_0x3f69e8(0x138)](_0x360e35,_0x32b407,_0x4945b4,_0x3b680d);else{for(var _0x427c83=_0x360e35[_0x3f69e8(0x144)]-0x1;_0x427c83>=0x0;_0x427c83--)if(_0x97d432=_0x360e35[_0x427c83])_0x524b1b=(_0x2da7e4<0x3?_0x97d432(_0x524b1b):_0x2da7e4>0x3?_0x97d432(_0x32b407,_0x4945b4,_0x524b1b):_0x97d432(_0x32b407,_0x4945b4))||_0x524b1b;}return _0x2da7e4>0x3&&_0x524b1b&&Object[_0x3f69e8(0x141)](_0x32b407,_0x4945b4,_0x524b1b),_0x524b1b;},__metadata=this&&this['__metadata']||function(_0x5c52bc,_0x3e327e){const _0x2620a0=a105_0x4e512b;if(typeof Reflect==='object'&&typeof Reflect[_0x2620a0(0x191)]==='function')return Reflect[_0x2620a0(0x191)](_0x5c52bc,_0x3e327e);},__importDefault=this&&this[a105_0x4e512b(0x16c)]||function(_0x7ce25f){const _0x4f8ae3=a105_0x4e512b;return _0x7ce25f&&_0x7ce25f[_0x4f8ae3(0x16f)]?_0x7ce25f:{'default':_0x7ce25f};},FlosumCommitJob_1;Object['defineProperty'](exports,a105_0x4e512b(0x16f),{'value':!![]}),exports[a105_0x4e512b(0x190)]=void 0x0;const core_1=require(a105_0x4e512b(0x152)),salesforce_service_1=require(a105_0x4e512b(0x14b)),typedi_1=require('typedi'),errors_1=require('../../../../constants/errors'),bad_request_error_1=require(a105_0x4e512b(0x159)),salesforce_retriever_service_1=require(a105_0x4e512b(0x193)),salesforce_sync_service_1=require(a105_0x4e512b(0x18c)),commit_components_dto_1=require(a105_0x4e512b(0x136)),commit_components_job_1=require(a105_0x4e512b(0x172)),constants_1=require(a105_0x4e512b(0x175)),shortid_1=__importDefault(require(a105_0x4e512b(0x13b))),providers_tokens_1=require('../../providers/providers.tokens');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x2d80b4,_0x659060,_0x569f6e){const _0x30afb5=a105_0x4e512b;this[_0x30afb5(0x146)]=_0x2d80b4,this[_0x30afb5(0x163)]=_0x659060,this[_0x30afb5(0x14f)]=_0x569f6e,this[_0x30afb5(0x15d)]=new core_1[(_0x30afb5(0x19d))](FlosumCommitJob_1[_0x30afb5(0x171)]);}async[a105_0x4e512b(0x155)](){const _0xfc512=a105_0x4e512b;try{if(this[_0xfc512(0x17c)][_0xfc512(0x19c)])this[_0xfc512(0x198)]=await this[_0xfc512(0x14f)][_0xfc512(0x161)](this[_0xfc512(0x17c)][_0xfc512(0x19c)]);else this[_0xfc512(0x17c)]['syncBranchId']&&(this[_0xfc512(0x198)]=await this[_0xfc512(0x14f)][_0xfc512(0x18f)](this[_0xfc512(0x17c)]['syncBranchId']));}catch(_0xcdc112){throw new bad_request_error_1[(_0xfc512(0x142))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a105_0x4e512b(0x197)](){const _0x56ccfd=a105_0x4e512b;if(!this[_0x56ccfd(0x17c)]['commitAttachmentId'])return[];await this[_0x56ccfd(0x146)][_0x56ccfd(0x164)](constants_1[_0x56ccfd(0x174)],this[_0x56ccfd(0x17c)][_0x56ccfd(0x160)],{'Name':(0x0,shortid_1['default'])()});const _0x280211=await this[_0x56ccfd(0x146)]['retrieveAttachment'](this[_0x56ccfd(0x17c)][_0x56ccfd(0x160)])['then'](_0x4caf28=>_0x4caf28['split']('\x20')[_0x56ccfd(0x18a)](_0x55269d=>_0x55269d[_0x56ccfd(0x17a)]()));await this[_0x56ccfd(0x146)]['deleteAttachment'](this[_0x56ccfd(0x17c)][_0x56ccfd(0x160)]);const _0x183c31=new salesforce_retriever_service_1[(_0x56ccfd(0x178))](this[_0x56ccfd(0x146)]);return await _0x183c31['run'](_0x280211);}async[a105_0x4e512b(0x154)](){const _0x2e948b=a105_0x4e512b;if(!this[_0x2e948b(0x17c)]['deleteAttachmentId'])return[];await this[_0x2e948b(0x146)][_0x2e948b(0x164)](constants_1['FLOSUM_ATTACHMENT'],this[_0x2e948b(0x17c)][_0x2e948b(0x182)],{'Name':(0x0,shortid_1[_0x2e948b(0x140)])()});const _0x45b00b=await this[_0x2e948b(0x146)]['retrieveAttachment'](this[_0x2e948b(0x17c)][_0x2e948b(0x182)]);return await this[_0x2e948b(0x146)][_0x2e948b(0x181)](this[_0x2e948b(0x17c)]['deleteAttachmentId']),_0x45b00b;}async['getCommitDto'](){const _0x4818af=a105_0x4e512b,_0x46c354=new commit_components_dto_1[(_0x4818af(0x186))](),[_0xc70262,_0x21ddcd]=await Promise[_0x4818af(0x157)]([this['getComponentsToWrite'](),this[_0x4818af(0x154)]()]);return _0x46c354['message']=this[_0x4818af(0x17c)][_0x4818af(0x162)],_0x46c354['user']=this[_0x4818af(0x17c)]['user'],_0x46c354[_0x4818af(0x16a)]={'writed':_0xc70262,'deleted':_0x21ddcd},_0x46c354[_0x4818af(0x16e)]=this[_0x4818af(0x158)][_0x4818af(0x145)],_0x46c354[_0x4818af(0x179)]=this[_0x4818af(0x173)],_0x46c354['branch']=this['branch'],_0x46c354[_0x4818af(0x17d)]=this['config']['gitProvider'],_0x46c354;}async[a105_0x4e512b(0x18b)](_0xfc7091=![]){const _0x2f0740=a105_0x4e512b;if(_0xfc7091)await this[_0x2f0740(0x14f)]['updateRemoteState'](this['repositoryData'],{});else{const _0x25c403=await this[_0x2f0740(0x173)][_0x2f0740(0x169)][_0x2f0740(0x153)](this[_0x2f0740(0x14e)][_0x2f0740(0x171)]);this['sfLogger'][_0x2f0740(0x137)](this[_0x2f0740(0x199)]+_0x2f0740(0x180));const _0x10da8b={[this[_0x2f0740(0x173)][_0x2f0740(0x195)]]:{'lastCommit':_0x25c403['sha']}};await this['salesforceSync'][_0x2f0740(0x188)](this['repositoryData'],_0x10da8b);}}async[a105_0x4e512b(0x151)](){const _0x5de63f=a105_0x4e512b,_0x524ae5=await this[_0x5de63f(0x17f)]();await this[_0x5de63f(0x14f)]['setStatus'](this['repositoryData'],_0x5de63f(0x167)),await this['commitJob'][_0x5de63f(0x148)](_0x524ae5,this[_0x5de63f(0x199)]),await this[_0x5de63f(0x18b)](),await this[_0x5de63f(0x14f)]['setStatus'](this[_0x5de63f(0x198)],'Completed');}async['handleCommitJobError'](_0x1ba8ec){const _0x56f849=a105_0x4e512b;try{this[_0x56f849(0x15c)][_0x56f849(0x184)](''+_0x1ba8ec),await this[_0x56f849(0x15c)][_0x56f849(0x168)](),await this[_0x56f849(0x18b)](!![]),await this[_0x56f849(0x14f)][_0x56f849(0x139)](this[_0x56f849(0x198)],_0x56f849(0x187));}catch(_0x1df4a0){this['logger'][_0x56f849(0x184)](_0x1df4a0);}}async['run'](_0x3103b4){const _0x310f65=a105_0x4e512b;try{this[_0x310f65(0x17c)]=_0x3103b4,this['gitApiService']=typedi_1[_0x310f65(0x135)][_0x310f65(0x16d)](providers_tokens_1[_0x310f65(0x165)][_0x310f65(0x166)]),this[_0x310f65(0x15f)]=typedi_1[_0x310f65(0x135)][_0x310f65(0x16d)](providers_tokens_1[_0x310f65(0x165)][_0x310f65(0x156)]),this[_0x310f65(0x158)]=typedi_1['Container'][_0x310f65(0x16d)](providers_tokens_1['Tokens']['config']),await this[_0x310f65(0x155)](),this[_0x310f65(0x173)]=await this[_0x310f65(0x15f)][_0x310f65(0x153)](this[_0x310f65(0x198)]['repositoryName']),this[_0x310f65(0x14e)]=await this[_0x310f65(0x173)]['branches'][_0x310f65(0x153)](this[_0x310f65(0x198)]['branchName']),this[_0x310f65(0x15c)]=typedi_1[_0x310f65(0x135)]['get'](providers_tokens_1[_0x310f65(0x165)][_0x310f65(0x15d)]),this[_0x310f65(0x199)]=_0x310f65(0x13a)+this[_0x310f65(0x158)][_0x310f65(0x19a)][_0x310f65(0x177)]()+']\x20[Repository:\x20'+this[_0x310f65(0x198)][_0x310f65(0x13d)]+_0x310f65(0x14c)+this[_0x310f65(0x198)][_0x310f65(0x196)]+']\x20['+FlosumCommitJob_1[_0x310f65(0x171)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x310f65(0x142))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x310f65(0x15c)][_0x310f65(0x137)](this[_0x310f65(0x199)]+_0x310f65(0x19b))[_0x310f65(0x168)](),await this[_0x310f65(0x151)]()[_0x310f65(0x17e)](_0x268eb7=>this['handleCommitJobError'](_0x268eb7));}catch(_0x1035d2){this[_0x310f65(0x17c)]=undefined,this[_0x310f65(0x15d)][_0x310f65(0x184)](_0x1035d2);throw _0x1035d2;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x4e512b(0x176)])({'transient':!![]}),__metadata(a105_0x4e512b(0x170),[salesforce_service_1[a105_0x4e512b(0x189)],commit_components_job_1[a105_0x4e512b(0x143)],salesforce_sync_service_1[a105_0x4e512b(0x147)]])],FlosumCommitJob),exports[a105_0x4e512b(0x190)]=FlosumCommitJob;