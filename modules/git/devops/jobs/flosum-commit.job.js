const a74_0x2d3025=a74_0x204e;(function(_0x166df9,_0x6eb800){const _0x5c7562=a74_0x204e,_0x18d70e=_0x166df9();while(!![]){try{const _0x4b963e=parseInt(_0x5c7562(0x224))/0x1+parseInt(_0x5c7562(0x1eb))/0x2+parseInt(_0x5c7562(0x1e1))/0x3+parseInt(_0x5c7562(0x1ec))/0x4*(parseInt(_0x5c7562(0x23c))/0x5)+parseInt(_0x5c7562(0x24e))/0x6+-parseInt(_0x5c7562(0x1e8))/0x7*(parseInt(_0x5c7562(0x1e2))/0x8)+-parseInt(_0x5c7562(0x21d))/0x9*(parseInt(_0x5c7562(0x200))/0xa);if(_0x4b963e===_0x6eb800)break;else _0x18d70e['push'](_0x18d70e['shift']());}catch(_0x24d09e){_0x18d70e['push'](_0x18d70e['shift']());}}}(a74_0x1a08,0x80d06));const a74_0xfae317=(function(){let _0x4c042a=!![];return function(_0x32a326,_0x2cffdb){const _0x1bd916=_0x4c042a?function(){const _0x578aec=a74_0x204e;if(_0x2cffdb){const _0x33dcd1=_0x2cffdb[_0x578aec(0x236)](_0x32a326,arguments);return _0x2cffdb=null,_0x33dcd1;}}:function(){};return _0x4c042a=![],_0x1bd916;};}()),a74_0x529894=a74_0xfae317(this,function(){const _0x7d63e=a74_0x204e;return a74_0x529894[_0x7d63e(0x221)]()[_0x7d63e(0x1f5)]('(((.+)+)+)+$')[_0x7d63e(0x221)]()[_0x7d63e(0x21c)](a74_0x529894)[_0x7d63e(0x1f5)](_0x7d63e(0x1f2));});a74_0x529894();function a74_0x204e(_0x1d76bf,_0x24510c){const _0x166315=a74_0x1a08();return a74_0x204e=function(_0x529894,_0xfae317){_0x529894=_0x529894-0x1df;let _0x1a0889=_0x166315[_0x529894];return _0x1a0889;},a74_0x204e(_0x1d76bf,_0x24510c);}'use strict';var __decorate=this&&this[a74_0x2d3025(0x245)]||function(_0x28968c,_0x5877f3,_0x210c2b,_0xc01cac){const _0x3d6f1f=a74_0x2d3025;var _0x4b5d5f=arguments[_0x3d6f1f(0x22c)],_0x3c1f31=_0x4b5d5f<0x3?_0x5877f3:_0xc01cac===null?_0xc01cac=Object[_0x3d6f1f(0x210)](_0x5877f3,_0x210c2b):_0xc01cac,_0x5feb17;if(typeof Reflect===_0x3d6f1f(0x1e5)&&typeof Reflect[_0x3d6f1f(0x22e)]===_0x3d6f1f(0x1f6))_0x3c1f31=Reflect[_0x3d6f1f(0x22e)](_0x28968c,_0x5877f3,_0x210c2b,_0xc01cac);else{for(var _0x259897=_0x28968c[_0x3d6f1f(0x22c)]-0x1;_0x259897>=0x0;_0x259897--)if(_0x5feb17=_0x28968c[_0x259897])_0x3c1f31=(_0x4b5d5f<0x3?_0x5feb17(_0x3c1f31):_0x4b5d5f>0x3?_0x5feb17(_0x5877f3,_0x210c2b,_0x3c1f31):_0x5feb17(_0x5877f3,_0x210c2b))||_0x3c1f31;}return _0x4b5d5f>0x3&&_0x3c1f31&&Object[_0x3d6f1f(0x22f)](_0x5877f3,_0x210c2b,_0x3c1f31),_0x3c1f31;},__metadata=this&&this[a74_0x2d3025(0x228)]||function(_0x38546c,_0x10de6f){const _0x1d083c=a74_0x2d3025;if(typeof Reflect==='object'&&typeof Reflect[_0x1d083c(0x206)]===_0x1d083c(0x1f6))return Reflect[_0x1d083c(0x206)](_0x38546c,_0x10de6f);},__importDefault=this&&this[a74_0x2d3025(0x216)]||function(_0x14bc4d){return _0x14bc4d&&_0x14bc4d['__esModule']?_0x14bc4d:{'default':_0x14bc4d};},FlosumCommitJob_1;function a74_0x1a08(){const _0x165055=['map','branch','commitAttachmentId','length','send','decorate','defineProperty','getComponentsToWrite','Error','config','commitData','log','syncRepositoryId','apply','repoService','Tokens','provider','./commit-components.job','FLOSUM_ATTACHMENT','10ylaWFQ','gitApiService','FlosumCommitJob','getBranchRecord','../../../../core/errors/bad-request.error','commitJob','deleteAttachmentId',']\x20[Repository:\x20','CommitComponentsJob','__decorate','[FLOSUM\x20->\x20GIT]\x20[','CommitComponentsDto','error','split','handleCommitJobError','retrieveAttachment','BadRequestError','isConvertToSfdx','3598416fXaxWW','typedi','all','default','1484517thVrYu','98288uOoQap','sfLogger','getRepositoryRecord','object','run','salesforceService','231DVEPRX',']\x20[','branches','664030eSbUhu','842020ZClkBO','\x20Update\x20remote\x20state.','../../salesforce/services/salesforce-retriever.service','updateLastCommit','syncBranchId','../../salesforce/services/salesforce-sync.service','(((.+)+)+)+$','trim','design:paramtypes','search','function','convertToSFDX','fetchRepositoryData','repositoryName','name','Completed','message','../../../../core','\x20Start\x20Flosum\x20commit\x20job.','repositoryData','11650WrympN','__esModule','SalesforceSyncService','shortid','get','setStatus','metadata','logger','gitProvider','Logger','ERR_INVALID_SYNC_RECORD_ID','sha','components','patchObject','repository','repo','getOwnPropertyDescriptor','ERR_UNKNOWN_SYNC_RECORD_ID','deleteAttachment','../../salesforce/services/salesforce.service','getOne','salesforceSync','__importDefault','then','user','Service','branchName','prefix','constructor','7893SoIEpv','In\x20Progress','catch','gitRepoService','toString','getComponentsToDelete','Container','107165RLhxRc','updateRemoteState','exec','../../providers/providers.tokens','__metadata'];a74_0x1a08=function(){return _0x165055;};return a74_0x1a08();}Object[a74_0x2d3025(0x22f)](exports,a74_0x2d3025(0x201),{'value':!![]}),exports[a74_0x2d3025(0x23e)]=void 0x0;const core_1=require(a74_0x2d3025(0x1fd)),salesforce_service_1=require(a74_0x2d3025(0x213)),typedi_1=require(a74_0x2d3025(0x24f)),errors_1=require('../../../../constants/errors'),bad_request_error_1=require(a74_0x2d3025(0x240)),salesforce_retriever_service_1=require(a74_0x2d3025(0x1ee)),salesforce_sync_service_1=require(a74_0x2d3025(0x1f1)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a74_0x2d3025(0x23a)),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a74_0x2d3025(0x203))),providers_tokens_1=require(a74_0x2d3025(0x227));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x145cda,_0x1b400a,_0x5785fd){const _0x1b6ef7=a74_0x2d3025;this['salesforceService']=_0x145cda,this[_0x1b6ef7(0x241)]=_0x1b400a,this[_0x1b6ef7(0x215)]=_0x5785fd,this['logger']=new core_1[(_0x1b6ef7(0x209))](FlosumCommitJob_1[_0x1b6ef7(0x1fa)]);}async[a74_0x2d3025(0x1f8)](){const _0x2112df=a74_0x2d3025;try{if(this['commitData'][_0x2112df(0x235)])this[_0x2112df(0x1ff)]=await this['salesforceSync'][_0x2112df(0x1e4)](this[_0x2112df(0x233)][_0x2112df(0x235)]);else this[_0x2112df(0x233)][_0x2112df(0x1f0)]&&(this[_0x2112df(0x1ff)]=await this[_0x2112df(0x215)][_0x2112df(0x23f)](this['commitData'][_0x2112df(0x1f0)]));}catch(_0x16fc4c){throw new bad_request_error_1[(_0x2112df(0x24c))](errors_1[_0x2112df(0x20a)]);}}async['getComponentsToWrite'](){const _0x26bf85=a74_0x2d3025;if(!this['commitData'][_0x26bf85(0x22b)])return[];await this[_0x26bf85(0x1e7)][_0x26bf85(0x20d)](constants_1[_0x26bf85(0x23b)],this['commitData']['commitAttachmentId'],{'Name':(0x0,shortid_1[_0x26bf85(0x1e0)])()});const _0xd7c50b=await this['salesforceService']['retrieveAttachment'](this[_0x26bf85(0x233)]['commitAttachmentId'])[_0x26bf85(0x217)](_0x5ed58b=>_0x5ed58b[_0x26bf85(0x249)]('\x20')[_0x26bf85(0x229)](_0xbc4f62=>_0xbc4f62[_0x26bf85(0x1f3)]()));await this[_0x26bf85(0x1e7)][_0x26bf85(0x212)](this['commitData']['commitAttachmentId']);const _0x362733=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x26bf85(0x1e7)]);return await _0x362733[_0x26bf85(0x1e6)](_0xd7c50b);}async[a74_0x2d3025(0x222)](){const _0x1504c6=a74_0x2d3025;if(!this[_0x1504c6(0x233)][_0x1504c6(0x242)])return[];await this[_0x1504c6(0x1e7)]['patchObject'](constants_1['FLOSUM_ATTACHMENT'],this[_0x1504c6(0x233)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0x1504c6(0x1e0)])()});const _0x12de79=await this[_0x1504c6(0x1e7)][_0x1504c6(0x24b)](this[_0x1504c6(0x233)]['deleteAttachmentId']);return await this['salesforceService']['deleteAttachment'](this[_0x1504c6(0x233)][_0x1504c6(0x242)]),_0x12de79;}async['getCommitDto'](){const _0x5c650c=a74_0x2d3025,_0x2d9240=new commit_components_dto_1[(_0x5c650c(0x247))](),[_0x22d773,_0x290600]=await Promise[_0x5c650c(0x1df)]([this[_0x5c650c(0x230)](),this[_0x5c650c(0x222)]()]);return _0x2d9240[_0x5c650c(0x1fc)]=this[_0x5c650c(0x233)]['message'],_0x2d9240['user']=this[_0x5c650c(0x233)][_0x5c650c(0x218)],_0x2d9240[_0x5c650c(0x20c)]={'writed':_0x22d773,'deleted':_0x290600},_0x2d9240[_0x5c650c(0x1f7)]=this[_0x5c650c(0x232)][_0x5c650c(0x24d)],_0x2d9240[_0x5c650c(0x20f)]=this['repository'],_0x2d9240[_0x5c650c(0x22a)]=this['branch'],_0x2d9240[_0x5c650c(0x239)]=this[_0x5c650c(0x232)][_0x5c650c(0x208)],_0x2d9240;}async[a74_0x2d3025(0x1ef)](_0x3f615a=![]){const _0x519f29=a74_0x2d3025;if(_0x3f615a)await this[_0x519f29(0x215)][_0x519f29(0x225)](this[_0x519f29(0x1ff)],{});else{const _0x45fcc5=await this['repository'][_0x519f29(0x1ea)][_0x519f29(0x214)](this[_0x519f29(0x22a)][_0x519f29(0x1fa)]);this[_0x519f29(0x1e3)][_0x519f29(0x234)](this[_0x519f29(0x21b)]+_0x519f29(0x1ed));const _0x4f9aec={[this['repository']['gitUrl']]:{'lastCommit':_0x45fcc5[_0x519f29(0x20b)]}};await this[_0x519f29(0x215)][_0x519f29(0x225)](this[_0x519f29(0x1ff)],_0x4f9aec);}}async[a74_0x2d3025(0x226)](){const _0x1bcd93=a74_0x2d3025,_0x4c2c60=await this['getCommitDto']();await this['salesforceSync'][_0x1bcd93(0x205)](this['repositoryData'],_0x1bcd93(0x21e)),await this[_0x1bcd93(0x241)][_0x1bcd93(0x1e6)](_0x4c2c60,this[_0x1bcd93(0x21b)]),await this[_0x1bcd93(0x1ef)](),await this['salesforceSync'][_0x1bcd93(0x205)](this[_0x1bcd93(0x1ff)],_0x1bcd93(0x1fb));}async['handleCommitJobError'](_0x478308){const _0x6c53b6=a74_0x2d3025;try{this[_0x6c53b6(0x1e3)]['error'](''+_0x478308),await this[_0x6c53b6(0x1e3)][_0x6c53b6(0x22d)](),await this['updateLastCommit'](!![]),await this[_0x6c53b6(0x215)][_0x6c53b6(0x205)](this[_0x6c53b6(0x1ff)],_0x6c53b6(0x231));}catch(_0x39c1e7){this[_0x6c53b6(0x207)][_0x6c53b6(0x248)](_0x39c1e7);}}async[a74_0x2d3025(0x1e6)](_0xcd7eb9){const _0x448048=a74_0x2d3025;try{this[_0x448048(0x233)]=_0xcd7eb9,this[_0x448048(0x23d)]=typedi_1[_0x448048(0x223)][_0x448048(0x204)](providers_tokens_1['Tokens'][_0x448048(0x23d)]),this[_0x448048(0x237)]=typedi_1[_0x448048(0x223)]['get'](providers_tokens_1[_0x448048(0x238)][_0x448048(0x220)]),this[_0x448048(0x232)]=typedi_1[_0x448048(0x223)][_0x448048(0x204)](providers_tokens_1['Tokens']['config']),await this[_0x448048(0x1f8)](),this[_0x448048(0x20e)]=await this[_0x448048(0x237)]['getOne'](this[_0x448048(0x1ff)][_0x448048(0x1f9)]),this[_0x448048(0x22a)]=await this[_0x448048(0x20e)][_0x448048(0x1ea)][_0x448048(0x214)](this['repositoryData']['branchName']),this['sfLogger']=typedi_1[_0x448048(0x223)][_0x448048(0x204)](providers_tokens_1['Tokens'][_0x448048(0x207)]),this[_0x448048(0x21b)]=_0x448048(0x246)+this[_0x448048(0x232)][_0x448048(0x208)]['toUpperCase']()+_0x448048(0x243)+this[_0x448048(0x1ff)][_0x448048(0x1f9)]+']\x20[Branch:\x20'+this['repositoryData'][_0x448048(0x21a)]+_0x448048(0x1e9)+FlosumCommitJob_1[_0x448048(0x1fa)]+']';if(!this[_0x448048(0x1ff)])throw new bad_request_error_1[(_0x448048(0x24c))](errors_1[_0x448048(0x211)]);await this['sfLogger']['log'](this['prefix']+_0x448048(0x1fe))[_0x448048(0x22d)](),await this[_0x448048(0x226)]()[_0x448048(0x21f)](_0x1469bf=>this[_0x448048(0x24a)](_0x1469bf));}catch(_0x512a5f){this[_0x448048(0x233)]=undefined,this[_0x448048(0x207)]['error'](_0x512a5f);throw _0x512a5f;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a74_0x2d3025(0x219)])({'transient':!![]}),__metadata(a74_0x2d3025(0x1f4),[salesforce_service_1['SalesforceService'],commit_components_job_1[a74_0x2d3025(0x244)],salesforce_sync_service_1[a74_0x2d3025(0x202)]])],FlosumCommitJob),exports[a74_0x2d3025(0x23e)]=FlosumCommitJob;