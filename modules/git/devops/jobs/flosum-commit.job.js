const a105_0x73a263=a105_0x55f8;(function(_0xb0795,_0x2ba773){const _0x349f63=a105_0x55f8,_0x13ee51=_0xb0795();while(!![]){try{const _0x3eacfc=-parseInt(_0x349f63(0x122))/0x1+-parseInt(_0x349f63(0x11b))/0x2*(-parseInt(_0x349f63(0x150))/0x3)+-parseInt(_0x349f63(0x108))/0x4+-parseInt(_0x349f63(0x15c))/0x5+parseInt(_0x349f63(0xfe))/0x6*(-parseInt(_0x349f63(0x12c))/0x7)+parseInt(_0x349f63(0x103))/0x8*(parseInt(_0x349f63(0x146))/0x9)+parseInt(_0x349f63(0x112))/0xa*(parseInt(_0x349f63(0x11a))/0xb);if(_0x3eacfc===_0x2ba773)break;else _0x13ee51['push'](_0x13ee51['shift']());}catch(_0x72be2e){_0x13ee51['push'](_0x13ee51['shift']());}}}(a105_0x1762,0x88644));const a105_0x43e23e=(function(){let _0x45e666=!![];return function(_0x33f8ee,_0x897c4a){const _0x40ad6e=_0x45e666?function(){if(_0x897c4a){const _0x2aa1f4=_0x897c4a['apply'](_0x33f8ee,arguments);return _0x897c4a=null,_0x2aa1f4;}}:function(){};return _0x45e666=![],_0x40ad6e;};}()),a105_0x5772c7=a105_0x43e23e(this,function(){const _0x1715d8=a105_0x55f8;return a105_0x5772c7['toString']()[_0x1715d8(0xfb)](_0x1715d8(0x151))[_0x1715d8(0x132)]()[_0x1715d8(0xf9)](a105_0x5772c7)['search']('(((.+)+)+)+$');});function a105_0x55f8(_0x1a5e07,_0x1749e5){const _0x203b33=a105_0x1762();return a105_0x55f8=function(_0x5772c7,_0x43e23e){_0x5772c7=_0x5772c7-0xf9;let _0x1762cb=_0x203b33[_0x5772c7];return _0x1762cb;},a105_0x55f8(_0x1a5e07,_0x1749e5);}a105_0x5772c7();'use strict';var __decorate=this&&this['__decorate']||function(_0x23a965,_0x5677a1,_0x50e18d,_0x10c783){const _0x16fe10=a105_0x55f8;var _0x5bc4ad=arguments[_0x16fe10(0x10a)],_0x21483d=_0x5bc4ad<0x3?_0x5677a1:_0x10c783===null?_0x10c783=Object['getOwnPropertyDescriptor'](_0x5677a1,_0x50e18d):_0x10c783,_0x534411;if(typeof Reflect===_0x16fe10(0x10c)&&typeof Reflect['decorate']===_0x16fe10(0x14e))_0x21483d=Reflect[_0x16fe10(0x12a)](_0x23a965,_0x5677a1,_0x50e18d,_0x10c783);else{for(var _0xf38bfc=_0x23a965[_0x16fe10(0x10a)]-0x1;_0xf38bfc>=0x0;_0xf38bfc--)if(_0x534411=_0x23a965[_0xf38bfc])_0x21483d=(_0x5bc4ad<0x3?_0x534411(_0x21483d):_0x5bc4ad>0x3?_0x534411(_0x5677a1,_0x50e18d,_0x21483d):_0x534411(_0x5677a1,_0x50e18d))||_0x21483d;}return _0x5bc4ad>0x3&&_0x21483d&&Object[_0x16fe10(0x119)](_0x5677a1,_0x50e18d,_0x21483d),_0x21483d;},__metadata=this&&this[a105_0x73a263(0x15a)]||function(_0x1c74be,_0x4940d4){const _0x504ad5=a105_0x73a263;if(typeof Reflect===_0x504ad5(0x10c)&&typeof Reflect[_0x504ad5(0x11e)]==='function')return Reflect[_0x504ad5(0x11e)](_0x1c74be,_0x4940d4);},__importDefault=this&&this['__importDefault']||function(_0x43a263){const _0x39abf6=a105_0x73a263;return _0x43a263&&_0x43a263[_0x39abf6(0x102)]?_0x43a263:{'default':_0x43a263};},FlosumCommitJob_1;Object[a105_0x73a263(0x119)](exports,'__esModule',{'value':!![]}),exports['FlosumCommitJob']=void 0x0;function a105_0x1762(){const _0x53a774=['handleCommitJobError','1119834bLsFrE','branch','error','../../../../constants/errors','../../../../constants','commitJob','branchName','setStatus','function','../../../../core','1575VjVpOB','(((.+)+)+)+$','send','shortid','../../salesforce/services/salesforce-retriever.service','get','getOne','SalesforceRetrieverService','name','getComponentsToDelete','__metadata','retrieveAttachment','1277530PXhmkM','Logger','getRepositoryRecord','constructor','repository','search','sha','fetchRepositoryData','222ngRwNi','catch','toUpperCase','\x20Update\x20remote\x20state.','__esModule','56dhxGRJ','message','FLOSUM_ATTACHMENT','updateLastCommit','SalesforceService','3805368WMgvRt','repoService','length','split','object','deleteAttachment','ERR_UNKNOWN_SYNC_RECORD_ID','../../../../core/errors/bad-request.error','gitProvider','commitAttachmentId','150okohSr','[FLOSUM\x20->\x20GIT]\x20[','../../providers/providers.tokens','user','branches','trim','SalesforceSyncService','defineProperty','850729FzDccy','3174LYyIKa','logger','deleteAttachmentId','metadata','config','repo','exec','137363KrWoxd','typedi','default','salesforceService',']\x20[Repository:\x20','repositoryData','../../salesforce/services/salesforce-sync.service','run','decorate','Error','181881vZZFBy','./commit-components.job','\x20Start\x20Flosum\x20commit\x20job.',']\x20[Branch:\x20','commitData','gitApiService','toString','Service','syncRepositoryId','gitUrl','components','In\x20Progress','ERR_INVALID_SYNC_RECORD_ID','Tokens','../../salesforce/services/salesforce.service','salesforceSync','sfLogger','updateRemoteState','prefix','getCommitDto','design:paramtypes','Container','map','patchObject','getBranchRecord'];a105_0x1762=function(){return _0x53a774;};return a105_0x1762();}const core_1=require(a105_0x73a263(0x14f)),salesforce_service_1=require(a105_0x73a263(0x13a)),typedi_1=require(a105_0x73a263(0x123)),errors_1=require(a105_0x73a263(0x149)),bad_request_error_1=require(a105_0x73a263(0x10f)),salesforce_retriever_service_1=require(a105_0x73a263(0x154)),salesforce_sync_service_1=require(a105_0x73a263(0x128)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a105_0x73a263(0x12d)),constants_1=require(a105_0x73a263(0x14a)),shortid_1=__importDefault(require(a105_0x73a263(0x153))),providers_tokens_1=require(a105_0x73a263(0x114));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x254f5f,_0x21521b,_0x55a841){const _0x33ce6b=a105_0x73a263;this[_0x33ce6b(0x125)]=_0x254f5f,this[_0x33ce6b(0x14b)]=_0x21521b,this['salesforceSync']=_0x55a841,this['logger']=new core_1[(_0x33ce6b(0x15d))](FlosumCommitJob_1[_0x33ce6b(0x158)]);}async['fetchRepositoryData'](){const _0x444a1c=a105_0x73a263;try{if(this['commitData']['syncRepositoryId'])this[_0x444a1c(0x127)]=await this['salesforceSync'][_0x444a1c(0x15e)](this[_0x444a1c(0x130)][_0x444a1c(0x134)]);else this['commitData']['syncBranchId']&&(this[_0x444a1c(0x127)]=await this[_0x444a1c(0x13b)][_0x444a1c(0x144)](this[_0x444a1c(0x130)]['syncBranchId']));}catch(_0xa416bc){throw new bad_request_error_1['BadRequestError'](errors_1[_0x444a1c(0x138)]);}}async['getComponentsToWrite'](){const _0xb4a0ef=a105_0x73a263;if(!this[_0xb4a0ef(0x130)]['commitAttachmentId'])return[];await this[_0xb4a0ef(0x125)]['patchObject'](constants_1[_0xb4a0ef(0x105)],this[_0xb4a0ef(0x130)]['commitAttachmentId'],{'Name':(0x0,shortid_1[_0xb4a0ef(0x124)])()});const _0x330b5e=await this[_0xb4a0ef(0x125)][_0xb4a0ef(0x15b)](this['commitData'][_0xb4a0ef(0x111)])['then'](_0x46fa5b=>_0x46fa5b[_0xb4a0ef(0x10b)]('\x20')[_0xb4a0ef(0x142)](_0x663215=>_0x663215[_0xb4a0ef(0x117)]()));await this[_0xb4a0ef(0x125)][_0xb4a0ef(0x10d)](this[_0xb4a0ef(0x130)]['commitAttachmentId']);const _0x598984=new salesforce_retriever_service_1[(_0xb4a0ef(0x157))](this[_0xb4a0ef(0x125)]);return await _0x598984['run'](_0x330b5e);}async[a105_0x73a263(0x159)](){const _0x5cfa3d=a105_0x73a263;if(!this['commitData'][_0x5cfa3d(0x11d)])return[];await this[_0x5cfa3d(0x125)][_0x5cfa3d(0x143)](constants_1[_0x5cfa3d(0x105)],this[_0x5cfa3d(0x130)][_0x5cfa3d(0x11d)],{'Name':(0x0,shortid_1['default'])()});const _0x5ed948=await this[_0x5cfa3d(0x125)][_0x5cfa3d(0x15b)](this[_0x5cfa3d(0x130)][_0x5cfa3d(0x11d)]);return await this[_0x5cfa3d(0x125)]['deleteAttachment'](this['commitData'][_0x5cfa3d(0x11d)]),_0x5ed948;}async[a105_0x73a263(0x13f)](){const _0x2ca178=a105_0x73a263,_0x291df5=new commit_components_dto_1['CommitComponentsDto'](),[_0x1ab49b,_0x3c89d6]=await Promise['all']([this['getComponentsToWrite'](),this[_0x2ca178(0x159)]()]);return _0x291df5[_0x2ca178(0x104)]=this[_0x2ca178(0x130)]['message'],_0x291df5[_0x2ca178(0x115)]=this[_0x2ca178(0x130)][_0x2ca178(0x115)],_0x291df5[_0x2ca178(0x136)]={'writed':_0x1ab49b,'deleted':_0x3c89d6},_0x291df5['convertToSFDX']=this['config']['isConvertToSfdx'],_0x291df5[_0x2ca178(0x120)]=this['repository'],_0x291df5['branch']=this[_0x2ca178(0x147)],_0x291df5['provider']=this[_0x2ca178(0x11f)][_0x2ca178(0x110)],_0x291df5;}async[a105_0x73a263(0x106)](_0x160f76=![]){const _0x249a04=a105_0x73a263;if(_0x160f76)await this[_0x249a04(0x13b)][_0x249a04(0x13d)](this[_0x249a04(0x127)],{});else{const _0x2cb5d5=await this[_0x249a04(0xfa)][_0x249a04(0x116)][_0x249a04(0x156)](this['branch'][_0x249a04(0x158)]);this[_0x249a04(0x13c)]['log'](this[_0x249a04(0x13e)]+_0x249a04(0x101));const _0x336b4e={[this['repository'][_0x249a04(0x135)]]:{'lastCommit':_0x2cb5d5[_0x249a04(0xfc)]}};await this[_0x249a04(0x13b)][_0x249a04(0x13d)](this[_0x249a04(0x127)],_0x336b4e);}}async[a105_0x73a263(0x121)](){const _0x3870f2=a105_0x73a263,_0x2b0446=await this[_0x3870f2(0x13f)]();await this[_0x3870f2(0x13b)][_0x3870f2(0x14d)](this[_0x3870f2(0x127)],_0x3870f2(0x137)),await this[_0x3870f2(0x14b)][_0x3870f2(0x129)](_0x2b0446,this[_0x3870f2(0x13e)]),await this[_0x3870f2(0x106)](),await this['salesforceSync'][_0x3870f2(0x14d)](this[_0x3870f2(0x127)],'Completed');}async[a105_0x73a263(0x145)](_0x4c2b5a){const _0x456a6d=a105_0x73a263;try{this[_0x456a6d(0x13c)][_0x456a6d(0x148)](''+_0x4c2b5a),await this[_0x456a6d(0x13c)]['send'](),await this[_0x456a6d(0x106)](!![]),await this['salesforceSync'][_0x456a6d(0x14d)](this[_0x456a6d(0x127)],_0x456a6d(0x12b));}catch(_0x561a39){this['logger'][_0x456a6d(0x148)](_0x561a39);}}async[a105_0x73a263(0x129)](_0x4db8cf){const _0x2f4c7c=a105_0x73a263;try{this[_0x2f4c7c(0x130)]=_0x4db8cf,this[_0x2f4c7c(0x131)]=typedi_1['Container']['get'](providers_tokens_1['Tokens']['gitApiService']),this['repoService']=typedi_1[_0x2f4c7c(0x141)][_0x2f4c7c(0x155)](providers_tokens_1[_0x2f4c7c(0x139)]['gitRepoService']),this[_0x2f4c7c(0x11f)]=typedi_1[_0x2f4c7c(0x141)][_0x2f4c7c(0x155)](providers_tokens_1[_0x2f4c7c(0x139)][_0x2f4c7c(0x11f)]),await this[_0x2f4c7c(0xfd)](),this[_0x2f4c7c(0xfa)]=await this[_0x2f4c7c(0x109)]['getOne'](this[_0x2f4c7c(0x127)]['repositoryName']),this[_0x2f4c7c(0x147)]=await this[_0x2f4c7c(0xfa)][_0x2f4c7c(0x116)][_0x2f4c7c(0x156)](this[_0x2f4c7c(0x127)][_0x2f4c7c(0x14c)]),this[_0x2f4c7c(0x13c)]=typedi_1[_0x2f4c7c(0x141)][_0x2f4c7c(0x155)](providers_tokens_1[_0x2f4c7c(0x139)][_0x2f4c7c(0x11c)]),this['prefix']=_0x2f4c7c(0x113)+this[_0x2f4c7c(0x11f)]['gitProvider'][_0x2f4c7c(0x100)]()+_0x2f4c7c(0x126)+this[_0x2f4c7c(0x127)]['repositoryName']+_0x2f4c7c(0x12f)+this[_0x2f4c7c(0x127)][_0x2f4c7c(0x14c)]+']\x20['+FlosumCommitJob_1[_0x2f4c7c(0x158)]+']';if(!this[_0x2f4c7c(0x127)])throw new bad_request_error_1['BadRequestError'](errors_1[_0x2f4c7c(0x10e)]);await this['sfLogger']['log'](this[_0x2f4c7c(0x13e)]+_0x2f4c7c(0x12e))[_0x2f4c7c(0x152)](),await this[_0x2f4c7c(0x121)]()[_0x2f4c7c(0xff)](_0x56e181=>this[_0x2f4c7c(0x145)](_0x56e181));}catch(_0x33f777){this['commitData']=undefined,this[_0x2f4c7c(0x11c)][_0x2f4c7c(0x148)](_0x33f777);throw _0x33f777;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x73a263(0x133)])({'transient':!![]}),__metadata(a105_0x73a263(0x140),[salesforce_service_1[a105_0x73a263(0x107)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a105_0x73a263(0x118)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;