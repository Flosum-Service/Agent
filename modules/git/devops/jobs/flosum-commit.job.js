const a124_0x8b082b=a124_0x1e95;(function(_0x1db06f,_0x19475f){const _0x17df15=a124_0x1e95,_0x1232a0=_0x1db06f();while(!![]){try{const _0x31a67e=parseInt(_0x17df15(0x22e))/0x1*(parseInt(_0x17df15(0x201))/0x2)+parseInt(_0x17df15(0x1fb))/0x3+parseInt(_0x17df15(0x1eb))/0x4+-parseInt(_0x17df15(0x1dc))/0x5*(parseInt(_0x17df15(0x233))/0x6)+-parseInt(_0x17df15(0x220))/0x7*(-parseInt(_0x17df15(0x204))/0x8)+parseInt(_0x17df15(0x23f))/0x9+-parseInt(_0x17df15(0x1e8))/0xa;if(_0x31a67e===_0x19475f)break;else _0x1232a0['push'](_0x1232a0['shift']());}catch(_0x4a476b){_0x1232a0['push'](_0x1232a0['shift']());}}}(a124_0x4d3c,0xdf77d));function a124_0x1e95(_0x204d79,_0x360091){const _0x236aec=a124_0x4d3c();return a124_0x1e95=function(_0x1c0589,_0x4a5da9){_0x1c0589=_0x1c0589-0x1cf;let _0x4d3ccc=_0x236aec[_0x1c0589];return _0x4d3ccc;},a124_0x1e95(_0x204d79,_0x360091);}const a124_0x4a5da9=(function(){let _0xdbe4c0=!![];return function(_0x59bc2,_0x23c4c5){const _0x3e22f2=_0xdbe4c0?function(){const _0x4e0289=a124_0x1e95;if(_0x23c4c5){const _0x18ce71=_0x23c4c5[_0x4e0289(0x1fd)](_0x59bc2,arguments);return _0x23c4c5=null,_0x18ce71;}}:function(){};return _0xdbe4c0=![],_0x3e22f2;};}()),a124_0x1c0589=a124_0x4a5da9(this,function(){const _0x406e65=a124_0x1e95;return a124_0x1c0589[_0x406e65(0x22c)]()[_0x406e65(0x226)](_0x406e65(0x235))[_0x406e65(0x22c)]()['constructor'](a124_0x1c0589)[_0x406e65(0x226)](_0x406e65(0x235));});a124_0x1c0589();'use strict';var __decorate=this&&this[a124_0x8b082b(0x1d9)]||function(_0x23adb4,_0x296f96,_0x2a9f3b,_0x962f1a){const _0x46cfe6=a124_0x8b082b;var _0xa26942=arguments[_0x46cfe6(0x1d7)],_0x3cb852=_0xa26942<0x3?_0x296f96:_0x962f1a===null?_0x962f1a=Object[_0x46cfe6(0x23d)](_0x296f96,_0x2a9f3b):_0x962f1a,_0x266c06;if(typeof Reflect===_0x46cfe6(0x213)&&typeof Reflect[_0x46cfe6(0x242)]===_0x46cfe6(0x217))_0x3cb852=Reflect['decorate'](_0x23adb4,_0x296f96,_0x2a9f3b,_0x962f1a);else{for(var _0x187f25=_0x23adb4[_0x46cfe6(0x1d7)]-0x1;_0x187f25>=0x0;_0x187f25--)if(_0x266c06=_0x23adb4[_0x187f25])_0x3cb852=(_0xa26942<0x3?_0x266c06(_0x3cb852):_0xa26942>0x3?_0x266c06(_0x296f96,_0x2a9f3b,_0x3cb852):_0x266c06(_0x296f96,_0x2a9f3b))||_0x3cb852;}return _0xa26942>0x3&&_0x3cb852&&Object['defineProperty'](_0x296f96,_0x2a9f3b,_0x3cb852),_0x3cb852;},__metadata=this&&this['__metadata']||function(_0x1ec3b6,_0x5dfa5b){const _0x1710cb=a124_0x8b082b;if(typeof Reflect===_0x1710cb(0x213)&&typeof Reflect['metadata']===_0x1710cb(0x217))return Reflect['metadata'](_0x1ec3b6,_0x5dfa5b);},__importDefault=this&&this[a124_0x8b082b(0x1ff)]||function(_0x2744db){return _0x2744db&&_0x2744db['__esModule']?_0x2744db:{'default':_0x2744db};},FlosumCommitJob_1;Object['defineProperty'](exports,a124_0x8b082b(0x21f),{'value':!![]}),exports[a124_0x8b082b(0x1d1)]=void 0x0;const core_1=require(a124_0x8b082b(0x22d)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a124_0x8b082b(0x1de)),errors_1=require('../../../../constants/errors'),bad_request_error_1=require(a124_0x8b082b(0x20c)),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a124_0x8b082b(0x1db)),commit_components_job_1=require(a124_0x8b082b(0x1e9)),constants_1=require(a124_0x8b082b(0x236)),shortid_1=__importDefault(require(a124_0x8b082b(0x1d8))),providers_tokens_1=require(a124_0x8b082b(0x1d0)),commit_to_git_completed_notification_1=require(a124_0x8b082b(0x1e5)),commit_to_git_error_notification_1=require(a124_0x8b082b(0x227));function a124_0x4d3c(){const _0x15935b=[']\x20[Branch:\x20','SalesforceSyncService','email','getOne','all','../../notifications/commit-to-git-completed.notification','getComponentsToWrite','salesforceSync','19141340sDCKxS','./commit-components.job','errorNotification','4629860vHfeWQ','split','repositoryData','repository','log','user','commitJob','ERR_INVALID_SYNC_RECORD_ID','Container','getComponentsToDelete','gitApiService','getBranchRecord','In\x20Progress','default','message','CommitComponentsJob','216963isuDPd','error','apply','trim','__importDefault','Tokens','4pEqrJY','parse','exec','48rDwuLR','deleteAttachment','completeNotification','fetchRepositoryData','setStatus','Email\x20notifications\x20are\x20disabled.','getRepositoryRecord','FLOSUM_ATTACHMENT','../../../../core/errors/bad-request.error','retrieveAttachment',']\x20[','handleCommitJobError','execute','sfLogger','CommitToGitErrorNotification','object','syncRepositoryId','updateRemoteState','design:paramtypes','function','SalesforceService','branchName','prefix','get','getCommitDto','commitData','ERR_UNKNOWN_SYNC_RECORD_ID','__esModule','688646GaMQfa','info','repositoryName','recordType','run','toUpperCase','search','../../notifications/commit-to-git-error.notification','commitAttachmentId','repo','Logger','SalesforceRetrieverService','toString','../../../../core','321226EpTemk','isEmailNotificationsEnabled','branch','patchObject','config','9696TkdbML','Service','(((.+)+)+)+$','../../../../constants','CommitToGitCompletedNotification','recordTypeName','provider','map','gitProvider','syncBranchId','getOwnPropertyDescriptor','name','15359553rgQuiL','salesforceService','BadRequestError','decorate','Completed','repoService','../../providers/providers.tokens','FlosumCommitJob','updateLastCommit','send','branches','logger','\x20Start\x20Flosum\x20commit\x20job.','length','shortid','__decorate','isConvertToSfdx','../dto/commit-components.dto','4145dynubw','components','typedi',']\x20[Repository:\x20'];a124_0x4d3c=function(){return _0x15935b;};return a124_0x4d3c();}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x5acbfe,_0x27bdf1,_0x55e4e7){const _0x570e3e=a124_0x8b082b;this[_0x570e3e(0x240)]=_0x5acbfe,this[_0x570e3e(0x1f1)]=_0x27bdf1,this[_0x570e3e(0x1e7)]=_0x55e4e7,this[_0x570e3e(0x1d5)]=new core_1[(_0x570e3e(0x22a))](FlosumCommitJob_1[_0x570e3e(0x23e)]);}async[a124_0x8b082b(0x206)](_0x53ff96,_0x4564f6,_0x2258e0,_0x2d6419){const _0x12d6a4=a124_0x8b082b;if(!this[_0x12d6a4(0x21d)][_0x12d6a4(0x22f)]){this[_0x12d6a4(0x1d5)][_0x12d6a4(0x221)]('Email\x20notifications\x20are\x20disabled.');return;}await new commit_to_git_completed_notification_1[(_0x12d6a4(0x237))]({'emails':_0x53ff96,'gitProvider':_0x4564f6,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1[_0x12d6a4(0x237)][_0x12d6a4(0x23e)],'repositoryName':_0x2258e0,'branchName':_0x2d6419})[_0x12d6a4(0x210)]();}async[a124_0x8b082b(0x1ea)](_0x4ef275,_0x2a0750,_0x127764,_0xc8bf10){const _0x2f7271=a124_0x8b082b;if(!this[_0x2f7271(0x21d)][_0x2f7271(0x22f)]){this[_0x2f7271(0x1d5)][_0x2f7271(0x221)](_0x2f7271(0x209));return;}await new commit_to_git_error_notification_1[(_0x2f7271(0x212))]({'emails':_0x4ef275,'gitProvider':_0x2a0750,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1['CommitToGitErrorNotification'][_0x2f7271(0x23e)],'repositoryName':_0x127764,'branchName':_0xc8bf10})[_0x2f7271(0x210)]();}async[a124_0x8b082b(0x207)](){const _0x59a77b=a124_0x8b082b;try{if(this[_0x59a77b(0x21d)][_0x59a77b(0x214)])this['repositoryData']=await this[_0x59a77b(0x1e7)][_0x59a77b(0x20a)](this[_0x59a77b(0x21d)][_0x59a77b(0x214)]);else this[_0x59a77b(0x21d)][_0x59a77b(0x23c)]&&(this[_0x59a77b(0x1ed)]=await this[_0x59a77b(0x1e7)][_0x59a77b(0x1f6)](this['commitData'][_0x59a77b(0x23c)]));}catch(_0x2eb92e){throw new bad_request_error_1[(_0x59a77b(0x241))](errors_1[_0x59a77b(0x1f2)]);}}async[a124_0x8b082b(0x1e6)](){const _0x16c3de=a124_0x8b082b;if(!this[_0x16c3de(0x21d)][_0x16c3de(0x228)])return[];await this[_0x16c3de(0x240)][_0x16c3de(0x231)](constants_1[_0x16c3de(0x20b)],this[_0x16c3de(0x21d)][_0x16c3de(0x228)],{'Name':(0x0,shortid_1[_0x16c3de(0x1f8)])()});const _0x16d400=await this[_0x16c3de(0x240)][_0x16c3de(0x20d)](this[_0x16c3de(0x21d)][_0x16c3de(0x228)])['then'](_0x4b1cfe=>_0x4b1cfe[_0x16c3de(0x1ec)]('\x20')[_0x16c3de(0x23a)](_0xca4871=>_0xca4871[_0x16c3de(0x1fe)]()));await this[_0x16c3de(0x240)][_0x16c3de(0x205)](this[_0x16c3de(0x21d)][_0x16c3de(0x228)]);const _0x370ff6=new salesforce_retriever_service_1[(_0x16c3de(0x22b))](this[_0x16c3de(0x240)]);return await _0x370ff6[_0x16c3de(0x224)](_0x16d400);}async[a124_0x8b082b(0x1f4)](){const _0x2614b9=a124_0x8b082b;if(!this[_0x2614b9(0x21d)]['deleteAttachmentId'])return[];await this[_0x2614b9(0x240)][_0x2614b9(0x231)](constants_1[_0x2614b9(0x20b)],this[_0x2614b9(0x21d)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0x2614b9(0x1f8)])()});const _0x34a91d=await this[_0x2614b9(0x240)][_0x2614b9(0x20d)](this[_0x2614b9(0x21d)]['deleteAttachmentId']),_0x345083=JSON[_0x2614b9(0x202)](_0x34a91d);return await this[_0x2614b9(0x240)]['deleteAttachment'](this[_0x2614b9(0x21d)]['deleteAttachmentId']),_0x345083;}async['getCommitDto'](){const _0x520aeb=a124_0x8b082b,_0x27f205=new commit_components_dto_1['CommitComponentsDto'](),[_0x40afad,_0x34dab5]=await Promise[_0x520aeb(0x1e4)]([this[_0x520aeb(0x1e6)](),this['getComponentsToDelete']()]);return _0x27f205[_0x520aeb(0x1f9)]=this[_0x520aeb(0x21d)][_0x520aeb(0x1f9)],_0x27f205[_0x520aeb(0x1f0)]=this[_0x520aeb(0x21d)][_0x520aeb(0x1f0)],_0x27f205[_0x520aeb(0x1dd)]={'writed':_0x40afad,'deleted':_0x34dab5},_0x27f205['convertToSFDX']=this[_0x520aeb(0x232)][_0x520aeb(0x1da)],_0x27f205[_0x520aeb(0x229)]=this['repository'],_0x27f205['branch']=this[_0x520aeb(0x230)],_0x27f205[_0x520aeb(0x239)]=this[_0x520aeb(0x232)][_0x520aeb(0x23b)],_0x27f205[_0x520aeb(0x223)]=this[_0x520aeb(0x1ed)][_0x520aeb(0x238)],_0x27f205;}async[a124_0x8b082b(0x1d2)](_0x267abb=![]){const _0x5bdffb=a124_0x8b082b;if(_0x267abb)await this[_0x5bdffb(0x1e7)][_0x5bdffb(0x215)](this[_0x5bdffb(0x1ed)],{});else{const _0x270736=await this[_0x5bdffb(0x1ee)][_0x5bdffb(0x1d4)][_0x5bdffb(0x1e3)](this['branch'][_0x5bdffb(0x23e)]);this[_0x5bdffb(0x211)][_0x5bdffb(0x1ef)](this[_0x5bdffb(0x21a)]+'\x20Update\x20remote\x20state.');const _0x1ac98e={[this[_0x5bdffb(0x1ee)]['gitUrl']]:{'lastCommit':_0x270736['sha']}};await this[_0x5bdffb(0x1e7)]['updateRemoteState'](this['repositoryData'],_0x1ac98e);}}async[a124_0x8b082b(0x203)](){const _0x41cbda=a124_0x8b082b,_0x3850fe=await this[_0x41cbda(0x21c)]();await this[_0x41cbda(0x1e7)][_0x41cbda(0x208)](this[_0x41cbda(0x1ed)],_0x41cbda(0x1f7)),await this[_0x41cbda(0x1f1)]['run'](_0x3850fe,this[_0x41cbda(0x21a)]),await this[_0x41cbda(0x1d2)](),await this['salesforceSync'][_0x41cbda(0x208)](this[_0x41cbda(0x1ed)],_0x41cbda(0x243));}async[a124_0x8b082b(0x20f)](_0x48d336){const _0xd59c3f=a124_0x8b082b;try{this[_0xd59c3f(0x211)][_0xd59c3f(0x1fc)](''+_0x48d336),await this[_0xd59c3f(0x211)][_0xd59c3f(0x1d3)](),await this[_0xd59c3f(0x1d2)](!![]),await this[_0xd59c3f(0x1e7)][_0xd59c3f(0x208)](this[_0xd59c3f(0x1ed)],'Error'),await this['completeNotification']([this[_0xd59c3f(0x21d)][_0xd59c3f(0x1f0)][_0xd59c3f(0x1e2)]],this[_0xd59c3f(0x232)][_0xd59c3f(0x23b)],this[_0xd59c3f(0x1ee)][_0xd59c3f(0x23e)],this[_0xd59c3f(0x230)][_0xd59c3f(0x23e)]);}catch(_0x1ead6f){this[_0xd59c3f(0x1d5)][_0xd59c3f(0x1fc)](_0x1ead6f),await this[_0xd59c3f(0x1ea)]([this[_0xd59c3f(0x21d)][_0xd59c3f(0x1f0)][_0xd59c3f(0x1e2)]],this['config']['gitProvider'],this[_0xd59c3f(0x1ee)][_0xd59c3f(0x23e)],this[_0xd59c3f(0x230)][_0xd59c3f(0x23e)]);}}async[a124_0x8b082b(0x224)](_0x20ed97){const _0x2fe41b=a124_0x8b082b;try{this['commitData']=_0x20ed97,this[_0x2fe41b(0x1f5)]=typedi_1[_0x2fe41b(0x1f3)][_0x2fe41b(0x21b)](providers_tokens_1['Tokens'][_0x2fe41b(0x1f5)]),this[_0x2fe41b(0x1cf)]=typedi_1[_0x2fe41b(0x1f3)][_0x2fe41b(0x21b)](providers_tokens_1[_0x2fe41b(0x200)]['gitRepoService']),this[_0x2fe41b(0x232)]=typedi_1[_0x2fe41b(0x1f3)][_0x2fe41b(0x21b)](providers_tokens_1[_0x2fe41b(0x200)][_0x2fe41b(0x232)]),await this['fetchRepositoryData'](),this[_0x2fe41b(0x1ee)]=await this['repoService'][_0x2fe41b(0x1e3)](this[_0x2fe41b(0x1ed)][_0x2fe41b(0x222)]),this[_0x2fe41b(0x230)]=await this[_0x2fe41b(0x1ee)]['branches'][_0x2fe41b(0x1e3)](this[_0x2fe41b(0x1ed)][_0x2fe41b(0x219)]),this[_0x2fe41b(0x211)]=typedi_1[_0x2fe41b(0x1f3)][_0x2fe41b(0x21b)](providers_tokens_1[_0x2fe41b(0x200)][_0x2fe41b(0x1d5)]),this[_0x2fe41b(0x21a)]='[FLOSUM\x20->\x20GIT]\x20['+this[_0x2fe41b(0x232)][_0x2fe41b(0x23b)][_0x2fe41b(0x225)]()+_0x2fe41b(0x1df)+this[_0x2fe41b(0x1ed)][_0x2fe41b(0x222)]+_0x2fe41b(0x1e0)+this[_0x2fe41b(0x1ed)][_0x2fe41b(0x219)]+_0x2fe41b(0x20e)+FlosumCommitJob_1[_0x2fe41b(0x23e)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x2fe41b(0x241))](errors_1[_0x2fe41b(0x21e)]);await this[_0x2fe41b(0x211)][_0x2fe41b(0x1ef)](this[_0x2fe41b(0x21a)]+_0x2fe41b(0x1d6))[_0x2fe41b(0x1d3)](),await this['exec']()['catch'](_0x2501bf=>this[_0x2fe41b(0x20f)](_0x2501bf)),await this['completeNotification']([this[_0x2fe41b(0x21d)][_0x2fe41b(0x1f0)]['email']],this[_0x2fe41b(0x232)][_0x2fe41b(0x23b)],this['repository'][_0x2fe41b(0x23e)],this[_0x2fe41b(0x230)]['name']);}catch(_0x19c67d){this[_0x2fe41b(0x21d)]=undefined,this[_0x2fe41b(0x1d5)][_0x2fe41b(0x1fc)](_0x19c67d),await this[_0x2fe41b(0x1ea)]([this[_0x2fe41b(0x21d)][_0x2fe41b(0x1f0)][_0x2fe41b(0x1e2)]],this[_0x2fe41b(0x232)]['gitProvider'],this[_0x2fe41b(0x1ee)]['name'],this[_0x2fe41b(0x230)][_0x2fe41b(0x23e)]);throw _0x19c67d;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a124_0x8b082b(0x234)])({'transient':!![]}),__metadata(a124_0x8b082b(0x216),[salesforce_service_1[a124_0x8b082b(0x218)],commit_components_job_1[a124_0x8b082b(0x1fa)],salesforce_sync_service_1[a124_0x8b082b(0x1e1)]])],FlosumCommitJob),exports[a124_0x8b082b(0x1d1)]=FlosumCommitJob;