const a104_0x31c1a1=a104_0x5571;(function(_0x148671,_0x142143){const _0xf0aa6b=a104_0x5571,_0x5059ed=_0x148671();while(!![]){try{const _0x47a851=-parseInt(_0xf0aa6b(0xe2))/0x1+parseInt(_0xf0aa6b(0xfe))/0x2+-parseInt(_0xf0aa6b(0xa9))/0x3+parseInt(_0xf0aa6b(0xbb))/0x4+-parseInt(_0xf0aa6b(0xcd))/0x5*(parseInt(_0xf0aa6b(0xe1))/0x6)+parseInt(_0xf0aa6b(0xbe))/0x7*(parseInt(_0xf0aa6b(0xd7))/0x8)+parseInt(_0xf0aa6b(0xeb))/0x9;if(_0x47a851===_0x142143)break;else _0x5059ed['push'](_0x5059ed['shift']());}catch(_0x4258d4){_0x5059ed['push'](_0x5059ed['shift']());}}}(a104_0x19a8,0xb4812));const a104_0x533b03=(function(){let _0x281420=!![];return function(_0x52e894,_0x39ed92){const _0x16b79b=_0x281420?function(){const _0x36ebe5=a104_0x5571;if(_0x39ed92){const _0xcf43c1=_0x39ed92[_0x36ebe5(0xd9)](_0x52e894,arguments);return _0x39ed92=null,_0xcf43c1;}}:function(){};return _0x281420=![],_0x16b79b;};}()),a104_0x2e6ab5=a104_0x533b03(this,function(){const _0x37385c=a104_0x5571;return a104_0x2e6ab5['toString']()[_0x37385c(0xd4)](_0x37385c(0xa7))[_0x37385c(0xfc)]()[_0x37385c(0x9e)](a104_0x2e6ab5)['search'](_0x37385c(0xa7));});a104_0x2e6ab5();'use strict';var __decorate=this&&this[a104_0x31c1a1(0xea)]||function(_0x269def,_0x40f68e,_0x41d47c,_0x5efa14){const _0x559b3e=a104_0x31c1a1;var _0x414d7f=arguments['length'],_0x128e59=_0x414d7f<0x3?_0x40f68e:_0x5efa14===null?_0x5efa14=Object[_0x559b3e(0x9d)](_0x40f68e,_0x41d47c):_0x5efa14,_0x17fd02;if(typeof Reflect===_0x559b3e(0xfa)&&typeof Reflect[_0x559b3e(0xd5)]===_0x559b3e(0xe6))_0x128e59=Reflect[_0x559b3e(0xd5)](_0x269def,_0x40f68e,_0x41d47c,_0x5efa14);else{for(var _0x3d4de2=_0x269def[_0x559b3e(0xa8)]-0x1;_0x3d4de2>=0x0;_0x3d4de2--)if(_0x17fd02=_0x269def[_0x3d4de2])_0x128e59=(_0x414d7f<0x3?_0x17fd02(_0x128e59):_0x414d7f>0x3?_0x17fd02(_0x40f68e,_0x41d47c,_0x128e59):_0x17fd02(_0x40f68e,_0x41d47c))||_0x128e59;}return _0x414d7f>0x3&&_0x128e59&&Object[_0x559b3e(0xb9)](_0x40f68e,_0x41d47c,_0x128e59),_0x128e59;},__metadata=this&&this[a104_0x31c1a1(0xd2)]||function(_0x190eae,_0x30955f){const _0x2cf8b4=a104_0x31c1a1;if(typeof Reflect===_0x2cf8b4(0xfa)&&typeof Reflect[_0x2cf8b4(0xe7)]===_0x2cf8b4(0xe6))return Reflect[_0x2cf8b4(0xe7)](_0x190eae,_0x30955f);},__importDefault=this&&this['__importDefault']||function(_0x34ef09){return _0x34ef09&&_0x34ef09['__esModule']?_0x34ef09:{'default':_0x34ef09};},FlosumCommitJob_1;Object[a104_0x31c1a1(0xb9)](exports,a104_0x31c1a1(0xb2),{'value':!![]}),exports[a104_0x31c1a1(0xf3)]=void 0x0;function a104_0x5571(_0x2a4978,_0x10bf4d){const _0x2374e5=a104_0x19a8();return a104_0x5571=function(_0x2e6ab5,_0x533b03){_0x2e6ab5=_0x2e6ab5-0x96;let _0x19a8b8=_0x2374e5[_0x2e6ab5];return _0x19a8b8;},a104_0x5571(_0x2a4978,_0x10bf4d);}const core_1=require(a104_0x31c1a1(0xd6)),salesforce_service_1=require(a104_0x31c1a1(0xc8)),typedi_1=require(a104_0x31c1a1(0xba)),errors_1=require(a104_0x31c1a1(0x9c)),bad_request_error_1=require(a104_0x31c1a1(0xbf)),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require(a104_0x31c1a1(0xb0)),commit_components_dto_1=require(a104_0x31c1a1(0xb7)),commit_components_job_1=require(a104_0x31c1a1(0xc2)),constants_1=require(a104_0x31c1a1(0xa5)),shortid_1=__importDefault(require(a104_0x31c1a1(0xa2))),providers_tokens_1=require(a104_0x31c1a1(0xde));function a104_0x19a8(){const _0x2c97d9=['545190WMcQwH','Error','exec','sha','function','metadata','getOne','sfLogger','__decorate','16860105GNLoom','message','retrieveAttachment','\x20Start\x20Flosum\x20commit\x20job.','send','commitJob','fetchRepositoryData','components','FlosumCommitJob','Service','trim','handleCommitJobError','commitAttachmentId','branches','updateRemoteState','object','updateLastCommit','toString','patchObject','438834GFRxyo','FLOSUM_ATTACHMENT','getComponentsToDelete','salesforceService','repositoryData','Container','SalesforceRetrieverService','../../../../constants/errors','getOwnPropertyDescriptor','constructor','provider','Completed','BadRequestError','shortid','repository','map','../../../../constants','branchName','(((.+)+)+)+$','length','2128707QFgbyg','then','deleteAttachment','log','gitApiService','syncBranchId','getCommitDto','../../salesforce/services/salesforce-sync.service','name','__esModule','branch',']\x20[','prefix','deleteAttachmentId','../dto/commit-components.dto','Tokens','defineProperty','typedi','2373996KteRRK','commitData','logger','259lXFqyR','../../../../core/errors/bad-request.error','isConvertToSfdx','gitProvider','./commit-components.job','\x20Update\x20remote\x20state.','design:paramtypes','gitUrl','getComponentsToWrite','catch','../../salesforce/services/salesforce.service','user','config','[FLOSUM\x20->\x20GIT]\x20[','run','15srchXm','gitRepoService','CommitComponentsJob','salesforceSync','syncRepositoryId','__metadata',']\x20[Branch:\x20','search','decorate','../../../../core','92408otkcLI','setStatus','apply','toUpperCase','error','get','split','../../providers/providers.tokens','SalesforceService','repoService','2239086FKmAmg'];a104_0x19a8=function(){return _0x2c97d9;};return a104_0x19a8();}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x18264e,_0x3418e4,_0x2b271d){const _0x303686=a104_0x31c1a1;this[_0x303686(0x98)]=_0x18264e,this[_0x303686(0xf0)]=_0x3418e4,this[_0x303686(0xd0)]=_0x2b271d,this['logger']=new core_1['Logger'](FlosumCommitJob_1[_0x303686(0xb1)]);}async[a104_0x31c1a1(0xf1)](){const _0x860b9f=a104_0x31c1a1;try{if(this[_0x860b9f(0xbc)][_0x860b9f(0xd1)])this[_0x860b9f(0x99)]=await this['salesforceSync']['getRepositoryRecord'](this[_0x860b9f(0xbc)][_0x860b9f(0xd1)]);else this[_0x860b9f(0xbc)][_0x860b9f(0xae)]&&(this[_0x860b9f(0x99)]=await this[_0x860b9f(0xd0)]['getBranchRecord'](this[_0x860b9f(0xbc)]['syncBranchId']));}catch(_0x27582a){throw new bad_request_error_1[(_0x860b9f(0xa1))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a104_0x31c1a1(0xc6)](){const _0x5ca8be=a104_0x31c1a1;if(!this[_0x5ca8be(0xbc)][_0x5ca8be(0xf7)])return[];await this[_0x5ca8be(0x98)][_0x5ca8be(0xfd)](constants_1[_0x5ca8be(0x96)],this[_0x5ca8be(0xbc)][_0x5ca8be(0xf7)],{'Name':(0x0,shortid_1['default'])()});const _0xa0c984=await this['salesforceService'][_0x5ca8be(0xed)](this['commitData'][_0x5ca8be(0xf7)])[_0x5ca8be(0xaa)](_0x332419=>_0x332419[_0x5ca8be(0xdd)]('\x20')[_0x5ca8be(0xa4)](_0x2c20c6=>_0x2c20c6[_0x5ca8be(0xf5)]()));await this[_0x5ca8be(0x98)][_0x5ca8be(0xab)](this[_0x5ca8be(0xbc)][_0x5ca8be(0xf7)]);const _0x2b6d1a=new salesforce_retriever_service_1[(_0x5ca8be(0x9b))](this[_0x5ca8be(0x98)]);return await _0x2b6d1a['run'](_0xa0c984);}async[a104_0x31c1a1(0x97)](){const _0x393219=a104_0x31c1a1;if(!this[_0x393219(0xbc)]['deleteAttachmentId'])return[];await this[_0x393219(0x98)][_0x393219(0xfd)](constants_1[_0x393219(0x96)],this[_0x393219(0xbc)][_0x393219(0xb6)],{'Name':(0x0,shortid_1['default'])()});const _0x478bac=await this[_0x393219(0x98)]['retrieveAttachment'](this[_0x393219(0xbc)][_0x393219(0xb6)]);return await this['salesforceService'][_0x393219(0xab)](this['commitData'][_0x393219(0xb6)]),_0x478bac;}async['getCommitDto'](){const _0xb5acb0=a104_0x31c1a1,_0x59f256=new commit_components_dto_1['CommitComponentsDto'](),[_0x3e7c29,_0x503cb0]=await Promise['all']([this[_0xb5acb0(0xc6)](),this['getComponentsToDelete']()]);return _0x59f256[_0xb5acb0(0xec)]=this['commitData'][_0xb5acb0(0xec)],_0x59f256[_0xb5acb0(0xc9)]=this['commitData'][_0xb5acb0(0xc9)],_0x59f256[_0xb5acb0(0xf2)]={'writed':_0x3e7c29,'deleted':_0x503cb0},_0x59f256['convertToSFDX']=this[_0xb5acb0(0xca)][_0xb5acb0(0xc0)],_0x59f256['repo']=this[_0xb5acb0(0xa3)],_0x59f256[_0xb5acb0(0xb3)]=this[_0xb5acb0(0xb3)],_0x59f256[_0xb5acb0(0x9f)]=this[_0xb5acb0(0xca)][_0xb5acb0(0xc1)],_0x59f256;}async['updateLastCommit'](_0x9d368c=![]){const _0x49a4f2=a104_0x31c1a1;if(_0x9d368c)await this[_0x49a4f2(0xd0)]['updateRemoteState'](this[_0x49a4f2(0x99)],{});else{const _0x1bdb48=await this[_0x49a4f2(0xa3)][_0x49a4f2(0xf8)][_0x49a4f2(0xe8)](this[_0x49a4f2(0xb3)][_0x49a4f2(0xb1)]);this[_0x49a4f2(0xe9)]['log'](this[_0x49a4f2(0xb5)]+_0x49a4f2(0xc3));const _0x3b7ae6={[this['repository'][_0x49a4f2(0xc5)]]:{'lastCommit':_0x1bdb48[_0x49a4f2(0xe5)]}};await this[_0x49a4f2(0xd0)][_0x49a4f2(0xf9)](this[_0x49a4f2(0x99)],_0x3b7ae6);}}async[a104_0x31c1a1(0xe4)](){const _0x456a61=a104_0x31c1a1,_0x50b535=await this[_0x456a61(0xaf)]();await this[_0x456a61(0xd0)][_0x456a61(0xd8)](this[_0x456a61(0x99)],'In\x20Progress'),await this['commitJob'][_0x456a61(0xcc)](_0x50b535,this['prefix']),await this[_0x456a61(0xfb)](),await this['salesforceSync'][_0x456a61(0xd8)](this['repositoryData'],_0x456a61(0xa0));}async[a104_0x31c1a1(0xf6)](_0x5d74dd){const _0x5bdcac=a104_0x31c1a1;try{this[_0x5bdcac(0xe9)][_0x5bdcac(0xdb)](''+_0x5d74dd),await this[_0x5bdcac(0xe9)]['send'](),await this[_0x5bdcac(0xfb)](!![]),await this['salesforceSync'][_0x5bdcac(0xd8)](this[_0x5bdcac(0x99)],_0x5bdcac(0xe3));}catch(_0x3cb7b6){this[_0x5bdcac(0xbd)][_0x5bdcac(0xdb)](_0x3cb7b6);}}async[a104_0x31c1a1(0xcc)](_0x124348){const _0x297b7f=a104_0x31c1a1;try{this[_0x297b7f(0xbc)]=_0x124348,this[_0x297b7f(0xad)]=typedi_1[_0x297b7f(0x9a)][_0x297b7f(0xdc)](providers_tokens_1['Tokens'][_0x297b7f(0xad)]),this['repoService']=typedi_1[_0x297b7f(0x9a)][_0x297b7f(0xdc)](providers_tokens_1[_0x297b7f(0xb8)][_0x297b7f(0xce)]),this['config']=typedi_1[_0x297b7f(0x9a)][_0x297b7f(0xdc)](providers_tokens_1[_0x297b7f(0xb8)]['config']),await this['fetchRepositoryData'](),this[_0x297b7f(0xa3)]=await this[_0x297b7f(0xe0)][_0x297b7f(0xe8)](this[_0x297b7f(0x99)]['repositoryName']),this[_0x297b7f(0xb3)]=await this[_0x297b7f(0xa3)]['branches'][_0x297b7f(0xe8)](this[_0x297b7f(0x99)][_0x297b7f(0xa6)]),this[_0x297b7f(0xe9)]=typedi_1[_0x297b7f(0x9a)][_0x297b7f(0xdc)](providers_tokens_1[_0x297b7f(0xb8)][_0x297b7f(0xbd)]),this['prefix']=_0x297b7f(0xcb)+this['config'][_0x297b7f(0xc1)][_0x297b7f(0xda)]()+']\x20[Repository:\x20'+this[_0x297b7f(0x99)]['repositoryName']+_0x297b7f(0xd3)+this[_0x297b7f(0x99)][_0x297b7f(0xa6)]+_0x297b7f(0xb4)+FlosumCommitJob_1['name']+']';if(!this[_0x297b7f(0x99)])throw new bad_request_error_1[(_0x297b7f(0xa1))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x297b7f(0xe9)][_0x297b7f(0xac)](this[_0x297b7f(0xb5)]+_0x297b7f(0xee))[_0x297b7f(0xef)](),await this[_0x297b7f(0xe4)]()[_0x297b7f(0xc7)](_0x3a165f=>this[_0x297b7f(0xf6)](_0x3a165f));}catch(_0xda26ac){this['commitData']=undefined,this[_0x297b7f(0xbd)][_0x297b7f(0xdb)](_0xda26ac);throw _0xda26ac;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a104_0x31c1a1(0xf4)])({'transient':!![]}),__metadata(a104_0x31c1a1(0xc4),[salesforce_service_1[a104_0x31c1a1(0xdf)],commit_components_job_1[a104_0x31c1a1(0xcf)],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;