const a104_0x2f0c80=a104_0x24bd;(function(_0x4e6e45,_0x4fdef5){const _0x55d978=a104_0x24bd,_0x29dbfc=_0x4e6e45();while(!![]){try{const _0x40367b=-parseInt(_0x55d978(0x139))/0x1*(-parseInt(_0x55d978(0x12a))/0x2)+parseInt(_0x55d978(0x113))/0x3*(-parseInt(_0x55d978(0x121))/0x4)+parseInt(_0x55d978(0x123))/0x5+parseInt(_0x55d978(0x10d))/0x6+parseInt(_0x55d978(0x131))/0x7*(parseInt(_0x55d978(0x12e))/0x8)+-parseInt(_0x55d978(0x11a))/0x9+-parseInt(_0x55d978(0x107))/0xa;if(_0x40367b===_0x4fdef5)break;else _0x29dbfc['push'](_0x29dbfc['shift']());}catch(_0x3e883e){_0x29dbfc['push'](_0x29dbfc['shift']());}}}(a104_0x7c8c,0x1ecab));const a104_0x4b0c21=(function(){let _0x289b0b=!![];return function(_0x43c461,_0x4497ed){const _0x519376=_0x289b0b?function(){const _0x311775=a104_0x24bd;if(_0x4497ed){const _0x568b67=_0x4497ed[_0x311775(0xf8)](_0x43c461,arguments);return _0x4497ed=null,_0x568b67;}}:function(){};return _0x289b0b=![],_0x519376;};}()),a104_0x20a80f=a104_0x4b0c21(this,function(){const _0x549289=a104_0x24bd;return a104_0x20a80f[_0x549289(0x132)]()[_0x549289(0x145)](_0x549289(0x133))[_0x549289(0x132)]()[_0x549289(0xe3)](a104_0x20a80f)[_0x549289(0x145)]('(((.+)+)+)+$');});function a104_0x7c8c(){const _0x4c004d=['shortid','error','../../salesforce/services/salesforce.service','catch','object','get','branch','932120eOObLH','CommitComponentsDto','SalesforceService','updateRemoteState','getRepositoryRecord','user','741462fwJiGE','trim','repositoryName','provider','salesforceSync','fetchRepositoryData','88326ejJtbM','commitJob','run','getOne','syncBranchId','config','repository','923103ynvaWV','typedi','components','patchObject','repositoryData','gitProvider','function','8tYPIMV','SalesforceSyncService','386335TUJtkp','toUpperCase','gitApiService','defineProperty','syncRepositoryId','split','logger','458GjTuHz','updateLastCommit','setStatus','Service','40yTCxou','log','Completed','204470YbaUVx','toString','(((.+)+)+)+$','repo','map','../../../../core/errors/bad-request.error','send','getCommitDto','148NbQQPf','In\x20Progress','../../../../constants/errors','metadata','deleteAttachment','FlosumCommitJob','../../providers/providers.tokens','commitData','default','commitAttachmentId','branchName','../dto/commit-components.dto','search','ERR_UNKNOWN_SYNC_RECORD_ID','length','sha','\x20Update\x20remote\x20state.','sfLogger','__esModule','constructor',']\x20[Branch:\x20','Error','design:paramtypes','../../salesforce/services/salesforce-retriever.service','gitRepoService','repoService','../../../../core','retrieveAttachment','prefix','then','getBranchRecord','Container','Tokens','deleteAttachmentId','all','name','getComponentsToDelete','exec','../../salesforce/services/salesforce-sync.service','[FLOSUM\x20->\x20GIT]\x20[','apply','salesforceService','__metadata','getOwnPropertyDescriptor','getComponentsToWrite','__decorate','handleCommitJobError','FLOSUM_ATTACHMENT'];a104_0x7c8c=function(){return _0x4c004d;};return a104_0x7c8c();}a104_0x20a80f();function a104_0x24bd(_0x3d8756,_0xa1bb8e){const _0x4b60ea=a104_0x7c8c();return a104_0x24bd=function(_0x20a80f,_0x4b0c21){_0x20a80f=_0x20a80f-0xdd;let _0x7c8cd8=_0x4b60ea[_0x20a80f];return _0x7c8cd8;},a104_0x24bd(_0x3d8756,_0xa1bb8e);}'use strict';var __decorate=this&&this[a104_0x2f0c80(0xfd)]||function(_0x4a0f58,_0x27f70d,_0x24f455,_0x110eb7){const _0x2e9378=a104_0x2f0c80;var _0x3b9179=arguments['length'],_0x5a51f8=_0x3b9179<0x3?_0x27f70d:_0x110eb7===null?_0x110eb7=Object[_0x2e9378(0xfb)](_0x27f70d,_0x24f455):_0x110eb7,_0x2e7711;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x5a51f8=Reflect['decorate'](_0x4a0f58,_0x27f70d,_0x24f455,_0x110eb7);else{for(var _0x5b8621=_0x4a0f58[_0x2e9378(0xde)]-0x1;_0x5b8621>=0x0;_0x5b8621--)if(_0x2e7711=_0x4a0f58[_0x5b8621])_0x5a51f8=(_0x3b9179<0x3?_0x2e7711(_0x5a51f8):_0x3b9179>0x3?_0x2e7711(_0x27f70d,_0x24f455,_0x5a51f8):_0x2e7711(_0x27f70d,_0x24f455))||_0x5a51f8;}return _0x3b9179>0x3&&_0x5a51f8&&Object[_0x2e9378(0x126)](_0x27f70d,_0x24f455,_0x5a51f8),_0x5a51f8;},__metadata=this&&this[a104_0x2f0c80(0xfa)]||function(_0x36881e,_0x521024){const _0x38d871=a104_0x2f0c80;if(typeof Reflect===_0x38d871(0x104)&&typeof Reflect[_0x38d871(0x13c)]===_0x38d871(0x120))return Reflect[_0x38d871(0x13c)](_0x36881e,_0x521024);},__importDefault=this&&this['__importDefault']||function(_0x2a47d0){const _0x76b8f3=a104_0x2f0c80;return _0x2a47d0&&_0x2a47d0[_0x76b8f3(0xe2)]?_0x2a47d0:{'default':_0x2a47d0};},FlosumCommitJob_1;Object[a104_0x2f0c80(0x126)](exports,a104_0x2f0c80(0xe2),{'value':!![]}),exports[a104_0x2f0c80(0x13e)]=void 0x0;const core_1=require(a104_0x2f0c80(0xea)),salesforce_service_1=require(a104_0x2f0c80(0x102)),typedi_1=require(a104_0x2f0c80(0x11b)),errors_1=require(a104_0x2f0c80(0x13b)),bad_request_error_1=require(a104_0x2f0c80(0x136)),salesforce_retriever_service_1=require(a104_0x2f0c80(0xe7)),salesforce_sync_service_1=require(a104_0x2f0c80(0xf6)),commit_components_dto_1=require(a104_0x2f0c80(0x144)),commit_components_job_1=require('./commit-components.job'),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a104_0x2f0c80(0x100))),providers_tokens_1=require(a104_0x2f0c80(0x13f));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x555700,_0x17f2ef,_0x1b0dd2){const _0x1817d1=a104_0x2f0c80;this[_0x1817d1(0xf9)]=_0x555700,this[_0x1817d1(0x114)]=_0x17f2ef,this[_0x1817d1(0x111)]=_0x1b0dd2,this[_0x1817d1(0x129)]=new core_1['Logger'](FlosumCommitJob_1[_0x1817d1(0xf3)]);}async[a104_0x2f0c80(0x112)](){const _0x1917b4=a104_0x2f0c80;try{if(this['commitData'][_0x1917b4(0x127)])this['repositoryData']=await this['salesforceSync'][_0x1917b4(0x10b)](this['commitData']['syncRepositoryId']);else this[_0x1917b4(0x140)][_0x1917b4(0x117)]&&(this[_0x1917b4(0x11e)]=await this[_0x1917b4(0x111)][_0x1917b4(0xee)](this[_0x1917b4(0x140)][_0x1917b4(0x117)]));}catch(_0x41db08){throw new bad_request_error_1['BadRequestError'](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async['getComponentsToWrite'](){const _0x3fc2a8=a104_0x2f0c80;if(!this[_0x3fc2a8(0x140)]['commitAttachmentId'])return[];await this['salesforceService'][_0x3fc2a8(0x11d)](constants_1[_0x3fc2a8(0xff)],this[_0x3fc2a8(0x140)][_0x3fc2a8(0x142)],{'Name':(0x0,shortid_1[_0x3fc2a8(0x141)])()});const _0x57008d=await this['salesforceService'][_0x3fc2a8(0xeb)](this[_0x3fc2a8(0x140)][_0x3fc2a8(0x142)])[_0x3fc2a8(0xed)](_0x4408d5=>_0x4408d5[_0x3fc2a8(0x128)]('\x20')[_0x3fc2a8(0x135)](_0x244469=>_0x244469[_0x3fc2a8(0x10e)]()));await this[_0x3fc2a8(0xf9)][_0x3fc2a8(0x13d)](this[_0x3fc2a8(0x140)][_0x3fc2a8(0x142)]);const _0x2f2963=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x3fc2a8(0xf9)]);return await _0x2f2963[_0x3fc2a8(0x115)](_0x57008d);}async[a104_0x2f0c80(0xf4)](){const _0x6c5a3a=a104_0x2f0c80;if(!this[_0x6c5a3a(0x140)][_0x6c5a3a(0xf1)])return[];await this['salesforceService'][_0x6c5a3a(0x11d)](constants_1[_0x6c5a3a(0xff)],this[_0x6c5a3a(0x140)][_0x6c5a3a(0xf1)],{'Name':(0x0,shortid_1[_0x6c5a3a(0x141)])()});const _0x16900d=await this[_0x6c5a3a(0xf9)][_0x6c5a3a(0xeb)](this['commitData']['deleteAttachmentId']);return await this['salesforceService'][_0x6c5a3a(0x13d)](this[_0x6c5a3a(0x140)]['deleteAttachmentId']),_0x16900d;}async['getCommitDto'](){const _0x442b5f=a104_0x2f0c80,_0x4b752a=new commit_components_dto_1[(_0x442b5f(0x108))](),[_0x372ccb,_0x559d03]=await Promise[_0x442b5f(0xf2)]([this[_0x442b5f(0xfc)](),this[_0x442b5f(0xf4)]()]);return _0x4b752a['message']=this[_0x442b5f(0x140)]['message'],_0x4b752a[_0x442b5f(0x10c)]=this[_0x442b5f(0x140)][_0x442b5f(0x10c)],_0x4b752a[_0x442b5f(0x11c)]={'writed':_0x372ccb,'deleted':_0x559d03},_0x4b752a['convertToSFDX']=this[_0x442b5f(0x118)]['isConvertToSfdx'],_0x4b752a[_0x442b5f(0x134)]=this[_0x442b5f(0x119)],_0x4b752a[_0x442b5f(0x106)]=this[_0x442b5f(0x106)],_0x4b752a[_0x442b5f(0x110)]=this[_0x442b5f(0x118)][_0x442b5f(0x11f)],_0x4b752a;}async[a104_0x2f0c80(0x12b)](_0x55e62f=![]){const _0x3c46bd=a104_0x2f0c80;if(_0x55e62f)await this['salesforceSync']['updateRemoteState'](this['repositoryData'],{});else{const _0x35360b=await this[_0x3c46bd(0x119)]['branches'][_0x3c46bd(0x116)](this[_0x3c46bd(0x106)]['name']);this[_0x3c46bd(0xe1)][_0x3c46bd(0x12f)](this[_0x3c46bd(0xec)]+_0x3c46bd(0xe0));const _0x2082be={[this['repository']['gitUrl']]:{'lastCommit':_0x35360b[_0x3c46bd(0xdf)]}};await this['salesforceSync'][_0x3c46bd(0x10a)](this[_0x3c46bd(0x11e)],_0x2082be);}}async[a104_0x2f0c80(0xf5)](){const _0x3014f7=a104_0x2f0c80,_0x21ce20=await this[_0x3014f7(0x138)]();await this['salesforceSync'][_0x3014f7(0x12c)](this[_0x3014f7(0x11e)],_0x3014f7(0x13a)),await this[_0x3014f7(0x114)]['run'](_0x21ce20,this[_0x3014f7(0xec)]),await this[_0x3014f7(0x12b)](),await this[_0x3014f7(0x111)]['setStatus'](this[_0x3014f7(0x11e)],_0x3014f7(0x130));}async['handleCommitJobError'](_0xdfa1b2){const _0x148c9c=a104_0x2f0c80;try{this[_0x148c9c(0xe1)]['error'](''+_0xdfa1b2),await this[_0x148c9c(0xe1)][_0x148c9c(0x137)](),await this[_0x148c9c(0x12b)](!![]),await this[_0x148c9c(0x111)][_0x148c9c(0x12c)](this[_0x148c9c(0x11e)],_0x148c9c(0xe5));}catch(_0x4e39be){this['logger'][_0x148c9c(0x101)](_0x4e39be);}}async['run'](_0x451557){const _0x1afb8a=a104_0x2f0c80;try{this[_0x1afb8a(0x140)]=_0x451557,this[_0x1afb8a(0x125)]=typedi_1[_0x1afb8a(0xef)]['get'](providers_tokens_1[_0x1afb8a(0xf0)]['gitApiService']),this[_0x1afb8a(0xe9)]=typedi_1[_0x1afb8a(0xef)][_0x1afb8a(0x105)](providers_tokens_1['Tokens'][_0x1afb8a(0xe8)]),this['config']=typedi_1[_0x1afb8a(0xef)]['get'](providers_tokens_1[_0x1afb8a(0xf0)][_0x1afb8a(0x118)]),await this[_0x1afb8a(0x112)](),this['repository']=await this[_0x1afb8a(0xe9)][_0x1afb8a(0x116)](this[_0x1afb8a(0x11e)][_0x1afb8a(0x10f)]),this['branch']=await this['repository']['branches'][_0x1afb8a(0x116)](this['repositoryData'][_0x1afb8a(0x143)]),this['sfLogger']=typedi_1[_0x1afb8a(0xef)][_0x1afb8a(0x105)](providers_tokens_1['Tokens'][_0x1afb8a(0x129)]),this[_0x1afb8a(0xec)]=_0x1afb8a(0xf7)+this[_0x1afb8a(0x118)]['gitProvider'][_0x1afb8a(0x124)]()+']\x20[Repository:\x20'+this['repositoryData']['repositoryName']+_0x1afb8a(0xe4)+this[_0x1afb8a(0x11e)]['branchName']+']\x20['+FlosumCommitJob_1[_0x1afb8a(0xf3)]+']';if(!this[_0x1afb8a(0x11e)])throw new bad_request_error_1['BadRequestError'](errors_1[_0x1afb8a(0xdd)]);await this[_0x1afb8a(0xe1)]['log'](this[_0x1afb8a(0xec)]+'\x20Start\x20Flosum\x20commit\x20job.')['send'](),await this[_0x1afb8a(0xf5)]()[_0x1afb8a(0x103)](_0x46e5f4=>this[_0x1afb8a(0xfe)](_0x46e5f4));}catch(_0x2148ec){this['commitData']=undefined,this[_0x1afb8a(0x129)]['error'](_0x2148ec);throw _0x2148ec;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a104_0x2f0c80(0x12d)])({'transient':!![]}),__metadata(a104_0x2f0c80(0xe6),[salesforce_service_1[a104_0x2f0c80(0x109)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a104_0x2f0c80(0x122)]])],FlosumCommitJob),exports[a104_0x2f0c80(0x13e)]=FlosumCommitJob;