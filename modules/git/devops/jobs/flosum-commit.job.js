const a124_0x5c58aa=a124_0x1073;(function(_0x14fe14,_0x141615){const _0x400341=a124_0x1073,_0x7a3f29=_0x14fe14();while(!![]){try{const _0x5b67ca=-parseInt(_0x400341(0xd0))/0x1+parseInt(_0x400341(0xa7))/0x2+parseInt(_0x400341(0x8b))/0x3+parseInt(_0x400341(0xe0))/0x4+-parseInt(_0x400341(0x94))/0x5*(parseInt(_0x400341(0x83))/0x6)+parseInt(_0x400341(0xa5))/0x7+-parseInt(_0x400341(0xc1))/0x8;if(_0x5b67ca===_0x141615)break;else _0x7a3f29['push'](_0x7a3f29['shift']());}catch(_0x493374){_0x7a3f29['push'](_0x7a3f29['shift']());}}}(a124_0x5cf9,0xd85be));const a124_0xbfb2f6=(function(){let _0x149741=!![];return function(_0x11780d,_0x2f67a8){const _0x269424=_0x149741?function(){const _0x7fd4dc=a124_0x1073;if(_0x2f67a8){const _0x514258=_0x2f67a8[_0x7fd4dc(0xc7)](_0x11780d,arguments);return _0x2f67a8=null,_0x514258;}}:function(){};return _0x149741=![],_0x269424;};}()),a124_0x3361cc=a124_0xbfb2f6(this,function(){const _0x26433f=a124_0x1073;return a124_0x3361cc[_0x26433f(0xb2)]()['search']('(((.+)+)+)+$')[_0x26433f(0xb2)]()[_0x26433f(0x9a)](a124_0x3361cc)[_0x26433f(0xc8)]('(((.+)+)+)+$');});a124_0x3361cc();'use strict';var __decorate=this&&this['__decorate']||function(_0x3d52f1,_0x4792dd,_0x197145,_0x2fd9fb){const _0x164239=a124_0x1073;var _0x5bc648=arguments['length'],_0x684593=_0x5bc648<0x3?_0x4792dd:_0x2fd9fb===null?_0x2fd9fb=Object[_0x164239(0xd6)](_0x4792dd,_0x197145):_0x2fd9fb,_0x278fa3;if(typeof Reflect===_0x164239(0xac)&&typeof Reflect[_0x164239(0xb1)]===_0x164239(0x9b))_0x684593=Reflect[_0x164239(0xb1)](_0x3d52f1,_0x4792dd,_0x197145,_0x2fd9fb);else{for(var _0x557e5c=_0x3d52f1['length']-0x1;_0x557e5c>=0x0;_0x557e5c--)if(_0x278fa3=_0x3d52f1[_0x557e5c])_0x684593=(_0x5bc648<0x3?_0x278fa3(_0x684593):_0x5bc648>0x3?_0x278fa3(_0x4792dd,_0x197145,_0x684593):_0x278fa3(_0x4792dd,_0x197145))||_0x684593;}return _0x5bc648>0x3&&_0x684593&&Object['defineProperty'](_0x4792dd,_0x197145,_0x684593),_0x684593;},__metadata=this&&this[a124_0x5c58aa(0x8f)]||function(_0x1796c1,_0x4c8dd2){const _0x1fc933=a124_0x5c58aa;if(typeof Reflect==='object'&&typeof Reflect[_0x1fc933(0xbf)]===_0x1fc933(0x9b))return Reflect[_0x1fc933(0xbf)](_0x1796c1,_0x4c8dd2);},__importDefault=this&&this[a124_0x5c58aa(0xda)]||function(_0x52a466){return _0x52a466&&_0x52a466['__esModule']?_0x52a466:{'default':_0x52a466};},FlosumCommitJob_1;function a124_0x5cf9(){const _0x13127d=['retrieveAttachment','getComponentsToWrite','ERR_UNKNOWN_SYNC_RECORD_ID','salesforceService','7017794dDPYQq','Error','1907186pzJcfA','isEmailNotificationsEnabled','ERR_INVALID_SYNC_RECORD_ID','deleteAttachmentId','catch','object','patchObject','repo','\x20Update\x20remote\x20state.','parse','decorate','toString','email','getCommitDto','convertToSFDX','repositoryData','getRepositoryRecord','getComponentsToDelete','getBranchRecord','fetchRepositoryData','user','BadRequestError','../../salesforce/services/salesforce.service','error','metadata','__esModule','7972696XHglBF','branchName','Tokens','SalesforceRetrieverService','provider','logger','apply','search','deleteAttachment','../../salesforce/services/salesforce-sync.service','info','../../notifications/commit-to-git-error.notification','split','SalesforceSyncService','repository','97412MPlfmx','salesforceSync','../../../../core/errors/bad-request.error','\x20Start\x20Flosum\x20commit\x20job.','branches','syncBranchId','getOwnPropertyDescriptor','getOne','syncRepositoryId','../../salesforce/services/salesforce-retriever.service','__importDefault','toUpperCase','gitApiService','log','config','default','5000060olfAMB','recordTypeName','get','SalesforceService','sfLogger','commitJob','repositoryName','prefix','send','Email\x20notifications\x20are\x20disabled.','gitProvider','Completed','FlosumCommitJob','CommitComponentsJob','exec','shortid','./commit-components.job','updateRemoteState','branch','CommitToGitErrorNotification','gitRepoService','message','6eNgSKk','CommitComponentsDto','gitUrl','execute','handleCommitJobError','../../providers/providers.tokens','../dto/commit-components.dto','../../../../constants/errors','282318YKYkMf','defineProperty','commitAttachmentId','recordType','__metadata','CommitToGitCompletedNotification','../../../../constants','map','name','6600255KMuXeM','../../../../core','In\x20Progress','errorNotification','components','isConvertToSfdx','constructor','function','setStatus','updateLastCommit','completeNotification','typedi','commitData'];a124_0x5cf9=function(){return _0x13127d;};return a124_0x5cf9();}Object[a124_0x5c58aa(0x8c)](exports,a124_0x5c58aa(0xc0),{'value':!![]}),exports[a124_0x5c58aa(0x79)]=void 0x0;function a124_0x1073(_0x519836,_0x1a8c2f){const _0x616072=a124_0x5cf9();return a124_0x1073=function(_0x3361cc,_0xbfb2f6){_0x3361cc=_0x3361cc-0x71;let _0x5cf999=_0x616072[_0x3361cc];return _0x5cf999;},a124_0x1073(_0x519836,_0x1a8c2f);}const core_1=require(a124_0x5c58aa(0x95)),salesforce_service_1=require(a124_0x5c58aa(0xbd)),typedi_1=require(a124_0x5c58aa(0x9f)),errors_1=require(a124_0x5c58aa(0x8a)),bad_request_error_1=require(a124_0x5c58aa(0xd2)),salesforce_retriever_service_1=require(a124_0x5c58aa(0xd9)),salesforce_sync_service_1=require(a124_0x5c58aa(0xca)),commit_components_dto_1=require(a124_0x5c58aa(0x89)),commit_components_job_1=require(a124_0x5c58aa(0x7d)),constants_1=require(a124_0x5c58aa(0x91)),shortid_1=__importDefault(require(a124_0x5c58aa(0x7c))),providers_tokens_1=require(a124_0x5c58aa(0x88)),commit_to_git_completed_notification_1=require('../../notifications/commit-to-git-completed.notification'),commit_to_git_error_notification_1=require(a124_0x5c58aa(0xcc));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x596e70,_0x209bb5,_0x3e145d){const _0x7986e4=a124_0x5c58aa;this[_0x7986e4(0xa4)]=_0x596e70,this[_0x7986e4(0x72)]=_0x209bb5,this[_0x7986e4(0xd1)]=_0x3e145d,this[_0x7986e4(0xc6)]=new core_1['Logger'](FlosumCommitJob_1['name']);}async['completeNotification'](_0x189c4a,_0x1dcd0d,_0x4f2de2,_0x8dd39a){const _0x27d07b=a124_0x5c58aa;if(!this['commitData']['isEmailNotificationsEnabled']){this[_0x27d07b(0xc6)][_0x27d07b(0xcb)](_0x27d07b(0x76));return;}await new commit_to_git_completed_notification_1[(_0x27d07b(0x90))]({'emails':_0x189c4a,'gitProvider':_0x1dcd0d,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1[_0x27d07b(0x90)][_0x27d07b(0x93)],'repositoryName':_0x4f2de2,'branchName':_0x8dd39a})[_0x27d07b(0x86)]();}async[a124_0x5c58aa(0x97)](_0x153cda,_0x406110,_0xb84b2c,_0x5712a2){const _0x36243e=a124_0x5c58aa;if(!this[_0x36243e(0xa0)][_0x36243e(0xa8)]){this[_0x36243e(0xc6)][_0x36243e(0xcb)](_0x36243e(0x76));return;}await new commit_to_git_error_notification_1['CommitToGitErrorNotification']({'emails':_0x153cda,'gitProvider':_0x406110,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0x36243e(0x80)][_0x36243e(0x93)],'repositoryName':_0xb84b2c,'branchName':_0x5712a2})[_0x36243e(0x86)]();}async[a124_0x5c58aa(0xba)](){const _0x298622=a124_0x5c58aa;try{if(this['commitData'][_0x298622(0xd8)])this[_0x298622(0xb6)]=await this['salesforceSync'][_0x298622(0xb7)](this[_0x298622(0xa0)][_0x298622(0xd8)]);else this[_0x298622(0xa0)][_0x298622(0xd5)]&&(this[_0x298622(0xb6)]=await this[_0x298622(0xd1)][_0x298622(0xb9)](this['commitData'][_0x298622(0xd5)]));}catch(_0x293eed){throw new bad_request_error_1[(_0x298622(0xbc))](errors_1[_0x298622(0xa9)]);}}async[a124_0x5c58aa(0xa2)](){const _0x210d22=a124_0x5c58aa;if(!this['commitData']['commitAttachmentId'])return[];await this[_0x210d22(0xa4)][_0x210d22(0xad)](constants_1['FLOSUM_ATTACHMENT'],this[_0x210d22(0xa0)][_0x210d22(0x8d)],{'Name':(0x0,shortid_1[_0x210d22(0xdf)])()});const _0xcf7ca5=await this[_0x210d22(0xa4)][_0x210d22(0xa1)](this['commitData'][_0x210d22(0x8d)])['then'](_0xcf21f7=>_0xcf21f7[_0x210d22(0xcd)]('\x20')[_0x210d22(0x92)](_0x3dfbea=>_0x3dfbea['trim']()));await this[_0x210d22(0xa4)][_0x210d22(0xc9)](this['commitData'][_0x210d22(0x8d)]);const _0x99c464=new salesforce_retriever_service_1[(_0x210d22(0xc4))](this[_0x210d22(0xa4)]);return await _0x99c464['run'](_0xcf7ca5);}async['getComponentsToDelete'](){const _0x585ecc=a124_0x5c58aa;if(!this[_0x585ecc(0xa0)][_0x585ecc(0xaa)])return[];await this[_0x585ecc(0xa4)][_0x585ecc(0xad)](constants_1['FLOSUM_ATTACHMENT'],this[_0x585ecc(0xa0)][_0x585ecc(0xaa)],{'Name':(0x0,shortid_1['default'])()});const _0x12d31c=await this['salesforceService'][_0x585ecc(0xa1)](this[_0x585ecc(0xa0)][_0x585ecc(0xaa)]),_0x520297=JSON[_0x585ecc(0xb0)](_0x12d31c);return await this['salesforceService'][_0x585ecc(0xc9)](this[_0x585ecc(0xa0)]['deleteAttachmentId']),_0x520297;}async['getCommitDto'](){const _0x3c9050=a124_0x5c58aa,_0x1c137c=new commit_components_dto_1[(_0x3c9050(0x84))](),[_0x4e7016,_0x42c643]=await Promise['all']([this[_0x3c9050(0xa2)](),this[_0x3c9050(0xb8)]()]);return _0x1c137c[_0x3c9050(0x82)]=this[_0x3c9050(0xa0)]['message'],_0x1c137c[_0x3c9050(0xbb)]=this[_0x3c9050(0xa0)][_0x3c9050(0xbb)],_0x1c137c[_0x3c9050(0x98)]={'writed':_0x4e7016,'deleted':_0x42c643},_0x1c137c[_0x3c9050(0xb5)]=this[_0x3c9050(0xde)][_0x3c9050(0x99)],_0x1c137c[_0x3c9050(0xae)]=this[_0x3c9050(0xcf)],_0x1c137c[_0x3c9050(0x7f)]=this[_0x3c9050(0x7f)],_0x1c137c[_0x3c9050(0xc5)]=this[_0x3c9050(0xde)]['gitProvider'],_0x1c137c[_0x3c9050(0x8e)]=this['repositoryData'][_0x3c9050(0xe1)],_0x1c137c;}async['updateLastCommit'](_0x53333b=![]){const _0x4bf68f=a124_0x5c58aa;if(_0x53333b)await this[_0x4bf68f(0xd1)]['updateRemoteState'](this['repositoryData'],{});else{const _0xc2e56c=await this[_0x4bf68f(0xcf)][_0x4bf68f(0xd4)][_0x4bf68f(0xd7)](this['branch']['name']);this[_0x4bf68f(0x71)][_0x4bf68f(0xdd)](this['prefix']+_0x4bf68f(0xaf));const _0x5861df={[this[_0x4bf68f(0xcf)][_0x4bf68f(0x85)]]:{'lastCommit':_0xc2e56c['sha']}};await this['salesforceSync'][_0x4bf68f(0x7e)](this[_0x4bf68f(0xb6)],_0x5861df);}}async['exec'](){const _0x22ae4a=a124_0x5c58aa,_0x4c04da=await this[_0x22ae4a(0xb4)]();await this[_0x22ae4a(0xd1)]['setStatus'](this['repositoryData'],_0x22ae4a(0x96)),await this[_0x22ae4a(0x72)]['run'](_0x4c04da,this['prefix']),await this[_0x22ae4a(0x9d)](),await this[_0x22ae4a(0xd1)][_0x22ae4a(0x9c)](this[_0x22ae4a(0xb6)],_0x22ae4a(0x78));}async[a124_0x5c58aa(0x87)](_0x1fa3ea){const _0x46e68f=a124_0x5c58aa;try{this['sfLogger']['error'](''+_0x1fa3ea),await this[_0x46e68f(0x71)][_0x46e68f(0x75)](),await this[_0x46e68f(0x9d)](!![]),await this[_0x46e68f(0xd1)][_0x46e68f(0x9c)](this[_0x46e68f(0xb6)],_0x46e68f(0xa6)),await this[_0x46e68f(0x9e)]([this[_0x46e68f(0xa0)][_0x46e68f(0xbb)][_0x46e68f(0xb3)]],this[_0x46e68f(0xde)][_0x46e68f(0x77)],this[_0x46e68f(0xcf)][_0x46e68f(0x93)],this[_0x46e68f(0x7f)][_0x46e68f(0x93)]);}catch(_0x4de8b1){this['logger'][_0x46e68f(0xbe)](_0x4de8b1),await this[_0x46e68f(0x97)]([this[_0x46e68f(0xa0)][_0x46e68f(0xbb)][_0x46e68f(0xb3)]],this[_0x46e68f(0xde)]['gitProvider'],this[_0x46e68f(0xcf)][_0x46e68f(0x93)],this['branch'][_0x46e68f(0x93)]);}}async['run'](_0x1a854e){const _0x571aa1=a124_0x5c58aa;try{this['commitData']=_0x1a854e,this[_0x571aa1(0xdc)]=typedi_1['Container']['get'](providers_tokens_1[_0x571aa1(0xc3)][_0x571aa1(0xdc)]),this['repoService']=typedi_1['Container'][_0x571aa1(0xe2)](providers_tokens_1[_0x571aa1(0xc3)][_0x571aa1(0x81)]),this['config']=typedi_1['Container']['get'](providers_tokens_1[_0x571aa1(0xc3)][_0x571aa1(0xde)]),await this[_0x571aa1(0xba)](),this[_0x571aa1(0xcf)]=await this['repoService']['getOne'](this[_0x571aa1(0xb6)][_0x571aa1(0x73)]),this[_0x571aa1(0x7f)]=await this[_0x571aa1(0xcf)][_0x571aa1(0xd4)][_0x571aa1(0xd7)](this['repositoryData']['branchName']),this[_0x571aa1(0x71)]=typedi_1['Container']['get'](providers_tokens_1['Tokens'][_0x571aa1(0xc6)]),this[_0x571aa1(0x74)]='[FLOSUM\x20->\x20GIT]\x20['+this[_0x571aa1(0xde)][_0x571aa1(0x77)][_0x571aa1(0xdb)]()+']\x20[Repository:\x20'+this[_0x571aa1(0xb6)]['repositoryName']+']\x20[Branch:\x20'+this['repositoryData'][_0x571aa1(0xc2)]+']\x20['+FlosumCommitJob_1[_0x571aa1(0x93)]+']';if(!this[_0x571aa1(0xb6)])throw new bad_request_error_1[(_0x571aa1(0xbc))](errors_1[_0x571aa1(0xa3)]);await this['sfLogger'][_0x571aa1(0xdd)](this[_0x571aa1(0x74)]+_0x571aa1(0xd3))[_0x571aa1(0x75)](),await this[_0x571aa1(0x7b)]()[_0x571aa1(0xab)](_0x1220d2=>this[_0x571aa1(0x87)](_0x1220d2)),await this[_0x571aa1(0x9e)]([this[_0x571aa1(0xa0)][_0x571aa1(0xbb)][_0x571aa1(0xb3)]],this[_0x571aa1(0xde)]['gitProvider'],this[_0x571aa1(0xcf)][_0x571aa1(0x93)],this[_0x571aa1(0x7f)][_0x571aa1(0x93)]);}catch(_0x4ea4f6){this[_0x571aa1(0xa0)]=undefined,this[_0x571aa1(0xc6)]['error'](_0x4ea4f6),await this[_0x571aa1(0x97)]([this[_0x571aa1(0xa0)][_0x571aa1(0xbb)][_0x571aa1(0xb3)]],this[_0x571aa1(0xde)][_0x571aa1(0x77)],this[_0x571aa1(0xcf)][_0x571aa1(0x93)],this[_0x571aa1(0x7f)][_0x571aa1(0x93)]);throw _0x4ea4f6;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a124_0x5c58aa(0xe3)],commit_components_job_1[a124_0x5c58aa(0x7a)],salesforce_sync_service_1[a124_0x5c58aa(0xce)]])],FlosumCommitJob),exports[a124_0x5c58aa(0x79)]=FlosumCommitJob;