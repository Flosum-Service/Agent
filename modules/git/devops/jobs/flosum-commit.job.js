const a74_0x1ec8b4=a74_0x14f5;(function(_0x31112e,_0x4e9003){const _0xf57244=a74_0x14f5,_0x344eca=_0x31112e();while(!![]){try{const _0x2743f5=-parseInt(_0xf57244(0x1da))/0x1+-parseInt(_0xf57244(0x1a2))/0x2+-parseInt(_0xf57244(0x1c3))/0x3*(-parseInt(_0xf57244(0x199))/0x4)+-parseInt(_0xf57244(0x195))/0x5+parseInt(_0xf57244(0x1d4))/0x6+parseInt(_0xf57244(0x1f7))/0x7+-parseInt(_0xf57244(0x1e8))/0x8*(-parseInt(_0xf57244(0x1b1))/0x9);if(_0x2743f5===_0x4e9003)break;else _0x344eca['push'](_0x344eca['shift']());}catch(_0x3ee3db){_0x344eca['push'](_0x344eca['shift']());}}}(a74_0x3ba6,0x35ce8));const a74_0x55ebb7=(function(){let _0x956ba3=!![];return function(_0x46e2d0,_0x3c3d79){const _0x55ecef=_0x956ba3?function(){const _0x3eb522=a74_0x14f5;if(_0x3c3d79){const _0x2691ca=_0x3c3d79[_0x3eb522(0x1c7)](_0x46e2d0,arguments);return _0x3c3d79=null,_0x2691ca;}}:function(){};return _0x956ba3=![],_0x55ecef;};}()),a74_0x131fbb=a74_0x55ebb7(this,function(){const _0x59ba38=a74_0x14f5;return a74_0x131fbb['toString']()[_0x59ba38(0x1d8)]('(((.+)+)+)+$')[_0x59ba38(0x1e2)]()[_0x59ba38(0x1f9)](a74_0x131fbb)[_0x59ba38(0x1d8)](_0x59ba38(0x1f4));});function a74_0x3ba6(){const _0x2c581e=['get','patchObject','message','all','decorate','__importDefault','__esModule','object','prefix','gitUrl','(((.+)+)+)+$','commitData','shortid','1510607VgpdZs','error','constructor','retrieveAttachment','BadRequestError','name','repo','1967690rNPXoe','gitProvider','SalesforceRetrieverService','send','4ozcErk','commitJob','catch','FlosumCommitJob','getOwnPropertyDescriptor','syncRepositoryId','metadata','getComponentsToWrite','branch','493244gSubMV','repositoryName','trim','sha','function','getBranchRecord','branches','getRepositoryRecord','gitApiService','salesforceSync','__metadata','../../../../core/errors/bad-request.error','commitAttachmentId','../../salesforce/services/salesforce-retriever.service','config','457713ZiZAbb','setStatus','repository','salesforceService','../../../../core','getCommitDto','user','fetchRepositoryData','repoService','Tokens','length','syncBranchId','In\x20Progress','Error',']\x20[Branch:\x20','SalesforceSyncService','../../providers/providers.tokens','ERR_UNKNOWN_SYNC_RECORD_ID','768201yLhQnJ','deleteAttachmentId','run','default','apply','\x20Update\x20remote\x20state.','updateLastCommit','[FLOSUM\x20->\x20GIT]\x20[','design:paramtypes','../dto/commit-components.dto','getOne','defineProperty','deleteAttachment','log','../../salesforce/services/salesforce-sync.service','FLOSUM_ATTACHMENT','CommitComponentsDto','767502YNvdCs','then','Container',']\x20[Repository:\x20','search',']\x20[','400374LNArfv','Logger','sfLogger','updateRemoteState','\x20Start\x20Flosum\x20commit\x20job.','exec','logger','../../../../constants/errors','toString','branchName','map','repositoryData','components','Service','104DTsZMy','getComponentsToDelete'];a74_0x3ba6=function(){return _0x2c581e;};return a74_0x3ba6();}a74_0x131fbb();'use strict';var __decorate=this&&this['__decorate']||function(_0xab7bf,_0x4811c5,_0x55b500,_0x12d9b4){const _0x3f382a=a74_0x14f5;var _0x326ce2=arguments[_0x3f382a(0x1bb)],_0xf8833f=_0x326ce2<0x3?_0x4811c5:_0x12d9b4===null?_0x12d9b4=Object[_0x3f382a(0x19d)](_0x4811c5,_0x55b500):_0x12d9b4,_0x39e7e2;if(typeof Reflect===_0x3f382a(0x1f1)&&typeof Reflect[_0x3f382a(0x1ee)]===_0x3f382a(0x1a6))_0xf8833f=Reflect[_0x3f382a(0x1ee)](_0xab7bf,_0x4811c5,_0x55b500,_0x12d9b4);else{for(var _0x5b627c=_0xab7bf[_0x3f382a(0x1bb)]-0x1;_0x5b627c>=0x0;_0x5b627c--)if(_0x39e7e2=_0xab7bf[_0x5b627c])_0xf8833f=(_0x326ce2<0x3?_0x39e7e2(_0xf8833f):_0x326ce2>0x3?_0x39e7e2(_0x4811c5,_0x55b500,_0xf8833f):_0x39e7e2(_0x4811c5,_0x55b500))||_0xf8833f;}return _0x326ce2>0x3&&_0xf8833f&&Object[_0x3f382a(0x1ce)](_0x4811c5,_0x55b500,_0xf8833f),_0xf8833f;},__metadata=this&&this[a74_0x1ec8b4(0x1ac)]||function(_0xfbf293,_0x13ec66){const _0x110c16=a74_0x1ec8b4;if(typeof Reflect==='object'&&typeof Reflect[_0x110c16(0x19f)]===_0x110c16(0x1a6))return Reflect[_0x110c16(0x19f)](_0xfbf293,_0x13ec66);},__importDefault=this&&this[a74_0x1ec8b4(0x1ef)]||function(_0x2a5954){const _0x945894=a74_0x1ec8b4;return _0x2a5954&&_0x2a5954[_0x945894(0x1f0)]?_0x2a5954:{'default':_0x2a5954};},FlosumCommitJob_1;Object[a74_0x1ec8b4(0x1ce)](exports,'__esModule',{'value':!![]}),exports[a74_0x1ec8b4(0x19c)]=void 0x0;function a74_0x14f5(_0xbd719b,_0x578bbf){const _0x1297ba=a74_0x3ba6();return a74_0x14f5=function(_0x131fbb,_0x55ebb7){_0x131fbb=_0x131fbb-0x195;let _0x3ba6ad=_0x1297ba[_0x131fbb];return _0x3ba6ad;},a74_0x14f5(_0xbd719b,_0x578bbf);}const core_1=require(a74_0x1ec8b4(0x1b5)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require('typedi'),errors_1=require(a74_0x1ec8b4(0x1e1)),bad_request_error_1=require(a74_0x1ec8b4(0x1ad)),salesforce_retriever_service_1=require(a74_0x1ec8b4(0x1af)),salesforce_sync_service_1=require(a74_0x1ec8b4(0x1d1)),commit_components_dto_1=require(a74_0x1ec8b4(0x1cc)),commit_components_job_1=require('./commit-components.job'),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a74_0x1ec8b4(0x1f6))),providers_tokens_1=require(a74_0x1ec8b4(0x1c1));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x3e1903,_0x38e3d8,_0x5940c9){const _0x209c0e=a74_0x1ec8b4;this[_0x209c0e(0x1b4)]=_0x3e1903,this[_0x209c0e(0x19a)]=_0x38e3d8,this[_0x209c0e(0x1ab)]=_0x5940c9,this['logger']=new core_1[(_0x209c0e(0x1db))](FlosumCommitJob_1[_0x209c0e(0x1fc)]);}async[a74_0x1ec8b4(0x1b8)](){const _0x36158d=a74_0x1ec8b4;try{if(this['commitData'][_0x36158d(0x19e)])this['repositoryData']=await this[_0x36158d(0x1ab)][_0x36158d(0x1a9)](this[_0x36158d(0x1f5)]['syncRepositoryId']);else this[_0x36158d(0x1f5)][_0x36158d(0x1bc)]&&(this['repositoryData']=await this[_0x36158d(0x1ab)][_0x36158d(0x1a7)](this[_0x36158d(0x1f5)]['syncBranchId']));}catch(_0x243703){throw new bad_request_error_1[(_0x36158d(0x1fb))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a74_0x1ec8b4(0x1a0)](){const _0x3184dc=a74_0x1ec8b4;if(!this[_0x3184dc(0x1f5)][_0x3184dc(0x1ae)])return[];await this[_0x3184dc(0x1b4)][_0x3184dc(0x1eb)](constants_1[_0x3184dc(0x1d2)],this[_0x3184dc(0x1f5)][_0x3184dc(0x1ae)],{'Name':(0x0,shortid_1[_0x3184dc(0x1c6)])()});const _0x1db42d=await this['salesforceService']['retrieveAttachment'](this['commitData']['commitAttachmentId'])[_0x3184dc(0x1d5)](_0x3f2ee8=>_0x3f2ee8['split']('\x20')[_0x3184dc(0x1e4)](_0x4743a9=>_0x4743a9[_0x3184dc(0x1a4)]()));await this[_0x3184dc(0x1b4)][_0x3184dc(0x1cf)](this['commitData']['commitAttachmentId']);const _0x1731fa=new salesforce_retriever_service_1[(_0x3184dc(0x197))](this['salesforceService']);return await _0x1731fa[_0x3184dc(0x1c5)](_0x1db42d);}async[a74_0x1ec8b4(0x1e9)](){const _0x1433ec=a74_0x1ec8b4;if(!this[_0x1433ec(0x1f5)]['deleteAttachmentId'])return[];await this['salesforceService'][_0x1433ec(0x1eb)](constants_1[_0x1433ec(0x1d2)],this[_0x1433ec(0x1f5)][_0x1433ec(0x1c4)],{'Name':(0x0,shortid_1['default'])()});const _0x23f20d=await this[_0x1433ec(0x1b4)][_0x1433ec(0x1fa)](this[_0x1433ec(0x1f5)]['deleteAttachmentId']);return await this[_0x1433ec(0x1b4)][_0x1433ec(0x1cf)](this['commitData'][_0x1433ec(0x1c4)]),_0x23f20d;}async[a74_0x1ec8b4(0x1b6)](){const _0x7451fa=a74_0x1ec8b4,_0x89d393=new commit_components_dto_1[(_0x7451fa(0x1d3))](),[_0x422066,_0x19a084]=await Promise[_0x7451fa(0x1ed)]([this['getComponentsToWrite'](),this[_0x7451fa(0x1e9)]()]);return _0x89d393['message']=this['commitData'][_0x7451fa(0x1ec)],_0x89d393['user']=this[_0x7451fa(0x1f5)][_0x7451fa(0x1b7)],_0x89d393[_0x7451fa(0x1e6)]={'writed':_0x422066,'deleted':_0x19a084},_0x89d393['convertToSFDX']=this[_0x7451fa(0x1b0)]['isConvertToSfdx'],_0x89d393[_0x7451fa(0x1fd)]=this[_0x7451fa(0x1b3)],_0x89d393['branch']=this[_0x7451fa(0x1a1)],_0x89d393['provider']=this[_0x7451fa(0x1b0)][_0x7451fa(0x196)],_0x89d393;}async[a74_0x1ec8b4(0x1c9)](_0x456702=![]){const _0x79004b=a74_0x1ec8b4;if(_0x456702)await this[_0x79004b(0x1ab)][_0x79004b(0x1dd)](this[_0x79004b(0x1e5)],{});else{const _0x3a0c4d=await this[_0x79004b(0x1b3)][_0x79004b(0x1a8)][_0x79004b(0x1cd)](this['branch']['name']);this[_0x79004b(0x1dc)][_0x79004b(0x1d0)](this[_0x79004b(0x1f2)]+_0x79004b(0x1c8));const _0x4aa411={[this[_0x79004b(0x1b3)][_0x79004b(0x1f3)]]:{'lastCommit':_0x3a0c4d[_0x79004b(0x1a5)]}};await this[_0x79004b(0x1ab)][_0x79004b(0x1dd)](this[_0x79004b(0x1e5)],_0x4aa411);}}async['exec'](){const _0x33c182=a74_0x1ec8b4,_0x2b26b8=await this[_0x33c182(0x1b6)]();await this[_0x33c182(0x1ab)]['setStatus'](this[_0x33c182(0x1e5)],_0x33c182(0x1bd)),await this[_0x33c182(0x19a)][_0x33c182(0x1c5)](_0x2b26b8,this['prefix']),await this[_0x33c182(0x1c9)](),await this[_0x33c182(0x1ab)][_0x33c182(0x1b2)](this['repositoryData'],'Completed');}async['handleCommitJobError'](_0x34920e){const _0x5863c2=a74_0x1ec8b4;try{this[_0x5863c2(0x1dc)][_0x5863c2(0x1f8)](''+_0x34920e),await this[_0x5863c2(0x1dc)][_0x5863c2(0x198)](),await this[_0x5863c2(0x1c9)](!![]),await this[_0x5863c2(0x1ab)][_0x5863c2(0x1b2)](this['repositoryData'],_0x5863c2(0x1be));}catch(_0x5dede6){this[_0x5863c2(0x1e0)][_0x5863c2(0x1f8)](_0x5dede6);}}async['run'](_0x1d1e25){const _0x5b5a9d=a74_0x1ec8b4;try{this[_0x5b5a9d(0x1f5)]=_0x1d1e25,this[_0x5b5a9d(0x1aa)]=typedi_1[_0x5b5a9d(0x1d6)][_0x5b5a9d(0x1ea)](providers_tokens_1[_0x5b5a9d(0x1ba)][_0x5b5a9d(0x1aa)]),this[_0x5b5a9d(0x1b9)]=typedi_1[_0x5b5a9d(0x1d6)][_0x5b5a9d(0x1ea)](providers_tokens_1['Tokens']['gitRepoService']),this[_0x5b5a9d(0x1b0)]=typedi_1['Container'][_0x5b5a9d(0x1ea)](providers_tokens_1[_0x5b5a9d(0x1ba)][_0x5b5a9d(0x1b0)]),await this[_0x5b5a9d(0x1b8)](),this[_0x5b5a9d(0x1b3)]=await this[_0x5b5a9d(0x1b9)][_0x5b5a9d(0x1cd)](this[_0x5b5a9d(0x1e5)][_0x5b5a9d(0x1a3)]),this[_0x5b5a9d(0x1a1)]=await this[_0x5b5a9d(0x1b3)][_0x5b5a9d(0x1a8)][_0x5b5a9d(0x1cd)](this['repositoryData']['branchName']),this[_0x5b5a9d(0x1dc)]=typedi_1[_0x5b5a9d(0x1d6)][_0x5b5a9d(0x1ea)](providers_tokens_1[_0x5b5a9d(0x1ba)][_0x5b5a9d(0x1e0)]),this['prefix']=_0x5b5a9d(0x1ca)+this[_0x5b5a9d(0x1b0)][_0x5b5a9d(0x196)]['toUpperCase']()+_0x5b5a9d(0x1d7)+this['repositoryData'][_0x5b5a9d(0x1a3)]+_0x5b5a9d(0x1bf)+this[_0x5b5a9d(0x1e5)][_0x5b5a9d(0x1e3)]+_0x5b5a9d(0x1d9)+FlosumCommitJob_1[_0x5b5a9d(0x1fc)]+']';if(!this['repositoryData'])throw new bad_request_error_1['BadRequestError'](errors_1[_0x5b5a9d(0x1c2)]);await this['sfLogger'][_0x5b5a9d(0x1d0)](this['prefix']+_0x5b5a9d(0x1de))[_0x5b5a9d(0x198)](),await this[_0x5b5a9d(0x1df)]()[_0x5b5a9d(0x19b)](_0x1d3a2a=>this['handleCommitJobError'](_0x1d3a2a));}catch(_0x4b3f9a){this[_0x5b5a9d(0x1f5)]=undefined,this[_0x5b5a9d(0x1e0)][_0x5b5a9d(0x1f8)](_0x4b3f9a);throw _0x4b3f9a;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a74_0x1ec8b4(0x1e7)])({'transient':!![]}),__metadata(a74_0x1ec8b4(0x1cb),[salesforce_service_1['SalesforceService'],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a74_0x1ec8b4(0x1c0)]])],FlosumCommitJob),exports[a74_0x1ec8b4(0x19c)]=FlosumCommitJob;