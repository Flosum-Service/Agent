const a105_0x127d95=a105_0x22e0;(function(_0x2c597a,_0x2af7c3){const _0x223ed0=a105_0x22e0,_0x26e94c=_0x2c597a();while(!![]){try{const _0xebdb8d=-parseInt(_0x223ed0(0x159))/0x1*(parseInt(_0x223ed0(0x170))/0x2)+parseInt(_0x223ed0(0x132))/0x3+-parseInt(_0x223ed0(0x136))/0x4*(-parseInt(_0x223ed0(0x130))/0x5)+-parseInt(_0x223ed0(0x16c))/0x6+parseInt(_0x223ed0(0x167))/0x7*(parseInt(_0x223ed0(0x180))/0x8)+-parseInt(_0x223ed0(0x15d))/0x9+parseInt(_0x223ed0(0x144))/0xa;if(_0xebdb8d===_0x2af7c3)break;else _0x26e94c['push'](_0x26e94c['shift']());}catch(_0x408b19){_0x26e94c['push'](_0x26e94c['shift']());}}}(a105_0x3f58,0x38750));const a105_0x37b924=(function(){let _0xd3d2d8=!![];return function(_0x12ba16,_0x5868c9){const _0x34fccb=_0xd3d2d8?function(){const _0x279f93=a105_0x22e0;if(_0x5868c9){const _0x213b5f=_0x5868c9[_0x279f93(0x166)](_0x12ba16,arguments);return _0x5868c9=null,_0x213b5f;}}:function(){};return _0xd3d2d8=![],_0x34fccb;};}()),a105_0x5e3653=a105_0x37b924(this,function(){const _0x77f8f7=a105_0x22e0;return a105_0x5e3653['toString']()['search'](_0x77f8f7(0x161))[_0x77f8f7(0x13f)]()[_0x77f8f7(0x14e)](a105_0x5e3653)[_0x77f8f7(0x13e)](_0x77f8f7(0x161));});a105_0x5e3653();function a105_0x22e0(_0x10167c,_0x3bf88e){const _0xb2ba45=a105_0x3f58();return a105_0x22e0=function(_0x5e3653,_0x37b924){_0x5e3653=_0x5e3653-0x12d;let _0x3f5826=_0xb2ba45[_0x5e3653];return _0x3f5826;},a105_0x22e0(_0x10167c,_0x3bf88e);}'use strict';var __decorate=this&&this['__decorate']||function(_0x48a414,_0x58c1aa,_0x5129ec,_0xfe6b28){const _0x379349=a105_0x22e0;var _0x382811=arguments['length'],_0x2a2e0d=_0x382811<0x3?_0x58c1aa:_0xfe6b28===null?_0xfe6b28=Object['getOwnPropertyDescriptor'](_0x58c1aa,_0x5129ec):_0xfe6b28,_0x19961f;if(typeof Reflect==='object'&&typeof Reflect[_0x379349(0x17d)]==='function')_0x2a2e0d=Reflect[_0x379349(0x17d)](_0x48a414,_0x58c1aa,_0x5129ec,_0xfe6b28);else{for(var _0x5acbaa=_0x48a414['length']-0x1;_0x5acbaa>=0x0;_0x5acbaa--)if(_0x19961f=_0x48a414[_0x5acbaa])_0x2a2e0d=(_0x382811<0x3?_0x19961f(_0x2a2e0d):_0x382811>0x3?_0x19961f(_0x58c1aa,_0x5129ec,_0x2a2e0d):_0x19961f(_0x58c1aa,_0x5129ec))||_0x2a2e0d;}return _0x382811>0x3&&_0x2a2e0d&&Object[_0x379349(0x151)](_0x58c1aa,_0x5129ec,_0x2a2e0d),_0x2a2e0d;},__metadata=this&&this[a105_0x127d95(0x17b)]||function(_0x3c46a5,_0x500e26){const _0xca2742=a105_0x127d95;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0xca2742(0x192))return Reflect[_0xca2742(0x156)](_0x3c46a5,_0x500e26);},__importDefault=this&&this['__importDefault']||function(_0x3a88c6){const _0x3efc09=a105_0x127d95;return _0x3a88c6&&_0x3a88c6[_0x3efc09(0x155)]?_0x3a88c6:{'default':_0x3a88c6};},FlosumCommitJob_1;function a105_0x3f58(){const _0x13b5f8=['search','toString','../../../../constants','Container',']\x20[','repositoryName','1271390gvCIBo','commitJob','typedi','ERR_UNKNOWN_SYNC_RECORD_ID','exec','trim','syncRepositoryId','repositoryData','name','repoService','constructor','isConvertToSfdx','toUpperCase','defineProperty','CommitComponentsDto','Error','convertToSFDX','__esModule','metadata','catch','repository','18OUFQwK','retrieveAttachment','\x20Start\x20Flosum\x20commit\x20job.','get','2920491tJgcHq','getCommitDto','sfLogger','getOne','(((.+)+)+)+$','patchObject','salesforceService','branch','provider','apply','134631dQshrk','BadRequestError','split','prefix','run','1386000tnxJmB','updateRemoteState','Service','SalesforceSyncService','19078HWlJua','user','branchName','fetchRepositoryData','send','getComponentsToWrite','SalesforceRetrieverService','branches','getComponentsToDelete','Tokens','shortid','__metadata','../dto/commit-components.dto','decorate','Logger','salesforceSync','112wuZpHn','gitApiService',']\x20[Branch:\x20','getRepositoryRecord','log','config','../../../../core','gitUrl','\x20Update\x20remote\x20state.','setStatus','gitProvider','SalesforceService','deleteAttachmentId','updateLastCommit','deleteAttachment','default','In\x20Progress','getBranchRecord','function','FlosumCommitJob','../../../../constants/errors','repo','5IihEpO','handleCommitJobError','623637vMIKib','map','message','logger','1416676PxINMS','CommitComponentsJob','error','components','all','commitData','commitAttachmentId','FLOSUM_ATTACHMENT'];a105_0x3f58=function(){return _0x13b5f8;};return a105_0x3f58();}Object['defineProperty'](exports,a105_0x127d95(0x155),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a105_0x127d95(0x186)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a105_0x127d95(0x146)),errors_1=require(a105_0x127d95(0x12e)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a105_0x127d95(0x17c)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a105_0x127d95(0x140)),shortid_1=__importDefault(require(a105_0x127d95(0x17a))),providers_tokens_1=require('../../providers/providers.tokens');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x10ae86,_0x22d2d7,_0x1f581b){const _0x310e34=a105_0x127d95;this[_0x310e34(0x163)]=_0x10ae86,this['commitJob']=_0x22d2d7,this[_0x310e34(0x17f)]=_0x1f581b,this[_0x310e34(0x135)]=new core_1[(_0x310e34(0x17e))](FlosumCommitJob_1['name']);}async[a105_0x127d95(0x173)](){const _0x564235=a105_0x127d95;try{if(this[_0x564235(0x13b)]['syncRepositoryId'])this[_0x564235(0x14b)]=await this['salesforceSync'][_0x564235(0x183)](this['commitData'][_0x564235(0x14a)]);else this['commitData']['syncBranchId']&&(this[_0x564235(0x14b)]=await this[_0x564235(0x17f)][_0x564235(0x191)](this['commitData']['syncBranchId']));}catch(_0x194958){throw new bad_request_error_1[(_0x564235(0x168))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a105_0x127d95(0x175)](){const _0x345b61=a105_0x127d95;if(!this[_0x345b61(0x13b)][_0x345b61(0x13c)])return[];await this['salesforceService'][_0x345b61(0x162)](constants_1[_0x345b61(0x13d)],this[_0x345b61(0x13b)][_0x345b61(0x13c)],{'Name':(0x0,shortid_1[_0x345b61(0x18f)])()});const _0x3b47ac=await this[_0x345b61(0x163)][_0x345b61(0x15a)](this[_0x345b61(0x13b)]['commitAttachmentId'])['then'](_0x59ece1=>_0x59ece1[_0x345b61(0x169)]('\x20')[_0x345b61(0x133)](_0x301543=>_0x301543[_0x345b61(0x149)]()));await this['salesforceService'][_0x345b61(0x18e)](this[_0x345b61(0x13b)][_0x345b61(0x13c)]);const _0x499481=new salesforce_retriever_service_1[(_0x345b61(0x176))](this['salesforceService']);return await _0x499481[_0x345b61(0x16b)](_0x3b47ac);}async[a105_0x127d95(0x178)](){const _0x4766d0=a105_0x127d95;if(!this[_0x4766d0(0x13b)][_0x4766d0(0x18c)])return[];await this[_0x4766d0(0x163)][_0x4766d0(0x162)](constants_1[_0x4766d0(0x13d)],this[_0x4766d0(0x13b)][_0x4766d0(0x18c)],{'Name':(0x0,shortid_1[_0x4766d0(0x18f)])()});const _0x44b631=await this['salesforceService'][_0x4766d0(0x15a)](this[_0x4766d0(0x13b)][_0x4766d0(0x18c)]);return await this[_0x4766d0(0x163)][_0x4766d0(0x18e)](this[_0x4766d0(0x13b)]['deleteAttachmentId']),_0x44b631;}async[a105_0x127d95(0x15e)](){const _0x38cedb=a105_0x127d95,_0x595615=new commit_components_dto_1[(_0x38cedb(0x152))](),[_0x1332b1,_0x7bddba]=await Promise[_0x38cedb(0x13a)]([this['getComponentsToWrite'](),this['getComponentsToDelete']()]);return _0x595615[_0x38cedb(0x134)]=this['commitData'][_0x38cedb(0x134)],_0x595615[_0x38cedb(0x171)]=this[_0x38cedb(0x13b)]['user'],_0x595615[_0x38cedb(0x139)]={'writed':_0x1332b1,'deleted':_0x7bddba},_0x595615[_0x38cedb(0x154)]=this['config'][_0x38cedb(0x14f)],_0x595615[_0x38cedb(0x12f)]=this[_0x38cedb(0x158)],_0x595615[_0x38cedb(0x164)]=this['branch'],_0x595615[_0x38cedb(0x165)]=this[_0x38cedb(0x185)][_0x38cedb(0x18a)],_0x595615;}async[a105_0x127d95(0x18d)](_0x344d7e=![]){const _0x40db15=a105_0x127d95;if(_0x344d7e)await this['salesforceSync'][_0x40db15(0x16d)](this[_0x40db15(0x14b)],{});else{const _0x439d59=await this[_0x40db15(0x158)][_0x40db15(0x177)][_0x40db15(0x160)](this[_0x40db15(0x164)][_0x40db15(0x14c)]);this[_0x40db15(0x15f)][_0x40db15(0x184)](this[_0x40db15(0x16a)]+_0x40db15(0x188));const _0x432cb6={[this[_0x40db15(0x158)][_0x40db15(0x187)]]:{'lastCommit':_0x439d59['sha']}};await this[_0x40db15(0x17f)]['updateRemoteState'](this[_0x40db15(0x14b)],_0x432cb6);}}async[a105_0x127d95(0x148)](){const _0xf4a1ae=a105_0x127d95,_0x2962f1=await this['getCommitDto']();await this[_0xf4a1ae(0x17f)]['setStatus'](this[_0xf4a1ae(0x14b)],_0xf4a1ae(0x190)),await this[_0xf4a1ae(0x145)][_0xf4a1ae(0x16b)](_0x2962f1,this[_0xf4a1ae(0x16a)]),await this[_0xf4a1ae(0x18d)](),await this['salesforceSync'][_0xf4a1ae(0x189)](this[_0xf4a1ae(0x14b)],'Completed');}async['handleCommitJobError'](_0x7394){const _0x231dc1=a105_0x127d95;try{this['sfLogger']['error'](''+_0x7394),await this[_0x231dc1(0x15f)][_0x231dc1(0x174)](),await this[_0x231dc1(0x18d)](!![]),await this[_0x231dc1(0x17f)][_0x231dc1(0x189)](this['repositoryData'],_0x231dc1(0x153));}catch(_0x22c51f){this[_0x231dc1(0x135)][_0x231dc1(0x138)](_0x22c51f);}}async[a105_0x127d95(0x16b)](_0x2591d3){const _0x26c2d2=a105_0x127d95;try{this[_0x26c2d2(0x13b)]=_0x2591d3,this[_0x26c2d2(0x181)]=typedi_1['Container'][_0x26c2d2(0x15c)](providers_tokens_1[_0x26c2d2(0x179)]['gitApiService']),this[_0x26c2d2(0x14d)]=typedi_1[_0x26c2d2(0x141)][_0x26c2d2(0x15c)](providers_tokens_1[_0x26c2d2(0x179)]['gitRepoService']),this[_0x26c2d2(0x185)]=typedi_1['Container'][_0x26c2d2(0x15c)](providers_tokens_1[_0x26c2d2(0x179)]['config']),await this['fetchRepositoryData'](),this[_0x26c2d2(0x158)]=await this['repoService']['getOne'](this[_0x26c2d2(0x14b)][_0x26c2d2(0x143)]),this[_0x26c2d2(0x164)]=await this[_0x26c2d2(0x158)][_0x26c2d2(0x177)][_0x26c2d2(0x160)](this['repositoryData'][_0x26c2d2(0x172)]),this['sfLogger']=typedi_1[_0x26c2d2(0x141)][_0x26c2d2(0x15c)](providers_tokens_1[_0x26c2d2(0x179)][_0x26c2d2(0x135)]),this[_0x26c2d2(0x16a)]='[FLOSUM\x20->\x20GIT]\x20['+this[_0x26c2d2(0x185)][_0x26c2d2(0x18a)][_0x26c2d2(0x150)]()+']\x20[Repository:\x20'+this['repositoryData'][_0x26c2d2(0x143)]+_0x26c2d2(0x182)+this['repositoryData'][_0x26c2d2(0x172)]+_0x26c2d2(0x142)+FlosumCommitJob_1[_0x26c2d2(0x14c)]+']';if(!this[_0x26c2d2(0x14b)])throw new bad_request_error_1[(_0x26c2d2(0x168))](errors_1[_0x26c2d2(0x147)]);await this[_0x26c2d2(0x15f)][_0x26c2d2(0x184)](this[_0x26c2d2(0x16a)]+_0x26c2d2(0x15b))['send'](),await this[_0x26c2d2(0x148)]()[_0x26c2d2(0x157)](_0x123276=>this[_0x26c2d2(0x131)](_0x123276));}catch(_0x23c42b){this['commitData']=undefined,this[_0x26c2d2(0x135)]['error'](_0x23c42b);throw _0x23c42b;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x127d95(0x16e)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a105_0x127d95(0x18b)],commit_components_job_1[a105_0x127d95(0x137)],salesforce_sync_service_1[a105_0x127d95(0x16f)]])],FlosumCommitJob),exports[a105_0x127d95(0x12d)]=FlosumCommitJob;