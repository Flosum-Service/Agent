const a105_0x1d583f=a105_0x17ba;(function(_0x3d4f49,_0x2e2381){const _0x429e05=a105_0x17ba,_0x2f5fe9=_0x3d4f49();while(!![]){try{const _0x212ca9=-parseInt(_0x429e05(0x137))/0x1+-parseInt(_0x429e05(0xd5))/0x2+-parseInt(_0x429e05(0xdc))/0x3*(-parseInt(_0x429e05(0xe4))/0x4)+-parseInt(_0x429e05(0x136))/0x5+parseInt(_0x429e05(0x103))/0x6*(parseInt(_0x429e05(0xea))/0x7)+-parseInt(_0x429e05(0xf0))/0x8+parseInt(_0x429e05(0xe7))/0x9;if(_0x212ca9===_0x2e2381)break;else _0x2f5fe9['push'](_0x2f5fe9['shift']());}catch(_0x5a231c){_0x2f5fe9['push'](_0x2f5fe9['shift']());}}}(a105_0x285d,0x23a31));const a105_0x40893e=(function(){let _0x4a92a9=!![];return function(_0x15a159,_0x5def06){const _0x4f1fb2=_0x4a92a9?function(){const _0x4b8fb3=a105_0x17ba;if(_0x5def06){const _0x4c1f3e=_0x5def06[_0x4b8fb3(0x13a)](_0x15a159,arguments);return _0x5def06=null,_0x4c1f3e;}}:function(){};return _0x4a92a9=![],_0x4f1fb2;};}()),a105_0x2599b7=a105_0x40893e(this,function(){const _0x4c3573=a105_0x17ba;return a105_0x2599b7['toString']()[_0x4c3573(0xe9)](_0x4c3573(0x121))[_0x4c3573(0xed)]()[_0x4c3573(0xf6)](a105_0x2599b7)[_0x4c3573(0xe9)](_0x4c3573(0x121));});a105_0x2599b7();'use strict';var __decorate=this&&this[a105_0x1d583f(0x114)]||function(_0x209950,_0x3f3704,_0x33760f,_0x586637){const _0x4c97bd=a105_0x1d583f;var _0x2614a9=arguments['length'],_0x45b967=_0x2614a9<0x3?_0x3f3704:_0x586637===null?_0x586637=Object[_0x4c97bd(0xda)](_0x3f3704,_0x33760f):_0x586637,_0x3eb70a;if(typeof Reflect===_0x4c97bd(0x10f)&&typeof Reflect[_0x4c97bd(0xfc)]===_0x4c97bd(0xee))_0x45b967=Reflect['decorate'](_0x209950,_0x3f3704,_0x33760f,_0x586637);else{for(var _0x5ca2e2=_0x209950[_0x4c97bd(0x138)]-0x1;_0x5ca2e2>=0x0;_0x5ca2e2--)if(_0x3eb70a=_0x209950[_0x5ca2e2])_0x45b967=(_0x2614a9<0x3?_0x3eb70a(_0x45b967):_0x2614a9>0x3?_0x3eb70a(_0x3f3704,_0x33760f,_0x45b967):_0x3eb70a(_0x3f3704,_0x33760f))||_0x45b967;}return _0x2614a9>0x3&&_0x45b967&&Object['defineProperty'](_0x3f3704,_0x33760f,_0x45b967),_0x45b967;},__metadata=this&&this[a105_0x1d583f(0x110)]||function(_0x200c01,_0x18a327){const _0xeb0da1=a105_0x1d583f;if(typeof Reflect===_0xeb0da1(0x10f)&&typeof Reflect['metadata']===_0xeb0da1(0xee))return Reflect[_0xeb0da1(0x109)](_0x200c01,_0x18a327);},__importDefault=this&&this[a105_0x1d583f(0x125)]||function(_0x1b71dc){return _0x1b71dc&&_0x1b71dc['__esModule']?_0x1b71dc:{'default':_0x1b71dc};},FlosumCommitJob_1;function a105_0x17ba(_0x2ae35f,_0x1298b9){const _0x4c1145=a105_0x285d();return a105_0x17ba=function(_0x2599b7,_0x40893e){_0x2599b7=_0x2599b7-0xd3;let _0x285d47=_0x4c1145[_0x2599b7];return _0x285d47;},a105_0x17ba(_0x2ae35f,_0x1298b9);}Object[a105_0x1d583f(0x116)](exports,a105_0x1d583f(0xe0),{'value':!![]}),exports[a105_0x1d583f(0x117)]=void 0x0;const core_1=require(a105_0x1d583f(0xd8)),salesforce_service_1=require(a105_0x1d583f(0xfe)),typedi_1=require(a105_0x1d583f(0x12c)),errors_1=require(a105_0x1d583f(0x108)),bad_request_error_1=require(a105_0x1d583f(0xd3)),salesforce_retriever_service_1=require(a105_0x1d583f(0x12e)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a105_0x1d583f(0xf2)),constants_1=require(a105_0x1d583f(0x101)),shortid_1=__importDefault(require(a105_0x1d583f(0xdb))),providers_tokens_1=require('../../providers/providers.tokens');function a105_0x285d(){const _0x268c01=['object','__metadata','setStatus','get',']\x20[Repository:\x20','__decorate','provider','defineProperty','FlosumCommitJob','sfLogger','FLOSUM_ATTACHMENT','ERR_UNKNOWN_SYNC_RECORD_ID','commitData','syncRepositoryId','getOne','salesforceService','ERR_INVALID_SYNC_RECORD_ID','logger','(((.+)+)+)+$','error','sha','config','__importDefault','fetchRepositoryData','deleteAttachment','updateLastCommit','[FLOSUM\x20->\x20GIT]\x20[','commitAttachmentId','Container','typedi','Error','../../salesforce/services/salesforce-retriever.service','updateRemoteState','getBranchRecord','getComponentsToDelete','gitApiService','gitRepoService','Tokens','repository','538745HNcqKR','220362pxpiNa','length','repositoryName','apply','../../../../core/errors/bad-request.error','In\x20Progress','516388ChuUhF','getRepositoryRecord','then','../../../../core','convertToSFDX','getOwnPropertyDescriptor','shortid','175452TFywml','commitJob','user','patchObject','__esModule','components','catch','Completed','4SNuwAH','prefix','deleteAttachmentId','5956560deFQFq','trim','search','966yDYFEq','branches','handleCommitJobError','toString','function','Service','641872UDSiIh','getCommitDto','./commit-components.job','repositoryData','Logger',']\x20[','constructor','gitProvider','send','branchName','retrieveAttachment','BadRequestError','decorate','run','../../salesforce/services/salesforce.service','getComponentsToWrite','message','../../../../constants','design:paramtypes','4008DjKuWp','repo','map','name','exec','../../../../constants/errors','metadata','salesforceSync','all','branch','SalesforceSyncService','syncBranchId'];a105_0x285d=function(){return _0x268c01;};return a105_0x285d();}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x25797a,_0x5cc5fb,_0x456ca3){const _0x2f90cc=a105_0x1d583f;this[_0x2f90cc(0x11e)]=_0x25797a,this[_0x2f90cc(0xdd)]=_0x5cc5fb,this['salesforceSync']=_0x456ca3,this[_0x2f90cc(0x120)]=new core_1[(_0x2f90cc(0xf4))](FlosumCommitJob_1['name']);}async[a105_0x1d583f(0x126)](){const _0x5c3066=a105_0x1d583f;try{if(this[_0x5c3066(0x11b)][_0x5c3066(0x11c)])this[_0x5c3066(0xf3)]=await this[_0x5c3066(0x10a)][_0x5c3066(0xd6)](this[_0x5c3066(0x11b)]['syncRepositoryId']);else this[_0x5c3066(0x11b)][_0x5c3066(0x10e)]&&(this[_0x5c3066(0xf3)]=await this[_0x5c3066(0x10a)][_0x5c3066(0x130)](this[_0x5c3066(0x11b)][_0x5c3066(0x10e)]));}catch(_0x832e3a){throw new bad_request_error_1[(_0x5c3066(0xfb))](errors_1[_0x5c3066(0x11f)]);}}async['getComponentsToWrite'](){const _0x1f762d=a105_0x1d583f;if(!this[_0x1f762d(0x11b)]['commitAttachmentId'])return[];await this[_0x1f762d(0x11e)][_0x1f762d(0xdf)](constants_1[_0x1f762d(0x119)],this[_0x1f762d(0x11b)][_0x1f762d(0x12a)],{'Name':(0x0,shortid_1['default'])()});const _0x3920d9=await this[_0x1f762d(0x11e)][_0x1f762d(0xfa)](this[_0x1f762d(0x11b)]['commitAttachmentId'])[_0x1f762d(0xd7)](_0x1fa77a=>_0x1fa77a['split']('\x20')[_0x1f762d(0x105)](_0x15ab67=>_0x15ab67[_0x1f762d(0xe8)]()));await this[_0x1f762d(0x11e)][_0x1f762d(0x127)](this[_0x1f762d(0x11b)]['commitAttachmentId']);const _0x21ba2a=new salesforce_retriever_service_1['SalesforceRetrieverService'](this['salesforceService']);return await _0x21ba2a[_0x1f762d(0xfd)](_0x3920d9);}async[a105_0x1d583f(0x131)](){const _0x7a38b8=a105_0x1d583f;if(!this['commitData'][_0x7a38b8(0xe6)])return[];await this[_0x7a38b8(0x11e)][_0x7a38b8(0xdf)](constants_1[_0x7a38b8(0x119)],this['commitData'][_0x7a38b8(0xe6)],{'Name':(0x0,shortid_1['default'])()});const _0x29b305=await this[_0x7a38b8(0x11e)][_0x7a38b8(0xfa)](this[_0x7a38b8(0x11b)][_0x7a38b8(0xe6)]);return await this[_0x7a38b8(0x11e)]['deleteAttachment'](this[_0x7a38b8(0x11b)][_0x7a38b8(0xe6)]),_0x29b305;}async['getCommitDto'](){const _0x33a23e=a105_0x1d583f,_0x3aceb9=new commit_components_dto_1['CommitComponentsDto'](),[_0x362604,_0x427f16]=await Promise[_0x33a23e(0x10b)]([this[_0x33a23e(0xff)](),this['getComponentsToDelete']()]);return _0x3aceb9[_0x33a23e(0x100)]=this[_0x33a23e(0x11b)]['message'],_0x3aceb9[_0x33a23e(0xde)]=this[_0x33a23e(0x11b)]['user'],_0x3aceb9[_0x33a23e(0xe1)]={'writed':_0x362604,'deleted':_0x427f16},_0x3aceb9[_0x33a23e(0xd9)]=this[_0x33a23e(0x124)]['isConvertToSfdx'],_0x3aceb9[_0x33a23e(0x104)]=this[_0x33a23e(0x135)],_0x3aceb9[_0x33a23e(0x10c)]=this[_0x33a23e(0x10c)],_0x3aceb9[_0x33a23e(0x115)]=this[_0x33a23e(0x124)]['gitProvider'],_0x3aceb9;}async[a105_0x1d583f(0x128)](_0x58c914=![]){const _0xc45d0a=a105_0x1d583f;if(_0x58c914)await this[_0xc45d0a(0x10a)]['updateRemoteState'](this[_0xc45d0a(0xf3)],{});else{const _0x4a4542=await this['repository'][_0xc45d0a(0xeb)]['getOne'](this[_0xc45d0a(0x10c)][_0xc45d0a(0x106)]);this[_0xc45d0a(0x118)]['log'](this[_0xc45d0a(0xe5)]+'\x20Update\x20remote\x20state.');const _0x425e25={[this[_0xc45d0a(0x135)]['gitUrl']]:{'lastCommit':_0x4a4542[_0xc45d0a(0x123)]}};await this[_0xc45d0a(0x10a)][_0xc45d0a(0x12f)](this[_0xc45d0a(0xf3)],_0x425e25);}}async['exec'](){const _0x18d74c=a105_0x1d583f,_0xbfcd85=await this[_0x18d74c(0xf1)]();await this[_0x18d74c(0x10a)][_0x18d74c(0x111)](this[_0x18d74c(0xf3)],_0x18d74c(0xd4)),await this[_0x18d74c(0xdd)][_0x18d74c(0xfd)](_0xbfcd85,this[_0x18d74c(0xe5)]),await this[_0x18d74c(0x128)](),await this[_0x18d74c(0x10a)]['setStatus'](this[_0x18d74c(0xf3)],_0x18d74c(0xe3));}async[a105_0x1d583f(0xec)](_0x39e054){const _0xcaa294=a105_0x1d583f;try{this[_0xcaa294(0x118)][_0xcaa294(0x122)](''+_0x39e054),await this[_0xcaa294(0x118)][_0xcaa294(0xf8)](),await this[_0xcaa294(0x128)](!![]),await this[_0xcaa294(0x10a)][_0xcaa294(0x111)](this[_0xcaa294(0xf3)],_0xcaa294(0x12d));}catch(_0x31d3c4){this[_0xcaa294(0x120)][_0xcaa294(0x122)](_0x31d3c4);}}async['run'](_0x25a15e){const _0x57008e=a105_0x1d583f;try{this[_0x57008e(0x11b)]=_0x25a15e,this['gitApiService']=typedi_1['Container'][_0x57008e(0x112)](providers_tokens_1[_0x57008e(0x134)][_0x57008e(0x132)]),this['repoService']=typedi_1['Container'][_0x57008e(0x112)](providers_tokens_1[_0x57008e(0x134)][_0x57008e(0x133)]),this[_0x57008e(0x124)]=typedi_1[_0x57008e(0x12b)][_0x57008e(0x112)](providers_tokens_1[_0x57008e(0x134)][_0x57008e(0x124)]),await this[_0x57008e(0x126)](),this[_0x57008e(0x135)]=await this['repoService'][_0x57008e(0x11d)](this[_0x57008e(0xf3)][_0x57008e(0x139)]),this[_0x57008e(0x10c)]=await this[_0x57008e(0x135)]['branches']['getOne'](this[_0x57008e(0xf3)]['branchName']),this[_0x57008e(0x118)]=typedi_1['Container']['get'](providers_tokens_1[_0x57008e(0x134)][_0x57008e(0x120)]),this['prefix']=_0x57008e(0x129)+this[_0x57008e(0x124)][_0x57008e(0xf7)]['toUpperCase']()+_0x57008e(0x113)+this[_0x57008e(0xf3)][_0x57008e(0x139)]+']\x20[Branch:\x20'+this[_0x57008e(0xf3)][_0x57008e(0xf9)]+_0x57008e(0xf5)+FlosumCommitJob_1[_0x57008e(0x106)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x57008e(0xfb))](errors_1[_0x57008e(0x11a)]);await this[_0x57008e(0x118)]['log'](this['prefix']+'\x20Start\x20Flosum\x20commit\x20job.')[_0x57008e(0xf8)](),await this[_0x57008e(0x107)]()[_0x57008e(0xe2)](_0x5de88e=>this['handleCommitJobError'](_0x5de88e));}catch(_0x43fc1b){this[_0x57008e(0x11b)]=undefined,this['logger'][_0x57008e(0x122)](_0x43fc1b);throw _0x43fc1b;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x1d583f(0xef)])({'transient':!![]}),__metadata(a105_0x1d583f(0x102),[salesforce_service_1['SalesforceService'],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a105_0x1d583f(0x10d)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;