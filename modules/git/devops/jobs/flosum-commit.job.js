const a106_0x28898d=a106_0x3b81;(function(_0x12214c,_0x41f158){const _0x4d36d5=a106_0x3b81,_0x501817=_0x12214c();while(!![]){try{const _0x33af65=parseInt(_0x4d36d5(0x152))/0x1*(-parseInt(_0x4d36d5(0x194))/0x2)+parseInt(_0x4d36d5(0x1a5))/0x3*(parseInt(_0x4d36d5(0x186))/0x4)+parseInt(_0x4d36d5(0x15a))/0x5*(parseInt(_0x4d36d5(0x1b0))/0x6)+-parseInt(_0x4d36d5(0x185))/0x7*(-parseInt(_0x4d36d5(0x1b1))/0x8)+-parseInt(_0x4d36d5(0x1b3))/0x9*(parseInt(_0x4d36d5(0x1b9))/0xa)+parseInt(_0x4d36d5(0x17f))/0xb*(-parseInt(_0x4d36d5(0x1a2))/0xc)+parseInt(_0x4d36d5(0x15d))/0xd;if(_0x33af65===_0x41f158)break;else _0x501817['push'](_0x501817['shift']());}catch(_0x303d5f){_0x501817['push'](_0x501817['shift']());}}}(a106_0x14dc,0x76f56));const a106_0x333143=(function(){let _0x4cc57e=!![];return function(_0x5a4812,_0x1d887c){const _0x2008e1=_0x4cc57e?function(){const _0x49a2b1=a106_0x3b81;if(_0x1d887c){const _0xa5fe5a=_0x1d887c[_0x49a2b1(0x16a)](_0x5a4812,arguments);return _0x1d887c=null,_0xa5fe5a;}}:function(){};return _0x4cc57e=![],_0x2008e1;};}()),a106_0x41689d=a106_0x333143(this,function(){const _0x39a4f9=a106_0x3b81;return a106_0x41689d[_0x39a4f9(0x162)]()[_0x39a4f9(0x193)](_0x39a4f9(0x16e))['toString']()[_0x39a4f9(0x168)](a106_0x41689d)[_0x39a4f9(0x193)](_0x39a4f9(0x16e));});a106_0x41689d();'use strict';var __decorate=this&&this[a106_0x28898d(0x18a)]||function(_0x2c9b99,_0x301111,_0x3c5f85,_0x23ee42){const _0x264df4=a106_0x28898d;var _0x23c728=arguments['length'],_0x1ccd1d=_0x23c728<0x3?_0x301111:_0x23ee42===null?_0x23ee42=Object['getOwnPropertyDescriptor'](_0x301111,_0x3c5f85):_0x23ee42,_0x3c6756;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x264df4(0x1ac))_0x1ccd1d=Reflect[_0x264df4(0x19a)](_0x2c9b99,_0x301111,_0x3c5f85,_0x23ee42);else{for(var _0x21da17=_0x2c9b99[_0x264df4(0x15c)]-0x1;_0x21da17>=0x0;_0x21da17--)if(_0x3c6756=_0x2c9b99[_0x21da17])_0x1ccd1d=(_0x23c728<0x3?_0x3c6756(_0x1ccd1d):_0x23c728>0x3?_0x3c6756(_0x301111,_0x3c5f85,_0x1ccd1d):_0x3c6756(_0x301111,_0x3c5f85))||_0x1ccd1d;}return _0x23c728>0x3&&_0x1ccd1d&&Object[_0x264df4(0x172)](_0x301111,_0x3c5f85,_0x1ccd1d),_0x1ccd1d;},__metadata=this&&this[a106_0x28898d(0x1b8)]||function(_0x25a934,_0x362aac){const _0x194778=a106_0x28898d;if(typeof Reflect===_0x194778(0x166)&&typeof Reflect[_0x194778(0x1b2)]===_0x194778(0x1ac))return Reflect[_0x194778(0x1b2)](_0x25a934,_0x362aac);},__importDefault=this&&this[a106_0x28898d(0x199)]||function(_0x484ca6){const _0x24b0f4=a106_0x28898d;return _0x484ca6&&_0x484ca6[_0x24b0f4(0x15f)]?_0x484ca6:{'default':_0x484ca6};},FlosumCommitJob_1;Object[a106_0x28898d(0x172)](exports,a106_0x28898d(0x15f),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a106_0x28898d(0x1b7)),salesforce_service_1=require(a106_0x28898d(0x16c)),typedi_1=require(a106_0x28898d(0x1a7)),errors_1=require(a106_0x28898d(0x195)),bad_request_error_1=require(a106_0x28898d(0x14d)),salesforce_retriever_service_1=require(a106_0x28898d(0x151)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a106_0x28898d(0x1ab)),commit_components_job_1=require(a106_0x28898d(0x1af)),constants_1=require(a106_0x28898d(0x17e)),shortid_1=__importDefault(require('shortid')),providers_tokens_1=require(a106_0x28898d(0x1ba));function a106_0x14dc(){const _0x466264=['object','getCommitDto','constructor','split','apply','repoService','../../salesforce/services/salesforce.service','branch','(((.+)+)+)+$',']\x20[Repository:\x20',']\x20[','log','defineProperty','prefix','isConvertToSfdx','updateRemoteState','recordTypeName','salesforceService','\x20Update\x20remote\x20state.','provider','sfLogger','commitJob','commitData','handleCommitJobError','../../../../constants','11SYFLgC','SalesforceService','BadRequestError','message','design:paramtypes','SalesforceRetrieverService','602DftZqp','16YGoDke','gitRepoService','components','setStatus','__decorate','sha','repositoryData','commitAttachmentId','map','get','catch','getOne','name','search','164986qdCRKz','../../../../constants/errors','trim','deleteAttachmentId','all','__importDefault','decorate',']\x20[Branch:\x20','deleteAttachment','retrieveAttachment','FLOSUM_ATTACHMENT','config','repositoryName','logger','2984352VagjgF','getBranchRecord','gitProvider','566745mjFIlT','user','typedi','fetchRepositoryData','FlosumCommitJob','convertToSFDX','../dto/commit-components.dto','function','repo','getComponentsToWrite','./commit-components.job','30AoRTNe','52552qkflDG','metadata','207216vmQMOc','repository','salesforceSync','branchName','../../../../core','__metadata','340Iehest','../../providers/providers.tokens','error','run','../../../../core/errors/bad-request.error','Service','patchObject','SalesforceSyncService','../../salesforce/services/salesforce-retriever.service','8ZzHJCV','Tokens','getRepositoryRecord','syncRepositoryId','recordType','branches','Completed','gitApiService','348805HRVmpv','Container','length','6621043Wevqms','gitUrl','__esModule','parse','toUpperCase','toString','updateLastCommit','Logger','ERR_UNKNOWN_SYNC_RECORD_ID'];a106_0x14dc=function(){return _0x466264;};return a106_0x14dc();}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x5d9f22,_0x318f8c,_0x565a2c){const _0x3690ae=a106_0x28898d;this[_0x3690ae(0x177)]=_0x5d9f22,this[_0x3690ae(0x17b)]=_0x318f8c,this[_0x3690ae(0x1b5)]=_0x565a2c,this[_0x3690ae(0x1a1)]=new core_1[(_0x3690ae(0x164))](FlosumCommitJob_1[_0x3690ae(0x192)]);}async[a106_0x28898d(0x1a8)](){const _0x27d28f=a106_0x28898d;try{if(this[_0x27d28f(0x17c)][_0x27d28f(0x155)])this[_0x27d28f(0x18c)]=await this[_0x27d28f(0x1b5)][_0x27d28f(0x154)](this['commitData'][_0x27d28f(0x155)]);else this[_0x27d28f(0x17c)]['syncBranchId']&&(this[_0x27d28f(0x18c)]=await this['salesforceSync'][_0x27d28f(0x1a3)](this[_0x27d28f(0x17c)]['syncBranchId']));}catch(_0x42496c){throw new bad_request_error_1[(_0x27d28f(0x181))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a106_0x28898d(0x1ae)](){const _0x799fca=a106_0x28898d;if(!this[_0x799fca(0x17c)][_0x799fca(0x18d)])return[];await this[_0x799fca(0x177)][_0x799fca(0x14f)](constants_1[_0x799fca(0x19e)],this[_0x799fca(0x17c)][_0x799fca(0x18d)],{'Name':(0x0,shortid_1['default'])()});const _0x1b64a1=await this[_0x799fca(0x177)][_0x799fca(0x19d)](this[_0x799fca(0x17c)][_0x799fca(0x18d)])['then'](_0x562688=>_0x562688[_0x799fca(0x169)]('\x20')[_0x799fca(0x18e)](_0x440f5c=>_0x440f5c[_0x799fca(0x196)]()));await this['salesforceService'][_0x799fca(0x19c)](this[_0x799fca(0x17c)][_0x799fca(0x18d)]);const _0x5d59bc=new salesforce_retriever_service_1[(_0x799fca(0x184))](this['salesforceService']);return await _0x5d59bc[_0x799fca(0x1bc)](_0x1b64a1);}async['getComponentsToDelete'](){const _0x281880=a106_0x28898d;if(!this[_0x281880(0x17c)][_0x281880(0x197)])return[];await this['salesforceService'][_0x281880(0x14f)](constants_1[_0x281880(0x19e)],this[_0x281880(0x17c)][_0x281880(0x197)],{'Name':(0x0,shortid_1['default'])()});const _0x10db42=await this[_0x281880(0x177)][_0x281880(0x19d)](this[_0x281880(0x17c)][_0x281880(0x197)]),_0x389ce9=JSON[_0x281880(0x160)](_0x10db42);return await this[_0x281880(0x177)][_0x281880(0x19c)](this[_0x281880(0x17c)][_0x281880(0x197)]),_0x389ce9;}async[a106_0x28898d(0x167)](){const _0x109bee=a106_0x28898d,_0x240b32=new commit_components_dto_1['CommitComponentsDto'](),[_0x52f827,_0x301a38]=await Promise[_0x109bee(0x198)]([this['getComponentsToWrite'](),this['getComponentsToDelete']()]);return _0x240b32[_0x109bee(0x182)]=this[_0x109bee(0x17c)][_0x109bee(0x182)],_0x240b32['user']=this[_0x109bee(0x17c)][_0x109bee(0x1a6)],_0x240b32[_0x109bee(0x188)]={'writed':_0x52f827,'deleted':_0x301a38},_0x240b32[_0x109bee(0x1aa)]=this[_0x109bee(0x19f)][_0x109bee(0x174)],_0x240b32[_0x109bee(0x1ad)]=this[_0x109bee(0x1b4)],_0x240b32[_0x109bee(0x16d)]=this[_0x109bee(0x16d)],_0x240b32[_0x109bee(0x179)]=this[_0x109bee(0x19f)][_0x109bee(0x1a4)],_0x240b32[_0x109bee(0x156)]=this[_0x109bee(0x18c)][_0x109bee(0x176)],_0x240b32;}async[a106_0x28898d(0x163)](_0xed543=![]){const _0x346022=a106_0x28898d;if(_0xed543)await this[_0x346022(0x1b5)][_0x346022(0x175)](this[_0x346022(0x18c)],{});else{const _0x3a8973=await this['repository'][_0x346022(0x157)]['getOne'](this[_0x346022(0x16d)][_0x346022(0x192)]);this['sfLogger'][_0x346022(0x171)](this[_0x346022(0x173)]+_0x346022(0x178));const _0x38c838={[this['repository'][_0x346022(0x15e)]]:{'lastCommit':_0x3a8973[_0x346022(0x18b)]}};await this[_0x346022(0x1b5)][_0x346022(0x175)](this[_0x346022(0x18c)],_0x38c838);}}async['exec'](){const _0x1915b1=a106_0x28898d,_0x597bfd=await this[_0x1915b1(0x167)]();await this[_0x1915b1(0x1b5)][_0x1915b1(0x189)](this[_0x1915b1(0x18c)],'In\x20Progress'),await this[_0x1915b1(0x17b)][_0x1915b1(0x1bc)](_0x597bfd,this[_0x1915b1(0x173)]),await this[_0x1915b1(0x163)](),await this[_0x1915b1(0x1b5)][_0x1915b1(0x189)](this['repositoryData'],_0x1915b1(0x158));}async['handleCommitJobError'](_0x6b1667){const _0xeac7b5=a106_0x28898d;try{this['sfLogger'][_0xeac7b5(0x1bb)](''+_0x6b1667),await this['sfLogger']['send'](),await this[_0xeac7b5(0x163)](!![]),await this['salesforceSync'][_0xeac7b5(0x189)](this['repositoryData'],'Error');}catch(_0x48ad17){this[_0xeac7b5(0x1a1)]['error'](_0x48ad17);}}async['run'](_0x1f1799){const _0x10bad1=a106_0x28898d;try{this['commitData']=_0x1f1799,this[_0x10bad1(0x159)]=typedi_1[_0x10bad1(0x15b)][_0x10bad1(0x18f)](providers_tokens_1[_0x10bad1(0x153)]['gitApiService']),this['repoService']=typedi_1[_0x10bad1(0x15b)][_0x10bad1(0x18f)](providers_tokens_1[_0x10bad1(0x153)][_0x10bad1(0x187)]),this[_0x10bad1(0x19f)]=typedi_1[_0x10bad1(0x15b)][_0x10bad1(0x18f)](providers_tokens_1[_0x10bad1(0x153)][_0x10bad1(0x19f)]),await this[_0x10bad1(0x1a8)](),this['repository']=await this[_0x10bad1(0x16b)][_0x10bad1(0x191)](this['repositoryData'][_0x10bad1(0x1a0)]),this[_0x10bad1(0x16d)]=await this['repository'][_0x10bad1(0x157)]['getOne'](this[_0x10bad1(0x18c)][_0x10bad1(0x1b6)]),this[_0x10bad1(0x17a)]=typedi_1[_0x10bad1(0x15b)][_0x10bad1(0x18f)](providers_tokens_1['Tokens'][_0x10bad1(0x1a1)]),this[_0x10bad1(0x173)]='[FLOSUM\x20->\x20GIT]\x20['+this[_0x10bad1(0x19f)]['gitProvider'][_0x10bad1(0x161)]()+_0x10bad1(0x16f)+this[_0x10bad1(0x18c)]['repositoryName']+_0x10bad1(0x19b)+this[_0x10bad1(0x18c)][_0x10bad1(0x1b6)]+_0x10bad1(0x170)+FlosumCommitJob_1[_0x10bad1(0x192)]+']';if(!this[_0x10bad1(0x18c)])throw new bad_request_error_1['BadRequestError'](errors_1[_0x10bad1(0x165)]);await this[_0x10bad1(0x17a)]['log'](this['prefix']+'\x20Start\x20Flosum\x20commit\x20job.')['send'](),await this['exec']()[_0x10bad1(0x190)](_0xf8ec23=>this[_0x10bad1(0x17d)](_0xf8ec23));}catch(_0x1e3519){this[_0x10bad1(0x17c)]=undefined,this[_0x10bad1(0x1a1)][_0x10bad1(0x1bb)](_0x1e3519);throw _0x1e3519;}}};function a106_0x3b81(_0x25884b,_0xc8aa45){const _0x53e90f=a106_0x14dc();return a106_0x3b81=function(_0x41689d,_0x333143){_0x41689d=_0x41689d-0x14d;let _0x14dcbe=_0x53e90f[_0x41689d];return _0x14dcbe;},a106_0x3b81(_0x25884b,_0xc8aa45);}FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a106_0x28898d(0x14e)])({'transient':!![]}),__metadata(a106_0x28898d(0x183),[salesforce_service_1[a106_0x28898d(0x180)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a106_0x28898d(0x150)]])],FlosumCommitJob),exports[a106_0x28898d(0x1a9)]=FlosumCommitJob;