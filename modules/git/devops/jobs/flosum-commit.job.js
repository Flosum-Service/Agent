const a126_0x50797=a126_0x55c5;(function(_0x3bbf63,_0xff6e89){const _0x51e8fe=a126_0x55c5,_0xa1735=_0x3bbf63();while(!![]){try{const _0x2f814c=-parseInt(_0x51e8fe(0x121))/0x1*(parseInt(_0x51e8fe(0xbf))/0x2)+-parseInt(_0x51e8fe(0xb7))/0x3+parseInt(_0x51e8fe(0xfe))/0x4+-parseInt(_0x51e8fe(0xdd))/0x5*(parseInt(_0x51e8fe(0x128))/0x6)+-parseInt(_0x51e8fe(0x126))/0x7+-parseInt(_0x51e8fe(0x11a))/0x8*(-parseInt(_0x51e8fe(0xbd))/0x9)+parseInt(_0x51e8fe(0x100))/0xa;if(_0x2f814c===_0xff6e89)break;else _0xa1735['push'](_0xa1735['shift']());}catch(_0x36c402){_0xa1735['push'](_0xa1735['shift']());}}}(a126_0x2f58,0x9b0cd));function a126_0x55c5(_0x408da2,_0x182320){const _0x1cb679=a126_0x2f58();return a126_0x55c5=function(_0x589b54,_0x50b06e){_0x589b54=_0x589b54-0xb5;let _0x2f58e9=_0x1cb679[_0x589b54];return _0x2f58e9;},a126_0x55c5(_0x408da2,_0x182320);}const a126_0x50b06e=(function(){let _0x488b61=!![];return function(_0x36f411,_0x14db86){const _0x3aeb6d=_0x488b61?function(){const _0x3e7125=a126_0x55c5;if(_0x14db86){const _0x25062c=_0x14db86[_0x3e7125(0xff)](_0x36f411,arguments);return _0x14db86=null,_0x25062c;}}:function(){};return _0x488b61=![],_0x3aeb6d;};}()),a126_0x589b54=a126_0x50b06e(this,function(){const _0x18c31d=a126_0x55c5;return a126_0x589b54['toString']()[_0x18c31d(0xd0)]('(((.+)+)+)+$')[_0x18c31d(0xc6)]()[_0x18c31d(0xf5)](a126_0x589b54)['search'](_0x18c31d(0xc5));});a126_0x589b54();'use strict';var __decorate=this&&this[a126_0x50797(0xbe)]||function(_0x5733c9,_0x20a758,_0x526f5f,_0x6249dc){const _0xfbb81d=a126_0x50797;var _0x55ef16=arguments[_0xfbb81d(0x122)],_0x769a0e=_0x55ef16<0x3?_0x20a758:_0x6249dc===null?_0x6249dc=Object['getOwnPropertyDescriptor'](_0x20a758,_0x526f5f):_0x6249dc,_0x1cb67e;if(typeof Reflect===_0xfbb81d(0xcb)&&typeof Reflect['decorate']==='function')_0x769a0e=Reflect['decorate'](_0x5733c9,_0x20a758,_0x526f5f,_0x6249dc);else{for(var _0x39b44d=_0x5733c9['length']-0x1;_0x39b44d>=0x0;_0x39b44d--)if(_0x1cb67e=_0x5733c9[_0x39b44d])_0x769a0e=(_0x55ef16<0x3?_0x1cb67e(_0x769a0e):_0x55ef16>0x3?_0x1cb67e(_0x20a758,_0x526f5f,_0x769a0e):_0x1cb67e(_0x20a758,_0x526f5f))||_0x769a0e;}return _0x55ef16>0x3&&_0x769a0e&&Object[_0xfbb81d(0xf7)](_0x20a758,_0x526f5f,_0x769a0e),_0x769a0e;},__metadata=this&&this[a126_0x50797(0xc8)]||function(_0x45d459,_0x1ecc26){const _0x2d099a=a126_0x50797;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x2d099a(0x110)](_0x45d459,_0x1ecc26);},__importDefault=this&&this[a126_0x50797(0x116)]||function(_0x26a233){const _0x38c756=a126_0x50797;return _0x26a233&&_0x26a233[_0x38c756(0xe9)]?_0x26a233:{'default':_0x26a233};},FlosumCommitJob_1;Object['defineProperty'](exports,a126_0x50797(0xe9),{'value':!![]}),exports[a126_0x50797(0x105)]=void 0x0;const core_1=require('../../../../core'),salesforce_service_1=require(a126_0x50797(0xe3)),typedi_1=require(a126_0x50797(0xcd)),errors_1=require('../../../../constants/errors'),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a126_0x50797(0xe8)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a126_0x50797(0x127)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a126_0x50797(0x119)),shortid_1=__importDefault(require(a126_0x50797(0x10d))),providers_tokens_1=require(a126_0x50797(0xd5)),commit_to_git_completed_notification_1=require('../../notifications/commit-to-git-completed.notification'),commit_to_git_error_notification_1=require(a126_0x50797(0xfc));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0xa69504,_0x557839,_0x44fe6b){const _0x16f5e4=a126_0x50797;this['salesforceService']=_0xa69504,this[_0x16f5e4(0xc3)]=_0x557839,this[_0x16f5e4(0x123)]=_0x44fe6b,this['logger']=new core_1[(_0x16f5e4(0x11c))](FlosumCommitJob_1['name']);}async['completeNotification'](_0x5686a0,_0x3c2b71,_0x54903d,_0xf1521){const _0xc9e66a=a126_0x50797;if(!this[_0xc9e66a(0xe2)][_0xc9e66a(0xe4)]){this['logger'][_0xc9e66a(0xc7)]('Email\x20notifications\x20are\x20disabled.');return;}await new commit_to_git_completed_notification_1[(_0xc9e66a(0x125))]({'emails':_0x5686a0,'gitProvider':_0x3c2b71,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1[_0xc9e66a(0x125)][_0xc9e66a(0x101)],'repositoryName':_0x54903d,'branchName':_0xf1521})['execute']();}async['errorNotification'](_0x1b935c,_0x360852,_0x40ec54,_0x357b0e){const _0x366c0f=a126_0x50797;if(!this[_0x366c0f(0xe2)]['isEmailNotificationsEnabled']){this[_0x366c0f(0x104)][_0x366c0f(0xc7)](_0x366c0f(0xe1));return;}await new commit_to_git_error_notification_1[(_0x366c0f(0xf0))]({'emails':_0x1b935c,'gitProvider':_0x360852,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0x366c0f(0xf0)][_0x366c0f(0x101)],'repositoryName':_0x40ec54,'branchName':_0x357b0e})[_0x366c0f(0xec)]();}async[a126_0x50797(0xcc)](){const _0x162c03=a126_0x50797;try{if(this['commitData'][_0x162c03(0xd3)])this[_0x162c03(0xba)]=await this[_0x162c03(0x123)][_0x162c03(0xf3)](this[_0x162c03(0xe2)][_0x162c03(0xd3)]);else this[_0x162c03(0xe2)][_0x162c03(0x10e)]&&(this['repositoryData']=await this[_0x162c03(0x123)][_0x162c03(0x111)](this[_0x162c03(0xe2)][_0x162c03(0x10e)]));}catch(_0xee5b4){throw new bad_request_error_1['BadRequestError'](errors_1[_0x162c03(0x106)]);}}async[a126_0x50797(0xc0)](){const _0x2a49f4=a126_0x50797;if(!this['commitData']['commitAttachmentId'])return[];await this[_0x2a49f4(0x10f)][_0x2a49f4(0xfa)](constants_1[_0x2a49f4(0xf6)],this[_0x2a49f4(0xe2)][_0x2a49f4(0x113)],{'Name':(0x0,shortid_1['default'])()});const _0x308dcd=await this[_0x2a49f4(0x10f)][_0x2a49f4(0xd2)](this[_0x2a49f4(0xe2)]['commitAttachmentId'])[_0x2a49f4(0xd6)](_0x1444d3=>_0x1444d3[_0x2a49f4(0x10b)]('\x20')['map'](_0x51c591=>_0x51c591['trim']()));await this['salesforceService'][_0x2a49f4(0xbc)](this[_0x2a49f4(0xe2)]['commitAttachmentId']);const _0x17d5f9=new salesforce_retriever_service_1[(_0x2a49f4(0xfb))](this[_0x2a49f4(0x10f)]);return await _0x17d5f9[_0x2a49f4(0xcf)](_0x308dcd);}async[a126_0x50797(0x103)](){const _0x4d3727=a126_0x50797;if(!this[_0x4d3727(0xe2)][_0x4d3727(0xe6)])return[];await this[_0x4d3727(0x10f)][_0x4d3727(0xfa)](constants_1['FLOSUM_ATTACHMENT'],this['commitData'][_0x4d3727(0xe6)],{'Name':(0x0,shortid_1['default'])()});const _0x2104f7=await this['salesforceService'][_0x4d3727(0xd2)](this['commitData'][_0x4d3727(0xe6)]),_0x122d54=JSON[_0x4d3727(0xc1)](_0x2104f7);return await this[_0x4d3727(0x10f)][_0x4d3727(0xbc)](this[_0x4d3727(0xe2)]['deleteAttachmentId']),_0x122d54;}async[a126_0x50797(0xb5)](){const _0x6e1916=a126_0x50797,_0x5c8f5b=new commit_components_dto_1[(_0x6e1916(0x124))](),[_0x3678da,_0x3a15d3]=await Promise[_0x6e1916(0x109)]([this[_0x6e1916(0xc0)](),this[_0x6e1916(0x103)]()]);return _0x5c8f5b[_0x6e1916(0xf2)]=this[_0x6e1916(0xe2)]['message'],_0x5c8f5b['user']=this['commitData'][_0x6e1916(0xb9)],_0x5c8f5b[_0x6e1916(0xe7)]={'writed':_0x3678da,'deleted':_0x3a15d3},_0x5c8f5b['convertToSFDX']=this['config'][_0x6e1916(0xde)],_0x5c8f5b['repo']=this[_0x6e1916(0xea)],_0x5c8f5b[_0x6e1916(0xee)]=this['branch'],_0x5c8f5b[_0x6e1916(0x108)]=this[_0x6e1916(0xfd)][_0x6e1916(0xb6)],_0x5c8f5b[_0x6e1916(0xda)]=this['repositoryData'][_0x6e1916(0x129)],_0x5c8f5b;}async[a126_0x50797(0xb8)](_0x44e6b4=![]){const _0x1fbdac=a126_0x50797;if(_0x44e6b4)await this['salesforceSync'][_0x1fbdac(0xdf)](this[_0x1fbdac(0xba)],{});else{const _0x32afe7=await this[_0x1fbdac(0xea)]['branches']['getOne'](this[_0x1fbdac(0xee)]['name']);this['sfLogger'][_0x1fbdac(0xd7)](this['prefix']+_0x1fbdac(0x11b));const _0x1117d8={[this[_0x1fbdac(0xea)]['gitUrl']]:{'lastCommit':_0x32afe7[_0x1fbdac(0xf9)]}};await this[_0x1fbdac(0x123)]['updateRemoteState'](this['repositoryData'],_0x1117d8);}}async[a126_0x50797(0xdb)](){const _0x4e0b64=a126_0x50797,_0x1e6b72=await this[_0x4e0b64(0xb5)]();await this[_0x4e0b64(0x123)]['setStatus'](this[_0x4e0b64(0xba)],_0x4e0b64(0xc4)),await this[_0x4e0b64(0xc3)][_0x4e0b64(0xcf)](_0x1e6b72,this[_0x4e0b64(0xeb)]),await this['updateLastCommit'](),await this[_0x4e0b64(0x123)][_0x4e0b64(0xd9)](this[_0x4e0b64(0xba)],_0x4e0b64(0x11e));}async[a126_0x50797(0xf8)](_0xba5f11){const _0x1aaba8=a126_0x50797;try{this[_0x1aaba8(0x120)]['error'](''+_0xba5f11),await this[_0x1aaba8(0x120)][_0x1aaba8(0xf1)](),await this[_0x1aaba8(0xb8)](!![]),await this['salesforceSync']['setStatus'](this[_0x1aaba8(0xba)],'Error'),await this['completeNotification']([this['commitData'][_0x1aaba8(0xb9)][_0x1aaba8(0x117)]],this[_0x1aaba8(0xfd)][_0x1aaba8(0xb6)],this[_0x1aaba8(0xea)][_0x1aaba8(0x101)],this['branch'][_0x1aaba8(0x101)]);}catch(_0x214098){this[_0x1aaba8(0x104)]['error'](_0x214098),await this[_0x1aaba8(0x114)]([this[_0x1aaba8(0xe2)][_0x1aaba8(0xb9)][_0x1aaba8(0x117)]],this['config'][_0x1aaba8(0xb6)],this[_0x1aaba8(0xea)][_0x1aaba8(0x101)],this['branch'][_0x1aaba8(0x101)]);}}async[a126_0x50797(0xcf)](_0x4e5935){const _0x420856=a126_0x50797;try{this['commitData']=_0x4e5935,this['gitApiService']=typedi_1[_0x420856(0x11d)][_0x420856(0xca)](providers_tokens_1[_0x420856(0xc9)][_0x420856(0x112)]),this[_0x420856(0x11f)]=typedi_1['Container'][_0x420856(0xca)](providers_tokens_1['Tokens'][_0x420856(0x115)]),this[_0x420856(0xfd)]=typedi_1[_0x420856(0x11d)][_0x420856(0xca)](providers_tokens_1[_0x420856(0xc9)][_0x420856(0xfd)]),await this[_0x420856(0xcc)](),this[_0x420856(0xea)]=await this[_0x420856(0x11f)]['getOne'](this[_0x420856(0xba)]['repositoryName']),this['branch']=await this['repository'][_0x420856(0xce)]['getOne'](this[_0x420856(0xba)][_0x420856(0x118)]),this['sfLogger']=typedi_1[_0x420856(0x11d)][_0x420856(0xca)](providers_tokens_1[_0x420856(0xc9)][_0x420856(0x104)]),this[_0x420856(0xeb)]=_0x420856(0xd8)+this['config'][_0x420856(0xb6)][_0x420856(0xef)]()+_0x420856(0xd4)+this['repositoryData']['repositoryName']+_0x420856(0xf4)+this[_0x420856(0xba)][_0x420856(0x118)]+_0x420856(0x107)+FlosumCommitJob_1['name']+']';if(!this[_0x420856(0xba)])throw new bad_request_error_1[(_0x420856(0xe5))](errors_1[_0x420856(0xdc)]);await this[_0x420856(0x120)][_0x420856(0xd7)](this['prefix']+_0x420856(0xd1))[_0x420856(0xf1)](),await this[_0x420856(0xdb)]()[_0x420856(0x102)](_0x385030=>this[_0x420856(0xf8)](_0x385030)),await this[_0x420856(0xc2)]([this[_0x420856(0xe2)][_0x420856(0xb9)][_0x420856(0x117)]],this[_0x420856(0xfd)][_0x420856(0xb6)],this[_0x420856(0xea)][_0x420856(0x101)],this['branch'][_0x420856(0x101)]);}catch(_0xb5113b){this[_0x420856(0xe2)]=undefined,this[_0x420856(0x104)][_0x420856(0x10c)](_0xb5113b),await this[_0x420856(0x114)]([this[_0x420856(0xe2)]['user'][_0x420856(0x117)]],this[_0x420856(0xfd)][_0x420856(0xb6)],this[_0x420856(0xea)]['name'],this['branch'][_0x420856(0x101)]);throw _0xb5113b;}}};function a126_0x2f58(){const _0x171f9e=['parse','completeNotification','commitJob','In\x20Progress','(((.+)+)+)+$','toString','info','__metadata','Tokens','get','object','fetchRepositoryData','typedi','branches','run','search','\x20Start\x20Flosum\x20commit\x20job.','retrieveAttachment','syncRepositoryId',']\x20[Repository:\x20','../../providers/providers.tokens','then','log','[FLOSUM\x20->\x20GIT]\x20[','setStatus','recordType','exec','ERR_UNKNOWN_SYNC_RECORD_ID','15NXRPti','isConvertToSfdx','updateRemoteState','SalesforceSyncService','Email\x20notifications\x20are\x20disabled.','commitData','../../salesforce/services/salesforce.service','isEmailNotificationsEnabled','BadRequestError','deleteAttachmentId','components','../../salesforce/services/salesforce-retriever.service','__esModule','repository','prefix','execute','CommitComponentsJob','branch','toUpperCase','CommitToGitErrorNotification','send','message','getRepositoryRecord',']\x20[Branch:\x20','constructor','FLOSUM_ATTACHMENT','defineProperty','handleCommitJobError','sha','patchObject','SalesforceRetrieverService','../../notifications/commit-to-git-error.notification','config','3318356kPTYgk','apply','19937690VDfieZ','name','catch','getComponentsToDelete','logger','FlosumCommitJob','ERR_INVALID_SYNC_RECORD_ID',']\x20[','provider','all','design:paramtypes','split','error','shortid','syncBranchId','salesforceService','metadata','getBranchRecord','gitApiService','commitAttachmentId','errorNotification','gitRepoService','__importDefault','email','branchName','../../../../constants','48CJNxpy','\x20Update\x20remote\x20state.','Logger','Container','Completed','repoService','sfLogger','576xGXyfR','length','salesforceSync','CommitComponentsDto','CommitToGitCompletedNotification','6595358FlQGsy','../dto/commit-components.dto','2533098qntZml','recordTypeName','getCommitDto','gitProvider','2718312sfcNnV','updateLastCommit','user','repositoryData','SalesforceService','deleteAttachment','1653381lMHVxi','__decorate','610UmXZNU','getComponentsToWrite'];a126_0x2f58=function(){return _0x171f9e;};return a126_0x2f58();}FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a126_0x50797(0x10a),[salesforce_service_1[a126_0x50797(0xbb)],commit_components_job_1[a126_0x50797(0xed)],salesforce_sync_service_1[a126_0x50797(0xe0)]])],FlosumCommitJob),exports[a126_0x50797(0x105)]=FlosumCommitJob;