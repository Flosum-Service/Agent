const a105_0x15db9f=a105_0x1b70;function a105_0x25a0(){const _0x539b0f=['CommitComponentsJob','Logger','defineProperty','gitProvider','prefix','__esModule','BadRequestError','decorate','patchObject','FlosumCommitJob','catch','4073783uQQUwV','components','repo','function','2BVvKGP','338982JDBWMC','../dto/commit-components.dto','config','updateLastCommit','gitRepoService','getComponentsToWrite','apply','../../salesforce/services/salesforce.service','design:paramtypes','(((.+)+)+)+$','user','retrieveAttachment','SalesforceService','sha','__decorate','metadata','Service','object','2625640yqCyaM','split','setStatus','In\x20Progress','log','Container','commitAttachmentId','../../providers/providers.tokens','send','SalesforceRetrieverService','commitJob','length','branch','\x20Update\x20remote\x20state.','gitApiService','getBranchRecord','salesforceSync','363798KVtCJQ','map','getComponentsToDelete','branchName','FLOSUM_ATTACHMENT','ERR_INVALID_SYNC_RECORD_ID','SalesforceSyncService',']\x20[Branch:\x20','repositoryData',']\x20[Repository:\x20','logger','5218280JCtpre','2086809sKuolr','updateRemoteState','__importDefault','getCommitDto','Error','../../../../core/errors/bad-request.error','handleCommitJobError','salesforceService','branches','Tokens','2629130JXMxZy','repository','toString','sfLogger','syncRepositoryId','deleteAttachmentId','name','repoService','search','../../salesforce/services/salesforce-sync.service','570RQsrcL','getOne','6PvLYHx','gitUrl','CommitComponentsDto','deleteAttachment','convertToSFDX','exec','syncBranchId','default','error','./commit-components.job','\x20Start\x20Flosum\x20commit\x20job.','ERR_UNKNOWN_SYNC_RECORD_ID','message','commitData','get','constructor','../../../../constants/errors','../../../../core','repositoryName'];a105_0x25a0=function(){return _0x539b0f;};return a105_0x25a0();}(function(_0x40ae6d,_0x453514){const _0x33c133=a105_0x1b70,_0x4ec68d=_0x40ae6d();while(!![]){try{const _0x2abeac=parseInt(_0x33c133(0x180))/0x1+parseInt(_0x33c133(0x17f))/0x2*(-parseInt(_0x33c133(0x1af))/0x3)+-parseInt(_0x33c133(0x192))/0x4+parseInt(_0x33c133(0x1b9))/0x5+-parseInt(_0x33c133(0x1c5))/0x6*(parseInt(_0x33c133(0x17b))/0x7)+-parseInt(_0x33c133(0x1ae))/0x8+parseInt(_0x33c133(0x1a3))/0x9*(parseInt(_0x33c133(0x1c3))/0xa);if(_0x2abeac===_0x453514)break;else _0x4ec68d['push'](_0x4ec68d['shift']());}catch(_0x2836ee){_0x4ec68d['push'](_0x4ec68d['shift']());}}}(a105_0x25a0,0x8e3c3));const a105_0x3391fc=(function(){let _0x5f3a3f=!![];return function(_0x30c33f,_0x2ebcc8){const _0x5613db=_0x5f3a3f?function(){const _0x3a1aad=a105_0x1b70;if(_0x2ebcc8){const _0x151d19=_0x2ebcc8[_0x3a1aad(0x186)](_0x30c33f,arguments);return _0x2ebcc8=null,_0x151d19;}}:function(){};return _0x5f3a3f=![],_0x5613db;};}()),a105_0xcc99c3=a105_0x3391fc(this,function(){const _0x171c4b=a105_0x1b70;return a105_0xcc99c3['toString']()[_0x171c4b(0x1c1)](_0x171c4b(0x189))[_0x171c4b(0x1bb)]()[_0x171c4b(0x16c)](a105_0xcc99c3)[_0x171c4b(0x1c1)]('(((.+)+)+)+$');});a105_0xcc99c3();'use strict';var __decorate=this&&this[a105_0x15db9f(0x18e)]||function(_0x130e6c,_0x294e7b,_0x942a,_0x1f5355){const _0x4df799=a105_0x15db9f;var _0x519048=arguments[_0x4df799(0x19d)],_0x505f7f=_0x519048<0x3?_0x294e7b:_0x1f5355===null?_0x1f5355=Object['getOwnPropertyDescriptor'](_0x294e7b,_0x942a):_0x1f5355,_0x2b2530;if(typeof Reflect==='object'&&typeof Reflect[_0x4df799(0x177)]==='function')_0x505f7f=Reflect['decorate'](_0x130e6c,_0x294e7b,_0x942a,_0x1f5355);else{for(var _0x8678f7=_0x130e6c[_0x4df799(0x19d)]-0x1;_0x8678f7>=0x0;_0x8678f7--)if(_0x2b2530=_0x130e6c[_0x8678f7])_0x505f7f=(_0x519048<0x3?_0x2b2530(_0x505f7f):_0x519048>0x3?_0x2b2530(_0x294e7b,_0x942a,_0x505f7f):_0x2b2530(_0x294e7b,_0x942a))||_0x505f7f;}return _0x519048>0x3&&_0x505f7f&&Object[_0x4df799(0x172)](_0x294e7b,_0x942a,_0x505f7f),_0x505f7f;},__metadata=this&&this['__metadata']||function(_0x5793e3,_0x362870){const _0xa56030=a105_0x15db9f;if(typeof Reflect===_0xa56030(0x191)&&typeof Reflect[_0xa56030(0x18f)]===_0xa56030(0x17e))return Reflect['metadata'](_0x5793e3,_0x362870);},__importDefault=this&&this[a105_0x15db9f(0x1b1)]||function(_0x5d7fdf){const _0x35a306=a105_0x15db9f;return _0x5d7fdf&&_0x5d7fdf[_0x35a306(0x175)]?_0x5d7fdf:{'default':_0x5d7fdf};},FlosumCommitJob_1;function a105_0x1b70(_0x45843d,_0x5e9f46){const _0xd269e0=a105_0x25a0();return a105_0x1b70=function(_0xcc99c3,_0x3391fc){_0xcc99c3=_0xcc99c3-0x162;let _0x25a0ca=_0xd269e0[_0xcc99c3];return _0x25a0ca;},a105_0x1b70(_0x45843d,_0x5e9f46);}Object[a105_0x15db9f(0x172)](exports,a105_0x15db9f(0x175),{'value':!![]}),exports[a105_0x15db9f(0x179)]=void 0x0;const core_1=require(a105_0x15db9f(0x16e)),salesforce_service_1=require(a105_0x15db9f(0x187)),typedi_1=require('typedi'),errors_1=require(a105_0x15db9f(0x16d)),bad_request_error_1=require(a105_0x15db9f(0x1b4)),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require(a105_0x15db9f(0x1c2)),commit_components_dto_1=require(a105_0x15db9f(0x181)),commit_components_job_1=require(a105_0x15db9f(0x166)),constants_1=require('../../../../constants'),shortid_1=__importDefault(require('shortid')),providers_tokens_1=require(a105_0x15db9f(0x199));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x3c2da4,_0x4bda86,_0x1a5b23){const _0xb299c1=a105_0x15db9f;this[_0xb299c1(0x1b6)]=_0x3c2da4,this[_0xb299c1(0x19c)]=_0x4bda86,this[_0xb299c1(0x1a2)]=_0x1a5b23,this[_0xb299c1(0x1ad)]=new core_1[(_0xb299c1(0x171))](FlosumCommitJob_1['name']);}async['fetchRepositoryData'](){const _0x3af502=a105_0x15db9f;try{if(this[_0x3af502(0x16a)][_0x3af502(0x1bd)])this[_0x3af502(0x1ab)]=await this['salesforceSync']['getRepositoryRecord'](this[_0x3af502(0x16a)][_0x3af502(0x1bd)]);else this[_0x3af502(0x16a)][_0x3af502(0x163)]&&(this[_0x3af502(0x1ab)]=await this[_0x3af502(0x1a2)][_0x3af502(0x1a1)](this[_0x3af502(0x16a)][_0x3af502(0x163)]));}catch(_0x30e78a){throw new bad_request_error_1[(_0x3af502(0x176))](errors_1[_0x3af502(0x1a8)]);}}async[a105_0x15db9f(0x185)](){const _0x436919=a105_0x15db9f;if(!this[_0x436919(0x16a)][_0x436919(0x198)])return[];await this[_0x436919(0x1b6)]['patchObject'](constants_1[_0x436919(0x1a7)],this[_0x436919(0x16a)][_0x436919(0x198)],{'Name':(0x0,shortid_1[_0x436919(0x164)])()});const _0x11853b=await this[_0x436919(0x1b6)]['retrieveAttachment'](this['commitData'][_0x436919(0x198)])['then'](_0x356263=>_0x356263[_0x436919(0x193)]('\x20')[_0x436919(0x1a4)](_0x33f98a=>_0x33f98a['trim']()));await this[_0x436919(0x1b6)][_0x436919(0x1c8)](this['commitData'][_0x436919(0x198)]);const _0x1cdb5c=new salesforce_retriever_service_1[(_0x436919(0x19b))](this[_0x436919(0x1b6)]);return await _0x1cdb5c['run'](_0x11853b);}async[a105_0x15db9f(0x1a5)](){const _0x55ceb2=a105_0x15db9f;if(!this[_0x55ceb2(0x16a)][_0x55ceb2(0x1be)])return[];await this['salesforceService'][_0x55ceb2(0x178)](constants_1['FLOSUM_ATTACHMENT'],this[_0x55ceb2(0x16a)][_0x55ceb2(0x1be)],{'Name':(0x0,shortid_1[_0x55ceb2(0x164)])()});const _0x8bdfeb=await this['salesforceService'][_0x55ceb2(0x18b)](this[_0x55ceb2(0x16a)][_0x55ceb2(0x1be)]);return await this[_0x55ceb2(0x1b6)]['deleteAttachment'](this[_0x55ceb2(0x16a)][_0x55ceb2(0x1be)]),_0x8bdfeb;}async[a105_0x15db9f(0x1b2)](){const _0x4c4bf6=a105_0x15db9f,_0x1fb36c=new commit_components_dto_1[(_0x4c4bf6(0x1c7))](),[_0x152904,_0xfaff37]=await Promise['all']([this[_0x4c4bf6(0x185)](),this['getComponentsToDelete']()]);return _0x1fb36c['message']=this[_0x4c4bf6(0x16a)][_0x4c4bf6(0x169)],_0x1fb36c[_0x4c4bf6(0x18a)]=this['commitData'][_0x4c4bf6(0x18a)],_0x1fb36c[_0x4c4bf6(0x17c)]={'writed':_0x152904,'deleted':_0xfaff37},_0x1fb36c[_0x4c4bf6(0x1c9)]=this['config']['isConvertToSfdx'],_0x1fb36c[_0x4c4bf6(0x17d)]=this[_0x4c4bf6(0x1ba)],_0x1fb36c[_0x4c4bf6(0x19e)]=this[_0x4c4bf6(0x19e)],_0x1fb36c['provider']=this[_0x4c4bf6(0x182)][_0x4c4bf6(0x173)],_0x1fb36c;}async[a105_0x15db9f(0x183)](_0x28848c=![]){const _0x2f0027=a105_0x15db9f;if(_0x28848c)await this['salesforceSync']['updateRemoteState'](this[_0x2f0027(0x1ab)],{});else{const _0x1f9d43=await this[_0x2f0027(0x1ba)][_0x2f0027(0x1b7)]['getOne'](this[_0x2f0027(0x19e)]['name']);this[_0x2f0027(0x1bc)][_0x2f0027(0x196)](this[_0x2f0027(0x174)]+_0x2f0027(0x19f));const _0x95bf63={[this[_0x2f0027(0x1ba)][_0x2f0027(0x1c6)]]:{'lastCommit':_0x1f9d43[_0x2f0027(0x18d)]}};await this[_0x2f0027(0x1a2)][_0x2f0027(0x1b0)](this[_0x2f0027(0x1ab)],_0x95bf63);}}async[a105_0x15db9f(0x162)](){const _0x3e36af=a105_0x15db9f,_0x49be6c=await this[_0x3e36af(0x1b2)]();await this[_0x3e36af(0x1a2)][_0x3e36af(0x194)](this[_0x3e36af(0x1ab)],_0x3e36af(0x195)),await this[_0x3e36af(0x19c)]['run'](_0x49be6c,this[_0x3e36af(0x174)]),await this[_0x3e36af(0x183)](),await this[_0x3e36af(0x1a2)]['setStatus'](this['repositoryData'],'Completed');}async[a105_0x15db9f(0x1b5)](_0x286d43){const _0x292f85=a105_0x15db9f;try{this[_0x292f85(0x1bc)][_0x292f85(0x165)](''+_0x286d43),await this['sfLogger'][_0x292f85(0x19a)](),await this[_0x292f85(0x183)](!![]),await this[_0x292f85(0x1a2)]['setStatus'](this['repositoryData'],_0x292f85(0x1b3));}catch(_0x2f3cf9){this[_0x292f85(0x1ad)][_0x292f85(0x165)](_0x2f3cf9);}}async['run'](_0x264528){const _0x943cc=a105_0x15db9f;try{this[_0x943cc(0x16a)]=_0x264528,this[_0x943cc(0x1a0)]=typedi_1[_0x943cc(0x197)][_0x943cc(0x16b)](providers_tokens_1[_0x943cc(0x1b8)][_0x943cc(0x1a0)]),this[_0x943cc(0x1c0)]=typedi_1[_0x943cc(0x197)][_0x943cc(0x16b)](providers_tokens_1[_0x943cc(0x1b8)][_0x943cc(0x184)]),this['config']=typedi_1[_0x943cc(0x197)][_0x943cc(0x16b)](providers_tokens_1[_0x943cc(0x1b8)][_0x943cc(0x182)]),await this['fetchRepositoryData'](),this[_0x943cc(0x1ba)]=await this[_0x943cc(0x1c0)][_0x943cc(0x1c4)](this[_0x943cc(0x1ab)][_0x943cc(0x16f)]),this[_0x943cc(0x19e)]=await this[_0x943cc(0x1ba)][_0x943cc(0x1b7)][_0x943cc(0x1c4)](this[_0x943cc(0x1ab)][_0x943cc(0x1a6)]),this[_0x943cc(0x1bc)]=typedi_1[_0x943cc(0x197)]['get'](providers_tokens_1[_0x943cc(0x1b8)][_0x943cc(0x1ad)]),this[_0x943cc(0x174)]='[FLOSUM\x20->\x20GIT]\x20['+this['config'][_0x943cc(0x173)]['toUpperCase']()+_0x943cc(0x1ac)+this[_0x943cc(0x1ab)][_0x943cc(0x16f)]+_0x943cc(0x1aa)+this[_0x943cc(0x1ab)][_0x943cc(0x1a6)]+']\x20['+FlosumCommitJob_1[_0x943cc(0x1bf)]+']';if(!this[_0x943cc(0x1ab)])throw new bad_request_error_1[(_0x943cc(0x176))](errors_1[_0x943cc(0x168)]);await this[_0x943cc(0x1bc)]['log'](this['prefix']+_0x943cc(0x167))[_0x943cc(0x19a)](),await this[_0x943cc(0x162)]()[_0x943cc(0x17a)](_0x194b14=>this[_0x943cc(0x1b5)](_0x194b14));}catch(_0x4ab0da){this[_0x943cc(0x16a)]=undefined,this[_0x943cc(0x1ad)][_0x943cc(0x165)](_0x4ab0da);throw _0x4ab0da;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x15db9f(0x190)])({'transient':!![]}),__metadata(a105_0x15db9f(0x188),[salesforce_service_1[a105_0x15db9f(0x18c)],commit_components_job_1[a105_0x15db9f(0x170)],salesforce_sync_service_1[a105_0x15db9f(0x1a9)]])],FlosumCommitJob),exports[a105_0x15db9f(0x179)]=FlosumCommitJob;