const a124_0x3d9f8d=a124_0x1cfd;(function(_0xe7180,_0x28a24c){const _0x4cc9e1=a124_0x1cfd,_0x157040=_0xe7180();while(!![]){try{const _0x563d9a=parseInt(_0x4cc9e1(0x189))/0x1*(-parseInt(_0x4cc9e1(0x1a7))/0x2)+parseInt(_0x4cc9e1(0x177))/0x3*(parseInt(_0x4cc9e1(0x167))/0x4)+parseInt(_0x4cc9e1(0x197))/0x5*(parseInt(_0x4cc9e1(0x1a2))/0x6)+parseInt(_0x4cc9e1(0x1a8))/0x7*(parseInt(_0x4cc9e1(0x194))/0x8)+-parseInt(_0x4cc9e1(0x184))/0x9+-parseInt(_0x4cc9e1(0x171))/0xa+-parseInt(_0x4cc9e1(0x150))/0xb;if(_0x563d9a===_0x28a24c)break;else _0x157040['push'](_0x157040['shift']());}catch(_0x7bbb01){_0x157040['push'](_0x157040['shift']());}}}(a124_0x4c8f,0x3507c));function a124_0x1cfd(_0x433c39,_0x1431b8){const _0xf3cf95=a124_0x4c8f();return a124_0x1cfd=function(_0x20f538,_0x39dce6){_0x20f538=_0x20f538-0x137;let _0x4c8f44=_0xf3cf95[_0x20f538];return _0x4c8f44;},a124_0x1cfd(_0x433c39,_0x1431b8);}const a124_0x39dce6=(function(){let _0x94e783=!![];return function(_0x588988,_0x13b348){const _0x5326cb=_0x94e783?function(){const _0x255a5=a124_0x1cfd;if(_0x13b348){const _0x1b8ff8=_0x13b348[_0x255a5(0x181)](_0x588988,arguments);return _0x13b348=null,_0x1b8ff8;}}:function(){};return _0x94e783=![],_0x5326cb;};}()),a124_0x20f538=a124_0x39dce6(this,function(){const _0x26ee82=a124_0x1cfd;return a124_0x20f538[_0x26ee82(0x13a)]()[_0x26ee82(0x16f)]('(((.+)+)+)+$')[_0x26ee82(0x13a)]()[_0x26ee82(0x139)](a124_0x20f538)['search']('(((.+)+)+)+$');});a124_0x20f538();'use strict';var __decorate=this&&this['__decorate']||function(_0x299445,_0x3e03ce,_0x2ce51d,_0x52a966){const _0xcfb467=a124_0x1cfd;var _0x3b0dac=arguments['length'],_0x305b06=_0x3b0dac<0x3?_0x3e03ce:_0x52a966===null?_0x52a966=Object[_0xcfb467(0x18e)](_0x3e03ce,_0x2ce51d):_0x52a966,_0x41f15d;if(typeof Reflect===_0xcfb467(0x18c)&&typeof Reflect[_0xcfb467(0x13f)]===_0xcfb467(0x17d))_0x305b06=Reflect[_0xcfb467(0x13f)](_0x299445,_0x3e03ce,_0x2ce51d,_0x52a966);else{for(var _0x1c29d4=_0x299445[_0xcfb467(0x15a)]-0x1;_0x1c29d4>=0x0;_0x1c29d4--)if(_0x41f15d=_0x299445[_0x1c29d4])_0x305b06=(_0x3b0dac<0x3?_0x41f15d(_0x305b06):_0x3b0dac>0x3?_0x41f15d(_0x3e03ce,_0x2ce51d,_0x305b06):_0x41f15d(_0x3e03ce,_0x2ce51d))||_0x305b06;}return _0x3b0dac>0x3&&_0x305b06&&Object['defineProperty'](_0x3e03ce,_0x2ce51d,_0x305b06),_0x305b06;},__metadata=this&&this['__metadata']||function(_0x5b8b35,_0x434616){const _0x4ec4b4=a124_0x1cfd;if(typeof Reflect===_0x4ec4b4(0x18c)&&typeof Reflect[_0x4ec4b4(0x18b)]==='function')return Reflect[_0x4ec4b4(0x18b)](_0x5b8b35,_0x434616);},__importDefault=this&&this['__importDefault']||function(_0x754d02){const _0x542095=a124_0x1cfd;return _0x754d02&&_0x754d02[_0x542095(0x142)]?_0x754d02:{'default':_0x754d02};},FlosumCommitJob_1;function a124_0x4c8f(){const _0x5d90ec=['trim','CommitToGitErrorNotification','convertToSFDX','syncBranchId','Tokens','838096IsoZAH','exec','repository','1610005gfhzzA','FlosumCommitJob','error','CommitToGitCompletedNotification','email','commitAttachmentId','split','branchName','SalesforceSyncService','deleteAttachment','fetchRepositoryData','6laxjeB','SalesforceService','syncRepositoryId','salesforceService','gitRepoService','2jZExpZ','21HOgKMt','../../notifications/commit-to-git-completed.notification','gitApiService','constructor','toString','execute','design:paramtypes','Completed','shortid','decorate','updateRemoteState','ERR_UNKNOWN_SYNC_RECORD_ID','__esModule','default','CommitComponentsDto','prefix','name','branch',']\x20[Repository:\x20','gitUrl','../../../../core/errors/bad-request.error','../../providers/providers.tokens','repoService','repositoryData','repositoryName','retrieveAttachment','3098854MKbELa','getBranchRecord','../dto/commit-components.dto','[FLOSUM\x20->\x20GIT]\x20[',']\x20[Branch:\x20','isConvertToSfdx','patchObject','ERR_INVALID_SYNC_RECORD_ID','deleteAttachmentId','\x20Update\x20remote\x20state.','length','sha','FLOSUM_ATTACHMENT','Email\x20notifications\x20are\x20disabled.','../../../../constants/errors','../../salesforce/services/salesforce.service','getOne','branches','setStatus','In\x20Progress','info','\x20Start\x20Flosum\x20commit\x20job.','run','20XfFROM',']\x20[','all','send','getComponentsToDelete','../../../../constants','isEmailNotificationsEnabled','../../salesforce/services/salesforce-sync.service','search','getComponentsToWrite','644750ZTJSJV','errorNotification','salesforceSync','commitJob','CommitComponentsJob','log','179241UjQSDG','gitProvider','../../../../core','recordTypeName','sfLogger','../../salesforce/services/salesforce-retriever.service','function','get','completeNotification','commitData','apply','Error','message','1089450ooQpsj','logger','config','user','BadRequestError','250571PTgtDQ','getCommitDto','metadata','object','Container','getOwnPropertyDescriptor'];a124_0x4c8f=function(){return _0x5d90ec;};return a124_0x4c8f();}Object['defineProperty'](exports,a124_0x3d9f8d(0x142),{'value':!![]}),exports[a124_0x3d9f8d(0x198)]=void 0x0;const core_1=require(a124_0x3d9f8d(0x179)),salesforce_service_1=require(a124_0x3d9f8d(0x15f)),typedi_1=require('typedi'),errors_1=require(a124_0x3d9f8d(0x15e)),bad_request_error_1=require(a124_0x3d9f8d(0x14a)),salesforce_retriever_service_1=require(a124_0x3d9f8d(0x17c)),salesforce_sync_service_1=require(a124_0x3d9f8d(0x16e)),commit_components_dto_1=require(a124_0x3d9f8d(0x152)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a124_0x3d9f8d(0x16c)),shortid_1=__importDefault(require(a124_0x3d9f8d(0x13e))),providers_tokens_1=require(a124_0x3d9f8d(0x14b)),commit_to_git_completed_notification_1=require(a124_0x3d9f8d(0x137)),commit_to_git_error_notification_1=require('../../notifications/commit-to-git-error.notification');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0xe3c800,_0x15ed4f,_0x4b0220){const _0x2e7296=a124_0x3d9f8d;this[_0x2e7296(0x1a5)]=_0xe3c800,this[_0x2e7296(0x174)]=_0x15ed4f,this[_0x2e7296(0x173)]=_0x4b0220,this[_0x2e7296(0x185)]=new core_1['Logger'](FlosumCommitJob_1['name']);}async[a124_0x3d9f8d(0x17f)](_0x3e37ef,_0x4c3c06,_0x3c656c,_0x51a47b){const _0x535dec=a124_0x3d9f8d;if(!this[_0x535dec(0x180)][_0x535dec(0x16d)]){this['logger'][_0x535dec(0x164)](_0x535dec(0x15d));return;}await new commit_to_git_completed_notification_1[(_0x535dec(0x19a))]({'emails':_0x3e37ef,'gitProvider':_0x4c3c06,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1['CommitToGitCompletedNotification']['name'],'repositoryName':_0x3c656c,'branchName':_0x51a47b})[_0x535dec(0x13b)]();}async[a124_0x3d9f8d(0x172)](_0x434a9d,_0x43272e,_0x39831f,_0x480849){const _0x21dd6d=a124_0x3d9f8d;if(!this['commitData'][_0x21dd6d(0x16d)]){this['logger'][_0x21dd6d(0x164)](_0x21dd6d(0x15d));return;}await new commit_to_git_error_notification_1[(_0x21dd6d(0x190))]({'emails':_0x434a9d,'gitProvider':_0x43272e,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0x21dd6d(0x190)][_0x21dd6d(0x146)],'repositoryName':_0x39831f,'branchName':_0x480849})[_0x21dd6d(0x13b)]();}async[a124_0x3d9f8d(0x1a1)](){const _0x1ec02c=a124_0x3d9f8d;try{if(this[_0x1ec02c(0x180)]['syncRepositoryId'])this[_0x1ec02c(0x14d)]=await this[_0x1ec02c(0x173)]['getRepositoryRecord'](this[_0x1ec02c(0x180)][_0x1ec02c(0x1a4)]);else this[_0x1ec02c(0x180)][_0x1ec02c(0x192)]&&(this[_0x1ec02c(0x14d)]=await this['salesforceSync'][_0x1ec02c(0x151)](this[_0x1ec02c(0x180)]['syncBranchId']));}catch(_0x14e0da){throw new bad_request_error_1[(_0x1ec02c(0x188))](errors_1[_0x1ec02c(0x157)]);}}async[a124_0x3d9f8d(0x170)](){const _0x1cadbb=a124_0x3d9f8d;if(!this[_0x1cadbb(0x180)][_0x1cadbb(0x19c)])return[];await this[_0x1cadbb(0x1a5)][_0x1cadbb(0x156)](constants_1[_0x1cadbb(0x15c)],this['commitData'][_0x1cadbb(0x19c)],{'Name':(0x0,shortid_1[_0x1cadbb(0x143)])()});const _0x3cb763=await this[_0x1cadbb(0x1a5)][_0x1cadbb(0x14f)](this['commitData']['commitAttachmentId'])['then'](_0x404445=>_0x404445[_0x1cadbb(0x19d)]('\x20')['map'](_0x35202a=>_0x35202a[_0x1cadbb(0x18f)]()));await this[_0x1cadbb(0x1a5)][_0x1cadbb(0x1a0)](this[_0x1cadbb(0x180)][_0x1cadbb(0x19c)]);const _0x4cbff3=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x1cadbb(0x1a5)]);return await _0x4cbff3[_0x1cadbb(0x166)](_0x3cb763);}async['getComponentsToDelete'](){const _0x3c7b83=a124_0x3d9f8d;if(!this[_0x3c7b83(0x180)][_0x3c7b83(0x158)])return[];await this[_0x3c7b83(0x1a5)][_0x3c7b83(0x156)](constants_1['FLOSUM_ATTACHMENT'],this[_0x3c7b83(0x180)][_0x3c7b83(0x158)],{'Name':(0x0,shortid_1[_0x3c7b83(0x143)])()});const _0x1c97fb=await this[_0x3c7b83(0x1a5)]['retrieveAttachment'](this[_0x3c7b83(0x180)][_0x3c7b83(0x158)]),_0x5a76e8=JSON['parse'](_0x1c97fb);return await this[_0x3c7b83(0x1a5)]['deleteAttachment'](this['commitData'][_0x3c7b83(0x158)]),_0x5a76e8;}async[a124_0x3d9f8d(0x18a)](){const _0x501a38=a124_0x3d9f8d,_0xed11c9=new commit_components_dto_1[(_0x501a38(0x144))](),[_0xdc6524,_0x3b552b]=await Promise[_0x501a38(0x169)]([this['getComponentsToWrite'](),this[_0x501a38(0x16b)]()]);return _0xed11c9[_0x501a38(0x183)]=this[_0x501a38(0x180)][_0x501a38(0x183)],_0xed11c9[_0x501a38(0x187)]=this[_0x501a38(0x180)][_0x501a38(0x187)],_0xed11c9['components']={'writed':_0xdc6524,'deleted':_0x3b552b},_0xed11c9[_0x501a38(0x191)]=this[_0x501a38(0x186)][_0x501a38(0x155)],_0xed11c9['repo']=this[_0x501a38(0x196)],_0xed11c9[_0x501a38(0x147)]=this['branch'],_0xed11c9['provider']=this['config'][_0x501a38(0x178)],_0xed11c9['recordType']=this['repositoryData'][_0x501a38(0x17a)],_0xed11c9;}async['updateLastCommit'](_0x23d2d5=![]){const _0x50a1d4=a124_0x3d9f8d;if(_0x23d2d5)await this[_0x50a1d4(0x173)][_0x50a1d4(0x140)](this[_0x50a1d4(0x14d)],{});else{const _0x1f7c8a=await this[_0x50a1d4(0x196)][_0x50a1d4(0x161)]['getOne'](this[_0x50a1d4(0x147)][_0x50a1d4(0x146)]);this[_0x50a1d4(0x17b)][_0x50a1d4(0x176)](this[_0x50a1d4(0x145)]+_0x50a1d4(0x159));const _0x29d9ea={[this[_0x50a1d4(0x196)][_0x50a1d4(0x149)]]:{'lastCommit':_0x1f7c8a[_0x50a1d4(0x15b)]}};await this[_0x50a1d4(0x173)][_0x50a1d4(0x140)](this[_0x50a1d4(0x14d)],_0x29d9ea);}}async[a124_0x3d9f8d(0x195)](){const _0x2eeb98=a124_0x3d9f8d,_0x242288=await this['getCommitDto']();await this[_0x2eeb98(0x173)][_0x2eeb98(0x162)](this[_0x2eeb98(0x14d)],_0x2eeb98(0x163)),await this[_0x2eeb98(0x174)][_0x2eeb98(0x166)](_0x242288,this[_0x2eeb98(0x145)]),await this['updateLastCommit'](),await this[_0x2eeb98(0x173)][_0x2eeb98(0x162)](this[_0x2eeb98(0x14d)],_0x2eeb98(0x13d));}async['handleCommitJobError'](_0x4f9e59){const _0xe462cf=a124_0x3d9f8d;try{this[_0xe462cf(0x17b)]['error'](''+_0x4f9e59),await this[_0xe462cf(0x17b)]['send'](),await this['updateLastCommit'](!![]),await this[_0xe462cf(0x173)][_0xe462cf(0x162)](this[_0xe462cf(0x14d)],_0xe462cf(0x182)),await this[_0xe462cf(0x17f)]([this[_0xe462cf(0x180)]['user']['email']],this[_0xe462cf(0x186)][_0xe462cf(0x178)],this[_0xe462cf(0x196)][_0xe462cf(0x146)],this[_0xe462cf(0x147)][_0xe462cf(0x146)]);}catch(_0xbbb3d1){this[_0xe462cf(0x185)][_0xe462cf(0x199)](_0xbbb3d1),await this[_0xe462cf(0x172)]([this[_0xe462cf(0x180)][_0xe462cf(0x187)]['email']],this[_0xe462cf(0x186)][_0xe462cf(0x178)],this[_0xe462cf(0x196)][_0xe462cf(0x146)],this[_0xe462cf(0x147)]['name']);}}async[a124_0x3d9f8d(0x166)](_0x2ee59c){const _0x5f02d5=a124_0x3d9f8d;try{this[_0x5f02d5(0x180)]=_0x2ee59c,this['gitApiService']=typedi_1[_0x5f02d5(0x18d)]['get'](providers_tokens_1[_0x5f02d5(0x193)][_0x5f02d5(0x138)]),this[_0x5f02d5(0x14c)]=typedi_1[_0x5f02d5(0x18d)]['get'](providers_tokens_1[_0x5f02d5(0x193)][_0x5f02d5(0x1a6)]),this[_0x5f02d5(0x186)]=typedi_1[_0x5f02d5(0x18d)][_0x5f02d5(0x17e)](providers_tokens_1['Tokens'][_0x5f02d5(0x186)]),await this[_0x5f02d5(0x1a1)](),this['repository']=await this[_0x5f02d5(0x14c)]['getOne'](this['repositoryData']['repositoryName']),this[_0x5f02d5(0x147)]=await this[_0x5f02d5(0x196)]['branches'][_0x5f02d5(0x160)](this[_0x5f02d5(0x14d)][_0x5f02d5(0x19e)]),this['sfLogger']=typedi_1[_0x5f02d5(0x18d)][_0x5f02d5(0x17e)](providers_tokens_1[_0x5f02d5(0x193)][_0x5f02d5(0x185)]),this[_0x5f02d5(0x145)]=_0x5f02d5(0x153)+this[_0x5f02d5(0x186)][_0x5f02d5(0x178)]['toUpperCase']()+_0x5f02d5(0x148)+this[_0x5f02d5(0x14d)][_0x5f02d5(0x14e)]+_0x5f02d5(0x154)+this[_0x5f02d5(0x14d)][_0x5f02d5(0x19e)]+_0x5f02d5(0x168)+FlosumCommitJob_1[_0x5f02d5(0x146)]+']';if(!this[_0x5f02d5(0x14d)])throw new bad_request_error_1['BadRequestError'](errors_1[_0x5f02d5(0x141)]);await this['sfLogger']['log'](this['prefix']+_0x5f02d5(0x165))[_0x5f02d5(0x16a)](),await this[_0x5f02d5(0x195)]()['catch'](_0x5eaeb9=>this['handleCommitJobError'](_0x5eaeb9)),await this[_0x5f02d5(0x17f)]([this['commitData'][_0x5f02d5(0x187)][_0x5f02d5(0x19b)]],this['config']['gitProvider'],this[_0x5f02d5(0x196)][_0x5f02d5(0x146)],this['branch']['name']);}catch(_0x66bf24){this[_0x5f02d5(0x180)]=undefined,this['logger'][_0x5f02d5(0x199)](_0x66bf24),await this['errorNotification']([this['commitData'][_0x5f02d5(0x187)][_0x5f02d5(0x19b)]],this[_0x5f02d5(0x186)][_0x5f02d5(0x178)],this['repository']['name'],this['branch'][_0x5f02d5(0x146)]);throw _0x66bf24;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a124_0x3d9f8d(0x13c),[salesforce_service_1[a124_0x3d9f8d(0x1a3)],commit_components_job_1[a124_0x3d9f8d(0x175)],salesforce_sync_service_1[a124_0x3d9f8d(0x19f)]])],FlosumCommitJob),exports[a124_0x3d9f8d(0x198)]=FlosumCommitJob;