const a124_0x25d7cd=a124_0x1979;(function(_0x2e2e27,_0x1b66b6){const _0x25a25a=a124_0x1979,_0x59fcf9=_0x2e2e27();while(!![]){try{const _0x2a5289=parseInt(_0x25a25a(0x224))/0x1*(-parseInt(_0x25a25a(0x1d0))/0x2)+parseInt(_0x25a25a(0x1d6))/0x3*(-parseInt(_0x25a25a(0x205))/0x4)+parseInt(_0x25a25a(0x1db))/0x5*(-parseInt(_0x25a25a(0x210))/0x6)+parseInt(_0x25a25a(0x1c6))/0x7*(parseInt(_0x25a25a(0x229))/0x8)+-parseInt(_0x25a25a(0x223))/0x9+-parseInt(_0x25a25a(0x1d1))/0xa*(parseInt(_0x25a25a(0x228))/0xb)+parseInt(_0x25a25a(0x1e8))/0xc;if(_0x2a5289===_0x1b66b6)break;else _0x59fcf9['push'](_0x59fcf9['shift']());}catch(_0x375fad){_0x59fcf9['push'](_0x59fcf9['shift']());}}}(a124_0x5b69,0xa7f4d));const a124_0x1f123b=(function(){let _0x4ced63=!![];return function(_0x5dfe29,_0x3d55c9){const _0x23730d=_0x4ced63?function(){const _0xdf1440=a124_0x1979;if(_0x3d55c9){const _0x57132c=_0x3d55c9[_0xdf1440(0x227)](_0x5dfe29,arguments);return _0x3d55c9=null,_0x57132c;}}:function(){};return _0x4ced63=![],_0x23730d;};}()),a124_0x44d91a=a124_0x1f123b(this,function(){const _0xfa9a3a=a124_0x1979;return a124_0x44d91a['toString']()['search'](_0xfa9a3a(0x220))['toString']()[_0xfa9a3a(0x20e)](a124_0x44d91a)[_0xfa9a3a(0x222)](_0xfa9a3a(0x220));});a124_0x44d91a();'use strict';function a124_0x1979(_0x2fec25,_0x5a787d){const _0x302a65=a124_0x5b69();return a124_0x1979=function(_0x44d91a,_0x1f123b){_0x44d91a=_0x44d91a-0x1c0;let _0x5b6971=_0x302a65[_0x44d91a];return _0x5b6971;},a124_0x1979(_0x2fec25,_0x5a787d);}var __decorate=this&&this[a124_0x25d7cd(0x1c1)]||function(_0x135607,_0x5b5fc7,_0xb4a795,_0x5c6186){const _0x36853a=a124_0x25d7cd;var _0x1848b8=arguments[_0x36853a(0x236)],_0x2384a6=_0x1848b8<0x3?_0x5b5fc7:_0x5c6186===null?_0x5c6186=Object['getOwnPropertyDescriptor'](_0x5b5fc7,_0xb4a795):_0x5c6186,_0x5ecc01;if(typeof Reflect===_0x36853a(0x1ee)&&typeof Reflect[_0x36853a(0x1cc)]===_0x36853a(0x22d))_0x2384a6=Reflect[_0x36853a(0x1cc)](_0x135607,_0x5b5fc7,_0xb4a795,_0x5c6186);else{for(var _0x2b1ea6=_0x135607[_0x36853a(0x236)]-0x1;_0x2b1ea6>=0x0;_0x2b1ea6--)if(_0x5ecc01=_0x135607[_0x2b1ea6])_0x2384a6=(_0x1848b8<0x3?_0x5ecc01(_0x2384a6):_0x1848b8>0x3?_0x5ecc01(_0x5b5fc7,_0xb4a795,_0x2384a6):_0x5ecc01(_0x5b5fc7,_0xb4a795))||_0x2384a6;}return _0x1848b8>0x3&&_0x2384a6&&Object[_0x36853a(0x226)](_0x5b5fc7,_0xb4a795,_0x2384a6),_0x2384a6;},__metadata=this&&this[a124_0x25d7cd(0x1c9)]||function(_0x40e6e8,_0x2112f2){const _0x4cc76b=a124_0x25d7cd;if(typeof Reflect===_0x4cc76b(0x1ee)&&typeof Reflect[_0x4cc76b(0x1f3)]===_0x4cc76b(0x22d))return Reflect[_0x4cc76b(0x1f3)](_0x40e6e8,_0x2112f2);},__importDefault=this&&this[a124_0x25d7cd(0x237)]||function(_0x3e37b1){const _0x1d6d37=a124_0x25d7cd;return _0x3e37b1&&_0x3e37b1[_0x1d6d37(0x1e1)]?_0x3e37b1:{'default':_0x3e37b1};},FlosumCommitJob_1;function a124_0x5b69(){const _0x519ddd=['9787580vYrQcy','salesforceService','split','CommitToGitErrorNotification','Email\x20notifications\x20are\x20disabled.','2367ryXfGQ','SalesforceService','In\x20Progress','Logger','send','2285685aTomZI','CommitComponentsJob','syncRepositoryId','syncBranchId','FLOSUM_ATTACHMENT',']\x20[Branch:\x20','__esModule','Service','getComponentsToDelete','../../notifications/commit-to-git-completed.notification','\x20Update\x20remote\x20state.','shortid','gitRepoService','47156532ugfmgY','typedi','ERR_INVALID_SYNC_RECORD_ID','get','commitAttachmentId','../../../../constants/errors','object','updateRemoteState','Error','commitData','setStatus','metadata','BadRequestError','gitUrl','repositoryData','patchObject','../../salesforce/services/salesforce-sync.service','retrieveAttachment','deleteAttachment','message','error','toUpperCase','catch','recordType','updateLastCommit','Completed','salesforceSync','../../providers/providers.tokens','SalesforceRetrieverService','4196nNKUkj','errorNotification','execute','isConvertToSfdx','prefix','../dto/commit-components.dto','ERR_UNKNOWN_SYNC_RECORD_ID','branches','trim','constructor','../../salesforce/services/salesforce-retriever.service','18iffyWy','exec','sfLogger','getCommitDto','config','repositoryName','getBranchRecord','getOne','[FLOSUM\x20->\x20GIT]\x20[','repoService','../../../../constants','\x20Start\x20Flosum\x20commit\x20job.','logger','repo','branchName','fetchRepositoryData','(((.+)+)+)+$','then','search','5494311rgsGiJ','1798RXNhaN','repository','defineProperty','apply','11phroXl','3496IWMHJU','info','isEmailNotificationsEnabled','gitApiService','function','../../notifications/commit-to-git-error.notification','recordTypeName','getRepositoryRecord','Container','completeNotification',']\x20[Repository:\x20','name','../../../../core','length','__importDefault','../../../../core/errors/bad-request.error','deleteAttachmentId','CommitToGitCompletedNotification','handleCommitJobError','design:paramtypes','getComponentsToWrite','__decorate','SalesforceSyncService','branch','log','Tokens','16387sxqLLy',']\x20[','sha','__metadata','gitProvider','user','decorate','run','email','commitJob','530mQatiR'];a124_0x5b69=function(){return _0x519ddd;};return a124_0x5b69();}Object[a124_0x25d7cd(0x226)](exports,a124_0x25d7cd(0x1e1),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a124_0x25d7cd(0x235)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a124_0x25d7cd(0x1e9)),errors_1=require(a124_0x25d7cd(0x1ed)),bad_request_error_1=require(a124_0x25d7cd(0x238)),salesforce_retriever_service_1=require(a124_0x25d7cd(0x20f)),salesforce_sync_service_1=require(a124_0x25d7cd(0x1f8)),commit_components_dto_1=require(a124_0x25d7cd(0x20a)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a124_0x25d7cd(0x21a)),shortid_1=__importDefault(require(a124_0x25d7cd(0x1e6))),providers_tokens_1=require(a124_0x25d7cd(0x203)),commit_to_git_completed_notification_1=require(a124_0x25d7cd(0x1e4)),commit_to_git_error_notification_1=require(a124_0x25d7cd(0x22e));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x3b5549,_0x8191aa,_0x37eddf){const _0x3ea692=a124_0x25d7cd;this[_0x3ea692(0x1d2)]=_0x3b5549,this['commitJob']=_0x8191aa,this['salesforceSync']=_0x37eddf,this['logger']=new core_1[(_0x3ea692(0x1d9))](FlosumCommitJob_1[_0x3ea692(0x234)]);}async[a124_0x25d7cd(0x232)](_0x637d28,_0x30b3f5,_0x3fa593,_0x1609b2){const _0x2ef21e=a124_0x25d7cd;if(!this['commitData'][_0x2ef21e(0x22b)]){this[_0x2ef21e(0x21c)][_0x2ef21e(0x22a)](_0x2ef21e(0x1d5));return;}await new commit_to_git_completed_notification_1[(_0x2ef21e(0x23a))]({'emails':_0x637d28,'gitProvider':_0x30b3f5,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1[_0x2ef21e(0x23a)]['name'],'repositoryName':_0x3fa593,'branchName':_0x1609b2})['execute']();}async[a124_0x25d7cd(0x206)](_0x2e7480,_0x12c0cc,_0x2c3c57,_0x4e5a5a){const _0x5ab0a0=a124_0x25d7cd;if(!this[_0x5ab0a0(0x1f1)][_0x5ab0a0(0x22b)]){this[_0x5ab0a0(0x21c)][_0x5ab0a0(0x22a)](_0x5ab0a0(0x1d5));return;}await new commit_to_git_error_notification_1[(_0x5ab0a0(0x1d4))]({'emails':_0x2e7480,'gitProvider':_0x12c0cc,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0x5ab0a0(0x1d4)][_0x5ab0a0(0x234)],'repositoryName':_0x2c3c57,'branchName':_0x4e5a5a})[_0x5ab0a0(0x207)]();}async['fetchRepositoryData'](){const _0x23809d=a124_0x25d7cd;try{if(this[_0x23809d(0x1f1)][_0x23809d(0x1dd)])this[_0x23809d(0x1f6)]=await this['salesforceSync'][_0x23809d(0x230)](this[_0x23809d(0x1f1)][_0x23809d(0x1dd)]);else this[_0x23809d(0x1f1)]['syncBranchId']&&(this[_0x23809d(0x1f6)]=await this['salesforceSync'][_0x23809d(0x216)](this[_0x23809d(0x1f1)][_0x23809d(0x1de)]));}catch(_0x5dd302){throw new bad_request_error_1['BadRequestError'](errors_1[_0x23809d(0x1ea)]);}}async[a124_0x25d7cd(0x1c0)](){const _0x1267cf=a124_0x25d7cd;if(!this[_0x1267cf(0x1f1)][_0x1267cf(0x1ec)])return[];await this[_0x1267cf(0x1d2)][_0x1267cf(0x1f7)](constants_1[_0x1267cf(0x1df)],this[_0x1267cf(0x1f1)][_0x1267cf(0x1ec)],{'Name':(0x0,shortid_1['default'])()});const _0x3835df=await this[_0x1267cf(0x1d2)][_0x1267cf(0x1f9)](this[_0x1267cf(0x1f1)][_0x1267cf(0x1ec)])[_0x1267cf(0x221)](_0x4a2147=>_0x4a2147[_0x1267cf(0x1d3)]('\x20')['map'](_0x59acec=>_0x59acec[_0x1267cf(0x20d)]()));await this[_0x1267cf(0x1d2)][_0x1267cf(0x1fa)](this['commitData'][_0x1267cf(0x1ec)]);const _0x21b7ab=new salesforce_retriever_service_1[(_0x1267cf(0x204))](this[_0x1267cf(0x1d2)]);return await _0x21b7ab[_0x1267cf(0x1cd)](_0x3835df);}async[a124_0x25d7cd(0x1e3)](){const _0x50e39d=a124_0x25d7cd;if(!this[_0x50e39d(0x1f1)][_0x50e39d(0x239)])return[];await this[_0x50e39d(0x1d2)]['patchObject'](constants_1[_0x50e39d(0x1df)],this[_0x50e39d(0x1f1)][_0x50e39d(0x239)],{'Name':(0x0,shortid_1['default'])()});const _0x16e6ea=await this[_0x50e39d(0x1d2)]['retrieveAttachment'](this[_0x50e39d(0x1f1)]['deleteAttachmentId']),_0x4a64a8=JSON['parse'](_0x16e6ea);return await this[_0x50e39d(0x1d2)][_0x50e39d(0x1fa)](this[_0x50e39d(0x1f1)][_0x50e39d(0x239)]),_0x4a64a8;}async[a124_0x25d7cd(0x213)](){const _0x71abc1=a124_0x25d7cd,_0x1cd9d4=new commit_components_dto_1['CommitComponentsDto'](),[_0x34dfa7,_0x515f15]=await Promise['all']([this[_0x71abc1(0x1c0)](),this['getComponentsToDelete']()]);return _0x1cd9d4[_0x71abc1(0x1fb)]=this[_0x71abc1(0x1f1)][_0x71abc1(0x1fb)],_0x1cd9d4[_0x71abc1(0x1cb)]=this[_0x71abc1(0x1f1)]['user'],_0x1cd9d4['components']={'writed':_0x34dfa7,'deleted':_0x515f15},_0x1cd9d4['convertToSFDX']=this[_0x71abc1(0x214)][_0x71abc1(0x208)],_0x1cd9d4[_0x71abc1(0x21d)]=this[_0x71abc1(0x225)],_0x1cd9d4[_0x71abc1(0x1c3)]=this['branch'],_0x1cd9d4['provider']=this[_0x71abc1(0x214)][_0x71abc1(0x1ca)],_0x1cd9d4[_0x71abc1(0x1ff)]=this[_0x71abc1(0x1f6)][_0x71abc1(0x22f)],_0x1cd9d4;}async[a124_0x25d7cd(0x200)](_0x3f2566=![]){const _0xc98828=a124_0x25d7cd;if(_0x3f2566)await this['salesforceSync'][_0xc98828(0x1ef)](this['repositoryData'],{});else{const _0x11446a=await this[_0xc98828(0x225)][_0xc98828(0x20c)][_0xc98828(0x217)](this[_0xc98828(0x1c3)][_0xc98828(0x234)]);this[_0xc98828(0x212)][_0xc98828(0x1c4)](this[_0xc98828(0x209)]+_0xc98828(0x1e5));const _0x20059a={[this['repository'][_0xc98828(0x1f5)]]:{'lastCommit':_0x11446a[_0xc98828(0x1c8)]}};await this[_0xc98828(0x202)][_0xc98828(0x1ef)](this[_0xc98828(0x1f6)],_0x20059a);}}async[a124_0x25d7cd(0x211)](){const _0x58243c=a124_0x25d7cd,_0x28d114=await this['getCommitDto']();await this['salesforceSync'][_0x58243c(0x1f2)](this[_0x58243c(0x1f6)],_0x58243c(0x1d8)),await this[_0x58243c(0x1cf)][_0x58243c(0x1cd)](_0x28d114,this[_0x58243c(0x209)]),await this[_0x58243c(0x200)](),await this[_0x58243c(0x202)][_0x58243c(0x1f2)](this['repositoryData'],_0x58243c(0x201));}async['handleCommitJobError'](_0x437a54){const _0x4780f3=a124_0x25d7cd;try{this['sfLogger']['error'](''+_0x437a54),await this[_0x4780f3(0x212)][_0x4780f3(0x1da)](),await this[_0x4780f3(0x200)](!![]),await this[_0x4780f3(0x202)][_0x4780f3(0x1f2)](this['repositoryData'],_0x4780f3(0x1f0)),await this[_0x4780f3(0x232)]([this['commitData'][_0x4780f3(0x1cb)][_0x4780f3(0x1ce)]],this[_0x4780f3(0x214)][_0x4780f3(0x1ca)],this[_0x4780f3(0x225)][_0x4780f3(0x234)],this['branch'][_0x4780f3(0x234)]);}catch(_0x53d315){this[_0x4780f3(0x21c)][_0x4780f3(0x1fc)](_0x53d315),await this[_0x4780f3(0x206)]([this[_0x4780f3(0x1f1)][_0x4780f3(0x1cb)]['email']],this[_0x4780f3(0x214)][_0x4780f3(0x1ca)],this[_0x4780f3(0x225)]['name'],this[_0x4780f3(0x1c3)]['name']);}}async['run'](_0x300e30){const _0x552d35=a124_0x25d7cd;try{this[_0x552d35(0x1f1)]=_0x300e30,this['gitApiService']=typedi_1[_0x552d35(0x231)][_0x552d35(0x1eb)](providers_tokens_1[_0x552d35(0x1c5)][_0x552d35(0x22c)]),this['repoService']=typedi_1[_0x552d35(0x231)][_0x552d35(0x1eb)](providers_tokens_1[_0x552d35(0x1c5)][_0x552d35(0x1e7)]),this[_0x552d35(0x214)]=typedi_1[_0x552d35(0x231)]['get'](providers_tokens_1[_0x552d35(0x1c5)][_0x552d35(0x214)]),await this[_0x552d35(0x21f)](),this[_0x552d35(0x225)]=await this[_0x552d35(0x219)]['getOne'](this[_0x552d35(0x1f6)][_0x552d35(0x215)]),this[_0x552d35(0x1c3)]=await this[_0x552d35(0x225)]['branches'][_0x552d35(0x217)](this[_0x552d35(0x1f6)][_0x552d35(0x21e)]),this[_0x552d35(0x212)]=typedi_1[_0x552d35(0x231)][_0x552d35(0x1eb)](providers_tokens_1[_0x552d35(0x1c5)][_0x552d35(0x21c)]),this[_0x552d35(0x209)]=_0x552d35(0x218)+this[_0x552d35(0x214)][_0x552d35(0x1ca)][_0x552d35(0x1fd)]()+_0x552d35(0x233)+this[_0x552d35(0x1f6)][_0x552d35(0x215)]+_0x552d35(0x1e0)+this[_0x552d35(0x1f6)][_0x552d35(0x21e)]+_0x552d35(0x1c7)+FlosumCommitJob_1[_0x552d35(0x234)]+']';if(!this[_0x552d35(0x1f6)])throw new bad_request_error_1[(_0x552d35(0x1f4))](errors_1[_0x552d35(0x20b)]);await this[_0x552d35(0x212)][_0x552d35(0x1c4)](this[_0x552d35(0x209)]+_0x552d35(0x21b))[_0x552d35(0x1da)](),await this['exec']()[_0x552d35(0x1fe)](_0x1c23b5=>this[_0x552d35(0x23b)](_0x1c23b5)),await this[_0x552d35(0x232)]([this['commitData'][_0x552d35(0x1cb)]['email']],this[_0x552d35(0x214)]['gitProvider'],this['repository'][_0x552d35(0x234)],this[_0x552d35(0x1c3)][_0x552d35(0x234)]);}catch(_0x39e56){this[_0x552d35(0x1f1)]=undefined,this[_0x552d35(0x21c)][_0x552d35(0x1fc)](_0x39e56),await this['errorNotification']([this[_0x552d35(0x1f1)][_0x552d35(0x1cb)][_0x552d35(0x1ce)]],this['config'][_0x552d35(0x1ca)],this['repository'][_0x552d35(0x234)],this[_0x552d35(0x1c3)][_0x552d35(0x234)]);throw _0x39e56;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a124_0x25d7cd(0x1e2)])({'transient':!![]}),__metadata(a124_0x25d7cd(0x23c),[salesforce_service_1[a124_0x25d7cd(0x1d7)],commit_components_job_1[a124_0x25d7cd(0x1dc)],salesforce_sync_service_1[a124_0x25d7cd(0x1c2)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;