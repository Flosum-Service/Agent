const a105_0x543723=a105_0x2b43;(function(_0x30ef56,_0x37b081){const _0x5baf47=a105_0x2b43,_0x450c1c=_0x30ef56();while(!![]){try{const _0xb4ee1f=-parseInt(_0x5baf47(0x15b))/0x1+parseInt(_0x5baf47(0x16a))/0x2+parseInt(_0x5baf47(0x16c))/0x3+parseInt(_0x5baf47(0x137))/0x4*(parseInt(_0x5baf47(0x127))/0x5)+-parseInt(_0x5baf47(0x14c))/0x6+-parseInt(_0x5baf47(0x138))/0x7*(-parseInt(_0x5baf47(0x119))/0x8)+-parseInt(_0x5baf47(0x151))/0x9;if(_0xb4ee1f===_0x37b081)break;else _0x450c1c['push'](_0x450c1c['shift']());}catch(_0x2fd505){_0x450c1c['push'](_0x450c1c['shift']());}}}(a105_0x52a8,0xda4be));const a105_0x5f2f45=(function(){let _0x59fada=!![];return function(_0x3388ee,_0x36115f){const _0x5b2f39=_0x59fada?function(){if(_0x36115f){const _0x27b43f=_0x36115f['apply'](_0x3388ee,arguments);return _0x36115f=null,_0x27b43f;}}:function(){};return _0x59fada=![],_0x5b2f39;};}()),a105_0x53c584=a105_0x5f2f45(this,function(){const _0x244dc9=a105_0x2b43;return a105_0x53c584[_0x244dc9(0x13c)]()[_0x244dc9(0x13e)](_0x244dc9(0x152))[_0x244dc9(0x13c)]()[_0x244dc9(0x11f)](a105_0x53c584)['search']('(((.+)+)+)+$');});a105_0x53c584();'use strict';var __decorate=this&&this[a105_0x543723(0x144)]||function(_0x2e8152,_0x4202f3,_0x25489b,_0x152e95){const _0x27d3b8=a105_0x543723;var _0x4943f9=arguments['length'],_0x6627ad=_0x4943f9<0x3?_0x4202f3:_0x152e95===null?_0x152e95=Object[_0x27d3b8(0x16b)](_0x4202f3,_0x25489b):_0x152e95,_0x403e98;if(typeof Reflect===_0x27d3b8(0x168)&&typeof Reflect[_0x27d3b8(0x124)]===_0x27d3b8(0x14e))_0x6627ad=Reflect[_0x27d3b8(0x124)](_0x2e8152,_0x4202f3,_0x25489b,_0x152e95);else{for(var _0x4c41db=_0x2e8152[_0x27d3b8(0x10f)]-0x1;_0x4c41db>=0x0;_0x4c41db--)if(_0x403e98=_0x2e8152[_0x4c41db])_0x6627ad=(_0x4943f9<0x3?_0x403e98(_0x6627ad):_0x4943f9>0x3?_0x403e98(_0x4202f3,_0x25489b,_0x6627ad):_0x403e98(_0x4202f3,_0x25489b))||_0x6627ad;}return _0x4943f9>0x3&&_0x6627ad&&Object[_0x27d3b8(0x120)](_0x4202f3,_0x25489b,_0x6627ad),_0x6627ad;},__metadata=this&&this[a105_0x543723(0x15d)]||function(_0x56f3eb,_0x26577d){const _0x420fd6=a105_0x543723;if(typeof Reflect===_0x420fd6(0x168)&&typeof Reflect[_0x420fd6(0x13f)]==='function')return Reflect[_0x420fd6(0x13f)](_0x56f3eb,_0x26577d);},__importDefault=this&&this['__importDefault']||function(_0x4e01e8){const _0x44540c=a105_0x543723;return _0x4e01e8&&_0x4e01e8[_0x44540c(0x114)]?_0x4e01e8:{'default':_0x4e01e8};},FlosumCommitJob_1;function a105_0x2b43(_0x463fa6,_0x1e1628){const _0x22e3ae=a105_0x52a8();return a105_0x2b43=function(_0x53c584,_0x5f2f45){_0x53c584=_0x53c584-0x107;let _0x52a829=_0x22e3ae[_0x53c584];return _0x52a829;},a105_0x2b43(_0x463fa6,_0x1e1628);}Object[a105_0x543723(0x120)](exports,a105_0x543723(0x114),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;function a105_0x52a8(){const _0x33c3db=['salesforceService','../../../../constants','commitJob','deleteAttachmentId','exec',']\x20[','repositoryData','BadRequestError','commitData','object','In\x20Progress','2106964UtsxrY','getOwnPropertyDescriptor','2972160tQecLn','get','syncBranchId','logger','CommitComponentsJob','syncRepositoryId','gitUrl','gitApiService','run','deleteAttachment','ERR_UNKNOWN_SYNC_RECORD_ID','getComponentsToWrite','[FLOSUM\x20->\x20GIT]\x20[','CommitComponentsDto','length','trim','split','commitAttachmentId','sha','__esModule','repoService','error','\x20Start\x20Flosum\x20commit\x20job.','getBranchRecord','8fxYQVB','Tokens','fetchRepositoryData','shortid','setStatus','../../providers/providers.tokens','constructor','defineProperty','getOne','user','repo','decorate','config','../../../../constants/errors','250WOfdVp','design:paramtypes','getRepositoryRecord','SalesforceSyncService','message','gitProvider','patchObject','SalesforceService','repositoryName','toUpperCase','../../salesforce/services/salesforce.service','default','send','isConvertToSfdx','FlosumCommitJob','components','41036ojKIpT','10149769SgHMwk','Error','FLOSUM_ATTACHMENT',']\x20[Branch:\x20','toString','salesforceSync','search','metadata','../../../../core','log',']\x20[Repository:\x20','Service','__decorate','all','sfLogger','updateRemoteState','prefix','updateLastCommit','\x20Update\x20remote\x20state.','retrieveAttachment','7734228uWVspH','name','function','getComponentsToDelete','branchName','11754468vTQvGm','(((.+)+)+)+$','convertToSFDX','../../../../core/errors/bad-request.error','handleCommitJobError','provider','typedi','getCommitDto','parse','ERR_INVALID_SYNC_RECORD_ID','517887fwPvvx','branch','__metadata','../dto/commit-components.dto'];a105_0x52a8=function(){return _0x33c3db;};return a105_0x52a8();}const core_1=require(a105_0x543723(0x140)),salesforce_service_1=require(a105_0x543723(0x131)),typedi_1=require(a105_0x543723(0x157)),errors_1=require(a105_0x543723(0x126)),bad_request_error_1=require(a105_0x543723(0x154)),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a105_0x543723(0x15e)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a105_0x543723(0x160)),shortid_1=__importDefault(require(a105_0x543723(0x11c))),providers_tokens_1=require(a105_0x543723(0x11e));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x2f453f,_0x2d7c38,_0x3ff53a){const _0x29b67c=a105_0x543723;this[_0x29b67c(0x15f)]=_0x2f453f,this[_0x29b67c(0x161)]=_0x2d7c38,this['salesforceSync']=_0x3ff53a,this[_0x29b67c(0x16f)]=new core_1['Logger'](FlosumCommitJob_1[_0x29b67c(0x14d)]);}async[a105_0x543723(0x11b)](){const _0x387478=a105_0x543723;try{if(this[_0x387478(0x167)][_0x387478(0x171)])this[_0x387478(0x165)]=await this[_0x387478(0x13d)][_0x387478(0x129)](this[_0x387478(0x167)][_0x387478(0x171)]);else this[_0x387478(0x167)][_0x387478(0x16e)]&&(this[_0x387478(0x165)]=await this[_0x387478(0x13d)][_0x387478(0x118)](this[_0x387478(0x167)][_0x387478(0x16e)]));}catch(_0x515408){throw new bad_request_error_1[(_0x387478(0x166))](errors_1[_0x387478(0x15a)]);}}async[a105_0x543723(0x10c)](){const _0x5743a3=a105_0x543723;if(!this['commitData'][_0x5743a3(0x112)])return[];await this[_0x5743a3(0x15f)][_0x5743a3(0x12d)](constants_1[_0x5743a3(0x13a)],this[_0x5743a3(0x167)][_0x5743a3(0x112)],{'Name':(0x0,shortid_1[_0x5743a3(0x132)])()});const _0x237d60=await this[_0x5743a3(0x15f)][_0x5743a3(0x14b)](this[_0x5743a3(0x167)][_0x5743a3(0x112)])['then'](_0x1bd648=>_0x1bd648[_0x5743a3(0x111)]('\x20')['map'](_0x477f80=>_0x477f80[_0x5743a3(0x110)]()));await this[_0x5743a3(0x15f)][_0x5743a3(0x10a)](this[_0x5743a3(0x167)][_0x5743a3(0x112)]);const _0x907588=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x5743a3(0x15f)]);return await _0x907588[_0x5743a3(0x109)](_0x237d60);}async['getComponentsToDelete'](){const _0x13506c=a105_0x543723;if(!this[_0x13506c(0x167)][_0x13506c(0x162)])return[];await this['salesforceService'][_0x13506c(0x12d)](constants_1[_0x13506c(0x13a)],this[_0x13506c(0x167)][_0x13506c(0x162)],{'Name':(0x0,shortid_1[_0x13506c(0x132)])()});const _0x40e377=await this[_0x13506c(0x15f)][_0x13506c(0x14b)](this['commitData'][_0x13506c(0x162)]),_0x3cd6d2=JSON[_0x13506c(0x159)](_0x40e377);return await this[_0x13506c(0x15f)][_0x13506c(0x10a)](this[_0x13506c(0x167)]['deleteAttachmentId']),_0x3cd6d2;}async[a105_0x543723(0x158)](){const _0x263b8d=a105_0x543723,_0x5e9e26=new commit_components_dto_1[(_0x263b8d(0x10e))](),[_0x486561,_0x4eea7b]=await Promise[_0x263b8d(0x145)]([this[_0x263b8d(0x10c)](),this[_0x263b8d(0x14f)]()]);return _0x5e9e26['message']=this[_0x263b8d(0x167)][_0x263b8d(0x12b)],_0x5e9e26[_0x263b8d(0x122)]=this[_0x263b8d(0x167)]['user'],_0x5e9e26[_0x263b8d(0x136)]={'writed':_0x486561,'deleted':_0x4eea7b},_0x5e9e26[_0x263b8d(0x153)]=this[_0x263b8d(0x125)][_0x263b8d(0x134)],_0x5e9e26[_0x263b8d(0x123)]=this['repository'],_0x5e9e26[_0x263b8d(0x15c)]=this['branch'],_0x5e9e26[_0x263b8d(0x156)]=this[_0x263b8d(0x125)][_0x263b8d(0x12c)],_0x5e9e26;}async[a105_0x543723(0x149)](_0x5e3ae4=![]){const _0x4bfc89=a105_0x543723;if(_0x5e3ae4)await this[_0x4bfc89(0x13d)][_0x4bfc89(0x147)](this[_0x4bfc89(0x165)],{});else{const _0x86818f=await this['repository']['branches']['getOne'](this[_0x4bfc89(0x15c)]['name']);this[_0x4bfc89(0x146)][_0x4bfc89(0x141)](this['prefix']+_0x4bfc89(0x14a));const _0x5858d9={[this['repository'][_0x4bfc89(0x107)]]:{'lastCommit':_0x86818f[_0x4bfc89(0x113)]}};await this[_0x4bfc89(0x13d)][_0x4bfc89(0x147)](this[_0x4bfc89(0x165)],_0x5858d9);}}async[a105_0x543723(0x163)](){const _0x2e48b3=a105_0x543723,_0x373f47=await this['getCommitDto']();await this[_0x2e48b3(0x13d)]['setStatus'](this[_0x2e48b3(0x165)],_0x2e48b3(0x169)),await this['commitJob'][_0x2e48b3(0x109)](_0x373f47,this[_0x2e48b3(0x148)]),await this['updateLastCommit'](),await this[_0x2e48b3(0x13d)][_0x2e48b3(0x11d)](this['repositoryData'],'Completed');}async['handleCommitJobError'](_0x123140){const _0x595c6a=a105_0x543723;try{this['sfLogger']['error'](''+_0x123140),await this['sfLogger']['send'](),await this[_0x595c6a(0x149)](!![]),await this[_0x595c6a(0x13d)][_0x595c6a(0x11d)](this[_0x595c6a(0x165)],_0x595c6a(0x139));}catch(_0x52fc47){this[_0x595c6a(0x16f)][_0x595c6a(0x116)](_0x52fc47);}}async['run'](_0xeb4d70){const _0x35b1fd=a105_0x543723;try{this[_0x35b1fd(0x167)]=_0xeb4d70,this[_0x35b1fd(0x108)]=typedi_1['Container'][_0x35b1fd(0x16d)](providers_tokens_1[_0x35b1fd(0x11a)]['gitApiService']),this[_0x35b1fd(0x115)]=typedi_1['Container']['get'](providers_tokens_1['Tokens']['gitRepoService']),this[_0x35b1fd(0x125)]=typedi_1['Container'][_0x35b1fd(0x16d)](providers_tokens_1[_0x35b1fd(0x11a)][_0x35b1fd(0x125)]),await this[_0x35b1fd(0x11b)](),this['repository']=await this[_0x35b1fd(0x115)]['getOne'](this[_0x35b1fd(0x165)]['repositoryName']),this[_0x35b1fd(0x15c)]=await this['repository']['branches'][_0x35b1fd(0x121)](this[_0x35b1fd(0x165)][_0x35b1fd(0x150)]),this[_0x35b1fd(0x146)]=typedi_1['Container'][_0x35b1fd(0x16d)](providers_tokens_1[_0x35b1fd(0x11a)][_0x35b1fd(0x16f)]),this[_0x35b1fd(0x148)]=_0x35b1fd(0x10d)+this[_0x35b1fd(0x125)][_0x35b1fd(0x12c)][_0x35b1fd(0x130)]()+_0x35b1fd(0x142)+this[_0x35b1fd(0x165)][_0x35b1fd(0x12f)]+_0x35b1fd(0x13b)+this[_0x35b1fd(0x165)][_0x35b1fd(0x150)]+_0x35b1fd(0x164)+FlosumCommitJob_1[_0x35b1fd(0x14d)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x35b1fd(0x166))](errors_1[_0x35b1fd(0x10b)]);await this[_0x35b1fd(0x146)][_0x35b1fd(0x141)](this[_0x35b1fd(0x148)]+_0x35b1fd(0x117))[_0x35b1fd(0x133)](),await this[_0x35b1fd(0x163)]()['catch'](_0x5d33a0=>this[_0x35b1fd(0x155)](_0x5d33a0));}catch(_0xfb99fc){this[_0x35b1fd(0x167)]=undefined,this['logger'][_0x35b1fd(0x116)](_0xfb99fc);throw _0xfb99fc;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x543723(0x143)])({'transient':!![]}),__metadata(a105_0x543723(0x128),[salesforce_service_1[a105_0x543723(0x12e)],commit_components_job_1[a105_0x543723(0x170)],salesforce_sync_service_1[a105_0x543723(0x12a)]])],FlosumCommitJob),exports[a105_0x543723(0x135)]=FlosumCommitJob;