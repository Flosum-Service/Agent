const a105_0x38e0d6=a105_0x4ab8;(function(_0x28a3b1,_0x2172a0){const _0x1238b1=a105_0x4ab8,_0x3d9ee2=_0x28a3b1();while(!![]){try{const _0x15b70f=-parseInt(_0x1238b1(0x137))/0x1+parseInt(_0x1238b1(0x183))/0x2+-parseInt(_0x1238b1(0x161))/0x3+parseInt(_0x1238b1(0x17a))/0x4+parseInt(_0x1238b1(0x154))/0x5+-parseInt(_0x1238b1(0x158))/0x6+-parseInt(_0x1238b1(0x18a))/0x7*(-parseInt(_0x1238b1(0x184))/0x8);if(_0x15b70f===_0x2172a0)break;else _0x3d9ee2['push'](_0x3d9ee2['shift']());}catch(_0x38b0e6){_0x3d9ee2['push'](_0x3d9ee2['shift']());}}}(a105_0x4c80,0x5c430));const a105_0x3cf8cc=(function(){let _0x436a54=!![];return function(_0x500435,_0x2c5426){const _0x53616f=_0x436a54?function(){if(_0x2c5426){const _0x2eb17c=_0x2c5426['apply'](_0x500435,arguments);return _0x2c5426=null,_0x2eb17c;}}:function(){};return _0x436a54=![],_0x53616f;};}()),a105_0x50e323=a105_0x3cf8cc(this,function(){const _0x449bd3=a105_0x4ab8;return a105_0x50e323[_0x449bd3(0x17e)]()[_0x449bd3(0x193)](_0x449bd3(0x182))[_0x449bd3(0x17e)]()[_0x449bd3(0x150)](a105_0x50e323)['search'](_0x449bd3(0x182));});a105_0x50e323();'use strict';var __decorate=this&&this[a105_0x38e0d6(0x172)]||function(_0x59553f,_0xb44c44,_0x5c07f2,_0x277ca9){const _0x143dd3=a105_0x38e0d6;var _0x4ae64c=arguments[_0x143dd3(0x18d)],_0x338828=_0x4ae64c<0x3?_0xb44c44:_0x277ca9===null?_0x277ca9=Object[_0x143dd3(0x14d)](_0xb44c44,_0x5c07f2):_0x277ca9,_0x45484d;if(typeof Reflect===_0x143dd3(0x157)&&typeof Reflect[_0x143dd3(0x134)]===_0x143dd3(0x17b))_0x338828=Reflect['decorate'](_0x59553f,_0xb44c44,_0x5c07f2,_0x277ca9);else{for(var _0x3f4e6b=_0x59553f[_0x143dd3(0x18d)]-0x1;_0x3f4e6b>=0x0;_0x3f4e6b--)if(_0x45484d=_0x59553f[_0x3f4e6b])_0x338828=(_0x4ae64c<0x3?_0x45484d(_0x338828):_0x4ae64c>0x3?_0x45484d(_0xb44c44,_0x5c07f2,_0x338828):_0x45484d(_0xb44c44,_0x5c07f2))||_0x338828;}return _0x4ae64c>0x3&&_0x338828&&Object[_0x143dd3(0x15f)](_0xb44c44,_0x5c07f2,_0x338828),_0x338828;},__metadata=this&&this['__metadata']||function(_0x456c8c,_0x2c99e7){const _0x249a00=a105_0x38e0d6;if(typeof Reflect===_0x249a00(0x157)&&typeof Reflect[_0x249a00(0x15c)]===_0x249a00(0x17b))return Reflect['metadata'](_0x456c8c,_0x2c99e7);},__importDefault=this&&this[a105_0x38e0d6(0x16d)]||function(_0x35bb2a){const _0x325ee8=a105_0x38e0d6;return _0x35bb2a&&_0x35bb2a[_0x325ee8(0x178)]?_0x35bb2a:{'default':_0x35bb2a};},FlosumCommitJob_1;function a105_0x4c80(){const _0x2d302f=['(((.+)+)+)+$','344764KZYMqa','16vKFfOf','../../salesforce/services/salesforce.service','error','../../../../core/errors/bad-request.error','../../../../core','trim','1666777DZzREk','syncRepositoryId','ERR_INVALID_SYNC_RECORD_ID','length','get','deleteAttachmentId',']\x20[','repositoryData','Completed','search','Service','exec','FLOSUM_ATTACHMENT','getBranchRecord','gitProvider','commitData','FlosumCommitJob','getOne','catch','gitRepoService','decorate','provider','../../providers/providers.tokens','435738utxnix','branches','\x20Update\x20remote\x20state.','sfLogger','getRepositoryRecord','commitAttachmentId','SalesforceRetrieverService','design:paramtypes','commitJob','setStatus','typedi','../dto/commit-components.dto','branchName','../../../../constants','toUpperCase','../../salesforce/services/salesforce-retriever.service','convertToSFDX','repo','CommitComponentsDto','[FLOSUM\x20->\x20GIT]\x20[','name','prefix','getOwnPropertyDescriptor','logger','fetchRepositoryData','constructor','BadRequestError','patchObject','CommitComponentsJob','2111625ITrxyd','gitApiService','salesforceSync','object','1476414ijYLpt','run','repositoryName','getComponentsToWrite','metadata','getCommitDto',']\x20[Branch:\x20','defineProperty','config','2239107LIihjL','\x20Start\x20Flosum\x20commit\x20job.','isConvertToSfdx','Tokens','message','repository','send','In\x20Progress','../../salesforce/services/salesforce-sync.service','retrieveAttachment','Container','SalesforceSyncService','__importDefault','syncBranchId','branch','split','log','__decorate','../../../../constants/errors','Logger','handleCommitJobError','salesforceService','updateRemoteState','__esModule','user','2940604qrvkqA','function','repoService','components','toString','then','default','updateLastCommit'];a105_0x4c80=function(){return _0x2d302f;};return a105_0x4c80();}Object[a105_0x38e0d6(0x15f)](exports,'__esModule',{'value':!![]}),exports[a105_0x38e0d6(0x19a)]=void 0x0;const core_1=require(a105_0x38e0d6(0x188)),salesforce_service_1=require(a105_0x38e0d6(0x185)),typedi_1=require(a105_0x38e0d6(0x141)),errors_1=require(a105_0x38e0d6(0x173)),bad_request_error_1=require(a105_0x38e0d6(0x187)),salesforce_retriever_service_1=require(a105_0x38e0d6(0x146)),salesforce_sync_service_1=require(a105_0x38e0d6(0x169)),commit_components_dto_1=require(a105_0x38e0d6(0x142)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a105_0x38e0d6(0x144)),shortid_1=__importDefault(require('shortid')),providers_tokens_1=require(a105_0x38e0d6(0x136));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x5e6cb4,_0x508eac,_0x50e231){const _0x1a0bf5=a105_0x38e0d6;this[_0x1a0bf5(0x176)]=_0x5e6cb4,this[_0x1a0bf5(0x13f)]=_0x508eac,this[_0x1a0bf5(0x156)]=_0x50e231,this[_0x1a0bf5(0x14e)]=new core_1[(_0x1a0bf5(0x174))](FlosumCommitJob_1[_0x1a0bf5(0x14b)]);}async[a105_0x38e0d6(0x14f)](){const _0x5a789f=a105_0x38e0d6;try{if(this[_0x5a789f(0x199)][_0x5a789f(0x18b)])this['repositoryData']=await this['salesforceSync'][_0x5a789f(0x13b)](this['commitData'][_0x5a789f(0x18b)]);else this['commitData'][_0x5a789f(0x16e)]&&(this[_0x5a789f(0x191)]=await this[_0x5a789f(0x156)][_0x5a789f(0x197)](this[_0x5a789f(0x199)][_0x5a789f(0x16e)]));}catch(_0x414a2e){throw new bad_request_error_1[(_0x5a789f(0x151))](errors_1[_0x5a789f(0x18c)]);}}async['getComponentsToWrite'](){const _0x54e280=a105_0x38e0d6;if(!this[_0x54e280(0x199)][_0x54e280(0x13c)])return[];await this[_0x54e280(0x176)][_0x54e280(0x152)](constants_1['FLOSUM_ATTACHMENT'],this[_0x54e280(0x199)][_0x54e280(0x13c)],{'Name':(0x0,shortid_1['default'])()});const _0x3dfbde=await this['salesforceService'][_0x54e280(0x16a)](this[_0x54e280(0x199)][_0x54e280(0x13c)])[_0x54e280(0x17f)](_0x17b042=>_0x17b042[_0x54e280(0x170)]('\x20')['map'](_0x582afc=>_0x582afc[_0x54e280(0x189)]()));await this['salesforceService']['deleteAttachment'](this[_0x54e280(0x199)][_0x54e280(0x13c)]);const _0x41a228=new salesforce_retriever_service_1[(_0x54e280(0x13d))](this[_0x54e280(0x176)]);return await _0x41a228[_0x54e280(0x159)](_0x3dfbde);}async['getComponentsToDelete'](){const _0xf0c610=a105_0x38e0d6;if(!this[_0xf0c610(0x199)][_0xf0c610(0x18f)])return[];await this[_0xf0c610(0x176)][_0xf0c610(0x152)](constants_1[_0xf0c610(0x196)],this[_0xf0c610(0x199)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0xf0c610(0x180)])()});const _0x5db1f3=await this[_0xf0c610(0x176)][_0xf0c610(0x16a)](this['commitData'][_0xf0c610(0x18f)]),_0x3f93c2=JSON['parse'](_0x5db1f3);return await this['salesforceService']['deleteAttachment'](this['commitData'][_0xf0c610(0x18f)]),_0x3f93c2;}async[a105_0x38e0d6(0x15d)](){const _0xdcd7d6=a105_0x38e0d6,_0x32d4e3=new commit_components_dto_1[(_0xdcd7d6(0x149))](),[_0x521566,_0x587929]=await Promise['all']([this[_0xdcd7d6(0x15b)](),this['getComponentsToDelete']()]);return _0x32d4e3[_0xdcd7d6(0x165)]=this[_0xdcd7d6(0x199)][_0xdcd7d6(0x165)],_0x32d4e3[_0xdcd7d6(0x179)]=this[_0xdcd7d6(0x199)][_0xdcd7d6(0x179)],_0x32d4e3[_0xdcd7d6(0x17d)]={'writed':_0x521566,'deleted':_0x587929},_0x32d4e3[_0xdcd7d6(0x147)]=this[_0xdcd7d6(0x160)][_0xdcd7d6(0x163)],_0x32d4e3[_0xdcd7d6(0x148)]=this['repository'],_0x32d4e3[_0xdcd7d6(0x16f)]=this['branch'],_0x32d4e3[_0xdcd7d6(0x135)]=this[_0xdcd7d6(0x160)][_0xdcd7d6(0x198)],_0x32d4e3;}async[a105_0x38e0d6(0x181)](_0x453e74=![]){const _0x296c9=a105_0x38e0d6;if(_0x453e74)await this['salesforceSync']['updateRemoteState'](this[_0x296c9(0x191)],{});else{const _0x289262=await this[_0x296c9(0x166)][_0x296c9(0x138)][_0x296c9(0x19b)](this['branch'][_0x296c9(0x14b)]);this[_0x296c9(0x13a)][_0x296c9(0x171)](this['prefix']+_0x296c9(0x139));const _0x475ab7={[this['repository']['gitUrl']]:{'lastCommit':_0x289262['sha']}};await this[_0x296c9(0x156)][_0x296c9(0x177)](this[_0x296c9(0x191)],_0x475ab7);}}async[a105_0x38e0d6(0x195)](){const _0x1b44ae=a105_0x38e0d6,_0x2686f3=await this[_0x1b44ae(0x15d)]();await this[_0x1b44ae(0x156)][_0x1b44ae(0x140)](this[_0x1b44ae(0x191)],_0x1b44ae(0x168)),await this['commitJob']['run'](_0x2686f3,this['prefix']),await this[_0x1b44ae(0x181)](),await this[_0x1b44ae(0x156)][_0x1b44ae(0x140)](this[_0x1b44ae(0x191)],_0x1b44ae(0x192));}async[a105_0x38e0d6(0x175)](_0x414048){const _0xcd909=a105_0x38e0d6;try{this[_0xcd909(0x13a)]['error'](''+_0x414048),await this[_0xcd909(0x13a)]['send'](),await this['updateLastCommit'](!![]),await this[_0xcd909(0x156)][_0xcd909(0x140)](this['repositoryData'],'Error');}catch(_0xfb7755){this[_0xcd909(0x14e)][_0xcd909(0x186)](_0xfb7755);}}async['run'](_0x2571df){const _0x24c2e6=a105_0x38e0d6;try{this[_0x24c2e6(0x199)]=_0x2571df,this[_0x24c2e6(0x155)]=typedi_1['Container'][_0x24c2e6(0x18e)](providers_tokens_1[_0x24c2e6(0x164)]['gitApiService']),this[_0x24c2e6(0x17c)]=typedi_1[_0x24c2e6(0x16b)]['get'](providers_tokens_1['Tokens'][_0x24c2e6(0x133)]),this[_0x24c2e6(0x160)]=typedi_1['Container'][_0x24c2e6(0x18e)](providers_tokens_1[_0x24c2e6(0x164)]['config']),await this['fetchRepositoryData'](),this[_0x24c2e6(0x166)]=await this[_0x24c2e6(0x17c)][_0x24c2e6(0x19b)](this[_0x24c2e6(0x191)][_0x24c2e6(0x15a)]),this['branch']=await this[_0x24c2e6(0x166)][_0x24c2e6(0x138)][_0x24c2e6(0x19b)](this[_0x24c2e6(0x191)][_0x24c2e6(0x143)]),this[_0x24c2e6(0x13a)]=typedi_1[_0x24c2e6(0x16b)][_0x24c2e6(0x18e)](providers_tokens_1['Tokens'][_0x24c2e6(0x14e)]),this[_0x24c2e6(0x14c)]=_0x24c2e6(0x14a)+this[_0x24c2e6(0x160)]['gitProvider'][_0x24c2e6(0x145)]()+']\x20[Repository:\x20'+this[_0x24c2e6(0x191)][_0x24c2e6(0x15a)]+_0x24c2e6(0x15e)+this[_0x24c2e6(0x191)]['branchName']+_0x24c2e6(0x190)+FlosumCommitJob_1[_0x24c2e6(0x14b)]+']';if(!this[_0x24c2e6(0x191)])throw new bad_request_error_1[(_0x24c2e6(0x151))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x24c2e6(0x13a)][_0x24c2e6(0x171)](this[_0x24c2e6(0x14c)]+_0x24c2e6(0x162))[_0x24c2e6(0x167)](),await this[_0x24c2e6(0x195)]()[_0x24c2e6(0x132)](_0x2595c0=>this[_0x24c2e6(0x175)](_0x2595c0));}catch(_0x1ac5c4){this[_0x24c2e6(0x199)]=undefined,this[_0x24c2e6(0x14e)][_0x24c2e6(0x186)](_0x1ac5c4);throw _0x1ac5c4;}}};function a105_0x4ab8(_0x17fcfd,_0x345a6d){const _0x441cb0=a105_0x4c80();return a105_0x4ab8=function(_0x50e323,_0x3cf8cc){_0x50e323=_0x50e323-0x132;let _0x4c8060=_0x441cb0[_0x50e323];return _0x4c8060;},a105_0x4ab8(_0x17fcfd,_0x345a6d);}FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x38e0d6(0x194)])({'transient':!![]}),__metadata(a105_0x38e0d6(0x13e),[salesforce_service_1['SalesforceService'],commit_components_job_1[a105_0x38e0d6(0x153)],salesforce_sync_service_1[a105_0x38e0d6(0x16c)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;