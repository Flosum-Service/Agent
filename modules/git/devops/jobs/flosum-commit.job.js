const a105_0x39604b=a105_0xd4aa;(function(_0x2ec7ab,_0x175d67){const _0x39e39f=a105_0xd4aa,_0x329832=_0x2ec7ab();while(!![]){try{const _0x581283=-parseInt(_0x39e39f(0xae))/0x1*(parseInt(_0x39e39f(0xb9))/0x2)+-parseInt(_0x39e39f(0xb7))/0x3*(parseInt(_0x39e39f(0xe9))/0x4)+-parseInt(_0x39e39f(0xe3))/0x5*(-parseInt(_0x39e39f(0xd1))/0x6)+-parseInt(_0x39e39f(0xc4))/0x7*(-parseInt(_0x39e39f(0xaa))/0x8)+parseInt(_0x39e39f(0x8f))/0x9*(parseInt(_0x39e39f(0x8a))/0xa)+parseInt(_0x39e39f(0x9a))/0xb+parseInt(_0x39e39f(0xa5))/0xc*(parseInt(_0x39e39f(0xce))/0xd);if(_0x581283===_0x175d67)break;else _0x329832['push'](_0x329832['shift']());}catch(_0x1a992a){_0x329832['push'](_0x329832['shift']());}}}(a105_0x196f,0x4fef7));const a105_0x22ba4b=(function(){let _0x1ec185=!![];return function(_0x48427a,_0xb6a77b){const _0x22fdd1=_0x1ec185?function(){const _0x2a3aa5=a105_0xd4aa;if(_0xb6a77b){const _0x33ff52=_0xb6a77b[_0x2a3aa5(0xa7)](_0x48427a,arguments);return _0xb6a77b=null,_0x33ff52;}}:function(){};return _0x1ec185=![],_0x22fdd1;};}()),a105_0x1b3b5b=a105_0x22ba4b(this,function(){const _0x38deda=a105_0xd4aa;return a105_0x1b3b5b['toString']()[_0x38deda(0xc5)](_0x38deda(0xa3))[_0x38deda(0xc2)]()[_0x38deda(0xd8)](a105_0x1b3b5b)[_0x38deda(0xc5)](_0x38deda(0xa3));});a105_0x1b3b5b();'use strict';function a105_0x196f(){const _0x38928e=['getOne','getComponentsToDelete','error','patchObject','3iCYlvm','handleCommitJobError','367408zSHiaR','\x20Start\x20Flosum\x20commit\x20job.','\x20Update\x20remote\x20state.','updateRemoteState','defineProperty','logger','getOwnPropertyDescriptor','repoService','Completed','toString','design:paramtypes','182pwUzZr','search','setStatus','../../salesforce/services/salesforce-sync.service','../../salesforce/services/salesforce-retriever.service','salesforceSync','Service','__importDefault','getCommitDto','../../../../core/errors/bad-request.error','1911DsjjrJ','repositoryData','length','36cAFjPb','run','object','exec','updateLastCommit','then','../dto/commit-components.dto','constructor','gitApiService','syncRepositoryId','fetchRepositoryData','In\x20Progress','commitAttachmentId','convertToSFDX','gitUrl','../../salesforce/services/salesforce.service','typedi','Container','147360DOvWoU','split','BadRequestError','CommitComponentsDto','ERR_INVALID_SYNC_RECORD_ID','user','1994764YEQHsE','../../providers/providers.tokens','salesforceService','[FLOSUM\x20->\x20GIT]\x20[','branch',']\x20[','prefix','commitData','../../../../core','shortid','../../../../constants','send','gitRepoService','SalesforceRetrieverService','FlosumCommitJob','trim','../../../../constants/errors','getRepositoryRecord','toUpperCase','42980WilQjU','branchName','decorate','provider','repo','270ZdzkZr','log','message','branches','map','sha','isConvertToSfdx','get','repositoryName','deleteAttachmentId','repository','4265965jSggkW','SalesforceService','gitProvider','config','commitJob','name','sfLogger','getBranchRecord','retrieveAttachment','(((.+)+)+)+$','FLOSUM_ATTACHMENT','16452wGwOTA','function','apply','ERR_UNKNOWN_SYNC_RECORD_ID','syncBranchId','35288PnJcfo','Tokens','catch','deleteAttachment','1hyeayy','__decorate',']\x20[Repository:\x20','default','components'];a105_0x196f=function(){return _0x38928e;};return a105_0x196f();}var __decorate=this&&this[a105_0x39604b(0xaf)]||function(_0x45e3cc,_0x569a70,_0x4b979f,_0x4988ef){const _0x6c0c09=a105_0x39604b;var _0x3ec7f3=arguments['length'],_0x1d2c9d=_0x3ec7f3<0x3?_0x569a70:_0x4988ef===null?_0x4988ef=Object[_0x6c0c09(0xbf)](_0x569a70,_0x4b979f):_0x4988ef,_0x51cc34;if(typeof Reflect===_0x6c0c09(0xd3)&&typeof Reflect[_0x6c0c09(0x8c)]==='function')_0x1d2c9d=Reflect[_0x6c0c09(0x8c)](_0x45e3cc,_0x569a70,_0x4b979f,_0x4988ef);else{for(var _0x522af2=_0x45e3cc[_0x6c0c09(0xd0)]-0x1;_0x522af2>=0x0;_0x522af2--)if(_0x51cc34=_0x45e3cc[_0x522af2])_0x1d2c9d=(_0x3ec7f3<0x3?_0x51cc34(_0x1d2c9d):_0x3ec7f3>0x3?_0x51cc34(_0x569a70,_0x4b979f,_0x1d2c9d):_0x51cc34(_0x569a70,_0x4b979f))||_0x1d2c9d;}return _0x3ec7f3>0x3&&_0x1d2c9d&&Object[_0x6c0c09(0xbd)](_0x569a70,_0x4b979f,_0x1d2c9d),_0x1d2c9d;},__metadata=this&&this['__metadata']||function(_0xa11573,_0x489597){const _0x495ac3=a105_0x39604b;if(typeof Reflect===_0x495ac3(0xd3)&&typeof Reflect['metadata']===_0x495ac3(0xa6))return Reflect['metadata'](_0xa11573,_0x489597);},__importDefault=this&&this[a105_0x39604b(0xcb)]||function(_0x36c057){return _0x36c057&&_0x36c057['__esModule']?_0x36c057:{'default':_0x36c057};},FlosumCommitJob_1;Object[a105_0x39604b(0xbd)](exports,'__esModule',{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a105_0x39604b(0x7f)),salesforce_service_1=require(a105_0x39604b(0xe0)),typedi_1=require(a105_0x39604b(0xe1)),errors_1=require(a105_0x39604b(0x87)),bad_request_error_1=require(a105_0x39604b(0xcd)),salesforce_retriever_service_1=require(a105_0x39604b(0xc8)),salesforce_sync_service_1=require(a105_0x39604b(0xc7)),commit_components_dto_1=require(a105_0x39604b(0xd7)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a105_0x39604b(0x81)),shortid_1=__importDefault(require(a105_0x39604b(0x80))),providers_tokens_1=require(a105_0x39604b(0xea));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0xea6421,_0x4725f3,_0x29b031){const _0x5ede21=a105_0x39604b;this[_0x5ede21(0xeb)]=_0xea6421,this[_0x5ede21(0x9e)]=_0x4725f3,this[_0x5ede21(0xc9)]=_0x29b031,this[_0x5ede21(0xbe)]=new core_1['Logger'](FlosumCommitJob_1[_0x5ede21(0x9f)]);}async[a105_0x39604b(0xdb)](){const _0x5f6e86=a105_0x39604b;try{if(this[_0x5f6e86(0x7e)]['syncRepositoryId'])this[_0x5f6e86(0xcf)]=await this['salesforceSync'][_0x5f6e86(0x88)](this[_0x5f6e86(0x7e)][_0x5f6e86(0xda)]);else this[_0x5f6e86(0x7e)][_0x5f6e86(0xa9)]&&(this['repositoryData']=await this[_0x5f6e86(0xc9)][_0x5f6e86(0xa1)](this[_0x5f6e86(0x7e)][_0x5f6e86(0xa9)]));}catch(_0x5e2c25){throw new bad_request_error_1[(_0x5f6e86(0xe5))](errors_1[_0x5f6e86(0xe7)]);}}async['getComponentsToWrite'](){const _0x15f732=a105_0x39604b;if(!this[_0x15f732(0x7e)][_0x15f732(0xdd)])return[];await this[_0x15f732(0xeb)]['patchObject'](constants_1[_0x15f732(0xa4)],this[_0x15f732(0x7e)][_0x15f732(0xdd)],{'Name':(0x0,shortid_1[_0x15f732(0xb1)])()});const _0x78cbfc=await this[_0x15f732(0xeb)][_0x15f732(0xa2)](this[_0x15f732(0x7e)]['commitAttachmentId'])[_0x15f732(0xd6)](_0x4c7811=>_0x4c7811[_0x15f732(0xe4)]('\x20')[_0x15f732(0x93)](_0x443d5d=>_0x443d5d[_0x15f732(0x86)]()));await this['salesforceService']['deleteAttachment'](this[_0x15f732(0x7e)]['commitAttachmentId']);const _0x15f502=new salesforce_retriever_service_1[(_0x15f732(0x84))](this[_0x15f732(0xeb)]);return await _0x15f502[_0x15f732(0xd2)](_0x78cbfc);}async[a105_0x39604b(0xb4)](){const _0x3e5453=a105_0x39604b;if(!this[_0x3e5453(0x7e)][_0x3e5453(0x98)])return[];await this[_0x3e5453(0xeb)][_0x3e5453(0xb6)](constants_1[_0x3e5453(0xa4)],this[_0x3e5453(0x7e)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0x3e5453(0xb1)])()});const _0x1431d8=await this[_0x3e5453(0xeb)][_0x3e5453(0xa2)](this[_0x3e5453(0x7e)]['deleteAttachmentId']);return await this[_0x3e5453(0xeb)][_0x3e5453(0xad)](this[_0x3e5453(0x7e)]['deleteAttachmentId']),_0x1431d8;}async[a105_0x39604b(0xcc)](){const _0x35e0e5=a105_0x39604b,_0x5982fc=new commit_components_dto_1[(_0x35e0e5(0xe6))](),[_0x399d69,_0x5c184f]=await Promise['all']([this['getComponentsToWrite'](),this[_0x35e0e5(0xb4)]()]);return _0x5982fc[_0x35e0e5(0x91)]=this[_0x35e0e5(0x7e)][_0x35e0e5(0x91)],_0x5982fc[_0x35e0e5(0xe8)]=this[_0x35e0e5(0x7e)][_0x35e0e5(0xe8)],_0x5982fc[_0x35e0e5(0xb2)]={'writed':_0x399d69,'deleted':_0x5c184f},_0x5982fc[_0x35e0e5(0xde)]=this[_0x35e0e5(0x9d)][_0x35e0e5(0x95)],_0x5982fc[_0x35e0e5(0x8e)]=this['repository'],_0x5982fc['branch']=this[_0x35e0e5(0xed)],_0x5982fc[_0x35e0e5(0x8d)]=this[_0x35e0e5(0x9d)][_0x35e0e5(0x9c)],_0x5982fc;}async[a105_0x39604b(0xd5)](_0x140381=![]){const _0xca12a4=a105_0x39604b;if(_0x140381)await this['salesforceSync']['updateRemoteState'](this[_0xca12a4(0xcf)],{});else{const _0x539095=await this[_0xca12a4(0x99)][_0xca12a4(0x92)][_0xca12a4(0xb3)](this[_0xca12a4(0xed)]['name']);this['sfLogger'][_0xca12a4(0x90)](this[_0xca12a4(0x7d)]+_0xca12a4(0xbb));const _0x24c45b={[this['repository'][_0xca12a4(0xdf)]]:{'lastCommit':_0x539095[_0xca12a4(0x94)]}};await this[_0xca12a4(0xc9)][_0xca12a4(0xbc)](this['repositoryData'],_0x24c45b);}}async[a105_0x39604b(0xd4)](){const _0x24cc09=a105_0x39604b,_0x49a743=await this['getCommitDto']();await this[_0x24cc09(0xc9)][_0x24cc09(0xc6)](this[_0x24cc09(0xcf)],_0x24cc09(0xdc)),await this['commitJob'][_0x24cc09(0xd2)](_0x49a743,this[_0x24cc09(0x7d)]),await this[_0x24cc09(0xd5)](),await this[_0x24cc09(0xc9)]['setStatus'](this[_0x24cc09(0xcf)],_0x24cc09(0xc1));}async[a105_0x39604b(0xb8)](_0x2a2047){const _0x4302a8=a105_0x39604b;try{this[_0x4302a8(0xa0)]['error'](''+_0x2a2047),await this['sfLogger'][_0x4302a8(0x82)](),await this[_0x4302a8(0xd5)](!![]),await this[_0x4302a8(0xc9)][_0x4302a8(0xc6)](this[_0x4302a8(0xcf)],'Error');}catch(_0xec0fd8){this[_0x4302a8(0xbe)][_0x4302a8(0xb5)](_0xec0fd8);}}async[a105_0x39604b(0xd2)](_0x3ff888){const _0x88917b=a105_0x39604b;try{this[_0x88917b(0x7e)]=_0x3ff888,this[_0x88917b(0xd9)]=typedi_1['Container'][_0x88917b(0x96)](providers_tokens_1[_0x88917b(0xab)][_0x88917b(0xd9)]),this[_0x88917b(0xc0)]=typedi_1[_0x88917b(0xe2)]['get'](providers_tokens_1[_0x88917b(0xab)][_0x88917b(0x83)]),this[_0x88917b(0x9d)]=typedi_1[_0x88917b(0xe2)]['get'](providers_tokens_1[_0x88917b(0xab)][_0x88917b(0x9d)]),await this[_0x88917b(0xdb)](),this[_0x88917b(0x99)]=await this[_0x88917b(0xc0)][_0x88917b(0xb3)](this[_0x88917b(0xcf)][_0x88917b(0x97)]),this[_0x88917b(0xed)]=await this[_0x88917b(0x99)]['branches']['getOne'](this[_0x88917b(0xcf)][_0x88917b(0x8b)]),this[_0x88917b(0xa0)]=typedi_1[_0x88917b(0xe2)]['get'](providers_tokens_1[_0x88917b(0xab)]['logger']),this['prefix']=_0x88917b(0xec)+this[_0x88917b(0x9d)][_0x88917b(0x9c)][_0x88917b(0x89)]()+_0x88917b(0xb0)+this[_0x88917b(0xcf)][_0x88917b(0x97)]+']\x20[Branch:\x20'+this['repositoryData'][_0x88917b(0x8b)]+_0x88917b(0x7c)+FlosumCommitJob_1['name']+']';if(!this[_0x88917b(0xcf)])throw new bad_request_error_1[(_0x88917b(0xe5))](errors_1[_0x88917b(0xa8)]);await this[_0x88917b(0xa0)][_0x88917b(0x90)](this['prefix']+_0x88917b(0xba))[_0x88917b(0x82)](),await this['exec']()[_0x88917b(0xac)](_0x592c75=>this[_0x88917b(0xb8)](_0x592c75));}catch(_0x405577){this[_0x88917b(0x7e)]=undefined,this['logger'][_0x88917b(0xb5)](_0x405577);throw _0x405577;}}};function a105_0xd4aa(_0x17f06a,_0x3f8b8b){const _0x1a7bed=a105_0x196f();return a105_0xd4aa=function(_0x1b3b5b,_0x22ba4b){_0x1b3b5b=_0x1b3b5b-0x7c;let _0x196f78=_0x1a7bed[_0x1b3b5b];return _0x196f78;},a105_0xd4aa(_0x17f06a,_0x3f8b8b);}FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x39604b(0xca)])({'transient':!![]}),__metadata(a105_0x39604b(0xc3),[salesforce_service_1[a105_0x39604b(0x9b)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a105_0x39604b(0x85)]=FlosumCommitJob;