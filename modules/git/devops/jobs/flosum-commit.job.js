const a74_0x13b823=a74_0x5174;function a74_0x5174(_0x297a62,_0x360566){const _0x4e6057=a74_0x2f5f();return a74_0x5174=function(_0x2bd890,_0x3a8219){_0x2bd890=_0x2bd890-0xa8;let _0x2f5f72=_0x4e6057[_0x2bd890];return _0x2f5f72;},a74_0x5174(_0x297a62,_0x360566);}(function(_0x28125e,_0x45291b){const _0x1a23b4=a74_0x5174,_0x5a2c27=_0x28125e();while(!![]){try{const _0x14903e=parseInt(_0x1a23b4(0xda))/0x1*(-parseInt(_0x1a23b4(0xef))/0x2)+-parseInt(_0x1a23b4(0xaa))/0x3*(-parseInt(_0x1a23b4(0xcc))/0x4)+parseInt(_0x1a23b4(0x103))/0x5+parseInt(_0x1a23b4(0xea))/0x6*(-parseInt(_0x1a23b4(0xdc))/0x7)+-parseInt(_0x1a23b4(0xf9))/0x8*(-parseInt(_0x1a23b4(0xb6))/0x9)+parseInt(_0x1a23b4(0xe7))/0xa*(parseInt(_0x1a23b4(0x106))/0xb)+-parseInt(_0x1a23b4(0xfe))/0xc*(parseInt(_0x1a23b4(0xfb))/0xd);if(_0x14903e===_0x45291b)break;else _0x5a2c27['push'](_0x5a2c27['shift']());}catch(_0x5d18f6){_0x5a2c27['push'](_0x5a2c27['shift']());}}}(a74_0x2f5f,0xde647));const a74_0x3a8219=(function(){let _0x4e22b7=!![];return function(_0x10f378,_0x4f0124){const _0x1d62e1=_0x4e22b7?function(){const _0x5f40b8=a74_0x5174;if(_0x4f0124){const _0x13507e=_0x4f0124[_0x5f40b8(0xb4)](_0x10f378,arguments);return _0x4f0124=null,_0x13507e;}}:function(){};return _0x4e22b7=![],_0x1d62e1;};}()),a74_0x2bd890=a74_0x3a8219(this,function(){const _0x12cb72=a74_0x5174;return a74_0x2bd890[_0x12cb72(0xb9)]()[_0x12cb72(0xb3)](_0x12cb72(0xd5))[_0x12cb72(0xb9)]()['constructor'](a74_0x2bd890)[_0x12cb72(0xb3)](_0x12cb72(0xd5));});a74_0x2bd890();'use strict';var __decorate=this&&this['__decorate']||function(_0x4a8329,_0x4f296c,_0xd315d1,_0x267ce4){const _0x31273d=a74_0x5174;var _0x492cf0=arguments[_0x31273d(0xee)],_0x3b40b2=_0x492cf0<0x3?_0x4f296c:_0x267ce4===null?_0x267ce4=Object[_0x31273d(0xb1)](_0x4f296c,_0xd315d1):_0x267ce4,_0x5a221a;if(typeof Reflect===_0x31273d(0xb7)&&typeof Reflect[_0x31273d(0xc4)]===_0x31273d(0xdf))_0x3b40b2=Reflect[_0x31273d(0xc4)](_0x4a8329,_0x4f296c,_0xd315d1,_0x267ce4);else{for(var _0x3d91fc=_0x4a8329[_0x31273d(0xee)]-0x1;_0x3d91fc>=0x0;_0x3d91fc--)if(_0x5a221a=_0x4a8329[_0x3d91fc])_0x3b40b2=(_0x492cf0<0x3?_0x5a221a(_0x3b40b2):_0x492cf0>0x3?_0x5a221a(_0x4f296c,_0xd315d1,_0x3b40b2):_0x5a221a(_0x4f296c,_0xd315d1))||_0x3b40b2;}return _0x492cf0>0x3&&_0x3b40b2&&Object[_0x31273d(0x10e)](_0x4f296c,_0xd315d1,_0x3b40b2),_0x3b40b2;},__metadata=this&&this['__metadata']||function(_0x158c87,_0x110d3a){const _0x35201e=a74_0x5174;if(typeof Reflect===_0x35201e(0xb7)&&typeof Reflect[_0x35201e(0xb0)]===_0x35201e(0xdf))return Reflect[_0x35201e(0xb0)](_0x158c87,_0x110d3a);},__importDefault=this&&this['__importDefault']||function(_0x41f2c9){const _0x20f164=a74_0x5174;return _0x41f2c9&&_0x41f2c9[_0x20f164(0x110)]?_0x41f2c9:{'default':_0x41f2c9};},FlosumCommitJob_1;Object['defineProperty'](exports,a74_0x13b823(0x110),{'value':!![]}),exports[a74_0x13b823(0xcd)]=void 0x0;const core_1=require('../../../../core'),salesforce_service_1=require(a74_0x13b823(0xe6)),typedi_1=require(a74_0x13b823(0x105)),errors_1=require('../../../../constants/errors'),bad_request_error_1=require(a74_0x13b823(0xca)),salesforce_retriever_service_1=require(a74_0x13b823(0xe5)),salesforce_sync_service_1=require(a74_0x13b823(0xab)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a74_0x13b823(0xf0)),constants_1=require(a74_0x13b823(0x101)),shortid_1=__importDefault(require(a74_0x13b823(0xd9))),providers_tokens_1=require(a74_0x13b823(0xac));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x46013e,_0x1a4da8,_0x5dd13b){const _0x5e82bf=a74_0x13b823;this[_0x5e82bf(0xc6)]=_0x46013e,this[_0x5e82bf(0xc1)]=_0x1a4da8,this['salesforceSync']=_0x5dd13b,this[_0x5e82bf(0xd1)]=new core_1[(_0x5e82bf(0x10c))](FlosumCommitJob_1[_0x5e82bf(0xcf)]);}async['fetchRepositoryData'](){const _0x25c201=a74_0x13b823;try{if(this[_0x25c201(0xeb)][_0x25c201(0x108)])this[_0x25c201(0xfd)]=await this[_0x25c201(0xde)][_0x25c201(0x102)](this[_0x25c201(0xeb)]['syncRepositoryId']);else this[_0x25c201(0xeb)]['syncBranchId']&&(this[_0x25c201(0xfd)]=await this[_0x25c201(0xde)][_0x25c201(0xe8)](this[_0x25c201(0xeb)][_0x25c201(0x10f)]));}catch(_0x47eee5){throw new bad_request_error_1[(_0x25c201(0xc3))](errors_1[_0x25c201(0xdd)]);}}async[a74_0x13b823(0xf2)](){const _0x2f9b50=a74_0x13b823;if(!this['commitData'][_0x2f9b50(0xe0)])return[];await this['salesforceService']['patchObject'](constants_1[_0x2f9b50(0xd6)],this[_0x2f9b50(0xeb)]['commitAttachmentId'],{'Name':(0x0,shortid_1[_0x2f9b50(0xc8)])()});const _0x549cb4=await this['salesforceService'][_0x2f9b50(0xf6)](this[_0x2f9b50(0xeb)][_0x2f9b50(0xe0)])[_0x2f9b50(0xaf)](_0xfcbf5e=>_0xfcbf5e['split']('\x20')['map'](_0x24c200=>_0x24c200[_0x2f9b50(0xcb)]()));await this['salesforceService'][_0x2f9b50(0xb2)](this[_0x2f9b50(0xeb)]['commitAttachmentId']);const _0x26ec8a=new salesforce_retriever_service_1[(_0x2f9b50(0x10d))](this[_0x2f9b50(0xc6)]);return await _0x26ec8a[_0x2f9b50(0xa9)](_0x549cb4);}async['getComponentsToDelete'](){const _0x4ec5c0=a74_0x13b823;if(!this[_0x4ec5c0(0xeb)][_0x4ec5c0(0xbe)])return[];await this[_0x4ec5c0(0xc6)][_0x4ec5c0(0xc5)](constants_1[_0x4ec5c0(0xd6)],this[_0x4ec5c0(0xeb)][_0x4ec5c0(0xbe)],{'Name':(0x0,shortid_1['default'])()});const _0x3a7233=await this[_0x4ec5c0(0xc6)]['retrieveAttachment'](this[_0x4ec5c0(0xeb)][_0x4ec5c0(0xbe)]);return await this['salesforceService'][_0x4ec5c0(0xb2)](this['commitData']['deleteAttachmentId']),_0x3a7233;}async[a74_0x13b823(0xfc)](){const _0x324cc2=a74_0x13b823,_0x1b182b=new commit_components_dto_1[(_0x324cc2(0x10b))](),[_0x1d4d58,_0x5928f2]=await Promise[_0x324cc2(0xf7)]([this[_0x324cc2(0xf2)](),this['getComponentsToDelete']()]);return _0x1b182b[_0x324cc2(0x111)]=this[_0x324cc2(0xeb)][_0x324cc2(0x111)],_0x1b182b[_0x324cc2(0xb5)]=this[_0x324cc2(0xeb)][_0x324cc2(0xb5)],_0x1b182b['components']={'writed':_0x1d4d58,'deleted':_0x5928f2},_0x1b182b[_0x324cc2(0xae)]=this[_0x324cc2(0xe9)][_0x324cc2(0xc0)],_0x1b182b[_0x324cc2(0xa8)]=this[_0x324cc2(0xce)],_0x1b182b['branch']=this[_0x324cc2(0xe2)],_0x1b182b[_0x324cc2(0x109)]=this['config'][_0x324cc2(0xd0)],_0x1b182b;}async[a74_0x13b823(0xf5)](_0x2de122=![]){const _0x3fcf3f=a74_0x13b823;if(_0x2de122)await this[_0x3fcf3f(0xde)]['updateRemoteState'](this[_0x3fcf3f(0xfd)],{});else{const _0x459432=await this[_0x3fcf3f(0xce)][_0x3fcf3f(0xd4)][_0x3fcf3f(0xc2)](this['branch'][_0x3fcf3f(0xcf)]);this[_0x3fcf3f(0x10a)][_0x3fcf3f(0xad)](this[_0x3fcf3f(0xe4)]+_0x3fcf3f(0xf8));const _0x4acc7f={[this['repository'][_0x3fcf3f(0xff)]]:{'lastCommit':_0x459432['sha']}};await this['salesforceSync'][_0x3fcf3f(0xdb)](this[_0x3fcf3f(0xfd)],_0x4acc7f);}}async['exec'](){const _0x23c5fb=a74_0x13b823,_0xf7b525=await this[_0x23c5fb(0xfc)]();await this[_0x23c5fb(0xde)][_0x23c5fb(0xed)](this['repositoryData'],_0x23c5fb(0xb8)),await this[_0x23c5fb(0xc1)][_0x23c5fb(0xa9)](_0xf7b525,this[_0x23c5fb(0xe4)]),await this['updateLastCommit'](),await this[_0x23c5fb(0xde)]['setStatus'](this['repositoryData'],_0x23c5fb(0xbd));}async[a74_0x13b823(0xf4)](_0x511169){const _0x6ee341=a74_0x13b823;try{this[_0x6ee341(0x10a)][_0x6ee341(0xbc)](''+_0x511169),await this['sfLogger'][_0x6ee341(0xd2)](),await this['updateLastCommit'](!![]),await this[_0x6ee341(0xde)]['setStatus'](this[_0x6ee341(0xfd)],'Error');}catch(_0x156e4f){this[_0x6ee341(0xd1)]['error'](_0x156e4f);}}async['run'](_0x266a1c){const _0x3f0663=a74_0x13b823;try{this[_0x3f0663(0xeb)]=_0x266a1c,this[_0x3f0663(0x104)]=typedi_1[_0x3f0663(0xbb)][_0x3f0663(0xec)](providers_tokens_1['Tokens'][_0x3f0663(0x104)]),this[_0x3f0663(0xba)]=typedi_1[_0x3f0663(0xbb)][_0x3f0663(0xec)](providers_tokens_1['Tokens'][_0x3f0663(0xbf)]),this['config']=typedi_1[_0x3f0663(0xbb)][_0x3f0663(0xec)](providers_tokens_1[_0x3f0663(0xd3)][_0x3f0663(0xe9)]),await this[_0x3f0663(0xe3)](),this['repository']=await this[_0x3f0663(0xba)]['getOne'](this['repositoryData'][_0x3f0663(0x100)]),this[_0x3f0663(0xe2)]=await this[_0x3f0663(0xce)]['branches'][_0x3f0663(0xc2)](this[_0x3f0663(0xfd)]['branchName']),this['sfLogger']=typedi_1[_0x3f0663(0xbb)][_0x3f0663(0xec)](providers_tokens_1[_0x3f0663(0xd3)][_0x3f0663(0xd1)]),this['prefix']='[FLOSUM\x20->\x20GIT]\x20['+this['config'][_0x3f0663(0xd0)][_0x3f0663(0x107)]()+']\x20[Repository:\x20'+this['repositoryData'][_0x3f0663(0x100)]+']\x20[Branch:\x20'+this[_0x3f0663(0xfd)][_0x3f0663(0xc7)]+_0x3f0663(0xf1)+FlosumCommitJob_1['name']+']';if(!this[_0x3f0663(0xfd)])throw new bad_request_error_1[(_0x3f0663(0xc3))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x3f0663(0x10a)][_0x3f0663(0xad)](this['prefix']+'\x20Start\x20Flosum\x20commit\x20job.')[_0x3f0663(0xd2)](),await this['exec']()[_0x3f0663(0xc9)](_0x5393f9=>this[_0x3f0663(0xf4)](_0x5393f9));}catch(_0x3e1a93){this['commitData']=undefined,this['logger'][_0x3f0663(0xbc)](_0x3e1a93);throw _0x3e1a93;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a74_0x13b823(0xd8)])({'transient':!![]}),__metadata(a74_0x13b823(0xf3),[salesforce_service_1[a74_0x13b823(0xd7)],commit_components_job_1[a74_0x13b823(0xe1)],salesforce_sync_service_1[a74_0x13b823(0xfa)]])],FlosumCommitJob),exports[a74_0x13b823(0xcd)]=FlosumCommitJob;function a74_0x2f5f(){const _0xf403e6=['isConvertToSfdx','commitJob','getOne','BadRequestError','decorate','patchObject','salesforceService','branchName','default','catch','../../../../core/errors/bad-request.error','trim','1991928fRVrFq','FlosumCommitJob','repository','name','gitProvider','logger','send','Tokens','branches','(((.+)+)+)+$','FLOSUM_ATTACHMENT','SalesforceService','Service','shortid','211826VtGLGp','updateRemoteState','7xtMJLO','ERR_INVALID_SYNC_RECORD_ID','salesforceSync','function','commitAttachmentId','CommitComponentsJob','branch','fetchRepositoryData','prefix','../../salesforce/services/salesforce-retriever.service','../../salesforce/services/salesforce.service','14863320QIkuNx','getBranchRecord','config','3384138xuUuLg','commitData','get','setStatus','length','12EvOhFL','./commit-components.job',']\x20[','getComponentsToWrite','design:paramtypes','handleCommitJobError','updateLastCommit','retrieveAttachment','all','\x20Update\x20remote\x20state.','10879912bwDrPq','SalesforceSyncService','1651DwgAvl','getCommitDto','repositoryData','141708jJqUtr','gitUrl','repositoryName','../../../../constants','getRepositoryRecord','2016780AXZuMs','gitApiService','typedi','11qIwQdL','toUpperCase','syncRepositoryId','provider','sfLogger','CommitComponentsDto','Logger','SalesforceRetrieverService','defineProperty','syncBranchId','__esModule','message','repo','run','6OLUMhg','../../salesforce/services/salesforce-sync.service','../../providers/providers.tokens','log','convertToSFDX','then','metadata','getOwnPropertyDescriptor','deleteAttachment','search','apply','user','9AaMWvs','object','In\x20Progress','toString','repoService','Container','error','Completed','deleteAttachmentId','gitRepoService'];a74_0x2f5f=function(){return _0xf403e6;};return a74_0x2f5f();}