const a122_0x48f7e8=a122_0x3213;function a122_0x3213(_0x52241e,_0x1cde1e){const _0x5691c9=a122_0x2396();return a122_0x3213=function(_0x50e71b,_0x5b64cb){_0x50e71b=_0x50e71b-0x17e;let _0x2396be=_0x5691c9[_0x50e71b];return _0x2396be;},a122_0x3213(_0x52241e,_0x1cde1e);}function a122_0x2396(){const _0x1e0940=['recordTypeName','14872evVUGr','repositoryName','retrieveAttachment','isConvertToSfdx','exec','Error','../../../../core','decorate','\x20Start\x20Flosum\x20commit\x20job.','Tokens','Logger','1759450plMJKf','patchObject','9gulrsV','map','user','get','provider','toUpperCase','BadRequestError','name','typedi','message','CommitComponentsDto','defineProperty','369ghSteO','then',']\x20[Repository:\x20','syncRepositoryId','1293784XchdGY','log','FLOSUM_ATTACHMENT','ERR_INVALID_SYNC_RECORD_ID','../dto/commit-components.dto','object','branches','\x20Update\x20remote\x20state.','salesforceService','components','Completed','logger','FlosumCommitJob',']\x20[Branch:\x20','getOne','salesforceSync','CommitComponentsJob','6952913AtPdJM','updateRemoteState','SalesforceRetrieverService','sha','gitProvider','send','getComponentsToDelete','toString','run','__metadata','../../salesforce/services/salesforce.service','commitAttachmentId','In\x20Progress','updateLastCommit','commitData','setStatus','branchName','../../../../core/errors/bad-request.error','repositoryData','gitUrl','deleteAttachmentId','7flYuFy','getOwnPropertyDescriptor','metadata','78inpGwR','repo','10iQAKwL','__importDefault','design:paramtypes','all','317316JCaUFj','fetchRepositoryData','gitApiService','deleteAttachment','SalesforceSyncService','length','syncBranchId','Service','Container','split','12049mhjCNt','__decorate',']\x20[','SalesforceService','./commit-components.job','20654112XgCNei','shortid','error','(((.+)+)+)+$','sfLogger','../../salesforce/services/salesforce-retriever.service','repository','getComponentsToWrite','branch','catch','prefix','../../../../constants/errors','repoService','config','apply','gitRepoService','getCommitDto','function','../../providers/providers.tokens','recordType','__esModule','search','handleCommitJobError','commitJob'];a122_0x2396=function(){return _0x1e0940;};return a122_0x2396();}(function(_0x27a0ec,_0xd98a56){const _0x3d7502=a122_0x3213,_0x5143f4=_0x27a0ec();while(!![]){try{const _0x223fe8=parseInt(_0x3d7502(0x1e2))/0x1*(-parseInt(_0x3d7502(0x1d2))/0x2)+parseInt(_0x3d7502(0x1a5))/0x3*(-parseInt(_0x3d7502(0x18c))/0x4)+parseInt(_0x3d7502(0x197))/0x5+-parseInt(_0x3d7502(0x1d8))/0x6*(-parseInt(_0x3d7502(0x1cf))/0x7)+-parseInt(_0x3d7502(0x1a9))/0x8*(parseInt(_0x3d7502(0x199))/0x9)+parseInt(_0x3d7502(0x1d4))/0xa*(-parseInt(_0x3d7502(0x1ba))/0xb)+parseInt(_0x3d7502(0x1e7))/0xc;if(_0x223fe8===_0xd98a56)break;else _0x5143f4['push'](_0x5143f4['shift']());}catch(_0x2ebf8e){_0x5143f4['push'](_0x5143f4['shift']());}}}(a122_0x2396,0x62db9));const a122_0x5b64cb=(function(){let _0x25c6b9=!![];return function(_0x1e6848,_0x33b9fe){const _0x1c5f54=_0x25c6b9?function(){const _0x426b8b=a122_0x3213;if(_0x33b9fe){const _0x3de1f9=_0x33b9fe[_0x426b8b(0x181)](_0x1e6848,arguments);return _0x33b9fe=null,_0x3de1f9;}}:function(){};return _0x25c6b9=![],_0x1c5f54;};}()),a122_0x50e71b=a122_0x5b64cb(this,function(){const _0x293079=a122_0x3213;return a122_0x50e71b[_0x293079(0x1c1)]()[_0x293079(0x188)](_0x293079(0x1ea))[_0x293079(0x1c1)]()['constructor'](a122_0x50e71b)[_0x293079(0x188)]('(((.+)+)+)+$');});a122_0x50e71b();'use strict';var __decorate=this&&this[a122_0x48f7e8(0x1e3)]||function(_0x2e8b34,_0x55a4c3,_0x23b00a,_0x9ca57f){const _0x1386b3=a122_0x48f7e8;var _0x4c7fcb=arguments[_0x1386b3(0x1dd)],_0x530bdc=_0x4c7fcb<0x3?_0x55a4c3:_0x9ca57f===null?_0x9ca57f=Object[_0x1386b3(0x1d0)](_0x55a4c3,_0x23b00a):_0x9ca57f,_0x24bb77;if(typeof Reflect==='object'&&typeof Reflect[_0x1386b3(0x193)]===_0x1386b3(0x184))_0x530bdc=Reflect[_0x1386b3(0x193)](_0x2e8b34,_0x55a4c3,_0x23b00a,_0x9ca57f);else{for(var _0x217e99=_0x2e8b34[_0x1386b3(0x1dd)]-0x1;_0x217e99>=0x0;_0x217e99--)if(_0x24bb77=_0x2e8b34[_0x217e99])_0x530bdc=(_0x4c7fcb<0x3?_0x24bb77(_0x530bdc):_0x4c7fcb>0x3?_0x24bb77(_0x55a4c3,_0x23b00a,_0x530bdc):_0x24bb77(_0x55a4c3,_0x23b00a))||_0x530bdc;}return _0x4c7fcb>0x3&&_0x530bdc&&Object[_0x1386b3(0x1a4)](_0x55a4c3,_0x23b00a,_0x530bdc),_0x530bdc;},__metadata=this&&this[a122_0x48f7e8(0x1c3)]||function(_0x8ef77f,_0x427474){const _0x21cf70=a122_0x48f7e8;if(typeof Reflect===_0x21cf70(0x1ae)&&typeof Reflect[_0x21cf70(0x1d1)]===_0x21cf70(0x184))return Reflect['metadata'](_0x8ef77f,_0x427474);},__importDefault=this&&this[a122_0x48f7e8(0x1d5)]||function(_0x322408){const _0xc3810=a122_0x48f7e8;return _0x322408&&_0x322408[_0xc3810(0x187)]?_0x322408:{'default':_0x322408};},FlosumCommitJob_1;Object[a122_0x48f7e8(0x1a4)](exports,'__esModule',{'value':!![]}),exports[a122_0x48f7e8(0x1b5)]=void 0x0;const core_1=require(a122_0x48f7e8(0x192)),salesforce_service_1=require(a122_0x48f7e8(0x1c4)),typedi_1=require(a122_0x48f7e8(0x1a1)),errors_1=require(a122_0x48f7e8(0x17e)),bad_request_error_1=require(a122_0x48f7e8(0x1cb)),salesforce_retriever_service_1=require(a122_0x48f7e8(0x1ec)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a122_0x48f7e8(0x1ad)),commit_components_job_1=require(a122_0x48f7e8(0x1e6)),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a122_0x48f7e8(0x1e8))),providers_tokens_1=require(a122_0x48f7e8(0x185));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x14e4b0,_0x7eadee,_0x3b689c){const _0x4e6a25=a122_0x48f7e8;this['salesforceService']=_0x14e4b0,this['commitJob']=_0x7eadee,this['salesforceSync']=_0x3b689c,this['logger']=new core_1[(_0x4e6a25(0x196))](FlosumCommitJob_1[_0x4e6a25(0x1a0)]);}async['fetchRepositoryData'](){const _0x223102=a122_0x48f7e8;try{if(this[_0x223102(0x1c8)]['syncRepositoryId'])this[_0x223102(0x1cc)]=await this['salesforceSync']['getRepositoryRecord'](this[_0x223102(0x1c8)][_0x223102(0x1a8)]);else this[_0x223102(0x1c8)][_0x223102(0x1de)]&&(this[_0x223102(0x1cc)]=await this[_0x223102(0x1b8)]['getBranchRecord'](this[_0x223102(0x1c8)][_0x223102(0x1de)]));}catch(_0x56cfd6){throw new bad_request_error_1[(_0x223102(0x19f))](errors_1[_0x223102(0x1ac)]);}}async[a122_0x48f7e8(0x1ee)](){const _0x1c9bb8=a122_0x48f7e8;if(!this['commitData'][_0x1c9bb8(0x1c5)])return[];await this[_0x1c9bb8(0x1b1)][_0x1c9bb8(0x198)](constants_1[_0x1c9bb8(0x1ab)],this[_0x1c9bb8(0x1c8)][_0x1c9bb8(0x1c5)],{'Name':(0x0,shortid_1['default'])()});const _0x2523d4=await this[_0x1c9bb8(0x1b1)][_0x1c9bb8(0x18e)](this[_0x1c9bb8(0x1c8)][_0x1c9bb8(0x1c5)])[_0x1c9bb8(0x1a6)](_0x359c8d=>_0x359c8d[_0x1c9bb8(0x1e1)]('\x20')[_0x1c9bb8(0x19a)](_0x20e49e=>_0x20e49e['trim']()));await this[_0x1c9bb8(0x1b1)]['deleteAttachment'](this[_0x1c9bb8(0x1c8)][_0x1c9bb8(0x1c5)]);const _0x3953a5=new salesforce_retriever_service_1[(_0x1c9bb8(0x1bc))](this[_0x1c9bb8(0x1b1)]);return await _0x3953a5[_0x1c9bb8(0x1c2)](_0x2523d4);}async[a122_0x48f7e8(0x1c0)](){const _0x417936=a122_0x48f7e8;if(!this[_0x417936(0x1c8)]['deleteAttachmentId'])return[];await this[_0x417936(0x1b1)]['patchObject'](constants_1[_0x417936(0x1ab)],this['commitData'][_0x417936(0x1ce)],{'Name':(0x0,shortid_1['default'])()});const _0x39b1eb=await this[_0x417936(0x1b1)][_0x417936(0x18e)](this[_0x417936(0x1c8)][_0x417936(0x1ce)]),_0x1ec4ec=JSON['parse'](_0x39b1eb);return await this[_0x417936(0x1b1)][_0x417936(0x1db)](this[_0x417936(0x1c8)][_0x417936(0x1ce)]),_0x1ec4ec;}async['getCommitDto'](){const _0x57f275=a122_0x48f7e8,_0x4ed1fd=new commit_components_dto_1[(_0x57f275(0x1a3))](),[_0xb7abda,_0x5425ad]=await Promise[_0x57f275(0x1d7)]([this[_0x57f275(0x1ee)](),this['getComponentsToDelete']()]);return _0x4ed1fd[_0x57f275(0x1a2)]=this[_0x57f275(0x1c8)][_0x57f275(0x1a2)],_0x4ed1fd[_0x57f275(0x19b)]=this[_0x57f275(0x1c8)]['user'],_0x4ed1fd[_0x57f275(0x1b2)]={'writed':_0xb7abda,'deleted':_0x5425ad},_0x4ed1fd['convertToSFDX']=this[_0x57f275(0x180)][_0x57f275(0x18f)],_0x4ed1fd[_0x57f275(0x1d3)]=this[_0x57f275(0x1ed)],_0x4ed1fd[_0x57f275(0x1ef)]=this[_0x57f275(0x1ef)],_0x4ed1fd[_0x57f275(0x19d)]=this['config'][_0x57f275(0x1be)],_0x4ed1fd[_0x57f275(0x186)]=this[_0x57f275(0x1cc)][_0x57f275(0x18b)],_0x4ed1fd;}async[a122_0x48f7e8(0x1c7)](_0x5759ec=![]){const _0x5ce543=a122_0x48f7e8;if(_0x5759ec)await this['salesforceSync'][_0x5ce543(0x1bb)](this['repositoryData'],{});else{const _0x3dbe80=await this[_0x5ce543(0x1ed)][_0x5ce543(0x1af)][_0x5ce543(0x1b7)](this[_0x5ce543(0x1ef)][_0x5ce543(0x1a0)]);this[_0x5ce543(0x1eb)][_0x5ce543(0x1aa)](this[_0x5ce543(0x1f1)]+_0x5ce543(0x1b0));const _0x58011c={[this[_0x5ce543(0x1ed)][_0x5ce543(0x1cd)]]:{'lastCommit':_0x3dbe80[_0x5ce543(0x1bd)]}};await this['salesforceSync'][_0x5ce543(0x1bb)](this[_0x5ce543(0x1cc)],_0x58011c);}}async['exec'](){const _0x1582b2=a122_0x48f7e8,_0x3ab17c=await this[_0x1582b2(0x183)]();await this['salesforceSync']['setStatus'](this['repositoryData'],_0x1582b2(0x1c6)),await this[_0x1582b2(0x18a)]['run'](_0x3ab17c,this['prefix']),await this[_0x1582b2(0x1c7)](),await this[_0x1582b2(0x1b8)]['setStatus'](this['repositoryData'],_0x1582b2(0x1b3));}async['handleCommitJobError'](_0x26dea4){const _0x25f35b=a122_0x48f7e8;try{this[_0x25f35b(0x1eb)][_0x25f35b(0x1e9)](''+_0x26dea4),await this[_0x25f35b(0x1eb)][_0x25f35b(0x1bf)](),await this[_0x25f35b(0x1c7)](!![]),await this[_0x25f35b(0x1b8)][_0x25f35b(0x1c9)](this[_0x25f35b(0x1cc)],_0x25f35b(0x191));}catch(_0x56ef1c){this['logger'][_0x25f35b(0x1e9)](_0x56ef1c);}}async[a122_0x48f7e8(0x1c2)](_0x5dab51){const _0x37e728=a122_0x48f7e8;try{this[_0x37e728(0x1c8)]=_0x5dab51,this[_0x37e728(0x1da)]=typedi_1[_0x37e728(0x1e0)][_0x37e728(0x19c)](providers_tokens_1['Tokens']['gitApiService']),this[_0x37e728(0x17f)]=typedi_1[_0x37e728(0x1e0)][_0x37e728(0x19c)](providers_tokens_1[_0x37e728(0x195)][_0x37e728(0x182)]),this[_0x37e728(0x180)]=typedi_1[_0x37e728(0x1e0)][_0x37e728(0x19c)](providers_tokens_1['Tokens'][_0x37e728(0x180)]),await this[_0x37e728(0x1d9)](),this['repository']=await this['repoService'][_0x37e728(0x1b7)](this[_0x37e728(0x1cc)][_0x37e728(0x18d)]),this['branch']=await this['repository'][_0x37e728(0x1af)][_0x37e728(0x1b7)](this[_0x37e728(0x1cc)]['branchName']),this[_0x37e728(0x1eb)]=typedi_1[_0x37e728(0x1e0)]['get'](providers_tokens_1[_0x37e728(0x195)][_0x37e728(0x1b4)]),this[_0x37e728(0x1f1)]='[FLOSUM\x20->\x20GIT]\x20['+this[_0x37e728(0x180)][_0x37e728(0x1be)][_0x37e728(0x19e)]()+_0x37e728(0x1a7)+this[_0x37e728(0x1cc)]['repositoryName']+_0x37e728(0x1b6)+this[_0x37e728(0x1cc)][_0x37e728(0x1ca)]+_0x37e728(0x1e4)+FlosumCommitJob_1[_0x37e728(0x1a0)]+']';if(!this[_0x37e728(0x1cc)])throw new bad_request_error_1[(_0x37e728(0x19f))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x37e728(0x1eb)][_0x37e728(0x1aa)](this['prefix']+_0x37e728(0x194))['send'](),await this[_0x37e728(0x190)]()[_0x37e728(0x1f0)](_0x3aec23=>this[_0x37e728(0x189)](_0x3aec23));}catch(_0x431977){this['commitData']=undefined,this['logger']['error'](_0x431977);throw _0x431977;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a122_0x48f7e8(0x1df)])({'transient':!![]}),__metadata(a122_0x48f7e8(0x1d6),[salesforce_service_1[a122_0x48f7e8(0x1e5)],commit_components_job_1[a122_0x48f7e8(0x1b9)],salesforce_sync_service_1[a122_0x48f7e8(0x1dc)]])],FlosumCommitJob),exports[a122_0x48f7e8(0x1b5)]=FlosumCommitJob;