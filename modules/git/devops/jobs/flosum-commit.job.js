const a105_0x22ed8b=a105_0x15b9;function a105_0x344b(){const _0x288536=['deleteAttachmentId','../../../../core/errors/bad-request.error','gitRepoService','42rhYaoC','retrieveAttachment',']\x20[Branch:\x20','length','FLOSUM_ATTACHMENT','commitAttachmentId','get','updateRemoteState','repoService','../../../../constants','exec','salesforceSync','1408599jAtJTn','478334IxYtDK','ERR_UNKNOWN_SYNC_RECORD_ID','../dto/commit-components.dto','repositoryName','788176KUMokS','Completed','SalesforceRetrieverService','Tokens','setStatus','../../../../core','name','Container','logger','then','BadRequestError','all','105317rSFCMI','[FLOSUM\x20->\x20GIT]\x20[','error','45965guVsnP','config','getComponentsToDelete','../../salesforce/services/salesforce.service','../../salesforce/services/salesforce-sync.service','getComponentsToWrite','metadata','search','split','ERR_INVALID_SYNC_RECORD_ID','getBranchRecord','salesforceService',']\x20[Repository:\x20','branchName','CommitComponentsJob',']\x20[','log','function','getOne','map','updateLastCommit','default','gitProvider','SalesforceService','gitApiService','patchObject','user','run','defineProperty','Service','36628cAAhyn','gitUrl','branches','__decorate','__metadata','sfLogger','20BAMfHR','message','getCommitDto','isConvertToSfdx','toString','typedi','syncRepositoryId','branch','(((.+)+)+)+$','fetchRepositoryData','handleCommitJobError','syncBranchId','decorate','commitJob','repo','object','prefix','repositoryData','__esModule','../../salesforce/services/salesforce-retriever.service','provider','sha','repository','constructor','SalesforceSyncService','__importDefault','FlosumCommitJob','design:paramtypes','21NzbZvi','4683591HjwwXh','commitData','getRepositoryRecord','51NFyTpm','apply','deleteAttachment','send','toUpperCase'];a105_0x344b=function(){return _0x288536;};return a105_0x344b();}(function(_0x16b057,_0x49e7cf){const _0x1ceb5a=a105_0x15b9,_0x39b021=_0x16b057();while(!![]){try{const _0x10ebca=-parseInt(_0x1ceb5a(0x1f5))/0x1+parseInt(_0x1ceb5a(0x1e5))/0x2+-parseInt(_0x1ceb5a(0x1d0))/0x3*(-parseInt(_0x1ceb5a(0x216))/0x4)+-parseInt(_0x1ceb5a(0x1f8))/0x5*(-parseInt(_0x1ceb5a(0x1d8))/0x6)+parseInt(_0x1ceb5a(0x1cc))/0x7*(-parseInt(_0x1ceb5a(0x1e9))/0x8)+parseInt(_0x1ceb5a(0x1e4))/0x9*(-parseInt(_0x1ceb5a(0x21c))/0xa)+parseInt(_0x1ceb5a(0x1cd))/0xb;if(_0x10ebca===_0x49e7cf)break;else _0x39b021['push'](_0x39b021['shift']());}catch(_0x5dbafb){_0x39b021['push'](_0x39b021['shift']());}}}(a105_0x344b,0x29c37));function a105_0x15b9(_0x3923ee,_0x2a6320){const _0x137c20=a105_0x344b();return a105_0x15b9=function(_0x3d1035,_0xef2855){_0x3d1035=_0x3d1035-0x1bd;let _0x344bbd=_0x137c20[_0x3d1035];return _0x344bbd;},a105_0x15b9(_0x3923ee,_0x2a6320);}const a105_0xef2855=(function(){let _0xbb9348=!![];return function(_0x13fcb4,_0x31faed){const _0x440b1c=_0xbb9348?function(){const _0xf6f3b9=a105_0x15b9;if(_0x31faed){const _0x3bc166=_0x31faed[_0xf6f3b9(0x1d1)](_0x13fcb4,arguments);return _0x31faed=null,_0x3bc166;}}:function(){};return _0xbb9348=![],_0x440b1c;};}()),a105_0x3d1035=a105_0xef2855(this,function(){const _0x54c45a=a105_0x15b9;return a105_0x3d1035[_0x54c45a(0x220)]()[_0x54c45a(0x1ff)](_0x54c45a(0x224))['toString']()[_0x54c45a(0x1c7)](a105_0x3d1035)['search'](_0x54c45a(0x224));});a105_0x3d1035();'use strict';var __decorate=this&&this[a105_0x22ed8b(0x219)]||function(_0x2294f8,_0x1abae5,_0x144037,_0x4e81af){const _0x57056f=a105_0x22ed8b;var _0x29f6cf=arguments['length'],_0x1474fc=_0x29f6cf<0x3?_0x1abae5:_0x4e81af===null?_0x4e81af=Object['getOwnPropertyDescriptor'](_0x1abae5,_0x144037):_0x4e81af,_0x1796bd;if(typeof Reflect===_0x57056f(0x1bf)&&typeof Reflect[_0x57056f(0x228)]===_0x57056f(0x209))_0x1474fc=Reflect[_0x57056f(0x228)](_0x2294f8,_0x1abae5,_0x144037,_0x4e81af);else{for(var _0x4635c4=_0x2294f8[_0x57056f(0x1db)]-0x1;_0x4635c4>=0x0;_0x4635c4--)if(_0x1796bd=_0x2294f8[_0x4635c4])_0x1474fc=(_0x29f6cf<0x3?_0x1796bd(_0x1474fc):_0x29f6cf>0x3?_0x1796bd(_0x1abae5,_0x144037,_0x1474fc):_0x1796bd(_0x1abae5,_0x144037))||_0x1474fc;}return _0x29f6cf>0x3&&_0x1474fc&&Object[_0x57056f(0x214)](_0x1abae5,_0x144037,_0x1474fc),_0x1474fc;},__metadata=this&&this[a105_0x22ed8b(0x21a)]||function(_0x2f8f06,_0x3c1a99){const _0x5536db=a105_0x22ed8b;if(typeof Reflect===_0x5536db(0x1bf)&&typeof Reflect[_0x5536db(0x1fe)]===_0x5536db(0x209))return Reflect[_0x5536db(0x1fe)](_0x2f8f06,_0x3c1a99);},__importDefault=this&&this[a105_0x22ed8b(0x1c9)]||function(_0x4ad4d1){const _0x3c0ea7=a105_0x22ed8b;return _0x4ad4d1&&_0x4ad4d1[_0x3c0ea7(0x1c2)]?_0x4ad4d1:{'default':_0x4ad4d1};},FlosumCommitJob_1;Object['defineProperty'](exports,a105_0x22ed8b(0x1c2),{'value':!![]}),exports[a105_0x22ed8b(0x1ca)]=void 0x0;const core_1=require(a105_0x22ed8b(0x1ee)),salesforce_service_1=require(a105_0x22ed8b(0x1fb)),typedi_1=require(a105_0x22ed8b(0x221)),errors_1=require('../../../../constants/errors'),bad_request_error_1=require(a105_0x22ed8b(0x1d6)),salesforce_retriever_service_1=require(a105_0x22ed8b(0x1c3)),salesforce_sync_service_1=require(a105_0x22ed8b(0x1fc)),commit_components_dto_1=require(a105_0x22ed8b(0x1e7)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a105_0x22ed8b(0x1e1)),shortid_1=__importDefault(require('shortid')),providers_tokens_1=require('../../providers/providers.tokens');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x4ac8b6,_0x5d154e,_0x2197a0){const _0x81c6fc=a105_0x22ed8b;this[_0x81c6fc(0x203)]=_0x4ac8b6,this[_0x81c6fc(0x1bd)]=_0x5d154e,this['salesforceSync']=_0x2197a0,this[_0x81c6fc(0x1f1)]=new core_1['Logger'](FlosumCommitJob_1[_0x81c6fc(0x1ef)]);}async[a105_0x22ed8b(0x225)](){const _0x5cc5df=a105_0x22ed8b;try{if(this[_0x5cc5df(0x1ce)][_0x5cc5df(0x222)])this[_0x5cc5df(0x1c1)]=await this['salesforceSync'][_0x5cc5df(0x1cf)](this[_0x5cc5df(0x1ce)][_0x5cc5df(0x222)]);else this['commitData'][_0x5cc5df(0x227)]&&(this['repositoryData']=await this[_0x5cc5df(0x1e3)][_0x5cc5df(0x202)](this[_0x5cc5df(0x1ce)][_0x5cc5df(0x227)]));}catch(_0x3abc39){throw new bad_request_error_1['BadRequestError'](errors_1[_0x5cc5df(0x201)]);}}async[a105_0x22ed8b(0x1fd)](){const _0x232a64=a105_0x22ed8b;if(!this[_0x232a64(0x1ce)]['commitAttachmentId'])return[];await this['salesforceService'][_0x232a64(0x211)](constants_1['FLOSUM_ATTACHMENT'],this[_0x232a64(0x1ce)][_0x232a64(0x1dd)],{'Name':(0x0,shortid_1[_0x232a64(0x20d)])()});const _0x18e156=await this[_0x232a64(0x203)][_0x232a64(0x1d9)](this[_0x232a64(0x1ce)][_0x232a64(0x1dd)])[_0x232a64(0x1f2)](_0x4e8ef0=>_0x4e8ef0[_0x232a64(0x200)]('\x20')[_0x232a64(0x20b)](_0x4fcde8=>_0x4fcde8['trim']()));await this['salesforceService'][_0x232a64(0x1d2)](this[_0x232a64(0x1ce)][_0x232a64(0x1dd)]);const _0x55495c=new salesforce_retriever_service_1[(_0x232a64(0x1eb))](this[_0x232a64(0x203)]);return await _0x55495c['run'](_0x18e156);}async[a105_0x22ed8b(0x1fa)](){const _0x27b50b=a105_0x22ed8b;if(!this[_0x27b50b(0x1ce)][_0x27b50b(0x1d5)])return[];await this[_0x27b50b(0x203)]['patchObject'](constants_1[_0x27b50b(0x1dc)],this['commitData'][_0x27b50b(0x1d5)],{'Name':(0x0,shortid_1[_0x27b50b(0x20d)])()});const _0x450fad=await this[_0x27b50b(0x203)]['retrieveAttachment'](this[_0x27b50b(0x1ce)]['deleteAttachmentId']);return await this[_0x27b50b(0x203)][_0x27b50b(0x1d2)](this['commitData']['deleteAttachmentId']),_0x450fad;}async[a105_0x22ed8b(0x21e)](){const _0x4281ba=a105_0x22ed8b,_0x209b4c=new commit_components_dto_1['CommitComponentsDto'](),[_0x3bad88,_0x1e4ffb]=await Promise[_0x4281ba(0x1f4)]([this[_0x4281ba(0x1fd)](),this['getComponentsToDelete']()]);return _0x209b4c[_0x4281ba(0x21d)]=this['commitData'][_0x4281ba(0x21d)],_0x209b4c[_0x4281ba(0x212)]=this['commitData'][_0x4281ba(0x212)],_0x209b4c['components']={'writed':_0x3bad88,'deleted':_0x1e4ffb},_0x209b4c['convertToSFDX']=this[_0x4281ba(0x1f9)][_0x4281ba(0x21f)],_0x209b4c[_0x4281ba(0x1be)]=this['repository'],_0x209b4c[_0x4281ba(0x223)]=this[_0x4281ba(0x223)],_0x209b4c[_0x4281ba(0x1c4)]=this[_0x4281ba(0x1f9)][_0x4281ba(0x20e)],_0x209b4c;}async[a105_0x22ed8b(0x20c)](_0x455163=![]){const _0x56db58=a105_0x22ed8b;if(_0x455163)await this[_0x56db58(0x1e3)]['updateRemoteState'](this[_0x56db58(0x1c1)],{});else{const _0x4497f1=await this[_0x56db58(0x1c6)][_0x56db58(0x218)][_0x56db58(0x20a)](this[_0x56db58(0x223)][_0x56db58(0x1ef)]);this[_0x56db58(0x21b)]['log'](this[_0x56db58(0x1c0)]+'\x20Update\x20remote\x20state.');const _0x27bc68={[this[_0x56db58(0x1c6)][_0x56db58(0x217)]]:{'lastCommit':_0x4497f1[_0x56db58(0x1c5)]}};await this[_0x56db58(0x1e3)][_0x56db58(0x1df)](this['repositoryData'],_0x27bc68);}}async[a105_0x22ed8b(0x1e2)](){const _0x1afce4=a105_0x22ed8b,_0x4b60d4=await this[_0x1afce4(0x21e)]();await this['salesforceSync'][_0x1afce4(0x1ed)](this['repositoryData'],'In\x20Progress'),await this['commitJob']['run'](_0x4b60d4,this[_0x1afce4(0x1c0)]),await this[_0x1afce4(0x20c)](),await this[_0x1afce4(0x1e3)]['setStatus'](this[_0x1afce4(0x1c1)],_0x1afce4(0x1ea));}async[a105_0x22ed8b(0x226)](_0x4b87ed){const _0x238009=a105_0x22ed8b;try{this[_0x238009(0x21b)][_0x238009(0x1f7)](''+_0x4b87ed),await this['sfLogger'][_0x238009(0x1d3)](),await this[_0x238009(0x20c)](!![]),await this[_0x238009(0x1e3)]['setStatus'](this['repositoryData'],'Error');}catch(_0x30877b){this[_0x238009(0x1f1)]['error'](_0x30877b);}}async[a105_0x22ed8b(0x213)](_0x454b90){const _0x1b40d6=a105_0x22ed8b;try{this[_0x1b40d6(0x1ce)]=_0x454b90,this[_0x1b40d6(0x210)]=typedi_1['Container'][_0x1b40d6(0x1de)](providers_tokens_1[_0x1b40d6(0x1ec)][_0x1b40d6(0x210)]),this[_0x1b40d6(0x1e0)]=typedi_1[_0x1b40d6(0x1f0)][_0x1b40d6(0x1de)](providers_tokens_1[_0x1b40d6(0x1ec)][_0x1b40d6(0x1d7)]),this[_0x1b40d6(0x1f9)]=typedi_1[_0x1b40d6(0x1f0)][_0x1b40d6(0x1de)](providers_tokens_1[_0x1b40d6(0x1ec)][_0x1b40d6(0x1f9)]),await this[_0x1b40d6(0x225)](),this['repository']=await this[_0x1b40d6(0x1e0)][_0x1b40d6(0x20a)](this['repositoryData'][_0x1b40d6(0x1e8)]),this[_0x1b40d6(0x223)]=await this['repository']['branches']['getOne'](this[_0x1b40d6(0x1c1)][_0x1b40d6(0x205)]),this[_0x1b40d6(0x21b)]=typedi_1['Container'][_0x1b40d6(0x1de)](providers_tokens_1[_0x1b40d6(0x1ec)][_0x1b40d6(0x1f1)]),this[_0x1b40d6(0x1c0)]=_0x1b40d6(0x1f6)+this[_0x1b40d6(0x1f9)]['gitProvider'][_0x1b40d6(0x1d4)]()+_0x1b40d6(0x204)+this[_0x1b40d6(0x1c1)][_0x1b40d6(0x1e8)]+_0x1b40d6(0x1da)+this[_0x1b40d6(0x1c1)]['branchName']+_0x1b40d6(0x207)+FlosumCommitJob_1['name']+']';if(!this[_0x1b40d6(0x1c1)])throw new bad_request_error_1[(_0x1b40d6(0x1f3))](errors_1[_0x1b40d6(0x1e6)]);await this[_0x1b40d6(0x21b)][_0x1b40d6(0x208)](this[_0x1b40d6(0x1c0)]+'\x20Start\x20Flosum\x20commit\x20job.')[_0x1b40d6(0x1d3)](),await this[_0x1b40d6(0x1e2)]()['catch'](_0x266cbc=>this[_0x1b40d6(0x226)](_0x266cbc));}catch(_0x100b8f){this[_0x1b40d6(0x1ce)]=undefined,this[_0x1b40d6(0x1f1)]['error'](_0x100b8f);throw _0x100b8f;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x22ed8b(0x215)])({'transient':!![]}),__metadata(a105_0x22ed8b(0x1cb),[salesforce_service_1[a105_0x22ed8b(0x20f)],commit_components_job_1[a105_0x22ed8b(0x206)],salesforce_sync_service_1[a105_0x22ed8b(0x1c8)]])],FlosumCommitJob),exports[a105_0x22ed8b(0x1ca)]=FlosumCommitJob;