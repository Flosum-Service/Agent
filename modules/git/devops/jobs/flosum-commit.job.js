const a105_0x3e425b=a105_0x4be6;(function(_0x16308a,_0x14a581){const _0x488c5f=a105_0x4be6,_0x65bd43=_0x16308a();while(!![]){try{const _0xa27ec1=parseInt(_0x488c5f(0x151))/0x1*(-parseInt(_0x488c5f(0x17a))/0x2)+-parseInt(_0x488c5f(0x137))/0x3*(-parseInt(_0x488c5f(0x13b))/0x4)+parseInt(_0x488c5f(0x12f))/0x5*(parseInt(_0x488c5f(0x122))/0x6)+parseInt(_0x488c5f(0x125))/0x7*(-parseInt(_0x488c5f(0x161))/0x8)+parseInt(_0x488c5f(0x163))/0x9+parseInt(_0x488c5f(0x17d))/0xa*(-parseInt(_0x488c5f(0x140))/0xb)+parseInt(_0x488c5f(0x188))/0xc*(parseInt(_0x488c5f(0x12d))/0xd);if(_0xa27ec1===_0x14a581)break;else _0x65bd43['push'](_0x65bd43['shift']());}catch(_0x39d0a6){_0x65bd43['push'](_0x65bd43['shift']());}}}(a105_0x1e4c,0x684a4));const a105_0x455d14=(function(){let _0x5cb0ff=!![];return function(_0x2042c8,_0x50aa53){const _0x333143=_0x5cb0ff?function(){const _0x475df8=a105_0x4be6;if(_0x50aa53){const _0x1c1d26=_0x50aa53[_0x475df8(0x169)](_0x2042c8,arguments);return _0x50aa53=null,_0x1c1d26;}}:function(){};return _0x5cb0ff=![],_0x333143;};}()),a105_0x3400c5=a105_0x455d14(this,function(){const _0x14153a=a105_0x4be6;return a105_0x3400c5[_0x14153a(0x16b)]()[_0x14153a(0x156)]('(((.+)+)+)+$')[_0x14153a(0x16b)]()[_0x14153a(0x143)](a105_0x3400c5)[_0x14153a(0x156)](_0x14153a(0x138));});a105_0x3400c5();'use strict';var __decorate=this&&this[a105_0x3e425b(0x172)]||function(_0x177ce1,_0xe2e4bc,_0x816867,_0x6b27e5){const _0x201600=a105_0x3e425b;var _0x48a7b1=arguments['length'],_0x42e3fd=_0x48a7b1<0x3?_0xe2e4bc:_0x6b27e5===null?_0x6b27e5=Object['getOwnPropertyDescriptor'](_0xe2e4bc,_0x816867):_0x6b27e5,_0x11bae2;if(typeof Reflect===_0x201600(0x17f)&&typeof Reflect[_0x201600(0x132)]===_0x201600(0x179))_0x42e3fd=Reflect['decorate'](_0x177ce1,_0xe2e4bc,_0x816867,_0x6b27e5);else{for(var _0x1eb931=_0x177ce1[_0x201600(0x123)]-0x1;_0x1eb931>=0x0;_0x1eb931--)if(_0x11bae2=_0x177ce1[_0x1eb931])_0x42e3fd=(_0x48a7b1<0x3?_0x11bae2(_0x42e3fd):_0x48a7b1>0x3?_0x11bae2(_0xe2e4bc,_0x816867,_0x42e3fd):_0x11bae2(_0xe2e4bc,_0x816867))||_0x42e3fd;}return _0x48a7b1>0x3&&_0x42e3fd&&Object[_0x201600(0x13e)](_0xe2e4bc,_0x816867,_0x42e3fd),_0x42e3fd;},__metadata=this&&this[a105_0x3e425b(0x173)]||function(_0x4e7e99,_0x2313cf){const _0x243982=a105_0x3e425b;if(typeof Reflect===_0x243982(0x17f)&&typeof Reflect[_0x243982(0x129)]==='function')return Reflect[_0x243982(0x129)](_0x4e7e99,_0x2313cf);},__importDefault=this&&this[a105_0x3e425b(0x167)]||function(_0x2870c9){const _0x1718bb=a105_0x3e425b;return _0x2870c9&&_0x2870c9[_0x1718bb(0x164)]?_0x2870c9:{'default':_0x2870c9};},FlosumCommitJob_1;function a105_0x4be6(_0x4e4526,_0x21551a){const _0x1f9d99=a105_0x1e4c();return a105_0x4be6=function(_0x3400c5,_0x455d14){_0x3400c5=_0x3400c5-0x122;let _0x1e4c5e=_0x1f9d99[_0x3400c5];return _0x1e4c5e;},a105_0x4be6(_0x4e4526,_0x21551a);}Object[a105_0x3e425b(0x13e)](exports,a105_0x3e425b(0x164),{'value':!![]}),exports[a105_0x3e425b(0x16a)]=void 0x0;const core_1=require(a105_0x3e425b(0x15d)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a105_0x3e425b(0x124)),errors_1=require(a105_0x3e425b(0x16e)),bad_request_error_1=require('../../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a105_0x3e425b(0x15b)),salesforce_sync_service_1=require(a105_0x3e425b(0x14f)),commit_components_dto_1=require(a105_0x3e425b(0x145)),commit_components_job_1=require(a105_0x3e425b(0x13a)),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a105_0x3e425b(0x126))),providers_tokens_1=require(a105_0x3e425b(0x139));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x5f22af,_0xd57ac6,_0x5afc0e){const _0x24197f=a105_0x3e425b;this[_0x24197f(0x14a)]=_0x5f22af,this[_0x24197f(0x155)]=_0xd57ac6,this[_0x24197f(0x134)]=_0x5afc0e,this['logger']=new core_1[(_0x24197f(0x14c))](FlosumCommitJob_1[_0x24197f(0x146)]);}async['fetchRepositoryData'](){const _0x5032ff=a105_0x3e425b;try{if(this[_0x5032ff(0x152)][_0x5032ff(0x18a)])this[_0x5032ff(0x136)]=await this['salesforceSync'][_0x5032ff(0x133)](this[_0x5032ff(0x152)]['syncRepositoryId']);else this[_0x5032ff(0x152)][_0x5032ff(0x15a)]&&(this['repositoryData']=await this['salesforceSync'][_0x5032ff(0x15e)](this['commitData']['syncBranchId']));}catch(_0x29cd9c){throw new bad_request_error_1['BadRequestError'](errors_1[_0x5032ff(0x130)]);}}async['getComponentsToWrite'](){const _0x4e1c96=a105_0x3e425b;if(!this[_0x4e1c96(0x152)]['commitAttachmentId'])return[];await this['salesforceService']['patchObject'](constants_1[_0x4e1c96(0x131)],this[_0x4e1c96(0x152)][_0x4e1c96(0x16d)],{'Name':(0x0,shortid_1[_0x4e1c96(0x189)])()});const _0x2e3e16=await this['salesforceService']['retrieveAttachment'](this[_0x4e1c96(0x152)][_0x4e1c96(0x16d)])[_0x4e1c96(0x175)](_0x25e5ef=>_0x25e5ef['split']('\x20')['map'](_0x31ac31=>_0x31ac31['trim']()));await this[_0x4e1c96(0x14a)][_0x4e1c96(0x174)](this['commitData'][_0x4e1c96(0x16d)]);const _0x2cbc5c=new salesforce_retriever_service_1[(_0x4e1c96(0x15c))](this[_0x4e1c96(0x14a)]);return await _0x2cbc5c[_0x4e1c96(0x16c)](_0x2e3e16);}async[a105_0x3e425b(0x157)](){const _0xdf430e=a105_0x3e425b;if(!this[_0xdf430e(0x152)][_0xdf430e(0x182)])return[];await this['salesforceService'][_0xdf430e(0x141)](constants_1['FLOSUM_ATTACHMENT'],this['commitData'][_0xdf430e(0x182)],{'Name':(0x0,shortid_1[_0xdf430e(0x189)])()});const _0x5bc300=await this[_0xdf430e(0x14a)][_0xdf430e(0x153)](this[_0xdf430e(0x152)][_0xdf430e(0x182)]);return await this[_0xdf430e(0x14a)]['deleteAttachment'](this[_0xdf430e(0x152)]['deleteAttachmentId']),_0x5bc300;}async['getCommitDto'](){const _0x2b3f75=a105_0x3e425b,_0x22c171=new commit_components_dto_1['CommitComponentsDto'](),[_0x3116a9,_0x5a2c1c]=await Promise[_0x2b3f75(0x185)]([this['getComponentsToWrite'](),this[_0x2b3f75(0x157)]()]);return _0x22c171[_0x2b3f75(0x12a)]=this['commitData']['message'],_0x22c171[_0x2b3f75(0x144)]=this[_0x2b3f75(0x152)][_0x2b3f75(0x144)],_0x22c171[_0x2b3f75(0x150)]={'writed':_0x3116a9,'deleted':_0x5a2c1c},_0x22c171[_0x2b3f75(0x13f)]=this[_0x2b3f75(0x166)][_0x2b3f75(0x184)],_0x22c171[_0x2b3f75(0x12c)]=this[_0x2b3f75(0x14b)],_0x22c171['branch']=this[_0x2b3f75(0x127)],_0x22c171['provider']=this[_0x2b3f75(0x166)]['gitProvider'],_0x22c171;}async['updateLastCommit'](_0x5b78ba=![]){const _0x4ccea5=a105_0x3e425b;if(_0x5b78ba)await this['salesforceSync'][_0x4ccea5(0x12b)](this[_0x4ccea5(0x136)],{});else{const _0xc121fc=await this[_0x4ccea5(0x14b)]['branches'][_0x4ccea5(0x165)](this[_0x4ccea5(0x127)][_0x4ccea5(0x146)]);this['sfLogger'][_0x4ccea5(0x180)](this[_0x4ccea5(0x135)]+'\x20Update\x20remote\x20state.');const _0x5a45ad={[this[_0x4ccea5(0x14b)]['gitUrl']]:{'lastCommit':_0xc121fc[_0x4ccea5(0x178)]}};await this['salesforceSync'][_0x4ccea5(0x12b)](this[_0x4ccea5(0x136)],_0x5a45ad);}}async[a105_0x3e425b(0x12e)](){const _0x6ce669=a105_0x3e425b,_0x35d3b7=await this[_0x6ce669(0x158)]();await this[_0x6ce669(0x134)][_0x6ce669(0x142)](this[_0x6ce669(0x136)],_0x6ce669(0x17b)),await this[_0x6ce669(0x155)][_0x6ce669(0x16c)](_0x35d3b7,this[_0x6ce669(0x135)]),await this[_0x6ce669(0x181)](),await this['salesforceSync'][_0x6ce669(0x142)](this[_0x6ce669(0x136)],_0x6ce669(0x176));}async[a105_0x3e425b(0x128)](_0x2679f2){const _0x123773=a105_0x3e425b;try{this['sfLogger']['error'](''+_0x2679f2),await this['sfLogger'][_0x123773(0x154)](),await this[_0x123773(0x181)](!![]),await this[_0x123773(0x134)][_0x123773(0x142)](this[_0x123773(0x136)],_0x123773(0x186));}catch(_0x9f88bf){this[_0x123773(0x171)]['error'](_0x9f88bf);}}async[a105_0x3e425b(0x16c)](_0x43ae4e){const _0x2cf5cf=a105_0x3e425b;try{this[_0x2cf5cf(0x152)]=_0x43ae4e,this['gitApiService']=typedi_1['Container']['get'](providers_tokens_1['Tokens'][_0x2cf5cf(0x14d)]),this['repoService']=typedi_1[_0x2cf5cf(0x149)][_0x2cf5cf(0x14e)](providers_tokens_1[_0x2cf5cf(0x162)]['gitRepoService']),this[_0x2cf5cf(0x166)]=typedi_1[_0x2cf5cf(0x149)][_0x2cf5cf(0x14e)](providers_tokens_1[_0x2cf5cf(0x162)][_0x2cf5cf(0x166)]),await this[_0x2cf5cf(0x16f)](),this[_0x2cf5cf(0x14b)]=await this[_0x2cf5cf(0x147)][_0x2cf5cf(0x165)](this[_0x2cf5cf(0x136)][_0x2cf5cf(0x13c)]),this[_0x2cf5cf(0x127)]=await this[_0x2cf5cf(0x14b)]['branches']['getOne'](this[_0x2cf5cf(0x136)]['branchName']),this['sfLogger']=typedi_1[_0x2cf5cf(0x149)][_0x2cf5cf(0x14e)](providers_tokens_1[_0x2cf5cf(0x162)]['logger']),this['prefix']=_0x2cf5cf(0x13d)+this[_0x2cf5cf(0x166)][_0x2cf5cf(0x148)]['toUpperCase']()+_0x2cf5cf(0x177)+this[_0x2cf5cf(0x136)][_0x2cf5cf(0x13c)]+']\x20[Branch:\x20'+this[_0x2cf5cf(0x136)][_0x2cf5cf(0x15f)]+_0x2cf5cf(0x168)+FlosumCommitJob_1[_0x2cf5cf(0x146)]+']';if(!this[_0x2cf5cf(0x136)])throw new bad_request_error_1[(_0x2cf5cf(0x17e))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x2cf5cf(0x159)][_0x2cf5cf(0x180)](this[_0x2cf5cf(0x135)]+'\x20Start\x20Flosum\x20commit\x20job.')[_0x2cf5cf(0x154)](),await this[_0x2cf5cf(0x12e)]()[_0x2cf5cf(0x17c)](_0x2ddb52=>this[_0x2cf5cf(0x128)](_0x2ddb52));}catch(_0x35f862){this[_0x2cf5cf(0x152)]=undefined,this[_0x2cf5cf(0x171)][_0x2cf5cf(0x187)](_0x35f862);throw _0x35f862;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x3e425b(0x170)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1['SalesforceService'],commit_components_job_1[a105_0x3e425b(0x183)],salesforce_sync_service_1[a105_0x3e425b(0x160)]])],FlosumCommitJob),exports[a105_0x3e425b(0x16a)]=FlosumCommitJob;function a105_0x1e4c(){const _0x27e67a=['catch','2602140amNZDL','BadRequestError','object','log','updateLastCommit','deleteAttachmentId','CommitComponentsJob','isConvertToSfdx','all','Error','error','8907420rarwdD','default','syncRepositoryId','118224qDsTOK','length','typedi','4927125adTgZz','shortid','branch','handleCommitJobError','metadata','message','updateRemoteState','repo','13FFLKME','exec','140wlvbmg','ERR_INVALID_SYNC_RECORD_ID','FLOSUM_ATTACHMENT','decorate','getRepositoryRecord','salesforceSync','prefix','repositoryData','404601INqmYu','(((.+)+)+)+$','../../providers/providers.tokens','./commit-components.job','16lztGgJ','repositoryName','[FLOSUM\x20->\x20GIT]\x20[','defineProperty','convertToSFDX','11CFSahU','patchObject','setStatus','constructor','user','../dto/commit-components.dto','name','repoService','gitProvider','Container','salesforceService','repository','Logger','gitApiService','get','../../salesforce/services/salesforce-sync.service','components','458059siZmbR','commitData','retrieveAttachment','send','commitJob','search','getComponentsToDelete','getCommitDto','sfLogger','syncBranchId','../../salesforce/services/salesforce-retriever.service','SalesforceRetrieverService','../../../../core','getBranchRecord','branchName','SalesforceSyncService','8UTzFkH','Tokens','142695DCpSQy','__esModule','getOne','config','__importDefault',']\x20[','apply','FlosumCommitJob','toString','run','commitAttachmentId','../../../../constants/errors','fetchRepositoryData','Service','logger','__decorate','__metadata','deleteAttachment','then','Completed',']\x20[Repository:\x20','sha','function','2yYgDBT','In\x20Progress'];a105_0x1e4c=function(){return _0x27e67a;};return a105_0x1e4c();}