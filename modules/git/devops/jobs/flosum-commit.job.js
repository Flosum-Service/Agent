const a73_0x4215ca=a73_0x3128;(function(_0x57b9c5,_0x423579){const _0xb0a239=a73_0x3128,_0x4633e0=_0x57b9c5();while(!![]){try{const _0x2cc42f=-parseInt(_0xb0a239(0x1be))/0x1*(-parseInt(_0xb0a239(0x196))/0x2)+parseInt(_0xb0a239(0x174))/0x3+-parseInt(_0xb0a239(0x179))/0x4*(parseInt(_0xb0a239(0x163))/0x5)+parseInt(_0xb0a239(0x1b1))/0x6*(parseInt(_0xb0a239(0x1a4))/0x7)+parseInt(_0xb0a239(0x1a6))/0x8+-parseInt(_0xb0a239(0x173))/0x9+-parseInt(_0xb0a239(0x1a3))/0xa;if(_0x2cc42f===_0x423579)break;else _0x4633e0['push'](_0x4633e0['shift']());}catch(_0x492dee){_0x4633e0['push'](_0x4633e0['shift']());}}}(a73_0x3a1a,0xcae1b));const a73_0x3b15ed=(function(){let _0x1de748=!![];return function(_0x194419,_0xc9572f){const _0x25b088=_0x1de748?function(){const _0x2a9c9e=a73_0x3128;if(_0xc9572f){const _0x2fe419=_0xc9572f[_0x2a9c9e(0x167)](_0x194419,arguments);return _0xc9572f=null,_0x2fe419;}}:function(){};return _0x1de748=![],_0x25b088;};}()),a73_0x46a3a9=a73_0x3b15ed(this,function(){const _0x3a0e28=a73_0x3128;return a73_0x46a3a9[_0x3a0e28(0x18c)]()[_0x3a0e28(0x169)]('(((.+)+)+)+$')['toString']()[_0x3a0e28(0x1b6)](a73_0x46a3a9)['search']('(((.+)+)+)+$');});a73_0x46a3a9();'use strict';var __decorate=this&&this[a73_0x4215ca(0x160)]||function(_0x457f1c,_0x2275e2,_0x5dd5c3,_0x375a82){const _0x1716ec=a73_0x4215ca;var _0x2bfd87=arguments[_0x1716ec(0x1ad)],_0x15e49b=_0x2bfd87<0x3?_0x2275e2:_0x375a82===null?_0x375a82=Object[_0x1716ec(0x176)](_0x2275e2,_0x5dd5c3):_0x375a82,_0x295895;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x1716ec(0x17c))_0x15e49b=Reflect[_0x1716ec(0x189)](_0x457f1c,_0x2275e2,_0x5dd5c3,_0x375a82);else{for(var _0x4dbce5=_0x457f1c[_0x1716ec(0x1ad)]-0x1;_0x4dbce5>=0x0;_0x4dbce5--)if(_0x295895=_0x457f1c[_0x4dbce5])_0x15e49b=(_0x2bfd87<0x3?_0x295895(_0x15e49b):_0x2bfd87>0x3?_0x295895(_0x2275e2,_0x5dd5c3,_0x15e49b):_0x295895(_0x2275e2,_0x5dd5c3))||_0x15e49b;}return _0x2bfd87>0x3&&_0x15e49b&&Object[_0x1716ec(0x17b)](_0x2275e2,_0x5dd5c3,_0x15e49b),_0x15e49b;},__metadata=this&&this['__metadata']||function(_0x58b5a2,_0x20a3d7){const _0x37bac1=a73_0x4215ca;if(typeof Reflect===_0x37bac1(0x1a9)&&typeof Reflect[_0x37bac1(0x1b5)]==='function')return Reflect[_0x37bac1(0x1b5)](_0x58b5a2,_0x20a3d7);},__importDefault=this&&this[a73_0x4215ca(0x168)]||function(_0x561723){const _0x7ecd37=a73_0x4215ca;return _0x561723&&_0x561723[_0x7ecd37(0x18a)]?_0x561723:{'default':_0x561723};},FlosumCommitJob_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a73_0x4215ca(0x1ae)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require('typedi'),errors_1=require(a73_0x4215ca(0x184)),bad_request_error_1=require(a73_0x4215ca(0x16b)),salesforce_retriever_service_1=require(a73_0x4215ca(0x1b0)),salesforce_sync_service_1=require(a73_0x4215ca(0x17d)),commit_components_dto_1=require(a73_0x4215ca(0x17a)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a73_0x4215ca(0x172)),shortid_1=__importDefault(require(a73_0x4215ca(0x191))),providers_tokens_1=require(a73_0x4215ca(0x1b7));function a73_0x3128(_0x72488b,_0x1f55e2){const _0x41785e=a73_0x3a1a();return a73_0x3128=function(_0x46a3a9,_0x3b15ed){_0x46a3a9=_0x46a3a9-0x155;let _0x3a1ae0=_0x41785e[_0x46a3a9];return _0x3a1ae0;},a73_0x3128(_0x72488b,_0x1f55e2);}function a73_0x3a1a(){const _0x233712=['sfLogger','SalesforceRetrieverService','deleteAttachment','getComponentsToDelete','shortid','send','run','getRepositoryRecord','exec','2Skbsai','components','user','logger','retrieveAttachment','getComponentsToWrite','provider','config','handleCommitJobError','branch','convertToSFDX',']\x20[','updateRemoteState','9770030KZeaeN','51072OZeKti','\x20Start\x20Flosum\x20commit\x20job.','970784gkihPI','commitData','Logger','object','[FLOSUM\x20->\x20GIT]\x20[','Error','salesforceService','length','../../../../core','SalesforceSyncService','../../salesforce/services/salesforce-retriever.service','90ekddbo','syncRepositoryId','getBranchRecord','Tokens','metadata','constructor','../../providers/providers.tokens','repositoryData','deleteAttachmentId','getCommitDto','ERR_UNKNOWN_SYNC_RECORD_ID','prefix','gitApiService','1538169epgnZg','toUpperCase','commitJob','repository','salesforceSync','commitAttachmentId','getOne','FlosumCommitJob','gitProvider','FLOSUM_ATTACHMENT','catch','SalesforceService','__decorate','Completed','CommitComponentsDto','125FOwATb','repositoryName','message','error','apply','__importDefault','search','design:paramtypes','../../../../core/errors/bad-request.error','branches','name','branchName','isConvertToSfdx','repo','BadRequestError','../../../../constants','8661222eAVUGB','4780746jubPoF','In\x20Progress','getOwnPropertyDescriptor','get','updateLastCommit','94748KldHwQ','../dto/commit-components.dto','defineProperty','function','../../salesforce/services/salesforce-sync.service','default','setStatus','patchObject','syncBranchId',']\x20[Branch:\x20','Container','../../../../constants/errors','repoService','map',']\x20[Repository:\x20','Service','decorate','__esModule','split','toString'];a73_0x3a1a=function(){return _0x233712;};return a73_0x3a1a();}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0xa2c54b,_0x3b3f21,_0x395a4e){const _0x3eb72b=a73_0x4215ca;this[_0x3eb72b(0x1ac)]=_0xa2c54b,this[_0x3eb72b(0x156)]=_0x3b3f21,this[_0x3eb72b(0x158)]=_0x395a4e,this[_0x3eb72b(0x199)]=new core_1[(_0x3eb72b(0x1a8))](FlosumCommitJob_1[_0x3eb72b(0x16d)]);}async['fetchRepositoryData'](){const _0xfb7ea=a73_0x4215ca;try{if(this[_0xfb7ea(0x1a7)][_0xfb7ea(0x1b2)])this[_0xfb7ea(0x1b8)]=await this['salesforceSync'][_0xfb7ea(0x194)](this['commitData'][_0xfb7ea(0x1b2)]);else this[_0xfb7ea(0x1a7)]['syncBranchId']&&(this['repositoryData']=await this['salesforceSync'][_0xfb7ea(0x1b3)](this[_0xfb7ea(0x1a7)][_0xfb7ea(0x181)]));}catch(_0x4f5a8d){throw new bad_request_error_1[(_0xfb7ea(0x171))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a73_0x4215ca(0x19b)](){const _0x50e70a=a73_0x4215ca;if(!this['commitData'][_0x50e70a(0x159)])return[];await this[_0x50e70a(0x1ac)][_0x50e70a(0x180)](constants_1[_0x50e70a(0x15d)],this[_0x50e70a(0x1a7)][_0x50e70a(0x159)],{'Name':(0x0,shortid_1['default'])()});const _0x142119=await this[_0x50e70a(0x1ac)][_0x50e70a(0x19a)](this[_0x50e70a(0x1a7)][_0x50e70a(0x159)])['then'](_0x3755c5=>_0x3755c5[_0x50e70a(0x18b)]('\x20')[_0x50e70a(0x186)](_0x451031=>_0x451031['trim']()));await this[_0x50e70a(0x1ac)][_0x50e70a(0x18f)](this['commitData'][_0x50e70a(0x159)]);const _0x4c14ce=new salesforce_retriever_service_1[(_0x50e70a(0x18e))](this['salesforceService']);return await _0x4c14ce[_0x50e70a(0x193)](_0x142119);}async[a73_0x4215ca(0x190)](){const _0x36fc92=a73_0x4215ca;if(!this[_0x36fc92(0x1a7)][_0x36fc92(0x1b9)])return[];await this[_0x36fc92(0x1ac)][_0x36fc92(0x180)](constants_1[_0x36fc92(0x15d)],this[_0x36fc92(0x1a7)][_0x36fc92(0x1b9)],{'Name':(0x0,shortid_1[_0x36fc92(0x17e)])()});const _0x2442e5=await this[_0x36fc92(0x1ac)][_0x36fc92(0x19a)](this[_0x36fc92(0x1a7)][_0x36fc92(0x1b9)]);return await this['salesforceService'][_0x36fc92(0x18f)](this[_0x36fc92(0x1a7)][_0x36fc92(0x1b9)]),_0x2442e5;}async['getCommitDto'](){const _0xfe355d=a73_0x4215ca,_0x2b6549=new commit_components_dto_1[(_0xfe355d(0x162))](),[_0xcccbf0,_0xc1e51c]=await Promise['all']([this['getComponentsToWrite'](),this[_0xfe355d(0x190)]()]);return _0x2b6549[_0xfe355d(0x165)]=this[_0xfe355d(0x1a7)][_0xfe355d(0x165)],_0x2b6549[_0xfe355d(0x198)]=this['commitData']['user'],_0x2b6549[_0xfe355d(0x197)]={'writed':_0xcccbf0,'deleted':_0xc1e51c},_0x2b6549[_0xfe355d(0x1a0)]=this[_0xfe355d(0x19d)][_0xfe355d(0x16f)],_0x2b6549[_0xfe355d(0x170)]=this[_0xfe355d(0x157)],_0x2b6549[_0xfe355d(0x19f)]=this[_0xfe355d(0x19f)],_0x2b6549[_0xfe355d(0x19c)]=this['config']['gitProvider'],_0x2b6549;}async[a73_0x4215ca(0x178)](_0x37b70a=![]){const _0x4878de=a73_0x4215ca;if(_0x37b70a)await this['salesforceSync'][_0x4878de(0x1a2)](this['repositoryData'],{});else{const _0x548a9e=await this[_0x4878de(0x157)][_0x4878de(0x16c)][_0x4878de(0x15a)](this[_0x4878de(0x19f)][_0x4878de(0x16d)]);this[_0x4878de(0x18d)]['log'](this['prefix']+'\x20Update\x20remote\x20state.');const _0x446f0b={[this[_0x4878de(0x157)]['gitUrl']]:{'lastCommit':_0x548a9e['sha']}};await this[_0x4878de(0x158)][_0x4878de(0x1a2)](this[_0x4878de(0x1b8)],_0x446f0b);}}async[a73_0x4215ca(0x195)](){const _0x232f94=a73_0x4215ca,_0x306cdc=await this[_0x232f94(0x1ba)]();await this['salesforceSync'][_0x232f94(0x17f)](this['repositoryData'],_0x232f94(0x175)),await this['commitJob'][_0x232f94(0x193)](_0x306cdc,this[_0x232f94(0x1bc)]),await this[_0x232f94(0x178)](),await this[_0x232f94(0x158)]['setStatus'](this[_0x232f94(0x1b8)],_0x232f94(0x161));}async['handleCommitJobError'](_0x36382e){const _0x2bf5bf=a73_0x4215ca;try{this['sfLogger'][_0x2bf5bf(0x166)](''+_0x36382e),await this[_0x2bf5bf(0x18d)][_0x2bf5bf(0x192)](),await this[_0x2bf5bf(0x178)](!![]),await this['salesforceSync'][_0x2bf5bf(0x17f)](this['repositoryData'],_0x2bf5bf(0x1ab));}catch(_0x551182){this['logger']['error'](_0x551182);}}async[a73_0x4215ca(0x193)](_0x42e1c7){const _0x860544=a73_0x4215ca;try{this['commitData']=_0x42e1c7,this[_0x860544(0x1bd)]=typedi_1[_0x860544(0x183)][_0x860544(0x177)](providers_tokens_1[_0x860544(0x1b4)][_0x860544(0x1bd)]),this[_0x860544(0x185)]=typedi_1[_0x860544(0x183)][_0x860544(0x177)](providers_tokens_1[_0x860544(0x1b4)]['gitRepoService']),this[_0x860544(0x19d)]=typedi_1['Container'][_0x860544(0x177)](providers_tokens_1[_0x860544(0x1b4)][_0x860544(0x19d)]),await this['fetchRepositoryData'](),this[_0x860544(0x157)]=await this[_0x860544(0x185)][_0x860544(0x15a)](this[_0x860544(0x1b8)][_0x860544(0x164)]),this['branch']=await this[_0x860544(0x157)][_0x860544(0x16c)][_0x860544(0x15a)](this['repositoryData']['branchName']),this[_0x860544(0x18d)]=typedi_1[_0x860544(0x183)][_0x860544(0x177)](providers_tokens_1[_0x860544(0x1b4)][_0x860544(0x199)]),this[_0x860544(0x1bc)]=_0x860544(0x1aa)+this[_0x860544(0x19d)][_0x860544(0x15c)][_0x860544(0x155)]()+_0x860544(0x187)+this[_0x860544(0x1b8)]['repositoryName']+_0x860544(0x182)+this[_0x860544(0x1b8)][_0x860544(0x16e)]+_0x860544(0x1a1)+FlosumCommitJob_1[_0x860544(0x16d)]+']';if(!this[_0x860544(0x1b8)])throw new bad_request_error_1[(_0x860544(0x171))](errors_1[_0x860544(0x1bb)]);await this[_0x860544(0x18d)]['log'](this[_0x860544(0x1bc)]+_0x860544(0x1a5))[_0x860544(0x192)](),await this[_0x860544(0x195)]()[_0x860544(0x15e)](_0x93057d=>this[_0x860544(0x19e)](_0x93057d));}catch(_0x55afea){this[_0x860544(0x1a7)]=undefined,this[_0x860544(0x199)][_0x860544(0x166)](_0x55afea);throw _0x55afea;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a73_0x4215ca(0x188)])({'transient':!![]}),__metadata(a73_0x4215ca(0x16a),[salesforce_service_1[a73_0x4215ca(0x15f)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a73_0x4215ca(0x1af)]])],FlosumCommitJob),exports[a73_0x4215ca(0x15b)]=FlosumCommitJob;