const a107_0x32db6f=a107_0x2870;function a107_0x2870(_0xef2a67,_0x41a540){const _0x166f78=a107_0x5ce0();return a107_0x2870=function(_0x1c63eb,_0x1b29ca){_0x1c63eb=_0x1c63eb-0x1d1;let _0x5ce08e=_0x166f78[_0x1c63eb];return _0x5ce08e;},a107_0x2870(_0xef2a67,_0x41a540);}(function(_0x1cebfb,_0x4b27ad){const _0x35da3d=a107_0x2870,_0x4d64de=_0x1cebfb();while(!![]){try{const _0x2617f0=parseInt(_0x35da3d(0x211))/0x1*(parseInt(_0x35da3d(0x23c))/0x2)+-parseInt(_0x35da3d(0x23f))/0x3+parseInt(_0x35da3d(0x1dc))/0x4+parseInt(_0x35da3d(0x1f4))/0x5+-parseInt(_0x35da3d(0x223))/0x6+-parseInt(_0x35da3d(0x1f0))/0x7*(-parseInt(_0x35da3d(0x1ed))/0x8)+-parseInt(_0x35da3d(0x222))/0x9*(parseInt(_0x35da3d(0x1d7))/0xa);if(_0x2617f0===_0x4b27ad)break;else _0x4d64de['push'](_0x4d64de['shift']());}catch(_0x3481f6){_0x4d64de['push'](_0x4d64de['shift']());}}}(a107_0x5ce0,0x54159));const a107_0x1b29ca=(function(){let _0x507a4f=!![];return function(_0x17775c,_0x285423){const _0x158ca5=_0x507a4f?function(){const _0x3fab0c=a107_0x2870;if(_0x285423){const _0x1e8b49=_0x285423[_0x3fab0c(0x208)](_0x17775c,arguments);return _0x285423=null,_0x1e8b49;}}:function(){};return _0x507a4f=![],_0x158ca5;};}()),a107_0x1c63eb=a107_0x1b29ca(this,function(){const _0x5a5993=a107_0x2870;return a107_0x1c63eb[_0x5a5993(0x20a)]()['search'](_0x5a5993(0x231))[_0x5a5993(0x20a)]()[_0x5a5993(0x21d)](a107_0x1c63eb)[_0x5a5993(0x1ea)](_0x5a5993(0x231));});a107_0x1c63eb();'use strict';var __decorate=this&&this[a107_0x32db6f(0x209)]||function(_0x36ac3f,_0x55e4dc,_0x57966e,_0x2322ad){const _0x558a66=a107_0x32db6f;var _0x1ce109=arguments[_0x558a66(0x20e)],_0x2355c3=_0x1ce109<0x3?_0x55e4dc:_0x2322ad===null?_0x2322ad=Object[_0x558a66(0x220)](_0x55e4dc,_0x57966e):_0x2322ad,_0x4a010f;if(typeof Reflect===_0x558a66(0x1f1)&&typeof Reflect[_0x558a66(0x1da)]==='function')_0x2355c3=Reflect['decorate'](_0x36ac3f,_0x55e4dc,_0x57966e,_0x2322ad);else{for(var _0x4e9439=_0x36ac3f[_0x558a66(0x20e)]-0x1;_0x4e9439>=0x0;_0x4e9439--)if(_0x4a010f=_0x36ac3f[_0x4e9439])_0x2355c3=(_0x1ce109<0x3?_0x4a010f(_0x2355c3):_0x1ce109>0x3?_0x4a010f(_0x55e4dc,_0x57966e,_0x2355c3):_0x4a010f(_0x55e4dc,_0x57966e))||_0x2355c3;}return _0x1ce109>0x3&&_0x2355c3&&Object[_0x558a66(0x1d3)](_0x55e4dc,_0x57966e,_0x2355c3),_0x2355c3;},__metadata=this&&this[a107_0x32db6f(0x21e)]||function(_0x5df507,_0x80fac8){const _0x126949=a107_0x32db6f;if(typeof Reflect===_0x126949(0x1f1)&&typeof Reflect['metadata']==='function')return Reflect[_0x126949(0x1e2)](_0x5df507,_0x80fac8);},__importDefault=this&&this[a107_0x32db6f(0x20f)]||function(_0x2752a6){return _0x2752a6&&_0x2752a6['__esModule']?_0x2752a6:{'default':_0x2752a6};},FlosumCommitJob_1;Object['defineProperty'](exports,a107_0x32db6f(0x1ec),{'value':!![]}),exports[a107_0x32db6f(0x22f)]=void 0x0;function a107_0x5ce0(){const _0x426bc3=['error','repositoryName','getComponentsToDelete','gitRepoService','getCommitDto','56886MRUxkS','repo','getComponentsToWrite','1802292TuVGVP','salesforceService','then','setStatus','repository','defineProperty',']\x20[Repository:\x20','salesforceSync','recordTypeName','231500VvVMnQ','commitData','Logger','decorate','message','237096OsQiBl','get','branch','updateLastCommit','ERR_INVALID_SYNC_RECORD_ID','sfLogger','metadata',']\x20[','config','gitApiService','Tokens','commitJob','SalesforceService','retrieveAttachment','search','catch','__esModule','32fOcEQT','\x20Start\x20Flosum\x20commit\x20job.','ERR_UNKNOWN_SYNC_RECORD_ID','931217bHkqnk','object','fetchRepositoryData','gitUrl','2281720eTWiFz','../../../../constants/errors','updateRemoteState','syncRepositoryId','FLOSUM_ATTACHMENT','getRepositoryRecord','../../../../core','deleteAttachmentId','getOne','repositoryData','convertToSFDX','all','default','syncBranchId','BadRequestError','log','name','CommitComponentsDto','user','run','apply','__decorate','toString','typedi','components','./commit-components.job','length','__importDefault','handleCommitJobError','5swhdFJ','logger','branches','provider','Error','SalesforceRetrieverService','repoService','prefix','../../../../core/errors/bad-request.error','CommitComponentsJob','toUpperCase','exec','constructor','__metadata','../../salesforce/services/salesforce-retriever.service','getOwnPropertyDescriptor',']\x20[Branch:\x20','9CYDIpp','1329804VjsGlo','getBranchRecord','../../../../constants','sha','commitAttachmentId','deleteAttachment','split','../../providers/providers.tokens','gitProvider','Service','send','Completed','FlosumCommitJob','map','(((.+)+)+)+$','branchName','Container','SalesforceSyncService','../../salesforce/services/salesforce-sync.service','patchObject'];a107_0x5ce0=function(){return _0x426bc3;};return a107_0x5ce0();}const core_1=require(a107_0x32db6f(0x1fa)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),typedi_1=require(a107_0x32db6f(0x20b)),errors_1=require(a107_0x32db6f(0x1f5)),bad_request_error_1=require(a107_0x32db6f(0x219)),salesforce_retriever_service_1=require(a107_0x32db6f(0x21f)),salesforce_sync_service_1=require(a107_0x32db6f(0x235)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a107_0x32db6f(0x20d)),constants_1=require(a107_0x32db6f(0x225)),shortid_1=__importDefault(require('shortid')),providers_tokens_1=require(a107_0x32db6f(0x22a));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x188b14,_0x4db5e6,_0x487911){const _0x3b0b48=a107_0x32db6f;this[_0x3b0b48(0x240)]=_0x188b14,this[_0x3b0b48(0x1e7)]=_0x4db5e6,this[_0x3b0b48(0x1d5)]=_0x487911,this[_0x3b0b48(0x212)]=new core_1[(_0x3b0b48(0x1d9))](FlosumCommitJob_1['name']);}async[a107_0x32db6f(0x1f2)](){const _0xc35875=a107_0x32db6f;try{if(this[_0xc35875(0x1d8)][_0xc35875(0x1f7)])this[_0xc35875(0x1fd)]=await this['salesforceSync'][_0xc35875(0x1f9)](this['commitData'][_0xc35875(0x1f7)]);else this[_0xc35875(0x1d8)]['syncBranchId']&&(this[_0xc35875(0x1fd)]=await this['salesforceSync'][_0xc35875(0x224)](this[_0xc35875(0x1d8)][_0xc35875(0x201)]));}catch(_0x36d8c4){throw new bad_request_error_1['BadRequestError'](errors_1[_0xc35875(0x1e0)]);}}async[a107_0x32db6f(0x23e)](){const _0x3bcc19=a107_0x32db6f;if(!this[_0x3bcc19(0x1d8)]['commitAttachmentId'])return[];await this[_0x3bcc19(0x240)][_0x3bcc19(0x236)](constants_1['FLOSUM_ATTACHMENT'],this[_0x3bcc19(0x1d8)][_0x3bcc19(0x227)],{'Name':(0x0,shortid_1['default'])()});const _0x33e74b=await this[_0x3bcc19(0x240)][_0x3bcc19(0x1e9)](this[_0x3bcc19(0x1d8)][_0x3bcc19(0x227)])[_0x3bcc19(0x241)](_0x5518e0=>_0x5518e0[_0x3bcc19(0x229)]('\x20')[_0x3bcc19(0x230)](_0x144171=>_0x144171['trim']()));await this[_0x3bcc19(0x240)]['deleteAttachment'](this[_0x3bcc19(0x1d8)][_0x3bcc19(0x227)]);const _0x12567f=new salesforce_retriever_service_1[(_0x3bcc19(0x216))](this[_0x3bcc19(0x240)]);return await _0x12567f[_0x3bcc19(0x207)](_0x33e74b);}async[a107_0x32db6f(0x239)](){const _0x23a395=a107_0x32db6f;if(!this[_0x23a395(0x1d8)][_0x23a395(0x1fb)])return[];await this[_0x23a395(0x240)][_0x23a395(0x236)](constants_1[_0x23a395(0x1f8)],this[_0x23a395(0x1d8)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0x23a395(0x200)])()});const _0x508570=await this['salesforceService']['retrieveAttachment'](this[_0x23a395(0x1d8)]['deleteAttachmentId']),_0x385d88=JSON['parse'](_0x508570);return await this[_0x23a395(0x240)][_0x23a395(0x228)](this[_0x23a395(0x1d8)]['deleteAttachmentId']),_0x385d88;}async['getCommitDto'](){const _0x42b0e1=a107_0x32db6f,_0x3c1d47=new commit_components_dto_1[(_0x42b0e1(0x205))](),[_0x4afb58,_0x8704c2]=await Promise[_0x42b0e1(0x1ff)]([this[_0x42b0e1(0x23e)](),this['getComponentsToDelete']()]);return _0x3c1d47[_0x42b0e1(0x1db)]=this[_0x42b0e1(0x1d8)][_0x42b0e1(0x1db)],_0x3c1d47['user']=this[_0x42b0e1(0x1d8)][_0x42b0e1(0x206)],_0x3c1d47[_0x42b0e1(0x20c)]={'writed':_0x4afb58,'deleted':_0x8704c2},_0x3c1d47[_0x42b0e1(0x1fe)]=this[_0x42b0e1(0x1e4)]['isConvertToSfdx'],_0x3c1d47[_0x42b0e1(0x23d)]=this[_0x42b0e1(0x1d2)],_0x3c1d47[_0x42b0e1(0x1de)]=this['branch'],_0x3c1d47[_0x42b0e1(0x214)]=this[_0x42b0e1(0x1e4)][_0x42b0e1(0x22b)],_0x3c1d47['recordType']=this[_0x42b0e1(0x1fd)][_0x42b0e1(0x1d6)],_0x3c1d47;}async[a107_0x32db6f(0x1df)](_0x10d852=![]){const _0x23c812=a107_0x32db6f;if(_0x10d852)await this[_0x23c812(0x1d5)]['updateRemoteState'](this['repositoryData'],{});else{const _0x38fe2f=await this[_0x23c812(0x1d2)][_0x23c812(0x213)][_0x23c812(0x1fc)](this[_0x23c812(0x1de)]['name']);this[_0x23c812(0x1e1)][_0x23c812(0x203)](this[_0x23c812(0x218)]+'\x20Update\x20remote\x20state.');const _0x25a68c={[this[_0x23c812(0x1d2)][_0x23c812(0x1f3)]]:{'lastCommit':_0x38fe2f[_0x23c812(0x226)]}};await this[_0x23c812(0x1d5)][_0x23c812(0x1f6)](this[_0x23c812(0x1fd)],_0x25a68c);}}async[a107_0x32db6f(0x21c)](){const _0x1fcee8=a107_0x32db6f,_0x573faa=await this[_0x1fcee8(0x23b)]();await this[_0x1fcee8(0x1d5)][_0x1fcee8(0x1d1)](this[_0x1fcee8(0x1fd)],'In\x20Progress'),await this['commitJob'][_0x1fcee8(0x207)](_0x573faa,this['prefix']),await this[_0x1fcee8(0x1df)](),await this['salesforceSync'][_0x1fcee8(0x1d1)](this['repositoryData'],_0x1fcee8(0x22e));}async['handleCommitJobError'](_0x21b86e){const _0x267732=a107_0x32db6f;try{this[_0x267732(0x1e1)]['error'](''+_0x21b86e),await this[_0x267732(0x1e1)][_0x267732(0x22d)](),await this['updateLastCommit'](!![]),await this['salesforceSync'][_0x267732(0x1d1)](this[_0x267732(0x1fd)],_0x267732(0x215));}catch(_0x313d7a){this[_0x267732(0x212)][_0x267732(0x237)](_0x313d7a);}}async[a107_0x32db6f(0x207)](_0x23f542){const _0xd1df20=a107_0x32db6f;try{this[_0xd1df20(0x1d8)]=_0x23f542,this[_0xd1df20(0x1e5)]=typedi_1['Container']['get'](providers_tokens_1[_0xd1df20(0x1e6)][_0xd1df20(0x1e5)]),this[_0xd1df20(0x217)]=typedi_1[_0xd1df20(0x233)][_0xd1df20(0x1dd)](providers_tokens_1['Tokens'][_0xd1df20(0x23a)]),this[_0xd1df20(0x1e4)]=typedi_1[_0xd1df20(0x233)]['get'](providers_tokens_1['Tokens'][_0xd1df20(0x1e4)]),await this[_0xd1df20(0x1f2)](),this[_0xd1df20(0x1d2)]=await this[_0xd1df20(0x217)][_0xd1df20(0x1fc)](this[_0xd1df20(0x1fd)][_0xd1df20(0x238)]),this['branch']=await this[_0xd1df20(0x1d2)][_0xd1df20(0x213)][_0xd1df20(0x1fc)](this[_0xd1df20(0x1fd)][_0xd1df20(0x232)]),this['sfLogger']=typedi_1[_0xd1df20(0x233)]['get'](providers_tokens_1[_0xd1df20(0x1e6)]['logger']),this[_0xd1df20(0x218)]='[FLOSUM\x20->\x20GIT]\x20['+this[_0xd1df20(0x1e4)][_0xd1df20(0x22b)][_0xd1df20(0x21b)]()+_0xd1df20(0x1d4)+this[_0xd1df20(0x1fd)]['repositoryName']+_0xd1df20(0x221)+this[_0xd1df20(0x1fd)][_0xd1df20(0x232)]+_0xd1df20(0x1e3)+FlosumCommitJob_1[_0xd1df20(0x204)]+']';if(!this[_0xd1df20(0x1fd)])throw new bad_request_error_1[(_0xd1df20(0x202))](errors_1[_0xd1df20(0x1ef)]);await this[_0xd1df20(0x1e1)]['log'](this['prefix']+_0xd1df20(0x1ee))[_0xd1df20(0x22d)](),await this[_0xd1df20(0x21c)]()[_0xd1df20(0x1eb)](_0x4233d5=>this[_0xd1df20(0x210)](_0x4233d5));}catch(_0xfbd021){this[_0xd1df20(0x1d8)]=undefined,this[_0xd1df20(0x212)][_0xd1df20(0x237)](_0xfbd021);throw _0xfbd021;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a107_0x32db6f(0x22c)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a107_0x32db6f(0x1e8)],commit_components_job_1[a107_0x32db6f(0x21a)],salesforce_sync_service_1[a107_0x32db6f(0x234)]])],FlosumCommitJob),exports[a107_0x32db6f(0x22f)]=FlosumCommitJob;