const a105_0x4c7167=a105_0x7cff;(function(_0x2f3f0c,_0x359504){const _0x2b2eb9=a105_0x7cff,_0x221372=_0x2f3f0c();while(!![]){try{const _0x50d743=-parseInt(_0x2b2eb9(0x135))/0x1+-parseInt(_0x2b2eb9(0x16f))/0x2+parseInt(_0x2b2eb9(0x11c))/0x3+-parseInt(_0x2b2eb9(0x159))/0x4*(-parseInt(_0x2b2eb9(0x12a))/0x5)+parseInt(_0x2b2eb9(0x125))/0x6+-parseInt(_0x2b2eb9(0x162))/0x7+parseInt(_0x2b2eb9(0x123))/0x8*(parseInt(_0x2b2eb9(0x14e))/0x9);if(_0x50d743===_0x359504)break;else _0x221372['push'](_0x221372['shift']());}catch(_0x4b1ae2){_0x221372['push'](_0x221372['shift']());}}}(a105_0xbf63,0xb2ddc));const a105_0x4d45a3=(function(){let _0x13573e=!![];return function(_0x397983,_0x38afc3){const _0x37bf17=_0x13573e?function(){const _0x4f667a=a105_0x7cff;if(_0x38afc3){const _0x54f03c=_0x38afc3[_0x4f667a(0x171)](_0x397983,arguments);return _0x38afc3=null,_0x54f03c;}}:function(){};return _0x13573e=![],_0x37bf17;};}()),a105_0x5bb67d=a105_0x4d45a3(this,function(){const _0x3e41ea=a105_0x7cff;return a105_0x5bb67d['toString']()[_0x3e41ea(0x174)](_0x3e41ea(0x165))[_0x3e41ea(0x132)]()[_0x3e41ea(0x153)](a105_0x5bb67d)[_0x3e41ea(0x174)](_0x3e41ea(0x165));});a105_0x5bb67d();function a105_0xbf63(){const _0x2b0c18=['81uBqPfj','getComponentsToWrite','../../salesforce/services/salesforce-sync.service','[FLOSUM\x20->\x20GIT]\x20[','error','constructor','__importDefault','defineProperty','getOwnPropertyDescriptor','ERR_INVALID_SYNC_RECORD_ID','setStatus','2327284sHlQst','../../salesforce/services/salesforce-retriever.service','toUpperCase','__decorate','getOne','logger','FLOSUM_ATTACHMENT','fetchRepositoryData','log','9657683QVaPbt','Container','../../../../core/errors/bad-request.error','(((.+)+)+)+$','getBranchRecord','ERR_UNKNOWN_SYNC_RECORD_ID','default','map','BadRequestError','repositoryData','user','Completed','deleteAttachmentId','1461652NsHVmp','salesforceService','apply','object','all','search','CommitComponentsJob','branches','message','gitUrl','updateRemoteState','commitAttachmentId','sfLogger','Error','length','repo','split','then','3458535HSCwLF','function','../../salesforce/services/salesforce.service','name','gitApiService','../../../../core',']\x20[','297272IrPfci','config','7792440wTMbQT','SalesforceRetrieverService','gitProvider','run','Service','5woTASc','SalesforceService','send','repoService','commitJob','branchName','syncRepositoryId','decorate','toString','exec','getComponentsToDelete','524706bbjHOB','get','CommitComponentsDto','isConvertToSfdx','SalesforceSyncService','FlosumCommitJob','salesforceSync','repositoryName','handleCommitJobError','Tokens','provider','commitData','metadata','../dto/commit-components.dto','updateLastCommit','branch','gitRepoService',']\x20[Branch:\x20','repository','design:paramtypes','getRepositoryRecord','prefix','__metadata','deleteAttachment','shortid'];a105_0xbf63=function(){return _0x2b0c18;};return a105_0xbf63();}'use strict';var __decorate=this&&this[a105_0x4c7167(0x15c)]||function(_0xe2b28d,_0x4e89fc,_0x33b956,_0x31c88e){const _0xc421d0=a105_0x4c7167;var _0x4fef96=arguments['length'],_0x592380=_0x4fef96<0x3?_0x4e89fc:_0x31c88e===null?_0x31c88e=Object[_0xc421d0(0x156)](_0x4e89fc,_0x33b956):_0x31c88e,_0xb243bf;if(typeof Reflect==='object'&&typeof Reflect[_0xc421d0(0x131)]===_0xc421d0(0x11d))_0x592380=Reflect[_0xc421d0(0x131)](_0xe2b28d,_0x4e89fc,_0x33b956,_0x31c88e);else{for(var _0x42c7ce=_0xe2b28d[_0xc421d0(0x118)]-0x1;_0x42c7ce>=0x0;_0x42c7ce--)if(_0xb243bf=_0xe2b28d[_0x42c7ce])_0x592380=(_0x4fef96<0x3?_0xb243bf(_0x592380):_0x4fef96>0x3?_0xb243bf(_0x4e89fc,_0x33b956,_0x592380):_0xb243bf(_0x4e89fc,_0x33b956))||_0x592380;}return _0x4fef96>0x3&&_0x592380&&Object[_0xc421d0(0x155)](_0x4e89fc,_0x33b956,_0x592380),_0x592380;},__metadata=this&&this[a105_0x4c7167(0x14b)]||function(_0x1c66cb,_0x47b086){const _0x492222=a105_0x4c7167;if(typeof Reflect===_0x492222(0x172)&&typeof Reflect[_0x492222(0x141)]===_0x492222(0x11d))return Reflect[_0x492222(0x141)](_0x1c66cb,_0x47b086);},__importDefault=this&&this[a105_0x4c7167(0x154)]||function(_0x1e9d67){return _0x1e9d67&&_0x1e9d67['__esModule']?_0x1e9d67:{'default':_0x1e9d67};},FlosumCommitJob_1;Object[a105_0x4c7167(0x155)](exports,'__esModule',{'value':!![]}),exports[a105_0x4c7167(0x13a)]=void 0x0;const core_1=require(a105_0x4c7167(0x121)),salesforce_service_1=require(a105_0x4c7167(0x11e)),typedi_1=require('typedi'),errors_1=require('../../../../constants/errors'),bad_request_error_1=require(a105_0x4c7167(0x164)),salesforce_retriever_service_1=require(a105_0x4c7167(0x15a)),salesforce_sync_service_1=require(a105_0x4c7167(0x150)),commit_components_dto_1=require(a105_0x4c7167(0x142)),commit_components_job_1=require('./commit-components.job'),constants_1=require('../../../../constants'),shortid_1=__importDefault(require(a105_0x4c7167(0x14d))),providers_tokens_1=require('../../providers/providers.tokens');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x5e80de,_0x10f2e6,_0x1d6063){const _0x30d38c=a105_0x4c7167;this[_0x30d38c(0x170)]=_0x5e80de,this[_0x30d38c(0x12e)]=_0x10f2e6,this['salesforceSync']=_0x1d6063,this[_0x30d38c(0x15e)]=new core_1['Logger'](FlosumCommitJob_1[_0x30d38c(0x11f)]);}async[a105_0x4c7167(0x160)](){const _0x453ddc=a105_0x4c7167;try{if(this[_0x453ddc(0x140)][_0x453ddc(0x130)])this[_0x453ddc(0x16b)]=await this[_0x453ddc(0x13b)][_0x453ddc(0x149)](this[_0x453ddc(0x140)][_0x453ddc(0x130)]);else this[_0x453ddc(0x140)]['syncBranchId']&&(this['repositoryData']=await this['salesforceSync'][_0x453ddc(0x166)](this[_0x453ddc(0x140)]['syncBranchId']));}catch(_0x12401b){throw new bad_request_error_1[(_0x453ddc(0x16a))](errors_1[_0x453ddc(0x157)]);}}async['getComponentsToWrite'](){const _0x37f85c=a105_0x4c7167;if(!this[_0x37f85c(0x140)][_0x37f85c(0x115)])return[];await this[_0x37f85c(0x170)]['patchObject'](constants_1['FLOSUM_ATTACHMENT'],this[_0x37f85c(0x140)][_0x37f85c(0x115)],{'Name':(0x0,shortid_1[_0x37f85c(0x168)])()});const _0x4e150d=await this['salesforceService']['retrieveAttachment'](this['commitData'][_0x37f85c(0x115)])[_0x37f85c(0x11b)](_0x372008=>_0x372008[_0x37f85c(0x11a)]('\x20')[_0x37f85c(0x169)](_0x4216d6=>_0x4216d6['trim']()));await this['salesforceService'][_0x37f85c(0x14c)](this[_0x37f85c(0x140)][_0x37f85c(0x115)]);const _0x1ce11d=new salesforce_retriever_service_1[(_0x37f85c(0x126))](this['salesforceService']);return await _0x1ce11d[_0x37f85c(0x128)](_0x4e150d);}async[a105_0x4c7167(0x134)](){const _0x41db7e=a105_0x4c7167;if(!this[_0x41db7e(0x140)][_0x41db7e(0x16e)])return[];await this[_0x41db7e(0x170)]['patchObject'](constants_1[_0x41db7e(0x15f)],this[_0x41db7e(0x140)][_0x41db7e(0x16e)],{'Name':(0x0,shortid_1['default'])()});const _0x249c98=await this[_0x41db7e(0x170)]['retrieveAttachment'](this[_0x41db7e(0x140)][_0x41db7e(0x16e)]);return await this[_0x41db7e(0x170)]['deleteAttachment'](this[_0x41db7e(0x140)]['deleteAttachmentId']),_0x249c98;}async['getCommitDto'](){const _0xef7bf0=a105_0x4c7167,_0x3b8e2e=new commit_components_dto_1[(_0xef7bf0(0x137))](),[_0x37a001,_0x1a856e]=await Promise[_0xef7bf0(0x173)]([this[_0xef7bf0(0x14f)](),this['getComponentsToDelete']()]);return _0x3b8e2e[_0xef7bf0(0x177)]=this[_0xef7bf0(0x140)]['message'],_0x3b8e2e[_0xef7bf0(0x16c)]=this[_0xef7bf0(0x140)][_0xef7bf0(0x16c)],_0x3b8e2e['components']={'writed':_0x37a001,'deleted':_0x1a856e},_0x3b8e2e['convertToSFDX']=this[_0xef7bf0(0x124)][_0xef7bf0(0x138)],_0x3b8e2e[_0xef7bf0(0x119)]=this['repository'],_0x3b8e2e[_0xef7bf0(0x144)]=this[_0xef7bf0(0x144)],_0x3b8e2e[_0xef7bf0(0x13f)]=this[_0xef7bf0(0x124)][_0xef7bf0(0x127)],_0x3b8e2e;}async['updateLastCommit'](_0x15d492=![]){const _0x30a5d8=a105_0x4c7167;if(_0x15d492)await this[_0x30a5d8(0x13b)][_0x30a5d8(0x114)](this['repositoryData'],{});else{const _0xe4c9cc=await this[_0x30a5d8(0x147)][_0x30a5d8(0x176)][_0x30a5d8(0x15d)](this[_0x30a5d8(0x144)][_0x30a5d8(0x11f)]);this[_0x30a5d8(0x116)][_0x30a5d8(0x161)](this['prefix']+'\x20Update\x20remote\x20state.');const _0x55ab14={[this['repository'][_0x30a5d8(0x178)]]:{'lastCommit':_0xe4c9cc['sha']}};await this[_0x30a5d8(0x13b)][_0x30a5d8(0x114)](this[_0x30a5d8(0x16b)],_0x55ab14);}}async[a105_0x4c7167(0x133)](){const _0x5934e0=a105_0x4c7167,_0x59803a=await this['getCommitDto']();await this['salesforceSync'][_0x5934e0(0x158)](this['repositoryData'],'In\x20Progress'),await this[_0x5934e0(0x12e)][_0x5934e0(0x128)](_0x59803a,this[_0x5934e0(0x14a)]),await this['updateLastCommit'](),await this['salesforceSync'][_0x5934e0(0x158)](this[_0x5934e0(0x16b)],_0x5934e0(0x16d));}async[a105_0x4c7167(0x13d)](_0x41eb9c){const _0x4c4627=a105_0x4c7167;try{this[_0x4c4627(0x116)]['error'](''+_0x41eb9c),await this[_0x4c4627(0x116)][_0x4c4627(0x12c)](),await this[_0x4c4627(0x143)](!![]),await this['salesforceSync']['setStatus'](this[_0x4c4627(0x16b)],_0x4c4627(0x117));}catch(_0x353d10){this[_0x4c4627(0x15e)][_0x4c4627(0x152)](_0x353d10);}}async[a105_0x4c7167(0x128)](_0x234647){const _0x1cbafe=a105_0x4c7167;try{this['commitData']=_0x234647,this[_0x1cbafe(0x120)]=typedi_1[_0x1cbafe(0x163)][_0x1cbafe(0x136)](providers_tokens_1[_0x1cbafe(0x13e)][_0x1cbafe(0x120)]),this[_0x1cbafe(0x12d)]=typedi_1[_0x1cbafe(0x163)][_0x1cbafe(0x136)](providers_tokens_1['Tokens'][_0x1cbafe(0x145)]),this[_0x1cbafe(0x124)]=typedi_1[_0x1cbafe(0x163)][_0x1cbafe(0x136)](providers_tokens_1[_0x1cbafe(0x13e)]['config']),await this[_0x1cbafe(0x160)](),this['repository']=await this[_0x1cbafe(0x12d)][_0x1cbafe(0x15d)](this[_0x1cbafe(0x16b)][_0x1cbafe(0x13c)]),this[_0x1cbafe(0x144)]=await this[_0x1cbafe(0x147)][_0x1cbafe(0x176)]['getOne'](this['repositoryData'][_0x1cbafe(0x12f)]),this['sfLogger']=typedi_1[_0x1cbafe(0x163)]['get'](providers_tokens_1['Tokens'][_0x1cbafe(0x15e)]),this[_0x1cbafe(0x14a)]=_0x1cbafe(0x151)+this[_0x1cbafe(0x124)][_0x1cbafe(0x127)][_0x1cbafe(0x15b)]()+']\x20[Repository:\x20'+this[_0x1cbafe(0x16b)]['repositoryName']+_0x1cbafe(0x146)+this[_0x1cbafe(0x16b)]['branchName']+_0x1cbafe(0x122)+FlosumCommitJob_1[_0x1cbafe(0x11f)]+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x1cbafe(0x16a))](errors_1[_0x1cbafe(0x167)]);await this[_0x1cbafe(0x116)][_0x1cbafe(0x161)](this[_0x1cbafe(0x14a)]+'\x20Start\x20Flosum\x20commit\x20job.')[_0x1cbafe(0x12c)](),await this['exec']()['catch'](_0x3edc21=>this[_0x1cbafe(0x13d)](_0x3edc21));}catch(_0x31e8e9){this[_0x1cbafe(0x140)]=undefined,this['logger'][_0x1cbafe(0x152)](_0x31e8e9);throw _0x31e8e9;}}};function a105_0x7cff(_0x186b73,_0x2df8ae){const _0x2c735e=a105_0xbf63();return a105_0x7cff=function(_0x5bb67d,_0x4d45a3){_0x5bb67d=_0x5bb67d-0x114;let _0xbf637a=_0x2c735e[_0x5bb67d];return _0xbf637a;},a105_0x7cff(_0x186b73,_0x2df8ae);}FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a105_0x4c7167(0x129)])({'transient':!![]}),__metadata(a105_0x4c7167(0x148),[salesforce_service_1[a105_0x4c7167(0x12b)],commit_components_job_1[a105_0x4c7167(0x175)],salesforce_sync_service_1[a105_0x4c7167(0x139)]])],FlosumCommitJob),exports[a105_0x4c7167(0x13a)]=FlosumCommitJob;