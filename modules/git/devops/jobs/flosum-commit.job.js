const a126_0x357738=a126_0x2fba;(function(_0x27e471,_0x59c8e7){const _0xfced04=a126_0x2fba,_0x52e7e8=_0x27e471();while(!![]){try{const _0x264ec8=parseInt(_0xfced04(0x11e))/0x1+parseInt(_0xfced04(0x13a))/0x2+-parseInt(_0xfced04(0x133))/0x3+-parseInt(_0xfced04(0x149))/0x4*(-parseInt(_0xfced04(0x122))/0x5)+parseInt(_0xfced04(0xfa))/0x6*(parseInt(_0xfced04(0x151))/0x7)+parseInt(_0xfced04(0x106))/0x8*(-parseInt(_0xfced04(0x155))/0x9)+-parseInt(_0xfced04(0x14c))/0xa;if(_0x264ec8===_0x59c8e7)break;else _0x52e7e8['push'](_0x52e7e8['shift']());}catch(_0x5ec138){_0x52e7e8['push'](_0x52e7e8['shift']());}}}(a126_0x1794,0x37e41));const a126_0x1afc8a=(function(){let _0x4208f3=!![];return function(_0x319bf9,_0x21ca60){const _0x2dd96d=_0x4208f3?function(){const _0x1416f5=a126_0x2fba;if(_0x21ca60){const _0x1ed717=_0x21ca60[_0x1416f5(0x145)](_0x319bf9,arguments);return _0x21ca60=null,_0x1ed717;}}:function(){};return _0x4208f3=![],_0x2dd96d;};}()),a126_0x46f8b5=a126_0x1afc8a(this,function(){const _0x1568d0=a126_0x2fba;return a126_0x46f8b5[_0x1568d0(0x144)]()[_0x1568d0(0xf0)](_0x1568d0(0x14f))[_0x1568d0(0x144)]()[_0x1568d0(0x12c)](a126_0x46f8b5)[_0x1568d0(0xf0)](_0x1568d0(0x14f));});a126_0x46f8b5();'use strict';var __decorate=this&&this[a126_0x357738(0xec)]||function(_0x2a2c36,_0x134b41,_0x5a8d9d,_0x80e7c8){const _0x175d4a=a126_0x357738;var _0x14e9ec=arguments[_0x175d4a(0x146)],_0x308ccd=_0x14e9ec<0x3?_0x134b41:_0x80e7c8===null?_0x80e7c8=Object[_0x175d4a(0xf7)](_0x134b41,_0x5a8d9d):_0x80e7c8,_0x1c59cc;if(typeof Reflect===_0x175d4a(0x117)&&typeof Reflect[_0x175d4a(0x12d)]==='function')_0x308ccd=Reflect['decorate'](_0x2a2c36,_0x134b41,_0x5a8d9d,_0x80e7c8);else{for(var _0x112690=_0x2a2c36[_0x175d4a(0x146)]-0x1;_0x112690>=0x0;_0x112690--)if(_0x1c59cc=_0x2a2c36[_0x112690])_0x308ccd=(_0x14e9ec<0x3?_0x1c59cc(_0x308ccd):_0x14e9ec>0x3?_0x1c59cc(_0x134b41,_0x5a8d9d,_0x308ccd):_0x1c59cc(_0x134b41,_0x5a8d9d))||_0x308ccd;}return _0x14e9ec>0x3&&_0x308ccd&&Object[_0x175d4a(0x139)](_0x134b41,_0x5a8d9d,_0x308ccd),_0x308ccd;},__metadata=this&&this[a126_0x357738(0x107)]||function(_0x125b41,_0x3cc308){const _0x144013=a126_0x357738;if(typeof Reflect===_0x144013(0x117)&&typeof Reflect[_0x144013(0x132)]===_0x144013(0xee))return Reflect[_0x144013(0x132)](_0x125b41,_0x3cc308);},__importDefault=this&&this[a126_0x357738(0x116)]||function(_0x108483){const _0xaf41b4=a126_0x357738;return _0x108483&&_0x108483[_0xaf41b4(0x157)]?_0x108483:{'default':_0x108483};},FlosumCommitJob_1;function a126_0x1794(){const _0x1ef03f=[']\x20[Branch:\x20','isEmailNotificationsEnabled','convertToSFDX','105ViOlaE','branch','commitJob','Completed','sfLogger','deleteAttachmentId','recordType','prefix','isConvertToSfdx','gitProvider','constructor','decorate','branchName','toUpperCase','map','run','metadata','203445KKFiyA','gitUrl','trim','message','getOne','exec','defineProperty','16930SKgKjj','ERR_INVALID_SYNC_RECORD_ID','../../../../core','get','getCommitDto','../../../../constants/errors','../../providers/providers.tokens','getComponentsToDelete','handleCommitJobError','CommitToGitErrorNotification','toString','apply','length','parse','../dto/commit-components.dto','81628UVmVvF','updateLastCommit','send','4921640WQOpTe','email','log','(((.+)+)+)+$','design:paramtypes','7TOZqWo','info','retrieveAttachment','Error','81lRXmwM','execute','__esModule','default','Container','Service','typedi','user','commitData','shortid','provider','syncBranchId','../../../../core/errors/bad-request.error','[FLOSUM\x20->\x20GIT]\x20[','recordTypeName',']\x20[','__decorate','name','function','salesforceService','search','CommitToGitCompletedNotification','setStatus','../../notifications/commit-to-git-completed.notification','../../../../constants','repo','../../salesforce/services/salesforce.service','getOwnPropertyDescriptor','salesforceSync','repository','1572702bLFvzX','syncRepositoryId','Tokens','\x20Start\x20Flosum\x20commit\x20job.','FLOSUM_ATTACHMENT','repositoryName','getRepositoryRecord','getComponentsToWrite','deleteAttachment','commitAttachmentId','patchObject','In\x20Progress','48192WzZGTT','__metadata','split','gitRepoService','logger','error','Email\x20notifications\x20are\x20disabled.','completeNotification','config','BadRequestError','../../notifications/commit-to-git-error.notification','FlosumCommitJob','SalesforceRetrieverService','fetchRepositoryData','updateRemoteState','sha','__importDefault','object','then','../../salesforce/services/salesforce-retriever.service','../../salesforce/services/salesforce-sync.service','catch','repoService','repositoryData','143995WxWJIP'];a126_0x1794=function(){return _0x1ef03f;};return a126_0x1794();}Object[a126_0x357738(0x139)](exports,'__esModule',{'value':!![]}),exports['FlosumCommitJob']=void 0x0;function a126_0x2fba(_0xc86e4d,_0x1d208a){const _0x5e64e2=a126_0x1794();return a126_0x2fba=function(_0x46f8b5,_0x1afc8a){_0x46f8b5=_0x46f8b5-0xe4;let _0x17946b=_0x5e64e2[_0x46f8b5];return _0x17946b;},a126_0x2fba(_0xc86e4d,_0x1d208a);}const core_1=require(a126_0x357738(0x13c)),salesforce_service_1=require(a126_0x357738(0xf6)),typedi_1=require(a126_0x357738(0x15b)),errors_1=require(a126_0x357738(0x13f)),bad_request_error_1=require(a126_0x357738(0xe8)),salesforce_retriever_service_1=require(a126_0x357738(0x119)),salesforce_sync_service_1=require(a126_0x357738(0x11a)),commit_components_dto_1=require(a126_0x357738(0x148)),commit_components_job_1=require('./commit-components.job'),constants_1=require(a126_0x357738(0xf4)),shortid_1=__importDefault(require(a126_0x357738(0xe5))),providers_tokens_1=require(a126_0x357738(0x140)),commit_to_git_completed_notification_1=require(a126_0x357738(0xf3)),commit_to_git_error_notification_1=require(a126_0x357738(0x110));let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x397081,_0x43f323,_0x26ef75){const _0x2842f6=a126_0x357738;this[_0x2842f6(0xef)]=_0x397081,this[_0x2842f6(0x124)]=_0x43f323,this['salesforceSync']=_0x26ef75,this[_0x2842f6(0x10a)]=new core_1['Logger'](FlosumCommitJob_1[_0x2842f6(0xed)]);}async['completeNotification'](_0x594eb1,_0x1875bd,_0x165471,_0x493f41){const _0x1fbea1=a126_0x357738;if(!this['commitData']['isEmailNotificationsEnabled']){this[_0x1fbea1(0x10a)][_0x1fbea1(0x152)](_0x1fbea1(0x10c));return;}await new commit_to_git_completed_notification_1['CommitToGitCompletedNotification']({'emails':_0x594eb1,'gitProvider':_0x1875bd,'completionTime':new Date(),'loggerName':commit_to_git_completed_notification_1[_0x1fbea1(0xf1)][_0x1fbea1(0xed)],'repositoryName':_0x165471,'branchName':_0x493f41})[_0x1fbea1(0x156)]();}async['errorNotification'](_0x5609f3,_0x3cfb40,_0x216ad5,_0x2161e2){const _0xaab8b9=a126_0x357738;if(!this['commitData'][_0xaab8b9(0x120)]){this['logger'][_0xaab8b9(0x152)](_0xaab8b9(0x10c));return;}await new commit_to_git_error_notification_1[(_0xaab8b9(0x143))]({'emails':_0x5609f3,'gitProvider':_0x3cfb40,'completionTime':new Date(),'loggerName':commit_to_git_error_notification_1[_0xaab8b9(0x143)]['name'],'repositoryName':_0x216ad5,'branchName':_0x2161e2})[_0xaab8b9(0x156)]();}async[a126_0x357738(0x113)](){const _0x3f8f6b=a126_0x357738;try{if(this[_0x3f8f6b(0xe4)]['syncRepositoryId'])this[_0x3f8f6b(0x11d)]=await this['salesforceSync'][_0x3f8f6b(0x100)](this['commitData'][_0x3f8f6b(0xfb)]);else this[_0x3f8f6b(0xe4)][_0x3f8f6b(0xe7)]&&(this[_0x3f8f6b(0x11d)]=await this[_0x3f8f6b(0xf8)]['getBranchRecord'](this['commitData']['syncBranchId']));}catch(_0x552b89){throw new bad_request_error_1[(_0x3f8f6b(0x10f))](errors_1[_0x3f8f6b(0x13b)]);}}async[a126_0x357738(0x101)](){const _0x2a8dd2=a126_0x357738;if(!this[_0x2a8dd2(0xe4)][_0x2a8dd2(0x103)])return[];await this[_0x2a8dd2(0xef)][_0x2a8dd2(0x104)](constants_1['FLOSUM_ATTACHMENT'],this[_0x2a8dd2(0xe4)][_0x2a8dd2(0x103)],{'Name':(0x0,shortid_1[_0x2a8dd2(0x158)])()});const _0x1a7164=await this[_0x2a8dd2(0xef)][_0x2a8dd2(0x153)](this[_0x2a8dd2(0xe4)][_0x2a8dd2(0x103)])[_0x2a8dd2(0x118)](_0x4e7208=>_0x4e7208[_0x2a8dd2(0x108)]('\x20')[_0x2a8dd2(0x130)](_0x386d95=>_0x386d95[_0x2a8dd2(0x135)]()));await this[_0x2a8dd2(0xef)][_0x2a8dd2(0x102)](this[_0x2a8dd2(0xe4)][_0x2a8dd2(0x103)]);const _0x35ef9a=new salesforce_retriever_service_1[(_0x2a8dd2(0x112))](this[_0x2a8dd2(0xef)]);return await _0x35ef9a[_0x2a8dd2(0x131)](_0x1a7164);}async[a126_0x357738(0x141)](){const _0x84eb4d=a126_0x357738;if(!this[_0x84eb4d(0xe4)][_0x84eb4d(0x127)])return[];await this[_0x84eb4d(0xef)][_0x84eb4d(0x104)](constants_1[_0x84eb4d(0xfe)],this[_0x84eb4d(0xe4)]['deleteAttachmentId'],{'Name':(0x0,shortid_1[_0x84eb4d(0x158)])()});const _0x4179c7=await this[_0x84eb4d(0xef)][_0x84eb4d(0x153)](this[_0x84eb4d(0xe4)]['deleteAttachmentId']),_0xb74993=JSON[_0x84eb4d(0x147)](_0x4179c7);return await this['salesforceService']['deleteAttachment'](this[_0x84eb4d(0xe4)][_0x84eb4d(0x127)]),_0xb74993;}async[a126_0x357738(0x13e)](){const _0x19b0fc=a126_0x357738,_0x16c5b9=new commit_components_dto_1['CommitComponentsDto'](),[_0x307229,_0x3e0da8]=await Promise['all']([this[_0x19b0fc(0x101)](),this[_0x19b0fc(0x141)]()]);return _0x16c5b9[_0x19b0fc(0x136)]=this['commitData'][_0x19b0fc(0x136)],_0x16c5b9[_0x19b0fc(0x15c)]=this[_0x19b0fc(0xe4)]['user'],_0x16c5b9['components']={'writed':_0x307229,'deleted':_0x3e0da8},_0x16c5b9[_0x19b0fc(0x121)]=this['config'][_0x19b0fc(0x12a)],_0x16c5b9[_0x19b0fc(0xf5)]=this[_0x19b0fc(0xf9)],_0x16c5b9[_0x19b0fc(0x123)]=this[_0x19b0fc(0x123)],_0x16c5b9[_0x19b0fc(0xe6)]=this[_0x19b0fc(0x10e)][_0x19b0fc(0x12b)],_0x16c5b9[_0x19b0fc(0x128)]=this[_0x19b0fc(0x11d)][_0x19b0fc(0xea)],_0x16c5b9;}async[a126_0x357738(0x14a)](_0x4a8410=![]){const _0x909819=a126_0x357738;if(_0x4a8410)await this[_0x909819(0xf8)]['updateRemoteState'](this[_0x909819(0x11d)],{});else{const _0x57c324=await this['repository']['branches'][_0x909819(0x137)](this[_0x909819(0x123)][_0x909819(0xed)]);this[_0x909819(0x126)]['log'](this[_0x909819(0x129)]+'\x20Update\x20remote\x20state.');const _0x32cc35={[this[_0x909819(0xf9)][_0x909819(0x134)]]:{'lastCommit':_0x57c324[_0x909819(0x115)]}};await this['salesforceSync'][_0x909819(0x114)](this[_0x909819(0x11d)],_0x32cc35);}}async[a126_0x357738(0x138)](){const _0x47723a=a126_0x357738,_0xdbdd38=await this[_0x47723a(0x13e)]();await this[_0x47723a(0xf8)][_0x47723a(0xf2)](this[_0x47723a(0x11d)],_0x47723a(0x105)),await this[_0x47723a(0x124)][_0x47723a(0x131)](_0xdbdd38,this[_0x47723a(0x129)]),await this[_0x47723a(0x14a)](),await this[_0x47723a(0xf8)][_0x47723a(0xf2)](this[_0x47723a(0x11d)],_0x47723a(0x125));}async['handleCommitJobError'](_0x5f1a85){const _0x2521aa=a126_0x357738;try{this[_0x2521aa(0x126)]['error'](''+_0x5f1a85),await this[_0x2521aa(0x126)][_0x2521aa(0x14b)](),await this[_0x2521aa(0x14a)](!![]),await this[_0x2521aa(0xf8)][_0x2521aa(0xf2)](this[_0x2521aa(0x11d)],_0x2521aa(0x154)),await this[_0x2521aa(0x10d)]([this[_0x2521aa(0xe4)][_0x2521aa(0x15c)]['email']],this[_0x2521aa(0x10e)][_0x2521aa(0x12b)],this[_0x2521aa(0xf9)][_0x2521aa(0xed)],this[_0x2521aa(0x123)]['name']);}catch(_0x5b031f){this[_0x2521aa(0x10a)][_0x2521aa(0x10b)](_0x5b031f),await this['errorNotification']([this[_0x2521aa(0xe4)]['user'][_0x2521aa(0x14d)]],this['config'][_0x2521aa(0x12b)],this[_0x2521aa(0xf9)][_0x2521aa(0xed)],this[_0x2521aa(0x123)][_0x2521aa(0xed)]);}}async[a126_0x357738(0x131)](_0x170bed){const _0x5328fe=a126_0x357738;try{this[_0x5328fe(0xe4)]=_0x170bed,this['gitApiService']=typedi_1[_0x5328fe(0x159)]['get'](providers_tokens_1[_0x5328fe(0xfc)]['gitApiService']),this[_0x5328fe(0x11c)]=typedi_1[_0x5328fe(0x159)][_0x5328fe(0x13d)](providers_tokens_1[_0x5328fe(0xfc)][_0x5328fe(0x109)]),this[_0x5328fe(0x10e)]=typedi_1[_0x5328fe(0x159)]['get'](providers_tokens_1[_0x5328fe(0xfc)]['config']),await this['fetchRepositoryData'](),this[_0x5328fe(0xf9)]=await this[_0x5328fe(0x11c)]['getOne'](this[_0x5328fe(0x11d)][_0x5328fe(0xff)]),this['branch']=await this[_0x5328fe(0xf9)]['branches'][_0x5328fe(0x137)](this[_0x5328fe(0x11d)][_0x5328fe(0x12e)]),this[_0x5328fe(0x126)]=typedi_1[_0x5328fe(0x159)][_0x5328fe(0x13d)](providers_tokens_1[_0x5328fe(0xfc)][_0x5328fe(0x10a)]),this[_0x5328fe(0x129)]=_0x5328fe(0xe9)+this['config'][_0x5328fe(0x12b)][_0x5328fe(0x12f)]()+']\x20[Repository:\x20'+this[_0x5328fe(0x11d)][_0x5328fe(0xff)]+_0x5328fe(0x11f)+this[_0x5328fe(0x11d)]['branchName']+_0x5328fe(0xeb)+FlosumCommitJob_1['name']+']';if(!this['repositoryData'])throw new bad_request_error_1[(_0x5328fe(0x10f))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);await this[_0x5328fe(0x126)][_0x5328fe(0x14e)](this[_0x5328fe(0x129)]+_0x5328fe(0xfd))['send'](),await this[_0x5328fe(0x138)]()[_0x5328fe(0x11b)](_0x5d462b=>this[_0x5328fe(0x142)](_0x5d462b)),await this['completeNotification']([this[_0x5328fe(0xe4)][_0x5328fe(0x15c)][_0x5328fe(0x14d)]],this[_0x5328fe(0x10e)]['gitProvider'],this[_0x5328fe(0xf9)]['name'],this[_0x5328fe(0x123)]['name']);}catch(_0x5ddbaa){this[_0x5328fe(0xe4)]=undefined,this[_0x5328fe(0x10a)][_0x5328fe(0x10b)](_0x5ddbaa),await this['errorNotification']([this[_0x5328fe(0xe4)][_0x5328fe(0x15c)][_0x5328fe(0x14d)]],this[_0x5328fe(0x10e)][_0x5328fe(0x12b)],this[_0x5328fe(0xf9)][_0x5328fe(0xed)],this[_0x5328fe(0x123)][_0x5328fe(0xed)]);throw _0x5ddbaa;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([(0x0,typedi_1[a126_0x357738(0x15a)])({'transient':!![]}),__metadata(a126_0x357738(0x150),[salesforce_service_1['SalesforceService'],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1['SalesforceSyncService']])],FlosumCommitJob),exports[a126_0x357738(0x111)]=FlosumCommitJob;