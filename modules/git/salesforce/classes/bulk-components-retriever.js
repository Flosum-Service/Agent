const a258_0x14750e=a258_0x41aa;(function(_0x4aece7,_0x5c0452){const _0x74319=a258_0x41aa,_0x3a1997=_0x4aece7();while(!![]){try{const _0x49f6bf=parseInt(_0x74319(0x9b))/0x1+parseInt(_0x74319(0x7f))/0x2*(parseInt(_0x74319(0x8c))/0x3)+-parseInt(_0x74319(0xac))/0x4+-parseInt(_0x74319(0x8f))/0x5+-parseInt(_0x74319(0xa2))/0x6+-parseInt(_0x74319(0xa6))/0x7*(-parseInt(_0x74319(0x7d))/0x8)+-parseInt(_0x74319(0x8a))/0x9;if(_0x49f6bf===_0x5c0452)break;else _0x3a1997['push'](_0x3a1997['shift']());}catch(_0x27ba3f){_0x3a1997['push'](_0x3a1997['shift']());}}}(a258_0x30d6,0x76630));function a258_0x30d6(){const _0x522215=['select','execute','retrieve','retrieveAttachments','search','@flosum/salesforce','5357835JLaLXt','mkdir','2478318zuoWty','error','(((.+)+)+)+$','3908325JXmdhM','logger','Attachment','retrieveComponents','splice','from','where','BulkV1QueryContentType','Version__c','fs/promises','Parent\x20record\x20(%s)\x20for\x20file\x20(%s)\x20was\x20not\x20found.','getIsDone','945580ZsKgAc','body','SalesforceConstants','request','FLOSUM_NAMESPACE','toString','components','961320WvvVjJ','Body','length','Component_Name__c','2073666sAzcrC','QueryBuilder','pipe','__esModule','ParentId\x20IN\x20(:ids)','Id\x20IN\x20(:ids)','1368200IccXge','ids','Bulk1JobOperation','name','Name','BulkComponentsRetriever','16jRnGmN','ParentId','2opQZzF','../../internal/fs.internal','tmpPath','API','Component__r.'];a258_0x30d6=function(){return _0x522215;};return a258_0x30d6();}const a258_0x31a1fc=(function(){let _0x5b3468=!![];return function(_0x35f5c7,_0x47474f){const _0x16a9c9=_0x5b3468?function(){if(_0x47474f){const _0x2b6a1c=_0x47474f['apply'](_0x35f5c7,arguments);return _0x47474f=null,_0x2b6a1c;}}:function(){};return _0x5b3468=![],_0x16a9c9;};}()),a258_0x507dd3=a258_0x31a1fc(this,function(){const _0xee0fa7=a258_0x41aa;return a258_0x507dd3[_0xee0fa7(0xa0)]()[_0xee0fa7(0x88)](_0xee0fa7(0x8e))[_0xee0fa7(0xa0)]()['constructor'](a258_0x507dd3)[_0xee0fa7(0x88)](_0xee0fa7(0x8e));});a258_0x507dd3();'use strict';function a258_0x41aa(_0x54ca42,_0x20133c){const _0x3f8ac2=a258_0x30d6();return a258_0x41aa=function(_0x507dd3,_0x31a1fc){_0x507dd3=_0x507dd3-0x79;let _0x30d657=_0x3f8ac2[_0x507dd3];return _0x30d657;},a258_0x41aa(_0x54ca42,_0x20133c);}Object['defineProperty'](exports,a258_0x14750e(0xa9),{'value':!![]}),exports[a258_0x14750e(0x7c)]=void 0x0;const salesforce_1=require(a258_0x14750e(0x89)),core_1=require('../../../../core'),constants_1=require('../../../../constants'),promises_1=require(a258_0x14750e(0x98)),fs_internal_1=require(a258_0x14750e(0x80)),path_1=require('../../../../configs/path'),BINARY_FIELDS=[a258_0x14750e(0xa3)],MAX_IDS_CHUNK_LENGTH=0xfa0;class BulkComponentsRetriever{constructor({request:_0x577359,ids:_0xa7d768}){const _0x2c95e0=a258_0x14750e;this['components']=new Map(),this[_0x2c95e0(0x9e)]=_0x577359,this['ids']=_0xa7d768,this[_0x2c95e0(0x90)]=new core_1['Logger'](BulkComponentsRetriever[_0x2c95e0(0x7a)]);}async[a258_0x14750e(0x92)](_0x365460){const _0x27cbfc=a258_0x14750e,_0x57c8a1=new salesforce_1['QueryBuilder']()[_0x27cbfc(0x84)]('Id',constants_1[_0x27cbfc(0x9f)]+_0x27cbfc(0x83)+constants_1[_0x27cbfc(0x9f)]+_0x27cbfc(0xa5),constants_1[_0x27cbfc(0x9f)]+'Version__c')['from'](constants_1[_0x27cbfc(0x9f)]+'Component_History__c')[_0x27cbfc(0x95)](_0x27cbfc(0xab),{'ids':_0x365460}),_0x1b5733=new salesforce_1['CompositeRetrieveData']({'api':salesforce_1[_0x27cbfc(0x9d)]['API'],'queryBuilder':_0x57c8a1,'instance':this[_0x27cbfc(0x9e)],'isTooling':![]});do{const {records:_0x164a1b}=await _0x1b5733[_0x27cbfc(0x85)]();for(const _0x4f5625 of _0x164a1b){this[_0x27cbfc(0xa1)]['set'](_0x4f5625['Id'],{'fileName':_0x4f5625[constants_1[_0x27cbfc(0x9f)]+'Component__r'][constants_1[_0x27cbfc(0x9f)]+_0x27cbfc(0xa5)],'fileType':'','body':'','version':_0x4f5625[constants_1[_0x27cbfc(0x9f)]+_0x27cbfc(0x97)]});}}while(!_0x1b5733[_0x27cbfc(0x9a)]());}async[a258_0x14750e(0x87)](_0x1793e9){const _0x401bde=a258_0x14750e,_0x33832d=new salesforce_1[(_0x401bde(0xa7))]()['select']('Body',_0x401bde(0x7b),_0x401bde(0x7e))[_0x401bde(0x94)](_0x401bde(0x91))[_0x401bde(0x95)](_0x401bde(0xaa),{'ids':_0x1793e9});!await fs_internal_1['FS']['exists'](path_1[_0x401bde(0x81)])&&await(0x0,promises_1[_0x401bde(0x8b)])(path_1[_0x401bde(0x81)],{'recursive':!![]});const _0x4dc612=new salesforce_1['Bulk1RetrieveData']({'instance':this['request'],'api':salesforce_1[_0x401bde(0x9d)][_0x401bde(0x82)],'pollInterval':0x1388,'queryBuilder':_0x33832d,'objectName':'Attachment','contentType':salesforce_1[_0x401bde(0x96)]['APPLICATION_XML'],'jobOperation':salesforce_1[_0x401bde(0x79)]['Query'],'tmpPath':path_1['tmpPath']});do{const _0x4ee6ea=await _0x4dc612[_0x401bde(0x85)]();if(!_0x4ee6ea)break;const _0x2062f9=new salesforce_1['BulkXmlStreamParser']({'binaryFields':BINARY_FIELDS});for await(const {Name:_0x3de92f,ParentId:_0x4be819,Body:_0x362524}of _0x4ee6ea[_0x401bde(0xa8)](_0x2062f9)){const _0x359453=this[_0x401bde(0xa1)]['get'](_0x4be819);if(!_0x359453){this[_0x401bde(0x90)][_0x401bde(0x8d)](_0x401bde(0x99),_0x4be819,_0x3de92f);continue;}_0x359453[_0x401bde(0x9c)]=_0x362524,_0x359453['fileType']=_0x3de92f;}}while(!_0x4dc612['getIsDone']());}async[a258_0x14750e(0x86)](){const _0x13be3d=a258_0x14750e;do{const _0x540763=this[_0x13be3d(0xad)][_0x13be3d(0x93)](0x0,MAX_IDS_CHUNK_LENGTH);await this[_0x13be3d(0x92)](_0x540763),await this[_0x13be3d(0x87)](_0x540763);}while(this[_0x13be3d(0xad)][_0x13be3d(0xa4)]);return[...this[_0x13be3d(0xa1)]['values']()];}}exports[a258_0x14750e(0x7c)]=BulkComponentsRetriever;