const a259_0x4c5f06=a259_0x4649;function a259_0x4649(_0x2c9c6f,_0x276db3){const _0x1c3a54=a259_0x3ae9();return a259_0x4649=function(_0x121b3a,_0x3da426){_0x121b3a=_0x121b3a-0x164;let _0x3ae9f3=_0x1c3a54[_0x121b3a];return _0x3ae9f3;},a259_0x4649(_0x2c9c6f,_0x276db3);}(function(_0x1be219,_0x8ea3ff){const _0x9e7ad8=a259_0x4649,_0x3cb5cc=_0x1be219();while(!![]){try{const _0x34a41c=parseInt(_0x9e7ad8(0x16a))/0x1+parseInt(_0x9e7ad8(0x165))/0x2*(parseInt(_0x9e7ad8(0x19b))/0x3)+-parseInt(_0x9e7ad8(0x16b))/0x4+parseInt(_0x9e7ad8(0x179))/0x5*(-parseInt(_0x9e7ad8(0x189))/0x6)+-parseInt(_0x9e7ad8(0x170))/0x7*(parseInt(_0x9e7ad8(0x198))/0x8)+-parseInt(_0x9e7ad8(0x193))/0x9*(-parseInt(_0x9e7ad8(0x18a))/0xa)+parseInt(_0x9e7ad8(0x178))/0xb*(parseInt(_0x9e7ad8(0x18b))/0xc);if(_0x34a41c===_0x8ea3ff)break;else _0x3cb5cc['push'](_0x3cb5cc['shift']());}catch(_0x567ebe){_0x3cb5cc['push'](_0x3cb5cc['shift']());}}}(a259_0x3ae9,0x31bd7));const a259_0x3da426=(function(){let _0x1a5071=!![];return function(_0x6b6034,_0x9f71a2){const _0x21467b=_0x1a5071?function(){const _0x37267a=a259_0x4649;if(_0x9f71a2){const _0x4c1149=_0x9f71a2[_0x37267a(0x172)](_0x6b6034,arguments);return _0x9f71a2=null,_0x4c1149;}}:function(){};return _0x1a5071=![],_0x21467b;};}()),a259_0x121b3a=a259_0x3da426(this,function(){const _0x42612a=a259_0x4649;return a259_0x121b3a[_0x42612a(0x196)]()[_0x42612a(0x18c)](_0x42612a(0x186))['toString']()['constructor'](a259_0x121b3a)[_0x42612a(0x18c)](_0x42612a(0x186));});a259_0x121b3a();'use strict';function a259_0x3ae9(){const _0x3b3d60=['27aTCnAn','Attachment','pipe','toString','get','270656MQfAca','QueryBuilder','FLOSUM_NAMESPACE','13218AJPwnD','BulkXmlStreamParser','ids','error','name','106flCMfe','exists','logger','getIsDone','../../internal/fs.internal','37812fVDqzO','1205140JEuBtT','Id\x20IN\x20(:ids)','SalesforceConstants','fs/promises','Body','35sFBUeV','../../../../configs/path','apply','from','@flosum/salesforce','fileType','select','where','737miYaHu','15ssGxcg','BulkComponentsRetriever','splice','mkdir','Parent\x20record\x20(%s)\x20for\x20file\x20(%s)\x20was\x20not\x20found.','Component_Name__c','Logger','components','length','Query','Name','Version__c','retrieveComponents','(((.+)+)+)+$','request','__esModule','807066HBdBqM','403020aBMTtK','122772PsFDRo','search','ParentId','Bulk1RetrieveData','execute','APPLICATION_XML','tmpPath','API'];a259_0x3ae9=function(){return _0x3b3d60;};return a259_0x3ae9();}Object['defineProperty'](exports,a259_0x4c5f06(0x188),{'value':!![]}),exports[a259_0x4c5f06(0x17a)]=void 0x0;const salesforce_1=require(a259_0x4c5f06(0x174)),core_1=require('../../../../core'),constants_1=require('../../../../constants'),promises_1=require(a259_0x4c5f06(0x16e)),fs_internal_1=require(a259_0x4c5f06(0x169)),path_1=require(a259_0x4c5f06(0x171)),BINARY_FIELDS=[a259_0x4c5f06(0x16f)],MAX_IDS_CHUNK_LENGTH=0xfa0;class BulkComponentsRetriever{constructor({request:_0x402b19,ids:_0x2f833b}){const _0x27caef=a259_0x4c5f06;this['components']=new Map(),this['request']=_0x402b19,this[_0x27caef(0x19d)]=_0x2f833b,this[_0x27caef(0x167)]=new core_1[(_0x27caef(0x17f))](BulkComponentsRetriever[_0x27caef(0x164)]);}async[a259_0x4c5f06(0x185)](_0x4b07ab){const _0x18337d=a259_0x4c5f06,_0x9636b8=new salesforce_1['QueryBuilder']()[_0x18337d(0x176)]('Id',constants_1[_0x18337d(0x19a)]+'Component__r.'+constants_1[_0x18337d(0x19a)]+_0x18337d(0x17e),constants_1[_0x18337d(0x19a)]+_0x18337d(0x184))[_0x18337d(0x173)](constants_1[_0x18337d(0x19a)]+'Component_History__c')['where'](_0x18337d(0x16c),{'ids':_0x4b07ab}),_0x32d466=new salesforce_1['CompositeRetrieveData']({'api':salesforce_1[_0x18337d(0x16d)][_0x18337d(0x192)],'queryBuilder':_0x9636b8,'instance':this[_0x18337d(0x187)],'isTooling':![]});do{const {records:_0x28e1c9}=await _0x32d466[_0x18337d(0x18f)]();for(const _0x272d45 of _0x28e1c9){this[_0x18337d(0x180)]['set'](_0x272d45['Id'],{'fileName':_0x272d45[constants_1[_0x18337d(0x19a)]+'Component__r'][constants_1[_0x18337d(0x19a)]+_0x18337d(0x17e)],'fileType':'','body':'','version':_0x272d45[constants_1[_0x18337d(0x19a)]+_0x18337d(0x184)]});}}while(!_0x32d466[_0x18337d(0x168)]());}async['retrieveAttachments'](_0x2805f2){const _0x47cbf4=a259_0x4c5f06,_0x1d9606=new salesforce_1[(_0x47cbf4(0x199))]()[_0x47cbf4(0x176)]('Body',_0x47cbf4(0x183),_0x47cbf4(0x18d))[_0x47cbf4(0x173)](_0x47cbf4(0x194))[_0x47cbf4(0x177)]('ParentId\x20IN\x20(:ids)',{'ids':_0x2805f2});!await fs_internal_1['FS'][_0x47cbf4(0x166)](path_1[_0x47cbf4(0x191)])&&await(0x0,promises_1[_0x47cbf4(0x17c)])(path_1[_0x47cbf4(0x191)],{'recursive':!![]});const _0x23b1a6=new salesforce_1[(_0x47cbf4(0x18e))]({'instance':this[_0x47cbf4(0x187)],'api':salesforce_1['SalesforceConstants']['API'],'pollInterval':0x1388,'queryBuilder':_0x1d9606,'objectName':'Attachment','contentType':salesforce_1['BulkV1QueryContentType'][_0x47cbf4(0x190)],'jobOperation':salesforce_1['Bulk1JobOperation'][_0x47cbf4(0x182)],'tmpPath':path_1[_0x47cbf4(0x191)]});do{const _0x4897f1=await _0x23b1a6['execute']();if(!_0x4897f1)break;const _0x3ffadc=new salesforce_1[(_0x47cbf4(0x19c))]({'binaryFields':BINARY_FIELDS});for await(const {Name:_0x1f0cb6,ParentId:_0x3ae52e,Body:_0x1d96ad}of _0x4897f1[_0x47cbf4(0x195)](_0x3ffadc)){const _0x18ca2a=this[_0x47cbf4(0x180)][_0x47cbf4(0x197)](_0x3ae52e);if(!_0x18ca2a){this['logger'][_0x47cbf4(0x19e)](_0x47cbf4(0x17d),_0x3ae52e,_0x1f0cb6);continue;}_0x18ca2a['body']=_0x1d96ad,_0x18ca2a[_0x47cbf4(0x175)]=_0x1f0cb6;}}while(!_0x23b1a6[_0x47cbf4(0x168)]());}async['retrieve'](){const _0x195d72=a259_0x4c5f06;do{const _0x1ea798=this['ids'][_0x195d72(0x17b)](0x0,MAX_IDS_CHUNK_LENGTH);await this[_0x195d72(0x185)](_0x1ea798),await this['retrieveAttachments'](_0x1ea798);}while(this[_0x195d72(0x19d)][_0x195d72(0x181)]);return[...this['components']['values']()];}}exports[a259_0x4c5f06(0x17a)]=BulkComponentsRetriever;