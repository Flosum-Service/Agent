const a228_0x493999=a228_0x15bd;(function(_0xee2e50,_0xe170a4){const _0x5ed09b=a228_0x15bd,_0x16326a=_0xee2e50();while(!![]){try{const _0x2b1225=-parseInt(_0x5ed09b(0x1a9))/0x1+parseInt(_0x5ed09b(0x1c1))/0x2*(-parseInt(_0x5ed09b(0x1c3))/0x3)+-parseInt(_0x5ed09b(0x181))/0x4+-parseInt(_0x5ed09b(0x19d))/0x5*(-parseInt(_0x5ed09b(0x17e))/0x6)+parseInt(_0x5ed09b(0x16e))/0x7*(-parseInt(_0x5ed09b(0x1cc))/0x8)+-parseInt(_0x5ed09b(0x19f))/0x9+-parseInt(_0x5ed09b(0x1b7))/0xa*(-parseInt(_0x5ed09b(0x1bd))/0xb);if(_0x2b1225===_0xe170a4)break;else _0x16326a['push'](_0x16326a['shift']());}catch(_0x15d096){_0x16326a['push'](_0x16326a['shift']());}}}(a228_0x5e3b,0xead05));const a228_0x48ec64=(function(){let _0x418613=!![];return function(_0x230360,_0x1b10d9){const _0x5e77b5=_0x418613?function(){const _0x305262=a228_0x15bd;if(_0x1b10d9){const _0x2f4a70=_0x1b10d9[_0x305262(0x1a1)](_0x230360,arguments);return _0x1b10d9=null,_0x2f4a70;}}:function(){};return _0x418613=![],_0x5e77b5;};}()),a228_0x1c6da2=a228_0x48ec64(this,function(){const _0xf84c8=a228_0x15bd;return a228_0x1c6da2[_0xf84c8(0x16d)]()['search']('(((.+)+)+)+$')[_0xf84c8(0x16d)]()[_0xf84c8(0x1b0)](a228_0x1c6da2)['search'](_0xf84c8(0x1bf));});a228_0x1c6da2();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4fe761){return _0x4fe761&&_0x4fe761['__esModule']?_0x4fe761:{'default':_0x4fe761};};function a228_0x15bd(_0x585ee1,_0x1cfe12){const _0x3494b6=a228_0x5e3b();return a228_0x15bd=function(_0x1c6da2,_0x48ec64){_0x1c6da2=_0x1c6da2-0x16a;let _0x5e3b9b=_0x3494b6[_0x1c6da2];return _0x5e3b9b;},a228_0x15bd(_0x585ee1,_0x1cfe12);}Object[a228_0x493999(0x16b)](exports,a228_0x493999(0x199),{'value':!![]}),exports[a228_0x493999(0x193)]=void 0x0;function a228_0x5e3b(){const _0xc917df=['17754BFgWtw','extractFieldsFromRecord','logger','6988824EfTbLR','toISOString','Deletion_By_Agent__c','componentName','fetchCommitManifestsByComponentIds','RecordTypeId','map','files','push','createZip','branchId','get','Description','../../parsers/utils/zip','application/zip','recordTypes','createPatchRequest','insert','SalesforceComponentsManager','FLOSUM_GIT_NAMESPACE','Name','username','Version__c','createPostRequest','__esModule','version','proceedComponentMeta','Component_Name__c','3175cZIBuE','../../../../constants','16163721ogGujd','Branch__c','apply','Repository','reference','FLOSUM_COMMIT_MANIFEST','../../../../core','proceededComponentsMeta','CRC32__c','default','1554424cMWJEL','Branch','Zip','../utils/flosum-naming.utils','createDeleteRequest',']\x20-\x20meta\x20not\x20found','name','constructor','../errors/salesforce.error','Committed_On__c','Component__c','body','file','update','670krMOWU','DEFLATE','FLOSUM_ATTACHMENT','./salesforce-git-sync.service','componentsToDelete','ContentType','1109119QvLyfp','Changed_On__c','(((.+)+)+)+$','FLOSUM_COMPONENT_HISTORY','475062AlvFJo','prepareComponentRecord','21aDmzxL','crc','repositoryId','generateAsync','componentType','Source__c','Could\x20not\x20proceed\x20component\x20','filePath','prepareCommitManifest','8VghPyD','Component_Type__c','Component_History__c','SalesforceError','defineProperty','prepareComponentAttachmentRecord','toString','6386765ERzBec','gitSync','prepareComponentHistoryRecord','componentsToUpdate','.id}','FLOSUM_NAMESPACE','base64','SalesforceGitSyncService','Last_Modified_Date__c','Changed_By__c','type','FLOSUM_COMPONENT','find','Logger','componentId','request'];a228_0x5e3b=function(){return _0xc917df;};return a228_0x5e3b();}const constants_1=require(a228_0x493999(0x19e)),core_1=require(a228_0x493999(0x1a5)),zip_1=require(a228_0x493999(0x18e)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a228_0x493999(0x1b1)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a228_0x493999(0x1ac)),salesforce_git_sync_service_1=require(a228_0x493999(0x1ba));class SalesforceComponentsManager{constructor(_0x3ce6d7,_0x52542a,_0x4cb571,_0x2a21b7,_0x566422){const _0x2bd806=a228_0x493999;this['repositoryId']=_0x3ce6d7,this[_0x2bd806(0x18b)]=_0x52542a,this['username']=_0x4cb571,this['recordTypes']=_0x2a21b7,this[_0x2bd806(0x1a6)]=_0x566422,this[_0x2bd806(0x180)]=new core_1[(_0x2bd806(0x17b))](SalesforceComponentsManager[_0x2bd806(0x1af)]),this['gitSync']=typedi_1[_0x2bd806(0x1a8)][_0x2bd806(0x18c)](salesforce_git_sync_service_1[_0x2bd806(0x175)]);}[a228_0x493999(0x19b)](_0x4d84b5,_0x1470c7){const _0x112b22=a228_0x493999,_0x3499fd=(0x0,flosum_naming_utils_1[_0x112b22(0x17f)])(_0x4d84b5,[_0x112b22(0x1cd),_0x112b22(0x19c),_0x112b22(0x197)]);this[_0x112b22(0x1a6)][_0x112b22(0x189)]({'componentId':'','reference':_0x1470c7,'version':_0x3499fd[_0x112b22(0x197)],'componentName':_0x3499fd[_0x112b22(0x19c)],'componentType':_0x3499fd['Component_Type__c']});}[a228_0x493999(0x1cb)](_0x1099de,_0x178709){const _0x2a974a=a228_0x493999,{request:_0x46f948}=(0x0,composite_utils_1[_0x2a974a(0x198)])(constants_1[_0x2a974a(0x1a4)],{[constants_1[_0x2a974a(0x173)]+'Commit__c']:_0x1099de,[constants_1['FLOSUM_NAMESPACE']+_0x2a974a(0x1ce)]:_0x178709});return _0x46f948;}async[a228_0x493999(0x16c)](_0x52880d,_0x206c78){const _0xafe8fc=a228_0x493999,_0x3dfec4={},_0xf1c44d=zip_1[_0xafe8fc(0x1ab)][_0xafe8fc(0x18a)]();for(const _0xb5ff1c of Object['keys'](_0x52880d[_0xafe8fc(0x188)])){_0xf1c44d[_0xafe8fc(0x1b5)](_0xb5ff1c,_0x52880d[_0xafe8fc(0x188)][_0xb5ff1c],{'createFolders':!![]});}return _0x3dfec4[_0xafe8fc(0x1bc)]=_0xafe8fc(0x18f),_0x3dfec4[_0xafe8fc(0x195)]=_0x52880d['type'],_0x3dfec4[_0xafe8fc(0x18d)]=_0x52880d['type'],_0x3dfec4['ParentId']=_0x206c78,_0x3dfec4['Body']=await _0xf1c44d[_0xafe8fc(0x1c6)]({'type':_0xafe8fc(0x174),'compression':_0xafe8fc(0x1b8),'compressionOptions':{'level':0x6}}),_0x3dfec4;}['prepareComponentHistoryRecord'](_0x477e5c,_0x39ffc6,_0x3a9ee1){const _0x29bfea=a228_0x493999,_0x3b1a08=new Date()['toISOString'](),_0x17f13b={};return _0x17f13b[constants_1[_0x29bfea(0x173)]+_0x29bfea(0x1b3)]=_0x39ffc6,_0x17f13b[constants_1[_0x29bfea(0x173)]+'CRC32__c']=_0x477e5c[_0x29bfea(0x1c4)],_0x17f13b[constants_1[_0x29bfea(0x173)]+_0x29bfea(0x1be)]=_0x3b1a08,_0x17f13b[constants_1['FLOSUM_NAMESPACE']+_0x29bfea(0x177)]=this[_0x29bfea(0x196)],_0x17f13b[constants_1['FLOSUM_NAMESPACE']+_0x29bfea(0x197)]=_0x3a9ee1?_0x3a9ee1+0x1:0x1,_0x17f13b[constants_1[_0x29bfea(0x194)]+'Is_From_Agent__c']=!![],_0x17f13b;}['prepareComponentRecord'](_0x38cd7c,_0x56dc09){const _0xe8327c=a228_0x493999;var _0x2733d0,_0x48867d;const _0x5f4bba=new Date()[_0xe8327c(0x182)](),_0x42d54b={};return!_0x56dc09?(this[_0xe8327c(0x18b)]?(_0x42d54b[constants_1[_0xe8327c(0x173)]+_0xe8327c(0x1a0)]=this[_0xe8327c(0x18b)],_0x42d54b[constants_1[_0xe8327c(0x173)]+_0xe8327c(0x1c8)]=_0xe8327c(0x1aa),_0x42d54b[_0xe8327c(0x186)]=(_0x2733d0=this[_0xe8327c(0x190)][_0xe8327c(0x17a)](_0x91398b=>_0x91398b[_0xe8327c(0x1af)]==='Branch'))===null||_0x2733d0===void 0x0?void 0x0:_0x2733d0['id']):(_0x42d54b[constants_1[_0xe8327c(0x173)]+'Repository__c']=this[_0xe8327c(0x1c5)],_0x42d54b[constants_1['FLOSUM_NAMESPACE']+_0xe8327c(0x1c8)]=_0xe8327c(0x1a2),_0x42d54b[_0xe8327c(0x186)]=(_0x48867d=this[_0xe8327c(0x190)]['find'](_0x131519=>_0x131519[_0xe8327c(0x1af)]===_0xe8327c(0x1a2)))===null||_0x48867d===void 0x0?void 0x0:_0x48867d['id']),_0x42d54b[constants_1['FLOSUM_NAMESPACE']+_0xe8327c(0x197)]=0x1):_0x42d54b[constants_1[_0xe8327c(0x173)]+'Version__c']=_0x56dc09['version']+0x1,_0x42d54b[constants_1['FLOSUM_NAMESPACE']+_0xe8327c(0x1cd)]=_0x38cd7c[_0xe8327c(0x178)],_0x42d54b[constants_1[_0xe8327c(0x173)]+_0xe8327c(0x19c)]=_0x38cd7c[_0xe8327c(0x1af)],_0x42d54b[constants_1[_0xe8327c(0x173)]+'File_Name__c']=_0x38cd7c[_0xe8327c(0x1ca)],_0x42d54b[constants_1[_0xe8327c(0x173)]+'Last_Updated_By__c']=this['username'],_0x42d54b[constants_1['FLOSUM_NAMESPACE']+'Last_Modified_By__c']=this['username'],_0x42d54b[constants_1[_0xe8327c(0x173)]+_0xe8327c(0x176)]=_0x5f4bba,_0x42d54b[constants_1['FLOSUM_NAMESPACE']+_0xe8327c(0x1b2)]=_0x5f4bba,_0x42d54b[constants_1[_0xe8327c(0x173)]+_0xe8327c(0x1a7)]=_0x38cd7c[_0xe8327c(0x1c4)],_0x42d54b;}['getProceededComponentsMeta'](){return this['proceededComponentsMeta'];}async[a228_0x493999(0x192)](_0x1438d5,_0x4f604c){const _0x498448=a228_0x493999,_0x1dbbcd=[];for(const _0x31d227 of _0x1438d5){const _0x25b91e=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x498448(0x179)],this['prepareComponentRecord'](_0x31d227)),_0x440dfc=(0x0,composite_utils_1[_0x498448(0x198)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x498448(0x170)](_0x31d227,'@{'+_0x25b91e[_0x498448(0x1a3)]+_0x498448(0x172))),_0x356ed8=(0x0,composite_utils_1[_0x498448(0x198)])(constants_1[_0x498448(0x1b9)],await this[_0x498448(0x16c)](_0x31d227,'@{'+_0x440dfc[_0x498448(0x1a3)]+_0x498448(0x172)));this[_0x498448(0x19b)](_0x25b91e[_0x498448(0x17d)][_0x498448(0x1b4)],_0x25b91e[_0x498448(0x1a3)]),_0x1dbbcd[_0x498448(0x189)](_0x25b91e[_0x498448(0x17d)],_0x440dfc['request'],_0x356ed8[_0x498448(0x17d)]),_0x4f604c&&_0x1dbbcd[_0x498448(0x189)](this[_0x498448(0x1cb)](_0x4f604c,'@{'+_0x440dfc['reference']+_0x498448(0x172)));}return _0x1dbbcd;}async[a228_0x493999(0x1b6)](_0xf0c749,_0x4169ac=''){const _0x394cb0=a228_0x493999,_0x5cf7a5=[];for(const {component:_0x49f8b7,meta:_0x20501a}of _0xf0c749){if(!_0x20501a['id']){const _0x4cb2bb=this[_0x394cb0(0x1a6)][_0x394cb0(0x17a)](_0x4cb0e1=>_0x4cb0e1[_0x394cb0(0x184)]===_0x49f8b7[_0x394cb0(0x1af)]&&_0x4cb0e1[_0x394cb0(0x1c7)]===_0x49f8b7[_0x394cb0(0x178)]);if(!_0x4cb2bb)throw new salesforce_error_1[(_0x394cb0(0x16a))](new Error(_0x394cb0(0x1c9)+_0x49f8b7[_0x394cb0(0x1af)]+'\x20['+_0x49f8b7[_0x394cb0(0x178)]+_0x394cb0(0x1ae)));_0x20501a['id']=_0x4cb2bb[_0x394cb0(0x17c)];}const _0xe48db6=(0x0,composite_utils_1[_0x394cb0(0x191)])(constants_1[_0x394cb0(0x179)],_0x20501a['id'],this[_0x394cb0(0x1c2)](_0x49f8b7,_0x20501a)),_0x110792=(0x0,composite_utils_1[_0x394cb0(0x198)])(constants_1[_0x394cb0(0x1c0)],this['prepareComponentHistoryRecord'](_0x49f8b7,_0x20501a['id'],_0x20501a[_0x394cb0(0x19a)])),_0x4cc3a4=(0x0,composite_utils_1[_0x394cb0(0x198)])(constants_1['FLOSUM_ATTACHMENT'],await this['prepareComponentAttachmentRecord'](_0x49f8b7,'@{'+_0x110792[_0x394cb0(0x1a3)]+'.id}'));this[_0x394cb0(0x19b)](_0xe48db6[_0x394cb0(0x17d)][_0x394cb0(0x1b4)],_0xe48db6[_0x394cb0(0x1a3)]),_0x5cf7a5[_0x394cb0(0x189)](_0xe48db6[_0x394cb0(0x17d)],_0x110792[_0x394cb0(0x17d)],_0x4cc3a4[_0x394cb0(0x17d)]),_0x4169ac&&_0x5cf7a5[_0x394cb0(0x189)](this[_0x394cb0(0x1cb)](_0x4169ac,'@{'+_0x110792[_0x394cb0(0x1a3)]+'.id}'));}return _0x5cf7a5;}async['delete'](_0x1a7117,_0x473d32=![]){const _0x34ad34=a228_0x493999,_0x1aafbf={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x58e9dd=[];for(const _0x150101 of _0x1a7117){if(_0x150101['id'])_0x58e9dd[_0x34ad34(0x189)](_0x150101['id']);else{const _0x574297=this['proceededComponentsMeta']['find'](_0x2763c9=>_0x2763c9['componentName']===_0x150101[_0x34ad34(0x1af)]&&_0x2763c9[_0x34ad34(0x1c7)]===_0x150101[_0x34ad34(0x178)]);if(!_0x574297||!_0x574297[_0x34ad34(0x17c)])continue;_0x58e9dd['push'](_0x574297[_0x34ad34(0x17c)]);}}if(_0x473d32){const _0x6a7a12=await this[_0x34ad34(0x16f)][_0x34ad34(0x185)](_0x58e9dd);_0x1aafbf['manifests']=_0x6a7a12[_0x34ad34(0x187)](_0x36c94f=>(0x0,composite_utils_1[_0x34ad34(0x1ad)])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x36c94f)[_0x34ad34(0x17d)]);}return _0x1aafbf[_0x34ad34(0x171)]=_0x58e9dd[_0x34ad34(0x187)](_0x985c89=>(0x0,composite_utils_1[_0x34ad34(0x191)])(constants_1['FLOSUM_COMPONENT'],_0x985c89,{[constants_1[_0x34ad34(0x194)]+_0x34ad34(0x183)]:!![]})[_0x34ad34(0x17d)]),_0x1aafbf[_0x34ad34(0x1bb)]=_0x58e9dd[_0x34ad34(0x187)](_0x3488df=>(0x0,composite_utils_1[_0x34ad34(0x1ad)])(constants_1[_0x34ad34(0x179)],_0x3488df)[_0x34ad34(0x17d)]),_0x1aafbf;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;