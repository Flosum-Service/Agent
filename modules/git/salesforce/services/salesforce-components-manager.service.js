const a273_0x2bd314=a273_0x4a33;(function(_0x23155a,_0x42349a){const _0x433be4=a273_0x4a33,_0x4db81a=_0x23155a();while(!![]){try{const _0x138d34=-parseInt(_0x433be4(0x1a2))/0x1*(-parseInt(_0x433be4(0x1b3))/0x2)+parseInt(_0x433be4(0x1e5))/0x3+-parseInt(_0x433be4(0x197))/0x4*(parseInt(_0x433be4(0x1bc))/0x5)+-parseInt(_0x433be4(0x1d3))/0x6*(-parseInt(_0x433be4(0x190))/0x7)+parseInt(_0x433be4(0x198))/0x8*(-parseInt(_0x433be4(0x1d1))/0x9)+parseInt(_0x433be4(0x1bb))/0xa*(parseInt(_0x433be4(0x18c))/0xb)+parseInt(_0x433be4(0x1b8))/0xc*(-parseInt(_0x433be4(0x199))/0xd);if(_0x138d34===_0x42349a)break;else _0x4db81a['push'](_0x4db81a['shift']());}catch(_0x2b1c68){_0x4db81a['push'](_0x4db81a['shift']());}}}(a273_0x3dfb,0x29029));const a273_0xcf0cb6=(function(){let _0x1bd03c=!![];return function(_0x536256,_0x2b0bd2){const _0x32e6e3=_0x1bd03c?function(){const _0x135255=a273_0x4a33;if(_0x2b0bd2){const _0x4834f1=_0x2b0bd2[_0x135255(0x1e2)](_0x536256,arguments);return _0x2b0bd2=null,_0x4834f1;}}:function(){};return _0x1bd03c=![],_0x32e6e3;};}()),a273_0x2bb1b5=a273_0xcf0cb6(this,function(){const _0x4335be=a273_0x4a33;return a273_0x2bb1b5[_0x4335be(0x1af)]()[_0x4335be(0x1d2)](_0x4335be(0x1ad))[_0x4335be(0x1af)]()[_0x4335be(0x1be)](a273_0x2bb1b5)[_0x4335be(0x1d2)](_0x4335be(0x1ad));});a273_0x2bb1b5();'use strict';var __importDefault=this&&this[a273_0x2bd314(0x1b7)]||function(_0x3c716e){const _0x46bc69=a273_0x2bd314;return _0x3c716e&&_0x3c716e[_0x46bc69(0x188)]?_0x3c716e:{'default':_0x3c716e};};Object[a273_0x2bd314(0x1de)](exports,a273_0x2bd314(0x188),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a273_0x2bd314(0x19f)),zip_1=require(a273_0x2bd314(0x1a0)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a273_0x2bd314(0x1c5)),composite_utils_1=require(a273_0x2bd314(0x1ae)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');function a273_0x4a33(_0x791657,_0x3ed095){const _0x5a95be=a273_0x3dfb();return a273_0x4a33=function(_0x2bb1b5,_0xcf0cb6){_0x2bb1b5=_0x2bb1b5-0x185;let _0x3dfbe8=_0x5a95be[_0x2bb1b5];return _0x3dfbe8;},a273_0x4a33(_0x791657,_0x3ed095);}class SalesforceComponentsManager{constructor(_0x321785,_0x48a06d,_0x3b104e,_0x44acc8,_0x167af0){const _0x250601=a273_0x2bd314;this[_0x250601(0x1e4)]=_0x321785,this[_0x250601(0x1c6)]=_0x48a06d,this[_0x250601(0x187)]=_0x3b104e,this['recordTypes']=_0x44acc8,this[_0x250601(0x1c8)]=_0x167af0,this[_0x250601(0x1a3)]=new core_1[(_0x250601(0x19c))](SalesforceComponentsManager[_0x250601(0x1b2)]),this[_0x250601(0x185)]=typedi_1[_0x250601(0x1ab)][_0x250601(0x1a4)](salesforce_git_sync_service_1[_0x250601(0x1c3)]);}[a273_0x2bd314(0x191)](_0x38a0f3,_0x5a218b){const _0x50f1f7=a273_0x2bd314,_0x149ab8=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x38a0f3,[_0x50f1f7(0x18e),_0x50f1f7(0x1a7),_0x50f1f7(0x1db)]);this[_0x50f1f7(0x1c8)][_0x50f1f7(0x194)]({'componentId':'','reference':_0x5a218b,'version':_0x149ab8[_0x50f1f7(0x1db)],'componentName':_0x149ab8[_0x50f1f7(0x1a7)],'componentType':_0x149ab8['Component_Type__c']});}[a273_0x2bd314(0x1dd)](_0x5f27a8,_0x460937){const _0x778046=a273_0x2bd314,{request:_0x165b7a}=(0x0,composite_utils_1[_0x778046(0x19e)])(constants_1[_0x778046(0x1e7)],{[constants_1[_0x778046(0x1bd)]+_0x778046(0x19a)]:_0x5f27a8,[constants_1[_0x778046(0x1bd)]+_0x778046(0x1b9)]:_0x460937});return _0x165b7a;}async[a273_0x2bd314(0x1d4)](_0x3d4c93,_0x4ab537){const _0x16ee28=a273_0x2bd314,_0x4943fd={},_0x331aa7=zip_1[_0x16ee28(0x1aa)][_0x16ee28(0x19d)]();for(const _0x3c4db2 of Object[_0x16ee28(0x189)](_0x3d4c93[_0x16ee28(0x1cb)])){_0x331aa7[_0x16ee28(0x1c9)](_0x3c4db2,_0x3d4c93[_0x16ee28(0x1cb)][_0x3c4db2],{'createFolders':!![]});}return _0x4943fd[_0x16ee28(0x1dc)]=_0x16ee28(0x1e9),_0x4943fd[_0x16ee28(0x1c2)]=_0x3d4c93['type'],_0x4943fd['Description']=_0x3d4c93[_0x16ee28(0x18a)],_0x4943fd[_0x16ee28(0x1bf)]=_0x4ab537,_0x4943fd['Body']=await _0x331aa7[_0x16ee28(0x1c0)]({'type':_0x16ee28(0x18b),'compression':_0x16ee28(0x1c4),'compressionOptions':{'level':0x6}}),_0x4943fd;}['prepareComponentHistoryRecord'](_0x185144,_0x11df79,_0x18e6ca){const _0x45525d=a273_0x2bd314,_0x9b4917=new Date()[_0x45525d(0x18d)](),_0x4ebe44={};return _0x4ebe44[constants_1[_0x45525d(0x1bd)]+_0x45525d(0x195)]=_0x11df79,_0x4ebe44[constants_1[_0x45525d(0x1bd)]+_0x45525d(0x1a6)]=_0x185144[_0x45525d(0x1a8)],_0x4ebe44[constants_1[_0x45525d(0x1bd)]+'Changed_On__c']=_0x9b4917,_0x4ebe44[constants_1[_0x45525d(0x1bd)]+_0x45525d(0x1da)]=this[_0x45525d(0x187)],_0x4ebe44[constants_1[_0x45525d(0x1bd)]+'Version__c']=_0x18e6ca?_0x18e6ca+0x1:0x1,_0x4ebe44[constants_1['FLOSUM_GIT_NAMESPACE']+'Is_From_Agent__c']=!![],_0x4ebe44;}[a273_0x2bd314(0x1ea)](_0xe00ea6,_0x5e699d){const _0xb2400e=a273_0x2bd314;var _0x1d48ef,_0x33d26f;const _0x30cc58=new Date()[_0xb2400e(0x18d)](),_0x41b47c={};return!_0x5e699d?(this[_0xb2400e(0x1c6)]?(_0x41b47c[constants_1[_0xb2400e(0x1bd)]+_0xb2400e(0x19b)]=this[_0xb2400e(0x1c6)],_0x41b47c[constants_1[_0xb2400e(0x1bd)]+'Source__c']=_0xb2400e(0x1b0),_0x41b47c['RecordTypeId']=(_0x1d48ef=this[_0xb2400e(0x1d7)]['find'](_0x5713e6=>_0x5713e6[_0xb2400e(0x1b2)]==='Branch'))===null||_0x1d48ef===void 0x0?void 0x0:_0x1d48ef['id']):(_0x41b47c[constants_1[_0xb2400e(0x1bd)]+'Repository__c']=this[_0xb2400e(0x1e4)],_0x41b47c[constants_1['FLOSUM_NAMESPACE']+'Source__c']=_0xb2400e(0x1b4),_0x41b47c[_0xb2400e(0x1e1)]=(_0x33d26f=this[_0xb2400e(0x1d7)][_0xb2400e(0x1a5)](_0x2bc469=>_0x2bc469[_0xb2400e(0x1b2)]===_0xb2400e(0x1b4)))===null||_0x33d26f===void 0x0?void 0x0:_0x33d26f['id']),_0x41b47c[constants_1[_0xb2400e(0x1bd)]+_0xb2400e(0x1db)]=0x1):_0x41b47c[constants_1[_0xb2400e(0x1bd)]+_0xb2400e(0x1db)]=_0x5e699d[_0xb2400e(0x1d0)]+0x1,_0x41b47c[constants_1[_0xb2400e(0x1bd)]+_0xb2400e(0x18e)]=_0xe00ea6[_0xb2400e(0x18a)],_0x41b47c[constants_1[_0xb2400e(0x1bd)]+_0xb2400e(0x1a7)]=_0xe00ea6[_0xb2400e(0x1b2)],_0x41b47c[constants_1[_0xb2400e(0x1bd)]+_0xb2400e(0x186)]=_0xe00ea6[_0xb2400e(0x1c1)],_0x41b47c[constants_1['FLOSUM_NAMESPACE']+'Last_Updated_By__c']=this['username'],_0x41b47c[constants_1[_0xb2400e(0x1bd)]+_0xb2400e(0x192)]=this[_0xb2400e(0x187)],_0x41b47c[constants_1[_0xb2400e(0x1bd)]+_0xb2400e(0x1ba)]=_0x30cc58,_0x41b47c[constants_1[_0xb2400e(0x1bd)]+_0xb2400e(0x1b6)]=_0x30cc58,_0x41b47c[constants_1[_0xb2400e(0x1bd)]+_0xb2400e(0x1a6)]=_0xe00ea6[_0xb2400e(0x1a8)],_0x41b47c[constants_1[_0xb2400e(0x1bd)]+'Vlocity_Component_Name__c']=_0xe00ea6[_0xb2400e(0x1ca)],_0x41b47c[constants_1[_0xb2400e(0x1bd)]+_0xb2400e(0x1cd)]=_0xe00ea6['isVlocityComponent'],_0x41b47c[constants_1[_0xb2400e(0x1bd)]+'MC_Key__c']=_0xe00ea6[_0xb2400e(0x1a1)],_0x41b47c;}['getProceededComponentsMeta'](){const _0x63a82c=a273_0x2bd314;return this[_0x63a82c(0x1c8)];}async['insert'](_0x31e7b4,_0x182cbb){const _0x5cb565=a273_0x2bd314,_0x23507c=[];for(const _0x115ee1 of _0x31e7b4){const _0x15e564=(0x0,composite_utils_1[_0x5cb565(0x19e)])(constants_1[_0x5cb565(0x18f)],this[_0x5cb565(0x1ea)](_0x115ee1)),_0x92c7e3=(0x0,composite_utils_1[_0x5cb565(0x19e)])(constants_1[_0x5cb565(0x1c7)],this['prepareComponentHistoryRecord'](_0x115ee1,'@{'+_0x15e564['reference']+'.id}')),_0x118428=(0x0,composite_utils_1[_0x5cb565(0x19e)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x5cb565(0x1d4)](_0x115ee1,'@{'+_0x92c7e3[_0x5cb565(0x1a9)]+'.id}'));this[_0x5cb565(0x191)](_0x15e564[_0x5cb565(0x1ce)][_0x5cb565(0x1df)],_0x15e564[_0x5cb565(0x1a9)]),_0x23507c[_0x5cb565(0x194)](_0x15e564[_0x5cb565(0x1ce)],_0x92c7e3[_0x5cb565(0x1ce)],_0x118428[_0x5cb565(0x1ce)]),_0x182cbb&&_0x23507c[_0x5cb565(0x194)](this[_0x5cb565(0x1dd)](_0x182cbb,'@{'+_0x92c7e3[_0x5cb565(0x1a9)]+_0x5cb565(0x1d8)));}return _0x23507c;}async['update'](_0x4b27bb,_0x1c9b37=''){const _0x428600=a273_0x2bd314,_0x37eebe=[];for(const {component:_0x777b49,meta:_0x1d7c7c}of _0x4b27bb){if(!_0x1d7c7c['id']){const _0xe6e635=this[_0x428600(0x1c8)]['find'](_0x3d3a78=>_0x3d3a78[_0x428600(0x196)]===_0x777b49[_0x428600(0x1b2)]&&_0x3d3a78[_0x428600(0x1e0)]===_0x777b49[_0x428600(0x18a)]);if(!_0xe6e635)throw new salesforce_error_1['SalesforceError'](new Error('Could\x20not\x20proceed\x20component\x20'+_0x777b49['name']+'\x20['+_0x777b49['type']+']\x20-\x20meta\x20not\x20found'));_0x1d7c7c['id']=_0xe6e635[_0x428600(0x1cf)];}const _0x2187f7=(0x0,composite_utils_1[_0x428600(0x1b1)])(constants_1[_0x428600(0x18f)],_0x1d7c7c['id'],this[_0x428600(0x1ea)](_0x777b49,_0x1d7c7c)),_0x2b97a3=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x428600(0x1b5)](_0x777b49,_0x1d7c7c['id'],_0x1d7c7c[_0x428600(0x1d0)])),_0x353a8c=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x428600(0x1e3)],await this['prepareComponentAttachmentRecord'](_0x777b49,'@{'+_0x2b97a3[_0x428600(0x1a9)]+_0x428600(0x1d8)));this[_0x428600(0x191)](_0x2187f7[_0x428600(0x1ce)][_0x428600(0x1df)],_0x2187f7[_0x428600(0x1a9)]),_0x37eebe[_0x428600(0x194)](_0x2187f7[_0x428600(0x1ce)],_0x2b97a3[_0x428600(0x1ce)],_0x353a8c[_0x428600(0x1ce)]),_0x1c9b37&&_0x37eebe[_0x428600(0x194)](this['prepareCommitManifest'](_0x1c9b37,'@{'+_0x2b97a3['reference']+'.id}'));}return _0x37eebe;}async['delete'](_0x29480e,_0x11dd2b=![]){const _0x4d681e=a273_0x2bd314,_0x322ba2={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0xe43078=[];for(const _0xeeba4e of _0x29480e){if(_0xeeba4e['id'])_0xe43078[_0x4d681e(0x194)](_0xeeba4e['id']);else{const _0x4277fd=this[_0x4d681e(0x1c8)]['find'](_0x51ba5c=>_0x51ba5c['componentName']===_0xeeba4e[_0x4d681e(0x1b2)]&&_0x51ba5c[_0x4d681e(0x1e0)]===_0xeeba4e[_0x4d681e(0x18a)]);if(!_0x4277fd||!_0x4277fd[_0x4d681e(0x1cf)])continue;_0xe43078[_0x4d681e(0x194)](_0x4277fd['componentId']);}}if(_0x11dd2b){const _0x737ea8=await this[_0x4d681e(0x185)][_0x4d681e(0x1d5)](_0xe43078);_0x322ba2[_0x4d681e(0x1d9)]=_0x737ea8['map'](_0x4511ff=>(0x0,composite_utils_1[_0x4d681e(0x1e6)])(constants_1[_0x4d681e(0x1e7)],_0x4511ff)[_0x4d681e(0x1ce)]);}return _0x322ba2[_0x4d681e(0x1e8)]=_0xe43078[_0x4d681e(0x1ac)](_0x299409=>(0x0,composite_utils_1[_0x4d681e(0x1b1)])(constants_1[_0x4d681e(0x18f)],_0x299409,{[constants_1[_0x4d681e(0x1d6)]+_0x4d681e(0x193)]:!![]})[_0x4d681e(0x1ce)]),_0x322ba2['componentsToDelete']=_0xe43078[_0x4d681e(0x1ac)](_0x4f095e=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x4d681e(0x18f)],_0x4f095e)[_0x4d681e(0x1ce)]),_0x322ba2;}}function a273_0x3dfb(){const _0x59da7d=['defineProperty','body','componentType','RecordTypeId','apply','FLOSUM_ATTACHMENT','repositoryId','999564zACOcT','createDeleteRequest','FLOSUM_COMMIT_MANIFEST','componentsToUpdate','application/zip','prepareComponentRecord','gitSync','File_Name__c','username','__esModule','keys','type','base64','11hAAxtT','toISOString','Component_Type__c','FLOSUM_COMPONENT','1444681XUEFGr','proceedComponentMeta','Last_Modified_By__c','Deletion_By_Agent__c','push','Component__c','componentName','1042036dHfqXl','292440AIwceE','222508JLzzEs','Commit__c','Branch__c','Logger','createZip','createPostRequest','../../../../core','../../parsers/utils/zip','marketingCloudKey','92221mOZdHb','logger','get','find','CRC32__c','Component_Name__c','crc','reference','Zip','default','map','(((.+)+)+)+$','../utils/composite.utils','toString','Branch','createPatchRequest','name','6SQZcVl','Repository','prepareComponentHistoryRecord','Committed_On__c','__importDefault','264nyzdXo','Component_History__c','Last_Modified_Date__c','253590PqNgcu','5VpEsaL','FLOSUM_NAMESPACE','constructor','ParentId','generateAsync','filePath','Name','SalesforceGitSyncService','DEFLATE','../errors/salesforce.error','branchId','FLOSUM_COMPONENT_HISTORY','proceededComponentsMeta','file','vlocityComponentName','files','SalesforceComponentsManager','Vlocity_Component__c','request','componentId','version','9eJtaWQ','search','6krtTJC','prepareComponentAttachmentRecord','fetchCommitManifestsByComponentIds','FLOSUM_GIT_NAMESPACE','recordTypes','.id}','manifests','Changed_By__c','Version__c','ContentType','prepareCommitManifest'];a273_0x3dfb=function(){return _0x59da7d;};return a273_0x3dfb();}exports[a273_0x2bd314(0x1cc)]=SalesforceComponentsManager;