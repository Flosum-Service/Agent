const a229_0x2581a9=a229_0x4d7c;(function(_0x13f73f,_0x45673a){const _0xd0bba4=a229_0x4d7c,_0x2ba88c=_0x13f73f();while(!![]){try{const _0x5adb26=parseInt(_0xd0bba4(0x102))/0x1*(parseInt(_0xd0bba4(0x126))/0x2)+parseInt(_0xd0bba4(0x14e))/0x3*(-parseInt(_0xd0bba4(0x146))/0x4)+parseInt(_0xd0bba4(0x13e))/0x5+parseInt(_0xd0bba4(0x113))/0x6*(-parseInt(_0xd0bba4(0x152))/0x7)+-parseInt(_0xd0bba4(0x137))/0x8*(-parseInt(_0xd0bba4(0x11b))/0x9)+parseInt(_0xd0bba4(0x10f))/0xa+-parseInt(_0xd0bba4(0x122))/0xb*(parseInt(_0xd0bba4(0x101))/0xc);if(_0x5adb26===_0x45673a)break;else _0x2ba88c['push'](_0x2ba88c['shift']());}catch(_0x36b538){_0x2ba88c['push'](_0x2ba88c['shift']());}}}(a229_0x40f5,0x6c799));const a229_0x2b784d=(function(){let _0x2c3312=!![];return function(_0xee4ebf,_0x1eccc4){const _0x338703=_0x2c3312?function(){const _0x50dc9b=a229_0x4d7c;if(_0x1eccc4){const _0x55cb5a=_0x1eccc4[_0x50dc9b(0xfc)](_0xee4ebf,arguments);return _0x1eccc4=null,_0x55cb5a;}}:function(){};return _0x2c3312=![],_0x338703;};}()),a229_0x5e303d=a229_0x2b784d(this,function(){const _0x30706f=a229_0x4d7c;return a229_0x5e303d[_0x30706f(0x135)]()[_0x30706f(0x118)]('(((.+)+)+)+$')['toString']()[_0x30706f(0x114)](a229_0x5e303d)[_0x30706f(0x118)](_0x30706f(0x11a));});a229_0x5e303d();'use strict';var __importDefault=this&&this[a229_0x2581a9(0x11e)]||function(_0x24e0a0){const _0x1deb13=a229_0x2581a9;return _0x24e0a0&&_0x24e0a0[_0x1deb13(0x11c)]?_0x24e0a0:{'default':_0x24e0a0};};function a229_0x40f5(){const _0x53e405=['prepareCommitManifest','8426660JYuVbA','Name','createDeleteRequest','Logger','6EdJhsQ','constructor','request','createPostRequest','./salesforce-git-sync.service','search','../utils/flosum-naming.utils','(((.+)+)+)+$','273879yBWgQi','__esModule','update','__importDefault','Source__c','SalesforceComponentsManager','createPatchRequest','154781nFwfEx','componentId','type','files','3116rpdgff','componentsToUpdate','Branch__c','.id}','insert','../utils/composite.utils','prepareComponentAttachmentRecord','Deletion_By_Agent__c','Commit__c','Component_Name__c','Version__c','fetchCommitManifestsByComponentIds','prepareComponentRecord','body','default','toString','componentsToDelete','48iTCJAg','FLOSUM_COMPONENT_HISTORY','branchId','RecordTypeId','FLOSUM_ATTACHMENT','reference','proceedComponentMeta','1355230TUDpDI','FLOSUM_GIT_NAMESPACE','Body','push','Is_From_Agent__c','proceededComponentsMeta','file','SalesforceGitSyncService','32sOMFFb','Branch','FLOSUM_COMMIT_MANIFEST','File_Name__c','crc','../../../../constants','defineProperty','get','183156RjGNZw','../errors/salesforce.error','delete',']\x20-\x20meta\x20not\x20found','103614cViphW','typedi','extractFieldsFromRecord','Component__c','application/zip','keys','componentType','repositoryId','Committed_On__c','FLOSUM_COMPONENT','Changed_By__c','username','FLOSUM_NAMESPACE','DEFLATE','Repository','ParentId','gitSync','apply','prepareComponentHistoryRecord','generateAsync','Last_Updated_By__c','Could\x20not\x20proceed\x20component\x20','708ttkKwA','309UuVjBe','name','base64','toISOString','CRC32__c','Last_Modified_By__c','map','version','SalesforceError','Component_Type__c','find','recordTypes'];a229_0x40f5=function(){return _0x53e405;};return a229_0x40f5();}function a229_0x4d7c(_0x3fa245,_0x1ceacd){const _0x4f2940=a229_0x40f5();return a229_0x4d7c=function(_0x5e303d,_0x2b784d){_0x5e303d=_0x5e303d-0xf7;let _0x40f5fc=_0x4f2940[_0x5e303d];return _0x40f5fc;},a229_0x4d7c(_0x3fa245,_0x1ceacd);}Object[a229_0x2581a9(0x14c)](exports,a229_0x2581a9(0x11c),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a229_0x2581a9(0x14b)),core_1=require('../../../../core'),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a229_0x2581a9(0x153))),salesforce_error_1=require(a229_0x2581a9(0x14f)),composite_utils_1=require(a229_0x2581a9(0x12b)),flosum_naming_utils_1=require(a229_0x2581a9(0x119)),salesforce_git_sync_service_1=require(a229_0x2581a9(0x117));class SalesforceComponentsManager{constructor(_0x53a92a,_0x30b43d,_0x32939d,_0x5623ae,_0x407a83){const _0x2f28de=a229_0x2581a9;this['repositoryId']=_0x53a92a,this['branchId']=_0x30b43d,this[_0x2f28de(0x15d)]=_0x32939d,this[_0x2f28de(0x10d)]=_0x5623ae,this[_0x2f28de(0x143)]=_0x407a83,this['logger']=new core_1[(_0x2f28de(0x112))](SalesforceComponentsManager[_0x2f28de(0x103)]),this[_0x2f28de(0xfb)]=typedi_1[_0x2f28de(0x134)][_0x2f28de(0x14d)](salesforce_git_sync_service_1[_0x2f28de(0x145)]);}[a229_0x2581a9(0x13d)](_0x39a369,_0x37970d){const _0x598e97=a229_0x2581a9,_0x369ae3=(0x0,flosum_naming_utils_1[_0x598e97(0x154)])(_0x39a369,[_0x598e97(0x10b),_0x598e97(0x12f),_0x598e97(0x130)]);this['proceededComponentsMeta'][_0x598e97(0x141)]({'componentId':'','reference':_0x37970d,'version':_0x369ae3[_0x598e97(0x130)],'componentName':_0x369ae3[_0x598e97(0x12f)],'componentType':_0x369ae3[_0x598e97(0x10b)]});}[a229_0x2581a9(0x10e)](_0x1c487e,_0x4f778e){const _0x33c1fb=a229_0x2581a9,{request:_0x41a512}=(0x0,composite_utils_1[_0x33c1fb(0x116)])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x33c1fb(0xf7)]+_0x33c1fb(0x12e)]:_0x1c487e,[constants_1['FLOSUM_NAMESPACE']+'Component_History__c']:_0x4f778e});return _0x41a512;}async[a229_0x2581a9(0x12c)](_0x104b0d,_0x55c984){const _0x1d8e11=a229_0x2581a9,_0x3e2189={},_0xacb581=zip_1['Zip']['createZip']();for(const _0x376a56 of Object[_0x1d8e11(0x157)](_0x104b0d[_0x1d8e11(0x125)])){_0xacb581[_0x1d8e11(0x144)](_0x376a56,_0x104b0d[_0x1d8e11(0x125)][_0x376a56],{'createFolders':!![]});}return _0x3e2189['ContentType']=_0x1d8e11(0x156),_0x3e2189[_0x1d8e11(0x110)]=_0x104b0d[_0x1d8e11(0x124)],_0x3e2189['Description']=_0x104b0d['type'],_0x3e2189[_0x1d8e11(0xfa)]=_0x55c984,_0x3e2189[_0x1d8e11(0x140)]=await _0xacb581[_0x1d8e11(0xfe)]({'type':_0x1d8e11(0x104),'compression':_0x1d8e11(0xf8),'compressionOptions':{'level':0x6}}),_0x3e2189;}['prepareComponentHistoryRecord'](_0x5494d4,_0x4867a1,_0x348c4a){const _0x4b609d=a229_0x2581a9,_0x329d05=new Date()[_0x4b609d(0x105)](),_0x3fb505={};return _0x3fb505[constants_1[_0x4b609d(0xf7)]+_0x4b609d(0x155)]=_0x4867a1,_0x3fb505[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x5494d4[_0x4b609d(0x14a)],_0x3fb505[constants_1[_0x4b609d(0xf7)]+'Changed_On__c']=_0x329d05,_0x3fb505[constants_1['FLOSUM_NAMESPACE']+_0x4b609d(0x15c)]=this['username'],_0x3fb505[constants_1['FLOSUM_NAMESPACE']+'Version__c']=_0x348c4a?_0x348c4a+0x1:0x1,_0x3fb505[constants_1['FLOSUM_GIT_NAMESPACE']+_0x4b609d(0x142)]=!![],_0x3fb505;}['prepareComponentRecord'](_0x1a2d29,_0x106d1d){const _0x7acfe2=a229_0x2581a9;var _0x1f5f22,_0xf11ef9;const _0x3603f6=new Date()[_0x7acfe2(0x105)](),_0x22cb45={};return!_0x106d1d?(this[_0x7acfe2(0x139)]?(_0x22cb45[constants_1[_0x7acfe2(0xf7)]+_0x7acfe2(0x128)]=this[_0x7acfe2(0x139)],_0x22cb45[constants_1['FLOSUM_NAMESPACE']+_0x7acfe2(0x11f)]=_0x7acfe2(0x147),_0x22cb45[_0x7acfe2(0x13a)]=(_0x1f5f22=this[_0x7acfe2(0x10d)][_0x7acfe2(0x10c)](_0x5df79e=>_0x5df79e[_0x7acfe2(0x103)]===_0x7acfe2(0x147)))===null||_0x1f5f22===void 0x0?void 0x0:_0x1f5f22['id']):(_0x22cb45[constants_1[_0x7acfe2(0xf7)]+'Repository__c']=this[_0x7acfe2(0x159)],_0x22cb45[constants_1[_0x7acfe2(0xf7)]+_0x7acfe2(0x11f)]=_0x7acfe2(0xf9),_0x22cb45['RecordTypeId']=(_0xf11ef9=this[_0x7acfe2(0x10d)][_0x7acfe2(0x10c)](_0x48d565=>_0x48d565['name']===_0x7acfe2(0xf9)))===null||_0xf11ef9===void 0x0?void 0x0:_0xf11ef9['id']),_0x22cb45[constants_1[_0x7acfe2(0xf7)]+_0x7acfe2(0x130)]=0x1):_0x22cb45[constants_1[_0x7acfe2(0xf7)]+_0x7acfe2(0x130)]=_0x106d1d[_0x7acfe2(0x109)]+0x1,_0x22cb45[constants_1['FLOSUM_NAMESPACE']+_0x7acfe2(0x10b)]=_0x1a2d29[_0x7acfe2(0x124)],_0x22cb45[constants_1['FLOSUM_NAMESPACE']+'Component_Name__c']=_0x1a2d29[_0x7acfe2(0x103)],_0x22cb45[constants_1[_0x7acfe2(0xf7)]+_0x7acfe2(0x149)]=_0x1a2d29['filePath'],_0x22cb45[constants_1[_0x7acfe2(0xf7)]+_0x7acfe2(0xff)]=this[_0x7acfe2(0x15d)],_0x22cb45[constants_1[_0x7acfe2(0xf7)]+_0x7acfe2(0x107)]=this[_0x7acfe2(0x15d)],_0x22cb45[constants_1[_0x7acfe2(0xf7)]+'Last_Modified_Date__c']=_0x3603f6,_0x22cb45[constants_1['FLOSUM_NAMESPACE']+_0x7acfe2(0x15a)]=_0x3603f6,_0x22cb45[constants_1[_0x7acfe2(0xf7)]+_0x7acfe2(0x106)]=_0x1a2d29[_0x7acfe2(0x14a)],_0x22cb45;}['getProceededComponentsMeta'](){const _0x5cf1e3=a229_0x2581a9;return this[_0x5cf1e3(0x143)];}async[a229_0x2581a9(0x12a)](_0x5634ce,_0x5ecab9){const _0x21bc31=a229_0x2581a9,_0x13d37d=[];for(const _0x2765f5 of _0x5634ce){const _0x5e2baa=(0x0,composite_utils_1[_0x21bc31(0x116)])(constants_1[_0x21bc31(0x15b)],this[_0x21bc31(0x132)](_0x2765f5)),_0x64f373=(0x0,composite_utils_1[_0x21bc31(0x116)])(constants_1[_0x21bc31(0x138)],this[_0x21bc31(0xfd)](_0x2765f5,'@{'+_0x5e2baa['reference']+'.id}')),_0x24e75e=(0x0,composite_utils_1[_0x21bc31(0x116)])(constants_1[_0x21bc31(0x13b)],await this[_0x21bc31(0x12c)](_0x2765f5,'@{'+_0x64f373[_0x21bc31(0x13c)]+_0x21bc31(0x129)));this[_0x21bc31(0x13d)](_0x5e2baa['request'][_0x21bc31(0x133)],_0x5e2baa[_0x21bc31(0x13c)]),_0x13d37d[_0x21bc31(0x141)](_0x5e2baa[_0x21bc31(0x115)],_0x64f373[_0x21bc31(0x115)],_0x24e75e['request']),_0x5ecab9&&_0x13d37d[_0x21bc31(0x141)](this[_0x21bc31(0x10e)](_0x5ecab9,'@{'+_0x64f373[_0x21bc31(0x13c)]+_0x21bc31(0x129)));}return _0x13d37d;}async[a229_0x2581a9(0x11d)](_0x5f20c6,_0x3af38a=''){const _0x486652=a229_0x2581a9,_0x625809=[];for(const {component:_0x1f03d3,meta:_0x19252f}of _0x5f20c6){if(!_0x19252f['id']){const _0x190aa8=this['proceededComponentsMeta'][_0x486652(0x10c)](_0x26b557=>_0x26b557['componentName']===_0x1f03d3['name']&&_0x26b557['componentType']===_0x1f03d3['type']);if(!_0x190aa8)throw new salesforce_error_1[(_0x486652(0x10a))](new Error(_0x486652(0x100)+_0x1f03d3['name']+'\x20['+_0x1f03d3[_0x486652(0x124)]+_0x486652(0x151)));_0x19252f['id']=_0x190aa8['componentId'];}const _0x47876d=(0x0,composite_utils_1['createPatchRequest'])(constants_1['FLOSUM_COMPONENT'],_0x19252f['id'],this[_0x486652(0x132)](_0x1f03d3,_0x19252f)),_0x338979=(0x0,composite_utils_1[_0x486652(0x116)])(constants_1[_0x486652(0x138)],this[_0x486652(0xfd)](_0x1f03d3,_0x19252f['id'],_0x19252f[_0x486652(0x109)])),_0x2f836a=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x486652(0x13b)],await this[_0x486652(0x12c)](_0x1f03d3,'@{'+_0x338979[_0x486652(0x13c)]+_0x486652(0x129)));this[_0x486652(0x13d)](_0x47876d[_0x486652(0x115)][_0x486652(0x133)],_0x47876d[_0x486652(0x13c)]),_0x625809[_0x486652(0x141)](_0x47876d[_0x486652(0x115)],_0x338979['request'],_0x2f836a[_0x486652(0x115)]),_0x3af38a&&_0x625809[_0x486652(0x141)](this[_0x486652(0x10e)](_0x3af38a,'@{'+_0x338979[_0x486652(0x13c)]+_0x486652(0x129)));}return _0x625809;}async[a229_0x2581a9(0x150)](_0x376e8e,_0x39a3af=![]){const _0x179123=a229_0x2581a9,_0x4e66ab={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0xf74c48=[];for(const _0x331a5d of _0x376e8e){if(_0x331a5d['id'])_0xf74c48[_0x179123(0x141)](_0x331a5d['id']);else{const _0x50a5d1=this[_0x179123(0x143)][_0x179123(0x10c)](_0x519cbd=>_0x519cbd['componentName']===_0x331a5d[_0x179123(0x103)]&&_0x519cbd[_0x179123(0x158)]===_0x331a5d[_0x179123(0x124)]);if(!_0x50a5d1||!_0x50a5d1[_0x179123(0x123)])continue;_0xf74c48[_0x179123(0x141)](_0x50a5d1[_0x179123(0x123)]);}}if(_0x39a3af){const _0x24d04c=await this['gitSync'][_0x179123(0x131)](_0xf74c48);_0x4e66ab['manifests']=_0x24d04c[_0x179123(0x108)](_0x4949d6=>(0x0,composite_utils_1[_0x179123(0x111)])(constants_1[_0x179123(0x148)],_0x4949d6)[_0x179123(0x115)]);}return _0x4e66ab[_0x179123(0x127)]=_0xf74c48[_0x179123(0x108)](_0x9c6579=>(0x0,composite_utils_1[_0x179123(0x121)])(constants_1[_0x179123(0x15b)],_0x9c6579,{[constants_1[_0x179123(0x13f)]+_0x179123(0x12d)]:!![]})[_0x179123(0x115)]),_0x4e66ab[_0x179123(0x136)]=_0xf74c48[_0x179123(0x108)](_0x322d67=>(0x0,composite_utils_1[_0x179123(0x111)])(constants_1[_0x179123(0x15b)],_0x322d67)['request']),_0x4e66ab;}}exports[a229_0x2581a9(0x120)]=SalesforceComponentsManager;