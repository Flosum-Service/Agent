const a234_0x3cff37=a234_0x1a9c;(function(_0x57e895,_0x161f9d){const _0x1099be=a234_0x1a9c,_0x14d2bc=_0x57e895();while(!![]){try{const _0x46be62=-parseInt(_0x1099be(0xe8))/0x1+-parseInt(_0x1099be(0xf4))/0x2+parseInt(_0x1099be(0xb2))/0x3*(-parseInt(_0x1099be(0xb8))/0x4)+parseInt(_0x1099be(0xcd))/0x5*(-parseInt(_0x1099be(0xa6))/0x6)+-parseInt(_0x1099be(0xbf))/0x7*(parseInt(_0x1099be(0x99))/0x8)+-parseInt(_0x1099be(0xcf))/0x9+parseInt(_0x1099be(0xde))/0xa;if(_0x46be62===_0x161f9d)break;else _0x14d2bc['push'](_0x14d2bc['shift']());}catch(_0x2ad690){_0x14d2bc['push'](_0x14d2bc['shift']());}}}(a234_0xa18f,0x2e28d));const a234_0x394d08=(function(){let _0xd055fd=!![];return function(_0x344604,_0x43223f){const _0x11627b=_0xd055fd?function(){const _0x1b904d=a234_0x1a9c;if(_0x43223f){const _0x5b3d96=_0x43223f[_0x1b904d(0xfb)](_0x344604,arguments);return _0x43223f=null,_0x5b3d96;}}:function(){};return _0xd055fd=![],_0x11627b;};}()),a234_0x1be666=a234_0x394d08(this,function(){const _0x5b59c3=a234_0x1a9c;return a234_0x1be666[_0x5b59c3(0xc9)]()[_0x5b59c3(0xe5)](_0x5b59c3(0xa8))[_0x5b59c3(0xc9)]()['constructor'](a234_0x1be666)['search'](_0x5b59c3(0xa8));});a234_0x1be666();function a234_0x1a9c(_0x3a878a,_0x2b8c02){const _0x122d4f=a234_0xa18f();return a234_0x1a9c=function(_0x1be666,_0x394d08){_0x1be666=_0x1be666-0x99;let _0xa18f86=_0x122d4f[_0x1be666];return _0xa18f86;},a234_0x1a9c(_0x3a878a,_0x2b8c02);}'use strict';var __importDefault=this&&this[a234_0x3cff37(0xd4)]||function(_0x2da1e3){const _0x5157b6=a234_0x3cff37;return _0x2da1e3&&_0x2da1e3[_0x5157b6(0xf5)]?_0x2da1e3:{'default':_0x2da1e3};};Object[a234_0x3cff37(0x9b)](exports,a234_0x3cff37(0xf5),{'value':!![]}),exports[a234_0x3cff37(0xd1)]=void 0x0;const constants_1=require(a234_0x3cff37(0xce)),core_1=require(a234_0x3cff37(0xc4)),zip_1=require(a234_0x3cff37(0xcb)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a234_0x3cff37(0xaa)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a234_0x3cff37(0xd7));class SalesforceComponentsManager{constructor(_0x5aaee5,_0x1d998b,_0x53b024,_0xcbd8e5,_0x575125){const _0x6b6e98=a234_0x3cff37;this[_0x6b6e98(0xa2)]=_0x5aaee5,this[_0x6b6e98(0xe9)]=_0x1d998b,this[_0x6b6e98(0xd9)]=_0x53b024,this[_0x6b6e98(0xa4)]=_0xcbd8e5,this[_0x6b6e98(0xb3)]=_0x575125,this['logger']=new core_1[(_0x6b6e98(0xc1))](SalesforceComponentsManager[_0x6b6e98(0x9d)]),this[_0x6b6e98(0xbb)]=typedi_1[_0x6b6e98(0xc5)][_0x6b6e98(0xf9)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a234_0x3cff37(0xf6)](_0x26a7ef,_0x334a){const _0x1e88b8=a234_0x3cff37,_0x1c6200=(0x0,flosum_naming_utils_1[_0x1e88b8(0xe3)])(_0x26a7ef,[_0x1e88b8(0xe2),_0x1e88b8(0xab),_0x1e88b8(0xa3)]);this[_0x1e88b8(0xb3)][_0x1e88b8(0xb0)]({'componentId':'','reference':_0x334a,'version':_0x1c6200[_0x1e88b8(0xa3)],'componentName':_0x1c6200[_0x1e88b8(0xab)],'componentType':_0x1c6200[_0x1e88b8(0xe2)]});}[a234_0x3cff37(0xc8)](_0x15d655,_0x4fa44e){const _0x3bd9de=a234_0x3cff37,{request:_0x125ce9}=(0x0,composite_utils_1[_0x3bd9de(0x9c)])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x3bd9de(0xb7)]+'Commit__c']:_0x15d655,[constants_1[_0x3bd9de(0xb7)]+_0x3bd9de(0xb6)]:_0x4fa44e});return _0x125ce9;}async[a234_0x3cff37(0xe7)](_0x419f30,_0x64d653){const _0x50d95c=a234_0x3cff37,_0x4a5994={},_0x59e96a=zip_1[_0x50d95c(0xd0)][_0x50d95c(0xc2)]();for(const _0x183b3c of Object[_0x50d95c(0xa5)](_0x419f30[_0x50d95c(0xbc)])){_0x59e96a[_0x50d95c(0xb4)](_0x183b3c,_0x419f30[_0x50d95c(0xbc)][_0x183b3c],{'createFolders':!![]});}return _0x4a5994[_0x50d95c(0xaf)]=_0x50d95c(0xa9),_0x4a5994[_0x50d95c(0xd2)]=_0x419f30['type'],_0x4a5994[_0x50d95c(0xeb)]=_0x419f30[_0x50d95c(0xf8)],_0x4a5994[_0x50d95c(0xb1)]=_0x64d653,_0x4a5994[_0x50d95c(0xdd)]=await _0x59e96a[_0x50d95c(0xc3)]({'type':'base64','compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x4a5994;}[a234_0x3cff37(0xef)](_0x527900,_0x3bc938,_0x1d778b){const _0x452bab=a234_0x3cff37,_0x54848e=new Date()[_0x452bab(0xa0)](),_0x16287f={};return _0x16287f[constants_1[_0x452bab(0xb7)]+_0x452bab(0xfa)]=_0x3bc938,_0x16287f[constants_1[_0x452bab(0xb7)]+'CRC32__c']=_0x527900['crc'],_0x16287f[constants_1['FLOSUM_NAMESPACE']+_0x452bab(0xec)]=_0x54848e,_0x16287f[constants_1[_0x452bab(0xb7)]+_0x452bab(0xba)]=this[_0x452bab(0xd9)],_0x16287f[constants_1[_0x452bab(0xb7)]+'Version__c']=_0x1d778b?_0x1d778b+0x1:0x1,_0x16287f[constants_1[_0x452bab(0xbd)]+_0x452bab(0xb9)]=!![],_0x16287f;}[a234_0x3cff37(0xc7)](_0xafd425,_0x22d65c){const _0x5c21ea=a234_0x3cff37;var _0x2d247f,_0x10af13;const _0x4559b2=new Date()['toISOString'](),_0x18800e={};return!_0x22d65c?(this[_0x5c21ea(0xe9)]?(_0x18800e[constants_1['FLOSUM_NAMESPACE']+_0x5c21ea(0xe6)]=this[_0x5c21ea(0xe9)],_0x18800e[constants_1['FLOSUM_NAMESPACE']+_0x5c21ea(0xe0)]=_0x5c21ea(0xad),_0x18800e[_0x5c21ea(0xf2)]=(_0x2d247f=this[_0x5c21ea(0xa4)]['find'](_0x146be8=>_0x146be8['name']===_0x5c21ea(0xad)))===null||_0x2d247f===void 0x0?void 0x0:_0x2d247f['id']):(_0x18800e[constants_1[_0x5c21ea(0xb7)]+_0x5c21ea(0xed)]=this[_0x5c21ea(0xa2)],_0x18800e[constants_1[_0x5c21ea(0xb7)]+_0x5c21ea(0xe0)]=_0x5c21ea(0xf3),_0x18800e['RecordTypeId']=(_0x10af13=this[_0x5c21ea(0xa4)][_0x5c21ea(0xf0)](_0xa2aac0=>_0xa2aac0[_0x5c21ea(0x9d)]==='Repository'))===null||_0x10af13===void 0x0?void 0x0:_0x10af13['id']),_0x18800e[constants_1[_0x5c21ea(0xb7)]+'Version__c']=0x1):_0x18800e[constants_1[_0x5c21ea(0xb7)]+'Version__c']=_0x22d65c['version']+0x1,_0x18800e[constants_1['FLOSUM_NAMESPACE']+'Component_Type__c']=_0xafd425[_0x5c21ea(0xf8)],_0x18800e[constants_1[_0x5c21ea(0xb7)]+_0x5c21ea(0xab)]=_0xafd425[_0x5c21ea(0x9d)],_0x18800e[constants_1[_0x5c21ea(0xb7)]+_0x5c21ea(0xd6)]=_0xafd425['filePath'],_0x18800e[constants_1[_0x5c21ea(0xb7)]+_0x5c21ea(0xea)]=this[_0x5c21ea(0xd9)],_0x18800e[constants_1['FLOSUM_NAMESPACE']+_0x5c21ea(0xf1)]=this[_0x5c21ea(0xd9)],_0x18800e[constants_1[_0x5c21ea(0xb7)]+_0x5c21ea(0x9a)]=_0x4559b2,_0x18800e[constants_1['FLOSUM_NAMESPACE']+'Committed_On__c']=_0x4559b2,_0x18800e[constants_1[_0x5c21ea(0xb7)]+_0x5c21ea(0xda)]=_0xafd425[_0x5c21ea(0xd8)],_0x18800e[constants_1[_0x5c21ea(0xb7)]+'Vlocity_Component_Name__c']=_0xafd425[_0x5c21ea(0xac)],_0x18800e[constants_1[_0x5c21ea(0xb7)]+_0x5c21ea(0xdc)]=_0xafd425['isVlocityComponent'],_0x18800e;}[a234_0x3cff37(0xe1)](){const _0x427f01=a234_0x3cff37;return this[_0x427f01(0xb3)];}async['insert'](_0x3437b3,_0x39f5da){const _0x18998f=a234_0x3cff37,_0x103693=[];for(const _0x137c89 of _0x3437b3){const _0x3255eb=(0x0,composite_utils_1[_0x18998f(0x9c)])(constants_1[_0x18998f(0xb5)],this[_0x18998f(0xc7)](_0x137c89)),_0x2a3fec=(0x0,composite_utils_1[_0x18998f(0x9c)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x18998f(0xef)](_0x137c89,'@{'+_0x3255eb['reference']+_0x18998f(0x9e))),_0x3f60ab=(0x0,composite_utils_1[_0x18998f(0x9c)])(constants_1[_0x18998f(0xa7)],await this[_0x18998f(0xe7)](_0x137c89,'@{'+_0x2a3fec[_0x18998f(0xc0)]+_0x18998f(0x9e)));this[_0x18998f(0xf6)](_0x3255eb['request'][_0x18998f(0xee)],_0x3255eb[_0x18998f(0xc0)]),_0x103693[_0x18998f(0xb0)](_0x3255eb['request'],_0x2a3fec[_0x18998f(0xd5)],_0x3f60ab['request']),_0x39f5da&&_0x103693[_0x18998f(0xb0)](this['prepareCommitManifest'](_0x39f5da,'@{'+_0x2a3fec[_0x18998f(0xc0)]+'.id}'));}return _0x103693;}async[a234_0x3cff37(0xf7)](_0x19e4bb,_0x4131fc=''){const _0x5651de=a234_0x3cff37,_0x57d218=[];for(const {component:_0x11f8bf,meta:_0x2f30d5}of _0x19e4bb){if(!_0x2f30d5['id']){const _0x41dd84=this[_0x5651de(0xb3)]['find'](_0x404b33=>_0x404b33[_0x5651de(0x9f)]===_0x11f8bf[_0x5651de(0x9d)]&&_0x404b33['componentType']===_0x11f8bf[_0x5651de(0xf8)]);if(!_0x41dd84)throw new salesforce_error_1[(_0x5651de(0xca))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x11f8bf[_0x5651de(0x9d)]+'\x20['+_0x11f8bf[_0x5651de(0xf8)]+_0x5651de(0xa1)));_0x2f30d5['id']=_0x41dd84[_0x5651de(0xdf)];}const _0x53664c=(0x0,composite_utils_1[_0x5651de(0xc6)])(constants_1[_0x5651de(0xb5)],_0x2f30d5['id'],this[_0x5651de(0xc7)](_0x11f8bf,_0x2f30d5)),_0x4cf9e9=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x5651de(0xef)](_0x11f8bf,_0x2f30d5['id'],_0x2f30d5[_0x5651de(0xae)])),_0x1b96ea=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x5651de(0xa7)],await this[_0x5651de(0xe7)](_0x11f8bf,'@{'+_0x4cf9e9[_0x5651de(0xc0)]+_0x5651de(0x9e)));this['proceedComponentMeta'](_0x53664c['request']['body'],_0x53664c[_0x5651de(0xc0)]),_0x57d218['push'](_0x53664c[_0x5651de(0xd5)],_0x4cf9e9['request'],_0x1b96ea['request']),_0x4131fc&&_0x57d218['push'](this[_0x5651de(0xc8)](_0x4131fc,'@{'+_0x4cf9e9['reference']+'.id}'));}return _0x57d218;}async['delete'](_0xb6d3c3,_0x3a0eb1=![]){const _0x2c5d07=a234_0x3cff37,_0x529091={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x1a7c7f=[];for(const _0x4805f9 of _0xb6d3c3){if(_0x4805f9['id'])_0x1a7c7f[_0x2c5d07(0xb0)](_0x4805f9['id']);else{const _0x2968cf=this[_0x2c5d07(0xb3)][_0x2c5d07(0xf0)](_0x349762=>_0x349762[_0x2c5d07(0x9f)]===_0x4805f9['name']&&_0x349762[_0x2c5d07(0xe4)]===_0x4805f9['type']);if(!_0x2968cf||!_0x2968cf[_0x2c5d07(0xdf)])continue;_0x1a7c7f['push'](_0x2968cf[_0x2c5d07(0xdf)]);}}if(_0x3a0eb1){const _0x49344e=await this[_0x2c5d07(0xbb)]['fetchCommitManifestsByComponentIds'](_0x1a7c7f);_0x529091['manifests']=_0x49344e['map'](_0x22e912=>(0x0,composite_utils_1[_0x2c5d07(0xcc)])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x22e912)[_0x2c5d07(0xd5)]);}return _0x529091[_0x2c5d07(0xd3)]=_0x1a7c7f[_0x2c5d07(0xbe)](_0xb55b91=>(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x2c5d07(0xb5)],_0xb55b91,{[constants_1[_0x2c5d07(0xbd)]+_0x2c5d07(0xdb)]:!![]})[_0x2c5d07(0xd5)]),_0x529091['componentsToDelete']=_0x1a7c7f['map'](_0x452e14=>(0x0,composite_utils_1[_0x2c5d07(0xcc)])(constants_1[_0x2c5d07(0xb5)],_0x452e14)[_0x2c5d07(0xd5)]),_0x529091;}}function a234_0xa18f(){const _0x150b00=['extractFieldsFromRecord','componentType','search','Branch__c','prepareComponentAttachmentRecord','160349DFHiTQ','branchId','Last_Updated_By__c','Description','Changed_On__c','Repository__c','body','prepareComponentHistoryRecord','find','Last_Modified_By__c','RecordTypeId','Repository','548424uIKOAN','__esModule','proceedComponentMeta','update','type','get','Component__c','apply','16RqLWBZ','Last_Modified_Date__c','defineProperty','createPostRequest','name','.id}','componentName','toISOString',']\x20-\x20meta\x20not\x20found','repositoryId','Version__c','recordTypes','keys','1102884wEZpVr','FLOSUM_ATTACHMENT','(((.+)+)+)+$','application/zip','../utils/composite.utils','Component_Name__c','vlocityComponentName','Branch','version','ContentType','push','ParentId','1113DgQDwZ','proceededComponentsMeta','file','FLOSUM_COMPONENT','Component_History__c','FLOSUM_NAMESPACE','656qEsUiG','Is_From_Agent__c','Changed_By__c','gitSync','files','FLOSUM_GIT_NAMESPACE','map','425747tisadx','reference','Logger','createZip','generateAsync','../../../../core','default','createPatchRequest','prepareComponentRecord','prepareCommitManifest','toString','SalesforceError','../../parsers/utils/zip','createDeleteRequest','10pjXFUy','../../../../constants','2574918wFQOwJ','Zip','SalesforceComponentsManager','Name','componentsToUpdate','__importDefault','request','File_Name__c','./salesforce-git-sync.service','crc','username','CRC32__c','Deletion_By_Agent__c','Vlocity_Component__c','Body','14598460peLufa','componentId','Source__c','getProceededComponentsMeta','Component_Type__c'];a234_0xa18f=function(){return _0x150b00;};return a234_0xa18f();}exports['SalesforceComponentsManager']=SalesforceComponentsManager;