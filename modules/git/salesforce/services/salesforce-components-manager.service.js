const a271_0x2a0b4f=a271_0x48c9;(function(_0x2bfcf7,_0x2a01f5){const _0xb1c091=a271_0x48c9,_0x4ef05a=_0x2bfcf7();while(!![]){try{const _0x265d44=parseInt(_0xb1c091(0x18a))/0x1*(parseInt(_0xb1c091(0x153))/0x2)+-parseInt(_0xb1c091(0x130))/0x3+-parseInt(_0xb1c091(0x133))/0x4+parseInt(_0xb1c091(0x15d))/0x5+parseInt(_0xb1c091(0x145))/0x6+-parseInt(_0xb1c091(0x16a))/0x7+parseInt(_0xb1c091(0x191))/0x8*(parseInt(_0xb1c091(0x12d))/0x9);if(_0x265d44===_0x2a01f5)break;else _0x4ef05a['push'](_0x4ef05a['shift']());}catch(_0x4c6fb1){_0x4ef05a['push'](_0x4ef05a['shift']());}}}(a271_0x2ac3,0x4213e));function a271_0x2ac3(){const _0x5b12e5=['FLOSUM_COMPONENT_HISTORY','manifests','CRC32__c','Changed_By__c','166lVqSxE','RecordTypeId','Source__c','map','Component_History__c','extractFieldsFromRecord','__importDefault','88VYpsVF','application/zip','File_Name__c','repositoryId','reference','componentsToDelete','Last_Modified_By__c','3843WiMfBC','username','../errors/salesforce.error','447327Gvblis','SalesforceComponentsManager','branchId','915708RcTfUC','getProceededComponentsMeta','__esModule','Repository__c','push','default','../../parsers/utils/zip','Deletion_By_Agent__c','Vlocity_Component_Name__c','type','./salesforce-git-sync.service','Committed_On__c','generateAsync','ContentType','Zip','Version__c','../../../../core','componentName','2097840PlxFVq','.id}','DEFLATE','Could\x20not\x20proceed\x20component\x20','crc','version','createZip','componentType','createPostRequest','logger','find','constructor','FLOSUM_COMMIT_MANIFEST','componentId','2708ztUNQR','FLOSUM_COMPONENT','FLOSUM_GIT_NAMESPACE','request','prepareComponentRecord','proceededComponentsMeta','recordTypes','SalesforceError','createDeleteRequest','toISOString','1597620zuFLxd','Branch','Description','Last_Modified_Date__c','prepareComponentHistoryRecord','vlocityComponentName','file','gitSync','Commit__c','search','Last_Updated_By__c','body','../utils/composite.utils','1749545HBtaWp','update','Name','Component_Name__c','base64','FLOSUM_NAMESPACE','toString','name',']\x20-\x20meta\x20not\x20found','createPatchRequest','filePath','Branch__c','../../../../constants','files','(((.+)+)+)+$','Repository','prepareComponentAttachmentRecord','prepareCommitManifest','isVlocityComponent','FLOSUM_ATTACHMENT','MC_Key__c','Is_From_Agent__c','Changed_On__c','delete','Component_Type__c','proceedComponentMeta','Vlocity_Component__c','ParentId'];a271_0x2ac3=function(){return _0x5b12e5;};return a271_0x2ac3();}const a271_0x2895ef=(function(){let _0x568ba3=!![];return function(_0x479382,_0x32e407){const _0x24e07=_0x568ba3?function(){if(_0x32e407){const _0x5b5267=_0x32e407['apply'](_0x479382,arguments);return _0x32e407=null,_0x5b5267;}}:function(){};return _0x568ba3=![],_0x24e07;};}()),a271_0x4d0621=a271_0x2895ef(this,function(){const _0x3d72ab=a271_0x48c9;return a271_0x4d0621['toString']()[_0x3d72ab(0x166)](_0x3d72ab(0x178))[_0x3d72ab(0x170)]()[_0x3d72ab(0x150)](a271_0x4d0621)[_0x3d72ab(0x166)]('(((.+)+)+)+$');});a271_0x4d0621();function a271_0x48c9(_0x3b71fe,_0x12507f){const _0x51b2c0=a271_0x2ac3();return a271_0x48c9=function(_0x4d0621,_0x2895ef){_0x4d0621=_0x4d0621-0x12d;let _0x2ac3c2=_0x51b2c0[_0x4d0621];return _0x2ac3c2;},a271_0x48c9(_0x3b71fe,_0x12507f);}'use strict';var __importDefault=this&&this[a271_0x2a0b4f(0x190)]||function(_0xbfc3eb){const _0x52a4b0=a271_0x2a0b4f;return _0xbfc3eb&&_0xbfc3eb[_0x52a4b0(0x135)]?_0xbfc3eb:{'default':_0xbfc3eb};};Object['defineProperty'](exports,a271_0x2a0b4f(0x135),{'value':!![]}),exports[a271_0x2a0b4f(0x131)]=void 0x0;const constants_1=require(a271_0x2a0b4f(0x176)),core_1=require(a271_0x2a0b4f(0x143)),zip_1=require(a271_0x2a0b4f(0x139)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a271_0x2a0b4f(0x12f)),composite_utils_1=require(a271_0x2a0b4f(0x169)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a271_0x2a0b4f(0x13d));class SalesforceComponentsManager{constructor(_0x1b0241,_0x328a73,_0x5542b9,_0x2f902d,_0x27e455){const _0x41c2b8=a271_0x2a0b4f;this[_0x41c2b8(0x194)]=_0x1b0241,this[_0x41c2b8(0x132)]=_0x328a73,this[_0x41c2b8(0x12e)]=_0x5542b9,this[_0x41c2b8(0x159)]=_0x2f902d,this['proceededComponentsMeta']=_0x27e455,this[_0x41c2b8(0x14e)]=new core_1['Logger'](SalesforceComponentsManager[_0x41c2b8(0x171)]),this[_0x41c2b8(0x164)]=typedi_1[_0x41c2b8(0x138)]['get'](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a271_0x2a0b4f(0x183)](_0x156f9f,_0x4f7c0f){const _0x387eb0=a271_0x2a0b4f,_0x55d353=(0x0,flosum_naming_utils_1[_0x387eb0(0x18f)])(_0x156f9f,[_0x387eb0(0x182),_0x387eb0(0x16d),_0x387eb0(0x142)]);this[_0x387eb0(0x158)][_0x387eb0(0x137)]({'componentId':'','reference':_0x4f7c0f,'version':_0x55d353['Version__c'],'componentName':_0x55d353[_0x387eb0(0x16d)],'componentType':_0x55d353['Component_Type__c']});}[a271_0x2a0b4f(0x17b)](_0x449b18,_0x43b3a){const _0x5f37db=a271_0x2a0b4f,{request:_0x490003}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x5f37db(0x151)],{[constants_1[_0x5f37db(0x16f)]+_0x5f37db(0x165)]:_0x449b18,[constants_1[_0x5f37db(0x16f)]+_0x5f37db(0x18e)]:_0x43b3a});return _0x490003;}async[a271_0x2a0b4f(0x17a)](_0x501f82,_0x119b10){const _0x2db6a9=a271_0x2a0b4f,_0x4430f2={},_0x210e16=zip_1[_0x2db6a9(0x141)][_0x2db6a9(0x14b)]();for(const _0x280eb6 of Object['keys'](_0x501f82[_0x2db6a9(0x177)])){_0x210e16[_0x2db6a9(0x163)](_0x280eb6,_0x501f82[_0x2db6a9(0x177)][_0x280eb6],{'createFolders':!![]});}return _0x4430f2[_0x2db6a9(0x140)]=_0x2db6a9(0x192),_0x4430f2[_0x2db6a9(0x16c)]=_0x501f82[_0x2db6a9(0x13c)],_0x4430f2[_0x2db6a9(0x15f)]=_0x501f82['type'],_0x4430f2[_0x2db6a9(0x185)]=_0x119b10,_0x4430f2['Body']=await _0x210e16[_0x2db6a9(0x13f)]({'type':_0x2db6a9(0x16e),'compression':_0x2db6a9(0x147),'compressionOptions':{'level':0x6}}),_0x4430f2;}[a271_0x2a0b4f(0x161)](_0x2d76ed,_0x3c8881,_0x41e8b6){const _0x27ac92=a271_0x2a0b4f,_0x16d06a=new Date()[_0x27ac92(0x15c)](),_0x334140={};return _0x334140[constants_1[_0x27ac92(0x16f)]+'Component__c']=_0x3c8881,_0x334140[constants_1[_0x27ac92(0x16f)]+_0x27ac92(0x188)]=_0x2d76ed[_0x27ac92(0x149)],_0x334140[constants_1['FLOSUM_NAMESPACE']+_0x27ac92(0x180)]=_0x16d06a,_0x334140[constants_1[_0x27ac92(0x16f)]+_0x27ac92(0x189)]=this['username'],_0x334140[constants_1[_0x27ac92(0x16f)]+_0x27ac92(0x142)]=_0x41e8b6?_0x41e8b6+0x1:0x1,_0x334140[constants_1[_0x27ac92(0x155)]+_0x27ac92(0x17f)]=!![],_0x334140;}['prepareComponentRecord'](_0x33a58a,_0x41b884){const _0x171ef5=a271_0x2a0b4f;var _0x112ae0,_0x45ae26;const _0x4aa6b4=new Date()['toISOString'](),_0x5ec8a0={};return!_0x41b884?(this[_0x171ef5(0x132)]?(_0x5ec8a0[constants_1[_0x171ef5(0x16f)]+_0x171ef5(0x175)]=this[_0x171ef5(0x132)],_0x5ec8a0[constants_1[_0x171ef5(0x16f)]+_0x171ef5(0x18c)]=_0x171ef5(0x15e),_0x5ec8a0[_0x171ef5(0x18b)]=(_0x112ae0=this[_0x171ef5(0x159)][_0x171ef5(0x14f)](_0x2ee59a=>_0x2ee59a[_0x171ef5(0x171)]===_0x171ef5(0x15e)))===null||_0x112ae0===void 0x0?void 0x0:_0x112ae0['id']):(_0x5ec8a0[constants_1[_0x171ef5(0x16f)]+_0x171ef5(0x136)]=this[_0x171ef5(0x194)],_0x5ec8a0[constants_1['FLOSUM_NAMESPACE']+_0x171ef5(0x18c)]='Repository',_0x5ec8a0[_0x171ef5(0x18b)]=(_0x45ae26=this['recordTypes'][_0x171ef5(0x14f)](_0xc016a2=>_0xc016a2[_0x171ef5(0x171)]===_0x171ef5(0x179)))===null||_0x45ae26===void 0x0?void 0x0:_0x45ae26['id']),_0x5ec8a0[constants_1[_0x171ef5(0x16f)]+_0x171ef5(0x142)]=0x1):_0x5ec8a0[constants_1[_0x171ef5(0x16f)]+_0x171ef5(0x142)]=_0x41b884[_0x171ef5(0x14a)]+0x1,_0x5ec8a0[constants_1['FLOSUM_NAMESPACE']+_0x171ef5(0x182)]=_0x33a58a[_0x171ef5(0x13c)],_0x5ec8a0[constants_1[_0x171ef5(0x16f)]+_0x171ef5(0x16d)]=_0x33a58a['name'],_0x5ec8a0[constants_1['FLOSUM_NAMESPACE']+_0x171ef5(0x193)]=_0x33a58a[_0x171ef5(0x174)],_0x5ec8a0[constants_1['FLOSUM_NAMESPACE']+_0x171ef5(0x167)]=this[_0x171ef5(0x12e)],_0x5ec8a0[constants_1[_0x171ef5(0x16f)]+_0x171ef5(0x197)]=this[_0x171ef5(0x12e)],_0x5ec8a0[constants_1[_0x171ef5(0x16f)]+_0x171ef5(0x160)]=_0x4aa6b4,_0x5ec8a0[constants_1['FLOSUM_NAMESPACE']+_0x171ef5(0x13e)]=_0x4aa6b4,_0x5ec8a0[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x33a58a[_0x171ef5(0x149)],_0x5ec8a0[constants_1['FLOSUM_NAMESPACE']+_0x171ef5(0x13b)]=_0x33a58a[_0x171ef5(0x162)],_0x5ec8a0[constants_1[_0x171ef5(0x16f)]+_0x171ef5(0x184)]=_0x33a58a[_0x171ef5(0x17c)],_0x5ec8a0[constants_1[_0x171ef5(0x16f)]+_0x171ef5(0x17e)]=_0x33a58a['marketingCloudKey'],_0x5ec8a0;}[a271_0x2a0b4f(0x134)](){return this['proceededComponentsMeta'];}async['insert'](_0x229d9a,_0x28fd20){const _0x312f26=a271_0x2a0b4f,_0x5c9270=[];for(const _0x5ceab4 of _0x229d9a){const _0x10a15e=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x312f26(0x154)],this[_0x312f26(0x157)](_0x5ceab4)),_0x459e75=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x312f26(0x186)],this[_0x312f26(0x161)](_0x5ceab4,'@{'+_0x10a15e[_0x312f26(0x195)]+_0x312f26(0x146))),_0x3ae527=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_ATTACHMENT'],await this['prepareComponentAttachmentRecord'](_0x5ceab4,'@{'+_0x459e75[_0x312f26(0x195)]+'.id}'));this['proceedComponentMeta'](_0x10a15e[_0x312f26(0x156)][_0x312f26(0x168)],_0x10a15e[_0x312f26(0x195)]),_0x5c9270['push'](_0x10a15e[_0x312f26(0x156)],_0x459e75['request'],_0x3ae527[_0x312f26(0x156)]),_0x28fd20&&_0x5c9270[_0x312f26(0x137)](this[_0x312f26(0x17b)](_0x28fd20,'@{'+_0x459e75['reference']+'.id}'));}return _0x5c9270;}async[a271_0x2a0b4f(0x16b)](_0x340aab,_0x13230c=''){const _0x4f6c5c=a271_0x2a0b4f,_0x18dc54=[];for(const {component:_0x17c41a,meta:_0x407402}of _0x340aab){if(!_0x407402['id']){const _0x528a7e=this[_0x4f6c5c(0x158)][_0x4f6c5c(0x14f)](_0x50ea8c=>_0x50ea8c[_0x4f6c5c(0x144)]===_0x17c41a[_0x4f6c5c(0x171)]&&_0x50ea8c[_0x4f6c5c(0x14c)]===_0x17c41a[_0x4f6c5c(0x13c)]);if(!_0x528a7e)throw new salesforce_error_1[(_0x4f6c5c(0x15a))](new Error(_0x4f6c5c(0x148)+_0x17c41a[_0x4f6c5c(0x171)]+'\x20['+_0x17c41a['type']+_0x4f6c5c(0x172)));_0x407402['id']=_0x528a7e[_0x4f6c5c(0x152)];}const _0x4cea26=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x4f6c5c(0x154)],_0x407402['id'],this[_0x4f6c5c(0x157)](_0x17c41a,_0x407402)),_0x16de4d=(0x0,composite_utils_1[_0x4f6c5c(0x14d)])(constants_1[_0x4f6c5c(0x186)],this[_0x4f6c5c(0x161)](_0x17c41a,_0x407402['id'],_0x407402['version'])),_0x476669=(0x0,composite_utils_1[_0x4f6c5c(0x14d)])(constants_1[_0x4f6c5c(0x17d)],await this[_0x4f6c5c(0x17a)](_0x17c41a,'@{'+_0x16de4d['reference']+_0x4f6c5c(0x146)));this['proceedComponentMeta'](_0x4cea26[_0x4f6c5c(0x156)][_0x4f6c5c(0x168)],_0x4cea26[_0x4f6c5c(0x195)]),_0x18dc54[_0x4f6c5c(0x137)](_0x4cea26['request'],_0x16de4d[_0x4f6c5c(0x156)],_0x476669[_0x4f6c5c(0x156)]),_0x13230c&&_0x18dc54[_0x4f6c5c(0x137)](this[_0x4f6c5c(0x17b)](_0x13230c,'@{'+_0x16de4d['reference']+_0x4f6c5c(0x146)));}return _0x18dc54;}async[a271_0x2a0b4f(0x181)](_0x396d68,_0x8764f7=![]){const _0x1930f7=a271_0x2a0b4f,_0x56ba4a={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x1d6f14=[];for(const _0x340334 of _0x396d68){if(_0x340334['id'])_0x1d6f14[_0x1930f7(0x137)](_0x340334['id']);else{const _0x4366ac=this['proceededComponentsMeta'][_0x1930f7(0x14f)](_0x4f749c=>_0x4f749c['componentName']===_0x340334[_0x1930f7(0x171)]&&_0x4f749c[_0x1930f7(0x14c)]===_0x340334[_0x1930f7(0x13c)]);if(!_0x4366ac||!_0x4366ac[_0x1930f7(0x152)])continue;_0x1d6f14[_0x1930f7(0x137)](_0x4366ac[_0x1930f7(0x152)]);}}if(_0x8764f7){const _0x1c81c4=await this[_0x1930f7(0x164)]['fetchCommitManifestsByComponentIds'](_0x1d6f14);_0x56ba4a[_0x1930f7(0x187)]=_0x1c81c4[_0x1930f7(0x18d)](_0xda281c=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x1930f7(0x151)],_0xda281c)[_0x1930f7(0x156)]);}return _0x56ba4a['componentsToUpdate']=_0x1d6f14[_0x1930f7(0x18d)](_0x53043c=>(0x0,composite_utils_1[_0x1930f7(0x173)])(constants_1['FLOSUM_COMPONENT'],_0x53043c,{[constants_1[_0x1930f7(0x155)]+_0x1930f7(0x13a)]:!![]})[_0x1930f7(0x156)]),_0x56ba4a[_0x1930f7(0x196)]=_0x1d6f14['map'](_0x524777=>(0x0,composite_utils_1[_0x1930f7(0x15b)])(constants_1[_0x1930f7(0x154)],_0x524777)[_0x1930f7(0x156)]),_0x56ba4a;}}exports[a271_0x2a0b4f(0x131)]=SalesforceComponentsManager;