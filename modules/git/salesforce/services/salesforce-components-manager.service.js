const a228_0x288e02=a228_0x43bc;(function(_0x132e01,_0x3b4515){const _0x16a141=a228_0x43bc,_0x243d76=_0x132e01();while(!![]){try{const _0x450a87=-parseInt(_0x16a141(0x20c))/0x1*(-parseInt(_0x16a141(0x1f0))/0x2)+-parseInt(_0x16a141(0x1d6))/0x3+-parseInt(_0x16a141(0x1c7))/0x4*(-parseInt(_0x16a141(0x1be))/0x5)+parseInt(_0x16a141(0x1db))/0x6+parseInt(_0x16a141(0x200))/0x7+parseInt(_0x16a141(0x1e5))/0x8+-parseInt(_0x16a141(0x1cd))/0x9;if(_0x450a87===_0x3b4515)break;else _0x243d76['push'](_0x243d76['shift']());}catch(_0x1ae041){_0x243d76['push'](_0x243d76['shift']());}}}(a228_0x2597,0x781fc));const a228_0x577e71=(function(){let _0x59e9f0=!![];return function(_0x4d2993,_0x3a4d28){const _0x1d7529=_0x59e9f0?function(){if(_0x3a4d28){const _0x3b608c=_0x3a4d28['apply'](_0x4d2993,arguments);return _0x3a4d28=null,_0x3b608c;}}:function(){};return _0x59e9f0=![],_0x1d7529;};}()),a228_0x1814c9=a228_0x577e71(this,function(){const _0x57f4e8=a228_0x43bc;return a228_0x1814c9['toString']()['search'](_0x57f4e8(0x203))['toString']()[_0x57f4e8(0x1fe)](a228_0x1814c9)[_0x57f4e8(0x1cc)](_0x57f4e8(0x203));});a228_0x1814c9();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x384e73){const _0x4ca638=a228_0x43bc;return _0x384e73&&_0x384e73[_0x4ca638(0x1d1)]?_0x384e73:{'default':_0x384e73};};Object['defineProperty'](exports,a228_0x288e02(0x1d1),{'value':!![]}),exports[a228_0x288e02(0x204)]=void 0x0;function a228_0x2597(){const _0xb1133b=['prepareComponentAttachmentRecord','map','getProceededComponentsMeta','4520484fficnc','recordTypes','componentId','name','repositoryId','files','typedi','createPatchRequest','componentName','reference','3167096ksbGJI','./salesforce-git-sync.service','componentsToDelete','username','base64','ContentType','body','default','crc','Last_Updated_By__c','ParentId','1259826shabsl','FLOSUM_ATTACHMENT','Repository__c','push','Commit__c','prepareComponentHistoryRecord','toISOString','gitSync','proceedComponentMeta','proceededComponentsMeta','fetchCommitManifestsByComponentIds','createDeleteRequest','insert','update','constructor','logger','2245432CUyBsX','../utils/composite.utils','componentType','(((.+)+)+)+$','SalesforceComponentsManager','prepareComponentRecord','Changed_By__c','Zip','DEFLATE','../utils/flosum-naming.utils','Repository','Version__c','1tyduKt','.id}','Component_Name__c','Could\x20not\x20proceed\x20component\x20','SalesforceError','version','Branch','Component_History__c','FLOSUM_COMMIT_MANIFEST','FLOSUM_COMPONENT','find','Component_Type__c','type','generateAsync','Description','90215cJoxey','FLOSUM_NAMESPACE','filePath','createZip','../../../../constants','Logger','branchId','Name','file','36JEBIFs','FLOSUM_GIT_NAMESPACE',']\x20-\x20meta\x20not\x20found','request','Changed_On__c','search','13387221QjUjlQ','CRC32__c','Last_Modified_By__c','createPostRequest','__esModule','prepareCommitManifest','Source__c','keys','Deletion_By_Agent__c','848640TyAsRN','../../parsers/utils/zip'];a228_0x2597=function(){return _0xb1133b;};return a228_0x2597();}const constants_1=require(a228_0x288e02(0x1c2)),core_1=require('../../../../core'),zip_1=require(a228_0x288e02(0x1d7)),typedi_1=__importDefault(require(a228_0x288e02(0x1e1))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a228_0x288e02(0x201)),flosum_naming_utils_1=require(a228_0x288e02(0x209)),salesforce_git_sync_service_1=require(a228_0x288e02(0x1e6));class SalesforceComponentsManager{constructor(_0x2e3316,_0x5de0d2,_0x549038,_0x3df0c2,_0x5dd75c){const _0x4f7128=a228_0x288e02;this[_0x4f7128(0x1df)]=_0x2e3316,this[_0x4f7128(0x1c4)]=_0x5de0d2,this[_0x4f7128(0x1e8)]=_0x549038,this[_0x4f7128(0x1dc)]=_0x3df0c2,this[_0x4f7128(0x1f9)]=_0x5dd75c,this[_0x4f7128(0x1ff)]=new core_1[(_0x4f7128(0x1c3))](SalesforceComponentsManager['name']),this[_0x4f7128(0x1f7)]=typedi_1[_0x4f7128(0x1ec)]['get'](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a228_0x288e02(0x1f8)](_0x51e7ba,_0x2a9a7b){const _0x24799f=a228_0x288e02,_0x4518bb=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x51e7ba,['Component_Type__c',_0x24799f(0x20e),_0x24799f(0x20b)]);this[_0x24799f(0x1f9)]['push']({'componentId':'','reference':_0x2a9a7b,'version':_0x4518bb[_0x24799f(0x20b)],'componentName':_0x4518bb[_0x24799f(0x20e)],'componentType':_0x4518bb[_0x24799f(0x1ba)]});}['prepareCommitManifest'](_0x4f1f3e,_0x5b4576){const _0x21de6c=a228_0x288e02,{request:_0x109210}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x21de6c(0x214)],{[constants_1[_0x21de6c(0x1bf)]+_0x21de6c(0x1f4)]:_0x4f1f3e,[constants_1[_0x21de6c(0x1bf)]+_0x21de6c(0x213)]:_0x5b4576});return _0x109210;}async[a228_0x288e02(0x1d8)](_0x1a267f,_0xf6ba51){const _0x2c753f=a228_0x288e02,_0x1dd8fc={},_0x45d3a0=zip_1[_0x2c753f(0x207)][_0x2c753f(0x1c1)]();for(const _0x54f666 of Object[_0x2c753f(0x1d4)](_0x1a267f[_0x2c753f(0x1e0)])){_0x45d3a0[_0x2c753f(0x1c6)](_0x54f666,_0x1a267f[_0x2c753f(0x1e0)][_0x54f666],{'createFolders':!![]});}return _0x1dd8fc[_0x2c753f(0x1ea)]='application/zip',_0x1dd8fc[_0x2c753f(0x1c5)]=_0x1a267f[_0x2c753f(0x1bb)],_0x1dd8fc[_0x2c753f(0x1bd)]=_0x1a267f[_0x2c753f(0x1bb)],_0x1dd8fc[_0x2c753f(0x1ef)]=_0xf6ba51,_0x1dd8fc['Body']=await _0x45d3a0[_0x2c753f(0x1bc)]({'type':_0x2c753f(0x1e9),'compression':_0x2c753f(0x208),'compressionOptions':{'level':0x6}}),_0x1dd8fc;}[a228_0x288e02(0x1f5)](_0x1f8f86,_0x2f67bd,_0x1e0dff){const _0x39451f=a228_0x288e02,_0x5d0052=new Date()['toISOString'](),_0x3c754a={};return _0x3c754a[constants_1[_0x39451f(0x1bf)]+'Component__c']=_0x2f67bd,_0x3c754a[constants_1[_0x39451f(0x1bf)]+_0x39451f(0x1ce)]=_0x1f8f86[_0x39451f(0x1ed)],_0x3c754a[constants_1[_0x39451f(0x1bf)]+_0x39451f(0x1cb)]=_0x5d0052,_0x3c754a[constants_1[_0x39451f(0x1bf)]+_0x39451f(0x206)]=this[_0x39451f(0x1e8)],_0x3c754a[constants_1[_0x39451f(0x1bf)]+_0x39451f(0x20b)]=_0x1e0dff?_0x1e0dff+0x1:0x1,_0x3c754a[constants_1[_0x39451f(0x1c8)]+'Is_From_Agent__c']=!![],_0x3c754a;}[a228_0x288e02(0x205)](_0xc3d865,_0x20879c){const _0x7c5d68=a228_0x288e02;var _0x3c9b03,_0x2beebe;const _0x1816ec=new Date()[_0x7c5d68(0x1f6)](),_0xf125b5={};return!_0x20879c?(this['branchId']?(_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+'Branch__c']=this[_0x7c5d68(0x1c4)],_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+'Source__c']=_0x7c5d68(0x212),_0xf125b5['RecordTypeId']=(_0x3c9b03=this[_0x7c5d68(0x1dc)][_0x7c5d68(0x1b9)](_0x19b45b=>_0x19b45b['name']==='Branch'))===null||_0x3c9b03===void 0x0?void 0x0:_0x3c9b03['id']):(_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+_0x7c5d68(0x1f2)]=this[_0x7c5d68(0x1df)],_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+_0x7c5d68(0x1d3)]=_0x7c5d68(0x20a),_0xf125b5['RecordTypeId']=(_0x2beebe=this[_0x7c5d68(0x1dc)]['find'](_0x496ddb=>_0x496ddb['name']===_0x7c5d68(0x20a)))===null||_0x2beebe===void 0x0?void 0x0:_0x2beebe['id']),_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+'Version__c']=0x1):_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+'Version__c']=_0x20879c[_0x7c5d68(0x211)]+0x1,_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+_0x7c5d68(0x1ba)]=_0xc3d865['type'],_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+_0x7c5d68(0x20e)]=_0xc3d865[_0x7c5d68(0x1de)],_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+'File_Name__c']=_0xc3d865[_0x7c5d68(0x1c0)],_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+_0x7c5d68(0x1ee)]=this[_0x7c5d68(0x1e8)],_0xf125b5[constants_1['FLOSUM_NAMESPACE']+_0x7c5d68(0x1cf)]=this[_0x7c5d68(0x1e8)],_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+'Last_Modified_Date__c']=_0x1816ec,_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+'Committed_On__c']=_0x1816ec,_0xf125b5[constants_1[_0x7c5d68(0x1bf)]+_0x7c5d68(0x1ce)]=_0xc3d865[_0x7c5d68(0x1ed)],_0xf125b5;}[a228_0x288e02(0x1da)](){const _0x21a085=a228_0x288e02;return this[_0x21a085(0x1f9)];}async[a228_0x288e02(0x1fc)](_0x586ca4,_0x11cc0d){const _0x41adbd=a228_0x288e02,_0x393679=[];for(const _0x3ba228 of _0x586ca4){const _0x316aee=(0x0,composite_utils_1[_0x41adbd(0x1d0)])(constants_1[_0x41adbd(0x1b8)],this[_0x41adbd(0x205)](_0x3ba228)),_0x52b36d=(0x0,composite_utils_1[_0x41adbd(0x1d0)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x41adbd(0x1f5)](_0x3ba228,'@{'+_0x316aee[_0x41adbd(0x1e4)]+_0x41adbd(0x20d))),_0xaefa1d=(0x0,composite_utils_1[_0x41adbd(0x1d0)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x41adbd(0x1d8)](_0x3ba228,'@{'+_0x52b36d['reference']+_0x41adbd(0x20d)));this[_0x41adbd(0x1f8)](_0x316aee[_0x41adbd(0x1ca)][_0x41adbd(0x1eb)],_0x316aee['reference']),_0x393679[_0x41adbd(0x1f3)](_0x316aee[_0x41adbd(0x1ca)],_0x52b36d[_0x41adbd(0x1ca)],_0xaefa1d['request']),_0x11cc0d&&_0x393679[_0x41adbd(0x1f3)](this[_0x41adbd(0x1d2)](_0x11cc0d,'@{'+_0x52b36d[_0x41adbd(0x1e4)]+_0x41adbd(0x20d)));}return _0x393679;}async[a228_0x288e02(0x1fd)](_0x5037c9,_0x4f4285=''){const _0x4bdb4b=a228_0x288e02,_0x502ac4=[];for(const {component:_0x270d05,meta:_0x1e5e5f}of _0x5037c9){if(!_0x1e5e5f['id']){const _0xdbbd4b=this[_0x4bdb4b(0x1f9)][_0x4bdb4b(0x1b9)](_0x321211=>_0x321211[_0x4bdb4b(0x1e3)]===_0x270d05[_0x4bdb4b(0x1de)]&&_0x321211[_0x4bdb4b(0x202)]===_0x270d05[_0x4bdb4b(0x1bb)]);if(!_0xdbbd4b)throw new salesforce_error_1[(_0x4bdb4b(0x210))](new Error(_0x4bdb4b(0x20f)+_0x270d05[_0x4bdb4b(0x1de)]+'\x20['+_0x270d05[_0x4bdb4b(0x1bb)]+_0x4bdb4b(0x1c9)));_0x1e5e5f['id']=_0xdbbd4b[_0x4bdb4b(0x1dd)];}const _0x407071=(0x0,composite_utils_1[_0x4bdb4b(0x1e2)])(constants_1['FLOSUM_COMPONENT'],_0x1e5e5f['id'],this[_0x4bdb4b(0x205)](_0x270d05,_0x1e5e5f)),_0x270a8c=(0x0,composite_utils_1[_0x4bdb4b(0x1d0)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x4bdb4b(0x1f5)](_0x270d05,_0x1e5e5f['id'],_0x1e5e5f[_0x4bdb4b(0x211)])),_0x366abd=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x4bdb4b(0x1f1)],await this[_0x4bdb4b(0x1d8)](_0x270d05,'@{'+_0x270a8c[_0x4bdb4b(0x1e4)]+_0x4bdb4b(0x20d)));this[_0x4bdb4b(0x1f8)](_0x407071[_0x4bdb4b(0x1ca)][_0x4bdb4b(0x1eb)],_0x407071[_0x4bdb4b(0x1e4)]),_0x502ac4[_0x4bdb4b(0x1f3)](_0x407071['request'],_0x270a8c[_0x4bdb4b(0x1ca)],_0x366abd['request']),_0x4f4285&&_0x502ac4[_0x4bdb4b(0x1f3)](this[_0x4bdb4b(0x1d2)](_0x4f4285,'@{'+_0x270a8c[_0x4bdb4b(0x1e4)]+_0x4bdb4b(0x20d)));}return _0x502ac4;}async['delete'](_0x3597bc,_0x79a757=![]){const _0x3581a8=a228_0x288e02,_0x1a3756={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x504c1e=[];for(const _0x3892f8 of _0x3597bc){if(_0x3892f8['id'])_0x504c1e[_0x3581a8(0x1f3)](_0x3892f8['id']);else{const _0x2da503=this['proceededComponentsMeta'][_0x3581a8(0x1b9)](_0x114e99=>_0x114e99[_0x3581a8(0x1e3)]===_0x3892f8[_0x3581a8(0x1de)]&&_0x114e99[_0x3581a8(0x202)]===_0x3892f8['type']);if(!_0x2da503||!_0x2da503['componentId'])continue;_0x504c1e[_0x3581a8(0x1f3)](_0x2da503['componentId']);}}if(_0x79a757){const _0x1165fa=await this[_0x3581a8(0x1f7)][_0x3581a8(0x1fa)](_0x504c1e);_0x1a3756['manifests']=_0x1165fa[_0x3581a8(0x1d9)](_0x2a21b2=>(0x0,composite_utils_1[_0x3581a8(0x1fb)])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x2a21b2)[_0x3581a8(0x1ca)]);}return _0x1a3756['componentsToUpdate']=_0x504c1e[_0x3581a8(0x1d9)](_0x58f76d=>(0x0,composite_utils_1[_0x3581a8(0x1e2)])(constants_1['FLOSUM_COMPONENT'],_0x58f76d,{[constants_1[_0x3581a8(0x1c8)]+_0x3581a8(0x1d5)]:!![]})['request']),_0x1a3756[_0x3581a8(0x1e7)]=_0x504c1e[_0x3581a8(0x1d9)](_0x4de419=>(0x0,composite_utils_1[_0x3581a8(0x1fb)])(constants_1[_0x3581a8(0x1b8)],_0x4de419)[_0x3581a8(0x1ca)]),_0x1a3756;}}function a228_0x43bc(_0x139610,_0x585029){const _0x4f70b0=a228_0x2597();return a228_0x43bc=function(_0x1814c9,_0x577e71){_0x1814c9=_0x1814c9-0x1b8;let _0x25977d=_0x4f70b0[_0x1814c9];return _0x25977d;},a228_0x43bc(_0x139610,_0x585029);}exports[a228_0x288e02(0x204)]=SalesforceComponentsManager;