const a228_0x5d139b=a228_0x3fe4;(function(_0x19f917,_0x2f5e82){const _0x218dd9=a228_0x3fe4,_0x100681=_0x19f917();while(!![]){try{const _0xd323ec=-parseInt(_0x218dd9(0x19a))/0x1*(-parseInt(_0x218dd9(0x19e))/0x2)+-parseInt(_0x218dd9(0x19c))/0x3+parseInt(_0x218dd9(0x179))/0x4+-parseInt(_0x218dd9(0x183))/0x5*(parseInt(_0x218dd9(0x1b6))/0x6)+parseInt(_0x218dd9(0x17a))/0x7+parseInt(_0x218dd9(0x18d))/0x8*(parseInt(_0x218dd9(0x165))/0x9)+-parseInt(_0x218dd9(0x173))/0xa*(-parseInt(_0x218dd9(0x16b))/0xb);if(_0xd323ec===_0x2f5e82)break;else _0x100681['push'](_0x100681['shift']());}catch(_0xd5d5bf){_0x100681['push'](_0x100681['shift']());}}}(a228_0x5c4c,0xdc887));const a228_0x3ee432=(function(){let _0x356eb2=!![];return function(_0xb9013c,_0x3012b3){const _0x3221f1=_0x356eb2?function(){const _0x2256fe=a228_0x3fe4;if(_0x3012b3){const _0x35ca4b=_0x3012b3[_0x2256fe(0x195)](_0xb9013c,arguments);return _0x3012b3=null,_0x35ca4b;}}:function(){};return _0x356eb2=![],_0x3221f1;};}()),a228_0x1b18d4=a228_0x3ee432(this,function(){const _0x4dd6e2=a228_0x3fe4;return a228_0x1b18d4[_0x4dd6e2(0x189)]()[_0x4dd6e2(0x1a0)](_0x4dd6e2(0x16f))[_0x4dd6e2(0x189)]()[_0x4dd6e2(0x160)](a228_0x1b18d4)['search'](_0x4dd6e2(0x16f));});a228_0x1b18d4();function a228_0x5c4c(){const _0x2bda2b=['map','CRC32__c','FLOSUM_ATTACHMENT','prepareComponentHistoryRecord','2095euCLdQ','__importDefault','Version__c','createDeleteRequest','prepareCommitManifest','crc','toString','componentId','username','componentsToDelete','611992LEsohM','application/zip','Last_Updated_By__c','get','createPatchRequest','SalesforceGitSyncService','Body','keys','apply','FLOSUM_COMMIT_MANIFEST','repositoryId','Could\x20not\x20proceed\x20component\x20','body','2bfPzjE','request','650757jLosUz','FLOSUM_GIT_NAMESPACE','283814ocFrlO','getProceededComponentsMeta','search','Component_Type__c','Component__c','branchId','typedi','ParentId','File_Name__c','Logger','version','Branch','logger','proceedComponentMeta','gitSync','componentName','Repository__c','Source__c','Committed_On__c','Deletion_By_Agent__c','reference','name','Changed_On__c','createZip','20778capogI','componentType','Zip','Repository','SalesforceComponentsManager','extractFieldsFromRecord','Commit__c','__esModule','componentsToUpdate','FLOSUM_COMPONENT','fetchCommitManifestsByComponentIds','find','delete','file','../errors/salesforce.error','constructor','../../../../core','./salesforce-git-sync.service','ContentType','prepareComponentAttachmentRecord','9VDGqdh','../utils/flosum-naming.utils','toISOString','update','push','type','23397LRfkKy','Component_Name__c','.id}','filePath','(((.+)+)+)+$','Component_History__c','proceededComponentsMeta','RecordTypeId','4530BQnVLs','FLOSUM_NAMESPACE','files','default','FLOSUM_COMPONENT_HISTORY','base64','752760OpOSxU','7414295vKZGTJ','Description','createPostRequest','SalesforceError',']\x20-\x20meta\x20not\x20found'];a228_0x5c4c=function(){return _0x2bda2b;};return a228_0x5c4c();}'use strict';var __importDefault=this&&this[a228_0x5d139b(0x184)]||function(_0x49b981){return _0x49b981&&_0x49b981['__esModule']?_0x49b981:{'default':_0x49b981};};Object['defineProperty'](exports,a228_0x5d139b(0x1bd),{'value':!![]}),exports[a228_0x5d139b(0x1ba)]=void 0x0;function a228_0x3fe4(_0x4378e2,_0x149d45){const _0x1e64fd=a228_0x5c4c();return a228_0x3fe4=function(_0x1b18d4,_0x3ee432){_0x1b18d4=_0x1b18d4-0x15a;let _0x5c4c1d=_0x1e64fd[_0x1b18d4];return _0x5c4c1d;},a228_0x3fe4(_0x4378e2,_0x149d45);}const constants_1=require('../../../../constants'),core_1=require(a228_0x5d139b(0x161)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a228_0x5d139b(0x1a4))),salesforce_error_1=require(a228_0x5d139b(0x15f)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a228_0x5d139b(0x166)),salesforce_git_sync_service_1=require(a228_0x5d139b(0x162));class SalesforceComponentsManager{constructor(_0xbbed9e,_0x50b2ec,_0x5c5580,_0x366256,_0x1c6801){const _0x413dc4=a228_0x5d139b;this[_0x413dc4(0x197)]=_0xbbed9e,this[_0x413dc4(0x1a3)]=_0x50b2ec,this['username']=_0x5c5580,this['recordTypes']=_0x366256,this[_0x413dc4(0x171)]=_0x1c6801,this[_0x413dc4(0x1aa)]=new core_1[(_0x413dc4(0x1a7))](SalesforceComponentsManager[_0x413dc4(0x1b3)]),this[_0x413dc4(0x1ac)]=typedi_1[_0x413dc4(0x176)][_0x413dc4(0x190)](salesforce_git_sync_service_1[_0x413dc4(0x192)]);}[a228_0x5d139b(0x1ab)](_0xf36c66,_0x2f21b3){const _0x812f64=a228_0x5d139b,_0x166ed3=(0x0,flosum_naming_utils_1[_0x812f64(0x1bb)])(_0xf36c66,[_0x812f64(0x1a1),_0x812f64(0x16c),_0x812f64(0x185)]);this['proceededComponentsMeta'][_0x812f64(0x169)]({'componentId':'','reference':_0x2f21b3,'version':_0x166ed3[_0x812f64(0x185)],'componentName':_0x166ed3['Component_Name__c'],'componentType':_0x166ed3['Component_Type__c']});}[a228_0x5d139b(0x187)](_0x5b09a8,_0x537a88){const _0x197d29=a228_0x5d139b,{request:_0x1536ce}=(0x0,composite_utils_1[_0x197d29(0x17c)])(constants_1[_0x197d29(0x196)],{[constants_1[_0x197d29(0x174)]+_0x197d29(0x1bc)]:_0x5b09a8,[constants_1[_0x197d29(0x174)]+_0x197d29(0x170)]:_0x537a88});return _0x1536ce;}async[a228_0x5d139b(0x164)](_0x225ca6,_0xdadddb){const _0x375cd8=a228_0x5d139b,_0x114a7e={},_0x67c1b7=zip_1[_0x375cd8(0x1b8)][_0x375cd8(0x1b5)]();for(const _0x4ffd0e of Object[_0x375cd8(0x194)](_0x225ca6[_0x375cd8(0x175)])){_0x67c1b7[_0x375cd8(0x15e)](_0x4ffd0e,_0x225ca6[_0x375cd8(0x175)][_0x4ffd0e],{'createFolders':!![]});}return _0x114a7e[_0x375cd8(0x163)]=_0x375cd8(0x18e),_0x114a7e['Name']=_0x225ca6['type'],_0x114a7e[_0x375cd8(0x17b)]=_0x225ca6[_0x375cd8(0x16a)],_0x114a7e[_0x375cd8(0x1a5)]=_0xdadddb,_0x114a7e[_0x375cd8(0x193)]=await _0x67c1b7['generateAsync']({'type':_0x375cd8(0x178),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x114a7e;}[a228_0x5d139b(0x182)](_0x1da6c7,_0x454eb0,_0x341a0d){const _0x43d79b=a228_0x5d139b,_0x4a075b=new Date()[_0x43d79b(0x167)](),_0x1fc801={};return _0x1fc801[constants_1[_0x43d79b(0x174)]+_0x43d79b(0x1a2)]=_0x454eb0,_0x1fc801[constants_1[_0x43d79b(0x174)]+_0x43d79b(0x180)]=_0x1da6c7[_0x43d79b(0x188)],_0x1fc801[constants_1[_0x43d79b(0x174)]+_0x43d79b(0x1b4)]=_0x4a075b,_0x1fc801[constants_1[_0x43d79b(0x174)]+'Changed_By__c']=this[_0x43d79b(0x18b)],_0x1fc801[constants_1[_0x43d79b(0x174)]+_0x43d79b(0x185)]=_0x341a0d?_0x341a0d+0x1:0x1,_0x1fc801[constants_1[_0x43d79b(0x19d)]+'Is_From_Agent__c']=!![],_0x1fc801;}['prepareComponentRecord'](_0x5d32cc,_0x22e286){const _0x3492c1=a228_0x5d139b;var _0x13a8c8,_0xe9d759;const _0xfb1c6a=new Date()[_0x3492c1(0x167)](),_0x70d083={};return!_0x22e286?(this['branchId']?(_0x70d083[constants_1[_0x3492c1(0x174)]+'Branch__c']=this[_0x3492c1(0x1a3)],_0x70d083[constants_1[_0x3492c1(0x174)]+_0x3492c1(0x1af)]='Branch',_0x70d083[_0x3492c1(0x172)]=(_0x13a8c8=this['recordTypes'][_0x3492c1(0x15c)](_0x5cdd1e=>_0x5cdd1e[_0x3492c1(0x1b3)]===_0x3492c1(0x1a9)))===null||_0x13a8c8===void 0x0?void 0x0:_0x13a8c8['id']):(_0x70d083[constants_1[_0x3492c1(0x174)]+_0x3492c1(0x1ae)]=this[_0x3492c1(0x197)],_0x70d083[constants_1[_0x3492c1(0x174)]+_0x3492c1(0x1af)]='Repository',_0x70d083[_0x3492c1(0x172)]=(_0xe9d759=this['recordTypes'][_0x3492c1(0x15c)](_0xbfb93f=>_0xbfb93f[_0x3492c1(0x1b3)]===_0x3492c1(0x1b9)))===null||_0xe9d759===void 0x0?void 0x0:_0xe9d759['id']),_0x70d083[constants_1[_0x3492c1(0x174)]+_0x3492c1(0x185)]=0x1):_0x70d083[constants_1[_0x3492c1(0x174)]+_0x3492c1(0x185)]=_0x22e286[_0x3492c1(0x1a8)]+0x1,_0x70d083[constants_1[_0x3492c1(0x174)]+_0x3492c1(0x1a1)]=_0x5d32cc[_0x3492c1(0x16a)],_0x70d083[constants_1[_0x3492c1(0x174)]+_0x3492c1(0x16c)]=_0x5d32cc['name'],_0x70d083[constants_1[_0x3492c1(0x174)]+_0x3492c1(0x1a6)]=_0x5d32cc[_0x3492c1(0x16e)],_0x70d083[constants_1[_0x3492c1(0x174)]+_0x3492c1(0x18f)]=this['username'],_0x70d083[constants_1[_0x3492c1(0x174)]+'Last_Modified_By__c']=this[_0x3492c1(0x18b)],_0x70d083[constants_1[_0x3492c1(0x174)]+'Last_Modified_Date__c']=_0xfb1c6a,_0x70d083[constants_1[_0x3492c1(0x174)]+_0x3492c1(0x1b0)]=_0xfb1c6a,_0x70d083[constants_1[_0x3492c1(0x174)]+_0x3492c1(0x180)]=_0x5d32cc[_0x3492c1(0x188)],_0x70d083;}[a228_0x5d139b(0x19f)](){const _0x2e3c57=a228_0x5d139b;return this[_0x2e3c57(0x171)];}async['insert'](_0x44fc86,_0xf80240){const _0x10759b=a228_0x5d139b,_0x4b213b=[];for(const _0x2de587 of _0x44fc86){const _0x3cfda6=(0x0,composite_utils_1[_0x10759b(0x17c)])(constants_1[_0x10759b(0x15a)],this['prepareComponentRecord'](_0x2de587)),_0x50ac22=(0x0,composite_utils_1[_0x10759b(0x17c)])(constants_1[_0x10759b(0x177)],this[_0x10759b(0x182)](_0x2de587,'@{'+_0x3cfda6[_0x10759b(0x1b2)]+_0x10759b(0x16d))),_0x5c1695=(0x0,composite_utils_1[_0x10759b(0x17c)])(constants_1[_0x10759b(0x181)],await this['prepareComponentAttachmentRecord'](_0x2de587,'@{'+_0x50ac22[_0x10759b(0x1b2)]+'.id}'));this['proceedComponentMeta'](_0x3cfda6[_0x10759b(0x19b)][_0x10759b(0x199)],_0x3cfda6[_0x10759b(0x1b2)]),_0x4b213b[_0x10759b(0x169)](_0x3cfda6['request'],_0x50ac22[_0x10759b(0x19b)],_0x5c1695['request']),_0xf80240&&_0x4b213b['push'](this[_0x10759b(0x187)](_0xf80240,'@{'+_0x50ac22['reference']+_0x10759b(0x16d)));}return _0x4b213b;}async[a228_0x5d139b(0x168)](_0x200e5b,_0x4948c0=''){const _0x5ef1b7=a228_0x5d139b,_0xdada91=[];for(const {component:_0x37a1b4,meta:_0x16d28f}of _0x200e5b){if(!_0x16d28f['id']){const _0x262cfd=this[_0x5ef1b7(0x171)][_0x5ef1b7(0x15c)](_0x7ec844=>_0x7ec844['componentName']===_0x37a1b4[_0x5ef1b7(0x1b3)]&&_0x7ec844[_0x5ef1b7(0x1b7)]===_0x37a1b4[_0x5ef1b7(0x16a)]);if(!_0x262cfd)throw new salesforce_error_1[(_0x5ef1b7(0x17d))](new Error(_0x5ef1b7(0x198)+_0x37a1b4['name']+'\x20['+_0x37a1b4['type']+_0x5ef1b7(0x17e)));_0x16d28f['id']=_0x262cfd[_0x5ef1b7(0x18a)];}const _0x234e0c=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x5ef1b7(0x15a)],_0x16d28f['id'],this['prepareComponentRecord'](_0x37a1b4,_0x16d28f)),_0x4cc7f7=(0x0,composite_utils_1[_0x5ef1b7(0x17c)])(constants_1[_0x5ef1b7(0x177)],this['prepareComponentHistoryRecord'](_0x37a1b4,_0x16d28f['id'],_0x16d28f['version'])),_0x2e1d66=(0x0,composite_utils_1[_0x5ef1b7(0x17c)])(constants_1[_0x5ef1b7(0x181)],await this[_0x5ef1b7(0x164)](_0x37a1b4,'@{'+_0x4cc7f7['reference']+_0x5ef1b7(0x16d)));this[_0x5ef1b7(0x1ab)](_0x234e0c[_0x5ef1b7(0x19b)]['body'],_0x234e0c[_0x5ef1b7(0x1b2)]),_0xdada91['push'](_0x234e0c[_0x5ef1b7(0x19b)],_0x4cc7f7[_0x5ef1b7(0x19b)],_0x2e1d66[_0x5ef1b7(0x19b)]),_0x4948c0&&_0xdada91['push'](this[_0x5ef1b7(0x187)](_0x4948c0,'@{'+_0x4cc7f7[_0x5ef1b7(0x1b2)]+_0x5ef1b7(0x16d)));}return _0xdada91;}async[a228_0x5d139b(0x15d)](_0x5e138e,_0x20147e=![]){const _0x581a09=a228_0x5d139b,_0x4f82eb={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x38c3be=[];for(const _0x1b7bba of _0x5e138e){if(_0x1b7bba['id'])_0x38c3be[_0x581a09(0x169)](_0x1b7bba['id']);else{const _0x14b50d=this['proceededComponentsMeta'][_0x581a09(0x15c)](_0x1711b9=>_0x1711b9[_0x581a09(0x1ad)]===_0x1b7bba[_0x581a09(0x1b3)]&&_0x1711b9[_0x581a09(0x1b7)]===_0x1b7bba['type']);if(!_0x14b50d||!_0x14b50d[_0x581a09(0x18a)])continue;_0x38c3be[_0x581a09(0x169)](_0x14b50d[_0x581a09(0x18a)]);}}if(_0x20147e){const _0xa89bfd=await this['gitSync'][_0x581a09(0x15b)](_0x38c3be);_0x4f82eb['manifests']=_0xa89bfd[_0x581a09(0x17f)](_0x417de5=>(0x0,composite_utils_1[_0x581a09(0x186)])(constants_1[_0x581a09(0x196)],_0x417de5)[_0x581a09(0x19b)]);}return _0x4f82eb[_0x581a09(0x1be)]=_0x38c3be[_0x581a09(0x17f)](_0x41c8a2=>(0x0,composite_utils_1[_0x581a09(0x191)])(constants_1[_0x581a09(0x15a)],_0x41c8a2,{[constants_1[_0x581a09(0x19d)]+_0x581a09(0x1b1)]:!![]})[_0x581a09(0x19b)]),_0x4f82eb[_0x581a09(0x18c)]=_0x38c3be[_0x581a09(0x17f)](_0x30da19=>(0x0,composite_utils_1[_0x581a09(0x186)])(constants_1[_0x581a09(0x15a)],_0x30da19)[_0x581a09(0x19b)]),_0x4f82eb;}}exports[a228_0x5d139b(0x1ba)]=SalesforceComponentsManager;