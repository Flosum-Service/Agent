const a234_0x8d95ce=a234_0x2f0c;(function(_0xe5a6cd,_0x389e65){const _0x8db2c3=a234_0x2f0c,_0x5b3f52=_0xe5a6cd();while(!![]){try{const _0x4fa6b7=-parseInt(_0x8db2c3(0x1e3))/0x1+parseInt(_0x8db2c3(0x1d3))/0x2+-parseInt(_0x8db2c3(0x195))/0x3+parseInt(_0x8db2c3(0x1f6))/0x4*(-parseInt(_0x8db2c3(0x1d8))/0x5)+-parseInt(_0x8db2c3(0x19e))/0x6*(parseInt(_0x8db2c3(0x19b))/0x7)+-parseInt(_0x8db2c3(0x1cd))/0x8*(parseInt(_0x8db2c3(0x1d7))/0x9)+parseInt(_0x8db2c3(0x194))/0xa;if(_0x4fa6b7===_0x389e65)break;else _0x5b3f52['push'](_0x5b3f52['shift']());}catch(_0x39e4d0){_0x5b3f52['push'](_0x5b3f52['shift']());}}}(a234_0x23ad,0xdfc96));const a234_0x25f041=(function(){let _0x236e54=!![];return function(_0xd0fde1,_0xbe76a6){const _0x18e91b=_0x236e54?function(){const _0x2d0d2a=a234_0x2f0c;if(_0xbe76a6){const _0x1596a7=_0xbe76a6[_0x2d0d2a(0x1ba)](_0xd0fde1,arguments);return _0xbe76a6=null,_0x1596a7;}}:function(){};return _0x236e54=![],_0x18e91b;};}()),a234_0x2f04d9=a234_0x25f041(this,function(){const _0x5127ee=a234_0x2f0c;return a234_0x2f04d9[_0x5127ee(0x1c1)]()['search']('(((.+)+)+)+$')['toString']()[_0x5127ee(0x1ac)](a234_0x2f04d9)[_0x5127ee(0x1c2)](_0x5127ee(0x199));});function a234_0x23ad(){const _0x299d97=['858552SHCptp','componentsToUpdate','Vlocity_Component_Name__c','repositoryId','(((.+)+)+)+$','defineProperty','1113315NpDnpO','Version__c','FLOSUM_COMMIT_MANIFEST','36wBcOiv','Component__c','version','delete','Name','__esModule','getProceededComponentsMeta','keys','toISOString','SalesforceGitSyncService','ContentType','file','insert','update','constructor','../../parsers/utils/zip','FLOSUM_ATTACHMENT','prepareComponentHistoryRecord','branchId','Repository__c','prepareComponentRecord','createPatchRequest','Component_Type__c',']\x20-\x20meta\x20not\x20found','Repository','crc','componentType','recordTypes','apply','SalesforceError','componentName','fetchCommitManifestsByComponentIds','ParentId','RecordTypeId','files','toString','search','Source__c','componentId','Deletion_By_Agent__c','username','request','Commit__c','get','gitSync','createZip','prepareCommitManifest','722312vmUWuX','Body','./salesforce-git-sync.service','typedi','prepareComponentAttachmentRecord','createDeleteRequest','2460196TUNLKd','default','FLOSUM_NAMESPACE','../utils/composite.utils','18fXbpmG','321865cPFwAy','application/zip','__importDefault','FLOSUM_COMPONENT','Zip','push','CRC32__c','Could\x20not\x20proceed\x20component\x20','proceedComponentMeta','../../../../core','vlocityComponentName','1302749CKMyYa','Description','FLOSUM_COMPONENT_HISTORY','../utils/flosum-naming.utils','find','generateAsync','Changed_On__c','Last_Modified_Date__c','FLOSUM_GIT_NAMESPACE','SalesforceComponentsManager','Vlocity_Component__c','isVlocityComponent','map','createPostRequest','File_Name__c','body','type','manifests','Branch','108vfydER','Last_Updated_By__c','Branch__c','name','reference','.id}','filePath','proceededComponentsMeta','Last_Modified_By__c','Committed_On__c','Component_Name__c','logger','41483840BQeeQV'];a234_0x23ad=function(){return _0x299d97;};return a234_0x23ad();}a234_0x2f04d9();'use strict';var __importDefault=this&&this[a234_0x8d95ce(0x1da)]||function(_0x498244){return _0x498244&&_0x498244['__esModule']?_0x498244:{'default':_0x498244};};Object[a234_0x8d95ce(0x19a)](exports,a234_0x8d95ce(0x1a3),{'value':!![]}),exports[a234_0x8d95ce(0x1ec)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a234_0x8d95ce(0x1e1)),zip_1=require(a234_0x8d95ce(0x1ad)),typedi_1=__importDefault(require(a234_0x8d95ce(0x1d0))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a234_0x8d95ce(0x1d6)),flosum_naming_utils_1=require(a234_0x8d95ce(0x1e6)),salesforce_git_sync_service_1=require(a234_0x8d95ce(0x1cf));class SalesforceComponentsManager{constructor(_0x416de0,_0x8982ea,_0x50432e,_0x28c904,_0x1d82f3){const _0x161468=a234_0x8d95ce;this[_0x161468(0x198)]=_0x416de0,this[_0x161468(0x1b0)]=_0x8982ea,this[_0x161468(0x1c6)]=_0x50432e,this[_0x161468(0x1b9)]=_0x28c904,this[_0x161468(0x1fd)]=_0x1d82f3,this[_0x161468(0x193)]=new core_1['Logger'](SalesforceComponentsManager[_0x161468(0x1f9)]),this[_0x161468(0x1ca)]=typedi_1[_0x161468(0x1d4)][_0x161468(0x1c9)](salesforce_git_sync_service_1[_0x161468(0x1a7)]);}[a234_0x8d95ce(0x1e0)](_0x503cf4,_0x1c6c61){const _0x24cbb=a234_0x8d95ce,_0xd0dd28=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x503cf4,['Component_Type__c',_0x24cbb(0x192),'Version__c']);this[_0x24cbb(0x1fd)][_0x24cbb(0x1dd)]({'componentId':'','reference':_0x1c6c61,'version':_0xd0dd28['Version__c'],'componentName':_0xd0dd28[_0x24cbb(0x192)],'componentType':_0xd0dd28[_0x24cbb(0x1b4)]});}[a234_0x8d95ce(0x1cc)](_0x20aa53,_0x357150){const _0x560af9=a234_0x8d95ce,{request:_0x14901e}=(0x0,composite_utils_1[_0x560af9(0x1f0)])(constants_1[_0x560af9(0x19d)],{[constants_1[_0x560af9(0x1d5)]+_0x560af9(0x1c8)]:_0x20aa53,[constants_1['FLOSUM_NAMESPACE']+'Component_History__c']:_0x357150});return _0x14901e;}async[a234_0x8d95ce(0x1d1)](_0x3f1082,_0x3b1108){const _0x479b9d=a234_0x8d95ce,_0x323ed9={},_0x5524ea=zip_1[_0x479b9d(0x1dc)][_0x479b9d(0x1cb)]();for(const _0x721cea of Object[_0x479b9d(0x1a5)](_0x3f1082[_0x479b9d(0x1c0)])){_0x5524ea[_0x479b9d(0x1a9)](_0x721cea,_0x3f1082[_0x479b9d(0x1c0)][_0x721cea],{'createFolders':!![]});}return _0x323ed9[_0x479b9d(0x1a8)]=_0x479b9d(0x1d9),_0x323ed9[_0x479b9d(0x1a2)]=_0x3f1082[_0x479b9d(0x1f3)],_0x323ed9[_0x479b9d(0x1e4)]=_0x3f1082[_0x479b9d(0x1f3)],_0x323ed9[_0x479b9d(0x1be)]=_0x3b1108,_0x323ed9[_0x479b9d(0x1ce)]=await _0x5524ea[_0x479b9d(0x1e8)]({'type':'base64','compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x323ed9;}[a234_0x8d95ce(0x1af)](_0xf97f59,_0x3c6fb2,_0x5646c4){const _0x289748=a234_0x8d95ce,_0x29aba4=new Date()['toISOString'](),_0x1a2409={};return _0x1a2409[constants_1[_0x289748(0x1d5)]+_0x289748(0x19f)]=_0x3c6fb2,_0x1a2409[constants_1[_0x289748(0x1d5)]+_0x289748(0x1de)]=_0xf97f59[_0x289748(0x1b7)],_0x1a2409[constants_1[_0x289748(0x1d5)]+_0x289748(0x1e9)]=_0x29aba4,_0x1a2409[constants_1[_0x289748(0x1d5)]+'Changed_By__c']=this[_0x289748(0x1c6)],_0x1a2409[constants_1['FLOSUM_NAMESPACE']+_0x289748(0x19c)]=_0x5646c4?_0x5646c4+0x1:0x1,_0x1a2409[constants_1[_0x289748(0x1eb)]+'Is_From_Agent__c']=!![],_0x1a2409;}[a234_0x8d95ce(0x1b2)](_0x1b1c1c,_0x1d3601){const _0x503952=a234_0x8d95ce;var _0x4650ee,_0x2e44fa;const _0x44c9a1=new Date()[_0x503952(0x1a6)](),_0x333153={};return!_0x1d3601?(this[_0x503952(0x1b0)]?(_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x1f8)]=this[_0x503952(0x1b0)],_0x333153[constants_1['FLOSUM_NAMESPACE']+_0x503952(0x1c3)]='Branch',_0x333153[_0x503952(0x1bf)]=(_0x4650ee=this[_0x503952(0x1b9)][_0x503952(0x1e7)](_0x2d034e=>_0x2d034e[_0x503952(0x1f9)]===_0x503952(0x1f5)))===null||_0x4650ee===void 0x0?void 0x0:_0x4650ee['id']):(_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x1b1)]=this[_0x503952(0x198)],_0x333153[constants_1['FLOSUM_NAMESPACE']+_0x503952(0x1c3)]=_0x503952(0x1b6),_0x333153[_0x503952(0x1bf)]=(_0x2e44fa=this[_0x503952(0x1b9)]['find'](_0x4e6df7=>_0x4e6df7[_0x503952(0x1f9)]===_0x503952(0x1b6)))===null||_0x2e44fa===void 0x0?void 0x0:_0x2e44fa['id']),_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x19c)]=0x1):_0x333153[constants_1['FLOSUM_NAMESPACE']+_0x503952(0x19c)]=_0x1d3601[_0x503952(0x1a0)]+0x1,_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x1b4)]=_0x1b1c1c['type'],_0x333153[constants_1['FLOSUM_NAMESPACE']+_0x503952(0x192)]=_0x1b1c1c['name'],_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x1f1)]=_0x1b1c1c[_0x503952(0x1fc)],_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x1f7)]=this[_0x503952(0x1c6)],_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x1fe)]=this[_0x503952(0x1c6)],_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x1ea)]=_0x44c9a1,_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x1ff)]=_0x44c9a1,_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x1de)]=_0x1b1c1c[_0x503952(0x1b7)],_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x197)]=_0x1b1c1c[_0x503952(0x1e2)],_0x333153[constants_1[_0x503952(0x1d5)]+_0x503952(0x1ed)]=_0x1b1c1c[_0x503952(0x1ee)],_0x333153;}[a234_0x8d95ce(0x1a4)](){return this['proceededComponentsMeta'];}async[a234_0x8d95ce(0x1aa)](_0xc242e,_0x4695f9){const _0x2ed02f=a234_0x8d95ce,_0x434b8a=[];for(const _0xca4f8f of _0xc242e){const _0x5357d6=(0x0,composite_utils_1[_0x2ed02f(0x1f0)])(constants_1[_0x2ed02f(0x1db)],this['prepareComponentRecord'](_0xca4f8f)),_0x1cdd2f=(0x0,composite_utils_1[_0x2ed02f(0x1f0)])(constants_1[_0x2ed02f(0x1e5)],this['prepareComponentHistoryRecord'](_0xca4f8f,'@{'+_0x5357d6['reference']+_0x2ed02f(0x1fb))),_0x5a9abb=(0x0,composite_utils_1[_0x2ed02f(0x1f0)])(constants_1[_0x2ed02f(0x1ae)],await this['prepareComponentAttachmentRecord'](_0xca4f8f,'@{'+_0x1cdd2f[_0x2ed02f(0x1fa)]+_0x2ed02f(0x1fb)));this[_0x2ed02f(0x1e0)](_0x5357d6['request'][_0x2ed02f(0x1f2)],_0x5357d6[_0x2ed02f(0x1fa)]),_0x434b8a[_0x2ed02f(0x1dd)](_0x5357d6[_0x2ed02f(0x1c7)],_0x1cdd2f[_0x2ed02f(0x1c7)],_0x5a9abb[_0x2ed02f(0x1c7)]),_0x4695f9&&_0x434b8a[_0x2ed02f(0x1dd)](this[_0x2ed02f(0x1cc)](_0x4695f9,'@{'+_0x1cdd2f[_0x2ed02f(0x1fa)]+_0x2ed02f(0x1fb)));}return _0x434b8a;}async[a234_0x8d95ce(0x1ab)](_0x18bea2,_0x849d92=''){const _0xb6947=a234_0x8d95ce,_0x3d7c8e=[];for(const {component:_0x7e56df,meta:_0x3ad86e}of _0x18bea2){if(!_0x3ad86e['id']){const _0x23125b=this[_0xb6947(0x1fd)][_0xb6947(0x1e7)](_0x24be0a=>_0x24be0a[_0xb6947(0x1bc)]===_0x7e56df[_0xb6947(0x1f9)]&&_0x24be0a['componentType']===_0x7e56df[_0xb6947(0x1f3)]);if(!_0x23125b)throw new salesforce_error_1[(_0xb6947(0x1bb))](new Error(_0xb6947(0x1df)+_0x7e56df[_0xb6947(0x1f9)]+'\x20['+_0x7e56df[_0xb6947(0x1f3)]+_0xb6947(0x1b5)));_0x3ad86e['id']=_0x23125b[_0xb6947(0x1c4)];}const _0x41959b=(0x0,composite_utils_1[_0xb6947(0x1b3)])(constants_1['FLOSUM_COMPONENT'],_0x3ad86e['id'],this[_0xb6947(0x1b2)](_0x7e56df,_0x3ad86e)),_0xb8b181=(0x0,composite_utils_1[_0xb6947(0x1f0)])(constants_1[_0xb6947(0x1e5)],this['prepareComponentHistoryRecord'](_0x7e56df,_0x3ad86e['id'],_0x3ad86e['version'])),_0x2cb8b3=(0x0,composite_utils_1[_0xb6947(0x1f0)])(constants_1[_0xb6947(0x1ae)],await this[_0xb6947(0x1d1)](_0x7e56df,'@{'+_0xb8b181[_0xb6947(0x1fa)]+_0xb6947(0x1fb)));this[_0xb6947(0x1e0)](_0x41959b[_0xb6947(0x1c7)][_0xb6947(0x1f2)],_0x41959b[_0xb6947(0x1fa)]),_0x3d7c8e[_0xb6947(0x1dd)](_0x41959b[_0xb6947(0x1c7)],_0xb8b181['request'],_0x2cb8b3[_0xb6947(0x1c7)]),_0x849d92&&_0x3d7c8e[_0xb6947(0x1dd)](this[_0xb6947(0x1cc)](_0x849d92,'@{'+_0xb8b181[_0xb6947(0x1fa)]+_0xb6947(0x1fb)));}return _0x3d7c8e;}async[a234_0x8d95ce(0x1a1)](_0x1d00f3,_0x524632=![]){const _0x12b6b6=a234_0x8d95ce,_0x14b51e={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0xf6b0e3=[];for(const _0x274507 of _0x1d00f3){if(_0x274507['id'])_0xf6b0e3['push'](_0x274507['id']);else{const _0x42ee9a=this[_0x12b6b6(0x1fd)]['find'](_0x47d35d=>_0x47d35d['componentName']===_0x274507['name']&&_0x47d35d[_0x12b6b6(0x1b8)]===_0x274507[_0x12b6b6(0x1f3)]);if(!_0x42ee9a||!_0x42ee9a['componentId'])continue;_0xf6b0e3[_0x12b6b6(0x1dd)](_0x42ee9a[_0x12b6b6(0x1c4)]);}}if(_0x524632){const _0x2e311e=await this['gitSync'][_0x12b6b6(0x1bd)](_0xf6b0e3);_0x14b51e[_0x12b6b6(0x1f4)]=_0x2e311e[_0x12b6b6(0x1ef)](_0x1b3304=>(0x0,composite_utils_1[_0x12b6b6(0x1d2)])(constants_1[_0x12b6b6(0x19d)],_0x1b3304)['request']);}return _0x14b51e[_0x12b6b6(0x196)]=_0xf6b0e3[_0x12b6b6(0x1ef)](_0x420a1f=>(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x12b6b6(0x1db)],_0x420a1f,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x12b6b6(0x1c5)]:!![]})['request']),_0x14b51e['componentsToDelete']=_0xf6b0e3['map'](_0x3313d3=>(0x0,composite_utils_1[_0x12b6b6(0x1d2)])(constants_1['FLOSUM_COMPONENT'],_0x3313d3)[_0x12b6b6(0x1c7)]),_0x14b51e;}}function a234_0x2f0c(_0x2c65dc,_0x5f5073){const _0x11a159=a234_0x23ad();return a234_0x2f0c=function(_0x2f04d9,_0x25f041){_0x2f04d9=_0x2f04d9-0x192;let _0x23addf=_0x11a159[_0x2f04d9];return _0x23addf;},a234_0x2f0c(_0x2c65dc,_0x5f5073);}exports['SalesforceComponentsManager']=SalesforceComponentsManager;