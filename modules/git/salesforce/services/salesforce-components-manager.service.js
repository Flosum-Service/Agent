const a234_0x281650=a234_0x173a;function a234_0x5a48(){const _0x20f2fc=['files','defineProperty','Component__c','../../../../core','Deletion_By_Agent__c','FLOSUM_NAMESPACE','componentType','(((.+)+)+)+$','ContentType','crc','FLOSUM_COMMIT_MANIFEST','Source__c','componentsToUpdate','./salesforce-git-sync.service','prepareComponentAttachmentRecord','.id}','4MwWAjH','Repository__c','Branch','delete','push','manifests','__importDefault','username','__esModule','createPatchRequest','base64','componentId','prepareCommitManifest','find','FLOSUM_COMPONENT','default','4522777AkjMGC','type','File_Name__c','map','Last_Updated_By__c','../../parsers/utils/zip','createDeleteRequest','Component_History__c','1742163YFyuiy','73513xHECAT','4QqSvOm','proceededComponentsMeta','Commit__c','gitSync','293250czVjGQ','proceedComponentMeta','Logger','Repository','SalesforceComponentsManager','6582499WYEhIU','generateAsync','986035UDBhVU','FLOSUM_GIT_NAMESPACE','logger','Component_Type__c','filePath','extractFieldsFromRecord','typedi','toString','../../../../constants','branchId','Body','3441128iNXsMi','componentName','insert','Vlocity_Component__c','toISOString','Zip','reference','Last_Modified_By__c','prepareComponentHistoryRecord','search','Changed_On__c','request','Last_Modified_Date__c','Version__c','createZip','apply','Component_Name__c','../errors/salesforce.error','recordTypes','FLOSUM_COMPONENT_HISTORY',']\x20-\x20meta\x20not\x20found','body','componentsToDelete','createPostRequest','Committed_On__c','CRC32__c','name','9uOzaBN','get','Branch__c','Description','DEFLATE','getProceededComponentsMeta','RecordTypeId','12sdpPEV','version','prepareComponentRecord','update','file','SalesforceError','../utils/flosum-naming.utils'];a234_0x5a48=function(){return _0x20f2fc;};return a234_0x5a48();}(function(_0x26fdd6,_0x18293d){const _0x1023d8=a234_0x173a,_0x536d9d=_0x26fdd6();while(!![]){try{const _0x334484=-parseInt(_0x1023d8(0x1f5))/0x1*(parseInt(_0x1023d8(0x245))/0x2)+parseInt(_0x1023d8(0x1f4))/0x3*(parseInt(_0x1023d8(0x1f6))/0x4)+parseInt(_0x1023d8(0x201))/0x5*(parseInt(_0x1023d8(0x22e))/0x6)+parseInt(_0x1023d8(0x1ec))/0x7+-parseInt(_0x1023d8(0x20c))/0x8+-parseInt(_0x1023d8(0x227))/0x9*(parseInt(_0x1023d8(0x1fa))/0xa)+-parseInt(_0x1023d8(0x1ff))/0xb;if(_0x334484===_0x18293d)break;else _0x536d9d['push'](_0x536d9d['shift']());}catch(_0x1e8897){_0x536d9d['push'](_0x536d9d['shift']());}}}(a234_0x5a48,0x65a59));const a234_0x2212de=(function(){let _0x4d0440=!![];return function(_0x39f7f4,_0x4985cf){const _0x521f07=_0x4d0440?function(){const _0x37da11=a234_0x173a;if(_0x4985cf){const _0x3c2f56=_0x4985cf[_0x37da11(0x21b)](_0x39f7f4,arguments);return _0x4985cf=null,_0x3c2f56;}}:function(){};return _0x4d0440=![],_0x521f07;};}()),a234_0x253616=a234_0x2212de(this,function(){const _0x596f5b=a234_0x173a;return a234_0x253616[_0x596f5b(0x208)]()['search'](_0x596f5b(0x23c))['toString']()['constructor'](a234_0x253616)[_0x596f5b(0x215)](_0x596f5b(0x23c));});a234_0x253616();'use strict';function a234_0x173a(_0x13cc8b,_0x549787){const _0x249ac9=a234_0x5a48();return a234_0x173a=function(_0x253616,_0x2212de){_0x253616=_0x253616-0x1e0;let _0x5a485e=_0x249ac9[_0x253616];return _0x5a485e;},a234_0x173a(_0x13cc8b,_0x549787);}var __importDefault=this&&this[a234_0x281650(0x1e2)]||function(_0xfec0b4){const _0x414474=a234_0x281650;return _0xfec0b4&&_0xfec0b4[_0x414474(0x1e4)]?_0xfec0b4:{'default':_0xfec0b4};};Object[a234_0x281650(0x236)](exports,a234_0x281650(0x1e4),{'value':!![]}),exports[a234_0x281650(0x1fe)]=void 0x0;const constants_1=require(a234_0x281650(0x209)),core_1=require(a234_0x281650(0x238)),zip_1=require(a234_0x281650(0x1f1)),typedi_1=__importDefault(require(a234_0x281650(0x207))),salesforce_error_1=require(a234_0x281650(0x21d)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a234_0x281650(0x234)),salesforce_git_sync_service_1=require(a234_0x281650(0x242));class SalesforceComponentsManager{constructor(_0x48954b,_0x276760,_0x2d4e9e,_0x19b46d,_0x1e82a8){const _0x3a3c1f=a234_0x281650;this['repositoryId']=_0x48954b,this[_0x3a3c1f(0x20a)]=_0x276760,this['username']=_0x2d4e9e,this[_0x3a3c1f(0x21e)]=_0x19b46d,this[_0x3a3c1f(0x1f7)]=_0x1e82a8,this[_0x3a3c1f(0x203)]=new core_1[(_0x3a3c1f(0x1fc))](SalesforceComponentsManager[_0x3a3c1f(0x226)]),this[_0x3a3c1f(0x1f9)]=typedi_1[_0x3a3c1f(0x1eb)][_0x3a3c1f(0x228)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a234_0x281650(0x1fb)](_0x2e5249,_0xda3321){const _0x36872a=a234_0x281650,_0x532a38=(0x0,flosum_naming_utils_1[_0x36872a(0x206)])(_0x2e5249,[_0x36872a(0x204),_0x36872a(0x21c),'Version__c']);this[_0x36872a(0x1f7)][_0x36872a(0x1e0)]({'componentId':'','reference':_0xda3321,'version':_0x532a38[_0x36872a(0x219)],'componentName':_0x532a38[_0x36872a(0x21c)],'componentType':_0x532a38[_0x36872a(0x204)]});}[a234_0x281650(0x1e8)](_0x4aa32f,_0xb24131){const _0x1ff630=a234_0x281650,{request:_0x28efc1}=(0x0,composite_utils_1[_0x1ff630(0x223)])(constants_1[_0x1ff630(0x23f)],{[constants_1['FLOSUM_NAMESPACE']+_0x1ff630(0x1f8)]:_0x4aa32f,[constants_1[_0x1ff630(0x23a)]+_0x1ff630(0x1f3)]:_0xb24131});return _0x28efc1;}async[a234_0x281650(0x243)](_0xb82f96,_0x538194){const _0x48a48a=a234_0x281650,_0x2a3643={},_0x57d8d8=zip_1[_0x48a48a(0x211)][_0x48a48a(0x21a)]();for(const _0x2a0eb4 of Object['keys'](_0xb82f96[_0x48a48a(0x235)])){_0x57d8d8[_0x48a48a(0x232)](_0x2a0eb4,_0xb82f96[_0x48a48a(0x235)][_0x2a0eb4],{'createFolders':!![]});}return _0x2a3643[_0x48a48a(0x23d)]='application/zip',_0x2a3643['Name']=_0xb82f96['type'],_0x2a3643[_0x48a48a(0x22a)]=_0xb82f96['type'],_0x2a3643['ParentId']=_0x538194,_0x2a3643[_0x48a48a(0x20b)]=await _0x57d8d8[_0x48a48a(0x200)]({'type':_0x48a48a(0x1e6),'compression':_0x48a48a(0x22b),'compressionOptions':{'level':0x6}}),_0x2a3643;}[a234_0x281650(0x214)](_0x3212a8,_0x3dff5b,_0x1013db){const _0x41c882=a234_0x281650,_0x85cec4=new Date()[_0x41c882(0x210)](),_0x198603={};return _0x198603[constants_1[_0x41c882(0x23a)]+_0x41c882(0x237)]=_0x3dff5b,_0x198603[constants_1[_0x41c882(0x23a)]+'CRC32__c']=_0x3212a8[_0x41c882(0x23e)],_0x198603[constants_1[_0x41c882(0x23a)]+_0x41c882(0x216)]=_0x85cec4,_0x198603[constants_1[_0x41c882(0x23a)]+'Changed_By__c']=this['username'],_0x198603[constants_1[_0x41c882(0x23a)]+_0x41c882(0x219)]=_0x1013db?_0x1013db+0x1:0x1,_0x198603[constants_1[_0x41c882(0x202)]+'Is_From_Agent__c']=!![],_0x198603;}[a234_0x281650(0x230)](_0x9b53bd,_0x13c0ed){const _0x588ef6=a234_0x281650;var _0x3fd0dd,_0x8de431;const _0x521e02=new Date()[_0x588ef6(0x210)](),_0x54931a={};return!_0x13c0ed?(this['branchId']?(_0x54931a[constants_1[_0x588ef6(0x23a)]+_0x588ef6(0x229)]=this[_0x588ef6(0x20a)],_0x54931a[constants_1[_0x588ef6(0x23a)]+'Source__c']=_0x588ef6(0x247),_0x54931a[_0x588ef6(0x22d)]=(_0x3fd0dd=this[_0x588ef6(0x21e)][_0x588ef6(0x1e9)](_0x5a7f8f=>_0x5a7f8f[_0x588ef6(0x226)]===_0x588ef6(0x247)))===null||_0x3fd0dd===void 0x0?void 0x0:_0x3fd0dd['id']):(_0x54931a[constants_1[_0x588ef6(0x23a)]+_0x588ef6(0x246)]=this['repositoryId'],_0x54931a[constants_1[_0x588ef6(0x23a)]+_0x588ef6(0x240)]=_0x588ef6(0x1fd),_0x54931a[_0x588ef6(0x22d)]=(_0x8de431=this[_0x588ef6(0x21e)][_0x588ef6(0x1e9)](_0x52d81c=>_0x52d81c[_0x588ef6(0x226)]==='Repository'))===null||_0x8de431===void 0x0?void 0x0:_0x8de431['id']),_0x54931a[constants_1['FLOSUM_NAMESPACE']+'Version__c']=0x1):_0x54931a[constants_1['FLOSUM_NAMESPACE']+_0x588ef6(0x219)]=_0x13c0ed['version']+0x1,_0x54931a[constants_1[_0x588ef6(0x23a)]+_0x588ef6(0x204)]=_0x9b53bd[_0x588ef6(0x1ed)],_0x54931a[constants_1[_0x588ef6(0x23a)]+_0x588ef6(0x21c)]=_0x9b53bd[_0x588ef6(0x226)],_0x54931a[constants_1[_0x588ef6(0x23a)]+_0x588ef6(0x1ee)]=_0x9b53bd[_0x588ef6(0x205)],_0x54931a[constants_1['FLOSUM_NAMESPACE']+_0x588ef6(0x1f0)]=this[_0x588ef6(0x1e3)],_0x54931a[constants_1[_0x588ef6(0x23a)]+_0x588ef6(0x213)]=this[_0x588ef6(0x1e3)],_0x54931a[constants_1[_0x588ef6(0x23a)]+_0x588ef6(0x218)]=_0x521e02,_0x54931a[constants_1[_0x588ef6(0x23a)]+_0x588ef6(0x224)]=_0x521e02,_0x54931a[constants_1[_0x588ef6(0x23a)]+_0x588ef6(0x225)]=_0x9b53bd[_0x588ef6(0x23e)],_0x54931a[constants_1[_0x588ef6(0x23a)]+'Vlocity_Component_Name__c']=_0x9b53bd['vlocityComponentName'],_0x54931a[constants_1[_0x588ef6(0x23a)]+_0x588ef6(0x20f)]=_0x9b53bd['isVlocityComponent'],_0x54931a;}[a234_0x281650(0x22c)](){const _0x532b8c=a234_0x281650;return this[_0x532b8c(0x1f7)];}async[a234_0x281650(0x20e)](_0x145857,_0xaf148c){const _0x323e8d=a234_0x281650,_0x4557cd=[];for(const _0x27eb57 of _0x145857){const _0x341275=(0x0,composite_utils_1[_0x323e8d(0x223)])(constants_1[_0x323e8d(0x1ea)],this[_0x323e8d(0x230)](_0x27eb57)),_0x454965=(0x0,composite_utils_1[_0x323e8d(0x223)])(constants_1[_0x323e8d(0x21f)],this[_0x323e8d(0x214)](_0x27eb57,'@{'+_0x341275['reference']+_0x323e8d(0x244))),_0x38ab2a=(0x0,composite_utils_1[_0x323e8d(0x223)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x323e8d(0x243)](_0x27eb57,'@{'+_0x454965[_0x323e8d(0x212)]+'.id}'));this[_0x323e8d(0x1fb)](_0x341275['request'][_0x323e8d(0x221)],_0x341275['reference']),_0x4557cd['push'](_0x341275[_0x323e8d(0x217)],_0x454965[_0x323e8d(0x217)],_0x38ab2a[_0x323e8d(0x217)]),_0xaf148c&&_0x4557cd[_0x323e8d(0x1e0)](this[_0x323e8d(0x1e8)](_0xaf148c,'@{'+_0x454965[_0x323e8d(0x212)]+_0x323e8d(0x244)));}return _0x4557cd;}async[a234_0x281650(0x231)](_0x1ba983,_0x27ff49=''){const _0x59a2db=a234_0x281650,_0x1132d8=[];for(const {component:_0x316e47,meta:_0x1937f3}of _0x1ba983){if(!_0x1937f3['id']){const _0x2ab184=this[_0x59a2db(0x1f7)][_0x59a2db(0x1e9)](_0x461413=>_0x461413[_0x59a2db(0x20d)]===_0x316e47['name']&&_0x461413[_0x59a2db(0x23b)]===_0x316e47[_0x59a2db(0x1ed)]);if(!_0x2ab184)throw new salesforce_error_1[(_0x59a2db(0x233))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x316e47['name']+'\x20['+_0x316e47[_0x59a2db(0x1ed)]+_0x59a2db(0x220)));_0x1937f3['id']=_0x2ab184[_0x59a2db(0x1e7)];}const _0x16f924=(0x0,composite_utils_1[_0x59a2db(0x1e5)])(constants_1[_0x59a2db(0x1ea)],_0x1937f3['id'],this[_0x59a2db(0x230)](_0x316e47,_0x1937f3)),_0x94192a=(0x0,composite_utils_1[_0x59a2db(0x223)])(constants_1[_0x59a2db(0x21f)],this['prepareComponentHistoryRecord'](_0x316e47,_0x1937f3['id'],_0x1937f3[_0x59a2db(0x22f)])),_0x5c5b3f=(0x0,composite_utils_1[_0x59a2db(0x223)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x59a2db(0x243)](_0x316e47,'@{'+_0x94192a[_0x59a2db(0x212)]+'.id}'));this[_0x59a2db(0x1fb)](_0x16f924['request'][_0x59a2db(0x221)],_0x16f924['reference']),_0x1132d8[_0x59a2db(0x1e0)](_0x16f924[_0x59a2db(0x217)],_0x94192a['request'],_0x5c5b3f[_0x59a2db(0x217)]),_0x27ff49&&_0x1132d8[_0x59a2db(0x1e0)](this[_0x59a2db(0x1e8)](_0x27ff49,'@{'+_0x94192a[_0x59a2db(0x212)]+_0x59a2db(0x244)));}return _0x1132d8;}async[a234_0x281650(0x248)](_0x1e8f09,_0x326147=![]){const _0x1a1c79=a234_0x281650,_0x3358f5={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x23f067=[];for(const _0x35c512 of _0x1e8f09){if(_0x35c512['id'])_0x23f067[_0x1a1c79(0x1e0)](_0x35c512['id']);else{const _0x132db0=this['proceededComponentsMeta'][_0x1a1c79(0x1e9)](_0x441eec=>_0x441eec[_0x1a1c79(0x20d)]===_0x35c512['name']&&_0x441eec[_0x1a1c79(0x23b)]===_0x35c512['type']);if(!_0x132db0||!_0x132db0[_0x1a1c79(0x1e7)])continue;_0x23f067[_0x1a1c79(0x1e0)](_0x132db0[_0x1a1c79(0x1e7)]);}}if(_0x326147){const _0x476a2d=await this['gitSync']['fetchCommitManifestsByComponentIds'](_0x23f067);_0x3358f5[_0x1a1c79(0x1e1)]=_0x476a2d[_0x1a1c79(0x1ef)](_0xa74f07=>(0x0,composite_utils_1[_0x1a1c79(0x1f2)])(constants_1[_0x1a1c79(0x23f)],_0xa74f07)[_0x1a1c79(0x217)]);}return _0x3358f5[_0x1a1c79(0x241)]=_0x23f067['map'](_0x456efc=>(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x1a1c79(0x1ea)],_0x456efc,{[constants_1[_0x1a1c79(0x202)]+_0x1a1c79(0x239)]:!![]})['request']),_0x3358f5[_0x1a1c79(0x222)]=_0x23f067['map'](_0x7c5100=>(0x0,composite_utils_1[_0x1a1c79(0x1f2)])(constants_1[_0x1a1c79(0x1ea)],_0x7c5100)[_0x1a1c79(0x217)]),_0x3358f5;}}exports[a234_0x281650(0x1fe)]=SalesforceComponentsManager;