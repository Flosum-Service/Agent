const a228_0x25aabc=a228_0x1abe;(function(_0x53e55b,_0xdcb6ad){const _0x450283=a228_0x1abe,_0x1bfc4f=_0x53e55b();while(!![]){try{const _0x1d49eb=-parseInt(_0x450283(0x102))/0x1*(-parseInt(_0x450283(0x11f))/0x2)+parseInt(_0x450283(0x144))/0x3*(-parseInt(_0x450283(0x123))/0x4)+-parseInt(_0x450283(0x13c))/0x5+-parseInt(_0x450283(0x13b))/0x6+parseInt(_0x450283(0x136))/0x7+parseInt(_0x450283(0x122))/0x8+parseInt(_0x450283(0x14b))/0x9;if(_0x1d49eb===_0xdcb6ad)break;else _0x1bfc4f['push'](_0x1bfc4f['shift']());}catch(_0x2e333e){_0x1bfc4f['push'](_0x1bfc4f['shift']());}}}(a228_0x2675,0xeb4da));const a228_0x41f8a4=(function(){let _0x73653b=!![];return function(_0x376831,_0x158abd){const _0x32c892=_0x73653b?function(){const _0x430f4a=a228_0x1abe;if(_0x158abd){const _0x180ed3=_0x158abd[_0x430f4a(0x10e)](_0x376831,arguments);return _0x158abd=null,_0x180ed3;}}:function(){};return _0x73653b=![],_0x32c892;};}()),a228_0x3b1c2b=a228_0x41f8a4(this,function(){const _0x5bd678=a228_0x1abe;return a228_0x3b1c2b['toString']()['search'](_0x5bd678(0x119))['toString']()[_0x5bd678(0xf8)](a228_0x3b1c2b)['search'](_0x5bd678(0x119));});a228_0x3b1c2b();'use strict';function a228_0x1abe(_0x7af969,_0xc2561f){const _0x125386=a228_0x2675();return a228_0x1abe=function(_0x3b1c2b,_0x41f8a4){_0x3b1c2b=_0x3b1c2b-0xeb;let _0x26750f=_0x125386[_0x3b1c2b];return _0x26750f;},a228_0x1abe(_0x7af969,_0xc2561f);}var __importDefault=this&&this[a228_0x25aabc(0x116)]||function(_0x5f49a9){return _0x5f49a9&&_0x5f49a9['__esModule']?_0x5f49a9:{'default':_0x5f49a9};};function a228_0x2675(){const _0x5a4b52=['insert','Committed_On__c','Changed_By__c','createPatchRequest','2CvBVTG','FLOSUM_COMMIT_MANIFEST','proceededComponentsMeta','7583984PEvNzK','3380jEOwdo','map','Is_From_Agent__c','type','FLOSUM_COMPONENT','Component_Type__c','ParentId','Repository','push','Logger','.id}','SalesforceError','prepareComponentHistoryRecord','extractFieldsFromRecord',']\x20-\x20meta\x20not\x20found','proceedComponentMeta','FLOSUM_NAMESPACE','componentName','Description','11248678RFwhmO','File_Name__c','componentId','toISOString','createPostRequest','11103642BCrWDn','8800685aObKMk','Component_Name__c','Last_Modified_By__c','Repository__c','generateAsync','CRC32__c','Could\x20not\x20proceed\x20component\x20','getProceededComponentsMeta','183wNmGkA','componentsToUpdate','file','request','RecordTypeId','SalesforceComponentsManager','Zip','13107798SKvfzv','Component_History__c','gitSync','createDeleteRequest','delete','version','keys','Version__c','../utils/composite.utils','username','prepareCommitManifest','Name','Branch','componentType','constructor','name','files','branchId','Deletion_By_Agent__c','typedi','body','crc','Branch__c','__esModule','614717JFuFfW','manifests','FLOSUM_GIT_NAMESPACE','repositoryId','Body','prepareComponentAttachmentRecord','Last_Modified_Date__c','Commit__c','createZip','prepareComponentRecord','reference','find','apply','../utils/flosum-naming.utils','FLOSUM_ATTACHMENT','base64','update','application/zip','filePath','fetchCommitManifestsByComponentIds','__importDefault','DEFLATE','recordTypes','(((.+)+)+)+$','FLOSUM_COMPONENT_HISTORY'];a228_0x2675=function(){return _0x5a4b52;};return a228_0x2675();}Object['defineProperty'](exports,a228_0x25aabc(0x101),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require('../../../../constants'),core_1=require('../../../../core'),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a228_0x25aabc(0xfd))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a228_0x25aabc(0xf2)),flosum_naming_utils_1=require(a228_0x25aabc(0x10f)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x195bbf,_0x3ecd07,_0x534f4f,_0x34b8cf,_0x5ef695){const _0x1b2d8f=a228_0x25aabc;this[_0x1b2d8f(0x105)]=_0x195bbf,this[_0x1b2d8f(0xfb)]=_0x3ecd07,this[_0x1b2d8f(0xf3)]=_0x534f4f,this[_0x1b2d8f(0x118)]=_0x34b8cf,this[_0x1b2d8f(0x121)]=_0x5ef695,this['logger']=new core_1[(_0x1b2d8f(0x12c))](SalesforceComponentsManager[_0x1b2d8f(0xf9)]),this[_0x1b2d8f(0xec)]=typedi_1['default']['get'](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a228_0x25aabc(0x132)](_0x46556f,_0x445a40){const _0x5a1f76=a228_0x25aabc,_0x275c82=(0x0,flosum_naming_utils_1[_0x5a1f76(0x130)])(_0x46556f,[_0x5a1f76(0x128),'Component_Name__c',_0x5a1f76(0xf1)]);this[_0x5a1f76(0x121)][_0x5a1f76(0x12b)]({'componentId':'','reference':_0x445a40,'version':_0x275c82[_0x5a1f76(0xf1)],'componentName':_0x275c82['Component_Name__c'],'componentType':_0x275c82[_0x5a1f76(0x128)]});}['prepareCommitManifest'](_0x27c3aa,_0x543fb4){const _0x5984e2=a228_0x25aabc,{request:_0x163633}=(0x0,composite_utils_1[_0x5984e2(0x13a)])(constants_1[_0x5984e2(0x120)],{[constants_1[_0x5984e2(0x133)]+_0x5984e2(0x109)]:_0x27c3aa,[constants_1[_0x5984e2(0x133)]+_0x5984e2(0xeb)]:_0x543fb4});return _0x163633;}async[a228_0x25aabc(0x107)](_0x31f177,_0x23a25e){const _0x4ccfb8=a228_0x25aabc,_0x2f9075={},_0x4b0a0c=zip_1[_0x4ccfb8(0x14a)][_0x4ccfb8(0x10a)]();for(const _0x235ef2 of Object[_0x4ccfb8(0xf0)](_0x31f177[_0x4ccfb8(0xfa)])){_0x4b0a0c[_0x4ccfb8(0x146)](_0x235ef2,_0x31f177[_0x4ccfb8(0xfa)][_0x235ef2],{'createFolders':!![]});}return _0x2f9075['ContentType']=_0x4ccfb8(0x113),_0x2f9075[_0x4ccfb8(0xf5)]=_0x31f177[_0x4ccfb8(0x126)],_0x2f9075[_0x4ccfb8(0x135)]=_0x31f177[_0x4ccfb8(0x126)],_0x2f9075[_0x4ccfb8(0x129)]=_0x23a25e,_0x2f9075[_0x4ccfb8(0x106)]=await _0x4b0a0c[_0x4ccfb8(0x140)]({'type':_0x4ccfb8(0x111),'compression':_0x4ccfb8(0x117),'compressionOptions':{'level':0x6}}),_0x2f9075;}[a228_0x25aabc(0x12f)](_0x303148,_0x3532e1,_0x22c5a7){const _0x4cb4fe=a228_0x25aabc,_0x246ac3=new Date()[_0x4cb4fe(0x139)](),_0x18bf17={};return _0x18bf17[constants_1[_0x4cb4fe(0x133)]+'Component__c']=_0x3532e1,_0x18bf17[constants_1[_0x4cb4fe(0x133)]+'CRC32__c']=_0x303148[_0x4cb4fe(0xff)],_0x18bf17[constants_1[_0x4cb4fe(0x133)]+'Changed_On__c']=_0x246ac3,_0x18bf17[constants_1[_0x4cb4fe(0x133)]+_0x4cb4fe(0x11d)]=this[_0x4cb4fe(0xf3)],_0x18bf17[constants_1[_0x4cb4fe(0x133)]+'Version__c']=_0x22c5a7?_0x22c5a7+0x1:0x1,_0x18bf17[constants_1[_0x4cb4fe(0x104)]+_0x4cb4fe(0x125)]=!![],_0x18bf17;}['prepareComponentRecord'](_0x609c0,_0x50b0f7){const _0x1d9135=a228_0x25aabc;var _0x53e691,_0x29d3a7;const _0x5b61a3=new Date()[_0x1d9135(0x139)](),_0x37d6a7={};return!_0x50b0f7?(this['branchId']?(_0x37d6a7[constants_1['FLOSUM_NAMESPACE']+_0x1d9135(0x100)]=this[_0x1d9135(0xfb)],_0x37d6a7[constants_1[_0x1d9135(0x133)]+'Source__c']=_0x1d9135(0xf6),_0x37d6a7[_0x1d9135(0x148)]=(_0x53e691=this[_0x1d9135(0x118)][_0x1d9135(0x10d)](_0x4e20cf=>_0x4e20cf[_0x1d9135(0xf9)]===_0x1d9135(0xf6)))===null||_0x53e691===void 0x0?void 0x0:_0x53e691['id']):(_0x37d6a7[constants_1[_0x1d9135(0x133)]+_0x1d9135(0x13f)]=this[_0x1d9135(0x105)],_0x37d6a7[constants_1[_0x1d9135(0x133)]+'Source__c']=_0x1d9135(0x12a),_0x37d6a7[_0x1d9135(0x148)]=(_0x29d3a7=this['recordTypes'][_0x1d9135(0x10d)](_0x2c0420=>_0x2c0420['name']==='Repository'))===null||_0x29d3a7===void 0x0?void 0x0:_0x29d3a7['id']),_0x37d6a7[constants_1['FLOSUM_NAMESPACE']+_0x1d9135(0xf1)]=0x1):_0x37d6a7[constants_1[_0x1d9135(0x133)]+_0x1d9135(0xf1)]=_0x50b0f7[_0x1d9135(0xef)]+0x1,_0x37d6a7[constants_1[_0x1d9135(0x133)]+_0x1d9135(0x128)]=_0x609c0[_0x1d9135(0x126)],_0x37d6a7[constants_1['FLOSUM_NAMESPACE']+_0x1d9135(0x13d)]=_0x609c0[_0x1d9135(0xf9)],_0x37d6a7[constants_1['FLOSUM_NAMESPACE']+_0x1d9135(0x137)]=_0x609c0[_0x1d9135(0x114)],_0x37d6a7[constants_1[_0x1d9135(0x133)]+'Last_Updated_By__c']=this['username'],_0x37d6a7[constants_1['FLOSUM_NAMESPACE']+_0x1d9135(0x13e)]=this['username'],_0x37d6a7[constants_1[_0x1d9135(0x133)]+_0x1d9135(0x108)]=_0x5b61a3,_0x37d6a7[constants_1[_0x1d9135(0x133)]+_0x1d9135(0x11c)]=_0x5b61a3,_0x37d6a7[constants_1[_0x1d9135(0x133)]+_0x1d9135(0x141)]=_0x609c0[_0x1d9135(0xff)],_0x37d6a7;}[a228_0x25aabc(0x143)](){const _0x502e68=a228_0x25aabc;return this[_0x502e68(0x121)];}async[a228_0x25aabc(0x11b)](_0xfb4921,_0x494a6b){const _0x2f0180=a228_0x25aabc,_0x14a7f9=[];for(const _0x41e85a of _0xfb4921){const _0x27702d=(0x0,composite_utils_1[_0x2f0180(0x13a)])(constants_1[_0x2f0180(0x127)],this['prepareComponentRecord'](_0x41e85a)),_0x59e29d=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x2f0180(0x11a)],this[_0x2f0180(0x12f)](_0x41e85a,'@{'+_0x27702d['reference']+_0x2f0180(0x12d))),_0x135923=(0x0,composite_utils_1[_0x2f0180(0x13a)])(constants_1[_0x2f0180(0x110)],await this['prepareComponentAttachmentRecord'](_0x41e85a,'@{'+_0x59e29d['reference']+_0x2f0180(0x12d)));this['proceedComponentMeta'](_0x27702d[_0x2f0180(0x147)][_0x2f0180(0xfe)],_0x27702d[_0x2f0180(0x10c)]),_0x14a7f9['push'](_0x27702d['request'],_0x59e29d[_0x2f0180(0x147)],_0x135923['request']),_0x494a6b&&_0x14a7f9[_0x2f0180(0x12b)](this[_0x2f0180(0xf4)](_0x494a6b,'@{'+_0x59e29d[_0x2f0180(0x10c)]+_0x2f0180(0x12d)));}return _0x14a7f9;}async[a228_0x25aabc(0x112)](_0x36694f,_0x480b94=''){const _0x3110f1=a228_0x25aabc,_0x185c94=[];for(const {component:_0x9a05b9,meta:_0x38a9be}of _0x36694f){if(!_0x38a9be['id']){const _0x2f1cb7=this['proceededComponentsMeta'][_0x3110f1(0x10d)](_0x37d773=>_0x37d773[_0x3110f1(0x134)]===_0x9a05b9[_0x3110f1(0xf9)]&&_0x37d773[_0x3110f1(0xf7)]===_0x9a05b9[_0x3110f1(0x126)]);if(!_0x2f1cb7)throw new salesforce_error_1[(_0x3110f1(0x12e))](new Error(_0x3110f1(0x142)+_0x9a05b9[_0x3110f1(0xf9)]+'\x20['+_0x9a05b9['type']+_0x3110f1(0x131)));_0x38a9be['id']=_0x2f1cb7['componentId'];}const _0x341c63=(0x0,composite_utils_1[_0x3110f1(0x11e)])(constants_1[_0x3110f1(0x127)],_0x38a9be['id'],this[_0x3110f1(0x10b)](_0x9a05b9,_0x38a9be)),_0x958861=(0x0,composite_utils_1[_0x3110f1(0x13a)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x3110f1(0x12f)](_0x9a05b9,_0x38a9be['id'],_0x38a9be[_0x3110f1(0xef)])),_0x5b3fa1=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x3110f1(0x107)](_0x9a05b9,'@{'+_0x958861[_0x3110f1(0x10c)]+_0x3110f1(0x12d)));this[_0x3110f1(0x132)](_0x341c63['request'][_0x3110f1(0xfe)],_0x341c63[_0x3110f1(0x10c)]),_0x185c94['push'](_0x341c63[_0x3110f1(0x147)],_0x958861[_0x3110f1(0x147)],_0x5b3fa1[_0x3110f1(0x147)]),_0x480b94&&_0x185c94[_0x3110f1(0x12b)](this[_0x3110f1(0xf4)](_0x480b94,'@{'+_0x958861[_0x3110f1(0x10c)]+_0x3110f1(0x12d)));}return _0x185c94;}async[a228_0x25aabc(0xee)](_0x714c5f,_0x25ccc8=![]){const _0x448a87=a228_0x25aabc,_0x33709c={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x237bb6=[];for(const _0x14874f of _0x714c5f){if(_0x14874f['id'])_0x237bb6['push'](_0x14874f['id']);else{const _0x332829=this[_0x448a87(0x121)][_0x448a87(0x10d)](_0x1a738e=>_0x1a738e[_0x448a87(0x134)]===_0x14874f['name']&&_0x1a738e[_0x448a87(0xf7)]===_0x14874f['type']);if(!_0x332829||!_0x332829[_0x448a87(0x138)])continue;_0x237bb6['push'](_0x332829['componentId']);}}if(_0x25ccc8){const _0x64b6a4=await this['gitSync'][_0x448a87(0x115)](_0x237bb6);_0x33709c[_0x448a87(0x103)]=_0x64b6a4[_0x448a87(0x124)](_0x197d7d=>(0x0,composite_utils_1[_0x448a87(0xed)])(constants_1[_0x448a87(0x120)],_0x197d7d)[_0x448a87(0x147)]);}return _0x33709c[_0x448a87(0x145)]=_0x237bb6[_0x448a87(0x124)](_0x59cdf2=>(0x0,composite_utils_1[_0x448a87(0x11e)])(constants_1[_0x448a87(0x127)],_0x59cdf2,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x448a87(0xfc)]:!![]})['request']),_0x33709c['componentsToDelete']=_0x237bb6[_0x448a87(0x124)](_0x2e583d=>(0x0,composite_utils_1[_0x448a87(0xed)])(constants_1[_0x448a87(0x127)],_0x2e583d)[_0x448a87(0x147)]),_0x33709c;}}exports[a228_0x25aabc(0x149)]=SalesforceComponentsManager;