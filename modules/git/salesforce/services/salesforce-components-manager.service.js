const a228_0x38a6e4=a228_0x3ac1;(function(_0x1c37de,_0x90c2b3){const _0x50d3d2=a228_0x3ac1,_0x444050=_0x1c37de();while(!![]){try{const _0x1b75e6=-parseInt(_0x50d3d2(0x17d))/0x1*(-parseInt(_0x50d3d2(0x163))/0x2)+parseInt(_0x50d3d2(0x1b4))/0x3+-parseInt(_0x50d3d2(0x17f))/0x4+-parseInt(_0x50d3d2(0x167))/0x5+-parseInt(_0x50d3d2(0x194))/0x6+parseInt(_0x50d3d2(0x1a8))/0x7+parseInt(_0x50d3d2(0x1b0))/0x8*(parseInt(_0x50d3d2(0x191))/0x9);if(_0x1b75e6===_0x90c2b3)break;else _0x444050['push'](_0x444050['shift']());}catch(_0x4ba3fa){_0x444050['push'](_0x444050['shift']());}}}(a228_0x2014,0xe7134));const a228_0x25f273=(function(){let _0x314a39=!![];return function(_0x236f98,_0x92434e){const _0x1726e6=_0x314a39?function(){const _0x1a582c=a228_0x3ac1;if(_0x92434e){const _0x4da619=_0x92434e[_0x1a582c(0x169)](_0x236f98,arguments);return _0x92434e=null,_0x4da619;}}:function(){};return _0x314a39=![],_0x1726e6;};}()),a228_0x466183=a228_0x25f273(this,function(){const _0x2b6c90=a228_0x3ac1;return a228_0x466183[_0x2b6c90(0x19c)]()[_0x2b6c90(0x186)](_0x2b6c90(0x17a))['toString']()[_0x2b6c90(0x19b)](a228_0x466183)[_0x2b6c90(0x186)](_0x2b6c90(0x17a));});a228_0x466183();'use strict';var __importDefault=this&&this[a228_0x38a6e4(0x152)]||function(_0x3d33f1){const _0x48aec3=a228_0x38a6e4;return _0x3d33f1&&_0x3d33f1[_0x48aec3(0x190)]?_0x3d33f1:{'default':_0x3d33f1};};Object[a228_0x38a6e4(0x1a3)](exports,a228_0x38a6e4(0x190),{'value':!![]}),exports[a228_0x38a6e4(0x181)]=void 0x0;function a228_0x2014(){const _0x603859=['24220341JAsKJp','default','branchId','7278822YmBXFE','files','fetchCommitManifestsByComponentIds','../../../../constants','../errors/salesforce.error','Changed_By__c','Source__c','constructor','toString','manifests','prepareComponentRecord','Zip','toISOString','createDeleteRequest','request','defineProperty','proceededComponentsMeta','Could\x20not\x20proceed\x20component\x20','prepareComponentHistoryRecord','body','11030005VZAbGS','ParentId','Version__c','map','delete','typedi','RecordTypeId','Body','8dSjLWt','Branch__c','Repository__c','.id}','3621930yoZYTD','find','__importDefault','componentType','Description','Last_Updated_By__c','createPostRequest','base64','insert','prepareComponentAttachmentRecord','Branch','SalesforceError','push','FLOSUM_GIT_NAMESPACE','recordTypes','Last_Modified_By__c','getProceededComponentsMeta','FLOSUM_COMMIT_MANIFEST','Logger','381106WPjnKW','componentsToDelete','FLOSUM_ATTACHMENT','type','9187315JWXtmf','filePath','apply','file','keys',']\x20-\x20meta\x20not\x20found','application/zip','reference','../utils/composite.utils','Last_Modified_Date__c','componentsToUpdate','componentId','./salesforce-git-sync.service','createPatchRequest','Repository','gitSync','crc','repositoryId','Component_Type__c','(((.+)+)+)+$','get','Component_Name__c','2qqtRav','generateAsync','7432784CTTbgL','FLOSUM_NAMESPACE','SalesforceComponentsManager','prepareCommitManifest','Deletion_By_Agent__c','Is_From_Agent__c','Committed_On__c','search','createZip','FLOSUM_COMPONENT_HISTORY','version','proceedComponentMeta','componentName','FLOSUM_COMPONENT','name','update','username','__esModule'];a228_0x2014=function(){return _0x603859;};return a228_0x2014();}function a228_0x3ac1(_0x12b7bf,_0x416cf4){const _0x2b4c4a=a228_0x2014();return a228_0x3ac1=function(_0x466183,_0x25f273){_0x466183=_0x466183-0x151;let _0x201443=_0x2b4c4a[_0x466183];return _0x201443;},a228_0x3ac1(_0x12b7bf,_0x416cf4);}const constants_1=require(a228_0x38a6e4(0x197)),core_1=require('../../../../core'),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a228_0x38a6e4(0x1ad))),salesforce_error_1=require(a228_0x38a6e4(0x198)),composite_utils_1=require(a228_0x38a6e4(0x16f)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a228_0x38a6e4(0x173));class SalesforceComponentsManager{constructor(_0xa1556,_0x107743,_0x32de40,_0x28d75d,_0x47b056){const _0x312087=a228_0x38a6e4;this[_0x312087(0x178)]=_0xa1556,this[_0x312087(0x193)]=_0x107743,this[_0x312087(0x18f)]=_0x32de40,this[_0x312087(0x15e)]=_0x28d75d,this[_0x312087(0x1a4)]=_0x47b056,this['logger']=new core_1[(_0x312087(0x162))](SalesforceComponentsManager['name']),this[_0x312087(0x176)]=typedi_1[_0x312087(0x192)][_0x312087(0x17b)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a228_0x38a6e4(0x18a)](_0x509b05,_0x4b46d8){const _0x1c86a6=a228_0x38a6e4,_0x499fb2=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x509b05,[_0x1c86a6(0x179),_0x1c86a6(0x17c),'Version__c']);this['proceededComponentsMeta']['push']({'componentId':'','reference':_0x4b46d8,'version':_0x499fb2[_0x1c86a6(0x1aa)],'componentName':_0x499fb2['Component_Name__c'],'componentType':_0x499fb2[_0x1c86a6(0x179)]});}[a228_0x38a6e4(0x182)](_0x591bb6,_0x5b87b3){const _0x4f26f0=a228_0x38a6e4,{request:_0x18b22d}=(0x0,composite_utils_1[_0x4f26f0(0x156)])(constants_1[_0x4f26f0(0x161)],{[constants_1[_0x4f26f0(0x180)]+'Commit__c']:_0x591bb6,[constants_1[_0x4f26f0(0x180)]+'Component_History__c']:_0x5b87b3});return _0x18b22d;}async[a228_0x38a6e4(0x159)](_0x151904,_0x4b167b){const _0x4b66e5=a228_0x38a6e4,_0xdd3383={},_0x1c698c=zip_1[_0x4b66e5(0x19f)][_0x4b66e5(0x187)]();for(const _0x34122c of Object[_0x4b66e5(0x16b)](_0x151904[_0x4b66e5(0x195)])){_0x1c698c[_0x4b66e5(0x16a)](_0x34122c,_0x151904[_0x4b66e5(0x195)][_0x34122c],{'createFolders':!![]});}return _0xdd3383['ContentType']=_0x4b66e5(0x16d),_0xdd3383['Name']=_0x151904[_0x4b66e5(0x166)],_0xdd3383[_0x4b66e5(0x154)]=_0x151904[_0x4b66e5(0x166)],_0xdd3383[_0x4b66e5(0x1a9)]=_0x4b167b,_0xdd3383[_0x4b66e5(0x1af)]=await _0x1c698c[_0x4b66e5(0x17e)]({'type':_0x4b66e5(0x157),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0xdd3383;}[a228_0x38a6e4(0x1a6)](_0x1a6f7e,_0x283e09,_0x57da01){const _0x251f37=a228_0x38a6e4,_0x563fb0=new Date()[_0x251f37(0x1a0)](),_0x1cd434={};return _0x1cd434[constants_1['FLOSUM_NAMESPACE']+'Component__c']=_0x283e09,_0x1cd434[constants_1[_0x251f37(0x180)]+'CRC32__c']=_0x1a6f7e[_0x251f37(0x177)],_0x1cd434[constants_1[_0x251f37(0x180)]+'Changed_On__c']=_0x563fb0,_0x1cd434[constants_1[_0x251f37(0x180)]+_0x251f37(0x199)]=this[_0x251f37(0x18f)],_0x1cd434[constants_1[_0x251f37(0x180)]+_0x251f37(0x1aa)]=_0x57da01?_0x57da01+0x1:0x1,_0x1cd434[constants_1[_0x251f37(0x15d)]+_0x251f37(0x184)]=!![],_0x1cd434;}[a228_0x38a6e4(0x19e)](_0x3c13e8,_0xf21a04){const _0x2bbe7b=a228_0x38a6e4;var _0x32cdda,_0x4c9edb;const _0x20ce07=new Date()[_0x2bbe7b(0x1a0)](),_0x481d7a={};return!_0xf21a04?(this[_0x2bbe7b(0x193)]?(_0x481d7a[constants_1[_0x2bbe7b(0x180)]+_0x2bbe7b(0x1b1)]=this[_0x2bbe7b(0x193)],_0x481d7a[constants_1['FLOSUM_NAMESPACE']+_0x2bbe7b(0x19a)]=_0x2bbe7b(0x15a),_0x481d7a[_0x2bbe7b(0x1ae)]=(_0x32cdda=this[_0x2bbe7b(0x15e)][_0x2bbe7b(0x151)](_0x23333e=>_0x23333e[_0x2bbe7b(0x18d)]===_0x2bbe7b(0x15a)))===null||_0x32cdda===void 0x0?void 0x0:_0x32cdda['id']):(_0x481d7a[constants_1[_0x2bbe7b(0x180)]+_0x2bbe7b(0x1b2)]=this[_0x2bbe7b(0x178)],_0x481d7a[constants_1[_0x2bbe7b(0x180)]+_0x2bbe7b(0x19a)]=_0x2bbe7b(0x175),_0x481d7a['RecordTypeId']=(_0x4c9edb=this[_0x2bbe7b(0x15e)]['find'](_0x3533e4=>_0x3533e4[_0x2bbe7b(0x18d)]===_0x2bbe7b(0x175)))===null||_0x4c9edb===void 0x0?void 0x0:_0x4c9edb['id']),_0x481d7a[constants_1[_0x2bbe7b(0x180)]+'Version__c']=0x1):_0x481d7a[constants_1[_0x2bbe7b(0x180)]+_0x2bbe7b(0x1aa)]=_0xf21a04[_0x2bbe7b(0x189)]+0x1,_0x481d7a[constants_1[_0x2bbe7b(0x180)]+_0x2bbe7b(0x179)]=_0x3c13e8[_0x2bbe7b(0x166)],_0x481d7a[constants_1['FLOSUM_NAMESPACE']+_0x2bbe7b(0x17c)]=_0x3c13e8['name'],_0x481d7a[constants_1[_0x2bbe7b(0x180)]+'File_Name__c']=_0x3c13e8[_0x2bbe7b(0x168)],_0x481d7a[constants_1[_0x2bbe7b(0x180)]+_0x2bbe7b(0x155)]=this[_0x2bbe7b(0x18f)],_0x481d7a[constants_1[_0x2bbe7b(0x180)]+_0x2bbe7b(0x15f)]=this[_0x2bbe7b(0x18f)],_0x481d7a[constants_1['FLOSUM_NAMESPACE']+_0x2bbe7b(0x170)]=_0x20ce07,_0x481d7a[constants_1[_0x2bbe7b(0x180)]+_0x2bbe7b(0x185)]=_0x20ce07,_0x481d7a[constants_1[_0x2bbe7b(0x180)]+'CRC32__c']=_0x3c13e8['crc'],_0x481d7a;}[a228_0x38a6e4(0x160)](){return this['proceededComponentsMeta'];}async[a228_0x38a6e4(0x158)](_0x4d96dc,_0x2918d2){const _0x20c1dd=a228_0x38a6e4,_0x266dd3=[];for(const _0xdd16ab of _0x4d96dc){const _0x1bafbf=(0x0,composite_utils_1[_0x20c1dd(0x156)])(constants_1[_0x20c1dd(0x18c)],this['prepareComponentRecord'](_0xdd16ab)),_0xf3fe3a=(0x0,composite_utils_1[_0x20c1dd(0x156)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x20c1dd(0x1a6)](_0xdd16ab,'@{'+_0x1bafbf[_0x20c1dd(0x16e)]+_0x20c1dd(0x1b3))),_0x5c2623=(0x0,composite_utils_1[_0x20c1dd(0x156)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x20c1dd(0x159)](_0xdd16ab,'@{'+_0xf3fe3a[_0x20c1dd(0x16e)]+_0x20c1dd(0x1b3)));this[_0x20c1dd(0x18a)](_0x1bafbf[_0x20c1dd(0x1a2)]['body'],_0x1bafbf[_0x20c1dd(0x16e)]),_0x266dd3[_0x20c1dd(0x15c)](_0x1bafbf[_0x20c1dd(0x1a2)],_0xf3fe3a['request'],_0x5c2623[_0x20c1dd(0x1a2)]),_0x2918d2&&_0x266dd3[_0x20c1dd(0x15c)](this[_0x20c1dd(0x182)](_0x2918d2,'@{'+_0xf3fe3a[_0x20c1dd(0x16e)]+_0x20c1dd(0x1b3)));}return _0x266dd3;}async[a228_0x38a6e4(0x18e)](_0x4306bd,_0x2cdc08=''){const _0x4eb5d5=a228_0x38a6e4,_0x3b2968=[];for(const {component:_0x50c8c9,meta:_0x3a3646}of _0x4306bd){if(!_0x3a3646['id']){const _0xf73af3=this[_0x4eb5d5(0x1a4)][_0x4eb5d5(0x151)](_0x593994=>_0x593994[_0x4eb5d5(0x18b)]===_0x50c8c9[_0x4eb5d5(0x18d)]&&_0x593994['componentType']===_0x50c8c9['type']);if(!_0xf73af3)throw new salesforce_error_1[(_0x4eb5d5(0x15b))](new Error(_0x4eb5d5(0x1a5)+_0x50c8c9[_0x4eb5d5(0x18d)]+'\x20['+_0x50c8c9[_0x4eb5d5(0x166)]+_0x4eb5d5(0x16c)));_0x3a3646['id']=_0xf73af3[_0x4eb5d5(0x172)];}const _0x736769=(0x0,composite_utils_1[_0x4eb5d5(0x174)])(constants_1[_0x4eb5d5(0x18c)],_0x3a3646['id'],this[_0x4eb5d5(0x19e)](_0x50c8c9,_0x3a3646)),_0x2c056a=(0x0,composite_utils_1[_0x4eb5d5(0x156)])(constants_1[_0x4eb5d5(0x188)],this[_0x4eb5d5(0x1a6)](_0x50c8c9,_0x3a3646['id'],_0x3a3646[_0x4eb5d5(0x189)])),_0x170374=(0x0,composite_utils_1[_0x4eb5d5(0x156)])(constants_1[_0x4eb5d5(0x165)],await this['prepareComponentAttachmentRecord'](_0x50c8c9,'@{'+_0x2c056a[_0x4eb5d5(0x16e)]+_0x4eb5d5(0x1b3)));this[_0x4eb5d5(0x18a)](_0x736769['request'][_0x4eb5d5(0x1a7)],_0x736769['reference']),_0x3b2968['push'](_0x736769[_0x4eb5d5(0x1a2)],_0x2c056a['request'],_0x170374[_0x4eb5d5(0x1a2)]),_0x2cdc08&&_0x3b2968[_0x4eb5d5(0x15c)](this[_0x4eb5d5(0x182)](_0x2cdc08,'@{'+_0x2c056a[_0x4eb5d5(0x16e)]+'.id}'));}return _0x3b2968;}async[a228_0x38a6e4(0x1ac)](_0x1232f0,_0x37543a=![]){const _0x565cc4=a228_0x38a6e4,_0x270c44={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x2f8b58=[];for(const _0x375d3b of _0x1232f0){if(_0x375d3b['id'])_0x2f8b58[_0x565cc4(0x15c)](_0x375d3b['id']);else{const _0x5197f4=this['proceededComponentsMeta'][_0x565cc4(0x151)](_0xe37b9e=>_0xe37b9e[_0x565cc4(0x18b)]===_0x375d3b[_0x565cc4(0x18d)]&&_0xe37b9e[_0x565cc4(0x153)]===_0x375d3b[_0x565cc4(0x166)]);if(!_0x5197f4||!_0x5197f4[_0x565cc4(0x172)])continue;_0x2f8b58[_0x565cc4(0x15c)](_0x5197f4[_0x565cc4(0x172)]);}}if(_0x37543a){const _0x2ddee8=await this[_0x565cc4(0x176)][_0x565cc4(0x196)](_0x2f8b58);_0x270c44[_0x565cc4(0x19d)]=_0x2ddee8[_0x565cc4(0x1ab)](_0x5691a7=>(0x0,composite_utils_1[_0x565cc4(0x1a1)])(constants_1[_0x565cc4(0x161)],_0x5691a7)[_0x565cc4(0x1a2)]);}return _0x270c44[_0x565cc4(0x171)]=_0x2f8b58[_0x565cc4(0x1ab)](_0x410d22=>(0x0,composite_utils_1[_0x565cc4(0x174)])(constants_1[_0x565cc4(0x18c)],_0x410d22,{[constants_1[_0x565cc4(0x15d)]+_0x565cc4(0x183)]:!![]})['request']),_0x270c44[_0x565cc4(0x164)]=_0x2f8b58[_0x565cc4(0x1ab)](_0x16c65c=>(0x0,composite_utils_1[_0x565cc4(0x1a1)])(constants_1[_0x565cc4(0x18c)],_0x16c65c)[_0x565cc4(0x1a2)]),_0x270c44;}}exports[a228_0x38a6e4(0x181)]=SalesforceComponentsManager;