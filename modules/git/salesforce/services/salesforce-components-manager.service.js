const a272_0x5b7ba7=a272_0x75ce;(function(_0x32340a,_0x4690bb){const _0x7197c1=a272_0x75ce,_0x4a6f0b=_0x32340a();while(!![]){try{const _0x4d54f7=parseInt(_0x7197c1(0x85))/0x1+parseInt(_0x7197c1(0xda))/0x2+parseInt(_0x7197c1(0xc5))/0x3+-parseInt(_0x7197c1(0x9c))/0x4+-parseInt(_0x7197c1(0xa0))/0x5+parseInt(_0x7197c1(0xd9))/0x6*(-parseInt(_0x7197c1(0xb9))/0x7)+parseInt(_0x7197c1(0x88))/0x8*(parseInt(_0x7197c1(0xe0))/0x9);if(_0x4d54f7===_0x4690bb)break;else _0x4a6f0b['push'](_0x4a6f0b['shift']());}catch(_0x297213){_0x4a6f0b['push'](_0x4a6f0b['shift']());}}}(a272_0x4d4e,0x21299));const a272_0x155df4=(function(){let _0x33f840=!![];return function(_0x213101,_0x47a917){const _0x1dfcd3=_0x33f840?function(){if(_0x47a917){const _0x5c82c9=_0x47a917['apply'](_0x213101,arguments);return _0x47a917=null,_0x5c82c9;}}:function(){};return _0x33f840=![],_0x1dfcd3;};}()),a272_0x5438e4=a272_0x155df4(this,function(){const _0x4f9dc6=a272_0x75ce;return a272_0x5438e4[_0x4f9dc6(0xa5)]()[_0x4f9dc6(0x90)]('(((.+)+)+)+$')[_0x4f9dc6(0xa5)]()[_0x4f9dc6(0x82)](a272_0x5438e4)['search'](_0x4f9dc6(0xdf));});function a272_0x75ce(_0x427891,_0x3fa325){const _0x1885f4=a272_0x4d4e();return a272_0x75ce=function(_0x5438e4,_0x155df4){_0x5438e4=_0x5438e4-0x7e;let _0x4d4e07=_0x1885f4[_0x5438e4];return _0x4d4e07;},a272_0x75ce(_0x427891,_0x3fa325);}a272_0x5438e4();'use strict';var __importDefault=this&&this[a272_0x5b7ba7(0x8c)]||function(_0x5e80ca){const _0x3675e3=a272_0x5b7ba7;return _0x5e80ca&&_0x5e80ca[_0x3675e3(0xcc)]?_0x5e80ca:{'default':_0x5e80ca};};Object[a272_0x5b7ba7(0xad)](exports,'__esModule',{'value':!![]}),exports[a272_0x5b7ba7(0x87)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a272_0x5b7ba7(0x8d)),zip_1=require(a272_0x5b7ba7(0xc2)),typedi_1=__importDefault(require(a272_0x5b7ba7(0x83))),salesforce_error_1=require(a272_0x5b7ba7(0x9d)),composite_utils_1=require(a272_0x5b7ba7(0x80)),flosum_naming_utils_1=require(a272_0x5b7ba7(0xb5)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');function a272_0x4d4e(){const _0x39945b=['Branch','Is_From_Agent__c','type','extractFieldsFromRecord','../utils/flosum-naming.utils','createPostRequest','body','.id}','5509QGiwKQ','proceededComponentsMeta','CRC32__c','insert','SalesforceGitSyncService','reference','Changed_On__c','FLOSUM_NAMESPACE','proceedComponentMeta','../../parsers/utils/zip','componentType','file','347544SMyuwP','repositoryId','Vlocity_Component_Name__c','Body','Could\x20not\x20proceed\x20component\x20','version','manifests','__esModule','Zip','Component_Name__c','Last_Modified_By__c','componentId','Component_History__c','Commit__c','Last_Modified_Date__c','Source__c','MC_Key__c','branchId','crc','FLOSUM_COMPONENT_HISTORY','1338XnPzvj','164710asPbwD','Changed_By__c','application/zip','FLOSUM_GIT_NAMESPACE','gitSync','(((.+)+)+)+$','9ZtJXXX','find','isVlocityComponent','toISOString','Committed_On__c','componentsToDelete','update','Last_Updated_By__c','../utils/composite.utils','componentName','constructor','typedi','base64','216057LTvJwu','Vlocity_Component__c','SalesforceComponentsManager','1637176mJfYbn','recordTypes','FLOSUM_COMPONENT','prepareCommitManifest','__importDefault','../../../../core','prepareComponentHistoryRecord','Repository','search',']\x20-\x20meta\x20not\x20found','request','prepareComponentAttachmentRecord','Component__c','prepareComponentRecord','DEFLATE','getProceededComponentsMeta','FLOSUM_COMMIT_MANIFEST','componentsToUpdate','Deletion_By_Agent__c','marketingCloudKey','934852VLiono','../errors/salesforce.error','username','push','369300xckVcu','RecordTypeId','Repository__c','Component_Type__c','generateAsync','toString','createPatchRequest','Version__c','File_Name__c','createZip','ParentId','logger','name','defineProperty','map','delete','Logger'];a272_0x4d4e=function(){return _0x39945b;};return a272_0x4d4e();}class SalesforceComponentsManager{constructor(_0x3978e0,_0x2a0abe,_0x4d3440,_0x150406,_0x29765e){const _0x156b97=a272_0x5b7ba7;this[_0x156b97(0xc6)]=_0x3978e0,this[_0x156b97(0xd6)]=_0x2a0abe,this[_0x156b97(0x9e)]=_0x4d3440,this[_0x156b97(0x89)]=_0x150406,this[_0x156b97(0xba)]=_0x29765e,this[_0x156b97(0xab)]=new core_1[(_0x156b97(0xb0))](SalesforceComponentsManager[_0x156b97(0xac)]),this[_0x156b97(0xde)]=typedi_1['default']['get'](salesforce_git_sync_service_1[_0x156b97(0xbd)]);}[a272_0x5b7ba7(0xc1)](_0x3f769a,_0x33de4a){const _0x44f3bc=a272_0x5b7ba7,_0x2a963f=(0x0,flosum_naming_utils_1[_0x44f3bc(0xb4)])(_0x3f769a,[_0x44f3bc(0xa3),_0x44f3bc(0xce),'Version__c']);this[_0x44f3bc(0xba)][_0x44f3bc(0x9f)]({'componentId':'','reference':_0x33de4a,'version':_0x2a963f[_0x44f3bc(0xa7)],'componentName':_0x2a963f[_0x44f3bc(0xce)],'componentType':_0x2a963f[_0x44f3bc(0xa3)]});}['prepareCommitManifest'](_0x531346,_0x40e433){const _0x41f7e2=a272_0x5b7ba7,{request:_0x28ebe7}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x41f7e2(0x98)],{[constants_1[_0x41f7e2(0xc0)]+_0x41f7e2(0xd2)]:_0x531346,[constants_1[_0x41f7e2(0xc0)]+_0x41f7e2(0xd1)]:_0x40e433});return _0x28ebe7;}async[a272_0x5b7ba7(0x93)](_0x27963f,_0x365d1b){const _0x22598d=a272_0x5b7ba7,_0x640118={},_0x19754a=zip_1[_0x22598d(0xcd)][_0x22598d(0xa9)]();for(const _0x2062b1 of Object['keys'](_0x27963f['files'])){_0x19754a[_0x22598d(0xc4)](_0x2062b1,_0x27963f['files'][_0x2062b1],{'createFolders':!![]});}return _0x640118['ContentType']=_0x22598d(0xdc),_0x640118['Name']=_0x27963f[_0x22598d(0xb3)],_0x640118['Description']=_0x27963f[_0x22598d(0xb3)],_0x640118[_0x22598d(0xaa)]=_0x365d1b,_0x640118[_0x22598d(0xc8)]=await _0x19754a[_0x22598d(0xa4)]({'type':_0x22598d(0x84),'compression':_0x22598d(0x96),'compressionOptions':{'level':0x6}}),_0x640118;}[a272_0x5b7ba7(0x8e)](_0x39d728,_0x1e5408,_0x243aa9){const _0x44df00=a272_0x5b7ba7,_0x235867=new Date()[_0x44df00(0xe3)](),_0x242d5b={};return _0x242d5b[constants_1[_0x44df00(0xc0)]+_0x44df00(0x94)]=_0x1e5408,_0x242d5b[constants_1['FLOSUM_NAMESPACE']+_0x44df00(0xbb)]=_0x39d728[_0x44df00(0xd7)],_0x242d5b[constants_1[_0x44df00(0xc0)]+_0x44df00(0xbf)]=_0x235867,_0x242d5b[constants_1[_0x44df00(0xc0)]+_0x44df00(0xdb)]=this[_0x44df00(0x9e)],_0x242d5b[constants_1[_0x44df00(0xc0)]+'Version__c']=_0x243aa9?_0x243aa9+0x1:0x1,_0x242d5b[constants_1[_0x44df00(0xdd)]+_0x44df00(0xb2)]=!![],_0x242d5b;}[a272_0x5b7ba7(0x95)](_0x3821f0,_0x30b451){const _0x2d7869=a272_0x5b7ba7;var _0x224b39,_0x19be50;const _0x19e85f=new Date()[_0x2d7869(0xe3)](),_0x2c5a76={};return!_0x30b451?(this[_0x2d7869(0xd6)]?(_0x2c5a76[constants_1[_0x2d7869(0xc0)]+'Branch__c']=this['branchId'],_0x2c5a76[constants_1['FLOSUM_NAMESPACE']+_0x2d7869(0xd4)]=_0x2d7869(0xb1),_0x2c5a76[_0x2d7869(0xa1)]=(_0x224b39=this[_0x2d7869(0x89)][_0x2d7869(0xe1)](_0x173984=>_0x173984[_0x2d7869(0xac)]===_0x2d7869(0xb1)))===null||_0x224b39===void 0x0?void 0x0:_0x224b39['id']):(_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0xa2)]=this[_0x2d7869(0xc6)],_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0xd4)]='Repository',_0x2c5a76[_0x2d7869(0xa1)]=(_0x19be50=this[_0x2d7869(0x89)][_0x2d7869(0xe1)](_0x5a6151=>_0x5a6151[_0x2d7869(0xac)]===_0x2d7869(0x8f)))===null||_0x19be50===void 0x0?void 0x0:_0x19be50['id']),_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0xa7)]=0x1):_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0xa7)]=_0x30b451[_0x2d7869(0xca)]+0x1,_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0xa3)]=_0x3821f0['type'],_0x2c5a76[constants_1['FLOSUM_NAMESPACE']+_0x2d7869(0xce)]=_0x3821f0[_0x2d7869(0xac)],_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0xa8)]=_0x3821f0['filePath'],_0x2c5a76[constants_1['FLOSUM_NAMESPACE']+_0x2d7869(0x7f)]=this['username'],_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0xcf)]=this['username'],_0x2c5a76[constants_1['FLOSUM_NAMESPACE']+_0x2d7869(0xd3)]=_0x19e85f,_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0xe4)]=_0x19e85f,_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0xbb)]=_0x3821f0['crc'],_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0xc7)]=_0x3821f0['vlocityComponentName'],_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0x86)]=_0x3821f0[_0x2d7869(0xe2)],_0x2c5a76[constants_1[_0x2d7869(0xc0)]+_0x2d7869(0xd5)]=_0x3821f0[_0x2d7869(0x9b)],_0x2c5a76;}[a272_0x5b7ba7(0x97)](){const _0x43b25e=a272_0x5b7ba7;return this[_0x43b25e(0xba)];}async[a272_0x5b7ba7(0xbc)](_0x3c3220,_0x3934ca){const _0x516d3e=a272_0x5b7ba7,_0x2c719b=[];for(const _0x310659 of _0x3c3220){const _0x49a453=(0x0,composite_utils_1[_0x516d3e(0xb6)])(constants_1['FLOSUM_COMPONENT'],this[_0x516d3e(0x95)](_0x310659)),_0x2e24b8=(0x0,composite_utils_1[_0x516d3e(0xb6)])(constants_1[_0x516d3e(0xd8)],this[_0x516d3e(0x8e)](_0x310659,'@{'+_0x49a453[_0x516d3e(0xbe)]+_0x516d3e(0xb8))),_0xfcdc0e=(0x0,composite_utils_1[_0x516d3e(0xb6)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x516d3e(0x93)](_0x310659,'@{'+_0x2e24b8['reference']+'.id}'));this[_0x516d3e(0xc1)](_0x49a453[_0x516d3e(0x92)][_0x516d3e(0xb7)],_0x49a453[_0x516d3e(0xbe)]),_0x2c719b[_0x516d3e(0x9f)](_0x49a453[_0x516d3e(0x92)],_0x2e24b8[_0x516d3e(0x92)],_0xfcdc0e['request']),_0x3934ca&&_0x2c719b[_0x516d3e(0x9f)](this[_0x516d3e(0x8b)](_0x3934ca,'@{'+_0x2e24b8['reference']+_0x516d3e(0xb8)));}return _0x2c719b;}async[a272_0x5b7ba7(0x7e)](_0x30431f,_0x1d717c=''){const _0x21df5b=a272_0x5b7ba7,_0x40e24d=[];for(const {component:_0x27c463,meta:_0x3a80d1}of _0x30431f){if(!_0x3a80d1['id']){const _0x10f069=this[_0x21df5b(0xba)][_0x21df5b(0xe1)](_0x5793de=>_0x5793de[_0x21df5b(0x81)]===_0x27c463[_0x21df5b(0xac)]&&_0x5793de['componentType']===_0x27c463['type']);if(!_0x10f069)throw new salesforce_error_1['SalesforceError'](new Error(_0x21df5b(0xc9)+_0x27c463[_0x21df5b(0xac)]+'\x20['+_0x27c463[_0x21df5b(0xb3)]+_0x21df5b(0x91)));_0x3a80d1['id']=_0x10f069['componentId'];}const _0x2ccf64=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x21df5b(0x8a)],_0x3a80d1['id'],this[_0x21df5b(0x95)](_0x27c463,_0x3a80d1)),_0x5e8cb3=(0x0,composite_utils_1[_0x21df5b(0xb6)])(constants_1[_0x21df5b(0xd8)],this['prepareComponentHistoryRecord'](_0x27c463,_0x3a80d1['id'],_0x3a80d1['version'])),_0x2a273a=(0x0,composite_utils_1[_0x21df5b(0xb6)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x21df5b(0x93)](_0x27c463,'@{'+_0x5e8cb3[_0x21df5b(0xbe)]+_0x21df5b(0xb8)));this['proceedComponentMeta'](_0x2ccf64[_0x21df5b(0x92)][_0x21df5b(0xb7)],_0x2ccf64[_0x21df5b(0xbe)]),_0x40e24d['push'](_0x2ccf64['request'],_0x5e8cb3[_0x21df5b(0x92)],_0x2a273a[_0x21df5b(0x92)]),_0x1d717c&&_0x40e24d[_0x21df5b(0x9f)](this[_0x21df5b(0x8b)](_0x1d717c,'@{'+_0x5e8cb3[_0x21df5b(0xbe)]+'.id}'));}return _0x40e24d;}async[a272_0x5b7ba7(0xaf)](_0x2cd3ef,_0xff3a2f=![]){const _0x31e66e=a272_0x5b7ba7,_0x8efc87={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x4f25fe=[];for(const _0x3f43d7 of _0x2cd3ef){if(_0x3f43d7['id'])_0x4f25fe[_0x31e66e(0x9f)](_0x3f43d7['id']);else{const _0x2ce837=this['proceededComponentsMeta'][_0x31e66e(0xe1)](_0x17c9ca=>_0x17c9ca[_0x31e66e(0x81)]===_0x3f43d7[_0x31e66e(0xac)]&&_0x17c9ca[_0x31e66e(0xc3)]===_0x3f43d7[_0x31e66e(0xb3)]);if(!_0x2ce837||!_0x2ce837[_0x31e66e(0xd0)])continue;_0x4f25fe[_0x31e66e(0x9f)](_0x2ce837[_0x31e66e(0xd0)]);}}if(_0xff3a2f){const _0x366b11=await this['gitSync']['fetchCommitManifestsByComponentIds'](_0x4f25fe);_0x8efc87[_0x31e66e(0xcb)]=_0x366b11[_0x31e66e(0xae)](_0x1d2d94=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x31e66e(0x98)],_0x1d2d94)[_0x31e66e(0x92)]);}return _0x8efc87[_0x31e66e(0x99)]=_0x4f25fe[_0x31e66e(0xae)](_0x4d6af2=>(0x0,composite_utils_1[_0x31e66e(0xa6)])(constants_1['FLOSUM_COMPONENT'],_0x4d6af2,{[constants_1[_0x31e66e(0xdd)]+_0x31e66e(0x9a)]:!![]})[_0x31e66e(0x92)]),_0x8efc87[_0x31e66e(0xe5)]=_0x4f25fe[_0x31e66e(0xae)](_0x2f5a40=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x31e66e(0x8a)],_0x2f5a40)['request']),_0x8efc87;}}exports[a272_0x5b7ba7(0x87)]=SalesforceComponentsManager;