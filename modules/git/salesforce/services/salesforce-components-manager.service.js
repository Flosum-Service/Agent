const a182_0x3328fe=a182_0x11ed;(function(_0x41a921,_0x4a7913){const _0x4ed49=a182_0x11ed,_0x54a52d=_0x41a921();while(!![]){try{const _0x1c7a1e=-parseInt(_0x4ed49(0x1ac))/0x1*(parseInt(_0x4ed49(0x1ce))/0x2)+parseInt(_0x4ed49(0x1ab))/0x3+parseInt(_0x4ed49(0x1b0))/0x4+parseInt(_0x4ed49(0x1c9))/0x5+-parseInt(_0x4ed49(0x1b4))/0x6+-parseInt(_0x4ed49(0x17d))/0x7*(parseInt(_0x4ed49(0x178))/0x8)+parseInt(_0x4ed49(0x175))/0x9;if(_0x1c7a1e===_0x4a7913)break;else _0x54a52d['push'](_0x54a52d['shift']());}catch(_0x490488){_0x54a52d['push'](_0x54a52d['shift']());}}}(a182_0x4aa5,0x4b670));const a182_0x3d4fd4=(function(){let _0x275b65=!![];return function(_0x201324,_0x54ab39){const _0x303adc=_0x275b65?function(){const _0x201925=a182_0x11ed;if(_0x54ab39){const _0x41bfe4=_0x54ab39[_0x201925(0x190)](_0x201324,arguments);return _0x54ab39=null,_0x41bfe4;}}:function(){};return _0x275b65=![],_0x303adc;};}()),a182_0x4ae14c=a182_0x3d4fd4(this,function(){const _0x14e83a=a182_0x11ed;return a182_0x4ae14c[_0x14e83a(0x1a3)]()[_0x14e83a(0x19d)](_0x14e83a(0x172))['toString']()[_0x14e83a(0x199)](a182_0x4ae14c)[_0x14e83a(0x19d)](_0x14e83a(0x172));});a182_0x4ae14c();'use strict';var __importDefault=this&&this[a182_0x3328fe(0x17c)]||function(_0x158f1a){const _0x3a670f=a182_0x3328fe;return _0x158f1a&&_0x158f1a[_0x3a670f(0x176)]?_0x158f1a:{'default':_0x158f1a};};Object[a182_0x3328fe(0x184)](exports,a182_0x3328fe(0x176),{'value':!![]}),exports[a182_0x3328fe(0x18a)]=void 0x0;function a182_0x11ed(_0x510b39,_0x216440){const _0x5da84b=a182_0x4aa5();return a182_0x11ed=function(_0x4ae14c,_0x3d4fd4){_0x4ae14c=_0x4ae14c-0x16b;let _0x4aa59f=_0x5da84b[_0x4ae14c];return _0x4aa59f;},a182_0x11ed(_0x510b39,_0x216440);}const constants_1=require(a182_0x3328fe(0x187)),core_1=require(a182_0x3328fe(0x18e)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a182_0x3328fe(0x1aa)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a182_0x3328fe(0x1af)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');function a182_0x4aa5(){const _0x564811=['extractFieldsFromRecord','proceedComponentMeta','find','FLOSUM_COMPONENT_HISTORY','reference','createDeleteRequest','type','Component_Name__c','2853760bgXPvW','fetchCommitManifestsByComponentIds','manifests','FLOSUM_GIT_NAMESPACE','toISOString','18TuxkFo','name','request','base64',']\x20-\x20meta\x20not\x20found','Zip','keys','map','componentType','(((.+)+)+)+$','FLOSUM_COMMIT_MANIFEST','Description','2210949TEfAHi','__esModule','Component_Type__c','1424992APZaYr','FLOSUM_NAMESPACE','Name','SalesforceError','__importDefault','14kRLbtn','Changed_On__c','Last_Updated_By__c','Could\x20not\x20proceed\x20component\x20','logger','repositoryId','Deletion_By_Agent__c','defineProperty','default','prepareComponentHistoryRecord','../../../../constants','RecordTypeId','componentId','SalesforceComponentsManager','Branch','gitSync','proceededComponentsMeta','../../../../core','componentName','apply','recordTypes','Body','application/zip','insert','getProceededComponentsMeta','files','.id}','createPostRequest','constructor','prepareCommitManifest','Last_Modified_By__c','branchId','search','version','get','DEFLATE','Repository__c','createPatchRequest','toString','FLOSUM_COMPONENT','Version__c','Commit__c','ParentId','prepareComponentAttachmentRecord','Component__c','../errors/salesforce.error','1829385xrChjb','55013SZyhxf','componentsToDelete','crc','../utils/flosum-naming.utils','1353488ZbMmnV','componentsToUpdate','Changed_By__c','CRC32__c','3626202OFGgPo','Source__c','generateAsync','Repository','SalesforceGitSyncService','username','update','prepareComponentRecord','FLOSUM_ATTACHMENT','filePath','push','Branch__c','Last_Modified_Date__c'];a182_0x4aa5=function(){return _0x564811;};return a182_0x4aa5();}class SalesforceComponentsManager{constructor(_0x57a991,_0x4c6108,_0x41f46a,_0x42af5a,_0x2757f5){const _0x23cf48=a182_0x3328fe;this[_0x23cf48(0x182)]=_0x57a991,this[_0x23cf48(0x19c)]=_0x4c6108,this[_0x23cf48(0x1b9)]=_0x41f46a,this[_0x23cf48(0x191)]=_0x42af5a,this[_0x23cf48(0x18d)]=_0x2757f5,this[_0x23cf48(0x181)]=new core_1['Logger'](SalesforceComponentsManager[_0x23cf48(0x1cf)]),this['gitSync']=typedi_1[_0x23cf48(0x185)][_0x23cf48(0x19f)](salesforce_git_sync_service_1[_0x23cf48(0x1b8)]);}[a182_0x3328fe(0x1c2)](_0x504784,_0x3d40f2){const _0x59c63e=a182_0x3328fe,_0x430a9a=flosum_naming_utils_1[_0x59c63e(0x1c1)](_0x504784,[_0x59c63e(0x177),_0x59c63e(0x1c8),_0x59c63e(0x1a5)]);this[_0x59c63e(0x18d)]['push']({'componentId':'','reference':_0x3d40f2,'version':_0x430a9a[_0x59c63e(0x1a5)],'componentName':_0x430a9a[_0x59c63e(0x1c8)],'componentType':_0x430a9a[_0x59c63e(0x177)]});}[a182_0x3328fe(0x19a)](_0x4e63f8,_0x3b58ec){const _0x406989=a182_0x3328fe,{request:_0xa54e81}=composite_utils_1['createPostRequest'](constants_1[_0x406989(0x173)],{[constants_1[_0x406989(0x179)]+_0x406989(0x1a6)]:_0x4e63f8,[constants_1[_0x406989(0x179)]+'Component_History__c']:_0x3b58ec});return _0xa54e81;}async[a182_0x3328fe(0x1a8)](_0xf844e1,_0x38f8aa){const _0x43e644=a182_0x3328fe,_0x40891e={},_0xb2fded=zip_1[_0x43e644(0x16e)]['createZip']();for(const _0xe86c6e of Object[_0x43e644(0x16f)](_0xf844e1[_0x43e644(0x196)])){_0xb2fded['file'](_0xe86c6e,_0xf844e1[_0x43e644(0x196)][_0xe86c6e],{'createFolders':!![]});}return _0x40891e['ContentType']=_0x43e644(0x193),_0x40891e[_0x43e644(0x17a)]=_0xf844e1[_0x43e644(0x1c7)],_0x40891e[_0x43e644(0x174)]=_0xf844e1['type'],_0x40891e[_0x43e644(0x1a7)]=_0x38f8aa,_0x40891e[_0x43e644(0x192)]=await _0xb2fded[_0x43e644(0x1b6)]({'type':_0x43e644(0x16c),'compression':_0x43e644(0x1a0),'compressionOptions':{'level':0x6}}),_0x40891e;}['prepareComponentHistoryRecord'](_0x3b43f1,_0x33a038,_0x649ef2){const _0x381ef5=a182_0x3328fe,_0xe917d0=new Date()['toISOString'](),_0x171ccf={};return _0x171ccf[constants_1[_0x381ef5(0x179)]+_0x381ef5(0x1a9)]=_0x33a038,_0x171ccf[constants_1['FLOSUM_NAMESPACE']+_0x381ef5(0x1b3)]=_0x3b43f1[_0x381ef5(0x1ae)],_0x171ccf[constants_1[_0x381ef5(0x179)]+_0x381ef5(0x17e)]=_0xe917d0,_0x171ccf[constants_1['FLOSUM_NAMESPACE']+_0x381ef5(0x1b2)]=this[_0x381ef5(0x1b9)],_0x171ccf[constants_1[_0x381ef5(0x179)]+'Version__c']=_0x649ef2?_0x649ef2+0x1:0x1,_0x171ccf[constants_1[_0x381ef5(0x1cc)]+'Is_From_Agent__c']=!![],_0x171ccf;}[a182_0x3328fe(0x1bb)](_0x1cab7b,_0x24a1d5){const _0x53bddd=a182_0x3328fe;var _0xf485d3,_0x12efdb;const _0x4a0245=new Date()[_0x53bddd(0x1cd)](),_0x80fbfd={};return!_0x24a1d5?(this[_0x53bddd(0x19c)]?(_0x80fbfd[constants_1['FLOSUM_NAMESPACE']+_0x53bddd(0x1bf)]=this['branchId'],_0x80fbfd[constants_1[_0x53bddd(0x179)]+_0x53bddd(0x1b5)]=_0x53bddd(0x18b),_0x80fbfd[_0x53bddd(0x188)]=(_0xf485d3=this[_0x53bddd(0x191)][_0x53bddd(0x1c3)](_0x3cc169=>_0x3cc169[_0x53bddd(0x1cf)]===_0x53bddd(0x18b)))===null||_0xf485d3===void 0x0?void 0x0:_0xf485d3['id']):(_0x80fbfd[constants_1['FLOSUM_NAMESPACE']+_0x53bddd(0x1a1)]=this[_0x53bddd(0x182)],_0x80fbfd[constants_1[_0x53bddd(0x179)]+_0x53bddd(0x1b5)]=_0x53bddd(0x1b7),_0x80fbfd[_0x53bddd(0x188)]=(_0x12efdb=this[_0x53bddd(0x191)]['find'](_0x183544=>_0x183544[_0x53bddd(0x1cf)]===_0x53bddd(0x1b7)))===null||_0x12efdb===void 0x0?void 0x0:_0x12efdb['id']),_0x80fbfd[constants_1[_0x53bddd(0x179)]+'Version__c']=0x1):_0x80fbfd[constants_1[_0x53bddd(0x179)]+_0x53bddd(0x1a5)]=_0x24a1d5[_0x53bddd(0x19e)]+0x1,_0x80fbfd[constants_1[_0x53bddd(0x179)]+_0x53bddd(0x177)]=_0x1cab7b[_0x53bddd(0x1c7)],_0x80fbfd[constants_1[_0x53bddd(0x179)]+_0x53bddd(0x1c8)]=_0x1cab7b['name'],_0x80fbfd[constants_1[_0x53bddd(0x179)]+'File_Name__c']=_0x1cab7b[_0x53bddd(0x1bd)],_0x80fbfd[constants_1['FLOSUM_NAMESPACE']+_0x53bddd(0x17f)]=this['username'],_0x80fbfd[constants_1[_0x53bddd(0x179)]+_0x53bddd(0x19b)]=this[_0x53bddd(0x1b9)],_0x80fbfd[constants_1[_0x53bddd(0x179)]+_0x53bddd(0x1c0)]=_0x4a0245,_0x80fbfd[constants_1['FLOSUM_NAMESPACE']+'Committed_On__c']=_0x4a0245,_0x80fbfd[constants_1[_0x53bddd(0x179)]+'CRC32__c']=_0x1cab7b[_0x53bddd(0x1ae)],_0x80fbfd;}[a182_0x3328fe(0x195)](){const _0x2371df=a182_0x3328fe;return this[_0x2371df(0x18d)];}async[a182_0x3328fe(0x194)](_0x35a5cc,_0x1a61d2){const _0x36093f=a182_0x3328fe,_0x2e7c08=[];for(const _0x27bbd1 of _0x35a5cc){const _0xc3402=composite_utils_1[_0x36093f(0x198)](constants_1['FLOSUM_COMPONENT'],this['prepareComponentRecord'](_0x27bbd1)),_0x201794=composite_utils_1[_0x36093f(0x198)](constants_1[_0x36093f(0x1c4)],this[_0x36093f(0x186)](_0x27bbd1,'@{'+_0xc3402['reference']+'.id}')),_0x3af023=composite_utils_1[_0x36093f(0x198)](constants_1[_0x36093f(0x1bc)],await this[_0x36093f(0x1a8)](_0x27bbd1,'@{'+_0x201794['reference']+_0x36093f(0x197)));this['proceedComponentMeta'](_0xc3402[_0x36093f(0x16b)]['body'],_0xc3402[_0x36093f(0x1c5)]),_0x2e7c08['push'](_0xc3402[_0x36093f(0x16b)],_0x201794[_0x36093f(0x16b)],_0x3af023['request']),_0x1a61d2&&_0x2e7c08[_0x36093f(0x1be)](this['prepareCommitManifest'](_0x1a61d2,'@{'+_0x201794[_0x36093f(0x1c5)]+_0x36093f(0x197)));}return _0x2e7c08;}async[a182_0x3328fe(0x1ba)](_0x3d9998,_0x456640=''){const _0x4df961=a182_0x3328fe,_0x5eca68=[];for(const {component:_0x5cea48,meta:_0x1618e9}of _0x3d9998){if(!_0x1618e9['id']){const _0x10d0a8=this[_0x4df961(0x18d)][_0x4df961(0x1c3)](_0xff36d4=>_0xff36d4[_0x4df961(0x18f)]===_0x5cea48['name']&&_0xff36d4[_0x4df961(0x171)]===_0x5cea48['type']);if(!_0x10d0a8)throw new salesforce_error_1[(_0x4df961(0x17b))](new Error(_0x4df961(0x180)+_0x5cea48[_0x4df961(0x1cf)]+'\x20['+_0x5cea48[_0x4df961(0x1c7)]+_0x4df961(0x16d)));_0x1618e9['id']=_0x10d0a8[_0x4df961(0x189)];}const _0x3f3fd9=composite_utils_1[_0x4df961(0x1a2)](constants_1[_0x4df961(0x1a4)],_0x1618e9['id'],this['prepareComponentRecord'](_0x5cea48,_0x1618e9)),_0x178cf3=composite_utils_1[_0x4df961(0x198)](constants_1[_0x4df961(0x1c4)],this[_0x4df961(0x186)](_0x5cea48,_0x1618e9['id'],_0x1618e9[_0x4df961(0x19e)])),_0x3f00bc=composite_utils_1[_0x4df961(0x198)](constants_1[_0x4df961(0x1bc)],await this[_0x4df961(0x1a8)](_0x5cea48,'@{'+_0x178cf3[_0x4df961(0x1c5)]+_0x4df961(0x197)));this['proceedComponentMeta'](_0x3f3fd9[_0x4df961(0x16b)]['body'],_0x3f3fd9[_0x4df961(0x1c5)]),_0x5eca68[_0x4df961(0x1be)](_0x3f3fd9['request'],_0x178cf3[_0x4df961(0x16b)],_0x3f00bc['request']),_0x456640&&_0x5eca68[_0x4df961(0x1be)](this['prepareCommitManifest'](_0x456640,'@{'+_0x178cf3[_0x4df961(0x1c5)]+'.id}'));}return _0x5eca68;}async['delete'](_0x3fdbe1,_0x4870dd=![]){const _0x206f97=a182_0x3328fe,_0x1554c5={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x323cdc=[];for(const _0x133a60 of _0x3fdbe1){if(_0x133a60['id'])_0x323cdc[_0x206f97(0x1be)](_0x133a60['id']);else{const _0x28ed60=this['proceededComponentsMeta'][_0x206f97(0x1c3)](_0x539388=>_0x539388['componentName']===_0x133a60['name']&&_0x539388[_0x206f97(0x171)]===_0x133a60[_0x206f97(0x1c7)]);if(!_0x28ed60||!_0x28ed60[_0x206f97(0x189)])continue;_0x323cdc['push'](_0x28ed60[_0x206f97(0x189)]);}}if(_0x4870dd){const _0x4c37f2=await this[_0x206f97(0x18c)][_0x206f97(0x1ca)](_0x323cdc);_0x1554c5[_0x206f97(0x1cb)]=_0x4c37f2[_0x206f97(0x170)](_0x172c75=>composite_utils_1[_0x206f97(0x1c6)](constants_1[_0x206f97(0x173)],_0x172c75)[_0x206f97(0x16b)]);}return _0x1554c5[_0x206f97(0x1b1)]=_0x323cdc[_0x206f97(0x170)](_0x22b17a=>composite_utils_1[_0x206f97(0x1a2)](constants_1[_0x206f97(0x1a4)],_0x22b17a,{[constants_1[_0x206f97(0x1cc)]+_0x206f97(0x183)]:!![]})[_0x206f97(0x16b)]),_0x1554c5[_0x206f97(0x1ad)]=_0x323cdc['map'](_0x1b04f0=>composite_utils_1['createDeleteRequest'](constants_1[_0x206f97(0x1a4)],_0x1b04f0)[_0x206f97(0x16b)]),_0x1554c5;}}exports[a182_0x3328fe(0x18a)]=SalesforceComponentsManager;