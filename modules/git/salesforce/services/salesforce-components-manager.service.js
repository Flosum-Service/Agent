const a271_0x3740eb=a271_0x90d9;(function(_0x33bbe5,_0x59d8ab){const _0x3e5b9f=a271_0x90d9,_0x3c5a68=_0x33bbe5();while(!![]){try{const _0x180e83=parseInt(_0x3e5b9f(0x23f))/0x1+-parseInt(_0x3e5b9f(0x1f8))/0x2*(-parseInt(_0x3e5b9f(0x1f2))/0x3)+-parseInt(_0x3e5b9f(0x1e5))/0x4+parseInt(_0x3e5b9f(0x1fd))/0x5*(-parseInt(_0x3e5b9f(0x1fe))/0x6)+parseInt(_0x3e5b9f(0x226))/0x7*(-parseInt(_0x3e5b9f(0x1f7))/0x8)+-parseInt(_0x3e5b9f(0x217))/0x9+-parseInt(_0x3e5b9f(0x231))/0xa*(-parseInt(_0x3e5b9f(0x1e8))/0xb);if(_0x180e83===_0x59d8ab)break;else _0x3c5a68['push'](_0x3c5a68['shift']());}catch(_0x1e5f7e){_0x3c5a68['push'](_0x3c5a68['shift']());}}}(a271_0x1567,0xe3275));const a271_0x44f614=(function(){let _0x5070f6=!![];return function(_0x141456,_0x445168){const _0x432fa0=_0x5070f6?function(){const _0x4a787a=a271_0x90d9;if(_0x445168){const _0x11c8d2=_0x445168[_0x4a787a(0x219)](_0x141456,arguments);return _0x445168=null,_0x11c8d2;}}:function(){};return _0x5070f6=![],_0x432fa0;};}()),a271_0x128dde=a271_0x44f614(this,function(){const _0x4838d0=a271_0x90d9;return a271_0x128dde[_0x4838d0(0x208)]()[_0x4838d0(0x232)](_0x4838d0(0x229))[_0x4838d0(0x208)]()[_0x4838d0(0x1e2)](a271_0x128dde)['search']('(((.+)+)+)+$');});a271_0x128dde();function a271_0x90d9(_0x583781,_0x5aba09){const _0x44189a=a271_0x1567();return a271_0x90d9=function(_0x128dde,_0x44f614){_0x128dde=_0x128dde-0x1db;let _0x156715=_0x44189a[_0x128dde];return _0x156715;},a271_0x90d9(_0x583781,_0x5aba09);}'use strict';var __importDefault=this&&this[a271_0x3740eb(0x212)]||function(_0x1a14e4){const _0x2f03df=a271_0x3740eb;return _0x1a14e4&&_0x1a14e4[_0x2f03df(0x1ee)]?_0x1a14e4:{'default':_0x1a14e4};};Object[a271_0x3740eb(0x1fb)](exports,a271_0x3740eb(0x1ee),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a271_0x3740eb(0x1eb)),core_1=require(a271_0x3740eb(0x211)),zip_1=require(a271_0x3740eb(0x1e0)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a271_0x3740eb(0x218)),composite_utils_1=require(a271_0x3740eb(0x227)),flosum_naming_utils_1=require(a271_0x3740eb(0x22a)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x4f097a,_0x5e4fdb,_0x247e42,_0x3fec29,_0x26e6e7){const _0x3ae777=a271_0x3740eb;this[_0x3ae777(0x213)]=_0x4f097a,this[_0x3ae777(0x1ec)]=_0x5e4fdb,this[_0x3ae777(0x1dc)]=_0x247e42,this[_0x3ae777(0x228)]=_0x3fec29,this[_0x3ae777(0x238)]=_0x26e6e7,this['logger']=new core_1['Logger'](SalesforceComponentsManager[_0x3ae777(0x23c)]),this[_0x3ae777(0x22f)]=typedi_1[_0x3ae777(0x1f0)][_0x3ae777(0x21a)](salesforce_git_sync_service_1[_0x3ae777(0x1ed)]);}[a271_0x3740eb(0x237)](_0x27cb09,_0x66a52c){const _0x1d76ba=a271_0x3740eb,_0x3d39f1=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x27cb09,[_0x1d76ba(0x240),'Component_Name__c',_0x1d76ba(0x1ea)]);this[_0x1d76ba(0x238)]['push']({'componentId':'','reference':_0x66a52c,'version':_0x3d39f1['Version__c'],'componentName':_0x3d39f1[_0x1d76ba(0x1f9)],'componentType':_0x3d39f1[_0x1d76ba(0x240)]});}[a271_0x3740eb(0x21f)](_0x3983d4,_0x546045){const _0xa91326=a271_0x3740eb,{request:_0x32c499}=(0x0,composite_utils_1[_0xa91326(0x21b)])(constants_1[_0xa91326(0x201)],{[constants_1[_0xa91326(0x207)]+_0xa91326(0x1fc)]:_0x3983d4,[constants_1[_0xa91326(0x207)]+_0xa91326(0x1e7)]:_0x546045});return _0x32c499;}async[a271_0x3740eb(0x203)](_0x1a867d,_0x242edd){const _0x563e48=a271_0x3740eb,_0x1c3280={},_0x5e78a1=zip_1[_0x563e48(0x1fa)][_0x563e48(0x23a)]();for(const _0xf6934e of Object[_0x563e48(0x20e)](_0x1a867d[_0x563e48(0x21c)])){_0x5e78a1['file'](_0xf6934e,_0x1a867d[_0x563e48(0x21c)][_0xf6934e],{'createFolders':!![]});}return _0x1c3280[_0x563e48(0x1ff)]='application/zip',_0x1c3280['Name']=_0x1a867d[_0x563e48(0x1f5)],_0x1c3280[_0x563e48(0x216)]=_0x1a867d[_0x563e48(0x1f5)],_0x1c3280[_0x563e48(0x204)]=_0x242edd,_0x1c3280['Body']=await _0x5e78a1[_0x563e48(0x1df)]({'type':_0x563e48(0x20c),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x1c3280;}['prepareComponentHistoryRecord'](_0x5320c4,_0x201895,_0x61f148){const _0x3d4c85=a271_0x3740eb,_0x5a4925=new Date()[_0x3d4c85(0x22c)](),_0x433fa2={};return _0x433fa2[constants_1[_0x3d4c85(0x207)]+_0x3d4c85(0x202)]=_0x201895,_0x433fa2[constants_1[_0x3d4c85(0x207)]+_0x3d4c85(0x236)]=_0x5320c4[_0x3d4c85(0x205)],_0x433fa2[constants_1[_0x3d4c85(0x207)]+_0x3d4c85(0x1f6)]=_0x5a4925,_0x433fa2[constants_1[_0x3d4c85(0x207)]+_0x3d4c85(0x1e3)]=this['username'],_0x433fa2[constants_1[_0x3d4c85(0x207)]+'Version__c']=_0x61f148?_0x61f148+0x1:0x1,_0x433fa2[constants_1[_0x3d4c85(0x1e1)]+_0x3d4c85(0x23d)]=!![],_0x433fa2;}[a271_0x3740eb(0x21d)](_0xd96119,_0x28d4b5){const _0x1b4a78=a271_0x3740eb;var _0x4444a9,_0xc9ff6a;const _0x4b7fe3=new Date()[_0x1b4a78(0x22c)](),_0x5eb8e6={};return!_0x28d4b5?(this['branchId']?(_0x5eb8e6[constants_1['FLOSUM_NAMESPACE']+_0x1b4a78(0x200)]=this[_0x1b4a78(0x1ec)],_0x5eb8e6[constants_1['FLOSUM_NAMESPACE']+_0x1b4a78(0x223)]=_0x1b4a78(0x224),_0x5eb8e6['RecordTypeId']=(_0x4444a9=this[_0x1b4a78(0x228)][_0x1b4a78(0x225)](_0x1af5cc=>_0x1af5cc['name']===_0x1b4a78(0x224)))===null||_0x4444a9===void 0x0?void 0x0:_0x4444a9['id']):(_0x5eb8e6[constants_1['FLOSUM_NAMESPACE']+'Repository__c']=this[_0x1b4a78(0x213)],_0x5eb8e6[constants_1['FLOSUM_NAMESPACE']+'Source__c']=_0x1b4a78(0x20d),_0x5eb8e6['RecordTypeId']=(_0xc9ff6a=this[_0x1b4a78(0x228)][_0x1b4a78(0x225)](_0x298a64=>_0x298a64[_0x1b4a78(0x23c)]===_0x1b4a78(0x20d)))===null||_0xc9ff6a===void 0x0?void 0x0:_0xc9ff6a['id']),_0x5eb8e6[constants_1['FLOSUM_NAMESPACE']+_0x1b4a78(0x1ea)]=0x1):_0x5eb8e6[constants_1[_0x1b4a78(0x207)]+'Version__c']=_0x28d4b5['version']+0x1,_0x5eb8e6[constants_1[_0x1b4a78(0x207)]+_0x1b4a78(0x240)]=_0xd96119[_0x1b4a78(0x1f5)],_0x5eb8e6[constants_1['FLOSUM_NAMESPACE']+_0x1b4a78(0x1f9)]=_0xd96119[_0x1b4a78(0x23c)],_0x5eb8e6[constants_1[_0x1b4a78(0x207)]+_0x1b4a78(0x206)]=_0xd96119[_0x1b4a78(0x1e9)],_0x5eb8e6[constants_1['FLOSUM_NAMESPACE']+_0x1b4a78(0x22d)]=this[_0x1b4a78(0x1dc)],_0x5eb8e6[constants_1[_0x1b4a78(0x207)]+'Last_Modified_By__c']=this[_0x1b4a78(0x1dc)],_0x5eb8e6[constants_1[_0x1b4a78(0x207)]+'Last_Modified_Date__c']=_0x4b7fe3,_0x5eb8e6[constants_1[_0x1b4a78(0x207)]+_0x1b4a78(0x1f3)]=_0x4b7fe3,_0x5eb8e6[constants_1['FLOSUM_NAMESPACE']+_0x1b4a78(0x236)]=_0xd96119[_0x1b4a78(0x205)],_0x5eb8e6[constants_1[_0x1b4a78(0x207)]+_0x1b4a78(0x220)]=_0xd96119[_0x1b4a78(0x1f4)],_0x5eb8e6[constants_1[_0x1b4a78(0x207)]+_0x1b4a78(0x1dd)]=_0xd96119[_0x1b4a78(0x235)],_0x5eb8e6[constants_1[_0x1b4a78(0x207)]+'MC_Key__c']=_0xd96119[_0x1b4a78(0x20a)],_0x5eb8e6;}[a271_0x3740eb(0x20f)](){const _0x1d16e6=a271_0x3740eb;return this[_0x1d16e6(0x238)];}async[a271_0x3740eb(0x222)](_0x886e1b,_0x1ff112){const _0x103def=a271_0x3740eb,_0x49769e=[];for(const _0x37fdf0 of _0x886e1b){const _0x57fbee=(0x0,composite_utils_1[_0x103def(0x21b)])(constants_1['FLOSUM_COMPONENT'],this['prepareComponentRecord'](_0x37fdf0)),_0x3f27f7=(0x0,composite_utils_1[_0x103def(0x21b)])(constants_1[_0x103def(0x209)],this[_0x103def(0x22e)](_0x37fdf0,'@{'+_0x57fbee['reference']+_0x103def(0x233))),_0xd82046=(0x0,composite_utils_1[_0x103def(0x21b)])(constants_1[_0x103def(0x239)],await this[_0x103def(0x203)](_0x37fdf0,'@{'+_0x3f27f7['reference']+'.id}'));this[_0x103def(0x237)](_0x57fbee[_0x103def(0x23b)][_0x103def(0x23e)],_0x57fbee[_0x103def(0x234)]),_0x49769e[_0x103def(0x221)](_0x57fbee[_0x103def(0x23b)],_0x3f27f7[_0x103def(0x23b)],_0xd82046[_0x103def(0x23b)]),_0x1ff112&&_0x49769e['push'](this[_0x103def(0x21f)](_0x1ff112,'@{'+_0x3f27f7[_0x103def(0x234)]+'.id}'));}return _0x49769e;}async[a271_0x3740eb(0x210)](_0x79f689,_0x43934d=''){const _0x3be637=a271_0x3740eb,_0x53e127=[];for(const {component:_0x396be6,meta:_0x1316f6}of _0x79f689){if(!_0x1316f6['id']){const _0x158caf=this[_0x3be637(0x238)]['find'](_0x468183=>_0x468183['componentName']===_0x396be6[_0x3be637(0x23c)]&&_0x468183['componentType']===_0x396be6['type']);if(!_0x158caf)throw new salesforce_error_1[(_0x3be637(0x230))](new Error(_0x3be637(0x1de)+_0x396be6[_0x3be637(0x23c)]+'\x20['+_0x396be6[_0x3be637(0x1f5)]+']\x20-\x20meta\x20not\x20found'));_0x1316f6['id']=_0x158caf['componentId'];}const _0x40e876=(0x0,composite_utils_1[_0x3be637(0x1f1)])(constants_1['FLOSUM_COMPONENT'],_0x1316f6['id'],this[_0x3be637(0x21d)](_0x396be6,_0x1316f6)),_0x480903=(0x0,composite_utils_1[_0x3be637(0x21b)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x3be637(0x22e)](_0x396be6,_0x1316f6['id'],_0x1316f6['version'])),_0x28caef=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x3be637(0x239)],await this['prepareComponentAttachmentRecord'](_0x396be6,'@{'+_0x480903[_0x3be637(0x234)]+_0x3be637(0x233)));this['proceedComponentMeta'](_0x40e876[_0x3be637(0x23b)][_0x3be637(0x23e)],_0x40e876[_0x3be637(0x234)]),_0x53e127[_0x3be637(0x221)](_0x40e876['request'],_0x480903['request'],_0x28caef[_0x3be637(0x23b)]),_0x43934d&&_0x53e127['push'](this[_0x3be637(0x21f)](_0x43934d,'@{'+_0x480903[_0x3be637(0x234)]+_0x3be637(0x233)));}return _0x53e127;}async[a271_0x3740eb(0x215)](_0x2ada8e,_0x478fc4=![]){const _0x25f707=a271_0x3740eb,_0x5a2c2b={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x3fbf12=[];for(const _0x7676db of _0x2ada8e){if(_0x7676db['id'])_0x3fbf12[_0x25f707(0x221)](_0x7676db['id']);else{const _0x21bab2=this[_0x25f707(0x238)]['find'](_0x49d3f4=>_0x49d3f4['componentName']===_0x7676db['name']&&_0x49d3f4[_0x25f707(0x22b)]===_0x7676db[_0x25f707(0x1f5)]);if(!_0x21bab2||!_0x21bab2[_0x25f707(0x1ef)])continue;_0x3fbf12['push'](_0x21bab2[_0x25f707(0x1ef)]);}}if(_0x478fc4){const _0x89d04d=await this[_0x25f707(0x22f)][_0x25f707(0x21e)](_0x3fbf12);_0x5a2c2b['manifests']=_0x89d04d['map'](_0xa17017=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0xa17017)[_0x25f707(0x23b)]);}return _0x5a2c2b[_0x25f707(0x1db)]=_0x3fbf12[_0x25f707(0x214)](_0x3c3e7f=>(0x0,composite_utils_1[_0x25f707(0x1f1)])(constants_1[_0x25f707(0x20b)],_0x3c3e7f,{[constants_1['FLOSUM_GIT_NAMESPACE']+'Deletion_By_Agent__c']:!![]})[_0x25f707(0x23b)]),_0x5a2c2b['componentsToDelete']=_0x3fbf12[_0x25f707(0x214)](_0xb425d3=>(0x0,composite_utils_1[_0x25f707(0x1e4)])(constants_1[_0x25f707(0x20b)],_0xb425d3)[_0x25f707(0x23b)]),_0x5a2c2b;}}exports[a271_0x3740eb(0x1e6)]=SalesforceComponentsManager;function a271_0x1567(){const _0x3106ee=['Could\x20not\x20proceed\x20component\x20','generateAsync','../../parsers/utils/zip','FLOSUM_GIT_NAMESPACE','constructor','Changed_By__c','createDeleteRequest','4866260VcbKMH','SalesforceComponentsManager','Component_History__c','37960549kRYpCU','filePath','Version__c','../../../../constants','branchId','SalesforceGitSyncService','__esModule','componentId','default','createPatchRequest','1578921WCENeM','Committed_On__c','vlocityComponentName','type','Changed_On__c','8iltPHZ','2mArHZI','Component_Name__c','Zip','defineProperty','Commit__c','446165VEpkPP','96ZLHmQq','ContentType','Branch__c','FLOSUM_COMMIT_MANIFEST','Component__c','prepareComponentAttachmentRecord','ParentId','crc','File_Name__c','FLOSUM_NAMESPACE','toString','FLOSUM_COMPONENT_HISTORY','marketingCloudKey','FLOSUM_COMPONENT','base64','Repository','keys','getProceededComponentsMeta','update','../../../../core','__importDefault','repositoryId','map','delete','Description','554067uBafNv','../errors/salesforce.error','apply','get','createPostRequest','files','prepareComponentRecord','fetchCommitManifestsByComponentIds','prepareCommitManifest','Vlocity_Component_Name__c','push','insert','Source__c','Branch','find','4984945vKkdGs','../utils/composite.utils','recordTypes','(((.+)+)+)+$','../utils/flosum-naming.utils','componentType','toISOString','Last_Updated_By__c','prepareComponentHistoryRecord','gitSync','SalesforceError','10ZFmCYi','search','.id}','reference','isVlocityComponent','CRC32__c','proceedComponentMeta','proceededComponentsMeta','FLOSUM_ATTACHMENT','createZip','request','name','Is_From_Agent__c','body','371146QMirEs','Component_Type__c','componentsToUpdate','username','Vlocity_Component__c'];a271_0x1567=function(){return _0x3106ee;};return a271_0x1567();}