const a229_0x12c57f=a229_0xc726;function a229_0xc726(_0x337d5c,_0x22d7d0){const _0x351044=a229_0x267c();return a229_0xc726=function(_0xa620e1,_0xf2f74b){_0xa620e1=_0xa620e1-0x125;let _0x267c46=_0x351044[_0xa620e1];return _0x267c46;},a229_0xc726(_0x337d5c,_0x22d7d0);}(function(_0x36c801,_0x3d6af0){const _0x1ade93=a229_0xc726,_0x2efbc1=_0x36c801();while(!![]){try{const _0x470202=parseInt(_0x1ade93(0x16d))/0x1+-parseInt(_0x1ade93(0x151))/0x2*(parseInt(_0x1ade93(0x14d))/0x3)+parseInt(_0x1ade93(0x145))/0x4+parseInt(_0x1ade93(0x15c))/0x5+parseInt(_0x1ade93(0x133))/0x6*(-parseInt(_0x1ade93(0x142))/0x7)+-parseInt(_0x1ade93(0x14b))/0x8+-parseInt(_0x1ade93(0x128))/0x9*(-parseInt(_0x1ade93(0x17d))/0xa);if(_0x470202===_0x3d6af0)break;else _0x2efbc1['push'](_0x2efbc1['shift']());}catch(_0x238565){_0x2efbc1['push'](_0x2efbc1['shift']());}}}(a229_0x267c,0xdba65));const a229_0xf2f74b=(function(){let _0x43c22d=!![];return function(_0x5ccbf1,_0x454151){const _0x205003=_0x43c22d?function(){if(_0x454151){const _0x236b00=_0x454151['apply'](_0x5ccbf1,arguments);return _0x454151=null,_0x236b00;}}:function(){};return _0x43c22d=![],_0x205003;};}()),a229_0xa620e1=a229_0xf2f74b(this,function(){const _0x45c8f1=a229_0xc726;return a229_0xa620e1[_0x45c8f1(0x140)]()[_0x45c8f1(0x14a)](_0x45c8f1(0x178))[_0x45c8f1(0x140)]()[_0x45c8f1(0x155)](a229_0xa620e1)[_0x45c8f1(0x14a)](_0x45c8f1(0x178));});a229_0xa620e1();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3016f2){return _0x3016f2&&_0x3016f2['__esModule']?_0x3016f2:{'default':_0x3016f2};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;function a229_0x267c(){const _0x3f4b03=['Last_Modified_By__c','generateAsync','componentType','Branch','.id}','9RWRKVK','repositoryId','../../parsers/utils/zip','Changed_By__c','FLOSUM_ATTACHMENT','RecordTypeId','type','files','fetchCommitManifestsByComponentIds','Name','find','8725134DSkjZO','getProceededComponentsMeta','Component__c','Body','prepareComponentHistoryRecord','DEFLATE','gitSync','ContentType','Repository','username','proceedComponentMeta','Source__c','SalesforceComponentsManager','toString','Changed_On__c','7xYYEjg','update','../../../../constants','3336032junByg','prepareComponentRecord','recordTypes','application/zip','version','search','13679960VOVpXX','FLOSUM_COMMIT_MANIFEST','5315865Cnrfah','reference','CRC32__c','ParentId','2AaEcBG','createPatchRequest','file','FLOSUM_GIT_NAMESPACE','constructor','logger','Last_Modified_Date__c','SalesforceError','componentName','prepareComponentAttachmentRecord','push','6744515kFEtNq','Committed_On__c','request','Branch__c','manifests','FLOSUM_NAMESPACE','componentsToDelete','Description','Repository__c','Component_Name__c','FLOSUM_COMPONENT','../utils/flosum-naming.utils','get','componentsToUpdate','default','branchId','insert','43210fTsvdN','createPostRequest','crc','proceededComponentsMeta','Version__c','FLOSUM_COMPONENT_HISTORY','extractFieldsFromRecord','createZip','componentId','body','prepareCommitManifest','(((.+)+)+)+$','base64',']\x20-\x20meta\x20not\x20found','toISOString','Could\x20not\x20proceed\x20component\x20','36097030OOJVkJ','Is_From_Agent__c','Component_Type__c','Logger','createDeleteRequest','../errors/salesforce.error','name'];a229_0x267c=function(){return _0x3f4b03;};return a229_0x267c();}const constants_1=require(a229_0x12c57f(0x144)),core_1=require('../../../../core'),zip_1=require(a229_0x12c57f(0x12a)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a229_0x12c57f(0x182)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a229_0x12c57f(0x167)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x2ce630,_0x47437d,_0x334b6a,_0xc1155e,_0x5e872f){const _0x21a0f5=a229_0x12c57f;this[_0x21a0f5(0x129)]=_0x2ce630,this[_0x21a0f5(0x16b)]=_0x47437d,this['username']=_0x334b6a,this[_0x21a0f5(0x147)]=_0xc1155e,this['proceededComponentsMeta']=_0x5e872f,this[_0x21a0f5(0x156)]=new core_1[(_0x21a0f5(0x180))](SalesforceComponentsManager[_0x21a0f5(0x183)]),this[_0x21a0f5(0x139)]=typedi_1[_0x21a0f5(0x16a)][_0x21a0f5(0x168)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a229_0x12c57f(0x13d)](_0x4f6fb7,_0x1e287d){const _0xa356bc=a229_0x12c57f,_0x311a59=(0x0,flosum_naming_utils_1[_0xa356bc(0x173)])(_0x4f6fb7,[_0xa356bc(0x17f),_0xa356bc(0x165),_0xa356bc(0x171)]);this[_0xa356bc(0x170)][_0xa356bc(0x15b)]({'componentId':'','reference':_0x1e287d,'version':_0x311a59['Version__c'],'componentName':_0x311a59['Component_Name__c'],'componentType':_0x311a59[_0xa356bc(0x17f)]});}[a229_0x12c57f(0x177)](_0x22eb8c,_0x1bc76e){const _0x1bcc35=a229_0x12c57f,{request:_0x13bb2e}=(0x0,composite_utils_1[_0x1bcc35(0x16e)])(constants_1[_0x1bcc35(0x14c)],{[constants_1[_0x1bcc35(0x161)]+'Commit__c']:_0x22eb8c,[constants_1['FLOSUM_NAMESPACE']+'Component_History__c']:_0x1bc76e});return _0x13bb2e;}async[a229_0x12c57f(0x15a)](_0x1a2938,_0x3df908){const _0x12ed44=a229_0x12c57f,_0x4119d4={},_0x3a70f7=zip_1['Zip'][_0x12ed44(0x174)]();for(const _0x42df05 of Object['keys'](_0x1a2938[_0x12ed44(0x12f)])){_0x3a70f7[_0x12ed44(0x153)](_0x42df05,_0x1a2938['files'][_0x42df05],{'createFolders':!![]});}return _0x4119d4[_0x12ed44(0x13a)]=_0x12ed44(0x148),_0x4119d4[_0x12ed44(0x131)]=_0x1a2938[_0x12ed44(0x12e)],_0x4119d4[_0x12ed44(0x163)]=_0x1a2938[_0x12ed44(0x12e)],_0x4119d4[_0x12ed44(0x150)]=_0x3df908,_0x4119d4[_0x12ed44(0x136)]=await _0x3a70f7[_0x12ed44(0x185)]({'type':_0x12ed44(0x179),'compression':_0x12ed44(0x138),'compressionOptions':{'level':0x6}}),_0x4119d4;}[a229_0x12c57f(0x137)](_0x2bba04,_0x2ebcc1,_0x10d2f7){const _0x223101=a229_0x12c57f,_0x535132=new Date()['toISOString'](),_0x3f1775={};return _0x3f1775[constants_1['FLOSUM_NAMESPACE']+_0x223101(0x135)]=_0x2ebcc1,_0x3f1775[constants_1[_0x223101(0x161)]+'CRC32__c']=_0x2bba04[_0x223101(0x16f)],_0x3f1775[constants_1[_0x223101(0x161)]+_0x223101(0x141)]=_0x535132,_0x3f1775[constants_1[_0x223101(0x161)]+_0x223101(0x12b)]=this['username'],_0x3f1775[constants_1['FLOSUM_NAMESPACE']+_0x223101(0x171)]=_0x10d2f7?_0x10d2f7+0x1:0x1,_0x3f1775[constants_1[_0x223101(0x154)]+_0x223101(0x17e)]=!![],_0x3f1775;}[a229_0x12c57f(0x146)](_0x3ebf9f,_0x53d62b){const _0x11673b=a229_0x12c57f;var _0x4dd1ab,_0x5d17c0;const _0x3de5aa=new Date()[_0x11673b(0x17b)](),_0x238355={};return!_0x53d62b?(this[_0x11673b(0x16b)]?(_0x238355[constants_1[_0x11673b(0x161)]+_0x11673b(0x15f)]=this['branchId'],_0x238355[constants_1[_0x11673b(0x161)]+_0x11673b(0x13e)]=_0x11673b(0x126),_0x238355[_0x11673b(0x12d)]=(_0x4dd1ab=this[_0x11673b(0x147)][_0x11673b(0x132)](_0x2e3f26=>_0x2e3f26[_0x11673b(0x183)]===_0x11673b(0x126)))===null||_0x4dd1ab===void 0x0?void 0x0:_0x4dd1ab['id']):(_0x238355[constants_1[_0x11673b(0x161)]+_0x11673b(0x164)]=this[_0x11673b(0x129)],_0x238355[constants_1[_0x11673b(0x161)]+'Source__c']=_0x11673b(0x13b),_0x238355[_0x11673b(0x12d)]=(_0x5d17c0=this[_0x11673b(0x147)]['find'](_0x1e5ed6=>_0x1e5ed6[_0x11673b(0x183)]===_0x11673b(0x13b)))===null||_0x5d17c0===void 0x0?void 0x0:_0x5d17c0['id']),_0x238355[constants_1[_0x11673b(0x161)]+'Version__c']=0x1):_0x238355[constants_1[_0x11673b(0x161)]+_0x11673b(0x171)]=_0x53d62b[_0x11673b(0x149)]+0x1,_0x238355[constants_1[_0x11673b(0x161)]+_0x11673b(0x17f)]=_0x3ebf9f[_0x11673b(0x12e)],_0x238355[constants_1[_0x11673b(0x161)]+_0x11673b(0x165)]=_0x3ebf9f[_0x11673b(0x183)],_0x238355[constants_1['FLOSUM_NAMESPACE']+'File_Name__c']=_0x3ebf9f['filePath'],_0x238355[constants_1[_0x11673b(0x161)]+'Last_Updated_By__c']=this[_0x11673b(0x13c)],_0x238355[constants_1[_0x11673b(0x161)]+_0x11673b(0x184)]=this['username'],_0x238355[constants_1['FLOSUM_NAMESPACE']+_0x11673b(0x157)]=_0x3de5aa,_0x238355[constants_1[_0x11673b(0x161)]+_0x11673b(0x15d)]=_0x3de5aa,_0x238355[constants_1[_0x11673b(0x161)]+_0x11673b(0x14f)]=_0x3ebf9f[_0x11673b(0x16f)],_0x238355;}[a229_0x12c57f(0x134)](){const _0x3e1d97=a229_0x12c57f;return this[_0x3e1d97(0x170)];}async[a229_0x12c57f(0x16c)](_0x3d83d0,_0x2141fb){const _0x250c38=a229_0x12c57f,_0x39394e=[];for(const _0x5cc6df of _0x3d83d0){const _0x2c8072=(0x0,composite_utils_1[_0x250c38(0x16e)])(constants_1[_0x250c38(0x166)],this[_0x250c38(0x146)](_0x5cc6df)),_0x407adf=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x250c38(0x172)],this[_0x250c38(0x137)](_0x5cc6df,'@{'+_0x2c8072['reference']+_0x250c38(0x127))),_0x3c52da=(0x0,composite_utils_1[_0x250c38(0x16e)])(constants_1[_0x250c38(0x12c)],await this[_0x250c38(0x15a)](_0x5cc6df,'@{'+_0x407adf[_0x250c38(0x14e)]+_0x250c38(0x127)));this['proceedComponentMeta'](_0x2c8072[_0x250c38(0x15e)][_0x250c38(0x176)],_0x2c8072[_0x250c38(0x14e)]),_0x39394e[_0x250c38(0x15b)](_0x2c8072[_0x250c38(0x15e)],_0x407adf[_0x250c38(0x15e)],_0x3c52da[_0x250c38(0x15e)]),_0x2141fb&&_0x39394e[_0x250c38(0x15b)](this['prepareCommitManifest'](_0x2141fb,'@{'+_0x407adf[_0x250c38(0x14e)]+_0x250c38(0x127)));}return _0x39394e;}async[a229_0x12c57f(0x143)](_0x4bdd60,_0x3287b5=''){const _0xb33956=a229_0x12c57f,_0x5c4df1=[];for(const {component:_0x2d329f,meta:_0x37613c}of _0x4bdd60){if(!_0x37613c['id']){const _0x5e2d96=this[_0xb33956(0x170)]['find'](_0x5c537f=>_0x5c537f[_0xb33956(0x159)]===_0x2d329f[_0xb33956(0x183)]&&_0x5c537f[_0xb33956(0x125)]===_0x2d329f[_0xb33956(0x12e)]);if(!_0x5e2d96)throw new salesforce_error_1[(_0xb33956(0x158))](new Error(_0xb33956(0x17c)+_0x2d329f[_0xb33956(0x183)]+'\x20['+_0x2d329f[_0xb33956(0x12e)]+_0xb33956(0x17a)));_0x37613c['id']=_0x5e2d96[_0xb33956(0x175)];}const _0x305027=(0x0,composite_utils_1[_0xb33956(0x152)])(constants_1[_0xb33956(0x166)],_0x37613c['id'],this['prepareComponentRecord'](_0x2d329f,_0x37613c)),_0x195bac=(0x0,composite_utils_1[_0xb33956(0x16e)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0xb33956(0x137)](_0x2d329f,_0x37613c['id'],_0x37613c[_0xb33956(0x149)])),_0x2c9128=(0x0,composite_utils_1[_0xb33956(0x16e)])(constants_1['FLOSUM_ATTACHMENT'],await this['prepareComponentAttachmentRecord'](_0x2d329f,'@{'+_0x195bac['reference']+_0xb33956(0x127)));this[_0xb33956(0x13d)](_0x305027['request'][_0xb33956(0x176)],_0x305027['reference']),_0x5c4df1[_0xb33956(0x15b)](_0x305027[_0xb33956(0x15e)],_0x195bac[_0xb33956(0x15e)],_0x2c9128[_0xb33956(0x15e)]),_0x3287b5&&_0x5c4df1[_0xb33956(0x15b)](this[_0xb33956(0x177)](_0x3287b5,'@{'+_0x195bac[_0xb33956(0x14e)]+_0xb33956(0x127)));}return _0x5c4df1;}async['delete'](_0x553cb1,_0x215c94=![]){const _0x4b6a74=a229_0x12c57f,_0x26d04d={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x16d008=[];for(const _0x142a44 of _0x553cb1){if(_0x142a44['id'])_0x16d008['push'](_0x142a44['id']);else{const _0x34287c=this[_0x4b6a74(0x170)][_0x4b6a74(0x132)](_0x4bf6f1=>_0x4bf6f1['componentName']===_0x142a44[_0x4b6a74(0x183)]&&_0x4bf6f1[_0x4b6a74(0x125)]===_0x142a44['type']);if(!_0x34287c||!_0x34287c['componentId'])continue;_0x16d008[_0x4b6a74(0x15b)](_0x34287c[_0x4b6a74(0x175)]);}}if(_0x215c94){const _0x392261=await this['gitSync'][_0x4b6a74(0x130)](_0x16d008);_0x26d04d[_0x4b6a74(0x160)]=_0x392261['map'](_0x5ccc21=>(0x0,composite_utils_1[_0x4b6a74(0x181)])(constants_1[_0x4b6a74(0x14c)],_0x5ccc21)[_0x4b6a74(0x15e)]);}return _0x26d04d[_0x4b6a74(0x169)]=_0x16d008['map'](_0x1f94fb=>(0x0,composite_utils_1[_0x4b6a74(0x152)])(constants_1[_0x4b6a74(0x166)],_0x1f94fb,{[constants_1['FLOSUM_GIT_NAMESPACE']+'Deletion_By_Agent__c']:!![]})[_0x4b6a74(0x15e)]),_0x26d04d[_0x4b6a74(0x162)]=_0x16d008['map'](_0x8a06f=>(0x0,composite_utils_1[_0x4b6a74(0x181)])(constants_1[_0x4b6a74(0x166)],_0x8a06f)[_0x4b6a74(0x15e)]),_0x26d04d;}}exports[a229_0x12c57f(0x13f)]=SalesforceComponentsManager;