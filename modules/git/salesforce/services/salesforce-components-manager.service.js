const a229_0x2309ff=a229_0x1425;(function(_0x584ff1,_0x4e0dd4){const _0x2660ef=a229_0x1425,_0x36d4b1=_0x584ff1();while(!![]){try{const _0xf80e9a=parseInt(_0x2660ef(0xc2))/0x1+-parseInt(_0x2660ef(0x93))/0x2+-parseInt(_0x2660ef(0xc6))/0x3+-parseInt(_0x2660ef(0x9e))/0x4+parseInt(_0x2660ef(0xc9))/0x5*(parseInt(_0x2660ef(0xa1))/0x6)+parseInt(_0x2660ef(0xc3))/0x7+parseInt(_0x2660ef(0xd2))/0x8;if(_0xf80e9a===_0x4e0dd4)break;else _0x36d4b1['push'](_0x36d4b1['shift']());}catch(_0x44d2da){_0x36d4b1['push'](_0x36d4b1['shift']());}}}(a229_0x156f,0x23e62));const a229_0x3274fd=(function(){let _0x31f077=!![];return function(_0x6cd02f,_0x424075){const _0x127c5f=_0x31f077?function(){const _0x1dddea=a229_0x1425;if(_0x424075){const _0x29836a=_0x424075[_0x1dddea(0xb4)](_0x6cd02f,arguments);return _0x424075=null,_0x29836a;}}:function(){};return _0x31f077=![],_0x127c5f;};}()),a229_0x15bf5d=a229_0x3274fd(this,function(){const _0x417d76=a229_0x1425;return a229_0x15bf5d['toString']()['search']('(((.+)+)+)+$')[_0x417d76(0xc1)]()['constructor'](a229_0x15bf5d)[_0x417d76(0x98)]('(((.+)+)+)+$');});a229_0x15bf5d();'use strict';function a229_0x1425(_0x1f28d2,_0x505c74){const _0x2e5e13=a229_0x156f();return a229_0x1425=function(_0x15bf5d,_0x3274fd){_0x15bf5d=_0x15bf5d-0x7d;let _0x156f86=_0x2e5e13[_0x15bf5d];return _0x156f86;},a229_0x1425(_0x1f28d2,_0x505c74);}var __importDefault=this&&this['__importDefault']||function(_0x47f77a){const _0x2954a8=a229_0x1425;return _0x47f77a&&_0x47f77a[_0x2954a8(0xd3)]?_0x47f77a:{'default':_0x47f77a};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a229_0x2309ff(0xd1)]=void 0x0;const constants_1=require(a229_0x2309ff(0xa3)),core_1=require(a229_0x2309ff(0x86)),zip_1=require(a229_0x2309ff(0x94)),typedi_1=__importDefault(require(a229_0x2309ff(0xbe))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a229_0x2309ff(0xc0)),flosum_naming_utils_1=require(a229_0x2309ff(0xb2)),salesforce_git_sync_service_1=require(a229_0x2309ff(0xbf));function a229_0x156f(){const _0x6e4e78=['Component_Name__c','Zip','Repository','prepareComponentHistoryRecord','../utils/flosum-naming.utils','Last_Modified_By__c','apply','recordTypes',']\x20-\x20meta\x20not\x20found','reference','branchId','Name','find','toISOString','file','Is_From_Agent__c','typedi','./salesforce-git-sync.service','../utils/composite.utils','toString','136804rxnwIu','1300579FgOMOD','componentName','FLOSUM_COMPONENT_HISTORY','700137txjfch','base64','componentId','5HRckWi','proceededComponentsMeta','Logger','generateAsync','files','SalesforceGitSyncService','type','getProceededComponentsMeta','SalesforceComponentsManager','13560HvkAIL','__esModule','crc','Could\x20not\x20proceed\x20component\x20','fetchCommitManifestsByComponentIds','componentsToDelete','FLOSUM_COMPONENT','componentType','CRC32__c','prepareComponentAttachmentRecord','Commit__c','FLOSUM_ATTACHMENT','RecordTypeId','../../../../core','.id}','name','prepareComponentRecord','proceedComponentMeta','FLOSUM_NAMESPACE','request','Repository__c','gitSync','FLOSUM_COMMIT_MANIFEST','map','Component_Type__c','prepareCommitManifest','126880mFZYAC','../../parsers/utils/zip','body','version','Body','search','Source__c','Committed_On__c','Changed_By__c','ContentType','componentsToUpdate','30968dgugGt','Version__c','FLOSUM_GIT_NAMESPACE','763842kAAfgM','Description','../../../../constants','keys','push','createDeleteRequest','repositoryId','username','Component__c','default','Last_Updated_By__c','delete','createPostRequest'];a229_0x156f=function(){return _0x6e4e78;};return a229_0x156f();}class SalesforceComponentsManager{constructor(_0xa7b272,_0x34c8cc,_0x3c0b1d,_0x437893,_0x56e9f1){const _0x2ac438=a229_0x2309ff;this[_0x2ac438(0xa7)]=_0xa7b272,this[_0x2ac438(0xb8)]=_0x34c8cc,this[_0x2ac438(0xa8)]=_0x3c0b1d,this[_0x2ac438(0xb5)]=_0x437893,this[_0x2ac438(0xca)]=_0x56e9f1,this['logger']=new core_1[(_0x2ac438(0xcb))](SalesforceComponentsManager['name']),this['gitSync']=typedi_1[_0x2ac438(0xaa)]['get'](salesforce_git_sync_service_1[_0x2ac438(0xce)]);}[a229_0x2309ff(0x8a)](_0x2cd035,_0xcf5eca){const _0x10d096=a229_0x2309ff,_0x383cfd=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x2cd035,['Component_Type__c',_0x10d096(0xae),_0x10d096(0x9f)]);this['proceededComponentsMeta'][_0x10d096(0xa5)]({'componentId':'','reference':_0xcf5eca,'version':_0x383cfd[_0x10d096(0x9f)],'componentName':_0x383cfd['Component_Name__c'],'componentType':_0x383cfd['Component_Type__c']});}[a229_0x2309ff(0x92)](_0x54c061,_0x1cefa1){const _0x334157=a229_0x2309ff,{request:_0x31e012}=(0x0,composite_utils_1[_0x334157(0xad)])(constants_1[_0x334157(0x8f)],{[constants_1[_0x334157(0x8b)]+_0x334157(0x83)]:_0x54c061,[constants_1['FLOSUM_NAMESPACE']+'Component_History__c']:_0x1cefa1});return _0x31e012;}async[a229_0x2309ff(0x82)](_0x57919c,_0x17113d){const _0x220421=a229_0x2309ff,_0x46751d={},_0x1ec2c9=zip_1[_0x220421(0xaf)]['createZip']();for(const _0x5ff71b of Object[_0x220421(0xa4)](_0x57919c[_0x220421(0xcd)])){_0x1ec2c9[_0x220421(0xbc)](_0x5ff71b,_0x57919c[_0x220421(0xcd)][_0x5ff71b],{'createFolders':!![]});}return _0x46751d[_0x220421(0x9c)]='application/zip',_0x46751d[_0x220421(0xb9)]=_0x57919c[_0x220421(0xcf)],_0x46751d[_0x220421(0xa2)]=_0x57919c['type'],_0x46751d['ParentId']=_0x17113d,_0x46751d[_0x220421(0x97)]=await _0x1ec2c9[_0x220421(0xcc)]({'type':_0x220421(0xc7),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x46751d;}[a229_0x2309ff(0xb1)](_0xe43242,_0x3dccfc,_0x1af356){const _0x1471f7=a229_0x2309ff,_0xc0b1f6=new Date()[_0x1471f7(0xbb)](),_0xbdce30={};return _0xbdce30[constants_1[_0x1471f7(0x8b)]+_0x1471f7(0xa9)]=_0x3dccfc,_0xbdce30[constants_1[_0x1471f7(0x8b)]+_0x1471f7(0x81)]=_0xe43242['crc'],_0xbdce30[constants_1['FLOSUM_NAMESPACE']+'Changed_On__c']=_0xc0b1f6,_0xbdce30[constants_1[_0x1471f7(0x8b)]+_0x1471f7(0x9b)]=this['username'],_0xbdce30[constants_1['FLOSUM_NAMESPACE']+'Version__c']=_0x1af356?_0x1af356+0x1:0x1,_0xbdce30[constants_1['FLOSUM_GIT_NAMESPACE']+_0x1471f7(0xbd)]=!![],_0xbdce30;}[a229_0x2309ff(0x89)](_0xb588db,_0x40f5f6){const _0x5d84c7=a229_0x2309ff;var _0x567928,_0x50589c;const _0x45f142=new Date()[_0x5d84c7(0xbb)](),_0x4f7d6f={};return!_0x40f5f6?(this[_0x5d84c7(0xb8)]?(_0x4f7d6f[constants_1[_0x5d84c7(0x8b)]+'Branch__c']=this[_0x5d84c7(0xb8)],_0x4f7d6f[constants_1[_0x5d84c7(0x8b)]+_0x5d84c7(0x99)]='Branch',_0x4f7d6f[_0x5d84c7(0x85)]=(_0x567928=this[_0x5d84c7(0xb5)][_0x5d84c7(0xba)](_0x41876e=>_0x41876e[_0x5d84c7(0x88)]==='Branch'))===null||_0x567928===void 0x0?void 0x0:_0x567928['id']):(_0x4f7d6f[constants_1['FLOSUM_NAMESPACE']+_0x5d84c7(0x8d)]=this['repositoryId'],_0x4f7d6f[constants_1[_0x5d84c7(0x8b)]+_0x5d84c7(0x99)]=_0x5d84c7(0xb0),_0x4f7d6f[_0x5d84c7(0x85)]=(_0x50589c=this[_0x5d84c7(0xb5)][_0x5d84c7(0xba)](_0x47cfb5=>_0x47cfb5[_0x5d84c7(0x88)]===_0x5d84c7(0xb0)))===null||_0x50589c===void 0x0?void 0x0:_0x50589c['id']),_0x4f7d6f[constants_1[_0x5d84c7(0x8b)]+_0x5d84c7(0x9f)]=0x1):_0x4f7d6f[constants_1[_0x5d84c7(0x8b)]+_0x5d84c7(0x9f)]=_0x40f5f6[_0x5d84c7(0x96)]+0x1,_0x4f7d6f[constants_1[_0x5d84c7(0x8b)]+_0x5d84c7(0x91)]=_0xb588db[_0x5d84c7(0xcf)],_0x4f7d6f[constants_1[_0x5d84c7(0x8b)]+_0x5d84c7(0xae)]=_0xb588db[_0x5d84c7(0x88)],_0x4f7d6f[constants_1[_0x5d84c7(0x8b)]+'File_Name__c']=_0xb588db['filePath'],_0x4f7d6f[constants_1[_0x5d84c7(0x8b)]+_0x5d84c7(0xab)]=this[_0x5d84c7(0xa8)],_0x4f7d6f[constants_1['FLOSUM_NAMESPACE']+_0x5d84c7(0xb3)]=this[_0x5d84c7(0xa8)],_0x4f7d6f[constants_1[_0x5d84c7(0x8b)]+'Last_Modified_Date__c']=_0x45f142,_0x4f7d6f[constants_1['FLOSUM_NAMESPACE']+_0x5d84c7(0x9a)]=_0x45f142,_0x4f7d6f[constants_1['FLOSUM_NAMESPACE']+_0x5d84c7(0x81)]=_0xb588db[_0x5d84c7(0xd4)],_0x4f7d6f;}[a229_0x2309ff(0xd0)](){const _0x4c71ef=a229_0x2309ff;return this[_0x4c71ef(0xca)];}async['insert'](_0x4f47df,_0x3a0fcb){const _0x22493d=a229_0x2309ff,_0x25218e=[];for(const _0x1c1596 of _0x4f47df){const _0x3dc670=(0x0,composite_utils_1[_0x22493d(0xad)])(constants_1['FLOSUM_COMPONENT'],this[_0x22493d(0x89)](_0x1c1596)),_0x43be35=(0x0,composite_utils_1[_0x22493d(0xad)])(constants_1[_0x22493d(0xc5)],this[_0x22493d(0xb1)](_0x1c1596,'@{'+_0x3dc670['reference']+_0x22493d(0x87))),_0x124f81=(0x0,composite_utils_1[_0x22493d(0xad)])(constants_1[_0x22493d(0x84)],await this[_0x22493d(0x82)](_0x1c1596,'@{'+_0x43be35[_0x22493d(0xb7)]+_0x22493d(0x87)));this[_0x22493d(0x8a)](_0x3dc670['request'][_0x22493d(0x95)],_0x3dc670[_0x22493d(0xb7)]),_0x25218e[_0x22493d(0xa5)](_0x3dc670[_0x22493d(0x8c)],_0x43be35[_0x22493d(0x8c)],_0x124f81[_0x22493d(0x8c)]),_0x3a0fcb&&_0x25218e[_0x22493d(0xa5)](this[_0x22493d(0x92)](_0x3a0fcb,'@{'+_0x43be35['reference']+_0x22493d(0x87)));}return _0x25218e;}async['update'](_0x327ea4,_0x55aaaf=''){const _0x551ec1=a229_0x2309ff,_0x10f9e0=[];for(const {component:_0x193741,meta:_0x54c81c}of _0x327ea4){if(!_0x54c81c['id']){const _0x278307=this['proceededComponentsMeta'][_0x551ec1(0xba)](_0x46e72b=>_0x46e72b[_0x551ec1(0xc4)]===_0x193741[_0x551ec1(0x88)]&&_0x46e72b[_0x551ec1(0x80)]===_0x193741[_0x551ec1(0xcf)]);if(!_0x278307)throw new salesforce_error_1['SalesforceError'](new Error(_0x551ec1(0xd5)+_0x193741['name']+'\x20['+_0x193741[_0x551ec1(0xcf)]+_0x551ec1(0xb6)));_0x54c81c['id']=_0x278307[_0x551ec1(0xc8)];}const _0x496519=(0x0,composite_utils_1['createPatchRequest'])(constants_1['FLOSUM_COMPONENT'],_0x54c81c['id'],this[_0x551ec1(0x89)](_0x193741,_0x54c81c)),_0x538011=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_COMPONENT_HISTORY'],this['prepareComponentHistoryRecord'](_0x193741,_0x54c81c['id'],_0x54c81c[_0x551ec1(0x96)])),_0x292601=(0x0,composite_utils_1[_0x551ec1(0xad)])(constants_1[_0x551ec1(0x84)],await this[_0x551ec1(0x82)](_0x193741,'@{'+_0x538011['reference']+_0x551ec1(0x87)));this[_0x551ec1(0x8a)](_0x496519[_0x551ec1(0x8c)][_0x551ec1(0x95)],_0x496519['reference']),_0x10f9e0[_0x551ec1(0xa5)](_0x496519[_0x551ec1(0x8c)],_0x538011[_0x551ec1(0x8c)],_0x292601['request']),_0x55aaaf&&_0x10f9e0['push'](this[_0x551ec1(0x92)](_0x55aaaf,'@{'+_0x538011[_0x551ec1(0xb7)]+_0x551ec1(0x87)));}return _0x10f9e0;}async[a229_0x2309ff(0xac)](_0x7f673f,_0xf233a6=![]){const _0x99719d=a229_0x2309ff,_0x2b5525={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x35ebcf=[];for(const _0x12ccaa of _0x7f673f){if(_0x12ccaa['id'])_0x35ebcf['push'](_0x12ccaa['id']);else{const _0xb7a7b2=this[_0x99719d(0xca)]['find'](_0x36cdc9=>_0x36cdc9['componentName']===_0x12ccaa[_0x99719d(0x88)]&&_0x36cdc9[_0x99719d(0x80)]===_0x12ccaa[_0x99719d(0xcf)]);if(!_0xb7a7b2||!_0xb7a7b2[_0x99719d(0xc8)])continue;_0x35ebcf[_0x99719d(0xa5)](_0xb7a7b2[_0x99719d(0xc8)]);}}if(_0xf233a6){const _0x23be31=await this[_0x99719d(0x8e)][_0x99719d(0x7d)](_0x35ebcf);_0x2b5525['manifests']=_0x23be31[_0x99719d(0x90)](_0x3b10e7=>(0x0,composite_utils_1[_0x99719d(0xa6)])(constants_1[_0x99719d(0x8f)],_0x3b10e7)[_0x99719d(0x8c)]);}return _0x2b5525[_0x99719d(0x9d)]=_0x35ebcf[_0x99719d(0x90)](_0x225a0b=>(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x99719d(0x7f)],_0x225a0b,{[constants_1[_0x99719d(0xa0)]+'Deletion_By_Agent__c']:!![]})[_0x99719d(0x8c)]),_0x2b5525[_0x99719d(0x7e)]=_0x35ebcf[_0x99719d(0x90)](_0x55331a=>(0x0,composite_utils_1[_0x99719d(0xa6)])(constants_1['FLOSUM_COMPONENT'],_0x55331a)[_0x99719d(0x8c)]),_0x2b5525;}}exports[a229_0x2309ff(0xd1)]=SalesforceComponentsManager;