const a261_0x12c115=a261_0x2bb8;(function(_0x42e833,_0x3431fa){const _0x1b790e=a261_0x2bb8,_0x6eaf56=_0x42e833();while(!![]){try{const _0x188a5d=-parseInt(_0x1b790e(0x155))/0x1+parseInt(_0x1b790e(0x150))/0x2+parseInt(_0x1b790e(0x160))/0x3+parseInt(_0x1b790e(0x14a))/0x4+-parseInt(_0x1b790e(0x146))/0x5+parseInt(_0x1b790e(0x141))/0x6*(parseInt(_0x1b790e(0x171))/0x7)+parseInt(_0x1b790e(0x147))/0x8*(-parseInt(_0x1b790e(0x16d))/0x9);if(_0x188a5d===_0x3431fa)break;else _0x6eaf56['push'](_0x6eaf56['shift']());}catch(_0x1f2675){_0x6eaf56['push'](_0x6eaf56['shift']());}}}(a261_0x3943,0x3a2c8));function a261_0x3943(){const _0x9280e1=['recordTypes','prepareComponentRecord','RecordTypeId','files',']\x20-\x20meta\x20not\x20found','../errors/salesforce.error','Logger','Component_Type__c','default','./salesforce-git-sync.service','(((.+)+)+)+$','Repository__c','insert','body','defineProperty','componentId','marketingCloudKey','proceedComponentMeta','../utils/flosum-naming.utils','name','createPostRequest','ContentType','Deletion_By_Agent__c','application/zip','CRC32__c','prepareCommitManifest','FLOSUM_NAMESPACE','.id}','Vlocity_Component_Name__c','manifests','constructor','base64','12qETsUu','toString','proceededComponentsMeta','crc','Source__c','1833700wvWjvo','249512vrNBPj','ParentId','Version__c','485892siXkxD','Component_Name__c','Last_Updated_By__c','logger','FLOSUM_ATTACHMENT','map','871926xZYdZI','search','../../../../core','Vlocity_Component__c','../utils/composite.utils','154684qtJexa','Description','prepareComponentAttachmentRecord','../../../../constants','keys','Zip','find','FLOSUM_COMPONENT','SalesforceComponentsManager','push','Last_Modified_By__c','682020SedPjP','apply','update','filePath','file','branchId','version','componentType','DEFLATE','get','delete','SalesforceError','type','126zQinPH','request','username','gitSync','1440509sYaSjO','Name','FLOSUM_COMMIT_MANIFEST','prepareComponentHistoryRecord','__esModule','componentName','FLOSUM_GIT_NAMESPACE','getProceededComponentsMeta','reference','repositoryId','FLOSUM_COMPONENT_HISTORY','Is_From_Agent__c','Could\x20not\x20proceed\x20component\x20','createZip','Last_Modified_Date__c','Component__c','toISOString','File_Name__c','createDeleteRequest','Repository','createPatchRequest','Component_History__c','__importDefault','SalesforceGitSyncService','../../parsers/utils/zip'];a261_0x3943=function(){return _0x9280e1;};return a261_0x3943();}const a261_0x25086e=(function(){let _0x1fa811=!![];return function(_0x510d07,_0xcc9c9c){const _0x5c8bd6=_0x1fa811?function(){const _0x46fea3=a261_0x2bb8;if(_0xcc9c9c){const _0x575023=_0xcc9c9c[_0x46fea3(0x161)](_0x510d07,arguments);return _0xcc9c9c=null,_0x575023;}}:function(){};return _0x1fa811=![],_0x5c8bd6;};}()),a261_0x4bbac1=a261_0x25086e(this,function(){const _0x74df6d=a261_0x2bb8;return a261_0x4bbac1[_0x74df6d(0x142)]()['search'](_0x74df6d(0x194))[_0x74df6d(0x142)]()[_0x74df6d(0x13f)](a261_0x4bbac1)[_0x74df6d(0x151)](_0x74df6d(0x194));});a261_0x4bbac1();function a261_0x2bb8(_0x300159,_0x2420eb){const _0x32ed28=a261_0x3943();return a261_0x2bb8=function(_0x4bbac1,_0x25086e){_0x4bbac1=_0x4bbac1-0x13c;let _0x3943b2=_0x32ed28[_0x4bbac1];return _0x3943b2;},a261_0x2bb8(_0x300159,_0x2420eb);}'use strict';var __importDefault=this&&this[a261_0x12c115(0x187)]||function(_0x545ad4){return _0x545ad4&&_0x545ad4['__esModule']?_0x545ad4:{'default':_0x545ad4};};Object[a261_0x12c115(0x198)](exports,a261_0x12c115(0x175),{'value':!![]}),exports[a261_0x12c115(0x15d)]=void 0x0;const constants_1=require(a261_0x12c115(0x158)),core_1=require(a261_0x12c115(0x152)),zip_1=require(a261_0x12c115(0x189)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a261_0x12c115(0x18f)),composite_utils_1=require(a261_0x12c115(0x154)),flosum_naming_utils_1=require(a261_0x12c115(0x19c)),salesforce_git_sync_service_1=require(a261_0x12c115(0x193));class SalesforceComponentsManager{constructor(_0x45c988,_0x54f5c4,_0x34605f,_0x4eb328,_0x42a619){const _0x4cff75=a261_0x12c115;this['repositoryId']=_0x45c988,this[_0x4cff75(0x165)]=_0x54f5c4,this[_0x4cff75(0x16f)]=_0x34605f,this[_0x4cff75(0x18a)]=_0x4eb328,this[_0x4cff75(0x143)]=_0x42a619,this[_0x4cff75(0x14d)]=new core_1[(_0x4cff75(0x190))](SalesforceComponentsManager['name']),this[_0x4cff75(0x170)]=typedi_1[_0x4cff75(0x192)][_0x4cff75(0x169)](salesforce_git_sync_service_1[_0x4cff75(0x188)]);}[a261_0x12c115(0x19b)](_0x271295,_0x4179e7){const _0xc01c8f=a261_0x12c115,_0x1e4bea=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x271295,[_0xc01c8f(0x191),_0xc01c8f(0x14b),'Version__c']);this[_0xc01c8f(0x143)][_0xc01c8f(0x15e)]({'componentId':'','reference':_0x4179e7,'version':_0x1e4bea[_0xc01c8f(0x149)],'componentName':_0x1e4bea[_0xc01c8f(0x14b)],'componentType':_0x1e4bea[_0xc01c8f(0x191)]});}[a261_0x12c115(0x1a3)](_0x3e08d6,_0x64bbe8){const _0x2dbdc2=a261_0x12c115,{request:_0x5c4284}=(0x0,composite_utils_1[_0x2dbdc2(0x19e)])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x2dbdc2(0x1a4)]+'Commit__c']:_0x3e08d6,[constants_1['FLOSUM_NAMESPACE']+_0x2dbdc2(0x186)]:_0x64bbe8});return _0x5c4284;}async[a261_0x12c115(0x157)](_0x5c7ef1,_0xdbdfdd){const _0x3bf1ab=a261_0x12c115,_0x37d726={},_0x295961=zip_1[_0x3bf1ab(0x15a)][_0x3bf1ab(0x17e)]();for(const _0x58c3ff of Object[_0x3bf1ab(0x159)](_0x5c7ef1['files'])){_0x295961[_0x3bf1ab(0x164)](_0x58c3ff,_0x5c7ef1[_0x3bf1ab(0x18d)][_0x58c3ff],{'createFolders':!![]});}return _0x37d726[_0x3bf1ab(0x19f)]=_0x3bf1ab(0x1a1),_0x37d726[_0x3bf1ab(0x172)]=_0x5c7ef1['type'],_0x37d726[_0x3bf1ab(0x156)]=_0x5c7ef1[_0x3bf1ab(0x16c)],_0x37d726[_0x3bf1ab(0x148)]=_0xdbdfdd,_0x37d726['Body']=await _0x295961['generateAsync']({'type':_0x3bf1ab(0x140),'compression':_0x3bf1ab(0x168),'compressionOptions':{'level':0x6}}),_0x37d726;}['prepareComponentHistoryRecord'](_0x44222b,_0x27854e,_0x47b0fd){const _0x18f80b=a261_0x12c115,_0x3f79da=new Date()[_0x18f80b(0x181)](),_0x38215a={};return _0x38215a[constants_1['FLOSUM_NAMESPACE']+_0x18f80b(0x180)]=_0x27854e,_0x38215a[constants_1[_0x18f80b(0x1a4)]+'CRC32__c']=_0x44222b[_0x18f80b(0x144)],_0x38215a[constants_1[_0x18f80b(0x1a4)]+'Changed_On__c']=_0x3f79da,_0x38215a[constants_1[_0x18f80b(0x1a4)]+'Changed_By__c']=this[_0x18f80b(0x16f)],_0x38215a[constants_1[_0x18f80b(0x1a4)]+_0x18f80b(0x149)]=_0x47b0fd?_0x47b0fd+0x1:0x1,_0x38215a[constants_1[_0x18f80b(0x177)]+_0x18f80b(0x17c)]=!![],_0x38215a;}[a261_0x12c115(0x18b)](_0x112829,_0x692aa8){const _0x31c443=a261_0x12c115;var _0x405f1e,_0x200da9;const _0x366568=new Date()[_0x31c443(0x181)](),_0x5a7cc8={};return!_0x692aa8?(this[_0x31c443(0x165)]?(_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+'Branch__c']=this[_0x31c443(0x165)],_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+'Source__c']='Branch',_0x5a7cc8[_0x31c443(0x18c)]=(_0x405f1e=this[_0x31c443(0x18a)][_0x31c443(0x15b)](_0x89467f=>_0x89467f[_0x31c443(0x19d)]==='Branch'))===null||_0x405f1e===void 0x0?void 0x0:_0x405f1e['id']):(_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+_0x31c443(0x195)]=this[_0x31c443(0x17a)],_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+_0x31c443(0x145)]='Repository',_0x5a7cc8[_0x31c443(0x18c)]=(_0x200da9=this[_0x31c443(0x18a)][_0x31c443(0x15b)](_0x3a3d1d=>_0x3a3d1d[_0x31c443(0x19d)]===_0x31c443(0x184)))===null||_0x200da9===void 0x0?void 0x0:_0x200da9['id']),_0x5a7cc8[constants_1['FLOSUM_NAMESPACE']+_0x31c443(0x149)]=0x1):_0x5a7cc8[constants_1['FLOSUM_NAMESPACE']+_0x31c443(0x149)]=_0x692aa8[_0x31c443(0x166)]+0x1,_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+'Component_Type__c']=_0x112829[_0x31c443(0x16c)],_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+_0x31c443(0x14b)]=_0x112829[_0x31c443(0x19d)],_0x5a7cc8[constants_1['FLOSUM_NAMESPACE']+_0x31c443(0x182)]=_0x112829[_0x31c443(0x163)],_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+_0x31c443(0x14c)]=this[_0x31c443(0x16f)],_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+_0x31c443(0x15f)]=this[_0x31c443(0x16f)],_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+_0x31c443(0x17f)]=_0x366568,_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+'Committed_On__c']=_0x366568,_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+_0x31c443(0x1a2)]=_0x112829[_0x31c443(0x144)],_0x5a7cc8[constants_1['FLOSUM_NAMESPACE']+_0x31c443(0x13d)]=_0x112829['vlocityComponentName'],_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+_0x31c443(0x153)]=_0x112829['isVlocityComponent'],_0x5a7cc8[constants_1[_0x31c443(0x1a4)]+'MC_Key__c']=_0x112829[_0x31c443(0x19a)],_0x5a7cc8;}[a261_0x12c115(0x178)](){const _0x3ce2fe=a261_0x12c115;return this[_0x3ce2fe(0x143)];}async[a261_0x12c115(0x196)](_0x3f4e17,_0x274b09){const _0x10bcbb=a261_0x12c115,_0x13a863=[];for(const _0x26f9f9 of _0x3f4e17){const _0x4ca680=(0x0,composite_utils_1[_0x10bcbb(0x19e)])(constants_1[_0x10bcbb(0x15c)],this[_0x10bcbb(0x18b)](_0x26f9f9)),_0x48ac0b=(0x0,composite_utils_1[_0x10bcbb(0x19e)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this['prepareComponentHistoryRecord'](_0x26f9f9,'@{'+_0x4ca680[_0x10bcbb(0x179)]+_0x10bcbb(0x13c))),_0x2921c8=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x10bcbb(0x14e)],await this[_0x10bcbb(0x157)](_0x26f9f9,'@{'+_0x48ac0b['reference']+'.id}'));this['proceedComponentMeta'](_0x4ca680[_0x10bcbb(0x16e)][_0x10bcbb(0x197)],_0x4ca680[_0x10bcbb(0x179)]),_0x13a863[_0x10bcbb(0x15e)](_0x4ca680[_0x10bcbb(0x16e)],_0x48ac0b[_0x10bcbb(0x16e)],_0x2921c8[_0x10bcbb(0x16e)]),_0x274b09&&_0x13a863[_0x10bcbb(0x15e)](this[_0x10bcbb(0x1a3)](_0x274b09,'@{'+_0x48ac0b[_0x10bcbb(0x179)]+_0x10bcbb(0x13c)));}return _0x13a863;}async[a261_0x12c115(0x162)](_0x52e8d5,_0x56d129=''){const _0x50dce7=a261_0x12c115,_0xb640d9=[];for(const {component:_0x533901,meta:_0x3d36df}of _0x52e8d5){if(!_0x3d36df['id']){const _0x40650f=this[_0x50dce7(0x143)][_0x50dce7(0x15b)](_0x2f81d7=>_0x2f81d7[_0x50dce7(0x176)]===_0x533901[_0x50dce7(0x19d)]&&_0x2f81d7[_0x50dce7(0x167)]===_0x533901[_0x50dce7(0x16c)]);if(!_0x40650f)throw new salesforce_error_1[(_0x50dce7(0x16b))](new Error(_0x50dce7(0x17d)+_0x533901[_0x50dce7(0x19d)]+'\x20['+_0x533901[_0x50dce7(0x16c)]+_0x50dce7(0x18e)));_0x3d36df['id']=_0x40650f[_0x50dce7(0x199)];}const _0x366e74=(0x0,composite_utils_1[_0x50dce7(0x185)])(constants_1[_0x50dce7(0x15c)],_0x3d36df['id'],this[_0x50dce7(0x18b)](_0x533901,_0x3d36df)),_0x3b3334=(0x0,composite_utils_1[_0x50dce7(0x19e)])(constants_1[_0x50dce7(0x17b)],this[_0x50dce7(0x174)](_0x533901,_0x3d36df['id'],_0x3d36df['version'])),_0x4f88a7=(0x0,composite_utils_1[_0x50dce7(0x19e)])(constants_1[_0x50dce7(0x14e)],await this[_0x50dce7(0x157)](_0x533901,'@{'+_0x3b3334[_0x50dce7(0x179)]+_0x50dce7(0x13c)));this[_0x50dce7(0x19b)](_0x366e74[_0x50dce7(0x16e)]['body'],_0x366e74[_0x50dce7(0x179)]),_0xb640d9['push'](_0x366e74[_0x50dce7(0x16e)],_0x3b3334['request'],_0x4f88a7[_0x50dce7(0x16e)]),_0x56d129&&_0xb640d9['push'](this[_0x50dce7(0x1a3)](_0x56d129,'@{'+_0x3b3334[_0x50dce7(0x179)]+_0x50dce7(0x13c)));}return _0xb640d9;}async[a261_0x12c115(0x16a)](_0x400bbd,_0x30ccb5=![]){const _0x2afcb8=a261_0x12c115,_0xdc6563={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0xd58c22=[];for(const _0x33824d of _0x400bbd){if(_0x33824d['id'])_0xd58c22[_0x2afcb8(0x15e)](_0x33824d['id']);else{const _0x3d803d=this['proceededComponentsMeta'][_0x2afcb8(0x15b)](_0x1dccbd=>_0x1dccbd['componentName']===_0x33824d[_0x2afcb8(0x19d)]&&_0x1dccbd[_0x2afcb8(0x167)]===_0x33824d[_0x2afcb8(0x16c)]);if(!_0x3d803d||!_0x3d803d['componentId'])continue;_0xd58c22[_0x2afcb8(0x15e)](_0x3d803d[_0x2afcb8(0x199)]);}}if(_0x30ccb5){const _0x3f775b=await this[_0x2afcb8(0x170)]['fetchCommitManifestsByComponentIds'](_0xd58c22);_0xdc6563[_0x2afcb8(0x13e)]=_0x3f775b['map'](_0x171ed6=>(0x0,composite_utils_1[_0x2afcb8(0x183)])(constants_1[_0x2afcb8(0x173)],_0x171ed6)[_0x2afcb8(0x16e)]);}return _0xdc6563['componentsToUpdate']=_0xd58c22[_0x2afcb8(0x14f)](_0x440ce5=>(0x0,composite_utils_1[_0x2afcb8(0x185)])(constants_1[_0x2afcb8(0x15c)],_0x440ce5,{[constants_1[_0x2afcb8(0x177)]+_0x2afcb8(0x1a0)]:!![]})['request']),_0xdc6563['componentsToDelete']=_0xd58c22[_0x2afcb8(0x14f)](_0x4456d8=>(0x0,composite_utils_1[_0x2afcb8(0x183)])(constants_1[_0x2afcb8(0x15c)],_0x4456d8)[_0x2afcb8(0x16e)]),_0xdc6563;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;