const a234_0x19b6eb=a234_0x3557;(function(_0x177abc,_0x68b336){const _0x296f69=a234_0x3557,_0x481ee6=_0x177abc();while(!![]){try{const _0xd9731f=parseInt(_0x296f69(0x145))/0x1*(-parseInt(_0x296f69(0x159))/0x2)+-parseInt(_0x296f69(0x111))/0x3*(-parseInt(_0x296f69(0x140))/0x4)+-parseInt(_0x296f69(0x151))/0x5+-parseInt(_0x296f69(0x143))/0x6+-parseInt(_0x296f69(0x137))/0x7+parseInt(_0x296f69(0x110))/0x8+parseInt(_0x296f69(0x13c))/0x9;if(_0xd9731f===_0x68b336)break;else _0x481ee6['push'](_0x481ee6['shift']());}catch(_0x3b6afa){_0x481ee6['push'](_0x481ee6['shift']());}}}(a234_0x2c00,0xd9a59));const a234_0x30e53d=(function(){let _0x191be8=!![];return function(_0x1c5a0f,_0x457a9f){const _0x32b530=_0x191be8?function(){const _0x3bb83e=a234_0x3557;if(_0x457a9f){const _0x5b636e=_0x457a9f[_0x3bb83e(0x116)](_0x1c5a0f,arguments);return _0x457a9f=null,_0x5b636e;}}:function(){};return _0x191be8=![],_0x32b530;};}()),a234_0x630433=a234_0x30e53d(this,function(){const _0x4bd95c=a234_0x3557;return a234_0x630433[_0x4bd95c(0x123)]()[_0x4bd95c(0x13e)](_0x4bd95c(0x11f))['toString']()[_0x4bd95c(0x130)](a234_0x630433)[_0x4bd95c(0x13e)]('(((.+)+)+)+$');});a234_0x630433();'use strict';function a234_0x2c00(){const _0x3b2cf1=['../errors/salesforce.error','FLOSUM_NAMESPACE','ParentId','RecordTypeId','Last_Updated_By__c','reference','username','createZip','Repository','createPostRequest','File_Name__c','prepareComponentHistoryRecord','FLOSUM_COMPONENT','6302616SiNuqd','12gtSiqV','Last_Modified_By__c','name','body','Branch','apply',']\x20-\x20meta\x20not\x20found','.id}','Deletion_By_Agent__c','componentsToUpdate','Source__c','Description','FLOSUM_GIT_NAMESPACE','Logger','(((.+)+)+)+$','Changed_By__c','Committed_On__c','FLOSUM_COMPONENT_HISTORY','toString','Body','Component_Name__c','Component_Type__c','createDeleteRequest','logger','ContentType','fetchCommitManifestsByComponentIds','gitSync','request','proceededComponentsMeta','FLOSUM_ATTACHMENT','default','constructor','Component_History__c','toISOString','../utils/composite.utils','generateAsync','crc','Could\x20not\x20proceed\x20component\x20','521437kOfuwk','find','__esModule','defineProperty','type','34928937XRcFYb','Commit__c','search','recordTypes','52552GbepiQ','version','push','9659538pbDAjU','map','1kIplxh','Zip','delete','branchId','SalesforceError','componentId','createPatchRequest','Vlocity_Component_Name__c','application/zip','prepareCommitManifest','get','SalesforceGitSyncService','2982580OWavBt','repositoryId','prepareComponentRecord','componentName','Name','componentType','../../../../core','Version__c','3097922brzMhs','SalesforceComponentsManager','componentsToDelete','filePath','prepareComponentAttachmentRecord','Repository__c','base64'];a234_0x2c00=function(){return _0x3b2cf1;};return a234_0x2c00();}function a234_0x3557(_0x34a8b2,_0x46ffc6){const _0x5cd39a=a234_0x2c00();return a234_0x3557=function(_0x630433,_0x30e53d){_0x630433=_0x630433-0x108;let _0x2c0037=_0x5cd39a[_0x630433];return _0x2c0037;},a234_0x3557(_0x34a8b2,_0x46ffc6);}var __importDefault=this&&this['__importDefault']||function(_0x23ebb5){const _0x4dface=a234_0x3557;return _0x23ebb5&&_0x23ebb5[_0x4dface(0x139)]?_0x23ebb5:{'default':_0x23ebb5};};Object[a234_0x19b6eb(0x13a)](exports,a234_0x19b6eb(0x139),{'value':!![]}),exports[a234_0x19b6eb(0x15a)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a234_0x19b6eb(0x157)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a234_0x19b6eb(0x160)),composite_utils_1=require(a234_0x19b6eb(0x133)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0xd21472,_0x36351a,_0x14e0fc,_0x58008a,_0x51bf27){const _0x48ea45=a234_0x19b6eb;this[_0x48ea45(0x152)]=_0xd21472,this[_0x48ea45(0x148)]=_0x36351a,this[_0x48ea45(0x109)]=_0x14e0fc,this[_0x48ea45(0x13f)]=_0x58008a,this[_0x48ea45(0x12d)]=_0x51bf27,this[_0x48ea45(0x128)]=new core_1[(_0x48ea45(0x11e))](SalesforceComponentsManager[_0x48ea45(0x113)]),this[_0x48ea45(0x12b)]=typedi_1[_0x48ea45(0x12f)][_0x48ea45(0x14f)](salesforce_git_sync_service_1[_0x48ea45(0x150)]);}['proceedComponentMeta'](_0x2c824f,_0x22efba){const _0x27dcf8=a234_0x19b6eb,_0x538e6a=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x2c824f,[_0x27dcf8(0x126),_0x27dcf8(0x125),_0x27dcf8(0x158)]);this[_0x27dcf8(0x12d)]['push']({'componentId':'','reference':_0x22efba,'version':_0x538e6a[_0x27dcf8(0x158)],'componentName':_0x538e6a[_0x27dcf8(0x125)],'componentType':_0x538e6a['Component_Type__c']});}[a234_0x19b6eb(0x14e)](_0x58e1e5,_0x32293a){const _0x5e9b60=a234_0x19b6eb,{request:_0x3657cb}=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1['FLOSUM_NAMESPACE']+_0x5e9b60(0x13d)]:_0x58e1e5,[constants_1[_0x5e9b60(0x161)]+_0x5e9b60(0x131)]:_0x32293a});return _0x3657cb;}async['prepareComponentAttachmentRecord'](_0x1a4e44,_0x51616f){const _0xa3c3da=a234_0x19b6eb,_0x58e326={},_0x50dee7=zip_1[_0xa3c3da(0x146)][_0xa3c3da(0x10a)]();for(const _0x4e6a28 of Object['keys'](_0x1a4e44['files'])){_0x50dee7['file'](_0x4e6a28,_0x1a4e44['files'][_0x4e6a28],{'createFolders':!![]});}return _0x58e326[_0xa3c3da(0x129)]=_0xa3c3da(0x14d),_0x58e326[_0xa3c3da(0x155)]=_0x1a4e44['type'],_0x58e326[_0xa3c3da(0x11c)]=_0x1a4e44[_0xa3c3da(0x13b)],_0x58e326[_0xa3c3da(0x162)]=_0x51616f,_0x58e326[_0xa3c3da(0x124)]=await _0x50dee7[_0xa3c3da(0x134)]({'type':_0xa3c3da(0x15f),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x58e326;}[a234_0x19b6eb(0x10e)](_0xe44a8c,_0x4c4ed9,_0x2375f0){const _0x1222e8=a234_0x19b6eb,_0x4f8bc5=new Date()[_0x1222e8(0x132)](),_0x19c71e={};return _0x19c71e[constants_1[_0x1222e8(0x161)]+'Component__c']=_0x4c4ed9,_0x19c71e[constants_1[_0x1222e8(0x161)]+'CRC32__c']=_0xe44a8c[_0x1222e8(0x135)],_0x19c71e[constants_1[_0x1222e8(0x161)]+'Changed_On__c']=_0x4f8bc5,_0x19c71e[constants_1['FLOSUM_NAMESPACE']+_0x1222e8(0x120)]=this[_0x1222e8(0x109)],_0x19c71e[constants_1['FLOSUM_NAMESPACE']+_0x1222e8(0x158)]=_0x2375f0?_0x2375f0+0x1:0x1,_0x19c71e[constants_1[_0x1222e8(0x11d)]+'Is_From_Agent__c']=!![],_0x19c71e;}[a234_0x19b6eb(0x153)](_0x225afd,_0x28a296){const _0x53584e=a234_0x19b6eb;var _0x30a816,_0x30d875;const _0x3a9f15=new Date()[_0x53584e(0x132)](),_0x84f545={};return!_0x28a296?(this[_0x53584e(0x148)]?(_0x84f545[constants_1[_0x53584e(0x161)]+'Branch__c']=this[_0x53584e(0x148)],_0x84f545[constants_1['FLOSUM_NAMESPACE']+_0x53584e(0x11b)]=_0x53584e(0x115),_0x84f545[_0x53584e(0x163)]=(_0x30a816=this[_0x53584e(0x13f)][_0x53584e(0x138)](_0x5c9b5a=>_0x5c9b5a[_0x53584e(0x113)]===_0x53584e(0x115)))===null||_0x30a816===void 0x0?void 0x0:_0x30a816['id']):(_0x84f545[constants_1[_0x53584e(0x161)]+_0x53584e(0x15e)]=this[_0x53584e(0x152)],_0x84f545[constants_1[_0x53584e(0x161)]+_0x53584e(0x11b)]=_0x53584e(0x10b),_0x84f545[_0x53584e(0x163)]=(_0x30d875=this[_0x53584e(0x13f)][_0x53584e(0x138)](_0x29c457=>_0x29c457[_0x53584e(0x113)]===_0x53584e(0x10b)))===null||_0x30d875===void 0x0?void 0x0:_0x30d875['id']),_0x84f545[constants_1['FLOSUM_NAMESPACE']+_0x53584e(0x158)]=0x1):_0x84f545[constants_1['FLOSUM_NAMESPACE']+_0x53584e(0x158)]=_0x28a296['version']+0x1,_0x84f545[constants_1[_0x53584e(0x161)]+_0x53584e(0x126)]=_0x225afd[_0x53584e(0x13b)],_0x84f545[constants_1[_0x53584e(0x161)]+_0x53584e(0x125)]=_0x225afd[_0x53584e(0x113)],_0x84f545[constants_1['FLOSUM_NAMESPACE']+_0x53584e(0x10d)]=_0x225afd[_0x53584e(0x15c)],_0x84f545[constants_1['FLOSUM_NAMESPACE']+_0x53584e(0x164)]=this[_0x53584e(0x109)],_0x84f545[constants_1['FLOSUM_NAMESPACE']+_0x53584e(0x112)]=this[_0x53584e(0x109)],_0x84f545[constants_1[_0x53584e(0x161)]+'Last_Modified_Date__c']=_0x3a9f15,_0x84f545[constants_1['FLOSUM_NAMESPACE']+_0x53584e(0x121)]=_0x3a9f15,_0x84f545[constants_1[_0x53584e(0x161)]+'CRC32__c']=_0x225afd[_0x53584e(0x135)],_0x84f545[constants_1[_0x53584e(0x161)]+_0x53584e(0x14c)]=_0x225afd['vlocityComponentName'],_0x84f545[constants_1[_0x53584e(0x161)]+'Vlocity_Component__c']=_0x225afd['isVlocityComponent'],_0x84f545;}['getProceededComponentsMeta'](){const _0x72ea1a=a234_0x19b6eb;return this[_0x72ea1a(0x12d)];}async['insert'](_0x4de53f,_0x41f520){const _0x51c734=a234_0x19b6eb,_0x13bf34=[];for(const _0x413546 of _0x4de53f){const _0x1ad76f=(0x0,composite_utils_1[_0x51c734(0x10c)])(constants_1[_0x51c734(0x10f)],this[_0x51c734(0x153)](_0x413546)),_0x17b8f7=(0x0,composite_utils_1[_0x51c734(0x10c)])(constants_1[_0x51c734(0x122)],this['prepareComponentHistoryRecord'](_0x413546,'@{'+_0x1ad76f[_0x51c734(0x108)]+'.id}')),_0x10490d=(0x0,composite_utils_1[_0x51c734(0x10c)])(constants_1[_0x51c734(0x12e)],await this[_0x51c734(0x15d)](_0x413546,'@{'+_0x17b8f7['reference']+_0x51c734(0x118)));this['proceedComponentMeta'](_0x1ad76f[_0x51c734(0x12c)]['body'],_0x1ad76f[_0x51c734(0x108)]),_0x13bf34[_0x51c734(0x142)](_0x1ad76f['request'],_0x17b8f7[_0x51c734(0x12c)],_0x10490d[_0x51c734(0x12c)]),_0x41f520&&_0x13bf34[_0x51c734(0x142)](this['prepareCommitManifest'](_0x41f520,'@{'+_0x17b8f7['reference']+'.id}'));}return _0x13bf34;}async['update'](_0x3de3e8,_0x473c16=''){const _0x48eff6=a234_0x19b6eb,_0xbbb8b5=[];for(const {component:_0x36913d,meta:_0x72caf5}of _0x3de3e8){if(!_0x72caf5['id']){const _0x4cd438=this[_0x48eff6(0x12d)][_0x48eff6(0x138)](_0x40fe1f=>_0x40fe1f[_0x48eff6(0x154)]===_0x36913d[_0x48eff6(0x113)]&&_0x40fe1f[_0x48eff6(0x156)]===_0x36913d[_0x48eff6(0x13b)]);if(!_0x4cd438)throw new salesforce_error_1[(_0x48eff6(0x149))](new Error(_0x48eff6(0x136)+_0x36913d['name']+'\x20['+_0x36913d[_0x48eff6(0x13b)]+_0x48eff6(0x117)));_0x72caf5['id']=_0x4cd438[_0x48eff6(0x14a)];}const _0x27f631=(0x0,composite_utils_1[_0x48eff6(0x14b)])(constants_1['FLOSUM_COMPONENT'],_0x72caf5['id'],this[_0x48eff6(0x153)](_0x36913d,_0x72caf5)),_0x59aa38=(0x0,composite_utils_1[_0x48eff6(0x10c)])(constants_1[_0x48eff6(0x122)],this['prepareComponentHistoryRecord'](_0x36913d,_0x72caf5['id'],_0x72caf5[_0x48eff6(0x141)])),_0xc97bc=(0x0,composite_utils_1[_0x48eff6(0x10c)])(constants_1[_0x48eff6(0x12e)],await this[_0x48eff6(0x15d)](_0x36913d,'@{'+_0x59aa38[_0x48eff6(0x108)]+'.id}'));this['proceedComponentMeta'](_0x27f631[_0x48eff6(0x12c)][_0x48eff6(0x114)],_0x27f631[_0x48eff6(0x108)]),_0xbbb8b5[_0x48eff6(0x142)](_0x27f631[_0x48eff6(0x12c)],_0x59aa38[_0x48eff6(0x12c)],_0xc97bc[_0x48eff6(0x12c)]),_0x473c16&&_0xbbb8b5[_0x48eff6(0x142)](this[_0x48eff6(0x14e)](_0x473c16,'@{'+_0x59aa38[_0x48eff6(0x108)]+_0x48eff6(0x118)));}return _0xbbb8b5;}async[a234_0x19b6eb(0x147)](_0xc781e4,_0x561506=![]){const _0xcfeab2=a234_0x19b6eb,_0x5bd774={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x26228b=[];for(const _0x90ed11 of _0xc781e4){if(_0x90ed11['id'])_0x26228b['push'](_0x90ed11['id']);else{const _0x24a32b=this[_0xcfeab2(0x12d)]['find'](_0x5d2b93=>_0x5d2b93[_0xcfeab2(0x154)]===_0x90ed11['name']&&_0x5d2b93['componentType']===_0x90ed11[_0xcfeab2(0x13b)]);if(!_0x24a32b||!_0x24a32b[_0xcfeab2(0x14a)])continue;_0x26228b[_0xcfeab2(0x142)](_0x24a32b[_0xcfeab2(0x14a)]);}}if(_0x561506){const _0x144be4=await this[_0xcfeab2(0x12b)][_0xcfeab2(0x12a)](_0x26228b);_0x5bd774['manifests']=_0x144be4[_0xcfeab2(0x144)](_0x1ef766=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x1ef766)[_0xcfeab2(0x12c)]);}return _0x5bd774[_0xcfeab2(0x11a)]=_0x26228b[_0xcfeab2(0x144)](_0xf55beb=>(0x0,composite_utils_1[_0xcfeab2(0x14b)])(constants_1[_0xcfeab2(0x10f)],_0xf55beb,{[constants_1[_0xcfeab2(0x11d)]+_0xcfeab2(0x119)]:!![]})[_0xcfeab2(0x12c)]),_0x5bd774[_0xcfeab2(0x15b)]=_0x26228b[_0xcfeab2(0x144)](_0x42ee03=>(0x0,composite_utils_1[_0xcfeab2(0x127)])(constants_1['FLOSUM_COMPONENT'],_0x42ee03)[_0xcfeab2(0x12c)]),_0x5bd774;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;