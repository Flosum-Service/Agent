const a177_0x22cb3f=a177_0x170e;(function(_0x218d6e,_0x5b4e68){const _0x4a86af=a177_0x170e,_0x33adac=_0x218d6e();while(!![]){try{const _0x24211e=-parseInt(_0x4a86af(0x113))/0x1*(-parseInt(_0x4a86af(0xf6))/0x2)+-parseInt(_0x4a86af(0xff))/0x3+parseInt(_0x4a86af(0xec))/0x4+-parseInt(_0x4a86af(0x114))/0x5+-parseInt(_0x4a86af(0x11f))/0x6+parseInt(_0x4a86af(0xea))/0x7*(parseInt(_0x4a86af(0xd9))/0x8)+parseInt(_0x4a86af(0xf7))/0x9;if(_0x24211e===_0x5b4e68)break;else _0x33adac['push'](_0x33adac['shift']());}catch(_0xd8ad27){_0x33adac['push'](_0x33adac['shift']());}}}(a177_0x415d,0xc6e24));const a177_0x6faaa5=(function(){let _0x335c20=!![];return function(_0x3a9667,_0x38f4b5){const _0x369d19=_0x335c20?function(){const _0xd276cc=a177_0x170e;if(_0x38f4b5){const _0x1f5421=_0x38f4b5[_0xd276cc(0xf0)](_0x3a9667,arguments);return _0x38f4b5=null,_0x1f5421;}}:function(){};return _0x335c20=![],_0x369d19;};}()),a177_0x120d00=a177_0x6faaa5(this,function(){const _0x2a5420=a177_0x170e;return a177_0x120d00[_0x2a5420(0xeb)]()['search']('(((.+)+)+)+$')[_0x2a5420(0xeb)]()[_0x2a5420(0xdb)](a177_0x120d00)[_0x2a5420(0xc3)](_0x2a5420(0xdc));});a177_0x120d00();function a177_0x170e(_0x1af0d5,_0x251426){const _0x1ca4c6=a177_0x415d();return a177_0x170e=function(_0x120d00,_0x6faaa5){_0x120d00=_0x120d00-0xbf;let _0x415d0f=_0x1ca4c6[_0x120d00];return _0x415d0f;},a177_0x170e(_0x1af0d5,_0x251426);}function a177_0x415d(){const _0x1a1daf=['../../../../core','generateAsync','../../parsers/utils/zip','prepareComponentHistoryRecord','2544266tbVBPO','330687TfDFSh','componentsToUpdate','Last_Updated_By__c','application/zip','.id}','Component_Type__c','reference','repositoryId','4580406KqtDQA','FLOSUM_COMPONENT','push','componentId','Source__c','SalesforceComponentsManager','componentName','createDeleteRequest','Changed_On__c','update','crc','RecordTypeId','FLOSUM_ATTACHMENT','ContentType','../errors/salesforce.error','files','file','Branch','File_Name__c','get','1YeYNek','3586490aZDqfc','Version__c','FLOSUM_NAMESPACE','Body','keys','typedi','Repository','Component_History__c','getProceededComponentsMeta','createPatchRequest','find','1588662sBczcx','Repository__c','username','createPostRequest','../../../../constants','Changed_By__c','Last_Modified_Date__c','filePath','Could\x20not\x20proceed\x20component\x20','proceededComponentsMeta','FLOSUM_GIT_NAMESPACE','SalesforceGitSyncService','fetchCommitManifestsByComponentIds','search','DEFLATE','insert','extractFieldsFromRecord','Is_From_Agent__c','__esModule','FLOSUM_COMPONENT_HISTORY','CRC32__c','map','name','type','Logger','toISOString','defineProperty','prepareComponentRecord','delete','Branch__c','Description','__importDefault','Name','ParentId','FLOSUM_COMMIT_MANIFEST','7576SMcnBp','prepareComponentAttachmentRecord','constructor','(((.+)+)+)+$','body','base64','gitSync','request','Last_Modified_By__c','Component_Name__c','prepareCommitManifest','componentType','logger','branchId','proceedComponentMeta','createZip','Zip','4487jCRGFq','toString','5630408CEyeOX','Committed_On__c','Commit__c','recordTypes','apply','default'];a177_0x415d=function(){return _0x1a1daf;};return a177_0x415d();}'use strict';var __importDefault=this&&this[a177_0x22cb3f(0xd5)]||function(_0x5ac6cd){const _0xf6e4d6=a177_0x22cb3f;return _0x5ac6cd&&_0x5ac6cd[_0xf6e4d6(0xc8)]?_0x5ac6cd:{'default':_0x5ac6cd};};Object[a177_0x22cb3f(0xd0)](exports,a177_0x22cb3f(0xc8),{'value':!![]}),exports[a177_0x22cb3f(0x104)]=void 0x0;const constants_1=require(a177_0x22cb3f(0x123)),core_1=require(a177_0x22cb3f(0xf2)),zip_1=require(a177_0x22cb3f(0xf4)),typedi_1=__importDefault(require(a177_0x22cb3f(0x119))),salesforce_error_1=require(a177_0x22cb3f(0x10d)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x26c3dd,_0x4086b8,_0x78833e,_0x3278fe,_0x2c03a6){const _0x521852=a177_0x22cb3f;this['repositoryId']=_0x26c3dd,this[_0x521852(0xe6)]=_0x4086b8,this[_0x521852(0x121)]=_0x78833e,this['recordTypes']=_0x3278fe,this[_0x521852(0xbf)]=_0x2c03a6,this[_0x521852(0xe5)]=new core_1[(_0x521852(0xce))](SalesforceComponentsManager[_0x521852(0xcc)]),this['gitSync']=typedi_1[_0x521852(0xf1)][_0x521852(0x112)](salesforce_git_sync_service_1[_0x521852(0xc1)]);}[a177_0x22cb3f(0xe7)](_0x138679,_0x1bc274){const _0x1be347=a177_0x22cb3f,_0x29b9ea=flosum_naming_utils_1[_0x1be347(0xc6)](_0x138679,[_0x1be347(0xfc),_0x1be347(0xe2),_0x1be347(0x115)]);this['proceededComponentsMeta'][_0x1be347(0x101)]({'componentId':'','reference':_0x1bc274,'version':_0x29b9ea[_0x1be347(0x115)],'componentName':_0x29b9ea[_0x1be347(0xe2)],'componentType':_0x29b9ea['Component_Type__c']});}[a177_0x22cb3f(0xe3)](_0x4726c0,_0x2344e4){const _0x424416=a177_0x22cb3f,{request:_0x267735}=composite_utils_1[_0x424416(0x122)](constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x424416(0x116)]+_0x424416(0xee)]:_0x4726c0,[constants_1[_0x424416(0x116)]+_0x424416(0x11b)]:_0x2344e4});return _0x267735;}async[a177_0x22cb3f(0xda)](_0x5675f9,_0x3f44bb){const _0x3be0fd=a177_0x22cb3f,_0x399169={},_0x213972=zip_1[_0x3be0fd(0xe9)][_0x3be0fd(0xe8)]();for(const _0x25df81 of Object[_0x3be0fd(0x118)](_0x5675f9['files'])){_0x213972[_0x3be0fd(0x10f)](_0x25df81,_0x5675f9[_0x3be0fd(0x10e)][_0x25df81],{'createFolders':!![]});}return _0x399169[_0x3be0fd(0x10c)]=_0x3be0fd(0xfa),_0x399169[_0x3be0fd(0xd6)]=_0x5675f9[_0x3be0fd(0xcd)],_0x399169[_0x3be0fd(0xd4)]=_0x5675f9[_0x3be0fd(0xcd)],_0x399169[_0x3be0fd(0xd7)]=_0x3f44bb,_0x399169[_0x3be0fd(0x117)]=await _0x213972[_0x3be0fd(0xf3)]({'type':_0x3be0fd(0xde),'compression':_0x3be0fd(0xc4),'compressionOptions':{'level':0x6}}),_0x399169;}['prepareComponentHistoryRecord'](_0x3db303,_0x5c1ac2,_0x136a60){const _0x493659=a177_0x22cb3f,_0x3cd76c=new Date()[_0x493659(0xcf)](),_0x169888={};return _0x169888[constants_1[_0x493659(0x116)]+'Component__c']=_0x5c1ac2,_0x169888[constants_1[_0x493659(0x116)]+'CRC32__c']=_0x3db303[_0x493659(0x109)],_0x169888[constants_1[_0x493659(0x116)]+_0x493659(0x107)]=_0x3cd76c,_0x169888[constants_1[_0x493659(0x116)]+_0x493659(0x124)]=this[_0x493659(0x121)],_0x169888[constants_1[_0x493659(0x116)]+_0x493659(0x115)]=_0x136a60?_0x136a60+0x1:0x1,_0x169888[constants_1[_0x493659(0xc0)]+_0x493659(0xc7)]=!![],_0x169888;}[a177_0x22cb3f(0xd1)](_0x262cdd,_0x2f1175){const _0x1b44fb=a177_0x22cb3f;var _0x1e9d1c,_0x420bcf;const _0x82e3a8=new Date()[_0x1b44fb(0xcf)](),_0x510e7f={};return!_0x2f1175?(this[_0x1b44fb(0xe6)]?(_0x510e7f[constants_1[_0x1b44fb(0x116)]+_0x1b44fb(0xd3)]=this[_0x1b44fb(0xe6)],_0x510e7f[constants_1['FLOSUM_NAMESPACE']+_0x1b44fb(0x103)]=_0x1b44fb(0x110),_0x510e7f['RecordTypeId']=(_0x1e9d1c=this[_0x1b44fb(0xef)]['find'](_0x242bb2=>_0x242bb2[_0x1b44fb(0xcc)]==='Branch'))===null||_0x1e9d1c===void 0x0?void 0x0:_0x1e9d1c['id']):(_0x510e7f[constants_1[_0x1b44fb(0x116)]+_0x1b44fb(0x120)]=this[_0x1b44fb(0xfe)],_0x510e7f[constants_1[_0x1b44fb(0x116)]+_0x1b44fb(0x103)]=_0x1b44fb(0x11a),_0x510e7f[_0x1b44fb(0x10a)]=(_0x420bcf=this[_0x1b44fb(0xef)][_0x1b44fb(0x11e)](_0x4cda39=>_0x4cda39['name']===_0x1b44fb(0x11a)))===null||_0x420bcf===void 0x0?void 0x0:_0x420bcf['id']),_0x510e7f[constants_1['FLOSUM_NAMESPACE']+_0x1b44fb(0x115)]=0x1):_0x510e7f[constants_1['FLOSUM_NAMESPACE']+_0x1b44fb(0x115)]=_0x2f1175['version']+0x1,_0x510e7f[constants_1[_0x1b44fb(0x116)]+_0x1b44fb(0xfc)]=_0x262cdd['type'],_0x510e7f[constants_1['FLOSUM_NAMESPACE']+'Component_Name__c']=_0x262cdd[_0x1b44fb(0xcc)],_0x510e7f[constants_1[_0x1b44fb(0x116)]+_0x1b44fb(0x111)]=_0x262cdd[_0x1b44fb(0x126)],_0x510e7f[constants_1[_0x1b44fb(0x116)]+_0x1b44fb(0xf9)]=this['username'],_0x510e7f[constants_1[_0x1b44fb(0x116)]+_0x1b44fb(0xe1)]=this['username'],_0x510e7f[constants_1['FLOSUM_NAMESPACE']+_0x1b44fb(0x125)]=_0x82e3a8,_0x510e7f[constants_1[_0x1b44fb(0x116)]+_0x1b44fb(0xed)]=_0x82e3a8,_0x510e7f[constants_1[_0x1b44fb(0x116)]+_0x1b44fb(0xca)]=_0x262cdd['crc'],_0x510e7f;}[a177_0x22cb3f(0x11c)](){const _0x12ce94=a177_0x22cb3f;return this[_0x12ce94(0xbf)];}async[a177_0x22cb3f(0xc5)](_0x6d12c,_0x2c6050){const _0x4ba1e3=a177_0x22cb3f,_0x250843=[];for(const _0x5b3e21 of _0x6d12c){const _0x2b38b1=composite_utils_1[_0x4ba1e3(0x122)](constants_1[_0x4ba1e3(0x100)],this[_0x4ba1e3(0xd1)](_0x5b3e21)),_0x3aa31=composite_utils_1['createPostRequest'](constants_1[_0x4ba1e3(0xc9)],this[_0x4ba1e3(0xf5)](_0x5b3e21,'@{'+_0x2b38b1[_0x4ba1e3(0xfd)]+'.id}')),_0x213d57=composite_utils_1[_0x4ba1e3(0x122)](constants_1[_0x4ba1e3(0x10b)],await this[_0x4ba1e3(0xda)](_0x5b3e21,'@{'+_0x3aa31[_0x4ba1e3(0xfd)]+_0x4ba1e3(0xfb)));this['proceedComponentMeta'](_0x2b38b1[_0x4ba1e3(0xe0)][_0x4ba1e3(0xdd)],_0x2b38b1[_0x4ba1e3(0xfd)]),_0x250843[_0x4ba1e3(0x101)](_0x2b38b1[_0x4ba1e3(0xe0)],_0x3aa31['request'],_0x213d57[_0x4ba1e3(0xe0)]),_0x2c6050&&_0x250843[_0x4ba1e3(0x101)](this[_0x4ba1e3(0xe3)](_0x2c6050,'@{'+_0x3aa31['reference']+'.id}'));}return _0x250843;}async[a177_0x22cb3f(0x108)](_0x580f1a,_0x8b761=''){const _0x5e2333=a177_0x22cb3f,_0x42802c=[];for(const {component:_0x7602e6,meta:_0x524716}of _0x580f1a){if(!_0x524716['id']){const _0x5ecccb=this['proceededComponentsMeta'][_0x5e2333(0x11e)](_0x2a6514=>_0x2a6514[_0x5e2333(0x105)]===_0x7602e6['name']&&_0x2a6514[_0x5e2333(0xe4)]===_0x7602e6[_0x5e2333(0xcd)]);if(!_0x5ecccb)throw new salesforce_error_1['SalesforceError'](new Error(_0x5e2333(0x127)+_0x7602e6[_0x5e2333(0xcc)]+'\x20['+_0x7602e6['type']+']\x20-\x20meta\x20not\x20found'));_0x524716['id']=_0x5ecccb['componentId'];}const _0x333ed7=composite_utils_1[_0x5e2333(0x11d)](constants_1[_0x5e2333(0x100)],_0x524716['id'],this['prepareComponentRecord'](_0x7602e6,_0x524716)),_0x4f8b2e=composite_utils_1[_0x5e2333(0x122)](constants_1[_0x5e2333(0xc9)],this[_0x5e2333(0xf5)](_0x7602e6,_0x524716['id'],_0x524716['version'])),_0x36da02=composite_utils_1[_0x5e2333(0x122)](constants_1[_0x5e2333(0x10b)],await this['prepareComponentAttachmentRecord'](_0x7602e6,'@{'+_0x4f8b2e[_0x5e2333(0xfd)]+_0x5e2333(0xfb)));this['proceedComponentMeta'](_0x333ed7[_0x5e2333(0xe0)][_0x5e2333(0xdd)],_0x333ed7[_0x5e2333(0xfd)]),_0x42802c[_0x5e2333(0x101)](_0x333ed7[_0x5e2333(0xe0)],_0x4f8b2e['request'],_0x36da02[_0x5e2333(0xe0)]),_0x8b761&&_0x42802c[_0x5e2333(0x101)](this['prepareCommitManifest'](_0x8b761,'@{'+_0x4f8b2e[_0x5e2333(0xfd)]+_0x5e2333(0xfb)));}return _0x42802c;}async[a177_0x22cb3f(0xd2)](_0x3bef6f,_0x502138=![]){const _0x2402e1=a177_0x22cb3f,_0x5f8de0={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x4e1d88=[];for(const _0x30ce97 of _0x3bef6f){if(_0x30ce97['id'])_0x4e1d88[_0x2402e1(0x101)](_0x30ce97['id']);else{const _0x118531=this[_0x2402e1(0xbf)][_0x2402e1(0x11e)](_0x356192=>_0x356192[_0x2402e1(0x105)]===_0x30ce97[_0x2402e1(0xcc)]&&_0x356192['componentType']===_0x30ce97['type']);if(!_0x118531||!_0x118531[_0x2402e1(0x102)])continue;_0x4e1d88[_0x2402e1(0x101)](_0x118531[_0x2402e1(0x102)]);}}if(_0x502138){const _0xbd8522=await this[_0x2402e1(0xdf)][_0x2402e1(0xc2)](_0x4e1d88);_0x5f8de0['manifests']=_0xbd8522[_0x2402e1(0xcb)](_0x53a93f=>composite_utils_1[_0x2402e1(0x106)](constants_1[_0x2402e1(0xd8)],_0x53a93f)[_0x2402e1(0xe0)]);}return _0x5f8de0[_0x2402e1(0xf8)]=_0x4e1d88[_0x2402e1(0xcb)](_0x3f1ff6=>composite_utils_1['createPatchRequest'](constants_1[_0x2402e1(0x100)],_0x3f1ff6,{[constants_1[_0x2402e1(0xc0)]+'Deletion_By_Agent__c']:!![]})[_0x2402e1(0xe0)]),_0x5f8de0['componentsToDelete']=_0x4e1d88[_0x2402e1(0xcb)](_0x499c42=>composite_utils_1['createDeleteRequest'](constants_1[_0x2402e1(0x100)],_0x499c42)['request']),_0x5f8de0;}}exports[a177_0x22cb3f(0x104)]=SalesforceComponentsManager;