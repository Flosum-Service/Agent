const a272_0x2aa5d1=a272_0x3f36;(function(_0x3a0533,_0x5ad926){const _0x44774d=a272_0x3f36,_0x1d7a79=_0x3a0533();while(!![]){try{const _0x175af8=parseInt(_0x44774d(0x229))/0x1*(-parseInt(_0x44774d(0x234))/0x2)+-parseInt(_0x44774d(0x218))/0x3+-parseInt(_0x44774d(0x211))/0x4+parseInt(_0x44774d(0x219))/0x5+parseInt(_0x44774d(0x206))/0x6+parseInt(_0x44774d(0x22a))/0x7+-parseInt(_0x44774d(0x20e))/0x8*(parseInt(_0x44774d(0x1e6))/0x9);if(_0x175af8===_0x5ad926)break;else _0x1d7a79['push'](_0x1d7a79['shift']());}catch(_0x2ebbb4){_0x1d7a79['push'](_0x1d7a79['shift']());}}}(a272_0x5abf,0xa906a));function a272_0x5abf(){const _0x211330=['type','logger','5221224INYTKf','reference','FLOSUM_ATTACHMENT','FLOSUM_COMPONENT','FLOSUM_GIT_NAMESPACE','componentsToUpdate','../utils/flosum-naming.utils','Last_Modified_Date__c','62728gmrIqb','proceededComponentsMeta','Last_Modified_By__c','1387884WTiOQT','branchId','FLOSUM_COMMIT_MANIFEST','./salesforce-git-sync.service','constructor','file','username','3746538WWbbzx','4203135pUQmzL','find',']\x20-\x20meta\x20not\x20found','request','Component__c','SalesforceGitSyncService','generateAsync','componentId','Vlocity_Component__c','toISOString','filePath','Source__c','createPostRequest','get','(((.+)+)+)+$','map','1ufrWIb','8248198SqWfBm','__importDefault','FLOSUM_COMPONENT_HISTORY','createZip','marketingCloudKey','crc','Description','.id}','proceedComponentMeta','vlocityComponentName','417896jUTiCX','Version__c','name','componentName','prepareComponentRecord','prepareComponentHistoryRecord','Component_Type__c','toString','repositoryId','update','prepareCommitManifest','base64','Deletion_By_Agent__c','../utils/composite.utils','recordTypes','CRC32__c','Changed_By__c','typedi','MC_Key__c','Zip','File_Name__c','componentType','search','manifests','version','RecordTypeId','450uYtxcI','FLOSUM_NAMESPACE','Vlocity_Component_Name__c','Component_Name__c','Last_Updated_By__c','apply','files','Logger','defineProperty','getProceededComponentsMeta','createPatchRequest','ContentType','extractFieldsFromRecord','prepareComponentAttachmentRecord','Changed_On__c','Branch','gitSync','Committed_On__c','insert','Component_History__c','isVlocityComponent','SalesforceError','push','Is_From_Agent__c','createDeleteRequest','body','SalesforceComponentsManager','Repository','fetchCommitManifestsByComponentIds','Repository__c'];a272_0x5abf=function(){return _0x211330;};return a272_0x5abf();}const a272_0x1af69c=(function(){let _0x4ce4fa=!![];return function(_0x24b61,_0x22f7f9){const _0x528ef9=_0x4ce4fa?function(){const _0x38e915=a272_0x3f36;if(_0x22f7f9){const _0x5d3861=_0x22f7f9[_0x38e915(0x1eb)](_0x24b61,arguments);return _0x22f7f9=null,_0x5d3861;}}:function(){};return _0x4ce4fa=![],_0x528ef9;};}()),a272_0x9d7841=a272_0x1af69c(this,function(){const _0x1c381e=a272_0x3f36;return a272_0x9d7841[_0x1c381e(0x23b)]()['search']('(((.+)+)+)+$')['toString']()[_0x1c381e(0x215)](a272_0x9d7841)[_0x1c381e(0x1e2)](_0x1c381e(0x227));});a272_0x9d7841();'use strict';var __importDefault=this&&this[a272_0x2aa5d1(0x22b)]||function(_0x384c9f){return _0x384c9f&&_0x384c9f['__esModule']?_0x384c9f:{'default':_0x384c9f};};Object[a272_0x2aa5d1(0x1ee)](exports,'__esModule',{'value':!![]}),exports[a272_0x2aa5d1(0x200)]=void 0x0;function a272_0x3f36(_0x4e5b65,_0x1f650c){const _0x1ab076=a272_0x5abf();return a272_0x3f36=function(_0x9d7841,_0x1af69c){_0x9d7841=_0x9d7841-0x1d4;let _0x5abf91=_0x1ab076[_0x9d7841];return _0x5abf91;},a272_0x3f36(_0x4e5b65,_0x1f650c);}const constants_1=require('../../../../constants'),core_1=require('../../../../core'),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a272_0x2aa5d1(0x1dd))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a272_0x2aa5d1(0x1d9)),flosum_naming_utils_1=require(a272_0x2aa5d1(0x20c)),salesforce_git_sync_service_1=require(a272_0x2aa5d1(0x214));class SalesforceComponentsManager{constructor(_0xb6584b,_0x4403a0,_0x1c046e,_0x748143,_0x68b6eb){const _0x4c7faf=a272_0x2aa5d1;this[_0x4c7faf(0x1d4)]=_0xb6584b,this[_0x4c7faf(0x212)]=_0x4403a0,this[_0x4c7faf(0x217)]=_0x1c046e,this[_0x4c7faf(0x1da)]=_0x748143,this[_0x4c7faf(0x20f)]=_0x68b6eb,this[_0x4c7faf(0x205)]=new core_1[(_0x4c7faf(0x1ed))](SalesforceComponentsManager[_0x4c7faf(0x236)]),this[_0x4c7faf(0x1f6)]=typedi_1['default'][_0x4c7faf(0x226)](salesforce_git_sync_service_1[_0x4c7faf(0x21e)]);}[a272_0x2aa5d1(0x232)](_0x38b0b9,_0x5e667f){const _0x3c8fa2=a272_0x2aa5d1,_0x552021=(0x0,flosum_naming_utils_1[_0x3c8fa2(0x1f2)])(_0x38b0b9,['Component_Type__c',_0x3c8fa2(0x1e9),_0x3c8fa2(0x235)]);this[_0x3c8fa2(0x20f)]['push']({'componentId':'','reference':_0x5e667f,'version':_0x552021[_0x3c8fa2(0x235)],'componentName':_0x552021[_0x3c8fa2(0x1e9)],'componentType':_0x552021[_0x3c8fa2(0x23a)]});}[a272_0x2aa5d1(0x1d6)](_0x4bfc70,_0x44c84f){const _0x23b5d7=a272_0x2aa5d1,{request:_0x153e8f}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x23b5d7(0x213)],{[constants_1['FLOSUM_NAMESPACE']+'Commit__c']:_0x4bfc70,[constants_1['FLOSUM_NAMESPACE']+_0x23b5d7(0x1f9)]:_0x44c84f});return _0x153e8f;}async['prepareComponentAttachmentRecord'](_0x543369,_0x4aa1e4){const _0x25c46e=a272_0x2aa5d1,_0x25ea27={},_0x14e258=zip_1[_0x25c46e(0x1df)][_0x25c46e(0x22d)]();for(const _0x3c4d19 of Object['keys'](_0x543369['files'])){_0x14e258[_0x25c46e(0x216)](_0x3c4d19,_0x543369[_0x25c46e(0x1ec)][_0x3c4d19],{'createFolders':!![]});}return _0x25ea27[_0x25c46e(0x1f1)]='application/zip',_0x25ea27['Name']=_0x543369[_0x25c46e(0x204)],_0x25ea27[_0x25c46e(0x230)]=_0x543369[_0x25c46e(0x204)],_0x25ea27['ParentId']=_0x4aa1e4,_0x25ea27['Body']=await _0x14e258[_0x25c46e(0x21f)]({'type':_0x25c46e(0x1d7),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x25ea27;}[a272_0x2aa5d1(0x239)](_0x2fc3b8,_0x275799,_0x44864d){const _0x3afd6d=a272_0x2aa5d1,_0x47d798=new Date()[_0x3afd6d(0x222)](),_0x2983ff={};return _0x2983ff[constants_1[_0x3afd6d(0x1e7)]+_0x3afd6d(0x21d)]=_0x275799,_0x2983ff[constants_1['FLOSUM_NAMESPACE']+_0x3afd6d(0x1db)]=_0x2fc3b8[_0x3afd6d(0x22f)],_0x2983ff[constants_1[_0x3afd6d(0x1e7)]+_0x3afd6d(0x1f4)]=_0x47d798,_0x2983ff[constants_1[_0x3afd6d(0x1e7)]+_0x3afd6d(0x1dc)]=this[_0x3afd6d(0x217)],_0x2983ff[constants_1[_0x3afd6d(0x1e7)]+'Version__c']=_0x44864d?_0x44864d+0x1:0x1,_0x2983ff[constants_1[_0x3afd6d(0x20a)]+_0x3afd6d(0x1fd)]=!![],_0x2983ff;}[a272_0x2aa5d1(0x238)](_0xbc4954,_0x437d4d){const _0x185e08=a272_0x2aa5d1;var _0x7c733e,_0x586311;const _0x928b9f=new Date()[_0x185e08(0x222)](),_0x501204={};return!_0x437d4d?(this[_0x185e08(0x212)]?(_0x501204[constants_1[_0x185e08(0x1e7)]+'Branch__c']=this[_0x185e08(0x212)],_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x224)]=_0x185e08(0x1f5),_0x501204['RecordTypeId']=(_0x7c733e=this[_0x185e08(0x1da)][_0x185e08(0x21a)](_0x4363b2=>_0x4363b2[_0x185e08(0x236)]===_0x185e08(0x1f5)))===null||_0x7c733e===void 0x0?void 0x0:_0x7c733e['id']):(_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x203)]=this[_0x185e08(0x1d4)],_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x224)]=_0x185e08(0x201),_0x501204[_0x185e08(0x1e5)]=(_0x586311=this[_0x185e08(0x1da)][_0x185e08(0x21a)](_0x5d713c=>_0x5d713c[_0x185e08(0x236)]===_0x185e08(0x201)))===null||_0x586311===void 0x0?void 0x0:_0x586311['id']),_0x501204[constants_1['FLOSUM_NAMESPACE']+_0x185e08(0x235)]=0x1):_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x235)]=_0x437d4d[_0x185e08(0x1e4)]+0x1,_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x23a)]=_0xbc4954[_0x185e08(0x204)],_0x501204[constants_1['FLOSUM_NAMESPACE']+_0x185e08(0x1e9)]=_0xbc4954[_0x185e08(0x236)],_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x1e0)]=_0xbc4954[_0x185e08(0x223)],_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x1ea)]=this[_0x185e08(0x217)],_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x210)]=this[_0x185e08(0x217)],_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x20d)]=_0x928b9f,_0x501204[constants_1['FLOSUM_NAMESPACE']+_0x185e08(0x1f7)]=_0x928b9f,_0x501204[constants_1['FLOSUM_NAMESPACE']+_0x185e08(0x1db)]=_0xbc4954['crc'],_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x1e8)]=_0xbc4954[_0x185e08(0x233)],_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x221)]=_0xbc4954[_0x185e08(0x1fa)],_0x501204[constants_1[_0x185e08(0x1e7)]+_0x185e08(0x1de)]=_0xbc4954[_0x185e08(0x22e)],_0x501204;}[a272_0x2aa5d1(0x1ef)](){const _0x5b0e8c=a272_0x2aa5d1;return this[_0x5b0e8c(0x20f)];}async[a272_0x2aa5d1(0x1f8)](_0x4c650f,_0x232bdd){const _0x5e134c=a272_0x2aa5d1,_0x233d9f=[];for(const _0x1854de of _0x4c650f){const _0x2e8be6=(0x0,composite_utils_1[_0x5e134c(0x225)])(constants_1[_0x5e134c(0x209)],this[_0x5e134c(0x238)](_0x1854de)),_0x11e0fe=(0x0,composite_utils_1[_0x5e134c(0x225)])(constants_1[_0x5e134c(0x22c)],this[_0x5e134c(0x239)](_0x1854de,'@{'+_0x2e8be6['reference']+_0x5e134c(0x231))),_0x57884=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x5e134c(0x208)],await this['prepareComponentAttachmentRecord'](_0x1854de,'@{'+_0x11e0fe[_0x5e134c(0x207)]+_0x5e134c(0x231)));this['proceedComponentMeta'](_0x2e8be6['request']['body'],_0x2e8be6['reference']),_0x233d9f[_0x5e134c(0x1fc)](_0x2e8be6[_0x5e134c(0x21c)],_0x11e0fe[_0x5e134c(0x21c)],_0x57884[_0x5e134c(0x21c)]),_0x232bdd&&_0x233d9f['push'](this[_0x5e134c(0x1d6)](_0x232bdd,'@{'+_0x11e0fe['reference']+_0x5e134c(0x231)));}return _0x233d9f;}async[a272_0x2aa5d1(0x1d5)](_0x133652,_0x10ca94=''){const _0x123e79=a272_0x2aa5d1,_0x16b1e8=[];for(const {component:_0x5af386,meta:_0x1bea22}of _0x133652){if(!_0x1bea22['id']){const _0x5825c7=this[_0x123e79(0x20f)][_0x123e79(0x21a)](_0x4d3415=>_0x4d3415[_0x123e79(0x237)]===_0x5af386[_0x123e79(0x236)]&&_0x4d3415['componentType']===_0x5af386[_0x123e79(0x204)]);if(!_0x5825c7)throw new salesforce_error_1[(_0x123e79(0x1fb))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x5af386['name']+'\x20['+_0x5af386[_0x123e79(0x204)]+_0x123e79(0x21b)));_0x1bea22['id']=_0x5825c7['componentId'];}const _0x2fc3d6=(0x0,composite_utils_1[_0x123e79(0x1f0)])(constants_1[_0x123e79(0x209)],_0x1bea22['id'],this[_0x123e79(0x238)](_0x5af386,_0x1bea22)),_0x409ba7=(0x0,composite_utils_1[_0x123e79(0x225)])(constants_1[_0x123e79(0x22c)],this[_0x123e79(0x239)](_0x5af386,_0x1bea22['id'],_0x1bea22[_0x123e79(0x1e4)])),_0xb1b22c=(0x0,composite_utils_1[_0x123e79(0x225)])(constants_1[_0x123e79(0x208)],await this[_0x123e79(0x1f3)](_0x5af386,'@{'+_0x409ba7[_0x123e79(0x207)]+_0x123e79(0x231)));this['proceedComponentMeta'](_0x2fc3d6[_0x123e79(0x21c)][_0x123e79(0x1ff)],_0x2fc3d6[_0x123e79(0x207)]),_0x16b1e8[_0x123e79(0x1fc)](_0x2fc3d6[_0x123e79(0x21c)],_0x409ba7[_0x123e79(0x21c)],_0xb1b22c['request']),_0x10ca94&&_0x16b1e8['push'](this[_0x123e79(0x1d6)](_0x10ca94,'@{'+_0x409ba7[_0x123e79(0x207)]+_0x123e79(0x231)));}return _0x16b1e8;}async['delete'](_0x41bd9d,_0x3bedef=![]){const _0x405bfc=a272_0x2aa5d1,_0xc556c7={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x271dff=[];for(const _0x2de7b1 of _0x41bd9d){if(_0x2de7b1['id'])_0x271dff[_0x405bfc(0x1fc)](_0x2de7b1['id']);else{const _0x509983=this[_0x405bfc(0x20f)][_0x405bfc(0x21a)](_0x3ff5da=>_0x3ff5da[_0x405bfc(0x237)]===_0x2de7b1[_0x405bfc(0x236)]&&_0x3ff5da[_0x405bfc(0x1e1)]===_0x2de7b1['type']);if(!_0x509983||!_0x509983['componentId'])continue;_0x271dff['push'](_0x509983[_0x405bfc(0x220)]);}}if(_0x3bedef){const _0x2361da=await this['gitSync'][_0x405bfc(0x202)](_0x271dff);_0xc556c7[_0x405bfc(0x1e3)]=_0x2361da['map'](_0x498693=>(0x0,composite_utils_1[_0x405bfc(0x1fe)])(constants_1[_0x405bfc(0x213)],_0x498693)[_0x405bfc(0x21c)]);}return _0xc556c7[_0x405bfc(0x20b)]=_0x271dff[_0x405bfc(0x228)](_0x2a6602=>(0x0,composite_utils_1[_0x405bfc(0x1f0)])(constants_1[_0x405bfc(0x209)],_0x2a6602,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x405bfc(0x1d8)]:!![]})[_0x405bfc(0x21c)]),_0xc556c7['componentsToDelete']=_0x271dff['map'](_0x8e186=>(0x0,composite_utils_1[_0x405bfc(0x1fe)])(constants_1['FLOSUM_COMPONENT'],_0x8e186)['request']),_0xc556c7;}}exports[a272_0x2aa5d1(0x200)]=SalesforceComponentsManager;