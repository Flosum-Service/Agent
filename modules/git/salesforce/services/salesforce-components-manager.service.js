const a229_0x43e249=a229_0xd1aa;(function(_0x2d29dd,_0x36952a){const _0x57ca30=a229_0xd1aa,_0x417d3c=_0x2d29dd();while(!![]){try{const _0x3a4f24=parseInt(_0x57ca30(0x17d))/0x1*(parseInt(_0x57ca30(0x16d))/0x2)+parseInt(_0x57ca30(0x183))/0x3*(parseInt(_0x57ca30(0x145))/0x4)+-parseInt(_0x57ca30(0x195))/0x5*(-parseInt(_0x57ca30(0x167))/0x6)+-parseInt(_0x57ca30(0x1a7))/0x7+-parseInt(_0x57ca30(0x1ab))/0x8*(parseInt(_0x57ca30(0x18a))/0x9)+-parseInt(_0x57ca30(0x165))/0xa*(-parseInt(_0x57ca30(0x154))/0xb)+parseInt(_0x57ca30(0x1a6))/0xc*(-parseInt(_0x57ca30(0x14d))/0xd);if(_0x3a4f24===_0x36952a)break;else _0x417d3c['push'](_0x417d3c['shift']());}catch(_0xe2ab1e){_0x417d3c['push'](_0x417d3c['shift']());}}}(a229_0x59eb,0x6475b));const a229_0x1aa25c=(function(){let _0x23d08d=!![];return function(_0xd4091,_0x3965b8){const _0x549ff8=_0x23d08d?function(){const _0x3ec6a4=a229_0xd1aa;if(_0x3965b8){const _0x203b27=_0x3965b8[_0x3ec6a4(0x1a5)](_0xd4091,arguments);return _0x3965b8=null,_0x203b27;}}:function(){};return _0x23d08d=![],_0x549ff8;};}()),a229_0x5bc61f=a229_0x1aa25c(this,function(){const _0x440476=a229_0xd1aa;return a229_0x5bc61f[_0x440476(0x190)]()[_0x440476(0x151)](_0x440476(0x18d))['toString']()[_0x440476(0x178)](a229_0x5bc61f)[_0x440476(0x151)]('(((.+)+)+)+$');});a229_0x5bc61f();'use strict';function a229_0x59eb(){const _0x4eedc4=['componentName','file','files','SalesforceGitSyncService','Component__c','FLOSUM_COMMIT_MANIFEST','30Dedexi','FLOSUM_GIT_NAMESPACE','60jBIDwK','Component_History__c','createPatchRequest','../../parsers/utils/zip','branchId','recordTypes','655432EFMmhp','componentsToDelete','toISOString','Name','componentsToUpdate','Last_Modified_By__c',']\x20-\x20meta\x20not\x20found','FLOSUM_NAMESPACE','Component_Name__c','repositoryId','map','constructor','Commit__c','Logger','Branch','base64','2PjRVMY','body','prepareComponentRecord','SalesforceComponentsManager','Deletion_By_Agent__c','ContentType','317742VjhGlO','name','find','Could\x20not\x20proceed\x20component\x20','Last_Modified_Date__c','prepareCommitManifest','application/zip','3696426kELZeB','fetchCommitManifestsByComponentIds','crc','(((.+)+)+)+$','prepareComponentAttachmentRecord','RecordTypeId','toString','../../../../core','get','__esModule','File_Name__c','235035SYDcxe','Is_From_Agent__c','../utils/flosum-naming.utils','gitSync','insert','generateAsync','createPostRequest','reference','.id}','proceedComponentMeta','push','filePath','version','logger','Version__c','createDeleteRequest','apply','132xZCfGw','1716799avwGrj','default','extractFieldsFromRecord','../../../../constants','8FcWRyi','type','24aoKlow','componentId','Source__c','FLOSUM_COMPONENT_HISTORY','request','Zip','Last_Updated_By__c','delete','1623284xnHBVC','FLOSUM_COMPONENT','username','prepareComponentHistoryRecord','search','proceededComponentsMeta','Changed_By__c','2493392wIGYsM','createZip','Component_Type__c','DEFLATE','../utils/composite.utils','Repository','Committed_On__c','FLOSUM_ATTACHMENT','SalesforceError','CRC32__c','Changed_On__c'];a229_0x59eb=function(){return _0x4eedc4;};return a229_0x59eb();}var __importDefault=this&&this['__importDefault']||function(_0x4c6e63){const _0x3b2009=a229_0xd1aa;return _0x4c6e63&&_0x4c6e63[_0x3b2009(0x193)]?_0x4c6e63:{'default':_0x4c6e63};};Object['defineProperty'](exports,a229_0x43e249(0x193),{'value':!![]}),exports[a229_0x43e249(0x180)]=void 0x0;const constants_1=require(a229_0x43e249(0x1aa)),core_1=require(a229_0x43e249(0x191)),zip_1=require(a229_0x43e249(0x16a)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a229_0x43e249(0x158)),flosum_naming_utils_1=require(a229_0x43e249(0x197)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x576150,_0x375ab6,_0x4418c3,_0x124bd9,_0x24224c){const _0x486bd0=a229_0x43e249;this[_0x486bd0(0x176)]=_0x576150,this[_0x486bd0(0x16b)]=_0x375ab6,this[_0x486bd0(0x14f)]=_0x4418c3,this[_0x486bd0(0x16c)]=_0x124bd9,this['proceededComponentsMeta']=_0x24224c,this[_0x486bd0(0x1a2)]=new core_1[(_0x486bd0(0x17a))](SalesforceComponentsManager[_0x486bd0(0x184)]),this[_0x486bd0(0x198)]=typedi_1[_0x486bd0(0x1a8)][_0x486bd0(0x192)](salesforce_git_sync_service_1[_0x486bd0(0x162)]);}[a229_0x43e249(0x19e)](_0x222ec6,_0x59d0de){const _0x28776e=a229_0x43e249,_0x1ae0a8=(0x0,flosum_naming_utils_1[_0x28776e(0x1a9)])(_0x222ec6,[_0x28776e(0x156),'Component_Name__c',_0x28776e(0x1a3)]);this[_0x28776e(0x152)]['push']({'componentId':'','reference':_0x59d0de,'version':_0x1ae0a8[_0x28776e(0x1a3)],'componentName':_0x1ae0a8[_0x28776e(0x175)],'componentType':_0x1ae0a8[_0x28776e(0x156)]});}[a229_0x43e249(0x188)](_0x3d6db3,_0x102d29){const _0x21794d=a229_0x43e249,{request:_0x4731c6}=(0x0,composite_utils_1[_0x21794d(0x19b)])(constants_1[_0x21794d(0x164)],{[constants_1[_0x21794d(0x174)]+_0x21794d(0x179)]:_0x3d6db3,[constants_1[_0x21794d(0x174)]+_0x21794d(0x168)]:_0x102d29});return _0x4731c6;}async[a229_0x43e249(0x18e)](_0x4f8c7c,_0x3530b9){const _0x354edd=a229_0x43e249,_0x5e8903={},_0x29b38a=zip_1[_0x354edd(0x14a)][_0x354edd(0x155)]();for(const _0x5ca946 of Object['keys'](_0x4f8c7c['files'])){_0x29b38a[_0x354edd(0x160)](_0x5ca946,_0x4f8c7c[_0x354edd(0x161)][_0x5ca946],{'createFolders':!![]});}return _0x5e8903[_0x354edd(0x182)]=_0x354edd(0x189),_0x5e8903[_0x354edd(0x170)]=_0x4f8c7c['type'],_0x5e8903['Description']=_0x4f8c7c[_0x354edd(0x144)],_0x5e8903['ParentId']=_0x3530b9,_0x5e8903['Body']=await _0x29b38a[_0x354edd(0x19a)]({'type':_0x354edd(0x17c),'compression':_0x354edd(0x157),'compressionOptions':{'level':0x6}}),_0x5e8903;}[a229_0x43e249(0x150)](_0x5526cc,_0x3f5684,_0x2d3d97){const _0x20145a=a229_0x43e249,_0x47b433=new Date()[_0x20145a(0x16f)](),_0x37e4c3={};return _0x37e4c3[constants_1['FLOSUM_NAMESPACE']+_0x20145a(0x163)]=_0x3f5684,_0x37e4c3[constants_1['FLOSUM_NAMESPACE']+_0x20145a(0x15d)]=_0x5526cc[_0x20145a(0x18c)],_0x37e4c3[constants_1[_0x20145a(0x174)]+_0x20145a(0x15e)]=_0x47b433,_0x37e4c3[constants_1['FLOSUM_NAMESPACE']+_0x20145a(0x153)]=this[_0x20145a(0x14f)],_0x37e4c3[constants_1[_0x20145a(0x174)]+_0x20145a(0x1a3)]=_0x2d3d97?_0x2d3d97+0x1:0x1,_0x37e4c3[constants_1['FLOSUM_GIT_NAMESPACE']+_0x20145a(0x196)]=!![],_0x37e4c3;}[a229_0x43e249(0x17f)](_0x280f0b,_0x3439d5){const _0x3d2e31=a229_0x43e249;var _0x30a946,_0x40b547;const _0x379318=new Date()[_0x3d2e31(0x16f)](),_0x25693a={};return!_0x3439d5?(this[_0x3d2e31(0x16b)]?(_0x25693a[constants_1[_0x3d2e31(0x174)]+'Branch__c']=this[_0x3d2e31(0x16b)],_0x25693a[constants_1[_0x3d2e31(0x174)]+_0x3d2e31(0x147)]='Branch',_0x25693a[_0x3d2e31(0x18f)]=(_0x30a946=this[_0x3d2e31(0x16c)][_0x3d2e31(0x185)](_0xa8185c=>_0xa8185c[_0x3d2e31(0x184)]===_0x3d2e31(0x17b)))===null||_0x30a946===void 0x0?void 0x0:_0x30a946['id']):(_0x25693a[constants_1[_0x3d2e31(0x174)]+'Repository__c']=this[_0x3d2e31(0x176)],_0x25693a[constants_1[_0x3d2e31(0x174)]+_0x3d2e31(0x147)]='Repository',_0x25693a[_0x3d2e31(0x18f)]=(_0x40b547=this['recordTypes']['find'](_0x511881=>_0x511881['name']===_0x3d2e31(0x159)))===null||_0x40b547===void 0x0?void 0x0:_0x40b547['id']),_0x25693a[constants_1[_0x3d2e31(0x174)]+_0x3d2e31(0x1a3)]=0x1):_0x25693a[constants_1[_0x3d2e31(0x174)]+_0x3d2e31(0x1a3)]=_0x3439d5[_0x3d2e31(0x1a1)]+0x1,_0x25693a[constants_1[_0x3d2e31(0x174)]+_0x3d2e31(0x156)]=_0x280f0b['type'],_0x25693a[constants_1[_0x3d2e31(0x174)]+_0x3d2e31(0x175)]=_0x280f0b[_0x3d2e31(0x184)],_0x25693a[constants_1['FLOSUM_NAMESPACE']+_0x3d2e31(0x194)]=_0x280f0b[_0x3d2e31(0x1a0)],_0x25693a[constants_1[_0x3d2e31(0x174)]+_0x3d2e31(0x14b)]=this[_0x3d2e31(0x14f)],_0x25693a[constants_1[_0x3d2e31(0x174)]+_0x3d2e31(0x172)]=this[_0x3d2e31(0x14f)],_0x25693a[constants_1[_0x3d2e31(0x174)]+_0x3d2e31(0x187)]=_0x379318,_0x25693a[constants_1[_0x3d2e31(0x174)]+_0x3d2e31(0x15a)]=_0x379318,_0x25693a[constants_1[_0x3d2e31(0x174)]+_0x3d2e31(0x15d)]=_0x280f0b[_0x3d2e31(0x18c)],_0x25693a;}['getProceededComponentsMeta'](){const _0x43461a=a229_0x43e249;return this[_0x43461a(0x152)];}async[a229_0x43e249(0x199)](_0x247257,_0x4f2583){const _0x54a4b7=a229_0x43e249,_0x1bd03a=[];for(const _0xf6dd49 of _0x247257){const _0xfe0843=(0x0,composite_utils_1[_0x54a4b7(0x19b)])(constants_1[_0x54a4b7(0x14e)],this[_0x54a4b7(0x17f)](_0xf6dd49)),_0x10dabc=(0x0,composite_utils_1[_0x54a4b7(0x19b)])(constants_1[_0x54a4b7(0x148)],this['prepareComponentHistoryRecord'](_0xf6dd49,'@{'+_0xfe0843[_0x54a4b7(0x19c)]+_0x54a4b7(0x19d))),_0x5e6451=(0x0,composite_utils_1[_0x54a4b7(0x19b)])(constants_1[_0x54a4b7(0x15b)],await this[_0x54a4b7(0x18e)](_0xf6dd49,'@{'+_0x10dabc[_0x54a4b7(0x19c)]+_0x54a4b7(0x19d)));this[_0x54a4b7(0x19e)](_0xfe0843[_0x54a4b7(0x149)]['body'],_0xfe0843['reference']),_0x1bd03a[_0x54a4b7(0x19f)](_0xfe0843[_0x54a4b7(0x149)],_0x10dabc['request'],_0x5e6451[_0x54a4b7(0x149)]),_0x4f2583&&_0x1bd03a[_0x54a4b7(0x19f)](this[_0x54a4b7(0x188)](_0x4f2583,'@{'+_0x10dabc[_0x54a4b7(0x19c)]+_0x54a4b7(0x19d)));}return _0x1bd03a;}async['update'](_0x109ee0,_0x2a4f45=''){const _0x42b781=a229_0x43e249,_0x556f6d=[];for(const {component:_0x1a0f3e,meta:_0x93aab8}of _0x109ee0){if(!_0x93aab8['id']){const _0x2116ec=this[_0x42b781(0x152)][_0x42b781(0x185)](_0x196b30=>_0x196b30[_0x42b781(0x15f)]===_0x1a0f3e[_0x42b781(0x184)]&&_0x196b30['componentType']===_0x1a0f3e['type']);if(!_0x2116ec)throw new salesforce_error_1[(_0x42b781(0x15c))](new Error(_0x42b781(0x186)+_0x1a0f3e[_0x42b781(0x184)]+'\x20['+_0x1a0f3e['type']+_0x42b781(0x173)));_0x93aab8['id']=_0x2116ec[_0x42b781(0x146)];}const _0x343573=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x42b781(0x14e)],_0x93aab8['id'],this[_0x42b781(0x17f)](_0x1a0f3e,_0x93aab8)),_0x21eca4=(0x0,composite_utils_1[_0x42b781(0x19b)])(constants_1[_0x42b781(0x148)],this[_0x42b781(0x150)](_0x1a0f3e,_0x93aab8['id'],_0x93aab8[_0x42b781(0x1a1)])),_0x2d25dd=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x42b781(0x15b)],await this[_0x42b781(0x18e)](_0x1a0f3e,'@{'+_0x21eca4[_0x42b781(0x19c)]+_0x42b781(0x19d)));this[_0x42b781(0x19e)](_0x343573['request'][_0x42b781(0x17e)],_0x343573[_0x42b781(0x19c)]),_0x556f6d[_0x42b781(0x19f)](_0x343573['request'],_0x21eca4['request'],_0x2d25dd[_0x42b781(0x149)]),_0x2a4f45&&_0x556f6d['push'](this[_0x42b781(0x188)](_0x2a4f45,'@{'+_0x21eca4[_0x42b781(0x19c)]+_0x42b781(0x19d)));}return _0x556f6d;}async[a229_0x43e249(0x14c)](_0x26c5b9,_0x17fe37=![]){const _0x188012=a229_0x43e249,_0x36dac8={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x434e57=[];for(const _0x11372f of _0x26c5b9){if(_0x11372f['id'])_0x434e57['push'](_0x11372f['id']);else{const _0x2543ef=this[_0x188012(0x152)][_0x188012(0x185)](_0x45f831=>_0x45f831['componentName']===_0x11372f[_0x188012(0x184)]&&_0x45f831['componentType']===_0x11372f[_0x188012(0x144)]);if(!_0x2543ef||!_0x2543ef[_0x188012(0x146)])continue;_0x434e57[_0x188012(0x19f)](_0x2543ef[_0x188012(0x146)]);}}if(_0x17fe37){const _0x28ec08=await this[_0x188012(0x198)][_0x188012(0x18b)](_0x434e57);_0x36dac8['manifests']=_0x28ec08[_0x188012(0x177)](_0x48e451=>(0x0,composite_utils_1[_0x188012(0x1a4)])(constants_1[_0x188012(0x164)],_0x48e451)[_0x188012(0x149)]);}return _0x36dac8[_0x188012(0x171)]=_0x434e57['map'](_0x2d5bc9=>(0x0,composite_utils_1[_0x188012(0x169)])(constants_1['FLOSUM_COMPONENT'],_0x2d5bc9,{[constants_1[_0x188012(0x166)]+_0x188012(0x181)]:!![]})[_0x188012(0x149)]),_0x36dac8[_0x188012(0x16e)]=_0x434e57[_0x188012(0x177)](_0x47c1dc=>(0x0,composite_utils_1[_0x188012(0x1a4)])(constants_1[_0x188012(0x14e)],_0x47c1dc)[_0x188012(0x149)]),_0x36dac8;}}function a229_0xd1aa(_0xcb0367,_0x5692f6){const _0x32acc6=a229_0x59eb();return a229_0xd1aa=function(_0x5bc61f,_0x1aa25c){_0x5bc61f=_0x5bc61f-0x144;let _0x59ebba=_0x32acc6[_0x5bc61f];return _0x59ebba;},a229_0xd1aa(_0xcb0367,_0x5692f6);}exports[a229_0x43e249(0x180)]=SalesforceComponentsManager;