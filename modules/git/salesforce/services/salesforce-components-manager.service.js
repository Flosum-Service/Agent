const a229_0x434d0a=a229_0x1234;(function(_0xeda59d,_0x14b643){const _0x11e809=a229_0x1234,_0x2c7622=_0xeda59d();while(!![]){try{const _0x55f2b2=parseInt(_0x11e809(0x13e))/0x1+parseInt(_0x11e809(0x170))/0x2*(-parseInt(_0x11e809(0x14a))/0x3)+-parseInt(_0x11e809(0x165))/0x4*(-parseInt(_0x11e809(0x12d))/0x5)+parseInt(_0x11e809(0x135))/0x6+parseInt(_0x11e809(0x152))/0x7+parseInt(_0x11e809(0x129))/0x8+-parseInt(_0x11e809(0x130))/0x9;if(_0x55f2b2===_0x14b643)break;else _0x2c7622['push'](_0x2c7622['shift']());}catch(_0x16d6a1){_0x2c7622['push'](_0x2c7622['shift']());}}}(a229_0x4fa5,0x32635));function a229_0x1234(_0x15d58c,_0x11ea24){const _0x154919=a229_0x4fa5();return a229_0x1234=function(_0x1e677d,_0x306880){_0x1e677d=_0x1e677d-0x114;let _0x4fa5c1=_0x154919[_0x1e677d];return _0x4fa5c1;},a229_0x1234(_0x15d58c,_0x11ea24);}const a229_0x306880=(function(){let _0x14c16b=!![];return function(_0x19773a,_0x1c498f){const _0x32366b=_0x14c16b?function(){const _0x3c1aba=a229_0x1234;if(_0x1c498f){const _0x588139=_0x1c498f[_0x3c1aba(0x161)](_0x19773a,arguments);return _0x1c498f=null,_0x588139;}}:function(){};return _0x14c16b=![],_0x32366b;};}()),a229_0x1e677d=a229_0x306880(this,function(){const _0x38424d=a229_0x1234;return a229_0x1e677d[_0x38424d(0x11b)]()[_0x38424d(0x16c)]('(((.+)+)+)+$')[_0x38424d(0x11b)]()[_0x38424d(0x162)](a229_0x1e677d)[_0x38424d(0x16c)](_0x38424d(0x11c));});a229_0x1e677d();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x31d9c5){const _0xd7cb33=a229_0x1234;return _0x31d9c5&&_0x31d9c5[_0xd7cb33(0x11e)]?_0x31d9c5:{'default':_0x31d9c5};};function a229_0x4fa5(){const _0x24c9da=['createDeleteRequest','prepareComponentAttachmentRecord','componentName','13565GaoCGj','SalesforceError','componentsToDelete','3380049eJeRTf','FLOSUM_COMPONENT','generateAsync','FLOSUM_GIT_NAMESPACE','createZip','750ZpMWgm','file','Committed_On__c','name','defineProperty','Component__c','typedi','Could\x20not\x20proceed\x20component\x20','toISOString','310158rXeMzB','RecordTypeId','prepareComponentRecord','Deletion_By_Agent__c','proceedComponentMeta','Version__c','../utils/composite.utils','Last_Modified_By__c','../../parsers/utils/zip','Logger','prepareComponentHistoryRecord','FLOSUM_ATTACHMENT','78LjfXtI','recordTypes','Changed_On__c','body','branchId','map','FLOSUM_COMPONENT_HISTORY','Component_Name__c','394429yPMUmM','fetchCommitManifestsByComponentIds','Component_Type__c','../errors/salesforce.error','createPatchRequest','Name','logger','Repository','push','Component_History__c','Commit__c','version','Last_Updated_By__c','./salesforce-git-sync.service','ParentId','apply','constructor','File_Name__c','CRC32__c','296wvQfus','crc','FLOSUM_COMMIT_MANIFEST','Repository__c','find','type','ContentType','search','../../../../core','Branch','.id}','2938aahOZM','Branch__c','gitSync','componentType','application/zip','FLOSUM_NAMESPACE','delete','files','prepareCommitManifest','username','componentId','reference','toString','(((.+)+)+)+$','Changed_By__c','__esModule','request','repositoryId','DEFLATE','Last_Modified_Date__c','proceededComponentsMeta','get','createPostRequest','update',']\x20-\x20meta\x20not\x20found','../../../../constants','422016PAesMC'];a229_0x4fa5=function(){return _0x24c9da;};return a229_0x4fa5();}Object[a229_0x434d0a(0x139)](exports,a229_0x434d0a(0x11e),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a229_0x434d0a(0x128)),core_1=require(a229_0x434d0a(0x16d)),zip_1=require(a229_0x434d0a(0x146)),typedi_1=__importDefault(require(a229_0x434d0a(0x13b))),salesforce_error_1=require(a229_0x434d0a(0x155)),composite_utils_1=require(a229_0x434d0a(0x144)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a229_0x434d0a(0x15f));class SalesforceComponentsManager{constructor(_0x48a0b9,_0x60372b,_0x5ac5ea,_0x3a468c,_0x80c63e){const _0x533c34=a229_0x434d0a;this[_0x533c34(0x120)]=_0x48a0b9,this['branchId']=_0x60372b,this[_0x533c34(0x118)]=_0x5ac5ea,this['recordTypes']=_0x3a468c,this[_0x533c34(0x123)]=_0x80c63e,this[_0x533c34(0x158)]=new core_1[(_0x533c34(0x147))](SalesforceComponentsManager[_0x533c34(0x138)]),this[_0x533c34(0x172)]=typedi_1['default'][_0x533c34(0x124)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a229_0x434d0a(0x142)](_0x3fee79,_0x4afac8){const _0x5d3ea6=a229_0x434d0a,_0x45aa7c=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x3fee79,[_0x5d3ea6(0x154),'Component_Name__c',_0x5d3ea6(0x143)]);this[_0x5d3ea6(0x123)]['push']({'componentId':'','reference':_0x4afac8,'version':_0x45aa7c[_0x5d3ea6(0x143)],'componentName':_0x45aa7c['Component_Name__c'],'componentType':_0x45aa7c[_0x5d3ea6(0x154)]});}[a229_0x434d0a(0x117)](_0x41949e,_0x240250){const _0x46393a=a229_0x434d0a,{request:_0x152148}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x46393a(0x167)],{[constants_1[_0x46393a(0x114)]+_0x46393a(0x15c)]:_0x41949e,[constants_1[_0x46393a(0x114)]+_0x46393a(0x15b)]:_0x240250});return _0x152148;}async[a229_0x434d0a(0x12b)](_0x35b9f3,_0x267b47){const _0xd1bda=a229_0x434d0a,_0x58457b={},_0x596c07=zip_1['Zip'][_0xd1bda(0x134)]();for(const _0x3b5258 of Object['keys'](_0x35b9f3[_0xd1bda(0x116)])){_0x596c07[_0xd1bda(0x136)](_0x3b5258,_0x35b9f3[_0xd1bda(0x116)][_0x3b5258],{'createFolders':!![]});}return _0x58457b[_0xd1bda(0x16b)]=_0xd1bda(0x174),_0x58457b[_0xd1bda(0x157)]=_0x35b9f3[_0xd1bda(0x16a)],_0x58457b['Description']=_0x35b9f3['type'],_0x58457b[_0xd1bda(0x160)]=_0x267b47,_0x58457b['Body']=await _0x596c07[_0xd1bda(0x132)]({'type':'base64','compression':_0xd1bda(0x121),'compressionOptions':{'level':0x6}}),_0x58457b;}['prepareComponentHistoryRecord'](_0x136eb1,_0x416e28,_0x278781){const _0x241c91=a229_0x434d0a,_0xb024b2=new Date()[_0x241c91(0x13d)](),_0x1d5d95={};return _0x1d5d95[constants_1['FLOSUM_NAMESPACE']+_0x241c91(0x13a)]=_0x416e28,_0x1d5d95[constants_1[_0x241c91(0x114)]+'CRC32__c']=_0x136eb1[_0x241c91(0x166)],_0x1d5d95[constants_1[_0x241c91(0x114)]+_0x241c91(0x14c)]=_0xb024b2,_0x1d5d95[constants_1[_0x241c91(0x114)]+_0x241c91(0x11d)]=this[_0x241c91(0x118)],_0x1d5d95[constants_1[_0x241c91(0x114)]+'Version__c']=_0x278781?_0x278781+0x1:0x1,_0x1d5d95[constants_1[_0x241c91(0x133)]+'Is_From_Agent__c']=!![],_0x1d5d95;}['prepareComponentRecord'](_0x2eaf2f,_0x3457f5){const _0x3f6d27=a229_0x434d0a;var _0x4d9ea1,_0x8dd7da;const _0x3a1fab=new Date()[_0x3f6d27(0x13d)](),_0x4c268b={};return!_0x3457f5?(this[_0x3f6d27(0x14e)]?(_0x4c268b[constants_1['FLOSUM_NAMESPACE']+_0x3f6d27(0x171)]=this[_0x3f6d27(0x14e)],_0x4c268b[constants_1[_0x3f6d27(0x114)]+'Source__c']=_0x3f6d27(0x16e),_0x4c268b[_0x3f6d27(0x13f)]=(_0x4d9ea1=this[_0x3f6d27(0x14b)][_0x3f6d27(0x169)](_0x5ae6f7=>_0x5ae6f7['name']==='Branch'))===null||_0x4d9ea1===void 0x0?void 0x0:_0x4d9ea1['id']):(_0x4c268b[constants_1['FLOSUM_NAMESPACE']+_0x3f6d27(0x168)]=this[_0x3f6d27(0x120)],_0x4c268b[constants_1['FLOSUM_NAMESPACE']+'Source__c']='Repository',_0x4c268b[_0x3f6d27(0x13f)]=(_0x8dd7da=this[_0x3f6d27(0x14b)][_0x3f6d27(0x169)](_0x1677e7=>_0x1677e7[_0x3f6d27(0x138)]===_0x3f6d27(0x159)))===null||_0x8dd7da===void 0x0?void 0x0:_0x8dd7da['id']),_0x4c268b[constants_1[_0x3f6d27(0x114)]+_0x3f6d27(0x143)]=0x1):_0x4c268b[constants_1['FLOSUM_NAMESPACE']+'Version__c']=_0x3457f5[_0x3f6d27(0x15d)]+0x1,_0x4c268b[constants_1[_0x3f6d27(0x114)]+_0x3f6d27(0x154)]=_0x2eaf2f[_0x3f6d27(0x16a)],_0x4c268b[constants_1[_0x3f6d27(0x114)]+_0x3f6d27(0x151)]=_0x2eaf2f['name'],_0x4c268b[constants_1[_0x3f6d27(0x114)]+_0x3f6d27(0x163)]=_0x2eaf2f['filePath'],_0x4c268b[constants_1[_0x3f6d27(0x114)]+_0x3f6d27(0x15e)]=this['username'],_0x4c268b[constants_1[_0x3f6d27(0x114)]+_0x3f6d27(0x145)]=this['username'],_0x4c268b[constants_1[_0x3f6d27(0x114)]+_0x3f6d27(0x122)]=_0x3a1fab,_0x4c268b[constants_1['FLOSUM_NAMESPACE']+_0x3f6d27(0x137)]=_0x3a1fab,_0x4c268b[constants_1[_0x3f6d27(0x114)]+_0x3f6d27(0x164)]=_0x2eaf2f[_0x3f6d27(0x166)],_0x4c268b;}['getProceededComponentsMeta'](){const _0x24f2e2=a229_0x434d0a;return this[_0x24f2e2(0x123)];}async['insert'](_0x2109e1,_0x53fdad){const _0x9e2aad=a229_0x434d0a,_0x4c811b=[];for(const _0x573c74 of _0x2109e1){const _0xe47891=(0x0,composite_utils_1[_0x9e2aad(0x125)])(constants_1['FLOSUM_COMPONENT'],this['prepareComponentRecord'](_0x573c74)),_0x4b2f13=(0x0,composite_utils_1[_0x9e2aad(0x125)])(constants_1[_0x9e2aad(0x150)],this[_0x9e2aad(0x148)](_0x573c74,'@{'+_0xe47891[_0x9e2aad(0x11a)]+_0x9e2aad(0x16f))),_0xbfede2=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x9e2aad(0x149)],await this['prepareComponentAttachmentRecord'](_0x573c74,'@{'+_0x4b2f13[_0x9e2aad(0x11a)]+_0x9e2aad(0x16f)));this[_0x9e2aad(0x142)](_0xe47891[_0x9e2aad(0x11f)][_0x9e2aad(0x14d)],_0xe47891[_0x9e2aad(0x11a)]),_0x4c811b[_0x9e2aad(0x15a)](_0xe47891[_0x9e2aad(0x11f)],_0x4b2f13[_0x9e2aad(0x11f)],_0xbfede2[_0x9e2aad(0x11f)]),_0x53fdad&&_0x4c811b[_0x9e2aad(0x15a)](this[_0x9e2aad(0x117)](_0x53fdad,'@{'+_0x4b2f13[_0x9e2aad(0x11a)]+_0x9e2aad(0x16f)));}return _0x4c811b;}async[a229_0x434d0a(0x126)](_0x34eadc,_0x1e4559=''){const _0x12a95d=a229_0x434d0a,_0x11cfcf=[];for(const {component:_0x47e473,meta:_0x83f7ad}of _0x34eadc){if(!_0x83f7ad['id']){const _0x9a685a=this[_0x12a95d(0x123)]['find'](_0x3782c0=>_0x3782c0[_0x12a95d(0x12c)]===_0x47e473[_0x12a95d(0x138)]&&_0x3782c0[_0x12a95d(0x173)]===_0x47e473['type']);if(!_0x9a685a)throw new salesforce_error_1[(_0x12a95d(0x12e))](new Error(_0x12a95d(0x13c)+_0x47e473[_0x12a95d(0x138)]+'\x20['+_0x47e473[_0x12a95d(0x16a)]+_0x12a95d(0x127)));_0x83f7ad['id']=_0x9a685a[_0x12a95d(0x119)];}const _0x1f92cd=(0x0,composite_utils_1[_0x12a95d(0x156)])(constants_1[_0x12a95d(0x131)],_0x83f7ad['id'],this[_0x12a95d(0x140)](_0x47e473,_0x83f7ad)),_0x138a5a=(0x0,composite_utils_1[_0x12a95d(0x125)])(constants_1[_0x12a95d(0x150)],this[_0x12a95d(0x148)](_0x47e473,_0x83f7ad['id'],_0x83f7ad['version'])),_0x4b7534=(0x0,composite_utils_1[_0x12a95d(0x125)])(constants_1[_0x12a95d(0x149)],await this[_0x12a95d(0x12b)](_0x47e473,'@{'+_0x138a5a['reference']+_0x12a95d(0x16f)));this[_0x12a95d(0x142)](_0x1f92cd['request'][_0x12a95d(0x14d)],_0x1f92cd[_0x12a95d(0x11a)]),_0x11cfcf[_0x12a95d(0x15a)](_0x1f92cd[_0x12a95d(0x11f)],_0x138a5a[_0x12a95d(0x11f)],_0x4b7534[_0x12a95d(0x11f)]),_0x1e4559&&_0x11cfcf[_0x12a95d(0x15a)](this['prepareCommitManifest'](_0x1e4559,'@{'+_0x138a5a[_0x12a95d(0x11a)]+_0x12a95d(0x16f)));}return _0x11cfcf;}async[a229_0x434d0a(0x115)](_0x1769c1,_0x51bfad=![]){const _0x48c4c8=a229_0x434d0a,_0x2bc84b={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x56191e=[];for(const _0x24eff0 of _0x1769c1){if(_0x24eff0['id'])_0x56191e[_0x48c4c8(0x15a)](_0x24eff0['id']);else{const _0x390b75=this[_0x48c4c8(0x123)][_0x48c4c8(0x169)](_0x25bab1=>_0x25bab1[_0x48c4c8(0x12c)]===_0x24eff0['name']&&_0x25bab1[_0x48c4c8(0x173)]===_0x24eff0[_0x48c4c8(0x16a)]);if(!_0x390b75||!_0x390b75[_0x48c4c8(0x119)])continue;_0x56191e['push'](_0x390b75[_0x48c4c8(0x119)]);}}if(_0x51bfad){const _0x482681=await this['gitSync'][_0x48c4c8(0x153)](_0x56191e);_0x2bc84b['manifests']=_0x482681[_0x48c4c8(0x14f)](_0x94aa40=>(0x0,composite_utils_1[_0x48c4c8(0x12a)])(constants_1[_0x48c4c8(0x167)],_0x94aa40)[_0x48c4c8(0x11f)]);}return _0x2bc84b['componentsToUpdate']=_0x56191e[_0x48c4c8(0x14f)](_0x8e1734=>(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x48c4c8(0x131)],_0x8e1734,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x48c4c8(0x141)]:!![]})['request']),_0x2bc84b[_0x48c4c8(0x12f)]=_0x56191e[_0x48c4c8(0x14f)](_0x2c8ab7=>(0x0,composite_utils_1[_0x48c4c8(0x12a)])(constants_1['FLOSUM_COMPONENT'],_0x2c8ab7)[_0x48c4c8(0x11f)]),_0x2bc84b;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;