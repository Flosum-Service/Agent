const a234_0x440044=a234_0x2829;(function(_0x461db8,_0x53481e){const _0x8f2f15=a234_0x2829,_0x473da6=_0x461db8();while(!![]){try{const _0x521323=parseInt(_0x8f2f15(0xd4))/0x1+-parseInt(_0x8f2f15(0xd6))/0x2+-parseInt(_0x8f2f15(0x126))/0x3*(parseInt(_0x8f2f15(0x114))/0x4)+parseInt(_0x8f2f15(0xd1))/0x5*(parseInt(_0x8f2f15(0xe8))/0x6)+-parseInt(_0x8f2f15(0xf8))/0x7*(-parseInt(_0x8f2f15(0x110))/0x8)+-parseInt(_0x8f2f15(0xdf))/0x9*(-parseInt(_0x8f2f15(0x115))/0xa)+-parseInt(_0x8f2f15(0xf7))/0xb*(-parseInt(_0x8f2f15(0x124))/0xc);if(_0x521323===_0x53481e)break;else _0x473da6['push'](_0x473da6['shift']());}catch(_0x1e29ea){_0x473da6['push'](_0x473da6['shift']());}}}(a234_0x5d5f,0xb8670));const a234_0x209e4a=(function(){let _0xde6e57=!![];return function(_0x34485c,_0x2edb5c){const _0x3e030f=_0xde6e57?function(){const _0x2a6914=a234_0x2829;if(_0x2edb5c){const _0x181444=_0x2edb5c[_0x2a6914(0xe0)](_0x34485c,arguments);return _0x2edb5c=null,_0x181444;}}:function(){};return _0xde6e57=![],_0x3e030f;};}()),a234_0x314811=a234_0x209e4a(this,function(){const _0x1ae7c2=a234_0x2829;return a234_0x314811[_0x1ae7c2(0x101)]()['search'](_0x1ae7c2(0xd0))[_0x1ae7c2(0x101)]()[_0x1ae7c2(0x11a)](a234_0x314811)[_0x1ae7c2(0xd2)](_0x1ae7c2(0xd0));});a234_0x314811();'use strict';function a234_0x5d5f(){const _0x855208=['ContentType','componentsToDelete','FLOSUM_COMPONENT_HISTORY','Last_Modified_By__c','Last_Modified_Date__c','Repository','createDeleteRequest','(((.+)+)+)+$','2883800jqkFMr','search','default','84395XsKrBE','username','2745458vBWlKb','gitSync','Last_Updated_By__c','DEFLATE','repositoryId','Component_Name__c','Source__c','FLOSUM_ATTACHMENT','Component__c','18egOqsZ','apply','Component_Type__c','componentType','./salesforce-git-sync.service','../errors/salesforce.error','FLOSUM_GIT_NAMESPACE','delete','Zip','12jqLXkF','RecordTypeId','fetchCommitManifestsByComponentIds','Description','prepareComponentRecord','branchId','Committed_On__c','File_Name__c','Repository__c',']\x20-\x20meta\x20not\x20found','__esModule','crc','Changed_On__c','Branch','filePath','1496ObOROW','1497734tlHXBv','Component_History__c','application/zip','update','Could\x20not\x20proceed\x20component\x20','componentsToUpdate','FLOSUM_NAMESPACE','getProceededComponentsMeta','toISOString','toString','find','createPostRequest','prepareComponentHistoryRecord','map','isVlocityComponent','push','SalesforceComponentsManager','files','componentName','Version__c','../../../../core','version','.id}','reference','16gKUhVf','extractFieldsFromRecord','request','componentId','672yekPKe','294970jwuXuR','recordTypes','defineProperty','manifests','Changed_By__c','constructor','proceedComponentMeta','name','Deletion_By_Agent__c','Is_From_Agent__c','logger','SalesforceGitSyncService','FLOSUM_COMPONENT','createZip','Logger','151764eqCrnv','__importDefault','23514IWgxDB','prepareCommitManifest','keys','createPatchRequest','type','base64','SalesforceError','body','prepareComponentAttachmentRecord','proceededComponentsMeta','Branch__c','../utils/flosum-naming.utils','../../../../constants','FLOSUM_COMMIT_MANIFEST'];a234_0x5d5f=function(){return _0x855208;};return a234_0x5d5f();}var __importDefault=this&&this[a234_0x440044(0x125)]||function(_0x59aea5){return _0x59aea5&&_0x59aea5['__esModule']?_0x59aea5:{'default':_0x59aea5};};Object[a234_0x440044(0x117)](exports,a234_0x440044(0xf2),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a234_0x440044(0x132)),core_1=require(a234_0x440044(0x10c)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a234_0x440044(0xe4)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a234_0x440044(0x131)),salesforce_git_sync_service_1=require(a234_0x440044(0xe3));class SalesforceComponentsManager{constructor(_0x2edb6e,_0x5d94ed,_0x377960,_0x3a4a5c,_0x2fd125){const _0x25a7cd=a234_0x440044;this[_0x25a7cd(0xda)]=_0x2edb6e,this['branchId']=_0x5d94ed,this[_0x25a7cd(0xd5)]=_0x377960,this['recordTypes']=_0x3a4a5c,this[_0x25a7cd(0x12f)]=_0x2fd125,this[_0x25a7cd(0x11f)]=new core_1[(_0x25a7cd(0x123))](SalesforceComponentsManager[_0x25a7cd(0x11c)]),this[_0x25a7cd(0xd7)]=typedi_1[_0x25a7cd(0xd3)]['get'](salesforce_git_sync_service_1[_0x25a7cd(0x120)]);}[a234_0x440044(0x11b)](_0x3baa20,_0x5fdf2d){const _0x25c941=a234_0x440044,_0x1882ae=(0x0,flosum_naming_utils_1[_0x25c941(0x111)])(_0x3baa20,['Component_Type__c',_0x25c941(0xdb),_0x25c941(0x10b)]);this['proceededComponentsMeta'][_0x25c941(0x107)]({'componentId':'','reference':_0x5fdf2d,'version':_0x1882ae[_0x25c941(0x10b)],'componentName':_0x1882ae[_0x25c941(0xdb)],'componentType':_0x1882ae['Component_Type__c']});}[a234_0x440044(0x127)](_0x2e67b5,_0x2910e3){const _0x5cb3b0=a234_0x440044,{request:_0x50a839}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x5cb3b0(0x133)],{[constants_1[_0x5cb3b0(0xfe)]+'Commit__c']:_0x2e67b5,[constants_1[_0x5cb3b0(0xfe)]+_0x5cb3b0(0xf9)]:_0x2910e3});return _0x50a839;}async[a234_0x440044(0x12e)](_0x286a24,_0x4a27d6){const _0x4d67cf=a234_0x440044,_0x10ab7c={},_0x2c550a=zip_1[_0x4d67cf(0xe7)][_0x4d67cf(0x122)]();for(const _0x347a5f of Object[_0x4d67cf(0x128)](_0x286a24[_0x4d67cf(0x109)])){_0x2c550a['file'](_0x347a5f,_0x286a24[_0x4d67cf(0x109)][_0x347a5f],{'createFolders':!![]});}return _0x10ab7c[_0x4d67cf(0x134)]=_0x4d67cf(0xfa),_0x10ab7c['Name']=_0x286a24[_0x4d67cf(0x12a)],_0x10ab7c[_0x4d67cf(0xeb)]=_0x286a24[_0x4d67cf(0x12a)],_0x10ab7c['ParentId']=_0x4a27d6,_0x10ab7c['Body']=await _0x2c550a['generateAsync']({'type':_0x4d67cf(0x12b),'compression':_0x4d67cf(0xd9),'compressionOptions':{'level':0x6}}),_0x10ab7c;}['prepareComponentHistoryRecord'](_0x525154,_0x40cedf,_0xaf9e9c){const _0x173eec=a234_0x440044,_0x25df55=new Date()[_0x173eec(0x100)](),_0x2f444d={};return _0x2f444d[constants_1[_0x173eec(0xfe)]+_0x173eec(0xde)]=_0x40cedf,_0x2f444d[constants_1[_0x173eec(0xfe)]+'CRC32__c']=_0x525154[_0x173eec(0xf3)],_0x2f444d[constants_1[_0x173eec(0xfe)]+_0x173eec(0xf4)]=_0x25df55,_0x2f444d[constants_1[_0x173eec(0xfe)]+_0x173eec(0x119)]=this[_0x173eec(0xd5)],_0x2f444d[constants_1['FLOSUM_NAMESPACE']+'Version__c']=_0xaf9e9c?_0xaf9e9c+0x1:0x1,_0x2f444d[constants_1[_0x173eec(0xe5)]+_0x173eec(0x11e)]=!![],_0x2f444d;}[a234_0x440044(0xec)](_0x19bdd0,_0x4f0dca){const _0x52b307=a234_0x440044;var _0x3a6957,_0x15456b;const _0x61e1e6=new Date()['toISOString'](),_0x5084e9={};return!_0x4f0dca?(this[_0x52b307(0xed)]?(_0x5084e9[constants_1[_0x52b307(0xfe)]+_0x52b307(0x130)]=this[_0x52b307(0xed)],_0x5084e9[constants_1['FLOSUM_NAMESPACE']+_0x52b307(0xdc)]=_0x52b307(0xf5),_0x5084e9[_0x52b307(0xe9)]=(_0x3a6957=this[_0x52b307(0x116)][_0x52b307(0x102)](_0x547901=>_0x547901['name']==='Branch'))===null||_0x3a6957===void 0x0?void 0x0:_0x3a6957['id']):(_0x5084e9[constants_1[_0x52b307(0xfe)]+_0x52b307(0xf0)]=this[_0x52b307(0xda)],_0x5084e9[constants_1[_0x52b307(0xfe)]+_0x52b307(0xdc)]=_0x52b307(0xce),_0x5084e9['RecordTypeId']=(_0x15456b=this[_0x52b307(0x116)][_0x52b307(0x102)](_0x3c7c00=>_0x3c7c00[_0x52b307(0x11c)]===_0x52b307(0xce)))===null||_0x15456b===void 0x0?void 0x0:_0x15456b['id']),_0x5084e9[constants_1[_0x52b307(0xfe)]+_0x52b307(0x10b)]=0x1):_0x5084e9[constants_1['FLOSUM_NAMESPACE']+_0x52b307(0x10b)]=_0x4f0dca[_0x52b307(0x10d)]+0x1,_0x5084e9[constants_1['FLOSUM_NAMESPACE']+_0x52b307(0xe1)]=_0x19bdd0[_0x52b307(0x12a)],_0x5084e9[constants_1[_0x52b307(0xfe)]+'Component_Name__c']=_0x19bdd0[_0x52b307(0x11c)],_0x5084e9[constants_1['FLOSUM_NAMESPACE']+_0x52b307(0xef)]=_0x19bdd0[_0x52b307(0xf6)],_0x5084e9[constants_1[_0x52b307(0xfe)]+_0x52b307(0xd8)]=this[_0x52b307(0xd5)],_0x5084e9[constants_1[_0x52b307(0xfe)]+_0x52b307(0x137)]=this[_0x52b307(0xd5)],_0x5084e9[constants_1[_0x52b307(0xfe)]+_0x52b307(0xcd)]=_0x61e1e6,_0x5084e9[constants_1[_0x52b307(0xfe)]+_0x52b307(0xee)]=_0x61e1e6,_0x5084e9[constants_1[_0x52b307(0xfe)]+'CRC32__c']=_0x19bdd0[_0x52b307(0xf3)],_0x5084e9[constants_1[_0x52b307(0xfe)]+'Vlocity_Component_Name__c']=_0x19bdd0['vlocityComponentName'],_0x5084e9[constants_1[_0x52b307(0xfe)]+'Vlocity_Component__c']=_0x19bdd0[_0x52b307(0x106)],_0x5084e9;}[a234_0x440044(0xff)](){const _0x2a9da9=a234_0x440044;return this[_0x2a9da9(0x12f)];}async['insert'](_0x5b3e48,_0x1042cb){const _0x3768b4=a234_0x440044,_0xfa04d4=[];for(const _0x11759e of _0x5b3e48){const _0x34fdd8=(0x0,composite_utils_1[_0x3768b4(0x103)])(constants_1[_0x3768b4(0x121)],this[_0x3768b4(0xec)](_0x11759e)),_0x25b05b=(0x0,composite_utils_1[_0x3768b4(0x103)])(constants_1[_0x3768b4(0x136)],this[_0x3768b4(0x104)](_0x11759e,'@{'+_0x34fdd8[_0x3768b4(0x10f)]+_0x3768b4(0x10e))),_0x50d43a=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x3768b4(0x12e)](_0x11759e,'@{'+_0x25b05b[_0x3768b4(0x10f)]+'.id}'));this['proceedComponentMeta'](_0x34fdd8['request'][_0x3768b4(0x12d)],_0x34fdd8['reference']),_0xfa04d4[_0x3768b4(0x107)](_0x34fdd8[_0x3768b4(0x112)],_0x25b05b['request'],_0x50d43a[_0x3768b4(0x112)]),_0x1042cb&&_0xfa04d4[_0x3768b4(0x107)](this[_0x3768b4(0x127)](_0x1042cb,'@{'+_0x25b05b[_0x3768b4(0x10f)]+_0x3768b4(0x10e)));}return _0xfa04d4;}async[a234_0x440044(0xfb)](_0xc86ce3,_0x2ac594=''){const _0x17244d=a234_0x440044,_0x568664=[];for(const {component:_0x54ae1b,meta:_0x30c43f}of _0xc86ce3){if(!_0x30c43f['id']){const _0x3e58d3=this[_0x17244d(0x12f)]['find'](_0x5f05b0=>_0x5f05b0[_0x17244d(0x10a)]===_0x54ae1b[_0x17244d(0x11c)]&&_0x5f05b0[_0x17244d(0xe2)]===_0x54ae1b[_0x17244d(0x12a)]);if(!_0x3e58d3)throw new salesforce_error_1[(_0x17244d(0x12c))](new Error(_0x17244d(0xfc)+_0x54ae1b[_0x17244d(0x11c)]+'\x20['+_0x54ae1b[_0x17244d(0x12a)]+_0x17244d(0xf1)));_0x30c43f['id']=_0x3e58d3[_0x17244d(0x113)];}const _0xb5cbb7=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x17244d(0x121)],_0x30c43f['id'],this[_0x17244d(0xec)](_0x54ae1b,_0x30c43f)),_0x36aa93=(0x0,composite_utils_1[_0x17244d(0x103)])(constants_1[_0x17244d(0x136)],this['prepareComponentHistoryRecord'](_0x54ae1b,_0x30c43f['id'],_0x30c43f['version'])),_0x5ea3b7=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x17244d(0xdd)],await this['prepareComponentAttachmentRecord'](_0x54ae1b,'@{'+_0x36aa93[_0x17244d(0x10f)]+_0x17244d(0x10e)));this[_0x17244d(0x11b)](_0xb5cbb7[_0x17244d(0x112)][_0x17244d(0x12d)],_0xb5cbb7[_0x17244d(0x10f)]),_0x568664[_0x17244d(0x107)](_0xb5cbb7[_0x17244d(0x112)],_0x36aa93['request'],_0x5ea3b7[_0x17244d(0x112)]),_0x2ac594&&_0x568664['push'](this[_0x17244d(0x127)](_0x2ac594,'@{'+_0x36aa93[_0x17244d(0x10f)]+_0x17244d(0x10e)));}return _0x568664;}async[a234_0x440044(0xe6)](_0x48d146,_0xf38588=![]){const _0x2b059a=a234_0x440044,_0x1ccd81={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x263edb=[];for(const _0x494995 of _0x48d146){if(_0x494995['id'])_0x263edb[_0x2b059a(0x107)](_0x494995['id']);else{const _0x39642d=this[_0x2b059a(0x12f)][_0x2b059a(0x102)](_0x20a7fb=>_0x20a7fb[_0x2b059a(0x10a)]===_0x494995[_0x2b059a(0x11c)]&&_0x20a7fb[_0x2b059a(0xe2)]===_0x494995[_0x2b059a(0x12a)]);if(!_0x39642d||!_0x39642d[_0x2b059a(0x113)])continue;_0x263edb[_0x2b059a(0x107)](_0x39642d['componentId']);}}if(_0xf38588){const _0xe20517=await this['gitSync'][_0x2b059a(0xea)](_0x263edb);_0x1ccd81[_0x2b059a(0x118)]=_0xe20517[_0x2b059a(0x105)](_0x423d8e=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x2b059a(0x133)],_0x423d8e)[_0x2b059a(0x112)]);}return _0x1ccd81[_0x2b059a(0xfd)]=_0x263edb['map'](_0x363039=>(0x0,composite_utils_1[_0x2b059a(0x129)])(constants_1[_0x2b059a(0x121)],_0x363039,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x2b059a(0x11d)]:!![]})[_0x2b059a(0x112)]),_0x1ccd81[_0x2b059a(0x135)]=_0x263edb[_0x2b059a(0x105)](_0xb31267=>(0x0,composite_utils_1[_0x2b059a(0xcf)])(constants_1['FLOSUM_COMPONENT'],_0xb31267)['request']),_0x1ccd81;}}function a234_0x2829(_0x50f40a,_0x49e223){const _0x4111ff=a234_0x5d5f();return a234_0x2829=function(_0x314811,_0x209e4a){_0x314811=_0x314811-0xcd;let _0x5d5f41=_0x4111ff[_0x314811];return _0x5d5f41;},a234_0x2829(_0x50f40a,_0x49e223);}exports[a234_0x440044(0x108)]=SalesforceComponentsManager;