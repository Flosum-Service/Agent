const a229_0x50fdf9=a229_0x433d;(function(_0x44db50,_0x2b9c3d){const _0x49cb35=a229_0x433d,_0x823215=_0x44db50();while(!![]){try{const _0x2fd0dd=-parseInt(_0x49cb35(0x142))/0x1+parseInt(_0x49cb35(0x14d))/0x2*(parseInt(_0x49cb35(0x187))/0x3)+parseInt(_0x49cb35(0x161))/0x4*(-parseInt(_0x49cb35(0x13b))/0x5)+-parseInt(_0x49cb35(0x168))/0x6*(-parseInt(_0x49cb35(0x13c))/0x7)+parseInt(_0x49cb35(0x16f))/0x8*(-parseInt(_0x49cb35(0x15c))/0x9)+parseInt(_0x49cb35(0x16a))/0xa+parseInt(_0x49cb35(0x12b))/0xb*(parseInt(_0x49cb35(0x17e))/0xc);if(_0x2fd0dd===_0x2b9c3d)break;else _0x823215['push'](_0x823215['shift']());}catch(_0x487ae0){_0x823215['push'](_0x823215['shift']());}}}(a229_0x2615,0xed1db));const a229_0x35d4a8=(function(){let _0x97d298=!![];return function(_0x484dfb,_0x762f97){const _0x3d3b50=_0x97d298?function(){const _0x277940=a229_0x433d;if(_0x762f97){const _0x4ce48f=_0x762f97[_0x277940(0x146)](_0x484dfb,arguments);return _0x762f97=null,_0x4ce48f;}}:function(){};return _0x97d298=![],_0x3d3b50;};}()),a229_0x486766=a229_0x35d4a8(this,function(){const _0x26a86a=a229_0x433d;return a229_0x486766['toString']()[_0x26a86a(0x124)]('(((.+)+)+)+$')['toString']()[_0x26a86a(0x16e)](a229_0x486766)[_0x26a86a(0x124)]('(((.+)+)+)+$');});a229_0x486766();'use strict';var __importDefault=this&&this[a229_0x50fdf9(0x12f)]||function(_0x92d274){return _0x92d274&&_0x92d274['__esModule']?_0x92d274:{'default':_0x92d274};};function a229_0x2615(){const _0x14df73=['push','125370ACveCO','username','SalesforceComponentsManager','../../../../core','RecordTypeId','149780pXDKXQ','Component_Name__c','componentType','Component_History__c','prepareComponentRecord','gitSync','FLOSUM_NAMESPACE','36jYeQuf','SalesforceError','12134560bSEwHv','Version__c','Body','body','constructor','1112OiYpZm','reference','../../../../constants','createZip','Component_Type__c','ParentId','Branch','generateAsync','componentsToDelete','prepareComponentAttachmentRecord','Branch__c','repositoryId','Committed_On__c','Could\x20not\x20proceed\x20component\x20','map','216ZYWcoo','application/zip','../utils/flosum-naming.utils','toISOString','SalesforceGitSyncService','Repository','.id}','Description','CRC32__c','157062xAzHMV','crc','search','version','keys','createPostRequest','File_Name__c','Changed_By__c','componentId','813461RjyFhe','prepareCommitManifest','files','prepareComponentHistoryRecord','__importDefault',']\x20-\x20meta\x20not\x20found','name','typedi','filePath','ContentType','type','proceededComponentsMeta','recordTypes','__esModule','get','getProceededComponentsMeta','105BUrqsb','619878kfykIL','Commit__c','update','FLOSUM_GIT_NAMESPACE','createPatchRequest','FLOSUM_COMPONENT','219720aoUWHG','createDeleteRequest','extractFieldsFromRecord','componentName','apply','Repository__c','Component__c','../errors/salesforce.error','manifests','proceedComponentMeta','../utils/composite.utils','32ibhstb','Changed_On__c','FLOSUM_COMMIT_MANIFEST','Source__c','Zip','branchId','request','componentsToUpdate','Last_Updated_By__c','default','find','Last_Modified_By__c','defineProperty','FLOSUM_COMPONENT_HISTORY'];a229_0x2615=function(){return _0x14df73;};return a229_0x2615();}function a229_0x433d(_0x261997,_0x55763a){const _0x5a2029=a229_0x2615();return a229_0x433d=function(_0x486766,_0x35d4a8){_0x486766=_0x486766-0x124;let _0x26156d=_0x5a2029[_0x486766];return _0x26156d;},a229_0x433d(_0x261997,_0x55763a);}Object[a229_0x50fdf9(0x159)](exports,a229_0x50fdf9(0x138),{'value':!![]}),exports[a229_0x50fdf9(0x15e)]=void 0x0;const constants_1=require(a229_0x50fdf9(0x171)),core_1=require(a229_0x50fdf9(0x15f)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a229_0x50fdf9(0x132))),salesforce_error_1=require(a229_0x50fdf9(0x149)),composite_utils_1=require(a229_0x50fdf9(0x14c)),flosum_naming_utils_1=require(a229_0x50fdf9(0x180)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x1f4613,_0x1f2902,_0x1226e2,_0x4141b8,_0x5d119a){const _0x4ee99f=a229_0x50fdf9;this[_0x4ee99f(0x17a)]=_0x1f4613,this[_0x4ee99f(0x152)]=_0x1f2902,this['username']=_0x1226e2,this['recordTypes']=_0x4141b8,this[_0x4ee99f(0x136)]=_0x5d119a,this['logger']=new core_1['Logger'](SalesforceComponentsManager[_0x4ee99f(0x131)]),this['gitSync']=typedi_1[_0x4ee99f(0x156)][_0x4ee99f(0x139)](salesforce_git_sync_service_1[_0x4ee99f(0x182)]);}[a229_0x50fdf9(0x14b)](_0x29267b,_0x1d04d2){const _0x26faa0=a229_0x50fdf9,_0x437972=(0x0,flosum_naming_utils_1[_0x26faa0(0x144)])(_0x29267b,[_0x26faa0(0x173),'Component_Name__c',_0x26faa0(0x16b)]);this['proceededComponentsMeta'][_0x26faa0(0x15b)]({'componentId':'','reference':_0x1d04d2,'version':_0x437972[_0x26faa0(0x16b)],'componentName':_0x437972[_0x26faa0(0x162)],'componentType':_0x437972[_0x26faa0(0x173)]});}['prepareCommitManifest'](_0x192297,_0x16bee9){const _0x5be43d=a229_0x50fdf9,{request:_0x5eb7f4}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x5be43d(0x14f)],{[constants_1[_0x5be43d(0x167)]+_0x5be43d(0x13d)]:_0x192297,[constants_1[_0x5be43d(0x167)]+_0x5be43d(0x164)]:_0x16bee9});return _0x5eb7f4;}async[a229_0x50fdf9(0x178)](_0x157501,_0x5dce10){const _0x138cba=a229_0x50fdf9,_0x1d376c={},_0x282670=zip_1[_0x138cba(0x151)][_0x138cba(0x172)]();for(const _0x15bc5a of Object[_0x138cba(0x126)](_0x157501[_0x138cba(0x12d)])){_0x282670['file'](_0x15bc5a,_0x157501[_0x138cba(0x12d)][_0x15bc5a],{'createFolders':!![]});}return _0x1d376c[_0x138cba(0x134)]=_0x138cba(0x17f),_0x1d376c['Name']=_0x157501[_0x138cba(0x135)],_0x1d376c[_0x138cba(0x185)]=_0x157501[_0x138cba(0x135)],_0x1d376c[_0x138cba(0x174)]=_0x5dce10,_0x1d376c[_0x138cba(0x16c)]=await _0x282670[_0x138cba(0x176)]({'type':'base64','compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x1d376c;}[a229_0x50fdf9(0x12e)](_0x2346d1,_0x163f9c,_0x1cc54c){const _0x22b05e=a229_0x50fdf9,_0x186dc4=new Date()['toISOString'](),_0xae3c67={};return _0xae3c67[constants_1['FLOSUM_NAMESPACE']+_0x22b05e(0x148)]=_0x163f9c,_0xae3c67[constants_1['FLOSUM_NAMESPACE']+_0x22b05e(0x186)]=_0x2346d1[_0x22b05e(0x188)],_0xae3c67[constants_1[_0x22b05e(0x167)]+_0x22b05e(0x14e)]=_0x186dc4,_0xae3c67[constants_1['FLOSUM_NAMESPACE']+_0x22b05e(0x129)]=this['username'],_0xae3c67[constants_1['FLOSUM_NAMESPACE']+_0x22b05e(0x16b)]=_0x1cc54c?_0x1cc54c+0x1:0x1,_0xae3c67[constants_1[_0x22b05e(0x13f)]+'Is_From_Agent__c']=!![],_0xae3c67;}['prepareComponentRecord'](_0x4091c7,_0x3ff8cd){const _0x41c6a5=a229_0x50fdf9;var _0x1f5a10,_0x344feb;const _0x43304c=new Date()[_0x41c6a5(0x181)](),_0xd89b46={};return!_0x3ff8cd?(this[_0x41c6a5(0x152)]?(_0xd89b46[constants_1[_0x41c6a5(0x167)]+_0x41c6a5(0x179)]=this[_0x41c6a5(0x152)],_0xd89b46[constants_1['FLOSUM_NAMESPACE']+_0x41c6a5(0x150)]=_0x41c6a5(0x175),_0xd89b46[_0x41c6a5(0x160)]=(_0x1f5a10=this[_0x41c6a5(0x137)]['find'](_0x1893c1=>_0x1893c1[_0x41c6a5(0x131)]==='Branch'))===null||_0x1f5a10===void 0x0?void 0x0:_0x1f5a10['id']):(_0xd89b46[constants_1[_0x41c6a5(0x167)]+_0x41c6a5(0x147)]=this['repositoryId'],_0xd89b46[constants_1[_0x41c6a5(0x167)]+'Source__c']='Repository',_0xd89b46[_0x41c6a5(0x160)]=(_0x344feb=this[_0x41c6a5(0x137)][_0x41c6a5(0x157)](_0xcbdb97=>_0xcbdb97[_0x41c6a5(0x131)]===_0x41c6a5(0x183)))===null||_0x344feb===void 0x0?void 0x0:_0x344feb['id']),_0xd89b46[constants_1['FLOSUM_NAMESPACE']+'Version__c']=0x1):_0xd89b46[constants_1[_0x41c6a5(0x167)]+'Version__c']=_0x3ff8cd[_0x41c6a5(0x125)]+0x1,_0xd89b46[constants_1[_0x41c6a5(0x167)]+'Component_Type__c']=_0x4091c7[_0x41c6a5(0x135)],_0xd89b46[constants_1[_0x41c6a5(0x167)]+_0x41c6a5(0x162)]=_0x4091c7[_0x41c6a5(0x131)],_0xd89b46[constants_1[_0x41c6a5(0x167)]+_0x41c6a5(0x128)]=_0x4091c7[_0x41c6a5(0x133)],_0xd89b46[constants_1[_0x41c6a5(0x167)]+_0x41c6a5(0x155)]=this[_0x41c6a5(0x15d)],_0xd89b46[constants_1[_0x41c6a5(0x167)]+_0x41c6a5(0x158)]=this[_0x41c6a5(0x15d)],_0xd89b46[constants_1['FLOSUM_NAMESPACE']+'Last_Modified_Date__c']=_0x43304c,_0xd89b46[constants_1['FLOSUM_NAMESPACE']+_0x41c6a5(0x17b)]=_0x43304c,_0xd89b46[constants_1[_0x41c6a5(0x167)]+_0x41c6a5(0x186)]=_0x4091c7[_0x41c6a5(0x188)],_0xd89b46;}[a229_0x50fdf9(0x13a)](){return this['proceededComponentsMeta'];}async['insert'](_0xa37f37,_0x2737eb){const _0x3e97a5=a229_0x50fdf9,_0x21ccaa=[];for(const _0xe06e66 of _0xa37f37){const _0x1e199b=(0x0,composite_utils_1[_0x3e97a5(0x127)])(constants_1[_0x3e97a5(0x141)],this[_0x3e97a5(0x165)](_0xe06e66)),_0x537bba=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x3e97a5(0x15a)],this[_0x3e97a5(0x12e)](_0xe06e66,'@{'+_0x1e199b['reference']+'.id}')),_0x2c8b35=(0x0,composite_utils_1[_0x3e97a5(0x127)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x3e97a5(0x178)](_0xe06e66,'@{'+_0x537bba['reference']+_0x3e97a5(0x184)));this[_0x3e97a5(0x14b)](_0x1e199b[_0x3e97a5(0x153)][_0x3e97a5(0x16d)],_0x1e199b[_0x3e97a5(0x170)]),_0x21ccaa['push'](_0x1e199b[_0x3e97a5(0x153)],_0x537bba[_0x3e97a5(0x153)],_0x2c8b35[_0x3e97a5(0x153)]),_0x2737eb&&_0x21ccaa[_0x3e97a5(0x15b)](this[_0x3e97a5(0x12c)](_0x2737eb,'@{'+_0x537bba[_0x3e97a5(0x170)]+_0x3e97a5(0x184)));}return _0x21ccaa;}async[a229_0x50fdf9(0x13e)](_0x8d4d12,_0x4e59b1=''){const _0x391e46=a229_0x50fdf9,_0xc25f59=[];for(const {component:_0x2402b1,meta:_0x1cf0a6}of _0x8d4d12){if(!_0x1cf0a6['id']){const _0x56639a=this['proceededComponentsMeta'][_0x391e46(0x157)](_0x54711a=>_0x54711a[_0x391e46(0x145)]===_0x2402b1['name']&&_0x54711a[_0x391e46(0x163)]===_0x2402b1['type']);if(!_0x56639a)throw new salesforce_error_1[(_0x391e46(0x169))](new Error(_0x391e46(0x17c)+_0x2402b1[_0x391e46(0x131)]+'\x20['+_0x2402b1[_0x391e46(0x135)]+_0x391e46(0x130)));_0x1cf0a6['id']=_0x56639a['componentId'];}const _0x42340d=(0x0,composite_utils_1[_0x391e46(0x140)])(constants_1[_0x391e46(0x141)],_0x1cf0a6['id'],this['prepareComponentRecord'](_0x2402b1,_0x1cf0a6)),_0x51e64d=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x391e46(0x15a)],this[_0x391e46(0x12e)](_0x2402b1,_0x1cf0a6['id'],_0x1cf0a6['version'])),_0x4e4794=(0x0,composite_utils_1[_0x391e46(0x127)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x391e46(0x178)](_0x2402b1,'@{'+_0x51e64d['reference']+_0x391e46(0x184)));this[_0x391e46(0x14b)](_0x42340d['request'][_0x391e46(0x16d)],_0x42340d['reference']),_0xc25f59[_0x391e46(0x15b)](_0x42340d['request'],_0x51e64d[_0x391e46(0x153)],_0x4e4794['request']),_0x4e59b1&&_0xc25f59[_0x391e46(0x15b)](this[_0x391e46(0x12c)](_0x4e59b1,'@{'+_0x51e64d[_0x391e46(0x170)]+_0x391e46(0x184)));}return _0xc25f59;}async['delete'](_0x359961,_0x5f429e=![]){const _0x31537b=a229_0x50fdf9,_0x42983f={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x361d80=[];for(const _0x1aeb09 of _0x359961){if(_0x1aeb09['id'])_0x361d80[_0x31537b(0x15b)](_0x1aeb09['id']);else{const _0x560bee=this[_0x31537b(0x136)]['find'](_0x1c6022=>_0x1c6022[_0x31537b(0x145)]===_0x1aeb09[_0x31537b(0x131)]&&_0x1c6022['componentType']===_0x1aeb09['type']);if(!_0x560bee||!_0x560bee['componentId'])continue;_0x361d80['push'](_0x560bee[_0x31537b(0x12a)]);}}if(_0x5f429e){const _0x9b5e2b=await this[_0x31537b(0x166)]['fetchCommitManifestsByComponentIds'](_0x361d80);_0x42983f[_0x31537b(0x14a)]=_0x9b5e2b[_0x31537b(0x17d)](_0x43628c=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x31537b(0x14f)],_0x43628c)[_0x31537b(0x153)]);}return _0x42983f[_0x31537b(0x154)]=_0x361d80['map'](_0x83e6c9=>(0x0,composite_utils_1[_0x31537b(0x140)])(constants_1[_0x31537b(0x141)],_0x83e6c9,{[constants_1['FLOSUM_GIT_NAMESPACE']+'Deletion_By_Agent__c']:!![]})['request']),_0x42983f[_0x31537b(0x177)]=_0x361d80[_0x31537b(0x17d)](_0x34c298=>(0x0,composite_utils_1[_0x31537b(0x143)])(constants_1[_0x31537b(0x141)],_0x34c298)[_0x31537b(0x153)]),_0x42983f;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;