const a272_0x110482=a272_0x11e1;(function(_0x4c8b49,_0x153325){const _0x508a69=a272_0x11e1,_0x3d280c=_0x4c8b49();while(!![]){try{const _0x2b67aa=-parseInt(_0x508a69(0x17d))/0x1*(-parseInt(_0x508a69(0x151))/0x2)+-parseInt(_0x508a69(0x187))/0x3+-parseInt(_0x508a69(0x14e))/0x4*(parseInt(_0x508a69(0x16a))/0x5)+-parseInt(_0x508a69(0x185))/0x6*(parseInt(_0x508a69(0x13a))/0x7)+-parseInt(_0x508a69(0x19a))/0x8*(-parseInt(_0x508a69(0x19f))/0x9)+-parseInt(_0x508a69(0x18a))/0xa+parseInt(_0x508a69(0x1a8))/0xb*(parseInt(_0x508a69(0x142))/0xc);if(_0x2b67aa===_0x153325)break;else _0x3d280c['push'](_0x3d280c['shift']());}catch(_0x8d84b3){_0x3d280c['push'](_0x3d280c['shift']());}}}(a272_0x4e7e,0xdaf05));const a272_0x247fcc=(function(){let _0x27c798=!![];return function(_0x470a9c,_0xefebec){const _0x120d31=_0x27c798?function(){const _0x429bd0=a272_0x11e1;if(_0xefebec){const _0x3db1cc=_0xefebec[_0x429bd0(0x15a)](_0x470a9c,arguments);return _0xefebec=null,_0x3db1cc;}}:function(){};return _0x27c798=![],_0x120d31;};}()),a272_0x484166=a272_0x247fcc(this,function(){const _0x376bc3=a272_0x11e1;return a272_0x484166['toString']()[_0x376bc3(0x14d)](_0x376bc3(0x192))[_0x376bc3(0x16d)]()[_0x376bc3(0x186)](a272_0x484166)[_0x376bc3(0x14d)](_0x376bc3(0x192));});a272_0x484166();function a272_0x4e7e(){const _0x322e35=['Vlocity_Component__c','keys','repositoryId','body','insert','3783168UKzPcF','componentId','prepareComponentHistoryRecord','.id}','Logger','username','delete','../../../../constants','toISOString','File_Name__c','type','search','4trJWlL','componentsToDelete','version','1660fvjeRw','defineProperty','fetchCommitManifestsByComponentIds','name','FLOSUM_GIT_NAMESPACE','Zip','recordTypes','FLOSUM_COMMIT_MANIFEST','FLOSUM_ATTACHMENT','apply','Repository','Last_Modified_Date__c','get','CRC32__c','push','__esModule','RecordTypeId','Last_Modified_By__c','Committed_On__c','SalesforceGitSyncService','createPostRequest','createDeleteRequest','FLOSUM_NAMESPACE','MC_Key__c','prepareComponentRecord','1665585klpHXk','filePath','Name','toString','createZip','Branch','Commit__c','Component_Type__c','request','SalesforceError','prepareCommitManifest','typedi','Body','componentName','map','Component_Name__c','FLOSUM_COMPONENT','createPatchRequest','gitSync','1228sXazJk','Last_Updated_By__c','file','Component__c','files','marketingCloudKey','FLOSUM_COMPONENT_HISTORY','Component_History__c','290922CAjigu','constructor','3985470KedqSd','vlocityComponentName','find','2473580QdfcIZ','default','proceededComponentsMeta','Source__c','../utils/flosum-naming.utils','Deletion_By_Agent__c','branchId','Changed_By__c','(((.+)+)+)+$','Branch__c','isVlocityComponent','Version__c','base64','proceedComponentMeta','getProceededComponentsMeta','Changed_On__c','9512qoQeuA','Description','extractFieldsFromRecord','Vlocity_Component_Name__c','Repository__c','9117kMapDJ','logger','../errors/salesforce.error','../../../../core','componentsToUpdate','prepareComponentAttachmentRecord','componentType','../utils/composite.utils','reference','22jknPjm','7FcNcWn','crc','ContentType'];a272_0x4e7e=function(){return _0x322e35;};return a272_0x4e7e();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x139a24){const _0x179f81=a272_0x11e1;return _0x139a24&&_0x139a24[_0x179f81(0x160)]?_0x139a24:{'default':_0x139a24};};function a272_0x11e1(_0x3bc4c6,_0x481b46){const _0x46a4cb=a272_0x4e7e();return a272_0x11e1=function(_0x484166,_0x247fcc){_0x484166=_0x484166-0x13a;let _0x4e7e2c=_0x46a4cb[_0x484166];return _0x4e7e2c;},a272_0x11e1(_0x3bc4c6,_0x481b46);}Object[a272_0x110482(0x152)](exports,a272_0x110482(0x160),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a272_0x110482(0x149)),core_1=require(a272_0x110482(0x1a2)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a272_0x110482(0x175))),salesforce_error_1=require(a272_0x110482(0x1a1)),composite_utils_1=require(a272_0x110482(0x1a6)),flosum_naming_utils_1=require(a272_0x110482(0x18e)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x35181c,_0x27e0d3,_0x593074,_0x4001f0,_0x5b6fa1){const _0x951346=a272_0x110482;this[_0x951346(0x13f)]=_0x35181c,this['branchId']=_0x27e0d3,this[_0x951346(0x147)]=_0x593074,this[_0x951346(0x157)]=_0x4001f0,this[_0x951346(0x18c)]=_0x5b6fa1,this[_0x951346(0x1a0)]=new core_1[(_0x951346(0x146))](SalesforceComponentsManager['name']),this['gitSync']=typedi_1[_0x951346(0x18b)][_0x951346(0x15d)](salesforce_git_sync_service_1[_0x951346(0x164)]);}[a272_0x110482(0x197)](_0x26c25b,_0x1d7999){const _0x3020ab=a272_0x110482,_0x2ae805=(0x0,flosum_naming_utils_1[_0x3020ab(0x19c)])(_0x26c25b,[_0x3020ab(0x171),_0x3020ab(0x179),_0x3020ab(0x195)]);this[_0x3020ab(0x18c)][_0x3020ab(0x15f)]({'componentId':'','reference':_0x1d7999,'version':_0x2ae805[_0x3020ab(0x195)],'componentName':_0x2ae805[_0x3020ab(0x179)],'componentType':_0x2ae805['Component_Type__c']});}[a272_0x110482(0x174)](_0x476538,_0x14726a){const _0x4ce9a5=a272_0x110482,{request:_0x10c719}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x4ce9a5(0x158)],{[constants_1[_0x4ce9a5(0x167)]+_0x4ce9a5(0x170)]:_0x476538,[constants_1[_0x4ce9a5(0x167)]+_0x4ce9a5(0x184)]:_0x14726a});return _0x10c719;}async[a272_0x110482(0x1a4)](_0x1dd961,_0x128836){const _0x72b322=a272_0x110482,_0x88e2c4={},_0x166821=zip_1[_0x72b322(0x156)][_0x72b322(0x16e)]();for(const _0x1dbacc of Object[_0x72b322(0x13e)](_0x1dd961[_0x72b322(0x181)])){_0x166821[_0x72b322(0x17f)](_0x1dbacc,_0x1dd961[_0x72b322(0x181)][_0x1dbacc],{'createFolders':!![]});}return _0x88e2c4[_0x72b322(0x13c)]='application/zip',_0x88e2c4[_0x72b322(0x16c)]=_0x1dd961[_0x72b322(0x14c)],_0x88e2c4[_0x72b322(0x19b)]=_0x1dd961[_0x72b322(0x14c)],_0x88e2c4['ParentId']=_0x128836,_0x88e2c4[_0x72b322(0x176)]=await _0x166821['generateAsync']({'type':_0x72b322(0x196),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x88e2c4;}[a272_0x110482(0x144)](_0x4cf119,_0xe84e94,_0x5cc7e3){const _0x4a5d70=a272_0x110482,_0x3564f4=new Date()['toISOString'](),_0x36b4c0={};return _0x36b4c0[constants_1[_0x4a5d70(0x167)]+_0x4a5d70(0x180)]=_0xe84e94,_0x36b4c0[constants_1['FLOSUM_NAMESPACE']+_0x4a5d70(0x15e)]=_0x4cf119[_0x4a5d70(0x13b)],_0x36b4c0[constants_1[_0x4a5d70(0x167)]+_0x4a5d70(0x199)]=_0x3564f4,_0x36b4c0[constants_1[_0x4a5d70(0x167)]+_0x4a5d70(0x191)]=this[_0x4a5d70(0x147)],_0x36b4c0[constants_1[_0x4a5d70(0x167)]+_0x4a5d70(0x195)]=_0x5cc7e3?_0x5cc7e3+0x1:0x1,_0x36b4c0[constants_1[_0x4a5d70(0x155)]+'Is_From_Agent__c']=!![],_0x36b4c0;}[a272_0x110482(0x169)](_0xb4d922,_0x4c1f07){const _0x3c35a5=a272_0x110482;var _0x1147a6,_0x1790b2;const _0x2bf378=new Date()[_0x3c35a5(0x14a)](),_0x53800c={};return!_0x4c1f07?(this[_0x3c35a5(0x190)]?(_0x53800c[constants_1['FLOSUM_NAMESPACE']+_0x3c35a5(0x193)]=this[_0x3c35a5(0x190)],_0x53800c[constants_1[_0x3c35a5(0x167)]+_0x3c35a5(0x18d)]=_0x3c35a5(0x16f),_0x53800c['RecordTypeId']=(_0x1147a6=this[_0x3c35a5(0x157)][_0x3c35a5(0x189)](_0x4d242b=>_0x4d242b['name']===_0x3c35a5(0x16f)))===null||_0x1147a6===void 0x0?void 0x0:_0x1147a6['id']):(_0x53800c[constants_1[_0x3c35a5(0x167)]+_0x3c35a5(0x19e)]=this['repositoryId'],_0x53800c[constants_1[_0x3c35a5(0x167)]+'Source__c']=_0x3c35a5(0x15b),_0x53800c[_0x3c35a5(0x161)]=(_0x1790b2=this['recordTypes'][_0x3c35a5(0x189)](_0x50de7e=>_0x50de7e[_0x3c35a5(0x154)]===_0x3c35a5(0x15b)))===null||_0x1790b2===void 0x0?void 0x0:_0x1790b2['id']),_0x53800c[constants_1['FLOSUM_NAMESPACE']+_0x3c35a5(0x195)]=0x1):_0x53800c[constants_1[_0x3c35a5(0x167)]+_0x3c35a5(0x195)]=_0x4c1f07[_0x3c35a5(0x150)]+0x1,_0x53800c[constants_1[_0x3c35a5(0x167)]+'Component_Type__c']=_0xb4d922[_0x3c35a5(0x14c)],_0x53800c[constants_1[_0x3c35a5(0x167)]+_0x3c35a5(0x179)]=_0xb4d922[_0x3c35a5(0x154)],_0x53800c[constants_1['FLOSUM_NAMESPACE']+_0x3c35a5(0x14b)]=_0xb4d922[_0x3c35a5(0x16b)],_0x53800c[constants_1[_0x3c35a5(0x167)]+_0x3c35a5(0x17e)]=this[_0x3c35a5(0x147)],_0x53800c[constants_1[_0x3c35a5(0x167)]+_0x3c35a5(0x162)]=this[_0x3c35a5(0x147)],_0x53800c[constants_1[_0x3c35a5(0x167)]+_0x3c35a5(0x15c)]=_0x2bf378,_0x53800c[constants_1['FLOSUM_NAMESPACE']+_0x3c35a5(0x163)]=_0x2bf378,_0x53800c[constants_1[_0x3c35a5(0x167)]+'CRC32__c']=_0xb4d922['crc'],_0x53800c[constants_1['FLOSUM_NAMESPACE']+_0x3c35a5(0x19d)]=_0xb4d922[_0x3c35a5(0x188)],_0x53800c[constants_1['FLOSUM_NAMESPACE']+_0x3c35a5(0x13d)]=_0xb4d922[_0x3c35a5(0x194)],_0x53800c[constants_1[_0x3c35a5(0x167)]+_0x3c35a5(0x168)]=_0xb4d922[_0x3c35a5(0x182)],_0x53800c;}[a272_0x110482(0x198)](){return this['proceededComponentsMeta'];}async[a272_0x110482(0x141)](_0x5e34c0,_0x2fb236){const _0x396730=a272_0x110482,_0x53b348=[];for(const _0x18e0cd of _0x5e34c0){const _0x5ca0aa=(0x0,composite_utils_1[_0x396730(0x165)])(constants_1[_0x396730(0x17a)],this[_0x396730(0x169)](_0x18e0cd)),_0x1d5777=(0x0,composite_utils_1[_0x396730(0x165)])(constants_1[_0x396730(0x183)],this['prepareComponentHistoryRecord'](_0x18e0cd,'@{'+_0x5ca0aa['reference']+_0x396730(0x145))),_0x729b8=(0x0,composite_utils_1[_0x396730(0x165)])(constants_1[_0x396730(0x159)],await this[_0x396730(0x1a4)](_0x18e0cd,'@{'+_0x1d5777['reference']+_0x396730(0x145)));this['proceedComponentMeta'](_0x5ca0aa['request'][_0x396730(0x140)],_0x5ca0aa[_0x396730(0x1a7)]),_0x53b348[_0x396730(0x15f)](_0x5ca0aa[_0x396730(0x172)],_0x1d5777[_0x396730(0x172)],_0x729b8['request']),_0x2fb236&&_0x53b348['push'](this[_0x396730(0x174)](_0x2fb236,'@{'+_0x1d5777[_0x396730(0x1a7)]+'.id}'));}return _0x53b348;}async['update'](_0x5e9a2d,_0x421a10=''){const _0x54dc5d=a272_0x110482,_0x4c12fc=[];for(const {component:_0x5ce5eb,meta:_0x32d6c4}of _0x5e9a2d){if(!_0x32d6c4['id']){const _0x4df159=this[_0x54dc5d(0x18c)][_0x54dc5d(0x189)](_0x294155=>_0x294155[_0x54dc5d(0x177)]===_0x5ce5eb[_0x54dc5d(0x154)]&&_0x294155[_0x54dc5d(0x1a5)]===_0x5ce5eb[_0x54dc5d(0x14c)]);if(!_0x4df159)throw new salesforce_error_1[(_0x54dc5d(0x173))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x5ce5eb[_0x54dc5d(0x154)]+'\x20['+_0x5ce5eb[_0x54dc5d(0x14c)]+']\x20-\x20meta\x20not\x20found'));_0x32d6c4['id']=_0x4df159[_0x54dc5d(0x143)];}const _0x31c19c=(0x0,composite_utils_1[_0x54dc5d(0x17b)])(constants_1[_0x54dc5d(0x17a)],_0x32d6c4['id'],this[_0x54dc5d(0x169)](_0x5ce5eb,_0x32d6c4)),_0x2ec7dc=(0x0,composite_utils_1[_0x54dc5d(0x165)])(constants_1[_0x54dc5d(0x183)],this[_0x54dc5d(0x144)](_0x5ce5eb,_0x32d6c4['id'],_0x32d6c4[_0x54dc5d(0x150)])),_0xc5eca2=(0x0,composite_utils_1[_0x54dc5d(0x165)])(constants_1[_0x54dc5d(0x159)],await this['prepareComponentAttachmentRecord'](_0x5ce5eb,'@{'+_0x2ec7dc[_0x54dc5d(0x1a7)]+_0x54dc5d(0x145)));this[_0x54dc5d(0x197)](_0x31c19c[_0x54dc5d(0x172)][_0x54dc5d(0x140)],_0x31c19c[_0x54dc5d(0x1a7)]),_0x4c12fc[_0x54dc5d(0x15f)](_0x31c19c[_0x54dc5d(0x172)],_0x2ec7dc['request'],_0xc5eca2[_0x54dc5d(0x172)]),_0x421a10&&_0x4c12fc[_0x54dc5d(0x15f)](this[_0x54dc5d(0x174)](_0x421a10,'@{'+_0x2ec7dc[_0x54dc5d(0x1a7)]+_0x54dc5d(0x145)));}return _0x4c12fc;}async[a272_0x110482(0x148)](_0x32e2d0,_0x2cd262=![]){const _0x494bd5=a272_0x110482,_0x28648b={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0xff40a6=[];for(const _0x620cf4 of _0x32e2d0){if(_0x620cf4['id'])_0xff40a6['push'](_0x620cf4['id']);else{const _0x569f04=this[_0x494bd5(0x18c)][_0x494bd5(0x189)](_0x2eafe5=>_0x2eafe5[_0x494bd5(0x177)]===_0x620cf4[_0x494bd5(0x154)]&&_0x2eafe5['componentType']===_0x620cf4[_0x494bd5(0x14c)]);if(!_0x569f04||!_0x569f04[_0x494bd5(0x143)])continue;_0xff40a6['push'](_0x569f04[_0x494bd5(0x143)]);}}if(_0x2cd262){const _0x3168a5=await this[_0x494bd5(0x17c)][_0x494bd5(0x153)](_0xff40a6);_0x28648b['manifests']=_0x3168a5[_0x494bd5(0x178)](_0x3881b0=>(0x0,composite_utils_1[_0x494bd5(0x166)])(constants_1[_0x494bd5(0x158)],_0x3881b0)[_0x494bd5(0x172)]);}return _0x28648b[_0x494bd5(0x1a3)]=_0xff40a6['map'](_0x3743d7=>(0x0,composite_utils_1[_0x494bd5(0x17b)])(constants_1[_0x494bd5(0x17a)],_0x3743d7,{[constants_1[_0x494bd5(0x155)]+_0x494bd5(0x18f)]:!![]})[_0x494bd5(0x172)]),_0x28648b[_0x494bd5(0x14f)]=_0xff40a6['map'](_0x2b02b5=>(0x0,composite_utils_1[_0x494bd5(0x166)])(constants_1['FLOSUM_COMPONENT'],_0x2b02b5)[_0x494bd5(0x172)]),_0x28648b;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;