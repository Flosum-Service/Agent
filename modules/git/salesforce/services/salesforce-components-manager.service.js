const a234_0x3a3cae=a234_0x4735;(function(_0x4d6e5d,_0x5c05c8){const _0x17ffd7=a234_0x4735,_0xbfd681=_0x4d6e5d();while(!![]){try{const _0x4ec48c=-parseInt(_0x17ffd7(0x1fb))/0x1*(parseInt(_0x17ffd7(0x1e3))/0x2)+-parseInt(_0x17ffd7(0x216))/0x3*(-parseInt(_0x17ffd7(0x1bc))/0x4)+-parseInt(_0x17ffd7(0x204))/0x5+-parseInt(_0x17ffd7(0x1e6))/0x6*(-parseInt(_0x17ffd7(0x1db))/0x7)+-parseInt(_0x17ffd7(0x1ed))/0x8+parseInt(_0x17ffd7(0x20a))/0x9*(parseInt(_0x17ffd7(0x1fd))/0xa)+-parseInt(_0x17ffd7(0x1de))/0xb*(parseInt(_0x17ffd7(0x1c2))/0xc);if(_0x4ec48c===_0x5c05c8)break;else _0xbfd681['push'](_0xbfd681['shift']());}catch(_0x380c9a){_0xbfd681['push'](_0xbfd681['shift']());}}}(a234_0x4232,0x6b270));const a234_0x11c5b4=(function(){let _0x599433=!![];return function(_0x40fda1,_0x3713d7){const _0x57c2f9=_0x599433?function(){const _0x44164c=a234_0x4735;if(_0x3713d7){const _0x4f47a5=_0x3713d7[_0x44164c(0x215)](_0x40fda1,arguments);return _0x3713d7=null,_0x4f47a5;}}:function(){};return _0x599433=![],_0x57c2f9;};}()),a234_0x489eeb=a234_0x11c5b4(this,function(){const _0x2b6901=a234_0x4735;return a234_0x489eeb[_0x2b6901(0x1ca)]()[_0x2b6901(0x1eb)](_0x2b6901(0x21b))['toString']()['constructor'](a234_0x489eeb)[_0x2b6901(0x1eb)](_0x2b6901(0x21b));});a234_0x489eeb();function a234_0x4735(_0x5f39ac,_0x572ebf){const _0x2d736=a234_0x4232();return a234_0x4735=function(_0x489eeb,_0x11c5b4){_0x489eeb=_0x489eeb-0x1b6;let _0x4232d5=_0x2d736[_0x489eeb];return _0x4232d5;},a234_0x4735(_0x5f39ac,_0x572ebf);}'use strict';var __importDefault=this&&this[a234_0x3a3cae(0x203)]||function(_0x155deb){const _0x5aa565=a234_0x3a3cae;return _0x155deb&&_0x155deb[_0x5aa565(0x1e7)]?_0x155deb:{'default':_0x155deb};};Object[a234_0x3a3cae(0x21e)](exports,a234_0x3a3cae(0x1e7),{'value':!![]}),exports[a234_0x3a3cae(0x1ce)]=void 0x0;function a234_0x4232(){const _0x354184=['username','Component_History__c','Committed_On__c','gitSync','Branch__c','SalesforceError','application/zip','createZip','Changed_On__c','16684Dmuxrp','Repository__c','1173390IySxVC','fetchCommitManifestsByComponentIds','componentsToDelete','isVlocityComponent','base64','Last_Modified_Date__c','__importDefault','2128160CPFRpU','find','name','../errors/salesforce.error','file','Name','54krlLkH','componentId','createPatchRequest','componentName','RecordTypeId','Branch','prepareComponentAttachmentRecord','reference','Component_Name__c','getProceededComponentsMeta','typedi','apply','203514lGziBT','extractFieldsFromRecord','../../parsers/utils/zip','FLOSUM_ATTACHMENT','Logger','(((.+)+)+)+$','componentsToUpdate','logger','defineProperty','branchId','prepareComponentHistoryRecord',']\x20-\x20meta\x20not\x20found','vlocityComponentName','Body','toISOString','generateAsync','24CSDLfX','type','Component__c','body','FLOSUM_COMMIT_MANIFEST','createPostRequest','578916doVzEf','ContentType','FLOSUM_GIT_NAMESPACE','ParentId','Repository','Component_Type__c','./salesforce-git-sync.service','../../../../core','toString','../utils/composite.utils','DEFLATE','Source__c','SalesforceComponentsManager','createDeleteRequest','FLOSUM_NAMESPACE','Commit__c','keys','File_Name__c','Last_Modified_By__c','repositoryId','prepareCommitManifest','Description','push','FLOSUM_COMPONENT_HISTORY','Last_Updated_By__c','7KlVcdh','Could\x20not\x20proceed\x20component\x20','.id}','66fEtqJM','proceededComponentsMeta','request','Zip','CRC32__c','14GVgxdf','FLOSUM_COMPONENT','get','5208978fqVRJm','__esModule','recordTypes','map','filePath','search','Version__c','5667608EdxCVJ','files','prepareComponentRecord','proceedComponentMeta','componentType'];a234_0x4232=function(){return _0x354184;};return a234_0x4232();}const constants_1=require('../../../../constants'),core_1=require(a234_0x3a3cae(0x1c9)),zip_1=require(a234_0x3a3cae(0x218)),typedi_1=__importDefault(require(a234_0x3a3cae(0x214))),salesforce_error_1=require(a234_0x3a3cae(0x207)),composite_utils_1=require(a234_0x3a3cae(0x1cb)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a234_0x3a3cae(0x1c8));class SalesforceComponentsManager{constructor(_0x5be58b,_0x5d14e0,_0x190148,_0x36514c,_0x84ad1b){const _0x9fbf91=a234_0x3a3cae;this[_0x9fbf91(0x1d5)]=_0x5be58b,this[_0x9fbf91(0x21f)]=_0x5d14e0,this['username']=_0x190148,this[_0x9fbf91(0x1e8)]=_0x36514c,this['proceededComponentsMeta']=_0x84ad1b,this[_0x9fbf91(0x21d)]=new core_1[(_0x9fbf91(0x21a))](SalesforceComponentsManager['name']),this['gitSync']=typedi_1['default'][_0x9fbf91(0x1e5)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a234_0x3a3cae(0x1f0)](_0x1e1ca7,_0x10542f){const _0x314a6f=a234_0x3a3cae,_0x1d61ca=(0x0,flosum_naming_utils_1[_0x314a6f(0x217)])(_0x1e1ca7,[_0x314a6f(0x1c7),'Component_Name__c',_0x314a6f(0x1ec)]);this[_0x314a6f(0x1df)][_0x314a6f(0x1d8)]({'componentId':'','reference':_0x10542f,'version':_0x1d61ca[_0x314a6f(0x1ec)],'componentName':_0x1d61ca[_0x314a6f(0x212)],'componentType':_0x1d61ca[_0x314a6f(0x1c7)]});}['prepareCommitManifest'](_0x20553e,_0x4b9fde){const _0xf548f7=a234_0x3a3cae,{request:_0x8b31f3}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0xf548f7(0x1c0)],{[constants_1['FLOSUM_NAMESPACE']+_0xf548f7(0x1d1)]:_0x20553e,[constants_1[_0xf548f7(0x1d0)]+_0xf548f7(0x1f3)]:_0x4b9fde});return _0x8b31f3;}async['prepareComponentAttachmentRecord'](_0x43eae0,_0x5d0bf6){const _0x56b0c6=a234_0x3a3cae,_0x6f37e2={},_0x19e33e=zip_1[_0x56b0c6(0x1e1)][_0x56b0c6(0x1f9)]();for(const _0x34bef2 of Object[_0x56b0c6(0x1d2)](_0x43eae0[_0x56b0c6(0x1ee)])){_0x19e33e[_0x56b0c6(0x208)](_0x34bef2,_0x43eae0['files'][_0x34bef2],{'createFolders':!![]});}return _0x6f37e2[_0x56b0c6(0x1c3)]=_0x56b0c6(0x1f8),_0x6f37e2[_0x56b0c6(0x209)]=_0x43eae0[_0x56b0c6(0x1bd)],_0x6f37e2[_0x56b0c6(0x1d7)]=_0x43eae0[_0x56b0c6(0x1bd)],_0x6f37e2[_0x56b0c6(0x1c5)]=_0x5d0bf6,_0x6f37e2[_0x56b0c6(0x1b9)]=await _0x19e33e[_0x56b0c6(0x1bb)]({'type':_0x56b0c6(0x201),'compression':_0x56b0c6(0x1cc),'compressionOptions':{'level':0x6}}),_0x6f37e2;}[a234_0x3a3cae(0x1b6)](_0x4c88b3,_0x545027,_0x4685af){const _0xbf42ea=a234_0x3a3cae,_0x580749=new Date()[_0xbf42ea(0x1ba)](),_0x164954={};return _0x164954[constants_1['FLOSUM_NAMESPACE']+_0xbf42ea(0x1be)]=_0x545027,_0x164954[constants_1[_0xbf42ea(0x1d0)]+_0xbf42ea(0x1e2)]=_0x4c88b3['crc'],_0x164954[constants_1[_0xbf42ea(0x1d0)]+_0xbf42ea(0x1fa)]=_0x580749,_0x164954[constants_1['FLOSUM_NAMESPACE']+'Changed_By__c']=this[_0xbf42ea(0x1f2)],_0x164954[constants_1[_0xbf42ea(0x1d0)]+_0xbf42ea(0x1ec)]=_0x4685af?_0x4685af+0x1:0x1,_0x164954[constants_1[_0xbf42ea(0x1c4)]+'Is_From_Agent__c']=!![],_0x164954;}[a234_0x3a3cae(0x1ef)](_0x509ee9,_0x41a281){const _0x4310a8=a234_0x3a3cae;var _0x189441,_0x1e1122;const _0x3bab4e=new Date()[_0x4310a8(0x1ba)](),_0x591235={};return!_0x41a281?(this[_0x4310a8(0x21f)]?(_0x591235[constants_1[_0x4310a8(0x1d0)]+_0x4310a8(0x1f6)]=this[_0x4310a8(0x21f)],_0x591235[constants_1[_0x4310a8(0x1d0)]+_0x4310a8(0x1cd)]=_0x4310a8(0x20f),_0x591235[_0x4310a8(0x20e)]=(_0x189441=this[_0x4310a8(0x1e8)][_0x4310a8(0x205)](_0x5bd528=>_0x5bd528['name']===_0x4310a8(0x20f)))===null||_0x189441===void 0x0?void 0x0:_0x189441['id']):(_0x591235[constants_1[_0x4310a8(0x1d0)]+_0x4310a8(0x1fc)]=this['repositoryId'],_0x591235[constants_1[_0x4310a8(0x1d0)]+'Source__c']=_0x4310a8(0x1c6),_0x591235[_0x4310a8(0x20e)]=(_0x1e1122=this[_0x4310a8(0x1e8)][_0x4310a8(0x205)](_0x5d65e2=>_0x5d65e2[_0x4310a8(0x206)]==='Repository'))===null||_0x1e1122===void 0x0?void 0x0:_0x1e1122['id']),_0x591235[constants_1[_0x4310a8(0x1d0)]+_0x4310a8(0x1ec)]=0x1):_0x591235[constants_1['FLOSUM_NAMESPACE']+'Version__c']=_0x41a281['version']+0x1,_0x591235[constants_1[_0x4310a8(0x1d0)]+_0x4310a8(0x1c7)]=_0x509ee9[_0x4310a8(0x1bd)],_0x591235[constants_1[_0x4310a8(0x1d0)]+_0x4310a8(0x212)]=_0x509ee9['name'],_0x591235[constants_1[_0x4310a8(0x1d0)]+_0x4310a8(0x1d3)]=_0x509ee9[_0x4310a8(0x1ea)],_0x591235[constants_1[_0x4310a8(0x1d0)]+_0x4310a8(0x1da)]=this[_0x4310a8(0x1f2)],_0x591235[constants_1['FLOSUM_NAMESPACE']+_0x4310a8(0x1d4)]=this[_0x4310a8(0x1f2)],_0x591235[constants_1['FLOSUM_NAMESPACE']+_0x4310a8(0x202)]=_0x3bab4e,_0x591235[constants_1[_0x4310a8(0x1d0)]+_0x4310a8(0x1f4)]=_0x3bab4e,_0x591235[constants_1['FLOSUM_NAMESPACE']+_0x4310a8(0x1e2)]=_0x509ee9['crc'],_0x591235[constants_1[_0x4310a8(0x1d0)]+'Vlocity_Component_Name__c']=_0x509ee9[_0x4310a8(0x1b8)],_0x591235[constants_1['FLOSUM_NAMESPACE']+'Vlocity_Component__c']=_0x509ee9[_0x4310a8(0x200)],_0x591235;}[a234_0x3a3cae(0x213)](){return this['proceededComponentsMeta'];}async['insert'](_0x506e5c,_0x3c17b0){const _0x20819d=a234_0x3a3cae,_0x426959=[];for(const _0x1bbe0d of _0x506e5c){const _0x728dda=(0x0,composite_utils_1[_0x20819d(0x1c1)])(constants_1['FLOSUM_COMPONENT'],this['prepareComponentRecord'](_0x1bbe0d)),_0x478bfa=(0x0,composite_utils_1[_0x20819d(0x1c1)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this['prepareComponentHistoryRecord'](_0x1bbe0d,'@{'+_0x728dda[_0x20819d(0x211)]+_0x20819d(0x1dd))),_0x29d42f=(0x0,composite_utils_1[_0x20819d(0x1c1)])(constants_1[_0x20819d(0x219)],await this[_0x20819d(0x210)](_0x1bbe0d,'@{'+_0x478bfa[_0x20819d(0x211)]+'.id}'));this[_0x20819d(0x1f0)](_0x728dda[_0x20819d(0x1e0)][_0x20819d(0x1bf)],_0x728dda[_0x20819d(0x211)]),_0x426959[_0x20819d(0x1d8)](_0x728dda[_0x20819d(0x1e0)],_0x478bfa[_0x20819d(0x1e0)],_0x29d42f[_0x20819d(0x1e0)]),_0x3c17b0&&_0x426959['push'](this[_0x20819d(0x1d6)](_0x3c17b0,'@{'+_0x478bfa['reference']+_0x20819d(0x1dd)));}return _0x426959;}async['update'](_0x34dd87,_0x511c91=''){const _0xe34756=a234_0x3a3cae,_0xde0393=[];for(const {component:_0x1916ca,meta:_0x3553e6}of _0x34dd87){if(!_0x3553e6['id']){const _0x45a054=this['proceededComponentsMeta'][_0xe34756(0x205)](_0xe3b2ef=>_0xe3b2ef[_0xe34756(0x20d)]===_0x1916ca[_0xe34756(0x206)]&&_0xe3b2ef[_0xe34756(0x1f1)]===_0x1916ca[_0xe34756(0x1bd)]);if(!_0x45a054)throw new salesforce_error_1[(_0xe34756(0x1f7))](new Error(_0xe34756(0x1dc)+_0x1916ca[_0xe34756(0x206)]+'\x20['+_0x1916ca[_0xe34756(0x1bd)]+_0xe34756(0x1b7)));_0x3553e6['id']=_0x45a054['componentId'];}const _0x42aca3=(0x0,composite_utils_1[_0xe34756(0x20c)])(constants_1[_0xe34756(0x1e4)],_0x3553e6['id'],this[_0xe34756(0x1ef)](_0x1916ca,_0x3553e6)),_0x3eccb7=(0x0,composite_utils_1[_0xe34756(0x1c1)])(constants_1[_0xe34756(0x1d9)],this[_0xe34756(0x1b6)](_0x1916ca,_0x3553e6['id'],_0x3553e6['version'])),_0x385610=(0x0,composite_utils_1[_0xe34756(0x1c1)])(constants_1[_0xe34756(0x219)],await this[_0xe34756(0x210)](_0x1916ca,'@{'+_0x3eccb7[_0xe34756(0x211)]+_0xe34756(0x1dd)));this[_0xe34756(0x1f0)](_0x42aca3[_0xe34756(0x1e0)][_0xe34756(0x1bf)],_0x42aca3['reference']),_0xde0393['push'](_0x42aca3['request'],_0x3eccb7['request'],_0x385610['request']),_0x511c91&&_0xde0393[_0xe34756(0x1d8)](this['prepareCommitManifest'](_0x511c91,'@{'+_0x3eccb7[_0xe34756(0x211)]+_0xe34756(0x1dd)));}return _0xde0393;}async['delete'](_0x2089b1,_0x214578=![]){const _0x1588ac=a234_0x3a3cae,_0x9e4753={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x5504f6=[];for(const _0x6ecb97 of _0x2089b1){if(_0x6ecb97['id'])_0x5504f6[_0x1588ac(0x1d8)](_0x6ecb97['id']);else{const _0x31fd61=this[_0x1588ac(0x1df)][_0x1588ac(0x205)](_0x12adc3=>_0x12adc3[_0x1588ac(0x20d)]===_0x6ecb97['name']&&_0x12adc3[_0x1588ac(0x1f1)]===_0x6ecb97[_0x1588ac(0x1bd)]);if(!_0x31fd61||!_0x31fd61[_0x1588ac(0x20b)])continue;_0x5504f6['push'](_0x31fd61['componentId']);}}if(_0x214578){const _0x131ff9=await this[_0x1588ac(0x1f5)][_0x1588ac(0x1fe)](_0x5504f6);_0x9e4753['manifests']=_0x131ff9['map'](_0x3c6a43=>(0x0,composite_utils_1[_0x1588ac(0x1cf)])(constants_1[_0x1588ac(0x1c0)],_0x3c6a43)['request']);}return _0x9e4753[_0x1588ac(0x21c)]=_0x5504f6[_0x1588ac(0x1e9)](_0x69ce60=>(0x0,composite_utils_1['createPatchRequest'])(constants_1['FLOSUM_COMPONENT'],_0x69ce60,{[constants_1[_0x1588ac(0x1c4)]+'Deletion_By_Agent__c']:!![]})[_0x1588ac(0x1e0)]),_0x9e4753[_0x1588ac(0x1ff)]=_0x5504f6[_0x1588ac(0x1e9)](_0x1a3af6=>(0x0,composite_utils_1[_0x1588ac(0x1cf)])(constants_1[_0x1588ac(0x1e4)],_0x1a3af6)[_0x1588ac(0x1e0)]),_0x9e4753;}}exports[a234_0x3a3cae(0x1ce)]=SalesforceComponentsManager;