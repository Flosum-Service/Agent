const a271_0x100719=a271_0x1891;(function(_0x2ab51d,_0x428a94){const _0x52da6a=a271_0x1891,_0x53444a=_0x2ab51d();while(!![]){try{const _0x48afd3=parseInt(_0x52da6a(0xde))/0x1*(-parseInt(_0x52da6a(0x8a))/0x2)+-parseInt(_0x52da6a(0xbf))/0x3*(parseInt(_0x52da6a(0xab))/0x4)+-parseInt(_0x52da6a(0x8b))/0x5*(-parseInt(_0x52da6a(0xa9))/0x6)+parseInt(_0x52da6a(0xba))/0x7*(parseInt(_0x52da6a(0xb6))/0x8)+-parseInt(_0x52da6a(0xdb))/0x9+parseInt(_0x52da6a(0xa8))/0xa*(-parseInt(_0x52da6a(0x99))/0xb)+parseInt(_0x52da6a(0xdc))/0xc;if(_0x48afd3===_0x428a94)break;else _0x53444a['push'](_0x53444a['shift']());}catch(_0xf4e6c7){_0x53444a['push'](_0x53444a['shift']());}}}(a271_0x53bb,0x32e21));const a271_0x108e4c=(function(){let _0x4b5e59=!![];return function(_0x1faa14,_0x4b125e){const _0x202d05=_0x4b5e59?function(){if(_0x4b125e){const _0xb35871=_0x4b125e['apply'](_0x1faa14,arguments);return _0x4b125e=null,_0xb35871;}}:function(){};return _0x4b5e59=![],_0x202d05;};}()),a271_0x304781=a271_0x108e4c(this,function(){const _0x391720=a271_0x1891;return a271_0x304781[_0x391720(0xaf)]()[_0x391720(0xc7)](_0x391720(0xea))[_0x391720(0xaf)]()[_0x391720(0xec)](a271_0x304781)[_0x391720(0xc7)](_0x391720(0xea));});a271_0x304781();'use strict';var __importDefault=this&&this[a271_0x100719(0xd1)]||function(_0x52e336){const _0x41cc70=a271_0x100719;return _0x52e336&&_0x52e336[_0x41cc70(0xe8)]?_0x52e336:{'default':_0x52e336};};Object[a271_0x100719(0xe4)](exports,a271_0x100719(0xe8),{'value':!![]}),exports[a271_0x100719(0xa3)]=void 0x0;function a271_0x53bb(){const _0x193235=['RecordTypeId','249387vNfAqN','Branch','repositoryId','gitSync','type','push','Component_History__c','Component_Name__c','search','Could\x20not\x20proceed\x20component\x20','CRC32__c','createDeleteRequest','MC_Key__c','Changed_On__c','FLOSUM_ATTACHMENT','FLOSUM_COMMIT_MANIFEST',']\x20-\x20meta\x20not\x20found','proceedComponentMeta','__importDefault','ParentId','Committed_On__c','Name','prepareComponentAttachmentRecord','componentsToUpdate','reference','default','proceededComponentsMeta','Repository','1763406ZFhpWB','4615356YRtDXi','recordTypes','229346OkVUzC','prepareComponentHistoryRecord','version','./salesforce-git-sync.service','Version__c','SalesforceGitSyncService','defineProperty','Logger','../../parsers/utils/zip','typedi','__esModule','generateAsync','(((.+)+)+)+$','Commit__c','constructor','FLOSUM_COMPONENT','Deletion_By_Agent__c','Description','manifests','logger','name','Branch__c','../../../../constants','prepareComponentRecord','createZip','Is_From_Agent__c','componentType','2mKjAhl','5amrYGa','files','application/zip','Vlocity_Component_Name__c','getProceededComponentsMeta','insert','Last_Modified_Date__c','../utils/flosum-naming.utils','update','../../../../core','base64','vlocityComponentName','Body','isVlocityComponent','319WAQsQR','../utils/composite.utils','DEFLATE','Component__c','createPostRequest','prepareCommitManifest','FLOSUM_COMPONENT_HISTORY','get','Vlocity_Component__c','Source__c','SalesforceComponentsManager','componentId','Zip','Component_Type__c','marketingCloudKey','14150idQoPY','1876962qKAwgc','map','12RMnrpo','extractFieldsFromRecord','componentName','request','toString','toISOString','FLOSUM_GIT_NAMESPACE','../errors/salesforce.error','Repository__c','username','Changed_By__c','3352gmMQPU','FLOSUM_NAMESPACE','createPatchRequest','.id}','3787qhNBxI','branchId','filePath','find'];a271_0x53bb=function(){return _0x193235;};return a271_0x53bb();}const constants_1=require(a271_0x100719(0x85)),core_1=require(a271_0x100719(0x94)),zip_1=require(a271_0x100719(0xe6)),typedi_1=__importDefault(require(a271_0x100719(0xe7))),salesforce_error_1=require(a271_0x100719(0xb2)),composite_utils_1=require(a271_0x100719(0x9a)),flosum_naming_utils_1=require(a271_0x100719(0x92)),salesforce_git_sync_service_1=require(a271_0x100719(0xe1));class SalesforceComponentsManager{constructor(_0x4c920a,_0xb245e7,_0x59b7f6,_0x404254,_0x48c308){const _0x1621fd=a271_0x100719;this[_0x1621fd(0xc1)]=_0x4c920a,this[_0x1621fd(0xbb)]=_0xb245e7,this[_0x1621fd(0xb4)]=_0x59b7f6,this['recordTypes']=_0x404254,this[_0x1621fd(0xd9)]=_0x48c308,this[_0x1621fd(0x82)]=new core_1[(_0x1621fd(0xe5))](SalesforceComponentsManager[_0x1621fd(0x83)]),this[_0x1621fd(0xc2)]=typedi_1[_0x1621fd(0xd8)][_0x1621fd(0xa0)](salesforce_git_sync_service_1[_0x1621fd(0xe3)]);}[a271_0x100719(0xd0)](_0x24962b,_0x202bde){const _0x17d0b9=a271_0x100719,_0x3a3562=(0x0,flosum_naming_utils_1[_0x17d0b9(0xac)])(_0x24962b,['Component_Type__c',_0x17d0b9(0xc6),_0x17d0b9(0xe2)]);this['proceededComponentsMeta'][_0x17d0b9(0xc4)]({'componentId':'','reference':_0x202bde,'version':_0x3a3562[_0x17d0b9(0xe2)],'componentName':_0x3a3562[_0x17d0b9(0xc6)],'componentType':_0x3a3562['Component_Type__c']});}['prepareCommitManifest'](_0x3f3523,_0x1b1cbb){const _0x33fe76=a271_0x100719,{request:_0xb9c6e7}=(0x0,composite_utils_1[_0x33fe76(0x9d)])(constants_1[_0x33fe76(0xce)],{[constants_1[_0x33fe76(0xb7)]+_0x33fe76(0xeb)]:_0x3f3523,[constants_1[_0x33fe76(0xb7)]+_0x33fe76(0xc5)]:_0x1b1cbb});return _0xb9c6e7;}async[a271_0x100719(0xd5)](_0x5268e9,_0x34c486){const _0x542375=a271_0x100719,_0xaf84f8={},_0x1571b0=zip_1[_0x542375(0xa5)][_0x542375(0x87)]();for(const _0x1bd96d of Object['keys'](_0x5268e9[_0x542375(0x8c)])){_0x1571b0['file'](_0x1bd96d,_0x5268e9[_0x542375(0x8c)][_0x1bd96d],{'createFolders':!![]});}return _0xaf84f8['ContentType']=_0x542375(0x8d),_0xaf84f8[_0x542375(0xd4)]=_0x5268e9[_0x542375(0xc3)],_0xaf84f8[_0x542375(0xef)]=_0x5268e9['type'],_0xaf84f8[_0x542375(0xd2)]=_0x34c486,_0xaf84f8[_0x542375(0x97)]=await _0x1571b0[_0x542375(0xe9)]({'type':_0x542375(0x95),'compression':_0x542375(0x9b),'compressionOptions':{'level':0x6}}),_0xaf84f8;}[a271_0x100719(0xdf)](_0x17e3b9,_0x26712d,_0x3d0b4f){const _0x28a8e5=a271_0x100719,_0x3b7697=new Date()[_0x28a8e5(0xb0)](),_0x5165d3={};return _0x5165d3[constants_1['FLOSUM_NAMESPACE']+_0x28a8e5(0x9c)]=_0x26712d,_0x5165d3[constants_1[_0x28a8e5(0xb7)]+_0x28a8e5(0xc9)]=_0x17e3b9['crc'],_0x5165d3[constants_1[_0x28a8e5(0xb7)]+_0x28a8e5(0xcc)]=_0x3b7697,_0x5165d3[constants_1[_0x28a8e5(0xb7)]+_0x28a8e5(0xb5)]=this[_0x28a8e5(0xb4)],_0x5165d3[constants_1[_0x28a8e5(0xb7)]+_0x28a8e5(0xe2)]=_0x3d0b4f?_0x3d0b4f+0x1:0x1,_0x5165d3[constants_1['FLOSUM_GIT_NAMESPACE']+_0x28a8e5(0x88)]=!![],_0x5165d3;}[a271_0x100719(0x86)](_0x7200f2,_0x3accd0){const _0x18273f=a271_0x100719;var _0x284957,_0x1b1939;const _0x26550a=new Date()[_0x18273f(0xb0)](),_0x27315b={};return!_0x3accd0?(this[_0x18273f(0xbb)]?(_0x27315b[constants_1[_0x18273f(0xb7)]+_0x18273f(0x84)]=this[_0x18273f(0xbb)],_0x27315b[constants_1[_0x18273f(0xb7)]+'Source__c']=_0x18273f(0xc0),_0x27315b['RecordTypeId']=(_0x284957=this[_0x18273f(0xdd)]['find'](_0x31c4a8=>_0x31c4a8[_0x18273f(0x83)]===_0x18273f(0xc0)))===null||_0x284957===void 0x0?void 0x0:_0x284957['id']):(_0x27315b[constants_1[_0x18273f(0xb7)]+_0x18273f(0xb3)]=this[_0x18273f(0xc1)],_0x27315b[constants_1[_0x18273f(0xb7)]+_0x18273f(0xa2)]=_0x18273f(0xda),_0x27315b[_0x18273f(0xbe)]=(_0x1b1939=this[_0x18273f(0xdd)][_0x18273f(0xbd)](_0x38c74a=>_0x38c74a['name']===_0x18273f(0xda)))===null||_0x1b1939===void 0x0?void 0x0:_0x1b1939['id']),_0x27315b[constants_1[_0x18273f(0xb7)]+_0x18273f(0xe2)]=0x1):_0x27315b[constants_1[_0x18273f(0xb7)]+_0x18273f(0xe2)]=_0x3accd0[_0x18273f(0xe0)]+0x1,_0x27315b[constants_1[_0x18273f(0xb7)]+_0x18273f(0xa6)]=_0x7200f2['type'],_0x27315b[constants_1[_0x18273f(0xb7)]+_0x18273f(0xc6)]=_0x7200f2[_0x18273f(0x83)],_0x27315b[constants_1[_0x18273f(0xb7)]+'File_Name__c']=_0x7200f2[_0x18273f(0xbc)],_0x27315b[constants_1[_0x18273f(0xb7)]+'Last_Updated_By__c']=this[_0x18273f(0xb4)],_0x27315b[constants_1['FLOSUM_NAMESPACE']+'Last_Modified_By__c']=this['username'],_0x27315b[constants_1['FLOSUM_NAMESPACE']+_0x18273f(0x91)]=_0x26550a,_0x27315b[constants_1[_0x18273f(0xb7)]+_0x18273f(0xd3)]=_0x26550a,_0x27315b[constants_1[_0x18273f(0xb7)]+_0x18273f(0xc9)]=_0x7200f2['crc'],_0x27315b[constants_1['FLOSUM_NAMESPACE']+_0x18273f(0x8e)]=_0x7200f2[_0x18273f(0x96)],_0x27315b[constants_1[_0x18273f(0xb7)]+_0x18273f(0xa1)]=_0x7200f2[_0x18273f(0x98)],_0x27315b[constants_1[_0x18273f(0xb7)]+_0x18273f(0xcb)]=_0x7200f2[_0x18273f(0xa7)],_0x27315b;}[a271_0x100719(0x8f)](){const _0x573823=a271_0x100719;return this[_0x573823(0xd9)];}async[a271_0x100719(0x90)](_0x570752,_0xbc656a){const _0xa0ad63=a271_0x100719,_0x154b18=[];for(const _0x210441 of _0x570752){const _0x39a07a=(0x0,composite_utils_1[_0xa0ad63(0x9d)])(constants_1['FLOSUM_COMPONENT'],this[_0xa0ad63(0x86)](_0x210441)),_0x2cb27a=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0xa0ad63(0x9f)],this['prepareComponentHistoryRecord'](_0x210441,'@{'+_0x39a07a['reference']+_0xa0ad63(0xb9))),_0x1e6eaa=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0xa0ad63(0xcd)],await this[_0xa0ad63(0xd5)](_0x210441,'@{'+_0x2cb27a['reference']+'.id}'));this[_0xa0ad63(0xd0)](_0x39a07a[_0xa0ad63(0xae)]['body'],_0x39a07a[_0xa0ad63(0xd7)]),_0x154b18[_0xa0ad63(0xc4)](_0x39a07a[_0xa0ad63(0xae)],_0x2cb27a[_0xa0ad63(0xae)],_0x1e6eaa[_0xa0ad63(0xae)]),_0xbc656a&&_0x154b18[_0xa0ad63(0xc4)](this[_0xa0ad63(0x9e)](_0xbc656a,'@{'+_0x2cb27a[_0xa0ad63(0xd7)]+_0xa0ad63(0xb9)));}return _0x154b18;}async[a271_0x100719(0x93)](_0x309f2a,_0x20f388=''){const _0x4deda4=a271_0x100719,_0x5a7f13=[];for(const {component:_0x1b7f1f,meta:_0x1ce752}of _0x309f2a){if(!_0x1ce752['id']){const _0x548191=this[_0x4deda4(0xd9)][_0x4deda4(0xbd)](_0xaca26e=>_0xaca26e[_0x4deda4(0xad)]===_0x1b7f1f['name']&&_0xaca26e['componentType']===_0x1b7f1f[_0x4deda4(0xc3)]);if(!_0x548191)throw new salesforce_error_1['SalesforceError'](new Error(_0x4deda4(0xc8)+_0x1b7f1f[_0x4deda4(0x83)]+'\x20['+_0x1b7f1f['type']+_0x4deda4(0xcf)));_0x1ce752['id']=_0x548191[_0x4deda4(0xa4)];}const _0x35a3a0=(0x0,composite_utils_1[_0x4deda4(0xb8)])(constants_1['FLOSUM_COMPONENT'],_0x1ce752['id'],this[_0x4deda4(0x86)](_0x1b7f1f,_0x1ce752)),_0x5b339a=(0x0,composite_utils_1[_0x4deda4(0x9d)])(constants_1[_0x4deda4(0x9f)],this['prepareComponentHistoryRecord'](_0x1b7f1f,_0x1ce752['id'],_0x1ce752['version'])),_0x18447f=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x4deda4(0xcd)],await this[_0x4deda4(0xd5)](_0x1b7f1f,'@{'+_0x5b339a[_0x4deda4(0xd7)]+_0x4deda4(0xb9)));this[_0x4deda4(0xd0)](_0x35a3a0['request']['body'],_0x35a3a0[_0x4deda4(0xd7)]),_0x5a7f13[_0x4deda4(0xc4)](_0x35a3a0[_0x4deda4(0xae)],_0x5b339a[_0x4deda4(0xae)],_0x18447f[_0x4deda4(0xae)]),_0x20f388&&_0x5a7f13[_0x4deda4(0xc4)](this[_0x4deda4(0x9e)](_0x20f388,'@{'+_0x5b339a[_0x4deda4(0xd7)]+_0x4deda4(0xb9)));}return _0x5a7f13;}async['delete'](_0x2571b6,_0x28575c=![]){const _0x5ec182=a271_0x100719,_0x5436f7={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x6061d8=[];for(const _0x47df69 of _0x2571b6){if(_0x47df69['id'])_0x6061d8[_0x5ec182(0xc4)](_0x47df69['id']);else{const _0x405e80=this[_0x5ec182(0xd9)][_0x5ec182(0xbd)](_0xe4b6f4=>_0xe4b6f4[_0x5ec182(0xad)]===_0x47df69[_0x5ec182(0x83)]&&_0xe4b6f4[_0x5ec182(0x89)]===_0x47df69[_0x5ec182(0xc3)]);if(!_0x405e80||!_0x405e80[_0x5ec182(0xa4)])continue;_0x6061d8['push'](_0x405e80[_0x5ec182(0xa4)]);}}if(_0x28575c){const _0x7dce2b=await this['gitSync']['fetchCommitManifestsByComponentIds'](_0x6061d8);_0x5436f7[_0x5ec182(0xf0)]=_0x7dce2b['map'](_0x442dc4=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x442dc4)['request']);}return _0x5436f7[_0x5ec182(0xd6)]=_0x6061d8[_0x5ec182(0xaa)](_0x24bc4c=>(0x0,composite_utils_1[_0x5ec182(0xb8)])(constants_1[_0x5ec182(0xed)],_0x24bc4c,{[constants_1[_0x5ec182(0xb1)]+_0x5ec182(0xee)]:!![]})[_0x5ec182(0xae)]),_0x5436f7['componentsToDelete']=_0x6061d8[_0x5ec182(0xaa)](_0x5df9eb=>(0x0,composite_utils_1[_0x5ec182(0xca)])(constants_1[_0x5ec182(0xed)],_0x5df9eb)['request']),_0x5436f7;}}function a271_0x1891(_0x5e07c9,_0x2f9d69){const _0x36ae8c=a271_0x53bb();return a271_0x1891=function(_0x304781,_0x108e4c){_0x304781=_0x304781-0x82;let _0x53bbd0=_0x36ae8c[_0x304781];return _0x53bbd0;},a271_0x1891(_0x5e07c9,_0x2f9d69);}exports['SalesforceComponentsManager']=SalesforceComponentsManager;