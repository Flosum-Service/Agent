const a229_0x21c130=a229_0x447a;function a229_0x447a(_0x2aa4a9,_0x42ca24){const _0x1b4c81=a229_0x28f4();return a229_0x447a=function(_0x5db48b,_0x2bfafd){_0x5db48b=_0x5db48b-0x65;let _0x28f4f8=_0x1b4c81[_0x5db48b];return _0x28f4f8;},a229_0x447a(_0x2aa4a9,_0x42ca24);}(function(_0x1a822f,_0x498cb8){const _0x5af1e3=a229_0x447a,_0x131bee=_0x1a822f();while(!![]){try{const _0x51d38c=parseInt(_0x5af1e3(0x78))/0x1+parseInt(_0x5af1e3(0x8c))/0x2*(-parseInt(_0x5af1e3(0xb2))/0x3)+parseInt(_0x5af1e3(0x77))/0x4+parseInt(_0x5af1e3(0x9e))/0x5+-parseInt(_0x5af1e3(0x7c))/0x6+parseInt(_0x5af1e3(0xa7))/0x7+parseInt(_0x5af1e3(0xb7))/0x8*(-parseInt(_0x5af1e3(0xa9))/0x9);if(_0x51d38c===_0x498cb8)break;else _0x131bee['push'](_0x131bee['shift']());}catch(_0xeb48a3){_0x131bee['push'](_0x131bee['shift']());}}}(a229_0x28f4,0xa49cb));const a229_0x2bfafd=(function(){let _0x295cf9=!![];return function(_0x4f3f46,_0x509c2b){const _0x124f08=_0x295cf9?function(){const _0x50a8ce=a229_0x447a;if(_0x509c2b){const _0x4a1d36=_0x509c2b[_0x50a8ce(0xbc)](_0x4f3f46,arguments);return _0x509c2b=null,_0x4a1d36;}}:function(){};return _0x295cf9=![],_0x124f08;};}()),a229_0x5db48b=a229_0x2bfafd(this,function(){const _0x24e1d9=a229_0x447a;return a229_0x5db48b[_0x24e1d9(0xad)]()[_0x24e1d9(0xac)](_0x24e1d9(0x94))[_0x24e1d9(0xad)]()[_0x24e1d9(0x6c)](a229_0x5db48b)[_0x24e1d9(0xac)](_0x24e1d9(0x94));});a229_0x5db48b();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x150366){const _0x3611cd=a229_0x447a;return _0x150366&&_0x150366[_0x3611cd(0x73)]?_0x150366:{'default':_0x150366};};Object[a229_0x21c130(0x80)](exports,a229_0x21c130(0x73),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a229_0x21c130(0x7b)),core_1=require('../../../../core'),zip_1=require(a229_0x21c130(0x9a)),typedi_1=__importDefault(require(a229_0x21c130(0xaf))),salesforce_error_1=require(a229_0x21c130(0xbe)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a229_0x21c130(0xab));function a229_0x28f4(){const _0x395613=['Branch','get','Body','Changed_By__c','SalesforceError','prepareComponentAttachmentRecord','repositoryId','1571946OMUOjd','branchId','crc','CRC32__c','Component__c','FLOSUM_NAMESPACE','getProceededComponentsMeta','recordTypes','(((.+)+)+)+$','proceededComponentsMeta','ParentId','Component_Type__c','Source__c','base64','../../parsers/utils/zip','gitSync','Last_Modified_Date__c','fetchCommitManifestsByComponentIds','2528770SZDoXO','push','proceedComponentMeta','generateAsync','files','Zip','Repository__c','ContentType','FLOSUM_COMMIT_MANIFEST','6138531NrZHxC','Last_Modified_By__c','10356885TLYsMI','default','./salesforce-git-sync.service','search','toString','body','typedi','createZip','logger','3PwHUHY','.id}','Last_Updated_By__c','FLOSUM_ATTACHMENT','FLOSUM_COMPONENT','8QzTnSd','prepareComponentHistoryRecord','Committed_On__c','extractFieldsFromRecord','prepareCommitManifest','apply','componentType','../errors/salesforce.error','prepareComponentRecord','createDeleteRequest','Component_Name__c','map','componentId','reference','toISOString','username','Changed_On__c','constructor','find','componentName','FLOSUM_GIT_NAMESPACE','FLOSUM_COMPONENT_HISTORY','type','SalesforceGitSyncService','__esModule','request','Branch__c','createPatchRequest','4853816nTfiLM','579467UghWzk','Component_History__c','Version__c','../../../../constants','3387714zFJhMr','update','componentsToUpdate','RecordTypeId','defineProperty','createPostRequest','Logger','name','version'];a229_0x28f4=function(){return _0x395613;};return a229_0x28f4();}class SalesforceComponentsManager{constructor(_0x19e51a,_0x377631,_0x2ec14f,_0x6dac3c,_0x224549){const _0x2d493=a229_0x21c130;this[_0x2d493(0x8b)]=_0x19e51a,this[_0x2d493(0x8d)]=_0x377631,this[_0x2d493(0x6a)]=_0x2ec14f,this[_0x2d493(0x93)]=_0x6dac3c,this[_0x2d493(0x95)]=_0x224549,this[_0x2d493(0xb1)]=new core_1[(_0x2d493(0x82))](SalesforceComponentsManager['name']),this['gitSync']=typedi_1[_0x2d493(0xaa)][_0x2d493(0x86)](salesforce_git_sync_service_1[_0x2d493(0x72)]);}[a229_0x21c130(0xa0)](_0x2e7ac7,_0x3699ea){const _0x32e58a=a229_0x21c130,_0x2c3d63=(0x0,flosum_naming_utils_1[_0x32e58a(0xba)])(_0x2e7ac7,['Component_Type__c',_0x32e58a(0x65),'Version__c']);this[_0x32e58a(0x95)][_0x32e58a(0x9f)]({'componentId':'','reference':_0x3699ea,'version':_0x2c3d63[_0x32e58a(0x7a)],'componentName':_0x2c3d63[_0x32e58a(0x65)],'componentType':_0x2c3d63[_0x32e58a(0x97)]});}[a229_0x21c130(0xbb)](_0x30a2db,_0x1b29b3){const _0xa93c33=a229_0x21c130,{request:_0x2d102e}=(0x0,composite_utils_1[_0xa93c33(0x81)])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0xa93c33(0x91)]+'Commit__c']:_0x30a2db,[constants_1[_0xa93c33(0x91)]+_0xa93c33(0x79)]:_0x1b29b3});return _0x2d102e;}async[a229_0x21c130(0x8a)](_0xe90d9e,_0xfb20e){const _0x49f17b=a229_0x21c130,_0x168724={},_0x3867a4=zip_1[_0x49f17b(0xa3)][_0x49f17b(0xb0)]();for(const _0xc1d2e7 of Object['keys'](_0xe90d9e[_0x49f17b(0xa2)])){_0x3867a4['file'](_0xc1d2e7,_0xe90d9e[_0x49f17b(0xa2)][_0xc1d2e7],{'createFolders':!![]});}return _0x168724[_0x49f17b(0xa5)]='application/zip',_0x168724['Name']=_0xe90d9e[_0x49f17b(0x71)],_0x168724['Description']=_0xe90d9e[_0x49f17b(0x71)],_0x168724[_0x49f17b(0x96)]=_0xfb20e,_0x168724[_0x49f17b(0x87)]=await _0x3867a4[_0x49f17b(0xa1)]({'type':_0x49f17b(0x99),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x168724;}[a229_0x21c130(0xb8)](_0x2d5581,_0x3076e4,_0x3436fd){const _0x21e3d8=a229_0x21c130,_0x19ed01=new Date()['toISOString'](),_0x3929dd={};return _0x3929dd[constants_1[_0x21e3d8(0x91)]+_0x21e3d8(0x90)]=_0x3076e4,_0x3929dd[constants_1[_0x21e3d8(0x91)]+_0x21e3d8(0x8f)]=_0x2d5581['crc'],_0x3929dd[constants_1[_0x21e3d8(0x91)]+_0x21e3d8(0x6b)]=_0x19ed01,_0x3929dd[constants_1[_0x21e3d8(0x91)]+_0x21e3d8(0x88)]=this[_0x21e3d8(0x6a)],_0x3929dd[constants_1[_0x21e3d8(0x91)]+_0x21e3d8(0x7a)]=_0x3436fd?_0x3436fd+0x1:0x1,_0x3929dd[constants_1[_0x21e3d8(0x6f)]+'Is_From_Agent__c']=!![],_0x3929dd;}['prepareComponentRecord'](_0xa9d9d8,_0x19a54a){const _0x1df2b2=a229_0x21c130;var _0x1a067b,_0x3907b6;const _0x2a3c7b=new Date()[_0x1df2b2(0x69)](),_0x230123={};return!_0x19a54a?(this[_0x1df2b2(0x8d)]?(_0x230123[constants_1[_0x1df2b2(0x91)]+_0x1df2b2(0x75)]=this[_0x1df2b2(0x8d)],_0x230123[constants_1[_0x1df2b2(0x91)]+_0x1df2b2(0x98)]=_0x1df2b2(0x85),_0x230123[_0x1df2b2(0x7f)]=(_0x1a067b=this[_0x1df2b2(0x93)][_0x1df2b2(0x6d)](_0x21e638=>_0x21e638[_0x1df2b2(0x83)]===_0x1df2b2(0x85)))===null||_0x1a067b===void 0x0?void 0x0:_0x1a067b['id']):(_0x230123[constants_1[_0x1df2b2(0x91)]+_0x1df2b2(0xa4)]=this[_0x1df2b2(0x8b)],_0x230123[constants_1[_0x1df2b2(0x91)]+'Source__c']='Repository',_0x230123[_0x1df2b2(0x7f)]=(_0x3907b6=this[_0x1df2b2(0x93)][_0x1df2b2(0x6d)](_0x1775e7=>_0x1775e7[_0x1df2b2(0x83)]==='Repository'))===null||_0x3907b6===void 0x0?void 0x0:_0x3907b6['id']),_0x230123[constants_1[_0x1df2b2(0x91)]+_0x1df2b2(0x7a)]=0x1):_0x230123[constants_1[_0x1df2b2(0x91)]+_0x1df2b2(0x7a)]=_0x19a54a[_0x1df2b2(0x84)]+0x1,_0x230123[constants_1[_0x1df2b2(0x91)]+_0x1df2b2(0x97)]=_0xa9d9d8[_0x1df2b2(0x71)],_0x230123[constants_1[_0x1df2b2(0x91)]+'Component_Name__c']=_0xa9d9d8['name'],_0x230123[constants_1['FLOSUM_NAMESPACE']+'File_Name__c']=_0xa9d9d8['filePath'],_0x230123[constants_1[_0x1df2b2(0x91)]+_0x1df2b2(0xb4)]=this[_0x1df2b2(0x6a)],_0x230123[constants_1[_0x1df2b2(0x91)]+_0x1df2b2(0xa8)]=this[_0x1df2b2(0x6a)],_0x230123[constants_1['FLOSUM_NAMESPACE']+_0x1df2b2(0x9c)]=_0x2a3c7b,_0x230123[constants_1[_0x1df2b2(0x91)]+_0x1df2b2(0xb9)]=_0x2a3c7b,_0x230123[constants_1[_0x1df2b2(0x91)]+_0x1df2b2(0x8f)]=_0xa9d9d8[_0x1df2b2(0x8e)],_0x230123;}[a229_0x21c130(0x92)](){return this['proceededComponentsMeta'];}async['insert'](_0x2e418a,_0x3cc2e6){const _0x42c8d1=a229_0x21c130,_0x5b19d9=[];for(const _0x3fbd8a of _0x2e418a){const _0x32659e=(0x0,composite_utils_1[_0x42c8d1(0x81)])(constants_1[_0x42c8d1(0xb6)],this[_0x42c8d1(0xbf)](_0x3fbd8a)),_0x362d6a=(0x0,composite_utils_1[_0x42c8d1(0x81)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x42c8d1(0xb8)](_0x3fbd8a,'@{'+_0x32659e['reference']+_0x42c8d1(0xb3))),_0x4b569f=(0x0,composite_utils_1[_0x42c8d1(0x81)])(constants_1[_0x42c8d1(0xb5)],await this['prepareComponentAttachmentRecord'](_0x3fbd8a,'@{'+_0x362d6a[_0x42c8d1(0x68)]+_0x42c8d1(0xb3)));this[_0x42c8d1(0xa0)](_0x32659e['request'][_0x42c8d1(0xae)],_0x32659e[_0x42c8d1(0x68)]),_0x5b19d9[_0x42c8d1(0x9f)](_0x32659e['request'],_0x362d6a[_0x42c8d1(0x74)],_0x4b569f[_0x42c8d1(0x74)]),_0x3cc2e6&&_0x5b19d9['push'](this[_0x42c8d1(0xbb)](_0x3cc2e6,'@{'+_0x362d6a['reference']+_0x42c8d1(0xb3)));}return _0x5b19d9;}async[a229_0x21c130(0x7d)](_0x193130,_0x29f4fa=''){const _0x471ed4=a229_0x21c130,_0x19b2a1=[];for(const {component:_0x3eaecd,meta:_0x91d2c0}of _0x193130){if(!_0x91d2c0['id']){const _0x19b9c2=this[_0x471ed4(0x95)]['find'](_0xde4bc1=>_0xde4bc1[_0x471ed4(0x6e)]===_0x3eaecd[_0x471ed4(0x83)]&&_0xde4bc1[_0x471ed4(0xbd)]===_0x3eaecd[_0x471ed4(0x71)]);if(!_0x19b9c2)throw new salesforce_error_1[(_0x471ed4(0x89))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x3eaecd[_0x471ed4(0x83)]+'\x20['+_0x3eaecd[_0x471ed4(0x71)]+']\x20-\x20meta\x20not\x20found'));_0x91d2c0['id']=_0x19b9c2['componentId'];}const _0xa628a4=(0x0,composite_utils_1[_0x471ed4(0x76)])(constants_1[_0x471ed4(0xb6)],_0x91d2c0['id'],this[_0x471ed4(0xbf)](_0x3eaecd,_0x91d2c0)),_0x22201a=(0x0,composite_utils_1[_0x471ed4(0x81)])(constants_1[_0x471ed4(0x70)],this[_0x471ed4(0xb8)](_0x3eaecd,_0x91d2c0['id'],_0x91d2c0[_0x471ed4(0x84)])),_0x4bd29a=(0x0,composite_utils_1[_0x471ed4(0x81)])(constants_1[_0x471ed4(0xb5)],await this['prepareComponentAttachmentRecord'](_0x3eaecd,'@{'+_0x22201a[_0x471ed4(0x68)]+_0x471ed4(0xb3)));this[_0x471ed4(0xa0)](_0xa628a4[_0x471ed4(0x74)][_0x471ed4(0xae)],_0xa628a4[_0x471ed4(0x68)]),_0x19b2a1[_0x471ed4(0x9f)](_0xa628a4[_0x471ed4(0x74)],_0x22201a[_0x471ed4(0x74)],_0x4bd29a[_0x471ed4(0x74)]),_0x29f4fa&&_0x19b2a1[_0x471ed4(0x9f)](this[_0x471ed4(0xbb)](_0x29f4fa,'@{'+_0x22201a[_0x471ed4(0x68)]+'.id}'));}return _0x19b2a1;}async['delete'](_0x51bc76,_0x3ce68e=![]){const _0x3937f8=a229_0x21c130,_0x197bf7={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x25da75=[];for(const _0x530b3d of _0x51bc76){if(_0x530b3d['id'])_0x25da75[_0x3937f8(0x9f)](_0x530b3d['id']);else{const _0x3fb6e2=this[_0x3937f8(0x95)][_0x3937f8(0x6d)](_0x84b3ed=>_0x84b3ed[_0x3937f8(0x6e)]===_0x530b3d['name']&&_0x84b3ed[_0x3937f8(0xbd)]===_0x530b3d[_0x3937f8(0x71)]);if(!_0x3fb6e2||!_0x3fb6e2[_0x3937f8(0x67)])continue;_0x25da75[_0x3937f8(0x9f)](_0x3fb6e2[_0x3937f8(0x67)]);}}if(_0x3ce68e){const _0x423340=await this[_0x3937f8(0x9b)][_0x3937f8(0x9d)](_0x25da75);_0x197bf7['manifests']=_0x423340['map'](_0x525c3c=>(0x0,composite_utils_1[_0x3937f8(0xc0)])(constants_1[_0x3937f8(0xa6)],_0x525c3c)[_0x3937f8(0x74)]);}return _0x197bf7[_0x3937f8(0x7e)]=_0x25da75['map'](_0x3032b9=>(0x0,composite_utils_1[_0x3937f8(0x76)])(constants_1[_0x3937f8(0xb6)],_0x3032b9,{[constants_1[_0x3937f8(0x6f)]+'Deletion_By_Agent__c']:!![]})[_0x3937f8(0x74)]),_0x197bf7['componentsToDelete']=_0x25da75[_0x3937f8(0x66)](_0x11a097=>(0x0,composite_utils_1[_0x3937f8(0xc0)])(constants_1[_0x3937f8(0xb6)],_0x11a097)['request']),_0x197bf7;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;