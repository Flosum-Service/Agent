const a272_0x47b6b3=a272_0x2a91;(function(_0x1cdaf8,_0x356db1){const _0x2e0e1e=a272_0x2a91,_0x576a18=_0x1cdaf8();while(!![]){try{const _0x4c839e=parseInt(_0x2e0e1e(0x123))/0x1+-parseInt(_0x2e0e1e(0xf1))/0x2+-parseInt(_0x2e0e1e(0x11f))/0x3+-parseInt(_0x2e0e1e(0x114))/0x4+parseInt(_0x2e0e1e(0x12f))/0x5+-parseInt(_0x2e0e1e(0x135))/0x6*(-parseInt(_0x2e0e1e(0x140))/0x7)+-parseInt(_0x2e0e1e(0x118))/0x8;if(_0x4c839e===_0x356db1)break;else _0x576a18['push'](_0x576a18['shift']());}catch(_0x2044be){_0x576a18['push'](_0x576a18['shift']());}}}(a272_0x20f5,0xced16));const a272_0x183eed=(function(){let _0x4d5aba=!![];return function(_0x366002,_0x228054){const _0xa57222=_0x4d5aba?function(){const _0x5910b4=a272_0x2a91;if(_0x228054){const _0x134b59=_0x228054[_0x5910b4(0x10b)](_0x366002,arguments);return _0x228054=null,_0x134b59;}}:function(){};return _0x4d5aba=![],_0xa57222;};}()),a272_0x24458f=a272_0x183eed(this,function(){const _0x6e7b6=a272_0x2a91;return a272_0x24458f[_0x6e7b6(0x133)]()[_0x6e7b6(0xf9)](_0x6e7b6(0xee))[_0x6e7b6(0x133)]()[_0x6e7b6(0x13f)](a272_0x24458f)[_0x6e7b6(0xf9)](_0x6e7b6(0xee));});a272_0x24458f();function a272_0x2a91(_0x4efc57,_0x18a0b1){const _0x308c6d=a272_0x20f5();return a272_0x2a91=function(_0x24458f,_0x183eed){_0x24458f=_0x24458f-0xe4;let _0x20f547=_0x308c6d[_0x24458f];return _0x20f547;},a272_0x2a91(_0x4efc57,_0x18a0b1);}function a272_0x20f5(){const _0x3c2375=['repositoryId','prepareComponentHistoryRecord','createZip','Commit__c','.id}','type','getProceededComponentsMeta','createPostRequest','push','proceededComponentsMeta','Component__c','delete','keys','(((.+)+)+)+$','prepareComponentRecord','filePath','528730rWoXdi','DEFLATE','recordTypes','Changed_On__c','componentsToDelete','SalesforceComponentsManager','Branch__c','Last_Modified_By__c','search','branchId','Branch','Component_Name__c','FLOSUM_COMMIT_MANIFEST','Is_From_Agent__c','FLOSUM_ATTACHMENT','reference','defineProperty','componentName','extractFieldsFromRecord','../../../../core','name','Logger','Zip','Last_Updated_By__c','./salesforce-git-sync.service','../utils/flosum-naming.utils','apply','Deletion_By_Agent__c','CRC32__c','FLOSUM_COMPONENT_HISTORY','marketingCloudKey','Description','Version__c','toISOString','FLOSUM_NAMESPACE','1714620ygAdFO','application/zip','FLOSUM_COMPONENT','SalesforceError','13308160gFoYvv','Repository','logger','map','ContentType','RecordTypeId','prepareComponentAttachmentRecord','325095jsPsvt','componentId','file','__importDefault','788813gqPRpE','prepareCommitManifest','SalesforceGitSyncService','Body','Source__c','Repository__c','username','componentType','gitSync','createDeleteRequest','Component_Type__c','FLOSUM_GIT_NAMESPACE','8284085eknjcs','../utils/composite.utils','base64','ParentId','toString','find','1758KEguxe','createPatchRequest','body','files','proceedComponentMeta','isVlocityComponent','default','componentsToUpdate',']\x20-\x20meta\x20not\x20found','update','constructor','20699TvOhrj','request','../../parsers/utils/zip','manifests','crc','Changed_By__c'];a272_0x20f5=function(){return _0x3c2375;};return a272_0x20f5();}'use strict';var __importDefault=this&&this[a272_0x47b6b3(0x122)]||function(_0x57259d){return _0x57259d&&_0x57259d['__esModule']?_0x57259d:{'default':_0x57259d};};Object[a272_0x47b6b3(0x101)](exports,'__esModule',{'value':!![]}),exports[a272_0x47b6b3(0xf6)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a272_0x47b6b3(0x104)),zip_1=require(a272_0x47b6b3(0x142)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a272_0x47b6b3(0x130)),flosum_naming_utils_1=require(a272_0x47b6b3(0x10a)),salesforce_git_sync_service_1=require(a272_0x47b6b3(0x109));class SalesforceComponentsManager{constructor(_0x3ebb43,_0x105ade,_0x42458c,_0x30b2ea,_0x3d7b1c){const _0xf8ddb2=a272_0x47b6b3;this[_0xf8ddb2(0x146)]=_0x3ebb43,this[_0xf8ddb2(0xfa)]=_0x105ade,this['username']=_0x42458c,this[_0xf8ddb2(0xf3)]=_0x30b2ea,this[_0xf8ddb2(0xea)]=_0x3d7b1c,this[_0xf8ddb2(0x11a)]=new core_1[(_0xf8ddb2(0x106))](SalesforceComponentsManager[_0xf8ddb2(0x105)]),this['gitSync']=typedi_1[_0xf8ddb2(0x13b)]['get'](salesforce_git_sync_service_1[_0xf8ddb2(0x125)]);}[a272_0x47b6b3(0x139)](_0x486ca9,_0x4c95a8){const _0x2dbb0b=a272_0x47b6b3,_0xa0ac5c=(0x0,flosum_naming_utils_1[_0x2dbb0b(0x103)])(_0x486ca9,['Component_Type__c',_0x2dbb0b(0xfc),_0x2dbb0b(0x111)]);this[_0x2dbb0b(0xea)][_0x2dbb0b(0xe9)]({'componentId':'','reference':_0x4c95a8,'version':_0xa0ac5c[_0x2dbb0b(0x111)],'componentName':_0xa0ac5c['Component_Name__c'],'componentType':_0xa0ac5c[_0x2dbb0b(0x12d)]});}[a272_0x47b6b3(0x124)](_0x58eb6b,_0xf2f49){const _0x2b142f=a272_0x47b6b3,{request:_0x3d2034}=(0x0,composite_utils_1[_0x2b142f(0xe8)])(constants_1[_0x2b142f(0xfd)],{[constants_1[_0x2b142f(0x113)]+_0x2b142f(0xe4)]:_0x58eb6b,[constants_1[_0x2b142f(0x113)]+'Component_History__c']:_0xf2f49});return _0x3d2034;}async[a272_0x47b6b3(0x11e)](_0x41061b,_0x4d8814){const _0x656a75=a272_0x47b6b3,_0x5c58f3={},_0x1d1912=zip_1[_0x656a75(0x107)][_0x656a75(0x148)]();for(const _0x3e08ef of Object[_0x656a75(0xed)](_0x41061b[_0x656a75(0x138)])){_0x1d1912[_0x656a75(0x121)](_0x3e08ef,_0x41061b[_0x656a75(0x138)][_0x3e08ef],{'createFolders':!![]});}return _0x5c58f3[_0x656a75(0x11c)]=_0x656a75(0x115),_0x5c58f3['Name']=_0x41061b[_0x656a75(0xe6)],_0x5c58f3[_0x656a75(0x110)]=_0x41061b[_0x656a75(0xe6)],_0x5c58f3[_0x656a75(0x132)]=_0x4d8814,_0x5c58f3[_0x656a75(0x126)]=await _0x1d1912['generateAsync']({'type':_0x656a75(0x131),'compression':_0x656a75(0xf2),'compressionOptions':{'level':0x6}}),_0x5c58f3;}[a272_0x47b6b3(0x147)](_0x5d5959,_0xbd4e18,_0x163411){const _0x19425c=a272_0x47b6b3,_0x44a1e7=new Date()[_0x19425c(0x112)](),_0x3e5fef={};return _0x3e5fef[constants_1[_0x19425c(0x113)]+_0x19425c(0xeb)]=_0xbd4e18,_0x3e5fef[constants_1[_0x19425c(0x113)]+_0x19425c(0x10d)]=_0x5d5959['crc'],_0x3e5fef[constants_1['FLOSUM_NAMESPACE']+_0x19425c(0xf4)]=_0x44a1e7,_0x3e5fef[constants_1[_0x19425c(0x113)]+_0x19425c(0x145)]=this[_0x19425c(0x129)],_0x3e5fef[constants_1['FLOSUM_NAMESPACE']+'Version__c']=_0x163411?_0x163411+0x1:0x1,_0x3e5fef[constants_1[_0x19425c(0x12e)]+_0x19425c(0xfe)]=!![],_0x3e5fef;}[a272_0x47b6b3(0xef)](_0x2ff246,_0x51fd35){const _0x2b000e=a272_0x47b6b3;var _0x555485,_0x1a24fb;const _0xd2adef=new Date()[_0x2b000e(0x112)](),_0x49d02d={};return!_0x51fd35?(this[_0x2b000e(0xfa)]?(_0x49d02d[constants_1[_0x2b000e(0x113)]+_0x2b000e(0xf7)]=this['branchId'],_0x49d02d[constants_1['FLOSUM_NAMESPACE']+_0x2b000e(0x127)]=_0x2b000e(0xfb),_0x49d02d[_0x2b000e(0x11d)]=(_0x555485=this['recordTypes']['find'](_0x3b0496=>_0x3b0496[_0x2b000e(0x105)]===_0x2b000e(0xfb)))===null||_0x555485===void 0x0?void 0x0:_0x555485['id']):(_0x49d02d[constants_1[_0x2b000e(0x113)]+_0x2b000e(0x128)]=this['repositoryId'],_0x49d02d[constants_1[_0x2b000e(0x113)]+_0x2b000e(0x127)]=_0x2b000e(0x119),_0x49d02d[_0x2b000e(0x11d)]=(_0x1a24fb=this[_0x2b000e(0xf3)]['find'](_0x1f177e=>_0x1f177e['name']===_0x2b000e(0x119)))===null||_0x1a24fb===void 0x0?void 0x0:_0x1a24fb['id']),_0x49d02d[constants_1[_0x2b000e(0x113)]+_0x2b000e(0x111)]=0x1):_0x49d02d[constants_1[_0x2b000e(0x113)]+'Version__c']=_0x51fd35['version']+0x1,_0x49d02d[constants_1['FLOSUM_NAMESPACE']+'Component_Type__c']=_0x2ff246[_0x2b000e(0xe6)],_0x49d02d[constants_1['FLOSUM_NAMESPACE']+_0x2b000e(0xfc)]=_0x2ff246[_0x2b000e(0x105)],_0x49d02d[constants_1[_0x2b000e(0x113)]+'File_Name__c']=_0x2ff246[_0x2b000e(0xf0)],_0x49d02d[constants_1[_0x2b000e(0x113)]+_0x2b000e(0x108)]=this['username'],_0x49d02d[constants_1['FLOSUM_NAMESPACE']+_0x2b000e(0xf8)]=this[_0x2b000e(0x129)],_0x49d02d[constants_1['FLOSUM_NAMESPACE']+'Last_Modified_Date__c']=_0xd2adef,_0x49d02d[constants_1[_0x2b000e(0x113)]+'Committed_On__c']=_0xd2adef,_0x49d02d[constants_1[_0x2b000e(0x113)]+'CRC32__c']=_0x2ff246[_0x2b000e(0x144)],_0x49d02d[constants_1['FLOSUM_NAMESPACE']+'Vlocity_Component_Name__c']=_0x2ff246['vlocityComponentName'],_0x49d02d[constants_1[_0x2b000e(0x113)]+'Vlocity_Component__c']=_0x2ff246[_0x2b000e(0x13a)],_0x49d02d[constants_1[_0x2b000e(0x113)]+'MC_Key__c']=_0x2ff246[_0x2b000e(0x10f)],_0x49d02d;}[a272_0x47b6b3(0xe7)](){const _0x2a6750=a272_0x47b6b3;return this[_0x2a6750(0xea)];}async['insert'](_0x15b260,_0x4d530a){const _0xd8d02b=a272_0x47b6b3,_0x335756=[];for(const _0x5a7ea8 of _0x15b260){const _0x240161=(0x0,composite_utils_1[_0xd8d02b(0xe8)])(constants_1[_0xd8d02b(0x116)],this[_0xd8d02b(0xef)](_0x5a7ea8)),_0x3795fa=(0x0,composite_utils_1[_0xd8d02b(0xe8)])(constants_1[_0xd8d02b(0x10e)],this[_0xd8d02b(0x147)](_0x5a7ea8,'@{'+_0x240161[_0xd8d02b(0x100)]+_0xd8d02b(0xe5))),_0x21c2d2=(0x0,composite_utils_1[_0xd8d02b(0xe8)])(constants_1[_0xd8d02b(0xff)],await this[_0xd8d02b(0x11e)](_0x5a7ea8,'@{'+_0x3795fa[_0xd8d02b(0x100)]+'.id}'));this['proceedComponentMeta'](_0x240161['request'][_0xd8d02b(0x137)],_0x240161['reference']),_0x335756['push'](_0x240161[_0xd8d02b(0x141)],_0x3795fa[_0xd8d02b(0x141)],_0x21c2d2[_0xd8d02b(0x141)]),_0x4d530a&&_0x335756['push'](this['prepareCommitManifest'](_0x4d530a,'@{'+_0x3795fa[_0xd8d02b(0x100)]+_0xd8d02b(0xe5)));}return _0x335756;}async[a272_0x47b6b3(0x13e)](_0x53bdba,_0x11cda5=''){const _0x1a3367=a272_0x47b6b3,_0x162674=[];for(const {component:_0x361824,meta:_0x4b05e6}of _0x53bdba){if(!_0x4b05e6['id']){const _0x577052=this[_0x1a3367(0xea)][_0x1a3367(0x134)](_0x3adada=>_0x3adada[_0x1a3367(0x102)]===_0x361824['name']&&_0x3adada[_0x1a3367(0x12a)]===_0x361824[_0x1a3367(0xe6)]);if(!_0x577052)throw new salesforce_error_1[(_0x1a3367(0x117))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x361824[_0x1a3367(0x105)]+'\x20['+_0x361824[_0x1a3367(0xe6)]+_0x1a3367(0x13d)));_0x4b05e6['id']=_0x577052[_0x1a3367(0x120)];}const _0x29a3b8=(0x0,composite_utils_1[_0x1a3367(0x136)])(constants_1['FLOSUM_COMPONENT'],_0x4b05e6['id'],this[_0x1a3367(0xef)](_0x361824,_0x4b05e6)),_0x545622=(0x0,composite_utils_1[_0x1a3367(0xe8)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this['prepareComponentHistoryRecord'](_0x361824,_0x4b05e6['id'],_0x4b05e6['version'])),_0x414d6b=(0x0,composite_utils_1[_0x1a3367(0xe8)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x1a3367(0x11e)](_0x361824,'@{'+_0x545622['reference']+_0x1a3367(0xe5)));this[_0x1a3367(0x139)](_0x29a3b8[_0x1a3367(0x141)]['body'],_0x29a3b8[_0x1a3367(0x100)]),_0x162674[_0x1a3367(0xe9)](_0x29a3b8[_0x1a3367(0x141)],_0x545622[_0x1a3367(0x141)],_0x414d6b['request']),_0x11cda5&&_0x162674[_0x1a3367(0xe9)](this[_0x1a3367(0x124)](_0x11cda5,'@{'+_0x545622['reference']+'.id}'));}return _0x162674;}async[a272_0x47b6b3(0xec)](_0xcaea6d,_0x4bbcc5=![]){const _0x349d54=a272_0x47b6b3,_0x364b6d={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x4207dc=[];for(const _0x4d8fa3 of _0xcaea6d){if(_0x4d8fa3['id'])_0x4207dc[_0x349d54(0xe9)](_0x4d8fa3['id']);else{const _0xc874ff=this[_0x349d54(0xea)][_0x349d54(0x134)](_0x276587=>_0x276587['componentName']===_0x4d8fa3[_0x349d54(0x105)]&&_0x276587[_0x349d54(0x12a)]===_0x4d8fa3[_0x349d54(0xe6)]);if(!_0xc874ff||!_0xc874ff[_0x349d54(0x120)])continue;_0x4207dc[_0x349d54(0xe9)](_0xc874ff[_0x349d54(0x120)]);}}if(_0x4bbcc5){const _0x41cd7b=await this[_0x349d54(0x12b)]['fetchCommitManifestsByComponentIds'](_0x4207dc);_0x364b6d[_0x349d54(0x143)]=_0x41cd7b['map'](_0x56b75e=>(0x0,composite_utils_1[_0x349d54(0x12c)])(constants_1[_0x349d54(0xfd)],_0x56b75e)[_0x349d54(0x141)]);}return _0x364b6d[_0x349d54(0x13c)]=_0x4207dc[_0x349d54(0x11b)](_0x21f0ee=>(0x0,composite_utils_1[_0x349d54(0x136)])(constants_1['FLOSUM_COMPONENT'],_0x21f0ee,{[constants_1[_0x349d54(0x12e)]+_0x349d54(0x10c)]:!![]})[_0x349d54(0x141)]),_0x364b6d[_0x349d54(0xf5)]=_0x4207dc[_0x349d54(0x11b)](_0x5d85d3=>(0x0,composite_utils_1[_0x349d54(0x12c)])(constants_1['FLOSUM_COMPONENT'],_0x5d85d3)['request']),_0x364b6d;}}exports[a272_0x47b6b3(0xf6)]=SalesforceComponentsManager;