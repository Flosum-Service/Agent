const a245_0x33396a=a245_0x2fa9;(function(_0x40c920,_0x410127){const _0x50fe3e=a245_0x2fa9,_0x4aa491=_0x40c920();while(!![]){try{const _0x24d0e0=parseInt(_0x50fe3e(0x1fc))/0x1+-parseInt(_0x50fe3e(0x1ff))/0x2+parseInt(_0x50fe3e(0x1b1))/0x3+parseInt(_0x50fe3e(0x1d3))/0x4+-parseInt(_0x50fe3e(0x1e4))/0x5*(-parseInt(_0x50fe3e(0x1a4))/0x6)+parseInt(_0x50fe3e(0x1fa))/0x7*(-parseInt(_0x50fe3e(0x200))/0x8)+-parseInt(_0x50fe3e(0x1bc))/0x9;if(_0x24d0e0===_0x410127)break;else _0x4aa491['push'](_0x4aa491['shift']());}catch(_0x51d23c){_0x4aa491['push'](_0x4aa491['shift']());}}}(a245_0x4933,0x54e7d));const a245_0x15186d=(function(){let _0x3f4f27=!![];return function(_0x12737f,_0x3e2af0){const _0x657743=_0x3f4f27?function(){const _0x1bc91c=a245_0x2fa9;if(_0x3e2af0){const _0x2d22d2=_0x3e2af0[_0x1bc91c(0x1aa)](_0x12737f,arguments);return _0x3e2af0=null,_0x2d22d2;}}:function(){};return _0x3f4f27=![],_0x657743;};}()),a245_0x38d01c=a245_0x15186d(this,function(){const _0x87ab6f=a245_0x2fa9;return a245_0x38d01c[_0x87ab6f(0x1c5)]()['search'](_0x87ab6f(0x1e5))[_0x87ab6f(0x1c5)]()[_0x87ab6f(0x1a3)](a245_0x38d01c)['search'](_0x87ab6f(0x1e5));});a245_0x38d01c();function a245_0x4933(){const _0xee83d9=['repositoryId','gitSync','Component_History__c','manifests','map','apply','insert','crc','delete','Deletion_By_Agent__c','application/zip','find','2010558GFyZAy','RecordTypeId','../utils/composite.utils','isVlocityComponent','Vlocity_Component__c','prepareComponentRecord','fetchCommitManifestsByComponentIds','Changed_By__c','Branch__c','Committed_On__c','prepareCommitManifest','4411170RhOfBD','base64','__importDefault','./salesforce-git-sync.service','filePath','body','Last_Modified_Date__c','request','Last_Modified_By__c','toString','createPostRequest','FLOSUM_ATTACHMENT','Zip','username','Component_Type__c','reference','Commit__c','FLOSUM_COMPONENT','keys','componentName','name','defineProperty','logger','219164TBWSuk','Last_Updated_By__c','MC_Key__c','generateAsync','typedi','extractFieldsFromRecord','push','prepareComponentHistoryRecord','branchId','componentId','Source__c','.id}','SalesforceComponentsManager','componentsToUpdate','default','recordTypes','Name','5iHfPlq','(((.+)+)+)+$','version','prepareComponentAttachmentRecord','Body','get','../errors/salesforce.error','../../parsers/utils/zip','Repository__c','__esModule','Repository','Changed_On__c','FLOSUM_COMMIT_MANIFEST','../utils/flosum-naming.utils','Version__c','../../../../core','CRC32__c','FLOSUM_NAMESPACE','toISOString','files','FLOSUM_COMPONENT_HISTORY','Component_Name__c','200879DCdsUH','proceedComponentMeta','484063JNlAuM','componentType','ContentType','840938Fsuftb','136PvjYYA','Could\x20not\x20proceed\x20component\x20','type','DEFLATE','FLOSUM_GIT_NAMESPACE','proceededComponentsMeta','Branch','constructor','3223086sxkRLF'];a245_0x4933=function(){return _0xee83d9;};return a245_0x4933();}function a245_0x2fa9(_0x4c1438,_0x9519a2){const _0x34ee54=a245_0x4933();return a245_0x2fa9=function(_0x38d01c,_0x15186d){_0x38d01c=_0x38d01c-0x19f;let _0x493390=_0x34ee54[_0x38d01c];return _0x493390;},a245_0x2fa9(_0x4c1438,_0x9519a2);}'use strict';var __importDefault=this&&this[a245_0x33396a(0x1be)]||function(_0x54fbf4){const _0x5bbd7a=a245_0x33396a;return _0x54fbf4&&_0x54fbf4[_0x5bbd7a(0x1ed)]?_0x54fbf4:{'default':_0x54fbf4};};Object[a245_0x33396a(0x1d1)](exports,'__esModule',{'value':!![]}),exports[a245_0x33396a(0x1df)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a245_0x33396a(0x1f3)),zip_1=require(a245_0x33396a(0x1eb)),typedi_1=__importDefault(require(a245_0x33396a(0x1d7))),salesforce_error_1=require(a245_0x33396a(0x1ea)),composite_utils_1=require(a245_0x33396a(0x1b3)),flosum_naming_utils_1=require(a245_0x33396a(0x1f1)),salesforce_git_sync_service_1=require(a245_0x33396a(0x1bf));class SalesforceComponentsManager{constructor(_0x1a0349,_0x9b7425,_0x494233,_0x3c9464,_0x139f23){const _0xdf70bd=a245_0x33396a;this[_0xdf70bd(0x1a5)]=_0x1a0349,this[_0xdf70bd(0x1db)]=_0x9b7425,this['username']=_0x494233,this[_0xdf70bd(0x1e2)]=_0x3c9464,this['proceededComponentsMeta']=_0x139f23,this[_0xdf70bd(0x1d2)]=new core_1['Logger'](SalesforceComponentsManager['name']),this[_0xdf70bd(0x1a6)]=typedi_1[_0xdf70bd(0x1e1)][_0xdf70bd(0x1e9)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a245_0x33396a(0x1fb)](_0x773a90,_0x30ba8f){const _0x696a9=a245_0x33396a,_0x41481b=(0x0,flosum_naming_utils_1[_0x696a9(0x1d8)])(_0x773a90,[_0x696a9(0x1ca),'Component_Name__c',_0x696a9(0x1f2)]);this[_0x696a9(0x1a1)][_0x696a9(0x1d9)]({'componentId':'','reference':_0x30ba8f,'version':_0x41481b[_0x696a9(0x1f2)],'componentName':_0x41481b['Component_Name__c'],'componentType':_0x41481b[_0x696a9(0x1ca)]});}[a245_0x33396a(0x1bb)](_0x1c5d61,_0x58637d){const _0x32a81c=a245_0x33396a,{request:_0xbf0965}=(0x0,composite_utils_1[_0x32a81c(0x1c6)])(constants_1[_0x32a81c(0x1f0)],{[constants_1[_0x32a81c(0x1f5)]+_0x32a81c(0x1cc)]:_0x1c5d61,[constants_1[_0x32a81c(0x1f5)]+_0x32a81c(0x1a7)]:_0x58637d});return _0xbf0965;}async[a245_0x33396a(0x1e7)](_0x1ed0dc,_0x50eb9a){const _0x5a48f8=a245_0x33396a,_0x2c5206={},_0x1c8534=zip_1[_0x5a48f8(0x1c8)]['createZip']();for(const _0x528e4b of Object[_0x5a48f8(0x1ce)](_0x1ed0dc[_0x5a48f8(0x1f7)])){_0x1c8534['file'](_0x528e4b,_0x1ed0dc['files'][_0x528e4b],{'createFolders':!![]});}return _0x2c5206[_0x5a48f8(0x1fe)]=_0x5a48f8(0x1af),_0x2c5206[_0x5a48f8(0x1e3)]=_0x1ed0dc['type'],_0x2c5206['Description']=_0x1ed0dc[_0x5a48f8(0x202)],_0x2c5206['ParentId']=_0x50eb9a,_0x2c5206[_0x5a48f8(0x1e8)]=await _0x1c8534[_0x5a48f8(0x1d6)]({'type':_0x5a48f8(0x1bd),'compression':_0x5a48f8(0x19f),'compressionOptions':{'level':0x6}}),_0x2c5206;}['prepareComponentHistoryRecord'](_0x3f50af,_0x2bd402,_0xe4f6e1){const _0x371d78=a245_0x33396a,_0x19fa9c=new Date()[_0x371d78(0x1f6)](),_0x4678d0={};return _0x4678d0[constants_1[_0x371d78(0x1f5)]+'Component__c']=_0x2bd402,_0x4678d0[constants_1[_0x371d78(0x1f5)]+'CRC32__c']=_0x3f50af[_0x371d78(0x1ac)],_0x4678d0[constants_1[_0x371d78(0x1f5)]+_0x371d78(0x1ef)]=_0x19fa9c,_0x4678d0[constants_1['FLOSUM_NAMESPACE']+_0x371d78(0x1b8)]=this[_0x371d78(0x1c9)],_0x4678d0[constants_1[_0x371d78(0x1f5)]+_0x371d78(0x1f2)]=_0xe4f6e1?_0xe4f6e1+0x1:0x1,_0x4678d0[constants_1['FLOSUM_GIT_NAMESPACE']+'Is_From_Agent__c']=!![],_0x4678d0;}[a245_0x33396a(0x1b6)](_0x39dcad,_0x4939cf){const _0x7db5e2=a245_0x33396a;var _0x2b5b9f,_0x28f26c;const _0x4def9a=new Date()[_0x7db5e2(0x1f6)](),_0x5ca189={};return!_0x4939cf?(this[_0x7db5e2(0x1db)]?(_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+_0x7db5e2(0x1b9)]=this[_0x7db5e2(0x1db)],_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+_0x7db5e2(0x1dd)]=_0x7db5e2(0x1a2),_0x5ca189[_0x7db5e2(0x1b2)]=(_0x2b5b9f=this[_0x7db5e2(0x1e2)][_0x7db5e2(0x1b0)](_0x5b6e03=>_0x5b6e03[_0x7db5e2(0x1d0)]===_0x7db5e2(0x1a2)))===null||_0x2b5b9f===void 0x0?void 0x0:_0x2b5b9f['id']):(_0x5ca189[constants_1['FLOSUM_NAMESPACE']+_0x7db5e2(0x1ec)]=this[_0x7db5e2(0x1a5)],_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+_0x7db5e2(0x1dd)]=_0x7db5e2(0x1ee),_0x5ca189[_0x7db5e2(0x1b2)]=(_0x28f26c=this[_0x7db5e2(0x1e2)]['find'](_0x3408a3=>_0x3408a3['name']===_0x7db5e2(0x1ee)))===null||_0x28f26c===void 0x0?void 0x0:_0x28f26c['id']),_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+_0x7db5e2(0x1f2)]=0x1):_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+'Version__c']=_0x4939cf[_0x7db5e2(0x1e6)]+0x1,_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+_0x7db5e2(0x1ca)]=_0x39dcad['type'],_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+_0x7db5e2(0x1f9)]=_0x39dcad[_0x7db5e2(0x1d0)],_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+'File_Name__c']=_0x39dcad[_0x7db5e2(0x1c0)],_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+_0x7db5e2(0x1d4)]=this[_0x7db5e2(0x1c9)],_0x5ca189[constants_1['FLOSUM_NAMESPACE']+_0x7db5e2(0x1c4)]=this[_0x7db5e2(0x1c9)],_0x5ca189[constants_1['FLOSUM_NAMESPACE']+_0x7db5e2(0x1c2)]=_0x4def9a,_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+_0x7db5e2(0x1ba)]=_0x4def9a,_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+_0x7db5e2(0x1f4)]=_0x39dcad[_0x7db5e2(0x1ac)],_0x5ca189[constants_1['FLOSUM_NAMESPACE']+'Vlocity_Component_Name__c']=_0x39dcad['vlocityComponentName'],_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+_0x7db5e2(0x1b5)]=_0x39dcad[_0x7db5e2(0x1b4)],_0x5ca189[constants_1[_0x7db5e2(0x1f5)]+_0x7db5e2(0x1d5)]=_0x39dcad['marketingCloudKey'],_0x5ca189;}['getProceededComponentsMeta'](){return this['proceededComponentsMeta'];}async[a245_0x33396a(0x1ab)](_0x4cc107,_0x8ce40){const _0x809ea8=a245_0x33396a,_0x22333c=[];for(const _0x4ae7d5 of _0x4cc107){const _0x16feaa=(0x0,composite_utils_1[_0x809ea8(0x1c6)])(constants_1[_0x809ea8(0x1cd)],this['prepareComponentRecord'](_0x4ae7d5)),_0x36c53c=(0x0,composite_utils_1[_0x809ea8(0x1c6)])(constants_1[_0x809ea8(0x1f8)],this['prepareComponentHistoryRecord'](_0x4ae7d5,'@{'+_0x16feaa[_0x809ea8(0x1cb)]+_0x809ea8(0x1de))),_0x5e5a75=(0x0,composite_utils_1[_0x809ea8(0x1c6)])(constants_1[_0x809ea8(0x1c7)],await this[_0x809ea8(0x1e7)](_0x4ae7d5,'@{'+_0x36c53c[_0x809ea8(0x1cb)]+_0x809ea8(0x1de)));this[_0x809ea8(0x1fb)](_0x16feaa[_0x809ea8(0x1c3)][_0x809ea8(0x1c1)],_0x16feaa[_0x809ea8(0x1cb)]),_0x22333c[_0x809ea8(0x1d9)](_0x16feaa['request'],_0x36c53c[_0x809ea8(0x1c3)],_0x5e5a75[_0x809ea8(0x1c3)]),_0x8ce40&&_0x22333c[_0x809ea8(0x1d9)](this[_0x809ea8(0x1bb)](_0x8ce40,'@{'+_0x36c53c[_0x809ea8(0x1cb)]+_0x809ea8(0x1de)));}return _0x22333c;}async['update'](_0x131eff,_0x2f74c7=''){const _0xc393e0=a245_0x33396a,_0x3ab127=[];for(const {component:_0x4a5aba,meta:_0x3eeb83}of _0x131eff){if(!_0x3eeb83['id']){const _0x314f4a=this[_0xc393e0(0x1a1)][_0xc393e0(0x1b0)](_0x33eada=>_0x33eada[_0xc393e0(0x1cf)]===_0x4a5aba[_0xc393e0(0x1d0)]&&_0x33eada[_0xc393e0(0x1fd)]===_0x4a5aba['type']);if(!_0x314f4a)throw new salesforce_error_1['SalesforceError'](new Error(_0xc393e0(0x201)+_0x4a5aba[_0xc393e0(0x1d0)]+'\x20['+_0x4a5aba[_0xc393e0(0x202)]+']\x20-\x20meta\x20not\x20found'));_0x3eeb83['id']=_0x314f4a['componentId'];}const _0x3832bd=(0x0,composite_utils_1['createPatchRequest'])(constants_1['FLOSUM_COMPONENT'],_0x3eeb83['id'],this[_0xc393e0(0x1b6)](_0x4a5aba,_0x3eeb83)),_0xe0ef4f=(0x0,composite_utils_1[_0xc393e0(0x1c6)])(constants_1[_0xc393e0(0x1f8)],this[_0xc393e0(0x1da)](_0x4a5aba,_0x3eeb83['id'],_0x3eeb83[_0xc393e0(0x1e6)])),_0x4f8a76=(0x0,composite_utils_1[_0xc393e0(0x1c6)])(constants_1[_0xc393e0(0x1c7)],await this[_0xc393e0(0x1e7)](_0x4a5aba,'@{'+_0xe0ef4f['reference']+'.id}'));this[_0xc393e0(0x1fb)](_0x3832bd[_0xc393e0(0x1c3)][_0xc393e0(0x1c1)],_0x3832bd[_0xc393e0(0x1cb)]),_0x3ab127[_0xc393e0(0x1d9)](_0x3832bd[_0xc393e0(0x1c3)],_0xe0ef4f[_0xc393e0(0x1c3)],_0x4f8a76[_0xc393e0(0x1c3)]),_0x2f74c7&&_0x3ab127[_0xc393e0(0x1d9)](this['prepareCommitManifest'](_0x2f74c7,'@{'+_0xe0ef4f[_0xc393e0(0x1cb)]+'.id}'));}return _0x3ab127;}async[a245_0x33396a(0x1ad)](_0x4c7ff9,_0x288388=![]){const _0x2f3f32=a245_0x33396a,_0x1ad775={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x4de827=[];for(const _0x2216ed of _0x4c7ff9){if(_0x2216ed['id'])_0x4de827[_0x2f3f32(0x1d9)](_0x2216ed['id']);else{const _0x172904=this['proceededComponentsMeta'][_0x2f3f32(0x1b0)](_0x278524=>_0x278524[_0x2f3f32(0x1cf)]===_0x2216ed[_0x2f3f32(0x1d0)]&&_0x278524['componentType']===_0x2216ed[_0x2f3f32(0x202)]);if(!_0x172904||!_0x172904[_0x2f3f32(0x1dc)])continue;_0x4de827['push'](_0x172904[_0x2f3f32(0x1dc)]);}}if(_0x288388){const _0x4a0724=await this[_0x2f3f32(0x1a6)][_0x2f3f32(0x1b7)](_0x4de827);_0x1ad775[_0x2f3f32(0x1a8)]=_0x4a0724[_0x2f3f32(0x1a9)](_0x51899c=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x2f3f32(0x1f0)],_0x51899c)[_0x2f3f32(0x1c3)]);}return _0x1ad775[_0x2f3f32(0x1e0)]=_0x4de827[_0x2f3f32(0x1a9)](_0x3acb9e=>(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x2f3f32(0x1cd)],_0x3acb9e,{[constants_1[_0x2f3f32(0x1a0)]+_0x2f3f32(0x1ae)]:!![]})['request']),_0x1ad775['componentsToDelete']=_0x4de827[_0x2f3f32(0x1a9)](_0x5e5347=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x2f3f32(0x1cd)],_0x5e5347)[_0x2f3f32(0x1c3)]),_0x1ad775;}}exports[a245_0x33396a(0x1df)]=SalesforceComponentsManager;