const a195_0x363cd7=a195_0x1023;function a195_0x5e21(){const _0x61bb42=['Last_Modified_By__c',']\x20-\x20meta\x20not\x20found','fetchCommitManifestsByComponentIds','keys','proceededComponentsMeta','File_Name__c','type','668bEUBol','../utils/flosum-naming.utils','FLOSUM_ATTACHMENT','componentId','update','createPostRequest','../utils/composite.utils','proceedComponentMeta','FLOSUM_COMPONENT','FLOSUM_COMPONENT_HISTORY','Changed_By__c','search','delete','getProceededComponentsMeta','Version__c','componentsToUpdate','FLOSUM_COMMIT_MANIFEST','20116JjohFI','name','prepareCommitManifest','createDeleteRequest','SalesforceComponentsManager','FLOSUM_NAMESPACE','typedi','7034300KQPAJP','Deletion_By_Agent__c','Component_Name__c','Component_Type__c','Branch','componentName','reference','__importDefault','branchId','logger','Changed_On__c','Repository','default','FLOSUM_GIT_NAMESPACE','../errors/salesforce.error','version','(((.+)+)+)+$','Logger','2128737xMLPlO','files','SalesforceError','createPatchRequest','467016eEURff','find','CRC32__c','.id}','file','6bwwGPh','9yyfBRR','prepareComponentHistoryRecord','DEFLATE','prepareComponentAttachmentRecord','Commit__c','8090KDOanb','__esModule','Repository__c','../../../../constants','componentType','request','username','Last_Modified_Date__c','1122944pNqQLk','application/zip','map','generateAsync','createZip','apply','ParentId','defineProperty','Description','RecordTypeId','prepareComponentRecord','push','Is_From_Agent__c','crc','Component_History__c','toString','recordTypes','20ohRwUK','constructor','body','extractFieldsFromRecord','3751336geqHqX','gitSync','toISOString','insert','Last_Updated_By__c','Body','manifests'];a195_0x5e21=function(){return _0x61bb42;};return a195_0x5e21();}(function(_0x181874,_0x4bfa9a){const _0x2733e6=a195_0x1023,_0x57ecc6=_0x181874();while(!![]){try{const _0x444def=-parseInt(_0x2733e6(0x95))/0x1+-parseInt(_0x2733e6(0xc5))/0x2+-parseInt(_0x2733e6(0xae))/0x3+-parseInt(_0x2733e6(0xe8))/0x4*(-parseInt(_0x2733e6(0xbd))/0x5)+parseInt(_0x2733e6(0xb7))/0x6*(parseInt(_0x2733e6(0x9c))/0x7)+parseInt(_0x2733e6(0xda))/0x8*(parseInt(_0x2733e6(0xb8))/0x9)+parseInt(_0x2733e6(0xd6))/0xa*(parseInt(_0x2733e6(0xb2))/0xb);if(_0x444def===_0x4bfa9a)break;else _0x57ecc6['push'](_0x57ecc6['shift']());}catch(_0x24b82d){_0x57ecc6['push'](_0x57ecc6['shift']());}}}(a195_0x5e21,0x834a8));const a195_0x58924d=(function(){let _0x439148=!![];return function(_0xc732a0,_0xbe21e5){const _0x80e3d1=_0x439148?function(){const _0x21089d=a195_0x1023;if(_0xbe21e5){const _0x9db95f=_0xbe21e5[_0x21089d(0xca)](_0xc732a0,arguments);return _0xbe21e5=null,_0x9db95f;}}:function(){};return _0x439148=![],_0x80e3d1;};}()),a195_0x4cb889=a195_0x58924d(this,function(){const _0x316d70=a195_0x1023;return a195_0x4cb889[_0x316d70(0xd4)]()[_0x316d70(0xf3)](_0x316d70(0xac))[_0x316d70(0xd4)]()[_0x316d70(0xd7)](a195_0x4cb889)[_0x316d70(0xf3)]('(((.+)+)+)+$');});a195_0x4cb889();'use strict';function a195_0x1023(_0x2f999c,_0x427b15){const _0x1b116c=a195_0x5e21();return a195_0x1023=function(_0x4cb889,_0x58924d){_0x4cb889=_0x4cb889-0x94;let _0x5e217f=_0x1b116c[_0x4cb889];return _0x5e217f;},a195_0x1023(_0x2f999c,_0x427b15);}var __importDefault=this&&this[a195_0x363cd7(0xa3)]||function(_0x5ed10b){const _0x2a65e3=a195_0x363cd7;return _0x5ed10b&&_0x5ed10b[_0x2a65e3(0xbe)]?_0x5ed10b:{'default':_0x5ed10b};};Object[a195_0x363cd7(0xcc)](exports,a195_0x363cd7(0xbe),{'value':!![]}),exports[a195_0x363cd7(0x99)]=void 0x0;const constants_1=require(a195_0x363cd7(0xc0)),core_1=require('../../../../core'),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a195_0x363cd7(0x9b))),salesforce_error_1=require(a195_0x363cd7(0xaa)),composite_utils_1=require(a195_0x363cd7(0xee)),flosum_naming_utils_1=require(a195_0x363cd7(0xe9)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x26ddff,_0x106c1c,_0x3ad7ae,_0x5f1f63,_0x35956a){const _0x2a06f8=a195_0x363cd7;this['repositoryId']=_0x26ddff,this['branchId']=_0x106c1c,this[_0x2a06f8(0xc3)]=_0x3ad7ae,this['recordTypes']=_0x5f1f63,this[_0x2a06f8(0xe5)]=_0x35956a,this[_0x2a06f8(0xa5)]=new core_1[(_0x2a06f8(0xad))](SalesforceComponentsManager[_0x2a06f8(0x96)]),this[_0x2a06f8(0xdb)]=typedi_1[_0x2a06f8(0xa8)]['get'](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a195_0x363cd7(0xef)](_0x491447,_0x41e2aa){const _0x58801=a195_0x363cd7,_0x2d6861=(0x0,flosum_naming_utils_1[_0x58801(0xd9)])(_0x491447,[_0x58801(0x9f),'Component_Name__c','Version__c']);this[_0x58801(0xe5)][_0x58801(0xd0)]({'componentId':'','reference':_0x41e2aa,'version':_0x2d6861[_0x58801(0xf6)],'componentName':_0x2d6861[_0x58801(0x9e)],'componentType':_0x2d6861[_0x58801(0x9f)]});}[a195_0x363cd7(0x97)](_0x27c4a2,_0x3612b5){const _0x419934=a195_0x363cd7,{request:_0x19adaa}=(0x0,composite_utils_1[_0x419934(0xed)])(constants_1[_0x419934(0x94)],{[constants_1['FLOSUM_NAMESPACE']+_0x419934(0xbc)]:_0x27c4a2,[constants_1['FLOSUM_NAMESPACE']+_0x419934(0xd3)]:_0x3612b5});return _0x19adaa;}async[a195_0x363cd7(0xbb)](_0x28ec6c,_0x1a6db2){const _0x476207=a195_0x363cd7,_0x46a88c={},_0x327cd6=zip_1['Zip'][_0x476207(0xc9)]();for(const _0x404906 of Object[_0x476207(0xe4)](_0x28ec6c['files'])){_0x327cd6[_0x476207(0xb6)](_0x404906,_0x28ec6c[_0x476207(0xaf)][_0x404906],{'createFolders':!![]});}return _0x46a88c['ContentType']=_0x476207(0xc6),_0x46a88c['Name']=_0x28ec6c[_0x476207(0xe7)],_0x46a88c[_0x476207(0xcd)]=_0x28ec6c['type'],_0x46a88c[_0x476207(0xcb)]=_0x1a6db2,_0x46a88c[_0x476207(0xdf)]=await _0x327cd6[_0x476207(0xc8)]({'type':'base64','compression':_0x476207(0xba),'compressionOptions':{'level':0x6}}),_0x46a88c;}['prepareComponentHistoryRecord'](_0x82cca3,_0x5ba68d,_0x1e8434){const _0x398431=a195_0x363cd7,_0x55a226=new Date()[_0x398431(0xdc)](),_0x5d7d89={};return _0x5d7d89[constants_1[_0x398431(0x9a)]+'Component__c']=_0x5ba68d,_0x5d7d89[constants_1[_0x398431(0x9a)]+_0x398431(0xb4)]=_0x82cca3[_0x398431(0xd2)],_0x5d7d89[constants_1['FLOSUM_NAMESPACE']+_0x398431(0xa6)]=_0x55a226,_0x5d7d89[constants_1[_0x398431(0x9a)]+_0x398431(0xf2)]=this[_0x398431(0xc3)],_0x5d7d89[constants_1[_0x398431(0x9a)]+_0x398431(0xf6)]=_0x1e8434?_0x1e8434+0x1:0x1,_0x5d7d89[constants_1[_0x398431(0xa9)]+_0x398431(0xd1)]=!![],_0x5d7d89;}[a195_0x363cd7(0xcf)](_0x422333,_0x5f9a6f){const _0x32dfe9=a195_0x363cd7;var _0x196614,_0x1c5952;const _0x2f89dd=new Date()[_0x32dfe9(0xdc)](),_0x6e58fe={};return!_0x5f9a6f?(this[_0x32dfe9(0xa4)]?(_0x6e58fe[constants_1[_0x32dfe9(0x9a)]+'Branch__c']=this[_0x32dfe9(0xa4)],_0x6e58fe[constants_1['FLOSUM_NAMESPACE']+'Source__c']=_0x32dfe9(0xa0),_0x6e58fe[_0x32dfe9(0xce)]=(_0x196614=this[_0x32dfe9(0xd5)][_0x32dfe9(0xb3)](_0x38735c=>_0x38735c[_0x32dfe9(0x96)]===_0x32dfe9(0xa0)))===null||_0x196614===void 0x0?void 0x0:_0x196614['id']):(_0x6e58fe[constants_1[_0x32dfe9(0x9a)]+_0x32dfe9(0xbf)]=this['repositoryId'],_0x6e58fe[constants_1[_0x32dfe9(0x9a)]+'Source__c']=_0x32dfe9(0xa7),_0x6e58fe['RecordTypeId']=(_0x1c5952=this[_0x32dfe9(0xd5)]['find'](_0x7a3373=>_0x7a3373['name']===_0x32dfe9(0xa7)))===null||_0x1c5952===void 0x0?void 0x0:_0x1c5952['id']),_0x6e58fe[constants_1[_0x32dfe9(0x9a)]+_0x32dfe9(0xf6)]=0x1):_0x6e58fe[constants_1[_0x32dfe9(0x9a)]+_0x32dfe9(0xf6)]=_0x5f9a6f[_0x32dfe9(0xab)]+0x1,_0x6e58fe[constants_1['FLOSUM_NAMESPACE']+_0x32dfe9(0x9f)]=_0x422333[_0x32dfe9(0xe7)],_0x6e58fe[constants_1[_0x32dfe9(0x9a)]+_0x32dfe9(0x9e)]=_0x422333[_0x32dfe9(0x96)],_0x6e58fe[constants_1[_0x32dfe9(0x9a)]+_0x32dfe9(0xe6)]=_0x422333['filePath'],_0x6e58fe[constants_1[_0x32dfe9(0x9a)]+_0x32dfe9(0xde)]=this[_0x32dfe9(0xc3)],_0x6e58fe[constants_1[_0x32dfe9(0x9a)]+_0x32dfe9(0xe1)]=this['username'],_0x6e58fe[constants_1[_0x32dfe9(0x9a)]+_0x32dfe9(0xc4)]=_0x2f89dd,_0x6e58fe[constants_1['FLOSUM_NAMESPACE']+'Committed_On__c']=_0x2f89dd,_0x6e58fe[constants_1['FLOSUM_NAMESPACE']+_0x32dfe9(0xb4)]=_0x422333[_0x32dfe9(0xd2)],_0x6e58fe;}[a195_0x363cd7(0xf5)](){const _0xe8a40f=a195_0x363cd7;return this[_0xe8a40f(0xe5)];}async[a195_0x363cd7(0xdd)](_0x36322c,_0x2cc143){const _0x261146=a195_0x363cd7,_0x4a4e7e=[];for(const _0x9933db of _0x36322c){const _0x2f0a1e=(0x0,composite_utils_1[_0x261146(0xed)])(constants_1[_0x261146(0xf0)],this[_0x261146(0xcf)](_0x9933db)),_0x4a1a5e=(0x0,composite_utils_1[_0x261146(0xed)])(constants_1[_0x261146(0xf1)],this['prepareComponentHistoryRecord'](_0x9933db,'@{'+_0x2f0a1e[_0x261146(0xa2)]+'.id}')),_0x4dbf25=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x261146(0xea)],await this['prepareComponentAttachmentRecord'](_0x9933db,'@{'+_0x4a1a5e[_0x261146(0xa2)]+_0x261146(0xb5)));this[_0x261146(0xef)](_0x2f0a1e[_0x261146(0xc2)][_0x261146(0xd8)],_0x2f0a1e[_0x261146(0xa2)]),_0x4a4e7e[_0x261146(0xd0)](_0x2f0a1e[_0x261146(0xc2)],_0x4a1a5e['request'],_0x4dbf25[_0x261146(0xc2)]),_0x2cc143&&_0x4a4e7e['push'](this[_0x261146(0x97)](_0x2cc143,'@{'+_0x4a1a5e[_0x261146(0xa2)]+_0x261146(0xb5)));}return _0x4a4e7e;}async[a195_0x363cd7(0xec)](_0x40541c,_0x361ed0=''){const _0x318893=a195_0x363cd7,_0x3fb651=[];for(const {component:_0x3ebb15,meta:_0x14c13e}of _0x40541c){if(!_0x14c13e['id']){const _0x550b1e=this[_0x318893(0xe5)][_0x318893(0xb3)](_0x554f9d=>_0x554f9d[_0x318893(0xa1)]===_0x3ebb15['name']&&_0x554f9d[_0x318893(0xc1)]===_0x3ebb15['type']);if(!_0x550b1e)throw new salesforce_error_1[(_0x318893(0xb0))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x3ebb15['name']+'\x20['+_0x3ebb15[_0x318893(0xe7)]+_0x318893(0xe2)));_0x14c13e['id']=_0x550b1e[_0x318893(0xeb)];}const _0x585c78=(0x0,composite_utils_1[_0x318893(0xb1)])(constants_1[_0x318893(0xf0)],_0x14c13e['id'],this[_0x318893(0xcf)](_0x3ebb15,_0x14c13e)),_0x128adc=(0x0,composite_utils_1[_0x318893(0xed)])(constants_1[_0x318893(0xf1)],this[_0x318893(0xb9)](_0x3ebb15,_0x14c13e['id'],_0x14c13e[_0x318893(0xab)])),_0x509351=(0x0,composite_utils_1[_0x318893(0xed)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x318893(0xbb)](_0x3ebb15,'@{'+_0x128adc[_0x318893(0xa2)]+'.id}'));this[_0x318893(0xef)](_0x585c78['request'][_0x318893(0xd8)],_0x585c78[_0x318893(0xa2)]),_0x3fb651[_0x318893(0xd0)](_0x585c78[_0x318893(0xc2)],_0x128adc['request'],_0x509351[_0x318893(0xc2)]),_0x361ed0&&_0x3fb651[_0x318893(0xd0)](this[_0x318893(0x97)](_0x361ed0,'@{'+_0x128adc[_0x318893(0xa2)]+_0x318893(0xb5)));}return _0x3fb651;}async[a195_0x363cd7(0xf4)](_0x2a7feb,_0x15447c=![]){const _0x33c559=a195_0x363cd7,_0x4d10b5={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x290481=[];for(const _0x4b3bab of _0x2a7feb){if(_0x4b3bab['id'])_0x290481[_0x33c559(0xd0)](_0x4b3bab['id']);else{const _0xbcb4d6=this[_0x33c559(0xe5)][_0x33c559(0xb3)](_0x30c6bb=>_0x30c6bb[_0x33c559(0xa1)]===_0x4b3bab[_0x33c559(0x96)]&&_0x30c6bb[_0x33c559(0xc1)]===_0x4b3bab['type']);if(!_0xbcb4d6||!_0xbcb4d6[_0x33c559(0xeb)])continue;_0x290481[_0x33c559(0xd0)](_0xbcb4d6[_0x33c559(0xeb)]);}}if(_0x15447c){const _0x442699=await this[_0x33c559(0xdb)][_0x33c559(0xe3)](_0x290481);_0x4d10b5[_0x33c559(0xe0)]=_0x442699[_0x33c559(0xc7)](_0x992227=>(0x0,composite_utils_1[_0x33c559(0x98)])(constants_1[_0x33c559(0x94)],_0x992227)['request']);}return _0x4d10b5[_0x33c559(0xf7)]=_0x290481[_0x33c559(0xc7)](_0x292a76=>(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x33c559(0xf0)],_0x292a76,{[constants_1[_0x33c559(0xa9)]+_0x33c559(0x9d)]:!![]})[_0x33c559(0xc2)]),_0x4d10b5['componentsToDelete']=_0x290481[_0x33c559(0xc7)](_0x1056f=>(0x0,composite_utils_1[_0x33c559(0x98)])(constants_1['FLOSUM_COMPONENT'],_0x1056f)[_0x33c559(0xc2)]),_0x4d10b5;}}exports[a195_0x363cd7(0x99)]=SalesforceComponentsManager;