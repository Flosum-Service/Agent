const a272_0x416f74=a272_0x49bf;(function(_0xe21ce6,_0x64fd7b){const _0x5a666c=a272_0x49bf,_0x1620ed=_0xe21ce6();while(!![]){try{const _0x4d6e4e=parseInt(_0x5a666c(0x14c))/0x1*(-parseInt(_0x5a666c(0x12a))/0x2)+parseInt(_0x5a666c(0x152))/0x3*(parseInt(_0x5a666c(0x13f))/0x4)+parseInt(_0x5a666c(0x140))/0x5+parseInt(_0x5a666c(0x111))/0x6*(-parseInt(_0x5a666c(0x106))/0x7)+parseInt(_0x5a666c(0x11f))/0x8+parseInt(_0x5a666c(0x123))/0x9+parseInt(_0x5a666c(0xf9))/0xa*(parseInt(_0x5a666c(0xfe))/0xb);if(_0x4d6e4e===_0x64fd7b)break;else _0x1620ed['push'](_0x1620ed['shift']());}catch(_0x201764){_0x1620ed['push'](_0x1620ed['shift']());}}}(a272_0xc362,0x82a8e));const a272_0xf2455c=(function(){let _0x4511aa=!![];return function(_0x22bb3c,_0x209c6c){const _0x44d944=_0x4511aa?function(){const _0x1e3f92=a272_0x49bf;if(_0x209c6c){const _0x4dacd9=_0x209c6c[_0x1e3f92(0x139)](_0x22bb3c,arguments);return _0x209c6c=null,_0x4dacd9;}}:function(){};return _0x4511aa=![],_0x44d944;};}()),a272_0x2d230a=a272_0xf2455c(this,function(){const _0x6338ec=a272_0x49bf;return a272_0x2d230a[_0x6338ec(0x11d)]()[_0x6338ec(0x101)]('(((.+)+)+)+$')['toString']()[_0x6338ec(0x110)](a272_0x2d230a)[_0x6338ec(0x101)]('(((.+)+)+)+$');});a272_0x2d230a();'use strict';function a272_0xc362(){const _0x261fbd=['1049082GJHXVp','.id}','ParentId','Commit__c','push','Name','map','file','version','vlocityComponentName','manifests','get','toString','FLOSUM_NAMESPACE','1758184YpNDoQ','__esModule','ContentType','gitSync','3570174JtDsQS','SalesforceComponentsManager','Body','Is_From_Agent__c','request','reference','../utils/composite.utils','2HXJsIa','../errors/salesforce.error','Component_Name__c','prepareComponentAttachmentRecord','prepareComponentHistoryRecord','proceedComponentMeta','filePath','File_Name__c','crc','prepareCommitManifest','Changed_By__c','componentType','defineProperty','Last_Modified_Date__c','extractFieldsFromRecord','apply','toISOString','update','insert','Component_History__c','FLOSUM_GIT_NAMESPACE','12scvqEV','2572365Qzymuk','Committed_On__c','SalesforceError','CRC32__c','Branch','Last_Modified_By__c','generateAsync','./salesforce-git-sync.service','getProceededComponentsMeta','type','componentName','application/zip','1063515PaMuLZ','Logger','Description','Zip','files','Repository__c','703551ovxsas','marketingCloudKey','branchId','username','prepareComponentRecord','logger','RecordTypeId','Component_Type__c','Version__c','isVlocityComponent','recordTypes','repositoryId','proceededComponentsMeta','Deletion_By_Agent__c','FLOSUM_COMPONENT','fetchCommitManifestsByComponentIds','typedi','name','2318010IMcAZO','DEFLATE','componentId','find','base64','22CLmkry','../../../../constants','FLOSUM_ATTACHMENT','search','Changed_On__c','Branch__c','createDeleteRequest','Last_Updated_By__c','28OmbAZu','Repository','Vlocity_Component__c','FLOSUM_COMPONENT_HISTORY','FLOSUM_COMMIT_MANIFEST','createPostRequest','../../../../core',']\x20-\x20meta\x20not\x20found','Component__c','body','constructor'];a272_0xc362=function(){return _0x261fbd;};return a272_0xc362();}var __importDefault=this&&this['__importDefault']||function(_0x14b13e){const _0x1eb45f=a272_0x49bf;return _0x14b13e&&_0x14b13e[_0x1eb45f(0x120)]?_0x14b13e:{'default':_0x14b13e};};Object[a272_0x416f74(0x136)](exports,a272_0x416f74(0x120),{'value':!![]}),exports[a272_0x416f74(0x124)]=void 0x0;const constants_1=require(a272_0x416f74(0xff)),core_1=require(a272_0x416f74(0x10c)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a272_0x416f74(0xf7))),salesforce_error_1=require(a272_0x416f74(0x12b)),composite_utils_1=require(a272_0x416f74(0x129)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a272_0x416f74(0x147));class SalesforceComponentsManager{constructor(_0x3f750d,_0x25a7cf,_0x9362fd,_0xddfb3,_0x43d4c5){const _0x5c4967=a272_0x416f74;this[_0x5c4967(0xf2)]=_0x3f750d,this[_0x5c4967(0x154)]=_0x25a7cf,this[_0x5c4967(0xea)]=_0x9362fd,this[_0x5c4967(0xf1)]=_0xddfb3,this[_0x5c4967(0xf3)]=_0x43d4c5,this[_0x5c4967(0xec)]=new core_1[(_0x5c4967(0x14d))](SalesforceComponentsManager[_0x5c4967(0xf8)]),this[_0x5c4967(0x122)]=typedi_1['default'][_0x5c4967(0x11c)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a272_0x416f74(0x12f)](_0x3b0a77,_0x1c9196){const _0x4ff85a=a272_0x416f74,_0x372919=(0x0,flosum_naming_utils_1[_0x4ff85a(0x138)])(_0x3b0a77,[_0x4ff85a(0xee),_0x4ff85a(0x12c),'Version__c']);this[_0x4ff85a(0xf3)][_0x4ff85a(0x115)]({'componentId':'','reference':_0x1c9196,'version':_0x372919[_0x4ff85a(0xef)],'componentName':_0x372919['Component_Name__c'],'componentType':_0x372919['Component_Type__c']});}[a272_0x416f74(0x133)](_0x39c88,_0x5b596e){const _0x43d15e=a272_0x416f74,{request:_0x267f66}=(0x0,composite_utils_1[_0x43d15e(0x10b)])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1['FLOSUM_NAMESPACE']+_0x43d15e(0x114)]:_0x39c88,[constants_1[_0x43d15e(0x11e)]+_0x43d15e(0x13d)]:_0x5b596e});return _0x267f66;}async[a272_0x416f74(0x12d)](_0x5f31d6,_0x3b0c97){const _0x133dde=a272_0x416f74,_0x1b2627={},_0x2bcdf0=zip_1[_0x133dde(0x14f)]['createZip']();for(const _0x43a6ef of Object['keys'](_0x5f31d6[_0x133dde(0x150)])){_0x2bcdf0[_0x133dde(0x118)](_0x43a6ef,_0x5f31d6[_0x133dde(0x150)][_0x43a6ef],{'createFolders':!![]});}return _0x1b2627[_0x133dde(0x121)]=_0x133dde(0x14b),_0x1b2627[_0x133dde(0x116)]=_0x5f31d6[_0x133dde(0x149)],_0x1b2627[_0x133dde(0x14e)]=_0x5f31d6[_0x133dde(0x149)],_0x1b2627[_0x133dde(0x113)]=_0x3b0c97,_0x1b2627[_0x133dde(0x125)]=await _0x2bcdf0[_0x133dde(0x146)]({'type':_0x133dde(0xfd),'compression':_0x133dde(0xfa),'compressionOptions':{'level':0x6}}),_0x1b2627;}['prepareComponentHistoryRecord'](_0x51dcb6,_0x4b784c,_0x5ea2dc){const _0x2e8fae=a272_0x416f74,_0x30447c=new Date()[_0x2e8fae(0x13a)](),_0x2be1ce={};return _0x2be1ce[constants_1[_0x2e8fae(0x11e)]+_0x2e8fae(0x10e)]=_0x4b784c,_0x2be1ce[constants_1[_0x2e8fae(0x11e)]+'CRC32__c']=_0x51dcb6[_0x2e8fae(0x132)],_0x2be1ce[constants_1[_0x2e8fae(0x11e)]+_0x2e8fae(0x102)]=_0x30447c,_0x2be1ce[constants_1['FLOSUM_NAMESPACE']+_0x2e8fae(0x134)]=this[_0x2e8fae(0xea)],_0x2be1ce[constants_1[_0x2e8fae(0x11e)]+_0x2e8fae(0xef)]=_0x5ea2dc?_0x5ea2dc+0x1:0x1,_0x2be1ce[constants_1[_0x2e8fae(0x13e)]+_0x2e8fae(0x126)]=!![],_0x2be1ce;}['prepareComponentRecord'](_0x58ac2f,_0x4dc6b8){const _0x45bfc6=a272_0x416f74;var _0x5c1955,_0x27e8ea;const _0x105b27=new Date()[_0x45bfc6(0x13a)](),_0x1b185a={};return!_0x4dc6b8?(this[_0x45bfc6(0x154)]?(_0x1b185a[constants_1[_0x45bfc6(0x11e)]+_0x45bfc6(0x103)]=this[_0x45bfc6(0x154)],_0x1b185a[constants_1['FLOSUM_NAMESPACE']+'Source__c']='Branch',_0x1b185a[_0x45bfc6(0xed)]=(_0x5c1955=this[_0x45bfc6(0xf1)][_0x45bfc6(0xfc)](_0x1c6a1a=>_0x1c6a1a[_0x45bfc6(0xf8)]===_0x45bfc6(0x144)))===null||_0x5c1955===void 0x0?void 0x0:_0x5c1955['id']):(_0x1b185a[constants_1[_0x45bfc6(0x11e)]+_0x45bfc6(0x151)]=this['repositoryId'],_0x1b185a[constants_1[_0x45bfc6(0x11e)]+'Source__c']=_0x45bfc6(0x107),_0x1b185a['RecordTypeId']=(_0x27e8ea=this[_0x45bfc6(0xf1)][_0x45bfc6(0xfc)](_0x596d23=>_0x596d23[_0x45bfc6(0xf8)]===_0x45bfc6(0x107)))===null||_0x27e8ea===void 0x0?void 0x0:_0x27e8ea['id']),_0x1b185a[constants_1[_0x45bfc6(0x11e)]+_0x45bfc6(0xef)]=0x1):_0x1b185a[constants_1['FLOSUM_NAMESPACE']+_0x45bfc6(0xef)]=_0x4dc6b8[_0x45bfc6(0x119)]+0x1,_0x1b185a[constants_1[_0x45bfc6(0x11e)]+'Component_Type__c']=_0x58ac2f[_0x45bfc6(0x149)],_0x1b185a[constants_1[_0x45bfc6(0x11e)]+_0x45bfc6(0x12c)]=_0x58ac2f[_0x45bfc6(0xf8)],_0x1b185a[constants_1[_0x45bfc6(0x11e)]+_0x45bfc6(0x131)]=_0x58ac2f[_0x45bfc6(0x130)],_0x1b185a[constants_1[_0x45bfc6(0x11e)]+_0x45bfc6(0x105)]=this[_0x45bfc6(0xea)],_0x1b185a[constants_1[_0x45bfc6(0x11e)]+_0x45bfc6(0x145)]=this[_0x45bfc6(0xea)],_0x1b185a[constants_1[_0x45bfc6(0x11e)]+_0x45bfc6(0x137)]=_0x105b27,_0x1b185a[constants_1['FLOSUM_NAMESPACE']+_0x45bfc6(0x141)]=_0x105b27,_0x1b185a[constants_1[_0x45bfc6(0x11e)]+_0x45bfc6(0x143)]=_0x58ac2f[_0x45bfc6(0x132)],_0x1b185a[constants_1['FLOSUM_NAMESPACE']+'Vlocity_Component_Name__c']=_0x58ac2f[_0x45bfc6(0x11a)],_0x1b185a[constants_1['FLOSUM_NAMESPACE']+_0x45bfc6(0x108)]=_0x58ac2f[_0x45bfc6(0xf0)],_0x1b185a[constants_1[_0x45bfc6(0x11e)]+'MC_Key__c']=_0x58ac2f[_0x45bfc6(0x153)],_0x1b185a;}[a272_0x416f74(0x148)](){return this['proceededComponentsMeta'];}async[a272_0x416f74(0x13c)](_0x382798,_0x538460){const _0x14f29c=a272_0x416f74,_0x58faa0=[];for(const _0x4a4fc4 of _0x382798){const _0x2e1a65=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x14f29c(0xf5)],this[_0x14f29c(0xeb)](_0x4a4fc4)),_0x6d1000=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x14f29c(0x109)],this[_0x14f29c(0x12e)](_0x4a4fc4,'@{'+_0x2e1a65[_0x14f29c(0x128)]+_0x14f29c(0x112))),_0x2ff294=(0x0,composite_utils_1[_0x14f29c(0x10b)])(constants_1[_0x14f29c(0x100)],await this[_0x14f29c(0x12d)](_0x4a4fc4,'@{'+_0x6d1000['reference']+_0x14f29c(0x112)));this['proceedComponentMeta'](_0x2e1a65[_0x14f29c(0x127)][_0x14f29c(0x10f)],_0x2e1a65['reference']),_0x58faa0['push'](_0x2e1a65[_0x14f29c(0x127)],_0x6d1000[_0x14f29c(0x127)],_0x2ff294[_0x14f29c(0x127)]),_0x538460&&_0x58faa0[_0x14f29c(0x115)](this[_0x14f29c(0x133)](_0x538460,'@{'+_0x6d1000[_0x14f29c(0x128)]+_0x14f29c(0x112)));}return _0x58faa0;}async[a272_0x416f74(0x13b)](_0x462592,_0x52566a=''){const _0x2e8ddb=a272_0x416f74,_0x1139c2=[];for(const {component:_0x5d6296,meta:_0x2256e5}of _0x462592){if(!_0x2256e5['id']){const _0xe5df99=this[_0x2e8ddb(0xf3)][_0x2e8ddb(0xfc)](_0x5d5ec0=>_0x5d5ec0[_0x2e8ddb(0x14a)]===_0x5d6296[_0x2e8ddb(0xf8)]&&_0x5d5ec0[_0x2e8ddb(0x135)]===_0x5d6296['type']);if(!_0xe5df99)throw new salesforce_error_1[(_0x2e8ddb(0x142))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x5d6296['name']+'\x20['+_0x5d6296[_0x2e8ddb(0x149)]+_0x2e8ddb(0x10d)));_0x2256e5['id']=_0xe5df99[_0x2e8ddb(0xfb)];}const _0x44beb5=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x2e8ddb(0xf5)],_0x2256e5['id'],this[_0x2e8ddb(0xeb)](_0x5d6296,_0x2256e5)),_0x46ceb1=(0x0,composite_utils_1[_0x2e8ddb(0x10b)])(constants_1[_0x2e8ddb(0x109)],this['prepareComponentHistoryRecord'](_0x5d6296,_0x2256e5['id'],_0x2256e5['version'])),_0x4e0969=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x2e8ddb(0x12d)](_0x5d6296,'@{'+_0x46ceb1[_0x2e8ddb(0x128)]+_0x2e8ddb(0x112)));this['proceedComponentMeta'](_0x44beb5[_0x2e8ddb(0x127)][_0x2e8ddb(0x10f)],_0x44beb5[_0x2e8ddb(0x128)]),_0x1139c2[_0x2e8ddb(0x115)](_0x44beb5[_0x2e8ddb(0x127)],_0x46ceb1['request'],_0x4e0969[_0x2e8ddb(0x127)]),_0x52566a&&_0x1139c2[_0x2e8ddb(0x115)](this['prepareCommitManifest'](_0x52566a,'@{'+_0x46ceb1['reference']+_0x2e8ddb(0x112)));}return _0x1139c2;}async['delete'](_0x49afb2,_0x44a4b5=![]){const _0x431b5a=a272_0x416f74,_0x5d0a9d={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x59a66b=[];for(const _0x30c152 of _0x49afb2){if(_0x30c152['id'])_0x59a66b[_0x431b5a(0x115)](_0x30c152['id']);else{const _0x2b2f05=this[_0x431b5a(0xf3)]['find'](_0x5dfcc5=>_0x5dfcc5[_0x431b5a(0x14a)]===_0x30c152[_0x431b5a(0xf8)]&&_0x5dfcc5[_0x431b5a(0x135)]===_0x30c152['type']);if(!_0x2b2f05||!_0x2b2f05[_0x431b5a(0xfb)])continue;_0x59a66b[_0x431b5a(0x115)](_0x2b2f05[_0x431b5a(0xfb)]);}}if(_0x44a4b5){const _0x4741a1=await this[_0x431b5a(0x122)][_0x431b5a(0xf6)](_0x59a66b);_0x5d0a9d[_0x431b5a(0x11b)]=_0x4741a1[_0x431b5a(0x117)](_0xf692e4=>(0x0,composite_utils_1[_0x431b5a(0x104)])(constants_1[_0x431b5a(0x10a)],_0xf692e4)[_0x431b5a(0x127)]);}return _0x5d0a9d['componentsToUpdate']=_0x59a66b[_0x431b5a(0x117)](_0x2d3c95=>(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x431b5a(0xf5)],_0x2d3c95,{[constants_1[_0x431b5a(0x13e)]+_0x431b5a(0xf4)]:!![]})[_0x431b5a(0x127)]),_0x5d0a9d['componentsToDelete']=_0x59a66b[_0x431b5a(0x117)](_0x525796=>(0x0,composite_utils_1[_0x431b5a(0x104)])(constants_1[_0x431b5a(0xf5)],_0x525796)[_0x431b5a(0x127)]),_0x5d0a9d;}}function a272_0x49bf(_0x1e4fae,_0x984f37){const _0x5310c3=a272_0xc362();return a272_0x49bf=function(_0x2d230a,_0xf2455c){_0x2d230a=_0x2d230a-0xea;let _0xc362db=_0x5310c3[_0x2d230a];return _0xc362db;},a272_0x49bf(_0x1e4fae,_0x984f37);}exports['SalesforceComponentsManager']=SalesforceComponentsManager;