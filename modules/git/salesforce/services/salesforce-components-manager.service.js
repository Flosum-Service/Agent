const a234_0xa40609=a234_0x21ba;(function(_0x34b5e5,_0x5b9358){const _0x2d037a=a234_0x21ba,_0x187947=_0x34b5e5();while(!![]){try{const _0x28215f=parseInt(_0x2d037a(0xc6))/0x1+parseInt(_0x2d037a(0x93))/0x2+parseInt(_0x2d037a(0xa3))/0x3+parseInt(_0x2d037a(0xc8))/0x4*(parseInt(_0x2d037a(0x94))/0x5)+-parseInt(_0x2d037a(0xb1))/0x6+-parseInt(_0x2d037a(0x7b))/0x7*(parseInt(_0x2d037a(0xaf))/0x8)+-parseInt(_0x2d037a(0xbc))/0x9;if(_0x28215f===_0x5b9358)break;else _0x187947['push'](_0x187947['shift']());}catch(_0x10b824){_0x187947['push'](_0x187947['shift']());}}}(a234_0x765f,0x851e4));const a234_0x513d28=(function(){let _0x447290=!![];return function(_0x520530,_0x5623ad){const _0x2d6e4a=_0x447290?function(){if(_0x5623ad){const _0x13bf4c=_0x5623ad['apply'](_0x520530,arguments);return _0x5623ad=null,_0x13bf4c;}}:function(){};return _0x447290=![],_0x2d6e4a;};}()),a234_0x19cef6=a234_0x513d28(this,function(){const _0x2abd86=a234_0x21ba;return a234_0x19cef6[_0x2abd86(0x86)]()[_0x2abd86(0xc1)](_0x2abd86(0x82))[_0x2abd86(0x86)]()[_0x2abd86(0xcc)](a234_0x19cef6)['search']('(((.+)+)+)+$');});a234_0x19cef6();'use strict';var __importDefault=this&&this[a234_0xa40609(0xb7)]||function(_0x3dbbbc){const _0x17dfcd=a234_0xa40609;return _0x3dbbbc&&_0x3dbbbc[_0x17dfcd(0x9f)]?_0x3dbbbc:{'default':_0x3dbbbc};};Object[a234_0xa40609(0x9c)](exports,a234_0xa40609(0x9f),{'value':!![]}),exports[a234_0xa40609(0xce)]=void 0x0;const constants_1=require(a234_0xa40609(0xae)),core_1=require('../../../../core'),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a234_0xa40609(0x96))),salesforce_error_1=require(a234_0xa40609(0xd4)),composite_utils_1=require(a234_0xa40609(0x84)),flosum_naming_utils_1=require(a234_0xa40609(0x90)),salesforce_git_sync_service_1=require(a234_0xa40609(0x7f));class SalesforceComponentsManager{constructor(_0x35407f,_0xeb6b99,_0x12ed23,_0x448f4f,_0x7f4110){const _0x1e3be6=a234_0xa40609;this[_0x1e3be6(0x80)]=_0x35407f,this['branchId']=_0xeb6b99,this[_0x1e3be6(0xbd)]=_0x12ed23,this['recordTypes']=_0x448f4f,this[_0x1e3be6(0xcf)]=_0x7f4110,this[_0x1e3be6(0xab)]=new core_1[(_0x1e3be6(0xd0))](SalesforceComponentsManager['name']),this[_0x1e3be6(0xb0)]=typedi_1[_0x1e3be6(0xa7)][_0x1e3be6(0xd5)](salesforce_git_sync_service_1[_0x1e3be6(0x87)]);}['proceedComponentMeta'](_0x2deeb0,_0xba627e){const _0x4345de=a234_0xa40609,_0x544ae2=(0x0,flosum_naming_utils_1[_0x4345de(0x7c)])(_0x2deeb0,[_0x4345de(0x8c),'Component_Name__c',_0x4345de(0xc2)]);this['proceededComponentsMeta']['push']({'componentId':'','reference':_0xba627e,'version':_0x544ae2['Version__c'],'componentName':_0x544ae2['Component_Name__c'],'componentType':_0x544ae2['Component_Type__c']});}['prepareCommitManifest'](_0x5eff30,_0x4de2f1){const _0x1299dd=a234_0xa40609,{request:_0x764db0}=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1['FLOSUM_NAMESPACE']+_0x1299dd(0xca)]:_0x5eff30,[constants_1[_0x1299dd(0x81)]+_0x1299dd(0xa4)]:_0x4de2f1});return _0x764db0;}async[a234_0xa40609(0xa5)](_0x1adf45,_0x30007e){const _0x51ba40=a234_0xa40609,_0x2000d7={},_0x38d01d=zip_1['Zip'][_0x51ba40(0x8e)]();for(const _0x6f1130 of Object[_0x51ba40(0x8d)](_0x1adf45['files'])){_0x38d01d[_0x51ba40(0xd2)](_0x6f1130,_0x1adf45['files'][_0x6f1130],{'createFolders':!![]});}return _0x2000d7[_0x51ba40(0xc9)]=_0x51ba40(0x97),_0x2000d7['Name']=_0x1adf45[_0x51ba40(0xa9)],_0x2000d7[_0x51ba40(0xaa)]=_0x1adf45[_0x51ba40(0xa9)],_0x2000d7[_0x51ba40(0x8a)]=_0x30007e,_0x2000d7['Body']=await _0x38d01d['generateAsync']({'type':'base64','compression':_0x51ba40(0x8f),'compressionOptions':{'level':0x6}}),_0x2000d7;}[a234_0xa40609(0xc3)](_0x11fc30,_0x56c78f,_0x5f8eb0){const _0xd6407b=a234_0xa40609,_0x2d2a38=new Date()[_0xd6407b(0xcd)](),_0x3d7253={};return _0x3d7253[constants_1[_0xd6407b(0x81)]+_0xd6407b(0x74)]=_0x56c78f,_0x3d7253[constants_1[_0xd6407b(0x81)]+'CRC32__c']=_0x11fc30[_0xd6407b(0x92)],_0x3d7253[constants_1[_0xd6407b(0x81)]+_0xd6407b(0x98)]=_0x2d2a38,_0x3d7253[constants_1[_0xd6407b(0x81)]+'Changed_By__c']=this[_0xd6407b(0xbd)],_0x3d7253[constants_1['FLOSUM_NAMESPACE']+_0xd6407b(0xc2)]=_0x5f8eb0?_0x5f8eb0+0x1:0x1,_0x3d7253[constants_1[_0xd6407b(0xb5)]+_0xd6407b(0x77)]=!![],_0x3d7253;}[a234_0xa40609(0x73)](_0x1a8efc,_0xd9c80b){const _0x4f580f=a234_0xa40609;var _0x6dc4dd,_0x29f47c;const _0x4fdb1c=new Date()[_0x4f580f(0xcd)](),_0x1075c1={};return!_0xd9c80b?(this['branchId']?(_0x1075c1[constants_1[_0x4f580f(0x81)]+_0x4f580f(0xcb)]=this[_0x4f580f(0xb6)],_0x1075c1[constants_1[_0x4f580f(0x81)]+'Source__c']=_0x4f580f(0xbb),_0x1075c1[_0x4f580f(0xd6)]=(_0x6dc4dd=this[_0x4f580f(0x8b)][_0x4f580f(0xac)](_0x43f1fc=>_0x43f1fc[_0x4f580f(0xc7)]==='Branch'))===null||_0x6dc4dd===void 0x0?void 0x0:_0x6dc4dd['id']):(_0x1075c1[constants_1[_0x4f580f(0x81)]+_0x4f580f(0x75)]=this[_0x4f580f(0x80)],_0x1075c1[constants_1[_0x4f580f(0x81)]+'Source__c']='Repository',_0x1075c1[_0x4f580f(0xd6)]=(_0x29f47c=this[_0x4f580f(0x8b)][_0x4f580f(0xac)](_0x5b5222=>_0x5b5222[_0x4f580f(0xc7)]===_0x4f580f(0x9b)))===null||_0x29f47c===void 0x0?void 0x0:_0x29f47c['id']),_0x1075c1[constants_1[_0x4f580f(0x81)]+_0x4f580f(0xc2)]=0x1):_0x1075c1[constants_1[_0x4f580f(0x81)]+'Version__c']=_0xd9c80b[_0x4f580f(0xbe)]+0x1,_0x1075c1[constants_1[_0x4f580f(0x81)]+_0x4f580f(0x8c)]=_0x1a8efc[_0x4f580f(0xa9)],_0x1075c1[constants_1[_0x4f580f(0x81)]+'Component_Name__c']=_0x1a8efc['name'],_0x1075c1[constants_1[_0x4f580f(0x81)]+_0x4f580f(0x9a)]=_0x1a8efc[_0x4f580f(0x78)],_0x1075c1[constants_1[_0x4f580f(0x81)]+_0x4f580f(0xa6)]=this[_0x4f580f(0xbd)],_0x1075c1[constants_1['FLOSUM_NAMESPACE']+_0x4f580f(0xc5)]=this[_0x4f580f(0xbd)],_0x1075c1[constants_1['FLOSUM_NAMESPACE']+_0x4f580f(0xa1)]=_0x4fdb1c,_0x1075c1[constants_1[_0x4f580f(0x81)]+_0x4f580f(0xbf)]=_0x4fdb1c,_0x1075c1[constants_1['FLOSUM_NAMESPACE']+_0x4f580f(0xa8)]=_0x1a8efc[_0x4f580f(0x92)],_0x1075c1[constants_1[_0x4f580f(0x81)]+_0x4f580f(0xc4)]=_0x1a8efc[_0x4f580f(0x99)],_0x1075c1[constants_1[_0x4f580f(0x81)]+_0x4f580f(0xb9)]=_0x1a8efc[_0x4f580f(0xd3)],_0x1075c1;}['getProceededComponentsMeta'](){const _0x56bdbc=a234_0xa40609;return this[_0x56bdbc(0xcf)];}async[a234_0xa40609(0xc0)](_0xc6da4f,_0x2cb8ed){const _0x1fd7e8=a234_0xa40609,_0x500d59=[];for(const _0x288359 of _0xc6da4f){const _0x1b432c=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x1fd7e8(0x79)],this['prepareComponentRecord'](_0x288359)),_0xbd4a19=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_COMPONENT_HISTORY'],this['prepareComponentHistoryRecord'](_0x288359,'@{'+_0x1b432c['reference']+_0x1fd7e8(0xb2))),_0x5f1086=(0x0,composite_utils_1[_0x1fd7e8(0x85)])(constants_1[_0x1fd7e8(0x89)],await this['prepareComponentAttachmentRecord'](_0x288359,'@{'+_0xbd4a19['reference']+'.id}'));this['proceedComponentMeta'](_0x1b432c[_0x1fd7e8(0x95)][_0x1fd7e8(0xb8)],_0x1b432c[_0x1fd7e8(0x83)]),_0x500d59['push'](_0x1b432c[_0x1fd7e8(0x95)],_0xbd4a19[_0x1fd7e8(0x95)],_0x5f1086['request']),_0x2cb8ed&&_0x500d59['push'](this[_0x1fd7e8(0x9d)](_0x2cb8ed,'@{'+_0xbd4a19[_0x1fd7e8(0x83)]+'.id}'));}return _0x500d59;}async[a234_0xa40609(0xb4)](_0x393ded,_0x119544=''){const _0x4d9c12=a234_0xa40609,_0x594968=[];for(const {component:_0xb0e5c9,meta:_0x2e06e5}of _0x393ded){if(!_0x2e06e5['id']){const _0x347804=this[_0x4d9c12(0xcf)][_0x4d9c12(0xac)](_0x2e0b1a=>_0x2e0b1a['componentName']===_0xb0e5c9[_0x4d9c12(0xc7)]&&_0x2e0b1a[_0x4d9c12(0xd1)]===_0xb0e5c9[_0x4d9c12(0xa9)]);if(!_0x347804)throw new salesforce_error_1[(_0x4d9c12(0xa0))](new Error(_0x4d9c12(0xb3)+_0xb0e5c9[_0x4d9c12(0xc7)]+'\x20['+_0xb0e5c9[_0x4d9c12(0xa9)]+']\x20-\x20meta\x20not\x20found'));_0x2e06e5['id']=_0x347804[_0x4d9c12(0x7e)];}const _0x380206=(0x0,composite_utils_1[_0x4d9c12(0x88)])(constants_1[_0x4d9c12(0x79)],_0x2e06e5['id'],this[_0x4d9c12(0x73)](_0xb0e5c9,_0x2e06e5)),_0x190926=(0x0,composite_utils_1[_0x4d9c12(0x85)])(constants_1[_0x4d9c12(0xad)],this[_0x4d9c12(0xc3)](_0xb0e5c9,_0x2e06e5['id'],_0x2e06e5['version'])),_0x16122a=(0x0,composite_utils_1[_0x4d9c12(0x85)])(constants_1[_0x4d9c12(0x89)],await this[_0x4d9c12(0xa5)](_0xb0e5c9,'@{'+_0x190926['reference']+_0x4d9c12(0xb2)));this[_0x4d9c12(0xba)](_0x380206[_0x4d9c12(0x95)][_0x4d9c12(0xb8)],_0x380206[_0x4d9c12(0x83)]),_0x594968[_0x4d9c12(0x91)](_0x380206[_0x4d9c12(0x95)],_0x190926[_0x4d9c12(0x95)],_0x16122a[_0x4d9c12(0x95)]),_0x119544&&_0x594968[_0x4d9c12(0x91)](this[_0x4d9c12(0x9d)](_0x119544,'@{'+_0x190926[_0x4d9c12(0x83)]+_0x4d9c12(0xb2)));}return _0x594968;}async[a234_0xa40609(0x76)](_0x4377d8,_0x5209e6=![]){const _0x236cad=a234_0xa40609,_0x4c5844={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0xae72b=[];for(const _0x3e52e6 of _0x4377d8){if(_0x3e52e6['id'])_0xae72b['push'](_0x3e52e6['id']);else{const _0x380a43=this[_0x236cad(0xcf)]['find'](_0x368df6=>_0x368df6[_0x236cad(0x7d)]===_0x3e52e6[_0x236cad(0xc7)]&&_0x368df6['componentType']===_0x3e52e6['type']);if(!_0x380a43||!_0x380a43[_0x236cad(0x7e)])continue;_0xae72b[_0x236cad(0x91)](_0x380a43[_0x236cad(0x7e)]);}}if(_0x5209e6){const _0x5b9fb8=await this[_0x236cad(0xb0)]['fetchCommitManifestsByComponentIds'](_0xae72b);_0x4c5844['manifests']=_0x5b9fb8[_0x236cad(0x9e)](_0x409f58=>(0x0,composite_utils_1[_0x236cad(0xa2)])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x409f58)[_0x236cad(0x95)]);}return _0x4c5844[_0x236cad(0x7a)]=_0xae72b[_0x236cad(0x9e)](_0x29243a=>(0x0,composite_utils_1[_0x236cad(0x88)])(constants_1[_0x236cad(0x79)],_0x29243a,{[constants_1[_0x236cad(0xb5)]+'Deletion_By_Agent__c']:!![]})[_0x236cad(0x95)]),_0x4c5844['componentsToDelete']=_0xae72b[_0x236cad(0x9e)](_0x12d2ed=>(0x0,composite_utils_1[_0x236cad(0xa2)])(constants_1[_0x236cad(0x79)],_0x12d2ed)[_0x236cad(0x95)]),_0x4c5844;}}function a234_0x21ba(_0x1af544,_0x570cd9){const _0x29a2f6=a234_0x765f();return a234_0x21ba=function(_0x19cef6,_0x513d28){_0x19cef6=_0x19cef6-0x73;let _0x765f07=_0x29a2f6[_0x19cef6];return _0x765f07;},a234_0x21ba(_0x1af544,_0x570cd9);}exports[a234_0xa40609(0xce)]=SalesforceComponentsManager;function a234_0x765f(){const _0x52c527=['Logger','componentType','file','isVlocityComponent','../errors/salesforce.error','get','RecordTypeId','prepareComponentRecord','Component__c','Repository__c','delete','Is_From_Agent__c','filePath','FLOSUM_COMPONENT','componentsToUpdate','4590215GOkQDj','extractFieldsFromRecord','componentName','componentId','./salesforce-git-sync.service','repositoryId','FLOSUM_NAMESPACE','(((.+)+)+)+$','reference','../utils/composite.utils','createPostRequest','toString','SalesforceGitSyncService','createPatchRequest','FLOSUM_ATTACHMENT','ParentId','recordTypes','Component_Type__c','keys','createZip','DEFLATE','../utils/flosum-naming.utils','push','crc','1816250qGrsoq','15sQsNaD','request','typedi','application/zip','Changed_On__c','vlocityComponentName','File_Name__c','Repository','defineProperty','prepareCommitManifest','map','__esModule','SalesforceError','Last_Modified_Date__c','createDeleteRequest','1650156JcSBAf','Component_History__c','prepareComponentAttachmentRecord','Last_Updated_By__c','default','CRC32__c','type','Description','logger','find','FLOSUM_COMPONENT_HISTORY','../../../../constants','8bjqVmy','gitSync','486912duNosB','.id}','Could\x20not\x20proceed\x20component\x20','update','FLOSUM_GIT_NAMESPACE','branchId','__importDefault','body','Vlocity_Component__c','proceedComponentMeta','Branch','8311707ukMwjK','username','version','Committed_On__c','insert','search','Version__c','prepareComponentHistoryRecord','Vlocity_Component_Name__c','Last_Modified_By__c','612378TlyvDB','name','180156qkKXqp','ContentType','Commit__c','Branch__c','constructor','toISOString','SalesforceComponentsManager','proceededComponentsMeta'];a234_0x765f=function(){return _0x52c527;};return a234_0x765f();}