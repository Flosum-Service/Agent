const a177_0x19cac4=a177_0x35fa;(function(_0x5799bc,_0x244f5a){const _0x34f199=a177_0x35fa,_0x549a9c=_0x5799bc();while(!![]){try{const _0x52f930=-parseInt(_0x34f199(0x156))/0x1*(-parseInt(_0x34f199(0x15e))/0x2)+parseInt(_0x34f199(0x171))/0x3+-parseInt(_0x34f199(0x119))/0x4+-parseInt(_0x34f199(0x122))/0x5*(parseInt(_0x34f199(0x155))/0x6)+-parseInt(_0x34f199(0x13b))/0x7*(parseInt(_0x34f199(0x154))/0x8)+parseInt(_0x34f199(0x170))/0x9+parseInt(_0x34f199(0x174))/0xa;if(_0x52f930===_0x244f5a)break;else _0x549a9c['push'](_0x549a9c['shift']());}catch(_0x123493){_0x549a9c['push'](_0x549a9c['shift']());}}}(a177_0x19ad,0xcff1b));const a177_0x486088=(function(){let _0x1420c5=!![];return function(_0x292225,_0x39d7fd){const _0x296b8a=_0x1420c5?function(){const _0x57474b=a177_0x35fa;if(_0x39d7fd){const _0x1d1354=_0x39d7fd[_0x57474b(0x118)](_0x292225,arguments);return _0x39d7fd=null,_0x1d1354;}}:function(){};return _0x1420c5=![],_0x296b8a;};}()),a177_0x457dd8=a177_0x486088(this,function(){const _0x1d95f8=a177_0x35fa;return a177_0x457dd8[_0x1d95f8(0x12c)]()['search'](_0x1d95f8(0x133))[_0x1d95f8(0x12c)]()[_0x1d95f8(0x163)](a177_0x457dd8)[_0x1d95f8(0x12b)](_0x1d95f8(0x133));});a177_0x457dd8();function a177_0x19ad(){const _0x5c30de=['get','Zip','createDeleteRequest','toISOString','RecordTypeId','typedi','(((.+)+)+)+$','Source__c','SalesforceComponentsManager',']\x20-\x20meta\x20not\x20found','Component_Type__c','body','extractFieldsFromRecord','request','14VbLFkV','Body','../utils/composite.utils','map','.id}','proceedComponentMeta','Repository__c','repositoryId','componentsToDelete','Commit__c','FLOSUM_COMPONENT_HISTORY','files','proceededComponentsMeta','__esModule','FLOSUM_NAMESPACE','branchId','prepareComponentRecord','Logger','push','FLOSUM_GIT_NAMESPACE','generateAsync','delete','Changed_By__c','update','componentsToUpdate','5952472Durfxq','95358CceLfq','47942GTAkzR','__importDefault','Component_Name__c','type','filePath','componentName','prepareComponentAttachmentRecord','recordTypes','10UqHqFx','Last_Modified_By__c','./salesforce-git-sync.service','Version__c','Deletion_By_Agent__c','constructor','FLOSUM_COMPONENT','prepareComponentHistoryRecord','Repository','version','Branch__c','application/zip','componentType','FLOSUM_ATTACHMENT','keys','base64','../../../../core','find','6367734EMmUhe','643689LfxiCZ','Last_Updated_By__c','createZip','41958890rjMscr','FLOSUM_COMMIT_MANIFEST','Last_Modified_Date__c','File_Name__c','prepareCommitManifest','../../parsers/utils/zip','../errors/salesforce.error','getProceededComponentsMeta','username','Committed_On__c','apply','6540560DWihcs','crc','componentId','reference','gitSync','Name','defineProperty','DEFLATE','name','435mtULOg','SalesforceError','insert','createPatchRequest','Branch','createPostRequest','Component_History__c','ContentType','CRC32__c','search','toString'];a177_0x19ad=function(){return _0x5c30de;};return a177_0x19ad();}'use strict';function a177_0x35fa(_0x4ec155,_0x44452c){const _0x596003=a177_0x19ad();return a177_0x35fa=function(_0x457dd8,_0x486088){_0x457dd8=_0x457dd8-0x115;let _0x19adb6=_0x596003[_0x457dd8];return _0x19adb6;},a177_0x35fa(_0x4ec155,_0x44452c);}var __importDefault=this&&this[a177_0x19cac4(0x157)]||function(_0x492e3a){const _0x534702=a177_0x19cac4;return _0x492e3a&&_0x492e3a[_0x534702(0x148)]?_0x492e3a:{'default':_0x492e3a};};Object[a177_0x19cac4(0x11f)](exports,a177_0x19cac4(0x148),{'value':!![]}),exports[a177_0x19cac4(0x135)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a177_0x19cac4(0x16e)),zip_1=require(a177_0x19cac4(0x179)),typedi_1=__importDefault(require(a177_0x19cac4(0x132))),salesforce_error_1=require(a177_0x19cac4(0x17a)),composite_utils_1=require(a177_0x19cac4(0x13d)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a177_0x19cac4(0x160));class SalesforceComponentsManager{constructor(_0x4e32c8,_0x43292b,_0x27a32b,_0x10dc64,_0x8b22db){const _0x541b93=a177_0x19cac4;this[_0x541b93(0x142)]=_0x4e32c8,this['branchId']=_0x43292b,this[_0x541b93(0x116)]=_0x27a32b,this[_0x541b93(0x15d)]=_0x10dc64,this[_0x541b93(0x147)]=_0x8b22db,this['logger']=new core_1[(_0x541b93(0x14c))](SalesforceComponentsManager['name']),this['gitSync']=typedi_1['default'][_0x541b93(0x12d)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a177_0x19cac4(0x140)](_0xdb5a84,_0x17590c){const _0x270975=a177_0x19cac4,_0x272eaf=flosum_naming_utils_1[_0x270975(0x139)](_0xdb5a84,[_0x270975(0x137),_0x270975(0x158),_0x270975(0x161)]);this['proceededComponentsMeta'][_0x270975(0x14d)]({'componentId':'','reference':_0x17590c,'version':_0x272eaf[_0x270975(0x161)],'componentName':_0x272eaf[_0x270975(0x158)],'componentType':_0x272eaf[_0x270975(0x137)]});}['prepareCommitManifest'](_0x140497,_0x2d1d06){const _0x348050=a177_0x19cac4,{request:_0x309ce5}=composite_utils_1[_0x348050(0x127)](constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x348050(0x149)]+_0x348050(0x144)]:_0x140497,[constants_1['FLOSUM_NAMESPACE']+_0x348050(0x128)]:_0x2d1d06});return _0x309ce5;}async[a177_0x19cac4(0x15c)](_0x1bc4ae,_0x3e520e){const _0x484e34=a177_0x19cac4,_0x54253b={},_0x31d137=zip_1[_0x484e34(0x12e)][_0x484e34(0x173)]();for(const _0x4bed99 of Object[_0x484e34(0x16c)](_0x1bc4ae[_0x484e34(0x146)])){_0x31d137['file'](_0x4bed99,_0x1bc4ae[_0x484e34(0x146)][_0x4bed99],{'createFolders':!![]});}return _0x54253b[_0x484e34(0x129)]=_0x484e34(0x169),_0x54253b[_0x484e34(0x11e)]=_0x1bc4ae[_0x484e34(0x159)],_0x54253b['Description']=_0x1bc4ae['type'],_0x54253b['ParentId']=_0x3e520e,_0x54253b[_0x484e34(0x13c)]=await _0x31d137[_0x484e34(0x14f)]({'type':_0x484e34(0x16d),'compression':_0x484e34(0x120),'compressionOptions':{'level':0x6}}),_0x54253b;}[a177_0x19cac4(0x165)](_0x2a34e6,_0x3d382e,_0xddb763){const _0x43d4eb=a177_0x19cac4,_0x27c8b4=new Date()[_0x43d4eb(0x130)](),_0x1bba69={};return _0x1bba69[constants_1[_0x43d4eb(0x149)]+'Component__c']=_0x3d382e,_0x1bba69[constants_1[_0x43d4eb(0x149)]+_0x43d4eb(0x12a)]=_0x2a34e6['crc'],_0x1bba69[constants_1[_0x43d4eb(0x149)]+'Changed_On__c']=_0x27c8b4,_0x1bba69[constants_1[_0x43d4eb(0x149)]+_0x43d4eb(0x151)]=this[_0x43d4eb(0x116)],_0x1bba69[constants_1[_0x43d4eb(0x149)]+_0x43d4eb(0x161)]=_0xddb763?_0xddb763+0x1:0x1,_0x1bba69[constants_1[_0x43d4eb(0x14e)]+'Is_From_Agent__c']=!![],_0x1bba69;}[a177_0x19cac4(0x14b)](_0x57d7fa,_0x3a9620){const _0x549f39=a177_0x19cac4;var _0xa54c9b,_0x5b8741;const _0x4366c1=new Date()[_0x549f39(0x130)](),_0x4f53be={};return!_0x3a9620?(this[_0x549f39(0x14a)]?(_0x4f53be[constants_1[_0x549f39(0x149)]+_0x549f39(0x168)]=this[_0x549f39(0x14a)],_0x4f53be[constants_1[_0x549f39(0x149)]+_0x549f39(0x134)]=_0x549f39(0x126),_0x4f53be[_0x549f39(0x131)]=(_0xa54c9b=this[_0x549f39(0x15d)][_0x549f39(0x16f)](_0x1107f1=>_0x1107f1[_0x549f39(0x121)]===_0x549f39(0x126)))===null||_0xa54c9b===void 0x0?void 0x0:_0xa54c9b['id']):(_0x4f53be[constants_1[_0x549f39(0x149)]+_0x549f39(0x141)]=this[_0x549f39(0x142)],_0x4f53be[constants_1['FLOSUM_NAMESPACE']+_0x549f39(0x134)]='Repository',_0x4f53be[_0x549f39(0x131)]=(_0x5b8741=this[_0x549f39(0x15d)]['find'](_0x17a2fd=>_0x17a2fd['name']===_0x549f39(0x166)))===null||_0x5b8741===void 0x0?void 0x0:_0x5b8741['id']),_0x4f53be[constants_1[_0x549f39(0x149)]+_0x549f39(0x161)]=0x1):_0x4f53be[constants_1[_0x549f39(0x149)]+_0x549f39(0x161)]=_0x3a9620[_0x549f39(0x167)]+0x1,_0x4f53be[constants_1[_0x549f39(0x149)]+_0x549f39(0x137)]=_0x57d7fa[_0x549f39(0x159)],_0x4f53be[constants_1[_0x549f39(0x149)]+_0x549f39(0x158)]=_0x57d7fa[_0x549f39(0x121)],_0x4f53be[constants_1['FLOSUM_NAMESPACE']+_0x549f39(0x177)]=_0x57d7fa[_0x549f39(0x15a)],_0x4f53be[constants_1[_0x549f39(0x149)]+_0x549f39(0x172)]=this['username'],_0x4f53be[constants_1[_0x549f39(0x149)]+_0x549f39(0x15f)]=this[_0x549f39(0x116)],_0x4f53be[constants_1[_0x549f39(0x149)]+_0x549f39(0x176)]=_0x4366c1,_0x4f53be[constants_1[_0x549f39(0x149)]+_0x549f39(0x117)]=_0x4366c1,_0x4f53be[constants_1['FLOSUM_NAMESPACE']+_0x549f39(0x12a)]=_0x57d7fa[_0x549f39(0x11a)],_0x4f53be;}[a177_0x19cac4(0x115)](){const _0x1d2aa0=a177_0x19cac4;return this[_0x1d2aa0(0x147)];}async[a177_0x19cac4(0x124)](_0x3ee965,_0x4bcb99){const _0xbf3872=a177_0x19cac4,_0x163223=[];for(const _0x4fb54d of _0x3ee965){const _0x3f0ecd=composite_utils_1[_0xbf3872(0x127)](constants_1[_0xbf3872(0x164)],this[_0xbf3872(0x14b)](_0x4fb54d)),_0x64322a=composite_utils_1['createPostRequest'](constants_1[_0xbf3872(0x145)],this[_0xbf3872(0x165)](_0x4fb54d,'@{'+_0x3f0ecd[_0xbf3872(0x11c)]+'.id}')),_0x32d407=composite_utils_1[_0xbf3872(0x127)](constants_1[_0xbf3872(0x16b)],await this[_0xbf3872(0x15c)](_0x4fb54d,'@{'+_0x64322a[_0xbf3872(0x11c)]+'.id}'));this[_0xbf3872(0x140)](_0x3f0ecd[_0xbf3872(0x13a)][_0xbf3872(0x138)],_0x3f0ecd[_0xbf3872(0x11c)]),_0x163223[_0xbf3872(0x14d)](_0x3f0ecd[_0xbf3872(0x13a)],_0x64322a[_0xbf3872(0x13a)],_0x32d407['request']),_0x4bcb99&&_0x163223[_0xbf3872(0x14d)](this[_0xbf3872(0x178)](_0x4bcb99,'@{'+_0x64322a['reference']+_0xbf3872(0x13f)));}return _0x163223;}async[a177_0x19cac4(0x152)](_0x3c21f8,_0x1ff57f=''){const _0x35f64e=a177_0x19cac4,_0x4de3d8=[];for(const {component:_0x31c24d,meta:_0x280346}of _0x3c21f8){if(!_0x280346['id']){const _0x442dc9=this[_0x35f64e(0x147)][_0x35f64e(0x16f)](_0x222e01=>_0x222e01['componentName']===_0x31c24d[_0x35f64e(0x121)]&&_0x222e01[_0x35f64e(0x16a)]===_0x31c24d[_0x35f64e(0x159)]);if(!_0x442dc9)throw new salesforce_error_1[(_0x35f64e(0x123))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x31c24d[_0x35f64e(0x121)]+'\x20['+_0x31c24d[_0x35f64e(0x159)]+_0x35f64e(0x136)));_0x280346['id']=_0x442dc9[_0x35f64e(0x11b)];}const _0x2726ad=composite_utils_1['createPatchRequest'](constants_1[_0x35f64e(0x164)],_0x280346['id'],this[_0x35f64e(0x14b)](_0x31c24d,_0x280346)),_0x475509=composite_utils_1[_0x35f64e(0x127)](constants_1[_0x35f64e(0x145)],this[_0x35f64e(0x165)](_0x31c24d,_0x280346['id'],_0x280346[_0x35f64e(0x167)])),_0x3bd9a8=composite_utils_1['createPostRequest'](constants_1['FLOSUM_ATTACHMENT'],await this['prepareComponentAttachmentRecord'](_0x31c24d,'@{'+_0x475509[_0x35f64e(0x11c)]+_0x35f64e(0x13f)));this[_0x35f64e(0x140)](_0x2726ad['request'][_0x35f64e(0x138)],_0x2726ad[_0x35f64e(0x11c)]),_0x4de3d8[_0x35f64e(0x14d)](_0x2726ad[_0x35f64e(0x13a)],_0x475509[_0x35f64e(0x13a)],_0x3bd9a8[_0x35f64e(0x13a)]),_0x1ff57f&&_0x4de3d8['push'](this[_0x35f64e(0x178)](_0x1ff57f,'@{'+_0x475509[_0x35f64e(0x11c)]+'.id}'));}return _0x4de3d8;}async[a177_0x19cac4(0x150)](_0x411226,_0x3230d6=![]){const _0x5a218c=a177_0x19cac4,_0x416122={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x478349=[];for(const _0x2d9cb6 of _0x411226){if(_0x2d9cb6['id'])_0x478349[_0x5a218c(0x14d)](_0x2d9cb6['id']);else{const _0x3f21d4=this['proceededComponentsMeta'][_0x5a218c(0x16f)](_0x3e80d2=>_0x3e80d2[_0x5a218c(0x15b)]===_0x2d9cb6['name']&&_0x3e80d2[_0x5a218c(0x16a)]===_0x2d9cb6[_0x5a218c(0x159)]);if(!_0x3f21d4||!_0x3f21d4[_0x5a218c(0x11b)])continue;_0x478349['push'](_0x3f21d4['componentId']);}}if(_0x3230d6){const _0x4dc014=await this[_0x5a218c(0x11d)]['fetchCommitManifestsByComponentIds'](_0x478349);_0x416122['manifests']=_0x4dc014[_0x5a218c(0x13e)](_0x10a056=>composite_utils_1[_0x5a218c(0x12f)](constants_1[_0x5a218c(0x175)],_0x10a056)[_0x5a218c(0x13a)]);}return _0x416122[_0x5a218c(0x153)]=_0x478349[_0x5a218c(0x13e)](_0x3ecc3f=>composite_utils_1[_0x5a218c(0x125)](constants_1[_0x5a218c(0x164)],_0x3ecc3f,{[constants_1[_0x5a218c(0x14e)]+_0x5a218c(0x162)]:!![]})[_0x5a218c(0x13a)]),_0x416122[_0x5a218c(0x143)]=_0x478349['map'](_0x59dbd9=>composite_utils_1[_0x5a218c(0x12f)](constants_1['FLOSUM_COMPONENT'],_0x59dbd9)['request']),_0x416122;}}exports[a177_0x19cac4(0x135)]=SalesforceComponentsManager;