const a228_0x5e649d=a228_0x18f7;(function(_0x327312,_0x312f31){const _0x2072eb=a228_0x18f7,_0x6fcdab=_0x327312();while(!![]){try{const _0x35500f=-parseInt(_0x2072eb(0x173))/0x1*(parseInt(_0x2072eb(0x148))/0x2)+parseInt(_0x2072eb(0x159))/0x3*(-parseInt(_0x2072eb(0x184))/0x4)+parseInt(_0x2072eb(0x163))/0x5*(parseInt(_0x2072eb(0x147))/0x6)+-parseInt(_0x2072eb(0x152))/0x7*(-parseInt(_0x2072eb(0x19c))/0x8)+-parseInt(_0x2072eb(0x18f))/0x9+-parseInt(_0x2072eb(0x13f))/0xa+-parseInt(_0x2072eb(0x141))/0xb*(-parseInt(_0x2072eb(0x189))/0xc);if(_0x35500f===_0x312f31)break;else _0x6fcdab['push'](_0x6fcdab['shift']());}catch(_0x186e30){_0x6fcdab['push'](_0x6fcdab['shift']());}}}(a228_0x520c,0xadf73));function a228_0x18f7(_0x2997d8,_0x2e48ec){const _0x1350a1=a228_0x520c();return a228_0x18f7=function(_0x2d2b8b,_0x30ab38){_0x2d2b8b=_0x2d2b8b-0x13d;let _0x520c4d=_0x1350a1[_0x2d2b8b];return _0x520c4d;},a228_0x18f7(_0x2997d8,_0x2e48ec);}const a228_0x30ab38=(function(){let _0x7b76f6=!![];return function(_0x1028fc,_0x983bfe){const _0x1531dd=_0x7b76f6?function(){const _0x724830=a228_0x18f7;if(_0x983bfe){const _0x245773=_0x983bfe[_0x724830(0x16f)](_0x1028fc,arguments);return _0x983bfe=null,_0x245773;}}:function(){};return _0x7b76f6=![],_0x1531dd;};}()),a228_0x2d2b8b=a228_0x30ab38(this,function(){const _0x43bed3=a228_0x18f7;return a228_0x2d2b8b[_0x43bed3(0x13d)]()[_0x43bed3(0x172)](_0x43bed3(0x19d))[_0x43bed3(0x13d)]()[_0x43bed3(0x1a0)](a228_0x2d2b8b)[_0x43bed3(0x172)]('(((.+)+)+)+$');});a228_0x2d2b8b();'use strict';var __importDefault=this&&this[a228_0x5e649d(0x196)]||function(_0x2a5f69){return _0x2a5f69&&_0x2a5f69['__esModule']?_0x2a5f69:{'default':_0x2a5f69};};Object[a228_0x5e649d(0x151)](exports,'__esModule',{'value':!![]}),exports[a228_0x5e649d(0x164)]=void 0x0;const constants_1=require(a228_0x5e649d(0x15c)),core_1=require('../../../../core'),zip_1=require(a228_0x5e649d(0x167)),typedi_1=__importDefault(require(a228_0x5e649d(0x198))),salesforce_error_1=require(a228_0x5e649d(0x177)),composite_utils_1=require(a228_0x5e649d(0x19e)),flosum_naming_utils_1=require(a228_0x5e649d(0x178)),salesforce_git_sync_service_1=require(a228_0x5e649d(0x16c));function a228_0x520c(){const _0x4744a1=['Deletion_By_Agent__c','componentId','Component_History__c','../errors/salesforce.error','../utils/flosum-naming.utils','toISOString','get','ContentType','file','manifests','username','createPatchRequest','Component_Type__c','base64',']\x20-\x20meta\x20not\x20found','RecordTypeId','332LzWjyJ','name','createPostRequest','branchId','DEFLATE','12BIXsZg','Component__c','prepareCommitManifest','Logger','reference','fetchCommitManifestsByComponentIds','1316367WjbTct','Last_Modified_Date__c','Commit__c','insert','Changed_By__c','CRC32__c','repositoryId','__importDefault','proceededComponentsMeta','typedi','FLOSUM_NAMESPACE','Branch','componentType','487848BWibAb','(((.+)+)+)+$','../utils/composite.utils','FLOSUM_COMPONENT_HISTORY','constructor','version','toString','request','10014860QNVbTZ','Last_Modified_By__c','16505401fvzUJY','Version__c','map','Name','files','find','54156wtTmDi','338RBXYea','Changed_On__c','SalesforceError','componentsToUpdate','gitSync','FLOSUM_ATTACHMENT','Zip','FLOSUM_GIT_NAMESPACE','body','defineProperty','133OmbRMU','FLOSUM_COMMIT_MANIFEST','componentName','Repository','.id}','createDeleteRequest','application/zip','49341bZkZfw','Body','Component_Name__c','../../../../constants','delete','push','createZip','crc','type','proceedComponentMeta','475XpLeyp','SalesforceComponentsManager','Is_From_Agent__c','prepareComponentAttachmentRecord','../../parsers/utils/zip','recordTypes','prepareComponentHistoryRecord','generateAsync','componentsToDelete','./salesforce-git-sync.service','prepareComponentRecord','Committed_On__c','apply','getProceededComponentsMeta','FLOSUM_COMPONENT','search','1723GlnjBp'];a228_0x520c=function(){return _0x4744a1;};return a228_0x520c();}class SalesforceComponentsManager{constructor(_0x39a47f,_0x24ba9f,_0x28a07a,_0x12f2be,_0x3ddf10){const _0x1d3236=a228_0x5e649d;this[_0x1d3236(0x195)]=_0x39a47f,this[_0x1d3236(0x187)]=_0x24ba9f,this[_0x1d3236(0x17e)]=_0x28a07a,this[_0x1d3236(0x168)]=_0x12f2be,this[_0x1d3236(0x197)]=_0x3ddf10,this['logger']=new core_1[(_0x1d3236(0x18c))](SalesforceComponentsManager[_0x1d3236(0x185)]),this[_0x1d3236(0x14c)]=typedi_1['default'][_0x1d3236(0x17a)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a228_0x5e649d(0x162)](_0x1547d4,_0x2172e3){const _0x4c0737=a228_0x5e649d,_0x1b15c3=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x1547d4,[_0x4c0737(0x180),'Component_Name__c',_0x4c0737(0x142)]);this[_0x4c0737(0x197)][_0x4c0737(0x15e)]({'componentId':'','reference':_0x2172e3,'version':_0x1b15c3[_0x4c0737(0x142)],'componentName':_0x1b15c3['Component_Name__c'],'componentType':_0x1b15c3[_0x4c0737(0x180)]});}[a228_0x5e649d(0x18b)](_0x2d24ad,_0x47b595){const _0x569d4a=a228_0x5e649d,{request:_0xcd93af}=(0x0,composite_utils_1[_0x569d4a(0x186)])(constants_1[_0x569d4a(0x153)],{[constants_1['FLOSUM_NAMESPACE']+_0x569d4a(0x191)]:_0x2d24ad,[constants_1[_0x569d4a(0x199)]+_0x569d4a(0x176)]:_0x47b595});return _0xcd93af;}async[a228_0x5e649d(0x166)](_0x38bd35,_0x47b008){const _0x16cfa4=a228_0x5e649d,_0x1266e7={},_0x300ebc=zip_1[_0x16cfa4(0x14e)][_0x16cfa4(0x15f)]();for(const _0x3e30e6 of Object['keys'](_0x38bd35[_0x16cfa4(0x145)])){_0x300ebc[_0x16cfa4(0x17c)](_0x3e30e6,_0x38bd35[_0x16cfa4(0x145)][_0x3e30e6],{'createFolders':!![]});}return _0x1266e7[_0x16cfa4(0x17b)]=_0x16cfa4(0x158),_0x1266e7[_0x16cfa4(0x144)]=_0x38bd35[_0x16cfa4(0x161)],_0x1266e7['Description']=_0x38bd35[_0x16cfa4(0x161)],_0x1266e7['ParentId']=_0x47b008,_0x1266e7[_0x16cfa4(0x15a)]=await _0x300ebc[_0x16cfa4(0x16a)]({'type':_0x16cfa4(0x181),'compression':_0x16cfa4(0x188),'compressionOptions':{'level':0x6}}),_0x1266e7;}[a228_0x5e649d(0x169)](_0x2702a1,_0x1a0602,_0x271ce7){const _0x1d7ab6=a228_0x5e649d,_0x4a660f=new Date()[_0x1d7ab6(0x179)](),_0x3e6706={};return _0x3e6706[constants_1[_0x1d7ab6(0x199)]+_0x1d7ab6(0x18a)]=_0x1a0602,_0x3e6706[constants_1[_0x1d7ab6(0x199)]+_0x1d7ab6(0x194)]=_0x2702a1[_0x1d7ab6(0x160)],_0x3e6706[constants_1[_0x1d7ab6(0x199)]+_0x1d7ab6(0x149)]=_0x4a660f,_0x3e6706[constants_1[_0x1d7ab6(0x199)]+_0x1d7ab6(0x193)]=this[_0x1d7ab6(0x17e)],_0x3e6706[constants_1['FLOSUM_NAMESPACE']+'Version__c']=_0x271ce7?_0x271ce7+0x1:0x1,_0x3e6706[constants_1[_0x1d7ab6(0x14f)]+_0x1d7ab6(0x165)]=!![],_0x3e6706;}['prepareComponentRecord'](_0x342241,_0x4db901){const _0x5672c3=a228_0x5e649d;var _0x2ba92a,_0x58cbf6;const _0x12c658=new Date()['toISOString'](),_0x106824={};return!_0x4db901?(this['branchId']?(_0x106824[constants_1[_0x5672c3(0x199)]+'Branch__c']=this[_0x5672c3(0x187)],_0x106824[constants_1[_0x5672c3(0x199)]+'Source__c']=_0x5672c3(0x19a),_0x106824[_0x5672c3(0x183)]=(_0x2ba92a=this['recordTypes'][_0x5672c3(0x146)](_0x5567bb=>_0x5567bb[_0x5672c3(0x185)]===_0x5672c3(0x19a)))===null||_0x2ba92a===void 0x0?void 0x0:_0x2ba92a['id']):(_0x106824[constants_1['FLOSUM_NAMESPACE']+'Repository__c']=this['repositoryId'],_0x106824[constants_1[_0x5672c3(0x199)]+'Source__c']=_0x5672c3(0x155),_0x106824[_0x5672c3(0x183)]=(_0x58cbf6=this[_0x5672c3(0x168)][_0x5672c3(0x146)](_0xde5a37=>_0xde5a37[_0x5672c3(0x185)]===_0x5672c3(0x155)))===null||_0x58cbf6===void 0x0?void 0x0:_0x58cbf6['id']),_0x106824[constants_1[_0x5672c3(0x199)]+_0x5672c3(0x142)]=0x1):_0x106824[constants_1[_0x5672c3(0x199)]+_0x5672c3(0x142)]=_0x4db901['version']+0x1,_0x106824[constants_1['FLOSUM_NAMESPACE']+'Component_Type__c']=_0x342241[_0x5672c3(0x161)],_0x106824[constants_1[_0x5672c3(0x199)]+_0x5672c3(0x15b)]=_0x342241['name'],_0x106824[constants_1[_0x5672c3(0x199)]+'File_Name__c']=_0x342241['filePath'],_0x106824[constants_1[_0x5672c3(0x199)]+'Last_Updated_By__c']=this[_0x5672c3(0x17e)],_0x106824[constants_1[_0x5672c3(0x199)]+_0x5672c3(0x140)]=this['username'],_0x106824[constants_1['FLOSUM_NAMESPACE']+_0x5672c3(0x190)]=_0x12c658,_0x106824[constants_1[_0x5672c3(0x199)]+_0x5672c3(0x16e)]=_0x12c658,_0x106824[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x342241['crc'],_0x106824;}[a228_0x5e649d(0x170)](){const _0x52323e=a228_0x5e649d;return this[_0x52323e(0x197)];}async[a228_0x5e649d(0x192)](_0x41a153,_0x221c38){const _0x49af69=a228_0x5e649d,_0xd37b8e=[];for(const _0x3b42fc of _0x41a153){const _0x3e130a=(0x0,composite_utils_1[_0x49af69(0x186)])(constants_1[_0x49af69(0x171)],this[_0x49af69(0x16d)](_0x3b42fc)),_0x2bc63e=(0x0,composite_utils_1[_0x49af69(0x186)])(constants_1[_0x49af69(0x19f)],this['prepareComponentHistoryRecord'](_0x3b42fc,'@{'+_0x3e130a[_0x49af69(0x18d)]+_0x49af69(0x156))),_0x3e664a=(0x0,composite_utils_1[_0x49af69(0x186)])(constants_1[_0x49af69(0x14d)],await this[_0x49af69(0x166)](_0x3b42fc,'@{'+_0x2bc63e[_0x49af69(0x18d)]+_0x49af69(0x156)));this[_0x49af69(0x162)](_0x3e130a['request'][_0x49af69(0x150)],_0x3e130a[_0x49af69(0x18d)]),_0xd37b8e[_0x49af69(0x15e)](_0x3e130a[_0x49af69(0x13e)],_0x2bc63e[_0x49af69(0x13e)],_0x3e664a['request']),_0x221c38&&_0xd37b8e['push'](this[_0x49af69(0x18b)](_0x221c38,'@{'+_0x2bc63e[_0x49af69(0x18d)]+_0x49af69(0x156)));}return _0xd37b8e;}async['update'](_0x19229a,_0x14b22c=''){const _0x3e58b8=a228_0x5e649d,_0x2081b3=[];for(const {component:_0x1baece,meta:_0x5ea0e6}of _0x19229a){if(!_0x5ea0e6['id']){const _0xcd547f=this[_0x3e58b8(0x197)]['find'](_0x1de83a=>_0x1de83a['componentName']===_0x1baece[_0x3e58b8(0x185)]&&_0x1de83a[_0x3e58b8(0x19b)]===_0x1baece[_0x3e58b8(0x161)]);if(!_0xcd547f)throw new salesforce_error_1[(_0x3e58b8(0x14a))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x1baece[_0x3e58b8(0x185)]+'\x20['+_0x1baece[_0x3e58b8(0x161)]+_0x3e58b8(0x182)));_0x5ea0e6['id']=_0xcd547f[_0x3e58b8(0x175)];}const _0x280a6a=(0x0,composite_utils_1[_0x3e58b8(0x17f)])(constants_1[_0x3e58b8(0x171)],_0x5ea0e6['id'],this[_0x3e58b8(0x16d)](_0x1baece,_0x5ea0e6)),_0x2d0cec=(0x0,composite_utils_1[_0x3e58b8(0x186)])(constants_1[_0x3e58b8(0x19f)],this[_0x3e58b8(0x169)](_0x1baece,_0x5ea0e6['id'],_0x5ea0e6[_0x3e58b8(0x1a1)])),_0xd63dd2=(0x0,composite_utils_1[_0x3e58b8(0x186)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x3e58b8(0x166)](_0x1baece,'@{'+_0x2d0cec['reference']+_0x3e58b8(0x156)));this[_0x3e58b8(0x162)](_0x280a6a[_0x3e58b8(0x13e)]['body'],_0x280a6a[_0x3e58b8(0x18d)]),_0x2081b3[_0x3e58b8(0x15e)](_0x280a6a[_0x3e58b8(0x13e)],_0x2d0cec[_0x3e58b8(0x13e)],_0xd63dd2[_0x3e58b8(0x13e)]),_0x14b22c&&_0x2081b3[_0x3e58b8(0x15e)](this[_0x3e58b8(0x18b)](_0x14b22c,'@{'+_0x2d0cec['reference']+'.id}'));}return _0x2081b3;}async[a228_0x5e649d(0x15d)](_0x1f184f,_0x435045=![]){const _0x461822=a228_0x5e649d,_0xc59fe1={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x13424a=[];for(const _0x49dfcf of _0x1f184f){if(_0x49dfcf['id'])_0x13424a[_0x461822(0x15e)](_0x49dfcf['id']);else{const _0xbbdf5e=this['proceededComponentsMeta']['find'](_0x63e795=>_0x63e795[_0x461822(0x154)]===_0x49dfcf[_0x461822(0x185)]&&_0x63e795['componentType']===_0x49dfcf['type']);if(!_0xbbdf5e||!_0xbbdf5e['componentId'])continue;_0x13424a[_0x461822(0x15e)](_0xbbdf5e[_0x461822(0x175)]);}}if(_0x435045){const _0x3020bd=await this['gitSync'][_0x461822(0x18e)](_0x13424a);_0xc59fe1[_0x461822(0x17d)]=_0x3020bd[_0x461822(0x143)](_0x396b0f=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x461822(0x153)],_0x396b0f)[_0x461822(0x13e)]);}return _0xc59fe1[_0x461822(0x14b)]=_0x13424a[_0x461822(0x143)](_0x30b4f7=>(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x461822(0x171)],_0x30b4f7,{[constants_1[_0x461822(0x14f)]+_0x461822(0x174)]:!![]})[_0x461822(0x13e)]),_0xc59fe1[_0x461822(0x16b)]=_0x13424a['map'](_0x29ee4d=>(0x0,composite_utils_1[_0x461822(0x157)])(constants_1['FLOSUM_COMPONENT'],_0x29ee4d)[_0x461822(0x13e)]),_0xc59fe1;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;