const a260_0x2bbe39=a260_0x9e48;(function(_0x4c1a23,_0x181c1f){const _0x1166d7=a260_0x9e48,_0x26710f=_0x4c1a23();while(!![]){try{const _0x1bee27=-parseInt(_0x1166d7(0x132))/0x1+parseInt(_0x1166d7(0xfc))/0x2+parseInt(_0x1166d7(0x129))/0x3+-parseInt(_0x1166d7(0x14c))/0x4+-parseInt(_0x1166d7(0x148))/0x5+parseInt(_0x1166d7(0x114))/0x6*(-parseInt(_0x1166d7(0x10b))/0x7)+parseInt(_0x1166d7(0x140))/0x8;if(_0x1bee27===_0x181c1f)break;else _0x26710f['push'](_0x26710f['shift']());}catch(_0x95c625){_0x26710f['push'](_0x26710f['shift']());}}}(a260_0x5901,0x5d8d0));const a260_0x2f2681=(function(){let _0x494eee=!![];return function(_0x47243e,_0x396760){const _0x198243=_0x494eee?function(){const _0x14f1bd=a260_0x9e48;if(_0x396760){const _0x473806=_0x396760[_0x14f1bd(0xfe)](_0x47243e,arguments);return _0x396760=null,_0x473806;}}:function(){};return _0x494eee=![],_0x198243;};}()),a260_0x10911e=a260_0x2f2681(this,function(){const _0x2f1fd1=a260_0x9e48;return a260_0x10911e[_0x2f1fd1(0x11c)]()['search'](_0x2f1fd1(0x157))['toString']()[_0x2f1fd1(0x150)](a260_0x10911e)[_0x2f1fd1(0x10c)](_0x2f1fd1(0x157));});function a260_0x5901(){const _0x4e5ba4=['push','ContentType','(((.+)+)+)+$','type','SalesforceComponentsManager','componentsToUpdate','gitSync','FLOSUM_GIT_NAMESPACE','RecordTypeId','FLOSUM_COMPONENT_HISTORY','Repository','find','../utils/composite.utils','1444422NOBOFb','Component_Name__c','apply','vlocityComponentName','FLOSUM_COMPONENT','Is_From_Agent__c','insert','typedi','marketingCloudKey','Last_Updated_By__c','.id}','componentName','../../../../constants','proceedComponentMeta','createDeleteRequest','4605517gIFYwC','search','update','CRC32__c','componentType','Description','keys','recordTypes','Vlocity_Component__c','6aiyCTb','Changed_By__c','Branch','repositoryId','crc','Repository__c','ParentId','createZip','toString','reference',']\x20-\x20meta\x20not\x20found','base64','Source__c','default','prepareComponentAttachmentRecord','FLOSUM_NAMESPACE','Last_Modified_Date__c','map','fetchCommitManifestsByComponentIds','Name','Deletion_By_Agent__c','1487805gyEQbQ','files','FLOSUM_ATTACHMENT','toISOString','branchId','Last_Modified_By__c','Committed_On__c','componentId','Component__c','438230KVMZlq','Component_Type__c','createPostRequest','body','prepareCommitManifest','Version__c','proceededComponentsMeta','prepareComponentRecord','getProceededComponentsMeta','createPatchRequest','__esModule','name','../utils/flosum-naming.utils','../errors/salesforce.error','12037416BeHFrj','Could\x20not\x20proceed\x20component\x20','SalesforceGitSyncService','Body','SalesforceError','delete','defineProperty','isVlocityComponent','3140365dlgqkw','logger','prepareComponentHistoryRecord','../../parsers/utils/zip','2461620SVpKtg','request','__importDefault','username','constructor','application/zip','File_Name__c','../../../../core','version'];a260_0x5901=function(){return _0x4e5ba4;};return a260_0x5901();}a260_0x10911e();'use strict';var __importDefault=this&&this[a260_0x2bbe39(0x14e)]||function(_0x462952){return _0x462952&&_0x462952['__esModule']?_0x462952:{'default':_0x462952};};Object[a260_0x2bbe39(0x146)](exports,a260_0x2bbe39(0x13c),{'value':!![]}),exports[a260_0x2bbe39(0xf3)]=void 0x0;function a260_0x9e48(_0x467483,_0x650c2f){const _0x48ca74=a260_0x5901();return a260_0x9e48=function(_0x10911e,_0x2f2681){_0x10911e=_0x10911e-0xf2;let _0x5901f0=_0x48ca74[_0x10911e];return _0x5901f0;},a260_0x9e48(_0x467483,_0x650c2f);}const constants_1=require(a260_0x2bbe39(0x108)),core_1=require(a260_0x2bbe39(0x153)),zip_1=require(a260_0x2bbe39(0x14b)),typedi_1=__importDefault(require(a260_0x2bbe39(0x103))),salesforce_error_1=require(a260_0x2bbe39(0x13f)),composite_utils_1=require(a260_0x2bbe39(0xfb)),flosum_naming_utils_1=require(a260_0x2bbe39(0x13e)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x39937d,_0x196437,_0x584416,_0x7be6f3,_0x317a94){const _0x48c9bd=a260_0x2bbe39;this[_0x48c9bd(0x117)]=_0x39937d,this[_0x48c9bd(0x12d)]=_0x196437,this['username']=_0x584416,this['recordTypes']=_0x7be6f3,this[_0x48c9bd(0x138)]=_0x317a94,this[_0x48c9bd(0x149)]=new core_1['Logger'](SalesforceComponentsManager['name']),this[_0x48c9bd(0xf5)]=typedi_1[_0x48c9bd(0x121)]['get'](salesforce_git_sync_service_1[_0x48c9bd(0x142)]);}[a260_0x2bbe39(0x109)](_0x4cebf5,_0x410732){const _0x48958c=a260_0x2bbe39,_0x258abb=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x4cebf5,[_0x48958c(0x133),_0x48958c(0xfd),'Version__c']);this[_0x48958c(0x138)][_0x48958c(0x155)]({'componentId':'','reference':_0x410732,'version':_0x258abb['Version__c'],'componentName':_0x258abb[_0x48958c(0xfd)],'componentType':_0x258abb[_0x48958c(0x133)]});}[a260_0x2bbe39(0x136)](_0x2df33b,_0x1b6285){const _0x10d8d1=a260_0x2bbe39,{request:_0x1d8d8c}=(0x0,composite_utils_1[_0x10d8d1(0x134)])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x10d8d1(0x123)]+'Commit__c']:_0x2df33b,[constants_1[_0x10d8d1(0x123)]+'Component_History__c']:_0x1b6285});return _0x1d8d8c;}async[a260_0x2bbe39(0x122)](_0x52648b,_0x22a8e6){const _0x49fc38=a260_0x2bbe39,_0x2e6dec={},_0x1ec1a4=zip_1['Zip'][_0x49fc38(0x11b)]();for(const _0x3a280b of Object[_0x49fc38(0x111)](_0x52648b[_0x49fc38(0x12a)])){_0x1ec1a4['file'](_0x3a280b,_0x52648b['files'][_0x3a280b],{'createFolders':!![]});}return _0x2e6dec[_0x49fc38(0x156)]=_0x49fc38(0x151),_0x2e6dec[_0x49fc38(0x127)]=_0x52648b[_0x49fc38(0xf2)],_0x2e6dec[_0x49fc38(0x110)]=_0x52648b[_0x49fc38(0xf2)],_0x2e6dec[_0x49fc38(0x11a)]=_0x22a8e6,_0x2e6dec[_0x49fc38(0x143)]=await _0x1ec1a4['generateAsync']({'type':_0x49fc38(0x11f),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x2e6dec;}[a260_0x2bbe39(0x14a)](_0x285352,_0x4955da,_0x394b84){const _0x39deea=a260_0x2bbe39,_0x20b443=new Date()[_0x39deea(0x12c)](),_0x5a37f9={};return _0x5a37f9[constants_1[_0x39deea(0x123)]+_0x39deea(0x131)]=_0x4955da,_0x5a37f9[constants_1[_0x39deea(0x123)]+_0x39deea(0x10e)]=_0x285352[_0x39deea(0x118)],_0x5a37f9[constants_1[_0x39deea(0x123)]+'Changed_On__c']=_0x20b443,_0x5a37f9[constants_1[_0x39deea(0x123)]+_0x39deea(0x115)]=this[_0x39deea(0x14f)],_0x5a37f9[constants_1[_0x39deea(0x123)]+'Version__c']=_0x394b84?_0x394b84+0x1:0x1,_0x5a37f9[constants_1[_0x39deea(0xf6)]+_0x39deea(0x101)]=!![],_0x5a37f9;}[a260_0x2bbe39(0x139)](_0x5144ea,_0x3b413e){const _0x36563d=a260_0x2bbe39;var _0x1369cb,_0x3f1e13;const _0x48dbfb=new Date()[_0x36563d(0x12c)](),_0x232d6b={};return!_0x3b413e?(this[_0x36563d(0x12d)]?(_0x232d6b[constants_1['FLOSUM_NAMESPACE']+'Branch__c']=this[_0x36563d(0x12d)],_0x232d6b[constants_1[_0x36563d(0x123)]+_0x36563d(0x120)]=_0x36563d(0x116),_0x232d6b[_0x36563d(0xf7)]=(_0x1369cb=this[_0x36563d(0x112)][_0x36563d(0xfa)](_0x3f5153=>_0x3f5153[_0x36563d(0x13d)]===_0x36563d(0x116)))===null||_0x1369cb===void 0x0?void 0x0:_0x1369cb['id']):(_0x232d6b[constants_1[_0x36563d(0x123)]+_0x36563d(0x119)]=this[_0x36563d(0x117)],_0x232d6b[constants_1[_0x36563d(0x123)]+_0x36563d(0x120)]=_0x36563d(0xf9),_0x232d6b[_0x36563d(0xf7)]=(_0x3f1e13=this[_0x36563d(0x112)][_0x36563d(0xfa)](_0xc012bb=>_0xc012bb['name']===_0x36563d(0xf9)))===null||_0x3f1e13===void 0x0?void 0x0:_0x3f1e13['id']),_0x232d6b[constants_1[_0x36563d(0x123)]+_0x36563d(0x137)]=0x1):_0x232d6b[constants_1[_0x36563d(0x123)]+_0x36563d(0x137)]=_0x3b413e[_0x36563d(0x154)]+0x1,_0x232d6b[constants_1[_0x36563d(0x123)]+_0x36563d(0x133)]=_0x5144ea[_0x36563d(0xf2)],_0x232d6b[constants_1['FLOSUM_NAMESPACE']+'Component_Name__c']=_0x5144ea[_0x36563d(0x13d)],_0x232d6b[constants_1[_0x36563d(0x123)]+_0x36563d(0x152)]=_0x5144ea['filePath'],_0x232d6b[constants_1[_0x36563d(0x123)]+_0x36563d(0x105)]=this[_0x36563d(0x14f)],_0x232d6b[constants_1[_0x36563d(0x123)]+_0x36563d(0x12e)]=this['username'],_0x232d6b[constants_1[_0x36563d(0x123)]+_0x36563d(0x124)]=_0x48dbfb,_0x232d6b[constants_1[_0x36563d(0x123)]+_0x36563d(0x12f)]=_0x48dbfb,_0x232d6b[constants_1['FLOSUM_NAMESPACE']+_0x36563d(0x10e)]=_0x5144ea['crc'],_0x232d6b[constants_1['FLOSUM_NAMESPACE']+'Vlocity_Component_Name__c']=_0x5144ea[_0x36563d(0xff)],_0x232d6b[constants_1['FLOSUM_NAMESPACE']+_0x36563d(0x113)]=_0x5144ea[_0x36563d(0x147)],_0x232d6b[constants_1[_0x36563d(0x123)]+'MC_Key__c']=_0x5144ea[_0x36563d(0x104)],_0x232d6b;}[a260_0x2bbe39(0x13a)](){const _0x17173c=a260_0x2bbe39;return this[_0x17173c(0x138)];}async[a260_0x2bbe39(0x102)](_0x55d061,_0x3325fc){const _0x282540=a260_0x2bbe39,_0x31b11f=[];for(const _0x4d279a of _0x55d061){const _0x5229e6=(0x0,composite_utils_1[_0x282540(0x134)])(constants_1[_0x282540(0x100)],this['prepareComponentRecord'](_0x4d279a)),_0x3dddb2=(0x0,composite_utils_1[_0x282540(0x134)])(constants_1[_0x282540(0xf8)],this['prepareComponentHistoryRecord'](_0x4d279a,'@{'+_0x5229e6[_0x282540(0x11d)]+_0x282540(0x106))),_0x5d981d=(0x0,composite_utils_1[_0x282540(0x134)])(constants_1[_0x282540(0x12b)],await this[_0x282540(0x122)](_0x4d279a,'@{'+_0x3dddb2['reference']+_0x282540(0x106)));this[_0x282540(0x109)](_0x5229e6[_0x282540(0x14d)][_0x282540(0x135)],_0x5229e6[_0x282540(0x11d)]),_0x31b11f[_0x282540(0x155)](_0x5229e6[_0x282540(0x14d)],_0x3dddb2[_0x282540(0x14d)],_0x5d981d[_0x282540(0x14d)]),_0x3325fc&&_0x31b11f[_0x282540(0x155)](this[_0x282540(0x136)](_0x3325fc,'@{'+_0x3dddb2[_0x282540(0x11d)]+_0x282540(0x106)));}return _0x31b11f;}async[a260_0x2bbe39(0x10d)](_0x31d847,_0x2e7615=''){const _0x545b00=a260_0x2bbe39,_0x19971c=[];for(const {component:_0x263761,meta:_0x27f7cb}of _0x31d847){if(!_0x27f7cb['id']){const _0x577f63=this[_0x545b00(0x138)]['find'](_0x3f1e94=>_0x3f1e94['componentName']===_0x263761[_0x545b00(0x13d)]&&_0x3f1e94[_0x545b00(0x10f)]===_0x263761[_0x545b00(0xf2)]);if(!_0x577f63)throw new salesforce_error_1[(_0x545b00(0x144))](new Error(_0x545b00(0x141)+_0x263761[_0x545b00(0x13d)]+'\x20['+_0x263761[_0x545b00(0xf2)]+_0x545b00(0x11e)));_0x27f7cb['id']=_0x577f63[_0x545b00(0x130)];}const _0x1f65f9=(0x0,composite_utils_1[_0x545b00(0x13b)])(constants_1[_0x545b00(0x100)],_0x27f7cb['id'],this['prepareComponentRecord'](_0x263761,_0x27f7cb)),_0x25f666=(0x0,composite_utils_1[_0x545b00(0x134)])(constants_1[_0x545b00(0xf8)],this[_0x545b00(0x14a)](_0x263761,_0x27f7cb['id'],_0x27f7cb[_0x545b00(0x154)])),_0xa6bd4f=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x545b00(0x12b)],await this[_0x545b00(0x122)](_0x263761,'@{'+_0x25f666['reference']+_0x545b00(0x106)));this['proceedComponentMeta'](_0x1f65f9[_0x545b00(0x14d)]['body'],_0x1f65f9[_0x545b00(0x11d)]),_0x19971c['push'](_0x1f65f9[_0x545b00(0x14d)],_0x25f666[_0x545b00(0x14d)],_0xa6bd4f[_0x545b00(0x14d)]),_0x2e7615&&_0x19971c['push'](this[_0x545b00(0x136)](_0x2e7615,'@{'+_0x25f666[_0x545b00(0x11d)]+_0x545b00(0x106)));}return _0x19971c;}async[a260_0x2bbe39(0x145)](_0x4fb064,_0x979dd9=![]){const _0x16d05e=a260_0x2bbe39,_0x30acd={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x27bcfe=[];for(const _0x103b89 of _0x4fb064){if(_0x103b89['id'])_0x27bcfe[_0x16d05e(0x155)](_0x103b89['id']);else{const _0xfa9885=this[_0x16d05e(0x138)][_0x16d05e(0xfa)](_0x516504=>_0x516504[_0x16d05e(0x107)]===_0x103b89[_0x16d05e(0x13d)]&&_0x516504['componentType']===_0x103b89[_0x16d05e(0xf2)]);if(!_0xfa9885||!_0xfa9885[_0x16d05e(0x130)])continue;_0x27bcfe[_0x16d05e(0x155)](_0xfa9885['componentId']);}}if(_0x979dd9){const _0x2fe8a2=await this[_0x16d05e(0xf5)][_0x16d05e(0x126)](_0x27bcfe);_0x30acd['manifests']=_0x2fe8a2[_0x16d05e(0x125)](_0x5a4bcd=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x5a4bcd)[_0x16d05e(0x14d)]);}return _0x30acd[_0x16d05e(0xf4)]=_0x27bcfe[_0x16d05e(0x125)](_0xa81812=>(0x0,composite_utils_1[_0x16d05e(0x13b)])(constants_1[_0x16d05e(0x100)],_0xa81812,{[constants_1[_0x16d05e(0xf6)]+_0x16d05e(0x128)]:!![]})[_0x16d05e(0x14d)]),_0x30acd['componentsToDelete']=_0x27bcfe[_0x16d05e(0x125)](_0x89cad1=>(0x0,composite_utils_1[_0x16d05e(0x10a)])(constants_1[_0x16d05e(0x100)],_0x89cad1)['request']),_0x30acd;}}exports[a260_0x2bbe39(0xf3)]=SalesforceComponentsManager;