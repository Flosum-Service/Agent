const a261_0x268529=a261_0x2c47;(function(_0x3f78c8,_0x55209b){const _0x3dbcf7=a261_0x2c47,_0x325307=_0x3f78c8();while(!![]){try{const _0x551657=-parseInt(_0x3dbcf7(0x228))/0x1*(parseInt(_0x3dbcf7(0x1ea))/0x2)+parseInt(_0x3dbcf7(0x1ee))/0x3*(-parseInt(_0x3dbcf7(0x213))/0x4)+-parseInt(_0x3dbcf7(0x20b))/0x5+-parseInt(_0x3dbcf7(0x1d0))/0x6+parseInt(_0x3dbcf7(0x219))/0x7+-parseInt(_0x3dbcf7(0x201))/0x8*(-parseInt(_0x3dbcf7(0x1dd))/0x9)+-parseInt(_0x3dbcf7(0x229))/0xa*(-parseInt(_0x3dbcf7(0x211))/0xb);if(_0x551657===_0x55209b)break;else _0x325307['push'](_0x325307['shift']());}catch(_0x2aa855){_0x325307['push'](_0x325307['shift']());}}}(a261_0x5c1e,0x711bd));const a261_0x506349=(function(){let _0x3a5911=!![];return function(_0x2da492,_0x51e15a){const _0x50c137=_0x3a5911?function(){const _0x4558b0=a261_0x2c47;if(_0x51e15a){const _0x5f47e7=_0x51e15a[_0x4558b0(0x1e1)](_0x2da492,arguments);return _0x51e15a=null,_0x5f47e7;}}:function(){};return _0x3a5911=![],_0x50c137;};}()),a261_0x22ced8=a261_0x506349(this,function(){const _0x26489a=a261_0x2c47;return a261_0x22ced8[_0x26489a(0x1ca)]()[_0x26489a(0x1f2)](_0x26489a(0x1f1))[_0x26489a(0x1ca)]()[_0x26489a(0x21c)](a261_0x22ced8)['search']('(((.+)+)+)+$');});a261_0x22ced8();function a261_0x5c1e(){const _0x4c4543=['18171nFYcoW','keys','createZip','manifests','apply','createPatchRequest','RecordTypeId','prepareComponentHistoryRecord','Repository','isVlocityComponent','Is_From_Agent__c','DEFLATE','Branch','537578oVelpF','componentName','Last_Modified_By__c','proceedComponentMeta','21PxwCPr','base64','Logger','(((.+)+)+)+$','search','map','SalesforceGitSyncService','vlocityComponentName','createPostRequest','reference','request','push','__esModule','repositoryId','generateAsync','FLOSUM_ATTACHMENT','name','Last_Modified_Date__c','SalesforceComponentsManager','2776lEgetg','body','defineProperty','Vlocity_Component__c','Changed_On__c','../../../../core','delete','../errors/salesforce.error','find','ParentId','2944010KZOPoM','prepareCommitManifest','FLOSUM_COMPONENT','username','Component_Type__c','Version__c','16643hRQdnA','type','346916EtDych','gitSync','Repository__c','SalesforceError','marketingCloudKey','insert','4665640GtFQwf','componentId','files','constructor','prepareComponentAttachmentRecord','crc',']\x20-\x20meta\x20not\x20found','Could\x20not\x20proceed\x20component\x20','getProceededComponentsMeta','Branch__c','../utils/composite.utils','extractFieldsFromRecord','componentsToUpdate','FLOSUM_GIT_NAMESPACE','recordTypes','1LZKCzG','9530JdebCh','createDeleteRequest','logger','FLOSUM_COMMIT_MANIFEST','./salesforce-git-sync.service','file','ContentType','Component_History__c','toISOString','toString','FLOSUM_NAMESPACE','componentType','.id}','CRC32__c','proceededComponentsMeta','5286090acPGgc','version','application/zip','MC_Key__c','branchId','prepareComponentRecord','Component_Name__c','Source__c','Component__c','Vlocity_Component_Name__c','default','Changed_By__c','Name'];a261_0x5c1e=function(){return _0x4c4543;};return a261_0x5c1e();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x13ea35){const _0x4c347d=a261_0x2c47;return _0x13ea35&&_0x13ea35[_0x4c347d(0x1fa)]?_0x13ea35:{'default':_0x13ea35};};Object[a261_0x268529(0x203)](exports,'__esModule',{'value':!![]}),exports[a261_0x268529(0x200)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a261_0x268529(0x206)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a261_0x268529(0x208)),composite_utils_1=require(a261_0x268529(0x223)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a261_0x268529(0x1c5));function a261_0x2c47(_0x5d5aec,_0x229f59){const _0x229183=a261_0x5c1e();return a261_0x2c47=function(_0x22ced8,_0x506349){_0x22ced8=_0x22ced8-0x1c2;let _0x5c1e00=_0x229183[_0x22ced8];return _0x5c1e00;},a261_0x2c47(_0x5d5aec,_0x229f59);}class SalesforceComponentsManager{constructor(_0x4274f9,_0x366c30,_0x24af5a,_0x31f300,_0x8335e6){const _0x487097=a261_0x268529;this[_0x487097(0x1fb)]=_0x4274f9,this[_0x487097(0x1d4)]=_0x366c30,this[_0x487097(0x20e)]=_0x24af5a,this[_0x487097(0x227)]=_0x31f300,this[_0x487097(0x1cf)]=_0x8335e6,this[_0x487097(0x1c3)]=new core_1[(_0x487097(0x1f0))](SalesforceComponentsManager[_0x487097(0x1fe)]),this[_0x487097(0x214)]=typedi_1[_0x487097(0x1da)]['get'](salesforce_git_sync_service_1[_0x487097(0x1f4)]);}[a261_0x268529(0x1ed)](_0x2baff0,_0x1a06b8){const _0x4cd5d8=a261_0x268529,_0x2c3ed8=(0x0,flosum_naming_utils_1[_0x4cd5d8(0x224)])(_0x2baff0,['Component_Type__c',_0x4cd5d8(0x1d6),_0x4cd5d8(0x210)]);this[_0x4cd5d8(0x1cf)][_0x4cd5d8(0x1f9)]({'componentId':'','reference':_0x1a06b8,'version':_0x2c3ed8[_0x4cd5d8(0x210)],'componentName':_0x2c3ed8[_0x4cd5d8(0x1d6)],'componentType':_0x2c3ed8['Component_Type__c']});}['prepareCommitManifest'](_0x1c54a9,_0x5b9e29){const _0x5c3725=a261_0x268529,{request:_0x2e10a2}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x5c3725(0x1c4)],{[constants_1[_0x5c3725(0x1cb)]+'Commit__c']:_0x1c54a9,[constants_1[_0x5c3725(0x1cb)]+_0x5c3725(0x1c8)]:_0x5b9e29});return _0x2e10a2;}async[a261_0x268529(0x21d)](_0x2ece05,_0x214b5b){const _0x1f5570=a261_0x268529,_0x188f0d={},_0x20a210=zip_1['Zip'][_0x1f5570(0x1df)]();for(const _0x365e5f of Object[_0x1f5570(0x1de)](_0x2ece05[_0x1f5570(0x21b)])){_0x20a210[_0x1f5570(0x1c6)](_0x365e5f,_0x2ece05['files'][_0x365e5f],{'createFolders':!![]});}return _0x188f0d[_0x1f5570(0x1c7)]=_0x1f5570(0x1d2),_0x188f0d[_0x1f5570(0x1dc)]=_0x2ece05['type'],_0x188f0d['Description']=_0x2ece05[_0x1f5570(0x212)],_0x188f0d[_0x1f5570(0x20a)]=_0x214b5b,_0x188f0d['Body']=await _0x20a210[_0x1f5570(0x1fc)]({'type':_0x1f5570(0x1ef),'compression':_0x1f5570(0x1e8),'compressionOptions':{'level':0x6}}),_0x188f0d;}[a261_0x268529(0x1e4)](_0x1f16b8,_0x5a9e66,_0x23654d){const _0xf24780=a261_0x268529,_0x3b2787=new Date()[_0xf24780(0x1c9)](),_0x1bae1c={};return _0x1bae1c[constants_1['FLOSUM_NAMESPACE']+_0xf24780(0x1d8)]=_0x5a9e66,_0x1bae1c[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x1f16b8[_0xf24780(0x21e)],_0x1bae1c[constants_1[_0xf24780(0x1cb)]+_0xf24780(0x205)]=_0x3b2787,_0x1bae1c[constants_1['FLOSUM_NAMESPACE']+_0xf24780(0x1db)]=this[_0xf24780(0x20e)],_0x1bae1c[constants_1[_0xf24780(0x1cb)]+_0xf24780(0x210)]=_0x23654d?_0x23654d+0x1:0x1,_0x1bae1c[constants_1[_0xf24780(0x226)]+_0xf24780(0x1e7)]=!![],_0x1bae1c;}[a261_0x268529(0x1d5)](_0x5844b1,_0x50ac5d){const _0x38d912=a261_0x268529;var _0x1142be,_0x560af4;const _0x5b4810=new Date()['toISOString'](),_0x2d2d71={};return!_0x50ac5d?(this[_0x38d912(0x1d4)]?(_0x2d2d71[constants_1[_0x38d912(0x1cb)]+_0x38d912(0x222)]=this[_0x38d912(0x1d4)],_0x2d2d71[constants_1['FLOSUM_NAMESPACE']+_0x38d912(0x1d7)]=_0x38d912(0x1e9),_0x2d2d71[_0x38d912(0x1e3)]=(_0x1142be=this[_0x38d912(0x227)][_0x38d912(0x209)](_0x2a0341=>_0x2a0341[_0x38d912(0x1fe)]===_0x38d912(0x1e9)))===null||_0x1142be===void 0x0?void 0x0:_0x1142be['id']):(_0x2d2d71[constants_1[_0x38d912(0x1cb)]+_0x38d912(0x215)]=this[_0x38d912(0x1fb)],_0x2d2d71[constants_1[_0x38d912(0x1cb)]+'Source__c']=_0x38d912(0x1e5),_0x2d2d71['RecordTypeId']=(_0x560af4=this[_0x38d912(0x227)][_0x38d912(0x209)](_0x5491c7=>_0x5491c7[_0x38d912(0x1fe)]===_0x38d912(0x1e5)))===null||_0x560af4===void 0x0?void 0x0:_0x560af4['id']),_0x2d2d71[constants_1[_0x38d912(0x1cb)]+_0x38d912(0x210)]=0x1):_0x2d2d71[constants_1['FLOSUM_NAMESPACE']+_0x38d912(0x210)]=_0x50ac5d['version']+0x1,_0x2d2d71[constants_1['FLOSUM_NAMESPACE']+_0x38d912(0x20f)]=_0x5844b1[_0x38d912(0x212)],_0x2d2d71[constants_1['FLOSUM_NAMESPACE']+_0x38d912(0x1d6)]=_0x5844b1['name'],_0x2d2d71[constants_1[_0x38d912(0x1cb)]+'File_Name__c']=_0x5844b1['filePath'],_0x2d2d71[constants_1[_0x38d912(0x1cb)]+'Last_Updated_By__c']=this[_0x38d912(0x20e)],_0x2d2d71[constants_1[_0x38d912(0x1cb)]+_0x38d912(0x1ec)]=this['username'],_0x2d2d71[constants_1['FLOSUM_NAMESPACE']+_0x38d912(0x1ff)]=_0x5b4810,_0x2d2d71[constants_1[_0x38d912(0x1cb)]+'Committed_On__c']=_0x5b4810,_0x2d2d71[constants_1[_0x38d912(0x1cb)]+_0x38d912(0x1ce)]=_0x5844b1[_0x38d912(0x21e)],_0x2d2d71[constants_1[_0x38d912(0x1cb)]+_0x38d912(0x1d9)]=_0x5844b1[_0x38d912(0x1f5)],_0x2d2d71[constants_1[_0x38d912(0x1cb)]+_0x38d912(0x204)]=_0x5844b1[_0x38d912(0x1e6)],_0x2d2d71[constants_1['FLOSUM_NAMESPACE']+_0x38d912(0x1d3)]=_0x5844b1[_0x38d912(0x217)],_0x2d2d71;}[a261_0x268529(0x221)](){const _0x4c0245=a261_0x268529;return this[_0x4c0245(0x1cf)];}async[a261_0x268529(0x218)](_0x311c2e,_0x23520a){const _0x15abe0=a261_0x268529,_0x31fae0=[];for(const _0x16631b of _0x311c2e){const _0x55cf48=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x15abe0(0x20d)],this['prepareComponentRecord'](_0x16631b)),_0xeb5d75=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x15abe0(0x1e4)](_0x16631b,'@{'+_0x55cf48[_0x15abe0(0x1f7)]+'.id}')),_0x4c0309=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x15abe0(0x1fd)],await this[_0x15abe0(0x21d)](_0x16631b,'@{'+_0xeb5d75[_0x15abe0(0x1f7)]+_0x15abe0(0x1cd)));this[_0x15abe0(0x1ed)](_0x55cf48[_0x15abe0(0x1f8)]['body'],_0x55cf48[_0x15abe0(0x1f7)]),_0x31fae0[_0x15abe0(0x1f9)](_0x55cf48[_0x15abe0(0x1f8)],_0xeb5d75[_0x15abe0(0x1f8)],_0x4c0309[_0x15abe0(0x1f8)]),_0x23520a&&_0x31fae0['push'](this[_0x15abe0(0x20c)](_0x23520a,'@{'+_0xeb5d75[_0x15abe0(0x1f7)]+_0x15abe0(0x1cd)));}return _0x31fae0;}async['update'](_0x48088e,_0x10bd9b=''){const _0x18b3f5=a261_0x268529,_0x594341=[];for(const {component:_0xa27eb0,meta:_0xda7483}of _0x48088e){if(!_0xda7483['id']){const _0x4fbfb7=this[_0x18b3f5(0x1cf)][_0x18b3f5(0x209)](_0x2576d9=>_0x2576d9['componentName']===_0xa27eb0[_0x18b3f5(0x1fe)]&&_0x2576d9[_0x18b3f5(0x1cc)]===_0xa27eb0[_0x18b3f5(0x212)]);if(!_0x4fbfb7)throw new salesforce_error_1[(_0x18b3f5(0x216))](new Error(_0x18b3f5(0x220)+_0xa27eb0[_0x18b3f5(0x1fe)]+'\x20['+_0xa27eb0['type']+_0x18b3f5(0x21f)));_0xda7483['id']=_0x4fbfb7[_0x18b3f5(0x21a)];}const _0x2112d5=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x18b3f5(0x20d)],_0xda7483['id'],this[_0x18b3f5(0x1d5)](_0xa27eb0,_0xda7483)),_0x1d3cca=(0x0,composite_utils_1[_0x18b3f5(0x1f6)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x18b3f5(0x1e4)](_0xa27eb0,_0xda7483['id'],_0xda7483[_0x18b3f5(0x1d1)])),_0x454354=(0x0,composite_utils_1[_0x18b3f5(0x1f6)])(constants_1[_0x18b3f5(0x1fd)],await this[_0x18b3f5(0x21d)](_0xa27eb0,'@{'+_0x1d3cca[_0x18b3f5(0x1f7)]+_0x18b3f5(0x1cd)));this[_0x18b3f5(0x1ed)](_0x2112d5[_0x18b3f5(0x1f8)][_0x18b3f5(0x202)],_0x2112d5[_0x18b3f5(0x1f7)]),_0x594341['push'](_0x2112d5['request'],_0x1d3cca[_0x18b3f5(0x1f8)],_0x454354[_0x18b3f5(0x1f8)]),_0x10bd9b&&_0x594341[_0x18b3f5(0x1f9)](this[_0x18b3f5(0x20c)](_0x10bd9b,'@{'+_0x1d3cca[_0x18b3f5(0x1f7)]+_0x18b3f5(0x1cd)));}return _0x594341;}async[a261_0x268529(0x207)](_0x4a7767,_0x8c6a6f=![]){const _0x5bc9ff=a261_0x268529,_0x4f51cd={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x57a415=[];for(const _0x1fae55 of _0x4a7767){if(_0x1fae55['id'])_0x57a415[_0x5bc9ff(0x1f9)](_0x1fae55['id']);else{const _0x37316a=this['proceededComponentsMeta']['find'](_0x1d2e18=>_0x1d2e18[_0x5bc9ff(0x1eb)]===_0x1fae55[_0x5bc9ff(0x1fe)]&&_0x1d2e18['componentType']===_0x1fae55['type']);if(!_0x37316a||!_0x37316a['componentId'])continue;_0x57a415[_0x5bc9ff(0x1f9)](_0x37316a[_0x5bc9ff(0x21a)]);}}if(_0x8c6a6f){const _0x39403c=await this[_0x5bc9ff(0x214)]['fetchCommitManifestsByComponentIds'](_0x57a415);_0x4f51cd[_0x5bc9ff(0x1e0)]=_0x39403c[_0x5bc9ff(0x1f3)](_0x1e351f=>(0x0,composite_utils_1[_0x5bc9ff(0x1c2)])(constants_1[_0x5bc9ff(0x1c4)],_0x1e351f)[_0x5bc9ff(0x1f8)]);}return _0x4f51cd[_0x5bc9ff(0x225)]=_0x57a415['map'](_0x1f69cb=>(0x0,composite_utils_1[_0x5bc9ff(0x1e2)])(constants_1[_0x5bc9ff(0x20d)],_0x1f69cb,{[constants_1['FLOSUM_GIT_NAMESPACE']+'Deletion_By_Agent__c']:!![]})['request']),_0x4f51cd['componentsToDelete']=_0x57a415[_0x5bc9ff(0x1f3)](_0x25f5fd=>(0x0,composite_utils_1[_0x5bc9ff(0x1c2)])(constants_1[_0x5bc9ff(0x20d)],_0x25f5fd)[_0x5bc9ff(0x1f8)]),_0x4f51cd;}}exports[a261_0x268529(0x200)]=SalesforceComponentsManager;