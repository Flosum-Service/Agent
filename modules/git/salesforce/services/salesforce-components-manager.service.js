const a271_0x39f93d=a271_0x471a;(function(_0x43d3e7,_0x164201){const _0x275003=a271_0x471a,_0x34d262=_0x43d3e7();while(!![]){try{const _0x4437a5=parseInt(_0x275003(0x11f))/0x1+-parseInt(_0x275003(0x112))/0x2*(parseInt(_0x275003(0x109))/0x3)+-parseInt(_0x275003(0xb8))/0x4+-parseInt(_0x275003(0xe6))/0x5+-parseInt(_0x275003(0xb7))/0x6+-parseInt(_0x275003(0x108))/0x7*(-parseInt(_0x275003(0x113))/0x8)+parseInt(_0x275003(0x10a))/0x9;if(_0x4437a5===_0x164201)break;else _0x34d262['push'](_0x34d262['shift']());}catch(_0x407d92){_0x34d262['push'](_0x34d262['shift']());}}}(a271_0xa278,0xc22f8));const a271_0x4ce7de=(function(){let _0x2c38e7=!![];return function(_0x49c82c,_0x46cdab){const _0x22f6e0=_0x2c38e7?function(){const _0x19ee84=a271_0x471a;if(_0x46cdab){const _0x511c0f=_0x46cdab[_0x19ee84(0xd5)](_0x49c82c,arguments);return _0x46cdab=null,_0x511c0f;}}:function(){};return _0x2c38e7=![],_0x22f6e0;};}()),a271_0x121e50=a271_0x4ce7de(this,function(){const _0x56558f=a271_0x471a;return a271_0x121e50[_0x56558f(0xba)]()[_0x56558f(0xc7)](_0x56558f(0xbc))['toString']()[_0x56558f(0xdb)](a271_0x121e50)[_0x56558f(0xc7)]('(((.+)+)+)+$');});a271_0x121e50();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5a3cbb){const _0x4c4223=a271_0x471a;return _0x5a3cbb&&_0x5a3cbb[_0x4c4223(0x111)]?_0x5a3cbb:{'default':_0x5a3cbb};};function a271_0x471a(_0x216c57,_0x1abe87){const _0x55965f=a271_0xa278();return a271_0x471a=function(_0x121e50,_0x4ce7de){_0x121e50=_0x121e50-0xb7;let _0xa27847=_0x55965f[_0x121e50];return _0xa27847;},a271_0x471a(_0x216c57,_0x1abe87);}function a271_0xa278(){const _0x97d83=['Committed_On__c','proceedComponentMeta','Last_Updated_By__c','apply','proceededComponentsMeta','Component_Type__c','FLOSUM_ATTACHMENT','FLOSUM_GIT_NAMESPACE','body','constructor','./salesforce-git-sync.service','createZip','Branch__c','application/zip','keys','File_Name__c','Version__c','files','prepareComponentAttachmentRecord',']\x20-\x20meta\x20not\x20found','2860095IGzNVj','SalesforceGitSyncService','gitSync','default','Repository','DEFLATE','prepareCommitManifest','Branch','update','FLOSUM_COMPONENT','FLOSUM_COMPONENT_HISTORY','generateAsync','Deletion_By_Agent__c','type','Changed_By__c','Zip','version','ContentType','createPatchRequest','branchId','insert','recordTypes','Could\x20not\x20proceed\x20component\x20','request','typedi','Changed_On__c','fetchCommitManifestsByComponentIds','Last_Modified_Date__c','prepareComponentHistoryRecord','reference','push','FLOSUM_COMMIT_MANIFEST','username','Body','21KJzjar','36597TpKmnG','35724411ImcMFN','MC_Key__c','componentId','map','Vlocity_Component__c','marketingCloudKey','defineProperty','__esModule','220YMwTlU','525392WkYgmS','name','Is_From_Agent__c','Source__c','SalesforceComponentsManager','delete','find','.id}','ParentId','Component_History__c','Repository__c','../../../../constants','403874RRZTVz','8795868ppQeXz','1580016dBaikI','createPostRequest','toString','../../parsers/utils/zip','(((.+)+)+)+$','logger','../utils/flosum-naming.utils','Name','../../../../core','prepareComponentRecord','Vlocity_Component_Name__c','Last_Modified_By__c','FLOSUM_NAMESPACE','Component_Name__c','repositoryId','search','Logger','componentsToDelete','crc','../utils/composite.utils','RecordTypeId','toISOString','CRC32__c','manifests','SalesforceError','Description'];a271_0xa278=function(){return _0x97d83;};return a271_0xa278();}Object[a271_0x39f93d(0x110)](exports,a271_0x39f93d(0x111),{'value':!![]}),exports[a271_0x39f93d(0x117)]=void 0x0;const constants_1=require(a271_0x39f93d(0x11e)),core_1=require(a271_0x39f93d(0xc0)),zip_1=require(a271_0x39f93d(0xbb)),typedi_1=__importDefault(require(a271_0x39f93d(0xfe))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a271_0x39f93d(0xcb)),flosum_naming_utils_1=require(a271_0x39f93d(0xbe)),salesforce_git_sync_service_1=require(a271_0x39f93d(0xdc));class SalesforceComponentsManager{constructor(_0x24a0f8,_0x4aba39,_0x1d050c,_0x2b8ce5,_0x1a4898){const _0x13f8f5=a271_0x39f93d;this[_0x13f8f5(0xc6)]=_0x24a0f8,this[_0x13f8f5(0xf9)]=_0x4aba39,this[_0x13f8f5(0x106)]=_0x1d050c,this['recordTypes']=_0x2b8ce5,this['proceededComponentsMeta']=_0x1a4898,this[_0x13f8f5(0xbd)]=new core_1[(_0x13f8f5(0xc8))](SalesforceComponentsManager[_0x13f8f5(0x114)]),this[_0x13f8f5(0xe8)]=typedi_1[_0x13f8f5(0xe9)]['get'](salesforce_git_sync_service_1[_0x13f8f5(0xe7)]);}[a271_0x39f93d(0xd3)](_0x541228,_0x1d8e38){const _0x59cc0b=a271_0x39f93d,_0x3eb91d=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x541228,[_0x59cc0b(0xd7),_0x59cc0b(0xc5),'Version__c']);this[_0x59cc0b(0xd6)][_0x59cc0b(0x104)]({'componentId':'','reference':_0x1d8e38,'version':_0x3eb91d[_0x59cc0b(0xe2)],'componentName':_0x3eb91d[_0x59cc0b(0xc5)],'componentType':_0x3eb91d[_0x59cc0b(0xd7)]});}[a271_0x39f93d(0xec)](_0x213fc5,_0x28d32e){const _0x4d9911=a271_0x39f93d,{request:_0x29b827}=(0x0,composite_utils_1[_0x4d9911(0xb9)])(constants_1[_0x4d9911(0x105)],{[constants_1[_0x4d9911(0xc4)]+'Commit__c']:_0x213fc5,[constants_1[_0x4d9911(0xc4)]+_0x4d9911(0x11c)]:_0x28d32e});return _0x29b827;}async[a271_0x39f93d(0xe4)](_0x2dfbcf,_0x42a710){const _0x4d8282=a271_0x39f93d,_0x1d9dc6={},_0x43fec6=zip_1[_0x4d8282(0xf5)][_0x4d8282(0xdd)]();for(const _0x33921e of Object[_0x4d8282(0xe0)](_0x2dfbcf[_0x4d8282(0xe3)])){_0x43fec6['file'](_0x33921e,_0x2dfbcf[_0x4d8282(0xe3)][_0x33921e],{'createFolders':!![]});}return _0x1d9dc6[_0x4d8282(0xf7)]=_0x4d8282(0xdf),_0x1d9dc6[_0x4d8282(0xbf)]=_0x2dfbcf['type'],_0x1d9dc6[_0x4d8282(0xd1)]=_0x2dfbcf[_0x4d8282(0xf3)],_0x1d9dc6[_0x4d8282(0x11b)]=_0x42a710,_0x1d9dc6[_0x4d8282(0x107)]=await _0x43fec6[_0x4d8282(0xf1)]({'type':'base64','compression':_0x4d8282(0xeb),'compressionOptions':{'level':0x6}}),_0x1d9dc6;}[a271_0x39f93d(0x102)](_0x3b92a6,_0x5ebbe5,_0x514da8){const _0x68c894=a271_0x39f93d,_0x44dc95=new Date()[_0x68c894(0xcd)](),_0x555a2a={};return _0x555a2a[constants_1[_0x68c894(0xc4)]+'Component__c']=_0x5ebbe5,_0x555a2a[constants_1[_0x68c894(0xc4)]+'CRC32__c']=_0x3b92a6['crc'],_0x555a2a[constants_1[_0x68c894(0xc4)]+_0x68c894(0xff)]=_0x44dc95,_0x555a2a[constants_1[_0x68c894(0xc4)]+_0x68c894(0xf4)]=this[_0x68c894(0x106)],_0x555a2a[constants_1[_0x68c894(0xc4)]+_0x68c894(0xe2)]=_0x514da8?_0x514da8+0x1:0x1,_0x555a2a[constants_1['FLOSUM_GIT_NAMESPACE']+_0x68c894(0x115)]=!![],_0x555a2a;}['prepareComponentRecord'](_0x4dc3bf,_0x2c2651){const _0x53e0c5=a271_0x39f93d;var _0x21cacd,_0x29a262;const _0x16ce27=new Date()['toISOString'](),_0x5a5b0d={};return!_0x2c2651?(this[_0x53e0c5(0xf9)]?(_0x5a5b0d[constants_1['FLOSUM_NAMESPACE']+_0x53e0c5(0xde)]=this[_0x53e0c5(0xf9)],_0x5a5b0d[constants_1['FLOSUM_NAMESPACE']+'Source__c']=_0x53e0c5(0xed),_0x5a5b0d[_0x53e0c5(0xcc)]=(_0x21cacd=this[_0x53e0c5(0xfb)][_0x53e0c5(0x119)](_0x35ac7e=>_0x35ac7e['name']===_0x53e0c5(0xed)))===null||_0x21cacd===void 0x0?void 0x0:_0x21cacd['id']):(_0x5a5b0d[constants_1[_0x53e0c5(0xc4)]+_0x53e0c5(0x11d)]=this[_0x53e0c5(0xc6)],_0x5a5b0d[constants_1[_0x53e0c5(0xc4)]+_0x53e0c5(0x116)]=_0x53e0c5(0xea),_0x5a5b0d[_0x53e0c5(0xcc)]=(_0x29a262=this[_0x53e0c5(0xfb)]['find'](_0x2b33d0=>_0x2b33d0[_0x53e0c5(0x114)]===_0x53e0c5(0xea)))===null||_0x29a262===void 0x0?void 0x0:_0x29a262['id']),_0x5a5b0d[constants_1[_0x53e0c5(0xc4)]+_0x53e0c5(0xe2)]=0x1):_0x5a5b0d[constants_1[_0x53e0c5(0xc4)]+'Version__c']=_0x2c2651[_0x53e0c5(0xf6)]+0x1,_0x5a5b0d[constants_1[_0x53e0c5(0xc4)]+'Component_Type__c']=_0x4dc3bf[_0x53e0c5(0xf3)],_0x5a5b0d[constants_1['FLOSUM_NAMESPACE']+_0x53e0c5(0xc5)]=_0x4dc3bf[_0x53e0c5(0x114)],_0x5a5b0d[constants_1[_0x53e0c5(0xc4)]+_0x53e0c5(0xe1)]=_0x4dc3bf['filePath'],_0x5a5b0d[constants_1['FLOSUM_NAMESPACE']+_0x53e0c5(0xd4)]=this['username'],_0x5a5b0d[constants_1[_0x53e0c5(0xc4)]+_0x53e0c5(0xc3)]=this[_0x53e0c5(0x106)],_0x5a5b0d[constants_1[_0x53e0c5(0xc4)]+_0x53e0c5(0x101)]=_0x16ce27,_0x5a5b0d[constants_1['FLOSUM_NAMESPACE']+_0x53e0c5(0xd2)]=_0x16ce27,_0x5a5b0d[constants_1['FLOSUM_NAMESPACE']+_0x53e0c5(0xce)]=_0x4dc3bf[_0x53e0c5(0xca)],_0x5a5b0d[constants_1[_0x53e0c5(0xc4)]+_0x53e0c5(0xc2)]=_0x4dc3bf['vlocityComponentName'],_0x5a5b0d[constants_1[_0x53e0c5(0xc4)]+_0x53e0c5(0x10e)]=_0x4dc3bf['isVlocityComponent'],_0x5a5b0d[constants_1[_0x53e0c5(0xc4)]+_0x53e0c5(0x10b)]=_0x4dc3bf[_0x53e0c5(0x10f)],_0x5a5b0d;}['getProceededComponentsMeta'](){const _0x3d46e0=a271_0x39f93d;return this[_0x3d46e0(0xd6)];}async[a271_0x39f93d(0xfa)](_0x1ef091,_0xe4cdf1){const _0x257403=a271_0x39f93d,_0xad9756=[];for(const _0x4ec0c8 of _0x1ef091){const _0x449c16=(0x0,composite_utils_1[_0x257403(0xb9)])(constants_1[_0x257403(0xef)],this[_0x257403(0xc1)](_0x4ec0c8)),_0x43944f=(0x0,composite_utils_1[_0x257403(0xb9)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x257403(0x102)](_0x4ec0c8,'@{'+_0x449c16[_0x257403(0x103)]+'.id}')),_0x339861=(0x0,composite_utils_1[_0x257403(0xb9)])(constants_1[_0x257403(0xd8)],await this[_0x257403(0xe4)](_0x4ec0c8,'@{'+_0x43944f[_0x257403(0x103)]+_0x257403(0x11a)));this['proceedComponentMeta'](_0x449c16[_0x257403(0xfd)]['body'],_0x449c16[_0x257403(0x103)]),_0xad9756[_0x257403(0x104)](_0x449c16[_0x257403(0xfd)],_0x43944f['request'],_0x339861[_0x257403(0xfd)]),_0xe4cdf1&&_0xad9756[_0x257403(0x104)](this[_0x257403(0xec)](_0xe4cdf1,'@{'+_0x43944f[_0x257403(0x103)]+_0x257403(0x11a)));}return _0xad9756;}async[a271_0x39f93d(0xee)](_0x3b04e0,_0x4c0ac9=''){const _0xec0c6d=a271_0x39f93d,_0x328311=[];for(const {component:_0x257145,meta:_0x4a59df}of _0x3b04e0){if(!_0x4a59df['id']){const _0x2598dd=this[_0xec0c6d(0xd6)][_0xec0c6d(0x119)](_0x342575=>_0x342575['componentName']===_0x257145['name']&&_0x342575['componentType']===_0x257145[_0xec0c6d(0xf3)]);if(!_0x2598dd)throw new salesforce_error_1[(_0xec0c6d(0xd0))](new Error(_0xec0c6d(0xfc)+_0x257145[_0xec0c6d(0x114)]+'\x20['+_0x257145[_0xec0c6d(0xf3)]+_0xec0c6d(0xe5)));_0x4a59df['id']=_0x2598dd[_0xec0c6d(0x10c)];}const _0x4f1e4f=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0xec0c6d(0xef)],_0x4a59df['id'],this[_0xec0c6d(0xc1)](_0x257145,_0x4a59df)),_0x152f4a=(0x0,composite_utils_1[_0xec0c6d(0xb9)])(constants_1[_0xec0c6d(0xf0)],this['prepareComponentHistoryRecord'](_0x257145,_0x4a59df['id'],_0x4a59df[_0xec0c6d(0xf6)])),_0x31f8c4=(0x0,composite_utils_1[_0xec0c6d(0xb9)])(constants_1[_0xec0c6d(0xd8)],await this[_0xec0c6d(0xe4)](_0x257145,'@{'+_0x152f4a[_0xec0c6d(0x103)]+_0xec0c6d(0x11a)));this[_0xec0c6d(0xd3)](_0x4f1e4f[_0xec0c6d(0xfd)][_0xec0c6d(0xda)],_0x4f1e4f[_0xec0c6d(0x103)]),_0x328311[_0xec0c6d(0x104)](_0x4f1e4f[_0xec0c6d(0xfd)],_0x152f4a[_0xec0c6d(0xfd)],_0x31f8c4[_0xec0c6d(0xfd)]),_0x4c0ac9&&_0x328311[_0xec0c6d(0x104)](this['prepareCommitManifest'](_0x4c0ac9,'@{'+_0x152f4a[_0xec0c6d(0x103)]+_0xec0c6d(0x11a)));}return _0x328311;}async[a271_0x39f93d(0x118)](_0x579080,_0x124973=![]){const _0x2f393f=a271_0x39f93d,_0x24e0ba={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x5ebd49=[];for(const _0x585e83 of _0x579080){if(_0x585e83['id'])_0x5ebd49[_0x2f393f(0x104)](_0x585e83['id']);else{const _0x1a0776=this[_0x2f393f(0xd6)][_0x2f393f(0x119)](_0x334b61=>_0x334b61['componentName']===_0x585e83[_0x2f393f(0x114)]&&_0x334b61['componentType']===_0x585e83['type']);if(!_0x1a0776||!_0x1a0776['componentId'])continue;_0x5ebd49[_0x2f393f(0x104)](_0x1a0776[_0x2f393f(0x10c)]);}}if(_0x124973){const _0x4d9873=await this[_0x2f393f(0xe8)][_0x2f393f(0x100)](_0x5ebd49);_0x24e0ba[_0x2f393f(0xcf)]=_0x4d9873['map'](_0x3ec201=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x2f393f(0x105)],_0x3ec201)[_0x2f393f(0xfd)]);}return _0x24e0ba['componentsToUpdate']=_0x5ebd49[_0x2f393f(0x10d)](_0x23e0c2=>(0x0,composite_utils_1[_0x2f393f(0xf8)])(constants_1['FLOSUM_COMPONENT'],_0x23e0c2,{[constants_1[_0x2f393f(0xd9)]+_0x2f393f(0xf2)]:!![]})['request']),_0x24e0ba[_0x2f393f(0xc9)]=_0x5ebd49['map'](_0x5ac606=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1['FLOSUM_COMPONENT'],_0x5ac606)[_0x2f393f(0xfd)]),_0x24e0ba;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;