const a234_0x5d7c5d=a234_0x2297;function a234_0x2297(_0x1c8b13,_0x4e0c26){const _0x22cb36=a234_0x144f();return a234_0x2297=function(_0x52113f,_0x2560cb){_0x52113f=_0x52113f-0x80;let _0x144f82=_0x22cb36[_0x52113f];return _0x144f82;},a234_0x2297(_0x1c8b13,_0x4e0c26);}(function(_0x1f6d13,_0x513b8e){const _0x5696d3=a234_0x2297,_0x13fccc=_0x1f6d13();while(!![]){try{const _0x3c83d1=-parseInt(_0x5696d3(0x8f))/0x1+-parseInt(_0x5696d3(0xc6))/0x2+parseInt(_0x5696d3(0xc7))/0x3+-parseInt(_0x5696d3(0xa8))/0x4+-parseInt(_0x5696d3(0xac))/0x5+-parseInt(_0x5696d3(0x92))/0x6+parseInt(_0x5696d3(0xaa))/0x7;if(_0x3c83d1===_0x513b8e)break;else _0x13fccc['push'](_0x13fccc['shift']());}catch(_0xbf1d46){_0x13fccc['push'](_0x13fccc['shift']());}}}(a234_0x144f,0xd435c));function a234_0x144f(){const _0x10b4b4=['map','constructor','9439212wQaaXa','prepareComponentAttachmentRecord','extractFieldsFromRecord','branchId','createZip','prepareComponentHistoryRecord','toISOString','manifests','Source__c','reference','push','crc','createPostRequest','__importDefault','FLOSUM_NAMESPACE','body','Component_Name__c','.id}','find','FLOSUM_COMPONENT','prepareCommitManifest','Deletion_By_Agent__c','5472188HpLuCa','prepareComponentRecord','38301382ogjoQq','repositoryId','8561775mmlPrF','Repository__c','DEFLATE','RecordTypeId','file','FLOSUM_COMMIT_MANIFEST','get','files','proceededComponentsMeta','search','apply','../../parsers/utils/zip','componentName','application/zip','ContentType','delete','filePath','Component__c','Component_History__c','logger','componentType','./salesforce-git-sync.service','Repository','gitSync','createDeleteRequest','username','756062fHhVsA','4328661hcfAuW','toString','componentsToDelete','createPatchRequest','File_Name__c','Vlocity_Component_Name__c','name','Name','__esModule','insert','keys','Component_Type__c','generateAsync','../../../../constants','Logger','version','FLOSUM_COMPONENT_HISTORY','FLOSUM_GIT_NAMESPACE','componentId','Last_Updated_By__c','Branch__c','componentsToUpdate','type','../utils/composite.utils','ParentId','Branch','Version__c','request','Changed_By__c','Last_Modified_By__c','getProceededComponentsMeta','Commit__c','SalesforceComponentsManager','recordTypes','../utils/flosum-naming.utils','base64','proceedComponentMeta','FLOSUM_ATTACHMENT','default','CRC32__c','Is_From_Agent__c','(((.+)+)+)+$','Committed_On__c','Changed_On__c','1013666mzzOOB'];a234_0x144f=function(){return _0x10b4b4;};return a234_0x144f();}const a234_0x2560cb=(function(){let _0x969f4f=!![];return function(_0x1ff457,_0x5463f6){const _0x12698f=_0x969f4f?function(){const _0x164316=a234_0x2297;if(_0x5463f6){const _0x5f4791=_0x5463f6[_0x164316(0xb6)](_0x1ff457,arguments);return _0x5463f6=null,_0x5f4791;}}:function(){};return _0x969f4f=![],_0x12698f;};}()),a234_0x52113f=a234_0x2560cb(this,function(){const _0x287404=a234_0x2297;return a234_0x52113f[_0x287404(0xc8)]()[_0x287404(0xb5)](_0x287404(0x8c))[_0x287404(0xc8)]()[_0x287404(0x91)](a234_0x52113f)[_0x287404(0xb5)](_0x287404(0x8c));});a234_0x52113f();'use strict';var __importDefault=this&&this[a234_0x5d7c5d(0x9f)]||function(_0x252436){const _0x79968d=a234_0x5d7c5d;return _0x252436&&_0x252436[_0x79968d(0xcf)]?_0x252436:{'default':_0x252436};};Object['defineProperty'](exports,a234_0x5d7c5d(0xcf),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a234_0x5d7c5d(0xd4)),core_1=require('../../../../core'),zip_1=require(a234_0x5d7c5d(0xb7)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a234_0x5d7c5d(0xde)),flosum_naming_utils_1=require(a234_0x5d7c5d(0x85)),salesforce_git_sync_service_1=require(a234_0x5d7c5d(0xc1));class SalesforceComponentsManager{constructor(_0x543e67,_0x491a7c,_0x513751,_0x1345f6,_0x1cf341){const _0x5766d1=a234_0x5d7c5d;this[_0x5766d1(0xab)]=_0x543e67,this[_0x5766d1(0x95)]=_0x491a7c,this[_0x5766d1(0xc5)]=_0x513751,this[_0x5766d1(0x84)]=_0x1345f6,this[_0x5766d1(0xb4)]=_0x1cf341,this[_0x5766d1(0xbf)]=new core_1[(_0x5766d1(0xd5))](SalesforceComponentsManager['name']),this[_0x5766d1(0xc3)]=typedi_1[_0x5766d1(0x89)][_0x5766d1(0xb2)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a234_0x5d7c5d(0x87)](_0x42f7e4,_0x374a9d){const _0x12b64d=a234_0x5d7c5d,_0x16dcd5=(0x0,flosum_naming_utils_1[_0x12b64d(0x94)])(_0x42f7e4,['Component_Type__c',_0x12b64d(0xa2),'Version__c']);this[_0x12b64d(0xb4)][_0x12b64d(0x9c)]({'componentId':'','reference':_0x374a9d,'version':_0x16dcd5[_0x12b64d(0xe1)],'componentName':_0x16dcd5[_0x12b64d(0xa2)],'componentType':_0x16dcd5[_0x12b64d(0xd2)]});}['prepareCommitManifest'](_0x3489cc,_0x5a71c7){const _0x410aeb=a234_0x5d7c5d,{request:_0x306507}=(0x0,composite_utils_1[_0x410aeb(0x9e)])(constants_1[_0x410aeb(0xb1)],{[constants_1[_0x410aeb(0xa0)]+_0x410aeb(0x82)]:_0x3489cc,[constants_1[_0x410aeb(0xa0)]+_0x410aeb(0xbe)]:_0x5a71c7});return _0x306507;}async[a234_0x5d7c5d(0x93)](_0x308fa7,_0x190795){const _0x41aae5=a234_0x5d7c5d,_0x56885c={},_0x38da43=zip_1['Zip'][_0x41aae5(0x96)]();for(const _0x537c81 of Object[_0x41aae5(0xd1)](_0x308fa7[_0x41aae5(0xb3)])){_0x38da43[_0x41aae5(0xb0)](_0x537c81,_0x308fa7['files'][_0x537c81],{'createFolders':!![]});}return _0x56885c[_0x41aae5(0xba)]=_0x41aae5(0xb9),_0x56885c[_0x41aae5(0xce)]=_0x308fa7[_0x41aae5(0xdd)],_0x56885c['Description']=_0x308fa7[_0x41aae5(0xdd)],_0x56885c[_0x41aae5(0xdf)]=_0x190795,_0x56885c['Body']=await _0x38da43[_0x41aae5(0xd3)]({'type':_0x41aae5(0x86),'compression':_0x41aae5(0xae),'compressionOptions':{'level':0x6}}),_0x56885c;}[a234_0x5d7c5d(0x97)](_0x5802ca,_0x274e87,_0x514700){const _0x1ee37f=a234_0x5d7c5d,_0x133a3d=new Date()[_0x1ee37f(0x98)](),_0x33438b={};return _0x33438b[constants_1[_0x1ee37f(0xa0)]+_0x1ee37f(0xbd)]=_0x274e87,_0x33438b[constants_1['FLOSUM_NAMESPACE']+_0x1ee37f(0x8a)]=_0x5802ca[_0x1ee37f(0x9d)],_0x33438b[constants_1[_0x1ee37f(0xa0)]+_0x1ee37f(0x8e)]=_0x133a3d,_0x33438b[constants_1[_0x1ee37f(0xa0)]+_0x1ee37f(0xe3)]=this[_0x1ee37f(0xc5)],_0x33438b[constants_1[_0x1ee37f(0xa0)]+_0x1ee37f(0xe1)]=_0x514700?_0x514700+0x1:0x1,_0x33438b[constants_1[_0x1ee37f(0xd8)]+_0x1ee37f(0x8b)]=!![],_0x33438b;}[a234_0x5d7c5d(0xa9)](_0x49663e,_0x380b2b){const _0x17b89e=a234_0x5d7c5d;var _0x2a6630,_0x4e2b8a;const _0x3aac0b=new Date()[_0x17b89e(0x98)](),_0x3aa7a8={};return!_0x380b2b?(this[_0x17b89e(0x95)]?(_0x3aa7a8[constants_1[_0x17b89e(0xa0)]+_0x17b89e(0xdb)]=this[_0x17b89e(0x95)],_0x3aa7a8[constants_1['FLOSUM_NAMESPACE']+'Source__c']=_0x17b89e(0xe0),_0x3aa7a8[_0x17b89e(0xaf)]=(_0x2a6630=this[_0x17b89e(0x84)][_0x17b89e(0xa4)](_0x5c8459=>_0x5c8459[_0x17b89e(0xcd)]===_0x17b89e(0xe0)))===null||_0x2a6630===void 0x0?void 0x0:_0x2a6630['id']):(_0x3aa7a8[constants_1['FLOSUM_NAMESPACE']+_0x17b89e(0xad)]=this[_0x17b89e(0xab)],_0x3aa7a8[constants_1[_0x17b89e(0xa0)]+_0x17b89e(0x9a)]=_0x17b89e(0xc2),_0x3aa7a8['RecordTypeId']=(_0x4e2b8a=this[_0x17b89e(0x84)][_0x17b89e(0xa4)](_0x349556=>_0x349556[_0x17b89e(0xcd)]==='Repository'))===null||_0x4e2b8a===void 0x0?void 0x0:_0x4e2b8a['id']),_0x3aa7a8[constants_1['FLOSUM_NAMESPACE']+_0x17b89e(0xe1)]=0x1):_0x3aa7a8[constants_1[_0x17b89e(0xa0)]+_0x17b89e(0xe1)]=_0x380b2b[_0x17b89e(0xd6)]+0x1,_0x3aa7a8[constants_1['FLOSUM_NAMESPACE']+'Component_Type__c']=_0x49663e[_0x17b89e(0xdd)],_0x3aa7a8[constants_1[_0x17b89e(0xa0)]+_0x17b89e(0xa2)]=_0x49663e[_0x17b89e(0xcd)],_0x3aa7a8[constants_1['FLOSUM_NAMESPACE']+_0x17b89e(0xcb)]=_0x49663e[_0x17b89e(0xbc)],_0x3aa7a8[constants_1['FLOSUM_NAMESPACE']+_0x17b89e(0xda)]=this[_0x17b89e(0xc5)],_0x3aa7a8[constants_1['FLOSUM_NAMESPACE']+_0x17b89e(0x80)]=this[_0x17b89e(0xc5)],_0x3aa7a8[constants_1[_0x17b89e(0xa0)]+'Last_Modified_Date__c']=_0x3aac0b,_0x3aa7a8[constants_1['FLOSUM_NAMESPACE']+_0x17b89e(0x8d)]=_0x3aac0b,_0x3aa7a8[constants_1['FLOSUM_NAMESPACE']+_0x17b89e(0x8a)]=_0x49663e['crc'],_0x3aa7a8[constants_1['FLOSUM_NAMESPACE']+_0x17b89e(0xcc)]=_0x49663e['vlocityComponentName'],_0x3aa7a8[constants_1['FLOSUM_NAMESPACE']+'Vlocity_Component__c']=_0x49663e['isVlocityComponent'],_0x3aa7a8;}[a234_0x5d7c5d(0x81)](){const _0xf2cf4=a234_0x5d7c5d;return this[_0xf2cf4(0xb4)];}async[a234_0x5d7c5d(0xd0)](_0x1a60aa,_0x2c03bc){const _0x4838d1=a234_0x5d7c5d,_0x5a11e3=[];for(const _0x56b6d6 of _0x1a60aa){const _0x5b5a9c=(0x0,composite_utils_1[_0x4838d1(0x9e)])(constants_1[_0x4838d1(0xa5)],this[_0x4838d1(0xa9)](_0x56b6d6)),_0x5f5bfc=(0x0,composite_utils_1[_0x4838d1(0x9e)])(constants_1[_0x4838d1(0xd7)],this[_0x4838d1(0x97)](_0x56b6d6,'@{'+_0x5b5a9c[_0x4838d1(0x9b)]+_0x4838d1(0xa3))),_0x1da1c1=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x4838d1(0x88)],await this[_0x4838d1(0x93)](_0x56b6d6,'@{'+_0x5f5bfc[_0x4838d1(0x9b)]+_0x4838d1(0xa3)));this[_0x4838d1(0x87)](_0x5b5a9c['request']['body'],_0x5b5a9c[_0x4838d1(0x9b)]),_0x5a11e3[_0x4838d1(0x9c)](_0x5b5a9c['request'],_0x5f5bfc['request'],_0x1da1c1[_0x4838d1(0xe2)]),_0x2c03bc&&_0x5a11e3[_0x4838d1(0x9c)](this[_0x4838d1(0xa6)](_0x2c03bc,'@{'+_0x5f5bfc[_0x4838d1(0x9b)]+_0x4838d1(0xa3)));}return _0x5a11e3;}async['update'](_0x49d42e,_0x27c18f=''){const _0x4a47c0=a234_0x5d7c5d,_0x3d6e61=[];for(const {component:_0x56f5cf,meta:_0x1003f2}of _0x49d42e){if(!_0x1003f2['id']){const _0x3c3a57=this[_0x4a47c0(0xb4)][_0x4a47c0(0xa4)](_0x414432=>_0x414432['componentName']===_0x56f5cf[_0x4a47c0(0xcd)]&&_0x414432[_0x4a47c0(0xc0)]===_0x56f5cf['type']);if(!_0x3c3a57)throw new salesforce_error_1['SalesforceError'](new Error('Could\x20not\x20proceed\x20component\x20'+_0x56f5cf[_0x4a47c0(0xcd)]+'\x20['+_0x56f5cf[_0x4a47c0(0xdd)]+']\x20-\x20meta\x20not\x20found'));_0x1003f2['id']=_0x3c3a57[_0x4a47c0(0xd9)];}const _0x48b481=(0x0,composite_utils_1[_0x4a47c0(0xca)])(constants_1[_0x4a47c0(0xa5)],_0x1003f2['id'],this[_0x4a47c0(0xa9)](_0x56f5cf,_0x1003f2)),_0x76ca60=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x4a47c0(0xd7)],this['prepareComponentHistoryRecord'](_0x56f5cf,_0x1003f2['id'],_0x1003f2['version'])),_0x28b793=(0x0,composite_utils_1[_0x4a47c0(0x9e)])(constants_1[_0x4a47c0(0x88)],await this['prepareComponentAttachmentRecord'](_0x56f5cf,'@{'+_0x76ca60[_0x4a47c0(0x9b)]+_0x4a47c0(0xa3)));this[_0x4a47c0(0x87)](_0x48b481[_0x4a47c0(0xe2)][_0x4a47c0(0xa1)],_0x48b481[_0x4a47c0(0x9b)]),_0x3d6e61[_0x4a47c0(0x9c)](_0x48b481[_0x4a47c0(0xe2)],_0x76ca60['request'],_0x28b793[_0x4a47c0(0xe2)]),_0x27c18f&&_0x3d6e61[_0x4a47c0(0x9c)](this['prepareCommitManifest'](_0x27c18f,'@{'+_0x76ca60[_0x4a47c0(0x9b)]+'.id}'));}return _0x3d6e61;}async[a234_0x5d7c5d(0xbb)](_0x4d0b48,_0x203067=![]){const _0x5ce18a=a234_0x5d7c5d,_0x2c63c1={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x5a55cf=[];for(const _0x5a9179 of _0x4d0b48){if(_0x5a9179['id'])_0x5a55cf[_0x5ce18a(0x9c)](_0x5a9179['id']);else{const _0x4f0946=this[_0x5ce18a(0xb4)][_0x5ce18a(0xa4)](_0x2a1927=>_0x2a1927[_0x5ce18a(0xb8)]===_0x5a9179[_0x5ce18a(0xcd)]&&_0x2a1927[_0x5ce18a(0xc0)]===_0x5a9179[_0x5ce18a(0xdd)]);if(!_0x4f0946||!_0x4f0946[_0x5ce18a(0xd9)])continue;_0x5a55cf[_0x5ce18a(0x9c)](_0x4f0946['componentId']);}}if(_0x203067){const _0x65db05=await this[_0x5ce18a(0xc3)]['fetchCommitManifestsByComponentIds'](_0x5a55cf);_0x2c63c1[_0x5ce18a(0x99)]=_0x65db05[_0x5ce18a(0x90)](_0x104ab6=>(0x0,composite_utils_1[_0x5ce18a(0xc4)])(constants_1[_0x5ce18a(0xb1)],_0x104ab6)[_0x5ce18a(0xe2)]);}return _0x2c63c1[_0x5ce18a(0xdc)]=_0x5a55cf[_0x5ce18a(0x90)](_0x583ece=>(0x0,composite_utils_1[_0x5ce18a(0xca)])(constants_1[_0x5ce18a(0xa5)],_0x583ece,{[constants_1[_0x5ce18a(0xd8)]+_0x5ce18a(0xa7)]:!![]})[_0x5ce18a(0xe2)]),_0x2c63c1[_0x5ce18a(0xc9)]=_0x5a55cf['map'](_0x1e8320=>(0x0,composite_utils_1[_0x5ce18a(0xc4)])(constants_1[_0x5ce18a(0xa5)],_0x1e8320)[_0x5ce18a(0xe2)]),_0x2c63c1;}}exports[a234_0x5d7c5d(0x83)]=SalesforceComponentsManager;