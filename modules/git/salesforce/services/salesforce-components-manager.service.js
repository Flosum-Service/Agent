const a228_0x478596=a228_0x2f60;(function(_0x1db884,_0x9607e){const _0x26efe7=a228_0x2f60,_0x317417=_0x1db884();while(!![]){try{const _0x4e84d5=parseInt(_0x26efe7(0xe3))/0x1+parseInt(_0x26efe7(0xf3))/0x2*(-parseInt(_0x26efe7(0x111))/0x3)+-parseInt(_0x26efe7(0xd8))/0x4+-parseInt(_0x26efe7(0xd4))/0x5*(parseInt(_0x26efe7(0xe1))/0x6)+-parseInt(_0x26efe7(0x117))/0x7*(-parseInt(_0x26efe7(0xfc))/0x8)+-parseInt(_0x26efe7(0x11b))/0x9*(parseInt(_0x26efe7(0xc4))/0xa)+parseInt(_0x26efe7(0xf9))/0xb;if(_0x4e84d5===_0x9607e)break;else _0x317417['push'](_0x317417['shift']());}catch(_0x5e76ff){_0x317417['push'](_0x317417['shift']());}}}(a228_0x4757,0xe959f));const a228_0x3a9daf=(function(){let _0x25908c=!![];return function(_0x44dbe9,_0x4ac11f){const _0xf7a91d=_0x25908c?function(){if(_0x4ac11f){const _0x21c6b1=_0x4ac11f['apply'](_0x44dbe9,arguments);return _0x4ac11f=null,_0x21c6b1;}}:function(){};return _0x25908c=![],_0xf7a91d;};}()),a228_0x54716a=a228_0x3a9daf(this,function(){const _0x276cd6=a228_0x2f60;return a228_0x54716a['toString']()[_0x276cd6(0xe4)](_0x276cd6(0xbe))[_0x276cd6(0xf1)]()[_0x276cd6(0xd1)](a228_0x54716a)[_0x276cd6(0xe4)](_0x276cd6(0xbe));});function a228_0x2f60(_0x178965,_0x29869c){const _0x1f33c6=a228_0x4757();return a228_0x2f60=function(_0x54716a,_0x3a9daf){_0x54716a=_0x54716a-0xbd;let _0x475754=_0x1f33c6[_0x54716a];return _0x475754;},a228_0x2f60(_0x178965,_0x29869c);}a228_0x54716a();'use strict';var __importDefault=this&&this[a228_0x478596(0x11e)]||function(_0x3a1b96){const _0x4bef61=a228_0x478596;return _0x3a1b96&&_0x3a1b96[_0x4bef61(0x11d)]?_0x3a1b96:{'default':_0x3a1b96};};function a228_0x4757(){const _0x5d6116=['insert','componentsToUpdate','3YZQMxD','prepareComponentRecord','File_Name__c','prepareCommitManifest','Repository__c','createPatchRequest','14Kakumr','../../../../core','Last_Modified_By__c','ContentType','585GSwEJS','proceedComponentMeta','__esModule','__importDefault','extractFieldsFromRecord','Component_History__c','prepareComponentAttachmentRecord','manifests','../../parsers/utils/zip','Could\x20not\x20proceed\x20component\x20','gitSync','../errors/salesforce.error','(((.+)+)+)+$','filePath','recordTypes','Deletion_By_Agent__c','logger','version','212540wYMjNr','Zip','files','../utils/flosum-naming.utils','request','ParentId',']\x20-\x20meta\x20not\x20found','SalesforceGitSyncService','file','DEFLATE','getProceededComponentsMeta','Repository','branchId','constructor','SalesforceComponentsManager','componentId','5dSwJAW','../../../../constants','Last_Modified_Date__c','crc','2212936VvpdDJ','body','prepareComponentHistoryRecord','defineProperty','Changed_By__c','Version__c','Logger','Branch__c','toISOString','5615274zeVKzj','get','674191oSQepk','search','CRC32__c','Is_From_Agent__c','Name','SalesforceError','find','FLOSUM_COMPONENT_HISTORY','FLOSUM_COMPONENT','Last_Updated_By__c','FLOSUM_COMMIT_MANIFEST','repositoryId','Branch','RecordTypeId','toString','createDeleteRequest','2428046jvnCpj','delete','Component_Type__c','createPostRequest','.id}','Commit__c','47411166FVoZXt','Changed_On__c','proceededComponentsMeta','224624oROiMz','FLOSUM_NAMESPACE','type','FLOSUM_ATTACHMENT','FLOSUM_GIT_NAMESPACE','Description','componentName','username','Body','name','Component_Name__c','createZip','fetchCommitManifestsByComponentIds','Committed_On__c','map','Source__c','reference','push','./salesforce-git-sync.service'];a228_0x4757=function(){return _0x5d6116;};return a228_0x4757();}Object[a228_0x478596(0xdb)](exports,'__esModule',{'value':!![]}),exports[a228_0x478596(0xd2)]=void 0x0;const constants_1=require(a228_0x478596(0xd5)),core_1=require(a228_0x478596(0x118)),zip_1=require(a228_0x478596(0x123)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a228_0x478596(0xbd)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a228_0x478596(0xc7)),salesforce_git_sync_service_1=require(a228_0x478596(0x10e));class SalesforceComponentsManager{constructor(_0x230d5e,_0x46ff4f,_0x25e620,_0x1ccacf,_0x4f4f50){const _0xe54234=a228_0x478596;this[_0xe54234(0xee)]=_0x230d5e,this[_0xe54234(0xd0)]=_0x46ff4f,this['username']=_0x25e620,this[_0xe54234(0xc0)]=_0x1ccacf,this[_0xe54234(0xfb)]=_0x4f4f50,this[_0xe54234(0xc2)]=new core_1[(_0xe54234(0xde))](SalesforceComponentsManager['name']),this[_0xe54234(0x125)]=typedi_1['default'][_0xe54234(0xe2)](salesforce_git_sync_service_1[_0xe54234(0xcb)]);}[a228_0x478596(0x11c)](_0x1bfb3b,_0x3f5339){const _0x112a34=a228_0x478596,_0x5375f0=(0x0,flosum_naming_utils_1[_0x112a34(0x11f)])(_0x1bfb3b,[_0x112a34(0xf5),_0x112a34(0x106),_0x112a34(0xdd)]);this[_0x112a34(0xfb)][_0x112a34(0x10d)]({'componentId':'','reference':_0x3f5339,'version':_0x5375f0['Version__c'],'componentName':_0x5375f0[_0x112a34(0x106)],'componentType':_0x5375f0[_0x112a34(0xf5)]});}[a228_0x478596(0x114)](_0x509b84,_0x487624){const _0xdb3125=a228_0x478596,{request:_0x292ca4}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0xdb3125(0xed)],{[constants_1[_0xdb3125(0xfd)]+_0xdb3125(0xf8)]:_0x509b84,[constants_1[_0xdb3125(0xfd)]+_0xdb3125(0x120)]:_0x487624});return _0x292ca4;}async[a228_0x478596(0x121)](_0x1f29fc,_0x28c47f){const _0x243a15=a228_0x478596,_0x1ddea4={},_0x4b645e=zip_1[_0x243a15(0xc5)][_0x243a15(0x107)]();for(const _0x328124 of Object['keys'](_0x1f29fc[_0x243a15(0xc6)])){_0x4b645e[_0x243a15(0xcc)](_0x328124,_0x1f29fc[_0x243a15(0xc6)][_0x328124],{'createFolders':!![]});}return _0x1ddea4[_0x243a15(0x11a)]='application/zip',_0x1ddea4[_0x243a15(0xe7)]=_0x1f29fc['type'],_0x1ddea4[_0x243a15(0x101)]=_0x1f29fc['type'],_0x1ddea4[_0x243a15(0xc9)]=_0x28c47f,_0x1ddea4[_0x243a15(0x104)]=await _0x4b645e['generateAsync']({'type':'base64','compression':_0x243a15(0xcd),'compressionOptions':{'level':0x6}}),_0x1ddea4;}['prepareComponentHistoryRecord'](_0x104df8,_0x324cf9,_0x327c2e){const _0x3dc2c8=a228_0x478596,_0x50c723=new Date()[_0x3dc2c8(0xe0)](),_0x2924dc={};return _0x2924dc[constants_1[_0x3dc2c8(0xfd)]+'Component__c']=_0x324cf9,_0x2924dc[constants_1[_0x3dc2c8(0xfd)]+_0x3dc2c8(0xe5)]=_0x104df8[_0x3dc2c8(0xd7)],_0x2924dc[constants_1[_0x3dc2c8(0xfd)]+_0x3dc2c8(0xfa)]=_0x50c723,_0x2924dc[constants_1[_0x3dc2c8(0xfd)]+_0x3dc2c8(0xdc)]=this[_0x3dc2c8(0x103)],_0x2924dc[constants_1[_0x3dc2c8(0xfd)]+_0x3dc2c8(0xdd)]=_0x327c2e?_0x327c2e+0x1:0x1,_0x2924dc[constants_1[_0x3dc2c8(0x100)]+_0x3dc2c8(0xe6)]=!![],_0x2924dc;}[a228_0x478596(0x112)](_0x29fb59,_0x39dd5c){const _0x559a6d=a228_0x478596;var _0x6bb3e2,_0x14b451;const _0x4c4c8e=new Date()['toISOString'](),_0x22740a={};return!_0x39dd5c?(this[_0x559a6d(0xd0)]?(_0x22740a[constants_1[_0x559a6d(0xfd)]+_0x559a6d(0xdf)]=this['branchId'],_0x22740a[constants_1[_0x559a6d(0xfd)]+_0x559a6d(0x10b)]=_0x559a6d(0xef),_0x22740a[_0x559a6d(0xf0)]=(_0x6bb3e2=this['recordTypes'][_0x559a6d(0xe9)](_0x251826=>_0x251826[_0x559a6d(0x105)]==='Branch'))===null||_0x6bb3e2===void 0x0?void 0x0:_0x6bb3e2['id']):(_0x22740a[constants_1[_0x559a6d(0xfd)]+_0x559a6d(0x115)]=this[_0x559a6d(0xee)],_0x22740a[constants_1['FLOSUM_NAMESPACE']+_0x559a6d(0x10b)]=_0x559a6d(0xcf),_0x22740a[_0x559a6d(0xf0)]=(_0x14b451=this[_0x559a6d(0xc0)]['find'](_0x1b60d1=>_0x1b60d1['name']===_0x559a6d(0xcf)))===null||_0x14b451===void 0x0?void 0x0:_0x14b451['id']),_0x22740a[constants_1[_0x559a6d(0xfd)]+_0x559a6d(0xdd)]=0x1):_0x22740a[constants_1[_0x559a6d(0xfd)]+_0x559a6d(0xdd)]=_0x39dd5c[_0x559a6d(0xc3)]+0x1,_0x22740a[constants_1[_0x559a6d(0xfd)]+_0x559a6d(0xf5)]=_0x29fb59['type'],_0x22740a[constants_1[_0x559a6d(0xfd)]+_0x559a6d(0x106)]=_0x29fb59[_0x559a6d(0x105)],_0x22740a[constants_1['FLOSUM_NAMESPACE']+_0x559a6d(0x113)]=_0x29fb59[_0x559a6d(0xbf)],_0x22740a[constants_1['FLOSUM_NAMESPACE']+_0x559a6d(0xec)]=this['username'],_0x22740a[constants_1[_0x559a6d(0xfd)]+_0x559a6d(0x119)]=this[_0x559a6d(0x103)],_0x22740a[constants_1[_0x559a6d(0xfd)]+_0x559a6d(0xd6)]=_0x4c4c8e,_0x22740a[constants_1[_0x559a6d(0xfd)]+_0x559a6d(0x109)]=_0x4c4c8e,_0x22740a[constants_1[_0x559a6d(0xfd)]+_0x559a6d(0xe5)]=_0x29fb59[_0x559a6d(0xd7)],_0x22740a;}[a228_0x478596(0xce)](){const _0x1cb5bd=a228_0x478596;return this[_0x1cb5bd(0xfb)];}async[a228_0x478596(0x10f)](_0x15d287,_0x47b9bd){const _0x4e1412=a228_0x478596,_0x41b2b8=[];for(const _0x5c95fe of _0x15d287){const _0x4e3e10=(0x0,composite_utils_1[_0x4e1412(0xf6)])(constants_1[_0x4e1412(0xeb)],this['prepareComponentRecord'](_0x5c95fe)),_0x5a330e=(0x0,composite_utils_1[_0x4e1412(0xf6)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x4e1412(0xda)](_0x5c95fe,'@{'+_0x4e3e10[_0x4e1412(0x10c)]+'.id}')),_0x4d44b2=(0x0,composite_utils_1[_0x4e1412(0xf6)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x4e1412(0x121)](_0x5c95fe,'@{'+_0x5a330e[_0x4e1412(0x10c)]+_0x4e1412(0xf7)));this[_0x4e1412(0x11c)](_0x4e3e10[_0x4e1412(0xc8)][_0x4e1412(0xd9)],_0x4e3e10[_0x4e1412(0x10c)]),_0x41b2b8[_0x4e1412(0x10d)](_0x4e3e10[_0x4e1412(0xc8)],_0x5a330e['request'],_0x4d44b2[_0x4e1412(0xc8)]),_0x47b9bd&&_0x41b2b8[_0x4e1412(0x10d)](this[_0x4e1412(0x114)](_0x47b9bd,'@{'+_0x5a330e[_0x4e1412(0x10c)]+_0x4e1412(0xf7)));}return _0x41b2b8;}async['update'](_0x5a818c,_0x56b34c=''){const _0x28053d=a228_0x478596,_0x124d4e=[];for(const {component:_0x28b347,meta:_0x3eb10f}of _0x5a818c){if(!_0x3eb10f['id']){const _0x334a39=this[_0x28053d(0xfb)][_0x28053d(0xe9)](_0x41f3b7=>_0x41f3b7[_0x28053d(0x102)]===_0x28b347[_0x28053d(0x105)]&&_0x41f3b7['componentType']===_0x28b347[_0x28053d(0xfe)]);if(!_0x334a39)throw new salesforce_error_1[(_0x28053d(0xe8))](new Error(_0x28053d(0x124)+_0x28b347[_0x28053d(0x105)]+'\x20['+_0x28b347[_0x28053d(0xfe)]+_0x28053d(0xca)));_0x3eb10f['id']=_0x334a39[_0x28053d(0xd3)];}const _0x47c888=(0x0,composite_utils_1[_0x28053d(0x116)])(constants_1[_0x28053d(0xeb)],_0x3eb10f['id'],this[_0x28053d(0x112)](_0x28b347,_0x3eb10f)),_0x36d833=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x28053d(0xea)],this[_0x28053d(0xda)](_0x28b347,_0x3eb10f['id'],_0x3eb10f[_0x28053d(0xc3)])),_0x47349c=(0x0,composite_utils_1[_0x28053d(0xf6)])(constants_1[_0x28053d(0xff)],await this[_0x28053d(0x121)](_0x28b347,'@{'+_0x36d833[_0x28053d(0x10c)]+_0x28053d(0xf7)));this[_0x28053d(0x11c)](_0x47c888[_0x28053d(0xc8)][_0x28053d(0xd9)],_0x47c888['reference']),_0x124d4e[_0x28053d(0x10d)](_0x47c888[_0x28053d(0xc8)],_0x36d833[_0x28053d(0xc8)],_0x47349c[_0x28053d(0xc8)]),_0x56b34c&&_0x124d4e[_0x28053d(0x10d)](this[_0x28053d(0x114)](_0x56b34c,'@{'+_0x36d833[_0x28053d(0x10c)]+_0x28053d(0xf7)));}return _0x124d4e;}async[a228_0x478596(0xf4)](_0x31c1e7,_0x34f9af=![]){const _0x39b171=a228_0x478596,_0x427872={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x51b55c=[];for(const _0x1b57e9 of _0x31c1e7){if(_0x1b57e9['id'])_0x51b55c[_0x39b171(0x10d)](_0x1b57e9['id']);else{const _0x353c35=this[_0x39b171(0xfb)][_0x39b171(0xe9)](_0x406019=>_0x406019[_0x39b171(0x102)]===_0x1b57e9[_0x39b171(0x105)]&&_0x406019['componentType']===_0x1b57e9[_0x39b171(0xfe)]);if(!_0x353c35||!_0x353c35['componentId'])continue;_0x51b55c[_0x39b171(0x10d)](_0x353c35[_0x39b171(0xd3)]);}}if(_0x34f9af){const _0x333a76=await this['gitSync'][_0x39b171(0x108)](_0x51b55c);_0x427872[_0x39b171(0x122)]=_0x333a76[_0x39b171(0x10a)](_0x3faca1=>(0x0,composite_utils_1[_0x39b171(0xf2)])(constants_1[_0x39b171(0xed)],_0x3faca1)[_0x39b171(0xc8)]);}return _0x427872[_0x39b171(0x110)]=_0x51b55c[_0x39b171(0x10a)](_0x3efa2c=>(0x0,composite_utils_1[_0x39b171(0x116)])(constants_1['FLOSUM_COMPONENT'],_0x3efa2c,{[constants_1[_0x39b171(0x100)]+_0x39b171(0xc1)]:!![]})[_0x39b171(0xc8)]),_0x427872['componentsToDelete']=_0x51b55c[_0x39b171(0x10a)](_0x15650b=>(0x0,composite_utils_1[_0x39b171(0xf2)])(constants_1[_0x39b171(0xeb)],_0x15650b)['request']),_0x427872;}}exports[a228_0x478596(0xd2)]=SalesforceComponentsManager;