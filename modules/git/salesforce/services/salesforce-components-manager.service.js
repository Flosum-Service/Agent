const a271_0x18186b=a271_0x17d4;function a271_0x17d4(_0x4c1f43,_0x80b03c){const _0x36b0ed=a271_0x475c();return a271_0x17d4=function(_0x51a7b2,_0x5ec00e){_0x51a7b2=_0x51a7b2-0x148;let _0x475c41=_0x36b0ed[_0x51a7b2];return _0x475c41;},a271_0x17d4(_0x4c1f43,_0x80b03c);}(function(_0x3d1082,_0x1ed6cc){const _0x4ce479=a271_0x17d4,_0x588f25=_0x3d1082();while(!![]){try{const _0x42973d=parseInt(_0x4ce479(0x16d))/0x1+parseInt(_0x4ce479(0x16c))/0x2*(parseInt(_0x4ce479(0x163))/0x3)+parseInt(_0x4ce479(0x149))/0x4*(parseInt(_0x4ce479(0x183))/0x5)+-parseInt(_0x4ce479(0x153))/0x6*(parseInt(_0x4ce479(0x1ad))/0x7)+-parseInt(_0x4ce479(0x179))/0x8+parseInt(_0x4ce479(0x17c))/0x9+parseInt(_0x4ce479(0x1a2))/0xa*(-parseInt(_0x4ce479(0x178))/0xb);if(_0x42973d===_0x1ed6cc)break;else _0x588f25['push'](_0x588f25['shift']());}catch(_0xdc087f){_0x588f25['push'](_0x588f25['shift']());}}}(a271_0x475c,0x9744f));const a271_0x5ec00e=(function(){let _0x34a6d=!![];return function(_0x35dc84,_0x2385ec){const _0x1f3df1=_0x34a6d?function(){if(_0x2385ec){const _0x131014=_0x2385ec['apply'](_0x35dc84,arguments);return _0x2385ec=null,_0x131014;}}:function(){};return _0x34a6d=![],_0x1f3df1;};}()),a271_0x51a7b2=a271_0x5ec00e(this,function(){const _0x1bb2ee=a271_0x17d4;return a271_0x51a7b2[_0x1bb2ee(0x171)]()['search']('(((.+)+)+)+$')[_0x1bb2ee(0x171)]()['constructor'](a271_0x51a7b2)['search'](_0x1bb2ee(0x15f));});a271_0x51a7b2();'use strict';function a271_0x475c(){const _0x50661f=['proceedComponentMeta','10901sSmOFN','2587264lWwDoY','CRC32__c','name','228141TFUjlx','componentName','prepareCommitManifest','../../parsers/utils/zip','componentsToUpdate','find','logger','4542565rhWStB','createPatchRequest','Last_Modified_Date__c','FLOSUM_GIT_NAMESPACE','manifests','crc','__importDefault','FLOSUM_NAMESPACE','generateAsync','../utils/flosum-naming.utils','componentId','branchId','Body','Could\x20not\x20proceed\x20component\x20','filePath','get','Last_Updated_By__c','Repository__c','Logger','fetchCommitManifestsByComponentIds','ParentId','body','Changed_On__c','./salesforce-git-sync.service','files','version','Is_From_Agent__c','proceededComponentsMeta','FLOSUM_ATTACHMENT','type','default','9100geyatA','DEFLATE','request','SalesforceComponentsManager','FLOSUM_COMPONENT','Vlocity_Component_Name__c','delete','Changed_By__c','username','repositoryId','.id}','105cHUpJn','File_Name__c','Vlocity_Component__c','Source__c','4BGKVUt','Version__c','extractFieldsFromRecord','../utils/composite.utils','Component_Name__c','keys','application/zip','createPostRequest','../errors/salesforce.error','file','73068ssXvBJ','prepareComponentRecord','prepareComponentAttachmentRecord','reference','ContentType','marketingCloudKey','componentType','update','MC_Key__c','Component_History__c','insert','SalesforceError','(((.+)+)+)+$','defineProperty','componentsToDelete','Repository','2421660oKVkLS','push','gitSync','map','__esModule','SalesforceGitSyncService','prepareComponentHistoryRecord','Branch','RecordTypeId','2pLSSnb','286405aFazzT','Component_Type__c','getProceededComponentsMeta','Zip','toString','recordTypes','createDeleteRequest','Last_Modified_By__c','FLOSUM_COMPONENT_HISTORY','../../../../core'];a271_0x475c=function(){return _0x50661f;};return a271_0x475c();}var __importDefault=this&&this[a271_0x18186b(0x189)]||function(_0x4bdf0d){const _0xfc7642=a271_0x18186b;return _0x4bdf0d&&_0x4bdf0d[_0xfc7642(0x167)]?_0x4bdf0d:{'default':_0x4bdf0d};};Object[a271_0x18186b(0x160)](exports,'__esModule',{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a271_0x18186b(0x176)),zip_1=require(a271_0x18186b(0x17f)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a271_0x18186b(0x151)),composite_utils_1=require(a271_0x18186b(0x14c)),flosum_naming_utils_1=require(a271_0x18186b(0x18c)),salesforce_git_sync_service_1=require(a271_0x18186b(0x19a));class SalesforceComponentsManager{constructor(_0x16f8c3,_0x187818,_0x500fce,_0x2112a8,_0x56b2f2){const _0x1fb7f6=a271_0x18186b;this[_0x1fb7f6(0x1ab)]=_0x16f8c3,this['branchId']=_0x187818,this[_0x1fb7f6(0x1aa)]=_0x500fce,this[_0x1fb7f6(0x172)]=_0x2112a8,this[_0x1fb7f6(0x19e)]=_0x56b2f2,this[_0x1fb7f6(0x182)]=new core_1[(_0x1fb7f6(0x195))](SalesforceComponentsManager['name']),this[_0x1fb7f6(0x165)]=typedi_1[_0x1fb7f6(0x1a1)][_0x1fb7f6(0x192)](salesforce_git_sync_service_1[_0x1fb7f6(0x168)]);}[a271_0x18186b(0x177)](_0x4fe42d,_0x47deec){const _0xaedd64=a271_0x18186b,_0xb5cdd6=(0x0,flosum_naming_utils_1[_0xaedd64(0x14b)])(_0x4fe42d,[_0xaedd64(0x16e),'Component_Name__c',_0xaedd64(0x14a)]);this[_0xaedd64(0x19e)][_0xaedd64(0x164)]({'componentId':'','reference':_0x47deec,'version':_0xb5cdd6[_0xaedd64(0x14a)],'componentName':_0xb5cdd6['Component_Name__c'],'componentType':_0xb5cdd6[_0xaedd64(0x16e)]});}[a271_0x18186b(0x17e)](_0x13a2ac,_0x544b1b){const _0x158119=a271_0x18186b,{request:_0x2279bc}=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x158119(0x18a)]+'Commit__c']:_0x13a2ac,[constants_1[_0x158119(0x18a)]+_0x158119(0x15c)]:_0x544b1b});return _0x2279bc;}async[a271_0x18186b(0x155)](_0x3c2fd8,_0x1f3142){const _0x3bcf8a=a271_0x18186b,_0x72ede9={},_0x39738e=zip_1[_0x3bcf8a(0x170)]['createZip']();for(const _0x2c31ea of Object[_0x3bcf8a(0x14e)](_0x3c2fd8[_0x3bcf8a(0x19b)])){_0x39738e[_0x3bcf8a(0x152)](_0x2c31ea,_0x3c2fd8[_0x3bcf8a(0x19b)][_0x2c31ea],{'createFolders':!![]});}return _0x72ede9[_0x3bcf8a(0x157)]=_0x3bcf8a(0x14f),_0x72ede9['Name']=_0x3c2fd8[_0x3bcf8a(0x1a0)],_0x72ede9['Description']=_0x3c2fd8[_0x3bcf8a(0x1a0)],_0x72ede9[_0x3bcf8a(0x197)]=_0x1f3142,_0x72ede9[_0x3bcf8a(0x18f)]=await _0x39738e[_0x3bcf8a(0x18b)]({'type':'base64','compression':_0x3bcf8a(0x1a3),'compressionOptions':{'level':0x6}}),_0x72ede9;}[a271_0x18186b(0x169)](_0x2b8f8b,_0x20f10e,_0x36dc47){const _0xbe01de=a271_0x18186b,_0x42a820=new Date()['toISOString'](),_0x52ef9d={};return _0x52ef9d[constants_1[_0xbe01de(0x18a)]+'Component__c']=_0x20f10e,_0x52ef9d[constants_1[_0xbe01de(0x18a)]+_0xbe01de(0x17a)]=_0x2b8f8b[_0xbe01de(0x188)],_0x52ef9d[constants_1['FLOSUM_NAMESPACE']+_0xbe01de(0x199)]=_0x42a820,_0x52ef9d[constants_1[_0xbe01de(0x18a)]+_0xbe01de(0x1a9)]=this['username'],_0x52ef9d[constants_1['FLOSUM_NAMESPACE']+_0xbe01de(0x14a)]=_0x36dc47?_0x36dc47+0x1:0x1,_0x52ef9d[constants_1['FLOSUM_GIT_NAMESPACE']+_0xbe01de(0x19d)]=!![],_0x52ef9d;}[a271_0x18186b(0x154)](_0xd7d7a5,_0x27fec1){const _0xb9320a=a271_0x18186b;var _0x404173,_0x1710c3;const _0x41bebc=new Date()['toISOString'](),_0x3ef39f={};return!_0x27fec1?(this[_0xb9320a(0x18e)]?(_0x3ef39f[constants_1[_0xb9320a(0x18a)]+'Branch__c']=this[_0xb9320a(0x18e)],_0x3ef39f[constants_1[_0xb9320a(0x18a)]+_0xb9320a(0x148)]=_0xb9320a(0x16a),_0x3ef39f[_0xb9320a(0x16b)]=(_0x404173=this[_0xb9320a(0x172)]['find'](_0x4b178b=>_0x4b178b[_0xb9320a(0x17b)]===_0xb9320a(0x16a)))===null||_0x404173===void 0x0?void 0x0:_0x404173['id']):(_0x3ef39f[constants_1['FLOSUM_NAMESPACE']+_0xb9320a(0x194)]=this[_0xb9320a(0x1ab)],_0x3ef39f[constants_1[_0xb9320a(0x18a)]+_0xb9320a(0x148)]=_0xb9320a(0x162),_0x3ef39f[_0xb9320a(0x16b)]=(_0x1710c3=this[_0xb9320a(0x172)][_0xb9320a(0x181)](_0xdc599c=>_0xdc599c[_0xb9320a(0x17b)]===_0xb9320a(0x162)))===null||_0x1710c3===void 0x0?void 0x0:_0x1710c3['id']),_0x3ef39f[constants_1[_0xb9320a(0x18a)]+_0xb9320a(0x14a)]=0x1):_0x3ef39f[constants_1[_0xb9320a(0x18a)]+_0xb9320a(0x14a)]=_0x27fec1[_0xb9320a(0x19c)]+0x1,_0x3ef39f[constants_1[_0xb9320a(0x18a)]+'Component_Type__c']=_0xd7d7a5[_0xb9320a(0x1a0)],_0x3ef39f[constants_1[_0xb9320a(0x18a)]+_0xb9320a(0x14d)]=_0xd7d7a5[_0xb9320a(0x17b)],_0x3ef39f[constants_1[_0xb9320a(0x18a)]+_0xb9320a(0x1ae)]=_0xd7d7a5[_0xb9320a(0x191)],_0x3ef39f[constants_1[_0xb9320a(0x18a)]+_0xb9320a(0x193)]=this['username'],_0x3ef39f[constants_1['FLOSUM_NAMESPACE']+_0xb9320a(0x174)]=this[_0xb9320a(0x1aa)],_0x3ef39f[constants_1['FLOSUM_NAMESPACE']+_0xb9320a(0x185)]=_0x41bebc,_0x3ef39f[constants_1[_0xb9320a(0x18a)]+'Committed_On__c']=_0x41bebc,_0x3ef39f[constants_1[_0xb9320a(0x18a)]+_0xb9320a(0x17a)]=_0xd7d7a5['crc'],_0x3ef39f[constants_1['FLOSUM_NAMESPACE']+_0xb9320a(0x1a7)]=_0xd7d7a5['vlocityComponentName'],_0x3ef39f[constants_1[_0xb9320a(0x18a)]+_0xb9320a(0x1af)]=_0xd7d7a5['isVlocityComponent'],_0x3ef39f[constants_1[_0xb9320a(0x18a)]+_0xb9320a(0x15b)]=_0xd7d7a5[_0xb9320a(0x158)],_0x3ef39f;}[a271_0x18186b(0x16f)](){const _0x46884c=a271_0x18186b;return this[_0x46884c(0x19e)];}async[a271_0x18186b(0x15d)](_0x56cdb4,_0x261964){const _0x5b6e65=a271_0x18186b,_0x2f6b57=[];for(const _0x24a2d3 of _0x56cdb4){const _0x1fc0a7=(0x0,composite_utils_1[_0x5b6e65(0x150)])(constants_1[_0x5b6e65(0x1a6)],this[_0x5b6e65(0x154)](_0x24a2d3)),_0x359ff9=(0x0,composite_utils_1[_0x5b6e65(0x150)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x5b6e65(0x169)](_0x24a2d3,'@{'+_0x1fc0a7['reference']+_0x5b6e65(0x1ac))),_0x40f585=(0x0,composite_utils_1[_0x5b6e65(0x150)])(constants_1[_0x5b6e65(0x19f)],await this[_0x5b6e65(0x155)](_0x24a2d3,'@{'+_0x359ff9['reference']+'.id}'));this[_0x5b6e65(0x177)](_0x1fc0a7[_0x5b6e65(0x1a4)][_0x5b6e65(0x198)],_0x1fc0a7[_0x5b6e65(0x156)]),_0x2f6b57['push'](_0x1fc0a7[_0x5b6e65(0x1a4)],_0x359ff9[_0x5b6e65(0x1a4)],_0x40f585['request']),_0x261964&&_0x2f6b57['push'](this[_0x5b6e65(0x17e)](_0x261964,'@{'+_0x359ff9[_0x5b6e65(0x156)]+_0x5b6e65(0x1ac)));}return _0x2f6b57;}async[a271_0x18186b(0x15a)](_0x479ce1,_0x50e120=''){const _0x30d2ed=a271_0x18186b,_0x26c519=[];for(const {component:_0x2bf38b,meta:_0x56beab}of _0x479ce1){if(!_0x56beab['id']){const _0x5731b0=this[_0x30d2ed(0x19e)][_0x30d2ed(0x181)](_0x31959c=>_0x31959c['componentName']===_0x2bf38b['name']&&_0x31959c[_0x30d2ed(0x159)]===_0x2bf38b['type']);if(!_0x5731b0)throw new salesforce_error_1[(_0x30d2ed(0x15e))](new Error(_0x30d2ed(0x190)+_0x2bf38b[_0x30d2ed(0x17b)]+'\x20['+_0x2bf38b[_0x30d2ed(0x1a0)]+']\x20-\x20meta\x20not\x20found'));_0x56beab['id']=_0x5731b0[_0x30d2ed(0x18d)];}const _0x1e6d96=(0x0,composite_utils_1[_0x30d2ed(0x184)])(constants_1[_0x30d2ed(0x1a6)],_0x56beab['id'],this[_0x30d2ed(0x154)](_0x2bf38b,_0x56beab)),_0x2d8d32=(0x0,composite_utils_1[_0x30d2ed(0x150)])(constants_1[_0x30d2ed(0x175)],this[_0x30d2ed(0x169)](_0x2bf38b,_0x56beab['id'],_0x56beab[_0x30d2ed(0x19c)])),_0x3f951f=(0x0,composite_utils_1[_0x30d2ed(0x150)])(constants_1[_0x30d2ed(0x19f)],await this[_0x30d2ed(0x155)](_0x2bf38b,'@{'+_0x2d8d32['reference']+_0x30d2ed(0x1ac)));this[_0x30d2ed(0x177)](_0x1e6d96['request']['body'],_0x1e6d96[_0x30d2ed(0x156)]),_0x26c519['push'](_0x1e6d96['request'],_0x2d8d32[_0x30d2ed(0x1a4)],_0x3f951f[_0x30d2ed(0x1a4)]),_0x50e120&&_0x26c519['push'](this['prepareCommitManifest'](_0x50e120,'@{'+_0x2d8d32[_0x30d2ed(0x156)]+_0x30d2ed(0x1ac)));}return _0x26c519;}async[a271_0x18186b(0x1a8)](_0x1f3ea8,_0x227ea1=![]){const _0xa3f6f7=a271_0x18186b,_0x2e23e3={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x515919=[];for(const _0x1e8363 of _0x1f3ea8){if(_0x1e8363['id'])_0x515919[_0xa3f6f7(0x164)](_0x1e8363['id']);else{const _0x3b1981=this[_0xa3f6f7(0x19e)]['find'](_0x7421c8=>_0x7421c8[_0xa3f6f7(0x17d)]===_0x1e8363['name']&&_0x7421c8['componentType']===_0x1e8363[_0xa3f6f7(0x1a0)]);if(!_0x3b1981||!_0x3b1981['componentId'])continue;_0x515919[_0xa3f6f7(0x164)](_0x3b1981[_0xa3f6f7(0x18d)]);}}if(_0x227ea1){const _0x2c6a1d=await this[_0xa3f6f7(0x165)][_0xa3f6f7(0x196)](_0x515919);_0x2e23e3[_0xa3f6f7(0x187)]=_0x2c6a1d[_0xa3f6f7(0x166)](_0x38bb45=>(0x0,composite_utils_1[_0xa3f6f7(0x173)])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x38bb45)['request']);}return _0x2e23e3[_0xa3f6f7(0x180)]=_0x515919[_0xa3f6f7(0x166)](_0x5e4b82=>(0x0,composite_utils_1[_0xa3f6f7(0x184)])(constants_1[_0xa3f6f7(0x1a6)],_0x5e4b82,{[constants_1[_0xa3f6f7(0x186)]+'Deletion_By_Agent__c']:!![]})[_0xa3f6f7(0x1a4)]),_0x2e23e3[_0xa3f6f7(0x161)]=_0x515919['map'](_0x295a37=>(0x0,composite_utils_1[_0xa3f6f7(0x173)])(constants_1[_0xa3f6f7(0x1a6)],_0x295a37)[_0xa3f6f7(0x1a4)]),_0x2e23e3;}}exports[a271_0x18186b(0x1a5)]=SalesforceComponentsManager;