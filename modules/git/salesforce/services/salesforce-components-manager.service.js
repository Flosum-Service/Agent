const a271_0x364cd0=a271_0x4ae4;(function(_0x77eb07,_0x4372cd){const _0x296bb9=a271_0x4ae4,_0x349add=_0x77eb07();while(!![]){try{const _0x5ef74b=-parseInt(_0x296bb9(0x96))/0x1*(-parseInt(_0x296bb9(0xd2))/0x2)+-parseInt(_0x296bb9(0xc0))/0x3+parseInt(_0x296bb9(0xcf))/0x4+-parseInt(_0x296bb9(0x70))/0x5+-parseInt(_0x296bb9(0x7a))/0x6*(parseInt(_0x296bb9(0x8a))/0x7)+-parseInt(_0x296bb9(0xbe))/0x8*(-parseInt(_0x296bb9(0xa8))/0x9)+-parseInt(_0x296bb9(0x7f))/0xa;if(_0x5ef74b===_0x4372cd)break;else _0x349add['push'](_0x349add['shift']());}catch(_0x461ea1){_0x349add['push'](_0x349add['shift']());}}}(a271_0x46ec,0xdd8fe));function a271_0x4ae4(_0x76eeb8,_0x25a289){const _0x49ef74=a271_0x46ec();return a271_0x4ae4=function(_0x5d64cb,_0x1c8955){_0x5d64cb=_0x5d64cb-0x68;let _0x46ec0d=_0x49ef74[_0x5d64cb];return _0x46ec0d;},a271_0x4ae4(_0x76eeb8,_0x25a289);}const a271_0x1c8955=(function(){let _0xaafa8f=!![];return function(_0x9de5eb,_0x1ead64){const _0x567c89=_0xaafa8f?function(){const _0x893ee5=a271_0x4ae4;if(_0x1ead64){const _0x36ffee=_0x1ead64[_0x893ee5(0x7e)](_0x9de5eb,arguments);return _0x1ead64=null,_0x36ffee;}}:function(){};return _0xaafa8f=![],_0x567c89;};}()),a271_0x5d64cb=a271_0x1c8955(this,function(){const _0x5cf807=a271_0x4ae4;return a271_0x5d64cb[_0x5cf807(0xb2)]()['search'](_0x5cf807(0xb6))['toString']()[_0x5cf807(0xb8)](a271_0x5d64cb)[_0x5cf807(0xa6)](_0x5cf807(0xb6));});a271_0x5d64cb();'use strict';var __importDefault=this&&this[a271_0x364cd0(0xb1)]||function(_0x33bee1){const _0x28db9d=a271_0x364cd0;return _0x33bee1&&_0x33bee1[_0x28db9d(0xc4)]?_0x33bee1:{'default':_0x33bee1};};Object[a271_0x364cd0(0xce)](exports,a271_0x364cd0(0xc4),{'value':!![]}),exports[a271_0x364cd0(0xad)]=void 0x0;const constants_1=require(a271_0x364cd0(0x82)),core_1=require('../../../../core'),zip_1=require(a271_0x364cd0(0xab)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a271_0x364cd0(0xd0)),composite_utils_1=require(a271_0x364cd0(0x69)),flosum_naming_utils_1=require(a271_0x364cd0(0x83)),salesforce_git_sync_service_1=require(a271_0x364cd0(0x74));class SalesforceComponentsManager{constructor(_0x53cafa,_0x56616e,_0x1c0f79,_0x109102,_0x22bfa2){const _0x369ec1=a271_0x364cd0;this[_0x369ec1(0x76)]=_0x53cafa,this['branchId']=_0x56616e,this['username']=_0x1c0f79,this[_0x369ec1(0xaa)]=_0x109102,this['proceededComponentsMeta']=_0x22bfa2,this[_0x369ec1(0x80)]=new core_1[(_0x369ec1(0xc6))](SalesforceComponentsManager['name']),this['gitSync']=typedi_1[_0x369ec1(0x95)][_0x369ec1(0x9a)](salesforce_git_sync_service_1[_0x369ec1(0x91)]);}['proceedComponentMeta'](_0x471528,_0x1937cb){const _0x10969a=a271_0x364cd0,_0x47cb45=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x471528,[_0x10969a(0x68),_0x10969a(0xaf),'Version__c']);this[_0x10969a(0x7d)][_0x10969a(0xa3)]({'componentId':'','reference':_0x1937cb,'version':_0x47cb45[_0x10969a(0xc2)],'componentName':_0x47cb45['Component_Name__c'],'componentType':_0x47cb45[_0x10969a(0x68)]});}[a271_0x364cd0(0x90)](_0xd16b2b,_0x33e754){const _0x17ffdc=a271_0x364cd0,{request:_0x1d7c8e}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x17ffdc(0xb3)],{[constants_1[_0x17ffdc(0xc1)]+_0x17ffdc(0x89)]:_0xd16b2b,[constants_1[_0x17ffdc(0xc1)]+_0x17ffdc(0xc7)]:_0x33e754});return _0x1d7c8e;}async[a271_0x364cd0(0xbf)](_0xf54b60,_0x222c18){const _0x25c8e6=a271_0x364cd0,_0x525ee8={},_0x260901=zip_1[_0x25c8e6(0xb5)][_0x25c8e6(0x79)]();for(const _0x31d780 of Object['keys'](_0xf54b60[_0x25c8e6(0xbc)])){_0x260901[_0x25c8e6(0xac)](_0x31d780,_0xf54b60[_0x25c8e6(0xbc)][_0x31d780],{'createFolders':!![]});}return _0x525ee8['ContentType']=_0x25c8e6(0x8c),_0x525ee8[_0x25c8e6(0x85)]=_0xf54b60['type'],_0x525ee8[_0x25c8e6(0x88)]=_0xf54b60['type'],_0x525ee8[_0x25c8e6(0xca)]=_0x222c18,_0x525ee8[_0x25c8e6(0xc3)]=await _0x260901[_0x25c8e6(0x93)]({'type':_0x25c8e6(0x9e),'compression':_0x25c8e6(0xa5),'compressionOptions':{'level':0x6}}),_0x525ee8;}[a271_0x364cd0(0x8e)](_0x3b9af0,_0xdf89c,_0x36a826){const _0x30d0ff=a271_0x364cd0,_0x4d8285=new Date()[_0x30d0ff(0x6e)](),_0x2fb0f1={};return _0x2fb0f1[constants_1[_0x30d0ff(0xc1)]+_0x30d0ff(0xd1)]=_0xdf89c,_0x2fb0f1[constants_1[_0x30d0ff(0xc1)]+'CRC32__c']=_0x3b9af0[_0x30d0ff(0xa9)],_0x2fb0f1[constants_1[_0x30d0ff(0xc1)]+'Changed_On__c']=_0x4d8285,_0x2fb0f1[constants_1['FLOSUM_NAMESPACE']+_0x30d0ff(0xb4)]=this[_0x30d0ff(0x71)],_0x2fb0f1[constants_1['FLOSUM_NAMESPACE']+_0x30d0ff(0xc2)]=_0x36a826?_0x36a826+0x1:0x1,_0x2fb0f1[constants_1['FLOSUM_GIT_NAMESPACE']+_0x30d0ff(0xba)]=!![],_0x2fb0f1;}['prepareComponentRecord'](_0x5d1195,_0x374376){const _0xc666f5=a271_0x364cd0;var _0x5c70d4,_0x29b9fd;const _0x4f7039=new Date()[_0xc666f5(0x6e)](),_0xae6394={};return!_0x374376?(this[_0xc666f5(0x98)]?(_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0x77)]=this[_0xc666f5(0x98)],_0xae6394[constants_1['FLOSUM_NAMESPACE']+_0xc666f5(0x92)]=_0xc666f5(0x7b),_0xae6394['RecordTypeId']=(_0x5c70d4=this[_0xc666f5(0xaa)][_0xc666f5(0xbb)](_0x5c0449=>_0x5c0449[_0xc666f5(0xa0)]===_0xc666f5(0x7b)))===null||_0x5c70d4===void 0x0?void 0x0:_0x5c70d4['id']):(_0xae6394[constants_1['FLOSUM_NAMESPACE']+_0xc666f5(0xcb)]=this[_0xc666f5(0x76)],_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0x92)]=_0xc666f5(0x9c),_0xae6394['RecordTypeId']=(_0x29b9fd=this[_0xc666f5(0xaa)]['find'](_0x300eb5=>_0x300eb5[_0xc666f5(0xa0)]==='Repository'))===null||_0x29b9fd===void 0x0?void 0x0:_0x29b9fd['id']),_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0xc2)]=0x1):_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0xc2)]=_0x374376[_0xc666f5(0x8d)]+0x1,_0xae6394[constants_1[_0xc666f5(0xc1)]+'Component_Type__c']=_0x5d1195[_0xc666f5(0xcd)],_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0xaf)]=_0x5d1195[_0xc666f5(0xa0)],_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0x6f)]=_0x5d1195[_0xc666f5(0x87)],_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0xc9)]=this[_0xc666f5(0x71)],_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0x9d)]=this['username'],_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0x8f)]=_0x4f7039,_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0x99)]=_0x4f7039,_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0xa4)]=_0x5d1195[_0xc666f5(0xa9)],_0xae6394[constants_1[_0xc666f5(0xc1)]+'Vlocity_Component_Name__c']=_0x5d1195[_0xc666f5(0x6d)],_0xae6394[constants_1[_0xc666f5(0xc1)]+_0xc666f5(0xb7)]=_0x5d1195[_0xc666f5(0xb0)],_0xae6394[constants_1['FLOSUM_NAMESPACE']+_0xc666f5(0x78)]=_0x5d1195[_0xc666f5(0xc5)],_0xae6394;}[a271_0x364cd0(0x6a)](){return this['proceededComponentsMeta'];}async['insert'](_0x29103e,_0x3e7cf4){const _0x2e22ae=a271_0x364cd0,_0x51c7e6=[];for(const _0x11a1c2 of _0x29103e){const _0x5e9b94=(0x0,composite_utils_1[_0x2e22ae(0x9f)])(constants_1[_0x2e22ae(0x9b)],this['prepareComponentRecord'](_0x11a1c2)),_0x5cdf98=(0x0,composite_utils_1[_0x2e22ae(0x9f)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x2e22ae(0x8e)](_0x11a1c2,'@{'+_0x5e9b94[_0x2e22ae(0xa7)]+_0x2e22ae(0xbd))),_0x2f9fb9=(0x0,composite_utils_1[_0x2e22ae(0x9f)])(constants_1[_0x2e22ae(0xcc)],await this[_0x2e22ae(0xbf)](_0x11a1c2,'@{'+_0x5cdf98[_0x2e22ae(0xa7)]+_0x2e22ae(0xbd)));this[_0x2e22ae(0xae)](_0x5e9b94['request'][_0x2e22ae(0x94)],_0x5e9b94[_0x2e22ae(0xa7)]),_0x51c7e6[_0x2e22ae(0xa3)](_0x5e9b94['request'],_0x5cdf98[_0x2e22ae(0xa2)],_0x2f9fb9[_0x2e22ae(0xa2)]),_0x3e7cf4&&_0x51c7e6[_0x2e22ae(0xa3)](this[_0x2e22ae(0x90)](_0x3e7cf4,'@{'+_0x5cdf98[_0x2e22ae(0xa7)]+_0x2e22ae(0xbd)));}return _0x51c7e6;}async['update'](_0x1a7b4b,_0x29d048=''){const _0x59192d=a271_0x364cd0,_0x585a4b=[];for(const {component:_0x45bcae,meta:_0x50557c}of _0x1a7b4b){if(!_0x50557c['id']){const _0x168eb5=this[_0x59192d(0x7d)][_0x59192d(0xbb)](_0x43724c=>_0x43724c[_0x59192d(0xc8)]===_0x45bcae[_0x59192d(0xa0)]&&_0x43724c['componentType']===_0x45bcae['type']);if(!_0x168eb5)throw new salesforce_error_1[(_0x59192d(0xa1))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x45bcae[_0x59192d(0xa0)]+'\x20['+_0x45bcae[_0x59192d(0xcd)]+']\x20-\x20meta\x20not\x20found'));_0x50557c['id']=_0x168eb5['componentId'];}const _0x3106f4=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x59192d(0x9b)],_0x50557c['id'],this['prepareComponentRecord'](_0x45bcae,_0x50557c)),_0x282799=(0x0,composite_utils_1[_0x59192d(0x9f)])(constants_1[_0x59192d(0xb9)],this['prepareComponentHistoryRecord'](_0x45bcae,_0x50557c['id'],_0x50557c['version'])),_0x22d771=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x59192d(0xcc)],await this[_0x59192d(0xbf)](_0x45bcae,'@{'+_0x282799['reference']+_0x59192d(0xbd)));this[_0x59192d(0xae)](_0x3106f4[_0x59192d(0xa2)][_0x59192d(0x94)],_0x3106f4[_0x59192d(0xa7)]),_0x585a4b[_0x59192d(0xa3)](_0x3106f4[_0x59192d(0xa2)],_0x282799[_0x59192d(0xa2)],_0x22d771[_0x59192d(0xa2)]),_0x29d048&&_0x585a4b[_0x59192d(0xa3)](this[_0x59192d(0x90)](_0x29d048,'@{'+_0x282799[_0x59192d(0xa7)]+_0x59192d(0xbd)));}return _0x585a4b;}async[a271_0x364cd0(0x6b)](_0x43463b,_0x127466=![]){const _0xba391a=a271_0x364cd0,_0x21f7fb={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x48e96e=[];for(const _0x4941bf of _0x43463b){if(_0x4941bf['id'])_0x48e96e[_0xba391a(0xa3)](_0x4941bf['id']);else{const _0x3ee222=this[_0xba391a(0x7d)]['find'](_0x468b54=>_0x468b54[_0xba391a(0xc8)]===_0x4941bf['name']&&_0x468b54[_0xba391a(0x81)]===_0x4941bf[_0xba391a(0xcd)]);if(!_0x3ee222||!_0x3ee222['componentId'])continue;_0x48e96e[_0xba391a(0xa3)](_0x3ee222[_0xba391a(0x84)]);}}if(_0x127466){const _0x1240ea=await this[_0xba391a(0x75)]['fetchCommitManifestsByComponentIds'](_0x48e96e);_0x21f7fb[_0xba391a(0x72)]=_0x1240ea[_0xba391a(0x97)](_0x4037ee=>(0x0,composite_utils_1[_0xba391a(0x6c)])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x4037ee)[_0xba391a(0xa2)]);}return _0x21f7fb['componentsToUpdate']=_0x48e96e['map'](_0x4ca202=>(0x0,composite_utils_1[_0xba391a(0x73)])(constants_1['FLOSUM_COMPONENT'],_0x4ca202,{[constants_1[_0xba391a(0x8b)]+_0xba391a(0x86)]:!![]})['request']),_0x21f7fb[_0xba391a(0x7c)]=_0x48e96e['map'](_0x27e694=>(0x0,composite_utils_1[_0xba391a(0x6c)])(constants_1['FLOSUM_COMPONENT'],_0x27e694)[_0xba391a(0xa2)]),_0x21f7fb;}}function a271_0x46ec(){const _0x2525bc=['marketingCloudKey','Logger','Component_History__c','componentName','Last_Updated_By__c','ParentId','Repository__c','FLOSUM_ATTACHMENT','type','defineProperty','2966868pwYejg','../errors/salesforce.error','Component__c','13218PrwKak','Component_Type__c','../utils/composite.utils','getProceededComponentsMeta','delete','createDeleteRequest','vlocityComponentName','toISOString','File_Name__c','1386895MFsqzj','username','manifests','createPatchRequest','./salesforce-git-sync.service','gitSync','repositoryId','Branch__c','MC_Key__c','createZip','6ZWopQG','Branch','componentsToDelete','proceededComponentsMeta','apply','11795700FACXol','logger','componentType','../../../../constants','../utils/flosum-naming.utils','componentId','Name','Deletion_By_Agent__c','filePath','Description','Commit__c','5575962hKnHUk','FLOSUM_GIT_NAMESPACE','application/zip','version','prepareComponentHistoryRecord','Last_Modified_Date__c','prepareCommitManifest','SalesforceGitSyncService','Source__c','generateAsync','body','default','189tQkVvT','map','branchId','Committed_On__c','get','FLOSUM_COMPONENT','Repository','Last_Modified_By__c','base64','createPostRequest','name','SalesforceError','request','push','CRC32__c','DEFLATE','search','reference','67509TkDrmO','crc','recordTypes','../../parsers/utils/zip','file','SalesforceComponentsManager','proceedComponentMeta','Component_Name__c','isVlocityComponent','__importDefault','toString','FLOSUM_COMMIT_MANIFEST','Changed_By__c','Zip','(((.+)+)+)+$','Vlocity_Component__c','constructor','FLOSUM_COMPONENT_HISTORY','Is_From_Agent__c','find','files','.id}','1928ihnaoG','prepareComponentAttachmentRecord','1912578jnmjsD','FLOSUM_NAMESPACE','Version__c','Body','__esModule'];a271_0x46ec=function(){return _0x2525bc;};return a271_0x46ec();}exports[a271_0x364cd0(0xad)]=SalesforceComponentsManager;