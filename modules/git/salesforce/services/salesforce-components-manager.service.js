const a229_0x3b6d9c=a229_0x5ec6;(function(_0x3fd5b8,_0x88ff5c){const _0x425cd4=a229_0x5ec6,_0x1868ba=_0x3fd5b8();while(!![]){try{const _0x1359f7=-parseInt(_0x425cd4(0xa0))/0x1+-parseInt(_0x425cd4(0xf0))/0x2*(parseInt(_0x425cd4(0xb9))/0x3)+parseInt(_0x425cd4(0x95))/0x4*(parseInt(_0x425cd4(0xa6))/0x5)+-parseInt(_0x425cd4(0xfb))/0x6*(-parseInt(_0x425cd4(0x9d))/0x7)+-parseInt(_0x425cd4(0xc8))/0x8+parseInt(_0x425cd4(0xba))/0x9*(-parseInt(_0x425cd4(0xd4))/0xa)+parseInt(_0x425cd4(0xda))/0xb;if(_0x1359f7===_0x88ff5c)break;else _0x1868ba['push'](_0x1868ba['shift']());}catch(_0x5a82e9){_0x1868ba['push'](_0x1868ba['shift']());}}}(a229_0x23a8,0x99dc8));const a229_0x372814=(function(){let _0x53ae88=!![];return function(_0x9b879e,_0x22fd64){const _0x1094c6=_0x53ae88?function(){const _0x1e26e4=a229_0x5ec6;if(_0x22fd64){const _0x3adeb6=_0x22fd64[_0x1e26e4(0xed)](_0x9b879e,arguments);return _0x22fd64=null,_0x3adeb6;}}:function(){};return _0x53ae88=![],_0x1094c6;};}()),a229_0x248f9=a229_0x372814(this,function(){const _0x21f0c1=a229_0x5ec6;return a229_0x248f9[_0x21f0c1(0x9f)]()['search'](_0x21f0c1(0xfa))[_0x21f0c1(0x9f)]()[_0x21f0c1(0xc3)](a229_0x248f9)[_0x21f0c1(0xf9)](_0x21f0c1(0xfa));});a229_0x248f9();function a229_0x5ec6(_0x21345b,_0xb503a5){const _0x16ae4a=a229_0x23a8();return a229_0x5ec6=function(_0x248f9,_0x372814){_0x248f9=_0x248f9-0x93;let _0x23a89d=_0x16ae4a[_0x248f9];return _0x23a89d;},a229_0x5ec6(_0x21345b,_0xb503a5);}'use strict';var __importDefault=this&&this[a229_0x3b6d9c(0xd5)]||function(_0x3e5bf4){return _0x3e5bf4&&_0x3e5bf4['__esModule']?_0x3e5bf4:{'default':_0x3e5bf4};};Object[a229_0x3b6d9c(0xca)](exports,a229_0x3b6d9c(0xb3),{'value':!![]}),exports[a229_0x3b6d9c(0x9c)]=void 0x0;function a229_0x23a8(){const _0x3c6c55=['Source__c','Component_History__c','Zip','FLOSUM_GIT_NAMESPACE','files','fetchCommitManifestsByComponentIds','update','search','(((.+)+)+)+$','54bjffbf','proceededComponentsMeta','name','356wUiCFH','get','keys','createDeleteRequest','repositoryId','branchId','find','SalesforceComponentsManager','263277jfQRFu','request','toString','988541EimqJI','componentName','../utils/composite.utils','SalesforceError','Commit__c','./salesforce-git-sync.service','12605lUeiJl','prepareComponentHistoryRecord','Branch','Logger','recordTypes','Changed_By__c','createZip','DEFLATE','extractFieldsFromRecord','createPatchRequest','Committed_On__c','.id}','FLOSUM_ATTACHMENT','__esModule','type','map','componentType','reference','generateAsync','1021719qwOlDt','18xpYnZG','createPostRequest','Component_Type__c','proceedComponentMeta','Component_Name__c','getProceededComponentsMeta','typedi','Version__c','filePath','constructor','crc','prepareComponentRecord','CRC32__c','toISOString','5038048VhNjeW','username','defineProperty','../errors/salesforce.error','Name','Repository__c','Repository','componentId','Branch__c','Last_Modified_By__c','../../parsers/utils/zip','FLOSUM_NAMESPACE','3890940JvfVWL','__importDefault','push','file','SalesforceGitSyncService','manifests','30848466sCUWzp','prepareComponentAttachmentRecord','Description','delete','Component__c','Changed_On__c','RecordTypeId','version','../../../../constants','gitSync','base64','Body','Could\x20not\x20proceed\x20component\x20','FLOSUM_COMPONENT','FLOSUM_COMPONENT_HISTORY','Last_Updated_By__c','FLOSUM_COMMIT_MANIFEST','application/zip','prepareCommitManifest','apply','componentsToUpdate','body','2YjpyXY','ParentId'];a229_0x23a8=function(){return _0x3c6c55;};return a229_0x23a8();}const constants_1=require(a229_0x3b6d9c(0xe2)),core_1=require('../../../../core'),zip_1=require(a229_0x3b6d9c(0xd2)),typedi_1=__importDefault(require(a229_0x3b6d9c(0xc0))),salesforce_error_1=require(a229_0x3b6d9c(0xcb)),composite_utils_1=require(a229_0x3b6d9c(0xa2)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a229_0x3b6d9c(0xa5));class SalesforceComponentsManager{constructor(_0x1f069d,_0x50eaa8,_0x456716,_0x46e335,_0x23fa31){const _0x1a5295=a229_0x3b6d9c;this[_0x1a5295(0x99)]=_0x1f069d,this[_0x1a5295(0x9a)]=_0x50eaa8,this['username']=_0x456716,this[_0x1a5295(0xaa)]=_0x46e335,this[_0x1a5295(0x93)]=_0x23fa31,this['logger']=new core_1[(_0x1a5295(0xa9))](SalesforceComponentsManager[_0x1a5295(0x94)]),this['gitSync']=typedi_1['default'][_0x1a5295(0x96)](salesforce_git_sync_service_1[_0x1a5295(0xd8)]);}[a229_0x3b6d9c(0xbd)](_0x4450e1,_0x3b1205){const _0x14a200=a229_0x3b6d9c,_0x67dd31=(0x0,flosum_naming_utils_1[_0x14a200(0xae)])(_0x4450e1,[_0x14a200(0xbc),'Component_Name__c',_0x14a200(0xc1)]);this[_0x14a200(0x93)][_0x14a200(0xd6)]({'componentId':'','reference':_0x3b1205,'version':_0x67dd31[_0x14a200(0xc1)],'componentName':_0x67dd31[_0x14a200(0xbe)],'componentType':_0x67dd31[_0x14a200(0xbc)]});}['prepareCommitManifest'](_0xde05cb,_0x3f3111){const _0x556696=a229_0x3b6d9c,{request:_0x31edc0}=(0x0,composite_utils_1[_0x556696(0xbb)])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x556696(0xd3)]+_0x556696(0xa4)]:_0xde05cb,[constants_1[_0x556696(0xd3)]+_0x556696(0xf3)]:_0x3f3111});return _0x31edc0;}async[a229_0x3b6d9c(0xdb)](_0x445120,_0x281b46){const _0x12b3a0=a229_0x3b6d9c,_0x16eb80={},_0xf656e2=zip_1[_0x12b3a0(0xf4)][_0x12b3a0(0xac)]();for(const _0x34b6fc of Object[_0x12b3a0(0x97)](_0x445120[_0x12b3a0(0xf6)])){_0xf656e2[_0x12b3a0(0xd7)](_0x34b6fc,_0x445120['files'][_0x34b6fc],{'createFolders':!![]});}return _0x16eb80['ContentType']=_0x12b3a0(0xeb),_0x16eb80[_0x12b3a0(0xcc)]=_0x445120[_0x12b3a0(0xb4)],_0x16eb80[_0x12b3a0(0xdc)]=_0x445120[_0x12b3a0(0xb4)],_0x16eb80[_0x12b3a0(0xf1)]=_0x281b46,_0x16eb80[_0x12b3a0(0xe5)]=await _0xf656e2[_0x12b3a0(0xb8)]({'type':_0x12b3a0(0xe4),'compression':_0x12b3a0(0xad),'compressionOptions':{'level':0x6}}),_0x16eb80;}[a229_0x3b6d9c(0xa7)](_0x565213,_0x4c1978,_0x1197d5){const _0x294d46=a229_0x3b6d9c,_0x450378=new Date()[_0x294d46(0xc7)](),_0x4f6ff3={};return _0x4f6ff3[constants_1[_0x294d46(0xd3)]+_0x294d46(0xde)]=_0x4c1978,_0x4f6ff3[constants_1[_0x294d46(0xd3)]+_0x294d46(0xc6)]=_0x565213[_0x294d46(0xc4)],_0x4f6ff3[constants_1[_0x294d46(0xd3)]+_0x294d46(0xdf)]=_0x450378,_0x4f6ff3[constants_1[_0x294d46(0xd3)]+_0x294d46(0xab)]=this[_0x294d46(0xc9)],_0x4f6ff3[constants_1[_0x294d46(0xd3)]+_0x294d46(0xc1)]=_0x1197d5?_0x1197d5+0x1:0x1,_0x4f6ff3[constants_1[_0x294d46(0xf5)]+'Is_From_Agent__c']=!![],_0x4f6ff3;}[a229_0x3b6d9c(0xc5)](_0x2d51b9,_0x2ed847){const _0x50d8e7=a229_0x3b6d9c;var _0x340595,_0x3a05e6;const _0x45e786=new Date()[_0x50d8e7(0xc7)](),_0x5789ff={};return!_0x2ed847?(this[_0x50d8e7(0x9a)]?(_0x5789ff[constants_1['FLOSUM_NAMESPACE']+_0x50d8e7(0xd0)]=this[_0x50d8e7(0x9a)],_0x5789ff[constants_1['FLOSUM_NAMESPACE']+_0x50d8e7(0xf2)]='Branch',_0x5789ff[_0x50d8e7(0xe0)]=(_0x340595=this[_0x50d8e7(0xaa)][_0x50d8e7(0x9b)](_0x186808=>_0x186808[_0x50d8e7(0x94)]===_0x50d8e7(0xa8)))===null||_0x340595===void 0x0?void 0x0:_0x340595['id']):(_0x5789ff[constants_1[_0x50d8e7(0xd3)]+_0x50d8e7(0xcd)]=this[_0x50d8e7(0x99)],_0x5789ff[constants_1[_0x50d8e7(0xd3)]+_0x50d8e7(0xf2)]=_0x50d8e7(0xce),_0x5789ff[_0x50d8e7(0xe0)]=(_0x3a05e6=this[_0x50d8e7(0xaa)][_0x50d8e7(0x9b)](_0x3aa012=>_0x3aa012['name']===_0x50d8e7(0xce)))===null||_0x3a05e6===void 0x0?void 0x0:_0x3a05e6['id']),_0x5789ff[constants_1[_0x50d8e7(0xd3)]+_0x50d8e7(0xc1)]=0x1):_0x5789ff[constants_1[_0x50d8e7(0xd3)]+'Version__c']=_0x2ed847[_0x50d8e7(0xe1)]+0x1,_0x5789ff[constants_1[_0x50d8e7(0xd3)]+'Component_Type__c']=_0x2d51b9[_0x50d8e7(0xb4)],_0x5789ff[constants_1[_0x50d8e7(0xd3)]+_0x50d8e7(0xbe)]=_0x2d51b9[_0x50d8e7(0x94)],_0x5789ff[constants_1[_0x50d8e7(0xd3)]+'File_Name__c']=_0x2d51b9[_0x50d8e7(0xc2)],_0x5789ff[constants_1[_0x50d8e7(0xd3)]+_0x50d8e7(0xe9)]=this['username'],_0x5789ff[constants_1['FLOSUM_NAMESPACE']+_0x50d8e7(0xd1)]=this[_0x50d8e7(0xc9)],_0x5789ff[constants_1[_0x50d8e7(0xd3)]+'Last_Modified_Date__c']=_0x45e786,_0x5789ff[constants_1[_0x50d8e7(0xd3)]+_0x50d8e7(0xb0)]=_0x45e786,_0x5789ff[constants_1[_0x50d8e7(0xd3)]+_0x50d8e7(0xc6)]=_0x2d51b9['crc'],_0x5789ff;}[a229_0x3b6d9c(0xbf)](){const _0x29c3c3=a229_0x3b6d9c;return this[_0x29c3c3(0x93)];}async['insert'](_0x2960c7,_0x50dfd6){const _0xe5b061=a229_0x3b6d9c,_0x4ec1be=[];for(const _0x158ce9 of _0x2960c7){const _0x397afe=(0x0,composite_utils_1[_0xe5b061(0xbb)])(constants_1[_0xe5b061(0xe7)],this[_0xe5b061(0xc5)](_0x158ce9)),_0x580a1c=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0xe5b061(0xe8)],this[_0xe5b061(0xa7)](_0x158ce9,'@{'+_0x397afe[_0xe5b061(0xb7)]+_0xe5b061(0xb1))),_0x3f5142=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0xe5b061(0xb2)],await this[_0xe5b061(0xdb)](_0x158ce9,'@{'+_0x580a1c['reference']+_0xe5b061(0xb1)));this[_0xe5b061(0xbd)](_0x397afe[_0xe5b061(0x9e)][_0xe5b061(0xef)],_0x397afe[_0xe5b061(0xb7)]),_0x4ec1be[_0xe5b061(0xd6)](_0x397afe[_0xe5b061(0x9e)],_0x580a1c['request'],_0x3f5142[_0xe5b061(0x9e)]),_0x50dfd6&&_0x4ec1be[_0xe5b061(0xd6)](this[_0xe5b061(0xec)](_0x50dfd6,'@{'+_0x580a1c[_0xe5b061(0xb7)]+'.id}'));}return _0x4ec1be;}async[a229_0x3b6d9c(0xf8)](_0x37ad59,_0x3c347e=''){const _0x9c71c4=a229_0x3b6d9c,_0x510512=[];for(const {component:_0x87b5bf,meta:_0xb540ea}of _0x37ad59){if(!_0xb540ea['id']){const _0x24d862=this[_0x9c71c4(0x93)][_0x9c71c4(0x9b)](_0x1d0b96=>_0x1d0b96[_0x9c71c4(0xa1)]===_0x87b5bf['name']&&_0x1d0b96[_0x9c71c4(0xb6)]===_0x87b5bf[_0x9c71c4(0xb4)]);if(!_0x24d862)throw new salesforce_error_1[(_0x9c71c4(0xa3))](new Error(_0x9c71c4(0xe6)+_0x87b5bf[_0x9c71c4(0x94)]+'\x20['+_0x87b5bf[_0x9c71c4(0xb4)]+']\x20-\x20meta\x20not\x20found'));_0xb540ea['id']=_0x24d862[_0x9c71c4(0xcf)];}const _0xa6d745=(0x0,composite_utils_1[_0x9c71c4(0xaf)])(constants_1[_0x9c71c4(0xe7)],_0xb540ea['id'],this[_0x9c71c4(0xc5)](_0x87b5bf,_0xb540ea)),_0x4d892b=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x9c71c4(0xe8)],this[_0x9c71c4(0xa7)](_0x87b5bf,_0xb540ea['id'],_0xb540ea[_0x9c71c4(0xe1)])),_0x47d256=(0x0,composite_utils_1[_0x9c71c4(0xbb)])(constants_1[_0x9c71c4(0xb2)],await this[_0x9c71c4(0xdb)](_0x87b5bf,'@{'+_0x4d892b[_0x9c71c4(0xb7)]+_0x9c71c4(0xb1)));this[_0x9c71c4(0xbd)](_0xa6d745[_0x9c71c4(0x9e)][_0x9c71c4(0xef)],_0xa6d745[_0x9c71c4(0xb7)]),_0x510512[_0x9c71c4(0xd6)](_0xa6d745['request'],_0x4d892b[_0x9c71c4(0x9e)],_0x47d256[_0x9c71c4(0x9e)]),_0x3c347e&&_0x510512[_0x9c71c4(0xd6)](this[_0x9c71c4(0xec)](_0x3c347e,'@{'+_0x4d892b['reference']+_0x9c71c4(0xb1)));}return _0x510512;}async[a229_0x3b6d9c(0xdd)](_0x1a7bf1,_0x7a98b1=![]){const _0x5d3992=a229_0x3b6d9c,_0x32584e={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x588bbe=[];for(const _0x594178 of _0x1a7bf1){if(_0x594178['id'])_0x588bbe[_0x5d3992(0xd6)](_0x594178['id']);else{const _0xcf834e=this[_0x5d3992(0x93)][_0x5d3992(0x9b)](_0x11dd73=>_0x11dd73[_0x5d3992(0xa1)]===_0x594178[_0x5d3992(0x94)]&&_0x11dd73['componentType']===_0x594178['type']);if(!_0xcf834e||!_0xcf834e[_0x5d3992(0xcf)])continue;_0x588bbe['push'](_0xcf834e[_0x5d3992(0xcf)]);}}if(_0x7a98b1){const _0x1df991=await this[_0x5d3992(0xe3)][_0x5d3992(0xf7)](_0x588bbe);_0x32584e[_0x5d3992(0xd9)]=_0x1df991[_0x5d3992(0xb5)](_0x4416fa=>(0x0,composite_utils_1[_0x5d3992(0x98)])(constants_1[_0x5d3992(0xea)],_0x4416fa)[_0x5d3992(0x9e)]);}return _0x32584e[_0x5d3992(0xee)]=_0x588bbe[_0x5d3992(0xb5)](_0x419034=>(0x0,composite_utils_1['createPatchRequest'])(constants_1['FLOSUM_COMPONENT'],_0x419034,{[constants_1[_0x5d3992(0xf5)]+'Deletion_By_Agent__c']:!![]})['request']),_0x32584e['componentsToDelete']=_0x588bbe['map'](_0xb6d962=>(0x0,composite_utils_1[_0x5d3992(0x98)])(constants_1['FLOSUM_COMPONENT'],_0xb6d962)[_0x5d3992(0x9e)]),_0x32584e;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;