const a234_0xd5be13=a234_0x2835;(function(_0x4f63d6,_0x2588ce){const _0xdc2f5d=a234_0x2835,_0x5225cf=_0x4f63d6();while(!![]){try{const _0x5e58b4=parseInt(_0xdc2f5d(0x1dc))/0x1+-parseInt(_0xdc2f5d(0x1b1))/0x2+parseInt(_0xdc2f5d(0x18d))/0x3*(-parseInt(_0xdc2f5d(0x18e))/0x4)+-parseInt(_0xdc2f5d(0x1c4))/0x5*(-parseInt(_0xdc2f5d(0x184))/0x6)+-parseInt(_0xdc2f5d(0x181))/0x7*(parseInt(_0xdc2f5d(0x1b9))/0x8)+-parseInt(_0xdc2f5d(0x1ca))/0x9*(-parseInt(_0xdc2f5d(0x1bf))/0xa)+-parseInt(_0xdc2f5d(0x1e5))/0xb*(-parseInt(_0xdc2f5d(0x1a5))/0xc);if(_0x5e58b4===_0x2588ce)break;else _0x5225cf['push'](_0x5225cf['shift']());}catch(_0x2d6dc0){_0x5225cf['push'](_0x5225cf['shift']());}}}(a234_0x5d10,0xcf3d9));function a234_0x2835(_0x5070c6,_0x2a252d){const _0x427151=a234_0x5d10();return a234_0x2835=function(_0x465a3d,_0x225804){_0x465a3d=_0x465a3d-0x17d;let _0x5d107d=_0x427151[_0x465a3d];return _0x5d107d;},a234_0x2835(_0x5070c6,_0x2a252d);}const a234_0x225804=(function(){let _0x58d5d8=!![];return function(_0x246523,_0x56e96e){const _0x174f07=_0x58d5d8?function(){const _0x30f789=a234_0x2835;if(_0x56e96e){const _0x533dd1=_0x56e96e[_0x30f789(0x1d6)](_0x246523,arguments);return _0x56e96e=null,_0x533dd1;}}:function(){};return _0x58d5d8=![],_0x174f07;};}()),a234_0x465a3d=a234_0x225804(this,function(){const _0x1b22a2=a234_0x2835;return a234_0x465a3d[_0x1b22a2(0x1d1)]()['search'](_0x1b22a2(0x1ad))[_0x1b22a2(0x1d1)]()[_0x1b22a2(0x1c9)](a234_0x465a3d)['search'](_0x1b22a2(0x1ad));});a234_0x465a3d();'use strict';var __importDefault=this&&this[a234_0xd5be13(0x1e8)]||function(_0x2895fc){const _0xa34e7=a234_0xd5be13;return _0x2895fc&&_0x2895fc[_0xa34e7(0x189)]?_0x2895fc:{'default':_0x2895fc};};Object['defineProperty'](exports,a234_0xd5be13(0x189),{'value':!![]}),exports[a234_0xd5be13(0x1de)]=void 0x0;const constants_1=require(a234_0xd5be13(0x190)),core_1=require(a234_0xd5be13(0x197)),zip_1=require(a234_0xd5be13(0x1ab)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a234_0xd5be13(0x196)),flosum_naming_utils_1=require(a234_0xd5be13(0x19d)),salesforce_git_sync_service_1=require(a234_0xd5be13(0x19f));class SalesforceComponentsManager{constructor(_0x274525,_0x13c6a5,_0x32236c,_0x48e200,_0x4aa1df){const _0x1f21cc=a234_0xd5be13;this[_0x1f21cc(0x19e)]=_0x274525,this[_0x1f21cc(0x182)]=_0x13c6a5,this[_0x1f21cc(0x1ba)]=_0x32236c,this[_0x1f21cc(0x1c3)]=_0x48e200,this[_0x1f21cc(0x1c1)]=_0x4aa1df,this[_0x1f21cc(0x19b)]=new core_1['Logger'](SalesforceComponentsManager[_0x1f21cc(0x1be)]),this['gitSync']=typedi_1[_0x1f21cc(0x1cd)][_0x1f21cc(0x1e2)](salesforce_git_sync_service_1[_0x1f21cc(0x18c)]);}[a234_0xd5be13(0x1a7)](_0x121bfe,_0x5e592d){const _0x11fa41=a234_0xd5be13,_0x5d3011=(0x0,flosum_naming_utils_1[_0x11fa41(0x199)])(_0x121bfe,[_0x11fa41(0x1b3),_0x11fa41(0x192),'Version__c']);this[_0x11fa41(0x1c1)][_0x11fa41(0x19c)]({'componentId':'','reference':_0x5e592d,'version':_0x5d3011[_0x11fa41(0x1cb)],'componentName':_0x5d3011[_0x11fa41(0x192)],'componentType':_0x5d3011['Component_Type__c']});}[a234_0xd5be13(0x1ac)](_0x41d8f2,_0x51de41){const _0x44064c=a234_0xd5be13,{request:_0x148436}=(0x0,composite_utils_1[_0x44064c(0x1a0)])(constants_1[_0x44064c(0x1b5)],{[constants_1[_0x44064c(0x191)]+_0x44064c(0x1dd)]:_0x41d8f2,[constants_1[_0x44064c(0x191)]+_0x44064c(0x198)]:_0x51de41});return _0x148436;}async['prepareComponentAttachmentRecord'](_0x557dba,_0x4ea999){const _0x346f06=a234_0xd5be13,_0x1fc7f4={},_0x381437=zip_1[_0x346f06(0x1cc)][_0x346f06(0x1c5)]();for(const _0x28d3a1 of Object[_0x346f06(0x19a)](_0x557dba[_0x346f06(0x1e3)])){_0x381437[_0x346f06(0x1e1)](_0x28d3a1,_0x557dba[_0x346f06(0x1e3)][_0x28d3a1],{'createFolders':!![]});}return _0x1fc7f4['ContentType']=_0x346f06(0x1d2),_0x1fc7f4[_0x346f06(0x1e6)]=_0x557dba[_0x346f06(0x1bd)],_0x1fc7f4['Description']=_0x557dba[_0x346f06(0x1bd)],_0x1fc7f4[_0x346f06(0x1aa)]=_0x4ea999,_0x1fc7f4[_0x346f06(0x1d4)]=await _0x381437[_0x346f06(0x1bb)]({'type':_0x346f06(0x18a),'compression':_0x346f06(0x1d8),'compressionOptions':{'level':0x6}}),_0x1fc7f4;}[a234_0xd5be13(0x18f)](_0x98784c,_0x58a228,_0x46b679){const _0x239b2d=a234_0xd5be13,_0x234398=new Date()[_0x239b2d(0x1db)](),_0x175131={};return _0x175131[constants_1[_0x239b2d(0x191)]+_0x239b2d(0x1a3)]=_0x58a228,_0x175131[constants_1[_0x239b2d(0x191)]+_0x239b2d(0x1a1)]=_0x98784c['crc'],_0x175131[constants_1['FLOSUM_NAMESPACE']+_0x239b2d(0x1d9)]=_0x234398,_0x175131[constants_1[_0x239b2d(0x191)]+_0x239b2d(0x1e0)]=this[_0x239b2d(0x1ba)],_0x175131[constants_1[_0x239b2d(0x191)]+'Version__c']=_0x46b679?_0x46b679+0x1:0x1,_0x175131[constants_1[_0x239b2d(0x193)]+_0x239b2d(0x1c0)]=!![],_0x175131;}[a234_0xd5be13(0x18b)](_0x5cb0f5,_0x1499c6){const _0x57087f=a234_0xd5be13;var _0x324cf8,_0x150a4e;const _0x53883c=new Date()[_0x57087f(0x1db)](),_0x21ccc9={};return!_0x1499c6?(this[_0x57087f(0x182)]?(_0x21ccc9[constants_1[_0x57087f(0x191)]+_0x57087f(0x17f)]=this[_0x57087f(0x182)],_0x21ccc9[constants_1[_0x57087f(0x191)]+_0x57087f(0x1c7)]=_0x57087f(0x1bc),_0x21ccc9[_0x57087f(0x1b4)]=(_0x324cf8=this['recordTypes'][_0x57087f(0x1e7)](_0x43e052=>_0x43e052['name']===_0x57087f(0x1bc)))===null||_0x324cf8===void 0x0?void 0x0:_0x324cf8['id']):(_0x21ccc9[constants_1['FLOSUM_NAMESPACE']+_0x57087f(0x1b8)]=this[_0x57087f(0x19e)],_0x21ccc9[constants_1[_0x57087f(0x191)]+_0x57087f(0x1c7)]='Repository',_0x21ccc9['RecordTypeId']=(_0x150a4e=this[_0x57087f(0x1c3)][_0x57087f(0x1e7)](_0x4cd00f=>_0x4cd00f[_0x57087f(0x1be)]===_0x57087f(0x1ce)))===null||_0x150a4e===void 0x0?void 0x0:_0x150a4e['id']),_0x21ccc9[constants_1['FLOSUM_NAMESPACE']+_0x57087f(0x1cb)]=0x1):_0x21ccc9[constants_1[_0x57087f(0x191)]+_0x57087f(0x1cb)]=_0x1499c6[_0x57087f(0x194)]+0x1,_0x21ccc9[constants_1[_0x57087f(0x191)]+_0x57087f(0x1b3)]=_0x5cb0f5[_0x57087f(0x1bd)],_0x21ccc9[constants_1[_0x57087f(0x191)]+_0x57087f(0x192)]=_0x5cb0f5[_0x57087f(0x1be)],_0x21ccc9[constants_1[_0x57087f(0x191)]+_0x57087f(0x1d3)]=_0x5cb0f5[_0x57087f(0x1c6)],_0x21ccc9[constants_1[_0x57087f(0x191)]+_0x57087f(0x185)]=this[_0x57087f(0x1ba)],_0x21ccc9[constants_1['FLOSUM_NAMESPACE']+_0x57087f(0x1cf)]=this[_0x57087f(0x1ba)],_0x21ccc9[constants_1[_0x57087f(0x191)]+_0x57087f(0x1d7)]=_0x53883c,_0x21ccc9[constants_1[_0x57087f(0x191)]+'Committed_On__c']=_0x53883c,_0x21ccc9[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x5cb0f5[_0x57087f(0x1b6)],_0x21ccc9[constants_1[_0x57087f(0x191)]+'Vlocity_Component_Name__c']=_0x5cb0f5['vlocityComponentName'],_0x21ccc9[constants_1[_0x57087f(0x191)]+_0x57087f(0x186)]=_0x5cb0f5[_0x57087f(0x17e)],_0x21ccc9;}['getProceededComponentsMeta'](){return this['proceededComponentsMeta'];}async['insert'](_0x14d8d5,_0x4010f5){const _0x1a39cd=a234_0xd5be13,_0x175170=[];for(const _0x4571c2 of _0x14d8d5){const _0x14aa6a=(0x0,composite_utils_1[_0x1a39cd(0x1a0)])(constants_1[_0x1a39cd(0x187)],this['prepareComponentRecord'](_0x4571c2)),_0x57c5ed=(0x0,composite_utils_1[_0x1a39cd(0x1a0)])(constants_1[_0x1a39cd(0x183)],this[_0x1a39cd(0x18f)](_0x4571c2,'@{'+_0x14aa6a[_0x1a39cd(0x1c8)]+_0x1a39cd(0x1a2))),_0x494edd=(0x0,composite_utils_1[_0x1a39cd(0x1a0)])(constants_1[_0x1a39cd(0x1b2)],await this[_0x1a39cd(0x1da)](_0x4571c2,'@{'+_0x57c5ed['reference']+_0x1a39cd(0x1a2)));this['proceedComponentMeta'](_0x14aa6a[_0x1a39cd(0x1a6)][_0x1a39cd(0x188)],_0x14aa6a[_0x1a39cd(0x1c8)]),_0x175170['push'](_0x14aa6a[_0x1a39cd(0x1a6)],_0x57c5ed['request'],_0x494edd[_0x1a39cd(0x1a6)]),_0x4010f5&&_0x175170[_0x1a39cd(0x19c)](this[_0x1a39cd(0x1ac)](_0x4010f5,'@{'+_0x57c5ed['reference']+_0x1a39cd(0x1a2)));}return _0x175170;}async[a234_0xd5be13(0x1e4)](_0x455ef6,_0x36c452=''){const _0x37eead=a234_0xd5be13,_0x2a3b07=[];for(const {component:_0x756fa4,meta:_0x313dd4}of _0x455ef6){if(!_0x313dd4['id']){const _0x136d72=this[_0x37eead(0x1c1)][_0x37eead(0x1e7)](_0x33a69b=>_0x33a69b[_0x37eead(0x1af)]===_0x756fa4[_0x37eead(0x1be)]&&_0x33a69b[_0x37eead(0x1a9)]===_0x756fa4['type']);if(!_0x136d72)throw new salesforce_error_1['SalesforceError'](new Error(_0x37eead(0x1df)+_0x756fa4[_0x37eead(0x1be)]+'\x20['+_0x756fa4[_0x37eead(0x1bd)]+_0x37eead(0x1a4)));_0x313dd4['id']=_0x136d72['componentId'];}const _0x2acb7d=(0x0,composite_utils_1[_0x37eead(0x180)])(constants_1[_0x37eead(0x187)],_0x313dd4['id'],this[_0x37eead(0x18b)](_0x756fa4,_0x313dd4)),_0x5ba61b=(0x0,composite_utils_1[_0x37eead(0x1a0)])(constants_1[_0x37eead(0x183)],this[_0x37eead(0x18f)](_0x756fa4,_0x313dd4['id'],_0x313dd4[_0x37eead(0x194)])),_0x45af8d=(0x0,composite_utils_1[_0x37eead(0x1a0)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x37eead(0x1da)](_0x756fa4,'@{'+_0x5ba61b[_0x37eead(0x1c8)]+_0x37eead(0x1a2)));this[_0x37eead(0x1a7)](_0x2acb7d[_0x37eead(0x1a6)][_0x37eead(0x188)],_0x2acb7d[_0x37eead(0x1c8)]),_0x2a3b07[_0x37eead(0x19c)](_0x2acb7d['request'],_0x5ba61b[_0x37eead(0x1a6)],_0x45af8d['request']),_0x36c452&&_0x2a3b07[_0x37eead(0x19c)](this[_0x37eead(0x1ac)](_0x36c452,'@{'+_0x5ba61b['reference']+_0x37eead(0x1a2)));}return _0x2a3b07;}async['delete'](_0x55dc19,_0xa11833=![]){const _0x129d85=a234_0xd5be13,_0x1f5ae9={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x368658=[];for(const _0x3c90a6 of _0x55dc19){if(_0x3c90a6['id'])_0x368658[_0x129d85(0x19c)](_0x3c90a6['id']);else{const _0x70d3de=this[_0x129d85(0x1c1)]['find'](_0x4c049a=>_0x4c049a[_0x129d85(0x1af)]===_0x3c90a6[_0x129d85(0x1be)]&&_0x4c049a[_0x129d85(0x1a9)]===_0x3c90a6[_0x129d85(0x1bd)]);if(!_0x70d3de||!_0x70d3de['componentId'])continue;_0x368658[_0x129d85(0x19c)](_0x70d3de[_0x129d85(0x1d5)]);}}if(_0xa11833){const _0x253375=await this[_0x129d85(0x1d0)][_0x129d85(0x1b0)](_0x368658);_0x1f5ae9[_0x129d85(0x1a8)]=_0x253375[_0x129d85(0x195)](_0x36ce69=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x129d85(0x1b5)],_0x36ce69)['request']);}return _0x1f5ae9[_0x129d85(0x17d)]=_0x368658['map'](_0x568772=>(0x0,composite_utils_1[_0x129d85(0x180)])(constants_1[_0x129d85(0x187)],_0x568772,{[constants_1[_0x129d85(0x193)]+_0x129d85(0x1c2)]:!![]})[_0x129d85(0x1a6)]),_0x1f5ae9[_0x129d85(0x1ae)]=_0x368658[_0x129d85(0x195)](_0x434ff5=>(0x0,composite_utils_1[_0x129d85(0x1b7)])(constants_1[_0x129d85(0x187)],_0x434ff5)[_0x129d85(0x1a6)]),_0x1f5ae9;}}function a234_0x5d10(){const _0x4db87b=['Last_Modified_By__c','gitSync','toString','application/zip','File_Name__c','Body','componentId','apply','Last_Modified_Date__c','DEFLATE','Changed_On__c','prepareComponentAttachmentRecord','toISOString','1211169mbGOaj','Commit__c','SalesforceComponentsManager','Could\x20not\x20proceed\x20component\x20','Changed_By__c','file','get','files','update','40953wjqBZf','Name','find','__importDefault','componentsToUpdate','isVlocityComponent','Branch__c','createPatchRequest','7bRcVSv','branchId','FLOSUM_COMPONENT_HISTORY','12dMcfcR','Last_Updated_By__c','Vlocity_Component__c','FLOSUM_COMPONENT','body','__esModule','base64','prepareComponentRecord','SalesforceGitSyncService','3RvOVBf','5593356zCAcZX','prepareComponentHistoryRecord','../../../../constants','FLOSUM_NAMESPACE','Component_Name__c','FLOSUM_GIT_NAMESPACE','version','map','../utils/composite.utils','../../../../core','Component_History__c','extractFieldsFromRecord','keys','logger','push','../utils/flosum-naming.utils','repositoryId','./salesforce-git-sync.service','createPostRequest','CRC32__c','.id}','Component__c',']\x20-\x20meta\x20not\x20found','3012nufOqz','request','proceedComponentMeta','manifests','componentType','ParentId','../../parsers/utils/zip','prepareCommitManifest','(((.+)+)+)+$','componentsToDelete','componentName','fetchCommitManifestsByComponentIds','1615392GKeepN','FLOSUM_ATTACHMENT','Component_Type__c','RecordTypeId','FLOSUM_COMMIT_MANIFEST','crc','createDeleteRequest','Repository__c','12971048gkkAci','username','generateAsync','Branch','type','name','11539570mSPwju','Is_From_Agent__c','proceededComponentsMeta','Deletion_By_Agent__c','recordTypes','3441685uBJfkl','createZip','filePath','Source__c','reference','constructor','9JbUJRW','Version__c','Zip','default','Repository'];a234_0x5d10=function(){return _0x4db87b;};return a234_0x5d10();}exports['SalesforceComponentsManager']=SalesforceComponentsManager;