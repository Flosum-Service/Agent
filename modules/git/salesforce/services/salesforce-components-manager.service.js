const a229_0xe71eea=a229_0x4707;(function(_0x39b3c4,_0x228971){const _0x38d0d6=a229_0x4707,_0x31d944=_0x39b3c4();while(!![]){try{const _0x3e4709=parseInt(_0x38d0d6(0x1a9))/0x1+-parseInt(_0x38d0d6(0x1a4))/0x2*(parseInt(_0x38d0d6(0x18e))/0x3)+-parseInt(_0x38d0d6(0x1aa))/0x4*(-parseInt(_0x38d0d6(0x1e7))/0x5)+-parseInt(_0x38d0d6(0x1eb))/0x6*(parseInt(_0x38d0d6(0x1b1))/0x7)+parseInt(_0x38d0d6(0x1ef))/0x8*(-parseInt(_0x38d0d6(0x199))/0x9)+-parseInt(_0x38d0d6(0x1ba))/0xa*(parseInt(_0x38d0d6(0x1d9))/0xb)+-parseInt(_0x38d0d6(0x1e5))/0xc*(-parseInt(_0x38d0d6(0x1dd))/0xd);if(_0x3e4709===_0x228971)break;else _0x31d944['push'](_0x31d944['shift']());}catch(_0x547020){_0x31d944['push'](_0x31d944['shift']());}}}(a229_0x19a1,0x4512b));const a229_0x282ee0=(function(){let _0x5eb678=!![];return function(_0x3f27a8,_0x1254be){const _0x470073=_0x5eb678?function(){const _0x1b9583=a229_0x4707;if(_0x1254be){const _0xea580e=_0x1254be[_0x1b9583(0x18f)](_0x3f27a8,arguments);return _0x1254be=null,_0xea580e;}}:function(){};return _0x5eb678=![],_0x470073;};}()),a229_0x5db022=a229_0x282ee0(this,function(){const _0x5c0c23=a229_0x4707;return a229_0x5db022[_0x5c0c23(0x1ac)]()[_0x5c0c23(0x1e9)](_0x5c0c23(0x19a))[_0x5c0c23(0x1ac)]()[_0x5c0c23(0x1e8)](a229_0x5db022)['search']('(((.+)+)+)+$');});function a229_0x4707(_0x5b8f13,_0x5e6055){const _0xb210cd=a229_0x19a1();return a229_0x4707=function(_0x5db022,_0x282ee0){_0x5db022=_0x5db022-0x18a;let _0x19a1a4=_0xb210cd[_0x5db022];return _0x19a1a4;},a229_0x4707(_0x5b8f13,_0x5e6055);}a229_0x5db022();function a229_0x19a1(){const _0x5b0fbf=['../utils/flosum-naming.utils',']\x20-\x20meta\x20not\x20found','Source__c','Component_Type__c','../errors/salesforce.error','Deletion_By_Agent__c','File_Name__c','Body','FLOSUM_COMPONENT','Description','Changed_On__c','push','componentsToDelete','repositoryId','ContentType','extractFieldsFromRecord','filePath','reference','defineProperty','SalesforceComponentsManager','manifests','Last_Modified_Date__c','keys','22VrtJLV','find','Logger','createZip','13Ebbugn','Name','DEFLATE','.id}','branchId','type','__esModule','recordTypes','16203444VhXkHS','componentName','845450bvWzKs','constructor','search','../../parsers/utils/zip','715404uQuzPX','../../../../core','crc','prepareComponentAttachmentRecord','301504lCbjhS','request','prepareCommitManifest','FLOSUM_COMMIT_MANIFEST','base64','Repository__c','application/zip','gitSync','Branch','18rphoOF','apply','files','proceedComponentMeta','name','map','Is_From_Agent__c','prepareComponentRecord','logger','version','body','117CSLErd','(((.+)+)+)+$','Component_Name__c','./salesforce-git-sync.service','componentId','insert','username','../../../../constants','FLOSUM_NAMESPACE','Last_Updated_By__c','createPostRequest','66292OtbwIw','prepareComponentHistoryRecord','get','SalesforceError','default','7290VykMHC','4kRviNc','typedi','toString','SalesforceGitSyncService','Committed_On__c','Version__c','RecordTypeId','21WuCGcI','delete','componentType','componentsToUpdate','toISOString','generateAsync','Last_Modified_By__c','CRC32__c','Commit__c','986110OcmYwi','createPatchRequest','FLOSUM_ATTACHMENT','FLOSUM_GIT_NAMESPACE','Repository','FLOSUM_COMPONENT_HISTORY','proceededComponentsMeta','Changed_By__c'];a229_0x19a1=function(){return _0x5b0fbf;};return a229_0x19a1();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5cb6df){const _0x121fee=a229_0x4707;return _0x5cb6df&&_0x5cb6df[_0x121fee(0x1e3)]?_0x5cb6df:{'default':_0x5cb6df};};Object[a229_0xe71eea(0x1d4)](exports,a229_0xe71eea(0x1e3),{'value':!![]}),exports[a229_0xe71eea(0x1d5)]=void 0x0;const constants_1=require(a229_0xe71eea(0x1a0)),core_1=require(a229_0xe71eea(0x1ec)),zip_1=require(a229_0xe71eea(0x1ea)),typedi_1=__importDefault(require(a229_0xe71eea(0x1ab))),salesforce_error_1=require(a229_0xe71eea(0x1c6)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a229_0xe71eea(0x1c2)),salesforce_git_sync_service_1=require(a229_0xe71eea(0x19c));class SalesforceComponentsManager{constructor(_0x2cbe46,_0x307099,_0x451631,_0x2e9af3,_0x5cca5a){const _0x48b727=a229_0xe71eea;this[_0x48b727(0x1cf)]=_0x2cbe46,this[_0x48b727(0x1e1)]=_0x307099,this[_0x48b727(0x19f)]=_0x451631,this['recordTypes']=_0x2e9af3,this['proceededComponentsMeta']=_0x5cca5a,this[_0x48b727(0x196)]=new core_1[(_0x48b727(0x1db))](SalesforceComponentsManager['name']),this[_0x48b727(0x18c)]=typedi_1[_0x48b727(0x1a8)][_0x48b727(0x1a6)](salesforce_git_sync_service_1[_0x48b727(0x1ad)]);}[a229_0xe71eea(0x191)](_0x353a5f,_0x177ea6){const _0x283871=a229_0xe71eea,_0x573f56=(0x0,flosum_naming_utils_1[_0x283871(0x1d1)])(_0x353a5f,[_0x283871(0x1c5),'Component_Name__c',_0x283871(0x1af)]);this['proceededComponentsMeta']['push']({'componentId':'','reference':_0x177ea6,'version':_0x573f56[_0x283871(0x1af)],'componentName':_0x573f56['Component_Name__c'],'componentType':_0x573f56['Component_Type__c']});}[a229_0xe71eea(0x1f1)](_0x33fb86,_0x1d5d53){const _0x1bf8ff=a229_0xe71eea,{request:_0x50c20b}=(0x0,composite_utils_1[_0x1bf8ff(0x1a3)])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x1bf8ff(0x1a1)]+_0x1bf8ff(0x1b9)]:_0x33fb86,[constants_1[_0x1bf8ff(0x1a1)]+'Component_History__c']:_0x1d5d53});return _0x50c20b;}async['prepareComponentAttachmentRecord'](_0x159905,_0x43a5b8){const _0xa8a9=a229_0xe71eea,_0x40904f={},_0x5d63be=zip_1['Zip'][_0xa8a9(0x1dc)]();for(const _0x283157 of Object[_0xa8a9(0x1d8)](_0x159905[_0xa8a9(0x190)])){_0x5d63be['file'](_0x283157,_0x159905[_0xa8a9(0x190)][_0x283157],{'createFolders':!![]});}return _0x40904f[_0xa8a9(0x1d0)]=_0xa8a9(0x18b),_0x40904f[_0xa8a9(0x1de)]=_0x159905[_0xa8a9(0x1e2)],_0x40904f[_0xa8a9(0x1cb)]=_0x159905['type'],_0x40904f['ParentId']=_0x43a5b8,_0x40904f[_0xa8a9(0x1c9)]=await _0x5d63be[_0xa8a9(0x1b6)]({'type':_0xa8a9(0x1f3),'compression':_0xa8a9(0x1df),'compressionOptions':{'level':0x6}}),_0x40904f;}[a229_0xe71eea(0x1a5)](_0x22ae88,_0x399eea,_0x24741c){const _0x27c069=a229_0xe71eea,_0x6eecaf=new Date()[_0x27c069(0x1b5)](),_0x46a57d={};return _0x46a57d[constants_1[_0x27c069(0x1a1)]+'Component__c']=_0x399eea,_0x46a57d[constants_1[_0x27c069(0x1a1)]+_0x27c069(0x1b8)]=_0x22ae88[_0x27c069(0x1ed)],_0x46a57d[constants_1[_0x27c069(0x1a1)]+_0x27c069(0x1cc)]=_0x6eecaf,_0x46a57d[constants_1[_0x27c069(0x1a1)]+_0x27c069(0x1c1)]=this[_0x27c069(0x19f)],_0x46a57d[constants_1[_0x27c069(0x1a1)]+_0x27c069(0x1af)]=_0x24741c?_0x24741c+0x1:0x1,_0x46a57d[constants_1[_0x27c069(0x1bd)]+_0x27c069(0x194)]=!![],_0x46a57d;}[a229_0xe71eea(0x195)](_0x61e6be,_0x25664f){const _0x26b3ad=a229_0xe71eea;var _0x1ea558,_0x362406;const _0x4f9489=new Date()[_0x26b3ad(0x1b5)](),_0x32c33d={};return!_0x25664f?(this[_0x26b3ad(0x1e1)]?(_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+'Branch__c']=this[_0x26b3ad(0x1e1)],_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x1c4)]=_0x26b3ad(0x18d),_0x32c33d['RecordTypeId']=(_0x1ea558=this[_0x26b3ad(0x1e4)][_0x26b3ad(0x1da)](_0xa78006=>_0xa78006[_0x26b3ad(0x192)]===_0x26b3ad(0x18d)))===null||_0x1ea558===void 0x0?void 0x0:_0x1ea558['id']):(_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x18a)]=this[_0x26b3ad(0x1cf)],_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x1c4)]=_0x26b3ad(0x1be),_0x32c33d[_0x26b3ad(0x1b0)]=(_0x362406=this[_0x26b3ad(0x1e4)][_0x26b3ad(0x1da)](_0x7fe660=>_0x7fe660[_0x26b3ad(0x192)]==='Repository'))===null||_0x362406===void 0x0?void 0x0:_0x362406['id']),_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x1af)]=0x1):_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x1af)]=_0x25664f[_0x26b3ad(0x197)]+0x1,_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x1c5)]=_0x61e6be['type'],_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x19b)]=_0x61e6be['name'],_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x1c8)]=_0x61e6be[_0x26b3ad(0x1d2)],_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x1a2)]=this[_0x26b3ad(0x19f)],_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x1b7)]=this[_0x26b3ad(0x19f)],_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x1d7)]=_0x4f9489,_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x1ae)]=_0x4f9489,_0x32c33d[constants_1[_0x26b3ad(0x1a1)]+_0x26b3ad(0x1b8)]=_0x61e6be[_0x26b3ad(0x1ed)],_0x32c33d;}['getProceededComponentsMeta'](){const _0x13cf73=a229_0xe71eea;return this[_0x13cf73(0x1c0)];}async[a229_0xe71eea(0x19e)](_0x467ab4,_0x32aff4){const _0x42aa23=a229_0xe71eea,_0x30393b=[];for(const _0x4e4f1e of _0x467ab4){const _0x52b653=(0x0,composite_utils_1[_0x42aa23(0x1a3)])(constants_1['FLOSUM_COMPONENT'],this[_0x42aa23(0x195)](_0x4e4f1e)),_0x19a1ba=(0x0,composite_utils_1[_0x42aa23(0x1a3)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x42aa23(0x1a5)](_0x4e4f1e,'@{'+_0x52b653[_0x42aa23(0x1d3)]+'.id}')),_0x1d2637=(0x0,composite_utils_1[_0x42aa23(0x1a3)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x42aa23(0x1ee)](_0x4e4f1e,'@{'+_0x19a1ba[_0x42aa23(0x1d3)]+_0x42aa23(0x1e0)));this[_0x42aa23(0x191)](_0x52b653['request'][_0x42aa23(0x198)],_0x52b653[_0x42aa23(0x1d3)]),_0x30393b[_0x42aa23(0x1cd)](_0x52b653[_0x42aa23(0x1f0)],_0x19a1ba[_0x42aa23(0x1f0)],_0x1d2637[_0x42aa23(0x1f0)]),_0x32aff4&&_0x30393b[_0x42aa23(0x1cd)](this['prepareCommitManifest'](_0x32aff4,'@{'+_0x19a1ba[_0x42aa23(0x1d3)]+_0x42aa23(0x1e0)));}return _0x30393b;}async['update'](_0x34d5d2,_0x568c36=''){const _0x1cd9e7=a229_0xe71eea,_0x254ad1=[];for(const {component:_0x2c7697,meta:_0xcd9c44}of _0x34d5d2){if(!_0xcd9c44['id']){const _0x45e280=this['proceededComponentsMeta']['find'](_0x42a672=>_0x42a672[_0x1cd9e7(0x1e6)]===_0x2c7697[_0x1cd9e7(0x192)]&&_0x42a672[_0x1cd9e7(0x1b3)]===_0x2c7697[_0x1cd9e7(0x1e2)]);if(!_0x45e280)throw new salesforce_error_1[(_0x1cd9e7(0x1a7))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x2c7697[_0x1cd9e7(0x192)]+'\x20['+_0x2c7697['type']+_0x1cd9e7(0x1c3)));_0xcd9c44['id']=_0x45e280[_0x1cd9e7(0x19d)];}const _0x2b5cbd=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x1cd9e7(0x1ca)],_0xcd9c44['id'],this['prepareComponentRecord'](_0x2c7697,_0xcd9c44)),_0x4c8d5f=(0x0,composite_utils_1[_0x1cd9e7(0x1a3)])(constants_1[_0x1cd9e7(0x1bf)],this[_0x1cd9e7(0x1a5)](_0x2c7697,_0xcd9c44['id'],_0xcd9c44[_0x1cd9e7(0x197)])),_0x851cd3=(0x0,composite_utils_1[_0x1cd9e7(0x1a3)])(constants_1[_0x1cd9e7(0x1bc)],await this[_0x1cd9e7(0x1ee)](_0x2c7697,'@{'+_0x4c8d5f['reference']+_0x1cd9e7(0x1e0)));this[_0x1cd9e7(0x191)](_0x2b5cbd[_0x1cd9e7(0x1f0)][_0x1cd9e7(0x198)],_0x2b5cbd[_0x1cd9e7(0x1d3)]),_0x254ad1[_0x1cd9e7(0x1cd)](_0x2b5cbd['request'],_0x4c8d5f[_0x1cd9e7(0x1f0)],_0x851cd3['request']),_0x568c36&&_0x254ad1[_0x1cd9e7(0x1cd)](this[_0x1cd9e7(0x1f1)](_0x568c36,'@{'+_0x4c8d5f[_0x1cd9e7(0x1d3)]+_0x1cd9e7(0x1e0)));}return _0x254ad1;}async[a229_0xe71eea(0x1b2)](_0x508b57,_0x201093=![]){const _0x35d0d1=a229_0xe71eea,_0x36ea94={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x1d2461=[];for(const _0x547fec of _0x508b57){if(_0x547fec['id'])_0x1d2461[_0x35d0d1(0x1cd)](_0x547fec['id']);else{const _0x3c5840=this[_0x35d0d1(0x1c0)]['find'](_0x16c8e5=>_0x16c8e5[_0x35d0d1(0x1e6)]===_0x547fec[_0x35d0d1(0x192)]&&_0x16c8e5['componentType']===_0x547fec['type']);if(!_0x3c5840||!_0x3c5840[_0x35d0d1(0x19d)])continue;_0x1d2461[_0x35d0d1(0x1cd)](_0x3c5840[_0x35d0d1(0x19d)]);}}if(_0x201093){const _0x436bf8=await this[_0x35d0d1(0x18c)]['fetchCommitManifestsByComponentIds'](_0x1d2461);_0x36ea94[_0x35d0d1(0x1d6)]=_0x436bf8[_0x35d0d1(0x193)](_0x359751=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x35d0d1(0x1f2)],_0x359751)[_0x35d0d1(0x1f0)]);}return _0x36ea94[_0x35d0d1(0x1b4)]=_0x1d2461[_0x35d0d1(0x193)](_0x4565ec=>(0x0,composite_utils_1[_0x35d0d1(0x1bb)])(constants_1[_0x35d0d1(0x1ca)],_0x4565ec,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x35d0d1(0x1c7)]:!![]})[_0x35d0d1(0x1f0)]),_0x36ea94[_0x35d0d1(0x1ce)]=_0x1d2461[_0x35d0d1(0x193)](_0x32918b=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x35d0d1(0x1ca)],_0x32918b)[_0x35d0d1(0x1f0)]),_0x36ea94;}}exports[a229_0xe71eea(0x1d5)]=SalesforceComponentsManager;