const a228_0x312c6b=a228_0x16d4;(function(_0x402efb,_0x59e834){const _0x136cc2=a228_0x16d4,_0x16fca2=_0x402efb();while(!![]){try{const _0x1ae363=parseInt(_0x136cc2(0x161))/0x1+parseInt(_0x136cc2(0x14c))/0x2*(-parseInt(_0x136cc2(0x163))/0x3)+-parseInt(_0x136cc2(0x121))/0x4*(parseInt(_0x136cc2(0x145))/0x5)+parseInt(_0x136cc2(0x12b))/0x6*(parseInt(_0x136cc2(0x122))/0x7)+parseInt(_0x136cc2(0x15d))/0x8*(-parseInt(_0x136cc2(0x174))/0x9)+parseInt(_0x136cc2(0x158))/0xa+parseInt(_0x136cc2(0x138))/0xb;if(_0x1ae363===_0x59e834)break;else _0x16fca2['push'](_0x16fca2['shift']());}catch(_0x113616){_0x16fca2['push'](_0x16fca2['shift']());}}}(a228_0x9e0a,0xd1ec1));const a228_0x32266b=(function(){let _0x164e07=!![];return function(_0x40043e,_0x45ace9){const _0x14a6b9=_0x164e07?function(){const _0x26164f=a228_0x16d4;if(_0x45ace9){const _0x2ff7bc=_0x45ace9[_0x26164f(0x130)](_0x40043e,arguments);return _0x45ace9=null,_0x2ff7bc;}}:function(){};return _0x164e07=![],_0x14a6b9;};}()),a228_0x990979=a228_0x32266b(this,function(){const _0x4dc81c=a228_0x16d4;return a228_0x990979[_0x4dc81c(0x13e)]()[_0x4dc81c(0x144)](_0x4dc81c(0x173))[_0x4dc81c(0x13e)]()['constructor'](a228_0x990979)['search'](_0x4dc81c(0x173));});a228_0x990979();function a228_0x16d4(_0x2eaa66,_0x14d812){const _0x18b33d=a228_0x9e0a();return a228_0x16d4=function(_0x990979,_0x32266b){_0x990979=_0x990979-0x116;let _0x9e0aa=_0x18b33d[_0x990979];return _0x9e0aa;},a228_0x16d4(_0x2eaa66,_0x14d812);}'use strict';var __importDefault=this&&this[a228_0x312c6b(0x11c)]||function(_0x49321d){const _0x26076a=a228_0x312c6b;return _0x49321d&&_0x49321d[_0x26076a(0x11d)]?_0x49321d:{'default':_0x49321d};};Object['defineProperty'](exports,a228_0x312c6b(0x11d),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;function a228_0x9e0a(){const _0x1bae41=['toISOString','Changed_On__c','DEFLATE','prepareCommitManifest','6803050FcliNj','logger','Component__c','Commit__c','componentId','8AClYsU','Source__c',']\x20-\x20meta\x20not\x20found','Committed_On__c','57656pEolME','map','16503pbPmNu','RecordTypeId','reference','getProceededComponentsMeta','Could\x20not\x20proceed\x20component\x20','../../../../core','Name','update','Version__c','version','.id}','Logger','componentType','../../parsers/utils/zip','type','Changed_By__c','(((.+)+)+)+$','5786163voLxQq','generateAsync','branchId','manifests','proceedComponentMeta','Zip','ContentType','FLOSUM_COMMIT_MANIFEST','extractFieldsFromRecord','filePath','__importDefault','__esModule','Body','FLOSUM_GIT_NAMESPACE','repositoryId','4QDsfOj','7394443kqKaWR','componentName','createPatchRequest','prepareComponentRecord','CRC32__c','request','fetchCommitManifestsByComponentIds','crc','Last_Modified_Date__c','6rNGhzD','files','Branch','body','push','apply','file','ParentId','gitSync','../utils/composite.utils','componentsToDelete','SalesforceComponentsManager','FLOSUM_COMPONENT','17058536CVrdkZ','find','SalesforceError','insert','recordTypes','File_Name__c','toString','SalesforceGitSyncService','base64','name','../../../../constants','prepareComponentHistoryRecord','search','1097715oIPmhp','typedi','username','FLOSUM_ATTACHMENT','createPostRequest','Component_Type__c','Repository__c','590vKzsJl','prepareComponentAttachmentRecord','proceededComponentsMeta','Repository','FLOSUM_NAMESPACE','Component_Name__c','createZip','../utils/flosum-naming.utils'];a228_0x9e0a=function(){return _0x1bae41;};return a228_0x9e0a();}const constants_1=require(a228_0x312c6b(0x142)),core_1=require(a228_0x312c6b(0x168)),zip_1=require(a228_0x312c6b(0x170)),typedi_1=__importDefault(require(a228_0x312c6b(0x146))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a228_0x312c6b(0x134)),flosum_naming_utils_1=require(a228_0x312c6b(0x153)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x293e10,_0x4bb4b6,_0x55a839,_0x3a9e97,_0x4c03e0){const _0x5d1618=a228_0x312c6b;this[_0x5d1618(0x120)]=_0x293e10,this[_0x5d1618(0x176)]=_0x4bb4b6,this[_0x5d1618(0x147)]=_0x55a839,this[_0x5d1618(0x13c)]=_0x3a9e97,this[_0x5d1618(0x14e)]=_0x4c03e0,this[_0x5d1618(0x159)]=new core_1[(_0x5d1618(0x16e))](SalesforceComponentsManager[_0x5d1618(0x141)]),this[_0x5d1618(0x133)]=typedi_1['default']['get'](salesforce_git_sync_service_1[_0x5d1618(0x13f)]);}[a228_0x312c6b(0x116)](_0x57910f,_0x58d9ce){const _0x52430b=a228_0x312c6b,_0x563022=(0x0,flosum_naming_utils_1[_0x52430b(0x11a)])(_0x57910f,[_0x52430b(0x14a),_0x52430b(0x151),_0x52430b(0x16b)]);this[_0x52430b(0x14e)][_0x52430b(0x12f)]({'componentId':'','reference':_0x58d9ce,'version':_0x563022[_0x52430b(0x16b)],'componentName':_0x563022[_0x52430b(0x151)],'componentType':_0x563022['Component_Type__c']});}[a228_0x312c6b(0x157)](_0x5c6260,_0x2d0cfd){const _0x49eea9=a228_0x312c6b,{request:_0x33e82d}=(0x0,composite_utils_1[_0x49eea9(0x149)])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x49eea9(0x150)]+_0x49eea9(0x15b)]:_0x5c6260,[constants_1['FLOSUM_NAMESPACE']+'Component_History__c']:_0x2d0cfd});return _0x33e82d;}async[a228_0x312c6b(0x14d)](_0x34602b,_0x8de509){const _0x511a32=a228_0x312c6b,_0x46393d={},_0x421eb8=zip_1[_0x511a32(0x117)][_0x511a32(0x152)]();for(const _0x4fd5e4 of Object['keys'](_0x34602b[_0x511a32(0x12c)])){_0x421eb8[_0x511a32(0x131)](_0x4fd5e4,_0x34602b[_0x511a32(0x12c)][_0x4fd5e4],{'createFolders':!![]});}return _0x46393d[_0x511a32(0x118)]='application/zip',_0x46393d[_0x511a32(0x169)]=_0x34602b[_0x511a32(0x171)],_0x46393d['Description']=_0x34602b[_0x511a32(0x171)],_0x46393d[_0x511a32(0x132)]=_0x8de509,_0x46393d[_0x511a32(0x11e)]=await _0x421eb8[_0x511a32(0x175)]({'type':_0x511a32(0x140),'compression':_0x511a32(0x156),'compressionOptions':{'level':0x6}}),_0x46393d;}[a228_0x312c6b(0x143)](_0x9acf8c,_0x48337b,_0x2f69a3){const _0x3e8fa7=a228_0x312c6b,_0x5409f5=new Date()[_0x3e8fa7(0x154)](),_0x4212af={};return _0x4212af[constants_1[_0x3e8fa7(0x150)]+_0x3e8fa7(0x15a)]=_0x48337b,_0x4212af[constants_1[_0x3e8fa7(0x150)]+'CRC32__c']=_0x9acf8c[_0x3e8fa7(0x129)],_0x4212af[constants_1[_0x3e8fa7(0x150)]+_0x3e8fa7(0x155)]=_0x5409f5,_0x4212af[constants_1[_0x3e8fa7(0x150)]+_0x3e8fa7(0x172)]=this[_0x3e8fa7(0x147)],_0x4212af[constants_1[_0x3e8fa7(0x150)]+_0x3e8fa7(0x16b)]=_0x2f69a3?_0x2f69a3+0x1:0x1,_0x4212af[constants_1['FLOSUM_GIT_NAMESPACE']+'Is_From_Agent__c']=!![],_0x4212af;}['prepareComponentRecord'](_0x58587e,_0xd4eaeb){const _0x1e2689=a228_0x312c6b;var _0x3d258d,_0x22b380;const _0x17351a=new Date()[_0x1e2689(0x154)](),_0xf16f18={};return!_0xd4eaeb?(this[_0x1e2689(0x176)]?(_0xf16f18[constants_1[_0x1e2689(0x150)]+'Branch__c']=this[_0x1e2689(0x176)],_0xf16f18[constants_1[_0x1e2689(0x150)]+_0x1e2689(0x15e)]=_0x1e2689(0x12d),_0xf16f18[_0x1e2689(0x164)]=(_0x3d258d=this[_0x1e2689(0x13c)][_0x1e2689(0x139)](_0x2dee83=>_0x2dee83[_0x1e2689(0x141)]==='Branch'))===null||_0x3d258d===void 0x0?void 0x0:_0x3d258d['id']):(_0xf16f18[constants_1[_0x1e2689(0x150)]+_0x1e2689(0x14b)]=this[_0x1e2689(0x120)],_0xf16f18[constants_1[_0x1e2689(0x150)]+_0x1e2689(0x15e)]=_0x1e2689(0x14f),_0xf16f18['RecordTypeId']=(_0x22b380=this[_0x1e2689(0x13c)][_0x1e2689(0x139)](_0x3803f6=>_0x3803f6['name']==='Repository'))===null||_0x22b380===void 0x0?void 0x0:_0x22b380['id']),_0xf16f18[constants_1[_0x1e2689(0x150)]+_0x1e2689(0x16b)]=0x1):_0xf16f18[constants_1['FLOSUM_NAMESPACE']+'Version__c']=_0xd4eaeb[_0x1e2689(0x16c)]+0x1,_0xf16f18[constants_1['FLOSUM_NAMESPACE']+'Component_Type__c']=_0x58587e[_0x1e2689(0x171)],_0xf16f18[constants_1[_0x1e2689(0x150)]+'Component_Name__c']=_0x58587e[_0x1e2689(0x141)],_0xf16f18[constants_1[_0x1e2689(0x150)]+_0x1e2689(0x13d)]=_0x58587e[_0x1e2689(0x11b)],_0xf16f18[constants_1[_0x1e2689(0x150)]+'Last_Updated_By__c']=this[_0x1e2689(0x147)],_0xf16f18[constants_1[_0x1e2689(0x150)]+'Last_Modified_By__c']=this['username'],_0xf16f18[constants_1['FLOSUM_NAMESPACE']+_0x1e2689(0x12a)]=_0x17351a,_0xf16f18[constants_1[_0x1e2689(0x150)]+_0x1e2689(0x160)]=_0x17351a,_0xf16f18[constants_1[_0x1e2689(0x150)]+_0x1e2689(0x126)]=_0x58587e[_0x1e2689(0x129)],_0xf16f18;}[a228_0x312c6b(0x166)](){return this['proceededComponentsMeta'];}async[a228_0x312c6b(0x13b)](_0x56fe99,_0x323495){const _0x4f81e4=a228_0x312c6b,_0x2c4bcd=[];for(const _0x2bc690 of _0x56fe99){const _0x300ba2=(0x0,composite_utils_1[_0x4f81e4(0x149)])(constants_1[_0x4f81e4(0x137)],this[_0x4f81e4(0x125)](_0x2bc690)),_0x5e8787=(0x0,composite_utils_1[_0x4f81e4(0x149)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x4f81e4(0x143)](_0x2bc690,'@{'+_0x300ba2[_0x4f81e4(0x165)]+_0x4f81e4(0x16d))),_0x46c907=(0x0,composite_utils_1[_0x4f81e4(0x149)])(constants_1[_0x4f81e4(0x148)],await this['prepareComponentAttachmentRecord'](_0x2bc690,'@{'+_0x5e8787[_0x4f81e4(0x165)]+_0x4f81e4(0x16d)));this[_0x4f81e4(0x116)](_0x300ba2['request'][_0x4f81e4(0x12e)],_0x300ba2['reference']),_0x2c4bcd[_0x4f81e4(0x12f)](_0x300ba2['request'],_0x5e8787[_0x4f81e4(0x127)],_0x46c907[_0x4f81e4(0x127)]),_0x323495&&_0x2c4bcd['push'](this[_0x4f81e4(0x157)](_0x323495,'@{'+_0x5e8787[_0x4f81e4(0x165)]+_0x4f81e4(0x16d)));}return _0x2c4bcd;}async[a228_0x312c6b(0x16a)](_0x557997,_0x4d5ca2=''){const _0x42e8bc=a228_0x312c6b,_0x213ced=[];for(const {component:_0x2fdecb,meta:_0xc646f5}of _0x557997){if(!_0xc646f5['id']){const _0xab0b44=this[_0x42e8bc(0x14e)][_0x42e8bc(0x139)](_0x2e9bef=>_0x2e9bef[_0x42e8bc(0x123)]===_0x2fdecb[_0x42e8bc(0x141)]&&_0x2e9bef[_0x42e8bc(0x16f)]===_0x2fdecb[_0x42e8bc(0x171)]);if(!_0xab0b44)throw new salesforce_error_1[(_0x42e8bc(0x13a))](new Error(_0x42e8bc(0x167)+_0x2fdecb[_0x42e8bc(0x141)]+'\x20['+_0x2fdecb[_0x42e8bc(0x171)]+_0x42e8bc(0x15f)));_0xc646f5['id']=_0xab0b44['componentId'];}const _0x5b5deb=(0x0,composite_utils_1[_0x42e8bc(0x124)])(constants_1[_0x42e8bc(0x137)],_0xc646f5['id'],this[_0x42e8bc(0x125)](_0x2fdecb,_0xc646f5)),_0x2fdd4e=(0x0,composite_utils_1[_0x42e8bc(0x149)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x42e8bc(0x143)](_0x2fdecb,_0xc646f5['id'],_0xc646f5[_0x42e8bc(0x16c)])),_0x5e1623=(0x0,composite_utils_1[_0x42e8bc(0x149)])(constants_1[_0x42e8bc(0x148)],await this[_0x42e8bc(0x14d)](_0x2fdecb,'@{'+_0x2fdd4e[_0x42e8bc(0x165)]+_0x42e8bc(0x16d)));this['proceedComponentMeta'](_0x5b5deb['request'][_0x42e8bc(0x12e)],_0x5b5deb[_0x42e8bc(0x165)]),_0x213ced[_0x42e8bc(0x12f)](_0x5b5deb[_0x42e8bc(0x127)],_0x2fdd4e[_0x42e8bc(0x127)],_0x5e1623[_0x42e8bc(0x127)]),_0x4d5ca2&&_0x213ced[_0x42e8bc(0x12f)](this[_0x42e8bc(0x157)](_0x4d5ca2,'@{'+_0x2fdd4e[_0x42e8bc(0x165)]+_0x42e8bc(0x16d)));}return _0x213ced;}async['delete'](_0x1b3a99,_0x296251=![]){const _0xad004b=a228_0x312c6b,_0x418590={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x171e2d=[];for(const _0x28ce3b of _0x1b3a99){if(_0x28ce3b['id'])_0x171e2d['push'](_0x28ce3b['id']);else{const _0x3ecd2c=this['proceededComponentsMeta']['find'](_0x55c022=>_0x55c022[_0xad004b(0x123)]===_0x28ce3b[_0xad004b(0x141)]&&_0x55c022[_0xad004b(0x16f)]===_0x28ce3b[_0xad004b(0x171)]);if(!_0x3ecd2c||!_0x3ecd2c['componentId'])continue;_0x171e2d[_0xad004b(0x12f)](_0x3ecd2c[_0xad004b(0x15c)]);}}if(_0x296251){const _0x34ccd4=await this[_0xad004b(0x133)][_0xad004b(0x128)](_0x171e2d);_0x418590[_0xad004b(0x177)]=_0x34ccd4['map'](_0x17a2e7=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0xad004b(0x119)],_0x17a2e7)[_0xad004b(0x127)]);}return _0x418590['componentsToUpdate']=_0x171e2d[_0xad004b(0x162)](_0x3a732c=>(0x0,composite_utils_1[_0xad004b(0x124)])(constants_1[_0xad004b(0x137)],_0x3a732c,{[constants_1[_0xad004b(0x11f)]+'Deletion_By_Agent__c']:!![]})[_0xad004b(0x127)]),_0x418590[_0xad004b(0x135)]=_0x171e2d[_0xad004b(0x162)](_0x478c10=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0xad004b(0x137)],_0x478c10)[_0xad004b(0x127)]),_0x418590;}}exports[a228_0x312c6b(0x136)]=SalesforceComponentsManager;