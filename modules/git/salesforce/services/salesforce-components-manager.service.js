const a261_0x12ab8=a261_0x5c4d;(function(_0x5427b5,_0x400a14){const _0x3ea058=a261_0x5c4d,_0x20cd9f=_0x5427b5();while(!![]){try{const _0xbc9dc8=-parseInt(_0x3ea058(0x134))/0x1*(-parseInt(_0x3ea058(0x13b))/0x2)+parseInt(_0x3ea058(0x149))/0x3+parseInt(_0x3ea058(0x11f))/0x4+-parseInt(_0x3ea058(0xef))/0x5+parseInt(_0x3ea058(0x121))/0x6+parseInt(_0x3ea058(0x12b))/0x7*(parseInt(_0x3ea058(0xf8))/0x8)+-parseInt(_0x3ea058(0x101))/0x9;if(_0xbc9dc8===_0x400a14)break;else _0x20cd9f['push'](_0x20cd9f['shift']());}catch(_0x57defa){_0x20cd9f['push'](_0x20cd9f['shift']());}}}(a261_0x1ffe,0x85c5a));function a261_0x1ffe(){const _0x2ba6ab=['(((.+)+)+)+$','gitSync','664ftOmfI','base64','map','keys','Component__c','prepareComponentAttachmentRecord','toString','DEFLATE','ParentId','7539444lyzALN','Zip','isVlocityComponent','vlocityComponentName','Version__c','type','componentId','Commit__c','Last_Modified_By__c','proceededComponentsMeta','Logger','crc','name','push','Repository__c','SalesforceComponentsManager','default','find','search','recordTypes','reference','manifests','../utils/flosum-naming.utils','Vlocity_Component_Name__c','apply','componentsToDelete','CRC32__c','SalesforceGitSyncService','Vlocity_Component__c','version','1694920SfYLgf','body','139398Jsmjqb','Description','ContentType','../errors/salesforce.error','constructor','branchId','createPatchRequest','Name','createPostRequest','FLOSUM_GIT_NAMESPACE','47943JjzVFR','files','get','FLOSUM_NAMESPACE','createDeleteRequest','Component_Name__c','request','extractFieldsFromRecord','fetchCommitManifestsByComponentIds','4963ZgvrrA','Repository','RecordTypeId',']\x20-\x20meta\x20not\x20found','prepareCommitManifest','defineProperty','prepareComponentRecord','292VfmXYD','Component_Type__c','Last_Updated_By__c','FLOSUM_COMPONENT_HISTORY','generateAsync','MC_Key__c','file','../utils/composite.utils','logger','FLOSUM_COMPONENT','Branch','__esModule','Source__c','repositoryId','929076EWFgUX','createZip','proceedComponentMeta','Body','Component_History__c','FLOSUM_ATTACHMENT','componentName','insert','.id}','3320370gdcHWW','componentsToUpdate','update','prepareComponentHistoryRecord','username','FLOSUM_COMMIT_MANIFEST','__importDefault'];a261_0x1ffe=function(){return _0x2ba6ab;};return a261_0x1ffe();}const a261_0x3eb8b0=(function(){let _0x105422=!![];return function(_0x2b2b33,_0x1ffe5e){const _0x1f062f=_0x105422?function(){const _0x399c07=a261_0x5c4d;if(_0x1ffe5e){const _0xcf104a=_0x1ffe5e[_0x399c07(0x119)](_0x2b2b33,arguments);return _0x1ffe5e=null,_0xcf104a;}}:function(){};return _0x105422=![],_0x1f062f;};}()),a261_0x23a10d=a261_0x3eb8b0(this,function(){const _0x27cf21=a261_0x5c4d;return a261_0x23a10d['toString']()[_0x27cf21(0x113)](_0x27cf21(0xf6))[_0x27cf21(0xfe)]()[_0x27cf21(0x125)](a261_0x23a10d)['search'](_0x27cf21(0xf6));});a261_0x23a10d();'use strict';var __importDefault=this&&this[a261_0x12ab8(0xf5)]||function(_0x11296b){const _0xa2d247=a261_0x12ab8;return _0x11296b&&_0x11296b[_0xa2d247(0x146)]?_0x11296b:{'default':_0x11296b};};Object[a261_0x12ab8(0x139)](exports,a261_0x12ab8(0x146),{'value':!![]}),exports[a261_0x12ab8(0x110)]=void 0x0;const constants_1=require('../../../../constants'),core_1=require('../../../../core'),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a261_0x12ab8(0x124)),composite_utils_1=require(a261_0x12ab8(0x142)),flosum_naming_utils_1=require(a261_0x12ab8(0x117)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');function a261_0x5c4d(_0x3bcb01,_0x14f8c3){const _0x420a57=a261_0x1ffe();return a261_0x5c4d=function(_0x23a10d,_0x3eb8b0){_0x23a10d=_0x23a10d-0xe8;let _0x1ffe4d=_0x420a57[_0x23a10d];return _0x1ffe4d;},a261_0x5c4d(_0x3bcb01,_0x14f8c3);}class SalesforceComponentsManager{constructor(_0x53c621,_0x3969fa,_0x3764b5,_0x130ddc,_0x2219ff){const _0x360849=a261_0x12ab8;this[_0x360849(0x148)]=_0x53c621,this[_0x360849(0x126)]=_0x3969fa,this['username']=_0x3764b5,this['recordTypes']=_0x130ddc,this[_0x360849(0x10a)]=_0x2219ff,this[_0x360849(0x143)]=new core_1[(_0x360849(0x10b))](SalesforceComponentsManager[_0x360849(0x10d)]),this[_0x360849(0xf7)]=typedi_1[_0x360849(0x111)][_0x360849(0x12d)](salesforce_git_sync_service_1[_0x360849(0x11c)]);}[a261_0x12ab8(0xe8)](_0x590473,_0x3b6147){const _0x4944b4=a261_0x12ab8,_0x571b17=(0x0,flosum_naming_utils_1[_0x4944b4(0x132)])(_0x590473,[_0x4944b4(0x13c),_0x4944b4(0x130),_0x4944b4(0x105)]);this[_0x4944b4(0x10a)][_0x4944b4(0x10e)]({'componentId':'','reference':_0x3b6147,'version':_0x571b17[_0x4944b4(0x105)],'componentName':_0x571b17[_0x4944b4(0x130)],'componentType':_0x571b17[_0x4944b4(0x13c)]});}['prepareCommitManifest'](_0x306bb6,_0x255752){const _0x4c0a89=a261_0x12ab8,{request:_0x31edda}=(0x0,composite_utils_1[_0x4c0a89(0x129)])(constants_1[_0x4c0a89(0xf4)],{[constants_1[_0x4c0a89(0x12e)]+_0x4c0a89(0x108)]:_0x306bb6,[constants_1['FLOSUM_NAMESPACE']+_0x4c0a89(0xea)]:_0x255752});return _0x31edda;}async[a261_0x12ab8(0xfd)](_0xfda1b6,_0x5f3e19){const _0x318d35=a261_0x12ab8,_0x2bfd1e={},_0x9be95d=zip_1[_0x318d35(0x102)][_0x318d35(0x14a)]();for(const _0x2fd125 of Object[_0x318d35(0xfb)](_0xfda1b6[_0x318d35(0x12c)])){_0x9be95d[_0x318d35(0x141)](_0x2fd125,_0xfda1b6[_0x318d35(0x12c)][_0x2fd125],{'createFolders':!![]});}return _0x2bfd1e[_0x318d35(0x123)]='application/zip',_0x2bfd1e[_0x318d35(0x128)]=_0xfda1b6['type'],_0x2bfd1e[_0x318d35(0x122)]=_0xfda1b6[_0x318d35(0x106)],_0x2bfd1e[_0x318d35(0x100)]=_0x5f3e19,_0x2bfd1e[_0x318d35(0xe9)]=await _0x9be95d[_0x318d35(0x13f)]({'type':_0x318d35(0xf9),'compression':_0x318d35(0xff),'compressionOptions':{'level':0x6}}),_0x2bfd1e;}[a261_0x12ab8(0xf2)](_0x4908f2,_0x1faf81,_0x3557c8){const _0x3e7afd=a261_0x12ab8,_0x5cf32a=new Date()['toISOString'](),_0x28acf1={};return _0x28acf1[constants_1[_0x3e7afd(0x12e)]+_0x3e7afd(0xfc)]=_0x1faf81,_0x28acf1[constants_1[_0x3e7afd(0x12e)]+_0x3e7afd(0x11b)]=_0x4908f2[_0x3e7afd(0x10c)],_0x28acf1[constants_1[_0x3e7afd(0x12e)]+'Changed_On__c']=_0x5cf32a,_0x28acf1[constants_1[_0x3e7afd(0x12e)]+'Changed_By__c']=this['username'],_0x28acf1[constants_1['FLOSUM_NAMESPACE']+_0x3e7afd(0x105)]=_0x3557c8?_0x3557c8+0x1:0x1,_0x28acf1[constants_1[_0x3e7afd(0x12a)]+'Is_From_Agent__c']=!![],_0x28acf1;}[a261_0x12ab8(0x13a)](_0x458ab1,_0x1ff8f4){const _0x4936c4=a261_0x12ab8;var _0x1a4359,_0x24e56e;const _0x5a1627=new Date()['toISOString'](),_0x509aa6={};return!_0x1ff8f4?(this[_0x4936c4(0x126)]?(_0x509aa6[constants_1[_0x4936c4(0x12e)]+'Branch__c']=this[_0x4936c4(0x126)],_0x509aa6[constants_1[_0x4936c4(0x12e)]+'Source__c']=_0x4936c4(0x145),_0x509aa6[_0x4936c4(0x136)]=(_0x1a4359=this[_0x4936c4(0x114)][_0x4936c4(0x112)](_0x5940b6=>_0x5940b6[_0x4936c4(0x10d)]===_0x4936c4(0x145)))===null||_0x1a4359===void 0x0?void 0x0:_0x1a4359['id']):(_0x509aa6[constants_1[_0x4936c4(0x12e)]+_0x4936c4(0x10f)]=this[_0x4936c4(0x148)],_0x509aa6[constants_1[_0x4936c4(0x12e)]+_0x4936c4(0x147)]=_0x4936c4(0x135),_0x509aa6[_0x4936c4(0x136)]=(_0x24e56e=this['recordTypes'][_0x4936c4(0x112)](_0x230579=>_0x230579[_0x4936c4(0x10d)]===_0x4936c4(0x135)))===null||_0x24e56e===void 0x0?void 0x0:_0x24e56e['id']),_0x509aa6[constants_1[_0x4936c4(0x12e)]+_0x4936c4(0x105)]=0x1):_0x509aa6[constants_1[_0x4936c4(0x12e)]+'Version__c']=_0x1ff8f4['version']+0x1,_0x509aa6[constants_1[_0x4936c4(0x12e)]+_0x4936c4(0x13c)]=_0x458ab1['type'],_0x509aa6[constants_1['FLOSUM_NAMESPACE']+_0x4936c4(0x130)]=_0x458ab1[_0x4936c4(0x10d)],_0x509aa6[constants_1[_0x4936c4(0x12e)]+'File_Name__c']=_0x458ab1['filePath'],_0x509aa6[constants_1[_0x4936c4(0x12e)]+_0x4936c4(0x13d)]=this[_0x4936c4(0xf3)],_0x509aa6[constants_1['FLOSUM_NAMESPACE']+_0x4936c4(0x109)]=this[_0x4936c4(0xf3)],_0x509aa6[constants_1[_0x4936c4(0x12e)]+'Last_Modified_Date__c']=_0x5a1627,_0x509aa6[constants_1[_0x4936c4(0x12e)]+'Committed_On__c']=_0x5a1627,_0x509aa6[constants_1[_0x4936c4(0x12e)]+_0x4936c4(0x11b)]=_0x458ab1[_0x4936c4(0x10c)],_0x509aa6[constants_1['FLOSUM_NAMESPACE']+_0x4936c4(0x118)]=_0x458ab1[_0x4936c4(0x104)],_0x509aa6[constants_1[_0x4936c4(0x12e)]+_0x4936c4(0x11d)]=_0x458ab1[_0x4936c4(0x103)],_0x509aa6[constants_1[_0x4936c4(0x12e)]+_0x4936c4(0x140)]=_0x458ab1['marketingCloudKey'],_0x509aa6;}['getProceededComponentsMeta'](){const _0x56c6a6=a261_0x12ab8;return this[_0x56c6a6(0x10a)];}async[a261_0x12ab8(0xed)](_0x102f29,_0x3fb707){const _0x5bf56d=a261_0x12ab8,_0x241e4c=[];for(const _0x5a19cf of _0x102f29){const _0x443df0=(0x0,composite_utils_1[_0x5bf56d(0x129)])(constants_1['FLOSUM_COMPONENT'],this[_0x5bf56d(0x13a)](_0x5a19cf)),_0x4153f6=(0x0,composite_utils_1[_0x5bf56d(0x129)])(constants_1[_0x5bf56d(0x13e)],this[_0x5bf56d(0xf2)](_0x5a19cf,'@{'+_0x443df0[_0x5bf56d(0x115)]+'.id}')),_0x5580fe=(0x0,composite_utils_1[_0x5bf56d(0x129)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x5bf56d(0xfd)](_0x5a19cf,'@{'+_0x4153f6['reference']+_0x5bf56d(0xee)));this[_0x5bf56d(0xe8)](_0x443df0[_0x5bf56d(0x131)][_0x5bf56d(0x120)],_0x443df0[_0x5bf56d(0x115)]),_0x241e4c[_0x5bf56d(0x10e)](_0x443df0[_0x5bf56d(0x131)],_0x4153f6['request'],_0x5580fe['request']),_0x3fb707&&_0x241e4c['push'](this[_0x5bf56d(0x138)](_0x3fb707,'@{'+_0x4153f6[_0x5bf56d(0x115)]+_0x5bf56d(0xee)));}return _0x241e4c;}async[a261_0x12ab8(0xf1)](_0x510081,_0x1c05bb=''){const _0x3aac19=a261_0x12ab8,_0x17c553=[];for(const {component:_0x10285d,meta:_0x301ec8}of _0x510081){if(!_0x301ec8['id']){const _0x20aa58=this[_0x3aac19(0x10a)]['find'](_0x49f1a6=>_0x49f1a6[_0x3aac19(0xec)]===_0x10285d[_0x3aac19(0x10d)]&&_0x49f1a6['componentType']===_0x10285d[_0x3aac19(0x106)]);if(!_0x20aa58)throw new salesforce_error_1['SalesforceError'](new Error('Could\x20not\x20proceed\x20component\x20'+_0x10285d[_0x3aac19(0x10d)]+'\x20['+_0x10285d[_0x3aac19(0x106)]+_0x3aac19(0x137)));_0x301ec8['id']=_0x20aa58[_0x3aac19(0x107)];}const _0x124260=(0x0,composite_utils_1[_0x3aac19(0x127)])(constants_1[_0x3aac19(0x144)],_0x301ec8['id'],this[_0x3aac19(0x13a)](_0x10285d,_0x301ec8)),_0x388025=(0x0,composite_utils_1[_0x3aac19(0x129)])(constants_1[_0x3aac19(0x13e)],this[_0x3aac19(0xf2)](_0x10285d,_0x301ec8['id'],_0x301ec8[_0x3aac19(0x11e)])),_0xe5db5e=(0x0,composite_utils_1[_0x3aac19(0x129)])(constants_1[_0x3aac19(0xeb)],await this[_0x3aac19(0xfd)](_0x10285d,'@{'+_0x388025[_0x3aac19(0x115)]+_0x3aac19(0xee)));this[_0x3aac19(0xe8)](_0x124260['request'][_0x3aac19(0x120)],_0x124260[_0x3aac19(0x115)]),_0x17c553[_0x3aac19(0x10e)](_0x124260['request'],_0x388025[_0x3aac19(0x131)],_0xe5db5e[_0x3aac19(0x131)]),_0x1c05bb&&_0x17c553[_0x3aac19(0x10e)](this['prepareCommitManifest'](_0x1c05bb,'@{'+_0x388025[_0x3aac19(0x115)]+_0x3aac19(0xee)));}return _0x17c553;}async['delete'](_0x122ef3,_0xb87cd1=![]){const _0x185bae=a261_0x12ab8,_0x1c9a80={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x31024a=[];for(const _0x480023 of _0x122ef3){if(_0x480023['id'])_0x31024a['push'](_0x480023['id']);else{const _0x10b8a6=this[_0x185bae(0x10a)][_0x185bae(0x112)](_0x10df97=>_0x10df97[_0x185bae(0xec)]===_0x480023[_0x185bae(0x10d)]&&_0x10df97['componentType']===_0x480023['type']);if(!_0x10b8a6||!_0x10b8a6['componentId'])continue;_0x31024a[_0x185bae(0x10e)](_0x10b8a6[_0x185bae(0x107)]);}}if(_0xb87cd1){const _0x607d7b=await this[_0x185bae(0xf7)][_0x185bae(0x133)](_0x31024a);_0x1c9a80[_0x185bae(0x116)]=_0x607d7b['map'](_0x450594=>(0x0,composite_utils_1[_0x185bae(0x12f)])(constants_1[_0x185bae(0xf4)],_0x450594)[_0x185bae(0x131)]);}return _0x1c9a80[_0x185bae(0xf0)]=_0x31024a[_0x185bae(0xfa)](_0xd8a86d=>(0x0,composite_utils_1[_0x185bae(0x127)])(constants_1['FLOSUM_COMPONENT'],_0xd8a86d,{[constants_1[_0x185bae(0x12a)]+'Deletion_By_Agent__c']:!![]})[_0x185bae(0x131)]),_0x1c9a80[_0x185bae(0x11a)]=_0x31024a[_0x185bae(0xfa)](_0x281a68=>(0x0,composite_utils_1[_0x185bae(0x12f)])(constants_1[_0x185bae(0x144)],_0x281a68)[_0x185bae(0x131)]),_0x1c9a80;}}exports[a261_0x12ab8(0x110)]=SalesforceComponentsManager;