const a271_0x3221da=a271_0x231e;(function(_0x183cee,_0x301648){const _0x46d138=a271_0x231e,_0x31a529=_0x183cee();while(!![]){try{const _0x59cd38=parseInt(_0x46d138(0x200))/0x1+-parseInt(_0x46d138(0x1ca))/0x2+-parseInt(_0x46d138(0x1c1))/0x3*(parseInt(_0x46d138(0x1e0))/0x4)+-parseInt(_0x46d138(0x216))/0x5*(parseInt(_0x46d138(0x1df))/0x6)+parseInt(_0x46d138(0x20e))/0x7+parseInt(_0x46d138(0x1d0))/0x8+parseInt(_0x46d138(0x209))/0x9;if(_0x59cd38===_0x301648)break;else _0x31a529['push'](_0x31a529['shift']());}catch(_0x5330f1){_0x31a529['push'](_0x31a529['shift']());}}}(a271_0x5440,0xbec75));function a271_0x5440(){const _0x58f5fe=['componentsToDelete','CRC32__c','SalesforceComponentsManager','754808TfMClM','branchId','gitSync','Repository__c','files','body','10235512aBdkOn','FLOSUM_NAMESPACE','getProceededComponentsMeta','createPostRequest','isVlocityComponent','manifests','file','ParentId','../errors/salesforce.error','RecordTypeId','Committed_On__c','Source__c','push','Branch__c','createDeleteRequest','7360194CZRgae','682488VCWgPP','proceedComponentMeta','Version__c','base64','FLOSUM_GIT_NAMESPACE','../../../../constants','FLOSUM_ATTACHMENT','Name','type','defineProperty','.id}','apply','../../../../core','File_Name__c','repositoryId','Zip','SalesforceGitSyncService','FLOSUM_COMMIT_MANIFEST','toISOString','find','recordTypes','Description','prepareComponentHistoryRecord','search','componentName','componentId','delete','DEFLATE','constructor','prepareCommitManifest','username','Changed_By__c','572820wZuUIn','update','request','prepareComponentAttachmentRecord','Could\x20not\x20proceed\x20component\x20','./salesforce-git-sync.service','Last_Modified_By__c','(((.+)+)+)+$','application/zip','3452886sYsnMj','SalesforceError','map','Component_Name__c','toString','3436041mATMIk','generateAsync','keys','../../parsers/utils/zip','proceededComponentsMeta','Logger','name','Branch','5NfnWKd','Is_From_Agent__c','createZip','crc','componentType','Repository','reference','createPatchRequest',']\x20-\x20meta\x20not\x20found','FLOSUM_COMPONENT','vlocityComponentName','extractFieldsFromRecord','get','ContentType','Last_Modified_Date__c','prepareComponentRecord','__esModule','marketingCloudKey','version','6qvIEYZ','Deletion_By_Agent__c','default','FLOSUM_COMPONENT_HISTORY','Last_Updated_By__c','Component_Type__c'];a271_0x5440=function(){return _0x58f5fe;};return a271_0x5440();}const a271_0x339ccf=(function(){let _0x1dadfb=!![];return function(_0x314f0c,_0x3420c9){const _0x5b7bbf=_0x1dadfb?function(){const _0x494c54=a271_0x231e;if(_0x3420c9){const _0x401006=_0x3420c9[_0x494c54(0x1eb)](_0x314f0c,arguments);return _0x3420c9=null,_0x401006;}}:function(){};return _0x1dadfb=![],_0x5b7bbf;};}()),a271_0x4cc541=a271_0x339ccf(this,function(){const _0x2288fe=a271_0x231e;return a271_0x4cc541['toString']()['search'](_0x2288fe(0x207))[_0x2288fe(0x20d)]()[_0x2288fe(0x1fc)](a271_0x4cc541)[_0x2288fe(0x1f7)](_0x2288fe(0x207));});a271_0x4cc541();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x246508){const _0x50af29=a271_0x231e;return _0x246508&&_0x246508[_0x50af29(0x1be)]?_0x246508:{'default':_0x246508};};Object[a271_0x3221da(0x1e9)](exports,a271_0x3221da(0x1be),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;function a271_0x231e(_0x4c9d75,_0x68478b){const _0x59fb39=a271_0x5440();return a271_0x231e=function(_0x4cc541,_0x339ccf){_0x4cc541=_0x4cc541-0x1b0;let _0x54408e=_0x59fb39[_0x4cc541];return _0x54408e;},a271_0x231e(_0x4c9d75,_0x68478b);}const constants_1=require(a271_0x3221da(0x1e5)),core_1=require(a271_0x3221da(0x1ec)),zip_1=require(a271_0x3221da(0x211)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a271_0x3221da(0x1d8)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a271_0x3221da(0x205));class SalesforceComponentsManager{constructor(_0x1c53ec,_0x6f5a7e,_0x27a064,_0x2141de,_0x2aaba5){const _0x4f39ef=a271_0x3221da;this[_0x4f39ef(0x1ee)]=_0x1c53ec,this['branchId']=_0x6f5a7e,this[_0x4f39ef(0x1fe)]=_0x27a064,this[_0x4f39ef(0x1f4)]=_0x2141de,this[_0x4f39ef(0x212)]=_0x2aaba5,this['logger']=new core_1[(_0x4f39ef(0x213))](SalesforceComponentsManager['name']),this['gitSync']=typedi_1[_0x4f39ef(0x1c3)][_0x4f39ef(0x1ba)](salesforce_git_sync_service_1[_0x4f39ef(0x1f0)]);}[a271_0x3221da(0x1e1)](_0x3c4db9,_0x45f784){const _0x503a70=a271_0x3221da,_0x187ed6=(0x0,flosum_naming_utils_1[_0x503a70(0x1b9)])(_0x3c4db9,['Component_Type__c',_0x503a70(0x20c),_0x503a70(0x1e2)]);this[_0x503a70(0x212)][_0x503a70(0x1dc)]({'componentId':'','reference':_0x45f784,'version':_0x187ed6[_0x503a70(0x1e2)],'componentName':_0x187ed6[_0x503a70(0x20c)],'componentType':_0x187ed6['Component_Type__c']});}['prepareCommitManifest'](_0x102441,_0x394b89){const _0x3b00b8=a271_0x3221da,{request:_0x16ed0f}=(0x0,composite_utils_1[_0x3b00b8(0x1d3)])(constants_1[_0x3b00b8(0x1f1)],{[constants_1[_0x3b00b8(0x1d1)]+'Commit__c']:_0x102441,[constants_1[_0x3b00b8(0x1d1)]+'Component_History__c']:_0x394b89});return _0x16ed0f;}async[a271_0x3221da(0x203)](_0x19b577,_0xfbd660){const _0x1d427b=a271_0x3221da,_0xfe921a={},_0x12bfd7=zip_1[_0x1d427b(0x1ef)][_0x1d427b(0x1b0)]();for(const _0x487c6e of Object[_0x1d427b(0x210)](_0x19b577[_0x1d427b(0x1ce)])){_0x12bfd7[_0x1d427b(0x1d6)](_0x487c6e,_0x19b577[_0x1d427b(0x1ce)][_0x487c6e],{'createFolders':!![]});}return _0xfe921a[_0x1d427b(0x1bb)]=_0x1d427b(0x208),_0xfe921a[_0x1d427b(0x1e7)]=_0x19b577[_0x1d427b(0x1e8)],_0xfe921a[_0x1d427b(0x1f5)]=_0x19b577[_0x1d427b(0x1e8)],_0xfe921a[_0x1d427b(0x1d7)]=_0xfbd660,_0xfe921a['Body']=await _0x12bfd7[_0x1d427b(0x20f)]({'type':_0x1d427b(0x1e3),'compression':_0x1d427b(0x1fb),'compressionOptions':{'level':0x6}}),_0xfe921a;}['prepareComponentHistoryRecord'](_0x34d1c9,_0x218b75,_0x5761b2){const _0x3d80e7=a271_0x3221da,_0x3d7caf=new Date()[_0x3d80e7(0x1f2)](),_0xbccf52={};return _0xbccf52[constants_1[_0x3d80e7(0x1d1)]+'Component__c']=_0x218b75,_0xbccf52[constants_1[_0x3d80e7(0x1d1)]+_0x3d80e7(0x1c8)]=_0x34d1c9[_0x3d80e7(0x1b1)],_0xbccf52[constants_1['FLOSUM_NAMESPACE']+'Changed_On__c']=_0x3d7caf,_0xbccf52[constants_1[_0x3d80e7(0x1d1)]+_0x3d80e7(0x1ff)]=this[_0x3d80e7(0x1fe)],_0xbccf52[constants_1[_0x3d80e7(0x1d1)]+_0x3d80e7(0x1e2)]=_0x5761b2?_0x5761b2+0x1:0x1,_0xbccf52[constants_1['FLOSUM_GIT_NAMESPACE']+_0x3d80e7(0x217)]=!![],_0xbccf52;}[a271_0x3221da(0x1bd)](_0x1a974d,_0x3a67fe){const _0x160037=a271_0x3221da;var _0x5163ae,_0x2be68a;const _0x1e0be5=new Date()[_0x160037(0x1f2)](),_0x36a2c4={};return!_0x3a67fe?(this[_0x160037(0x1cb)]?(_0x36a2c4[constants_1['FLOSUM_NAMESPACE']+_0x160037(0x1dd)]=this[_0x160037(0x1cb)],_0x36a2c4[constants_1['FLOSUM_NAMESPACE']+_0x160037(0x1db)]=_0x160037(0x215),_0x36a2c4['RecordTypeId']=(_0x5163ae=this[_0x160037(0x1f4)][_0x160037(0x1f3)](_0x26ed52=>_0x26ed52[_0x160037(0x214)]===_0x160037(0x215)))===null||_0x5163ae===void 0x0?void 0x0:_0x5163ae['id']):(_0x36a2c4[constants_1['FLOSUM_NAMESPACE']+_0x160037(0x1cd)]=this[_0x160037(0x1ee)],_0x36a2c4[constants_1[_0x160037(0x1d1)]+_0x160037(0x1db)]=_0x160037(0x1b3),_0x36a2c4[_0x160037(0x1d9)]=(_0x2be68a=this[_0x160037(0x1f4)]['find'](_0x273673=>_0x273673[_0x160037(0x214)]===_0x160037(0x1b3)))===null||_0x2be68a===void 0x0?void 0x0:_0x2be68a['id']),_0x36a2c4[constants_1[_0x160037(0x1d1)]+'Version__c']=0x1):_0x36a2c4[constants_1[_0x160037(0x1d1)]+_0x160037(0x1e2)]=_0x3a67fe[_0x160037(0x1c0)]+0x1,_0x36a2c4[constants_1[_0x160037(0x1d1)]+_0x160037(0x1c6)]=_0x1a974d['type'],_0x36a2c4[constants_1[_0x160037(0x1d1)]+_0x160037(0x20c)]=_0x1a974d[_0x160037(0x214)],_0x36a2c4[constants_1[_0x160037(0x1d1)]+_0x160037(0x1ed)]=_0x1a974d['filePath'],_0x36a2c4[constants_1[_0x160037(0x1d1)]+_0x160037(0x1c5)]=this[_0x160037(0x1fe)],_0x36a2c4[constants_1[_0x160037(0x1d1)]+_0x160037(0x206)]=this['username'],_0x36a2c4[constants_1['FLOSUM_NAMESPACE']+_0x160037(0x1bc)]=_0x1e0be5,_0x36a2c4[constants_1[_0x160037(0x1d1)]+_0x160037(0x1da)]=_0x1e0be5,_0x36a2c4[constants_1[_0x160037(0x1d1)]+_0x160037(0x1c8)]=_0x1a974d[_0x160037(0x1b1)],_0x36a2c4[constants_1[_0x160037(0x1d1)]+'Vlocity_Component_Name__c']=_0x1a974d[_0x160037(0x1b8)],_0x36a2c4[constants_1[_0x160037(0x1d1)]+'Vlocity_Component__c']=_0x1a974d[_0x160037(0x1d4)],_0x36a2c4[constants_1[_0x160037(0x1d1)]+'MC_Key__c']=_0x1a974d[_0x160037(0x1bf)],_0x36a2c4;}[a271_0x3221da(0x1d2)](){const _0x1c2179=a271_0x3221da;return this[_0x1c2179(0x212)];}async['insert'](_0x318dff,_0x1bd604){const _0x40e25a=a271_0x3221da,_0x5b0eb5=[];for(const _0x5dd9b9 of _0x318dff){const _0x122d7e=(0x0,composite_utils_1[_0x40e25a(0x1d3)])(constants_1[_0x40e25a(0x1b7)],this[_0x40e25a(0x1bd)](_0x5dd9b9)),_0x5e0373=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x40e25a(0x1c4)],this[_0x40e25a(0x1f6)](_0x5dd9b9,'@{'+_0x122d7e['reference']+'.id}')),_0x276b5b=(0x0,composite_utils_1[_0x40e25a(0x1d3)])(constants_1[_0x40e25a(0x1e6)],await this[_0x40e25a(0x203)](_0x5dd9b9,'@{'+_0x5e0373['reference']+_0x40e25a(0x1ea)));this[_0x40e25a(0x1e1)](_0x122d7e[_0x40e25a(0x202)][_0x40e25a(0x1cf)],_0x122d7e[_0x40e25a(0x1b4)]),_0x5b0eb5[_0x40e25a(0x1dc)](_0x122d7e[_0x40e25a(0x202)],_0x5e0373[_0x40e25a(0x202)],_0x276b5b['request']),_0x1bd604&&_0x5b0eb5[_0x40e25a(0x1dc)](this['prepareCommitManifest'](_0x1bd604,'@{'+_0x5e0373['reference']+_0x40e25a(0x1ea)));}return _0x5b0eb5;}async[a271_0x3221da(0x201)](_0x216ddd,_0x3dd525=''){const _0x5a297c=a271_0x3221da,_0x20e6d=[];for(const {component:_0x4afc3c,meta:_0x1115e8}of _0x216ddd){if(!_0x1115e8['id']){const _0x40e2d6=this['proceededComponentsMeta'][_0x5a297c(0x1f3)](_0x1a56eb=>_0x1a56eb[_0x5a297c(0x1f8)]===_0x4afc3c[_0x5a297c(0x214)]&&_0x1a56eb[_0x5a297c(0x1b2)]===_0x4afc3c['type']);if(!_0x40e2d6)throw new salesforce_error_1[(_0x5a297c(0x20a))](new Error(_0x5a297c(0x204)+_0x4afc3c[_0x5a297c(0x214)]+'\x20['+_0x4afc3c[_0x5a297c(0x1e8)]+_0x5a297c(0x1b6)));_0x1115e8['id']=_0x40e2d6[_0x5a297c(0x1f9)];}const _0x36d726=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x5a297c(0x1b7)],_0x1115e8['id'],this['prepareComponentRecord'](_0x4afc3c,_0x1115e8)),_0x41b139=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x5a297c(0x1c4)],this[_0x5a297c(0x1f6)](_0x4afc3c,_0x1115e8['id'],_0x1115e8[_0x5a297c(0x1c0)])),_0x4f15a5=(0x0,composite_utils_1[_0x5a297c(0x1d3)])(constants_1[_0x5a297c(0x1e6)],await this[_0x5a297c(0x203)](_0x4afc3c,'@{'+_0x41b139[_0x5a297c(0x1b4)]+_0x5a297c(0x1ea)));this['proceedComponentMeta'](_0x36d726['request'][_0x5a297c(0x1cf)],_0x36d726[_0x5a297c(0x1b4)]),_0x20e6d['push'](_0x36d726[_0x5a297c(0x202)],_0x41b139['request'],_0x4f15a5[_0x5a297c(0x202)]),_0x3dd525&&_0x20e6d[_0x5a297c(0x1dc)](this[_0x5a297c(0x1fd)](_0x3dd525,'@{'+_0x41b139[_0x5a297c(0x1b4)]+_0x5a297c(0x1ea)));}return _0x20e6d;}async[a271_0x3221da(0x1fa)](_0x22e60d,_0x12bccc=![]){const _0x304d3c=a271_0x3221da,_0x590bba={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x2c2bac=[];for(const _0x232892 of _0x22e60d){if(_0x232892['id'])_0x2c2bac[_0x304d3c(0x1dc)](_0x232892['id']);else{const _0x17e8f6=this[_0x304d3c(0x212)][_0x304d3c(0x1f3)](_0x4f0202=>_0x4f0202[_0x304d3c(0x1f8)]===_0x232892['name']&&_0x4f0202[_0x304d3c(0x1b2)]===_0x232892[_0x304d3c(0x1e8)]);if(!_0x17e8f6||!_0x17e8f6[_0x304d3c(0x1f9)])continue;_0x2c2bac['push'](_0x17e8f6[_0x304d3c(0x1f9)]);}}if(_0x12bccc){const _0x486fb1=await this[_0x304d3c(0x1cc)]['fetchCommitManifestsByComponentIds'](_0x2c2bac);_0x590bba[_0x304d3c(0x1d5)]=_0x486fb1[_0x304d3c(0x20b)](_0x3cdd4d=>(0x0,composite_utils_1[_0x304d3c(0x1de)])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x3cdd4d)[_0x304d3c(0x202)]);}return _0x590bba['componentsToUpdate']=_0x2c2bac[_0x304d3c(0x20b)](_0x1acd09=>(0x0,composite_utils_1[_0x304d3c(0x1b5)])(constants_1['FLOSUM_COMPONENT'],_0x1acd09,{[constants_1[_0x304d3c(0x1e4)]+_0x304d3c(0x1c2)]:!![]})[_0x304d3c(0x202)]),_0x590bba[_0x304d3c(0x1c7)]=_0x2c2bac[_0x304d3c(0x20b)](_0x4cafa8=>(0x0,composite_utils_1[_0x304d3c(0x1de)])(constants_1[_0x304d3c(0x1b7)],_0x4cafa8)[_0x304d3c(0x202)]),_0x590bba;}}exports[a271_0x3221da(0x1c9)]=SalesforceComponentsManager;