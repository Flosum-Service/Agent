const a234_0x43e922=a234_0x5424;(function(_0x1d4a70,_0x1090ee){const _0x1013f=a234_0x5424,_0x529e34=_0x1d4a70();while(!![]){try{const _0x49d422=-parseInt(_0x1013f(0x134))/0x1+-parseInt(_0x1013f(0x159))/0x2+parseInt(_0x1013f(0x16f))/0x3+parseInt(_0x1013f(0x150))/0x4*(parseInt(_0x1013f(0x163))/0x5)+-parseInt(_0x1013f(0x16e))/0x6+parseInt(_0x1013f(0x15a))/0x7+parseInt(_0x1013f(0x144))/0x8*(-parseInt(_0x1013f(0x172))/0x9);if(_0x49d422===_0x1090ee)break;else _0x529e34['push'](_0x529e34['shift']());}catch(_0x36ef70){_0x529e34['push'](_0x529e34['shift']());}}}(a234_0x1aa3,0xe039a));const a234_0x5b5fc2=(function(){let _0x511151=!![];return function(_0x12511d,_0x45c6f9){const _0x54426e=_0x511151?function(){if(_0x45c6f9){const _0x224824=_0x45c6f9['apply'](_0x12511d,arguments);return _0x45c6f9=null,_0x224824;}}:function(){};return _0x511151=![],_0x54426e;};}()),a234_0x5bff95=a234_0x5b5fc2(this,function(){const _0x40d746=a234_0x5424;return a234_0x5bff95[_0x40d746(0x11c)]()[_0x40d746(0x167)](_0x40d746(0x15d))['toString']()[_0x40d746(0x168)](a234_0x5bff95)[_0x40d746(0x167)](_0x40d746(0x15d));});function a234_0x5424(_0x429378,_0x265d2b){const _0x4c434f=a234_0x1aa3();return a234_0x5424=function(_0x5bff95,_0x5b5fc2){_0x5bff95=_0x5bff95-0x115;let _0x1aa322=_0x4c434f[_0x5bff95];return _0x1aa322;},a234_0x5424(_0x429378,_0x265d2b);}a234_0x5bff95();'use strict';var __importDefault=this&&this[a234_0x43e922(0x142)]||function(_0x1ce942){const _0x2a42ae=a234_0x43e922;return _0x1ce942&&_0x1ce942[_0x2a42ae(0x146)]?_0x1ce942:{'default':_0x1ce942};};Object[a234_0x43e922(0x176)](exports,'__esModule',{'value':!![]}),exports[a234_0x43e922(0x147)]=void 0x0;function a234_0x1aa3(){const _0xee27f9=['find','componentName','push','5737055liMudh','./salesforce-git-sync.service','FLOSUM_COMPONENT_HISTORY','Source__c','search','constructor','insert','manifests','prepareComponentRecord','Component__c','Component_Name__c','8740644jaapOg','5260134MKjiVH','Is_From_Agent__c','.id}','7299kDvJGH','CRC32__c','file','Changed_On__c','defineProperty','Branch__c','fetchCommitManifestsByComponentIds','FLOSUM_COMPONENT','logger','createDeleteRequest','Description','gitSync','isVlocityComponent','typedi','base64','Repository__c','Repository','toString','repositoryId','username','componentsToDelete','prepareCommitManifest','ContentType','name','../../../../constants','get','Committed_On__c','DEFLATE','filePath','Component_Type__c','RecordTypeId','../../../../core','componentId','SalesforceError','application/zip','FLOSUM_ATTACHMENT','body','recordTypes','SalesforceGitSyncService','createPatchRequest','FLOSUM_GIT_NAMESPACE','1200643idqkzl','proceededComponentsMeta','Commit__c','version','Logger','../utils/composite.utils','getProceededComponentsMeta','Last_Modified_By__c','componentType','branchId',']\x20-\x20meta\x20not\x20found','files','../errors/salesforce.error','request','__importDefault','Changed_By__c','5208mklGDO','createPostRequest','__esModule','SalesforceComponentsManager','FLOSUM_NAMESPACE','vlocityComponentName','delete','Branch','Component_History__c','reference','ParentId','update','4TdRudE','proceedComponentMeta','Version__c','FLOSUM_COMMIT_MANIFEST','generateAsync','File_Name__c','Last_Updated_By__c','prepareComponentAttachmentRecord','../../parsers/utils/zip','1240086ljnXHj','12761406OAYyIA','toISOString','prepareComponentHistoryRecord','(((.+)+)+)+$','map','type'];a234_0x1aa3=function(){return _0xee27f9;};return a234_0x1aa3();}const constants_1=require(a234_0x43e922(0x123)),core_1=require(a234_0x43e922(0x12a)),zip_1=require(a234_0x43e922(0x158)),typedi_1=__importDefault(require(a234_0x43e922(0x118))),salesforce_error_1=require(a234_0x43e922(0x140)),composite_utils_1=require(a234_0x43e922(0x139)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a234_0x43e922(0x164));class SalesforceComponentsManager{constructor(_0x39a36c,_0x34c075,_0x62f843,_0x274a23,_0x1d0e97){const _0xc1996d=a234_0x43e922;this[_0xc1996d(0x11d)]=_0x39a36c,this['branchId']=_0x34c075,this['username']=_0x62f843,this[_0xc1996d(0x130)]=_0x274a23,this[_0xc1996d(0x135)]=_0x1d0e97,this[_0xc1996d(0x17a)]=new core_1[(_0xc1996d(0x138))](SalesforceComponentsManager['name']),this[_0xc1996d(0x116)]=typedi_1['default'][_0xc1996d(0x124)](salesforce_git_sync_service_1[_0xc1996d(0x131)]);}[a234_0x43e922(0x151)](_0x1a7c1d,_0x134015){const _0x2be2d3=a234_0x43e922,_0x1a072c=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x1a7c1d,['Component_Type__c',_0x2be2d3(0x16d),'Version__c']);this['proceededComponentsMeta'][_0x2be2d3(0x162)]({'componentId':'','reference':_0x134015,'version':_0x1a072c[_0x2be2d3(0x152)],'componentName':_0x1a072c[_0x2be2d3(0x16d)],'componentType':_0x1a072c[_0x2be2d3(0x128)]});}[a234_0x43e922(0x120)](_0x4b034c,_0x1d115b){const _0x2288e6=a234_0x43e922,{request:_0x4d9a7d}=(0x0,composite_utils_1[_0x2288e6(0x145)])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x2288e6(0x148)]+_0x2288e6(0x136)]:_0x4b034c,[constants_1[_0x2288e6(0x148)]+_0x2288e6(0x14c)]:_0x1d115b});return _0x4d9a7d;}async[a234_0x43e922(0x157)](_0xc0ebbc,_0x3ecc76){const _0x2ed6b7=a234_0x43e922,_0x348fb7={},_0x253feb=zip_1['Zip']['createZip']();for(const _0x1708ba of Object['keys'](_0xc0ebbc[_0x2ed6b7(0x13f)])){_0x253feb[_0x2ed6b7(0x174)](_0x1708ba,_0xc0ebbc['files'][_0x1708ba],{'createFolders':!![]});}return _0x348fb7[_0x2ed6b7(0x121)]=_0x2ed6b7(0x12d),_0x348fb7['Name']=_0xc0ebbc[_0x2ed6b7(0x15f)],_0x348fb7[_0x2ed6b7(0x115)]=_0xc0ebbc[_0x2ed6b7(0x15f)],_0x348fb7[_0x2ed6b7(0x14e)]=_0x3ecc76,_0x348fb7['Body']=await _0x253feb[_0x2ed6b7(0x154)]({'type':_0x2ed6b7(0x119),'compression':_0x2ed6b7(0x126),'compressionOptions':{'level':0x6}}),_0x348fb7;}[a234_0x43e922(0x15c)](_0x4e3fcd,_0x25d028,_0x1b80b0){const _0xa07c3a=a234_0x43e922,_0x3f84c7=new Date()[_0xa07c3a(0x15b)](),_0x4bf3d2={};return _0x4bf3d2[constants_1['FLOSUM_NAMESPACE']+_0xa07c3a(0x16c)]=_0x25d028,_0x4bf3d2[constants_1[_0xa07c3a(0x148)]+'CRC32__c']=_0x4e3fcd['crc'],_0x4bf3d2[constants_1['FLOSUM_NAMESPACE']+_0xa07c3a(0x175)]=_0x3f84c7,_0x4bf3d2[constants_1[_0xa07c3a(0x148)]+_0xa07c3a(0x143)]=this['username'],_0x4bf3d2[constants_1[_0xa07c3a(0x148)]+'Version__c']=_0x1b80b0?_0x1b80b0+0x1:0x1,_0x4bf3d2[constants_1[_0xa07c3a(0x133)]+_0xa07c3a(0x170)]=!![],_0x4bf3d2;}['prepareComponentRecord'](_0x5965d5,_0x7d2fca){const _0x5b7c12=a234_0x43e922;var _0x53beb0,_0x430cbd;const _0x1759e9=new Date()['toISOString'](),_0x21bfb1={};return!_0x7d2fca?(this[_0x5b7c12(0x13d)]?(_0x21bfb1[constants_1['FLOSUM_NAMESPACE']+_0x5b7c12(0x177)]=this[_0x5b7c12(0x13d)],_0x21bfb1[constants_1[_0x5b7c12(0x148)]+_0x5b7c12(0x166)]=_0x5b7c12(0x14b),_0x21bfb1[_0x5b7c12(0x129)]=(_0x53beb0=this[_0x5b7c12(0x130)][_0x5b7c12(0x160)](_0x1da6e9=>_0x1da6e9[_0x5b7c12(0x122)]==='Branch'))===null||_0x53beb0===void 0x0?void 0x0:_0x53beb0['id']):(_0x21bfb1[constants_1['FLOSUM_NAMESPACE']+_0x5b7c12(0x11a)]=this[_0x5b7c12(0x11d)],_0x21bfb1[constants_1['FLOSUM_NAMESPACE']+_0x5b7c12(0x166)]=_0x5b7c12(0x11b),_0x21bfb1[_0x5b7c12(0x129)]=(_0x430cbd=this[_0x5b7c12(0x130)][_0x5b7c12(0x160)](_0x3cb333=>_0x3cb333[_0x5b7c12(0x122)]==='Repository'))===null||_0x430cbd===void 0x0?void 0x0:_0x430cbd['id']),_0x21bfb1[constants_1['FLOSUM_NAMESPACE']+_0x5b7c12(0x152)]=0x1):_0x21bfb1[constants_1[_0x5b7c12(0x148)]+_0x5b7c12(0x152)]=_0x7d2fca[_0x5b7c12(0x137)]+0x1,_0x21bfb1[constants_1[_0x5b7c12(0x148)]+_0x5b7c12(0x128)]=_0x5965d5[_0x5b7c12(0x15f)],_0x21bfb1[constants_1[_0x5b7c12(0x148)]+_0x5b7c12(0x16d)]=_0x5965d5[_0x5b7c12(0x122)],_0x21bfb1[constants_1[_0x5b7c12(0x148)]+_0x5b7c12(0x155)]=_0x5965d5[_0x5b7c12(0x127)],_0x21bfb1[constants_1['FLOSUM_NAMESPACE']+_0x5b7c12(0x156)]=this[_0x5b7c12(0x11e)],_0x21bfb1[constants_1[_0x5b7c12(0x148)]+_0x5b7c12(0x13b)]=this['username'],_0x21bfb1[constants_1['FLOSUM_NAMESPACE']+'Last_Modified_Date__c']=_0x1759e9,_0x21bfb1[constants_1[_0x5b7c12(0x148)]+_0x5b7c12(0x125)]=_0x1759e9,_0x21bfb1[constants_1[_0x5b7c12(0x148)]+_0x5b7c12(0x173)]=_0x5965d5['crc'],_0x21bfb1[constants_1['FLOSUM_NAMESPACE']+'Vlocity_Component_Name__c']=_0x5965d5[_0x5b7c12(0x149)],_0x21bfb1[constants_1[_0x5b7c12(0x148)]+'Vlocity_Component__c']=_0x5965d5[_0x5b7c12(0x117)],_0x21bfb1;}[a234_0x43e922(0x13a)](){const _0x552448=a234_0x43e922;return this[_0x552448(0x135)];}async[a234_0x43e922(0x169)](_0x1a66cc,_0x2e0e81){const _0x314f2d=a234_0x43e922,_0x1251d4=[];for(const _0x2a7e57 of _0x1a66cc){const _0x37a4ba=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x314f2d(0x179)],this[_0x314f2d(0x16b)](_0x2a7e57)),_0x3ec3e6=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x314f2d(0x165)],this[_0x314f2d(0x15c)](_0x2a7e57,'@{'+_0x37a4ba['reference']+_0x314f2d(0x171))),_0xeb5c6a=(0x0,composite_utils_1[_0x314f2d(0x145)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x314f2d(0x157)](_0x2a7e57,'@{'+_0x3ec3e6['reference']+_0x314f2d(0x171)));this[_0x314f2d(0x151)](_0x37a4ba[_0x314f2d(0x141)]['body'],_0x37a4ba[_0x314f2d(0x14d)]),_0x1251d4[_0x314f2d(0x162)](_0x37a4ba[_0x314f2d(0x141)],_0x3ec3e6[_0x314f2d(0x141)],_0xeb5c6a[_0x314f2d(0x141)]),_0x2e0e81&&_0x1251d4[_0x314f2d(0x162)](this['prepareCommitManifest'](_0x2e0e81,'@{'+_0x3ec3e6[_0x314f2d(0x14d)]+'.id}'));}return _0x1251d4;}async[a234_0x43e922(0x14f)](_0x5e4087,_0x59854b=''){const _0x59c20b=a234_0x43e922,_0x74a8f0=[];for(const {component:_0x34944e,meta:_0x12919d}of _0x5e4087){if(!_0x12919d['id']){const _0x4cefd6=this[_0x59c20b(0x135)]['find'](_0x4b84a5=>_0x4b84a5[_0x59c20b(0x161)]===_0x34944e[_0x59c20b(0x122)]&&_0x4b84a5[_0x59c20b(0x13c)]===_0x34944e[_0x59c20b(0x15f)]);if(!_0x4cefd6)throw new salesforce_error_1[(_0x59c20b(0x12c))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x34944e[_0x59c20b(0x122)]+'\x20['+_0x34944e[_0x59c20b(0x15f)]+_0x59c20b(0x13e)));_0x12919d['id']=_0x4cefd6[_0x59c20b(0x12b)];}const _0x53fa0a=(0x0,composite_utils_1[_0x59c20b(0x132)])(constants_1[_0x59c20b(0x179)],_0x12919d['id'],this['prepareComponentRecord'](_0x34944e,_0x12919d)),_0x41563a=(0x0,composite_utils_1[_0x59c20b(0x145)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x59c20b(0x15c)](_0x34944e,_0x12919d['id'],_0x12919d[_0x59c20b(0x137)])),_0x229ff3=(0x0,composite_utils_1[_0x59c20b(0x145)])(constants_1[_0x59c20b(0x12e)],await this['prepareComponentAttachmentRecord'](_0x34944e,'@{'+_0x41563a[_0x59c20b(0x14d)]+_0x59c20b(0x171)));this[_0x59c20b(0x151)](_0x53fa0a['request'][_0x59c20b(0x12f)],_0x53fa0a[_0x59c20b(0x14d)]),_0x74a8f0[_0x59c20b(0x162)](_0x53fa0a[_0x59c20b(0x141)],_0x41563a[_0x59c20b(0x141)],_0x229ff3[_0x59c20b(0x141)]),_0x59854b&&_0x74a8f0[_0x59c20b(0x162)](this[_0x59c20b(0x120)](_0x59854b,'@{'+_0x41563a[_0x59c20b(0x14d)]+'.id}'));}return _0x74a8f0;}async[a234_0x43e922(0x14a)](_0x539a06,_0x760ea0=![]){const _0x21be3c=a234_0x43e922,_0x4fd3f4={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x2ae11d=[];for(const _0x2481ce of _0x539a06){if(_0x2481ce['id'])_0x2ae11d['push'](_0x2481ce['id']);else{const _0x2a24da=this[_0x21be3c(0x135)][_0x21be3c(0x160)](_0x212039=>_0x212039[_0x21be3c(0x161)]===_0x2481ce[_0x21be3c(0x122)]&&_0x212039[_0x21be3c(0x13c)]===_0x2481ce[_0x21be3c(0x15f)]);if(!_0x2a24da||!_0x2a24da['componentId'])continue;_0x2ae11d['push'](_0x2a24da['componentId']);}}if(_0x760ea0){const _0x914265=await this['gitSync'][_0x21be3c(0x178)](_0x2ae11d);_0x4fd3f4[_0x21be3c(0x16a)]=_0x914265[_0x21be3c(0x15e)](_0x31586c=>(0x0,composite_utils_1[_0x21be3c(0x17b)])(constants_1[_0x21be3c(0x153)],_0x31586c)[_0x21be3c(0x141)]);}return _0x4fd3f4['componentsToUpdate']=_0x2ae11d[_0x21be3c(0x15e)](_0x31d9a1=>(0x0,composite_utils_1[_0x21be3c(0x132)])(constants_1[_0x21be3c(0x179)],_0x31d9a1,{[constants_1[_0x21be3c(0x133)]+'Deletion_By_Agent__c']:!![]})[_0x21be3c(0x141)]),_0x4fd3f4[_0x21be3c(0x11f)]=_0x2ae11d[_0x21be3c(0x15e)](_0x2d3dcc=>(0x0,composite_utils_1[_0x21be3c(0x17b)])(constants_1[_0x21be3c(0x179)],_0x2d3dcc)[_0x21be3c(0x141)]),_0x4fd3f4;}}exports[a234_0x43e922(0x147)]=SalesforceComponentsManager;