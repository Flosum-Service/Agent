const a273_0x3dd220=a273_0x57a5;(function(_0x3b76c9,_0x367486){const _0x13d04f=a273_0x57a5,_0x3f3b3b=_0x3b76c9();while(!![]){try{const _0x2044ad=parseInt(_0x13d04f(0xec))/0x1+-parseInt(_0x13d04f(0x10c))/0x2*(-parseInt(_0x13d04f(0xde))/0x3)+-parseInt(_0x13d04f(0xf9))/0x4*(parseInt(_0x13d04f(0x111))/0x5)+-parseInt(_0x13d04f(0x105))/0x6+-parseInt(_0x13d04f(0xba))/0x7+parseInt(_0x13d04f(0xcf))/0x8*(parseInt(_0x13d04f(0xc9))/0x9)+parseInt(_0x13d04f(0xbe))/0xa;if(_0x2044ad===_0x367486)break;else _0x3f3b3b['push'](_0x3f3b3b['shift']());}catch(_0x2efc0c){_0x3f3b3b['push'](_0x3f3b3b['shift']());}}}(a273_0x4979,0x268b2));const a273_0x11ddaa=(function(){let _0x3d5fbe=!![];return function(_0x2b268d,_0x312675){const _0x4719c1=_0x3d5fbe?function(){if(_0x312675){const _0xae3de2=_0x312675['apply'](_0x2b268d,arguments);return _0x312675=null,_0xae3de2;}}:function(){};return _0x3d5fbe=![],_0x4719c1;};}()),a273_0x223b3b=a273_0x11ddaa(this,function(){const _0x2678a2=a273_0x57a5;return a273_0x223b3b[_0x2678a2(0x100)]()['search'](_0x2678a2(0xc5))[_0x2678a2(0x100)]()[_0x2678a2(0x116)](a273_0x223b3b)[_0x2678a2(0xb9)](_0x2678a2(0xc5));});a273_0x223b3b();'use strict';var __importDefault=this&&this[a273_0x3dd220(0x110)]||function(_0x2fa288){const _0x29c240=a273_0x3dd220;return _0x2fa288&&_0x2fa288[_0x29c240(0xca)]?_0x2fa288:{'default':_0x2fa288};};function a273_0x57a5(_0x3d3df2,_0x55ccb2){const _0x220ded=a273_0x4979();return a273_0x57a5=function(_0x223b3b,_0x11ddaa){_0x223b3b=_0x223b3b-0xb9;let _0x497979=_0x220ded[_0x223b3b];return _0x497979;},a273_0x57a5(_0x3d3df2,_0x55ccb2);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;function a273_0x4979(){const _0x1897f7=['FLOSUM_ATTACHMENT','get','base64','componentType','1882488IIcWWX','getProceededComponentsMeta','Source__c','./salesforce-git-sync.service','Component_Type__c','push','prepareComponentRecord','1434RtkXHg','reference','logger','Repository__c','__importDefault','62805XScZPq','recordTypes','componentsToDelete','type','Zip','constructor','request','createPostRequest','SalesforceError','fetchCommitManifestsByComponentIds','search','599284hPiCni','find','proceededComponentsMeta','Changed_On__c','1244380RwBKXu','file','map','Body','marketingCloudKey','FLOSUM_COMPONENT','Component__c','(((.+)+)+)+$','componentName','username','Is_From_Agent__c','20835gQqejo','__esModule','ContentType','repositoryId','proceedComponentMeta','../../../../constants','504sPeHCp','FLOSUM_COMMIT_MANIFEST','body','gitSync','branchId','Repository','prepareCommitManifest','componentId','../errors/salesforce.error','Component_History__c','DEFLATE','Branch__c','Committed_On__c','toISOString','Version__c','1182huZxzM','Branch','FLOSUM_NAMESPACE','files',']\x20-\x20meta\x20not\x20found','createDeleteRequest','RecordTypeId','SalesforceComponentsManager','prepareComponentHistoryRecord','name','typedi','Component_Name__c','vlocityComponentName','crc','268234vxXZsg','MC_Key__c','Vlocity_Component_Name__c','../utils/composite.utils','Name','File_Name__c','manifests','version','default','isVlocityComponent','createZip','Logger','FLOSUM_GIT_NAMESPACE','84GjoudL','delete','SalesforceGitSyncService','Description','Deletion_By_Agent__c','.id}','FLOSUM_COMPONENT_HISTORY','toString'];a273_0x4979=function(){return _0x1897f7;};return a273_0x4979();}const constants_1=require(a273_0x3dd220(0xce)),core_1=require('../../../../core'),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a273_0x3dd220(0xe8))),salesforce_error_1=require(a273_0x3dd220(0xd7)),composite_utils_1=require(a273_0x3dd220(0xef)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a273_0x3dd220(0x108));class SalesforceComponentsManager{constructor(_0xb220f4,_0x1802f3,_0x4b0c80,_0x2f0e88,_0x2f6cf2){const _0x3255fd=a273_0x3dd220;this[_0x3255fd(0xcc)]=_0xb220f4,this[_0x3255fd(0xd3)]=_0x1802f3,this[_0x3255fd(0xc7)]=_0x4b0c80,this[_0x3255fd(0x112)]=_0x2f0e88,this[_0x3255fd(0xbc)]=_0x2f6cf2,this[_0x3255fd(0x10e)]=new core_1[(_0x3255fd(0xf7))](SalesforceComponentsManager['name']),this['gitSync']=typedi_1[_0x3255fd(0xf4)][_0x3255fd(0x102)](salesforce_git_sync_service_1[_0x3255fd(0xfb)]);}[a273_0x3dd220(0xcd)](_0x50ea89,_0xfed4c2){const _0x55c746=a273_0x3dd220,_0x232c5e=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x50ea89,[_0x55c746(0x109),'Component_Name__c',_0x55c746(0xdd)]);this[_0x55c746(0xbc)][_0x55c746(0x10a)]({'componentId':'','reference':_0xfed4c2,'version':_0x232c5e[_0x55c746(0xdd)],'componentName':_0x232c5e[_0x55c746(0xe9)],'componentType':_0x232c5e[_0x55c746(0x109)]});}['prepareCommitManifest'](_0x5cba85,_0x51a79b){const _0x2540c4=a273_0x3dd220,{request:_0x25f8ad}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x2540c4(0xd0)],{[constants_1[_0x2540c4(0xe0)]+'Commit__c']:_0x5cba85,[constants_1[_0x2540c4(0xe0)]+_0x2540c4(0xd8)]:_0x51a79b});return _0x25f8ad;}async['prepareComponentAttachmentRecord'](_0x194431,_0x1e928b){const _0x136e6c=a273_0x3dd220,_0x5cad57={},_0x1cd299=zip_1[_0x136e6c(0x115)][_0x136e6c(0xf6)]();for(const _0x39b15b of Object['keys'](_0x194431[_0x136e6c(0xe1)])){_0x1cd299[_0x136e6c(0xbf)](_0x39b15b,_0x194431['files'][_0x39b15b],{'createFolders':!![]});}return _0x5cad57[_0x136e6c(0xcb)]='application/zip',_0x5cad57[_0x136e6c(0xf0)]=_0x194431[_0x136e6c(0x114)],_0x5cad57[_0x136e6c(0xfc)]=_0x194431[_0x136e6c(0x114)],_0x5cad57['ParentId']=_0x1e928b,_0x5cad57[_0x136e6c(0xc1)]=await _0x1cd299['generateAsync']({'type':_0x136e6c(0x103),'compression':_0x136e6c(0xd9),'compressionOptions':{'level':0x6}}),_0x5cad57;}['prepareComponentHistoryRecord'](_0x533e42,_0x4578e3,_0xdc904c){const _0x4ab4ec=a273_0x3dd220,_0xf451f1=new Date()['toISOString'](),_0x2eacfa={};return _0x2eacfa[constants_1[_0x4ab4ec(0xe0)]+_0x4ab4ec(0xc4)]=_0x4578e3,_0x2eacfa[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x533e42[_0x4ab4ec(0xeb)],_0x2eacfa[constants_1[_0x4ab4ec(0xe0)]+_0x4ab4ec(0xbd)]=_0xf451f1,_0x2eacfa[constants_1[_0x4ab4ec(0xe0)]+'Changed_By__c']=this['username'],_0x2eacfa[constants_1['FLOSUM_NAMESPACE']+_0x4ab4ec(0xdd)]=_0xdc904c?_0xdc904c+0x1:0x1,_0x2eacfa[constants_1[_0x4ab4ec(0xf8)]+_0x4ab4ec(0xc8)]=!![],_0x2eacfa;}[a273_0x3dd220(0x10b)](_0x2dd69f,_0x269f75){const _0xaa7bb3=a273_0x3dd220;var _0x2e98f5,_0x144270;const _0x46253c=new Date()[_0xaa7bb3(0xdc)](),_0x22ca9d={};return!_0x269f75?(this['branchId']?(_0x22ca9d[constants_1[_0xaa7bb3(0xe0)]+_0xaa7bb3(0xda)]=this[_0xaa7bb3(0xd3)],_0x22ca9d[constants_1['FLOSUM_NAMESPACE']+_0xaa7bb3(0x107)]=_0xaa7bb3(0xdf),_0x22ca9d[_0xaa7bb3(0xe4)]=(_0x2e98f5=this[_0xaa7bb3(0x112)][_0xaa7bb3(0xbb)](_0xd3434=>_0xd3434['name']===_0xaa7bb3(0xdf)))===null||_0x2e98f5===void 0x0?void 0x0:_0x2e98f5['id']):(_0x22ca9d[constants_1['FLOSUM_NAMESPACE']+_0xaa7bb3(0x10f)]=this[_0xaa7bb3(0xcc)],_0x22ca9d[constants_1[_0xaa7bb3(0xe0)]+_0xaa7bb3(0x107)]=_0xaa7bb3(0xd4),_0x22ca9d[_0xaa7bb3(0xe4)]=(_0x144270=this[_0xaa7bb3(0x112)][_0xaa7bb3(0xbb)](_0x4ef7a9=>_0x4ef7a9[_0xaa7bb3(0xe7)]===_0xaa7bb3(0xd4)))===null||_0x144270===void 0x0?void 0x0:_0x144270['id']),_0x22ca9d[constants_1[_0xaa7bb3(0xe0)]+_0xaa7bb3(0xdd)]=0x1):_0x22ca9d[constants_1[_0xaa7bb3(0xe0)]+_0xaa7bb3(0xdd)]=_0x269f75[_0xaa7bb3(0xf3)]+0x1,_0x22ca9d[constants_1[_0xaa7bb3(0xe0)]+'Component_Type__c']=_0x2dd69f['type'],_0x22ca9d[constants_1[_0xaa7bb3(0xe0)]+_0xaa7bb3(0xe9)]=_0x2dd69f[_0xaa7bb3(0xe7)],_0x22ca9d[constants_1[_0xaa7bb3(0xe0)]+_0xaa7bb3(0xf1)]=_0x2dd69f['filePath'],_0x22ca9d[constants_1[_0xaa7bb3(0xe0)]+'Last_Updated_By__c']=this[_0xaa7bb3(0xc7)],_0x22ca9d[constants_1[_0xaa7bb3(0xe0)]+'Last_Modified_By__c']=this[_0xaa7bb3(0xc7)],_0x22ca9d[constants_1[_0xaa7bb3(0xe0)]+'Last_Modified_Date__c']=_0x46253c,_0x22ca9d[constants_1['FLOSUM_NAMESPACE']+_0xaa7bb3(0xdb)]=_0x46253c,_0x22ca9d[constants_1[_0xaa7bb3(0xe0)]+'CRC32__c']=_0x2dd69f[_0xaa7bb3(0xeb)],_0x22ca9d[constants_1['FLOSUM_NAMESPACE']+_0xaa7bb3(0xee)]=_0x2dd69f[_0xaa7bb3(0xea)],_0x22ca9d[constants_1['FLOSUM_NAMESPACE']+'Vlocity_Component__c']=_0x2dd69f[_0xaa7bb3(0xf5)],_0x22ca9d[constants_1['FLOSUM_NAMESPACE']+_0xaa7bb3(0xed)]=_0x2dd69f[_0xaa7bb3(0xc2)],_0x22ca9d;}[a273_0x3dd220(0x106)](){const _0x375b7f=a273_0x3dd220;return this[_0x375b7f(0xbc)];}async['insert'](_0x4b5586,_0x79d21e){const _0xf93419=a273_0x3dd220,_0x29d3c9=[];for(const _0x10f268 of _0x4b5586){const _0x1bf5c7=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0xf93419(0xc3)],this[_0xf93419(0x10b)](_0x10f268)),_0x33372f=(0x0,composite_utils_1[_0xf93419(0x118)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0xf93419(0xe6)](_0x10f268,'@{'+_0x1bf5c7[_0xf93419(0x10d)]+_0xf93419(0xfe))),_0x16b0f6=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0xf93419(0x101)],await this['prepareComponentAttachmentRecord'](_0x10f268,'@{'+_0x33372f[_0xf93419(0x10d)]+_0xf93419(0xfe)));this[_0xf93419(0xcd)](_0x1bf5c7[_0xf93419(0x117)][_0xf93419(0xd1)],_0x1bf5c7['reference']),_0x29d3c9[_0xf93419(0x10a)](_0x1bf5c7[_0xf93419(0x117)],_0x33372f[_0xf93419(0x117)],_0x16b0f6[_0xf93419(0x117)]),_0x79d21e&&_0x29d3c9[_0xf93419(0x10a)](this[_0xf93419(0xd5)](_0x79d21e,'@{'+_0x33372f['reference']+_0xf93419(0xfe)));}return _0x29d3c9;}async['update'](_0x57b245,_0x54b932=''){const _0x1e8d00=a273_0x3dd220,_0x3aac03=[];for(const {component:_0x223059,meta:_0x20437c}of _0x57b245){if(!_0x20437c['id']){const _0xccdd59=this[_0x1e8d00(0xbc)][_0x1e8d00(0xbb)](_0x1a5d56=>_0x1a5d56[_0x1e8d00(0xc6)]===_0x223059['name']&&_0x1a5d56[_0x1e8d00(0x104)]===_0x223059['type']);if(!_0xccdd59)throw new salesforce_error_1[(_0x1e8d00(0x119))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x223059[_0x1e8d00(0xe7)]+'\x20['+_0x223059[_0x1e8d00(0x114)]+_0x1e8d00(0xe2)));_0x20437c['id']=_0xccdd59[_0x1e8d00(0xd6)];}const _0x2f35e6=(0x0,composite_utils_1['createPatchRequest'])(constants_1['FLOSUM_COMPONENT'],_0x20437c['id'],this[_0x1e8d00(0x10b)](_0x223059,_0x20437c)),_0x6a9076=(0x0,composite_utils_1[_0x1e8d00(0x118)])(constants_1[_0x1e8d00(0xff)],this[_0x1e8d00(0xe6)](_0x223059,_0x20437c['id'],_0x20437c['version'])),_0x1ca9ec=(0x0,composite_utils_1[_0x1e8d00(0x118)])(constants_1['FLOSUM_ATTACHMENT'],await this['prepareComponentAttachmentRecord'](_0x223059,'@{'+_0x6a9076[_0x1e8d00(0x10d)]+'.id}'));this[_0x1e8d00(0xcd)](_0x2f35e6[_0x1e8d00(0x117)][_0x1e8d00(0xd1)],_0x2f35e6[_0x1e8d00(0x10d)]),_0x3aac03[_0x1e8d00(0x10a)](_0x2f35e6[_0x1e8d00(0x117)],_0x6a9076[_0x1e8d00(0x117)],_0x1ca9ec[_0x1e8d00(0x117)]),_0x54b932&&_0x3aac03[_0x1e8d00(0x10a)](this[_0x1e8d00(0xd5)](_0x54b932,'@{'+_0x6a9076[_0x1e8d00(0x10d)]+_0x1e8d00(0xfe)));}return _0x3aac03;}async[a273_0x3dd220(0xfa)](_0x213386,_0xe1f231=![]){const _0x2c9f39=a273_0x3dd220,_0x15b74a={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x52bc64=[];for(const _0xe444ab of _0x213386){if(_0xe444ab['id'])_0x52bc64[_0x2c9f39(0x10a)](_0xe444ab['id']);else{const _0x4dead1=this[_0x2c9f39(0xbc)][_0x2c9f39(0xbb)](_0x28f1ca=>_0x28f1ca['componentName']===_0xe444ab['name']&&_0x28f1ca[_0x2c9f39(0x104)]===_0xe444ab[_0x2c9f39(0x114)]);if(!_0x4dead1||!_0x4dead1['componentId'])continue;_0x52bc64['push'](_0x4dead1[_0x2c9f39(0xd6)]);}}if(_0xe1f231){const _0x188dcf=await this[_0x2c9f39(0xd2)][_0x2c9f39(0x11a)](_0x52bc64);_0x15b74a[_0x2c9f39(0xf2)]=_0x188dcf[_0x2c9f39(0xc0)](_0x40d837=>(0x0,composite_utils_1[_0x2c9f39(0xe3)])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x40d837)[_0x2c9f39(0x117)]);}return _0x15b74a['componentsToUpdate']=_0x52bc64[_0x2c9f39(0xc0)](_0x5aeab7=>(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x2c9f39(0xc3)],_0x5aeab7,{[constants_1[_0x2c9f39(0xf8)]+_0x2c9f39(0xfd)]:!![]})[_0x2c9f39(0x117)]),_0x15b74a[_0x2c9f39(0x113)]=_0x52bc64[_0x2c9f39(0xc0)](_0x2b5929=>(0x0,composite_utils_1[_0x2c9f39(0xe3)])(constants_1[_0x2c9f39(0xc3)],_0x2b5929)['request']),_0x15b74a;}}exports[a273_0x3dd220(0xe5)]=SalesforceComponentsManager;