const a245_0x33f494=a245_0x19df;(function(_0x9807d2,_0x26969f){const _0x2d53ee=a245_0x19df,_0x172316=_0x9807d2();while(!![]){try{const _0x54b957=-parseInt(_0x2d53ee(0x192))/0x1+-parseInt(_0x2d53ee(0x168))/0x2*(-parseInt(_0x2d53ee(0x177))/0x3)+parseInt(_0x2d53ee(0x1b4))/0x4+parseInt(_0x2d53ee(0x169))/0x5*(-parseInt(_0x2d53ee(0x17b))/0x6)+parseInt(_0x2d53ee(0x180))/0x7*(parseInt(_0x2d53ee(0x1ae))/0x8)+-parseInt(_0x2d53ee(0x156))/0x9+-parseInt(_0x2d53ee(0x179))/0xa*(-parseInt(_0x2d53ee(0x1a5))/0xb);if(_0x54b957===_0x26969f)break;else _0x172316['push'](_0x172316['shift']());}catch(_0x166e79){_0x172316['push'](_0x172316['shift']());}}}(a245_0x2392,0xaa9ca));const a245_0x2762c5=(function(){let _0x194b92=!![];return function(_0x3d8b25,_0x22a441){const _0x1dddb4=_0x194b92?function(){const _0x12311f=a245_0x19df;if(_0x22a441){const _0xaf43bc=_0x22a441[_0x12311f(0x188)](_0x3d8b25,arguments);return _0x22a441=null,_0xaf43bc;}}:function(){};return _0x194b92=![],_0x1dddb4;};}()),a245_0x4e7522=a245_0x2762c5(this,function(){const _0x5886c3=a245_0x19df;return a245_0x4e7522['toString']()[_0x5886c3(0x183)](_0x5886c3(0x16b))[_0x5886c3(0x14f)]()[_0x5886c3(0x191)](a245_0x4e7522)[_0x5886c3(0x183)]('(((.+)+)+)+$');});a245_0x4e7522();'use strict';function a245_0x2392(){const _0x21a077=['Name','Last_Modified_By__c','getProceededComponentsMeta','Branch__c','createZip','componentsToDelete','createPatchRequest','crc','Changed_By__c','Component_Type__c','Body','6033OqOHCA','FLOSUM_ATTACHMENT','170RsKVgX','isVlocityComponent','210yMeDoY','Committed_On__c','FLOSUM_NAMESPACE','manifests','logger','378nkRRKX','FLOSUM_COMPONENT','FLOSUM_COMMIT_MANIFEST','search','defineProperty','toISOString','Component_History__c','Version__c','apply','prepareComponentHistoryRecord','FLOSUM_COMPONENT_HISTORY','reference','delete','name','__importDefault','typedi','get','constructor','305302PwZkeG','SalesforceError','Last_Updated_By__c','../../parsers/utils/zip','gitSync','Is_From_Agent__c','__esModule','prepareComponentRecord','ParentId','branchId','Description','ContentType','prepareCommitManifest','proceedComponentMeta','componentId','Changed_On__c','prepareComponentAttachmentRecord','Source__c','.id}','429033cHMugt','componentType','map','componentsToUpdate','keys','push','Branch','insert','CRC32__c','6480RQLrzR','./salesforce-git-sync.service','Logger','proceededComponentsMeta','body','Repository','1255820IqHDAU','SalesforceComponentsManager','../../../../core','componentName','toString','extractFieldsFromRecord','Repository__c','SalesforceGitSyncService','Vlocity_Component_Name__c','base64','type','1033839SKDILy','username','application/zip','file','../utils/composite.utils','files','../utils/flosum-naming.utils','repositoryId','Vlocity_Component__c','request','find','version','Component_Name__c','marketingCloudKey','RecordTypeId','createPostRequest','recordTypes',']\x20-\x20meta\x20not\x20found','1156iHmJrr','152015BJeikI','createDeleteRequest','(((.+)+)+)+$'];a245_0x2392=function(){return _0x21a077;};return a245_0x2392();}var __importDefault=this&&this[a245_0x33f494(0x18e)]||function(_0x2d3539){const _0x57d262=a245_0x33f494;return _0x2d3539&&_0x2d3539[_0x57d262(0x198)]?_0x2d3539:{'default':_0x2d3539};};Object[a245_0x33f494(0x184)](exports,a245_0x33f494(0x198),{'value':!![]}),exports[a245_0x33f494(0x1b5)]=void 0x0;function a245_0x19df(_0x143c29,_0x58390){const _0x123236=a245_0x2392();return a245_0x19df=function(_0x4e7522,_0x2762c5){_0x4e7522=_0x4e7522-0x14e;let _0x23929e=_0x123236[_0x4e7522];return _0x23929e;},a245_0x19df(_0x143c29,_0x58390);}const constants_1=require('../../../../constants'),core_1=require(a245_0x33f494(0x1b6)),zip_1=require(a245_0x33f494(0x195)),typedi_1=__importDefault(require(a245_0x33f494(0x18f))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a245_0x33f494(0x15a)),flosum_naming_utils_1=require(a245_0x33f494(0x15c)),salesforce_git_sync_service_1=require(a245_0x33f494(0x1af));class SalesforceComponentsManager{constructor(_0x229696,_0x57289f,_0x348853,_0x5498dc,_0x380287){const _0x54cf74=a245_0x33f494;this['repositoryId']=_0x229696,this[_0x54cf74(0x19b)]=_0x57289f,this['username']=_0x348853,this[_0x54cf74(0x166)]=_0x5498dc,this[_0x54cf74(0x1b1)]=_0x380287,this[_0x54cf74(0x17f)]=new core_1[(_0x54cf74(0x1b0))](SalesforceComponentsManager[_0x54cf74(0x18d)]),this['gitSync']=typedi_1['default'][_0x54cf74(0x190)](salesforce_git_sync_service_1[_0x54cf74(0x152)]);}[a245_0x33f494(0x19f)](_0x3b8a0e,_0x317f12){const _0x434261=a245_0x33f494,_0x51300b=(0x0,flosum_naming_utils_1[_0x434261(0x150)])(_0x3b8a0e,['Component_Type__c','Component_Name__c','Version__c']);this['proceededComponentsMeta'][_0x434261(0x1aa)]({'componentId':'','reference':_0x317f12,'version':_0x51300b[_0x434261(0x187)],'componentName':_0x51300b[_0x434261(0x162)],'componentType':_0x51300b[_0x434261(0x175)]});}[a245_0x33f494(0x19e)](_0x394429,_0x50a73b){const _0x5d665e=a245_0x33f494,{request:_0x55779d}=(0x0,composite_utils_1[_0x5d665e(0x165)])(constants_1[_0x5d665e(0x182)],{[constants_1['FLOSUM_NAMESPACE']+'Commit__c']:_0x394429,[constants_1[_0x5d665e(0x17d)]+_0x5d665e(0x186)]:_0x50a73b});return _0x55779d;}async[a245_0x33f494(0x1a2)](_0x1bbec8,_0x55cf82){const _0x3a0526=a245_0x33f494,_0x229564={},_0x195a20=zip_1['Zip'][_0x3a0526(0x170)]();for(const _0x2b9735 of Object[_0x3a0526(0x1a9)](_0x1bbec8['files'])){_0x195a20[_0x3a0526(0x159)](_0x2b9735,_0x1bbec8[_0x3a0526(0x15b)][_0x2b9735],{'createFolders':!![]});}return _0x229564[_0x3a0526(0x19d)]=_0x3a0526(0x158),_0x229564[_0x3a0526(0x16c)]=_0x1bbec8['type'],_0x229564[_0x3a0526(0x19c)]=_0x1bbec8[_0x3a0526(0x155)],_0x229564[_0x3a0526(0x19a)]=_0x55cf82,_0x229564[_0x3a0526(0x176)]=await _0x195a20['generateAsync']({'type':_0x3a0526(0x154),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x229564;}[a245_0x33f494(0x189)](_0x4bb5e5,_0xe2f9,_0x11b0f9){const _0x234b73=a245_0x33f494,_0x2c6d2b=new Date()[_0x234b73(0x185)](),_0x12735b={};return _0x12735b[constants_1[_0x234b73(0x17d)]+'Component__c']=_0xe2f9,_0x12735b[constants_1[_0x234b73(0x17d)]+_0x234b73(0x1ad)]=_0x4bb5e5[_0x234b73(0x173)],_0x12735b[constants_1[_0x234b73(0x17d)]+_0x234b73(0x1a1)]=_0x2c6d2b,_0x12735b[constants_1[_0x234b73(0x17d)]+_0x234b73(0x174)]=this['username'],_0x12735b[constants_1[_0x234b73(0x17d)]+'Version__c']=_0x11b0f9?_0x11b0f9+0x1:0x1,_0x12735b[constants_1['FLOSUM_GIT_NAMESPACE']+_0x234b73(0x197)]=!![],_0x12735b;}[a245_0x33f494(0x199)](_0x42dd8c,_0x4be17f){const _0x1f6bb8=a245_0x33f494;var _0x531126,_0xae882e;const _0x402e96=new Date()['toISOString'](),_0x165e3f={};return!_0x4be17f?(this[_0x1f6bb8(0x19b)]?(_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+_0x1f6bb8(0x16f)]=this[_0x1f6bb8(0x19b)],_0x165e3f[constants_1['FLOSUM_NAMESPACE']+'Source__c']=_0x1f6bb8(0x1ab),_0x165e3f['RecordTypeId']=(_0x531126=this[_0x1f6bb8(0x166)][_0x1f6bb8(0x160)](_0x388691=>_0x388691[_0x1f6bb8(0x18d)]===_0x1f6bb8(0x1ab)))===null||_0x531126===void 0x0?void 0x0:_0x531126['id']):(_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+_0x1f6bb8(0x151)]=this[_0x1f6bb8(0x15d)],_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+_0x1f6bb8(0x1a3)]=_0x1f6bb8(0x1b3),_0x165e3f[_0x1f6bb8(0x164)]=(_0xae882e=this[_0x1f6bb8(0x166)][_0x1f6bb8(0x160)](_0x503cb3=>_0x503cb3[_0x1f6bb8(0x18d)]===_0x1f6bb8(0x1b3)))===null||_0xae882e===void 0x0?void 0x0:_0xae882e['id']),_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+_0x1f6bb8(0x187)]=0x1):_0x165e3f[constants_1['FLOSUM_NAMESPACE']+'Version__c']=_0x4be17f[_0x1f6bb8(0x161)]+0x1,_0x165e3f[constants_1['FLOSUM_NAMESPACE']+_0x1f6bb8(0x175)]=_0x42dd8c[_0x1f6bb8(0x155)],_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+'Component_Name__c']=_0x42dd8c['name'],_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+'File_Name__c']=_0x42dd8c['filePath'],_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+_0x1f6bb8(0x194)]=this[_0x1f6bb8(0x157)],_0x165e3f[constants_1['FLOSUM_NAMESPACE']+_0x1f6bb8(0x16d)]=this[_0x1f6bb8(0x157)],_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+'Last_Modified_Date__c']=_0x402e96,_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+_0x1f6bb8(0x17c)]=_0x402e96,_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+'CRC32__c']=_0x42dd8c['crc'],_0x165e3f[constants_1['FLOSUM_NAMESPACE']+_0x1f6bb8(0x153)]=_0x42dd8c['vlocityComponentName'],_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+_0x1f6bb8(0x15e)]=_0x42dd8c[_0x1f6bb8(0x17a)],_0x165e3f[constants_1[_0x1f6bb8(0x17d)]+'MC_Key__c']=_0x42dd8c[_0x1f6bb8(0x163)],_0x165e3f;}[a245_0x33f494(0x16e)](){const _0x272a03=a245_0x33f494;return this[_0x272a03(0x1b1)];}async[a245_0x33f494(0x1ac)](_0x767391,_0x3a7bf1){const _0x1c0dfe=a245_0x33f494,_0x238f1b=[];for(const _0x1db4ca of _0x767391){const _0x20f2bc=(0x0,composite_utils_1[_0x1c0dfe(0x165)])(constants_1[_0x1c0dfe(0x181)],this['prepareComponentRecord'](_0x1db4ca)),_0x4004b1=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x1c0dfe(0x18a)],this[_0x1c0dfe(0x189)](_0x1db4ca,'@{'+_0x20f2bc['reference']+_0x1c0dfe(0x1a4))),_0x1a7cc9=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x1c0dfe(0x178)],await this[_0x1c0dfe(0x1a2)](_0x1db4ca,'@{'+_0x4004b1[_0x1c0dfe(0x18b)]+_0x1c0dfe(0x1a4)));this[_0x1c0dfe(0x19f)](_0x20f2bc['request'][_0x1c0dfe(0x1b2)],_0x20f2bc[_0x1c0dfe(0x18b)]),_0x238f1b[_0x1c0dfe(0x1aa)](_0x20f2bc[_0x1c0dfe(0x15f)],_0x4004b1[_0x1c0dfe(0x15f)],_0x1a7cc9[_0x1c0dfe(0x15f)]),_0x3a7bf1&&_0x238f1b['push'](this[_0x1c0dfe(0x19e)](_0x3a7bf1,'@{'+_0x4004b1['reference']+_0x1c0dfe(0x1a4)));}return _0x238f1b;}async['update'](_0x146336,_0x4f9747=''){const _0x56fe0c=a245_0x33f494,_0x322242=[];for(const {component:_0x4775c7,meta:_0x3fa60e}of _0x146336){if(!_0x3fa60e['id']){const _0x4201cc=this[_0x56fe0c(0x1b1)][_0x56fe0c(0x160)](_0x301038=>_0x301038[_0x56fe0c(0x14e)]===_0x4775c7['name']&&_0x301038['componentType']===_0x4775c7[_0x56fe0c(0x155)]);if(!_0x4201cc)throw new salesforce_error_1[(_0x56fe0c(0x193))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x4775c7[_0x56fe0c(0x18d)]+'\x20['+_0x4775c7[_0x56fe0c(0x155)]+_0x56fe0c(0x167)));_0x3fa60e['id']=_0x4201cc[_0x56fe0c(0x1a0)];}const _0x6db5b7=(0x0,composite_utils_1[_0x56fe0c(0x172)])(constants_1[_0x56fe0c(0x181)],_0x3fa60e['id'],this['prepareComponentRecord'](_0x4775c7,_0x3fa60e)),_0x5f0753=(0x0,composite_utils_1[_0x56fe0c(0x165)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x56fe0c(0x189)](_0x4775c7,_0x3fa60e['id'],_0x3fa60e['version'])),_0x28f219=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x56fe0c(0x178)],await this[_0x56fe0c(0x1a2)](_0x4775c7,'@{'+_0x5f0753['reference']+'.id}'));this['proceedComponentMeta'](_0x6db5b7['request']['body'],_0x6db5b7[_0x56fe0c(0x18b)]),_0x322242[_0x56fe0c(0x1aa)](_0x6db5b7[_0x56fe0c(0x15f)],_0x5f0753['request'],_0x28f219[_0x56fe0c(0x15f)]),_0x4f9747&&_0x322242['push'](this[_0x56fe0c(0x19e)](_0x4f9747,'@{'+_0x5f0753[_0x56fe0c(0x18b)]+_0x56fe0c(0x1a4)));}return _0x322242;}async[a245_0x33f494(0x18c)](_0x370502,_0x26ffcf=![]){const _0x435e88=a245_0x33f494,_0xb989b2={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x2cc4fa=[];for(const _0x2ec642 of _0x370502){if(_0x2ec642['id'])_0x2cc4fa[_0x435e88(0x1aa)](_0x2ec642['id']);else{const _0xbcb24=this[_0x435e88(0x1b1)][_0x435e88(0x160)](_0x9c359d=>_0x9c359d[_0x435e88(0x14e)]===_0x2ec642[_0x435e88(0x18d)]&&_0x9c359d[_0x435e88(0x1a6)]===_0x2ec642[_0x435e88(0x155)]);if(!_0xbcb24||!_0xbcb24[_0x435e88(0x1a0)])continue;_0x2cc4fa[_0x435e88(0x1aa)](_0xbcb24['componentId']);}}if(_0x26ffcf){const _0x1b8108=await this[_0x435e88(0x196)]['fetchCommitManifestsByComponentIds'](_0x2cc4fa);_0xb989b2[_0x435e88(0x17e)]=_0x1b8108[_0x435e88(0x1a7)](_0x4aebb2=>(0x0,composite_utils_1[_0x435e88(0x16a)])(constants_1[_0x435e88(0x182)],_0x4aebb2)['request']);}return _0xb989b2[_0x435e88(0x1a8)]=_0x2cc4fa[_0x435e88(0x1a7)](_0x56a8a7=>(0x0,composite_utils_1[_0x435e88(0x172)])(constants_1['FLOSUM_COMPONENT'],_0x56a8a7,{[constants_1['FLOSUM_GIT_NAMESPACE']+'Deletion_By_Agent__c']:!![]})['request']),_0xb989b2[_0x435e88(0x171)]=_0x2cc4fa[_0x435e88(0x1a7)](_0x1c7fca=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x435e88(0x181)],_0x1c7fca)[_0x435e88(0x15f)]),_0xb989b2;}}exports[a245_0x33f494(0x1b5)]=SalesforceComponentsManager;