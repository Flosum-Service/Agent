const a273_0x5094d6=a273_0x593d;(function(_0x2f22c2,_0x3baefb){const _0x585602=a273_0x593d,_0x4f8469=_0x2f22c2();while(!![]){try{const _0x16505c=parseInt(_0x585602(0x190))/0x1+parseInt(_0x585602(0x1da))/0x2*(-parseInt(_0x585602(0x1ea))/0x3)+parseInt(_0x585602(0x18c))/0x4*(parseInt(_0x585602(0x1b3))/0x5)+-parseInt(_0x585602(0x1c6))/0x6*(-parseInt(_0x585602(0x1ad))/0x7)+parseInt(_0x585602(0x1a6))/0x8*(-parseInt(_0x585602(0x1b6))/0x9)+parseInt(_0x585602(0x1ac))/0xa*(parseInt(_0x585602(0x1c5))/0xb)+-parseInt(_0x585602(0x1c9))/0xc;if(_0x16505c===_0x3baefb)break;else _0x4f8469['push'](_0x4f8469['shift']());}catch(_0x12f045){_0x4f8469['push'](_0x4f8469['shift']());}}}(a273_0x2c78,0xdbd56));const a273_0x259cb9=(function(){let _0x13c3cd=!![];return function(_0x47e0ce,_0x28292c){const _0x5ea864=_0x13c3cd?function(){const _0x3d42e7=a273_0x593d;if(_0x28292c){const _0x24a0af=_0x28292c[_0x3d42e7(0x1ed)](_0x47e0ce,arguments);return _0x28292c=null,_0x24a0af;}}:function(){};return _0x13c3cd=![],_0x5ea864;};}()),a273_0x1de006=a273_0x259cb9(this,function(){const _0x4b8519=a273_0x593d;return a273_0x1de006[_0x4b8519(0x1ec)]()[_0x4b8519(0x1d7)](_0x4b8519(0x1d3))[_0x4b8519(0x1ec)]()[_0x4b8519(0x1a3)](a273_0x1de006)[_0x4b8519(0x1d7)](_0x4b8519(0x1d3));});a273_0x1de006();'use strict';function a273_0x593d(_0x18cb32,_0x3e570a){const _0x21ff73=a273_0x2c78();return a273_0x593d=function(_0x1de006,_0x259cb9){_0x1de006=_0x1de006-0x189;let _0x2c78d5=_0x21ff73[_0x1de006];return _0x2c78d5;},a273_0x593d(_0x18cb32,_0x3e570a);}var __importDefault=this&&this[a273_0x5094d6(0x1be)]||function(_0x224e3f){const _0x4bb4ea=a273_0x5094d6;return _0x224e3f&&_0x224e3f[_0x4bb4ea(0x1e6)]?_0x224e3f:{'default':_0x224e3f};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a273_0x5094d6(0x1e0)]=void 0x0;const constants_1=require(a273_0x5094d6(0x1a8)),core_1=require(a273_0x5094d6(0x1af)),zip_1=require(a273_0x5094d6(0x191)),typedi_1=__importDefault(require(a273_0x5094d6(0x1b0))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a273_0x5094d6(0x199)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x2272ba,_0x55a6d5,_0x4d2405,_0x15902d,_0x5c72a1){const _0x3be4df=a273_0x5094d6;this[_0x3be4df(0x18b)]=_0x2272ba,this['branchId']=_0x55a6d5,this[_0x3be4df(0x1ba)]=_0x4d2405,this[_0x3be4df(0x1e1)]=_0x15902d,this[_0x3be4df(0x195)]=_0x5c72a1,this[_0x3be4df(0x19b)]=new core_1[(_0x3be4df(0x1d4))](SalesforceComponentsManager[_0x3be4df(0x193)]),this['gitSync']=typedi_1[_0x3be4df(0x1a7)]['get'](salesforce_git_sync_service_1[_0x3be4df(0x1b4)]);}[a273_0x5094d6(0x1c1)](_0x1bbd27,_0x20309e){const _0x19abec=a273_0x5094d6,_0x39ba9e=(0x0,flosum_naming_utils_1[_0x19abec(0x1e2)])(_0x1bbd27,[_0x19abec(0x1d8),_0x19abec(0x1df),_0x19abec(0x1d2)]);this['proceededComponentsMeta'][_0x19abec(0x1b1)]({'componentId':'','reference':_0x20309e,'version':_0x39ba9e[_0x19abec(0x1d2)],'componentName':_0x39ba9e[_0x19abec(0x1df)],'componentType':_0x39ba9e[_0x19abec(0x1d8)]});}[a273_0x5094d6(0x1c3)](_0x4627ad,_0x42d85e){const _0x4c2d1f=a273_0x5094d6,{request:_0x3b13c3}=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1['FLOSUM_NAMESPACE']+_0x4c2d1f(0x19a)]:_0x4627ad,[constants_1[_0x4c2d1f(0x1ca)]+_0x4c2d1f(0x1c8)]:_0x42d85e});return _0x3b13c3;}async[a273_0x5094d6(0x1b7)](_0x4a9992,_0x2cb795){const _0x4da1c5=a273_0x5094d6,_0x5950c9={},_0x455ab5=zip_1[_0x4da1c5(0x192)][_0x4da1c5(0x19f)]();for(const _0x9ee709 of Object[_0x4da1c5(0x1e4)](_0x4a9992[_0x4da1c5(0x1a5)])){_0x455ab5['file'](_0x9ee709,_0x4a9992[_0x4da1c5(0x1a5)][_0x9ee709],{'createFolders':!![]});}return _0x5950c9[_0x4da1c5(0x19d)]='application/zip',_0x5950c9[_0x4da1c5(0x1e8)]=_0x4a9992[_0x4da1c5(0x1b2)],_0x5950c9[_0x4da1c5(0x1ce)]=_0x4a9992['type'],_0x5950c9['ParentId']=_0x2cb795,_0x5950c9['Body']=await _0x455ab5['generateAsync']({'type':_0x4da1c5(0x1dd),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x5950c9;}[a273_0x5094d6(0x1dc)](_0x342ca0,_0x4324b1,_0x343f4b){const _0x57f409=a273_0x5094d6,_0x21ee5b=new Date()[_0x57f409(0x189)](),_0x372cc4={};return _0x372cc4[constants_1[_0x57f409(0x1ca)]+_0x57f409(0x1cc)]=_0x4324b1,_0x372cc4[constants_1[_0x57f409(0x1ca)]+_0x57f409(0x1d0)]=_0x342ca0['crc'],_0x372cc4[constants_1[_0x57f409(0x1ca)]+'Changed_On__c']=_0x21ee5b,_0x372cc4[constants_1[_0x57f409(0x1ca)]+_0x57f409(0x1ab)]=this[_0x57f409(0x1ba)],_0x372cc4[constants_1[_0x57f409(0x1ca)]+_0x57f409(0x1d2)]=_0x343f4b?_0x343f4b+0x1:0x1,_0x372cc4[constants_1[_0x57f409(0x1c2)]+_0x57f409(0x1c0)]=!![],_0x372cc4;}['prepareComponentRecord'](_0x724b09,_0x1060ce){const _0x25a6cf=a273_0x5094d6;var _0x1afee1,_0x39f1f2;const _0x58de62=new Date()[_0x25a6cf(0x189)](),_0x554381={};return!_0x1060ce?(this[_0x25a6cf(0x1ee)]?(_0x554381[constants_1[_0x25a6cf(0x1ca)]+_0x25a6cf(0x18e)]=this[_0x25a6cf(0x1ee)],_0x554381[constants_1[_0x25a6cf(0x1ca)]+'Source__c']='Branch',_0x554381[_0x25a6cf(0x1d5)]=(_0x1afee1=this[_0x25a6cf(0x1e1)]['find'](_0x4e609e=>_0x4e609e[_0x25a6cf(0x193)]===_0x25a6cf(0x1d9)))===null||_0x1afee1===void 0x0?void 0x0:_0x1afee1['id']):(_0x554381[constants_1[_0x25a6cf(0x1ca)]+_0x25a6cf(0x1cf)]=this[_0x25a6cf(0x18b)],_0x554381[constants_1['FLOSUM_NAMESPACE']+_0x25a6cf(0x197)]=_0x25a6cf(0x1cb),_0x554381[_0x25a6cf(0x1d5)]=(_0x39f1f2=this['recordTypes'][_0x25a6cf(0x1d6)](_0x4d4bd7=>_0x4d4bd7[_0x25a6cf(0x193)]===_0x25a6cf(0x1cb)))===null||_0x39f1f2===void 0x0?void 0x0:_0x39f1f2['id']),_0x554381[constants_1[_0x25a6cf(0x1ca)]+_0x25a6cf(0x1d2)]=0x1):_0x554381[constants_1[_0x25a6cf(0x1ca)]+_0x25a6cf(0x1d2)]=_0x1060ce[_0x25a6cf(0x1aa)]+0x1,_0x554381[constants_1['FLOSUM_NAMESPACE']+_0x25a6cf(0x1d8)]=_0x724b09['type'],_0x554381[constants_1[_0x25a6cf(0x1ca)]+_0x25a6cf(0x1df)]=_0x724b09['name'],_0x554381[constants_1[_0x25a6cf(0x1ca)]+_0x25a6cf(0x1a1)]=_0x724b09[_0x25a6cf(0x194)],_0x554381[constants_1['FLOSUM_NAMESPACE']+_0x25a6cf(0x1bd)]=this[_0x25a6cf(0x1ba)],_0x554381[constants_1[_0x25a6cf(0x1ca)]+_0x25a6cf(0x1db)]=this[_0x25a6cf(0x1ba)],_0x554381[constants_1[_0x25a6cf(0x1ca)]+_0x25a6cf(0x1e9)]=_0x58de62,_0x554381[constants_1['FLOSUM_NAMESPACE']+_0x25a6cf(0x1cd)]=_0x58de62,_0x554381[constants_1[_0x25a6cf(0x1ca)]+'CRC32__c']=_0x724b09[_0x25a6cf(0x19c)],_0x554381[constants_1[_0x25a6cf(0x1ca)]+'Vlocity_Component_Name__c']=_0x724b09['vlocityComponentName'],_0x554381[constants_1[_0x25a6cf(0x1ca)]+'Vlocity_Component__c']=_0x724b09[_0x25a6cf(0x1ef)],_0x554381[constants_1[_0x25a6cf(0x1ca)]+_0x25a6cf(0x1a0)]=_0x724b09[_0x25a6cf(0x1c4)],_0x554381;}[a273_0x5094d6(0x18f)](){const _0x2f54cb=a273_0x5094d6;return this[_0x2f54cb(0x195)];}async[a273_0x5094d6(0x1bb)](_0x414d0a,_0xb163c8){const _0x2817e5=a273_0x5094d6,_0x5d9b96=[];for(const _0x3ff04d of _0x414d0a){const _0x168267=(0x0,composite_utils_1[_0x2817e5(0x18d)])(constants_1['FLOSUM_COMPONENT'],this['prepareComponentRecord'](_0x3ff04d)),_0x12f72e=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x2817e5(0x19e)],this[_0x2817e5(0x1dc)](_0x3ff04d,'@{'+_0x168267[_0x2817e5(0x198)]+_0x2817e5(0x1bc))),_0x4fbcab=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x2817e5(0x1b7)](_0x3ff04d,'@{'+_0x12f72e[_0x2817e5(0x198)]+'.id}'));this[_0x2817e5(0x1c1)](_0x168267[_0x2817e5(0x1c7)]['body'],_0x168267[_0x2817e5(0x198)]),_0x5d9b96[_0x2817e5(0x1b1)](_0x168267[_0x2817e5(0x1c7)],_0x12f72e['request'],_0x4fbcab[_0x2817e5(0x1c7)]),_0xb163c8&&_0x5d9b96[_0x2817e5(0x1b1)](this[_0x2817e5(0x1c3)](_0xb163c8,'@{'+_0x12f72e[_0x2817e5(0x198)]+_0x2817e5(0x1bc)));}return _0x5d9b96;}async[a273_0x5094d6(0x1e7)](_0x5b7a7e,_0xe9a6e0=''){const _0x3e5d75=a273_0x5094d6,_0x47c3d0=[];for(const {component:_0x372b4a,meta:_0x3733ed}of _0x5b7a7e){if(!_0x3733ed['id']){const _0x55be8d=this[_0x3e5d75(0x195)][_0x3e5d75(0x1d6)](_0x178f72=>_0x178f72[_0x3e5d75(0x1bf)]===_0x372b4a[_0x3e5d75(0x193)]&&_0x178f72[_0x3e5d75(0x196)]===_0x372b4a[_0x3e5d75(0x1b2)]);if(!_0x55be8d)throw new salesforce_error_1['SalesforceError'](new Error(_0x3e5d75(0x1a9)+_0x372b4a[_0x3e5d75(0x193)]+'\x20['+_0x372b4a[_0x3e5d75(0x1b2)]+']\x20-\x20meta\x20not\x20found'));_0x3733ed['id']=_0x55be8d[_0x3e5d75(0x1d1)];}const _0x195128=(0x0,composite_utils_1[_0x3e5d75(0x1b5)])(constants_1[_0x3e5d75(0x1a4)],_0x3733ed['id'],this[_0x3e5d75(0x1eb)](_0x372b4a,_0x3733ed)),_0x504b0b=(0x0,composite_utils_1[_0x3e5d75(0x18d)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x3e5d75(0x1dc)](_0x372b4a,_0x3733ed['id'],_0x3733ed[_0x3e5d75(0x1aa)])),_0x3670a9=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x3e5d75(0x1b9)],await this['prepareComponentAttachmentRecord'](_0x372b4a,'@{'+_0x504b0b[_0x3e5d75(0x198)]+_0x3e5d75(0x1bc)));this[_0x3e5d75(0x1c1)](_0x195128[_0x3e5d75(0x1c7)][_0x3e5d75(0x1e5)],_0x195128['reference']),_0x47c3d0[_0x3e5d75(0x1b1)](_0x195128[_0x3e5d75(0x1c7)],_0x504b0b[_0x3e5d75(0x1c7)],_0x3670a9['request']),_0xe9a6e0&&_0x47c3d0[_0x3e5d75(0x1b1)](this[_0x3e5d75(0x1c3)](_0xe9a6e0,'@{'+_0x504b0b[_0x3e5d75(0x198)]+_0x3e5d75(0x1bc)));}return _0x47c3d0;}async[a273_0x5094d6(0x1e3)](_0x510043,_0x234882=![]){const _0x58f0b2=a273_0x5094d6,_0x5a1536={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x508e82=[];for(const _0x5529a6 of _0x510043){if(_0x5529a6['id'])_0x508e82[_0x58f0b2(0x1b1)](_0x5529a6['id']);else{const _0x373b85=this['proceededComponentsMeta']['find'](_0x114592=>_0x114592[_0x58f0b2(0x1bf)]===_0x5529a6[_0x58f0b2(0x193)]&&_0x114592[_0x58f0b2(0x196)]===_0x5529a6[_0x58f0b2(0x1b2)]);if(!_0x373b85||!_0x373b85[_0x58f0b2(0x1d1)])continue;_0x508e82['push'](_0x373b85[_0x58f0b2(0x1d1)]);}}if(_0x234882){const _0x310567=await this[_0x58f0b2(0x18a)]['fetchCommitManifestsByComponentIds'](_0x508e82);_0x5a1536['manifests']=_0x310567['map'](_0x36a0af=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x58f0b2(0x1b8)],_0x36a0af)[_0x58f0b2(0x1c7)]);}return _0x5a1536[_0x58f0b2(0x1ae)]=_0x508e82[_0x58f0b2(0x1de)](_0x1bfa80=>(0x0,composite_utils_1[_0x58f0b2(0x1b5)])(constants_1[_0x58f0b2(0x1a4)],_0x1bfa80,{[constants_1[_0x58f0b2(0x1c2)]+'Deletion_By_Agent__c']:!![]})[_0x58f0b2(0x1c7)]),_0x5a1536[_0x58f0b2(0x1a2)]=_0x508e82[_0x58f0b2(0x1de)](_0x557a08=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x58f0b2(0x1a4)],_0x557a08)[_0x58f0b2(0x1c7)]),_0x5a1536;}}function a273_0x2c78(){const _0x1eae2f=['branchId','isVlocityComponent','toISOString','gitSync','repositoryId','688kjGOuD','createPostRequest','Branch__c','getProceededComponentsMeta','1390918LlwZTn','../../parsers/utils/zip','Zip','name','filePath','proceededComponentsMeta','componentType','Source__c','reference','../utils/flosum-naming.utils','Commit__c','logger','crc','ContentType','FLOSUM_COMPONENT_HISTORY','createZip','MC_Key__c','File_Name__c','componentsToDelete','constructor','FLOSUM_COMPONENT','files','8MEqrYu','default','../../../../constants','Could\x20not\x20proceed\x20component\x20','version','Changed_By__c','7826030aCgeIC','7IQtMyE','componentsToUpdate','../../../../core','typedi','push','type','3205XXZtdF','SalesforceGitSyncService','createPatchRequest','2306682dyFldi','prepareComponentAttachmentRecord','FLOSUM_COMMIT_MANIFEST','FLOSUM_ATTACHMENT','username','insert','.id}','Last_Updated_By__c','__importDefault','componentName','Is_From_Agent__c','proceedComponentMeta','FLOSUM_GIT_NAMESPACE','prepareCommitManifest','marketingCloudKey','11DRNMAx','4761222LDtDNV','request','Component_History__c','6827196XUkkIj','FLOSUM_NAMESPACE','Repository','Component__c','Committed_On__c','Description','Repository__c','CRC32__c','componentId','Version__c','(((.+)+)+)+$','Logger','RecordTypeId','find','search','Component_Type__c','Branch','46GpRmXZ','Last_Modified_By__c','prepareComponentHistoryRecord','base64','map','Component_Name__c','SalesforceComponentsManager','recordTypes','extractFieldsFromRecord','delete','keys','body','__esModule','update','Name','Last_Modified_Date__c','176301BGoRHn','prepareComponentRecord','toString','apply'];a273_0x2c78=function(){return _0x1eae2f;};return a273_0x2c78();}exports['SalesforceComponentsManager']=SalesforceComponentsManager;