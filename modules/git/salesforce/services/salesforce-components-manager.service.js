const a272_0x3e8435=a272_0x2258;(function(_0x4586e7,_0xfa8f8){const _0x43d0ac=a272_0x2258,_0x54d120=_0x4586e7();while(!![]){try{const _0x59e21e=parseInt(_0x43d0ac(0x13e))/0x1*(-parseInt(_0x43d0ac(0x12b))/0x2)+parseInt(_0x43d0ac(0x168))/0x3+-parseInt(_0x43d0ac(0x139))/0x4+parseInt(_0x43d0ac(0x11f))/0x5+parseInt(_0x43d0ac(0x148))/0x6+parseInt(_0x43d0ac(0x13c))/0x7+-parseInt(_0x43d0ac(0x144))/0x8;if(_0x59e21e===_0xfa8f8)break;else _0x54d120['push'](_0x54d120['shift']());}catch(_0x2a4e2b){_0x54d120['push'](_0x54d120['shift']());}}}(a272_0x5c50,0xe5f29));const a272_0x36fda4=(function(){let _0x1c628c=!![];return function(_0x1c5c2c,_0x529958){const _0x301cd1=_0x1c628c?function(){if(_0x529958){const _0x5d3964=_0x529958['apply'](_0x1c5c2c,arguments);return _0x529958=null,_0x5d3964;}}:function(){};return _0x1c628c=![],_0x301cd1;};}()),a272_0x1cd112=a272_0x36fda4(this,function(){const _0xcd9669=a272_0x2258;return a272_0x1cd112[_0xcd9669(0x146)]()[_0xcd9669(0x123)]('(((.+)+)+)+$')[_0xcd9669(0x146)]()[_0xcd9669(0x136)](a272_0x1cd112)[_0xcd9669(0x123)](_0xcd9669(0x147));});a272_0x1cd112();'use strict';function a272_0x2258(_0xbd631b,_0x3b6ef9){const _0x3b9281=a272_0x5c50();return a272_0x2258=function(_0x1cd112,_0x36fda4){_0x1cd112=_0x1cd112-0x109;let _0x5c50a2=_0x3b9281[_0x1cd112];return _0x5c50a2;},a272_0x2258(_0xbd631b,_0x3b6ef9);}var __importDefault=this&&this[a272_0x3e8435(0x12e)]||function(_0x10958c){const _0x337938=a272_0x3e8435;return _0x10958c&&_0x10958c[_0x337938(0x11d)]?_0x10958c:{'default':_0x10958c};};Object['defineProperty'](exports,a272_0x3e8435(0x11d),{'value':!![]}),exports[a272_0x3e8435(0x10b)]=void 0x0;const constants_1=require(a272_0x3e8435(0x140)),core_1=require(a272_0x3e8435(0x10f)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a272_0x3e8435(0x141))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a272_0x3e8435(0x124)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a272_0x3e8435(0x126));function a272_0x5c50(){const _0x133cd0=['prepareComponentAttachmentRecord','version','DEFLATE','vlocityComponentName','generateAsync','FLOSUM_COMPONENT','file','repositoryId','find','Branch','__esModule','files','5749250RaOdPs','getProceededComponentsMeta','FLOSUM_NAMESPACE','Component_History__c','search','../utils/composite.utils','toISOString','./salesforce-git-sync.service','body','MC_Key__c','Zip','push','184SaDxDE',']\x20-\x20meta\x20not\x20found','proceedComponentMeta','__importDefault','filePath','componentsToUpdate','RecordTypeId','Vlocity_Component__c','Body','Version__c','crc','constructor','gitSync','name','6923248AsKDat','.id}','SalesforceError','1672062WDhkjM','Component__c','5273YWSqTd','Component_Name__c','../../../../constants','typedi','marketingCloudKey','map','9089456LVqbmU','request','toString','(((.+)+)+)+$','9416856fvNmOT','createZip','componentType','logger','FLOSUM_GIT_NAMESPACE','SalesforceGitSyncService','keys','proceededComponentsMeta','Last_Updated_By__c','update','prepareCommitManifest','FLOSUM_ATTACHMENT','default','username','createDeleteRequest','Changed_By__c','type','branchId','Source__c','ParentId','componentId','isVlocityComponent','Is_From_Agent__c','Last_Modified_By__c','Name','Vlocity_Component_Name__c','createPostRequest','File_Name__c','componentName','FLOSUM_COMPONENT_HISTORY','extractFieldsFromRecord','FLOSUM_COMMIT_MANIFEST','4007349XPEWar','Deletion_By_Agent__c','Repository','Component_Type__c','createPatchRequest','prepareComponentRecord','Commit__c','CRC32__c','prepareComponentHistoryRecord','reference','SalesforceComponentsManager','application/zip','componentsToDelete','insert','../../../../core','Logger','recordTypes','get'];a272_0x5c50=function(){return _0x133cd0;};return a272_0x5c50();}class SalesforceComponentsManager{constructor(_0x359fb5,_0x16eb35,_0xf959bc,_0x421370,_0x4d360a){const _0x336cc6=a272_0x3e8435;this[_0x336cc6(0x11a)]=_0x359fb5,this[_0x336cc6(0x159)]=_0x16eb35,this[_0x336cc6(0x155)]=_0xf959bc,this[_0x336cc6(0x111)]=_0x421370,this[_0x336cc6(0x14f)]=_0x4d360a,this[_0x336cc6(0x14b)]=new core_1[(_0x336cc6(0x110))](SalesforceComponentsManager[_0x336cc6(0x138)]),this[_0x336cc6(0x137)]=typedi_1[_0x336cc6(0x154)][_0x336cc6(0x112)](salesforce_git_sync_service_1[_0x336cc6(0x14d)]);}[a272_0x3e8435(0x12d)](_0x529102,_0x3b5e5c){const _0xa5ffea=a272_0x3e8435,_0x359f43=(0x0,flosum_naming_utils_1[_0xa5ffea(0x166)])(_0x529102,[_0xa5ffea(0x16b),_0xa5ffea(0x13f),'Version__c']);this[_0xa5ffea(0x14f)][_0xa5ffea(0x12a)]({'componentId':'','reference':_0x3b5e5c,'version':_0x359f43[_0xa5ffea(0x134)],'componentName':_0x359f43['Component_Name__c'],'componentType':_0x359f43[_0xa5ffea(0x16b)]});}[a272_0x3e8435(0x152)](_0x18d39f,_0x2d5538){const _0x48303=a272_0x3e8435,{request:_0x41326b}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x48303(0x167)],{[constants_1[_0x48303(0x121)]+_0x48303(0x16e)]:_0x18d39f,[constants_1['FLOSUM_NAMESPACE']+_0x48303(0x122)]:_0x2d5538});return _0x41326b;}async[a272_0x3e8435(0x113)](_0x282a92,_0x13e13d){const _0x2df76b=a272_0x3e8435,_0x3679df={},_0x68f04c=zip_1[_0x2df76b(0x129)][_0x2df76b(0x149)]();for(const _0x3d9cc3 of Object[_0x2df76b(0x14e)](_0x282a92['files'])){_0x68f04c[_0x2df76b(0x119)](_0x3d9cc3,_0x282a92[_0x2df76b(0x11e)][_0x3d9cc3],{'createFolders':!![]});}return _0x3679df['ContentType']=_0x2df76b(0x10c),_0x3679df[_0x2df76b(0x160)]=_0x282a92['type'],_0x3679df['Description']=_0x282a92[_0x2df76b(0x158)],_0x3679df[_0x2df76b(0x15b)]=_0x13e13d,_0x3679df[_0x2df76b(0x133)]=await _0x68f04c[_0x2df76b(0x117)]({'type':'base64','compression':_0x2df76b(0x115),'compressionOptions':{'level':0x6}}),_0x3679df;}['prepareComponentHistoryRecord'](_0x52b295,_0x59b294,_0x21b5e7){const _0x5ee1d7=a272_0x3e8435,_0x187cec=new Date()[_0x5ee1d7(0x125)](),_0x116c29={};return _0x116c29[constants_1['FLOSUM_NAMESPACE']+_0x5ee1d7(0x13d)]=_0x59b294,_0x116c29[constants_1[_0x5ee1d7(0x121)]+_0x5ee1d7(0x16f)]=_0x52b295['crc'],_0x116c29[constants_1['FLOSUM_NAMESPACE']+'Changed_On__c']=_0x187cec,_0x116c29[constants_1[_0x5ee1d7(0x121)]+_0x5ee1d7(0x157)]=this[_0x5ee1d7(0x155)],_0x116c29[constants_1[_0x5ee1d7(0x121)]+_0x5ee1d7(0x134)]=_0x21b5e7?_0x21b5e7+0x1:0x1,_0x116c29[constants_1['FLOSUM_GIT_NAMESPACE']+_0x5ee1d7(0x15e)]=!![],_0x116c29;}[a272_0x3e8435(0x16d)](_0x48c075,_0x129e57){const _0x3d7fe4=a272_0x3e8435;var _0x34f8b3,_0x5ae3a4;const _0x517521=new Date()[_0x3d7fe4(0x125)](),_0x27f6c6={};return!_0x129e57?(this[_0x3d7fe4(0x159)]?(_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+'Branch__c']=this[_0x3d7fe4(0x159)],_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+_0x3d7fe4(0x15a)]='Branch',_0x27f6c6[_0x3d7fe4(0x131)]=(_0x34f8b3=this['recordTypes'][_0x3d7fe4(0x11b)](_0x1ab9a4=>_0x1ab9a4[_0x3d7fe4(0x138)]===_0x3d7fe4(0x11c)))===null||_0x34f8b3===void 0x0?void 0x0:_0x34f8b3['id']):(_0x27f6c6[constants_1['FLOSUM_NAMESPACE']+'Repository__c']=this[_0x3d7fe4(0x11a)],_0x27f6c6[constants_1['FLOSUM_NAMESPACE']+_0x3d7fe4(0x15a)]=_0x3d7fe4(0x16a),_0x27f6c6['RecordTypeId']=(_0x5ae3a4=this[_0x3d7fe4(0x111)]['find'](_0x38228c=>_0x38228c[_0x3d7fe4(0x138)]==='Repository'))===null||_0x5ae3a4===void 0x0?void 0x0:_0x5ae3a4['id']),_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+_0x3d7fe4(0x134)]=0x1):_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+'Version__c']=_0x129e57[_0x3d7fe4(0x114)]+0x1,_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+'Component_Type__c']=_0x48c075[_0x3d7fe4(0x158)],_0x27f6c6[constants_1['FLOSUM_NAMESPACE']+_0x3d7fe4(0x13f)]=_0x48c075['name'],_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+_0x3d7fe4(0x163)]=_0x48c075[_0x3d7fe4(0x12f)],_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+_0x3d7fe4(0x150)]=this[_0x3d7fe4(0x155)],_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+_0x3d7fe4(0x15f)]=this[_0x3d7fe4(0x155)],_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+'Last_Modified_Date__c']=_0x517521,_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+'Committed_On__c']=_0x517521,_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+'CRC32__c']=_0x48c075[_0x3d7fe4(0x135)],_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+_0x3d7fe4(0x161)]=_0x48c075[_0x3d7fe4(0x116)],_0x27f6c6[constants_1[_0x3d7fe4(0x121)]+_0x3d7fe4(0x132)]=_0x48c075[_0x3d7fe4(0x15d)],_0x27f6c6[constants_1['FLOSUM_NAMESPACE']+_0x3d7fe4(0x128)]=_0x48c075[_0x3d7fe4(0x142)],_0x27f6c6;}[a272_0x3e8435(0x120)](){const _0x3c6a6b=a272_0x3e8435;return this[_0x3c6a6b(0x14f)];}async[a272_0x3e8435(0x10e)](_0x3f340a,_0x24fe2b){const _0x5197bd=a272_0x3e8435,_0x5ca09b=[];for(const _0x46c49d of _0x3f340a){const _0x114feb=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x5197bd(0x118)],this[_0x5197bd(0x16d)](_0x46c49d)),_0x209eda=(0x0,composite_utils_1[_0x5197bd(0x162)])(constants_1[_0x5197bd(0x165)],this[_0x5197bd(0x109)](_0x46c49d,'@{'+_0x114feb['reference']+_0x5197bd(0x13a))),_0x612794=(0x0,composite_utils_1[_0x5197bd(0x162)])(constants_1[_0x5197bd(0x153)],await this[_0x5197bd(0x113)](_0x46c49d,'@{'+_0x209eda['reference']+_0x5197bd(0x13a)));this[_0x5197bd(0x12d)](_0x114feb['request']['body'],_0x114feb[_0x5197bd(0x10a)]),_0x5ca09b[_0x5197bd(0x12a)](_0x114feb[_0x5197bd(0x145)],_0x209eda[_0x5197bd(0x145)],_0x612794[_0x5197bd(0x145)]),_0x24fe2b&&_0x5ca09b['push'](this['prepareCommitManifest'](_0x24fe2b,'@{'+_0x209eda[_0x5197bd(0x10a)]+'.id}'));}return _0x5ca09b;}async[a272_0x3e8435(0x151)](_0x12a901,_0x227e1b=''){const _0x1e91f8=a272_0x3e8435,_0x1fc382=[];for(const {component:_0xeddf45,meta:_0x34f46b}of _0x12a901){if(!_0x34f46b['id']){const _0x244c34=this[_0x1e91f8(0x14f)][_0x1e91f8(0x11b)](_0x4bd096=>_0x4bd096[_0x1e91f8(0x164)]===_0xeddf45[_0x1e91f8(0x138)]&&_0x4bd096['componentType']===_0xeddf45[_0x1e91f8(0x158)]);if(!_0x244c34)throw new salesforce_error_1[(_0x1e91f8(0x13b))](new Error('Could\x20not\x20proceed\x20component\x20'+_0xeddf45['name']+'\x20['+_0xeddf45['type']+_0x1e91f8(0x12c)));_0x34f46b['id']=_0x244c34[_0x1e91f8(0x15c)];}const _0x27dcef=(0x0,composite_utils_1[_0x1e91f8(0x16c)])(constants_1[_0x1e91f8(0x118)],_0x34f46b['id'],this[_0x1e91f8(0x16d)](_0xeddf45,_0x34f46b)),_0x8cecf0=(0x0,composite_utils_1[_0x1e91f8(0x162)])(constants_1[_0x1e91f8(0x165)],this[_0x1e91f8(0x109)](_0xeddf45,_0x34f46b['id'],_0x34f46b['version'])),_0x508efb=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x1e91f8(0x113)](_0xeddf45,'@{'+_0x8cecf0[_0x1e91f8(0x10a)]+'.id}'));this['proceedComponentMeta'](_0x27dcef[_0x1e91f8(0x145)][_0x1e91f8(0x127)],_0x27dcef[_0x1e91f8(0x10a)]),_0x1fc382[_0x1e91f8(0x12a)](_0x27dcef[_0x1e91f8(0x145)],_0x8cecf0['request'],_0x508efb[_0x1e91f8(0x145)]),_0x227e1b&&_0x1fc382[_0x1e91f8(0x12a)](this[_0x1e91f8(0x152)](_0x227e1b,'@{'+_0x8cecf0[_0x1e91f8(0x10a)]+_0x1e91f8(0x13a)));}return _0x1fc382;}async['delete'](_0x642f0a,_0x152671=![]){const _0xa2dd9a=a272_0x3e8435,_0x1ad35f={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x48bff5=[];for(const _0x57282e of _0x642f0a){if(_0x57282e['id'])_0x48bff5['push'](_0x57282e['id']);else{const _0x2a0c32=this[_0xa2dd9a(0x14f)][_0xa2dd9a(0x11b)](_0x75fd36=>_0x75fd36[_0xa2dd9a(0x164)]===_0x57282e['name']&&_0x75fd36[_0xa2dd9a(0x14a)]===_0x57282e[_0xa2dd9a(0x158)]);if(!_0x2a0c32||!_0x2a0c32['componentId'])continue;_0x48bff5[_0xa2dd9a(0x12a)](_0x2a0c32[_0xa2dd9a(0x15c)]);}}if(_0x152671){const _0x6b1613=await this['gitSync']['fetchCommitManifestsByComponentIds'](_0x48bff5);_0x1ad35f['manifests']=_0x6b1613[_0xa2dd9a(0x143)](_0x15e4e5=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0xa2dd9a(0x167)],_0x15e4e5)[_0xa2dd9a(0x145)]);}return _0x1ad35f[_0xa2dd9a(0x130)]=_0x48bff5[_0xa2dd9a(0x143)](_0x3e36f7=>(0x0,composite_utils_1[_0xa2dd9a(0x16c)])(constants_1['FLOSUM_COMPONENT'],_0x3e36f7,{[constants_1[_0xa2dd9a(0x14c)]+_0xa2dd9a(0x169)]:!![]})[_0xa2dd9a(0x145)]),_0x1ad35f[_0xa2dd9a(0x10d)]=_0x48bff5[_0xa2dd9a(0x143)](_0x70d596=>(0x0,composite_utils_1[_0xa2dd9a(0x156)])(constants_1[_0xa2dd9a(0x118)],_0x70d596)[_0xa2dd9a(0x145)]),_0x1ad35f;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;