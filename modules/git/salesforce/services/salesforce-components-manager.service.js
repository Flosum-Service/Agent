const a196_0x1e03bb=a196_0x18c8;(function(_0x3f8d03,_0x450034){const _0x263615=a196_0x18c8,_0x34aed6=_0x3f8d03();while(!![]){try{const _0x10138c=-parseInt(_0x263615(0x14f))/0x1*(-parseInt(_0x263615(0x103))/0x2)+parseInt(_0x263615(0xfd))/0x3+-parseInt(_0x263615(0x139))/0x4+-parseInt(_0x263615(0x12a))/0x5*(-parseInt(_0x263615(0xf5))/0x6)+parseInt(_0x263615(0x13e))/0x7+-parseInt(_0x263615(0x112))/0x8+-parseInt(_0x263615(0x113))/0x9;if(_0x10138c===_0x450034)break;else _0x34aed6['push'](_0x34aed6['shift']());}catch(_0x4af9ca){_0x34aed6['push'](_0x34aed6['shift']());}}}(a196_0x5df3,0x545cb));const a196_0x5a77aa=(function(){let _0x54d4b5=!![];return function(_0x2d9f1d,_0x559569){const _0x3d2051=_0x54d4b5?function(){if(_0x559569){const _0x4aab63=_0x559569['apply'](_0x2d9f1d,arguments);return _0x559569=null,_0x4aab63;}}:function(){};return _0x54d4b5=![],_0x3d2051;};}()),a196_0x243bdd=a196_0x5a77aa(this,function(){const _0xe814d2=a196_0x18c8;return a196_0x243bdd[_0xe814d2(0x151)]()[_0xe814d2(0xfb)]('(((.+)+)+)+$')['toString']()['constructor'](a196_0x243bdd)[_0xe814d2(0xfb)](_0xe814d2(0x106));});a196_0x243bdd();'use strict';var __importDefault=this&&this[a196_0x1e03bb(0x12d)]||function(_0x282945){const _0x5318f2=a196_0x1e03bb;return _0x282945&&_0x282945[_0x5318f2(0x14e)]?_0x282945:{'default':_0x282945};};Object[a196_0x1e03bb(0x138)](exports,a196_0x1e03bb(0x14e),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a196_0x1e03bb(0x12e)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a196_0x1e03bb(0x146))),salesforce_error_1=require(a196_0x1e03bb(0xfa)),composite_utils_1=require(a196_0x1e03bb(0x111)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');function a196_0x5df3(){const _0x25f3e8=['prepareComponentAttachmentRecord','crc','Repository','Component__c','componentName','../utils/composite.utils','3573064nfUUaN','192492njcZdU','proceededComponentsMeta','get','Could\x20not\x20proceed\x20component\x20','componentsToUpdate','toISOString','application/zip','repositoryId','body','componentType','request','ContentType','prepareCommitManifest','ParentId','find','filePath','branchId','Body','username','SalesforceComponentsManager','createZip','Last_Modified_Date__c','Commit__c','6725fnmZyy','componentId','delete','__importDefault','../../../../core','Committed_On__c','Version__c','push','name','Changed_By__c','SalesforceError','FLOSUM_ATTACHMENT','Last_Modified_By__c','Component_Type__c','defineProperty','781568bORUps','FLOSUM_NAMESPACE','Component_History__c','Changed_On__c','FLOSUM_COMPONENT','934178FUwbpR','Description','DEFLATE','createDeleteRequest','keys','prepareComponentHistoryRecord','prepareComponentRecord','fetchCommitManifestsByComponentIds','typedi','Branch','type','Deletion_By_Agent__c','base64','createPostRequest','File_Name__c','FLOSUM_COMMIT_MANIFEST','__esModule','75883pPPHPr','default','toString','insert','map','files','462QqEKug','FLOSUM_GIT_NAMESPACE','Zip','version','FLOSUM_COMPONENT_HISTORY','../errors/salesforce.error','search','createPatchRequest','266982YqBWpT','generateAsync','manifests','getProceededComponentsMeta','reference','recordTypes','18ktOULo','CRC32__c','Repository__c','(((.+)+)+)+$','.id}','Is_From_Agent__c','gitSync','Component_Name__c','proceedComponentMeta'];a196_0x5df3=function(){return _0x25f3e8;};return a196_0x5df3();}class SalesforceComponentsManager{constructor(_0x4fcfa5,_0x2ac6a3,_0x2e0c8e,_0x56e32b,_0x43ac09){const _0x123f22=a196_0x1e03bb;this['repositoryId']=_0x4fcfa5,this[_0x123f22(0x123)]=_0x2ac6a3,this['username']=_0x2e0c8e,this['recordTypes']=_0x56e32b,this[_0x123f22(0x114)]=_0x43ac09,this['logger']=new core_1['Logger'](SalesforceComponentsManager[_0x123f22(0x132)]),this[_0x123f22(0x109)]=typedi_1[_0x123f22(0x150)][_0x123f22(0x115)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a196_0x1e03bb(0x10b)](_0x35ef86,_0x14c5c9){const _0x688aac=a196_0x1e03bb,_0x2faead=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x35ef86,[_0x688aac(0x137),_0x688aac(0x10a),_0x688aac(0x130)]);this[_0x688aac(0x114)][_0x688aac(0x131)]({'componentId':'','reference':_0x14c5c9,'version':_0x2faead[_0x688aac(0x130)],'componentName':_0x2faead[_0x688aac(0x10a)],'componentType':_0x2faead['Component_Type__c']});}[a196_0x1e03bb(0x11f)](_0x543d9f,_0x25eb26){const _0x5083da=a196_0x1e03bb,{request:_0x23b6b4}=(0x0,composite_utils_1[_0x5083da(0x14b)])(constants_1[_0x5083da(0x14d)],{[constants_1[_0x5083da(0x13a)]+_0x5083da(0x129)]:_0x543d9f,[constants_1['FLOSUM_NAMESPACE']+_0x5083da(0x13b)]:_0x25eb26});return _0x23b6b4;}async[a196_0x1e03bb(0x10c)](_0x2057f0,_0x38bef5){const _0x2a10b4=a196_0x1e03bb,_0x5dde12={},_0x40a687=zip_1[_0x2a10b4(0xf7)][_0x2a10b4(0x127)]();for(const _0x1f26b4 of Object[_0x2a10b4(0x142)](_0x2057f0[_0x2a10b4(0x154)])){_0x40a687['file'](_0x1f26b4,_0x2057f0['files'][_0x1f26b4],{'createFolders':!![]});}return _0x5dde12[_0x2a10b4(0x11e)]=_0x2a10b4(0x119),_0x5dde12['Name']=_0x2057f0['type'],_0x5dde12[_0x2a10b4(0x13f)]=_0x2057f0[_0x2a10b4(0x148)],_0x5dde12[_0x2a10b4(0x120)]=_0x38bef5,_0x5dde12[_0x2a10b4(0x124)]=await _0x40a687[_0x2a10b4(0xfe)]({'type':_0x2a10b4(0x14a),'compression':_0x2a10b4(0x140),'compressionOptions':{'level':0x6}}),_0x5dde12;}['prepareComponentHistoryRecord'](_0xf2d2a,_0x53ee50,_0x5da027){const _0x17466e=a196_0x1e03bb,_0x4cd651=new Date()[_0x17466e(0x118)](),_0x2ac576={};return _0x2ac576[constants_1[_0x17466e(0x13a)]+_0x17466e(0x10f)]=_0x53ee50,_0x2ac576[constants_1[_0x17466e(0x13a)]+_0x17466e(0x104)]=_0xf2d2a[_0x17466e(0x10d)],_0x2ac576[constants_1[_0x17466e(0x13a)]+_0x17466e(0x13c)]=_0x4cd651,_0x2ac576[constants_1[_0x17466e(0x13a)]+_0x17466e(0x133)]=this['username'],_0x2ac576[constants_1[_0x17466e(0x13a)]+'Version__c']=_0x5da027?_0x5da027+0x1:0x1,_0x2ac576[constants_1[_0x17466e(0xf6)]+_0x17466e(0x108)]=!![],_0x2ac576;}[a196_0x1e03bb(0x144)](_0x1dd7f0,_0x56db14){const _0x1d2ec4=a196_0x1e03bb;var _0x231dc5,_0x1ad53e;const _0x5ee61d=new Date()[_0x1d2ec4(0x118)](),_0xc9c49c={};return!_0x56db14?(this['branchId']?(_0xc9c49c[constants_1[_0x1d2ec4(0x13a)]+'Branch__c']=this[_0x1d2ec4(0x123)],_0xc9c49c[constants_1['FLOSUM_NAMESPACE']+'Source__c']=_0x1d2ec4(0x147),_0xc9c49c['RecordTypeId']=(_0x231dc5=this[_0x1d2ec4(0x102)][_0x1d2ec4(0x121)](_0x5d5776=>_0x5d5776['name']==='Branch'))===null||_0x231dc5===void 0x0?void 0x0:_0x231dc5['id']):(_0xc9c49c[constants_1[_0x1d2ec4(0x13a)]+_0x1d2ec4(0x105)]=this[_0x1d2ec4(0x11a)],_0xc9c49c[constants_1['FLOSUM_NAMESPACE']+'Source__c']=_0x1d2ec4(0x10e),_0xc9c49c['RecordTypeId']=(_0x1ad53e=this[_0x1d2ec4(0x102)][_0x1d2ec4(0x121)](_0x4c8586=>_0x4c8586[_0x1d2ec4(0x132)]===_0x1d2ec4(0x10e)))===null||_0x1ad53e===void 0x0?void 0x0:_0x1ad53e['id']),_0xc9c49c[constants_1[_0x1d2ec4(0x13a)]+_0x1d2ec4(0x130)]=0x1):_0xc9c49c[constants_1[_0x1d2ec4(0x13a)]+_0x1d2ec4(0x130)]=_0x56db14[_0x1d2ec4(0xf8)]+0x1,_0xc9c49c[constants_1[_0x1d2ec4(0x13a)]+'Component_Type__c']=_0x1dd7f0[_0x1d2ec4(0x148)],_0xc9c49c[constants_1[_0x1d2ec4(0x13a)]+'Component_Name__c']=_0x1dd7f0['name'],_0xc9c49c[constants_1[_0x1d2ec4(0x13a)]+_0x1d2ec4(0x14c)]=_0x1dd7f0[_0x1d2ec4(0x122)],_0xc9c49c[constants_1[_0x1d2ec4(0x13a)]+'Last_Updated_By__c']=this[_0x1d2ec4(0x125)],_0xc9c49c[constants_1['FLOSUM_NAMESPACE']+_0x1d2ec4(0x136)]=this[_0x1d2ec4(0x125)],_0xc9c49c[constants_1[_0x1d2ec4(0x13a)]+_0x1d2ec4(0x128)]=_0x5ee61d,_0xc9c49c[constants_1[_0x1d2ec4(0x13a)]+_0x1d2ec4(0x12f)]=_0x5ee61d,_0xc9c49c[constants_1['FLOSUM_NAMESPACE']+_0x1d2ec4(0x104)]=_0x1dd7f0[_0x1d2ec4(0x10d)],_0xc9c49c;}[a196_0x1e03bb(0x100)](){const _0x18b35f=a196_0x1e03bb;return this[_0x18b35f(0x114)];}async[a196_0x1e03bb(0x152)](_0x2fa13e,_0x16ff48){const _0x1fca67=a196_0x1e03bb,_0x5b3aae=[];for(const _0x345225 of _0x2fa13e){const _0x406090=(0x0,composite_utils_1[_0x1fca67(0x14b)])(constants_1[_0x1fca67(0x13d)],this['prepareComponentRecord'](_0x345225)),_0x2c7824=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x1fca67(0x143)](_0x345225,'@{'+_0x406090[_0x1fca67(0x101)]+_0x1fca67(0x107))),_0x462f55=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x1fca67(0x135)],await this[_0x1fca67(0x10c)](_0x345225,'@{'+_0x2c7824['reference']+_0x1fca67(0x107)));this[_0x1fca67(0x10b)](_0x406090[_0x1fca67(0x11d)][_0x1fca67(0x11b)],_0x406090[_0x1fca67(0x101)]),_0x5b3aae[_0x1fca67(0x131)](_0x406090[_0x1fca67(0x11d)],_0x2c7824[_0x1fca67(0x11d)],_0x462f55[_0x1fca67(0x11d)]),_0x16ff48&&_0x5b3aae[_0x1fca67(0x131)](this['prepareCommitManifest'](_0x16ff48,'@{'+_0x2c7824[_0x1fca67(0x101)]+'.id}'));}return _0x5b3aae;}async['update'](_0x5a3aab,_0x5136da=''){const _0x3b2884=a196_0x1e03bb,_0x475d5a=[];for(const {component:_0x2f4a37,meta:_0x2c3640}of _0x5a3aab){if(!_0x2c3640['id']){const _0x56cc0d=this['proceededComponentsMeta']['find'](_0x550b9e=>_0x550b9e[_0x3b2884(0x110)]===_0x2f4a37[_0x3b2884(0x132)]&&_0x550b9e[_0x3b2884(0x11c)]===_0x2f4a37[_0x3b2884(0x148)]);if(!_0x56cc0d)throw new salesforce_error_1[(_0x3b2884(0x134))](new Error(_0x3b2884(0x116)+_0x2f4a37[_0x3b2884(0x132)]+'\x20['+_0x2f4a37[_0x3b2884(0x148)]+']\x20-\x20meta\x20not\x20found'));_0x2c3640['id']=_0x56cc0d[_0x3b2884(0x12b)];}const _0x15637a=(0x0,composite_utils_1[_0x3b2884(0xfc)])(constants_1[_0x3b2884(0x13d)],_0x2c3640['id'],this[_0x3b2884(0x144)](_0x2f4a37,_0x2c3640)),_0x38f6fd=(0x0,composite_utils_1[_0x3b2884(0x14b)])(constants_1[_0x3b2884(0xf9)],this[_0x3b2884(0x143)](_0x2f4a37,_0x2c3640['id'],_0x2c3640[_0x3b2884(0xf8)])),_0x56076b=(0x0,composite_utils_1[_0x3b2884(0x14b)])(constants_1[_0x3b2884(0x135)],await this[_0x3b2884(0x10c)](_0x2f4a37,'@{'+_0x38f6fd[_0x3b2884(0x101)]+_0x3b2884(0x107)));this[_0x3b2884(0x10b)](_0x15637a[_0x3b2884(0x11d)][_0x3b2884(0x11b)],_0x15637a[_0x3b2884(0x101)]),_0x475d5a[_0x3b2884(0x131)](_0x15637a[_0x3b2884(0x11d)],_0x38f6fd[_0x3b2884(0x11d)],_0x56076b[_0x3b2884(0x11d)]),_0x5136da&&_0x475d5a[_0x3b2884(0x131)](this[_0x3b2884(0x11f)](_0x5136da,'@{'+_0x38f6fd['reference']+_0x3b2884(0x107)));}return _0x475d5a;}async[a196_0x1e03bb(0x12c)](_0x581ed2,_0x48386c=![]){const _0x54482b=a196_0x1e03bb,_0x4e4518={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x10aa78=[];for(const _0x3acf3c of _0x581ed2){if(_0x3acf3c['id'])_0x10aa78[_0x54482b(0x131)](_0x3acf3c['id']);else{const _0x34eb50=this[_0x54482b(0x114)][_0x54482b(0x121)](_0x231a37=>_0x231a37[_0x54482b(0x110)]===_0x3acf3c['name']&&_0x231a37[_0x54482b(0x11c)]===_0x3acf3c[_0x54482b(0x148)]);if(!_0x34eb50||!_0x34eb50[_0x54482b(0x12b)])continue;_0x10aa78['push'](_0x34eb50['componentId']);}}if(_0x48386c){const _0x425811=await this[_0x54482b(0x109)][_0x54482b(0x145)](_0x10aa78);_0x4e4518[_0x54482b(0xff)]=_0x425811[_0x54482b(0x153)](_0x3c0391=>(0x0,composite_utils_1[_0x54482b(0x141)])(constants_1[_0x54482b(0x14d)],_0x3c0391)[_0x54482b(0x11d)]);}return _0x4e4518[_0x54482b(0x117)]=_0x10aa78[_0x54482b(0x153)](_0x41a49b=>(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x54482b(0x13d)],_0x41a49b,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x54482b(0x149)]:!![]})[_0x54482b(0x11d)]),_0x4e4518['componentsToDelete']=_0x10aa78['map'](_0x4e6f64=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x54482b(0x13d)],_0x4e6f64)[_0x54482b(0x11d)]),_0x4e4518;}}function a196_0x18c8(_0x6ff189,_0x48577c){const _0x19b7a3=a196_0x5df3();return a196_0x18c8=function(_0x243bdd,_0x5a77aa){_0x243bdd=_0x243bdd-0xf5;let _0x5df3fb=_0x19b7a3[_0x243bdd];return _0x5df3fb;},a196_0x18c8(_0x6ff189,_0x48577c);}exports[a196_0x1e03bb(0x126)]=SalesforceComponentsManager;