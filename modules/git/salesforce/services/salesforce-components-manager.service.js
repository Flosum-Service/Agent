const a273_0x168a3f=a273_0x3dd6;function a273_0x3dd6(_0x83b0a6,_0x4ff226){const _0x5a9a0f=a273_0x4dfd();return a273_0x3dd6=function(_0x4b617f,_0x4b0655){_0x4b617f=_0x4b617f-0xc6;let _0x4dfd72=_0x5a9a0f[_0x4b617f];return _0x4dfd72;},a273_0x3dd6(_0x83b0a6,_0x4ff226);}(function(_0x192ffc,_0x39b3d0){const _0xd1f6d9=a273_0x3dd6,_0x25f9ef=_0x192ffc();while(!![]){try{const _0x424469=parseInt(_0xd1f6d9(0x101))/0x1+-parseInt(_0xd1f6d9(0xe8))/0x2+parseInt(_0xd1f6d9(0xda))/0x3*(parseInt(_0xd1f6d9(0xca))/0x4)+-parseInt(_0xd1f6d9(0x110))/0x5*(-parseInt(_0xd1f6d9(0xf0))/0x6)+-parseInt(_0xd1f6d9(0xd3))/0x7+parseInt(_0xd1f6d9(0xcf))/0x8+-parseInt(_0xd1f6d9(0xdc))/0x9;if(_0x424469===_0x39b3d0)break;else _0x25f9ef['push'](_0x25f9ef['shift']());}catch(_0x503c0f){_0x25f9ef['push'](_0x25f9ef['shift']());}}}(a273_0x4dfd,0x7ae64));const a273_0x4b0655=(function(){let _0x1cfad3=!![];return function(_0x777fba,_0x1b5ac4){const _0x102bef=_0x1cfad3?function(){const _0x210064=a273_0x3dd6;if(_0x1b5ac4){const _0x58c52d=_0x1b5ac4[_0x210064(0xd8)](_0x777fba,arguments);return _0x1b5ac4=null,_0x58c52d;}}:function(){};return _0x1cfad3=![],_0x102bef;};}()),a273_0x4b617f=a273_0x4b0655(this,function(){const _0x154337=a273_0x3dd6;return a273_0x4b617f[_0x154337(0x11d)]()[_0x154337(0xe6)](_0x154337(0x11a))[_0x154337(0x11d)]()[_0x154337(0x11b)](a273_0x4b617f)[_0x154337(0xe6)](_0x154337(0x11a));});a273_0x4b617f();function a273_0x4dfd(){const _0x56d94a=['reference','username','repositoryId','vlocityComponentName','RecordTypeId','prepareCommitManifest','Branch','(((.+)+)+)+$','constructor','crc','toString','FLOSUM_COMPONENT','push',']\x20-\x20meta\x20not\x20found','getProceededComponentsMeta','SalesforceGitSyncService','./salesforce-git-sync.service','Branch__c','Vlocity_Component_Name__c','Repository','Component_History__c','createPostRequest','type','body','componentName','FLOSUM_ATTACHMENT','FLOSUM_GIT_NAMESPACE','request','manifests','name','Source__c','4dMtjsH','default','../errors/salesforce.error','marketingCloudKey','proceededComponentsMeta','579432dzGUjw','.id}','keys','createDeleteRequest','3101665TtfLxL','componentId','../../../../core','FLOSUM_NAMESPACE','extractFieldsFromRecord','apply','DEFLATE','1002075tSIUAZ','prepareComponentHistoryRecord','1483776zDwJtP','update','Vlocity_Component__c','Description','prepareComponentRecord','map','application/zip','gitSync','proceedComponentMeta','Component_Name__c','search','createZip','344920yQWMxn','filePath','componentType','file','version','Logger','Commit__c','files','3642DanEAk','Component_Type__c','FLOSUM_COMMIT_MANIFEST','ParentId','Component__c','prepareComponentAttachmentRecord','Version__c','__importDefault','Is_From_Agent__c','toISOString','FLOSUM_COMPONENT_HISTORY','recordTypes','Changed_By__c','componentsToUpdate','CRC32__c','defineProperty','Changed_On__c','691012JKviqp','branchId','../utils/composite.utils','logger','Last_Modified_By__c','../../parsers/utils/zip','typedi','SalesforceComponentsManager','get','isVlocityComponent','Name','Deletion_By_Agent__c','../../../../constants','createPatchRequest','ContentType','1535VIbuSm','Last_Updated_By__c','find'];a273_0x4dfd=function(){return _0x56d94a;};return a273_0x4dfd();}'use strict';var __importDefault=this&&this[a273_0x168a3f(0xf7)]||function(_0x4a2f98){return _0x4a2f98&&_0x4a2f98['__esModule']?_0x4a2f98:{'default':_0x4a2f98};};Object[a273_0x168a3f(0xff)](exports,'__esModule',{'value':!![]}),exports[a273_0x168a3f(0x108)]=void 0x0;const constants_1=require(a273_0x168a3f(0x10d)),core_1=require(a273_0x168a3f(0xd5)),zip_1=require(a273_0x168a3f(0x106)),typedi_1=__importDefault(require(a273_0x168a3f(0x107))),salesforce_error_1=require(a273_0x168a3f(0xcc)),composite_utils_1=require(a273_0x168a3f(0x103)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a273_0x168a3f(0x123));class SalesforceComponentsManager{constructor(_0x564a9e,_0x9fff0b,_0x556d60,_0x459b3e,_0x4793c5){const _0x360847=a273_0x168a3f;this[_0x360847(0x115)]=_0x564a9e,this[_0x360847(0x102)]=_0x9fff0b,this[_0x360847(0x114)]=_0x556d60,this[_0x360847(0xfb)]=_0x459b3e,this[_0x360847(0xce)]=_0x4793c5,this[_0x360847(0x104)]=new core_1[(_0x360847(0xed))](SalesforceComponentsManager[_0x360847(0xc8)]),this[_0x360847(0xe3)]=typedi_1[_0x360847(0xcb)][_0x360847(0x109)](salesforce_git_sync_service_1[_0x360847(0x122)]);}[a273_0x168a3f(0xe4)](_0x137def,_0x22e060){const _0x59ea81=a273_0x168a3f,_0xb946a4=(0x0,flosum_naming_utils_1[_0x59ea81(0xd7)])(_0x137def,[_0x59ea81(0xf1),_0x59ea81(0xe5),_0x59ea81(0xf6)]);this[_0x59ea81(0xce)]['push']({'componentId':'','reference':_0x22e060,'version':_0xb946a4[_0x59ea81(0xf6)],'componentName':_0xb946a4['Component_Name__c'],'componentType':_0xb946a4[_0x59ea81(0xf1)]});}[a273_0x168a3f(0x118)](_0x336d04,_0x239c1d){const _0x254b27=a273_0x168a3f,{request:_0x517100}=(0x0,composite_utils_1[_0x254b27(0x128)])(constants_1[_0x254b27(0xf2)],{[constants_1['FLOSUM_NAMESPACE']+_0x254b27(0xee)]:_0x336d04,[constants_1['FLOSUM_NAMESPACE']+_0x254b27(0x127)]:_0x239c1d});return _0x517100;}async[a273_0x168a3f(0xf5)](_0xd64362,_0x4c1c5a){const _0x3ee66e=a273_0x168a3f,_0x2b7119={},_0x589d09=zip_1['Zip'][_0x3ee66e(0xe7)]();for(const _0x3fbda8 of Object[_0x3ee66e(0xd1)](_0xd64362[_0x3ee66e(0xef)])){_0x589d09[_0x3ee66e(0xeb)](_0x3fbda8,_0xd64362['files'][_0x3fbda8],{'createFolders':!![]});}return _0x2b7119[_0x3ee66e(0x10f)]=_0x3ee66e(0xe2),_0x2b7119[_0x3ee66e(0x10b)]=_0xd64362[_0x3ee66e(0x129)],_0x2b7119[_0x3ee66e(0xdf)]=_0xd64362['type'],_0x2b7119[_0x3ee66e(0xf3)]=_0x4c1c5a,_0x2b7119['Body']=await _0x589d09['generateAsync']({'type':'base64','compression':_0x3ee66e(0xd9),'compressionOptions':{'level':0x6}}),_0x2b7119;}[a273_0x168a3f(0xdb)](_0x24516d,_0x5d7687,_0x40f85b){const _0x4243a4=a273_0x168a3f,_0x6b2cc1=new Date()[_0x4243a4(0xf9)](),_0x5992b5={};return _0x5992b5[constants_1[_0x4243a4(0xd6)]+_0x4243a4(0xf4)]=_0x5d7687,_0x5992b5[constants_1[_0x4243a4(0xd6)]+_0x4243a4(0xfe)]=_0x24516d[_0x4243a4(0x11c)],_0x5992b5[constants_1['FLOSUM_NAMESPACE']+_0x4243a4(0x100)]=_0x6b2cc1,_0x5992b5[constants_1[_0x4243a4(0xd6)]+_0x4243a4(0xfc)]=this['username'],_0x5992b5[constants_1[_0x4243a4(0xd6)]+_0x4243a4(0xf6)]=_0x40f85b?_0x40f85b+0x1:0x1,_0x5992b5[constants_1[_0x4243a4(0x12d)]+_0x4243a4(0xf8)]=!![],_0x5992b5;}[a273_0x168a3f(0xe0)](_0x33feca,_0x273ff9){const _0x2c7dc0=a273_0x168a3f;var _0x461f37,_0x5ab4f2;const _0x21d789=new Date()['toISOString'](),_0x5f5d84={};return!_0x273ff9?(this[_0x2c7dc0(0x102)]?(_0x5f5d84[constants_1[_0x2c7dc0(0xd6)]+_0x2c7dc0(0x124)]=this['branchId'],_0x5f5d84[constants_1[_0x2c7dc0(0xd6)]+_0x2c7dc0(0xc9)]=_0x2c7dc0(0x119),_0x5f5d84[_0x2c7dc0(0x117)]=(_0x461f37=this[_0x2c7dc0(0xfb)][_0x2c7dc0(0x112)](_0x5a8ba6=>_0x5a8ba6['name']===_0x2c7dc0(0x119)))===null||_0x461f37===void 0x0?void 0x0:_0x461f37['id']):(_0x5f5d84[constants_1[_0x2c7dc0(0xd6)]+'Repository__c']=this['repositoryId'],_0x5f5d84[constants_1['FLOSUM_NAMESPACE']+_0x2c7dc0(0xc9)]=_0x2c7dc0(0x126),_0x5f5d84[_0x2c7dc0(0x117)]=(_0x5ab4f2=this[_0x2c7dc0(0xfb)][_0x2c7dc0(0x112)](_0x57c097=>_0x57c097[_0x2c7dc0(0xc8)]===_0x2c7dc0(0x126)))===null||_0x5ab4f2===void 0x0?void 0x0:_0x5ab4f2['id']),_0x5f5d84[constants_1['FLOSUM_NAMESPACE']+'Version__c']=0x1):_0x5f5d84[constants_1[_0x2c7dc0(0xd6)]+_0x2c7dc0(0xf6)]=_0x273ff9[_0x2c7dc0(0xec)]+0x1,_0x5f5d84[constants_1['FLOSUM_NAMESPACE']+_0x2c7dc0(0xf1)]=_0x33feca[_0x2c7dc0(0x129)],_0x5f5d84[constants_1[_0x2c7dc0(0xd6)]+_0x2c7dc0(0xe5)]=_0x33feca[_0x2c7dc0(0xc8)],_0x5f5d84[constants_1[_0x2c7dc0(0xd6)]+'File_Name__c']=_0x33feca[_0x2c7dc0(0xe9)],_0x5f5d84[constants_1['FLOSUM_NAMESPACE']+_0x2c7dc0(0x111)]=this[_0x2c7dc0(0x114)],_0x5f5d84[constants_1[_0x2c7dc0(0xd6)]+_0x2c7dc0(0x105)]=this[_0x2c7dc0(0x114)],_0x5f5d84[constants_1[_0x2c7dc0(0xd6)]+'Last_Modified_Date__c']=_0x21d789,_0x5f5d84[constants_1[_0x2c7dc0(0xd6)]+'Committed_On__c']=_0x21d789,_0x5f5d84[constants_1['FLOSUM_NAMESPACE']+_0x2c7dc0(0xfe)]=_0x33feca[_0x2c7dc0(0x11c)],_0x5f5d84[constants_1['FLOSUM_NAMESPACE']+_0x2c7dc0(0x125)]=_0x33feca[_0x2c7dc0(0x116)],_0x5f5d84[constants_1[_0x2c7dc0(0xd6)]+_0x2c7dc0(0xde)]=_0x33feca[_0x2c7dc0(0x10a)],_0x5f5d84[constants_1[_0x2c7dc0(0xd6)]+'MC_Key__c']=_0x33feca[_0x2c7dc0(0xcd)],_0x5f5d84;}[a273_0x168a3f(0x121)](){const _0x8b943e=a273_0x168a3f;return this[_0x8b943e(0xce)];}async['insert'](_0x5a32bf,_0x38eb53){const _0x1f1ba9=a273_0x168a3f,_0x2c10f2=[];for(const _0x2e6708 of _0x5a32bf){const _0x4a6d19=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_COMPONENT'],this['prepareComponentRecord'](_0x2e6708)),_0x2b92bb=(0x0,composite_utils_1[_0x1f1ba9(0x128)])(constants_1[_0x1f1ba9(0xfa)],this[_0x1f1ba9(0xdb)](_0x2e6708,'@{'+_0x4a6d19[_0x1f1ba9(0x113)]+_0x1f1ba9(0xd0))),_0x1e15ce=(0x0,composite_utils_1[_0x1f1ba9(0x128)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x1f1ba9(0xf5)](_0x2e6708,'@{'+_0x2b92bb['reference']+_0x1f1ba9(0xd0)));this['proceedComponentMeta'](_0x4a6d19[_0x1f1ba9(0xc6)][_0x1f1ba9(0x12a)],_0x4a6d19[_0x1f1ba9(0x113)]),_0x2c10f2[_0x1f1ba9(0x11f)](_0x4a6d19[_0x1f1ba9(0xc6)],_0x2b92bb[_0x1f1ba9(0xc6)],_0x1e15ce[_0x1f1ba9(0xc6)]),_0x38eb53&&_0x2c10f2[_0x1f1ba9(0x11f)](this[_0x1f1ba9(0x118)](_0x38eb53,'@{'+_0x2b92bb['reference']+_0x1f1ba9(0xd0)));}return _0x2c10f2;}async[a273_0x168a3f(0xdd)](_0xffdae6,_0x70dae3=''){const _0x3567f1=a273_0x168a3f,_0x2554b2=[];for(const {component:_0x2c64fd,meta:_0x2756cc}of _0xffdae6){if(!_0x2756cc['id']){const _0x17a1bd=this[_0x3567f1(0xce)][_0x3567f1(0x112)](_0xe4c549=>_0xe4c549[_0x3567f1(0x12b)]===_0x2c64fd[_0x3567f1(0xc8)]&&_0xe4c549[_0x3567f1(0xea)]===_0x2c64fd[_0x3567f1(0x129)]);if(!_0x17a1bd)throw new salesforce_error_1['SalesforceError'](new Error('Could\x20not\x20proceed\x20component\x20'+_0x2c64fd[_0x3567f1(0xc8)]+'\x20['+_0x2c64fd[_0x3567f1(0x129)]+_0x3567f1(0x120)));_0x2756cc['id']=_0x17a1bd[_0x3567f1(0xd4)];}const _0x4bb782=(0x0,composite_utils_1[_0x3567f1(0x10e)])(constants_1[_0x3567f1(0x11e)],_0x2756cc['id'],this[_0x3567f1(0xe0)](_0x2c64fd,_0x2756cc)),_0x17c05d=(0x0,composite_utils_1[_0x3567f1(0x128)])(constants_1[_0x3567f1(0xfa)],this[_0x3567f1(0xdb)](_0x2c64fd,_0x2756cc['id'],_0x2756cc['version'])),_0x5265c7=(0x0,composite_utils_1[_0x3567f1(0x128)])(constants_1[_0x3567f1(0x12c)],await this[_0x3567f1(0xf5)](_0x2c64fd,'@{'+_0x17c05d[_0x3567f1(0x113)]+_0x3567f1(0xd0)));this[_0x3567f1(0xe4)](_0x4bb782['request'][_0x3567f1(0x12a)],_0x4bb782[_0x3567f1(0x113)]),_0x2554b2[_0x3567f1(0x11f)](_0x4bb782[_0x3567f1(0xc6)],_0x17c05d[_0x3567f1(0xc6)],_0x5265c7[_0x3567f1(0xc6)]),_0x70dae3&&_0x2554b2['push'](this[_0x3567f1(0x118)](_0x70dae3,'@{'+_0x17c05d[_0x3567f1(0x113)]+_0x3567f1(0xd0)));}return _0x2554b2;}async['delete'](_0x15e9f1,_0x5c4a6c=![]){const _0x42a33c=a273_0x168a3f,_0x449152={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x2a6d23=[];for(const _0x42f097 of _0x15e9f1){if(_0x42f097['id'])_0x2a6d23['push'](_0x42f097['id']);else{const _0x120fd9=this[_0x42a33c(0xce)]['find'](_0x59cc98=>_0x59cc98[_0x42a33c(0x12b)]===_0x42f097[_0x42a33c(0xc8)]&&_0x59cc98['componentType']===_0x42f097[_0x42a33c(0x129)]);if(!_0x120fd9||!_0x120fd9[_0x42a33c(0xd4)])continue;_0x2a6d23[_0x42a33c(0x11f)](_0x120fd9[_0x42a33c(0xd4)]);}}if(_0x5c4a6c){const _0x4909be=await this[_0x42a33c(0xe3)]['fetchCommitManifestsByComponentIds'](_0x2a6d23);_0x449152[_0x42a33c(0xc7)]=_0x4909be['map'](_0x5b3f96=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x5b3f96)[_0x42a33c(0xc6)]);}return _0x449152[_0x42a33c(0xfd)]=_0x2a6d23['map'](_0x354bc5=>(0x0,composite_utils_1[_0x42a33c(0x10e)])(constants_1['FLOSUM_COMPONENT'],_0x354bc5,{[constants_1[_0x42a33c(0x12d)]+_0x42a33c(0x10c)]:!![]})['request']),_0x449152['componentsToDelete']=_0x2a6d23[_0x42a33c(0xe1)](_0x379148=>(0x0,composite_utils_1[_0x42a33c(0xd2)])(constants_1[_0x42a33c(0x11e)],_0x379148)[_0x42a33c(0xc6)]),_0x449152;}}exports[a273_0x168a3f(0x108)]=SalesforceComponentsManager;