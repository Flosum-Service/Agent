const a245_0x39913d=a245_0x2b0c;(function(_0x180e20,_0x496325){const _0x208369=a245_0x2b0c,_0x2f4dcc=_0x180e20();while(!![]){try{const _0x12f459=-parseInt(_0x208369(0x1ec))/0x1*(-parseInt(_0x208369(0x240))/0x2)+parseInt(_0x208369(0x210))/0x3+parseInt(_0x208369(0x229))/0x4+-parseInt(_0x208369(0x205))/0x5+-parseInt(_0x208369(0x231))/0x6+parseInt(_0x208369(0x221))/0x7*(parseInt(_0x208369(0x244))/0x8)+-parseInt(_0x208369(0x23c))/0x9;if(_0x12f459===_0x496325)break;else _0x2f4dcc['push'](_0x2f4dcc['shift']());}catch(_0x49dd53){_0x2f4dcc['push'](_0x2f4dcc['shift']());}}}(a245_0x3244,0x6ca51));function a245_0x3244(){const _0x4f2a53=['2969718gTUEHb','Repository','prepareComponentHistoryRecord','CRC32__c','logger','componentName','insert','request','get','branchId','proceededComponentsMeta','6439941msRbsA','defineProperty','createPatchRequest','Could\x20not\x20proceed\x20component\x20','2guleOA','RecordTypeId','FLOSUM_COMPONENT_HISTORY','Last_Modified_By__c','2710776ytqewJ','../../../../core','Vlocity_Component_Name__c','Last_Updated_By__c','search','find','body','MC_Key__c','Branch__c','push','generateAsync','Changed_By__c','delete','585835Qzgnpe','componentId','Body','vlocityComponentName','createZip','FLOSUM_NAMESPACE','getProceededComponentsMeta','Branch','type','repositoryId','(((.+)+)+)+$','createDeleteRequest','manifests','FLOSUM_GIT_NAMESPACE','Is_From_Agent__c','base64','extractFieldsFromRecord','application/zip','Commit__c','proceedComponentMeta','__importDefault','gitSync','prepareComponentAttachmentRecord','files','componentsToUpdate','1148060HidVBS','prepareCommitManifest','SalesforceComponentsManager','toString','FLOSUM_COMPONENT','componentsToDelete','reference','isVlocityComponent','recordTypes','FLOSUM_COMMIT_MANIFEST','SalesforceError','508455zqnDcI','Component_Type__c','Last_Modified_Date__c','ParentId','Repository__c','.id}','../utils/flosum-naming.utils','toISOString','typedi','componentType','createPostRequest','marketingCloudKey','__esModule','Source__c','username','../utils/composite.utils','SalesforceGitSyncService','14Qpdopg','Version__c','File_Name__c','Zip','map','FLOSUM_ATTACHMENT','Component_Name__c','keys','1808436WPFVYX','prepareComponentRecord','Description','default','fetchCommitManifestsByComponentIds','crc','name','update'];a245_0x3244=function(){return _0x4f2a53;};return a245_0x3244();}const a245_0x49c354=(function(){let _0x4dc581=!![];return function(_0x490984,_0x2e58c5){const _0x3aaa56=_0x4dc581?function(){if(_0x2e58c5){const _0x10b9e1=_0x2e58c5['apply'](_0x490984,arguments);return _0x2e58c5=null,_0x10b9e1;}}:function(){};return _0x4dc581=![],_0x3aaa56;};}()),a245_0x3beee2=a245_0x49c354(this,function(){const _0x51049e=a245_0x2b0c;return a245_0x3beee2[_0x51049e(0x208)]()[_0x51049e(0x1e3)]('(((.+)+)+)+$')[_0x51049e(0x208)]()['constructor'](a245_0x3beee2)[_0x51049e(0x1e3)](_0x51049e(0x1f6));});a245_0x3beee2();'use strict';var __importDefault=this&&this[a245_0x39913d(0x200)]||function(_0x962b0e){return _0x962b0e&&_0x962b0e['__esModule']?_0x962b0e:{'default':_0x962b0e};};function a245_0x2b0c(_0x7d5fa3,_0x47dd4a){const _0x28ad4f=a245_0x3244();return a245_0x2b0c=function(_0x3beee2,_0x49c354){_0x3beee2=_0x3beee2-0x1e3;let _0x3244b0=_0x28ad4f[_0x3beee2];return _0x3244b0;},a245_0x2b0c(_0x7d5fa3,_0x47dd4a);}Object[a245_0x39913d(0x23d)](exports,a245_0x39913d(0x21c),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require('../../../../constants'),core_1=require(a245_0x39913d(0x245)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a245_0x39913d(0x218))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a245_0x39913d(0x21f)),flosum_naming_utils_1=require(a245_0x39913d(0x216)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0xb1c6e9,_0x23cff4,_0x28188c,_0x595cb6,_0x21725e){const _0x50c3c4=a245_0x39913d;this[_0x50c3c4(0x1f5)]=_0xb1c6e9,this[_0x50c3c4(0x23a)]=_0x23cff4,this[_0x50c3c4(0x21e)]=_0x28188c,this[_0x50c3c4(0x20d)]=_0x595cb6,this[_0x50c3c4(0x23b)]=_0x21725e,this[_0x50c3c4(0x235)]=new core_1['Logger'](SalesforceComponentsManager[_0x50c3c4(0x22f)]),this[_0x50c3c4(0x201)]=typedi_1[_0x50c3c4(0x22c)][_0x50c3c4(0x239)](salesforce_git_sync_service_1[_0x50c3c4(0x220)]);}[a245_0x39913d(0x1ff)](_0x13355f,_0x8ec8e1){const _0x31bda6=a245_0x39913d,_0x594921=(0x0,flosum_naming_utils_1[_0x31bda6(0x1fc)])(_0x13355f,[_0x31bda6(0x211),_0x31bda6(0x227),_0x31bda6(0x222)]);this[_0x31bda6(0x23b)][_0x31bda6(0x1e8)]({'componentId':'','reference':_0x8ec8e1,'version':_0x594921[_0x31bda6(0x222)],'componentName':_0x594921[_0x31bda6(0x227)],'componentType':_0x594921[_0x31bda6(0x211)]});}[a245_0x39913d(0x206)](_0x6ba5dd,_0x32a63e){const _0x54f76e=a245_0x39913d,{request:_0x34be33}=(0x0,composite_utils_1[_0x54f76e(0x21a)])(constants_1[_0x54f76e(0x20e)],{[constants_1[_0x54f76e(0x1f1)]+_0x54f76e(0x1fe)]:_0x6ba5dd,[constants_1['FLOSUM_NAMESPACE']+'Component_History__c']:_0x32a63e});return _0x34be33;}async[a245_0x39913d(0x202)](_0xbc6cab,_0x59dd7a){const _0x574b3c=a245_0x39913d,_0x564306={},_0x40baaf=zip_1[_0x574b3c(0x224)][_0x574b3c(0x1f0)]();for(const _0x83798d of Object[_0x574b3c(0x228)](_0xbc6cab[_0x574b3c(0x203)])){_0x40baaf['file'](_0x83798d,_0xbc6cab['files'][_0x83798d],{'createFolders':!![]});}return _0x564306['ContentType']=_0x574b3c(0x1fd),_0x564306['Name']=_0xbc6cab[_0x574b3c(0x1f4)],_0x564306[_0x574b3c(0x22b)]=_0xbc6cab[_0x574b3c(0x1f4)],_0x564306[_0x574b3c(0x213)]=_0x59dd7a,_0x564306[_0x574b3c(0x1ee)]=await _0x40baaf[_0x574b3c(0x1e9)]({'type':_0x574b3c(0x1fb),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x564306;}[a245_0x39913d(0x233)](_0x47519b,_0x601d0c,_0x27e242){const _0x54171a=a245_0x39913d,_0x1a4104=new Date()[_0x54171a(0x217)](),_0x90f527={};return _0x90f527[constants_1[_0x54171a(0x1f1)]+'Component__c']=_0x601d0c,_0x90f527[constants_1[_0x54171a(0x1f1)]+'CRC32__c']=_0x47519b[_0x54171a(0x22e)],_0x90f527[constants_1[_0x54171a(0x1f1)]+'Changed_On__c']=_0x1a4104,_0x90f527[constants_1[_0x54171a(0x1f1)]+_0x54171a(0x1ea)]=this[_0x54171a(0x21e)],_0x90f527[constants_1['FLOSUM_NAMESPACE']+_0x54171a(0x222)]=_0x27e242?_0x27e242+0x1:0x1,_0x90f527[constants_1[_0x54171a(0x1f9)]+_0x54171a(0x1fa)]=!![],_0x90f527;}['prepareComponentRecord'](_0x279d70,_0x4df711){const _0xe92a5d=a245_0x39913d;var _0x30f24e,_0x6dc773;const _0x1082b5=new Date()['toISOString'](),_0x6a5fe7={};return!_0x4df711?(this[_0xe92a5d(0x23a)]?(_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x1e7)]=this['branchId'],_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x21d)]=_0xe92a5d(0x1f3),_0x6a5fe7['RecordTypeId']=(_0x30f24e=this[_0xe92a5d(0x20d)][_0xe92a5d(0x1e4)](_0x4ccc98=>_0x4ccc98[_0xe92a5d(0x22f)]===_0xe92a5d(0x1f3)))===null||_0x30f24e===void 0x0?void 0x0:_0x30f24e['id']):(_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x214)]=this['repositoryId'],_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x21d)]=_0xe92a5d(0x232),_0x6a5fe7[_0xe92a5d(0x241)]=(_0x6dc773=this[_0xe92a5d(0x20d)][_0xe92a5d(0x1e4)](_0x4a5f34=>_0x4a5f34[_0xe92a5d(0x22f)]===_0xe92a5d(0x232)))===null||_0x6dc773===void 0x0?void 0x0:_0x6dc773['id']),_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+'Version__c']=0x1):_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x222)]=_0x4df711['version']+0x1,_0x6a5fe7[constants_1['FLOSUM_NAMESPACE']+_0xe92a5d(0x211)]=_0x279d70['type'],_0x6a5fe7[constants_1['FLOSUM_NAMESPACE']+_0xe92a5d(0x227)]=_0x279d70['name'],_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x223)]=_0x279d70['filePath'],_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x247)]=this['username'],_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x243)]=this[_0xe92a5d(0x21e)],_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x212)]=_0x1082b5,_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+'Committed_On__c']=_0x1082b5,_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x234)]=_0x279d70[_0xe92a5d(0x22e)],_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x246)]=_0x279d70[_0xe92a5d(0x1ef)],_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+'Vlocity_Component__c']=_0x279d70[_0xe92a5d(0x20c)],_0x6a5fe7[constants_1[_0xe92a5d(0x1f1)]+_0xe92a5d(0x1e6)]=_0x279d70[_0xe92a5d(0x21b)],_0x6a5fe7;}[a245_0x39913d(0x1f2)](){const _0x4b5f5e=a245_0x39913d;return this[_0x4b5f5e(0x23b)];}async[a245_0x39913d(0x237)](_0x114ef7,_0x233057){const _0x2cc759=a245_0x39913d,_0x473cba=[];for(const _0x780d37 of _0x114ef7){const _0x5e5c74=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x2cc759(0x209)],this[_0x2cc759(0x22a)](_0x780d37)),_0x54a3da=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x2cc759(0x242)],this[_0x2cc759(0x233)](_0x780d37,'@{'+_0x5e5c74[_0x2cc759(0x20b)]+_0x2cc759(0x215))),_0x22522d=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x2cc759(0x226)],await this[_0x2cc759(0x202)](_0x780d37,'@{'+_0x54a3da[_0x2cc759(0x20b)]+_0x2cc759(0x215)));this[_0x2cc759(0x1ff)](_0x5e5c74['request'][_0x2cc759(0x1e5)],_0x5e5c74['reference']),_0x473cba[_0x2cc759(0x1e8)](_0x5e5c74['request'],_0x54a3da['request'],_0x22522d['request']),_0x233057&&_0x473cba[_0x2cc759(0x1e8)](this['prepareCommitManifest'](_0x233057,'@{'+_0x54a3da['reference']+_0x2cc759(0x215)));}return _0x473cba;}async[a245_0x39913d(0x230)](_0xf0d4c9,_0x4fcd4d=''){const _0x2d26b0=a245_0x39913d,_0x16975f=[];for(const {component:_0x2d2fde,meta:_0x39f555}of _0xf0d4c9){if(!_0x39f555['id']){const _0x49f993=this[_0x2d26b0(0x23b)]['find'](_0x2ba178=>_0x2ba178[_0x2d26b0(0x236)]===_0x2d2fde[_0x2d26b0(0x22f)]&&_0x2ba178['componentType']===_0x2d2fde['type']);if(!_0x49f993)throw new salesforce_error_1[(_0x2d26b0(0x20f))](new Error(_0x2d26b0(0x23f)+_0x2d2fde[_0x2d26b0(0x22f)]+'\x20['+_0x2d2fde[_0x2d26b0(0x1f4)]+']\x20-\x20meta\x20not\x20found'));_0x39f555['id']=_0x49f993['componentId'];}const _0x52a8fb=(0x0,composite_utils_1[_0x2d26b0(0x23e)])(constants_1[_0x2d26b0(0x209)],_0x39f555['id'],this[_0x2d26b0(0x22a)](_0x2d2fde,_0x39f555)),_0x331cb1=(0x0,composite_utils_1[_0x2d26b0(0x21a)])(constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x2d26b0(0x233)](_0x2d2fde,_0x39f555['id'],_0x39f555['version'])),_0x573f5a=(0x0,composite_utils_1['createPostRequest'])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x2d26b0(0x202)](_0x2d2fde,'@{'+_0x331cb1[_0x2d26b0(0x20b)]+'.id}'));this[_0x2d26b0(0x1ff)](_0x52a8fb[_0x2d26b0(0x238)][_0x2d26b0(0x1e5)],_0x52a8fb[_0x2d26b0(0x20b)]),_0x16975f['push'](_0x52a8fb[_0x2d26b0(0x238)],_0x331cb1[_0x2d26b0(0x238)],_0x573f5a['request']),_0x4fcd4d&&_0x16975f[_0x2d26b0(0x1e8)](this[_0x2d26b0(0x206)](_0x4fcd4d,'@{'+_0x331cb1[_0x2d26b0(0x20b)]+_0x2d26b0(0x215)));}return _0x16975f;}async[a245_0x39913d(0x1eb)](_0x5a7968,_0x200a65=![]){const _0x17067a=a245_0x39913d,_0x235528={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x23c711=[];for(const _0x5521cf of _0x5a7968){if(_0x5521cf['id'])_0x23c711[_0x17067a(0x1e8)](_0x5521cf['id']);else{const _0x54fea2=this[_0x17067a(0x23b)][_0x17067a(0x1e4)](_0x619fc1=>_0x619fc1[_0x17067a(0x236)]===_0x5521cf[_0x17067a(0x22f)]&&_0x619fc1[_0x17067a(0x219)]===_0x5521cf[_0x17067a(0x1f4)]);if(!_0x54fea2||!_0x54fea2[_0x17067a(0x1ed)])continue;_0x23c711[_0x17067a(0x1e8)](_0x54fea2[_0x17067a(0x1ed)]);}}if(_0x200a65){const _0x2d0bff=await this[_0x17067a(0x201)][_0x17067a(0x22d)](_0x23c711);_0x235528[_0x17067a(0x1f8)]=_0x2d0bff[_0x17067a(0x225)](_0x439c98=>(0x0,composite_utils_1['createDeleteRequest'])(constants_1[_0x17067a(0x20e)],_0x439c98)[_0x17067a(0x238)]);}return _0x235528[_0x17067a(0x204)]=_0x23c711[_0x17067a(0x225)](_0xa03bf7=>(0x0,composite_utils_1[_0x17067a(0x23e)])(constants_1['FLOSUM_COMPONENT'],_0xa03bf7,{[constants_1[_0x17067a(0x1f9)]+'Deletion_By_Agent__c']:!![]})[_0x17067a(0x238)]),_0x235528[_0x17067a(0x20a)]=_0x23c711[_0x17067a(0x225)](_0x3ff901=>(0x0,composite_utils_1[_0x17067a(0x1f7)])(constants_1['FLOSUM_COMPONENT'],_0x3ff901)[_0x17067a(0x238)]),_0x235528;}}exports[a245_0x39913d(0x207)]=SalesforceComponentsManager;