const a195_0x5b4868=a195_0x32b0;(function(_0x2a6721,_0x570bf3){const _0x385194=a195_0x32b0,_0x8d4688=_0x2a6721();while(!![]){try{const _0x10ed21=parseInt(_0x385194(0x11c))/0x1+parseInt(_0x385194(0x164))/0x2+-parseInt(_0x385194(0x143))/0x3*(-parseInt(_0x385194(0x138))/0x4)+parseInt(_0x385194(0x120))/0x5*(parseInt(_0x385194(0x12c))/0x6)+-parseInt(_0x385194(0x172))/0x7+parseInt(_0x385194(0x151))/0x8*(-parseInt(_0x385194(0x141))/0x9)+-parseInt(_0x385194(0x14a))/0xa;if(_0x10ed21===_0x570bf3)break;else _0x8d4688['push'](_0x8d4688['shift']());}catch(_0x1a8bcc){_0x8d4688['push'](_0x8d4688['shift']());}}}(a195_0x44e0,0xb9ddf));const a195_0x5a5c00=(function(){let _0x8d0d80=!![];return function(_0x3250a6,_0x411d9e){const _0x28a467=_0x8d0d80?function(){if(_0x411d9e){const _0x22fea0=_0x411d9e['apply'](_0x3250a6,arguments);return _0x411d9e=null,_0x22fea0;}}:function(){};return _0x8d0d80=![],_0x28a467;};}()),a195_0x38c498=a195_0x5a5c00(this,function(){const _0x4e1ee5=a195_0x32b0;return a195_0x38c498[_0x4e1ee5(0x13e)]()[_0x4e1ee5(0x122)]('(((.+)+)+)+$')[_0x4e1ee5(0x13e)]()[_0x4e1ee5(0x12b)](a195_0x38c498)[_0x4e1ee5(0x122)](_0x4e1ee5(0x127));});a195_0x38c498();'use strict';var __importDefault=this&&this[a195_0x5b4868(0x12e)]||function(_0x1ba6f2){const _0x2783cf=a195_0x5b4868;return _0x1ba6f2&&_0x1ba6f2[_0x2783cf(0x12f)]?_0x1ba6f2:{'default':_0x1ba6f2};};function a195_0x44e0(){const _0x3f0c22=['filePath','../../parsers/utils/zip','manifests','Repository','33708620ViBEjR','typedi','Source__c','fetchCommitManifestsByComponentIds','Logger','../errors/salesforce.error','Version__c','501544RxiDXf','proceededComponentsMeta','CRC32__c','prepareComponentRecord','name','Description','SalesforceGitSyncService','map','push','./salesforce-git-sync.service','../../../../constants','Is_From_Agent__c','Commit__c','application/zip','get','Zip','prepareCommitManifest','insert','Branch','2733602VkovHj','file','createPatchRequest','gitSync','componentId','defineProperty','FLOSUM_NAMESPACE','proceedComponentMeta','createZip','default','../utils/composite.utils','Last_Modified_Date__c','prepareComponentHistoryRecord','base64','4862865WEoklz','Component_History__c','find','Component_Name__c','request','Deletion_By_Agent__c','SalesforceComponentsManager','createPostRequest','createDeleteRequest','componentsToDelete','RecordTypeId','componentName','.id}','Component__c','version','884121PxeFua','FLOSUM_COMPONENT','FLOSUM_COMPONENT_HISTORY','toISOString','5ZHgYkc','prepareComponentAttachmentRecord','search','ContentType','recordTypes','componentsToUpdate','username','(((.+)+)+)+$','reference','componentType','Last_Modified_By__c','constructor','8692302DbIMQH','Last_Updated_By__c','__importDefault','__esModule','branchId',']\x20-\x20meta\x20not\x20found','body','update','Name','files','FLOSUM_COMMIT_MANIFEST','repositoryId','2881388YKPbQX','type','keys','Branch__c','FLOSUM_ATTACHMENT','Could\x20not\x20proceed\x20component\x20','toString','Committed_On__c','File_Name__c','45AMzvPl','Component_Type__c','6bayPds','ParentId','FLOSUM_GIT_NAMESPACE'];a195_0x44e0=function(){return _0x3f0c22;};return a195_0x44e0();}Object[a195_0x5b4868(0x169)](exports,a195_0x5b4868(0x12f),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a195_0x5b4868(0x15b)),core_1=require('../../../../core'),zip_1=require(a195_0x5b4868(0x147)),typedi_1=__importDefault(require(a195_0x5b4868(0x14b))),salesforce_error_1=require(a195_0x5b4868(0x14f)),composite_utils_1=require(a195_0x5b4868(0x16e)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a195_0x5b4868(0x15a));class SalesforceComponentsManager{constructor(_0x2f71b7,_0x102bc4,_0x2adf36,_0x58c668,_0x88642c){const _0xa17033=a195_0x5b4868;this['repositoryId']=_0x2f71b7,this['branchId']=_0x102bc4,this[_0xa17033(0x126)]=_0x2adf36,this[_0xa17033(0x124)]=_0x58c668,this[_0xa17033(0x152)]=_0x88642c,this['logger']=new core_1[(_0xa17033(0x14e))](SalesforceComponentsManager['name']),this[_0xa17033(0x167)]=typedi_1[_0xa17033(0x16d)][_0xa17033(0x15f)](salesforce_git_sync_service_1[_0xa17033(0x157)]);}[a195_0x5b4868(0x16b)](_0x714960,_0x281941){const _0x5c0bf=a195_0x5b4868,_0x5c1aaf=(0x0,flosum_naming_utils_1['extractFieldsFromRecord'])(_0x714960,['Component_Type__c',_0x5c0bf(0x175),_0x5c0bf(0x150)]);this[_0x5c0bf(0x152)][_0x5c0bf(0x159)]({'componentId':'','reference':_0x281941,'version':_0x5c1aaf[_0x5c0bf(0x150)],'componentName':_0x5c1aaf[_0x5c0bf(0x175)],'componentType':_0x5c1aaf['Component_Type__c']});}[a195_0x5b4868(0x161)](_0x2ed45c,_0x565eb4){const _0x2dcc9f=a195_0x5b4868,{request:_0x363e35}=(0x0,composite_utils_1[_0x2dcc9f(0x179)])(constants_1[_0x2dcc9f(0x136)],{[constants_1[_0x2dcc9f(0x16a)]+_0x2dcc9f(0x15d)]:_0x2ed45c,[constants_1['FLOSUM_NAMESPACE']+_0x2dcc9f(0x173)]:_0x565eb4});return _0x363e35;}async[a195_0x5b4868(0x121)](_0x1873d3,_0x56711b){const _0x4df2b0=a195_0x5b4868,_0x1c9800={},_0x3d33dc=zip_1[_0x4df2b0(0x160)][_0x4df2b0(0x16c)]();for(const _0x9413e5 of Object[_0x4df2b0(0x13a)](_0x1873d3[_0x4df2b0(0x135)])){_0x3d33dc[_0x4df2b0(0x165)](_0x9413e5,_0x1873d3['files'][_0x9413e5],{'createFolders':!![]});}return _0x1c9800[_0x4df2b0(0x123)]=_0x4df2b0(0x15e),_0x1c9800[_0x4df2b0(0x134)]=_0x1873d3[_0x4df2b0(0x139)],_0x1c9800[_0x4df2b0(0x156)]=_0x1873d3['type'],_0x1c9800[_0x4df2b0(0x144)]=_0x56711b,_0x1c9800['Body']=await _0x3d33dc['generateAsync']({'type':_0x4df2b0(0x171),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x1c9800;}['prepareComponentHistoryRecord'](_0x395ef8,_0xb99e5e,_0x47dfb0){const _0x1aaac7=a195_0x5b4868,_0xa30989=new Date()[_0x1aaac7(0x11f)](),_0x32d70b={};return _0x32d70b[constants_1['FLOSUM_NAMESPACE']+_0x1aaac7(0x11a)]=_0xb99e5e,_0x32d70b[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x395ef8['crc'],_0x32d70b[constants_1['FLOSUM_NAMESPACE']+'Changed_On__c']=_0xa30989,_0x32d70b[constants_1[_0x1aaac7(0x16a)]+'Changed_By__c']=this[_0x1aaac7(0x126)],_0x32d70b[constants_1[_0x1aaac7(0x16a)]+_0x1aaac7(0x150)]=_0x47dfb0?_0x47dfb0+0x1:0x1,_0x32d70b[constants_1[_0x1aaac7(0x145)]+_0x1aaac7(0x15c)]=!![],_0x32d70b;}[a195_0x5b4868(0x154)](_0x48b81e,_0xd75db0){const _0x1de3ec=a195_0x5b4868;var _0x4bc796,_0x882cc;const _0x454a54=new Date()['toISOString'](),_0x390eaa={};return!_0xd75db0?(this[_0x1de3ec(0x130)]?(_0x390eaa[constants_1['FLOSUM_NAMESPACE']+_0x1de3ec(0x13b)]=this[_0x1de3ec(0x130)],_0x390eaa[constants_1[_0x1de3ec(0x16a)]+_0x1de3ec(0x14c)]=_0x1de3ec(0x163),_0x390eaa[_0x1de3ec(0x17c)]=(_0x4bc796=this[_0x1de3ec(0x124)]['find'](_0x1ad5f3=>_0x1ad5f3[_0x1de3ec(0x155)]===_0x1de3ec(0x163)))===null||_0x4bc796===void 0x0?void 0x0:_0x4bc796['id']):(_0x390eaa[constants_1[_0x1de3ec(0x16a)]+'Repository__c']=this[_0x1de3ec(0x137)],_0x390eaa[constants_1[_0x1de3ec(0x16a)]+'Source__c']=_0x1de3ec(0x149),_0x390eaa[_0x1de3ec(0x17c)]=(_0x882cc=this[_0x1de3ec(0x124)][_0x1de3ec(0x174)](_0x39d3e0=>_0x39d3e0[_0x1de3ec(0x155)]==='Repository'))===null||_0x882cc===void 0x0?void 0x0:_0x882cc['id']),_0x390eaa[constants_1[_0x1de3ec(0x16a)]+'Version__c']=0x1):_0x390eaa[constants_1[_0x1de3ec(0x16a)]+_0x1de3ec(0x150)]=_0xd75db0[_0x1de3ec(0x11b)]+0x1,_0x390eaa[constants_1[_0x1de3ec(0x16a)]+_0x1de3ec(0x142)]=_0x48b81e[_0x1de3ec(0x139)],_0x390eaa[constants_1[_0x1de3ec(0x16a)]+_0x1de3ec(0x175)]=_0x48b81e['name'],_0x390eaa[constants_1[_0x1de3ec(0x16a)]+_0x1de3ec(0x140)]=_0x48b81e[_0x1de3ec(0x146)],_0x390eaa[constants_1[_0x1de3ec(0x16a)]+_0x1de3ec(0x12d)]=this[_0x1de3ec(0x126)],_0x390eaa[constants_1[_0x1de3ec(0x16a)]+_0x1de3ec(0x12a)]=this[_0x1de3ec(0x126)],_0x390eaa[constants_1['FLOSUM_NAMESPACE']+_0x1de3ec(0x16f)]=_0x454a54,_0x390eaa[constants_1[_0x1de3ec(0x16a)]+_0x1de3ec(0x13f)]=_0x454a54,_0x390eaa[constants_1['FLOSUM_NAMESPACE']+_0x1de3ec(0x153)]=_0x48b81e['crc'],_0x390eaa;}['getProceededComponentsMeta'](){return this['proceededComponentsMeta'];}async[a195_0x5b4868(0x162)](_0x2867f2,_0x4afcb6){const _0x5c28bc=a195_0x5b4868,_0x326598=[];for(const _0x4629d3 of _0x2867f2){const _0x407d6e=(0x0,composite_utils_1[_0x5c28bc(0x179)])(constants_1[_0x5c28bc(0x11d)],this['prepareComponentRecord'](_0x4629d3)),_0x4ee7d3=(0x0,composite_utils_1[_0x5c28bc(0x179)])(constants_1[_0x5c28bc(0x11e)],this['prepareComponentHistoryRecord'](_0x4629d3,'@{'+_0x407d6e[_0x5c28bc(0x128)]+'.id}')),_0x5ba73a=(0x0,composite_utils_1[_0x5c28bc(0x179)])(constants_1[_0x5c28bc(0x13c)],await this[_0x5c28bc(0x121)](_0x4629d3,'@{'+_0x4ee7d3[_0x5c28bc(0x128)]+'.id}'));this['proceedComponentMeta'](_0x407d6e[_0x5c28bc(0x176)][_0x5c28bc(0x132)],_0x407d6e[_0x5c28bc(0x128)]),_0x326598['push'](_0x407d6e[_0x5c28bc(0x176)],_0x4ee7d3[_0x5c28bc(0x176)],_0x5ba73a['request']),_0x4afcb6&&_0x326598[_0x5c28bc(0x159)](this[_0x5c28bc(0x161)](_0x4afcb6,'@{'+_0x4ee7d3[_0x5c28bc(0x128)]+_0x5c28bc(0x119)));}return _0x326598;}async[a195_0x5b4868(0x133)](_0x5733ac,_0x7dd8c8=''){const _0x39b01d=a195_0x5b4868,_0x35eb7e=[];for(const {component:_0x441bba,meta:_0x18a7a9}of _0x5733ac){if(!_0x18a7a9['id']){const _0x4313e8=this[_0x39b01d(0x152)][_0x39b01d(0x174)](_0x2a761b=>_0x2a761b['componentName']===_0x441bba[_0x39b01d(0x155)]&&_0x2a761b[_0x39b01d(0x129)]===_0x441bba['type']);if(!_0x4313e8)throw new salesforce_error_1['SalesforceError'](new Error(_0x39b01d(0x13d)+_0x441bba[_0x39b01d(0x155)]+'\x20['+_0x441bba[_0x39b01d(0x139)]+_0x39b01d(0x131)));_0x18a7a9['id']=_0x4313e8[_0x39b01d(0x168)];}const _0x4d36c1=(0x0,composite_utils_1[_0x39b01d(0x166)])(constants_1[_0x39b01d(0x11d)],_0x18a7a9['id'],this[_0x39b01d(0x154)](_0x441bba,_0x18a7a9)),_0x16771c=(0x0,composite_utils_1[_0x39b01d(0x179)])(constants_1[_0x39b01d(0x11e)],this[_0x39b01d(0x170)](_0x441bba,_0x18a7a9['id'],_0x18a7a9[_0x39b01d(0x11b)])),_0x375653=(0x0,composite_utils_1[_0x39b01d(0x179)])(constants_1[_0x39b01d(0x13c)],await this['prepareComponentAttachmentRecord'](_0x441bba,'@{'+_0x16771c['reference']+'.id}'));this[_0x39b01d(0x16b)](_0x4d36c1[_0x39b01d(0x176)][_0x39b01d(0x132)],_0x4d36c1[_0x39b01d(0x128)]),_0x35eb7e[_0x39b01d(0x159)](_0x4d36c1[_0x39b01d(0x176)],_0x16771c[_0x39b01d(0x176)],_0x375653[_0x39b01d(0x176)]),_0x7dd8c8&&_0x35eb7e[_0x39b01d(0x159)](this[_0x39b01d(0x161)](_0x7dd8c8,'@{'+_0x16771c[_0x39b01d(0x128)]+_0x39b01d(0x119)));}return _0x35eb7e;}async['delete'](_0x1fee0c,_0x2b6f88=![]){const _0x4ba36a=a195_0x5b4868,_0x231872={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0xbefe78=[];for(const _0x4bed10 of _0x1fee0c){if(_0x4bed10['id'])_0xbefe78['push'](_0x4bed10['id']);else{const _0xa58aad=this[_0x4ba36a(0x152)]['find'](_0x5c2ffb=>_0x5c2ffb[_0x4ba36a(0x17d)]===_0x4bed10[_0x4ba36a(0x155)]&&_0x5c2ffb[_0x4ba36a(0x129)]===_0x4bed10[_0x4ba36a(0x139)]);if(!_0xa58aad||!_0xa58aad['componentId'])continue;_0xbefe78[_0x4ba36a(0x159)](_0xa58aad[_0x4ba36a(0x168)]);}}if(_0x2b6f88){const _0x5608f2=await this[_0x4ba36a(0x167)][_0x4ba36a(0x14d)](_0xbefe78);_0x231872[_0x4ba36a(0x148)]=_0x5608f2[_0x4ba36a(0x158)](_0x46c651=>(0x0,composite_utils_1[_0x4ba36a(0x17a)])(constants_1[_0x4ba36a(0x136)],_0x46c651)[_0x4ba36a(0x176)]);}return _0x231872[_0x4ba36a(0x125)]=_0xbefe78[_0x4ba36a(0x158)](_0x5d172f=>(0x0,composite_utils_1[_0x4ba36a(0x166)])(constants_1[_0x4ba36a(0x11d)],_0x5d172f,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x4ba36a(0x177)]:!![]})[_0x4ba36a(0x176)]),_0x231872[_0x4ba36a(0x17b)]=_0xbefe78[_0x4ba36a(0x158)](_0x2b1ae0=>(0x0,composite_utils_1[_0x4ba36a(0x17a)])(constants_1[_0x4ba36a(0x11d)],_0x2b1ae0)[_0x4ba36a(0x176)]),_0x231872;}}function a195_0x32b0(_0x4008bf,_0x46f8a6){const _0x286727=a195_0x44e0();return a195_0x32b0=function(_0x38c498,_0x5a5c00){_0x38c498=_0x38c498-0x119;let _0x44e02a=_0x286727[_0x38c498];return _0x44e02a;},a195_0x32b0(_0x4008bf,_0x46f8a6);}exports[a195_0x5b4868(0x178)]=SalesforceComponentsManager;