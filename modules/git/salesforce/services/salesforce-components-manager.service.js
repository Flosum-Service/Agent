const a177_0x5f01a3=a177_0x143e;(function(_0x1017e9,_0x18f309){const _0xae0c46=a177_0x143e,_0x5c70a0=_0x1017e9();while(!![]){try{const _0x22503f=parseInt(_0xae0c46(0x228))/0x1*(parseInt(_0xae0c46(0x21e))/0x2)+-parseInt(_0xae0c46(0x244))/0x3+-parseInt(_0xae0c46(0x22a))/0x4*(parseInt(_0xae0c46(0x200))/0x5)+-parseInt(_0xae0c46(0x212))/0x6+parseInt(_0xae0c46(0x1f5))/0x7*(-parseInt(_0xae0c46(0x1f4))/0x8)+-parseInt(_0xae0c46(0x205))/0x9*(-parseInt(_0xae0c46(0x237))/0xa)+parseInt(_0xae0c46(0x1f3))/0xb;if(_0x22503f===_0x18f309)break;else _0x5c70a0['push'](_0x5c70a0['shift']());}catch(_0x4af2ad){_0x5c70a0['push'](_0x5c70a0['shift']());}}}(a177_0x2f2b,0x25484));const a177_0x1f34ab=(function(){let _0x707a74=!![];return function(_0x1dbbc3,_0x8af9de){const _0x219a00=_0x707a74?function(){const _0x103a19=a177_0x143e;if(_0x8af9de){const _0x4fed77=_0x8af9de[_0x103a19(0x1ff)](_0x1dbbc3,arguments);return _0x8af9de=null,_0x4fed77;}}:function(){};return _0x707a74=![],_0x219a00;};}()),a177_0x35674f=a177_0x1f34ab(this,function(){const _0x264332=a177_0x143e;return a177_0x35674f[_0x264332(0x246)]()['search']('(((.+)+)+)+$')[_0x264332(0x246)]()['constructor'](a177_0x35674f)[_0x264332(0x1f9)](_0x264332(0x22e));});a177_0x35674f();function a177_0x143e(_0x173499,_0x40939){const _0x420558=a177_0x2f2b();return a177_0x143e=function(_0x35674f,_0x1f34ab){_0x35674f=_0x35674f-0x1ed;let _0x2f2b44=_0x420558[_0x35674f];return _0x2f2b44;},a177_0x143e(_0x173499,_0x40939);}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5b4311){const _0x5a8c61=a177_0x143e;return _0x5b4311&&_0x5b4311[_0x5a8c61(0x21b)]?_0x5b4311:{'default':_0x5b4311};};Object[a177_0x5f01a3(0x238)](exports,a177_0x5f01a3(0x21b),{'value':!![]}),exports[a177_0x5f01a3(0x235)]=void 0x0;const constants_1=require(a177_0x5f01a3(0x229)),core_1=require(a177_0x5f01a3(0x241)),zip_1=require(a177_0x5f01a3(0x23b)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a177_0x5f01a3(0x219)),composite_utils_1=require(a177_0x5f01a3(0x217)),flosum_naming_utils_1=require(a177_0x5f01a3(0x203)),salesforce_git_sync_service_1=require(a177_0x5f01a3(0x20d));function a177_0x2f2b(){const _0x34bd1b=['5aUdXAE','files','Commit__c','../utils/flosum-naming.utils','gitSync','1269zmCOIw','update','Last_Modified_Date__c','username','body','proceededComponentsMeta','FLOSUM_COMPONENT_HISTORY','prepareComponentHistoryRecord','./salesforce-git-sync.service','delete','RecordTypeId','recordTypes','request','355056cmpKgV','ParentId','File_Name__c','logger',']\x20-\x20meta\x20not\x20found','../utils/composite.utils','componentType','../errors/salesforce.error','Repository','__esModule','FLOSUM_COMMIT_MANIFEST','proceedComponentMeta','21706FTkPGq','FLOSUM_ATTACHMENT','base64','toISOString','createPostRequest','reference','insert','find','crc','get','18pFLzpb','../../../../constants','846436STfbAN','filePath','Description','createPatchRequest','(((.+)+)+)+$','Component_Name__c','FLOSUM_GIT_NAMESPACE','Version__c','FLOSUM_COMPONENT','repositoryId','Component_Type__c','SalesforceComponentsManager','push','8660thLGMR','defineProperty','prepareComponentAttachmentRecord','prepareComponentRecord','../../parsers/utils/zip','Source__c','Branch','Component_History__c','FLOSUM_NAMESPACE','CRC32__c','../../../../core','map','.id}','789333vWJrKY','default','toString','application/zip','generateAsync','Repository__c','Changed_On__c','name','Body','prepareCommitManifest','version','SalesforceError','keys','componentName','getProceededComponentsMeta','SalesforceGitSyncService','componentId','6954134Vuoeah','42088VMGMxJ','350AXylaF','Last_Modified_By__c','Is_From_Agent__c','Last_Updated_By__c','search','type','branchId','manifests','Committed_On__c','componentsToUpdate','apply'];a177_0x2f2b=function(){return _0x34bd1b;};return a177_0x2f2b();}class SalesforceComponentsManager{constructor(_0x27a719,_0x44edff,_0xb8d8e3,_0x32cefb,_0x17687c){const _0x2b1a4f=a177_0x5f01a3;this[_0x2b1a4f(0x233)]=_0x27a719,this[_0x2b1a4f(0x1fb)]=_0x44edff,this[_0x2b1a4f(0x208)]=_0xb8d8e3,this['recordTypes']=_0x32cefb,this[_0x2b1a4f(0x20a)]=_0x17687c,this[_0x2b1a4f(0x215)]=new core_1['Logger'](SalesforceComponentsManager[_0x2b1a4f(0x24b)]),this[_0x2b1a4f(0x204)]=typedi_1[_0x2b1a4f(0x245)][_0x2b1a4f(0x227)](salesforce_git_sync_service_1[_0x2b1a4f(0x1f1)]);}['proceedComponentMeta'](_0x4a4105,_0x45ca65){const _0x230ce7=a177_0x5f01a3,_0x27a2fb=flosum_naming_utils_1['extractFieldsFromRecord'](_0x4a4105,[_0x230ce7(0x234),_0x230ce7(0x22f),'Version__c']);this[_0x230ce7(0x20a)][_0x230ce7(0x236)]({'componentId':'','reference':_0x45ca65,'version':_0x27a2fb['Version__c'],'componentName':_0x27a2fb[_0x230ce7(0x22f)],'componentType':_0x27a2fb[_0x230ce7(0x234)]});}[a177_0x5f01a3(0x24d)](_0x3dd842,_0x372d4b){const _0x27ba98=a177_0x5f01a3,{request:_0x5eb6ff}=composite_utils_1['createPostRequest'](constants_1[_0x27ba98(0x21c)],{[constants_1['FLOSUM_NAMESPACE']+_0x27ba98(0x202)]:_0x3dd842,[constants_1[_0x27ba98(0x23f)]+_0x27ba98(0x23e)]:_0x372d4b});return _0x5eb6ff;}async[a177_0x5f01a3(0x239)](_0x24d612,_0x11e370){const _0x3f96b6=a177_0x5f01a3,_0x77eef0={},_0x4c83bf=zip_1['Zip']['createZip']();for(const _0x2e2892 of Object[_0x3f96b6(0x1ee)](_0x24d612[_0x3f96b6(0x201)])){_0x4c83bf['file'](_0x2e2892,_0x24d612[_0x3f96b6(0x201)][_0x2e2892],{'createFolders':!![]});}return _0x77eef0['ContentType']=_0x3f96b6(0x247),_0x77eef0['Name']=_0x24d612[_0x3f96b6(0x1fa)],_0x77eef0[_0x3f96b6(0x22c)]=_0x24d612[_0x3f96b6(0x1fa)],_0x77eef0[_0x3f96b6(0x213)]=_0x11e370,_0x77eef0[_0x3f96b6(0x24c)]=await _0x4c83bf[_0x3f96b6(0x248)]({'type':_0x3f96b6(0x220),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x77eef0;}[a177_0x5f01a3(0x20c)](_0x3064de,_0x39d957,_0x2a6357){const _0x37c128=a177_0x5f01a3,_0x29d525=new Date()[_0x37c128(0x221)](),_0x3fb6d4={};return _0x3fb6d4[constants_1[_0x37c128(0x23f)]+'Component__c']=_0x39d957,_0x3fb6d4[constants_1['FLOSUM_NAMESPACE']+_0x37c128(0x240)]=_0x3064de[_0x37c128(0x226)],_0x3fb6d4[constants_1[_0x37c128(0x23f)]+_0x37c128(0x24a)]=_0x29d525,_0x3fb6d4[constants_1[_0x37c128(0x23f)]+'Changed_By__c']=this[_0x37c128(0x208)],_0x3fb6d4[constants_1[_0x37c128(0x23f)]+_0x37c128(0x231)]=_0x2a6357?_0x2a6357+0x1:0x1,_0x3fb6d4[constants_1['FLOSUM_GIT_NAMESPACE']+_0x37c128(0x1f7)]=!![],_0x3fb6d4;}[a177_0x5f01a3(0x23a)](_0x633109,_0x22dd24){const _0x1ca95d=a177_0x5f01a3;var _0x1cc38e,_0x44ae0d;const _0x4cdb48=new Date()[_0x1ca95d(0x221)](),_0x3a5a0b={};return!_0x22dd24?(this['branchId']?(_0x3a5a0b[constants_1[_0x1ca95d(0x23f)]+'Branch__c']=this[_0x1ca95d(0x1fb)],_0x3a5a0b[constants_1[_0x1ca95d(0x23f)]+_0x1ca95d(0x23c)]=_0x1ca95d(0x23d),_0x3a5a0b[_0x1ca95d(0x20f)]=(_0x1cc38e=this[_0x1ca95d(0x210)][_0x1ca95d(0x225)](_0x57717c=>_0x57717c[_0x1ca95d(0x24b)]===_0x1ca95d(0x23d)))===null||_0x1cc38e===void 0x0?void 0x0:_0x1cc38e['id']):(_0x3a5a0b[constants_1[_0x1ca95d(0x23f)]+_0x1ca95d(0x249)]=this[_0x1ca95d(0x233)],_0x3a5a0b[constants_1['FLOSUM_NAMESPACE']+_0x1ca95d(0x23c)]=_0x1ca95d(0x21a),_0x3a5a0b[_0x1ca95d(0x20f)]=(_0x44ae0d=this[_0x1ca95d(0x210)][_0x1ca95d(0x225)](_0x93abc2=>_0x93abc2[_0x1ca95d(0x24b)]==='Repository'))===null||_0x44ae0d===void 0x0?void 0x0:_0x44ae0d['id']),_0x3a5a0b[constants_1[_0x1ca95d(0x23f)]+_0x1ca95d(0x231)]=0x1):_0x3a5a0b[constants_1[_0x1ca95d(0x23f)]+_0x1ca95d(0x231)]=_0x22dd24[_0x1ca95d(0x24e)]+0x1,_0x3a5a0b[constants_1[_0x1ca95d(0x23f)]+_0x1ca95d(0x234)]=_0x633109[_0x1ca95d(0x1fa)],_0x3a5a0b[constants_1['FLOSUM_NAMESPACE']+_0x1ca95d(0x22f)]=_0x633109[_0x1ca95d(0x24b)],_0x3a5a0b[constants_1[_0x1ca95d(0x23f)]+_0x1ca95d(0x214)]=_0x633109[_0x1ca95d(0x22b)],_0x3a5a0b[constants_1[_0x1ca95d(0x23f)]+_0x1ca95d(0x1f8)]=this[_0x1ca95d(0x208)],_0x3a5a0b[constants_1['FLOSUM_NAMESPACE']+_0x1ca95d(0x1f6)]=this[_0x1ca95d(0x208)],_0x3a5a0b[constants_1[_0x1ca95d(0x23f)]+_0x1ca95d(0x207)]=_0x4cdb48,_0x3a5a0b[constants_1[_0x1ca95d(0x23f)]+_0x1ca95d(0x1fd)]=_0x4cdb48,_0x3a5a0b[constants_1[_0x1ca95d(0x23f)]+_0x1ca95d(0x240)]=_0x633109[_0x1ca95d(0x226)],_0x3a5a0b;}[a177_0x5f01a3(0x1f0)](){const _0x29120e=a177_0x5f01a3;return this[_0x29120e(0x20a)];}async[a177_0x5f01a3(0x224)](_0x4ecd3d,_0x3deeb1){const _0x33d64f=a177_0x5f01a3,_0x4a0db5=[];for(const _0xc27c8e of _0x4ecd3d){const _0x30442e=composite_utils_1[_0x33d64f(0x222)](constants_1[_0x33d64f(0x232)],this['prepareComponentRecord'](_0xc27c8e)),_0xa35938=composite_utils_1[_0x33d64f(0x222)](constants_1[_0x33d64f(0x20b)],this[_0x33d64f(0x20c)](_0xc27c8e,'@{'+_0x30442e[_0x33d64f(0x223)]+_0x33d64f(0x243))),_0x176d85=composite_utils_1[_0x33d64f(0x222)](constants_1[_0x33d64f(0x21f)],await this['prepareComponentAttachmentRecord'](_0xc27c8e,'@{'+_0xa35938[_0x33d64f(0x223)]+_0x33d64f(0x243)));this[_0x33d64f(0x21d)](_0x30442e['request'][_0x33d64f(0x209)],_0x30442e[_0x33d64f(0x223)]),_0x4a0db5[_0x33d64f(0x236)](_0x30442e[_0x33d64f(0x211)],_0xa35938[_0x33d64f(0x211)],_0x176d85['request']),_0x3deeb1&&_0x4a0db5[_0x33d64f(0x236)](this[_0x33d64f(0x24d)](_0x3deeb1,'@{'+_0xa35938[_0x33d64f(0x223)]+_0x33d64f(0x243)));}return _0x4a0db5;}async[a177_0x5f01a3(0x206)](_0x133ad7,_0x39ef46=''){const _0x41834c=a177_0x5f01a3,_0x2c3f1a=[];for(const {component:_0x11ab8f,meta:_0x5ee04f}of _0x133ad7){if(!_0x5ee04f['id']){const _0x4ae3b4=this['proceededComponentsMeta'][_0x41834c(0x225)](_0x10d783=>_0x10d783[_0x41834c(0x1ef)]===_0x11ab8f['name']&&_0x10d783[_0x41834c(0x218)]===_0x11ab8f['type']);if(!_0x4ae3b4)throw new salesforce_error_1[(_0x41834c(0x1ed))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x11ab8f[_0x41834c(0x24b)]+'\x20['+_0x11ab8f[_0x41834c(0x1fa)]+_0x41834c(0x216)));_0x5ee04f['id']=_0x4ae3b4[_0x41834c(0x1f2)];}const _0x24c398=composite_utils_1[_0x41834c(0x22d)](constants_1[_0x41834c(0x232)],_0x5ee04f['id'],this['prepareComponentRecord'](_0x11ab8f,_0x5ee04f)),_0x30d474=composite_utils_1['createPostRequest'](constants_1[_0x41834c(0x20b)],this[_0x41834c(0x20c)](_0x11ab8f,_0x5ee04f['id'],_0x5ee04f[_0x41834c(0x24e)])),_0x9b30cd=composite_utils_1['createPostRequest'](constants_1[_0x41834c(0x21f)],await this[_0x41834c(0x239)](_0x11ab8f,'@{'+_0x30d474[_0x41834c(0x223)]+'.id}'));this[_0x41834c(0x21d)](_0x24c398[_0x41834c(0x211)][_0x41834c(0x209)],_0x24c398['reference']),_0x2c3f1a[_0x41834c(0x236)](_0x24c398[_0x41834c(0x211)],_0x30d474[_0x41834c(0x211)],_0x9b30cd[_0x41834c(0x211)]),_0x39ef46&&_0x2c3f1a[_0x41834c(0x236)](this[_0x41834c(0x24d)](_0x39ef46,'@{'+_0x30d474[_0x41834c(0x223)]+_0x41834c(0x243)));}return _0x2c3f1a;}async[a177_0x5f01a3(0x20e)](_0xb3485d,_0x472850=![]){const _0x2adfe8=a177_0x5f01a3,_0x4cdde9={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x38b1d7=[];for(const _0x1f844f of _0xb3485d){if(_0x1f844f['id'])_0x38b1d7[_0x2adfe8(0x236)](_0x1f844f['id']);else{const _0x347dbb=this[_0x2adfe8(0x20a)][_0x2adfe8(0x225)](_0x26811f=>_0x26811f[_0x2adfe8(0x1ef)]===_0x1f844f[_0x2adfe8(0x24b)]&&_0x26811f[_0x2adfe8(0x218)]===_0x1f844f[_0x2adfe8(0x1fa)]);if(!_0x347dbb||!_0x347dbb[_0x2adfe8(0x1f2)])continue;_0x38b1d7[_0x2adfe8(0x236)](_0x347dbb[_0x2adfe8(0x1f2)]);}}if(_0x472850){const _0x57711e=await this['gitSync']['fetchCommitManifestsByComponentIds'](_0x38b1d7);_0x4cdde9[_0x2adfe8(0x1fc)]=_0x57711e[_0x2adfe8(0x242)](_0x5146b6=>composite_utils_1['createDeleteRequest'](constants_1[_0x2adfe8(0x21c)],_0x5146b6)[_0x2adfe8(0x211)]);}return _0x4cdde9[_0x2adfe8(0x1fe)]=_0x38b1d7[_0x2adfe8(0x242)](_0x23af51=>composite_utils_1['createPatchRequest'](constants_1[_0x2adfe8(0x232)],_0x23af51,{[constants_1[_0x2adfe8(0x230)]+'Deletion_By_Agent__c']:!![]})[_0x2adfe8(0x211)]),_0x4cdde9['componentsToDelete']=_0x38b1d7[_0x2adfe8(0x242)](_0x1b28fe=>composite_utils_1['createDeleteRequest'](constants_1[_0x2adfe8(0x232)],_0x1b28fe)[_0x2adfe8(0x211)]),_0x4cdde9;}}exports[a177_0x5f01a3(0x235)]=SalesforceComponentsManager;