const a228_0x119c23=a228_0x3282;(function(_0x3654c3,_0x1740e4){const _0x108e77=a228_0x3282,_0x3214c7=_0x3654c3();while(!![]){try{const _0x13879f=-parseInt(_0x108e77(0x15c))/0x1*(parseInt(_0x108e77(0x16a))/0x2)+-parseInt(_0x108e77(0x179))/0x3*(-parseInt(_0x108e77(0x165))/0x4)+parseInt(_0x108e77(0x12f))/0x5*(parseInt(_0x108e77(0x146))/0x6)+parseInt(_0x108e77(0x17b))/0x7+parseInt(_0x108e77(0x15f))/0x8+-parseInt(_0x108e77(0x147))/0x9+-parseInt(_0x108e77(0x12e))/0xa;if(_0x13879f===_0x1740e4)break;else _0x3214c7['push'](_0x3214c7['shift']());}catch(_0x4d66a2){_0x3214c7['push'](_0x3214c7['shift']());}}}(a228_0x49fe,0xae122));function a228_0x49fe(){const _0x51618d=['11219820vBUWhm','1996730bPZXMX','createPostRequest','Commit__c','proceedComponentMeta','Component_History__c','crc','map','request','createZip','branchId','extractFieldsFromRecord','.id}','body','prepareCommitManifest','recordTypes','createPatchRequest','gitSync','Branch__c','./salesforce-git-sync.service','FLOSUM_COMMIT_MANIFEST','componentName','manifests','Changed_On__c','18rjTMYU','3144357joUJud','componentType','Version__c','file','__esModule','FLOSUM_GIT_NAMESPACE','ParentId','SalesforceGitSyncService','prepareComponentRecord','Body','Component_Type__c',']\x20-\x20meta\x20not\x20found','Logger','type','Component_Name__c','base64','FLOSUM_ATTACHMENT','getProceededComponentsMeta','../../../../core','toISOString','push','1EOlcFU','__importDefault','Repository','4679608OUkvcw','prepareComponentHistoryRecord','(((.+)+)+)+$','File_Name__c','find','Name','948xnfVIj','../utils/flosum-naming.utils','get','Source__c','Zip','2421644LPfWUI','version','default','RecordTypeId','FLOSUM_NAMESPACE','name','SalesforceComponentsManager','Committed_On__c','createDeleteRequest','ContentType','username','componentId','defineProperty','SalesforceError','Is_From_Agent__c','12933KzXRAO','prepareComponentAttachmentRecord','4133325WaiqTa','Last_Modified_By__c','filePath','proceededComponentsMeta','update','toString','componentsToUpdate','delete','reference','files','repositoryId','Branch','search','FLOSUM_COMPONENT_HISTORY','Component__c','componentsToDelete','Changed_By__c','CRC32__c','FLOSUM_COMPONENT','Deletion_By_Agent__c','application/zip'];a228_0x49fe=function(){return _0x51618d;};return a228_0x49fe();}const a228_0x4934b5=(function(){let _0x3d2293=!![];return function(_0x366aed,_0x31d197){const _0xdb92a2=_0x3d2293?function(){if(_0x31d197){const _0x2b0209=_0x31d197['apply'](_0x366aed,arguments);return _0x31d197=null,_0x2b0209;}}:function(){};return _0x3d2293=![],_0xdb92a2;};}()),a228_0x1e52cb=a228_0x4934b5(this,function(){const _0x369992=a228_0x3282;return a228_0x1e52cb[_0x369992(0x180)]()['search'](_0x369992(0x161))[_0x369992(0x180)]()['constructor'](a228_0x1e52cb)[_0x369992(0x125)](_0x369992(0x161));});a228_0x1e52cb();'use strict';var __importDefault=this&&this[a228_0x119c23(0x15d)]||function(_0xafb85){return _0xafb85&&_0xafb85['__esModule']?_0xafb85:{'default':_0xafb85};};Object[a228_0x119c23(0x176)](exports,a228_0x119c23(0x14b),{'value':!![]}),exports[a228_0x119c23(0x170)]=void 0x0;function a228_0x3282(_0x59b3e2,_0x4e5692){const _0x5856f9=a228_0x49fe();return a228_0x3282=function(_0x1e52cb,_0x4934b5){_0x1e52cb=_0x1e52cb-0x120;let _0x49fe49=_0x5856f9[_0x1e52cb];return _0x49fe49;},a228_0x3282(_0x59b3e2,_0x4e5692);}const constants_1=require('../../../../constants'),core_1=require(a228_0x119c23(0x159)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a228_0x119c23(0x166)),salesforce_git_sync_service_1=require(a228_0x119c23(0x141));class SalesforceComponentsManager{constructor(_0x341d10,_0xb40ea4,_0x501868,_0x10d9fd,_0x1ca835){const _0x528c11=a228_0x119c23;this['repositoryId']=_0x341d10,this[_0x528c11(0x138)]=_0xb40ea4,this[_0x528c11(0x174)]=_0x501868,this[_0x528c11(0x13d)]=_0x10d9fd,this[_0x528c11(0x17e)]=_0x1ca835,this['logger']=new core_1[(_0x528c11(0x153))](SalesforceComponentsManager[_0x528c11(0x16f)]),this[_0x528c11(0x13f)]=typedi_1[_0x528c11(0x16c)][_0x528c11(0x167)](salesforce_git_sync_service_1[_0x528c11(0x14e)]);}['proceedComponentMeta'](_0x5d47be,_0x5840f5){const _0x385c63=a228_0x119c23,_0xc0c0a5=(0x0,flosum_naming_utils_1[_0x385c63(0x139)])(_0x5d47be,[_0x385c63(0x151),_0x385c63(0x155),_0x385c63(0x149)]);this[_0x385c63(0x17e)][_0x385c63(0x15b)]({'componentId':'','reference':_0x5840f5,'version':_0xc0c0a5[_0x385c63(0x149)],'componentName':_0xc0c0a5[_0x385c63(0x155)],'componentType':_0xc0c0a5[_0x385c63(0x151)]});}[a228_0x119c23(0x13c)](_0x37e47a,_0xfc0a91){const _0x43939f=a228_0x119c23,{request:_0x1a84ae}=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x43939f(0x142)],{[constants_1[_0x43939f(0x16e)]+_0x43939f(0x131)]:_0x37e47a,[constants_1[_0x43939f(0x16e)]+_0x43939f(0x133)]:_0xfc0a91});return _0x1a84ae;}async[a228_0x119c23(0x17a)](_0x4b70ad,_0x2052f9){const _0x1f5b3a=a228_0x119c23,_0x4a8221={},_0x19a07d=zip_1[_0x1f5b3a(0x169)][_0x1f5b3a(0x137)]();for(const _0x490b04 of Object['keys'](_0x4b70ad['files'])){_0x19a07d[_0x1f5b3a(0x14a)](_0x490b04,_0x4b70ad[_0x1f5b3a(0x122)][_0x490b04],{'createFolders':!![]});}return _0x4a8221[_0x1f5b3a(0x173)]=_0x1f5b3a(0x12d),_0x4a8221[_0x1f5b3a(0x164)]=_0x4b70ad[_0x1f5b3a(0x154)],_0x4a8221['Description']=_0x4b70ad['type'],_0x4a8221[_0x1f5b3a(0x14d)]=_0x2052f9,_0x4a8221[_0x1f5b3a(0x150)]=await _0x19a07d['generateAsync']({'type':_0x1f5b3a(0x156),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x4a8221;}[a228_0x119c23(0x160)](_0x624460,_0x214282,_0x57a3a9){const _0x51a1b0=a228_0x119c23,_0x1e30c8=new Date()[_0x51a1b0(0x15a)](),_0x3c91f0={};return _0x3c91f0[constants_1[_0x51a1b0(0x16e)]+_0x51a1b0(0x127)]=_0x214282,_0x3c91f0[constants_1[_0x51a1b0(0x16e)]+'CRC32__c']=_0x624460[_0x51a1b0(0x134)],_0x3c91f0[constants_1['FLOSUM_NAMESPACE']+_0x51a1b0(0x145)]=_0x1e30c8,_0x3c91f0[constants_1[_0x51a1b0(0x16e)]+_0x51a1b0(0x129)]=this['username'],_0x3c91f0[constants_1[_0x51a1b0(0x16e)]+_0x51a1b0(0x149)]=_0x57a3a9?_0x57a3a9+0x1:0x1,_0x3c91f0[constants_1[_0x51a1b0(0x14c)]+_0x51a1b0(0x178)]=!![],_0x3c91f0;}[a228_0x119c23(0x14f)](_0x5a6ac8,_0x45ce78){const _0x4d42e2=a228_0x119c23;var _0x3786b0,_0x4c8929;const _0x18c40a=new Date()[_0x4d42e2(0x15a)](),_0x53e09a={};return!_0x45ce78?(this[_0x4d42e2(0x138)]?(_0x53e09a[constants_1['FLOSUM_NAMESPACE']+_0x4d42e2(0x140)]=this[_0x4d42e2(0x138)],_0x53e09a[constants_1[_0x4d42e2(0x16e)]+'Source__c']='Branch',_0x53e09a['RecordTypeId']=(_0x3786b0=this['recordTypes'][_0x4d42e2(0x163)](_0x3e046a=>_0x3e046a['name']===_0x4d42e2(0x124)))===null||_0x3786b0===void 0x0?void 0x0:_0x3786b0['id']):(_0x53e09a[constants_1[_0x4d42e2(0x16e)]+'Repository__c']=this[_0x4d42e2(0x123)],_0x53e09a[constants_1[_0x4d42e2(0x16e)]+_0x4d42e2(0x168)]=_0x4d42e2(0x15e),_0x53e09a[_0x4d42e2(0x16d)]=(_0x4c8929=this['recordTypes'][_0x4d42e2(0x163)](_0x384580=>_0x384580['name']===_0x4d42e2(0x15e)))===null||_0x4c8929===void 0x0?void 0x0:_0x4c8929['id']),_0x53e09a[constants_1[_0x4d42e2(0x16e)]+_0x4d42e2(0x149)]=0x1):_0x53e09a[constants_1[_0x4d42e2(0x16e)]+_0x4d42e2(0x149)]=_0x45ce78[_0x4d42e2(0x16b)]+0x1,_0x53e09a[constants_1[_0x4d42e2(0x16e)]+'Component_Type__c']=_0x5a6ac8['type'],_0x53e09a[constants_1[_0x4d42e2(0x16e)]+_0x4d42e2(0x155)]=_0x5a6ac8['name'],_0x53e09a[constants_1[_0x4d42e2(0x16e)]+_0x4d42e2(0x162)]=_0x5a6ac8[_0x4d42e2(0x17d)],_0x53e09a[constants_1[_0x4d42e2(0x16e)]+'Last_Updated_By__c']=this[_0x4d42e2(0x174)],_0x53e09a[constants_1[_0x4d42e2(0x16e)]+_0x4d42e2(0x17c)]=this['username'],_0x53e09a[constants_1[_0x4d42e2(0x16e)]+'Last_Modified_Date__c']=_0x18c40a,_0x53e09a[constants_1[_0x4d42e2(0x16e)]+_0x4d42e2(0x171)]=_0x18c40a,_0x53e09a[constants_1[_0x4d42e2(0x16e)]+_0x4d42e2(0x12a)]=_0x5a6ac8['crc'],_0x53e09a;}[a228_0x119c23(0x158)](){const _0x500bfa=a228_0x119c23;return this[_0x500bfa(0x17e)];}async['insert'](_0x258eec,_0xa91340){const _0xf56899=a228_0x119c23,_0x2ee061=[];for(const _0x2a8240 of _0x258eec){const _0x1b42f0=(0x0,composite_utils_1[_0xf56899(0x130)])(constants_1[_0xf56899(0x12b)],this[_0xf56899(0x14f)](_0x2a8240)),_0x2dd536=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0xf56899(0x126)],this[_0xf56899(0x160)](_0x2a8240,'@{'+_0x1b42f0['reference']+_0xf56899(0x13a))),_0x881305=(0x0,composite_utils_1[_0xf56899(0x130)])(constants_1[_0xf56899(0x157)],await this[_0xf56899(0x17a)](_0x2a8240,'@{'+_0x2dd536['reference']+_0xf56899(0x13a)));this['proceedComponentMeta'](_0x1b42f0[_0xf56899(0x136)]['body'],_0x1b42f0[_0xf56899(0x121)]),_0x2ee061[_0xf56899(0x15b)](_0x1b42f0[_0xf56899(0x136)],_0x2dd536['request'],_0x881305[_0xf56899(0x136)]),_0xa91340&&_0x2ee061[_0xf56899(0x15b)](this['prepareCommitManifest'](_0xa91340,'@{'+_0x2dd536[_0xf56899(0x121)]+'.id}'));}return _0x2ee061;}async[a228_0x119c23(0x17f)](_0x30f4fe,_0x46b710=''){const _0x10b502=a228_0x119c23,_0x220d30=[];for(const {component:_0x2ee10d,meta:_0x33c6f3}of _0x30f4fe){if(!_0x33c6f3['id']){const _0xdfe122=this['proceededComponentsMeta'][_0x10b502(0x163)](_0x4c4840=>_0x4c4840[_0x10b502(0x143)]===_0x2ee10d['name']&&_0x4c4840[_0x10b502(0x148)]===_0x2ee10d[_0x10b502(0x154)]);if(!_0xdfe122)throw new salesforce_error_1[(_0x10b502(0x177))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x2ee10d[_0x10b502(0x16f)]+'\x20['+_0x2ee10d[_0x10b502(0x154)]+_0x10b502(0x152)));_0x33c6f3['id']=_0xdfe122['componentId'];}const _0x32ad27=(0x0,composite_utils_1['createPatchRequest'])(constants_1[_0x10b502(0x12b)],_0x33c6f3['id'],this[_0x10b502(0x14f)](_0x2ee10d,_0x33c6f3)),_0x490bd7=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x10b502(0x126)],this[_0x10b502(0x160)](_0x2ee10d,_0x33c6f3['id'],_0x33c6f3[_0x10b502(0x16b)])),_0x5135d1=(0x0,composite_utils_1[_0x10b502(0x130)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x10b502(0x17a)](_0x2ee10d,'@{'+_0x490bd7[_0x10b502(0x121)]+'.id}'));this[_0x10b502(0x132)](_0x32ad27['request'][_0x10b502(0x13b)],_0x32ad27['reference']),_0x220d30[_0x10b502(0x15b)](_0x32ad27[_0x10b502(0x136)],_0x490bd7[_0x10b502(0x136)],_0x5135d1[_0x10b502(0x136)]),_0x46b710&&_0x220d30[_0x10b502(0x15b)](this[_0x10b502(0x13c)](_0x46b710,'@{'+_0x490bd7[_0x10b502(0x121)]+'.id}'));}return _0x220d30;}async[a228_0x119c23(0x120)](_0x4bec2f,_0x1c79b6=![]){const _0xc4d3e7=a228_0x119c23,_0x38274e={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x1476b8=[];for(const _0x44d86f of _0x4bec2f){if(_0x44d86f['id'])_0x1476b8[_0xc4d3e7(0x15b)](_0x44d86f['id']);else{const _0xcfdb3c=this[_0xc4d3e7(0x17e)][_0xc4d3e7(0x163)](_0xaf2a2c=>_0xaf2a2c[_0xc4d3e7(0x143)]===_0x44d86f[_0xc4d3e7(0x16f)]&&_0xaf2a2c[_0xc4d3e7(0x148)]===_0x44d86f[_0xc4d3e7(0x154)]);if(!_0xcfdb3c||!_0xcfdb3c[_0xc4d3e7(0x175)])continue;_0x1476b8[_0xc4d3e7(0x15b)](_0xcfdb3c[_0xc4d3e7(0x175)]);}}if(_0x1c79b6){const _0x383526=await this[_0xc4d3e7(0x13f)]['fetchCommitManifestsByComponentIds'](_0x1476b8);_0x38274e[_0xc4d3e7(0x144)]=_0x383526[_0xc4d3e7(0x135)](_0x9e29d2=>(0x0,composite_utils_1[_0xc4d3e7(0x172)])(constants_1[_0xc4d3e7(0x142)],_0x9e29d2)[_0xc4d3e7(0x136)]);}return _0x38274e[_0xc4d3e7(0x181)]=_0x1476b8['map'](_0x4356e5=>(0x0,composite_utils_1[_0xc4d3e7(0x13e)])(constants_1[_0xc4d3e7(0x12b)],_0x4356e5,{[constants_1[_0xc4d3e7(0x14c)]+_0xc4d3e7(0x12c)]:!![]})['request']),_0x38274e[_0xc4d3e7(0x128)]=_0x1476b8[_0xc4d3e7(0x135)](_0x2c4cd6=>(0x0,composite_utils_1[_0xc4d3e7(0x172)])(constants_1[_0xc4d3e7(0x12b)],_0x2c4cd6)[_0xc4d3e7(0x136)]),_0x38274e;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;