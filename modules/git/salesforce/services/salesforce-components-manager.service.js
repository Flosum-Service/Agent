const a271_0x39bf16=a271_0x5c36;function a271_0x5c36(_0x388143,_0x5b5348){const _0x3b262f=a271_0x2e0e();return a271_0x5c36=function(_0x1bc3d3,_0x238822){_0x1bc3d3=_0x1bc3d3-0x99;let _0x2e0ef4=_0x3b262f[_0x1bc3d3];return _0x2e0ef4;},a271_0x5c36(_0x388143,_0x5b5348);}(function(_0x5e9494,_0xa39885){const _0x36138b=a271_0x5c36,_0x1c5abf=_0x5e9494();while(!![]){try{const _0x44494c=-parseInt(_0x36138b(0xf2))/0x1*(-parseInt(_0x36138b(0xe8))/0x2)+-parseInt(_0x36138b(0xd0))/0x3+parseInt(_0x36138b(0xc4))/0x4*(parseInt(_0x36138b(0xf0))/0x5)+-parseInt(_0x36138b(0xa1))/0x6*(-parseInt(_0x36138b(0xce))/0x7)+-parseInt(_0x36138b(0xb2))/0x8+parseInt(_0x36138b(0xc7))/0x9*(parseInt(_0x36138b(0xcd))/0xa)+-parseInt(_0x36138b(0xab))/0xb*(parseInt(_0x36138b(0xec))/0xc);if(_0x44494c===_0xa39885)break;else _0x1c5abf['push'](_0x1c5abf['shift']());}catch(_0x481b56){_0x1c5abf['push'](_0x1c5abf['shift']());}}}(a271_0x2e0e,0x974aa));const a271_0x238822=(function(){let _0xb9e9dc=!![];return function(_0x30ff69,_0x360f18){const _0x13d410=_0xb9e9dc?function(){const _0x2e4a13=a271_0x5c36;if(_0x360f18){const _0x52e2c3=_0x360f18[_0x2e4a13(0xd4)](_0x30ff69,arguments);return _0x360f18=null,_0x52e2c3;}}:function(){};return _0xb9e9dc=![],_0x13d410;};}()),a271_0x1bc3d3=a271_0x238822(this,function(){const _0x1a5be0=a271_0x5c36;return a271_0x1bc3d3[_0x1a5be0(0xad)]()[_0x1a5be0(0xa6)](_0x1a5be0(0xa8))[_0x1a5be0(0xad)]()[_0x1a5be0(0xa9)](a271_0x1bc3d3)[_0x1a5be0(0xa6)](_0x1a5be0(0xa8));});a271_0x1bc3d3();'use strict';var __importDefault=this&&this[a271_0x39bf16(0xe6)]||function(_0x51a63c){const _0x3e952c=a271_0x39bf16;return _0x51a63c&&_0x51a63c[_0x3e952c(0xbb)]?_0x51a63c:{'default':_0x51a63c};};function a271_0x2e0e(){const _0x3ca68d=['prepareComponentHistoryRecord','Last_Modified_Date__c','filePath','Description','files','request','FLOSUM_COMMIT_MANIFEST','recordTypes','Is_From_Agent__c','Component_Name__c','.id}','SalesforceComponentsManager','typedi','branchId','__importDefault','get','87834LyNuOc','username','push','reference','23556KUZTLn','Component__c','version','createPatchRequest','65KbvDHL','createZip','21KQAocu','proceedComponentMeta','manifests','proceededComponentsMeta','FLOSUM_NAMESPACE','componentId','SalesforceGitSyncService','../../../../constants','Changed_On__c','createDeleteRequest','find','Branch__c','name','Logger','defineProperty','map','../errors/salesforce.error','Commit__c','FLOSUM_GIT_NAMESPACE','MC_Key__c','prepareComponentRecord','generateAsync','12ATBefO','Version__c','componentsToDelete','Source__c','./salesforce-git-sync.service','search','Deletion_By_Agent__c','(((.+)+)+)+$','constructor','Repository__c','4873kPYHUr','repositoryId','toString','Branch','DEFLATE','prepareCommitManifest','Repository','3638688ffhAZD','application/zip','vlocityComponentName','fetchCommitManifestsByComponentIds','gitSync','componentType','isVlocityComponent','SalesforceError','componentName','__esModule','FLOSUM_COMPONENT','prepareComponentAttachmentRecord','Vlocity_Component__c','crc','update','createPostRequest','Last_Updated_By__c','RecordTypeId','25724TOsOoU','extractFieldsFromRecord','Zip','9jTcXsk','Component_Type__c','File_Name__c','FLOSUM_ATTACHMENT','getProceededComponentsMeta','type','4405380fWRfoa','3778544vizKIy','body','1745541WjGxtY','FLOSUM_COMPONENT_HISTORY',']\x20-\x20meta\x20not\x20found','insert','apply','Could\x20not\x20proceed\x20component\x20','Last_Modified_By__c','base64'];a271_0x2e0e=function(){return _0x3ca68d;};return a271_0x2e0e();}Object[a271_0x39bf16(0x99)](exports,'__esModule',{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a271_0x39bf16(0xf9)),core_1=require('../../../../core'),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a271_0x39bf16(0xe4))),salesforce_error_1=require(a271_0x39bf16(0x9b)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a271_0x39bf16(0xa5));class SalesforceComponentsManager{constructor(_0x149d29,_0x52c146,_0x1c7ee0,_0x368de9,_0x15973f){const _0x299c6b=a271_0x39bf16;this[_0x299c6b(0xac)]=_0x149d29,this[_0x299c6b(0xe5)]=_0x52c146,this[_0x299c6b(0xe9)]=_0x1c7ee0,this[_0x299c6b(0xdf)]=_0x368de9,this[_0x299c6b(0xf5)]=_0x15973f,this['logger']=new core_1[(_0x299c6b(0xff))](SalesforceComponentsManager[_0x299c6b(0xfe)]),this[_0x299c6b(0xb6)]=typedi_1['default'][_0x299c6b(0xe7)](salesforce_git_sync_service_1[_0x299c6b(0xf8)]);}[a271_0x39bf16(0xf3)](_0x164150,_0x288207){const _0xddec41=a271_0x39bf16,_0x333aac=(0x0,flosum_naming_utils_1[_0xddec41(0xc5)])(_0x164150,[_0xddec41(0xc8),_0xddec41(0xe1),_0xddec41(0xa2)]);this[_0xddec41(0xf5)]['push']({'componentId':'','reference':_0x288207,'version':_0x333aac[_0xddec41(0xa2)],'componentName':_0x333aac[_0xddec41(0xe1)],'componentType':_0x333aac[_0xddec41(0xc8)]});}[a271_0x39bf16(0xb0)](_0x1a7ac2,_0x5c4ad1){const _0x490bdd=a271_0x39bf16,{request:_0x1c80aa}=(0x0,composite_utils_1[_0x490bdd(0xc1)])(constants_1[_0x490bdd(0xde)],{[constants_1[_0x490bdd(0xf6)]+_0x490bdd(0x9c)]:_0x1a7ac2,[constants_1[_0x490bdd(0xf6)]+'Component_History__c']:_0x5c4ad1});return _0x1c80aa;}async['prepareComponentAttachmentRecord'](_0x4f77b5,_0x187fbe){const _0x175b88=a271_0x39bf16,_0x47433f={},_0x3abfc8=zip_1[_0x175b88(0xc6)][_0x175b88(0xf1)]();for(const _0xfee604 of Object['keys'](_0x4f77b5[_0x175b88(0xdc)])){_0x3abfc8['file'](_0xfee604,_0x4f77b5[_0x175b88(0xdc)][_0xfee604],{'createFolders':!![]});}return _0x47433f['ContentType']=_0x175b88(0xb3),_0x47433f['Name']=_0x4f77b5[_0x175b88(0xcc)],_0x47433f[_0x175b88(0xdb)]=_0x4f77b5[_0x175b88(0xcc)],_0x47433f['ParentId']=_0x187fbe,_0x47433f['Body']=await _0x3abfc8[_0x175b88(0xa0)]({'type':_0x175b88(0xd7),'compression':_0x175b88(0xaf),'compressionOptions':{'level':0x6}}),_0x47433f;}[a271_0x39bf16(0xd8)](_0x46b113,_0x59a624,_0x26e2fc){const _0x32b7e4=a271_0x39bf16,_0x4f6ffe=new Date()['toISOString'](),_0x1c2052={};return _0x1c2052[constants_1[_0x32b7e4(0xf6)]+_0x32b7e4(0xed)]=_0x59a624,_0x1c2052[constants_1[_0x32b7e4(0xf6)]+'CRC32__c']=_0x46b113[_0x32b7e4(0xbf)],_0x1c2052[constants_1[_0x32b7e4(0xf6)]+_0x32b7e4(0xfa)]=_0x4f6ffe,_0x1c2052[constants_1[_0x32b7e4(0xf6)]+'Changed_By__c']=this[_0x32b7e4(0xe9)],_0x1c2052[constants_1[_0x32b7e4(0xf6)]+'Version__c']=_0x26e2fc?_0x26e2fc+0x1:0x1,_0x1c2052[constants_1[_0x32b7e4(0x9d)]+_0x32b7e4(0xe0)]=!![],_0x1c2052;}[a271_0x39bf16(0x9f)](_0x41c23c,_0x178162){const _0x1e9370=a271_0x39bf16;var _0x578fc8,_0x2b777a;const _0x31d97e=new Date()['toISOString'](),_0x266e33={};return!_0x178162?(this[_0x1e9370(0xe5)]?(_0x266e33[constants_1[_0x1e9370(0xf6)]+_0x1e9370(0xfd)]=this[_0x1e9370(0xe5)],_0x266e33[constants_1[_0x1e9370(0xf6)]+_0x1e9370(0xa4)]=_0x1e9370(0xae),_0x266e33['RecordTypeId']=(_0x578fc8=this[_0x1e9370(0xdf)][_0x1e9370(0xfc)](_0x1545b4=>_0x1545b4['name']===_0x1e9370(0xae)))===null||_0x578fc8===void 0x0?void 0x0:_0x578fc8['id']):(_0x266e33[constants_1['FLOSUM_NAMESPACE']+_0x1e9370(0xaa)]=this[_0x1e9370(0xac)],_0x266e33[constants_1[_0x1e9370(0xf6)]+_0x1e9370(0xa4)]=_0x1e9370(0xb1),_0x266e33[_0x1e9370(0xc3)]=(_0x2b777a=this[_0x1e9370(0xdf)]['find'](_0x562e3d=>_0x562e3d[_0x1e9370(0xfe)]===_0x1e9370(0xb1)))===null||_0x2b777a===void 0x0?void 0x0:_0x2b777a['id']),_0x266e33[constants_1[_0x1e9370(0xf6)]+_0x1e9370(0xa2)]=0x1):_0x266e33[constants_1[_0x1e9370(0xf6)]+_0x1e9370(0xa2)]=_0x178162[_0x1e9370(0xee)]+0x1,_0x266e33[constants_1[_0x1e9370(0xf6)]+_0x1e9370(0xc8)]=_0x41c23c[_0x1e9370(0xcc)],_0x266e33[constants_1[_0x1e9370(0xf6)]+_0x1e9370(0xe1)]=_0x41c23c[_0x1e9370(0xfe)],_0x266e33[constants_1['FLOSUM_NAMESPACE']+_0x1e9370(0xc9)]=_0x41c23c[_0x1e9370(0xda)],_0x266e33[constants_1['FLOSUM_NAMESPACE']+_0x1e9370(0xc2)]=this[_0x1e9370(0xe9)],_0x266e33[constants_1['FLOSUM_NAMESPACE']+_0x1e9370(0xd6)]=this[_0x1e9370(0xe9)],_0x266e33[constants_1[_0x1e9370(0xf6)]+_0x1e9370(0xd9)]=_0x31d97e,_0x266e33[constants_1['FLOSUM_NAMESPACE']+'Committed_On__c']=_0x31d97e,_0x266e33[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x41c23c['crc'],_0x266e33[constants_1[_0x1e9370(0xf6)]+'Vlocity_Component_Name__c']=_0x41c23c[_0x1e9370(0xb4)],_0x266e33[constants_1['FLOSUM_NAMESPACE']+_0x1e9370(0xbe)]=_0x41c23c[_0x1e9370(0xb8)],_0x266e33[constants_1['FLOSUM_NAMESPACE']+_0x1e9370(0x9e)]=_0x41c23c['marketingCloudKey'],_0x266e33;}[a271_0x39bf16(0xcb)](){return this['proceededComponentsMeta'];}async[a271_0x39bf16(0xd3)](_0x8d9d5d,_0x641cc2){const _0x54dd10=a271_0x39bf16,_0x16a825=[];for(const _0x5a1b4a of _0x8d9d5d){const _0x3842bf=(0x0,composite_utils_1[_0x54dd10(0xc1)])(constants_1[_0x54dd10(0xbc)],this[_0x54dd10(0x9f)](_0x5a1b4a)),_0x2861fb=(0x0,composite_utils_1['createPostRequest'])(constants_1[_0x54dd10(0xd1)],this[_0x54dd10(0xd8)](_0x5a1b4a,'@{'+_0x3842bf['reference']+_0x54dd10(0xe2))),_0x3f19d0=(0x0,composite_utils_1[_0x54dd10(0xc1)])(constants_1['FLOSUM_ATTACHMENT'],await this[_0x54dd10(0xbd)](_0x5a1b4a,'@{'+_0x2861fb[_0x54dd10(0xeb)]+_0x54dd10(0xe2)));this['proceedComponentMeta'](_0x3842bf['request'][_0x54dd10(0xcf)],_0x3842bf[_0x54dd10(0xeb)]),_0x16a825['push'](_0x3842bf[_0x54dd10(0xdd)],_0x2861fb[_0x54dd10(0xdd)],_0x3f19d0[_0x54dd10(0xdd)]),_0x641cc2&&_0x16a825[_0x54dd10(0xea)](this[_0x54dd10(0xb0)](_0x641cc2,'@{'+_0x2861fb[_0x54dd10(0xeb)]+'.id}'));}return _0x16a825;}async[a271_0x39bf16(0xc0)](_0x2fe996,_0x2cd60a=''){const _0x5a66f5=a271_0x39bf16,_0x3ec7c8=[];for(const {component:_0x14c537,meta:_0x1e481a}of _0x2fe996){if(!_0x1e481a['id']){const _0x1a21c2=this[_0x5a66f5(0xf5)][_0x5a66f5(0xfc)](_0x2e97b9=>_0x2e97b9[_0x5a66f5(0xba)]===_0x14c537['name']&&_0x2e97b9['componentType']===_0x14c537[_0x5a66f5(0xcc)]);if(!_0x1a21c2)throw new salesforce_error_1[(_0x5a66f5(0xb9))](new Error(_0x5a66f5(0xd5)+_0x14c537['name']+'\x20['+_0x14c537[_0x5a66f5(0xcc)]+_0x5a66f5(0xd2)));_0x1e481a['id']=_0x1a21c2['componentId'];}const _0x2f8fcc=(0x0,composite_utils_1[_0x5a66f5(0xef)])(constants_1[_0x5a66f5(0xbc)],_0x1e481a['id'],this[_0x5a66f5(0x9f)](_0x14c537,_0x1e481a)),_0x11dd24=(0x0,composite_utils_1[_0x5a66f5(0xc1)])(constants_1[_0x5a66f5(0xd1)],this[_0x5a66f5(0xd8)](_0x14c537,_0x1e481a['id'],_0x1e481a[_0x5a66f5(0xee)])),_0x32e195=(0x0,composite_utils_1[_0x5a66f5(0xc1)])(constants_1[_0x5a66f5(0xca)],await this[_0x5a66f5(0xbd)](_0x14c537,'@{'+_0x11dd24[_0x5a66f5(0xeb)]+_0x5a66f5(0xe2)));this[_0x5a66f5(0xf3)](_0x2f8fcc['request']['body'],_0x2f8fcc[_0x5a66f5(0xeb)]),_0x3ec7c8[_0x5a66f5(0xea)](_0x2f8fcc[_0x5a66f5(0xdd)],_0x11dd24[_0x5a66f5(0xdd)],_0x32e195[_0x5a66f5(0xdd)]),_0x2cd60a&&_0x3ec7c8['push'](this[_0x5a66f5(0xb0)](_0x2cd60a,'@{'+_0x11dd24[_0x5a66f5(0xeb)]+'.id}'));}return _0x3ec7c8;}async['delete'](_0x2474c7,_0x277b20=![]){const _0x2d37b0=a271_0x39bf16,_0x14084d={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x2ca280=[];for(const _0x260b92 of _0x2474c7){if(_0x260b92['id'])_0x2ca280[_0x2d37b0(0xea)](_0x260b92['id']);else{const _0x4234ec=this['proceededComponentsMeta'][_0x2d37b0(0xfc)](_0x282aa3=>_0x282aa3[_0x2d37b0(0xba)]===_0x260b92['name']&&_0x282aa3[_0x2d37b0(0xb7)]===_0x260b92[_0x2d37b0(0xcc)]);if(!_0x4234ec||!_0x4234ec[_0x2d37b0(0xf7)])continue;_0x2ca280['push'](_0x4234ec['componentId']);}}if(_0x277b20){const _0x16b1bb=await this['gitSync'][_0x2d37b0(0xb5)](_0x2ca280);_0x14084d[_0x2d37b0(0xf4)]=_0x16b1bb[_0x2d37b0(0x9a)](_0x313c4e=>(0x0,composite_utils_1[_0x2d37b0(0xfb)])(constants_1['FLOSUM_COMMIT_MANIFEST'],_0x313c4e)[_0x2d37b0(0xdd)]);}return _0x14084d['componentsToUpdate']=_0x2ca280['map'](_0x1cf068=>(0x0,composite_utils_1[_0x2d37b0(0xef)])(constants_1[_0x2d37b0(0xbc)],_0x1cf068,{[constants_1[_0x2d37b0(0x9d)]+_0x2d37b0(0xa7)]:!![]})[_0x2d37b0(0xdd)]),_0x14084d[_0x2d37b0(0xa3)]=_0x2ca280[_0x2d37b0(0x9a)](_0x3e65d5=>(0x0,composite_utils_1[_0x2d37b0(0xfb)])(constants_1['FLOSUM_COMPONENT'],_0x3e65d5)['request']),_0x14084d;}}exports[a271_0x39bf16(0xe3)]=SalesforceComponentsManager;