const a270_0x36ed97=a270_0xca31;(function(_0x4b2d2f,_0x59c951){const _0x36a958=a270_0xca31,_0x5466c6=_0x4b2d2f();while(!![]){try{const _0x4035aa=-parseInt(_0x36a958(0x10a))/0x1+-parseInt(_0x36a958(0x142))/0x2*(parseInt(_0x36a958(0x126))/0x3)+parseInt(_0x36a958(0x13f))/0x4+-parseInt(_0x36a958(0xfc))/0x5*(parseInt(_0x36a958(0x14a))/0x6)+parseInt(_0x36a958(0x11c))/0x7+parseInt(_0x36a958(0x131))/0x8+parseInt(_0x36a958(0x105))/0x9*(parseInt(_0x36a958(0x130))/0xa);if(_0x4035aa===_0x59c951)break;else _0x5466c6['push'](_0x5466c6['shift']());}catch(_0x584a26){_0x5466c6['push'](_0x5466c6['shift']());}}}(a270_0xa77b,0x1fe9e));const a270_0xc09478=(function(){let _0x44841d=!![];return function(_0x10db4f,_0x2bc8e5){const _0x115c86=_0x44841d?function(){const _0x2039cc=a270_0xca31;if(_0x2bc8e5){const _0x1e377d=_0x2bc8e5[_0x2039cc(0x121)](_0x10db4f,arguments);return _0x2bc8e5=null,_0x1e377d;}}:function(){};return _0x44841d=![],_0x115c86;};}()),a270_0x4e13ec=a270_0xc09478(this,function(){const _0x1dd44d=a270_0xca31;return a270_0x4e13ec[_0x1dd44d(0x125)]()['search']('(((.+)+)+)+$')['toString']()['constructor'](a270_0x4e13ec)[_0x1dd44d(0x145)](_0x1dd44d(0x107));});a270_0x4e13ec();'use strict';var __decorate=this&&this['__decorate']||function(_0x15406f,_0x4ee333,_0x255861,_0x2b9464){const _0x5a5ac1=a270_0xca31;var _0x41f33f=arguments['length'],_0x4e684b=_0x41f33f<0x3?_0x4ee333:_0x2b9464===null?_0x2b9464=Object[_0x5a5ac1(0x13c)](_0x4ee333,_0x255861):_0x2b9464,_0x35f911;if(typeof Reflect==='object'&&typeof Reflect[_0x5a5ac1(0xfe)]===_0x5a5ac1(0x10c))_0x4e684b=Reflect['decorate'](_0x15406f,_0x4ee333,_0x255861,_0x2b9464);else{for(var _0x1ead98=_0x15406f['length']-0x1;_0x1ead98>=0x0;_0x1ead98--)if(_0x35f911=_0x15406f[_0x1ead98])_0x4e684b=(_0x41f33f<0x3?_0x35f911(_0x4e684b):_0x41f33f>0x3?_0x35f911(_0x4ee333,_0x255861,_0x4e684b):_0x35f911(_0x4ee333,_0x255861))||_0x4e684b;}return _0x41f33f>0x3&&_0x4e684b&&Object['defineProperty'](_0x4ee333,_0x255861,_0x4e684b),_0x4e684b;},__metadata=this&&this[a270_0x36ed97(0x14c)]||function(_0x2e62de,_0x172088){const _0xd2788b=a270_0x36ed97;if(typeof Reflect==='object'&&typeof Reflect[_0xd2788b(0x118)]===_0xd2788b(0x10c))return Reflect[_0xd2788b(0x118)](_0x2e62de,_0x172088);};function a270_0xca31(_0x12d860,_0xf65144){const _0x38dc51=a270_0xa77b();return a270_0xca31=function(_0x4e13ec,_0xc09478){_0x4e13ec=_0x4e13ec-0xf8;let _0xa77baf=_0x38dc51[_0x4e13ec];return _0xa77baf;},a270_0xca31(_0x12d860,_0xf65144);}Object[a270_0x36ed97(0x120)](exports,'__esModule',{'value':!![]}),exports[a270_0x36ed97(0x122)]=void 0x0;function a270_0xa77b(){const _0x1ddff6=['SalesforceQueryService','metadata','../queries','text/plain','length','713790JBRNwN','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getBranchComponents','design:paramtypes','defineProperty','apply','SalesforceSyncService','FLOSUM_NAMESPACE','createObject','toString','221928dxEHQq','updateRemoteState','encodeBase64','SalesforceNotFoundError','salesforceQuery','salesforceService','\x20not\x20found\x20on\x20salesforce','GET_BRANCH_QUERY','getRepositoryRecords','%name%','72530jGwQwP','1455192QKvLkM','./salesforce-query.service','Branch\x20with\x20Id\x20','query','disableSync','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','Attachment','./salesforce.service','../dto/flosum-repository-sync.dto','getBranchRecord','fromBranchRecord','getOwnPropertyDescriptor','patchObject','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','274336ptVNbP','getAttachmentId','%id%','2KdJKhX','getComponents','typedi','search','GET_WAITING_BRANCHES_QUERY','push','\x0a\x20\x20\x20\x20\x20\x20','find','276TJrrPT','replace','__metadata','SalesforceService','setStatus','getRepositoryRecordByName','ERR_INVALID_ATTACHMENT_ID','records','FlosumRepositorySyncDto','27160SpuBXA','repositoryId','decorate','Synchronization_Status__c','Sync_In_Progress__c','GET_REPOSITORIES_NAMES_QUERY','map','GET_WAITING_REPOSITORIES_QUERY','../../../../constants','432WyCqwB','Repository__r','(((.+)+)+)+$','fromRepositoryRecord','SYNC_ATTACHMENT_FOR_BRANCH_NAME','246031pgfAFz','GET_BRANCH_BY_NAME_QUERY','function','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','../errors/not-found.error','Name','getComponentsFromRepository','getAllRepositoryNames','FLOSUM_GIT_NAMESPACE','Service','objectId','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','getRemoteStateAttachmentId'];a270_0xa77b=function(){return _0x1ddff6;};return a270_0xa77b();}const typedi_1=require(a270_0x36ed97(0x144)),constants_1=require(a270_0x36ed97(0x104)),errors_1=require('../../../../constants/errors'),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a270_0x36ed97(0x139)),not_found_error_1=require(a270_0x36ed97(0x10e)),queries_1=require(a270_0x36ed97(0x119)),salesforce_query_service_1=require(a270_0x36ed97(0x132)),salesforce_service_1=require(a270_0x36ed97(0x138));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x4050f0,_0x24dc82){const _0x4ad5a6=a270_0x36ed97;this[_0x4ad5a6(0x12a)]=_0x4050f0,this[_0x4ad5a6(0x12b)]=_0x24dc82;}async['getComponents'](_0x4f5ad4){const _0x1e3d1a=a270_0x36ed97;var _0x32a7ec;const _0x4f35ec=await this['salesforceQuery'][_0x1e3d1a(0x134)](_0x4f5ad4),_0x231648=[];for(const _0x478a51 of _0x4f35ec){const _0x3e9a3c=(_0x32a7ec=_0x478a51[constants_1['FLOSUM_NAMESPACE']+'Components__r'])===null||_0x32a7ec===void 0x0?void 0x0:_0x32a7ec[_0x1e3d1a(0xfa)];_0x3e9a3c&&_0x3e9a3c[_0x1e3d1a(0x11b)]&&_0x231648[_0x1e3d1a(0x147)](_0x3e9a3c[0x0]['Id']);}return _0x231648;}async[a270_0x36ed97(0x111)](_0x1af13c){const _0xa612e=a270_0x36ed97,_0x5d44ce=await this['salesforceQuery'][_0xa612e(0x134)](queries_1[_0xa612e(0x101)][_0xa612e(0x14b)](/\%connection_id\%/g,_0x1af13c));return _0x5d44ce[_0xa612e(0x102)](_0x8843fe=>{const _0x4a11d6=_0xa612e;return _0x8843fe[constants_1[_0x4a11d6(0x112)]+_0x4a11d6(0x106)]?_0x8843fe[constants_1[_0x4a11d6(0x112)]+'Repository__r']['Name']:_0x8843fe[_0x4a11d6(0x10f)];});}async[a270_0x36ed97(0x12e)](_0x39e526){const _0x524f05=a270_0x36ed97,_0x57fe16=await this[_0x524f05(0x12a)][_0x524f05(0x134)](queries_1[_0x524f05(0x103)][_0x524f05(0x14b)](/\%connection_id\%/g,_0x39e526));return _0x57fe16[_0x524f05(0x102)](_0x1d26f4=>flosum_repository_sync_dto_1[_0x524f05(0xfb)][_0x524f05(0x108)](_0x1d26f4));}async['getBranchRecords'](_0x30d503){const _0x3867d1=a270_0x36ed97,_0xc53bd3=await this[_0x3867d1(0x12a)]['query'](queries_1[_0x3867d1(0x146)][_0x3867d1(0x14b)](/%repositories_ids\%/g,_0x30d503));return _0xc53bd3[_0x3867d1(0x102)](_0x4141b8=>flosum_repository_sync_dto_1[_0x3867d1(0xfb)][_0x3867d1(0x13b)](_0x4141b8));}async['getRepositoryRecord'](_0x12a234){const _0x576ba3=a270_0x36ed97,_0x1416db=await this[_0x576ba3(0x12a)][_0x576ba3(0x134)](queries_1['GET_REPOSITORY_QUERY'][_0x576ba3(0x14b)](_0x576ba3(0x141),_0x12a234));if(_0x1416db['length']===0x0)throw new not_found_error_1[(_0x576ba3(0x129))]('Repository\x20with\x20Id\x20'+_0x12a234+_0x576ba3(0x12c));return flosum_repository_sync_dto_1[_0x576ba3(0xfb)][_0x576ba3(0x108)](_0x1416db[0x0]);}async[a270_0x36ed97(0x13a)](_0x5a1490){const _0x3d1884=a270_0x36ed97,_0x4afd38=await this['salesforceQuery'][_0x3d1884(0x134)](queries_1[_0x3d1884(0x12d)][_0x3d1884(0x14b)]('%id%',_0x5a1490));if(_0x4afd38[_0x3d1884(0x11b)]===0x0)throw new not_found_error_1[(_0x3d1884(0x129))](_0x3d1884(0x133)+_0x5a1490+_0x3d1884(0x12c));return flosum_repository_sync_dto_1[_0x3d1884(0xfb)][_0x3d1884(0x13b)](_0x4afd38[0x0]);}async['getBranchRecordByName'](_0x26e316){const _0xe0ff50=a270_0x36ed97,_0x1990d4=await this[_0xe0ff50(0x12a)][_0xe0ff50(0x134)](queries_1[_0xe0ff50(0x10b)][_0xe0ff50(0x14b)](_0xe0ff50(0x12f),_0x26e316));if(_0x1990d4[_0xe0ff50(0x11b)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x26e316+_0xe0ff50(0x12c));const _0x19e4f3=_0x1990d4[_0xe0ff50(0x149)](_0x127af9=>_0x127af9[constants_1[_0xe0ff50(0x123)]+'Branch_Name__c']===_0x26e316);if(!_0x19e4f3)throw new not_found_error_1[(_0xe0ff50(0x129))]('Branch\x20'+_0x26e316+_0xe0ff50(0x12c));return flosum_repository_sync_dto_1[_0xe0ff50(0xfb)][_0xe0ff50(0x13b)](_0x19e4f3);}async[a270_0x36ed97(0xf8)](_0x13c48a){const _0x375c85=a270_0x36ed97,_0x344b4d=await this[_0x375c85(0x12a)][_0x375c85(0x134)](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x375c85(0x14b)](_0x375c85(0x12f),_0x13c48a));if(_0x344b4d[_0x375c85(0x11b)]===0x0)throw new not_found_error_1[(_0x375c85(0x129))]('Repository\x20'+_0x13c48a+_0x375c85(0x12c));return flosum_repository_sync_dto_1[_0x375c85(0xfb)][_0x375c85(0x108)](_0x344b4d[0x0]);}async[a270_0x36ed97(0x110)](_0x774073){const _0x127119=a270_0x36ed97,_0x3f0e2e=_0x127119(0x148)+queries_1['GET_COMPONENTS_QUERY']+_0x127119(0x13e)+_0x774073+'\x27';return this[_0x127119(0x143)](_0x3f0e2e);}async[a270_0x36ed97(0x11e)](_0x433f48){const _0xc75531=a270_0x36ed97,_0x514065=_0xc75531(0x11d)+queries_1['GET_COMPONENTS_QUERY']+_0xc75531(0x136)+_0x433f48+'\x27';return this['getComponents'](_0x514065);}async[a270_0x36ed97(0x140)](_0xea7ee7){const _0x75e1aa=a270_0x36ed97;var _0x30e40e;const _0x4c5046=queries_1[_0x75e1aa(0x10d)][_0x75e1aa(0x14b)]('%parentId%',_0xea7ee7[_0x75e1aa(0x114)])[_0x75e1aa(0x14b)](_0x75e1aa(0x12f),_0xea7ee7['repositoryId']?constants_1[_0x75e1aa(0x115)]:constants_1[_0x75e1aa(0x109)]),_0x2cb72e=await this[_0x75e1aa(0x12a)]['query'](_0x4c5046),_0x1614fe=(_0x30e40e=_0x2cb72e[0x0])===null||_0x30e40e===void 0x0?void 0x0:_0x30e40e['Id'];if(!_0x1614fe)throw new Error(errors_1[_0x75e1aa(0xf9)]);return _0x1614fe;}async[a270_0x36ed97(0x116)](_0x23abdc){const _0x159939=a270_0x36ed97;let _0xaaa58d=await this[_0x159939(0x140)](_0x23abdc)['catch'](()=>null);return!_0xaaa58d&&(_0xaaa58d=await this['salesforceService'][_0x159939(0x124)](_0x159939(0x137),{'Body':(0x0,utils_1[_0x159939(0x128)])('{}'),'ParentId':_0x23abdc[_0x159939(0x114)],'ContentType':_0x159939(0x11a),'Name':_0x23abdc[_0x159939(0xfd)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0xaaa58d;}async[a270_0x36ed97(0x127)](_0x2c0e4b,_0x5981d5){const _0x10a2d3=a270_0x36ed97,_0x479498=await this['getRemoteStateAttachmentId'](_0x2c0e4b);await this[_0x10a2d3(0x12b)][_0x10a2d3(0x13d)](_0x10a2d3(0x137),_0x479498,{'Body':(0x0,utils_1[_0x10a2d3(0x128)])(JSON['stringify'](_0x5981d5))});}async[a270_0x36ed97(0x14e)](_0x3b0ae4,_0x336de5){const _0x5ebb13=a270_0x36ed97;await this[_0x5ebb13(0x12b)]['patchObject'](_0x3b0ae4['objectType'],_0x3b0ae4[_0x5ebb13(0x114)],{[constants_1[_0x5ebb13(0x112)]+_0x5ebb13(0xff)]:_0x336de5});}async[a270_0x36ed97(0x135)](_0x36ca52){const _0x461e88=a270_0x36ed97;await this['salesforceService']['patchObject'](constants_1[_0x461e88(0x112)]+'Connection__c',_0x36ca52,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x461e88(0x100)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a270_0x36ed97(0x113)])(),__metadata(a270_0x36ed97(0x11f),[salesforce_query_service_1[a270_0x36ed97(0x117)],salesforce_service_1[a270_0x36ed97(0x14d)]])],SalesforceSyncService),exports[a270_0x36ed97(0x122)]=SalesforceSyncService;