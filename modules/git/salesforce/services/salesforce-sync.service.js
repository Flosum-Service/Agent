const a204_0x2c05fa=a204_0x3dc5;(function(_0x495ee2,_0x5d71b3){const _0x15b9ee=a204_0x3dc5,_0x7dea31=_0x495ee2();while(!![]){try{const _0x16a4b5=parseInt(_0x15b9ee(0xc2))/0x1+parseInt(_0x15b9ee(0xf6))/0x2*(parseInt(_0x15b9ee(0xd5))/0x3)+parseInt(_0x15b9ee(0xe0))/0x4+parseInt(_0x15b9ee(0x116))/0x5+parseInt(_0x15b9ee(0xcd))/0x6+-parseInt(_0x15b9ee(0xc4))/0x7*(parseInt(_0x15b9ee(0xeb))/0x8)+-parseInt(_0x15b9ee(0x117))/0x9;if(_0x16a4b5===_0x5d71b3)break;else _0x7dea31['push'](_0x7dea31['shift']());}catch(_0x754996){_0x7dea31['push'](_0x7dea31['shift']());}}}(a204_0x3d4e,0xec633));const a204_0xdee90c=(function(){let _0x2d6945=!![];return function(_0x28d3a9,_0x4bfc63){const _0x37fb52=_0x2d6945?function(){const _0x382172=a204_0x3dc5;if(_0x4bfc63){const _0x1f9160=_0x4bfc63[_0x382172(0x104)](_0x28d3a9,arguments);return _0x4bfc63=null,_0x1f9160;}}:function(){};return _0x2d6945=![],_0x37fb52;};}()),a204_0x1e47f6=a204_0xdee90c(this,function(){const _0x17286a=a204_0x3dc5;return a204_0x1e47f6[_0x17286a(0xd8)]()[_0x17286a(0xd3)](_0x17286a(0x10a))[_0x17286a(0xd8)]()[_0x17286a(0xcb)](a204_0x1e47f6)[_0x17286a(0xd3)](_0x17286a(0x10a));});a204_0x1e47f6();function a204_0x3dc5(_0x1b88f3,_0x260802){const _0x4aedd0=a204_0x3d4e();return a204_0x3dc5=function(_0x1e47f6,_0xdee90c){_0x1e47f6=_0x1e47f6-0xb9;let _0x3d4e87=_0x4aedd0[_0x1e47f6];return _0x3d4e87;},a204_0x3dc5(_0x1b88f3,_0x260802);}'use strict';function a204_0x3d4e(){const _0x425d99=['\x20not\x20found\x20on\x20salesforce','encodeBase64','setStatus','Branch_Name__c','5793008xusjkZ','createObject','getAttachmentId','getRepositoryRecordByName','objectType','ERR_INVALID_ATTACHMENT_ID','GET_BRANCH_BY_NAME_QUERY','getComponents','GET_REPOSITORIES_NAMES_QUERY','replace','GET_REPOSITORY_QUERY','8oaNXlt','GET_WAITING_BRANCHES_QUERY','Repository\x20','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','getAllRepositoryNames','GET_REPOSITORY_BY_NAME_QUERY','metadata','Branch\x20with\x20Id\x20','__esModule','salesforceService','decorate','25468HxFvdx','getBranchRecords','../../../../constants/errors','../../../../constants','__decorate','FLOSUM_GIT_NAMESPACE','GET_WAITING_REPOSITORIES_QUERY','getRemoteStateAttachmentId','disableSync','%id%','./salesforce-query.service','push','GET_BRANCH_QUERY','length','apply','../dto/flosum-repository-sync.dto','SalesforceService','getRepositoryRecord','\x0a\x20\x20\x20\x20\x20\x20','Repository__r','(((.+)+)+)+$','%name%','../queries','getRepositoryRecords','../../../shared/utils','FlosumRepositorySyncDto','map','text/plain','__metadata','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getOwnPropertyDescriptor','fromBranchRecord','5762120AcuQXq','28365867SqDbXt','SalesforceSyncService','repositoryId','salesforceQuery','patchObject','Name','design:paramtypes','Sync_In_Progress__c','catch','FLOSUM_NAMESPACE','stringify','799493gXudyb','typedi','8644965NyXRgC','../errors/not-found.error','function','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','fromRepositoryRecord','Attachment','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','constructor','Repository\x20with\x20Id\x20','3630168Povabt','SYNC_ATTACHMENT_FOR_BRANCH_NAME','getBranchComponents','./salesforce.service','getBranchRecord','records','search','find','318zVFDTc','GET_COMPONENTS_QUERY','SalesforceNotFoundError','toString','Branch\x20','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','query'];a204_0x3d4e=function(){return _0x425d99;};return a204_0x3d4e();}var __decorate=this&&this[a204_0x2c05fa(0xfa)]||function(_0x307dd3,_0x3d6d57,_0x582f85,_0x375215){const _0x5b7b7a=a204_0x2c05fa;var _0x397e73=arguments[_0x5b7b7a(0x103)],_0x2f449b=_0x397e73<0x3?_0x3d6d57:_0x375215===null?_0x375215=Object[_0x5b7b7a(0x114)](_0x3d6d57,_0x582f85):_0x375215,_0x4ef915;if(typeof Reflect==='object'&&typeof Reflect[_0x5b7b7a(0xf5)]===_0x5b7b7a(0xc6))_0x2f449b=Reflect[_0x5b7b7a(0xf5)](_0x307dd3,_0x3d6d57,_0x582f85,_0x375215);else{for(var _0xca3496=_0x307dd3[_0x5b7b7a(0x103)]-0x1;_0xca3496>=0x0;_0xca3496--)if(_0x4ef915=_0x307dd3[_0xca3496])_0x2f449b=(_0x397e73<0x3?_0x4ef915(_0x2f449b):_0x397e73>0x3?_0x4ef915(_0x3d6d57,_0x582f85,_0x2f449b):_0x4ef915(_0x3d6d57,_0x582f85))||_0x2f449b;}return _0x397e73>0x3&&_0x2f449b&&Object['defineProperty'](_0x3d6d57,_0x582f85,_0x2f449b),_0x2f449b;},__metadata=this&&this[a204_0x2c05fa(0x112)]||function(_0x475ccc,_0x44d30f){const _0x3b1560=a204_0x2c05fa;if(typeof Reflect==='object'&&typeof Reflect[_0x3b1560(0xf1)]===_0x3b1560(0xc6))return Reflect['metadata'](_0x475ccc,_0x44d30f);};Object['defineProperty'](exports,a204_0x2c05fa(0xf3),{'value':!![]}),exports[a204_0x2c05fa(0x118)]=void 0x0;const typedi_1=require(a204_0x2c05fa(0xc3)),constants_1=require(a204_0x2c05fa(0xf9)),errors_1=require(a204_0x2c05fa(0xf8)),utils_1=require(a204_0x2c05fa(0x10e)),flosum_repository_sync_dto_1=require(a204_0x2c05fa(0x105)),not_found_error_1=require(a204_0x2c05fa(0xc5)),queries_1=require(a204_0x2c05fa(0x10c)),salesforce_query_service_1=require(a204_0x2c05fa(0x100)),salesforce_service_1=require(a204_0x2c05fa(0xd0));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x12bd53,_0xa60069){const _0x5dd581=a204_0x2c05fa;this[_0x5dd581(0xba)]=_0x12bd53,this['salesforceService']=_0xa60069;}async['getComponents'](_0xdcb755){const _0x45a197=a204_0x2c05fa;var _0x4ea011;const _0x389dd8=await this[_0x45a197(0xba)]['query'](_0xdcb755),_0x227782=[];for(const _0x4ee97e of _0x389dd8){const _0x17e2af=(_0x4ea011=_0x4ee97e[constants_1[_0x45a197(0xc0)]+'Components__r'])===null||_0x4ea011===void 0x0?void 0x0:_0x4ea011[_0x45a197(0xd2)];_0x17e2af&&_0x17e2af[_0x45a197(0x103)]&&_0x227782[_0x45a197(0x101)](_0x17e2af[0x0]['Id']);}return _0x227782;}async[a204_0x2c05fa(0xef)](_0x1b4ce9){const _0x1eaff3=a204_0x2c05fa,_0x170a53=await this['salesforceQuery'][_0x1eaff3(0xdb)](queries_1[_0x1eaff3(0xe8)][_0x1eaff3(0xe9)](/\%connection_id\%/g,_0x1b4ce9));return _0x170a53['map'](_0x4b7820=>{const _0x52bb80=_0x1eaff3;return _0x4b7820[constants_1[_0x52bb80(0xfb)]+_0x52bb80(0x109)]?_0x4b7820[constants_1[_0x52bb80(0xfb)]+_0x52bb80(0x109)][_0x52bb80(0xbc)]:_0x4b7820[_0x52bb80(0xbc)];});}async[a204_0x2c05fa(0x10d)](_0x2a6f2e){const _0x5bc481=a204_0x2c05fa,_0x5137c7=await this[_0x5bc481(0xba)][_0x5bc481(0xdb)](queries_1[_0x5bc481(0xfc)][_0x5bc481(0xe9)](/\%connection_id\%/g,_0x2a6f2e));return _0x5137c7[_0x5bc481(0x110)](_0x268376=>flosum_repository_sync_dto_1[_0x5bc481(0x10f)][_0x5bc481(0xc8)](_0x268376));}async[a204_0x2c05fa(0xf7)](_0x2c925c){const _0x27bf24=a204_0x2c05fa,_0x132766=await this[_0x27bf24(0xba)][_0x27bf24(0xdb)](queries_1[_0x27bf24(0xec)][_0x27bf24(0xe9)](/%repositories_ids\%/g,_0x2c925c));return _0x132766[_0x27bf24(0x110)](_0x19940d=>flosum_repository_sync_dto_1[_0x27bf24(0x10f)]['fromBranchRecord'](_0x19940d));}async[a204_0x2c05fa(0x107)](_0xcdc1f9){const _0x2c7527=a204_0x2c05fa,_0x24a7c0=await this[_0x2c7527(0xba)][_0x2c7527(0xdb)](queries_1[_0x2c7527(0xea)][_0x2c7527(0xe9)](_0x2c7527(0xff),_0xcdc1f9));if(_0x24a7c0['length']===0x0)throw new not_found_error_1[(_0x2c7527(0xd7))](_0x2c7527(0xcc)+_0xcdc1f9+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x2c7527(0xc8)](_0x24a7c0[0x0]);}async[a204_0x2c05fa(0xd1)](_0x35bcc8){const _0x24a8ff=a204_0x2c05fa,_0x3594c4=await this[_0x24a8ff(0xba)][_0x24a8ff(0xdb)](queries_1[_0x24a8ff(0x102)][_0x24a8ff(0xe9)](_0x24a8ff(0xff),_0x35bcc8));if(_0x3594c4[_0x24a8ff(0x103)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x24a8ff(0xf2)+_0x35bcc8+_0x24a8ff(0xdc));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x24a8ff(0x115)](_0x3594c4[0x0]);}async['getBranchRecordByName'](_0x3deed5){const _0x393ce3=a204_0x2c05fa,_0x454865=await this['salesforceQuery'][_0x393ce3(0xdb)](queries_1[_0x393ce3(0xe6)][_0x393ce3(0xe9)](_0x393ce3(0x10b),_0x3deed5));if(_0x454865['length']===0x0)throw new not_found_error_1[(_0x393ce3(0xd7))]('Branch\x20'+_0x3deed5+'\x20not\x20found\x20on\x20salesforce');const _0x33aa96=_0x454865[_0x393ce3(0xd4)](_0x476b28=>_0x476b28[constants_1['FLOSUM_NAMESPACE']+_0x393ce3(0xdf)]===_0x3deed5);if(!_0x33aa96)throw new not_found_error_1[(_0x393ce3(0xd7))](_0x393ce3(0xd9)+_0x3deed5+_0x393ce3(0xdc));return flosum_repository_sync_dto_1[_0x393ce3(0x10f)][_0x393ce3(0x115)](_0x33aa96);}async[a204_0x2c05fa(0xe3)](_0x575ca9){const _0x68c43c=a204_0x2c05fa,_0x31f5cf=await this['salesforceQuery'][_0x68c43c(0xdb)](queries_1[_0x68c43c(0xf0)]['replace'](_0x68c43c(0x10b),_0x575ca9));if(_0x31f5cf['length']===0x0)throw new not_found_error_1[(_0x68c43c(0xd7))](_0x68c43c(0xed)+_0x575ca9+_0x68c43c(0xdc));return flosum_repository_sync_dto_1[_0x68c43c(0x10f)]['fromRepositoryRecord'](_0x31f5cf[0x0]);}async['getComponentsFromRepository'](_0x1d96ae){const _0x5f50cf=a204_0x2c05fa,_0x453f94=_0x5f50cf(0x108)+queries_1[_0x5f50cf(0xd6)]+_0x5f50cf(0xee)+_0x1d96ae+'\x27';return this[_0x5f50cf(0xe7)](_0x453f94);}async[a204_0x2c05fa(0xcf)](_0x33ab7e){const _0x16b3ac=a204_0x2c05fa,_0x381be6=_0x16b3ac(0x113)+queries_1['GET_COMPONENTS_QUERY']+_0x16b3ac(0xca)+_0x33ab7e+'\x27';return this[_0x16b3ac(0xe7)](_0x381be6);}async[a204_0x2c05fa(0xe2)](_0x25528d){const _0x4d4900=a204_0x2c05fa;var _0x51a454;const _0x3d3708=queries_1[_0x4d4900(0xc7)][_0x4d4900(0xe9)]('%parentId%',_0x25528d['objectId'])['replace']('%name%',_0x25528d[_0x4d4900(0xb9)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x4d4900(0xce)]),_0x29cfe5=await this[_0x4d4900(0xba)]['query'](_0x3d3708),_0x11bf5b=(_0x51a454=_0x29cfe5[0x0])===null||_0x51a454===void 0x0?void 0x0:_0x51a454['Id'];if(!_0x11bf5b)throw new Error(errors_1[_0x4d4900(0xe5)]);return _0x11bf5b;}async[a204_0x2c05fa(0xfd)](_0x2cd377){const _0x1f7a9a=a204_0x2c05fa;let _0x534ef1=await this[_0x1f7a9a(0xe2)](_0x2cd377)[_0x1f7a9a(0xbf)](()=>null);return!_0x534ef1&&(_0x534ef1=await this[_0x1f7a9a(0xf4)][_0x1f7a9a(0xe1)]('Attachment',{'Body':(0x0,utils_1[_0x1f7a9a(0xdd)])('{}'),'ParentId':_0x2cd377['objectId'],'ContentType':_0x1f7a9a(0x111),'Name':_0x2cd377[_0x1f7a9a(0xb9)]?constants_1[_0x1f7a9a(0xda)]:constants_1[_0x1f7a9a(0xce)]})),_0x534ef1;}async['updateRemoteState'](_0x545913,_0x25db65){const _0x34b47b=a204_0x2c05fa,_0x40defc=await this['getRemoteStateAttachmentId'](_0x545913);await this['salesforceService'][_0x34b47b(0xbb)](_0x34b47b(0xc9),_0x40defc,{'Body':(0x0,utils_1[_0x34b47b(0xdd)])(JSON[_0x34b47b(0xc1)](_0x25db65))});}async[a204_0x2c05fa(0xde)](_0x388628,_0x16d044){const _0x23ef28=a204_0x2c05fa;await this[_0x23ef28(0xf4)]['patchObject'](_0x388628[_0x23ef28(0xe4)],_0x388628['objectId'],{[constants_1[_0x23ef28(0xfb)]+'Synchronization_Status__c']:_0x16d044});}async[a204_0x2c05fa(0xfe)](_0x7f1786){const _0x1ca3a0=a204_0x2c05fa;await this[_0x1ca3a0(0xf4)][_0x1ca3a0(0xbb)](constants_1['FLOSUM_GIT_NAMESPACE']+'Connection__c',_0x7f1786,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x1ca3a0(0xbe)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1['Service'])(),__metadata(a204_0x2c05fa(0xbd),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a204_0x2c05fa(0x106)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;