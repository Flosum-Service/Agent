const a280_0x3da5b6=a280_0x110e;(function(_0x1aacaf,_0x389923){const _0x3867a3=a280_0x110e,_0x1b90dc=_0x1aacaf();while(!![]){try{const _0x4fda01=-parseInt(_0x3867a3(0x1b0))/0x1+-parseInt(_0x3867a3(0x1a2))/0x2+parseInt(_0x3867a3(0x1d7))/0x3+parseInt(_0x3867a3(0x1a0))/0x4+parseInt(_0x3867a3(0x1d1))/0x5+parseInt(_0x3867a3(0x1ba))/0x6+-parseInt(_0x3867a3(0x19e))/0x7;if(_0x4fda01===_0x389923)break;else _0x1b90dc['push'](_0x1b90dc['shift']());}catch(_0x3d05de){_0x1b90dc['push'](_0x1b90dc['shift']());}}}(a280_0x4bc8,0x7f896));function a280_0x4bc8(){const _0x2c2f63=['%name%','fromRepositoryRecord','Branch_Name__c','GET_BRANCH_BY_NAME_QUERY','./salesforce-query.service','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Branch\x20with\x20Id\x20','__metadata','search','text/plain','Name','./salesforce.service','replace','../queries','metadata','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','updateRemoteState','ERR_INVALID_ATTACHMENT_ID','createObject','getAttachmentId','3718120CkDGiJ','GET_BRANCH_QUERY','555144AVqXCw','length','824324tpGufJ','patchObject','\x20not\x20found\x20on\x20salesforce','objectType','function','Components__r','Repository\x20with\x20Id\x20','%parentId%','../../../../constants','Service','FLOSUM_GIT_NAMESPACE','getBranchComponents','object','typedi','741199kpMyMP','salesforceService','__decorate','decorate','salesforceQuery','SalesforceSyncService','FLOSUM_NAMESPACE','GET_WAITING_BRANCHES_QUERY','getAllRepositoryNames','query','689634tPrtMz','getComponents','Repository__r','Attachment','Connection__c','FlosumRepositorySyncDto','stringify','getOwnPropertyDescriptor','../errors/not-found.error','GET_REPOSITORIES_NAMES_QUERY','map','GET_REPOSITORY_BY_NAME_QUERY','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','GET_REPOSITORY_QUERY','repositoryId','SalesforceNotFoundError','__esModule','Sync_In_Progress__c','../../../../constants/errors','find','getComponentsFromRepository','getBranchRecordByName','disableSync','5171380UoPoEs','push','SalesforceQueryService','GET_COMPONENTS_QUERY','fromBranchRecord','encodeBase64','2756730DCmWWM','design:paramtypes','%id%','../dto/flosum-repository-sync.dto','getRemoteStateAttachmentId','setStatus','defineProperty','apply','constructor','objectId','catch','records','\x0a\x20\x20\x20\x20\x20\x20','(((.+)+)+)+$'];a280_0x4bc8=function(){return _0x2c2f63;};return a280_0x4bc8();}function a280_0x110e(_0x418b0d,_0x1f04e8){const _0x5290b0=a280_0x4bc8();return a280_0x110e=function(_0x3a6233,_0x5f18ba){_0x3a6233=_0x3a6233-0x18b;let _0x4bc816=_0x5290b0[_0x3a6233];return _0x4bc816;},a280_0x110e(_0x418b0d,_0x1f04e8);}const a280_0x5f18ba=(function(){let _0x49cef2=!![];return function(_0x50b1c0,_0x5008a8){const _0x5c137d=_0x49cef2?function(){const _0xb8e7db=a280_0x110e;if(_0x5008a8){const _0x56ee21=_0x5008a8[_0xb8e7db(0x1de)](_0x50b1c0,arguments);return _0x5008a8=null,_0x56ee21;}}:function(){};return _0x49cef2=![],_0x5c137d;};}()),a280_0x3a6233=a280_0x5f18ba(this,function(){const _0x4267a6=a280_0x110e;return a280_0x3a6233['toString']()[_0x4267a6(0x192)](_0x4267a6(0x1e4))['toString']()[_0x4267a6(0x1df)](a280_0x3a6233)[_0x4267a6(0x192)](_0x4267a6(0x1e4));});a280_0x3a6233();'use strict';var __decorate=this&&this[a280_0x3da5b6(0x1b2)]||function(_0x4c2012,_0x5a352f,_0x3b8514,_0x4eed07){const _0x452897=a280_0x3da5b6;var _0x2125b4=arguments[_0x452897(0x1a1)],_0x5b1bbe=_0x2125b4<0x3?_0x5a352f:_0x4eed07===null?_0x4eed07=Object[_0x452897(0x1c1)](_0x5a352f,_0x3b8514):_0x4eed07,_0xa8839a;if(typeof Reflect===_0x452897(0x1ae)&&typeof Reflect[_0x452897(0x1b3)]===_0x452897(0x1a6))_0x5b1bbe=Reflect['decorate'](_0x4c2012,_0x5a352f,_0x3b8514,_0x4eed07);else{for(var _0x492ada=_0x4c2012[_0x452897(0x1a1)]-0x1;_0x492ada>=0x0;_0x492ada--)if(_0xa8839a=_0x4c2012[_0x492ada])_0x5b1bbe=(_0x2125b4<0x3?_0xa8839a(_0x5b1bbe):_0x2125b4>0x3?_0xa8839a(_0x5a352f,_0x3b8514,_0x5b1bbe):_0xa8839a(_0x5a352f,_0x3b8514))||_0x5b1bbe;}return _0x2125b4>0x3&&_0x5b1bbe&&Object[_0x452897(0x1dd)](_0x5a352f,_0x3b8514,_0x5b1bbe),_0x5b1bbe;},__metadata=this&&this[a280_0x3da5b6(0x191)]||function(_0x46c4e4,_0xf75474){const _0x1d80e7=a280_0x3da5b6;if(typeof Reflect===_0x1d80e7(0x1ae)&&typeof Reflect[_0x1d80e7(0x198)]===_0x1d80e7(0x1a6))return Reflect[_0x1d80e7(0x198)](_0x46c4e4,_0xf75474);};Object[a280_0x3da5b6(0x1dd)](exports,a280_0x3da5b6(0x1ca),{'value':!![]}),exports[a280_0x3da5b6(0x1b5)]=void 0x0;const typedi_1=require(a280_0x3da5b6(0x1af)),constants_1=require(a280_0x3da5b6(0x1aa)),errors_1=require(a280_0x3da5b6(0x1cc)),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a280_0x3da5b6(0x1da)),not_found_error_1=require(a280_0x3da5b6(0x1c2)),queries_1=require(a280_0x3da5b6(0x197)),salesforce_query_service_1=require(a280_0x3da5b6(0x18e)),salesforce_service_1=require(a280_0x3da5b6(0x195));let SalesforceSyncService=class SalesforceSyncService{constructor(_0xbb0b87,_0x511cef){const _0x36745e=a280_0x3da5b6;this[_0x36745e(0x1b4)]=_0xbb0b87,this[_0x36745e(0x1b1)]=_0x511cef;}async[a280_0x3da5b6(0x1bb)](_0x414c79){const _0x324485=a280_0x3da5b6;var _0x51c3b2;const _0x3d7349=await this['salesforceQuery'][_0x324485(0x1b9)](_0x414c79),_0x51d3fa=[];for(const _0xa8b9bd of _0x3d7349){const _0x4896f3=(_0x51c3b2=_0xa8b9bd[constants_1[_0x324485(0x1b6)]+_0x324485(0x1a7)])===null||_0x51c3b2===void 0x0?void 0x0:_0x51c3b2[_0x324485(0x1e2)];_0x4896f3&&_0x4896f3[_0x324485(0x1a1)]&&_0x51d3fa[_0x324485(0x1d2)](_0x4896f3[0x0]['Id']);}return _0x51d3fa;}async[a280_0x3da5b6(0x1b8)](_0x3183bf){const _0x52e32c=a280_0x3da5b6,_0xd4704f=await this['salesforceQuery'][_0x52e32c(0x1b9)](queries_1[_0x52e32c(0x1c3)][_0x52e32c(0x196)](/\%connection_id\%/g,_0x3183bf));return _0xd4704f[_0x52e32c(0x1c4)](_0x1dd6c3=>{const _0x34075e=_0x52e32c;return _0x1dd6c3[constants_1[_0x34075e(0x1ac)]+_0x34075e(0x1bc)]?_0x1dd6c3[constants_1[_0x34075e(0x1ac)]+_0x34075e(0x1bc)][_0x34075e(0x194)]:_0x1dd6c3[_0x34075e(0x194)];});}async['getRepositoryRecords'](_0x30d65f){const _0x39f4f1=a280_0x3da5b6,_0x272c05=await this[_0x39f4f1(0x1b4)]['query'](queries_1['GET_WAITING_REPOSITORIES_QUERY']['replace'](/\%connection_id\%/g,_0x30d65f));return _0x272c05[_0x39f4f1(0x1c4)](_0x269360=>flosum_repository_sync_dto_1[_0x39f4f1(0x1bf)][_0x39f4f1(0x18b)](_0x269360));}async['getBranchRecords'](_0x210c0e){const _0x270771=a280_0x3da5b6,_0x3804d5=await this['salesforceQuery'][_0x270771(0x1b9)](queries_1[_0x270771(0x1b7)]['replace'](/%repositories_ids\%/g,_0x210c0e));return _0x3804d5['map'](_0x55f6ab=>flosum_repository_sync_dto_1[_0x270771(0x1bf)][_0x270771(0x1d5)](_0x55f6ab));}async['getRepositoryRecord'](_0x334e39){const _0x1eccc1=a280_0x3da5b6,_0x25b7fa=await this[_0x1eccc1(0x1b4)][_0x1eccc1(0x1b9)](queries_1[_0x1eccc1(0x1c7)][_0x1eccc1(0x196)](_0x1eccc1(0x1d9),_0x334e39));if(_0x25b7fa['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x1eccc1(0x1a8)+_0x334e39+_0x1eccc1(0x1a4));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x1eccc1(0x18b)](_0x25b7fa[0x0]);}async['getBranchRecord'](_0x4726eb){const _0x4d5e3a=a280_0x3da5b6,_0x286a47=await this[_0x4d5e3a(0x1b4)][_0x4d5e3a(0x1b9)](queries_1[_0x4d5e3a(0x19f)][_0x4d5e3a(0x196)](_0x4d5e3a(0x1d9),_0x4726eb));if(_0x286a47[_0x4d5e3a(0x1a1)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x4d5e3a(0x190)+_0x4726eb+_0x4d5e3a(0x1a4));return flosum_repository_sync_dto_1[_0x4d5e3a(0x1bf)][_0x4d5e3a(0x1d5)](_0x286a47[0x0]);}async[a280_0x3da5b6(0x1cf)](_0x40819f){const _0x344956=a280_0x3da5b6,_0xd827ba=await this[_0x344956(0x1b4)][_0x344956(0x1b9)](queries_1[_0x344956(0x18d)][_0x344956(0x196)](_0x344956(0x1e5),_0x40819f));if(_0xd827ba[_0x344956(0x1a1)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x40819f+'\x20not\x20found\x20on\x20salesforce');const _0x29d933=_0xd827ba[_0x344956(0x1cd)](_0xbe62cb=>_0xbe62cb[constants_1[_0x344956(0x1b6)]+_0x344956(0x18c)]===_0x40819f);if(!_0x29d933)throw new not_found_error_1[(_0x344956(0x1c9))]('Branch\x20'+_0x40819f+_0x344956(0x1a4));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x344956(0x1d5)](_0x29d933);}async['getRepositoryRecordByName'](_0x3e5a95){const _0x56f16a=a280_0x3da5b6,_0x341e5f=await this['salesforceQuery'][_0x56f16a(0x1b9)](queries_1[_0x56f16a(0x1c5)]['replace'](_0x56f16a(0x1e5),_0x3e5a95));if(_0x341e5f[_0x56f16a(0x1a1)]===0x0)throw new not_found_error_1[(_0x56f16a(0x1c9))]('Repository\x20'+_0x3e5a95+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x56f16a(0x1bf)][_0x56f16a(0x18b)](_0x341e5f[0x0]);}async[a280_0x3da5b6(0x1ce)](_0x112e8c){const _0x56ae8b=a280_0x3da5b6,_0x2af72a=_0x56ae8b(0x1e3)+queries_1[_0x56ae8b(0x1d4)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x112e8c+'\x27';return this[_0x56ae8b(0x1bb)](_0x2af72a);}async[a280_0x3da5b6(0x1ad)](_0x4e4a0d){const _0x4d29be=a280_0x3da5b6,_0x2bcbf8=_0x4d29be(0x18f)+queries_1[_0x4d29be(0x1d4)]+_0x4d29be(0x1c6)+_0x4e4a0d+'\x27';return this['getComponents'](_0x2bcbf8);}async[a280_0x3da5b6(0x19d)](_0x1f2e0e){const _0x4bd1c1=a280_0x3da5b6;var _0x3ce00b;const _0x23019d=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY']['replace'](_0x4bd1c1(0x1a9),_0x1f2e0e[_0x4bd1c1(0x1e0)])[_0x4bd1c1(0x196)](_0x4bd1c1(0x1e5),_0x1f2e0e[_0x4bd1c1(0x1c8)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x5067d0=await this[_0x4bd1c1(0x1b4)][_0x4bd1c1(0x1b9)](_0x23019d),_0x4ed526=(_0x3ce00b=_0x5067d0[0x0])===null||_0x3ce00b===void 0x0?void 0x0:_0x3ce00b['Id'];if(!_0x4ed526)throw new Error(errors_1[_0x4bd1c1(0x19b)]);return _0x4ed526;}async[a280_0x3da5b6(0x1db)](_0x2bf7cc){const _0x1cde24=a280_0x3da5b6;let _0x49957c=await this[_0x1cde24(0x19d)](_0x2bf7cc)[_0x1cde24(0x1e1)](()=>null);return!_0x49957c&&(_0x49957c=await this['salesforceService'][_0x1cde24(0x19c)]('Attachment',{'Body':(0x0,utils_1[_0x1cde24(0x1d6)])('{}'),'ParentId':_0x2bf7cc[_0x1cde24(0x1e0)],'ContentType':_0x1cde24(0x193),'Name':_0x2bf7cc['repositoryId']?constants_1[_0x1cde24(0x199)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x49957c;}async[a280_0x3da5b6(0x19a)](_0x57d8ba,_0x1940e3){const _0x308e3b=a280_0x3da5b6,_0xbda7fb=await this[_0x308e3b(0x1db)](_0x57d8ba);await this[_0x308e3b(0x1b1)][_0x308e3b(0x1a3)](_0x308e3b(0x1bd),_0xbda7fb,{'Body':(0x0,utils_1[_0x308e3b(0x1d6)])(JSON[_0x308e3b(0x1c0)](_0x1940e3))});}async[a280_0x3da5b6(0x1dc)](_0x4d7a3e,_0x5ba533){const _0x1c050e=a280_0x3da5b6;await this[_0x1c050e(0x1b1)]['patchObject'](_0x4d7a3e[_0x1c050e(0x1a5)],_0x4d7a3e[_0x1c050e(0x1e0)],{[constants_1['FLOSUM_GIT_NAMESPACE']+'Synchronization_Status__c']:_0x5ba533});}async[a280_0x3da5b6(0x1d0)](_0x1c15b0){const _0x1a4d3a=a280_0x3da5b6;await this['salesforceService']['patchObject'](constants_1[_0x1a4d3a(0x1ac)]+_0x1a4d3a(0x1be),_0x1c15b0,{[constants_1[_0x1a4d3a(0x1ac)]+_0x1a4d3a(0x1cb)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a280_0x3da5b6(0x1ab)])(),__metadata(a280_0x3da5b6(0x1d8),[salesforce_query_service_1[a280_0x3da5b6(0x1d3)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports[a280_0x3da5b6(0x1b5)]=SalesforceSyncService;