const a238_0x478fd4=a238_0x4728;(function(_0x4ffaae,_0x39a86d){const _0x4bc465=a238_0x4728,_0x84a5e=_0x4ffaae();while(!![]){try{const _0x1a7c80=-parseInt(_0x4bc465(0x1fb))/0x1+-parseInt(_0x4bc465(0x1f5))/0x2*(parseInt(_0x4bc465(0x1d6))/0x3)+parseInt(_0x4bc465(0x1ca))/0x4*(-parseInt(_0x4bc465(0x1c3))/0x5)+-parseInt(_0x4bc465(0x1d7))/0x6+-parseInt(_0x4bc465(0x1b7))/0x7*(parseInt(_0x4bc465(0x1cf))/0x8)+parseInt(_0x4bc465(0x1d9))/0x9+-parseInt(_0x4bc465(0x1ce))/0xa*(-parseInt(_0x4bc465(0x1c1))/0xb);if(_0x1a7c80===_0x39a86d)break;else _0x84a5e['push'](_0x84a5e['shift']());}catch(_0x3929ed){_0x84a5e['push'](_0x84a5e['shift']());}}}(a238_0x5c64,0xaaad5));const a238_0x337aa9=(function(){let _0x1b6248=!![];return function(_0x3de1cb,_0x480c9e){const _0x3127f9=_0x1b6248?function(){const _0xe228a2=a238_0x4728;if(_0x480c9e){const _0x3a9c39=_0x480c9e[_0xe228a2(0x1ec)](_0x3de1cb,arguments);return _0x480c9e=null,_0x3a9c39;}}:function(){};return _0x1b6248=![],_0x3127f9;};}()),a238_0x1eda99=a238_0x337aa9(this,function(){const _0x12110c=a238_0x4728;return a238_0x1eda99[_0x12110c(0x1ac)]()[_0x12110c(0x1a9)](_0x12110c(0x1d5))['toString']()['constructor'](a238_0x1eda99)[_0x12110c(0x1a9)](_0x12110c(0x1d5));});a238_0x1eda99();'use strict';var __decorate=this&&this[a238_0x478fd4(0x1e6)]||function(_0xbe21bc,_0x4136dc,_0x38c697,_0x44b728){const _0x1c13f3=a238_0x478fd4;var _0x577ef4=arguments[_0x1c13f3(0x1e3)],_0x4d4435=_0x577ef4<0x3?_0x4136dc:_0x44b728===null?_0x44b728=Object[_0x1c13f3(0x1b0)](_0x4136dc,_0x38c697):_0x44b728,_0x2d9282;if(typeof Reflect===_0x1c13f3(0x1e0)&&typeof Reflect['decorate']===_0x1c13f3(0x1be))_0x4d4435=Reflect[_0x1c13f3(0x1f1)](_0xbe21bc,_0x4136dc,_0x38c697,_0x44b728);else{for(var _0x55b21c=_0xbe21bc[_0x1c13f3(0x1e3)]-0x1;_0x55b21c>=0x0;_0x55b21c--)if(_0x2d9282=_0xbe21bc[_0x55b21c])_0x4d4435=(_0x577ef4<0x3?_0x2d9282(_0x4d4435):_0x577ef4>0x3?_0x2d9282(_0x4136dc,_0x38c697,_0x4d4435):_0x2d9282(_0x4136dc,_0x38c697))||_0x4d4435;}return _0x577ef4>0x3&&_0x4d4435&&Object[_0x1c13f3(0x1c7)](_0x4136dc,_0x38c697,_0x4d4435),_0x4d4435;},__metadata=this&&this['__metadata']||function(_0x1d252c,_0x4bd640){const _0x3fbd54=a238_0x478fd4;if(typeof Reflect==='object'&&typeof Reflect[_0x3fbd54(0x1ee)]===_0x3fbd54(0x1be))return Reflect[_0x3fbd54(0x1ee)](_0x1d252c,_0x4bd640);};Object[a238_0x478fd4(0x1c7)](exports,a238_0x478fd4(0x1c9),{'value':!![]}),exports[a238_0x478fd4(0x1d4)]=void 0x0;function a238_0x5c64(){const _0xff5d10=['\x0a\x20\x20\x20\x20\x20\x20','23505940ZCKSaD','1070776adIrKs','salesforceQuery','catch','../errors/not-found.error','repositoryId','SalesforceSyncService','(((.+)+)+)+$','666Ockkds','3716910xfiyFr','SalesforceService','10782090OjvnYN','query','Components__r','Repository__r','./salesforce-query.service','../dto/flosum-repository-sync.dto','Repository\x20','object','GET_WAITING_REPOSITORIES_QUERY','salesforceService','length','../../../../constants','ERR_INVALID_ATTACHMENT_ID','__decorate','Attachment','SalesforceNotFoundError','FLOSUM_NAMESPACE','find','GET_REPOSITORY_QUERY','apply','getBranchRecord','metadata','Branch\x20','%name%','decorate','\x20not\x20found\x20on\x20salesforce','../queries','createObject','12164iNDQhK','getRepositoryRecords','%id%','../../../shared/utils','Sync_In_Progress__c','patchObject','1319969bvHRRf','Branch_Name__c','getComponents','updateRemoteState','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','design:paramtypes','FlosumRepositorySyncDto','objectId','map','search','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','getRepositoryRecordByName','toString','fromBranchRecord','Synchronization_Status__c','getRemoteStateAttachmentId','getOwnPropertyDescriptor','Name','encodeBase64','Repository\x20with\x20Id\x20','./salesforce.service','../../../../constants/errors','GET_COMPONENTS_QUERY','56QMaveq','%parentId%','fromRepositoryRecord','replace','GET_REPOSITORY_BY_NAME_QUERY','getRepositoryRecord','GET_WAITING_BRANCHES_QUERY','function','GET_REPOSITORIES_NAMES_QUERY','getBranchRecordByName','22nTWvMx','Connection__c','5etcBKM','Branch\x20with\x20Id\x20','getAttachmentId','GET_BRANCH_BY_NAME_QUERY','defineProperty','FLOSUM_GIT_NAMESPACE','__esModule','3358684dKnGnN','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','SYNC_ATTACHMENT_FOR_BRANCH_NAME'];a238_0x5c64=function(){return _0xff5d10;};return a238_0x5c64();}function a238_0x4728(_0x465b40,_0x55fb8f){const _0x21921a=a238_0x5c64();return a238_0x4728=function(_0x1eda99,_0x337aa9){_0x1eda99=_0x1eda99-0x1a6;let _0x5c64ac=_0x21921a[_0x1eda99];return _0x5c64ac;},a238_0x4728(_0x465b40,_0x55fb8f);}const typedi_1=require('typedi'),constants_1=require(a238_0x478fd4(0x1e4)),errors_1=require(a238_0x478fd4(0x1b5)),utils_1=require(a238_0x478fd4(0x1f8)),flosum_repository_sync_dto_1=require(a238_0x478fd4(0x1de)),not_found_error_1=require(a238_0x478fd4(0x1d2)),queries_1=require(a238_0x478fd4(0x1f3)),salesforce_query_service_1=require(a238_0x478fd4(0x1dd)),salesforce_service_1=require(a238_0x478fd4(0x1b4));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x130fc6,_0x243cdd){const _0x145f0e=a238_0x478fd4;this[_0x145f0e(0x1d0)]=_0x130fc6,this[_0x145f0e(0x1e2)]=_0x243cdd;}async[a238_0x478fd4(0x1fd)](_0x5c244e){const _0x8fe090=a238_0x478fd4;var _0x29e622;const _0x7084e0=await this[_0x8fe090(0x1d0)][_0x8fe090(0x1da)](_0x5c244e),_0x5c4e55=[];for(const _0x1279b5 of _0x7084e0){const _0x2c0360=(_0x29e622=_0x1279b5[constants_1[_0x8fe090(0x1e9)]+_0x8fe090(0x1db)])===null||_0x29e622===void 0x0?void 0x0:_0x29e622['records'];_0x2c0360&&_0x2c0360['length']&&_0x5c4e55['push'](_0x2c0360[0x0]['Id']);}return _0x5c4e55;}async['getAllRepositoryNames'](_0x1314b1){const _0x2e3506=a238_0x478fd4,_0x3bf40c=await this[_0x2e3506(0x1d0)][_0x2e3506(0x1da)](queries_1[_0x2e3506(0x1bf)][_0x2e3506(0x1ba)](/\%connection_id\%/g,_0x1314b1));return _0x3bf40c[_0x2e3506(0x1a8)](_0x50322d=>{const _0x1ed1b9=_0x2e3506;return _0x50322d[constants_1[_0x1ed1b9(0x1c8)]+_0x1ed1b9(0x1dc)]?_0x50322d[constants_1[_0x1ed1b9(0x1c8)]+'Repository__r'][_0x1ed1b9(0x1b1)]:_0x50322d[_0x1ed1b9(0x1b1)];});}async[a238_0x478fd4(0x1f6)](_0xf01c4a){const _0x239f94=a238_0x478fd4,_0x474086=await this['salesforceQuery'][_0x239f94(0x1da)](queries_1[_0x239f94(0x1e1)][_0x239f94(0x1ba)](/\%connection_id\%/g,_0xf01c4a));return _0x474086[_0x239f94(0x1a8)](_0x39ac80=>flosum_repository_sync_dto_1[_0x239f94(0x1a6)]['fromRepositoryRecord'](_0x39ac80));}async['getBranchRecords'](_0x117c57){const _0x48eb8c=a238_0x478fd4,_0x2ca6ab=await this[_0x48eb8c(0x1d0)]['query'](queries_1[_0x48eb8c(0x1bd)]['replace'](/%repositories_ids\%/g,_0x117c57));return _0x2ca6ab['map'](_0x596d14=>flosum_repository_sync_dto_1[_0x48eb8c(0x1a6)]['fromBranchRecord'](_0x596d14));}async[a238_0x478fd4(0x1bc)](_0x2d5b16){const _0x2141da=a238_0x478fd4,_0x34e5a8=await this[_0x2141da(0x1d0)][_0x2141da(0x1da)](queries_1[_0x2141da(0x1eb)][_0x2141da(0x1ba)](_0x2141da(0x1f7),_0x2d5b16));if(_0x34e5a8[_0x2141da(0x1e3)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x2141da(0x1b3)+_0x2d5b16+_0x2141da(0x1f2));return flosum_repository_sync_dto_1[_0x2141da(0x1a6)][_0x2141da(0x1b9)](_0x34e5a8[0x0]);}async[a238_0x478fd4(0x1ed)](_0xec8b33){const _0x4610f5=a238_0x478fd4,_0x29cd99=await this[_0x4610f5(0x1d0)][_0x4610f5(0x1da)](queries_1['GET_BRANCH_QUERY'][_0x4610f5(0x1ba)](_0x4610f5(0x1f7),_0xec8b33));if(_0x29cd99[_0x4610f5(0x1e3)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x4610f5(0x1c4)+_0xec8b33+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x4610f5(0x1a6)]['fromBranchRecord'](_0x29cd99[0x0]);}async[a238_0x478fd4(0x1c0)](_0x4cbe08){const _0x215d34=a238_0x478fd4,_0x295b04=await this['salesforceQuery'][_0x215d34(0x1da)](queries_1[_0x215d34(0x1c6)]['replace'](_0x215d34(0x1f0),_0x4cbe08));if(_0x295b04[_0x215d34(0x1e3)]===0x0)throw new not_found_error_1[(_0x215d34(0x1e8))](_0x215d34(0x1ef)+_0x4cbe08+'\x20not\x20found\x20on\x20salesforce');const _0x463216=_0x295b04[_0x215d34(0x1ea)](_0x46731d=>_0x46731d[constants_1[_0x215d34(0x1e9)]+_0x215d34(0x1fc)]===_0x4cbe08);if(!_0x463216)throw new not_found_error_1[(_0x215d34(0x1e8))]('Branch\x20'+_0x4cbe08+_0x215d34(0x1f2));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x215d34(0x1ad)](_0x463216);}async[a238_0x478fd4(0x1ab)](_0x5b252){const _0x5be3c8=a238_0x478fd4,_0x1045af=await this[_0x5be3c8(0x1d0)][_0x5be3c8(0x1da)](queries_1[_0x5be3c8(0x1bb)][_0x5be3c8(0x1ba)](_0x5be3c8(0x1f0),_0x5b252));if(_0x1045af[_0x5be3c8(0x1e3)]===0x0)throw new not_found_error_1[(_0x5be3c8(0x1e8))](_0x5be3c8(0x1df)+_0x5b252+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x5be3c8(0x1a6)][_0x5be3c8(0x1b9)](_0x1045af[0x0]);}async['getComponentsFromRepository'](_0x4f6a76){const _0x3e305a=a238_0x478fd4,_0x1fafa5=_0x3e305a(0x1cd)+queries_1[_0x3e305a(0x1b6)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x4f6a76+'\x27';return this[_0x3e305a(0x1fd)](_0x1fafa5);}async['getBranchComponents'](_0x379b03){const _0x3827ad=a238_0x478fd4,_0x3c637e=_0x3827ad(0x1cb)+queries_1[_0x3827ad(0x1b6)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x379b03+'\x27';return this[_0x3827ad(0x1fd)](_0x3c637e);}async[a238_0x478fd4(0x1c5)](_0x4ff79b){const _0x1e1c24=a238_0x478fd4;var _0x3d0b34;const _0x1d1d21=queries_1[_0x1e1c24(0x1aa)]['replace'](_0x1e1c24(0x1b8),_0x4ff79b['objectId'])[_0x1e1c24(0x1ba)](_0x1e1c24(0x1f0),_0x4ff79b[_0x1e1c24(0x1d3)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x3f303c=await this[_0x1e1c24(0x1d0)][_0x1e1c24(0x1da)](_0x1d1d21),_0x1edaae=(_0x3d0b34=_0x3f303c[0x0])===null||_0x3d0b34===void 0x0?void 0x0:_0x3d0b34['Id'];if(!_0x1edaae)throw new Error(errors_1[_0x1e1c24(0x1e5)]);return _0x1edaae;}async[a238_0x478fd4(0x1af)](_0x47f6a8){const _0x11a5a2=a238_0x478fd4;let _0x43e595=await this[_0x11a5a2(0x1c5)](_0x47f6a8)[_0x11a5a2(0x1d1)](()=>null);return!_0x43e595&&(_0x43e595=await this[_0x11a5a2(0x1e2)][_0x11a5a2(0x1f4)](_0x11a5a2(0x1e7),{'Body':(0x0,utils_1[_0x11a5a2(0x1b2)])('{}'),'ParentId':_0x47f6a8[_0x11a5a2(0x1a7)],'ContentType':'text/plain','Name':_0x47f6a8[_0x11a5a2(0x1d3)]?constants_1[_0x11a5a2(0x1ff)]:constants_1[_0x11a5a2(0x1cc)]})),_0x43e595;}async[a238_0x478fd4(0x1fe)](_0x3dac17,_0x322b82){const _0x50da9f=a238_0x478fd4,_0x4143d0=await this[_0x50da9f(0x1af)](_0x3dac17);await this['salesforceService']['patchObject'](_0x50da9f(0x1e7),_0x4143d0,{'Body':(0x0,utils_1['encodeBase64'])(JSON['stringify'](_0x322b82))});}async['setStatus'](_0x9125f6,_0x393e19){const _0x194844=a238_0x478fd4;await this[_0x194844(0x1e2)][_0x194844(0x1fa)](_0x9125f6['objectType'],_0x9125f6[_0x194844(0x1a7)],{[constants_1[_0x194844(0x1c8)]+_0x194844(0x1ae)]:_0x393e19});}async['disableSync'](_0x1cb859){const _0x5ad90c=a238_0x478fd4;await this[_0x5ad90c(0x1e2)][_0x5ad90c(0x1fa)](constants_1[_0x5ad90c(0x1c8)]+_0x5ad90c(0x1c2),_0x1cb859,{[constants_1[_0x5ad90c(0x1c8)]+_0x5ad90c(0x1f9)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1['Service'])(),__metadata(a238_0x478fd4(0x200),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a238_0x478fd4(0x1d8)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;