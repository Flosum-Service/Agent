const a237_0x398231=a237_0x38f9;(function(_0x10ca0e,_0x3473a6){const _0x2a80c8=a237_0x38f9,_0x392b0b=_0x10ca0e();while(!![]){try{const _0x375154=-parseInt(_0x2a80c8(0xb4))/0x1*(-parseInt(_0x2a80c8(0xd1))/0x2)+-parseInt(_0x2a80c8(0xf0))/0x3*(parseInt(_0x2a80c8(0xab))/0x4)+parseInt(_0x2a80c8(0x104))/0x5*(-parseInt(_0x2a80c8(0xaf))/0x6)+-parseInt(_0x2a80c8(0xc7))/0x7+-parseInt(_0x2a80c8(0xfb))/0x8*(-parseInt(_0x2a80c8(0xb7))/0x9)+-parseInt(_0x2a80c8(0xb0))/0xa*(-parseInt(_0x2a80c8(0xfc))/0xb)+parseInt(_0x2a80c8(0x10a))/0xc;if(_0x375154===_0x3473a6)break;else _0x392b0b['push'](_0x392b0b['shift']());}catch(_0x3ed274){_0x392b0b['push'](_0x392b0b['shift']());}}}(a237_0x3373,0xc4cf3));const a237_0x518d3a=(function(){let _0x4fa392=!![];return function(_0x3f6d4f,_0xbd5b9a){const _0x54a49f=_0x4fa392?function(){const _0x31ac61=a237_0x38f9;if(_0xbd5b9a){const _0x1ae450=_0xbd5b9a[_0x31ac61(0xb2)](_0x3f6d4f,arguments);return _0xbd5b9a=null,_0x1ae450;}}:function(){};return _0x4fa392=![],_0x54a49f;};}()),a237_0x37aa8b=a237_0x518d3a(this,function(){const _0x14c512=a237_0x38f9;return a237_0x37aa8b[_0x14c512(0x109)]()[_0x14c512(0xe3)](_0x14c512(0xe2))[_0x14c512(0x109)]()[_0x14c512(0xd9)](a237_0x37aa8b)[_0x14c512(0xe3)](_0x14c512(0xe2));});a237_0x37aa8b();function a237_0x3373(){const _0x559e53=['\x0a\x20\x20\x20\x20\x20\x20','fromRepositoryRecord','4071825Jweebg','find','__esModule','records','Repository\x20with\x20Id\x20','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','SalesforceNotFoundError','__metadata','GET_WAITING_REPOSITORIES_QUERY','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','GET_REPOSITORIES_NAMES_QUERY','encodeBase64','length','getBranchRecordByName','GET_REPOSITORY_BY_NAME_QUERY','6332571SuNVQu','object','Repository\x20','push','function','GET_BRANCH_BY_NAME_QUERY','defineProperty','FLOSUM_GIT_NAMESPACE','Components__r','Branch\x20','19240WzYOvt','getBranchRecord','../queries','disableSync','%id%','%parentId%','Synchronization_Status__c','GET_BRANCH_QUERY','constructor','GET_REPOSITORY_QUERY','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getBranchComponents','Branch\x20with\x20Id\x20','map','updateRemoteState','../../../../constants/errors','decorate','(((.+)+)+)+$','search','salesforceService','Attachment','objectType','Name','getRepositoryRecord','SYNC_ATTACHMENT_FOR_BRANCH_NAME','\x20not\x20found\x20on\x20salesforce','getOwnPropertyDescriptor','metadata','getRepositoryRecords','getAttachmentId','getBranchRecords','6fRvIXk','FlosumRepositorySyncDto','getRemoteStateAttachmentId','../errors/not-found.error','FLOSUM_NAMESPACE','replace','SalesforceSyncService','salesforceQuery','SalesforceQueryService','repositoryId','../../../shared/utils','24vBCJHL','11PeDAjd','Repository__r','getComponentsFromRepository','SalesforceService','text/plain','stringify','catch','objectId','1317460IrStga','Branch_Name__c','fromBranchRecord','Service','design:paramtypes','toString','7069236nODKJA','query','%name%','patchObject','__decorate','2724952dCeFso','Sync_In_Progress__c','getComponents','getRepositoryRecordByName','24TWOUHQ','9494900XzacYG','GET_COMPONENTS_QUERY','apply','typedi','128hNrZDl'];a237_0x3373=function(){return _0x559e53;};return a237_0x3373();}'use strict';function a237_0x38f9(_0x5a8e0f,_0x557a88){const _0x2529b5=a237_0x3373();return a237_0x38f9=function(_0x37aa8b,_0x518d3a){_0x37aa8b=_0x37aa8b-0xa9;let _0x337377=_0x2529b5[_0x37aa8b];return _0x337377;},a237_0x38f9(_0x5a8e0f,_0x557a88);}var __decorate=this&&this[a237_0x398231(0xaa)]||function(_0x32f34f,_0x230b7f,_0x44beeb,_0x4b967e){const _0x426a85=a237_0x398231;var _0x30cd48=arguments[_0x426a85(0xc4)],_0x24c34f=_0x30cd48<0x3?_0x230b7f:_0x4b967e===null?_0x4b967e=Object[_0x426a85(0xeb)](_0x230b7f,_0x44beeb):_0x4b967e,_0x2aa20f;if(typeof Reflect==='object'&&typeof Reflect[_0x426a85(0xe1)]===_0x426a85(0xcb))_0x24c34f=Reflect[_0x426a85(0xe1)](_0x32f34f,_0x230b7f,_0x44beeb,_0x4b967e);else{for(var _0x4e0fb4=_0x32f34f[_0x426a85(0xc4)]-0x1;_0x4e0fb4>=0x0;_0x4e0fb4--)if(_0x2aa20f=_0x32f34f[_0x4e0fb4])_0x24c34f=(_0x30cd48<0x3?_0x2aa20f(_0x24c34f):_0x30cd48>0x3?_0x2aa20f(_0x230b7f,_0x44beeb,_0x24c34f):_0x2aa20f(_0x230b7f,_0x44beeb))||_0x24c34f;}return _0x30cd48>0x3&&_0x24c34f&&Object[_0x426a85(0xcd)](_0x230b7f,_0x44beeb,_0x24c34f),_0x24c34f;},__metadata=this&&this[a237_0x398231(0xbe)]||function(_0x53701c,_0x3b800e){const _0x4c3e37=a237_0x398231;if(typeof Reflect===_0x4c3e37(0xc8)&&typeof Reflect[_0x4c3e37(0xec)]===_0x4c3e37(0xcb))return Reflect['metadata'](_0x53701c,_0x3b800e);};Object[a237_0x398231(0xcd)](exports,a237_0x398231(0xb9),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require(a237_0x398231(0xb3)),constants_1=require('../../../../constants'),errors_1=require(a237_0x398231(0xe0)),utils_1=require(a237_0x398231(0xfa)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a237_0x398231(0xf3)),queries_1=require(a237_0x398231(0xd3)),salesforce_query_service_1=require('./salesforce-query.service'),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0x22590a,_0x14456f){const _0x7bd48c=a237_0x398231;this['salesforceQuery']=_0x22590a,this[_0x7bd48c(0xe4)]=_0x14456f;}async['getComponents'](_0x47688c){const _0x172c7b=a237_0x398231;var _0x4b2957;const _0x485c20=await this[_0x172c7b(0xf7)][_0x172c7b(0x10b)](_0x47688c),_0x244b75=[];for(const _0x50815d of _0x485c20){const _0x5a0a0e=(_0x4b2957=_0x50815d[constants_1[_0x172c7b(0xf4)]+_0x172c7b(0xcf)])===null||_0x4b2957===void 0x0?void 0x0:_0x4b2957[_0x172c7b(0xba)];_0x5a0a0e&&_0x5a0a0e[_0x172c7b(0xc4)]&&_0x244b75[_0x172c7b(0xca)](_0x5a0a0e[0x0]['Id']);}return _0x244b75;}async['getAllRepositoryNames'](_0x23f8d3){const _0x39ee78=a237_0x398231,_0x26c13c=await this[_0x39ee78(0xf7)]['query'](queries_1[_0x39ee78(0xc2)][_0x39ee78(0xf5)](/\%connection_id\%/g,_0x23f8d3));return _0x26c13c[_0x39ee78(0xde)](_0x4fc1d2=>{const _0x4a275a=_0x39ee78;return _0x4fc1d2[constants_1[_0x4a275a(0xce)]+_0x4a275a(0xfd)]?_0x4fc1d2[constants_1['FLOSUM_GIT_NAMESPACE']+_0x4a275a(0xfd)][_0x4a275a(0xe7)]:_0x4fc1d2['Name'];});}async[a237_0x398231(0xed)](_0x19c4e5){const _0x50b43b=a237_0x398231,_0x9f5d1a=await this[_0x50b43b(0xf7)][_0x50b43b(0x10b)](queries_1[_0x50b43b(0xbf)][_0x50b43b(0xf5)](/\%connection_id\%/g,_0x19c4e5));return _0x9f5d1a[_0x50b43b(0xde)](_0xb7d2c6=>flosum_repository_sync_dto_1[_0x50b43b(0xf1)][_0x50b43b(0xb6)](_0xb7d2c6));}async[a237_0x398231(0xef)](_0x52900b){const _0x2d0409=a237_0x398231,_0x3e28d8=await this['salesforceQuery']['query'](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x2d0409(0xf5)](/%repositories_ids\%/g,_0x52900b));return _0x3e28d8['map'](_0xb6a660=>flosum_repository_sync_dto_1[_0x2d0409(0xf1)][_0x2d0409(0x106)](_0xb6a660));}async[a237_0x398231(0xe8)](_0x2150cc){const _0x2cbf8b=a237_0x398231,_0x17a373=await this[_0x2cbf8b(0xf7)]['query'](queries_1[_0x2cbf8b(0xda)][_0x2cbf8b(0xf5)](_0x2cbf8b(0xd5),_0x2150cc));if(_0x17a373['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x2cbf8b(0xbb)+_0x2150cc+_0x2cbf8b(0xea));return flosum_repository_sync_dto_1[_0x2cbf8b(0xf1)][_0x2cbf8b(0xb6)](_0x17a373[0x0]);}async[a237_0x398231(0xd2)](_0x5dd701){const _0xc10bf3=a237_0x398231,_0x333573=await this[_0xc10bf3(0xf7)]['query'](queries_1[_0xc10bf3(0xd8)]['replace'](_0xc10bf3(0xd5),_0x5dd701));if(_0x333573[_0xc10bf3(0xc4)]===0x0)throw new not_found_error_1[(_0xc10bf3(0xbd))](_0xc10bf3(0xdd)+_0x5dd701+_0xc10bf3(0xea));return flosum_repository_sync_dto_1[_0xc10bf3(0xf1)][_0xc10bf3(0x106)](_0x333573[0x0]);}async[a237_0x398231(0xc5)](_0x1a1f11){const _0xd0bd58=a237_0x398231,_0x1113a6=await this[_0xd0bd58(0xf7)][_0xd0bd58(0x10b)](queries_1[_0xd0bd58(0xcc)]['replace']('%name%',_0x1a1f11));if(_0x1113a6[_0xd0bd58(0xc4)]===0x0)throw new not_found_error_1[(_0xd0bd58(0xbd))](_0xd0bd58(0xd0)+_0x1a1f11+_0xd0bd58(0xea));const _0x403a52=_0x1113a6[_0xd0bd58(0xb8)](_0xc37359=>_0xc37359[constants_1[_0xd0bd58(0xf4)]+_0xd0bd58(0x105)]===_0x1a1f11);if(!_0x403a52)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x1a1f11+_0xd0bd58(0xea));return flosum_repository_sync_dto_1[_0xd0bd58(0xf1)][_0xd0bd58(0x106)](_0x403a52);}async[a237_0x398231(0xae)](_0x485e4a){const _0x584183=a237_0x398231,_0x4acad3=await this[_0x584183(0xf7)][_0x584183(0x10b)](queries_1[_0x584183(0xc6)][_0x584183(0xf5)]('%name%',_0x485e4a));if(_0x4acad3[_0x584183(0xc4)]===0x0)throw new not_found_error_1[(_0x584183(0xbd))](_0x584183(0xc9)+_0x485e4a+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x584183(0xf1)][_0x584183(0xb6)](_0x4acad3[0x0]);}async[a237_0x398231(0xfe)](_0x25de8c){const _0x875b=a237_0x398231,_0xe52b33=_0x875b(0xb5)+queries_1['GET_COMPONENTS_QUERY']+_0x875b(0xbc)+_0x25de8c+'\x27';return this[_0x875b(0xad)](_0xe52b33);}async[a237_0x398231(0xdc)](_0x750e02){const _0x10e2a7=a237_0x398231,_0xc2ae=_0x10e2a7(0xdb)+queries_1[_0x10e2a7(0xb1)]+_0x10e2a7(0xc1)+_0x750e02+'\x27';return this[_0x10e2a7(0xad)](_0xc2ae);}async[a237_0x398231(0xee)](_0x390d69){const _0x5b48b8=a237_0x398231;var _0x14d764;const _0x41c1c0=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY']['replace'](_0x5b48b8(0xd6),_0x390d69[_0x5b48b8(0x103)])[_0x5b48b8(0xf5)](_0x5b48b8(0x10c),_0x390d69[_0x5b48b8(0xf9)]?constants_1[_0x5b48b8(0xc0)]:constants_1[_0x5b48b8(0xe9)]),_0x162c4a=await this[_0x5b48b8(0xf7)]['query'](_0x41c1c0),_0x7dd60c=(_0x14d764=_0x162c4a[0x0])===null||_0x14d764===void 0x0?void 0x0:_0x14d764['Id'];if(!_0x7dd60c)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x7dd60c;}async[a237_0x398231(0xf2)](_0x1cf836){const _0x2b1cc9=a237_0x398231;let _0x209ce5=await this[_0x2b1cc9(0xee)](_0x1cf836)[_0x2b1cc9(0x102)](()=>null);return!_0x209ce5&&(_0x209ce5=await this['salesforceService']['createObject'](_0x2b1cc9(0xe5),{'Body':(0x0,utils_1[_0x2b1cc9(0xc3)])('{}'),'ParentId':_0x1cf836[_0x2b1cc9(0x103)],'ContentType':_0x2b1cc9(0x100),'Name':_0x1cf836[_0x2b1cc9(0xf9)]?constants_1[_0x2b1cc9(0xc0)]:constants_1[_0x2b1cc9(0xe9)]})),_0x209ce5;}async[a237_0x398231(0xdf)](_0x287387,_0x5d3a6f){const _0x1d4b59=a237_0x398231,_0x2abaef=await this[_0x1d4b59(0xf2)](_0x287387);await this['salesforceService'][_0x1d4b59(0xa9)](_0x1d4b59(0xe5),_0x2abaef,{'Body':(0x0,utils_1[_0x1d4b59(0xc3)])(JSON[_0x1d4b59(0x101)](_0x5d3a6f))});}async['setStatus'](_0x236057,_0x30e8aa){const _0x40b63d=a237_0x398231;await this['salesforceService'][_0x40b63d(0xa9)](_0x236057[_0x40b63d(0xe6)],_0x236057[_0x40b63d(0x103)],{[constants_1[_0x40b63d(0xce)]+_0x40b63d(0xd7)]:_0x30e8aa});}async[a237_0x398231(0xd4)](_0x368aeb){const _0xde8a0c=a237_0x398231;await this[_0xde8a0c(0xe4)][_0xde8a0c(0xa9)](constants_1[_0xde8a0c(0xce)]+'Connection__c',_0x368aeb,{[constants_1[_0xde8a0c(0xce)]+_0xde8a0c(0xac)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a237_0x398231(0x107)])(),__metadata(a237_0x398231(0x108),[salesforce_query_service_1[a237_0x398231(0xf8)],salesforce_service_1[a237_0x398231(0xff)]])],SalesforceSyncService),exports[a237_0x398231(0xf6)]=SalesforceSyncService;