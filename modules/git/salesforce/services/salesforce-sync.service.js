const a237_0x2ca4c5=a237_0x16a0;(function(_0x7438cc,_0x4f0609){const _0x1ca1d3=a237_0x16a0,_0x46129f=_0x7438cc();while(!![]){try{const _0xb267d8=-parseInt(_0x1ca1d3(0xf1))/0x1+-parseInt(_0x1ca1d3(0xc8))/0x2+parseInt(_0x1ca1d3(0x10d))/0x3+-parseInt(_0x1ca1d3(0x109))/0x4*(-parseInt(_0x1ca1d3(0xe1))/0x5)+parseInt(_0x1ca1d3(0xbf))/0x6*(parseInt(_0x1ca1d3(0x106))/0x7)+-parseInt(_0x1ca1d3(0xed))/0x8+parseInt(_0x1ca1d3(0xb4))/0x9*(parseInt(_0x1ca1d3(0xd9))/0xa);if(_0xb267d8===_0x4f0609)break;else _0x46129f['push'](_0x46129f['shift']());}catch(_0x39a4fa){_0x46129f['push'](_0x46129f['shift']());}}}(a237_0x5049,0xb4f9f));function a237_0x16a0(_0x42d850,_0x4e607b){const _0x4d8ea9=a237_0x5049();return a237_0x16a0=function(_0x26ed41,_0x93ac70){_0x26ed41=_0x26ed41-0xb4;let _0x5049bc=_0x4d8ea9[_0x26ed41];return _0x5049bc;},a237_0x16a0(_0x42d850,_0x4e607b);}const a237_0x93ac70=(function(){let _0x468665=!![];return function(_0x3e1224,_0x5a126d){const _0x3be8cc=_0x468665?function(){const _0x2426f4=a237_0x16a0;if(_0x5a126d){const _0x27dade=_0x5a126d[_0x2426f4(0x101)](_0x3e1224,arguments);return _0x5a126d=null,_0x27dade;}}:function(){};return _0x468665=![],_0x3be8cc;};}()),a237_0x26ed41=a237_0x93ac70(this,function(){const _0x50cb3b=a237_0x16a0;return a237_0x26ed41[_0x50cb3b(0x100)]()[_0x50cb3b(0xc5)](_0x50cb3b(0xc6))[_0x50cb3b(0x100)]()[_0x50cb3b(0x112)](a237_0x26ed41)['search']('(((.+)+)+)+$');});a237_0x26ed41();function a237_0x5049(){const _0x5b8633=['text/plain','448526tyZaEK','SalesforceSyncService','function','objectId','getOwnPropertyDescriptor','../../../shared/utils','stringify','../../../../constants','Branch\x20','GET_BRANCH_QUERY','catch','query','Name','encodeBase64','getBranchComponents','toString','apply','updateRemoteState','GET_WAITING_BRANCHES_QUERY','Repository\x20','fromBranchRecord','171871yMrmaS','GET_COMPONENTS_QUERY','getAllRepositoryNames','322808KNrChX','getBranchRecords','patchObject','SalesforceQueryService','3008991DQtzzs','FlosumRepositorySyncDto','SYNC_ATTACHMENT_FOR_BRANCH_NAME','design:paramtypes','Repository\x20with\x20Id\x20','constructor','__esModule','__decorate','9Dszquh','./salesforce.service','length','../errors/not-found.error','%id%','GET_REPOSITORY_QUERY','Sync_In_Progress__c','getComponents','__metadata','salesforceQuery','decorate','348fAdSLc','metadata','Branch_Name__c','createObject','salesforceService','getBranchRecordByName','search','(((.+)+)+)+$','%parentId%','2917256KmpwfQ','disableSync','SalesforceService','setStatus','map','./salesforce-query.service','\x0a\x20\x20\x20\x20\x20\x20','object','GET_REPOSITORY_BY_NAME_QUERY','getComponentsFromRepository','push','defineProperty','getRepositoryRecord','getBranchRecord','Attachment','getAttachmentId','GET_REPOSITORIES_NAMES_QUERY','4688120zlogZD','getRepositoryRecordByName','getRemoteStateAttachmentId','FLOSUM_NAMESPACE','repositoryId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','Synchronization_Status__c','60XIzcCg','Repository__r','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','Branch\x20with\x20Id\x20','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','find','replace','Connection__c','%name%','GET_BRANCH_BY_NAME_QUERY','\x20not\x20found\x20on\x20salesforce','SalesforceNotFoundError','9726992VUYBqr','getRepositoryRecords','FLOSUM_GIT_NAMESPACE'];a237_0x5049=function(){return _0x5b8633;};return a237_0x5049();}'use strict';var __decorate=this&&this[a237_0x2ca4c5(0x114)]||function(_0x2520a4,_0x3acb07,_0x499c31,_0x5541f6){const _0x2342ed=a237_0x2ca4c5;var _0x33e140=arguments['length'],_0x2792b4=_0x33e140<0x3?_0x3acb07:_0x5541f6===null?_0x5541f6=Object[_0x2342ed(0xf5)](_0x3acb07,_0x499c31):_0x5541f6,_0x4c7753;if(typeof Reflect===_0x2342ed(0xcf)&&typeof Reflect[_0x2342ed(0xbe)]==='function')_0x2792b4=Reflect[_0x2342ed(0xbe)](_0x2520a4,_0x3acb07,_0x499c31,_0x5541f6);else{for(var _0x130168=_0x2520a4[_0x2342ed(0xb6)]-0x1;_0x130168>=0x0;_0x130168--)if(_0x4c7753=_0x2520a4[_0x130168])_0x2792b4=(_0x33e140<0x3?_0x4c7753(_0x2792b4):_0x33e140>0x3?_0x4c7753(_0x3acb07,_0x499c31,_0x2792b4):_0x4c7753(_0x3acb07,_0x499c31))||_0x2792b4;}return _0x33e140>0x3&&_0x2792b4&&Object[_0x2342ed(0xd3)](_0x3acb07,_0x499c31,_0x2792b4),_0x2792b4;},__metadata=this&&this[a237_0x2ca4c5(0xbc)]||function(_0x2a96bc,_0x46edbf){const _0x2536cd=a237_0x2ca4c5;if(typeof Reflect==='object'&&typeof Reflect[_0x2536cd(0xc0)]===_0x2536cd(0xf3))return Reflect[_0x2536cd(0xc0)](_0x2a96bc,_0x46edbf);};Object[a237_0x2ca4c5(0xd3)](exports,a237_0x2ca4c5(0x113),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require('typedi'),constants_1=require(a237_0x2ca4c5(0xf8)),errors_1=require('../../../../constants/errors'),utils_1=require(a237_0x2ca4c5(0xf6)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a237_0x2ca4c5(0xb7)),queries_1=require('../queries'),salesforce_query_service_1=require(a237_0x2ca4c5(0xcd)),salesforce_service_1=require(a237_0x2ca4c5(0xb5));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x25ff85,_0xab2930){const _0x3222b9=a237_0x2ca4c5;this[_0x3222b9(0xbd)]=_0x25ff85,this['salesforceService']=_0xab2930;}async['getComponents'](_0x45ec45){const _0x3fd95a=a237_0x2ca4c5;var _0x12feb8;const _0x143db1=await this[_0x3fd95a(0xbd)][_0x3fd95a(0xfc)](_0x45ec45),_0x39d45e=[];for(const _0x150bba of _0x143db1){const _0x6f5521=(_0x12feb8=_0x150bba[constants_1[_0x3fd95a(0xdc)]+'Components__r'])===null||_0x12feb8===void 0x0?void 0x0:_0x12feb8['records'];_0x6f5521&&_0x6f5521['length']&&_0x39d45e[_0x3fd95a(0xd2)](_0x6f5521[0x0]['Id']);}return _0x39d45e;}async[a237_0x2ca4c5(0x108)](_0x5aab27){const _0xa03d9a=a237_0x2ca4c5,_0x5730c8=await this[_0xa03d9a(0xbd)][_0xa03d9a(0xfc)](queries_1[_0xa03d9a(0xd8)][_0xa03d9a(0xe7)](/\%connection_id\%/g,_0x5aab27));return _0x5730c8[_0xa03d9a(0xcc)](_0x2bc61d=>{const _0x4c2b7a=_0xa03d9a;return _0x2bc61d[constants_1[_0x4c2b7a(0xef)]+_0x4c2b7a(0xe2)]?_0x2bc61d[constants_1[_0x4c2b7a(0xef)]+_0x4c2b7a(0xe2)]['Name']:_0x2bc61d[_0x4c2b7a(0xfd)];});}async[a237_0x2ca4c5(0xee)](_0x16e9c4){const _0x1c0a1e=a237_0x2ca4c5,_0xf000c5=await this[_0x1c0a1e(0xbd)]['query'](queries_1['GET_WAITING_REPOSITORIES_QUERY'][_0x1c0a1e(0xe7)](/\%connection_id\%/g,_0x16e9c4));return _0xf000c5[_0x1c0a1e(0xcc)](_0x4ef0fa=>flosum_repository_sync_dto_1[_0x1c0a1e(0x10e)]['fromRepositoryRecord'](_0x4ef0fa));}async[a237_0x2ca4c5(0x10a)](_0x2b708e){const _0x1bc955=a237_0x2ca4c5,_0x95c5ad=await this[_0x1bc955(0xbd)]['query'](queries_1[_0x1bc955(0x103)][_0x1bc955(0xe7)](/%repositories_ids\%/g,_0x2b708e));return _0x95c5ad[_0x1bc955(0xcc)](_0x277833=>flosum_repository_sync_dto_1[_0x1bc955(0x10e)][_0x1bc955(0x105)](_0x277833));}async[a237_0x2ca4c5(0xd4)](_0x3984d9){const _0x99488c=a237_0x2ca4c5,_0x3fe8f7=await this['salesforceQuery'][_0x99488c(0xfc)](queries_1[_0x99488c(0xb9)][_0x99488c(0xe7)]('%id%',_0x3984d9));if(_0x3fe8f7[_0x99488c(0xb6)]===0x0)throw new not_found_error_1[(_0x99488c(0xec))](_0x99488c(0x111)+_0x3984d9+_0x99488c(0xeb));return flosum_repository_sync_dto_1[_0x99488c(0x10e)]['fromRepositoryRecord'](_0x3fe8f7[0x0]);}async[a237_0x2ca4c5(0xd5)](_0x1f3747){const _0x209f63=a237_0x2ca4c5,_0x43c2cf=await this[_0x209f63(0xbd)][_0x209f63(0xfc)](queries_1[_0x209f63(0xfa)][_0x209f63(0xe7)](_0x209f63(0xb8),_0x1f3747));if(_0x43c2cf['length']===0x0)throw new not_found_error_1[(_0x209f63(0xec))](_0x209f63(0xe4)+_0x1f3747+_0x209f63(0xeb));return flosum_repository_sync_dto_1[_0x209f63(0x10e)][_0x209f63(0x105)](_0x43c2cf[0x0]);}async[a237_0x2ca4c5(0xc4)](_0x18151a){const _0x21ce3b=a237_0x2ca4c5,_0x2c9c63=await this[_0x21ce3b(0xbd)][_0x21ce3b(0xfc)](queries_1[_0x21ce3b(0xea)][_0x21ce3b(0xe7)](_0x21ce3b(0xe9),_0x18151a));if(_0x2c9c63[_0x21ce3b(0xb6)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x21ce3b(0xf9)+_0x18151a+_0x21ce3b(0xeb));const _0x49ca7c=_0x2c9c63[_0x21ce3b(0xe6)](_0x4cb4a9=>_0x4cb4a9[constants_1['FLOSUM_NAMESPACE']+_0x21ce3b(0xc1)]===_0x18151a);if(!_0x49ca7c)throw new not_found_error_1['SalesforceNotFoundError'](_0x21ce3b(0xf9)+_0x18151a+_0x21ce3b(0xeb));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x21ce3b(0x105)](_0x49ca7c);}async[a237_0x2ca4c5(0xda)](_0x40bda5){const _0x272fb2=a237_0x2ca4c5,_0x268e17=await this[_0x272fb2(0xbd)][_0x272fb2(0xfc)](queries_1[_0x272fb2(0xd0)]['replace'](_0x272fb2(0xe9),_0x40bda5));if(_0x268e17[_0x272fb2(0xb6)]===0x0)throw new not_found_error_1[(_0x272fb2(0xec))](_0x272fb2(0x104)+_0x40bda5+_0x272fb2(0xeb));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x268e17[0x0]);}async[a237_0x2ca4c5(0xd1)](_0x5646b0){const _0x458c7b=a237_0x2ca4c5,_0x107758=_0x458c7b(0xce)+queries_1[_0x458c7b(0x107)]+_0x458c7b(0xe5)+_0x5646b0+'\x27';return this['getComponents'](_0x107758);}async[a237_0x2ca4c5(0xff)](_0xda1401){const _0x4a654f=a237_0x2ca4c5,_0x5523a2='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x4a654f(0x107)]+_0x4a654f(0xde)+_0xda1401+'\x27';return this[_0x4a654f(0xbb)](_0x5523a2);}async[a237_0x2ca4c5(0xd7)](_0x3244d3){const _0xbdc1ad=a237_0x2ca4c5;var _0x3dfce6;const _0x51adf3=queries_1[_0xbdc1ad(0xdf)][_0xbdc1ad(0xe7)](_0xbdc1ad(0xc7),_0x3244d3[_0xbdc1ad(0xf4)])[_0xbdc1ad(0xe7)](_0xbdc1ad(0xe9),_0x3244d3['repositoryId']?constants_1[_0xbdc1ad(0xe3)]:constants_1[_0xbdc1ad(0x10f)]),_0x230f45=await this[_0xbdc1ad(0xbd)]['query'](_0x51adf3),_0x159e8c=(_0x3dfce6=_0x230f45[0x0])===null||_0x3dfce6===void 0x0?void 0x0:_0x3dfce6['Id'];if(!_0x159e8c)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x159e8c;}async['getRemoteStateAttachmentId'](_0x447804){const _0x354c1f=a237_0x2ca4c5;let _0x1bf335=await this[_0x354c1f(0xd7)](_0x447804)[_0x354c1f(0xfb)](()=>null);return!_0x1bf335&&(_0x1bf335=await this['salesforceService'][_0x354c1f(0xc2)](_0x354c1f(0xd6),{'Body':(0x0,utils_1[_0x354c1f(0xfe)])('{}'),'ParentId':_0x447804[_0x354c1f(0xf4)],'ContentType':_0x354c1f(0xf0),'Name':_0x447804[_0x354c1f(0xdd)]?constants_1[_0x354c1f(0xe3)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x1bf335;}async[a237_0x2ca4c5(0x102)](_0x59bd83,_0x24d6c4){const _0x122e95=a237_0x2ca4c5,_0x4d3711=await this[_0x122e95(0xdb)](_0x59bd83);await this[_0x122e95(0xc3)]['patchObject'](_0x122e95(0xd6),_0x4d3711,{'Body':(0x0,utils_1[_0x122e95(0xfe)])(JSON[_0x122e95(0xf7)](_0x24d6c4))});}async[a237_0x2ca4c5(0xcb)](_0x52ffd3,_0x1a20bf){const _0x1ade0d=a237_0x2ca4c5;await this[_0x1ade0d(0xc3)][_0x1ade0d(0x10b)](_0x52ffd3['objectType'],_0x52ffd3['objectId'],{[constants_1[_0x1ade0d(0xef)]+_0x1ade0d(0xe0)]:_0x1a20bf});}async[a237_0x2ca4c5(0xc9)](_0x38fbf6){const _0x7d7892=a237_0x2ca4c5;await this['salesforceService'][_0x7d7892(0x10b)](constants_1[_0x7d7892(0xef)]+_0x7d7892(0xe8),_0x38fbf6,{[constants_1[_0x7d7892(0xef)]+_0x7d7892(0xba)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1['Service'])(),__metadata(a237_0x2ca4c5(0x110),[salesforce_query_service_1[a237_0x2ca4c5(0x10c)],salesforce_service_1[a237_0x2ca4c5(0xca)]])],SalesforceSyncService),exports[a237_0x2ca4c5(0xf2)]=SalesforceSyncService;