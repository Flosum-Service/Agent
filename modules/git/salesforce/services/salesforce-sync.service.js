const a237_0x37ef4b=a237_0x19bf;(function(_0x532af2,_0x553614){const _0x17db68=a237_0x19bf,_0x277271=_0x532af2();while(!![]){try{const _0x1a913f=-parseInt(_0x17db68(0x172))/0x1*(parseInt(_0x17db68(0x169))/0x2)+parseInt(_0x17db68(0x164))/0x3+parseInt(_0x17db68(0x1af))/0x4+-parseInt(_0x17db68(0x154))/0x5+-parseInt(_0x17db68(0x193))/0x6+-parseInt(_0x17db68(0x180))/0x7*(-parseInt(_0x17db68(0x16b))/0x8)+-parseInt(_0x17db68(0x19e))/0x9*(-parseInt(_0x17db68(0x176))/0xa);if(_0x1a913f===_0x553614)break;else _0x277271['push'](_0x277271['shift']());}catch(_0x14ff10){_0x277271['push'](_0x277271['shift']());}}}(a237_0xc251,0xdbad9));function a237_0xc251(){const _0x1ac29f=['Name','objectId','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','getComponents','%id%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','patchObject','SalesforceSyncService','../../../../constants','decorate','getAllRepositoryNames','%name%','4709619PGcXPB','metadata','./salesforce-query.service','ERR_INVALID_ATTACHMENT_ID','stringify','425746DQZalQ','__esModule','184328nSHrtv','FLOSUM_NAMESPACE','defineProperty','Components__r','setStatus','fromRepositoryRecord','map','7bksntf','salesforceService','\x20not\x20found\x20on\x20salesforce','search','844060cHnynS','../errors/not-found.error','GET_WAITING_REPOSITORIES_QUERY','repositoryId','__metadata','Branch\x20with\x20Id\x20','toString','getRepositoryRecord','function','getComponentsFromRepository','189CjUZMI','length','Branch\x20','objectType','getOwnPropertyDescriptor','push','replace','GET_REPOSITORIES_NAMES_QUERY','../queries','Synchronization_Status__c','disableSync','design:paramtypes','Repository\x20','SYNC_ATTACHMENT_FOR_BRANCH_NAME','salesforceQuery','typedi','Connection__c','Service','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','5583834oaPGqP','SalesforceQueryService','../dto/flosum-repository-sync.dto','Repository\x20with\x20Id\x20','getRepositoryRecords','records','updateRemoteState','SalesforceNotFoundError','getAttachmentId','GET_REPOSITORY_QUERY','(((.+)+)+)+$','261QsWbBp','getBranchRecordByName','../../../shared/utils','encodeBase64','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','GET_REPOSITORY_BY_NAME_QUERY','query','object','./salesforce.service','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','catch','createObject','Repository__r','apply','GET_WAITING_BRANCHES_QUERY','getRemoteStateAttachmentId','constructor','802336NcrkgC','Branch_Name__c','SalesforceService','FlosumRepositorySyncDto','Attachment','fromBranchRecord','FLOSUM_GIT_NAMESPACE','7598935Auulut','%parentId%','GET_BRANCH_BY_NAME_QUERY','text/plain'];a237_0xc251=function(){return _0x1ac29f;};return a237_0xc251();}function a237_0x19bf(_0x472075,_0x344bc9){const _0x374e1b=a237_0xc251();return a237_0x19bf=function(_0x580cc1,_0x41afe0){_0x580cc1=_0x580cc1-0x14e;let _0xc25151=_0x374e1b[_0x580cc1];return _0xc25151;},a237_0x19bf(_0x472075,_0x344bc9);}const a237_0x41afe0=(function(){let _0x2f08e0=!![];return function(_0x1a099a,_0x27a020){const _0x23254c=_0x2f08e0?function(){const _0x4838fd=a237_0x19bf;if(_0x27a020){const _0x2c6568=_0x27a020[_0x4838fd(0x1ab)](_0x1a099a,arguments);return _0x27a020=null,_0x2c6568;}}:function(){};return _0x2f08e0=![],_0x23254c;};}()),a237_0x580cc1=a237_0x41afe0(this,function(){const _0x300fef=a237_0x19bf;return a237_0x580cc1[_0x300fef(0x17c)]()[_0x300fef(0x175)](_0x300fef(0x19d))['toString']()[_0x300fef(0x1ae)](a237_0x580cc1)[_0x300fef(0x175)](_0x300fef(0x19d));});a237_0x580cc1();'use strict';var __decorate=this&&this['__decorate']||function(_0x397d5a,_0x3089b9,_0x108520,_0x5511c5){const _0x1eb396=a237_0x19bf;var _0x2e6821=arguments[_0x1eb396(0x181)],_0x286dc9=_0x2e6821<0x3?_0x3089b9:_0x5511c5===null?_0x5511c5=Object[_0x1eb396(0x184)](_0x3089b9,_0x108520):_0x5511c5,_0xd6946f;if(typeof Reflect===_0x1eb396(0x1a5)&&typeof Reflect[_0x1eb396(0x161)]===_0x1eb396(0x17e))_0x286dc9=Reflect[_0x1eb396(0x161)](_0x397d5a,_0x3089b9,_0x108520,_0x5511c5);else{for(var _0x214b5b=_0x397d5a[_0x1eb396(0x181)]-0x1;_0x214b5b>=0x0;_0x214b5b--)if(_0xd6946f=_0x397d5a[_0x214b5b])_0x286dc9=(_0x2e6821<0x3?_0xd6946f(_0x286dc9):_0x2e6821>0x3?_0xd6946f(_0x3089b9,_0x108520,_0x286dc9):_0xd6946f(_0x3089b9,_0x108520))||_0x286dc9;}return _0x2e6821>0x3&&_0x286dc9&&Object['defineProperty'](_0x3089b9,_0x108520,_0x286dc9),_0x286dc9;},__metadata=this&&this[a237_0x37ef4b(0x17a)]||function(_0x22a0cb,_0x4fb96d){const _0x22aa05=a237_0x37ef4b;if(typeof Reflect==='object'&&typeof Reflect[_0x22aa05(0x165)]===_0x22aa05(0x17e))return Reflect[_0x22aa05(0x165)](_0x22a0cb,_0x4fb96d);};Object[a237_0x37ef4b(0x16d)](exports,a237_0x37ef4b(0x16a),{'value':!![]}),exports[a237_0x37ef4b(0x15f)]=void 0x0;const typedi_1=require(a237_0x37ef4b(0x18f)),constants_1=require(a237_0x37ef4b(0x160)),errors_1=require('../../../../constants/errors'),utils_1=require(a237_0x37ef4b(0x1a0)),flosum_repository_sync_dto_1=require(a237_0x37ef4b(0x195)),not_found_error_1=require(a237_0x37ef4b(0x177)),queries_1=require(a237_0x37ef4b(0x188)),salesforce_query_service_1=require(a237_0x37ef4b(0x166)),salesforce_service_1=require(a237_0x37ef4b(0x1a6));let SalesforceSyncService=class SalesforceSyncService{constructor(_0xe50cdd,_0x3ce0d5){const _0x3d4e96=a237_0x37ef4b;this[_0x3d4e96(0x18e)]=_0xe50cdd,this[_0x3d4e96(0x173)]=_0x3ce0d5;}async[a237_0x37ef4b(0x15b)](_0x567ff3){const _0x24cda5=a237_0x37ef4b;var _0x4f5bec;const _0x50bb8b=await this[_0x24cda5(0x18e)][_0x24cda5(0x1a4)](_0x567ff3),_0x487f38=[];for(const _0x4b59f8 of _0x50bb8b){const _0x3fa2c2=(_0x4f5bec=_0x4b59f8[constants_1[_0x24cda5(0x16c)]+_0x24cda5(0x16e)])===null||_0x4f5bec===void 0x0?void 0x0:_0x4f5bec[_0x24cda5(0x198)];_0x3fa2c2&&_0x3fa2c2[_0x24cda5(0x181)]&&_0x487f38[_0x24cda5(0x185)](_0x3fa2c2[0x0]['Id']);}return _0x487f38;}async[a237_0x37ef4b(0x162)](_0x597d46){const _0x9367d3=a237_0x37ef4b,_0x2e1c15=await this[_0x9367d3(0x18e)][_0x9367d3(0x1a4)](queries_1[_0x9367d3(0x187)][_0x9367d3(0x186)](/\%connection_id\%/g,_0x597d46));return _0x2e1c15[_0x9367d3(0x171)](_0x4a8e2d=>{const _0x31913a=_0x9367d3;return _0x4a8e2d[constants_1[_0x31913a(0x153)]+_0x31913a(0x1aa)]?_0x4a8e2d[constants_1[_0x31913a(0x153)]+_0x31913a(0x1aa)]['Name']:_0x4a8e2d[_0x31913a(0x158)];});}async[a237_0x37ef4b(0x197)](_0x426db8){const _0x78d091=a237_0x37ef4b,_0x8160d0=await this[_0x78d091(0x18e)][_0x78d091(0x1a4)](queries_1[_0x78d091(0x178)][_0x78d091(0x186)](/\%connection_id\%/g,_0x426db8));return _0x8160d0[_0x78d091(0x171)](_0x3d1990=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x78d091(0x170)](_0x3d1990));}async['getBranchRecords'](_0x395dd5){const _0x1c3df8=a237_0x37ef4b,_0x3a6122=await this[_0x1c3df8(0x18e)][_0x1c3df8(0x1a4)](queries_1[_0x1c3df8(0x1ac)][_0x1c3df8(0x186)](/%repositories_ids\%/g,_0x395dd5));return _0x3a6122[_0x1c3df8(0x171)](_0x23124f=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x1c3df8(0x152)](_0x23124f));}async[a237_0x37ef4b(0x17d)](_0x1af628){const _0x380c93=a237_0x37ef4b,_0x1754b2=await this['salesforceQuery'][_0x380c93(0x1a4)](queries_1[_0x380c93(0x19c)][_0x380c93(0x186)]('%id%',_0x1af628));if(_0x1754b2['length']===0x0)throw new not_found_error_1[(_0x380c93(0x19a))](_0x380c93(0x196)+_0x1af628+_0x380c93(0x174));return flosum_repository_sync_dto_1[_0x380c93(0x150)][_0x380c93(0x170)](_0x1754b2[0x0]);}async['getBranchRecord'](_0x2879d6){const _0x7d3430=a237_0x37ef4b,_0xd46c58=await this[_0x7d3430(0x18e)][_0x7d3430(0x1a4)](queries_1['GET_BRANCH_QUERY'][_0x7d3430(0x186)](_0x7d3430(0x15c),_0x2879d6));if(_0xd46c58[_0x7d3430(0x181)]===0x0)throw new not_found_error_1[(_0x7d3430(0x19a))](_0x7d3430(0x17b)+_0x2879d6+_0x7d3430(0x174));return flosum_repository_sync_dto_1[_0x7d3430(0x150)][_0x7d3430(0x152)](_0xd46c58[0x0]);}async[a237_0x37ef4b(0x19f)](_0x305f36){const _0xcf7bdc=a237_0x37ef4b,_0x5ca761=await this[_0xcf7bdc(0x18e)][_0xcf7bdc(0x1a4)](queries_1[_0xcf7bdc(0x156)][_0xcf7bdc(0x186)](_0xcf7bdc(0x163),_0x305f36));if(_0x5ca761[_0xcf7bdc(0x181)]===0x0)throw new not_found_error_1[(_0xcf7bdc(0x19a))]('Branch\x20'+_0x305f36+'\x20not\x20found\x20on\x20salesforce');const _0x522d62=_0x5ca761['find'](_0xfe4c93=>_0xfe4c93[constants_1[_0xcf7bdc(0x16c)]+_0xcf7bdc(0x14e)]===_0x305f36);if(!_0x522d62)throw new not_found_error_1[(_0xcf7bdc(0x19a))](_0xcf7bdc(0x182)+_0x305f36+_0xcf7bdc(0x174));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0x522d62);}async['getRepositoryRecordByName'](_0x2517ee){const _0x427044=a237_0x37ef4b,_0x323773=await this['salesforceQuery'][_0x427044(0x1a4)](queries_1[_0x427044(0x1a3)][_0x427044(0x186)]('%name%',_0x2517ee));if(_0x323773['length']===0x0)throw new not_found_error_1[(_0x427044(0x19a))](_0x427044(0x18c)+_0x2517ee+_0x427044(0x174));return flosum_repository_sync_dto_1[_0x427044(0x150)][_0x427044(0x170)](_0x323773[0x0]);}async[a237_0x37ef4b(0x17f)](_0x59100c){const _0x139f48=a237_0x37ef4b,_0x513eec='\x0a\x20\x20\x20\x20\x20\x20'+queries_1['GET_COMPONENTS_QUERY']+_0x139f48(0x15a)+_0x59100c+'\x27';return this[_0x139f48(0x15b)](_0x513eec);}async['getBranchComponents'](_0x33e3fe){const _0x2b223d=a237_0x37ef4b,_0x7dcced=_0x2b223d(0x1a2)+queries_1['GET_COMPONENTS_QUERY']+_0x2b223d(0x15d)+_0x33e3fe+'\x27';return this[_0x2b223d(0x15b)](_0x7dcced);}async[a237_0x37ef4b(0x19b)](_0x36cd9b){const _0x574279=a237_0x37ef4b;var _0xacd5c7;const _0x5b8ef5=queries_1[_0x574279(0x1a7)][_0x574279(0x186)](_0x574279(0x155),_0x36cd9b[_0x574279(0x159)])[_0x574279(0x186)](_0x574279(0x163),_0x36cd9b[_0x574279(0x179)]?constants_1[_0x574279(0x192)]:constants_1[_0x574279(0x18d)]),_0x1c9a9c=await this[_0x574279(0x18e)][_0x574279(0x1a4)](_0x5b8ef5),_0x55e58b=(_0xacd5c7=_0x1c9a9c[0x0])===null||_0xacd5c7===void 0x0?void 0x0:_0xacd5c7['Id'];if(!_0x55e58b)throw new Error(errors_1[_0x574279(0x167)]);return _0x55e58b;}async[a237_0x37ef4b(0x1ad)](_0x442b65){const _0x183848=a237_0x37ef4b;let _0x307f63=await this['getAttachmentId'](_0x442b65)[_0x183848(0x1a8)](()=>null);return!_0x307f63&&(_0x307f63=await this['salesforceService'][_0x183848(0x1a9)](_0x183848(0x151),{'Body':(0x0,utils_1[_0x183848(0x1a1)])('{}'),'ParentId':_0x442b65[_0x183848(0x159)],'ContentType':_0x183848(0x157),'Name':_0x442b65['repositoryId']?constants_1[_0x183848(0x192)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x307f63;}async[a237_0x37ef4b(0x199)](_0x5dd9a4,_0x431a18){const _0x720e65=a237_0x37ef4b,_0x1bc56f=await this['getRemoteStateAttachmentId'](_0x5dd9a4);await this[_0x720e65(0x173)][_0x720e65(0x15e)](_0x720e65(0x151),_0x1bc56f,{'Body':(0x0,utils_1[_0x720e65(0x1a1)])(JSON[_0x720e65(0x168)](_0x431a18))});}async[a237_0x37ef4b(0x16f)](_0x4ce446,_0x6d3ddd){const _0x21d0c1=a237_0x37ef4b;await this['salesforceService']['patchObject'](_0x4ce446[_0x21d0c1(0x183)],_0x4ce446[_0x21d0c1(0x159)],{[constants_1[_0x21d0c1(0x153)]+_0x21d0c1(0x189)]:_0x6d3ddd});}async[a237_0x37ef4b(0x18a)](_0x5d28e){const _0x442ff7=a237_0x37ef4b;await this['salesforceService'][_0x442ff7(0x15e)](constants_1[_0x442ff7(0x153)]+_0x442ff7(0x190),_0x5d28e,{[constants_1[_0x442ff7(0x153)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a237_0x37ef4b(0x191)])(),__metadata(a237_0x37ef4b(0x18b),[salesforce_query_service_1[a237_0x37ef4b(0x194)],salesforce_service_1[a237_0x37ef4b(0x14f)]])],SalesforceSyncService),exports[a237_0x37ef4b(0x15f)]=SalesforceSyncService;