const a238_0x566438=a238_0x49dc;(function(_0x238f0f,_0x3f43d8){const _0x1fe232=a238_0x49dc,_0x1b2a8e=_0x238f0f();while(!![]){try{const _0x35ad49=parseInt(_0x1fe232(0x1f6))/0x1+-parseInt(_0x1fe232(0x1eb))/0x2*(-parseInt(_0x1fe232(0x1e7))/0x3)+parseInt(_0x1fe232(0x1ed))/0x4*(parseInt(_0x1fe232(0x1fc))/0x5)+-parseInt(_0x1fe232(0x230))/0x6+parseInt(_0x1fe232(0x215))/0x7+-parseInt(_0x1fe232(0x1fd))/0x8+-parseInt(_0x1fe232(0x216))/0x9*(-parseInt(_0x1fe232(0x1fa))/0xa);if(_0x35ad49===_0x3f43d8)break;else _0x1b2a8e['push'](_0x1b2a8e['shift']());}catch(_0x56e798){_0x1b2a8e['push'](_0x1b2a8e['shift']());}}}(a238_0x38aa,0x55f6e));const a238_0x162eec=(function(){let _0x56811d=!![];return function(_0x145983,_0x2cb5a2){const _0x33fc31=_0x56811d?function(){if(_0x2cb5a2){const _0x1f69c4=_0x2cb5a2['apply'](_0x145983,arguments);return _0x2cb5a2=null,_0x1f69c4;}}:function(){};return _0x56811d=![],_0x33fc31;};}()),a238_0x358db6=a238_0x162eec(this,function(){const _0x3954b7=a238_0x49dc;return a238_0x358db6['toString']()[_0x3954b7(0x224)]('(((.+)+)+)+$')[_0x3954b7(0x233)]()[_0x3954b7(0x217)](a238_0x358db6)['search'](_0x3954b7(0x213));});function a238_0x49dc(_0x1fd42f,_0x824b0b){const _0x1b1cab=a238_0x38aa();return a238_0x49dc=function(_0x358db6,_0x162eec){_0x358db6=_0x358db6-0x1db;let _0x38aa47=_0x1b1cab[_0x358db6];return _0x38aa47;},a238_0x49dc(_0x1fd42f,_0x824b0b);}a238_0x358db6();'use strict';var __decorate=this&&this[a238_0x566438(0x21a)]||function(_0x31a7f4,_0x12ad91,_0x25b735,_0x430210){const _0x4b46ac=a238_0x566438;var _0x26ceaa=arguments['length'],_0x31b212=_0x26ceaa<0x3?_0x12ad91:_0x430210===null?_0x430210=Object[_0x4b46ac(0x1db)](_0x12ad91,_0x25b735):_0x430210,_0x47a166;if(typeof Reflect===_0x4b46ac(0x22e)&&typeof Reflect[_0x4b46ac(0x1fe)]===_0x4b46ac(0x1f7))_0x31b212=Reflect[_0x4b46ac(0x1fe)](_0x31a7f4,_0x12ad91,_0x25b735,_0x430210);else{for(var _0x13bc1a=_0x31a7f4[_0x4b46ac(0x21e)]-0x1;_0x13bc1a>=0x0;_0x13bc1a--)if(_0x47a166=_0x31a7f4[_0x13bc1a])_0x31b212=(_0x26ceaa<0x3?_0x47a166(_0x31b212):_0x26ceaa>0x3?_0x47a166(_0x12ad91,_0x25b735,_0x31b212):_0x47a166(_0x12ad91,_0x25b735))||_0x31b212;}return _0x26ceaa>0x3&&_0x31b212&&Object[_0x4b46ac(0x1dc)](_0x12ad91,_0x25b735,_0x31b212),_0x31b212;},__metadata=this&&this[a238_0x566438(0x202)]||function(_0x2ca557,_0x4bf033){const _0x2ef2a2=a238_0x566438;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x2ef2a2(0x1f0)](_0x2ca557,_0x4bf033);};function a238_0x38aa(){const _0x1fa71b=['salesforceService','(((.+)+)+)+$','getRepositoryRecordByName','2086728HLzGmo','9hlWsYr','constructor','Branch_Name__c','salesforceQuery','__decorate','getBranchComponents','repositoryId','Synchronization_Status__c','length','FLOSUM_NAMESPACE','./salesforce.service','SalesforceService','GET_REPOSITORY_BY_NAME_QUERY','query','search','Name','getBranchRecords','\x20not\x20found\x20on\x20salesforce','SalesforceSyncService','Repository\x20','map','../dto/flosum-repository-sync.dto','../errors/not-found.error','getComponentsFromRepository','object','getBranchRecord','2151876hjulTW','GET_COMPONENTS_QUERY','push','toString','%name%','Connection__c','replace','getOwnPropertyDescriptor','defineProperty','Service','GET_WAITING_REPOSITORIES_QUERY','updateRemoteState','patchObject','%parentId%','getBranchRecordByName','objectType','__esModule','../../../../constants/errors','GET_BRANCH_BY_NAME_QUERY','3RjJrgM','%id%','getRepositoryRecord','SalesforceQueryService','2494PtyHTT','FlosumRepositorySyncDto','4EhZuaT','disableSync','ERR_INVALID_ATTACHMENT_ID','metadata','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','getComponents','\x0a\x20\x20\x20\x20\x20\x20','objectId','getAttachmentId','291090TrYxxk','function','../queries','setStatus','2322290ZWPfiz','Repository\x20with\x20Id\x20','284330BtvgqX','1350240BXoaOZ','decorate','text/plain','getRepositoryRecords','Components__r','__metadata','FLOSUM_GIT_NAMESPACE','Attachment','./salesforce-query.service','SalesforceNotFoundError','../../../shared/utils','encodeBase64','fromRepositoryRecord','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','GET_REPOSITORIES_NAMES_QUERY','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','getAllRepositoryNames','stringify','Branch\x20','Repository__r','typedi'];a238_0x38aa=function(){return _0x1fa71b;};return a238_0x38aa();}Object[a238_0x566438(0x1dc)](exports,a238_0x566438(0x1e4),{'value':!![]}),exports[a238_0x566438(0x228)]=void 0x0;const typedi_1=require(a238_0x566438(0x211)),constants_1=require('../../../../constants'),errors_1=require(a238_0x566438(0x1e5)),utils_1=require(a238_0x566438(0x207)),flosum_repository_sync_dto_1=require(a238_0x566438(0x22b)),not_found_error_1=require(a238_0x566438(0x22c)),queries_1=require(a238_0x566438(0x1f8)),salesforce_query_service_1=require(a238_0x566438(0x205)),salesforce_service_1=require(a238_0x566438(0x220));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x9aea6,_0x21f38c){const _0x96e3c=a238_0x566438;this[_0x96e3c(0x219)]=_0x9aea6,this['salesforceService']=_0x21f38c;}async[a238_0x566438(0x1f2)](_0xdaba0b){const _0x562852=a238_0x566438;var _0x3d1c09;const _0x5665bd=await this[_0x562852(0x219)]['query'](_0xdaba0b),_0x56b259=[];for(const _0x28c5e9 of _0x5665bd){const _0x512fd5=(_0x3d1c09=_0x28c5e9[constants_1[_0x562852(0x21f)]+_0x562852(0x201)])===null||_0x3d1c09===void 0x0?void 0x0:_0x3d1c09['records'];_0x512fd5&&_0x512fd5[_0x562852(0x21e)]&&_0x56b259[_0x562852(0x232)](_0x512fd5[0x0]['Id']);}return _0x56b259;}async[a238_0x566438(0x20d)](_0x433838){const _0x7b1b5f=a238_0x566438,_0x44ef97=await this['salesforceQuery'][_0x7b1b5f(0x223)](queries_1[_0x7b1b5f(0x20b)][_0x7b1b5f(0x236)](/\%connection_id\%/g,_0x433838));return _0x44ef97[_0x7b1b5f(0x22a)](_0x1abfc4=>{const _0x564c56=_0x7b1b5f;return _0x1abfc4[constants_1[_0x564c56(0x203)]+'Repository__r']?_0x1abfc4[constants_1[_0x564c56(0x203)]+_0x564c56(0x210)]['Name']:_0x1abfc4[_0x564c56(0x225)];});}async[a238_0x566438(0x200)](_0x1f939c){const _0x2dfd12=a238_0x566438,_0x280242=await this[_0x2dfd12(0x219)][_0x2dfd12(0x223)](queries_1[_0x2dfd12(0x1de)][_0x2dfd12(0x236)](/\%connection_id\%/g,_0x1f939c));return _0x280242[_0x2dfd12(0x22a)](_0x27cfdd=>flosum_repository_sync_dto_1[_0x2dfd12(0x1ec)]['fromRepositoryRecord'](_0x27cfdd));}async[a238_0x566438(0x226)](_0x5e20fd){const _0x3810aa=a238_0x566438,_0x3202e0=await this[_0x3810aa(0x219)][_0x3810aa(0x223)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x3810aa(0x236)](/%repositories_ids\%/g,_0x5e20fd));return _0x3202e0[_0x3810aa(0x22a)](_0x59051c=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0x59051c));}async[a238_0x566438(0x1e9)](_0xdd166b){const _0x55122e=a238_0x566438,_0x5917f2=await this[_0x55122e(0x219)][_0x55122e(0x223)](queries_1['GET_REPOSITORY_QUERY']['replace'](_0x55122e(0x1e8),_0xdd166b));if(_0x5917f2[_0x55122e(0x21e)]===0x0)throw new not_found_error_1[(_0x55122e(0x206))](_0x55122e(0x1fb)+_0xdd166b+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x55122e(0x1ec)][_0x55122e(0x209)](_0x5917f2[0x0]);}async[a238_0x566438(0x22f)](_0x56c6fa){const _0x327efa=a238_0x566438,_0x377cf7=await this[_0x327efa(0x219)]['query'](queries_1['GET_BRANCH_QUERY'][_0x327efa(0x236)]('%id%',_0x56c6fa));if(_0x377cf7['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20with\x20Id\x20'+_0x56c6fa+_0x327efa(0x227));return flosum_repository_sync_dto_1[_0x327efa(0x1ec)]['fromBranchRecord'](_0x377cf7[0x0]);}async[a238_0x566438(0x1e2)](_0x1223b9){const _0xf0a7ee=a238_0x566438,_0x30fa30=await this[_0xf0a7ee(0x219)][_0xf0a7ee(0x223)](queries_1[_0xf0a7ee(0x1e6)][_0xf0a7ee(0x236)]('%name%',_0x1223b9));if(_0x30fa30[_0xf0a7ee(0x21e)]===0x0)throw new not_found_error_1[(_0xf0a7ee(0x206))](_0xf0a7ee(0x20f)+_0x1223b9+_0xf0a7ee(0x227));const _0x5c3854=_0x30fa30['find'](_0x5d1425=>_0x5d1425[constants_1[_0xf0a7ee(0x21f)]+_0xf0a7ee(0x218)]===_0x1223b9);if(!_0x5c3854)throw new not_found_error_1[(_0xf0a7ee(0x206))](_0xf0a7ee(0x20f)+_0x1223b9+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0xf0a7ee(0x1ec)]['fromBranchRecord'](_0x5c3854);}async[a238_0x566438(0x214)](_0x49ad7e){const _0x4f7eab=a238_0x566438,_0x2e446a=await this[_0x4f7eab(0x219)][_0x4f7eab(0x223)](queries_1[_0x4f7eab(0x222)][_0x4f7eab(0x236)](_0x4f7eab(0x234),_0x49ad7e));if(_0x2e446a[_0x4f7eab(0x21e)]===0x0)throw new not_found_error_1[(_0x4f7eab(0x206))](_0x4f7eab(0x229)+_0x49ad7e+_0x4f7eab(0x227));return flosum_repository_sync_dto_1[_0x4f7eab(0x1ec)]['fromRepositoryRecord'](_0x2e446a[0x0]);}async[a238_0x566438(0x22d)](_0x29aa49){const _0x1f99cc=a238_0x566438,_0x484652=_0x1f99cc(0x1f3)+queries_1[_0x1f99cc(0x231)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x29aa49+'\x27';return this['getComponents'](_0x484652);}async[a238_0x566438(0x21b)](_0x2d1521){const _0x142985=a238_0x566438,_0x24d58c='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x142985(0x231)]+_0x142985(0x20c)+_0x2d1521+'\x27';return this['getComponents'](_0x24d58c);}async[a238_0x566438(0x1f5)](_0xff300c){const _0x14318b=a238_0x566438;var _0xbadbf6;const _0x3fc3ea=queries_1[_0x14318b(0x20a)][_0x14318b(0x236)](_0x14318b(0x1e1),_0xff300c[_0x14318b(0x1f4)])[_0x14318b(0x236)](_0x14318b(0x234),_0xff300c['repositoryId']?constants_1[_0x14318b(0x1f1)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x28a8ee=await this[_0x14318b(0x219)][_0x14318b(0x223)](_0x3fc3ea),_0x4f0e82=(_0xbadbf6=_0x28a8ee[0x0])===null||_0xbadbf6===void 0x0?void 0x0:_0xbadbf6['Id'];if(!_0x4f0e82)throw new Error(errors_1[_0x14318b(0x1ef)]);return _0x4f0e82;}async['getRemoteStateAttachmentId'](_0x5eb28a){const _0x7ee63b=a238_0x566438;let _0xb290bd=await this[_0x7ee63b(0x1f5)](_0x5eb28a)['catch'](()=>null);return!_0xb290bd&&(_0xb290bd=await this['salesforceService']['createObject'](_0x7ee63b(0x204),{'Body':(0x0,utils_1[_0x7ee63b(0x208)])('{}'),'ParentId':_0x5eb28a[_0x7ee63b(0x1f4)],'ContentType':_0x7ee63b(0x1ff),'Name':_0x5eb28a[_0x7ee63b(0x21c)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0xb290bd;}async[a238_0x566438(0x1df)](_0x2dee73,_0x2b243a){const _0x2982e1=a238_0x566438,_0x4f7d7f=await this['getRemoteStateAttachmentId'](_0x2dee73);await this['salesforceService'][_0x2982e1(0x1e0)](_0x2982e1(0x204),_0x4f7d7f,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0x2982e1(0x20e)](_0x2b243a))});}async[a238_0x566438(0x1f9)](_0x482729,_0x38cc1b){const _0x36973c=a238_0x566438;await this[_0x36973c(0x212)][_0x36973c(0x1e0)](_0x482729[_0x36973c(0x1e3)],_0x482729[_0x36973c(0x1f4)],{[constants_1[_0x36973c(0x203)]+_0x36973c(0x21d)]:_0x38cc1b});}async[a238_0x566438(0x1ee)](_0x13f939){const _0xc06ecc=a238_0x566438;await this[_0xc06ecc(0x212)]['patchObject'](constants_1[_0xc06ecc(0x203)]+_0xc06ecc(0x235),_0x13f939,{[constants_1[_0xc06ecc(0x203)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a238_0x566438(0x1dd)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a238_0x566438(0x1ea)],salesforce_service_1[a238_0x566438(0x221)]])],SalesforceSyncService),exports[a238_0x566438(0x228)]=SalesforceSyncService;