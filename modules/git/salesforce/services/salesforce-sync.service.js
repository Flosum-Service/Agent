const a238_0x346e09=a238_0x55b9;(function(_0x252c3e,_0x185129){const _0x570600=a238_0x55b9,_0x5429a1=_0x252c3e();while(!![]){try{const _0x70abdf=parseInt(_0x570600(0xee))/0x1+parseInt(_0x570600(0x10e))/0x2*(-parseInt(_0x570600(0x118))/0x3)+parseInt(_0x570600(0xe3))/0x4*(parseInt(_0x570600(0xfd))/0x5)+parseInt(_0x570600(0xed))/0x6+parseInt(_0x570600(0xe4))/0x7+-parseInt(_0x570600(0xfa))/0x8+-parseInt(_0x570600(0x120))/0x9;if(_0x70abdf===_0x185129)break;else _0x5429a1['push'](_0x5429a1['shift']());}catch(_0x3a5096){_0x5429a1['push'](_0x5429a1['shift']());}}}(a238_0x21d9,0x55fb8));const a238_0x4fd7f9=(function(){let _0x4ac62b=!![];return function(_0x415861,_0x24924e){const _0x32b22e=_0x4ac62b?function(){if(_0x24924e){const _0x1613f8=_0x24924e['apply'](_0x415861,arguments);return _0x24924e=null,_0x1613f8;}}:function(){};return _0x4ac62b=![],_0x32b22e;};}()),a238_0x5766d2=a238_0x4fd7f9(this,function(){const _0x495032=a238_0x55b9;return a238_0x5766d2[_0x495032(0xd9)]()['search']('(((.+)+)+)+$')['toString']()[_0x495032(0xe9)](a238_0x5766d2)[_0x495032(0xf4)](_0x495032(0xf9));});a238_0x5766d2();function a238_0x55b9(_0x33582c,_0x5e02a7){const _0x143826=a238_0x21d9();return a238_0x55b9=function(_0x5766d2,_0x4fd7f9){_0x5766d2=_0x5766d2-0xcd;let _0x21d99b=_0x143826[_0x5766d2];return _0x21d99b;},a238_0x55b9(_0x33582c,_0x5e02a7);}'use strict';function a238_0x21d9(){const _0x41bf42=['\x0a\x20\x20\x20\x20\x20\x20\x20\x20','defineProperty','Sync_In_Progress__c','../queries','constructor','SalesforceNotFoundError','typedi','catch','2503194lAgNgk','548546mZMLdJ','function','query','GET_BRANCH_QUERY','objectType','Branch\x20','search','repositoryId','getRepositoryRecords','FLOSUM_GIT_NAMESPACE','getComponents','(((.+)+)+)+$','1410000iNpoti','Branch_Name__c','salesforceService','5855qRuTHF','GET_WAITING_BRANCHES_QUERY','\x20not\x20found\x20on\x20salesforce','Connection__c','patchObject','../../../../constants/errors','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','metadata','__decorate','map','getOwnPropertyDescriptor','GET_WAITING_REPOSITORIES_QUERY','encodeBase64','Repository\x20with\x20Id\x20','getRemoteStateAttachmentId','Branch\x20with\x20Id\x20','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','2NyfMld','__esModule','getBranchRecord','getRepositoryRecord','GET_COMPONENTS_QUERY','SalesforceQueryService','ERR_INVALID_ATTACHMENT_ID','length','%id%','%parentId%','456804oZuTTG','SalesforceSyncService','objectId','disableSync','GET_BRANCH_BY_NAME_QUERY','Components__r','getAttachmentId','salesforceQuery','10329399RuQNJV','object','Name','decorate','__metadata','fromRepositoryRecord','updateRemoteState','GET_REPOSITORY_BY_NAME_QUERY','../dto/flosum-repository-sync.dto','records','Service','getAllRepositoryNames','./salesforce-query.service','createObject','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','fromBranchRecord','\x0a\x20\x20\x20\x20\x20\x20','%name%','GET_REPOSITORIES_NAMES_QUERY','Attachment','toString','replace','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','SYNC_ATTACHMENT_FOR_BRANCH_NAME','GET_REPOSITORY_QUERY','Repository__r','stringify','../../../shared/utils','Repository\x20','FlosumRepositorySyncDto','972PpBAgi','4046805wjjaJd'];a238_0x21d9=function(){return _0x41bf42;};return a238_0x21d9();}var __decorate=this&&this[a238_0x346e09(0x105)]||function(_0x52db7b,_0x41254c,_0x53b9c4,_0x379e74){const _0x533344=a238_0x346e09;var _0x1cda73=arguments[_0x533344(0x115)],_0x21bd5b=_0x1cda73<0x3?_0x41254c:_0x379e74===null?_0x379e74=Object[_0x533344(0x107)](_0x41254c,_0x53b9c4):_0x379e74,_0x2e67c1;if(typeof Reflect===_0x533344(0x121)&&typeof Reflect[_0x533344(0x123)]===_0x533344(0xef))_0x21bd5b=Reflect[_0x533344(0x123)](_0x52db7b,_0x41254c,_0x53b9c4,_0x379e74);else{for(var _0x3d51ba=_0x52db7b[_0x533344(0x115)]-0x1;_0x3d51ba>=0x0;_0x3d51ba--)if(_0x2e67c1=_0x52db7b[_0x3d51ba])_0x21bd5b=(_0x1cda73<0x3?_0x2e67c1(_0x21bd5b):_0x1cda73>0x3?_0x2e67c1(_0x41254c,_0x53b9c4,_0x21bd5b):_0x2e67c1(_0x41254c,_0x53b9c4))||_0x21bd5b;}return _0x1cda73>0x3&&_0x21bd5b&&Object['defineProperty'](_0x41254c,_0x53b9c4,_0x21bd5b),_0x21bd5b;},__metadata=this&&this[a238_0x346e09(0x124)]||function(_0x4ecb63,_0x24decc){const _0x1da723=a238_0x346e09;if(typeof Reflect===_0x1da723(0x121)&&typeof Reflect[_0x1da723(0x104)]===_0x1da723(0xef))return Reflect[_0x1da723(0x104)](_0x4ecb63,_0x24decc);};Object[a238_0x346e09(0xe6)](exports,a238_0x346e09(0x10f),{'value':!![]}),exports[a238_0x346e09(0x119)]=void 0x0;const typedi_1=require(a238_0x346e09(0xeb)),constants_1=require('../../../../constants'),errors_1=require(a238_0x346e09(0x102)),utils_1=require(a238_0x346e09(0xe0)),flosum_repository_sync_dto_1=require(a238_0x346e09(0xcd)),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a238_0x346e09(0xe8)),salesforce_query_service_1=require(a238_0x346e09(0xd1)),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0x452434,_0x1ffa82){const _0x1643c0=a238_0x346e09;this[_0x1643c0(0x11f)]=_0x452434,this['salesforceService']=_0x1ffa82;}async[a238_0x346e09(0xf8)](_0x4bd4ab){const _0x5e837e=a238_0x346e09;var _0xa60f44;const _0x55b1d0=await this['salesforceQuery']['query'](_0x4bd4ab),_0x4f7b5f=[];for(const _0x5b92ab of _0x55b1d0){const _0xd98891=(_0xa60f44=_0x5b92ab[constants_1['FLOSUM_NAMESPACE']+_0x5e837e(0x11d)])===null||_0xa60f44===void 0x0?void 0x0:_0xa60f44[_0x5e837e(0xce)];_0xd98891&&_0xd98891[_0x5e837e(0x115)]&&_0x4f7b5f['push'](_0xd98891[0x0]['Id']);}return _0x4f7b5f;}async[a238_0x346e09(0xd0)](_0x477178){const _0x929a20=a238_0x346e09,_0x2d2df3=await this['salesforceQuery'][_0x929a20(0xf0)](queries_1[_0x929a20(0xd7)][_0x929a20(0xda)](/\%connection_id\%/g,_0x477178));return _0x2d2df3[_0x929a20(0x106)](_0x3df2e5=>{const _0x4f6ede=_0x929a20;return _0x3df2e5[constants_1[_0x4f6ede(0xf7)]+_0x4f6ede(0xde)]?_0x3df2e5[constants_1['FLOSUM_GIT_NAMESPACE']+_0x4f6ede(0xde)]['Name']:_0x3df2e5[_0x4f6ede(0x122)];});}async[a238_0x346e09(0xf6)](_0x126f9f){const _0x2ba04a=a238_0x346e09,_0x2b550a=await this[_0x2ba04a(0x11f)][_0x2ba04a(0xf0)](queries_1[_0x2ba04a(0x108)][_0x2ba04a(0xda)](/\%connection_id\%/g,_0x126f9f));return _0x2b550a[_0x2ba04a(0x106)](_0x7601dc=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x2ba04a(0x125)](_0x7601dc));}async['getBranchRecords'](_0x349132){const _0x370d43=a238_0x346e09,_0x15baf1=await this[_0x370d43(0x11f)]['query'](queries_1[_0x370d43(0xfe)][_0x370d43(0xda)](/%repositories_ids\%/g,_0x349132));return _0x15baf1[_0x370d43(0x106)](_0x285bba=>flosum_repository_sync_dto_1[_0x370d43(0xe2)][_0x370d43(0xd4)](_0x285bba));}async[a238_0x346e09(0x111)](_0xa3efa0){const _0x2245b4=a238_0x346e09,_0x40572d=await this[_0x2245b4(0x11f)][_0x2245b4(0xf0)](queries_1[_0x2245b4(0xdd)][_0x2245b4(0xda)](_0x2245b4(0x116),_0xa3efa0));if(_0x40572d[_0x2245b4(0x115)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x2245b4(0x10a)+_0xa3efa0+_0x2245b4(0xff));return flosum_repository_sync_dto_1[_0x2245b4(0xe2)]['fromRepositoryRecord'](_0x40572d[0x0]);}async[a238_0x346e09(0x110)](_0x4d267e){const _0x16db5e=a238_0x346e09,_0x1c8f2a=await this[_0x16db5e(0x11f)][_0x16db5e(0xf0)](queries_1[_0x16db5e(0xf1)][_0x16db5e(0xda)](_0x16db5e(0x116),_0x4d267e));if(_0x1c8f2a[_0x16db5e(0x115)]===0x0)throw new not_found_error_1[(_0x16db5e(0xea))](_0x16db5e(0x10c)+_0x4d267e+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x16db5e(0xd4)](_0x1c8f2a[0x0]);}async['getBranchRecordByName'](_0x21d712){const _0x24b9b6=a238_0x346e09,_0x4da8ff=await this[_0x24b9b6(0x11f)][_0x24b9b6(0xf0)](queries_1[_0x24b9b6(0x11c)]['replace'](_0x24b9b6(0xd6),_0x21d712));if(_0x4da8ff[_0x24b9b6(0x115)]===0x0)throw new not_found_error_1[(_0x24b9b6(0xea))](_0x24b9b6(0xf3)+_0x21d712+_0x24b9b6(0xff));const _0x2a97f0=_0x4da8ff['find'](_0x4e62c3=>_0x4e62c3[constants_1['FLOSUM_NAMESPACE']+_0x24b9b6(0xfb)]===_0x21d712);if(!_0x2a97f0)throw new not_found_error_1[(_0x24b9b6(0xea))]('Branch\x20'+_0x21d712+_0x24b9b6(0xff));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x24b9b6(0xd4)](_0x2a97f0);}async['getRepositoryRecordByName'](_0x252401){const _0x58c88e=a238_0x346e09,_0x30bb09=await this['salesforceQuery'][_0x58c88e(0xf0)](queries_1[_0x58c88e(0x127)][_0x58c88e(0xda)](_0x58c88e(0xd6),_0x252401));if(_0x30bb09[_0x58c88e(0x115)]===0x0)throw new not_found_error_1[(_0x58c88e(0xea))](_0x58c88e(0xe1)+_0x252401+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x58c88e(0xe2)][_0x58c88e(0x125)](_0x30bb09[0x0]);}async['getComponentsFromRepository'](_0x1a48f5){const _0x496d98=a238_0x346e09,_0x5a147e=_0x496d98(0xd5)+queries_1['GET_COMPONENTS_QUERY']+_0x496d98(0xdb)+_0x1a48f5+'\x27';return this[_0x496d98(0xf8)](_0x5a147e);}async['getBranchComponents'](_0x29f53a){const _0x5b3b81=a238_0x346e09,_0x6effbd=_0x5b3b81(0xe5)+queries_1[_0x5b3b81(0x112)]+_0x5b3b81(0xd3)+_0x29f53a+'\x27';return this[_0x5b3b81(0xf8)](_0x6effbd);}async['getAttachmentId'](_0x3958e0){const _0x3a3fcb=a238_0x346e09;var _0xe73ac7;const _0x427a95=queries_1[_0x3a3fcb(0x103)][_0x3a3fcb(0xda)](_0x3a3fcb(0x117),_0x3958e0[_0x3a3fcb(0x11a)])[_0x3a3fcb(0xda)](_0x3a3fcb(0xd6),_0x3958e0['repositoryId']?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x3a3fcb(0xdc)]),_0x45e8a2=await this[_0x3a3fcb(0x11f)][_0x3a3fcb(0xf0)](_0x427a95),_0x5065f3=(_0xe73ac7=_0x45e8a2[0x0])===null||_0xe73ac7===void 0x0?void 0x0:_0xe73ac7['Id'];if(!_0x5065f3)throw new Error(errors_1[_0x3a3fcb(0x114)]);return _0x5065f3;}async[a238_0x346e09(0x10b)](_0x229748){const _0x5cc1eb=a238_0x346e09;let _0x1bfced=await this[_0x5cc1eb(0x11e)](_0x229748)[_0x5cc1eb(0xec)](()=>null);return!_0x1bfced&&(_0x1bfced=await this[_0x5cc1eb(0xfc)][_0x5cc1eb(0xd2)]('Attachment',{'Body':(0x0,utils_1[_0x5cc1eb(0x109)])('{}'),'ParentId':_0x229748['objectId'],'ContentType':'text/plain','Name':_0x229748[_0x5cc1eb(0xf5)]?constants_1[_0x5cc1eb(0x10d)]:constants_1[_0x5cc1eb(0xdc)]})),_0x1bfced;}async[a238_0x346e09(0x126)](_0x3e9fbd,_0x4cfe4a){const _0x402eac=a238_0x346e09,_0x1e6d7c=await this[_0x402eac(0x10b)](_0x3e9fbd);await this[_0x402eac(0xfc)][_0x402eac(0x101)](_0x402eac(0xd8),_0x1e6d7c,{'Body':(0x0,utils_1[_0x402eac(0x109)])(JSON[_0x402eac(0xdf)](_0x4cfe4a))});}async['setStatus'](_0x47de88,_0x291e55){const _0x4ca0cd=a238_0x346e09;await this[_0x4ca0cd(0xfc)][_0x4ca0cd(0x101)](_0x47de88[_0x4ca0cd(0xf2)],_0x47de88[_0x4ca0cd(0x11a)],{[constants_1['FLOSUM_GIT_NAMESPACE']+'Synchronization_Status__c']:_0x291e55});}async[a238_0x346e09(0x11b)](_0x197f76){const _0xa6c565=a238_0x346e09;await this[_0xa6c565(0xfc)][_0xa6c565(0x101)](constants_1['FLOSUM_GIT_NAMESPACE']+_0xa6c565(0x100),_0x197f76,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0xa6c565(0xe7)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a238_0x346e09(0xcf)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a238_0x346e09(0x113)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports[a238_0x346e09(0x119)]=SalesforceSyncService;