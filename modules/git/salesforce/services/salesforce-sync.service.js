const a280_0x136749=a280_0x5797;(function(_0x2daf72,_0x3c1436){const _0x6eddf4=a280_0x5797,_0x1b8363=_0x2daf72();while(!![]){try{const _0x32c051=parseInt(_0x6eddf4(0xed))/0x1*(parseInt(_0x6eddf4(0xdb))/0x2)+parseInt(_0x6eddf4(0xdd))/0x3*(-parseInt(_0x6eddf4(0x11a))/0x4)+parseInt(_0x6eddf4(0xef))/0x5*(parseInt(_0x6eddf4(0xfb))/0x6)+parseInt(_0x6eddf4(0xd6))/0x7*(parseInt(_0x6eddf4(0xcf))/0x8)+-parseInt(_0x6eddf4(0x111))/0x9+parseInt(_0x6eddf4(0xe8))/0xa+-parseInt(_0x6eddf4(0xe7))/0xb*(parseInt(_0x6eddf4(0x108))/0xc);if(_0x32c051===_0x3c1436)break;else _0x1b8363['push'](_0x1b8363['shift']());}catch(_0x41ff44){_0x1b8363['push'](_0x1b8363['shift']());}}}(a280_0x6ca1,0xb0f18));const a280_0x4a37d8=(function(){let _0x124eed=!![];return function(_0x50e303,_0x475bbe){const _0x487ce4=_0x124eed?function(){const _0xfbad88=a280_0x5797;if(_0x475bbe){const _0x233987=_0x475bbe[_0xfbad88(0x10e)](_0x50e303,arguments);return _0x475bbe=null,_0x233987;}}:function(){};return _0x124eed=![],_0x487ce4;};}()),a280_0x576a23=a280_0x4a37d8(this,function(){const _0x1b2c37=a280_0x5797;return a280_0x576a23[_0x1b2c37(0xc4)]()['search']('(((.+)+)+)+$')[_0x1b2c37(0xc4)]()[_0x1b2c37(0xd4)](a280_0x576a23)[_0x1b2c37(0x114)]('(((.+)+)+)+$');});a280_0x576a23();function a280_0x5797(_0x3dfa7f,_0x28613c){const _0x5b0aef=a280_0x6ca1();return a280_0x5797=function(_0x576a23,_0x4a37d8){_0x576a23=_0x576a23-0xc0;let _0x6ca1b5=_0x5b0aef[_0x576a23];return _0x6ca1b5;},a280_0x5797(_0x3dfa7f,_0x28613c);}'use strict';var __decorate=this&&this[a280_0x136749(0xfa)]||function(_0xe3ca15,_0x401671,_0xf45c77,_0x5c9bea){const _0x331efe=a280_0x136749;var _0x1ed362=arguments['length'],_0x2b7418=_0x1ed362<0x3?_0x401671:_0x5c9bea===null?_0x5c9bea=Object[_0x331efe(0x103)](_0x401671,_0xf45c77):_0x5c9bea,_0x1d731b;if(typeof Reflect==='object'&&typeof Reflect[_0x331efe(0xdc)]===_0x331efe(0x117))_0x2b7418=Reflect[_0x331efe(0xdc)](_0xe3ca15,_0x401671,_0xf45c77,_0x5c9bea);else{for(var _0x30c993=_0xe3ca15['length']-0x1;_0x30c993>=0x0;_0x30c993--)if(_0x1d731b=_0xe3ca15[_0x30c993])_0x2b7418=(_0x1ed362<0x3?_0x1d731b(_0x2b7418):_0x1ed362>0x3?_0x1d731b(_0x401671,_0xf45c77,_0x2b7418):_0x1d731b(_0x401671,_0xf45c77))||_0x2b7418;}return _0x1ed362>0x3&&_0x2b7418&&Object[_0x331efe(0xd1)](_0x401671,_0xf45c77,_0x2b7418),_0x2b7418;},__metadata=this&&this[a280_0x136749(0xd7)]||function(_0x4b0ee2,_0x467732){const _0x1b9bd9=a280_0x136749;if(typeof Reflect===_0x1b9bd9(0xd8)&&typeof Reflect[_0x1b9bd9(0x11c)]===_0x1b9bd9(0x117))return Reflect[_0x1b9bd9(0x11c)](_0x4b0ee2,_0x467732);};Object[a280_0x136749(0xd1)](exports,a280_0x136749(0xe2),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require('typedi'),constants_1=require(a280_0x136749(0x10b)),errors_1=require(a280_0x136749(0xcb)),utils_1=require(a280_0x136749(0x10f)),flosum_repository_sync_dto_1=require(a280_0x136749(0xf0)),not_found_error_1=require(a280_0x136749(0xe5)),queries_1=require('../queries'),salesforce_query_service_1=require(a280_0x136749(0x115)),salesforce_service_1=require('./salesforce.service');function a280_0x6ca1(){const _0x413ce4=['GET_REPOSITORIES_NAMES_QUERY','getBranchRecord','apply','../../../shared/utils','Branch\x20with\x20Id\x20','1796085aRbyWh','getComponents','SalesforceSyncService','search','./salesforce-query.service','GET_REPOSITORY_BY_NAME_QUERY','function','getAttachmentId','Repository\x20','176EMBQuk','replace','metadata','map','createObject','SalesforceNotFoundError','query','Name','Repository\x20with\x20Id\x20','getAllRepositoryNames','toString','\x20not\x20found\x20on\x20salesforce','FLOSUM_NAMESPACE','%id%','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','FLOSUM_GIT_NAMESPACE','updateRemoteState','../../../../constants/errors','Attachment','patchObject','GET_BRANCH_QUERY','32ttMATY','text/plain','defineProperty','salesforceQuery','getBranchComponents','constructor','FlosumRepositorySyncDto','398958vsSsPd','__metadata','object','GET_BRANCH_BY_NAME_QUERY','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','10xXGCjD','decorate','72312Osuaod','getComponentsFromRepository','GET_WAITING_REPOSITORIES_QUERY','%parentId%','push','__esModule','%name%','Repository__r','../errors/not-found.error','getRemoteStateAttachmentId','77xdqfhb','11762450TJSVEL','repositoryId','objectId','catch','ERR_INVALID_ATTACHMENT_ID','214442xAGpNK','Branch_Name__c','755qVOGeU','../dto/flosum-repository-sync.dto','\x0a\x20\x20\x20\x20\x20\x20','SYNC_ATTACHMENT_FOR_BRANCH_NAME','fromRepositoryRecord','Branch\x20','GET_COMPONENTS_QUERY','Service','SalesforceQueryService','records','getBranchRecordByName','__decorate','10914AlKUmJ','salesforceService','objectType','getRepositoryRecord','GET_REPOSITORY_QUERY','Components__r','length','Sync_In_Progress__c','getOwnPropertyDescriptor','fromBranchRecord','stringify','Connection__c','encodeBase64','1313484uXxkhY','Synchronization_Status__c','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','../../../../constants'];a280_0x6ca1=function(){return _0x413ce4;};return a280_0x6ca1();}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x1f3f4a,_0x585a22){const _0x5934d1=a280_0x136749;this[_0x5934d1(0xd2)]=_0x1f3f4a,this[_0x5934d1(0xfc)]=_0x585a22;}async['getComponents'](_0x108f70){const _0x382c68=a280_0x136749;var _0x57121c;const _0x3e6909=await this[_0x382c68(0xd2)]['query'](_0x108f70),_0x3113fa=[];for(const _0x2d8cf5 of _0x3e6909){const _0x53b47b=(_0x57121c=_0x2d8cf5[constants_1[_0x382c68(0xc6)]+_0x382c68(0x100)])===null||_0x57121c===void 0x0?void 0x0:_0x57121c[_0x382c68(0xf8)];_0x53b47b&&_0x53b47b[_0x382c68(0x101)]&&_0x3113fa[_0x382c68(0xe1)](_0x53b47b[0x0]['Id']);}return _0x3113fa;}async[a280_0x136749(0xc3)](_0x372e50){const _0x2fd383=a280_0x136749,_0x484f12=await this[_0x2fd383(0xd2)][_0x2fd383(0xc0)](queries_1[_0x2fd383(0x10c)][_0x2fd383(0x11b)](/\%connection_id\%/g,_0x372e50));return _0x484f12[_0x2fd383(0x11d)](_0x11ca06=>{const _0x1f3ff6=_0x2fd383;return _0x11ca06[constants_1['FLOSUM_GIT_NAMESPACE']+_0x1f3ff6(0xe4)]?_0x11ca06[constants_1[_0x1f3ff6(0xc9)]+_0x1f3ff6(0xe4)][_0x1f3ff6(0xc1)]:_0x11ca06['Name'];});}async['getRepositoryRecords'](_0x53ecba){const _0x4bafeb=a280_0x136749,_0x1ae795=await this[_0x4bafeb(0xd2)]['query'](queries_1[_0x4bafeb(0xdf)]['replace'](/\%connection_id\%/g,_0x53ecba));return _0x1ae795[_0x4bafeb(0x11d)](_0x1a7ecb=>flosum_repository_sync_dto_1[_0x4bafeb(0xd5)][_0x4bafeb(0xf3)](_0x1a7ecb));}async['getBranchRecords'](_0x435814){const _0x39668b=a280_0x136749,_0x17fd59=await this['salesforceQuery'][_0x39668b(0xc0)](queries_1['GET_WAITING_BRANCHES_QUERY']['replace'](/%repositories_ids\%/g,_0x435814));return _0x17fd59[_0x39668b(0x11d)](_0x1979c4=>flosum_repository_sync_dto_1[_0x39668b(0xd5)][_0x39668b(0x104)](_0x1979c4));}async[a280_0x136749(0xfe)](_0x5314ff){const _0x138503=a280_0x136749,_0x468d3e=await this[_0x138503(0xd2)][_0x138503(0xc0)](queries_1[_0x138503(0xff)]['replace']('%id%',_0x5314ff));if(_0x468d3e[_0x138503(0x101)]===0x0)throw new not_found_error_1[(_0x138503(0x11f))](_0x138503(0xc2)+_0x5314ff+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x138503(0xd5)]['fromRepositoryRecord'](_0x468d3e[0x0]);}async[a280_0x136749(0x10d)](_0x57f745){const _0xd4ee11=a280_0x136749,_0x7e2c42=await this[_0xd4ee11(0xd2)][_0xd4ee11(0xc0)](queries_1[_0xd4ee11(0xce)][_0xd4ee11(0x11b)](_0xd4ee11(0xc7),_0x57f745));if(_0x7e2c42[_0xd4ee11(0x101)]===0x0)throw new not_found_error_1[(_0xd4ee11(0x11f))](_0xd4ee11(0x110)+_0x57f745+_0xd4ee11(0xc5));return flosum_repository_sync_dto_1[_0xd4ee11(0xd5)][_0xd4ee11(0x104)](_0x7e2c42[0x0]);}async[a280_0x136749(0xf9)](_0x3c7ac7){const _0x2bfcfa=a280_0x136749,_0x2edace=await this[_0x2bfcfa(0xd2)][_0x2bfcfa(0xc0)](queries_1[_0x2bfcfa(0xd9)][_0x2bfcfa(0x11b)](_0x2bfcfa(0xe3),_0x3c7ac7));if(_0x2edace[_0x2bfcfa(0x101)]===0x0)throw new not_found_error_1[(_0x2bfcfa(0x11f))](_0x2bfcfa(0xf4)+_0x3c7ac7+_0x2bfcfa(0xc5));const _0x4173bb=_0x2edace['find'](_0x3e19ba=>_0x3e19ba[constants_1[_0x2bfcfa(0xc6)]+_0x2bfcfa(0xee)]===_0x3c7ac7);if(!_0x4173bb)throw new not_found_error_1[(_0x2bfcfa(0x11f))](_0x2bfcfa(0xf4)+_0x3c7ac7+_0x2bfcfa(0xc5));return flosum_repository_sync_dto_1[_0x2bfcfa(0xd5)][_0x2bfcfa(0x104)](_0x4173bb);}async['getRepositoryRecordByName'](_0x2a4ab9){const _0xdedfe3=a280_0x136749,_0x287d18=await this[_0xdedfe3(0xd2)]['query'](queries_1[_0xdedfe3(0x116)][_0xdedfe3(0x11b)]('%name%',_0x2a4ab9));if(_0x287d18[_0xdedfe3(0x101)]===0x0)throw new not_found_error_1[(_0xdedfe3(0x11f))](_0xdedfe3(0x119)+_0x2a4ab9+_0xdedfe3(0xc5));return flosum_repository_sync_dto_1[_0xdedfe3(0xd5)][_0xdedfe3(0xf3)](_0x287d18[0x0]);}async[a280_0x136749(0xde)](_0x369e60){const _0x148e20=a280_0x136749,_0x3692ff=_0x148e20(0xf1)+queries_1[_0x148e20(0xf5)]+_0x148e20(0xda)+_0x369e60+'\x27';return this['getComponents'](_0x3692ff);}async[a280_0x136749(0xd3)](_0x54a867){const _0x2d984d=a280_0x136749,_0x5754e3='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x2d984d(0xf5)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x54a867+'\x27';return this[_0x2d984d(0x112)](_0x5754e3);}async[a280_0x136749(0x118)](_0x101a16){const _0x6d30a5=a280_0x136749;var _0x5a4fe0;const _0x2c65dc=queries_1[_0x6d30a5(0xc8)][_0x6d30a5(0x11b)](_0x6d30a5(0xe0),_0x101a16[_0x6d30a5(0xea)])[_0x6d30a5(0x11b)](_0x6d30a5(0xe3),_0x101a16[_0x6d30a5(0xe9)]?constants_1[_0x6d30a5(0x10a)]:constants_1[_0x6d30a5(0xf2)]),_0x25356e=await this['salesforceQuery'][_0x6d30a5(0xc0)](_0x2c65dc),_0x5342a0=(_0x5a4fe0=_0x25356e[0x0])===null||_0x5a4fe0===void 0x0?void 0x0:_0x5a4fe0['Id'];if(!_0x5342a0)throw new Error(errors_1[_0x6d30a5(0xec)]);return _0x5342a0;}async[a280_0x136749(0xe6)](_0x544b41){const _0x39e953=a280_0x136749;let _0x129249=await this[_0x39e953(0x118)](_0x544b41)[_0x39e953(0xeb)](()=>null);return!_0x129249&&(_0x129249=await this[_0x39e953(0xfc)][_0x39e953(0x11e)](_0x39e953(0xcc),{'Body':(0x0,utils_1[_0x39e953(0x107)])('{}'),'ParentId':_0x544b41['objectId'],'ContentType':_0x39e953(0xd0),'Name':_0x544b41['repositoryId']?constants_1[_0x39e953(0x10a)]:constants_1[_0x39e953(0xf2)]})),_0x129249;}async[a280_0x136749(0xca)](_0x5d1c9d,_0x3a17b3){const _0x1b2246=a280_0x136749,_0x21fb88=await this['getRemoteStateAttachmentId'](_0x5d1c9d);await this[_0x1b2246(0xfc)]['patchObject'](_0x1b2246(0xcc),_0x21fb88,{'Body':(0x0,utils_1[_0x1b2246(0x107)])(JSON[_0x1b2246(0x105)](_0x3a17b3))});}async['setStatus'](_0x55a8c6,_0xdef93f){const _0x1d52c1=a280_0x136749;await this['salesforceService'][_0x1d52c1(0xcd)](_0x55a8c6[_0x1d52c1(0xfd)],_0x55a8c6['objectId'],{[constants_1[_0x1d52c1(0xc9)]+_0x1d52c1(0x109)]:_0xdef93f});}async['disableSync'](_0x3161ac){const _0xb84d80=a280_0x136749;await this['salesforceService']['patchObject'](constants_1[_0xb84d80(0xc9)]+_0xb84d80(0x106),_0x3161ac,{[constants_1[_0xb84d80(0xc9)]+_0xb84d80(0x102)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a280_0x136749(0xf6)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a280_0x136749(0xf7)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports[a280_0x136749(0x113)]=SalesforceSyncService;