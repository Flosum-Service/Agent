const a281_0x2795d8=a281_0x4efe;(function(_0x5e8ce7,_0x4d7f20){const _0x58681d=a281_0x4efe,_0x161aa4=_0x5e8ce7();while(!![]){try{const _0x319902=-parseInt(_0x58681d(0x108))/0x1+-parseInt(_0x58681d(0x12b))/0x2+-parseInt(_0x58681d(0x10c))/0x3+parseInt(_0x58681d(0x144))/0x4+-parseInt(_0x58681d(0x12c))/0x5+-parseInt(_0x58681d(0x13f))/0x6*(parseInt(_0x58681d(0x102))/0x7)+parseInt(_0x58681d(0x119))/0x8;if(_0x319902===_0x4d7f20)break;else _0x161aa4['push'](_0x161aa4['shift']());}catch(_0x2fd3e8){_0x161aa4['push'](_0x161aa4['shift']());}}}(a281_0x3798,0xe2985));const a281_0x3505f9=(function(){let _0x5cd5ab=!![];return function(_0x570e0e,_0x33efba){const _0x4b6d8d=_0x5cd5ab?function(){const _0xa95c90=a281_0x4efe;if(_0x33efba){const _0x54f212=_0x33efba[_0xa95c90(0x124)](_0x570e0e,arguments);return _0x33efba=null,_0x54f212;}}:function(){};return _0x5cd5ab=![],_0x4b6d8d;};}()),a281_0x518a0d=a281_0x3505f9(this,function(){const _0x3406b4=a281_0x4efe;return a281_0x518a0d[_0x3406b4(0x106)]()[_0x3406b4(0x118)](_0x3406b4(0x141))[_0x3406b4(0x106)]()[_0x3406b4(0x13a)](a281_0x518a0d)['search'](_0x3406b4(0x141));});a281_0x518a0d();'use strict';var __decorate=this&&this['__decorate']||function(_0x3385fd,_0x5f1a87,_0x46344a,_0x54ba18){const _0x18400a=a281_0x4efe;var _0x70b6a7=arguments[_0x18400a(0x12f)],_0x5228b1=_0x70b6a7<0x3?_0x5f1a87:_0x54ba18===null?_0x54ba18=Object[_0x18400a(0x11b)](_0x5f1a87,_0x46344a):_0x54ba18,_0x26db81;if(typeof Reflect===_0x18400a(0x128)&&typeof Reflect[_0x18400a(0x14e)]===_0x18400a(0x132))_0x5228b1=Reflect[_0x18400a(0x14e)](_0x3385fd,_0x5f1a87,_0x46344a,_0x54ba18);else{for(var _0x1642f9=_0x3385fd[_0x18400a(0x12f)]-0x1;_0x1642f9>=0x0;_0x1642f9--)if(_0x26db81=_0x3385fd[_0x1642f9])_0x5228b1=(_0x70b6a7<0x3?_0x26db81(_0x5228b1):_0x70b6a7>0x3?_0x26db81(_0x5f1a87,_0x46344a,_0x5228b1):_0x26db81(_0x5f1a87,_0x46344a))||_0x5228b1;}return _0x70b6a7>0x3&&_0x5228b1&&Object[_0x18400a(0x104)](_0x5f1a87,_0x46344a,_0x5228b1),_0x5228b1;},__metadata=this&&this[a281_0x2795d8(0x14c)]||function(_0x4e490f,_0x5cdb5e){const _0x417d44=a281_0x2795d8;if(typeof Reflect===_0x417d44(0x128)&&typeof Reflect[_0x417d44(0x12d)]==='function')return Reflect[_0x417d44(0x12d)](_0x4e490f,_0x5cdb5e);};Object[a281_0x2795d8(0x104)](exports,a281_0x2795d8(0x113),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require(a281_0x2795d8(0x131)),constants_1=require('../../../../constants'),errors_1=require(a281_0x2795d8(0xf8)),utils_1=require(a281_0x2795d8(0xf4)),flosum_repository_sync_dto_1=require(a281_0x2795d8(0x14f)),not_found_error_1=require(a281_0x2795d8(0xf6)),queries_1=require(a281_0x2795d8(0x11a)),salesforce_query_service_1=require(a281_0x2795d8(0x120)),salesforce_service_1=require(a281_0x2795d8(0xef));function a281_0x4efe(_0x4ee3a4,_0x2f2ed1){const _0x76a30b=a281_0x3798();return a281_0x4efe=function(_0x518a0d,_0x3505f9){_0x518a0d=_0x518a0d-0xef;let _0x3798ea=_0x76a30b[_0x518a0d];return _0x3798ea;},a281_0x4efe(_0x4ee3a4,_0x2f2ed1);}function a281_0x3798(){const _0x536950=['getAttachmentId','Repository\x20','text/plain','apply','%parentId%','query','\x0a\x20\x20\x20\x20\x20\x20','object','SalesforceQueryService','salesforceService','2826742EwoBvh','5596010ODMAsK','metadata','Name','length','getComponentsFromRepository','typedi','function','%name%','GET_REPOSITORY_QUERY','Repository\x20with\x20Id\x20','SYNC_ATTACHMENT_FOR_BRANCH_NAME','find','%id%','fromBranchRecord','constructor','setStatus','Attachment','getRepositoryRecord','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','10854fwszlv','Sync_In_Progress__c','(((.+)+)+)+$','FlosumRepositorySyncDto','Repository__r','4027456hKfBZM','FLOSUM_NAMESPACE','\x20not\x20found\x20on\x20salesforce','disableSync','catch','GET_WAITING_REPOSITORIES_QUERY','getRepositoryRecordByName','getBranchComponents','__metadata','GET_REPOSITORY_BY_NAME_QUERY','decorate','../dto/flosum-repository-sync.dto','GET_WAITING_BRANCHES_QUERY','GET_BRANCH_QUERY','replace','./salesforce.service','patchObject','encodeBase64','GET_REPOSITORIES_NAMES_QUERY','GET_BRANCH_BY_NAME_QUERY','../../../shared/utils','SalesforceSyncService','../errors/not-found.error','Branch\x20','../../../../constants/errors','repositoryId','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','createObject','design:paramtypes','fromRepositoryRecord','map','objectId','getBranchRecords','5166SMPfQd','records','defineProperty','getRemoteStateAttachmentId','toString','salesforceQuery','353075MJpxgt','FLOSUM_GIT_NAMESPACE','GET_COMPONENTS_QUERY','getComponents','4091841uvdJCd','SalesforceService','Branch_Name__c','Synchronization_Status__c','getBranchRecordByName','ERR_INVALID_ATTACHMENT_ID','getBranchRecord','__esModule','getRepositoryRecords','SalesforceNotFoundError','stringify','updateRemoteState','search','44047248CZCZJz','../queries','getOwnPropertyDescriptor','getAllRepositoryNames','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','push','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','./salesforce-query.service'];a281_0x3798=function(){return _0x536950;};return a281_0x3798();}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x26e97a,_0x3bae0b){const _0x45da13=a281_0x2795d8;this[_0x45da13(0x107)]=_0x26e97a,this[_0x45da13(0x12a)]=_0x3bae0b;}async[a281_0x2795d8(0x10b)](_0x41d676){const _0x434627=a281_0x2795d8;var _0x5afd75;const _0x2ea3e8=await this[_0x434627(0x107)][_0x434627(0x126)](_0x41d676),_0x2f9772=[];for(const _0x904ced of _0x2ea3e8){const _0x1a991b=(_0x5afd75=_0x904ced[constants_1[_0x434627(0x145)]+'Components__r'])===null||_0x5afd75===void 0x0?void 0x0:_0x5afd75[_0x434627(0x103)];_0x1a991b&&_0x1a991b[_0x434627(0x12f)]&&_0x2f9772[_0x434627(0x11e)](_0x1a991b[0x0]['Id']);}return _0x2f9772;}async[a281_0x2795d8(0x11c)](_0x12b36c){const _0x2bc637=a281_0x2795d8,_0x2a71c8=await this[_0x2bc637(0x107)][_0x2bc637(0x126)](queries_1[_0x2bc637(0xf2)][_0x2bc637(0x152)](/\%connection_id\%/g,_0x12b36c));return _0x2a71c8[_0x2bc637(0xff)](_0x2cc381=>{const _0x25833d=_0x2bc637;return _0x2cc381[constants_1[_0x25833d(0x109)]+'Repository__r']?_0x2cc381[constants_1[_0x25833d(0x109)]+_0x25833d(0x143)][_0x25833d(0x12e)]:_0x2cc381[_0x25833d(0x12e)];});}async[a281_0x2795d8(0x114)](_0x5bb635){const _0x3ed00f=a281_0x2795d8,_0x317c35=await this[_0x3ed00f(0x107)]['query'](queries_1[_0x3ed00f(0x149)]['replace'](/\%connection_id\%/g,_0x5bb635));return _0x317c35[_0x3ed00f(0xff)](_0x5e6740=>flosum_repository_sync_dto_1[_0x3ed00f(0x142)][_0x3ed00f(0xfe)](_0x5e6740));}async[a281_0x2795d8(0x101)](_0x226c3a){const _0x2a6711=a281_0x2795d8,_0x4e0d13=await this[_0x2a6711(0x107)][_0x2a6711(0x126)](queries_1[_0x2a6711(0x150)]['replace'](/%repositories_ids\%/g,_0x226c3a));return _0x4e0d13[_0x2a6711(0xff)](_0x2cf6a8=>flosum_repository_sync_dto_1[_0x2a6711(0x142)][_0x2a6711(0x139)](_0x2cf6a8));}async[a281_0x2795d8(0x13d)](_0x479218){const _0x30661d=a281_0x2795d8,_0xf50236=await this[_0x30661d(0x107)][_0x30661d(0x126)](queries_1[_0x30661d(0x134)][_0x30661d(0x152)]('%id%',_0x479218));if(_0xf50236[_0x30661d(0x12f)]===0x0)throw new not_found_error_1[(_0x30661d(0x115))](_0x30661d(0x135)+_0x479218+_0x30661d(0x146));return flosum_repository_sync_dto_1[_0x30661d(0x142)][_0x30661d(0xfe)](_0xf50236[0x0]);}async[a281_0x2795d8(0x112)](_0x1a3445){const _0x485d75=a281_0x2795d8,_0x347ca4=await this[_0x485d75(0x107)][_0x485d75(0x126)](queries_1[_0x485d75(0x151)][_0x485d75(0x152)](_0x485d75(0x138),_0x1a3445));if(_0x347ca4['length']===0x0)throw new not_found_error_1[(_0x485d75(0x115))]('Branch\x20with\x20Id\x20'+_0x1a3445+_0x485d75(0x146));return flosum_repository_sync_dto_1[_0x485d75(0x142)]['fromBranchRecord'](_0x347ca4[0x0]);}async[a281_0x2795d8(0x110)](_0x526cc7){const _0x56354d=a281_0x2795d8,_0xc89e46=await this[_0x56354d(0x107)][_0x56354d(0x126)](queries_1[_0x56354d(0xf3)][_0x56354d(0x152)](_0x56354d(0x133),_0x526cc7));if(_0xc89e46[_0x56354d(0x12f)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x56354d(0xf7)+_0x526cc7+_0x56354d(0x146));const _0x435271=_0xc89e46[_0x56354d(0x137)](_0xabf150=>_0xabf150[constants_1[_0x56354d(0x145)]+_0x56354d(0x10e)]===_0x526cc7);if(!_0x435271)throw new not_found_error_1[(_0x56354d(0x115))]('Branch\x20'+_0x526cc7+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x56354d(0x142)]['fromBranchRecord'](_0x435271);}async[a281_0x2795d8(0x14a)](_0x909ae6){const _0x220fd8=a281_0x2795d8,_0x5d9553=await this[_0x220fd8(0x107)][_0x220fd8(0x126)](queries_1[_0x220fd8(0x14d)][_0x220fd8(0x152)]('%name%',_0x909ae6));if(_0x5d9553[_0x220fd8(0x12f)]===0x0)throw new not_found_error_1[(_0x220fd8(0x115))](_0x220fd8(0x122)+_0x909ae6+_0x220fd8(0x146));return flosum_repository_sync_dto_1[_0x220fd8(0x142)][_0x220fd8(0xfe)](_0x5d9553[0x0]);}async[a281_0x2795d8(0x130)](_0xf923ae){const _0x4c20d1=a281_0x2795d8,_0x5d6064=_0x4c20d1(0x127)+queries_1[_0x4c20d1(0x10a)]+_0x4c20d1(0xfb)+_0xf923ae+'\x27';return this[_0x4c20d1(0x10b)](_0x5d6064);}async[a281_0x2795d8(0x14b)](_0xd4550c){const _0x55d898=a281_0x2795d8,_0x477d4e=_0x55d898(0x11f)+queries_1['GET_COMPONENTS_QUERY']+_0x55d898(0x11d)+_0xd4550c+'\x27';return this[_0x55d898(0x10b)](_0x477d4e);}async[a281_0x2795d8(0x121)](_0x356331){const _0x178f7d=a281_0x2795d8;var _0x2e80ce;const _0x2d9ff3=queries_1[_0x178f7d(0x13e)]['replace'](_0x178f7d(0x125),_0x356331['objectId'])[_0x178f7d(0x152)](_0x178f7d(0x133),_0x356331[_0x178f7d(0xf9)]?constants_1[_0x178f7d(0xfa)]:constants_1[_0x178f7d(0x136)]),_0x486050=await this[_0x178f7d(0x107)][_0x178f7d(0x126)](_0x2d9ff3),_0x51b634=(_0x2e80ce=_0x486050[0x0])===null||_0x2e80ce===void 0x0?void 0x0:_0x2e80ce['Id'];if(!_0x51b634)throw new Error(errors_1[_0x178f7d(0x111)]);return _0x51b634;}async['getRemoteStateAttachmentId'](_0x59cc25){const _0x345245=a281_0x2795d8;let _0x33ec24=await this[_0x345245(0x121)](_0x59cc25)[_0x345245(0x148)](()=>null);return!_0x33ec24&&(_0x33ec24=await this['salesforceService'][_0x345245(0xfc)](_0x345245(0x13c),{'Body':(0x0,utils_1[_0x345245(0xf1)])('{}'),'ParentId':_0x59cc25[_0x345245(0x100)],'ContentType':_0x345245(0x123),'Name':_0x59cc25[_0x345245(0xf9)]?constants_1[_0x345245(0xfa)]:constants_1[_0x345245(0x136)]})),_0x33ec24;}async[a281_0x2795d8(0x117)](_0x537667,_0x50dba3){const _0x392d9b=a281_0x2795d8,_0x3a184e=await this[_0x392d9b(0x105)](_0x537667);await this['salesforceService'][_0x392d9b(0xf0)]('Attachment',_0x3a184e,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0x392d9b(0x116)](_0x50dba3))});}async[a281_0x2795d8(0x13b)](_0x3d7648,_0x1e4210){const _0x38a604=a281_0x2795d8;await this[_0x38a604(0x12a)]['patchObject'](_0x3d7648['objectType'],_0x3d7648['objectId'],{[constants_1[_0x38a604(0x109)]+_0x38a604(0x10f)]:_0x1e4210});}async[a281_0x2795d8(0x147)](_0x5ed96c){const _0x195d63=a281_0x2795d8;await this['salesforceService']['patchObject'](constants_1[_0x195d63(0x109)]+'Connection__c',_0x5ed96c,{[constants_1[_0x195d63(0x109)]+_0x195d63(0x140)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1['Service'])(),__metadata(a281_0x2795d8(0xfd),[salesforce_query_service_1[a281_0x2795d8(0x129)],salesforce_service_1[a281_0x2795d8(0x10d)]])],SalesforceSyncService),exports[a281_0x2795d8(0xf5)]=SalesforceSyncService;