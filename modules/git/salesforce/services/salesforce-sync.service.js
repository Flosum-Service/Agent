const a282_0x308e24=a282_0xf1eb;(function(_0x4a6144,_0x4870a6){const _0x12318a=a282_0xf1eb,_0x72a70a=_0x4a6144();while(!![]){try{const _0x11179c=-parseInt(_0x12318a(0x1c9))/0x1*(-parseInt(_0x12318a(0x1d2))/0x2)+-parseInt(_0x12318a(0x19c))/0x3+parseInt(_0x12318a(0x185))/0x4*(-parseInt(_0x12318a(0x1c8))/0x5)+parseInt(_0x12318a(0x1c5))/0x6*(parseInt(_0x12318a(0x197))/0x7)+-parseInt(_0x12318a(0x1a1))/0x8*(parseInt(_0x12318a(0x1cb))/0x9)+parseInt(_0x12318a(0x193))/0xa+-parseInt(_0x12318a(0x1a8))/0xb;if(_0x11179c===_0x4870a6)break;else _0x72a70a['push'](_0x72a70a['shift']());}catch(_0x2eedba){_0x72a70a['push'](_0x72a70a['shift']());}}}(a282_0x5142,0x3e119));function a282_0xf1eb(_0x33360e,_0x33bd63){const _0x2751ef=a282_0x5142();return a282_0xf1eb=function(_0xfececc,_0x1b289e){_0xfececc=_0xfececc-0x180;let _0x51421f=_0x2751ef[_0xfececc];return _0x51421f;},a282_0xf1eb(_0x33360e,_0x33bd63);}const a282_0x1b289e=(function(){let _0x1c1bd4=!![];return function(_0x1feee4,_0x4308f2){const _0x2d4c52=_0x1c1bd4?function(){const _0x55377e=a282_0xf1eb;if(_0x4308f2){const _0x34287c=_0x4308f2[_0x55377e(0x19d)](_0x1feee4,arguments);return _0x4308f2=null,_0x34287c;}}:function(){};return _0x1c1bd4=![],_0x2d4c52;};}()),a282_0xfececc=a282_0x1b289e(this,function(){const _0x4e97e3=a282_0xf1eb;return a282_0xfececc['toString']()[_0x4e97e3(0x187)](_0x4e97e3(0x195))['toString']()[_0x4e97e3(0x1bc)](a282_0xfececc)['search']('(((.+)+)+)+$');});function a282_0x5142(){const _0x4ed192=['setStatus','GET_WAITING_REPOSITORIES_QUERY','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','287480eOkNyp','disableSync','salesforceService','../dto/flosum-repository-sync.dto','./salesforce.service','design:paramtypes','__metadata','4881492ADGjmZ','SalesforceQueryService','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','GET_REPOSITORIES_NAMES_QUERY','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20','Repository\x20with\x20Id\x20','defineProperty','repositoryId','GET_BRANCH_BY_NAME_QUERY','GET_REPOSITORY_QUERY','GET_BRANCH_QUERY','replace','getAllRepositoryNames','createObject','getComponents','getRepositoryRecordByName','Sync_In_Progress__c','Repository\x20','Branch\x20','constructor','SalesforceService','decorate','metadata','fromBranchRecord','fromRepositoryRecord','SalesforceNotFoundError','%parentId%','objectType','1200dhqpUb','Branch_Name__c','FlosumRepositorySyncDto','815zhqMQL','1QIMXGW','encodeBase64','18rvqCPN','patchObject','FLOSUM_NAMESPACE','getBranchRecords','getAttachmentId','records','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','813626PMMyBc','function','map','objectId','../../../../constants','Connection__c','%id%','../../../../constants/errors','ERR_INVALID_ATTACHMENT_ID','getBranchComponents','push','getComponentsFromRepository','../queries','getBranchRecordByName','3832lnXklY','Components__r','search','salesforceQuery','Synchronization_Status__c','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','getBranchRecord','SalesforceSyncService','getOwnPropertyDescriptor','Name','\x20not\x20found\x20on\x20salesforce','__decorate','%name%','length','2840130Obhsjp','Attachment','(((.+)+)+)+$','FLOSUM_GIT_NAMESPACE','16807LjgXWA','./salesforce-query.service','query','Branch\x20with\x20Id\x20','object','734991JJmaJR','apply'];a282_0x5142=function(){return _0x4ed192;};return a282_0x5142();}a282_0xfececc();'use strict';var __decorate=this&&this[a282_0x308e24(0x190)]||function(_0x47b593,_0x140b76,_0x4dd3f8,_0x2a4255){const _0x45760b=a282_0x308e24;var _0x437506=arguments[_0x45760b(0x192)],_0x40bf43=_0x437506<0x3?_0x140b76:_0x2a4255===null?_0x2a4255=Object[_0x45760b(0x18d)](_0x140b76,_0x4dd3f8):_0x2a4255,_0x3f6b13;if(typeof Reflect===_0x45760b(0x19b)&&typeof Reflect[_0x45760b(0x1be)]==='function')_0x40bf43=Reflect[_0x45760b(0x1be)](_0x47b593,_0x140b76,_0x4dd3f8,_0x2a4255);else{for(var _0x1829e1=_0x47b593['length']-0x1;_0x1829e1>=0x0;_0x1829e1--)if(_0x3f6b13=_0x47b593[_0x1829e1])_0x40bf43=(_0x437506<0x3?_0x3f6b13(_0x40bf43):_0x437506>0x3?_0x3f6b13(_0x140b76,_0x4dd3f8,_0x40bf43):_0x3f6b13(_0x140b76,_0x4dd3f8))||_0x40bf43;}return _0x437506>0x3&&_0x40bf43&&Object[_0x45760b(0x1af)](_0x140b76,_0x4dd3f8,_0x40bf43),_0x40bf43;},__metadata=this&&this[a282_0x308e24(0x1a7)]||function(_0x5e46ab,_0x812a09){const _0xc29136=a282_0x308e24;if(typeof Reflect===_0xc29136(0x19b)&&typeof Reflect['metadata']===_0xc29136(0x1d3))return Reflect[_0xc29136(0x1bf)](_0x5e46ab,_0x812a09);};Object[a282_0x308e24(0x1af)](exports,'__esModule',{'value':!![]}),exports[a282_0x308e24(0x18c)]=void 0x0;const typedi_1=require('typedi'),constants_1=require(a282_0x308e24(0x1d6)),errors_1=require(a282_0x308e24(0x1d9)),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a282_0x308e24(0x1a4)),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a282_0x308e24(0x183)),salesforce_query_service_1=require(a282_0x308e24(0x198)),salesforce_service_1=require(a282_0x308e24(0x1a5));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x23c7d6,_0x168d1f){const _0xc58d1f=a282_0x308e24;this[_0xc58d1f(0x188)]=_0x23c7d6,this[_0xc58d1f(0x1a3)]=_0x168d1f;}async[a282_0x308e24(0x1b7)](_0x1c396f){const _0x160cf2=a282_0x308e24;var _0x51ebe3;const _0x443ef3=await this[_0x160cf2(0x188)][_0x160cf2(0x199)](_0x1c396f),_0x4d429f=[];for(const _0x242a51 of _0x443ef3){const _0x39188e=(_0x51ebe3=_0x242a51[constants_1['FLOSUM_NAMESPACE']+_0x160cf2(0x186)])===null||_0x51ebe3===void 0x0?void 0x0:_0x51ebe3[_0x160cf2(0x1d0)];_0x39188e&&_0x39188e['length']&&_0x4d429f[_0x160cf2(0x181)](_0x39188e[0x0]['Id']);}return _0x4d429f;}async[a282_0x308e24(0x1b5)](_0x126c7d){const _0x281eec=a282_0x308e24,_0x325a46=await this[_0x281eec(0x188)][_0x281eec(0x199)](queries_1[_0x281eec(0x1ab)][_0x281eec(0x1b4)](/\%connection_id\%/g,_0x126c7d));return _0x325a46[_0x281eec(0x1d4)](_0x82d06=>{const _0x58b0fc=_0x281eec;return _0x82d06[constants_1['FLOSUM_GIT_NAMESPACE']+'Repository__r']?_0x82d06[constants_1[_0x58b0fc(0x196)]+'Repository__r']['Name']:_0x82d06[_0x58b0fc(0x18e)];});}async['getRepositoryRecords'](_0x2a9be1){const _0x47f8b1=a282_0x308e24,_0x2c3c68=await this[_0x47f8b1(0x188)]['query'](queries_1[_0x47f8b1(0x19f)]['replace'](/\%connection_id\%/g,_0x2a9be1));return _0x2c3c68[_0x47f8b1(0x1d4)](_0x166a4e=>flosum_repository_sync_dto_1[_0x47f8b1(0x1c7)]['fromRepositoryRecord'](_0x166a4e));}async[a282_0x308e24(0x1ce)](_0x2f7088){const _0xc5656d=a282_0x308e24,_0xd8dcc9=await this[_0xc5656d(0x188)][_0xc5656d(0x199)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0xc5656d(0x1b4)](/%repositories_ids\%/g,_0x2f7088));return _0xd8dcc9['map'](_0xc8ffeb=>flosum_repository_sync_dto_1[_0xc5656d(0x1c7)]['fromBranchRecord'](_0xc8ffeb));}async['getRepositoryRecord'](_0x57557){const _0x4875a4=a282_0x308e24,_0x2e02eb=await this['salesforceQuery'][_0x4875a4(0x199)](queries_1[_0x4875a4(0x1b2)][_0x4875a4(0x1b4)](_0x4875a4(0x1d8),_0x57557));if(_0x2e02eb[_0x4875a4(0x192)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x4875a4(0x1ae)+_0x57557+_0x4875a4(0x18f));return flosum_repository_sync_dto_1[_0x4875a4(0x1c7)][_0x4875a4(0x1c1)](_0x2e02eb[0x0]);}async[a282_0x308e24(0x18b)](_0x50675c){const _0xea85fc=a282_0x308e24,_0x255263=await this[_0xea85fc(0x188)][_0xea85fc(0x199)](queries_1[_0xea85fc(0x1b3)][_0xea85fc(0x1b4)](_0xea85fc(0x1d8),_0x50675c));if(_0x255263['length']===0x0)throw new not_found_error_1[(_0xea85fc(0x1c2))](_0xea85fc(0x19a)+_0x50675c+_0xea85fc(0x18f));return flosum_repository_sync_dto_1[_0xea85fc(0x1c7)][_0xea85fc(0x1c0)](_0x255263[0x0]);}async[a282_0x308e24(0x184)](_0x3f3b55){const _0x131fa3=a282_0x308e24,_0x5dd955=await this[_0x131fa3(0x188)][_0x131fa3(0x199)](queries_1[_0x131fa3(0x1b1)][_0x131fa3(0x1b4)]('%name%',_0x3f3b55));if(_0x5dd955[_0x131fa3(0x192)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x3f3b55+'\x20not\x20found\x20on\x20salesforce');const _0x1be104=_0x5dd955['find'](_0x16b7f7=>_0x16b7f7[constants_1[_0x131fa3(0x1cd)]+_0x131fa3(0x1c6)]===_0x3f3b55);if(!_0x1be104)throw new not_found_error_1[(_0x131fa3(0x1c2))](_0x131fa3(0x1bb)+_0x3f3b55+_0x131fa3(0x18f));return flosum_repository_sync_dto_1[_0x131fa3(0x1c7)][_0x131fa3(0x1c0)](_0x1be104);}async[a282_0x308e24(0x1b8)](_0x1c4690){const _0x31aa9c=a282_0x308e24,_0x1ba6b1=await this[_0x31aa9c(0x188)]['query'](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x31aa9c(0x1b4)](_0x31aa9c(0x191),_0x1c4690));if(_0x1ba6b1['length']===0x0)throw new not_found_error_1[(_0x31aa9c(0x1c2))](_0x31aa9c(0x1ba)+_0x1c4690+_0x31aa9c(0x18f));return flosum_repository_sync_dto_1[_0x31aa9c(0x1c7)][_0x31aa9c(0x1c1)](_0x1ba6b1[0x0]);}async[a282_0x308e24(0x182)](_0x20063d){const _0x4e8970=a282_0x308e24,_0x34a6ca=_0x4e8970(0x1ad)+queries_1['GET_COMPONENTS_QUERY']+_0x4e8970(0x1d1)+_0x20063d+'\x27';return this[_0x4e8970(0x1b7)](_0x34a6ca);}async[a282_0x308e24(0x180)](_0x1088b9){const _0x3d5dfb=a282_0x308e24,_0x2c2293=_0x3d5dfb(0x1ac)+queries_1['GET_COMPONENTS_QUERY']+_0x3d5dfb(0x18a)+_0x1088b9+'\x27';return this[_0x3d5dfb(0x1b7)](_0x2c2293);}async['getAttachmentId'](_0x53b782){const _0xd2334e=a282_0x308e24;var _0x5959fa;const _0x1ec6a3=queries_1[_0xd2334e(0x1aa)][_0xd2334e(0x1b4)](_0xd2334e(0x1c3),_0x53b782[_0xd2334e(0x1d5)])['replace'](_0xd2334e(0x191),_0x53b782[_0xd2334e(0x1b0)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x36d19a=await this['salesforceQuery'][_0xd2334e(0x199)](_0x1ec6a3),_0xb5cafb=(_0x5959fa=_0x36d19a[0x0])===null||_0x5959fa===void 0x0?void 0x0:_0x5959fa['Id'];if(!_0xb5cafb)throw new Error(errors_1[_0xd2334e(0x1da)]);return _0xb5cafb;}async['getRemoteStateAttachmentId'](_0x37ede3){const _0xe291ad=a282_0x308e24;let _0x3ea615=await this[_0xe291ad(0x1cf)](_0x37ede3)['catch'](()=>null);return!_0x3ea615&&(_0x3ea615=await this[_0xe291ad(0x1a3)][_0xe291ad(0x1b6)]('Attachment',{'Body':(0x0,utils_1[_0xe291ad(0x1ca)])('{}'),'ParentId':_0x37ede3[_0xe291ad(0x1d5)],'ContentType':'text/plain','Name':_0x37ede3['repositoryId']?constants_1[_0xe291ad(0x1a0)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x3ea615;}async['updateRemoteState'](_0x418f80,_0x1cff9a){const _0x281bb7=a282_0x308e24,_0x5953a0=await this['getRemoteStateAttachmentId'](_0x418f80);await this[_0x281bb7(0x1a3)]['patchObject'](_0x281bb7(0x194),_0x5953a0,{'Body':(0x0,utils_1['encodeBase64'])(JSON['stringify'](_0x1cff9a))});}async[a282_0x308e24(0x19e)](_0x472893,_0x37735c){const _0x1da108=a282_0x308e24;await this[_0x1da108(0x1a3)]['patchObject'](_0x472893[_0x1da108(0x1c4)],_0x472893[_0x1da108(0x1d5)],{[constants_1[_0x1da108(0x196)]+_0x1da108(0x189)]:_0x37735c});}async[a282_0x308e24(0x1a2)](_0x6e4321){const _0x412f68=a282_0x308e24;await this['salesforceService'][_0x412f68(0x1cc)](constants_1[_0x412f68(0x196)]+_0x412f68(0x1d7),_0x6e4321,{[constants_1[_0x412f68(0x196)]+_0x412f68(0x1b9)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1['Service'])(),__metadata(a282_0x308e24(0x1a6),[salesforce_query_service_1[a282_0x308e24(0x1a9)],salesforce_service_1[a282_0x308e24(0x1bd)]])],SalesforceSyncService),exports[a282_0x308e24(0x18c)]=SalesforceSyncService;