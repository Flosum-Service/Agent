const a270_0x4b4414=a270_0x301d;(function(_0x4deb66,_0x37de8c){const _0x402ab3=a270_0x301d,_0x1f8e82=_0x4deb66();while(!![]){try{const _0x22ed4b=parseInt(_0x402ab3(0xd5))/0x1+parseInt(_0x402ab3(0x97))/0x2*(parseInt(_0x402ab3(0xca))/0x3)+-parseInt(_0x402ab3(0x8d))/0x4+-parseInt(_0x402ab3(0xbe))/0x5*(parseInt(_0x402ab3(0x8f))/0x6)+-parseInt(_0x402ab3(0xcb))/0x7*(-parseInt(_0x402ab3(0xc9))/0x8)+parseInt(_0x402ab3(0xdb))/0x9*(parseInt(_0x402ab3(0x92))/0xa)+parseInt(_0x402ab3(0xab))/0xb*(-parseInt(_0x402ab3(0xb3))/0xc);if(_0x22ed4b===_0x37de8c)break;else _0x1f8e82['push'](_0x1f8e82['shift']());}catch(_0x26bef1){_0x1f8e82['push'](_0x1f8e82['shift']());}}}(a270_0x2893,0x8fb08));function a270_0x301d(_0x4f23d7,_0x54d18){const _0xba61c9=a270_0x2893();return a270_0x301d=function(_0x1cb1f6,_0x2de324){_0x1cb1f6=_0x1cb1f6-0x85;let _0x2893e7=_0xba61c9[_0x1cb1f6];return _0x2893e7;},a270_0x301d(_0x4f23d7,_0x54d18);}const a270_0x2de324=(function(){let _0x51bb3f=!![];return function(_0x593d00,_0x4d8226){const _0x27d167=_0x51bb3f?function(){const _0x32b0dd=a270_0x301d;if(_0x4d8226){const _0x1b2fab=_0x4d8226[_0x32b0dd(0xb8)](_0x593d00,arguments);return _0x4d8226=null,_0x1b2fab;}}:function(){};return _0x51bb3f=![],_0x27d167;};}()),a270_0x1cb1f6=a270_0x2de324(this,function(){const _0x2e7b93=a270_0x301d;return a270_0x1cb1f6[_0x2e7b93(0x9d)]()[_0x2e7b93(0xaa)]('(((.+)+)+)+$')[_0x2e7b93(0x9d)]()[_0x2e7b93(0x9b)](a270_0x1cb1f6)[_0x2e7b93(0xaa)](_0x2e7b93(0xb6));});a270_0x1cb1f6();function a270_0x2893(){const _0x47e2b0=['query','SalesforceQueryService','getRemoteStateAttachmentId','22116OgGFTj','setStatus','%name%','(((.+)+)+)+$','Branch_Name__c','apply','%parentId%','defineProperty','stringify','getComponentsFromRepository','ERR_INVALID_ATTACHMENT_ID','585aujFLm','GET_REPOSITORY_BY_NAME_QUERY','./salesforce.service','records','Attachment','GET_BRANCH_BY_NAME_QUERY','object','length','replace','%id%','getComponents','64xvIZrV','143805UHkLRS','152299OKYJoh','SalesforceSyncService','getOwnPropertyDescriptor','metadata','./salesforce-query.service','encodeBase64','Service','salesforceQuery','Connection__c','FlosumRepositorySyncDto','1023021CcMxLc','objectType','FLOSUM_GIT_NAMESPACE','getBranchComponents','__metadata','getAttachmentId','457632IjjwjM','Repository\x20with\x20Id\x20','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','design:paramtypes','disableSync','decorate','getRepositoryRecordByName','GET_WAITING_BRANCHES_QUERY','../dto/flosum-repository-sync.dto','find','SalesforceNotFoundError','4260596MLVnCr','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','28734riYycn','SYNC_ATTACHMENT_FOR_BRANCH_NAME','\x20not\x20found\x20on\x20salesforce','10apiHdY','text/plain','patchObject','__decorate','map','42OuMScJ','objectId','__esModule','../../../../constants','constructor','typedi','toString','Components__r','GET_BRANCH_QUERY','repositoryId','getBranchRecord','../errors/not-found.error','fromRepositoryRecord','Sync_In_Progress__c','Name','Branch\x20','Repository__r','FLOSUM_NAMESPACE','getBranchRecords','search','242pXnfoj','salesforceService','function','SalesforceService','fromBranchRecord'];a270_0x2893=function(){return _0x47e2b0;};return a270_0x2893();}'use strict';var __decorate=this&&this[a270_0x4b4414(0x95)]||function(_0x46e303,_0x4ff4c1,_0x3f28bf,_0x14e8b3){const _0x5b5652=a270_0x4b4414;var _0x57f772=arguments[_0x5b5652(0xc5)],_0x21e19c=_0x57f772<0x3?_0x4ff4c1:_0x14e8b3===null?_0x14e8b3=Object[_0x5b5652(0xcd)](_0x4ff4c1,_0x3f28bf):_0x14e8b3,_0x5907de;if(typeof Reflect===_0x5b5652(0xc4)&&typeof Reflect['decorate']===_0x5b5652(0xad))_0x21e19c=Reflect[_0x5b5652(0x87)](_0x46e303,_0x4ff4c1,_0x3f28bf,_0x14e8b3);else{for(var _0x115566=_0x46e303[_0x5b5652(0xc5)]-0x1;_0x115566>=0x0;_0x115566--)if(_0x5907de=_0x46e303[_0x115566])_0x21e19c=(_0x57f772<0x3?_0x5907de(_0x21e19c):_0x57f772>0x3?_0x5907de(_0x4ff4c1,_0x3f28bf,_0x21e19c):_0x5907de(_0x4ff4c1,_0x3f28bf))||_0x21e19c;}return _0x57f772>0x3&&_0x21e19c&&Object[_0x5b5652(0xba)](_0x4ff4c1,_0x3f28bf,_0x21e19c),_0x21e19c;},__metadata=this&&this[a270_0x4b4414(0xd9)]||function(_0x155f00,_0x4cfaff){const _0x1db6f0=a270_0x4b4414;if(typeof Reflect==='object'&&typeof Reflect[_0x1db6f0(0xce)]===_0x1db6f0(0xad))return Reflect[_0x1db6f0(0xce)](_0x155f00,_0x4cfaff);};Object[a270_0x4b4414(0xba)](exports,a270_0x4b4414(0x99),{'value':!![]}),exports[a270_0x4b4414(0xcc)]=void 0x0;const typedi_1=require(a270_0x4b4414(0x9c)),constants_1=require(a270_0x4b4414(0x9a)),errors_1=require('../../../../constants/errors'),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a270_0x4b4414(0x8a)),not_found_error_1=require(a270_0x4b4414(0xa2)),queries_1=require('../queries'),salesforce_query_service_1=require(a270_0x4b4414(0xcf)),salesforce_service_1=require(a270_0x4b4414(0xc0));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x275270,_0x4f3490){const _0xa0adae=a270_0x4b4414;this[_0xa0adae(0xd2)]=_0x275270,this[_0xa0adae(0xac)]=_0x4f3490;}async[a270_0x4b4414(0xc8)](_0x450469){const _0x27e308=a270_0x4b4414;var _0x28d553;const _0x27bbd4=await this['salesforceQuery'][_0x27e308(0xb0)](_0x450469),_0x4f520e=[];for(const _0x4ac2f8 of _0x27bbd4){const _0x8fa68c=(_0x28d553=_0x4ac2f8[constants_1[_0x27e308(0xa8)]+_0x27e308(0x9e)])===null||_0x28d553===void 0x0?void 0x0:_0x28d553[_0x27e308(0xc1)];_0x8fa68c&&_0x8fa68c[_0x27e308(0xc5)]&&_0x4f520e['push'](_0x8fa68c[0x0]['Id']);}return _0x4f520e;}async['getAllRepositoryNames'](_0x4e3ab6){const _0x517793=a270_0x4b4414,_0x49f4c9=await this[_0x517793(0xd2)][_0x517793(0xb0)](queries_1['GET_REPOSITORIES_NAMES_QUERY'][_0x517793(0xc6)](/\%connection_id\%/g,_0x4e3ab6));return _0x49f4c9[_0x517793(0x96)](_0x511f53=>{const _0x5217a8=_0x517793;return _0x511f53[constants_1[_0x5217a8(0xd7)]+'Repository__r']?_0x511f53[constants_1['FLOSUM_GIT_NAMESPACE']+_0x5217a8(0xa7)][_0x5217a8(0xa5)]:_0x511f53[_0x5217a8(0xa5)];});}async['getRepositoryRecords'](_0x53529e){const _0x54c42f=a270_0x4b4414,_0x884fe6=await this[_0x54c42f(0xd2)][_0x54c42f(0xb0)](queries_1['GET_WAITING_REPOSITORIES_QUERY'][_0x54c42f(0xc6)](/\%connection_id\%/g,_0x53529e));return _0x884fe6['map'](_0x4ebee2=>flosum_repository_sync_dto_1[_0x54c42f(0xd4)][_0x54c42f(0xa3)](_0x4ebee2));}async[a270_0x4b4414(0xa9)](_0x32588d){const _0x54026e=a270_0x4b4414,_0x3e0319=await this['salesforceQuery']['query'](queries_1[_0x54026e(0x89)][_0x54026e(0xc6)](/%repositories_ids\%/g,_0x32588d));return _0x3e0319[_0x54026e(0x96)](_0x260d83=>flosum_repository_sync_dto_1[_0x54026e(0xd4)][_0x54026e(0xaf)](_0x260d83));}async['getRepositoryRecord'](_0x270bcd){const _0x35819e=a270_0x4b4414,_0x1b0f78=await this[_0x35819e(0xd2)]['query'](queries_1['GET_REPOSITORY_QUERY'][_0x35819e(0xc6)](_0x35819e(0xc7),_0x270bcd));if(_0x1b0f78[_0x35819e(0xc5)]===0x0)throw new not_found_error_1[(_0x35819e(0x8c))](_0x35819e(0xdc)+_0x270bcd+_0x35819e(0x91));return flosum_repository_sync_dto_1[_0x35819e(0xd4)][_0x35819e(0xa3)](_0x1b0f78[0x0]);}async[a270_0x4b4414(0xa1)](_0x5cbf45){const _0x1c98c9=a270_0x4b4414,_0x3e4cc1=await this['salesforceQuery'][_0x1c98c9(0xb0)](queries_1[_0x1c98c9(0x9f)][_0x1c98c9(0xc6)](_0x1c98c9(0xc7),_0x5cbf45));if(_0x3e4cc1[_0x1c98c9(0xc5)]===0x0)throw new not_found_error_1[(_0x1c98c9(0x8c))]('Branch\x20with\x20Id\x20'+_0x5cbf45+_0x1c98c9(0x91));return flosum_repository_sync_dto_1[_0x1c98c9(0xd4)][_0x1c98c9(0xaf)](_0x3e4cc1[0x0]);}async['getBranchRecordByName'](_0x298a23){const _0x15754a=a270_0x4b4414,_0x4b2984=await this[_0x15754a(0xd2)][_0x15754a(0xb0)](queries_1[_0x15754a(0xc3)][_0x15754a(0xc6)](_0x15754a(0xb5),_0x298a23));if(_0x4b2984[_0x15754a(0xc5)]===0x0)throw new not_found_error_1[(_0x15754a(0x8c))](_0x15754a(0xa6)+_0x298a23+_0x15754a(0x91));const _0x3440d8=_0x4b2984[_0x15754a(0x8b)](_0x51864c=>_0x51864c[constants_1[_0x15754a(0xa8)]+_0x15754a(0xb7)]===_0x298a23);if(!_0x3440d8)throw new not_found_error_1['SalesforceNotFoundError'](_0x15754a(0xa6)+_0x298a23+_0x15754a(0x91));return flosum_repository_sync_dto_1[_0x15754a(0xd4)]['fromBranchRecord'](_0x3440d8);}async[a270_0x4b4414(0x88)](_0x26a253){const _0x571527=a270_0x4b4414,_0x1f9975=await this[_0x571527(0xd2)][_0x571527(0xb0)](queries_1[_0x571527(0xbf)][_0x571527(0xc6)]('%name%',_0x26a253));if(_0x1f9975[_0x571527(0xc5)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20'+_0x26a253+_0x571527(0x91));return flosum_repository_sync_dto_1[_0x571527(0xd4)][_0x571527(0xa3)](_0x1f9975[0x0]);}async[a270_0x4b4414(0xbc)](_0x2203af){const _0x5b3e62=a270_0x4b4414,_0x138fc0='\x0a\x20\x20\x20\x20\x20\x20'+queries_1['GET_COMPONENTS_QUERY']+_0x5b3e62(0xdd)+_0x2203af+'\x27';return this['getComponents'](_0x138fc0);}async[a270_0x4b4414(0xd8)](_0x2cb32a){const _0x38d8b5=a270_0x4b4414,_0xf595d1=_0x38d8b5(0x8e)+queries_1['GET_COMPONENTS_QUERY']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x2cb32a+'\x27';return this[_0x38d8b5(0xc8)](_0xf595d1);}async[a270_0x4b4414(0xda)](_0x4ec3c2){const _0x52f77f=a270_0x4b4414;var _0x2e1beb;const _0xc9e458=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x52f77f(0xc6)](_0x52f77f(0xb9),_0x4ec3c2[_0x52f77f(0x98)])[_0x52f77f(0xc6)](_0x52f77f(0xb5),_0x4ec3c2[_0x52f77f(0xa0)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x35df1d=await this['salesforceQuery']['query'](_0xc9e458),_0x3c67eb=(_0x2e1beb=_0x35df1d[0x0])===null||_0x2e1beb===void 0x0?void 0x0:_0x2e1beb['Id'];if(!_0x3c67eb)throw new Error(errors_1[_0x52f77f(0xbd)]);return _0x3c67eb;}async[a270_0x4b4414(0xb2)](_0x55dc64){const _0x5b9255=a270_0x4b4414;let _0x6be3d7=await this['getAttachmentId'](_0x55dc64)['catch'](()=>null);return!_0x6be3d7&&(_0x6be3d7=await this[_0x5b9255(0xac)]['createObject'](_0x5b9255(0xc2),{'Body':(0x0,utils_1[_0x5b9255(0xd0)])('{}'),'ParentId':_0x55dc64[_0x5b9255(0x98)],'ContentType':_0x5b9255(0x93),'Name':_0x55dc64['repositoryId']?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x5b9255(0x90)]})),_0x6be3d7;}async['updateRemoteState'](_0x5c9a7f,_0x337b63){const _0x128f2b=a270_0x4b4414,_0xf86c78=await this['getRemoteStateAttachmentId'](_0x5c9a7f);await this[_0x128f2b(0xac)]['patchObject'](_0x128f2b(0xc2),_0xf86c78,{'Body':(0x0,utils_1[_0x128f2b(0xd0)])(JSON[_0x128f2b(0xbb)](_0x337b63))});}async[a270_0x4b4414(0xb4)](_0x50f707,_0x18d842){const _0x4cd4e1=a270_0x4b4414;await this[_0x4cd4e1(0xac)][_0x4cd4e1(0x94)](_0x50f707[_0x4cd4e1(0xd6)],_0x50f707[_0x4cd4e1(0x98)],{[constants_1[_0x4cd4e1(0xd7)]+'Synchronization_Status__c']:_0x18d842});}async[a270_0x4b4414(0x86)](_0x12883c){const _0x499384=a270_0x4b4414;await this[_0x499384(0xac)][_0x499384(0x94)](constants_1['FLOSUM_GIT_NAMESPACE']+_0x499384(0xd3),_0x12883c,{[constants_1[_0x499384(0xd7)]+_0x499384(0xa4)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a270_0x4b4414(0xd1)])(),__metadata(a270_0x4b4414(0x85),[salesforce_query_service_1[a270_0x4b4414(0xb1)],salesforce_service_1[a270_0x4b4414(0xae)]])],SalesforceSyncService),exports[a270_0x4b4414(0xcc)]=SalesforceSyncService;