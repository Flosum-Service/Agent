const a282_0x187be0=a282_0x3fdb;function a282_0x3fdb(_0x1dd0be,_0x3d40b9){const _0x38c631=a282_0xf4e9();return a282_0x3fdb=function(_0x1d4725,_0x2b05e4){_0x1d4725=_0x1d4725-0x6c;let _0xf4e90d=_0x38c631[_0x1d4725];return _0xf4e90d;},a282_0x3fdb(_0x1dd0be,_0x3d40b9);}(function(_0x277aaf,_0x11a762){const _0x970b09=a282_0x3fdb,_0x1f4ae6=_0x277aaf();while(!![]){try{const _0x560f49=parseInt(_0x970b09(0x84))/0x1+parseInt(_0x970b09(0x78))/0x2+parseInt(_0x970b09(0x86))/0x3*(-parseInt(_0x970b09(0xab))/0x4)+parseInt(_0x970b09(0xbf))/0x5+-parseInt(_0x970b09(0x9e))/0x6*(parseInt(_0x970b09(0x72))/0x7)+parseInt(_0x970b09(0xc4))/0x8+-parseInt(_0x970b09(0x74))/0x9;if(_0x560f49===_0x11a762)break;else _0x1f4ae6['push'](_0x1f4ae6['shift']());}catch(_0x479d74){_0x1f4ae6['push'](_0x1f4ae6['shift']());}}}(a282_0xf4e9,0xa08ac));const a282_0x2b05e4=(function(){let _0x2a6091=!![];return function(_0x5c2b91,_0x44d249){const _0x457d37=_0x2a6091?function(){const _0x13d695=a282_0x3fdb;if(_0x44d249){const _0x256b1a=_0x44d249[_0x13d695(0x9f)](_0x5c2b91,arguments);return _0x44d249=null,_0x256b1a;}}:function(){};return _0x2a6091=![],_0x457d37;};}()),a282_0x1d4725=a282_0x2b05e4(this,function(){const _0x2c875f=a282_0x3fdb;return a282_0x1d4725[_0x2c875f(0xa6)]()[_0x2c875f(0x75)]('(((.+)+)+)+$')['toString']()[_0x2c875f(0x71)](a282_0x1d4725)[_0x2c875f(0x75)]('(((.+)+)+)+$');});a282_0x1d4725();'use strict';function a282_0xf4e9(){const _0x4bf43f=['GET_COMPONENTS_QUERY','%name%','typedi','28xuyNyS','__esModule','defineProperty','objectId','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','getAllRepositoryNames','SalesforceQueryService','getRepositoryRecords','disableSync','Connection__c','GET_REPOSITORY_BY_NAME_QUERY','map','%id%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','FlosumRepositorySyncDto','getRepositoryRecord','repositoryId','getRemoteStateAttachmentId','setStatus','objectType','2110555CrfAoY','SalesforceService','function','replace','Sync_In_Progress__c','5318896Ebgvzz','getComponents','../queries','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','object','GET_WAITING_REPOSITORIES_QUERY','encodeBase64','push','Components__r','constructor','533932COWVDq','salesforceQuery','11213001xJnLtF','search','decorate','updateRemoteState','694518onsKKv','GET_WAITING_BRANCHES_QUERY','./salesforce-query.service','metadata','SalesforceSyncService','GET_BRANCH_QUERY','getAttachmentId','GET_BRANCH_BY_NAME_QUERY','Repository\x20with\x20Id\x20','getRepositoryRecordByName','FLOSUM_NAMESPACE','__decorate','1229548aRaYqQ','Synchronization_Status__c','162399xaLQRL','getBranchRecordByName','Repository\x20','getComponentsFromRepository','Branch\x20with\x20Id\x20','SYNC_ATTACHMENT_FOR_BRANCH_NAME','Repository__r','salesforceService','stringify','ERR_INVALID_ATTACHMENT_ID','Service','../dto/flosum-repository-sync.dto','fromRepositoryRecord','../errors/not-found.error','GET_REPOSITORY_QUERY','GET_REPOSITORIES_NAMES_QUERY','FLOSUM_GIT_NAMESPACE','\x20not\x20found\x20on\x20salesforce','patchObject','Name','records','query','getBranchComponents','../../../shared/utils','30OklkXT','apply','__metadata','createObject','SalesforceNotFoundError','fromBranchRecord','length','text/plain','toString','../../../../constants'];a282_0xf4e9=function(){return _0x4bf43f;};return a282_0xf4e9();}var __decorate=this&&this[a282_0x187be0(0x83)]||function(_0x2c56aa,_0x12246b,_0x431976,_0x3cea5d){const _0x58363f=a282_0x187be0;var _0x3a53bb=arguments[_0x58363f(0xa4)],_0x32318b=_0x3a53bb<0x3?_0x12246b:_0x3cea5d===null?_0x3cea5d=Object['getOwnPropertyDescriptor'](_0x12246b,_0x431976):_0x3cea5d,_0x540a06;if(typeof Reflect===_0x58363f(0x6c)&&typeof Reflect[_0x58363f(0x76)]==='function')_0x32318b=Reflect[_0x58363f(0x76)](_0x2c56aa,_0x12246b,_0x431976,_0x3cea5d);else{for(var _0x19ce51=_0x2c56aa[_0x58363f(0xa4)]-0x1;_0x19ce51>=0x0;_0x19ce51--)if(_0x540a06=_0x2c56aa[_0x19ce51])_0x32318b=(_0x3a53bb<0x3?_0x540a06(_0x32318b):_0x3a53bb>0x3?_0x540a06(_0x12246b,_0x431976,_0x32318b):_0x540a06(_0x12246b,_0x431976))||_0x32318b;}return _0x3a53bb>0x3&&_0x32318b&&Object[_0x58363f(0xad)](_0x12246b,_0x431976,_0x32318b),_0x32318b;},__metadata=this&&this[a282_0x187be0(0xa0)]||function(_0x3b9147,_0x364b67){const _0x38c7b0=a282_0x187be0;if(typeof Reflect===_0x38c7b0(0x6c)&&typeof Reflect[_0x38c7b0(0x7b)]===_0x38c7b0(0xc1))return Reflect[_0x38c7b0(0x7b)](_0x3b9147,_0x364b67);};Object[a282_0x187be0(0xad)](exports,a282_0x187be0(0xac),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require(a282_0x187be0(0xaa)),constants_1=require(a282_0x187be0(0xa7)),errors_1=require('../../../../constants/errors'),utils_1=require(a282_0x187be0(0x9d)),flosum_repository_sync_dto_1=require(a282_0x187be0(0x91)),not_found_error_1=require(a282_0x187be0(0x93)),queries_1=require(a282_0x187be0(0xc6)),salesforce_query_service_1=require(a282_0x187be0(0x7a)),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0xdc268f,_0x3355df){const _0x5c7f94=a282_0x187be0;this[_0x5c7f94(0x73)]=_0xdc268f,this['salesforceService']=_0x3355df;}async[a282_0x187be0(0xc5)](_0x293d1c){const _0x421ad3=a282_0x187be0;var _0x9d46f6;const _0x8b1a6c=await this[_0x421ad3(0x73)][_0x421ad3(0x9b)](_0x293d1c),_0x44301c=[];for(const _0x51381f of _0x8b1a6c){const _0xe32eb5=(_0x9d46f6=_0x51381f[constants_1['FLOSUM_NAMESPACE']+_0x421ad3(0x70)])===null||_0x9d46f6===void 0x0?void 0x0:_0x9d46f6[_0x421ad3(0x9a)];_0xe32eb5&&_0xe32eb5[_0x421ad3(0xa4)]&&_0x44301c[_0x421ad3(0x6f)](_0xe32eb5[0x0]['Id']);}return _0x44301c;}async[a282_0x187be0(0xb0)](_0x538601){const _0x2dd537=a282_0x187be0,_0x1b6c93=await this['salesforceQuery']['query'](queries_1[_0x2dd537(0x95)][_0x2dd537(0xc2)](/\%connection_id\%/g,_0x538601));return _0x1b6c93['map'](_0xd837fa=>{const _0x32be02=_0x2dd537;return _0xd837fa[constants_1[_0x32be02(0x96)]+_0x32be02(0x8c)]?_0xd837fa[constants_1[_0x32be02(0x96)]+'Repository__r'][_0x32be02(0x99)]:_0xd837fa[_0x32be02(0x99)];});}async[a282_0x187be0(0xb2)](_0x12f288){const _0x2f5e9d=a282_0x187be0,_0x298e88=await this[_0x2f5e9d(0x73)]['query'](queries_1[_0x2f5e9d(0x6d)][_0x2f5e9d(0xc2)](/\%connection_id\%/g,_0x12f288));return _0x298e88[_0x2f5e9d(0xb6)](_0x883cac=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x2f5e9d(0x92)](_0x883cac));}async['getBranchRecords'](_0x42ee6a){const _0x48f4ae=a282_0x187be0,_0x5cf2e6=await this['salesforceQuery'][_0x48f4ae(0x9b)](queries_1[_0x48f4ae(0x79)]['replace'](/%repositories_ids\%/g,_0x42ee6a));return _0x5cf2e6[_0x48f4ae(0xb6)](_0x2c04a3=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x48f4ae(0xa3)](_0x2c04a3));}async[a282_0x187be0(0xba)](_0x358352){const _0x3739fd=a282_0x187be0,_0x36d0a8=await this[_0x3739fd(0x73)][_0x3739fd(0x9b)](queries_1[_0x3739fd(0x94)][_0x3739fd(0xc2)](_0x3739fd(0xb7),_0x358352));if(_0x36d0a8['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x3739fd(0x80)+_0x358352+_0x3739fd(0x97));return flosum_repository_sync_dto_1[_0x3739fd(0xb9)]['fromRepositoryRecord'](_0x36d0a8[0x0]);}async['getBranchRecord'](_0x2dbec9){const _0x54bee4=a282_0x187be0,_0x210a8f=await this[_0x54bee4(0x73)][_0x54bee4(0x9b)](queries_1[_0x54bee4(0x7d)]['replace']('%id%',_0x2dbec9));if(_0x210a8f[_0x54bee4(0xa4)]===0x0)throw new not_found_error_1[(_0x54bee4(0xa2))](_0x54bee4(0x8a)+_0x2dbec9+_0x54bee4(0x97));return flosum_repository_sync_dto_1[_0x54bee4(0xb9)][_0x54bee4(0xa3)](_0x210a8f[0x0]);}async[a282_0x187be0(0x87)](_0x21f42a){const _0x302cfa=a282_0x187be0,_0x7d82b0=await this[_0x302cfa(0x73)][_0x302cfa(0x9b)](queries_1[_0x302cfa(0x7f)][_0x302cfa(0xc2)](_0x302cfa(0xa9),_0x21f42a));if(_0x7d82b0[_0x302cfa(0xa4)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x21f42a+'\x20not\x20found\x20on\x20salesforce');const _0x4ab1dc=_0x7d82b0['find'](_0x4c8480=>_0x4c8480[constants_1[_0x302cfa(0x82)]+'Branch_Name__c']===_0x21f42a);if(!_0x4ab1dc)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x21f42a+_0x302cfa(0x97));return flosum_repository_sync_dto_1[_0x302cfa(0xb9)]['fromBranchRecord'](_0x4ab1dc);}async[a282_0x187be0(0x81)](_0x247c34){const _0x168d31=a282_0x187be0,_0x40dea0=await this['salesforceQuery'][_0x168d31(0x9b)](queries_1[_0x168d31(0xb5)][_0x168d31(0xc2)]('%name%',_0x247c34));if(_0x40dea0[_0x168d31(0xa4)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x168d31(0x88)+_0x247c34+_0x168d31(0x97));return flosum_repository_sync_dto_1[_0x168d31(0xb9)]['fromRepositoryRecord'](_0x40dea0[0x0]);}async[a282_0x187be0(0x89)](_0x48e31e){const _0x10a4b0=a282_0x187be0,_0x3db2cc='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x10a4b0(0xa8)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x48e31e+'\x27';return this[_0x10a4b0(0xc5)](_0x3db2cc);}async[a282_0x187be0(0x9c)](_0x5d230f){const _0x1610d6=a282_0x187be0,_0x9682ff=_0x1610d6(0xb8)+queries_1['GET_COMPONENTS_QUERY']+_0x1610d6(0xc7)+_0x5d230f+'\x27';return this[_0x1610d6(0xc5)](_0x9682ff);}async[a282_0x187be0(0x7e)](_0x330612){const _0x57a2e5=a282_0x187be0;var _0x217300;const _0x2e36e5=queries_1[_0x57a2e5(0xaf)][_0x57a2e5(0xc2)]('%parentId%',_0x330612[_0x57a2e5(0xae)])[_0x57a2e5(0xc2)](_0x57a2e5(0xa9),_0x330612['repositoryId']?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x57a2e5(0x8b)]),_0x333df0=await this[_0x57a2e5(0x73)][_0x57a2e5(0x9b)](_0x2e36e5),_0x1e49dc=(_0x217300=_0x333df0[0x0])===null||_0x217300===void 0x0?void 0x0:_0x217300['Id'];if(!_0x1e49dc)throw new Error(errors_1[_0x57a2e5(0x8f)]);return _0x1e49dc;}async[a282_0x187be0(0xbc)](_0x229890){const _0x531f28=a282_0x187be0;let _0x3f8085=await this[_0x531f28(0x7e)](_0x229890)['catch'](()=>null);return!_0x3f8085&&(_0x3f8085=await this[_0x531f28(0x8d)][_0x531f28(0xa1)]('Attachment',{'Body':(0x0,utils_1[_0x531f28(0x6e)])('{}'),'ParentId':_0x229890[_0x531f28(0xae)],'ContentType':_0x531f28(0xa5),'Name':_0x229890[_0x531f28(0xbb)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x531f28(0x8b)]})),_0x3f8085;}async[a282_0x187be0(0x77)](_0xb8b49c,_0x4f04e0){const _0x554fc7=a282_0x187be0,_0x355358=await this[_0x554fc7(0xbc)](_0xb8b49c);await this['salesforceService'][_0x554fc7(0x98)]('Attachment',_0x355358,{'Body':(0x0,utils_1[_0x554fc7(0x6e)])(JSON[_0x554fc7(0x8e)](_0x4f04e0))});}async[a282_0x187be0(0xbd)](_0x491590,_0x89fefe){const _0x246a78=a282_0x187be0;await this[_0x246a78(0x8d)]['patchObject'](_0x491590[_0x246a78(0xbe)],_0x491590[_0x246a78(0xae)],{[constants_1[_0x246a78(0x96)]+_0x246a78(0x85)]:_0x89fefe});}async[a282_0x187be0(0xb3)](_0x11b4b4){const _0x3d1c0b=a282_0x187be0;await this['salesforceService']['patchObject'](constants_1[_0x3d1c0b(0x96)]+_0x3d1c0b(0xb4),_0x11b4b4,{[constants_1[_0x3d1c0b(0x96)]+_0x3d1c0b(0xc3)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a282_0x187be0(0x90)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a282_0x187be0(0xb1)],salesforce_service_1[a282_0x187be0(0xc0)]])],SalesforceSyncService),exports[a282_0x187be0(0x7c)]=SalesforceSyncService;