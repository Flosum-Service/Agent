const a204_0x264728=a204_0xa8a2;function a204_0xa8a2(_0x4b08af,_0x52f305){const _0x19f5f3=a204_0xbb59();return a204_0xa8a2=function(_0x1da105,_0x50d6b1){_0x1da105=_0x1da105-0x141;let _0xbb594a=_0x19f5f3[_0x1da105];return _0xbb594a;},a204_0xa8a2(_0x4b08af,_0x52f305);}(function(_0x2cf438,_0x444da7){const _0x46f4cb=a204_0xa8a2,_0xc83ab9=_0x2cf438();while(!![]){try{const _0x2d9dfb=parseInt(_0x46f4cb(0x17e))/0x1*(parseInt(_0x46f4cb(0x161))/0x2)+parseInt(_0x46f4cb(0x167))/0x3+-parseInt(_0x46f4cb(0x18e))/0x4+-parseInt(_0x46f4cb(0x164))/0x5+-parseInt(_0x46f4cb(0x177))/0x6*(-parseInt(_0x46f4cb(0x19f))/0x7)+parseInt(_0x46f4cb(0x1a1))/0x8*(parseInt(_0x46f4cb(0x170))/0x9)+-parseInt(_0x46f4cb(0x19b))/0xa;if(_0x2d9dfb===_0x444da7)break;else _0xc83ab9['push'](_0xc83ab9['shift']());}catch(_0x288eb6){_0xc83ab9['push'](_0xc83ab9['shift']());}}}(a204_0xbb59,0x5ea2b));const a204_0x50d6b1=(function(){let _0x1e33d1=!![];return function(_0x2f3272,_0x3cfcb1){const _0x4abb03=_0x1e33d1?function(){const _0x479520=a204_0xa8a2;if(_0x3cfcb1){const _0x4e5f9e=_0x3cfcb1[_0x479520(0x191)](_0x2f3272,arguments);return _0x3cfcb1=null,_0x4e5f9e;}}:function(){};return _0x1e33d1=![],_0x4abb03;};}()),a204_0x1da105=a204_0x50d6b1(this,function(){const _0x1f9466=a204_0xa8a2;return a204_0x1da105[_0x1f9466(0x14e)]()[_0x1f9466(0x16f)](_0x1f9466(0x179))[_0x1f9466(0x14e)]()['constructor'](a204_0x1da105)[_0x1f9466(0x16f)](_0x1f9466(0x179));});function a204_0xbb59(){const _0x5f3de9=['SalesforceSyncService','updateRemoteState','getComponents','2xBPkcn','SalesforceNotFoundError','disableSync','1963355wplFXu','\x20not\x20found\x20on\x20salesforce','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','1146636AydYJm','GET_REPOSITORY_QUERY','Attachment','getAttachmentId','getRepositoryRecord','__metadata','design:paramtypes','getComponentsFromRepository','search','1234971UmAUyk','decorate','../dto/flosum-repository-sync.dto','catch','GET_REPOSITORY_BY_NAME_QUERY','salesforceService','../errors/not-found.error','78Mccxvi','Branch\x20','(((.+)+)+)+$','../queries','getBranchComponents','__esModule','./salesforce-query.service','72068mRDGRJ','repositoryId','Name','getRepositoryRecordByName','defineProperty','getBranchRecords','createObject','Connection__c','GET_BRANCH_BY_NAME_QUERY','getRemoteStateAttachmentId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','fromRepositoryRecord','Synchronization_Status__c','text/plain','Sync_In_Progress__c','1955812vInUFo','GET_BRANCH_QUERY','encodeBase64','apply','getBranchRecord','getAllRepositoryNames','Repository__r','map','stringify','patchObject','push','GET_REPOSITORIES_NAMES_QUERY','GET_WAITING_REPOSITORIES_QUERY','1942180kGrCal','./salesforce.service','FlosumRepositorySyncDto','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','321748SoNISA','../../../../constants','24EVmRqA','../../../shared/utils','fromBranchRecord','objectId','SYNC_ATTACHMENT_FOR_BRANCH_NAME','objectType','Service','FLOSUM_GIT_NAMESPACE','object','replace','SalesforceService','query','%parentId%','getRepositoryRecords','getOwnPropertyDescriptor','toString','function','__decorate','Repository\x20','ERR_INVALID_ATTACHMENT_ID','records','metadata','FLOSUM_NAMESPACE','find','Branch\x20with\x20Id\x20','length','Repository\x20with\x20Id\x20','%name%','getBranchRecordByName','%id%','salesforceQuery'];a204_0xbb59=function(){return _0x5f3de9;};return a204_0xbb59();}a204_0x1da105();'use strict';var __decorate=this&&this[a204_0x264728(0x150)]||function(_0x5b072d,_0x54e415,_0x56d1fd,_0x54b273){const _0xe144c8=a204_0x264728;var _0x5de9a2=arguments[_0xe144c8(0x158)],_0xab9101=_0x5de9a2<0x3?_0x54e415:_0x54b273===null?_0x54b273=Object[_0xe144c8(0x14d)](_0x54e415,_0x56d1fd):_0x54b273,_0xc0949e;if(typeof Reflect===_0xe144c8(0x147)&&typeof Reflect['decorate']===_0xe144c8(0x14f))_0xab9101=Reflect[_0xe144c8(0x171)](_0x5b072d,_0x54e415,_0x56d1fd,_0x54b273);else{for(var _0x33a0c9=_0x5b072d[_0xe144c8(0x158)]-0x1;_0x33a0c9>=0x0;_0x33a0c9--)if(_0xc0949e=_0x5b072d[_0x33a0c9])_0xab9101=(_0x5de9a2<0x3?_0xc0949e(_0xab9101):_0x5de9a2>0x3?_0xc0949e(_0x54e415,_0x56d1fd,_0xab9101):_0xc0949e(_0x54e415,_0x56d1fd))||_0xab9101;}return _0x5de9a2>0x3&&_0xab9101&&Object['defineProperty'](_0x54e415,_0x56d1fd,_0xab9101),_0xab9101;},__metadata=this&&this[a204_0x264728(0x16c)]||function(_0x30127b,_0x56ec6c){const _0x34f6e1=a204_0x264728;if(typeof Reflect===_0x34f6e1(0x147)&&typeof Reflect[_0x34f6e1(0x154)]===_0x34f6e1(0x14f))return Reflect[_0x34f6e1(0x154)](_0x30127b,_0x56ec6c);};Object[a204_0x264728(0x182)](exports,a204_0x264728(0x17c),{'value':!![]}),exports[a204_0x264728(0x15e)]=void 0x0;const typedi_1=require('typedi'),constants_1=require(a204_0x264728(0x1a0)),errors_1=require('../../../../constants/errors'),utils_1=require(a204_0x264728(0x1a2)),flosum_repository_sync_dto_1=require(a204_0x264728(0x172)),not_found_error_1=require(a204_0x264728(0x176)),queries_1=require(a204_0x264728(0x17a)),salesforce_query_service_1=require(a204_0x264728(0x17d)),salesforce_service_1=require(a204_0x264728(0x19c));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x34545e,_0x3f3a2b){const _0x5b0a37=a204_0x264728;this[_0x5b0a37(0x15d)]=_0x34545e,this[_0x5b0a37(0x175)]=_0x3f3a2b;}async[a204_0x264728(0x160)](_0x14dc70){const _0x18fad9=a204_0x264728;var _0x15e870;const _0xfee12f=await this[_0x18fad9(0x15d)][_0x18fad9(0x14a)](_0x14dc70),_0x3a5505=[];for(const _0xe03fbd of _0xfee12f){const _0x4227b0=(_0x15e870=_0xe03fbd[constants_1[_0x18fad9(0x155)]+'Components__r'])===null||_0x15e870===void 0x0?void 0x0:_0x15e870[_0x18fad9(0x153)];_0x4227b0&&_0x4227b0[_0x18fad9(0x158)]&&_0x3a5505[_0x18fad9(0x198)](_0x4227b0[0x0]['Id']);}return _0x3a5505;}async[a204_0x264728(0x193)](_0x643cb3){const _0x236b09=a204_0x264728,_0xb9167d=await this[_0x236b09(0x15d)][_0x236b09(0x14a)](queries_1[_0x236b09(0x199)][_0x236b09(0x148)](/\%connection_id\%/g,_0x643cb3));return _0xb9167d[_0x236b09(0x195)](_0x2a0775=>{const _0x52c74a=_0x236b09;return _0x2a0775[constants_1[_0x52c74a(0x146)]+'Repository__r']?_0x2a0775[constants_1[_0x52c74a(0x146)]+_0x52c74a(0x194)][_0x52c74a(0x180)]:_0x2a0775[_0x52c74a(0x180)];});}async[a204_0x264728(0x14c)](_0x1ec3ea){const _0x52398d=a204_0x264728,_0xbe7cb5=await this[_0x52398d(0x15d)][_0x52398d(0x14a)](queries_1[_0x52398d(0x19a)]['replace'](/\%connection_id\%/g,_0x1ec3ea));return _0xbe7cb5['map'](_0x46b6c2=>flosum_repository_sync_dto_1[_0x52398d(0x19d)][_0x52398d(0x18a)](_0x46b6c2));}async[a204_0x264728(0x183)](_0x10d58c){const _0x1562e4=a204_0x264728,_0x562c2c=await this['salesforceQuery'][_0x1562e4(0x14a)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x1562e4(0x148)](/%repositories_ids\%/g,_0x10d58c));return _0x562c2c[_0x1562e4(0x195)](_0x3994cb=>flosum_repository_sync_dto_1[_0x1562e4(0x19d)][_0x1562e4(0x141)](_0x3994cb));}async[a204_0x264728(0x16b)](_0x313f8e){const _0x5de8d6=a204_0x264728,_0x2990d3=await this['salesforceQuery'][_0x5de8d6(0x14a)](queries_1[_0x5de8d6(0x168)]['replace'](_0x5de8d6(0x15c),_0x313f8e));if(_0x2990d3[_0x5de8d6(0x158)]===0x0)throw new not_found_error_1[(_0x5de8d6(0x162))](_0x5de8d6(0x159)+_0x313f8e+_0x5de8d6(0x165));return flosum_repository_sync_dto_1[_0x5de8d6(0x19d)][_0x5de8d6(0x18a)](_0x2990d3[0x0]);}async[a204_0x264728(0x192)](_0x4fe2b3){const _0x37ad8e=a204_0x264728,_0x20e3b0=await this[_0x37ad8e(0x15d)][_0x37ad8e(0x14a)](queries_1[_0x37ad8e(0x18f)][_0x37ad8e(0x148)](_0x37ad8e(0x15c),_0x4fe2b3));if(_0x20e3b0[_0x37ad8e(0x158)]===0x0)throw new not_found_error_1[(_0x37ad8e(0x162))](_0x37ad8e(0x157)+_0x4fe2b3+_0x37ad8e(0x165));return flosum_repository_sync_dto_1[_0x37ad8e(0x19d)][_0x37ad8e(0x141)](_0x20e3b0[0x0]);}async[a204_0x264728(0x15b)](_0x14d646){const _0x5c9f63=a204_0x264728,_0x124dd3=await this[_0x5c9f63(0x15d)][_0x5c9f63(0x14a)](queries_1[_0x5c9f63(0x186)][_0x5c9f63(0x148)](_0x5c9f63(0x15a),_0x14d646));if(_0x124dd3[_0x5c9f63(0x158)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x5c9f63(0x178)+_0x14d646+_0x5c9f63(0x165));const _0x2994da=_0x124dd3[_0x5c9f63(0x156)](_0x12ba07=>_0x12ba07[constants_1[_0x5c9f63(0x155)]+'Branch_Name__c']===_0x14d646);if(!_0x2994da)throw new not_found_error_1['SalesforceNotFoundError'](_0x5c9f63(0x178)+_0x14d646+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x5c9f63(0x19d)][_0x5c9f63(0x141)](_0x2994da);}async[a204_0x264728(0x181)](_0x35d7ef){const _0x580379=a204_0x264728,_0x21b3bf=await this['salesforceQuery'][_0x580379(0x14a)](queries_1[_0x580379(0x174)]['replace'](_0x580379(0x15a),_0x35d7ef));if(_0x21b3bf[_0x580379(0x158)]===0x0)throw new not_found_error_1[(_0x580379(0x162))](_0x580379(0x151)+_0x35d7ef+_0x580379(0x165));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x580379(0x18a)](_0x21b3bf[0x0]);}async[a204_0x264728(0x16e)](_0x11d93d){const _0x12db41=a204_0x264728,_0x556b5c='\x0a\x20\x20\x20\x20\x20\x20'+queries_1['GET_COMPONENTS_QUERY']+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x11d93d+'\x27';return this[_0x12db41(0x160)](_0x556b5c);}async[a204_0x264728(0x17b)](_0x23d17c){const _0x38caa7=a204_0x264728,_0x4fd1ae=_0x38caa7(0x19e)+queries_1['GET_COMPONENTS_QUERY']+_0x38caa7(0x188)+_0x23d17c+'\x27';return this[_0x38caa7(0x160)](_0x4fd1ae);}async['getAttachmentId'](_0x194044){const _0x341715=a204_0x264728;var _0x3c82f2;const _0x5dec10=queries_1[_0x341715(0x189)][_0x341715(0x148)](_0x341715(0x14b),_0x194044[_0x341715(0x142)])[_0x341715(0x148)]('%name%',_0x194044[_0x341715(0x17f)]?constants_1[_0x341715(0x166)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0xec9300=await this['salesforceQuery'][_0x341715(0x14a)](_0x5dec10),_0x4e77d6=(_0x3c82f2=_0xec9300[0x0])===null||_0x3c82f2===void 0x0?void 0x0:_0x3c82f2['Id'];if(!_0x4e77d6)throw new Error(errors_1[_0x341715(0x152)]);return _0x4e77d6;}async[a204_0x264728(0x187)](_0x493231){const _0xae1073=a204_0x264728;let _0x58757e=await this[_0xae1073(0x16a)](_0x493231)[_0xae1073(0x173)](()=>null);return!_0x58757e&&(_0x58757e=await this[_0xae1073(0x175)][_0xae1073(0x184)]('Attachment',{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x493231['objectId'],'ContentType':_0xae1073(0x18c),'Name':_0x493231[_0xae1073(0x17f)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0xae1073(0x143)]})),_0x58757e;}async[a204_0x264728(0x15f)](_0x2ad0b9,_0x10f6f1){const _0x2b844f=a204_0x264728,_0x3cf514=await this[_0x2b844f(0x187)](_0x2ad0b9);await this[_0x2b844f(0x175)][_0x2b844f(0x197)](_0x2b844f(0x169),_0x3cf514,{'Body':(0x0,utils_1[_0x2b844f(0x190)])(JSON[_0x2b844f(0x196)](_0x10f6f1))});}async['setStatus'](_0x397633,_0x5d6b29){const _0x3c9132=a204_0x264728;await this[_0x3c9132(0x175)][_0x3c9132(0x197)](_0x397633[_0x3c9132(0x144)],_0x397633[_0x3c9132(0x142)],{[constants_1[_0x3c9132(0x146)]+_0x3c9132(0x18b)]:_0x5d6b29});}async[a204_0x264728(0x163)](_0x4979ab){const _0x59be96=a204_0x264728;await this[_0x59be96(0x175)][_0x59be96(0x197)](constants_1[_0x59be96(0x146)]+_0x59be96(0x185),_0x4979ab,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x59be96(0x18d)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a204_0x264728(0x145)])(),__metadata(a204_0x264728(0x16d),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a204_0x264728(0x149)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;