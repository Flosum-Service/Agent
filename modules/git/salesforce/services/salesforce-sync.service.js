const a270_0x141b0e=a270_0xa956;function a270_0x5ed9(){const _0xa03ce7=['defineProperty','GET_COMPONENTS_QUERY','objectId','../../../shared/utils','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','ERR_INVALID_ATTACHMENT_ID','12578863sqwiyQ','GET_WAITING_BRANCHES_QUERY','function','494450GIpkGL','fromBranchRecord','29565oGRPpm','map','SalesforceSyncService','GET_REPOSITORY_BY_NAME_QUERY','FLOSUM_NAMESPACE','GET_REPOSITORIES_NAMES_QUERY','%parentId%','getAllRepositoryNames','SalesforceNotFoundError','GET_REPOSITORY_QUERY','./salesforce-query.service','metadata','33180uWoBPT','getBranchRecordByName','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getBranchRecord','query','replace','repositoryId','__metadata','../../../../constants/errors','../errors/not-found.error','GET_WAITING_REPOSITORIES_QUERY','toString','apply','object','patchObject','648cZAGmE','FlosumRepositorySyncDto','decorate','__decorate','getRepositoryRecord','Branch\x20','26579XiJLcR','./salesforce.service','getOwnPropertyDescriptor','fromRepositoryRecord','../dto/flosum-repository-sync.dto','Components__r','push','2171735mathVo','length','objectType','getRepositoryRecords','6fsrjhb','getAttachmentId','stringify','%id%','setStatus','Connection__c','SalesforceService','../queries','2vpDVMl','\x0a\x20\x20\x20\x20\x20\x20','GET_BRANCH_BY_NAME_QUERY','createObject','GET_BRANCH_QUERY','%name%','catch','salesforceQuery','FLOSUM_GIT_NAMESPACE','SalesforceQueryService','encodeBase64','910KPCMoA','find','204717vMZhMw','salesforceService','Name','constructor','\x20not\x20found\x20on\x20salesforce','typedi','getComponents','Sync_In_Progress__c','Repository__r','search','updateRemoteState','SYNC_ATTACHMENT_FOR_BRANCH_NAME'];a270_0x5ed9=function(){return _0xa03ce7;};return a270_0x5ed9();}(function(_0xaaa1ce,_0x40ad92){const _0xcc032d=a270_0xa956,_0x162712=_0xaaa1ce();while(!![]){try{const _0x281710=-parseInt(_0xcc032d(0x1b6))/0x1+parseInt(_0xcc032d(0x194))/0x2*(-parseInt(_0xcc032d(0x1a1))/0x3)+parseInt(_0xcc032d(0x1c4))/0x4+parseInt(_0xcc032d(0x188))/0x5*(parseInt(_0xcc032d(0x18c))/0x6)+parseInt(_0xcc032d(0x181))/0x7*(-parseInt(_0xcc032d(0x17b))/0x8)+parseInt(_0xcc032d(0x1b8))/0x9*(-parseInt(_0xcc032d(0x19f))/0xa)+parseInt(_0xcc032d(0x1b3))/0xb;if(_0x281710===_0x40ad92)break;else _0x162712['push'](_0x162712['shift']());}catch(_0x566e84){_0x162712['push'](_0x162712['shift']());}}}(a270_0x5ed9,0x65ce2));const a270_0x15f835=(function(){let _0x53fd4b=!![];return function(_0x58dd22,_0x45f1c9){const _0x44df01=_0x53fd4b?function(){const _0x3205cf=a270_0xa956;if(_0x45f1c9){const _0x1a3448=_0x45f1c9[_0x3205cf(0x1d0)](_0x58dd22,arguments);return _0x45f1c9=null,_0x1a3448;}}:function(){};return _0x53fd4b=![],_0x44df01;};}()),a270_0xe696cb=a270_0x15f835(this,function(){const _0x4eccb3=a270_0xa956;return a270_0xe696cb[_0x4eccb3(0x1cf)]()[_0x4eccb3(0x1aa)]('(((.+)+)+)+$')[_0x4eccb3(0x1cf)]()[_0x4eccb3(0x1a4)](a270_0xe696cb)['search']('(((.+)+)+)+$');});a270_0xe696cb();'use strict';var __decorate=this&&this[a270_0x141b0e(0x17e)]||function(_0x595350,_0x59d3ed,_0x379e6d,_0x112f4a){const _0x4738cc=a270_0x141b0e;var _0x586967=arguments[_0x4738cc(0x189)],_0x417659=_0x586967<0x3?_0x59d3ed:_0x112f4a===null?_0x112f4a=Object[_0x4738cc(0x183)](_0x59d3ed,_0x379e6d):_0x112f4a,_0x50d26b;if(typeof Reflect==='object'&&typeof Reflect[_0x4738cc(0x17d)]===_0x4738cc(0x1b5))_0x417659=Reflect[_0x4738cc(0x17d)](_0x595350,_0x59d3ed,_0x379e6d,_0x112f4a);else{for(var _0x375e3d=_0x595350[_0x4738cc(0x189)]-0x1;_0x375e3d>=0x0;_0x375e3d--)if(_0x50d26b=_0x595350[_0x375e3d])_0x417659=(_0x586967<0x3?_0x50d26b(_0x417659):_0x586967>0x3?_0x50d26b(_0x59d3ed,_0x379e6d,_0x417659):_0x50d26b(_0x59d3ed,_0x379e6d))||_0x417659;}return _0x586967>0x3&&_0x417659&&Object[_0x4738cc(0x1ad)](_0x59d3ed,_0x379e6d,_0x417659),_0x417659;},__metadata=this&&this[a270_0x141b0e(0x1cb)]||function(_0x34d6c4,_0x1c9767){const _0x320657=a270_0x141b0e;if(typeof Reflect===_0x320657(0x1d1)&&typeof Reflect[_0x320657(0x1c3)]===_0x320657(0x1b5))return Reflect[_0x320657(0x1c3)](_0x34d6c4,_0x1c9767);};Object[a270_0x141b0e(0x1ad)](exports,'__esModule',{'value':!![]}),exports[a270_0x141b0e(0x1ba)]=void 0x0;const typedi_1=require(a270_0x141b0e(0x1a6)),constants_1=require('../../../../constants'),errors_1=require(a270_0x141b0e(0x1cc)),utils_1=require(a270_0x141b0e(0x1b0)),flosum_repository_sync_dto_1=require(a270_0x141b0e(0x185)),not_found_error_1=require(a270_0x141b0e(0x1cd)),queries_1=require(a270_0x141b0e(0x193)),salesforce_query_service_1=require(a270_0x141b0e(0x1c2)),salesforce_service_1=require(a270_0x141b0e(0x182));function a270_0xa956(_0x3a687d,_0x5b8f85){const _0x2f6b8a=a270_0x5ed9();return a270_0xa956=function(_0xe696cb,_0x15f835){_0xe696cb=_0xe696cb-0x17a;let _0x5ed944=_0x2f6b8a[_0xe696cb];return _0x5ed944;},a270_0xa956(_0x3a687d,_0x5b8f85);}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x3ffd76,_0x13b6e1){const _0x6ffdc2=a270_0x141b0e;this[_0x6ffdc2(0x19b)]=_0x3ffd76,this[_0x6ffdc2(0x1a2)]=_0x13b6e1;}async[a270_0x141b0e(0x1a7)](_0x5e5156){const _0x19b077=a270_0x141b0e;var _0x1fdb3d;const _0x506fc1=await this[_0x19b077(0x19b)][_0x19b077(0x1c8)](_0x5e5156),_0x3de6a6=[];for(const _0x5335ad of _0x506fc1){const _0x1a7eb2=(_0x1fdb3d=_0x5335ad[constants_1[_0x19b077(0x1bc)]+_0x19b077(0x186)])===null||_0x1fdb3d===void 0x0?void 0x0:_0x1fdb3d['records'];_0x1a7eb2&&_0x1a7eb2[_0x19b077(0x189)]&&_0x3de6a6[_0x19b077(0x187)](_0x1a7eb2[0x0]['Id']);}return _0x3de6a6;}async[a270_0x141b0e(0x1bf)](_0xcbd0c0){const _0x268aef=a270_0x141b0e,_0x4e0319=await this['salesforceQuery']['query'](queries_1[_0x268aef(0x1bd)][_0x268aef(0x1c9)](/\%connection_id\%/g,_0xcbd0c0));return _0x4e0319[_0x268aef(0x1b9)](_0x1096dd=>{const _0x41c572=_0x268aef;return _0x1096dd[constants_1['FLOSUM_GIT_NAMESPACE']+_0x41c572(0x1a9)]?_0x1096dd[constants_1['FLOSUM_GIT_NAMESPACE']+_0x41c572(0x1a9)]['Name']:_0x1096dd[_0x41c572(0x1a3)];});}async[a270_0x141b0e(0x18b)](_0x433a5f){const _0x515ce5=a270_0x141b0e,_0x2507fa=await this[_0x515ce5(0x19b)][_0x515ce5(0x1c8)](queries_1[_0x515ce5(0x1ce)][_0x515ce5(0x1c9)](/\%connection_id\%/g,_0x433a5f));return _0x2507fa[_0x515ce5(0x1b9)](_0x2c0283=>flosum_repository_sync_dto_1[_0x515ce5(0x17c)][_0x515ce5(0x184)](_0x2c0283));}async['getBranchRecords'](_0x4f1422){const _0x1fb0a4=a270_0x141b0e,_0x431a0d=await this[_0x1fb0a4(0x19b)][_0x1fb0a4(0x1c8)](queries_1[_0x1fb0a4(0x1b4)][_0x1fb0a4(0x1c9)](/%repositories_ids\%/g,_0x4f1422));return _0x431a0d[_0x1fb0a4(0x1b9)](_0x1bb837=>flosum_repository_sync_dto_1[_0x1fb0a4(0x17c)]['fromBranchRecord'](_0x1bb837));}async[a270_0x141b0e(0x17f)](_0x51a74b){const _0x33b4b1=a270_0x141b0e,_0x59a875=await this[_0x33b4b1(0x19b)][_0x33b4b1(0x1c8)](queries_1[_0x33b4b1(0x1c1)][_0x33b4b1(0x1c9)](_0x33b4b1(0x18f),_0x51a74b));if(_0x59a875[_0x33b4b1(0x189)]===0x0)throw new not_found_error_1[(_0x33b4b1(0x1c0))]('Repository\x20with\x20Id\x20'+_0x51a74b+_0x33b4b1(0x1a5));return flosum_repository_sync_dto_1[_0x33b4b1(0x17c)]['fromRepositoryRecord'](_0x59a875[0x0]);}async[a270_0x141b0e(0x1c7)](_0x3a6cc6){const _0x3dd5bb=a270_0x141b0e,_0xebcb11=await this[_0x3dd5bb(0x19b)][_0x3dd5bb(0x1c8)](queries_1[_0x3dd5bb(0x198)]['replace'](_0x3dd5bb(0x18f),_0x3a6cc6));if(_0xebcb11[_0x3dd5bb(0x189)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20with\x20Id\x20'+_0x3a6cc6+_0x3dd5bb(0x1a5));return flosum_repository_sync_dto_1[_0x3dd5bb(0x17c)][_0x3dd5bb(0x1b7)](_0xebcb11[0x0]);}async[a270_0x141b0e(0x1c5)](_0xe15c7f){const _0x5b6b95=a270_0x141b0e,_0x1f45d0=await this[_0x5b6b95(0x19b)][_0x5b6b95(0x1c8)](queries_1[_0x5b6b95(0x196)][_0x5b6b95(0x1c9)](_0x5b6b95(0x199),_0xe15c7f));if(_0x1f45d0[_0x5b6b95(0x189)]===0x0)throw new not_found_error_1[(_0x5b6b95(0x1c0))]('Branch\x20'+_0xe15c7f+'\x20not\x20found\x20on\x20salesforce');const _0x6881f1=_0x1f45d0[_0x5b6b95(0x1a0)](_0x5a8852=>_0x5a8852[constants_1[_0x5b6b95(0x1bc)]+'Branch_Name__c']===_0xe15c7f);if(!_0x6881f1)throw new not_found_error_1[(_0x5b6b95(0x1c0))](_0x5b6b95(0x180)+_0xe15c7f+_0x5b6b95(0x1a5));return flosum_repository_sync_dto_1[_0x5b6b95(0x17c)][_0x5b6b95(0x1b7)](_0x6881f1);}async['getRepositoryRecordByName'](_0x5bceec){const _0x4b8b49=a270_0x141b0e,_0x43388d=await this['salesforceQuery'][_0x4b8b49(0x1c8)](queries_1[_0x4b8b49(0x1bb)]['replace'](_0x4b8b49(0x199),_0x5bceec));if(_0x43388d[_0x4b8b49(0x189)]===0x0)throw new not_found_error_1[(_0x4b8b49(0x1c0))]('Repository\x20'+_0x5bceec+_0x4b8b49(0x1a5));return flosum_repository_sync_dto_1[_0x4b8b49(0x17c)][_0x4b8b49(0x184)](_0x43388d[0x0]);}async['getComponentsFromRepository'](_0x32b0ab){const _0x40367c=a270_0x141b0e,_0x2ced8d=_0x40367c(0x195)+queries_1['GET_COMPONENTS_QUERY']+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x32b0ab+'\x27';return this[_0x40367c(0x1a7)](_0x2ced8d);}async['getBranchComponents'](_0x409a2f){const _0x5f5a7f=a270_0x141b0e,_0x5a8dea=_0x5f5a7f(0x1c6)+queries_1[_0x5f5a7f(0x1ae)]+_0x5f5a7f(0x1b1)+_0x409a2f+'\x27';return this[_0x5f5a7f(0x1a7)](_0x5a8dea);}async[a270_0x141b0e(0x18d)](_0x490e33){const _0xa1cf14=a270_0x141b0e;var _0x1cb5b1;const _0x23fa7b=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0xa1cf14(0x1c9)](_0xa1cf14(0x1be),_0x490e33[_0xa1cf14(0x1af)])[_0xa1cf14(0x1c9)](_0xa1cf14(0x199),_0x490e33[_0xa1cf14(0x1ca)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0xa1cf14(0x1ac)]),_0x4c8f77=await this[_0xa1cf14(0x19b)][_0xa1cf14(0x1c8)](_0x23fa7b),_0x234114=(_0x1cb5b1=_0x4c8f77[0x0])===null||_0x1cb5b1===void 0x0?void 0x0:_0x1cb5b1['Id'];if(!_0x234114)throw new Error(errors_1[_0xa1cf14(0x1b2)]);return _0x234114;}async['getRemoteStateAttachmentId'](_0x2ce823){const _0x9bfb08=a270_0x141b0e;let _0x3d59d2=await this[_0x9bfb08(0x18d)](_0x2ce823)[_0x9bfb08(0x19a)](()=>null);return!_0x3d59d2&&(_0x3d59d2=await this[_0x9bfb08(0x1a2)][_0x9bfb08(0x197)]('Attachment',{'Body':(0x0,utils_1[_0x9bfb08(0x19e)])('{}'),'ParentId':_0x2ce823[_0x9bfb08(0x1af)],'ContentType':'text/plain','Name':_0x2ce823[_0x9bfb08(0x1ca)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x9bfb08(0x1ac)]})),_0x3d59d2;}async[a270_0x141b0e(0x1ab)](_0x1db74f,_0x1d824f){const _0x168045=a270_0x141b0e,_0x44a6d7=await this['getRemoteStateAttachmentId'](_0x1db74f);await this['salesforceService'][_0x168045(0x17a)]('Attachment',_0x44a6d7,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0x168045(0x18e)](_0x1d824f))});}async[a270_0x141b0e(0x190)](_0x30bc5b,_0x5a82a3){const _0x4c7243=a270_0x141b0e;await this[_0x4c7243(0x1a2)]['patchObject'](_0x30bc5b[_0x4c7243(0x18a)],_0x30bc5b[_0x4c7243(0x1af)],{[constants_1['FLOSUM_GIT_NAMESPACE']+'Synchronization_Status__c']:_0x5a82a3});}async['disableSync'](_0x3ddc4c){const _0x17fecd=a270_0x141b0e;await this[_0x17fecd(0x1a2)][_0x17fecd(0x17a)](constants_1['FLOSUM_GIT_NAMESPACE']+_0x17fecd(0x191),_0x3ddc4c,{[constants_1[_0x17fecd(0x19c)]+_0x17fecd(0x1a8)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1['Service'])(),__metadata('design:paramtypes',[salesforce_query_service_1[a270_0x141b0e(0x19d)],salesforce_service_1[a270_0x141b0e(0x192)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;