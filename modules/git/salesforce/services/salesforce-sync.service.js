const a281_0x127fbd=a281_0x2755;(function(_0x396487,_0x3666f1){const _0x1683a0=a281_0x2755,_0x22fabc=_0x396487();while(!![]){try{const _0x5ad368=-parseInt(_0x1683a0(0x115))/0x1+parseInt(_0x1683a0(0x132))/0x2*(parseInt(_0x1683a0(0x150))/0x3)+-parseInt(_0x1683a0(0x15b))/0x4+parseInt(_0x1683a0(0x138))/0x5+-parseInt(_0x1683a0(0x164))/0x6+-parseInt(_0x1683a0(0x117))/0x7*(parseInt(_0x1683a0(0x113))/0x8)+-parseInt(_0x1683a0(0x11e))/0x9*(-parseInt(_0x1683a0(0x11d))/0xa);if(_0x5ad368===_0x3666f1)break;else _0x22fabc['push'](_0x22fabc['shift']());}catch(_0x27bc54){_0x22fabc['push'](_0x22fabc['shift']());}}}(a281_0x598d,0x30969));const a281_0x506a48=(function(){let _0x1595c3=!![];return function(_0x2e75c2,_0x2cef00){const _0x45a7e5=_0x1595c3?function(){const _0x39089a=a281_0x2755;if(_0x2cef00){const _0x4bcf2a=_0x2cef00[_0x39089a(0x119)](_0x2e75c2,arguments);return _0x2cef00=null,_0x4bcf2a;}}:function(){};return _0x1595c3=![],_0x45a7e5;};}()),a281_0x5acafe=a281_0x506a48(this,function(){const _0x548c3e=a281_0x2755;return a281_0x5acafe[_0x548c3e(0x157)]()[_0x548c3e(0x15f)]('(((.+)+)+)+$')['toString']()[_0x548c3e(0x14b)](a281_0x5acafe)[_0x548c3e(0x15f)](_0x548c3e(0x16b));});a281_0x5acafe();function a281_0x598d(){const _0x2c1ca3=['decorate','1538060faouhN','getBranchComponents','createObject','object','search','find','getRepositoryRecords','GET_WAITING_BRANCHES_QUERY','Attachment','1444194pJOLOD','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','disableSync','../../../shared/utils','FLOSUM_NAMESPACE','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','Name','(((.+)+)+)+$','getAttachmentId','GET_REPOSITORIES_NAMES_QUERY','GET_COMPONENTS_QUERY','822488vXFytu','GET_REPOSITORY_BY_NAME_QUERY','162791OCrLcD','patchObject','14cyboMG','ERR_INVALID_ATTACHMENT_ID','apply','Components__r','function','getBranchRecord','1760YFtMTR','51804xlMKWV','getBranchRecords','Connection__c','length','updateRemoteState','map','Branch_Name__c','push','__decorate','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','getAllRepositoryNames','GET_WAITING_REPOSITORIES_QUERY','stringify','getOwnPropertyDescriptor','FlosumRepositorySyncDto','../errors/not-found.error','metadata','./salesforce-query.service','%id%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','2xGCRFc','Branch\x20','GET_REPOSITORY_QUERY','../../../../constants/errors','./salesforce.service','typedi','524220WqtKZL','Repository\x20with\x20Id\x20','defineProperty','\x0a\x20\x20\x20\x20\x20\x20','replace','salesforceService','FLOSUM_GIT_NAMESPACE','getBranchRecordByName','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','salesforceQuery','fromRepositoryRecord','fromBranchRecord','encodeBase64','__esModule','SalesforceNotFoundError','objectType','Repository__r','design:paramtypes','getRepositoryRecordByName','constructor','getComponents','Service','\x20not\x20found\x20on\x20salesforce','repositoryId','224232AKZsMo','SalesforceQueryService','query','text/plain','__metadata','objectId','../queries','toString','getRemoteStateAttachmentId','GET_BRANCH_QUERY'];a281_0x598d=function(){return _0x2c1ca3;};return a281_0x598d();}'use strict';var __decorate=this&&this[a281_0x127fbd(0x126)]||function(_0x1c3ba1,_0x448251,_0x37c1cd,_0x50bb92){const _0xa7811=a281_0x127fbd;var _0x4eadd2=arguments['length'],_0x16d8ac=_0x4eadd2<0x3?_0x448251:_0x50bb92===null?_0x50bb92=Object[_0xa7811(0x12b)](_0x448251,_0x37c1cd):_0x50bb92,_0xbca0f3;if(typeof Reflect===_0xa7811(0x15e)&&typeof Reflect[_0xa7811(0x15a)]===_0xa7811(0x11b))_0x16d8ac=Reflect[_0xa7811(0x15a)](_0x1c3ba1,_0x448251,_0x37c1cd,_0x50bb92);else{for(var _0x6de91c=_0x1c3ba1[_0xa7811(0x121)]-0x1;_0x6de91c>=0x0;_0x6de91c--)if(_0xbca0f3=_0x1c3ba1[_0x6de91c])_0x16d8ac=(_0x4eadd2<0x3?_0xbca0f3(_0x16d8ac):_0x4eadd2>0x3?_0xbca0f3(_0x448251,_0x37c1cd,_0x16d8ac):_0xbca0f3(_0x448251,_0x37c1cd))||_0x16d8ac;}return _0x4eadd2>0x3&&_0x16d8ac&&Object[_0xa7811(0x13a)](_0x448251,_0x37c1cd,_0x16d8ac),_0x16d8ac;},__metadata=this&&this[a281_0x127fbd(0x154)]||function(_0x24812f,_0x713968){const _0x3f2d0f=a281_0x127fbd;if(typeof Reflect===_0x3f2d0f(0x15e)&&typeof Reflect['metadata']===_0x3f2d0f(0x11b))return Reflect[_0x3f2d0f(0x12e)](_0x24812f,_0x713968);};function a281_0x2755(_0x38078b,_0x2a85ef){const _0x16d7ec=a281_0x598d();return a281_0x2755=function(_0x5acafe,_0x506a48){_0x5acafe=_0x5acafe-0x112;let _0x598d53=_0x16d7ec[_0x5acafe];return _0x598d53;},a281_0x2755(_0x38078b,_0x2a85ef);}Object[a281_0x127fbd(0x13a)](exports,a281_0x127fbd(0x145),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require(a281_0x127fbd(0x137)),constants_1=require('../../../../constants'),errors_1=require(a281_0x127fbd(0x135)),utils_1=require(a281_0x127fbd(0x167)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a281_0x127fbd(0x12d)),queries_1=require(a281_0x127fbd(0x156)),salesforce_query_service_1=require(a281_0x127fbd(0x12f)),salesforce_service_1=require(a281_0x127fbd(0x136));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x558df1,_0x15b6b8){const _0x16f8ac=a281_0x127fbd;this['salesforceQuery']=_0x558df1,this[_0x16f8ac(0x13d)]=_0x15b6b8;}async[a281_0x127fbd(0x14c)](_0x4d9cad){const _0x52129e=a281_0x127fbd;var _0x32da5f;const _0x2afe66=await this[_0x52129e(0x141)][_0x52129e(0x152)](_0x4d9cad),_0x30d77c=[];for(const _0x7f7946 of _0x2afe66){const _0x1b8d07=(_0x32da5f=_0x7f7946[constants_1[_0x52129e(0x168)]+_0x52129e(0x11a)])===null||_0x32da5f===void 0x0?void 0x0:_0x32da5f['records'];_0x1b8d07&&_0x1b8d07[_0x52129e(0x121)]&&_0x30d77c[_0x52129e(0x125)](_0x1b8d07[0x0]['Id']);}return _0x30d77c;}async[a281_0x127fbd(0x128)](_0x260ad8){const _0x34b3fd=a281_0x127fbd,_0x1284d4=await this[_0x34b3fd(0x141)][_0x34b3fd(0x152)](queries_1[_0x34b3fd(0x16d)][_0x34b3fd(0x13c)](/\%connection_id\%/g,_0x260ad8));return _0x1284d4[_0x34b3fd(0x123)](_0x114494=>{const _0x94bff5=_0x34b3fd;return _0x114494[constants_1[_0x94bff5(0x13e)]+_0x94bff5(0x148)]?_0x114494[constants_1[_0x94bff5(0x13e)]+'Repository__r'][_0x94bff5(0x16a)]:_0x114494[_0x94bff5(0x16a)];});}async[a281_0x127fbd(0x161)](_0x346cc7){const _0x2bfee0=a281_0x127fbd,_0x2882b9=await this[_0x2bfee0(0x141)][_0x2bfee0(0x152)](queries_1[_0x2bfee0(0x129)][_0x2bfee0(0x13c)](/\%connection_id\%/g,_0x346cc7));return _0x2882b9[_0x2bfee0(0x123)](_0x2684f2=>flosum_repository_sync_dto_1[_0x2bfee0(0x12c)][_0x2bfee0(0x142)](_0x2684f2));}async[a281_0x127fbd(0x11f)](_0x54478f){const _0x11c0d8=a281_0x127fbd,_0x30376c=await this[_0x11c0d8(0x141)]['query'](queries_1[_0x11c0d8(0x162)][_0x11c0d8(0x13c)](/%repositories_ids\%/g,_0x54478f));return _0x30376c[_0x11c0d8(0x123)](_0x4f6a31=>flosum_repository_sync_dto_1[_0x11c0d8(0x12c)][_0x11c0d8(0x143)](_0x4f6a31));}async['getRepositoryRecord'](_0x49f40e){const _0xa9fe91=a281_0x127fbd,_0x2118bd=await this[_0xa9fe91(0x141)][_0xa9fe91(0x152)](queries_1[_0xa9fe91(0x134)][_0xa9fe91(0x13c)](_0xa9fe91(0x130),_0x49f40e));if(_0x2118bd['length']===0x0)throw new not_found_error_1[(_0xa9fe91(0x146))](_0xa9fe91(0x139)+_0x49f40e+_0xa9fe91(0x14e));return flosum_repository_sync_dto_1[_0xa9fe91(0x12c)][_0xa9fe91(0x142)](_0x2118bd[0x0]);}async[a281_0x127fbd(0x11c)](_0x111644){const _0x9014e5=a281_0x127fbd,_0x2e9caf=await this[_0x9014e5(0x141)][_0x9014e5(0x152)](queries_1[_0x9014e5(0x159)][_0x9014e5(0x13c)](_0x9014e5(0x130),_0x111644));if(_0x2e9caf[_0x9014e5(0x121)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20with\x20Id\x20'+_0x111644+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x9014e5(0x12c)][_0x9014e5(0x143)](_0x2e9caf[0x0]);}async[a281_0x127fbd(0x13f)](_0x271e97){const _0x4dbed7=a281_0x127fbd,_0x650a27=await this[_0x4dbed7(0x141)][_0x4dbed7(0x152)](queries_1['GET_BRANCH_BY_NAME_QUERY'][_0x4dbed7(0x13c)]('%name%',_0x271e97));if(_0x650a27['length']===0x0)throw new not_found_error_1[(_0x4dbed7(0x146))](_0x4dbed7(0x133)+_0x271e97+_0x4dbed7(0x14e));const _0x2d74dc=_0x650a27[_0x4dbed7(0x160)](_0x37abb3=>_0x37abb3[constants_1['FLOSUM_NAMESPACE']+_0x4dbed7(0x124)]===_0x271e97);if(!_0x2d74dc)throw new not_found_error_1[(_0x4dbed7(0x146))](_0x4dbed7(0x133)+_0x271e97+_0x4dbed7(0x14e));return flosum_repository_sync_dto_1[_0x4dbed7(0x12c)]['fromBranchRecord'](_0x2d74dc);}async[a281_0x127fbd(0x14a)](_0x502304){const _0x463693=a281_0x127fbd,_0x3329c3=await this[_0x463693(0x141)][_0x463693(0x152)](queries_1[_0x463693(0x114)][_0x463693(0x13c)]('%name%',_0x502304));if(_0x3329c3[_0x463693(0x121)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20'+_0x502304+_0x463693(0x14e));return flosum_repository_sync_dto_1[_0x463693(0x12c)]['fromRepositoryRecord'](_0x3329c3[0x0]);}async['getComponentsFromRepository'](_0x3fedf1){const _0x1a8ec4=a281_0x127fbd,_0x35d4d7=_0x1a8ec4(0x13b)+queries_1[_0x1a8ec4(0x112)]+_0x1a8ec4(0x169)+_0x3fedf1+'\x27';return this[_0x1a8ec4(0x14c)](_0x35d4d7);}async[a281_0x127fbd(0x15c)](_0x59b8b2){const _0x39eee0=a281_0x127fbd,_0x416603=_0x39eee0(0x140)+queries_1[_0x39eee0(0x112)]+_0x39eee0(0x131)+_0x59b8b2+'\x27';return this[_0x39eee0(0x14c)](_0x416603);}async[a281_0x127fbd(0x16c)](_0x37b7d2){const _0x4690e3=a281_0x127fbd;var _0x7fa250;const _0x541b8e=queries_1[_0x4690e3(0x127)][_0x4690e3(0x13c)]('%parentId%',_0x37b7d2[_0x4690e3(0x155)])[_0x4690e3(0x13c)]('%name%',_0x37b7d2[_0x4690e3(0x14f)]?constants_1[_0x4690e3(0x165)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x243173=await this[_0x4690e3(0x141)]['query'](_0x541b8e),_0x4ad81b=(_0x7fa250=_0x243173[0x0])===null||_0x7fa250===void 0x0?void 0x0:_0x7fa250['Id'];if(!_0x4ad81b)throw new Error(errors_1[_0x4690e3(0x118)]);return _0x4ad81b;}async[a281_0x127fbd(0x158)](_0x32c0f0){const _0x33b49d=a281_0x127fbd;let _0x5ab790=await this['getAttachmentId'](_0x32c0f0)['catch'](()=>null);return!_0x5ab790&&(_0x5ab790=await this[_0x33b49d(0x13d)][_0x33b49d(0x15d)](_0x33b49d(0x163),{'Body':(0x0,utils_1[_0x33b49d(0x144)])('{}'),'ParentId':_0x32c0f0[_0x33b49d(0x155)],'ContentType':_0x33b49d(0x153),'Name':_0x32c0f0[_0x33b49d(0x14f)]?constants_1[_0x33b49d(0x165)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x5ab790;}async[a281_0x127fbd(0x122)](_0xe0d09b,_0xfaa0fc){const _0x5cac26=a281_0x127fbd,_0x523c6a=await this[_0x5cac26(0x158)](_0xe0d09b);await this['salesforceService'][_0x5cac26(0x116)](_0x5cac26(0x163),_0x523c6a,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0x5cac26(0x12a)](_0xfaa0fc))});}async['setStatus'](_0x2c06f9,_0x445cda){const _0x5c30b1=a281_0x127fbd;await this['salesforceService'][_0x5c30b1(0x116)](_0x2c06f9[_0x5c30b1(0x147)],_0x2c06f9[_0x5c30b1(0x155)],{[constants_1[_0x5c30b1(0x13e)]+'Synchronization_Status__c']:_0x445cda});}async[a281_0x127fbd(0x166)](_0x509c78){const _0x474bd1=a281_0x127fbd;await this[_0x474bd1(0x13d)][_0x474bd1(0x116)](constants_1[_0x474bd1(0x13e)]+_0x474bd1(0x120),_0x509c78,{[constants_1[_0x474bd1(0x13e)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a281_0x127fbd(0x14d)])(),__metadata(a281_0x127fbd(0x149),[salesforce_query_service_1[a281_0x127fbd(0x151)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;