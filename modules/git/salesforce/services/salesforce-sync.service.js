const a254_0x5d005b=a254_0x2df9;(function(_0x263906,_0x3be4bf){const _0x367de8=a254_0x2df9,_0x4b257c=_0x263906();while(!![]){try{const _0x5680a8=parseInt(_0x367de8(0x11d))/0x1*(parseInt(_0x367de8(0x127))/0x2)+-parseInt(_0x367de8(0x104))/0x3+-parseInt(_0x367de8(0x13f))/0x4*(-parseInt(_0x367de8(0x102))/0x5)+-parseInt(_0x367de8(0x117))/0x6+parseInt(_0x367de8(0x148))/0x7+parseInt(_0x367de8(0x13b))/0x8*(-parseInt(_0x367de8(0x11f))/0x9)+parseInt(_0x367de8(0x11b))/0xa;if(_0x5680a8===_0x3be4bf)break;else _0x4b257c['push'](_0x4b257c['shift']());}catch(_0x6599ed){_0x4b257c['push'](_0x4b257c['shift']());}}}(a254_0xab49,0x72110));const a254_0x50ec0b=(function(){let _0x14c258=!![];return function(_0x124f22,_0x496108){const _0xb43cf1=_0x14c258?function(){const _0x14f190=a254_0x2df9;if(_0x496108){const _0x553d12=_0x496108[_0x14f190(0x10a)](_0x124f22,arguments);return _0x496108=null,_0x553d12;}}:function(){};return _0x14c258=![],_0xb43cf1;};}()),a254_0x435f61=a254_0x50ec0b(this,function(){const _0x2051bc=a254_0x2df9;return a254_0x435f61[_0x2051bc(0x13c)]()[_0x2051bc(0x153)](_0x2051bc(0x147))[_0x2051bc(0x13c)]()[_0x2051bc(0x157)](a254_0x435f61)[_0x2051bc(0x153)](_0x2051bc(0x147));});a254_0x435f61();function a254_0xab49(){const _0x43439c=['GET_REPOSITORY_BY_NAME_QUERY','GET_BRANCH_BY_NAME_QUERY','updateRemoteState','SalesforceNotFoundError','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','Repository\x20','getAttachmentId','metadata','5094888Wmghph','objectId','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','Name','5044430PMitwo','records','3QkfBeb','Service','2031597XUzXNn','getBranchComponents','getComponentsFromRepository','Components__r','./salesforce-query.service','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','__esModule','../errors/not-found.error','342142IAJSjl','createObject','GET_COMPONENTS_QUERY','getRepositoryRecordByName','%name%','replace','encodeBase64','GET_BRANCH_QUERY','stringify','\x0a\x20\x20\x20\x20\x20\x20','getBranchRecordByName','setStatus','Branch\x20','FlosumRepositorySyncDto','Attachment','../../../../constants/errors','getRepositoryRecords','salesforceQuery','../../../../constants','__decorate','8BDdfET','toString','../../../shared/utils','getBranchRecord','4zlcLuE','SalesforceQueryService','getRemoteStateAttachmentId','decorate','getAllRepositoryNames','Sync_In_Progress__c','SalesforceSyncService','Connection__c','(((.+)+)+)+$','2157071kJXuwI','%id%','Branch_Name__c','SYNC_ATTACHMENT_FOR_BRANCH_NAME','query','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','GET_WAITING_REPOSITORIES_QUERY','%parentId%','defineProperty','getComponents','patchObject','search','text/plain','push','disableSync','constructor','./salesforce.service','../dto/flosum-repository-sync.dto','\x20not\x20found\x20on\x20salesforce','repositoryId','ERR_INVALID_ATTACHMENT_ID','map','fromRepositoryRecord','getOwnPropertyDescriptor','Repository\x20with\x20Id\x20','__metadata','FLOSUM_GIT_NAMESPACE','3377095yhRynE','SalesforceService','1377393fbBbPe','function','object','Synchronization_Status__c','GET_REPOSITORY_QUERY','fromBranchRecord','apply','salesforceService','Branch\x20with\x20Id\x20','objectType','length'];a254_0xab49=function(){return _0x43439c;};return a254_0xab49();}'use strict';var __decorate=this&&this[a254_0x5d005b(0x13a)]||function(_0xb2cc2d,_0x5a37ca,_0x1c419a,_0x39e6ac){const _0x25dd51=a254_0x5d005b;var _0x2fffe4=arguments[_0x25dd51(0x10e)],_0x4334ca=_0x2fffe4<0x3?_0x5a37ca:_0x39e6ac===null?_0x39e6ac=Object[_0x25dd51(0xfe)](_0x5a37ca,_0x1c419a):_0x39e6ac,_0x237173;if(typeof Reflect===_0x25dd51(0x106)&&typeof Reflect[_0x25dd51(0x142)]===_0x25dd51(0x105))_0x4334ca=Reflect[_0x25dd51(0x142)](_0xb2cc2d,_0x5a37ca,_0x1c419a,_0x39e6ac);else{for(var _0x575c48=_0xb2cc2d[_0x25dd51(0x10e)]-0x1;_0x575c48>=0x0;_0x575c48--)if(_0x237173=_0xb2cc2d[_0x575c48])_0x4334ca=(_0x2fffe4<0x3?_0x237173(_0x4334ca):_0x2fffe4>0x3?_0x237173(_0x5a37ca,_0x1c419a,_0x4334ca):_0x237173(_0x5a37ca,_0x1c419a))||_0x4334ca;}return _0x2fffe4>0x3&&_0x4334ca&&Object[_0x25dd51(0x150)](_0x5a37ca,_0x1c419a,_0x4334ca),_0x4334ca;},__metadata=this&&this[a254_0x5d005b(0x100)]||function(_0x4d32aa,_0x577888){const _0x149b0d=a254_0x5d005b;if(typeof Reflect===_0x149b0d(0x106)&&typeof Reflect[_0x149b0d(0x116)]===_0x149b0d(0x105))return Reflect['metadata'](_0x4d32aa,_0x577888);};function a254_0x2df9(_0x5c2c45,_0x3da1fc){const _0x1e37f9=a254_0xab49();return a254_0x2df9=function(_0x435f61,_0x50ec0b){_0x435f61=_0x435f61-0xfc;let _0xab49=_0x1e37f9[_0x435f61];return _0xab49;},a254_0x2df9(_0x5c2c45,_0x3da1fc);}Object['defineProperty'](exports,a254_0x5d005b(0x125),{'value':!![]}),exports[a254_0x5d005b(0x145)]=void 0x0;const typedi_1=require('typedi'),constants_1=require(a254_0x5d005b(0x139)),errors_1=require(a254_0x5d005b(0x136)),utils_1=require(a254_0x5d005b(0x13d)),flosum_repository_sync_dto_1=require(a254_0x5d005b(0x159)),not_found_error_1=require(a254_0x5d005b(0x126)),queries_1=require('../queries'),salesforce_query_service_1=require(a254_0x5d005b(0x123)),salesforce_service_1=require(a254_0x5d005b(0x158));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x176c26,_0x2b1b66){const _0x146733=a254_0x5d005b;this[_0x146733(0x138)]=_0x176c26,this[_0x146733(0x10b)]=_0x2b1b66;}async[a254_0x5d005b(0x151)](_0x45f5fa){const _0x234b5f=a254_0x5d005b;var _0x18c7f8;const _0x2f3494=await this[_0x234b5f(0x138)][_0x234b5f(0x14c)](_0x45f5fa),_0x236f04=[];for(const _0x1ae266 of _0x2f3494){const _0x1d5a5a=(_0x18c7f8=_0x1ae266[constants_1['FLOSUM_NAMESPACE']+_0x234b5f(0x122)])===null||_0x18c7f8===void 0x0?void 0x0:_0x18c7f8[_0x234b5f(0x11c)];_0x1d5a5a&&_0x1d5a5a['length']&&_0x236f04[_0x234b5f(0x155)](_0x1d5a5a[0x0]['Id']);}return _0x236f04;}async[a254_0x5d005b(0x143)](_0x1584e4){const _0x137ea6=a254_0x5d005b,_0x22025e=await this['salesforceQuery']['query'](queries_1['GET_REPOSITORIES_NAMES_QUERY'][_0x137ea6(0x12c)](/\%connection_id\%/g,_0x1584e4));return _0x22025e['map'](_0x5ee916=>{const _0x345d41=_0x137ea6;return _0x5ee916[constants_1[_0x345d41(0x101)]+'Repository__r']?_0x5ee916[constants_1[_0x345d41(0x101)]+'Repository__r'][_0x345d41(0x11a)]:_0x5ee916[_0x345d41(0x11a)];});}async[a254_0x5d005b(0x137)](_0x57d7cc){const _0x576744=a254_0x5d005b,_0x24f9d5=await this[_0x576744(0x138)][_0x576744(0x14c)](queries_1[_0x576744(0x14e)][_0x576744(0x12c)](/\%connection_id\%/g,_0x57d7cc));return _0x24f9d5[_0x576744(0xfc)](_0x54b045=>flosum_repository_sync_dto_1[_0x576744(0x134)][_0x576744(0xfd)](_0x54b045));}async['getBranchRecords'](_0x3289a5){const _0x55415b=a254_0x5d005b,_0x27de59=await this[_0x55415b(0x138)][_0x55415b(0x14c)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x55415b(0x12c)](/%repositories_ids\%/g,_0x3289a5));return _0x27de59['map'](_0x348fb0=>flosum_repository_sync_dto_1[_0x55415b(0x134)]['fromBranchRecord'](_0x348fb0));}async['getRepositoryRecord'](_0x1219e2){const _0xcea88a=a254_0x5d005b,_0x438581=await this['salesforceQuery'][_0xcea88a(0x14c)](queries_1[_0xcea88a(0x108)][_0xcea88a(0x12c)](_0xcea88a(0x149),_0x1219e2));if(_0x438581[_0xcea88a(0x10e)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0xcea88a(0xff)+_0x1219e2+_0xcea88a(0x15a));return flosum_repository_sync_dto_1[_0xcea88a(0x134)]['fromRepositoryRecord'](_0x438581[0x0]);}async[a254_0x5d005b(0x13e)](_0x35f036){const _0x3e4dd6=a254_0x5d005b,_0x116f58=await this[_0x3e4dd6(0x138)][_0x3e4dd6(0x14c)](queries_1[_0x3e4dd6(0x12e)][_0x3e4dd6(0x12c)](_0x3e4dd6(0x149),_0x35f036));if(_0x116f58['length']===0x0)throw new not_found_error_1[(_0x3e4dd6(0x112))](_0x3e4dd6(0x10c)+_0x35f036+_0x3e4dd6(0x15a));return flosum_repository_sync_dto_1[_0x3e4dd6(0x134)][_0x3e4dd6(0x109)](_0x116f58[0x0]);}async[a254_0x5d005b(0x131)](_0x247a52){const _0x460a47=a254_0x5d005b,_0x4a2a61=await this[_0x460a47(0x138)][_0x460a47(0x14c)](queries_1[_0x460a47(0x110)]['replace'](_0x460a47(0x12b),_0x247a52));if(_0x4a2a61[_0x460a47(0x10e)]===0x0)throw new not_found_error_1[(_0x460a47(0x112))](_0x460a47(0x133)+_0x247a52+_0x460a47(0x15a));const _0x385b11=_0x4a2a61['find'](_0x2a28fc=>_0x2a28fc[constants_1['FLOSUM_NAMESPACE']+_0x460a47(0x14a)]===_0x247a52);if(!_0x385b11)throw new not_found_error_1[(_0x460a47(0x112))](_0x460a47(0x133)+_0x247a52+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0x385b11);}async[a254_0x5d005b(0x12a)](_0x2d2e6c){const _0x46f4e5=a254_0x5d005b,_0x25696a=await this[_0x46f4e5(0x138)][_0x46f4e5(0x14c)](queries_1[_0x46f4e5(0x10f)][_0x46f4e5(0x12c)](_0x46f4e5(0x12b),_0x2d2e6c));if(_0x25696a[_0x46f4e5(0x10e)]===0x0)throw new not_found_error_1[(_0x46f4e5(0x112))](_0x46f4e5(0x114)+_0x2d2e6c+_0x46f4e5(0x15a));return flosum_repository_sync_dto_1[_0x46f4e5(0x134)][_0x46f4e5(0xfd)](_0x25696a[0x0]);}async[a254_0x5d005b(0x121)](_0x553c57){const _0x559d7d=a254_0x5d005b,_0x59bdea=_0x559d7d(0x130)+queries_1[_0x559d7d(0x129)]+_0x559d7d(0x14d)+_0x553c57+'\x27';return this[_0x559d7d(0x151)](_0x59bdea);}async[a254_0x5d005b(0x120)](_0x4c6d5d){const _0x5e58b8=a254_0x5d005b,_0x828246=_0x5e58b8(0x124)+queries_1[_0x5e58b8(0x129)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x4c6d5d+'\x27';return this['getComponents'](_0x828246);}async[a254_0x5d005b(0x115)](_0x1ad849){const _0x47bb2d=a254_0x5d005b;var _0x5111f6;const _0x197e61=queries_1[_0x47bb2d(0x113)][_0x47bb2d(0x12c)](_0x47bb2d(0x14f),_0x1ad849[_0x47bb2d(0x118)])[_0x47bb2d(0x12c)](_0x47bb2d(0x12b),_0x1ad849[_0x47bb2d(0x15b)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x47bb2d(0x14b)]),_0x12963d=await this[_0x47bb2d(0x138)][_0x47bb2d(0x14c)](_0x197e61),_0x54ef38=(_0x5111f6=_0x12963d[0x0])===null||_0x5111f6===void 0x0?void 0x0:_0x5111f6['Id'];if(!_0x54ef38)throw new Error(errors_1[_0x47bb2d(0x15c)]);return _0x54ef38;}async[a254_0x5d005b(0x141)](_0x19eb76){const _0x845a65=a254_0x5d005b;let _0x213457=await this['getAttachmentId'](_0x19eb76)['catch'](()=>null);return!_0x213457&&(_0x213457=await this[_0x845a65(0x10b)][_0x845a65(0x128)](_0x845a65(0x135),{'Body':(0x0,utils_1[_0x845a65(0x12d)])('{}'),'ParentId':_0x19eb76[_0x845a65(0x118)],'ContentType':_0x845a65(0x154),'Name':_0x19eb76[_0x845a65(0x15b)]?constants_1[_0x845a65(0x119)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x213457;}async[a254_0x5d005b(0x111)](_0x2f8689,_0x1a93d0){const _0x84cd2d=a254_0x5d005b,_0x66b4a0=await this['getRemoteStateAttachmentId'](_0x2f8689);await this[_0x84cd2d(0x10b)]['patchObject'](_0x84cd2d(0x135),_0x66b4a0,{'Body':(0x0,utils_1[_0x84cd2d(0x12d)])(JSON[_0x84cd2d(0x12f)](_0x1a93d0))});}async[a254_0x5d005b(0x132)](_0xc4aae1,_0x53e34a){const _0x34d377=a254_0x5d005b;await this['salesforceService'][_0x34d377(0x152)](_0xc4aae1[_0x34d377(0x10d)],_0xc4aae1[_0x34d377(0x118)],{[constants_1[_0x34d377(0x101)]+_0x34d377(0x107)]:_0x53e34a});}async[a254_0x5d005b(0x156)](_0x1d70b3){const _0x14cadc=a254_0x5d005b;await this[_0x14cadc(0x10b)][_0x14cadc(0x152)](constants_1[_0x14cadc(0x101)]+_0x14cadc(0x146),_0x1d70b3,{[constants_1[_0x14cadc(0x101)]+_0x14cadc(0x144)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a254_0x5d005b(0x11e)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a254_0x5d005b(0x140)],salesforce_service_1[a254_0x5d005b(0x103)]])],SalesforceSyncService),exports[a254_0x5d005b(0x145)]=SalesforceSyncService;