const a281_0x42d5b6=a281_0x3da2;(function(_0x4ee7c2,_0x1321f6){const _0x4c60f2=a281_0x3da2,_0x3dd45b=_0x4ee7c2();while(!![]){try{const _0x530757=parseInt(_0x4c60f2(0xda))/0x1+parseInt(_0x4c60f2(0x96))/0x2+-parseInt(_0x4c60f2(0x9f))/0x3+-parseInt(_0x4c60f2(0xe0))/0x4+-parseInt(_0x4c60f2(0xaa))/0x5*(parseInt(_0x4c60f2(0xa1))/0x6)+parseInt(_0x4c60f2(0x99))/0x7*(parseInt(_0x4c60f2(0xbe))/0x8)+parseInt(_0x4c60f2(0xa3))/0x9*(parseInt(_0x4c60f2(0xc2))/0xa);if(_0x530757===_0x1321f6)break;else _0x3dd45b['push'](_0x3dd45b['shift']());}catch(_0x5bf785){_0x3dd45b['push'](_0x3dd45b['shift']());}}}(a281_0x4bbb,0xd6c72));function a281_0x3da2(_0x309a54,_0x5a757b){const _0x5bd7b0=a281_0x4bbb();return a281_0x3da2=function(_0x5973fd,_0x2a932e){_0x5973fd=_0x5973fd-0x96;let _0x4bbbe2=_0x5bd7b0[_0x5973fd];return _0x4bbbe2;},a281_0x3da2(_0x309a54,_0x5a757b);}const a281_0x2a932e=(function(){let _0x383ee7=!![];return function(_0x57cffd,_0x1bf6af){const _0x552846=_0x383ee7?function(){if(_0x1bf6af){const _0x426468=_0x1bf6af['apply'](_0x57cffd,arguments);return _0x1bf6af=null,_0x426468;}}:function(){};return _0x383ee7=![],_0x552846;};}()),a281_0x5973fd=a281_0x2a932e(this,function(){const _0x583629=a281_0x3da2;return a281_0x5973fd['toString']()['search'](_0x583629(0xb6))[_0x583629(0xc3)]()[_0x583629(0xe7)](a281_0x5973fd)['search'](_0x583629(0xb6));});a281_0x5973fd();function a281_0x4bbb(){const _0x2525c6=['GET_COMPONENTS_QUERY','827364HmDvKR','getRepositoryRecords','FLOSUM_GIT_NAMESPACE','length','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','%parentId%','2404180jpoFGm','SYNC_ATTACHMENT_FOR_BRANCH_NAME','salesforceService','salesforceQuery','fromBranchRecord','find','GET_REPOSITORY_BY_NAME_QUERY','constructor','\x0a\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','SalesforceService','../../../shared/utils','%name%','../dto/flosum-repository-sync.dto','\x20not\x20found\x20on\x20salesforce','getBranchComponents','typedi','285002xXMpuf','./salesforce-query.service','object','7CDbIdf','Name','Repository\x20','FlosumRepositorySyncDto','GET_WAITING_REPOSITORIES_QUERY','Repository\x20with\x20Id\x20','1159137ZTIArL','getOwnPropertyDescriptor','3433002Iydfnc','getAttachmentId','9FIYVyz','GET_BRANCH_QUERY','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','SalesforceQueryService','repositoryId','getComponents','SalesforceNotFoundError','15BfBVBv','Connection__c','__metadata','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','../../../../constants','Service','getBranchRecords','encodeBase64','text/plain','disableSync','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','fromRepositoryRecord','(((.+)+)+)+$','objectId','query','FLOSUM_NAMESPACE','%id%','../errors/not-found.error','setStatus','../../../../constants/errors','9622552siXuGR','GET_BRANCH_BY_NAME_QUERY','decorate','getRemoteStateAttachmentId','14109710cqoVzo','toString','GET_REPOSITORIES_NAMES_QUERY','function','catch','stringify','SalesforceSyncService','push','Branch\x20','getRepositoryRecord','map','defineProperty','getRepositoryRecordByName','Synchronization_Status__c','getAllRepositoryNames','Attachment','patchObject','../queries','design:paramtypes','replace','records','./salesforce.service','Sync_In_Progress__c'];a281_0x4bbb=function(){return _0x2525c6;};return a281_0x4bbb();}'use strict';var __decorate=this&&this['__decorate']||function(_0x3306aa,_0x30c299,_0x16845d,_0x351d15){const _0x669a9c=a281_0x3da2;var _0x1c95e3=arguments[_0x669a9c(0xdd)],_0x1695d6=_0x1c95e3<0x3?_0x30c299:_0x351d15===null?_0x351d15=Object[_0x669a9c(0xa0)](_0x30c299,_0x16845d):_0x351d15,_0x37c9f7;if(typeof Reflect===_0x669a9c(0x98)&&typeof Reflect[_0x669a9c(0xc0)]===_0x669a9c(0xc5))_0x1695d6=Reflect[_0x669a9c(0xc0)](_0x3306aa,_0x30c299,_0x16845d,_0x351d15);else{for(var _0x413256=_0x3306aa[_0x669a9c(0xdd)]-0x1;_0x413256>=0x0;_0x413256--)if(_0x37c9f7=_0x3306aa[_0x413256])_0x1695d6=(_0x1c95e3<0x3?_0x37c9f7(_0x1695d6):_0x1c95e3>0x3?_0x37c9f7(_0x30c299,_0x16845d,_0x1695d6):_0x37c9f7(_0x30c299,_0x16845d))||_0x1695d6;}return _0x1c95e3>0x3&&_0x1695d6&&Object[_0x669a9c(0xcd)](_0x30c299,_0x16845d,_0x1695d6),_0x1695d6;},__metadata=this&&this[a281_0x42d5b6(0xac)]||function(_0x2815e5,_0x5b722d){const _0x2b9eab=a281_0x42d5b6;if(typeof Reflect===_0x2b9eab(0x98)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x2815e5,_0x5b722d);};Object[a281_0x42d5b6(0xcd)](exports,'__esModule',{'value':!![]}),exports[a281_0x42d5b6(0xc8)]=void 0x0;const typedi_1=require(a281_0x42d5b6(0xf0)),constants_1=require(a281_0x42d5b6(0xae)),errors_1=require(a281_0x42d5b6(0xbd)),utils_1=require(a281_0x42d5b6(0xeb)),flosum_repository_sync_dto_1=require(a281_0x42d5b6(0xed)),not_found_error_1=require(a281_0x42d5b6(0xbb)),queries_1=require(a281_0x42d5b6(0xd3)),salesforce_query_service_1=require(a281_0x42d5b6(0x97)),salesforce_service_1=require(a281_0x42d5b6(0xd7));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x3d09e9,_0x33400d){const _0x2ef177=a281_0x42d5b6;this[_0x2ef177(0xe3)]=_0x3d09e9,this[_0x2ef177(0xe2)]=_0x33400d;}async[a281_0x42d5b6(0xa8)](_0x2b2e67){const _0x751342=a281_0x42d5b6;var _0x2355f2;const _0x19f9c1=await this[_0x751342(0xe3)][_0x751342(0xb8)](_0x2b2e67),_0xf5d7c3=[];for(const _0x1a1825 of _0x19f9c1){const _0x551fc2=(_0x2355f2=_0x1a1825[constants_1[_0x751342(0xb9)]+'Components__r'])===null||_0x2355f2===void 0x0?void 0x0:_0x2355f2[_0x751342(0xd6)];_0x551fc2&&_0x551fc2['length']&&_0xf5d7c3[_0x751342(0xc9)](_0x551fc2[0x0]['Id']);}return _0xf5d7c3;}async[a281_0x42d5b6(0xd0)](_0x4baa29){const _0x5f5929=a281_0x42d5b6,_0xe92649=await this[_0x5f5929(0xe3)][_0x5f5929(0xb8)](queries_1[_0x5f5929(0xc4)][_0x5f5929(0xd5)](/\%connection_id\%/g,_0x4baa29));return _0xe92649[_0x5f5929(0xcc)](_0x18743f=>{const _0x33d76d=_0x5f5929;return _0x18743f[constants_1[_0x33d76d(0xdc)]+'Repository__r']?_0x18743f[constants_1[_0x33d76d(0xdc)]+'Repository__r'][_0x33d76d(0x9a)]:_0x18743f['Name'];});}async[a281_0x42d5b6(0xdb)](_0x56e0a6){const _0x59c898=a281_0x42d5b6,_0x37d7e5=await this[_0x59c898(0xe3)]['query'](queries_1[_0x59c898(0x9d)][_0x59c898(0xd5)](/\%connection_id\%/g,_0x56e0a6));return _0x37d7e5['map'](_0x49bf02=>flosum_repository_sync_dto_1[_0x59c898(0x9c)][_0x59c898(0xb5)](_0x49bf02));}async[a281_0x42d5b6(0xb0)](_0x8b2dc3){const _0x16e288=a281_0x42d5b6,_0x22b23c=await this[_0x16e288(0xe3)][_0x16e288(0xb8)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x16e288(0xd5)](/%repositories_ids\%/g,_0x8b2dc3));return _0x22b23c[_0x16e288(0xcc)](_0x411144=>flosum_repository_sync_dto_1[_0x16e288(0x9c)][_0x16e288(0xe4)](_0x411144));}async[a281_0x42d5b6(0xcb)](_0x4efd4a){const _0x3eb2da=a281_0x42d5b6,_0x4171ab=await this['salesforceQuery']['query'](queries_1['GET_REPOSITORY_QUERY'][_0x3eb2da(0xd5)](_0x3eb2da(0xba),_0x4efd4a));if(_0x4171ab[_0x3eb2da(0xdd)]===0x0)throw new not_found_error_1[(_0x3eb2da(0xa9))](_0x3eb2da(0x9e)+_0x4efd4a+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x3eb2da(0x9c)][_0x3eb2da(0xb5)](_0x4171ab[0x0]);}async['getBranchRecord'](_0x291a5a){const _0x39e43d=a281_0x42d5b6,_0x4aa6c1=await this[_0x39e43d(0xe3)][_0x39e43d(0xb8)](queries_1[_0x39e43d(0xa4)][_0x39e43d(0xd5)](_0x39e43d(0xba),_0x291a5a));if(_0x4aa6c1['length']===0x0)throw new not_found_error_1[(_0x39e43d(0xa9))]('Branch\x20with\x20Id\x20'+_0x291a5a+_0x39e43d(0xee));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x39e43d(0xe4)](_0x4aa6c1[0x0]);}async['getBranchRecordByName'](_0xe8d11c){const _0x41d009=a281_0x42d5b6,_0x414aa5=await this[_0x41d009(0xe3)]['query'](queries_1[_0x41d009(0xbf)][_0x41d009(0xd5)]('%name%',_0xe8d11c));if(_0x414aa5[_0x41d009(0xdd)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x41d009(0xca)+_0xe8d11c+_0x41d009(0xee));const _0x56777c=_0x414aa5[_0x41d009(0xe5)](_0x196cf4=>_0x196cf4[constants_1[_0x41d009(0xb9)]+'Branch_Name__c']===_0xe8d11c);if(!_0x56777c)throw new not_found_error_1[(_0x41d009(0xa9))](_0x41d009(0xca)+_0xe8d11c+_0x41d009(0xee));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x41d009(0xe4)](_0x56777c);}async[a281_0x42d5b6(0xce)](_0x1dee8a){const _0xb329f2=a281_0x42d5b6,_0xfaec36=await this[_0xb329f2(0xe3)][_0xb329f2(0xb8)](queries_1[_0xb329f2(0xe6)][_0xb329f2(0xd5)](_0xb329f2(0xec),_0x1dee8a));if(_0xfaec36['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0xb329f2(0x9b)+_0x1dee8a+_0xb329f2(0xee));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0xb329f2(0xb5)](_0xfaec36[0x0]);}async['getComponentsFromRepository'](_0x4aad92){const _0x5b23cb=a281_0x42d5b6,_0x31d996=_0x5b23cb(0xe8)+queries_1[_0x5b23cb(0xd9)]+_0x5b23cb(0xe9)+_0x4aad92+'\x27';return this[_0x5b23cb(0xa8)](_0x31d996);}async[a281_0x42d5b6(0xef)](_0x2842bd){const _0x236989=a281_0x42d5b6,_0xa20bbd=_0x236989(0xb4)+queries_1[_0x236989(0xd9)]+_0x236989(0xa5)+_0x2842bd+'\x27';return this[_0x236989(0xa8)](_0xa20bbd);}async[a281_0x42d5b6(0xa2)](_0x34d50d){const _0x5c2c03=a281_0x42d5b6;var _0x163ad5;const _0x309848=queries_1[_0x5c2c03(0xad)][_0x5c2c03(0xd5)](_0x5c2c03(0xdf),_0x34d50d[_0x5c2c03(0xb7)])[_0x5c2c03(0xd5)]('%name%',_0x34d50d['repositoryId']?constants_1[_0x5c2c03(0xde)]:constants_1[_0x5c2c03(0xe1)]),_0x36fd1c=await this[_0x5c2c03(0xe3)][_0x5c2c03(0xb8)](_0x309848),_0x13166c=(_0x163ad5=_0x36fd1c[0x0])===null||_0x163ad5===void 0x0?void 0x0:_0x163ad5['Id'];if(!_0x13166c)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x13166c;}async['getRemoteStateAttachmentId'](_0x1dc158){const _0x3f9bc6=a281_0x42d5b6;let _0x2afbfe=await this[_0x3f9bc6(0xa2)](_0x1dc158)[_0x3f9bc6(0xc6)](()=>null);return!_0x2afbfe&&(_0x2afbfe=await this['salesforceService']['createObject'](_0x3f9bc6(0xd1),{'Body':(0x0,utils_1[_0x3f9bc6(0xb1)])('{}'),'ParentId':_0x1dc158[_0x3f9bc6(0xb7)],'ContentType':_0x3f9bc6(0xb2),'Name':_0x1dc158[_0x3f9bc6(0xa7)]?constants_1[_0x3f9bc6(0xde)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x2afbfe;}async['updateRemoteState'](_0x522ae9,_0x4bea1b){const _0x4bc48b=a281_0x42d5b6,_0x4ce1e6=await this[_0x4bc48b(0xc1)](_0x522ae9);await this[_0x4bc48b(0xe2)][_0x4bc48b(0xd2)](_0x4bc48b(0xd1),_0x4ce1e6,{'Body':(0x0,utils_1[_0x4bc48b(0xb1)])(JSON[_0x4bc48b(0xc7)](_0x4bea1b))});}async[a281_0x42d5b6(0xbc)](_0x54af1a,_0x4d8375){const _0x204bed=a281_0x42d5b6;await this[_0x204bed(0xe2)][_0x204bed(0xd2)](_0x54af1a['objectType'],_0x54af1a['objectId'],{[constants_1[_0x204bed(0xdc)]+_0x204bed(0xcf)]:_0x4d8375});}async[a281_0x42d5b6(0xb3)](_0x38add0){const _0x472b3f=a281_0x42d5b6;await this[_0x472b3f(0xe2)]['patchObject'](constants_1[_0x472b3f(0xdc)]+_0x472b3f(0xab),_0x38add0,{[constants_1[_0x472b3f(0xdc)]+_0x472b3f(0xd8)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a281_0x42d5b6(0xaf)])(),__metadata(a281_0x42d5b6(0xd4),[salesforce_query_service_1[a281_0x42d5b6(0xa6)],salesforce_service_1[a281_0x42d5b6(0xea)]])],SalesforceSyncService),exports[a281_0x42d5b6(0xc8)]=SalesforceSyncService;