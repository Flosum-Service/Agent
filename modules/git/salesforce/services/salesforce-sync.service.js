const a237_0x1f1165=a237_0x1be2;(function(_0x399471,_0xc0b424){const _0x32c9e3=a237_0x1be2,_0x401ac9=_0x399471();while(!![]){try{const _0x3c163f=-parseInt(_0x32c9e3(0x141))/0x1*(-parseInt(_0x32c9e3(0x128))/0x2)+-parseInt(_0x32c9e3(0x12d))/0x3+parseInt(_0x32c9e3(0x12c))/0x4*(-parseInt(_0x32c9e3(0x148))/0x5)+parseInt(_0x32c9e3(0x150))/0x6+-parseInt(_0x32c9e3(0x144))/0x7+-parseInt(_0x32c9e3(0x14c))/0x8*(parseInt(_0x32c9e3(0x159))/0x9)+parseInt(_0x32c9e3(0x133))/0xa*(parseInt(_0x32c9e3(0x132))/0xb);if(_0x3c163f===_0xc0b424)break;else _0x401ac9['push'](_0x401ac9['shift']());}catch(_0x8d51a4){_0x401ac9['push'](_0x401ac9['shift']());}}}(a237_0x2c3a,0x85849));const a237_0x4dc7b5=(function(){let _0x29a78e=!![];return function(_0x223f39,_0x511aef){const _0x1d8563=_0x29a78e?function(){const _0x55a5a5=a237_0x1be2;if(_0x511aef){const _0x31d3ce=_0x511aef[_0x55a5a5(0x119)](_0x223f39,arguments);return _0x511aef=null,_0x31d3ce;}}:function(){};return _0x29a78e=![],_0x1d8563;};}()),a237_0x214aed=a237_0x4dc7b5(this,function(){const _0x457a79=a237_0x1be2;return a237_0x214aed[_0x457a79(0x136)]()['search'](_0x457a79(0x158))['toString']()[_0x457a79(0x15d)](a237_0x214aed)[_0x457a79(0x14e)](_0x457a79(0x158));});a237_0x214aed();function a237_0x1be2(_0xab81b0,_0x52f70a){const _0x2cbff9=a237_0x2c3a();return a237_0x1be2=function(_0x214aed,_0x4dc7b5){_0x214aed=_0x214aed-0x113;let _0x2c3a7a=_0x2cbff9[_0x214aed];return _0x2c3a7a;},a237_0x1be2(_0xab81b0,_0x52f70a);}'use strict';var __decorate=this&&this['__decorate']||function(_0x599867,_0xd0d36a,_0x29827e,_0x4ff4d3){const _0x315c02=a237_0x1be2;var _0x390b99=arguments[_0x315c02(0x131)],_0x2411cd=_0x390b99<0x3?_0xd0d36a:_0x4ff4d3===null?_0x4ff4d3=Object[_0x315c02(0x114)](_0xd0d36a,_0x29827e):_0x4ff4d3,_0x52f27e;if(typeof Reflect==='object'&&typeof Reflect[_0x315c02(0x127)]===_0x315c02(0x123))_0x2411cd=Reflect[_0x315c02(0x127)](_0x599867,_0xd0d36a,_0x29827e,_0x4ff4d3);else{for(var _0x5ae436=_0x599867['length']-0x1;_0x5ae436>=0x0;_0x5ae436--)if(_0x52f27e=_0x599867[_0x5ae436])_0x2411cd=(_0x390b99<0x3?_0x52f27e(_0x2411cd):_0x390b99>0x3?_0x52f27e(_0xd0d36a,_0x29827e,_0x2411cd):_0x52f27e(_0xd0d36a,_0x29827e))||_0x2411cd;}return _0x390b99>0x3&&_0x2411cd&&Object[_0x315c02(0x16f)](_0xd0d36a,_0x29827e,_0x2411cd),_0x2411cd;},__metadata=this&&this[a237_0x1f1165(0x129)]||function(_0x2f2b43,_0x82c78){const _0x36d7a1=a237_0x1f1165;if(typeof Reflect===_0x36d7a1(0x167)&&typeof Reflect[_0x36d7a1(0x117)]===_0x36d7a1(0x123))return Reflect[_0x36d7a1(0x117)](_0x2f2b43,_0x82c78);};Object['defineProperty'](exports,a237_0x1f1165(0x12b),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;function a237_0x2c3a(){const _0x3a9291=['getComponents','Attachment','GET_BRANCH_QUERY','object','\x0a\x20\x20\x20\x20\x20\x20','Branch\x20','../errors/not-found.error','query','SalesforceQueryService','Repository\x20','repositoryId','defineProperty','GET_REPOSITORY_BY_NAME_QUERY','salesforceService','getRemoteStateAttachmentId','getOwnPropertyDescriptor','catch','../dto/flosum-repository-sync.dto','metadata','fromBranchRecord','apply','replace','Sync_In_Progress__c','Connection__c','%parentId%','disableSync','../../../shared/utils','records','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Service','function','getComponentsFromRepository','Repository__r','patchObject','decorate','604rgtqns','__metadata','GET_REPOSITORIES_NAMES_QUERY','__esModule','1204244epQnWw','1598220nEvUzr','getRepositoryRecords','salesforceQuery','getBranchRecord','length','9705718yoQGFR','20coIOTU','GET_COMPONENTS_QUERY','Components__r','toString','../queries','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','GET_WAITING_BRANCHES_QUERY','map','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','Branch\x20with\x20Id\x20','%name%','fromRepositoryRecord','GET_REPOSITORY_QUERY','%id%','2495UwmwOx','Name','getBranchRecordByName','4586008wfYTuP','FlosumRepositorySyncDto','./salesforce.service','getAttachmentId','15pTvsTE','objectId','GET_WAITING_REPOSITORIES_QUERY','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','6350584zFpJhb','./salesforce-query.service','search','SYNC_ATTACHMENT_FOR_BRANCH_NAME','5481678UHVCHB','../../../../constants/errors','GET_BRANCH_BY_NAME_QUERY','getRepositoryRecord','push','Repository\x20with\x20Id\x20','SalesforceSyncService','SalesforceNotFoundError','(((.+)+)+)+$','9auTIpn','setStatus','\x20not\x20found\x20on\x20salesforce','FLOSUM_NAMESPACE','constructor','getAllRepositoryNames','design:paramtypes','stringify','FLOSUM_GIT_NAMESPACE','getBranchRecords','text/plain'];a237_0x2c3a=function(){return _0x3a9291;};return a237_0x2c3a();}const typedi_1=require('typedi'),constants_1=require('../../../../constants'),errors_1=require(a237_0x1f1165(0x151)),utils_1=require(a237_0x1f1165(0x11f)),flosum_repository_sync_dto_1=require(a237_0x1f1165(0x116)),not_found_error_1=require(a237_0x1f1165(0x16a)),queries_1=require(a237_0x1f1165(0x137)),salesforce_query_service_1=require(a237_0x1f1165(0x14d)),salesforce_service_1=require(a237_0x1f1165(0x146));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x49af81,_0xb50d52){const _0x212169=a237_0x1f1165;this['salesforceQuery']=_0x49af81,this[_0x212169(0x171)]=_0xb50d52;}async[a237_0x1f1165(0x164)](_0xdc03fc){const _0x5e2886=a237_0x1f1165;var _0x287afa;const _0x5ab780=await this['salesforceQuery'][_0x5e2886(0x16b)](_0xdc03fc),_0x9d02f3=[];for(const _0x418da8 of _0x5ab780){const _0xf26380=(_0x287afa=_0x418da8[constants_1['FLOSUM_NAMESPACE']+_0x5e2886(0x135)])===null||_0x287afa===void 0x0?void 0x0:_0x287afa[_0x5e2886(0x120)];_0xf26380&&_0xf26380[_0x5e2886(0x131)]&&_0x9d02f3[_0x5e2886(0x154)](_0xf26380[0x0]['Id']);}return _0x9d02f3;}async[a237_0x1f1165(0x15e)](_0x51ba42){const _0x179892=a237_0x1f1165,_0x346d7a=await this[_0x179892(0x12f)]['query'](queries_1[_0x179892(0x12a)]['replace'](/\%connection_id\%/g,_0x51ba42));return _0x346d7a[_0x179892(0x13a)](_0x46d521=>{const _0x4c49fa=_0x179892;return _0x46d521[constants_1[_0x4c49fa(0x161)]+_0x4c49fa(0x125)]?_0x46d521[constants_1[_0x4c49fa(0x161)]+'Repository__r']['Name']:_0x46d521[_0x4c49fa(0x142)];});}async[a237_0x1f1165(0x12e)](_0x55480c){const _0x1d0b7c=a237_0x1f1165,_0x33e6b7=await this[_0x1d0b7c(0x12f)][_0x1d0b7c(0x16b)](queries_1[_0x1d0b7c(0x14a)][_0x1d0b7c(0x11a)](/\%connection_id\%/g,_0x55480c));return _0x33e6b7[_0x1d0b7c(0x13a)](_0x440238=>flosum_repository_sync_dto_1[_0x1d0b7c(0x145)][_0x1d0b7c(0x13e)](_0x440238));}async[a237_0x1f1165(0x162)](_0x1581e4){const _0x18ce73=a237_0x1f1165,_0x2de8f8=await this[_0x18ce73(0x12f)][_0x18ce73(0x16b)](queries_1[_0x18ce73(0x139)][_0x18ce73(0x11a)](/%repositories_ids\%/g,_0x1581e4));return _0x2de8f8[_0x18ce73(0x13a)](_0x1dde43=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x18ce73(0x118)](_0x1dde43));}async[a237_0x1f1165(0x153)](_0x2a8783){const _0xc955f9=a237_0x1f1165,_0x5b3cfc=await this[_0xc955f9(0x12f)][_0xc955f9(0x16b)](queries_1[_0xc955f9(0x13f)]['replace'](_0xc955f9(0x140),_0x2a8783));if(_0x5b3cfc[_0xc955f9(0x131)]===0x0)throw new not_found_error_1[(_0xc955f9(0x157))](_0xc955f9(0x155)+_0x2a8783+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0xc955f9(0x13e)](_0x5b3cfc[0x0]);}async[a237_0x1f1165(0x130)](_0x44cf4b){const _0x4518b7=a237_0x1f1165,_0x3481e4=await this[_0x4518b7(0x12f)][_0x4518b7(0x16b)](queries_1[_0x4518b7(0x166)][_0x4518b7(0x11a)](_0x4518b7(0x140),_0x44cf4b));if(_0x3481e4['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x4518b7(0x13c)+_0x44cf4b+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x4518b7(0x145)][_0x4518b7(0x118)](_0x3481e4[0x0]);}async[a237_0x1f1165(0x143)](_0x548f9e){const _0x569e08=a237_0x1f1165,_0x182693=await this[_0x569e08(0x12f)]['query'](queries_1[_0x569e08(0x152)][_0x569e08(0x11a)](_0x569e08(0x13d),_0x548f9e));if(_0x182693[_0x569e08(0x131)]===0x0)throw new not_found_error_1[(_0x569e08(0x157))](_0x569e08(0x169)+_0x548f9e+_0x569e08(0x15b));const _0x176b05=_0x182693['find'](_0x279c4d=>_0x279c4d[constants_1[_0x569e08(0x15c)]+'Branch_Name__c']===_0x548f9e);if(!_0x176b05)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x548f9e+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x569e08(0x145)]['fromBranchRecord'](_0x176b05);}async['getRepositoryRecordByName'](_0x28c564){const _0xc5af3f=a237_0x1f1165,_0x5d0cb3=await this['salesforceQuery']['query'](queries_1[_0xc5af3f(0x170)][_0xc5af3f(0x11a)](_0xc5af3f(0x13d),_0x28c564));if(_0x5d0cb3[_0xc5af3f(0x131)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0xc5af3f(0x16d)+_0x28c564+_0xc5af3f(0x15b));return flosum_repository_sync_dto_1[_0xc5af3f(0x145)][_0xc5af3f(0x13e)](_0x5d0cb3[0x0]);}async[a237_0x1f1165(0x124)](_0x2874d0){const _0x3a9afa=a237_0x1f1165,_0x26f3c2=_0x3a9afa(0x168)+queries_1[_0x3a9afa(0x134)]+_0x3a9afa(0x14b)+_0x2874d0+'\x27';return this[_0x3a9afa(0x164)](_0x26f3c2);}async['getBranchComponents'](_0x5bac23){const _0x39e384=a237_0x1f1165,_0x2f5973=_0x39e384(0x121)+queries_1[_0x39e384(0x134)]+_0x39e384(0x138)+_0x5bac23+'\x27';return this[_0x39e384(0x164)](_0x2f5973);}async[a237_0x1f1165(0x147)](_0x2f4448){const _0xe3e40f=a237_0x1f1165;var _0x1fe588;const _0x56aed6=queries_1[_0xe3e40f(0x13b)]['replace'](_0xe3e40f(0x11d),_0x2f4448[_0xe3e40f(0x149)])[_0xe3e40f(0x11a)](_0xe3e40f(0x13d),_0x2f4448['repositoryId']?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0xe3e40f(0x14f)]),_0x32fc2f=await this['salesforceQuery'][_0xe3e40f(0x16b)](_0x56aed6),_0x217d59=(_0x1fe588=_0x32fc2f[0x0])===null||_0x1fe588===void 0x0?void 0x0:_0x1fe588['Id'];if(!_0x217d59)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x217d59;}async[a237_0x1f1165(0x113)](_0x1848f8){const _0x2db326=a237_0x1f1165;let _0x2bdc89=await this[_0x2db326(0x147)](_0x1848f8)[_0x2db326(0x115)](()=>null);return!_0x2bdc89&&(_0x2bdc89=await this['salesforceService']['createObject'](_0x2db326(0x165),{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x1848f8['objectId'],'ContentType':_0x2db326(0x163),'Name':_0x1848f8[_0x2db326(0x16e)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x2db326(0x14f)]})),_0x2bdc89;}async['updateRemoteState'](_0x5be4e8,_0x57eceb){const _0x7063cf=a237_0x1f1165,_0x8a4753=await this[_0x7063cf(0x113)](_0x5be4e8);await this[_0x7063cf(0x171)]['patchObject'](_0x7063cf(0x165),_0x8a4753,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0x7063cf(0x160)](_0x57eceb))});}async[a237_0x1f1165(0x15a)](_0x4b50f7,_0x576b1f){const _0x25a38b=a237_0x1f1165;await this[_0x25a38b(0x171)]['patchObject'](_0x4b50f7['objectType'],_0x4b50f7[_0x25a38b(0x149)],{[constants_1['FLOSUM_GIT_NAMESPACE']+'Synchronization_Status__c']:_0x576b1f});}async[a237_0x1f1165(0x11e)](_0x3d5c8d){const _0x3b90c4=a237_0x1f1165;await this['salesforceService'][_0x3b90c4(0x126)](constants_1[_0x3b90c4(0x161)]+_0x3b90c4(0x11c),_0x3d5c8d,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x3b90c4(0x11b)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a237_0x1f1165(0x122)])(),__metadata(a237_0x1f1165(0x15f),[salesforce_query_service_1[a237_0x1f1165(0x16c)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports[a237_0x1f1165(0x156)]=SalesforceSyncService;