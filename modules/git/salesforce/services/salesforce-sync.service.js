const a238_0x5f3caa=a238_0xc7d5;(function(_0x3d6e68,_0x462200){const _0x572dd6=a238_0xc7d5,_0x513382=_0x3d6e68();while(!![]){try{const _0x45e141=-parseInt(_0x572dd6(0x178))/0x1*(parseInt(_0x572dd6(0x145))/0x2)+-parseInt(_0x572dd6(0x160))/0x3+parseInt(_0x572dd6(0x167))/0x4+-parseInt(_0x572dd6(0x12e))/0x5+-parseInt(_0x572dd6(0x12b))/0x6*(parseInt(_0x572dd6(0x15d))/0x7)+-parseInt(_0x572dd6(0x13e))/0x8+parseInt(_0x572dd6(0x132))/0x9;if(_0x45e141===_0x462200)break;else _0x513382['push'](_0x513382['shift']());}catch(_0x553921){_0x513382['push'](_0x513382['shift']());}}}(a238_0xf98c,0x9af3b));const a238_0x43229a=(function(){let _0x2cae27=!![];return function(_0x4a4c3a,_0x38438d){const _0x5f554e=_0x2cae27?function(){const _0x48ca39=a238_0xc7d5;if(_0x38438d){const _0x36d2ef=_0x38438d[_0x48ca39(0x15e)](_0x4a4c3a,arguments);return _0x38438d=null,_0x36d2ef;}}:function(){};return _0x2cae27=![],_0x5f554e;};}()),a238_0x3f891d=a238_0x43229a(this,function(){const _0x48560e=a238_0xc7d5;return a238_0x3f891d['toString']()['search'](_0x48560e(0x16e))[_0x48560e(0x133)]()[_0x48560e(0x155)](a238_0x3f891d)[_0x48560e(0x181)](_0x48560e(0x16e));});function a238_0xf98c(){const _0x363c51=['decorate','text/plain','FlosumRepositorySyncDto','GET_COMPONENTS_QUERY','(((.+)+)+)+$','Service','SalesforceSyncService','function','getRemoteStateAttachmentId','objectId','Components__r','Repository\x20','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','%parentId%','320597pSAxxb','getAttachmentId','defineProperty','Branch\x20','Synchronization_Status__c','GET_REPOSITORY_BY_NAME_QUERY','patchObject','ERR_INVALID_ATTACHMENT_ID','length','search','../../../../constants/errors','typedi','../../../shared/utils','%name%','66SoFyqS','Repository\x20with\x20Id\x20','\x0a\x20\x20\x20\x20\x20\x20','5113495vRELTX','__metadata','getBranchRecords','Attachment','30081168CGUDIl','toString','Connection__c','GET_REPOSITORY_QUERY','fromRepositoryRecord','salesforceQuery','map','replace','stringify','getBranchRecordByName','query','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','1484576JOHEmn','../../../../constants','../errors/not-found.error','catch','SYNC_ATTACHMENT_FOR_BRANCH_NAME','\x20not\x20found\x20on\x20salesforce','FLOSUM_GIT_NAMESPACE','6PUZAbZ','design:paramtypes','Name','../queries','GET_WAITING_REPOSITORIES_QUERY','GET_BRANCH_QUERY','getAllRepositoryNames','__decorate','objectType','Sync_In_Progress__c','SalesforceService','SalesforceNotFoundError','encodeBase64','./salesforce-query.service','%id%','metadata','constructor','GET_BRANCH_BY_NAME_QUERY','fromBranchRecord','getOwnPropertyDescriptor','getBranchRecord','Repository__r','salesforceService','createObject','281323udWqTV','apply','repositoryId','2001018menFEv','find','GET_REPOSITORIES_NAMES_QUERY','object','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','./salesforce.service','getRepositoryRecords','2285912QUapqY','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','FLOSUM_NAMESPACE'];a238_0xf98c=function(){return _0x363c51;};return a238_0xf98c();}a238_0x3f891d();function a238_0xc7d5(_0x4bd480,_0x5071c4){const _0x26f409=a238_0xf98c();return a238_0xc7d5=function(_0x3f891d,_0x43229a){_0x3f891d=_0x3f891d-0x12b;let _0xf98c0e=_0x26f409[_0x3f891d];return _0xf98c0e;},a238_0xc7d5(_0x4bd480,_0x5071c4);}'use strict';var __decorate=this&&this[a238_0x5f3caa(0x14c)]||function(_0x3eec19,_0x128a82,_0x269822,_0x238408){const _0x578c0f=a238_0x5f3caa;var _0x34b616=arguments[_0x578c0f(0x180)],_0x2add73=_0x34b616<0x3?_0x128a82:_0x238408===null?_0x238408=Object[_0x578c0f(0x158)](_0x128a82,_0x269822):_0x238408,_0x25fc0f;if(typeof Reflect==='object'&&typeof Reflect[_0x578c0f(0x16a)]===_0x578c0f(0x171))_0x2add73=Reflect['decorate'](_0x3eec19,_0x128a82,_0x269822,_0x238408);else{for(var _0x5325ea=_0x3eec19[_0x578c0f(0x180)]-0x1;_0x5325ea>=0x0;_0x5325ea--)if(_0x25fc0f=_0x3eec19[_0x5325ea])_0x2add73=(_0x34b616<0x3?_0x25fc0f(_0x2add73):_0x34b616>0x3?_0x25fc0f(_0x128a82,_0x269822,_0x2add73):_0x25fc0f(_0x128a82,_0x269822))||_0x2add73;}return _0x34b616>0x3&&_0x2add73&&Object['defineProperty'](_0x128a82,_0x269822,_0x2add73),_0x2add73;},__metadata=this&&this[a238_0x5f3caa(0x12f)]||function(_0x43e992,_0x204cea){const _0x4b5e1e=a238_0x5f3caa;if(typeof Reflect===_0x4b5e1e(0x163)&&typeof Reflect[_0x4b5e1e(0x154)]===_0x4b5e1e(0x171))return Reflect[_0x4b5e1e(0x154)](_0x43e992,_0x204cea);};Object[a238_0x5f3caa(0x17a)](exports,'__esModule',{'value':!![]}),exports[a238_0x5f3caa(0x170)]=void 0x0;const typedi_1=require(a238_0x5f3caa(0x183)),constants_1=require(a238_0x5f3caa(0x13f)),errors_1=require(a238_0x5f3caa(0x182)),utils_1=require(a238_0x5f3caa(0x184)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a238_0x5f3caa(0x140)),queries_1=require(a238_0x5f3caa(0x148)),salesforce_query_service_1=require(a238_0x5f3caa(0x152)),salesforce_service_1=require(a238_0x5f3caa(0x165));let SalesforceSyncService=class SalesforceSyncService{constructor(_0xc1217b,_0x290c98){const _0x5c0148=a238_0x5f3caa;this[_0x5c0148(0x137)]=_0xc1217b,this[_0x5c0148(0x15b)]=_0x290c98;}async['getComponents'](_0x70dcf1){const _0x42a196=a238_0x5f3caa;var _0x54a070;const _0x508b38=await this[_0x42a196(0x137)][_0x42a196(0x13c)](_0x70dcf1),_0x572286=[];for(const _0x58edfd of _0x508b38){const _0x1bf979=(_0x54a070=_0x58edfd[constants_1[_0x42a196(0x169)]+_0x42a196(0x174)])===null||_0x54a070===void 0x0?void 0x0:_0x54a070['records'];_0x1bf979&&_0x1bf979[_0x42a196(0x180)]&&_0x572286['push'](_0x1bf979[0x0]['Id']);}return _0x572286;}async[a238_0x5f3caa(0x14b)](_0x16269b){const _0x535548=a238_0x5f3caa,_0x3c725f=await this[_0x535548(0x137)][_0x535548(0x13c)](queries_1[_0x535548(0x162)][_0x535548(0x139)](/\%connection_id\%/g,_0x16269b));return _0x3c725f[_0x535548(0x138)](_0x2ac285=>{const _0x2ea4fe=_0x535548;return _0x2ac285[constants_1[_0x2ea4fe(0x144)]+_0x2ea4fe(0x15a)]?_0x2ac285[constants_1[_0x2ea4fe(0x144)]+_0x2ea4fe(0x15a)][_0x2ea4fe(0x147)]:_0x2ac285['Name'];});}async[a238_0x5f3caa(0x166)](_0x3559ad){const _0x66fadb=a238_0x5f3caa,_0x25611c=await this[_0x66fadb(0x137)]['query'](queries_1[_0x66fadb(0x149)][_0x66fadb(0x139)](/\%connection_id\%/g,_0x3559ad));return _0x25611c[_0x66fadb(0x138)](_0x3f45dc=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x3f45dc));}async[a238_0x5f3caa(0x130)](_0x3c091e){const _0x504ce7=a238_0x5f3caa,_0x2a4bdc=await this['salesforceQuery'][_0x504ce7(0x13c)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x504ce7(0x139)](/%repositories_ids\%/g,_0x3c091e));return _0x2a4bdc[_0x504ce7(0x138)](_0x52f97e=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0x52f97e));}async['getRepositoryRecord'](_0x52f396){const _0x30c43e=a238_0x5f3caa,_0x476d1e=await this[_0x30c43e(0x137)][_0x30c43e(0x13c)](queries_1[_0x30c43e(0x135)][_0x30c43e(0x139)](_0x30c43e(0x153),_0x52f396));if(_0x476d1e[_0x30c43e(0x180)]===0x0)throw new not_found_error_1[(_0x30c43e(0x150))](_0x30c43e(0x12c)+_0x52f396+_0x30c43e(0x143));return flosum_repository_sync_dto_1[_0x30c43e(0x16c)][_0x30c43e(0x136)](_0x476d1e[0x0]);}async[a238_0x5f3caa(0x159)](_0x3583f4){const _0x47fdce=a238_0x5f3caa,_0x430a6f=await this[_0x47fdce(0x137)][_0x47fdce(0x13c)](queries_1[_0x47fdce(0x14a)][_0x47fdce(0x139)](_0x47fdce(0x153),_0x3583f4));if(_0x430a6f[_0x47fdce(0x180)]===0x0)throw new not_found_error_1[(_0x47fdce(0x150))]('Branch\x20with\x20Id\x20'+_0x3583f4+_0x47fdce(0x143));return flosum_repository_sync_dto_1[_0x47fdce(0x16c)][_0x47fdce(0x157)](_0x430a6f[0x0]);}async[a238_0x5f3caa(0x13b)](_0x2a36b9){const _0x17cc5e=a238_0x5f3caa,_0xb8c436=await this[_0x17cc5e(0x137)][_0x17cc5e(0x13c)](queries_1[_0x17cc5e(0x156)][_0x17cc5e(0x139)](_0x17cc5e(0x185),_0x2a36b9));if(_0xb8c436['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x17cc5e(0x17b)+_0x2a36b9+_0x17cc5e(0x143));const _0x5f1862=_0xb8c436[_0x17cc5e(0x161)](_0x23deb0=>_0x23deb0[constants_1[_0x17cc5e(0x169)]+'Branch_Name__c']===_0x2a36b9);if(!_0x5f1862)throw new not_found_error_1[(_0x17cc5e(0x150))]('Branch\x20'+_0x2a36b9+_0x17cc5e(0x143));return flosum_repository_sync_dto_1[_0x17cc5e(0x16c)][_0x17cc5e(0x157)](_0x5f1862);}async['getRepositoryRecordByName'](_0x5dec61){const _0x4793dd=a238_0x5f3caa,_0x21df84=await this[_0x4793dd(0x137)][_0x4793dd(0x13c)](queries_1[_0x4793dd(0x17d)][_0x4793dd(0x139)](_0x4793dd(0x185),_0x5dec61));if(_0x21df84[_0x4793dd(0x180)]===0x0)throw new not_found_error_1[(_0x4793dd(0x150))](_0x4793dd(0x175)+_0x5dec61+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x4793dd(0x16c)][_0x4793dd(0x136)](_0x21df84[0x0]);}async['getComponentsFromRepository'](_0x416759){const _0xd5ec28=a238_0x5f3caa,_0x5dcd00=_0xd5ec28(0x12d)+queries_1[_0xd5ec28(0x16d)]+_0xd5ec28(0x168)+_0x416759+'\x27';return this['getComponents'](_0x5dcd00);}async['getBranchComponents'](_0x429077){const _0x5e4774=a238_0x5f3caa,_0x4f7b57=_0x5e4774(0x164)+queries_1[_0x5e4774(0x16d)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x429077+'\x27';return this['getComponents'](_0x4f7b57);}async[a238_0x5f3caa(0x179)](_0x22f7d2){const _0x39e2b8=a238_0x5f3caa;var _0x48087a;const _0x2d95a8=queries_1[_0x39e2b8(0x176)][_0x39e2b8(0x139)](_0x39e2b8(0x177),_0x22f7d2[_0x39e2b8(0x173)])[_0x39e2b8(0x139)](_0x39e2b8(0x185),_0x22f7d2[_0x39e2b8(0x15f)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x8e6bac=await this[_0x39e2b8(0x137)][_0x39e2b8(0x13c)](_0x2d95a8),_0x395238=(_0x48087a=_0x8e6bac[0x0])===null||_0x48087a===void 0x0?void 0x0:_0x48087a['Id'];if(!_0x395238)throw new Error(errors_1[_0x39e2b8(0x17f)]);return _0x395238;}async[a238_0x5f3caa(0x172)](_0x5f2b5e){const _0x2194a7=a238_0x5f3caa;let _0x4fce98=await this[_0x2194a7(0x179)](_0x5f2b5e)[_0x2194a7(0x141)](()=>null);return!_0x4fce98&&(_0x4fce98=await this[_0x2194a7(0x15b)][_0x2194a7(0x15c)](_0x2194a7(0x131),{'Body':(0x0,utils_1[_0x2194a7(0x151)])('{}'),'ParentId':_0x5f2b5e[_0x2194a7(0x173)],'ContentType':_0x2194a7(0x16b),'Name':_0x5f2b5e[_0x2194a7(0x15f)]?constants_1[_0x2194a7(0x13d)]:constants_1[_0x2194a7(0x142)]})),_0x4fce98;}async['updateRemoteState'](_0x4970da,_0x58cc37){const _0x49b47c=a238_0x5f3caa,_0x421ec7=await this[_0x49b47c(0x172)](_0x4970da);await this[_0x49b47c(0x15b)][_0x49b47c(0x17e)](_0x49b47c(0x131),_0x421ec7,{'Body':(0x0,utils_1[_0x49b47c(0x151)])(JSON[_0x49b47c(0x13a)](_0x58cc37))});}async['setStatus'](_0x4aa02b,_0x43be57){const _0x4eb1e5=a238_0x5f3caa;await this[_0x4eb1e5(0x15b)][_0x4eb1e5(0x17e)](_0x4aa02b[_0x4eb1e5(0x14d)],_0x4aa02b[_0x4eb1e5(0x173)],{[constants_1[_0x4eb1e5(0x144)]+_0x4eb1e5(0x17c)]:_0x43be57});}async['disableSync'](_0x315da5){const _0x3f2a61=a238_0x5f3caa;await this[_0x3f2a61(0x15b)][_0x3f2a61(0x17e)](constants_1[_0x3f2a61(0x144)]+_0x3f2a61(0x134),_0x315da5,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x3f2a61(0x14e)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a238_0x5f3caa(0x16f)])(),__metadata(a238_0x5f3caa(0x146),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a238_0x5f3caa(0x14f)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;