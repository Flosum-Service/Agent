const a186_0x50a5b0=a186_0x8f87;function a186_0xc42c(){const _0x28e2fd=['ERR_INVALID_ATTACHMENT_ID','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','Connection__c','FLOSUM_NAMESPACE','toString','constructor','design:paramtypes','SalesforceQueryService','SalesforceSyncService','text/plain','Service','4255816zHqQOc','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','%id%','FlosumRepositorySyncDto','objectId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','decorate','%parentId%','repositoryId','replace','Branch\x20','getOwnPropertyDescriptor','push','GET_WAITING_BRANCHES_QUERY','Components__r','(((.+)+)+)+$','disableSync','../../../../constants/errors','encodeBase64','4098942exBqTr','SYNC_ATTACHMENT_FOR_BRANCH_NAME','Attachment','getBranchRecordByName','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','__decorate','defineProperty','fromBranchRecord','GET_COMPONENTS_QUERY','\x20not\x20found\x20on\x20salesforce','length','__esModule','FLOSUM_GIT_NAMESPACE','84349evDLhk','SalesforceNotFoundError','search','GET_REPOSITORY_QUERY','28ZazFYK','fromRepositoryRecord','Repository\x20','%name%','5804733qXgLYP','../queries','metadata','getAttachmentId','createObject','../../../../constants','getComponentsFromRepository','10yKJcVl','40VbzFyY','4539017yirwBl','query','../dto/flosum-repository-sync.dto','SalesforceService','records','getComponents','object','getRepositoryRecordByName','../../../shared/utils','381474cMcBoC','getBranchRecord','10zHTYIQ','salesforceService','__metadata','map','getRemoteStateAttachmentId','salesforceQuery','GET_REPOSITORY_BY_NAME_QUERY','getBranchComponents','objectType','function','Branch\x20with\x20Id\x20','./salesforce-query.service','patchObject','apply','../errors/not-found.error','catch','10553193tpyoBf'];a186_0xc42c=function(){return _0x28e2fd;};return a186_0xc42c();}(function(_0x419aff,_0x5187cd){const _0x574b52=a186_0x8f87,_0x35f1ee=_0x419aff();while(!![]){try{const _0x4dde9f=-parseInt(_0x574b52(0x114))/0x1*(-parseInt(_0x574b52(0x118))/0x2)+parseInt(_0x574b52(0x12e))/0x3*(-parseInt(_0x574b52(0x124))/0x4)+-parseInt(_0x574b52(0x123))/0x5*(-parseInt(_0x574b52(0x107))/0x6)+parseInt(_0x574b52(0x125))/0x7+-parseInt(_0x574b52(0xf4))/0x8+-parseInt(_0x574b52(0xe8))/0x9+parseInt(_0x574b52(0x130))/0xa*(parseInt(_0x574b52(0x11c))/0xb);if(_0x4dde9f===_0x5187cd)break;else _0x35f1ee['push'](_0x35f1ee['shift']());}catch(_0x41a5ab){_0x35f1ee['push'](_0x35f1ee['shift']());}}}(a186_0xc42c,0xb66c0));const a186_0x38141e=(function(){let _0x2cefd0=!![];return function(_0x26e563,_0x4ef672){const _0x1c60ba=_0x2cefd0?function(){const _0xfc9851=a186_0x8f87;if(_0x4ef672){const _0x789bfe=_0x4ef672[_0xfc9851(0xe5)](_0x26e563,arguments);return _0x4ef672=null,_0x789bfe;}}:function(){};return _0x2cefd0=![],_0x1c60ba;};}()),a186_0x13a3b9=a186_0x38141e(this,function(){const _0x134afa=a186_0x8f87;return a186_0x13a3b9[_0x134afa(0xed)]()['search'](_0x134afa(0x103))[_0x134afa(0xed)]()[_0x134afa(0xee)](a186_0x13a3b9)[_0x134afa(0x116)](_0x134afa(0x103));});a186_0x13a3b9();function a186_0x8f87(_0x1138b3,_0x44a98c){const _0x2672a9=a186_0xc42c();return a186_0x8f87=function(_0x13a3b9,_0x38141e){_0x13a3b9=_0x13a3b9-0xdb;let _0xc42c60=_0x2672a9[_0x13a3b9];return _0xc42c60;},a186_0x8f87(_0x1138b3,_0x44a98c);}'use strict';var __decorate=this&&this[a186_0x50a5b0(0x10c)]||function(_0x6c70d9,_0x23e3b5,_0x473ddf,_0x25bace){const _0x2c19b3=a186_0x50a5b0;var _0x250d35=arguments[_0x2c19b3(0x111)],_0x203534=_0x250d35<0x3?_0x23e3b5:_0x25bace===null?_0x25bace=Object[_0x2c19b3(0xff)](_0x23e3b5,_0x473ddf):_0x25bace,_0x10ab8d;if(typeof Reflect===_0x2c19b3(0x12b)&&typeof Reflect[_0x2c19b3(0xfa)]===_0x2c19b3(0xe1))_0x203534=Reflect[_0x2c19b3(0xfa)](_0x6c70d9,_0x23e3b5,_0x473ddf,_0x25bace);else{for(var _0x1db31b=_0x6c70d9[_0x2c19b3(0x111)]-0x1;_0x1db31b>=0x0;_0x1db31b--)if(_0x10ab8d=_0x6c70d9[_0x1db31b])_0x203534=(_0x250d35<0x3?_0x10ab8d(_0x203534):_0x250d35>0x3?_0x10ab8d(_0x23e3b5,_0x473ddf,_0x203534):_0x10ab8d(_0x23e3b5,_0x473ddf))||_0x203534;}return _0x250d35>0x3&&_0x203534&&Object[_0x2c19b3(0x10d)](_0x23e3b5,_0x473ddf,_0x203534),_0x203534;},__metadata=this&&this[a186_0x50a5b0(0x132)]||function(_0x14650b,_0x2276eb){const _0x43add4=a186_0x50a5b0;if(typeof Reflect===_0x43add4(0x12b)&&typeof Reflect['metadata']===_0x43add4(0xe1))return Reflect[_0x43add4(0x11e)](_0x14650b,_0x2276eb);};Object[a186_0x50a5b0(0x10d)](exports,a186_0x50a5b0(0x112),{'value':!![]}),exports[a186_0x50a5b0(0xf1)]=void 0x0;const typedi_1=require('typedi'),constants_1=require(a186_0x50a5b0(0x121)),errors_1=require(a186_0x50a5b0(0x105)),utils_1=require(a186_0x50a5b0(0x12d)),flosum_repository_sync_dto_1=require(a186_0x50a5b0(0x127)),not_found_error_1=require(a186_0x50a5b0(0xe6)),queries_1=require(a186_0x50a5b0(0x11d)),salesforce_query_service_1=require(a186_0x50a5b0(0xe3)),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0x64746d,_0x1af3ab){const _0xf6f385=a186_0x50a5b0;this[_0xf6f385(0xdd)]=_0x64746d,this[_0xf6f385(0x131)]=_0x1af3ab;}async[a186_0x50a5b0(0x12a)](_0x100cc6){const _0x1ec814=a186_0x50a5b0;var _0x5acb3e;const _0x3a6059=await this[_0x1ec814(0xdd)][_0x1ec814(0x126)](_0x100cc6),_0x4ae9d8=[];for(const _0xa57510 of _0x3a6059){const _0x1a3e6f=(_0x5acb3e=_0xa57510[constants_1[_0x1ec814(0xec)]+_0x1ec814(0x102)])===null||_0x5acb3e===void 0x0?void 0x0:_0x5acb3e[_0x1ec814(0x129)];_0x1a3e6f&&_0x1a3e6f['length']&&_0x4ae9d8[_0x1ec814(0x100)](_0x1a3e6f[0x0]['Id']);}return _0x4ae9d8;}async['getRepositoryRecords'](_0x157b26){const _0x1404d6=a186_0x50a5b0,_0x4aa98c=await this[_0x1404d6(0xdd)]['query'](queries_1['GET_WAITING_REPOSITORIES_QUERY'][_0x1404d6(0xfd)](/\%connection_id\%/g,_0x157b26));return _0x4aa98c[_0x1404d6(0xdb)](_0x2e4284=>flosum_repository_sync_dto_1[_0x1404d6(0xf7)][_0x1404d6(0x119)](_0x2e4284));}async['getBranchRecords'](_0x3fd28c){const _0xef7d53=a186_0x50a5b0,_0x51f17e=await this['salesforceQuery']['query'](queries_1[_0xef7d53(0x101)][_0xef7d53(0xfd)](/%repositories_ids\%/g,_0x3fd28c));return _0x51f17e[_0xef7d53(0xdb)](_0x1618f6=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0xef7d53(0x10e)](_0x1618f6));}async['getRepositoryRecord'](_0xae494b){const _0x282d32=a186_0x50a5b0,_0x5833a8=await this['salesforceQuery']['query'](queries_1[_0x282d32(0x117)][_0x282d32(0xfd)](_0x282d32(0xf6),_0xae494b));if(_0x5833a8[_0x282d32(0x111)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20with\x20Id\x20'+_0xae494b+_0x282d32(0x110));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x282d32(0x119)](_0x5833a8[0x0]);}async[a186_0x50a5b0(0x12f)](_0x4d6bf3){const _0x524d40=a186_0x50a5b0,_0x1979f2=await this[_0x524d40(0xdd)]['query'](queries_1['GET_BRANCH_QUERY'][_0x524d40(0xfd)]('%id%',_0x4d6bf3));if(_0x1979f2[_0x524d40(0x111)]===0x0)throw new not_found_error_1[(_0x524d40(0x115))](_0x524d40(0xe2)+_0x4d6bf3+_0x524d40(0x110));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x524d40(0x10e)](_0x1979f2[0x0]);}async[a186_0x50a5b0(0x10a)](_0x3a52ae){const _0x23d07a=a186_0x50a5b0,_0x11e93d=await this['salesforceQuery'][_0x23d07a(0x126)](queries_1['GET_BRANCH_BY_NAME_QUERY'][_0x23d07a(0xfd)](_0x23d07a(0x11b),_0x3a52ae));if(_0x11e93d[_0x23d07a(0x111)]===0x0)throw new not_found_error_1[(_0x23d07a(0x115))](_0x23d07a(0xfe)+_0x3a52ae+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x23d07a(0xf7)][_0x23d07a(0x10e)](_0x11e93d[0x0]);}async[a186_0x50a5b0(0x12c)](_0x5ad315){const _0x17a043=a186_0x50a5b0,_0xcb89cc=await this[_0x17a043(0xdd)]['query'](queries_1[_0x17a043(0xde)][_0x17a043(0xfd)](_0x17a043(0x11b),_0x5ad315));if(_0xcb89cc[_0x17a043(0x111)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x17a043(0x11a)+_0x5ad315+_0x17a043(0x110));return flosum_repository_sync_dto_1[_0x17a043(0xf7)][_0x17a043(0x119)](_0xcb89cc[0x0]);}async[a186_0x50a5b0(0x122)](_0x236a7d){const _0x1e05b3=a186_0x50a5b0,_0x38d4ee='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x1e05b3(0x10f)]+_0x1e05b3(0x10b)+_0x236a7d+'\x27';return this[_0x1e05b3(0x12a)](_0x38d4ee);}async[a186_0x50a5b0(0xdf)](_0x2ae46a){const _0x178101=a186_0x50a5b0,_0x5a7bc7='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1['GET_COMPONENTS_QUERY']+_0x178101(0xf9)+_0x2ae46a+'\x27';return this['getComponents'](_0x5a7bc7);}async[a186_0x50a5b0(0x11f)](_0x38641e){const _0x2830a8=a186_0x50a5b0;var _0x4d90f5;const _0x9279c8=queries_1[_0x2830a8(0xea)]['replace'](_0x2830a8(0xfb),_0x38641e[_0x2830a8(0xf8)])[_0x2830a8(0xfd)](_0x2830a8(0x11b),_0x38641e[_0x2830a8(0xfc)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x2830a8(0x108)]),_0x54b81b=await this[_0x2830a8(0xdd)][_0x2830a8(0x126)](_0x9279c8),_0x18aec1=(_0x4d90f5=_0x54b81b[0x0])===null||_0x4d90f5===void 0x0?void 0x0:_0x4d90f5['Id'];if(!_0x18aec1)throw new Error(errors_1[_0x2830a8(0xe9)]);return _0x18aec1;}async[a186_0x50a5b0(0xdc)](_0x209554){const _0xff2787=a186_0x50a5b0;let _0x1d629f=await this[_0xff2787(0x11f)](_0x209554)[_0xff2787(0xe7)](()=>null);return!_0x1d629f&&(_0x1d629f=await this['salesforceService'][_0xff2787(0x120)](_0xff2787(0x109),{'Body':utils_1[_0xff2787(0x106)]('{}'),'ParentId':_0x209554[_0xff2787(0xf8)],'ContentType':_0xff2787(0xf2),'Name':_0x209554[_0xff2787(0xfc)]?constants_1[_0xff2787(0xf5)]:constants_1[_0xff2787(0x108)]})),_0x1d629f;}async['updateRemoteState'](_0x3f5349,_0x1496a5){const _0x4c3aba=a186_0x50a5b0,_0x2efe26=await this['getRemoteStateAttachmentId'](_0x3f5349);await this[_0x4c3aba(0x131)][_0x4c3aba(0xe4)](_0x4c3aba(0x109),_0x2efe26,{'Body':utils_1[_0x4c3aba(0x106)](JSON['stringify'](_0x1496a5))});}async['setStatus'](_0x3f5564,_0x249abc){const _0x45cae6=a186_0x50a5b0;await this['salesforceService']['patchObject'](_0x3f5564[_0x45cae6(0xe0)],_0x3f5564[_0x45cae6(0xf8)],{[constants_1['FLOSUM_GIT_NAMESPACE']+'Synchronization_Status__c']:_0x249abc});}async[a186_0x50a5b0(0x104)](_0x2a991f){const _0xd7f07=a186_0x50a5b0;await this[_0xd7f07(0x131)]['patchObject'](constants_1['FLOSUM_GIT_NAMESPACE']+_0xd7f07(0xeb),_0x2a991f,{[constants_1[_0xd7f07(0x113)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([typedi_1[a186_0x50a5b0(0xf3)](),__metadata(a186_0x50a5b0(0xef),[salesforce_query_service_1[a186_0x50a5b0(0xf0)],salesforce_service_1[a186_0x50a5b0(0x128)]])],SalesforceSyncService),exports[a186_0x50a5b0(0xf1)]=SalesforceSyncService;