const a243_0x2b04a7=a243_0x290e;(function(_0x1430f6,_0x2387ac){const _0x121822=a243_0x290e,_0x3a098a=_0x1430f6();while(!![]){try{const _0x1f0224=parseInt(_0x121822(0x212))/0x1*(-parseInt(_0x121822(0x1dd))/0x2)+-parseInt(_0x121822(0x1e2))/0x3+parseInt(_0x121822(0x227))/0x4*(parseInt(_0x121822(0x225))/0x5)+-parseInt(_0x121822(0x21c))/0x6*(-parseInt(_0x121822(0x1f4))/0x7)+-parseInt(_0x121822(0x1df))/0x8+-parseInt(_0x121822(0x1f8))/0x9*(parseInt(_0x121822(0x1e4))/0xa)+parseInt(_0x121822(0x22a))/0xb;if(_0x1f0224===_0x2387ac)break;else _0x3a098a['push'](_0x3a098a['shift']());}catch(_0x20235c){_0x3a098a['push'](_0x3a098a['shift']());}}}(a243_0x3116,0xd5bab));const a243_0x1a801b=(function(){let _0x21858d=!![];return function(_0x1ab2b2,_0x263a16){const _0x3cf839=_0x21858d?function(){const _0x3db898=a243_0x290e;if(_0x263a16){const _0x2e81f6=_0x263a16[_0x3db898(0x1d9)](_0x1ab2b2,arguments);return _0x263a16=null,_0x2e81f6;}}:function(){};return _0x21858d=![],_0x3cf839;};}()),a243_0xd65167=a243_0x1a801b(this,function(){const _0x4789f2=a243_0x290e;return a243_0xd65167[_0x4789f2(0x20b)]()[_0x4789f2(0x219)](_0x4789f2(0x1d7))[_0x4789f2(0x20b)]()[_0x4789f2(0x1ed)](a243_0xd65167)['search'](_0x4789f2(0x1d7));});a243_0xd65167();'use strict';var __decorate=this&&this['__decorate']||function(_0x277557,_0x32f55f,_0x201cfa,_0x18f059){const _0xec2cfb=a243_0x290e;var _0x55d62f=arguments['length'],_0x4e205c=_0x55d62f<0x3?_0x32f55f:_0x18f059===null?_0x18f059=Object[_0xec2cfb(0x204)](_0x32f55f,_0x201cfa):_0x18f059,_0x2274b0;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x4e205c=Reflect[_0xec2cfb(0x216)](_0x277557,_0x32f55f,_0x201cfa,_0x18f059);else{for(var _0x9a251a=_0x277557['length']-0x1;_0x9a251a>=0x0;_0x9a251a--)if(_0x2274b0=_0x277557[_0x9a251a])_0x4e205c=(_0x55d62f<0x3?_0x2274b0(_0x4e205c):_0x55d62f>0x3?_0x2274b0(_0x32f55f,_0x201cfa,_0x4e205c):_0x2274b0(_0x32f55f,_0x201cfa))||_0x4e205c;}return _0x55d62f>0x3&&_0x4e205c&&Object['defineProperty'](_0x32f55f,_0x201cfa,_0x4e205c),_0x4e205c;},__metadata=this&&this[a243_0x2b04a7(0x1d8)]||function(_0x5ae1dd,_0x7c799a){const _0x4d5769=a243_0x2b04a7;if(typeof Reflect===_0x4d5769(0x1fe)&&typeof Reflect['metadata']===_0x4d5769(0x1d2))return Reflect['metadata'](_0x5ae1dd,_0x7c799a);};Object[a243_0x2b04a7(0x206)](exports,a243_0x2b04a7(0x202),{'value':!![]}),exports[a243_0x2b04a7(0x1f5)]=void 0x0;const typedi_1=require('typedi'),constants_1=require(a243_0x2b04a7(0x217)),errors_1=require(a243_0x2b04a7(0x218)),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a243_0x2b04a7(0x1d1)),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a243_0x2b04a7(0x1e5)),salesforce_query_service_1=require(a243_0x2b04a7(0x209)),salesforce_service_1=require('./salesforce.service');function a243_0x290e(_0x4791b0,_0x129ab1){const _0x638b7e=a243_0x3116();return a243_0x290e=function(_0xd65167,_0x1a801b){_0xd65167=_0xd65167-0x1d1;let _0x311632=_0x638b7e[_0xd65167];return _0x311632;},a243_0x290e(_0x4791b0,_0x129ab1);}function a243_0x3116(){const _0x53130a=['6mQYwbr','FLOSUM_GIT_NAMESPACE','7511912dYeyIK','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','getRepositoryRecord','2973813wIsBDP','Sync_In_Progress__c','4833260Saobak','../queries','\x20not\x20found\x20on\x20salesforce','getBranchRecord','Branch\x20with\x20Id\x20','getBranchRecords','map','replace','GET_REPOSITORY_QUERY','constructor','fromRepositoryRecord','Service','%parentId%','find','FLOSUM_NAMESPACE','Attachment','9474997xSJddB','SalesforceSyncService','stringify','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','27iJeWxD','Connection__c','getComponents','encodeBase64','getBranchComponents','Repository\x20with\x20Id\x20','object','fromBranchRecord','SalesforceQueryService','Branch\x20','__esModule','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getOwnPropertyDescriptor','SalesforceNotFoundError','defineProperty','GET_COMPONENTS_QUERY','push','./salesforce-query.service','SYNC_ATTACHMENT_FOR_BRANCH_NAME','toString','Repository\x20','Name','records','SalesforceService','getBranchRecordByName','GET_REPOSITORY_BY_NAME_QUERY','256565GWvKwF','design:paramtypes','length','getRemoteStateAttachmentId','decorate','../../../../constants','../../../../constants/errors','search','getAllRepositoryNames','GET_WAITING_REPOSITORIES_QUERY','6dWfpmQ','Components__r','getRepositoryRecordByName','repositoryId','FlosumRepositorySyncDto','text/plain','getRepositoryRecords','ERR_INVALID_ATTACHMENT_ID','GET_REPOSITORIES_NAMES_QUERY','12110oztgRe','objectId','616bSgxWL','%id%','%name%','36286899TDLWJz','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','GET_WAITING_BRANCHES_QUERY','../dto/flosum-repository-sync.dto','function','salesforceService','patchObject','query','salesforceQuery','(((.+)+)+)+$','__metadata','apply','Repository__r','disableSync','getAttachmentId'];a243_0x3116=function(){return _0x53130a;};return a243_0x3116();}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x50b92e,_0x47e783){const _0xc33fee=a243_0x2b04a7;this[_0xc33fee(0x1d6)]=_0x50b92e,this[_0xc33fee(0x1d3)]=_0x47e783;}async[a243_0x2b04a7(0x1fa)](_0x59986c){const _0xd9e8bc=a243_0x2b04a7;var _0x2f0e69;const _0x4cb6e2=await this['salesforceQuery']['query'](_0x59986c),_0x248f8e=[];for(const _0x199364 of _0x4cb6e2){const _0x55c24f=(_0x2f0e69=_0x199364[constants_1[_0xd9e8bc(0x1f2)]+_0xd9e8bc(0x21d)])===null||_0x2f0e69===void 0x0?void 0x0:_0x2f0e69[_0xd9e8bc(0x20e)];_0x55c24f&&_0x55c24f[_0xd9e8bc(0x214)]&&_0x248f8e[_0xd9e8bc(0x208)](_0x55c24f[0x0]['Id']);}return _0x248f8e;}async[a243_0x2b04a7(0x21a)](_0xc64854){const _0x45dda7=a243_0x2b04a7,_0x3a65bd=await this[_0x45dda7(0x1d6)]['query'](queries_1[_0x45dda7(0x224)]['replace'](/\%connection_id\%/g,_0xc64854));return _0x3a65bd[_0x45dda7(0x1ea)](_0x599bc7=>{const _0x3f82e1=_0x45dda7;return _0x599bc7[constants_1[_0x3f82e1(0x1de)]+'Repository__r']?_0x599bc7[constants_1[_0x3f82e1(0x1de)]+_0x3f82e1(0x1da)]['Name']:_0x599bc7[_0x3f82e1(0x20d)];});}async[a243_0x2b04a7(0x222)](_0x395822){const _0x39a0fa=a243_0x2b04a7,_0x5d2d0e=await this['salesforceQuery'][_0x39a0fa(0x1d5)](queries_1[_0x39a0fa(0x21b)][_0x39a0fa(0x1eb)](/\%connection_id\%/g,_0x395822));return _0x5d2d0e['map'](_0x2d51ad=>flosum_repository_sync_dto_1[_0x39a0fa(0x220)][_0x39a0fa(0x1ee)](_0x2d51ad));}async[a243_0x2b04a7(0x1e9)](_0x420482){const _0x4a79ca=a243_0x2b04a7,_0x3d2a6c=await this[_0x4a79ca(0x1d6)][_0x4a79ca(0x1d5)](queries_1[_0x4a79ca(0x22c)][_0x4a79ca(0x1eb)](/%repositories_ids\%/g,_0x420482));return _0x3d2a6c[_0x4a79ca(0x1ea)](_0x5daff2=>flosum_repository_sync_dto_1[_0x4a79ca(0x220)]['fromBranchRecord'](_0x5daff2));}async[a243_0x2b04a7(0x1e1)](_0x56ebee){const _0x549af0=a243_0x2b04a7,_0x1f0584=await this[_0x549af0(0x1d6)][_0x549af0(0x1d5)](queries_1[_0x549af0(0x1ec)][_0x549af0(0x1eb)]('%id%',_0x56ebee));if(_0x1f0584[_0x549af0(0x214)]===0x0)throw new not_found_error_1[(_0x549af0(0x205))](_0x549af0(0x1fd)+_0x56ebee+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x549af0(0x220)]['fromRepositoryRecord'](_0x1f0584[0x0]);}async[a243_0x2b04a7(0x1e7)](_0x444d18){const _0x5928a7=a243_0x2b04a7,_0x4b525c=await this[_0x5928a7(0x1d6)]['query'](queries_1['GET_BRANCH_QUERY'][_0x5928a7(0x1eb)](_0x5928a7(0x228),_0x444d18));if(_0x4b525c[_0x5928a7(0x214)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x5928a7(0x1e8)+_0x444d18+_0x5928a7(0x1e6));return flosum_repository_sync_dto_1[_0x5928a7(0x220)]['fromBranchRecord'](_0x4b525c[0x0]);}async[a243_0x2b04a7(0x210)](_0x407cf4){const _0x1e7610=a243_0x2b04a7,_0x796dac=await this[_0x1e7610(0x1d6)][_0x1e7610(0x1d5)](queries_1['GET_BRANCH_BY_NAME_QUERY'][_0x1e7610(0x1eb)](_0x1e7610(0x229),_0x407cf4));if(_0x796dac[_0x1e7610(0x214)]===0x0)throw new not_found_error_1[(_0x1e7610(0x205))](_0x1e7610(0x201)+_0x407cf4+_0x1e7610(0x1e6));const _0x4c1ac0=_0x796dac[_0x1e7610(0x1f1)](_0x500187=>_0x500187[constants_1[_0x1e7610(0x1f2)]+'Branch_Name__c']===_0x407cf4);if(!_0x4c1ac0)throw new not_found_error_1[(_0x1e7610(0x205))](_0x1e7610(0x201)+_0x407cf4+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x1e7610(0x220)][_0x1e7610(0x1ff)](_0x4c1ac0);}async[a243_0x2b04a7(0x21e)](_0x25959b){const _0x516841=a243_0x2b04a7,_0x1288f4=await this[_0x516841(0x1d6)][_0x516841(0x1d5)](queries_1[_0x516841(0x211)]['replace'](_0x516841(0x229),_0x25959b));if(_0x1288f4[_0x516841(0x214)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x516841(0x20c)+_0x25959b+_0x516841(0x1e6));return flosum_repository_sync_dto_1[_0x516841(0x220)][_0x516841(0x1ee)](_0x1288f4[0x0]);}async['getComponentsFromRepository'](_0x3515a6){const _0x281931=a243_0x2b04a7,_0x2b8bca='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x281931(0x207)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x3515a6+'\x27';return this['getComponents'](_0x2b8bca);}async[a243_0x2b04a7(0x1fc)](_0x1389ac){const _0x31bf53=a243_0x2b04a7,_0x35a898=_0x31bf53(0x203)+queries_1['GET_COMPONENTS_QUERY']+_0x31bf53(0x1f7)+_0x1389ac+'\x27';return this[_0x31bf53(0x1fa)](_0x35a898);}async[a243_0x2b04a7(0x1dc)](_0xe663cc){const _0x18398f=a243_0x2b04a7;var _0x4f8fc6;const _0x4211d6=queries_1[_0x18398f(0x22b)]['replace'](_0x18398f(0x1f0),_0xe663cc[_0x18398f(0x226)])['replace'](_0x18398f(0x229),_0xe663cc[_0x18398f(0x21f)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x18398f(0x20a)]),_0x2ac6b0=await this[_0x18398f(0x1d6)][_0x18398f(0x1d5)](_0x4211d6),_0x46ead9=(_0x4f8fc6=_0x2ac6b0[0x0])===null||_0x4f8fc6===void 0x0?void 0x0:_0x4f8fc6['Id'];if(!_0x46ead9)throw new Error(errors_1[_0x18398f(0x223)]);return _0x46ead9;}async[a243_0x2b04a7(0x215)](_0x44087a){const _0x9b77e4=a243_0x2b04a7;let _0x5f3e6b=await this[_0x9b77e4(0x1dc)](_0x44087a)['catch'](()=>null);return!_0x5f3e6b&&(_0x5f3e6b=await this[_0x9b77e4(0x1d3)]['createObject'](_0x9b77e4(0x1f3),{'Body':(0x0,utils_1[_0x9b77e4(0x1fb)])('{}'),'ParentId':_0x44087a[_0x9b77e4(0x226)],'ContentType':_0x9b77e4(0x221),'Name':_0x44087a[_0x9b77e4(0x21f)]?constants_1[_0x9b77e4(0x1e0)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x5f3e6b;}async['updateRemoteState'](_0x4a90db,_0x35941e){const _0x12ce36=a243_0x2b04a7,_0x161404=await this['getRemoteStateAttachmentId'](_0x4a90db);await this[_0x12ce36(0x1d3)][_0x12ce36(0x1d4)](_0x12ce36(0x1f3),_0x161404,{'Body':(0x0,utils_1[_0x12ce36(0x1fb)])(JSON[_0x12ce36(0x1f6)](_0x35941e))});}async['setStatus'](_0xbe8f29,_0x55a08d){const _0x226619=a243_0x2b04a7;await this[_0x226619(0x1d3)][_0x226619(0x1d4)](_0xbe8f29['objectType'],_0xbe8f29[_0x226619(0x226)],{[constants_1[_0x226619(0x1de)]+'Synchronization_Status__c']:_0x55a08d});}async[a243_0x2b04a7(0x1db)](_0x25c766){const _0x344926=a243_0x2b04a7;await this[_0x344926(0x1d3)][_0x344926(0x1d4)](constants_1[_0x344926(0x1de)]+_0x344926(0x1f9),_0x25c766,{[constants_1[_0x344926(0x1de)]+_0x344926(0x1e3)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a243_0x2b04a7(0x1ef)])(),__metadata(a243_0x2b04a7(0x213),[salesforce_query_service_1[a243_0x2b04a7(0x200)],salesforce_service_1[a243_0x2b04a7(0x20f)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;