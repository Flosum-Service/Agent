const a270_0x41d022=a270_0xbc00;(function(_0x116e05,_0x482399){const _0x174e4f=a270_0xbc00,_0x314618=_0x116e05();while(!![]){try{const _0x3f05aa=-parseInt(_0x174e4f(0x118))/0x1*(parseInt(_0x174e4f(0x10f))/0x2)+-parseInt(_0x174e4f(0xfb))/0x3*(-parseInt(_0x174e4f(0x106))/0x4)+-parseInt(_0x174e4f(0x11e))/0x5*(parseInt(_0x174e4f(0x114))/0x6)+parseInt(_0x174e4f(0x132))/0x7+-parseInt(_0x174e4f(0x12b))/0x8+-parseInt(_0x174e4f(0xe4))/0x9+parseInt(_0x174e4f(0xf9))/0xa;if(_0x3f05aa===_0x482399)break;else _0x314618['push'](_0x314618['shift']());}catch(_0x1f1ef4){_0x314618['push'](_0x314618['shift']());}}}(a270_0x351f,0x630b1));function a270_0xbc00(_0x30f957,_0x28b3c8){const _0x27612d=a270_0x351f();return a270_0xbc00=function(_0x45043e,_0x4b6ade){_0x45043e=_0x45043e-0xe2;let _0x351f5b=_0x27612d[_0x45043e];return _0x351f5b;},a270_0xbc00(_0x30f957,_0x28b3c8);}const a270_0x4b6ade=(function(){let _0xbe7988=!![];return function(_0x53f949,_0x2ca429){const _0x172037=_0xbe7988?function(){if(_0x2ca429){const _0x3e1d41=_0x2ca429['apply'](_0x53f949,arguments);return _0x2ca429=null,_0x3e1d41;}}:function(){};return _0xbe7988=![],_0x172037;};}()),a270_0x45043e=a270_0x4b6ade(this,function(){const _0x3905c2=a270_0xbc00;return a270_0x45043e[_0x3905c2(0x110)]()[_0x3905c2(0x135)]('(((.+)+)+)+$')[_0x3905c2(0x110)]()[_0x3905c2(0xff)](a270_0x45043e)[_0x3905c2(0x135)](_0x3905c2(0xfa));});a270_0x45043e();function a270_0x351f(){const _0x26d187=['constructor','updateRemoteState','Name','design:paramtypes','getRemoteStateAttachmentId','disableSync','GET_COMPONENTS_QUERY','272RSZUqw','Repository\x20','getBranchRecordByName','Branch\x20','__metadata','getComponentsFromRepository','SalesforceQueryService','getComponents','length','10jILMYs','toString','SalesforceNotFoundError','query','objectId','14676UIdnpB','../../../../constants','GET_BRANCH_QUERY','object','45391dXZrOg','GET_REPOSITORY_BY_NAME_QUERY','\x20not\x20found\x20on\x20salesforce','salesforceQuery','../errors/not-found.error','Branch_Name__c','220cSbSrG','GET_REPOSITORIES_NAMES_QUERY','objectType','Connection__c','repositoryId','Components__r','__decorate','SalesforceService','Branch\x20with\x20Id\x20','%parentId%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','typedi','getAllRepositoryNames','372800glVofv','./salesforce-query.service','../../../../constants/errors','fromRepositoryRecord','FlosumRepositorySyncDto','SalesforceSyncService','../dto/flosum-repository-sync.dto','2615109fyNvVJ','Repository\x20with\x20Id\x20','Attachment','search','Service','%id%','SYNC_ATTACHMENT_FOR_BRANCH_NAME','find','patchObject','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','\x0a\x20\x20\x20\x20\x20\x20','fromBranchRecord','731664caiDKO','getRepositoryRecords','stringify','defineProperty','FLOSUM_GIT_NAMESPACE','function','map','FLOSUM_NAMESPACE','Sync_In_Progress__c','metadata','GET_REPOSITORY_QUERY','getBranchRecord','encodeBase64','salesforceService','getOwnPropertyDescriptor','%name%','createObject','replace','records','getBranchComponents','Repository__r','3102890fEsbBm','(((.+)+)+)+$','8130LiclEz','decorate','getRepositoryRecordByName','GET_WAITING_BRANCHES_QUERY'];a270_0x351f=function(){return _0x26d187;};return a270_0x351f();}'use strict';var __decorate=this&&this[a270_0x41d022(0x124)]||function(_0x5e79ea,_0x3ba1c3,_0x436388,_0x37396e){const _0x60329c=a270_0x41d022;var _0x29c699=arguments[_0x60329c(0x10e)],_0x383bb3=_0x29c699<0x3?_0x3ba1c3:_0x37396e===null?_0x37396e=Object[_0x60329c(0xf2)](_0x3ba1c3,_0x436388):_0x37396e,_0x2cea58;if(typeof Reflect===_0x60329c(0x117)&&typeof Reflect['decorate']===_0x60329c(0xe9))_0x383bb3=Reflect[_0x60329c(0xfc)](_0x5e79ea,_0x3ba1c3,_0x436388,_0x37396e);else{for(var _0x16621d=_0x5e79ea[_0x60329c(0x10e)]-0x1;_0x16621d>=0x0;_0x16621d--)if(_0x2cea58=_0x5e79ea[_0x16621d])_0x383bb3=(_0x29c699<0x3?_0x2cea58(_0x383bb3):_0x29c699>0x3?_0x2cea58(_0x3ba1c3,_0x436388,_0x383bb3):_0x2cea58(_0x3ba1c3,_0x436388))||_0x383bb3;}return _0x29c699>0x3&&_0x383bb3&&Object[_0x60329c(0xe7)](_0x3ba1c3,_0x436388,_0x383bb3),_0x383bb3;},__metadata=this&&this[a270_0x41d022(0x10a)]||function(_0x5cc7c8,_0x2273c2){const _0x1ac695=a270_0x41d022;if(typeof Reflect==='object'&&typeof Reflect[_0x1ac695(0xed)]===_0x1ac695(0xe9))return Reflect[_0x1ac695(0xed)](_0x5cc7c8,_0x2273c2);};Object[a270_0x41d022(0xe7)](exports,'__esModule',{'value':!![]}),exports[a270_0x41d022(0x130)]=void 0x0;const typedi_1=require(a270_0x41d022(0x129)),constants_1=require(a270_0x41d022(0x115)),errors_1=require(a270_0x41d022(0x12d)),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a270_0x41d022(0x131)),not_found_error_1=require(a270_0x41d022(0x11c)),queries_1=require('../queries'),salesforce_query_service_1=require(a270_0x41d022(0x12c)),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0xb77643,_0x48884e){const _0x47c332=a270_0x41d022;this['salesforceQuery']=_0xb77643,this[_0x47c332(0xf1)]=_0x48884e;}async['getComponents'](_0x2837c1){const _0x2bf75e=a270_0x41d022;var _0x57655f;const _0x97a3c1=await this[_0x2bf75e(0x11b)]['query'](_0x2837c1),_0x5ba2d8=[];for(const _0x47499e of _0x97a3c1){const _0x3a06eb=(_0x57655f=_0x47499e[constants_1[_0x2bf75e(0xeb)]+_0x2bf75e(0x123)])===null||_0x57655f===void 0x0?void 0x0:_0x57655f[_0x2bf75e(0xf6)];_0x3a06eb&&_0x3a06eb['length']&&_0x5ba2d8['push'](_0x3a06eb[0x0]['Id']);}return _0x5ba2d8;}async[a270_0x41d022(0x12a)](_0x56a16a){const _0x3f4a5e=a270_0x41d022,_0x3eff3b=await this[_0x3f4a5e(0x11b)][_0x3f4a5e(0x112)](queries_1[_0x3f4a5e(0x11f)][_0x3f4a5e(0xf5)](/\%connection_id\%/g,_0x56a16a));return _0x3eff3b[_0x3f4a5e(0xea)](_0x4d7518=>{const _0x4b25eb=_0x3f4a5e;return _0x4d7518[constants_1[_0x4b25eb(0xe8)]+_0x4b25eb(0xf8)]?_0x4d7518[constants_1[_0x4b25eb(0xe8)]+'Repository__r'][_0x4b25eb(0x101)]:_0x4d7518[_0x4b25eb(0x101)];});}async[a270_0x41d022(0xe5)](_0x49a677){const _0x12bb19=a270_0x41d022,_0xe08152=await this[_0x12bb19(0x11b)]['query'](queries_1['GET_WAITING_REPOSITORIES_QUERY'][_0x12bb19(0xf5)](/\%connection_id\%/g,_0x49a677));return _0xe08152[_0x12bb19(0xea)](_0x47ad84=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x47ad84));}async['getBranchRecords'](_0xdd6afa){const _0x71966b=a270_0x41d022,_0x2dc666=await this[_0x71966b(0x11b)][_0x71966b(0x112)](queries_1[_0x71966b(0xfe)][_0x71966b(0xf5)](/%repositories_ids\%/g,_0xdd6afa));return _0x2dc666[_0x71966b(0xea)](_0xb3a63a=>flosum_repository_sync_dto_1[_0x71966b(0x12f)][_0x71966b(0xe3)](_0xb3a63a));}async['getRepositoryRecord'](_0x126361){const _0x4cb197=a270_0x41d022,_0x458e42=await this[_0x4cb197(0x11b)][_0x4cb197(0x112)](queries_1[_0x4cb197(0xee)]['replace'](_0x4cb197(0x137),_0x126361));if(_0x458e42[_0x4cb197(0x10e)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x4cb197(0x133)+_0x126361+_0x4cb197(0x11a));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x4cb197(0x12e)](_0x458e42[0x0]);}async[a270_0x41d022(0xef)](_0x4d1a45){const _0x314f28=a270_0x41d022,_0x256d55=await this[_0x314f28(0x11b)][_0x314f28(0x112)](queries_1[_0x314f28(0x116)][_0x314f28(0xf5)]('%id%',_0x4d1a45));if(_0x256d55['length']===0x0)throw new not_found_error_1[(_0x314f28(0x111))](_0x314f28(0x126)+_0x4d1a45+_0x314f28(0x11a));return flosum_repository_sync_dto_1[_0x314f28(0x12f)]['fromBranchRecord'](_0x256d55[0x0]);}async[a270_0x41d022(0x108)](_0x2c4a60){const _0x3ab88e=a270_0x41d022,_0x2c9863=await this[_0x3ab88e(0x11b)][_0x3ab88e(0x112)](queries_1['GET_BRANCH_BY_NAME_QUERY'][_0x3ab88e(0xf5)](_0x3ab88e(0xf3),_0x2c4a60));if(_0x2c9863[_0x3ab88e(0x10e)]===0x0)throw new not_found_error_1[(_0x3ab88e(0x111))](_0x3ab88e(0x109)+_0x2c4a60+_0x3ab88e(0x11a));const _0x254295=_0x2c9863[_0x3ab88e(0x139)](_0x511da3=>_0x511da3[constants_1[_0x3ab88e(0xeb)]+_0x3ab88e(0x11d)]===_0x2c4a60);if(!_0x254295)throw new not_found_error_1[(_0x3ab88e(0x111))](_0x3ab88e(0x109)+_0x2c4a60+_0x3ab88e(0x11a));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x3ab88e(0xe3)](_0x254295);}async[a270_0x41d022(0xfd)](_0x4c35ed){const _0x4c29ca=a270_0x41d022,_0x524881=await this[_0x4c29ca(0x11b)][_0x4c29ca(0x112)](queries_1[_0x4c29ca(0x119)][_0x4c29ca(0xf5)]('%name%',_0x4c35ed));if(_0x524881['length']===0x0)throw new not_found_error_1[(_0x4c29ca(0x111))](_0x4c29ca(0x107)+_0x4c35ed+_0x4c29ca(0x11a));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x4c29ca(0x12e)](_0x524881[0x0]);}async[a270_0x41d022(0x10b)](_0x44385a){const _0x21b80e=a270_0x41d022,_0x28baec=_0x21b80e(0xe2)+queries_1[_0x21b80e(0x105)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x44385a+'\x27';return this[_0x21b80e(0x10d)](_0x28baec);}async[a270_0x41d022(0xf7)](_0x3ad32a){const _0x133727=a270_0x41d022,_0x838274=_0x133727(0x128)+queries_1['GET_COMPONENTS_QUERY']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x3ad32a+'\x27';return this[_0x133727(0x10d)](_0x838274);}async['getAttachmentId'](_0x387fa9){const _0x17bc6c=a270_0x41d022;var _0x4bd857;const _0x3b1027=queries_1[_0x17bc6c(0x13b)][_0x17bc6c(0xf5)](_0x17bc6c(0x127),_0x387fa9[_0x17bc6c(0x113)])[_0x17bc6c(0xf5)](_0x17bc6c(0xf3),_0x387fa9[_0x17bc6c(0x122)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x17bc6c(0x138)]),_0x5ce74f=await this[_0x17bc6c(0x11b)][_0x17bc6c(0x112)](_0x3b1027),_0x423ac6=(_0x4bd857=_0x5ce74f[0x0])===null||_0x4bd857===void 0x0?void 0x0:_0x4bd857['Id'];if(!_0x423ac6)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x423ac6;}async[a270_0x41d022(0x103)](_0x23e74d){const _0x364f4e=a270_0x41d022;let _0x4c6ebf=await this['getAttachmentId'](_0x23e74d)['catch'](()=>null);return!_0x4c6ebf&&(_0x4c6ebf=await this[_0x364f4e(0xf1)][_0x364f4e(0xf4)](_0x364f4e(0x134),{'Body':(0x0,utils_1[_0x364f4e(0xf0)])('{}'),'ParentId':_0x23e74d['objectId'],'ContentType':'text/plain','Name':_0x23e74d[_0x364f4e(0x122)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x364f4e(0x138)]})),_0x4c6ebf;}async[a270_0x41d022(0x100)](_0x134984,_0x41ac2c){const _0x144887=a270_0x41d022,_0x34a0a8=await this[_0x144887(0x103)](_0x134984);await this['salesforceService'][_0x144887(0x13a)](_0x144887(0x134),_0x34a0a8,{'Body':(0x0,utils_1[_0x144887(0xf0)])(JSON[_0x144887(0xe6)](_0x41ac2c))});}async['setStatus'](_0x305b4a,_0x38c635){const _0x140f0e=a270_0x41d022;await this[_0x140f0e(0xf1)][_0x140f0e(0x13a)](_0x305b4a[_0x140f0e(0x120)],_0x305b4a['objectId'],{[constants_1[_0x140f0e(0xe8)]+'Synchronization_Status__c']:_0x38c635});}async[a270_0x41d022(0x104)](_0xa369c1){const _0x1841ce=a270_0x41d022;await this['salesforceService'][_0x1841ce(0x13a)](constants_1[_0x1841ce(0xe8)]+_0x1841ce(0x121),_0xa369c1,{[constants_1[_0x1841ce(0xe8)]+_0x1841ce(0xec)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a270_0x41d022(0x136)])(),__metadata(a270_0x41d022(0x102),[salesforce_query_service_1[a270_0x41d022(0x10c)],salesforce_service_1[a270_0x41d022(0x125)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;