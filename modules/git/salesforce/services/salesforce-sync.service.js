const a243_0x2a23ef=a243_0x2ac5;(function(_0xa65db9,_0x433b9c){const _0x29e8af=a243_0x2ac5,_0x1ae454=_0xa65db9();while(!![]){try{const _0xcac2d4=parseInt(_0x29e8af(0x176))/0x1*(parseInt(_0x29e8af(0x159))/0x2)+parseInt(_0x29e8af(0x126))/0x3+-parseInt(_0x29e8af(0x12e))/0x4+parseInt(_0x29e8af(0x17f))/0x5+parseInt(_0x29e8af(0x147))/0x6+parseInt(_0x29e8af(0x16c))/0x7*(parseInt(_0x29e8af(0x131))/0x8)+-parseInt(_0x29e8af(0x13a))/0x9*(parseInt(_0x29e8af(0x17e))/0xa);if(_0xcac2d4===_0x433b9c)break;else _0x1ae454['push'](_0x1ae454['shift']());}catch(_0x1115de){_0x1ae454['push'](_0x1ae454['shift']());}}}(a243_0x3c5b,0x9b26b));const a243_0x39bdad=(function(){let _0x3d547d=!![];return function(_0x3a0d48,_0x1f6468){const _0x2a9b93=_0x3d547d?function(){const _0x25cf97=a243_0x2ac5;if(_0x1f6468){const _0xe7f5c0=_0x1f6468[_0x25cf97(0x173)](_0x3a0d48,arguments);return _0x1f6468=null,_0xe7f5c0;}}:function(){};return _0x3d547d=![],_0x2a9b93;};}()),a243_0x14ae47=a243_0x39bdad(this,function(){const _0x2c909b=a243_0x2ac5;return a243_0x14ae47[_0x2c909b(0x15d)]()['search'](_0x2c909b(0x12a))['toString']()[_0x2c909b(0x124)](a243_0x14ae47)[_0x2c909b(0x14a)](_0x2c909b(0x12a));});a243_0x14ae47();'use strict';function a243_0x2ac5(_0x1b2ecd,_0x21711f){const _0x5bfb94=a243_0x3c5b();return a243_0x2ac5=function(_0x14ae47,_0x39bdad){_0x14ae47=_0x14ae47-0x124;let _0x3c5b52=_0x5bfb94[_0x14ae47];return _0x3c5b52;},a243_0x2ac5(_0x1b2ecd,_0x21711f);}var __decorate=this&&this['__decorate']||function(_0x3ee1e5,_0x496b9c,_0x31c00a,_0x290065){const _0x25e3ab=a243_0x2ac5;var _0xa109f3=arguments[_0x25e3ab(0x172)],_0x30b32a=_0xa109f3<0x3?_0x496b9c:_0x290065===null?_0x290065=Object[_0x25e3ab(0x155)](_0x496b9c,_0x31c00a):_0x290065,_0x332683;if(typeof Reflect===_0x25e3ab(0x148)&&typeof Reflect[_0x25e3ab(0x14f)]==='function')_0x30b32a=Reflect[_0x25e3ab(0x14f)](_0x3ee1e5,_0x496b9c,_0x31c00a,_0x290065);else{for(var _0xe279c2=_0x3ee1e5['length']-0x1;_0xe279c2>=0x0;_0xe279c2--)if(_0x332683=_0x3ee1e5[_0xe279c2])_0x30b32a=(_0xa109f3<0x3?_0x332683(_0x30b32a):_0xa109f3>0x3?_0x332683(_0x496b9c,_0x31c00a,_0x30b32a):_0x332683(_0x496b9c,_0x31c00a))||_0x30b32a;}return _0xa109f3>0x3&&_0x30b32a&&Object[_0x25e3ab(0x14d)](_0x496b9c,_0x31c00a,_0x30b32a),_0x30b32a;},__metadata=this&&this['__metadata']||function(_0x5f41d5,_0x336c9a){const _0x1d9631=a243_0x2ac5;if(typeof Reflect==='object'&&typeof Reflect[_0x1d9631(0x158)]===_0x1d9631(0x135))return Reflect[_0x1d9631(0x158)](_0x5f41d5,_0x336c9a);};Object[a243_0x2a23ef(0x14d)](exports,a243_0x2a23ef(0x163),{'value':!![]}),exports[a243_0x2a23ef(0x150)]=void 0x0;const typedi_1=require(a243_0x2a23ef(0x157)),constants_1=require(a243_0x2a23ef(0x14c)),errors_1=require(a243_0x2a23ef(0x169)),utils_1=require(a243_0x2a23ef(0x137)),flosum_repository_sync_dto_1=require(a243_0x2a23ef(0x15b)),not_found_error_1=require(a243_0x2a23ef(0x133)),queries_1=require(a243_0x2a23ef(0x174)),salesforce_query_service_1=require(a243_0x2a23ef(0x171)),salesforce_service_1=require(a243_0x2a23ef(0x167));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x464eac,_0x559554){const _0x5107d2=a243_0x2a23ef;this[_0x5107d2(0x170)]=_0x464eac,this[_0x5107d2(0x17b)]=_0x559554;}async[a243_0x2a23ef(0x17d)](_0x4e9ca0){const _0x47f032=a243_0x2a23ef;var _0x918c94;const _0x56cbc9=await this[_0x47f032(0x170)]['query'](_0x4e9ca0),_0x3dd8a0=[];for(const _0x3b623c of _0x56cbc9){const _0x5109fd=(_0x918c94=_0x3b623c[constants_1[_0x47f032(0x15c)]+_0x47f032(0x177)])===null||_0x918c94===void 0x0?void 0x0:_0x918c94['records'];_0x5109fd&&_0x5109fd[_0x47f032(0x172)]&&_0x3dd8a0[_0x47f032(0x13b)](_0x5109fd[0x0]['Id']);}return _0x3dd8a0;}async['getAllRepositoryNames'](_0x3cec88){const _0x37605e=a243_0x2a23ef,_0x52be0e=await this[_0x37605e(0x170)][_0x37605e(0x13c)](queries_1[_0x37605e(0x136)]['replace'](/\%connection_id\%/g,_0x3cec88));return _0x52be0e['map'](_0x2dc3a1=>{const _0x36c69e=_0x37605e;return _0x2dc3a1[constants_1[_0x36c69e(0x15e)]+_0x36c69e(0x16a)]?_0x2dc3a1[constants_1[_0x36c69e(0x15e)]+'Repository__r'][_0x36c69e(0x151)]:_0x2dc3a1[_0x36c69e(0x151)];});}async[a243_0x2a23ef(0x143)](_0x34cf5e){const _0x248946=a243_0x2a23ef,_0x457171=await this[_0x248946(0x170)][_0x248946(0x13c)](queries_1[_0x248946(0x139)][_0x248946(0x154)](/\%connection_id\%/g,_0x34cf5e));return _0x457171['map'](_0x2e2d40=>flosum_repository_sync_dto_1[_0x248946(0x13e)][_0x248946(0x162)](_0x2e2d40));}async[a243_0x2a23ef(0x15a)](_0x33602d){const _0x54e050=a243_0x2a23ef,_0x2ca00e=await this[_0x54e050(0x170)][_0x54e050(0x13c)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x54e050(0x154)](/%repositories_ids\%/g,_0x33602d));return _0x2ca00e[_0x54e050(0x164)](_0x10b854=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x54e050(0x140)](_0x10b854));}async['getRepositoryRecord'](_0x2d9fc5){const _0x59b6ae=a243_0x2a23ef,_0x57b1ae=await this[_0x59b6ae(0x170)][_0x59b6ae(0x13c)](queries_1[_0x59b6ae(0x128)][_0x59b6ae(0x154)](_0x59b6ae(0x13d),_0x2d9fc5));if(_0x57b1ae[_0x59b6ae(0x172)]===0x0)throw new not_found_error_1[(_0x59b6ae(0x16d))]('Repository\x20with\x20Id\x20'+_0x2d9fc5+_0x59b6ae(0x165));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x59b6ae(0x162)](_0x57b1ae[0x0]);}async[a243_0x2a23ef(0x179)](_0x3c2861){const _0x31a994=a243_0x2a23ef,_0x355765=await this['salesforceQuery'][_0x31a994(0x13c)](queries_1[_0x31a994(0x130)][_0x31a994(0x154)](_0x31a994(0x13d),_0x3c2861));if(_0x355765[_0x31a994(0x172)]===0x0)throw new not_found_error_1[(_0x31a994(0x16d))]('Branch\x20with\x20Id\x20'+_0x3c2861+_0x31a994(0x165));return flosum_repository_sync_dto_1[_0x31a994(0x13e)][_0x31a994(0x140)](_0x355765[0x0]);}async[a243_0x2a23ef(0x17c)](_0x2a3386){const _0x190c9b=a243_0x2a23ef,_0x5a822e=await this[_0x190c9b(0x170)][_0x190c9b(0x13c)](queries_1[_0x190c9b(0x125)][_0x190c9b(0x154)]('%name%',_0x2a3386));if(_0x5a822e[_0x190c9b(0x172)]===0x0)throw new not_found_error_1[(_0x190c9b(0x16d))](_0x190c9b(0x161)+_0x2a3386+_0x190c9b(0x165));const _0x45ddda=_0x5a822e['find'](_0x2a7169=>_0x2a7169[constants_1[_0x190c9b(0x15c)]+_0x190c9b(0x134)]===_0x2a3386);if(!_0x45ddda)throw new not_found_error_1[(_0x190c9b(0x16d))](_0x190c9b(0x161)+_0x2a3386+_0x190c9b(0x165));return flosum_repository_sync_dto_1[_0x190c9b(0x13e)]['fromBranchRecord'](_0x45ddda);}async[a243_0x2a23ef(0x149)](_0x30d471){const _0x16b320=a243_0x2a23ef,_0xe644b7=await this['salesforceQuery'][_0x16b320(0x13c)](queries_1[_0x16b320(0x15f)][_0x16b320(0x154)](_0x16b320(0x16b),_0x30d471));if(_0xe644b7[_0x16b320(0x172)]===0x0)throw new not_found_error_1[(_0x16b320(0x16d))]('Repository\x20'+_0x30d471+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x16b320(0x13e)][_0x16b320(0x162)](_0xe644b7[0x0]);}async[a243_0x2a23ef(0x14e)](_0x49ad04){const _0x43a7ba=a243_0x2a23ef,_0xa3e768='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x43a7ba(0x168)]+_0x43a7ba(0x146)+_0x49ad04+'\x27';return this[_0x43a7ba(0x17d)](_0xa3e768);}async[a243_0x2a23ef(0x129)](_0xbe0bff){const _0x634c7=a243_0x2a23ef,_0x36b0cf=_0x634c7(0x13f)+queries_1[_0x634c7(0x168)]+_0x634c7(0x14b)+_0xbe0bff+'\x27';return this[_0x634c7(0x17d)](_0x36b0cf);}async['getAttachmentId'](_0x313426){const _0x11311a=a243_0x2a23ef;var _0x3cacf6;const _0x2e3ce3=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x11311a(0x154)](_0x11311a(0x16e),_0x313426['objectId'])['replace']('%name%',_0x313426['repositoryId']?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x11311a(0x178)]),_0x2a8dad=await this[_0x11311a(0x170)][_0x11311a(0x13c)](_0x2e3ce3),_0x202673=(_0x3cacf6=_0x2a8dad[0x0])===null||_0x3cacf6===void 0x0?void 0x0:_0x3cacf6['Id'];if(!_0x202673)throw new Error(errors_1[_0x11311a(0x166)]);return _0x202673;}async[a243_0x2a23ef(0x144)](_0xf321b){const _0x1fa6e0=a243_0x2a23ef;let _0x4c5ec7=await this['getAttachmentId'](_0xf321b)[_0x1fa6e0(0x12c)](()=>null);return!_0x4c5ec7&&(_0x4c5ec7=await this['salesforceService'][_0x1fa6e0(0x138)](_0x1fa6e0(0x156),{'Body':(0x0,utils_1[_0x1fa6e0(0x160)])('{}'),'ParentId':_0xf321b[_0x1fa6e0(0x175)],'ContentType':_0x1fa6e0(0x142),'Name':_0xf321b['repositoryId']?constants_1[_0x1fa6e0(0x153)]:constants_1[_0x1fa6e0(0x178)]})),_0x4c5ec7;}async['updateRemoteState'](_0x3564c3,_0x322619){const _0x370bca=a243_0x2a23ef,_0xc8bc8e=await this[_0x370bca(0x144)](_0x3564c3);await this[_0x370bca(0x17b)][_0x370bca(0x145)]('Attachment',_0xc8bc8e,{'Body':(0x0,utils_1[_0x370bca(0x160)])(JSON[_0x370bca(0x12d)](_0x322619))});}async[a243_0x2a23ef(0x127)](_0x3a700b,_0x17a51c){const _0x493607=a243_0x2a23ef;await this[_0x493607(0x17b)]['patchObject'](_0x3a700b[_0x493607(0x180)],_0x3a700b[_0x493607(0x175)],{[constants_1[_0x493607(0x15e)]+'Synchronization_Status__c']:_0x17a51c});}async[a243_0x2a23ef(0x141)](_0x1194e6){const _0x2931ed=a243_0x2a23ef;await this[_0x2931ed(0x17b)][_0x2931ed(0x145)](constants_1[_0x2931ed(0x15e)]+_0x2931ed(0x16f),_0x1194e6,{[constants_1[_0x2931ed(0x15e)]+_0x2931ed(0x17a)]:![]});}};function a243_0x3c5b(){const _0x1f819b=['getComponentsFromRepository','decorate','SalesforceSyncService','Name','design:paramtypes','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','replace','getOwnPropertyDescriptor','Attachment','typedi','metadata','4IKUeVh','getBranchRecords','../dto/flosum-repository-sync.dto','FLOSUM_NAMESPACE','toString','FLOSUM_GIT_NAMESPACE','GET_REPOSITORY_BY_NAME_QUERY','encodeBase64','Branch\x20','fromRepositoryRecord','__esModule','map','\x20not\x20found\x20on\x20salesforce','ERR_INVALID_ATTACHMENT_ID','./salesforce.service','GET_COMPONENTS_QUERY','../../../../constants/errors','Repository__r','%name%','623fMjdBJ','SalesforceNotFoundError','%parentId%','Connection__c','salesforceQuery','./salesforce-query.service','length','apply','../queries','objectId','440786gZgIvu','Components__r','SYNC_ATTACHMENT_FOR_BRANCH_NAME','getBranchRecord','Sync_In_Progress__c','salesforceService','getBranchRecordByName','getComponents','40qTonab','3225385qruOQB','objectType','constructor','GET_BRANCH_BY_NAME_QUERY','1549482LczYiv','setStatus','GET_REPOSITORY_QUERY','getBranchComponents','(((.+)+)+)+$','Service','catch','stringify','2341444LXLFDL','SalesforceQueryService','GET_BRANCH_QUERY','28568gutPXy','SalesforceService','../errors/not-found.error','Branch_Name__c','function','GET_REPOSITORIES_NAMES_QUERY','../../../shared/utils','createObject','GET_WAITING_REPOSITORIES_QUERY','2822949KgNOxN','push','query','%id%','FlosumRepositorySyncDto','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','fromBranchRecord','disableSync','text/plain','getRepositoryRecords','getRemoteStateAttachmentId','patchObject','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','687252yeYBIR','object','getRepositoryRecordByName','search','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','../../../../constants','defineProperty'];a243_0x3c5b=function(){return _0x1f819b;};return a243_0x3c5b();}SalesforceSyncService=__decorate([(0x0,typedi_1[a243_0x2a23ef(0x12b)])(),__metadata(a243_0x2a23ef(0x152),[salesforce_query_service_1[a243_0x2a23ef(0x12f)],salesforce_service_1[a243_0x2a23ef(0x132)]])],SalesforceSyncService),exports[a243_0x2a23ef(0x150)]=SalesforceSyncService;