const a186_0xb453d=a186_0x328c;(function(_0x6d864b,_0x19eb53){const _0x55fca9=a186_0x328c,_0x247760=_0x6d864b();while(!![]){try{const _0x4a580f=parseInt(_0x55fca9(0x169))/0x1*(-parseInt(_0x55fca9(0x16f))/0x2)+parseInt(_0x55fca9(0x14e))/0x3+parseInt(_0x55fca9(0x12f))/0x4+parseInt(_0x55fca9(0x146))/0x5+-parseInt(_0x55fca9(0x145))/0x6+parseInt(_0x55fca9(0x138))/0x7+-parseInt(_0x55fca9(0x158))/0x8;if(_0x4a580f===_0x19eb53)break;else _0x247760['push'](_0x247760['shift']());}catch(_0x15327f){_0x247760['push'](_0x247760['shift']());}}}(a186_0x12a6,0xa4cec));const a186_0x476f1d=(function(){let _0x54131d=!![];return function(_0x35408d,_0xe9e7b3){const _0x36dbc6=_0x54131d?function(){const _0x296b3d=a186_0x328c;if(_0xe9e7b3){const _0x1f5f6e=_0xe9e7b3[_0x296b3d(0x163)](_0x35408d,arguments);return _0xe9e7b3=null,_0x1f5f6e;}}:function(){};return _0x54131d=![],_0x36dbc6;};}()),a186_0x480f26=a186_0x476f1d(this,function(){const _0x4707c0=a186_0x328c;return a186_0x480f26[_0x4707c0(0x159)]()['search'](_0x4707c0(0x17d))[_0x4707c0(0x159)]()[_0x4707c0(0x177)](a186_0x480f26)[_0x4707c0(0x168)](_0x4707c0(0x17d));});a186_0x480f26();function a186_0x12a6(){const _0x56ebca=['getBranchComponents','function','getOwnPropertyDescriptor','getRemoteStateAttachmentId','encodeBase64','getRepositoryRecordByName','SalesforceQueryService','../../../../constants','query','2839596LQDtkX','5627210CgvvJT','%id%','FLOSUM_GIT_NAMESPACE','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','\x0a\x20\x20\x20\x20\x20\x20','ERR_INVALID_ATTACHMENT_ID','GET_BRANCH_BY_NAME_QUERY','../dto/flosum-repository-sync.dto','596001NrynPs','disableSync','map','getComponents','Repository\x20','fromRepositoryRecord','metadata','\x20not\x20found\x20on\x20salesforce','repositoryId','Branch\x20','8283240sekfei','toString','getBranchRecords','getAttachmentId','length','catch','FlosumRepositorySyncDto','__metadata','SalesforceNotFoundError','getBranchRecordByName','SYNC_ATTACHMENT_FOR_BRANCH_NAME','apply','getRepositoryRecords','%parentId%','typedi','design:paramtypes','search','1065153AkfuoL','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','../errors/not-found.error','Attachment','getComponentsFromRepository','push','2XSjWxf','object','../queries','records','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','GET_WAITING_REPOSITORIES_QUERY','../../../../constants/errors','Sync_In_Progress__c','constructor','getRepositoryRecord','GET_REPOSITORY_BY_NAME_QUERY','%name%','decorate','GET_COMPONENTS_QUERY','(((.+)+)+)+$','./salesforce-query.service','GET_REPOSITORY_QUERY','getBranchRecord','fromBranchRecord','defineProperty','GET_WAITING_BRANCHES_QUERY','updateRemoteState','3230864MZINnM','salesforceQuery','objectId','stringify','patchObject','../../../shared/utils','Service','SalesforceSyncService','replace','7819357LAxNSf','salesforceService','__esModule','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'];a186_0x12a6=function(){return _0x56ebca;};return a186_0x12a6();}'use strict';var __decorate=this&&this['__decorate']||function(_0x3bc5de,_0x52e4ab,_0xc52d7f,_0x558b32){const _0x1857bd=a186_0x328c;var _0x208b2b=arguments[_0x1857bd(0x15c)],_0x731e11=_0x208b2b<0x3?_0x52e4ab:_0x558b32===null?_0x558b32=Object[_0x1857bd(0x13e)](_0x52e4ab,_0xc52d7f):_0x558b32,_0x58edc5;if(typeof Reflect==='object'&&typeof Reflect[_0x1857bd(0x17b)]===_0x1857bd(0x13d))_0x731e11=Reflect[_0x1857bd(0x17b)](_0x3bc5de,_0x52e4ab,_0xc52d7f,_0x558b32);else{for(var _0x2d3ed3=_0x3bc5de[_0x1857bd(0x15c)]-0x1;_0x2d3ed3>=0x0;_0x2d3ed3--)if(_0x58edc5=_0x3bc5de[_0x2d3ed3])_0x731e11=(_0x208b2b<0x3?_0x58edc5(_0x731e11):_0x208b2b>0x3?_0x58edc5(_0x52e4ab,_0xc52d7f,_0x731e11):_0x58edc5(_0x52e4ab,_0xc52d7f))||_0x731e11;}return _0x208b2b>0x3&&_0x731e11&&Object[_0x1857bd(0x12c)](_0x52e4ab,_0xc52d7f,_0x731e11),_0x731e11;},__metadata=this&&this[a186_0xb453d(0x15f)]||function(_0x311ce5,_0x3ff913){const _0x356e67=a186_0xb453d;if(typeof Reflect===_0x356e67(0x170)&&typeof Reflect[_0x356e67(0x154)]==='function')return Reflect['metadata'](_0x311ce5,_0x3ff913);};Object[a186_0xb453d(0x12c)](exports,a186_0xb453d(0x13a),{'value':!![]}),exports[a186_0xb453d(0x136)]=void 0x0;const typedi_1=require(a186_0xb453d(0x166)),constants_1=require(a186_0xb453d(0x143)),errors_1=require(a186_0xb453d(0x175)),utils_1=require(a186_0xb453d(0x134)),flosum_repository_sync_dto_1=require(a186_0xb453d(0x14d)),not_found_error_1=require(a186_0xb453d(0x16b)),queries_1=require(a186_0xb453d(0x171)),salesforce_query_service_1=require(a186_0xb453d(0x17e)),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0x914fef,_0x3c199e){this['salesforceQuery']=_0x914fef,this['salesforceService']=_0x3c199e;}async[a186_0xb453d(0x151)](_0xb19763){const _0x5f2034=a186_0xb453d;var _0x3b392b;const _0x3f1388=await this['salesforceQuery'][_0x5f2034(0x144)](_0xb19763),_0x27e976=[];for(const _0x3d037b of _0x3f1388){const _0x199659=(_0x3b392b=_0x3d037b[constants_1['FLOSUM_NAMESPACE']+'Components__r'])===null||_0x3b392b===void 0x0?void 0x0:_0x3b392b[_0x5f2034(0x172)];_0x199659&&_0x199659[_0x5f2034(0x15c)]&&_0x27e976[_0x5f2034(0x16e)](_0x199659[0x0]['Id']);}return _0x27e976;}async[a186_0xb453d(0x164)](_0x5a945b){const _0x4cd0bf=a186_0xb453d,_0x578352=await this[_0x4cd0bf(0x130)][_0x4cd0bf(0x144)](queries_1[_0x4cd0bf(0x174)][_0x4cd0bf(0x137)](/\%connection_id\%/g,_0x5a945b));return _0x578352[_0x4cd0bf(0x150)](_0x4d9d04=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x4d9d04));}async[a186_0xb453d(0x15a)](_0x5d1bf5){const _0x39da2a=a186_0xb453d,_0x109d6b=await this[_0x39da2a(0x130)][_0x39da2a(0x144)](queries_1[_0x39da2a(0x12d)][_0x39da2a(0x137)](/%repositories_ids\%/g,_0x5d1bf5));return _0x109d6b[_0x39da2a(0x150)](_0x42f87b=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0x42f87b));}async[a186_0xb453d(0x178)](_0x57f965){const _0x845ad4=a186_0xb453d,_0x362bd3=await this[_0x845ad4(0x130)][_0x845ad4(0x144)](queries_1[_0x845ad4(0x17f)][_0x845ad4(0x137)]('%id%',_0x57f965));if(_0x362bd3[_0x845ad4(0x15c)]===0x0)throw new not_found_error_1[(_0x845ad4(0x160))]('Repository\x20with\x20Id\x20'+_0x57f965+_0x845ad4(0x155));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x845ad4(0x153)](_0x362bd3[0x0]);}async[a186_0xb453d(0x180)](_0x454e89){const _0x4c518f=a186_0xb453d,_0xb9675=await this['salesforceQuery']['query'](queries_1['GET_BRANCH_QUERY'][_0x4c518f(0x137)](_0x4c518f(0x147),_0x454e89));if(_0xb9675[_0x4c518f(0x15c)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20with\x20Id\x20'+_0x454e89+_0x4c518f(0x155));return flosum_repository_sync_dto_1[_0x4c518f(0x15e)]['fromBranchRecord'](_0xb9675[0x0]);}async[a186_0xb453d(0x161)](_0x250c00){const _0xd8a1dc=a186_0xb453d,_0x7eb24e=await this['salesforceQuery'][_0xd8a1dc(0x144)](queries_1[_0xd8a1dc(0x14c)]['replace'](_0xd8a1dc(0x17a),_0x250c00));if(_0x7eb24e[_0xd8a1dc(0x15c)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0xd8a1dc(0x157)+_0x250c00+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0xd8a1dc(0x181)](_0x7eb24e[0x0]);}async[a186_0xb453d(0x141)](_0x564051){const _0x461e35=a186_0xb453d,_0x29464a=await this[_0x461e35(0x130)]['query'](queries_1[_0x461e35(0x179)][_0x461e35(0x137)](_0x461e35(0x17a),_0x564051));if(_0x29464a['length']===0x0)throw new not_found_error_1[(_0x461e35(0x160))](_0x461e35(0x152)+_0x564051+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x461e35(0x15e)]['fromRepositoryRecord'](_0x29464a[0x0]);}async[a186_0xb453d(0x16d)](_0x5e820a){const _0x5b5dc3=a186_0xb453d,_0x3d27fb=_0x5b5dc3(0x14a)+queries_1['GET_COMPONENTS_QUERY']+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x5e820a+'\x27';return this['getComponents'](_0x3d27fb);}async[a186_0xb453d(0x13c)](_0x1468ea){const _0x406fae=a186_0xb453d,_0x4feab2=_0x406fae(0x173)+queries_1[_0x406fae(0x17c)]+_0x406fae(0x149)+_0x1468ea+'\x27';return this[_0x406fae(0x151)](_0x4feab2);}async[a186_0xb453d(0x15b)](_0x27705c){const _0x12565a=a186_0xb453d;var _0x254aeb;const _0x1cbe64=queries_1[_0x12565a(0x13b)]['replace'](_0x12565a(0x165),_0x27705c[_0x12565a(0x131)])['replace']('%name%',_0x27705c[_0x12565a(0x156)]?constants_1[_0x12565a(0x16a)]:constants_1[_0x12565a(0x162)]),_0x3e597d=await this[_0x12565a(0x130)]['query'](_0x1cbe64),_0x31d4d4=(_0x254aeb=_0x3e597d[0x0])===null||_0x254aeb===void 0x0?void 0x0:_0x254aeb['Id'];if(!_0x31d4d4)throw new Error(errors_1[_0x12565a(0x14b)]);return _0x31d4d4;}async['getRemoteStateAttachmentId'](_0x4303f7){const _0x499769=a186_0xb453d;let _0x3cf2d5=await this[_0x499769(0x15b)](_0x4303f7)[_0x499769(0x15d)](()=>null);return!_0x3cf2d5&&(_0x3cf2d5=await this['salesforceService']['createObject'](_0x499769(0x16c),{'Body':utils_1[_0x499769(0x140)]('{}'),'ParentId':_0x4303f7['objectId'],'ContentType':'text/plain','Name':_0x4303f7[_0x499769(0x156)]?constants_1[_0x499769(0x16a)]:constants_1[_0x499769(0x162)]})),_0x3cf2d5;}async[a186_0xb453d(0x12e)](_0xb359fc,_0x198c12){const _0x13808d=a186_0xb453d,_0x2c8d30=await this[_0x13808d(0x13f)](_0xb359fc);await this[_0x13808d(0x139)][_0x13808d(0x133)](_0x13808d(0x16c),_0x2c8d30,{'Body':utils_1[_0x13808d(0x140)](JSON[_0x13808d(0x132)](_0x198c12))});}async['setStatus'](_0x3860d2,_0x422f57){const _0x4e4734=a186_0xb453d;await this['salesforceService'][_0x4e4734(0x133)](_0x3860d2['objectType'],_0x3860d2[_0x4e4734(0x131)],{[constants_1[_0x4e4734(0x148)]+'Synchronization_Status__c']:_0x422f57});}async[a186_0xb453d(0x14f)](_0x1614d3){const _0x151e98=a186_0xb453d;await this[_0x151e98(0x139)][_0x151e98(0x133)](constants_1[_0x151e98(0x148)]+'Connection__c',_0x1614d3,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x151e98(0x176)]:![]});}};function a186_0x328c(_0x5d8035,_0x777eac){const _0xc9bcd9=a186_0x12a6();return a186_0x328c=function(_0x480f26,_0x476f1d){_0x480f26=_0x480f26-0x12c;let _0x12a63c=_0xc9bcd9[_0x480f26];return _0x12a63c;},a186_0x328c(_0x5d8035,_0x777eac);}SalesforceSyncService=__decorate([typedi_1[a186_0xb453d(0x135)](),__metadata(a186_0xb453d(0x167),[salesforce_query_service_1[a186_0xb453d(0x142)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports[a186_0xb453d(0x136)]=SalesforceSyncService;