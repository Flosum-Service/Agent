const a204_0x323bda=a204_0x3c93;(function(_0x12b016,_0x155525){const _0x352997=a204_0x3c93,_0x21471f=_0x12b016();while(!![]){try{const _0x5f35e4=-parseInt(_0x352997(0x6c))/0x1*(-parseInt(_0x352997(0xae))/0x2)+-parseInt(_0x352997(0x9e))/0x3*(-parseInt(_0x352997(0x67))/0x4)+parseInt(_0x352997(0x6b))/0x5*(parseInt(_0x352997(0xa6))/0x6)+-parseInt(_0x352997(0xaf))/0x7*(parseInt(_0x352997(0xb2))/0x8)+parseInt(_0x352997(0xa8))/0x9*(parseInt(_0x352997(0xad))/0xa)+-parseInt(_0x352997(0x68))/0xb+-parseInt(_0x352997(0x7f))/0xc;if(_0x5f35e4===_0x155525)break;else _0x21471f['push'](_0x21471f['shift']());}catch(_0x3011a0){_0x21471f['push'](_0x21471f['shift']());}}}(a204_0x2a0c,0xba774));const a204_0xe6d047=(function(){let _0x3f95d5=!![];return function(_0x3a8dca,_0x26aed9){const _0x523e1e=_0x3f95d5?function(){const _0x9a47bb=a204_0x3c93;if(_0x26aed9){const _0x70678c=_0x26aed9[_0x9a47bb(0x84)](_0x3a8dca,arguments);return _0x26aed9=null,_0x70678c;}}:function(){};return _0x3f95d5=![],_0x523e1e;};}()),a204_0x2d19f5=a204_0xe6d047(this,function(){const _0x25cc82=a204_0x3c93;return a204_0x2d19f5[_0x25cc82(0x8d)]()[_0x25cc82(0xbb)]('(((.+)+)+)+$')[_0x25cc82(0x8d)]()[_0x25cc82(0xc7)](a204_0x2d19f5)[_0x25cc82(0xbb)](_0x25cc82(0x64));});a204_0x2d19f5();'use strict';var __decorate=this&&this[a204_0x323bda(0xbd)]||function(_0x403e94,_0x29734c,_0x5ee944,_0x487c46){const _0xa28693=a204_0x323bda;var _0x230b60=arguments[_0xa28693(0xbe)],_0x5d0bb7=_0x230b60<0x3?_0x29734c:_0x487c46===null?_0x487c46=Object[_0xa28693(0x9f)](_0x29734c,_0x5ee944):_0x487c46,_0xfb84c9;if(typeof Reflect===_0xa28693(0x8a)&&typeof Reflect[_0xa28693(0xc1)]===_0xa28693(0xc6))_0x5d0bb7=Reflect['decorate'](_0x403e94,_0x29734c,_0x5ee944,_0x487c46);else{for(var _0x5ddd8f=_0x403e94[_0xa28693(0xbe)]-0x1;_0x5ddd8f>=0x0;_0x5ddd8f--)if(_0xfb84c9=_0x403e94[_0x5ddd8f])_0x5d0bb7=(_0x230b60<0x3?_0xfb84c9(_0x5d0bb7):_0x230b60>0x3?_0xfb84c9(_0x29734c,_0x5ee944,_0x5d0bb7):_0xfb84c9(_0x29734c,_0x5ee944))||_0x5d0bb7;}return _0x230b60>0x3&&_0x5d0bb7&&Object[_0xa28693(0xac)](_0x29734c,_0x5ee944,_0x5d0bb7),_0x5d0bb7;},__metadata=this&&this[a204_0x323bda(0xa0)]||function(_0x39a685,_0x787d0e){const _0x2c109a=a204_0x323bda;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x2c109a(0xaa)](_0x39a685,_0x787d0e);};Object[a204_0x323bda(0xac)](exports,a204_0x323bda(0x9b),{'value':!![]}),exports[a204_0x323bda(0xb8)]=void 0x0;function a204_0x3c93(_0x129b4a,_0x14429a){const _0x3e023a=a204_0x2a0c();return a204_0x3c93=function(_0x2d19f5,_0xe6d047){_0x2d19f5=_0x2d19f5-0x64;let _0x2a0cec=_0x3e023a[_0x2d19f5];return _0x2a0cec;},a204_0x3c93(_0x129b4a,_0x14429a);}function a204_0x2a0c(){const _0x5f3548=['Branch\x20','function','constructor','GET_BRANCH_QUERY','(((.+)+)+)+$','repositoryId','map','4665028eymSWZ','3619539HcNxOX','getBranchRecord','query','5fTNdaO','1zqSnJo','Repository__r','salesforceQuery','GET_WAITING_BRANCHES_QUERY','getAllRepositoryNames','Connection__c','getAttachmentId','SalesforceQueryService','objectId','\x0a\x20\x20\x20\x20\x20\x20','\x20not\x20found\x20on\x20salesforce','../../../shared/utils','getComponentsFromRepository','../queries','text/plain','objectType','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','getBranchRecordByName','%name%','8810496IELYKS','Name','Repository\x20','SalesforceService','patchObject','apply','GET_BRANCH_BY_NAME_QUERY','Repository\x20with\x20Id\x20','encodeBase64','FLOSUM_NAMESPACE','FlosumRepositorySyncDto','object','GET_COMPONENTS_QUERY','GET_WAITING_REPOSITORIES_QUERY','toString','Attachment','%parentId%','getRepositoryRecord','fromRepositoryRecord','./salesforce-query.service','SYNC_ATTACHMENT_FOR_BRANCH_NAME','GET_REPOSITORIES_NAMES_QUERY','stringify','records','find','getRepositoryRecords','./salesforce.service','FLOSUM_GIT_NAMESPACE','__esModule','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Branch_Name__c','3TOeAip','getOwnPropertyDescriptor','__metadata','updateRemoteState','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','salesforceService','Branch\x20with\x20Id\x20','SalesforceNotFoundError','1393050UgPeWg','catch','27svMGeA','replace','metadata','../../../../constants/errors','defineProperty','799090qwWwlz','1523086rkjHWZ','7OnbTIJ','GET_REPOSITORY_QUERY','Synchronization_Status__c','4581448bjerLp','getRemoteStateAttachmentId','getBranchComponents','setStatus','Service','getComponents','SalesforceSyncService','getBranchRecords','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','search','%id%','__decorate','length','push','../errors/not-found.error','decorate','../dto/flosum-repository-sync.dto','fromBranchRecord','../../../../constants'];a204_0x2a0c=function(){return _0x5f3548;};return a204_0x2a0c();}const typedi_1=require('typedi'),constants_1=require(a204_0x323bda(0xc4)),errors_1=require(a204_0x323bda(0xab)),utils_1=require(a204_0x323bda(0x77)),flosum_repository_sync_dto_1=require(a204_0x323bda(0xc2)),not_found_error_1=require(a204_0x323bda(0xc0)),queries_1=require(a204_0x323bda(0x79)),salesforce_query_service_1=require(a204_0x323bda(0x92)),salesforce_service_1=require(a204_0x323bda(0x99));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x10c77d,_0x26df33){const _0x1b2974=a204_0x323bda;this[_0x1b2974(0x6e)]=_0x10c77d,this[_0x1b2974(0xa3)]=_0x26df33;}async[a204_0x323bda(0xb7)](_0x8a60cc){const _0x119e63=a204_0x323bda;var _0x32c7be;const _0xee419b=await this['salesforceQuery'][_0x119e63(0x6a)](_0x8a60cc),_0x17e70a=[];for(const _0x5812cb of _0xee419b){const _0x1bef53=(_0x32c7be=_0x5812cb[constants_1[_0x119e63(0x88)]+'Components__r'])===null||_0x32c7be===void 0x0?void 0x0:_0x32c7be[_0x119e63(0x96)];_0x1bef53&&_0x1bef53[_0x119e63(0xbe)]&&_0x17e70a[_0x119e63(0xbf)](_0x1bef53[0x0]['Id']);}return _0x17e70a;}async[a204_0x323bda(0x70)](_0x96c0f8){const _0x5ec388=a204_0x323bda,_0x240966=await this[_0x5ec388(0x6e)][_0x5ec388(0x6a)](queries_1[_0x5ec388(0x94)][_0x5ec388(0xa9)](/\%connection_id\%/g,_0x96c0f8));return _0x240966['map'](_0x376a5e=>{const _0x21104b=_0x5ec388;return _0x376a5e[constants_1[_0x21104b(0x9a)]+_0x21104b(0x6d)]?_0x376a5e[constants_1[_0x21104b(0x9a)]+_0x21104b(0x6d)][_0x21104b(0x80)]:_0x376a5e[_0x21104b(0x80)];});}async[a204_0x323bda(0x98)](_0x1bd598){const _0x1b319a=a204_0x323bda,_0x50c1dd=await this[_0x1b319a(0x6e)][_0x1b319a(0x6a)](queries_1[_0x1b319a(0x8c)][_0x1b319a(0xa9)](/\%connection_id\%/g,_0x1bd598));return _0x50c1dd[_0x1b319a(0x66)](_0x783d60=>flosum_repository_sync_dto_1[_0x1b319a(0x89)][_0x1b319a(0x91)](_0x783d60));}async[a204_0x323bda(0xb9)](_0x45ea2e){const _0x481dee=a204_0x323bda,_0x51d07f=await this['salesforceQuery'][_0x481dee(0x6a)](queries_1[_0x481dee(0x6f)][_0x481dee(0xa9)](/%repositories_ids\%/g,_0x45ea2e));return _0x51d07f[_0x481dee(0x66)](_0x41763b=>flosum_repository_sync_dto_1[_0x481dee(0x89)][_0x481dee(0xc3)](_0x41763b));}async[a204_0x323bda(0x90)](_0x1d6820){const _0x1de045=a204_0x323bda,_0x2cd4ee=await this['salesforceQuery'][_0x1de045(0x6a)](queries_1[_0x1de045(0xb0)]['replace'](_0x1de045(0xbc),_0x1d6820));if(_0x2cd4ee[_0x1de045(0xbe)]===0x0)throw new not_found_error_1[(_0x1de045(0xa5))](_0x1de045(0x86)+_0x1d6820+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x1de045(0x89)][_0x1de045(0x91)](_0x2cd4ee[0x0]);}async[a204_0x323bda(0x69)](_0x40d532){const _0x3c23bc=a204_0x323bda,_0x1d4873=await this['salesforceQuery']['query'](queries_1[_0x3c23bc(0xc8)]['replace'](_0x3c23bc(0xbc),_0x40d532));if(_0x1d4873[_0x3c23bc(0xbe)]===0x0)throw new not_found_error_1[(_0x3c23bc(0xa5))](_0x3c23bc(0xa4)+_0x40d532+_0x3c23bc(0x76));return flosum_repository_sync_dto_1[_0x3c23bc(0x89)]['fromBranchRecord'](_0x1d4873[0x0]);}async[a204_0x323bda(0x7d)](_0x325c0f){const _0x2144c5=a204_0x323bda,_0x2aa283=await this[_0x2144c5(0x6e)]['query'](queries_1[_0x2144c5(0x85)][_0x2144c5(0xa9)](_0x2144c5(0x7e),_0x325c0f));if(_0x2aa283[_0x2144c5(0xbe)]===0x0)throw new not_found_error_1[(_0x2144c5(0xa5))](_0x2144c5(0xc5)+_0x325c0f+_0x2144c5(0x76));const _0x16d4b8=_0x2aa283[_0x2144c5(0x97)](_0x39ad4d=>_0x39ad4d[constants_1['FLOSUM_NAMESPACE']+_0x2144c5(0x9d)]===_0x325c0f);if(!_0x16d4b8)throw new not_found_error_1[(_0x2144c5(0xa5))](_0x2144c5(0xc5)+_0x325c0f+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x2144c5(0x89)]['fromBranchRecord'](_0x16d4b8);}async['getRepositoryRecordByName'](_0x36c140){const _0x50d7f2=a204_0x323bda,_0x3f0bf5=await this[_0x50d7f2(0x6e)][_0x50d7f2(0x6a)](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x50d7f2(0xa9)](_0x50d7f2(0x7e),_0x36c140));if(_0x3f0bf5[_0x50d7f2(0xbe)]===0x0)throw new not_found_error_1[(_0x50d7f2(0xa5))](_0x50d7f2(0x81)+_0x36c140+_0x50d7f2(0x76));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x3f0bf5[0x0]);}async[a204_0x323bda(0x78)](_0x51ebec){const _0x51815d=a204_0x323bda,_0x1c96c8=_0x51815d(0x75)+queries_1['GET_COMPONENTS_QUERY']+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x51ebec+'\x27';return this[_0x51815d(0xb7)](_0x1c96c8);}async[a204_0x323bda(0xb4)](_0x5677a2){const _0x1c5110=a204_0x323bda,_0x3f0944=_0x1c5110(0x9c)+queries_1[_0x1c5110(0x8b)]+_0x1c5110(0xba)+_0x5677a2+'\x27';return this['getComponents'](_0x3f0944);}async[a204_0x323bda(0x72)](_0x1b2b3d){const _0x407f70=a204_0x323bda;var _0x2743f8;const _0x474e17=queries_1[_0x407f70(0xa2)][_0x407f70(0xa9)](_0x407f70(0x8f),_0x1b2b3d[_0x407f70(0x74)])[_0x407f70(0xa9)](_0x407f70(0x7e),_0x1b2b3d[_0x407f70(0x65)]?constants_1[_0x407f70(0x7c)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x2ca4ba=await this[_0x407f70(0x6e)]['query'](_0x474e17),_0x296341=(_0x2743f8=_0x2ca4ba[0x0])===null||_0x2743f8===void 0x0?void 0x0:_0x2743f8['Id'];if(!_0x296341)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x296341;}async[a204_0x323bda(0xb3)](_0x400603){const _0x45b19e=a204_0x323bda;let _0x2f322d=await this[_0x45b19e(0x72)](_0x400603)[_0x45b19e(0xa7)](()=>null);return!_0x2f322d&&(_0x2f322d=await this[_0x45b19e(0xa3)]['createObject'](_0x45b19e(0x8e),{'Body':(0x0,utils_1[_0x45b19e(0x87)])('{}'),'ParentId':_0x400603[_0x45b19e(0x74)],'ContentType':_0x45b19e(0x7a),'Name':_0x400603[_0x45b19e(0x65)]?constants_1[_0x45b19e(0x7c)]:constants_1[_0x45b19e(0x93)]})),_0x2f322d;}async[a204_0x323bda(0xa1)](_0x18a6d4,_0x163a17){const _0x433e3f=a204_0x323bda,_0x565c7a=await this['getRemoteStateAttachmentId'](_0x18a6d4);await this[_0x433e3f(0xa3)][_0x433e3f(0x83)]('Attachment',_0x565c7a,{'Body':(0x0,utils_1[_0x433e3f(0x87)])(JSON[_0x433e3f(0x95)](_0x163a17))});}async[a204_0x323bda(0xb5)](_0x3e7c30,_0x59ee34){const _0x5d2e3=a204_0x323bda;await this[_0x5d2e3(0xa3)][_0x5d2e3(0x83)](_0x3e7c30[_0x5d2e3(0x7b)],_0x3e7c30[_0x5d2e3(0x74)],{[constants_1[_0x5d2e3(0x9a)]+_0x5d2e3(0xb1)]:_0x59ee34});}async['disableSync'](_0x5b8793){const _0x1858f1=a204_0x323bda;await this[_0x1858f1(0xa3)]['patchObject'](constants_1[_0x1858f1(0x9a)]+_0x1858f1(0x71),_0x5b8793,{[constants_1[_0x1858f1(0x9a)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a204_0x323bda(0xb6)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a204_0x323bda(0x73)],salesforce_service_1[a204_0x323bda(0x82)]])],SalesforceSyncService),exports[a204_0x323bda(0xb8)]=SalesforceSyncService;