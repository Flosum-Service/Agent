const a237_0x172fef=a237_0x413a;(function(_0x212fdd,_0x49ab75){const _0x2a3ec0=a237_0x413a,_0x13c292=_0x212fdd();while(!![]){try{const _0x6b1db8=-parseInt(_0x2a3ec0(0x180))/0x1+-parseInt(_0x2a3ec0(0x190))/0x2*(parseInt(_0x2a3ec0(0x19f))/0x3)+parseInt(_0x2a3ec0(0x198))/0x4*(-parseInt(_0x2a3ec0(0x1af))/0x5)+-parseInt(_0x2a3ec0(0x19c))/0x6*(-parseInt(_0x2a3ec0(0x1a2))/0x7)+-parseInt(_0x2a3ec0(0x17d))/0x8+-parseInt(_0x2a3ec0(0x1ae))/0x9+parseInt(_0x2a3ec0(0x178))/0xa;if(_0x6b1db8===_0x49ab75)break;else _0x13c292['push'](_0x13c292['shift']());}catch(_0x27777c){_0x13c292['push'](_0x13c292['shift']());}}}(a237_0x22bf,0x9f96d));const a237_0x22ec67=(function(){let _0x5d0a25=!![];return function(_0x391891,_0x37e15b){const _0x569f3c=_0x5d0a25?function(){const _0xd3dc2f=a237_0x413a;if(_0x37e15b){const _0x5ea0e0=_0x37e15b[_0xd3dc2f(0x192)](_0x391891,arguments);return _0x37e15b=null,_0x5ea0e0;}}:function(){};return _0x5d0a25=![],_0x569f3c;};}()),a237_0x520b15=a237_0x22ec67(this,function(){const _0x5a2ddd=a237_0x413a;return a237_0x520b15[_0x5a2ddd(0x169)]()[_0x5a2ddd(0x1ad)](_0x5a2ddd(0x168))[_0x5a2ddd(0x169)]()[_0x5a2ddd(0x196)](a237_0x520b15)[_0x5a2ddd(0x1ad)](_0x5a2ddd(0x168));});a237_0x520b15();'use strict';var __decorate=this&&this[a237_0x172fef(0x18a)]||function(_0x40aa81,_0x4073f7,_0x417d9d,_0x3dc6d3){const _0x30f125=a237_0x172fef;var _0x17a3d5=arguments[_0x30f125(0x1a9)],_0x491e01=_0x17a3d5<0x3?_0x4073f7:_0x3dc6d3===null?_0x3dc6d3=Object[_0x30f125(0x16a)](_0x4073f7,_0x417d9d):_0x3dc6d3,_0x1a07d2;if(typeof Reflect===_0x30f125(0x1b5)&&typeof Reflect[_0x30f125(0x1a4)]===_0x30f125(0x186))_0x491e01=Reflect[_0x30f125(0x1a4)](_0x40aa81,_0x4073f7,_0x417d9d,_0x3dc6d3);else{for(var _0x966221=_0x40aa81[_0x30f125(0x1a9)]-0x1;_0x966221>=0x0;_0x966221--)if(_0x1a07d2=_0x40aa81[_0x966221])_0x491e01=(_0x17a3d5<0x3?_0x1a07d2(_0x491e01):_0x17a3d5>0x3?_0x1a07d2(_0x4073f7,_0x417d9d,_0x491e01):_0x1a07d2(_0x4073f7,_0x417d9d))||_0x491e01;}return _0x17a3d5>0x3&&_0x491e01&&Object['defineProperty'](_0x4073f7,_0x417d9d,_0x491e01),_0x491e01;},__metadata=this&&this[a237_0x172fef(0x1bd)]||function(_0x27e9f1,_0x1490eb){const _0x298ff7=a237_0x172fef;if(typeof Reflect===_0x298ff7(0x1b5)&&typeof Reflect['metadata']===_0x298ff7(0x186))return Reflect[_0x298ff7(0x165)](_0x27e9f1,_0x1490eb);};Object[a237_0x172fef(0x170)](exports,a237_0x172fef(0x1b3),{'value':!![]}),exports[a237_0x172fef(0x16e)]=void 0x0;function a237_0x413a(_0x543e19,_0x47e60b){const _0x25a7cb=a237_0x22bf();return a237_0x413a=function(_0x520b15,_0x22ec67){_0x520b15=_0x520b15-0x165;let _0x22bf87=_0x25a7cb[_0x520b15];return _0x22bf87;},a237_0x413a(_0x543e19,_0x47e60b);}const typedi_1=require(a237_0x172fef(0x19a)),constants_1=require(a237_0x172fef(0x1b9)),errors_1=require(a237_0x172fef(0x19d)),utils_1=require(a237_0x172fef(0x17b)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a237_0x172fef(0x18e)),salesforce_query_service_1=require(a237_0x172fef(0x1a6)),salesforce_service_1=require(a237_0x172fef(0x1a0));function a237_0x22bf(){const _0x4bb582=['1298145IqMvzw','getAttachmentId','createObject','design:paramtypes','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','updateRemoteState','function','getRepositoryRecordByName','Connection__c','replace','__decorate','\x0a\x20\x20\x20\x20\x20\x20','push','Synchronization_Status__c','../queries','disableSync','789050BbiMSa','salesforceService','apply','\x20not\x20found\x20on\x20salesforce','SalesforceNotFoundError','Repository__r','constructor','records','44UJBpCm','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','typedi','SYNC_ATTACHMENT_FOR_BRANCH_NAME','192366FNKHdc','../../../../constants/errors','find','9TrJrEa','./salesforce.service','getRepositoryRecord','133yJZPBA','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','decorate','patchObject','./salesforce-query.service','encodeBase64','getAllRepositoryNames','length','GET_BRANCH_QUERY','getRepositoryRecords','Sync_In_Progress__c','search','4808079NZJUEY','589255HhIlFm','map','FLOSUM_NAMESPACE','fromBranchRecord','__esModule','GET_BRANCH_BY_NAME_QUERY','object','getBranchComponents','setStatus','GET_REPOSITORIES_NAMES_QUERY','../../../../constants','objectType','fromRepositoryRecord','SalesforceService','__metadata','repositoryId','GET_REPOSITORY_BY_NAME_QUERY','getComponentsFromRepository','metadata','salesforceQuery','getBranchRecordByName','(((.+)+)+)+$','toString','getOwnPropertyDescriptor','GET_COMPONENTS_QUERY','Repository\x20with\x20Id\x20','FlosumRepositorySyncDto','SalesforceSyncService','GET_WAITING_BRANCHES_QUERY','defineProperty','getBranchRecord','%id%','FLOSUM_GIT_NAMESPACE','Branch_Name__c','%name%','Attachment','query','45432250MItbiO','objectId','catch','../../../shared/utils','getComponents','1491160tYOMXc','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Repository\x20'];a237_0x22bf=function(){return _0x4bb582;};return a237_0x22bf();}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x175e52,_0xa214b0){this['salesforceQuery']=_0x175e52,this['salesforceService']=_0xa214b0;}async[a237_0x172fef(0x17c)](_0x37148e){const _0x5b1739=a237_0x172fef;var _0x2eccb8;const _0x38a19e=await this[_0x5b1739(0x166)][_0x5b1739(0x177)](_0x37148e),_0x50d37b=[];for(const _0x253a1e of _0x38a19e){const _0x33c707=(_0x2eccb8=_0x253a1e[constants_1['FLOSUM_NAMESPACE']+'Components__r'])===null||_0x2eccb8===void 0x0?void 0x0:_0x2eccb8[_0x5b1739(0x197)];_0x33c707&&_0x33c707[_0x5b1739(0x1a9)]&&_0x50d37b[_0x5b1739(0x18c)](_0x33c707[0x0]['Id']);}return _0x50d37b;}async[a237_0x172fef(0x1a8)](_0x424b18){const _0x478e97=a237_0x172fef,_0x4123ab=await this[_0x478e97(0x166)][_0x478e97(0x177)](queries_1[_0x478e97(0x1b8)][_0x478e97(0x189)](/\%connection_id\%/g,_0x424b18));return _0x4123ab[_0x478e97(0x1b0)](_0x256353=>{const _0x2c0adb=_0x478e97;return _0x256353[constants_1[_0x2c0adb(0x173)]+_0x2c0adb(0x195)]?_0x256353[constants_1['FLOSUM_GIT_NAMESPACE']+_0x2c0adb(0x195)]['Name']:_0x256353['Name'];});}async[a237_0x172fef(0x1ab)](_0x52b943){const _0x5db972=a237_0x172fef,_0x3b8269=await this['salesforceQuery'][_0x5db972(0x177)](queries_1['GET_WAITING_REPOSITORIES_QUERY'][_0x5db972(0x189)](/\%connection_id\%/g,_0x52b943));return _0x3b8269['map'](_0x5d4f37=>flosum_repository_sync_dto_1[_0x5db972(0x16d)][_0x5db972(0x1bb)](_0x5d4f37));}async['getBranchRecords'](_0x524cf1){const _0x3615c4=a237_0x172fef,_0x35f332=await this[_0x3615c4(0x166)][_0x3615c4(0x177)](queries_1[_0x3615c4(0x16f)][_0x3615c4(0x189)](/%repositories_ids\%/g,_0x524cf1));return _0x35f332[_0x3615c4(0x1b0)](_0x51b6c8=>flosum_repository_sync_dto_1[_0x3615c4(0x16d)][_0x3615c4(0x1b2)](_0x51b6c8));}async[a237_0x172fef(0x1a1)](_0x4e62ad){const _0x22a9e4=a237_0x172fef,_0x10c768=await this[_0x22a9e4(0x166)][_0x22a9e4(0x177)](queries_1['GET_REPOSITORY_QUERY'][_0x22a9e4(0x189)](_0x22a9e4(0x172),_0x4e62ad));if(_0x10c768[_0x22a9e4(0x1a9)]===0x0)throw new not_found_error_1[(_0x22a9e4(0x194))](_0x22a9e4(0x16c)+_0x4e62ad+_0x22a9e4(0x193));return flosum_repository_sync_dto_1[_0x22a9e4(0x16d)][_0x22a9e4(0x1bb)](_0x10c768[0x0]);}async[a237_0x172fef(0x171)](_0x5a0a3b){const _0x1789a5=a237_0x172fef,_0x2aedd7=await this['salesforceQuery']['query'](queries_1[_0x1789a5(0x1aa)][_0x1789a5(0x189)](_0x1789a5(0x172),_0x5a0a3b));if(_0x2aedd7[_0x1789a5(0x1a9)]===0x0)throw new not_found_error_1[(_0x1789a5(0x194))]('Branch\x20with\x20Id\x20'+_0x5a0a3b+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x1789a5(0x1b2)](_0x2aedd7[0x0]);}async[a237_0x172fef(0x167)](_0x4e2e1a){const _0x4c63c0=a237_0x172fef,_0x15ece5=await this['salesforceQuery']['query'](queries_1[_0x4c63c0(0x1b4)][_0x4c63c0(0x189)](_0x4c63c0(0x175),_0x4e2e1a));if(_0x15ece5[_0x4c63c0(0x1a9)]===0x0)throw new not_found_error_1[(_0x4c63c0(0x194))]('Branch\x20'+_0x4e2e1a+'\x20not\x20found\x20on\x20salesforce');const _0x57e678=_0x15ece5[_0x4c63c0(0x19e)](_0x533ce4=>_0x533ce4[constants_1[_0x4c63c0(0x1b1)]+_0x4c63c0(0x174)]===_0x4e2e1a);if(!_0x57e678)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x4e2e1a+_0x4c63c0(0x193));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x4c63c0(0x1b2)](_0x57e678);}async[a237_0x172fef(0x187)](_0x5dcd2c){const _0x3b759d=a237_0x172fef,_0x273e2e=await this['salesforceQuery']['query'](queries_1[_0x3b759d(0x1bf)][_0x3b759d(0x189)]('%name%',_0x5dcd2c));if(_0x273e2e[_0x3b759d(0x1a9)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x3b759d(0x17f)+_0x5dcd2c+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x3b759d(0x16d)][_0x3b759d(0x1bb)](_0x273e2e[0x0]);}async[a237_0x172fef(0x1c0)](_0xce23ab){const _0x4c9e93=a237_0x172fef,_0x26545d=_0x4c9e93(0x18b)+queries_1[_0x4c9e93(0x16b)]+_0x4c9e93(0x199)+_0xce23ab+'\x27';return this['getComponents'](_0x26545d);}async[a237_0x172fef(0x1b6)](_0x3b242f){const _0xd28383=a237_0x172fef,_0x18d3ee=_0xd28383(0x17e)+queries_1[_0xd28383(0x16b)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x3b242f+'\x27';return this[_0xd28383(0x17c)](_0x18d3ee);}async[a237_0x172fef(0x181)](_0x307a3c){const _0x30e853=a237_0x172fef;var _0x240ffb;const _0x3ed0c7=queries_1[_0x30e853(0x184)][_0x30e853(0x189)]('%parentId%',_0x307a3c[_0x30e853(0x179)])[_0x30e853(0x189)](_0x30e853(0x175),_0x307a3c[_0x30e853(0x1be)]?constants_1[_0x30e853(0x1a3)]:constants_1[_0x30e853(0x19b)]),_0x1c201d=await this[_0x30e853(0x166)]['query'](_0x3ed0c7),_0x1a834a=(_0x240ffb=_0x1c201d[0x0])===null||_0x240ffb===void 0x0?void 0x0:_0x240ffb['Id'];if(!_0x1a834a)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x1a834a;}async['getRemoteStateAttachmentId'](_0x5567e9){const _0x1942ee=a237_0x172fef;let _0x167883=await this[_0x1942ee(0x181)](_0x5567e9)[_0x1942ee(0x17a)](()=>null);return!_0x167883&&(_0x167883=await this[_0x1942ee(0x191)][_0x1942ee(0x182)](_0x1942ee(0x176),{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x5567e9[_0x1942ee(0x179)],'ContentType':'text/plain','Name':_0x5567e9[_0x1942ee(0x1be)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x1942ee(0x19b)]})),_0x167883;}async[a237_0x172fef(0x185)](_0xa0c74a,_0x1b8e8f){const _0x5df8d5=a237_0x172fef,_0x4eb085=await this['getRemoteStateAttachmentId'](_0xa0c74a);await this[_0x5df8d5(0x191)][_0x5df8d5(0x1a5)](_0x5df8d5(0x176),_0x4eb085,{'Body':(0x0,utils_1[_0x5df8d5(0x1a7)])(JSON['stringify'](_0x1b8e8f))});}async[a237_0x172fef(0x1b7)](_0x5aa05a,_0x2d9347){const _0x3bd1fd=a237_0x172fef;await this[_0x3bd1fd(0x191)][_0x3bd1fd(0x1a5)](_0x5aa05a[_0x3bd1fd(0x1ba)],_0x5aa05a[_0x3bd1fd(0x179)],{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x3bd1fd(0x18d)]:_0x2d9347});}async[a237_0x172fef(0x18f)](_0x34cc63){const _0xde5a11=a237_0x172fef;await this['salesforceService'][_0xde5a11(0x1a5)](constants_1[_0xde5a11(0x173)]+_0xde5a11(0x188),_0x34cc63,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0xde5a11(0x1ac)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1['Service'])(),__metadata(a237_0x172fef(0x183),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a237_0x172fef(0x1bc)]])],SalesforceSyncService),exports[a237_0x172fef(0x16e)]=SalesforceSyncService;