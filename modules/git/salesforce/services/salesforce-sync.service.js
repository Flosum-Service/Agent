const a238_0x191bec=a238_0x1956;(function(_0x4c7975,_0xcc435c){const _0x50b5c3=a238_0x1956,_0x575cde=_0x4c7975();while(!![]){try{const _0x385cca=-parseInt(_0x50b5c3(0x1c0))/0x1+parseInt(_0x50b5c3(0x1d4))/0x2+-parseInt(_0x50b5c3(0x1a9))/0x3+-parseInt(_0x50b5c3(0x1d8))/0x4+-parseInt(_0x50b5c3(0x199))/0x5*(parseInt(_0x50b5c3(0x1ac))/0x6)+-parseInt(_0x50b5c3(0x1a1))/0x7*(-parseInt(_0x50b5c3(0x1e1))/0x8)+-parseInt(_0x50b5c3(0x1a2))/0x9*(-parseInt(_0x50b5c3(0x1b3))/0xa);if(_0x385cca===_0xcc435c)break;else _0x575cde['push'](_0x575cde['shift']());}catch(_0x872ac1){_0x575cde['push'](_0x575cde['shift']());}}}(a238_0x5716,0xe2e6f));const a238_0x2367fa=(function(){let _0x4625ca=!![];return function(_0x2c072d,_0x5b5a49){const _0x2b54bb=_0x4625ca?function(){const _0x3deb2d=a238_0x1956;if(_0x5b5a49){const _0x20d214=_0x5b5a49[_0x3deb2d(0x19e)](_0x2c072d,arguments);return _0x5b5a49=null,_0x20d214;}}:function(){};return _0x4625ca=![],_0x2b54bb;};}()),a238_0x55a184=a238_0x2367fa(this,function(){const _0x17adc6=a238_0x1956;return a238_0x55a184[_0x17adc6(0x1c1)]()[_0x17adc6(0x1ae)]('(((.+)+)+)+$')[_0x17adc6(0x1c1)]()[_0x17adc6(0x1a7)](a238_0x55a184)[_0x17adc6(0x1ae)](_0x17adc6(0x1bc));});a238_0x55a184();'use strict';var __decorate=this&&this['__decorate']||function(_0x388835,_0x348466,_0x425e78,_0x5b766b){const _0x41f9e3=a238_0x1956;var _0x4f3dc2=arguments[_0x41f9e3(0x1e2)],_0x1f4575=_0x4f3dc2<0x3?_0x348466:_0x5b766b===null?_0x5b766b=Object[_0x41f9e3(0x198)](_0x348466,_0x425e78):_0x5b766b,_0x258c39;if(typeof Reflect==='object'&&typeof Reflect[_0x41f9e3(0x1eb)]===_0x41f9e3(0x1df))_0x1f4575=Reflect[_0x41f9e3(0x1eb)](_0x388835,_0x348466,_0x425e78,_0x5b766b);else{for(var _0x48c953=_0x388835[_0x41f9e3(0x1e2)]-0x1;_0x48c953>=0x0;_0x48c953--)if(_0x258c39=_0x388835[_0x48c953])_0x1f4575=(_0x4f3dc2<0x3?_0x258c39(_0x1f4575):_0x4f3dc2>0x3?_0x258c39(_0x348466,_0x425e78,_0x1f4575):_0x258c39(_0x348466,_0x425e78))||_0x1f4575;}return _0x4f3dc2>0x3&&_0x1f4575&&Object['defineProperty'](_0x348466,_0x425e78,_0x1f4575),_0x1f4575;},__metadata=this&&this[a238_0x191bec(0x1e0)]||function(_0x53affb,_0x364d06){const _0x3d99b2=a238_0x191bec;if(typeof Reflect===_0x3d99b2(0x1d7)&&typeof Reflect[_0x3d99b2(0x1a6)]===_0x3d99b2(0x1df))return Reflect[_0x3d99b2(0x1a6)](_0x53affb,_0x364d06);};function a238_0x5716(){const _0x4190dd=['object','6310744fxGuKV','typedi','patchObject','Attachment','salesforceService','Repository\x20','GET_BRANCH_BY_NAME_QUERY','function','__metadata','8tElOFP','length','query','text/plain','Connection__c','\x0a\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','Repository__r','%name%','stringify','decorate','records','fromRepositoryRecord','getOwnPropertyDescriptor','190RojNyv','SalesforceNotFoundError','Name','%id%','map','apply','encodeBase64','getBranchRecords','2535722RMsfly','6768081YEOMgI','getBranchRecord','getComponents','Sync_In_Progress__c','metadata','constructor','objectType','1962303PrgkVv','\x20not\x20found\x20on\x20salesforce','disableSync','257514WetyXT','getRemoteStateAttachmentId','search','defineProperty','GET_REPOSITORIES_NAMES_QUERY','GET_COMPONENTS_QUERY','getAttachmentId','60aUBTxN','Components__r','repositoryId','SYNC_ATTACHMENT_FOR_BRANCH_NAME','replace','getBranchRecordByName','getComponentsFromRepository','Branch\x20','getAllRepositoryNames','(((.+)+)+)+$','FlosumRepositorySyncDto','fromBranchRecord','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','1304040jceppc','toString','ERR_INVALID_ATTACHMENT_ID','__esModule','salesforceQuery','SalesforceSyncService','./salesforce.service','./salesforce-query.service','FLOSUM_GIT_NAMESPACE','FLOSUM_NAMESPACE','../errors/not-found.error','design:paramtypes','SalesforceQueryService','catch','objectId','%parentId%','GET_REPOSITORY_BY_NAME_QUERY','updateRemoteState','getRepositoryRecords','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','2443680eXnyDp','../dto/flosum-repository-sync.dto','Service'];a238_0x5716=function(){return _0x4190dd;};return a238_0x5716();}Object[a238_0x191bec(0x1af)](exports,a238_0x191bec(0x1c3),{'value':!![]}),exports[a238_0x191bec(0x1c5)]=void 0x0;const typedi_1=require(a238_0x191bec(0x1d9)),constants_1=require('../../../../constants'),errors_1=require('../../../../constants/errors'),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a238_0x191bec(0x1d5)),not_found_error_1=require(a238_0x191bec(0x1ca)),queries_1=require('../queries'),salesforce_query_service_1=require(a238_0x191bec(0x1c7)),salesforce_service_1=require(a238_0x191bec(0x1c6));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x44e4ce,_0x3336c7){const _0x376621=a238_0x191bec;this[_0x376621(0x1c4)]=_0x44e4ce,this[_0x376621(0x1dc)]=_0x3336c7;}async[a238_0x191bec(0x1a4)](_0x132eaa){const _0xf54143=a238_0x191bec;var _0x39ce1f;const _0x37f855=await this[_0xf54143(0x1c4)][_0xf54143(0x1e3)](_0x132eaa),_0x159244=[];for(const _0xaa7aea of _0x37f855){const _0x1bba81=(_0x39ce1f=_0xaa7aea[constants_1[_0xf54143(0x1c9)]+_0xf54143(0x1b4)])===null||_0x39ce1f===void 0x0?void 0x0:_0x39ce1f[_0xf54143(0x196)];_0x1bba81&&_0x1bba81[_0xf54143(0x1e2)]&&_0x159244['push'](_0x1bba81[0x0]['Id']);}return _0x159244;}async[a238_0x191bec(0x1bb)](_0x4b8288){const _0x5923fd=a238_0x191bec,_0x1afcb5=await this[_0x5923fd(0x1c4)]['query'](queries_1[_0x5923fd(0x1b0)][_0x5923fd(0x1b7)](/\%connection_id\%/g,_0x4b8288));return _0x1afcb5['map'](_0x410bcc=>{const _0x1b48d7=_0x5923fd;return _0x410bcc[constants_1[_0x1b48d7(0x1c8)]+_0x1b48d7(0x1e8)]?_0x410bcc[constants_1[_0x1b48d7(0x1c8)]+_0x1b48d7(0x1e8)][_0x1b48d7(0x19b)]:_0x410bcc[_0x1b48d7(0x19b)];});}async[a238_0x191bec(0x1d2)](_0x42b056){const _0x1cf887=a238_0x191bec,_0x4c5e2a=await this[_0x1cf887(0x1c4)]['query'](queries_1['GET_WAITING_REPOSITORIES_QUERY']['replace'](/\%connection_id\%/g,_0x42b056));return _0x4c5e2a['map'](_0x5af8fd=>flosum_repository_sync_dto_1[_0x1cf887(0x1bd)]['fromRepositoryRecord'](_0x5af8fd));}async[a238_0x191bec(0x1a0)](_0x30e9a0){const _0x59664d=a238_0x191bec,_0x42d74f=await this[_0x59664d(0x1c4)][_0x59664d(0x1e3)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x59664d(0x1b7)](/%repositories_ids\%/g,_0x30e9a0));return _0x42d74f[_0x59664d(0x19d)](_0x2e4929=>flosum_repository_sync_dto_1[_0x59664d(0x1bd)][_0x59664d(0x1be)](_0x2e4929));}async['getRepositoryRecord'](_0x2ea100){const _0x3e5033=a238_0x191bec,_0x336d83=await this['salesforceQuery'][_0x3e5033(0x1e3)](queries_1['GET_REPOSITORY_QUERY'][_0x3e5033(0x1b7)](_0x3e5033(0x19c),_0x2ea100));if(_0x336d83[_0x3e5033(0x1e2)]===0x0)throw new not_found_error_1[(_0x3e5033(0x19a))]('Repository\x20with\x20Id\x20'+_0x2ea100+_0x3e5033(0x1aa));return flosum_repository_sync_dto_1[_0x3e5033(0x1bd)][_0x3e5033(0x197)](_0x336d83[0x0]);}async[a238_0x191bec(0x1a3)](_0x44e598){const _0x1e20d5=a238_0x191bec,_0x360fcb=await this[_0x1e20d5(0x1c4)]['query'](queries_1['GET_BRANCH_QUERY'][_0x1e20d5(0x1b7)]('%id%',_0x44e598));if(_0x360fcb[_0x1e20d5(0x1e2)]===0x0)throw new not_found_error_1[(_0x1e20d5(0x19a))]('Branch\x20with\x20Id\x20'+_0x44e598+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x1e20d5(0x1bd)]['fromBranchRecord'](_0x360fcb[0x0]);}async[a238_0x191bec(0x1b8)](_0x56cba5){const _0x421974=a238_0x191bec,_0x193524=await this[_0x421974(0x1c4)][_0x421974(0x1e3)](queries_1[_0x421974(0x1de)][_0x421974(0x1b7)](_0x421974(0x1e9),_0x56cba5));if(_0x193524[_0x421974(0x1e2)]===0x0)throw new not_found_error_1[(_0x421974(0x19a))](_0x421974(0x1ba)+_0x56cba5+_0x421974(0x1aa));const _0x5443ef=_0x193524['find'](_0x3b3305=>_0x3b3305[constants_1[_0x421974(0x1c9)]+'Branch_Name__c']===_0x56cba5);if(!_0x5443ef)throw new not_found_error_1[(_0x421974(0x19a))](_0x421974(0x1ba)+_0x56cba5+_0x421974(0x1aa));return flosum_repository_sync_dto_1[_0x421974(0x1bd)][_0x421974(0x1be)](_0x5443ef);}async['getRepositoryRecordByName'](_0x811df4){const _0x47beee=a238_0x191bec,_0x5c886d=await this['salesforceQuery'][_0x47beee(0x1e3)](queries_1[_0x47beee(0x1d0)]['replace'](_0x47beee(0x1e9),_0x811df4));if(_0x5c886d[_0x47beee(0x1e2)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x47beee(0x1dd)+_0x811df4+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x47beee(0x1bd)]['fromRepositoryRecord'](_0x5c886d[0x0]);}async[a238_0x191bec(0x1b9)](_0x5299a5){const _0x48d6d7=a238_0x191bec,_0x2028af=_0x48d6d7(0x1e6)+queries_1['GET_COMPONENTS_QUERY']+_0x48d6d7(0x1bf)+_0x5299a5+'\x27';return this[_0x48d6d7(0x1a4)](_0x2028af);}async['getBranchComponents'](_0x516d66){const _0x21389a=a238_0x191bec,_0x22000b='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x21389a(0x1b1)]+_0x21389a(0x1e7)+_0x516d66+'\x27';return this[_0x21389a(0x1a4)](_0x22000b);}async[a238_0x191bec(0x1b2)](_0xb97e1){const _0x5af36e=a238_0x191bec;var _0x421b6f;const _0x243713=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY']['replace'](_0x5af36e(0x1cf),_0xb97e1['objectId'])[_0x5af36e(0x1b7)](_0x5af36e(0x1e9),_0xb97e1['repositoryId']?constants_1[_0x5af36e(0x1d3)]:constants_1[_0x5af36e(0x1b6)]),_0x416420=await this[_0x5af36e(0x1c4)][_0x5af36e(0x1e3)](_0x243713),_0x4396eb=(_0x421b6f=_0x416420[0x0])===null||_0x421b6f===void 0x0?void 0x0:_0x421b6f['Id'];if(!_0x4396eb)throw new Error(errors_1[_0x5af36e(0x1c2)]);return _0x4396eb;}async[a238_0x191bec(0x1ad)](_0x3bbdd5){const _0x4fff3e=a238_0x191bec;let _0x23da46=await this['getAttachmentId'](_0x3bbdd5)[_0x4fff3e(0x1cd)](()=>null);return!_0x23da46&&(_0x23da46=await this['salesforceService']['createObject'](_0x4fff3e(0x1db),{'Body':(0x0,utils_1[_0x4fff3e(0x19f)])('{}'),'ParentId':_0x3bbdd5[_0x4fff3e(0x1ce)],'ContentType':_0x4fff3e(0x1e4),'Name':_0x3bbdd5[_0x4fff3e(0x1b5)]?constants_1[_0x4fff3e(0x1d3)]:constants_1[_0x4fff3e(0x1b6)]})),_0x23da46;}async[a238_0x191bec(0x1d1)](_0x3fd4aa,_0x36745a){const _0xe94c4a=a238_0x191bec,_0x2ac066=await this[_0xe94c4a(0x1ad)](_0x3fd4aa);await this[_0xe94c4a(0x1dc)][_0xe94c4a(0x1da)]('Attachment',_0x2ac066,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0xe94c4a(0x1ea)](_0x36745a))});}async['setStatus'](_0x5d566e,_0x18be0e){const _0x56ae4b=a238_0x191bec;await this['salesforceService'][_0x56ae4b(0x1da)](_0x5d566e[_0x56ae4b(0x1a8)],_0x5d566e[_0x56ae4b(0x1ce)],{[constants_1['FLOSUM_GIT_NAMESPACE']+'Synchronization_Status__c']:_0x18be0e});}async[a238_0x191bec(0x1ab)](_0x10b72f){const _0x59b67f=a238_0x191bec;await this[_0x59b67f(0x1dc)][_0x59b67f(0x1da)](constants_1[_0x59b67f(0x1c8)]+_0x59b67f(0x1e5),_0x10b72f,{[constants_1[_0x59b67f(0x1c8)]+_0x59b67f(0x1a5)]:![]});}};function a238_0x1956(_0x3fbd7a,_0x3e332a){const _0x69e721=a238_0x5716();return a238_0x1956=function(_0x55a184,_0x2367fa){_0x55a184=_0x55a184-0x196;let _0x571637=_0x69e721[_0x55a184];return _0x571637;},a238_0x1956(_0x3fbd7a,_0x3e332a);}SalesforceSyncService=__decorate([(0x0,typedi_1[a238_0x191bec(0x1d6)])(),__metadata(a238_0x191bec(0x1cb),[salesforce_query_service_1[a238_0x191bec(0x1cc)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;