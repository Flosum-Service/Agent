const a270_0x4b7774=a270_0x24c7;(function(_0x30918a,_0x1f1a86){const _0x18f70e=a270_0x24c7,_0x39f62c=_0x30918a();while(!![]){try{const _0x23e0db=-parseInt(_0x18f70e(0x1fb))/0x1+parseInt(_0x18f70e(0x215))/0x2+-parseInt(_0x18f70e(0x225))/0x3*(-parseInt(_0x18f70e(0x1fc))/0x4)+-parseInt(_0x18f70e(0x1db))/0x5+-parseInt(_0x18f70e(0x1d9))/0x6+parseInt(_0x18f70e(0x1f3))/0x7*(parseInt(_0x18f70e(0x1d7))/0x8)+parseInt(_0x18f70e(0x1d3))/0x9;if(_0x23e0db===_0x1f1a86)break;else _0x39f62c['push'](_0x39f62c['shift']());}catch(_0x3b1e1e){_0x39f62c['push'](_0x39f62c['shift']());}}}(a270_0x176b,0x33892));const a270_0x39b6f1=(function(){let _0x143f84=!![];return function(_0x2759c0,_0x1273e4){const _0x3cc763=_0x143f84?function(){if(_0x1273e4){const _0xfb196c=_0x1273e4['apply'](_0x2759c0,arguments);return _0x1273e4=null,_0xfb196c;}}:function(){};return _0x143f84=![],_0x3cc763;};}()),a270_0x522417=a270_0x39b6f1(this,function(){const _0x1e2807=a270_0x24c7;return a270_0x522417[_0x1e2807(0x228)]()[_0x1e2807(0x1f8)](_0x1e2807(0x1d5))[_0x1e2807(0x228)]()[_0x1e2807(0x22a)](a270_0x522417)[_0x1e2807(0x1f8)]('(((.+)+)+)+$');});function a270_0x24c7(_0x53a13f,_0xdf58c6){const _0x56db2c=a270_0x176b();return a270_0x24c7=function(_0x522417,_0x39b6f1){_0x522417=_0x522417-0x1d1;let _0x176b30=_0x56db2c[_0x522417];return _0x176b30;},a270_0x24c7(_0x53a13f,_0xdf58c6);}a270_0x522417();'use strict';var __decorate=this&&this[a270_0x4b7774(0x210)]||function(_0x1fad69,_0x2d4911,_0xa52faf,_0x4f92cb){const _0xd2384c=a270_0x4b7774;var _0x4da1be=arguments['length'],_0x25323e=_0x4da1be<0x3?_0x2d4911:_0x4f92cb===null?_0x4f92cb=Object[_0xd2384c(0x1de)](_0x2d4911,_0xa52faf):_0x4f92cb,_0x80983a;if(typeof Reflect===_0xd2384c(0x1e7)&&typeof Reflect[_0xd2384c(0x21d)]===_0xd2384c(0x20b))_0x25323e=Reflect[_0xd2384c(0x21d)](_0x1fad69,_0x2d4911,_0xa52faf,_0x4f92cb);else{for(var _0x3a6ecd=_0x1fad69['length']-0x1;_0x3a6ecd>=0x0;_0x3a6ecd--)if(_0x80983a=_0x1fad69[_0x3a6ecd])_0x25323e=(_0x4da1be<0x3?_0x80983a(_0x25323e):_0x4da1be>0x3?_0x80983a(_0x2d4911,_0xa52faf,_0x25323e):_0x80983a(_0x2d4911,_0xa52faf))||_0x25323e;}return _0x4da1be>0x3&&_0x25323e&&Object[_0xd2384c(0x221)](_0x2d4911,_0xa52faf,_0x25323e),_0x25323e;},__metadata=this&&this['__metadata']||function(_0x15b51a,_0xe2465b){const _0x34ae13=a270_0x4b7774;if(typeof Reflect===_0x34ae13(0x1e7)&&typeof Reflect[_0x34ae13(0x226)]===_0x34ae13(0x20b))return Reflect['metadata'](_0x15b51a,_0xe2465b);};Object[a270_0x4b7774(0x221)](exports,'__esModule',{'value':!![]}),exports[a270_0x4b7774(0x1fe)]=void 0x0;const typedi_1=require(a270_0x4b7774(0x1e5)),constants_1=require(a270_0x4b7774(0x1d2)),errors_1=require('../../../../constants/errors'),utils_1=require(a270_0x4b7774(0x201)),flosum_repository_sync_dto_1=require(a270_0x4b7774(0x200)),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a270_0x4b7774(0x1d1)),salesforce_query_service_1=require(a270_0x4b7774(0x203)),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0x2ffbf2,_0x7bd16e){const _0x3cbf3f=a270_0x4b7774;this['salesforceQuery']=_0x2ffbf2,this[_0x3cbf3f(0x212)]=_0x7bd16e;}async[a270_0x4b7774(0x213)](_0x551915){const _0x460f5b=a270_0x4b7774;var _0x5e5a53;const _0x140666=await this['salesforceQuery'][_0x460f5b(0x21e)](_0x551915),_0x4be430=[];for(const _0x80a6c7 of _0x140666){const _0x5c0d74=(_0x5e5a53=_0x80a6c7[constants_1[_0x460f5b(0x1fa)]+'Components__r'])===null||_0x5e5a53===void 0x0?void 0x0:_0x5e5a53['records'];_0x5c0d74&&_0x5c0d74['length']&&_0x4be430[_0x460f5b(0x202)](_0x5c0d74[0x0]['Id']);}return _0x4be430;}async['getAllRepositoryNames'](_0x124b60){const _0xb06553=a270_0x4b7774,_0x2e913d=await this[_0xb06553(0x1d6)][_0xb06553(0x21e)](queries_1[_0xb06553(0x205)][_0xb06553(0x1fd)](/\%connection_id\%/g,_0x124b60));return _0x2e913d[_0xb06553(0x223)](_0x49ec1d=>{const _0x3e0481=_0xb06553;return _0x49ec1d[constants_1[_0x3e0481(0x1ff)]+'Repository__r']?_0x49ec1d[constants_1['FLOSUM_GIT_NAMESPACE']+_0x3e0481(0x207)][_0x3e0481(0x208)]:_0x49ec1d[_0x3e0481(0x208)];});}async[a270_0x4b7774(0x1f5)](_0x3a9ebb){const _0x46e6ae=a270_0x4b7774,_0x2e5a09=await this['salesforceQuery'][_0x46e6ae(0x21e)](queries_1[_0x46e6ae(0x218)]['replace'](/\%connection_id\%/g,_0x3a9ebb));return _0x2e5a09[_0x46e6ae(0x223)](_0x26211d=>flosum_repository_sync_dto_1[_0x46e6ae(0x1f7)][_0x46e6ae(0x1e2)](_0x26211d));}async['getBranchRecords'](_0x11a312){const _0x55d33e=a270_0x4b7774,_0x3023fe=await this['salesforceQuery'][_0x55d33e(0x21e)](queries_1[_0x55d33e(0x206)][_0x55d33e(0x1fd)](/%repositories_ids\%/g,_0x11a312));return _0x3023fe[_0x55d33e(0x223)](_0x4394e1=>flosum_repository_sync_dto_1[_0x55d33e(0x1f7)][_0x55d33e(0x1df)](_0x4394e1));}async['getRepositoryRecord'](_0x14f595){const _0x485f17=a270_0x4b7774,_0x47b5bb=await this[_0x485f17(0x1d6)]['query'](queries_1[_0x485f17(0x229)]['replace'](_0x485f17(0x1ec),_0x14f595));if(_0x47b5bb['length']===0x0)throw new not_found_error_1[(_0x485f17(0x1e6))](_0x485f17(0x1ee)+_0x14f595+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x485f17(0x1f7)]['fromRepositoryRecord'](_0x47b5bb[0x0]);}async[a270_0x4b7774(0x20e)](_0x3ec17e){const _0x369ce4=a270_0x4b7774,_0x287e6c=await this[_0x369ce4(0x1d6)][_0x369ce4(0x21e)](queries_1[_0x369ce4(0x1e1)][_0x369ce4(0x1fd)](_0x369ce4(0x1ec),_0x3ec17e));if(_0x287e6c[_0x369ce4(0x21b)]===0x0)throw new not_found_error_1[(_0x369ce4(0x1e6))](_0x369ce4(0x21f)+_0x3ec17e+_0x369ce4(0x1d8));return flosum_repository_sync_dto_1[_0x369ce4(0x1f7)][_0x369ce4(0x1df)](_0x287e6c[0x0]);}async[a270_0x4b7774(0x204)](_0x4de133){const _0x3611b3=a270_0x4b7774,_0x4caab1=await this[_0x3611b3(0x1d6)][_0x3611b3(0x21e)](queries_1['GET_BRANCH_BY_NAME_QUERY']['replace']('%name%',_0x4de133));if(_0x4caab1['length']===0x0)throw new not_found_error_1[(_0x3611b3(0x1e6))](_0x3611b3(0x20c)+_0x4de133+_0x3611b3(0x1d8));const _0x4f96d8=_0x4caab1[_0x3611b3(0x216)](_0x54d78b=>_0x54d78b[constants_1[_0x3611b3(0x1fa)]+_0x3611b3(0x1e4)]===_0x4de133);if(!_0x4f96d8)throw new not_found_error_1[(_0x3611b3(0x1e6))](_0x3611b3(0x20c)+_0x4de133+_0x3611b3(0x1d8));return flosum_repository_sync_dto_1[_0x3611b3(0x1f7)]['fromBranchRecord'](_0x4f96d8);}async[a270_0x4b7774(0x214)](_0x4fba53){const _0x13a427=a270_0x4b7774,_0xa14ccc=await this[_0x13a427(0x1d6)][_0x13a427(0x21e)](queries_1[_0x13a427(0x217)][_0x13a427(0x1fd)](_0x13a427(0x222),_0x4fba53));if(_0xa14ccc[_0x13a427(0x21b)]===0x0)throw new not_found_error_1[(_0x13a427(0x1e6))](_0x13a427(0x21a)+_0x4fba53+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x13a427(0x1f7)][_0x13a427(0x1e2)](_0xa14ccc[0x0]);}async[a270_0x4b7774(0x1f1)](_0x3c1c9a){const _0x486787=a270_0x4b7774,_0x26b4e6=_0x486787(0x209)+queries_1[_0x486787(0x20f)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x3c1c9a+'\x27';return this['getComponents'](_0x26b4e6);}async[a270_0x4b7774(0x227)](_0x5a1550){const _0x2a82e7=a270_0x4b7774,_0xaf4014=_0x2a82e7(0x224)+queries_1[_0x2a82e7(0x20f)]+_0x2a82e7(0x1e0)+_0x5a1550+'\x27';return this[_0x2a82e7(0x213)](_0xaf4014);}async[a270_0x4b7774(0x1e3)](_0x5da8c5){const _0x2b1fb1=a270_0x4b7774;var _0xf823e1;const _0x1244f4=queries_1[_0x2b1fb1(0x211)][_0x2b1fb1(0x1fd)](_0x2b1fb1(0x1eb),_0x5da8c5['objectId'])[_0x2b1fb1(0x1fd)](_0x2b1fb1(0x222),_0x5da8c5[_0x2b1fb1(0x1ed)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x2b1fb1(0x1f9)]),_0x3fd1a7=await this[_0x2b1fb1(0x1d6)][_0x2b1fb1(0x21e)](_0x1244f4),_0x194f49=(_0xf823e1=_0x3fd1a7[0x0])===null||_0xf823e1===void 0x0?void 0x0:_0xf823e1['Id'];if(!_0x194f49)throw new Error(errors_1[_0x2b1fb1(0x1f0)]);return _0x194f49;}async['getRemoteStateAttachmentId'](_0x5db926){const _0xf39ddb=a270_0x4b7774;let _0x22cc95=await this[_0xf39ddb(0x1e3)](_0x5db926)['catch'](()=>null);return!_0x22cc95&&(_0x22cc95=await this[_0xf39ddb(0x212)][_0xf39ddb(0x1d4)](_0xf39ddb(0x1f4),{'Body':(0x0,utils_1[_0xf39ddb(0x1dc)])('{}'),'ParentId':_0x5db926[_0xf39ddb(0x1f2)],'ContentType':_0xf39ddb(0x1da),'Name':_0x5db926[_0xf39ddb(0x1ed)]?constants_1[_0xf39ddb(0x220)]:constants_1[_0xf39ddb(0x1f9)]})),_0x22cc95;}async['updateRemoteState'](_0x584b87,_0x44e63e){const _0x430317=a270_0x4b7774,_0x19a6ad=await this['getRemoteStateAttachmentId'](_0x584b87);await this[_0x430317(0x212)]['patchObject'](_0x430317(0x1f4),_0x19a6ad,{'Body':(0x0,utils_1[_0x430317(0x1dc)])(JSON[_0x430317(0x20a)](_0x44e63e))});}async[a270_0x4b7774(0x1ef)](_0x4fe4c3,_0x136373){const _0x133299=a270_0x4b7774;await this[_0x133299(0x212)][_0x133299(0x21c)](_0x4fe4c3[_0x133299(0x1e9)],_0x4fe4c3[_0x133299(0x1f2)],{[constants_1[_0x133299(0x1ff)]+_0x133299(0x20d)]:_0x136373});}async[a270_0x4b7774(0x1dd)](_0x5457dc){const _0x22528b=a270_0x4b7774;await this[_0x22528b(0x212)][_0x22528b(0x21c)](constants_1[_0x22528b(0x1ff)]+_0x22528b(0x1f6),_0x5457dc,{[constants_1[_0x22528b(0x1ff)]+_0x22528b(0x219)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a270_0x4b7774(0x1ea)])(),__metadata('design:paramtypes',[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a270_0x4b7774(0x1e8)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;function a270_0x176b(){const _0x295397=['encodeBase64','disableSync','getOwnPropertyDescriptor','fromBranchRecord','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','GET_BRANCH_QUERY','fromRepositoryRecord','getAttachmentId','Branch_Name__c','typedi','SalesforceNotFoundError','object','SalesforceService','objectType','Service','%parentId%','%id%','repositoryId','Repository\x20with\x20Id\x20','setStatus','ERR_INVALID_ATTACHMENT_ID','getComponentsFromRepository','objectId','183778zIzfWc','Attachment','getRepositoryRecords','Connection__c','FlosumRepositorySyncDto','search','SYNC_ATTACHMENT_FOR_BRANCH_NAME','FLOSUM_NAMESPACE','228277UkjyiI','4368HUcRTN','replace','SalesforceSyncService','FLOSUM_GIT_NAMESPACE','../dto/flosum-repository-sync.dto','../../../shared/utils','push','./salesforce-query.service','getBranchRecordByName','GET_REPOSITORIES_NAMES_QUERY','GET_WAITING_BRANCHES_QUERY','Repository__r','Name','\x0a\x20\x20\x20\x20\x20\x20','stringify','function','Branch\x20','Synchronization_Status__c','getBranchRecord','GET_COMPONENTS_QUERY','__decorate','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','salesforceService','getComponents','getRepositoryRecordByName','809180siKGwr','find','GET_REPOSITORY_BY_NAME_QUERY','GET_WAITING_REPOSITORIES_QUERY','Sync_In_Progress__c','Repository\x20','length','patchObject','decorate','query','Branch\x20with\x20Id\x20','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','defineProperty','%name%','map','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','201wXlKrj','metadata','getBranchComponents','toString','GET_REPOSITORY_QUERY','constructor','../queries','../../../../constants','1597446kHjhKS','createObject','(((.+)+)+)+$','salesforceQuery','112HTVgNC','\x20not\x20found\x20on\x20salesforce','1443294lrEcgg','text/plain','1714440aJDrNb'];a270_0x176b=function(){return _0x295397;};return a270_0x176b();}