const a281_0x3eaff8=a281_0x2912;(function(_0x28e25f,_0x39dce6){const _0x36093b=a281_0x2912,_0x5bcc1c=_0x28e25f();while(!![]){try{const _0x1ea8d1=parseInt(_0x36093b(0x101))/0x1*(-parseInt(_0x36093b(0x103))/0x2)+parseInt(_0x36093b(0xf0))/0x3+-parseInt(_0x36093b(0x129))/0x4*(parseInt(_0x36093b(0xea))/0x5)+parseInt(_0x36093b(0xfc))/0x6*(parseInt(_0x36093b(0x109))/0x7)+-parseInt(_0x36093b(0xd8))/0x8*(parseInt(_0x36093b(0xcb))/0x9)+parseInt(_0x36093b(0x12a))/0xa+parseInt(_0x36093b(0x123))/0xb*(-parseInt(_0x36093b(0x122))/0xc);if(_0x1ea8d1===_0x39dce6)break;else _0x5bcc1c['push'](_0x5bcc1c['shift']());}catch(_0x3b1338){_0x5bcc1c['push'](_0x5bcc1c['shift']());}}}(a281_0x2c50,0xce3e6));const a281_0x285d0f=(function(){let _0x51f564=!![];return function(_0x20dca7,_0x14c5b7){const _0x40fe45=_0x51f564?function(){if(_0x14c5b7){const _0x4639b8=_0x14c5b7['apply'](_0x20dca7,arguments);return _0x14c5b7=null,_0x4639b8;}}:function(){};return _0x51f564=![],_0x40fe45;};}()),a281_0x246141=a281_0x285d0f(this,function(){const _0x2425ce=a281_0x2912;return a281_0x246141[_0x2425ce(0x11c)]()[_0x2425ce(0x102)]('(((.+)+)+)+$')[_0x2425ce(0x11c)]()[_0x2425ce(0xde)](a281_0x246141)[_0x2425ce(0x102)](_0x2425ce(0x11a));});function a281_0x2c50(){const _0x8286d9=['__metadata','Repository\x20','../../../../constants/errors','find','function','length','Repository__r','metadata','Synchronization_Status__c','165CmKQwO','GET_WAITING_REPOSITORIES_QUERY','Branch\x20with\x20Id\x20','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','updateRemoteState','createObject','1828947LhnWDK','patchObject','getRepositoryRecord','ERR_INVALID_ATTACHMENT_ID','records','text/plain','getAllRepositoryNames','../dto/flosum-repository-sync.dto','GET_REPOSITORY_BY_NAME_QUERY','disableSync','%id%','encodeBase64','296952JdRLHK','getBranchComponents','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','typedi','GET_BRANCH_BY_NAME_QUERY','1992plSXsX','search','554ZQlvsl','decorate','GET_REPOSITORY_QUERY','query','object','GET_BRANCH_QUERY','217CKXgpU','map','Service','Attachment','Branch\x20','GET_REPOSITORIES_NAMES_QUERY','Connection__c','\x0a\x20\x20\x20\x20\x20\x20','replace','catch','getRepositoryRecordByName','salesforceService','salesforceQuery','defineProperty','SalesforceSyncService','design:paramtypes','%parentId%','(((.+)+)+)+$','SalesforceQueryService','toString','../errors/not-found.error','FLOSUM_GIT_NAMESPACE','../../../../constants','fromBranchRecord','getAttachmentId','24WTlMdp','3545278pyVHNv','./salesforce-query.service','objectId','repositoryId','getRepositoryRecords','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','127964FoZBnl','13911040hBDxSN','getComponents','\x20not\x20found\x20on\x20salesforce','Repository\x20with\x20Id\x20','36uJoXHL','getBranchRecordByName','%name%','getRemoteStateAttachmentId','Components__r','./salesforce.service','__esModule','setStatus','GET_WAITING_BRANCHES_QUERY','fromRepositoryRecord','SalesforceNotFoundError','FLOSUM_NAMESPACE','objectType','876296JzhZDp','getOwnPropertyDescriptor','GET_COMPONENTS_QUERY','FlosumRepositorySyncDto','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','SYNC_ATTACHMENT_FOR_BRANCH_NAME','constructor','SalesforceService','getBranchRecord'];a281_0x2c50=function(){return _0x8286d9;};return a281_0x2c50();}a281_0x246141();'use strict';var __decorate=this&&this['__decorate']||function(_0x1b9e11,_0x708ee5,_0x30fe72,_0x59f05e){const _0x5cdc5b=a281_0x2912;var _0x47c789=arguments[_0x5cdc5b(0xe6)],_0x402234=_0x47c789<0x3?_0x708ee5:_0x59f05e===null?_0x59f05e=Object[_0x5cdc5b(0xd9)](_0x708ee5,_0x30fe72):_0x59f05e,_0x52d0b5;if(typeof Reflect==='object'&&typeof Reflect[_0x5cdc5b(0x104)]===_0x5cdc5b(0xe5))_0x402234=Reflect[_0x5cdc5b(0x104)](_0x1b9e11,_0x708ee5,_0x30fe72,_0x59f05e);else{for(var _0x1659e0=_0x1b9e11[_0x5cdc5b(0xe6)]-0x1;_0x1659e0>=0x0;_0x1659e0--)if(_0x52d0b5=_0x1b9e11[_0x1659e0])_0x402234=(_0x47c789<0x3?_0x52d0b5(_0x402234):_0x47c789>0x3?_0x52d0b5(_0x708ee5,_0x30fe72,_0x402234):_0x52d0b5(_0x708ee5,_0x30fe72))||_0x402234;}return _0x47c789>0x3&&_0x402234&&Object[_0x5cdc5b(0x116)](_0x708ee5,_0x30fe72,_0x402234),_0x402234;},__metadata=this&&this[a281_0x3eaff8(0xe1)]||function(_0x3ce715,_0x3475e0){const _0x316957=a281_0x3eaff8;if(typeof Reflect===_0x316957(0x107)&&typeof Reflect[_0x316957(0xe8)]==='function')return Reflect['metadata'](_0x3ce715,_0x3475e0);};function a281_0x2912(_0x32d518,_0x570c84){const _0x3a2269=a281_0x2c50();return a281_0x2912=function(_0x246141,_0x285d0f){_0x246141=_0x246141-0xc9;let _0x2c50af=_0x3a2269[_0x246141];return _0x2c50af;},a281_0x2912(_0x32d518,_0x570c84);}Object['defineProperty'](exports,a281_0x3eaff8(0xd1),{'value':!![]}),exports[a281_0x3eaff8(0x117)]=void 0x0;const typedi_1=require(a281_0x3eaff8(0xff)),constants_1=require(a281_0x3eaff8(0x11f)),errors_1=require(a281_0x3eaff8(0xe3)),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a281_0x3eaff8(0xf7)),not_found_error_1=require(a281_0x3eaff8(0x11d)),queries_1=require('../queries'),salesforce_query_service_1=require(a281_0x3eaff8(0x124)),salesforce_service_1=require(a281_0x3eaff8(0xd0));let SalesforceSyncService=class SalesforceSyncService{constructor(_0xd9ed5d,_0x4c1b58){const _0x41c02c=a281_0x3eaff8;this['salesforceQuery']=_0xd9ed5d,this[_0x41c02c(0x114)]=_0x4c1b58;}async[a281_0x3eaff8(0x12b)](_0x5e61c9){const _0x5c70d1=a281_0x3eaff8;var _0x3f5386;const _0x2547c0=await this[_0x5c70d1(0x115)][_0x5c70d1(0x106)](_0x5e61c9),_0x4c678b=[];for(const _0x1133bc of _0x2547c0){const _0x4515fe=(_0x3f5386=_0x1133bc[constants_1[_0x5c70d1(0xd6)]+_0x5c70d1(0xcf)])===null||_0x3f5386===void 0x0?void 0x0:_0x3f5386[_0x5c70d1(0xf4)];_0x4515fe&&_0x4515fe[_0x5c70d1(0xe6)]&&_0x4c678b['push'](_0x4515fe[0x0]['Id']);}return _0x4c678b;}async[a281_0x3eaff8(0xf6)](_0x2a20dd){const _0x1b892a=a281_0x3eaff8,_0x511d57=await this[_0x1b892a(0x115)][_0x1b892a(0x106)](queries_1[_0x1b892a(0x10e)][_0x1b892a(0x111)](/\%connection_id\%/g,_0x2a20dd));return _0x511d57[_0x1b892a(0x10a)](_0x5b9a14=>{const _0x55e650=_0x1b892a;return _0x5b9a14[constants_1[_0x55e650(0x11e)]+_0x55e650(0xe7)]?_0x5b9a14[constants_1[_0x55e650(0x11e)]+_0x55e650(0xe7)]['Name']:_0x5b9a14['Name'];});}async[a281_0x3eaff8(0x127)](_0x1079e7){const _0x424fac=a281_0x3eaff8,_0x49e53f=await this[_0x424fac(0x115)][_0x424fac(0x106)](queries_1[_0x424fac(0xeb)][_0x424fac(0x111)](/\%connection_id\%/g,_0x1079e7));return _0x49e53f['map'](_0x2c11d6=>flosum_repository_sync_dto_1[_0x424fac(0xdb)][_0x424fac(0xd4)](_0x2c11d6));}async['getBranchRecords'](_0x16242a){const _0x1cfc13=a281_0x3eaff8,_0x503db6=await this[_0x1cfc13(0x115)][_0x1cfc13(0x106)](queries_1[_0x1cfc13(0xd3)][_0x1cfc13(0x111)](/%repositories_ids\%/g,_0x16242a));return _0x503db6[_0x1cfc13(0x10a)](_0x3983a2=>flosum_repository_sync_dto_1[_0x1cfc13(0xdb)][_0x1cfc13(0x120)](_0x3983a2));}async[a281_0x3eaff8(0xf2)](_0x336278){const _0x1f58f3=a281_0x3eaff8,_0x31db28=await this['salesforceQuery'][_0x1f58f3(0x106)](queries_1[_0x1f58f3(0x105)][_0x1f58f3(0x111)](_0x1f58f3(0xfa),_0x336278));if(_0x31db28[_0x1f58f3(0xe6)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x1f58f3(0xca)+_0x336278+_0x1f58f3(0xc9));return flosum_repository_sync_dto_1[_0x1f58f3(0xdb)][_0x1f58f3(0xd4)](_0x31db28[0x0]);}async[a281_0x3eaff8(0xe0)](_0x10a4d3){const _0x237728=a281_0x3eaff8,_0x20c64b=await this[_0x237728(0x115)][_0x237728(0x106)](queries_1[_0x237728(0x108)][_0x237728(0x111)]('%id%',_0x10a4d3));if(_0x20c64b[_0x237728(0xe6)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x237728(0xec)+_0x10a4d3+_0x237728(0xc9));return flosum_repository_sync_dto_1[_0x237728(0xdb)][_0x237728(0x120)](_0x20c64b[0x0]);}async[a281_0x3eaff8(0xcc)](_0xb864a0){const _0x20369d=a281_0x3eaff8,_0x3a73f0=await this[_0x20369d(0x115)][_0x20369d(0x106)](queries_1[_0x20369d(0x100)][_0x20369d(0x111)](_0x20369d(0xcd),_0xb864a0));if(_0x3a73f0[_0x20369d(0xe6)]===0x0)throw new not_found_error_1[(_0x20369d(0xd5))]('Branch\x20'+_0xb864a0+'\x20not\x20found\x20on\x20salesforce');const _0xe26283=_0x3a73f0[_0x20369d(0xe4)](_0x367490=>_0x367490[constants_1[_0x20369d(0xd6)]+'Branch_Name__c']===_0xb864a0);if(!_0xe26283)throw new not_found_error_1[(_0x20369d(0xd5))](_0x20369d(0x10d)+_0xb864a0+_0x20369d(0xc9));return flosum_repository_sync_dto_1[_0x20369d(0xdb)][_0x20369d(0x120)](_0xe26283);}async[a281_0x3eaff8(0x113)](_0x32f532){const _0x51818b=a281_0x3eaff8,_0x251bcc=await this[_0x51818b(0x115)][_0x51818b(0x106)](queries_1[_0x51818b(0xf8)][_0x51818b(0x111)](_0x51818b(0xcd),_0x32f532));if(_0x251bcc[_0x51818b(0xe6)]===0x0)throw new not_found_error_1[(_0x51818b(0xd5))](_0x51818b(0xe2)+_0x32f532+_0x51818b(0xc9));return flosum_repository_sync_dto_1[_0x51818b(0xdb)][_0x51818b(0xd4)](_0x251bcc[0x0]);}async['getComponentsFromRepository'](_0x353632){const _0x476a59=a281_0x3eaff8,_0x6ef4b6=_0x476a59(0x110)+queries_1[_0x476a59(0xda)]+_0x476a59(0xed)+_0x353632+'\x27';return this[_0x476a59(0x12b)](_0x6ef4b6);}async[a281_0x3eaff8(0xfd)](_0x112e1e){const _0x514f07=a281_0x3eaff8,_0x16fc62=_0x514f07(0xfe)+queries_1['GET_COMPONENTS_QUERY']+_0x514f07(0xdc)+_0x112e1e+'\x27';return this[_0x514f07(0x12b)](_0x16fc62);}async[a281_0x3eaff8(0x121)](_0xd3f7eb){const _0x5af93c=a281_0x3eaff8;var _0x23db93;const _0x259e8a=queries_1[_0x5af93c(0x128)]['replace'](_0x5af93c(0x119),_0xd3f7eb[_0x5af93c(0x125)])[_0x5af93c(0x111)](_0x5af93c(0xcd),_0xd3f7eb[_0x5af93c(0x126)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x5af93c(0xdd)]),_0x205c51=await this['salesforceQuery']['query'](_0x259e8a),_0x3630a6=(_0x23db93=_0x205c51[0x0])===null||_0x23db93===void 0x0?void 0x0:_0x23db93['Id'];if(!_0x3630a6)throw new Error(errors_1[_0x5af93c(0xf3)]);return _0x3630a6;}async[a281_0x3eaff8(0xce)](_0x432a62){const _0x15a4c9=a281_0x3eaff8;let _0x484c6c=await this[_0x15a4c9(0x121)](_0x432a62)[_0x15a4c9(0x112)](()=>null);return!_0x484c6c&&(_0x484c6c=await this[_0x15a4c9(0x114)][_0x15a4c9(0xef)](_0x15a4c9(0x10c),{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x432a62[_0x15a4c9(0x125)],'ContentType':_0x15a4c9(0xf5),'Name':_0x432a62[_0x15a4c9(0x126)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x15a4c9(0xdd)]})),_0x484c6c;}async[a281_0x3eaff8(0xee)](_0x505828,_0x263e03){const _0x36f348=a281_0x3eaff8,_0x1158f9=await this['getRemoteStateAttachmentId'](_0x505828);await this['salesforceService']['patchObject'](_0x36f348(0x10c),_0x1158f9,{'Body':(0x0,utils_1[_0x36f348(0xfb)])(JSON['stringify'](_0x263e03))});}async[a281_0x3eaff8(0xd2)](_0x5e77c0,_0x1be687){const _0x46ad4a=a281_0x3eaff8;await this[_0x46ad4a(0x114)]['patchObject'](_0x5e77c0[_0x46ad4a(0xd7)],_0x5e77c0['objectId'],{[constants_1[_0x46ad4a(0x11e)]+_0x46ad4a(0xe9)]:_0x1be687});}async[a281_0x3eaff8(0xf9)](_0x2445bc){const _0x1fcbc8=a281_0x3eaff8;await this[_0x1fcbc8(0x114)][_0x1fcbc8(0xf1)](constants_1['FLOSUM_GIT_NAMESPACE']+_0x1fcbc8(0x10f),_0x2445bc,{[constants_1[_0x1fcbc8(0x11e)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a281_0x3eaff8(0x10b)])(),__metadata(a281_0x3eaff8(0x118),[salesforce_query_service_1[a281_0x3eaff8(0x11b)],salesforce_service_1[a281_0x3eaff8(0xdf)]])],SalesforceSyncService),exports[a281_0x3eaff8(0x117)]=SalesforceSyncService;