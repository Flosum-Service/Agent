const a280_0x8570cc=a280_0x5e7d;(function(_0x57d8ad,_0x3fd683){const _0x289c85=a280_0x5e7d,_0x1efccb=_0x57d8ad();while(!![]){try{const _0x21c0de=-parseInt(_0x289c85(0xd9))/0x1*(-parseInt(_0x289c85(0xed))/0x2)+parseInt(_0x289c85(0x10c))/0x3*(-parseInt(_0x289c85(0xb1))/0x4)+-parseInt(_0x289c85(0xf9))/0x5+parseInt(_0x289c85(0xce))/0x6*(-parseInt(_0x289c85(0xac))/0x7)+-parseInt(_0x289c85(0xb8))/0x8+-parseInt(_0x289c85(0x100))/0x9*(-parseInt(_0x289c85(0xe1))/0xa)+-parseInt(_0x289c85(0xc2))/0xb*(-parseInt(_0x289c85(0xf7))/0xc);if(_0x21c0de===_0x3fd683)break;else _0x1efccb['push'](_0x1efccb['shift']());}catch(_0x571208){_0x1efccb['push'](_0x1efccb['shift']());}}}(a280_0x3786,0xef8f4));const a280_0x159853=(function(){let _0x2e787e=!![];return function(_0x2865bb,_0x27870b){const _0x881175=_0x2e787e?function(){if(_0x27870b){const _0x50b4a8=_0x27870b['apply'](_0x2865bb,arguments);return _0x27870b=null,_0x50b4a8;}}:function(){};return _0x2e787e=![],_0x881175;};}()),a280_0xce9253=a280_0x159853(this,function(){const _0x2e722e=a280_0x5e7d;return a280_0xce9253[_0x2e722e(0xb5)]()['search'](_0x2e722e(0xeb))['toString']()[_0x2e722e(0xfe)](a280_0xce9253)[_0x2e722e(0xb3)](_0x2e722e(0xeb));});a280_0xce9253();'use strict';function a280_0x3786(){const _0x1d5518=['FLOSUM_NAMESPACE','GET_WAITING_REPOSITORIES_QUERY','patchObject','../../../shared/utils','getRemoteStateAttachmentId','metadata','./salesforce.service','../dto/flosum-repository-sync.dto','getRepositoryRecordByName','156791cYdChX','text/plain','getAllRepositoryNames','../queries','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','getBranchRecords','query','Branch_Name__c','4792430tCKyjV','getAttachmentId','encodeBase64','SYNC_ATTACHMENT_FOR_BRANCH_NAME','Repository\x20','updateRemoteState','./salesforce-query.service','push','../errors/not-found.error','%id%','(((.+)+)+)+$','getRepositoryRecord','2vMAnuu','\x0a\x20\x20\x20\x20\x20\x20','typedi','SalesforceQueryService','defineProperty','\x20not\x20found\x20on\x20salesforce','getBranchRecord','getBranchRecordByName','map','FLOSUM_GIT_NAMESPACE','372FqCkIP','decorate','3382065bFSDXR','salesforceService','createObject','../../../../constants/errors','getBranchComponents','constructor','getComponents','36kOyMmH','GET_WAITING_BRANCHES_QUERY','Repository__r','getComponentsFromRepository','__metadata','catch','GET_COMPONENTS_QUERY','Connection__c','repositoryId','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','Service','objectId','153vfclQt','10745938LWXRss','find','stringify','setStatus','getRepositoryRecords','5836VcsXfM','object','search','salesforceQuery','toString','SalesforceNotFoundError','ERR_INVALID_ATTACHMENT_ID','7678896zaxCNF','SalesforceService','objectType','Sync_In_Progress__c','function','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','Attachment','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','SalesforceSyncService','length','764071PscLrB','replace','Branch\x20','fromRepositoryRecord','Name','getOwnPropertyDescriptor','%name%','GET_REPOSITORY_BY_NAME_QUERY','fromBranchRecord','%parentId%','FlosumRepositorySyncDto','disableSync','6vnuqrE','design:paramtypes'];a280_0x3786=function(){return _0x1d5518;};return a280_0x3786();}var __decorate=this&&this['__decorate']||function(_0x4f4d26,_0x1b674f,_0x125c73,_0x105036){const _0x9e6cf0=a280_0x5e7d;var _0x12e4fd=arguments[_0x9e6cf0(0xc1)],_0x504e77=_0x12e4fd<0x3?_0x1b674f:_0x105036===null?_0x105036=Object[_0x9e6cf0(0xc7)](_0x1b674f,_0x125c73):_0x105036,_0x27af7e;if(typeof Reflect==='object'&&typeof Reflect[_0x9e6cf0(0xf8)]===_0x9e6cf0(0xbc))_0x504e77=Reflect[_0x9e6cf0(0xf8)](_0x4f4d26,_0x1b674f,_0x125c73,_0x105036);else{for(var _0x316a2c=_0x4f4d26[_0x9e6cf0(0xc1)]-0x1;_0x316a2c>=0x0;_0x316a2c--)if(_0x27af7e=_0x4f4d26[_0x316a2c])_0x504e77=(_0x12e4fd<0x3?_0x27af7e(_0x504e77):_0x12e4fd>0x3?_0x27af7e(_0x1b674f,_0x125c73,_0x504e77):_0x27af7e(_0x1b674f,_0x125c73))||_0x504e77;}return _0x12e4fd>0x3&&_0x504e77&&Object['defineProperty'](_0x1b674f,_0x125c73,_0x504e77),_0x504e77;},__metadata=this&&this[a280_0x8570cc(0x104)]||function(_0x1a6025,_0x591f69){const _0x4862bd=a280_0x8570cc;if(typeof Reflect===_0x4862bd(0xb2)&&typeof Reflect[_0x4862bd(0xd5)]===_0x4862bd(0xbc))return Reflect['metadata'](_0x1a6025,_0x591f69);};Object[a280_0x8570cc(0xf1)](exports,'__esModule',{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require(a280_0x8570cc(0xef)),constants_1=require('../../../../constants'),errors_1=require(a280_0x8570cc(0xfc)),utils_1=require(a280_0x8570cc(0xd3)),flosum_repository_sync_dto_1=require(a280_0x8570cc(0xd7)),not_found_error_1=require(a280_0x8570cc(0xe9)),queries_1=require(a280_0x8570cc(0xdc)),salesforce_query_service_1=require(a280_0x8570cc(0xe7)),salesforce_service_1=require(a280_0x8570cc(0xd6));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x191e44,_0x4e4ea3){const _0x3aeda1=a280_0x8570cc;this[_0x3aeda1(0xb4)]=_0x191e44,this[_0x3aeda1(0xfa)]=_0x4e4ea3;}async[a280_0x8570cc(0xff)](_0x4a7675){const _0x41f9ee=a280_0x8570cc;var _0x35ccae;const _0x526c05=await this[_0x41f9ee(0xb4)][_0x41f9ee(0xdf)](_0x4a7675),_0x3e656d=[];for(const _0x57ac04 of _0x526c05){const _0x279856=(_0x35ccae=_0x57ac04[constants_1[_0x41f9ee(0xd0)]+'Components__r'])===null||_0x35ccae===void 0x0?void 0x0:_0x35ccae['records'];_0x279856&&_0x279856[_0x41f9ee(0xc1)]&&_0x3e656d[_0x41f9ee(0xe8)](_0x279856[0x0]['Id']);}return _0x3e656d;}async[a280_0x8570cc(0xdb)](_0x26460f){const _0x398d7e=a280_0x8570cc,_0x1eb27b=await this[_0x398d7e(0xb4)]['query'](queries_1['GET_REPOSITORIES_NAMES_QUERY'][_0x398d7e(0xc3)](/\%connection_id\%/g,_0x26460f));return _0x1eb27b['map'](_0x2d4df1=>{const _0x506be3=_0x398d7e;return _0x2d4df1[constants_1['FLOSUM_GIT_NAMESPACE']+_0x506be3(0x102)]?_0x2d4df1[constants_1[_0x506be3(0xf6)]+_0x506be3(0x102)]['Name']:_0x2d4df1[_0x506be3(0xc6)];});}async[a280_0x8570cc(0xb0)](_0x4f0525){const _0x38e996=a280_0x8570cc,_0x321f3d=await this[_0x38e996(0xb4)][_0x38e996(0xdf)](queries_1[_0x38e996(0xd1)][_0x38e996(0xc3)](/\%connection_id\%/g,_0x4f0525));return _0x321f3d['map'](_0x558080=>flosum_repository_sync_dto_1[_0x38e996(0xcc)][_0x38e996(0xc5)](_0x558080));}async[a280_0x8570cc(0xde)](_0x458ed3){const _0x25847e=a280_0x8570cc,_0x1be581=await this[_0x25847e(0xb4)][_0x25847e(0xdf)](queries_1[_0x25847e(0x101)][_0x25847e(0xc3)](/%repositories_ids\%/g,_0x458ed3));return _0x1be581[_0x25847e(0xf5)](_0x3bf11c=>flosum_repository_sync_dto_1[_0x25847e(0xcc)][_0x25847e(0xca)](_0x3bf11c));}async[a280_0x8570cc(0xec)](_0x293dec){const _0x17035e=a280_0x8570cc,_0x4a17ca=await this[_0x17035e(0xb4)][_0x17035e(0xdf)](queries_1['GET_REPOSITORY_QUERY'][_0x17035e(0xc3)](_0x17035e(0xea),_0x293dec));if(_0x4a17ca[_0x17035e(0xc1)]===0x0)throw new not_found_error_1[(_0x17035e(0xb6))]('Repository\x20with\x20Id\x20'+_0x293dec+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x17035e(0xcc)]['fromRepositoryRecord'](_0x4a17ca[0x0]);}async[a280_0x8570cc(0xf3)](_0x40ca4f){const _0x2fe2cb=a280_0x8570cc,_0x34abd4=await this[_0x2fe2cb(0xb4)][_0x2fe2cb(0xdf)](queries_1['GET_BRANCH_QUERY'][_0x2fe2cb(0xc3)](_0x2fe2cb(0xea),_0x40ca4f));if(_0x34abd4['length']===0x0)throw new not_found_error_1[(_0x2fe2cb(0xb6))]('Branch\x20with\x20Id\x20'+_0x40ca4f+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x2fe2cb(0xcc)][_0x2fe2cb(0xca)](_0x34abd4[0x0]);}async[a280_0x8570cc(0xf4)](_0x1df2dd){const _0x25d950=a280_0x8570cc,_0x2eae79=await this[_0x25d950(0xb4)][_0x25d950(0xdf)](queries_1['GET_BRANCH_BY_NAME_QUERY'][_0x25d950(0xc3)](_0x25d950(0xc8),_0x1df2dd));if(_0x2eae79['length']===0x0)throw new not_found_error_1[(_0x25d950(0xb6))](_0x25d950(0xc4)+_0x1df2dd+_0x25d950(0xf2));const _0x29a13c=_0x2eae79[_0x25d950(0xad)](_0x7c1dd7=>_0x7c1dd7[constants_1['FLOSUM_NAMESPACE']+_0x25d950(0xe0)]===_0x1df2dd);if(!_0x29a13c)throw new not_found_error_1[(_0x25d950(0xb6))](_0x25d950(0xc4)+_0x1df2dd+_0x25d950(0xf2));return flosum_repository_sync_dto_1[_0x25d950(0xcc)][_0x25d950(0xca)](_0x29a13c);}async[a280_0x8570cc(0xd8)](_0x4357a3){const _0x2a59fa=a280_0x8570cc,_0x37c069=await this[_0x2a59fa(0xb4)][_0x2a59fa(0xdf)](queries_1[_0x2a59fa(0xc9)][_0x2a59fa(0xc3)](_0x2a59fa(0xc8),_0x4357a3));if(_0x37c069[_0x2a59fa(0xc1)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x2a59fa(0xe5)+_0x4357a3+_0x2a59fa(0xf2));return flosum_repository_sync_dto_1[_0x2a59fa(0xcc)][_0x2a59fa(0xc5)](_0x37c069[0x0]);}async[a280_0x8570cc(0x103)](_0x215869){const _0x309d39=a280_0x8570cc,_0x55c72b=_0x309d39(0xee)+queries_1[_0x309d39(0x106)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x215869+'\x27';return this[_0x309d39(0xff)](_0x55c72b);}async[a280_0x8570cc(0xfd)](_0x4e2b43){const _0x307cb9=a280_0x8570cc,_0x48af5e=_0x307cb9(0xbf)+queries_1[_0x307cb9(0x106)]+_0x307cb9(0xdd)+_0x4e2b43+'\x27';return this['getComponents'](_0x48af5e);}async[a280_0x8570cc(0xe2)](_0x178f87){const _0x20fffa=a280_0x8570cc;var _0x3f5a17;const _0x151fb6=queries_1[_0x20fffa(0x109)][_0x20fffa(0xc3)](_0x20fffa(0xcb),_0x178f87[_0x20fffa(0x10b)])[_0x20fffa(0xc3)](_0x20fffa(0xc8),_0x178f87[_0x20fffa(0x108)]?constants_1[_0x20fffa(0xbd)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x21daa0=await this[_0x20fffa(0xb4)][_0x20fffa(0xdf)](_0x151fb6),_0xacf412=(_0x3f5a17=_0x21daa0[0x0])===null||_0x3f5a17===void 0x0?void 0x0:_0x3f5a17['Id'];if(!_0xacf412)throw new Error(errors_1[_0x20fffa(0xb7)]);return _0xacf412;}async['getRemoteStateAttachmentId'](_0x4046aa){const _0x47f95b=a280_0x8570cc;let _0x15b972=await this[_0x47f95b(0xe2)](_0x4046aa)[_0x47f95b(0x105)](()=>null);return!_0x15b972&&(_0x15b972=await this[_0x47f95b(0xfa)][_0x47f95b(0xfb)](_0x47f95b(0xbe),{'Body':(0x0,utils_1[_0x47f95b(0xe3)])('{}'),'ParentId':_0x4046aa[_0x47f95b(0x10b)],'ContentType':_0x47f95b(0xda),'Name':_0x4046aa[_0x47f95b(0x108)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x47f95b(0xe4)]})),_0x15b972;}async[a280_0x8570cc(0xe6)](_0x18f7a4,_0x41a1d7){const _0x4d6278=a280_0x8570cc,_0x5c8184=await this[_0x4d6278(0xd4)](_0x18f7a4);await this[_0x4d6278(0xfa)][_0x4d6278(0xd2)](_0x4d6278(0xbe),_0x5c8184,{'Body':(0x0,utils_1[_0x4d6278(0xe3)])(JSON[_0x4d6278(0xae)](_0x41a1d7))});}async[a280_0x8570cc(0xaf)](_0x3c87a4,_0x51fd0f){const _0x54f280=a280_0x8570cc;await this['salesforceService']['patchObject'](_0x3c87a4[_0x54f280(0xba)],_0x3c87a4[_0x54f280(0x10b)],{[constants_1[_0x54f280(0xf6)]+'Synchronization_Status__c']:_0x51fd0f});}async[a280_0x8570cc(0xcd)](_0x3a332a){const _0xc3ec20=a280_0x8570cc;await this[_0xc3ec20(0xfa)][_0xc3ec20(0xd2)](constants_1['FLOSUM_GIT_NAMESPACE']+_0xc3ec20(0x107),_0x3a332a,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0xc3ec20(0xbb)]:![]});}};function a280_0x5e7d(_0x2e6944,_0x5b0e1b){const _0x50ede1=a280_0x3786();return a280_0x5e7d=function(_0xce9253,_0x159853){_0xce9253=_0xce9253-0xac;let _0x37865c=_0x50ede1[_0xce9253];return _0x37865c;},a280_0x5e7d(_0x2e6944,_0x5b0e1b);}SalesforceSyncService=__decorate([(0x0,typedi_1[a280_0x8570cc(0x10a)])(),__metadata(a280_0x8570cc(0xcf),[salesforce_query_service_1[a280_0x8570cc(0xf0)],salesforce_service_1[a280_0x8570cc(0xb9)]])],SalesforceSyncService),exports[a280_0x8570cc(0xc0)]=SalesforceSyncService;