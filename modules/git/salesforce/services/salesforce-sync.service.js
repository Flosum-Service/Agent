const a243_0x60c26f=a243_0x40be;(function(_0x133ac8,_0x55680a){const _0x16ff99=a243_0x40be,_0x1b4281=_0x133ac8();while(!![]){try{const _0x3a43d8=-parseInt(_0x16ff99(0x107))/0x1+-parseInt(_0x16ff99(0xf5))/0x2*(parseInt(_0x16ff99(0xec))/0x3)+parseInt(_0x16ff99(0xeb))/0x4+parseInt(_0x16ff99(0x10b))/0x5*(-parseInt(_0x16ff99(0xd1))/0x6)+-parseInt(_0x16ff99(0xc5))/0x7*(-parseInt(_0x16ff99(0x118))/0x8)+parseInt(_0x16ff99(0xde))/0x9+parseInt(_0x16ff99(0x11a))/0xa*(parseInt(_0x16ff99(0xca))/0xb);if(_0x3a43d8===_0x55680a)break;else _0x1b4281['push'](_0x1b4281['shift']());}catch(_0x24ebfe){_0x1b4281['push'](_0x1b4281['shift']());}}}(a243_0x676a,0x27600));const a243_0x540867=(function(){let _0x40f73e=!![];return function(_0x38fa5f,_0x497b6b){const _0x370429=_0x40f73e?function(){if(_0x497b6b){const _0xee8ca2=_0x497b6b['apply'](_0x38fa5f,arguments);return _0x497b6b=null,_0xee8ca2;}}:function(){};return _0x40f73e=![],_0x370429;};}()),a243_0x410222=a243_0x540867(this,function(){const _0x590ae0=a243_0x40be;return a243_0x410222[_0x590ae0(0xc8)]()[_0x590ae0(0x112)]('(((.+)+)+)+$')[_0x590ae0(0xc8)]()[_0x590ae0(0x113)](a243_0x410222)['search'](_0x590ae0(0x105));});a243_0x410222();'use strict';var __decorate=this&&this['__decorate']||function(_0x1fc6bb,_0x261eb2,_0x576a96,_0x441a4a){const _0x4d25ce=a243_0x40be;var _0x2898d2=arguments[_0x4d25ce(0xf8)],_0x52efd1=_0x2898d2<0x3?_0x261eb2:_0x441a4a===null?_0x441a4a=Object[_0x4d25ce(0x110)](_0x261eb2,_0x576a96):_0x441a4a,_0x1a8943;if(typeof Reflect===_0x4d25ce(0xe1)&&typeof Reflect[_0x4d25ce(0x114)]===_0x4d25ce(0xd2))_0x52efd1=Reflect[_0x4d25ce(0x114)](_0x1fc6bb,_0x261eb2,_0x576a96,_0x441a4a);else{for(var _0x252950=_0x1fc6bb['length']-0x1;_0x252950>=0x0;_0x252950--)if(_0x1a8943=_0x1fc6bb[_0x252950])_0x52efd1=(_0x2898d2<0x3?_0x1a8943(_0x52efd1):_0x2898d2>0x3?_0x1a8943(_0x261eb2,_0x576a96,_0x52efd1):_0x1a8943(_0x261eb2,_0x576a96))||_0x52efd1;}return _0x2898d2>0x3&&_0x52efd1&&Object[_0x4d25ce(0x109)](_0x261eb2,_0x576a96,_0x52efd1),_0x52efd1;},__metadata=this&&this[a243_0x60c26f(0x116)]||function(_0x8dd7c8,_0x5e00a6){const _0x4506f9=a243_0x60c26f;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x4506f9(0xd2))return Reflect[_0x4506f9(0xf4)](_0x8dd7c8,_0x5e00a6);};function a243_0x676a(){const _0x901fe3=['../queries','getComponentsFromRepository','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','records','Repository__r','./salesforce.service','Branch_Name__c','setStatus','replace','GET_REPOSITORIES_NAMES_QUERY','1200087SBSqyg','map','salesforceService','object','FlosumRepositorySyncDto','getAttachmentId','updateRemoteState','SYNC_ATTACHMENT_FOR_BRANCH_NAME','getRepositoryRecord','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','getComponents','Attachment','Branch\x20with\x20Id\x20','885456yrKcVN','66smnYeJ','createObject','FLOSUM_NAMESPACE','getRemoteStateAttachmentId','SalesforceSyncService','design:paramtypes','fromRepositoryRecord','text/plain','metadata','23720qGWnKW','objectId','Synchronization_Status__c','length','SalesforceQueryService','%parentId%','../dto/flosum-repository-sync.dto','patchObject','getBranchRecord','query','\x0a\x20\x20\x20\x20\x20\x20','GET_REPOSITORY_BY_NAME_QUERY','SalesforceNotFoundError','fromBranchRecord','%name%','typedi','(((.+)+)+)+$','Components__r','31154RXeoUa','GET_BRANCH_QUERY','defineProperty','../errors/not-found.error','135LHUwCF','getBranchRecordByName','__esModule','getRepositoryRecordByName','objectType','getOwnPropertyDescriptor','FLOSUM_GIT_NAMESPACE','search','constructor','decorate','disableSync','__metadata','repositoryId','705768uAPwkv','getRepositoryRecords','1490dgdMgy','catch','salesforceQuery','Name','%id%','push','stringify','\x20not\x20found\x20on\x20salesforce','7DyEGRH','Branch\x20','../../../../constants','toString','getAllRepositoryNames','14641gjlmCs','GET_COMPONENTS_QUERY','Repository\x20with\x20Id\x20','Service','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','GET_WAITING_BRANCHES_QUERY','41754UbplNn','function','GET_BRANCH_BY_NAME_QUERY'];a243_0x676a=function(){return _0x901fe3;};return a243_0x676a();}Object[a243_0x60c26f(0x109)](exports,a243_0x60c26f(0x10d),{'value':!![]}),exports[a243_0x60c26f(0xf0)]=void 0x0;function a243_0x40be(_0x25df95,_0x250cca){const _0x4a8f82=a243_0x676a();return a243_0x40be=function(_0x410222,_0x540867){_0x410222=_0x410222-0xc5;let _0x676a9c=_0x4a8f82[_0x410222];return _0x676a9c;},a243_0x40be(_0x25df95,_0x250cca);}const typedi_1=require(a243_0x60c26f(0x104)),constants_1=require(a243_0x60c26f(0xc7)),errors_1=require('../../../../constants/errors'),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a243_0x60c26f(0xfb)),not_found_error_1=require(a243_0x60c26f(0x10a)),queries_1=require(a243_0x60c26f(0xd4)),salesforce_query_service_1=require('./salesforce-query.service'),salesforce_service_1=require(a243_0x60c26f(0xd9));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x1023df,_0x4f2a81){const _0x2fee37=a243_0x60c26f;this['salesforceQuery']=_0x1023df,this[_0x2fee37(0xe0)]=_0x4f2a81;}async[a243_0x60c26f(0xe8)](_0x1554da){const _0x1e4d27=a243_0x60c26f;var _0x447261;const _0x1bb73c=await this[_0x1e4d27(0x11c)]['query'](_0x1554da),_0x30a546=[];for(const _0x2009fd of _0x1bb73c){const _0x1e35d0=(_0x447261=_0x2009fd[constants_1[_0x1e4d27(0xee)]+_0x1e4d27(0x106)])===null||_0x447261===void 0x0?void 0x0:_0x447261[_0x1e4d27(0xd7)];_0x1e35d0&&_0x1e35d0[_0x1e4d27(0xf8)]&&_0x30a546[_0x1e4d27(0x11f)](_0x1e35d0[0x0]['Id']);}return _0x30a546;}async[a243_0x60c26f(0xc9)](_0x4228e3){const _0x1d3b00=a243_0x60c26f,_0x266048=await this['salesforceQuery']['query'](queries_1[_0x1d3b00(0xdd)][_0x1d3b00(0xdc)](/\%connection_id\%/g,_0x4228e3));return _0x266048[_0x1d3b00(0xdf)](_0x252b59=>{const _0x362dd8=_0x1d3b00;return _0x252b59[constants_1[_0x362dd8(0x111)]+_0x362dd8(0xd8)]?_0x252b59[constants_1[_0x362dd8(0x111)]+_0x362dd8(0xd8)][_0x362dd8(0x11d)]:_0x252b59['Name'];});}async[a243_0x60c26f(0x119)](_0x51ef5b){const _0x2daa46=a243_0x60c26f,_0x27683b=await this[_0x2daa46(0x11c)]['query'](queries_1['GET_WAITING_REPOSITORIES_QUERY'][_0x2daa46(0xdc)](/\%connection_id\%/g,_0x51ef5b));return _0x27683b[_0x2daa46(0xdf)](_0xe7be21=>flosum_repository_sync_dto_1[_0x2daa46(0xe2)][_0x2daa46(0xf2)](_0xe7be21));}async['getBranchRecords'](_0x144c96){const _0x3864c4=a243_0x60c26f,_0x14cde5=await this[_0x3864c4(0x11c)][_0x3864c4(0xfe)](queries_1[_0x3864c4(0xd0)][_0x3864c4(0xdc)](/%repositories_ids\%/g,_0x144c96));return _0x14cde5[_0x3864c4(0xdf)](_0x38a305=>flosum_repository_sync_dto_1[_0x3864c4(0xe2)][_0x3864c4(0x102)](_0x38a305));}async[a243_0x60c26f(0xe6)](_0x326ebb){const _0x429703=a243_0x60c26f,_0x4db3ed=await this[_0x429703(0x11c)][_0x429703(0xfe)](queries_1['GET_REPOSITORY_QUERY'][_0x429703(0xdc)](_0x429703(0x11e),_0x326ebb));if(_0x4db3ed[_0x429703(0xf8)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x429703(0xcc)+_0x326ebb+_0x429703(0x121));return flosum_repository_sync_dto_1[_0x429703(0xe2)][_0x429703(0xf2)](_0x4db3ed[0x0]);}async[a243_0x60c26f(0xfd)](_0x7b2ecb){const _0x3b44a4=a243_0x60c26f,_0x3d36f7=await this['salesforceQuery'][_0x3b44a4(0xfe)](queries_1[_0x3b44a4(0x108)][_0x3b44a4(0xdc)](_0x3b44a4(0x11e),_0x7b2ecb));if(_0x3d36f7[_0x3b44a4(0xf8)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x3b44a4(0xea)+_0x7b2ecb+_0x3b44a4(0x121));return flosum_repository_sync_dto_1[_0x3b44a4(0xe2)][_0x3b44a4(0x102)](_0x3d36f7[0x0]);}async[a243_0x60c26f(0x10c)](_0x2cd822){const _0x664ae6=a243_0x60c26f,_0x43c47f=await this['salesforceQuery'][_0x664ae6(0xfe)](queries_1[_0x664ae6(0xd3)][_0x664ae6(0xdc)](_0x664ae6(0x103),_0x2cd822));if(_0x43c47f[_0x664ae6(0xf8)]===0x0)throw new not_found_error_1[(_0x664ae6(0x101))](_0x664ae6(0xc6)+_0x2cd822+_0x664ae6(0x121));const _0x4e2d19=_0x43c47f['find'](_0x519774=>_0x519774[constants_1[_0x664ae6(0xee)]+_0x664ae6(0xda)]===_0x2cd822);if(!_0x4e2d19)throw new not_found_error_1[(_0x664ae6(0x101))]('Branch\x20'+_0x2cd822+_0x664ae6(0x121));return flosum_repository_sync_dto_1[_0x664ae6(0xe2)][_0x664ae6(0x102)](_0x4e2d19);}async[a243_0x60c26f(0x10e)](_0x5eec94){const _0x4e21b7=a243_0x60c26f,_0x5b2077=await this[_0x4e21b7(0x11c)]['query'](queries_1[_0x4e21b7(0x100)]['replace'](_0x4e21b7(0x103),_0x5eec94));if(_0x5b2077['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20'+_0x5eec94+_0x4e21b7(0x121));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x4e21b7(0xf2)](_0x5b2077[0x0]);}async[a243_0x60c26f(0xd5)](_0xb61675){const _0xb3d07=a243_0x60c26f,_0x2d6dd4=_0xb3d07(0xff)+queries_1[_0xb3d07(0xcb)]+_0xb3d07(0xcf)+_0xb61675+'\x27';return this[_0xb3d07(0xe8)](_0x2d6dd4);}async['getBranchComponents'](_0x1fef44){const _0x252411=a243_0x60c26f,_0x23b6ea='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x252411(0xcb)]+_0x252411(0xce)+_0x1fef44+'\x27';return this[_0x252411(0xe8)](_0x23b6ea);}async[a243_0x60c26f(0xe3)](_0x1c1a9d){const _0x49e154=a243_0x60c26f;var _0x3bbee4;const _0x399134=queries_1[_0x49e154(0xd6)]['replace'](_0x49e154(0xfa),_0x1c1a9d[_0x49e154(0xf6)])['replace'](_0x49e154(0x103),_0x1c1a9d[_0x49e154(0x117)]?constants_1[_0x49e154(0xe7)]:constants_1[_0x49e154(0xe5)]),_0x1f0835=await this[_0x49e154(0x11c)][_0x49e154(0xfe)](_0x399134),_0x4c0dbf=(_0x3bbee4=_0x1f0835[0x0])===null||_0x3bbee4===void 0x0?void 0x0:_0x3bbee4['Id'];if(!_0x4c0dbf)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x4c0dbf;}async[a243_0x60c26f(0xef)](_0x1179d6){const _0x27f4df=a243_0x60c26f;let _0x3c645a=await this[_0x27f4df(0xe3)](_0x1179d6)[_0x27f4df(0x11b)](()=>null);return!_0x3c645a&&(_0x3c645a=await this[_0x27f4df(0xe0)][_0x27f4df(0xed)]('Attachment',{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x1179d6[_0x27f4df(0xf6)],'ContentType':_0x27f4df(0xf3),'Name':_0x1179d6[_0x27f4df(0x117)]?constants_1[_0x27f4df(0xe7)]:constants_1[_0x27f4df(0xe5)]})),_0x3c645a;}async[a243_0x60c26f(0xe4)](_0x59c0a1,_0x42e3bc){const _0x143e1f=a243_0x60c26f,_0x54280f=await this[_0x143e1f(0xef)](_0x59c0a1);await this[_0x143e1f(0xe0)]['patchObject'](_0x143e1f(0xe9),_0x54280f,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0x143e1f(0x120)](_0x42e3bc))});}async[a243_0x60c26f(0xdb)](_0xced920,_0x588062){const _0x474798=a243_0x60c26f;await this[_0x474798(0xe0)][_0x474798(0xfc)](_0xced920[_0x474798(0x10f)],_0xced920['objectId'],{[constants_1[_0x474798(0x111)]+_0x474798(0xf7)]:_0x588062});}async[a243_0x60c26f(0x115)](_0x167d88){const _0x309837=a243_0x60c26f;await this[_0x309837(0xe0)]['patchObject'](constants_1['FLOSUM_GIT_NAMESPACE']+'Connection__c',_0x167d88,{[constants_1[_0x309837(0x111)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a243_0x60c26f(0xcd)])(),__metadata(a243_0x60c26f(0xf1),[salesforce_query_service_1[a243_0x60c26f(0xf9)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports[a243_0x60c26f(0xf0)]=SalesforceSyncService;