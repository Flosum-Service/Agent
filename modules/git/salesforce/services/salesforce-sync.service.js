const a254_0x266e48=a254_0x4849;(function(_0x6e741b,_0x1b01b3){const _0x24aeee=a254_0x4849,_0x597a3f=_0x6e741b();while(!![]){try{const _0x42c820=parseInt(_0x24aeee(0xe8))/0x1*(-parseInt(_0x24aeee(0xc6))/0x2)+parseInt(_0x24aeee(0xd9))/0x3*(-parseInt(_0x24aeee(0xb4))/0x4)+-parseInt(_0x24aeee(0xe4))/0x5+-parseInt(_0x24aeee(0xb2))/0x6+-parseInt(_0x24aeee(0xef))/0x7+parseInt(_0x24aeee(0xbf))/0x8+parseInt(_0x24aeee(0xa1))/0x9*(parseInt(_0x24aeee(0xd4))/0xa);if(_0x42c820===_0x1b01b3)break;else _0x597a3f['push'](_0x597a3f['shift']());}catch(_0x1dbcb3){_0x597a3f['push'](_0x597a3f['shift']());}}}(a254_0x2256,0x573f5));const a254_0x40d15a=(function(){let _0xb2817b=!![];return function(_0x36cf4f,_0xd3b71c){const _0x2cb900=_0xb2817b?function(){if(_0xd3b71c){const _0x16998f=_0xd3b71c['apply'](_0x36cf4f,arguments);return _0xd3b71c=null,_0x16998f;}}:function(){};return _0xb2817b=![],_0x2cb900;};}()),a254_0x459480=a254_0x40d15a(this,function(){const _0x4ab127=a254_0x4849;return a254_0x459480[_0x4ab127(0x9d)]()['search'](_0x4ab127(0xa0))[_0x4ab127(0x9d)]()[_0x4ab127(0xea)](a254_0x459480)['search'](_0x4ab127(0xa0));});a254_0x459480();'use strict';var __decorate=this&&this[a254_0x266e48(0xc9)]||function(_0x72bd27,_0x4c8b74,_0x26784e,_0x4952ec){const _0x13af25=a254_0x266e48;var _0x207706=arguments['length'],_0xc9da92=_0x207706<0x3?_0x4c8b74:_0x4952ec===null?_0x4952ec=Object[_0x13af25(0x9b)](_0x4c8b74,_0x26784e):_0x4952ec,_0x184ba4;if(typeof Reflect===_0x13af25(0x9e)&&typeof Reflect[_0x13af25(0xbc)]===_0x13af25(0xbb))_0xc9da92=Reflect[_0x13af25(0xbc)](_0x72bd27,_0x4c8b74,_0x26784e,_0x4952ec);else{for(var _0x1881a9=_0x72bd27[_0x13af25(0xda)]-0x1;_0x1881a9>=0x0;_0x1881a9--)if(_0x184ba4=_0x72bd27[_0x1881a9])_0xc9da92=(_0x207706<0x3?_0x184ba4(_0xc9da92):_0x207706>0x3?_0x184ba4(_0x4c8b74,_0x26784e,_0xc9da92):_0x184ba4(_0x4c8b74,_0x26784e))||_0xc9da92;}return _0x207706>0x3&&_0xc9da92&&Object[_0x13af25(0xe7)](_0x4c8b74,_0x26784e,_0xc9da92),_0xc9da92;},__metadata=this&&this['__metadata']||function(_0x106714,_0x26da1a){const _0x3487e4=a254_0x266e48;if(typeof Reflect==='object'&&typeof Reflect[_0x3487e4(0xcf)]===_0x3487e4(0xbb))return Reflect[_0x3487e4(0xcf)](_0x106714,_0x26da1a);};function a254_0x4849(_0x2e0609,_0x409786){const _0x1998cb=a254_0x2256();return a254_0x4849=function(_0x459480,_0x40d15a){_0x459480=_0x459480-0x99;let _0x225653=_0x1998cb[_0x459480];return _0x225653;},a254_0x4849(_0x2e0609,_0x409786);}Object[a254_0x266e48(0xe7)](exports,'__esModule',{'value':!![]}),exports['SalesforceSyncService']=void 0x0;function a254_0x2256(){const _0x4ea78d=['./salesforce.service','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','Repository\x20with\x20Id\x20','function','decorate','\x0a\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','4212552iRunIU','FLOSUM_NAMESPACE','FlosumRepositorySyncDto','SalesforceQueryService','Attachment','createObject','GET_COMPONENTS_QUERY','922QfGQnR','%name%','repositoryId','__decorate','design:paramtypes','getBranchComponents','GET_REPOSITORY_QUERY','fromBranchRecord','ERR_INVALID_ATTACHMENT_ID','metadata','Components__r','Service','getBranchRecord','GET_REPOSITORIES_NAMES_QUERY','10SBVymv','Branch\x20with\x20Id\x20','encodeBase64','\x20not\x20found\x20on\x20salesforce','../errors/not-found.error','2038551FBZlvd','length','SalesforceNotFoundError','fromRepositoryRecord','Branch_Name__c','patchObject','%parentId%','Connection__c','GET_WAITING_REPOSITORIES_QUERY','records','GET_REPOSITORY_BY_NAME_QUERY','2416380JRCmxF','catch','Repository\x20','defineProperty','1479lgbKRI','SalesforceSyncService','constructor','GET_BRANCH_BY_NAME_QUERY','FLOSUM_GIT_NAMESPACE','./salesforce-query.service','../queries','3904082YjurJa','SalesforceService','Repository__r','getOwnPropertyDescriptor','getAllRepositoryNames','toString','object','typedi','(((.+)+)+)+$','21990348dgWPdG','../../../shared/utils','query','map','text/plain','salesforceQuery','objectId','getAttachmentId','Sync_In_Progress__c','SYNC_ATTACHMENT_FOR_BRANCH_NAME','../../../../constants','getComponents','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','Branch\x20','salesforceService','getRepositoryRecords','find','1261428CTaVsB','stringify','4OaWfvj','replace','Name','getRepositoryRecord'];a254_0x2256=function(){return _0x4ea78d;};return a254_0x2256();}const typedi_1=require(a254_0x266e48(0x9f)),constants_1=require(a254_0x266e48(0xab)),errors_1=require('../../../../constants/errors'),utils_1=require(a254_0x266e48(0xa2)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a254_0x266e48(0xd8)),queries_1=require(a254_0x266e48(0xee)),salesforce_query_service_1=require(a254_0x266e48(0xed)),salesforce_service_1=require(a254_0x266e48(0xb8));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x5acd5a,_0x480a24){const _0x5a642d=a254_0x266e48;this[_0x5a642d(0xa6)]=_0x5acd5a,this[_0x5a642d(0xaf)]=_0x480a24;}async['getComponents'](_0x2ca33a){const _0x1942b2=a254_0x266e48;var _0x31921b;const _0x9eac46=await this[_0x1942b2(0xa6)][_0x1942b2(0xa3)](_0x2ca33a),_0x1ad223=[];for(const _0xc0edcf of _0x9eac46){const _0x49cd40=(_0x31921b=_0xc0edcf[constants_1[_0x1942b2(0xc0)]+_0x1942b2(0xd0)])===null||_0x31921b===void 0x0?void 0x0:_0x31921b[_0x1942b2(0xe2)];_0x49cd40&&_0x49cd40[_0x1942b2(0xda)]&&_0x1ad223['push'](_0x49cd40[0x0]['Id']);}return _0x1ad223;}async[a254_0x266e48(0x9c)](_0x1ce9c0){const _0x5cd2e1=a254_0x266e48,_0x43927e=await this['salesforceQuery']['query'](queries_1[_0x5cd2e1(0xd3)][_0x5cd2e1(0xb5)](/\%connection_id\%/g,_0x1ce9c0));return _0x43927e['map'](_0x177e6b=>{const _0x30c10d=_0x5cd2e1;return _0x177e6b[constants_1['FLOSUM_GIT_NAMESPACE']+_0x30c10d(0x9a)]?_0x177e6b[constants_1[_0x30c10d(0xec)]+'Repository__r'][_0x30c10d(0xb6)]:_0x177e6b[_0x30c10d(0xb6)];});}async[a254_0x266e48(0xb0)](_0x2fc444){const _0x23aab1=a254_0x266e48,_0x27a596=await this[_0x23aab1(0xa6)]['query'](queries_1[_0x23aab1(0xe1)]['replace'](/\%connection_id\%/g,_0x2fc444));return _0x27a596['map'](_0x18e6c3=>flosum_repository_sync_dto_1[_0x23aab1(0xc1)]['fromRepositoryRecord'](_0x18e6c3));}async['getBranchRecords'](_0x1b344a){const _0xe626b5=a254_0x266e48,_0x25b074=await this[_0xe626b5(0xa6)][_0xe626b5(0xa3)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0xe626b5(0xb5)](/%repositories_ids\%/g,_0x1b344a));return _0x25b074[_0xe626b5(0xa4)](_0x2f3ef0=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0x2f3ef0));}async[a254_0x266e48(0xb7)](_0x10fb8b){const _0x3e1c18=a254_0x266e48,_0x61a936=await this[_0x3e1c18(0xa6)][_0x3e1c18(0xa3)](queries_1[_0x3e1c18(0xcc)][_0x3e1c18(0xb5)]('%id%',_0x10fb8b));if(_0x61a936[_0x3e1c18(0xda)]===0x0)throw new not_found_error_1[(_0x3e1c18(0xdb))](_0x3e1c18(0xba)+_0x10fb8b+_0x3e1c18(0xd7));return flosum_repository_sync_dto_1[_0x3e1c18(0xc1)][_0x3e1c18(0xdc)](_0x61a936[0x0]);}async[a254_0x266e48(0xd2)](_0x514ab4){const _0x524e22=a254_0x266e48,_0xffb18d=await this[_0x524e22(0xa6)][_0x524e22(0xa3)](queries_1['GET_BRANCH_QUERY'][_0x524e22(0xb5)]('%id%',_0x514ab4));if(_0xffb18d[_0x524e22(0xda)]===0x0)throw new not_found_error_1[(_0x524e22(0xdb))](_0x524e22(0xd5)+_0x514ab4+_0x524e22(0xd7));return flosum_repository_sync_dto_1[_0x524e22(0xc1)]['fromBranchRecord'](_0xffb18d[0x0]);}async['getBranchRecordByName'](_0xd5a80e){const _0x3aab74=a254_0x266e48,_0x39e27a=await this[_0x3aab74(0xa6)]['query'](queries_1[_0x3aab74(0xeb)][_0x3aab74(0xb5)](_0x3aab74(0xc7),_0xd5a80e));if(_0x39e27a[_0x3aab74(0xda)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x3aab74(0xae)+_0xd5a80e+_0x3aab74(0xd7));const _0x508640=_0x39e27a[_0x3aab74(0xb1)](_0x419914=>_0x419914[constants_1['FLOSUM_NAMESPACE']+_0x3aab74(0xdd)]===_0xd5a80e);if(!_0x508640)throw new not_found_error_1[(_0x3aab74(0xdb))](_0x3aab74(0xae)+_0xd5a80e+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x3aab74(0xcd)](_0x508640);}async['getRepositoryRecordByName'](_0x3e72d4){const _0x343b68=a254_0x266e48,_0x45062d=await this[_0x343b68(0xa6)][_0x343b68(0xa3)](queries_1[_0x343b68(0xe3)][_0x343b68(0xb5)](_0x343b68(0xc7),_0x3e72d4));if(_0x45062d[_0x343b68(0xda)]===0x0)throw new not_found_error_1[(_0x343b68(0xdb))](_0x343b68(0xe6)+_0x3e72d4+_0x343b68(0xd7));return flosum_repository_sync_dto_1[_0x343b68(0xc1)][_0x343b68(0xdc)](_0x45062d[0x0]);}async['getComponentsFromRepository'](_0x4aff95){const _0x5e537f=a254_0x266e48,_0x340aad=_0x5e537f(0xbd)+queries_1[_0x5e537f(0xc5)]+_0x5e537f(0xbe)+_0x4aff95+'\x27';return this[_0x5e537f(0xac)](_0x340aad);}async[a254_0x266e48(0xcb)](_0xbec6e9){const _0x538e78=a254_0x266e48,_0x173256='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x538e78(0xc5)]+_0x538e78(0xad)+_0xbec6e9+'\x27';return this['getComponents'](_0x173256);}async['getAttachmentId'](_0xe3c97a){const _0x4bf4fb=a254_0x266e48;var _0x12e4a4;const _0x42f150=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY']['replace'](_0x4bf4fb(0xdf),_0xe3c97a[_0x4bf4fb(0xa7)])[_0x4bf4fb(0xb5)](_0x4bf4fb(0xc7),_0xe3c97a[_0x4bf4fb(0xc8)]?constants_1[_0x4bf4fb(0xb9)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x4fbdd8=await this['salesforceQuery'][_0x4bf4fb(0xa3)](_0x42f150),_0x2cdca8=(_0x12e4a4=_0x4fbdd8[0x0])===null||_0x12e4a4===void 0x0?void 0x0:_0x12e4a4['Id'];if(!_0x2cdca8)throw new Error(errors_1[_0x4bf4fb(0xce)]);return _0x2cdca8;}async['getRemoteStateAttachmentId'](_0x1efbb0){const _0xe95a58=a254_0x266e48;let _0x586815=await this[_0xe95a58(0xa8)](_0x1efbb0)[_0xe95a58(0xe5)](()=>null);return!_0x586815&&(_0x586815=await this['salesforceService'][_0xe95a58(0xc4)](_0xe95a58(0xc3),{'Body':(0x0,utils_1[_0xe95a58(0xd6)])('{}'),'ParentId':_0x1efbb0[_0xe95a58(0xa7)],'ContentType':_0xe95a58(0xa5),'Name':_0x1efbb0['repositoryId']?constants_1[_0xe95a58(0xb9)]:constants_1[_0xe95a58(0xaa)]})),_0x586815;}async['updateRemoteState'](_0x29a8bc,_0x21f78f){const _0x239ba2=a254_0x266e48,_0x2bf62c=await this['getRemoteStateAttachmentId'](_0x29a8bc);await this[_0x239ba2(0xaf)]['patchObject'](_0x239ba2(0xc3),_0x2bf62c,{'Body':(0x0,utils_1[_0x239ba2(0xd6)])(JSON[_0x239ba2(0xb3)](_0x21f78f))});}async['setStatus'](_0xb77054,_0x2fa568){const _0xe0651b=a254_0x266e48;await this['salesforceService'][_0xe0651b(0xde)](_0xb77054['objectType'],_0xb77054[_0xe0651b(0xa7)],{[constants_1['FLOSUM_GIT_NAMESPACE']+'Synchronization_Status__c']:_0x2fa568});}async['disableSync'](_0x16f964){const _0x352576=a254_0x266e48;await this[_0x352576(0xaf)][_0x352576(0xde)](constants_1[_0x352576(0xec)]+_0x352576(0xe0),_0x16f964,{[constants_1[_0x352576(0xec)]+_0x352576(0xa9)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a254_0x266e48(0xd1)])(),__metadata(a254_0x266e48(0xca),[salesforce_query_service_1[a254_0x266e48(0xc2)],salesforce_service_1[a254_0x266e48(0x99)]])],SalesforceSyncService),exports[a254_0x266e48(0xe9)]=SalesforceSyncService;