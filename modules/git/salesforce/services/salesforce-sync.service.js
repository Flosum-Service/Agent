const a280_0x594d18=a280_0x262e;(function(_0x174a2f,_0x247268){const _0x3b660c=a280_0x262e,_0x2e6bf8=_0x174a2f();while(!![]){try{const _0x291286=parseInt(_0x3b660c(0x105))/0x1*(-parseInt(_0x3b660c(0x117))/0x2)+-parseInt(_0x3b660c(0x13e))/0x3+parseInt(_0x3b660c(0x124))/0x4+-parseInt(_0x3b660c(0x140))/0x5+-parseInt(_0x3b660c(0xfb))/0x6+parseInt(_0x3b660c(0x10a))/0x7*(parseInt(_0x3b660c(0xfc))/0x8)+-parseInt(_0x3b660c(0x101))/0x9*(-parseInt(_0x3b660c(0x104))/0xa);if(_0x291286===_0x247268)break;else _0x2e6bf8['push'](_0x2e6bf8['shift']());}catch(_0x239ee7){_0x2e6bf8['push'](_0x2e6bf8['shift']());}}}(a280_0x1d9e,0x20dbc));function a280_0x262e(_0x3313d0,_0x286f76){const _0x13ccd8=a280_0x1d9e();return a280_0x262e=function(_0x113337,_0x5545a7){_0x113337=_0x113337-0xe6;let _0x1d9e6c=_0x13ccd8[_0x113337];return _0x1d9e6c;},a280_0x262e(_0x3313d0,_0x286f76);}const a280_0x5545a7=(function(){let _0x1b1161=!![];return function(_0x420e8c,_0x347fcb){const _0x19c433=_0x1b1161?function(){const _0x3a79a1=a280_0x262e;if(_0x347fcb){const _0x24eef4=_0x347fcb[_0x3a79a1(0x139)](_0x420e8c,arguments);return _0x347fcb=null,_0x24eef4;}}:function(){};return _0x1b1161=![],_0x19c433;};}()),a280_0x113337=a280_0x5545a7(this,function(){const _0x8f4003=a280_0x262e;return a280_0x113337[_0x8f4003(0x12c)]()[_0x8f4003(0x131)](_0x8f4003(0xe8))[_0x8f4003(0x12c)]()['constructor'](a280_0x113337)[_0x8f4003(0x131)](_0x8f4003(0xe8));});a280_0x113337();function a280_0x1d9e(){const _0x1f3b74=['fromRepositoryRecord','salesforceService','FLOSUM_GIT_NAMESPACE','../../../../constants','GET_BRANCH_BY_NAME_QUERY','58zTaMCS','Name','push','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','fromBranchRecord','map','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','__decorate','GET_WAITING_REPOSITORIES_QUERY','SalesforceSyncService','Components__r','repositoryId','getAttachmentId','434828IKejxI','length','../dto/flosum-repository-sync.dto','GET_REPOSITORIES_NAMES_QUERY','find','getAllRepositoryNames','FLOSUM_NAMESPACE','getBranchRecordByName','toString','Branch\x20','__metadata','object','Repository\x20with\x20Id\x20','search','design:paramtypes','salesforceQuery','updateRemoteState','Attachment','replace','decorate','%id%','apply','setStatus','Repository__r','catch','\x20not\x20found\x20on\x20salesforce','552078EpOIbQ','objectType','92880aKyTYf','__esModule','FlosumRepositorySyncDto','GET_COMPONENTS_QUERY','(((.+)+)+)+$','../queries','SYNC_ATTACHMENT_FOR_BRANCH_NAME','\x0a\x20\x20\x20\x20\x20\x20','patchObject','getRepositoryRecordByName','objectId','Branch_Name__c','getComponents','getBranchRecord','SalesforceService','getBranchComponents','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','function','ERR_INVALID_ATTACHMENT_ID','getBranchRecords','defineProperty','query','encodeBase64','567336ODvfBG','984sYTHYI','typedi','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','%parentId%','Connection__c','726957nOQxGW','SalesforceNotFoundError','metadata','40NEEJTm','7543KbhsbK','./salesforce.service','getComponentsFromRepository','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','GET_REPOSITORY_QUERY','12446AdOqTc','Repository\x20','Synchronization_Status__c','GET_BRANCH_QUERY','%name%','getRepositoryRecords','getRemoteStateAttachmentId','disableSync'];a280_0x1d9e=function(){return _0x1f3b74;};return a280_0x1d9e();}'use strict';var __decorate=this&&this[a280_0x594d18(0x11e)]||function(_0x1db4d1,_0x5d2bcf,_0x4963e9,_0x163a31){const _0x34b995=a280_0x594d18;var _0x5d9d6d=arguments[_0x34b995(0x125)],_0x3a2d61=_0x5d9d6d<0x3?_0x5d2bcf:_0x163a31===null?_0x163a31=Object['getOwnPropertyDescriptor'](_0x5d2bcf,_0x4963e9):_0x163a31,_0x23cfda;if(typeof Reflect==='object'&&typeof Reflect[_0x34b995(0x137)]===_0x34b995(0xf5))_0x3a2d61=Reflect[_0x34b995(0x137)](_0x1db4d1,_0x5d2bcf,_0x4963e9,_0x163a31);else{for(var _0x30c938=_0x1db4d1['length']-0x1;_0x30c938>=0x0;_0x30c938--)if(_0x23cfda=_0x1db4d1[_0x30c938])_0x3a2d61=(_0x5d9d6d<0x3?_0x23cfda(_0x3a2d61):_0x5d9d6d>0x3?_0x23cfda(_0x5d2bcf,_0x4963e9,_0x3a2d61):_0x23cfda(_0x5d2bcf,_0x4963e9))||_0x3a2d61;}return _0x5d9d6d>0x3&&_0x3a2d61&&Object[_0x34b995(0xf8)](_0x5d2bcf,_0x4963e9,_0x3a2d61),_0x3a2d61;},__metadata=this&&this[a280_0x594d18(0x12e)]||function(_0x48ac42,_0x33347e){const _0x225438=a280_0x594d18;if(typeof Reflect===_0x225438(0x12f)&&typeof Reflect[_0x225438(0x103)]===_0x225438(0xf5))return Reflect['metadata'](_0x48ac42,_0x33347e);};Object[a280_0x594d18(0xf8)](exports,a280_0x594d18(0x141),{'value':!![]}),exports[a280_0x594d18(0x120)]=void 0x0;const typedi_1=require(a280_0x594d18(0xfd)),constants_1=require(a280_0x594d18(0x115)),errors_1=require('../../../../constants/errors'),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a280_0x594d18(0x126)),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a280_0x594d18(0xe9)),salesforce_query_service_1=require('./salesforce-query.service'),salesforce_service_1=require(a280_0x594d18(0x106));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x13d2aa,_0xc887d1){const _0x36bee3=a280_0x594d18;this[_0x36bee3(0x133)]=_0x13d2aa,this[_0x36bee3(0x113)]=_0xc887d1;}async[a280_0x594d18(0xf0)](_0x2bd5e0){const _0xd612d9=a280_0x594d18;var _0xc45da3;const _0x10833a=await this[_0xd612d9(0x133)][_0xd612d9(0xf9)](_0x2bd5e0),_0x55a555=[];for(const _0x1f2cc0 of _0x10833a){const _0x294b12=(_0xc45da3=_0x1f2cc0[constants_1[_0xd612d9(0x12a)]+_0xd612d9(0x121)])===null||_0xc45da3===void 0x0?void 0x0:_0xc45da3['records'];_0x294b12&&_0x294b12[_0xd612d9(0x125)]&&_0x55a555[_0xd612d9(0x119)](_0x294b12[0x0]['Id']);}return _0x55a555;}async[a280_0x594d18(0x129)](_0x38c839){const _0xeedd3c=a280_0x594d18,_0xeedcde=await this[_0xeedd3c(0x133)][_0xeedd3c(0xf9)](queries_1[_0xeedd3c(0x127)]['replace'](/\%connection_id\%/g,_0x38c839));return _0xeedcde[_0xeedd3c(0x11c)](_0x542d7d=>{const _0x322228=_0xeedd3c;return _0x542d7d[constants_1[_0x322228(0x114)]+'Repository__r']?_0x542d7d[constants_1[_0x322228(0x114)]+_0x322228(0x13b)][_0x322228(0x118)]:_0x542d7d[_0x322228(0x118)];});}async[a280_0x594d18(0x10f)](_0x56d9ac){const _0x4157e5=a280_0x594d18,_0x243dcf=await this[_0x4157e5(0x133)][_0x4157e5(0xf9)](queries_1[_0x4157e5(0x11f)]['replace'](/\%connection_id\%/g,_0x56d9ac));return _0x243dcf[_0x4157e5(0x11c)](_0x28fba1=>flosum_repository_sync_dto_1[_0x4157e5(0xe6)][_0x4157e5(0x112)](_0x28fba1));}async[a280_0x594d18(0xf7)](_0x2ebcb1){const _0xfa0a0b=a280_0x594d18,_0x2eb728=await this['salesforceQuery'][_0xfa0a0b(0xf9)](queries_1['GET_WAITING_BRANCHES_QUERY']['replace'](/%repositories_ids\%/g,_0x2ebcb1));return _0x2eb728[_0xfa0a0b(0x11c)](_0x26a750=>flosum_repository_sync_dto_1[_0xfa0a0b(0xe6)]['fromBranchRecord'](_0x26a750));}async['getRepositoryRecord'](_0x3247ef){const _0x424186=a280_0x594d18,_0x37b746=await this[_0x424186(0x133)]['query'](queries_1[_0x424186(0x109)][_0x424186(0x136)](_0x424186(0x138),_0x3247ef));if(_0x37b746['length']===0x0)throw new not_found_error_1[(_0x424186(0x102))](_0x424186(0x130)+_0x3247ef+_0x424186(0x13d));return flosum_repository_sync_dto_1[_0x424186(0xe6)]['fromRepositoryRecord'](_0x37b746[0x0]);}async[a280_0x594d18(0xf1)](_0xc5bc57){const _0x47946b=a280_0x594d18,_0x1f0eec=await this[_0x47946b(0x133)][_0x47946b(0xf9)](queries_1[_0x47946b(0x10d)][_0x47946b(0x136)](_0x47946b(0x138),_0xc5bc57));if(_0x1f0eec['length']===0x0)throw new not_found_error_1[(_0x47946b(0x102))]('Branch\x20with\x20Id\x20'+_0xc5bc57+_0x47946b(0x13d));return flosum_repository_sync_dto_1[_0x47946b(0xe6)][_0x47946b(0x11b)](_0x1f0eec[0x0]);}async[a280_0x594d18(0x12b)](_0x475bfb){const _0x3e6888=a280_0x594d18,_0xccabf1=await this[_0x3e6888(0x133)][_0x3e6888(0xf9)](queries_1[_0x3e6888(0x116)][_0x3e6888(0x136)]('%name%',_0x475bfb));if(_0xccabf1[_0x3e6888(0x125)]===0x0)throw new not_found_error_1[(_0x3e6888(0x102))](_0x3e6888(0x12d)+_0x475bfb+_0x3e6888(0x13d));const _0x55f440=_0xccabf1[_0x3e6888(0x128)](_0x5ee844=>_0x5ee844[constants_1[_0x3e6888(0x12a)]+_0x3e6888(0xef)]===_0x475bfb);if(!_0x55f440)throw new not_found_error_1[(_0x3e6888(0x102))](_0x3e6888(0x12d)+_0x475bfb+_0x3e6888(0x13d));return flosum_repository_sync_dto_1[_0x3e6888(0xe6)]['fromBranchRecord'](_0x55f440);}async[a280_0x594d18(0xed)](_0x3ad490){const _0x501a6a=a280_0x594d18,_0x300e49=await this['salesforceQuery'][_0x501a6a(0xf9)](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x501a6a(0x136)](_0x501a6a(0x10e),_0x3ad490));if(_0x300e49['length']===0x0)throw new not_found_error_1[(_0x501a6a(0x102))](_0x501a6a(0x10b)+_0x3ad490+_0x501a6a(0x13d));return flosum_repository_sync_dto_1[_0x501a6a(0xe6)][_0x501a6a(0x112)](_0x300e49[0x0]);}async[a280_0x594d18(0x107)](_0x2ad2a3){const _0x55ad6d=a280_0x594d18,_0x5c8b8f=_0x55ad6d(0xeb)+queries_1[_0x55ad6d(0xe7)]+_0x55ad6d(0x108)+_0x2ad2a3+'\x27';return this[_0x55ad6d(0xf0)](_0x5c8b8f);}async[a280_0x594d18(0xf3)](_0x5ec228){const _0xbfbfe1=a280_0x594d18,_0x4fae3d=_0xbfbfe1(0xf4)+queries_1[_0xbfbfe1(0xe7)]+_0xbfbfe1(0xfe)+_0x5ec228+'\x27';return this[_0xbfbfe1(0xf0)](_0x4fae3d);}async[a280_0x594d18(0x123)](_0x11c83f){const _0x5813d8=a280_0x594d18;var _0xd571b9;const _0x347c60=queries_1[_0x5813d8(0x11d)]['replace'](_0x5813d8(0xff),_0x11c83f[_0x5813d8(0xee)])['replace'](_0x5813d8(0x10e),_0x11c83f[_0x5813d8(0x122)]?constants_1[_0x5813d8(0x11a)]:constants_1[_0x5813d8(0xea)]),_0x15211a=await this[_0x5813d8(0x133)][_0x5813d8(0xf9)](_0x347c60),_0x3fd4b0=(_0xd571b9=_0x15211a[0x0])===null||_0xd571b9===void 0x0?void 0x0:_0xd571b9['Id'];if(!_0x3fd4b0)throw new Error(errors_1[_0x5813d8(0xf6)]);return _0x3fd4b0;}async[a280_0x594d18(0x110)](_0x5c4667){const _0x9a7540=a280_0x594d18;let _0x3708ed=await this['getAttachmentId'](_0x5c4667)[_0x9a7540(0x13c)](()=>null);return!_0x3708ed&&(_0x3708ed=await this[_0x9a7540(0x113)]['createObject'](_0x9a7540(0x135),{'Body':(0x0,utils_1[_0x9a7540(0xfa)])('{}'),'ParentId':_0x5c4667[_0x9a7540(0xee)],'ContentType':'text/plain','Name':_0x5c4667['repositoryId']?constants_1[_0x9a7540(0x11a)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x3708ed;}async[a280_0x594d18(0x134)](_0x30e2c6,_0x5a36c7){const _0x33648e=a280_0x594d18,_0x575c9b=await this[_0x33648e(0x110)](_0x30e2c6);await this[_0x33648e(0x113)][_0x33648e(0xec)](_0x33648e(0x135),_0x575c9b,{'Body':(0x0,utils_1[_0x33648e(0xfa)])(JSON['stringify'](_0x5a36c7))});}async[a280_0x594d18(0x13a)](_0xb2b757,_0x559b19){const _0x297bdb=a280_0x594d18;await this['salesforceService'][_0x297bdb(0xec)](_0xb2b757[_0x297bdb(0x13f)],_0xb2b757[_0x297bdb(0xee)],{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x297bdb(0x10c)]:_0x559b19});}async[a280_0x594d18(0x111)](_0x59b4c3){const _0x40f7fc=a280_0x594d18;await this[_0x40f7fc(0x113)][_0x40f7fc(0xec)](constants_1[_0x40f7fc(0x114)]+_0x40f7fc(0x100),_0x59b4c3,{[constants_1[_0x40f7fc(0x114)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1['Service'])(),__metadata(a280_0x594d18(0x132),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a280_0x594d18(0xf2)]])],SalesforceSyncService),exports[a280_0x594d18(0x120)]=SalesforceSyncService;