const a243_0x112cbf=a243_0x3035;(function(_0x288db1,_0x340098){const _0x5ae473=a243_0x3035,_0xfd7a6f=_0x288db1();while(!![]){try{const _0x7c4ac0=-parseInt(_0x5ae473(0x1dd))/0x1+-parseInt(_0x5ae473(0x19a))/0x2+-parseInt(_0x5ae473(0x1d4))/0x3+-parseInt(_0x5ae473(0x18c))/0x4+-parseInt(_0x5ae473(0x19b))/0x5+parseInt(_0x5ae473(0x1c5))/0x6*(parseInt(_0x5ae473(0x19f))/0x7)+-parseInt(_0x5ae473(0x1c0))/0x8*(-parseInt(_0x5ae473(0x1a0))/0x9);if(_0x7c4ac0===_0x340098)break;else _0xfd7a6f['push'](_0xfd7a6f['shift']());}catch(_0x3a299b){_0xfd7a6f['push'](_0xfd7a6f['shift']());}}}(a243_0x299d,0x7394d));const a243_0x3f1272=(function(){let _0x4506d1=!![];return function(_0x28e914,_0x379f5d){const _0x3b1894=_0x4506d1?function(){const _0x1e60dd=a243_0x3035;if(_0x379f5d){const _0x39c669=_0x379f5d[_0x1e60dd(0x1e2)](_0x28e914,arguments);return _0x379f5d=null,_0x39c669;}}:function(){};return _0x4506d1=![],_0x3b1894;};}()),a243_0x4eda22=a243_0x3f1272(this,function(){const _0x32ce4a=a243_0x3035;return a243_0x4eda22[_0x32ce4a(0x1c6)]()[_0x32ce4a(0x18b)](_0x32ce4a(0x1bd))['toString']()[_0x32ce4a(0x1e0)](a243_0x4eda22)[_0x32ce4a(0x18b)](_0x32ce4a(0x1bd));});a243_0x4eda22();'use strict';function a243_0x299d(){const _0x42845b=['objectId','SalesforceQueryService','map','../../../../constants','SYNC_ATTACHMENT_FOR_BRANCH_NAME','\x0a\x20\x20\x20\x20\x20\x20','Connection__c','fromBranchRecord','__esModule','object','Branch\x20','stringify','text/plain','Branch_Name__c','getBranchComponents','replace','patchObject','Name','getRepositoryRecord','getComponentsFromRepository','function','GET_REPOSITORY_QUERY','(((.+)+)+)+$','GET_REPOSITORIES_NAMES_QUERY','SalesforceService','4945552QBsJLs','decorate','query','__decorate','%parentId%','6BmSgus','toString','FLOSUM_GIT_NAMESPACE','%name%','getComponents','Repository__r','%id%','SalesforceSyncService','getBranchRecord','getAttachmentId','typedi','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','metadata','salesforceQuery','getBranchRecordByName','213906mLTMLk','GET_WAITING_REPOSITORIES_QUERY','Repository\x20','Synchronization_Status__c','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','getRepositoryRecordByName','catch','FlosumRepositorySyncDto','updateRemoteState','671188fxxEHW','repositoryId','salesforceService','constructor','getAllRepositoryNames','apply','FLOSUM_NAMESPACE','design:paramtypes','ERR_INVALID_ATTACHMENT_ID','search','699364GmrhgE','SalesforceNotFoundError','GET_BRANCH_QUERY','fromRepositoryRecord','./salesforce.service','length','GET_COMPONENTS_QUERY','Branch\x20with\x20Id\x20','../../../shared/utils','../../../../constants/errors','Service','\x20not\x20found\x20on\x20salesforce','getBranchRecords','Attachment','1821336tGNvKS','1656125osxrLi','objectType','GET_WAITING_BRANCHES_QUERY','createObject','1119083nbPliZ','36lSbPPS','getOwnPropertyDescriptor','../errors/not-found.error','Components__r','getRemoteStateAttachmentId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','GET_REPOSITORY_BY_NAME_QUERY'];a243_0x299d=function(){return _0x42845b;};return a243_0x299d();}var __decorate=this&&this[a243_0x112cbf(0x1c3)]||function(_0x4aec8f,_0x2013a7,_0x1ffed7,_0x41cc2c){const _0x229e73=a243_0x112cbf;var _0xab7c25=arguments[_0x229e73(0x191)],_0x27cb89=_0xab7c25<0x3?_0x2013a7:_0x41cc2c===null?_0x41cc2c=Object[_0x229e73(0x1a1)](_0x2013a7,_0x1ffed7):_0x41cc2c,_0x13949c;if(typeof Reflect===_0x229e73(0x1b0)&&typeof Reflect['decorate']===_0x229e73(0x1bb))_0x27cb89=Reflect[_0x229e73(0x1c1)](_0x4aec8f,_0x2013a7,_0x1ffed7,_0x41cc2c);else{for(var _0xf550ed=_0x4aec8f[_0x229e73(0x191)]-0x1;_0xf550ed>=0x0;_0xf550ed--)if(_0x13949c=_0x4aec8f[_0xf550ed])_0x27cb89=(_0xab7c25<0x3?_0x13949c(_0x27cb89):_0xab7c25>0x3?_0x13949c(_0x2013a7,_0x1ffed7,_0x27cb89):_0x13949c(_0x2013a7,_0x1ffed7))||_0x27cb89;}return _0xab7c25>0x3&&_0x27cb89&&Object['defineProperty'](_0x2013a7,_0x1ffed7,_0x27cb89),_0x27cb89;},__metadata=this&&this['__metadata']||function(_0x4e396e,_0x3f7d40){const _0x1c9e43=a243_0x112cbf;if(typeof Reflect===_0x1c9e43(0x1b0)&&typeof Reflect[_0x1c9e43(0x1d1)]==='function')return Reflect[_0x1c9e43(0x1d1)](_0x4e396e,_0x3f7d40);};Object['defineProperty'](exports,a243_0x112cbf(0x1af),{'value':!![]}),exports[a243_0x112cbf(0x1cc)]=void 0x0;const typedi_1=require(a243_0x112cbf(0x1cf)),constants_1=require(a243_0x112cbf(0x1aa)),errors_1=require(a243_0x112cbf(0x195)),utils_1=require(a243_0x112cbf(0x194)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a243_0x112cbf(0x1a2)),queries_1=require('../queries'),salesforce_query_service_1=require('./salesforce-query.service'),salesforce_service_1=require(a243_0x112cbf(0x190));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x5038a7,_0x7b62e6){this['salesforceQuery']=_0x5038a7,this['salesforceService']=_0x7b62e6;}async['getComponents'](_0x4b6b61){const _0x24c5a6=a243_0x112cbf;var _0x10e811;const _0x1a0070=await this[_0x24c5a6(0x1d2)]['query'](_0x4b6b61),_0x46fdf1=[];for(const _0x5d26c6 of _0x1a0070){const _0x10b2c2=(_0x10e811=_0x5d26c6[constants_1[_0x24c5a6(0x1e3)]+_0x24c5a6(0x1a3)])===null||_0x10e811===void 0x0?void 0x0:_0x10e811['records'];_0x10b2c2&&_0x10b2c2[_0x24c5a6(0x191)]&&_0x46fdf1['push'](_0x10b2c2[0x0]['Id']);}return _0x46fdf1;}async[a243_0x112cbf(0x1e1)](_0xe664a5){const _0x5d1599=a243_0x112cbf,_0x2a5b06=await this[_0x5d1599(0x1d2)][_0x5d1599(0x1c2)](queries_1[_0x5d1599(0x1be)][_0x5d1599(0x1b6)](/\%connection_id\%/g,_0xe664a5));return _0x2a5b06[_0x5d1599(0x1a9)](_0x27b1b4=>{const _0x538783=_0x5d1599;return _0x27b1b4[constants_1['FLOSUM_GIT_NAMESPACE']+_0x538783(0x1ca)]?_0x27b1b4[constants_1['FLOSUM_GIT_NAMESPACE']+_0x538783(0x1ca)][_0x538783(0x1b8)]:_0x27b1b4[_0x538783(0x1b8)];});}async['getRepositoryRecords'](_0x3f202f){const _0x46defb=a243_0x112cbf,_0x596598=await this[_0x46defb(0x1d2)][_0x46defb(0x1c2)](queries_1[_0x46defb(0x1d5)][_0x46defb(0x1b6)](/\%connection_id\%/g,_0x3f202f));return _0x596598[_0x46defb(0x1a9)](_0x526674=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x46defb(0x18f)](_0x526674));}async[a243_0x112cbf(0x198)](_0x4b5844){const _0x24f02a=a243_0x112cbf,_0x34f51c=await this[_0x24f02a(0x1d2)]['query'](queries_1[_0x24f02a(0x19d)][_0x24f02a(0x1b6)](/%repositories_ids\%/g,_0x4b5844));return _0x34f51c[_0x24f02a(0x1a9)](_0x44b5e2=>flosum_repository_sync_dto_1[_0x24f02a(0x1db)]['fromBranchRecord'](_0x44b5e2));}async[a243_0x112cbf(0x1b9)](_0x172b85){const _0x4d0a68=a243_0x112cbf,_0x50e2e4=await this[_0x4d0a68(0x1d2)][_0x4d0a68(0x1c2)](queries_1[_0x4d0a68(0x1bc)][_0x4d0a68(0x1b6)](_0x4d0a68(0x1cb),_0x172b85));if(_0x50e2e4[_0x4d0a68(0x191)]===0x0)throw new not_found_error_1[(_0x4d0a68(0x18d))]('Repository\x20with\x20Id\x20'+_0x172b85+_0x4d0a68(0x197));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x4d0a68(0x18f)](_0x50e2e4[0x0]);}async[a243_0x112cbf(0x1cd)](_0xaca1f5){const _0x20a5c3=a243_0x112cbf,_0xce43a2=await this[_0x20a5c3(0x1d2)][_0x20a5c3(0x1c2)](queries_1[_0x20a5c3(0x18e)]['replace']('%id%',_0xaca1f5));if(_0xce43a2[_0x20a5c3(0x191)]===0x0)throw new not_found_error_1[(_0x20a5c3(0x18d))](_0x20a5c3(0x193)+_0xaca1f5+_0x20a5c3(0x197));return flosum_repository_sync_dto_1[_0x20a5c3(0x1db)][_0x20a5c3(0x1ae)](_0xce43a2[0x0]);}async[a243_0x112cbf(0x1d3)](_0x553114){const _0x285d5e=a243_0x112cbf,_0x592c79=await this[_0x285d5e(0x1d2)][_0x285d5e(0x1c2)](queries_1['GET_BRANCH_BY_NAME_QUERY']['replace']('%name%',_0x553114));if(_0x592c79[_0x285d5e(0x191)]===0x0)throw new not_found_error_1[(_0x285d5e(0x18d))](_0x285d5e(0x1b1)+_0x553114+_0x285d5e(0x197));const _0x4ba46d=_0x592c79['find'](_0x130215=>_0x130215[constants_1[_0x285d5e(0x1e3)]+_0x285d5e(0x1b4)]===_0x553114);if(!_0x4ba46d)throw new not_found_error_1[(_0x285d5e(0x18d))]('Branch\x20'+_0x553114+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x285d5e(0x1ae)](_0x4ba46d);}async[a243_0x112cbf(0x1d9)](_0x258f3e){const _0x334807=a243_0x112cbf,_0x246ddc=await this[_0x334807(0x1d2)][_0x334807(0x1c2)](queries_1[_0x334807(0x1a6)][_0x334807(0x1b6)](_0x334807(0x1c8),_0x258f3e));if(_0x246ddc[_0x334807(0x191)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x334807(0x1d6)+_0x258f3e+_0x334807(0x197));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x246ddc[0x0]);}async[a243_0x112cbf(0x1ba)](_0x57c0e0){const _0x602066=a243_0x112cbf,_0x25537f=_0x602066(0x1ac)+queries_1['GET_COMPONENTS_QUERY']+_0x602066(0x1d0)+_0x57c0e0+'\x27';return this[_0x602066(0x1c9)](_0x25537f);}async[a243_0x112cbf(0x1b5)](_0x58f8c9){const _0x31b2d0=a243_0x112cbf,_0x504211='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x31b2d0(0x192)]+_0x31b2d0(0x1a5)+_0x58f8c9+'\x27';return this[_0x31b2d0(0x1c9)](_0x504211);}async[a243_0x112cbf(0x1ce)](_0x1f9fb1){const _0x313bea=a243_0x112cbf;var _0x1f6134;const _0xbc2a85=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x313bea(0x1b6)](_0x313bea(0x1c4),_0x1f9fb1[_0x313bea(0x1a7)])[_0x313bea(0x1b6)](_0x313bea(0x1c8),_0x1f9fb1[_0x313bea(0x1de)]?constants_1[_0x313bea(0x1d8)]:constants_1[_0x313bea(0x1ab)]),_0x5e4394=await this[_0x313bea(0x1d2)][_0x313bea(0x1c2)](_0xbc2a85),_0x4d27e4=(_0x1f6134=_0x5e4394[0x0])===null||_0x1f6134===void 0x0?void 0x0:_0x1f6134['Id'];if(!_0x4d27e4)throw new Error(errors_1[_0x313bea(0x1e5)]);return _0x4d27e4;}async[a243_0x112cbf(0x1a4)](_0x5bd91c){const _0x529689=a243_0x112cbf;let _0x323a44=await this['getAttachmentId'](_0x5bd91c)[_0x529689(0x1da)](()=>null);return!_0x323a44&&(_0x323a44=await this['salesforceService'][_0x529689(0x19e)](_0x529689(0x199),{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x5bd91c[_0x529689(0x1a7)],'ContentType':_0x529689(0x1b3),'Name':_0x5bd91c[_0x529689(0x1de)]?constants_1[_0x529689(0x1d8)]:constants_1[_0x529689(0x1ab)]})),_0x323a44;}async[a243_0x112cbf(0x1dc)](_0x3d88aa,_0x263013){const _0x189746=a243_0x112cbf,_0x222780=await this[_0x189746(0x1a4)](_0x3d88aa);await this['salesforceService'][_0x189746(0x1b7)](_0x189746(0x199),_0x222780,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0x189746(0x1b2)](_0x263013))});}async['setStatus'](_0xa6811d,_0x3b48a8){const _0x5cdacd=a243_0x112cbf;await this[_0x5cdacd(0x1df)]['patchObject'](_0xa6811d[_0x5cdacd(0x19c)],_0xa6811d['objectId'],{[constants_1[_0x5cdacd(0x1c7)]+_0x5cdacd(0x1d7)]:_0x3b48a8});}async['disableSync'](_0x1c8858){const _0x47b6a9=a243_0x112cbf;await this['salesforceService']['patchObject'](constants_1[_0x47b6a9(0x1c7)]+_0x47b6a9(0x1ad),_0x1c8858,{[constants_1[_0x47b6a9(0x1c7)]+'Sync_In_Progress__c']:![]});}};function a243_0x3035(_0x3abac2,_0x287347){const _0x1a57fe=a243_0x299d();return a243_0x3035=function(_0x4eda22,_0x3f1272){_0x4eda22=_0x4eda22-0x18b;let _0x299dce=_0x1a57fe[_0x4eda22];return _0x299dce;},a243_0x3035(_0x3abac2,_0x287347);}SalesforceSyncService=__decorate([(0x0,typedi_1[a243_0x112cbf(0x196)])(),__metadata(a243_0x112cbf(0x1e4),[salesforce_query_service_1[a243_0x112cbf(0x1a8)],salesforce_service_1[a243_0x112cbf(0x1bf)]])],SalesforceSyncService),exports[a243_0x112cbf(0x1cc)]=SalesforceSyncService;