const a280_0x193018=a280_0x5457;(function(_0x894650,_0x1dbf3b){const _0xe98848=a280_0x5457,_0x652da2=_0x894650();while(!![]){try{const _0x438a18=-parseInt(_0xe98848(0x1a9))/0x1+-parseInt(_0xe98848(0x1f8))/0x2+parseInt(_0xe98848(0x1c4))/0x3*(-parseInt(_0xe98848(0x1f3))/0x4)+-parseInt(_0xe98848(0x1fa))/0x5*(-parseInt(_0xe98848(0x1d8))/0x6)+parseInt(_0xe98848(0x1c5))/0x7*(parseInt(_0xe98848(0x1ec))/0x8)+-parseInt(_0xe98848(0x1bd))/0x9+parseInt(_0xe98848(0x1d2))/0xa*(parseInt(_0xe98848(0x1cc))/0xb);if(_0x438a18===_0x1dbf3b)break;else _0x652da2['push'](_0x652da2['shift']());}catch(_0x109d0f){_0x652da2['push'](_0x652da2['shift']());}}}(a280_0x9ece,0x88706));const a280_0xddd315=(function(){let _0x504455=!![];return function(_0x306009,_0x59876a){const _0x3bf54f=_0x504455?function(){const _0x23244d=a280_0x5457;if(_0x59876a){const _0x1d3cbb=_0x59876a[_0x23244d(0x1b7)](_0x306009,arguments);return _0x59876a=null,_0x1d3cbb;}}:function(){};return _0x504455=![],_0x3bf54f;};}()),a280_0x5389c1=a280_0xddd315(this,function(){const _0x5b46c9=a280_0x5457;return a280_0x5389c1[_0x5b46c9(0x1c6)]()[_0x5b46c9(0x200)]('(((.+)+)+)+$')[_0x5b46c9(0x1c6)]()[_0x5b46c9(0x1b5)](a280_0x5389c1)[_0x5b46c9(0x200)]('(((.+)+)+)+$');});function a280_0x9ece(){const _0x3bb91f=['Connection__c','getComponentsFromRepository','catch','./salesforce-query.service','updateRemoteState','replace','decorate','GET_REPOSITORIES_NAMES_QUERY','constructor','design:paramtypes','apply','createObject','patchObject','find','SalesforceQueryService','getRepositoryRecordByName','8924247nsdquk','SYNC_ATTACHMENT_FOR_BRANCH_NAME','../../../../constants','stringify','SalesforceSyncService','SalesforceNotFoundError','FLOSUM_GIT_NAMESPACE','155739PCfaiS','14uswgFW','toString','records','GET_REPOSITORY_QUERY','Repository\x20','GET_REPOSITORY_BY_NAME_QUERY','objectType','14891151llmPuI','salesforceQuery','function','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','FlosumRepositorySyncDto','10cnXxUV','getComponents','fromBranchRecord','getBranchRecordByName','getRemoteStateAttachmentId','encodeBase64','5136594DGKrcg','../../../shared/utils','query','text/plain','disableSync','%parentId%','push','objectId','GET_BRANCH_BY_NAME_QUERY','getAttachmentId','getBranchRecord','__decorate','GET_COMPONENTS_QUERY','object','Branch\x20','\x20not\x20found\x20on\x20salesforce','%name%','length','Attachment','__esModule','4036280mQvPHP','Repository__r','setStatus','Name','Sync_In_Progress__c','map','GET_BRANCH_QUERY','52LORgKD','Branch\x20with\x20Id\x20','./salesforce.service','Service','GET_WAITING_BRANCHES_QUERY','1032634WiivJu','fromRepositoryRecord','5DjDCRH','GET_WAITING_REPOSITORIES_QUERY','defineProperty','__metadata','salesforceService','getRepositoryRecord','search','../queries','getAllRepositoryNames','FLOSUM_NAMESPACE','getRepositoryRecords','typedi','477287hwXdQE','../errors/not-found.error','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','getBranchRecords'];a280_0x9ece=function(){return _0x3bb91f;};return a280_0x9ece();}a280_0x5389c1();function a280_0x5457(_0xa9847d,_0x351044){const _0x6f179b=a280_0x9ece();return a280_0x5457=function(_0x5389c1,_0xddd315){_0x5389c1=_0x5389c1-0x1a8;let _0x9ece14=_0x6f179b[_0x5389c1];return _0x9ece14;},a280_0x5457(_0xa9847d,_0x351044);}'use strict';var __decorate=this&&this[a280_0x193018(0x1e3)]||function(_0xc5eba4,_0x2bd4e5,_0x98cf71,_0x2b2af0){const _0x562b38=a280_0x193018;var _0x2a158a=arguments[_0x562b38(0x1e9)],_0x5206c5=_0x2a158a<0x3?_0x2bd4e5:_0x2b2af0===null?_0x2b2af0=Object['getOwnPropertyDescriptor'](_0x2bd4e5,_0x98cf71):_0x2b2af0,_0x55a0fc;if(typeof Reflect===_0x562b38(0x1e5)&&typeof Reflect[_0x562b38(0x1b3)]===_0x562b38(0x1ce))_0x5206c5=Reflect[_0x562b38(0x1b3)](_0xc5eba4,_0x2bd4e5,_0x98cf71,_0x2b2af0);else{for(var _0x2838c3=_0xc5eba4[_0x562b38(0x1e9)]-0x1;_0x2838c3>=0x0;_0x2838c3--)if(_0x55a0fc=_0xc5eba4[_0x2838c3])_0x5206c5=(_0x2a158a<0x3?_0x55a0fc(_0x5206c5):_0x2a158a>0x3?_0x55a0fc(_0x2bd4e5,_0x98cf71,_0x5206c5):_0x55a0fc(_0x2bd4e5,_0x98cf71))||_0x5206c5;}return _0x2a158a>0x3&&_0x5206c5&&Object[_0x562b38(0x1fc)](_0x2bd4e5,_0x98cf71,_0x5206c5),_0x5206c5;},__metadata=this&&this[a280_0x193018(0x1fd)]||function(_0x5a0709,_0x53511c){const _0x5ad10f=a280_0x193018;if(typeof Reflect===_0x5ad10f(0x1e5)&&typeof Reflect['metadata']===_0x5ad10f(0x1ce))return Reflect['metadata'](_0x5a0709,_0x53511c);};Object[a280_0x193018(0x1fc)](exports,a280_0x193018(0x1eb),{'value':!![]}),exports[a280_0x193018(0x1c1)]=void 0x0;const typedi_1=require(a280_0x193018(0x1a8)),constants_1=require(a280_0x193018(0x1bf)),errors_1=require('../../../../constants/errors'),utils_1=require(a280_0x193018(0x1d9)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a280_0x193018(0x1aa)),queries_1=require(a280_0x193018(0x201)),salesforce_query_service_1=require(a280_0x193018(0x1b0)),salesforce_service_1=require(a280_0x193018(0x1f5));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x468136,_0x15463e){const _0x45e8c0=a280_0x193018;this[_0x45e8c0(0x1cd)]=_0x468136,this[_0x45e8c0(0x1fe)]=_0x15463e;}async[a280_0x193018(0x1d3)](_0x1dde45){const _0x4c323c=a280_0x193018;var _0x175427;const _0x5e3fbc=await this['salesforceQuery']['query'](_0x1dde45),_0x3b0d74=[];for(const _0x53f44f of _0x5e3fbc){const _0x4e00fd=(_0x175427=_0x53f44f[constants_1[_0x4c323c(0x203)]+'Components__r'])===null||_0x175427===void 0x0?void 0x0:_0x175427[_0x4c323c(0x1c7)];_0x4e00fd&&_0x4e00fd[_0x4c323c(0x1e9)]&&_0x3b0d74[_0x4c323c(0x1de)](_0x4e00fd[0x0]['Id']);}return _0x3b0d74;}async[a280_0x193018(0x202)](_0xae0d89){const _0x4da313=a280_0x193018,_0xad7d63=await this['salesforceQuery'][_0x4da313(0x1da)](queries_1[_0x4da313(0x1b4)]['replace'](/\%connection_id\%/g,_0xae0d89));return _0xad7d63[_0x4da313(0x1f1)](_0x422ca5=>{const _0x12f387=_0x4da313;return _0x422ca5[constants_1[_0x12f387(0x1c3)]+_0x12f387(0x1ed)]?_0x422ca5[constants_1[_0x12f387(0x1c3)]+_0x12f387(0x1ed)][_0x12f387(0x1ef)]:_0x422ca5[_0x12f387(0x1ef)];});}async[a280_0x193018(0x204)](_0xfa845e){const _0x46d185=a280_0x193018,_0x513a1a=await this['salesforceQuery']['query'](queries_1[_0x46d185(0x1fb)][_0x46d185(0x1b2)](/\%connection_id\%/g,_0xfa845e));return _0x513a1a[_0x46d185(0x1f1)](_0x44f7f8=>flosum_repository_sync_dto_1[_0x46d185(0x1d1)]['fromRepositoryRecord'](_0x44f7f8));}async[a280_0x193018(0x1ac)](_0x3297de){const _0x22cdc6=a280_0x193018,_0x598bf0=await this['salesforceQuery'][_0x22cdc6(0x1da)](queries_1[_0x22cdc6(0x1f7)][_0x22cdc6(0x1b2)](/%repositories_ids\%/g,_0x3297de));return _0x598bf0[_0x22cdc6(0x1f1)](_0x2d8318=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0x2d8318));}async[a280_0x193018(0x1ff)](_0x55c50a){const _0x15fecd=a280_0x193018,_0xa2723a=await this[_0x15fecd(0x1cd)][_0x15fecd(0x1da)](queries_1[_0x15fecd(0x1c8)][_0x15fecd(0x1b2)]('%id%',_0x55c50a));if(_0xa2723a[_0x15fecd(0x1e9)]===0x0)throw new not_found_error_1[(_0x15fecd(0x1c2))]('Repository\x20with\x20Id\x20'+_0x55c50a+_0x15fecd(0x1e7));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x15fecd(0x1f9)](_0xa2723a[0x0]);}async[a280_0x193018(0x1e2)](_0x23ef41){const _0x45eaa2=a280_0x193018,_0x494db4=await this['salesforceQuery'][_0x45eaa2(0x1da)](queries_1[_0x45eaa2(0x1f2)][_0x45eaa2(0x1b2)]('%id%',_0x23ef41));if(_0x494db4['length']===0x0)throw new not_found_error_1[(_0x45eaa2(0x1c2))](_0x45eaa2(0x1f4)+_0x23ef41+_0x45eaa2(0x1e7));return flosum_repository_sync_dto_1[_0x45eaa2(0x1d1)][_0x45eaa2(0x1d4)](_0x494db4[0x0]);}async[a280_0x193018(0x1d5)](_0x1add13){const _0x2ebaa9=a280_0x193018,_0x286d0f=await this['salesforceQuery']['query'](queries_1[_0x2ebaa9(0x1e0)][_0x2ebaa9(0x1b2)]('%name%',_0x1add13));if(_0x286d0f[_0x2ebaa9(0x1e9)]===0x0)throw new not_found_error_1[(_0x2ebaa9(0x1c2))](_0x2ebaa9(0x1e6)+_0x1add13+_0x2ebaa9(0x1e7));const _0x5b929e=_0x286d0f[_0x2ebaa9(0x1ba)](_0x498151=>_0x498151[constants_1['FLOSUM_NAMESPACE']+'Branch_Name__c']===_0x1add13);if(!_0x5b929e)throw new not_found_error_1[(_0x2ebaa9(0x1c2))](_0x2ebaa9(0x1e6)+_0x1add13+_0x2ebaa9(0x1e7));return flosum_repository_sync_dto_1[_0x2ebaa9(0x1d1)][_0x2ebaa9(0x1d4)](_0x5b929e);}async[a280_0x193018(0x1bc)](_0x20d251){const _0x3d9eea=a280_0x193018,_0x3df032=await this[_0x3d9eea(0x1cd)][_0x3d9eea(0x1da)](queries_1[_0x3d9eea(0x1ca)][_0x3d9eea(0x1b2)](_0x3d9eea(0x1e8),_0x20d251));if(_0x3df032[_0x3d9eea(0x1e9)]===0x0)throw new not_found_error_1[(_0x3d9eea(0x1c2))](_0x3d9eea(0x1c9)+_0x20d251+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x3d9eea(0x1f9)](_0x3df032[0x0]);}async[a280_0x193018(0x1ae)](_0x1523ad){const _0x45dc8d=a280_0x193018,_0x4eaefe='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x45dc8d(0x1e4)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x1523ad+'\x27';return this['getComponents'](_0x4eaefe);}async['getBranchComponents'](_0x39bbb2){const _0x1e1db7=a280_0x193018,_0x266dff='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x1e1db7(0x1e4)]+_0x1e1db7(0x1ab)+_0x39bbb2+'\x27';return this[_0x1e1db7(0x1d3)](_0x266dff);}async[a280_0x193018(0x1e1)](_0x56d97d){const _0x1e3474=a280_0x193018;var _0x5ab483;const _0x23a4ed=queries_1[_0x1e3474(0x1cf)]['replace'](_0x1e3474(0x1dd),_0x56d97d[_0x1e3474(0x1df)])['replace']('%name%',_0x56d97d['repositoryId']?constants_1[_0x1e3474(0x1d0)]:constants_1[_0x1e3474(0x1be)]),_0xd3524d=await this['salesforceQuery']['query'](_0x23a4ed),_0x1b1e90=(_0x5ab483=_0xd3524d[0x0])===null||_0x5ab483===void 0x0?void 0x0:_0x5ab483['Id'];if(!_0x1b1e90)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x1b1e90;}async[a280_0x193018(0x1d6)](_0xbf8866){const _0x56b673=a280_0x193018;let _0x56101e=await this[_0x56b673(0x1e1)](_0xbf8866)[_0x56b673(0x1af)](()=>null);return!_0x56101e&&(_0x56101e=await this[_0x56b673(0x1fe)][_0x56b673(0x1b8)]('Attachment',{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0xbf8866[_0x56b673(0x1df)],'ContentType':_0x56b673(0x1db),'Name':_0xbf8866['repositoryId']?constants_1[_0x56b673(0x1d0)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x56101e;}async[a280_0x193018(0x1b1)](_0xdbced1,_0x2e7187){const _0x30ee01=a280_0x193018,_0x5617b1=await this['getRemoteStateAttachmentId'](_0xdbced1);await this[_0x30ee01(0x1fe)][_0x30ee01(0x1b9)](_0x30ee01(0x1ea),_0x5617b1,{'Body':(0x0,utils_1[_0x30ee01(0x1d7)])(JSON[_0x30ee01(0x1c0)](_0x2e7187))});}async[a280_0x193018(0x1ee)](_0x58b6b5,_0x2bc65b){const _0x593bf5=a280_0x193018;await this[_0x593bf5(0x1fe)]['patchObject'](_0x58b6b5[_0x593bf5(0x1cb)],_0x58b6b5[_0x593bf5(0x1df)],{[constants_1[_0x593bf5(0x1c3)]+'Synchronization_Status__c']:_0x2bc65b});}async[a280_0x193018(0x1dc)](_0x324284){const _0x28945f=a280_0x193018;await this[_0x28945f(0x1fe)][_0x28945f(0x1b9)](constants_1[_0x28945f(0x1c3)]+_0x28945f(0x1ad),_0x324284,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x28945f(0x1f0)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a280_0x193018(0x1f6)])(),__metadata(a280_0x193018(0x1b6),[salesforce_query_service_1[a280_0x193018(0x1bb)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;