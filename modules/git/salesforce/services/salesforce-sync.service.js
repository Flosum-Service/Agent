const a253_0x39432e=a253_0x579f;(function(_0x30f488,_0x147a9c){const _0x7b670d=a253_0x579f,_0x4b3f2c=_0x30f488();while(!![]){try{const _0x30968b=parseInt(_0x7b670d(0x9c))/0x1+parseInt(_0x7b670d(0x73))/0x2+parseInt(_0x7b670d(0xb6))/0x3+parseInt(_0x7b670d(0xab))/0x4+-parseInt(_0x7b670d(0xa9))/0x5+parseInt(_0x7b670d(0xa8))/0x6*(parseInt(_0x7b670d(0xa3))/0x7)+-parseInt(_0x7b670d(0x78))/0x8*(parseInt(_0x7b670d(0x8c))/0x9);if(_0x30968b===_0x147a9c)break;else _0x4b3f2c['push'](_0x4b3f2c['shift']());}catch(_0x2d90f0){_0x4b3f2c['push'](_0x4b3f2c['shift']());}}}(a253_0xc22e,0xbb188));const a253_0x492f08=(function(){let _0x248c33=!![];return function(_0x2d8513,_0x124eae){const _0x24daf8=_0x248c33?function(){if(_0x124eae){const _0x1ae1e2=_0x124eae['apply'](_0x2d8513,arguments);return _0x124eae=null,_0x1ae1e2;}}:function(){};return _0x248c33=![],_0x24daf8;};}()),a253_0x43e92b=a253_0x492f08(this,function(){const _0x22a0f4=a253_0x579f;return a253_0x43e92b[_0x22a0f4(0x6b)]()[_0x22a0f4(0xb9)]('(((.+)+)+)+$')['toString']()[_0x22a0f4(0x69)](a253_0x43e92b)[_0x22a0f4(0xb9)](_0x22a0f4(0x7d));});function a253_0xc22e(){const _0x5ed774=['function','Repository\x20','encodeBase64','getAllRepositoryNames','repositoryId','setStatus','GET_REPOSITORY_QUERY','GET_WAITING_REPOSITORIES_QUERY','salesforceQuery','getComponents','GET_REPOSITORIES_NAMES_QUERY','object','Name','27qbaGpv','SYNC_ATTACHMENT_FOR_BRANCH_NAME','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','FLOSUM_NAMESPACE','fromRepositoryRecord','getAttachmentId','patchObject','getBranchComponents','\x20not\x20found\x20on\x20salesforce','typedi','Connection__c','../queries','../errors/not-found.error','getBranchRecords','Branch\x20with\x20Id\x20','GET_REPOSITORY_BY_NAME_QUERY','1415119bsPopO','updateRemoteState','fromBranchRecord','Sync_In_Progress__c','../../../../constants/errors','Attachment','__esModule','21CLyBkk','records','GET_BRANCH_BY_NAME_QUERY','SalesforceNotFoundError','replace','689058yFsZYt','1185880CyLZsK','getRepositoryRecords','2794612HhyRes','SalesforceService','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','metadata','Synchronization_Status__c','GET_COMPONENTS_QUERY','../dto/flosum-repository-sync.dto','../../../../constants','Branch\x20','Branch_Name__c','1790520TdmXTC','FlosumRepositorySyncDto','getRemoteStateAttachmentId','search','map','length','createObject','getBranchRecordByName','%id%','decorate','design:paramtypes','objectId','constructor','Repository__r','toString','../../../shared/utils','%name%','FLOSUM_GIT_NAMESPACE','%parentId%','GET_BRANCH_QUERY','salesforceService','SalesforceSyncService','1712804QRRIpN','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','push','Components__r','getComponentsFromRepository','7754728umRkGh','GET_WAITING_BRANCHES_QUERY','./salesforce.service','query','defineProperty','(((.+)+)+)+$','Repository\x20with\x20Id\x20'];a253_0xc22e=function(){return _0x5ed774;};return a253_0xc22e();}a253_0x43e92b();'use strict';var __decorate=this&&this['__decorate']||function(_0x1d98a9,_0x18ccba,_0x306255,_0x18bba3){const _0x209819=a253_0x579f;var _0x3505b5=arguments[_0x209819(0xbb)],_0x3e6695=_0x3505b5<0x3?_0x18ccba:_0x18bba3===null?_0x18bba3=Object['getOwnPropertyDescriptor'](_0x18ccba,_0x306255):_0x18bba3,_0x318c49;if(typeof Reflect==='object'&&typeof Reflect[_0x209819(0xbf)]===_0x209819(0x7f))_0x3e6695=Reflect[_0x209819(0xbf)](_0x1d98a9,_0x18ccba,_0x306255,_0x18bba3);else{for(var _0x354345=_0x1d98a9[_0x209819(0xbb)]-0x1;_0x354345>=0x0;_0x354345--)if(_0x318c49=_0x1d98a9[_0x354345])_0x3e6695=(_0x3505b5<0x3?_0x318c49(_0x3e6695):_0x3505b5>0x3?_0x318c49(_0x18ccba,_0x306255,_0x3e6695):_0x318c49(_0x18ccba,_0x306255))||_0x3e6695;}return _0x3505b5>0x3&&_0x3e6695&&Object[_0x209819(0x7c)](_0x18ccba,_0x306255,_0x3e6695),_0x3e6695;},__metadata=this&&this['__metadata']||function(_0x11c471,_0x8fc2d1){const _0xfee964=a253_0x579f;if(typeof Reflect===_0xfee964(0x8a)&&typeof Reflect['metadata']==='function')return Reflect[_0xfee964(0xaf)](_0x11c471,_0x8fc2d1);};function a253_0x579f(_0x4bbc92,_0x438806){const _0x260624=a253_0xc22e();return a253_0x579f=function(_0x43e92b,_0x492f08){_0x43e92b=_0x43e92b-0x67;let _0xc22ec1=_0x260624[_0x43e92b];return _0xc22ec1;},a253_0x579f(_0x4bbc92,_0x438806);}Object['defineProperty'](exports,a253_0x39432e(0xa2),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require(a253_0x39432e(0x95)),constants_1=require(a253_0x39432e(0xb3)),errors_1=require(a253_0x39432e(0xa0)),utils_1=require(a253_0x39432e(0x6c)),flosum_repository_sync_dto_1=require(a253_0x39432e(0xb2)),not_found_error_1=require(a253_0x39432e(0x98)),queries_1=require(a253_0x39432e(0x97)),salesforce_query_service_1=require('./salesforce-query.service'),salesforce_service_1=require(a253_0x39432e(0x7a));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x1db2ab,_0x3beaed){const _0x22da44=a253_0x39432e;this[_0x22da44(0x87)]=_0x1db2ab,this[_0x22da44(0x71)]=_0x3beaed;}async['getComponents'](_0x48c566){const _0x56e890=a253_0x39432e;var _0x39b920;const _0x5da1f0=await this[_0x56e890(0x87)]['query'](_0x48c566),_0x45fa1c=[];for(const _0x4f047d of _0x5da1f0){const _0x12c001=(_0x39b920=_0x4f047d[constants_1[_0x56e890(0x8f)]+_0x56e890(0x76)])===null||_0x39b920===void 0x0?void 0x0:_0x39b920[_0x56e890(0xa4)];_0x12c001&&_0x12c001['length']&&_0x45fa1c[_0x56e890(0x75)](_0x12c001[0x0]['Id']);}return _0x45fa1c;}async[a253_0x39432e(0x82)](_0x56cf4f){const _0x5881ba=a253_0x39432e,_0x313627=await this[_0x5881ba(0x87)][_0x5881ba(0x7b)](queries_1[_0x5881ba(0x89)][_0x5881ba(0xa7)](/\%connection_id\%/g,_0x56cf4f));return _0x313627[_0x5881ba(0xba)](_0x3b3436=>{const _0x3ac4ce=_0x5881ba;return _0x3b3436[constants_1[_0x3ac4ce(0x6e)]+_0x3ac4ce(0x6a)]?_0x3b3436[constants_1[_0x3ac4ce(0x6e)]+_0x3ac4ce(0x6a)][_0x3ac4ce(0x8b)]:_0x3b3436[_0x3ac4ce(0x8b)];});}async[a253_0x39432e(0xaa)](_0x2e7da2){const _0x445cf6=a253_0x39432e,_0x526fba=await this[_0x445cf6(0x87)][_0x445cf6(0x7b)](queries_1[_0x445cf6(0x86)]['replace'](/\%connection_id\%/g,_0x2e7da2));return _0x526fba['map'](_0xa55bab=>flosum_repository_sync_dto_1[_0x445cf6(0xb7)][_0x445cf6(0x90)](_0xa55bab));}async[a253_0x39432e(0x99)](_0x1138f0){const _0x558859=a253_0x39432e,_0x241d32=await this[_0x558859(0x87)][_0x558859(0x7b)](queries_1[_0x558859(0x79)]['replace'](/%repositories_ids\%/g,_0x1138f0));return _0x241d32['map'](_0x302daf=>flosum_repository_sync_dto_1[_0x558859(0xb7)][_0x558859(0x9e)](_0x302daf));}async['getRepositoryRecord'](_0x3b03d7){const _0x597bb9=a253_0x39432e,_0x20f476=await this['salesforceQuery'][_0x597bb9(0x7b)](queries_1[_0x597bb9(0x85)][_0x597bb9(0xa7)](_0x597bb9(0xbe),_0x3b03d7));if(_0x20f476[_0x597bb9(0xbb)]===0x0)throw new not_found_error_1[(_0x597bb9(0xa6))](_0x597bb9(0x7e)+_0x3b03d7+_0x597bb9(0x94));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x597bb9(0x90)](_0x20f476[0x0]);}async['getBranchRecord'](_0x2a47db){const _0x5157a6=a253_0x39432e,_0x56bf62=await this[_0x5157a6(0x87)][_0x5157a6(0x7b)](queries_1[_0x5157a6(0x70)][_0x5157a6(0xa7)](_0x5157a6(0xbe),_0x2a47db));if(_0x56bf62[_0x5157a6(0xbb)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x5157a6(0x9a)+_0x2a47db+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x5157a6(0xb7)][_0x5157a6(0x9e)](_0x56bf62[0x0]);}async[a253_0x39432e(0xbd)](_0x258d78){const _0x36ff60=a253_0x39432e,_0x1a8d84=await this[_0x36ff60(0x87)][_0x36ff60(0x7b)](queries_1[_0x36ff60(0xa5)][_0x36ff60(0xa7)](_0x36ff60(0x6d),_0x258d78));if(_0x1a8d84[_0x36ff60(0xbb)]===0x0)throw new not_found_error_1[(_0x36ff60(0xa6))](_0x36ff60(0xb4)+_0x258d78+'\x20not\x20found\x20on\x20salesforce');const _0x5f265d=_0x1a8d84['find'](_0x843e8c=>_0x843e8c[constants_1[_0x36ff60(0x8f)]+_0x36ff60(0xb5)]===_0x258d78);if(!_0x5f265d)throw new not_found_error_1[(_0x36ff60(0xa6))](_0x36ff60(0xb4)+_0x258d78+_0x36ff60(0x94));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x36ff60(0x9e)](_0x5f265d);}async['getRepositoryRecordByName'](_0x274296){const _0x2bc633=a253_0x39432e,_0x14e11=await this['salesforceQuery']['query'](queries_1[_0x2bc633(0x9b)][_0x2bc633(0xa7)](_0x2bc633(0x6d),_0x274296));if(_0x14e11[_0x2bc633(0xbb)]===0x0)throw new not_found_error_1[(_0x2bc633(0xa6))](_0x2bc633(0x80)+_0x274296+_0x2bc633(0x94));return flosum_repository_sync_dto_1[_0x2bc633(0xb7)]['fromRepositoryRecord'](_0x14e11[0x0]);}async[a253_0x39432e(0x77)](_0x49ece0){const _0xa90c80=a253_0x39432e,_0x63d5ad='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0xa90c80(0xb1)]+_0xa90c80(0x8e)+_0x49ece0+'\x27';return this['getComponents'](_0x63d5ad);}async[a253_0x39432e(0x93)](_0x38cdf4){const _0x388c35=a253_0x39432e,_0x5d151b=_0x388c35(0x74)+queries_1[_0x388c35(0xb1)]+_0x388c35(0xad)+_0x38cdf4+'\x27';return this[_0x388c35(0x88)](_0x5d151b);}async[a253_0x39432e(0x91)](_0xdc7f3a){const _0x156ad3=a253_0x39432e;var _0x501d54;const _0x406cd2=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x156ad3(0xa7)](_0x156ad3(0x6f),_0xdc7f3a[_0x156ad3(0x68)])[_0x156ad3(0xa7)]('%name%',_0xdc7f3a[_0x156ad3(0x83)]?constants_1[_0x156ad3(0xae)]:constants_1[_0x156ad3(0x8d)]),_0x42e702=await this[_0x156ad3(0x87)][_0x156ad3(0x7b)](_0x406cd2),_0x4937a0=(_0x501d54=_0x42e702[0x0])===null||_0x501d54===void 0x0?void 0x0:_0x501d54['Id'];if(!_0x4937a0)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x4937a0;}async[a253_0x39432e(0xb8)](_0x25d6ae){const _0x836769=a253_0x39432e;let _0x5e3986=await this[_0x836769(0x91)](_0x25d6ae)['catch'](()=>null);return!_0x5e3986&&(_0x5e3986=await this[_0x836769(0x71)][_0x836769(0xbc)](_0x836769(0xa1),{'Body':(0x0,utils_1[_0x836769(0x81)])('{}'),'ParentId':_0x25d6ae[_0x836769(0x68)],'ContentType':'text/plain','Name':_0x25d6ae[_0x836769(0x83)]?constants_1[_0x836769(0xae)]:constants_1[_0x836769(0x8d)]})),_0x5e3986;}async[a253_0x39432e(0x9d)](_0x24e4d8,_0x3cb651){const _0x48de15=a253_0x39432e,_0x4e7bb0=await this['getRemoteStateAttachmentId'](_0x24e4d8);await this[_0x48de15(0x71)][_0x48de15(0x92)](_0x48de15(0xa1),_0x4e7bb0,{'Body':(0x0,utils_1[_0x48de15(0x81)])(JSON['stringify'](_0x3cb651))});}async[a253_0x39432e(0x84)](_0x33f4af,_0x3ef383){const _0x2dcbaf=a253_0x39432e;await this[_0x2dcbaf(0x71)]['patchObject'](_0x33f4af['objectType'],_0x33f4af[_0x2dcbaf(0x68)],{[constants_1[_0x2dcbaf(0x6e)]+_0x2dcbaf(0xb0)]:_0x3ef383});}async['disableSync'](_0x1f969e){const _0x26c334=a253_0x39432e;await this[_0x26c334(0x71)][_0x26c334(0x92)](constants_1[_0x26c334(0x6e)]+_0x26c334(0x96),_0x1f969e,{[constants_1[_0x26c334(0x6e)]+_0x26c334(0x9f)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1['Service'])(),__metadata(a253_0x39432e(0x67),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a253_0x39432e(0xac)]])],SalesforceSyncService),exports[a253_0x39432e(0x72)]=SalesforceSyncService;