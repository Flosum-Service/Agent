const a282_0x3ad514=a282_0x2b97;(function(_0x4bc1fe,_0x3904e1){const _0x148448=a282_0x2b97,_0x38d525=_0x4bc1fe();while(!![]){try{const _0x26dc1d=parseInt(_0x148448(0xee))/0x1+-parseInt(_0x148448(0xc2))/0x2+parseInt(_0x148448(0xdd))/0x3+-parseInt(_0x148448(0xed))/0x4+parseInt(_0x148448(0xc9))/0x5*(parseInt(_0x148448(0xb5))/0x6)+parseInt(_0x148448(0xe7))/0x7+parseInt(_0x148448(0xd8))/0x8*(-parseInt(_0x148448(0xb7))/0x9);if(_0x26dc1d===_0x3904e1)break;else _0x38d525['push'](_0x38d525['shift']());}catch(_0x516965){_0x38d525['push'](_0x38d525['shift']());}}}(a282_0x4eac,0xaa247));const a282_0x264282=(function(){let _0x356d97=!![];return function(_0x54135e,_0x5859ab){const _0x2876ea=_0x356d97?function(){const _0xde0008=a282_0x2b97;if(_0x5859ab){const _0x46aacd=_0x5859ab[_0xde0008(0xbf)](_0x54135e,arguments);return _0x5859ab=null,_0x46aacd;}}:function(){};return _0x356d97=![],_0x2876ea;};}()),a282_0x163397=a282_0x264282(this,function(){const _0x83586=a282_0x2b97;return a282_0x163397[_0x83586(0xa7)]()[_0x83586(0xf7)]('(((.+)+)+)+$')[_0x83586(0xa7)]()['constructor'](a282_0x163397)[_0x83586(0xf7)](_0x83586(0xcf));});a282_0x163397();function a282_0x4eac(){const _0x4f249c=['encodeBase64','disableSync','toString','push','setStatus','FLOSUM_GIT_NAMESPACE','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','\x0a\x20\x20\x20\x20\x20\x20','Repository\x20with\x20Id\x20','SYNC_ATTACHMENT_FOR_BRANCH_NAME','Synchronization_Status__c','fromBranchRecord','GET_REPOSITORIES_NAMES_QUERY','objectId','./salesforce.service','SalesforceSyncService','173112FqWxxQ','GET_REPOSITORY_QUERY','4355316zyXwJE','map','replace','%id%','getBranchComponents','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','%name%','GET_REPOSITORY_BY_NAME_QUERY','apply','getRepositoryRecords','getBranchRecord','1207458eJEhws','getRepositoryRecord','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','./salesforce-query.service','find','query','__metadata','210WItRDU','getRepositoryRecordByName','FlosumRepositorySyncDto','SalesforceQueryService','Connection__c','function','(((.+)+)+)+$','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','GET_WAITING_BRANCHES_QUERY','getAllRepositoryNames','typedi','SalesforceService','GET_BRANCH_BY_NAME_QUERY','defineProperty','../../../../constants','8PVmqmj','Name','createObject','objectType','updateRemoteState','2916456qjEdmq','GET_BRANCH_QUERY','object','records','../../../../constants/errors','length','SalesforceNotFoundError','__esModule','Attachment','../dto/flosum-repository-sync.dto','4611243aQTohb','GET_COMPONENTS_QUERY','getAttachmentId','salesforceQuery','patchObject','repositoryId','5139628HIufJn','226778MzCaMk','FLOSUM_NAMESPACE','getBranchRecords','Sync_In_Progress__c','stringify','Repository\x20','getRemoteStateAttachmentId','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','Components__r','search','ERR_INVALID_ATTACHMENT_ID','getComponents','salesforceService','../../../shared/utils','text/plain','getComponentsFromRepository','\x20not\x20found\x20on\x20salesforce','Branch\x20','getBranchRecordByName','fromRepositoryRecord','design:paramtypes'];a282_0x4eac=function(){return _0x4f249c;};return a282_0x4eac();}'use strict';var __decorate=this&&this['__decorate']||function(_0x2f0d26,_0x4279aa,_0x3ea619,_0x52f3bb){const _0x44500a=a282_0x2b97;var _0x37f500=arguments['length'],_0x1efb34=_0x37f500<0x3?_0x4279aa:_0x52f3bb===null?_0x52f3bb=Object['getOwnPropertyDescriptor'](_0x4279aa,_0x3ea619):_0x52f3bb,_0x501a3a;if(typeof Reflect===_0x44500a(0xdf)&&typeof Reflect['decorate']===_0x44500a(0xce))_0x1efb34=Reflect['decorate'](_0x2f0d26,_0x4279aa,_0x3ea619,_0x52f3bb);else{for(var _0x54a9c4=_0x2f0d26['length']-0x1;_0x54a9c4>=0x0;_0x54a9c4--)if(_0x501a3a=_0x2f0d26[_0x54a9c4])_0x1efb34=(_0x37f500<0x3?_0x501a3a(_0x1efb34):_0x37f500>0x3?_0x501a3a(_0x4279aa,_0x3ea619,_0x1efb34):_0x501a3a(_0x4279aa,_0x3ea619))||_0x1efb34;}return _0x37f500>0x3&&_0x1efb34&&Object[_0x44500a(0xd6)](_0x4279aa,_0x3ea619,_0x1efb34),_0x1efb34;},__metadata=this&&this[a282_0x3ad514(0xc8)]||function(_0x1ae54a,_0x275608){const _0x2f02e2=a282_0x3ad514;if(typeof Reflect===_0x2f02e2(0xdf)&&typeof Reflect['metadata']===_0x2f02e2(0xce))return Reflect['metadata'](_0x1ae54a,_0x275608);};Object[a282_0x3ad514(0xd6)](exports,a282_0x3ad514(0xe4),{'value':!![]}),exports[a282_0x3ad514(0xb4)]=void 0x0;const typedi_1=require(a282_0x3ad514(0xd3)),constants_1=require(a282_0x3ad514(0xd7)),errors_1=require(a282_0x3ad514(0xe1)),utils_1=require(a282_0x3ad514(0x9d)),flosum_repository_sync_dto_1=require(a282_0x3ad514(0xe6)),not_found_error_1=require('../errors/not-found.error'),queries_1=require('../queries'),salesforce_query_service_1=require(a282_0x3ad514(0xc5)),salesforce_service_1=require(a282_0x3ad514(0xb3));function a282_0x2b97(_0x1da340,_0x54d2dd){const _0x2eb331=a282_0x4eac();return a282_0x2b97=function(_0x163397,_0x264282){_0x163397=_0x163397-0x9c;let _0x4eace4=_0x2eb331[_0x163397];return _0x4eace4;},a282_0x2b97(_0x1da340,_0x54d2dd);}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x19e283,_0x44fed7){const _0x2511f0=a282_0x3ad514;this[_0x2511f0(0xea)]=_0x19e283,this[_0x2511f0(0x9c)]=_0x44fed7;}async[a282_0x3ad514(0xf9)](_0x3ea399){const _0x469b7e=a282_0x3ad514;var _0x46f90e;const _0x3629ad=await this[_0x469b7e(0xea)][_0x469b7e(0xc7)](_0x3ea399),_0x49880b=[];for(const _0xcb103f of _0x3629ad){const _0x4d69bb=(_0x46f90e=_0xcb103f[constants_1[_0x469b7e(0xef)]+_0x469b7e(0xf6)])===null||_0x46f90e===void 0x0?void 0x0:_0x46f90e[_0x469b7e(0xe0)];_0x4d69bb&&_0x4d69bb[_0x469b7e(0xe2)]&&_0x49880b[_0x469b7e(0xa8)](_0x4d69bb[0x0]['Id']);}return _0x49880b;}async[a282_0x3ad514(0xd2)](_0x19c98a){const _0x520eaf=a282_0x3ad514,_0xd22d39=await this[_0x520eaf(0xea)][_0x520eaf(0xc7)](queries_1[_0x520eaf(0xb1)][_0x520eaf(0xb9)](/\%connection_id\%/g,_0x19c98a));return _0xd22d39[_0x520eaf(0xb8)](_0x44526d=>{const _0x599375=_0x520eaf;return _0x44526d[constants_1[_0x599375(0xaa)]+'Repository__r']?_0x44526d[constants_1[_0x599375(0xaa)]+'Repository__r']['Name']:_0x44526d[_0x599375(0xd9)];});}async[a282_0x3ad514(0xc0)](_0x43600e){const _0x146e9f=a282_0x3ad514,_0x205075=await this[_0x146e9f(0xea)][_0x146e9f(0xc7)](queries_1['GET_WAITING_REPOSITORIES_QUERY'][_0x146e9f(0xb9)](/\%connection_id\%/g,_0x43600e));return _0x205075[_0x146e9f(0xb8)](_0x5ccd58=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x146e9f(0xa3)](_0x5ccd58));}async[a282_0x3ad514(0xf0)](_0x4fdeae){const _0x186a90=a282_0x3ad514,_0x4b1916=await this[_0x186a90(0xea)]['query'](queries_1[_0x186a90(0xd1)]['replace'](/%repositories_ids\%/g,_0x4fdeae));return _0x4b1916[_0x186a90(0xb8)](_0x3515aa=>flosum_repository_sync_dto_1[_0x186a90(0xcb)][_0x186a90(0xb0)](_0x3515aa));}async[a282_0x3ad514(0xc3)](_0x20e146){const _0x3731c4=a282_0x3ad514,_0x8d7133=await this[_0x3731c4(0xea)]['query'](queries_1[_0x3731c4(0xb6)][_0x3731c4(0xb9)](_0x3731c4(0xba),_0x20e146));if(_0x8d7133[_0x3731c4(0xe2)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x3731c4(0xad)+_0x20e146+_0x3731c4(0xa0));return flosum_repository_sync_dto_1[_0x3731c4(0xcb)][_0x3731c4(0xa3)](_0x8d7133[0x0]);}async[a282_0x3ad514(0xc1)](_0x5f3cdb){const _0x1c9f34=a282_0x3ad514,_0x288ded=await this[_0x1c9f34(0xea)][_0x1c9f34(0xc7)](queries_1[_0x1c9f34(0xde)][_0x1c9f34(0xb9)](_0x1c9f34(0xba),_0x5f3cdb));if(_0x288ded[_0x1c9f34(0xe2)]===0x0)throw new not_found_error_1[(_0x1c9f34(0xe3))]('Branch\x20with\x20Id\x20'+_0x5f3cdb+_0x1c9f34(0xa0));return flosum_repository_sync_dto_1[_0x1c9f34(0xcb)][_0x1c9f34(0xb0)](_0x288ded[0x0]);}async[a282_0x3ad514(0xa2)](_0x5b6211){const _0x57505c=a282_0x3ad514,_0x4339a1=await this['salesforceQuery'][_0x57505c(0xc7)](queries_1[_0x57505c(0xd5)]['replace']('%name%',_0x5b6211));if(_0x4339a1['length']===0x0)throw new not_found_error_1[(_0x57505c(0xe3))](_0x57505c(0xa1)+_0x5b6211+_0x57505c(0xa0));const _0x47c967=_0x4339a1[_0x57505c(0xc6)](_0x22a480=>_0x22a480[constants_1[_0x57505c(0xef)]+'Branch_Name__c']===_0x5b6211);if(!_0x47c967)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x5b6211+_0x57505c(0xa0));return flosum_repository_sync_dto_1[_0x57505c(0xcb)][_0x57505c(0xb0)](_0x47c967);}async[a282_0x3ad514(0xca)](_0xb96c8c){const _0x321c9d=a282_0x3ad514,_0x361b81=await this[_0x321c9d(0xea)][_0x321c9d(0xc7)](queries_1[_0x321c9d(0xbe)][_0x321c9d(0xb9)](_0x321c9d(0xbd),_0xb96c8c));if(_0x361b81[_0x321c9d(0xe2)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x321c9d(0xf3)+_0xb96c8c+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x321c9d(0xcb)][_0x321c9d(0xa3)](_0x361b81[0x0]);}async[a282_0x3ad514(0x9f)](_0x23ec24){const _0x501dcf=a282_0x3ad514,_0x756485=_0x501dcf(0xac)+queries_1[_0x501dcf(0xe8)]+_0x501dcf(0xab)+_0x23ec24+'\x27';return this[_0x501dcf(0xf9)](_0x756485);}async[a282_0x3ad514(0xbb)](_0x1b908f){const _0x43f088=a282_0x3ad514,_0x3b970b=_0x43f088(0xc4)+queries_1[_0x43f088(0xe8)]+_0x43f088(0xd0)+_0x1b908f+'\x27';return this[_0x43f088(0xf9)](_0x3b970b);}async[a282_0x3ad514(0xe9)](_0x18c4c9){const _0x22646f=a282_0x3ad514;var _0x3cb6ab;const _0x4bc6ab=queries_1[_0x22646f(0xbc)][_0x22646f(0xb9)]('%parentId%',_0x18c4c9['objectId'])['replace']('%name%',_0x18c4c9[_0x22646f(0xec)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x22646f(0xae)]),_0x574add=await this[_0x22646f(0xea)][_0x22646f(0xc7)](_0x4bc6ab),_0x10fd2e=(_0x3cb6ab=_0x574add[0x0])===null||_0x3cb6ab===void 0x0?void 0x0:_0x3cb6ab['Id'];if(!_0x10fd2e)throw new Error(errors_1[_0x22646f(0xf8)]);return _0x10fd2e;}async[a282_0x3ad514(0xf4)](_0x146440){const _0x273ea1=a282_0x3ad514;let _0x43cac6=await this[_0x273ea1(0xe9)](_0x146440)['catch'](()=>null);return!_0x43cac6&&(_0x43cac6=await this[_0x273ea1(0x9c)][_0x273ea1(0xda)]('Attachment',{'Body':(0x0,utils_1[_0x273ea1(0xa5)])('{}'),'ParentId':_0x146440['objectId'],'ContentType':_0x273ea1(0x9e),'Name':_0x146440[_0x273ea1(0xec)]?constants_1[_0x273ea1(0xf5)]:constants_1[_0x273ea1(0xae)]})),_0x43cac6;}async[a282_0x3ad514(0xdc)](_0x3f02e1,_0x3e8eb4){const _0x24ad37=a282_0x3ad514,_0x508e89=await this[_0x24ad37(0xf4)](_0x3f02e1);await this[_0x24ad37(0x9c)][_0x24ad37(0xeb)](_0x24ad37(0xe5),_0x508e89,{'Body':(0x0,utils_1[_0x24ad37(0xa5)])(JSON[_0x24ad37(0xf2)](_0x3e8eb4))});}async[a282_0x3ad514(0xa9)](_0x52f332,_0xf7c7c8){const _0xae9dc4=a282_0x3ad514;await this[_0xae9dc4(0x9c)]['patchObject'](_0x52f332[_0xae9dc4(0xdb)],_0x52f332[_0xae9dc4(0xb2)],{[constants_1[_0xae9dc4(0xaa)]+_0xae9dc4(0xaf)]:_0xf7c7c8});}async[a282_0x3ad514(0xa6)](_0x1d27d9){const _0x4f0651=a282_0x3ad514;await this['salesforceService'][_0x4f0651(0xeb)](constants_1[_0x4f0651(0xaa)]+_0x4f0651(0xcd),_0x1d27d9,{[constants_1[_0x4f0651(0xaa)]+_0x4f0651(0xf1)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1['Service'])(),__metadata(a282_0x3ad514(0xa4),[salesforce_query_service_1[a282_0x3ad514(0xcc)],salesforce_service_1[a282_0x3ad514(0xd4)]])],SalesforceSyncService),exports[a282_0x3ad514(0xb4)]=SalesforceSyncService;