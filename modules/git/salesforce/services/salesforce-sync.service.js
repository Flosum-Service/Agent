const a238_0x113ed5=a238_0xa10b;function a238_0x3341(){const _0x579e23=['../queries','FlosumRepositorySyncDto','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','Connection__c','toString','getAttachmentId','(((.+)+)+)+$','getBranchComponents','getRepositoryRecords','Branch\x20','Attachment','createObject','SalesforceSyncService','metadata','10250504QTNNMe','search','GET_REPOSITORY_QUERY','../../../../constants','salesforceQuery','objectId','SalesforceNotFoundError','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','disableSync','patchObject','Name','\x20not\x20found\x20on\x20salesforce','Branch_Name__c','map','function','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','../dto/flosum-repository-sync.dto','apply','getBranchRecordByName','Branch\x20with\x20Id\x20','stringify','452255PjppNU','getRemoteStateAttachmentId','encodeBase64','getBranchRecords','2788900oVYFKY','objectType','FLOSUM_NAMESPACE','fromBranchRecord','GET_COMPONENTS_QUERY','getBranchRecord','212107Klfslu','getComponents','65GKNtQH','../../../../constants/errors','getAllRepositoryNames','GET_REPOSITORIES_NAMES_QUERY','FLOSUM_GIT_NAMESPACE','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','constructor','query','find','__metadata','2597733JlHJro','\x0a\x20\x20\x20\x20\x20\x20','getRepositoryRecord','length','%name%','object','fromRepositoryRecord','%parentId%','./salesforce.service','getOwnPropertyDescriptor','replace','text/plain','Service','salesforceService','setStatus','29606238thYgqA','updateRemoteState','705072NOoQaN','__decorate','GET_WAITING_REPOSITORIES_QUERY','defineProperty','./salesforce-query.service','Sync_In_Progress__c','SYNC_ATTACHMENT_FOR_BRANCH_NAME','decorate','SalesforceService','GET_WAITING_BRANCHES_QUERY','2pZEQIZ','push','__esModule'];a238_0x3341=function(){return _0x579e23;};return a238_0x3341();}(function(_0x532f7c,_0x389b24){const _0x2c46ff=a238_0xa10b,_0x217a22=_0x532f7c();while(!![]){try{const _0x14e607=parseInt(_0x2c46ff(0x96))/0x1+-parseInt(_0x2c46ff(0xc7))/0x2*(parseInt(_0x2c46ff(0xac))/0x3)+parseInt(_0x2c46ff(0x9a))/0x4+parseInt(_0x2c46ff(0xa2))/0x5*(-parseInt(_0x2c46ff(0xbd))/0x6)+parseInt(_0x2c46ff(0xa0))/0x7+-parseInt(_0x2c46ff(0x81))/0x8+parseInt(_0x2c46ff(0xbb))/0x9;if(_0x14e607===_0x389b24)break;else _0x217a22['push'](_0x217a22['shift']());}catch(_0x43a11f){_0x217a22['push'](_0x217a22['shift']());}}}(a238_0x3341,0xc1f73));function a238_0xa10b(_0x2fcd2a,_0x4e3101){const _0x37411c=a238_0x3341();return a238_0xa10b=function(_0x10541c,_0x8a2b83){_0x10541c=_0x10541c-0x74;let _0x3341c3=_0x37411c[_0x10541c];return _0x3341c3;},a238_0xa10b(_0x2fcd2a,_0x4e3101);}const a238_0x8a2b83=(function(){let _0x507926=!![];return function(_0x10936b,_0x2cee9e){const _0x54dd26=_0x507926?function(){const _0x39d210=a238_0xa10b;if(_0x2cee9e){const _0x2c329c=_0x2cee9e[_0x39d210(0x92)](_0x10936b,arguments);return _0x2cee9e=null,_0x2c329c;}}:function(){};return _0x507926=![],_0x54dd26;};}()),a238_0x10541c=a238_0x8a2b83(this,function(){const _0x4d3f17=a238_0xa10b;return a238_0x10541c[_0x4d3f17(0x77)]()[_0x4d3f17(0x82)](_0x4d3f17(0x79))['toString']()[_0x4d3f17(0xa8)](a238_0x10541c)[_0x4d3f17(0x82)](_0x4d3f17(0x79));});a238_0x10541c();'use strict';var __decorate=this&&this[a238_0x113ed5(0xbe)]||function(_0x3d846e,_0x3e9514,_0x4b5a40,_0x3d6516){const _0x2a97a4=a238_0x113ed5;var _0x155ff3=arguments['length'],_0x1549cb=_0x155ff3<0x3?_0x3e9514:_0x3d6516===null?_0x3d6516=Object[_0x2a97a4(0xb5)](_0x3e9514,_0x4b5a40):_0x3d6516,_0x148a2d;if(typeof Reflect===_0x2a97a4(0xb1)&&typeof Reflect['decorate']===_0x2a97a4(0x8f))_0x1549cb=Reflect[_0x2a97a4(0xc4)](_0x3d846e,_0x3e9514,_0x4b5a40,_0x3d6516);else{for(var _0x19f220=_0x3d846e[_0x2a97a4(0xaf)]-0x1;_0x19f220>=0x0;_0x19f220--)if(_0x148a2d=_0x3d846e[_0x19f220])_0x1549cb=(_0x155ff3<0x3?_0x148a2d(_0x1549cb):_0x155ff3>0x3?_0x148a2d(_0x3e9514,_0x4b5a40,_0x1549cb):_0x148a2d(_0x3e9514,_0x4b5a40))||_0x1549cb;}return _0x155ff3>0x3&&_0x1549cb&&Object[_0x2a97a4(0xc0)](_0x3e9514,_0x4b5a40,_0x1549cb),_0x1549cb;},__metadata=this&&this[a238_0x113ed5(0xab)]||function(_0x11d825,_0x2e2d18){const _0x50d2e9=a238_0x113ed5;if(typeof Reflect===_0x50d2e9(0xb1)&&typeof Reflect[_0x50d2e9(0x80)]===_0x50d2e9(0x8f))return Reflect['metadata'](_0x11d825,_0x2e2d18);};Object[a238_0x113ed5(0xc0)](exports,a238_0x113ed5(0xc9),{'value':!![]}),exports[a238_0x113ed5(0x7f)]=void 0x0;const typedi_1=require('typedi'),constants_1=require(a238_0x113ed5(0x84)),errors_1=require(a238_0x113ed5(0xa3)),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a238_0x113ed5(0x91)),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a238_0x113ed5(0xca)),salesforce_query_service_1=require(a238_0x113ed5(0xc1)),salesforce_service_1=require(a238_0x113ed5(0xb4));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x2a4fba,_0x596a04){this['salesforceQuery']=_0x2a4fba,this['salesforceService']=_0x596a04;}async[a238_0x113ed5(0xa1)](_0x2226ab){const _0x182c10=a238_0x113ed5;var _0x21b8aa;const _0x596509=await this[_0x182c10(0x85)][_0x182c10(0xa9)](_0x2226ab),_0x492dc7=[];for(const _0x5214d4 of _0x596509){const _0x25d2f1=(_0x21b8aa=_0x5214d4[constants_1[_0x182c10(0x9c)]+'Components__r'])===null||_0x21b8aa===void 0x0?void 0x0:_0x21b8aa['records'];_0x25d2f1&&_0x25d2f1['length']&&_0x492dc7[_0x182c10(0xc8)](_0x25d2f1[0x0]['Id']);}return _0x492dc7;}async[a238_0x113ed5(0xa4)](_0x249735){const _0x3a0962=a238_0x113ed5,_0x239190=await this[_0x3a0962(0x85)][_0x3a0962(0xa9)](queries_1[_0x3a0962(0xa5)][_0x3a0962(0xb6)](/\%connection_id\%/g,_0x249735));return _0x239190[_0x3a0962(0x8e)](_0x1f3f81=>{const _0x14305d=_0x3a0962;return _0x1f3f81[constants_1['FLOSUM_GIT_NAMESPACE']+'Repository__r']?_0x1f3f81[constants_1[_0x14305d(0xa6)]+'Repository__r'][_0x14305d(0x8b)]:_0x1f3f81['Name'];});}async[a238_0x113ed5(0x7b)](_0x4a1f05){const _0x2bb225=a238_0x113ed5,_0x557861=await this['salesforceQuery'][_0x2bb225(0xa9)](queries_1[_0x2bb225(0xbf)][_0x2bb225(0xb6)](/\%connection_id\%/g,_0x4a1f05));return _0x557861['map'](_0x1b1bed=>flosum_repository_sync_dto_1[_0x2bb225(0x74)][_0x2bb225(0xb2)](_0x1b1bed));}async[a238_0x113ed5(0x99)](_0xde20d2){const _0x7d7da4=a238_0x113ed5,_0x22a667=await this['salesforceQuery'][_0x7d7da4(0xa9)](queries_1[_0x7d7da4(0xc6)][_0x7d7da4(0xb6)](/%repositories_ids\%/g,_0xde20d2));return _0x22a667[_0x7d7da4(0x8e)](_0x151c43=>flosum_repository_sync_dto_1[_0x7d7da4(0x74)]['fromBranchRecord'](_0x151c43));}async[a238_0x113ed5(0xae)](_0x211d74){const _0x23100f=a238_0x113ed5,_0x4fcaa7=await this[_0x23100f(0x85)][_0x23100f(0xa9)](queries_1[_0x23100f(0x83)]['replace']('%id%',_0x211d74));if(_0x4fcaa7[_0x23100f(0xaf)]===0x0)throw new not_found_error_1[(_0x23100f(0x87))]('Repository\x20with\x20Id\x20'+_0x211d74+_0x23100f(0x8c));return flosum_repository_sync_dto_1[_0x23100f(0x74)][_0x23100f(0xb2)](_0x4fcaa7[0x0]);}async[a238_0x113ed5(0x9f)](_0x5be7a0){const _0x4ffe47=a238_0x113ed5,_0x3891b0=await this[_0x4ffe47(0x85)][_0x4ffe47(0xa9)](queries_1['GET_BRANCH_QUERY'][_0x4ffe47(0xb6)]('%id%',_0x5be7a0));if(_0x3891b0['length']===0x0)throw new not_found_error_1[(_0x4ffe47(0x87))](_0x4ffe47(0x94)+_0x5be7a0+_0x4ffe47(0x8c));return flosum_repository_sync_dto_1[_0x4ffe47(0x74)][_0x4ffe47(0x9d)](_0x3891b0[0x0]);}async[a238_0x113ed5(0x93)](_0xd73c7f){const _0x590ece=a238_0x113ed5,_0xe5dcdd=await this[_0x590ece(0x85)][_0x590ece(0xa9)](queries_1['GET_BRANCH_BY_NAME_QUERY'][_0x590ece(0xb6)](_0x590ece(0xb0),_0xd73c7f));if(_0xe5dcdd[_0x590ece(0xaf)]===0x0)throw new not_found_error_1[(_0x590ece(0x87))]('Branch\x20'+_0xd73c7f+'\x20not\x20found\x20on\x20salesforce');const _0x51190f=_0xe5dcdd[_0x590ece(0xaa)](_0x3e5c5c=>_0x3e5c5c[constants_1[_0x590ece(0x9c)]+_0x590ece(0x8d)]===_0xd73c7f);if(!_0x51190f)throw new not_found_error_1['SalesforceNotFoundError'](_0x590ece(0x7c)+_0xd73c7f+_0x590ece(0x8c));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0x51190f);}async['getRepositoryRecordByName'](_0x597b82){const _0x4d9d88=a238_0x113ed5,_0x224a9b=await this[_0x4d9d88(0x85)][_0x4d9d88(0xa9)](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x4d9d88(0xb6)](_0x4d9d88(0xb0),_0x597b82));if(_0x224a9b[_0x4d9d88(0xaf)]===0x0)throw new not_found_error_1[(_0x4d9d88(0x87))]('Repository\x20'+_0x597b82+_0x4d9d88(0x8c));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x4d9d88(0xb2)](_0x224a9b[0x0]);}async['getComponentsFromRepository'](_0x48626b){const _0x2495be=a238_0x113ed5,_0x259246=_0x2495be(0xad)+queries_1[_0x2495be(0x9e)]+_0x2495be(0x90)+_0x48626b+'\x27';return this['getComponents'](_0x259246);}async[a238_0x113ed5(0x7a)](_0x5abb26){const _0x1f39ad=a238_0x113ed5,_0x1a3983=_0x1f39ad(0xa7)+queries_1[_0x1f39ad(0x9e)]+_0x1f39ad(0x75)+_0x5abb26+'\x27';return this[_0x1f39ad(0xa1)](_0x1a3983);}async[a238_0x113ed5(0x78)](_0x5dab6c){const _0x401abd=a238_0x113ed5;var _0xfceaca;const _0x41474a=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x401abd(0xb6)](_0x401abd(0xb3),_0x5dab6c[_0x401abd(0x86)])[_0x401abd(0xb6)](_0x401abd(0xb0),_0x5dab6c['repositoryId']?constants_1[_0x401abd(0x88)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x3ac6c8=await this['salesforceQuery'][_0x401abd(0xa9)](_0x41474a),_0x37dab8=(_0xfceaca=_0x3ac6c8[0x0])===null||_0xfceaca===void 0x0?void 0x0:_0xfceaca['Id'];if(!_0x37dab8)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x37dab8;}async[a238_0x113ed5(0x97)](_0x46b2e6){const _0x3d6875=a238_0x113ed5;let _0x47e11a=await this[_0x3d6875(0x78)](_0x46b2e6)['catch'](()=>null);return!_0x47e11a&&(_0x47e11a=await this[_0x3d6875(0xb9)][_0x3d6875(0x7e)](_0x3d6875(0x7d),{'Body':(0x0,utils_1[_0x3d6875(0x98)])('{}'),'ParentId':_0x46b2e6[_0x3d6875(0x86)],'ContentType':_0x3d6875(0xb7),'Name':_0x46b2e6['repositoryId']?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x3d6875(0xc3)]})),_0x47e11a;}async[a238_0x113ed5(0xbc)](_0x1e9a96,_0x406d92){const _0x48ec16=a238_0x113ed5,_0x1038be=await this[_0x48ec16(0x97)](_0x1e9a96);await this[_0x48ec16(0xb9)][_0x48ec16(0x8a)](_0x48ec16(0x7d),_0x1038be,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0x48ec16(0x95)](_0x406d92))});}async[a238_0x113ed5(0xba)](_0x24cd56,_0x50f3f4){const _0x17d4ab=a238_0x113ed5;await this[_0x17d4ab(0xb9)][_0x17d4ab(0x8a)](_0x24cd56[_0x17d4ab(0x9b)],_0x24cd56['objectId'],{[constants_1['FLOSUM_GIT_NAMESPACE']+'Synchronization_Status__c']:_0x50f3f4});}async[a238_0x113ed5(0x89)](_0xa8dbb5){const _0x341202=a238_0x113ed5;await this[_0x341202(0xb9)][_0x341202(0x8a)](constants_1[_0x341202(0xa6)]+_0x341202(0x76),_0xa8dbb5,{[constants_1[_0x341202(0xa6)]+_0x341202(0xc2)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a238_0x113ed5(0xb8)])(),__metadata('design:paramtypes',[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a238_0x113ed5(0xc5)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;