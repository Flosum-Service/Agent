const a237_0x543c66=a237_0x332d;(function(_0x38e51f,_0x111ac4){const _0x5d2901=a237_0x332d,_0x3e7e94=_0x38e51f();while(!![]){try{const _0x5b2773=-parseInt(_0x5d2901(0x248))/0x1+-parseInt(_0x5d2901(0x247))/0x2+parseInt(_0x5d2901(0x232))/0x3*(-parseInt(_0x5d2901(0x240))/0x4)+parseInt(_0x5d2901(0x236))/0x5*(parseInt(_0x5d2901(0x1fe))/0x6)+parseInt(_0x5d2901(0x225))/0x7+parseInt(_0x5d2901(0x23c))/0x8*(parseInt(_0x5d2901(0x209))/0x9)+parseInt(_0x5d2901(0x21b))/0xa;if(_0x5b2773===_0x111ac4)break;else _0x3e7e94['push'](_0x3e7e94['shift']());}catch(_0x1bf058){_0x3e7e94['push'](_0x3e7e94['shift']());}}}(a237_0x223c,0x48f23));const a237_0x2929c4=(function(){let _0x3db980=!![];return function(_0x3fc61c,_0x4584cf){const _0x1cb6bf=_0x3db980?function(){const _0x177163=a237_0x332d;if(_0x4584cf){const _0x3c2952=_0x4584cf[_0x177163(0x207)](_0x3fc61c,arguments);return _0x4584cf=null,_0x3c2952;}}:function(){};return _0x3db980=![],_0x1cb6bf;};}()),a237_0x630403=a237_0x2929c4(this,function(){const _0x2e8149=a237_0x332d;return a237_0x630403['toString']()['search']('(((.+)+)+)+$')[_0x2e8149(0x1f8)]()['constructor'](a237_0x630403)['search'](_0x2e8149(0x220));});a237_0x630403();'use strict';var __decorate=this&&this[a237_0x543c66(0x20b)]||function(_0x13e699,_0x1adb63,_0xfd0af,_0x370410){const _0x2edcc4=a237_0x543c66;var _0x104e7c=arguments[_0x2edcc4(0x1f4)],_0xaa0c72=_0x104e7c<0x3?_0x1adb63:_0x370410===null?_0x370410=Object[_0x2edcc4(0x22c)](_0x1adb63,_0xfd0af):_0x370410,_0x1ade7f;if(typeof Reflect===_0x2edcc4(0x243)&&typeof Reflect[_0x2edcc4(0x204)]===_0x2edcc4(0x1fd))_0xaa0c72=Reflect[_0x2edcc4(0x204)](_0x13e699,_0x1adb63,_0xfd0af,_0x370410);else{for(var _0x46ae41=_0x13e699[_0x2edcc4(0x1f4)]-0x1;_0x46ae41>=0x0;_0x46ae41--)if(_0x1ade7f=_0x13e699[_0x46ae41])_0xaa0c72=(_0x104e7c<0x3?_0x1ade7f(_0xaa0c72):_0x104e7c>0x3?_0x1ade7f(_0x1adb63,_0xfd0af,_0xaa0c72):_0x1ade7f(_0x1adb63,_0xfd0af))||_0xaa0c72;}return _0x104e7c>0x3&&_0xaa0c72&&Object['defineProperty'](_0x1adb63,_0xfd0af,_0xaa0c72),_0xaa0c72;},__metadata=this&&this['__metadata']||function(_0x191fe1,_0xf2e54e){const _0x5f5365=a237_0x543c66;if(typeof Reflect===_0x5f5365(0x243)&&typeof Reflect[_0x5f5365(0x217)]===_0x5f5365(0x1fd))return Reflect[_0x5f5365(0x217)](_0x191fe1,_0xf2e54e);};Object[a237_0x543c66(0x1f6)](exports,'__esModule',{'value':!![]}),exports[a237_0x543c66(0x22f)]=void 0x0;const typedi_1=require('typedi'),constants_1=require(a237_0x543c66(0x22d)),errors_1=require(a237_0x543c66(0x1fc)),utils_1=require(a237_0x543c66(0x21d)),flosum_repository_sync_dto_1=require(a237_0x543c66(0x206)),not_found_error_1=require(a237_0x543c66(0x242)),queries_1=require(a237_0x543c66(0x219)),salesforce_query_service_1=require(a237_0x543c66(0x234)),salesforce_service_1=require(a237_0x543c66(0x246));function a237_0x223c(){const _0x3e30c8=['getOwnPropertyDescriptor','../../../../constants','getBranchComponents','SalesforceSyncService','Attachment','GET_REPOSITORIES_NAMES_QUERY','56583cWyHpV','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','./salesforce-query.service','%parentId%','5cAVOeR','Sync_In_Progress__c','getRepositoryRecord','disableSync','fromRepositoryRecord','query','40Mqddfp','getAttachmentId','SalesforceService','text/plain','4qhtEGI','SYNC_ATTACHMENT_FOR_BRANCH_NAME','../errors/not-found.error','object','GET_REPOSITORY_QUERY','Repository\x20','./salesforce.service','444024nvhasP','295321uNiMvz','catch','SalesforceNotFoundError','getComponentsFromRepository','length','SalesforceQueryService','defineProperty','%id%','toString','Branch\x20','getRepositoryRecordByName','Synchronization_Status__c','../../../../constants/errors','function','114054fPRuMK','FLOSUM_GIT_NAMESPACE','push','fromBranchRecord','map','\x20not\x20found\x20on\x20salesforce','decorate','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','../dto/flosum-repository-sync.dto','apply','salesforceService','420318GXsjSj','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','__decorate','Repository__r','\x0a\x20\x20\x20\x20\x20\x20','salesforceQuery','replace','Branch\x20with\x20Id\x20','GET_BRANCH_QUERY','Service','getRemoteStateAttachmentId','Name','objectType','Connection__c','metadata','getComponents','../queries','records','5298130TaaqKD','repositoryId','../../../shared/utils','patchObject','setStatus','(((.+)+)+)+$','ERR_INVALID_ATTACHMENT_ID','FLOSUM_NAMESPACE','find','Components__r','368543jYaZRq','GET_REPOSITORY_BY_NAME_QUERY','getAllRepositoryNames','%name%','objectId','FlosumRepositorySyncDto','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'];a237_0x223c=function(){return _0x3e30c8;};return a237_0x223c();}function a237_0x332d(_0x291739,_0x12f5c7){const _0x4e0085=a237_0x223c();return a237_0x332d=function(_0x630403,_0x2929c4){_0x630403=_0x630403-0x1f1;let _0x223c84=_0x4e0085[_0x630403];return _0x223c84;},a237_0x332d(_0x291739,_0x12f5c7);}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x1436ca,_0x118e6f){const _0x54fbdc=a237_0x543c66;this[_0x54fbdc(0x20e)]=_0x1436ca,this['salesforceService']=_0x118e6f;}async[a237_0x543c66(0x218)](_0x1ade57){const _0x933675=a237_0x543c66;var _0x189979;const _0xc437e4=await this[_0x933675(0x20e)][_0x933675(0x23b)](_0x1ade57),_0x11bfa1=[];for(const _0x3baf31 of _0xc437e4){const _0x56fcf0=(_0x189979=_0x3baf31[constants_1[_0x933675(0x222)]+_0x933675(0x224)])===null||_0x189979===void 0x0?void 0x0:_0x189979[_0x933675(0x21a)];_0x56fcf0&&_0x56fcf0[_0x933675(0x1f4)]&&_0x11bfa1[_0x933675(0x200)](_0x56fcf0[0x0]['Id']);}return _0x11bfa1;}async[a237_0x543c66(0x227)](_0x176c6a){const _0x2241ae=a237_0x543c66,_0xedbf01=await this['salesforceQuery']['query'](queries_1[_0x2241ae(0x231)][_0x2241ae(0x20f)](/\%connection_id\%/g,_0x176c6a));return _0xedbf01[_0x2241ae(0x202)](_0x58890a=>{const _0x5e2de7=_0x2241ae;return _0x58890a[constants_1['FLOSUM_GIT_NAMESPACE']+_0x5e2de7(0x20c)]?_0x58890a[constants_1['FLOSUM_GIT_NAMESPACE']+_0x5e2de7(0x20c)][_0x5e2de7(0x214)]:_0x58890a[_0x5e2de7(0x214)];});}async['getRepositoryRecords'](_0xa317a8){const _0x50cfb4=a237_0x543c66,_0x23b571=await this[_0x50cfb4(0x20e)][_0x50cfb4(0x23b)](queries_1['GET_WAITING_REPOSITORIES_QUERY'][_0x50cfb4(0x20f)](/\%connection_id\%/g,_0xa317a8));return _0x23b571['map'](_0x55fa10=>flosum_repository_sync_dto_1[_0x50cfb4(0x22a)]['fromRepositoryRecord'](_0x55fa10));}async['getBranchRecords'](_0x4b0c84){const _0x43af1c=a237_0x543c66,_0x38d93e=await this[_0x43af1c(0x20e)]['query'](queries_1['GET_WAITING_BRANCHES_QUERY']['replace'](/%repositories_ids\%/g,_0x4b0c84));return _0x38d93e[_0x43af1c(0x202)](_0x5b0dab=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x43af1c(0x201)](_0x5b0dab));}async[a237_0x543c66(0x238)](_0x5e0bd3){const _0x5efecf=a237_0x543c66,_0x39bcf5=await this[_0x5efecf(0x20e)][_0x5efecf(0x23b)](queries_1[_0x5efecf(0x244)]['replace'](_0x5efecf(0x1f7),_0x5e0bd3));if(_0x39bcf5['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20with\x20Id\x20'+_0x5e0bd3+_0x5efecf(0x203));return flosum_repository_sync_dto_1[_0x5efecf(0x22a)][_0x5efecf(0x23a)](_0x39bcf5[0x0]);}async['getBranchRecord'](_0x59b67b){const _0x2d57fa=a237_0x543c66,_0x282450=await this[_0x2d57fa(0x20e)][_0x2d57fa(0x23b)](queries_1[_0x2d57fa(0x211)][_0x2d57fa(0x20f)](_0x2d57fa(0x1f7),_0x59b67b));if(_0x282450[_0x2d57fa(0x1f4)]===0x0)throw new not_found_error_1[(_0x2d57fa(0x1f2))](_0x2d57fa(0x210)+_0x59b67b+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x2d57fa(0x22a)][_0x2d57fa(0x201)](_0x282450[0x0]);}async['getBranchRecordByName'](_0x4e091c){const _0x7c46c6=a237_0x543c66,_0x733d5f=await this['salesforceQuery'][_0x7c46c6(0x23b)](queries_1['GET_BRANCH_BY_NAME_QUERY']['replace']('%name%',_0x4e091c));if(_0x733d5f[_0x7c46c6(0x1f4)]===0x0)throw new not_found_error_1[(_0x7c46c6(0x1f2))](_0x7c46c6(0x1f9)+_0x4e091c+'\x20not\x20found\x20on\x20salesforce');const _0xfa57f0=_0x733d5f[_0x7c46c6(0x223)](_0xb9dc87=>_0xb9dc87[constants_1[_0x7c46c6(0x222)]+'Branch_Name__c']===_0x4e091c);if(!_0xfa57f0)throw new not_found_error_1[(_0x7c46c6(0x1f2))](_0x7c46c6(0x1f9)+_0x4e091c+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x7c46c6(0x201)](_0xfa57f0);}async[a237_0x543c66(0x1fa)](_0x3229de){const _0x5077d5=a237_0x543c66,_0x51bf44=await this[_0x5077d5(0x20e)]['query'](queries_1[_0x5077d5(0x226)][_0x5077d5(0x20f)](_0x5077d5(0x228),_0x3229de));if(_0x51bf44[_0x5077d5(0x1f4)]===0x0)throw new not_found_error_1[(_0x5077d5(0x1f2))](_0x5077d5(0x245)+_0x3229de+_0x5077d5(0x203));return flosum_repository_sync_dto_1[_0x5077d5(0x22a)][_0x5077d5(0x23a)](_0x51bf44[0x0]);}async[a237_0x543c66(0x1f3)](_0x2f5ac4){const _0x3bbfba=a237_0x543c66,_0x370373=_0x3bbfba(0x20d)+queries_1['GET_COMPONENTS_QUERY']+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x2f5ac4+'\x27';return this[_0x3bbfba(0x218)](_0x370373);}async[a237_0x543c66(0x22e)](_0x571772){const _0x57a98d=a237_0x543c66,_0x4792ca=_0x57a98d(0x205)+queries_1['GET_COMPONENTS_QUERY']+_0x57a98d(0x22b)+_0x571772+'\x27';return this['getComponents'](_0x4792ca);}async[a237_0x543c66(0x23d)](_0xe4b82e){const _0x1eeeae=a237_0x543c66;var _0x3dd990;const _0x532080=queries_1[_0x1eeeae(0x233)][_0x1eeeae(0x20f)](_0x1eeeae(0x235),_0xe4b82e[_0x1eeeae(0x229)])[_0x1eeeae(0x20f)]('%name%',_0xe4b82e[_0x1eeeae(0x21c)]?constants_1[_0x1eeeae(0x20a)]:constants_1[_0x1eeeae(0x241)]),_0x2c2c33=await this[_0x1eeeae(0x20e)][_0x1eeeae(0x23b)](_0x532080),_0x17529c=(_0x3dd990=_0x2c2c33[0x0])===null||_0x3dd990===void 0x0?void 0x0:_0x3dd990['Id'];if(!_0x17529c)throw new Error(errors_1[_0x1eeeae(0x221)]);return _0x17529c;}async['getRemoteStateAttachmentId'](_0x557dde){const _0x2d7f14=a237_0x543c66;let _0x3133d8=await this[_0x2d7f14(0x23d)](_0x557dde)[_0x2d7f14(0x1f1)](()=>null);return!_0x3133d8&&(_0x3133d8=await this[_0x2d7f14(0x208)]['createObject']('Attachment',{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x557dde[_0x2d7f14(0x229)],'ContentType':_0x2d7f14(0x23f),'Name':_0x557dde[_0x2d7f14(0x21c)]?constants_1[_0x2d7f14(0x20a)]:constants_1[_0x2d7f14(0x241)]})),_0x3133d8;}async['updateRemoteState'](_0x3f0a71,_0xf6e1bf){const _0x1bf4ef=a237_0x543c66,_0x5eabca=await this[_0x1bf4ef(0x213)](_0x3f0a71);await this[_0x1bf4ef(0x208)][_0x1bf4ef(0x21e)](_0x1bf4ef(0x230),_0x5eabca,{'Body':(0x0,utils_1['encodeBase64'])(JSON['stringify'](_0xf6e1bf))});}async[a237_0x543c66(0x21f)](_0x29302c,_0x369a49){const _0x301c86=a237_0x543c66;await this[_0x301c86(0x208)]['patchObject'](_0x29302c[_0x301c86(0x215)],_0x29302c[_0x301c86(0x229)],{[constants_1[_0x301c86(0x1ff)]+_0x301c86(0x1fb)]:_0x369a49});}async[a237_0x543c66(0x239)](_0x1dd7d6){const _0x13f524=a237_0x543c66;await this[_0x13f524(0x208)][_0x13f524(0x21e)](constants_1[_0x13f524(0x1ff)]+_0x13f524(0x216),_0x1dd7d6,{[constants_1[_0x13f524(0x1ff)]+_0x13f524(0x237)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a237_0x543c66(0x212)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a237_0x543c66(0x1f5)],salesforce_service_1[a237_0x543c66(0x23e)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;