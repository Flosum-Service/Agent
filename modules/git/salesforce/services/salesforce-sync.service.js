const a270_0x5cb37f=a270_0x5813;(function(_0x533f5f,_0x39f41e){const _0x5c2926=a270_0x5813,_0x506360=_0x533f5f();while(!![]){try{const _0x838ffd=parseInt(_0x5c2926(0x1eb))/0x1*(-parseInt(_0x5c2926(0x1f1))/0x2)+parseInt(_0x5c2926(0x20d))/0x3*(-parseInt(_0x5c2926(0x224))/0x4)+parseInt(_0x5c2926(0x1d8))/0x5*(-parseInt(_0x5c2926(0x1fd))/0x6)+parseInt(_0x5c2926(0x1e8))/0x7*(parseInt(_0x5c2926(0x225))/0x8)+-parseInt(_0x5c2926(0x229))/0x9+-parseInt(_0x5c2926(0x212))/0xa*(-parseInt(_0x5c2926(0x1d3))/0xb)+parseInt(_0x5c2926(0x1ed))/0xc;if(_0x838ffd===_0x39f41e)break;else _0x506360['push'](_0x506360['shift']());}catch(_0x584f7e){_0x506360['push'](_0x506360['shift']());}}}(a270_0x5ac0,0xc1896));const a270_0x429c19=(function(){let _0x1cddf4=!![];return function(_0x6105c7,_0x304fa0){const _0x1bbc18=_0x1cddf4?function(){if(_0x304fa0){const _0xc3a64=_0x304fa0['apply'](_0x6105c7,arguments);return _0x304fa0=null,_0xc3a64;}}:function(){};return _0x1cddf4=![],_0x1bbc18;};}()),a270_0x3d3ed1=a270_0x429c19(this,function(){const _0x158d4b=a270_0x5813;return a270_0x3d3ed1[_0x158d4b(0x1fe)]()[_0x158d4b(0x1f4)](_0x158d4b(0x220))[_0x158d4b(0x1fe)]()[_0x158d4b(0x1ff)](a270_0x3d3ed1)['search'](_0x158d4b(0x220));});function a270_0x5813(_0x59a54e,_0x26424c){const _0x18173a=a270_0x5ac0();return a270_0x5813=function(_0x3d3ed1,_0x429c19){_0x3d3ed1=_0x3d3ed1-0x1ce;let _0x5ac069=_0x18173a[_0x3d3ed1];return _0x5ac069;},a270_0x5813(_0x59a54e,_0x26424c);}a270_0x3d3ed1();function a270_0x5ac0(){const _0x2c70a5=['search','Synchronization_Status__c','push','GET_WAITING_BRANCHES_QUERY','__metadata','decorate','SalesforceSyncService','createObject','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','1919658AieraZ','toString','constructor','Sync_In_Progress__c','FLOSUM_GIT_NAMESPACE','getAttachmentId','getRepositoryRecords','Components__r','objectId','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','find','metadata','getComponentsFromRepository','length','SalesforceQueryService','patchObject','2702787tRgKeL','getOwnPropertyDescriptor','Attachment','GET_REPOSITORY_QUERY','SalesforceService','10443890LbbHnq','objectType','GET_BRANCH_BY_NAME_QUERY','repositoryId','FlosumRepositorySyncDto','defineProperty','Connection__c','text/plain','fromBranchRecord','./salesforce-query.service','Service','../../../../constants/errors','catch','Branch\x20','(((.+)+)+)+$','GET_WAITING_REPOSITORIES_QUERY','__decorate','Branch\x20with\x20Id\x20','4qBnhGY','7416SjwSNz','query','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','getBranchComponents','422775HiQJbR','salesforceService','../queries','../dto/flosum-repository-sync.dto','../../../shared/utils','updateRemoteState','11kDzxKq','disableSync','stringify','../errors/not-found.error','__esModule','10ZvMehg','fromRepositoryRecord','%id%','getBranchRecord','Name','ERR_INVALID_ATTACHMENT_ID','GET_BRANCH_QUERY','\x20not\x20found\x20on\x20salesforce','getComponents','object','getRemoteStateAttachmentId','Repository__r','getAllRepositoryNames','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','GET_REPOSITORY_BY_NAME_QUERY','salesforceQuery','4809DHqrmR','SalesforceNotFoundError','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','166297EwBGWe','FLOSUM_NAMESPACE','12382464TObfKs','map','replace','getRepositoryRecordByName','4RmdRyQ','../../../../constants','SYNC_ATTACHMENT_FOR_BRANCH_NAME'];a270_0x5ac0=function(){return _0x2c70a5;};return a270_0x5ac0();}'use strict';var __decorate=this&&this[a270_0x5cb37f(0x222)]||function(_0x4a2aba,_0x4b7ab9,_0x3b244b,_0x279930){const _0x238c64=a270_0x5cb37f;var _0x34a3b9=arguments['length'],_0x47f97f=_0x34a3b9<0x3?_0x4b7ab9:_0x279930===null?_0x279930=Object[_0x238c64(0x20e)](_0x4b7ab9,_0x3b244b):_0x279930,_0x2069de;if(typeof Reflect===_0x238c64(0x1e1)&&typeof Reflect[_0x238c64(0x1f9)]==='function')_0x47f97f=Reflect['decorate'](_0x4a2aba,_0x4b7ab9,_0x3b244b,_0x279930);else{for(var _0x43454f=_0x4a2aba[_0x238c64(0x20a)]-0x1;_0x43454f>=0x0;_0x43454f--)if(_0x2069de=_0x4a2aba[_0x43454f])_0x47f97f=(_0x34a3b9<0x3?_0x2069de(_0x47f97f):_0x34a3b9>0x3?_0x2069de(_0x4b7ab9,_0x3b244b,_0x47f97f):_0x2069de(_0x4b7ab9,_0x3b244b))||_0x47f97f;}return _0x34a3b9>0x3&&_0x47f97f&&Object[_0x238c64(0x217)](_0x4b7ab9,_0x3b244b,_0x47f97f),_0x47f97f;},__metadata=this&&this[a270_0x5cb37f(0x1f8)]||function(_0x237931,_0x192aff){const _0x434328=a270_0x5cb37f;if(typeof Reflect==='object'&&typeof Reflect[_0x434328(0x208)]==='function')return Reflect[_0x434328(0x208)](_0x237931,_0x192aff);};Object[a270_0x5cb37f(0x217)](exports,a270_0x5cb37f(0x1d7),{'value':!![]}),exports[a270_0x5cb37f(0x1fa)]=void 0x0;const typedi_1=require('typedi'),constants_1=require(a270_0x5cb37f(0x1f2)),errors_1=require(a270_0x5cb37f(0x21d)),utils_1=require(a270_0x5cb37f(0x1d1)),flosum_repository_sync_dto_1=require(a270_0x5cb37f(0x1d0)),not_found_error_1=require(a270_0x5cb37f(0x1d6)),queries_1=require(a270_0x5cb37f(0x1cf)),salesforce_query_service_1=require(a270_0x5cb37f(0x21b)),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0xe59626,_0x2f0da1){const _0x5c78e1=a270_0x5cb37f;this[_0x5c78e1(0x1e7)]=_0xe59626,this[_0x5c78e1(0x1ce)]=_0x2f0da1;}async[a270_0x5cb37f(0x1e0)](_0x30f131){const _0x85f3b5=a270_0x5cb37f;var _0x5dd199;const _0x484ed1=await this[_0x85f3b5(0x1e7)]['query'](_0x30f131),_0x437638=[];for(const _0x74d790 of _0x484ed1){const _0x32eb6a=(_0x5dd199=_0x74d790[constants_1[_0x85f3b5(0x1ec)]+_0x85f3b5(0x204)])===null||_0x5dd199===void 0x0?void 0x0:_0x5dd199['records'];_0x32eb6a&&_0x32eb6a[_0x85f3b5(0x20a)]&&_0x437638[_0x85f3b5(0x1f6)](_0x32eb6a[0x0]['Id']);}return _0x437638;}async[a270_0x5cb37f(0x1e4)](_0x343825){const _0x77e883=a270_0x5cb37f,_0x49b57b=await this[_0x77e883(0x1e7)][_0x77e883(0x226)](queries_1['GET_REPOSITORIES_NAMES_QUERY'][_0x77e883(0x1ef)](/\%connection_id\%/g,_0x343825));return _0x49b57b[_0x77e883(0x1ee)](_0xfcac56=>{const _0x3130a8=_0x77e883;return _0xfcac56[constants_1[_0x3130a8(0x201)]+_0x3130a8(0x1e3)]?_0xfcac56[constants_1[_0x3130a8(0x201)]+_0x3130a8(0x1e3)][_0x3130a8(0x1dc)]:_0xfcac56[_0x3130a8(0x1dc)];});}async[a270_0x5cb37f(0x203)](_0x1037c5){const _0x5dddef=a270_0x5cb37f,_0x5d272a=await this[_0x5dddef(0x1e7)][_0x5dddef(0x226)](queries_1[_0x5dddef(0x221)][_0x5dddef(0x1ef)](/\%connection_id\%/g,_0x1037c5));return _0x5d272a['map'](_0x49a1b3=>flosum_repository_sync_dto_1[_0x5dddef(0x216)][_0x5dddef(0x1d9)](_0x49a1b3));}async['getBranchRecords'](_0x4f893b){const _0x4d5cb1=a270_0x5cb37f,_0x13122e=await this[_0x4d5cb1(0x1e7)][_0x4d5cb1(0x226)](queries_1[_0x4d5cb1(0x1f7)][_0x4d5cb1(0x1ef)](/%repositories_ids\%/g,_0x4f893b));return _0x13122e[_0x4d5cb1(0x1ee)](_0x4c6c88=>flosum_repository_sync_dto_1[_0x4d5cb1(0x216)][_0x4d5cb1(0x21a)](_0x4c6c88));}async['getRepositoryRecord'](_0x4ad557){const _0x56fe42=a270_0x5cb37f,_0x194d07=await this[_0x56fe42(0x1e7)][_0x56fe42(0x226)](queries_1[_0x56fe42(0x210)][_0x56fe42(0x1ef)](_0x56fe42(0x1da),_0x4ad557));if(_0x194d07[_0x56fe42(0x20a)]===0x0)throw new not_found_error_1[(_0x56fe42(0x1e9))]('Repository\x20with\x20Id\x20'+_0x4ad557+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x56fe42(0x1d9)](_0x194d07[0x0]);}async[a270_0x5cb37f(0x1db)](_0x4bf219){const _0x13d1f4=a270_0x5cb37f,_0x1dd7e2=await this[_0x13d1f4(0x1e7)][_0x13d1f4(0x226)](queries_1[_0x13d1f4(0x1de)]['replace'](_0x13d1f4(0x1da),_0x4bf219));if(_0x1dd7e2[_0x13d1f4(0x20a)]===0x0)throw new not_found_error_1[(_0x13d1f4(0x1e9))](_0x13d1f4(0x223)+_0x4bf219+_0x13d1f4(0x1df));return flosum_repository_sync_dto_1[_0x13d1f4(0x216)][_0x13d1f4(0x21a)](_0x1dd7e2[0x0]);}async['getBranchRecordByName'](_0x5006e7){const _0x2fedb6=a270_0x5cb37f,_0x57ece6=await this[_0x2fedb6(0x1e7)]['query'](queries_1[_0x2fedb6(0x214)][_0x2fedb6(0x1ef)]('%name%',_0x5006e7));if(_0x57ece6['length']===0x0)throw new not_found_error_1[(_0x2fedb6(0x1e9))]('Branch\x20'+_0x5006e7+_0x2fedb6(0x1df));const _0x21222c=_0x57ece6[_0x2fedb6(0x207)](_0x46bbdf=>_0x46bbdf[constants_1[_0x2fedb6(0x1ec)]+'Branch_Name__c']===_0x5006e7);if(!_0x21222c)throw new not_found_error_1['SalesforceNotFoundError'](_0x2fedb6(0x21f)+_0x5006e7+_0x2fedb6(0x1df));return flosum_repository_sync_dto_1[_0x2fedb6(0x216)][_0x2fedb6(0x21a)](_0x21222c);}async[a270_0x5cb37f(0x1f0)](_0x172476){const _0x2cbd26=a270_0x5cb37f,_0x572430=await this[_0x2cbd26(0x1e7)]['query'](queries_1[_0x2cbd26(0x1e6)][_0x2cbd26(0x1ef)]('%name%',_0x172476));if(_0x572430[_0x2cbd26(0x20a)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20'+_0x172476+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x2cbd26(0x216)][_0x2cbd26(0x1d9)](_0x572430[0x0]);}async[a270_0x5cb37f(0x209)](_0x4c7a8c){const _0x40cbb3=a270_0x5cb37f,_0x4256ce='\x0a\x20\x20\x20\x20\x20\x20'+queries_1['GET_COMPONENTS_QUERY']+_0x40cbb3(0x1fc)+_0x4c7a8c+'\x27';return this[_0x40cbb3(0x1e0)](_0x4256ce);}async[a270_0x5cb37f(0x228)](_0xac0b2f){const _0x3dbe2c=a270_0x5cb37f,_0x56ad31=_0x3dbe2c(0x1ea)+queries_1['GET_COMPONENTS_QUERY']+_0x3dbe2c(0x227)+_0xac0b2f+'\x27';return this[_0x3dbe2c(0x1e0)](_0x56ad31);}async[a270_0x5cb37f(0x202)](_0x259708){const _0x539e09=a270_0x5cb37f;var _0x4317fe;const _0x12c724=queries_1[_0x539e09(0x206)][_0x539e09(0x1ef)]('%parentId%',_0x259708[_0x539e09(0x205)])['replace']('%name%',_0x259708[_0x539e09(0x215)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x539e09(0x1f3)]),_0x3fe3c2=await this[_0x539e09(0x1e7)][_0x539e09(0x226)](_0x12c724),_0x5a69a9=(_0x4317fe=_0x3fe3c2[0x0])===null||_0x4317fe===void 0x0?void 0x0:_0x4317fe['Id'];if(!_0x5a69a9)throw new Error(errors_1[_0x539e09(0x1dd)]);return _0x5a69a9;}async[a270_0x5cb37f(0x1e2)](_0x97b9d4){const _0x1683a8=a270_0x5cb37f;let _0x1777df=await this[_0x1683a8(0x202)](_0x97b9d4)[_0x1683a8(0x21e)](()=>null);return!_0x1777df&&(_0x1777df=await this[_0x1683a8(0x1ce)][_0x1683a8(0x1fb)]('Attachment',{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x97b9d4[_0x1683a8(0x205)],'ContentType':_0x1683a8(0x219),'Name':_0x97b9d4[_0x1683a8(0x215)]?constants_1[_0x1683a8(0x1e5)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x1777df;}async[a270_0x5cb37f(0x1d2)](_0x3e8bb2,_0x554982){const _0x3e9b65=a270_0x5cb37f,_0x4ff66e=await this[_0x3e9b65(0x1e2)](_0x3e8bb2);await this[_0x3e9b65(0x1ce)][_0x3e9b65(0x20c)](_0x3e9b65(0x20f),_0x4ff66e,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0x3e9b65(0x1d5)](_0x554982))});}async['setStatus'](_0x5f5c93,_0x27e8e1){const _0x163978=a270_0x5cb37f;await this[_0x163978(0x1ce)][_0x163978(0x20c)](_0x5f5c93[_0x163978(0x213)],_0x5f5c93['objectId'],{[constants_1[_0x163978(0x201)]+_0x163978(0x1f5)]:_0x27e8e1});}async[a270_0x5cb37f(0x1d4)](_0x1fe5e3){const _0x48a6e7=a270_0x5cb37f;await this[_0x48a6e7(0x1ce)][_0x48a6e7(0x20c)](constants_1['FLOSUM_GIT_NAMESPACE']+_0x48a6e7(0x218),_0x1fe5e3,{[constants_1[_0x48a6e7(0x201)]+_0x48a6e7(0x200)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a270_0x5cb37f(0x21c)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a270_0x5cb37f(0x20b)],salesforce_service_1[a270_0x5cb37f(0x211)]])],SalesforceSyncService),exports[a270_0x5cb37f(0x1fa)]=SalesforceSyncService;