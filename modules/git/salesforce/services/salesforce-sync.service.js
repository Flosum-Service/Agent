const a191_0x32933a=a191_0x3e0d;(function(_0x4633ea,_0x48120d){const _0xbeb060=a191_0x3e0d,_0x3e502c=_0x4633ea();while(!![]){try{const _0x2e5a5b=parseInt(_0xbeb060(0x12c))/0x1+parseInt(_0xbeb060(0x161))/0x2*(-parseInt(_0xbeb060(0x13b))/0x3)+parseInt(_0xbeb060(0x137))/0x4+-parseInt(_0xbeb060(0x11e))/0x5+-parseInt(_0xbeb060(0x114))/0x6*(parseInt(_0xbeb060(0x132))/0x7)+-parseInt(_0xbeb060(0x13c))/0x8+parseInt(_0xbeb060(0x127))/0x9;if(_0x2e5a5b===_0x48120d)break;else _0x3e502c['push'](_0x3e502c['shift']());}catch(_0xc61dc3){_0x3e502c['push'](_0x3e502c['shift']());}}}(a191_0x4567,0x4b9c3));function a191_0x3e0d(_0x288ecd,_0x14cdf7){const _0xf20d8=a191_0x4567();return a191_0x3e0d=function(_0x5d5b64,_0x409dce){_0x5d5b64=_0x5d5b64-0x114;let _0x4567be=_0xf20d8[_0x5d5b64];return _0x4567be;},a191_0x3e0d(_0x288ecd,_0x14cdf7);}function a191_0x4567(){const _0x5cba5c=['2351772ekWDdh','Repository\x20','constructor','replace','204ykGQIl','3142064aUxRxD','%parentId%','Connection__c','fromBranchRecord','toString','decorate','GET_WAITING_REPOSITORIES_QUERY','SalesforceNotFoundError','__metadata','Repository__r','getAllRepositoryNames','length','getBranchRecordByName','push','\x0a\x20\x20\x20\x20\x20\x20','metadata','object','query','GET_REPOSITORY_BY_NAME_QUERY','../dto/flosum-repository-sync.dto','getRepositoryRecord','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','SYNC_ATTACHMENT_FOR_BRANCH_NAME','getRepositoryRecords','SalesforceSyncService','__decorate','catch','fromRepositoryRecord','getBranchComponents','repositoryId','%id%','\x20not\x20found\x20on\x20salesforce','Branch\x20','getComponentsFromRepository','stringify','../queries','SalesforceService','17480szNyaO','GET_BRANCH_BY_NAME_QUERY','GET_REPOSITORY_QUERY','Repository\x20with\x20Id\x20','salesforceService','Sync_In_Progress__c','getRepositoryRecordByName','FLOSUM_GIT_NAMESPACE','8226hodiLo','disableSync','objectId','Name','Service','search','getBranchRecord','%name%','GET_COMPONENTS_QUERY','getAttachmentId','1359485buHOOh','getBranchRecords','ERR_INVALID_ATTACHMENT_ID','../../../../constants/errors','Branch\x20with\x20Id\x20','salesforceQuery','apply','Attachment','SalesforceQueryService','9340875eCBkBs','text/plain','getRemoteStateAttachmentId','function','defineProperty','311655cGksEa','FlosumRepositorySyncDto','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','records','../errors/not-found.error','../../../shared/utils','1883fYesDj','getComponents','GET_WAITING_BRANCHES_QUERY','../../../../constants','FLOSUM_NAMESPACE'];a191_0x4567=function(){return _0x5cba5c;};return a191_0x4567();}const a191_0x409dce=(function(){let _0x4a4edf=!![];return function(_0x112351,_0xb73f9){const _0x223f55=_0x4a4edf?function(){const _0x3506ca=a191_0x3e0d;if(_0xb73f9){const _0x5a6529=_0xb73f9[_0x3506ca(0x124)](_0x112351,arguments);return _0xb73f9=null,_0x5a6529;}}:function(){};return _0x4a4edf=![],_0x223f55;};}()),a191_0x5d5b64=a191_0x409dce(this,function(){const _0x5e1b6e=a191_0x3e0d;return a191_0x5d5b64[_0x5e1b6e(0x140)]()[_0x5e1b6e(0x119)]('(((.+)+)+)+$')[_0x5e1b6e(0x140)]()[_0x5e1b6e(0x139)](a191_0x5d5b64)[_0x5e1b6e(0x119)]('(((.+)+)+)+$');});a191_0x5d5b64();'use strict';var __decorate=this&&this[a191_0x32933a(0x155)]||function(_0x2995c8,_0x4fa4c5,_0x25286b,_0x11013e){const _0x3c4d77=a191_0x32933a;var _0x5028cf=arguments[_0x3c4d77(0x147)],_0x39bf10=_0x5028cf<0x3?_0x4fa4c5:_0x11013e===null?_0x11013e=Object['getOwnPropertyDescriptor'](_0x4fa4c5,_0x25286b):_0x11013e,_0x31a834;if(typeof Reflect===_0x3c4d77(0x14c)&&typeof Reflect['decorate']==='function')_0x39bf10=Reflect[_0x3c4d77(0x141)](_0x2995c8,_0x4fa4c5,_0x25286b,_0x11013e);else{for(var _0x18cbe8=_0x2995c8[_0x3c4d77(0x147)]-0x1;_0x18cbe8>=0x0;_0x18cbe8--)if(_0x31a834=_0x2995c8[_0x18cbe8])_0x39bf10=(_0x5028cf<0x3?_0x31a834(_0x39bf10):_0x5028cf>0x3?_0x31a834(_0x4fa4c5,_0x25286b,_0x39bf10):_0x31a834(_0x4fa4c5,_0x25286b))||_0x39bf10;}return _0x5028cf>0x3&&_0x39bf10&&Object['defineProperty'](_0x4fa4c5,_0x25286b,_0x39bf10),_0x39bf10;},__metadata=this&&this[a191_0x32933a(0x144)]||function(_0x3dc48f,_0x4ebfbe){const _0x21d76a=a191_0x32933a;if(typeof Reflect===_0x21d76a(0x14c)&&typeof Reflect[_0x21d76a(0x14b)]===_0x21d76a(0x12a))return Reflect[_0x21d76a(0x14b)](_0x3dc48f,_0x4ebfbe);};Object[a191_0x32933a(0x12b)](exports,'__esModule',{'value':!![]}),exports[a191_0x32933a(0x154)]=void 0x0;const typedi_1=require('typedi'),constants_1=require(a191_0x32933a(0x135)),errors_1=require(a191_0x32933a(0x121)),utils_1=require(a191_0x32933a(0x131)),flosum_repository_sync_dto_1=require(a191_0x32933a(0x14f)),not_found_error_1=require(a191_0x32933a(0x130)),queries_1=require(a191_0x32933a(0x15f)),salesforce_query_service_1=require('./salesforce-query.service'),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0x53ae75,_0x4a6256){const _0x142d01=a191_0x32933a;this[_0x142d01(0x123)]=_0x53ae75,this[_0x142d01(0x165)]=_0x4a6256;}async[a191_0x32933a(0x133)](_0x401c26){const _0x221b2a=a191_0x32933a;var _0x505ba1;const _0xe64400=await this[_0x221b2a(0x123)][_0x221b2a(0x14d)](_0x401c26),_0x47869c=[];for(const _0x5e62a1 of _0xe64400){const _0x5cc3a3=(_0x505ba1=_0x5e62a1[constants_1[_0x221b2a(0x136)]+'Components__r'])===null||_0x505ba1===void 0x0?void 0x0:_0x505ba1[_0x221b2a(0x12f)];_0x5cc3a3&&_0x5cc3a3['length']&&_0x47869c[_0x221b2a(0x149)](_0x5cc3a3[0x0]['Id']);}return _0x47869c;}async[a191_0x32933a(0x146)](_0x59c49d){const _0x460e55=a191_0x32933a,_0x21193c=await this[_0x460e55(0x123)][_0x460e55(0x14d)](queries_1['GET_REPOSITORIES_NAMES_QUERY'][_0x460e55(0x13a)](/\%connection_id\%/g,_0x59c49d));return _0x21193c['map'](_0x1efbb7=>{const _0x298f63=_0x460e55;return _0x1efbb7[constants_1[_0x298f63(0x168)]+_0x298f63(0x145)]?_0x1efbb7[constants_1[_0x298f63(0x168)]+'Repository__r'][_0x298f63(0x117)]:_0x1efbb7[_0x298f63(0x117)];});}async[a191_0x32933a(0x153)](_0x36c8d5){const _0x1b61fb=a191_0x32933a,_0x3b428f=await this[_0x1b61fb(0x123)][_0x1b61fb(0x14d)](queries_1[_0x1b61fb(0x142)][_0x1b61fb(0x13a)](/\%connection_id\%/g,_0x36c8d5));return _0x3b428f['map'](_0x39decf=>flosum_repository_sync_dto_1[_0x1b61fb(0x12d)]['fromRepositoryRecord'](_0x39decf));}async[a191_0x32933a(0x11f)](_0x23711f){const _0x1c10e5=a191_0x32933a,_0x340fa2=await this[_0x1c10e5(0x123)][_0x1c10e5(0x14d)](queries_1[_0x1c10e5(0x134)]['replace'](/%repositories_ids\%/g,_0x23711f));return _0x340fa2['map'](_0xdc2d5=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0xdc2d5));}async[a191_0x32933a(0x150)](_0x2f3c43){const _0x2093e4=a191_0x32933a,_0x47fd62=await this[_0x2093e4(0x123)][_0x2093e4(0x14d)](queries_1[_0x2093e4(0x163)][_0x2093e4(0x13a)]('%id%',_0x2f3c43));if(_0x47fd62[_0x2093e4(0x147)]===0x0)throw new not_found_error_1[(_0x2093e4(0x143))](_0x2093e4(0x164)+_0x2f3c43+_0x2093e4(0x15b));return flosum_repository_sync_dto_1[_0x2093e4(0x12d)][_0x2093e4(0x157)](_0x47fd62[0x0]);}async[a191_0x32933a(0x11a)](_0x2a1343){const _0x399d13=a191_0x32933a,_0x5f104f=await this['salesforceQuery'][_0x399d13(0x14d)](queries_1['GET_BRANCH_QUERY'][_0x399d13(0x13a)](_0x399d13(0x15a),_0x2a1343));if(_0x5f104f[_0x399d13(0x147)]===0x0)throw new not_found_error_1[(_0x399d13(0x143))](_0x399d13(0x122)+_0x2a1343+_0x399d13(0x15b));return flosum_repository_sync_dto_1[_0x399d13(0x12d)][_0x399d13(0x13f)](_0x5f104f[0x0]);}async[a191_0x32933a(0x148)](_0x43141d){const _0x3cfdbf=a191_0x32933a,_0x289c36=await this[_0x3cfdbf(0x123)][_0x3cfdbf(0x14d)](queries_1[_0x3cfdbf(0x162)][_0x3cfdbf(0x13a)](_0x3cfdbf(0x11b),_0x43141d));if(_0x289c36[_0x3cfdbf(0x147)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x3cfdbf(0x15c)+_0x43141d+_0x3cfdbf(0x15b));return flosum_repository_sync_dto_1[_0x3cfdbf(0x12d)][_0x3cfdbf(0x13f)](_0x289c36[0x0]);}async[a191_0x32933a(0x167)](_0xecfcd0){const _0x249814=a191_0x32933a,_0x49570a=await this[_0x249814(0x123)][_0x249814(0x14d)](queries_1[_0x249814(0x14e)][_0x249814(0x13a)](_0x249814(0x11b),_0xecfcd0));if(_0x49570a[_0x249814(0x147)]===0x0)throw new not_found_error_1[(_0x249814(0x143))](_0x249814(0x138)+_0xecfcd0+_0x249814(0x15b));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x49570a[0x0]);}async[a191_0x32933a(0x15d)](_0xe536bb){const _0x553d68=a191_0x32933a,_0x5bf6c3=_0x553d68(0x14a)+queries_1[_0x553d68(0x11c)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0xe536bb+'\x27';return this[_0x553d68(0x133)](_0x5bf6c3);}async[a191_0x32933a(0x158)](_0x2ddf9e){const _0x5666d6=a191_0x32933a,_0x4d608d='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x5666d6(0x11c)]+_0x5666d6(0x12e)+_0x2ddf9e+'\x27';return this[_0x5666d6(0x133)](_0x4d608d);}async[a191_0x32933a(0x11d)](_0x3260fd){const _0xe5ff13=a191_0x32933a;var _0x2deff8;const _0x282524=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0xe5ff13(0x13a)](_0xe5ff13(0x13d),_0x3260fd[_0xe5ff13(0x116)])[_0xe5ff13(0x13a)](_0xe5ff13(0x11b),_0x3260fd['repositoryId']?constants_1[_0xe5ff13(0x151)]:constants_1[_0xe5ff13(0x152)]),_0x216e43=await this[_0xe5ff13(0x123)][_0xe5ff13(0x14d)](_0x282524),_0x4ed1b=(_0x2deff8=_0x216e43[0x0])===null||_0x2deff8===void 0x0?void 0x0:_0x2deff8['Id'];if(!_0x4ed1b)throw new Error(errors_1[_0xe5ff13(0x120)]);return _0x4ed1b;}async[a191_0x32933a(0x129)](_0x583991){const _0x375553=a191_0x32933a;let _0x1b5ef8=await this[_0x375553(0x11d)](_0x583991)[_0x375553(0x156)](()=>null);return!_0x1b5ef8&&(_0x1b5ef8=await this[_0x375553(0x165)]['createObject'](_0x375553(0x125),{'Body':utils_1['encodeBase64']('{}'),'ParentId':_0x583991[_0x375553(0x116)],'ContentType':_0x375553(0x128),'Name':_0x583991[_0x375553(0x159)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x375553(0x152)]})),_0x1b5ef8;}async['updateRemoteState'](_0x11eedb,_0x49c440){const _0x20a628=a191_0x32933a,_0x4f4d99=await this[_0x20a628(0x129)](_0x11eedb);await this[_0x20a628(0x165)]['patchObject'](_0x20a628(0x125),_0x4f4d99,{'Body':utils_1['encodeBase64'](JSON[_0x20a628(0x15e)](_0x49c440))});}async['setStatus'](_0x2e42ce,_0xc656ae){const _0x407848=a191_0x32933a;await this['salesforceService']['patchObject'](_0x2e42ce['objectType'],_0x2e42ce[_0x407848(0x116)],{[constants_1[_0x407848(0x168)]+'Synchronization_Status__c']:_0xc656ae});}async[a191_0x32933a(0x115)](_0x1de958){const _0x58fb57=a191_0x32933a;await this[_0x58fb57(0x165)]['patchObject'](constants_1['FLOSUM_GIT_NAMESPACE']+_0x58fb57(0x13e),_0x1de958,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x58fb57(0x166)]:![]});}};SalesforceSyncService=__decorate([typedi_1[a191_0x32933a(0x118)](),__metadata('design:paramtypes',[salesforce_query_service_1[a191_0x32933a(0x126)],salesforce_service_1[a191_0x32933a(0x160)]])],SalesforceSyncService),exports[a191_0x32933a(0x154)]=SalesforceSyncService;