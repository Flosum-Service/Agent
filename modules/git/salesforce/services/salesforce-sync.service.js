const a243_0x4fcadc=a243_0xe5c3;(function(_0x4c269d,_0x3f9396){const _0x1b792f=a243_0xe5c3,_0x3ce4d6=_0x4c269d();while(!![]){try{const _0x42de12=-parseInt(_0x1b792f(0x1e6))/0x1+-parseInt(_0x1b792f(0x1eb))/0x2*(-parseInt(_0x1b792f(0x1dd))/0x3)+-parseInt(_0x1b792f(0x1f7))/0x4+parseInt(_0x1b792f(0x202))/0x5*(parseInt(_0x1b792f(0x21f))/0x6)+-parseInt(_0x1b792f(0x220))/0x7*(parseInt(_0x1b792f(0x1d7))/0x8)+parseInt(_0x1b792f(0x21a))/0x9*(parseInt(_0x1b792f(0x1d1))/0xa)+parseInt(_0x1b792f(0x1cc))/0xb*(parseInt(_0x1b792f(0x1d2))/0xc);if(_0x42de12===_0x3f9396)break;else _0x3ce4d6['push'](_0x3ce4d6['shift']());}catch(_0x10b8ad){_0x3ce4d6['push'](_0x3ce4d6['shift']());}}}(a243_0xe1a0,0xf2949));const a243_0x3946e1=(function(){let _0x39625f=!![];return function(_0xc621de,_0x1adb36){const _0x46208b=_0x39625f?function(){if(_0x1adb36){const _0x38a416=_0x1adb36['apply'](_0xc621de,arguments);return _0x1adb36=null,_0x38a416;}}:function(){};return _0x39625f=![],_0x46208b;};}()),a243_0x4cd1ad=a243_0x3946e1(this,function(){const _0x18c931=a243_0xe5c3;return a243_0x4cd1ad[_0x18c931(0x1f3)]()[_0x18c931(0x209)](_0x18c931(0x1e7))[_0x18c931(0x1f3)]()[_0x18c931(0x222)](a243_0x4cd1ad)[_0x18c931(0x209)](_0x18c931(0x1e7));});function a243_0xe5c3(_0x3739d,_0xc636f0){const _0x49014b=a243_0xe1a0();return a243_0xe5c3=function(_0x4cd1ad,_0x3946e1){_0x4cd1ad=_0x4cd1ad-0x1c5;let _0xe1a022=_0x49014b[_0x4cd1ad];return _0xe1a022;},a243_0xe5c3(_0x3739d,_0xc636f0);}a243_0x4cd1ad();'use strict';var __decorate=this&&this[a243_0x4fcadc(0x20f)]||function(_0x1c90bb,_0x3dc8b6,_0x402565,_0x44e8a8){const _0x235bf7=a243_0x4fcadc;var _0x2b63c7=arguments[_0x235bf7(0x201)],_0x5b022f=_0x2b63c7<0x3?_0x3dc8b6:_0x44e8a8===null?_0x44e8a8=Object[_0x235bf7(0x1fa)](_0x3dc8b6,_0x402565):_0x44e8a8,_0x462718;if(typeof Reflect===_0x235bf7(0x21c)&&typeof Reflect[_0x235bf7(0x1e9)]===_0x235bf7(0x21d))_0x5b022f=Reflect[_0x235bf7(0x1e9)](_0x1c90bb,_0x3dc8b6,_0x402565,_0x44e8a8);else{for(var _0x26b06b=_0x1c90bb[_0x235bf7(0x201)]-0x1;_0x26b06b>=0x0;_0x26b06b--)if(_0x462718=_0x1c90bb[_0x26b06b])_0x5b022f=(_0x2b63c7<0x3?_0x462718(_0x5b022f):_0x2b63c7>0x3?_0x462718(_0x3dc8b6,_0x402565,_0x5b022f):_0x462718(_0x3dc8b6,_0x402565))||_0x5b022f;}return _0x2b63c7>0x3&&_0x5b022f&&Object[_0x235bf7(0x207)](_0x3dc8b6,_0x402565,_0x5b022f),_0x5b022f;},__metadata=this&&this[a243_0x4fcadc(0x1c8)]||function(_0x1017cf,_0xec63cb){const _0xa6141a=a243_0x4fcadc;if(typeof Reflect===_0xa6141a(0x21c)&&typeof Reflect['metadata']===_0xa6141a(0x21d))return Reflect[_0xa6141a(0x217)](_0x1017cf,_0xec63cb);};Object[a243_0x4fcadc(0x207)](exports,a243_0x4fcadc(0x214),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require('typedi'),constants_1=require('../../../../constants'),errors_1=require(a243_0x4fcadc(0x218)),utils_1=require(a243_0x4fcadc(0x1f1)),flosum_repository_sync_dto_1=require(a243_0x4fcadc(0x1d8)),not_found_error_1=require(a243_0x4fcadc(0x212)),queries_1=require(a243_0x4fcadc(0x1e2)),salesforce_query_service_1=require(a243_0x4fcadc(0x1ed)),salesforce_service_1=require(a243_0x4fcadc(0x210));function a243_0xe1a0(){const _0x3bcf33=['GET_REPOSITORY_BY_NAME_QUERY','__esModule','GET_WAITING_BRANCHES_QUERY','getAllRepositoryNames','metadata','../../../../constants/errors','query','9vcErPb','records','object','function','SalesforceService','295182XxHMzc','28eWXssQ','salesforceQuery','constructor','Repository__r','catch','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','__metadata','objectType','GET_BRANCH_BY_NAME_QUERY','objectId','99glSVUr','FlosumRepositorySyncDto','push','salesforceService','disableSync','5674330WwHsyz','1085004HxPsJn','updateRemoteState','getComponents','Repository\x20','design:paramtypes','1299960JYUPwK','../dto/flosum-repository-sync.dto','GET_BRANCH_QUERY','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','GET_COMPONENTS_QUERY','Branch\x20with\x20Id\x20','66FdFwXh','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','text/plain','\x20not\x20found\x20on\x20salesforce','getComponentsFromRepository','../queries','fromRepositoryRecord','FLOSUM_NAMESPACE','SYNC_ATTACHMENT_FOR_BRANCH_NAME','387387WTQtzC','(((.+)+)+)+$','encodeBase64','decorate','GET_REPOSITORY_QUERY','65188pwjwdA','ERR_INVALID_ATTACHMENT_ID','./salesforce-query.service','Synchronization_Status__c','getBranchComponents','Attachment','../../../shared/utils','repositoryId','toString','fromBranchRecord','map','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','6369540cgudDN','stringify','GET_WAITING_REPOSITORIES_QUERY','getOwnPropertyDescriptor','replace','getAttachmentId','patchObject','Branch\x20','SalesforceQueryService','Sync_In_Progress__c','length','155skhkMY','getBranchRecords','getRemoteStateAttachmentId','getBranchRecordByName','Name','defineProperty','FLOSUM_GIT_NAMESPACE','search','Connection__c','Service','SalesforceNotFoundError','getRepositoryRecords','%id%','__decorate','./salesforce.service','%name%','../errors/not-found.error'];a243_0xe1a0=function(){return _0x3bcf33;};return a243_0xe1a0();}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x1ecc0a,_0xdc16b2){const _0x33e811=a243_0x4fcadc;this['salesforceQuery']=_0x1ecc0a,this[_0x33e811(0x1cf)]=_0xdc16b2;}async[a243_0x4fcadc(0x1d4)](_0x588085){const _0x32873f=a243_0x4fcadc;var _0x50d759;const _0x226025=await this[_0x32873f(0x221)][_0x32873f(0x219)](_0x588085),_0x12017c=[];for(const _0x1b9094 of _0x226025){const _0x1ba1ba=(_0x50d759=_0x1b9094[constants_1[_0x32873f(0x1e4)]+'Components__r'])===null||_0x50d759===void 0x0?void 0x0:_0x50d759[_0x32873f(0x21b)];_0x1ba1ba&&_0x1ba1ba[_0x32873f(0x201)]&&_0x12017c[_0x32873f(0x1ce)](_0x1ba1ba[0x0]['Id']);}return _0x12017c;}async[a243_0x4fcadc(0x216)](_0x58756a){const _0x482a38=a243_0x4fcadc,_0x1cb05a=await this[_0x482a38(0x221)]['query'](queries_1['GET_REPOSITORIES_NAMES_QUERY'][_0x482a38(0x1fb)](/\%connection_id\%/g,_0x58756a));return _0x1cb05a[_0x482a38(0x1f5)](_0x1d41df=>{const _0x55eef7=_0x482a38;return _0x1d41df[constants_1[_0x55eef7(0x208)]+_0x55eef7(0x1c5)]?_0x1d41df[constants_1[_0x55eef7(0x208)]+_0x55eef7(0x1c5)][_0x55eef7(0x206)]:_0x1d41df[_0x55eef7(0x206)];});}async[a243_0x4fcadc(0x20d)](_0xe40403){const _0x410468=a243_0x4fcadc,_0x29b695=await this[_0x410468(0x221)][_0x410468(0x219)](queries_1[_0x410468(0x1f9)][_0x410468(0x1fb)](/\%connection_id\%/g,_0xe40403));return _0x29b695[_0x410468(0x1f5)](_0xbcb456=>flosum_repository_sync_dto_1[_0x410468(0x1cd)]['fromRepositoryRecord'](_0xbcb456));}async[a243_0x4fcadc(0x203)](_0x556101){const _0x5b28fe=a243_0x4fcadc,_0x49aa4e=await this['salesforceQuery'][_0x5b28fe(0x219)](queries_1[_0x5b28fe(0x215)][_0x5b28fe(0x1fb)](/%repositories_ids\%/g,_0x556101));return _0x49aa4e[_0x5b28fe(0x1f5)](_0x1c4151=>flosum_repository_sync_dto_1[_0x5b28fe(0x1cd)]['fromBranchRecord'](_0x1c4151));}async['getRepositoryRecord'](_0x3df502){const _0x442c96=a243_0x4fcadc,_0x163334=await this['salesforceQuery'][_0x442c96(0x219)](queries_1[_0x442c96(0x1ea)][_0x442c96(0x1fb)](_0x442c96(0x20e),_0x3df502));if(_0x163334[_0x442c96(0x201)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20with\x20Id\x20'+_0x3df502+_0x442c96(0x1e0));return flosum_repository_sync_dto_1[_0x442c96(0x1cd)]['fromRepositoryRecord'](_0x163334[0x0]);}async['getBranchRecord'](_0x5a8b24){const _0x58ca14=a243_0x4fcadc,_0x303d58=await this[_0x58ca14(0x221)][_0x58ca14(0x219)](queries_1[_0x58ca14(0x1d9)][_0x58ca14(0x1fb)](_0x58ca14(0x20e),_0x5a8b24));if(_0x303d58['length']===0x0)throw new not_found_error_1[(_0x58ca14(0x20c))](_0x58ca14(0x1dc)+_0x5a8b24+_0x58ca14(0x1e0));return flosum_repository_sync_dto_1[_0x58ca14(0x1cd)][_0x58ca14(0x1f4)](_0x303d58[0x0]);}async[a243_0x4fcadc(0x205)](_0x14f79d){const _0x61b1a6=a243_0x4fcadc,_0x3ca9ae=await this[_0x61b1a6(0x221)][_0x61b1a6(0x219)](queries_1[_0x61b1a6(0x1ca)][_0x61b1a6(0x1fb)](_0x61b1a6(0x211),_0x14f79d));if(_0x3ca9ae[_0x61b1a6(0x201)]===0x0)throw new not_found_error_1[(_0x61b1a6(0x20c))](_0x61b1a6(0x1fe)+_0x14f79d+_0x61b1a6(0x1e0));const _0x6e48e5=_0x3ca9ae['find'](_0x3a2501=>_0x3a2501[constants_1[_0x61b1a6(0x1e4)]+'Branch_Name__c']===_0x14f79d);if(!_0x6e48e5)throw new not_found_error_1[(_0x61b1a6(0x20c))]('Branch\x20'+_0x14f79d+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x61b1a6(0x1cd)]['fromBranchRecord'](_0x6e48e5);}async['getRepositoryRecordByName'](_0x5c2aef){const _0x53d462=a243_0x4fcadc,_0x586f1f=await this[_0x53d462(0x221)][_0x53d462(0x219)](queries_1[_0x53d462(0x213)][_0x53d462(0x1fb)](_0x53d462(0x211),_0x5c2aef));if(_0x586f1f[_0x53d462(0x201)]===0x0)throw new not_found_error_1[(_0x53d462(0x20c))](_0x53d462(0x1d5)+_0x5c2aef+_0x53d462(0x1e0));return flosum_repository_sync_dto_1[_0x53d462(0x1cd)][_0x53d462(0x1e3)](_0x586f1f[0x0]);}async[a243_0x4fcadc(0x1e1)](_0x450b72){const _0x1ee1a9=a243_0x4fcadc,_0x43fb0a='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x1ee1a9(0x1db)]+_0x1ee1a9(0x1da)+_0x450b72+'\x27';return this['getComponents'](_0x43fb0a);}async[a243_0x4fcadc(0x1ef)](_0x2f376e){const _0x3570fc=a243_0x4fcadc,_0x4c3e7e='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x3570fc(0x1db)]+_0x3570fc(0x1f6)+_0x2f376e+'\x27';return this['getComponents'](_0x4c3e7e);}async['getAttachmentId'](_0x5de39c){const _0x399dd1=a243_0x4fcadc;var _0x8b7c03;const _0x2a056f=queries_1[_0x399dd1(0x1c7)][_0x399dd1(0x1fb)]('%parentId%',_0x5de39c['objectId'])[_0x399dd1(0x1fb)]('%name%',_0x5de39c[_0x399dd1(0x1f2)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x31b590=await this[_0x399dd1(0x221)][_0x399dd1(0x219)](_0x2a056f),_0x36fe13=(_0x8b7c03=_0x31b590[0x0])===null||_0x8b7c03===void 0x0?void 0x0:_0x8b7c03['Id'];if(!_0x36fe13)throw new Error(errors_1[_0x399dd1(0x1ec)]);return _0x36fe13;}async[a243_0x4fcadc(0x204)](_0x2f1f3b){const _0x40fbb8=a243_0x4fcadc;let _0x325004=await this[_0x40fbb8(0x1fc)](_0x2f1f3b)[_0x40fbb8(0x1c6)](()=>null);return!_0x325004&&(_0x325004=await this[_0x40fbb8(0x1cf)]['createObject'](_0x40fbb8(0x1f0),{'Body':(0x0,utils_1[_0x40fbb8(0x1e8)])('{}'),'ParentId':_0x2f1f3b[_0x40fbb8(0x1cb)],'ContentType':_0x40fbb8(0x1df),'Name':_0x2f1f3b[_0x40fbb8(0x1f2)]?constants_1[_0x40fbb8(0x1de)]:constants_1[_0x40fbb8(0x1e5)]})),_0x325004;}async[a243_0x4fcadc(0x1d3)](_0x18f0e5,_0x5b0cae){const _0x325ddd=a243_0x4fcadc,_0x2a9cb4=await this[_0x325ddd(0x204)](_0x18f0e5);await this[_0x325ddd(0x1cf)][_0x325ddd(0x1fd)]('Attachment',_0x2a9cb4,{'Body':(0x0,utils_1[_0x325ddd(0x1e8)])(JSON[_0x325ddd(0x1f8)](_0x5b0cae))});}async['setStatus'](_0x5538cc,_0x2ba3d3){const _0x4db27e=a243_0x4fcadc;await this[_0x4db27e(0x1cf)][_0x4db27e(0x1fd)](_0x5538cc[_0x4db27e(0x1c9)],_0x5538cc[_0x4db27e(0x1cb)],{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x4db27e(0x1ee)]:_0x2ba3d3});}async[a243_0x4fcadc(0x1d0)](_0x59c341){const _0xf69daf=a243_0x4fcadc;await this[_0xf69daf(0x1cf)][_0xf69daf(0x1fd)](constants_1[_0xf69daf(0x208)]+_0xf69daf(0x20a),_0x59c341,{[constants_1[_0xf69daf(0x208)]+_0xf69daf(0x200)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a243_0x4fcadc(0x20b)])(),__metadata(a243_0x4fcadc(0x1d6),[salesforce_query_service_1[a243_0x4fcadc(0x1ff)],salesforce_service_1[a243_0x4fcadc(0x21e)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;