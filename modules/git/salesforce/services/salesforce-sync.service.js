const a243_0x54bbe8=a243_0x5960;function a243_0x5960(_0x1ca26c,_0xd1c8f9){const _0x198305=a243_0x3827();return a243_0x5960=function(_0x3d2e4b,_0x8a0c6b){_0x3d2e4b=_0x3d2e4b-0xa8;let _0x3827fe=_0x198305[_0x3d2e4b];return _0x3827fe;},a243_0x5960(_0x1ca26c,_0xd1c8f9);}(function(_0xc984cc,_0x26656b){const _0x474b35=a243_0x5960,_0xda2c60=_0xc984cc();while(!![]){try{const _0x39198c=-parseInt(_0x474b35(0xc3))/0x1+parseInt(_0x474b35(0xe2))/0x2+parseInt(_0x474b35(0xf4))/0x3*(parseInt(_0x474b35(0xb1))/0x4)+parseInt(_0x474b35(0xe1))/0x5+parseInt(_0x474b35(0xf9))/0x6+parseInt(_0x474b35(0xf3))/0x7*(-parseInt(_0x474b35(0xd9))/0x8)+-parseInt(_0x474b35(0xdc))/0x9;if(_0x39198c===_0x26656b)break;else _0xda2c60['push'](_0xda2c60['shift']());}catch(_0x2ebb25){_0xda2c60['push'](_0xda2c60['shift']());}}}(a243_0x3827,0x6a70c));function a243_0x3827(){const _0x557ef3=['object','getRepositoryRecord','./salesforce.service','length','typedi','%name%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','FLOSUM_NAMESPACE','Branch\x20','8WvecAT','getBranchComponents','SYNC_ATTACHMENT_FOR_BRANCH_NAME','3670875WvCtNJ','Repository__r','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','apply','metadata','306630IpFcDh','1692736MtgOeu','GET_COMPONENTS_QUERY','replace','catch','getRepositoryRecordByName','SalesforceService','__decorate','Service','disableSync','salesforceQuery','records','\x20not\x20found\x20on\x20salesforce','getAllRepositoryNames','objectId','SalesforceNotFoundError','fromRepositoryRecord','ERR_INVALID_ATTACHMENT_ID','1366372SAybRR','3GKiAxD','Attachment','../../../../constants','__esModule','updateRemoteState','3341430gOyaAJ','decorate','salesforceService','function','GET_WAITING_BRANCHES_QUERY','FLOSUM_GIT_NAMESPACE','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','patchObject','find','getComponents','GET_WAITING_REPOSITORIES_QUERY','FlosumRepositorySyncDto','GET_BRANCH_BY_NAME_QUERY','(((.+)+)+)+$','845032tyWfds','query','Synchronization_Status__c','encodeBase64','Branch\x20with\x20Id\x20','Name','Branch_Name__c','getBranchRecordByName','getComponentsFromRepository','map','getAttachmentId','getBranchRecord','text/plain','toString','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','Components__r','repositoryId','defineProperty','636806fzJhxK','createObject','./salesforce-query.service','GET_REPOSITORIES_NAMES_QUERY','%id%','design:paramtypes','Repository\x20','search','getRemoteStateAttachmentId','fromBranchRecord','constructor','SalesforceSyncService','../queries'];a243_0x3827=function(){return _0x557ef3;};return a243_0x3827();}const a243_0x8a0c6b=(function(){let _0x12529e=!![];return function(_0x24481e,_0x3f5b5b){const _0x17489e=_0x12529e?function(){const _0x28ada8=a243_0x5960;if(_0x3f5b5b){const _0x37adf1=_0x3f5b5b[_0x28ada8(0xdf)](_0x24481e,arguments);return _0x3f5b5b=null,_0x37adf1;}}:function(){};return _0x12529e=![],_0x17489e;};}()),a243_0x3d2e4b=a243_0x8a0c6b(this,function(){const _0x118365=a243_0x5960;return a243_0x3d2e4b[_0x118365(0xbe)]()[_0x118365(0xca)](_0x118365(0xb0))[_0x118365(0xbe)]()[_0x118365(0xcd)](a243_0x3d2e4b)[_0x118365(0xca)](_0x118365(0xb0));});a243_0x3d2e4b();'use strict';var __decorate=this&&this[a243_0x54bbe8(0xe8)]||function(_0x2cfb4c,_0x113b41,_0x280f20,_0x4264a1){const _0x182503=a243_0x54bbe8;var _0x4d06af=arguments[_0x182503(0xd3)],_0x49ba69=_0x4d06af<0x3?_0x113b41:_0x4264a1===null?_0x4264a1=Object['getOwnPropertyDescriptor'](_0x113b41,_0x280f20):_0x4264a1,_0x13a7cd;if(typeof Reflect==='object'&&typeof Reflect[_0x182503(0xfa)]==='function')_0x49ba69=Reflect[_0x182503(0xfa)](_0x2cfb4c,_0x113b41,_0x280f20,_0x4264a1);else{for(var _0x3c0ab5=_0x2cfb4c['length']-0x1;_0x3c0ab5>=0x0;_0x3c0ab5--)if(_0x13a7cd=_0x2cfb4c[_0x3c0ab5])_0x49ba69=(_0x4d06af<0x3?_0x13a7cd(_0x49ba69):_0x4d06af>0x3?_0x13a7cd(_0x113b41,_0x280f20,_0x49ba69):_0x13a7cd(_0x113b41,_0x280f20))||_0x49ba69;}return _0x4d06af>0x3&&_0x49ba69&&Object['defineProperty'](_0x113b41,_0x280f20,_0x49ba69),_0x49ba69;},__metadata=this&&this['__metadata']||function(_0x17143b,_0x106d58){const _0xa4cb73=a243_0x54bbe8;if(typeof Reflect===_0xa4cb73(0xd0)&&typeof Reflect['metadata']===_0xa4cb73(0xfc))return Reflect[_0xa4cb73(0xe0)](_0x17143b,_0x106d58);};Object[a243_0x54bbe8(0xc2)](exports,a243_0x54bbe8(0xf7),{'value':!![]}),exports[a243_0x54bbe8(0xce)]=void 0x0;const typedi_1=require(a243_0x54bbe8(0xd4)),constants_1=require(a243_0x54bbe8(0xf6)),errors_1=require('../../../../constants/errors'),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a243_0x54bbe8(0xcf)),salesforce_query_service_1=require(a243_0x54bbe8(0xc5)),salesforce_service_1=require(a243_0x54bbe8(0xd2));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x5cdfc4,_0x1e6a40){const _0x5bd026=a243_0x54bbe8;this['salesforceQuery']=_0x5cdfc4,this[_0x5bd026(0xfb)]=_0x1e6a40;}async[a243_0x54bbe8(0xac)](_0x219dde){const _0x22941b=a243_0x54bbe8;var _0x2300f9;const _0x4ea870=await this[_0x22941b(0xeb)][_0x22941b(0xb2)](_0x219dde),_0x2c68a6=[];for(const _0x471af4 of _0x4ea870){const _0x34f1af=(_0x2300f9=_0x471af4[constants_1[_0x22941b(0xd7)]+_0x22941b(0xc0)])===null||_0x2300f9===void 0x0?void 0x0:_0x2300f9[_0x22941b(0xec)];_0x34f1af&&_0x34f1af['length']&&_0x2c68a6['push'](_0x34f1af[0x0]['Id']);}return _0x2c68a6;}async[a243_0x54bbe8(0xee)](_0xd014e9){const _0x39ec49=a243_0x54bbe8,_0x2e7ad9=await this[_0x39ec49(0xeb)][_0x39ec49(0xb2)](queries_1[_0x39ec49(0xc6)][_0x39ec49(0xe4)](/\%connection_id\%/g,_0xd014e9));return _0x2e7ad9[_0x39ec49(0xba)](_0x1f35a2=>{const _0x18efe0=_0x39ec49;return _0x1f35a2[constants_1['FLOSUM_GIT_NAMESPACE']+'Repository__r']?_0x1f35a2[constants_1[_0x18efe0(0xa8)]+_0x18efe0(0xdd)][_0x18efe0(0xb6)]:_0x1f35a2[_0x18efe0(0xb6)];});}async['getRepositoryRecords'](_0x3b8000){const _0x2b589a=a243_0x54bbe8,_0x3dcd94=await this[_0x2b589a(0xeb)][_0x2b589a(0xb2)](queries_1[_0x2b589a(0xad)][_0x2b589a(0xe4)](/\%connection_id\%/g,_0x3b8000));return _0x3dcd94[_0x2b589a(0xba)](_0x577332=>flosum_repository_sync_dto_1[_0x2b589a(0xae)][_0x2b589a(0xf1)](_0x577332));}async['getBranchRecords'](_0x51dc8b){const _0x590952=a243_0x54bbe8,_0x161cc4=await this[_0x590952(0xeb)][_0x590952(0xb2)](queries_1[_0x590952(0xfd)][_0x590952(0xe4)](/%repositories_ids\%/g,_0x51dc8b));return _0x161cc4[_0x590952(0xba)](_0x27dfbe=>flosum_repository_sync_dto_1[_0x590952(0xae)][_0x590952(0xcc)](_0x27dfbe));}async[a243_0x54bbe8(0xd1)](_0x251440){const _0x355e34=a243_0x54bbe8,_0x5cdc37=await this[_0x355e34(0xeb)]['query'](queries_1['GET_REPOSITORY_QUERY'][_0x355e34(0xe4)]('%id%',_0x251440));if(_0x5cdc37[_0x355e34(0xd3)]===0x0)throw new not_found_error_1[(_0x355e34(0xf0))]('Repository\x20with\x20Id\x20'+_0x251440+_0x355e34(0xed));return flosum_repository_sync_dto_1[_0x355e34(0xae)][_0x355e34(0xf1)](_0x5cdc37[0x0]);}async[a243_0x54bbe8(0xbc)](_0x368169){const _0x2709c4=a243_0x54bbe8,_0x219a79=await this[_0x2709c4(0xeb)][_0x2709c4(0xb2)](queries_1['GET_BRANCH_QUERY'][_0x2709c4(0xe4)](_0x2709c4(0xc7),_0x368169));if(_0x219a79['length']===0x0)throw new not_found_error_1[(_0x2709c4(0xf0))](_0x2709c4(0xb5)+_0x368169+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x2709c4(0xcc)](_0x219a79[0x0]);}async[a243_0x54bbe8(0xb8)](_0x4817b5){const _0xb39262=a243_0x54bbe8,_0x8d078b=await this['salesforceQuery'][_0xb39262(0xb2)](queries_1[_0xb39262(0xaf)][_0xb39262(0xe4)](_0xb39262(0xd5),_0x4817b5));if(_0x8d078b[_0xb39262(0xd3)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0xb39262(0xd8)+_0x4817b5+_0xb39262(0xed));const _0x2a9862=_0x8d078b[_0xb39262(0xab)](_0x41680f=>_0x41680f[constants_1[_0xb39262(0xd7)]+_0xb39262(0xb7)]===_0x4817b5);if(!_0x2a9862)throw new not_found_error_1[(_0xb39262(0xf0))](_0xb39262(0xd8)+_0x4817b5+_0xb39262(0xed));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0x2a9862);}async[a243_0x54bbe8(0xe6)](_0x4e13fc){const _0x1b4734=a243_0x54bbe8,_0x146804=await this[_0x1b4734(0xeb)][_0x1b4734(0xb2)](queries_1['GET_REPOSITORY_BY_NAME_QUERY']['replace'](_0x1b4734(0xd5),_0x4e13fc));if(_0x146804[_0x1b4734(0xd3)]===0x0)throw new not_found_error_1[(_0x1b4734(0xf0))](_0x1b4734(0xc9)+_0x4e13fc+_0x1b4734(0xed));return flosum_repository_sync_dto_1[_0x1b4734(0xae)][_0x1b4734(0xf1)](_0x146804[0x0]);}async[a243_0x54bbe8(0xb9)](_0x29a553){const _0x515274=a243_0x54bbe8,_0x2da7b1='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x515274(0xe3)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x29a553+'\x27';return this[_0x515274(0xac)](_0x2da7b1);}async[a243_0x54bbe8(0xda)](_0x2e56eb){const _0x522706=a243_0x54bbe8,_0x346596=_0x522706(0xa9)+queries_1['GET_COMPONENTS_QUERY']+_0x522706(0xd6)+_0x2e56eb+'\x27';return this[_0x522706(0xac)](_0x346596);}async['getAttachmentId'](_0x33c9a1){const _0x335c14=a243_0x54bbe8;var _0x33631a;const _0xe6b876=queries_1[_0x335c14(0xbf)]['replace']('%parentId%',_0x33c9a1[_0x335c14(0xef)])[_0x335c14(0xe4)](_0x335c14(0xd5),_0x33c9a1[_0x335c14(0xc1)]?constants_1[_0x335c14(0xde)]:constants_1[_0x335c14(0xdb)]),_0x4b7395=await this[_0x335c14(0xeb)]['query'](_0xe6b876),_0x1f33dd=(_0x33631a=_0x4b7395[0x0])===null||_0x33631a===void 0x0?void 0x0:_0x33631a['Id'];if(!_0x1f33dd)throw new Error(errors_1[_0x335c14(0xf2)]);return _0x1f33dd;}async['getRemoteStateAttachmentId'](_0x46fd85){const _0x3f93b9=a243_0x54bbe8;let _0x537c2b=await this[_0x3f93b9(0xbb)](_0x46fd85)[_0x3f93b9(0xe5)](()=>null);return!_0x537c2b&&(_0x537c2b=await this[_0x3f93b9(0xfb)][_0x3f93b9(0xc4)](_0x3f93b9(0xf5),{'Body':(0x0,utils_1[_0x3f93b9(0xb4)])('{}'),'ParentId':_0x46fd85[_0x3f93b9(0xef)],'ContentType':_0x3f93b9(0xbd),'Name':_0x46fd85[_0x3f93b9(0xc1)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x3f93b9(0xdb)]})),_0x537c2b;}async[a243_0x54bbe8(0xf8)](_0x3d0718,_0x27ad67){const _0x9308f8=a243_0x54bbe8,_0x113875=await this[_0x9308f8(0xcb)](_0x3d0718);await this[_0x9308f8(0xfb)][_0x9308f8(0xaa)]('Attachment',_0x113875,{'Body':(0x0,utils_1[_0x9308f8(0xb4)])(JSON['stringify'](_0x27ad67))});}async['setStatus'](_0x247ddc,_0x184116){const _0x1f6abb=a243_0x54bbe8;await this[_0x1f6abb(0xfb)][_0x1f6abb(0xaa)](_0x247ddc['objectType'],_0x247ddc[_0x1f6abb(0xef)],{[constants_1[_0x1f6abb(0xa8)]+_0x1f6abb(0xb3)]:_0x184116});}async[a243_0x54bbe8(0xea)](_0x48b0e){const _0x35a4f7=a243_0x54bbe8;await this[_0x35a4f7(0xfb)][_0x35a4f7(0xaa)](constants_1[_0x35a4f7(0xa8)]+'Connection__c',_0x48b0e,{[constants_1[_0x35a4f7(0xa8)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a243_0x54bbe8(0xe9)])(),__metadata(a243_0x54bbe8(0xc8),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a243_0x54bbe8(0xe7)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;