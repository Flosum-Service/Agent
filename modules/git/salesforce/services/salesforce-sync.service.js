const a243_0x4e2820=a243_0x9ff1;(function(_0xfd1ef1,_0x1b70a2){const _0x2fa5ce=a243_0x9ff1,_0x1405ea=_0xfd1ef1();while(!![]){try{const _0x4daf7e=-parseInt(_0x2fa5ce(0x111))/0x1*(-parseInt(_0x2fa5ce(0x109))/0x2)+parseInt(_0x2fa5ce(0x144))/0x3+parseInt(_0x2fa5ce(0x130))/0x4+-parseInt(_0x2fa5ce(0x139))/0x5+parseInt(_0x2fa5ce(0xfc))/0x6+parseInt(_0x2fa5ce(0x10a))/0x7+-parseInt(_0x2fa5ce(0xf7))/0x8;if(_0x4daf7e===_0x1b70a2)break;else _0x1405ea['push'](_0x1405ea['shift']());}catch(_0x80c47c){_0x1405ea['push'](_0x1405ea['shift']());}}}(a243_0x30c0,0x98404));const a243_0x277bd6=(function(){let _0xad7a1b=!![];return function(_0x1f4676,_0x5f2c9a){const _0x64db41=_0xad7a1b?function(){const _0x7c4fa=a243_0x9ff1;if(_0x5f2c9a){const _0x2806ae=_0x5f2c9a[_0x7c4fa(0x12c)](_0x1f4676,arguments);return _0x5f2c9a=null,_0x2806ae;}}:function(){};return _0xad7a1b=![],_0x64db41;};}()),a243_0x589838=a243_0x277bd6(this,function(){const _0x42adaa=a243_0x9ff1;return a243_0x589838[_0x42adaa(0x113)]()[_0x42adaa(0x118)]('(((.+)+)+)+$')[_0x42adaa(0x113)]()[_0x42adaa(0x106)](a243_0x589838)[_0x42adaa(0x118)]('(((.+)+)+)+$');});function a243_0x9ff1(_0x3f7fe7,_0x3e3526){const _0x56bbd0=a243_0x30c0();return a243_0x9ff1=function(_0x589838,_0x277bd6){_0x589838=_0x589838-0xe9;let _0x30c0b0=_0x56bbd0[_0x589838];return _0x30c0b0;},a243_0x9ff1(_0x3f7fe7,_0x3e3526);}a243_0x589838();'use strict';var __decorate=this&&this[a243_0x4e2820(0x101)]||function(_0x1a44da,_0x13cd6a,_0xc8c7fd,_0x287a4f){const _0x433a53=a243_0x4e2820;var _0x48d932=arguments[_0x433a53(0x13a)],_0x2205d9=_0x48d932<0x3?_0x13cd6a:_0x287a4f===null?_0x287a4f=Object[_0x433a53(0xf6)](_0x13cd6a,_0xc8c7fd):_0x287a4f,_0x46225d;if(typeof Reflect===_0x433a53(0xf3)&&typeof Reflect[_0x433a53(0xf8)]===_0x433a53(0x103))_0x2205d9=Reflect[_0x433a53(0xf8)](_0x1a44da,_0x13cd6a,_0xc8c7fd,_0x287a4f);else{for(var _0x4dd7df=_0x1a44da[_0x433a53(0x13a)]-0x1;_0x4dd7df>=0x0;_0x4dd7df--)if(_0x46225d=_0x1a44da[_0x4dd7df])_0x2205d9=(_0x48d932<0x3?_0x46225d(_0x2205d9):_0x48d932>0x3?_0x46225d(_0x13cd6a,_0xc8c7fd,_0x2205d9):_0x46225d(_0x13cd6a,_0xc8c7fd))||_0x2205d9;}return _0x48d932>0x3&&_0x2205d9&&Object['defineProperty'](_0x13cd6a,_0xc8c7fd,_0x2205d9),_0x2205d9;},__metadata=this&&this[a243_0x4e2820(0x133)]||function(_0x3a4d21,_0x391aa0){const _0x2664af=a243_0x4e2820;if(typeof Reflect===_0x2664af(0xf3)&&typeof Reflect[_0x2664af(0xee)]===_0x2664af(0x103))return Reflect[_0x2664af(0xee)](_0x3a4d21,_0x391aa0);};function a243_0x30c0(){const _0x216567=['toString','FlosumRepositorySyncDto','objectId','text/plain','SYNC_ATTACHMENT_FOR_BRANCH_NAME','search','patchObject','FLOSUM_GIT_NAMESPACE','typedi','Attachment','__esModule','\x0a\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','setStatus','GET_WAITING_REPOSITORIES_QUERY','GET_WAITING_BRANCHES_QUERY','./salesforce.service','repositoryId','find','SalesforceNotFoundError','../dto/flosum-repository-sync.dto','fromRepositoryRecord','FLOSUM_NAMESPACE','encodeBase64','SalesforceQueryService','apply','GET_REPOSITORY_QUERY','Branch_Name__c','Service','983672BUGJGZ','push','getBranchComponents','__metadata','disableSync','Repository\x20with\x20Id\x20','getRepositoryRecordByName','Repository__r','replace','3944995ZOyYeC','length','getBranchRecord','%parentId%','salesforceService','map','getComponentsFromRepository','getAttachmentId','GET_BRANCH_QUERY','defineProperty','%id%','2853321bFDrAR','./salesforce-query.service','design:paramtypes','catch','getAllRepositoryNames','../errors/not-found.error','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','stringify','../../../../constants/errors','metadata','query','GET_BRANCH_BY_NAME_QUERY','Repository\x20','Name','object','getBranchRecords','\x20not\x20found\x20on\x20salesforce','getOwnPropertyDescriptor','4462464eyGtOh','decorate','getRepositoryRecords','getComponents','SalesforceService','1291272TdWvFQ','objectType','getRemoteStateAttachmentId','GET_COMPONENTS_QUERY','Synchronization_Status__c','__decorate','ERR_INVALID_ATTACHMENT_ID','function','../queries','updateRemoteState','constructor','Branch\x20','Components__r','69872bHcElr','2929122miDWfy','%name%','fromBranchRecord','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','../../../../constants','records','SalesforceSyncService','4bWKvEd','salesforceQuery'];a243_0x30c0=function(){return _0x216567;};return a243_0x30c0();}Object[a243_0x4e2820(0x142)](exports,a243_0x4e2820(0x11d),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require(a243_0x4e2820(0x11b)),constants_1=require(a243_0x4e2820(0x10e)),errors_1=require(a243_0x4e2820(0xed)),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a243_0x4e2820(0x127)),not_found_error_1=require(a243_0x4e2820(0xea)),queries_1=require(a243_0x4e2820(0x104)),salesforce_query_service_1=require(a243_0x4e2820(0x145)),salesforce_service_1=require(a243_0x4e2820(0x123));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x459ac2,_0x57d1cb){const _0x1b87bc=a243_0x4e2820;this[_0x1b87bc(0x112)]=_0x459ac2,this['salesforceService']=_0x57d1cb;}async[a243_0x4e2820(0xfa)](_0x3f36a3){const _0x38ed74=a243_0x4e2820;var _0x1f3a70;const _0x22df9c=await this['salesforceQuery'][_0x38ed74(0xef)](_0x3f36a3),_0x107df6=[];for(const _0x132264 of _0x22df9c){const _0xbb4f16=(_0x1f3a70=_0x132264[constants_1[_0x38ed74(0x129)]+_0x38ed74(0x108)])===null||_0x1f3a70===void 0x0?void 0x0:_0x1f3a70[_0x38ed74(0x10f)];_0xbb4f16&&_0xbb4f16['length']&&_0x107df6[_0x38ed74(0x131)](_0xbb4f16[0x0]['Id']);}return _0x107df6;}async[a243_0x4e2820(0xe9)](_0x5a0180){const _0x494e78=a243_0x4e2820,_0x3ed071=await this['salesforceQuery'][_0x494e78(0xef)](queries_1['GET_REPOSITORIES_NAMES_QUERY'][_0x494e78(0x138)](/\%connection_id\%/g,_0x5a0180));return _0x3ed071[_0x494e78(0x13e)](_0x158cac=>{const _0x385e67=_0x494e78;return _0x158cac[constants_1[_0x385e67(0x11a)]+'Repository__r']?_0x158cac[constants_1[_0x385e67(0x11a)]+_0x385e67(0x137)][_0x385e67(0xf2)]:_0x158cac[_0x385e67(0xf2)];});}async[a243_0x4e2820(0xf9)](_0x3c131d){const _0x43febc=a243_0x4e2820,_0x328b3a=await this['salesforceQuery'][_0x43febc(0xef)](queries_1[_0x43febc(0x121)]['replace'](/\%connection_id\%/g,_0x3c131d));return _0x328b3a[_0x43febc(0x13e)](_0x5efec9=>flosum_repository_sync_dto_1[_0x43febc(0x114)]['fromRepositoryRecord'](_0x5efec9));}async[a243_0x4e2820(0xf4)](_0x55ed06){const _0xae8d31=a243_0x4e2820,_0x3d63c0=await this[_0xae8d31(0x112)][_0xae8d31(0xef)](queries_1[_0xae8d31(0x122)][_0xae8d31(0x138)](/%repositories_ids\%/g,_0x55ed06));return _0x3d63c0[_0xae8d31(0x13e)](_0x45fcb7=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0xae8d31(0x10c)](_0x45fcb7));}async['getRepositoryRecord'](_0x2b070c){const _0xcbad9c=a243_0x4e2820,_0x338208=await this[_0xcbad9c(0x112)][_0xcbad9c(0xef)](queries_1[_0xcbad9c(0x12d)][_0xcbad9c(0x138)](_0xcbad9c(0x143),_0x2b070c));if(_0x338208[_0xcbad9c(0x13a)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0xcbad9c(0x135)+_0x2b070c+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0xcbad9c(0x114)][_0xcbad9c(0x128)](_0x338208[0x0]);}async[a243_0x4e2820(0x13b)](_0x105ee9){const _0x30c890=a243_0x4e2820,_0x478fb0=await this[_0x30c890(0x112)][_0x30c890(0xef)](queries_1[_0x30c890(0x141)][_0x30c890(0x138)]('%id%',_0x105ee9));if(_0x478fb0[_0x30c890(0x13a)]===0x0)throw new not_found_error_1[(_0x30c890(0x126))]('Branch\x20with\x20Id\x20'+_0x105ee9+_0x30c890(0xf5));return flosum_repository_sync_dto_1[_0x30c890(0x114)][_0x30c890(0x10c)](_0x478fb0[0x0]);}async['getBranchRecordByName'](_0x461cfc){const _0x4ba17b=a243_0x4e2820,_0x33caec=await this[_0x4ba17b(0x112)][_0x4ba17b(0xef)](queries_1[_0x4ba17b(0xf0)][_0x4ba17b(0x138)](_0x4ba17b(0x10b),_0x461cfc));if(_0x33caec[_0x4ba17b(0x13a)]===0x0)throw new not_found_error_1[(_0x4ba17b(0x126))](_0x4ba17b(0x107)+_0x461cfc+_0x4ba17b(0xf5));const _0x2c3b35=_0x33caec[_0x4ba17b(0x125)](_0x74f42b=>_0x74f42b[constants_1[_0x4ba17b(0x129)]+_0x4ba17b(0x12e)]===_0x461cfc);if(!_0x2c3b35)throw new not_found_error_1[(_0x4ba17b(0x126))](_0x4ba17b(0x107)+_0x461cfc+_0x4ba17b(0xf5));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x4ba17b(0x10c)](_0x2c3b35);}async[a243_0x4e2820(0x136)](_0x276845){const _0x105c95=a243_0x4e2820,_0x448c20=await this[_0x105c95(0x112)][_0x105c95(0xef)](queries_1['GET_REPOSITORY_BY_NAME_QUERY']['replace']('%name%',_0x276845));if(_0x448c20[_0x105c95(0x13a)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x105c95(0xf1)+_0x276845+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x105c95(0x114)][_0x105c95(0x128)](_0x448c20[0x0]);}async[a243_0x4e2820(0x13f)](_0x353a0f){const _0x569d9f=a243_0x4e2820,_0x5bdfdc=_0x569d9f(0x11e)+queries_1['GET_COMPONENTS_QUERY']+_0x569d9f(0x11f)+_0x353a0f+'\x27';return this[_0x569d9f(0xfa)](_0x5bdfdc);}async[a243_0x4e2820(0x132)](_0x382f20){const _0x16310b=a243_0x4e2820,_0x18e988=_0x16310b(0xeb)+queries_1[_0x16310b(0xff)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x382f20+'\x27';return this[_0x16310b(0xfa)](_0x18e988);}async[a243_0x4e2820(0x140)](_0x3d7466){const _0x52df4a=a243_0x4e2820;var _0x612ddb;const _0x2cbf12=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x52df4a(0x138)](_0x52df4a(0x13c),_0x3d7466[_0x52df4a(0x115)])['replace'](_0x52df4a(0x10b),_0x3d7466['repositoryId']?constants_1[_0x52df4a(0x10d)]:constants_1[_0x52df4a(0x117)]),_0xa7fadb=await this[_0x52df4a(0x112)][_0x52df4a(0xef)](_0x2cbf12),_0x21ee6f=(_0x612ddb=_0xa7fadb[0x0])===null||_0x612ddb===void 0x0?void 0x0:_0x612ddb['Id'];if(!_0x21ee6f)throw new Error(errors_1[_0x52df4a(0x102)]);return _0x21ee6f;}async[a243_0x4e2820(0xfe)](_0x52021a){const _0x2beb0d=a243_0x4e2820;let _0x139b9a=await this[_0x2beb0d(0x140)](_0x52021a)[_0x2beb0d(0x147)](()=>null);return!_0x139b9a&&(_0x139b9a=await this[_0x2beb0d(0x13d)]['createObject'](_0x2beb0d(0x11c),{'Body':(0x0,utils_1[_0x2beb0d(0x12a)])('{}'),'ParentId':_0x52021a[_0x2beb0d(0x115)],'ContentType':_0x2beb0d(0x116),'Name':_0x52021a[_0x2beb0d(0x124)]?constants_1[_0x2beb0d(0x10d)]:constants_1[_0x2beb0d(0x117)]})),_0x139b9a;}async[a243_0x4e2820(0x105)](_0x48763a,_0x13a2a7){const _0x521f48=a243_0x4e2820,_0x4ef2d0=await this[_0x521f48(0xfe)](_0x48763a);await this['salesforceService'][_0x521f48(0x119)]('Attachment',_0x4ef2d0,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0x521f48(0xec)](_0x13a2a7))});}async[a243_0x4e2820(0x120)](_0x498c01,_0x3c3081){const _0x142075=a243_0x4e2820;await this[_0x142075(0x13d)][_0x142075(0x119)](_0x498c01[_0x142075(0xfd)],_0x498c01[_0x142075(0x115)],{[constants_1[_0x142075(0x11a)]+_0x142075(0x100)]:_0x3c3081});}async[a243_0x4e2820(0x134)](_0x2ae169){const _0x4b77f7=a243_0x4e2820;await this['salesforceService'][_0x4b77f7(0x119)](constants_1[_0x4b77f7(0x11a)]+'Connection__c',_0x2ae169,{[constants_1[_0x4b77f7(0x11a)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a243_0x4e2820(0x12f)])(),__metadata(a243_0x4e2820(0x146),[salesforce_query_service_1[a243_0x4e2820(0x12b)],salesforce_service_1[a243_0x4e2820(0xfb)]])],SalesforceSyncService),exports[a243_0x4e2820(0x110)]=SalesforceSyncService;