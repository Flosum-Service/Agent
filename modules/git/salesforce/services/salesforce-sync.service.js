const a243_0x383547=a243_0x2e23;function a243_0x2e23(_0x11b08d,_0x4c8271){const _0x21791f=a243_0x5ea1();return a243_0x2e23=function(_0x24abee,_0x29cecb){_0x24abee=_0x24abee-0x124;let _0x5ea168=_0x21791f[_0x24abee];return _0x5ea168;},a243_0x2e23(_0x11b08d,_0x4c8271);}(function(_0x5813fe,_0xd35700){const _0x3baac1=a243_0x2e23,_0x4d7bd0=_0x5813fe();while(!![]){try{const _0x3501d4=-parseInt(_0x3baac1(0x130))/0x1*(-parseInt(_0x3baac1(0x149))/0x2)+parseInt(_0x3baac1(0x162))/0x3+-parseInt(_0x3baac1(0x17b))/0x4*(-parseInt(_0x3baac1(0x16e))/0x5)+parseInt(_0x3baac1(0x164))/0x6+-parseInt(_0x3baac1(0x17e))/0x7*(-parseInt(_0x3baac1(0x154))/0x8)+parseInt(_0x3baac1(0x163))/0x9+-parseInt(_0x3baac1(0x16b))/0xa;if(_0x3501d4===_0xd35700)break;else _0x4d7bd0['push'](_0x4d7bd0['shift']());}catch(_0x158df7){_0x4d7bd0['push'](_0x4d7bd0['shift']());}}}(a243_0x5ea1,0x6d909));const a243_0x29cecb=(function(){let _0x4ecf7b=!![];return function(_0x3f8f19,_0x303d90){const _0xcddb54=_0x4ecf7b?function(){const _0x33a718=a243_0x2e23;if(_0x303d90){const _0x48e1c6=_0x303d90[_0x33a718(0x144)](_0x3f8f19,arguments);return _0x303d90=null,_0x48e1c6;}}:function(){};return _0x4ecf7b=![],_0xcddb54;};}()),a243_0x24abee=a243_0x29cecb(this,function(){const _0x35d10a=a243_0x2e23;return a243_0x24abee['toString']()['search']('(((.+)+)+)+$')[_0x35d10a(0x12e)]()['constructor'](a243_0x24abee)[_0x35d10a(0x172)](_0x35d10a(0x150));});function a243_0x5ea1(){const _0xf8950d=['./salesforce-query.service','getRepositoryRecords','toString','salesforceService','2HlQgKF','function','stringify','getOwnPropertyDescriptor','%parentId%','objectId','query','../../../shared/utils','SalesforceService','disableSync','../../../../constants/errors','design:paramtypes','catch','getAllRepositoryNames','SYNC_ATTACHMENT_FOR_BRANCH_NAME','getRepositoryRecord','objectType','GET_WAITING_REPOSITORIES_QUERY','fromBranchRecord','Repository__r','apply','Synchronization_Status__c','getAttachmentId','\x20not\x20found\x20on\x20salesforce','getComponents','268122QzvlSa','Service','push','records','FLOSUM_NAMESPACE','Name','getBranchRecords','(((.+)+)+)+$','getBranchRecordByName','Repository\x20with\x20Id\x20','encodeBase64','8UTmDfr','getRemoteStateAttachmentId','Connection__c','Branch\x20','updateRemoteState','repositoryId','text/plain','%id%','find','SalesforceSyncService','SalesforceNotFoundError','GET_REPOSITORIES_NAMES_QUERY','GET_REPOSITORY_BY_NAME_QUERY','fromRepositoryRecord','473664vgFziE','3936699zvKKDb','2236554hmvNFq','./salesforce.service','salesforceQuery','FLOSUM_GIT_NAMESPACE','__esModule','metadata','createObject','20129740wyuREz','length','Components__r','2939555ujJAxw','replace','typedi','Attachment','search','getComponentsFromRepository','%name%','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','decorate','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','../dto/flosum-repository-sync.dto','__metadata','GET_REPOSITORY_QUERY','4RinvHA','GET_COMPONENTS_QUERY','map','4463620TdYNIN','ERR_INVALID_ATTACHMENT_ID','FlosumRepositorySyncDto','GET_BRANCH_QUERY','\x0a\x20\x20\x20\x20\x20\x20','patchObject','object','../errors/not-found.error','GET_BRANCH_BY_NAME_QUERY'];a243_0x5ea1=function(){return _0xf8950d;};return a243_0x5ea1();}a243_0x24abee();'use strict';var __decorate=this&&this['__decorate']||function(_0x3ac840,_0x5a6204,_0x43fd57,_0x5d1d47){const _0x10ac59=a243_0x2e23;var _0x457579=arguments[_0x10ac59(0x16c)],_0x21b287=_0x457579<0x3?_0x5a6204:_0x5d1d47===null?_0x5d1d47=Object[_0x10ac59(0x133)](_0x5a6204,_0x43fd57):_0x5d1d47,_0x3aa9c3;if(typeof Reflect===_0x10ac59(0x129)&&typeof Reflect[_0x10ac59(0x176)]===_0x10ac59(0x131))_0x21b287=Reflect[_0x10ac59(0x176)](_0x3ac840,_0x5a6204,_0x43fd57,_0x5d1d47);else{for(var _0xbe6a7e=_0x3ac840['length']-0x1;_0xbe6a7e>=0x0;_0xbe6a7e--)if(_0x3aa9c3=_0x3ac840[_0xbe6a7e])_0x21b287=(_0x457579<0x3?_0x3aa9c3(_0x21b287):_0x457579>0x3?_0x3aa9c3(_0x5a6204,_0x43fd57,_0x21b287):_0x3aa9c3(_0x5a6204,_0x43fd57))||_0x21b287;}return _0x457579>0x3&&_0x21b287&&Object['defineProperty'](_0x5a6204,_0x43fd57,_0x21b287),_0x21b287;},__metadata=this&&this[a243_0x383547(0x179)]||function(_0x3001b5,_0x4c58ea){const _0x3b64ba=a243_0x383547;if(typeof Reflect===_0x3b64ba(0x129)&&typeof Reflect['metadata']==='function')return Reflect[_0x3b64ba(0x169)](_0x3001b5,_0x4c58ea);};Object['defineProperty'](exports,a243_0x383547(0x168),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require(a243_0x383547(0x170)),constants_1=require('../../../../constants'),errors_1=require(a243_0x383547(0x13a)),utils_1=require(a243_0x383547(0x137)),flosum_repository_sync_dto_1=require(a243_0x383547(0x178)),not_found_error_1=require(a243_0x383547(0x12a)),queries_1=require('../queries'),salesforce_query_service_1=require(a243_0x383547(0x12c)),salesforce_service_1=require(a243_0x383547(0x165));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x335103,_0x10029f){const _0x2d2304=a243_0x383547;this[_0x2d2304(0x166)]=_0x335103,this[_0x2d2304(0x12f)]=_0x10029f;}async[a243_0x383547(0x148)](_0x189fcb){const _0x248738=a243_0x383547;var _0x32b0b5;const _0x305108=await this[_0x248738(0x166)]['query'](_0x189fcb),_0x192c17=[];for(const _0x31d5a8 of _0x305108){const _0x32e440=(_0x32b0b5=_0x31d5a8[constants_1[_0x248738(0x14d)]+_0x248738(0x16d)])===null||_0x32b0b5===void 0x0?void 0x0:_0x32b0b5[_0x248738(0x14c)];_0x32e440&&_0x32e440[_0x248738(0x16c)]&&_0x192c17[_0x248738(0x14b)](_0x32e440[0x0]['Id']);}return _0x192c17;}async[a243_0x383547(0x13d)](_0x2fbf85){const _0x1c92ae=a243_0x383547,_0x598fd0=await this['salesforceQuery'][_0x1c92ae(0x136)](queries_1[_0x1c92ae(0x15f)]['replace'](/\%connection_id\%/g,_0x2fbf85));return _0x598fd0['map'](_0x57c51c=>{const _0x40b12c=_0x1c92ae;return _0x57c51c[constants_1[_0x40b12c(0x167)]+'Repository__r']?_0x57c51c[constants_1[_0x40b12c(0x167)]+_0x40b12c(0x143)]['Name']:_0x57c51c[_0x40b12c(0x14e)];});}async[a243_0x383547(0x12d)](_0x19fdeb){const _0x16d06b=a243_0x383547,_0x1f9631=await this[_0x16d06b(0x166)][_0x16d06b(0x136)](queries_1[_0x16d06b(0x141)]['replace'](/\%connection_id\%/g,_0x19fdeb));return _0x1f9631[_0x16d06b(0x17d)](_0x4dee2e=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x4dee2e));}async[a243_0x383547(0x14f)](_0x42dc2e){const _0x160176=a243_0x383547,_0x4bdca8=await this[_0x160176(0x166)]['query'](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x160176(0x16f)](/%repositories_ids\%/g,_0x42dc2e));return _0x4bdca8[_0x160176(0x17d)](_0x8745cc=>flosum_repository_sync_dto_1[_0x160176(0x125)][_0x160176(0x142)](_0x8745cc));}async[a243_0x383547(0x13f)](_0x2c2237){const _0x4ae8a0=a243_0x383547,_0x2ecb2e=await this[_0x4ae8a0(0x166)][_0x4ae8a0(0x136)](queries_1[_0x4ae8a0(0x17a)][_0x4ae8a0(0x16f)](_0x4ae8a0(0x15b),_0x2c2237));if(_0x2ecb2e['length']===0x0)throw new not_found_error_1[(_0x4ae8a0(0x15e))](_0x4ae8a0(0x152)+_0x2c2237+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x4ae8a0(0x125)][_0x4ae8a0(0x161)](_0x2ecb2e[0x0]);}async['getBranchRecord'](_0x5853b7){const _0x511e87=a243_0x383547,_0x39c4d1=await this[_0x511e87(0x166)][_0x511e87(0x136)](queries_1[_0x511e87(0x126)]['replace'](_0x511e87(0x15b),_0x5853b7));if(_0x39c4d1[_0x511e87(0x16c)]===0x0)throw new not_found_error_1[(_0x511e87(0x15e))]('Branch\x20with\x20Id\x20'+_0x5853b7+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x511e87(0x142)](_0x39c4d1[0x0]);}async[a243_0x383547(0x151)](_0x2be2d5){const _0x658734=a243_0x383547,_0x43aaa2=await this['salesforceQuery']['query'](queries_1[_0x658734(0x12b)][_0x658734(0x16f)](_0x658734(0x174),_0x2be2d5));if(_0x43aaa2[_0x658734(0x16c)]===0x0)throw new not_found_error_1[(_0x658734(0x15e))](_0x658734(0x157)+_0x2be2d5+'\x20not\x20found\x20on\x20salesforce');const _0x50108f=_0x43aaa2[_0x658734(0x15c)](_0x50e8b0=>_0x50e8b0[constants_1['FLOSUM_NAMESPACE']+'Branch_Name__c']===_0x2be2d5);if(!_0x50108f)throw new not_found_error_1[(_0x658734(0x15e))](_0x658734(0x157)+_0x2be2d5+_0x658734(0x147));return flosum_repository_sync_dto_1[_0x658734(0x125)]['fromBranchRecord'](_0x50108f);}async['getRepositoryRecordByName'](_0x490a79){const _0x24b448=a243_0x383547,_0x24c2fd=await this[_0x24b448(0x166)][_0x24b448(0x136)](queries_1[_0x24b448(0x160)][_0x24b448(0x16f)](_0x24b448(0x174),_0x490a79));if(_0x24c2fd[_0x24b448(0x16c)]===0x0)throw new not_found_error_1[(_0x24b448(0x15e))]('Repository\x20'+_0x490a79+_0x24b448(0x147));return flosum_repository_sync_dto_1[_0x24b448(0x125)]['fromRepositoryRecord'](_0x24c2fd[0x0]);}async[a243_0x383547(0x173)](_0x1d7fab){const _0x2ef6e1=a243_0x383547,_0x3c9b96=_0x2ef6e1(0x127)+queries_1[_0x2ef6e1(0x17c)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x1d7fab+'\x27';return this[_0x2ef6e1(0x148)](_0x3c9b96);}async['getBranchComponents'](_0x1a0220){const _0x218f34=a243_0x383547,_0x379566='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x218f34(0x17c)]+_0x218f34(0x177)+_0x1a0220+'\x27';return this[_0x218f34(0x148)](_0x379566);}async['getAttachmentId'](_0x35c37f){const _0x1a9caf=a243_0x383547;var _0x2d73f5;const _0x4cf66d=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x1a9caf(0x16f)](_0x1a9caf(0x134),_0x35c37f[_0x1a9caf(0x135)])[_0x1a9caf(0x16f)](_0x1a9caf(0x174),_0x35c37f[_0x1a9caf(0x159)]?constants_1[_0x1a9caf(0x175)]:constants_1[_0x1a9caf(0x13e)]),_0x4a623e=await this[_0x1a9caf(0x166)][_0x1a9caf(0x136)](_0x4cf66d),_0x2d0e19=(_0x2d73f5=_0x4a623e[0x0])===null||_0x2d73f5===void 0x0?void 0x0:_0x2d73f5['Id'];if(!_0x2d0e19)throw new Error(errors_1[_0x1a9caf(0x124)]);return _0x2d0e19;}async[a243_0x383547(0x155)](_0x1d3e86){const _0x343e3c=a243_0x383547;let _0x15e641=await this[_0x343e3c(0x146)](_0x1d3e86)[_0x343e3c(0x13c)](()=>null);return!_0x15e641&&(_0x15e641=await this[_0x343e3c(0x12f)][_0x343e3c(0x16a)](_0x343e3c(0x171),{'Body':(0x0,utils_1[_0x343e3c(0x153)])('{}'),'ParentId':_0x1d3e86['objectId'],'ContentType':_0x343e3c(0x15a),'Name':_0x1d3e86[_0x343e3c(0x159)]?constants_1[_0x343e3c(0x175)]:constants_1[_0x343e3c(0x13e)]})),_0x15e641;}async[a243_0x383547(0x158)](_0x2bb9f0,_0x806d24){const _0x1daad7=a243_0x383547,_0x5e84c7=await this['getRemoteStateAttachmentId'](_0x2bb9f0);await this[_0x1daad7(0x12f)][_0x1daad7(0x128)](_0x1daad7(0x171),_0x5e84c7,{'Body':(0x0,utils_1[_0x1daad7(0x153)])(JSON[_0x1daad7(0x132)](_0x806d24))});}async['setStatus'](_0x2b7c18,_0x3d9f55){const _0x26fbdd=a243_0x383547;await this[_0x26fbdd(0x12f)][_0x26fbdd(0x128)](_0x2b7c18[_0x26fbdd(0x140)],_0x2b7c18['objectId'],{[constants_1[_0x26fbdd(0x167)]+_0x26fbdd(0x145)]:_0x3d9f55});}async[a243_0x383547(0x139)](_0x437230){const _0x20fa61=a243_0x383547;await this[_0x20fa61(0x12f)][_0x20fa61(0x128)](constants_1[_0x20fa61(0x167)]+_0x20fa61(0x156),_0x437230,{[constants_1[_0x20fa61(0x167)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a243_0x383547(0x14a)])(),__metadata(a243_0x383547(0x13b),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a243_0x383547(0x138)]])],SalesforceSyncService),exports[a243_0x383547(0x15d)]=SalesforceSyncService;