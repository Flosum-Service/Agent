const a253_0x428164=a253_0x3664;function a253_0x4628(){const _0x44dc4e=['2FEjYfT','replace','SalesforceSyncService','search','314504tpKLcC','getRemoteStateAttachmentId','createObject','getBranchRecordByName','\x20not\x20found\x20on\x20salesforce','metadata','setStatus','./salesforce-query.service','encodeBase64','1066387WlfITq','__metadata','getRepositoryRecordByName','6543GnLnGq','GET_BRANCH_BY_NAME_QUERY','SalesforceService','Repository\x20','Repository\x20with\x20Id\x20','ERR_INVALID_ATTACHMENT_ID','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','function','Synchronization_Status__c','repositoryId','Branch\x20','\x0a\x20\x20\x20\x20\x20\x20','salesforceService','Service','../queries','../dto/flosum-repository-sync.dto','apply','patchObject','GET_WAITING_BRANCHES_QUERY','stringify','GET_REPOSITORY_BY_NAME_QUERY','13376090YOfdaJ','2439471qzkiZN','../errors/not-found.error','push','FLOSUM_GIT_NAMESPACE','getComponentsFromRepository','getBranchComponents','getRepositoryRecord','../../../../constants/errors','find','GET_COMPONENTS_QUERY','6627446ZeVsQJ','getAttachmentId','Name','typedi','map','text/plain','getRepositoryRecords','length','(((.+)+)+)+$','defineProperty','object','__esModule','objectType','GET_WAITING_REPOSITORIES_QUERY','fromRepositoryRecord','records','SalesforceNotFoundError','FlosumRepositorySyncDto','%id%','%parentId%','getOwnPropertyDescriptor','Repository__r','Components__r','decorate','salesforceQuery','FLOSUM_NAMESPACE','GET_REPOSITORIES_NAMES_QUERY','SYNC_ATTACHMENT_FOR_BRANCH_NAME','objectId','../../../shared/utils','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','fromBranchRecord','Sync_In_Progress__c','design:paramtypes','Branch_Name__c','5624tPCSOW','getBranchRecords','disableSync','catch','37326EIBZHY','getAllRepositoryNames','GET_BRANCH_QUERY','query','%name%','70rtokaS','getBranchRecord','./salesforce.service','getComponents'];a253_0x4628=function(){return _0x44dc4e;};return a253_0x4628();}(function(_0x3634d1,_0x30e119){const _0x3ae989=a253_0x3664,_0x321bcf=_0x3634d1();while(!![]){try{const _0x5c773a=parseInt(_0x3ae989(0x1a6))/0x1+parseInt(_0x3ae989(0x199))/0x2*(-parseInt(_0x3ae989(0x1bf))/0x3)+parseInt(_0x3ae989(0x19d))/0x4+-parseInt(_0x3ae989(0x195))/0x5*(-parseInt(_0x3ae989(0x190))/0x6)+parseInt(_0x3ae989(0x1c9))/0x7+parseInt(_0x3ae989(0x18c))/0x8*(parseInt(_0x3ae989(0x1a9))/0x9)+-parseInt(_0x3ae989(0x1be))/0xa;if(_0x5c773a===_0x30e119)break;else _0x321bcf['push'](_0x321bcf['shift']());}catch(_0x27327f){_0x321bcf['push'](_0x321bcf['shift']());}}}(a253_0x4628,0x83a40));const a253_0x5791a3=(function(){let _0x1ffebf=!![];return function(_0x194999,_0x51dcc5){const _0x2f7246=_0x1ffebf?function(){const _0x548967=a253_0x3664;if(_0x51dcc5){const _0x398f7d=_0x51dcc5[_0x548967(0x1b9)](_0x194999,arguments);return _0x51dcc5=null,_0x398f7d;}}:function(){};return _0x1ffebf=![],_0x2f7246;};}()),a253_0x9a1d2a=a253_0x5791a3(this,function(){const _0x428d5b=a253_0x3664;return a253_0x9a1d2a['toString']()[_0x428d5b(0x19c)](_0x428d5b(0x1d1))['toString']()['constructor'](a253_0x9a1d2a)[_0x428d5b(0x19c)](_0x428d5b(0x1d1));});a253_0x9a1d2a();'use strict';function a253_0x3664(_0x187f68,_0x46ea9e){const _0x5ef734=a253_0x4628();return a253_0x3664=function(_0x9a1d2a,_0x5791a3){_0x9a1d2a=_0x9a1d2a-0x176;let _0x4628f1=_0x5ef734[_0x9a1d2a];return _0x4628f1;},a253_0x3664(_0x187f68,_0x46ea9e);}var __decorate=this&&this['__decorate']||function(_0x26dba7,_0x333b8d,_0x3b8776,_0x5acfd5){const _0x537aad=a253_0x3664;var _0x1f9a6c=arguments[_0x537aad(0x1d0)],_0x452535=_0x1f9a6c<0x3?_0x333b8d:_0x5acfd5===null?_0x5acfd5=Object[_0x537aad(0x17d)](_0x333b8d,_0x3b8776):_0x5acfd5,_0x4f3443;if(typeof Reflect===_0x537aad(0x1d3)&&typeof Reflect[_0x537aad(0x180)]===_0x537aad(0x1b0))_0x452535=Reflect[_0x537aad(0x180)](_0x26dba7,_0x333b8d,_0x3b8776,_0x5acfd5);else{for(var _0x55c04a=_0x26dba7[_0x537aad(0x1d0)]-0x1;_0x55c04a>=0x0;_0x55c04a--)if(_0x4f3443=_0x26dba7[_0x55c04a])_0x452535=(_0x1f9a6c<0x3?_0x4f3443(_0x452535):_0x1f9a6c>0x3?_0x4f3443(_0x333b8d,_0x3b8776,_0x452535):_0x4f3443(_0x333b8d,_0x3b8776))||_0x452535;}return _0x1f9a6c>0x3&&_0x452535&&Object[_0x537aad(0x1d2)](_0x333b8d,_0x3b8776,_0x452535),_0x452535;},__metadata=this&&this[a253_0x428164(0x1a7)]||function(_0x3d1c55,_0x43f393){const _0x8729c6=a253_0x428164;if(typeof Reflect===_0x8729c6(0x1d3)&&typeof Reflect[_0x8729c6(0x1a2)]===_0x8729c6(0x1b0))return Reflect[_0x8729c6(0x1a2)](_0x3d1c55,_0x43f393);};Object[a253_0x428164(0x1d2)](exports,a253_0x428164(0x1d4),{'value':!![]}),exports[a253_0x428164(0x19b)]=void 0x0;const typedi_1=require(a253_0x428164(0x1cc)),constants_1=require('../../../../constants'),errors_1=require(a253_0x428164(0x1c6)),utils_1=require(a253_0x428164(0x186)),flosum_repository_sync_dto_1=require(a253_0x428164(0x1b8)),not_found_error_1=require(a253_0x428164(0x1c0)),queries_1=require(a253_0x428164(0x1b7)),salesforce_query_service_1=require(a253_0x428164(0x1a4)),salesforce_service_1=require(a253_0x428164(0x197));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x287a87,_0x2d88b3){const _0x160c48=a253_0x428164;this['salesforceQuery']=_0x287a87,this[_0x160c48(0x1b5)]=_0x2d88b3;}async[a253_0x428164(0x198)](_0x4c3be7){const _0xbb55ab=a253_0x428164;var _0x185860;const _0xd59d00=await this[_0xbb55ab(0x181)][_0xbb55ab(0x193)](_0x4c3be7),_0x27b4b8=[];for(const _0x1a7ddb of _0xd59d00){const _0x2438b8=(_0x185860=_0x1a7ddb[constants_1[_0xbb55ab(0x182)]+_0xbb55ab(0x17f)])===null||_0x185860===void 0x0?void 0x0:_0x185860[_0xbb55ab(0x178)];_0x2438b8&&_0x2438b8[_0xbb55ab(0x1d0)]&&_0x27b4b8[_0xbb55ab(0x1c1)](_0x2438b8[0x0]['Id']);}return _0x27b4b8;}async[a253_0x428164(0x191)](_0x56dbca){const _0x56fcce=a253_0x428164,_0x28d51c=await this[_0x56fcce(0x181)][_0x56fcce(0x193)](queries_1[_0x56fcce(0x183)][_0x56fcce(0x19a)](/\%connection_id\%/g,_0x56dbca));return _0x28d51c['map'](_0x256bda=>{const _0x307d8d=_0x56fcce;return _0x256bda[constants_1[_0x307d8d(0x1c2)]+'Repository__r']?_0x256bda[constants_1['FLOSUM_GIT_NAMESPACE']+_0x307d8d(0x17e)][_0x307d8d(0x1cb)]:_0x256bda[_0x307d8d(0x1cb)];});}async[a253_0x428164(0x1cf)](_0x2ffa25){const _0x55f9e4=a253_0x428164,_0x103e8d=await this[_0x55f9e4(0x181)][_0x55f9e4(0x193)](queries_1[_0x55f9e4(0x176)][_0x55f9e4(0x19a)](/\%connection_id\%/g,_0x2ffa25));return _0x103e8d['map'](_0x16c55e=>flosum_repository_sync_dto_1[_0x55f9e4(0x17a)][_0x55f9e4(0x177)](_0x16c55e));}async[a253_0x428164(0x18d)](_0x13652b){const _0x41ca16=a253_0x428164,_0x491933=await this[_0x41ca16(0x181)]['query'](queries_1[_0x41ca16(0x1bb)][_0x41ca16(0x19a)](/%repositories_ids\%/g,_0x13652b));return _0x491933[_0x41ca16(0x1cd)](_0x55f7bf=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0x55f7bf));}async[a253_0x428164(0x1c5)](_0x29043b){const _0x20aaef=a253_0x428164,_0xe7f52=await this[_0x20aaef(0x181)][_0x20aaef(0x193)](queries_1['GET_REPOSITORY_QUERY'][_0x20aaef(0x19a)](_0x20aaef(0x17b),_0x29043b));if(_0xe7f52['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x20aaef(0x1ad)+_0x29043b+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x20aaef(0x17a)][_0x20aaef(0x177)](_0xe7f52[0x0]);}async[a253_0x428164(0x196)](_0x4df9d8){const _0x45d9a2=a253_0x428164,_0x2ffd51=await this[_0x45d9a2(0x181)][_0x45d9a2(0x193)](queries_1[_0x45d9a2(0x192)]['replace']('%id%',_0x4df9d8));if(_0x2ffd51[_0x45d9a2(0x1d0)]===0x0)throw new not_found_error_1[(_0x45d9a2(0x179))]('Branch\x20with\x20Id\x20'+_0x4df9d8+_0x45d9a2(0x1a1));return flosum_repository_sync_dto_1[_0x45d9a2(0x17a)]['fromBranchRecord'](_0x2ffd51[0x0]);}async[a253_0x428164(0x1a0)](_0x581da6){const _0x3f27ef=a253_0x428164,_0x102159=await this[_0x3f27ef(0x181)]['query'](queries_1[_0x3f27ef(0x1aa)][_0x3f27ef(0x19a)](_0x3f27ef(0x194),_0x581da6));if(_0x102159[_0x3f27ef(0x1d0)]===0x0)throw new not_found_error_1[(_0x3f27ef(0x179))]('Branch\x20'+_0x581da6+_0x3f27ef(0x1a1));const _0x215683=_0x102159[_0x3f27ef(0x1c7)](_0x4dcd3b=>_0x4dcd3b[constants_1[_0x3f27ef(0x182)]+_0x3f27ef(0x18b)]===_0x581da6);if(!_0x215683)throw new not_found_error_1[(_0x3f27ef(0x179))](_0x3f27ef(0x1b3)+_0x581da6+_0x3f27ef(0x1a1));return flosum_repository_sync_dto_1[_0x3f27ef(0x17a)][_0x3f27ef(0x188)](_0x215683);}async[a253_0x428164(0x1a8)](_0x1f799a){const _0x411b19=a253_0x428164,_0x44761d=await this['salesforceQuery']['query'](queries_1[_0x411b19(0x1bd)][_0x411b19(0x19a)](_0x411b19(0x194),_0x1f799a));if(_0x44761d[_0x411b19(0x1d0)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x411b19(0x1ac)+_0x1f799a+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x411b19(0x17a)][_0x411b19(0x177)](_0x44761d[0x0]);}async[a253_0x428164(0x1c3)](_0x57243c){const _0x11b126=a253_0x428164,_0x277499=_0x11b126(0x1b4)+queries_1[_0x11b126(0x1c8)]+_0x11b126(0x1af)+_0x57243c+'\x27';return this[_0x11b126(0x198)](_0x277499);}async[a253_0x428164(0x1c4)](_0x3032b3){const _0x5a76be=a253_0x428164,_0x50ba09='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1['GET_COMPONENTS_QUERY']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x3032b3+'\x27';return this[_0x5a76be(0x198)](_0x50ba09);}async[a253_0x428164(0x1ca)](_0x378a6f){const _0x7bf44a=a253_0x428164;var _0x56ec3a;const _0x34cced=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x7bf44a(0x19a)](_0x7bf44a(0x17c),_0x378a6f[_0x7bf44a(0x185)])[_0x7bf44a(0x19a)]('%name%',_0x378a6f[_0x7bf44a(0x1b2)]?constants_1[_0x7bf44a(0x187)]:constants_1[_0x7bf44a(0x184)]),_0xdfea9e=await this['salesforceQuery'][_0x7bf44a(0x193)](_0x34cced),_0x3ca965=(_0x56ec3a=_0xdfea9e[0x0])===null||_0x56ec3a===void 0x0?void 0x0:_0x56ec3a['Id'];if(!_0x3ca965)throw new Error(errors_1[_0x7bf44a(0x1ae)]);return _0x3ca965;}async[a253_0x428164(0x19e)](_0x1ee5b8){const _0x4edf14=a253_0x428164;let _0x51c87d=await this['getAttachmentId'](_0x1ee5b8)[_0x4edf14(0x18f)](()=>null);return!_0x51c87d&&(_0x51c87d=await this[_0x4edf14(0x1b5)][_0x4edf14(0x19f)]('Attachment',{'Body':(0x0,utils_1[_0x4edf14(0x1a5)])('{}'),'ParentId':_0x1ee5b8['objectId'],'ContentType':_0x4edf14(0x1ce),'Name':_0x1ee5b8[_0x4edf14(0x1b2)]?constants_1[_0x4edf14(0x187)]:constants_1[_0x4edf14(0x184)]})),_0x51c87d;}async['updateRemoteState'](_0x45a00e,_0x2ff419){const _0x43db7a=a253_0x428164,_0x217bee=await this['getRemoteStateAttachmentId'](_0x45a00e);await this[_0x43db7a(0x1b5)][_0x43db7a(0x1ba)]('Attachment',_0x217bee,{'Body':(0x0,utils_1[_0x43db7a(0x1a5)])(JSON[_0x43db7a(0x1bc)](_0x2ff419))});}async[a253_0x428164(0x1a3)](_0x38465f,_0x5bce24){const _0x468f68=a253_0x428164;await this[_0x468f68(0x1b5)]['patchObject'](_0x38465f[_0x468f68(0x1d5)],_0x38465f[_0x468f68(0x185)],{[constants_1[_0x468f68(0x1c2)]+_0x468f68(0x1b1)]:_0x5bce24});}async[a253_0x428164(0x18e)](_0x319a81){const _0x3c9b91=a253_0x428164;await this[_0x3c9b91(0x1b5)][_0x3c9b91(0x1ba)](constants_1[_0x3c9b91(0x1c2)]+'Connection__c',_0x319a81,{[constants_1[_0x3c9b91(0x1c2)]+_0x3c9b91(0x189)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a253_0x428164(0x1b6)])(),__metadata(a253_0x428164(0x18a),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a253_0x428164(0x1ab)]])],SalesforceSyncService),exports[a253_0x428164(0x19b)]=SalesforceSyncService;