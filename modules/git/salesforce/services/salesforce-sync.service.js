const a243_0x418857=a243_0x3cae;function a243_0x51d3(){const _0x763e19=['665159goahDP','salesforceService','Components__r','toString','disableSync','catch','GET_BRANCH_QUERY','design:paramtypes','SalesforceService','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','Service','length','GET_WAITING_REPOSITORIES_QUERY','FLOSUM_GIT_NAMESPACE','getComponentsFromRepository','%name%','updateRemoteState','Branch_Name__c','Connection__c','stringify','decorate','SalesforceNotFoundError','../../../../constants/errors','patchObject','../../../shared/utils','typedi','4187452xxrcbb','metadata','(((.+)+)+)+$','ERR_INVALID_ATTACHMENT_ID','../queries','constructor','%id%','Sync_In_Progress__c','Name','getComponents','Attachment','encodeBase64','getAttachmentId','objectId','getRemoteStateAttachmentId','getBranchComponents','records','3347880butwdd','./salesforce-query.service','getBranchRecord','Repository\x20with\x20Id\x20','10296220SzlCDt','5ERBDCv','FlosumRepositorySyncDto','getAllRepositoryNames','64871wvzWaV','2254tepAJn','repositoryId','find','Branch\x20with\x20Id\x20','__esModule','20166TtwACp','4572135XOZeLg','getBranchRecords','apply','fromRepositoryRecord','getRepositoryRecordByName','../../../../constants','query','120YewBjJ','8gGUZta','FLOSUM_NAMESPACE','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','replace','fromBranchRecord','SalesforceQueryService','\x20not\x20found\x20on\x20salesforce','function','defineProperty','GET_REPOSITORY_QUERY','GET_REPOSITORY_BY_NAME_QUERY','createObject','../errors/not-found.error','SYNC_ATTACHMENT_FOR_BRANCH_NAME','Synchronization_Status__c','GET_COMPONENTS_QUERY','map','salesforceQuery','14QgSrOb','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','SalesforceSyncService','./salesforce.service'];a243_0x51d3=function(){return _0x763e19;};return a243_0x51d3();}(function(_0x151363,_0x42da6e){const _0x52a672=a243_0x3cae,_0x59693f=_0x151363();while(!![]){try{const _0x41427d=parseInt(_0x52a672(0x1a3))/0x1*(-parseInt(_0x52a672(0x1c4))/0x2)+-parseInt(_0x52a672(0x19b))/0x3+parseInt(_0x52a672(0x1e3))/0x4*(parseInt(_0x52a672(0x1a0))/0x5)+-parseInt(_0x52a672(0x1a9))/0x6*(-parseInt(_0x52a672(0x1a4))/0x7)+-parseInt(_0x52a672(0x1b2))/0x8*(-parseInt(_0x52a672(0x1aa))/0x9)+-parseInt(_0x52a672(0x19f))/0xa+-parseInt(_0x52a672(0x1c9))/0xb*(-parseInt(_0x52a672(0x1b1))/0xc);if(_0x41427d===_0x42da6e)break;else _0x59693f['push'](_0x59693f['shift']());}catch(_0x537838){_0x59693f['push'](_0x59693f['shift']());}}}(a243_0x51d3,0x9cc53));const a243_0x4e0323=(function(){let _0x5bbda9=!![];return function(_0x3ac734,_0x26f72d){const _0x16e34d=_0x5bbda9?function(){const _0x3810dd=a243_0x3cae;if(_0x26f72d){const _0xe8967c=_0x26f72d[_0x3810dd(0x1ac)](_0x3ac734,arguments);return _0x26f72d=null,_0xe8967c;}}:function(){};return _0x5bbda9=![],_0x16e34d;};}()),a243_0x2c7585=a243_0x4e0323(this,function(){const _0x397128=a243_0x3cae;return a243_0x2c7585[_0x397128(0x1cc)]()['search']('(((.+)+)+)+$')[_0x397128(0x1cc)]()[_0x397128(0x1e8)](a243_0x2c7585)['search'](_0x397128(0x1e5));});a243_0x2c7585();function a243_0x3cae(_0x1c9403,_0x5c24d9){const _0x583ac6=a243_0x51d3();return a243_0x3cae=function(_0x2c7585,_0x4e0323){_0x2c7585=_0x2c7585-0x19b;let _0x51d3a1=_0x583ac6[_0x2c7585];return _0x51d3a1;},a243_0x3cae(_0x1c9403,_0x5c24d9);}'use strict';var __decorate=this&&this['__decorate']||function(_0x4f60a3,_0x2e4faa,_0x50836d,_0x1215b1){const _0x2f54a2=a243_0x3cae;var _0x1b9895=arguments[_0x2f54a2(0x1d4)],_0x44224e=_0x1b9895<0x3?_0x2e4faa:_0x1215b1===null?_0x1215b1=Object['getOwnPropertyDescriptor'](_0x2e4faa,_0x50836d):_0x1215b1,_0x133692;if(typeof Reflect==='object'&&typeof Reflect[_0x2f54a2(0x1dd)]===_0x2f54a2(0x1b9))_0x44224e=Reflect['decorate'](_0x4f60a3,_0x2e4faa,_0x50836d,_0x1215b1);else{for(var _0x3aee69=_0x4f60a3[_0x2f54a2(0x1d4)]-0x1;_0x3aee69>=0x0;_0x3aee69--)if(_0x133692=_0x4f60a3[_0x3aee69])_0x44224e=(_0x1b9895<0x3?_0x133692(_0x44224e):_0x1b9895>0x3?_0x133692(_0x2e4faa,_0x50836d,_0x44224e):_0x133692(_0x2e4faa,_0x50836d))||_0x44224e;}return _0x1b9895>0x3&&_0x44224e&&Object[_0x2f54a2(0x1ba)](_0x2e4faa,_0x50836d,_0x44224e),_0x44224e;},__metadata=this&&this['__metadata']||function(_0x41bb54,_0x5a89c1){const _0x5a2387=a243_0x3cae;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x5a2387(0x1b9))return Reflect[_0x5a2387(0x1e4)](_0x41bb54,_0x5a89c1);};Object[a243_0x418857(0x1ba)](exports,a243_0x418857(0x1a8),{'value':!![]}),exports[a243_0x418857(0x1c7)]=void 0x0;const typedi_1=require(a243_0x418857(0x1e2)),constants_1=require(a243_0x418857(0x1af)),errors_1=require(a243_0x418857(0x1df)),utils_1=require(a243_0x418857(0x1e1)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a243_0x418857(0x1be)),queries_1=require(a243_0x418857(0x1e7)),salesforce_query_service_1=require(a243_0x418857(0x19c)),salesforce_service_1=require(a243_0x418857(0x1c8));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x2f7257,_0x129519){const _0x4cfd80=a243_0x418857;this[_0x4cfd80(0x1c3)]=_0x2f7257,this[_0x4cfd80(0x1ca)]=_0x129519;}async[a243_0x418857(0x1ec)](_0x1d56c1){const _0x2278e5=a243_0x418857;var _0x34aaf3;const _0x391927=await this[_0x2278e5(0x1c3)][_0x2278e5(0x1b0)](_0x1d56c1),_0x29fcfa=[];for(const _0x2aa014 of _0x391927){const _0x4e5a13=(_0x34aaf3=_0x2aa014[constants_1[_0x2278e5(0x1b3)]+_0x2278e5(0x1cb)])===null||_0x34aaf3===void 0x0?void 0x0:_0x34aaf3[_0x2278e5(0x1f3)];_0x4e5a13&&_0x4e5a13[_0x2278e5(0x1d4)]&&_0x29fcfa['push'](_0x4e5a13[0x0]['Id']);}return _0x29fcfa;}async[a243_0x418857(0x1a2)](_0x248dbd){const _0x5766ab=a243_0x418857,_0x803644=await this[_0x5766ab(0x1c3)][_0x5766ab(0x1b0)](queries_1['GET_REPOSITORIES_NAMES_QUERY'][_0x5766ab(0x1b5)](/\%connection_id\%/g,_0x248dbd));return _0x803644['map'](_0x53807f=>{const _0x48d98c=_0x5766ab;return _0x53807f[constants_1['FLOSUM_GIT_NAMESPACE']+'Repository__r']?_0x53807f[constants_1[_0x48d98c(0x1d6)]+'Repository__r']['Name']:_0x53807f[_0x48d98c(0x1eb)];});}async['getRepositoryRecords'](_0x22a82a){const _0xe8ef0=a243_0x418857,_0x1cf3ba=await this['salesforceQuery']['query'](queries_1[_0xe8ef0(0x1d5)][_0xe8ef0(0x1b5)](/\%connection_id\%/g,_0x22a82a));return _0x1cf3ba[_0xe8ef0(0x1c2)](_0x2037f9=>flosum_repository_sync_dto_1[_0xe8ef0(0x1a1)][_0xe8ef0(0x1ad)](_0x2037f9));}async[a243_0x418857(0x1ab)](_0x26c95){const _0x3a4eb2=a243_0x418857,_0x4a2e5a=await this['salesforceQuery'][_0x3a4eb2(0x1b0)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x3a4eb2(0x1b5)](/%repositories_ids\%/g,_0x26c95));return _0x4a2e5a[_0x3a4eb2(0x1c2)](_0x23c475=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x3a4eb2(0x1b6)](_0x23c475));}async['getRepositoryRecord'](_0x475f81){const _0x5be68f=a243_0x418857,_0x1b9b58=await this[_0x5be68f(0x1c3)][_0x5be68f(0x1b0)](queries_1[_0x5be68f(0x1bb)][_0x5be68f(0x1b5)](_0x5be68f(0x1e9),_0x475f81));if(_0x1b9b58[_0x5be68f(0x1d4)]===0x0)throw new not_found_error_1[(_0x5be68f(0x1de))](_0x5be68f(0x19e)+_0x475f81+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x5be68f(0x1a1)][_0x5be68f(0x1ad)](_0x1b9b58[0x0]);}async[a243_0x418857(0x19d)](_0x1ba05d){const _0xd2e73f=a243_0x418857,_0x108735=await this[_0xd2e73f(0x1c3)][_0xd2e73f(0x1b0)](queries_1[_0xd2e73f(0x1cf)][_0xd2e73f(0x1b5)](_0xd2e73f(0x1e9),_0x1ba05d));if(_0x108735[_0xd2e73f(0x1d4)]===0x0)throw new not_found_error_1[(_0xd2e73f(0x1de))](_0xd2e73f(0x1a7)+_0x1ba05d+_0xd2e73f(0x1b8));return flosum_repository_sync_dto_1[_0xd2e73f(0x1a1)][_0xd2e73f(0x1b6)](_0x108735[0x0]);}async['getBranchRecordByName'](_0x180ceb){const _0x5d7dd9=a243_0x418857,_0x390a71=await this[_0x5d7dd9(0x1c3)]['query'](queries_1['GET_BRANCH_BY_NAME_QUERY']['replace'](_0x5d7dd9(0x1d8),_0x180ceb));if(_0x390a71[_0x5d7dd9(0x1d4)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x180ceb+_0x5d7dd9(0x1b8));const _0x36fb8a=_0x390a71[_0x5d7dd9(0x1a6)](_0x34130c=>_0x34130c[constants_1[_0x5d7dd9(0x1b3)]+_0x5d7dd9(0x1da)]===_0x180ceb);if(!_0x36fb8a)throw new not_found_error_1[(_0x5d7dd9(0x1de))]('Branch\x20'+_0x180ceb+_0x5d7dd9(0x1b8));return flosum_repository_sync_dto_1[_0x5d7dd9(0x1a1)]['fromBranchRecord'](_0x36fb8a);}async[a243_0x418857(0x1ae)](_0x252da0){const _0x22fbdf=a243_0x418857,_0x411a61=await this[_0x22fbdf(0x1c3)][_0x22fbdf(0x1b0)](queries_1[_0x22fbdf(0x1bc)][_0x22fbdf(0x1b5)](_0x22fbdf(0x1d8),_0x252da0));if(_0x411a61[_0x22fbdf(0x1d4)]===0x0)throw new not_found_error_1[(_0x22fbdf(0x1de))]('Repository\x20'+_0x252da0+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x22fbdf(0x1a1)][_0x22fbdf(0x1ad)](_0x411a61[0x0]);}async[a243_0x418857(0x1d7)](_0x271f5d){const _0x4aaeb7=a243_0x418857,_0x41ba99='\x0a\x20\x20\x20\x20\x20\x20'+queries_1['GET_COMPONENTS_QUERY']+_0x4aaeb7(0x1b4)+_0x271f5d+'\x27';return this[_0x4aaeb7(0x1ec)](_0x41ba99);}async[a243_0x418857(0x1f2)](_0x201ae3){const _0x56ad6e=a243_0x418857,_0x2a2509=_0x56ad6e(0x1c6)+queries_1[_0x56ad6e(0x1c1)]+_0x56ad6e(0x1c5)+_0x201ae3+'\x27';return this[_0x56ad6e(0x1ec)](_0x2a2509);}async['getAttachmentId'](_0x213577){const _0x57a103=a243_0x418857;var _0x5b51b6;const _0x40cb0a=queries_1[_0x57a103(0x1d2)][_0x57a103(0x1b5)]('%parentId%',_0x213577[_0x57a103(0x1f0)])[_0x57a103(0x1b5)](_0x57a103(0x1d8),_0x213577[_0x57a103(0x1a5)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x4a1239=await this[_0x57a103(0x1c3)][_0x57a103(0x1b0)](_0x40cb0a),_0x1e1017=(_0x5b51b6=_0x4a1239[0x0])===null||_0x5b51b6===void 0x0?void 0x0:_0x5b51b6['Id'];if(!_0x1e1017)throw new Error(errors_1[_0x57a103(0x1e6)]);return _0x1e1017;}async[a243_0x418857(0x1f1)](_0x378957){const _0xd0b6d9=a243_0x418857;let _0x460b7c=await this[_0xd0b6d9(0x1ef)](_0x378957)[_0xd0b6d9(0x1ce)](()=>null);return!_0x460b7c&&(_0x460b7c=await this[_0xd0b6d9(0x1ca)][_0xd0b6d9(0x1bd)]('Attachment',{'Body':(0x0,utils_1[_0xd0b6d9(0x1ee)])('{}'),'ParentId':_0x378957['objectId'],'ContentType':'text/plain','Name':_0x378957['repositoryId']?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0xd0b6d9(0x1bf)]})),_0x460b7c;}async[a243_0x418857(0x1d9)](_0x7b36ec,_0x1f4460){const _0xf27df6=a243_0x418857,_0x30ec5f=await this[_0xf27df6(0x1f1)](_0x7b36ec);await this[_0xf27df6(0x1ca)][_0xf27df6(0x1e0)](_0xf27df6(0x1ed),_0x30ec5f,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0xf27df6(0x1dc)](_0x1f4460))});}async['setStatus'](_0x324378,_0x3a70ae){const _0x50eca3=a243_0x418857;await this['salesforceService']['patchObject'](_0x324378['objectType'],_0x324378[_0x50eca3(0x1f0)],{[constants_1[_0x50eca3(0x1d6)]+_0x50eca3(0x1c0)]:_0x3a70ae});}async[a243_0x418857(0x1cd)](_0x14be82){const _0x119718=a243_0x418857;await this[_0x119718(0x1ca)][_0x119718(0x1e0)](constants_1[_0x119718(0x1d6)]+_0x119718(0x1db),_0x14be82,{[constants_1[_0x119718(0x1d6)]+_0x119718(0x1ea)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a243_0x418857(0x1d3)])(),__metadata(a243_0x418857(0x1d0),[salesforce_query_service_1[a243_0x418857(0x1b7)],salesforce_service_1[a243_0x418857(0x1d1)]])],SalesforceSyncService),exports[a243_0x418857(0x1c7)]=SalesforceSyncService;