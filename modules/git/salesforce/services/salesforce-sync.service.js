const a238_0x140f61=a238_0x3975;(function(_0x2e5a93,_0x1469e6){const _0x4aefa6=a238_0x3975,_0x2c1956=_0x2e5a93();while(!![]){try{const _0x1c1bbf=parseInt(_0x4aefa6(0x22e))/0x1+-parseInt(_0x4aefa6(0x1e5))/0x2+-parseInt(_0x4aefa6(0x216))/0x3+-parseInt(_0x4aefa6(0x213))/0x4+-parseInt(_0x4aefa6(0x22a))/0x5*(parseInt(_0x4aefa6(0x21c))/0x6)+parseInt(_0x4aefa6(0x22d))/0x7*(parseInt(_0x4aefa6(0x223))/0x8)+-parseInt(_0x4aefa6(0x1dc))/0x9*(-parseInt(_0x4aefa6(0x1ef))/0xa);if(_0x1c1bbf===_0x1469e6)break;else _0x2c1956['push'](_0x2c1956['shift']());}catch(_0x102d6b){_0x2c1956['push'](_0x2c1956['shift']());}}}(a238_0x7203,0x1a0f0));const a238_0x259642=(function(){let _0x296af0=!![];return function(_0x2325a8,_0x48cbf2){const _0x576c75=_0x296af0?function(){const _0x236f52=a238_0x3975;if(_0x48cbf2){const _0x59608c=_0x48cbf2[_0x236f52(0x22f)](_0x2325a8,arguments);return _0x48cbf2=null,_0x59608c;}}:function(){};return _0x296af0=![],_0x576c75;};}()),a238_0x83f817=a238_0x259642(this,function(){const _0x370e28=a238_0x3975;return a238_0x83f817[_0x370e28(0x1fb)]()['search'](_0x370e28(0x234))[_0x370e28(0x1fb)]()[_0x370e28(0x201)](a238_0x83f817)['search'](_0x370e28(0x234));});a238_0x83f817();'use strict';var __decorate=this&&this[a238_0x140f61(0x1fc)]||function(_0x15dc70,_0x738cb,_0x340468,_0x3cd4be){const _0x17eb83=a238_0x140f61;var _0x3135d4=arguments[_0x17eb83(0x228)],_0x27a708=_0x3135d4<0x3?_0x738cb:_0x3cd4be===null?_0x3cd4be=Object[_0x17eb83(0x1f8)](_0x738cb,_0x340468):_0x3cd4be,_0x37e8f0;if(typeof Reflect===_0x17eb83(0x221)&&typeof Reflect[_0x17eb83(0x204)]==='function')_0x27a708=Reflect['decorate'](_0x15dc70,_0x738cb,_0x340468,_0x3cd4be);else{for(var _0xcf0377=_0x15dc70[_0x17eb83(0x228)]-0x1;_0xcf0377>=0x0;_0xcf0377--)if(_0x37e8f0=_0x15dc70[_0xcf0377])_0x27a708=(_0x3135d4<0x3?_0x37e8f0(_0x27a708):_0x3135d4>0x3?_0x37e8f0(_0x738cb,_0x340468,_0x27a708):_0x37e8f0(_0x738cb,_0x340468))||_0x27a708;}return _0x3135d4>0x3&&_0x27a708&&Object[_0x17eb83(0x236)](_0x738cb,_0x340468,_0x27a708),_0x27a708;},__metadata=this&&this['__metadata']||function(_0x203711,_0x167baf){const _0x513dff=a238_0x140f61;if(typeof Reflect===_0x513dff(0x221)&&typeof Reflect[_0x513dff(0x210)]===_0x513dff(0x1de))return Reflect[_0x513dff(0x210)](_0x203711,_0x167baf);};Object[a238_0x140f61(0x236)](exports,a238_0x140f61(0x214),{'value':!![]}),exports[a238_0x140f61(0x1fd)]=void 0x0;const typedi_1=require(a238_0x140f61(0x1e3)),constants_1=require(a238_0x140f61(0x1e2)),errors_1=require(a238_0x140f61(0x205)),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a238_0x140f61(0x1f0)),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a238_0x140f61(0x20e)),salesforce_query_service_1=require('./salesforce-query.service'),salesforce_service_1=require(a238_0x140f61(0x1db));function a238_0x7203(){const _0x79eaf8=['fromBranchRecord','getRepositoryRecord','getBranchRecordByName','query','salesforceService','708BrGZwh','design:paramtypes','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','GET_BRANCH_BY_NAME_QUERY','object','Components__r','1230424hdhPoY','encodeBase64','Repository__r','GET_REPOSITORY_QUERY','Repository\x20','length','Branch\x20','395ZAODqy','GET_BRANCH_QUERY','repositoryId','7eXHgyY','5061krTrFe','apply','patchObject','getBranchComponents','GET_WAITING_REPOSITORIES_QUERY','GET_REPOSITORIES_NAMES_QUERY','(((.+)+)+)+$','disableSync','defineProperty','getAttachmentId','stringify','Attachment','./salesforce.service','2664OVBoqZ','updateRemoteState','function','SalesforceQueryService','salesforceQuery','objectId','../../../../constants','typedi','Synchronization_Status__c','350844Nxyjxz','getRemoteStateAttachmentId','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','Sync_In_Progress__c','Repository\x20with\x20Id\x20','getComponents','getComponentsFromRepository','GET_WAITING_BRANCHES_QUERY','\x20not\x20found\x20on\x20salesforce','9680HqHcRf','../dto/flosum-repository-sync.dto','FLOSUM_NAMESPACE','getRepositoryRecordByName','Connection__c','setStatus','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','%parentId%','objectType','getOwnPropertyDescriptor','FlosumRepositorySyncDto','%name%','toString','__decorate','SalesforceSyncService','getBranchRecord','SalesforceNotFoundError','catch','constructor','fromRepositoryRecord','map','decorate','../../../../constants/errors','getBranchRecords','getAllRepositoryNames','FLOSUM_GIT_NAMESPACE','GET_COMPONENTS_QUERY','replace','text/plain','SalesforceService','getRepositoryRecords','../queries','records','metadata','%id%','Service','192216dWqWeF','__esModule','SYNC_ATTACHMENT_FOR_BRANCH_NAME','317574vkuwZi'];a238_0x7203=function(){return _0x79eaf8;};return a238_0x7203();}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x359329,_0x48b51b){const _0x399c3b=a238_0x140f61;this[_0x399c3b(0x1e0)]=_0x359329,this[_0x399c3b(0x21b)]=_0x48b51b;}async[a238_0x140f61(0x1eb)](_0x16156d){const _0x4ed3d5=a238_0x140f61;var _0x5e3fc5;const _0x24b0d1=await this[_0x4ed3d5(0x1e0)]['query'](_0x16156d),_0x4bfb02=[];for(const _0x538849 of _0x24b0d1){const _0x72403b=(_0x5e3fc5=_0x538849[constants_1[_0x4ed3d5(0x1f1)]+_0x4ed3d5(0x222)])===null||_0x5e3fc5===void 0x0?void 0x0:_0x5e3fc5[_0x4ed3d5(0x20f)];_0x72403b&&_0x72403b['length']&&_0x4bfb02['push'](_0x72403b[0x0]['Id']);}return _0x4bfb02;}async[a238_0x140f61(0x207)](_0xe92a03){const _0x4131a4=a238_0x140f61,_0x11d1b8=await this['salesforceQuery'][_0x4131a4(0x21a)](queries_1[_0x4131a4(0x233)][_0x4131a4(0x20a)](/\%connection_id\%/g,_0xe92a03));return _0x11d1b8['map'](_0x58a3eb=>{const _0x98995a=_0x4131a4;return _0x58a3eb[constants_1['FLOSUM_GIT_NAMESPACE']+_0x98995a(0x225)]?_0x58a3eb[constants_1['FLOSUM_GIT_NAMESPACE']+_0x98995a(0x225)]['Name']:_0x58a3eb['Name'];});}async[a238_0x140f61(0x20d)](_0x4133c4){const _0xc76f24=a238_0x140f61,_0x408936=await this[_0xc76f24(0x1e0)][_0xc76f24(0x21a)](queries_1[_0xc76f24(0x232)][_0xc76f24(0x20a)](/\%connection_id\%/g,_0x4133c4));return _0x408936[_0xc76f24(0x203)](_0x50c558=>flosum_repository_sync_dto_1[_0xc76f24(0x1f9)]['fromRepositoryRecord'](_0x50c558));}async[a238_0x140f61(0x206)](_0x12b0c5){const _0x3a298d=a238_0x140f61,_0x7f25c=await this[_0x3a298d(0x1e0)][_0x3a298d(0x21a)](queries_1[_0x3a298d(0x1ed)]['replace'](/%repositories_ids\%/g,_0x12b0c5));return _0x7f25c[_0x3a298d(0x203)](_0x162746=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromBranchRecord'](_0x162746));}async[a238_0x140f61(0x218)](_0x446932){const _0x52a0f4=a238_0x140f61,_0x42fde5=await this[_0x52a0f4(0x1e0)][_0x52a0f4(0x21a)](queries_1[_0x52a0f4(0x226)]['replace']('%id%',_0x446932));if(_0x42fde5[_0x52a0f4(0x228)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x52a0f4(0x1ea)+_0x446932+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x52a0f4(0x1f9)][_0x52a0f4(0x202)](_0x42fde5[0x0]);}async[a238_0x140f61(0x1fe)](_0xd9858e){const _0x2bc4c0=a238_0x140f61,_0x23e5a2=await this[_0x2bc4c0(0x1e0)][_0x2bc4c0(0x21a)](queries_1[_0x2bc4c0(0x22b)][_0x2bc4c0(0x20a)](_0x2bc4c0(0x211),_0xd9858e));if(_0x23e5a2[_0x2bc4c0(0x228)]===0x0)throw new not_found_error_1[(_0x2bc4c0(0x1ff))]('Branch\x20with\x20Id\x20'+_0xd9858e+_0x2bc4c0(0x1ee));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x2bc4c0(0x217)](_0x23e5a2[0x0]);}async[a238_0x140f61(0x219)](_0x9bba35){const _0x11964d=a238_0x140f61,_0x3755d9=await this[_0x11964d(0x1e0)][_0x11964d(0x21a)](queries_1[_0x11964d(0x220)][_0x11964d(0x20a)]('%name%',_0x9bba35));if(_0x3755d9[_0x11964d(0x228)]===0x0)throw new not_found_error_1[(_0x11964d(0x1ff))](_0x11964d(0x229)+_0x9bba35+_0x11964d(0x1ee));const _0x1bf3e9=_0x3755d9['find'](_0x1e5576=>_0x1e5576[constants_1[_0x11964d(0x1f1)]+'Branch_Name__c']===_0x9bba35);if(!_0x1bf3e9)throw new not_found_error_1[(_0x11964d(0x1ff))](_0x11964d(0x229)+_0x9bba35+_0x11964d(0x1ee));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x11964d(0x217)](_0x1bf3e9);}async[a238_0x140f61(0x1f2)](_0x1f17d0){const _0x4c08dc=a238_0x140f61,_0x2c674d=await this[_0x4c08dc(0x1e0)][_0x4c08dc(0x21a)](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x4c08dc(0x20a)](_0x4c08dc(0x1fa),_0x1f17d0));if(_0x2c674d['length']===0x0)throw new not_found_error_1[(_0x4c08dc(0x1ff))](_0x4c08dc(0x227)+_0x1f17d0+_0x4c08dc(0x1ee));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x4c08dc(0x202)](_0x2c674d[0x0]);}async[a238_0x140f61(0x1ec)](_0xc4a7ad){const _0x52ebf2=a238_0x140f61,_0x40e9cb='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x52ebf2(0x209)]+_0x52ebf2(0x1e7)+_0xc4a7ad+'\x27';return this[_0x52ebf2(0x1eb)](_0x40e9cb);}async[a238_0x140f61(0x231)](_0x18dfbe){const _0x1e086e=a238_0x140f61,_0x4e0388=_0x1e086e(0x21f)+queries_1['GET_COMPONENTS_QUERY']+_0x1e086e(0x1e8)+_0x18dfbe+'\x27';return this['getComponents'](_0x4e0388);}async[a238_0x140f61(0x237)](_0x4dbf99){const _0x1471ef=a238_0x140f61;var _0x25f3bd;const _0xd80f0c=queries_1[_0x1471ef(0x1f5)][_0x1471ef(0x20a)](_0x1471ef(0x1f6),_0x4dbf99[_0x1471ef(0x1e1)])[_0x1471ef(0x20a)]('%name%',_0x4dbf99[_0x1471ef(0x22c)]?constants_1[_0x1471ef(0x21e)]:constants_1[_0x1471ef(0x215)]),_0xbb3f2f=await this[_0x1471ef(0x1e0)][_0x1471ef(0x21a)](_0xd80f0c),_0x9b86e8=(_0x25f3bd=_0xbb3f2f[0x0])===null||_0x25f3bd===void 0x0?void 0x0:_0x25f3bd['Id'];if(!_0x9b86e8)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x9b86e8;}async[a238_0x140f61(0x1e6)](_0x292412){const _0xb4fa21=a238_0x140f61;let _0x5a2cc2=await this[_0xb4fa21(0x237)](_0x292412)[_0xb4fa21(0x200)](()=>null);return!_0x5a2cc2&&(_0x5a2cc2=await this[_0xb4fa21(0x21b)]['createObject']('Attachment',{'Body':(0x0,utils_1[_0xb4fa21(0x224)])('{}'),'ParentId':_0x292412['objectId'],'ContentType':_0xb4fa21(0x20b),'Name':_0x292412[_0xb4fa21(0x22c)]?constants_1[_0xb4fa21(0x21e)]:constants_1[_0xb4fa21(0x215)]})),_0x5a2cc2;}async[a238_0x140f61(0x1dd)](_0x409a2c,_0x4147e4){const _0x38aea2=a238_0x140f61,_0x588223=await this[_0x38aea2(0x1e6)](_0x409a2c);await this['salesforceService']['patchObject'](_0x38aea2(0x1da),_0x588223,{'Body':(0x0,utils_1[_0x38aea2(0x224)])(JSON[_0x38aea2(0x1d9)](_0x4147e4))});}async[a238_0x140f61(0x1f4)](_0x113235,_0x1b4456){const _0x3bab97=a238_0x140f61;await this[_0x3bab97(0x21b)][_0x3bab97(0x230)](_0x113235[_0x3bab97(0x1f7)],_0x113235[_0x3bab97(0x1e1)],{[constants_1[_0x3bab97(0x208)]+_0x3bab97(0x1e4)]:_0x1b4456});}async[a238_0x140f61(0x235)](_0x270d8d){const _0x51fe25=a238_0x140f61;await this[_0x51fe25(0x21b)][_0x51fe25(0x230)](constants_1[_0x51fe25(0x208)]+_0x51fe25(0x1f3),_0x270d8d,{[constants_1[_0x51fe25(0x208)]+_0x51fe25(0x1e9)]:![]});}};function a238_0x3975(_0x95b16a,_0x2758f3){const _0x1178e9=a238_0x7203();return a238_0x3975=function(_0x83f817,_0x259642){_0x83f817=_0x83f817-0x1d9;let _0x720364=_0x1178e9[_0x83f817];return _0x720364;},a238_0x3975(_0x95b16a,_0x2758f3);}SalesforceSyncService=__decorate([(0x0,typedi_1[a238_0x140f61(0x212)])(),__metadata(a238_0x140f61(0x21d),[salesforce_query_service_1[a238_0x140f61(0x1df)],salesforce_service_1[a238_0x140f61(0x20c)]])],SalesforceSyncService),exports[a238_0x140f61(0x1fd)]=SalesforceSyncService;