const a204_0x553b85=a204_0x4776;(function(_0x53f2eb,_0x28dc15){const _0x1629ef=a204_0x4776,_0x390a53=_0x53f2eb();while(!![]){try{const _0x2e72f5=-parseInt(_0x1629ef(0x16f))/0x1*(parseInt(_0x1629ef(0x176))/0x2)+-parseInt(_0x1629ef(0x191))/0x3*(-parseInt(_0x1629ef(0x1ad))/0x4)+-parseInt(_0x1629ef(0x178))/0x5+parseInt(_0x1629ef(0x1a9))/0x6*(parseInt(_0x1629ef(0x171))/0x7)+parseInt(_0x1629ef(0x164))/0x8*(parseInt(_0x1629ef(0x1b0))/0x9)+-parseInt(_0x1629ef(0x1a1))/0xa*(parseInt(_0x1629ef(0x15f))/0xb)+parseInt(_0x1629ef(0x1a5))/0xc;if(_0x2e72f5===_0x28dc15)break;else _0x390a53['push'](_0x390a53['shift']());}catch(_0x43c59a){_0x390a53['push'](_0x390a53['shift']());}}}(a204_0x22f9,0x4b423));const a204_0x947d72=(function(){let _0x9e9bdd=!![];return function(_0x140a8b,_0x4a262f){const _0x51f91f=_0x9e9bdd?function(){const _0x31db4c=a204_0x4776;if(_0x4a262f){const _0x4a3b7d=_0x4a262f[_0x31db4c(0x160)](_0x140a8b,arguments);return _0x4a262f=null,_0x4a3b7d;}}:function(){};return _0x9e9bdd=![],_0x51f91f;};}()),a204_0x37186c=a204_0x947d72(this,function(){const _0x46cc7c=a204_0x4776;return a204_0x37186c['toString']()[_0x46cc7c(0x18b)](_0x46cc7c(0x1ae))['toString']()[_0x46cc7c(0x1a6)](a204_0x37186c)[_0x46cc7c(0x18b)]('(((.+)+)+)+$');});a204_0x37186c();'use strict';var __decorate=this&&this[a204_0x553b85(0x161)]||function(_0x3db77d,_0x191cad,_0xde9989,_0x2ef086){const _0x550e0c=a204_0x553b85;var _0x5a78ee=arguments[_0x550e0c(0x169)],_0x38da9d=_0x5a78ee<0x3?_0x191cad:_0x2ef086===null?_0x2ef086=Object['getOwnPropertyDescriptor'](_0x191cad,_0xde9989):_0x2ef086,_0x3fe3b2;if(typeof Reflect===_0x550e0c(0x158)&&typeof Reflect[_0x550e0c(0x17a)]===_0x550e0c(0x173))_0x38da9d=Reflect[_0x550e0c(0x17a)](_0x3db77d,_0x191cad,_0xde9989,_0x2ef086);else{for(var _0x9fe6bb=_0x3db77d['length']-0x1;_0x9fe6bb>=0x0;_0x9fe6bb--)if(_0x3fe3b2=_0x3db77d[_0x9fe6bb])_0x38da9d=(_0x5a78ee<0x3?_0x3fe3b2(_0x38da9d):_0x5a78ee>0x3?_0x3fe3b2(_0x191cad,_0xde9989,_0x38da9d):_0x3fe3b2(_0x191cad,_0xde9989))||_0x38da9d;}return _0x5a78ee>0x3&&_0x38da9d&&Object[_0x550e0c(0x179)](_0x191cad,_0xde9989,_0x38da9d),_0x38da9d;},__metadata=this&&this[a204_0x553b85(0x1ab)]||function(_0x37141b,_0x3e32a2){const _0x500c9a=a204_0x553b85;if(typeof Reflect===_0x500c9a(0x158)&&typeof Reflect[_0x500c9a(0x175)]===_0x500c9a(0x173))return Reflect[_0x500c9a(0x175)](_0x37141b,_0x3e32a2);};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a204_0x553b85(0x15d)]=void 0x0;const typedi_1=require(a204_0x553b85(0x16c)),constants_1=require(a204_0x553b85(0x16b)),errors_1=require('../../../../constants/errors'),utils_1=require(a204_0x553b85(0x16d)),flosum_repository_sync_dto_1=require(a204_0x553b85(0x181)),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a204_0x553b85(0x166)),salesforce_query_service_1=require(a204_0x553b85(0x15a)),salesforce_service_1=require(a204_0x553b85(0x198));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x3e1aba,_0x3a4ee2){this['salesforceQuery']=_0x3e1aba,this['salesforceService']=_0x3a4ee2;}async['getComponents'](_0x1cb6db){const _0x5d205f=a204_0x553b85;var _0x34e379;const _0x5d3c0f=await this[_0x5d205f(0x189)][_0x5d205f(0x197)](_0x1cb6db),_0x5abf35=[];for(const _0x4c8d65 of _0x5d3c0f){const _0x5e4c8c=(_0x34e379=_0x4c8d65[constants_1['FLOSUM_NAMESPACE']+_0x5d205f(0x17f)])===null||_0x34e379===void 0x0?void 0x0:_0x34e379[_0x5d205f(0x1a2)];_0x5e4c8c&&_0x5e4c8c[_0x5d205f(0x169)]&&_0x5abf35['push'](_0x5e4c8c[0x0]['Id']);}return _0x5abf35;}async[a204_0x553b85(0x19a)](_0x121e2b){const _0x47826f=a204_0x553b85,_0xe9774c=await this[_0x47826f(0x189)][_0x47826f(0x197)](queries_1[_0x47826f(0x15c)][_0x47826f(0x168)](/\%connection_id\%/g,_0x121e2b));return _0xe9774c[_0x47826f(0x174)](_0x26c2d9=>{const _0x402b52=_0x47826f;return _0x26c2d9[constants_1[_0x402b52(0x1a8)]+'Repository__r']?_0x26c2d9[constants_1[_0x402b52(0x1a8)]+'Repository__r'][_0x402b52(0x170)]:_0x26c2d9['Name'];});}async[a204_0x553b85(0x165)](_0xf0dc2){const _0x11051b=a204_0x553b85,_0x2998b4=await this['salesforceQuery'][_0x11051b(0x197)](queries_1[_0x11051b(0x180)][_0x11051b(0x168)](/\%connection_id\%/g,_0xf0dc2));return _0x2998b4['map'](_0x374f90=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x374f90));}async['getBranchRecords'](_0x1bf613){const _0x1aa9a9=a204_0x553b85,_0x7f28de=await this[_0x1aa9a9(0x189)][_0x1aa9a9(0x197)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x1aa9a9(0x168)](/%repositories_ids\%/g,_0x1bf613));return _0x7f28de[_0x1aa9a9(0x174)](_0x483581=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x1aa9a9(0x15b)](_0x483581));}async['getRepositoryRecord'](_0x189714){const _0x1e8330=a204_0x553b85,_0x2d6a95=await this['salesforceQuery'][_0x1e8330(0x197)](queries_1[_0x1e8330(0x196)][_0x1e8330(0x168)]('%id%',_0x189714));if(_0x2d6a95[_0x1e8330(0x169)]===0x0)throw new not_found_error_1[(_0x1e8330(0x186))](_0x1e8330(0x16a)+_0x189714+_0x1e8330(0x162));return flosum_repository_sync_dto_1[_0x1e8330(0x159)]['fromRepositoryRecord'](_0x2d6a95[0x0]);}async[a204_0x553b85(0x1a3)](_0x1b6171){const _0x49e274=a204_0x553b85,_0x2ee46e=await this[_0x49e274(0x189)][_0x49e274(0x197)](queries_1[_0x49e274(0x18c)][_0x49e274(0x168)]('%id%',_0x1b6171));if(_0x2ee46e['length']===0x0)throw new not_found_error_1[(_0x49e274(0x186))]('Branch\x20with\x20Id\x20'+_0x1b6171+_0x49e274(0x162));return flosum_repository_sync_dto_1[_0x49e274(0x159)][_0x49e274(0x15b)](_0x2ee46e[0x0]);}async[a204_0x553b85(0x1a0)](_0x274ba0){const _0x881d33=a204_0x553b85,_0x4d68b9=await this['salesforceQuery']['query'](queries_1['GET_BRANCH_BY_NAME_QUERY']['replace']('%name%',_0x274ba0));if(_0x4d68b9['length']===0x0)throw new not_found_error_1[(_0x881d33(0x186))](_0x881d33(0x1b1)+_0x274ba0+_0x881d33(0x162));const _0x4702fb=_0x4d68b9[_0x881d33(0x183)](_0x3bfcbc=>_0x3bfcbc[constants_1[_0x881d33(0x194)]+_0x881d33(0x16e)]===_0x274ba0);if(!_0x4702fb)throw new not_found_error_1[(_0x881d33(0x186))](_0x881d33(0x1b1)+_0x274ba0+_0x881d33(0x162));return flosum_repository_sync_dto_1[_0x881d33(0x159)]['fromBranchRecord'](_0x4702fb);}async[a204_0x553b85(0x167)](_0x49901e){const _0x786143=a204_0x553b85,_0x24e07b=await this[_0x786143(0x189)][_0x786143(0x197)](queries_1[_0x786143(0x185)][_0x786143(0x168)](_0x786143(0x19f),_0x49901e));if(_0x24e07b[_0x786143(0x169)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20'+_0x49901e+_0x786143(0x162));return flosum_repository_sync_dto_1[_0x786143(0x159)][_0x786143(0x182)](_0x24e07b[0x0]);}async[a204_0x553b85(0x192)](_0x374aa7){const _0x176be7=a204_0x553b85,_0x234eaf='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x176be7(0x19c)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x374aa7+'\x27';return this[_0x176be7(0x19d)](_0x234eaf);}async[a204_0x553b85(0x1af)](_0x345e5b){const _0x2f164f=a204_0x553b85,_0x235d34=_0x2f164f(0x195)+queries_1[_0x2f164f(0x19c)]+_0x2f164f(0x1ac)+_0x345e5b+'\x27';return this[_0x2f164f(0x19d)](_0x235d34);}async[a204_0x553b85(0x18a)](_0x305c03){const _0x239dfd=a204_0x553b85;var _0x12c376;const _0x3d5f0b=queries_1[_0x239dfd(0x163)]['replace'](_0x239dfd(0x17c),_0x305c03[_0x239dfd(0x18f)])[_0x239dfd(0x168)](_0x239dfd(0x19f),_0x305c03[_0x239dfd(0x17b)]?constants_1[_0x239dfd(0x18e)]:constants_1[_0x239dfd(0x19b)]),_0xc2daf=await this['salesforceQuery'][_0x239dfd(0x197)](_0x3d5f0b),_0x5b7759=(_0x12c376=_0xc2daf[0x0])===null||_0x12c376===void 0x0?void 0x0:_0x12c376['Id'];if(!_0x5b7759)throw new Error(errors_1[_0x239dfd(0x17d)]);return _0x5b7759;}async['getRemoteStateAttachmentId'](_0xafe9c1){const _0x962fc2=a204_0x553b85;let _0x3bad0e=await this['getAttachmentId'](_0xafe9c1)['catch'](()=>null);return!_0x3bad0e&&(_0x3bad0e=await this[_0x962fc2(0x17e)]['createObject']('Attachment',{'Body':(0x0,utils_1[_0x962fc2(0x184)])('{}'),'ParentId':_0xafe9c1[_0x962fc2(0x18f)],'ContentType':_0x962fc2(0x187),'Name':_0xafe9c1[_0x962fc2(0x17b)]?constants_1[_0x962fc2(0x18e)]:constants_1[_0x962fc2(0x19b)]})),_0x3bad0e;}async['updateRemoteState'](_0xd2f31e,_0x547745){const _0x4a3500=a204_0x553b85,_0x890d17=await this[_0x4a3500(0x18d)](_0xd2f31e);await this[_0x4a3500(0x17e)][_0x4a3500(0x190)](_0x4a3500(0x1aa),_0x890d17,{'Body':(0x0,utils_1[_0x4a3500(0x184)])(JSON[_0x4a3500(0x188)](_0x547745))});}async[a204_0x553b85(0x1a7)](_0x44938c,_0x1ac7a2){const _0x470f77=a204_0x553b85;await this['salesforceService'][_0x470f77(0x190)](_0x44938c[_0x470f77(0x15e)],_0x44938c[_0x470f77(0x18f)],{[constants_1[_0x470f77(0x1a8)]+'Synchronization_Status__c']:_0x1ac7a2});}async[a204_0x553b85(0x1a4)](_0x266de6){const _0x1919fb=a204_0x553b85;await this['salesforceService']['patchObject'](constants_1['FLOSUM_GIT_NAMESPACE']+_0x1919fb(0x193),_0x266de6,{[constants_1[_0x1919fb(0x1a8)]+'Sync_In_Progress__c']:![]});}};function a204_0x4776(_0x563f87,_0x791edd){const _0x522fb1=a204_0x22f9();return a204_0x4776=function(_0x37186c,_0x947d72){_0x37186c=_0x37186c-0x158;let _0x22f96b=_0x522fb1[_0x37186c];return _0x22f96b;},a204_0x4776(_0x563f87,_0x791edd);}SalesforceSyncService=__decorate([(0x0,typedi_1[a204_0x553b85(0x177)])(),__metadata(a204_0x553b85(0x19e),[salesforce_query_service_1[a204_0x553b85(0x199)],salesforce_service_1[a204_0x553b85(0x172)]])],SalesforceSyncService),exports[a204_0x553b85(0x15d)]=SalesforceSyncService;function a204_0x22f9(){const _0x7d3092=['1018740qFyiaE','Service','1759470SVeLSk','defineProperty','decorate','repositoryId','%parentId%','ERR_INVALID_ATTACHMENT_ID','salesforceService','Components__r','GET_WAITING_REPOSITORIES_QUERY','../dto/flosum-repository-sync.dto','fromRepositoryRecord','find','encodeBase64','GET_REPOSITORY_BY_NAME_QUERY','SalesforceNotFoundError','text/plain','stringify','salesforceQuery','getAttachmentId','search','GET_BRANCH_QUERY','getRemoteStateAttachmentId','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','objectId','patchObject','4404cpSFyu','getComponentsFromRepository','Connection__c','FLOSUM_NAMESPACE','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','GET_REPOSITORY_QUERY','query','./salesforce.service','SalesforceQueryService','getAllRepositoryNames','SYNC_ATTACHMENT_FOR_BRANCH_NAME','GET_COMPONENTS_QUERY','getComponents','design:paramtypes','%name%','getBranchRecordByName','252640DcTJZu','records','getBranchRecord','disableSync','9615108vppDJb','constructor','setStatus','FLOSUM_GIT_NAMESPACE','215664algbak','Attachment','__metadata','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','1004gqJYmc','(((.+)+)+)+$','getBranchComponents','1692stgPZq','Branch\x20','object','FlosumRepositorySyncDto','./salesforce-query.service','fromBranchRecord','GET_REPOSITORIES_NAMES_QUERY','SalesforceSyncService','objectType','253qaAUoS','apply','__decorate','\x20not\x20found\x20on\x20salesforce','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','10952fZzwKK','getRepositoryRecords','../queries','getRepositoryRecordByName','replace','length','Repository\x20with\x20Id\x20','../../../../constants','typedi','../../../shared/utils','Branch_Name__c','1jUyHzS','Name','63gtwDZR','SalesforceService','function','map','metadata'];a204_0x22f9=function(){return _0x7d3092;};return a204_0x22f9();}