const a205_0xe5649a=a205_0x564c;(function(_0x31dd1d,_0x53b21a){const _0x184473=a205_0x564c,_0x260f5f=_0x31dd1d();while(!![]){try{const _0x556810=parseInt(_0x184473(0x20e))/0x1*(parseInt(_0x184473(0x204))/0x2)+-parseInt(_0x184473(0x1f7))/0x3+parseInt(_0x184473(0x22f))/0x4+-parseInt(_0x184473(0x206))/0x5+-parseInt(_0x184473(0x223))/0x6+-parseInt(_0x184473(0x207))/0x7+-parseInt(_0x184473(0x205))/0x8*(-parseInt(_0x184473(0x203))/0x9);if(_0x556810===_0x53b21a)break;else _0x260f5f['push'](_0x260f5f['shift']());}catch(_0x4cf154){_0x260f5f['push'](_0x260f5f['shift']());}}}(a205_0x4157,0xe6bb8));const a205_0x4cdf15=(function(){let _0x23fe6b=!![];return function(_0x161ad6,_0x2b42b4){const _0x2d3806=_0x23fe6b?function(){const _0x13cb9f=a205_0x564c;if(_0x2b42b4){const _0x5c1f17=_0x2b42b4[_0x13cb9f(0x1ea)](_0x161ad6,arguments);return _0x2b42b4=null,_0x5c1f17;}}:function(){};return _0x23fe6b=![],_0x2d3806;};}()),a205_0x22cb65=a205_0x4cdf15(this,function(){const _0xcb0d54=a205_0x564c;return a205_0x22cb65[_0xcb0d54(0x212)]()[_0xcb0d54(0x22d)](_0xcb0d54(0x1f5))['toString']()['constructor'](a205_0x22cb65)['search'](_0xcb0d54(0x1f5));});a205_0x22cb65();'use strict';var __decorate=this&&this[a205_0xe5649a(0x1e7)]||function(_0x2341a3,_0x1ec769,_0x19c4f5,_0x106a77){const _0x4dacda=a205_0xe5649a;var _0x19b12a=arguments[_0x4dacda(0x23b)],_0x5a8222=_0x19b12a<0x3?_0x1ec769:_0x106a77===null?_0x106a77=Object['getOwnPropertyDescriptor'](_0x1ec769,_0x19c4f5):_0x106a77,_0x46864b;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x4dacda(0x226))_0x5a8222=Reflect[_0x4dacda(0x219)](_0x2341a3,_0x1ec769,_0x19c4f5,_0x106a77);else{for(var _0x3f89ef=_0x2341a3[_0x4dacda(0x23b)]-0x1;_0x3f89ef>=0x0;_0x3f89ef--)if(_0x46864b=_0x2341a3[_0x3f89ef])_0x5a8222=(_0x19b12a<0x3?_0x46864b(_0x5a8222):_0x19b12a>0x3?_0x46864b(_0x1ec769,_0x19c4f5,_0x5a8222):_0x46864b(_0x1ec769,_0x19c4f5))||_0x5a8222;}return _0x19b12a>0x3&&_0x5a8222&&Object[_0x4dacda(0x234)](_0x1ec769,_0x19c4f5,_0x5a8222),_0x5a8222;},__metadata=this&&this['__metadata']||function(_0x4c2d81,_0x385dfd){const _0x230788=a205_0xe5649a;if(typeof Reflect===_0x230788(0x1ec)&&typeof Reflect[_0x230788(0x222)]==='function')return Reflect[_0x230788(0x222)](_0x4c2d81,_0x385dfd);};Object['defineProperty'](exports,a205_0xe5649a(0x217),{'value':!![]}),exports[a205_0xe5649a(0x209)]=void 0x0;const typedi_1=require(a205_0xe5649a(0x23a)),constants_1=require(a205_0xe5649a(0x227)),errors_1=require('../../../../constants/errors'),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a205_0xe5649a(0x1f9)),not_found_error_1=require(a205_0xe5649a(0x1fd)),queries_1=require(a205_0xe5649a(0x211)),salesforce_query_service_1=require(a205_0xe5649a(0x238)),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0xceaa10,_0x3ce5b4){const _0x5b5a05=a205_0xe5649a;this['salesforceQuery']=_0xceaa10,this[_0x5b5a05(0x218)]=_0x3ce5b4;}async[a205_0xe5649a(0x22e)](_0x24eb58){const _0x2cdf96=a205_0xe5649a;var _0x3dbd45;const _0x2de62f=await this[_0x2cdf96(0x231)][_0x2cdf96(0x201)](_0x24eb58),_0x7ebb0b=[];for(const _0x3f8a4d of _0x2de62f){const _0x3b75dc=(_0x3dbd45=_0x3f8a4d[constants_1[_0x2cdf96(0x1fe)]+'Components__r'])===null||_0x3dbd45===void 0x0?void 0x0:_0x3dbd45[_0x2cdf96(0x200)];_0x3b75dc&&_0x3b75dc[_0x2cdf96(0x23b)]&&_0x7ebb0b['push'](_0x3b75dc[0x0]['Id']);}return _0x7ebb0b;}async[a205_0xe5649a(0x1f4)](_0x3607dc){const _0x5aa982=a205_0xe5649a,_0x28760c=await this[_0x5aa982(0x231)][_0x5aa982(0x201)](queries_1['GET_REPOSITORIES_NAMES_QUERY'][_0x5aa982(0x1fb)](/\%connection_id\%/g,_0x3607dc));return _0x28760c[_0x5aa982(0x229)](_0x5bc144=>{const _0xb459c4=_0x5aa982;return _0x5bc144[constants_1[_0xb459c4(0x21c)]+_0xb459c4(0x235)]?_0x5bc144[constants_1[_0xb459c4(0x21c)]+_0xb459c4(0x235)]['Name']:_0x5bc144['Name'];});}async[a205_0xe5649a(0x239)](_0xad06e9){const _0x136ce6=a205_0xe5649a,_0x1b3a77=await this[_0x136ce6(0x231)]['query'](queries_1['GET_WAITING_REPOSITORIES_QUERY'][_0x136ce6(0x1fb)](/\%connection_id\%/g,_0xad06e9));return _0x1b3a77['map'](_0x5e1320=>flosum_repository_sync_dto_1[_0x136ce6(0x22c)][_0x136ce6(0x1ff)](_0x5e1320));}async[a205_0xe5649a(0x1f0)](_0x41ae3d){const _0x29dbb6=a205_0xe5649a,_0x477fb8=await this['salesforceQuery'][_0x29dbb6(0x201)](queries_1[_0x29dbb6(0x22b)][_0x29dbb6(0x1fb)](/%repositories_ids\%/g,_0x41ae3d));return _0x477fb8[_0x29dbb6(0x229)](_0x7322c1=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x29dbb6(0x213)](_0x7322c1));}async[a205_0xe5649a(0x1f6)](_0x18af08){const _0x20b735=a205_0xe5649a,_0x1a418b=await this[_0x20b735(0x231)][_0x20b735(0x201)](queries_1[_0x20b735(0x225)][_0x20b735(0x1fb)](_0x20b735(0x202),_0x18af08));if(_0x1a418b[_0x20b735(0x23b)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x20b735(0x1e8)+_0x18af08+_0x20b735(0x1f3));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x1a418b[0x0]);}async[a205_0xe5649a(0x214)](_0x24bc85){const _0x4524f6=a205_0xe5649a,_0x359f07=await this[_0x4524f6(0x231)]['query'](queries_1[_0x4524f6(0x215)]['replace'](_0x4524f6(0x202),_0x24bc85));if(_0x359f07[_0x4524f6(0x23b)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x4524f6(0x1eb)+_0x24bc85+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x4524f6(0x22c)][_0x4524f6(0x213)](_0x359f07[0x0]);}async[a205_0xe5649a(0x230)](_0x1968c6){const _0x56cc60=a205_0xe5649a,_0x31bd8e=await this[_0x56cc60(0x231)][_0x56cc60(0x201)](queries_1[_0x56cc60(0x21b)]['replace']('%name%',_0x1968c6));if(_0x31bd8e[_0x56cc60(0x23b)]===0x0)throw new not_found_error_1[(_0x56cc60(0x21a))]('Branch\x20'+_0x1968c6+'\x20not\x20found\x20on\x20salesforce');const _0x4960b4=_0x31bd8e['find'](_0xf85872=>_0xf85872[constants_1[_0x56cc60(0x1fe)]+'Branch_Name__c']===_0x1968c6);if(!_0x4960b4)throw new not_found_error_1[(_0x56cc60(0x21a))]('Branch\x20'+_0x1968c6+_0x56cc60(0x1f3));return flosum_repository_sync_dto_1[_0x56cc60(0x22c)]['fromBranchRecord'](_0x4960b4);}async[a205_0xe5649a(0x21d)](_0x3c5eb8){const _0x36d1e7=a205_0xe5649a,_0x2ac8a3=await this[_0x36d1e7(0x231)][_0x36d1e7(0x201)](queries_1[_0x36d1e7(0x236)][_0x36d1e7(0x1fb)](_0x36d1e7(0x208),_0x3c5eb8));if(_0x2ac8a3[_0x36d1e7(0x23b)]===0x0)throw new not_found_error_1[(_0x36d1e7(0x21a))](_0x36d1e7(0x221)+_0x3c5eb8+_0x36d1e7(0x1f3));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x2ac8a3[0x0]);}async['getComponentsFromRepository'](_0x3289eb){const _0x2e99b1=a205_0xe5649a,_0x684ecb=_0x2e99b1(0x233)+queries_1[_0x2e99b1(0x20a)]+_0x2e99b1(0x21f)+_0x3289eb+'\x27';return this[_0x2e99b1(0x22e)](_0x684ecb);}async[a205_0xe5649a(0x220)](_0x4a7f2e){const _0x41967c=a205_0xe5649a,_0x5dee94=_0x41967c(0x20d)+queries_1[_0x41967c(0x20a)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x4a7f2e+'\x27';return this[_0x41967c(0x22e)](_0x5dee94);}async[a205_0xe5649a(0x1f8)](_0x1fcc3b){const _0x2bf9f5=a205_0xe5649a;var _0x5d8530;const _0x40b7ff=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x2bf9f5(0x1fb)](_0x2bf9f5(0x20c),_0x1fcc3b['objectId'])[_0x2bf9f5(0x1fb)](_0x2bf9f5(0x208),_0x1fcc3b[_0x2bf9f5(0x1f1)]?constants_1[_0x2bf9f5(0x1fa)]:constants_1[_0x2bf9f5(0x1e5)]),_0x29b32e=await this[_0x2bf9f5(0x231)][_0x2bf9f5(0x201)](_0x40b7ff),_0x5c6105=(_0x5d8530=_0x29b32e[0x0])===null||_0x5d8530===void 0x0?void 0x0:_0x5d8530['Id'];if(!_0x5c6105)throw new Error(errors_1[_0x2bf9f5(0x1e4)]);return _0x5c6105;}async[a205_0xe5649a(0x1e9)](_0x32214d){const _0x2ce9c6=a205_0xe5649a;let _0x174e10=await this['getAttachmentId'](_0x32214d)[_0x2ce9c6(0x237)](()=>null);return!_0x174e10&&(_0x174e10=await this[_0x2ce9c6(0x218)][_0x2ce9c6(0x216)](_0x2ce9c6(0x20b),{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x32214d['objectId'],'ContentType':_0x2ce9c6(0x210),'Name':_0x32214d[_0x2ce9c6(0x1f1)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x2ce9c6(0x1e5)]})),_0x174e10;}async[a205_0xe5649a(0x228)](_0x77f413,_0x59614c){const _0x2d0605=a205_0xe5649a,_0x265b3b=await this[_0x2d0605(0x1e9)](_0x77f413);await this[_0x2d0605(0x218)][_0x2d0605(0x20f)]('Attachment',_0x265b3b,{'Body':(0x0,utils_1[_0x2d0605(0x1ed)])(JSON[_0x2d0605(0x21e)](_0x59614c))});}async['setStatus'](_0x7cff75,_0xd4e919){const _0x8f1ebe=a205_0xe5649a;await this[_0x8f1ebe(0x218)][_0x8f1ebe(0x20f)](_0x7cff75[_0x8f1ebe(0x1ee)],_0x7cff75['objectId'],{[constants_1[_0x8f1ebe(0x21c)]+_0x8f1ebe(0x1fc)]:_0xd4e919});}async[a205_0xe5649a(0x22a)](_0xdd1ebd){const _0x3d7ab0=a205_0xe5649a;await this[_0x3d7ab0(0x218)]['patchObject'](constants_1['FLOSUM_GIT_NAMESPACE']+_0x3d7ab0(0x224),_0xdd1ebd,{[constants_1[_0x3d7ab0(0x21c)]+_0x3d7ab0(0x1e6)]:![]});}};function a205_0x564c(_0x495969,_0x5dbb0b){const _0x21490b=a205_0x4157();return a205_0x564c=function(_0x22cb65,_0x4cdf15){_0x22cb65=_0x22cb65-0x1e4;let _0x415798=_0x21490b[_0x22cb65];return _0x415798;},a205_0x564c(_0x495969,_0x5dbb0b);}function a205_0x4157(){const _0x25454b=['11762149YVaaQM','%name%','SalesforceSyncService','GET_COMPONENTS_QUERY','Attachment','%parentId%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','1479477asxCiN','patchObject','text/plain','../queries','toString','fromBranchRecord','getBranchRecord','GET_BRANCH_QUERY','createObject','__esModule','salesforceService','decorate','SalesforceNotFoundError','GET_BRANCH_BY_NAME_QUERY','FLOSUM_GIT_NAMESPACE','getRepositoryRecordByName','stringify','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','getBranchComponents','Repository\x20','metadata','2349570JSsEox','Connection__c','GET_REPOSITORY_QUERY','function','../../../../constants','updateRemoteState','map','disableSync','GET_WAITING_BRANCHES_QUERY','FlosumRepositorySyncDto','search','getComponents','4125296bHxMer','getBranchRecordByName','salesforceQuery','Service','\x0a\x20\x20\x20\x20\x20\x20','defineProperty','Repository__r','GET_REPOSITORY_BY_NAME_QUERY','catch','./salesforce-query.service','getRepositoryRecords','typedi','length','ERR_INVALID_ATTACHMENT_ID','SYNC_ATTACHMENT_FOR_BRANCH_NAME','Sync_In_Progress__c','__decorate','Repository\x20with\x20Id\x20','getRemoteStateAttachmentId','apply','Branch\x20with\x20Id\x20','object','encodeBase64','objectType','design:paramtypes','getBranchRecords','repositoryId','SalesforceService','\x20not\x20found\x20on\x20salesforce','getAllRepositoryNames','(((.+)+)+)+$','getRepositoryRecord','3538572lqwgdo','getAttachmentId','../dto/flosum-repository-sync.dto','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','replace','Synchronization_Status__c','../errors/not-found.error','FLOSUM_NAMESPACE','fromRepositoryRecord','records','query','%id%','926622iYvSbA','2pqGXwx','248WRRonL','7529965zoJgeM'];a205_0x4157=function(){return _0x25454b;};return a205_0x4157();}SalesforceSyncService=__decorate([(0x0,typedi_1[a205_0xe5649a(0x232)])(),__metadata(a205_0xe5649a(0x1ef),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a205_0xe5649a(0x1f2)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;