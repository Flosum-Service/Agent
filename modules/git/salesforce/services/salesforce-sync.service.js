const a282_0x3a000f=a282_0x1589;function a282_0x1589(_0x3b94b6,_0x423dec){const _0x34ca1b=a282_0x525b();return a282_0x1589=function(_0x27b862,_0xdb2918){_0x27b862=_0x27b862-0x10a;let _0x525bac=_0x34ca1b[_0x27b862];return _0x525bac;},a282_0x1589(_0x3b94b6,_0x423dec);}(function(_0x5e1d3f,_0x4774d7){const _0x41c9a1=a282_0x1589,_0x35c317=_0x5e1d3f();while(!![]){try{const _0x235cc3=-parseInt(_0x41c9a1(0x136))/0x1*(parseInt(_0x41c9a1(0x129))/0x2)+-parseInt(_0x41c9a1(0x133))/0x3+parseInt(_0x41c9a1(0x146))/0x4*(parseInt(_0x41c9a1(0x144))/0x5)+parseInt(_0x41c9a1(0x148))/0x6+parseInt(_0x41c9a1(0x12b))/0x7*(-parseInt(_0x41c9a1(0x14a))/0x8)+parseInt(_0x41c9a1(0x125))/0x9+-parseInt(_0x41c9a1(0x113))/0xa;if(_0x235cc3===_0x4774d7)break;else _0x35c317['push'](_0x35c317['shift']());}catch(_0x431d8a){_0x35c317['push'](_0x35c317['shift']());}}}(a282_0x525b,0xb1558));const a282_0xdb2918=(function(){let _0x132da6=!![];return function(_0xa733a4,_0x2f9865){const _0x250708=_0x132da6?function(){const _0x2f9dc9=a282_0x1589;if(_0x2f9865){const _0x1f558b=_0x2f9865[_0x2f9dc9(0x140)](_0xa733a4,arguments);return _0x2f9865=null,_0x1f558b;}}:function(){};return _0x132da6=![],_0x250708;};}()),a282_0x27b862=a282_0xdb2918(this,function(){const _0x60bbac=a282_0x1589;return a282_0x27b862['toString']()['search'](_0x60bbac(0x12f))[_0x60bbac(0x14d)]()[_0x60bbac(0x132)](a282_0x27b862)[_0x60bbac(0x157)](_0x60bbac(0x12f));});a282_0x27b862();'use strict';var __decorate=this&&this['__decorate']||function(_0x2d4014,_0x586786,_0x44ac5f,_0x83a9f0){const _0x17f5c2=a282_0x1589;var _0xc3ff3a=arguments[_0x17f5c2(0x13d)],_0x257246=_0xc3ff3a<0x3?_0x586786:_0x83a9f0===null?_0x83a9f0=Object[_0x17f5c2(0x163)](_0x586786,_0x44ac5f):_0x83a9f0,_0x471015;if(typeof Reflect===_0x17f5c2(0x111)&&typeof Reflect[_0x17f5c2(0x135)]===_0x17f5c2(0x110))_0x257246=Reflect['decorate'](_0x2d4014,_0x586786,_0x44ac5f,_0x83a9f0);else{for(var _0x30f7b8=_0x2d4014[_0x17f5c2(0x13d)]-0x1;_0x30f7b8>=0x0;_0x30f7b8--)if(_0x471015=_0x2d4014[_0x30f7b8])_0x257246=(_0xc3ff3a<0x3?_0x471015(_0x257246):_0xc3ff3a>0x3?_0x471015(_0x586786,_0x44ac5f,_0x257246):_0x471015(_0x586786,_0x44ac5f))||_0x257246;}return _0xc3ff3a>0x3&&_0x257246&&Object[_0x17f5c2(0x139)](_0x586786,_0x44ac5f,_0x257246),_0x257246;},__metadata=this&&this[a282_0x3a000f(0x149)]||function(_0x4e2169,_0x15472b){const _0x35130d=a282_0x3a000f;if(typeof Reflect==='object'&&typeof Reflect[_0x35130d(0x14b)]===_0x35130d(0x110))return Reflect['metadata'](_0x4e2169,_0x15472b);};Object[a282_0x3a000f(0x139)](exports,a282_0x3a000f(0x147),{'value':!![]}),exports[a282_0x3a000f(0x13b)]=void 0x0;const typedi_1=require(a282_0x3a000f(0x153)),constants_1=require('../../../../constants'),errors_1=require(a282_0x3a000f(0x127)),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a282_0x3a000f(0x119)),salesforce_query_service_1=require(a282_0x3a000f(0x11d)),salesforce_service_1=require(a282_0x3a000f(0x14c));function a282_0x525b(){const _0x4c0a58=['__metadata','1864ulQQnD','metadata','./salesforce.service','toString','SalesforceService','setStatus','map','Synchronization_Status__c','Sync_In_Progress__c','typedi','Repository\x20with\x20Id\x20','Repository\x20','updateRemoteState','search','disableSync','Components__r','GET_REPOSITORY_QUERY','getRepositoryRecordByName','FLOSUM_GIT_NAMESPACE','\x0a\x20\x20\x20\x20\x20\x20','repositoryId','fromRepositoryRecord','\x20not\x20found\x20on\x20salesforce','Connection__c','Branch\x20','getOwnPropertyDescriptor','getComponents','getBranchRecordByName','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','getRepositoryRecords','records','getRepositoryRecord','Name','function','object','Branch\x20with\x20Id\x20','7916680dJUeCg','%id%','objectId','getRemoteStateAttachmentId','replace','patchObject','../queries','SYNC_ATTACHMENT_FOR_BRANCH_NAME','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getComponentsFromRepository','./salesforce-query.service','FlosumRepositorySyncDto','getBranchRecords','salesforceQuery','GET_REPOSITORIES_NAMES_QUERY','GET_WAITING_REPOSITORIES_QUERY','Branch_Name__c','query','9130689KlUCQJ','fromBranchRecord','../../../../constants/errors','GET_BRANCH_BY_NAME_QUERY','6ukPOZQ','getBranchRecord','26537xVjJAF','getAllRepositoryNames','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','Repository__r','(((.+)+)+)+$','%parentId%','GET_COMPONENTS_QUERY','constructor','2225028HXZnPb','objectType','decorate','183731wXaLgM','salesforceService','Service','defineProperty','%name%','SalesforceSyncService','SalesforceQueryService','length','stringify','encodeBase64','apply','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','SalesforceNotFoundError','Attachment','14015gzSfxi','getAttachmentId','2048HAdnSP','__esModule','7467258HgsRvA'];a282_0x525b=function(){return _0x4c0a58;};return a282_0x525b();}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x20e2c2,_0x220fe8){const _0x126613=a282_0x3a000f;this[_0x126613(0x120)]=_0x20e2c2,this[_0x126613(0x137)]=_0x220fe8;}async[a282_0x3a000f(0x164)](_0x3bb39e){const _0x3c0808=a282_0x3a000f;var _0x44dd45;const _0x143235=await this['salesforceQuery']['query'](_0x3bb39e),_0x3def4a=[];for(const _0x4bee8e of _0x143235){const _0x37bdda=(_0x44dd45=_0x4bee8e[constants_1['FLOSUM_NAMESPACE']+_0x3c0808(0x159)])===null||_0x44dd45===void 0x0?void 0x0:_0x44dd45[_0x3c0808(0x10d)];_0x37bdda&&_0x37bdda[_0x3c0808(0x13d)]&&_0x3def4a['push'](_0x37bdda[0x0]['Id']);}return _0x3def4a;}async[a282_0x3a000f(0x12c)](_0xed8a14){const _0x433911=a282_0x3a000f,_0x2919fb=await this[_0x433911(0x120)][_0x433911(0x124)](queries_1[_0x433911(0x121)][_0x433911(0x117)](/\%connection_id\%/g,_0xed8a14));return _0x2919fb['map'](_0x2496de=>{const _0x23f665=_0x433911;return _0x2496de[constants_1[_0x23f665(0x15c)]+_0x23f665(0x12e)]?_0x2496de[constants_1['FLOSUM_GIT_NAMESPACE']+'Repository__r'][_0x23f665(0x10f)]:_0x2496de['Name'];});}async[a282_0x3a000f(0x10c)](_0x1d54ea){const _0x4127a4=a282_0x3a000f,_0x300ad0=await this['salesforceQuery'][_0x4127a4(0x124)](queries_1[_0x4127a4(0x122)][_0x4127a4(0x117)](/\%connection_id\%/g,_0x1d54ea));return _0x300ad0[_0x4127a4(0x150)](_0x5ced7a=>flosum_repository_sync_dto_1[_0x4127a4(0x11e)]['fromRepositoryRecord'](_0x5ced7a));}async[a282_0x3a000f(0x11f)](_0x4919ad){const _0xd56cc2=a282_0x3a000f,_0x2e72c8=await this[_0xd56cc2(0x120)][_0xd56cc2(0x124)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0xd56cc2(0x117)](/%repositories_ids\%/g,_0x4919ad));return _0x2e72c8[_0xd56cc2(0x150)](_0x57b68b=>flosum_repository_sync_dto_1[_0xd56cc2(0x11e)][_0xd56cc2(0x126)](_0x57b68b));}async[a282_0x3a000f(0x10e)](_0x425433){const _0x1ba1db=a282_0x3a000f,_0x41acc6=await this[_0x1ba1db(0x120)][_0x1ba1db(0x124)](queries_1[_0x1ba1db(0x15a)][_0x1ba1db(0x117)]('%id%',_0x425433));if(_0x41acc6[_0x1ba1db(0x13d)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x1ba1db(0x154)+_0x425433+_0x1ba1db(0x160));return flosum_repository_sync_dto_1[_0x1ba1db(0x11e)]['fromRepositoryRecord'](_0x41acc6[0x0]);}async[a282_0x3a000f(0x12a)](_0x510535){const _0x144e55=a282_0x3a000f,_0x490b03=await this[_0x144e55(0x120)]['query'](queries_1['GET_BRANCH_QUERY'][_0x144e55(0x117)](_0x144e55(0x114),_0x510535));if(_0x490b03[_0x144e55(0x13d)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x144e55(0x112)+_0x510535+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x144e55(0x11e)][_0x144e55(0x126)](_0x490b03[0x0]);}async[a282_0x3a000f(0x10a)](_0x365770){const _0x40c0bd=a282_0x3a000f,_0x1fd313=await this[_0x40c0bd(0x120)][_0x40c0bd(0x124)](queries_1[_0x40c0bd(0x128)][_0x40c0bd(0x117)](_0x40c0bd(0x13a),_0x365770));if(_0x1fd313[_0x40c0bd(0x13d)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x40c0bd(0x162)+_0x365770+_0x40c0bd(0x160));const _0x13e7ba=_0x1fd313['find'](_0x237fa2=>_0x237fa2[constants_1['FLOSUM_NAMESPACE']+_0x40c0bd(0x123)]===_0x365770);if(!_0x13e7ba)throw new not_found_error_1[(_0x40c0bd(0x142))](_0x40c0bd(0x162)+_0x365770+_0x40c0bd(0x160));return flosum_repository_sync_dto_1[_0x40c0bd(0x11e)][_0x40c0bd(0x126)](_0x13e7ba);}async[a282_0x3a000f(0x15b)](_0x3a0d2c){const _0xc30994=a282_0x3a000f,_0x5d786b=await this['salesforceQuery'][_0xc30994(0x124)](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0xc30994(0x117)](_0xc30994(0x13a),_0x3a0d2c));if(_0x5d786b['length']===0x0)throw new not_found_error_1[(_0xc30994(0x142))](_0xc30994(0x155)+_0x3a0d2c+_0xc30994(0x160));return flosum_repository_sync_dto_1[_0xc30994(0x11e)][_0xc30994(0x15f)](_0x5d786b[0x0]);}async[a282_0x3a000f(0x11c)](_0xec3d1c){const _0x268a55=a282_0x3a000f,_0x361924=_0x268a55(0x15d)+queries_1[_0x268a55(0x131)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0xec3d1c+'\x27';return this[_0x268a55(0x164)](_0x361924);}async['getBranchComponents'](_0x152722){const _0x4c5baa=a282_0x3a000f,_0x2cce45=_0x4c5baa(0x11b)+queries_1[_0x4c5baa(0x131)]+_0x4c5baa(0x141)+_0x152722+'\x27';return this[_0x4c5baa(0x164)](_0x2cce45);}async[a282_0x3a000f(0x145)](_0x3cd75d){const _0x49e008=a282_0x3a000f;var _0x197803;const _0x1e1980=queries_1[_0x49e008(0x10b)][_0x49e008(0x117)](_0x49e008(0x130),_0x3cd75d[_0x49e008(0x115)])[_0x49e008(0x117)](_0x49e008(0x13a),_0x3cd75d[_0x49e008(0x15e)]?constants_1[_0x49e008(0x12d)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x534342=await this[_0x49e008(0x120)][_0x49e008(0x124)](_0x1e1980),_0x198743=(_0x197803=_0x534342[0x0])===null||_0x197803===void 0x0?void 0x0:_0x197803['Id'];if(!_0x198743)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x198743;}async[a282_0x3a000f(0x116)](_0x55bdfb){const _0x8052cd=a282_0x3a000f;let _0x5677ff=await this[_0x8052cd(0x145)](_0x55bdfb)['catch'](()=>null);return!_0x5677ff&&(_0x5677ff=await this[_0x8052cd(0x137)]['createObject'](_0x8052cd(0x143),{'Body':(0x0,utils_1[_0x8052cd(0x13f)])('{}'),'ParentId':_0x55bdfb[_0x8052cd(0x115)],'ContentType':'text/plain','Name':_0x55bdfb['repositoryId']?constants_1[_0x8052cd(0x12d)]:constants_1[_0x8052cd(0x11a)]})),_0x5677ff;}async[a282_0x3a000f(0x156)](_0x52ae80,_0x5598b1){const _0x3c6de5=a282_0x3a000f,_0x5d93ce=await this[_0x3c6de5(0x116)](_0x52ae80);await this['salesforceService'][_0x3c6de5(0x118)](_0x3c6de5(0x143),_0x5d93ce,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0x3c6de5(0x13e)](_0x5598b1))});}async[a282_0x3a000f(0x14f)](_0x5cab53,_0x44e99e){const _0x5bcaf0=a282_0x3a000f;await this[_0x5bcaf0(0x137)][_0x5bcaf0(0x118)](_0x5cab53[_0x5bcaf0(0x134)],_0x5cab53[_0x5bcaf0(0x115)],{[constants_1[_0x5bcaf0(0x15c)]+_0x5bcaf0(0x151)]:_0x44e99e});}async[a282_0x3a000f(0x158)](_0x478c25){const _0x54a639=a282_0x3a000f;await this[_0x54a639(0x137)][_0x54a639(0x118)](constants_1[_0x54a639(0x15c)]+_0x54a639(0x161),_0x478c25,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x54a639(0x152)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a282_0x3a000f(0x138)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a282_0x3a000f(0x13c)],salesforce_service_1[a282_0x3a000f(0x14e)]])],SalesforceSyncService),exports[a282_0x3a000f(0x13b)]=SalesforceSyncService;