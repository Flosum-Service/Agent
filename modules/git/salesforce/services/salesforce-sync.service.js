const a253_0x4c90fa=a253_0x4be0;(function(_0x33e821,_0x2fb556){const _0x8abdcb=a253_0x4be0,_0x28f1db=_0x33e821();while(!![]){try{const _0x10b2ab=-parseInt(_0x8abdcb(0xff))/0x1*(-parseInt(_0x8abdcb(0xd5))/0x2)+-parseInt(_0x8abdcb(0xd3))/0x3*(-parseInt(_0x8abdcb(0xb3))/0x4)+parseInt(_0x8abdcb(0xdb))/0x5+parseInt(_0x8abdcb(0xe4))/0x6+-parseInt(_0x8abdcb(0xef))/0x7+-parseInt(_0x8abdcb(0xc2))/0x8*(-parseInt(_0x8abdcb(0xb9))/0x9)+-parseInt(_0x8abdcb(0xfe))/0xa;if(_0x10b2ab===_0x2fb556)break;else _0x28f1db['push'](_0x28f1db['shift']());}catch(_0x4f11d8){_0x28f1db['push'](_0x28f1db['shift']());}}}(a253_0x3290,0xad368));const a253_0x2fc913=(function(){let _0x2d171c=!![];return function(_0x4bf450,_0x144a8b){const _0x5cb70d=_0x2d171c?function(){if(_0x144a8b){const _0x5ab6f3=_0x144a8b['apply'](_0x4bf450,arguments);return _0x144a8b=null,_0x5ab6f3;}}:function(){};return _0x2d171c=![],_0x5cb70d;};}()),a253_0x366a36=a253_0x2fc913(this,function(){const _0x5cc81c=a253_0x4be0;return a253_0x366a36[_0x5cc81c(0x100)]()['search'](_0x5cc81c(0xf0))[_0x5cc81c(0x100)]()[_0x5cc81c(0xfa)](a253_0x366a36)[_0x5cc81c(0xfd)](_0x5cc81c(0xf0));});a253_0x366a36();'use strict';var __decorate=this&&this[a253_0x4c90fa(0xec)]||function(_0x397a08,_0x22d44b,_0x17f22c,_0x4bf6ad){const _0x58efbb=a253_0x4c90fa;var _0x3ff35a=arguments[_0x58efbb(0xc8)],_0x4c9ca2=_0x3ff35a<0x3?_0x22d44b:_0x4bf6ad===null?_0x4bf6ad=Object['getOwnPropertyDescriptor'](_0x22d44b,_0x17f22c):_0x4bf6ad,_0x3880fa;if(typeof Reflect===_0x58efbb(0xe6)&&typeof Reflect[_0x58efbb(0xfc)]===_0x58efbb(0xc0))_0x4c9ca2=Reflect[_0x58efbb(0xfc)](_0x397a08,_0x22d44b,_0x17f22c,_0x4bf6ad);else{for(var _0x5389a6=_0x397a08[_0x58efbb(0xc8)]-0x1;_0x5389a6>=0x0;_0x5389a6--)if(_0x3880fa=_0x397a08[_0x5389a6])_0x4c9ca2=(_0x3ff35a<0x3?_0x3880fa(_0x4c9ca2):_0x3ff35a>0x3?_0x3880fa(_0x22d44b,_0x17f22c,_0x4c9ca2):_0x3880fa(_0x22d44b,_0x17f22c))||_0x4c9ca2;}return _0x3ff35a>0x3&&_0x4c9ca2&&Object['defineProperty'](_0x22d44b,_0x17f22c,_0x4c9ca2),_0x4c9ca2;},__metadata=this&&this[a253_0x4c90fa(0xe9)]||function(_0x207744,_0x2a6f71){const _0x1521cf=a253_0x4c90fa;if(typeof Reflect===_0x1521cf(0xe6)&&typeof Reflect['metadata']===_0x1521cf(0xc0))return Reflect[_0x1521cf(0xaf)](_0x207744,_0x2a6f71);};Object[a253_0x4c90fa(0xc4)](exports,'__esModule',{'value':!![]}),exports[a253_0x4c90fa(0xfb)]=void 0x0;const typedi_1=require(a253_0x4c90fa(0xf5)),constants_1=require(a253_0x4c90fa(0xc7)),errors_1=require(a253_0x4c90fa(0xe2)),utils_1=require(a253_0x4c90fa(0xde)),flosum_repository_sync_dto_1=require(a253_0x4c90fa(0xf6)),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a253_0x4c90fa(0xd4)),salesforce_query_service_1=require(a253_0x4c90fa(0xf8)),salesforce_service_1=require(a253_0x4c90fa(0x104));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x281fdb,_0x52d530){const _0x57756=a253_0x4c90fa;this[_0x57756(0xdf)]=_0x281fdb,this[_0x57756(0xf3)]=_0x52d530;}async[a253_0x4c90fa(0xbc)](_0x1c4f6e){const _0x232996=a253_0x4c90fa;var _0x432dfc;const _0x4884a7=await this[_0x232996(0xdf)]['query'](_0x1c4f6e),_0x16ef7c=[];for(const _0x4e7d38 of _0x4884a7){const _0x3b0cc5=(_0x432dfc=_0x4e7d38[constants_1[_0x232996(0xcf)]+_0x232996(0xd6)])===null||_0x432dfc===void 0x0?void 0x0:_0x432dfc[_0x232996(0xc9)];_0x3b0cc5&&_0x3b0cc5[_0x232996(0xc8)]&&_0x16ef7c['push'](_0x3b0cc5[0x0]['Id']);}return _0x16ef7c;}async['getAllRepositoryNames'](_0x5e589f){const _0x4aac06=a253_0x4c90fa,_0x49c82b=await this[_0x4aac06(0xdf)][_0x4aac06(0xd0)](queries_1[_0x4aac06(0xc3)][_0x4aac06(0xf7)](/\%connection_id\%/g,_0x5e589f));return _0x49c82b[_0x4aac06(0xeb)](_0xc570f7=>{const _0x3b2a49=_0x4aac06;return _0xc570f7[constants_1[_0x3b2a49(0xd9)]+_0x3b2a49(0xda)]?_0xc570f7[constants_1['FLOSUM_GIT_NAMESPACE']+_0x3b2a49(0xda)][_0x3b2a49(0xd1)]:_0xc570f7[_0x3b2a49(0xd1)];});}async[a253_0x4c90fa(0xe0)](_0x3128ff){const _0x561c5a=a253_0x4c90fa,_0x3b675c=await this[_0x561c5a(0xdf)]['query'](queries_1[_0x561c5a(0xb6)][_0x561c5a(0xf7)](/\%connection_id\%/g,_0x3128ff));return _0x3b675c[_0x561c5a(0xeb)](_0x2f4d3e=>flosum_repository_sync_dto_1[_0x561c5a(0xc1)][_0x561c5a(0xbb)](_0x2f4d3e));}async['getBranchRecords'](_0x486a18){const _0x11337f=a253_0x4c90fa,_0x4e491f=await this[_0x11337f(0xdf)]['query'](queries_1[_0x11337f(0xf1)][_0x11337f(0xf7)](/%repositories_ids\%/g,_0x486a18));return _0x4e491f[_0x11337f(0xeb)](_0x1e494b=>flosum_repository_sync_dto_1[_0x11337f(0xc1)][_0x11337f(0xb5)](_0x1e494b));}async[a253_0x4c90fa(0xb2)](_0x3cb644){const _0x5639eb=a253_0x4c90fa,_0x1b036d=await this[_0x5639eb(0xdf)][_0x5639eb(0xd0)](queries_1[_0x5639eb(0xcc)]['replace'](_0x5639eb(0xc5),_0x3cb644));if(_0x1b036d[_0x5639eb(0xc8)]===0x0)throw new not_found_error_1[(_0x5639eb(0xce))](_0x5639eb(0xad)+_0x3cb644+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x5639eb(0xc1)]['fromRepositoryRecord'](_0x1b036d[0x0]);}async[a253_0x4c90fa(0xe8)](_0x2e465f){const _0x48bf5e=a253_0x4c90fa,_0x4accb7=await this[_0x48bf5e(0xdf)][_0x48bf5e(0xd0)](queries_1[_0x48bf5e(0x101)][_0x48bf5e(0xf7)](_0x48bf5e(0xc5),_0x2e465f));if(_0x4accb7[_0x48bf5e(0xc8)]===0x0)throw new not_found_error_1[(_0x48bf5e(0xce))](_0x48bf5e(0xc6)+_0x2e465f+_0x48bf5e(0xee));return flosum_repository_sync_dto_1[_0x48bf5e(0xc1)][_0x48bf5e(0xb5)](_0x4accb7[0x0]);}async['getBranchRecordByName'](_0x3e4ce4){const _0x35b80d=a253_0x4c90fa,_0xb5ef07=await this[_0x35b80d(0xdf)][_0x35b80d(0xd0)](queries_1[_0x35b80d(0x103)][_0x35b80d(0xf7)](_0x35b80d(0xb1),_0x3e4ce4));if(_0xb5ef07[_0x35b80d(0xc8)]===0x0)throw new not_found_error_1[(_0x35b80d(0xce))](_0x35b80d(0xe7)+_0x3e4ce4+_0x35b80d(0xee));const _0x54946d=_0xb5ef07[_0x35b80d(0xd2)](_0x12a999=>_0x12a999[constants_1['FLOSUM_NAMESPACE']+_0x35b80d(0xf9)]===_0x3e4ce4);if(!_0x54946d)throw new not_found_error_1[(_0x35b80d(0xce))](_0x35b80d(0xe7)+_0x3e4ce4+_0x35b80d(0xee));return flosum_repository_sync_dto_1[_0x35b80d(0xc1)]['fromBranchRecord'](_0x54946d);}async[a253_0x4c90fa(0xcb)](_0x4b259d){const _0x3111b9=a253_0x4c90fa,_0x2c188e=await this['salesforceQuery']['query'](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x3111b9(0xf7)]('%name%',_0x4b259d));if(_0x2c188e[_0x3111b9(0xc8)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20'+_0x4b259d+_0x3111b9(0xee));return flosum_repository_sync_dto_1[_0x3111b9(0xc1)][_0x3111b9(0xbb)](_0x2c188e[0x0]);}async[a253_0x4c90fa(0xae)](_0x5aa481){const _0x116b72=a253_0x4c90fa,_0x211118=_0x116b72(0xb4)+queries_1['GET_COMPONENTS_QUERY']+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x5aa481+'\x27';return this[_0x116b72(0xbc)](_0x211118);}async['getBranchComponents'](_0x254bae){const _0x48295f=a253_0x4c90fa,_0x3d612a=_0x48295f(0xd8)+queries_1[_0x48295f(0xb8)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x254bae+'\x27';return this['getComponents'](_0x3d612a);}async[a253_0x4c90fa(0xf2)](_0x773a84){const _0x581784=a253_0x4c90fa;var _0x115540;const _0x270a04=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x581784(0xf7)](_0x581784(0xe3),_0x773a84['objectId'])[_0x581784(0xf7)](_0x581784(0xb1),_0x773a84[_0x581784(0xf4)]?constants_1[_0x581784(0xbf)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x55cccc=await this[_0x581784(0xdf)][_0x581784(0xd0)](_0x270a04),_0x447f96=(_0x115540=_0x55cccc[0x0])===null||_0x115540===void 0x0?void 0x0:_0x115540['Id'];if(!_0x447f96)throw new Error(errors_1[_0x581784(0xbd)]);return _0x447f96;}async['getRemoteStateAttachmentId'](_0x1eb1de){const _0x96417f=a253_0x4c90fa;let _0x1b6bce=await this[_0x96417f(0xf2)](_0x1eb1de)['catch'](()=>null);return!_0x1b6bce&&(_0x1b6bce=await this[_0x96417f(0xf3)][_0x96417f(0xba)]('Attachment',{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x1eb1de[_0x96417f(0xd7)],'ContentType':_0x96417f(0xb0),'Name':_0x1eb1de[_0x96417f(0xf4)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x1b6bce;}async[a253_0x4c90fa(0xb7)](_0x34e2a3,_0x584575){const _0x2de602=a253_0x4c90fa,_0x40690b=await this[_0x2de602(0x106)](_0x34e2a3);await this[_0x2de602(0xf3)]['patchObject']('Attachment',_0x40690b,{'Body':(0x0,utils_1[_0x2de602(0xed)])(JSON[_0x2de602(0xe1)](_0x584575))});}async[a253_0x4c90fa(0xac)](_0x44e95f,_0x5f135d){const _0x4edba0=a253_0x4c90fa;await this[_0x4edba0(0xf3)][_0x4edba0(0xdd)](_0x44e95f[_0x4edba0(0xdc)],_0x44e95f[_0x4edba0(0xd7)],{[constants_1[_0x4edba0(0xd9)]+_0x4edba0(0xcd)]:_0x5f135d});}async[a253_0x4c90fa(0xe5)](_0x5d91c6){const _0xe14a32=a253_0x4c90fa;await this[_0xe14a32(0xf3)]['patchObject'](constants_1[_0xe14a32(0xd9)]+_0xe14a32(0x102),_0x5d91c6,{[constants_1[_0xe14a32(0xd9)]+_0xe14a32(0xbe)]:![]});}};function a253_0x4be0(_0x3dec36,_0x14736e){const _0x1827be=a253_0x3290();return a253_0x4be0=function(_0x366a36,_0x2fc913){_0x366a36=_0x366a36-0xac;let _0x329007=_0x1827be[_0x366a36];return _0x329007;},a253_0x4be0(_0x3dec36,_0x14736e);}SalesforceSyncService=__decorate([(0x0,typedi_1[a253_0x4c90fa(0x105)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a253_0x4c90fa(0xca)],salesforce_service_1[a253_0x4c90fa(0xea)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;function a253_0x3290(){const _0x48272c=['function','FlosumRepositorySyncDto','2134416SLkESN','GET_REPOSITORIES_NAMES_QUERY','defineProperty','%id%','Branch\x20with\x20Id\x20','../../../../constants','length','records','SalesforceQueryService','getRepositoryRecordByName','GET_REPOSITORY_QUERY','Synchronization_Status__c','SalesforceNotFoundError','FLOSUM_NAMESPACE','query','Name','find','504774tnBpUl','../queries','258fHukiH','Components__r','objectId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','FLOSUM_GIT_NAMESPACE','Repository__r','3392770ZjuOSH','objectType','patchObject','../../../shared/utils','salesforceQuery','getRepositoryRecords','stringify','../../../../constants/errors','%parentId%','7413612JRkaPw','disableSync','object','Branch\x20','getBranchRecord','__metadata','SalesforceService','map','__decorate','encodeBase64','\x20not\x20found\x20on\x20salesforce','100464FXupPT','(((.+)+)+)+$','GET_WAITING_BRANCHES_QUERY','getAttachmentId','salesforceService','repositoryId','typedi','../dto/flosum-repository-sync.dto','replace','./salesforce-query.service','Branch_Name__c','constructor','SalesforceSyncService','decorate','search','33394100WnqdUH','5778vZNkSO','toString','GET_BRANCH_QUERY','Connection__c','GET_BRANCH_BY_NAME_QUERY','./salesforce.service','Service','getRemoteStateAttachmentId','setStatus','Repository\x20with\x20Id\x20','getComponentsFromRepository','metadata','text/plain','%name%','getRepositoryRecord','8ZrVpnt','\x0a\x20\x20\x20\x20\x20\x20','fromBranchRecord','GET_WAITING_REPOSITORIES_QUERY','updateRemoteState','GET_COMPONENTS_QUERY','36Ncxkeg','createObject','fromRepositoryRecord','getComponents','ERR_INVALID_ATTACHMENT_ID','Sync_In_Progress__c','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME'];a253_0x3290=function(){return _0x48272c;};return a253_0x3290();}