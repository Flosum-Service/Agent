const a191_0x5e870e=a191_0x12f7;(function(_0x52a676,_0x505f6c){const _0x8aa233=a191_0x12f7,_0xca522f=_0x52a676();while(!![]){try{const _0x4dbd9d=parseInt(_0x8aa233(0x16d))/0x1+-parseInt(_0x8aa233(0x137))/0x2*(-parseInt(_0x8aa233(0x140))/0x3)+-parseInt(_0x8aa233(0x139))/0x4*(parseInt(_0x8aa233(0x12a))/0x5)+-parseInt(_0x8aa233(0x122))/0x6*(parseInt(_0x8aa233(0x126))/0x7)+-parseInt(_0x8aa233(0x12f))/0x8+-parseInt(_0x8aa233(0x13f))/0x9+-parseInt(_0x8aa233(0x15e))/0xa*(-parseInt(_0x8aa233(0x175))/0xb);if(_0x4dbd9d===_0x505f6c)break;else _0xca522f['push'](_0xca522f['shift']());}catch(_0x1436f7){_0xca522f['push'](_0xca522f['shift']());}}}(a191_0x397c,0xe43e1));const a191_0x21fc4a=(function(){let _0x1fc59f=!![];return function(_0xcbb491,_0x1a0feb){const _0x4296e0=_0x1fc59f?function(){const _0x19c17=a191_0x12f7;if(_0x1a0feb){const _0x4e719e=_0x1a0feb[_0x19c17(0x14a)](_0xcbb491,arguments);return _0x1a0feb=null,_0x4e719e;}}:function(){};return _0x1fc59f=![],_0x4296e0;};}()),a191_0x11d41a=a191_0x21fc4a(this,function(){const _0x1ab70c=a191_0x12f7;return a191_0x11d41a[_0x1ab70c(0x147)]()['search'](_0x1ab70c(0x13b))[_0x1ab70c(0x147)]()[_0x1ab70c(0x14c)](a191_0x11d41a)['search']('(((.+)+)+)+$');});function a191_0x397c(){const _0x3ca1ef=['9zxzNJN','Branch_Name__c','%parentId%','GET_COMPONENTS_QUERY','createObject','../../../../constants/errors','\x20not\x20found\x20on\x20salesforce','toString','%name%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','apply','Synchronization_Status__c','constructor','FlosumRepositorySyncDto','Connection__c','../queries','salesforceQuery','defineProperty','replace','ERR_INVALID_ATTACHMENT_ID','repositoryId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','metadata','decorate','design:paramtypes','fromBranchRecord','Service','\x0a\x20\x20\x20\x20\x20\x20','find','length','1300weHBEt','object','../errors/not-found.error','map','disableSync','query','./salesforce-query.service','getRepositoryRecord','Repository\x20with\x20Id\x20','fromRepositoryRecord','function','../../../shared/utils','objectType','Name','SYNC_ATTACHMENT_FOR_BRANCH_NAME','964239JhzsAl','__esModule','patchObject','SalesforceQueryService','objectId','GET_BRANCH_BY_NAME_QUERY','Sync_In_Progress__c','typedi','125169nNTNgv','GET_WAITING_BRANCHES_QUERY','salesforceService','text/plain','getRepositoryRecords','records','getAttachmentId','stringify','catch','GET_REPOSITORIES_NAMES_QUERY','getComponents','SalesforceSyncService','2099616YeRbSi','encodeBase64','getAllRepositoryNames','GET_REPOSITORY_QUERY','21LeSqLB','%id%','Repository__r','getComponentsFromRepository','145pIZSUj','getBranchRecordByName','getBranchComponents','__metadata','Branch\x20with\x20Id\x20','4980648NEGUmZ','getRepositoryRecordByName','Components__r','getBranchRecord','../../../../constants','FLOSUM_GIT_NAMESPACE','__decorate','./salesforce.service','698078IjUKPJ','Attachment','83036AKYvnX','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','(((.+)+)+)+$','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','SalesforceNotFoundError','getRemoteStateAttachmentId','2532105kNcRMd'];a191_0x397c=function(){return _0x3ca1ef;};return a191_0x397c();}a191_0x11d41a();'use strict';var __decorate=this&&this[a191_0x5e870e(0x135)]||function(_0x31bbc6,_0x149a70,_0x44d79a,_0x1f5a10){const _0x3c64ab=a191_0x5e870e;var _0x5764f4=arguments[_0x3c64ab(0x15d)],_0x5edc20=_0x5764f4<0x3?_0x149a70:_0x1f5a10===null?_0x1f5a10=Object['getOwnPropertyDescriptor'](_0x149a70,_0x44d79a):_0x1f5a10,_0xb37b74;if(typeof Reflect===_0x3c64ab(0x15f)&&typeof Reflect[_0x3c64ab(0x157)]===_0x3c64ab(0x168))_0x5edc20=Reflect[_0x3c64ab(0x157)](_0x31bbc6,_0x149a70,_0x44d79a,_0x1f5a10);else{for(var _0x2e0bd2=_0x31bbc6['length']-0x1;_0x2e0bd2>=0x0;_0x2e0bd2--)if(_0xb37b74=_0x31bbc6[_0x2e0bd2])_0x5edc20=(_0x5764f4<0x3?_0xb37b74(_0x5edc20):_0x5764f4>0x3?_0xb37b74(_0x149a70,_0x44d79a,_0x5edc20):_0xb37b74(_0x149a70,_0x44d79a))||_0x5edc20;}return _0x5764f4>0x3&&_0x5edc20&&Object[_0x3c64ab(0x151)](_0x149a70,_0x44d79a,_0x5edc20),_0x5edc20;},__metadata=this&&this[a191_0x5e870e(0x12d)]||function(_0x593e95,_0x45557d){const _0x5c3d0c=a191_0x5e870e;if(typeof Reflect===_0x5c3d0c(0x15f)&&typeof Reflect[_0x5c3d0c(0x156)]===_0x5c3d0c(0x168))return Reflect['metadata'](_0x593e95,_0x45557d);};Object[a191_0x5e870e(0x151)](exports,a191_0x5e870e(0x16e),{'value':!![]}),exports[a191_0x5e870e(0x121)]=void 0x0;const typedi_1=require(a191_0x5e870e(0x174)),constants_1=require(a191_0x5e870e(0x133)),errors_1=require(a191_0x5e870e(0x145)),utils_1=require(a191_0x5e870e(0x169)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a191_0x5e870e(0x160)),queries_1=require(a191_0x5e870e(0x14f)),salesforce_query_service_1=require(a191_0x5e870e(0x164)),salesforce_service_1=require(a191_0x5e870e(0x136));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x3269d1,_0x1cd74f){const _0x55788d=a191_0x5e870e;this[_0x55788d(0x150)]=_0x3269d1,this[_0x55788d(0x177)]=_0x1cd74f;}async['getComponents'](_0x4862cb){const _0x31c888=a191_0x5e870e;var _0x5dc2a7;const _0xcb6d8e=await this[_0x31c888(0x150)][_0x31c888(0x163)](_0x4862cb),_0x1e42d4=[];for(const _0x571b55 of _0xcb6d8e){const _0x139ab9=(_0x5dc2a7=_0x571b55[constants_1['FLOSUM_NAMESPACE']+_0x31c888(0x131)])===null||_0x5dc2a7===void 0x0?void 0x0:_0x5dc2a7[_0x31c888(0x17a)];_0x139ab9&&_0x139ab9[_0x31c888(0x15d)]&&_0x1e42d4['push'](_0x139ab9[0x0]['Id']);}return _0x1e42d4;}async[a191_0x5e870e(0x124)](_0x388c59){const _0x1a0a8c=a191_0x5e870e,_0x20fd6e=await this[_0x1a0a8c(0x150)][_0x1a0a8c(0x163)](queries_1[_0x1a0a8c(0x17e)][_0x1a0a8c(0x152)](/\%connection_id\%/g,_0x388c59));return _0x20fd6e[_0x1a0a8c(0x161)](_0x109e62=>{const _0x118cfb=_0x1a0a8c;return _0x109e62[constants_1['FLOSUM_GIT_NAMESPACE']+_0x118cfb(0x128)]?_0x109e62[constants_1[_0x118cfb(0x134)]+_0x118cfb(0x128)][_0x118cfb(0x16b)]:_0x109e62[_0x118cfb(0x16b)];});}async[a191_0x5e870e(0x179)](_0x5bff49){const _0x59a046=a191_0x5e870e,_0x5845b7=await this[_0x59a046(0x150)][_0x59a046(0x163)](queries_1['GET_WAITING_REPOSITORIES_QUERY']['replace'](/\%connection_id\%/g,_0x5bff49));return _0x5845b7[_0x59a046(0x161)](_0x3e8d79=>flosum_repository_sync_dto_1[_0x59a046(0x14d)][_0x59a046(0x167)](_0x3e8d79));}async['getBranchRecords'](_0x313fd4){const _0x301e2a=a191_0x5e870e,_0x2dccb3=await this['salesforceQuery'][_0x301e2a(0x163)](queries_1[_0x301e2a(0x176)]['replace'](/%repositories_ids\%/g,_0x313fd4));return _0x2dccb3['map'](_0x28da4e=>flosum_repository_sync_dto_1[_0x301e2a(0x14d)]['fromBranchRecord'](_0x28da4e));}async[a191_0x5e870e(0x165)](_0x44932d){const _0x5c8ccb=a191_0x5e870e,_0xa52226=await this[_0x5c8ccb(0x150)][_0x5c8ccb(0x163)](queries_1[_0x5c8ccb(0x125)][_0x5c8ccb(0x152)](_0x5c8ccb(0x127),_0x44932d));if(_0xa52226[_0x5c8ccb(0x15d)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x5c8ccb(0x166)+_0x44932d+_0x5c8ccb(0x146));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0xa52226[0x0]);}async[a191_0x5e870e(0x132)](_0x3bffe3){const _0x194b2=a191_0x5e870e,_0x780e90=await this['salesforceQuery'][_0x194b2(0x163)](queries_1['GET_BRANCH_QUERY'][_0x194b2(0x152)](_0x194b2(0x127),_0x3bffe3));if(_0x780e90[_0x194b2(0x15d)]===0x0)throw new not_found_error_1[(_0x194b2(0x13d))](_0x194b2(0x12e)+_0x3bffe3+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x194b2(0x14d)][_0x194b2(0x159)](_0x780e90[0x0]);}async[a191_0x5e870e(0x12b)](_0x5a10e5){const _0x539541=a191_0x5e870e,_0x2ffa3b=await this[_0x539541(0x150)]['query'](queries_1[_0x539541(0x172)][_0x539541(0x152)](_0x539541(0x148),_0x5a10e5));if(_0x2ffa3b['length']===0x0)throw new not_found_error_1[(_0x539541(0x13d))]('Branch\x20'+_0x5a10e5+_0x539541(0x146));const _0x1a4232=_0x2ffa3b[_0x539541(0x15c)](_0xd577af=>_0xd577af[constants_1['FLOSUM_NAMESPACE']+_0x539541(0x141)]===_0x5a10e5);if(!_0x1a4232)throw new not_found_error_1[(_0x539541(0x13d))]('Branch\x20'+_0x5a10e5+_0x539541(0x146));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x539541(0x159)](_0x1a4232);}async[a191_0x5e870e(0x130)](_0x1d5f64){const _0x382c8a=a191_0x5e870e,_0x707805=await this[_0x382c8a(0x150)][_0x382c8a(0x163)](queries_1['GET_REPOSITORY_BY_NAME_QUERY']['replace']('%name%',_0x1d5f64));if(_0x707805[_0x382c8a(0x15d)]===0x0)throw new not_found_error_1[(_0x382c8a(0x13d))]('Repository\x20'+_0x1d5f64+_0x382c8a(0x146));return flosum_repository_sync_dto_1[_0x382c8a(0x14d)][_0x382c8a(0x167)](_0x707805[0x0]);}async[a191_0x5e870e(0x129)](_0x429060){const _0x21b029=a191_0x5e870e,_0x57d5ba=_0x21b029(0x15b)+queries_1[_0x21b029(0x143)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x429060+'\x27';return this[_0x21b029(0x120)](_0x57d5ba);}async[a191_0x5e870e(0x12c)](_0x213895){const _0x56ac84=a191_0x5e870e,_0x62eae9=_0x56ac84(0x155)+queries_1[_0x56ac84(0x143)]+_0x56ac84(0x149)+_0x213895+'\x27';return this[_0x56ac84(0x120)](_0x62eae9);}async[a191_0x5e870e(0x17b)](_0x3c4622){const _0x4ab28f=a191_0x5e870e;var _0x98274f;const _0x8e16c4=queries_1[_0x4ab28f(0x13a)][_0x4ab28f(0x152)](_0x4ab28f(0x142),_0x3c4622[_0x4ab28f(0x171)])[_0x4ab28f(0x152)](_0x4ab28f(0x148),_0x3c4622[_0x4ab28f(0x154)]?constants_1[_0x4ab28f(0x13c)]:constants_1[_0x4ab28f(0x16c)]),_0x12d7c8=await this['salesforceQuery'][_0x4ab28f(0x163)](_0x8e16c4),_0x1d1fc2=(_0x98274f=_0x12d7c8[0x0])===null||_0x98274f===void 0x0?void 0x0:_0x98274f['Id'];if(!_0x1d1fc2)throw new Error(errors_1[_0x4ab28f(0x153)]);return _0x1d1fc2;}async[a191_0x5e870e(0x13e)](_0x51590c){const _0x3eca55=a191_0x5e870e;let _0x9e4da5=await this['getAttachmentId'](_0x51590c)[_0x3eca55(0x17d)](()=>null);return!_0x9e4da5&&(_0x9e4da5=await this[_0x3eca55(0x177)][_0x3eca55(0x144)](_0x3eca55(0x138),{'Body':utils_1[_0x3eca55(0x123)]('{}'),'ParentId':_0x51590c[_0x3eca55(0x171)],'ContentType':_0x3eca55(0x178),'Name':_0x51590c[_0x3eca55(0x154)]?constants_1[_0x3eca55(0x13c)]:constants_1[_0x3eca55(0x16c)]})),_0x9e4da5;}async['updateRemoteState'](_0x263e48,_0x5e7cf2){const _0x15e2a2=a191_0x5e870e,_0x2f3cd4=await this[_0x15e2a2(0x13e)](_0x263e48);await this[_0x15e2a2(0x177)][_0x15e2a2(0x16f)](_0x15e2a2(0x138),_0x2f3cd4,{'Body':utils_1[_0x15e2a2(0x123)](JSON[_0x15e2a2(0x17c)](_0x5e7cf2))});}async['setStatus'](_0x7599d2,_0x4e3404){const _0x1731ec=a191_0x5e870e;await this[_0x1731ec(0x177)][_0x1731ec(0x16f)](_0x7599d2[_0x1731ec(0x16a)],_0x7599d2[_0x1731ec(0x171)],{[constants_1[_0x1731ec(0x134)]+_0x1731ec(0x14b)]:_0x4e3404});}async[a191_0x5e870e(0x162)](_0x9523f5){const _0x4bcb16=a191_0x5e870e;await this[_0x4bcb16(0x177)]['patchObject'](constants_1[_0x4bcb16(0x134)]+_0x4bcb16(0x14e),_0x9523f5,{[constants_1[_0x4bcb16(0x134)]+_0x4bcb16(0x173)]:![]});}};function a191_0x12f7(_0x570c8e,_0x534e0f){const _0xc48b77=a191_0x397c();return a191_0x12f7=function(_0x11d41a,_0x21fc4a){_0x11d41a=_0x11d41a-0x120;let _0x397c7b=_0xc48b77[_0x11d41a];return _0x397c7b;},a191_0x12f7(_0x570c8e,_0x534e0f);}SalesforceSyncService=__decorate([typedi_1[a191_0x5e870e(0x15a)](),__metadata(a191_0x5e870e(0x158),[salesforce_query_service_1[a191_0x5e870e(0x170)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;