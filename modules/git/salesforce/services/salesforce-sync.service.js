const a282_0x30e90d=a282_0x2e5d;(function(_0x5ea4e3,_0x2103d7){const _0x1d2224=a282_0x2e5d,_0x242ba8=_0x5ea4e3();while(!![]){try{const _0x3cbae1=-parseInt(_0x1d2224(0x185))/0x1+-parseInt(_0x1d2224(0x163))/0x2*(-parseInt(_0x1d2224(0x175))/0x3)+-parseInt(_0x1d2224(0x17a))/0x4+parseInt(_0x1d2224(0x15f))/0x5*(parseInt(_0x1d2224(0x180))/0x6)+parseInt(_0x1d2224(0x1a5))/0x7*(-parseInt(_0x1d2224(0x198))/0x8)+-parseInt(_0x1d2224(0x18f))/0x9*(parseInt(_0x1d2224(0x1a2))/0xa)+parseInt(_0x1d2224(0x172))/0xb;if(_0x3cbae1===_0x2103d7)break;else _0x242ba8['push'](_0x242ba8['shift']());}catch(_0x227939){_0x242ba8['push'](_0x242ba8['shift']());}}}(a282_0x1af6,0xa74c4));const a282_0x103171=(function(){let _0x2d7724=!![];return function(_0x4f88ca,_0x5bf826){const _0x4601b0=_0x2d7724?function(){if(_0x5bf826){const _0x54395a=_0x5bf826['apply'](_0x4f88ca,arguments);return _0x5bf826=null,_0x54395a;}}:function(){};return _0x2d7724=![],_0x4601b0;};}()),a282_0x1bc8bd=a282_0x103171(this,function(){const _0x111553=a282_0x2e5d;return a282_0x1bc8bd['toString']()[_0x111553(0x15c)](_0x111553(0x17e))[_0x111553(0x1ae)]()[_0x111553(0x187)](a282_0x1bc8bd)['search'](_0x111553(0x17e));});a282_0x1bc8bd();'use strict';var __decorate=this&&this['__decorate']||function(_0x1d8ac5,_0x25939c,_0x28b0c3,_0x326fe5){const _0x49f4be=a282_0x2e5d;var _0x691913=arguments['length'],_0x2ba5ce=_0x691913<0x3?_0x25939c:_0x326fe5===null?_0x326fe5=Object[_0x49f4be(0x197)](_0x25939c,_0x28b0c3):_0x326fe5,_0x346493;if(typeof Reflect===_0x49f4be(0x19f)&&typeof Reflect[_0x49f4be(0x199)]===_0x49f4be(0x170))_0x2ba5ce=Reflect[_0x49f4be(0x199)](_0x1d8ac5,_0x25939c,_0x28b0c3,_0x326fe5);else{for(var _0x22f493=_0x1d8ac5[_0x49f4be(0x166)]-0x1;_0x22f493>=0x0;_0x22f493--)if(_0x346493=_0x1d8ac5[_0x22f493])_0x2ba5ce=(_0x691913<0x3?_0x346493(_0x2ba5ce):_0x691913>0x3?_0x346493(_0x25939c,_0x28b0c3,_0x2ba5ce):_0x346493(_0x25939c,_0x28b0c3))||_0x2ba5ce;}return _0x691913>0x3&&_0x2ba5ce&&Object['defineProperty'](_0x25939c,_0x28b0c3,_0x2ba5ce),_0x2ba5ce;},__metadata=this&&this[a282_0x30e90d(0x173)]||function(_0x246671,_0x1fd6c7){const _0x51f19a=a282_0x30e90d;if(typeof Reflect==='object'&&typeof Reflect[_0x51f19a(0x1a7)]===_0x51f19a(0x170))return Reflect[_0x51f19a(0x1a7)](_0x246671,_0x1fd6c7);};Object['defineProperty'](exports,a282_0x30e90d(0x15a),{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require(a282_0x30e90d(0x183)),constants_1=require(a282_0x30e90d(0x16d)),errors_1=require(a282_0x30e90d(0x157)),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a282_0x30e90d(0x16e)),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a282_0x30e90d(0x179)),salesforce_query_service_1=require('./salesforce-query.service'),salesforce_service_1=require(a282_0x30e90d(0x15b));function a282_0x1af6(){const _0x39e069=['toString','getRepositoryRecordByName','../../../../constants/errors','Branch\x20','Repository\x20with\x20Id\x20','__esModule','./salesforce.service','search','encodeBase64','Branch_Name__c','2366995hALISI','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','objectType','catch','354196uUCYxS','disableSync','getRepositoryRecords','length','Name','Synchronization_Status__c','FLOSUM_GIT_NAMESPACE','text/plain','repositoryId','SalesforceNotFoundError','../../../../constants','../dto/flosum-repository-sync.dto','%parentId%','function','GET_REPOSITORIES_NAMES_QUERY','29926160AlDAvQ','__metadata','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','15EwXpJs','FLOSUM_NAMESPACE','query','getRepositoryRecord','../queries','3864316yjXZPv','Sync_In_Progress__c','records','getBranchComponents','(((.+)+)+)+$','GET_REPOSITORY_QUERY','12cPzwtf','GET_COMPONENTS_QUERY','setStatus','typedi','createObject','850910YUHyee','ERR_INVALID_ATTACHMENT_ID','constructor','salesforceQuery','GET_WAITING_REPOSITORIES_QUERY','Branch\x20with\x20Id\x20','push','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','%id%','SalesforceQueryService','9xYRbRF','getAttachmentId','FlosumRepositorySyncDto','getComponents','getAllRepositoryNames','Service','replace','SYNC_ATTACHMENT_FOR_BRANCH_NAME','getOwnPropertyDescriptor','136qTJYxJ','decorate','%name%','getBranchRecords','map','\x20not\x20found\x20on\x20salesforce','fromBranchRecord','object','Repository__r','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','9485650DOXLjc','getRemoteStateAttachmentId','find','453782HWAozD','design:paramtypes','metadata','getBranchRecord','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','Attachment','patchObject','GET_WAITING_BRANCHES_QUERY','salesforceService'];a282_0x1af6=function(){return _0x39e069;};return a282_0x1af6();}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x5dadf0,_0x43958f){const _0x455377=a282_0x30e90d;this[_0x455377(0x188)]=_0x5dadf0,this['salesforceService']=_0x43958f;}async['getComponents'](_0x5ada2c){const _0x29096c=a282_0x30e90d;var _0x17c23f;const _0x1d95d6=await this['salesforceQuery'][_0x29096c(0x177)](_0x5ada2c),_0x1ed0ba=[];for(const _0x378f45 of _0x1d95d6){const _0x4dd1e1=(_0x17c23f=_0x378f45[constants_1[_0x29096c(0x176)]+'Components__r'])===null||_0x17c23f===void 0x0?void 0x0:_0x17c23f[_0x29096c(0x17c)];_0x4dd1e1&&_0x4dd1e1[_0x29096c(0x166)]&&_0x1ed0ba[_0x29096c(0x18b)](_0x4dd1e1[0x0]['Id']);}return _0x1ed0ba;}async[a282_0x30e90d(0x193)](_0x16e91b){const _0x485a62=a282_0x30e90d,_0x1d7dc4=await this[_0x485a62(0x188)][_0x485a62(0x177)](queries_1[_0x485a62(0x171)][_0x485a62(0x195)](/\%connection_id\%/g,_0x16e91b));return _0x1d7dc4['map'](_0x47fc5b=>{const _0x233a7e=_0x485a62;return _0x47fc5b[constants_1[_0x233a7e(0x169)]+'Repository__r']?_0x47fc5b[constants_1['FLOSUM_GIT_NAMESPACE']+_0x233a7e(0x1a0)]['Name']:_0x47fc5b[_0x233a7e(0x167)];});}async[a282_0x30e90d(0x165)](_0x5393de){const _0x2bc8bb=a282_0x30e90d,_0x38b2c8=await this[_0x2bc8bb(0x188)][_0x2bc8bb(0x177)](queries_1[_0x2bc8bb(0x189)][_0x2bc8bb(0x195)](/\%connection_id\%/g,_0x5393de));return _0x38b2c8[_0x2bc8bb(0x19c)](_0x3237e0=>flosum_repository_sync_dto_1[_0x2bc8bb(0x191)]['fromRepositoryRecord'](_0x3237e0));}async[a282_0x30e90d(0x19b)](_0x4eb25c){const _0x122574=a282_0x30e90d,_0x420bfb=await this['salesforceQuery'][_0x122574(0x177)](queries_1[_0x122574(0x1ac)]['replace'](/%repositories_ids\%/g,_0x4eb25c));return _0x420bfb[_0x122574(0x19c)](_0x36c73e=>flosum_repository_sync_dto_1[_0x122574(0x191)][_0x122574(0x19e)](_0x36c73e));}async[a282_0x30e90d(0x178)](_0x177e99){const _0x325bf7=a282_0x30e90d,_0xf5a2c0=await this['salesforceQuery'][_0x325bf7(0x177)](queries_1[_0x325bf7(0x17f)][_0x325bf7(0x195)](_0x325bf7(0x18d),_0x177e99));if(_0xf5a2c0[_0x325bf7(0x166)]===0x0)throw new not_found_error_1[(_0x325bf7(0x16c))](_0x325bf7(0x159)+_0x177e99+_0x325bf7(0x19d));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0xf5a2c0[0x0]);}async[a282_0x30e90d(0x1a8)](_0x155611){const _0x435801=a282_0x30e90d,_0x9b2591=await this['salesforceQuery'][_0x435801(0x177)](queries_1['GET_BRANCH_QUERY'][_0x435801(0x195)]('%id%',_0x155611));if(_0x9b2591['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x435801(0x18a)+_0x155611+_0x435801(0x19d));return flosum_repository_sync_dto_1[_0x435801(0x191)][_0x435801(0x19e)](_0x9b2591[0x0]);}async['getBranchRecordByName'](_0x4e2342){const _0x425cdd=a282_0x30e90d,_0x2a32d0=await this[_0x425cdd(0x188)][_0x425cdd(0x177)](queries_1['GET_BRANCH_BY_NAME_QUERY'][_0x425cdd(0x195)](_0x425cdd(0x19a),_0x4e2342));if(_0x2a32d0['length']===0x0)throw new not_found_error_1[(_0x425cdd(0x16c))](_0x425cdd(0x158)+_0x4e2342+_0x425cdd(0x19d));const _0x12c2db=_0x2a32d0[_0x425cdd(0x1a4)](_0x4a7d52=>_0x4a7d52[constants_1[_0x425cdd(0x176)]+_0x425cdd(0x15e)]===_0x4e2342);if(!_0x12c2db)throw new not_found_error_1[(_0x425cdd(0x16c))]('Branch\x20'+_0x4e2342+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x425cdd(0x191)][_0x425cdd(0x19e)](_0x12c2db);}async[a282_0x30e90d(0x1af)](_0xf20a7f){const _0xf9dbed=a282_0x30e90d,_0x4febef=await this[_0xf9dbed(0x188)][_0xf9dbed(0x177)](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0xf9dbed(0x195)](_0xf9dbed(0x19a),_0xf20a7f));if(_0x4febef[_0xf9dbed(0x166)]===0x0)throw new not_found_error_1[(_0xf9dbed(0x16c))]('Repository\x20'+_0xf20a7f+_0xf9dbed(0x19d));return flosum_repository_sync_dto_1[_0xf9dbed(0x191)]['fromRepositoryRecord'](_0x4febef[0x0]);}async['getComponentsFromRepository'](_0x51a8b1){const _0x148b08=a282_0x30e90d,_0x36dc78='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x148b08(0x181)]+_0x148b08(0x18c)+_0x51a8b1+'\x27';return this[_0x148b08(0x192)](_0x36dc78);}async[a282_0x30e90d(0x17d)](_0x16a520){const _0x18f731=a282_0x30e90d,_0x4dc5b1=_0x18f731(0x1a1)+queries_1[_0x18f731(0x181)]+_0x18f731(0x160)+_0x16a520+'\x27';return this['getComponents'](_0x4dc5b1);}async[a282_0x30e90d(0x190)](_0x5bf11e){const _0x4f06ac=a282_0x30e90d;var _0x822e42;const _0x165293=queries_1[_0x4f06ac(0x1a9)]['replace'](_0x4f06ac(0x16f),_0x5bf11e['objectId'])[_0x4f06ac(0x195)]('%name%',_0x5bf11e[_0x4f06ac(0x16b)]?constants_1[_0x4f06ac(0x174)]:constants_1[_0x4f06ac(0x196)]),_0x514665=await this[_0x4f06ac(0x188)][_0x4f06ac(0x177)](_0x165293),_0x2e0d85=(_0x822e42=_0x514665[0x0])===null||_0x822e42===void 0x0?void 0x0:_0x822e42['Id'];if(!_0x2e0d85)throw new Error(errors_1[_0x4f06ac(0x186)]);return _0x2e0d85;}async[a282_0x30e90d(0x1a3)](_0x2a8212){const _0x4ad5f8=a282_0x30e90d;let _0x5ebe6c=await this['getAttachmentId'](_0x2a8212)[_0x4ad5f8(0x162)](()=>null);return!_0x5ebe6c&&(_0x5ebe6c=await this[_0x4ad5f8(0x1ad)][_0x4ad5f8(0x184)]('Attachment',{'Body':(0x0,utils_1[_0x4ad5f8(0x15d)])('{}'),'ParentId':_0x2a8212['objectId'],'ContentType':_0x4ad5f8(0x16a),'Name':_0x2a8212[_0x4ad5f8(0x16b)]?constants_1[_0x4ad5f8(0x174)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x5ebe6c;}async['updateRemoteState'](_0x15c2c1,_0xc22b2d){const _0x4e15af=a282_0x30e90d,_0x45983a=await this[_0x4e15af(0x1a3)](_0x15c2c1);await this[_0x4e15af(0x1ad)]['patchObject'](_0x4e15af(0x1aa),_0x45983a,{'Body':(0x0,utils_1[_0x4e15af(0x15d)])(JSON['stringify'](_0xc22b2d))});}async[a282_0x30e90d(0x182)](_0x1ed740,_0x83f48d){const _0x5a578f=a282_0x30e90d;await this[_0x5a578f(0x1ad)][_0x5a578f(0x1ab)](_0x1ed740[_0x5a578f(0x161)],_0x1ed740['objectId'],{[constants_1[_0x5a578f(0x169)]+_0x5a578f(0x168)]:_0x83f48d});}async[a282_0x30e90d(0x164)](_0x206ad4){const _0x455ee2=a282_0x30e90d;await this[_0x455ee2(0x1ad)][_0x455ee2(0x1ab)](constants_1[_0x455ee2(0x169)]+'Connection__c',_0x206ad4,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x455ee2(0x17b)]:![]});}};function a282_0x2e5d(_0x5d09c7,_0x559bb4){const _0x35d08a=a282_0x1af6();return a282_0x2e5d=function(_0x1bc8bd,_0x103171){_0x1bc8bd=_0x1bc8bd-0x157;let _0x1af6df=_0x35d08a[_0x1bc8bd];return _0x1af6df;},a282_0x2e5d(_0x5d09c7,_0x559bb4);}SalesforceSyncService=__decorate([(0x0,typedi_1[a282_0x30e90d(0x194)])(),__metadata(a282_0x30e90d(0x1a6),[salesforce_query_service_1[a282_0x30e90d(0x18e)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;