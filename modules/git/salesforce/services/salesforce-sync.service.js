const a243_0x24fe64=a243_0x168b;function a243_0x168b(_0x5ac166,_0x91d2ad){const _0x354d3b=a243_0x4ce4();return a243_0x168b=function(_0x24d595,_0x42150b){_0x24d595=_0x24d595-0xee;let _0x4ce488=_0x354d3b[_0x24d595];return _0x4ce488;},a243_0x168b(_0x5ac166,_0x91d2ad);}(function(_0x41d538,_0x1f0ea6){const _0x531b5e=a243_0x168b,_0x2b0543=_0x41d538();while(!![]){try{const _0x296082=parseInt(_0x531b5e(0xf3))/0x1+-parseInt(_0x531b5e(0x148))/0x2+parseInt(_0x531b5e(0x144))/0x3*(parseInt(_0x531b5e(0x12d))/0x4)+parseInt(_0x531b5e(0x114))/0x5+parseInt(_0x531b5e(0x149))/0x6+-parseInt(_0x531b5e(0xf2))/0x7+parseInt(_0x531b5e(0x117))/0x8*(-parseInt(_0x531b5e(0x106))/0x9);if(_0x296082===_0x1f0ea6)break;else _0x2b0543['push'](_0x2b0543['shift']());}catch(_0x5e0092){_0x2b0543['push'](_0x2b0543['shift']());}}}(a243_0x4ce4,0xeede3));const a243_0x42150b=(function(){let _0x3a4f96=!![];return function(_0x3d9c86,_0x5c271f){const _0x56fa71=_0x3a4f96?function(){const _0x21b577=a243_0x168b;if(_0x5c271f){const _0xb12c35=_0x5c271f[_0x21b577(0x14a)](_0x3d9c86,arguments);return _0x5c271f=null,_0xb12c35;}}:function(){};return _0x3a4f96=![],_0x56fa71;};}()),a243_0x24d595=a243_0x42150b(this,function(){const _0x35cd2f=a243_0x168b;return a243_0x24d595[_0x35cd2f(0x11f)]()[_0x35cd2f(0x12a)](_0x35cd2f(0x143))['toString']()[_0x35cd2f(0x126)](a243_0x24d595)[_0x35cd2f(0x12a)](_0x35cd2f(0x143));});a243_0x24d595();'use strict';var __decorate=this&&this[a243_0x24fe64(0x109)]||function(_0x453a76,_0x1c271b,_0x10b712,_0xd1b467){const _0x52e1c1=a243_0x24fe64;var _0xfb3309=arguments[_0x52e1c1(0xf0)],_0x30bea3=_0xfb3309<0x3?_0x1c271b:_0xd1b467===null?_0xd1b467=Object[_0x52e1c1(0xee)](_0x1c271b,_0x10b712):_0xd1b467,_0x4eaa2d;if(typeof Reflect==='object'&&typeof Reflect[_0x52e1c1(0x11b)]===_0x52e1c1(0x122))_0x30bea3=Reflect[_0x52e1c1(0x11b)](_0x453a76,_0x1c271b,_0x10b712,_0xd1b467);else{for(var _0x17e266=_0x453a76['length']-0x1;_0x17e266>=0x0;_0x17e266--)if(_0x4eaa2d=_0x453a76[_0x17e266])_0x30bea3=(_0xfb3309<0x3?_0x4eaa2d(_0x30bea3):_0xfb3309>0x3?_0x4eaa2d(_0x1c271b,_0x10b712,_0x30bea3):_0x4eaa2d(_0x1c271b,_0x10b712))||_0x30bea3;}return _0xfb3309>0x3&&_0x30bea3&&Object[_0x52e1c1(0x125)](_0x1c271b,_0x10b712,_0x30bea3),_0x30bea3;},__metadata=this&&this[a243_0x24fe64(0x137)]||function(_0x38640d,_0xe7656c){const _0x11dddc=a243_0x24fe64;if(typeof Reflect===_0x11dddc(0x119)&&typeof Reflect[_0x11dddc(0x147)]===_0x11dddc(0x122))return Reflect[_0x11dddc(0x147)](_0x38640d,_0xe7656c);};Object['defineProperty'](exports,a243_0x24fe64(0x131),{'value':!![]}),exports[a243_0x24fe64(0x10e)]=void 0x0;const typedi_1=require(a243_0x24fe64(0xf7)),constants_1=require('../../../../constants'),errors_1=require(a243_0x24fe64(0x10c)),utils_1=require('../../../shared/utils'),flosum_repository_sync_dto_1=require(a243_0x24fe64(0x108)),not_found_error_1=require(a243_0x24fe64(0x12b)),queries_1=require(a243_0x24fe64(0x103)),salesforce_query_service_1=require(a243_0x24fe64(0x13c)),salesforce_service_1=require('./salesforce.service');function a243_0x4ce4(){const _0x3c8356=['Repository\x20','find','repositoryId','GET_REPOSITORIES_NAMES_QUERY','8560250SmrOMH','fromRepositoryRecord','Branch\x20with\x20Id\x20','15599632JBGgop','design:paramtypes','object','getRepositoryRecord','decorate','salesforceQuery','FLOSUM_GIT_NAMESPACE','getComponentsFromRepository','toString','query','objectId','function','getRemoteStateAttachmentId','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','defineProperty','constructor','patchObject','stringify','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','search','../errors/not-found.error','SalesforceQueryService','8ZHxsNq','setStatus','GET_REPOSITORY_BY_NAME_QUERY','Synchronization_Status__c','__esModule','Attachment','replace','%name%','Service','Branch_Name__c','__metadata','encodeBase64','catch','SalesforceNotFoundError','getRepositoryRecordByName','./salesforce-query.service','Connection__c','\x20not\x20found\x20on\x20salesforce','Name','Sync_In_Progress__c','GET_WAITING_BRANCHES_QUERY','%id%','(((.+)+)+)+$','2893281rOsEBh','SYNC_ATTACHMENT_FOR_BRANCH_NAME','SalesforceService','metadata','3112866uvjNLC','7282380tTRvDE','apply','Branch\x20','GET_REPOSITORY_QUERY','getOwnPropertyDescriptor','GET_WAITING_REPOSITORIES_QUERY','length','\x0a\x20\x20\x20\x20\x20\x20','6736282vAqUKI','592482lmIqop','getBranchRecords','getAllRepositoryNames','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','typedi','Components__r','Repository__r','records','getBranchRecordByName','getComponents','disableSync','fromBranchRecord','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','getAttachmentId','FLOSUM_NAMESPACE','../queries','FlosumRepositorySyncDto','salesforceService','9KolGdB','getBranchRecord','../dto/flosum-repository-sync.dto','__decorate','getBranchComponents','%parentId%','../../../../constants/errors','GET_COMPONENTS_QUERY','SalesforceSyncService','map'];a243_0x4ce4=function(){return _0x3c8356;};return a243_0x4ce4();}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x5f32ef,_0x67114b){this['salesforceQuery']=_0x5f32ef,this['salesforceService']=_0x67114b;}async[a243_0x24fe64(0xfc)](_0x44474b){const _0x174c98=a243_0x24fe64;var _0x4c03b7;const _0x2c4f03=await this['salesforceQuery'][_0x174c98(0x120)](_0x44474b),_0x22b4c2=[];for(const _0x347e29 of _0x2c4f03){const _0x163edf=(_0x4c03b7=_0x347e29[constants_1[_0x174c98(0x102)]+_0x174c98(0xf8)])===null||_0x4c03b7===void 0x0?void 0x0:_0x4c03b7[_0x174c98(0xfa)];_0x163edf&&_0x163edf['length']&&_0x22b4c2['push'](_0x163edf[0x0]['Id']);}return _0x22b4c2;}async[a243_0x24fe64(0xf5)](_0x545b4c){const _0x2b7931=a243_0x24fe64,_0x5654bc=await this[_0x2b7931(0x11c)][_0x2b7931(0x120)](queries_1[_0x2b7931(0x113)][_0x2b7931(0x133)](/\%connection_id\%/g,_0x545b4c));return _0x5654bc[_0x2b7931(0x10f)](_0x244130=>{const _0x1f6aba=_0x2b7931;return _0x244130[constants_1[_0x1f6aba(0x11d)]+_0x1f6aba(0xf9)]?_0x244130[constants_1['FLOSUM_GIT_NAMESPACE']+_0x1f6aba(0xf9)][_0x1f6aba(0x13f)]:_0x244130[_0x1f6aba(0x13f)];});}async['getRepositoryRecords'](_0x3ec07c){const _0x3df63e=a243_0x24fe64,_0x3dc359=await this['salesforceQuery'][_0x3df63e(0x120)](queries_1[_0x3df63e(0xef)][_0x3df63e(0x133)](/\%connection_id\%/g,_0x3ec07c));return _0x3dc359[_0x3df63e(0x10f)](_0x28d9dc=>flosum_repository_sync_dto_1[_0x3df63e(0x104)][_0x3df63e(0x115)](_0x28d9dc));}async[a243_0x24fe64(0xf4)](_0x45e2f6){const _0xc0e481=a243_0x24fe64,_0x383f0e=await this[_0xc0e481(0x11c)]['query'](queries_1[_0xc0e481(0x141)][_0xc0e481(0x133)](/%repositories_ids\%/g,_0x45e2f6));return _0x383f0e['map'](_0x2b5081=>flosum_repository_sync_dto_1[_0xc0e481(0x104)][_0xc0e481(0xfe)](_0x2b5081));}async[a243_0x24fe64(0x11a)](_0x33ac2f){const _0x106450=a243_0x24fe64,_0x480df0=await this[_0x106450(0x11c)][_0x106450(0x120)](queries_1[_0x106450(0x14c)][_0x106450(0x133)](_0x106450(0x142),_0x33ac2f));if(_0x480df0[_0x106450(0xf0)]===0x0)throw new not_found_error_1[(_0x106450(0x13a))]('Repository\x20with\x20Id\x20'+_0x33ac2f+_0x106450(0x13e));return flosum_repository_sync_dto_1[_0x106450(0x104)][_0x106450(0x115)](_0x480df0[0x0]);}async[a243_0x24fe64(0x107)](_0x591b74){const _0xee696a=a243_0x24fe64,_0x4b2fa2=await this[_0xee696a(0x11c)][_0xee696a(0x120)](queries_1['GET_BRANCH_QUERY'][_0xee696a(0x133)](_0xee696a(0x142),_0x591b74));if(_0x4b2fa2[_0xee696a(0xf0)]===0x0)throw new not_found_error_1[(_0xee696a(0x13a))](_0xee696a(0x116)+_0x591b74+_0xee696a(0x13e));return flosum_repository_sync_dto_1[_0xee696a(0x104)][_0xee696a(0xfe)](_0x4b2fa2[0x0]);}async[a243_0x24fe64(0xfb)](_0x45dc51){const _0x466f14=a243_0x24fe64,_0x8558b1=await this[_0x466f14(0x11c)][_0x466f14(0x120)](queries_1['GET_BRANCH_BY_NAME_QUERY'][_0x466f14(0x133)](_0x466f14(0x134),_0x45dc51));if(_0x8558b1['length']===0x0)throw new not_found_error_1[(_0x466f14(0x13a))](_0x466f14(0x14b)+_0x45dc51+_0x466f14(0x13e));const _0x11429b=_0x8558b1[_0x466f14(0x111)](_0x530173=>_0x530173[constants_1[_0x466f14(0x102)]+_0x466f14(0x136)]===_0x45dc51);if(!_0x11429b)throw new not_found_error_1[(_0x466f14(0x13a))](_0x466f14(0x14b)+_0x45dc51+_0x466f14(0x13e));return flosum_repository_sync_dto_1[_0x466f14(0x104)][_0x466f14(0xfe)](_0x11429b);}async[a243_0x24fe64(0x13b)](_0x527fa8){const _0xbb6676=a243_0x24fe64,_0x155af6=await this[_0xbb6676(0x11c)][_0xbb6676(0x120)](queries_1[_0xbb6676(0x12f)]['replace'](_0xbb6676(0x134),_0x527fa8));if(_0x155af6[_0xbb6676(0xf0)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0xbb6676(0x110)+_0x527fa8+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0xbb6676(0x104)][_0xbb6676(0x115)](_0x155af6[0x0]);}async[a243_0x24fe64(0x11e)](_0x253724){const _0x4e36e4=a243_0x24fe64,_0x31147d=_0x4e36e4(0xf1)+queries_1[_0x4e36e4(0x10d)]+_0x4e36e4(0xff)+_0x253724+'\x27';return this['getComponents'](_0x31147d);}async[a243_0x24fe64(0x10a)](_0x582837){const _0x13e973=a243_0x24fe64,_0x2c00d8=_0x13e973(0xf6)+queries_1[_0x13e973(0x10d)]+_0x13e973(0x129)+_0x582837+'\x27';return this[_0x13e973(0xfc)](_0x2c00d8);}async[a243_0x24fe64(0x101)](_0x4edf79){const _0x3cbd9f=a243_0x24fe64;var _0x23b073;const _0x1a1c27=queries_1[_0x3cbd9f(0x124)][_0x3cbd9f(0x133)](_0x3cbd9f(0x10b),_0x4edf79['objectId'])[_0x3cbd9f(0x133)](_0x3cbd9f(0x134),_0x4edf79[_0x3cbd9f(0x112)]?constants_1[_0x3cbd9f(0x100)]:constants_1[_0x3cbd9f(0x145)]),_0x542e41=await this[_0x3cbd9f(0x11c)][_0x3cbd9f(0x120)](_0x1a1c27),_0x515bde=(_0x23b073=_0x542e41[0x0])===null||_0x23b073===void 0x0?void 0x0:_0x23b073['Id'];if(!_0x515bde)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x515bde;}async[a243_0x24fe64(0x123)](_0x1cbe76){const _0x3939d1=a243_0x24fe64;let _0x8ca456=await this[_0x3939d1(0x101)](_0x1cbe76)[_0x3939d1(0x139)](()=>null);return!_0x8ca456&&(_0x8ca456=await this['salesforceService']['createObject'](_0x3939d1(0x132),{'Body':(0x0,utils_1[_0x3939d1(0x138)])('{}'),'ParentId':_0x1cbe76['objectId'],'ContentType':'text/plain','Name':_0x1cbe76['repositoryId']?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x3939d1(0x145)]})),_0x8ca456;}async['updateRemoteState'](_0x58dd56,_0x431b95){const _0x18ca25=a243_0x24fe64,_0x140e9a=await this['getRemoteStateAttachmentId'](_0x58dd56);await this[_0x18ca25(0x105)][_0x18ca25(0x127)](_0x18ca25(0x132),_0x140e9a,{'Body':(0x0,utils_1[_0x18ca25(0x138)])(JSON[_0x18ca25(0x128)](_0x431b95))});}async[a243_0x24fe64(0x12e)](_0x4036c6,_0x36b40f){const _0x3b8d1b=a243_0x24fe64;await this['salesforceService'][_0x3b8d1b(0x127)](_0x4036c6['objectType'],_0x4036c6[_0x3b8d1b(0x121)],{[constants_1[_0x3b8d1b(0x11d)]+_0x3b8d1b(0x130)]:_0x36b40f});}async[a243_0x24fe64(0xfd)](_0x405577){const _0x5760f3=a243_0x24fe64;await this['salesforceService']['patchObject'](constants_1['FLOSUM_GIT_NAMESPACE']+_0x5760f3(0x13d),_0x405577,{[constants_1[_0x5760f3(0x11d)]+_0x5760f3(0x140)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a243_0x24fe64(0x135)])(),__metadata(a243_0x24fe64(0x118),[salesforce_query_service_1[a243_0x24fe64(0x12c)],salesforce_service_1[a243_0x24fe64(0x146)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;