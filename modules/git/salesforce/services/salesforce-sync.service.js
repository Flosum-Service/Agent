const a204_0x2f03fd=a204_0x126b;(function(_0x31001a,_0x5a9903){const _0x494da2=a204_0x126b,_0xab465f=_0x31001a();while(!![]){try{const _0x1d5795=-parseInt(_0x494da2(0x150))/0x1*(-parseInt(_0x494da2(0x135))/0x2)+parseInt(_0x494da2(0x140))/0x3+parseInt(_0x494da2(0x14f))/0x4+parseInt(_0x494da2(0x11d))/0x5*(-parseInt(_0x494da2(0x15f))/0x6)+parseInt(_0x494da2(0x15d))/0x7*(-parseInt(_0x494da2(0x153))/0x8)+-parseInt(_0x494da2(0x125))/0x9+parseInt(_0x494da2(0x138))/0xa*(-parseInt(_0x494da2(0x168))/0xb);if(_0x1d5795===_0x5a9903)break;else _0xab465f['push'](_0xab465f['shift']());}catch(_0x28ab53){_0xab465f['push'](_0xab465f['shift']());}}}(a204_0x5b82,0x3d873));const a204_0x2cee92=(function(){let _0x14f67e=!![];return function(_0x1bea2e,_0x34fac2){const _0x4576e6=_0x14f67e?function(){if(_0x34fac2){const _0x2ec210=_0x34fac2['apply'](_0x1bea2e,arguments);return _0x34fac2=null,_0x2ec210;}}:function(){};return _0x14f67e=![],_0x4576e6;};}()),a204_0x45251d=a204_0x2cee92(this,function(){const _0x5dd290=a204_0x126b;return a204_0x45251d[_0x5dd290(0x143)]()['search'](_0x5dd290(0x13a))['toString']()[_0x5dd290(0x16d)](a204_0x45251d)[_0x5dd290(0x12e)](_0x5dd290(0x13a));});a204_0x45251d();'use strict';function a204_0x126b(_0x47c980,_0x54b397){const _0x246ba4=a204_0x5b82();return a204_0x126b=function(_0x45251d,_0x2cee92){_0x45251d=_0x45251d-0x11c;let _0x5b824a=_0x246ba4[_0x45251d];return _0x5b824a;},a204_0x126b(_0x47c980,_0x54b397);}function a204_0x5b82(){const _0x58bc79=['\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','Branch\x20with\x20Id\x20','\x0a\x20\x20\x20\x20\x20\x20','repositoryId','SalesforceNotFoundError','decorate','search','../../../shared/utils','getComponents','Repository\x20with\x20Id\x20','Components__r','./salesforce.service','Repository__r','279270wyrYfB','SalesforceSyncService','getRepositoryRecordByName','60420KghvSZ','updateRemoteState','(((.+)+)+)+$','query','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','patchObject','Name','SalesforceService','802953OESOKh','getBranchComponents','replace','toString','getAllRepositoryNames','getComponentsFromRepository','getBranchRecord','__esModule','Repository\x20','fromBranchRecord','SalesforceQueryService','../dto/flosum-repository-sync.dto','GET_WAITING_REPOSITORIES_QUERY','encodeBase64','text/plain','1800120BnsBrH','3WlkJLS','%name%','Service','8WKGqFm','%id%','getAttachmentId','FlosumRepositorySyncDto','__decorate','../queries','map','../../../../constants/errors','getRepositoryRecords','Branch\x20','1761781IQqdAS','GET_COMPONENTS_QUERY','6nYPUcn','setStatus','object','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','createObject','records','metadata','function','getRemoteStateAttachmentId','616LJqBPT','Synchronization_Status__c','length','push','../errors/not-found.error','constructor','fromRepositoryRecord','typedi','FLOSUM_NAMESPACE','find','salesforceService','GET_BRANCH_QUERY','salesforceQuery','./salesforce-query.service','323645OkevMo','\x20not\x20found\x20on\x20salesforce','GET_BRANCH_BY_NAME_QUERY','GET_REPOSITORY_QUERY','__metadata','catch','Attachment','FLOSUM_GIT_NAMESPACE','2068227ZFGqZy','defineProperty','Sync_In_Progress__c'];a204_0x5b82=function(){return _0x58bc79;};return a204_0x5b82();}var __decorate=this&&this[a204_0x2f03fd(0x157)]||function(_0x3a085c,_0x4812c5,_0x103817,_0x398a74){const _0x1204b9=a204_0x2f03fd;var _0x246104=arguments[_0x1204b9(0x16a)],_0x454f31=_0x246104<0x3?_0x4812c5:_0x398a74===null?_0x398a74=Object['getOwnPropertyDescriptor'](_0x4812c5,_0x103817):_0x398a74,_0x60db01;if(typeof Reflect===_0x1204b9(0x161)&&typeof Reflect[_0x1204b9(0x12d)]===_0x1204b9(0x166))_0x454f31=Reflect[_0x1204b9(0x12d)](_0x3a085c,_0x4812c5,_0x103817,_0x398a74);else{for(var _0x4d80d1=_0x3a085c[_0x1204b9(0x16a)]-0x1;_0x4d80d1>=0x0;_0x4d80d1--)if(_0x60db01=_0x3a085c[_0x4d80d1])_0x454f31=(_0x246104<0x3?_0x60db01(_0x454f31):_0x246104>0x3?_0x60db01(_0x4812c5,_0x103817,_0x454f31):_0x60db01(_0x4812c5,_0x103817))||_0x454f31;}return _0x246104>0x3&&_0x454f31&&Object[_0x1204b9(0x126)](_0x4812c5,_0x103817,_0x454f31),_0x454f31;},__metadata=this&&this[a204_0x2f03fd(0x121)]||function(_0x12059a,_0x4a379e){const _0x5abb74=a204_0x2f03fd;if(typeof Reflect===_0x5abb74(0x161)&&typeof Reflect[_0x5abb74(0x165)]==='function')return Reflect[_0x5abb74(0x165)](_0x12059a,_0x4a379e);};Object[a204_0x2f03fd(0x126)](exports,a204_0x2f03fd(0x147),{'value':!![]}),exports[a204_0x2f03fd(0x136)]=void 0x0;const typedi_1=require(a204_0x2f03fd(0x16f)),constants_1=require('../../../../constants'),errors_1=require(a204_0x2f03fd(0x15a)),utils_1=require(a204_0x2f03fd(0x12f)),flosum_repository_sync_dto_1=require(a204_0x2f03fd(0x14b)),not_found_error_1=require(a204_0x2f03fd(0x16c)),queries_1=require(a204_0x2f03fd(0x158)),salesforce_query_service_1=require(a204_0x2f03fd(0x11c)),salesforce_service_1=require(a204_0x2f03fd(0x133));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x8669f5,_0x49e2d6){const _0x39596c=a204_0x2f03fd;this['salesforceQuery']=_0x8669f5,this[_0x39596c(0x172)]=_0x49e2d6;}async[a204_0x2f03fd(0x130)](_0x323cc5){const _0x45a322=a204_0x2f03fd;var _0x377fc8;const _0x3b2cda=await this[_0x45a322(0x174)]['query'](_0x323cc5),_0x1e1968=[];for(const _0x3f0803 of _0x3b2cda){const _0x543075=(_0x377fc8=_0x3f0803[constants_1[_0x45a322(0x170)]+_0x45a322(0x132)])===null||_0x377fc8===void 0x0?void 0x0:_0x377fc8[_0x45a322(0x164)];_0x543075&&_0x543075[_0x45a322(0x16a)]&&_0x1e1968[_0x45a322(0x16b)](_0x543075[0x0]['Id']);}return _0x1e1968;}async[a204_0x2f03fd(0x144)](_0x2eda08){const _0x398a87=a204_0x2f03fd,_0x472699=await this[_0x398a87(0x174)][_0x398a87(0x13b)](queries_1['GET_REPOSITORIES_NAMES_QUERY']['replace'](/\%connection_id\%/g,_0x2eda08));return _0x472699['map'](_0x456679=>{const _0x1f2bd5=_0x398a87;return _0x456679[constants_1[_0x1f2bd5(0x124)]+_0x1f2bd5(0x134)]?_0x456679[constants_1[_0x1f2bd5(0x124)]+_0x1f2bd5(0x134)][_0x1f2bd5(0x13e)]:_0x456679['Name'];});}async[a204_0x2f03fd(0x15b)](_0x22e433){const _0x399d31=a204_0x2f03fd,_0x335856=await this[_0x399d31(0x174)][_0x399d31(0x13b)](queries_1[_0x399d31(0x14c)][_0x399d31(0x142)](/\%connection_id\%/g,_0x22e433));return _0x335856['map'](_0x250016=>flosum_repository_sync_dto_1[_0x399d31(0x156)]['fromRepositoryRecord'](_0x250016));}async['getBranchRecords'](_0x4cf550){const _0x5086ab=a204_0x2f03fd,_0x3dde29=await this[_0x5086ab(0x174)][_0x5086ab(0x13b)](queries_1['GET_WAITING_BRANCHES_QUERY']['replace'](/%repositories_ids\%/g,_0x4cf550));return _0x3dde29[_0x5086ab(0x159)](_0xb05545=>flosum_repository_sync_dto_1[_0x5086ab(0x156)][_0x5086ab(0x149)](_0xb05545));}async['getRepositoryRecord'](_0x4f6ca1){const _0x24f66a=a204_0x2f03fd,_0x19d3f8=await this['salesforceQuery'][_0x24f66a(0x13b)](queries_1[_0x24f66a(0x120)][_0x24f66a(0x142)]('%id%',_0x4f6ca1));if(_0x19d3f8[_0x24f66a(0x16a)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x24f66a(0x131)+_0x4f6ca1+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x24f66a(0x16e)](_0x19d3f8[0x0]);}async[a204_0x2f03fd(0x146)](_0x188bc5){const _0x4cfc72=a204_0x2f03fd,_0x2da478=await this['salesforceQuery']['query'](queries_1[_0x4cfc72(0x173)][_0x4cfc72(0x142)](_0x4cfc72(0x154),_0x188bc5));if(_0x2da478[_0x4cfc72(0x16a)]===0x0)throw new not_found_error_1[(_0x4cfc72(0x12c))](_0x4cfc72(0x129)+_0x188bc5+_0x4cfc72(0x11e));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x4cfc72(0x149)](_0x2da478[0x0]);}async['getBranchRecordByName'](_0x2cbba0){const _0x4fbefa=a204_0x2f03fd,_0x7cd5f9=await this[_0x4fbefa(0x174)]['query'](queries_1[_0x4fbefa(0x11f)]['replace'](_0x4fbefa(0x151),_0x2cbba0));if(_0x7cd5f9[_0x4fbefa(0x16a)]===0x0)throw new not_found_error_1[(_0x4fbefa(0x12c))](_0x4fbefa(0x15c)+_0x2cbba0+'\x20not\x20found\x20on\x20salesforce');const _0x5554cf=_0x7cd5f9[_0x4fbefa(0x171)](_0x5ec133=>_0x5ec133[constants_1[_0x4fbefa(0x170)]+'Branch_Name__c']===_0x2cbba0);if(!_0x5554cf)throw new not_found_error_1[(_0x4fbefa(0x12c))]('Branch\x20'+_0x2cbba0+_0x4fbefa(0x11e));return flosum_repository_sync_dto_1[_0x4fbefa(0x156)]['fromBranchRecord'](_0x5554cf);}async[a204_0x2f03fd(0x137)](_0x286107){const _0x8298a7=a204_0x2f03fd,_0x4a8f9f=await this[_0x8298a7(0x174)][_0x8298a7(0x13b)](queries_1['GET_REPOSITORY_BY_NAME_QUERY']['replace'](_0x8298a7(0x151),_0x286107));if(_0x4a8f9f['length']===0x0)throw new not_found_error_1[(_0x8298a7(0x12c))](_0x8298a7(0x148)+_0x286107+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x8298a7(0x156)][_0x8298a7(0x16e)](_0x4a8f9f[0x0]);}async[a204_0x2f03fd(0x145)](_0x8efab0){const _0x2d6952=a204_0x2f03fd,_0x5b2dce=_0x2d6952(0x12a)+queries_1[_0x2d6952(0x15e)]+_0x2d6952(0x128)+_0x8efab0+'\x27';return this['getComponents'](_0x5b2dce);}async[a204_0x2f03fd(0x141)](_0x38e9e5){const _0x51cc63=a204_0x2f03fd,_0x1b1c88=_0x51cc63(0x13c)+queries_1['GET_COMPONENTS_QUERY']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x38e9e5+'\x27';return this['getComponents'](_0x1b1c88);}async['getAttachmentId'](_0x1d7363){const _0x18edd9=a204_0x2f03fd;var _0x42d749;const _0xa9eedb=queries_1[_0x18edd9(0x162)][_0x18edd9(0x142)]('%parentId%',_0x1d7363['objectId'])[_0x18edd9(0x142)](_0x18edd9(0x151),_0x1d7363[_0x18edd9(0x12b)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x4006b4=await this[_0x18edd9(0x174)][_0x18edd9(0x13b)](_0xa9eedb),_0x8b3939=(_0x42d749=_0x4006b4[0x0])===null||_0x42d749===void 0x0?void 0x0:_0x42d749['Id'];if(!_0x8b3939)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x8b3939;}async[a204_0x2f03fd(0x167)](_0x873961){const _0xb6b2b6=a204_0x2f03fd;let _0x3820c0=await this[_0xb6b2b6(0x155)](_0x873961)[_0xb6b2b6(0x122)](()=>null);return!_0x3820c0&&(_0x3820c0=await this['salesforceService'][_0xb6b2b6(0x163)](_0xb6b2b6(0x123),{'Body':(0x0,utils_1[_0xb6b2b6(0x14d)])('{}'),'ParentId':_0x873961['objectId'],'ContentType':_0xb6b2b6(0x14e),'Name':_0x873961[_0xb6b2b6(0x12b)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x3820c0;}async[a204_0x2f03fd(0x139)](_0x4817e1,_0x422f93){const _0x264a62=a204_0x2f03fd,_0x2ace8d=await this[_0x264a62(0x167)](_0x4817e1);await this[_0x264a62(0x172)]['patchObject'](_0x264a62(0x123),_0x2ace8d,{'Body':(0x0,utils_1['encodeBase64'])(JSON['stringify'](_0x422f93))});}async[a204_0x2f03fd(0x160)](_0x1adc7a,_0x2fbbc1){const _0x52b734=a204_0x2f03fd;await this[_0x52b734(0x172)][_0x52b734(0x13d)](_0x1adc7a['objectType'],_0x1adc7a['objectId'],{[constants_1[_0x52b734(0x124)]+_0x52b734(0x169)]:_0x2fbbc1});}async['disableSync'](_0x3f4d92){const _0x4b60c2=a204_0x2f03fd;await this[_0x4b60c2(0x172)][_0x4b60c2(0x13d)](constants_1[_0x4b60c2(0x124)]+'Connection__c',_0x3f4d92,{[constants_1[_0x4b60c2(0x124)]+_0x4b60c2(0x127)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a204_0x2f03fd(0x152)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a204_0x2f03fd(0x14a)],salesforce_service_1[a204_0x2f03fd(0x13f)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;