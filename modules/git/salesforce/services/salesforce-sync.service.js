const a254_0x35ead6=a254_0x169a;(function(_0x38361c,_0x370bd1){const _0x2cebf5=a254_0x169a,_0x181ccd=_0x38361c();while(!![]){try{const _0x5ee83f=parseInt(_0x2cebf5(0x1d6))/0x1*(-parseInt(_0x2cebf5(0x19e))/0x2)+parseInt(_0x2cebf5(0x1c0))/0x3+parseInt(_0x2cebf5(0x1e1))/0x4*(parseInt(_0x2cebf5(0x19f))/0x5)+-parseInt(_0x2cebf5(0x1d7))/0x6+-parseInt(_0x2cebf5(0x1ba))/0x7+parseInt(_0x2cebf5(0x1c9))/0x8+-parseInt(_0x2cebf5(0x1ca))/0x9*(-parseInt(_0x2cebf5(0x196))/0xa);if(_0x5ee83f===_0x370bd1)break;else _0x181ccd['push'](_0x181ccd['shift']());}catch(_0x320975){_0x181ccd['push'](_0x181ccd['shift']());}}}(a254_0x5843,0x476c1));const a254_0x3bdb7e=(function(){let _0x7dcc6e=!![];return function(_0xa85a83,_0xe7f5bf){const _0x422cec=_0x7dcc6e?function(){const _0xa75cd3=a254_0x169a;if(_0xe7f5bf){const _0x45db48=_0xe7f5bf[_0xa75cd3(0x18c)](_0xa85a83,arguments);return _0xe7f5bf=null,_0x45db48;}}:function(){};return _0x7dcc6e=![],_0x422cec;};}()),a254_0x498814=a254_0x3bdb7e(this,function(){const _0x11a237=a254_0x169a;return a254_0x498814[_0x11a237(0x18d)]()[_0x11a237(0x19d)](_0x11a237(0x1c1))[_0x11a237(0x18d)]()['constructor'](a254_0x498814)[_0x11a237(0x19d)](_0x11a237(0x1c1));});function a254_0x5843(){const _0x1ade1a=['getBranchComponents','Connection__c','SalesforceSyncService','getComponents','1480071ZRPDYO','(((.+)+)+)+$','decorate','getBranchRecords','defineProperty','\x20not\x20found\x20on\x20salesforce','../../../shared/utils','getOwnPropertyDescriptor','Components__r','1587736YVYOGV','10944cEPVuz','getRepositoryRecordByName','objectType','replace','metadata','Branch_Name__c','%id%','__metadata','GET_REPOSITORIES_NAMES_QUERY','records','ERR_INVALID_ATTACHMENT_ID','__esModule','91389YykdIF','2968062FYxvKH','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','disableSync','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','map','salesforceQuery','Sync_In_Progress__c','updateRemoteState','GET_WAITING_BRANCHES_QUERY','GET_BRANCH_QUERY','1212sQQdaG','./salesforce.service','setStatus','stringify','getBranchRecord','query','GET_WAITING_REPOSITORIES_QUERY','__decorate','apply','toString','SYNC_ATTACHMENT_FOR_BRANCH_NAME','Synchronization_Status__c','object','design:paramtypes','SalesforceQueryService','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','Name','getRepositoryRecord','1610zHHTPO','Repository__r','../queries','getBranchRecordByName','function','FLOSUM_GIT_NAMESPACE','patchObject','search','10TpgNXX','8765iuznLC','Service','../../../../constants/errors','GET_REPOSITORY_QUERY','%name%','getAttachmentId','FLOSUM_NAMESPACE','FlosumRepositorySyncDto','fromRepositoryRecord','GET_REPOSITORY_BY_NAME_QUERY','length','push','../errors/not-found.error','Attachment','repositoryId','fromBranchRecord','GET_BRANCH_BY_NAME_QUERY','Branch\x20','\x0a\x20\x20\x20\x20\x20\x20','encodeBase64','getRepositoryRecords','salesforceService','objectId','./salesforce-query.service','getRemoteStateAttachmentId','GET_COMPONENTS_QUERY','SalesforceNotFoundError','1222144EEtHTe','%parentId%'];a254_0x5843=function(){return _0x1ade1a;};return a254_0x5843();}a254_0x498814();'use strict';var __decorate=this&&this[a254_0x35ead6(0x18b)]||function(_0x413db0,_0x525301,_0x4d6bc5,_0x21c4e3){const _0x1c7d85=a254_0x35ead6;var _0x59f54e=arguments[_0x1c7d85(0x1a9)],_0x5f2720=_0x59f54e<0x3?_0x525301:_0x21c4e3===null?_0x21c4e3=Object[_0x1c7d85(0x1c7)](_0x525301,_0x4d6bc5):_0x21c4e3,_0x28ba76;if(typeof Reflect===_0x1c7d85(0x190)&&typeof Reflect[_0x1c7d85(0x1c2)]===_0x1c7d85(0x19a))_0x5f2720=Reflect[_0x1c7d85(0x1c2)](_0x413db0,_0x525301,_0x4d6bc5,_0x21c4e3);else{for(var _0xacfaa5=_0x413db0[_0x1c7d85(0x1a9)]-0x1;_0xacfaa5>=0x0;_0xacfaa5--)if(_0x28ba76=_0x413db0[_0xacfaa5])_0x5f2720=(_0x59f54e<0x3?_0x28ba76(_0x5f2720):_0x59f54e>0x3?_0x28ba76(_0x525301,_0x4d6bc5,_0x5f2720):_0x28ba76(_0x525301,_0x4d6bc5))||_0x5f2720;}return _0x59f54e>0x3&&_0x5f2720&&Object[_0x1c7d85(0x1c4)](_0x525301,_0x4d6bc5,_0x5f2720),_0x5f2720;},__metadata=this&&this[a254_0x35ead6(0x1d1)]||function(_0x247242,_0x5c54d1){const _0x544909=a254_0x35ead6;if(typeof Reflect==='object'&&typeof Reflect[_0x544909(0x1ce)]===_0x544909(0x19a))return Reflect['metadata'](_0x247242,_0x5c54d1);};function a254_0x169a(_0x52e082,_0x220921){const _0x546e3b=a254_0x5843();return a254_0x169a=function(_0x498814,_0x3bdb7e){_0x498814=_0x498814-0x18b;let _0x5843e1=_0x546e3b[_0x498814];return _0x5843e1;},a254_0x169a(_0x52e082,_0x220921);}Object[a254_0x35ead6(0x1c4)](exports,a254_0x35ead6(0x1d5),{'value':!![]}),exports[a254_0x35ead6(0x1be)]=void 0x0;const typedi_1=require('typedi'),constants_1=require('../../../../constants'),errors_1=require(a254_0x35ead6(0x1a1)),utils_1=require(a254_0x35ead6(0x1c6)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a254_0x35ead6(0x1ab)),queries_1=require(a254_0x35ead6(0x198)),salesforce_query_service_1=require(a254_0x35ead6(0x1b6)),salesforce_service_1=require(a254_0x35ead6(0x1e2));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x2c83e3,_0xc2a91a){const _0x4ceae7=a254_0x35ead6;this['salesforceQuery']=_0x2c83e3,this[_0x4ceae7(0x1b4)]=_0xc2a91a;}async[a254_0x35ead6(0x1bf)](_0x148dec){const _0x15cd4d=a254_0x35ead6;var _0x2d945e;const _0x54b4d8=await this['salesforceQuery'][_0x15cd4d(0x1e6)](_0x148dec),_0x4556db=[];for(const _0x5e5363 of _0x54b4d8){const _0x48194a=(_0x2d945e=_0x5e5363[constants_1[_0x15cd4d(0x1a5)]+_0x15cd4d(0x1c8)])===null||_0x2d945e===void 0x0?void 0x0:_0x2d945e[_0x15cd4d(0x1d3)];_0x48194a&&_0x48194a[_0x15cd4d(0x1a9)]&&_0x4556db[_0x15cd4d(0x1aa)](_0x48194a[0x0]['Id']);}return _0x4556db;}async['getAllRepositoryNames'](_0x424952){const _0x445de1=a254_0x35ead6,_0xa337f2=await this[_0x445de1(0x1dc)][_0x445de1(0x1e6)](queries_1[_0x445de1(0x1d2)][_0x445de1(0x1cd)](/\%connection_id\%/g,_0x424952));return _0xa337f2[_0x445de1(0x1db)](_0x209755=>{const _0x5d475c=_0x445de1;return _0x209755[constants_1[_0x5d475c(0x19b)]+'Repository__r']?_0x209755[constants_1[_0x5d475c(0x19b)]+_0x5d475c(0x197)][_0x5d475c(0x194)]:_0x209755[_0x5d475c(0x194)];});}async[a254_0x35ead6(0x1b3)](_0x34aed9){const _0x215635=a254_0x35ead6,_0x5c3013=await this[_0x215635(0x1dc)][_0x215635(0x1e6)](queries_1[_0x215635(0x1e7)][_0x215635(0x1cd)](/\%connection_id\%/g,_0x34aed9));return _0x5c3013[_0x215635(0x1db)](_0x69fe03=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x215635(0x1a7)](_0x69fe03));}async[a254_0x35ead6(0x1c3)](_0x3b5a7e){const _0x34f4a2=a254_0x35ead6,_0x2ccf43=await this[_0x34f4a2(0x1dc)]['query'](queries_1[_0x34f4a2(0x1df)][_0x34f4a2(0x1cd)](/%repositories_ids\%/g,_0x3b5a7e));return _0x2ccf43[_0x34f4a2(0x1db)](_0x3b60ca=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x34f4a2(0x1ae)](_0x3b60ca));}async[a254_0x35ead6(0x195)](_0x430f16){const _0x2ff133=a254_0x35ead6,_0x4925b3=await this['salesforceQuery']['query'](queries_1[_0x2ff133(0x1a2)][_0x2ff133(0x1cd)](_0x2ff133(0x1d0),_0x430f16));if(_0x4925b3[_0x2ff133(0x1a9)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20with\x20Id\x20'+_0x430f16+_0x2ff133(0x1c5));return flosum_repository_sync_dto_1[_0x2ff133(0x1a6)][_0x2ff133(0x1a7)](_0x4925b3[0x0]);}async[a254_0x35ead6(0x1e5)](_0x223050){const _0x4a77cc=a254_0x35ead6,_0x1d4dd5=await this[_0x4a77cc(0x1dc)][_0x4a77cc(0x1e6)](queries_1[_0x4a77cc(0x1e0)][_0x4a77cc(0x1cd)](_0x4a77cc(0x1d0),_0x223050));if(_0x1d4dd5[_0x4a77cc(0x1a9)]===0x0)throw new not_found_error_1[(_0x4a77cc(0x1b9))]('Branch\x20with\x20Id\x20'+_0x223050+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x4a77cc(0x1a6)][_0x4a77cc(0x1ae)](_0x1d4dd5[0x0]);}async[a254_0x35ead6(0x199)](_0x18343d){const _0x53a665=a254_0x35ead6,_0x48a845=await this[_0x53a665(0x1dc)][_0x53a665(0x1e6)](queries_1[_0x53a665(0x1af)][_0x53a665(0x1cd)]('%name%',_0x18343d));if(_0x48a845[_0x53a665(0x1a9)]===0x0)throw new not_found_error_1[(_0x53a665(0x1b9))]('Branch\x20'+_0x18343d+_0x53a665(0x1c5));const _0x33667b=_0x48a845['find'](_0x226c24=>_0x226c24[constants_1[_0x53a665(0x1a5)]+_0x53a665(0x1cf)]===_0x18343d);if(!_0x33667b)throw new not_found_error_1[(_0x53a665(0x1b9))](_0x53a665(0x1b0)+_0x18343d+_0x53a665(0x1c5));return flosum_repository_sync_dto_1[_0x53a665(0x1a6)][_0x53a665(0x1ae)](_0x33667b);}async[a254_0x35ead6(0x1cb)](_0x2a91bc){const _0x24bdf0=a254_0x35ead6,_0x5bf3b5=await this[_0x24bdf0(0x1dc)][_0x24bdf0(0x1e6)](queries_1[_0x24bdf0(0x1a8)][_0x24bdf0(0x1cd)](_0x24bdf0(0x1a3),_0x2a91bc));if(_0x5bf3b5['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20'+_0x2a91bc+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x24bdf0(0x1a7)](_0x5bf3b5[0x0]);}async['getComponentsFromRepository'](_0x3a2e96){const _0x82ac4d=a254_0x35ead6,_0x41fcba=_0x82ac4d(0x1b1)+queries_1[_0x82ac4d(0x1b8)]+_0x82ac4d(0x1da)+_0x3a2e96+'\x27';return this[_0x82ac4d(0x1bf)](_0x41fcba);}async[a254_0x35ead6(0x1bc)](_0x47c65e){const _0x34646e=a254_0x35ead6,_0x3aca91='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1['GET_COMPONENTS_QUERY']+_0x34646e(0x1d8)+_0x47c65e+'\x27';return this[_0x34646e(0x1bf)](_0x3aca91);}async[a254_0x35ead6(0x1a4)](_0x1fd1f0){const _0x446c04=a254_0x35ead6;var _0x5f458c;const _0x128674=queries_1[_0x446c04(0x193)][_0x446c04(0x1cd)](_0x446c04(0x1bb),_0x1fd1f0['objectId'])[_0x446c04(0x1cd)](_0x446c04(0x1a3),_0x1fd1f0[_0x446c04(0x1ad)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x446c04(0x18e)]),_0x35e830=await this[_0x446c04(0x1dc)]['query'](_0x128674),_0x259f33=(_0x5f458c=_0x35e830[0x0])===null||_0x5f458c===void 0x0?void 0x0:_0x5f458c['Id'];if(!_0x259f33)throw new Error(errors_1[_0x446c04(0x1d4)]);return _0x259f33;}async[a254_0x35ead6(0x1b7)](_0x86ca49){const _0x4127f9=a254_0x35ead6;let _0x5583ac=await this[_0x4127f9(0x1a4)](_0x86ca49)['catch'](()=>null);return!_0x5583ac&&(_0x5583ac=await this['salesforceService']['createObject'](_0x4127f9(0x1ac),{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x86ca49[_0x4127f9(0x1b5)],'ContentType':'text/plain','Name':_0x86ca49[_0x4127f9(0x1ad)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x4127f9(0x18e)]})),_0x5583ac;}async[a254_0x35ead6(0x1de)](_0x3d7387,_0x435252){const _0x5c697d=a254_0x35ead6,_0x1f7ab8=await this[_0x5c697d(0x1b7)](_0x3d7387);await this['salesforceService'][_0x5c697d(0x19c)]('Attachment',_0x1f7ab8,{'Body':(0x0,utils_1[_0x5c697d(0x1b2)])(JSON[_0x5c697d(0x1e4)](_0x435252))});}async[a254_0x35ead6(0x1e3)](_0x2ce8e8,_0x88c3b){const _0x4003ed=a254_0x35ead6;await this[_0x4003ed(0x1b4)][_0x4003ed(0x19c)](_0x2ce8e8[_0x4003ed(0x1cc)],_0x2ce8e8[_0x4003ed(0x1b5)],{[constants_1[_0x4003ed(0x19b)]+_0x4003ed(0x18f)]:_0x88c3b});}async[a254_0x35ead6(0x1d9)](_0x2d0616){const _0x299c29=a254_0x35ead6;await this['salesforceService'][_0x299c29(0x19c)](constants_1['FLOSUM_GIT_NAMESPACE']+_0x299c29(0x1bd),_0x2d0616,{[constants_1[_0x299c29(0x19b)]+_0x299c29(0x1dd)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a254_0x35ead6(0x1a0)])(),__metadata(a254_0x35ead6(0x191),[salesforce_query_service_1[a254_0x35ead6(0x192)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports[a254_0x35ead6(0x1be)]=SalesforceSyncService;