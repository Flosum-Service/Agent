const a204_0x282ac5=a204_0x357a;(function(_0x2d7018,_0x1a2e01){const _0x57edca=a204_0x357a,_0x1a5654=_0x2d7018();while(!![]){try{const _0x572ee1=-parseInt(_0x57edca(0x116))/0x1+parseInt(_0x57edca(0x127))/0x2+parseInt(_0x57edca(0x136))/0x3*(parseInt(_0x57edca(0x107))/0x4)+-parseInt(_0x57edca(0x102))/0x5*(-parseInt(_0x57edca(0x137))/0x6)+parseInt(_0x57edca(0x12a))/0x7+-parseInt(_0x57edca(0xf6))/0x8+-parseInt(_0x57edca(0x124))/0x9;if(_0x572ee1===_0x1a2e01)break;else _0x1a5654['push'](_0x1a5654['shift']());}catch(_0x6c92bf){_0x1a5654['push'](_0x1a5654['shift']());}}}(a204_0x2c7f,0xa1933));const a204_0x3edba5=(function(){let _0x265ccd=!![];return function(_0x185014,_0x2adfa7){const _0xf33c37=_0x265ccd?function(){const _0x11c29b=a204_0x357a;if(_0x2adfa7){const _0x114463=_0x2adfa7[_0x11c29b(0x114)](_0x185014,arguments);return _0x2adfa7=null,_0x114463;}}:function(){};return _0x265ccd=![],_0xf33c37;};}()),a204_0x5b49df=a204_0x3edba5(this,function(){const _0x32bbd0=a204_0x357a;return a204_0x5b49df[_0x32bbd0(0x141)]()[_0x32bbd0(0x10b)](_0x32bbd0(0x109))[_0x32bbd0(0x141)]()['constructor'](a204_0x5b49df)['search'](_0x32bbd0(0x109));});function a204_0x357a(_0x46ab85,_0x439da0){const _0x21c512=a204_0x2c7f();return a204_0x357a=function(_0x5b49df,_0x3edba5){_0x5b49df=_0x5b49df-0xf4;let _0x2c7fe2=_0x21c512[_0x5b49df];return _0x2c7fe2;},a204_0x357a(_0x46ab85,_0x439da0);}a204_0x5b49df();'use strict';var __decorate=this&&this[a204_0x282ac5(0x11c)]||function(_0x5ca507,_0x2aa957,_0x41d0e3,_0x15c201){const _0x5f35d0=a204_0x282ac5;var _0x14a0b0=arguments['length'],_0x350c87=_0x14a0b0<0x3?_0x2aa957:_0x15c201===null?_0x15c201=Object[_0x5f35d0(0xf4)](_0x2aa957,_0x41d0e3):_0x15c201,_0x1f2526;if(typeof Reflect===_0x5f35d0(0x149)&&typeof Reflect[_0x5f35d0(0x120)]==='function')_0x350c87=Reflect[_0x5f35d0(0x120)](_0x5ca507,_0x2aa957,_0x41d0e3,_0x15c201);else{for(var _0x1440a7=_0x5ca507['length']-0x1;_0x1440a7>=0x0;_0x1440a7--)if(_0x1f2526=_0x5ca507[_0x1440a7])_0x350c87=(_0x14a0b0<0x3?_0x1f2526(_0x350c87):_0x14a0b0>0x3?_0x1f2526(_0x2aa957,_0x41d0e3,_0x350c87):_0x1f2526(_0x2aa957,_0x41d0e3))||_0x350c87;}return _0x14a0b0>0x3&&_0x350c87&&Object['defineProperty'](_0x2aa957,_0x41d0e3,_0x350c87),_0x350c87;},__metadata=this&&this[a204_0x282ac5(0x133)]||function(_0x1e024b,_0x4a7a7e){const _0x10b172=a204_0x282ac5;if(typeof Reflect===_0x10b172(0x149)&&typeof Reflect[_0x10b172(0x13d)]===_0x10b172(0x11e))return Reflect['metadata'](_0x1e024b,_0x4a7a7e);};Object[a204_0x282ac5(0x125)](exports,'__esModule',{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require(a204_0x282ac5(0x100)),constants_1=require(a204_0x282ac5(0x12d)),errors_1=require(a204_0x282ac5(0x113)),utils_1=require(a204_0x282ac5(0x145)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a204_0x282ac5(0x104)),queries_1=require(a204_0x282ac5(0xfc)),salesforce_query_service_1=require(a204_0x282ac5(0x14d)),salesforce_service_1=require('./salesforce.service');function a204_0x2c7f(){const _0x2c3bd3=['Connection__c','\x0a\x20\x20\x20\x20\x20\x20','../../../../constants','FlosumRepositorySyncDto','FLOSUM_GIT_NAMESPACE','encodeBase64','records','FLOSUM_NAMESPACE','__metadata','map','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','63zAcuhA','6sBOWeB','stringify','GET_REPOSITORIES_NAMES_QUERY','SalesforceNotFoundError','getBranchRecordByName','design:paramtypes','metadata','SalesforceSyncService','patchObject','\x20not\x20found\x20on\x20salesforce','toString','query','Name','find','../../../shared/utils','fromBranchRecord','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','GET_BRANCH_BY_NAME_QUERY','object','salesforceService','getRepositoryRecords','length','./salesforce-query.service','getOwnPropertyDescriptor','updateRemoteState','93712AXHliI','salesforceQuery','SYNC_ATTACHMENT_FOR_BRANCH_NAME','objectType','GET_COMPONENTS_QUERY','getAttachmentId','../queries','replace','getBranchComponents','getRemoteStateAttachmentId','typedi','getComponentsFromRepository','2437835oGIQGS','GET_BRANCH_QUERY','../errors/not-found.error','fromRepositoryRecord','Repository\x20with\x20Id\x20','159700qLOJRb','Components__r','(((.+)+)+)+$','objectId','search','Attachment','%id%','getBranchRecord','getBranchRecords','getComponents','repositoryId','setStatus','../../../../constants/errors','apply','Repository__r','569108DSsold','Branch\x20with\x20Id\x20','createObject','Synchronization_Status__c','SalesforceQueryService','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','__decorate','Branch\x20','function','SalesforceService','decorate','GET_REPOSITORY_QUERY','Sync_In_Progress__c','Branch_Name__c','11405799ScolFl','defineProperty','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','1467652lKlRZN','push','%name%','3150882rVRLFE'];a204_0x2c7f=function(){return _0x2c3bd3;};return a204_0x2c7f();}let SalesforceSyncService=class SalesforceSyncService{constructor(_0x185277,_0xd8834a){const _0x86afab=a204_0x282ac5;this['salesforceQuery']=_0x185277,this[_0x86afab(0x14a)]=_0xd8834a;}async[a204_0x282ac5(0x110)](_0x43d6b3){const _0x3f54fd=a204_0x282ac5;var _0x4a38ec;const _0x304351=await this[_0x3f54fd(0xf7)]['query'](_0x43d6b3),_0x5a9ddd=[];for(const _0x6b4da7 of _0x304351){const _0x3e41e2=(_0x4a38ec=_0x6b4da7[constants_1[_0x3f54fd(0x132)]+_0x3f54fd(0x108)])===null||_0x4a38ec===void 0x0?void 0x0:_0x4a38ec[_0x3f54fd(0x131)];_0x3e41e2&&_0x3e41e2[_0x3f54fd(0x14c)]&&_0x5a9ddd[_0x3f54fd(0x128)](_0x3e41e2[0x0]['Id']);}return _0x5a9ddd;}async['getAllRepositoryNames'](_0x5c67bb){const _0x3b456c=a204_0x282ac5,_0x14443f=await this[_0x3b456c(0xf7)][_0x3b456c(0x142)](queries_1[_0x3b456c(0x139)][_0x3b456c(0xfd)](/\%connection_id\%/g,_0x5c67bb));return _0x14443f[_0x3b456c(0x134)](_0x33419c=>{const _0x18bc39=_0x3b456c;return _0x33419c[constants_1[_0x18bc39(0x12f)]+_0x18bc39(0x115)]?_0x33419c[constants_1['FLOSUM_GIT_NAMESPACE']+_0x18bc39(0x115)][_0x18bc39(0x143)]:_0x33419c[_0x18bc39(0x143)];});}async[a204_0x282ac5(0x14b)](_0x22f8d2){const _0x135f6f=a204_0x282ac5,_0x596ed3=await this[_0x135f6f(0xf7)][_0x135f6f(0x142)](queries_1['GET_WAITING_REPOSITORIES_QUERY']['replace'](/\%connection_id\%/g,_0x22f8d2));return _0x596ed3[_0x135f6f(0x134)](_0x4ec1d2=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x135f6f(0x105)](_0x4ec1d2));}async[a204_0x282ac5(0x10f)](_0x5d22f7){const _0x41bafd=a204_0x282ac5,_0x2e9ad7=await this['salesforceQuery'][_0x41bafd(0x142)](queries_1['GET_WAITING_BRANCHES_QUERY']['replace'](/%repositories_ids\%/g,_0x5d22f7));return _0x2e9ad7[_0x41bafd(0x134)](_0x43a919=>flosum_repository_sync_dto_1[_0x41bafd(0x12e)]['fromBranchRecord'](_0x43a919));}async['getRepositoryRecord'](_0x20c83d){const _0x31cc66=a204_0x282ac5,_0x47fc9d=await this[_0x31cc66(0xf7)][_0x31cc66(0x142)](queries_1[_0x31cc66(0x121)][_0x31cc66(0xfd)]('%id%',_0x20c83d));if(_0x47fc9d[_0x31cc66(0x14c)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x31cc66(0x106)+_0x20c83d+_0x31cc66(0x140));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x31cc66(0x105)](_0x47fc9d[0x0]);}async[a204_0x282ac5(0x10e)](_0x57bef5){const _0x2c08ea=a204_0x282ac5,_0x3b357e=await this[_0x2c08ea(0xf7)]['query'](queries_1[_0x2c08ea(0x103)][_0x2c08ea(0xfd)](_0x2c08ea(0x10d),_0x57bef5));if(_0x3b357e[_0x2c08ea(0x14c)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x2c08ea(0x117)+_0x57bef5+_0x2c08ea(0x140));return flosum_repository_sync_dto_1[_0x2c08ea(0x12e)][_0x2c08ea(0x146)](_0x3b357e[0x0]);}async[a204_0x282ac5(0x13b)](_0x4432f1){const _0x3b3814=a204_0x282ac5,_0x44358f=await this[_0x3b3814(0xf7)][_0x3b3814(0x142)](queries_1[_0x3b3814(0x148)][_0x3b3814(0xfd)](_0x3b3814(0x129),_0x4432f1));if(_0x44358f['length']===0x0)throw new not_found_error_1[(_0x3b3814(0x13a))](_0x3b3814(0x11d)+_0x4432f1+'\x20not\x20found\x20on\x20salesforce');const _0x1c1403=_0x44358f[_0x3b3814(0x144)](_0x1eac25=>_0x1eac25[constants_1[_0x3b3814(0x132)]+_0x3b3814(0x123)]===_0x4432f1);if(!_0x1c1403)throw new not_found_error_1['SalesforceNotFoundError'](_0x3b3814(0x11d)+_0x4432f1+_0x3b3814(0x140));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x3b3814(0x146)](_0x1c1403);}async['getRepositoryRecordByName'](_0x36ad69){const _0x1f494=a204_0x282ac5,_0x1e41b9=await this[_0x1f494(0xf7)]['query'](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x1f494(0xfd)](_0x1f494(0x129),_0x36ad69));if(_0x1e41b9[_0x1f494(0x14c)]===0x0)throw new not_found_error_1[(_0x1f494(0x13a))]('Repository\x20'+_0x36ad69+_0x1f494(0x140));return flosum_repository_sync_dto_1[_0x1f494(0x12e)][_0x1f494(0x105)](_0x1e41b9[0x0]);}async[a204_0x282ac5(0x101)](_0x304be7){const _0x440399=a204_0x282ac5,_0x2ddafa=_0x440399(0x12c)+queries_1[_0x440399(0xfa)]+_0x440399(0x126)+_0x304be7+'\x27';return this[_0x440399(0x110)](_0x2ddafa);}async[a204_0x282ac5(0xfe)](_0x5ca5ed){const _0x1c3301=a204_0x282ac5,_0x1b4158=_0x1c3301(0x135)+queries_1[_0x1c3301(0xfa)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x5ca5ed+'\x27';return this['getComponents'](_0x1b4158);}async['getAttachmentId'](_0x5783a6){const _0x19278c=a204_0x282ac5;var _0x13d695;const _0x33ef98=queries_1[_0x19278c(0x11b)][_0x19278c(0xfd)]('%parentId%',_0x5783a6['objectId'])[_0x19278c(0xfd)](_0x19278c(0x129),_0x5783a6[_0x19278c(0x111)]?constants_1[_0x19278c(0x147)]:constants_1[_0x19278c(0xf8)]),_0xa5736d=await this[_0x19278c(0xf7)]['query'](_0x33ef98),_0x165969=(_0x13d695=_0xa5736d[0x0])===null||_0x13d695===void 0x0?void 0x0:_0x13d695['Id'];if(!_0x165969)throw new Error(errors_1['ERR_INVALID_ATTACHMENT_ID']);return _0x165969;}async[a204_0x282ac5(0xff)](_0x1a0906){const _0x20b946=a204_0x282ac5;let _0x11c797=await this[_0x20b946(0xfb)](_0x1a0906)['catch'](()=>null);return!_0x11c797&&(_0x11c797=await this['salesforceService'][_0x20b946(0x118)](_0x20b946(0x10c),{'Body':(0x0,utils_1[_0x20b946(0x130)])('{}'),'ParentId':_0x1a0906[_0x20b946(0x10a)],'ContentType':'text/plain','Name':_0x1a0906[_0x20b946(0x111)]?constants_1[_0x20b946(0x147)]:constants_1[_0x20b946(0xf8)]})),_0x11c797;}async[a204_0x282ac5(0xf5)](_0x1c217a,_0x58581a){const _0x5dbc6f=a204_0x282ac5,_0x353999=await this['getRemoteStateAttachmentId'](_0x1c217a);await this['salesforceService']['patchObject'](_0x5dbc6f(0x10c),_0x353999,{'Body':(0x0,utils_1[_0x5dbc6f(0x130)])(JSON[_0x5dbc6f(0x138)](_0x58581a))});}async[a204_0x282ac5(0x112)](_0x2023a2,_0xfd5fc3){const _0x3e3c38=a204_0x282ac5;await this['salesforceService'][_0x3e3c38(0x13f)](_0x2023a2[_0x3e3c38(0xf9)],_0x2023a2['objectId'],{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x3e3c38(0x119)]:_0xfd5fc3});}async['disableSync'](_0x280bc8){const _0x566930=a204_0x282ac5;await this[_0x566930(0x14a)][_0x566930(0x13f)](constants_1[_0x566930(0x12f)]+_0x566930(0x12b),_0x280bc8,{[constants_1[_0x566930(0x12f)]+_0x566930(0x122)]:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1['Service'])(),__metadata(a204_0x282ac5(0x13c),[salesforce_query_service_1[a204_0x282ac5(0x11a)],salesforce_service_1[a204_0x282ac5(0x11f)]])],SalesforceSyncService),exports[a204_0x282ac5(0x13e)]=SalesforceSyncService;