const a280_0x46ed78=a280_0x269f;(function(_0x4584ad,_0x23b3f4){const _0x267555=a280_0x269f,_0x2aabcc=_0x4584ad();while(!![]){try{const _0x291e31=-parseInt(_0x267555(0x1b4))/0x1+-parseInt(_0x267555(0x176))/0x2+-parseInt(_0x267555(0x193))/0x3+parseInt(_0x267555(0x175))/0x4*(-parseInt(_0x267555(0x1ac))/0x5)+parseInt(_0x267555(0x195))/0x6+-parseInt(_0x267555(0x1b5))/0x7+-parseInt(_0x267555(0x1a1))/0x8*(-parseInt(_0x267555(0x186))/0x9);if(_0x291e31===_0x23b3f4)break;else _0x2aabcc['push'](_0x2aabcc['shift']());}catch(_0x214fa7){_0x2aabcc['push'](_0x2aabcc['shift']());}}}(a280_0x32c1,0xaa278));const a280_0x2d6271=(function(){let _0x3b19cc=!![];return function(_0xf2646,_0x325731){const _0x3e0aea=_0x3b19cc?function(){if(_0x325731){const _0x46bb6c=_0x325731['apply'](_0xf2646,arguments);return _0x325731=null,_0x46bb6c;}}:function(){};return _0x3b19cc=![],_0x3e0aea;};}()),a280_0x340ba8=a280_0x2d6271(this,function(){const _0x4737bb=a280_0x269f;return a280_0x340ba8[_0x4737bb(0x1b9)]()['search'](_0x4737bb(0x1b8))['toString']()[_0x4737bb(0x17a)](a280_0x340ba8)[_0x4737bb(0x17d)](_0x4737bb(0x1b8));});function a280_0x269f(_0x80a6b8,_0x503bcc){const _0x498708=a280_0x32c1();return a280_0x269f=function(_0x340ba8,_0x2d6271){_0x340ba8=_0x340ba8-0x170;let _0x32c1aa=_0x498708[_0x340ba8];return _0x32c1aa;},a280_0x269f(_0x80a6b8,_0x503bcc);}function a280_0x32c1(){const _0x569565=['%name%','Connection__c','push','../../../shared/utils','Attachment','GET_COMPONENTS_QUERY','SalesforceSyncService','objectType','defineProperty','1090044zlZkkS','metadata','5606988UMdQmc','../errors/not-found.error','./salesforce-query.service','updateRemoteState','fromBranchRecord','%id%','getComponentsFromRepository','FLOSUM_GIT_NAMESPACE','Service','GET_REPOSITORY_BY_NAME_QUERY','Branch\x20','Name','88WZgQMK','Synchronization_Status__c','getComponents','../../../../constants','SalesforceNotFoundError','repositoryId','salesforceService','__decorate','replace','object','createObject','8020JODdEV','GET_REPOSITORY_QUERY','query','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','FLOSUM_NAMESPACE','SalesforceQueryService','objectId','stringify','975320Qvwosx','1275414COpvMa','salesforceQuery','length','(((.+)+)+)+$','toString','ERR_INVALID_ATTACHMENT_ID','decorate','\x0a\x20\x20\x20\x20\x20\x20','fromRepositoryRecord','Repository\x20','function','Branch\x20with\x20Id\x20','patchObject','getRepositoryRecordByName','getAllRepositoryNames','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','__metadata','getBranchRecords','disableSync','getOwnPropertyDescriptor','getAttachmentId','1568qyolBr','2644762UgnGKN','../dto/flosum-repository-sync.dto','Branch_Name__c','getRemoteStateAttachmentId','constructor','\x20not\x20found\x20on\x20salesforce','setStatus','search','map','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','SalesforceService','./salesforce.service','typedi','../../../../constants/errors','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','Repository__r','2646387CNSEUa','FlosumRepositorySyncDto','%parentId%','GET_BRANCH_BY_NAME_QUERY'];a280_0x32c1=function(){return _0x569565;};return a280_0x32c1();}a280_0x340ba8();'use strict';var __decorate=this&&this[a280_0x46ed78(0x1a8)]||function(_0x5a6b59,_0x2356a1,_0x512fb0,_0x2e52b8){const _0x2caa14=a280_0x46ed78;var _0x167e80=arguments[_0x2caa14(0x1b7)],_0x57b2b4=_0x167e80<0x3?_0x2356a1:_0x2e52b8===null?_0x2e52b8=Object[_0x2caa14(0x173)](_0x2356a1,_0x512fb0):_0x2e52b8,_0xc417d0;if(typeof Reflect===_0x2caa14(0x1aa)&&typeof Reflect[_0x2caa14(0x1bb)]===_0x2caa14(0x1bf))_0x57b2b4=Reflect[_0x2caa14(0x1bb)](_0x5a6b59,_0x2356a1,_0x512fb0,_0x2e52b8);else{for(var _0x2d9c56=_0x5a6b59[_0x2caa14(0x1b7)]-0x1;_0x2d9c56>=0x0;_0x2d9c56--)if(_0xc417d0=_0x5a6b59[_0x2d9c56])_0x57b2b4=(_0x167e80<0x3?_0xc417d0(_0x57b2b4):_0x167e80>0x3?_0xc417d0(_0x2356a1,_0x512fb0,_0x57b2b4):_0xc417d0(_0x2356a1,_0x512fb0))||_0x57b2b4;}return _0x167e80>0x3&&_0x57b2b4&&Object[_0x2caa14(0x192)](_0x2356a1,_0x512fb0,_0x57b2b4),_0x57b2b4;},__metadata=this&&this[a280_0x46ed78(0x170)]||function(_0x517882,_0x3ad2ab){const _0x484fa5=a280_0x46ed78;if(typeof Reflect==='object'&&typeof Reflect[_0x484fa5(0x194)]===_0x484fa5(0x1bf))return Reflect[_0x484fa5(0x194)](_0x517882,_0x3ad2ab);};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a280_0x46ed78(0x190)]=void 0x0;const typedi_1=require(a280_0x46ed78(0x182)),constants_1=require(a280_0x46ed78(0x1a4)),errors_1=require(a280_0x46ed78(0x183)),utils_1=require(a280_0x46ed78(0x18d)),flosum_repository_sync_dto_1=require(a280_0x46ed78(0x177)),not_found_error_1=require(a280_0x46ed78(0x196)),queries_1=require('../queries'),salesforce_query_service_1=require(a280_0x46ed78(0x197)),salesforce_service_1=require(a280_0x46ed78(0x181));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x490583,_0x4605c7){this['salesforceQuery']=_0x490583,this['salesforceService']=_0x4605c7;}async[a280_0x46ed78(0x1a3)](_0x4a18c2){const _0x2006f1=a280_0x46ed78;var _0x5c3b5a;const _0x4ce362=await this[_0x2006f1(0x1b6)][_0x2006f1(0x1ae)](_0x4a18c2),_0x8d1c7d=[];for(const _0x5d8d48 of _0x4ce362){const _0x1bb7d9=(_0x5c3b5a=_0x5d8d48[constants_1[_0x2006f1(0x1b0)]+'Components__r'])===null||_0x5c3b5a===void 0x0?void 0x0:_0x5c3b5a['records'];_0x1bb7d9&&_0x1bb7d9[_0x2006f1(0x1b7)]&&_0x8d1c7d[_0x2006f1(0x18c)](_0x1bb7d9[0x0]['Id']);}return _0x8d1c7d;}async[a280_0x46ed78(0x1c3)](_0x941f6d){const _0x40f2c9=a280_0x46ed78,_0x2047b6=await this['salesforceQuery'][_0x40f2c9(0x1ae)](queries_1['GET_REPOSITORIES_NAMES_QUERY'][_0x40f2c9(0x1a9)](/\%connection_id\%/g,_0x941f6d));return _0x2047b6[_0x40f2c9(0x17e)](_0x131e6c=>{const _0x17054c=_0x40f2c9;return _0x131e6c[constants_1[_0x17054c(0x19c)]+'Repository__r']?_0x131e6c[constants_1[_0x17054c(0x19c)]+_0x17054c(0x185)][_0x17054c(0x1a0)]:_0x131e6c[_0x17054c(0x1a0)];});}async['getRepositoryRecords'](_0x160782){const _0x141d60=a280_0x46ed78,_0x8d94f0=await this[_0x141d60(0x1b6)]['query'](queries_1['GET_WAITING_REPOSITORIES_QUERY'][_0x141d60(0x1a9)](/\%connection_id\%/g,_0x160782));return _0x8d94f0[_0x141d60(0x17e)](_0x3f8edc=>flosum_repository_sync_dto_1[_0x141d60(0x187)][_0x141d60(0x1bd)](_0x3f8edc));}async[a280_0x46ed78(0x171)](_0x2891ca){const _0x50df5a=a280_0x46ed78,_0x3b0061=await this[_0x50df5a(0x1b6)][_0x50df5a(0x1ae)](queries_1['GET_WAITING_BRANCHES_QUERY'][_0x50df5a(0x1a9)](/%repositories_ids\%/g,_0x2891ca));return _0x3b0061[_0x50df5a(0x17e)](_0x458b52=>flosum_repository_sync_dto_1[_0x50df5a(0x187)][_0x50df5a(0x199)](_0x458b52));}async['getRepositoryRecord'](_0x1953df){const _0x4bfa1f=a280_0x46ed78,_0x273bab=await this[_0x4bfa1f(0x1b6)]['query'](queries_1[_0x4bfa1f(0x1ad)][_0x4bfa1f(0x1a9)](_0x4bfa1f(0x19a),_0x1953df));if(_0x273bab[_0x4bfa1f(0x1b7)]===0x0)throw new not_found_error_1[(_0x4bfa1f(0x1a5))]('Repository\x20with\x20Id\x20'+_0x1953df+_0x4bfa1f(0x17b));return flosum_repository_sync_dto_1[_0x4bfa1f(0x187)][_0x4bfa1f(0x1bd)](_0x273bab[0x0]);}async['getBranchRecord'](_0x585d4a){const _0x3e7250=a280_0x46ed78,_0x222655=await this[_0x3e7250(0x1b6)][_0x3e7250(0x1ae)](queries_1['GET_BRANCH_QUERY'][_0x3e7250(0x1a9)]('%id%',_0x585d4a));if(_0x222655[_0x3e7250(0x1b7)]===0x0)throw new not_found_error_1[(_0x3e7250(0x1a5))](_0x3e7250(0x1c0)+_0x585d4a+_0x3e7250(0x17b));return flosum_repository_sync_dto_1[_0x3e7250(0x187)][_0x3e7250(0x199)](_0x222655[0x0]);}async['getBranchRecordByName'](_0x1d7e49){const _0x3552ed=a280_0x46ed78,_0x3db4af=await this[_0x3552ed(0x1b6)][_0x3552ed(0x1ae)](queries_1[_0x3552ed(0x189)][_0x3552ed(0x1a9)](_0x3552ed(0x18a),_0x1d7e49));if(_0x3db4af[_0x3552ed(0x1b7)]===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x1d7e49+'\x20not\x20found\x20on\x20salesforce');const _0xf385bf=_0x3db4af['find'](_0x473bd2=>_0x473bd2[constants_1[_0x3552ed(0x1b0)]+_0x3552ed(0x178)]===_0x1d7e49);if(!_0xf385bf)throw new not_found_error_1[(_0x3552ed(0x1a5))](_0x3552ed(0x19f)+_0x1d7e49+_0x3552ed(0x17b));return flosum_repository_sync_dto_1[_0x3552ed(0x187)]['fromBranchRecord'](_0xf385bf);}async[a280_0x46ed78(0x1c2)](_0x1333b7){const _0x566bd1=a280_0x46ed78,_0x30775d=await this[_0x566bd1(0x1b6)][_0x566bd1(0x1ae)](queries_1[_0x566bd1(0x19e)][_0x566bd1(0x1a9)](_0x566bd1(0x18a),_0x1333b7));if(_0x30775d['length']===0x0)throw new not_found_error_1[(_0x566bd1(0x1a5))](_0x566bd1(0x1be)+_0x1333b7+_0x566bd1(0x17b));return flosum_repository_sync_dto_1[_0x566bd1(0x187)][_0x566bd1(0x1bd)](_0x30775d[0x0]);}async[a280_0x46ed78(0x19b)](_0x5244aa){const _0x5847db=a280_0x46ed78,_0x28cb34=_0x5847db(0x1bc)+queries_1[_0x5847db(0x18f)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x5244aa+'\x27';return this['getComponents'](_0x28cb34);}async['getBranchComponents'](_0x1a4343){const _0x3cc7fb=a280_0x46ed78,_0x5b52e9=_0x3cc7fb(0x1c4)+queries_1[_0x3cc7fb(0x18f)]+_0x3cc7fb(0x1af)+_0x1a4343+'\x27';return this[_0x3cc7fb(0x1a3)](_0x5b52e9);}async['getAttachmentId'](_0x267710){const _0x175a92=a280_0x46ed78;var _0x4d6cc9;const _0x389742=queries_1[_0x175a92(0x17f)][_0x175a92(0x1a9)](_0x175a92(0x188),_0x267710[_0x175a92(0x1b2)])[_0x175a92(0x1a9)](_0x175a92(0x18a),_0x267710[_0x175a92(0x1a6)]?constants_1[_0x175a92(0x184)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x433262=await this['salesforceQuery'][_0x175a92(0x1ae)](_0x389742),_0x538348=(_0x4d6cc9=_0x433262[0x0])===null||_0x4d6cc9===void 0x0?void 0x0:_0x4d6cc9['Id'];if(!_0x538348)throw new Error(errors_1[_0x175a92(0x1ba)]);return _0x538348;}async[a280_0x46ed78(0x179)](_0x2dd818){const _0x306b89=a280_0x46ed78;let _0xcecbcc=await this[_0x306b89(0x174)](_0x2dd818)['catch'](()=>null);return!_0xcecbcc&&(_0xcecbcc=await this['salesforceService'][_0x306b89(0x1ab)](_0x306b89(0x18e),{'Body':(0x0,utils_1['encodeBase64'])('{}'),'ParentId':_0x2dd818['objectId'],'ContentType':'text/plain','Name':_0x2dd818[_0x306b89(0x1a6)]?constants_1[_0x306b89(0x184)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0xcecbcc;}async[a280_0x46ed78(0x198)](_0x489b1a,_0x3c0571){const _0xca33b5=a280_0x46ed78,_0x4da2a4=await this[_0xca33b5(0x179)](_0x489b1a);await this[_0xca33b5(0x1a7)][_0xca33b5(0x1c1)]('Attachment',_0x4da2a4,{'Body':(0x0,utils_1['encodeBase64'])(JSON[_0xca33b5(0x1b3)](_0x3c0571))});}async[a280_0x46ed78(0x17c)](_0x55b202,_0xe8f564){const _0x5ed073=a280_0x46ed78;await this[_0x5ed073(0x1a7)][_0x5ed073(0x1c1)](_0x55b202[_0x5ed073(0x191)],_0x55b202[_0x5ed073(0x1b2)],{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x5ed073(0x1a2)]:_0xe8f564});}async[a280_0x46ed78(0x172)](_0x347198){const _0x5ce82e=a280_0x46ed78;await this['salesforceService'][_0x5ce82e(0x1c1)](constants_1[_0x5ce82e(0x19c)]+_0x5ce82e(0x18b),_0x347198,{[constants_1[_0x5ce82e(0x19c)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([(0x0,typedi_1[a280_0x46ed78(0x19d)])(),__metadata('design:paramtypes',[salesforce_query_service_1[a280_0x46ed78(0x1b1)],salesforce_service_1[a280_0x46ed78(0x180)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;