const a270_0x68bb06=a270_0x19aa;(function(_0x437e24,_0x9d5bc8){const _0x4e33a7=a270_0x19aa,_0x58e100=_0x437e24();while(!![]){try{const _0x6904e9=parseInt(_0x4e33a7(0x150))/0x1+parseInt(_0x4e33a7(0x15c))/0x2*(-parseInt(_0x4e33a7(0x14d))/0x3)+-parseInt(_0x4e33a7(0x187))/0x4+parseInt(_0x4e33a7(0x1a0))/0x5+-parseInt(_0x4e33a7(0x16a))/0x6+-parseInt(_0x4e33a7(0x171))/0x7+-parseInt(_0x4e33a7(0x15b))/0x8*(-parseInt(_0x4e33a7(0x154))/0x9);if(_0x6904e9===_0x9d5bc8)break;else _0x58e100['push'](_0x58e100['shift']());}catch(_0x54dc5d){_0x58e100['push'](_0x58e100['shift']());}}}(a270_0x52f7,0x835fb));const a270_0x5115f3=(function(){let _0x47e5fb=!![];return function(_0x463bff,_0x25195e){const _0x213fb3=_0x47e5fb?function(){const _0x38b64c=a270_0x19aa;if(_0x25195e){const _0x33271a=_0x25195e[_0x38b64c(0x19e)](_0x463bff,arguments);return _0x25195e=null,_0x33271a;}}:function(){};return _0x47e5fb=![],_0x213fb3;};}()),a270_0x2502fe=a270_0x5115f3(this,function(){const _0x3f673d=a270_0x19aa;return a270_0x2502fe[_0x3f673d(0x193)]()[_0x3f673d(0x152)](_0x3f673d(0x199))[_0x3f673d(0x193)]()[_0x3f673d(0x17c)](a270_0x2502fe)['search'](_0x3f673d(0x199));});function a270_0x19aa(_0xb8d662,_0x1a0d36){const _0x596525=a270_0x52f7();return a270_0x19aa=function(_0x2502fe,_0x5115f3){_0x2502fe=_0x2502fe-0x144;let _0x52f7e0=_0x596525[_0x2502fe];return _0x52f7e0;},a270_0x19aa(_0xb8d662,_0x1a0d36);}a270_0x2502fe();'use strict';var __createBinding=this&&this[a270_0x68bb06(0x163)]||(Object[a270_0x68bb06(0x147)]?function(_0x21b184,_0x310577,_0x1ffe90,_0x2e18a9){const _0x3eb183=a270_0x68bb06;if(_0x2e18a9===undefined)_0x2e18a9=_0x1ffe90;var _0x4f3102=Object['getOwnPropertyDescriptor'](_0x310577,_0x1ffe90);(!_0x4f3102||(_0x3eb183(0x197)in _0x4f3102?!_0x310577[_0x3eb183(0x177)]:_0x4f3102[_0x3eb183(0x16b)]||_0x4f3102[_0x3eb183(0x18f)]))&&(_0x4f3102={'enumerable':!![],'get':function(){return _0x310577[_0x1ffe90];}}),Object[_0x3eb183(0x18c)](_0x21b184,_0x2e18a9,_0x4f3102);}:function(_0x40eecb,_0x17613,_0x5ab42c,_0x25a5dc){if(_0x25a5dc===undefined)_0x25a5dc=_0x5ab42c;_0x40eecb[_0x25a5dc]=_0x17613[_0x5ab42c];}),__setModuleDefault=this&&this[a270_0x68bb06(0x186)]||(Object[a270_0x68bb06(0x147)]?function(_0x7e6af7,_0x350f29){const _0xe78d5d=a270_0x68bb06;Object[_0xe78d5d(0x18c)](_0x7e6af7,_0xe78d5d(0x179),{'enumerable':!![],'value':_0x350f29});}:function(_0x49ec91,_0x5b879e){_0x49ec91['default']=_0x5b879e;}),__decorate=this&&this[a270_0x68bb06(0x158)]||function(_0xe0437f,_0x5b13a7,_0x354d70,_0xc7c121){const _0x2d2552=a270_0x68bb06;var _0x293bd9=arguments['length'],_0x495155=_0x293bd9<0x3?_0x5b13a7:_0xc7c121===null?_0xc7c121=Object[_0x2d2552(0x151)](_0x5b13a7,_0x354d70):_0xc7c121,_0x72d526;if(typeof Reflect===_0x2d2552(0x176)&&typeof Reflect[_0x2d2552(0x14b)]==='function')_0x495155=Reflect[_0x2d2552(0x14b)](_0xe0437f,_0x5b13a7,_0x354d70,_0xc7c121);else{for(var _0x26ba7e=_0xe0437f[_0x2d2552(0x161)]-0x1;_0x26ba7e>=0x0;_0x26ba7e--)if(_0x72d526=_0xe0437f[_0x26ba7e])_0x495155=(_0x293bd9<0x3?_0x72d526(_0x495155):_0x293bd9>0x3?_0x72d526(_0x5b13a7,_0x354d70,_0x495155):_0x72d526(_0x5b13a7,_0x354d70))||_0x495155;}return _0x293bd9>0x3&&_0x495155&&Object[_0x2d2552(0x18c)](_0x5b13a7,_0x354d70,_0x495155),_0x495155;},__importStar=this&&this[a270_0x68bb06(0x191)]||function(_0x308194){const _0x342558=a270_0x68bb06;if(_0x308194&&_0x308194[_0x342558(0x177)])return _0x308194;var _0x595df0={};if(_0x308194!=null){for(var _0x164257 in _0x308194)if(_0x164257!==_0x342558(0x179)&&Object['prototype'][_0x342558(0x16f)][_0x342558(0x164)](_0x308194,_0x164257))__createBinding(_0x595df0,_0x308194,_0x164257);}return __setModuleDefault(_0x595df0,_0x308194),_0x595df0;},__metadata=this&&this[a270_0x68bb06(0x168)]||function(_0x155a82,_0x3ad6e7){const _0x4793d1=a270_0x68bb06;if(typeof Reflect===_0x4793d1(0x176)&&typeof Reflect[_0x4793d1(0x184)]===_0x4793d1(0x174))return Reflect[_0x4793d1(0x184)](_0x155a82,_0x3ad6e7);},__importDefault=this&&this['__importDefault']||function(_0x499170){const _0x335612=a270_0x68bb06;return _0x499170&&_0x499170[_0x335612(0x177)]?_0x499170:{'default':_0x499170};},SalesforceAuthService_1;Object[a270_0x68bb06(0x18c)](exports,a270_0x68bb06(0x177),{'value':!![]}),exports[a270_0x68bb06(0x159)]=void 0x0;const typedi_1=__importStar(require(a270_0x68bb06(0x148))),errors_1=require('../../../../constants/errors'),core_1=require('../../../../core'),axios_1=__importDefault(require(a270_0x68bb06(0x16e))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a270_0x68bb06(0x17a)),auth_state_enum_1=require(a270_0x68bb06(0x1a2)),unauthorized_salesforce_error_1=require(a270_0x68bb06(0x185)),constants_1=require(a270_0x68bb06(0x144)),providers_tokens_1=require(a270_0x68bb06(0x17b)),salesforce_1=require(a270_0x68bb06(0x180));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x18d379=a270_0x68bb06;this[_0x18d379(0x16c)]=0x1388,this[_0x18d379(0x190)]=auth_state_enum_1[_0x18d379(0x1a3)][_0x18d379(0x166)],this[_0x18d379(0x156)]=new core_1[(_0x18d379(0x189))](SalesforceAuthService_1[_0x18d379(0x18e)]),this['setAuthDetails']();}async[a270_0x68bb06(0x1a1)](){const _0x11dd7e=a270_0x68bb06;this[_0x11dd7e(0x156)][_0x11dd7e(0x17f)](_0x11dd7e(0x1a5),auth_state_enum_1[_0x11dd7e(0x1a3)][this['authState']]);try{if(this[_0x11dd7e(0x190)]===auth_state_enum_1[_0x11dd7e(0x1a3)][_0x11dd7e(0x1a4)])return;if(this[_0x11dd7e(0x190)]===auth_state_enum_1[_0x11dd7e(0x1a3)][_0x11dd7e(0x166)])await this[_0x11dd7e(0x192)]();else{const _0x1a625f=await this[_0x11dd7e(0x169)](),_0x5d5594=await axios_1[_0x11dd7e(0x179)]['get'](_0x11dd7e(0x19d)+constants_1[_0x11dd7e(0x19b)],_0x1a625f)[_0x11dd7e(0x18d)](()=>!![])[_0x11dd7e(0x149)](()=>![]);!_0x5d5594&&await this[_0x11dd7e(0x192)]();}}catch(_0x19b66b){}}async[a270_0x68bb06(0x192)](){const _0x32e506=a270_0x68bb06;var _0x201b84,_0x2c3257,_0x165d36;this[_0x32e506(0x156)]['log'](_0x32e506(0x182));try{this[_0x32e506(0x190)]=auth_state_enum_1[_0x32e506(0x1a3)][_0x32e506(0x15f)];const {refreshToken:_0x42b012,clientId:_0x27904c,clientSecret:_0x527eda,loginUrl:_0x184a1c}=typedi_1[_0x32e506(0x179)][_0x32e506(0x197)](providers_tokens_1['Tokens']['salesforce']),{data:_0xfe9ced}=await axios_1[_0x32e506(0x179)][_0x32e506(0x19c)]((0x0,utils_1[_0x32e506(0x17d)])(_0x184a1c,_0x32e506(0x170)),null,{'params':{'grant_type':_0x32e506(0x15d),'refresh_token':_0x42b012,'client_id':_0x27904c,'client_secret':_0x527eda}});this['instanceUrl']=_0xfe9ced[_0x32e506(0x198)],this[_0x32e506(0x160)]=_0xfe9ced[_0x32e506(0x15a)],this['tokenType']=_0xfe9ced[_0x32e506(0x175)],this['authState']=auth_state_enum_1[_0x32e506(0x1a3)][_0x32e506(0x188)],this[_0x32e506(0x156)]['log'](_0x32e506(0x18a),this[_0x32e506(0x16d)]);}catch(_0x563c9f){const _0xb5a27a=((_0x2c3257=(_0x201b84=_0x563c9f===null||_0x563c9f===void 0x0?void 0x0:_0x563c9f['response'])===null||_0x201b84===void 0x0?void 0x0:_0x201b84[_0x32e506(0x162)])===null||_0x2c3257===void 0x0?void 0x0:_0x2c3257['error'])||((_0x165d36=_0x563c9f===null||_0x563c9f===void 0x0?void 0x0:_0x563c9f[_0x32e506(0x181)])===null||_0x165d36===void 0x0?void 0x0:_0x165d36[_0x32e506(0x162)])||_0x563c9f[_0x32e506(0x178)];this[_0x32e506(0x156)][_0x32e506(0x14a)](_0x32e506(0x153),_0xb5a27a),this[_0x32e506(0x190)]=auth_state_enum_1[_0x32e506(0x1a3)][_0x32e506(0x1a4)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x32e506(0x14f)]);}}async[a270_0x68bb06(0x19f)](){const _0x231278=a270_0x68bb06;this['logger'][_0x231278(0x17f)](_0x231278(0x165));if(this[_0x231278(0x190)]===auth_state_enum_1['AuthState']['Updating']||this[_0x231278(0x190)]===auth_state_enum_1[_0x231278(0x1a3)]['Idle'])return await(0x0,utils_1['sleep'])(this[_0x231278(0x16c)]),this['forceUpdateToken']();if(this['authState']===auth_state_enum_1[_0x231278(0x1a3)][_0x231278(0x1a4)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x231278(0x14f)]);await this[_0x231278(0x192)]();}async[a270_0x68bb06(0x14c)](){const _0x1b0d91=a270_0x68bb06;if(this[_0x1b0d91(0x190)]===auth_state_enum_1[_0x1b0d91(0x1a3)][_0x1b0d91(0x1a4)]){this['logger'][_0x1b0d91(0x17f)](_0x1b0d91(0x172));throw new unauthorized_salesforce_error_1[(_0x1b0d91(0x194))]();}if(this['authState']!==auth_state_enum_1['AuthState']['Active'])return this[_0x1b0d91(0x156)][_0x1b0d91(0x17f)](_0x1b0d91(0x17e)),await(0x0,utils_1[_0x1b0d91(0x173)])(this[_0x1b0d91(0x16c)]),this[_0x1b0d91(0x14c)]();}[a270_0x68bb06(0x1a6)](){const _0x1cfd2b=a270_0x68bb06;return{'orgId':this[_0x1cfd2b(0x155)],'accessToken':this['accessToken'],'instanceUrl':this[_0x1cfd2b(0x16d)]};}async[a270_0x68bb06(0x169)](_0x4166a2=''){const _0x50d0fd=a270_0x68bb06;await this[_0x50d0fd(0x14c)]();const _0xd414c6={'baseURL':this['instanceUrl'],'headers':{'accept':_0x50d0fd(0x157)}};if(salesforce_1[_0x50d0fd(0x14e)][_0x50d0fd(0x19a)](_0x4166a2))_0xd414c6[_0x50d0fd(0x146)][_0x50d0fd(0x167)]=this['accessToken'];else salesforce_1[_0x50d0fd(0x14e)][_0x50d0fd(0x195)](_0x4166a2)?_0xd414c6[_0x50d0fd(0x162)]=_0xd414c6['data'][_0x50d0fd(0x145)](/<met:sessionId>.+?<\/met:sessionId>/,_0x50d0fd(0x15e)+this[_0x50d0fd(0x160)]+'</met:sessionId>'):_0xd414c6[_0x50d0fd(0x146)][_0x50d0fd(0x183)]=this[_0x50d0fd(0x196)]+'\x20'+this[_0x50d0fd(0x160)];return _0xd414c6;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a270_0x68bb06(0x18b),[])],SalesforceAuthService),exports[a270_0x68bb06(0x159)]=SalesforceAuthService;function a270_0x52f7(){const _0x5a70a5=['4975458QIgLtp','writable','AUTH_WAIT_TIME','instanceUrl','axios','hasOwnProperty','/services/oauth2/token','3345881Yohmok','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','sleep','function','token_type','object','__esModule','message','default','../errors/invalid-refresh-token.error','../../providers/providers.tokens','constructor','joinURL','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','log','@flosum/salesforce','response','Update\x20access\x20token','authorization','metadata','../errors/unauthorized-salesforce.error','__setModuleDefault','2631624dbseew','Active','Logger','Access\x20token\x20updated\x20for\x20%s','design:paramtypes','defineProperty','then','name','configurable','authState','__importStar','updateAccessToken','toString','UnauthorizedSalesforceError','isSoapUrl','tokenType','get','instance_url','(((.+)+)+)+$','isBulk1Url','SALESFORCE_API_VERSION','post','services/data/','apply','forceUpdateToken','1812515ZztQGY','setAuthDetails','../enums/auth-state.enum','AuthState','Error','Check\x20auth:\x20current\x20state\x20-\x20%s','getAuthData','../../../../constants','replace','headers','create','typedi','catch','error','decorate','waitAuth','381BnllbD','SalesforceUtils','ERR_INVALID_SALESFORCE_TOKEN','11079aJmbyw','getOwnPropertyDescriptor','search','Update\x20access\x20token\x20failed:\x20%s','1573731OUCsEk','orgId','logger','application/json','__decorate','SalesforceAuthService','access_token','104Hyqelz','2260xaJCrf','refresh_token','<met:sessionId>','Updating','accessToken','length','data','__createBinding','call','Force\x20update\x20token','Idle','X-SFDC-Session','__metadata','requestConfig'];a270_0x52f7=function(){return _0x5a70a5;};return a270_0x52f7();}