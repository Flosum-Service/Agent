const a192_0x5dea41=a192_0x3f84;function a192_0x3f84(_0x31a8e8,_0x7d72bd){const _0x514c97=a192_0x2ce2();return a192_0x3f84=function(_0x4457d7,_0x532d1c){_0x4457d7=_0x4457d7-0x1ea;let _0x2ce230=_0x514c97[_0x4457d7];return _0x2ce230;},a192_0x3f84(_0x31a8e8,_0x7d72bd);}(function(_0x40c3d,_0x578df8){const _0x346cf5=a192_0x3f84,_0x4a7585=_0x40c3d();while(!![]){try{const _0x23f15a=-parseInt(_0x346cf5(0x233))/0x1*(parseInt(_0x346cf5(0x21e))/0x2)+parseInt(_0x346cf5(0x217))/0x3*(parseInt(_0x346cf5(0x236))/0x4)+parseInt(_0x346cf5(0x230))/0x5+parseInt(_0x346cf5(0x1f1))/0x6*(-parseInt(_0x346cf5(0x227))/0x7)+-parseInt(_0x346cf5(0x23f))/0x8*(-parseInt(_0x346cf5(0x23b))/0x9)+parseInt(_0x346cf5(0x1fa))/0xa+-parseInt(_0x346cf5(0x215))/0xb*(-parseInt(_0x346cf5(0x212))/0xc);if(_0x23f15a===_0x578df8)break;else _0x4a7585['push'](_0x4a7585['shift']());}catch(_0x3c790a){_0x4a7585['push'](_0x4a7585['shift']());}}}(a192_0x2ce2,0xe509d));const a192_0x532d1c=(function(){let _0x887505=!![];return function(_0x558402,_0x41bd22){const _0x4d5a27=_0x887505?function(){const _0x34b945=a192_0x3f84;if(_0x41bd22){const _0x51a012=_0x41bd22[_0x34b945(0x20c)](_0x558402,arguments);return _0x41bd22=null,_0x51a012;}}:function(){};return _0x887505=![],_0x4d5a27;};}()),a192_0x4457d7=a192_0x532d1c(this,function(){const _0x3b96da=a192_0x3f84;return a192_0x4457d7[_0x3b96da(0x1f2)]()['search'](_0x3b96da(0x1ee))[_0x3b96da(0x1f2)]()[_0x3b96da(0x22f)](a192_0x4457d7)['search'](_0x3b96da(0x1ee));});a192_0x4457d7();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a192_0x5dea41(0x209)]?function(_0x4b3047,_0x31b6e6,_0x16a932,_0x529a49){const _0x559531=a192_0x5dea41;if(_0x529a49===undefined)_0x529a49=_0x16a932;var _0x137980=Object['getOwnPropertyDescriptor'](_0x31b6e6,_0x16a932);(!_0x137980||(_0x559531(0x218)in _0x137980?!_0x31b6e6[_0x559531(0x23e)]:_0x137980[_0x559531(0x231)]||_0x137980[_0x559531(0x20d)]))&&(_0x137980={'enumerable':!![],'get':function(){return _0x31b6e6[_0x16a932];}}),Object['defineProperty'](_0x4b3047,_0x529a49,_0x137980);}:function(_0x3e2cb3,_0xe1b149,_0x16df80,_0x4d7a4c){if(_0x4d7a4c===undefined)_0x4d7a4c=_0x16df80;_0x3e2cb3[_0x4d7a4c]=_0xe1b149[_0x16df80];}),__setModuleDefault=this&&this[a192_0x5dea41(0x240)]||(Object[a192_0x5dea41(0x209)]?function(_0x3feed4,_0x139783){const _0x264922=a192_0x5dea41;Object[_0x264922(0x20b)](_0x3feed4,_0x264922(0x225),{'enumerable':!![],'value':_0x139783});}:function(_0x595c27,_0x3b2735){const _0x4b1dc5=a192_0x5dea41;_0x595c27[_0x4b1dc5(0x225)]=_0x3b2735;}),__decorate=this&&this[a192_0x5dea41(0x204)]||function(_0x522cca,_0x2db3e3,_0x1d54fc,_0x3fa95f){const _0x1a51ac=a192_0x5dea41;var _0x4b01f7=arguments[_0x1a51ac(0x228)],_0xb4d925=_0x4b01f7<0x3?_0x2db3e3:_0x3fa95f===null?_0x3fa95f=Object[_0x1a51ac(0x1ed)](_0x2db3e3,_0x1d54fc):_0x3fa95f,_0x57d7ca;if(typeof Reflect===_0x1a51ac(0x1fd)&&typeof Reflect[_0x1a51ac(0x21c)]===_0x1a51ac(0x1ea))_0xb4d925=Reflect['decorate'](_0x522cca,_0x2db3e3,_0x1d54fc,_0x3fa95f);else{for(var _0x8e9980=_0x522cca[_0x1a51ac(0x228)]-0x1;_0x8e9980>=0x0;_0x8e9980--)if(_0x57d7ca=_0x522cca[_0x8e9980])_0xb4d925=(_0x4b01f7<0x3?_0x57d7ca(_0xb4d925):_0x4b01f7>0x3?_0x57d7ca(_0x2db3e3,_0x1d54fc,_0xb4d925):_0x57d7ca(_0x2db3e3,_0x1d54fc))||_0xb4d925;}return _0x4b01f7>0x3&&_0xb4d925&&Object['defineProperty'](_0x2db3e3,_0x1d54fc,_0xb4d925),_0xb4d925;},__importStar=this&&this['__importStar']||function(_0x52638d){const _0x1fc4b2=a192_0x5dea41;if(_0x52638d&&_0x52638d['__esModule'])return _0x52638d;var _0x524a9a={};if(_0x52638d!=null){for(var _0x5648ac in _0x52638d)if(_0x5648ac!==_0x1fc4b2(0x225)&&Object[_0x1fc4b2(0x206)][_0x1fc4b2(0x1f0)]['call'](_0x52638d,_0x5648ac))__createBinding(_0x524a9a,_0x52638d,_0x5648ac);}return __setModuleDefault(_0x524a9a,_0x52638d),_0x524a9a;},__metadata=this&&this[a192_0x5dea41(0x216)]||function(_0x55c303,_0x370ad0){const _0x52346c=a192_0x5dea41;if(typeof Reflect===_0x52346c(0x1fd)&&typeof Reflect['metadata']===_0x52346c(0x1ea))return Reflect[_0x52346c(0x234)](_0x55c303,_0x370ad0);},__importDefault=this&&this[a192_0x5dea41(0x21b)]||function(_0x208029){const _0x4f3916=a192_0x5dea41;return _0x208029&&_0x208029[_0x4f3916(0x23e)]?_0x208029:{'default':_0x208029};},SalesforceAuthService_1;Object[a192_0x5dea41(0x20b)](exports,'__esModule',{'value':!![]}),exports['SalesforceAuthService']=void 0x0;function a192_0x2ce2(){const _0x18ced6=['authState','__importDefault','decorate','response','128rMDzJg','typedi','name','../../../shared/utils','access_token','waitAuth','AUTH_WAIT_TIME','default','axios','126jjZauz','length','refresh_token','../../../../constants','SALESFORCE_API_VERSION','AuthState','Active','services/data/','constructor','1935250JLlUxm','writable','Tokens','24973loDfdz','metadata','update\x20access\x20token','764QGGCcJ','check\x20auth:\x20current\x20state\x20-\x20%s','UnauthorizedSalesforceError','ERR_INVALID_SALESFORCE_TOKEN','design:paramtypes','1488735MxQaMc','accessToken','../errors/invalid-refresh-token.error','__esModule','16TJhYfc','__setModuleDefault','force\x20update\x20token','function','../../../../constants/errors','Idle','getOwnPropertyDescriptor','(((.+)+)+)+$','log','hasOwnProperty','292962WSptfX','toString','logger','salesforce','../errors/unauthorized-salesforce.error','requestConfig','message','Error','tokenType','9744510tNzhxt','catch','updateAccessToken','object','../../../../core','create\x20authorized\x20request\x20failed:\x20authorization\x20error','sleep','update\x20access\x20token\x20failed:\x20%s','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','Updating','__decorate','data','prototype','Service','application/json','create','forceUpdateToken','defineProperty','apply','configurable','joinURL','setAuthDetails','post','SalesforceAuthService','12SLFlna','/services/oauth2/token','error','7382441sOdjrI','__metadata','16521sfbgXT','get','instanceUrl'];a192_0x2ce2=function(){return _0x18ced6;};return a192_0x2ce2();}const typedi_1=__importStar(require(a192_0x5dea41(0x21f))),errors_1=require(a192_0x5dea41(0x1eb)),core_1=require(a192_0x5dea41(0x1fe)),axios_1=__importDefault(require(a192_0x5dea41(0x226))),utils_1=require(a192_0x5dea41(0x221)),invalid_refresh_token_error_1=require(a192_0x5dea41(0x23d)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a192_0x5dea41(0x1f5)),constants_1=require(a192_0x5dea41(0x22a)),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x384146=a192_0x5dea41;this[_0x384146(0x224)]=0x1388,this['authState']=auth_state_enum_1[_0x384146(0x22c)][_0x384146(0x1ec)],this['logger']=new core_1['Logger'](SalesforceAuthService_1[_0x384146(0x220)]),this['setAuthDetails']();}async[a192_0x5dea41(0x20f)](){const _0x3b2b94=a192_0x5dea41;this[_0x3b2b94(0x1f3)][_0x3b2b94(0x1ef)](_0x3b2b94(0x237),auth_state_enum_1[_0x3b2b94(0x22c)][this['authState']]);try{if(this[_0x3b2b94(0x21a)]===auth_state_enum_1[_0x3b2b94(0x22c)][_0x3b2b94(0x1f8)])return;if(this[_0x3b2b94(0x21a)]===auth_state_enum_1['AuthState'][_0x3b2b94(0x1ec)])await this['updateAccessToken']();else{const _0x49baab=await this[_0x3b2b94(0x1f6)](),_0x39a0f0=await axios_1[_0x3b2b94(0x225)]['get'](_0x3b2b94(0x22e)+constants_1[_0x3b2b94(0x22b)],_0x49baab)['then'](()=>!![])[_0x3b2b94(0x1fb)](()=>![]);!_0x39a0f0&&await this[_0x3b2b94(0x1fc)]();}}catch(_0x3e6ad7){}}async[a192_0x5dea41(0x1fc)](){const _0x13d086=a192_0x5dea41;var _0x44ef19,_0x26e3c6,_0xd4cc9b;this[_0x13d086(0x1f3)][_0x13d086(0x1ef)](_0x13d086(0x235));try{this['authState']=auth_state_enum_1[_0x13d086(0x22c)][_0x13d086(0x203)];const {refreshToken:_0x47513e,clientId:_0x257cd4,clientSecret:_0x305642,loginUrl:_0x1eddd0}=typedi_1[_0x13d086(0x225)][_0x13d086(0x218)](providers_tokens_1[_0x13d086(0x232)][_0x13d086(0x1f4)]),{data:_0x5c9ff9}=await axios_1[_0x13d086(0x225)][_0x13d086(0x210)]((0x0,utils_1[_0x13d086(0x20e)])(_0x1eddd0,_0x13d086(0x213)),null,{'params':{'grant_type':_0x13d086(0x229),'refresh_token':_0x47513e,'client_id':_0x257cd4,'client_secret':_0x305642}});this[_0x13d086(0x219)]=_0x5c9ff9['instance_url'],this[_0x13d086(0x23c)]=_0x5c9ff9[_0x13d086(0x222)],this['tokenType']=_0x5c9ff9['token_type'],this[_0x13d086(0x21a)]=auth_state_enum_1[_0x13d086(0x22c)][_0x13d086(0x22d)],this['logger'][_0x13d086(0x1ef)]('access\x20token\x20updated\x20for\x20%s',this[_0x13d086(0x219)]);}catch(_0x422785){const _0xe3dc80=((_0x26e3c6=(_0x44ef19=_0x422785===null||_0x422785===void 0x0?void 0x0:_0x422785[_0x13d086(0x21d)])===null||_0x44ef19===void 0x0?void 0x0:_0x44ef19['data'])===null||_0x26e3c6===void 0x0?void 0x0:_0x26e3c6[_0x13d086(0x214)])||((_0xd4cc9b=_0x422785===null||_0x422785===void 0x0?void 0x0:_0x422785[_0x13d086(0x21d)])===null||_0xd4cc9b===void 0x0?void 0x0:_0xd4cc9b[_0x13d086(0x205)])||_0x422785[_0x13d086(0x1f7)];this[_0x13d086(0x1f3)][_0x13d086(0x214)](_0x13d086(0x201),_0xe3dc80),this[_0x13d086(0x21a)]=auth_state_enum_1[_0x13d086(0x22c)][_0x13d086(0x1f8)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a192_0x5dea41(0x20a)](){const _0x22ebad=a192_0x5dea41;this[_0x22ebad(0x1f3)][_0x22ebad(0x1ef)](_0x22ebad(0x241));if(this[_0x22ebad(0x21a)]===auth_state_enum_1[_0x22ebad(0x22c)][_0x22ebad(0x203)]||this[_0x22ebad(0x21a)]===auth_state_enum_1[_0x22ebad(0x22c)][_0x22ebad(0x1ec)])return await(0x0,utils_1[_0x22ebad(0x200)])(this[_0x22ebad(0x224)]),this[_0x22ebad(0x20a)]();if(this[_0x22ebad(0x21a)]===auth_state_enum_1['AuthState'][_0x22ebad(0x1f8)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x22ebad(0x239)]);await this[_0x22ebad(0x1fc)]();}async['waitAuth'](){const _0x5b9ad3=a192_0x5dea41;if(this[_0x5b9ad3(0x21a)]===auth_state_enum_1[_0x5b9ad3(0x22c)][_0x5b9ad3(0x1f8)]){this[_0x5b9ad3(0x1f3)][_0x5b9ad3(0x1ef)](_0x5b9ad3(0x1ff));throw new unauthorized_salesforce_error_1[(_0x5b9ad3(0x238))]();}if(this[_0x5b9ad3(0x21a)]!==auth_state_enum_1[_0x5b9ad3(0x22c)][_0x5b9ad3(0x22d)])return this['logger'][_0x5b9ad3(0x1ef)](_0x5b9ad3(0x202)),await(0x0,utils_1[_0x5b9ad3(0x200)])(this[_0x5b9ad3(0x224)]),this['waitAuth']();}['getAuthData'](){const _0x3053b8=a192_0x5dea41;return{'orgId':this['orgId'],'accessToken':this[_0x3053b8(0x23c)],'instanceUrl':this[_0x3053b8(0x219)]};}async[a192_0x5dea41(0x1f6)](){const _0x32c31f=a192_0x5dea41;return await this[_0x32c31f(0x223)](),{'baseURL':this[_0x32c31f(0x219)],'headers':{'accept':_0x32c31f(0x208),'authorization':this[_0x32c31f(0x1f9)]+'\x20'+this[_0x32c31f(0x23c)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a192_0x5dea41(0x207)])(),__metadata(a192_0x5dea41(0x23a),[])],SalesforceAuthService),exports[a192_0x5dea41(0x211)]=SalesforceAuthService;