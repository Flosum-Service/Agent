const a226_0xb5b8a2=a226_0x40c3;(function(_0x52eb9f,_0x248c5b){const _0x8fb73c=a226_0x40c3,_0x594657=_0x52eb9f();while(!![]){try{const _0x1ac908=-parseInt(_0x8fb73c(0xec))/0x1*(-parseInt(_0x8fb73c(0xdb))/0x2)+parseInt(_0x8fb73c(0xfc))/0x3+-parseInt(_0x8fb73c(0x108))/0x4+parseInt(_0x8fb73c(0xef))/0x5*(parseInt(_0x8fb73c(0xf1))/0x6)+parseInt(_0x8fb73c(0xc8))/0x7+-parseInt(_0x8fb73c(0x119))/0x8*(-parseInt(_0x8fb73c(0xcc))/0x9)+-parseInt(_0x8fb73c(0xce))/0xa*(parseInt(_0x8fb73c(0xe3))/0xb);if(_0x1ac908===_0x248c5b)break;else _0x594657['push'](_0x594657['shift']());}catch(_0x4e7302){_0x594657['push'](_0x594657['shift']());}}}(a226_0x1889,0xc228b));const a226_0x137d3c=(function(){let _0x5a0101=!![];return function(_0x93f42f,_0xc6d6b4){const _0x2a1271=_0x5a0101?function(){if(_0xc6d6b4){const _0x4274d7=_0xc6d6b4['apply'](_0x93f42f,arguments);return _0xc6d6b4=null,_0x4274d7;}}:function(){};return _0x5a0101=![],_0x2a1271;};}()),a226_0x4d2ef8=a226_0x137d3c(this,function(){const _0x21ea56=a226_0x40c3;return a226_0x4d2ef8['toString']()[_0x21ea56(0xd2)]('(((.+)+)+)+$')[_0x21ea56(0xfa)]()['constructor'](a226_0x4d2ef8)['search'](_0x21ea56(0xee));});function a226_0x1889(){const _0x487935=['object','Service','__decorate','salesforce','../../../../core','joinURL','__createBinding','../../../../constants/errors','defineProperty','application/json','create\x20authorized\x20request\x20failed:\x20authorization\x20error','design:paramtypes','update\x20access\x20token\x20failed:\x20%s','16IXSqUA','Active','../errors/unauthorized-salesforce.error','length','logger','force\x20update\x20token','4980248CdSUDr','check\x20auth:\x20current\x20state\x20-\x20%s','__importDefault','post','3246066NrBPUc','setAuthDetails','5908090zWOLtE','ERR_INVALID_SALESFORCE_TOKEN','call','message','search','update\x20access\x20token','__esModule','SALESFORCE_API_VERSION','../../../../constants','waitAuth','InvalidRefreshTokenError','__importStar','../../../shared/utils','775018BUkVKA','Idle','axios','error','refresh_token','function','/services/oauth2/token','getAuthData','22JMXINf','forceUpdateToken','name','sleep','response','typedi','access\x20token\x20updated\x20for\x20%s','access_token','../errors/invalid-refresh-token.error','2NuXqBz','instanceUrl','(((.+)+)+)+$','860lAbwkY','metadata','10308ibGPnn','Logger','Error','log','token_type','create','../enums/auth-state.enum','AUTH_WAIT_TIME','data','toString','writable','1677789bcDdRi','tokenType','orgId','getOwnPropertyDescriptor','configurable','get','../../providers/providers.tokens','AuthState','default','services/data/','requestConfig','Updating','4342784WXxrhG','decorate','Tokens','authState'];a226_0x1889=function(){return _0x487935;};return a226_0x1889();}a226_0x4d2ef8();'use strict';var __createBinding=this&&this[a226_0xb5b8a2(0x112)]||(Object[a226_0xb5b8a2(0xf6)]?function(_0x5da725,_0x45f930,_0x15d59d,_0x691d62){const _0x4c6281=a226_0xb5b8a2;if(_0x691d62===undefined)_0x691d62=_0x15d59d;var _0x273a70=Object[_0x4c6281(0xff)](_0x45f930,_0x15d59d);(!_0x273a70||(_0x4c6281(0x101)in _0x273a70?!_0x45f930[_0x4c6281(0xd4)]:_0x273a70[_0x4c6281(0xfb)]||_0x273a70[_0x4c6281(0x100)]))&&(_0x273a70={'enumerable':!![],'get':function(){return _0x45f930[_0x15d59d];}}),Object['defineProperty'](_0x5da725,_0x691d62,_0x273a70);}:function(_0x52d37e,_0x57da5d,_0x2b8d0d,_0x23b1f4){if(_0x23b1f4===undefined)_0x23b1f4=_0x2b8d0d;_0x52d37e[_0x23b1f4]=_0x57da5d[_0x2b8d0d];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a226_0xb5b8a2(0xf6)]?function(_0x371782,_0x2abfe3){const _0xf52550=a226_0xb5b8a2;Object[_0xf52550(0x114)](_0x371782,_0xf52550(0x104),{'enumerable':!![],'value':_0x2abfe3});}:function(_0x19164e,_0xa2874a){const _0x81778=a226_0xb5b8a2;_0x19164e[_0x81778(0x104)]=_0xa2874a;}),__decorate=this&&this[a226_0xb5b8a2(0x10e)]||function(_0x476633,_0x1e3dde,_0x348da2,_0x3f7f4b){const _0x32acc6=a226_0xb5b8a2;var _0x262c2f=arguments[_0x32acc6(0x11c)],_0x46794a=_0x262c2f<0x3?_0x1e3dde:_0x3f7f4b===null?_0x3f7f4b=Object[_0x32acc6(0xff)](_0x1e3dde,_0x348da2):_0x3f7f4b,_0x3e5820;if(typeof Reflect===_0x32acc6(0x10c)&&typeof Reflect[_0x32acc6(0x109)]===_0x32acc6(0xe0))_0x46794a=Reflect[_0x32acc6(0x109)](_0x476633,_0x1e3dde,_0x348da2,_0x3f7f4b);else{for(var _0x5ea61d=_0x476633['length']-0x1;_0x5ea61d>=0x0;_0x5ea61d--)if(_0x3e5820=_0x476633[_0x5ea61d])_0x46794a=(_0x262c2f<0x3?_0x3e5820(_0x46794a):_0x262c2f>0x3?_0x3e5820(_0x1e3dde,_0x348da2,_0x46794a):_0x3e5820(_0x1e3dde,_0x348da2))||_0x46794a;}return _0x262c2f>0x3&&_0x46794a&&Object[_0x32acc6(0x114)](_0x1e3dde,_0x348da2,_0x46794a),_0x46794a;},__importStar=this&&this[a226_0xb5b8a2(0xd9)]||function(_0x5103fd){const _0x1b5b05=a226_0xb5b8a2;if(_0x5103fd&&_0x5103fd['__esModule'])return _0x5103fd;var _0x34bded={};if(_0x5103fd!=null){for(var _0x198d7e in _0x5103fd)if(_0x198d7e!=='default'&&Object['prototype']['hasOwnProperty'][_0x1b5b05(0xd0)](_0x5103fd,_0x198d7e))__createBinding(_0x34bded,_0x5103fd,_0x198d7e);}return __setModuleDefault(_0x34bded,_0x5103fd),_0x34bded;},__metadata=this&&this['__metadata']||function(_0x387d6c,_0x16af94){const _0x20419d=a226_0xb5b8a2;if(typeof Reflect===_0x20419d(0x10c)&&typeof Reflect['metadata']===_0x20419d(0xe0))return Reflect[_0x20419d(0xf0)](_0x387d6c,_0x16af94);},__importDefault=this&&this[a226_0xb5b8a2(0xca)]||function(_0x359ecc){return _0x359ecc&&_0x359ecc['__esModule']?_0x359ecc:{'default':_0x359ecc};},SalesforceAuthService_1;function a226_0x40c3(_0x56d188,_0x4c0264){const _0x50fb4d=a226_0x1889();return a226_0x40c3=function(_0x4d2ef8,_0x137d3c){_0x4d2ef8=_0x4d2ef8-0xc6;let _0x18899d=_0x50fb4d[_0x4d2ef8];return _0x18899d;},a226_0x40c3(_0x56d188,_0x4c0264);}Object[a226_0xb5b8a2(0x114)](exports,a226_0xb5b8a2(0xd4),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a226_0xb5b8a2(0xe8))),errors_1=require(a226_0xb5b8a2(0x113)),core_1=require(a226_0xb5b8a2(0x110)),axios_1=__importDefault(require(a226_0xb5b8a2(0xdd))),utils_1=require(a226_0xb5b8a2(0xda)),invalid_refresh_token_error_1=require(a226_0xb5b8a2(0xeb)),auth_state_enum_1=require(a226_0xb5b8a2(0xf7)),unauthorized_salesforce_error_1=require(a226_0xb5b8a2(0x11b)),constants_1=require(a226_0xb5b8a2(0xd6)),providers_tokens_1=require(a226_0xb5b8a2(0x102));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x2b0664=a226_0xb5b8a2;this['AUTH_WAIT_TIME']=0x1388,this[_0x2b0664(0x10b)]=auth_state_enum_1['AuthState'][_0x2b0664(0xdc)],this[_0x2b0664(0xc6)]=new core_1[(_0x2b0664(0xf2))](SalesforceAuthService_1[_0x2b0664(0xe5)]),this[_0x2b0664(0xcd)]();}async[a226_0xb5b8a2(0xcd)](){const _0x5bd364=a226_0xb5b8a2;this[_0x5bd364(0xc6)]['log'](_0x5bd364(0xc9),auth_state_enum_1['AuthState'][this[_0x5bd364(0x10b)]]);try{if(this[_0x5bd364(0x10b)]===auth_state_enum_1[_0x5bd364(0x103)]['Error'])return;if(this[_0x5bd364(0x10b)]===auth_state_enum_1[_0x5bd364(0x103)][_0x5bd364(0xdc)])await this['updateAccessToken']();else{const _0x5f382f=await this[_0x5bd364(0x106)](),_0x4888ef=await axios_1['default'][_0x5bd364(0x101)](_0x5bd364(0x105)+constants_1[_0x5bd364(0xd5)],_0x5f382f)['then'](()=>!![])['catch'](()=>![]);!_0x4888ef&&await this['updateAccessToken']();}}catch(_0x7cf0c4){}}async['updateAccessToken'](){const _0x343b93=a226_0xb5b8a2;var _0x46e60f,_0x386853,_0x32770c;this[_0x343b93(0xc6)]['log'](_0x343b93(0xd3));try{this[_0x343b93(0x10b)]=auth_state_enum_1[_0x343b93(0x103)][_0x343b93(0x107)];const {refreshToken:_0x26b26f,clientId:_0x45b020,clientSecret:_0x275cf3,loginUrl:_0x77757}=typedi_1[_0x343b93(0x104)][_0x343b93(0x101)](providers_tokens_1[_0x343b93(0x10a)][_0x343b93(0x10f)]),{data:_0x4072ab}=await axios_1['default'][_0x343b93(0xcb)]((0x0,utils_1[_0x343b93(0x111)])(_0x77757,_0x343b93(0xe1)),null,{'params':{'grant_type':_0x343b93(0xdf),'refresh_token':_0x26b26f,'client_id':_0x45b020,'client_secret':_0x275cf3}});this[_0x343b93(0xed)]=_0x4072ab['instance_url'],this['accessToken']=_0x4072ab[_0x343b93(0xea)],this['tokenType']=_0x4072ab[_0x343b93(0xf5)],this[_0x343b93(0x10b)]=auth_state_enum_1['AuthState']['Active'],this[_0x343b93(0xc6)][_0x343b93(0xf4)](_0x343b93(0xe9),this[_0x343b93(0xed)]);}catch(_0x3ceccc){const _0x5666e0=((_0x386853=(_0x46e60f=_0x3ceccc===null||_0x3ceccc===void 0x0?void 0x0:_0x3ceccc['response'])===null||_0x46e60f===void 0x0?void 0x0:_0x46e60f[_0x343b93(0xf9)])===null||_0x386853===void 0x0?void 0x0:_0x386853[_0x343b93(0xde)])||((_0x32770c=_0x3ceccc===null||_0x3ceccc===void 0x0?void 0x0:_0x3ceccc[_0x343b93(0xe7)])===null||_0x32770c===void 0x0?void 0x0:_0x32770c[_0x343b93(0xf9)])||_0x3ceccc[_0x343b93(0xd1)];this[_0x343b93(0xc6)]['error'](_0x343b93(0x118),_0x5666e0),this['authState']=auth_state_enum_1[_0x343b93(0x103)][_0x343b93(0xf3)];throw new invalid_refresh_token_error_1[(_0x343b93(0xd8))](errors_1[_0x343b93(0xcf)]);}}async[a226_0xb5b8a2(0xe4)](){const _0x3f74ff=a226_0xb5b8a2;this[_0x3f74ff(0xc6)]['log'](_0x3f74ff(0xc7));if(this[_0x3f74ff(0x10b)]===auth_state_enum_1[_0x3f74ff(0x103)]['Updating']||this[_0x3f74ff(0x10b)]===auth_state_enum_1['AuthState']['Idle'])return await(0x0,utils_1[_0x3f74ff(0xe6)])(this['AUTH_WAIT_TIME']),this['forceUpdateToken']();if(this[_0x3f74ff(0x10b)]===auth_state_enum_1['AuthState']['Error'])throw new invalid_refresh_token_error_1[(_0x3f74ff(0xd8))](errors_1[_0x3f74ff(0xcf)]);await this['updateAccessToken']();}async[a226_0xb5b8a2(0xd7)](){const _0x494ad8=a226_0xb5b8a2;if(this['authState']===auth_state_enum_1[_0x494ad8(0x103)][_0x494ad8(0xf3)]){this[_0x494ad8(0xc6)]['log'](_0x494ad8(0x116));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this['authState']!==auth_state_enum_1['AuthState'][_0x494ad8(0x11a)])return this[_0x494ad8(0xc6)]['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x494ad8(0xe6)])(this[_0x494ad8(0xf8)]),this[_0x494ad8(0xd7)]();}[a226_0xb5b8a2(0xe2)](){const _0x5ef88e=a226_0xb5b8a2;return{'orgId':this[_0x5ef88e(0xfe)],'accessToken':this['accessToken'],'instanceUrl':this[_0x5ef88e(0xed)]};}async['requestConfig'](){const _0x49c313=a226_0xb5b8a2;return await this[_0x49c313(0xd7)](),{'baseURL':this[_0x49c313(0xed)],'headers':{'accept':_0x49c313(0x115),'authorization':this[_0x49c313(0xfd)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a226_0xb5b8a2(0x10d)])(),__metadata(a226_0xb5b8a2(0x117),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;