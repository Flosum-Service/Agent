const a269_0x2b73d7=a269_0x5611;function a269_0x157c(){const _0x58f6ef=['/services/oauth2/token','response','Force\x20update\x20token','9591003VytxlQ','salesforce','Service','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','InvalidRefreshTokenError','getAuthData','X-SFDC-Session','Updating','<met:sessionId>','isBulk1Url','instanceUrl','sleep','length','getOwnPropertyDescriptor','SALESFORCE_API_VERSION','headers','42014XacKXP','name','replace','ERR_INVALID_SALESFORCE_TOKEN','axios','../errors/unauthorized-salesforce.error','services/data/','search','128XjWFaa','../errors/invalid-refresh-token.error','22joFULG','message','SalesforceAuthService','../../../../constants/errors','catch','accessToken','instance_url','1BgyVJT','../../../../core','AUTH_WAIT_TIME','</met:sessionId>','__decorate','7736170YPFIRX','724419CRLGID','joinURL','access_token','post','design:paramtypes','error','tokenType','function','SalesforceUtils','Update\x20access\x20token','waitAuth','AuthState','token_type','data','Active','__setModuleDefault','defineProperty','__esModule','__importDefault','updateAccessToken','default','application/json','__createBinding','hasOwnProperty','toString','808818AZViuH','log','Check\x20auth:\x20current\x20state\x20-\x20%s','Tokens','168yZBBsG','4cfyQgw','Idle','__importStar','call','Error','get','logger','setAuthDetails','../../../shared/utils','13838364jkxChi','requestConfig','decorate','authState','forceUpdateToken','typedi','object','create','176395kSSotQ','orgId','../enums/auth-state.enum','isSoapUrl','Update\x20access\x20token\x20failed:\x20%s','Create\x20authorized\x20request\x20failed:\x20authorization\x20error'];a269_0x157c=function(){return _0x58f6ef;};return a269_0x157c();}(function(_0x16985e,_0x5e47d5){const _0x50fd1e=a269_0x5611,_0x4fe81e=_0x16985e();while(!![]){try{const _0x1a4b0d=parseInt(_0x50fd1e(0x146))/0x1*(parseInt(_0x50fd1e(0x165))/0x2)+parseInt(_0x50fd1e(0x14c))/0x3*(-parseInt(_0x50fd1e(0x16a))/0x4)+parseInt(_0x50fd1e(0x17b))/0x5*(parseInt(_0x50fd1e(0x169))/0x6)+parseInt(_0x50fd1e(0x194))/0x7*(parseInt(_0x50fd1e(0x13d))/0x8)+parseInt(_0x50fd1e(0x184))/0x9+parseInt(_0x50fd1e(0x14b))/0xa+-parseInt(_0x50fd1e(0x13f))/0xb*(parseInt(_0x50fd1e(0x173))/0xc);if(_0x1a4b0d===_0x5e47d5)break;else _0x4fe81e['push'](_0x4fe81e['shift']());}catch(_0x4c9f24){_0x4fe81e['push'](_0x4fe81e['shift']());}}}(a269_0x157c,0xbe596));const a269_0x16e1ef=(function(){let _0x4f83d5=!![];return function(_0x13731b,_0x4a4ad3){const _0x316301=_0x4f83d5?function(){if(_0x4a4ad3){const _0x119355=_0x4a4ad3['apply'](_0x13731b,arguments);return _0x4a4ad3=null,_0x119355;}}:function(){};return _0x4f83d5=![],_0x316301;};}()),a269_0x181603=a269_0x16e1ef(this,function(){const _0x547601=a269_0x5611;return a269_0x181603[_0x547601(0x164)]()['search']('(((.+)+)+)+$')[_0x547601(0x164)]()['constructor'](a269_0x181603)[_0x547601(0x13c)]('(((.+)+)+)+$');});a269_0x181603();'use strict';var __createBinding=this&&this[a269_0x2b73d7(0x162)]||(Object['create']?function(_0x3549bc,_0x5ca22a,_0x43d38f,_0x4c00a8){const _0x1d4294=a269_0x2b73d7;if(_0x4c00a8===undefined)_0x4c00a8=_0x43d38f;var _0x41778d=Object[_0x1d4294(0x191)](_0x5ca22a,_0x43d38f);(!_0x41778d||('get'in _0x41778d?!_0x5ca22a['__esModule']:_0x41778d['writable']||_0x41778d['configurable']))&&(_0x41778d={'enumerable':!![],'get':function(){return _0x5ca22a[_0x43d38f];}}),Object['defineProperty'](_0x3549bc,_0x4c00a8,_0x41778d);}:function(_0x2ea2b5,_0x50a068,_0xfd9e37,_0x1321b5){if(_0x1321b5===undefined)_0x1321b5=_0xfd9e37;_0x2ea2b5[_0x1321b5]=_0x50a068[_0xfd9e37];}),__setModuleDefault=this&&this[a269_0x2b73d7(0x15b)]||(Object[a269_0x2b73d7(0x17a)]?function(_0x26f5dc,_0x47fd98){const _0x124cdf=a269_0x2b73d7;Object[_0x124cdf(0x15c)](_0x26f5dc,_0x124cdf(0x160),{'enumerable':!![],'value':_0x47fd98});}:function(_0x3fcdeb,_0x314a17){_0x3fcdeb['default']=_0x314a17;}),__decorate=this&&this[a269_0x2b73d7(0x14a)]||function(_0x3d3711,_0x22a29d,_0x242483,_0x20ef05){const _0x47bc79=a269_0x2b73d7;var _0x244003=arguments[_0x47bc79(0x190)],_0x45a1fc=_0x244003<0x3?_0x22a29d:_0x20ef05===null?_0x20ef05=Object['getOwnPropertyDescriptor'](_0x22a29d,_0x242483):_0x20ef05,_0x5169ad;if(typeof Reflect===_0x47bc79(0x179)&&typeof Reflect[_0x47bc79(0x175)]==='function')_0x45a1fc=Reflect[_0x47bc79(0x175)](_0x3d3711,_0x22a29d,_0x242483,_0x20ef05);else{for(var _0x5caa7e=_0x3d3711[_0x47bc79(0x190)]-0x1;_0x5caa7e>=0x0;_0x5caa7e--)if(_0x5169ad=_0x3d3711[_0x5caa7e])_0x45a1fc=(_0x244003<0x3?_0x5169ad(_0x45a1fc):_0x244003>0x3?_0x5169ad(_0x22a29d,_0x242483,_0x45a1fc):_0x5169ad(_0x22a29d,_0x242483))||_0x45a1fc;}return _0x244003>0x3&&_0x45a1fc&&Object['defineProperty'](_0x22a29d,_0x242483,_0x45a1fc),_0x45a1fc;},__importStar=this&&this[a269_0x2b73d7(0x16c)]||function(_0x53ac2a){const _0x50f47a=a269_0x2b73d7;if(_0x53ac2a&&_0x53ac2a[_0x50f47a(0x15d)])return _0x53ac2a;var _0x33801e={};if(_0x53ac2a!=null){for(var _0x3b4d86 in _0x53ac2a)if(_0x3b4d86!==_0x50f47a(0x160)&&Object['prototype'][_0x50f47a(0x163)][_0x50f47a(0x16d)](_0x53ac2a,_0x3b4d86))__createBinding(_0x33801e,_0x53ac2a,_0x3b4d86);}return __setModuleDefault(_0x33801e,_0x53ac2a),_0x33801e;},__metadata=this&&this['__metadata']||function(_0x34c624,_0x1227f6){const _0x258afc=a269_0x2b73d7;if(typeof Reflect===_0x258afc(0x179)&&typeof Reflect['metadata']===_0x258afc(0x153))return Reflect['metadata'](_0x34c624,_0x1227f6);},__importDefault=this&&this[a269_0x2b73d7(0x15e)]||function(_0x151c6e){const _0x321d88=a269_0x2b73d7;return _0x151c6e&&_0x151c6e[_0x321d88(0x15d)]?_0x151c6e:{'default':_0x151c6e};},SalesforceAuthService_1;Object[a269_0x2b73d7(0x15c)](exports,a269_0x2b73d7(0x15d),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;function a269_0x5611(_0x23c012,_0x229d97){const _0x155504=a269_0x157c();return a269_0x5611=function(_0x181603,_0x16e1ef){_0x181603=_0x181603-0x13a;let _0x157cd1=_0x155504[_0x181603];return _0x157cd1;},a269_0x5611(_0x23c012,_0x229d97);}const typedi_1=__importStar(require(a269_0x2b73d7(0x178))),errors_1=require(a269_0x2b73d7(0x142)),core_1=require(a269_0x2b73d7(0x147)),axios_1=__importDefault(require(a269_0x2b73d7(0x198))),utils_1=require(a269_0x2b73d7(0x172)),invalid_refresh_token_error_1=require(a269_0x2b73d7(0x13e)),auth_state_enum_1=require(a269_0x2b73d7(0x17d)),unauthorized_salesforce_error_1=require(a269_0x2b73d7(0x13a)),constants_1=require('../../../../constants'),providers_tokens_1=require('../../providers/providers.tokens'),salesforce_1=require('@flosum/salesforce');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0xa05bf0=a269_0x2b73d7;this[_0xa05bf0(0x148)]=0x1388,this[_0xa05bf0(0x176)]=auth_state_enum_1[_0xa05bf0(0x157)][_0xa05bf0(0x16b)],this[_0xa05bf0(0x170)]=new core_1['Logger'](SalesforceAuthService_1[_0xa05bf0(0x195)]),this[_0xa05bf0(0x171)]();}async['setAuthDetails'](){const _0x57fa6d=a269_0x2b73d7;this['logger'][_0x57fa6d(0x166)](_0x57fa6d(0x167),auth_state_enum_1[_0x57fa6d(0x157)][this[_0x57fa6d(0x176)]]);try{if(this[_0x57fa6d(0x176)]===auth_state_enum_1[_0x57fa6d(0x157)][_0x57fa6d(0x16e)])return;if(this[_0x57fa6d(0x176)]===auth_state_enum_1[_0x57fa6d(0x157)]['Idle'])await this[_0x57fa6d(0x15f)]();else{const _0x46b0c0=await this[_0x57fa6d(0x174)](),_0x381c68=await axios_1['default'][_0x57fa6d(0x16f)](_0x57fa6d(0x13b)+constants_1[_0x57fa6d(0x192)],_0x46b0c0)['then'](()=>!![])[_0x57fa6d(0x143)](()=>![]);!_0x381c68&&await this[_0x57fa6d(0x15f)]();}}catch(_0x1a0ba9){}}async[a269_0x2b73d7(0x15f)](){const _0x3103bd=a269_0x2b73d7;var _0x9f6b85,_0x2c3ea5,_0x4b390b;this[_0x3103bd(0x170)][_0x3103bd(0x166)](_0x3103bd(0x155));try{this['authState']=auth_state_enum_1[_0x3103bd(0x157)]['Updating'];const {refreshToken:_0x34fb14,clientId:_0x593df5,clientSecret:_0x36170d,loginUrl:_0xee782}=typedi_1[_0x3103bd(0x160)]['get'](providers_tokens_1[_0x3103bd(0x168)][_0x3103bd(0x185)]),{data:_0x4a8ee5}=await axios_1[_0x3103bd(0x160)][_0x3103bd(0x14f)]((0x0,utils_1[_0x3103bd(0x14d)])(_0xee782,_0x3103bd(0x181)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x34fb14,'client_id':_0x593df5,'client_secret':_0x36170d}});this[_0x3103bd(0x18e)]=_0x4a8ee5[_0x3103bd(0x145)],this[_0x3103bd(0x144)]=_0x4a8ee5[_0x3103bd(0x14e)],this[_0x3103bd(0x152)]=_0x4a8ee5[_0x3103bd(0x158)],this[_0x3103bd(0x176)]=auth_state_enum_1[_0x3103bd(0x157)][_0x3103bd(0x15a)],this[_0x3103bd(0x170)][_0x3103bd(0x166)]('Access\x20token\x20updated\x20for\x20%s',this[_0x3103bd(0x18e)]);}catch(_0x2d0ff3){const _0x56cbe7=((_0x2c3ea5=(_0x9f6b85=_0x2d0ff3===null||_0x2d0ff3===void 0x0?void 0x0:_0x2d0ff3[_0x3103bd(0x182)])===null||_0x9f6b85===void 0x0?void 0x0:_0x9f6b85['data'])===null||_0x2c3ea5===void 0x0?void 0x0:_0x2c3ea5[_0x3103bd(0x151)])||((_0x4b390b=_0x2d0ff3===null||_0x2d0ff3===void 0x0?void 0x0:_0x2d0ff3[_0x3103bd(0x182)])===null||_0x4b390b===void 0x0?void 0x0:_0x4b390b[_0x3103bd(0x159)])||_0x2d0ff3[_0x3103bd(0x140)];this['logger'][_0x3103bd(0x151)](_0x3103bd(0x17f),_0x56cbe7),this[_0x3103bd(0x176)]=auth_state_enum_1['AuthState']['Error'];throw new invalid_refresh_token_error_1[(_0x3103bd(0x188))](errors_1[_0x3103bd(0x197)]);}}async[a269_0x2b73d7(0x177)](){const _0x18c745=a269_0x2b73d7;this[_0x18c745(0x170)]['log'](_0x18c745(0x183));if(this[_0x18c745(0x176)]===auth_state_enum_1[_0x18c745(0x157)][_0x18c745(0x18b)]||this[_0x18c745(0x176)]===auth_state_enum_1[_0x18c745(0x157)]['Idle'])return await(0x0,utils_1['sleep'])(this[_0x18c745(0x148)]),this[_0x18c745(0x177)]();if(this['authState']===auth_state_enum_1[_0x18c745(0x157)][_0x18c745(0x16e)])throw new invalid_refresh_token_error_1[(_0x18c745(0x188))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x18c745(0x15f)]();}async[a269_0x2b73d7(0x156)](){const _0x802c03=a269_0x2b73d7;if(this[_0x802c03(0x176)]===auth_state_enum_1['AuthState'][_0x802c03(0x16e)]){this['logger'][_0x802c03(0x166)](_0x802c03(0x180));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x802c03(0x176)]!==auth_state_enum_1[_0x802c03(0x157)][_0x802c03(0x15a)])return this['logger'][_0x802c03(0x166)](_0x802c03(0x187)),await(0x0,utils_1[_0x802c03(0x18f)])(this['AUTH_WAIT_TIME']),this[_0x802c03(0x156)]();}[a269_0x2b73d7(0x189)](){const _0x1ee12f=a269_0x2b73d7;return{'orgId':this[_0x1ee12f(0x17c)],'accessToken':this[_0x1ee12f(0x144)],'instanceUrl':this['instanceUrl']};}async['requestConfig'](_0x4576a7=''){const _0x132ae7=a269_0x2b73d7;await this['waitAuth']();const _0x58c210={'baseURL':this[_0x132ae7(0x18e)],'headers':{'accept':_0x132ae7(0x161)}};if(salesforce_1[_0x132ae7(0x154)][_0x132ae7(0x18d)](_0x4576a7))_0x58c210[_0x132ae7(0x193)][_0x132ae7(0x18a)]=this[_0x132ae7(0x144)];else salesforce_1[_0x132ae7(0x154)][_0x132ae7(0x17e)](_0x4576a7)?_0x58c210[_0x132ae7(0x159)]=_0x58c210[_0x132ae7(0x159)][_0x132ae7(0x196)](/<met:sessionId>.+?<\/met:sessionId>/,_0x132ae7(0x18c)+this[_0x132ae7(0x144)]+_0x132ae7(0x149)):_0x58c210[_0x132ae7(0x193)]['authorization']=this[_0x132ae7(0x152)]+'\x20'+this['accessToken'];return _0x58c210;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a269_0x2b73d7(0x186)])(),__metadata(a269_0x2b73d7(0x150),[])],SalesforceAuthService),exports[a269_0x2b73d7(0x141)]=SalesforceAuthService;