const a232_0x15294c=a232_0x545b;(function(_0x1f24c2,_0x5ef4a1){const _0x287453=a232_0x545b,_0x474d70=_0x1f24c2();while(!![]){try{const _0x4b5434=parseInt(_0x287453(0x167))/0x1+parseInt(_0x287453(0x166))/0x2+-parseInt(_0x287453(0x162))/0x3+-parseInt(_0x287453(0x145))/0x4+parseInt(_0x287453(0x13b))/0x5*(parseInt(_0x287453(0x139))/0x6)+-parseInt(_0x287453(0x159))/0x7*(parseInt(_0x287453(0x171))/0x8)+parseInt(_0x287453(0x14a))/0x9;if(_0x4b5434===_0x5ef4a1)break;else _0x474d70['push'](_0x474d70['shift']());}catch(_0x26bf7d){_0x474d70['push'](_0x474d70['shift']());}}}(a232_0x1b1d,0x749e0));const a232_0x1169e8=(function(){let _0x4aa651=!![];return function(_0x5f48a3,_0x476615){const _0x186917=_0x4aa651?function(){const _0x118e3f=a232_0x545b;if(_0x476615){const _0x4326a7=_0x476615[_0x118e3f(0x169)](_0x5f48a3,arguments);return _0x476615=null,_0x4326a7;}}:function(){};return _0x4aa651=![],_0x186917;};}()),a232_0x463428=a232_0x1169e8(this,function(){const _0x3ec381=a232_0x545b;return a232_0x463428[_0x3ec381(0x12e)]()[_0x3ec381(0x161)](_0x3ec381(0x179))[_0x3ec381(0x12e)]()[_0x3ec381(0x158)](a232_0x463428)[_0x3ec381(0x161)]('(((.+)+)+)+$');});a232_0x463428();'use strict';function a232_0x545b(_0xa65cf,_0x1a5a21){const _0x969bf1=a232_0x1b1d();return a232_0x545b=function(_0x463428,_0x1169e8){_0x463428=_0x463428-0x12c;let _0x1b1d5f=_0x969bf1[_0x463428];return _0x1b1d5f;},a232_0x545b(_0xa65cf,_0x1a5a21);}var __createBinding=this&&this[a232_0x15294c(0x130)]||(Object[a232_0x15294c(0x153)]?function(_0x33259f,_0x13b0e2,_0xdce64f,_0x3533cb){const _0x4282db=a232_0x15294c;if(_0x3533cb===undefined)_0x3533cb=_0xdce64f;var _0x5f3fa4=Object[_0x4282db(0x175)](_0x13b0e2,_0xdce64f);(!_0x5f3fa4||(_0x4282db(0x13c)in _0x5f3fa4?!_0x13b0e2[_0x4282db(0x13d)]:_0x5f3fa4[_0x4282db(0x15d)]||_0x5f3fa4['configurable']))&&(_0x5f3fa4={'enumerable':!![],'get':function(){return _0x13b0e2[_0xdce64f];}}),Object[_0x4282db(0x15c)](_0x33259f,_0x3533cb,_0x5f3fa4);}:function(_0x3bf981,_0x3b1a3f,_0x5543bf,_0x313422){if(_0x313422===undefined)_0x313422=_0x5543bf;_0x3bf981[_0x313422]=_0x3b1a3f[_0x5543bf];}),__setModuleDefault=this&&this[a232_0x15294c(0x131)]||(Object[a232_0x15294c(0x153)]?function(_0x29af91,_0x1cd15b){const _0x112157=a232_0x15294c;Object[_0x112157(0x15c)](_0x29af91,_0x112157(0x181),{'enumerable':!![],'value':_0x1cd15b});}:function(_0x394bf2,_0x57bf19){const _0x3db909=a232_0x15294c;_0x394bf2[_0x3db909(0x181)]=_0x57bf19;}),__decorate=this&&this[a232_0x15294c(0x132)]||function(_0x243a82,_0x56849e,_0x2a4673,_0x1b9cc7){const _0x429f61=a232_0x15294c;var _0x4a0b17=arguments[_0x429f61(0x170)],_0x3b6818=_0x4a0b17<0x3?_0x56849e:_0x1b9cc7===null?_0x1b9cc7=Object[_0x429f61(0x175)](_0x56849e,_0x2a4673):_0x1b9cc7,_0x403456;if(typeof Reflect===_0x429f61(0x16b)&&typeof Reflect['decorate']===_0x429f61(0x176))_0x3b6818=Reflect[_0x429f61(0x141)](_0x243a82,_0x56849e,_0x2a4673,_0x1b9cc7);else{for(var _0x2e414e=_0x243a82[_0x429f61(0x170)]-0x1;_0x2e414e>=0x0;_0x2e414e--)if(_0x403456=_0x243a82[_0x2e414e])_0x3b6818=(_0x4a0b17<0x3?_0x403456(_0x3b6818):_0x4a0b17>0x3?_0x403456(_0x56849e,_0x2a4673,_0x3b6818):_0x403456(_0x56849e,_0x2a4673))||_0x3b6818;}return _0x4a0b17>0x3&&_0x3b6818&&Object[_0x429f61(0x15c)](_0x56849e,_0x2a4673,_0x3b6818),_0x3b6818;},__importStar=this&&this[a232_0x15294c(0x152)]||function(_0x5126ab){const _0x582d32=a232_0x15294c;if(_0x5126ab&&_0x5126ab[_0x582d32(0x13d)])return _0x5126ab;var _0x339c2b={};if(_0x5126ab!=null){for(var _0x290c36 in _0x5126ab)if(_0x290c36!==_0x582d32(0x181)&&Object['prototype'][_0x582d32(0x137)][_0x582d32(0x12d)](_0x5126ab,_0x290c36))__createBinding(_0x339c2b,_0x5126ab,_0x290c36);}return __setModuleDefault(_0x339c2b,_0x5126ab),_0x339c2b;},__metadata=this&&this['__metadata']||function(_0x4458fd,_0x5739d4){const _0x49cdef=a232_0x15294c;if(typeof Reflect==='object'&&typeof Reflect[_0x49cdef(0x14b)]==='function')return Reflect[_0x49cdef(0x14b)](_0x4458fd,_0x5739d4);},__importDefault=this&&this['__importDefault']||function(_0x23f8bc){const _0x169435=a232_0x15294c;return _0x23f8bc&&_0x23f8bc[_0x169435(0x13d)]?_0x23f8bc:{'default':_0x23f8bc};},SalesforceAuthService_1;Object['defineProperty'](exports,a232_0x15294c(0x13d),{'value':!![]}),exports[a232_0x15294c(0x16a)]=void 0x0;const typedi_1=__importStar(require('typedi')),errors_1=require(a232_0x15294c(0x143)),core_1=require('../../../../core'),axios_1=__importDefault(require(a232_0x15294c(0x151))),utils_1=require(a232_0x15294c(0x13a)),invalid_refresh_token_error_1=require(a232_0x15294c(0x17f)),auth_state_enum_1=require(a232_0x15294c(0x149)),unauthorized_salesforce_error_1=require(a232_0x15294c(0x174)),constants_1=require(a232_0x15294c(0x146)),providers_tokens_1=require(a232_0x15294c(0x13e));function a232_0x1b1d(){const _0x1096b3=['__esModule','../../providers/providers.tokens','updateAccessToken','force\x20update\x20token','decorate','SALESFORCE_API_VERSION','../../../../constants/errors','post','3474584pXEVOh','../../../../constants','services/data/','forceUpdateToken','../enums/auth-state.enum','808398CShnka','metadata','AUTH_WAIT_TIME','update\x20access\x20token','requestConfig','ERR_INVALID_SALESFORCE_TOKEN','catch','axios','__importStar','create','access_token','waitAuth','access\x20token\x20updated\x20for\x20%s','response','constructor','27146BoTRPV','UnauthorizedSalesforceError','then','defineProperty','writable','logger','message','Updating','search','16638ABXoIv','salesforce','refresh_token','instanceUrl','356302keBZkA','342383FTSEKf','authState','apply','SalesforceAuthService','object','data','Tokens','error','Idle','length','424qaJzkp','accessToken','tokenType','../errors/unauthorized-salesforce.error','getOwnPropertyDescriptor','function','check\x20auth:\x20current\x20state\x20-\x20%s','sleep','(((.+)+)+)+$','design:paramtypes','token_type','orgId','getAuthData','AuthState','../errors/invalid-refresh-token.error','create\x20authorized\x20request\x20failed:\x20authorization\x20error','default','Service','call','toString','joinURL','__createBinding','__setModuleDefault','__decorate','Error','Active','setAuthDetails','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','hasOwnProperty','log','2841102zkvoMM','../../../shared/utils','10WIpgQS','get'];a232_0x1b1d=function(){return _0x1096b3;};return a232_0x1b1d();}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x70f7e=a232_0x15294c;this[_0x70f7e(0x14c)]=0x1388,this['authState']=auth_state_enum_1[_0x70f7e(0x17e)][_0x70f7e(0x16f)],this[_0x70f7e(0x15e)]=new core_1['Logger'](SalesforceAuthService_1['name']),this['setAuthDetails']();}async[a232_0x15294c(0x135)](){const _0xc84aae=a232_0x15294c;this[_0xc84aae(0x15e)][_0xc84aae(0x138)](_0xc84aae(0x177),auth_state_enum_1['AuthState'][this['authState']]);try{if(this[_0xc84aae(0x168)]===auth_state_enum_1['AuthState'][_0xc84aae(0x133)])return;if(this[_0xc84aae(0x168)]===auth_state_enum_1[_0xc84aae(0x17e)]['Idle'])await this[_0xc84aae(0x13f)]();else{const _0x5905d8=await this[_0xc84aae(0x14e)](),_0x4eafe3=await axios_1[_0xc84aae(0x181)]['get'](_0xc84aae(0x147)+constants_1[_0xc84aae(0x142)],_0x5905d8)[_0xc84aae(0x15b)](()=>!![])[_0xc84aae(0x150)](()=>![]);!_0x4eafe3&&await this[_0xc84aae(0x13f)]();}}catch(_0x3af5cf){}}async[a232_0x15294c(0x13f)](){const _0x52250e=a232_0x15294c;var _0x108c48,_0x1364ac,_0x45610f;this[_0x52250e(0x15e)]['log'](_0x52250e(0x14d));try{this[_0x52250e(0x168)]=auth_state_enum_1[_0x52250e(0x17e)][_0x52250e(0x160)];const {refreshToken:_0x1f70bd,clientId:_0x24a3f9,clientSecret:_0x33ffa1,loginUrl:_0x390e12}=typedi_1[_0x52250e(0x181)][_0x52250e(0x13c)](providers_tokens_1[_0x52250e(0x16d)][_0x52250e(0x163)]),{data:_0x442b26}=await axios_1[_0x52250e(0x181)][_0x52250e(0x144)]((0x0,utils_1[_0x52250e(0x12f)])(_0x390e12,'/services/oauth2/token'),null,{'params':{'grant_type':_0x52250e(0x164),'refresh_token':_0x1f70bd,'client_id':_0x24a3f9,'client_secret':_0x33ffa1}});this[_0x52250e(0x165)]=_0x442b26['instance_url'],this[_0x52250e(0x172)]=_0x442b26[_0x52250e(0x154)],this[_0x52250e(0x173)]=_0x442b26[_0x52250e(0x17b)],this[_0x52250e(0x168)]=auth_state_enum_1[_0x52250e(0x17e)][_0x52250e(0x134)],this['logger'][_0x52250e(0x138)](_0x52250e(0x156),this[_0x52250e(0x165)]);}catch(_0x5bf27b){const _0x2c229c=((_0x1364ac=(_0x108c48=_0x5bf27b===null||_0x5bf27b===void 0x0?void 0x0:_0x5bf27b[_0x52250e(0x157)])===null||_0x108c48===void 0x0?void 0x0:_0x108c48['data'])===null||_0x1364ac===void 0x0?void 0x0:_0x1364ac[_0x52250e(0x16e)])||((_0x45610f=_0x5bf27b===null||_0x5bf27b===void 0x0?void 0x0:_0x5bf27b[_0x52250e(0x157)])===null||_0x45610f===void 0x0?void 0x0:_0x45610f[_0x52250e(0x16c)])||_0x5bf27b[_0x52250e(0x15f)];this[_0x52250e(0x15e)][_0x52250e(0x16e)]('update\x20access\x20token\x20failed:\x20%s',_0x2c229c),this[_0x52250e(0x168)]=auth_state_enum_1['AuthState']['Error'];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x52250e(0x14f)]);}}async['forceUpdateToken'](){const _0xc65946=a232_0x15294c;this[_0xc65946(0x15e)]['log'](_0xc65946(0x140));if(this['authState']===auth_state_enum_1['AuthState'][_0xc65946(0x160)]||this[_0xc65946(0x168)]===auth_state_enum_1[_0xc65946(0x17e)][_0xc65946(0x16f)])return await(0x0,utils_1[_0xc65946(0x178)])(this['AUTH_WAIT_TIME']),this[_0xc65946(0x148)]();if(this[_0xc65946(0x168)]===auth_state_enum_1[_0xc65946(0x17e)][_0xc65946(0x133)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0xc65946(0x14f)]);await this['updateAccessToken']();}async[a232_0x15294c(0x155)](){const _0x4d4c8f=a232_0x15294c;if(this[_0x4d4c8f(0x168)]===auth_state_enum_1[_0x4d4c8f(0x17e)]['Error']){this[_0x4d4c8f(0x15e)][_0x4d4c8f(0x138)](_0x4d4c8f(0x180));throw new unauthorized_salesforce_error_1[(_0x4d4c8f(0x15a))]();}if(this[_0x4d4c8f(0x168)]!==auth_state_enum_1[_0x4d4c8f(0x17e)][_0x4d4c8f(0x134)])return this[_0x4d4c8f(0x15e)][_0x4d4c8f(0x138)](_0x4d4c8f(0x136)),await(0x0,utils_1[_0x4d4c8f(0x178)])(this[_0x4d4c8f(0x14c)]),this[_0x4d4c8f(0x155)]();}[a232_0x15294c(0x17d)](){const _0x18de48=a232_0x15294c;return{'orgId':this[_0x18de48(0x17c)],'accessToken':this[_0x18de48(0x172)],'instanceUrl':this[_0x18de48(0x165)]};}async['requestConfig'](){const _0x442740=a232_0x15294c;return await this[_0x442740(0x155)](),{'baseURL':this[_0x442740(0x165)],'headers':{'accept':'application/json','authorization':this[_0x442740(0x173)]+'\x20'+this[_0x442740(0x172)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a232_0x15294c(0x12c)])(),__metadata(a232_0x15294c(0x17a),[])],SalesforceAuthService),exports[a232_0x15294c(0x16a)]=SalesforceAuthService;