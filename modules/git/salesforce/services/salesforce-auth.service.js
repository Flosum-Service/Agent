const a242_0x224047=a242_0x4976;function a242_0x31e2(){const _0x301d3b=['Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','forceUpdateToken','defineProperty','../../../../constants/errors','hasOwnProperty','name','SALESFORCE_API_VERSION','typedi','../../../shared/utils','1zKRGwH','salesforce','13562QncBPe','ERR_INVALID_SALESFORCE_TOKEN','object','Active','../../../../core','sleep','toString','15684LRkfGO','../../../../constants','search','constructor','3604473CHcQuT','access_token','writable','Logger','create','__metadata','metadata','instanceUrl','__createBinding','updateAccessToken','Idle','getOwnPropertyDescriptor','11Lndwox','/services/oauth2/token','176070PBOGGF','36tKrjJE','services/data/','49dGpixU','data','Update\x20access\x20token','message','authState','Access\x20token\x20updated\x20for\x20%s','AuthState','waitAuth','post','get','call','1244020yGGAvV','log','__setModuleDefault','prototype','logger','../errors/invalid-refresh-token.error','setAuthDetails','tokenType','function','design:paramtypes','__esModule','825579dCGaLH','orgId','SalesforceAuthService','token_type','catch','Error','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','Updating','../enums/auth-state.enum','AUTH_WAIT_TIME','168ZauKzo','8xhKpEq','apply','accessToken','default','763451JREAFV','InvalidRefreshTokenError','__importDefault','configurable','__decorate','application/json','Service'];a242_0x31e2=function(){return _0x301d3b;};return a242_0x31e2();}(function(_0x308922,_0x235fc4){const _0x1277c7=a242_0x4976,_0x9b7a2c=_0x308922();while(!![]){try{const _0x163159=-parseInt(_0x1277c7(0x145))/0x1*(parseInt(_0x1277c7(0x147))/0x2)+parseInt(_0x1277c7(0x126))/0x3+-parseInt(_0x1277c7(0x10e))/0x4*(parseInt(_0x1277c7(0x10d))/0x5)+parseInt(_0x1277c7(0x14e))/0x6*(-parseInt(_0x1277c7(0x110))/0x7)+parseInt(_0x1277c7(0x131))/0x8*(-parseInt(_0x1277c7(0xff))/0x9)+-parseInt(_0x1277c7(0x11b))/0xa*(parseInt(_0x1277c7(0x10b))/0xb)+parseInt(_0x1277c7(0x130))/0xc*(parseInt(_0x1277c7(0x135))/0xd);if(_0x163159===_0x235fc4)break;else _0x9b7a2c['push'](_0x9b7a2c['shift']());}catch(_0x223cc1){_0x9b7a2c['push'](_0x9b7a2c['shift']());}}}(a242_0x31e2,0x38443));const a242_0x3dc9db=(function(){let _0x3610f1=!![];return function(_0x58523f,_0x5207f5){const _0x50bfcd=_0x3610f1?function(){const _0x4d90dc=a242_0x4976;if(_0x5207f5){const _0x2ae24c=_0x5207f5[_0x4d90dc(0x132)](_0x58523f,arguments);return _0x5207f5=null,_0x2ae24c;}}:function(){};return _0x3610f1=![],_0x50bfcd;};}()),a242_0x5bd951=a242_0x3dc9db(this,function(){const _0x4878d1=a242_0x4976;return a242_0x5bd951[_0x4878d1(0x14d)]()[_0x4878d1(0xfd)]('(((.+)+)+)+$')[_0x4878d1(0x14d)]()[_0x4878d1(0xfe)](a242_0x5bd951)['search']('(((.+)+)+)+$');});a242_0x5bd951();'use strict';function a242_0x4976(_0x1f1cdf,_0x4c8bf2){const _0x36cdb9=a242_0x31e2();return a242_0x4976=function(_0x5bd951,_0x3dc9db){_0x5bd951=_0x5bd951-0xfc;let _0x31e286=_0x36cdb9[_0x5bd951];return _0x31e286;},a242_0x4976(_0x1f1cdf,_0x4c8bf2);}var __createBinding=this&&this[a242_0x224047(0x107)]||(Object[a242_0x224047(0x103)]?function(_0x1e2596,_0x463929,_0x3db61d,_0x2d6b8e){const _0x3d091a=a242_0x224047;if(_0x2d6b8e===undefined)_0x2d6b8e=_0x3db61d;var _0x5219eb=Object[_0x3d091a(0x10a)](_0x463929,_0x3db61d);(!_0x5219eb||(_0x3d091a(0x119)in _0x5219eb?!_0x463929[_0x3d091a(0x125)]:_0x5219eb[_0x3d091a(0x101)]||_0x5219eb[_0x3d091a(0x138)]))&&(_0x5219eb={'enumerable':!![],'get':function(){return _0x463929[_0x3db61d];}}),Object[_0x3d091a(0x13e)](_0x1e2596,_0x2d6b8e,_0x5219eb);}:function(_0x24a8f4,_0x507d15,_0x22addc,_0x1682d9){if(_0x1682d9===undefined)_0x1682d9=_0x22addc;_0x24a8f4[_0x1682d9]=_0x507d15[_0x22addc];}),__setModuleDefault=this&&this[a242_0x224047(0x11d)]||(Object[a242_0x224047(0x103)]?function(_0x331d49,_0x569222){const _0x29a848=a242_0x224047;Object[_0x29a848(0x13e)](_0x331d49,'default',{'enumerable':!![],'value':_0x569222});}:function(_0x3e31d1,_0x20e937){_0x3e31d1['default']=_0x20e937;}),__decorate=this&&this[a242_0x224047(0x139)]||function(_0x38c6e5,_0x20b608,_0xc3385c,_0x2513d3){const _0x4d6495=a242_0x224047;var _0x344f1a=arguments['length'],_0x303f0c=_0x344f1a<0x3?_0x20b608:_0x2513d3===null?_0x2513d3=Object['getOwnPropertyDescriptor'](_0x20b608,_0xc3385c):_0x2513d3,_0x3f42ad;if(typeof Reflect===_0x4d6495(0x149)&&typeof Reflect['decorate']===_0x4d6495(0x123))_0x303f0c=Reflect['decorate'](_0x38c6e5,_0x20b608,_0xc3385c,_0x2513d3);else{for(var _0x400e97=_0x38c6e5['length']-0x1;_0x400e97>=0x0;_0x400e97--)if(_0x3f42ad=_0x38c6e5[_0x400e97])_0x303f0c=(_0x344f1a<0x3?_0x3f42ad(_0x303f0c):_0x344f1a>0x3?_0x3f42ad(_0x20b608,_0xc3385c,_0x303f0c):_0x3f42ad(_0x20b608,_0xc3385c))||_0x303f0c;}return _0x344f1a>0x3&&_0x303f0c&&Object['defineProperty'](_0x20b608,_0xc3385c,_0x303f0c),_0x303f0c;},__importStar=this&&this['__importStar']||function(_0x199f50){const _0x3cda7d=a242_0x224047;if(_0x199f50&&_0x199f50[_0x3cda7d(0x125)])return _0x199f50;var _0x19f240={};if(_0x199f50!=null){for(var _0x3d1799 in _0x199f50)if(_0x3d1799!==_0x3cda7d(0x134)&&Object[_0x3cda7d(0x11e)][_0x3cda7d(0x140)][_0x3cda7d(0x11a)](_0x199f50,_0x3d1799))__createBinding(_0x19f240,_0x199f50,_0x3d1799);}return __setModuleDefault(_0x19f240,_0x199f50),_0x19f240;},__metadata=this&&this[a242_0x224047(0x104)]||function(_0x30bfda,_0xea85ee){const _0x390288=a242_0x224047;if(typeof Reflect==='object'&&typeof Reflect[_0x390288(0x105)]==='function')return Reflect['metadata'](_0x30bfda,_0xea85ee);},__importDefault=this&&this[a242_0x224047(0x137)]||function(_0x28b79e){const _0x12cc2b=a242_0x224047;return _0x28b79e&&_0x28b79e[_0x12cc2b(0x125)]?_0x28b79e:{'default':_0x28b79e};},SalesforceAuthService_1;Object['defineProperty'](exports,a242_0x224047(0x125),{'value':!![]}),exports[a242_0x224047(0x128)]=void 0x0;const typedi_1=__importStar(require(a242_0x224047(0x143))),errors_1=require(a242_0x224047(0x13f)),core_1=require(a242_0x224047(0x14b)),axios_1=__importDefault(require('axios')),utils_1=require(a242_0x224047(0x144)),invalid_refresh_token_error_1=require(a242_0x224047(0x120)),auth_state_enum_1=require(a242_0x224047(0x12e)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a242_0x224047(0xfc)),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x4f9014=a242_0x224047;this[_0x4f9014(0x12f)]=0x1388,this[_0x4f9014(0x114)]=auth_state_enum_1[_0x4f9014(0x116)][_0x4f9014(0x109)],this[_0x4f9014(0x11f)]=new core_1[(_0x4f9014(0x102))](SalesforceAuthService_1[_0x4f9014(0x141)]),this[_0x4f9014(0x121)]();}async[a242_0x224047(0x121)](){const _0x5dfa5e=a242_0x224047;this[_0x5dfa5e(0x11f)][_0x5dfa5e(0x11c)]('Check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x5dfa5e(0x116)][this[_0x5dfa5e(0x114)]]);try{if(this[_0x5dfa5e(0x114)]===auth_state_enum_1[_0x5dfa5e(0x116)][_0x5dfa5e(0x12b)])return;if(this[_0x5dfa5e(0x114)]===auth_state_enum_1[_0x5dfa5e(0x116)][_0x5dfa5e(0x109)])await this[_0x5dfa5e(0x108)]();else{const _0x2a0177=await this['requestConfig'](),_0x1772b5=await axios_1['default'][_0x5dfa5e(0x119)](_0x5dfa5e(0x10f)+constants_1[_0x5dfa5e(0x142)],_0x2a0177)['then'](()=>!![])[_0x5dfa5e(0x12a)](()=>![]);!_0x1772b5&&await this[_0x5dfa5e(0x108)]();}}catch(_0x63a511){}}async[a242_0x224047(0x108)](){const _0x11af47=a242_0x224047;var _0x5610fc,_0x22686f,_0x9e1f12;this['logger']['log'](_0x11af47(0x112));try{this[_0x11af47(0x114)]=auth_state_enum_1[_0x11af47(0x116)]['Updating'];const {refreshToken:_0x8516c0,clientId:_0x541b6e,clientSecret:_0x5c4b74,loginUrl:_0x252360}=typedi_1[_0x11af47(0x134)][_0x11af47(0x119)](providers_tokens_1['Tokens'][_0x11af47(0x146)]),{data:_0xe2716c}=await axios_1['default'][_0x11af47(0x118)]((0x0,utils_1['joinURL'])(_0x252360,_0x11af47(0x10c)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x8516c0,'client_id':_0x541b6e,'client_secret':_0x5c4b74}});this[_0x11af47(0x106)]=_0xe2716c['instance_url'],this[_0x11af47(0x133)]=_0xe2716c[_0x11af47(0x100)],this['tokenType']=_0xe2716c[_0x11af47(0x129)],this['authState']=auth_state_enum_1[_0x11af47(0x116)][_0x11af47(0x14a)],this[_0x11af47(0x11f)][_0x11af47(0x11c)](_0x11af47(0x115),this['instanceUrl']);}catch(_0x4e4c00){const _0x4179e6=((_0x22686f=(_0x5610fc=_0x4e4c00===null||_0x4e4c00===void 0x0?void 0x0:_0x4e4c00['response'])===null||_0x5610fc===void 0x0?void 0x0:_0x5610fc[_0x11af47(0x111)])===null||_0x22686f===void 0x0?void 0x0:_0x22686f['error'])||((_0x9e1f12=_0x4e4c00===null||_0x4e4c00===void 0x0?void 0x0:_0x4e4c00['response'])===null||_0x9e1f12===void 0x0?void 0x0:_0x9e1f12[_0x11af47(0x111)])||_0x4e4c00[_0x11af47(0x113)];this['logger']['error']('Update\x20access\x20token\x20failed:\x20%s',_0x4179e6),this['authState']=auth_state_enum_1[_0x11af47(0x116)][_0x11af47(0x12b)];throw new invalid_refresh_token_error_1[(_0x11af47(0x136))](errors_1[_0x11af47(0x148)]);}}async[a242_0x224047(0x13d)](){const _0x3ede98=a242_0x224047;this['logger'][_0x3ede98(0x11c)]('Force\x20update\x20token');if(this['authState']===auth_state_enum_1[_0x3ede98(0x116)][_0x3ede98(0x12d)]||this['authState']===auth_state_enum_1[_0x3ede98(0x116)]['Idle'])return await(0x0,utils_1[_0x3ede98(0x14c)])(this[_0x3ede98(0x12f)]),this['forceUpdateToken']();if(this[_0x3ede98(0x114)]===auth_state_enum_1[_0x3ede98(0x116)][_0x3ede98(0x12b)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x3ede98(0x108)]();}async[a242_0x224047(0x117)](){const _0x13802d=a242_0x224047;if(this['authState']===auth_state_enum_1[_0x13802d(0x116)][_0x13802d(0x12b)]){this['logger'][_0x13802d(0x11c)](_0x13802d(0x12c));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x13802d(0x114)]!==auth_state_enum_1[_0x13802d(0x116)][_0x13802d(0x14a)])return this[_0x13802d(0x11f)]['log'](_0x13802d(0x13c)),await(0x0,utils_1[_0x13802d(0x14c)])(this[_0x13802d(0x12f)]),this[_0x13802d(0x117)]();}['getAuthData'](){const _0x21f5a5=a242_0x224047;return{'orgId':this[_0x21f5a5(0x127)],'accessToken':this[_0x21f5a5(0x133)],'instanceUrl':this[_0x21f5a5(0x106)]};}async['requestConfig'](){const _0x37a8ca=a242_0x224047;return await this[_0x37a8ca(0x117)](),{'baseURL':this[_0x37a8ca(0x106)],'headers':{'accept':_0x37a8ca(0x13a),'authorization':this[_0x37a8ca(0x122)]+'\x20'+this[_0x37a8ca(0x133)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a242_0x224047(0x13b)])(),__metadata(a242_0x224047(0x124),[])],SalesforceAuthService),exports[a242_0x224047(0x128)]=SalesforceAuthService;