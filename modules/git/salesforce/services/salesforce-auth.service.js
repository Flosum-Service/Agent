const a193_0x273b44=a193_0x4c27;(function(_0x26aeb5,_0x549ab4){const _0x41b355=a193_0x4c27,_0x4e03d7=_0x26aeb5();while(!![]){try{const _0x317114=-parseInt(_0x41b355(0x118))/0x1*(parseInt(_0x41b355(0xff))/0x2)+parseInt(_0x41b355(0x138))/0x3+-parseInt(_0x41b355(0x140))/0x4*(parseInt(_0x41b355(0x101))/0x5)+parseInt(_0x41b355(0xf8))/0x6+-parseInt(_0x41b355(0xf3))/0x7*(parseInt(_0x41b355(0x12a))/0x8)+parseInt(_0x41b355(0x136))/0x9+-parseInt(_0x41b355(0x121))/0xa;if(_0x317114===_0x549ab4)break;else _0x4e03d7['push'](_0x4e03d7['shift']());}catch(_0xbed380){_0x4e03d7['push'](_0x4e03d7['shift']());}}}(a193_0x2eed,0xb8c34));function a193_0x4c27(_0x50fc42,_0x38bcc1){const _0x5d3ece=a193_0x2eed();return a193_0x4c27=function(_0x353f36,_0x41a9e7){_0x353f36=_0x353f36-0xe9;let _0x2eedf1=_0x5d3ece[_0x353f36];return _0x2eedf1;},a193_0x4c27(_0x50fc42,_0x38bcc1);}const a193_0x41a9e7=(function(){let _0x37a9a2=!![];return function(_0x18d92c,_0x114fbe){const _0x2e865b=_0x37a9a2?function(){const _0x5e9d1c=a193_0x4c27;if(_0x114fbe){const _0x2cdf6e=_0x114fbe[_0x5e9d1c(0x123)](_0x18d92c,arguments);return _0x114fbe=null,_0x2cdf6e;}}:function(){};return _0x37a9a2=![],_0x2e865b;};}()),a193_0x353f36=a193_0x41a9e7(this,function(){const _0x5ab267=a193_0x4c27;return a193_0x353f36[_0x5ab267(0x12c)]()['search'](_0x5ab267(0xfb))[_0x5ab267(0x12c)]()[_0x5ab267(0x133)](a193_0x353f36)[_0x5ab267(0x11b)](_0x5ab267(0xfb));});a193_0x353f36();'use strict';var __createBinding=this&&this[a193_0x273b44(0xeb)]||(Object[a193_0x273b44(0x116)]?function(_0x3bdf19,_0x2b2f78,_0x7b1fc7,_0x226061){const _0x10ca04=a193_0x273b44;if(_0x226061===undefined)_0x226061=_0x7b1fc7;var _0x319533=Object[_0x10ca04(0x100)](_0x2b2f78,_0x7b1fc7);(!_0x319533||(_0x10ca04(0x104)in _0x319533?!_0x2b2f78[_0x10ca04(0x135)]:_0x319533[_0x10ca04(0xf4)]||_0x319533[_0x10ca04(0xed)]))&&(_0x319533={'enumerable':!![],'get':function(){return _0x2b2f78[_0x7b1fc7];}}),Object[_0x10ca04(0x10f)](_0x3bdf19,_0x226061,_0x319533);}:function(_0xa571e,_0x2dbc88,_0x555987,_0x1e9614){if(_0x1e9614===undefined)_0x1e9614=_0x555987;_0xa571e[_0x1e9614]=_0x2dbc88[_0x555987];}),__setModuleDefault=this&&this[a193_0x273b44(0x10b)]||(Object[a193_0x273b44(0x116)]?function(_0x1d7fd3,_0x17aeb3){const _0x48cb4c=a193_0x273b44;Object[_0x48cb4c(0x10f)](_0x1d7fd3,_0x48cb4c(0x10a),{'enumerable':!![],'value':_0x17aeb3});}:function(_0xb6ba17,_0x4da700){const _0x21af81=a193_0x273b44;_0xb6ba17[_0x21af81(0x10a)]=_0x4da700;}),__decorate=this&&this['__decorate']||function(_0x1d67a5,_0x2770a8,_0x29d8d6,_0x3a2981){const _0x3d1e22=a193_0x273b44;var _0x91ed60=arguments[_0x3d1e22(0x117)],_0x5d9efc=_0x91ed60<0x3?_0x2770a8:_0x3a2981===null?_0x3a2981=Object[_0x3d1e22(0x100)](_0x2770a8,_0x29d8d6):_0x3a2981,_0x4b2a03;if(typeof Reflect===_0x3d1e22(0xe9)&&typeof Reflect[_0x3d1e22(0xea)]==='function')_0x5d9efc=Reflect[_0x3d1e22(0xea)](_0x1d67a5,_0x2770a8,_0x29d8d6,_0x3a2981);else{for(var _0xb44b4a=_0x1d67a5[_0x3d1e22(0x117)]-0x1;_0xb44b4a>=0x0;_0xb44b4a--)if(_0x4b2a03=_0x1d67a5[_0xb44b4a])_0x5d9efc=(_0x91ed60<0x3?_0x4b2a03(_0x5d9efc):_0x91ed60>0x3?_0x4b2a03(_0x2770a8,_0x29d8d6,_0x5d9efc):_0x4b2a03(_0x2770a8,_0x29d8d6))||_0x5d9efc;}return _0x91ed60>0x3&&_0x5d9efc&&Object[_0x3d1e22(0x10f)](_0x2770a8,_0x29d8d6,_0x5d9efc),_0x5d9efc;},__importStar=this&&this[a193_0x273b44(0xf2)]||function(_0x48d6f3){const _0x20f081=a193_0x273b44;if(_0x48d6f3&&_0x48d6f3['__esModule'])return _0x48d6f3;var _0x1fccb3={};if(_0x48d6f3!=null){for(var _0xc578fb in _0x48d6f3)if(_0xc578fb!==_0x20f081(0x10a)&&Object[_0x20f081(0x11d)][_0x20f081(0xec)][_0x20f081(0x11c)](_0x48d6f3,_0xc578fb))__createBinding(_0x1fccb3,_0x48d6f3,_0xc578fb);}return __setModuleDefault(_0x1fccb3,_0x48d6f3),_0x1fccb3;},__metadata=this&&this[a193_0x273b44(0x11a)]||function(_0x1aa4ba,_0x454351){const _0x175dc1=a193_0x273b44;if(typeof Reflect===_0x175dc1(0xe9)&&typeof Reflect[_0x175dc1(0x120)]===_0x175dc1(0x12d))return Reflect[_0x175dc1(0x120)](_0x1aa4ba,_0x454351);},__importDefault=this&&this['__importDefault']||function(_0x3cfea2){const _0x1597c0=a193_0x273b44;return _0x3cfea2&&_0x3cfea2[_0x1597c0(0x135)]?_0x3cfea2:{'default':_0x3cfea2};},SalesforceAuthService_1;Object['defineProperty'](exports,a193_0x273b44(0x135),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a193_0x273b44(0x115))),errors_1=require('../../../../constants/errors'),core_1=require('../../../../core'),axios_1=__importDefault(require(a193_0x273b44(0x139))),utils_1=require(a193_0x273b44(0xfa)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a193_0x273b44(0x122)),unauthorized_salesforce_error_1=require(a193_0x273b44(0x126)),constants_1=require('../../../../constants'),providers_tokens_1=require(a193_0x273b44(0x132));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x7861dc=a193_0x273b44;this['AUTH_WAIT_TIME']=0x1388,this[_0x7861dc(0x127)]=auth_state_enum_1[_0x7861dc(0x130)][_0x7861dc(0xf5)],this[_0x7861dc(0x114)]=new core_1[(_0x7861dc(0x13c))](SalesforceAuthService_1[_0x7861dc(0x11f)]),this[_0x7861dc(0x105)]();}async['setAuthDetails'](){const _0x4f943f=a193_0x273b44;this[_0x4f943f(0x114)][_0x4f943f(0xfc)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x4f943f(0x130)][this[_0x4f943f(0x127)]]);try{if(this['authState']===auth_state_enum_1[_0x4f943f(0x130)][_0x4f943f(0x129)])return;if(this[_0x4f943f(0x127)]===auth_state_enum_1[_0x4f943f(0x130)][_0x4f943f(0xf5)])await this['updateAccessToken']();else{const _0x2a7696=await this[_0x4f943f(0x107)](),_0x397e8a=await axios_1['default']['get'](_0x4f943f(0x103)+constants_1[_0x4f943f(0x10d)],_0x2a7696)[_0x4f943f(0x10c)](()=>!![])[_0x4f943f(0x134)](()=>![]);!_0x397e8a&&await this[_0x4f943f(0x112)]();}}catch(_0x2c24a1){}}async[a193_0x273b44(0x112)](){const _0x295712=a193_0x273b44;var _0x29d254,_0x307904,_0x4a23df;this[_0x295712(0x114)][_0x295712(0xfc)](_0x295712(0x12b));try{this[_0x295712(0x127)]=auth_state_enum_1['AuthState'][_0x295712(0x12f)];const {refreshToken:_0x23ecbc,clientId:_0xe3079,clientSecret:_0x23664c,loginUrl:_0x3e1372}=typedi_1['default'][_0x295712(0x104)](providers_tokens_1[_0x295712(0x13b)]['salesforce']),{data:_0x57f3f9}=await axios_1['default'][_0x295712(0x108)]((0x0,utils_1[_0x295712(0x13d)])(_0x3e1372,'/services/oauth2/token'),null,{'params':{'grant_type':_0x295712(0xfd),'refresh_token':_0x23ecbc,'client_id':_0xe3079,'client_secret':_0x23664c}});this['instanceUrl']=_0x57f3f9[_0x295712(0xee)],this[_0x295712(0x109)]=_0x57f3f9[_0x295712(0x125)],this['tokenType']=_0x57f3f9[_0x295712(0xf0)],this[_0x295712(0x127)]=auth_state_enum_1[_0x295712(0x130)][_0x295712(0x102)],this['logger'][_0x295712(0xfc)](_0x295712(0xef),this[_0x295712(0x119)]);}catch(_0x175092){const _0x17b623=((_0x307904=(_0x29d254=_0x175092===null||_0x175092===void 0x0?void 0x0:_0x175092[_0x295712(0x106)])===null||_0x29d254===void 0x0?void 0x0:_0x29d254[_0x295712(0x11e)])===null||_0x307904===void 0x0?void 0x0:_0x307904[_0x295712(0x131)])||((_0x4a23df=_0x175092===null||_0x175092===void 0x0?void 0x0:_0x175092[_0x295712(0x106)])===null||_0x4a23df===void 0x0?void 0x0:_0x4a23df[_0x295712(0x11e)])||_0x175092['message'];this['logger'][_0x295712(0x131)](_0x295712(0xf1),_0x17b623),this[_0x295712(0x127)]=auth_state_enum_1['AuthState']['Error'];throw new invalid_refresh_token_error_1[(_0x295712(0x12e))](errors_1[_0x295712(0x128)]);}}async[a193_0x273b44(0x13f)](){const _0x43d5a7=a193_0x273b44;this[_0x43d5a7(0x114)][_0x43d5a7(0xfc)](_0x43d5a7(0x124));if(this[_0x43d5a7(0x127)]===auth_state_enum_1[_0x43d5a7(0x130)][_0x43d5a7(0x12f)]||this[_0x43d5a7(0x127)]===auth_state_enum_1[_0x43d5a7(0x130)][_0x43d5a7(0xf5)])return await(0x0,utils_1[_0x43d5a7(0xf7)])(this[_0x43d5a7(0x137)]),this['forceUpdateToken']();if(this[_0x43d5a7(0x127)]===auth_state_enum_1[_0x43d5a7(0x130)]['Error'])throw new invalid_refresh_token_error_1[(_0x43d5a7(0x12e))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x43d5a7(0x112)]();}async['waitAuth'](){const _0x177c8e=a193_0x273b44;if(this[_0x177c8e(0x127)]===auth_state_enum_1[_0x177c8e(0x130)][_0x177c8e(0x129)]){this['logger'][_0x177c8e(0xfc)](_0x177c8e(0x110));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x177c8e(0x127)]!==auth_state_enum_1[_0x177c8e(0x130)][_0x177c8e(0x102)])return this['logger'][_0x177c8e(0xfc)](_0x177c8e(0x113)),await(0x0,utils_1[_0x177c8e(0xf7)])(this[_0x177c8e(0x137)]),this[_0x177c8e(0x111)]();}[a193_0x273b44(0x13a)](){const _0x5633e9=a193_0x273b44;return{'orgId':this[_0x5633e9(0x13e)],'accessToken':this[_0x5633e9(0x109)],'instanceUrl':this['instanceUrl']};}async['requestConfig'](){const _0x7d0281=a193_0x273b44;return await this[_0x7d0281(0x111)](),{'baseURL':this[_0x7d0281(0x119)],'headers':{'accept':'application/json','authorization':this[_0x7d0281(0xf9)]+'\x20'+this[_0x7d0281(0x109)]}};}};function a193_0x2eed(){const _0xcc798c=['response','requestConfig','post','accessToken','default','__setModuleDefault','then','SALESFORCE_API_VERSION','Service','defineProperty','create\x20authorized\x20request\x20failed:\x20authorization\x20error','waitAuth','updateAccessToken','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','logger','typedi','create','length','13CdlTMl','instanceUrl','__metadata','search','call','prototype','data','name','metadata','81010jOrjSv','../enums/auth-state.enum','apply','force\x20update\x20token','access_token','../errors/unauthorized-salesforce.error','authState','ERR_INVALID_SALESFORCE_TOKEN','Error','862968THnsaM','update\x20access\x20token','toString','function','InvalidRefreshTokenError','Updating','AuthState','error','../../providers/providers.tokens','constructor','catch','__esModule','3725991HCRxkF','AUTH_WAIT_TIME','4249773xfUReQ','axios','getAuthData','Tokens','Logger','joinURL','orgId','forceUpdateToken','266968iNhlpG','object','decorate','__createBinding','hasOwnProperty','configurable','instance_url','access\x20token\x20updated\x20for\x20%s','token_type','update\x20access\x20token\x20failed:\x20%s','__importStar','56jBqkte','writable','Idle','design:paramtypes','sleep','1276092ccMqfH','tokenType','../../../shared/utils','(((.+)+)+)+$','log','refresh_token','SalesforceAuthService','43374kJVoye','getOwnPropertyDescriptor','10TKGpSO','Active','services/data/','get','setAuthDetails'];a193_0x2eed=function(){return _0xcc798c;};return a193_0x2eed();}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a193_0x273b44(0x10e)])(),__metadata(a193_0x273b44(0xf6),[])],SalesforceAuthService),exports[a193_0x273b44(0xfe)]=SalesforceAuthService;