const a270_0x4ea563=a270_0x5a73;(function(_0xad146b,_0x1bfc77){const _0x42cf73=a270_0x5a73,_0x4bebc4=_0xad146b();while(!![]){try{const _0x271a1b=parseInt(_0x42cf73(0x157))/0x1+parseInt(_0x42cf73(0x14a))/0x2+parseInt(_0x42cf73(0x178))/0x3+parseInt(_0x42cf73(0x163))/0x4*(parseInt(_0x42cf73(0x180))/0x5)+parseInt(_0x42cf73(0x134))/0x6+-parseInt(_0x42cf73(0x148))/0x7*(parseInt(_0x42cf73(0x16d))/0x8)+parseInt(_0x42cf73(0x153))/0x9*(-parseInt(_0x42cf73(0x165))/0xa);if(_0x271a1b===_0x1bfc77)break;else _0x4bebc4['push'](_0x4bebc4['shift']());}catch(_0xde5278){_0x4bebc4['push'](_0x4bebc4['shift']());}}}(a270_0x1701,0x1db96));const a270_0xa604d7=(function(){let _0x46b44f=!![];return function(_0x281931,_0x22abf1){const _0x1dc00e=_0x46b44f?function(){const _0x4fb10d=a270_0x5a73;if(_0x22abf1){const _0x3adf37=_0x22abf1[_0x4fb10d(0x190)](_0x281931,arguments);return _0x22abf1=null,_0x3adf37;}}:function(){};return _0x46b44f=![],_0x1dc00e;};}()),a270_0x1aaef4=a270_0xa604d7(this,function(){const _0x4ff0b6=a270_0x5a73;return a270_0x1aaef4[_0x4ff0b6(0x169)]()[_0x4ff0b6(0x13e)]('(((.+)+)+)+$')['toString']()[_0x4ff0b6(0x15e)](a270_0x1aaef4)['search'](_0x4ff0b6(0x179));});function a270_0x5a73(_0xc170e7,_0x215ca4){const _0xf26149=a270_0x1701();return a270_0x5a73=function(_0x1aaef4,_0xa604d7){_0x1aaef4=_0x1aaef4-0x133;let _0x17015e=_0xf26149[_0x1aaef4];return _0x17015e;},a270_0x5a73(_0xc170e7,_0x215ca4);}a270_0x1aaef4();'use strict';var __createBinding=this&&this[a270_0x4ea563(0x15f)]||(Object[a270_0x4ea563(0x173)]?function(_0x349a8c,_0x43fa3e,_0x2332d0,_0x102d47){const _0xc027de=a270_0x4ea563;if(_0x102d47===undefined)_0x102d47=_0x2332d0;var _0x4c866b=Object['getOwnPropertyDescriptor'](_0x43fa3e,_0x2332d0);(!_0x4c866b||(_0xc027de(0x156)in _0x4c866b?!_0x43fa3e[_0xc027de(0x172)]:_0x4c866b['writable']||_0x4c866b['configurable']))&&(_0x4c866b={'enumerable':!![],'get':function(){return _0x43fa3e[_0x2332d0];}}),Object[_0xc027de(0x15c)](_0x349a8c,_0x102d47,_0x4c866b);}:function(_0x4f7136,_0x41b9d6,_0x5b7e8c,_0x5ac2fc){if(_0x5ac2fc===undefined)_0x5ac2fc=_0x5b7e8c;_0x4f7136[_0x5ac2fc]=_0x41b9d6[_0x5b7e8c];}),__setModuleDefault=this&&this[a270_0x4ea563(0x16c)]||(Object[a270_0x4ea563(0x173)]?function(_0x3bd0e3,_0x2c30c4){const _0x16414d=a270_0x4ea563;Object[_0x16414d(0x15c)](_0x3bd0e3,_0x16414d(0x162),{'enumerable':!![],'value':_0x2c30c4});}:function(_0x5d6074,_0x5ee5d8){const _0x17f5f9=a270_0x4ea563;_0x5d6074[_0x17f5f9(0x162)]=_0x5ee5d8;}),__decorate=this&&this[a270_0x4ea563(0x15b)]||function(_0x5e69d7,_0x242fa2,_0x1cdc77,_0x5c1f1b){const _0x6b5e6d=a270_0x4ea563;var _0x42cb44=arguments[_0x6b5e6d(0x145)],_0x4f7ad8=_0x42cb44<0x3?_0x242fa2:_0x5c1f1b===null?_0x5c1f1b=Object[_0x6b5e6d(0x161)](_0x242fa2,_0x1cdc77):_0x5c1f1b,_0x38c911;if(typeof Reflect==='object'&&typeof Reflect[_0x6b5e6d(0x15a)]===_0x6b5e6d(0x17a))_0x4f7ad8=Reflect[_0x6b5e6d(0x15a)](_0x5e69d7,_0x242fa2,_0x1cdc77,_0x5c1f1b);else{for(var _0x54e8ab=_0x5e69d7['length']-0x1;_0x54e8ab>=0x0;_0x54e8ab--)if(_0x38c911=_0x5e69d7[_0x54e8ab])_0x4f7ad8=(_0x42cb44<0x3?_0x38c911(_0x4f7ad8):_0x42cb44>0x3?_0x38c911(_0x242fa2,_0x1cdc77,_0x4f7ad8):_0x38c911(_0x242fa2,_0x1cdc77))||_0x4f7ad8;}return _0x42cb44>0x3&&_0x4f7ad8&&Object['defineProperty'](_0x242fa2,_0x1cdc77,_0x4f7ad8),_0x4f7ad8;},__importStar=this&&this['__importStar']||function(_0x4aa8e0){const _0x38b956=a270_0x4ea563;if(_0x4aa8e0&&_0x4aa8e0[_0x38b956(0x172)])return _0x4aa8e0;var _0x1129e0={};if(_0x4aa8e0!=null){for(var _0x4bd04c in _0x4aa8e0)if(_0x4bd04c!==_0x38b956(0x162)&&Object[_0x38b956(0x13f)][_0x38b956(0x167)][_0x38b956(0x13b)](_0x4aa8e0,_0x4bd04c))__createBinding(_0x1129e0,_0x4aa8e0,_0x4bd04c);}return __setModuleDefault(_0x1129e0,_0x4aa8e0),_0x1129e0;},__metadata=this&&this[a270_0x4ea563(0x17d)]||function(_0x51fa8b,_0x2ade1c){const _0x41280d=a270_0x4ea563;if(typeof Reflect===_0x41280d(0x181)&&typeof Reflect['metadata']===_0x41280d(0x17a))return Reflect['metadata'](_0x51fa8b,_0x2ade1c);},__importDefault=this&&this['__importDefault']||function(_0x108594){const _0x27985c=a270_0x4ea563;return _0x108594&&_0x108594[_0x27985c(0x172)]?_0x108594:{'default':_0x108594};},SalesforceAuthService_1;function a270_0x1701(){const _0x586092=['../../../shared/utils','isSoapUrl','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','apply','../../../../constants/errors','refresh_token','salesforce','631554CBFLzs','Error','getAuthData','updateAccessToken','services/data/','axios','Idle','call','../../providers/providers.tokens','../errors/unauthorized-salesforce.error','search','prototype','Check\x20auth:\x20current\x20state\x20-\x20%s','UnauthorizedSalesforceError','sleep','AuthState','Force\x20update\x20token','length','typedi','AUTH_WAIT_TIME','756PzCwxa','@flosum/salesforce','398876woZVuO','application/json','authState','forceUpdateToken','requestConfig','response','SalesforceAuthService','../enums/auth-state.enum','data','9CouuJP','../errors/invalid-refresh-token.error','access_token','get','173866dDEFJK','InvalidRefreshTokenError','Active','decorate','__decorate','defineProperty','design:paramtypes','constructor','__createBinding','waitAuth','getOwnPropertyDescriptor','default','292604ZVLqTU','SALESFORCE_API_VERSION','3531050QHxWtu','ERR_INVALID_SALESFORCE_TOKEN','hasOwnProperty','instanceUrl','toString','authorization','logger','__setModuleDefault','11992BnVpuJ','</met:sessionId>','../../../../core','Logger','name','__esModule','create','instance_url','then','log','replace','35646TVXUud','(((.+)+)+)+$','function','../../../../constants','SalesforceUtils','__metadata','Tokens','setAuthDetails','10IoCGxt','object','Update\x20access\x20token\x20failed:\x20%s','joinURL','Update\x20access\x20token','Access\x20token\x20updated\x20for\x20%s','error','<met:sessionId>','orgId','message','tokenType','Updating','accessToken'];a270_0x1701=function(){return _0x586092;};return a270_0x1701();}Object[a270_0x4ea563(0x15c)](exports,a270_0x4ea563(0x172),{'value':!![]}),exports[a270_0x4ea563(0x150)]=void 0x0;const typedi_1=__importStar(require(a270_0x4ea563(0x146))),errors_1=require(a270_0x4ea563(0x191)),core_1=require(a270_0x4ea563(0x16f)),axios_1=__importDefault(require(a270_0x4ea563(0x139))),utils_1=require(a270_0x4ea563(0x18d)),invalid_refresh_token_error_1=require(a270_0x4ea563(0x154)),auth_state_enum_1=require(a270_0x4ea563(0x151)),unauthorized_salesforce_error_1=require(a270_0x4ea563(0x13d)),constants_1=require(a270_0x4ea563(0x17b)),providers_tokens_1=require(a270_0x4ea563(0x13c)),salesforce_1=require(a270_0x4ea563(0x149));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x31cce2=a270_0x4ea563;this['AUTH_WAIT_TIME']=0x1388,this[_0x31cce2(0x14c)]=auth_state_enum_1[_0x31cce2(0x143)][_0x31cce2(0x13a)],this[_0x31cce2(0x16b)]=new core_1[(_0x31cce2(0x170))](SalesforceAuthService_1[_0x31cce2(0x171)]),this[_0x31cce2(0x17f)]();}async[a270_0x4ea563(0x17f)](){const _0x4be40b=a270_0x4ea563;this[_0x4be40b(0x16b)][_0x4be40b(0x176)](_0x4be40b(0x140),auth_state_enum_1[_0x4be40b(0x143)][this[_0x4be40b(0x14c)]]);try{if(this['authState']===auth_state_enum_1[_0x4be40b(0x143)][_0x4be40b(0x135)])return;if(this['authState']===auth_state_enum_1[_0x4be40b(0x143)][_0x4be40b(0x13a)])await this[_0x4be40b(0x137)]();else{const _0x5bde63=await this['requestConfig'](),_0x571913=await axios_1[_0x4be40b(0x162)][_0x4be40b(0x156)](_0x4be40b(0x138)+constants_1[_0x4be40b(0x164)],_0x5bde63)[_0x4be40b(0x175)](()=>!![])['catch'](()=>![]);!_0x571913&&await this[_0x4be40b(0x137)]();}}catch(_0x763f7f){}}async['updateAccessToken'](){const _0x8c6ab=a270_0x4ea563;var _0x206b45,_0x201643,_0x37c899;this[_0x8c6ab(0x16b)]['log'](_0x8c6ab(0x184));try{this['authState']=auth_state_enum_1[_0x8c6ab(0x143)][_0x8c6ab(0x18b)];const {refreshToken:_0x40b220,clientId:_0x177b9d,clientSecret:_0x587701,loginUrl:_0x4292c3}=typedi_1[_0x8c6ab(0x162)][_0x8c6ab(0x156)](providers_tokens_1[_0x8c6ab(0x17e)][_0x8c6ab(0x133)]),{data:_0x167bc3}=await axios_1[_0x8c6ab(0x162)]['post']((0x0,utils_1[_0x8c6ab(0x183)])(_0x4292c3,'/services/oauth2/token'),null,{'params':{'grant_type':_0x8c6ab(0x192),'refresh_token':_0x40b220,'client_id':_0x177b9d,'client_secret':_0x587701}});this[_0x8c6ab(0x168)]=_0x167bc3[_0x8c6ab(0x174)],this['accessToken']=_0x167bc3[_0x8c6ab(0x155)],this[_0x8c6ab(0x18a)]=_0x167bc3['token_type'],this[_0x8c6ab(0x14c)]=auth_state_enum_1[_0x8c6ab(0x143)]['Active'],this['logger'][_0x8c6ab(0x176)](_0x8c6ab(0x185),this[_0x8c6ab(0x168)]);}catch(_0x364656){const _0x3b37e6=((_0x201643=(_0x206b45=_0x364656===null||_0x364656===void 0x0?void 0x0:_0x364656[_0x8c6ab(0x14f)])===null||_0x206b45===void 0x0?void 0x0:_0x206b45[_0x8c6ab(0x152)])===null||_0x201643===void 0x0?void 0x0:_0x201643['error'])||((_0x37c899=_0x364656===null||_0x364656===void 0x0?void 0x0:_0x364656['response'])===null||_0x37c899===void 0x0?void 0x0:_0x37c899[_0x8c6ab(0x152)])||_0x364656[_0x8c6ab(0x189)];this[_0x8c6ab(0x16b)][_0x8c6ab(0x186)](_0x8c6ab(0x182),_0x3b37e6),this[_0x8c6ab(0x14c)]=auth_state_enum_1[_0x8c6ab(0x143)][_0x8c6ab(0x135)];throw new invalid_refresh_token_error_1[(_0x8c6ab(0x158))](errors_1[_0x8c6ab(0x166)]);}}async[a270_0x4ea563(0x14d)](){const _0x267ad5=a270_0x4ea563;this[_0x267ad5(0x16b)][_0x267ad5(0x176)](_0x267ad5(0x144));if(this['authState']===auth_state_enum_1['AuthState'][_0x267ad5(0x18b)]||this[_0x267ad5(0x14c)]===auth_state_enum_1[_0x267ad5(0x143)][_0x267ad5(0x13a)])return await(0x0,utils_1[_0x267ad5(0x142)])(this[_0x267ad5(0x147)]),this[_0x267ad5(0x14d)]();if(this[_0x267ad5(0x14c)]===auth_state_enum_1[_0x267ad5(0x143)][_0x267ad5(0x135)])throw new invalid_refresh_token_error_1[(_0x267ad5(0x158))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x267ad5(0x137)]();}async[a270_0x4ea563(0x160)](){const _0x22d823=a270_0x4ea563;if(this[_0x22d823(0x14c)]===auth_state_enum_1[_0x22d823(0x143)][_0x22d823(0x135)]){this['logger'][_0x22d823(0x176)](_0x22d823(0x18f));throw new unauthorized_salesforce_error_1[(_0x22d823(0x141))]();}if(this[_0x22d823(0x14c)]!==auth_state_enum_1[_0x22d823(0x143)][_0x22d823(0x159)])return this[_0x22d823(0x16b)][_0x22d823(0x176)]('Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x22d823(0x142)])(this[_0x22d823(0x147)]),this[_0x22d823(0x160)]();}[a270_0x4ea563(0x136)](){const _0x569ccd=a270_0x4ea563;return{'orgId':this[_0x569ccd(0x188)],'accessToken':this[_0x569ccd(0x18c)],'instanceUrl':this[_0x569ccd(0x168)]};}async[a270_0x4ea563(0x14e)](_0x3c9fc4=''){const _0x105f47=a270_0x4ea563;await this[_0x105f47(0x160)]();const _0x5964fb={'baseURL':this[_0x105f47(0x168)],'headers':{'accept':_0x105f47(0x14b)}};if(salesforce_1['SalesforceUtils']['isBulk1Url'](_0x3c9fc4))_0x5964fb['headers']['X-SFDC-Session']=this['accessToken'];else salesforce_1[_0x105f47(0x17c)][_0x105f47(0x18e)](_0x3c9fc4)?_0x5964fb['data']=_0x5964fb['data'][_0x105f47(0x177)](/<met:sessionId>.+?<\/met:sessionId>/,_0x105f47(0x187)+this['accessToken']+_0x105f47(0x16e)):_0x5964fb['headers'][_0x105f47(0x16a)]=this['tokenType']+'\x20'+this[_0x105f47(0x18c)];return _0x5964fb;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a270_0x4ea563(0x15d),[])],SalesforceAuthService),exports[a270_0x4ea563(0x150)]=SalesforceAuthService;