const a259_0x43fb83=a259_0x25ed;(function(_0x58bf4c,_0x127c51){const _0x1191e=a259_0x25ed,_0x507b86=_0x58bf4c();while(!![]){try{const _0x26abd6=parseInt(_0x1191e(0x178))/0x1+-parseInt(_0x1191e(0x17c))/0x2*(-parseInt(_0x1191e(0x1b3))/0x3)+-parseInt(_0x1191e(0x1ac))/0x4+parseInt(_0x1191e(0x174))/0x5*(parseInt(_0x1191e(0x166))/0x6)+-parseInt(_0x1191e(0x17d))/0x7+parseInt(_0x1191e(0x18a))/0x8*(parseInt(_0x1191e(0x1be))/0x9)+-parseInt(_0x1191e(0x172))/0xa;if(_0x26abd6===_0x127c51)break;else _0x507b86['push'](_0x507b86['shift']());}catch(_0x1550f6){_0x507b86['push'](_0x507b86['shift']());}}}(a259_0x2c1a,0xbc2c1));const a259_0x15fdaf=(function(){let _0x25c5bb=!![];return function(_0x2643e1,_0x5ac3ec){const _0x2067db=_0x25c5bb?function(){const _0x49d5ef=a259_0x25ed;if(_0x5ac3ec){const _0x15a064=_0x5ac3ec[_0x49d5ef(0x171)](_0x2643e1,arguments);return _0x5ac3ec=null,_0x15a064;}}:function(){};return _0x25c5bb=![],_0x2067db;};}()),a259_0x26c58b=a259_0x15fdaf(this,function(){const _0x5b62d5=a259_0x25ed;return a259_0x26c58b[_0x5b62d5(0x185)]()[_0x5b62d5(0x1a8)](_0x5b62d5(0x181))[_0x5b62d5(0x185)]()[_0x5b62d5(0x16a)](a259_0x26c58b)['search'](_0x5b62d5(0x181));});a259_0x26c58b();'use strict';var __createBinding=this&&this[a259_0x43fb83(0x195)]||(Object['create']?function(_0x34766c,_0x1291f1,_0x578b6e,_0x5469be){const _0x43b1a7=a259_0x43fb83;if(_0x5469be===undefined)_0x5469be=_0x578b6e;var _0x4f0685=Object[_0x43b1a7(0x169)](_0x1291f1,_0x578b6e);(!_0x4f0685||(_0x43b1a7(0x179)in _0x4f0685?!_0x1291f1['__esModule']:_0x4f0685[_0x43b1a7(0x170)]||_0x4f0685[_0x43b1a7(0x1af)]))&&(_0x4f0685={'enumerable':!![],'get':function(){return _0x1291f1[_0x578b6e];}}),Object[_0x43b1a7(0x16e)](_0x34766c,_0x5469be,_0x4f0685);}:function(_0x2b5711,_0x3ff6d0,_0x4e6f3b,_0x3e0adb){if(_0x3e0adb===undefined)_0x3e0adb=_0x4e6f3b;_0x2b5711[_0x3e0adb]=_0x3ff6d0[_0x4e6f3b];}),__setModuleDefault=this&&this[a259_0x43fb83(0x187)]||(Object[a259_0x43fb83(0x16f)]?function(_0x2427f7,_0x5610b4){const _0x5a4ddf=a259_0x43fb83;Object['defineProperty'](_0x2427f7,_0x5a4ddf(0x1b6),{'enumerable':!![],'value':_0x5610b4});}:function(_0x32cca6,_0x51747e){_0x32cca6['default']=_0x51747e;}),__decorate=this&&this[a259_0x43fb83(0x1ba)]||function(_0x4e16d2,_0x51eb8a,_0x310853,_0x537f68){const _0x45de86=a259_0x43fb83;var _0x4375ab=arguments[_0x45de86(0x18b)],_0x2780dd=_0x4375ab<0x3?_0x51eb8a:_0x537f68===null?_0x537f68=Object['getOwnPropertyDescriptor'](_0x51eb8a,_0x310853):_0x537f68,_0x234d0c;if(typeof Reflect===_0x45de86(0x1a9)&&typeof Reflect[_0x45de86(0x1a2)]==='function')_0x2780dd=Reflect['decorate'](_0x4e16d2,_0x51eb8a,_0x310853,_0x537f68);else{for(var _0x1895f4=_0x4e16d2[_0x45de86(0x18b)]-0x1;_0x1895f4>=0x0;_0x1895f4--)if(_0x234d0c=_0x4e16d2[_0x1895f4])_0x2780dd=(_0x4375ab<0x3?_0x234d0c(_0x2780dd):_0x4375ab>0x3?_0x234d0c(_0x51eb8a,_0x310853,_0x2780dd):_0x234d0c(_0x51eb8a,_0x310853))||_0x2780dd;}return _0x4375ab>0x3&&_0x2780dd&&Object[_0x45de86(0x16e)](_0x51eb8a,_0x310853,_0x2780dd),_0x2780dd;},__importStar=this&&this['__importStar']||function(_0x250c6a){const _0x4e35a4=a259_0x43fb83;if(_0x250c6a&&_0x250c6a['__esModule'])return _0x250c6a;var _0x454a1d={};if(_0x250c6a!=null){for(var _0x459704 in _0x250c6a)if(_0x459704!==_0x4e35a4(0x1b6)&&Object['prototype'][_0x4e35a4(0x1a7)][_0x4e35a4(0x1a1)](_0x250c6a,_0x459704))__createBinding(_0x454a1d,_0x250c6a,_0x459704);}return __setModuleDefault(_0x454a1d,_0x250c6a),_0x454a1d;},__metadata=this&&this[a259_0x43fb83(0x190)]||function(_0x25ab09,_0x333d12){const _0x28a6fd=a259_0x43fb83;if(typeof Reflect===_0x28a6fd(0x1a9)&&typeof Reflect[_0x28a6fd(0x1bc)]==='function')return Reflect['metadata'](_0x25ab09,_0x333d12);},__importDefault=this&&this['__importDefault']||function(_0x8b44b6){const _0x3d96f4=a259_0x43fb83;return _0x8b44b6&&_0x8b44b6[_0x3d96f4(0x1ab)]?_0x8b44b6:{'default':_0x8b44b6};},SalesforceAuthService_1;Object['defineProperty'](exports,a259_0x43fb83(0x1ab),{'value':!![]}),exports[a259_0x43fb83(0x1ae)]=void 0x0;function a259_0x2c1a(){const _0x5befe9=['2628399QZrSkn','joinURL','requestConfig','default','Updating','post','log','__decorate','Force\x20update\x20token','metadata','Check\x20auth:\x20current\x20state\x20-\x20%s','1082511qPBCJS','instanceUrl','then','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','data','accessToken','65730QrhOxp','</met:sessionId>','AuthState','getOwnPropertyDescriptor','constructor','waitAuth','access_token','Logger','defineProperty','create','writable','apply','1633760CLCxok','Service','80sPZPMB','application/json','Access\x20token\x20updated\x20for\x20%s','../enums/auth-state.enum','1044381lhCpDN','get','SALESFORCE_API_VERSION','typedi','2PPkSYH','9009791XfkUxm','authState','logger','ERR_INVALID_SALESFORCE_TOKEN','(((.+)+)+)+$','refresh_token','../../../../core','../../../../constants','toString','response','__setModuleDefault','InvalidRefreshTokenError','/services/oauth2/token','24wwbzOT','length','catch','token_type','tokenType','updateAccessToken','__metadata','authorization','headers','instance_url','Error','__createBinding','SalesforceUtils','services/data/','isBulk1Url','orgId','setAuthDetails','UnauthorizedSalesforceError','Tokens','design:paramtypes','forceUpdateToken','message','../../../shared/utils','call','decorate','replace','Idle','../../../../constants/errors','getAuthData','hasOwnProperty','search','object','AUTH_WAIT_TIME','__esModule','941556XGhjsQ','../errors/unauthorized-salesforce.error','SalesforceAuthService','configurable','sleep','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','X-SFDC-Session'];a259_0x2c1a=function(){return _0x5befe9;};return a259_0x2c1a();}const typedi_1=__importStar(require(a259_0x43fb83(0x17b))),errors_1=require(a259_0x43fb83(0x1a5)),core_1=require(a259_0x43fb83(0x183)),axios_1=__importDefault(require('axios')),utils_1=require(a259_0x43fb83(0x1a0)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a259_0x43fb83(0x177)),unauthorized_salesforce_error_1=require(a259_0x43fb83(0x1ad)),constants_1=require(a259_0x43fb83(0x184)),providers_tokens_1=require('../../providers/providers.tokens'),salesforce_1=require('@flosum/salesforce');function a259_0x25ed(_0x23784c,_0x5f40dd){const _0x2f4662=a259_0x2c1a();return a259_0x25ed=function(_0x26c58b,_0x15fdaf){_0x26c58b=_0x26c58b-0x164;let _0x2c1a82=_0x2f4662[_0x26c58b];return _0x2c1a82;},a259_0x25ed(_0x23784c,_0x5f40dd);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x465c00=a259_0x43fb83;this[_0x465c00(0x1aa)]=0x1388,this[_0x465c00(0x17e)]=auth_state_enum_1['AuthState'][_0x465c00(0x1a4)],this['logger']=new core_1[(_0x465c00(0x16d))](SalesforceAuthService_1['name']),this['setAuthDetails']();}async[a259_0x43fb83(0x19a)](){const _0x419ad6=a259_0x43fb83;this[_0x419ad6(0x17f)][_0x419ad6(0x1b9)](_0x419ad6(0x1bd),auth_state_enum_1['AuthState'][this['authState']]);try{if(this[_0x419ad6(0x17e)]===auth_state_enum_1[_0x419ad6(0x168)]['Error'])return;if(this[_0x419ad6(0x17e)]===auth_state_enum_1[_0x419ad6(0x168)][_0x419ad6(0x1a4)])await this[_0x419ad6(0x18f)]();else{const _0x2709de=await this[_0x419ad6(0x1b5)](),_0x404ed5=await axios_1['default']['get'](_0x419ad6(0x197)+constants_1[_0x419ad6(0x17a)],_0x2709de)[_0x419ad6(0x1c0)](()=>!![])[_0x419ad6(0x18c)](()=>![]);!_0x404ed5&&await this[_0x419ad6(0x18f)]();}}catch(_0x4fc1dd){}}async['updateAccessToken'](){const _0x248b29=a259_0x43fb83;var _0x48740a,_0x5b42b8,_0x3d5676;this[_0x248b29(0x17f)][_0x248b29(0x1b9)]('Update\x20access\x20token');try{this[_0x248b29(0x17e)]=auth_state_enum_1['AuthState'][_0x248b29(0x1b7)];const {refreshToken:_0x40d41a,clientId:_0x729182,clientSecret:_0x1fe480,loginUrl:_0x4f7700}=typedi_1[_0x248b29(0x1b6)][_0x248b29(0x179)](providers_tokens_1[_0x248b29(0x19c)]['salesforce']),{data:_0x206c40}=await axios_1[_0x248b29(0x1b6)][_0x248b29(0x1b8)]((0x0,utils_1[_0x248b29(0x1b4)])(_0x4f7700,_0x248b29(0x189)),null,{'params':{'grant_type':_0x248b29(0x182),'refresh_token':_0x40d41a,'client_id':_0x729182,'client_secret':_0x1fe480}});this[_0x248b29(0x1bf)]=_0x206c40[_0x248b29(0x193)],this[_0x248b29(0x165)]=_0x206c40[_0x248b29(0x16c)],this[_0x248b29(0x18e)]=_0x206c40[_0x248b29(0x18d)],this[_0x248b29(0x17e)]=auth_state_enum_1[_0x248b29(0x168)]['Active'],this['logger']['log'](_0x248b29(0x176),this[_0x248b29(0x1bf)]);}catch(_0x259b82){const _0x45e9b7=((_0x5b42b8=(_0x48740a=_0x259b82===null||_0x259b82===void 0x0?void 0x0:_0x259b82['response'])===null||_0x48740a===void 0x0?void 0x0:_0x48740a[_0x248b29(0x164)])===null||_0x5b42b8===void 0x0?void 0x0:_0x5b42b8['error'])||((_0x3d5676=_0x259b82===null||_0x259b82===void 0x0?void 0x0:_0x259b82[_0x248b29(0x186)])===null||_0x3d5676===void 0x0?void 0x0:_0x3d5676['data'])||_0x259b82[_0x248b29(0x19f)];this[_0x248b29(0x17f)]['error']('Update\x20access\x20token\x20failed:\x20%s',_0x45e9b7),this[_0x248b29(0x17e)]=auth_state_enum_1[_0x248b29(0x168)][_0x248b29(0x194)];throw new invalid_refresh_token_error_1[(_0x248b29(0x188))](errors_1[_0x248b29(0x180)]);}}async[a259_0x43fb83(0x19e)](){const _0x27aa73=a259_0x43fb83;this[_0x27aa73(0x17f)]['log'](_0x27aa73(0x1bb));if(this[_0x27aa73(0x17e)]===auth_state_enum_1[_0x27aa73(0x168)][_0x27aa73(0x1b7)]||this[_0x27aa73(0x17e)]===auth_state_enum_1[_0x27aa73(0x168)][_0x27aa73(0x1a4)])return await(0x0,utils_1[_0x27aa73(0x1b0)])(this[_0x27aa73(0x1aa)]),this[_0x27aa73(0x19e)]();if(this[_0x27aa73(0x17e)]===auth_state_enum_1['AuthState']['Error'])throw new invalid_refresh_token_error_1[(_0x27aa73(0x188))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x27aa73(0x18f)]();}async[a259_0x43fb83(0x16b)](){const _0x253c17=a259_0x43fb83;if(this['authState']===auth_state_enum_1[_0x253c17(0x168)][_0x253c17(0x194)]){this[_0x253c17(0x17f)][_0x253c17(0x1b9)](_0x253c17(0x1c1));throw new unauthorized_salesforce_error_1[(_0x253c17(0x19b))]();}if(this[_0x253c17(0x17e)]!==auth_state_enum_1[_0x253c17(0x168)]['Active'])return this[_0x253c17(0x17f)][_0x253c17(0x1b9)](_0x253c17(0x1b1)),await(0x0,utils_1['sleep'])(this[_0x253c17(0x1aa)]),this[_0x253c17(0x16b)]();}[a259_0x43fb83(0x1a6)](){const _0x2293fd=a259_0x43fb83;return{'orgId':this[_0x2293fd(0x199)],'accessToken':this[_0x2293fd(0x165)],'instanceUrl':this[_0x2293fd(0x1bf)]};}async['requestConfig'](_0x25af7d=''){const _0x238b9e=a259_0x43fb83;await this['waitAuth']();const _0x259f2e={'baseURL':this[_0x238b9e(0x1bf)],'headers':{'accept':_0x238b9e(0x175)}};if(salesforce_1['SalesforceUtils'][_0x238b9e(0x198)](_0x25af7d))_0x259f2e[_0x238b9e(0x192)][_0x238b9e(0x1b2)]=this['accessToken'];else salesforce_1[_0x238b9e(0x196)]['isSoapUrl'](_0x25af7d)?_0x259f2e[_0x238b9e(0x164)]=_0x259f2e[_0x238b9e(0x164)][_0x238b9e(0x1a3)](/<met:sessionId>.+?<\/met:sessionId>/,'<met:sessionId>'+this[_0x238b9e(0x165)]+_0x238b9e(0x167)):_0x259f2e[_0x238b9e(0x192)][_0x238b9e(0x191)]=this['tokenType']+'\x20'+this['accessToken'];return _0x259f2e;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a259_0x43fb83(0x173)])(),__metadata(a259_0x43fb83(0x19d),[])],SalesforceAuthService),exports[a259_0x43fb83(0x1ae)]=SalesforceAuthService;