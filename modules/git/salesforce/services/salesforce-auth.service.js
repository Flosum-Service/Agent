function a226_0x34e7(_0x17dc33,_0x5c0b07){const _0x2bde02=a226_0x4fce();return a226_0x34e7=function(_0x1199f3,_0x21098a){_0x1199f3=_0x1199f3-0x128;let _0x4fce98=_0x2bde02[_0x1199f3];return _0x4fce98;},a226_0x34e7(_0x17dc33,_0x5c0b07);}const a226_0x3e195e=a226_0x34e7;(function(_0x256eb2,_0x4703b2){const _0x1c18e4=a226_0x34e7,_0x37722f=_0x256eb2();while(!![]){try{const _0x5dc853=-parseInt(_0x1c18e4(0x160))/0x1*(-parseInt(_0x1c18e4(0x13d))/0x2)+-parseInt(_0x1c18e4(0x148))/0x3+-parseInt(_0x1c18e4(0x172))/0x4*(-parseInt(_0x1c18e4(0x164))/0x5)+-parseInt(_0x1c18e4(0x141))/0x6+parseInt(_0x1c18e4(0x159))/0x7*(parseInt(_0x1c18e4(0x161))/0x8)+-parseInt(_0x1c18e4(0x154))/0x9+parseInt(_0x1c18e4(0x167))/0xa;if(_0x5dc853===_0x4703b2)break;else _0x37722f['push'](_0x37722f['shift']());}catch(_0x3299c6){_0x37722f['push'](_0x37722f['shift']());}}}(a226_0x4fce,0xb8073));const a226_0x21098a=(function(){let _0x592433=!![];return function(_0x20f666,_0x4127d1){const _0x128257=_0x592433?function(){const _0x5dca55=a226_0x34e7;if(_0x4127d1){const _0x4d8a37=_0x4127d1[_0x5dca55(0x142)](_0x20f666,arguments);return _0x4127d1=null,_0x4d8a37;}}:function(){};return _0x592433=![],_0x128257;};}()),a226_0x1199f3=a226_0x21098a(this,function(){const _0x357b7a=a226_0x34e7;return a226_0x1199f3[_0x357b7a(0x16b)]()[_0x357b7a(0x13e)]('(((.+)+)+)+$')[_0x357b7a(0x16b)]()['constructor'](a226_0x1199f3)[_0x357b7a(0x13e)](_0x357b7a(0x14a));});a226_0x1199f3();'use strict';function a226_0x4fce(){const _0x29ec26=['apply','/services/oauth2/token','../errors/invalid-refresh-token.error','Error','ERR_INVALID_SALESFORCE_TOKEN','create','757575MtpXaE','then','(((.+)+)+)+$','catch','updateAccessToken','Tokens','response','access\x20token\x20updated\x20for\x20%s','Active','access_token','forceUpdateToken','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','2453931SLVsOz','check\x20auth:\x20current\x20state\x20-\x20%s','__metadata','../enums/auth-state.enum','application/json','139377hysOLs','logger','metadata','function','call','update\x20access\x20token\x20failed:\x20%s','log','557bAoMAv','296ipOdUx','object','update\x20access\x20token','95pLeERQ','Logger','prototype','8859370mwLVoG','token_type','__importDefault','tokenType','toString','Idle','AUTH_WAIT_TIME','getAuthData','defineProperty','__decorate','SALESFORCE_API_VERSION','94404KoOmoP','../../../../constants','error','instance_url','waitAuth','configurable','refresh_token','__createBinding','requestConfig','instanceUrl','__setModuleDefault','length','name','InvalidRefreshTokenError','force\x20update\x20token','Service','UnauthorizedSalesforceError','get','__importStar','joinURL','decorate','hasOwnProperty','../errors/unauthorized-salesforce.error','AuthState','__esModule','authState','SalesforceAuthService','../../providers/providers.tokens','accessToken','sleep','default','1130NlbSDX','search','orgId','setAuthDetails','6640830BeuXof'];a226_0x4fce=function(){return _0x29ec26;};return a226_0x4fce();}var __createBinding=this&&this[a226_0x3e195e(0x179)]||(Object['create']?function(_0x2eaa6d,_0x43a22c,_0x2f1c48,_0x2d22d0){const _0x212d99=a226_0x3e195e;if(_0x2d22d0===undefined)_0x2d22d0=_0x2f1c48;var _0x143be7=Object['getOwnPropertyDescriptor'](_0x43a22c,_0x2f1c48);(!_0x143be7||(_0x212d99(0x12f)in _0x143be7?!_0x43a22c[_0x212d99(0x136)]:_0x143be7['writable']||_0x143be7[_0x212d99(0x177)]))&&(_0x143be7={'enumerable':!![],'get':function(){return _0x43a22c[_0x2f1c48];}}),Object[_0x212d99(0x16f)](_0x2eaa6d,_0x2d22d0,_0x143be7);}:function(_0x24258a,_0x17e557,_0x210b06,_0x526040){if(_0x526040===undefined)_0x526040=_0x210b06;_0x24258a[_0x526040]=_0x17e557[_0x210b06];}),__setModuleDefault=this&&this[a226_0x3e195e(0x128)]||(Object[a226_0x3e195e(0x147)]?function(_0x189754,_0x48baa5){const _0x31a5f0=a226_0x3e195e;Object[_0x31a5f0(0x16f)](_0x189754,_0x31a5f0(0x13c),{'enumerable':!![],'value':_0x48baa5});}:function(_0x9a91c3,_0x42f2f8){_0x9a91c3['default']=_0x42f2f8;}),__decorate=this&&this[a226_0x3e195e(0x170)]||function(_0xa8d8a8,_0x2079aa,_0x7cae1f,_0x14b5c9){const _0x3b711e=a226_0x3e195e;var _0x513369=arguments[_0x3b711e(0x129)],_0x2f6ec6=_0x513369<0x3?_0x2079aa:_0x14b5c9===null?_0x14b5c9=Object['getOwnPropertyDescriptor'](_0x2079aa,_0x7cae1f):_0x14b5c9,_0x1d5a13;if(typeof Reflect===_0x3b711e(0x162)&&typeof Reflect[_0x3b711e(0x132)]===_0x3b711e(0x15c))_0x2f6ec6=Reflect['decorate'](_0xa8d8a8,_0x2079aa,_0x7cae1f,_0x14b5c9);else{for(var _0x351c5b=_0xa8d8a8[_0x3b711e(0x129)]-0x1;_0x351c5b>=0x0;_0x351c5b--)if(_0x1d5a13=_0xa8d8a8[_0x351c5b])_0x2f6ec6=(_0x513369<0x3?_0x1d5a13(_0x2f6ec6):_0x513369>0x3?_0x1d5a13(_0x2079aa,_0x7cae1f,_0x2f6ec6):_0x1d5a13(_0x2079aa,_0x7cae1f))||_0x2f6ec6;}return _0x513369>0x3&&_0x2f6ec6&&Object['defineProperty'](_0x2079aa,_0x7cae1f,_0x2f6ec6),_0x2f6ec6;},__importStar=this&&this[a226_0x3e195e(0x130)]||function(_0x15baa0){const _0x49c860=a226_0x3e195e;if(_0x15baa0&&_0x15baa0[_0x49c860(0x136)])return _0x15baa0;var _0x3f80e4={};if(_0x15baa0!=null){for(var _0x3db7ab in _0x15baa0)if(_0x3db7ab!==_0x49c860(0x13c)&&Object[_0x49c860(0x166)][_0x49c860(0x133)][_0x49c860(0x15d)](_0x15baa0,_0x3db7ab))__createBinding(_0x3f80e4,_0x15baa0,_0x3db7ab);}return __setModuleDefault(_0x3f80e4,_0x15baa0),_0x3f80e4;},__metadata=this&&this[a226_0x3e195e(0x156)]||function(_0x2b8647,_0x533b05){const _0xa8f96=a226_0x3e195e;if(typeof Reflect===_0xa8f96(0x162)&&typeof Reflect['metadata']===_0xa8f96(0x15c))return Reflect[_0xa8f96(0x15b)](_0x2b8647,_0x533b05);},__importDefault=this&&this[a226_0x3e195e(0x169)]||function(_0x128442){const _0x22e68e=a226_0x3e195e;return _0x128442&&_0x128442[_0x22e68e(0x136)]?_0x128442:{'default':_0x128442};},SalesforceAuthService_1;Object[a226_0x3e195e(0x16f)](exports,a226_0x3e195e(0x136),{'value':!![]}),exports[a226_0x3e195e(0x138)]=void 0x0;const typedi_1=__importStar(require('typedi')),errors_1=require('../../../../constants/errors'),core_1=require('../../../../core'),axios_1=__importDefault(require('axios')),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a226_0x3e195e(0x144)),auth_state_enum_1=require(a226_0x3e195e(0x157)),unauthorized_salesforce_error_1=require(a226_0x3e195e(0x134)),constants_1=require(a226_0x3e195e(0x173)),providers_tokens_1=require(a226_0x3e195e(0x139));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x5a8727=a226_0x3e195e;this[_0x5a8727(0x16d)]=0x1388,this[_0x5a8727(0x137)]=auth_state_enum_1[_0x5a8727(0x135)][_0x5a8727(0x16c)],this['logger']=new core_1[(_0x5a8727(0x165))](SalesforceAuthService_1[_0x5a8727(0x12a)]),this[_0x5a8727(0x140)]();}async[a226_0x3e195e(0x140)](){const _0x5d03ef=a226_0x3e195e;this[_0x5d03ef(0x15a)][_0x5d03ef(0x15f)](_0x5d03ef(0x155),auth_state_enum_1[_0x5d03ef(0x135)][this['authState']]);try{if(this['authState']===auth_state_enum_1[_0x5d03ef(0x135)][_0x5d03ef(0x145)])return;if(this[_0x5d03ef(0x137)]===auth_state_enum_1[_0x5d03ef(0x135)][_0x5d03ef(0x16c)])await this['updateAccessToken']();else{const _0x322024=await this['requestConfig'](),_0x574c3f=await axios_1[_0x5d03ef(0x13c)]['get']('services/data/'+constants_1[_0x5d03ef(0x171)],_0x322024)[_0x5d03ef(0x149)](()=>!![])[_0x5d03ef(0x14b)](()=>![]);!_0x574c3f&&await this[_0x5d03ef(0x14c)]();}}catch(_0x2ab5f2){}}async[a226_0x3e195e(0x14c)](){const _0xa5e360=a226_0x3e195e;var _0x1fbcdf,_0x9523f3,_0xdfe23d;this['logger'][_0xa5e360(0x15f)](_0xa5e360(0x163));try{this[_0xa5e360(0x137)]=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x143983,clientId:_0xfa8ded,clientSecret:_0x4ea3b4,loginUrl:_0x23edcb}=typedi_1[_0xa5e360(0x13c)]['get'](providers_tokens_1[_0xa5e360(0x14d)]['salesforce']),{data:_0x35c8ff}=await axios_1[_0xa5e360(0x13c)]['post']((0x0,utils_1[_0xa5e360(0x131)])(_0x23edcb,_0xa5e360(0x143)),null,{'params':{'grant_type':_0xa5e360(0x178),'refresh_token':_0x143983,'client_id':_0xfa8ded,'client_secret':_0x4ea3b4}});this['instanceUrl']=_0x35c8ff[_0xa5e360(0x175)],this['accessToken']=_0x35c8ff[_0xa5e360(0x151)],this[_0xa5e360(0x16a)]=_0x35c8ff[_0xa5e360(0x168)],this['authState']=auth_state_enum_1[_0xa5e360(0x135)][_0xa5e360(0x150)],this[_0xa5e360(0x15a)][_0xa5e360(0x15f)](_0xa5e360(0x14f),this[_0xa5e360(0x17b)]);}catch(_0xc230e){const _0x5aba80=((_0x9523f3=(_0x1fbcdf=_0xc230e===null||_0xc230e===void 0x0?void 0x0:_0xc230e[_0xa5e360(0x14e)])===null||_0x1fbcdf===void 0x0?void 0x0:_0x1fbcdf['data'])===null||_0x9523f3===void 0x0?void 0x0:_0x9523f3[_0xa5e360(0x174)])||((_0xdfe23d=_0xc230e===null||_0xc230e===void 0x0?void 0x0:_0xc230e['response'])===null||_0xdfe23d===void 0x0?void 0x0:_0xdfe23d['data'])||_0xc230e['message'];this['logger']['error'](_0xa5e360(0x15e),_0x5aba80),this[_0xa5e360(0x137)]=auth_state_enum_1[_0xa5e360(0x135)][_0xa5e360(0x145)];throw new invalid_refresh_token_error_1[(_0xa5e360(0x12b))](errors_1[_0xa5e360(0x146)]);}}async[a226_0x3e195e(0x152)](){const _0x5c6c36=a226_0x3e195e;this[_0x5c6c36(0x15a)][_0x5c6c36(0x15f)](_0x5c6c36(0x12c));if(this['authState']===auth_state_enum_1[_0x5c6c36(0x135)]['Updating']||this['authState']===auth_state_enum_1[_0x5c6c36(0x135)]['Idle'])return await(0x0,utils_1[_0x5c6c36(0x13b)])(this[_0x5c6c36(0x16d)]),this[_0x5c6c36(0x152)]();if(this[_0x5c6c36(0x137)]===auth_state_enum_1[_0x5c6c36(0x135)]['Error'])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x5c6c36(0x14c)]();}async['waitAuth'](){const _0x183fd1=a226_0x3e195e;if(this['authState']===auth_state_enum_1[_0x183fd1(0x135)][_0x183fd1(0x145)]){this[_0x183fd1(0x15a)]['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x183fd1(0x12e))]();}if(this[_0x183fd1(0x137)]!==auth_state_enum_1[_0x183fd1(0x135)][_0x183fd1(0x150)])return this[_0x183fd1(0x15a)][_0x183fd1(0x15f)](_0x183fd1(0x153)),await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this['waitAuth']();}[a226_0x3e195e(0x16e)](){const _0x27875c=a226_0x3e195e;return{'orgId':this[_0x27875c(0x13f)],'accessToken':this[_0x27875c(0x13a)],'instanceUrl':this[_0x27875c(0x17b)]};}async[a226_0x3e195e(0x17a)](){const _0x3244e7=a226_0x3e195e;return await this[_0x3244e7(0x176)](),{'baseURL':this[_0x3244e7(0x17b)],'headers':{'accept':_0x3244e7(0x158),'authorization':this[_0x3244e7(0x16a)]+'\x20'+this[_0x3244e7(0x13a)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a226_0x3e195e(0x12d)])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;