const a259_0x257195=a259_0xfbdd;(function(_0x1c4fb0,_0x1249bb){const _0xfa5a8c=a259_0xfbdd,_0x3b8bf5=_0x1c4fb0();while(!![]){try{const _0x459c4d=-parseInt(_0xfa5a8c(0x1aa))/0x1+parseInt(_0xfa5a8c(0x182))/0x2*(-parseInt(_0xfa5a8c(0x179))/0x3)+-parseInt(_0xfa5a8c(0x1bb))/0x4*(-parseInt(_0xfa5a8c(0x189))/0x5)+parseInt(_0xfa5a8c(0x194))/0x6*(-parseInt(_0xfa5a8c(0x1a0))/0x7)+parseInt(_0xfa5a8c(0x195))/0x8*(-parseInt(_0xfa5a8c(0x19e))/0x9)+-parseInt(_0xfa5a8c(0x17f))/0xa*(-parseInt(_0xfa5a8c(0x1a7))/0xb)+parseInt(_0xfa5a8c(0x1b9))/0xc*(parseInt(_0xfa5a8c(0x184))/0xd);if(_0x459c4d===_0x1249bb)break;else _0x3b8bf5['push'](_0x3b8bf5['shift']());}catch(_0x29d40d){_0x3b8bf5['push'](_0x3b8bf5['shift']());}}}(a259_0xe8d7,0x8733a));const a259_0x498723=(function(){let _0x43e0ce=!![];return function(_0x242083,_0x54a103){const _0x3d0b53=_0x43e0ce?function(){if(_0x54a103){const _0x260f2b=_0x54a103['apply'](_0x242083,arguments);return _0x54a103=null,_0x260f2b;}}:function(){};return _0x43e0ce=![],_0x3d0b53;};}()),a259_0x1f944b=a259_0x498723(this,function(){const _0x1ce47=a259_0xfbdd;return a259_0x1f944b['toString']()[_0x1ce47(0x1c4)](_0x1ce47(0x196))[_0x1ce47(0x19c)]()['constructor'](a259_0x1f944b)[_0x1ce47(0x1c4)](_0x1ce47(0x196));});a259_0x1f944b();function a259_0xe8d7(){const _0x18455b=['updateAccessToken','__decorate','Update\x20access\x20token','data','564rZRkMd','error','1967032xXfPIN','hasOwnProperty','ERR_INVALID_SALESFORCE_TOKEN','headers','metadata','message','default','instance_url','forceUpdateToken','search','function','SalesforceUtils','AUTH_WAIT_TIME','requestConfig','then','../../providers/providers.tokens','__setModuleDefault','Update\x20access\x20token\x20failed:\x20%s','../../../../core','log','typedi','isBulk1Url','catch','</met:sessionId>','accessToken','salesforce','../../../../constants/errors','replace','object','authState','services/data/','@flosum/salesforce','3ydNYSu','Tokens','setAuthDetails','authorization','../errors/invalid-refresh-token.error','waitAuth','170FLPvHa','get','configurable','1703014tgbHIf','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','707759mtbMtV','getOwnPropertyDescriptor','design:paramtypes','decorate','Force\x20update\x20token','5oWIPkZ','Error','Updating','response','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','call','defineProperty','UnauthorizedSalesforceError','writable','<met:sessionId>','../errors/unauthorized-salesforce.error','12372vXvRWw','4723816jRxlcz','(((.+)+)+)+$','joinURL','token_type','instanceUrl','Active','/services/oauth2/token','toString','Access\x20token\x20updated\x20for\x20%s','9ynlazb','X-SFDC-Session','714rOVBoe','length','application/json','create','../enums/auth-state.enum','orgId','../../../../constants','119537NigmSq','tokenType','Logger','1029224PGxKIo','Check\x20auth:\x20current\x20state\x20-\x20%s','name','__esModule','Idle','__metadata','isSoapUrl','__createBinding','AuthState','axios','logger'];a259_0xe8d7=function(){return _0x18455b;};return a259_0xe8d7();}'use strict';function a259_0xfbdd(_0x28e23e,_0x478f1d){const _0x359102=a259_0xe8d7();return a259_0xfbdd=function(_0x1f944b,_0x498723){_0x1f944b=_0x1f944b-0x166;let _0xe8d77d=_0x359102[_0x1f944b];return _0xe8d77d;},a259_0xfbdd(_0x28e23e,_0x478f1d);}var __createBinding=this&&this[a259_0x257195(0x1b1)]||(Object[a259_0x257195(0x1a3)]?function(_0x17d31b,_0x25dc65,_0x47a236,_0x2e9c62){const _0x3f7290=a259_0x257195;if(_0x2e9c62===undefined)_0x2e9c62=_0x47a236;var _0x2d9726=Object[_0x3f7290(0x185)](_0x25dc65,_0x47a236);(!_0x2d9726||(_0x3f7290(0x180)in _0x2d9726?!_0x25dc65[_0x3f7290(0x1ad)]:_0x2d9726[_0x3f7290(0x191)]||_0x2d9726[_0x3f7290(0x181)]))&&(_0x2d9726={'enumerable':!![],'get':function(){return _0x25dc65[_0x47a236];}}),Object[_0x3f7290(0x18f)](_0x17d31b,_0x2e9c62,_0x2d9726);}:function(_0x82d9bb,_0x56a43d,_0x1c14a0,_0x1347b3){if(_0x1347b3===undefined)_0x1347b3=_0x1c14a0;_0x82d9bb[_0x1347b3]=_0x56a43d[_0x1c14a0];}),__setModuleDefault=this&&this[a259_0x257195(0x169)]||(Object['create']?function(_0x54c8eb,_0x12d95b){const _0x152799=a259_0x257195;Object[_0x152799(0x18f)](_0x54c8eb,_0x152799(0x1c1),{'enumerable':!![],'value':_0x12d95b});}:function(_0x1cfed9,_0x4a5024){const _0xdb94c0=a259_0x257195;_0x1cfed9[_0xdb94c0(0x1c1)]=_0x4a5024;}),__decorate=this&&this[a259_0x257195(0x1b6)]||function(_0x3b95f7,_0xc6f4bf,_0x1f6387,_0x31781c){const _0x5b4a38=a259_0x257195;var _0x56836f=arguments[_0x5b4a38(0x1a1)],_0xc9ceee=_0x56836f<0x3?_0xc6f4bf:_0x31781c===null?_0x31781c=Object['getOwnPropertyDescriptor'](_0xc6f4bf,_0x1f6387):_0x31781c,_0x3856e5;if(typeof Reflect===_0x5b4a38(0x175)&&typeof Reflect[_0x5b4a38(0x187)]===_0x5b4a38(0x1c5))_0xc9ceee=Reflect[_0x5b4a38(0x187)](_0x3b95f7,_0xc6f4bf,_0x1f6387,_0x31781c);else{for(var _0xf6815a=_0x3b95f7['length']-0x1;_0xf6815a>=0x0;_0xf6815a--)if(_0x3856e5=_0x3b95f7[_0xf6815a])_0xc9ceee=(_0x56836f<0x3?_0x3856e5(_0xc9ceee):_0x56836f>0x3?_0x3856e5(_0xc6f4bf,_0x1f6387,_0xc9ceee):_0x3856e5(_0xc6f4bf,_0x1f6387))||_0xc9ceee;}return _0x56836f>0x3&&_0xc9ceee&&Object[_0x5b4a38(0x18f)](_0xc6f4bf,_0x1f6387,_0xc9ceee),_0xc9ceee;},__importStar=this&&this['__importStar']||function(_0x268d43){const _0xaeabde=a259_0x257195;if(_0x268d43&&_0x268d43[_0xaeabde(0x1ad)])return _0x268d43;var _0x329edf={};if(_0x268d43!=null){for(var _0x964d88 in _0x268d43)if(_0x964d88!==_0xaeabde(0x1c1)&&Object['prototype'][_0xaeabde(0x1bc)][_0xaeabde(0x18e)](_0x268d43,_0x964d88))__createBinding(_0x329edf,_0x268d43,_0x964d88);}return __setModuleDefault(_0x329edf,_0x268d43),_0x329edf;},__metadata=this&&this[a259_0x257195(0x1af)]||function(_0x404874,_0x2f1a12){const _0x29443a=a259_0x257195;if(typeof Reflect===_0x29443a(0x175)&&typeof Reflect[_0x29443a(0x1bf)]===_0x29443a(0x1c5))return Reflect[_0x29443a(0x1bf)](_0x404874,_0x2f1a12);},__importDefault=this&&this['__importDefault']||function(_0x5c29ec){const _0x58e489=a259_0x257195;return _0x5c29ec&&_0x5c29ec[_0x58e489(0x1ad)]?_0x5c29ec:{'default':_0x5c29ec};},SalesforceAuthService_1;Object[a259_0x257195(0x18f)](exports,a259_0x257195(0x1ad),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a259_0x257195(0x16d))),errors_1=require(a259_0x257195(0x173)),core_1=require(a259_0x257195(0x16b)),axios_1=__importDefault(require(a259_0x257195(0x1b3))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a259_0x257195(0x17d)),auth_state_enum_1=require(a259_0x257195(0x1a4)),unauthorized_salesforce_error_1=require(a259_0x257195(0x193)),constants_1=require(a259_0x257195(0x1a6)),providers_tokens_1=require(a259_0x257195(0x168)),salesforce_1=require(a259_0x257195(0x178));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x4d2b7b=a259_0x257195;this[_0x4d2b7b(0x1c7)]=0x1388,this['authState']=auth_state_enum_1[_0x4d2b7b(0x1b2)]['Idle'],this[_0x4d2b7b(0x1b4)]=new core_1[(_0x4d2b7b(0x1a9))](SalesforceAuthService_1[_0x4d2b7b(0x1ac)]),this[_0x4d2b7b(0x17b)]();}async[a259_0x257195(0x17b)](){const _0x5a23aa=a259_0x257195;this[_0x5a23aa(0x1b4)][_0x5a23aa(0x16c)](_0x5a23aa(0x1ab),auth_state_enum_1[_0x5a23aa(0x1b2)][this[_0x5a23aa(0x176)]]);try{if(this[_0x5a23aa(0x176)]===auth_state_enum_1[_0x5a23aa(0x1b2)][_0x5a23aa(0x18a)])return;if(this['authState']===auth_state_enum_1[_0x5a23aa(0x1b2)][_0x5a23aa(0x1ae)])await this[_0x5a23aa(0x1b5)]();else{const _0x54244c=await this[_0x5a23aa(0x166)](),_0xb37442=await axios_1[_0x5a23aa(0x1c1)][_0x5a23aa(0x180)](_0x5a23aa(0x177)+constants_1['SALESFORCE_API_VERSION'],_0x54244c)[_0x5a23aa(0x167)](()=>!![])[_0x5a23aa(0x16f)](()=>![]);!_0xb37442&&await this[_0x5a23aa(0x1b5)]();}}catch(_0x297bd7){}}async['updateAccessToken'](){const _0x2cbaca=a259_0x257195;var _0x399578,_0x4907aa,_0x1ea9eb;this['logger'][_0x2cbaca(0x16c)](_0x2cbaca(0x1b7));try{this[_0x2cbaca(0x176)]=auth_state_enum_1[_0x2cbaca(0x1b2)]['Updating'];const {refreshToken:_0x12418f,clientId:_0x3b6427,clientSecret:_0x5e4092,loginUrl:_0x9d430f}=typedi_1[_0x2cbaca(0x1c1)][_0x2cbaca(0x180)](providers_tokens_1[_0x2cbaca(0x17a)][_0x2cbaca(0x172)]),{data:_0x522e84}=await axios_1['default']['post']((0x0,utils_1[_0x2cbaca(0x197)])(_0x9d430f,_0x2cbaca(0x19b)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x12418f,'client_id':_0x3b6427,'client_secret':_0x5e4092}});this[_0x2cbaca(0x199)]=_0x522e84[_0x2cbaca(0x1c2)],this[_0x2cbaca(0x171)]=_0x522e84['access_token'],this[_0x2cbaca(0x1a8)]=_0x522e84[_0x2cbaca(0x198)],this['authState']=auth_state_enum_1[_0x2cbaca(0x1b2)][_0x2cbaca(0x19a)],this[_0x2cbaca(0x1b4)][_0x2cbaca(0x16c)](_0x2cbaca(0x19d),this[_0x2cbaca(0x199)]);}catch(_0x5ccb68){const _0x1ae3ab=((_0x4907aa=(_0x399578=_0x5ccb68===null||_0x5ccb68===void 0x0?void 0x0:_0x5ccb68[_0x2cbaca(0x18c)])===null||_0x399578===void 0x0?void 0x0:_0x399578[_0x2cbaca(0x1b8)])===null||_0x4907aa===void 0x0?void 0x0:_0x4907aa[_0x2cbaca(0x1ba)])||((_0x1ea9eb=_0x5ccb68===null||_0x5ccb68===void 0x0?void 0x0:_0x5ccb68['response'])===null||_0x1ea9eb===void 0x0?void 0x0:_0x1ea9eb[_0x2cbaca(0x1b8)])||_0x5ccb68[_0x2cbaca(0x1c0)];this[_0x2cbaca(0x1b4)][_0x2cbaca(0x1ba)](_0x2cbaca(0x16a),_0x1ae3ab),this[_0x2cbaca(0x176)]=auth_state_enum_1['AuthState'][_0x2cbaca(0x18a)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a259_0x257195(0x1c3)](){const _0x1dcd9b=a259_0x257195;this[_0x1dcd9b(0x1b4)][_0x1dcd9b(0x16c)](_0x1dcd9b(0x188));if(this[_0x1dcd9b(0x176)]===auth_state_enum_1[_0x1dcd9b(0x1b2)][_0x1dcd9b(0x18b)]||this[_0x1dcd9b(0x176)]===auth_state_enum_1['AuthState'][_0x1dcd9b(0x1ae)])return await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this[_0x1dcd9b(0x1c3)]();if(this[_0x1dcd9b(0x176)]===auth_state_enum_1[_0x1dcd9b(0x1b2)][_0x1dcd9b(0x18a)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x1dcd9b(0x1bd)]);await this[_0x1dcd9b(0x1b5)]();}async[a259_0x257195(0x17e)](){const _0x3e3ba7=a259_0x257195;if(this['authState']===auth_state_enum_1[_0x3e3ba7(0x1b2)][_0x3e3ba7(0x18a)]){this[_0x3e3ba7(0x1b4)][_0x3e3ba7(0x16c)](_0x3e3ba7(0x183));throw new unauthorized_salesforce_error_1[(_0x3e3ba7(0x190))]();}if(this['authState']!==auth_state_enum_1[_0x3e3ba7(0x1b2)][_0x3e3ba7(0x19a)])return this[_0x3e3ba7(0x1b4)][_0x3e3ba7(0x16c)](_0x3e3ba7(0x18d)),await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this['waitAuth']();}['getAuthData'](){const _0x5d1cd6=a259_0x257195;return{'orgId':this[_0x5d1cd6(0x1a5)],'accessToken':this[_0x5d1cd6(0x171)],'instanceUrl':this[_0x5d1cd6(0x199)]};}async[a259_0x257195(0x166)](_0xe196cc=''){const _0x5366d6=a259_0x257195;await this['waitAuth']();const _0x1ae0b1={'baseURL':this[_0x5366d6(0x199)],'headers':{'accept':_0x5366d6(0x1a2)}};if(salesforce_1[_0x5366d6(0x1c6)][_0x5366d6(0x16e)](_0xe196cc))_0x1ae0b1[_0x5366d6(0x1be)][_0x5366d6(0x19f)]=this[_0x5366d6(0x171)];else salesforce_1[_0x5366d6(0x1c6)][_0x5366d6(0x1b0)](_0xe196cc)?_0x1ae0b1[_0x5366d6(0x1b8)]=_0x1ae0b1['data'][_0x5366d6(0x174)](/<met:sessionId>.+?<\/met:sessionId>/,_0x5366d6(0x192)+this['accessToken']+_0x5366d6(0x170)):_0x1ae0b1[_0x5366d6(0x1be)][_0x5366d6(0x17c)]=this[_0x5366d6(0x1a8)]+'\x20'+this[_0x5366d6(0x171)];return _0x1ae0b1;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a259_0x257195(0x186),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;