const a227_0xcfbea1=a227_0x334b;function a227_0x5c1a(){const _0x2eaa34=['hasOwnProperty','requestConfig','../../providers/providers.tokens','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','4538702YKcdGd','metadata','response','toString','__setModuleDefault','forceUpdateToken','Updating','application/json','4lEXNXi','length','token_type','call','writable','1937240uvWBNv','prototype','/services/oauth2/token','updateAccessToken','authState','getOwnPropertyDescriptor','decorate','../errors/invalid-refresh-token.error','joinURL','3188340QafrkZ','UnauthorizedSalesforceError','get','__createBinding','1625408zTEGyw','axios','logger','__importDefault','then','waitAuth','setAuthDetails','typedi','orgId','InvalidRefreshTokenError','tokenType','update\x20access\x20token','__esModule','default','configurable','catch','salesforce','accessToken','SalesforceAuthService','__metadata','ERR_INVALID_SALESFORCE_TOKEN','search','design:paramtypes','log','name','message','getAuthData','44298DNWJCg','../../../../core','569007UwpSnY','Error','(((.+)+)+)+$','force\x20update\x20token','Idle','function','instanceUrl','__decorate','create','data','refresh_token','SALESFORCE_API_VERSION','services/data/','object','access_token','error','Tokens','AUTH_WAIT_TIME','1013450CRMzIn','defineProperty','apply','update\x20access\x20token\x20failed:\x20%s','AuthState'];a227_0x5c1a=function(){return _0x2eaa34;};return a227_0x5c1a();}(function(_0x2712af,_0xb14c59){const _0x4a4c02=a227_0x334b,_0x323c19=_0x2712af();while(!![]){try{const _0x5bf104=parseInt(_0x4a4c02(0x1e1))/0x1+-parseInt(_0x4a4c02(0x1fc))/0x2+-parseInt(_0x4a4c02(0x1fe))/0x3+-parseInt(_0x4a4c02(0x221))/0x4*(parseInt(_0x4a4c02(0x210))/0x5)+parseInt(_0x4a4c02(0x1dd))/0x6+-parseInt(_0x4a4c02(0x219))/0x7+-parseInt(_0x4a4c02(0x226))/0x8;if(_0x5bf104===_0xb14c59)break;else _0x323c19['push'](_0x323c19['shift']());}catch(_0x365b2c){_0x323c19['push'](_0x323c19['shift']());}}}(a227_0x5c1a,0xcff25));const a227_0x4812bc=(function(){let _0x52a71f=!![];return function(_0x18727f,_0x524890){const _0x395c7c=_0x52a71f?function(){const _0x4ffa83=a227_0x334b;if(_0x524890){const _0x10de8c=_0x524890[_0x4ffa83(0x212)](_0x18727f,arguments);return _0x524890=null,_0x10de8c;}}:function(){};return _0x52a71f=![],_0x395c7c;};}()),a227_0x4b1c38=a227_0x4812bc(this,function(){const _0x176586=a227_0x334b;return a227_0x4b1c38[_0x176586(0x21c)]()[_0x176586(0x1f6)](_0x176586(0x200))[_0x176586(0x21c)]()['constructor'](a227_0x4b1c38)[_0x176586(0x1f6)](_0x176586(0x200));});a227_0x4b1c38();'use strict';var __createBinding=this&&this[a227_0xcfbea1(0x1e0)]||(Object[a227_0xcfbea1(0x206)]?function(_0x1e2596,_0x65ca57,_0x27169b,_0x3c38e0){const _0x1dfee0=a227_0xcfbea1;if(_0x3c38e0===undefined)_0x3c38e0=_0x27169b;var _0x4a390c=Object[_0x1dfee0(0x1d9)](_0x65ca57,_0x27169b);(!_0x4a390c||(_0x1dfee0(0x1df)in _0x4a390c?!_0x65ca57[_0x1dfee0(0x1ed)]:_0x4a390c[_0x1dfee0(0x225)]||_0x4a390c[_0x1dfee0(0x1ef)]))&&(_0x4a390c={'enumerable':!![],'get':function(){return _0x65ca57[_0x27169b];}}),Object[_0x1dfee0(0x211)](_0x1e2596,_0x3c38e0,_0x4a390c);}:function(_0x121862,_0x595ad3,_0x3b898a,_0x5f3876){if(_0x5f3876===undefined)_0x5f3876=_0x3b898a;_0x121862[_0x5f3876]=_0x595ad3[_0x3b898a];}),__setModuleDefault=this&&this[a227_0xcfbea1(0x21d)]||(Object[a227_0xcfbea1(0x206)]?function(_0x3d1a38,_0x3d51c9){const _0x3d65e4=a227_0xcfbea1;Object[_0x3d65e4(0x211)](_0x3d1a38,'default',{'enumerable':!![],'value':_0x3d51c9});}:function(_0x58f944,_0x110f3c){const _0x1995e3=a227_0xcfbea1;_0x58f944[_0x1995e3(0x1ee)]=_0x110f3c;}),__decorate=this&&this[a227_0xcfbea1(0x205)]||function(_0x487555,_0x262b1a,_0x1e5860,_0x3b3975){const _0x18d400=a227_0xcfbea1;var _0x103447=arguments[_0x18d400(0x222)],_0x4170ab=_0x103447<0x3?_0x262b1a:_0x3b3975===null?_0x3b3975=Object['getOwnPropertyDescriptor'](_0x262b1a,_0x1e5860):_0x3b3975,_0x4842d8;if(typeof Reflect===_0x18d400(0x20b)&&typeof Reflect[_0x18d400(0x1da)]===_0x18d400(0x203))_0x4170ab=Reflect[_0x18d400(0x1da)](_0x487555,_0x262b1a,_0x1e5860,_0x3b3975);else{for(var _0x27c0c2=_0x487555[_0x18d400(0x222)]-0x1;_0x27c0c2>=0x0;_0x27c0c2--)if(_0x4842d8=_0x487555[_0x27c0c2])_0x4170ab=(_0x103447<0x3?_0x4842d8(_0x4170ab):_0x103447>0x3?_0x4842d8(_0x262b1a,_0x1e5860,_0x4170ab):_0x4842d8(_0x262b1a,_0x1e5860))||_0x4170ab;}return _0x103447>0x3&&_0x4170ab&&Object[_0x18d400(0x211)](_0x262b1a,_0x1e5860,_0x4170ab),_0x4170ab;},__importStar=this&&this['__importStar']||function(_0x56f241){const _0x4f421a=a227_0xcfbea1;if(_0x56f241&&_0x56f241[_0x4f421a(0x1ed)])return _0x56f241;var _0x15c642={};if(_0x56f241!=null){for(var _0x1e536e in _0x56f241)if(_0x1e536e!==_0x4f421a(0x1ee)&&Object[_0x4f421a(0x227)][_0x4f421a(0x215)][_0x4f421a(0x224)](_0x56f241,_0x1e536e))__createBinding(_0x15c642,_0x56f241,_0x1e536e);}return __setModuleDefault(_0x15c642,_0x56f241),_0x15c642;},__metadata=this&&this[a227_0xcfbea1(0x1f4)]||function(_0x230905,_0x687798){const _0x199fd7=a227_0xcfbea1;if(typeof Reflect===_0x199fd7(0x20b)&&typeof Reflect[_0x199fd7(0x21a)]===_0x199fd7(0x203))return Reflect[_0x199fd7(0x21a)](_0x230905,_0x687798);},__importDefault=this&&this[a227_0xcfbea1(0x1e4)]||function(_0x1f43fb){const _0x4966e0=a227_0xcfbea1;return _0x1f43fb&&_0x1f43fb[_0x4966e0(0x1ed)]?_0x1f43fb:{'default':_0x1f43fb};},SalesforceAuthService_1;Object['defineProperty'](exports,a227_0xcfbea1(0x1ed),{'value':!![]}),exports[a227_0xcfbea1(0x1f3)]=void 0x0;const typedi_1=__importStar(require(a227_0xcfbea1(0x1e8))),errors_1=require('../../../../constants/errors'),core_1=require(a227_0xcfbea1(0x1fd)),axios_1=__importDefault(require(a227_0xcfbea1(0x1e2))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a227_0xcfbea1(0x1db)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require('../../../../constants'),providers_tokens_1=require(a227_0xcfbea1(0x217));function a227_0x334b(_0x5aaefa,_0x5a25f1){const _0x1d2513=a227_0x5c1a();return a227_0x334b=function(_0x4b1c38,_0x4812bc){_0x4b1c38=_0x4b1c38-0x1d9;let _0x5c1ab9=_0x1d2513[_0x4b1c38];return _0x5c1ab9;},a227_0x334b(_0x5aaefa,_0x5a25f1);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x451095=a227_0xcfbea1;this[_0x451095(0x20f)]=0x1388,this['authState']=auth_state_enum_1[_0x451095(0x214)][_0x451095(0x202)],this[_0x451095(0x1e3)]=new core_1['Logger'](SalesforceAuthService_1[_0x451095(0x1f9)]),this[_0x451095(0x1e7)]();}async[a227_0xcfbea1(0x1e7)](){const _0x4ac471=a227_0xcfbea1;this['logger'][_0x4ac471(0x1f8)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x4ac471(0x214)][this[_0x4ac471(0x22a)]]);try{if(this[_0x4ac471(0x22a)]===auth_state_enum_1['AuthState'][_0x4ac471(0x1ff)])return;if(this[_0x4ac471(0x22a)]===auth_state_enum_1[_0x4ac471(0x214)][_0x4ac471(0x202)])await this[_0x4ac471(0x229)]();else{const _0x51d970=await this[_0x4ac471(0x216)](),_0x1b5058=await axios_1[_0x4ac471(0x1ee)][_0x4ac471(0x1df)](_0x4ac471(0x20a)+constants_1[_0x4ac471(0x209)],_0x51d970)[_0x4ac471(0x1e5)](()=>!![])[_0x4ac471(0x1f0)](()=>![]);!_0x1b5058&&await this[_0x4ac471(0x229)]();}}catch(_0x227538){}}async[a227_0xcfbea1(0x229)](){const _0x1b7d97=a227_0xcfbea1;var _0xd8ec6a,_0x11be71,_0x12cbc1;this['logger'][_0x1b7d97(0x1f8)](_0x1b7d97(0x1ec));try{this[_0x1b7d97(0x22a)]=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x31317d,clientId:_0x3999a5,clientSecret:_0xae2d68,loginUrl:_0x11ad34}=typedi_1[_0x1b7d97(0x1ee)][_0x1b7d97(0x1df)](providers_tokens_1[_0x1b7d97(0x20e)][_0x1b7d97(0x1f1)]),{data:_0x4b0e9e}=await axios_1[_0x1b7d97(0x1ee)]['post']((0x0,utils_1[_0x1b7d97(0x1dc)])(_0x11ad34,_0x1b7d97(0x228)),null,{'params':{'grant_type':_0x1b7d97(0x208),'refresh_token':_0x31317d,'client_id':_0x3999a5,'client_secret':_0xae2d68}});this['instanceUrl']=_0x4b0e9e['instance_url'],this[_0x1b7d97(0x1f2)]=_0x4b0e9e[_0x1b7d97(0x20c)],this[_0x1b7d97(0x1eb)]=_0x4b0e9e[_0x1b7d97(0x223)],this[_0x1b7d97(0x22a)]=auth_state_enum_1[_0x1b7d97(0x214)]['Active'],this[_0x1b7d97(0x1e3)][_0x1b7d97(0x1f8)]('access\x20token\x20updated\x20for\x20%s',this['instanceUrl']);}catch(_0x58fac1){const _0x49523f=((_0x11be71=(_0xd8ec6a=_0x58fac1===null||_0x58fac1===void 0x0?void 0x0:_0x58fac1['response'])===null||_0xd8ec6a===void 0x0?void 0x0:_0xd8ec6a[_0x1b7d97(0x207)])===null||_0x11be71===void 0x0?void 0x0:_0x11be71[_0x1b7d97(0x20d)])||((_0x12cbc1=_0x58fac1===null||_0x58fac1===void 0x0?void 0x0:_0x58fac1[_0x1b7d97(0x21b)])===null||_0x12cbc1===void 0x0?void 0x0:_0x12cbc1[_0x1b7d97(0x207)])||_0x58fac1[_0x1b7d97(0x1fa)];this[_0x1b7d97(0x1e3)][_0x1b7d97(0x20d)](_0x1b7d97(0x213),_0x49523f),this['authState']=auth_state_enum_1[_0x1b7d97(0x214)][_0x1b7d97(0x1ff)];throw new invalid_refresh_token_error_1[(_0x1b7d97(0x1ea))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x38da69=a227_0xcfbea1;this[_0x38da69(0x1e3)][_0x38da69(0x1f8)](_0x38da69(0x201));if(this[_0x38da69(0x22a)]===auth_state_enum_1['AuthState'][_0x38da69(0x21f)]||this[_0x38da69(0x22a)]===auth_state_enum_1[_0x38da69(0x214)][_0x38da69(0x202)])return await(0x0,utils_1['sleep'])(this[_0x38da69(0x20f)]),this[_0x38da69(0x21e)]();if(this[_0x38da69(0x22a)]===auth_state_enum_1['AuthState'][_0x38da69(0x1ff)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x38da69(0x1f5)]);await this[_0x38da69(0x229)]();}async['waitAuth'](){const _0x5a1ef6=a227_0xcfbea1;if(this['authState']===auth_state_enum_1[_0x5a1ef6(0x214)]['Error']){this[_0x5a1ef6(0x1e3)][_0x5a1ef6(0x1f8)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x5a1ef6(0x1de))]();}if(this[_0x5a1ef6(0x22a)]!==auth_state_enum_1[_0x5a1ef6(0x214)]['Active'])return this[_0x5a1ef6(0x1e3)][_0x5a1ef6(0x1f8)](_0x5a1ef6(0x218)),await(0x0,utils_1['sleep'])(this[_0x5a1ef6(0x20f)]),this['waitAuth']();}[a227_0xcfbea1(0x1fb)](){const _0x6b52d9=a227_0xcfbea1;return{'orgId':this[_0x6b52d9(0x1e9)],'accessToken':this[_0x6b52d9(0x1f2)],'instanceUrl':this[_0x6b52d9(0x204)]};}async[a227_0xcfbea1(0x216)](){const _0x4c095b=a227_0xcfbea1;return await this[_0x4c095b(0x1e6)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x4c095b(0x220),'authorization':this[_0x4c095b(0x1eb)]+'\x20'+this[_0x4c095b(0x1f2)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a227_0xcfbea1(0x1f7),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;