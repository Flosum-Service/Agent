const a269_0x26b987=a269_0x5300;function a269_0x5300(_0x5489a6,_0x29c1aa){const _0x153057=a269_0x3f3c();return a269_0x5300=function(_0x2521af,_0xd55dff){_0x2521af=_0x2521af-0x171;let _0x3f3cbe=_0x153057[_0x2521af];return _0x3f3cbe;},a269_0x5300(_0x5489a6,_0x29c1aa);}(function(_0x4a459a,_0xd788){const _0x2f25b2=a269_0x5300,_0x783d45=_0x4a459a();while(!![]){try{const _0x185fcd=parseInt(_0x2f25b2(0x191))/0x1*(parseInt(_0x2f25b2(0x1a7))/0x2)+-parseInt(_0x2f25b2(0x19f))/0x3+parseInt(_0x2f25b2(0x192))/0x4+-parseInt(_0x2f25b2(0x1ca))/0x5+parseInt(_0x2f25b2(0x176))/0x6*(-parseInt(_0x2f25b2(0x1ae))/0x7)+-parseInt(_0x2f25b2(0x18c))/0x8+parseInt(_0x2f25b2(0x178))/0x9*(parseInt(_0x2f25b2(0x173))/0xa);if(_0x185fcd===_0xd788)break;else _0x783d45['push'](_0x783d45['shift']());}catch(_0xd494c7){_0x783d45['push'](_0x783d45['shift']());}}}(a269_0x3f3c,0xb14d7));const a269_0xd55dff=(function(){let _0xfc913=!![];return function(_0x45918e,_0x1acb5c){const _0x32a76c=_0xfc913?function(){const _0x3f6060=a269_0x5300;if(_0x1acb5c){const _0x5ef554=_0x1acb5c[_0x3f6060(0x19a)](_0x45918e,arguments);return _0x1acb5c=null,_0x5ef554;}}:function(){};return _0xfc913=![],_0x32a76c;};}()),a269_0x2521af=a269_0xd55dff(this,function(){const _0x20a05b=a269_0x5300;return a269_0x2521af[_0x20a05b(0x1c4)]()['search'](_0x20a05b(0x175))[_0x20a05b(0x1c4)]()[_0x20a05b(0x1b4)](a269_0x2521af)[_0x20a05b(0x190)](_0x20a05b(0x175));});a269_0x2521af();'use strict';var __createBinding=this&&this[a269_0x26b987(0x1b1)]||(Object[a269_0x26b987(0x1bb)]?function(_0x4810f4,_0x53a724,_0x26b536,_0x29cfc7){const _0x1f0253=a269_0x26b987;if(_0x29cfc7===undefined)_0x29cfc7=_0x26b536;var _0x4522e5=Object[_0x1f0253(0x1d2)](_0x53a724,_0x26b536);(!_0x4522e5||(_0x1f0253(0x195)in _0x4522e5?!_0x53a724[_0x1f0253(0x1bd)]:_0x4522e5[_0x1f0253(0x1ac)]||_0x4522e5[_0x1f0253(0x1af)]))&&(_0x4522e5={'enumerable':!![],'get':function(){return _0x53a724[_0x26b536];}}),Object[_0x1f0253(0x17d)](_0x4810f4,_0x29cfc7,_0x4522e5);}:function(_0x1a502d,_0x1b2f16,_0x3b6471,_0xf66443){if(_0xf66443===undefined)_0xf66443=_0x3b6471;_0x1a502d[_0xf66443]=_0x1b2f16[_0x3b6471];}),__setModuleDefault=this&&this[a269_0x26b987(0x19d)]||(Object[a269_0x26b987(0x1bb)]?function(_0x4374c0,_0x59b5a8){const _0x423c51=a269_0x26b987;Object[_0x423c51(0x17d)](_0x4374c0,_0x423c51(0x1d4),{'enumerable':!![],'value':_0x59b5a8});}:function(_0x41602b,_0x5616d0){const _0x102b7b=a269_0x26b987;_0x41602b[_0x102b7b(0x1d4)]=_0x5616d0;}),__decorate=this&&this[a269_0x26b987(0x19b)]||function(_0x29ee3e,_0x3dbb5f,_0x4770ec,_0x2288eb){const _0x763627=a269_0x26b987;var _0x2f7e99=arguments['length'],_0x45ce9f=_0x2f7e99<0x3?_0x3dbb5f:_0x2288eb===null?_0x2288eb=Object[_0x763627(0x1d2)](_0x3dbb5f,_0x4770ec):_0x2288eb,_0x4c507e;if(typeof Reflect===_0x763627(0x1b9)&&typeof Reflect['decorate']===_0x763627(0x188))_0x45ce9f=Reflect[_0x763627(0x179)](_0x29ee3e,_0x3dbb5f,_0x4770ec,_0x2288eb);else{for(var _0x231111=_0x29ee3e[_0x763627(0x1cc)]-0x1;_0x231111>=0x0;_0x231111--)if(_0x4c507e=_0x29ee3e[_0x231111])_0x45ce9f=(_0x2f7e99<0x3?_0x4c507e(_0x45ce9f):_0x2f7e99>0x3?_0x4c507e(_0x3dbb5f,_0x4770ec,_0x45ce9f):_0x4c507e(_0x3dbb5f,_0x4770ec))||_0x45ce9f;}return _0x2f7e99>0x3&&_0x45ce9f&&Object[_0x763627(0x17d)](_0x3dbb5f,_0x4770ec,_0x45ce9f),_0x45ce9f;},__importStar=this&&this[a269_0x26b987(0x1bc)]||function(_0x2cf9b6){const _0x13b750=a269_0x26b987;if(_0x2cf9b6&&_0x2cf9b6[_0x13b750(0x1bd)])return _0x2cf9b6;var _0x5b6218={};if(_0x2cf9b6!=null){for(var _0x422aa6 in _0x2cf9b6)if(_0x422aa6!==_0x13b750(0x1d4)&&Object[_0x13b750(0x186)][_0x13b750(0x1cb)][_0x13b750(0x189)](_0x2cf9b6,_0x422aa6))__createBinding(_0x5b6218,_0x2cf9b6,_0x422aa6);}return __setModuleDefault(_0x5b6218,_0x2cf9b6),_0x5b6218;},__metadata=this&&this[a269_0x26b987(0x1ce)]||function(_0x23187c,_0x3b844b){const _0x37fa55=a269_0x26b987;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x37fa55(0x188))return Reflect[_0x37fa55(0x171)](_0x23187c,_0x3b844b);},__importDefault=this&&this[a269_0x26b987(0x1a5)]||function(_0x4aff9e){const _0x11e4ec=a269_0x26b987;return _0x4aff9e&&_0x4aff9e[_0x11e4ec(0x1bd)]?_0x4aff9e:{'default':_0x4aff9e};},SalesforceAuthService_1;Object[a269_0x26b987(0x17d)](exports,a269_0x26b987(0x1bd),{'value':!![]}),exports[a269_0x26b987(0x1a8)]=void 0x0;const typedi_1=__importStar(require(a269_0x26b987(0x1a1))),errors_1=require(a269_0x26b987(0x1ab)),core_1=require(a269_0x26b987(0x1aa)),axios_1=__importDefault(require('axios')),utils_1=require(a269_0x26b987(0x1c8)),invalid_refresh_token_error_1=require(a269_0x26b987(0x1d0)),auth_state_enum_1=require(a269_0x26b987(0x183)),unauthorized_salesforce_error_1=require(a269_0x26b987(0x1ad)),constants_1=require('../../../../constants'),providers_tokens_1=require(a269_0x26b987(0x198)),salesforce_1=require(a269_0x26b987(0x19c));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x11f676=a269_0x26b987;this['AUTH_WAIT_TIME']=0x1388,this['authState']=auth_state_enum_1[_0x11f676(0x19e)]['Idle'],this[_0x11f676(0x1b2)]=new core_1[(_0x11f676(0x194))](SalesforceAuthService_1[_0x11f676(0x199)]),this[_0x11f676(0x1c0)]();}async[a269_0x26b987(0x1c0)](){const _0x503fa9=a269_0x26b987;this['logger'][_0x503fa9(0x1a3)]('Check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x503fa9(0x19e)][this[_0x503fa9(0x1c1)]]);try{if(this['authState']===auth_state_enum_1['AuthState']['Error'])return;if(this[_0x503fa9(0x1c1)]===auth_state_enum_1[_0x503fa9(0x19e)]['Idle'])await this[_0x503fa9(0x1c6)]();else{const _0x54139e=await this[_0x503fa9(0x18b)](),_0x41c3ed=await axios_1['default'][_0x503fa9(0x195)](_0x503fa9(0x197)+constants_1[_0x503fa9(0x1ba)],_0x54139e)[_0x503fa9(0x184)](()=>!![])[_0x503fa9(0x1a0)](()=>![]);!_0x41c3ed&&await this[_0x503fa9(0x1c6)]();}}catch(_0xece93d){}}async[a269_0x26b987(0x1c6)](){const _0x4e5296=a269_0x26b987;var _0x38584f,_0x1a4996,_0x3928ac;this[_0x4e5296(0x1b2)][_0x4e5296(0x1a3)](_0x4e5296(0x1be));try{this[_0x4e5296(0x1c1)]=auth_state_enum_1[_0x4e5296(0x19e)][_0x4e5296(0x1cd)];const {refreshToken:_0x14a66d,clientId:_0x216ada,clientSecret:_0x2e4066,loginUrl:_0x2cd5d4}=typedi_1[_0x4e5296(0x1d4)][_0x4e5296(0x195)](providers_tokens_1[_0x4e5296(0x193)][_0x4e5296(0x180)]),{data:_0x4a1398}=await axios_1[_0x4e5296(0x1d4)]['post']((0x0,utils_1[_0x4e5296(0x1b7)])(_0x2cd5d4,_0x4e5296(0x17e)),null,{'params':{'grant_type':_0x4e5296(0x1a9),'refresh_token':_0x14a66d,'client_id':_0x216ada,'client_secret':_0x2e4066}});this[_0x4e5296(0x1b6)]=_0x4a1398[_0x4e5296(0x185)],this[_0x4e5296(0x1d1)]=_0x4a1398[_0x4e5296(0x1a2)],this['tokenType']=_0x4a1398[_0x4e5296(0x17c)],this[_0x4e5296(0x1c1)]=auth_state_enum_1[_0x4e5296(0x19e)][_0x4e5296(0x1c7)],this[_0x4e5296(0x1b2)][_0x4e5296(0x1a3)](_0x4e5296(0x1b0),this[_0x4e5296(0x1b6)]);}catch(_0x3b166e){const _0x1599d6=((_0x1a4996=(_0x38584f=_0x3b166e===null||_0x3b166e===void 0x0?void 0x0:_0x3b166e[_0x4e5296(0x1c2)])===null||_0x38584f===void 0x0?void 0x0:_0x38584f[_0x4e5296(0x18e)])===null||_0x1a4996===void 0x0?void 0x0:_0x1a4996[_0x4e5296(0x1b8)])||((_0x3928ac=_0x3b166e===null||_0x3b166e===void 0x0?void 0x0:_0x3b166e[_0x4e5296(0x1c2)])===null||_0x3928ac===void 0x0?void 0x0:_0x3928ac[_0x4e5296(0x18e)])||_0x3b166e[_0x4e5296(0x18a)];this[_0x4e5296(0x1b2)][_0x4e5296(0x1b8)](_0x4e5296(0x1c3),_0x1599d6),this[_0x4e5296(0x1c1)]=auth_state_enum_1[_0x4e5296(0x19e)]['Error'];throw new invalid_refresh_token_error_1[(_0x4e5296(0x182))](errors_1[_0x4e5296(0x18d)]);}}async[a269_0x26b987(0x1bf)](){const _0x443596=a269_0x26b987;this['logger'][_0x443596(0x1a3)]('Force\x20update\x20token');if(this[_0x443596(0x1c1)]===auth_state_enum_1['AuthState'][_0x443596(0x1cd)]||this['authState']===auth_state_enum_1[_0x443596(0x19e)]['Idle'])return await(0x0,utils_1['sleep'])(this[_0x443596(0x181)]),this[_0x443596(0x1bf)]();if(this[_0x443596(0x1c1)]===auth_state_enum_1[_0x443596(0x19e)][_0x443596(0x1c5)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x443596(0x18d)]);await this[_0x443596(0x1c6)]();}async['waitAuth'](){const _0x5ea1dc=a269_0x26b987;if(this['authState']===auth_state_enum_1['AuthState'][_0x5ea1dc(0x1c5)]){this[_0x5ea1dc(0x1b2)][_0x5ea1dc(0x1a3)]('Create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x5ea1dc(0x17b))]();}if(this['authState']!==auth_state_enum_1[_0x5ea1dc(0x19e)][_0x5ea1dc(0x1c7)])return this[_0x5ea1dc(0x1b2)]['log'](_0x5ea1dc(0x174)),await(0x0,utils_1[_0x5ea1dc(0x1a4)])(this['AUTH_WAIT_TIME']),this[_0x5ea1dc(0x17f)]();}[a269_0x26b987(0x177)](){const _0x568a0e=a269_0x26b987;return{'orgId':this[_0x568a0e(0x187)],'accessToken':this[_0x568a0e(0x1d1)],'instanceUrl':this['instanceUrl']};}async[a269_0x26b987(0x18b)](_0x5d27c1=''){const _0x46a1dc=a269_0x26b987;await this[_0x46a1dc(0x17f)]();const _0x1c4f78={'baseURL':this['instanceUrl'],'headers':{'accept':_0x46a1dc(0x1d3)}};if(salesforce_1[_0x46a1dc(0x1a6)][_0x46a1dc(0x172)](_0x5d27c1))_0x1c4f78[_0x46a1dc(0x1cf)]['X-SFDC-Session']=this[_0x46a1dc(0x1d1)];else salesforce_1[_0x46a1dc(0x1a6)]['isSoapUrl'](_0x5d27c1)?_0x1c4f78[_0x46a1dc(0x18e)]=_0x1c4f78[_0x46a1dc(0x18e)][_0x46a1dc(0x1b3)](/<met:sessionId>.+?<\/met:sessionId>/,_0x46a1dc(0x1b5)+this['accessToken']+'</met:sessionId>'):_0x1c4f78[_0x46a1dc(0x1cf)][_0x46a1dc(0x17a)]=this[_0x46a1dc(0x196)]+'\x20'+this[_0x46a1dc(0x1d1)];return _0x1c4f78;}};function a269_0x3f3c(){const _0x339758=['Access\x20token\x20updated\x20for\x20%s','__createBinding','logger','replace','constructor','<met:sessionId>','instanceUrl','joinURL','error','object','SALESFORCE_API_VERSION','create','__importStar','__esModule','Update\x20access\x20token','forceUpdateToken','setAuthDetails','authState','response','Update\x20access\x20token\x20failed:\x20%s','toString','Error','updateAccessToken','Active','../../../shared/utils','Service','5317140qBkRIG','hasOwnProperty','length','Updating','__metadata','headers','../errors/invalid-refresh-token.error','accessToken','getOwnPropertyDescriptor','application/json','default','metadata','isBulk1Url','30593830QQxxGb','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','(((.+)+)+)+$','6EWcgBc','getAuthData','9XUOiQj','decorate','authorization','UnauthorizedSalesforceError','token_type','defineProperty','/services/oauth2/token','waitAuth','salesforce','AUTH_WAIT_TIME','InvalidRefreshTokenError','../enums/auth-state.enum','then','instance_url','prototype','orgId','function','call','message','requestConfig','10165456DmcwDL','ERR_INVALID_SALESFORCE_TOKEN','data','design:paramtypes','search','518403iPdAGB','4004404kICOhw','Tokens','Logger','get','tokenType','services/data/','../../providers/providers.tokens','name','apply','__decorate','@flosum/salesforce','__setModuleDefault','AuthState','2575551dclLFI','catch','typedi','access_token','log','sleep','__importDefault','SalesforceUtils','2iFDYgh','SalesforceAuthService','refresh_token','../../../../core','../../../../constants/errors','writable','../errors/unauthorized-salesforce.error','4620203PltaQV','configurable'];a269_0x3f3c=function(){return _0x339758;};return a269_0x3f3c();}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a269_0x26b987(0x1c9)])(),__metadata(a269_0x26b987(0x18f),[])],SalesforceAuthService),exports[a269_0x26b987(0x1a8)]=SalesforceAuthService;