const a271_0x5caeeb=a271_0x1afe;(function(_0x4a6983,_0x59b56d){const _0x4ac3cd=a271_0x1afe,_0x3cba92=_0x4a6983();while(!![]){try{const _0x56ca9f=-parseInt(_0x4ac3cd(0x101))/0x1*(-parseInt(_0x4ac3cd(0xf4))/0x2)+parseInt(_0x4ac3cd(0xec))/0x3*(-parseInt(_0x4ac3cd(0xff))/0x4)+-parseInt(_0x4ac3cd(0x12a))/0x5+parseInt(_0x4ac3cd(0xeb))/0x6*(-parseInt(_0x4ac3cd(0x124))/0x7)+-parseInt(_0x4ac3cd(0x100))/0x8*(parseInt(_0x4ac3cd(0x121))/0x9)+-parseInt(_0x4ac3cd(0xf3))/0xa+-parseInt(_0x4ac3cd(0xd7))/0xb*(-parseInt(_0x4ac3cd(0x10b))/0xc);if(_0x56ca9f===_0x59b56d)break;else _0x3cba92['push'](_0x3cba92['shift']());}catch(_0xca59ec){_0x3cba92['push'](_0x3cba92['shift']());}}}(a271_0x3e54,0xe1ff6));const a271_0x28b3f3=(function(){let _0x3f385f=!![];return function(_0x59ace3,_0x22c0ea){const _0x57ce79=_0x3f385f?function(){const _0x5f445e=a271_0x1afe;if(_0x22c0ea){const _0x14d95e=_0x22c0ea[_0x5f445e(0x105)](_0x59ace3,arguments);return _0x22c0ea=null,_0x14d95e;}}:function(){};return _0x3f385f=![],_0x57ce79;};}()),a271_0x400b5f=a271_0x28b3f3(this,function(){const _0x29815a=a271_0x1afe;return a271_0x400b5f[_0x29815a(0x113)]()[_0x29815a(0xfb)](_0x29815a(0x11c))[_0x29815a(0x113)]()[_0x29815a(0xd5)](a271_0x400b5f)[_0x29815a(0xfb)]('(((.+)+)+)+$');});function a271_0x3e54(){const _0x47142b=['replace','../../../../constants/errors','@flosum/salesforce','1986fFlxky','321TlARVO','AUTH_WAIT_TIME','</met:sessionId>','__esModule','Force\x20update\x20token','../../../../core','writable','7707270JHdWSF','29284idYnPF','AuthState','Updating','log','__decorate','response','setAuthDetails','search','SalesforceUtils','prototype','Service','22684JcRwld','7359416QCgiCY','1INFCNF','hasOwnProperty','authState','post','apply','application/json','accessToken','typedi','authorization','decorate','24vdeHGL','Update\x20access\x20token\x20failed:\x20%s','requestConfig','Logger','waitAuth','/services/oauth2/token','get','../enums/auth-state.enum','toString','refresh_token','then','defineProperty','Active','Update\x20access\x20token','InvalidRefreshTokenError','token_type','../errors/unauthorized-salesforce.error','(((.+)+)+)+$','default','call','Access\x20token\x20updated\x20for\x20%s','__setModuleDefault','18nutwUy','length','isBulk1Url','26593Nlrubd','Idle','name','tokenType','../../providers/providers.tokens','data','871855WmkXqX','getOwnPropertyDescriptor','headers','../../../shared/utils','create','object','metadata','Error','ERR_INVALID_SALESFORCE_TOKEN','constructor','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','30581441ScOfqL','joinURL','error','access_token','instanceUrl','__metadata','Tokens','axios','orgId','sleep','../../../../constants','logger','__importDefault','message','isSoapUrl','updateAccessToken','function'];a271_0x3e54=function(){return _0x47142b;};return a271_0x3e54();}a271_0x400b5f();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a271_0x5caeeb(0x12e)]?function(_0x3860a4,_0x1e9849,_0xf4275,_0x425c5c){const _0x1e8d9a=a271_0x5caeeb;if(_0x425c5c===undefined)_0x425c5c=_0xf4275;var _0x6c43f=Object[_0x1e8d9a(0x12b)](_0x1e9849,_0xf4275);(!_0x6c43f||(_0x1e8d9a(0x111)in _0x6c43f?!_0x1e9849[_0x1e8d9a(0xef)]:_0x6c43f[_0x1e8d9a(0xf2)]||_0x6c43f['configurable']))&&(_0x6c43f={'enumerable':!![],'get':function(){return _0x1e9849[_0xf4275];}}),Object[_0x1e8d9a(0x116)](_0x3860a4,_0x425c5c,_0x6c43f);}:function(_0x3f28fe,_0x1cd13e,_0x2140d6,_0x2cbb5b){if(_0x2cbb5b===undefined)_0x2cbb5b=_0x2140d6;_0x3f28fe[_0x2cbb5b]=_0x1cd13e[_0x2140d6];}),__setModuleDefault=this&&this[a271_0x5caeeb(0x120)]||(Object[a271_0x5caeeb(0x12e)]?function(_0x4ffae7,_0x422771){const _0x34734b=a271_0x5caeeb;Object[_0x34734b(0x116)](_0x4ffae7,_0x34734b(0x11d),{'enumerable':!![],'value':_0x422771});}:function(_0x3906ef,_0x52aaa1){_0x3906ef['default']=_0x52aaa1;}),__decorate=this&&this[a271_0x5caeeb(0xf8)]||function(_0x10fdb6,_0x10b8d8,_0x224ad3,_0x103c0d){const _0x2c5c62=a271_0x5caeeb;var _0x4e6237=arguments[_0x2c5c62(0x122)],_0x5cb12c=_0x4e6237<0x3?_0x10b8d8:_0x103c0d===null?_0x103c0d=Object[_0x2c5c62(0x12b)](_0x10b8d8,_0x224ad3):_0x103c0d,_0x38d672;if(typeof Reflect===_0x2c5c62(0xd1)&&typeof Reflect['decorate']===_0x2c5c62(0xe7))_0x5cb12c=Reflect[_0x2c5c62(0x10a)](_0x10fdb6,_0x10b8d8,_0x224ad3,_0x103c0d);else{for(var _0x207ed3=_0x10fdb6[_0x2c5c62(0x122)]-0x1;_0x207ed3>=0x0;_0x207ed3--)if(_0x38d672=_0x10fdb6[_0x207ed3])_0x5cb12c=(_0x4e6237<0x3?_0x38d672(_0x5cb12c):_0x4e6237>0x3?_0x38d672(_0x10b8d8,_0x224ad3,_0x5cb12c):_0x38d672(_0x10b8d8,_0x224ad3))||_0x5cb12c;}return _0x4e6237>0x3&&_0x5cb12c&&Object[_0x2c5c62(0x116)](_0x10b8d8,_0x224ad3,_0x5cb12c),_0x5cb12c;},__importStar=this&&this['__importStar']||function(_0xf9d0eb){const _0x216ac1=a271_0x5caeeb;if(_0xf9d0eb&&_0xf9d0eb[_0x216ac1(0xef)])return _0xf9d0eb;var _0x55dbf4={};if(_0xf9d0eb!=null){for(var _0x42b644 in _0xf9d0eb)if(_0x42b644!==_0x216ac1(0x11d)&&Object[_0x216ac1(0xfd)][_0x216ac1(0x102)][_0x216ac1(0x11e)](_0xf9d0eb,_0x42b644))__createBinding(_0x55dbf4,_0xf9d0eb,_0x42b644);}return __setModuleDefault(_0x55dbf4,_0xf9d0eb),_0x55dbf4;},__metadata=this&&this[a271_0x5caeeb(0xdc)]||function(_0xb99635,_0x3c552a){const _0x2e8f7c=a271_0x5caeeb;if(typeof Reflect==='object'&&typeof Reflect[_0x2e8f7c(0xd2)]===_0x2e8f7c(0xe7))return Reflect[_0x2e8f7c(0xd2)](_0xb99635,_0x3c552a);},__importDefault=this&&this[a271_0x5caeeb(0xe3)]||function(_0xb01041){const _0x3e4e24=a271_0x5caeeb;return _0xb01041&&_0xb01041[_0x3e4e24(0xef)]?_0xb01041:{'default':_0xb01041};},SalesforceAuthService_1;function a271_0x1afe(_0x46e255,_0x66b057){const _0x101ffe=a271_0x3e54();return a271_0x1afe=function(_0x400b5f,_0x28b3f3){_0x400b5f=_0x400b5f-0xd1;let _0x3e5449=_0x101ffe[_0x400b5f];return _0x3e5449;},a271_0x1afe(_0x46e255,_0x66b057);}Object[a271_0x5caeeb(0x116)](exports,a271_0x5caeeb(0xef),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a271_0x5caeeb(0x108))),errors_1=require(a271_0x5caeeb(0xe9)),core_1=require(a271_0x5caeeb(0xf1)),axios_1=__importDefault(require(a271_0x5caeeb(0xde))),utils_1=require(a271_0x5caeeb(0x12d)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a271_0x5caeeb(0x112)),unauthorized_salesforce_error_1=require(a271_0x5caeeb(0x11b)),constants_1=require(a271_0x5caeeb(0xe1)),providers_tokens_1=require(a271_0x5caeeb(0x128)),salesforce_1=require(a271_0x5caeeb(0xea));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x1161d7=a271_0x5caeeb;this[_0x1161d7(0xed)]=0x1388,this[_0x1161d7(0x103)]=auth_state_enum_1[_0x1161d7(0xf5)][_0x1161d7(0x125)],this[_0x1161d7(0xe2)]=new core_1[(_0x1161d7(0x10e))](SalesforceAuthService_1[_0x1161d7(0x126)]),this[_0x1161d7(0xfa)]();}async[a271_0x5caeeb(0xfa)](){const _0x473320=a271_0x5caeeb;this[_0x473320(0xe2)][_0x473320(0xf7)]('Check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x473320(0xf5)][this[_0x473320(0x103)]]);try{if(this[_0x473320(0x103)]===auth_state_enum_1[_0x473320(0xf5)][_0x473320(0xd3)])return;if(this['authState']===auth_state_enum_1['AuthState'][_0x473320(0x125)])await this[_0x473320(0xe6)]();else{const _0x4ceab0=await this[_0x473320(0x10d)](),_0x5cca28=await axios_1[_0x473320(0x11d)][_0x473320(0x111)]('services/data/'+constants_1['SALESFORCE_API_VERSION'],_0x4ceab0)[_0x473320(0x115)](()=>!![])['catch'](()=>![]);!_0x5cca28&&await this['updateAccessToken']();}}catch(_0x48469a){}}async[a271_0x5caeeb(0xe6)](){const _0x548f61=a271_0x5caeeb;var _0x51dc5b,_0x3b5b61,_0x53225c;this[_0x548f61(0xe2)][_0x548f61(0xf7)](_0x548f61(0x118));try{this[_0x548f61(0x103)]=auth_state_enum_1[_0x548f61(0xf5)][_0x548f61(0xf6)];const {refreshToken:_0x4cdf1c,clientId:_0xe63725,clientSecret:_0x2d9969,loginUrl:_0x179a63}=typedi_1['default'][_0x548f61(0x111)](providers_tokens_1[_0x548f61(0xdd)]['salesforce']),{data:_0x5cc55f}=await axios_1[_0x548f61(0x11d)][_0x548f61(0x104)]((0x0,utils_1[_0x548f61(0xd8)])(_0x179a63,_0x548f61(0x110)),null,{'params':{'grant_type':_0x548f61(0x114),'refresh_token':_0x4cdf1c,'client_id':_0xe63725,'client_secret':_0x2d9969}});this['instanceUrl']=_0x5cc55f['instance_url'],this[_0x548f61(0x107)]=_0x5cc55f[_0x548f61(0xda)],this['tokenType']=_0x5cc55f[_0x548f61(0x11a)],this[_0x548f61(0x103)]=auth_state_enum_1[_0x548f61(0xf5)][_0x548f61(0x117)],this[_0x548f61(0xe2)][_0x548f61(0xf7)](_0x548f61(0x11f),this[_0x548f61(0xdb)]);}catch(_0x40c61f){const _0x4bb7d6=((_0x3b5b61=(_0x51dc5b=_0x40c61f===null||_0x40c61f===void 0x0?void 0x0:_0x40c61f[_0x548f61(0xf9)])===null||_0x51dc5b===void 0x0?void 0x0:_0x51dc5b[_0x548f61(0x129)])===null||_0x3b5b61===void 0x0?void 0x0:_0x3b5b61[_0x548f61(0xd9)])||((_0x53225c=_0x40c61f===null||_0x40c61f===void 0x0?void 0x0:_0x40c61f[_0x548f61(0xf9)])===null||_0x53225c===void 0x0?void 0x0:_0x53225c[_0x548f61(0x129)])||_0x40c61f[_0x548f61(0xe4)];this[_0x548f61(0xe2)][_0x548f61(0xd9)](_0x548f61(0x10c),_0x4bb7d6),this[_0x548f61(0x103)]=auth_state_enum_1[_0x548f61(0xf5)][_0x548f61(0xd3)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x548f61(0xd4)]);}}async['forceUpdateToken'](){const _0x37fa31=a271_0x5caeeb;this[_0x37fa31(0xe2)][_0x37fa31(0xf7)](_0x37fa31(0xf0));if(this['authState']===auth_state_enum_1['AuthState']['Updating']||this[_0x37fa31(0x103)]===auth_state_enum_1[_0x37fa31(0xf5)][_0x37fa31(0x125)])return await(0x0,utils_1[_0x37fa31(0xe0)])(this['AUTH_WAIT_TIME']),this['forceUpdateToken']();if(this[_0x37fa31(0x103)]===auth_state_enum_1[_0x37fa31(0xf5)][_0x37fa31(0xd3)])throw new invalid_refresh_token_error_1[(_0x37fa31(0x119))](errors_1[_0x37fa31(0xd4)]);await this['updateAccessToken']();}async[a271_0x5caeeb(0x10f)](){const _0x4098bf=a271_0x5caeeb;if(this['authState']===auth_state_enum_1['AuthState']['Error']){this[_0x4098bf(0xe2)][_0x4098bf(0xf7)](_0x4098bf(0xd6));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x4098bf(0x103)]!==auth_state_enum_1[_0x4098bf(0xf5)][_0x4098bf(0x117)])return this[_0x4098bf(0xe2)][_0x4098bf(0xf7)]('Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1['sleep'])(this[_0x4098bf(0xed)]),this[_0x4098bf(0x10f)]();}['getAuthData'](){const _0x3be53b=a271_0x5caeeb;return{'orgId':this[_0x3be53b(0xdf)],'accessToken':this[_0x3be53b(0x107)],'instanceUrl':this[_0x3be53b(0xdb)]};}async['requestConfig'](_0x2f0915=''){const _0xd53165=a271_0x5caeeb;await this[_0xd53165(0x10f)]();const _0x417550={'baseURL':this[_0xd53165(0xdb)],'headers':{'accept':_0xd53165(0x106)}};if(salesforce_1[_0xd53165(0xfc)][_0xd53165(0x123)](_0x2f0915))_0x417550[_0xd53165(0x12c)]['X-SFDC-Session']=this[_0xd53165(0x107)];else salesforce_1['SalesforceUtils'][_0xd53165(0xe5)](_0x2f0915)?_0x417550[_0xd53165(0x129)]=_0x417550['data'][_0xd53165(0xe8)](/<met:sessionId>.+?<\/met:sessionId>/,'<met:sessionId>'+this[_0xd53165(0x107)]+_0xd53165(0xee)):_0x417550[_0xd53165(0x12c)][_0xd53165(0x109)]=this[_0xd53165(0x127)]+'\x20'+this[_0xd53165(0x107)];return _0x417550;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a271_0x5caeeb(0xfe)])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;