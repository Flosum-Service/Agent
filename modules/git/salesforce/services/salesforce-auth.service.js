const a227_0x5f4415=a227_0x1dae;(function(_0x11851c,_0x3472c9){const _0x1cd8c3=a227_0x1dae,_0x24a296=_0x11851c();while(!![]){try{const _0x350f5d=-parseInt(_0x1cd8c3(0x1cd))/0x1+parseInt(_0x1cd8c3(0x207))/0x2*(-parseInt(_0x1cd8c3(0x1d8))/0x3)+-parseInt(_0x1cd8c3(0x1cf))/0x4+parseInt(_0x1cd8c3(0x1f0))/0x5+-parseInt(_0x1cd8c3(0x20c))/0x6+parseInt(_0x1cd8c3(0x1ef))/0x7*(-parseInt(_0x1cd8c3(0x1f5))/0x8)+-parseInt(_0x1cd8c3(0x20d))/0x9*(-parseInt(_0x1cd8c3(0x1e2))/0xa);if(_0x350f5d===_0x3472c9)break;else _0x24a296['push'](_0x24a296['shift']());}catch(_0x2af484){_0x24a296['push'](_0x24a296['shift']());}}}(a227_0x1f7c,0x42402));function a227_0x1f7c(){const _0x38f732=['ERR_INVALID_SALESFORCE_TOKEN','logger','__esModule','../../../shared/utils','object','forceUpdateToken','error','Error','__setModuleDefault','1770gLaUnG','toString','joinURL','response','writable','Idle','../../../../constants/errors','Logger','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','configurable','InvalidRefreshTokenError','length','services/data/','7TuvQFO','1127910rVoldt','update\x20access\x20token\x20failed:\x20%s','tokenType','search','../errors/unauthorized-salesforce.error','3847240RGudFH','accessToken','AUTH_WAIT_TIME','updateAccessToken','application/json','instanceUrl','data','name','prototype','authState','design:paramtypes','UnauthorizedSalesforceError','refresh_token','token_type','../../../../core','metadata','__importStar','defineProperty','98hzwEMN','__createBinding','AuthState','decorate','requestConfig','1657698EhYfKG','85626PnXTXx','Active','../../../../constants','force\x20update\x20token','post','orgId','get','Updating','setAuthDetails','catch','constructor','create','log','default','sleep','getOwnPropertyDescriptor','waitAuth','412259nHMxjS','SalesforceAuthService','1641764EwLUVC','function','axios','(((.+)+)+)+$','../enums/auth-state.enum','__importDefault','apply','message','then','3570nnBrPj'];a227_0x1f7c=function(){return _0x38f732;};return a227_0x1f7c();}const a227_0x1daa2e=(function(){let _0x1ce36a=!![];return function(_0x5bd8f3,_0x2cf1e4){const _0x1011e3=_0x1ce36a?function(){const _0x1ed1e6=a227_0x1dae;if(_0x2cf1e4){const _0x4bd775=_0x2cf1e4[_0x1ed1e6(0x1d5)](_0x5bd8f3,arguments);return _0x2cf1e4=null,_0x4bd775;}}:function(){};return _0x1ce36a=![],_0x1011e3;};}()),a227_0x34b0f4=a227_0x1daa2e(this,function(){const _0x263be9=a227_0x1dae;return a227_0x34b0f4[_0x263be9(0x1e3)]()[_0x263be9(0x1f3)](_0x263be9(0x1d2))[_0x263be9(0x1e3)]()[_0x263be9(0x1c6)](a227_0x34b0f4)[_0x263be9(0x1f3)](_0x263be9(0x1d2));});a227_0x34b0f4();'use strict';var __createBinding=this&&this[a227_0x5f4415(0x208)]||(Object[a227_0x5f4415(0x1c7)]?function(_0x1f053f,_0x3a9786,_0x1cb14a,_0x35bb47){const _0x5d6e94=a227_0x5f4415;if(_0x35bb47===undefined)_0x35bb47=_0x1cb14a;var _0xcbf08=Object[_0x5d6e94(0x1cb)](_0x3a9786,_0x1cb14a);(!_0xcbf08||(_0x5d6e94(0x213)in _0xcbf08?!_0x3a9786[_0x5d6e94(0x1db)]:_0xcbf08[_0x5d6e94(0x1e6)]||_0xcbf08[_0x5d6e94(0x1eb)]))&&(_0xcbf08={'enumerable':!![],'get':function(){return _0x3a9786[_0x1cb14a];}}),Object[_0x5d6e94(0x206)](_0x1f053f,_0x35bb47,_0xcbf08);}:function(_0x10285e,_0x5c4fbc,_0x10efac,_0x57d4d1){if(_0x57d4d1===undefined)_0x57d4d1=_0x10efac;_0x10285e[_0x57d4d1]=_0x5c4fbc[_0x10efac];}),__setModuleDefault=this&&this[a227_0x5f4415(0x1e1)]||(Object['create']?function(_0x3d09d6,_0x392fa9){const _0x308fd4=a227_0x5f4415;Object[_0x308fd4(0x206)](_0x3d09d6,_0x308fd4(0x1c9),{'enumerable':!![],'value':_0x392fa9});}:function(_0x2a9985,_0x73ad70){_0x2a9985['default']=_0x73ad70;}),__decorate=this&&this['__decorate']||function(_0x216bef,_0x1cb8e6,_0x4fde8e,_0x3549e6){const _0x3df603=a227_0x5f4415;var _0x1d240b=arguments[_0x3df603(0x1ed)],_0x47c7ab=_0x1d240b<0x3?_0x1cb8e6:_0x3549e6===null?_0x3549e6=Object[_0x3df603(0x1cb)](_0x1cb8e6,_0x4fde8e):_0x3549e6,_0x1a794b;if(typeof Reflect===_0x3df603(0x1dd)&&typeof Reflect[_0x3df603(0x20a)]===_0x3df603(0x1d0))_0x47c7ab=Reflect['decorate'](_0x216bef,_0x1cb8e6,_0x4fde8e,_0x3549e6);else{for(var _0x14c4b3=_0x216bef[_0x3df603(0x1ed)]-0x1;_0x14c4b3>=0x0;_0x14c4b3--)if(_0x1a794b=_0x216bef[_0x14c4b3])_0x47c7ab=(_0x1d240b<0x3?_0x1a794b(_0x47c7ab):_0x1d240b>0x3?_0x1a794b(_0x1cb8e6,_0x4fde8e,_0x47c7ab):_0x1a794b(_0x1cb8e6,_0x4fde8e))||_0x47c7ab;}return _0x1d240b>0x3&&_0x47c7ab&&Object[_0x3df603(0x206)](_0x1cb8e6,_0x4fde8e,_0x47c7ab),_0x47c7ab;},__importStar=this&&this[a227_0x5f4415(0x205)]||function(_0x55d835){const _0x146a46=a227_0x5f4415;if(_0x55d835&&_0x55d835[_0x146a46(0x1db)])return _0x55d835;var _0x20a54e={};if(_0x55d835!=null){for(var _0x48c11c in _0x55d835)if(_0x48c11c!==_0x146a46(0x1c9)&&Object[_0x146a46(0x1fd)]['hasOwnProperty']['call'](_0x55d835,_0x48c11c))__createBinding(_0x20a54e,_0x55d835,_0x48c11c);}return __setModuleDefault(_0x20a54e,_0x55d835),_0x20a54e;},__metadata=this&&this['__metadata']||function(_0x59692f,_0x4b3aac){const _0x559e3d=a227_0x5f4415;if(typeof Reflect===_0x559e3d(0x1dd)&&typeof Reflect[_0x559e3d(0x204)]===_0x559e3d(0x1d0))return Reflect['metadata'](_0x59692f,_0x4b3aac);},__importDefault=this&&this[a227_0x5f4415(0x1d4)]||function(_0x40ef8a){return _0x40ef8a&&_0x40ef8a['__esModule']?_0x40ef8a:{'default':_0x40ef8a};},SalesforceAuthService_1;Object[a227_0x5f4415(0x206)](exports,'__esModule',{'value':!![]}),exports[a227_0x5f4415(0x1ce)]=void 0x0;function a227_0x1dae(_0x313536,_0x48a386){const _0x407782=a227_0x1f7c();return a227_0x1dae=function(_0x34b0f4,_0x1daa2e){_0x34b0f4=_0x34b0f4-0x1c3;let _0x1f7c01=_0x407782[_0x34b0f4];return _0x1f7c01;},a227_0x1dae(_0x313536,_0x48a386);}const typedi_1=__importStar(require('typedi')),errors_1=require(a227_0x5f4415(0x1e8)),core_1=require(a227_0x5f4415(0x203)),axios_1=__importDefault(require(a227_0x5f4415(0x1d1))),utils_1=require(a227_0x5f4415(0x1dc)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a227_0x5f4415(0x1d3)),unauthorized_salesforce_error_1=require(a227_0x5f4415(0x1f4)),constants_1=require(a227_0x5f4415(0x20f)),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x1f357b=a227_0x5f4415;this[_0x1f357b(0x1f7)]=0x1388,this[_0x1f357b(0x1fe)]=auth_state_enum_1[_0x1f357b(0x209)]['Idle'],this[_0x1f357b(0x1da)]=new core_1[(_0x1f357b(0x1e9))](SalesforceAuthService_1[_0x1f357b(0x1fc)]),this[_0x1f357b(0x1c4)]();}async['setAuthDetails'](){const _0x4b84b7=a227_0x5f4415;this[_0x4b84b7(0x1da)]['log']('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this[_0x4b84b7(0x1fe)]]);try{if(this[_0x4b84b7(0x1fe)]===auth_state_enum_1[_0x4b84b7(0x209)][_0x4b84b7(0x1e0)])return;if(this['authState']===auth_state_enum_1['AuthState'][_0x4b84b7(0x1e7)])await this['updateAccessToken']();else{const _0x5947b6=await this[_0x4b84b7(0x20b)](),_0x417045=await axios_1[_0x4b84b7(0x1c9)]['get'](_0x4b84b7(0x1ee)+constants_1['SALESFORCE_API_VERSION'],_0x5947b6)[_0x4b84b7(0x1d7)](()=>!![])[_0x4b84b7(0x1c5)](()=>![]);!_0x417045&&await this['updateAccessToken']();}}catch(_0x1a1e99){}}async[a227_0x5f4415(0x1f8)](){const _0xb3bbe5=a227_0x5f4415;var _0x445e7b,_0x3923be,_0x3db73f;this[_0xb3bbe5(0x1da)][_0xb3bbe5(0x1c8)]('update\x20access\x20token');try{this[_0xb3bbe5(0x1fe)]=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0xd66055,clientId:_0x3591d3,clientSecret:_0x2a982a,loginUrl:_0x15cd89}=typedi_1['default'][_0xb3bbe5(0x213)](providers_tokens_1['Tokens']['salesforce']),{data:_0x17f90b}=await axios_1[_0xb3bbe5(0x1c9)][_0xb3bbe5(0x211)]((0x0,utils_1[_0xb3bbe5(0x1e4)])(_0x15cd89,'/services/oauth2/token'),null,{'params':{'grant_type':_0xb3bbe5(0x201),'refresh_token':_0xd66055,'client_id':_0x3591d3,'client_secret':_0x2a982a}});this[_0xb3bbe5(0x1fa)]=_0x17f90b['instance_url'],this[_0xb3bbe5(0x1f6)]=_0x17f90b['access_token'],this['tokenType']=_0x17f90b[_0xb3bbe5(0x202)],this[_0xb3bbe5(0x1fe)]=auth_state_enum_1['AuthState'][_0xb3bbe5(0x20e)],this[_0xb3bbe5(0x1da)][_0xb3bbe5(0x1c8)]('access\x20token\x20updated\x20for\x20%s',this[_0xb3bbe5(0x1fa)]);}catch(_0x6fd0de){const _0x474d7a=((_0x3923be=(_0x445e7b=_0x6fd0de===null||_0x6fd0de===void 0x0?void 0x0:_0x6fd0de[_0xb3bbe5(0x1e5)])===null||_0x445e7b===void 0x0?void 0x0:_0x445e7b[_0xb3bbe5(0x1fb)])===null||_0x3923be===void 0x0?void 0x0:_0x3923be[_0xb3bbe5(0x1df)])||((_0x3db73f=_0x6fd0de===null||_0x6fd0de===void 0x0?void 0x0:_0x6fd0de[_0xb3bbe5(0x1e5)])===null||_0x3db73f===void 0x0?void 0x0:_0x3db73f[_0xb3bbe5(0x1fb)])||_0x6fd0de[_0xb3bbe5(0x1d6)];this[_0xb3bbe5(0x1da)][_0xb3bbe5(0x1df)](_0xb3bbe5(0x1f1),_0x474d7a),this[_0xb3bbe5(0x1fe)]=auth_state_enum_1[_0xb3bbe5(0x209)][_0xb3bbe5(0x1e0)];throw new invalid_refresh_token_error_1[(_0xb3bbe5(0x1ec))](errors_1[_0xb3bbe5(0x1d9)]);}}async[a227_0x5f4415(0x1de)](){const _0x11a52d=a227_0x5f4415;this['logger'][_0x11a52d(0x1c8)](_0x11a52d(0x210));if(this['authState']===auth_state_enum_1[_0x11a52d(0x209)][_0x11a52d(0x1c3)]||this[_0x11a52d(0x1fe)]===auth_state_enum_1[_0x11a52d(0x209)][_0x11a52d(0x1e7)])return await(0x0,utils_1[_0x11a52d(0x1ca)])(this[_0x11a52d(0x1f7)]),this[_0x11a52d(0x1de)]();if(this[_0x11a52d(0x1fe)]===auth_state_enum_1[_0x11a52d(0x209)][_0x11a52d(0x1e0)])throw new invalid_refresh_token_error_1[(_0x11a52d(0x1ec))](errors_1[_0x11a52d(0x1d9)]);await this['updateAccessToken']();}async[a227_0x5f4415(0x1cc)](){const _0x1cc503=a227_0x5f4415;if(this['authState']===auth_state_enum_1[_0x1cc503(0x209)]['Error']){this['logger'][_0x1cc503(0x1c8)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x1cc503(0x200))]();}if(this['authState']!==auth_state_enum_1[_0x1cc503(0x209)]['Active'])return this['logger'][_0x1cc503(0x1c8)](_0x1cc503(0x1ea)),await(0x0,utils_1[_0x1cc503(0x1ca)])(this[_0x1cc503(0x1f7)]),this['waitAuth']();}['getAuthData'](){const _0x22240e=a227_0x5f4415;return{'orgId':this[_0x22240e(0x212)],'accessToken':this['accessToken'],'instanceUrl':this[_0x22240e(0x1fa)]};}async[a227_0x5f4415(0x20b)](){const _0x3c7f38=a227_0x5f4415;return await this[_0x3c7f38(0x1cc)](),{'baseURL':this[_0x3c7f38(0x1fa)],'headers':{'accept':_0x3c7f38(0x1f9),'authorization':this[_0x3c7f38(0x1f2)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a227_0x5f4415(0x1ff),[])],SalesforceAuthService),exports[a227_0x5f4415(0x1ce)]=SalesforceAuthService;