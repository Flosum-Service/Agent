const a270_0x2688c3=a270_0x14e7;(function(_0x4ff9c7,_0x383ad6){const _0x2b820d=a270_0x14e7,_0x5e4336=_0x4ff9c7();while(!![]){try{const _0x555c26=-parseInt(_0x2b820d(0x120))/0x1*(parseInt(_0x2b820d(0x109))/0x2)+parseInt(_0x2b820d(0x13a))/0x3*(-parseInt(_0x2b820d(0x107))/0x4)+parseInt(_0x2b820d(0xfa))/0x5*(parseInt(_0x2b820d(0x105))/0x6)+-parseInt(_0x2b820d(0x104))/0x7+-parseInt(_0x2b820d(0x12c))/0x8*(parseInt(_0x2b820d(0x12a))/0x9)+parseInt(_0x2b820d(0x14d))/0xa*(parseInt(_0x2b820d(0x12e))/0xb)+parseInt(_0x2b820d(0x10c))/0xc*(parseInt(_0x2b820d(0x14a))/0xd);if(_0x555c26===_0x383ad6)break;else _0x5e4336['push'](_0x5e4336['shift']());}catch(_0x233065){_0x5e4336['push'](_0x5e4336['shift']());}}}(a270_0x345b,0xbe9bb));const a270_0x53e2c0=(function(){let _0x15e7e4=!![];return function(_0x3f34cc,_0xe8c6a9){const _0x21aa00=_0x15e7e4?function(){const _0x13fb45=a270_0x14e7;if(_0xe8c6a9){const _0x358655=_0xe8c6a9[_0x13fb45(0x10e)](_0x3f34cc,arguments);return _0xe8c6a9=null,_0x358655;}}:function(){};return _0x15e7e4=![],_0x21aa00;};}()),a270_0x58ae16=a270_0x53e2c0(this,function(){const _0x3e8e0c=a270_0x14e7;return a270_0x58ae16['toString']()[_0x3e8e0c(0x11f)](_0x3e8e0c(0x134))[_0x3e8e0c(0xf8)]()[_0x3e8e0c(0x136)](a270_0x58ae16)['search'](_0x3e8e0c(0x134));});a270_0x58ae16();'use strict';function a270_0x345b(){const _0x42fdc5=['setAuthDetails','replace','Service','InvalidRefreshTokenError','toString','__esModule','10JTwauf','requestConfig','post','log','Update\x20access\x20token','axios','catch','get','joinURL','../../../shared/utils','6139644KFmrXV','955146TleZAz','__createBinding','806952tYtwRC','SalesforceAuthService','254474eedKVR','application/json','response','780756GrsXSW','Idle','apply','refresh_token','ERR_INVALID_SALESFORCE_TOKEN','then','Logger','hasOwnProperty','sleep','../../../../constants','authorization','name','</met:sessionId>','object','orgId','SALESFORCE_API_VERSION','length','../../../../core','AuthState','search','8WvhUkU','logger','updateAccessToken','Access\x20token\x20updated\x20for\x20%s','Error','Update\x20access\x20token\x20failed:\x20%s','Updating','error','forceUpdateToken','../errors/invalid-refresh-token.error','98019aJSkPE','metadata','8HHAoVv','function','19041AQMCoK','Active','accessToken','writable','message','headers','(((.+)+)+)+$','instanceUrl','constructor','UnauthorizedSalesforceError','authState','@flosum/salesforce','12oomrBK','default','<met:sessionId>','defineProperty','/services/oauth2/token','getOwnPropertyDescriptor','salesforce','../enums/auth-state.enum','__importDefault','isBulk1Url','waitAuth','data','isSoapUrl','create','X-SFDC-Session','Check\x20auth:\x20current\x20state\x20-\x20%s','494UYhoec','tokenType','Force\x20update\x20token','4060wcNfSb','SalesforceUtils','AUTH_WAIT_TIME','__importStar','__setModuleDefault','configurable'];a270_0x345b=function(){return _0x42fdc5;};return a270_0x345b();}var __createBinding=this&&this[a270_0x2688c3(0x106)]||(Object[a270_0x2688c3(0x147)]?function(_0x3b7ad3,_0x5b91fd,_0x4df356,_0x2d5539){const _0x5f2e91=a270_0x2688c3;if(_0x2d5539===undefined)_0x2d5539=_0x4df356;var _0x209f7e=Object[_0x5f2e91(0x13f)](_0x5b91fd,_0x4df356);(!_0x209f7e||(_0x5f2e91(0x101)in _0x209f7e?!_0x5b91fd[_0x5f2e91(0xf9)]:_0x209f7e[_0x5f2e91(0x131)]||_0x209f7e[_0x5f2e91(0xf3)]))&&(_0x209f7e={'enumerable':!![],'get':function(){return _0x5b91fd[_0x4df356];}}),Object['defineProperty'](_0x3b7ad3,_0x2d5539,_0x209f7e);}:function(_0x4ec35d,_0x2c195b,_0x4d752e,_0x17bec7){if(_0x17bec7===undefined)_0x17bec7=_0x4d752e;_0x4ec35d[_0x17bec7]=_0x2c195b[_0x4d752e];}),__setModuleDefault=this&&this[a270_0x2688c3(0xf2)]||(Object['create']?function(_0x39fdbb,_0x525b64){const _0x55f124=a270_0x2688c3;Object['defineProperty'](_0x39fdbb,_0x55f124(0x13b),{'enumerable':!![],'value':_0x525b64});}:function(_0x48f0b3,_0x516f30){const _0x5ebbc4=a270_0x2688c3;_0x48f0b3[_0x5ebbc4(0x13b)]=_0x516f30;}),__decorate=this&&this['__decorate']||function(_0x19d655,_0x4757eb,_0x3eba75,_0x40d5f7){const _0x5ebfa1=a270_0x2688c3;var _0x49e973=arguments[_0x5ebfa1(0x11c)],_0x28aad2=_0x49e973<0x3?_0x4757eb:_0x40d5f7===null?_0x40d5f7=Object[_0x5ebfa1(0x13f)](_0x4757eb,_0x3eba75):_0x40d5f7,_0x5423dc;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x5ebfa1(0x12d))_0x28aad2=Reflect['decorate'](_0x19d655,_0x4757eb,_0x3eba75,_0x40d5f7);else{for(var _0x5080e5=_0x19d655[_0x5ebfa1(0x11c)]-0x1;_0x5080e5>=0x0;_0x5080e5--)if(_0x5423dc=_0x19d655[_0x5080e5])_0x28aad2=(_0x49e973<0x3?_0x5423dc(_0x28aad2):_0x49e973>0x3?_0x5423dc(_0x4757eb,_0x3eba75,_0x28aad2):_0x5423dc(_0x4757eb,_0x3eba75))||_0x28aad2;}return _0x49e973>0x3&&_0x28aad2&&Object[_0x5ebfa1(0x13d)](_0x4757eb,_0x3eba75,_0x28aad2),_0x28aad2;},__importStar=this&&this[a270_0x2688c3(0x150)]||function(_0x40644d){const _0x24db35=a270_0x2688c3;if(_0x40644d&&_0x40644d[_0x24db35(0xf9)])return _0x40644d;var _0x21af36={};if(_0x40644d!=null){for(var _0x21dd97 in _0x40644d)if(_0x21dd97!=='default'&&Object['prototype'][_0x24db35(0x113)]['call'](_0x40644d,_0x21dd97))__createBinding(_0x21af36,_0x40644d,_0x21dd97);}return __setModuleDefault(_0x21af36,_0x40644d),_0x21af36;},__metadata=this&&this['__metadata']||function(_0x5ec578,_0x5901df){const _0x55b82d=a270_0x2688c3;if(typeof Reflect===_0x55b82d(0x119)&&typeof Reflect[_0x55b82d(0x12b)]==='function')return Reflect['metadata'](_0x5ec578,_0x5901df);},__importDefault=this&&this[a270_0x2688c3(0x142)]||function(_0x11d303){const _0x23d54c=a270_0x2688c3;return _0x11d303&&_0x11d303[_0x23d54c(0xf9)]?_0x11d303:{'default':_0x11d303};},SalesforceAuthService_1;Object['defineProperty'](exports,a270_0x2688c3(0xf9),{'value':!![]}),exports[a270_0x2688c3(0x108)]=void 0x0;function a270_0x14e7(_0x2ae7af,_0x58480f){const _0x4f6f7b=a270_0x345b();return a270_0x14e7=function(_0x58ae16,_0x53e2c0){_0x58ae16=_0x58ae16-0xf2;let _0x345bfc=_0x4f6f7b[_0x58ae16];return _0x345bfc;},a270_0x14e7(_0x2ae7af,_0x58480f);}const typedi_1=__importStar(require('typedi')),errors_1=require('../../../../constants/errors'),core_1=require(a270_0x2688c3(0x11d)),axios_1=__importDefault(require(a270_0x2688c3(0xff))),utils_1=require(a270_0x2688c3(0x103)),invalid_refresh_token_error_1=require(a270_0x2688c3(0x129)),auth_state_enum_1=require(a270_0x2688c3(0x141)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a270_0x2688c3(0x115)),providers_tokens_1=require('../../providers/providers.tokens'),salesforce_1=require(a270_0x2688c3(0x139));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x1f8c7d=a270_0x2688c3;this[_0x1f8c7d(0x14f)]=0x1388,this[_0x1f8c7d(0x138)]=auth_state_enum_1['AuthState'][_0x1f8c7d(0x10d)],this[_0x1f8c7d(0x121)]=new core_1[(_0x1f8c7d(0x112))](SalesforceAuthService_1[_0x1f8c7d(0x117)]),this[_0x1f8c7d(0xf4)]();}async[a270_0x2688c3(0xf4)](){const _0x308a03=a270_0x2688c3;this[_0x308a03(0x121)]['log'](_0x308a03(0x149),auth_state_enum_1['AuthState'][this[_0x308a03(0x138)]]);try{if(this[_0x308a03(0x138)]===auth_state_enum_1[_0x308a03(0x11e)][_0x308a03(0x124)])return;if(this[_0x308a03(0x138)]===auth_state_enum_1[_0x308a03(0x11e)][_0x308a03(0x10d)])await this[_0x308a03(0x122)]();else{const _0x3f8fec=await this[_0x308a03(0xfb)](),_0xfac9e=await axios_1['default']['get']('services/data/'+constants_1[_0x308a03(0x11b)],_0x3f8fec)[_0x308a03(0x111)](()=>!![])[_0x308a03(0x100)](()=>![]);!_0xfac9e&&await this[_0x308a03(0x122)]();}}catch(_0x46ba60){}}async['updateAccessToken'](){const _0x11e903=a270_0x2688c3;var _0x30063d,_0x2a8839,_0x3b1298;this[_0x11e903(0x121)][_0x11e903(0xfd)](_0x11e903(0xfe));try{this[_0x11e903(0x138)]=auth_state_enum_1['AuthState'][_0x11e903(0x126)];const {refreshToken:_0x6c1b16,clientId:_0x34d577,clientSecret:_0x4c5fa6,loginUrl:_0x5039fc}=typedi_1[_0x11e903(0x13b)]['get'](providers_tokens_1['Tokens'][_0x11e903(0x140)]),{data:_0x124f34}=await axios_1[_0x11e903(0x13b)][_0x11e903(0xfc)]((0x0,utils_1[_0x11e903(0x102)])(_0x5039fc,_0x11e903(0x13e)),null,{'params':{'grant_type':_0x11e903(0x10f),'refresh_token':_0x6c1b16,'client_id':_0x34d577,'client_secret':_0x4c5fa6}});this['instanceUrl']=_0x124f34['instance_url'],this[_0x11e903(0x130)]=_0x124f34['access_token'],this[_0x11e903(0x14b)]=_0x124f34['token_type'],this[_0x11e903(0x138)]=auth_state_enum_1[_0x11e903(0x11e)][_0x11e903(0x12f)],this[_0x11e903(0x121)]['log'](_0x11e903(0x123),this['instanceUrl']);}catch(_0x25d2cf){const _0xc7fe31=((_0x2a8839=(_0x30063d=_0x25d2cf===null||_0x25d2cf===void 0x0?void 0x0:_0x25d2cf[_0x11e903(0x10b)])===null||_0x30063d===void 0x0?void 0x0:_0x30063d['data'])===null||_0x2a8839===void 0x0?void 0x0:_0x2a8839[_0x11e903(0x127)])||((_0x3b1298=_0x25d2cf===null||_0x25d2cf===void 0x0?void 0x0:_0x25d2cf['response'])===null||_0x3b1298===void 0x0?void 0x0:_0x3b1298['data'])||_0x25d2cf[_0x11e903(0x132)];this[_0x11e903(0x121)][_0x11e903(0x127)](_0x11e903(0x125),_0xc7fe31),this[_0x11e903(0x138)]=auth_state_enum_1[_0x11e903(0x11e)]['Error'];throw new invalid_refresh_token_error_1[(_0x11e903(0xf7))](errors_1[_0x11e903(0x110)]);}}async[a270_0x2688c3(0x128)](){const _0x59234c=a270_0x2688c3;this[_0x59234c(0x121)][_0x59234c(0xfd)](_0x59234c(0x14c));if(this[_0x59234c(0x138)]===auth_state_enum_1['AuthState']['Updating']||this[_0x59234c(0x138)]===auth_state_enum_1['AuthState'][_0x59234c(0x10d)])return await(0x0,utils_1['sleep'])(this[_0x59234c(0x14f)]),this[_0x59234c(0x128)]();if(this['authState']===auth_state_enum_1[_0x59234c(0x11e)][_0x59234c(0x124)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x59234c(0x110)]);await this['updateAccessToken']();}async['waitAuth'](){const _0x356169=a270_0x2688c3;if(this['authState']===auth_state_enum_1['AuthState'][_0x356169(0x124)]){this['logger'][_0x356169(0xfd)]('Create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x356169(0x137))]();}if(this[_0x356169(0x138)]!==auth_state_enum_1[_0x356169(0x11e)][_0x356169(0x12f)])return this[_0x356169(0x121)][_0x356169(0xfd)]('Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x356169(0x114)])(this['AUTH_WAIT_TIME']),this[_0x356169(0x144)]();}['getAuthData'](){const _0x1c4432=a270_0x2688c3;return{'orgId':this[_0x1c4432(0x11a)],'accessToken':this[_0x1c4432(0x130)],'instanceUrl':this[_0x1c4432(0x135)]};}async[a270_0x2688c3(0xfb)](_0x5929ec=''){const _0xf9f937=a270_0x2688c3;await this[_0xf9f937(0x144)]();const _0x4f45fb={'baseURL':this[_0xf9f937(0x135)],'headers':{'accept':_0xf9f937(0x10a)}};if(salesforce_1[_0xf9f937(0x14e)][_0xf9f937(0x143)](_0x5929ec))_0x4f45fb[_0xf9f937(0x133)][_0xf9f937(0x148)]=this['accessToken'];else salesforce_1[_0xf9f937(0x14e)][_0xf9f937(0x146)](_0x5929ec)?_0x4f45fb['data']=_0x4f45fb[_0xf9f937(0x145)][_0xf9f937(0xf5)](/<met:sessionId>.+?<\/met:sessionId>/,_0xf9f937(0x13c)+this[_0xf9f937(0x130)]+_0xf9f937(0x118)):_0x4f45fb[_0xf9f937(0x133)][_0xf9f937(0x116)]=this[_0xf9f937(0x14b)]+'\x20'+this['accessToken'];return _0x4f45fb;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a270_0x2688c3(0xf6)])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;