const a226_0x18565a=a226_0x12b5;(function(_0x450efd,_0x2bf0a6){const _0x2fbc84=a226_0x12b5,_0x4aa401=_0x450efd();while(!![]){try{const _0x3ce002=parseInt(_0x2fbc84(0xc6))/0x1*(-parseInt(_0x2fbc84(0xc9))/0x2)+parseInt(_0x2fbc84(0xdd))/0x3*(-parseInt(_0x2fbc84(0xe4))/0x4)+-parseInt(_0x2fbc84(0xb4))/0x5+parseInt(_0x2fbc84(0xa2))/0x6+-parseInt(_0x2fbc84(0xde))/0x7+-parseInt(_0x2fbc84(0xa7))/0x8+parseInt(_0x2fbc84(0xce))/0x9;if(_0x3ce002===_0x2bf0a6)break;else _0x4aa401['push'](_0x4aa401['shift']());}catch(_0x217def){_0x4aa401['push'](_0x4aa401['shift']());}}}(a226_0x5d23,0xbc8ab));const a226_0x5aa796=(function(){let _0x5210c7=!![];return function(_0x20a3fb,_0x3e140d){const _0x2712c3=_0x5210c7?function(){if(_0x3e140d){const _0x541cff=_0x3e140d['apply'](_0x20a3fb,arguments);return _0x3e140d=null,_0x541cff;}}:function(){};return _0x5210c7=![],_0x2712c3;};}()),a226_0x4d732a=a226_0x5aa796(this,function(){const _0x2fc138=a226_0x12b5;return a226_0x4d732a['toString']()[_0x2fc138(0xab)]('(((.+)+)+)+$')['toString']()['constructor'](a226_0x4d732a)['search'](_0x2fc138(0xbc));});function a226_0x12b5(_0x1e811c,_0x1a2c97){const _0x302b10=a226_0x5d23();return a226_0x12b5=function(_0x4d732a,_0x5aa796){_0x4d732a=_0x4d732a-0x9e;let _0x5d23a4=_0x302b10[_0x4d732a];return _0x5d23a4;},a226_0x12b5(_0x1e811c,_0x1a2c97);}function a226_0x5d23(){const _0x515d57=['access_token','then','ERR_INVALID_SALESFORCE_TOKEN','__setModuleDefault','refresh_token','4468370WDAuad','message','setAuthDetails','Error','design:paramtypes','services/data/','AUTH_WAIT_TIME','getOwnPropertyDescriptor','(((.+)+)+)+$','Tokens','metadata','../../../../core','SALESFORCE_API_VERSION','InvalidRefreshTokenError','__metadata','hasOwnProperty','instanceUrl','log','881vlQxGR','response','updateAccessToken','3422YxGcVT','../../../../constants','Active','defineProperty','../../../shared/utils','48602313AQxrBX','length','forceUpdateToken','name','decorate','post','writable','get','data','../errors/invalid-refresh-token.error','waitAuth','axios','Idle','tokenType','logger','849YGtrjk','6471325MwbJRM','../errors/unauthorized-salesforce.error','token_type','getAuthData','UnauthorizedSalesforceError','__decorate','15832YLzMio','typedi','orgId','access\x20token\x20updated\x20for\x20%s','instance_url','create','update\x20access\x20token','AuthState','application/json','call','requestConfig','check\x20auth:\x20current\x20state\x20-\x20%s','/services/oauth2/token','function','SalesforceAuthService','authState','Updating','error','3652446xbqhxh','object','Logger','__esModule','default','6328616Sgihfh','__importDefault','__importStar','../../providers/providers.tokens','search','accessToken','sleep','configurable'];a226_0x5d23=function(){return _0x515d57;};return a226_0x5d23();}a226_0x4d732a();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a226_0x18565a(0xe9)]?function(_0x1d7879,_0x417cfb,_0x54b47f,_0x51cfef){const _0x1af1f2=a226_0x18565a;if(_0x51cfef===undefined)_0x51cfef=_0x54b47f;var _0x575df5=Object[_0x1af1f2(0xbb)](_0x417cfb,_0x54b47f);(!_0x575df5||('get'in _0x575df5?!_0x417cfb[_0x1af1f2(0xa5)]:_0x575df5[_0x1af1f2(0xd4)]||_0x575df5[_0x1af1f2(0xae)]))&&(_0x575df5={'enumerable':!![],'get':function(){return _0x417cfb[_0x54b47f];}}),Object[_0x1af1f2(0xcc)](_0x1d7879,_0x51cfef,_0x575df5);}:function(_0x2af76d,_0x5bc3f7,_0x53b8e9,_0x1f79fe){if(_0x1f79fe===undefined)_0x1f79fe=_0x53b8e9;_0x2af76d[_0x1f79fe]=_0x5bc3f7[_0x53b8e9];}),__setModuleDefault=this&&this[a226_0x18565a(0xb2)]||(Object['create']?function(_0x4af977,_0x41b3f9){const _0x4f9b24=a226_0x18565a;Object[_0x4f9b24(0xcc)](_0x4af977,_0x4f9b24(0xa6),{'enumerable':!![],'value':_0x41b3f9});}:function(_0x4a2bc0,_0x17ef3a){const _0x5388df=a226_0x18565a;_0x4a2bc0[_0x5388df(0xa6)]=_0x17ef3a;}),__decorate=this&&this[a226_0x18565a(0xe3)]||function(_0x3da6d5,_0x40adcd,_0x34d9e4,_0x32e627){const _0x540ecb=a226_0x18565a;var _0x370109=arguments[_0x540ecb(0xcf)],_0x40f766=_0x370109<0x3?_0x40adcd:_0x32e627===null?_0x32e627=Object[_0x540ecb(0xbb)](_0x40adcd,_0x34d9e4):_0x32e627,_0x42bebd;if(typeof Reflect==='object'&&typeof Reflect[_0x540ecb(0xd2)]===_0x540ecb(0xf1))_0x40f766=Reflect[_0x540ecb(0xd2)](_0x3da6d5,_0x40adcd,_0x34d9e4,_0x32e627);else{for(var _0x583b83=_0x3da6d5[_0x540ecb(0xcf)]-0x1;_0x583b83>=0x0;_0x583b83--)if(_0x42bebd=_0x3da6d5[_0x583b83])_0x40f766=(_0x370109<0x3?_0x42bebd(_0x40f766):_0x370109>0x3?_0x42bebd(_0x40adcd,_0x34d9e4,_0x40f766):_0x42bebd(_0x40adcd,_0x34d9e4))||_0x40f766;}return _0x370109>0x3&&_0x40f766&&Object[_0x540ecb(0xcc)](_0x40adcd,_0x34d9e4,_0x40f766),_0x40f766;},__importStar=this&&this[a226_0x18565a(0xa9)]||function(_0x1c54b8){const _0x14cd25=a226_0x18565a;if(_0x1c54b8&&_0x1c54b8[_0x14cd25(0xa5)])return _0x1c54b8;var _0x17057d={};if(_0x1c54b8!=null){for(var _0x3079ad in _0x1c54b8)if(_0x3079ad!=='default'&&Object['prototype'][_0x14cd25(0xc3)][_0x14cd25(0xed)](_0x1c54b8,_0x3079ad))__createBinding(_0x17057d,_0x1c54b8,_0x3079ad);}return __setModuleDefault(_0x17057d,_0x1c54b8),_0x17057d;},__metadata=this&&this[a226_0x18565a(0xc2)]||function(_0x2a4950,_0x4be1b2){const _0x5490c0=a226_0x18565a;if(typeof Reflect===_0x5490c0(0xa3)&&typeof Reflect[_0x5490c0(0xbe)]===_0x5490c0(0xf1))return Reflect[_0x5490c0(0xbe)](_0x2a4950,_0x4be1b2);},__importDefault=this&&this[a226_0x18565a(0xa8)]||function(_0x234d4b){const _0x5ae1f5=a226_0x18565a;return _0x234d4b&&_0x234d4b[_0x5ae1f5(0xa5)]?_0x234d4b:{'default':_0x234d4b};},SalesforceAuthService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a226_0x18565a(0x9e)]=void 0x0;const typedi_1=__importStar(require(a226_0x18565a(0xe5))),errors_1=require('../../../../constants/errors'),core_1=require(a226_0x18565a(0xbf)),axios_1=__importDefault(require(a226_0x18565a(0xd9))),utils_1=require(a226_0x18565a(0xcd)),invalid_refresh_token_error_1=require(a226_0x18565a(0xd7)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a226_0x18565a(0xdf)),constants_1=require(a226_0x18565a(0xca)),providers_tokens_1=require(a226_0x18565a(0xaa));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x1ab257=a226_0x18565a;this['AUTH_WAIT_TIME']=0x1388,this[_0x1ab257(0x9f)]=auth_state_enum_1[_0x1ab257(0xeb)]['Idle'],this[_0x1ab257(0xdc)]=new core_1[(_0x1ab257(0xa4))](SalesforceAuthService_1[_0x1ab257(0xd1)]),this[_0x1ab257(0xb6)]();}async[a226_0x18565a(0xb6)](){const _0x503139=a226_0x18565a;this[_0x503139(0xdc)]['log'](_0x503139(0xef),auth_state_enum_1['AuthState'][this[_0x503139(0x9f)]]);try{if(this[_0x503139(0x9f)]===auth_state_enum_1['AuthState']['Error'])return;if(this[_0x503139(0x9f)]===auth_state_enum_1[_0x503139(0xeb)]['Idle'])await this[_0x503139(0xc8)]();else{const _0x41fef7=await this[_0x503139(0xee)](),_0x4dbf9d=await axios_1[_0x503139(0xa6)][_0x503139(0xd5)](_0x503139(0xb9)+constants_1[_0x503139(0xc0)],_0x41fef7)[_0x503139(0xb0)](()=>!![])['catch'](()=>![]);!_0x4dbf9d&&await this[_0x503139(0xc8)]();}}catch(_0x13e908){}}async['updateAccessToken'](){const _0x20dbf7=a226_0x18565a;var _0xa6a1d3,_0x180619,_0xe8c5f5;this[_0x20dbf7(0xdc)][_0x20dbf7(0xc5)](_0x20dbf7(0xea));try{this[_0x20dbf7(0x9f)]=auth_state_enum_1[_0x20dbf7(0xeb)]['Updating'];const {refreshToken:_0x3508a3,clientId:_0x260a5b,clientSecret:_0x45bf6e,loginUrl:_0x1a9aa4}=typedi_1[_0x20dbf7(0xa6)][_0x20dbf7(0xd5)](providers_tokens_1[_0x20dbf7(0xbd)]['salesforce']),{data:_0x1f3895}=await axios_1[_0x20dbf7(0xa6)][_0x20dbf7(0xd3)]((0x0,utils_1['joinURL'])(_0x1a9aa4,_0x20dbf7(0xf0)),null,{'params':{'grant_type':_0x20dbf7(0xb3),'refresh_token':_0x3508a3,'client_id':_0x260a5b,'client_secret':_0x45bf6e}});this[_0x20dbf7(0xc4)]=_0x1f3895[_0x20dbf7(0xe8)],this[_0x20dbf7(0xac)]=_0x1f3895[_0x20dbf7(0xaf)],this[_0x20dbf7(0xdb)]=_0x1f3895[_0x20dbf7(0xe0)],this[_0x20dbf7(0x9f)]=auth_state_enum_1[_0x20dbf7(0xeb)]['Active'],this[_0x20dbf7(0xdc)][_0x20dbf7(0xc5)](_0x20dbf7(0xe7),this[_0x20dbf7(0xc4)]);}catch(_0xb15c6f){const _0x303ffa=((_0x180619=(_0xa6a1d3=_0xb15c6f===null||_0xb15c6f===void 0x0?void 0x0:_0xb15c6f[_0x20dbf7(0xc7)])===null||_0xa6a1d3===void 0x0?void 0x0:_0xa6a1d3[_0x20dbf7(0xd6)])===null||_0x180619===void 0x0?void 0x0:_0x180619[_0x20dbf7(0xa1)])||((_0xe8c5f5=_0xb15c6f===null||_0xb15c6f===void 0x0?void 0x0:_0xb15c6f[_0x20dbf7(0xc7)])===null||_0xe8c5f5===void 0x0?void 0x0:_0xe8c5f5[_0x20dbf7(0xd6)])||_0xb15c6f[_0x20dbf7(0xb5)];this[_0x20dbf7(0xdc)]['error']('update\x20access\x20token\x20failed:\x20%s',_0x303ffa),this['authState']=auth_state_enum_1[_0x20dbf7(0xeb)][_0x20dbf7(0xb7)];throw new invalid_refresh_token_error_1[(_0x20dbf7(0xc1))](errors_1[_0x20dbf7(0xb1)]);}}async[a226_0x18565a(0xd0)](){const _0x97e386=a226_0x18565a;this[_0x97e386(0xdc)][_0x97e386(0xc5)]('force\x20update\x20token');if(this[_0x97e386(0x9f)]===auth_state_enum_1[_0x97e386(0xeb)][_0x97e386(0xa0)]||this[_0x97e386(0x9f)]===auth_state_enum_1['AuthState'][_0x97e386(0xda)])return await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this[_0x97e386(0xd0)]();if(this['authState']===auth_state_enum_1[_0x97e386(0xeb)][_0x97e386(0xb7)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x97e386(0xb1)]);await this[_0x97e386(0xc8)]();}async['waitAuth'](){const _0x5f265d=a226_0x18565a;if(this[_0x5f265d(0x9f)]===auth_state_enum_1[_0x5f265d(0xeb)][_0x5f265d(0xb7)]){this[_0x5f265d(0xdc)][_0x5f265d(0xc5)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x5f265d(0xe2))]();}if(this[_0x5f265d(0x9f)]!==auth_state_enum_1[_0x5f265d(0xeb)][_0x5f265d(0xcb)])return this[_0x5f265d(0xdc)]['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x5f265d(0xad)])(this[_0x5f265d(0xba)]),this[_0x5f265d(0xd8)]();}[a226_0x18565a(0xe1)](){const _0x4e508e=a226_0x18565a;return{'orgId':this[_0x4e508e(0xe6)],'accessToken':this[_0x4e508e(0xac)],'instanceUrl':this[_0x4e508e(0xc4)]};}async[a226_0x18565a(0xee)](){const _0x26b3be=a226_0x18565a;return await this[_0x26b3be(0xd8)](),{'baseURL':this[_0x26b3be(0xc4)],'headers':{'accept':_0x26b3be(0xec),'authorization':this[_0x26b3be(0xdb)]+'\x20'+this[_0x26b3be(0xac)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a226_0x18565a(0xb8),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;