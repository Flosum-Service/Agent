const a232_0x592938=a232_0x3660;(function(_0x4ac269,_0x313aa5){const _0x115e91=a232_0x3660,_0x45909d=_0x4ac269();while(!![]){try{const _0x42a70e=-parseInt(_0x115e91(0xf5))/0x1*(-parseInt(_0x115e91(0xf9))/0x2)+-parseInt(_0x115e91(0x136))/0x3*(parseInt(_0x115e91(0x12f))/0x4)+-parseInt(_0x115e91(0x13a))/0x5*(parseInt(_0x115e91(0x141))/0x6)+parseInt(_0x115e91(0xf6))/0x7+-parseInt(_0x115e91(0x12e))/0x8*(-parseInt(_0x115e91(0x12c))/0x9)+parseInt(_0x115e91(0x120))/0xa+-parseInt(_0x115e91(0xfe))/0xb;if(_0x42a70e===_0x313aa5)break;else _0x45909d['push'](_0x45909d['shift']());}catch(_0x341bec){_0x45909d['push'](_0x45909d['shift']());}}}(a232_0x5a75,0x83707));function a232_0x3660(_0x418437,_0x4c0c59){const _0x38bf05=a232_0x5a75();return a232_0x3660=function(_0x256781,_0xe21e80){_0x256781=_0x256781-0xf0;let _0x5a7527=_0x38bf05[_0x256781];return _0x5a7527;},a232_0x3660(_0x418437,_0x4c0c59);}const a232_0xe21e80=(function(){let _0x5ac901=!![];return function(_0x3deae6,_0x5123c5){const _0x53dea7=_0x5ac901?function(){const _0x554a65=a232_0x3660;if(_0x5123c5){const _0x3eae7d=_0x5123c5[_0x554a65(0x140)](_0x3deae6,arguments);return _0x5123c5=null,_0x3eae7d;}}:function(){};return _0x5ac901=![],_0x53dea7;};}()),a232_0x256781=a232_0xe21e80(this,function(){const _0x537785=a232_0x3660;return a232_0x256781['toString']()['search'](_0x537785(0x117))[_0x537785(0x13f)]()[_0x537785(0x10d)](a232_0x256781)['search']('(((.+)+)+)+$');});a232_0x256781();'use strict';var __createBinding=this&&this[a232_0x592938(0x116)]||(Object[a232_0x592938(0x10e)]?function(_0x4f9f21,_0x40ca3a,_0x3e609a,_0x513985){const _0x5a70df=a232_0x592938;if(_0x513985===undefined)_0x513985=_0x3e609a;var _0x18b9a1=Object[_0x5a70df(0x109)](_0x40ca3a,_0x3e609a);(!_0x18b9a1||(_0x5a70df(0xf0)in _0x18b9a1?!_0x40ca3a['__esModule']:_0x18b9a1[_0x5a70df(0x126)]||_0x18b9a1[_0x5a70df(0x102)]))&&(_0x18b9a1={'enumerable':!![],'get':function(){return _0x40ca3a[_0x3e609a];}}),Object[_0x5a70df(0x118)](_0x4f9f21,_0x513985,_0x18b9a1);}:function(_0x116645,_0x4dc708,_0x3223f4,_0x38f641){if(_0x38f641===undefined)_0x38f641=_0x3223f4;_0x116645[_0x38f641]=_0x4dc708[_0x3223f4];}),__setModuleDefault=this&&this[a232_0x592938(0x139)]||(Object['create']?function(_0x3571b0,_0x5d3731){const _0x538f22=a232_0x592938;Object['defineProperty'](_0x3571b0,_0x538f22(0x129),{'enumerable':!![],'value':_0x5d3731});}:function(_0x5e4daa,_0x5bec32){const _0xd5c14f=a232_0x592938;_0x5e4daa[_0xd5c14f(0x129)]=_0x5bec32;}),__decorate=this&&this[a232_0x592938(0x125)]||function(_0x59b05d,_0x3f85a4,_0x22d2ab,_0x56e5e6){const _0x39b612=a232_0x592938;var _0x3da171=arguments['length'],_0x4d1d78=_0x3da171<0x3?_0x3f85a4:_0x56e5e6===null?_0x56e5e6=Object['getOwnPropertyDescriptor'](_0x3f85a4,_0x22d2ab):_0x56e5e6,_0xdde18b;if(typeof Reflect==='object'&&typeof Reflect[_0x39b612(0xf2)]===_0x39b612(0xf7))_0x4d1d78=Reflect[_0x39b612(0xf2)](_0x59b05d,_0x3f85a4,_0x22d2ab,_0x56e5e6);else{for(var _0x377971=_0x59b05d['length']-0x1;_0x377971>=0x0;_0x377971--)if(_0xdde18b=_0x59b05d[_0x377971])_0x4d1d78=(_0x3da171<0x3?_0xdde18b(_0x4d1d78):_0x3da171>0x3?_0xdde18b(_0x3f85a4,_0x22d2ab,_0x4d1d78):_0xdde18b(_0x3f85a4,_0x22d2ab))||_0x4d1d78;}return _0x3da171>0x3&&_0x4d1d78&&Object['defineProperty'](_0x3f85a4,_0x22d2ab,_0x4d1d78),_0x4d1d78;},__importStar=this&&this[a232_0x592938(0x11d)]||function(_0x33ccb1){const _0xf6748d=a232_0x592938;if(_0x33ccb1&&_0x33ccb1[_0xf6748d(0x10b)])return _0x33ccb1;var _0x287d94={};if(_0x33ccb1!=null){for(var _0x47eba1 in _0x33ccb1)if(_0x47eba1!==_0xf6748d(0x129)&&Object[_0xf6748d(0x114)]['hasOwnProperty']['call'](_0x33ccb1,_0x47eba1))__createBinding(_0x287d94,_0x33ccb1,_0x47eba1);}return __setModuleDefault(_0x287d94,_0x33ccb1),_0x287d94;},__metadata=this&&this['__metadata']||function(_0x820aad,_0x109533){const _0x3cf6cd=a232_0x592938;if(typeof Reflect==='object'&&typeof Reflect[_0x3cf6cd(0x111)]===_0x3cf6cd(0xf7))return Reflect[_0x3cf6cd(0x111)](_0x820aad,_0x109533);},__importDefault=this&&this[a232_0x592938(0x138)]||function(_0x58b8bf){const _0x188dc9=a232_0x592938;return _0x58b8bf&&_0x58b8bf[_0x188dc9(0x10b)]?_0x58b8bf:{'default':_0x58b8bf};},SalesforceAuthService_1;Object[a232_0x592938(0x118)](exports,a232_0x592938(0x10b),{'value':!![]}),exports[a232_0x592938(0xfc)]=void 0x0;function a232_0x5a75(){const _0xdd8d71=['logger','UnauthorizedSalesforceError','1JGFwJu','2125109jUslMq','function','services/data/','1918302FXeJhO','Logger','Idle','SalesforceAuthService','tokenType','8303009WetXZi','axios','setAuthDetails','sleep','configurable','authState','Service','Tokens','../../../../core','/services/oauth2/token','Active','getOwnPropertyDescriptor','token_type','__esModule','update\x20access\x20token','constructor','create','log','../../providers/providers.tokens','metadata','force\x20update\x20token','../errors/invalid-refresh-token.error','prototype','instanceUrl','__createBinding','(((.+)+)+)+$','defineProperty','error','Updating','access\x20token\x20updated\x20for\x20%s','forceUpdateToken','__importStar','then','waitAuth','6205170otAysZ','../enums/auth-state.enum','instance_url','salesforce','message','__decorate','writable','../../../../constants/errors','AuthState','default','name','data','4545NaZHZR','update\x20access\x20token\x20failed:\x20%s','808mAGlxC','4RiYcHR','../../../../constants','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','joinURL','accessToken','design:paramtypes','getAuthData','363795xXRSaR','requestConfig','__importDefault','__setModuleDefault','5dkmdmo','check\x20auth:\x20current\x20state\x20-\x20%s','Error','AUTH_WAIT_TIME','ERR_INVALID_SALESFORCE_TOKEN','toString','apply','3118806TPnhmb','get','updateAccessToken','decorate'];a232_0x5a75=function(){return _0xdd8d71;};return a232_0x5a75();}const typedi_1=__importStar(require('typedi')),errors_1=require(a232_0x592938(0x127)),core_1=require(a232_0x592938(0x106)),axios_1=__importDefault(require(a232_0x592938(0xff))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a232_0x592938(0x113)),auth_state_enum_1=require(a232_0x592938(0x121)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a232_0x592938(0x130)),providers_tokens_1=require(a232_0x592938(0x110));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x330666=a232_0x592938;this['AUTH_WAIT_TIME']=0x1388,this[_0x330666(0x103)]=auth_state_enum_1[_0x330666(0x128)]['Idle'],this[_0x330666(0xf3)]=new core_1[(_0x330666(0xfa))](SalesforceAuthService_1[_0x330666(0x12a)]),this['setAuthDetails']();}async[a232_0x592938(0x100)](){const _0x13c685=a232_0x592938;this[_0x13c685(0xf3)][_0x13c685(0x10f)](_0x13c685(0x13b),auth_state_enum_1[_0x13c685(0x128)][this['authState']]);try{if(this[_0x13c685(0x103)]===auth_state_enum_1[_0x13c685(0x128)][_0x13c685(0x13c)])return;if(this[_0x13c685(0x103)]===auth_state_enum_1[_0x13c685(0x128)][_0x13c685(0xfb)])await this['updateAccessToken']();else{const _0x30ae1a=await this['requestConfig'](),_0x53c696=await axios_1[_0x13c685(0x129)]['get'](_0x13c685(0xf8)+constants_1['SALESFORCE_API_VERSION'],_0x30ae1a)[_0x13c685(0x11e)](()=>!![])['catch'](()=>![]);!_0x53c696&&await this['updateAccessToken']();}}catch(_0x1077e7){}}async[a232_0x592938(0xf1)](){const _0x3924fa=a232_0x592938;var _0x14ebd8,_0x45e9c5,_0x2f6bd6;this['logger'][_0x3924fa(0x10f)](_0x3924fa(0x10c));try{this['authState']=auth_state_enum_1[_0x3924fa(0x128)][_0x3924fa(0x11a)];const {refreshToken:_0x357c0c,clientId:_0x48ab42,clientSecret:_0x511f34,loginUrl:_0x5174e6}=typedi_1[_0x3924fa(0x129)]['get'](providers_tokens_1[_0x3924fa(0x105)][_0x3924fa(0x123)]),{data:_0x3b9db0}=await axios_1[_0x3924fa(0x129)]['post']((0x0,utils_1[_0x3924fa(0x132)])(_0x5174e6,_0x3924fa(0x107)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x357c0c,'client_id':_0x48ab42,'client_secret':_0x511f34}});this['instanceUrl']=_0x3b9db0[_0x3924fa(0x122)],this[_0x3924fa(0x133)]=_0x3b9db0['access_token'],this[_0x3924fa(0xfd)]=_0x3b9db0[_0x3924fa(0x10a)],this[_0x3924fa(0x103)]=auth_state_enum_1[_0x3924fa(0x128)][_0x3924fa(0x108)],this[_0x3924fa(0xf3)]['log'](_0x3924fa(0x11b),this['instanceUrl']);}catch(_0x4726b8){const _0x532d28=((_0x45e9c5=(_0x14ebd8=_0x4726b8===null||_0x4726b8===void 0x0?void 0x0:_0x4726b8['response'])===null||_0x14ebd8===void 0x0?void 0x0:_0x14ebd8[_0x3924fa(0x12b)])===null||_0x45e9c5===void 0x0?void 0x0:_0x45e9c5['error'])||((_0x2f6bd6=_0x4726b8===null||_0x4726b8===void 0x0?void 0x0:_0x4726b8['response'])===null||_0x2f6bd6===void 0x0?void 0x0:_0x2f6bd6[_0x3924fa(0x12b)])||_0x4726b8[_0x3924fa(0x124)];this[_0x3924fa(0xf3)][_0x3924fa(0x119)](_0x3924fa(0x12d),_0x532d28),this[_0x3924fa(0x103)]=auth_state_enum_1[_0x3924fa(0x128)][_0x3924fa(0x13c)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x1cc520=a232_0x592938;this[_0x1cc520(0xf3)][_0x1cc520(0x10f)](_0x1cc520(0x112));if(this[_0x1cc520(0x103)]===auth_state_enum_1['AuthState']['Updating']||this[_0x1cc520(0x103)]===auth_state_enum_1[_0x1cc520(0x128)]['Idle'])return await(0x0,utils_1[_0x1cc520(0x101)])(this[_0x1cc520(0x13d)]),this[_0x1cc520(0x11c)]();if(this[_0x1cc520(0x103)]===auth_state_enum_1[_0x1cc520(0x128)][_0x1cc520(0x13c)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x1cc520(0x13e)]);await this[_0x1cc520(0xf1)]();}async[a232_0x592938(0x11f)](){const _0x423332=a232_0x592938;if(this[_0x423332(0x103)]===auth_state_enum_1['AuthState']['Error']){this[_0x423332(0xf3)][_0x423332(0x10f)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x423332(0xf4))]();}if(this[_0x423332(0x103)]!==auth_state_enum_1[_0x423332(0x128)][_0x423332(0x108)])return this[_0x423332(0xf3)]['log'](_0x423332(0x131)),await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this[_0x423332(0x11f)]();}[a232_0x592938(0x135)](){const _0x2a0066=a232_0x592938;return{'orgId':this['orgId'],'accessToken':this[_0x2a0066(0x133)],'instanceUrl':this[_0x2a0066(0x115)]};}async[a232_0x592938(0x137)](){const _0x4a7872=a232_0x592938;return await this[_0x4a7872(0x11f)](),{'baseURL':this['instanceUrl'],'headers':{'accept':'application/json','authorization':this[_0x4a7872(0xfd)]+'\x20'+this[_0x4a7872(0x133)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a232_0x592938(0x104)])(),__metadata(a232_0x592938(0x134),[])],SalesforceAuthService),exports[a232_0x592938(0xfc)]=SalesforceAuthService;