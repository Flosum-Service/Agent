const a193_0x3af930=a193_0x1879;(function(_0x317d28,_0x30aad2){const _0x1049c2=a193_0x1879,_0x2352f2=_0x317d28();while(!![]){try{const _0x3970b5=-parseInt(_0x1049c2(0xa3))/0x1*(parseInt(_0x1049c2(0x9e))/0x2)+-parseInt(_0x1049c2(0x9f))/0x3*(parseInt(_0x1049c2(0x82))/0x4)+-parseInt(_0x1049c2(0x78))/0x5*(parseInt(_0x1049c2(0x8c))/0x6)+-parseInt(_0x1049c2(0x73))/0x7+parseInt(_0x1049c2(0x9a))/0x8*(parseInt(_0x1049c2(0x8f))/0x9)+parseInt(_0x1049c2(0xb7))/0xa+parseInt(_0x1049c2(0x98))/0xb;if(_0x3970b5===_0x30aad2)break;else _0x2352f2['push'](_0x2352f2['shift']());}catch(_0x4f34dd){_0x2352f2['push'](_0x2352f2['shift']());}}}(a193_0x1123,0xeba6a));const a193_0x59dc6f=(function(){let _0x30ff9b=!![];return function(_0x174ac7,_0xe12925){const _0x34b057=_0x30ff9b?function(){const _0x37516e=a193_0x1879;if(_0xe12925){const _0x10226d=_0xe12925[_0x37516e(0x6e)](_0x174ac7,arguments);return _0xe12925=null,_0x10226d;}}:function(){};return _0x30ff9b=![],_0x34b057;};}()),a193_0x1a52fd=a193_0x59dc6f(this,function(){const _0x2c8c15=a193_0x1879;return a193_0x1a52fd[_0x2c8c15(0x74)]()[_0x2c8c15(0xb8)](_0x2c8c15(0x81))['toString']()['constructor'](a193_0x1a52fd)[_0x2c8c15(0xb8)](_0x2c8c15(0x81));});a193_0x1a52fd();function a193_0x1879(_0x2d44b8,_0x5389e0){const _0xeae37b=a193_0x1123();return a193_0x1879=function(_0x1a52fd,_0x59dc6f){_0x1a52fd=_0x1a52fd-0x67;let _0x1123e9=_0xeae37b[_0x1a52fd];return _0x1123e9;},a193_0x1879(_0x2d44b8,_0x5389e0);}'use strict';function a193_0x1123(){const _0x1a8834=['8468qmEFdG','1593609QiUBGC','function','token_type','accessToken','242JPKUDy','__importDefault','create','../errors/unauthorized-salesforce.error','name','message','getAuthData','Active','metadata','AUTH_WAIT_TIME','authState','__esModule','Error','error','hasOwnProperty','then','InvalidRefreshTokenError','../enums/auth-state.enum','data','updateAccessToken','1722610PijweR','search','Service','SALESFORCE_API_VERSION','__importStar','__metadata','Updating','axios','logger','post','requestConfig','../../../../constants','instanceUrl','defineProperty','waitAuth','apply','UnauthorizedSalesforceError','joinURL','../errors/invalid-refresh-token.error','__createBinding','12174834cTuQzJ','toString','ERR_INVALID_SALESFORCE_TOKEN','SalesforceAuthService','../../../../constants/errors','1005180vpurkr','getOwnPropertyDescriptor','forceUpdateToken','sleep','Idle','AuthState','prototype','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','tokenType','(((.+)+)+)+$','4QkJvkv','/services/oauth2/token','get','writable','log','orgId','call','update\x20access\x20token','decorate','design:paramtypes','36McMGhQ','create\x20authorized\x20request\x20failed:\x20authorization\x20error','typedi','9lcdbDf','length','Logger','../../../shared/utils','object','services/data/','configurable','__decorate','../../providers/providers.tokens','52512603xINONo','response','4163208VpCPFB','default','check\x20auth:\x20current\x20state\x20-\x20%s','../../../../core'];a193_0x1123=function(){return _0x1a8834;};return a193_0x1123();}var __createBinding=this&&this[a193_0x3af930(0x72)]||(Object['create']?function(_0x46e105,_0x163023,_0x4cd599,_0x5cc17c){const _0x450c16=a193_0x3af930;if(_0x5cc17c===undefined)_0x5cc17c=_0x4cd599;var _0x36fdc9=Object[_0x450c16(0x79)](_0x163023,_0x4cd599);(!_0x36fdc9||(_0x450c16(0x84)in _0x36fdc9?!_0x163023[_0x450c16(0xae)]:_0x36fdc9[_0x450c16(0x85)]||_0x36fdc9[_0x450c16(0x95)]))&&(_0x36fdc9={'enumerable':!![],'get':function(){return _0x163023[_0x4cd599];}}),Object[_0x450c16(0x6c)](_0x46e105,_0x5cc17c,_0x36fdc9);}:function(_0x6939a4,_0x21bf34,_0x14fea2,_0x31a39b){if(_0x31a39b===undefined)_0x31a39b=_0x14fea2;_0x6939a4[_0x31a39b]=_0x21bf34[_0x14fea2];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a193_0x3af930(0xa5)]?function(_0x36740e,_0x79a1e5){const _0x340c39=a193_0x3af930;Object[_0x340c39(0x6c)](_0x36740e,'default',{'enumerable':!![],'value':_0x79a1e5});}:function(_0x2faacd,_0x15afd5){const _0x1149ff=a193_0x3af930;_0x2faacd[_0x1149ff(0x9b)]=_0x15afd5;}),__decorate=this&&this[a193_0x3af930(0x96)]||function(_0x291226,_0x2e7774,_0x1800dc,_0x368cbd){const _0x3967f9=a193_0x3af930;var _0xe7596c=arguments[_0x3967f9(0x90)],_0x55b914=_0xe7596c<0x3?_0x2e7774:_0x368cbd===null?_0x368cbd=Object['getOwnPropertyDescriptor'](_0x2e7774,_0x1800dc):_0x368cbd,_0x3bd11d;if(typeof Reflect===_0x3967f9(0x93)&&typeof Reflect[_0x3967f9(0x8a)]==='function')_0x55b914=Reflect[_0x3967f9(0x8a)](_0x291226,_0x2e7774,_0x1800dc,_0x368cbd);else{for(var _0x161a14=_0x291226[_0x3967f9(0x90)]-0x1;_0x161a14>=0x0;_0x161a14--)if(_0x3bd11d=_0x291226[_0x161a14])_0x55b914=(_0xe7596c<0x3?_0x3bd11d(_0x55b914):_0xe7596c>0x3?_0x3bd11d(_0x2e7774,_0x1800dc,_0x55b914):_0x3bd11d(_0x2e7774,_0x1800dc))||_0x55b914;}return _0xe7596c>0x3&&_0x55b914&&Object[_0x3967f9(0x6c)](_0x2e7774,_0x1800dc,_0x55b914),_0x55b914;},__importStar=this&&this[a193_0x3af930(0xbb)]||function(_0x5f09d1){const _0x11a114=a193_0x3af930;if(_0x5f09d1&&_0x5f09d1['__esModule'])return _0x5f09d1;var _0x3f38dd={};if(_0x5f09d1!=null){for(var _0x4211f6 in _0x5f09d1)if(_0x4211f6!==_0x11a114(0x9b)&&Object[_0x11a114(0x7e)][_0x11a114(0xb1)][_0x11a114(0x88)](_0x5f09d1,_0x4211f6))__createBinding(_0x3f38dd,_0x5f09d1,_0x4211f6);}return __setModuleDefault(_0x3f38dd,_0x5f09d1),_0x3f38dd;},__metadata=this&&this[a193_0x3af930(0xbc)]||function(_0x2a48c2,_0x482880){const _0x181112=a193_0x3af930;if(typeof Reflect===_0x181112(0x93)&&typeof Reflect[_0x181112(0xab)]===_0x181112(0xa0))return Reflect['metadata'](_0x2a48c2,_0x482880);},__importDefault=this&&this[a193_0x3af930(0xa4)]||function(_0x213159){const _0x3377ae=a193_0x3af930;return _0x213159&&_0x213159[_0x3377ae(0xae)]?_0x213159:{'default':_0x213159};},SalesforceAuthService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a193_0x3af930(0x76)]=void 0x0;const typedi_1=__importStar(require(a193_0x3af930(0x8e))),errors_1=require(a193_0x3af930(0x77)),core_1=require(a193_0x3af930(0x9d)),axios_1=__importDefault(require(a193_0x3af930(0xbe))),utils_1=require(a193_0x3af930(0x92)),invalid_refresh_token_error_1=require(a193_0x3af930(0x71)),auth_state_enum_1=require(a193_0x3af930(0xb4)),unauthorized_salesforce_error_1=require(a193_0x3af930(0xa6)),constants_1=require(a193_0x3af930(0x6a)),providers_tokens_1=require(a193_0x3af930(0x97));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x5ddadc=a193_0x3af930;this['AUTH_WAIT_TIME']=0x1388,this['authState']=auth_state_enum_1[_0x5ddadc(0x7d)][_0x5ddadc(0x7c)],this[_0x5ddadc(0x67)]=new core_1[(_0x5ddadc(0x91))](SalesforceAuthService_1[_0x5ddadc(0xa7)]),this['setAuthDetails']();}async['setAuthDetails'](){const _0x536764=a193_0x3af930;this['logger'][_0x536764(0x86)](_0x536764(0x9c),auth_state_enum_1[_0x536764(0x7d)][this['authState']]);try{if(this[_0x536764(0xad)]===auth_state_enum_1['AuthState'][_0x536764(0xaf)])return;if(this['authState']===auth_state_enum_1['AuthState']['Idle'])await this[_0x536764(0xb6)]();else{const _0x13a46d=await this[_0x536764(0x69)](),_0x4cf231=await axios_1[_0x536764(0x9b)][_0x536764(0x84)](_0x536764(0x94)+constants_1[_0x536764(0xba)],_0x13a46d)[_0x536764(0xb2)](()=>!![])['catch'](()=>![]);!_0x4cf231&&await this[_0x536764(0xb6)]();}}catch(_0x2a906d){}}async[a193_0x3af930(0xb6)](){const _0x2b79d9=a193_0x3af930;var _0x3f2c17,_0x46cc77,_0x1f842b;this[_0x2b79d9(0x67)][_0x2b79d9(0x86)](_0x2b79d9(0x89));try{this[_0x2b79d9(0xad)]=auth_state_enum_1[_0x2b79d9(0x7d)]['Updating'];const {refreshToken:_0x53b41e,clientId:_0x1876c0,clientSecret:_0x19a650,loginUrl:_0x3044bd}=typedi_1[_0x2b79d9(0x9b)][_0x2b79d9(0x84)](providers_tokens_1['Tokens']['salesforce']),{data:_0x6f9e2f}=await axios_1['default'][_0x2b79d9(0x68)]((0x0,utils_1[_0x2b79d9(0x70)])(_0x3044bd,_0x2b79d9(0x83)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x53b41e,'client_id':_0x1876c0,'client_secret':_0x19a650}});this['instanceUrl']=_0x6f9e2f['instance_url'],this[_0x2b79d9(0xa2)]=_0x6f9e2f['access_token'],this[_0x2b79d9(0x80)]=_0x6f9e2f[_0x2b79d9(0xa1)],this[_0x2b79d9(0xad)]=auth_state_enum_1[_0x2b79d9(0x7d)][_0x2b79d9(0xaa)],this[_0x2b79d9(0x67)][_0x2b79d9(0x86)]('access\x20token\x20updated\x20for\x20%s',this['instanceUrl']);}catch(_0xaaf838){const _0x37ae75=((_0x46cc77=(_0x3f2c17=_0xaaf838===null||_0xaaf838===void 0x0?void 0x0:_0xaaf838[_0x2b79d9(0x99)])===null||_0x3f2c17===void 0x0?void 0x0:_0x3f2c17['data'])===null||_0x46cc77===void 0x0?void 0x0:_0x46cc77[_0x2b79d9(0xb0)])||((_0x1f842b=_0xaaf838===null||_0xaaf838===void 0x0?void 0x0:_0xaaf838[_0x2b79d9(0x99)])===null||_0x1f842b===void 0x0?void 0x0:_0x1f842b[_0x2b79d9(0xb5)])||_0xaaf838[_0x2b79d9(0xa8)];this[_0x2b79d9(0x67)][_0x2b79d9(0xb0)]('update\x20access\x20token\x20failed:\x20%s',_0x37ae75),this[_0x2b79d9(0xad)]=auth_state_enum_1['AuthState'][_0x2b79d9(0xaf)];throw new invalid_refresh_token_error_1[(_0x2b79d9(0xb3))](errors_1[_0x2b79d9(0x75)]);}}async[a193_0x3af930(0x7a)](){const _0x37de1e=a193_0x3af930;this[_0x37de1e(0x67)][_0x37de1e(0x86)]('force\x20update\x20token');if(this['authState']===auth_state_enum_1['AuthState'][_0x37de1e(0xbd)]||this['authState']===auth_state_enum_1[_0x37de1e(0x7d)]['Idle'])return await(0x0,utils_1[_0x37de1e(0x7b)])(this[_0x37de1e(0xac)]),this[_0x37de1e(0x7a)]();if(this['authState']===auth_state_enum_1[_0x37de1e(0x7d)][_0x37de1e(0xaf)])throw new invalid_refresh_token_error_1[(_0x37de1e(0xb3))](errors_1[_0x37de1e(0x75)]);await this[_0x37de1e(0xb6)]();}async[a193_0x3af930(0x6d)](){const _0x4bb69b=a193_0x3af930;if(this['authState']===auth_state_enum_1[_0x4bb69b(0x7d)]['Error']){this[_0x4bb69b(0x67)][_0x4bb69b(0x86)](_0x4bb69b(0x8d));throw new unauthorized_salesforce_error_1[(_0x4bb69b(0x6f))]();}if(this[_0x4bb69b(0xad)]!==auth_state_enum_1[_0x4bb69b(0x7d)][_0x4bb69b(0xaa)])return this[_0x4bb69b(0x67)][_0x4bb69b(0x86)](_0x4bb69b(0x7f)),await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this['waitAuth']();}[a193_0x3af930(0xa9)](){const _0x3550eb=a193_0x3af930;return{'orgId':this[_0x3550eb(0x87)],'accessToken':this[_0x3550eb(0xa2)],'instanceUrl':this[_0x3550eb(0x6b)]};}async[a193_0x3af930(0x69)](){const _0x4c0b87=a193_0x3af930;return await this[_0x4c0b87(0x6d)](),{'baseURL':this[_0x4c0b87(0x6b)],'headers':{'accept':'application/json','authorization':this[_0x4c0b87(0x80)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a193_0x3af930(0xb9)])(),__metadata(a193_0x3af930(0x8b),[])],SalesforceAuthService),exports[a193_0x3af930(0x76)]=SalesforceAuthService;