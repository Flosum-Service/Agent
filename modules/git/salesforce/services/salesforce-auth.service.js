const a232_0x1be3c2=a232_0xa0bd;function a232_0xa0bd(_0x423084,_0x15edaa){const _0x57ae63=a232_0xf1a4();return a232_0xa0bd=function(_0x42e8a3,_0x440a09){_0x42e8a3=_0x42e8a3-0xb6;let _0xf1a40a=_0x57ae63[_0x42e8a3];return _0xf1a40a;},a232_0xa0bd(_0x423084,_0x15edaa);}(function(_0x59d06c,_0x4c2110){const _0x204053=a232_0xa0bd,_0x3cff15=_0x59d06c();while(!![]){try{const _0x2cf065=parseInt(_0x204053(0xc6))/0x1+-parseInt(_0x204053(0xd9))/0x2+parseInt(_0x204053(0xb6))/0x3*(parseInt(_0x204053(0xe1))/0x4)+-parseInt(_0x204053(0xbf))/0x5+-parseInt(_0x204053(0x107))/0x6+parseInt(_0x204053(0xdb))/0x7*(parseInt(_0x204053(0xe2))/0x8)+parseInt(_0x204053(0xfa))/0x9*(-parseInt(_0x204053(0xf5))/0xa);if(_0x2cf065===_0x4c2110)break;else _0x3cff15['push'](_0x3cff15['shift']());}catch(_0xd985cf){_0x3cff15['push'](_0x3cff15['shift']());}}}(a232_0xf1a4,0x38404));const a232_0x440a09=(function(){let _0x1d5b79=!![];return function(_0x3b72b8,_0x4b7aef){const _0x196671=_0x1d5b79?function(){const _0x55909f=a232_0xa0bd;if(_0x4b7aef){const _0x340825=_0x4b7aef[_0x55909f(0xd6)](_0x3b72b8,arguments);return _0x4b7aef=null,_0x340825;}}:function(){};return _0x1d5b79=![],_0x196671;};}()),a232_0x42e8a3=a232_0x440a09(this,function(){const _0x322aad=a232_0xa0bd;return a232_0x42e8a3[_0x322aad(0xd1)]()[_0x322aad(0x102)](_0x322aad(0xe6))[_0x322aad(0xd1)]()[_0x322aad(0xdc)](a232_0x42e8a3)[_0x322aad(0x102)](_0x322aad(0xe6));});a232_0x42e8a3();'use strict';var __createBinding=this&&this[a232_0x1be3c2(0xfc)]||(Object[a232_0x1be3c2(0xc2)]?function(_0x4519cb,_0x5c6c53,_0xeec6ea,_0xec890d){const _0x42fed7=a232_0x1be3c2;if(_0xec890d===undefined)_0xec890d=_0xeec6ea;var _0xe41489=Object['getOwnPropertyDescriptor'](_0x5c6c53,_0xeec6ea);(!_0xe41489||(_0x42fed7(0x106)in _0xe41489?!_0x5c6c53[_0x42fed7(0xc5)]:_0xe41489[_0x42fed7(0xe9)]||_0xe41489[_0x42fed7(0xff)]))&&(_0xe41489={'enumerable':!![],'get':function(){return _0x5c6c53[_0xeec6ea];}}),Object['defineProperty'](_0x4519cb,_0xec890d,_0xe41489);}:function(_0x179932,_0x498bfc,_0x3b1203,_0x53f36a){if(_0x53f36a===undefined)_0x53f36a=_0x3b1203;_0x179932[_0x53f36a]=_0x498bfc[_0x3b1203];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a232_0x1be3c2(0xc2)]?function(_0x11dc83,_0x17d306){const _0x4730b1=a232_0x1be3c2;Object[_0x4730b1(0xc7)](_0x11dc83,'default',{'enumerable':!![],'value':_0x17d306});}:function(_0x24e0fa,_0x442781){_0x24e0fa['default']=_0x442781;}),__decorate=this&&this[a232_0x1be3c2(0xc8)]||function(_0x5ce240,_0x3772b6,_0x471554,_0x2b4693){const _0x11000c=a232_0x1be3c2;var _0x54bec1=arguments[_0x11000c(0xeb)],_0x2fae35=_0x54bec1<0x3?_0x3772b6:_0x2b4693===null?_0x2b4693=Object['getOwnPropertyDescriptor'](_0x3772b6,_0x471554):_0x2b4693,_0x7b0e55;if(typeof Reflect===_0x11000c(0xc1)&&typeof Reflect[_0x11000c(0xca)]===_0x11000c(0xf6))_0x2fae35=Reflect[_0x11000c(0xca)](_0x5ce240,_0x3772b6,_0x471554,_0x2b4693);else{for(var _0x52aa13=_0x5ce240[_0x11000c(0xeb)]-0x1;_0x52aa13>=0x0;_0x52aa13--)if(_0x7b0e55=_0x5ce240[_0x52aa13])_0x2fae35=(_0x54bec1<0x3?_0x7b0e55(_0x2fae35):_0x54bec1>0x3?_0x7b0e55(_0x3772b6,_0x471554,_0x2fae35):_0x7b0e55(_0x3772b6,_0x471554))||_0x2fae35;}return _0x54bec1>0x3&&_0x2fae35&&Object['defineProperty'](_0x3772b6,_0x471554,_0x2fae35),_0x2fae35;},__importStar=this&&this[a232_0x1be3c2(0xe7)]||function(_0x257660){const _0x36db7a=a232_0x1be3c2;if(_0x257660&&_0x257660['__esModule'])return _0x257660;var _0x5016a9={};if(_0x257660!=null){for(var _0x5cefe9 in _0x257660)if(_0x5cefe9!==_0x36db7a(0xce)&&Object[_0x36db7a(0xdd)][_0x36db7a(0xe4)][_0x36db7a(0xc9)](_0x257660,_0x5cefe9))__createBinding(_0x5016a9,_0x257660,_0x5cefe9);}return __setModuleDefault(_0x5016a9,_0x257660),_0x5016a9;},__metadata=this&&this[a232_0x1be3c2(0xbd)]||function(_0x56f4dd,_0xf5ad4){const _0x528585=a232_0x1be3c2;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x528585(0xf6))return Reflect['metadata'](_0x56f4dd,_0xf5ad4);},__importDefault=this&&this[a232_0x1be3c2(0xfe)]||function(_0x574658){const _0x5e3db5=a232_0x1be3c2;return _0x574658&&_0x574658[_0x5e3db5(0xc5)]?_0x574658:{'default':_0x574658};},SalesforceAuthService_1;Object[a232_0x1be3c2(0xc7)](exports,a232_0x1be3c2(0xc5),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;function a232_0xf1a4(){const _0x22963c=['1841YaqDse','constructor','prototype','access_token','SalesforceAuthService','typedi','412SFiShL','13336aAgbYm','logger','hasOwnProperty','tokenType','(((.+)+)+)+$','__importStar','Tokens','writable','Active','length','catch','services/data/','data','getAuthData','AuthState','../enums/auth-state.enum','AUTH_WAIT_TIME','salesforce','../../../../constants','90jThcPH','function','create\x20authorized\x20request\x20failed:\x20authorization\x20error','instance_url','authState','164259yyyeBn','../errors/unauthorized-salesforce.error','__createBinding','waitAuth','__importDefault','configurable','axios','accessToken','search','../../providers/providers.tokens','log','ERR_INVALID_SALESFORCE_TOKEN','get','595722mZAdGZ','4035pwHtdS','requestConfig','application/json','../errors/invalid-refresh-token.error','update\x20access\x20token','Error','instanceUrl','__metadata','UnauthorizedSalesforceError','1825970kCQrcQ','Updating','object','create','/services/oauth2/token','setAuthDetails','__esModule','449985TvqBxc','defineProperty','__decorate','call','decorate','Idle','forceUpdateToken','sleep','default','../../../../constants/errors','token_type','toString','../../../../core','../../../shared/utils','updateAccessToken','response','apply','access\x20token\x20updated\x20for\x20%s','refresh_token','335594mkosXs','design:paramtypes'];a232_0xf1a4=function(){return _0x22963c;};return a232_0xf1a4();}const typedi_1=__importStar(require(a232_0x1be3c2(0xe0))),errors_1=require(a232_0x1be3c2(0xcf)),core_1=require(a232_0x1be3c2(0xd2)),axios_1=__importDefault(require(a232_0x1be3c2(0x100))),utils_1=require(a232_0x1be3c2(0xd3)),invalid_refresh_token_error_1=require(a232_0x1be3c2(0xb9)),auth_state_enum_1=require(a232_0x1be3c2(0xf1)),unauthorized_salesforce_error_1=require(a232_0x1be3c2(0xfb)),constants_1=require(a232_0x1be3c2(0xf4)),providers_tokens_1=require(a232_0x1be3c2(0x103));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x486dc0=a232_0x1be3c2;this[_0x486dc0(0xf2)]=0x1388,this[_0x486dc0(0xf9)]=auth_state_enum_1['AuthState']['Idle'],this[_0x486dc0(0xe3)]=new core_1['Logger'](SalesforceAuthService_1['name']),this[_0x486dc0(0xc4)]();}async[a232_0x1be3c2(0xc4)](){const _0x5b6020=a232_0x1be3c2;this[_0x5b6020(0xe3)]['log']('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this[_0x5b6020(0xf9)]]);try{if(this[_0x5b6020(0xf9)]===auth_state_enum_1[_0x5b6020(0xf0)][_0x5b6020(0xbb)])return;if(this['authState']===auth_state_enum_1[_0x5b6020(0xf0)]['Idle'])await this[_0x5b6020(0xd4)]();else{const _0x62de22=await this['requestConfig'](),_0xd289ec=await axios_1[_0x5b6020(0xce)]['get'](_0x5b6020(0xed)+constants_1['SALESFORCE_API_VERSION'],_0x62de22)['then'](()=>!![])[_0x5b6020(0xec)](()=>![]);!_0xd289ec&&await this[_0x5b6020(0xd4)]();}}catch(_0x815e69){}}async[a232_0x1be3c2(0xd4)](){const _0x28c8f8=a232_0x1be3c2;var _0x275af6,_0xb43fdc,_0x2c8b4f;this[_0x28c8f8(0xe3)][_0x28c8f8(0x104)](_0x28c8f8(0xba));try{this[_0x28c8f8(0xf9)]=auth_state_enum_1['AuthState'][_0x28c8f8(0xc0)];const {refreshToken:_0x4f42dc,clientId:_0x3c3970,clientSecret:_0x55b896,loginUrl:_0x466e3c}=typedi_1[_0x28c8f8(0xce)]['get'](providers_tokens_1[_0x28c8f8(0xe8)][_0x28c8f8(0xf3)]),{data:_0x69c97}=await axios_1[_0x28c8f8(0xce)]['post']((0x0,utils_1['joinURL'])(_0x466e3c,_0x28c8f8(0xc3)),null,{'params':{'grant_type':_0x28c8f8(0xd8),'refresh_token':_0x4f42dc,'client_id':_0x3c3970,'client_secret':_0x55b896}});this[_0x28c8f8(0xbc)]=_0x69c97[_0x28c8f8(0xf8)],this[_0x28c8f8(0x101)]=_0x69c97[_0x28c8f8(0xde)],this[_0x28c8f8(0xe5)]=_0x69c97[_0x28c8f8(0xd0)],this[_0x28c8f8(0xf9)]=auth_state_enum_1[_0x28c8f8(0xf0)]['Active'],this['logger'][_0x28c8f8(0x104)](_0x28c8f8(0xd7),this[_0x28c8f8(0xbc)]);}catch(_0x245896){const _0x29b3b5=((_0xb43fdc=(_0x275af6=_0x245896===null||_0x245896===void 0x0?void 0x0:_0x245896[_0x28c8f8(0xd5)])===null||_0x275af6===void 0x0?void 0x0:_0x275af6[_0x28c8f8(0xee)])===null||_0xb43fdc===void 0x0?void 0x0:_0xb43fdc['error'])||((_0x2c8b4f=_0x245896===null||_0x245896===void 0x0?void 0x0:_0x245896['response'])===null||_0x2c8b4f===void 0x0?void 0x0:_0x2c8b4f['data'])||_0x245896['message'];this[_0x28c8f8(0xe3)]['error']('update\x20access\x20token\x20failed:\x20%s',_0x29b3b5),this['authState']=auth_state_enum_1[_0x28c8f8(0xf0)]['Error'];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x28c8f8(0x105)]);}}async[a232_0x1be3c2(0xcc)](){const _0x217097=a232_0x1be3c2;this[_0x217097(0xe3)][_0x217097(0x104)]('force\x20update\x20token');if(this['authState']===auth_state_enum_1[_0x217097(0xf0)][_0x217097(0xc0)]||this['authState']===auth_state_enum_1[_0x217097(0xf0)][_0x217097(0xcb)])return await(0x0,utils_1[_0x217097(0xcd)])(this[_0x217097(0xf2)]),this['forceUpdateToken']();if(this[_0x217097(0xf9)]===auth_state_enum_1[_0x217097(0xf0)][_0x217097(0xbb)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x217097(0x105)]);await this[_0x217097(0xd4)]();}async['waitAuth'](){const _0x17761d=a232_0x1be3c2;if(this[_0x17761d(0xf9)]===auth_state_enum_1['AuthState'][_0x17761d(0xbb)]){this[_0x17761d(0xe3)][_0x17761d(0x104)](_0x17761d(0xf7));throw new unauthorized_salesforce_error_1[(_0x17761d(0xbe))]();}if(this[_0x17761d(0xf9)]!==auth_state_enum_1[_0x17761d(0xf0)][_0x17761d(0xea)])return this[_0x17761d(0xe3)][_0x17761d(0x104)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x17761d(0xcd)])(this[_0x17761d(0xf2)]),this[_0x17761d(0xfd)]();}[a232_0x1be3c2(0xef)](){const _0x239a9f=a232_0x1be3c2;return{'orgId':this['orgId'],'accessToken':this[_0x239a9f(0x101)],'instanceUrl':this[_0x239a9f(0xbc)]};}async[a232_0x1be3c2(0xb7)](){const _0x20dcd6=a232_0x1be3c2;return await this[_0x20dcd6(0xfd)](),{'baseURL':this[_0x20dcd6(0xbc)],'headers':{'accept':_0x20dcd6(0xb8),'authorization':this[_0x20dcd6(0xe5)]+'\x20'+this[_0x20dcd6(0x101)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a232_0x1be3c2(0xda),[])],SalesforceAuthService),exports[a232_0x1be3c2(0xdf)]=SalesforceAuthService;