const a270_0x3f8c3a=a270_0x4845;(function(_0x2fab27,_0x2623de){const _0x26ff2b=a270_0x4845,_0x1433ca=_0x2fab27();while(!![]){try{const _0x277036=-parseInt(_0x26ff2b(0x17f))/0x1+parseInt(_0x26ff2b(0x1a6))/0x2+-parseInt(_0x26ff2b(0x1a1))/0x3+parseInt(_0x26ff2b(0x187))/0x4+-parseInt(_0x26ff2b(0x1ca))/0x5+-parseInt(_0x26ff2b(0x1bd))/0x6+parseInt(_0x26ff2b(0x1cc))/0x7*(parseInt(_0x26ff2b(0x1c5))/0x8);if(_0x277036===_0x2623de)break;else _0x1433ca['push'](_0x1433ca['shift']());}catch(_0x34940e){_0x1433ca['push'](_0x1433ca['shift']());}}}(a270_0x3ce9,0xc0720));const a270_0x375a41=(function(){let _0x5786ea=!![];return function(_0x1f9f20,_0x46167f){const _0x1d176d=_0x5786ea?function(){const _0x5954b4=a270_0x4845;if(_0x46167f){const _0x5d67a6=_0x46167f[_0x5954b4(0x199)](_0x1f9f20,arguments);return _0x46167f=null,_0x5d67a6;}}:function(){};return _0x5786ea=![],_0x1d176d;};}()),a270_0xaeb6d6=a270_0x375a41(this,function(){const _0x7a1f27=a270_0x4845;return a270_0xaeb6d6['toString']()[_0x7a1f27(0x197)]('(((.+)+)+)+$')[_0x7a1f27(0x1cb)]()[_0x7a1f27(0x1a5)](a270_0xaeb6d6)['search'](_0x7a1f27(0x17d));});a270_0xaeb6d6();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a270_0x3f8c3a(0x1c3)]?function(_0x5779bf,_0x1ca371,_0x1ec9d8,_0x278e50){const _0xabe9aa=a270_0x3f8c3a;if(_0x278e50===undefined)_0x278e50=_0x1ec9d8;var _0x44db68=Object['getOwnPropertyDescriptor'](_0x1ca371,_0x1ec9d8);(!_0x44db68||(_0xabe9aa(0x18f)in _0x44db68?!_0x1ca371[_0xabe9aa(0x176)]:_0x44db68[_0xabe9aa(0x1b9)]||_0x44db68[_0xabe9aa(0x174)]))&&(_0x44db68={'enumerable':!![],'get':function(){return _0x1ca371[_0x1ec9d8];}}),Object[_0xabe9aa(0x1ba)](_0x5779bf,_0x278e50,_0x44db68);}:function(_0x291392,_0x3c5cb9,_0x277608,_0x5e070b){if(_0x5e070b===undefined)_0x5e070b=_0x277608;_0x291392[_0x5e070b]=_0x3c5cb9[_0x277608];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a270_0x3f8c3a(0x1c3)]?function(_0x4c4935,_0x502781){const _0x24d254=a270_0x3f8c3a;Object[_0x24d254(0x1ba)](_0x4c4935,_0x24d254(0x1b4),{'enumerable':!![],'value':_0x502781});}:function(_0x49bf46,_0xe74196){_0x49bf46['default']=_0xe74196;}),__decorate=this&&this['__decorate']||function(_0x4aed64,_0x29123b,_0x1e2b19,_0x477bf0){const _0x955b81=a270_0x3f8c3a;var _0x5cc992=arguments[_0x955b81(0x18c)],_0x3e0c62=_0x5cc992<0x3?_0x29123b:_0x477bf0===null?_0x477bf0=Object[_0x955b81(0x189)](_0x29123b,_0x1e2b19):_0x477bf0,_0x24edcb;if(typeof Reflect===_0x955b81(0x1ce)&&typeof Reflect[_0x955b81(0x184)]===_0x955b81(0x188))_0x3e0c62=Reflect[_0x955b81(0x184)](_0x4aed64,_0x29123b,_0x1e2b19,_0x477bf0);else{for(var _0xc1408c=_0x4aed64['length']-0x1;_0xc1408c>=0x0;_0xc1408c--)if(_0x24edcb=_0x4aed64[_0xc1408c])_0x3e0c62=(_0x5cc992<0x3?_0x24edcb(_0x3e0c62):_0x5cc992>0x3?_0x24edcb(_0x29123b,_0x1e2b19,_0x3e0c62):_0x24edcb(_0x29123b,_0x1e2b19))||_0x3e0c62;}return _0x5cc992>0x3&&_0x3e0c62&&Object[_0x955b81(0x1ba)](_0x29123b,_0x1e2b19,_0x3e0c62),_0x3e0c62;},__importStar=this&&this[a270_0x3f8c3a(0x1b0)]||function(_0x4c8d7b){const _0x110ba3=a270_0x3f8c3a;if(_0x4c8d7b&&_0x4c8d7b[_0x110ba3(0x176)])return _0x4c8d7b;var _0x25aff9={};if(_0x4c8d7b!=null){for(var _0xafd042 in _0x4c8d7b)if(_0xafd042!==_0x110ba3(0x1b4)&&Object[_0x110ba3(0x177)][_0x110ba3(0x1ae)]['call'](_0x4c8d7b,_0xafd042))__createBinding(_0x25aff9,_0x4c8d7b,_0xafd042);}return __setModuleDefault(_0x25aff9,_0x4c8d7b),_0x25aff9;},__metadata=this&&this['__metadata']||function(_0x4074ed,_0xfbbf47){const _0x477613=a270_0x3f8c3a;if(typeof Reflect===_0x477613(0x1ce)&&typeof Reflect['metadata']==='function')return Reflect[_0x477613(0x1a3)](_0x4074ed,_0xfbbf47);},__importDefault=this&&this[a270_0x3f8c3a(0x1c6)]||function(_0x532401){const _0x5b62c7=a270_0x3f8c3a;return _0x532401&&_0x532401[_0x5b62c7(0x176)]?_0x532401:{'default':_0x532401};},SalesforceAuthService_1;function a270_0x3ce9(){const _0x425621=['Service','forceUpdateToken','Logger','token_type','joinURL','../../providers/providers.tokens','search','InvalidRefreshTokenError','apply','error','services/data/','name','typedi','Error','SalesforceAuthService','AUTH_WAIT_TIME','1010484hDVvrl','application/json','metadata','instanceUrl','constructor','834732DhZotz','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','SALESFORCE_API_VERSION','</met:sessionId>','Access\x20token\x20updated\x20for\x20%s','headers','orgId','../errors/unauthorized-salesforce.error','hasOwnProperty','../../../../core','__importStar','authState','access_token','isBulk1Url','default','requestConfig','isSoapUrl','sleep','../enums/auth-state.enum','writable','defineProperty','data','../../../shared/utils','2108424bBDtkc','setAuthDetails','X-SFDC-Session','Check\x20auth:\x20current\x20state\x20-\x20%s','then','<met:sessionId>','create','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','24595160ecueyz','__importDefault','axios','response','waitAuth','3604310aqFqgz','toString','7FNEXyf','ERR_INVALID_SALESFORCE_TOKEN','object','replace','configurable','Idle','__esModule','prototype','log','logger','design:paramtypes','../../../../constants','accessToken','(((.+)+)+)+$','/services/oauth2/token','1362327kgtPPg','salesforce','SalesforceUtils','../errors/invalid-refresh-token.error','AuthState','decorate','message','post','271664qLkBGj','function','getOwnPropertyDescriptor','Update\x20access\x20token\x20failed:\x20%s','Active','length','updateAccessToken','Updating','get','tokenType'];a270_0x3ce9=function(){return _0x425621;};return a270_0x3ce9();}Object[a270_0x3f8c3a(0x1ba)](exports,a270_0x3f8c3a(0x176),{'value':!![]}),exports[a270_0x3f8c3a(0x19f)]=void 0x0;const typedi_1=__importStar(require(a270_0x3f8c3a(0x19d))),errors_1=require('../../../../constants/errors'),core_1=require(a270_0x3f8c3a(0x1af)),axios_1=__importDefault(require(a270_0x3f8c3a(0x1c7))),utils_1=require(a270_0x3f8c3a(0x1bc)),invalid_refresh_token_error_1=require(a270_0x3f8c3a(0x182)),auth_state_enum_1=require(a270_0x3f8c3a(0x1b8)),unauthorized_salesforce_error_1=require(a270_0x3f8c3a(0x1ad)),constants_1=require(a270_0x3f8c3a(0x17b)),providers_tokens_1=require(a270_0x3f8c3a(0x196)),salesforce_1=require('@flosum/salesforce');function a270_0x4845(_0x424331,_0x26ccca){const _0x3e4e44=a270_0x3ce9();return a270_0x4845=function(_0xaeb6d6,_0x375a41){_0xaeb6d6=_0xaeb6d6-0x174;let _0x3ce9b2=_0x3e4e44[_0xaeb6d6];return _0x3ce9b2;},a270_0x4845(_0x424331,_0x26ccca);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x265d06=a270_0x3f8c3a;this[_0x265d06(0x1a0)]=0x1388,this['authState']=auth_state_enum_1[_0x265d06(0x183)][_0x265d06(0x175)],this[_0x265d06(0x179)]=new core_1[(_0x265d06(0x193))](SalesforceAuthService_1[_0x265d06(0x19c)]),this[_0x265d06(0x1be)]();}async[a270_0x3f8c3a(0x1be)](){const _0x441874=a270_0x3f8c3a;this[_0x441874(0x179)][_0x441874(0x178)](_0x441874(0x1c0),auth_state_enum_1[_0x441874(0x183)][this[_0x441874(0x1b1)]]);try{if(this['authState']===auth_state_enum_1['AuthState'][_0x441874(0x19e)])return;if(this[_0x441874(0x1b1)]===auth_state_enum_1[_0x441874(0x183)][_0x441874(0x175)])await this[_0x441874(0x18d)]();else{const _0x13e11e=await this[_0x441874(0x1b5)](),_0xf79c2f=await axios_1[_0x441874(0x1b4)][_0x441874(0x18f)](_0x441874(0x19b)+constants_1[_0x441874(0x1a8)],_0x13e11e)[_0x441874(0x1c1)](()=>!![])['catch'](()=>![]);!_0xf79c2f&&await this['updateAccessToken']();}}catch(_0x1cf1cb){}}async[a270_0x3f8c3a(0x18d)](){const _0x1c53f8=a270_0x3f8c3a;var _0x32dcfa,_0x3954b6,_0xed0ef4;this['logger'][_0x1c53f8(0x178)]('Update\x20access\x20token');try{this[_0x1c53f8(0x1b1)]=auth_state_enum_1[_0x1c53f8(0x183)][_0x1c53f8(0x18e)];const {refreshToken:_0x54799d,clientId:_0x2bbe89,clientSecret:_0x15312f,loginUrl:_0x1cf08d}=typedi_1[_0x1c53f8(0x1b4)][_0x1c53f8(0x18f)](providers_tokens_1['Tokens'][_0x1c53f8(0x180)]),{data:_0x4b0863}=await axios_1[_0x1c53f8(0x1b4)][_0x1c53f8(0x186)]((0x0,utils_1[_0x1c53f8(0x195)])(_0x1cf08d,_0x1c53f8(0x17e)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x54799d,'client_id':_0x2bbe89,'client_secret':_0x15312f}});this[_0x1c53f8(0x1a4)]=_0x4b0863['instance_url'],this[_0x1c53f8(0x17c)]=_0x4b0863[_0x1c53f8(0x1b2)],this[_0x1c53f8(0x190)]=_0x4b0863[_0x1c53f8(0x194)],this[_0x1c53f8(0x1b1)]=auth_state_enum_1[_0x1c53f8(0x183)][_0x1c53f8(0x18b)],this[_0x1c53f8(0x179)][_0x1c53f8(0x178)](_0x1c53f8(0x1aa),this[_0x1c53f8(0x1a4)]);}catch(_0x41fad0){const _0x314457=((_0x3954b6=(_0x32dcfa=_0x41fad0===null||_0x41fad0===void 0x0?void 0x0:_0x41fad0[_0x1c53f8(0x1c8)])===null||_0x32dcfa===void 0x0?void 0x0:_0x32dcfa[_0x1c53f8(0x1bb)])===null||_0x3954b6===void 0x0?void 0x0:_0x3954b6[_0x1c53f8(0x19a)])||((_0xed0ef4=_0x41fad0===null||_0x41fad0===void 0x0?void 0x0:_0x41fad0[_0x1c53f8(0x1c8)])===null||_0xed0ef4===void 0x0?void 0x0:_0xed0ef4[_0x1c53f8(0x1bb)])||_0x41fad0[_0x1c53f8(0x185)];this['logger'][_0x1c53f8(0x19a)](_0x1c53f8(0x18a),_0x314457),this['authState']=auth_state_enum_1[_0x1c53f8(0x183)][_0x1c53f8(0x19e)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a270_0x3f8c3a(0x192)](){const _0x1c3662=a270_0x3f8c3a;this[_0x1c3662(0x179)][_0x1c3662(0x178)]('Force\x20update\x20token');if(this[_0x1c3662(0x1b1)]===auth_state_enum_1['AuthState'][_0x1c3662(0x18e)]||this[_0x1c3662(0x1b1)]===auth_state_enum_1[_0x1c3662(0x183)][_0x1c3662(0x175)])return await(0x0,utils_1[_0x1c3662(0x1b7)])(this[_0x1c3662(0x1a0)]),this['forceUpdateToken']();if(this[_0x1c3662(0x1b1)]===auth_state_enum_1[_0x1c3662(0x183)][_0x1c3662(0x19e)])throw new invalid_refresh_token_error_1[(_0x1c3662(0x198))](errors_1[_0x1c3662(0x1cd)]);await this[_0x1c3662(0x18d)]();}async['waitAuth'](){const _0x18e790=a270_0x3f8c3a;if(this[_0x18e790(0x1b1)]===auth_state_enum_1[_0x18e790(0x183)][_0x18e790(0x19e)]){this[_0x18e790(0x179)]['log'](_0x18e790(0x1c4));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x18e790(0x1b1)]!==auth_state_enum_1[_0x18e790(0x183)]['Active'])return this[_0x18e790(0x179)][_0x18e790(0x178)](_0x18e790(0x1a7)),await(0x0,utils_1['sleep'])(this[_0x18e790(0x1a0)]),this[_0x18e790(0x1c9)]();}['getAuthData'](){const _0x2ed85d=a270_0x3f8c3a;return{'orgId':this[_0x2ed85d(0x1ac)],'accessToken':this['accessToken'],'instanceUrl':this[_0x2ed85d(0x1a4)]};}async[a270_0x3f8c3a(0x1b5)](_0x222813=''){const _0x1faa1f=a270_0x3f8c3a;await this[_0x1faa1f(0x1c9)]();const _0x122df8={'baseURL':this[_0x1faa1f(0x1a4)],'headers':{'accept':_0x1faa1f(0x1a2)}};if(salesforce_1[_0x1faa1f(0x181)][_0x1faa1f(0x1b3)](_0x222813))_0x122df8['headers'][_0x1faa1f(0x1bf)]=this['accessToken'];else salesforce_1['SalesforceUtils'][_0x1faa1f(0x1b6)](_0x222813)?_0x122df8[_0x1faa1f(0x1bb)]=_0x122df8[_0x1faa1f(0x1bb)][_0x1faa1f(0x1cf)](/<met:sessionId>.+?<\/met:sessionId>/,_0x1faa1f(0x1c2)+this[_0x1faa1f(0x17c)]+_0x1faa1f(0x1a9)):_0x122df8[_0x1faa1f(0x1ab)]['authorization']=this[_0x1faa1f(0x190)]+'\x20'+this[_0x1faa1f(0x17c)];return _0x122df8;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a270_0x3f8c3a(0x191)])(),__metadata(a270_0x3f8c3a(0x17a),[])],SalesforceAuthService),exports[a270_0x3f8c3a(0x19f)]=SalesforceAuthService;