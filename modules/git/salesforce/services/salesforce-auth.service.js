const a175_0x44b888=a175_0x4b31;(function(_0x2beee6,_0x10846d){const _0x24f78b=a175_0x4b31,_0xcd0241=_0x2beee6();while(!![]){try{const _0x1bcd6f=-parseInt(_0x24f78b(0x133))/0x1*(-parseInt(_0x24f78b(0x15f))/0x2)+parseInt(_0x24f78b(0x15e))/0x3*(-parseInt(_0x24f78b(0x12a))/0x4)+parseInt(_0x24f78b(0x16e))/0x5*(parseInt(_0x24f78b(0x155))/0x6)+-parseInt(_0x24f78b(0x139))/0x7+parseInt(_0x24f78b(0x12c))/0x8+-parseInt(_0x24f78b(0x14f))/0x9*(-parseInt(_0x24f78b(0x14d))/0xa)+-parseInt(_0x24f78b(0x150))/0xb;if(_0x1bcd6f===_0x10846d)break;else _0xcd0241['push'](_0xcd0241['shift']());}catch(_0x1f84b9){_0xcd0241['push'](_0xcd0241['shift']());}}}(a175_0x488a,0x3fd7f));const a175_0x1e38dc=(function(){let _0x3184aa=!![];return function(_0x8abb62,_0x2f0d20){const _0x1477a2=_0x3184aa?function(){const _0x2b4358=a175_0x4b31;if(_0x2f0d20){const _0x198f13=_0x2f0d20[_0x2b4358(0x129)](_0x8abb62,arguments);return _0x2f0d20=null,_0x198f13;}}:function(){};return _0x3184aa=![],_0x1477a2;};}()),a175_0x4d8271=a175_0x1e38dc(this,function(){const _0xd65878=a175_0x4b31;return a175_0x4d8271[_0xd65878(0x16f)]()[_0xd65878(0x127)](_0xd65878(0x156))[_0xd65878(0x16f)]()[_0xd65878(0x148)](a175_0x4d8271)[_0xd65878(0x127)]('(((.+)+)+)+$');});a175_0x4d8271();'use strict';var __createBinding=this&&this[a175_0x44b888(0x14c)]||(Object[a175_0x44b888(0x13f)]?function(_0xc949c8,_0x87aeee,_0x540b5d,_0xe6bc6c){if(_0xe6bc6c===undefined)_0xe6bc6c=_0x540b5d;Object['defineProperty'](_0xc949c8,_0xe6bc6c,{'enumerable':!![],'get':function(){return _0x87aeee[_0x540b5d];}});}:function(_0x58e312,_0x12a074,_0x3dcb7a,_0x2fd06b){if(_0x2fd06b===undefined)_0x2fd06b=_0x3dcb7a;_0x58e312[_0x2fd06b]=_0x12a074[_0x3dcb7a];}),__setModuleDefault=this&&this[a175_0x44b888(0x12f)]||(Object['create']?function(_0xb2f8e8,_0x365f41){const _0x3d144d=a175_0x44b888;Object[_0x3d144d(0x15d)](_0xb2f8e8,'default',{'enumerable':!![],'value':_0x365f41});}:function(_0x1d53bf,_0x41a0a1){_0x1d53bf['default']=_0x41a0a1;}),__decorate=this&&this['__decorate']||function(_0x214d83,_0xf0f877,_0x51037b,_0x14e262){const _0x1464f4=a175_0x44b888;var _0x1193b4=arguments[_0x1464f4(0x16c)],_0x30f3f4=_0x1193b4<0x3?_0xf0f877:_0x14e262===null?_0x14e262=Object[_0x1464f4(0x164)](_0xf0f877,_0x51037b):_0x14e262,_0x768d6c;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x1464f4(0x11d))_0x30f3f4=Reflect[_0x1464f4(0x124)](_0x214d83,_0xf0f877,_0x51037b,_0x14e262);else{for(var _0x5b7c2a=_0x214d83[_0x1464f4(0x16c)]-0x1;_0x5b7c2a>=0x0;_0x5b7c2a--)if(_0x768d6c=_0x214d83[_0x5b7c2a])_0x30f3f4=(_0x1193b4<0x3?_0x768d6c(_0x30f3f4):_0x1193b4>0x3?_0x768d6c(_0xf0f877,_0x51037b,_0x30f3f4):_0x768d6c(_0xf0f877,_0x51037b))||_0x30f3f4;}return _0x1193b4>0x3&&_0x30f3f4&&Object[_0x1464f4(0x15d)](_0xf0f877,_0x51037b,_0x30f3f4),_0x30f3f4;},__importStar=this&&this[a175_0x44b888(0x136)]||function(_0x54d5c8){const _0x4ef221=a175_0x44b888;if(_0x54d5c8&&_0x54d5c8[_0x4ef221(0x13a)])return _0x54d5c8;var _0x51e1ef={};if(_0x54d5c8!=null){for(var _0x368671 in _0x54d5c8)if(_0x368671!=='default'&&Object[_0x4ef221(0x14e)][_0x4ef221(0x173)][_0x4ef221(0x175)](_0x54d5c8,_0x368671))__createBinding(_0x51e1ef,_0x54d5c8,_0x368671);}return __setModuleDefault(_0x51e1ef,_0x54d5c8),_0x51e1ef;},__metadata=this&&this[a175_0x44b888(0x140)]||function(_0x134d2e,_0x3e8772){const _0x3e7f12=a175_0x44b888;if(typeof Reflect==='object'&&typeof Reflect[_0x3e7f12(0x174)]===_0x3e7f12(0x11d))return Reflect[_0x3e7f12(0x174)](_0x134d2e,_0x3e8772);},__importDefault=this&&this[a175_0x44b888(0x149)]||function(_0x1bc4fc){const _0x249b58=a175_0x44b888;return _0x1bc4fc&&_0x1bc4fc[_0x249b58(0x13a)]?_0x1bc4fc:{'default':_0x1bc4fc};},SalesforceAuthService_1;Object['defineProperty'](exports,a175_0x44b888(0x13a),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;function a175_0x488a(){const _0x566c0a=['/services/oauth2/token','waitAuth','application/json','authState','SalesforceAuthService','constructor','__importDefault','Logger','log','__createBinding','3646100prDJXh','prototype','9lBXWVr','2816484gfFPem','AUTH_WAIT_TIME','requestConfig','then','services/data/','802026QdBRul','(((.+)+)+)+$','response','design:paramtypes','../../../../constants','../../../../constants/errors','setAuthDetails','../../providers/providers.tokens','defineProperty','12TvWLoa','64sUPEQN','Idle','create\x20authorized\x20request\x20failed:\x20authorization\x20error','error','post','getOwnPropertyDescriptor','SALESFORCE_API_VERSION','AuthState','access_token','getAuthData','../errors/invalid-refresh-token.error','default','InvalidRefreshTokenError','length','Tokens','15ZMOpRj','toString','check\x20auth:\x20current\x20state\x20-\x20%s','Error','get','hasOwnProperty','metadata','call','function','tokenType','../enums/auth-state.enum','instance_url','token_type','message','data','decorate','salesforce','logger','search','Updating','apply','285920CflWlo','catch','863368LBZIcU','orgId','updateAccessToken','__setModuleDefault','accessToken','force\x20update\x20token','typedi','1372joCiZw','refresh_token','instanceUrl','__importStar','Service','ERR_INVALID_SALESFORCE_TOKEN','797867tJanpW','__esModule','../../../shared/utils','axios','name','Active','create','__metadata','joinURL','update\x20access\x20token\x20failed:\x20%s'];a175_0x488a=function(){return _0x566c0a;};return a175_0x488a();}const typedi_1=__importStar(require(a175_0x44b888(0x132))),errors_1=require(a175_0x44b888(0x15a)),core_1=require('../../../../core'),axios_1=__importDefault(require(a175_0x44b888(0x13c))),utils_1=require(a175_0x44b888(0x13b)),invalid_refresh_token_error_1=require(a175_0x44b888(0x169)),auth_state_enum_1=require(a175_0x44b888(0x11f)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a175_0x44b888(0x159)),providers_tokens_1=require(a175_0x44b888(0x15c));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x28ba67=a175_0x44b888;this[_0x28ba67(0x151)]=0x1388,this[_0x28ba67(0x146)]=auth_state_enum_1[_0x28ba67(0x166)][_0x28ba67(0x160)],this[_0x28ba67(0x126)]=new core_1[(_0x28ba67(0x14a))](SalesforceAuthService_1[_0x28ba67(0x13d)]),this[_0x28ba67(0x15b)]();}async['setAuthDetails'](){const _0x58e369=a175_0x44b888;this[_0x58e369(0x126)][_0x58e369(0x14b)](_0x58e369(0x170),auth_state_enum_1[_0x58e369(0x166)][this['authState']]);try{if(this[_0x58e369(0x146)]===auth_state_enum_1[_0x58e369(0x166)][_0x58e369(0x171)])return;if(this[_0x58e369(0x146)]===auth_state_enum_1[_0x58e369(0x166)][_0x58e369(0x160)])await this[_0x58e369(0x12e)]();else{const _0x48cde8=await this[_0x58e369(0x152)](),_0x495eb6=await axios_1['default'][_0x58e369(0x172)](_0x58e369(0x154)+constants_1[_0x58e369(0x165)],_0x48cde8)[_0x58e369(0x153)](()=>!![])[_0x58e369(0x12b)](()=>![]);!_0x495eb6&&await this['updateAccessToken']();}}catch(_0x1b7978){}}async['updateAccessToken'](){const _0x16135e=a175_0x44b888;var _0x16a47a,_0x31984e,_0x200eac;this[_0x16135e(0x126)]['log']('update\x20access\x20token');try{this[_0x16135e(0x146)]=auth_state_enum_1['AuthState'][_0x16135e(0x128)];const {refreshToken:_0x12c0eb,clientId:_0x3df511,clientSecret:_0x5f0bbb,loginUrl:_0xf5e782}=typedi_1[_0x16135e(0x16a)][_0x16135e(0x172)](providers_tokens_1[_0x16135e(0x16d)][_0x16135e(0x125)]),{data:_0x378f56}=await axios_1[_0x16135e(0x16a)][_0x16135e(0x163)](utils_1[_0x16135e(0x141)](_0xf5e782,_0x16135e(0x143)),null,{'params':{'grant_type':_0x16135e(0x134),'refresh_token':_0x12c0eb,'client_id':_0x3df511,'client_secret':_0x5f0bbb}});this[_0x16135e(0x135)]=_0x378f56[_0x16135e(0x120)],this[_0x16135e(0x130)]=_0x378f56[_0x16135e(0x167)],this['tokenType']=_0x378f56[_0x16135e(0x121)],this['authState']=auth_state_enum_1[_0x16135e(0x166)][_0x16135e(0x13e)],this['logger'][_0x16135e(0x14b)]('access\x20token\x20updated\x20for\x20%s',this[_0x16135e(0x135)]);}catch(_0x5edb02){const _0x538370=((_0x31984e=(_0x16a47a=_0x5edb02===null||_0x5edb02===void 0x0?void 0x0:_0x5edb02[_0x16135e(0x157)])===null||_0x16a47a===void 0x0?void 0x0:_0x16a47a['data'])===null||_0x31984e===void 0x0?void 0x0:_0x31984e['error'])||((_0x200eac=_0x5edb02===null||_0x5edb02===void 0x0?void 0x0:_0x5edb02[_0x16135e(0x157)])===null||_0x200eac===void 0x0?void 0x0:_0x200eac[_0x16135e(0x123)])||_0x5edb02[_0x16135e(0x122)];this[_0x16135e(0x126)][_0x16135e(0x162)](_0x16135e(0x142),_0x538370),this[_0x16135e(0x146)]=auth_state_enum_1[_0x16135e(0x166)][_0x16135e(0x171)];throw new invalid_refresh_token_error_1[(_0x16135e(0x16b))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x4fed52=a175_0x44b888;this['logger']['log'](_0x4fed52(0x131));if(this['authState']===auth_state_enum_1[_0x4fed52(0x166)][_0x4fed52(0x128)]||this[_0x4fed52(0x146)]===auth_state_enum_1['AuthState'][_0x4fed52(0x160)])return await utils_1['sleep'](this[_0x4fed52(0x151)]),this['forceUpdateToken']();if(this[_0x4fed52(0x146)]===auth_state_enum_1[_0x4fed52(0x166)]['Error'])throw new invalid_refresh_token_error_1[(_0x4fed52(0x16b))](errors_1[_0x4fed52(0x138)]);await this[_0x4fed52(0x12e)]();}async[a175_0x44b888(0x144)](){const _0x9a29f7=a175_0x44b888;if(this['authState']===auth_state_enum_1['AuthState'][_0x9a29f7(0x171)]){this['logger'][_0x9a29f7(0x14b)](_0x9a29f7(0x161));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x9a29f7(0x146)]!==auth_state_enum_1[_0x9a29f7(0x166)]['Active'])return this[_0x9a29f7(0x126)][_0x9a29f7(0x14b)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1['sleep'](this[_0x9a29f7(0x151)]),this['waitAuth']();}[a175_0x44b888(0x168)](){const _0x189e1f=a175_0x44b888;return{'orgId':this[_0x189e1f(0x12d)],'accessToken':this['accessToken'],'instanceUrl':this[_0x189e1f(0x135)]};}async[a175_0x44b888(0x152)](){const _0x5095ee=a175_0x44b888;return await this[_0x5095ee(0x144)](),{'baseURL':this[_0x5095ee(0x135)],'headers':{'accept':_0x5095ee(0x145),'authorization':this[_0x5095ee(0x11e)]+'\x20'+this[_0x5095ee(0x130)]}};}};function a175_0x4b31(_0x3b07ca,_0x54d48a){const _0x3629d6=a175_0x488a();return a175_0x4b31=function(_0x4d8271,_0x1e38dc){_0x4d8271=_0x4d8271-0x11d;let _0x488a1a=_0x3629d6[_0x4d8271];return _0x488a1a;},a175_0x4b31(_0x3b07ca,_0x54d48a);}SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a175_0x44b888(0x137)](),__metadata(a175_0x44b888(0x158),[])],SalesforceAuthService),exports[a175_0x44b888(0x147)]=SalesforceAuthService;