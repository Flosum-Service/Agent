const a232_0x16eeef=a232_0x53ed;(function(_0x3c228b,_0x41a31a){const _0x3614fc=a232_0x53ed,_0x195823=_0x3c228b();while(!![]){try{const _0x113365=parseInt(_0x3614fc(0x85))/0x1+parseInt(_0x3614fc(0xc6))/0x2+-parseInt(_0x3614fc(0x7d))/0x3*(-parseInt(_0x3614fc(0x9e))/0x4)+parseInt(_0x3614fc(0xce))/0x5+-parseInt(_0x3614fc(0xc3))/0x6*(-parseInt(_0x3614fc(0xc7))/0x7)+-parseInt(_0x3614fc(0xaa))/0x8*(parseInt(_0x3614fc(0xb3))/0x9)+-parseInt(_0x3614fc(0xa2))/0xa;if(_0x113365===_0x41a31a)break;else _0x195823['push'](_0x195823['shift']());}catch(_0x144418){_0x195823['push'](_0x195823['shift']());}}}(a232_0x2035,0x1be2b));function a232_0x2035(){const _0x1872ef=['__createBinding','forceUpdateToken','getOwnPropertyDescriptor','post','(((.+)+)+)+$','configurable','accessToken','data','../errors/unauthorized-salesforce.error','../../providers/providers.tokens','6FBOZFL','toString','SALESFORCE_API_VERSION','389446MCzvNT','561463VwTnoH','response','services/data/','metadata','get','defineProperty','UnauthorizedSalesforceError','756925QXZmJB','prototype','length','ERR_INVALID_SALESFORCE_TOKEN','orgId','force\x20update\x20token','../../../../constants','access_token','salesforce','log','search','146571JheblV','instanceUrl','__esModule','waitAuth','token_type','instance_url','update\x20access\x20token\x20failed:\x20%s','Updating','176784TFeQXh','__importStar','function','/services/oauth2/token','object','joinURL','constructor','Logger','__decorate','updateAccessToken','sleep','logger','name','__setModuleDefault','default','then','requestConfig','decorate','error','typedi','axios','__importDefault','access\x20token\x20updated\x20for\x20%s','create\x20authorized\x20request\x20failed:\x20authorization\x20error','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','16AVJSWf','SalesforceAuthService','tokenType','InvalidRefreshTokenError','5927220gxdrxT','Tokens','hasOwnProperty','../errors/invalid-refresh-token.error','AUTH_WAIT_TIME','writable','call','Service','732704gTAKgO','apply','Error','../../../../constants/errors','update\x20access\x20token','authState','AuthState','__metadata','refresh_token','9WmHqZi','../../../shared/utils','Active','design:paramtypes','Idle','create'];a232_0x2035=function(){return _0x1872ef;};return a232_0x2035();}const a232_0x4d5f51=(function(){let _0x110b71=!![];return function(_0x214682,_0xbac67e){const _0x45988f=_0x110b71?function(){const _0xcd5d67=a232_0x53ed;if(_0xbac67e){const _0x4df158=_0xbac67e[_0xcd5d67(0xab)](_0x214682,arguments);return _0xbac67e=null,_0x4df158;}}:function(){};return _0x110b71=![],_0x45988f;};}()),a232_0x23bb15=a232_0x4d5f51(this,function(){const _0x506db4=a232_0x53ed;return a232_0x23bb15['toString']()[_0x506db4(0x7c)]('(((.+)+)+)+$')[_0x506db4(0xc4)]()[_0x506db4(0x8b)](a232_0x23bb15)[_0x506db4(0x7c)](_0x506db4(0xbd));});function a232_0x53ed(_0x1cda79,_0x373a57){const _0x5b8f7e=a232_0x2035();return a232_0x53ed=function(_0x23bb15,_0x4d5f51){_0x23bb15=_0x23bb15-0x78;let _0x20355a=_0x5b8f7e[_0x23bb15];return _0x20355a;},a232_0x53ed(_0x1cda79,_0x373a57);}a232_0x23bb15();'use strict';var __createBinding=this&&this[a232_0x16eeef(0xb9)]||(Object[a232_0x16eeef(0xb8)]?function(_0x4d06b5,_0x39f424,_0x5db4f4,_0x476f8c){const _0x2ddd73=a232_0x16eeef;if(_0x476f8c===undefined)_0x476f8c=_0x5db4f4;var _0x538307=Object['getOwnPropertyDescriptor'](_0x39f424,_0x5db4f4);(!_0x538307||(_0x2ddd73(0xcb)in _0x538307?!_0x39f424[_0x2ddd73(0x7f)]:_0x538307[_0x2ddd73(0xa7)]||_0x538307[_0x2ddd73(0xbe)]))&&(_0x538307={'enumerable':!![],'get':function(){return _0x39f424[_0x5db4f4];}}),Object[_0x2ddd73(0xcc)](_0x4d06b5,_0x476f8c,_0x538307);}:function(_0x5122f0,_0x241533,_0x5f469e,_0x4099c2){if(_0x4099c2===undefined)_0x4099c2=_0x5f469e;_0x5122f0[_0x4099c2]=_0x241533[_0x5f469e];}),__setModuleDefault=this&&this[a232_0x16eeef(0x92)]||(Object[a232_0x16eeef(0xb8)]?function(_0x299127,_0x70ba02){const _0x5c83a5=a232_0x16eeef;Object[_0x5c83a5(0xcc)](_0x299127,_0x5c83a5(0x93),{'enumerable':!![],'value':_0x70ba02});}:function(_0xfd6ea2,_0x1fa5bc){const _0x3b2a1d=a232_0x16eeef;_0xfd6ea2[_0x3b2a1d(0x93)]=_0x1fa5bc;}),__decorate=this&&this[a232_0x16eeef(0x8d)]||function(_0x51cb43,_0x4b48b6,_0x2d738d,_0x1d3a95){const _0x3ff7a2=a232_0x16eeef;var _0x1aa8a5=arguments[_0x3ff7a2(0xd0)],_0x18e99e=_0x1aa8a5<0x3?_0x4b48b6:_0x1d3a95===null?_0x1d3a95=Object[_0x3ff7a2(0xbb)](_0x4b48b6,_0x2d738d):_0x1d3a95,_0x2e6efe;if(typeof Reflect===_0x3ff7a2(0x89)&&typeof Reflect[_0x3ff7a2(0x96)]===_0x3ff7a2(0x87))_0x18e99e=Reflect['decorate'](_0x51cb43,_0x4b48b6,_0x2d738d,_0x1d3a95);else{for(var _0x2a501b=_0x51cb43[_0x3ff7a2(0xd0)]-0x1;_0x2a501b>=0x0;_0x2a501b--)if(_0x2e6efe=_0x51cb43[_0x2a501b])_0x18e99e=(_0x1aa8a5<0x3?_0x2e6efe(_0x18e99e):_0x1aa8a5>0x3?_0x2e6efe(_0x4b48b6,_0x2d738d,_0x18e99e):_0x2e6efe(_0x4b48b6,_0x2d738d))||_0x18e99e;}return _0x1aa8a5>0x3&&_0x18e99e&&Object[_0x3ff7a2(0xcc)](_0x4b48b6,_0x2d738d,_0x18e99e),_0x18e99e;},__importStar=this&&this[a232_0x16eeef(0x86)]||function(_0x3119bd){const _0x49c556=a232_0x16eeef;if(_0x3119bd&&_0x3119bd[_0x49c556(0x7f)])return _0x3119bd;var _0x1fdbbd={};if(_0x3119bd!=null){for(var _0x1fae1c in _0x3119bd)if(_0x1fae1c!=='default'&&Object[_0x49c556(0xcf)][_0x49c556(0xa4)][_0x49c556(0xa8)](_0x3119bd,_0x1fae1c))__createBinding(_0x1fdbbd,_0x3119bd,_0x1fae1c);}return __setModuleDefault(_0x1fdbbd,_0x3119bd),_0x1fdbbd;},__metadata=this&&this[a232_0x16eeef(0xb1)]||function(_0x31672f,_0x3e5a58){const _0x331b8f=a232_0x16eeef;if(typeof Reflect===_0x331b8f(0x89)&&typeof Reflect[_0x331b8f(0xca)]===_0x331b8f(0x87))return Reflect['metadata'](_0x31672f,_0x3e5a58);},__importDefault=this&&this[a232_0x16eeef(0x9a)]||function(_0x337ca2){return _0x337ca2&&_0x337ca2['__esModule']?_0x337ca2:{'default':_0x337ca2};},SalesforceAuthService_1;Object[a232_0x16eeef(0xcc)](exports,a232_0x16eeef(0x7f),{'value':!![]}),exports[a232_0x16eeef(0x9f)]=void 0x0;const typedi_1=__importStar(require(a232_0x16eeef(0x98))),errors_1=require(a232_0x16eeef(0xad)),core_1=require('../../../../core'),axios_1=__importDefault(require(a232_0x16eeef(0x99))),utils_1=require(a232_0x16eeef(0xb4)),invalid_refresh_token_error_1=require(a232_0x16eeef(0xa5)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a232_0x16eeef(0xc1)),constants_1=require(a232_0x16eeef(0x78)),providers_tokens_1=require(a232_0x16eeef(0xc2));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x8ce068=a232_0x16eeef;this['AUTH_WAIT_TIME']=0x1388,this[_0x8ce068(0xaf)]=auth_state_enum_1[_0x8ce068(0xb0)][_0x8ce068(0xb7)],this['logger']=new core_1[(_0x8ce068(0x8c))](SalesforceAuthService_1[_0x8ce068(0x91)]),this['setAuthDetails']();}async['setAuthDetails'](){const _0x27c594=a232_0x16eeef;this[_0x27c594(0x90)][_0x27c594(0x7b)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x27c594(0xb0)][this[_0x27c594(0xaf)]]);try{if(this[_0x27c594(0xaf)]===auth_state_enum_1[_0x27c594(0xb0)][_0x27c594(0xac)])return;if(this['authState']===auth_state_enum_1[_0x27c594(0xb0)][_0x27c594(0xb7)])await this['updateAccessToken']();else{const _0xb8542=await this[_0x27c594(0x95)](),_0x3db2d4=await axios_1[_0x27c594(0x93)][_0x27c594(0xcb)](_0x27c594(0xc9)+constants_1[_0x27c594(0xc5)],_0xb8542)[_0x27c594(0x94)](()=>!![])['catch'](()=>![]);!_0x3db2d4&&await this['updateAccessToken']();}}catch(_0x5df48b){}}async['updateAccessToken'](){const _0x57b47b=a232_0x16eeef;var _0x4b02cc,_0x4737e9,_0x1cba74;this[_0x57b47b(0x90)][_0x57b47b(0x7b)](_0x57b47b(0xae));try{this[_0x57b47b(0xaf)]=auth_state_enum_1[_0x57b47b(0xb0)][_0x57b47b(0x84)];const {refreshToken:_0x527c14,clientId:_0x3cdf1d,clientSecret:_0x523181,loginUrl:_0x560bdb}=typedi_1[_0x57b47b(0x93)]['get'](providers_tokens_1[_0x57b47b(0xa3)][_0x57b47b(0x7a)]),{data:_0xea25eb}=await axios_1[_0x57b47b(0x93)][_0x57b47b(0xbc)]((0x0,utils_1[_0x57b47b(0x8a)])(_0x560bdb,_0x57b47b(0x88)),null,{'params':{'grant_type':_0x57b47b(0xb2),'refresh_token':_0x527c14,'client_id':_0x3cdf1d,'client_secret':_0x523181}});this['instanceUrl']=_0xea25eb[_0x57b47b(0x82)],this['accessToken']=_0xea25eb[_0x57b47b(0x79)],this[_0x57b47b(0xa0)]=_0xea25eb[_0x57b47b(0x81)],this[_0x57b47b(0xaf)]=auth_state_enum_1[_0x57b47b(0xb0)]['Active'],this['logger'][_0x57b47b(0x7b)](_0x57b47b(0x9b),this[_0x57b47b(0x7e)]);}catch(_0x2f10d0){const _0x109a33=((_0x4737e9=(_0x4b02cc=_0x2f10d0===null||_0x2f10d0===void 0x0?void 0x0:_0x2f10d0[_0x57b47b(0xc8)])===null||_0x4b02cc===void 0x0?void 0x0:_0x4b02cc[_0x57b47b(0xc0)])===null||_0x4737e9===void 0x0?void 0x0:_0x4737e9[_0x57b47b(0x97)])||((_0x1cba74=_0x2f10d0===null||_0x2f10d0===void 0x0?void 0x0:_0x2f10d0['response'])===null||_0x1cba74===void 0x0?void 0x0:_0x1cba74[_0x57b47b(0xc0)])||_0x2f10d0['message'];this[_0x57b47b(0x90)][_0x57b47b(0x97)](_0x57b47b(0x83),_0x109a33),this['authState']=auth_state_enum_1[_0x57b47b(0xb0)][_0x57b47b(0xac)];throw new invalid_refresh_token_error_1[(_0x57b47b(0xa1))](errors_1[_0x57b47b(0xd1)]);}}async[a232_0x16eeef(0xba)](){const _0x45690c=a232_0x16eeef;this[_0x45690c(0x90)][_0x45690c(0x7b)](_0x45690c(0xd3));if(this[_0x45690c(0xaf)]===auth_state_enum_1['AuthState'][_0x45690c(0x84)]||this[_0x45690c(0xaf)]===auth_state_enum_1[_0x45690c(0xb0)][_0x45690c(0xb7)])return await(0x0,utils_1[_0x45690c(0x8f)])(this[_0x45690c(0xa6)]),this['forceUpdateToken']();if(this[_0x45690c(0xaf)]===auth_state_enum_1[_0x45690c(0xb0)][_0x45690c(0xac)])throw new invalid_refresh_token_error_1[(_0x45690c(0xa1))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x45690c(0x8e)]();}async[a232_0x16eeef(0x80)](){const _0x4ebd29=a232_0x16eeef;if(this[_0x4ebd29(0xaf)]===auth_state_enum_1['AuthState']['Error']){this[_0x4ebd29(0x90)][_0x4ebd29(0x7b)](_0x4ebd29(0x9c));throw new unauthorized_salesforce_error_1[(_0x4ebd29(0xcd))]();}if(this[_0x4ebd29(0xaf)]!==auth_state_enum_1[_0x4ebd29(0xb0)][_0x4ebd29(0xb5)])return this[_0x4ebd29(0x90)][_0x4ebd29(0x7b)](_0x4ebd29(0x9d)),await(0x0,utils_1[_0x4ebd29(0x8f)])(this[_0x4ebd29(0xa6)]),this['waitAuth']();}['getAuthData'](){const _0x2da834=a232_0x16eeef;return{'orgId':this[_0x2da834(0xd2)],'accessToken':this[_0x2da834(0xbf)],'instanceUrl':this[_0x2da834(0x7e)]};}async[a232_0x16eeef(0x95)](){const _0x529f21=a232_0x16eeef;return await this[_0x529f21(0x80)](),{'baseURL':this['instanceUrl'],'headers':{'accept':'application/json','authorization':this[_0x529f21(0xa0)]+'\x20'+this[_0x529f21(0xbf)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a232_0x16eeef(0xa9)])(),__metadata(a232_0x16eeef(0xb6),[])],SalesforceAuthService),exports[a232_0x16eeef(0x9f)]=SalesforceAuthService;