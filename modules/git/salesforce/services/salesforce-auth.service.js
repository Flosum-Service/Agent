const a259_0x414faa=a259_0x2e2e;function a259_0x1fea(){const _0x108ea5=['__createBinding','waitAuth','authState','../../../shared/utils','requestConfig','385768MxSGQx','32QmQeLk','authorization','axios','error','</met:sessionId>','2899095zjwgcN','AUTH_WAIT_TIME','Service','@flosum/salesforce','services/data/','application/json','2406dzMJtC','10964zvYOvR','defineProperty','instanceUrl','16924qNHSWU','object','design:paramtypes','get','__importStar','function','length','../../../../core','toString','__esModule','ERR_INVALID_SALESFORCE_TOKEN','(((.+)+)+)+$','SalesforceUtils','metadata','prototype','6CbgnKZ','AuthState','hasOwnProperty','writable','Idle','Update\x20access\x20token\x20failed:\x20%s','constructor','__decorate','response','salesforce','Logger','sleep','../../../../constants','5434620zbgOdQ','refresh_token','Update\x20access\x20token','data','SalesforceAuthService','<met:sessionId>','isBulk1Url','../enums/auth-state.enum','setAuthDetails','/services/oauth2/token','Updating','UnauthorizedSalesforceError','search','Check\x20auth:\x20current\x20state\x20-\x20%s','default','Access\x20token\x20updated\x20for\x20%s','Active','headers','name','SALESFORCE_API_VERSION','X-SFDC-Session','../errors/unauthorized-salesforce.error','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','instance_url','call','Error','logger','468721HeKEYF','catch','updateAccessToken','__setModuleDefault','InvalidRefreshTokenError','forceUpdateToken','log','Tokens','959dAQqWj','configurable','access_token','accessToken','apply','../../../../constants/errors','Force\x20update\x20token','45IKCWZC','token_type','post'];a259_0x1fea=function(){return _0x108ea5;};return a259_0x1fea();}(function(_0x42db5e,_0x46d01a){const _0x518d59=a259_0x2e2e,_0x28f4ed=_0x42db5e();while(!![]){try{const _0x32dee7=parseInt(_0x518d59(0x1ac))/0x1*(-parseInt(_0x518d59(0x19d))/0x2)+-parseInt(_0x518d59(0x1bb))/0x3*(parseInt(_0x518d59(0x1a9))/0x4)+parseInt(_0x518d59(0x1a2))/0x5+parseInt(_0x518d59(0x1a8))/0x6*(-parseInt(_0x518d59(0x18d))/0x7)+parseInt(_0x518d59(0x19c))/0x8*(-parseInt(_0x518d59(0x194))/0x9)+parseInt(_0x518d59(0x1c8))/0xa+-parseInt(_0x518d59(0x185))/0xb;if(_0x32dee7===_0x46d01a)break;else _0x28f4ed['push'](_0x28f4ed['shift']());}catch(_0x1c3dfb){_0x28f4ed['push'](_0x28f4ed['shift']());}}}(a259_0x1fea,0x7c1ca));const a259_0x21bee3=(function(){let _0x47ad61=!![];return function(_0x4917bb,_0x551460){const _0xba2880=_0x47ad61?function(){const _0x217c71=a259_0x2e2e;if(_0x551460){const _0x39393a=_0x551460[_0x217c71(0x191)](_0x4917bb,arguments);return _0x551460=null,_0x39393a;}}:function(){};return _0x47ad61=![],_0xba2880;};}()),a259_0x1d7b67=a259_0x21bee3(this,function(){const _0x114a3b=a259_0x2e2e;return a259_0x1d7b67[_0x114a3b(0x1b4)]()[_0x114a3b(0x176)]('(((.+)+)+)+$')[_0x114a3b(0x1b4)]()[_0x114a3b(0x1c1)](a259_0x1d7b67)['search'](_0x114a3b(0x1b7));});a259_0x1d7b67();'use strict';var __createBinding=this&&this[a259_0x414faa(0x197)]||(Object['create']?function(_0x497ab5,_0x7d4787,_0xf00e21,_0xaf23cd){const _0x51b4df=a259_0x414faa;if(_0xaf23cd===undefined)_0xaf23cd=_0xf00e21;var _0x3c3d10=Object['getOwnPropertyDescriptor'](_0x7d4787,_0xf00e21);(!_0x3c3d10||('get'in _0x3c3d10?!_0x7d4787[_0x51b4df(0x1b5)]:_0x3c3d10[_0x51b4df(0x1be)]||_0x3c3d10[_0x51b4df(0x18e)]))&&(_0x3c3d10={'enumerable':!![],'get':function(){return _0x7d4787[_0xf00e21];}}),Object[_0x51b4df(0x1aa)](_0x497ab5,_0xaf23cd,_0x3c3d10);}:function(_0x51f6ab,_0x59ea2e,_0x752137,_0x52b211){if(_0x52b211===undefined)_0x52b211=_0x752137;_0x51f6ab[_0x52b211]=_0x59ea2e[_0x752137];}),__setModuleDefault=this&&this[a259_0x414faa(0x188)]||(Object['create']?function(_0x57112d,_0x5baed1){const _0x17843c=a259_0x414faa;Object['defineProperty'](_0x57112d,_0x17843c(0x178),{'enumerable':!![],'value':_0x5baed1});}:function(_0x1aac35,_0x2e3c5f){_0x1aac35['default']=_0x2e3c5f;}),__decorate=this&&this[a259_0x414faa(0x1c2)]||function(_0x773b1b,_0x14f73e,_0x1b3cbd,_0x37f1ad){const _0x1db1d2=a259_0x414faa;var _0x5457a9=arguments[_0x1db1d2(0x1b2)],_0x1ca966=_0x5457a9<0x3?_0x14f73e:_0x37f1ad===null?_0x37f1ad=Object['getOwnPropertyDescriptor'](_0x14f73e,_0x1b3cbd):_0x37f1ad,_0xba5bb4;if(typeof Reflect===_0x1db1d2(0x1ad)&&typeof Reflect['decorate']===_0x1db1d2(0x1b1))_0x1ca966=Reflect['decorate'](_0x773b1b,_0x14f73e,_0x1b3cbd,_0x37f1ad);else{for(var _0x5a0afb=_0x773b1b['length']-0x1;_0x5a0afb>=0x0;_0x5a0afb--)if(_0xba5bb4=_0x773b1b[_0x5a0afb])_0x1ca966=(_0x5457a9<0x3?_0xba5bb4(_0x1ca966):_0x5457a9>0x3?_0xba5bb4(_0x14f73e,_0x1b3cbd,_0x1ca966):_0xba5bb4(_0x14f73e,_0x1b3cbd))||_0x1ca966;}return _0x5457a9>0x3&&_0x1ca966&&Object['defineProperty'](_0x14f73e,_0x1b3cbd,_0x1ca966),_0x1ca966;},__importStar=this&&this[a259_0x414faa(0x1b0)]||function(_0x55baba){const _0x57998f=a259_0x414faa;if(_0x55baba&&_0x55baba['__esModule'])return _0x55baba;var _0x333eb8={};if(_0x55baba!=null){for(var _0x57d7ae in _0x55baba)if(_0x57d7ae!=='default'&&Object[_0x57998f(0x1ba)][_0x57998f(0x1bd)][_0x57998f(0x182)](_0x55baba,_0x57d7ae))__createBinding(_0x333eb8,_0x55baba,_0x57d7ae);}return __setModuleDefault(_0x333eb8,_0x55baba),_0x333eb8;},__metadata=this&&this['__metadata']||function(_0x25277c,_0x4bd263){const _0x9d7686=a259_0x414faa;if(typeof Reflect===_0x9d7686(0x1ad)&&typeof Reflect['metadata']===_0x9d7686(0x1b1))return Reflect[_0x9d7686(0x1b9)](_0x25277c,_0x4bd263);},__importDefault=this&&this['__importDefault']||function(_0x148858){return _0x148858&&_0x148858['__esModule']?_0x148858:{'default':_0x148858};},SalesforceAuthService_1;Object[a259_0x414faa(0x1aa)](exports,'__esModule',{'value':!![]}),exports['SalesforceAuthService']=void 0x0;function a259_0x2e2e(_0x437da1,_0x315368){const _0x438a99=a259_0x1fea();return a259_0x2e2e=function(_0x1d7b67,_0x21bee3){_0x1d7b67=_0x1d7b67-0x16d;let _0x1feadf=_0x438a99[_0x1d7b67];return _0x1feadf;},a259_0x2e2e(_0x437da1,_0x315368);}const typedi_1=__importStar(require('typedi')),errors_1=require(a259_0x414faa(0x192)),core_1=require(a259_0x414faa(0x1b3)),axios_1=__importDefault(require(a259_0x414faa(0x19f))),utils_1=require(a259_0x414faa(0x19a)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a259_0x414faa(0x171)),unauthorized_salesforce_error_1=require(a259_0x414faa(0x17f)),constants_1=require(a259_0x414faa(0x1c7)),providers_tokens_1=require('../../providers/providers.tokens'),salesforce_1=require(a259_0x414faa(0x1a5));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x5f006b=a259_0x414faa;this['AUTH_WAIT_TIME']=0x1388,this[_0x5f006b(0x199)]=auth_state_enum_1[_0x5f006b(0x1bc)][_0x5f006b(0x1bf)],this[_0x5f006b(0x184)]=new core_1[(_0x5f006b(0x1c5))](SalesforceAuthService_1[_0x5f006b(0x17c)]),this[_0x5f006b(0x172)]();}async[a259_0x414faa(0x172)](){const _0x47606e=a259_0x414faa;this[_0x47606e(0x184)][_0x47606e(0x18b)](_0x47606e(0x177),auth_state_enum_1[_0x47606e(0x1bc)][this[_0x47606e(0x199)]]);try{if(this[_0x47606e(0x199)]===auth_state_enum_1[_0x47606e(0x1bc)][_0x47606e(0x183)])return;if(this[_0x47606e(0x199)]===auth_state_enum_1[_0x47606e(0x1bc)][_0x47606e(0x1bf)])await this['updateAccessToken']();else{const _0x24e60c=await this[_0x47606e(0x19b)](),_0x103d5e=await axios_1[_0x47606e(0x178)][_0x47606e(0x1af)](_0x47606e(0x1a6)+constants_1[_0x47606e(0x17d)],_0x24e60c)['then'](()=>!![])[_0x47606e(0x186)](()=>![]);!_0x103d5e&&await this['updateAccessToken']();}}catch(_0x9643b5){}}async['updateAccessToken'](){const _0x5acd9f=a259_0x414faa;var _0x1906ce,_0x2595d8,_0x13ecc7;this['logger'][_0x5acd9f(0x18b)](_0x5acd9f(0x1ca));try{this['authState']=auth_state_enum_1[_0x5acd9f(0x1bc)][_0x5acd9f(0x174)];const {refreshToken:_0x2e195c,clientId:_0xc3d9bd,clientSecret:_0xfea632,loginUrl:_0x5956d7}=typedi_1['default'][_0x5acd9f(0x1af)](providers_tokens_1[_0x5acd9f(0x18c)][_0x5acd9f(0x1c4)]),{data:_0x525dbf}=await axios_1[_0x5acd9f(0x178)][_0x5acd9f(0x196)]((0x0,utils_1['joinURL'])(_0x5956d7,_0x5acd9f(0x173)),null,{'params':{'grant_type':_0x5acd9f(0x1c9),'refresh_token':_0x2e195c,'client_id':_0xc3d9bd,'client_secret':_0xfea632}});this[_0x5acd9f(0x1ab)]=_0x525dbf[_0x5acd9f(0x181)],this[_0x5acd9f(0x190)]=_0x525dbf[_0x5acd9f(0x18f)],this['tokenType']=_0x525dbf[_0x5acd9f(0x195)],this[_0x5acd9f(0x199)]=auth_state_enum_1[_0x5acd9f(0x1bc)]['Active'],this[_0x5acd9f(0x184)]['log'](_0x5acd9f(0x179),this[_0x5acd9f(0x1ab)]);}catch(_0x25cbbc){const _0x526aee=((_0x2595d8=(_0x1906ce=_0x25cbbc===null||_0x25cbbc===void 0x0?void 0x0:_0x25cbbc[_0x5acd9f(0x1c3)])===null||_0x1906ce===void 0x0?void 0x0:_0x1906ce[_0x5acd9f(0x16d)])===null||_0x2595d8===void 0x0?void 0x0:_0x2595d8[_0x5acd9f(0x1a0)])||((_0x13ecc7=_0x25cbbc===null||_0x25cbbc===void 0x0?void 0x0:_0x25cbbc[_0x5acd9f(0x1c3)])===null||_0x13ecc7===void 0x0?void 0x0:_0x13ecc7[_0x5acd9f(0x16d)])||_0x25cbbc['message'];this[_0x5acd9f(0x184)][_0x5acd9f(0x1a0)](_0x5acd9f(0x1c0),_0x526aee),this[_0x5acd9f(0x199)]=auth_state_enum_1[_0x5acd9f(0x1bc)][_0x5acd9f(0x183)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x5acd9f(0x1b6)]);}}async[a259_0x414faa(0x18a)](){const _0x50f62b=a259_0x414faa;this[_0x50f62b(0x184)][_0x50f62b(0x18b)](_0x50f62b(0x193));if(this[_0x50f62b(0x199)]===auth_state_enum_1[_0x50f62b(0x1bc)][_0x50f62b(0x174)]||this[_0x50f62b(0x199)]===auth_state_enum_1[_0x50f62b(0x1bc)][_0x50f62b(0x1bf)])return await(0x0,utils_1[_0x50f62b(0x1c6)])(this[_0x50f62b(0x1a3)]),this[_0x50f62b(0x18a)]();if(this[_0x50f62b(0x199)]===auth_state_enum_1[_0x50f62b(0x1bc)][_0x50f62b(0x183)])throw new invalid_refresh_token_error_1[(_0x50f62b(0x189))](errors_1[_0x50f62b(0x1b6)]);await this[_0x50f62b(0x187)]();}async[a259_0x414faa(0x198)](){const _0x119d53=a259_0x414faa;if(this[_0x119d53(0x199)]===auth_state_enum_1[_0x119d53(0x1bc)][_0x119d53(0x183)]){this[_0x119d53(0x184)]['log'](_0x119d53(0x180));throw new unauthorized_salesforce_error_1[(_0x119d53(0x175))]();}if(this[_0x119d53(0x199)]!==auth_state_enum_1[_0x119d53(0x1bc)][_0x119d53(0x17a)])return this[_0x119d53(0x184)][_0x119d53(0x18b)]('Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x119d53(0x1c6)])(this[_0x119d53(0x1a3)]),this['waitAuth']();}['getAuthData'](){return{'orgId':this['orgId'],'accessToken':this['accessToken'],'instanceUrl':this['instanceUrl']};}async[a259_0x414faa(0x19b)](_0x28d5f8=''){const _0x1d962f=a259_0x414faa;await this[_0x1d962f(0x198)]();const _0x6150fa={'baseURL':this['instanceUrl'],'headers':{'accept':_0x1d962f(0x1a7)}};if(salesforce_1[_0x1d962f(0x1b8)][_0x1d962f(0x170)](_0x28d5f8))_0x6150fa[_0x1d962f(0x17b)][_0x1d962f(0x17e)]=this[_0x1d962f(0x190)];else salesforce_1[_0x1d962f(0x1b8)]['isSoapUrl'](_0x28d5f8)?_0x6150fa[_0x1d962f(0x16d)]=_0x6150fa['data']['replace'](/<met:sessionId>.+?<\/met:sessionId>/,_0x1d962f(0x16f)+this[_0x1d962f(0x190)]+_0x1d962f(0x1a1)):_0x6150fa['headers'][_0x1d962f(0x19e)]=this['tokenType']+'\x20'+this[_0x1d962f(0x190)];return _0x6150fa;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a259_0x414faa(0x1a4)])(),__metadata(a259_0x414faa(0x1ae),[])],SalesforceAuthService),exports[a259_0x414faa(0x16e)]=SalesforceAuthService;