const a232_0x5db09d=a232_0x384e;function a232_0x3ef0(){const _0x3f20f3=['hasOwnProperty','toString','post','updateAccessToken','SalesforceAuthService','../errors/unauthorized-salesforce.error','access\x20token\x20updated\x20for\x20%s','refresh_token','default','__importStar','search','setAuthDetails','Service','(((.+)+)+)+$','instanceUrl','SALESFORCE_API_VERSION','__importDefault','1466694uWswer','services/data/','apply','salesforce','__createBinding','AUTH_WAIT_TIME','7mqKIXy','/services/oauth2/token','length','23938qMfzuI','instance_url','waitAuth','ERR_INVALID_SALESFORCE_TOKEN','logger','forceUpdateToken','response','getOwnPropertyDescriptor','AuthState','Tokens','3838860NfaaGO','data','__esModule','joinURL','../../../../core','__setModuleDefault','prototype','Logger','metadata','accessToken','95ULHQHZ','error','requestConfig','catch','object','check\x20auth:\x20current\x20state\x20-\x20%s','Idle','__metadata','Active','authState','log','application/json','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','call','decorate','UnauthorizedSalesforceError','20778507znNxOz','__decorate','631086CarShX','2456576syeWUw','force\x20update\x20token','../../providers/providers.tokens','token_type','get','tokenType','axios','getAuthData','Updating','../../../../constants/errors','create','InvalidRefreshTokenError','defineProperty','10474336ocnrma','function','configurable','Error','typedi','message','sleep'];a232_0x3ef0=function(){return _0x3f20f3;};return a232_0x3ef0();}(function(_0x14638b,_0x3b3c6a){const _0x4a8b2d=a232_0x384e,_0x49c54d=_0x14638b();while(!![]){try{const _0x51ebe6=-parseInt(_0x4a8b2d(0x155))/0x1*(-parseInt(_0x4a8b2d(0x141))/0x2)+parseInt(_0x4a8b2d(0x167))/0x3+-parseInt(_0x4a8b2d(0x168))/0x4+parseInt(_0x4a8b2d(0x14b))/0x5+-parseInt(_0x4a8b2d(0x138))/0x6*(-parseInt(_0x4a8b2d(0x13e))/0x7)+parseInt(_0x4a8b2d(0x120))/0x8+-parseInt(_0x4a8b2d(0x165))/0x9;if(_0x51ebe6===_0x3b3c6a)break;else _0x49c54d['push'](_0x49c54d['shift']());}catch(_0x188cdc){_0x49c54d['push'](_0x49c54d['shift']());}}}(a232_0x3ef0,0xb624f));function a232_0x384e(_0x5dc5fb,_0x17ea41){const _0x20d0e0=a232_0x3ef0();return a232_0x384e=function(_0x1dccbb,_0x5216e0){_0x1dccbb=_0x1dccbb-0x11d;let _0x3ef0e9=_0x20d0e0[_0x1dccbb];return _0x3ef0e9;},a232_0x384e(_0x5dc5fb,_0x17ea41);}const a232_0x5216e0=(function(){let _0x375391=!![];return function(_0x2629e2,_0x51c948){const _0x129db2=_0x375391?function(){const _0x540719=a232_0x384e;if(_0x51c948){const _0x2db64a=_0x51c948[_0x540719(0x13a)](_0x2629e2,arguments);return _0x51c948=null,_0x2db64a;}}:function(){};return _0x375391=![],_0x129db2;};}()),a232_0x1dccbb=a232_0x5216e0(this,function(){const _0x3b0962=a232_0x384e;return a232_0x1dccbb[_0x3b0962(0x128)]()[_0x3b0962(0x131)](_0x3b0962(0x134))['toString']()['constructor'](a232_0x1dccbb)[_0x3b0962(0x131)](_0x3b0962(0x134));});a232_0x1dccbb();'use strict';var __createBinding=this&&this[a232_0x5db09d(0x13c)]||(Object[a232_0x5db09d(0x11d)]?function(_0x312baf,_0x1a565c,_0x33a803,_0x24f7e0){const _0x1cc846=a232_0x5db09d;if(_0x24f7e0===undefined)_0x24f7e0=_0x33a803;var _0x2d4f2f=Object[_0x1cc846(0x148)](_0x1a565c,_0x33a803);(!_0x2d4f2f||('get'in _0x2d4f2f?!_0x1a565c[_0x1cc846(0x14d)]:_0x2d4f2f['writable']||_0x2d4f2f[_0x1cc846(0x122)]))&&(_0x2d4f2f={'enumerable':!![],'get':function(){return _0x1a565c[_0x33a803];}}),Object[_0x1cc846(0x11f)](_0x312baf,_0x24f7e0,_0x2d4f2f);}:function(_0x2d3add,_0x5a0feb,_0x701f98,_0x14dc7f){if(_0x14dc7f===undefined)_0x14dc7f=_0x701f98;_0x2d3add[_0x14dc7f]=_0x5a0feb[_0x701f98];}),__setModuleDefault=this&&this[a232_0x5db09d(0x150)]||(Object[a232_0x5db09d(0x11d)]?function(_0x1c5696,_0x3406a1){const _0x26a4fd=a232_0x5db09d;Object[_0x26a4fd(0x11f)](_0x1c5696,_0x26a4fd(0x12f),{'enumerable':!![],'value':_0x3406a1});}:function(_0x409ee2,_0x23846e){const _0x14608c=a232_0x5db09d;_0x409ee2[_0x14608c(0x12f)]=_0x23846e;}),__decorate=this&&this[a232_0x5db09d(0x166)]||function(_0x4290dd,_0x1047d1,_0x56834b,_0x5001c2){const _0x242cfb=a232_0x5db09d;var _0x326adf=arguments[_0x242cfb(0x140)],_0x27fd59=_0x326adf<0x3?_0x1047d1:_0x5001c2===null?_0x5001c2=Object[_0x242cfb(0x148)](_0x1047d1,_0x56834b):_0x5001c2,_0x792cba;if(typeof Reflect===_0x242cfb(0x159)&&typeof Reflect[_0x242cfb(0x163)]===_0x242cfb(0x121))_0x27fd59=Reflect[_0x242cfb(0x163)](_0x4290dd,_0x1047d1,_0x56834b,_0x5001c2);else{for(var _0x2998a3=_0x4290dd[_0x242cfb(0x140)]-0x1;_0x2998a3>=0x0;_0x2998a3--)if(_0x792cba=_0x4290dd[_0x2998a3])_0x27fd59=(_0x326adf<0x3?_0x792cba(_0x27fd59):_0x326adf>0x3?_0x792cba(_0x1047d1,_0x56834b,_0x27fd59):_0x792cba(_0x1047d1,_0x56834b))||_0x27fd59;}return _0x326adf>0x3&&_0x27fd59&&Object[_0x242cfb(0x11f)](_0x1047d1,_0x56834b,_0x27fd59),_0x27fd59;},__importStar=this&&this[a232_0x5db09d(0x130)]||function(_0x375b57){const _0x1f6021=a232_0x5db09d;if(_0x375b57&&_0x375b57['__esModule'])return _0x375b57;var _0x237108={};if(_0x375b57!=null){for(var _0x13ca1b in _0x375b57)if(_0x13ca1b!==_0x1f6021(0x12f)&&Object[_0x1f6021(0x151)][_0x1f6021(0x127)][_0x1f6021(0x162)](_0x375b57,_0x13ca1b))__createBinding(_0x237108,_0x375b57,_0x13ca1b);}return __setModuleDefault(_0x237108,_0x375b57),_0x237108;},__metadata=this&&this[a232_0x5db09d(0x15c)]||function(_0x5eda7e,_0x1deb77){const _0x54ae90=a232_0x5db09d;if(typeof Reflect===_0x54ae90(0x159)&&typeof Reflect[_0x54ae90(0x153)]===_0x54ae90(0x121))return Reflect[_0x54ae90(0x153)](_0x5eda7e,_0x1deb77);},__importDefault=this&&this[a232_0x5db09d(0x137)]||function(_0x261d1e){const _0x18cc7b=a232_0x5db09d;return _0x261d1e&&_0x261d1e[_0x18cc7b(0x14d)]?_0x261d1e:{'default':_0x261d1e};},SalesforceAuthService_1;Object[a232_0x5db09d(0x11f)](exports,a232_0x5db09d(0x14d),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a232_0x5db09d(0x124))),errors_1=require(a232_0x5db09d(0x171)),core_1=require(a232_0x5db09d(0x14f)),axios_1=__importDefault(require(a232_0x5db09d(0x16e))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a232_0x5db09d(0x12c)),constants_1=require('../../../../constants'),providers_tokens_1=require(a232_0x5db09d(0x16a));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x515d87=a232_0x5db09d;this['AUTH_WAIT_TIME']=0x1388,this[_0x515d87(0x15e)]=auth_state_enum_1[_0x515d87(0x149)][_0x515d87(0x15b)],this['logger']=new core_1[(_0x515d87(0x152))](SalesforceAuthService_1['name']),this[_0x515d87(0x132)]();}async[a232_0x5db09d(0x132)](){const _0x27c13c=a232_0x5db09d;this[_0x27c13c(0x145)][_0x27c13c(0x15f)](_0x27c13c(0x15a),auth_state_enum_1[_0x27c13c(0x149)][this[_0x27c13c(0x15e)]]);try{if(this[_0x27c13c(0x15e)]===auth_state_enum_1[_0x27c13c(0x149)][_0x27c13c(0x123)])return;if(this[_0x27c13c(0x15e)]===auth_state_enum_1[_0x27c13c(0x149)][_0x27c13c(0x15b)])await this['updateAccessToken']();else{const _0x1d805f=await this[_0x27c13c(0x157)](),_0x48fb17=await axios_1[_0x27c13c(0x12f)][_0x27c13c(0x16c)](_0x27c13c(0x139)+constants_1[_0x27c13c(0x136)],_0x1d805f)['then'](()=>!![])[_0x27c13c(0x158)](()=>![]);!_0x48fb17&&await this[_0x27c13c(0x12a)]();}}catch(_0x4074e7){}}async[a232_0x5db09d(0x12a)](){const _0x27ef5e=a232_0x5db09d;var _0x5d9e60,_0x266401,_0x1afdad;this[_0x27ef5e(0x145)]['log']('update\x20access\x20token');try{this['authState']=auth_state_enum_1[_0x27ef5e(0x149)][_0x27ef5e(0x170)];const {refreshToken:_0x3294fb,clientId:_0x1725c6,clientSecret:_0x4ea823,loginUrl:_0x2d2d37}=typedi_1['default'][_0x27ef5e(0x16c)](providers_tokens_1[_0x27ef5e(0x14a)][_0x27ef5e(0x13b)]),{data:_0x5e5876}=await axios_1[_0x27ef5e(0x12f)][_0x27ef5e(0x129)]((0x0,utils_1[_0x27ef5e(0x14e)])(_0x2d2d37,_0x27ef5e(0x13f)),null,{'params':{'grant_type':_0x27ef5e(0x12e),'refresh_token':_0x3294fb,'client_id':_0x1725c6,'client_secret':_0x4ea823}});this[_0x27ef5e(0x135)]=_0x5e5876[_0x27ef5e(0x142)],this[_0x27ef5e(0x154)]=_0x5e5876['access_token'],this[_0x27ef5e(0x16d)]=_0x5e5876[_0x27ef5e(0x16b)],this['authState']=auth_state_enum_1['AuthState'][_0x27ef5e(0x15d)],this[_0x27ef5e(0x145)][_0x27ef5e(0x15f)](_0x27ef5e(0x12d),this[_0x27ef5e(0x135)]);}catch(_0x3f521b){const _0x490429=((_0x266401=(_0x5d9e60=_0x3f521b===null||_0x3f521b===void 0x0?void 0x0:_0x3f521b[_0x27ef5e(0x147)])===null||_0x5d9e60===void 0x0?void 0x0:_0x5d9e60[_0x27ef5e(0x14c)])===null||_0x266401===void 0x0?void 0x0:_0x266401[_0x27ef5e(0x156)])||((_0x1afdad=_0x3f521b===null||_0x3f521b===void 0x0?void 0x0:_0x3f521b['response'])===null||_0x1afdad===void 0x0?void 0x0:_0x1afdad[_0x27ef5e(0x14c)])||_0x3f521b[_0x27ef5e(0x125)];this[_0x27ef5e(0x145)]['error']('update\x20access\x20token\x20failed:\x20%s',_0x490429),this[_0x27ef5e(0x15e)]=auth_state_enum_1[_0x27ef5e(0x149)]['Error'];throw new invalid_refresh_token_error_1[(_0x27ef5e(0x11e))](errors_1[_0x27ef5e(0x144)]);}}async[a232_0x5db09d(0x146)](){const _0x1744cd=a232_0x5db09d;this[_0x1744cd(0x145)][_0x1744cd(0x15f)](_0x1744cd(0x169));if(this[_0x1744cd(0x15e)]===auth_state_enum_1[_0x1744cd(0x149)]['Updating']||this[_0x1744cd(0x15e)]===auth_state_enum_1[_0x1744cd(0x149)][_0x1744cd(0x15b)])return await(0x0,utils_1[_0x1744cd(0x126)])(this[_0x1744cd(0x13d)]),this[_0x1744cd(0x146)]();if(this['authState']===auth_state_enum_1[_0x1744cd(0x149)][_0x1744cd(0x123)])throw new invalid_refresh_token_error_1[(_0x1744cd(0x11e))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this['updateAccessToken']();}async[a232_0x5db09d(0x143)](){const _0x5a5326=a232_0x5db09d;if(this['authState']===auth_state_enum_1[_0x5a5326(0x149)][_0x5a5326(0x123)]){this['logger'][_0x5a5326(0x15f)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x5a5326(0x164))]();}if(this[_0x5a5326(0x15e)]!==auth_state_enum_1['AuthState'][_0x5a5326(0x15d)])return this[_0x5a5326(0x145)][_0x5a5326(0x15f)](_0x5a5326(0x161)),await(0x0,utils_1[_0x5a5326(0x126)])(this[_0x5a5326(0x13d)]),this[_0x5a5326(0x143)]();}[a232_0x5db09d(0x16f)](){const _0x2c2af6=a232_0x5db09d;return{'orgId':this['orgId'],'accessToken':this[_0x2c2af6(0x154)],'instanceUrl':this['instanceUrl']};}async[a232_0x5db09d(0x157)](){const _0x38c2f8=a232_0x5db09d;return await this[_0x38c2f8(0x143)](),{'baseURL':this[_0x38c2f8(0x135)],'headers':{'accept':_0x38c2f8(0x160),'authorization':this['tokenType']+'\x20'+this[_0x38c2f8(0x154)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a232_0x5db09d(0x133)])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports[a232_0x5db09d(0x12b)]=SalesforceAuthService;