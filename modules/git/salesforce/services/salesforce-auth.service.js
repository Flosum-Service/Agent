function a232_0x54e3(){const _0x589873=['Error','3316WNRmXY','forceUpdateToken','262YBGEeZ','../../../../core','1375WxUzaM','salesforce','then','6484688rvxlwA','SALESFORCE_API_VERSION','configurable','InvalidRefreshTokenError','default','length','../errors/invalid-refresh-token.error','application/json','10310aBJSWu','12326648CJiPsL','object','AuthState','sleep','SalesforceAuthService','authState','log','Active','Idle','response','check\x20auth:\x20current\x20state\x20-\x20%s','9StcRPB','(((.+)+)+)+$','access_token','3545640CxQrHk','message','axios','defineProperty','search','typedi','waitAuth','get','Tokens','accessToken','getAuthData','prototype','__metadata','data','AUTH_WAIT_TIME','constructor','__decorate','logger','205340MbTrdu','instance_url','orgId','writable','toString','../../../../constants','token_type','tokenType','apply','__esModule','../../../../constants/errors','create','metadata','joinURL','force\x20update\x20token','requestConfig','hasOwnProperty','__setModuleDefault','../enums/auth-state.enum','../../../shared/utils','instanceUrl','services/data/','create\x20authorized\x20request\x20failed:\x20authorization\x20error','function','update\x20access\x20token','__importStar','36048hNuQSn','ERR_INVALID_SALESFORCE_TOKEN','Updating','getOwnPropertyDescriptor','name','error','updateAccessToken','511682UAwxVx'];a232_0x54e3=function(){return _0x589873;};return a232_0x54e3();}const a232_0x3365a2=a232_0x7504;function a232_0x7504(_0x1915f3,_0x521b31){const _0x3fc984=a232_0x54e3();return a232_0x7504=function(_0x540fc3,_0x3ced76){_0x540fc3=_0x540fc3-0xb6;let _0x54e36d=_0x3fc984[_0x540fc3];return _0x54e36d;},a232_0x7504(_0x1915f3,_0x521b31);}(function(_0x200f0b,_0x10004d){const _0x20e4a6=a232_0x7504,_0x4d71e2=_0x200f0b();while(!![]){try{const _0x56fdd1=-parseInt(_0x20e4a6(0xe5))/0x1+-parseInt(_0x20e4a6(0xe9))/0x2*(parseInt(_0x20e4a6(0xde))/0x3)+parseInt(_0x20e4a6(0xe7))/0x4*(parseInt(_0x20e4a6(0xf6))/0x5)+-parseInt(_0x20e4a6(0x105))/0x6+parseInt(_0x20e4a6(0xee))/0x7+-parseInt(_0x20e4a6(0xf7))/0x8*(parseInt(_0x20e4a6(0x102))/0x9)+-parseInt(_0x20e4a6(0xc4))/0xa*(-parseInt(_0x20e4a6(0xeb))/0xb);if(_0x56fdd1===_0x10004d)break;else _0x4d71e2['push'](_0x4d71e2['shift']());}catch(_0x452b7d){_0x4d71e2['push'](_0x4d71e2['shift']());}}}(a232_0x54e3,0xf0797));const a232_0x3ced76=(function(){let _0x2311f6=!![];return function(_0x645213,_0x1f995e){const _0x32af82=_0x2311f6?function(){const _0x1e972b=a232_0x7504;if(_0x1f995e){const _0x37ab88=_0x1f995e[_0x1e972b(0xcc)](_0x645213,arguments);return _0x1f995e=null,_0x37ab88;}}:function(){};return _0x2311f6=![],_0x32af82;};}()),a232_0x540fc3=a232_0x3ced76(this,function(){const _0x56a08f=a232_0x7504;return a232_0x540fc3[_0x56a08f(0xc8)]()['search'](_0x56a08f(0x103))['toString']()[_0x56a08f(0xc1)](a232_0x540fc3)[_0x56a08f(0xb6)]('(((.+)+)+)+$');});a232_0x540fc3();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a232_0x3365a2(0xcf)]?function(_0x295679,_0x4e17ec,_0x433563,_0x1db4e1){const _0x1ae080=a232_0x3365a2;if(_0x1db4e1===undefined)_0x1db4e1=_0x433563;var _0x90591c=Object[_0x1ae080(0xe1)](_0x4e17ec,_0x433563);(!_0x90591c||(_0x1ae080(0xb9)in _0x90591c?!_0x4e17ec[_0x1ae080(0xcd)]:_0x90591c[_0x1ae080(0xc7)]||_0x90591c[_0x1ae080(0xf0)]))&&(_0x90591c={'enumerable':!![],'get':function(){return _0x4e17ec[_0x433563];}}),Object[_0x1ae080(0x108)](_0x295679,_0x1db4e1,_0x90591c);}:function(_0xcd6ac1,_0x4802ee,_0x3bded7,_0x2588e3){if(_0x2588e3===undefined)_0x2588e3=_0x3bded7;_0xcd6ac1[_0x2588e3]=_0x4802ee[_0x3bded7];}),__setModuleDefault=this&&this[a232_0x3365a2(0xd5)]||(Object['create']?function(_0x96570e,_0x3ee6){const _0x295f65=a232_0x3365a2;Object[_0x295f65(0x108)](_0x96570e,_0x295f65(0xf2),{'enumerable':!![],'value':_0x3ee6});}:function(_0x223382,_0x4e159d){const _0x46e3ad=a232_0x3365a2;_0x223382[_0x46e3ad(0xf2)]=_0x4e159d;}),__decorate=this&&this[a232_0x3365a2(0xc2)]||function(_0x63ee17,_0x4367e4,_0x5df557,_0x33e69d){const _0x447c2b=a232_0x3365a2;var _0x2ad812=arguments['length'],_0x34af52=_0x2ad812<0x3?_0x4367e4:_0x33e69d===null?_0x33e69d=Object[_0x447c2b(0xe1)](_0x4367e4,_0x5df557):_0x33e69d,_0x26b64a;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x34af52=Reflect['decorate'](_0x63ee17,_0x4367e4,_0x5df557,_0x33e69d);else{for(var _0x17d527=_0x63ee17[_0x447c2b(0xf3)]-0x1;_0x17d527>=0x0;_0x17d527--)if(_0x26b64a=_0x63ee17[_0x17d527])_0x34af52=(_0x2ad812<0x3?_0x26b64a(_0x34af52):_0x2ad812>0x3?_0x26b64a(_0x4367e4,_0x5df557,_0x34af52):_0x26b64a(_0x4367e4,_0x5df557))||_0x34af52;}return _0x2ad812>0x3&&_0x34af52&&Object[_0x447c2b(0x108)](_0x4367e4,_0x5df557,_0x34af52),_0x34af52;},__importStar=this&&this[a232_0x3365a2(0xdd)]||function(_0x5a394b){const _0x274a02=a232_0x3365a2;if(_0x5a394b&&_0x5a394b[_0x274a02(0xcd)])return _0x5a394b;var _0x25486c={};if(_0x5a394b!=null){for(var _0x2b9c3f in _0x5a394b)if(_0x2b9c3f!==_0x274a02(0xf2)&&Object[_0x274a02(0xbd)][_0x274a02(0xd4)]['call'](_0x5a394b,_0x2b9c3f))__createBinding(_0x25486c,_0x5a394b,_0x2b9c3f);}return __setModuleDefault(_0x25486c,_0x5a394b),_0x25486c;},__metadata=this&&this[a232_0x3365a2(0xbe)]||function(_0x5eb133,_0x17c84a){const _0x920987=a232_0x3365a2;if(typeof Reflect===_0x920987(0xf8)&&typeof Reflect[_0x920987(0xd0)]===_0x920987(0xdb))return Reflect[_0x920987(0xd0)](_0x5eb133,_0x17c84a);},__importDefault=this&&this['__importDefault']||function(_0x5a2a94){const _0xef497=a232_0x3365a2;return _0x5a2a94&&_0x5a2a94[_0xef497(0xcd)]?_0x5a2a94:{'default':_0x5a2a94};},SalesforceAuthService_1;Object[a232_0x3365a2(0x108)](exports,a232_0x3365a2(0xcd),{'value':!![]}),exports[a232_0x3365a2(0xfb)]=void 0x0;const typedi_1=__importStar(require(a232_0x3365a2(0xb7))),errors_1=require(a232_0x3365a2(0xce)),core_1=require(a232_0x3365a2(0xea)),axios_1=__importDefault(require(a232_0x3365a2(0x107))),utils_1=require(a232_0x3365a2(0xd7)),invalid_refresh_token_error_1=require(a232_0x3365a2(0xf4)),auth_state_enum_1=require(a232_0x3365a2(0xd6)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a232_0x3365a2(0xc9)),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x783fe7=a232_0x3365a2;this[_0x783fe7(0xc0)]=0x1388,this[_0x783fe7(0xfc)]=auth_state_enum_1['AuthState']['Idle'],this[_0x783fe7(0xc3)]=new core_1['Logger'](SalesforceAuthService_1[_0x783fe7(0xe2)]),this['setAuthDetails']();}async['setAuthDetails'](){const _0x4aa7ed=a232_0x3365a2;this[_0x4aa7ed(0xc3)]['log'](_0x4aa7ed(0x101),auth_state_enum_1['AuthState'][this[_0x4aa7ed(0xfc)]]);try{if(this['authState']===auth_state_enum_1[_0x4aa7ed(0xf9)][_0x4aa7ed(0xe6)])return;if(this[_0x4aa7ed(0xfc)]===auth_state_enum_1[_0x4aa7ed(0xf9)]['Idle'])await this[_0x4aa7ed(0xe4)]();else{const _0xe070dd=await this[_0x4aa7ed(0xd3)](),_0x392d12=await axios_1[_0x4aa7ed(0xf2)][_0x4aa7ed(0xb9)](_0x4aa7ed(0xd9)+constants_1[_0x4aa7ed(0xef)],_0xe070dd)[_0x4aa7ed(0xed)](()=>!![])['catch'](()=>![]);!_0x392d12&&await this[_0x4aa7ed(0xe4)]();}}catch(_0x4cc2d8){}}async['updateAccessToken'](){const _0xfc6736=a232_0x3365a2;var _0x207e42,_0x4fc9c4,_0x43fef0;this[_0xfc6736(0xc3)]['log'](_0xfc6736(0xdc));try{this[_0xfc6736(0xfc)]=auth_state_enum_1[_0xfc6736(0xf9)]['Updating'];const {refreshToken:_0x2181e4,clientId:_0x4c4b69,clientSecret:_0x51bd3d,loginUrl:_0x6018e0}=typedi_1[_0xfc6736(0xf2)][_0xfc6736(0xb9)](providers_tokens_1[_0xfc6736(0xba)][_0xfc6736(0xec)]),{data:_0x1c9efe}=await axios_1[_0xfc6736(0xf2)]['post']((0x0,utils_1[_0xfc6736(0xd1)])(_0x6018e0,'/services/oauth2/token'),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x2181e4,'client_id':_0x4c4b69,'client_secret':_0x51bd3d}});this[_0xfc6736(0xd8)]=_0x1c9efe[_0xfc6736(0xc5)],this['accessToken']=_0x1c9efe[_0xfc6736(0x104)],this['tokenType']=_0x1c9efe[_0xfc6736(0xca)],this[_0xfc6736(0xfc)]=auth_state_enum_1[_0xfc6736(0xf9)][_0xfc6736(0xfe)],this['logger']['log']('access\x20token\x20updated\x20for\x20%s',this[_0xfc6736(0xd8)]);}catch(_0x22a206){const _0x46bc1a=((_0x4fc9c4=(_0x207e42=_0x22a206===null||_0x22a206===void 0x0?void 0x0:_0x22a206[_0xfc6736(0x100)])===null||_0x207e42===void 0x0?void 0x0:_0x207e42[_0xfc6736(0xbf)])===null||_0x4fc9c4===void 0x0?void 0x0:_0x4fc9c4[_0xfc6736(0xe3)])||((_0x43fef0=_0x22a206===null||_0x22a206===void 0x0?void 0x0:_0x22a206[_0xfc6736(0x100)])===null||_0x43fef0===void 0x0?void 0x0:_0x43fef0['data'])||_0x22a206[_0xfc6736(0x106)];this[_0xfc6736(0xc3)][_0xfc6736(0xe3)]('update\x20access\x20token\x20failed:\x20%s',_0x46bc1a),this[_0xfc6736(0xfc)]=auth_state_enum_1[_0xfc6736(0xf9)][_0xfc6736(0xe6)];throw new invalid_refresh_token_error_1[(_0xfc6736(0xf1))](errors_1[_0xfc6736(0xdf)]);}}async[a232_0x3365a2(0xe8)](){const _0x162681=a232_0x3365a2;this[_0x162681(0xc3)][_0x162681(0xfd)](_0x162681(0xd2));if(this[_0x162681(0xfc)]===auth_state_enum_1[_0x162681(0xf9)][_0x162681(0xe0)]||this['authState']===auth_state_enum_1[_0x162681(0xf9)][_0x162681(0xff)])return await(0x0,utils_1[_0x162681(0xfa)])(this[_0x162681(0xc0)]),this['forceUpdateToken']();if(this['authState']===auth_state_enum_1[_0x162681(0xf9)][_0x162681(0xe6)])throw new invalid_refresh_token_error_1[(_0x162681(0xf1))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x162681(0xe4)]();}async[a232_0x3365a2(0xb8)](){const _0x18f00c=a232_0x3365a2;if(this[_0x18f00c(0xfc)]===auth_state_enum_1[_0x18f00c(0xf9)][_0x18f00c(0xe6)]){this[_0x18f00c(0xc3)][_0x18f00c(0xfd)](_0x18f00c(0xda));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x18f00c(0xfc)]!==auth_state_enum_1[_0x18f00c(0xf9)]['Active'])return this[_0x18f00c(0xc3)][_0x18f00c(0xfd)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this[_0x18f00c(0xb8)]();}[a232_0x3365a2(0xbc)](){const _0x543f69=a232_0x3365a2;return{'orgId':this[_0x543f69(0xc6)],'accessToken':this['accessToken'],'instanceUrl':this[_0x543f69(0xd8)]};}async[a232_0x3365a2(0xd3)](){const _0x4f59f1=a232_0x3365a2;return await this[_0x4f59f1(0xb8)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x4f59f1(0xf5),'authorization':this[_0x4f59f1(0xcb)]+'\x20'+this[_0x4f59f1(0xbb)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;