const a193_0x2c1356=a193_0x1cfb;function a193_0x4bd1(){const _0x31075d=['__metadata','219788npSPhj','Service','15hKIcxp','SalesforceAuthService','../../../../core','services/data/','8UKjitx','336WLiESA','constructor','__importDefault','update\x20access\x20token','catch','configurable','function','metadata','2722490Ctuqtn','__decorate','../../../../constants/errors','hasOwnProperty','Idle','error','__setModuleDefault','length','setAuthDetails','defineProperty','refresh_token','decorate','9NHYOft','forceUpdateToken','access_token','getOwnPropertyDescriptor','instanceUrl','InvalidRefreshTokenError','540815OPgkMH','AuthState','get','then','sleep','authState','ERR_INVALID_SALESFORCE_TOKEN','design:paramtypes','__esModule','AUTH_WAIT_TIME','waitAuth','requestConfig','search','axios','typedi','logger','toString','../../../../constants','../../providers/providers.tokens','9055917pfPknx','6kEXCJC','response','default','update\x20access\x20token\x20failed:\x20%s','check\x20auth:\x20current\x20state\x20-\x20%s','SALESFORCE_API_VERSION','instance_url','22KBsANo','__importStar','../../../shared/utils','orgId','prototype','26417EPGyWT','Error','tokenType','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','force\x20update\x20token','UnauthorizedSalesforceError','1468452wiPUFs','create','access\x20token\x20updated\x20for\x20%s','43088DxgpNa','token_type','log','Updating','post','../errors/invalid-refresh-token.error','../errors/unauthorized-salesforce.error','getAuthData','(((.+)+)+)+$','application/json','updateAccessToken','__createBinding','Active','/services/oauth2/token'];a193_0x4bd1=function(){return _0x31075d;};return a193_0x4bd1();}(function(_0x10e908,_0x40d0d8){const _0x4a7b11=a193_0x1cfb,_0x1569bc=_0x10e908();while(!![]){try{const _0x6bbb8a=parseInt(_0x4a7b11(0x14b))/0x1*(parseInt(_0x4a7b11(0x169))/0x2)+-parseInt(_0x4a7b11(0x165))/0x3*(parseInt(_0x4a7b11(0x163))/0x4)+parseInt(_0x4a7b11(0x12b))/0x5*(-parseInt(_0x4a7b11(0x13f))/0x6)+parseInt(_0x4a7b11(0x16a))/0x7*(parseInt(_0x4a7b11(0x154))/0x8)+parseInt(_0x4a7b11(0x125))/0x9*(-parseInt(_0x4a7b11(0x172))/0xa)+-parseInt(_0x4a7b11(0x146))/0xb*(parseInt(_0x4a7b11(0x151))/0xc)+parseInt(_0x4a7b11(0x13e))/0xd;if(_0x6bbb8a===_0x40d0d8)break;else _0x1569bc['push'](_0x1569bc['shift']());}catch(_0x3e2f7a){_0x1569bc['push'](_0x1569bc['shift']());}}}(a193_0x4bd1,0x27494));const a193_0x23a012=(function(){let _0x1d7ff3=!![];return function(_0x495fe6,_0x1d932a){const _0x290513=_0x1d7ff3?function(){if(_0x1d932a){const _0x521427=_0x1d932a['apply'](_0x495fe6,arguments);return _0x1d932a=null,_0x521427;}}:function(){};return _0x1d7ff3=![],_0x290513;};}()),a193_0x5cf9e6=a193_0x23a012(this,function(){const _0x446a82=a193_0x1cfb;return a193_0x5cf9e6['toString']()[_0x446a82(0x137)](_0x446a82(0x15c))[_0x446a82(0x13b)]()[_0x446a82(0x16b)](a193_0x5cf9e6)[_0x446a82(0x137)]('(((.+)+)+)+$');});a193_0x5cf9e6();'use strict';var __createBinding=this&&this[a193_0x2c1356(0x15f)]||(Object[a193_0x2c1356(0x152)]?function(_0x51e10e,_0x55aa9f,_0x349abc,_0x383a67){const _0x52649a=a193_0x2c1356;if(_0x383a67===undefined)_0x383a67=_0x349abc;var _0x40535b=Object[_0x52649a(0x128)](_0x55aa9f,_0x349abc);(!_0x40535b||(_0x52649a(0x12d)in _0x40535b?!_0x55aa9f[_0x52649a(0x133)]:_0x40535b['writable']||_0x40535b[_0x52649a(0x16f)]))&&(_0x40535b={'enumerable':!![],'get':function(){return _0x55aa9f[_0x349abc];}}),Object['defineProperty'](_0x51e10e,_0x383a67,_0x40535b);}:function(_0x47add6,_0x5e79b3,_0x2ed091,_0x46e287){if(_0x46e287===undefined)_0x46e287=_0x2ed091;_0x47add6[_0x46e287]=_0x5e79b3[_0x2ed091];}),__setModuleDefault=this&&this[a193_0x2c1356(0x178)]||(Object[a193_0x2c1356(0x152)]?function(_0x164875,_0x5e7305){const _0x4bc913=a193_0x2c1356;Object[_0x4bc913(0x122)](_0x164875,_0x4bc913(0x141),{'enumerable':!![],'value':_0x5e7305});}:function(_0x4097e2,_0x1bfdf5){_0x4097e2['default']=_0x1bfdf5;}),__decorate=this&&this[a193_0x2c1356(0x173)]||function(_0x1b946c,_0x166d9c,_0x538712,_0x4dcc55){const _0x1332eb=a193_0x2c1356;var _0x45eb53=arguments[_0x1332eb(0x179)],_0x377da9=_0x45eb53<0x3?_0x166d9c:_0x4dcc55===null?_0x4dcc55=Object['getOwnPropertyDescriptor'](_0x166d9c,_0x538712):_0x4dcc55,_0xbc2aa0;if(typeof Reflect==='object'&&typeof Reflect[_0x1332eb(0x124)]===_0x1332eb(0x170))_0x377da9=Reflect[_0x1332eb(0x124)](_0x1b946c,_0x166d9c,_0x538712,_0x4dcc55);else{for(var _0x558087=_0x1b946c['length']-0x1;_0x558087>=0x0;_0x558087--)if(_0xbc2aa0=_0x1b946c[_0x558087])_0x377da9=(_0x45eb53<0x3?_0xbc2aa0(_0x377da9):_0x45eb53>0x3?_0xbc2aa0(_0x166d9c,_0x538712,_0x377da9):_0xbc2aa0(_0x166d9c,_0x538712))||_0x377da9;}return _0x45eb53>0x3&&_0x377da9&&Object['defineProperty'](_0x166d9c,_0x538712,_0x377da9),_0x377da9;},__importStar=this&&this[a193_0x2c1356(0x147)]||function(_0x4d948b){const _0x483bdc=a193_0x2c1356;if(_0x4d948b&&_0x4d948b[_0x483bdc(0x133)])return _0x4d948b;var _0x12f491={};if(_0x4d948b!=null){for(var _0xefa1d3 in _0x4d948b)if(_0xefa1d3!=='default'&&Object[_0x483bdc(0x14a)][_0x483bdc(0x175)]['call'](_0x4d948b,_0xefa1d3))__createBinding(_0x12f491,_0x4d948b,_0xefa1d3);}return __setModuleDefault(_0x12f491,_0x4d948b),_0x12f491;},__metadata=this&&this[a193_0x2c1356(0x162)]||function(_0x1ca8c6,_0x505e2b){const _0x533a13=a193_0x2c1356;if(typeof Reflect==='object'&&typeof Reflect[_0x533a13(0x171)]===_0x533a13(0x170))return Reflect[_0x533a13(0x171)](_0x1ca8c6,_0x505e2b);},__importDefault=this&&this[a193_0x2c1356(0x16c)]||function(_0x19f224){const _0x5af912=a193_0x2c1356;return _0x19f224&&_0x19f224[_0x5af912(0x133)]?_0x19f224:{'default':_0x19f224};},SalesforceAuthService_1;Object[a193_0x2c1356(0x122)](exports,'__esModule',{'value':!![]}),exports[a193_0x2c1356(0x166)]=void 0x0;const typedi_1=__importStar(require(a193_0x2c1356(0x139))),errors_1=require(a193_0x2c1356(0x174)),core_1=require(a193_0x2c1356(0x167)),axios_1=__importDefault(require(a193_0x2c1356(0x138))),utils_1=require(a193_0x2c1356(0x148)),invalid_refresh_token_error_1=require(a193_0x2c1356(0x159)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a193_0x2c1356(0x15a)),constants_1=require(a193_0x2c1356(0x13c)),providers_tokens_1=require(a193_0x2c1356(0x13d));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x206a16=a193_0x2c1356;this[_0x206a16(0x134)]=0x1388,this[_0x206a16(0x130)]=auth_state_enum_1['AuthState'][_0x206a16(0x176)],this[_0x206a16(0x13a)]=new core_1['Logger'](SalesforceAuthService_1['name']),this[_0x206a16(0x17a)]();}async[a193_0x2c1356(0x17a)](){const _0x28469a=a193_0x2c1356;this['logger'][_0x28469a(0x156)](_0x28469a(0x143),auth_state_enum_1[_0x28469a(0x12c)][this[_0x28469a(0x130)]]);try{if(this[_0x28469a(0x130)]===auth_state_enum_1['AuthState'][_0x28469a(0x14c)])return;if(this[_0x28469a(0x130)]===auth_state_enum_1['AuthState'][_0x28469a(0x176)])await this[_0x28469a(0x15e)]();else{const _0x190a42=await this[_0x28469a(0x136)](),_0x5cbe4f=await axios_1[_0x28469a(0x141)]['get'](_0x28469a(0x168)+constants_1[_0x28469a(0x144)],_0x190a42)[_0x28469a(0x12e)](()=>!![])[_0x28469a(0x16e)](()=>![]);!_0x5cbe4f&&await this[_0x28469a(0x15e)]();}}catch(_0x376d31){}}async[a193_0x2c1356(0x15e)](){const _0x417a36=a193_0x2c1356;var _0x375a96,_0x48cdf6,_0x392753;this[_0x417a36(0x13a)][_0x417a36(0x156)](_0x417a36(0x16d));try{this['authState']=auth_state_enum_1[_0x417a36(0x12c)][_0x417a36(0x157)];const {refreshToken:_0x346fe6,clientId:_0x5544c9,clientSecret:_0x1d1ebb,loginUrl:_0x498e07}=typedi_1[_0x417a36(0x141)][_0x417a36(0x12d)](providers_tokens_1['Tokens']['salesforce']),{data:_0x22860e}=await axios_1[_0x417a36(0x141)][_0x417a36(0x158)]((0x0,utils_1['joinURL'])(_0x498e07,_0x417a36(0x161)),null,{'params':{'grant_type':_0x417a36(0x123),'refresh_token':_0x346fe6,'client_id':_0x5544c9,'client_secret':_0x1d1ebb}});this[_0x417a36(0x129)]=_0x22860e[_0x417a36(0x145)],this['accessToken']=_0x22860e[_0x417a36(0x127)],this['tokenType']=_0x22860e[_0x417a36(0x155)],this['authState']=auth_state_enum_1['AuthState'][_0x417a36(0x160)],this[_0x417a36(0x13a)][_0x417a36(0x156)](_0x417a36(0x153),this[_0x417a36(0x129)]);}catch(_0x12f1fd){const _0x9990c6=((_0x48cdf6=(_0x375a96=_0x12f1fd===null||_0x12f1fd===void 0x0?void 0x0:_0x12f1fd[_0x417a36(0x140)])===null||_0x375a96===void 0x0?void 0x0:_0x375a96['data'])===null||_0x48cdf6===void 0x0?void 0x0:_0x48cdf6[_0x417a36(0x177)])||((_0x392753=_0x12f1fd===null||_0x12f1fd===void 0x0?void 0x0:_0x12f1fd[_0x417a36(0x140)])===null||_0x392753===void 0x0?void 0x0:_0x392753['data'])||_0x12f1fd['message'];this['logger'][_0x417a36(0x177)](_0x417a36(0x142),_0x9990c6),this['authState']=auth_state_enum_1[_0x417a36(0x12c)][_0x417a36(0x14c)];throw new invalid_refresh_token_error_1[(_0x417a36(0x12a))](errors_1[_0x417a36(0x131)]);}}async[a193_0x2c1356(0x126)](){const _0x5cf405=a193_0x2c1356;this['logger'][_0x5cf405(0x156)](_0x5cf405(0x14f));if(this[_0x5cf405(0x130)]===auth_state_enum_1[_0x5cf405(0x12c)][_0x5cf405(0x157)]||this[_0x5cf405(0x130)]===auth_state_enum_1[_0x5cf405(0x12c)][_0x5cf405(0x176)])return await(0x0,utils_1[_0x5cf405(0x12f)])(this[_0x5cf405(0x134)]),this[_0x5cf405(0x126)]();if(this[_0x5cf405(0x130)]===auth_state_enum_1[_0x5cf405(0x12c)][_0x5cf405(0x14c)])throw new invalid_refresh_token_error_1[(_0x5cf405(0x12a))](errors_1[_0x5cf405(0x131)]);await this['updateAccessToken']();}async[a193_0x2c1356(0x135)](){const _0x118446=a193_0x2c1356;if(this[_0x118446(0x130)]===auth_state_enum_1[_0x118446(0x12c)][_0x118446(0x14c)]){this[_0x118446(0x13a)][_0x118446(0x156)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x118446(0x150))]();}if(this[_0x118446(0x130)]!==auth_state_enum_1[_0x118446(0x12c)][_0x118446(0x160)])return this[_0x118446(0x13a)][_0x118446(0x156)](_0x118446(0x14e)),await(0x0,utils_1[_0x118446(0x12f)])(this['AUTH_WAIT_TIME']),this['waitAuth']();}[a193_0x2c1356(0x15b)](){const _0x439fda=a193_0x2c1356;return{'orgId':this[_0x439fda(0x149)],'accessToken':this['accessToken'],'instanceUrl':this[_0x439fda(0x129)]};}async[a193_0x2c1356(0x136)](){const _0x52d4f8=a193_0x2c1356;return await this[_0x52d4f8(0x135)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x52d4f8(0x15d),'authorization':this[_0x52d4f8(0x14d)]+'\x20'+this['accessToken']}};}};function a193_0x1cfb(_0x4aa9fa,_0x42ec11){const _0x55aae2=a193_0x4bd1();return a193_0x1cfb=function(_0x5cf9e6,_0x23a012){_0x5cf9e6=_0x5cf9e6-0x122;let _0x4bd199=_0x55aae2[_0x5cf9e6];return _0x4bd199;},a193_0x1cfb(_0x4aa9fa,_0x42ec11);}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a193_0x2c1356(0x164)])(),__metadata(a193_0x2c1356(0x132),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;