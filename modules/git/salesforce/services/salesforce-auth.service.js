const a271_0x316145=a271_0x3918;(function(_0x5dbb44,_0x2b00af){const _0x304f0a=a271_0x3918,_0x50ba6f=_0x5dbb44();while(!![]){try{const _0x12e73e=-parseInt(_0x304f0a(0x90))/0x1*(-parseInt(_0x304f0a(0xb6))/0x2)+parseInt(_0x304f0a(0x8a))/0x3+parseInt(_0x304f0a(0x82))/0x4*(-parseInt(_0x304f0a(0x8d))/0x5)+-parseInt(_0x304f0a(0xd7))/0x6*(-parseInt(_0x304f0a(0xd3))/0x7)+parseInt(_0x304f0a(0x86))/0x8+-parseInt(_0x304f0a(0xa7))/0x9+-parseInt(_0x304f0a(0xae))/0xa*(-parseInt(_0x304f0a(0xc5))/0xb);if(_0x12e73e===_0x2b00af)break;else _0x50ba6f['push'](_0x50ba6f['shift']());}catch(_0x27705e){_0x50ba6f['push'](_0x50ba6f['shift']());}}}(a271_0x3f92,0x53ffc));const a271_0x47278f=(function(){let _0x480312=!![];return function(_0x5bcba3,_0x353637){const _0x3809da=_0x480312?function(){const _0x4dec21=a271_0x3918;if(_0x353637){const _0x29cf92=_0x353637[_0x4dec21(0xc1)](_0x5bcba3,arguments);return _0x353637=null,_0x29cf92;}}:function(){};return _0x480312=![],_0x3809da;};}()),a271_0x560a79=a271_0x47278f(this,function(){const _0x2a6e14=a271_0x3918;return a271_0x560a79['toString']()[_0x2a6e14(0xa4)](_0x2a6e14(0xa3))[_0x2a6e14(0xb8)]()[_0x2a6e14(0xc2)](a271_0x560a79)[_0x2a6e14(0xa4)](_0x2a6e14(0xa3));});a271_0x560a79();'use strict';var __createBinding=this&&this[a271_0x316145(0x7d)]||(Object['create']?function(_0x42f1d4,_0x2e9678,_0x381718,_0x5ec2a9){const _0x3066d5=a271_0x316145;if(_0x5ec2a9===undefined)_0x5ec2a9=_0x381718;var _0x3c5cd2=Object['getOwnPropertyDescriptor'](_0x2e9678,_0x381718);(!_0x3c5cd2||(_0x3066d5(0xb4)in _0x3c5cd2?!_0x2e9678['__esModule']:_0x3c5cd2[_0x3066d5(0x99)]||_0x3c5cd2[_0x3066d5(0x92)]))&&(_0x3c5cd2={'enumerable':!![],'get':function(){return _0x2e9678[_0x381718];}}),Object[_0x3066d5(0xdc)](_0x42f1d4,_0x5ec2a9,_0x3c5cd2);}:function(_0x1a6ec3,_0x558b77,_0x44495d,_0x2c4a35){if(_0x2c4a35===undefined)_0x2c4a35=_0x44495d;_0x1a6ec3[_0x2c4a35]=_0x558b77[_0x44495d];}),__setModuleDefault=this&&this[a271_0x316145(0x85)]||(Object[a271_0x316145(0xcd)]?function(_0x9b57d0,_0x4d35f6){const _0x416523=a271_0x316145;Object[_0x416523(0xdc)](_0x9b57d0,_0x416523(0x9b),{'enumerable':!![],'value':_0x4d35f6});}:function(_0x1d9d46,_0x59883d){const _0x5a72b8=a271_0x316145;_0x1d9d46[_0x5a72b8(0x9b)]=_0x59883d;}),__decorate=this&&this[a271_0x316145(0xa8)]||function(_0x6e4313,_0x26329a,_0x14829c,_0x2a74db){const _0x5d0f10=a271_0x316145;var _0xe47719=arguments[_0x5d0f10(0x9a)],_0x370a74=_0xe47719<0x3?_0x26329a:_0x2a74db===null?_0x2a74db=Object[_0x5d0f10(0xcc)](_0x26329a,_0x14829c):_0x2a74db,_0x56ac0d;if(typeof Reflect===_0x5d0f10(0xc3)&&typeof Reflect[_0x5d0f10(0xca)]===_0x5d0f10(0x9e))_0x370a74=Reflect[_0x5d0f10(0xca)](_0x6e4313,_0x26329a,_0x14829c,_0x2a74db);else{for(var _0x1456ea=_0x6e4313[_0x5d0f10(0x9a)]-0x1;_0x1456ea>=0x0;_0x1456ea--)if(_0x56ac0d=_0x6e4313[_0x1456ea])_0x370a74=(_0xe47719<0x3?_0x56ac0d(_0x370a74):_0xe47719>0x3?_0x56ac0d(_0x26329a,_0x14829c,_0x370a74):_0x56ac0d(_0x26329a,_0x14829c))||_0x370a74;}return _0xe47719>0x3&&_0x370a74&&Object['defineProperty'](_0x26329a,_0x14829c,_0x370a74),_0x370a74;},__importStar=this&&this[a271_0x316145(0x98)]||function(_0xd271d5){const _0x490553=a271_0x316145;if(_0xd271d5&&_0xd271d5[_0x490553(0xb3)])return _0xd271d5;var _0x99d01f={};if(_0xd271d5!=null){for(var _0x10c79a in _0xd271d5)if(_0x10c79a!=='default'&&Object['prototype']['hasOwnProperty']['call'](_0xd271d5,_0x10c79a))__createBinding(_0x99d01f,_0xd271d5,_0x10c79a);}return __setModuleDefault(_0x99d01f,_0xd271d5),_0x99d01f;},__metadata=this&&this['__metadata']||function(_0x2d4eea,_0x2facd9){const _0x18e2b3=a271_0x316145;if(typeof Reflect===_0x18e2b3(0xc3)&&typeof Reflect[_0x18e2b3(0x8c)]==='function')return Reflect['metadata'](_0x2d4eea,_0x2facd9);},__importDefault=this&&this[a271_0x316145(0xa1)]||function(_0x10a00f){const _0x5eec9c=a271_0x316145;return _0x10a00f&&_0x10a00f[_0x5eec9c(0xb3)]?_0x10a00f:{'default':_0x10a00f};},SalesforceAuthService_1;Object[a271_0x316145(0xdc)](exports,a271_0x316145(0xb3),{'value':!![]}),exports[a271_0x316145(0xbd)]=void 0x0;const typedi_1=__importStar(require(a271_0x316145(0xd6))),errors_1=require(a271_0x316145(0xb9)),core_1=require('../../../../core'),axios_1=__importDefault(require(a271_0x316145(0xc7))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a271_0x316145(0xa6)),auth_state_enum_1=require(a271_0x316145(0xc9)),unauthorized_salesforce_error_1=require(a271_0x316145(0xa9)),constants_1=require('../../../../constants'),providers_tokens_1=require(a271_0x316145(0xaa)),salesforce_1=require(a271_0x316145(0xb2));function a271_0x3918(_0x120295,_0x197b5d){const _0x5d725a=a271_0x3f92();return a271_0x3918=function(_0x560a79,_0x47278f){_0x560a79=_0x560a79-0x7d;let _0x3f929d=_0x5d725a[_0x560a79];return _0x3f929d;},a271_0x3918(_0x120295,_0x197b5d);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x37c28e=a271_0x316145;this[_0x37c28e(0x97)]=0x1388,this[_0x37c28e(0x84)]=auth_state_enum_1[_0x37c28e(0xc0)]['Idle'],this[_0x37c28e(0x8b)]=new core_1['Logger'](SalesforceAuthService_1['name']),this[_0x37c28e(0xb1)]();}async['setAuthDetails'](){const _0x17386c=a271_0x316145;this['logger']['log'](_0x17386c(0xc6),auth_state_enum_1[_0x17386c(0xc0)][this[_0x17386c(0x84)]]);try{if(this[_0x17386c(0x84)]===auth_state_enum_1['AuthState'][_0x17386c(0xd2)])return;if(this[_0x17386c(0x84)]===auth_state_enum_1[_0x17386c(0xc0)][_0x17386c(0x95)])await this[_0x17386c(0x9c)]();else{const _0xe30205=await this['requestConfig'](),_0x54427d=await axios_1['default'][_0x17386c(0xb4)]('services/data/'+constants_1[_0x17386c(0xa0)],_0xe30205)[_0x17386c(0xba)](()=>!![])[_0x17386c(0x8f)](()=>![]);!_0x54427d&&await this['updateAccessToken']();}}catch(_0x1e97df){}}async['updateAccessToken'](){const _0x3644d0=a271_0x316145;var _0x1cc2cd,_0xb581,_0x4083ac;this[_0x3644d0(0x8b)][_0x3644d0(0x7e)](_0x3644d0(0x89));try{this[_0x3644d0(0x84)]=auth_state_enum_1[_0x3644d0(0xc0)][_0x3644d0(0xa5)];const {refreshToken:_0x34058f,clientId:_0x5acc38,clientSecret:_0x4a0ba5,loginUrl:_0x431822}=typedi_1[_0x3644d0(0x9b)][_0x3644d0(0xb4)](providers_tokens_1[_0x3644d0(0xd1)][_0x3644d0(0xcf)]),{data:_0x5a2317}=await axios_1[_0x3644d0(0x9b)][_0x3644d0(0xda)]((0x0,utils_1[_0x3644d0(0xdb)])(_0x431822,_0x3644d0(0x80)),null,{'params':{'grant_type':_0x3644d0(0xcb),'refresh_token':_0x34058f,'client_id':_0x5acc38,'client_secret':_0x4a0ba5}});this[_0x3644d0(0xd9)]=_0x5a2317[_0x3644d0(0xbe)],this[_0x3644d0(0xc8)]=_0x5a2317[_0x3644d0(0xab)],this[_0x3644d0(0xbf)]=_0x5a2317[_0x3644d0(0x96)],this[_0x3644d0(0x84)]=auth_state_enum_1[_0x3644d0(0xc0)][_0x3644d0(0x81)],this[_0x3644d0(0x8b)]['log'](_0x3644d0(0xbc),this[_0x3644d0(0xd9)]);}catch(_0x5ad89c){const _0x3491a7=((_0xb581=(_0x1cc2cd=_0x5ad89c===null||_0x5ad89c===void 0x0?void 0x0:_0x5ad89c['response'])===null||_0x1cc2cd===void 0x0?void 0x0:_0x1cc2cd[_0x3644d0(0x83)])===null||_0xb581===void 0x0?void 0x0:_0xb581[_0x3644d0(0xce)])||((_0x4083ac=_0x5ad89c===null||_0x5ad89c===void 0x0?void 0x0:_0x5ad89c[_0x3644d0(0x9f)])===null||_0x4083ac===void 0x0?void 0x0:_0x4083ac['data'])||_0x5ad89c['message'];this[_0x3644d0(0x8b)]['error'](_0x3644d0(0xd8),_0x3491a7),this[_0x3644d0(0x84)]=auth_state_enum_1[_0x3644d0(0xc0)][_0x3644d0(0xd2)];throw new invalid_refresh_token_error_1[(_0x3644d0(0x88))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a271_0x316145(0xc4)](){const _0xf8892b=a271_0x316145;this[_0xf8892b(0x8b)][_0xf8892b(0x7e)](_0xf8892b(0x93));if(this[_0xf8892b(0x84)]===auth_state_enum_1['AuthState'][_0xf8892b(0xa5)]||this['authState']===auth_state_enum_1[_0xf8892b(0xc0)][_0xf8892b(0x95)])return await(0x0,utils_1[_0xf8892b(0xac)])(this[_0xf8892b(0x97)]),this[_0xf8892b(0xc4)]();if(this[_0xf8892b(0x84)]===auth_state_enum_1[_0xf8892b(0xc0)]['Error'])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0xf8892b(0x91)]);await this[_0xf8892b(0x9c)]();}async[a271_0x316145(0xd5)](){const _0x4239a8=a271_0x316145;if(this[_0x4239a8(0x84)]===auth_state_enum_1[_0x4239a8(0xc0)][_0x4239a8(0xd2)]){this[_0x4239a8(0x8b)][_0x4239a8(0x7e)](_0x4239a8(0x94));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this['authState']!==auth_state_enum_1[_0x4239a8(0xc0)]['Active'])return this['logger'][_0x4239a8(0x7e)]('Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x4239a8(0xac)])(this[_0x4239a8(0x97)]),this[_0x4239a8(0xd5)]();}[a271_0x316145(0xbb)](){const _0x34d9ed=a271_0x316145;return{'orgId':this['orgId'],'accessToken':this[_0x34d9ed(0xc8)],'instanceUrl':this[_0x34d9ed(0xd9)]};}async[a271_0x316145(0x8e)](_0x1f3808=''){const _0x4f7048=a271_0x316145;await this[_0x4f7048(0xd5)]();const _0x581df6={'baseURL':this[_0x4f7048(0xd9)],'headers':{'accept':_0x4f7048(0xd4)}};if(salesforce_1[_0x4f7048(0xb5)][_0x4f7048(0x7f)](_0x1f3808))_0x581df6[_0x4f7048(0xaf)][_0x4f7048(0xad)]=this[_0x4f7048(0xc8)];else salesforce_1['SalesforceUtils']['isSoapUrl'](_0x1f3808)?_0x581df6['data']=_0x581df6[_0x4f7048(0x83)][_0x4f7048(0x9d)](/<met:sessionId>.+?<\/met:sessionId>/,_0x4f7048(0xa2)+this[_0x4f7048(0xc8)]+_0x4f7048(0xd0)):_0x581df6['headers'][_0x4f7048(0x87)]=this[_0x4f7048(0xbf)]+'\x20'+this[_0x4f7048(0xc8)];return _0x581df6;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a271_0x316145(0xb7)])(),__metadata(a271_0x316145(0xb0),[])],SalesforceAuthService),exports[a271_0x316145(0xbd)]=SalesforceAuthService;function a271_0x3f92(){const _0x432407=['Access\x20token\x20updated\x20for\x20%s','SalesforceAuthService','instance_url','tokenType','AuthState','apply','constructor','object','forceUpdateToken','11xMAqwp','Check\x20auth:\x20current\x20state\x20-\x20%s','axios','accessToken','../enums/auth-state.enum','decorate','refresh_token','getOwnPropertyDescriptor','create','error','salesforce','</met:sessionId>','Tokens','Error','42OTDzdm','application/json','waitAuth','typedi','116664PaByok','Update\x20access\x20token\x20failed:\x20%s','instanceUrl','post','joinURL','defineProperty','__createBinding','log','isBulk1Url','/services/oauth2/token','Active','1488zefhmu','data','authState','__setModuleDefault','848824NgqqQl','authorization','InvalidRefreshTokenError','Update\x20access\x20token','80580DBMvxm','logger','metadata','4220mKetbj','requestConfig','catch','73885wKeVGK','ERR_INVALID_SALESFORCE_TOKEN','configurable','Force\x20update\x20token','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','Idle','token_type','AUTH_WAIT_TIME','__importStar','writable','length','default','updateAccessToken','replace','function','response','SALESFORCE_API_VERSION','__importDefault','<met:sessionId>','(((.+)+)+)+$','search','Updating','../errors/invalid-refresh-token.error','568323xuOgaY','__decorate','../errors/unauthorized-salesforce.error','../../providers/providers.tokens','access_token','sleep','X-SFDC-Session','3976630KWWbfz','headers','design:paramtypes','setAuthDetails','@flosum/salesforce','__esModule','get','SalesforceUtils','2GVFeEg','Service','toString','../../../../constants/errors','then','getAuthData'];a271_0x3f92=function(){return _0x432407;};return a271_0x3f92();}