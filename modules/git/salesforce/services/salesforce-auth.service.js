const a259_0x5d65a1=a259_0x2a7d;(function(_0x51e785,_0x36b50f){const _0x577228=a259_0x2a7d,_0xe3c769=_0x51e785();while(!![]){try{const _0x2f20f0=parseInt(_0x577228(0xe9))/0x1+-parseInt(_0x577228(0xb1))/0x2+parseInt(_0x577228(0xf0))/0x3*(parseInt(_0x577228(0xbc))/0x4)+-parseInt(_0x577228(0xaf))/0x5+-parseInt(_0x577228(0xb0))/0x6+parseInt(_0x577228(0xed))/0x7*(-parseInt(_0x577228(0xbf))/0x8)+parseInt(_0x577228(0xb8))/0x9*(parseInt(_0x577228(0xda))/0xa);if(_0x2f20f0===_0x36b50f)break;else _0xe3c769['push'](_0xe3c769['shift']());}catch(_0x2e6bc0){_0xe3c769['push'](_0xe3c769['shift']());}}}(a259_0xbb5a,0xd1c59));const a259_0x2dae86=(function(){let _0x3eff9d=!![];return function(_0x1f70c9,_0x5fd361){const _0x21254a=_0x3eff9d?function(){const _0x4e8f37=a259_0x2a7d;if(_0x5fd361){const _0x3eba15=_0x5fd361[_0x4e8f37(0xba)](_0x1f70c9,arguments);return _0x5fd361=null,_0x3eba15;}}:function(){};return _0x3eff9d=![],_0x21254a;};}()),a259_0xf61732=a259_0x2dae86(this,function(){const _0x152b21=a259_0x2a7d;return a259_0xf61732[_0x152b21(0xc3)]()[_0x152b21(0xc9)](_0x152b21(0xf1))['toString']()[_0x152b21(0xe0)](a259_0xf61732)[_0x152b21(0xc9)](_0x152b21(0xf1));});function a259_0x2a7d(_0x264e0f,_0xbf74e2){const _0x4318ee=a259_0xbb5a();return a259_0x2a7d=function(_0xf61732,_0x2dae86){_0xf61732=_0xf61732-0xa2;let _0xbb5af3=_0x4318ee[_0xf61732];return _0xbb5af3;},a259_0x2a7d(_0x264e0f,_0xbf74e2);}a259_0xf61732();'use strict';var __createBinding=this&&this[a259_0x5d65a1(0xce)]||(Object['create']?function(_0x4e935b,_0x3359f7,_0x1020a0,_0x148905){const _0x474876=a259_0x5d65a1;if(_0x148905===undefined)_0x148905=_0x1020a0;var _0x1a8aea=Object[_0x474876(0xaa)](_0x3359f7,_0x1020a0);(!_0x1a8aea||('get'in _0x1a8aea?!_0x3359f7[_0x474876(0xd5)]:_0x1a8aea['writable']||_0x1a8aea[_0x474876(0xe1)]))&&(_0x1a8aea={'enumerable':!![],'get':function(){return _0x3359f7[_0x1020a0];}}),Object[_0x474876(0xc2)](_0x4e935b,_0x148905,_0x1a8aea);}:function(_0x1151ba,_0x960f71,_0x6c189,_0x1e3bd9){if(_0x1e3bd9===undefined)_0x1e3bd9=_0x6c189;_0x1151ba[_0x1e3bd9]=_0x960f71[_0x6c189];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a259_0x5d65a1(0xa5)]?function(_0x57983e,_0x4493c2){const _0x2bb7b1=a259_0x5d65a1;Object['defineProperty'](_0x57983e,_0x2bb7b1(0xdc),{'enumerable':!![],'value':_0x4493c2});}:function(_0x59790b,_0x2d45dd){_0x59790b['default']=_0x2d45dd;}),__decorate=this&&this[a259_0x5d65a1(0xd2)]||function(_0x139d00,_0x557eea,_0x679ab5,_0x15f92d){const _0x344273=a259_0x5d65a1;var _0x245b9a=arguments['length'],_0x21208f=_0x245b9a<0x3?_0x557eea:_0x15f92d===null?_0x15f92d=Object['getOwnPropertyDescriptor'](_0x557eea,_0x679ab5):_0x15f92d,_0x1f2fc2;if(typeof Reflect===_0x344273(0xe4)&&typeof Reflect[_0x344273(0xb3)]===_0x344273(0xe7))_0x21208f=Reflect[_0x344273(0xb3)](_0x139d00,_0x557eea,_0x679ab5,_0x15f92d);else{for(var _0x410abb=_0x139d00['length']-0x1;_0x410abb>=0x0;_0x410abb--)if(_0x1f2fc2=_0x139d00[_0x410abb])_0x21208f=(_0x245b9a<0x3?_0x1f2fc2(_0x21208f):_0x245b9a>0x3?_0x1f2fc2(_0x557eea,_0x679ab5,_0x21208f):_0x1f2fc2(_0x557eea,_0x679ab5))||_0x21208f;}return _0x245b9a>0x3&&_0x21208f&&Object[_0x344273(0xc2)](_0x557eea,_0x679ab5,_0x21208f),_0x21208f;},__importStar=this&&this[a259_0x5d65a1(0xa4)]||function(_0x1f6c38){const _0xfd4796=a259_0x5d65a1;if(_0x1f6c38&&_0x1f6c38['__esModule'])return _0x1f6c38;var _0x286b2d={};if(_0x1f6c38!=null){for(var _0x1fd365 in _0x1f6c38)if(_0x1fd365!==_0xfd4796(0xdc)&&Object['prototype'][_0xfd4796(0xa2)][_0xfd4796(0xa8)](_0x1f6c38,_0x1fd365))__createBinding(_0x286b2d,_0x1f6c38,_0x1fd365);}return __setModuleDefault(_0x286b2d,_0x1f6c38),_0x286b2d;},__metadata=this&&this['__metadata']||function(_0x23a0e8,_0xd916fe){const _0x38d444=a259_0x5d65a1;if(typeof Reflect===_0x38d444(0xe4)&&typeof Reflect[_0x38d444(0xe3)]===_0x38d444(0xe7))return Reflect[_0x38d444(0xe3)](_0x23a0e8,_0xd916fe);},__importDefault=this&&this['__importDefault']||function(_0x507d07){const _0x2f2370=a259_0x5d65a1;return _0x507d07&&_0x507d07[_0x2f2370(0xd5)]?_0x507d07:{'default':_0x507d07};},SalesforceAuthService_1;Object[a259_0x5d65a1(0xc2)](exports,a259_0x5d65a1(0xd5),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require('typedi')),errors_1=require('../../../../constants/errors'),core_1=require(a259_0x5d65a1(0xb7)),axios_1=__importDefault(require(a259_0x5d65a1(0xb9))),utils_1=require(a259_0x5d65a1(0xc1)),invalid_refresh_token_error_1=require(a259_0x5d65a1(0xea)),auth_state_enum_1=require(a259_0x5d65a1(0xc4)),unauthorized_salesforce_error_1=require(a259_0x5d65a1(0xcf)),constants_1=require('../../../../constants'),providers_tokens_1=require(a259_0x5d65a1(0xee));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x5ae9f8=a259_0x5d65a1;this[_0x5ae9f8(0xc5)]=0x1388,this[_0x5ae9f8(0xdd)]=auth_state_enum_1[_0x5ae9f8(0xf2)][_0x5ae9f8(0xcb)],this['logger']=new core_1[(_0x5ae9f8(0xc8))](SalesforceAuthService_1[_0x5ae9f8(0xec)]),this['setAuthDetails']();}async[a259_0x5d65a1(0xa3)](){const _0x3df68f=a259_0x5d65a1;this[_0x3df68f(0xa6)][_0x3df68f(0xad)]('Check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this[_0x3df68f(0xdd)]]);try{if(this[_0x3df68f(0xdd)]===auth_state_enum_1[_0x3df68f(0xf2)]['Error'])return;if(this['authState']===auth_state_enum_1[_0x3df68f(0xf2)][_0x3df68f(0xcb)])await this[_0x3df68f(0xb6)]();else{const _0x4e6c10=await this[_0x3df68f(0xe2)](),_0x3879b9=await axios_1['default'][_0x3df68f(0xb2)]('services/data/'+constants_1[_0x3df68f(0xde)],_0x4e6c10)[_0x3df68f(0xac)](()=>!![])['catch'](()=>![]);!_0x3879b9&&await this['updateAccessToken']();}}catch(_0x5c2b06){}}async[a259_0x5d65a1(0xb6)](){const _0x112032=a259_0x5d65a1;var _0x30f64d,_0x6848c7,_0x3087b2;this[_0x112032(0xa6)][_0x112032(0xad)](_0x112032(0xf3));try{this[_0x112032(0xdd)]=auth_state_enum_1['AuthState'][_0x112032(0xd9)];const {refreshToken:_0x39fccd,clientId:_0x1ec4d9,clientSecret:_0x18967c,loginUrl:_0x352ef3}=typedi_1[_0x112032(0xdc)][_0x112032(0xb2)](providers_tokens_1['Tokens'][_0x112032(0xd1)]),{data:_0x57ae8d}=await axios_1[_0x112032(0xdc)][_0x112032(0xbd)]((0x0,utils_1[_0x112032(0xd6)])(_0x352ef3,_0x112032(0xd8)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x39fccd,'client_id':_0x1ec4d9,'client_secret':_0x18967c}});this[_0x112032(0xcc)]=_0x57ae8d['instance_url'],this[_0x112032(0xb4)]=_0x57ae8d[_0x112032(0xab)],this['tokenType']=_0x57ae8d[_0x112032(0xc0)],this[_0x112032(0xdd)]=auth_state_enum_1[_0x112032(0xf2)][_0x112032(0xae)],this[_0x112032(0xa6)][_0x112032(0xad)](_0x112032(0xb5),this['instanceUrl']);}catch(_0x44740f){const _0xce1b6d=((_0x6848c7=(_0x30f64d=_0x44740f===null||_0x44740f===void 0x0?void 0x0:_0x44740f[_0x112032(0xa7)])===null||_0x30f64d===void 0x0?void 0x0:_0x30f64d[_0x112032(0xbe)])===null||_0x6848c7===void 0x0?void 0x0:_0x6848c7['error'])||((_0x3087b2=_0x44740f===null||_0x44740f===void 0x0?void 0x0:_0x44740f[_0x112032(0xa7)])===null||_0x3087b2===void 0x0?void 0x0:_0x3087b2[_0x112032(0xbe)])||_0x44740f[_0x112032(0xd0)];this['logger'][_0x112032(0xdf)](_0x112032(0xca),_0xce1b6d),this[_0x112032(0xdd)]=auth_state_enum_1[_0x112032(0xf2)][_0x112032(0xef)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x112032(0xd7)]);}}async[a259_0x5d65a1(0xcd)](){const _0xb17d0a=a259_0x5d65a1;this[_0xb17d0a(0xa6)][_0xb17d0a(0xad)](_0xb17d0a(0xd3));if(this[_0xb17d0a(0xdd)]===auth_state_enum_1[_0xb17d0a(0xf2)]['Updating']||this[_0xb17d0a(0xdd)]===auth_state_enum_1[_0xb17d0a(0xf2)][_0xb17d0a(0xcb)])return await(0x0,utils_1[_0xb17d0a(0xdb)])(this[_0xb17d0a(0xc5)]),this[_0xb17d0a(0xcd)]();if(this[_0xb17d0a(0xdd)]===auth_state_enum_1['AuthState']['Error'])throw new invalid_refresh_token_error_1[(_0xb17d0a(0xc7))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0xb17d0a(0xb6)]();}async['waitAuth'](){const _0x450687=a259_0x5d65a1;if(this[_0x450687(0xdd)]===auth_state_enum_1[_0x450687(0xf2)][_0x450687(0xef)]){this[_0x450687(0xa6)][_0x450687(0xad)]('Create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x450687(0xe8))]();}if(this[_0x450687(0xdd)]!==auth_state_enum_1[_0x450687(0xf2)][_0x450687(0xae)])return this['logger']['log'](_0x450687(0xd4)),await(0x0,utils_1[_0x450687(0xdb)])(this[_0x450687(0xc5)]),this[_0x450687(0xe6)]();}[a259_0x5d65a1(0xeb)](){const _0x3c6646=a259_0x5d65a1;return{'orgId':this[_0x3c6646(0xbb)],'accessToken':this[_0x3c6646(0xb4)],'instanceUrl':this[_0x3c6646(0xcc)]};}async[a259_0x5d65a1(0xe2)](){const _0x875ffd=a259_0x5d65a1;return await this[_0x875ffd(0xe6)](),{'baseURL':this[_0x875ffd(0xcc)],'headers':{'accept':'application/json','authorization':this['tokenType']+'\x20'+this[_0x875ffd(0xb4)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a259_0x5d65a1(0xc6)])(),__metadata(a259_0x5d65a1(0xe5),[])],SalesforceAuthService),exports[a259_0x5d65a1(0xa9)]=SalesforceAuthService;function a259_0xbb5a(){const _0x8b45b7=['InvalidRefreshTokenError','Logger','search','Update\x20access\x20token\x20failed:\x20%s','Idle','instanceUrl','forceUpdateToken','__createBinding','../errors/unauthorized-salesforce.error','message','salesforce','__decorate','Force\x20update\x20token','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','__esModule','joinURL','ERR_INVALID_SALESFORCE_TOKEN','/services/oauth2/token','Updating','10369970yjXcgZ','sleep','default','authState','SALESFORCE_API_VERSION','error','constructor','configurable','requestConfig','metadata','object','design:paramtypes','waitAuth','function','UnauthorizedSalesforceError','264712VDDCZl','../errors/invalid-refresh-token.error','getAuthData','name','4001123IrSZzK','../../providers/providers.tokens','Error','36843ktgaWM','(((.+)+)+)+$','AuthState','Update\x20access\x20token','hasOwnProperty','setAuthDetails','__importStar','create','logger','response','call','SalesforceAuthService','getOwnPropertyDescriptor','access_token','then','log','Active','6244765AgLEIJ','5190018ELqvOt','2225010cuZnoV','get','decorate','accessToken','Access\x20token\x20updated\x20for\x20%s','updateAccessToken','../../../../core','36HNZraC','axios','apply','orgId','452HMbdUY','post','data','24dIKspD','token_type','../../../shared/utils','defineProperty','toString','../enums/auth-state.enum','AUTH_WAIT_TIME','Service'];a259_0xbb5a=function(){return _0x8b45b7;};return a259_0xbb5a();}