const a232_0x2e2462=a232_0x2db1;(function(_0x1e7fd4,_0x290fa5){const _0x4e8270=a232_0x2db1,_0x49aa4b=_0x1e7fd4();while(!![]){try{const _0x47bc9e=parseInt(_0x4e8270(0xe4))/0x1+parseInt(_0x4e8270(0xd7))/0x2+parseInt(_0x4e8270(0xc6))/0x3+-parseInt(_0x4e8270(0xfd))/0x4+-parseInt(_0x4e8270(0xbb))/0x5*(parseInt(_0x4e8270(0xb3))/0x6)+-parseInt(_0x4e8270(0xc0))/0x7*(parseInt(_0x4e8270(0xea))/0x8)+parseInt(_0x4e8270(0xd2))/0x9;if(_0x47bc9e===_0x290fa5)break;else _0x49aa4b['push'](_0x49aa4b['shift']());}catch(_0x4f1bb3){_0x49aa4b['push'](_0x49aa4b['shift']());}}}(a232_0x2ef4,0x27f1e));const a232_0x4b0173=(function(){let _0x4a2980=!![];return function(_0x377a77,_0x9d98c2){const _0x391bb0=_0x4a2980?function(){if(_0x9d98c2){const _0xa6d98f=_0x9d98c2['apply'](_0x377a77,arguments);return _0x9d98c2=null,_0xa6d98f;}}:function(){};return _0x4a2980=![],_0x391bb0;};}()),a232_0x23a552=a232_0x4b0173(this,function(){const _0x20b385=a232_0x2db1;return a232_0x23a552['toString']()['search']('(((.+)+)+)+$')[_0x20b385(0xdb)]()['constructor'](a232_0x23a552)[_0x20b385(0xb7)](_0x20b385(0xdf));});function a232_0x2db1(_0x34b545,_0x1dfc1c){const _0x3b26ab=a232_0x2ef4();return a232_0x2db1=function(_0x23a552,_0x4b0173){_0x23a552=_0x23a552-0xb3;let _0x2ef43b=_0x3b26ab[_0x23a552];return _0x2ef43b;},a232_0x2db1(_0x34b545,_0x1dfc1c);}a232_0x23a552();'use strict';var __createBinding=this&&this[a232_0x2e2462(0xc9)]||(Object[a232_0x2e2462(0xc4)]?function(_0x1749a7,_0xe6b0af,_0x48c89e,_0xc2ae58){const _0x20e27c=a232_0x2e2462;if(_0xc2ae58===undefined)_0xc2ae58=_0x48c89e;var _0x583ef3=Object['getOwnPropertyDescriptor'](_0xe6b0af,_0x48c89e);(!_0x583ef3||('get'in _0x583ef3?!_0xe6b0af[_0x20e27c(0xe9)]:_0x583ef3[_0x20e27c(0xdd)]||_0x583ef3['configurable']))&&(_0x583ef3={'enumerable':!![],'get':function(){return _0xe6b0af[_0x48c89e];}}),Object['defineProperty'](_0x1749a7,_0xc2ae58,_0x583ef3);}:function(_0x10c04f,_0x14257f,_0x49c87a,_0x369a50){if(_0x369a50===undefined)_0x369a50=_0x49c87a;_0x10c04f[_0x369a50]=_0x14257f[_0x49c87a];}),__setModuleDefault=this&&this[a232_0x2e2462(0xe0)]||(Object['create']?function(_0x4502d0,_0x4a8c51){const _0x19e85a=a232_0x2e2462;Object[_0x19e85a(0xe5)](_0x4502d0,_0x19e85a(0xe3),{'enumerable':!![],'value':_0x4a8c51});}:function(_0x39b1c8,_0x3bc55b){const _0x20bd7e=a232_0x2e2462;_0x39b1c8[_0x20bd7e(0xe3)]=_0x3bc55b;}),__decorate=this&&this['__decorate']||function(_0x3f94ea,_0x24d7ab,_0x5be7a7,_0x3a3264){const _0x1d67d4=a232_0x2e2462;var _0xaad27=arguments[_0x1d67d4(0xd3)],_0x15dc50=_0xaad27<0x3?_0x24d7ab:_0x3a3264===null?_0x3a3264=Object[_0x1d67d4(0xec)](_0x24d7ab,_0x5be7a7):_0x3a3264,_0x2cfd93;if(typeof Reflect===_0x1d67d4(0xf9)&&typeof Reflect[_0x1d67d4(0xb4)]==='function')_0x15dc50=Reflect['decorate'](_0x3f94ea,_0x24d7ab,_0x5be7a7,_0x3a3264);else{for(var _0x1a3200=_0x3f94ea['length']-0x1;_0x1a3200>=0x0;_0x1a3200--)if(_0x2cfd93=_0x3f94ea[_0x1a3200])_0x15dc50=(_0xaad27<0x3?_0x2cfd93(_0x15dc50):_0xaad27>0x3?_0x2cfd93(_0x24d7ab,_0x5be7a7,_0x15dc50):_0x2cfd93(_0x24d7ab,_0x5be7a7))||_0x15dc50;}return _0xaad27>0x3&&_0x15dc50&&Object['defineProperty'](_0x24d7ab,_0x5be7a7,_0x15dc50),_0x15dc50;},__importStar=this&&this[a232_0x2e2462(0xed)]||function(_0x4bc30e){const _0x1f9ec5=a232_0x2e2462;if(_0x4bc30e&&_0x4bc30e[_0x1f9ec5(0xe9)])return _0x4bc30e;var _0x2c7c91={};if(_0x4bc30e!=null){for(var _0x3364b4 in _0x4bc30e)if(_0x3364b4!==_0x1f9ec5(0xe3)&&Object[_0x1f9ec5(0xf2)][_0x1f9ec5(0xf6)][_0x1f9ec5(0xd9)](_0x4bc30e,_0x3364b4))__createBinding(_0x2c7c91,_0x4bc30e,_0x3364b4);}return __setModuleDefault(_0x2c7c91,_0x4bc30e),_0x2c7c91;},__metadata=this&&this[a232_0x2e2462(0xf4)]||function(_0x21f6f9,_0x11ab7b){const _0x55b3d3=a232_0x2e2462;if(typeof Reflect===_0x55b3d3(0xf9)&&typeof Reflect[_0x55b3d3(0x101)]===_0x55b3d3(0xbe))return Reflect[_0x55b3d3(0x101)](_0x21f6f9,_0x11ab7b);},__importDefault=this&&this[a232_0x2e2462(0xc2)]||function(_0x5ea76b){const _0x456ea1=a232_0x2e2462;return _0x5ea76b&&_0x5ea76b[_0x456ea1(0xe9)]?_0x5ea76b:{'default':_0x5ea76b};},SalesforceAuthService_1;function a232_0x2ef4(){const _0x4eccaa=['4950KOyacF','SalesforceAuthService','waitAuth','function','AUTH_WAIT_TIME','7OmRECq','setAuthDetails','__importDefault','/services/oauth2/token','create','../errors/invalid-refresh-token.error','531264FzwJTZ','typedi','ERR_INVALID_SALESFORCE_TOKEN','__createBinding','tokenType','name','logger','SALESFORCE_API_VERSION','forceUpdateToken','sleep','requestConfig','axios','3344472YQmNYH','length','then','update\x20access\x20token\x20failed:\x20%s','refresh_token','556066jfxUoh','token_type','call','instance_url','toString','instanceUrl','writable','UnauthorizedSalesforceError','(((.+)+)+)+$','__setModuleDefault','accessToken','../../../../constants','default','38996hybour','defineProperty','check\x20auth:\x20current\x20state\x20-\x20%s','Idle','AuthState','__esModule','1553168fNyEEM','Error','getOwnPropertyDescriptor','__importStar','Active','response','access\x20token\x20updated\x20for\x20%s','updateAccessToken','prototype','force\x20update\x20token','__metadata','post','hasOwnProperty','authState','../../../../constants/errors','object','../errors/unauthorized-salesforce.error','error','services/data/','800300XrCHrU','Tokens','../enums/auth-state.enum','data','metadata','1866Cqadae','decorate','update\x20access\x20token','InvalidRefreshTokenError','search','log','../../providers/providers.tokens','application/json'];a232_0x2ef4=function(){return _0x4eccaa;};return a232_0x2ef4();}Object['defineProperty'](exports,a232_0x2e2462(0xe9),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a232_0x2e2462(0xc7))),errors_1=require(a232_0x2e2462(0xf8)),core_1=require('../../../../core'),axios_1=__importDefault(require(a232_0x2e2462(0xd1))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a232_0x2e2462(0xc5)),auth_state_enum_1=require(a232_0x2e2462(0xff)),unauthorized_salesforce_error_1=require(a232_0x2e2462(0xfa)),constants_1=require(a232_0x2e2462(0xe2)),providers_tokens_1=require(a232_0x2e2462(0xb9));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x27ed8f=a232_0x2e2462;this['AUTH_WAIT_TIME']=0x1388,this[_0x27ed8f(0xf7)]=auth_state_enum_1[_0x27ed8f(0xe8)][_0x27ed8f(0xe7)],this[_0x27ed8f(0xcc)]=new core_1['Logger'](SalesforceAuthService_1[_0x27ed8f(0xcb)]),this[_0x27ed8f(0xc1)]();}async[a232_0x2e2462(0xc1)](){const _0x529076=a232_0x2e2462;this[_0x529076(0xcc)]['log'](_0x529076(0xe6),auth_state_enum_1[_0x529076(0xe8)][this['authState']]);try{if(this[_0x529076(0xf7)]===auth_state_enum_1['AuthState'][_0x529076(0xeb)])return;if(this['authState']===auth_state_enum_1[_0x529076(0xe8)]['Idle'])await this[_0x529076(0xf1)]();else{const _0x2adea4=await this[_0x529076(0xd0)](),_0x358e78=await axios_1['default']['get'](_0x529076(0xfc)+constants_1[_0x529076(0xcd)],_0x2adea4)[_0x529076(0xd4)](()=>!![])['catch'](()=>![]);!_0x358e78&&await this[_0x529076(0xf1)]();}}catch(_0x4d467f){}}async['updateAccessToken'](){const _0x1d6396=a232_0x2e2462;var _0x5e58ae,_0x559efd,_0x1ebd58;this[_0x1d6396(0xcc)][_0x1d6396(0xb8)](_0x1d6396(0xb5));try{this[_0x1d6396(0xf7)]=auth_state_enum_1[_0x1d6396(0xe8)]['Updating'];const {refreshToken:_0x35e33c,clientId:_0x54a544,clientSecret:_0x91bfba,loginUrl:_0xdfbe58}=typedi_1[_0x1d6396(0xe3)]['get'](providers_tokens_1[_0x1d6396(0xfe)]['salesforce']),{data:_0x3be760}=await axios_1[_0x1d6396(0xe3)][_0x1d6396(0xf5)]((0x0,utils_1['joinURL'])(_0xdfbe58,_0x1d6396(0xc3)),null,{'params':{'grant_type':_0x1d6396(0xd6),'refresh_token':_0x35e33c,'client_id':_0x54a544,'client_secret':_0x91bfba}});this[_0x1d6396(0xdc)]=_0x3be760[_0x1d6396(0xda)],this[_0x1d6396(0xe1)]=_0x3be760['access_token'],this[_0x1d6396(0xca)]=_0x3be760[_0x1d6396(0xd8)],this[_0x1d6396(0xf7)]=auth_state_enum_1[_0x1d6396(0xe8)][_0x1d6396(0xee)],this[_0x1d6396(0xcc)][_0x1d6396(0xb8)](_0x1d6396(0xf0),this[_0x1d6396(0xdc)]);}catch(_0x4464c7){const _0x3ef178=((_0x559efd=(_0x5e58ae=_0x4464c7===null||_0x4464c7===void 0x0?void 0x0:_0x4464c7[_0x1d6396(0xef)])===null||_0x5e58ae===void 0x0?void 0x0:_0x5e58ae[_0x1d6396(0x100)])===null||_0x559efd===void 0x0?void 0x0:_0x559efd[_0x1d6396(0xfb)])||((_0x1ebd58=_0x4464c7===null||_0x4464c7===void 0x0?void 0x0:_0x4464c7[_0x1d6396(0xef)])===null||_0x1ebd58===void 0x0?void 0x0:_0x1ebd58[_0x1d6396(0x100)])||_0x4464c7['message'];this[_0x1d6396(0xcc)][_0x1d6396(0xfb)](_0x1d6396(0xd5),_0x3ef178),this['authState']=auth_state_enum_1[_0x1d6396(0xe8)][_0x1d6396(0xeb)];throw new invalid_refresh_token_error_1[(_0x1d6396(0xb6))](errors_1[_0x1d6396(0xc8)]);}}async[a232_0x2e2462(0xce)](){const _0x54ee42=a232_0x2e2462;this[_0x54ee42(0xcc)]['log'](_0x54ee42(0xf3));if(this[_0x54ee42(0xf7)]===auth_state_enum_1['AuthState']['Updating']||this[_0x54ee42(0xf7)]===auth_state_enum_1['AuthState'][_0x54ee42(0xe7)])return await(0x0,utils_1['sleep'])(this[_0x54ee42(0xbf)]),this[_0x54ee42(0xce)]();if(this['authState']===auth_state_enum_1['AuthState'][_0x54ee42(0xeb)])throw new invalid_refresh_token_error_1[(_0x54ee42(0xb6))](errors_1[_0x54ee42(0xc8)]);await this[_0x54ee42(0xf1)]();}async[a232_0x2e2462(0xbd)](){const _0x1a3b70=a232_0x2e2462;if(this[_0x1a3b70(0xf7)]===auth_state_enum_1[_0x1a3b70(0xe8)][_0x1a3b70(0xeb)]){this[_0x1a3b70(0xcc)][_0x1a3b70(0xb8)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x1a3b70(0xde))]();}if(this[_0x1a3b70(0xf7)]!==auth_state_enum_1['AuthState'][_0x1a3b70(0xee)])return this[_0x1a3b70(0xcc)][_0x1a3b70(0xb8)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x1a3b70(0xcf)])(this['AUTH_WAIT_TIME']),this['waitAuth']();}['getAuthData'](){const _0x4f879d=a232_0x2e2462;return{'orgId':this['orgId'],'accessToken':this['accessToken'],'instanceUrl':this[_0x4f879d(0xdc)]};}async[a232_0x2e2462(0xd0)](){const _0x3128b0=a232_0x2e2462;return await this['waitAuth'](),{'baseURL':this[_0x3128b0(0xdc)],'headers':{'accept':_0x3128b0(0xba),'authorization':this[_0x3128b0(0xca)]+'\x20'+this[_0x3128b0(0xe1)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports[a232_0x2e2462(0xbc)]=SalesforceAuthService;