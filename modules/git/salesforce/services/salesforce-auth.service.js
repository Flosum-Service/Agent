const a271_0x2bf924=a271_0x5deb;(function(_0x32fb80,_0x5642f2){const _0x350e10=a271_0x5deb,_0x323c9c=_0x32fb80();while(!![]){try{const _0x95c585=-parseInt(_0x350e10(0x1bb))/0x1*(parseInt(_0x350e10(0x173))/0x2)+-parseInt(_0x350e10(0x1a3))/0x3*(-parseInt(_0x350e10(0x1c2))/0x4)+-parseInt(_0x350e10(0x187))/0x5+-parseInt(_0x350e10(0x182))/0x6*(parseInt(_0x350e10(0x1bc))/0x7)+parseInt(_0x350e10(0x1a1))/0x8*(-parseInt(_0x350e10(0x172))/0x9)+parseInt(_0x350e10(0x17e))/0xa*(parseInt(_0x350e10(0x18e))/0xb)+parseInt(_0x350e10(0x194))/0xc*(parseInt(_0x350e10(0x169))/0xd);if(_0x95c585===_0x5642f2)break;else _0x323c9c['push'](_0x323c9c['shift']());}catch(_0x5daf24){_0x323c9c['push'](_0x323c9c['shift']());}}}(a271_0x4673,0xdd3e9));const a271_0x5de5be=(function(){let _0x4cfc56=!![];return function(_0xdd73ee,_0x4eb832){const _0x400d20=_0x4cfc56?function(){const _0x374871=a271_0x5deb;if(_0x4eb832){const _0x300e72=_0x4eb832[_0x374871(0x183)](_0xdd73ee,arguments);return _0x4eb832=null,_0x300e72;}}:function(){};return _0x4cfc56=![],_0x400d20;};}()),a271_0x79269c=a271_0x5de5be(this,function(){const _0x1155cc=a271_0x5deb;return a271_0x79269c['toString']()['search'](_0x1155cc(0x1be))[_0x1155cc(0x178)]()[_0x1155cc(0x1ab)](a271_0x79269c)[_0x1155cc(0x1b7)](_0x1155cc(0x1be));});a271_0x79269c();'use strict';var __createBinding=this&&this[a271_0x2bf924(0x195)]||(Object[a271_0x2bf924(0x18f)]?function(_0x2033a7,_0x5c4d22,_0x17f755,_0x4580cd){const _0x2788be=a271_0x2bf924;if(_0x4580cd===undefined)_0x4580cd=_0x17f755;var _0x30425f=Object[_0x2788be(0x1ba)](_0x5c4d22,_0x17f755);(!_0x30425f||(_0x2788be(0x19a)in _0x30425f?!_0x5c4d22[_0x2788be(0x185)]:_0x30425f[_0x2788be(0x1bf)]||_0x30425f['configurable']))&&(_0x30425f={'enumerable':!![],'get':function(){return _0x5c4d22[_0x17f755];}}),Object[_0x2788be(0x1b5)](_0x2033a7,_0x4580cd,_0x30425f);}:function(_0x29f2c7,_0x322078,_0x181fd3,_0x1d28af){if(_0x1d28af===undefined)_0x1d28af=_0x181fd3;_0x29f2c7[_0x1d28af]=_0x322078[_0x181fd3];}),__setModuleDefault=this&&this[a271_0x2bf924(0x190)]||(Object[a271_0x2bf924(0x18f)]?function(_0x3dd188,_0x53f4a0){const _0x11fe8a=a271_0x2bf924;Object[_0x11fe8a(0x1b5)](_0x3dd188,_0x11fe8a(0x19d),{'enumerable':!![],'value':_0x53f4a0});}:function(_0x206109,_0x3c57ea){const _0x4f6613=a271_0x2bf924;_0x206109[_0x4f6613(0x19d)]=_0x3c57ea;}),__decorate=this&&this['__decorate']||function(_0x2245a3,_0x1a5b34,_0x17e95b,_0x599a76){const _0x1a973f=a271_0x2bf924;var _0x565f72=arguments[_0x1a973f(0x19f)],_0x3c47b6=_0x565f72<0x3?_0x1a5b34:_0x599a76===null?_0x599a76=Object[_0x1a973f(0x1ba)](_0x1a5b34,_0x17e95b):_0x599a76,_0x357bce;if(typeof Reflect===_0x1a973f(0x1b3)&&typeof Reflect['decorate']===_0x1a973f(0x179))_0x3c47b6=Reflect[_0x1a973f(0x163)](_0x2245a3,_0x1a5b34,_0x17e95b,_0x599a76);else{for(var _0x2cea46=_0x2245a3[_0x1a973f(0x19f)]-0x1;_0x2cea46>=0x0;_0x2cea46--)if(_0x357bce=_0x2245a3[_0x2cea46])_0x3c47b6=(_0x565f72<0x3?_0x357bce(_0x3c47b6):_0x565f72>0x3?_0x357bce(_0x1a5b34,_0x17e95b,_0x3c47b6):_0x357bce(_0x1a5b34,_0x17e95b))||_0x3c47b6;}return _0x565f72>0x3&&_0x3c47b6&&Object[_0x1a973f(0x1b5)](_0x1a5b34,_0x17e95b,_0x3c47b6),_0x3c47b6;},__importStar=this&&this['__importStar']||function(_0x282783){const _0x38d32a=a271_0x2bf924;if(_0x282783&&_0x282783[_0x38d32a(0x185)])return _0x282783;var _0x139625={};if(_0x282783!=null){for(var _0x43c9ba in _0x282783)if(_0x43c9ba!==_0x38d32a(0x19d)&&Object[_0x38d32a(0x1ad)]['hasOwnProperty']['call'](_0x282783,_0x43c9ba))__createBinding(_0x139625,_0x282783,_0x43c9ba);}return __setModuleDefault(_0x139625,_0x282783),_0x139625;},__metadata=this&&this[a271_0x2bf924(0x16f)]||function(_0x513c1e,_0x363e16){const _0x349539=a271_0x2bf924;if(typeof Reflect===_0x349539(0x1b3)&&typeof Reflect[_0x349539(0x1b1)]===_0x349539(0x179))return Reflect['metadata'](_0x513c1e,_0x363e16);},__importDefault=this&&this[a271_0x2bf924(0x19e)]||function(_0x5ca977){const _0x1a9489=a271_0x2bf924;return _0x5ca977&&_0x5ca977[_0x1a9489(0x185)]?_0x5ca977:{'default':_0x5ca977};},SalesforceAuthService_1;Object[a271_0x2bf924(0x1b5)](exports,a271_0x2bf924(0x185),{'value':!![]}),exports[a271_0x2bf924(0x177)]=void 0x0;function a271_0x5deb(_0x16fd4d,_0x1cce00){const _0x55a1d8=a271_0x4673();return a271_0x5deb=function(_0x79269c,_0x5de5be){_0x79269c=_0x79269c-0x163;let _0x467304=_0x55a1d8[_0x79269c];return _0x467304;},a271_0x5deb(_0x16fd4d,_0x1cce00);}const typedi_1=__importStar(require('typedi')),errors_1=require(a271_0x2bf924(0x1b2)),core_1=require(a271_0x2bf924(0x1a5)),axios_1=__importDefault(require(a271_0x2bf924(0x1b4))),utils_1=require(a271_0x2bf924(0x1a2)),invalid_refresh_token_error_1=require(a271_0x2bf924(0x189)),auth_state_enum_1=require(a271_0x2bf924(0x19c)),unauthorized_salesforce_error_1=require(a271_0x2bf924(0x18d)),constants_1=require(a271_0x2bf924(0x17c)),providers_tokens_1=require(a271_0x2bf924(0x197)),salesforce_1=require(a271_0x2bf924(0x1c3));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x4e153a=a271_0x2bf924;this['AUTH_WAIT_TIME']=0x1388,this[_0x4e153a(0x16b)]=auth_state_enum_1[_0x4e153a(0x16d)][_0x4e153a(0x1a4)],this[_0x4e153a(0x1a7)]=new core_1['Logger'](SalesforceAuthService_1[_0x4e153a(0x1bd)]),this[_0x4e153a(0x166)]();}async[a271_0x2bf924(0x166)](){const _0x37231e=a271_0x2bf924;this[_0x37231e(0x1a7)][_0x37231e(0x18b)](_0x37231e(0x1af),auth_state_enum_1[_0x37231e(0x16d)][this[_0x37231e(0x16b)]]);try{if(this[_0x37231e(0x16b)]===auth_state_enum_1[_0x37231e(0x16d)]['Error'])return;if(this[_0x37231e(0x16b)]===auth_state_enum_1[_0x37231e(0x16d)][_0x37231e(0x1a4)])await this['updateAccessToken']();else{const _0x1b5ba2=await this[_0x37231e(0x16c)](),_0xef31fa=await axios_1[_0x37231e(0x19d)][_0x37231e(0x19a)](_0x37231e(0x1b8)+constants_1[_0x37231e(0x1ae)],_0x1b5ba2)[_0x37231e(0x1b6)](()=>!![])[_0x37231e(0x1ac)](()=>![]);!_0xef31fa&&await this['updateAccessToken']();}}catch(_0x39e29f){}}async[a271_0x2bf924(0x165)](){const _0x20e08b=a271_0x2bf924;var _0x45fa7e,_0x22f027,_0x5ddc18;this[_0x20e08b(0x1a7)][_0x20e08b(0x18b)]('Update\x20access\x20token');try{this[_0x20e08b(0x16b)]=auth_state_enum_1[_0x20e08b(0x16d)][_0x20e08b(0x17b)];const {refreshToken:_0xf6b962,clientId:_0x11cf08,clientSecret:_0x1fe766,loginUrl:_0x4084e2}=typedi_1[_0x20e08b(0x19d)][_0x20e08b(0x19a)](providers_tokens_1[_0x20e08b(0x16e)][_0x20e08b(0x175)]),{data:_0x53a5c8}=await axios_1[_0x20e08b(0x19d)][_0x20e08b(0x191)]((0x0,utils_1['joinURL'])(_0x4084e2,'/services/oauth2/token'),null,{'params':{'grant_type':_0x20e08b(0x1b0),'refresh_token':_0xf6b962,'client_id':_0x11cf08,'client_secret':_0x1fe766}});this[_0x20e08b(0x176)]=_0x53a5c8[_0x20e08b(0x198)],this[_0x20e08b(0x167)]=_0x53a5c8[_0x20e08b(0x192)],this['tokenType']=_0x53a5c8['token_type'],this[_0x20e08b(0x16b)]=auth_state_enum_1[_0x20e08b(0x16d)][_0x20e08b(0x18a)],this[_0x20e08b(0x1a7)][_0x20e08b(0x18b)]('Access\x20token\x20updated\x20for\x20%s',this[_0x20e08b(0x176)]);}catch(_0x2b111e){const _0x2d2dc0=((_0x22f027=(_0x45fa7e=_0x2b111e===null||_0x2b111e===void 0x0?void 0x0:_0x2b111e[_0x20e08b(0x19b)])===null||_0x45fa7e===void 0x0?void 0x0:_0x45fa7e[_0x20e08b(0x1a0)])===null||_0x22f027===void 0x0?void 0x0:_0x22f027[_0x20e08b(0x164)])||((_0x5ddc18=_0x2b111e===null||_0x2b111e===void 0x0?void 0x0:_0x2b111e[_0x20e08b(0x19b)])===null||_0x5ddc18===void 0x0?void 0x0:_0x5ddc18[_0x20e08b(0x1a0)])||_0x2b111e['message'];this['logger'][_0x20e08b(0x164)]('Update\x20access\x20token\x20failed:\x20%s',_0x2d2dc0),this['authState']=auth_state_enum_1['AuthState'][_0x20e08b(0x1c1)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x20e08b(0x180)]);}}async[a271_0x2bf924(0x17d)](){const _0x111734=a271_0x2bf924;this['logger']['log']('Force\x20update\x20token');if(this['authState']===auth_state_enum_1[_0x111734(0x16d)][_0x111734(0x17b)]||this[_0x111734(0x16b)]===auth_state_enum_1[_0x111734(0x16d)][_0x111734(0x1a4)])return await(0x0,utils_1['sleep'])(this[_0x111734(0x1c0)]),this[_0x111734(0x17d)]();if(this['authState']===auth_state_enum_1[_0x111734(0x16d)][_0x111734(0x1c1)])throw new invalid_refresh_token_error_1[(_0x111734(0x186))](errors_1[_0x111734(0x180)]);await this['updateAccessToken']();}async['waitAuth'](){const _0x4c8f48=a271_0x2bf924;if(this['authState']===auth_state_enum_1[_0x4c8f48(0x16d)][_0x4c8f48(0x1c1)]){this[_0x4c8f48(0x1a7)]['log'](_0x4c8f48(0x16a));throw new unauthorized_salesforce_error_1[(_0x4c8f48(0x1a6))]();}if(this['authState']!==auth_state_enum_1[_0x4c8f48(0x16d)][_0x4c8f48(0x18a)])return this[_0x4c8f48(0x1a7)][_0x4c8f48(0x18b)](_0x4c8f48(0x174)),await(0x0,utils_1[_0x4c8f48(0x193)])(this[_0x4c8f48(0x1c0)]),this[_0x4c8f48(0x199)]();}[a271_0x2bf924(0x1a9)](){const _0x1e211b=a271_0x2bf924;return{'orgId':this['orgId'],'accessToken':this['accessToken'],'instanceUrl':this[_0x1e211b(0x176)]};}async[a271_0x2bf924(0x16c)](_0x368df9=''){const _0x3f5ae0=a271_0x2bf924;await this['waitAuth']();const _0x48115a={'baseURL':this[_0x3f5ae0(0x176)],'headers':{'accept':_0x3f5ae0(0x184)}};if(salesforce_1['SalesforceUtils'][_0x3f5ae0(0x1b9)](_0x368df9))_0x48115a[_0x3f5ae0(0x188)][_0x3f5ae0(0x17f)]=this[_0x3f5ae0(0x167)];else salesforce_1[_0x3f5ae0(0x1aa)][_0x3f5ae0(0x168)](_0x368df9)?_0x48115a[_0x3f5ae0(0x1a0)]=_0x48115a[_0x3f5ae0(0x1a0)][_0x3f5ae0(0x170)](/<met:sessionId>.+?<\/met:sessionId>/,_0x3f5ae0(0x196)+this[_0x3f5ae0(0x167)]+_0x3f5ae0(0x18c)):_0x48115a[_0x3f5ae0(0x188)][_0x3f5ae0(0x1a8)]=this[_0x3f5ae0(0x17a)]+'\x20'+this['accessToken'];return _0x48115a;}};function a271_0x4673(){const _0x26887e=['function','tokenType','Updating','../../../../constants','forceUpdateToken','10BeCKkl','X-SFDC-Session','ERR_INVALID_SALESFORCE_TOKEN','design:paramtypes','114qxpTVp','apply','application/json','__esModule','InvalidRefreshTokenError','6581120MQrHWn','headers','../errors/invalid-refresh-token.error','Active','log','</met:sessionId>','../errors/unauthorized-salesforce.error','408287igaCHC','create','__setModuleDefault','post','access_token','sleep','12fqNPMq','__createBinding','<met:sessionId>','../../providers/providers.tokens','instance_url','waitAuth','get','response','../enums/auth-state.enum','default','__importDefault','length','data','6967504MZqOUh','../../../shared/utils','1672293tywHRR','Idle','../../../../core','UnauthorizedSalesforceError','logger','authorization','getAuthData','SalesforceUtils','constructor','catch','prototype','SALESFORCE_API_VERSION','Check\x20auth:\x20current\x20state\x20-\x20%s','refresh_token','metadata','../../../../constants/errors','object','axios','defineProperty','then','search','services/data/','isBulk1Url','getOwnPropertyDescriptor','4363MMOVfp','287315LcPFXl','name','(((.+)+)+)+$','writable','AUTH_WAIT_TIME','Error','4yaomLV','@flosum/salesforce','decorate','error','updateAccessToken','setAuthDetails','accessToken','isSoapUrl','55022773ekKUzY','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','authState','requestConfig','AuthState','Tokens','__metadata','replace','Service','18OyWSrE','38RXBOJf','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','salesforce','instanceUrl','SalesforceAuthService','toString'];a271_0x4673=function(){return _0x26887e;};return a271_0x4673();}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a271_0x2bf924(0x171)])(),__metadata(a271_0x2bf924(0x181),[])],SalesforceAuthService),exports[a271_0x2bf924(0x177)]=SalesforceAuthService;