const a270_0x3e0d88=a270_0x21cf;(function(_0x6492ff,_0x47c98e){const _0x6b7f44=a270_0x21cf,_0x11ac74=_0x6492ff();while(!![]){try{const _0x5afc7a=-parseInt(_0x6b7f44(0x1b3))/0x1+parseInt(_0x6b7f44(0x1fb))/0x2+parseInt(_0x6b7f44(0x1d5))/0x3*(-parseInt(_0x6b7f44(0x206))/0x4)+-parseInt(_0x6b7f44(0x1fe))/0x5*(parseInt(_0x6b7f44(0x1e5))/0x6)+parseInt(_0x6b7f44(0x202))/0x7*(parseInt(_0x6b7f44(0x1b9))/0x8)+parseInt(_0x6b7f44(0x1e3))/0x9*(-parseInt(_0x6b7f44(0x1e1))/0xa)+parseInt(_0x6b7f44(0x1c4))/0xb;if(_0x5afc7a===_0x47c98e)break;else _0x11ac74['push'](_0x11ac74['shift']());}catch(_0xf2617f){_0x11ac74['push'](_0x11ac74['shift']());}}}(a270_0x5aa7,0xad5ff));const a270_0x18b908=(function(){let _0x1eced4=!![];return function(_0x2174cc,_0x9dfec7){const _0x5b9852=_0x1eced4?function(){if(_0x9dfec7){const _0x224abc=_0x9dfec7['apply'](_0x2174cc,arguments);return _0x9dfec7=null,_0x224abc;}}:function(){};return _0x1eced4=![],_0x5b9852;};}()),a270_0x3da5d6=a270_0x18b908(this,function(){const _0x3a7917=a270_0x21cf;return a270_0x3da5d6[_0x3a7917(0x1d1)]()['search'](_0x3a7917(0x1bd))[_0x3a7917(0x1d1)]()[_0x3a7917(0x1ee)](a270_0x3da5d6)[_0x3a7917(0x1f8)](_0x3a7917(0x1bd));});a270_0x3da5d6();function a270_0x5aa7(){const _0x23ffaf=['207qbiGJj','Error','18eJdtZR','error','__importDefault','prototype','updateAccessToken','../errors/invalid-refresh-token.error','replace','post','Service','constructor','Force\x20update\x20token','__esModule','SalesforceAuthService','__importStar','instanceUrl','log','Active','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','Access\x20token\x20updated\x20for\x20%s','search','token_type','instance_url','1148776GDMWhv','default','requestConfig','1279925xdNUIH','hasOwnProperty','@flosum/salesforce','joinURL','10164GfwhMJ','headers','../enums/auth-state.enum','SALESFORCE_API_VERSION','12348LwlGBe','InvalidRefreshTokenError','function','typedi','setAuthDetails','Logger','ERR_INVALID_SALESFORCE_TOKEN','call','accessToken','__metadata','metadata','isSoapUrl','1281572XgBMKF','logger','../../../../constants/errors','</met:sessionId>','create','Update\x20access\x20token\x20failed:\x20%s','1464SUbKOJ','decorate','getOwnPropertyDescriptor','authState','(((.+)+)+)+$','application/json','then','response','AUTH_WAIT_TIME','UnauthorizedSalesforceError','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','34345245ledVsC','defineProperty','authorization','Update\x20access\x20token','data','Updating','Idle','Tokens','__createBinding','object','get','getAuthData','sleep','toString','configurable','tokenType','isBulk1Url','270ounUTo','../../providers/providers.tokens','orgId','/services/oauth2/token','access_token','length','SalesforceUtils','forceUpdateToken','AuthState','salesforce','waitAuth','../../../../constants','402130MkBvoT','design:paramtypes'];a270_0x5aa7=function(){return _0x23ffaf;};return a270_0x5aa7();}'use strict';function a270_0x21cf(_0xc035bf,_0x1614bb){const _0x5c49c0=a270_0x5aa7();return a270_0x21cf=function(_0x3da5d6,_0x18b908){_0x3da5d6=_0x3da5d6-0x1ae;let _0x5aa7f4=_0x5c49c0[_0x3da5d6];return _0x5aa7f4;},a270_0x21cf(_0xc035bf,_0x1614bb);}var __createBinding=this&&this[a270_0x3e0d88(0x1cc)]||(Object['create']?function(_0x31a3a5,_0x29151c,_0x346414,_0x2892c2){const _0x5243c4=a270_0x3e0d88;if(_0x2892c2===undefined)_0x2892c2=_0x346414;var _0x104247=Object[_0x5243c4(0x1bb)](_0x29151c,_0x346414);(!_0x104247||(_0x5243c4(0x1ce)in _0x104247?!_0x29151c[_0x5243c4(0x1f0)]:_0x104247['writable']||_0x104247[_0x5243c4(0x1d2)]))&&(_0x104247={'enumerable':!![],'get':function(){return _0x29151c[_0x346414];}}),Object[_0x5243c4(0x1c5)](_0x31a3a5,_0x2892c2,_0x104247);}:function(_0x1dcb59,_0x1abceb,_0x1afa98,_0x489425){if(_0x489425===undefined)_0x489425=_0x1afa98;_0x1dcb59[_0x489425]=_0x1abceb[_0x1afa98];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a270_0x3e0d88(0x1b7)]?function(_0x52466a,_0x1e07c6){const _0x1df870=a270_0x3e0d88;Object[_0x1df870(0x1c5)](_0x52466a,'default',{'enumerable':!![],'value':_0x1e07c6});}:function(_0x13a6a1,_0x16d07e){const _0x4e2223=a270_0x3e0d88;_0x13a6a1[_0x4e2223(0x1fc)]=_0x16d07e;}),__decorate=this&&this['__decorate']||function(_0x4b92f1,_0x3b4376,_0x3ec5d5,_0x5495e9){const _0x338c4b=a270_0x3e0d88;var _0x3eed83=arguments[_0x338c4b(0x1da)],_0x2935d3=_0x3eed83<0x3?_0x3b4376:_0x5495e9===null?_0x5495e9=Object[_0x338c4b(0x1bb)](_0x3b4376,_0x3ec5d5):_0x5495e9,_0x5c9834;if(typeof Reflect===_0x338c4b(0x1cd)&&typeof Reflect[_0x338c4b(0x1ba)]==='function')_0x2935d3=Reflect[_0x338c4b(0x1ba)](_0x4b92f1,_0x3b4376,_0x3ec5d5,_0x5495e9);else{for(var _0x3ff0e9=_0x4b92f1['length']-0x1;_0x3ff0e9>=0x0;_0x3ff0e9--)if(_0x5c9834=_0x4b92f1[_0x3ff0e9])_0x2935d3=(_0x3eed83<0x3?_0x5c9834(_0x2935d3):_0x3eed83>0x3?_0x5c9834(_0x3b4376,_0x3ec5d5,_0x2935d3):_0x5c9834(_0x3b4376,_0x3ec5d5))||_0x2935d3;}return _0x3eed83>0x3&&_0x2935d3&&Object[_0x338c4b(0x1c5)](_0x3b4376,_0x3ec5d5,_0x2935d3),_0x2935d3;},__importStar=this&&this[a270_0x3e0d88(0x1f2)]||function(_0x18e44a){const _0xf8a5d5=a270_0x3e0d88;if(_0x18e44a&&_0x18e44a[_0xf8a5d5(0x1f0)])return _0x18e44a;var _0x54ac8a={};if(_0x18e44a!=null){for(var _0x5c3301 in _0x18e44a)if(_0x5c3301!=='default'&&Object[_0xf8a5d5(0x1e8)][_0xf8a5d5(0x1ff)][_0xf8a5d5(0x1ae)](_0x18e44a,_0x5c3301))__createBinding(_0x54ac8a,_0x18e44a,_0x5c3301);}return __setModuleDefault(_0x54ac8a,_0x18e44a),_0x54ac8a;},__metadata=this&&this[a270_0x3e0d88(0x1b0)]||function(_0x5353ef,_0x227766){const _0x1ff02d=a270_0x3e0d88;if(typeof Reflect===_0x1ff02d(0x1cd)&&typeof Reflect[_0x1ff02d(0x1b1)]===_0x1ff02d(0x208))return Reflect['metadata'](_0x5353ef,_0x227766);},__importDefault=this&&this[a270_0x3e0d88(0x1e7)]||function(_0x532d1e){const _0x1a9166=a270_0x3e0d88;return _0x532d1e&&_0x532d1e[_0x1a9166(0x1f0)]?_0x532d1e:{'default':_0x532d1e};},SalesforceAuthService_1;Object[a270_0x3e0d88(0x1c5)](exports,a270_0x3e0d88(0x1f0),{'value':!![]}),exports[a270_0x3e0d88(0x1f1)]=void 0x0;const typedi_1=__importStar(require(a270_0x3e0d88(0x209))),errors_1=require(a270_0x3e0d88(0x1b5)),core_1=require('../../../../core'),axios_1=__importDefault(require('axios')),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a270_0x3e0d88(0x1ea)),auth_state_enum_1=require(a270_0x3e0d88(0x204)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a270_0x3e0d88(0x1e0)),providers_tokens_1=require(a270_0x3e0d88(0x1d6)),salesforce_1=require(a270_0x3e0d88(0x200));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x376b12=a270_0x3e0d88;this[_0x376b12(0x1c1)]=0x1388,this[_0x376b12(0x1bc)]=auth_state_enum_1['AuthState']['Idle'],this['logger']=new core_1[(_0x376b12(0x20b))](SalesforceAuthService_1['name']),this[_0x376b12(0x20a)]();}async['setAuthDetails'](){const _0x282781=a270_0x3e0d88;this[_0x282781(0x1b4)][_0x282781(0x1f4)]('Check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x282781(0x1dd)][this[_0x282781(0x1bc)]]);try{if(this['authState']===auth_state_enum_1[_0x282781(0x1dd)][_0x282781(0x1e4)])return;if(this[_0x282781(0x1bc)]===auth_state_enum_1[_0x282781(0x1dd)][_0x282781(0x1ca)])await this[_0x282781(0x1e9)]();else{const _0x426772=await this[_0x282781(0x1fd)](),_0x2b1c5e=await axios_1['default'][_0x282781(0x1ce)]('services/data/'+constants_1[_0x282781(0x205)],_0x426772)[_0x282781(0x1bf)](()=>!![])['catch'](()=>![]);!_0x2b1c5e&&await this[_0x282781(0x1e9)]();}}catch(_0x94c4a4){}}async[a270_0x3e0d88(0x1e9)](){const _0x1f277c=a270_0x3e0d88;var _0x2e9b3e,_0x2f9b28,_0x1c68f1;this[_0x1f277c(0x1b4)][_0x1f277c(0x1f4)](_0x1f277c(0x1c7));try{this['authState']=auth_state_enum_1[_0x1f277c(0x1dd)][_0x1f277c(0x1c9)];const {refreshToken:_0x344020,clientId:_0x37752d,clientSecret:_0xf7eea6,loginUrl:_0x15f3d6}=typedi_1[_0x1f277c(0x1fc)][_0x1f277c(0x1ce)](providers_tokens_1[_0x1f277c(0x1cb)][_0x1f277c(0x1de)]),{data:_0x225f61}=await axios_1[_0x1f277c(0x1fc)][_0x1f277c(0x1ec)]((0x0,utils_1[_0x1f277c(0x201)])(_0x15f3d6,_0x1f277c(0x1d8)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x344020,'client_id':_0x37752d,'client_secret':_0xf7eea6}});this['instanceUrl']=_0x225f61[_0x1f277c(0x1fa)],this[_0x1f277c(0x1af)]=_0x225f61[_0x1f277c(0x1d9)],this[_0x1f277c(0x1d3)]=_0x225f61[_0x1f277c(0x1f9)],this[_0x1f277c(0x1bc)]=auth_state_enum_1[_0x1f277c(0x1dd)][_0x1f277c(0x1f5)],this[_0x1f277c(0x1b4)][_0x1f277c(0x1f4)](_0x1f277c(0x1f7),this[_0x1f277c(0x1f3)]);}catch(_0x259dfd){const _0x502d0a=((_0x2f9b28=(_0x2e9b3e=_0x259dfd===null||_0x259dfd===void 0x0?void 0x0:_0x259dfd[_0x1f277c(0x1c0)])===null||_0x2e9b3e===void 0x0?void 0x0:_0x2e9b3e['data'])===null||_0x2f9b28===void 0x0?void 0x0:_0x2f9b28[_0x1f277c(0x1e6)])||((_0x1c68f1=_0x259dfd===null||_0x259dfd===void 0x0?void 0x0:_0x259dfd[_0x1f277c(0x1c0)])===null||_0x1c68f1===void 0x0?void 0x0:_0x1c68f1['data'])||_0x259dfd['message'];this[_0x1f277c(0x1b4)][_0x1f277c(0x1e6)](_0x1f277c(0x1b8),_0x502d0a),this[_0x1f277c(0x1bc)]=auth_state_enum_1['AuthState']['Error'];throw new invalid_refresh_token_error_1[(_0x1f277c(0x207))](errors_1[_0x1f277c(0x20c)]);}}async['forceUpdateToken'](){const _0x1d5b2c=a270_0x3e0d88;this[_0x1d5b2c(0x1b4)][_0x1d5b2c(0x1f4)](_0x1d5b2c(0x1ef));if(this['authState']===auth_state_enum_1[_0x1d5b2c(0x1dd)][_0x1d5b2c(0x1c9)]||this[_0x1d5b2c(0x1bc)]===auth_state_enum_1[_0x1d5b2c(0x1dd)][_0x1d5b2c(0x1ca)])return await(0x0,utils_1[_0x1d5b2c(0x1d0)])(this[_0x1d5b2c(0x1c1)]),this[_0x1d5b2c(0x1dc)]();if(this[_0x1d5b2c(0x1bc)]===auth_state_enum_1[_0x1d5b2c(0x1dd)][_0x1d5b2c(0x1e4)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x1d5b2c(0x1e9)]();}async[a270_0x3e0d88(0x1df)](){const _0x9de359=a270_0x3e0d88;if(this[_0x9de359(0x1bc)]===auth_state_enum_1[_0x9de359(0x1dd)][_0x9de359(0x1e4)]){this['logger']['log'](_0x9de359(0x1c3));throw new unauthorized_salesforce_error_1[(_0x9de359(0x1c2))]();}if(this[_0x9de359(0x1bc)]!==auth_state_enum_1['AuthState'][_0x9de359(0x1f5)])return this[_0x9de359(0x1b4)][_0x9de359(0x1f4)](_0x9de359(0x1f6)),await(0x0,utils_1[_0x9de359(0x1d0)])(this[_0x9de359(0x1c1)]),this[_0x9de359(0x1df)]();}[a270_0x3e0d88(0x1cf)](){const _0x4b9212=a270_0x3e0d88;return{'orgId':this[_0x4b9212(0x1d7)],'accessToken':this[_0x4b9212(0x1af)],'instanceUrl':this[_0x4b9212(0x1f3)]};}async[a270_0x3e0d88(0x1fd)](_0x3e15d7=''){const _0x776668=a270_0x3e0d88;await this[_0x776668(0x1df)]();const _0x1b0e1f={'baseURL':this['instanceUrl'],'headers':{'accept':_0x776668(0x1be)}};if(salesforce_1[_0x776668(0x1db)][_0x776668(0x1d4)](_0x3e15d7))_0x1b0e1f[_0x776668(0x203)]['X-SFDC-Session']=this[_0x776668(0x1af)];else salesforce_1[_0x776668(0x1db)][_0x776668(0x1b2)](_0x3e15d7)?_0x1b0e1f[_0x776668(0x1c8)]=_0x1b0e1f['data'][_0x776668(0x1eb)](/<met:sessionId>.+?<\/met:sessionId>/,'<met:sessionId>'+this[_0x776668(0x1af)]+_0x776668(0x1b6)):_0x1b0e1f['headers'][_0x776668(0x1c6)]=this['tokenType']+'\x20'+this[_0x776668(0x1af)];return _0x1b0e1f;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a270_0x3e0d88(0x1ed)])(),__metadata(a270_0x3e0d88(0x1e2),[])],SalesforceAuthService),exports[a270_0x3e0d88(0x1f1)]=SalesforceAuthService;