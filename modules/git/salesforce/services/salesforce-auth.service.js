const a270_0x4afff4=a270_0x5311;(function(_0x4ba717,_0x2ea34a){const _0x4b8e94=a270_0x5311,_0x51528b=_0x4ba717();while(!![]){try{const _0x44763f=parseInt(_0x4b8e94(0xcb))/0x1+-parseInt(_0x4b8e94(0x7e))/0x2+parseInt(_0x4b8e94(0x9d))/0x3+-parseInt(_0x4b8e94(0xab))/0x4+parseInt(_0x4b8e94(0x82))/0x5*(-parseInt(_0x4b8e94(0xdb))/0x6)+-parseInt(_0x4b8e94(0xa9))/0x7*(-parseInt(_0x4b8e94(0xa2))/0x8)+-parseInt(_0x4b8e94(0xc2))/0x9*(-parseInt(_0x4b8e94(0xcf))/0xa);if(_0x44763f===_0x2ea34a)break;else _0x51528b['push'](_0x51528b['shift']());}catch(_0x5c30f9){_0x51528b['push'](_0x51528b['shift']());}}}(a270_0x3e1e,0x673e4));const a270_0x3aab43=(function(){let _0x1187cb=!![];return function(_0x1a10cb,_0x55f365){const _0xb5b3fe=_0x1187cb?function(){const _0x393706=a270_0x5311;if(_0x55f365){const _0x342e16=_0x55f365[_0x393706(0xa3)](_0x1a10cb,arguments);return _0x55f365=null,_0x342e16;}}:function(){};return _0x1187cb=![],_0xb5b3fe;};}()),a270_0x25bc5e=a270_0x3aab43(this,function(){const _0x4ab097=a270_0x5311;return a270_0x25bc5e[_0x4ab097(0xb0)]()[_0x4ab097(0xb4)](_0x4ab097(0x86))[_0x4ab097(0xb0)]()['constructor'](a270_0x25bc5e)[_0x4ab097(0xb4)](_0x4ab097(0x86));});function a270_0x5311(_0x1ca0ff,_0x14ccfb){const _0x327325=a270_0x3e1e();return a270_0x5311=function(_0x25bc5e,_0x3aab43){_0x25bc5e=_0x25bc5e-0x7e;let _0x3e1ee7=_0x327325[_0x25bc5e];return _0x3e1ee7;},a270_0x5311(_0x1ca0ff,_0x14ccfb);}a270_0x25bc5e();'use strict';var __createBinding=this&&this[a270_0x4afff4(0x8e)]||(Object[a270_0x4afff4(0x85)]?function(_0x1da142,_0x2dc1eb,_0x2b44ed,_0x59e7ba){const _0x876e07=a270_0x4afff4;if(_0x59e7ba===undefined)_0x59e7ba=_0x2b44ed;var _0x2e6377=Object[_0x876e07(0x89)](_0x2dc1eb,_0x2b44ed);(!_0x2e6377||('get'in _0x2e6377?!_0x2dc1eb[_0x876e07(0x9b)]:_0x2e6377[_0x876e07(0x8b)]||_0x2e6377[_0x876e07(0x93)]))&&(_0x2e6377={'enumerable':!![],'get':function(){return _0x2dc1eb[_0x2b44ed];}}),Object[_0x876e07(0xc5)](_0x1da142,_0x59e7ba,_0x2e6377);}:function(_0x3a1a86,_0x268c94,_0x2ea444,_0x2dffb9){if(_0x2dffb9===undefined)_0x2dffb9=_0x2ea444;_0x3a1a86[_0x2dffb9]=_0x268c94[_0x2ea444];}),__setModuleDefault=this&&this[a270_0x4afff4(0x8d)]||(Object[a270_0x4afff4(0x85)]?function(_0x2d775f,_0x14670e){const _0x51f091=a270_0x4afff4;Object[_0x51f091(0xc5)](_0x2d775f,_0x51f091(0xa4),{'enumerable':!![],'value':_0x14670e});}:function(_0x15b1a5,_0xf74659){const _0x440553=a270_0x4afff4;_0x15b1a5[_0x440553(0xa4)]=_0xf74659;}),__decorate=this&&this['__decorate']||function(_0x4faf82,_0x311f5d,_0x3aa4e7,_0xb05bc3){const _0xda594e=a270_0x4afff4;var _0x394dfd=arguments[_0xda594e(0xae)],_0xef39ab=_0x394dfd<0x3?_0x311f5d:_0xb05bc3===null?_0xb05bc3=Object['getOwnPropertyDescriptor'](_0x311f5d,_0x3aa4e7):_0xb05bc3,_0x45854;if(typeof Reflect==='object'&&typeof Reflect[_0xda594e(0xc0)]===_0xda594e(0xce))_0xef39ab=Reflect['decorate'](_0x4faf82,_0x311f5d,_0x3aa4e7,_0xb05bc3);else{for(var _0x3d94d5=_0x4faf82[_0xda594e(0xae)]-0x1;_0x3d94d5>=0x0;_0x3d94d5--)if(_0x45854=_0x4faf82[_0x3d94d5])_0xef39ab=(_0x394dfd<0x3?_0x45854(_0xef39ab):_0x394dfd>0x3?_0x45854(_0x311f5d,_0x3aa4e7,_0xef39ab):_0x45854(_0x311f5d,_0x3aa4e7))||_0xef39ab;}return _0x394dfd>0x3&&_0xef39ab&&Object[_0xda594e(0xc5)](_0x311f5d,_0x3aa4e7,_0xef39ab),_0xef39ab;},__importStar=this&&this[a270_0x4afff4(0xa0)]||function(_0xab2d43){const _0x49fea7=a270_0x4afff4;if(_0xab2d43&&_0xab2d43['__esModule'])return _0xab2d43;var _0x170838={};if(_0xab2d43!=null){for(var _0x5a2617 in _0xab2d43)if(_0x5a2617!==_0x49fea7(0xa4)&&Object[_0x49fea7(0xb9)][_0x49fea7(0xd5)][_0x49fea7(0xdd)](_0xab2d43,_0x5a2617))__createBinding(_0x170838,_0xab2d43,_0x5a2617);}return __setModuleDefault(_0x170838,_0xab2d43),_0x170838;},__metadata=this&&this[a270_0x4afff4(0x81)]||function(_0x5d01c4,_0x5f52d8){const _0x5cfeef=a270_0x4afff4;if(typeof Reflect===_0x5cfeef(0xba)&&typeof Reflect['metadata']==='function')return Reflect[_0x5cfeef(0x92)](_0x5d01c4,_0x5f52d8);},__importDefault=this&&this[a270_0x4afff4(0x97)]||function(_0x26fc6d){const _0x8153b9=a270_0x4afff4;return _0x26fc6d&&_0x26fc6d[_0x8153b9(0x9b)]?_0x26fc6d:{'default':_0x26fc6d};},SalesforceAuthService_1;Object[a270_0x4afff4(0xc5)](exports,a270_0x4afff4(0x9b),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a270_0x4afff4(0xd7))),errors_1=require(a270_0x4afff4(0xbb)),core_1=require(a270_0x4afff4(0x98)),axios_1=__importDefault(require('axios')),utils_1=require(a270_0x4afff4(0xaa)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a270_0x4afff4(0xbf)),unauthorized_salesforce_error_1=require(a270_0x4afff4(0xb2)),constants_1=require(a270_0x4afff4(0x9e)),providers_tokens_1=require(a270_0x4afff4(0xb6)),salesforce_1=require(a270_0x4afff4(0xb3));function a270_0x3e1e(){const _0x2945de=['813438hkQHzZ','authState','tokenType','function','7743770ZbhciZ','headers','name','response','instance_url','catch','hasOwnProperty','data','typedi','InvalidRefreshTokenError','joinURL','Idle','708MKiDMi','waitAuth','call','Error','services/data/','SalesforceUtils','X-SFDC-Session','Access\x20token\x20updated\x20for\x20%s','Tokens','1203966ZliTdC','error','AuthState','__metadata','20380aRietL','log','replace','create','(((.+)+)+)+$','Updating','Check\x20auth:\x20current\x20state\x20-\x20%s','getOwnPropertyDescriptor','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','writable','SALESFORCE_API_VERSION','__setModuleDefault','__createBinding','then','get','token_type','metadata','configurable','sleep','Update\x20access\x20token','salesforce','__importDefault','../../../../core','accessToken','design:paramtypes','__esModule','refresh_token','1633284MREkmS','../../../../constants','getAuthData','__importStar','Logger','232RnTGaq','apply','default','message','ERR_INVALID_SALESFORCE_TOKEN','requestConfig','updateAccessToken','43533qVFasJ','../../../shared/utils','3227036mvlmEo','forceUpdateToken','logger','length','Service','toString','AUTH_WAIT_TIME','../errors/unauthorized-salesforce.error','@flosum/salesforce','search','application/json','../../providers/providers.tokens','</met:sessionId>','isSoapUrl','prototype','object','../../../../constants/errors','<met:sessionId>','isBulk1Url','Update\x20access\x20token\x20failed:\x20%s','../enums/auth-state.enum','decorate','instanceUrl','9IlpUdR','/services/oauth2/token','authorization','defineProperty','setAuthDetails','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','orgId','post','Active'];a270_0x3e1e=function(){return _0x2945de;};return a270_0x3e1e();}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x3e0c4b=a270_0x4afff4;this[_0x3e0c4b(0xb1)]=0x1388,this['authState']=auth_state_enum_1[_0x3e0c4b(0x80)][_0x3e0c4b(0xda)],this['logger']=new core_1[(_0x3e0c4b(0xa1))](SalesforceAuthService_1[_0x3e0c4b(0xd1)]),this[_0x3e0c4b(0xc6)]();}async['setAuthDetails'](){const _0x41d5be=a270_0x4afff4;this[_0x41d5be(0xad)][_0x41d5be(0x83)](_0x41d5be(0x88),auth_state_enum_1[_0x41d5be(0x80)][this['authState']]);try{if(this[_0x41d5be(0xcc)]===auth_state_enum_1[_0x41d5be(0x80)][_0x41d5be(0xde)])return;if(this[_0x41d5be(0xcc)]===auth_state_enum_1['AuthState'][_0x41d5be(0xda)])await this[_0x41d5be(0xa8)]();else{const _0x175e6d=await this[_0x41d5be(0xa7)](),_0x485460=await axios_1[_0x41d5be(0xa4)]['get'](_0x41d5be(0xdf)+constants_1[_0x41d5be(0x8c)],_0x175e6d)[_0x41d5be(0x8f)](()=>!![])[_0x41d5be(0xd4)](()=>![]);!_0x485460&&await this[_0x41d5be(0xa8)]();}}catch(_0x370025){}}async['updateAccessToken'](){const _0x268077=a270_0x4afff4;var _0x28df25,_0x3d58c7,_0x14abd2;this[_0x268077(0xad)][_0x268077(0x83)](_0x268077(0x95));try{this[_0x268077(0xcc)]=auth_state_enum_1[_0x268077(0x80)][_0x268077(0x87)];const {refreshToken:_0x3214f1,clientId:_0x2af0e2,clientSecret:_0x7da92c,loginUrl:_0x55fc1e}=typedi_1[_0x268077(0xa4)][_0x268077(0x90)](providers_tokens_1[_0x268077(0xe3)][_0x268077(0x96)]),{data:_0x47e008}=await axios_1[_0x268077(0xa4)][_0x268077(0xc9)]((0x0,utils_1[_0x268077(0xd9)])(_0x55fc1e,_0x268077(0xc3)),null,{'params':{'grant_type':_0x268077(0x9c),'refresh_token':_0x3214f1,'client_id':_0x2af0e2,'client_secret':_0x7da92c}});this[_0x268077(0xc1)]=_0x47e008[_0x268077(0xd3)],this[_0x268077(0x99)]=_0x47e008['access_token'],this[_0x268077(0xcd)]=_0x47e008[_0x268077(0x91)],this['authState']=auth_state_enum_1['AuthState']['Active'],this[_0x268077(0xad)][_0x268077(0x83)](_0x268077(0xe2),this['instanceUrl']);}catch(_0x4e8374){const _0x423ee3=((_0x3d58c7=(_0x28df25=_0x4e8374===null||_0x4e8374===void 0x0?void 0x0:_0x4e8374[_0x268077(0xd2)])===null||_0x28df25===void 0x0?void 0x0:_0x28df25['data'])===null||_0x3d58c7===void 0x0?void 0x0:_0x3d58c7[_0x268077(0x7f)])||((_0x14abd2=_0x4e8374===null||_0x4e8374===void 0x0?void 0x0:_0x4e8374[_0x268077(0xd2)])===null||_0x14abd2===void 0x0?void 0x0:_0x14abd2[_0x268077(0xd6)])||_0x4e8374[_0x268077(0xa5)];this[_0x268077(0xad)][_0x268077(0x7f)](_0x268077(0xbe),_0x423ee3),this[_0x268077(0xcc)]=auth_state_enum_1['AuthState']['Error'];throw new invalid_refresh_token_error_1[(_0x268077(0xd8))](errors_1[_0x268077(0xa6)]);}}async[a270_0x4afff4(0xac)](){const _0x46ea2f=a270_0x4afff4;this['logger'][_0x46ea2f(0x83)]('Force\x20update\x20token');if(this[_0x46ea2f(0xcc)]===auth_state_enum_1[_0x46ea2f(0x80)]['Updating']||this[_0x46ea2f(0xcc)]===auth_state_enum_1['AuthState'][_0x46ea2f(0xda)])return await(0x0,utils_1[_0x46ea2f(0x94)])(this[_0x46ea2f(0xb1)]),this['forceUpdateToken']();if(this[_0x46ea2f(0xcc)]===auth_state_enum_1[_0x46ea2f(0x80)]['Error'])throw new invalid_refresh_token_error_1[(_0x46ea2f(0xd8))](errors_1[_0x46ea2f(0xa6)]);await this[_0x46ea2f(0xa8)]();}async[a270_0x4afff4(0xdc)](){const _0x43c508=a270_0x4afff4;if(this[_0x43c508(0xcc)]===auth_state_enum_1[_0x43c508(0x80)][_0x43c508(0xde)]){this[_0x43c508(0xad)][_0x43c508(0x83)](_0x43c508(0x8a));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x43c508(0xcc)]!==auth_state_enum_1[_0x43c508(0x80)][_0x43c508(0xca)])return this[_0x43c508(0xad)][_0x43c508(0x83)](_0x43c508(0xc7)),await(0x0,utils_1[_0x43c508(0x94)])(this[_0x43c508(0xb1)]),this[_0x43c508(0xdc)]();}[a270_0x4afff4(0x9f)](){const _0x503d00=a270_0x4afff4;return{'orgId':this[_0x503d00(0xc8)],'accessToken':this[_0x503d00(0x99)],'instanceUrl':this['instanceUrl']};}async['requestConfig'](_0x36ec57=''){const _0x29e551=a270_0x4afff4;await this['waitAuth']();const _0x31fbea={'baseURL':this[_0x29e551(0xc1)],'headers':{'accept':_0x29e551(0xb5)}};if(salesforce_1[_0x29e551(0xe0)][_0x29e551(0xbd)](_0x36ec57))_0x31fbea[_0x29e551(0xd0)][_0x29e551(0xe1)]=this['accessToken'];else salesforce_1['SalesforceUtils'][_0x29e551(0xb8)](_0x36ec57)?_0x31fbea[_0x29e551(0xd6)]=_0x31fbea['data'][_0x29e551(0x84)](/<met:sessionId>.+?<\/met:sessionId>/,_0x29e551(0xbc)+this['accessToken']+_0x29e551(0xb7)):_0x31fbea[_0x29e551(0xd0)][_0x29e551(0xc4)]=this['tokenType']+'\x20'+this[_0x29e551(0x99)];return _0x31fbea;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a270_0x4afff4(0xaf)])(),__metadata(a270_0x4afff4(0x9a),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;