const a259_0x5f2e6c=a259_0x1ecb;function a259_0x1352(){const _0x3d1b12=['InvalidRefreshTokenError','response','message','Tokens','Service','accessToken','access_token','../../../../constants/errors','constructor','headers','AUTH_WAIT_TIME','then','services/data/','1055089xsMtBQ','__esModule','refresh_token','updateAccessToken','Access\x20token\x20updated\x20for\x20%s','call','token_type','Error','@flosum/salesforce','logger','../../providers/providers.tokens','error','metadata','__metadata','sleep','__createBinding','3738066szfEnY','configurable','../errors/invalid-refresh-token.error','../../../../core','10wooKAV','instance_url','9wTUAXX','Idle','830480pHvEBJ','waitAuth','__importDefault','tokenType','prototype','3730140oHmDNH','getAuthData','writable','length','../enums/auth-state.enum','__importStar','log','name','data','(((.+)+)+)+$','__setModuleDefault','replace','authState','orgId','application/json','joinURL','Logger','requestConfig','toString','ERR_INVALID_SALESFORCE_TOKEN','3632604SnUcik','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','../../../shared/utils','X-SFDC-Session','apply','typedi','function','setAuthDetails','decorate','Check\x20auth:\x20current\x20state\x20-\x20%s','3835070wjtjlh','/services/oauth2/token','authorization','defineProperty','forceUpdateToken','</met:sessionId>','get','AuthState','Force\x20update\x20token','Updating','isBulk1Url','SalesforceUtils','4liXpLe','<met:sessionId>','instanceUrl','Active','../../../../constants','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','default','create','Update\x20access\x20token','getOwnPropertyDescriptor','574241qrUqqS','design:paramtypes','hasOwnProperty','SALESFORCE_API_VERSION'];a259_0x1352=function(){return _0x3d1b12;};return a259_0x1352();}(function(_0x57d7e0,_0x3b7fbe){const _0x47680e=a259_0x1ecb,_0x12dfaf=_0x57d7e0();while(!![]){try{const _0x28bbf9=-parseInt(_0x47680e(0xfb))/0x1*(parseInt(_0x47680e(0x153))/0x2)+parseInt(_0x47680e(0x11c))/0x3+-parseInt(_0x47680e(0x129))/0x4+-parseInt(_0x47680e(0x120))/0x5*(-parseInt(_0x47680e(0x13d))/0x6)+parseInt(_0x47680e(0x10c))/0x7+-parseInt(_0x47680e(0x124))/0x8*(parseInt(_0x47680e(0x122))/0x9)+parseInt(_0x47680e(0x147))/0xa;if(_0x28bbf9===_0x3b7fbe)break;else _0x12dfaf['push'](_0x12dfaf['shift']());}catch(_0x33094f){_0x12dfaf['push'](_0x12dfaf['shift']());}}}(a259_0x1352,0xc4d99));function a259_0x1ecb(_0x374388,_0x192bc3){const _0x9dfbcc=a259_0x1352();return a259_0x1ecb=function(_0x2bd565,_0x47f158){_0x2bd565=_0x2bd565-0xf3;let _0x1352cd=_0x9dfbcc[_0x2bd565];return _0x1352cd;},a259_0x1ecb(_0x374388,_0x192bc3);}const a259_0x47f158=(function(){let _0x3ccc26=!![];return function(_0x2e9544,_0x168a92){const _0x3f4a3f=_0x3ccc26?function(){const _0xb22910=a259_0x1ecb;if(_0x168a92){const _0x36b651=_0x168a92[_0xb22910(0x141)](_0x2e9544,arguments);return _0x168a92=null,_0x36b651;}}:function(){};return _0x3ccc26=![],_0x3f4a3f;};}()),a259_0x2bd565=a259_0x47f158(this,function(){const _0x5a6743=a259_0x1ecb;return a259_0x2bd565[_0x5a6743(0x13b)]()['search'](_0x5a6743(0x132))[_0x5a6743(0x13b)]()[_0x5a6743(0x107)](a259_0x2bd565)['search'](_0x5a6743(0x132));});a259_0x2bd565();'use strict';var __createBinding=this&&this[a259_0x5f2e6c(0x11b)]||(Object[a259_0x5f2e6c(0xf8)]?function(_0x4cc64e,_0x203c0e,_0x38cb43,_0x2b4062){const _0x4ec11c=a259_0x5f2e6c;if(_0x2b4062===undefined)_0x2b4062=_0x38cb43;var _0x4c3342=Object[_0x4ec11c(0xfa)](_0x203c0e,_0x38cb43);(!_0x4c3342||(_0x4ec11c(0x14d)in _0x4c3342?!_0x203c0e['__esModule']:_0x4c3342[_0x4ec11c(0x12b)]||_0x4c3342[_0x4ec11c(0x11d)]))&&(_0x4c3342={'enumerable':!![],'get':function(){return _0x203c0e[_0x38cb43];}}),Object[_0x4ec11c(0x14a)](_0x4cc64e,_0x2b4062,_0x4c3342);}:function(_0x3a8cc8,_0xdc3fe9,_0x519f3b,_0x3e688b){if(_0x3e688b===undefined)_0x3e688b=_0x519f3b;_0x3a8cc8[_0x3e688b]=_0xdc3fe9[_0x519f3b];}),__setModuleDefault=this&&this[a259_0x5f2e6c(0x133)]||(Object['create']?function(_0x31230d,_0x4cc65b){const _0x579473=a259_0x5f2e6c;Object[_0x579473(0x14a)](_0x31230d,_0x579473(0xf7),{'enumerable':!![],'value':_0x4cc65b});}:function(_0x43f348,_0x1f6245){const _0x256eb1=a259_0x5f2e6c;_0x43f348[_0x256eb1(0xf7)]=_0x1f6245;}),__decorate=this&&this['__decorate']||function(_0x528fbb,_0x389b44,_0x38b7f3,_0x342454){const _0x15a392=a259_0x5f2e6c;var _0x22c38e=arguments[_0x15a392(0x12c)],_0x1a1aa2=_0x22c38e<0x3?_0x389b44:_0x342454===null?_0x342454=Object[_0x15a392(0xfa)](_0x389b44,_0x38b7f3):_0x342454,_0xecb5f4;if(typeof Reflect==='object'&&typeof Reflect[_0x15a392(0x145)]==='function')_0x1a1aa2=Reflect[_0x15a392(0x145)](_0x528fbb,_0x389b44,_0x38b7f3,_0x342454);else{for(var _0x1b3fc3=_0x528fbb[_0x15a392(0x12c)]-0x1;_0x1b3fc3>=0x0;_0x1b3fc3--)if(_0xecb5f4=_0x528fbb[_0x1b3fc3])_0x1a1aa2=(_0x22c38e<0x3?_0xecb5f4(_0x1a1aa2):_0x22c38e>0x3?_0xecb5f4(_0x389b44,_0x38b7f3,_0x1a1aa2):_0xecb5f4(_0x389b44,_0x38b7f3))||_0x1a1aa2;}return _0x22c38e>0x3&&_0x1a1aa2&&Object[_0x15a392(0x14a)](_0x389b44,_0x38b7f3,_0x1a1aa2),_0x1a1aa2;},__importStar=this&&this[a259_0x5f2e6c(0x12e)]||function(_0x103836){const _0x41955a=a259_0x5f2e6c;if(_0x103836&&_0x103836[_0x41955a(0x10d)])return _0x103836;var _0x5f3659={};if(_0x103836!=null){for(var _0x34814f in _0x103836)if(_0x34814f!==_0x41955a(0xf7)&&Object[_0x41955a(0x128)][_0x41955a(0xfd)][_0x41955a(0x111)](_0x103836,_0x34814f))__createBinding(_0x5f3659,_0x103836,_0x34814f);}return __setModuleDefault(_0x5f3659,_0x103836),_0x5f3659;},__metadata=this&&this[a259_0x5f2e6c(0x119)]||function(_0x28c91d,_0x5a105f){const _0x5b4d4a=a259_0x5f2e6c;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x5b4d4a(0x143))return Reflect[_0x5b4d4a(0x118)](_0x28c91d,_0x5a105f);},__importDefault=this&&this[a259_0x5f2e6c(0x126)]||function(_0xa5cbb0){const _0x4f3c7e=a259_0x5f2e6c;return _0xa5cbb0&&_0xa5cbb0[_0x4f3c7e(0x10d)]?_0xa5cbb0:{'default':_0xa5cbb0};},SalesforceAuthService_1;Object['defineProperty'](exports,a259_0x5f2e6c(0x10d),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a259_0x5f2e6c(0x142))),errors_1=require(a259_0x5f2e6c(0x106)),core_1=require(a259_0x5f2e6c(0x11f)),axios_1=__importDefault(require('axios')),utils_1=require(a259_0x5f2e6c(0x13f)),invalid_refresh_token_error_1=require(a259_0x5f2e6c(0x11e)),auth_state_enum_1=require(a259_0x5f2e6c(0x12d)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a259_0x5f2e6c(0xf5)),providers_tokens_1=require(a259_0x5f2e6c(0x116)),salesforce_1=require(a259_0x5f2e6c(0x114));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x42aff2=a259_0x5f2e6c;this[_0x42aff2(0x109)]=0x1388,this['authState']=auth_state_enum_1[_0x42aff2(0x14e)][_0x42aff2(0x123)],this[_0x42aff2(0x115)]=new core_1[(_0x42aff2(0x139))](SalesforceAuthService_1[_0x42aff2(0x130)]),this['setAuthDetails']();}async[a259_0x5f2e6c(0x144)](){const _0x30f169=a259_0x5f2e6c;this[_0x30f169(0x115)][_0x30f169(0x12f)](_0x30f169(0x146),auth_state_enum_1['AuthState'][this[_0x30f169(0x135)]]);try{if(this[_0x30f169(0x135)]===auth_state_enum_1[_0x30f169(0x14e)]['Error'])return;if(this['authState']===auth_state_enum_1[_0x30f169(0x14e)][_0x30f169(0x123)])await this[_0x30f169(0x10f)]();else{const _0x5d1437=await this['requestConfig'](),_0x501f49=await axios_1[_0x30f169(0xf7)][_0x30f169(0x14d)](_0x30f169(0x10b)+constants_1[_0x30f169(0xfe)],_0x5d1437)[_0x30f169(0x10a)](()=>!![])['catch'](()=>![]);!_0x501f49&&await this[_0x30f169(0x10f)]();}}catch(_0x434dab){}}async[a259_0x5f2e6c(0x10f)](){const _0x1e8513=a259_0x5f2e6c;var _0xe8b3e6,_0x3e1e04,_0x552d01;this[_0x1e8513(0x115)]['log'](_0x1e8513(0xf9));try{this[_0x1e8513(0x135)]=auth_state_enum_1[_0x1e8513(0x14e)][_0x1e8513(0x150)];const {refreshToken:_0x238ab9,clientId:_0x3a05e7,clientSecret:_0x515e6c,loginUrl:_0x78029b}=typedi_1['default'][_0x1e8513(0x14d)](providers_tokens_1[_0x1e8513(0x102)]['salesforce']),{data:_0x1c3930}=await axios_1['default']['post']((0x0,utils_1[_0x1e8513(0x138)])(_0x78029b,_0x1e8513(0x148)),null,{'params':{'grant_type':_0x1e8513(0x10e),'refresh_token':_0x238ab9,'client_id':_0x3a05e7,'client_secret':_0x515e6c}});this['instanceUrl']=_0x1c3930[_0x1e8513(0x121)],this[_0x1e8513(0x104)]=_0x1c3930[_0x1e8513(0x105)],this[_0x1e8513(0x127)]=_0x1c3930[_0x1e8513(0x112)],this[_0x1e8513(0x135)]=auth_state_enum_1[_0x1e8513(0x14e)][_0x1e8513(0xf4)],this[_0x1e8513(0x115)]['log'](_0x1e8513(0x110),this[_0x1e8513(0xf3)]);}catch(_0x55f235){const _0x34921a=((_0x3e1e04=(_0xe8b3e6=_0x55f235===null||_0x55f235===void 0x0?void 0x0:_0x55f235[_0x1e8513(0x100)])===null||_0xe8b3e6===void 0x0?void 0x0:_0xe8b3e6[_0x1e8513(0x131)])===null||_0x3e1e04===void 0x0?void 0x0:_0x3e1e04[_0x1e8513(0x117)])||((_0x552d01=_0x55f235===null||_0x55f235===void 0x0?void 0x0:_0x55f235[_0x1e8513(0x100)])===null||_0x552d01===void 0x0?void 0x0:_0x552d01['data'])||_0x55f235[_0x1e8513(0x101)];this[_0x1e8513(0x115)][_0x1e8513(0x117)]('Update\x20access\x20token\x20failed:\x20%s',_0x34921a),this[_0x1e8513(0x135)]=auth_state_enum_1['AuthState'][_0x1e8513(0x113)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x1e8513(0x13c)]);}}async[a259_0x5f2e6c(0x14b)](){const _0x15e3e0=a259_0x5f2e6c;this['logger'][_0x15e3e0(0x12f)](_0x15e3e0(0x14f));if(this[_0x15e3e0(0x135)]===auth_state_enum_1[_0x15e3e0(0x14e)]['Updating']||this['authState']===auth_state_enum_1[_0x15e3e0(0x14e)][_0x15e3e0(0x123)])return await(0x0,utils_1[_0x15e3e0(0x11a)])(this[_0x15e3e0(0x109)]),this[_0x15e3e0(0x14b)]();if(this[_0x15e3e0(0x135)]===auth_state_enum_1[_0x15e3e0(0x14e)][_0x15e3e0(0x113)])throw new invalid_refresh_token_error_1[(_0x15e3e0(0xff))](errors_1[_0x15e3e0(0x13c)]);await this[_0x15e3e0(0x10f)]();}async[a259_0x5f2e6c(0x125)](){const _0x5defb5=a259_0x5f2e6c;if(this['authState']===auth_state_enum_1[_0x5defb5(0x14e)]['Error']){this[_0x5defb5(0x115)]['log'](_0x5defb5(0x13e));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x5defb5(0x135)]!==auth_state_enum_1[_0x5defb5(0x14e)]['Active'])return this[_0x5defb5(0x115)][_0x5defb5(0x12f)](_0x5defb5(0xf6)),await(0x0,utils_1[_0x5defb5(0x11a)])(this[_0x5defb5(0x109)]),this['waitAuth']();}[a259_0x5f2e6c(0x12a)](){const _0x32f824=a259_0x5f2e6c;return{'orgId':this[_0x32f824(0x136)],'accessToken':this[_0x32f824(0x104)],'instanceUrl':this['instanceUrl']};}async[a259_0x5f2e6c(0x13a)](_0x475864=''){const _0x4b31e8=a259_0x5f2e6c;await this[_0x4b31e8(0x125)]();const _0x182fde={'baseURL':this['instanceUrl'],'headers':{'accept':_0x4b31e8(0x137)}};if(salesforce_1[_0x4b31e8(0x152)][_0x4b31e8(0x151)](_0x475864))_0x182fde[_0x4b31e8(0x108)][_0x4b31e8(0x140)]=this['accessToken'];else salesforce_1[_0x4b31e8(0x152)]['isSoapUrl'](_0x475864)?_0x182fde[_0x4b31e8(0x131)]=_0x182fde[_0x4b31e8(0x131)][_0x4b31e8(0x134)](/<met:sessionId>.+?<\/met:sessionId>/,_0x4b31e8(0x154)+this[_0x4b31e8(0x104)]+_0x4b31e8(0x14c)):_0x182fde['headers'][_0x4b31e8(0x149)]=this[_0x4b31e8(0x127)]+'\x20'+this[_0x4b31e8(0x104)];return _0x182fde;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a259_0x5f2e6c(0x103)])(),__metadata(a259_0x5f2e6c(0xfc),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;