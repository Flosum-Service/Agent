const a227_0x4142a9=a227_0x2abf;function a227_0x2abf(_0x477dbf,_0x2eac56){const _0x988ae3=a227_0x395e();return a227_0x2abf=function(_0x3da53f,_0x5655c6){_0x3da53f=_0x3da53f-0x162;let _0x395e46=_0x988ae3[_0x3da53f];return _0x395e46;},a227_0x2abf(_0x477dbf,_0x2eac56);}function a227_0x395e(){const _0x54a5e6=['instanceUrl','../enums/auth-state.enum','decorate','call','waitAuth','__createBinding','function','sleep','response','metadata','333736LleaUr','40iZkQPJ','(((.+)+)+)+$','ERR_INVALID_SALESFORCE_TOKEN','log','authState','constructor','/services/oauth2/token','../../../../constants','design:paramtypes','6877000laCQid','default','services/data/','logger','3716531ktKfwy','SalesforceAuthService','configurable','AuthState','715171xzACby','create\x20authorized\x20request\x20failed:\x20authorization\x20error','force\x20update\x20token','1492304dWfPPx','then','post','231738PTVUTJ','getOwnPropertyDescriptor','joinURL','axios','update\x20access\x20token\x20failed:\x20%s','UnauthorizedSalesforceError','AUTH_WAIT_TIME','InvalidRefreshTokenError','Idle','access\x20token\x20updated\x20for\x20%s','__setModuleDefault','__importStar','create','updateAccessToken','orgId','object','salesforce','../../providers/providers.tokens','toString','setAuthDetails','requestConfig','update\x20access\x20token','../../../shared/utils','get','defineProperty','catch','5zQqQuc','Tokens','length','check\x20auth:\x20current\x20state\x20-\x20%s','Service','data','typedi','30Jbbfod','Active','application/json','__esModule','tokenType','Error','accessToken','forceUpdateToken','search','../../../../constants/errors','Updating','377523FcAYAB','error','../errors/unauthorized-salesforce.error'];a227_0x395e=function(){return _0x54a5e6;};return a227_0x395e();}(function(_0x44d017,_0x3b31ac){const _0x8562cf=a227_0x2abf,_0x8ece7=_0x44d017();while(!![]){try{const _0x4b7ccb=-parseInt(_0x8562cf(0x1af))/0x1+-parseInt(_0x8562cf(0x1b2))/0x2+-parseInt(_0x8562cf(0x185))/0x3*(-parseInt(_0x8562cf(0x19d))/0x4)+parseInt(_0x8562cf(0x17e))/0x5*(parseInt(_0x8562cf(0x164))/0x6)+parseInt(_0x8562cf(0x1ab))/0x7+-parseInt(_0x8562cf(0x19e))/0x8*(parseInt(_0x8562cf(0x190))/0x9)+parseInt(_0x8562cf(0x1a7))/0xa;if(_0x4b7ccb===_0x3b31ac)break;else _0x8ece7['push'](_0x8ece7['shift']());}catch(_0x2104f1){_0x8ece7['push'](_0x8ece7['shift']());}}}(a227_0x395e,0x66aba));const a227_0x5655c6=(function(){let _0x43113a=!![];return function(_0x285c04,_0x37d78a){const _0x42ea29=_0x43113a?function(){if(_0x37d78a){const _0x3d7a2f=_0x37d78a['apply'](_0x285c04,arguments);return _0x37d78a=null,_0x3d7a2f;}}:function(){};return _0x43113a=![],_0x42ea29;};}()),a227_0x3da53f=a227_0x5655c6(this,function(){const _0x4c7287=a227_0x2abf;return a227_0x3da53f[_0x4c7287(0x176)]()[_0x4c7287(0x18d)](_0x4c7287(0x19f))[_0x4c7287(0x176)]()[_0x4c7287(0x1a3)](a227_0x3da53f)[_0x4c7287(0x18d)](_0x4c7287(0x19f));});a227_0x3da53f();'use strict';var __createBinding=this&&this[a227_0x4142a9(0x198)]||(Object[a227_0x4142a9(0x170)]?function(_0x56143d,_0x3909f2,_0x509bb9,_0x39495c){const _0x24f1b0=a227_0x4142a9;if(_0x39495c===undefined)_0x39495c=_0x509bb9;var _0x79f219=Object[_0x24f1b0(0x165)](_0x3909f2,_0x509bb9);(!_0x79f219||(_0x24f1b0(0x17b)in _0x79f219?!_0x3909f2[_0x24f1b0(0x188)]:_0x79f219['writable']||_0x79f219[_0x24f1b0(0x1ad)]))&&(_0x79f219={'enumerable':!![],'get':function(){return _0x3909f2[_0x509bb9];}}),Object[_0x24f1b0(0x17c)](_0x56143d,_0x39495c,_0x79f219);}:function(_0x5b51b4,_0x2b7936,_0x1d1446,_0x7d964a){if(_0x7d964a===undefined)_0x7d964a=_0x1d1446;_0x5b51b4[_0x7d964a]=_0x2b7936[_0x1d1446];}),__setModuleDefault=this&&this[a227_0x4142a9(0x16e)]||(Object[a227_0x4142a9(0x170)]?function(_0x26f510,_0x4bab19){const _0x5bd48d=a227_0x4142a9;Object[_0x5bd48d(0x17c)](_0x26f510,_0x5bd48d(0x1a8),{'enumerable':!![],'value':_0x4bab19});}:function(_0x2f928d,_0x34e492){_0x2f928d['default']=_0x34e492;}),__decorate=this&&this['__decorate']||function(_0x296dfd,_0xf58e36,_0x5eb192,_0xce24b3){const _0x49554d=a227_0x4142a9;var _0x5771e5=arguments[_0x49554d(0x180)],_0x87d4ef=_0x5771e5<0x3?_0xf58e36:_0xce24b3===null?_0xce24b3=Object[_0x49554d(0x165)](_0xf58e36,_0x5eb192):_0xce24b3,_0x1e84e4;if(typeof Reflect===_0x49554d(0x173)&&typeof Reflect['decorate']===_0x49554d(0x199))_0x87d4ef=Reflect[_0x49554d(0x195)](_0x296dfd,_0xf58e36,_0x5eb192,_0xce24b3);else{for(var _0x27581a=_0x296dfd[_0x49554d(0x180)]-0x1;_0x27581a>=0x0;_0x27581a--)if(_0x1e84e4=_0x296dfd[_0x27581a])_0x87d4ef=(_0x5771e5<0x3?_0x1e84e4(_0x87d4ef):_0x5771e5>0x3?_0x1e84e4(_0xf58e36,_0x5eb192,_0x87d4ef):_0x1e84e4(_0xf58e36,_0x5eb192))||_0x87d4ef;}return _0x5771e5>0x3&&_0x87d4ef&&Object[_0x49554d(0x17c)](_0xf58e36,_0x5eb192,_0x87d4ef),_0x87d4ef;},__importStar=this&&this[a227_0x4142a9(0x16f)]||function(_0x24b1b3){const _0x454f37=a227_0x4142a9;if(_0x24b1b3&&_0x24b1b3[_0x454f37(0x188)])return _0x24b1b3;var _0x3535e9={};if(_0x24b1b3!=null){for(var _0x450694 in _0x24b1b3)if(_0x450694!==_0x454f37(0x1a8)&&Object['prototype']['hasOwnProperty'][_0x454f37(0x196)](_0x24b1b3,_0x450694))__createBinding(_0x3535e9,_0x24b1b3,_0x450694);}return __setModuleDefault(_0x3535e9,_0x24b1b3),_0x3535e9;},__metadata=this&&this['__metadata']||function(_0x28405d,_0x45d85a){const _0x24076d=a227_0x4142a9;if(typeof Reflect===_0x24076d(0x173)&&typeof Reflect[_0x24076d(0x19c)]===_0x24076d(0x199))return Reflect[_0x24076d(0x19c)](_0x28405d,_0x45d85a);},__importDefault=this&&this['__importDefault']||function(_0x1e2c28){const _0x32bb28=a227_0x4142a9;return _0x1e2c28&&_0x1e2c28[_0x32bb28(0x188)]?_0x1e2c28:{'default':_0x1e2c28};},SalesforceAuthService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a227_0x4142a9(0x1ac)]=void 0x0;const typedi_1=__importStar(require(a227_0x4142a9(0x184))),errors_1=require(a227_0x4142a9(0x18e)),core_1=require('../../../../core'),axios_1=__importDefault(require(a227_0x4142a9(0x167))),utils_1=require(a227_0x4142a9(0x17a)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a227_0x4142a9(0x194)),unauthorized_salesforce_error_1=require(a227_0x4142a9(0x192)),constants_1=require(a227_0x4142a9(0x1a5)),providers_tokens_1=require(a227_0x4142a9(0x175));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x3eb6e1=a227_0x4142a9;this[_0x3eb6e1(0x16a)]=0x1388,this[_0x3eb6e1(0x1a2)]=auth_state_enum_1[_0x3eb6e1(0x1ae)][_0x3eb6e1(0x16c)],this['logger']=new core_1['Logger'](SalesforceAuthService_1['name']),this['setAuthDetails']();}async[a227_0x4142a9(0x177)](){const _0x42067d=a227_0x4142a9;this[_0x42067d(0x1aa)]['log'](_0x42067d(0x181),auth_state_enum_1[_0x42067d(0x1ae)][this[_0x42067d(0x1a2)]]);try{if(this[_0x42067d(0x1a2)]===auth_state_enum_1[_0x42067d(0x1ae)][_0x42067d(0x18a)])return;if(this[_0x42067d(0x1a2)]===auth_state_enum_1[_0x42067d(0x1ae)][_0x42067d(0x16c)])await this[_0x42067d(0x171)]();else{const _0x1fdad9=await this[_0x42067d(0x178)](),_0x13e9fb=await axios_1[_0x42067d(0x1a8)]['get'](_0x42067d(0x1a9)+constants_1['SALESFORCE_API_VERSION'],_0x1fdad9)[_0x42067d(0x162)](()=>!![])[_0x42067d(0x17d)](()=>![]);!_0x13e9fb&&await this['updateAccessToken']();}}catch(_0x2817ec){}}async['updateAccessToken'](){const _0x54a260=a227_0x4142a9;var _0x23c805,_0x31c8bd,_0x3e498b;this[_0x54a260(0x1aa)][_0x54a260(0x1a1)](_0x54a260(0x179));try{this[_0x54a260(0x1a2)]=auth_state_enum_1[_0x54a260(0x1ae)][_0x54a260(0x18f)];const {refreshToken:_0x141d6b,clientId:_0x4660ae,clientSecret:_0x1212ad,loginUrl:_0x2c045f}=typedi_1[_0x54a260(0x1a8)]['get'](providers_tokens_1[_0x54a260(0x17f)][_0x54a260(0x174)]),{data:_0x2d743f}=await axios_1[_0x54a260(0x1a8)][_0x54a260(0x163)]((0x0,utils_1[_0x54a260(0x166)])(_0x2c045f,_0x54a260(0x1a4)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x141d6b,'client_id':_0x4660ae,'client_secret':_0x1212ad}});this[_0x54a260(0x193)]=_0x2d743f['instance_url'],this[_0x54a260(0x18b)]=_0x2d743f['access_token'],this[_0x54a260(0x189)]=_0x2d743f['token_type'],this['authState']=auth_state_enum_1[_0x54a260(0x1ae)][_0x54a260(0x186)],this['logger'][_0x54a260(0x1a1)](_0x54a260(0x16d),this[_0x54a260(0x193)]);}catch(_0x4e0ed4){const _0x334136=((_0x31c8bd=(_0x23c805=_0x4e0ed4===null||_0x4e0ed4===void 0x0?void 0x0:_0x4e0ed4[_0x54a260(0x19b)])===null||_0x23c805===void 0x0?void 0x0:_0x23c805[_0x54a260(0x183)])===null||_0x31c8bd===void 0x0?void 0x0:_0x31c8bd[_0x54a260(0x191)])||((_0x3e498b=_0x4e0ed4===null||_0x4e0ed4===void 0x0?void 0x0:_0x4e0ed4['response'])===null||_0x3e498b===void 0x0?void 0x0:_0x3e498b[_0x54a260(0x183)])||_0x4e0ed4['message'];this[_0x54a260(0x1aa)]['error'](_0x54a260(0x168),_0x334136),this[_0x54a260(0x1a2)]=auth_state_enum_1[_0x54a260(0x1ae)][_0x54a260(0x18a)];throw new invalid_refresh_token_error_1[(_0x54a260(0x16b))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a227_0x4142a9(0x18c)](){const _0x4753bf=a227_0x4142a9;this[_0x4753bf(0x1aa)][_0x4753bf(0x1a1)](_0x4753bf(0x1b1));if(this['authState']===auth_state_enum_1[_0x4753bf(0x1ae)][_0x4753bf(0x18f)]||this[_0x4753bf(0x1a2)]===auth_state_enum_1[_0x4753bf(0x1ae)]['Idle'])return await(0x0,utils_1[_0x4753bf(0x19a)])(this[_0x4753bf(0x16a)]),this[_0x4753bf(0x18c)]();if(this[_0x4753bf(0x1a2)]===auth_state_enum_1[_0x4753bf(0x1ae)]['Error'])throw new invalid_refresh_token_error_1[(_0x4753bf(0x16b))](errors_1[_0x4753bf(0x1a0)]);await this['updateAccessToken']();}async[a227_0x4142a9(0x197)](){const _0x339e64=a227_0x4142a9;if(this[_0x339e64(0x1a2)]===auth_state_enum_1[_0x339e64(0x1ae)][_0x339e64(0x18a)]){this[_0x339e64(0x1aa)]['log'](_0x339e64(0x1b0));throw new unauthorized_salesforce_error_1[(_0x339e64(0x169))]();}if(this[_0x339e64(0x1a2)]!==auth_state_enum_1[_0x339e64(0x1ae)][_0x339e64(0x186)])return this[_0x339e64(0x1aa)][_0x339e64(0x1a1)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x339e64(0x19a)])(this[_0x339e64(0x16a)]),this['waitAuth']();}['getAuthData'](){const _0x3bff66=a227_0x4142a9;return{'orgId':this[_0x3bff66(0x172)],'accessToken':this[_0x3bff66(0x18b)],'instanceUrl':this[_0x3bff66(0x193)]};}async[a227_0x4142a9(0x178)](){const _0x582a7c=a227_0x4142a9;return await this[_0x582a7c(0x197)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x582a7c(0x187),'authorization':this[_0x582a7c(0x189)]+'\x20'+this[_0x582a7c(0x18b)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a227_0x4142a9(0x182)])(),__metadata(a227_0x4142a9(0x1a6),[])],SalesforceAuthService),exports[a227_0x4142a9(0x1ac)]=SalesforceAuthService;