const a232_0x580fdb=a232_0x1f97;(function(_0x3668ab,_0xe600b7){const _0x50923b=a232_0x1f97,_0x112a68=_0x3668ab();while(!![]){try{const _0x163e11=parseInt(_0x50923b(0x19f))/0x1*(-parseInt(_0x50923b(0x1d4))/0x2)+parseInt(_0x50923b(0x1cf))/0x3*(parseInt(_0x50923b(0x1b3))/0x4)+parseInt(_0x50923b(0x18f))/0x5+parseInt(_0x50923b(0x1b2))/0x6+-parseInt(_0x50923b(0x18c))/0x7*(-parseInt(_0x50923b(0x1ac))/0x8)+-parseInt(_0x50923b(0x1af))/0x9*(parseInt(_0x50923b(0x1c1))/0xa)+-parseInt(_0x50923b(0x1a8))/0xb;if(_0x163e11===_0xe600b7)break;else _0x112a68['push'](_0x112a68['shift']());}catch(_0x25858f){_0x112a68['push'](_0x112a68['shift']());}}}(a232_0x12dd,0x70b59));const a232_0x2b79ef=(function(){let _0x176f1e=!![];return function(_0x5dd4b8,_0x4df056){const _0x38fb06=_0x176f1e?function(){const _0x470b00=a232_0x1f97;if(_0x4df056){const _0x1ca930=_0x4df056[_0x470b00(0x1de)](_0x5dd4b8,arguments);return _0x4df056=null,_0x1ca930;}}:function(){};return _0x176f1e=![],_0x38fb06;};}()),a232_0x433987=a232_0x2b79ef(this,function(){const _0x31f86d=a232_0x1f97;return a232_0x433987[_0x31f86d(0x197)]()[_0x31f86d(0x1c2)](_0x31f86d(0x1c9))[_0x31f86d(0x197)]()['constructor'](a232_0x433987)[_0x31f86d(0x1c2)]('(((.+)+)+)+$');});a232_0x433987();'use strict';function a232_0x1f97(_0x3d082c,_0xf7f8c9){const _0x226b90=a232_0x12dd();return a232_0x1f97=function(_0x433987,_0x2b79ef){_0x433987=_0x433987-0x188;let _0x12dd1c=_0x226b90[_0x433987];return _0x12dd1c;},a232_0x1f97(_0x3d082c,_0xf7f8c9);}var __createBinding=this&&this[a232_0x580fdb(0x194)]||(Object['create']?function(_0x48be62,_0x38e103,_0x24c673,_0x28820b){const _0x467a37=a232_0x580fdb;if(_0x28820b===undefined)_0x28820b=_0x24c673;var _0x4db3f1=Object[_0x467a37(0x1b6)](_0x38e103,_0x24c673);(!_0x4db3f1||(_0x467a37(0x199)in _0x4db3f1?!_0x38e103[_0x467a37(0x1c6)]:_0x4db3f1[_0x467a37(0x19b)]||_0x4db3f1[_0x467a37(0x1a1)]))&&(_0x4db3f1={'enumerable':!![],'get':function(){return _0x38e103[_0x24c673];}}),Object[_0x467a37(0x1dd)](_0x48be62,_0x28820b,_0x4db3f1);}:function(_0x1114c7,_0x44b7f4,_0x269896,_0x37411b){if(_0x37411b===undefined)_0x37411b=_0x269896;_0x1114c7[_0x37411b]=_0x44b7f4[_0x269896];}),__setModuleDefault=this&&this[a232_0x580fdb(0x1cc)]||(Object['create']?function(_0x33105b,_0x29d470){const _0x8443db=a232_0x580fdb;Object[_0x8443db(0x1dd)](_0x33105b,_0x8443db(0x191),{'enumerable':!![],'value':_0x29d470});}:function(_0x304e24,_0x59b5e3){const _0x1dcad0=a232_0x580fdb;_0x304e24[_0x1dcad0(0x191)]=_0x59b5e3;}),__decorate=this&&this['__decorate']||function(_0x40325c,_0x35d5db,_0x239cd9,_0x564045){const _0x5a3bce=a232_0x580fdb;var _0x1fd5a8=arguments[_0x5a3bce(0x1a9)],_0x433b96=_0x1fd5a8<0x3?_0x35d5db:_0x564045===null?_0x564045=Object[_0x5a3bce(0x1b6)](_0x35d5db,_0x239cd9):_0x564045,_0x220f5d;if(typeof Reflect===_0x5a3bce(0x1d1)&&typeof Reflect['decorate']===_0x5a3bce(0x1a2))_0x433b96=Reflect[_0x5a3bce(0x1a0)](_0x40325c,_0x35d5db,_0x239cd9,_0x564045);else{for(var _0x22af9e=_0x40325c[_0x5a3bce(0x1a9)]-0x1;_0x22af9e>=0x0;_0x22af9e--)if(_0x220f5d=_0x40325c[_0x22af9e])_0x433b96=(_0x1fd5a8<0x3?_0x220f5d(_0x433b96):_0x1fd5a8>0x3?_0x220f5d(_0x35d5db,_0x239cd9,_0x433b96):_0x220f5d(_0x35d5db,_0x239cd9))||_0x433b96;}return _0x1fd5a8>0x3&&_0x433b96&&Object[_0x5a3bce(0x1dd)](_0x35d5db,_0x239cd9,_0x433b96),_0x433b96;},__importStar=this&&this[a232_0x580fdb(0x1a7)]||function(_0x2b9438){const _0x49a8cb=a232_0x580fdb;if(_0x2b9438&&_0x2b9438[_0x49a8cb(0x1c6)])return _0x2b9438;var _0x2304b0={};if(_0x2b9438!=null){for(var _0x35c5be in _0x2b9438)if(_0x35c5be!==_0x49a8cb(0x191)&&Object[_0x49a8cb(0x19e)][_0x49a8cb(0x19d)][_0x49a8cb(0x192)](_0x2b9438,_0x35c5be))__createBinding(_0x2304b0,_0x2b9438,_0x35c5be);}return __setModuleDefault(_0x2304b0,_0x2b9438),_0x2304b0;},__metadata=this&&this[a232_0x580fdb(0x1b4)]||function(_0xd39430,_0x55a8fc){const _0x2cff55=a232_0x580fdb;if(typeof Reflect===_0x2cff55(0x1d1)&&typeof Reflect[_0x2cff55(0x198)]===_0x2cff55(0x1a2))return Reflect['metadata'](_0xd39430,_0x55a8fc);},__importDefault=this&&this[a232_0x580fdb(0x1ce)]||function(_0x208f5d){const _0x33d0b0=a232_0x580fdb;return _0x208f5d&&_0x208f5d[_0x33d0b0(0x1c6)]?_0x208f5d:{'default':_0x208f5d};},SalesforceAuthService_1;function a232_0x12dd(){const _0xdc6641=['waitAuth','8ntiKRM','Idle','../errors/unauthorized-salesforce.error','1236717nFHtaX','Tokens','AUTH_WAIT_TIME','3482928kEXZYc','24taCJHP','__metadata','typedi','getOwnPropertyDescriptor','catch','services/data/','../errors/invalid-refresh-token.error','log','axios','then','post','updateAccessToken','../../../../constants/errors','joinURL','50BQhBBL','search','../../../shared/utils','instance_url','design:paramtypes','__esModule','../enums/auth-state.enum','setAuthDetails','(((.+)+)+)+$','forceUpdateToken','message','__setModuleDefault','application/json','__importDefault','333006XGSIqF','error','object','AuthState','InvalidRefreshTokenError','192106qIMiXu','SalesforceAuthService','Error','/services/oauth2/token','Logger','orgId','data','sleep','tokenType','defineProperty','apply','force\x20update\x20token','update\x20access\x20token','Active','create\x20authorized\x20request\x20failed:\x20authorization\x20error','1696177KPyfIg','refresh_token','Service','805575OqHSfm','logger','default','call','access\x20token\x20updated\x20for\x20%s','__createBinding','ERR_INVALID_SALESFORCE_TOKEN','requestConfig','toString','metadata','get','accessToken','writable','getAuthData','hasOwnProperty','prototype','4DZWeDQ','decorate','configurable','function','name','authState','instanceUrl','response','__importStar','1286912DYrpUQ','length','token_type'];a232_0x12dd=function(){return _0xdc6641;};return a232_0x12dd();}Object[a232_0x580fdb(0x1dd)](exports,a232_0x580fdb(0x1c6),{'value':!![]}),exports[a232_0x580fdb(0x1d5)]=void 0x0;const typedi_1=__importStar(require(a232_0x580fdb(0x1b5))),errors_1=require(a232_0x580fdb(0x1bf)),core_1=require('../../../../core'),axios_1=__importDefault(require(a232_0x580fdb(0x1bb))),utils_1=require(a232_0x580fdb(0x1c3)),invalid_refresh_token_error_1=require(a232_0x580fdb(0x1b9)),auth_state_enum_1=require(a232_0x580fdb(0x1c7)),unauthorized_salesforce_error_1=require(a232_0x580fdb(0x1ae)),constants_1=require('../../../../constants'),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x529a4b=a232_0x580fdb;this[_0x529a4b(0x1b1)]=0x1388,this[_0x529a4b(0x1a4)]=auth_state_enum_1[_0x529a4b(0x1d2)][_0x529a4b(0x1ad)],this[_0x529a4b(0x190)]=new core_1[(_0x529a4b(0x1d8))](SalesforceAuthService_1[_0x529a4b(0x1a3)]),this[_0x529a4b(0x1c8)]();}async['setAuthDetails'](){const _0x4e1fdc=a232_0x580fdb;this[_0x4e1fdc(0x190)][_0x4e1fdc(0x1ba)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x4e1fdc(0x1d2)][this['authState']]);try{if(this['authState']===auth_state_enum_1[_0x4e1fdc(0x1d2)][_0x4e1fdc(0x1d6)])return;if(this[_0x4e1fdc(0x1a4)]===auth_state_enum_1['AuthState'][_0x4e1fdc(0x1ad)])await this['updateAccessToken']();else{const _0x29ad4b=await this[_0x4e1fdc(0x196)](),_0x33bca9=await axios_1[_0x4e1fdc(0x191)]['get'](_0x4e1fdc(0x1b8)+constants_1['SALESFORCE_API_VERSION'],_0x29ad4b)[_0x4e1fdc(0x1bc)](()=>!![])[_0x4e1fdc(0x1b7)](()=>![]);!_0x33bca9&&await this[_0x4e1fdc(0x1be)]();}}catch(_0x5100f7){}}async[a232_0x580fdb(0x1be)](){const _0x1d24ef=a232_0x580fdb;var _0x25f644,_0xdcb0b5,_0x54fad3;this[_0x1d24ef(0x190)][_0x1d24ef(0x1ba)](_0x1d24ef(0x189));try{this[_0x1d24ef(0x1a4)]=auth_state_enum_1[_0x1d24ef(0x1d2)]['Updating'];const {refreshToken:_0x1a3021,clientId:_0x5486bc,clientSecret:_0x30ff6b,loginUrl:_0x564f4e}=typedi_1[_0x1d24ef(0x191)]['get'](providers_tokens_1[_0x1d24ef(0x1b0)]['salesforce']),{data:_0x52d941}=await axios_1['default'][_0x1d24ef(0x1bd)]((0x0,utils_1[_0x1d24ef(0x1c0)])(_0x564f4e,_0x1d24ef(0x1d7)),null,{'params':{'grant_type':_0x1d24ef(0x18d),'refresh_token':_0x1a3021,'client_id':_0x5486bc,'client_secret':_0x30ff6b}});this[_0x1d24ef(0x1a5)]=_0x52d941[_0x1d24ef(0x1c4)],this[_0x1d24ef(0x19a)]=_0x52d941['access_token'],this[_0x1d24ef(0x1dc)]=_0x52d941[_0x1d24ef(0x1aa)],this[_0x1d24ef(0x1a4)]=auth_state_enum_1[_0x1d24ef(0x1d2)][_0x1d24ef(0x18a)],this[_0x1d24ef(0x190)]['log'](_0x1d24ef(0x193),this[_0x1d24ef(0x1a5)]);}catch(_0x299012){const _0x8947a1=((_0xdcb0b5=(_0x25f644=_0x299012===null||_0x299012===void 0x0?void 0x0:_0x299012[_0x1d24ef(0x1a6)])===null||_0x25f644===void 0x0?void 0x0:_0x25f644['data'])===null||_0xdcb0b5===void 0x0?void 0x0:_0xdcb0b5[_0x1d24ef(0x1d0)])||((_0x54fad3=_0x299012===null||_0x299012===void 0x0?void 0x0:_0x299012[_0x1d24ef(0x1a6)])===null||_0x54fad3===void 0x0?void 0x0:_0x54fad3[_0x1d24ef(0x1da)])||_0x299012[_0x1d24ef(0x1cb)];this['logger'][_0x1d24ef(0x1d0)]('update\x20access\x20token\x20failed:\x20%s',_0x8947a1),this[_0x1d24ef(0x1a4)]=auth_state_enum_1[_0x1d24ef(0x1d2)][_0x1d24ef(0x1d6)];throw new invalid_refresh_token_error_1[(_0x1d24ef(0x1d3))](errors_1[_0x1d24ef(0x195)]);}}async[a232_0x580fdb(0x1ca)](){const _0x163a95=a232_0x580fdb;this[_0x163a95(0x190)][_0x163a95(0x1ba)](_0x163a95(0x188));if(this[_0x163a95(0x1a4)]===auth_state_enum_1[_0x163a95(0x1d2)]['Updating']||this[_0x163a95(0x1a4)]===auth_state_enum_1[_0x163a95(0x1d2)][_0x163a95(0x1ad)])return await(0x0,utils_1[_0x163a95(0x1db)])(this[_0x163a95(0x1b1)]),this[_0x163a95(0x1ca)]();if(this[_0x163a95(0x1a4)]===auth_state_enum_1[_0x163a95(0x1d2)][_0x163a95(0x1d6)])throw new invalid_refresh_token_error_1[(_0x163a95(0x1d3))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x163a95(0x1be)]();}async[a232_0x580fdb(0x1ab)](){const _0x575139=a232_0x580fdb;if(this[_0x575139(0x1a4)]===auth_state_enum_1[_0x575139(0x1d2)][_0x575139(0x1d6)]){this['logger']['log'](_0x575139(0x18b));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x575139(0x1a4)]!==auth_state_enum_1['AuthState'][_0x575139(0x18a)])return this[_0x575139(0x190)][_0x575139(0x1ba)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x575139(0x1db)])(this['AUTH_WAIT_TIME']),this[_0x575139(0x1ab)]();}[a232_0x580fdb(0x19c)](){const _0x37a6b5=a232_0x580fdb;return{'orgId':this[_0x37a6b5(0x1d9)],'accessToken':this['accessToken'],'instanceUrl':this[_0x37a6b5(0x1a5)]};}async[a232_0x580fdb(0x196)](){const _0x522d2f=a232_0x580fdb;return await this[_0x522d2f(0x1ab)](),{'baseURL':this[_0x522d2f(0x1a5)],'headers':{'accept':_0x522d2f(0x1cd),'authorization':this['tokenType']+'\x20'+this[_0x522d2f(0x19a)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a232_0x580fdb(0x18e)])(),__metadata(a232_0x580fdb(0x1c5),[])],SalesforceAuthService),exports[a232_0x580fdb(0x1d5)]=SalesforceAuthService;