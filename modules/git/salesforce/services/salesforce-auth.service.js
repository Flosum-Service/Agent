function a226_0x3472(_0x181e04,_0x4596d6){const _0x5354a3=a226_0x4c39();return a226_0x3472=function(_0x152e6b,_0x44e26c){_0x152e6b=_0x152e6b-0xd2;let _0x4c39db=_0x5354a3[_0x152e6b];return _0x4c39db;},a226_0x3472(_0x181e04,_0x4596d6);}const a226_0x2e5ec2=a226_0x3472;(function(_0x4b9953,_0x35c05e){const _0x7a0ff=a226_0x3472,_0x4fb326=_0x4b9953();while(!![]){try{const _0x5321f1=parseInt(_0x7a0ff(0x127))/0x1+parseInt(_0x7a0ff(0xd3))/0x2*(parseInt(_0x7a0ff(0xfc))/0x3)+-parseInt(_0x7a0ff(0xfe))/0x4*(parseInt(_0x7a0ff(0xde))/0x5)+parseInt(_0x7a0ff(0xf0))/0x6*(-parseInt(_0x7a0ff(0xf6))/0x7)+-parseInt(_0x7a0ff(0xe6))/0x8*(-parseInt(_0x7a0ff(0x128))/0x9)+parseInt(_0x7a0ff(0x109))/0xa+-parseInt(_0x7a0ff(0x104))/0xb*(parseInt(_0x7a0ff(0x102))/0xc);if(_0x5321f1===_0x35c05e)break;else _0x4fb326['push'](_0x4fb326['shift']());}catch(_0x51aef8){_0x4fb326['push'](_0x4fb326['shift']());}}}(a226_0x4c39,0xb97a6));const a226_0x44e26c=(function(){let _0x1f50dd=!![];return function(_0x57de8a,_0x5c9b9b){const _0x12aff5=_0x1f50dd?function(){const _0x1cf46d=a226_0x3472;if(_0x5c9b9b){const _0x1d38e1=_0x5c9b9b[_0x1cf46d(0x118)](_0x57de8a,arguments);return _0x5c9b9b=null,_0x1d38e1;}}:function(){};return _0x1f50dd=![],_0x12aff5;};}()),a226_0x152e6b=a226_0x44e26c(this,function(){const _0x1f6323=a226_0x3472;return a226_0x152e6b['toString']()['search'](_0x1f6323(0xf2))[_0x1f6323(0x108)]()[_0x1f6323(0xe9)](a226_0x152e6b)[_0x1f6323(0xfd)](_0x1f6323(0xf2));});function a226_0x4c39(){const _0x244e64=['sleep','101339UcaIIN','requestConfig','joinURL','waitAuth','authState','data','1113imbvBG','search','3280OaujNU','__decorate','../../../../constants','logger','156PUDMgs','force\x20update\x20token','705837jPOHnt','SalesforceAuthService','writable','create\x20authorized\x20request\x20failed:\x20authorization\x20error','toString','6262610PvqkZX','Active','Updating','__metadata','__setModuleDefault','../../../../core','default','InvalidRefreshTokenError','SALESFORCE_API_VERSION','refresh_token','tokenType','access_token','Error','updateAccessToken','defineProperty','apply','orgId','instanceUrl','../../providers/providers.tokens','Idle','create','__importStar','call','__importDefault','then','Service','Tokens','getOwnPropertyDescriptor','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','getAuthData','1126753bDtClR','27ztopBl','../../../../constants/errors','3026oBKUbP','decorate','forceUpdateToken','Logger','access\x20token\x20updated\x20for\x20%s','__esModule','setAuthDetails','length','log','../../../shared/utils','typedi','1775xiHmHy','response','prototype','token_type','catch','accessToken','post','UnauthorizedSalesforceError','708128YsfWzC','update\x20access\x20token','get','constructor','metadata','__createBinding','message','object','AUTH_WAIT_TIME','salesforce','288grknlN','design:paramtypes','(((.+)+)+)+$','AuthState','../enums/auth-state.enum'];a226_0x4c39=function(){return _0x244e64;};return a226_0x4c39();}a226_0x152e6b();'use strict';var __createBinding=this&&this[a226_0x2e5ec2(0xeb)]||(Object[a226_0x2e5ec2(0x11d)]?function(_0x1c1b74,_0x9ecdfe,_0x47434e,_0x2643e2){const _0x39b8f6=a226_0x2e5ec2;if(_0x2643e2===undefined)_0x2643e2=_0x47434e;var _0x42b927=Object[_0x39b8f6(0x124)](_0x9ecdfe,_0x47434e);(!_0x42b927||(_0x39b8f6(0xe8)in _0x42b927?!_0x9ecdfe[_0x39b8f6(0xd8)]:_0x42b927[_0x39b8f6(0x106)]||_0x42b927['configurable']))&&(_0x42b927={'enumerable':!![],'get':function(){return _0x9ecdfe[_0x47434e];}}),Object['defineProperty'](_0x1c1b74,_0x2643e2,_0x42b927);}:function(_0x273c55,_0x4db6eb,_0x74829c,_0x1f4f58){if(_0x1f4f58===undefined)_0x1f4f58=_0x74829c;_0x273c55[_0x1f4f58]=_0x4db6eb[_0x74829c];}),__setModuleDefault=this&&this[a226_0x2e5ec2(0x10d)]||(Object[a226_0x2e5ec2(0x11d)]?function(_0xc56c82,_0x314e64){const _0x58bcd8=a226_0x2e5ec2;Object[_0x58bcd8(0x117)](_0xc56c82,_0x58bcd8(0x10f),{'enumerable':!![],'value':_0x314e64});}:function(_0x44db83,_0x471b95){const _0x38402a=a226_0x2e5ec2;_0x44db83[_0x38402a(0x10f)]=_0x471b95;}),__decorate=this&&this[a226_0x2e5ec2(0xff)]||function(_0x26aa7c,_0x24afb5,_0x3c08d4,_0x1451b8){const _0x3d2143=a226_0x2e5ec2;var _0x31e02d=arguments[_0x3d2143(0xda)],_0x178e27=_0x31e02d<0x3?_0x24afb5:_0x1451b8===null?_0x1451b8=Object['getOwnPropertyDescriptor'](_0x24afb5,_0x3c08d4):_0x1451b8,_0x9434e6;if(typeof Reflect===_0x3d2143(0xed)&&typeof Reflect[_0x3d2143(0xd4)]==='function')_0x178e27=Reflect['decorate'](_0x26aa7c,_0x24afb5,_0x3c08d4,_0x1451b8);else{for(var _0x4e4e2e=_0x26aa7c['length']-0x1;_0x4e4e2e>=0x0;_0x4e4e2e--)if(_0x9434e6=_0x26aa7c[_0x4e4e2e])_0x178e27=(_0x31e02d<0x3?_0x9434e6(_0x178e27):_0x31e02d>0x3?_0x9434e6(_0x24afb5,_0x3c08d4,_0x178e27):_0x9434e6(_0x24afb5,_0x3c08d4))||_0x178e27;}return _0x31e02d>0x3&&_0x178e27&&Object[_0x3d2143(0x117)](_0x24afb5,_0x3c08d4,_0x178e27),_0x178e27;},__importStar=this&&this[a226_0x2e5ec2(0x11e)]||function(_0x4aa70b){const _0x16f264=a226_0x2e5ec2;if(_0x4aa70b&&_0x4aa70b[_0x16f264(0xd8)])return _0x4aa70b;var _0x161ee7={};if(_0x4aa70b!=null){for(var _0x49409a in _0x4aa70b)if(_0x49409a!==_0x16f264(0x10f)&&Object[_0x16f264(0xe0)]['hasOwnProperty'][_0x16f264(0x11f)](_0x4aa70b,_0x49409a))__createBinding(_0x161ee7,_0x4aa70b,_0x49409a);}return __setModuleDefault(_0x161ee7,_0x4aa70b),_0x161ee7;},__metadata=this&&this[a226_0x2e5ec2(0x10c)]||function(_0xa9efc5,_0x120b13){const _0x31b8d4=a226_0x2e5ec2;if(typeof Reflect===_0x31b8d4(0xed)&&typeof Reflect['metadata']==='function')return Reflect[_0x31b8d4(0xea)](_0xa9efc5,_0x120b13);},__importDefault=this&&this[a226_0x2e5ec2(0x120)]||function(_0x39de6f){return _0x39de6f&&_0x39de6f['__esModule']?_0x39de6f:{'default':_0x39de6f};},SalesforceAuthService_1;Object['defineProperty'](exports,a226_0x2e5ec2(0xd8),{'value':!![]}),exports[a226_0x2e5ec2(0x105)]=void 0x0;const typedi_1=__importStar(require(a226_0x2e5ec2(0xdd))),errors_1=require(a226_0x2e5ec2(0xd2)),core_1=require(a226_0x2e5ec2(0x10e)),axios_1=__importDefault(require('axios')),utils_1=require(a226_0x2e5ec2(0xdc)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a226_0x2e5ec2(0xf4)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a226_0x2e5ec2(0x100)),providers_tokens_1=require(a226_0x2e5ec2(0x11b));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x2b524d=a226_0x2e5ec2;this[_0x2b524d(0xee)]=0x1388,this['authState']=auth_state_enum_1[_0x2b524d(0xf3)][_0x2b524d(0x11c)],this['logger']=new core_1[(_0x2b524d(0xd6))](SalesforceAuthService_1['name']),this[_0x2b524d(0xd9)]();}async[a226_0x2e5ec2(0xd9)](){const _0x1619ac=a226_0x2e5ec2;this[_0x1619ac(0x101)]['log']('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x1619ac(0xf3)][this[_0x1619ac(0xfa)]]);try{if(this[_0x1619ac(0xfa)]===auth_state_enum_1[_0x1619ac(0xf3)][_0x1619ac(0x115)])return;if(this[_0x1619ac(0xfa)]===auth_state_enum_1['AuthState']['Idle'])await this['updateAccessToken']();else{const _0x46967d=await this[_0x1619ac(0xf7)](),_0xea9d3b=await axios_1[_0x1619ac(0x10f)][_0x1619ac(0xe8)]('services/data/'+constants_1[_0x1619ac(0x111)],_0x46967d)[_0x1619ac(0x121)](()=>!![])[_0x1619ac(0xe2)](()=>![]);!_0xea9d3b&&await this[_0x1619ac(0x116)]();}}catch(_0x1cda14){}}async[a226_0x2e5ec2(0x116)](){const _0x1ff2b9=a226_0x2e5ec2;var _0x4593fd,_0x1b0d85,_0x2722a7;this[_0x1ff2b9(0x101)]['log'](_0x1ff2b9(0xe7));try{this[_0x1ff2b9(0xfa)]=auth_state_enum_1['AuthState'][_0x1ff2b9(0x10b)];const {refreshToken:_0x38a85,clientId:_0x10fec6,clientSecret:_0x57be81,loginUrl:_0x11ab86}=typedi_1[_0x1ff2b9(0x10f)][_0x1ff2b9(0xe8)](providers_tokens_1[_0x1ff2b9(0x123)][_0x1ff2b9(0xef)]),{data:_0x178f88}=await axios_1[_0x1ff2b9(0x10f)][_0x1ff2b9(0xe4)]((0x0,utils_1[_0x1ff2b9(0xf8)])(_0x11ab86,'/services/oauth2/token'),null,{'params':{'grant_type':_0x1ff2b9(0x112),'refresh_token':_0x38a85,'client_id':_0x10fec6,'client_secret':_0x57be81}});this[_0x1ff2b9(0x11a)]=_0x178f88['instance_url'],this['accessToken']=_0x178f88[_0x1ff2b9(0x114)],this[_0x1ff2b9(0x113)]=_0x178f88[_0x1ff2b9(0xe1)],this[_0x1ff2b9(0xfa)]=auth_state_enum_1[_0x1ff2b9(0xf3)][_0x1ff2b9(0x10a)],this[_0x1ff2b9(0x101)]['log'](_0x1ff2b9(0xd7),this['instanceUrl']);}catch(_0x2df778){const _0x56bbcd=((_0x1b0d85=(_0x4593fd=_0x2df778===null||_0x2df778===void 0x0?void 0x0:_0x2df778['response'])===null||_0x4593fd===void 0x0?void 0x0:_0x4593fd['data'])===null||_0x1b0d85===void 0x0?void 0x0:_0x1b0d85['error'])||((_0x2722a7=_0x2df778===null||_0x2df778===void 0x0?void 0x0:_0x2df778[_0x1ff2b9(0xdf)])===null||_0x2722a7===void 0x0?void 0x0:_0x2722a7[_0x1ff2b9(0xfb)])||_0x2df778[_0x1ff2b9(0xec)];this[_0x1ff2b9(0x101)]['error']('update\x20access\x20token\x20failed:\x20%s',_0x56bbcd),this[_0x1ff2b9(0xfa)]=auth_state_enum_1['AuthState'][_0x1ff2b9(0x115)];throw new invalid_refresh_token_error_1[(_0x1ff2b9(0x110))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a226_0x2e5ec2(0xd5)](){const _0x1681b8=a226_0x2e5ec2;this['logger'][_0x1681b8(0xdb)](_0x1681b8(0x103));if(this[_0x1681b8(0xfa)]===auth_state_enum_1['AuthState'][_0x1681b8(0x10b)]||this[_0x1681b8(0xfa)]===auth_state_enum_1[_0x1681b8(0xf3)][_0x1681b8(0x11c)])return await(0x0,utils_1[_0x1681b8(0xf5)])(this[_0x1681b8(0xee)]),this[_0x1681b8(0xd5)]();if(this[_0x1681b8(0xfa)]===auth_state_enum_1[_0x1681b8(0xf3)]['Error'])throw new invalid_refresh_token_error_1[(_0x1681b8(0x110))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x1681b8(0x116)]();}async[a226_0x2e5ec2(0xf9)](){const _0x239f16=a226_0x2e5ec2;if(this['authState']===auth_state_enum_1[_0x239f16(0xf3)]['Error']){this[_0x239f16(0x101)][_0x239f16(0xdb)](_0x239f16(0x107));throw new unauthorized_salesforce_error_1[(_0x239f16(0xe5))]();}if(this[_0x239f16(0xfa)]!==auth_state_enum_1[_0x239f16(0xf3)][_0x239f16(0x10a)])return this[_0x239f16(0x101)]['log'](_0x239f16(0x125)),await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this[_0x239f16(0xf9)]();}[a226_0x2e5ec2(0x126)](){const _0x373df9=a226_0x2e5ec2;return{'orgId':this[_0x373df9(0x119)],'accessToken':this[_0x373df9(0xe3)],'instanceUrl':this['instanceUrl']};}async['requestConfig'](){const _0x4c5ce2=a226_0x2e5ec2;return await this['waitAuth'](),{'baseURL':this[_0x4c5ce2(0x11a)],'headers':{'accept':'application/json','authorization':this['tokenType']+'\x20'+this[_0x4c5ce2(0xe3)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a226_0x2e5ec2(0x122)])(),__metadata(a226_0x2e5ec2(0xf1),[])],SalesforceAuthService),exports[a226_0x2e5ec2(0x105)]=SalesforceAuthService;