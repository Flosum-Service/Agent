const a227_0x3139e1=a227_0xa9b8;(function(_0x10f35e,_0x32323a){const _0x3212da=a227_0xa9b8,_0x3fbd4c=_0x10f35e();while(!![]){try{const _0x1cb851=-parseInt(_0x3212da(0x17c))/0x1*(-parseInt(_0x3212da(0x145))/0x2)+parseInt(_0x3212da(0x166))/0x3*(-parseInt(_0x3212da(0x149))/0x4)+parseInt(_0x3212da(0x174))/0x5+-parseInt(_0x3212da(0x169))/0x6*(-parseInt(_0x3212da(0x161))/0x7)+parseInt(_0x3212da(0x175))/0x8*(parseInt(_0x3212da(0x13f))/0x9)+-parseInt(_0x3212da(0x143))/0xa+-parseInt(_0x3212da(0x170))/0xb*(parseInt(_0x3212da(0x131))/0xc);if(_0x1cb851===_0x32323a)break;else _0x3fbd4c['push'](_0x3fbd4c['shift']());}catch(_0x24b806){_0x3fbd4c['push'](_0x3fbd4c['shift']());}}}(a227_0x18a2,0x4a95a));const a227_0xe72e38=(function(){let _0x51eedd=!![];return function(_0x145a1f,_0x2a0023){const _0x4ab2b5=_0x51eedd?function(){if(_0x2a0023){const _0x309b59=_0x2a0023['apply'](_0x145a1f,arguments);return _0x2a0023=null,_0x309b59;}}:function(){};return _0x51eedd=![],_0x4ab2b5;};}()),a227_0x93652d=a227_0xe72e38(this,function(){const _0x413794=a227_0xa9b8;return a227_0x93652d[_0x413794(0x15c)]()[_0x413794(0x151)](_0x413794(0x14e))[_0x413794(0x15c)]()[_0x413794(0x12f)](a227_0x93652d)[_0x413794(0x151)](_0x413794(0x14e));});a227_0x93652d();'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x2bca2b,_0x5289c9,_0x3b143a,_0x46b371){const _0x4adb09=a227_0xa9b8;if(_0x46b371===undefined)_0x46b371=_0x3b143a;var _0x3fd096=Object[_0x4adb09(0x173)](_0x5289c9,_0x3b143a);(!_0x3fd096||('get'in _0x3fd096?!_0x5289c9[_0x4adb09(0x155)]:_0x3fd096['writable']||_0x3fd096[_0x4adb09(0x158)]))&&(_0x3fd096={'enumerable':!![],'get':function(){return _0x5289c9[_0x3b143a];}}),Object[_0x4adb09(0x172)](_0x2bca2b,_0x46b371,_0x3fd096);}:function(_0x3ab359,_0x5b0122,_0x12d539,_0x5ef217){if(_0x5ef217===undefined)_0x5ef217=_0x12d539;_0x3ab359[_0x5ef217]=_0x5b0122[_0x12d539];}),__setModuleDefault=this&&this[a227_0x3139e1(0x13d)]||(Object[a227_0x3139e1(0x144)]?function(_0x5a5cf3,_0x28e165){const _0xf3b8e4=a227_0x3139e1;Object[_0xf3b8e4(0x172)](_0x5a5cf3,_0xf3b8e4(0x13c),{'enumerable':!![],'value':_0x28e165});}:function(_0x46f188,_0x5cb15c){const _0x528b23=a227_0x3139e1;_0x46f188[_0x528b23(0x13c)]=_0x5cb15c;}),__decorate=this&&this[a227_0x3139e1(0x182)]||function(_0x3139aa,_0x526a06,_0x250cbe,_0x5b3701){const _0x1eac02=a227_0x3139e1;var _0x333233=arguments[_0x1eac02(0x15f)],_0x5851bd=_0x333233<0x3?_0x526a06:_0x5b3701===null?_0x5b3701=Object['getOwnPropertyDescriptor'](_0x526a06,_0x250cbe):_0x5b3701,_0x524d91;if(typeof Reflect===_0x1eac02(0x181)&&typeof Reflect[_0x1eac02(0x137)]==='function')_0x5851bd=Reflect[_0x1eac02(0x137)](_0x3139aa,_0x526a06,_0x250cbe,_0x5b3701);else{for(var _0x3ee9e9=_0x3139aa[_0x1eac02(0x15f)]-0x1;_0x3ee9e9>=0x0;_0x3ee9e9--)if(_0x524d91=_0x3139aa[_0x3ee9e9])_0x5851bd=(_0x333233<0x3?_0x524d91(_0x5851bd):_0x333233>0x3?_0x524d91(_0x526a06,_0x250cbe,_0x5851bd):_0x524d91(_0x526a06,_0x250cbe))||_0x5851bd;}return _0x333233>0x3&&_0x5851bd&&Object[_0x1eac02(0x172)](_0x526a06,_0x250cbe,_0x5851bd),_0x5851bd;},__importStar=this&&this[a227_0x3139e1(0x177)]||function(_0x5b22f6){const _0xca0d92=a227_0x3139e1;if(_0x5b22f6&&_0x5b22f6[_0xca0d92(0x155)])return _0x5b22f6;var _0x3d412f={};if(_0x5b22f6!=null){for(var _0x36b2cd in _0x5b22f6)if(_0x36b2cd!==_0xca0d92(0x13c)&&Object[_0xca0d92(0x13e)][_0xca0d92(0x167)][_0xca0d92(0x14c)](_0x5b22f6,_0x36b2cd))__createBinding(_0x3d412f,_0x5b22f6,_0x36b2cd);}return __setModuleDefault(_0x3d412f,_0x5b22f6),_0x3d412f;},__metadata=this&&this['__metadata']||function(_0x3e3ee5,_0x27c5f1){const _0x4a7802=a227_0x3139e1;if(typeof Reflect===_0x4a7802(0x181)&&typeof Reflect[_0x4a7802(0x150)]===_0x4a7802(0x159))return Reflect[_0x4a7802(0x150)](_0x3e3ee5,_0x27c5f1);},__importDefault=this&&this[a227_0x3139e1(0x15a)]||function(_0x3edc5f){const _0x5e59d3=a227_0x3139e1;return _0x3edc5f&&_0x3edc5f[_0x5e59d3(0x155)]?_0x3edc5f:{'default':_0x3edc5f};},SalesforceAuthService_1;function a227_0x18a2(){const _0x1c21a5=['SALESFORCE_API_VERSION','refresh_token','InvalidRefreshTokenError','1662CqxerQ','hasOwnProperty','setAuthDetails','12XEPqrJ','post','../../providers/providers.tokens','logger','then','Idle','instanceUrl','1661SMaRzV','sleep','defineProperty','getOwnPropertyDescriptor','2534125ZFemws','8InJzHX','Updating','__importStar','AUTH_WAIT_TIME','update\x20access\x20token\x20failed:\x20%s','create\x20authorized\x20request\x20failed:\x20authorization\x20error','Active','1TwFQSK','axios','forceUpdateToken','Error','access\x20token\x20updated\x20for\x20%s','object','__decorate','Tokens','message','constructor','../../../../core','42072lXIaNe','Service','data','UnauthorizedSalesforceError','updateAccessToken','application/json','decorate','accessToken','design:paramtypes','Logger','error','default','__setModuleDefault','prototype','832239BjZSrk','tokenType','waitAuth','SalesforceAuthService','1323890zSSCuB','create','10690bZTjzU','getAuthData','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','../../../../constants/errors','1444JYGzFr','name','typedi','call','../errors/invalid-refresh-token.error','(((.+)+)+)+$','ERR_INVALID_SALESFORCE_TOKEN','metadata','search','AuthState','orgId','services/data/','__esModule','get','requestConfig','configurable','function','__importDefault','authState','toString','log','token_type','length','../../../shared/utils','1969261IDehQC','response'];a227_0x18a2=function(){return _0x1c21a5;};return a227_0x18a2();}Object[a227_0x3139e1(0x172)](exports,a227_0x3139e1(0x155),{'value':!![]}),exports[a227_0x3139e1(0x142)]=void 0x0;function a227_0xa9b8(_0x2ee401,_0x45bc61){const _0xd488b9=a227_0x18a2();return a227_0xa9b8=function(_0x93652d,_0xe72e38){_0x93652d=_0x93652d-0x12d;let _0x18a2ea=_0xd488b9[_0x93652d];return _0x18a2ea;},a227_0xa9b8(_0x2ee401,_0x45bc61);}const typedi_1=__importStar(require(a227_0x3139e1(0x14b))),errors_1=require(a227_0x3139e1(0x148)),core_1=require(a227_0x3139e1(0x130)),axios_1=__importDefault(require(a227_0x3139e1(0x17d))),utils_1=require(a227_0x3139e1(0x160)),invalid_refresh_token_error_1=require(a227_0x3139e1(0x14d)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require('../../../../constants'),providers_tokens_1=require(a227_0x3139e1(0x16b));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x283394=a227_0x3139e1;this[_0x283394(0x178)]=0x1388,this['authState']=auth_state_enum_1[_0x283394(0x152)]['Idle'],this[_0x283394(0x16c)]=new core_1[(_0x283394(0x13a))](SalesforceAuthService_1[_0x283394(0x14a)]),this[_0x283394(0x168)]();}async[a227_0x3139e1(0x168)](){const _0x2a1281=a227_0x3139e1;this[_0x2a1281(0x16c)]['log']('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x2a1281(0x152)][this[_0x2a1281(0x15b)]]);try{if(this['authState']===auth_state_enum_1['AuthState']['Error'])return;if(this['authState']===auth_state_enum_1['AuthState'][_0x2a1281(0x16e)])await this['updateAccessToken']();else{const _0x4972c2=await this[_0x2a1281(0x157)](),_0x279e6c=await axios_1[_0x2a1281(0x13c)][_0x2a1281(0x156)](_0x2a1281(0x154)+constants_1[_0x2a1281(0x163)],_0x4972c2)[_0x2a1281(0x16d)](()=>!![])['catch'](()=>![]);!_0x279e6c&&await this['updateAccessToken']();}}catch(_0x586aa1){}}async[a227_0x3139e1(0x135)](){const _0x4ecb2b=a227_0x3139e1;var _0x16e708,_0xc3420b,_0x509dd8;this[_0x4ecb2b(0x16c)][_0x4ecb2b(0x15d)]('update\x20access\x20token');try{this[_0x4ecb2b(0x15b)]=auth_state_enum_1[_0x4ecb2b(0x152)][_0x4ecb2b(0x176)];const {refreshToken:_0x21a5cd,clientId:_0x1a087e,clientSecret:_0x17dc63,loginUrl:_0x230e57}=typedi_1[_0x4ecb2b(0x13c)][_0x4ecb2b(0x156)](providers_tokens_1[_0x4ecb2b(0x12d)]['salesforce']),{data:_0x57502f}=await axios_1[_0x4ecb2b(0x13c)][_0x4ecb2b(0x16a)]((0x0,utils_1['joinURL'])(_0x230e57,'/services/oauth2/token'),null,{'params':{'grant_type':_0x4ecb2b(0x164),'refresh_token':_0x21a5cd,'client_id':_0x1a087e,'client_secret':_0x17dc63}});this[_0x4ecb2b(0x16f)]=_0x57502f['instance_url'],this['accessToken']=_0x57502f['access_token'],this[_0x4ecb2b(0x140)]=_0x57502f[_0x4ecb2b(0x15e)],this[_0x4ecb2b(0x15b)]=auth_state_enum_1[_0x4ecb2b(0x152)][_0x4ecb2b(0x17b)],this[_0x4ecb2b(0x16c)]['log'](_0x4ecb2b(0x180),this['instanceUrl']);}catch(_0x3d4192){const _0x2e36e2=((_0xc3420b=(_0x16e708=_0x3d4192===null||_0x3d4192===void 0x0?void 0x0:_0x3d4192[_0x4ecb2b(0x162)])===null||_0x16e708===void 0x0?void 0x0:_0x16e708[_0x4ecb2b(0x133)])===null||_0xc3420b===void 0x0?void 0x0:_0xc3420b[_0x4ecb2b(0x13b)])||((_0x509dd8=_0x3d4192===null||_0x3d4192===void 0x0?void 0x0:_0x3d4192[_0x4ecb2b(0x162)])===null||_0x509dd8===void 0x0?void 0x0:_0x509dd8['data'])||_0x3d4192[_0x4ecb2b(0x12e)];this[_0x4ecb2b(0x16c)]['error'](_0x4ecb2b(0x179),_0x2e36e2),this['authState']=auth_state_enum_1[_0x4ecb2b(0x152)][_0x4ecb2b(0x17f)];throw new invalid_refresh_token_error_1[(_0x4ecb2b(0x165))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a227_0x3139e1(0x17e)](){const _0x1aadf9=a227_0x3139e1;this['logger'][_0x1aadf9(0x15d)]('force\x20update\x20token');if(this[_0x1aadf9(0x15b)]===auth_state_enum_1[_0x1aadf9(0x152)][_0x1aadf9(0x176)]||this[_0x1aadf9(0x15b)]===auth_state_enum_1[_0x1aadf9(0x152)][_0x1aadf9(0x16e)])return await(0x0,utils_1['sleep'])(this[_0x1aadf9(0x178)]),this['forceUpdateToken']();if(this['authState']===auth_state_enum_1['AuthState'][_0x1aadf9(0x17f)])throw new invalid_refresh_token_error_1[(_0x1aadf9(0x165))](errors_1[_0x1aadf9(0x14f)]);await this['updateAccessToken']();}async[a227_0x3139e1(0x141)](){const _0x387321=a227_0x3139e1;if(this['authState']===auth_state_enum_1[_0x387321(0x152)][_0x387321(0x17f)]){this['logger'][_0x387321(0x15d)](_0x387321(0x17a));throw new unauthorized_salesforce_error_1[(_0x387321(0x134))]();}if(this[_0x387321(0x15b)]!==auth_state_enum_1['AuthState'][_0x387321(0x17b)])return this['logger']['log'](_0x387321(0x147)),await(0x0,utils_1[_0x387321(0x171)])(this['AUTH_WAIT_TIME']),this['waitAuth']();}[a227_0x3139e1(0x146)](){const _0x3c722d=a227_0x3139e1;return{'orgId':this[_0x3c722d(0x153)],'accessToken':this[_0x3c722d(0x138)],'instanceUrl':this['instanceUrl']};}async[a227_0x3139e1(0x157)](){const _0x412013=a227_0x3139e1;return await this[_0x412013(0x141)](),{'baseURL':this[_0x412013(0x16f)],'headers':{'accept':_0x412013(0x136),'authorization':this['tokenType']+'\x20'+this[_0x412013(0x138)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a227_0x3139e1(0x132)])(),__metadata(a227_0x3139e1(0x139),[])],SalesforceAuthService),exports[a227_0x3139e1(0x142)]=SalesforceAuthService;