const a227_0x4d67a7=a227_0x15a4;(function(_0x2c2c66,_0x3be68a){const _0x9be10a=a227_0x15a4,_0x13c87f=_0x2c2c66();while(!![]){try{const _0x1b985d=parseInt(_0x9be10a(0x159))/0x1*(-parseInt(_0x9be10a(0x15a))/0x2)+-parseInt(_0x9be10a(0x195))/0x3*(-parseInt(_0x9be10a(0x14b))/0x4)+parseInt(_0x9be10a(0x198))/0x5*(parseInt(_0x9be10a(0x193))/0x6)+-parseInt(_0x9be10a(0x16c))/0x7+-parseInt(_0x9be10a(0x192))/0x8+-parseInt(_0x9be10a(0x181))/0x9*(parseInt(_0x9be10a(0x19f))/0xa)+-parseInt(_0x9be10a(0x177))/0xb*(-parseInt(_0x9be10a(0x171))/0xc);if(_0x1b985d===_0x3be68a)break;else _0x13c87f['push'](_0x13c87f['shift']());}catch(_0x51aa03){_0x13c87f['push'](_0x13c87f['shift']());}}}(a227_0x926f,0xad498));function a227_0x926f(){const _0x598b59=['../errors/invalid-refresh-token.error','access_token','2609361dqhYia','message','updateAccessToken','SALESFORCE_API_VERSION','__createBinding','Idle','constructor','logger','AUTH_WAIT_TIME','force\x20update\x20token','check\x20auth:\x20current\x20state\x20-\x20%s','create\x20authorized\x20request\x20failed:\x20authorization\x20error','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','call','error','ERR_INVALID_SALESFORCE_TOKEN','../../../../constants','6347376aDcgyx','3504aWknrY','tokenType','3tqgJTt','UnauthorizedSalesforceError','then','8170nvoAbW','instanceUrl','__setModuleDefault','configurable','(((.+)+)+)+$','get','create','10ValLTc','Updating','Tokens','/services/oauth2/token','Logger','metadata','__importDefault','__importStar','refresh_token','SalesforceAuthService','1368288NfJfLS','salesforce','design:paramtypes','AuthState','search','apply','catch','access\x20token\x20updated\x20for\x20%s','sleep','waitAuth','__decorate','hasOwnProperty','../../../../constants/errors','requestConfig','1QDhzfO','480290WIxeXK','decorate','joinURL','../../../../core','InvalidRefreshTokenError','Service','orgId','data','__esModule','object','forceUpdateToken','application/json','__metadata','accessToken','log','function','Error','getAuthData','3259914jbiMou','setAuthDetails','defineProperty','writable','update\x20access\x20token','41352UXgZJh','default','response','services/data/','../enums/auth-state.enum','axios','3839nulBgh','length','name','instance_url','typedi','authState','getOwnPropertyDescriptor','token_type'];a227_0x926f=function(){return _0x598b59;};return a227_0x926f();}const a227_0x4a818d=(function(){let _0x5bdd2c=!![];return function(_0xccadd7,_0xf1a011){const _0xa16304=_0x5bdd2c?function(){const _0x25b173=a227_0x15a4;if(_0xf1a011){const _0x3fd70e=_0xf1a011[_0x25b173(0x150)](_0xccadd7,arguments);return _0xf1a011=null,_0x3fd70e;}}:function(){};return _0x5bdd2c=![],_0xa16304;};}()),a227_0x29e636=a227_0x4a818d(this,function(){const _0x36b6c9=a227_0x15a4;return a227_0x29e636['toString']()['search'](_0x36b6c9(0x19c))['toString']()[_0x36b6c9(0x187)](a227_0x29e636)[_0x36b6c9(0x14f)](_0x36b6c9(0x19c));});function a227_0x15a4(_0x20200f,_0x4bea5a){const _0x37c87b=a227_0x926f();return a227_0x15a4=function(_0x29e636,_0x4a818d){_0x29e636=_0x29e636-0x148;let _0x926f11=_0x37c87b[_0x29e636];return _0x926f11;},a227_0x15a4(_0x20200f,_0x4bea5a);}a227_0x29e636();'use strict';var __createBinding=this&&this[a227_0x4d67a7(0x185)]||(Object['create']?function(_0x1a9741,_0x1278da,_0x2e05f9,_0x44e8da){const _0x387922=a227_0x4d67a7;if(_0x44e8da===undefined)_0x44e8da=_0x2e05f9;var _0x33a2c6=Object[_0x387922(0x17d)](_0x1278da,_0x2e05f9);(!_0x33a2c6||(_0x387922(0x19d)in _0x33a2c6?!_0x1278da['__esModule']:_0x33a2c6[_0x387922(0x16f)]||_0x33a2c6[_0x387922(0x19b)]))&&(_0x33a2c6={'enumerable':!![],'get':function(){return _0x1278da[_0x2e05f9];}}),Object[_0x387922(0x16e)](_0x1a9741,_0x44e8da,_0x33a2c6);}:function(_0x25c734,_0x318415,_0x292923,_0xa0b1be){if(_0xa0b1be===undefined)_0xa0b1be=_0x292923;_0x25c734[_0xa0b1be]=_0x318415[_0x292923];}),__setModuleDefault=this&&this[a227_0x4d67a7(0x19a)]||(Object[a227_0x4d67a7(0x19e)]?function(_0x2d2d48,_0x17fb75){const _0x3c4eb7=a227_0x4d67a7;Object[_0x3c4eb7(0x16e)](_0x2d2d48,'default',{'enumerable':!![],'value':_0x17fb75});}:function(_0x4db8ae,_0x5cf872){const _0x4ff40a=a227_0x4d67a7;_0x4db8ae[_0x4ff40a(0x172)]=_0x5cf872;}),__decorate=this&&this[a227_0x4d67a7(0x155)]||function(_0x2a4aae,_0x33729e,_0x2b40dc,_0x301b7d){const _0x18eb62=a227_0x4d67a7;var _0xc7a136=arguments[_0x18eb62(0x178)],_0x273cbe=_0xc7a136<0x3?_0x33729e:_0x301b7d===null?_0x301b7d=Object[_0x18eb62(0x17d)](_0x33729e,_0x2b40dc):_0x301b7d,_0x658614;if(typeof Reflect===_0x18eb62(0x163)&&typeof Reflect['decorate']===_0x18eb62(0x169))_0x273cbe=Reflect[_0x18eb62(0x15b)](_0x2a4aae,_0x33729e,_0x2b40dc,_0x301b7d);else{for(var _0x16f740=_0x2a4aae[_0x18eb62(0x178)]-0x1;_0x16f740>=0x0;_0x16f740--)if(_0x658614=_0x2a4aae[_0x16f740])_0x273cbe=(_0xc7a136<0x3?_0x658614(_0x273cbe):_0xc7a136>0x3?_0x658614(_0x33729e,_0x2b40dc,_0x273cbe):_0x658614(_0x33729e,_0x2b40dc))||_0x273cbe;}return _0xc7a136>0x3&&_0x273cbe&&Object[_0x18eb62(0x16e)](_0x33729e,_0x2b40dc,_0x273cbe),_0x273cbe;},__importStar=this&&this[a227_0x4d67a7(0x148)]||function(_0x4d35cb){const _0x9308f2=a227_0x4d67a7;if(_0x4d35cb&&_0x4d35cb[_0x9308f2(0x162)])return _0x4d35cb;var _0x4f9abd={};if(_0x4d35cb!=null){for(var _0x331cbc in _0x4d35cb)if(_0x331cbc!=='default'&&Object['prototype'][_0x9308f2(0x156)][_0x9308f2(0x18e)](_0x4d35cb,_0x331cbc))__createBinding(_0x4f9abd,_0x4d35cb,_0x331cbc);}return __setModuleDefault(_0x4f9abd,_0x4d35cb),_0x4f9abd;},__metadata=this&&this[a227_0x4d67a7(0x166)]||function(_0xe7d13c,_0x3624a2){const _0x4989a9=a227_0x4d67a7;if(typeof Reflect==='object'&&typeof Reflect[_0x4989a9(0x1a4)]===_0x4989a9(0x169))return Reflect[_0x4989a9(0x1a4)](_0xe7d13c,_0x3624a2);},__importDefault=this&&this[a227_0x4d67a7(0x1a5)]||function(_0x55a706){return _0x55a706&&_0x55a706['__esModule']?_0x55a706:{'default':_0x55a706};},SalesforceAuthService_1;Object[a227_0x4d67a7(0x16e)](exports,a227_0x4d67a7(0x162),{'value':!![]}),exports[a227_0x4d67a7(0x14a)]=void 0x0;const typedi_1=__importStar(require(a227_0x4d67a7(0x17b))),errors_1=require(a227_0x4d67a7(0x157)),core_1=require(a227_0x4d67a7(0x15d)),axios_1=__importDefault(require(a227_0x4d67a7(0x176))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a227_0x4d67a7(0x17f)),auth_state_enum_1=require(a227_0x4d67a7(0x175)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a227_0x4d67a7(0x191)),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x448af2=a227_0x4d67a7;this[_0x448af2(0x189)]=0x1388,this[_0x448af2(0x17c)]=auth_state_enum_1[_0x448af2(0x14e)][_0x448af2(0x186)],this[_0x448af2(0x188)]=new core_1[(_0x448af2(0x1a3))](SalesforceAuthService_1[_0x448af2(0x179)]),this[_0x448af2(0x16d)]();}async[a227_0x4d67a7(0x16d)](){const _0x326840=a227_0x4d67a7;this['logger'][_0x326840(0x168)](_0x326840(0x18b),auth_state_enum_1['AuthState'][this[_0x326840(0x17c)]]);try{if(this[_0x326840(0x17c)]===auth_state_enum_1['AuthState'][_0x326840(0x16a)])return;if(this[_0x326840(0x17c)]===auth_state_enum_1['AuthState']['Idle'])await this[_0x326840(0x183)]();else{const _0x4f9b11=await this[_0x326840(0x158)](),_0x1350d4=await axios_1[_0x326840(0x172)][_0x326840(0x19d)](_0x326840(0x174)+constants_1[_0x326840(0x184)],_0x4f9b11)[_0x326840(0x197)](()=>!![])[_0x326840(0x151)](()=>![]);!_0x1350d4&&await this[_0x326840(0x183)]();}}catch(_0x122501){}}async[a227_0x4d67a7(0x183)](){const _0xc3f25e=a227_0x4d67a7;var _0x2dd989,_0x20cf88,_0xa78ffd;this[_0xc3f25e(0x188)][_0xc3f25e(0x168)](_0xc3f25e(0x170));try{this[_0xc3f25e(0x17c)]=auth_state_enum_1[_0xc3f25e(0x14e)][_0xc3f25e(0x1a0)];const {refreshToken:_0x5b429f,clientId:_0x9955f0,clientSecret:_0x421963,loginUrl:_0x205f85}=typedi_1[_0xc3f25e(0x172)][_0xc3f25e(0x19d)](providers_tokens_1[_0xc3f25e(0x1a1)][_0xc3f25e(0x14c)]),{data:_0x4969e1}=await axios_1['default']['post']((0x0,utils_1[_0xc3f25e(0x15c)])(_0x205f85,_0xc3f25e(0x1a2)),null,{'params':{'grant_type':_0xc3f25e(0x149),'refresh_token':_0x5b429f,'client_id':_0x9955f0,'client_secret':_0x421963}});this[_0xc3f25e(0x199)]=_0x4969e1[_0xc3f25e(0x17a)],this[_0xc3f25e(0x167)]=_0x4969e1[_0xc3f25e(0x180)],this['tokenType']=_0x4969e1[_0xc3f25e(0x17e)],this[_0xc3f25e(0x17c)]=auth_state_enum_1['AuthState']['Active'],this[_0xc3f25e(0x188)]['log'](_0xc3f25e(0x152),this[_0xc3f25e(0x199)]);}catch(_0x23eeee){const _0x5eb347=((_0x20cf88=(_0x2dd989=_0x23eeee===null||_0x23eeee===void 0x0?void 0x0:_0x23eeee['response'])===null||_0x2dd989===void 0x0?void 0x0:_0x2dd989['data'])===null||_0x20cf88===void 0x0?void 0x0:_0x20cf88[_0xc3f25e(0x18f)])||((_0xa78ffd=_0x23eeee===null||_0x23eeee===void 0x0?void 0x0:_0x23eeee[_0xc3f25e(0x173)])===null||_0xa78ffd===void 0x0?void 0x0:_0xa78ffd[_0xc3f25e(0x161)])||_0x23eeee[_0xc3f25e(0x182)];this['logger'][_0xc3f25e(0x18f)]('update\x20access\x20token\x20failed:\x20%s',_0x5eb347),this[_0xc3f25e(0x17c)]=auth_state_enum_1[_0xc3f25e(0x14e)]['Error'];throw new invalid_refresh_token_error_1[(_0xc3f25e(0x15e))](errors_1[_0xc3f25e(0x190)]);}}async[a227_0x4d67a7(0x164)](){const _0xdd5ba2=a227_0x4d67a7;this['logger']['log'](_0xdd5ba2(0x18a));if(this[_0xdd5ba2(0x17c)]===auth_state_enum_1[_0xdd5ba2(0x14e)][_0xdd5ba2(0x1a0)]||this[_0xdd5ba2(0x17c)]===auth_state_enum_1[_0xdd5ba2(0x14e)][_0xdd5ba2(0x186)])return await(0x0,utils_1[_0xdd5ba2(0x153)])(this[_0xdd5ba2(0x189)]),this[_0xdd5ba2(0x164)]();if(this[_0xdd5ba2(0x17c)]===auth_state_enum_1['AuthState'][_0xdd5ba2(0x16a)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0xdd5ba2(0x190)]);await this[_0xdd5ba2(0x183)]();}async[a227_0x4d67a7(0x154)](){const _0x486c32=a227_0x4d67a7;if(this[_0x486c32(0x17c)]===auth_state_enum_1[_0x486c32(0x14e)]['Error']){this['logger'][_0x486c32(0x168)](_0x486c32(0x18c));throw new unauthorized_salesforce_error_1[(_0x486c32(0x196))]();}if(this['authState']!==auth_state_enum_1['AuthState']['Active'])return this[_0x486c32(0x188)][_0x486c32(0x168)](_0x486c32(0x18d)),await(0x0,utils_1[_0x486c32(0x153)])(this[_0x486c32(0x189)]),this[_0x486c32(0x154)]();}[a227_0x4d67a7(0x16b)](){const _0x547acf=a227_0x4d67a7;return{'orgId':this[_0x547acf(0x160)],'accessToken':this[_0x547acf(0x167)],'instanceUrl':this[_0x547acf(0x199)]};}async[a227_0x4d67a7(0x158)](){const _0x150846=a227_0x4d67a7;return await this[_0x150846(0x154)](),{'baseURL':this[_0x150846(0x199)],'headers':{'accept':_0x150846(0x165),'authorization':this[_0x150846(0x194)]+'\x20'+this[_0x150846(0x167)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a227_0x4d67a7(0x15f)])(),__metadata(a227_0x4d67a7(0x14d),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;