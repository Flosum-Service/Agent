const a227_0x59dd8a=a227_0xf343;(function(_0x430c0a,_0x98ab97){const _0x21cd50=a227_0xf343,_0x234733=_0x430c0a();while(!![]){try{const _0xcfd27f=parseInt(_0x21cd50(0x126))/0x1+parseInt(_0x21cd50(0xfe))/0x2*(-parseInt(_0x21cd50(0xe2))/0x3)+parseInt(_0x21cd50(0xec))/0x4+parseInt(_0x21cd50(0xde))/0x5+-parseInt(_0x21cd50(0xf2))/0x6*(parseInt(_0x21cd50(0xef))/0x7)+parseInt(_0x21cd50(0x123))/0x8+parseInt(_0x21cd50(0x122))/0x9*(-parseInt(_0x21cd50(0x112))/0xa);if(_0xcfd27f===_0x98ab97)break;else _0x234733['push'](_0x234733['shift']());}catch(_0x14d204){_0x234733['push'](_0x234733['shift']());}}}(a227_0x47d3,0x5a2f6));const a227_0x481ad2=(function(){let _0x4aa30f=!![];return function(_0x1e9287,_0x48d87a){const _0x66abcf=_0x4aa30f?function(){if(_0x48d87a){const _0x517bc9=_0x48d87a['apply'](_0x1e9287,arguments);return _0x48d87a=null,_0x517bc9;}}:function(){};return _0x4aa30f=![],_0x66abcf;};}()),a227_0x5b9cbf=a227_0x481ad2(this,function(){const _0x13c5c6=a227_0xf343;return a227_0x5b9cbf[_0x13c5c6(0xfc)]()[_0x13c5c6(0x109)](_0x13c5c6(0x10d))['toString']()[_0x13c5c6(0x11a)](a227_0x5b9cbf)[_0x13c5c6(0x109)]('(((.+)+)+)+$');});a227_0x5b9cbf();'use strict';var __createBinding=this&&this[a227_0x59dd8a(0xf5)]||(Object['create']?function(_0x3e79f9,_0x40fcd0,_0x20326a,_0x4f2d73){const _0x24ef6a=a227_0x59dd8a;if(_0x4f2d73===undefined)_0x4f2d73=_0x20326a;var _0x47e6f0=Object[_0x24ef6a(0x108)](_0x40fcd0,_0x20326a);(!_0x47e6f0||('get'in _0x47e6f0?!_0x40fcd0['__esModule']:_0x47e6f0[_0x24ef6a(0x128)]||_0x47e6f0[_0x24ef6a(0x10e)]))&&(_0x47e6f0={'enumerable':!![],'get':function(){return _0x40fcd0[_0x20326a];}}),Object[_0x24ef6a(0x120)](_0x3e79f9,_0x4f2d73,_0x47e6f0);}:function(_0xab4bdc,_0x45f105,_0x135661,_0x4c77d3){if(_0x4c77d3===undefined)_0x4c77d3=_0x135661;_0xab4bdc[_0x4c77d3]=_0x45f105[_0x135661];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a227_0x59dd8a(0xfd)]?function(_0x3effd0,_0xe9f589){const _0x1424ba=a227_0x59dd8a;Object[_0x1424ba(0x120)](_0x3effd0,_0x1424ba(0x129),{'enumerable':!![],'value':_0xe9f589});}:function(_0x36f6d3,_0x5c6d96){_0x36f6d3['default']=_0x5c6d96;}),__decorate=this&&this[a227_0x59dd8a(0x10b)]||function(_0x1a3af9,_0x1e8a57,_0x17abf4,_0x5d941c){const _0x395643=a227_0x59dd8a;var _0x9f7a6a=arguments['length'],_0x252bf3=_0x9f7a6a<0x3?_0x1e8a57:_0x5d941c===null?_0x5d941c=Object[_0x395643(0x108)](_0x1e8a57,_0x17abf4):_0x5d941c,_0x2f18a4;if(typeof Reflect==='object'&&typeof Reflect[_0x395643(0x125)]===_0x395643(0x115))_0x252bf3=Reflect[_0x395643(0x125)](_0x1a3af9,_0x1e8a57,_0x17abf4,_0x5d941c);else{for(var _0x85479d=_0x1a3af9[_0x395643(0xeb)]-0x1;_0x85479d>=0x0;_0x85479d--)if(_0x2f18a4=_0x1a3af9[_0x85479d])_0x252bf3=(_0x9f7a6a<0x3?_0x2f18a4(_0x252bf3):_0x9f7a6a>0x3?_0x2f18a4(_0x1e8a57,_0x17abf4,_0x252bf3):_0x2f18a4(_0x1e8a57,_0x17abf4))||_0x252bf3;}return _0x9f7a6a>0x3&&_0x252bf3&&Object['defineProperty'](_0x1e8a57,_0x17abf4,_0x252bf3),_0x252bf3;},__importStar=this&&this['__importStar']||function(_0x504289){const _0x2474ef=a227_0x59dd8a;if(_0x504289&&_0x504289[_0x2474ef(0x12a)])return _0x504289;var _0x28a7d2={};if(_0x504289!=null){for(var _0x2ea1a2 in _0x504289)if(_0x2ea1a2!==_0x2474ef(0x129)&&Object[_0x2474ef(0xe0)][_0x2474ef(0x111)][_0x2474ef(0x12b)](_0x504289,_0x2ea1a2))__createBinding(_0x28a7d2,_0x504289,_0x2ea1a2);}return __setModuleDefault(_0x28a7d2,_0x504289),_0x28a7d2;},__metadata=this&&this['__metadata']||function(_0x211f91,_0x4f3113){const _0xd6f1c6=a227_0x59dd8a;if(typeof Reflect===_0xd6f1c6(0x121)&&typeof Reflect[_0xd6f1c6(0xee)]===_0xd6f1c6(0x115))return Reflect[_0xd6f1c6(0xee)](_0x211f91,_0x4f3113);},__importDefault=this&&this[a227_0x59dd8a(0xf0)]||function(_0x115793){const _0xb0ac26=a227_0x59dd8a;return _0x115793&&_0x115793[_0xb0ac26(0x12a)]?_0x115793:{'default':_0x115793};},SalesforceAuthService_1;Object[a227_0x59dd8a(0x120)](exports,a227_0x59dd8a(0x12a),{'value':!![]}),exports[a227_0x59dd8a(0x103)]=void 0x0;function a227_0x47d3(){const _0x5d59af=['379017QYBDWt','398664KueOuD','SALESFORCE_API_VERSION','decorate','703449iBjfyq','waitAuth','writable','default','__esModule','call','Service','InvalidRefreshTokenError','../../../../core','get','post','check\x20auth:\x20current\x20state\x20-\x20%s','log','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','../../../shared/utils','3530695NwgTAo','accessToken','prototype','getAuthData','74796bjCubY','salesforce','design:paramtypes','Error','Idle','sleep','updateAccessToken','setAuthDetails','update\x20access\x20token','length','707992yVdCjo','typedi','metadata','9534jyShgd','__importDefault','error','3060iFlvWy','instanceUrl','AUTH_WAIT_TIME','__createBinding','../../providers/providers.tokens','ERR_INVALID_SALESFORCE_TOKEN','refresh_token','joinURL','response','access\x20token\x20updated\x20for\x20%s','toString','create','2bteUPb','create\x20authorized\x20request\x20failed:\x20authorization\x20error','orgId','message','data','SalesforceAuthService','AuthState','force\x20update\x20token','requestConfig','../../../../constants','getOwnPropertyDescriptor','search','Logger','__decorate','Updating','(((.+)+)+)+$','configurable','services/data/','then','hasOwnProperty','130Lxzdjb','catch','tokenType','function','../../../../constants/errors','/services/oauth2/token','update\x20access\x20token\x20failed:\x20%s','../enums/auth-state.enum','constructor','forceUpdateToken','logger','../errors/unauthorized-salesforce.error','UnauthorizedSalesforceError','authState','defineProperty','object'];a227_0x47d3=function(){return _0x5d59af;};return a227_0x47d3();}function a227_0xf343(_0x5a0d10,_0x3e050d){const _0x1b37fd=a227_0x47d3();return a227_0xf343=function(_0x5b9cbf,_0x481ad2){_0x5b9cbf=_0x5b9cbf-0xd7;let _0x47d3d5=_0x1b37fd[_0x5b9cbf];return _0x47d3d5;},a227_0xf343(_0x5a0d10,_0x3e050d);}const typedi_1=__importStar(require(a227_0x59dd8a(0xed))),errors_1=require(a227_0x59dd8a(0x116)),core_1=require(a227_0x59dd8a(0xd7)),axios_1=__importDefault(require('axios')),utils_1=require(a227_0x59dd8a(0xdd)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a227_0x59dd8a(0x119)),unauthorized_salesforce_error_1=require(a227_0x59dd8a(0x11d)),constants_1=require(a227_0x59dd8a(0x107)),providers_tokens_1=require(a227_0x59dd8a(0xf6));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x4aaf7d=a227_0x59dd8a;this[_0x4aaf7d(0xf4)]=0x1388,this['authState']=auth_state_enum_1[_0x4aaf7d(0x104)]['Idle'],this['logger']=new core_1[(_0x4aaf7d(0x10a))](SalesforceAuthService_1['name']),this[_0x4aaf7d(0xe9)]();}async[a227_0x59dd8a(0xe9)](){const _0x319df9=a227_0x59dd8a;this['logger'][_0x319df9(0xdb)](_0x319df9(0xda),auth_state_enum_1[_0x319df9(0x104)][this[_0x319df9(0x11f)]]);try{if(this[_0x319df9(0x11f)]===auth_state_enum_1[_0x319df9(0x104)][_0x319df9(0xe5)])return;if(this[_0x319df9(0x11f)]===auth_state_enum_1[_0x319df9(0x104)][_0x319df9(0xe6)])await this['updateAccessToken']();else{const _0x35a736=await this[_0x319df9(0x106)](),_0xf40f1f=await axios_1[_0x319df9(0x129)][_0x319df9(0xd8)](_0x319df9(0x10f)+constants_1[_0x319df9(0x124)],_0x35a736)[_0x319df9(0x110)](()=>!![])[_0x319df9(0x113)](()=>![]);!_0xf40f1f&&await this[_0x319df9(0xe8)]();}}catch(_0x58339b){}}async['updateAccessToken'](){const _0x387b78=a227_0x59dd8a;var _0x50edaa,_0x1f2c7c,_0x4f6696;this[_0x387b78(0x11c)]['log'](_0x387b78(0xea));try{this[_0x387b78(0x11f)]=auth_state_enum_1['AuthState'][_0x387b78(0x10c)];const {refreshToken:_0xd0b9ca,clientId:_0x180053,clientSecret:_0xfa9b22,loginUrl:_0x145217}=typedi_1[_0x387b78(0x129)][_0x387b78(0xd8)](providers_tokens_1['Tokens'][_0x387b78(0xe3)]),{data:_0x368162}=await axios_1[_0x387b78(0x129)][_0x387b78(0xd9)]((0x0,utils_1[_0x387b78(0xf9)])(_0x145217,_0x387b78(0x117)),null,{'params':{'grant_type':_0x387b78(0xf8),'refresh_token':_0xd0b9ca,'client_id':_0x180053,'client_secret':_0xfa9b22}});this['instanceUrl']=_0x368162['instance_url'],this[_0x387b78(0xdf)]=_0x368162['access_token'],this[_0x387b78(0x114)]=_0x368162['token_type'],this[_0x387b78(0x11f)]=auth_state_enum_1[_0x387b78(0x104)]['Active'],this[_0x387b78(0x11c)][_0x387b78(0xdb)](_0x387b78(0xfb),this[_0x387b78(0xf3)]);}catch(_0x46ec4d){const _0x1d5621=((_0x1f2c7c=(_0x50edaa=_0x46ec4d===null||_0x46ec4d===void 0x0?void 0x0:_0x46ec4d['response'])===null||_0x50edaa===void 0x0?void 0x0:_0x50edaa[_0x387b78(0x102)])===null||_0x1f2c7c===void 0x0?void 0x0:_0x1f2c7c[_0x387b78(0xf1)])||((_0x4f6696=_0x46ec4d===null||_0x46ec4d===void 0x0?void 0x0:_0x46ec4d[_0x387b78(0xfa)])===null||_0x4f6696===void 0x0?void 0x0:_0x4f6696[_0x387b78(0x102)])||_0x46ec4d[_0x387b78(0x101)];this['logger'][_0x387b78(0xf1)](_0x387b78(0x118),_0x1d5621),this[_0x387b78(0x11f)]=auth_state_enum_1[_0x387b78(0x104)][_0x387b78(0xe5)];throw new invalid_refresh_token_error_1[(_0x387b78(0x12d))](errors_1[_0x387b78(0xf7)]);}}async[a227_0x59dd8a(0x11b)](){const _0x1ed4fc=a227_0x59dd8a;this['logger'][_0x1ed4fc(0xdb)](_0x1ed4fc(0x105));if(this[_0x1ed4fc(0x11f)]===auth_state_enum_1['AuthState'][_0x1ed4fc(0x10c)]||this['authState']===auth_state_enum_1[_0x1ed4fc(0x104)][_0x1ed4fc(0xe6)])return await(0x0,utils_1[_0x1ed4fc(0xe7)])(this[_0x1ed4fc(0xf4)]),this[_0x1ed4fc(0x11b)]();if(this[_0x1ed4fc(0x11f)]===auth_state_enum_1[_0x1ed4fc(0x104)][_0x1ed4fc(0xe5)])throw new invalid_refresh_token_error_1[(_0x1ed4fc(0x12d))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x1ed4fc(0xe8)]();}async['waitAuth'](){const _0x809036=a227_0x59dd8a;if(this[_0x809036(0x11f)]===auth_state_enum_1[_0x809036(0x104)][_0x809036(0xe5)]){this['logger'][_0x809036(0xdb)](_0x809036(0xff));throw new unauthorized_salesforce_error_1[(_0x809036(0x11e))]();}if(this[_0x809036(0x11f)]!==auth_state_enum_1[_0x809036(0x104)]['Active'])return this[_0x809036(0x11c)][_0x809036(0xdb)](_0x809036(0xdc)),await(0x0,utils_1['sleep'])(this[_0x809036(0xf4)]),this[_0x809036(0x127)]();}[a227_0x59dd8a(0xe1)](){const _0x4b374b=a227_0x59dd8a;return{'orgId':this[_0x4b374b(0x100)],'accessToken':this[_0x4b374b(0xdf)],'instanceUrl':this['instanceUrl']};}async['requestConfig'](){const _0x3baf91=a227_0x59dd8a;return await this[_0x3baf91(0x127)](),{'baseURL':this[_0x3baf91(0xf3)],'headers':{'accept':'application/json','authorization':this[_0x3baf91(0x114)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a227_0x59dd8a(0x12c)])(),__metadata(a227_0x59dd8a(0xe4),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;