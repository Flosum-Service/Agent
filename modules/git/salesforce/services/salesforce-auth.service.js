const a259_0x5500bb=a259_0x5133;(function(_0x54584,_0x188a37){const _0x470dd1=a259_0x5133,_0x55c032=_0x54584();while(!![]){try{const _0x3c51f1=parseInt(_0x470dd1(0x124))/0x1+parseInt(_0x470dd1(0x140))/0x2+-parseInt(_0x470dd1(0x13f))/0x3*(-parseInt(_0x470dd1(0x154))/0x4)+parseInt(_0x470dd1(0x135))/0x5*(-parseInt(_0x470dd1(0x139))/0x6)+-parseInt(_0x470dd1(0x13a))/0x7+-parseInt(_0x470dd1(0x16c))/0x8*(-parseInt(_0x470dd1(0x125))/0x9)+-parseInt(_0x470dd1(0x138))/0xa;if(_0x3c51f1===_0x188a37)break;else _0x55c032['push'](_0x55c032['shift']());}catch(_0x2ffa36){_0x55c032['push'](_0x55c032['shift']());}}}(a259_0x48bd,0xc7add));const a259_0x1eb313=(function(){let _0x587b22=!![];return function(_0x14a496,_0x2645ff){const _0x28de3a=_0x587b22?function(){const _0x1ec18e=a259_0x5133;if(_0x2645ff){const _0x2144b8=_0x2645ff[_0x1ec18e(0x12a)](_0x14a496,arguments);return _0x2645ff=null,_0x2144b8;}}:function(){};return _0x587b22=![],_0x28de3a;};}()),a259_0x434387=a259_0x1eb313(this,function(){const _0x482886=a259_0x5133;return a259_0x434387['toString']()[_0x482886(0x160)](_0x482886(0x17c))[_0x482886(0x142)]()[_0x482886(0x137)](a259_0x434387)[_0x482886(0x160)](_0x482886(0x17c));});a259_0x434387();function a259_0x5133(_0x312d66,_0x2f8eef){const _0x1063c8=a259_0x48bd();return a259_0x5133=function(_0x434387,_0x1eb313){_0x434387=_0x434387-0x122;let _0x48bd8d=_0x1063c8[_0x434387];return _0x48bd8d;},a259_0x5133(_0x312d66,_0x2f8eef);}'use strict';var __createBinding=this&&this['__createBinding']||(Object[a259_0x5500bb(0x163)]?function(_0x96380c,_0x323646,_0x57553e,_0x25e9c2){const _0x4ef758=a259_0x5500bb;if(_0x25e9c2===undefined)_0x25e9c2=_0x57553e;var _0x39cbdc=Object[_0x4ef758(0x175)](_0x323646,_0x57553e);(!_0x39cbdc||(_0x4ef758(0x168)in _0x39cbdc?!_0x323646[_0x4ef758(0x16e)]:_0x39cbdc[_0x4ef758(0x177)]||_0x39cbdc[_0x4ef758(0x155)]))&&(_0x39cbdc={'enumerable':!![],'get':function(){return _0x323646[_0x57553e];}}),Object[_0x4ef758(0x13b)](_0x96380c,_0x25e9c2,_0x39cbdc);}:function(_0xb6ab16,_0xc2bae9,_0x3294fc,_0x28ef67){if(_0x28ef67===undefined)_0x28ef67=_0x3294fc;_0xb6ab16[_0x28ef67]=_0xc2bae9[_0x3294fc];}),__setModuleDefault=this&&this[a259_0x5500bb(0x12c)]||(Object[a259_0x5500bb(0x163)]?function(_0x2906ea,_0x4fd991){const _0x2ab50d=a259_0x5500bb;Object[_0x2ab50d(0x13b)](_0x2906ea,'default',{'enumerable':!![],'value':_0x4fd991});}:function(_0x3b7ff9,_0x3b2ae3){_0x3b7ff9['default']=_0x3b2ae3;}),__decorate=this&&this[a259_0x5500bb(0x14f)]||function(_0x57704b,_0x4e837f,_0xe5d518,_0x32ce92){const _0x4fefc3=a259_0x5500bb;var _0x36d5b8=arguments[_0x4fefc3(0x17e)],_0x4bb9ad=_0x36d5b8<0x3?_0x4e837f:_0x32ce92===null?_0x32ce92=Object[_0x4fefc3(0x175)](_0x4e837f,_0xe5d518):_0x32ce92,_0x304cd0;if(typeof Reflect==='object'&&typeof Reflect[_0x4fefc3(0x144)]===_0x4fefc3(0x17f))_0x4bb9ad=Reflect[_0x4fefc3(0x144)](_0x57704b,_0x4e837f,_0xe5d518,_0x32ce92);else{for(var _0x1e3c69=_0x57704b[_0x4fefc3(0x17e)]-0x1;_0x1e3c69>=0x0;_0x1e3c69--)if(_0x304cd0=_0x57704b[_0x1e3c69])_0x4bb9ad=(_0x36d5b8<0x3?_0x304cd0(_0x4bb9ad):_0x36d5b8>0x3?_0x304cd0(_0x4e837f,_0xe5d518,_0x4bb9ad):_0x304cd0(_0x4e837f,_0xe5d518))||_0x4bb9ad;}return _0x36d5b8>0x3&&_0x4bb9ad&&Object[_0x4fefc3(0x13b)](_0x4e837f,_0xe5d518,_0x4bb9ad),_0x4bb9ad;},__importStar=this&&this[a259_0x5500bb(0x176)]||function(_0x15d694){const _0xc0d9eb=a259_0x5500bb;if(_0x15d694&&_0x15d694['__esModule'])return _0x15d694;var _0x2b39f5={};if(_0x15d694!=null){for(var _0x268b82 in _0x15d694)if(_0x268b82!==_0xc0d9eb(0x153)&&Object[_0xc0d9eb(0x14a)]['hasOwnProperty'][_0xc0d9eb(0x12d)](_0x15d694,_0x268b82))__createBinding(_0x2b39f5,_0x15d694,_0x268b82);}return __setModuleDefault(_0x2b39f5,_0x15d694),_0x2b39f5;},__metadata=this&&this[a259_0x5500bb(0x16d)]||function(_0x483283,_0x2ca43f){const _0x1e33bf=a259_0x5500bb;if(typeof Reflect===_0x1e33bf(0x134)&&typeof Reflect['metadata']==='function')return Reflect[_0x1e33bf(0x122)](_0x483283,_0x2ca43f);},__importDefault=this&&this[a259_0x5500bb(0x156)]||function(_0x5bd0f1){const _0x304a71=a259_0x5500bb;return _0x5bd0f1&&_0x5bd0f1[_0x304a71(0x16e)]?_0x5bd0f1:{'default':_0x5bd0f1};},SalesforceAuthService_1;Object[a259_0x5500bb(0x13b)](exports,a259_0x5500bb(0x16e),{'value':!![]}),exports[a259_0x5500bb(0x141)]=void 0x0;const typedi_1=__importStar(require(a259_0x5500bb(0x15c))),errors_1=require(a259_0x5500bb(0x165)),core_1=require(a259_0x5500bb(0x179)),axios_1=__importDefault(require(a259_0x5500bb(0x132))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a259_0x5500bb(0x152)),auth_state_enum_1=require(a259_0x5500bb(0x151)),unauthorized_salesforce_error_1=require(a259_0x5500bb(0x16b)),constants_1=require('../../../../constants'),providers_tokens_1=require(a259_0x5500bb(0x181)),salesforce_1=require(a259_0x5500bb(0x123));function a259_0x48bd(){const _0x460b46=['__decorate','refresh_token','../enums/auth-state.enum','../errors/invalid-refresh-token.error','default','20xuNgJY','configurable','__importDefault','tokenType','/services/oauth2/token','X-SFDC-Session','Access\x20token\x20updated\x20for\x20%s','setAuthDetails','typedi','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','updateAccessToken','Tokens','search','accessToken','replace','create','instanceUrl','../../../../constants/errors','Active','forceUpdateToken','get','error','Force\x20update\x20token','../errors/unauthorized-salesforce.error','5016HDfCZq','__metadata','__esModule','Check\x20auth:\x20current\x20state\x20-\x20%s','ERR_INVALID_SALESFORCE_TOKEN','catch','message','data','SALESFORCE_API_VERSION','getOwnPropertyDescriptor','__importStar','writable','authState','../../../../core','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','headers','(((.+)+)+)+$','isBulk1Url','length','function','post','../../providers/providers.tokens','metadata','@flosum/salesforce','1008926hSiJQs','17109QonXlR','Error','token_type','access_token','AuthState','apply','log','__setModuleDefault','call','waitAuth','getAuthData','then','Service','axios','logger','object','5dAmvqG','orgId','constructor','18582100SrlsYG','3951390SDHDlF','4167548zUdQGV','defineProperty','SalesforceUtils','requestConfig','AUTH_WAIT_TIME','960987pGMsFF','255052XUAZlO','SalesforceAuthService','toString','Update\x20access\x20token','decorate','Updating','sleep','joinURL','design:paramtypes','salesforce','prototype','Logger','InvalidRefreshTokenError','Idle','response'];a259_0x48bd=function(){return _0x460b46;};return a259_0x48bd();}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x320314=a259_0x5500bb;this[_0x320314(0x13e)]=0x1388,this[_0x320314(0x178)]=auth_state_enum_1[_0x320314(0x129)][_0x320314(0x14d)],this[_0x320314(0x133)]=new core_1[(_0x320314(0x14b))](SalesforceAuthService_1['name']),this[_0x320314(0x15b)]();}async[a259_0x5500bb(0x15b)](){const _0x2068d7=a259_0x5500bb;this[_0x2068d7(0x133)]['log'](_0x2068d7(0x16f),auth_state_enum_1[_0x2068d7(0x129)][this[_0x2068d7(0x178)]]);try{if(this[_0x2068d7(0x178)]===auth_state_enum_1[_0x2068d7(0x129)][_0x2068d7(0x126)])return;if(this[_0x2068d7(0x178)]===auth_state_enum_1[_0x2068d7(0x129)][_0x2068d7(0x14d)])await this[_0x2068d7(0x15e)]();else{const _0x2bd634=await this[_0x2068d7(0x13d)](),_0x356a31=await axios_1['default'][_0x2068d7(0x168)]('services/data/'+constants_1[_0x2068d7(0x174)],_0x2bd634)[_0x2068d7(0x130)](()=>!![])[_0x2068d7(0x171)](()=>![]);!_0x356a31&&await this[_0x2068d7(0x15e)]();}}catch(_0x2e9cff){}}async[a259_0x5500bb(0x15e)](){const _0x149a94=a259_0x5500bb;var _0xdcae0a,_0x525b18,_0x596da1;this[_0x149a94(0x133)][_0x149a94(0x12b)](_0x149a94(0x143));try{this[_0x149a94(0x178)]=auth_state_enum_1[_0x149a94(0x129)][_0x149a94(0x145)];const {refreshToken:_0x489d3a,clientId:_0x1d759c,clientSecret:_0x25ec54,loginUrl:_0x3b10d8}=typedi_1[_0x149a94(0x153)][_0x149a94(0x168)](providers_tokens_1[_0x149a94(0x15f)][_0x149a94(0x149)]),{data:_0x52ba34}=await axios_1['default'][_0x149a94(0x180)]((0x0,utils_1[_0x149a94(0x147)])(_0x3b10d8,_0x149a94(0x158)),null,{'params':{'grant_type':_0x149a94(0x150),'refresh_token':_0x489d3a,'client_id':_0x1d759c,'client_secret':_0x25ec54}});this[_0x149a94(0x164)]=_0x52ba34['instance_url'],this[_0x149a94(0x161)]=_0x52ba34[_0x149a94(0x128)],this[_0x149a94(0x157)]=_0x52ba34[_0x149a94(0x127)],this[_0x149a94(0x178)]=auth_state_enum_1[_0x149a94(0x129)][_0x149a94(0x166)],this[_0x149a94(0x133)]['log'](_0x149a94(0x15a),this['instanceUrl']);}catch(_0x3b3e08){const _0x36298b=((_0x525b18=(_0xdcae0a=_0x3b3e08===null||_0x3b3e08===void 0x0?void 0x0:_0x3b3e08['response'])===null||_0xdcae0a===void 0x0?void 0x0:_0xdcae0a[_0x149a94(0x173)])===null||_0x525b18===void 0x0?void 0x0:_0x525b18[_0x149a94(0x169)])||((_0x596da1=_0x3b3e08===null||_0x3b3e08===void 0x0?void 0x0:_0x3b3e08[_0x149a94(0x14e)])===null||_0x596da1===void 0x0?void 0x0:_0x596da1[_0x149a94(0x173)])||_0x3b3e08[_0x149a94(0x172)];this[_0x149a94(0x133)][_0x149a94(0x169)]('Update\x20access\x20token\x20failed:\x20%s',_0x36298b),this[_0x149a94(0x178)]=auth_state_enum_1[_0x149a94(0x129)][_0x149a94(0x126)];throw new invalid_refresh_token_error_1[(_0x149a94(0x14c))](errors_1[_0x149a94(0x170)]);}}async[a259_0x5500bb(0x167)](){const _0xb564d0=a259_0x5500bb;this[_0xb564d0(0x133)][_0xb564d0(0x12b)](_0xb564d0(0x16a));if(this[_0xb564d0(0x178)]===auth_state_enum_1[_0xb564d0(0x129)][_0xb564d0(0x145)]||this['authState']===auth_state_enum_1[_0xb564d0(0x129)][_0xb564d0(0x14d)])return await(0x0,utils_1[_0xb564d0(0x146)])(this[_0xb564d0(0x13e)]),this[_0xb564d0(0x167)]();if(this['authState']===auth_state_enum_1[_0xb564d0(0x129)][_0xb564d0(0x126)])throw new invalid_refresh_token_error_1[(_0xb564d0(0x14c))](errors_1[_0xb564d0(0x170)]);await this[_0xb564d0(0x15e)]();}async[a259_0x5500bb(0x12e)](){const _0x3cb375=a259_0x5500bb;if(this[_0x3cb375(0x178)]===auth_state_enum_1[_0x3cb375(0x129)]['Error']){this[_0x3cb375(0x133)][_0x3cb375(0x12b)](_0x3cb375(0x17a));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x3cb375(0x178)]!==auth_state_enum_1[_0x3cb375(0x129)]['Active'])return this[_0x3cb375(0x133)][_0x3cb375(0x12b)](_0x3cb375(0x15d)),await(0x0,utils_1[_0x3cb375(0x146)])(this[_0x3cb375(0x13e)]),this['waitAuth']();}[a259_0x5500bb(0x12f)](){const _0x66b5d2=a259_0x5500bb;return{'orgId':this[_0x66b5d2(0x136)],'accessToken':this['accessToken'],'instanceUrl':this[_0x66b5d2(0x164)]};}async[a259_0x5500bb(0x13d)](_0x1a5fc0=''){const _0x2d580f=a259_0x5500bb;await this['waitAuth']();const _0x212228={'baseURL':this['instanceUrl'],'headers':{'accept':'application/json'}};if(salesforce_1[_0x2d580f(0x13c)][_0x2d580f(0x17d)](_0x1a5fc0))_0x212228[_0x2d580f(0x17b)][_0x2d580f(0x159)]=this['accessToken'];else salesforce_1[_0x2d580f(0x13c)]['isSoapUrl'](_0x1a5fc0)?_0x212228['data']=_0x212228[_0x2d580f(0x173)][_0x2d580f(0x162)](/<met:sessionId>.+?<\/met:sessionId>/,'<met:sessionId>'+this[_0x2d580f(0x161)]+'</met:sessionId>'):_0x212228['headers']['authorization']=this['tokenType']+'\x20'+this[_0x2d580f(0x161)];return _0x212228;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a259_0x5500bb(0x131)])(),__metadata(a259_0x5500bb(0x148),[])],SalesforceAuthService),exports[a259_0x5500bb(0x141)]=SalesforceAuthService;