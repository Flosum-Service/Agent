const a232_0x31f2=a232_0x37d0;function a232_0x37d0(_0xa2263f,_0x162514){const _0x507d95=a232_0xc126();return a232_0x37d0=function(_0x36cc0b,_0x17df70){_0x36cc0b=_0x36cc0b-0x13a;let _0xc126f8=_0x507d95[_0x36cc0b];return _0xc126f8;},a232_0x37d0(_0xa2263f,_0x162514);}(function(_0x5e6ba6,_0x4e07ab){const _0x4bf547=a232_0x37d0,_0x2d2aa7=_0x5e6ba6();while(!![]){try{const _0x55d3d4=parseInt(_0x4bf547(0x149))/0x1*(parseInt(_0x4bf547(0x187))/0x2)+parseInt(_0x4bf547(0x169))/0x3+parseInt(_0x4bf547(0x13a))/0x4*(parseInt(_0x4bf547(0x156))/0x5)+-parseInt(_0x4bf547(0x180))/0x6+-parseInt(_0x4bf547(0x14e))/0x7*(-parseInt(_0x4bf547(0x174))/0x8)+parseInt(_0x4bf547(0x17d))/0x9+-parseInt(_0x4bf547(0x18f))/0xa*(parseInt(_0x4bf547(0x14b))/0xb);if(_0x55d3d4===_0x4e07ab)break;else _0x2d2aa7['push'](_0x2d2aa7['shift']());}catch(_0x49000c){_0x2d2aa7['push'](_0x2d2aa7['shift']());}}}(a232_0xc126,0x3110c));const a232_0x17df70=(function(){let _0x3e237b=!![];return function(_0x4f8bdd,_0x37b221){const _0x1e49cf=_0x3e237b?function(){const _0x3acf10=a232_0x37d0;if(_0x37b221){const _0x5dcd23=_0x37b221[_0x3acf10(0x16e)](_0x4f8bdd,arguments);return _0x37b221=null,_0x5dcd23;}}:function(){};return _0x3e237b=![],_0x1e49cf;};}()),a232_0x36cc0b=a232_0x17df70(this,function(){const _0x130a02=a232_0x37d0;return a232_0x36cc0b[_0x130a02(0x148)]()[_0x130a02(0x144)]('(((.+)+)+)+$')['toString']()[_0x130a02(0x142)](a232_0x36cc0b)[_0x130a02(0x144)](_0x130a02(0x177));});a232_0x36cc0b();'use strict';var __createBinding=this&&this[a232_0x31f2(0x18c)]||(Object[a232_0x31f2(0x167)]?function(_0x1c905a,_0x19d047,_0x18e773,_0x3ede89){const _0x339caa=a232_0x31f2;if(_0x3ede89===undefined)_0x3ede89=_0x18e773;var _0x2ee5b9=Object[_0x339caa(0x13c)](_0x19d047,_0x18e773);(!_0x2ee5b9||(_0x339caa(0x160)in _0x2ee5b9?!_0x19d047['__esModule']:_0x2ee5b9[_0x339caa(0x182)]||_0x2ee5b9['configurable']))&&(_0x2ee5b9={'enumerable':!![],'get':function(){return _0x19d047[_0x18e773];}}),Object[_0x339caa(0x146)](_0x1c905a,_0x3ede89,_0x2ee5b9);}:function(_0x32afda,_0x482944,_0x2426ae,_0x49cda9){if(_0x49cda9===undefined)_0x49cda9=_0x2426ae;_0x32afda[_0x49cda9]=_0x482944[_0x2426ae];}),__setModuleDefault=this&&this[a232_0x31f2(0x17f)]||(Object['create']?function(_0x3e4759,_0x54ca76){const _0x5e5699=a232_0x31f2;Object['defineProperty'](_0x3e4759,_0x5e5699(0x18d),{'enumerable':!![],'value':_0x54ca76});}:function(_0x23597e,_0x34e5d9){const _0x49c05d=a232_0x31f2;_0x23597e[_0x49c05d(0x18d)]=_0x34e5d9;}),__decorate=this&&this[a232_0x31f2(0x16b)]||function(_0x39c329,_0xccbf65,_0x20e8b6,_0x11b7e5){const _0x5cfc82=a232_0x31f2;var _0x3f9cb4=arguments['length'],_0x24e09b=_0x3f9cb4<0x3?_0xccbf65:_0x11b7e5===null?_0x11b7e5=Object[_0x5cfc82(0x13c)](_0xccbf65,_0x20e8b6):_0x11b7e5,_0x34bd08;if(typeof Reflect===_0x5cfc82(0x154)&&typeof Reflect[_0x5cfc82(0x15c)]===_0x5cfc82(0x168))_0x24e09b=Reflect[_0x5cfc82(0x15c)](_0x39c329,_0xccbf65,_0x20e8b6,_0x11b7e5);else{for(var _0x1b5cb5=_0x39c329[_0x5cfc82(0x14c)]-0x1;_0x1b5cb5>=0x0;_0x1b5cb5--)if(_0x34bd08=_0x39c329[_0x1b5cb5])_0x24e09b=(_0x3f9cb4<0x3?_0x34bd08(_0x24e09b):_0x3f9cb4>0x3?_0x34bd08(_0xccbf65,_0x20e8b6,_0x24e09b):_0x34bd08(_0xccbf65,_0x20e8b6))||_0x24e09b;}return _0x3f9cb4>0x3&&_0x24e09b&&Object[_0x5cfc82(0x146)](_0xccbf65,_0x20e8b6,_0x24e09b),_0x24e09b;},__importStar=this&&this[a232_0x31f2(0x159)]||function(_0x40c5af){const _0x2fc911=a232_0x31f2;if(_0x40c5af&&_0x40c5af[_0x2fc911(0x17b)])return _0x40c5af;var _0x1b1f2d={};if(_0x40c5af!=null){for(var _0x581441 in _0x40c5af)if(_0x581441!==_0x2fc911(0x18d)&&Object['prototype']['hasOwnProperty'][_0x2fc911(0x165)](_0x40c5af,_0x581441))__createBinding(_0x1b1f2d,_0x40c5af,_0x581441);}return __setModuleDefault(_0x1b1f2d,_0x40c5af),_0x1b1f2d;},__metadata=this&&this[a232_0x31f2(0x181)]||function(_0x2305fd,_0x3e4d71){const _0x3b8870=a232_0x31f2;if(typeof Reflect===_0x3b8870(0x154)&&typeof Reflect['metadata']===_0x3b8870(0x168))return Reflect[_0x3b8870(0x18a)](_0x2305fd,_0x3e4d71);},__importDefault=this&&this['__importDefault']||function(_0x31ab07){const _0x4ac0d7=a232_0x31f2;return _0x31ab07&&_0x31ab07[_0x4ac0d7(0x17b)]?_0x31ab07:{'default':_0x31ab07};},SalesforceAuthService_1;function a232_0xc126(){const _0x52a3b4=['toString','2UtGYrh','then','11wWucGB','length','SALESFORCE_API_VERSION','2198133hAKZHg','Active','getAuthData','instanceUrl','update\x20access\x20token\x20failed:\x20%s','Service','object','updateAccessToken','5PEGTCS','../enums/auth-state.enum','application/json','__importStar','services/data/','/services/oauth2/token','decorate','../errors/unauthorized-salesforce.error','setAuthDetails','../errors/invalid-refresh-token.error','get','message','catch','../../../../core','token_type','call','Idle','create','function','153855KOWJuJ','Error','__decorate','data','../../providers/providers.tokens','apply','forceUpdateToken','access\x20token\x20updated\x20for\x20%s','name','accessToken','waitAuth','8KOATvl','Tokens','error','(((.+)+)+)+$','../../../../constants','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','InvalidRefreshTokenError','__esModule','requestConfig','2809350omeKhf','force\x20update\x20token','__setModuleDefault','1952256UaWofM','__metadata','writable','salesforce','Updating','typedi','design:paramtypes','292966UGmgCa','UnauthorizedSalesforceError','instance_url','metadata','ERR_INVALID_SALESFORCE_TOKEN','__createBinding','default','log','5945450OSZjoC','authState','access_token','AuthState','601892IatyqA','SalesforceAuthService','getOwnPropertyDescriptor','../../../../constants/errors','refresh_token','response','tokenType','AUTH_WAIT_TIME','constructor','create\x20authorized\x20request\x20failed:\x20authorization\x20error','search','logger','defineProperty','sleep'];a232_0xc126=function(){return _0x52a3b4;};return a232_0xc126();}Object[a232_0x31f2(0x146)](exports,a232_0x31f2(0x17b),{'value':!![]}),exports[a232_0x31f2(0x13b)]=void 0x0;const typedi_1=__importStar(require(a232_0x31f2(0x185))),errors_1=require(a232_0x31f2(0x13d)),core_1=require(a232_0x31f2(0x163)),axios_1=__importDefault(require('axios')),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a232_0x31f2(0x15f)),auth_state_enum_1=require(a232_0x31f2(0x157)),unauthorized_salesforce_error_1=require(a232_0x31f2(0x15d)),constants_1=require(a232_0x31f2(0x178)),providers_tokens_1=require(a232_0x31f2(0x16d));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x2fa538=a232_0x31f2;this['AUTH_WAIT_TIME']=0x1388,this[_0x2fa538(0x190)]=auth_state_enum_1[_0x2fa538(0x192)]['Idle'],this[_0x2fa538(0x145)]=new core_1['Logger'](SalesforceAuthService_1[_0x2fa538(0x171)]),this[_0x2fa538(0x15e)]();}async['setAuthDetails'](){const _0x2530e2=a232_0x31f2;this[_0x2530e2(0x145)]['log']('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this[_0x2530e2(0x190)]]);try{if(this[_0x2530e2(0x190)]===auth_state_enum_1[_0x2530e2(0x192)][_0x2530e2(0x16a)])return;if(this['authState']===auth_state_enum_1[_0x2530e2(0x192)][_0x2530e2(0x166)])await this['updateAccessToken']();else{const _0x42db31=await this['requestConfig'](),_0x499126=await axios_1['default'][_0x2530e2(0x160)](_0x2530e2(0x15a)+constants_1[_0x2530e2(0x14d)],_0x42db31)[_0x2530e2(0x14a)](()=>!![])[_0x2530e2(0x162)](()=>![]);!_0x499126&&await this[_0x2530e2(0x155)]();}}catch(_0x347317){}}async[a232_0x31f2(0x155)](){const _0x2b190b=a232_0x31f2;var _0x482cb6,_0x55dd5a,_0x3516d6;this[_0x2b190b(0x145)]['log']('update\x20access\x20token');try{this[_0x2b190b(0x190)]=auth_state_enum_1['AuthState'][_0x2b190b(0x184)];const {refreshToken:_0x386c91,clientId:_0xa407f4,clientSecret:_0x4884ae,loginUrl:_0x6810c3}=typedi_1[_0x2b190b(0x18d)][_0x2b190b(0x160)](providers_tokens_1[_0x2b190b(0x175)][_0x2b190b(0x183)]),{data:_0x5d74af}=await axios_1['default']['post']((0x0,utils_1['joinURL'])(_0x6810c3,_0x2b190b(0x15b)),null,{'params':{'grant_type':_0x2b190b(0x13e),'refresh_token':_0x386c91,'client_id':_0xa407f4,'client_secret':_0x4884ae}});this[_0x2b190b(0x151)]=_0x5d74af[_0x2b190b(0x189)],this[_0x2b190b(0x172)]=_0x5d74af[_0x2b190b(0x191)],this[_0x2b190b(0x140)]=_0x5d74af[_0x2b190b(0x164)],this[_0x2b190b(0x190)]=auth_state_enum_1[_0x2b190b(0x192)][_0x2b190b(0x14f)],this[_0x2b190b(0x145)][_0x2b190b(0x18e)](_0x2b190b(0x170),this[_0x2b190b(0x151)]);}catch(_0x52833f){const _0x4d8650=((_0x55dd5a=(_0x482cb6=_0x52833f===null||_0x52833f===void 0x0?void 0x0:_0x52833f[_0x2b190b(0x13f)])===null||_0x482cb6===void 0x0?void 0x0:_0x482cb6[_0x2b190b(0x16c)])===null||_0x55dd5a===void 0x0?void 0x0:_0x55dd5a[_0x2b190b(0x176)])||((_0x3516d6=_0x52833f===null||_0x52833f===void 0x0?void 0x0:_0x52833f['response'])===null||_0x3516d6===void 0x0?void 0x0:_0x3516d6[_0x2b190b(0x16c)])||_0x52833f[_0x2b190b(0x161)];this[_0x2b190b(0x145)]['error'](_0x2b190b(0x152),_0x4d8650),this[_0x2b190b(0x190)]=auth_state_enum_1['AuthState'][_0x2b190b(0x16a)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x2b190b(0x18b)]);}}async['forceUpdateToken'](){const _0x13e729=a232_0x31f2;this[_0x13e729(0x145)][_0x13e729(0x18e)](_0x13e729(0x17e));if(this['authState']===auth_state_enum_1[_0x13e729(0x192)][_0x13e729(0x184)]||this[_0x13e729(0x190)]===auth_state_enum_1[_0x13e729(0x192)][_0x13e729(0x166)])return await(0x0,utils_1[_0x13e729(0x147)])(this[_0x13e729(0x141)]),this[_0x13e729(0x16f)]();if(this[_0x13e729(0x190)]===auth_state_enum_1[_0x13e729(0x192)][_0x13e729(0x16a)])throw new invalid_refresh_token_error_1[(_0x13e729(0x17a))](errors_1[_0x13e729(0x18b)]);await this[_0x13e729(0x155)]();}async[a232_0x31f2(0x173)](){const _0x275aef=a232_0x31f2;if(this[_0x275aef(0x190)]===auth_state_enum_1[_0x275aef(0x192)]['Error']){this[_0x275aef(0x145)][_0x275aef(0x18e)](_0x275aef(0x143));throw new unauthorized_salesforce_error_1[(_0x275aef(0x188))]();}if(this[_0x275aef(0x190)]!==auth_state_enum_1[_0x275aef(0x192)][_0x275aef(0x14f)])return this[_0x275aef(0x145)][_0x275aef(0x18e)](_0x275aef(0x179)),await(0x0,utils_1['sleep'])(this[_0x275aef(0x141)]),this[_0x275aef(0x173)]();}[a232_0x31f2(0x150)](){const _0x165875=a232_0x31f2;return{'orgId':this['orgId'],'accessToken':this[_0x165875(0x172)],'instanceUrl':this[_0x165875(0x151)]};}async[a232_0x31f2(0x17c)](){const _0x408ec0=a232_0x31f2;return await this[_0x408ec0(0x173)](),{'baseURL':this[_0x408ec0(0x151)],'headers':{'accept':_0x408ec0(0x158),'authorization':this[_0x408ec0(0x140)]+'\x20'+this[_0x408ec0(0x172)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a232_0x31f2(0x153)])(),__metadata(a232_0x31f2(0x186),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;