const a193_0x249363=a193_0x8865;(function(_0x4a867d,_0x18108e){const _0x54a749=a193_0x8865,_0x3014bf=_0x4a867d();while(!![]){try{const _0x1b6096=parseInt(_0x54a749(0xd7))/0x1+parseInt(_0x54a749(0x115))/0x2*(-parseInt(_0x54a749(0xe3))/0x3)+parseInt(_0x54a749(0xca))/0x4+-parseInt(_0x54a749(0xf9))/0x5*(-parseInt(_0x54a749(0xd2))/0x6)+parseInt(_0x54a749(0xd0))/0x7+parseInt(_0x54a749(0xd3))/0x8+parseInt(_0x54a749(0xc8))/0x9*(-parseInt(_0x54a749(0xd4))/0xa);if(_0x1b6096===_0x18108e)break;else _0x3014bf['push'](_0x3014bf['shift']());}catch(_0x1e8c34){_0x3014bf['push'](_0x3014bf['shift']());}}}(a193_0x456d,0xa2e5b));const a193_0x424a61=(function(){let _0x12620b=!![];return function(_0x348f24,_0x16bc6b){const _0x509540=_0x12620b?function(){const _0x5d6710=a193_0x8865;if(_0x16bc6b){const _0x114848=_0x16bc6b[_0x5d6710(0xe5)](_0x348f24,arguments);return _0x16bc6b=null,_0x114848;}}:function(){};return _0x12620b=![],_0x509540;};}()),a193_0x5cd5f8=a193_0x424a61(this,function(){const _0x36aee0=a193_0x8865;return a193_0x5cd5f8['toString']()['search']('(((.+)+)+)+$')[_0x36aee0(0xf7)]()[_0x36aee0(0x10a)](a193_0x5cd5f8)['search'](_0x36aee0(0xf2));});function a193_0x8865(_0xf182b3,_0x5c1807){const _0x954d83=a193_0x456d();return a193_0x8865=function(_0x5cd5f8,_0x424a61){_0x5cd5f8=_0x5cd5f8-0xc7;let _0x456d32=_0x954d83[_0x5cd5f8];return _0x456d32;},a193_0x8865(_0xf182b3,_0x5c1807);}a193_0x5cd5f8();'use strict';var __createBinding=this&&this[a193_0x249363(0x107)]||(Object['create']?function(_0x2c1f33,_0xccfbe,_0x3812da,_0x44fc3e){const _0x5596ee=a193_0x249363;if(_0x44fc3e===undefined)_0x44fc3e=_0x3812da;var _0x2bb8e0=Object['getOwnPropertyDescriptor'](_0xccfbe,_0x3812da);(!_0x2bb8e0||(_0x5596ee(0xef)in _0x2bb8e0?!_0xccfbe[_0x5596ee(0xfd)]:_0x2bb8e0[_0x5596ee(0x101)]||_0x2bb8e0[_0x5596ee(0x112)]))&&(_0x2bb8e0={'enumerable':!![],'get':function(){return _0xccfbe[_0x3812da];}}),Object[_0x5596ee(0xe4)](_0x2c1f33,_0x44fc3e,_0x2bb8e0);}:function(_0x198c7e,_0x5a9a6c,_0x45970e,_0x309ad6){if(_0x309ad6===undefined)_0x309ad6=_0x45970e;_0x198c7e[_0x309ad6]=_0x5a9a6c[_0x45970e];}),__setModuleDefault=this&&this[a193_0x249363(0x109)]||(Object[a193_0x249363(0x11e)]?function(_0x468c51,_0x258b08){const _0x4228cc=a193_0x249363;Object[_0x4228cc(0xe4)](_0x468c51,_0x4228cc(0xfe),{'enumerable':!![],'value':_0x258b08});}:function(_0x53e7b9,_0xe13b0a){_0x53e7b9['default']=_0xe13b0a;}),__decorate=this&&this[a193_0x249363(0x111)]||function(_0x1c94e0,_0x4915fc,_0x1f4927,_0x5b3c02){const _0x1e3a3c=a193_0x249363;var _0x510d0f=arguments['length'],_0x25dd15=_0x510d0f<0x3?_0x4915fc:_0x5b3c02===null?_0x5b3c02=Object[_0x1e3a3c(0x11c)](_0x4915fc,_0x1f4927):_0x5b3c02,_0x348352;if(typeof Reflect===_0x1e3a3c(0xee)&&typeof Reflect[_0x1e3a3c(0x102)]===_0x1e3a3c(0xe6))_0x25dd15=Reflect['decorate'](_0x1c94e0,_0x4915fc,_0x1f4927,_0x5b3c02);else{for(var _0x156938=_0x1c94e0['length']-0x1;_0x156938>=0x0;_0x156938--)if(_0x348352=_0x1c94e0[_0x156938])_0x25dd15=(_0x510d0f<0x3?_0x348352(_0x25dd15):_0x510d0f>0x3?_0x348352(_0x4915fc,_0x1f4927,_0x25dd15):_0x348352(_0x4915fc,_0x1f4927))||_0x25dd15;}return _0x510d0f>0x3&&_0x25dd15&&Object[_0x1e3a3c(0xe4)](_0x4915fc,_0x1f4927,_0x25dd15),_0x25dd15;},__importStar=this&&this[a193_0x249363(0x108)]||function(_0x438809){const _0x2ed037=a193_0x249363;if(_0x438809&&_0x438809[_0x2ed037(0xfd)])return _0x438809;var _0x2edeef={};if(_0x438809!=null){for(var _0x3f9e23 in _0x438809)if(_0x3f9e23!==_0x2ed037(0xfe)&&Object[_0x2ed037(0xf5)][_0x2ed037(0xe8)]['call'](_0x438809,_0x3f9e23))__createBinding(_0x2edeef,_0x438809,_0x3f9e23);}return __setModuleDefault(_0x2edeef,_0x438809),_0x2edeef;},__metadata=this&&this[a193_0x249363(0xfb)]||function(_0x3400d6,_0x4a7ef4){const _0x4a3bed=a193_0x249363;if(typeof Reflect===_0x4a3bed(0xee)&&typeof Reflect[_0x4a3bed(0x11d)]===_0x4a3bed(0xe6))return Reflect[_0x4a3bed(0x11d)](_0x3400d6,_0x4a7ef4);},__importDefault=this&&this[a193_0x249363(0xc7)]||function(_0x51ca57){const _0x19b83f=a193_0x249363;return _0x51ca57&&_0x51ca57[_0x19b83f(0xfd)]?_0x51ca57:{'default':_0x51ca57};},SalesforceAuthService_1;Object['defineProperty'](exports,a193_0x249363(0xfd),{'value':!![]}),exports[a193_0x249363(0x118)]=void 0x0;const typedi_1=__importStar(require(a193_0x249363(0xfc))),errors_1=require(a193_0x249363(0xd6)),core_1=require(a193_0x249363(0xcc)),axios_1=__importDefault(require(a193_0x249363(0xdc))),utils_1=require(a193_0x249363(0x106)),invalid_refresh_token_error_1=require(a193_0x249363(0xe2)),auth_state_enum_1=require(a193_0x249363(0xf0)),unauthorized_salesforce_error_1=require(a193_0x249363(0xd1)),constants_1=require(a193_0x249363(0xda)),providers_tokens_1=require(a193_0x249363(0xf4));function a193_0x456d(){const _0x3f2892=['log','error','../../../../constants','force\x20update\x20token','axios','tokenType','requestConfig','create\x20authorized\x20request\x20failed:\x20authorization\x20error','Service','UnauthorizedSalesforceError','../errors/invalid-refresh-token.error','3jWYKEU','defineProperty','apply','function','refresh_token','hasOwnProperty','joinURL','getAuthData','sleep','token_type','instanceUrl','object','get','../enums/auth-state.enum','AuthState','(((.+)+)+)+$','/services/oauth2/token','../../providers/providers.tokens','prototype','ERR_INVALID_SALESFORCE_TOKEN','toString','Error','1611505oGJpqH','response','__metadata','typedi','__esModule','default','access\x20token\x20updated\x20for\x20%s','logger','writable','decorate','services/data/','data','authState','../../../shared/utils','__createBinding','__importStar','__setModuleDefault','constructor','message','Logger','update\x20access\x20token\x20failed:\x20%s','catch','application/json','Active','__decorate','configurable','InvalidRefreshTokenError','Idle','2051078WqoXxS','AUTH_WAIT_TIME','design:paramtypes','SalesforceAuthService','accessToken','instance_url','Tokens','getOwnPropertyDescriptor','metadata','create','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','__importDefault','351WrPJDj','Updating','56572krnrlR','then','../../../../core','salesforce','check\x20auth:\x20current\x20state\x20-\x20%s','waitAuth','8127126ZfRbsC','../errors/unauthorized-salesforce.error','6wVYMsZ','8835936JaoLEN','253490bzpdRW','updateAccessToken','../../../../constants/errors','79423YTtUdZ'];a193_0x456d=function(){return _0x3f2892;};return a193_0x456d();}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x25b8ee=a193_0x249363;this[_0x25b8ee(0x116)]=0x1388,this['authState']=auth_state_enum_1[_0x25b8ee(0xf1)][_0x25b8ee(0x114)],this['logger']=new core_1[(_0x25b8ee(0x10c))](SalesforceAuthService_1['name']),this['setAuthDetails']();}async['setAuthDetails'](){const _0x3a0162=a193_0x249363;this[_0x3a0162(0x100)]['log'](_0x3a0162(0xce),auth_state_enum_1[_0x3a0162(0xf1)][this[_0x3a0162(0x105)]]);try{if(this[_0x3a0162(0x105)]===auth_state_enum_1[_0x3a0162(0xf1)][_0x3a0162(0xf8)])return;if(this[_0x3a0162(0x105)]===auth_state_enum_1['AuthState'][_0x3a0162(0x114)])await this[_0x3a0162(0xd5)]();else{const _0x5eb49f=await this['requestConfig'](),_0x22eda7=await axios_1['default'][_0x3a0162(0xef)](_0x3a0162(0x103)+constants_1['SALESFORCE_API_VERSION'],_0x5eb49f)[_0x3a0162(0xcb)](()=>!![])[_0x3a0162(0x10e)](()=>![]);!_0x22eda7&&await this[_0x3a0162(0xd5)]();}}catch(_0x55f1e8){}}async[a193_0x249363(0xd5)](){const _0x52d938=a193_0x249363;var _0x3f8b5f,_0x157f77,_0x256ce6;this[_0x52d938(0x100)][_0x52d938(0xd8)]('update\x20access\x20token');try{this[_0x52d938(0x105)]=auth_state_enum_1['AuthState'][_0x52d938(0xc9)];const {refreshToken:_0x592144,clientId:_0x11cecc,clientSecret:_0x4f563f,loginUrl:_0x2566dc}=typedi_1[_0x52d938(0xfe)][_0x52d938(0xef)](providers_tokens_1[_0x52d938(0x11b)][_0x52d938(0xcd)]),{data:_0x51e34b}=await axios_1[_0x52d938(0xfe)]['post']((0x0,utils_1[_0x52d938(0xe9)])(_0x2566dc,_0x52d938(0xf3)),null,{'params':{'grant_type':_0x52d938(0xe7),'refresh_token':_0x592144,'client_id':_0x11cecc,'client_secret':_0x4f563f}});this[_0x52d938(0xed)]=_0x51e34b[_0x52d938(0x11a)],this['accessToken']=_0x51e34b['access_token'],this[_0x52d938(0xdd)]=_0x51e34b[_0x52d938(0xec)],this[_0x52d938(0x105)]=auth_state_enum_1[_0x52d938(0xf1)][_0x52d938(0x110)],this[_0x52d938(0x100)][_0x52d938(0xd8)](_0x52d938(0xff),this[_0x52d938(0xed)]);}catch(_0x4f4297){const _0x404a12=((_0x157f77=(_0x3f8b5f=_0x4f4297===null||_0x4f4297===void 0x0?void 0x0:_0x4f4297[_0x52d938(0xfa)])===null||_0x3f8b5f===void 0x0?void 0x0:_0x3f8b5f[_0x52d938(0x104)])===null||_0x157f77===void 0x0?void 0x0:_0x157f77[_0x52d938(0xd9)])||((_0x256ce6=_0x4f4297===null||_0x4f4297===void 0x0?void 0x0:_0x4f4297[_0x52d938(0xfa)])===null||_0x256ce6===void 0x0?void 0x0:_0x256ce6[_0x52d938(0x104)])||_0x4f4297[_0x52d938(0x10b)];this[_0x52d938(0x100)]['error'](_0x52d938(0x10d),_0x404a12),this['authState']=auth_state_enum_1[_0x52d938(0xf1)][_0x52d938(0xf8)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x52d938(0xf6)]);}}async['forceUpdateToken'](){const _0x3f16c2=a193_0x249363;this[_0x3f16c2(0x100)][_0x3f16c2(0xd8)](_0x3f16c2(0xdb));if(this[_0x3f16c2(0x105)]===auth_state_enum_1[_0x3f16c2(0xf1)]['Updating']||this[_0x3f16c2(0x105)]===auth_state_enum_1[_0x3f16c2(0xf1)][_0x3f16c2(0x114)])return await(0x0,utils_1[_0x3f16c2(0xeb)])(this[_0x3f16c2(0x116)]),this['forceUpdateToken']();if(this['authState']===auth_state_enum_1['AuthState'][_0x3f16c2(0xf8)])throw new invalid_refresh_token_error_1[(_0x3f16c2(0x113))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x3f16c2(0xd5)]();}async[a193_0x249363(0xcf)](){const _0x3d578d=a193_0x249363;if(this[_0x3d578d(0x105)]===auth_state_enum_1[_0x3d578d(0xf1)][_0x3d578d(0xf8)]){this[_0x3d578d(0x100)][_0x3d578d(0xd8)](_0x3d578d(0xdf));throw new unauthorized_salesforce_error_1[(_0x3d578d(0xe1))]();}if(this[_0x3d578d(0x105)]!==auth_state_enum_1['AuthState'][_0x3d578d(0x110)])return this[_0x3d578d(0x100)]['log'](_0x3d578d(0x11f)),await(0x0,utils_1[_0x3d578d(0xeb)])(this[_0x3d578d(0x116)]),this[_0x3d578d(0xcf)]();}[a193_0x249363(0xea)](){const _0x3a2fe3=a193_0x249363;return{'orgId':this['orgId'],'accessToken':this[_0x3a2fe3(0x119)],'instanceUrl':this[_0x3a2fe3(0xed)]};}async[a193_0x249363(0xde)](){const _0x5854f4=a193_0x249363;return await this[_0x5854f4(0xcf)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x5854f4(0x10f),'authorization':this[_0x5854f4(0xdd)]+'\x20'+this[_0x5854f4(0x119)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a193_0x249363(0xe0)])(),__metadata(a193_0x249363(0x117),[])],SalesforceAuthService),exports[a193_0x249363(0x118)]=SalesforceAuthService;