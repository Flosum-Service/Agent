const a270_0x2d5780=a270_0x4868;function a270_0x8e2a(){const _0x12198d=['Active','31144qmVJkw','authorization','then','@flosum/salesforce','design:paramtypes','error','19351TYMLzl','11PojNER','typedi','instanceUrl','12IIeEcO','../enums/auth-state.enum','search','refresh_token','instance_url','<met:sessionId>','forceUpdateToken','8xRNFEY','AuthState','hasOwnProperty','SALESFORCE_API_VERSION','../errors/unauthorized-salesforce.error','Force\x20update\x20token','decorate','setAuthDetails','apply','authState','length','../../../shared/utils','default','function','20062116hKdxOU','SalesforceAuthService','../../../../core','axios','constructor','isSoapUrl','__setModuleDefault','(((.+)+)+)+$','tokenType','Error','72JztHrZ','logger','Update\x20access\x20token','1423120MFdotL','toString','UnauthorizedSalesforceError','headers','3483858thlCsm','Check\x20auth:\x20current\x20state\x20-\x20%s','SalesforceUtils','requestConfig','sleep','getAuthData','AUTH_WAIT_TIME','object','Tokens','post','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','/services/oauth2/token','accessToken','get','Logger','../../../../constants','replace','763935DgKItu','Idle','waitAuth','InvalidRefreshTokenError','orgId','updateAccessToken','name','ERR_INVALID_SALESFORCE_TOKEN','</met:sessionId>','application/json','52kGptTX','Update\x20access\x20token\x20failed:\x20%s','defineProperty','1421082IONCxH','message','joinURL','__metadata','log','Service','Access\x20token\x20updated\x20for\x20%s','writable','isBulk1Url','token_type','response','__esModule','catch','getOwnPropertyDescriptor','create','__decorate'];a270_0x8e2a=function(){return _0x12198d;};return a270_0x8e2a();}(function(_0x55036c,_0x9db6f8){const _0x5f5586=a270_0x4868,_0x27de65=_0x55036c();while(!![]){try{const _0x43cd84=parseInt(_0x5f5586(0x1d4))/0x1*(-parseInt(_0x5f5586(0x1ba))/0x2)+-parseInt(_0x5f5586(0x198))/0x3*(-parseInt(_0x5f5586(0x1ce))/0x4)+parseInt(_0x5f5586(0x1b0))/0x5*(-parseInt(_0x5f5586(0x1d8))/0x6)+-parseInt(_0x5f5586(0x19f))/0x7*(parseInt(_0x5f5586(0x180))/0x8)+-parseInt(_0x5f5586(0x1bd))/0x9+-parseInt(_0x5f5586(0x19b))/0xa+parseInt(_0x5f5586(0x1d5))/0xb*(parseInt(_0x5f5586(0x18e))/0xc);if(_0x43cd84===_0x9db6f8)break;else _0x27de65['push'](_0x27de65['shift']());}catch(_0x2dec13){_0x27de65['push'](_0x27de65['shift']());}}}(a270_0x8e2a,0x3d8c7));const a270_0x455fd5=(function(){let _0x5d2700=!![];return function(_0x44a2df,_0x2636c9){const _0x2b1c02=_0x5d2700?function(){const _0xf1bbdc=a270_0x4868;if(_0x2636c9){const _0x5728a1=_0x2636c9[_0xf1bbdc(0x188)](_0x44a2df,arguments);return _0x2636c9=null,_0x5728a1;}}:function(){};return _0x5d2700=![],_0x2b1c02;};}()),a270_0x6269e5=a270_0x455fd5(this,function(){const _0x47645=a270_0x4868;return a270_0x6269e5[_0x47645(0x19c)]()[_0x47645(0x1da)](_0x47645(0x195))[_0x47645(0x19c)]()[_0x47645(0x192)](a270_0x6269e5)[_0x47645(0x1da)](_0x47645(0x195));});a270_0x6269e5();'use strict';function a270_0x4868(_0x1204ba,_0x23bee1){const _0x4e973e=a270_0x8e2a();return a270_0x4868=function(_0x6269e5,_0x455fd5){_0x6269e5=_0x6269e5-0x17c;let _0x8e2a15=_0x4e973e[_0x6269e5];return _0x8e2a15;},a270_0x4868(_0x1204ba,_0x23bee1);}var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x25f65a,_0x5d91f6,_0x503691,_0x45b9a4){const _0x221445=a270_0x4868;if(_0x45b9a4===undefined)_0x45b9a4=_0x503691;var _0x5b9772=Object['getOwnPropertyDescriptor'](_0x5d91f6,_0x503691);(!_0x5b9772||(_0x221445(0x1ac)in _0x5b9772?!_0x5d91f6[_0x221445(0x1c8)]:_0x5b9772[_0x221445(0x1c4)]||_0x5b9772['configurable']))&&(_0x5b9772={'enumerable':!![],'get':function(){return _0x5d91f6[_0x503691];}}),Object[_0x221445(0x1bc)](_0x25f65a,_0x45b9a4,_0x5b9772);}:function(_0xf48eb2,_0x4e04a8,_0xceadfc,_0x48a7ed){if(_0x48a7ed===undefined)_0x48a7ed=_0xceadfc;_0xf48eb2[_0x48a7ed]=_0x4e04a8[_0xceadfc];}),__setModuleDefault=this&&this[a270_0x2d5780(0x194)]||(Object[a270_0x2d5780(0x1cb)]?function(_0x2de7c6,_0x5e0d79){const _0x542ace=a270_0x2d5780;Object[_0x542ace(0x1bc)](_0x2de7c6,_0x542ace(0x18c),{'enumerable':!![],'value':_0x5e0d79});}:function(_0xb13fda,_0x1040af){const _0x342124=a270_0x2d5780;_0xb13fda[_0x342124(0x18c)]=_0x1040af;}),__decorate=this&&this[a270_0x2d5780(0x1cc)]||function(_0x1c3965,_0xd92d2d,_0x10800f,_0x1fba85){const _0x5e9a79=a270_0x2d5780;var _0x317c90=arguments[_0x5e9a79(0x18a)],_0x19e245=_0x317c90<0x3?_0xd92d2d:_0x1fba85===null?_0x1fba85=Object[_0x5e9a79(0x1ca)](_0xd92d2d,_0x10800f):_0x1fba85,_0x10e831;if(typeof Reflect===_0x5e9a79(0x1a6)&&typeof Reflect[_0x5e9a79(0x186)]===_0x5e9a79(0x18d))_0x19e245=Reflect[_0x5e9a79(0x186)](_0x1c3965,_0xd92d2d,_0x10800f,_0x1fba85);else{for(var _0x1a57cb=_0x1c3965[_0x5e9a79(0x18a)]-0x1;_0x1a57cb>=0x0;_0x1a57cb--)if(_0x10e831=_0x1c3965[_0x1a57cb])_0x19e245=(_0x317c90<0x3?_0x10e831(_0x19e245):_0x317c90>0x3?_0x10e831(_0xd92d2d,_0x10800f,_0x19e245):_0x10e831(_0xd92d2d,_0x10800f))||_0x19e245;}return _0x317c90>0x3&&_0x19e245&&Object[_0x5e9a79(0x1bc)](_0xd92d2d,_0x10800f,_0x19e245),_0x19e245;},__importStar=this&&this['__importStar']||function(_0x3693da){const _0x47d1df=a270_0x2d5780;if(_0x3693da&&_0x3693da[_0x47d1df(0x1c8)])return _0x3693da;var _0x2ec51f={};if(_0x3693da!=null){for(var _0x5951ee in _0x3693da)if(_0x5951ee!==_0x47d1df(0x18c)&&Object['prototype'][_0x47d1df(0x182)]['call'](_0x3693da,_0x5951ee))__createBinding(_0x2ec51f,_0x3693da,_0x5951ee);}return __setModuleDefault(_0x2ec51f,_0x3693da),_0x2ec51f;},__metadata=this&&this[a270_0x2d5780(0x1c0)]||function(_0x2b1b06,_0x2813fe){const _0x431b52=a270_0x2d5780;if(typeof Reflect===_0x431b52(0x1a6)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x2b1b06,_0x2813fe);},__importDefault=this&&this['__importDefault']||function(_0xfe732f){const _0x5dd4c5=a270_0x2d5780;return _0xfe732f&&_0xfe732f[_0x5dd4c5(0x1c8)]?_0xfe732f:{'default':_0xfe732f};},SalesforceAuthService_1;Object[a270_0x2d5780(0x1bc)](exports,'__esModule',{'value':!![]}),exports[a270_0x2d5780(0x18f)]=void 0x0;const typedi_1=__importStar(require(a270_0x2d5780(0x1d6))),errors_1=require('../../../../constants/errors'),core_1=require(a270_0x2d5780(0x190)),axios_1=__importDefault(require(a270_0x2d5780(0x191))),utils_1=require(a270_0x2d5780(0x18b)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a270_0x2d5780(0x1d9)),unauthorized_salesforce_error_1=require(a270_0x2d5780(0x184)),constants_1=require(a270_0x2d5780(0x1ae)),providers_tokens_1=require('../../providers/providers.tokens'),salesforce_1=require(a270_0x2d5780(0x1d1));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0xfc0082=a270_0x2d5780;this[_0xfc0082(0x1a5)]=0x1388,this[_0xfc0082(0x189)]=auth_state_enum_1[_0xfc0082(0x181)]['Idle'],this[_0xfc0082(0x199)]=new core_1[(_0xfc0082(0x1ad))](SalesforceAuthService_1[_0xfc0082(0x1b6)]),this[_0xfc0082(0x187)]();}async['setAuthDetails'](){const _0x5699c1=a270_0x2d5780;this['logger'][_0x5699c1(0x1c1)](_0x5699c1(0x1a0),auth_state_enum_1['AuthState'][this[_0x5699c1(0x189)]]);try{if(this['authState']===auth_state_enum_1[_0x5699c1(0x181)][_0x5699c1(0x197)])return;if(this[_0x5699c1(0x189)]===auth_state_enum_1['AuthState'][_0x5699c1(0x1b1)])await this[_0x5699c1(0x1b5)]();else{const _0x55c82d=await this[_0x5699c1(0x1a2)](),_0x24a672=await axios_1[_0x5699c1(0x18c)]['get']('services/data/'+constants_1[_0x5699c1(0x183)],_0x55c82d)[_0x5699c1(0x1d0)](()=>!![])[_0x5699c1(0x1c9)](()=>![]);!_0x24a672&&await this[_0x5699c1(0x1b5)]();}}catch(_0x3d0584){}}async['updateAccessToken'](){const _0x1b8783=a270_0x2d5780;var _0x5acbe9,_0x2a9efd,_0x457080;this[_0x1b8783(0x199)][_0x1b8783(0x1c1)](_0x1b8783(0x19a));try{this[_0x1b8783(0x189)]=auth_state_enum_1[_0x1b8783(0x181)]['Updating'];const {refreshToken:_0x15d7ed,clientId:_0x436a1a,clientSecret:_0x43ac4b,loginUrl:_0x1a9a4e}=typedi_1[_0x1b8783(0x18c)][_0x1b8783(0x1ac)](providers_tokens_1[_0x1b8783(0x1a7)]['salesforce']),{data:_0x2e4c3b}=await axios_1['default'][_0x1b8783(0x1a8)]((0x0,utils_1[_0x1b8783(0x1bf)])(_0x1a9a4e,_0x1b8783(0x1aa)),null,{'params':{'grant_type':_0x1b8783(0x17c),'refresh_token':_0x15d7ed,'client_id':_0x436a1a,'client_secret':_0x43ac4b}});this[_0x1b8783(0x1d7)]=_0x2e4c3b[_0x1b8783(0x17d)],this[_0x1b8783(0x1ab)]=_0x2e4c3b['access_token'],this[_0x1b8783(0x196)]=_0x2e4c3b[_0x1b8783(0x1c6)],this['authState']=auth_state_enum_1[_0x1b8783(0x181)]['Active'],this['logger']['log'](_0x1b8783(0x1c3),this[_0x1b8783(0x1d7)]);}catch(_0x1ac9ee){const _0x186e3d=((_0x2a9efd=(_0x5acbe9=_0x1ac9ee===null||_0x1ac9ee===void 0x0?void 0x0:_0x1ac9ee[_0x1b8783(0x1c7)])===null||_0x5acbe9===void 0x0?void 0x0:_0x5acbe9['data'])===null||_0x2a9efd===void 0x0?void 0x0:_0x2a9efd[_0x1b8783(0x1d3)])||((_0x457080=_0x1ac9ee===null||_0x1ac9ee===void 0x0?void 0x0:_0x1ac9ee['response'])===null||_0x457080===void 0x0?void 0x0:_0x457080['data'])||_0x1ac9ee[_0x1b8783(0x1be)];this['logger'][_0x1b8783(0x1d3)](_0x1b8783(0x1bb),_0x186e3d),this[_0x1b8783(0x189)]=auth_state_enum_1[_0x1b8783(0x181)][_0x1b8783(0x197)];throw new invalid_refresh_token_error_1[(_0x1b8783(0x1b3))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a270_0x2d5780(0x17f)](){const _0x57f300=a270_0x2d5780;this['logger'][_0x57f300(0x1c1)](_0x57f300(0x185));if(this[_0x57f300(0x189)]===auth_state_enum_1['AuthState']['Updating']||this[_0x57f300(0x189)]===auth_state_enum_1['AuthState'][_0x57f300(0x1b1)])return await(0x0,utils_1[_0x57f300(0x1a3)])(this[_0x57f300(0x1a5)]),this[_0x57f300(0x17f)]();if(this[_0x57f300(0x189)]===auth_state_enum_1[_0x57f300(0x181)][_0x57f300(0x197)])throw new invalid_refresh_token_error_1[(_0x57f300(0x1b3))](errors_1[_0x57f300(0x1b7)]);await this[_0x57f300(0x1b5)]();}async['waitAuth'](){const _0x2a1e50=a270_0x2d5780;if(this[_0x2a1e50(0x189)]===auth_state_enum_1[_0x2a1e50(0x181)]['Error']){this['logger'][_0x2a1e50(0x1c1)](_0x2a1e50(0x1a9));throw new unauthorized_salesforce_error_1[(_0x2a1e50(0x19d))]();}if(this[_0x2a1e50(0x189)]!==auth_state_enum_1['AuthState'][_0x2a1e50(0x1cd)])return this['logger'][_0x2a1e50(0x1c1)]('Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x2a1e50(0x1a3)])(this[_0x2a1e50(0x1a5)]),this[_0x2a1e50(0x1b2)]();}[a270_0x2d5780(0x1a4)](){const _0x5b1a66=a270_0x2d5780;return{'orgId':this[_0x5b1a66(0x1b4)],'accessToken':this[_0x5b1a66(0x1ab)],'instanceUrl':this['instanceUrl']};}async[a270_0x2d5780(0x1a2)](_0x31163d=''){const _0x36e9bf=a270_0x2d5780;await this[_0x36e9bf(0x1b2)]();const _0x185b02={'baseURL':this[_0x36e9bf(0x1d7)],'headers':{'accept':_0x36e9bf(0x1b9)}};if(salesforce_1[_0x36e9bf(0x1a1)][_0x36e9bf(0x1c5)](_0x31163d))_0x185b02[_0x36e9bf(0x19e)]['X-SFDC-Session']=this[_0x36e9bf(0x1ab)];else salesforce_1[_0x36e9bf(0x1a1)][_0x36e9bf(0x193)](_0x31163d)?_0x185b02['data']=_0x185b02['data'][_0x36e9bf(0x1af)](/<met:sessionId>.+?<\/met:sessionId>/,_0x36e9bf(0x17e)+this[_0x36e9bf(0x1ab)]+_0x36e9bf(0x1b8)):_0x185b02[_0x36e9bf(0x19e)][_0x36e9bf(0x1cf)]=this[_0x36e9bf(0x196)]+'\x20'+this[_0x36e9bf(0x1ab)];return _0x185b02;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a270_0x2d5780(0x1c2)])(),__metadata(a270_0x2d5780(0x1d2),[])],SalesforceAuthService),exports[a270_0x2d5780(0x18f)]=SalesforceAuthService;