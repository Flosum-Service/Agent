const a193_0x3e9d83=a193_0x428a;(function(_0x28d2c7,_0x2f11fd){const _0x1e1da5=a193_0x428a,_0x36b8fe=_0x28d2c7();while(!![]){try{const _0x5b8d63=-parseInt(_0x1e1da5(0x140))/0x1*(-parseInt(_0x1e1da5(0x105))/0x2)+-parseInt(_0x1e1da5(0x117))/0x3*(parseInt(_0x1e1da5(0x123))/0x4)+parseInt(_0x1e1da5(0x128))/0x5*(parseInt(_0x1e1da5(0x13b))/0x6)+-parseInt(_0x1e1da5(0x132))/0x7+-parseInt(_0x1e1da5(0xf6))/0x8*(parseInt(_0x1e1da5(0x147))/0x9)+parseInt(_0x1e1da5(0x119))/0xa+parseInt(_0x1e1da5(0x144))/0xb*(-parseInt(_0x1e1da5(0x110))/0xc);if(_0x5b8d63===_0x2f11fd)break;else _0x36b8fe['push'](_0x36b8fe['shift']());}catch(_0x88976){_0x36b8fe['push'](_0x36b8fe['shift']());}}}(a193_0x111b,0xc1931));function a193_0x111b(){const _0x11c4a4=['110UMjitu','logger','authState','1476qEhJGm','../enums/auth-state.enum','forceUpdateToken','../../../shared/utils','then','../errors/invalid-refresh-token.error','SalesforceAuthService','apply','21968TnCpaE','../../providers/providers.tokens','application/json','metadata','../../../../core','updateAccessToken','__decorate','length','configurable','getAuthData','tokenType','catch','constructor','update\x20access\x20token\x20failed:\x20%s','sleep','272806pBkQhu','decorate','AuthState','(((.+)+)+)+$','toString','token_type','function','Logger','__metadata','access\x20token\x20updated\x20for\x20%s','joinURL','1261068tVbqmK','Updating','check\x20auth:\x20current\x20state\x20-\x20%s','__setModuleDefault','/services/oauth2/token','../../../../constants','error','771lHTwFM','instanceUrl','12661170mcghQs','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','ERR_INVALID_SALESFORCE_TOKEN','log','__esModule','get','call','response','axios','Error','16888EZGAGh','access_token','Idle','setAuthDetails','defineProperty','272145XQyFaO','__importDefault','SALESFORCE_API_VERSION','UnauthorizedSalesforceError','create','object','refresh_token','name','__createBinding','services/data/','4089106KynZXN','default','../../../../constants/errors','__importStar','design:paramtypes','search','Tokens','InvalidRefreshTokenError','writable','162udPmxU','AUTH_WAIT_TIME','data','hasOwnProperty','requestConfig','9JoHfEe','prototype','salesforce','waitAuth'];a193_0x111b=function(){return _0x11c4a4;};return a193_0x111b();}const a193_0x46d1d1=(function(){let _0xf7b47d=!![];return function(_0x39def0,_0x44a17d){const _0x251ddc=_0xf7b47d?function(){const _0x51995d=a193_0x428a;if(_0x44a17d){const _0xe4dde1=_0x44a17d[_0x51995d(0xf5)](_0x39def0,arguments);return _0x44a17d=null,_0xe4dde1;}}:function(){};return _0xf7b47d=![],_0x251ddc;};}()),a193_0x175892=a193_0x46d1d1(this,function(){const _0x2d39b4=a193_0x428a;return a193_0x175892[_0x2d39b4(0x109)]()[_0x2d39b4(0x137)](_0x2d39b4(0x108))[_0x2d39b4(0x109)]()[_0x2d39b4(0x102)](a193_0x175892)[_0x2d39b4(0x137)](_0x2d39b4(0x108));});a193_0x175892();'use strict';var __createBinding=this&&this[a193_0x3e9d83(0x130)]||(Object[a193_0x3e9d83(0x12c)]?function(_0x4ddc31,_0x34e21a,_0x2edad9,_0x4a6460){const _0x34e883=a193_0x3e9d83;if(_0x4a6460===undefined)_0x4a6460=_0x2edad9;var _0x2732e9=Object['getOwnPropertyDescriptor'](_0x34e21a,_0x2edad9);(!_0x2732e9||(_0x34e883(0x11e)in _0x2732e9?!_0x34e21a[_0x34e883(0x11d)]:_0x2732e9[_0x34e883(0x13a)]||_0x2732e9[_0x34e883(0xfe)]))&&(_0x2732e9={'enumerable':!![],'get':function(){return _0x34e21a[_0x2edad9];}}),Object[_0x34e883(0x127)](_0x4ddc31,_0x4a6460,_0x2732e9);}:function(_0x594576,_0x317d6d,_0x4dc275,_0x501656){if(_0x501656===undefined)_0x501656=_0x4dc275;_0x594576[_0x501656]=_0x317d6d[_0x4dc275];}),__setModuleDefault=this&&this[a193_0x3e9d83(0x113)]||(Object[a193_0x3e9d83(0x12c)]?function(_0x2bbb46,_0x47a356){const _0x11c422=a193_0x3e9d83;Object[_0x11c422(0x127)](_0x2bbb46,'default',{'enumerable':!![],'value':_0x47a356});}:function(_0x47c307,_0x289741){const _0x22650a=a193_0x3e9d83;_0x47c307[_0x22650a(0x133)]=_0x289741;}),__decorate=this&&this[a193_0x3e9d83(0xfc)]||function(_0x5aeea2,_0x34f087,_0x2319a1,_0x1345d8){const _0x3e17a6=a193_0x3e9d83;var _0x58f2c3=arguments[_0x3e17a6(0xfd)],_0x2d63eb=_0x58f2c3<0x3?_0x34f087:_0x1345d8===null?_0x1345d8=Object['getOwnPropertyDescriptor'](_0x34f087,_0x2319a1):_0x1345d8,_0x27808b;if(typeof Reflect===_0x3e17a6(0x12d)&&typeof Reflect[_0x3e17a6(0x106)]===_0x3e17a6(0x10b))_0x2d63eb=Reflect[_0x3e17a6(0x106)](_0x5aeea2,_0x34f087,_0x2319a1,_0x1345d8);else{for(var _0xa3c5c2=_0x5aeea2[_0x3e17a6(0xfd)]-0x1;_0xa3c5c2>=0x0;_0xa3c5c2--)if(_0x27808b=_0x5aeea2[_0xa3c5c2])_0x2d63eb=(_0x58f2c3<0x3?_0x27808b(_0x2d63eb):_0x58f2c3>0x3?_0x27808b(_0x34f087,_0x2319a1,_0x2d63eb):_0x27808b(_0x34f087,_0x2319a1))||_0x2d63eb;}return _0x58f2c3>0x3&&_0x2d63eb&&Object['defineProperty'](_0x34f087,_0x2319a1,_0x2d63eb),_0x2d63eb;},__importStar=this&&this[a193_0x3e9d83(0x135)]||function(_0x478607){const _0x276cbf=a193_0x3e9d83;if(_0x478607&&_0x478607[_0x276cbf(0x11d)])return _0x478607;var _0x212030={};if(_0x478607!=null){for(var _0x56382c in _0x478607)if(_0x56382c!=='default'&&Object[_0x276cbf(0x141)][_0x276cbf(0x13e)][_0x276cbf(0x11f)](_0x478607,_0x56382c))__createBinding(_0x212030,_0x478607,_0x56382c);}return __setModuleDefault(_0x212030,_0x478607),_0x212030;},__metadata=this&&this[a193_0x3e9d83(0x10d)]||function(_0x1d469f,_0x173618){const _0x5d1794=a193_0x3e9d83;if(typeof Reflect===_0x5d1794(0x12d)&&typeof Reflect[_0x5d1794(0xf9)]===_0x5d1794(0x10b))return Reflect[_0x5d1794(0xf9)](_0x1d469f,_0x173618);},__importDefault=this&&this[a193_0x3e9d83(0x129)]||function(_0x1e8212){const _0x4223c5=a193_0x3e9d83;return _0x1e8212&&_0x1e8212[_0x4223c5(0x11d)]?_0x1e8212:{'default':_0x1e8212};},SalesforceAuthService_1;Object[a193_0x3e9d83(0x127)](exports,'__esModule',{'value':!![]}),exports[a193_0x3e9d83(0xf4)]=void 0x0;function a193_0x428a(_0x47f433,_0x9dc5d){const _0x2717a1=a193_0x111b();return a193_0x428a=function(_0x175892,_0x46d1d1){_0x175892=_0x175892-0xf2;let _0x111b9b=_0x2717a1[_0x175892];return _0x111b9b;},a193_0x428a(_0x47f433,_0x9dc5d);}const typedi_1=__importStar(require('typedi')),errors_1=require(a193_0x3e9d83(0x134)),core_1=require(a193_0x3e9d83(0xfa)),axios_1=__importDefault(require(a193_0x3e9d83(0x121))),utils_1=require(a193_0x3e9d83(0x14a)),invalid_refresh_token_error_1=require(a193_0x3e9d83(0xf3)),auth_state_enum_1=require(a193_0x3e9d83(0x148)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a193_0x3e9d83(0x115)),providers_tokens_1=require(a193_0x3e9d83(0xf7));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x47b7c8=a193_0x3e9d83;this[_0x47b7c8(0x13c)]=0x1388,this['authState']=auth_state_enum_1['AuthState'][_0x47b7c8(0x125)],this[_0x47b7c8(0x145)]=new core_1[(_0x47b7c8(0x10c))](SalesforceAuthService_1[_0x47b7c8(0x12f)]),this[_0x47b7c8(0x126)]();}async[a193_0x3e9d83(0x126)](){const _0x36ad88=a193_0x3e9d83;this[_0x36ad88(0x145)][_0x36ad88(0x11c)](_0x36ad88(0x112),auth_state_enum_1[_0x36ad88(0x107)][this['authState']]);try{if(this[_0x36ad88(0x146)]===auth_state_enum_1['AuthState'][_0x36ad88(0x122)])return;if(this[_0x36ad88(0x146)]===auth_state_enum_1['AuthState']['Idle'])await this[_0x36ad88(0xfb)]();else{const _0x334503=await this['requestConfig'](),_0x2f486b=await axios_1['default']['get'](_0x36ad88(0x131)+constants_1[_0x36ad88(0x12a)],_0x334503)[_0x36ad88(0xf2)](()=>!![])[_0x36ad88(0x101)](()=>![]);!_0x2f486b&&await this[_0x36ad88(0xfb)]();}}catch(_0x104e45){}}async[a193_0x3e9d83(0xfb)](){const _0x3cdfc3=a193_0x3e9d83;var _0x408b6b,_0x1faaa3,_0x5ba3b4;this[_0x3cdfc3(0x145)]['log']('update\x20access\x20token');try{this[_0x3cdfc3(0x146)]=auth_state_enum_1[_0x3cdfc3(0x107)][_0x3cdfc3(0x111)];const {refreshToken:_0x7635ae,clientId:_0x2fa93b,clientSecret:_0x2f2596,loginUrl:_0x4f5d9d}=typedi_1[_0x3cdfc3(0x133)][_0x3cdfc3(0x11e)](providers_tokens_1[_0x3cdfc3(0x138)][_0x3cdfc3(0x142)]),{data:_0xbee860}=await axios_1['default']['post']((0x0,utils_1[_0x3cdfc3(0x10f)])(_0x4f5d9d,_0x3cdfc3(0x114)),null,{'params':{'grant_type':_0x3cdfc3(0x12e),'refresh_token':_0x7635ae,'client_id':_0x2fa93b,'client_secret':_0x2f2596}});this[_0x3cdfc3(0x118)]=_0xbee860['instance_url'],this['accessToken']=_0xbee860[_0x3cdfc3(0x124)],this[_0x3cdfc3(0x100)]=_0xbee860[_0x3cdfc3(0x10a)],this[_0x3cdfc3(0x146)]=auth_state_enum_1[_0x3cdfc3(0x107)]['Active'],this[_0x3cdfc3(0x145)][_0x3cdfc3(0x11c)](_0x3cdfc3(0x10e),this['instanceUrl']);}catch(_0x519bd9){const _0x346577=((_0x1faaa3=(_0x408b6b=_0x519bd9===null||_0x519bd9===void 0x0?void 0x0:_0x519bd9[_0x3cdfc3(0x120)])===null||_0x408b6b===void 0x0?void 0x0:_0x408b6b['data'])===null||_0x1faaa3===void 0x0?void 0x0:_0x1faaa3[_0x3cdfc3(0x116)])||((_0x5ba3b4=_0x519bd9===null||_0x519bd9===void 0x0?void 0x0:_0x519bd9['response'])===null||_0x5ba3b4===void 0x0?void 0x0:_0x5ba3b4[_0x3cdfc3(0x13d)])||_0x519bd9['message'];this[_0x3cdfc3(0x145)]['error'](_0x3cdfc3(0x103),_0x346577),this[_0x3cdfc3(0x146)]=auth_state_enum_1[_0x3cdfc3(0x107)][_0x3cdfc3(0x122)];throw new invalid_refresh_token_error_1[(_0x3cdfc3(0x139))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a193_0x3e9d83(0x149)](){const _0x5e4283=a193_0x3e9d83;this[_0x5e4283(0x145)][_0x5e4283(0x11c)]('force\x20update\x20token');if(this[_0x5e4283(0x146)]===auth_state_enum_1['AuthState'][_0x5e4283(0x111)]||this[_0x5e4283(0x146)]===auth_state_enum_1['AuthState'][_0x5e4283(0x125)])return await(0x0,utils_1[_0x5e4283(0x104)])(this[_0x5e4283(0x13c)]),this[_0x5e4283(0x149)]();if(this[_0x5e4283(0x146)]===auth_state_enum_1[_0x5e4283(0x107)][_0x5e4283(0x122)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x5e4283(0x11b)]);await this[_0x5e4283(0xfb)]();}async[a193_0x3e9d83(0x143)](){const _0x16b2d9=a193_0x3e9d83;if(this['authState']===auth_state_enum_1[_0x16b2d9(0x107)][_0x16b2d9(0x122)]){this[_0x16b2d9(0x145)][_0x16b2d9(0x11c)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x16b2d9(0x12b))]();}if(this['authState']!==auth_state_enum_1[_0x16b2d9(0x107)]['Active'])return this['logger']['log'](_0x16b2d9(0x11a)),await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this[_0x16b2d9(0x143)]();}[a193_0x3e9d83(0xff)](){return{'orgId':this['orgId'],'accessToken':this['accessToken'],'instanceUrl':this['instanceUrl']};}async[a193_0x3e9d83(0x13f)](){const _0xa6bff0=a193_0x3e9d83;return await this[_0xa6bff0(0x143)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0xa6bff0(0xf8),'authorization':this[_0xa6bff0(0x100)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a193_0x3e9d83(0x136),[])],SalesforceAuthService),exports[a193_0x3e9d83(0xf4)]=SalesforceAuthService;