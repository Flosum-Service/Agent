const a269_0x3f1a84=a269_0x10cd;(function(_0x363e83,_0x280c25){const _0x4c5af2=a269_0x10cd,_0x35960b=_0x363e83();while(!![]){try{const _0x19eacf=parseInt(_0x4c5af2(0x20a))/0x1*(-parseInt(_0x4c5af2(0x1f5))/0x2)+parseInt(_0x4c5af2(0x1d7))/0x3*(-parseInt(_0x4c5af2(0x213))/0x4)+-parseInt(_0x4c5af2(0x1be))/0x5+parseInt(_0x4c5af2(0x1c2))/0x6*(parseInt(_0x4c5af2(0x201))/0x7)+parseInt(_0x4c5af2(0x1cc))/0x8+-parseInt(_0x4c5af2(0x1f6))/0x9+-parseInt(_0x4c5af2(0x20f))/0xa*(-parseInt(_0x4c5af2(0x1ec))/0xb);if(_0x19eacf===_0x280c25)break;else _0x35960b['push'](_0x35960b['shift']());}catch(_0x7584d9){_0x35960b['push'](_0x35960b['shift']());}}}(a269_0x52d2,0x5491f));const a269_0x2ce109=(function(){let _0x1590cd=!![];return function(_0x2037e3,_0x359dc0){const _0x528a9a=_0x1590cd?function(){const _0x160e70=a269_0x10cd;if(_0x359dc0){const _0xbdbe8b=_0x359dc0[_0x160e70(0x1d9)](_0x2037e3,arguments);return _0x359dc0=null,_0xbdbe8b;}}:function(){};return _0x1590cd=![],_0x528a9a;};}()),a269_0x29841a=a269_0x2ce109(this,function(){const _0x9fcec9=a269_0x10cd;return a269_0x29841a[_0x9fcec9(0x1c4)]()['search']('(((.+)+)+)+$')[_0x9fcec9(0x1c4)]()[_0x9fcec9(0x1ff)](a269_0x29841a)[_0x9fcec9(0x1cb)](_0x9fcec9(0x207));});a269_0x29841a();function a269_0x52d2(){const _0x256dce=['services/data/','logger','authState','2112295JehuJg','refresh_token','sleep','SalesforceAuthService','79386JYoxQK','__esModule','toString','accessToken','message','default','Idle','InvalidRefreshTokenError','response','search','48192PmIsGL','../errors/invalid-refresh-token.error','waitAuth','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','token_type','__importStar','joinURL','Error','forceUpdateToken','Tokens','headers','269847DwTAmK','Updating','apply','authorization','../../providers/providers.tokens','metadata','orgId','AUTH_WAIT_TIME','getOwnPropertyDescriptor','hasOwnProperty','/services/oauth2/token','Logger','design:paramtypes','__createBinding','salesforce','@flosum/salesforce','instanceUrl','AuthState','Service','post','then','11ylpNLJ','data','decorate','object','Check\x20auth:\x20current\x20state\x20-\x20%s','length','../enums/auth-state.enum','application/json','Active','68FiLVnK','1818900XOTjnL','error','configurable','ERR_INVALID_SALESFORCE_TOKEN','Update\x20access\x20token','SalesforceUtils','SALESFORCE_API_VERSION','requestConfig','</met:sessionId>','constructor','../../../../constants','245effAbe','../../../shared/utils','isBulk1Url','call','function','../../../../core','(((.+)+)+)+$','updateAccessToken','Access\x20token\x20updated\x20for\x20%s','8920zHYxPJ','get','defineProperty','writable','../../../../constants/errors','9850270plEinx','__decorate','../errors/unauthorized-salesforce.error','__metadata','8yuSktE','setAuthDetails','tokenType','create','isSoapUrl','name','log'];a269_0x52d2=function(){return _0x256dce;};return a269_0x52d2();}'use strict';var __createBinding=this&&this[a269_0x3f1a84(0x1e4)]||(Object[a269_0x3f1a84(0x216)]?function(_0x5908fb,_0x263bc5,_0x5ae29f,_0x12a18d){const _0x4962df=a269_0x3f1a84;if(_0x12a18d===undefined)_0x12a18d=_0x5ae29f;var _0x82fdb7=Object[_0x4962df(0x1df)](_0x263bc5,_0x5ae29f);(!_0x82fdb7||('get'in _0x82fdb7?!_0x263bc5[_0x4962df(0x1c3)]:_0x82fdb7[_0x4962df(0x20d)]||_0x82fdb7[_0x4962df(0x1f8)]))&&(_0x82fdb7={'enumerable':!![],'get':function(){return _0x263bc5[_0x5ae29f];}}),Object[_0x4962df(0x20c)](_0x5908fb,_0x12a18d,_0x82fdb7);}:function(_0x335799,_0x80efbf,_0x53c133,_0x87acd0){if(_0x87acd0===undefined)_0x87acd0=_0x53c133;_0x335799[_0x87acd0]=_0x80efbf[_0x53c133];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a269_0x3f1a84(0x216)]?function(_0x16c3ac,_0x3eff14){const _0x3ca2b6=a269_0x3f1a84;Object[_0x3ca2b6(0x20c)](_0x16c3ac,'default',{'enumerable':!![],'value':_0x3eff14});}:function(_0x5bf047,_0x16daeb){_0x5bf047['default']=_0x16daeb;}),__decorate=this&&this[a269_0x3f1a84(0x210)]||function(_0x3c1a94,_0x28dac3,_0x18b799,_0x211ef4){const _0x4e158b=a269_0x3f1a84;var _0x5f494d=arguments['length'],_0x4d15fd=_0x5f494d<0x3?_0x28dac3:_0x211ef4===null?_0x211ef4=Object[_0x4e158b(0x1df)](_0x28dac3,_0x18b799):_0x211ef4,_0x5cf183;if(typeof Reflect===_0x4e158b(0x1ef)&&typeof Reflect[_0x4e158b(0x1ee)]===_0x4e158b(0x205))_0x4d15fd=Reflect[_0x4e158b(0x1ee)](_0x3c1a94,_0x28dac3,_0x18b799,_0x211ef4);else{for(var _0x40d6b0=_0x3c1a94[_0x4e158b(0x1f1)]-0x1;_0x40d6b0>=0x0;_0x40d6b0--)if(_0x5cf183=_0x3c1a94[_0x40d6b0])_0x4d15fd=(_0x5f494d<0x3?_0x5cf183(_0x4d15fd):_0x5f494d>0x3?_0x5cf183(_0x28dac3,_0x18b799,_0x4d15fd):_0x5cf183(_0x28dac3,_0x18b799))||_0x4d15fd;}return _0x5f494d>0x3&&_0x4d15fd&&Object[_0x4e158b(0x20c)](_0x28dac3,_0x18b799,_0x4d15fd),_0x4d15fd;},__importStar=this&&this[a269_0x3f1a84(0x1d1)]||function(_0x3bf2e4){const _0x419ce2=a269_0x3f1a84;if(_0x3bf2e4&&_0x3bf2e4[_0x419ce2(0x1c3)])return _0x3bf2e4;var _0x4c2798={};if(_0x3bf2e4!=null){for(var _0x31094d in _0x3bf2e4)if(_0x31094d!=='default'&&Object['prototype'][_0x419ce2(0x1e0)][_0x419ce2(0x204)](_0x3bf2e4,_0x31094d))__createBinding(_0x4c2798,_0x3bf2e4,_0x31094d);}return __setModuleDefault(_0x4c2798,_0x3bf2e4),_0x4c2798;},__metadata=this&&this[a269_0x3f1a84(0x212)]||function(_0x5dba7c,_0x495d9e){const _0x1bd3e2=a269_0x3f1a84;if(typeof Reflect==='object'&&typeof Reflect[_0x1bd3e2(0x1dc)]===_0x1bd3e2(0x205))return Reflect['metadata'](_0x5dba7c,_0x495d9e);},__importDefault=this&&this['__importDefault']||function(_0xdb6786){return _0xdb6786&&_0xdb6786['__esModule']?_0xdb6786:{'default':_0xdb6786};},SalesforceAuthService_1;Object[a269_0x3f1a84(0x20c)](exports,a269_0x3f1a84(0x1c3),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require('typedi')),errors_1=require(a269_0x3f1a84(0x20e)),core_1=require(a269_0x3f1a84(0x206)),axios_1=__importDefault(require('axios')),utils_1=require(a269_0x3f1a84(0x202)),invalid_refresh_token_error_1=require(a269_0x3f1a84(0x1cd)),auth_state_enum_1=require(a269_0x3f1a84(0x1f2)),unauthorized_salesforce_error_1=require(a269_0x3f1a84(0x211)),constants_1=require(a269_0x3f1a84(0x200)),providers_tokens_1=require(a269_0x3f1a84(0x1db)),salesforce_1=require(a269_0x3f1a84(0x1e6));function a269_0x10cd(_0x4c9ed9,_0x55027b){const _0x1add7a=a269_0x52d2();return a269_0x10cd=function(_0x29841a,_0x2ce109){_0x29841a=_0x29841a-0x1ba;let _0x52d2c6=_0x1add7a[_0x29841a];return _0x52d2c6;},a269_0x10cd(_0x4c9ed9,_0x55027b);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x529718=a269_0x3f1a84;this['AUTH_WAIT_TIME']=0x1388,this['authState']=auth_state_enum_1[_0x529718(0x1e8)][_0x529718(0x1c8)],this['logger']=new core_1[(_0x529718(0x1e2))](SalesforceAuthService_1[_0x529718(0x218)]),this[_0x529718(0x214)]();}async[a269_0x3f1a84(0x214)](){const _0x1e35f8=a269_0x3f1a84;this['logger'][_0x1e35f8(0x1ba)](_0x1e35f8(0x1f0),auth_state_enum_1[_0x1e35f8(0x1e8)][this[_0x1e35f8(0x1bd)]]);try{if(this[_0x1e35f8(0x1bd)]===auth_state_enum_1[_0x1e35f8(0x1e8)]['Error'])return;if(this['authState']===auth_state_enum_1['AuthState'][_0x1e35f8(0x1c8)])await this[_0x1e35f8(0x208)]();else{const _0x5a1577=await this[_0x1e35f8(0x1fd)](),_0x2d7616=await axios_1['default']['get'](_0x1e35f8(0x1bb)+constants_1[_0x1e35f8(0x1fc)],_0x5a1577)[_0x1e35f8(0x1eb)](()=>!![])['catch'](()=>![]);!_0x2d7616&&await this[_0x1e35f8(0x208)]();}}catch(_0x4ab881){}}async[a269_0x3f1a84(0x208)](){const _0x42f479=a269_0x3f1a84;var _0x109c19,_0x339c6f,_0x1e57bf;this[_0x42f479(0x1bc)][_0x42f479(0x1ba)](_0x42f479(0x1fa));try{this['authState']=auth_state_enum_1['AuthState'][_0x42f479(0x1d8)];const {refreshToken:_0x200732,clientId:_0x12fb3b,clientSecret:_0x581f5d,loginUrl:_0x50f60b}=typedi_1[_0x42f479(0x1c7)][_0x42f479(0x20b)](providers_tokens_1[_0x42f479(0x1d5)][_0x42f479(0x1e5)]),{data:_0x6e3355}=await axios_1[_0x42f479(0x1c7)][_0x42f479(0x1ea)]((0x0,utils_1[_0x42f479(0x1d2)])(_0x50f60b,_0x42f479(0x1e1)),null,{'params':{'grant_type':_0x42f479(0x1bf),'refresh_token':_0x200732,'client_id':_0x12fb3b,'client_secret':_0x581f5d}});this[_0x42f479(0x1e7)]=_0x6e3355['instance_url'],this[_0x42f479(0x1c5)]=_0x6e3355['access_token'],this[_0x42f479(0x215)]=_0x6e3355[_0x42f479(0x1d0)],this[_0x42f479(0x1bd)]=auth_state_enum_1[_0x42f479(0x1e8)][_0x42f479(0x1f4)],this[_0x42f479(0x1bc)][_0x42f479(0x1ba)](_0x42f479(0x209),this['instanceUrl']);}catch(_0x553e4b){const _0x3fd7f9=((_0x339c6f=(_0x109c19=_0x553e4b===null||_0x553e4b===void 0x0?void 0x0:_0x553e4b[_0x42f479(0x1ca)])===null||_0x109c19===void 0x0?void 0x0:_0x109c19['data'])===null||_0x339c6f===void 0x0?void 0x0:_0x339c6f[_0x42f479(0x1f7)])||((_0x1e57bf=_0x553e4b===null||_0x553e4b===void 0x0?void 0x0:_0x553e4b['response'])===null||_0x1e57bf===void 0x0?void 0x0:_0x1e57bf[_0x42f479(0x1ed)])||_0x553e4b[_0x42f479(0x1c6)];this[_0x42f479(0x1bc)][_0x42f479(0x1f7)]('Update\x20access\x20token\x20failed:\x20%s',_0x3fd7f9),this['authState']=auth_state_enum_1[_0x42f479(0x1e8)]['Error'];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x42f479(0x1f9)]);}}async[a269_0x3f1a84(0x1d4)](){const _0x5e64d4=a269_0x3f1a84;this['logger'][_0x5e64d4(0x1ba)]('Force\x20update\x20token');if(this[_0x5e64d4(0x1bd)]===auth_state_enum_1[_0x5e64d4(0x1e8)][_0x5e64d4(0x1d8)]||this[_0x5e64d4(0x1bd)]===auth_state_enum_1[_0x5e64d4(0x1e8)][_0x5e64d4(0x1c8)])return await(0x0,utils_1[_0x5e64d4(0x1c0)])(this[_0x5e64d4(0x1de)]),this['forceUpdateToken']();if(this['authState']===auth_state_enum_1['AuthState'][_0x5e64d4(0x1d3)])throw new invalid_refresh_token_error_1[(_0x5e64d4(0x1c9))](errors_1[_0x5e64d4(0x1f9)]);await this[_0x5e64d4(0x208)]();}async['waitAuth'](){const _0x9927c9=a269_0x3f1a84;if(this[_0x9927c9(0x1bd)]===auth_state_enum_1[_0x9927c9(0x1e8)][_0x9927c9(0x1d3)]){this[_0x9927c9(0x1bc)][_0x9927c9(0x1ba)](_0x9927c9(0x1cf));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x9927c9(0x1bd)]!==auth_state_enum_1[_0x9927c9(0x1e8)][_0x9927c9(0x1f4)])return this[_0x9927c9(0x1bc)]['log']('Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x9927c9(0x1c0)])(this[_0x9927c9(0x1de)]),this[_0x9927c9(0x1ce)]();}['getAuthData'](){const _0x1c5f40=a269_0x3f1a84;return{'orgId':this[_0x1c5f40(0x1dd)],'accessToken':this[_0x1c5f40(0x1c5)],'instanceUrl':this[_0x1c5f40(0x1e7)]};}async['requestConfig'](_0x5d2a8c=''){const _0x1a6527=a269_0x3f1a84;await this[_0x1a6527(0x1ce)]();const _0x2a574c={'baseURL':this[_0x1a6527(0x1e7)],'headers':{'accept':_0x1a6527(0x1f3)}};if(salesforce_1['SalesforceUtils'][_0x1a6527(0x203)](_0x5d2a8c))_0x2a574c['headers']['X-SFDC-Session']=this[_0x1a6527(0x1c5)];else salesforce_1[_0x1a6527(0x1fb)][_0x1a6527(0x217)](_0x5d2a8c)?_0x2a574c[_0x1a6527(0x1ed)]=_0x2a574c['data']['replace'](/<met:sessionId>.+?<\/met:sessionId>/,'<met:sessionId>'+this['accessToken']+_0x1a6527(0x1fe)):_0x2a574c[_0x1a6527(0x1d6)][_0x1a6527(0x1da)]=this[_0x1a6527(0x215)]+'\x20'+this['accessToken'];return _0x2a574c;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a269_0x3f1a84(0x1e9)])(),__metadata(a269_0x3f1a84(0x1e3),[])],SalesforceAuthService),exports[a269_0x3f1a84(0x1c1)]=SalesforceAuthService;