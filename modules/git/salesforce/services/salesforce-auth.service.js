const a271_0x15dd8b=a271_0x2560;(function(_0x47288a,_0x20b20e){const _0x30029f=a271_0x2560,_0x3d0730=_0x47288a();while(!![]){try{const _0x1e76f5=parseInt(_0x30029f(0x1cf))/0x1+parseInt(_0x30029f(0x1c9))/0x2*(parseInt(_0x30029f(0x1bf))/0x3)+parseInt(_0x30029f(0x210))/0x4+-parseInt(_0x30029f(0x1f1))/0x5+parseInt(_0x30029f(0x1c5))/0x6*(-parseInt(_0x30029f(0x1df))/0x7)+-parseInt(_0x30029f(0x1ee))/0x8+-parseInt(_0x30029f(0x1d4))/0x9;if(_0x1e76f5===_0x20b20e)break;else _0x3d0730['push'](_0x3d0730['shift']());}catch(_0x592487){_0x3d0730['push'](_0x3d0730['shift']());}}}(a271_0x4d29,0x3783a));const a271_0x1f9dc2=(function(){let _0x4a0599=!![];return function(_0x21d665,_0x4c63b8){const _0x2b0acb=_0x4a0599?function(){const _0x86c617=a271_0x2560;if(_0x4c63b8){const _0xb375a4=_0x4c63b8[_0x86c617(0x1bb)](_0x21d665,arguments);return _0x4c63b8=null,_0xb375a4;}}:function(){};return _0x4a0599=![],_0x2b0acb;};}()),a271_0x3f935d=a271_0x1f9dc2(this,function(){const _0x34c665=a271_0x2560;return a271_0x3f935d[_0x34c665(0x1bd)]()[_0x34c665(0x1e6)]('(((.+)+)+)+$')['toString']()[_0x34c665(0x200)](a271_0x3f935d)[_0x34c665(0x1e6)](_0x34c665(0x1f4));});a271_0x3f935d();'use strict';var __createBinding=this&&this[a271_0x15dd8b(0x1c8)]||(Object['create']?function(_0x5e2d06,_0x1225f8,_0x287398,_0x55fe60){const _0x815171=a271_0x15dd8b;if(_0x55fe60===undefined)_0x55fe60=_0x287398;var _0x2a7b2d=Object[_0x815171(0x1e4)](_0x1225f8,_0x287398);(!_0x2a7b2d||(_0x815171(0x1e7)in _0x2a7b2d?!_0x1225f8[_0x815171(0x1ec)]:_0x2a7b2d[_0x815171(0x1f3)]||_0x2a7b2d[_0x815171(0x1ea)]))&&(_0x2a7b2d={'enumerable':!![],'get':function(){return _0x1225f8[_0x287398];}}),Object[_0x815171(0x204)](_0x5e2d06,_0x55fe60,_0x2a7b2d);}:function(_0x1de2e7,_0x46499d,_0x2dbdcb,_0x13db32){if(_0x13db32===undefined)_0x13db32=_0x2dbdcb;_0x1de2e7[_0x13db32]=_0x46499d[_0x2dbdcb];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a271_0x15dd8b(0x1d0)]?function(_0x5943bd,_0xd22ad6){const _0x264541=a271_0x15dd8b;Object['defineProperty'](_0x5943bd,_0x264541(0x1da),{'enumerable':!![],'value':_0xd22ad6});}:function(_0x5eede1,_0x1e8bdb){const _0x11fcf9=a271_0x15dd8b;_0x5eede1[_0x11fcf9(0x1da)]=_0x1e8bdb;}),__decorate=this&&this['__decorate']||function(_0x30cdd3,_0x5efcbc,_0x162183,_0x471f7e){const _0x52fdf3=a271_0x15dd8b;var _0x56c9c2=arguments[_0x52fdf3(0x1f8)],_0x43cf66=_0x56c9c2<0x3?_0x5efcbc:_0x471f7e===null?_0x471f7e=Object[_0x52fdf3(0x1e4)](_0x5efcbc,_0x162183):_0x471f7e,_0x3c3fd8;if(typeof Reflect===_0x52fdf3(0x201)&&typeof Reflect[_0x52fdf3(0x1dc)]===_0x52fdf3(0x1c3))_0x43cf66=Reflect[_0x52fdf3(0x1dc)](_0x30cdd3,_0x5efcbc,_0x162183,_0x471f7e);else{for(var _0x2c1ed5=_0x30cdd3[_0x52fdf3(0x1f8)]-0x1;_0x2c1ed5>=0x0;_0x2c1ed5--)if(_0x3c3fd8=_0x30cdd3[_0x2c1ed5])_0x43cf66=(_0x56c9c2<0x3?_0x3c3fd8(_0x43cf66):_0x56c9c2>0x3?_0x3c3fd8(_0x5efcbc,_0x162183,_0x43cf66):_0x3c3fd8(_0x5efcbc,_0x162183))||_0x43cf66;}return _0x56c9c2>0x3&&_0x43cf66&&Object[_0x52fdf3(0x204)](_0x5efcbc,_0x162183,_0x43cf66),_0x43cf66;},__importStar=this&&this[a271_0x15dd8b(0x1ed)]||function(_0x1c189b){const _0x455ca3=a271_0x15dd8b;if(_0x1c189b&&_0x1c189b[_0x455ca3(0x1ec)])return _0x1c189b;var _0x479962={};if(_0x1c189b!=null){for(var _0x1ba738 in _0x1c189b)if(_0x1ba738!=='default'&&Object[_0x455ca3(0x1f5)][_0x455ca3(0x1ff)]['call'](_0x1c189b,_0x1ba738))__createBinding(_0x479962,_0x1c189b,_0x1ba738);}return __setModuleDefault(_0x479962,_0x1c189b),_0x479962;},__metadata=this&&this[a271_0x15dd8b(0x1de)]||function(_0x4ca054,_0x2e6ba8){const _0x4b434e=a271_0x15dd8b;if(typeof Reflect==='object'&&typeof Reflect[_0x4b434e(0x205)]===_0x4b434e(0x1c3))return Reflect[_0x4b434e(0x205)](_0x4ca054,_0x2e6ba8);},__importDefault=this&&this[a271_0x15dd8b(0x1be)]||function(_0x14b5a7){const _0x4d5126=a271_0x15dd8b;return _0x14b5a7&&_0x14b5a7[_0x4d5126(0x1ec)]?_0x14b5a7:{'default':_0x14b5a7};},SalesforceAuthService_1;Object[a271_0x15dd8b(0x204)](exports,a271_0x15dd8b(0x1ec),{'value':!![]}),exports[a271_0x15dd8b(0x1ef)]=void 0x0;const typedi_1=__importStar(require(a271_0x15dd8b(0x1d3))),errors_1=require(a271_0x15dd8b(0x1e8)),core_1=require(a271_0x15dd8b(0x1f6)),axios_1=__importDefault(require(a271_0x15dd8b(0x1c6))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a271_0x15dd8b(0x20d)),auth_state_enum_1=require(a271_0x15dd8b(0x1d2)),unauthorized_salesforce_error_1=require(a271_0x15dd8b(0x20c)),constants_1=require('../../../../constants'),providers_tokens_1=require('../../providers/providers.tokens'),salesforce_1=require('@flosum/salesforce');function a271_0x4d29(){const _0x20d512=['../errors/unauthorized-salesforce.error','../errors/invalid-refresh-token.error','X-SFDC-Session','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','1360036ssfCdR','post','authState','apply','setAuthDetails','toString','__importDefault','42dxiICK','getAuthData','authorization','Updating','function','error','228ibHfiP','axios','tokenType','__createBinding','48940SZizVC','services/data/','accessToken','headers','updateAccessToken','SalesforceUtils','450193hkTUwv','create','InvalidRefreshTokenError','../enums/auth-state.enum','typedi','4873113bWxBAQ','instanceUrl','sleep','orgId','forceUpdateToken','salesforce','default','log','decorate','ERR_INVALID_SALESFORCE_TOKEN','__metadata','10738sQMDhy','data','AUTH_WAIT_TIME','<met:sessionId>','joinURL','getOwnPropertyDescriptor','Access\x20token\x20updated\x20for\x20%s','search','get','../../../../constants/errors','Idle','configurable','Error','__esModule','__importStar','627232mNheCR','SalesforceAuthService','waitAuth','1136215BOYucg','logger','writable','(((.+)+)+)+$','prototype','../../../../core','instance_url','length','UnauthorizedSalesforceError','design:paramtypes','refresh_token','Update\x20access\x20token\x20failed:\x20%s','catch','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','hasOwnProperty','constructor','object','</met:sessionId>','AuthState','defineProperty','metadata','Check\x20auth:\x20current\x20state\x20-\x20%s','Active','/services/oauth2/token','SALESFORCE_API_VERSION','then','requestConfig'];a271_0x4d29=function(){return _0x20d512;};return a271_0x4d29();}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x1d85d8=a271_0x15dd8b;this[_0x1d85d8(0x1e1)]=0x1388,this[_0x1d85d8(0x1ba)]=auth_state_enum_1[_0x1d85d8(0x203)][_0x1d85d8(0x1e9)],this[_0x1d85d8(0x1f2)]=new core_1['Logger'](SalesforceAuthService_1['name']),this['setAuthDetails']();}async[a271_0x15dd8b(0x1bc)](){const _0x113318=a271_0x15dd8b;this['logger']['log'](_0x113318(0x206),auth_state_enum_1[_0x113318(0x203)][this[_0x113318(0x1ba)]]);try{if(this[_0x113318(0x1ba)]===auth_state_enum_1[_0x113318(0x203)][_0x113318(0x1eb)])return;if(this[_0x113318(0x1ba)]===auth_state_enum_1['AuthState'][_0x113318(0x1e9)])await this[_0x113318(0x1cd)]();else{const _0x3038e9=await this[_0x113318(0x20b)](),_0x1ec1c5=await axios_1[_0x113318(0x1da)][_0x113318(0x1e7)](_0x113318(0x1ca)+constants_1[_0x113318(0x209)],_0x3038e9)[_0x113318(0x20a)](()=>!![])[_0x113318(0x1fd)](()=>![]);!_0x1ec1c5&&await this['updateAccessToken']();}}catch(_0x265fa7){}}async[a271_0x15dd8b(0x1cd)](){const _0x208e36=a271_0x15dd8b;var _0xe313c5,_0x57ff91,_0xfc3f8d;this['logger'][_0x208e36(0x1db)]('Update\x20access\x20token');try{this['authState']=auth_state_enum_1['AuthState'][_0x208e36(0x1c2)];const {refreshToken:_0x47f974,clientId:_0x2ed56b,clientSecret:_0x37ca0f,loginUrl:_0x549afc}=typedi_1[_0x208e36(0x1da)][_0x208e36(0x1e7)](providers_tokens_1['Tokens'][_0x208e36(0x1d9)]),{data:_0x4140fb}=await axios_1['default'][_0x208e36(0x211)]((0x0,utils_1[_0x208e36(0x1e3)])(_0x549afc,_0x208e36(0x208)),null,{'params':{'grant_type':_0x208e36(0x1fb),'refresh_token':_0x47f974,'client_id':_0x2ed56b,'client_secret':_0x37ca0f}});this[_0x208e36(0x1d5)]=_0x4140fb[_0x208e36(0x1f7)],this['accessToken']=_0x4140fb['access_token'],this[_0x208e36(0x1c7)]=_0x4140fb['token_type'],this['authState']=auth_state_enum_1[_0x208e36(0x203)][_0x208e36(0x207)],this[_0x208e36(0x1f2)]['log'](_0x208e36(0x1e5),this[_0x208e36(0x1d5)]);}catch(_0xa0c301){const _0x57af63=((_0x57ff91=(_0xe313c5=_0xa0c301===null||_0xa0c301===void 0x0?void 0x0:_0xa0c301['response'])===null||_0xe313c5===void 0x0?void 0x0:_0xe313c5[_0x208e36(0x1e0)])===null||_0x57ff91===void 0x0?void 0x0:_0x57ff91[_0x208e36(0x1c4)])||((_0xfc3f8d=_0xa0c301===null||_0xa0c301===void 0x0?void 0x0:_0xa0c301['response'])===null||_0xfc3f8d===void 0x0?void 0x0:_0xfc3f8d[_0x208e36(0x1e0)])||_0xa0c301['message'];this[_0x208e36(0x1f2)][_0x208e36(0x1c4)](_0x208e36(0x1fc),_0x57af63),this['authState']=auth_state_enum_1[_0x208e36(0x203)]['Error'];throw new invalid_refresh_token_error_1[(_0x208e36(0x1d1))](errors_1[_0x208e36(0x1dd)]);}}async[a271_0x15dd8b(0x1d8)](){const _0x119aa0=a271_0x15dd8b;this['logger']['log']('Force\x20update\x20token');if(this[_0x119aa0(0x1ba)]===auth_state_enum_1[_0x119aa0(0x203)][_0x119aa0(0x1c2)]||this[_0x119aa0(0x1ba)]===auth_state_enum_1[_0x119aa0(0x203)][_0x119aa0(0x1e9)])return await(0x0,utils_1[_0x119aa0(0x1d6)])(this[_0x119aa0(0x1e1)]),this[_0x119aa0(0x1d8)]();if(this[_0x119aa0(0x1ba)]===auth_state_enum_1[_0x119aa0(0x203)][_0x119aa0(0x1eb)])throw new invalid_refresh_token_error_1[(_0x119aa0(0x1d1))](errors_1[_0x119aa0(0x1dd)]);await this[_0x119aa0(0x1cd)]();}async[a271_0x15dd8b(0x1f0)](){const _0x19ad67=a271_0x15dd8b;if(this[_0x19ad67(0x1ba)]===auth_state_enum_1['AuthState'][_0x19ad67(0x1eb)]){this[_0x19ad67(0x1f2)][_0x19ad67(0x1db)](_0x19ad67(0x20f));throw new unauthorized_salesforce_error_1[(_0x19ad67(0x1f9))]();}if(this['authState']!==auth_state_enum_1[_0x19ad67(0x203)]['Active'])return this['logger']['log'](_0x19ad67(0x1fe)),await(0x0,utils_1[_0x19ad67(0x1d6)])(this[_0x19ad67(0x1e1)]),this[_0x19ad67(0x1f0)]();}[a271_0x15dd8b(0x1c0)](){const _0x439a57=a271_0x15dd8b;return{'orgId':this[_0x439a57(0x1d7)],'accessToken':this[_0x439a57(0x1cb)],'instanceUrl':this['instanceUrl']};}async[a271_0x15dd8b(0x20b)](_0x4dfaa2=''){const _0x389a52=a271_0x15dd8b;await this[_0x389a52(0x1f0)]();const _0x2aaaa6={'baseURL':this[_0x389a52(0x1d5)],'headers':{'accept':'application/json'}};if(salesforce_1[_0x389a52(0x1ce)]['isBulk1Url'](_0x4dfaa2))_0x2aaaa6[_0x389a52(0x1cc)][_0x389a52(0x20e)]=this[_0x389a52(0x1cb)];else salesforce_1[_0x389a52(0x1ce)]['isSoapUrl'](_0x4dfaa2)?_0x2aaaa6[_0x389a52(0x1e0)]=_0x2aaaa6['data']['replace'](/<met:sessionId>.+?<\/met:sessionId>/,_0x389a52(0x1e2)+this['accessToken']+_0x389a52(0x202)):_0x2aaaa6[_0x389a52(0x1cc)][_0x389a52(0x1c1)]=this[_0x389a52(0x1c7)]+'\x20'+this[_0x389a52(0x1cb)];return _0x2aaaa6;}};function a271_0x2560(_0x4b932f,_0x3e0bb7){const _0x3c41b1=a271_0x4d29();return a271_0x2560=function(_0x3f935d,_0x1f9dc2){_0x3f935d=_0x3f935d-0x1ba;let _0x4d299d=_0x3c41b1[_0x3f935d];return _0x4d299d;},a271_0x2560(_0x4b932f,_0x3e0bb7);}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a271_0x15dd8b(0x1fa),[])],SalesforceAuthService),exports[a271_0x15dd8b(0x1ef)]=SalesforceAuthService;