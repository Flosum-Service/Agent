const a227_0x70afe=a227_0x3740;(function(_0x389ca5,_0x5059ed){const _0x255644=a227_0x3740,_0x4b779f=_0x389ca5();while(!![]){try{const _0x189911=-parseInt(_0x255644(0x186))/0x1*(-parseInt(_0x255644(0x1a3))/0x2)+parseInt(_0x255644(0x188))/0x3+-parseInt(_0x255644(0x1cb))/0x4+-parseInt(_0x255644(0x1aa))/0x5*(parseInt(_0x255644(0x19c))/0x6)+parseInt(_0x255644(0x198))/0x7+-parseInt(_0x255644(0x1b9))/0x8*(-parseInt(_0x255644(0x199))/0x9)+-parseInt(_0x255644(0x1b8))/0xa;if(_0x189911===_0x5059ed)break;else _0x4b779f['push'](_0x4b779f['shift']());}catch(_0x1e84b1){_0x4b779f['push'](_0x4b779f['shift']());}}}(a227_0x10af,0xb4732));const a227_0x21ae42=(function(){let _0x74486f=!![];return function(_0x4f229c,_0x5dafc2){const _0x4bbded=_0x74486f?function(){const _0xba802c=a227_0x3740;if(_0x5dafc2){const _0x41ad5d=_0x5dafc2[_0xba802c(0x1ae)](_0x4f229c,arguments);return _0x5dafc2=null,_0x41ad5d;}}:function(){};return _0x74486f=![],_0x4bbded;};}()),a227_0x2eeab2=a227_0x21ae42(this,function(){const _0x5c46eb=a227_0x3740;return a227_0x2eeab2[_0x5c46eb(0x1c0)]()[_0x5c46eb(0x1c1)](_0x5c46eb(0x1b7))[_0x5c46eb(0x1c0)]()[_0x5c46eb(0x1a7)](a227_0x2eeab2)[_0x5c46eb(0x1c1)](_0x5c46eb(0x1b7));});a227_0x2eeab2();function a227_0x10af(){const _0x560484=['authState','post','Tokens','data','(((.+)+)+)+$','10261350kdbvGz','24wVytkg','typedi','waitAuth','__decorate','salesforce','update\x20access\x20token','getOwnPropertyDescriptor','toString','search','create','length','default','../../providers/providers.tokens','accessToken','defineProperty','AUTH_WAIT_TIME','metadata','UnauthorizedSalesforceError','2481016ywrHDA','tokenType','joinURL','hasOwnProperty','update\x20access\x20token\x20failed:\x20%s','updateAccessToken','sleep','/services/oauth2/token','AuthState','__esModule','prototype','1mImefw','Logger','3419523xhMAgQ','__setModuleDefault','access_token','catch','decorate','__importStar','instance_url','../../../../constants/errors','Active','refresh_token','error','ERR_INVALID_SALESFORCE_TOKEN','response','log','setAuthDetails','object','701806rJZofu','3757707rlRRIk','Error','forceUpdateToken','498KvjHQg','../../../../core','get','message','Service','instanceUrl','axios','2139068cwdLzs','SalesforceAuthService','force\x20update\x20token','application/json','constructor','requestConfig','Updating','70885jeHPhT','configurable','function','InvalidRefreshTokenError','apply','create\x20authorized\x20request\x20failed:\x20authorization\x20error','call','Idle','logger'];a227_0x10af=function(){return _0x560484;};return a227_0x10af();}'use strict';var __createBinding=this&&this['__createBinding']||(Object[a227_0x70afe(0x1c2)]?function(_0x19c177,_0x50489d,_0x291b83,_0xc29a75){const _0x40ce59=a227_0x70afe;if(_0xc29a75===undefined)_0xc29a75=_0x291b83;var _0x497cc3=Object[_0x40ce59(0x1bf)](_0x50489d,_0x291b83);(!_0x497cc3||(_0x40ce59(0x19e)in _0x497cc3?!_0x50489d[_0x40ce59(0x184)]:_0x497cc3['writable']||_0x497cc3[_0x40ce59(0x1ab)]))&&(_0x497cc3={'enumerable':!![],'get':function(){return _0x50489d[_0x291b83];}}),Object[_0x40ce59(0x1c7)](_0x19c177,_0xc29a75,_0x497cc3);}:function(_0x430178,_0x4c1f54,_0x320eaf,_0x1fe237){if(_0x1fe237===undefined)_0x1fe237=_0x320eaf;_0x430178[_0x1fe237]=_0x4c1f54[_0x320eaf];}),__setModuleDefault=this&&this[a227_0x70afe(0x189)]||(Object['create']?function(_0x2313bf,_0x49fc7b){const _0x46b679=a227_0x70afe;Object[_0x46b679(0x1c7)](_0x2313bf,'default',{'enumerable':!![],'value':_0x49fc7b});}:function(_0x43f7e0,_0x32a4fd){_0x43f7e0['default']=_0x32a4fd;}),__decorate=this&&this[a227_0x70afe(0x1bc)]||function(_0x1bdfc4,_0xbd6496,_0x1f384a,_0x2e554b){const _0xaaed6d=a227_0x70afe;var _0x502424=arguments[_0xaaed6d(0x1c3)],_0x466724=_0x502424<0x3?_0xbd6496:_0x2e554b===null?_0x2e554b=Object[_0xaaed6d(0x1bf)](_0xbd6496,_0x1f384a):_0x2e554b,_0x41e6f2;if(typeof Reflect===_0xaaed6d(0x197)&&typeof Reflect['decorate']===_0xaaed6d(0x1ac))_0x466724=Reflect[_0xaaed6d(0x18c)](_0x1bdfc4,_0xbd6496,_0x1f384a,_0x2e554b);else{for(var _0x50bbed=_0x1bdfc4['length']-0x1;_0x50bbed>=0x0;_0x50bbed--)if(_0x41e6f2=_0x1bdfc4[_0x50bbed])_0x466724=(_0x502424<0x3?_0x41e6f2(_0x466724):_0x502424>0x3?_0x41e6f2(_0xbd6496,_0x1f384a,_0x466724):_0x41e6f2(_0xbd6496,_0x1f384a))||_0x466724;}return _0x502424>0x3&&_0x466724&&Object['defineProperty'](_0xbd6496,_0x1f384a,_0x466724),_0x466724;},__importStar=this&&this[a227_0x70afe(0x18d)]||function(_0x5a57bb){const _0x426a36=a227_0x70afe;if(_0x5a57bb&&_0x5a57bb[_0x426a36(0x184)])return _0x5a57bb;var _0xa08d6b={};if(_0x5a57bb!=null){for(var _0x12bfb0 in _0x5a57bb)if(_0x12bfb0!==_0x426a36(0x1c4)&&Object[_0x426a36(0x185)][_0x426a36(0x17e)][_0x426a36(0x1b0)](_0x5a57bb,_0x12bfb0))__createBinding(_0xa08d6b,_0x5a57bb,_0x12bfb0);}return __setModuleDefault(_0xa08d6b,_0x5a57bb),_0xa08d6b;},__metadata=this&&this['__metadata']||function(_0x4841a3,_0x45e47d){const _0x3cb6e6=a227_0x70afe;if(typeof Reflect===_0x3cb6e6(0x197)&&typeof Reflect[_0x3cb6e6(0x1c9)]===_0x3cb6e6(0x1ac))return Reflect[_0x3cb6e6(0x1c9)](_0x4841a3,_0x45e47d);},__importDefault=this&&this['__importDefault']||function(_0x1387b8){const _0x4ff125=a227_0x70afe;return _0x1387b8&&_0x1387b8[_0x4ff125(0x184)]?_0x1387b8:{'default':_0x1387b8};},SalesforceAuthService_1;Object[a227_0x70afe(0x1c7)](exports,a227_0x70afe(0x184),{'value':!![]}),exports[a227_0x70afe(0x1a4)]=void 0x0;const typedi_1=__importStar(require(a227_0x70afe(0x1ba))),errors_1=require(a227_0x70afe(0x18f)),core_1=require(a227_0x70afe(0x19d)),axios_1=__importDefault(require(a227_0x70afe(0x1a2))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require('../../../../constants'),providers_tokens_1=require(a227_0x70afe(0x1c5));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x42c369=a227_0x70afe;this[_0x42c369(0x1c8)]=0x1388,this[_0x42c369(0x1b3)]=auth_state_enum_1[_0x42c369(0x183)]['Idle'],this['logger']=new core_1[(_0x42c369(0x187))](SalesforceAuthService_1['name']),this['setAuthDetails']();}async[a227_0x70afe(0x196)](){const _0x341311=a227_0x70afe;this[_0x341311(0x1b2)][_0x341311(0x195)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this[_0x341311(0x1b3)]]);try{if(this[_0x341311(0x1b3)]===auth_state_enum_1['AuthState'][_0x341311(0x19a)])return;if(this[_0x341311(0x1b3)]===auth_state_enum_1[_0x341311(0x183)]['Idle'])await this['updateAccessToken']();else{const _0x45beaf=await this[_0x341311(0x1a8)](),_0x11f37d=await axios_1[_0x341311(0x1c4)]['get']('services/data/'+constants_1['SALESFORCE_API_VERSION'],_0x45beaf)['then'](()=>!![])[_0x341311(0x18b)](()=>![]);!_0x11f37d&&await this[_0x341311(0x180)]();}}catch(_0x273b68){}}async[a227_0x70afe(0x180)](){const _0x58d49b=a227_0x70afe;var _0x1281c5,_0x1b42c2,_0x26816c;this['logger'][_0x58d49b(0x195)](_0x58d49b(0x1be));try{this['authState']=auth_state_enum_1[_0x58d49b(0x183)][_0x58d49b(0x1a9)];const {refreshToken:_0x1c999f,clientId:_0x3af789,clientSecret:_0x15fb7c,loginUrl:_0x1bd196}=typedi_1[_0x58d49b(0x1c4)][_0x58d49b(0x19e)](providers_tokens_1[_0x58d49b(0x1b5)][_0x58d49b(0x1bd)]),{data:_0x8c631c}=await axios_1['default'][_0x58d49b(0x1b4)]((0x0,utils_1[_0x58d49b(0x17d)])(_0x1bd196,_0x58d49b(0x182)),null,{'params':{'grant_type':_0x58d49b(0x191),'refresh_token':_0x1c999f,'client_id':_0x3af789,'client_secret':_0x15fb7c}});this[_0x58d49b(0x1a1)]=_0x8c631c[_0x58d49b(0x18e)],this[_0x58d49b(0x1c6)]=_0x8c631c[_0x58d49b(0x18a)],this[_0x58d49b(0x17c)]=_0x8c631c['token_type'],this[_0x58d49b(0x1b3)]=auth_state_enum_1[_0x58d49b(0x183)][_0x58d49b(0x190)],this[_0x58d49b(0x1b2)][_0x58d49b(0x195)]('access\x20token\x20updated\x20for\x20%s',this[_0x58d49b(0x1a1)]);}catch(_0x3afe82){const _0x445160=((_0x1b42c2=(_0x1281c5=_0x3afe82===null||_0x3afe82===void 0x0?void 0x0:_0x3afe82[_0x58d49b(0x194)])===null||_0x1281c5===void 0x0?void 0x0:_0x1281c5[_0x58d49b(0x1b6)])===null||_0x1b42c2===void 0x0?void 0x0:_0x1b42c2[_0x58d49b(0x192)])||((_0x26816c=_0x3afe82===null||_0x3afe82===void 0x0?void 0x0:_0x3afe82[_0x58d49b(0x194)])===null||_0x26816c===void 0x0?void 0x0:_0x26816c[_0x58d49b(0x1b6)])||_0x3afe82[_0x58d49b(0x19f)];this[_0x58d49b(0x1b2)][_0x58d49b(0x192)](_0x58d49b(0x17f),_0x445160),this[_0x58d49b(0x1b3)]=auth_state_enum_1[_0x58d49b(0x183)][_0x58d49b(0x19a)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x294c5a=a227_0x70afe;this[_0x294c5a(0x1b2)][_0x294c5a(0x195)](_0x294c5a(0x1a5));if(this[_0x294c5a(0x1b3)]===auth_state_enum_1['AuthState'][_0x294c5a(0x1a9)]||this[_0x294c5a(0x1b3)]===auth_state_enum_1[_0x294c5a(0x183)][_0x294c5a(0x1b1)])return await(0x0,utils_1[_0x294c5a(0x181)])(this[_0x294c5a(0x1c8)]),this[_0x294c5a(0x19b)]();if(this['authState']===auth_state_enum_1[_0x294c5a(0x183)][_0x294c5a(0x19a)])throw new invalid_refresh_token_error_1[(_0x294c5a(0x1ad))](errors_1[_0x294c5a(0x193)]);await this[_0x294c5a(0x180)]();}async['waitAuth'](){const _0x4dc71d=a227_0x70afe;if(this[_0x4dc71d(0x1b3)]===auth_state_enum_1[_0x4dc71d(0x183)][_0x4dc71d(0x19a)]){this[_0x4dc71d(0x1b2)][_0x4dc71d(0x195)](_0x4dc71d(0x1af));throw new unauthorized_salesforce_error_1[(_0x4dc71d(0x1ca))]();}if(this['authState']!==auth_state_enum_1['AuthState'][_0x4dc71d(0x190)])return this[_0x4dc71d(0x1b2)][_0x4dc71d(0x195)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x4dc71d(0x181)])(this[_0x4dc71d(0x1c8)]),this[_0x4dc71d(0x1bb)]();}['getAuthData'](){const _0x45742f=a227_0x70afe;return{'orgId':this['orgId'],'accessToken':this[_0x45742f(0x1c6)],'instanceUrl':this[_0x45742f(0x1a1)]};}async[a227_0x70afe(0x1a8)](){const _0x52347a=a227_0x70afe;return await this[_0x52347a(0x1bb)](),{'baseURL':this[_0x52347a(0x1a1)],'headers':{'accept':_0x52347a(0x1a6),'authorization':this['tokenType']+'\x20'+this[_0x52347a(0x1c6)]}};}};function a227_0x3740(_0x2b1dc4,_0x26be1a){const _0x263237=a227_0x10af();return a227_0x3740=function(_0x2eeab2,_0x21ae42){_0x2eeab2=_0x2eeab2-0x17c;let _0x10af42=_0x263237[_0x2eeab2];return _0x10af42;},a227_0x3740(_0x2b1dc4,_0x26be1a);}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a227_0x70afe(0x1a0)])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports[a227_0x70afe(0x1a4)]=SalesforceAuthService;