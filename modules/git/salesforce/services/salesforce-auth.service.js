function a243_0x1d76(){const _0x72ba34=['authState','forceUpdateToken','Service','Force\x20update\x20token','229353gwCUgt','sleep','AuthState','324LWodOp','instanceUrl','16KYKzWn','Update\x20access\x20token','__esModule','catch','search','prototype','waitAuth','../../../shared/utils','7UvtJzO','__importStar','(((.+)+)+)+$','../errors/unauthorized-salesforce.error','refresh_token','Update\x20access\x20token\x20failed:\x20%s','response','../../../../constants/errors','call','metadata','../errors/invalid-refresh-token.error','updateAccessToken','toString','message','/services/oauth2/token','8515EHBckh','application/json','axios','configurable','../../../../core','decorate','Idle','Error','2043ZYPcgb','function','2zCrJcj','ERR_INVALID_SALESFORCE_TOKEN','../../../../constants','12460YxdJji','typedi','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','accessToken','tokenType','5814830rNWoYD','Updating','Access\x20token\x20updated\x20for\x20%s','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','apply','logger','__createBinding','348458MnLRnK','default','create','__importDefault','defineProperty','2010KUgeIi','__metadata','Active','get','847384CeMuUc','design:paramtypes','39wWhMlq','requestConfig','salesforce','Tokens','SalesforceAuthService','log','services/data/','writable','length','169283OfHCnv','SALESFORCE_API_VERSION','hasOwnProperty','object','data','error','AUTH_WAIT_TIME','then','Logger'];a243_0x1d76=function(){return _0x72ba34;};return a243_0x1d76();}const a243_0x20275c=a243_0x71d8;(function(_0xb1e671,_0x5d8878){const _0x12bf01=a243_0x71d8,_0xe77908=_0xb1e671();while(!![]){try{const _0x452960=parseInt(_0x12bf01(0x106))/0x1*(parseInt(_0x12bf01(0xe3))/0x2)+parseInt(_0x12bf01(0x113))/0x3*(-parseInt(_0x12bf01(0x118))/0x4)+-parseInt(_0x12bf01(0xd9))/0x5*(-parseInt(_0x12bf01(0xf7))/0x6)+-parseInt(_0x12bf01(0xca))/0x7*(parseInt(_0x12bf01(0xfb))/0x8)+parseInt(_0x12bf01(0xe1))/0x9*(-parseInt(_0x12bf01(0xe6))/0xa)+parseInt(_0x12bf01(0xf2))/0xb*(-parseInt(_0x12bf01(0x116))/0xc)+-parseInt(_0x12bf01(0xfd))/0xd*(-parseInt(_0x12bf01(0xeb))/0xe);if(_0x452960===_0x5d8878)break;else _0xe77908['push'](_0xe77908['shift']());}catch(_0x41b1df){_0xe77908['push'](_0xe77908['shift']());}}}(a243_0x1d76,0x6a6ec));function a243_0x71d8(_0x1ee01a,_0x57f922){const _0x32fb02=a243_0x1d76();return a243_0x71d8=function(_0x171d89,_0x474bef){_0x171d89=_0x171d89-0xca;let _0x1d76b3=_0x32fb02[_0x171d89];return _0x1d76b3;},a243_0x71d8(_0x1ee01a,_0x57f922);}const a243_0x474bef=(function(){let _0xccd82=!![];return function(_0x238146,_0x3160e8){const _0x11b6a3=_0xccd82?function(){const _0x2fd852=a243_0x71d8;if(_0x3160e8){const _0x23c5b2=_0x3160e8[_0x2fd852(0xef)](_0x238146,arguments);return _0x3160e8=null,_0x23c5b2;}}:function(){};return _0xccd82=![],_0x11b6a3;};}()),a243_0x171d89=a243_0x474bef(this,function(){const _0x1cfbb5=a243_0x71d8;return a243_0x171d89[_0x1cfbb5(0xd6)]()[_0x1cfbb5(0x11c)](_0x1cfbb5(0xcc))[_0x1cfbb5(0xd6)]()['constructor'](a243_0x171d89)[_0x1cfbb5(0x11c)]('(((.+)+)+)+$');});a243_0x171d89();'use strict';var __createBinding=this&&this[a243_0x20275c(0xf1)]||(Object[a243_0x20275c(0xf4)]?function(_0x1dd04a,_0x96e2fd,_0x3fe2d4,_0x449dee){const _0x4cff65=a243_0x20275c;if(_0x449dee===undefined)_0x449dee=_0x3fe2d4;var _0x4b9e5d=Object['getOwnPropertyDescriptor'](_0x96e2fd,_0x3fe2d4);(!_0x4b9e5d||(_0x4cff65(0xfa)in _0x4b9e5d?!_0x96e2fd[_0x4cff65(0x11a)]:_0x4b9e5d[_0x4cff65(0x104)]||_0x4b9e5d[_0x4cff65(0xdc)]))&&(_0x4b9e5d={'enumerable':!![],'get':function(){return _0x96e2fd[_0x3fe2d4];}}),Object[_0x4cff65(0xf6)](_0x1dd04a,_0x449dee,_0x4b9e5d);}:function(_0x4f3664,_0x25b6b0,_0x3a39a6,_0x461095){if(_0x461095===undefined)_0x461095=_0x3a39a6;_0x4f3664[_0x461095]=_0x25b6b0[_0x3a39a6];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a243_0x20275c(0xf4)]?function(_0x4e8509,_0x5562ab){const _0x4cf6f7=a243_0x20275c;Object[_0x4cf6f7(0xf6)](_0x4e8509,'default',{'enumerable':!![],'value':_0x5562ab});}:function(_0x20a513,_0x1d1f42){const _0x5d6ff8=a243_0x20275c;_0x20a513[_0x5d6ff8(0xf3)]=_0x1d1f42;}),__decorate=this&&this['__decorate']||function(_0x4f13ca,_0x5645a2,_0x3714eb,_0xc378f){const _0x50114c=a243_0x20275c;var _0x5c6acc=arguments[_0x50114c(0x105)],_0x562d2e=_0x5c6acc<0x3?_0x5645a2:_0xc378f===null?_0xc378f=Object['getOwnPropertyDescriptor'](_0x5645a2,_0x3714eb):_0xc378f,_0x4dd447;if(typeof Reflect===_0x50114c(0x109)&&typeof Reflect[_0x50114c(0xde)]===_0x50114c(0xe2))_0x562d2e=Reflect[_0x50114c(0xde)](_0x4f13ca,_0x5645a2,_0x3714eb,_0xc378f);else{for(var _0x316943=_0x4f13ca[_0x50114c(0x105)]-0x1;_0x316943>=0x0;_0x316943--)if(_0x4dd447=_0x4f13ca[_0x316943])_0x562d2e=(_0x5c6acc<0x3?_0x4dd447(_0x562d2e):_0x5c6acc>0x3?_0x4dd447(_0x5645a2,_0x3714eb,_0x562d2e):_0x4dd447(_0x5645a2,_0x3714eb))||_0x562d2e;}return _0x5c6acc>0x3&&_0x562d2e&&Object[_0x50114c(0xf6)](_0x5645a2,_0x3714eb,_0x562d2e),_0x562d2e;},__importStar=this&&this[a243_0x20275c(0xcb)]||function(_0x4aa724){const _0x2082d0=a243_0x20275c;if(_0x4aa724&&_0x4aa724['__esModule'])return _0x4aa724;var _0x344c36={};if(_0x4aa724!=null){for(var _0x317313 in _0x4aa724)if(_0x317313!==_0x2082d0(0xf3)&&Object[_0x2082d0(0x11d)][_0x2082d0(0x108)][_0x2082d0(0xd2)](_0x4aa724,_0x317313))__createBinding(_0x344c36,_0x4aa724,_0x317313);}return __setModuleDefault(_0x344c36,_0x4aa724),_0x344c36;},__metadata=this&&this[a243_0x20275c(0xf8)]||function(_0x3c5c8b,_0x408d44){const _0x3006cd=a243_0x20275c;if(typeof Reflect===_0x3006cd(0x109)&&typeof Reflect[_0x3006cd(0xd3)]===_0x3006cd(0xe2))return Reflect[_0x3006cd(0xd3)](_0x3c5c8b,_0x408d44);},__importDefault=this&&this[a243_0x20275c(0xf5)]||function(_0x57bcf9){const _0x275fc6=a243_0x20275c;return _0x57bcf9&&_0x57bcf9[_0x275fc6(0x11a)]?_0x57bcf9:{'default':_0x57bcf9};},SalesforceAuthService_1;Object[a243_0x20275c(0xf6)](exports,a243_0x20275c(0x11a),{'value':!![]}),exports[a243_0x20275c(0x101)]=void 0x0;const typedi_1=__importStar(require(a243_0x20275c(0xe7))),errors_1=require(a243_0x20275c(0xd1)),core_1=require(a243_0x20275c(0xdd)),axios_1=__importDefault(require(a243_0x20275c(0xdb))),utils_1=require(a243_0x20275c(0x11f)),invalid_refresh_token_error_1=require(a243_0x20275c(0xd4)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a243_0x20275c(0xcd)),constants_1=require(a243_0x20275c(0xe5)),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x2bd38f=a243_0x20275c;this['AUTH_WAIT_TIME']=0x1388,this[_0x2bd38f(0x10f)]=auth_state_enum_1['AuthState'][_0x2bd38f(0xdf)],this[_0x2bd38f(0xf0)]=new core_1[(_0x2bd38f(0x10e))](SalesforceAuthService_1['name']),this['setAuthDetails']();}async['setAuthDetails'](){const _0x3180ef=a243_0x20275c;this[_0x3180ef(0xf0)]['log']('Check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x3180ef(0x115)][this[_0x3180ef(0x10f)]]);try{if(this[_0x3180ef(0x10f)]===auth_state_enum_1['AuthState'][_0x3180ef(0xe0)])return;if(this['authState']===auth_state_enum_1['AuthState'][_0x3180ef(0xdf)])await this[_0x3180ef(0xd5)]();else{const _0x4a53dc=await this[_0x3180ef(0xfe)](),_0xec50e1=await axios_1[_0x3180ef(0xf3)][_0x3180ef(0xfa)](_0x3180ef(0x103)+constants_1[_0x3180ef(0x107)],_0x4a53dc)[_0x3180ef(0x10d)](()=>!![])[_0x3180ef(0x11b)](()=>![]);!_0xec50e1&&await this['updateAccessToken']();}}catch(_0x4cc91f){}}async[a243_0x20275c(0xd5)](){const _0x724742=a243_0x20275c;var _0x225294,_0x5a60d9,_0xe54df4;this[_0x724742(0xf0)][_0x724742(0x102)](_0x724742(0x119));try{this[_0x724742(0x10f)]=auth_state_enum_1['AuthState'][_0x724742(0xec)];const {refreshToken:_0x3adcde,clientId:_0x1d725c,clientSecret:_0x4c41be,loginUrl:_0x1a1433}=typedi_1[_0x724742(0xf3)][_0x724742(0xfa)](providers_tokens_1[_0x724742(0x100)][_0x724742(0xff)]),{data:_0x26840a}=await axios_1['default']['post']((0x0,utils_1['joinURL'])(_0x1a1433,_0x724742(0xd8)),null,{'params':{'grant_type':_0x724742(0xce),'refresh_token':_0x3adcde,'client_id':_0x1d725c,'client_secret':_0x4c41be}});this[_0x724742(0x117)]=_0x26840a['instance_url'],this['accessToken']=_0x26840a['access_token'],this[_0x724742(0xea)]=_0x26840a['token_type'],this['authState']=auth_state_enum_1[_0x724742(0x115)]['Active'],this['logger'][_0x724742(0x102)](_0x724742(0xed),this[_0x724742(0x117)]);}catch(_0x1bdac5){const _0xb23d2d=((_0x5a60d9=(_0x225294=_0x1bdac5===null||_0x1bdac5===void 0x0?void 0x0:_0x1bdac5[_0x724742(0xd0)])===null||_0x225294===void 0x0?void 0x0:_0x225294[_0x724742(0x10a)])===null||_0x5a60d9===void 0x0?void 0x0:_0x5a60d9[_0x724742(0x10b)])||((_0xe54df4=_0x1bdac5===null||_0x1bdac5===void 0x0?void 0x0:_0x1bdac5[_0x724742(0xd0)])===null||_0xe54df4===void 0x0?void 0x0:_0xe54df4[_0x724742(0x10a)])||_0x1bdac5[_0x724742(0xd7)];this['logger'][_0x724742(0x10b)](_0x724742(0xcf),_0xb23d2d),this[_0x724742(0x10f)]=auth_state_enum_1[_0x724742(0x115)][_0x724742(0xe0)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x724742(0xe4)]);}}async[a243_0x20275c(0x110)](){const _0x1a180d=a243_0x20275c;this[_0x1a180d(0xf0)]['log'](_0x1a180d(0x112));if(this[_0x1a180d(0x10f)]===auth_state_enum_1[_0x1a180d(0x115)][_0x1a180d(0xec)]||this['authState']===auth_state_enum_1[_0x1a180d(0x115)][_0x1a180d(0xdf)])return await(0x0,utils_1[_0x1a180d(0x114)])(this[_0x1a180d(0x10c)]),this[_0x1a180d(0x110)]();if(this['authState']===auth_state_enum_1[_0x1a180d(0x115)][_0x1a180d(0xe0)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x1a180d(0xd5)]();}async['waitAuth'](){const _0x3a9c80=a243_0x20275c;if(this[_0x3a9c80(0x10f)]===auth_state_enum_1[_0x3a9c80(0x115)][_0x3a9c80(0xe0)]){this[_0x3a9c80(0xf0)]['log'](_0x3a9c80(0xe8));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x3a9c80(0x10f)]!==auth_state_enum_1[_0x3a9c80(0x115)][_0x3a9c80(0xf9)])return this[_0x3a9c80(0xf0)][_0x3a9c80(0x102)](_0x3a9c80(0xee)),await(0x0,utils_1[_0x3a9c80(0x114)])(this['AUTH_WAIT_TIME']),this[_0x3a9c80(0x11e)]();}['getAuthData'](){const _0x496d37=a243_0x20275c;return{'orgId':this['orgId'],'accessToken':this[_0x496d37(0xe9)],'instanceUrl':this[_0x496d37(0x117)]};}async['requestConfig'](){const _0x33e05a=a243_0x20275c;return await this[_0x33e05a(0x11e)](),{'baseURL':this[_0x33e05a(0x117)],'headers':{'accept':_0x33e05a(0xda),'authorization':this[_0x33e05a(0xea)]+'\x20'+this[_0x33e05a(0xe9)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a243_0x20275c(0x111)])(),__metadata(a243_0x20275c(0xfc),[])],SalesforceAuthService),exports[a243_0x20275c(0x101)]=SalesforceAuthService;