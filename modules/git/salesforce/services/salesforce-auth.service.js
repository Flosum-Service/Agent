const a269_0x411719=a269_0x3ce3;(function(_0x29e66a,_0x4d6fb3){const _0x197790=a269_0x3ce3,_0x49ac2c=_0x29e66a();while(!![]){try{const _0x2a22c7=parseInt(_0x197790(0xd3))/0x1+parseInt(_0x197790(0x12a))/0x2*(-parseInt(_0x197790(0x11b))/0x3)+-parseInt(_0x197790(0xf9))/0x4+-parseInt(_0x197790(0x12d))/0x5*(-parseInt(_0x197790(0xc9))/0x6)+parseInt(_0x197790(0xed))/0x7*(-parseInt(_0x197790(0x10b))/0x8)+-parseInt(_0x197790(0x113))/0x9*(-parseInt(_0x197790(0x120))/0xa)+parseInt(_0x197790(0xd9))/0xb;if(_0x2a22c7===_0x4d6fb3)break;else _0x49ac2c['push'](_0x49ac2c['shift']());}catch(_0x5cc79d){_0x49ac2c['push'](_0x49ac2c['shift']());}}}(a269_0x44b1,0xb1dfd));const a269_0x4bf893=(function(){let _0x51a4bf=!![];return function(_0x4006dc,_0x4d592c){const _0x38a771=_0x51a4bf?function(){const _0x4df589=a269_0x3ce3;if(_0x4d592c){const _0x1a22fd=_0x4d592c[_0x4df589(0x105)](_0x4006dc,arguments);return _0x4d592c=null,_0x1a22fd;}}:function(){};return _0x51a4bf=![],_0x38a771;};}()),a269_0x52f410=a269_0x4bf893(this,function(){const _0x5d7946=a269_0x3ce3;return a269_0x52f410[_0x5d7946(0xec)]()[_0x5d7946(0xe7)](_0x5d7946(0x11f))[_0x5d7946(0xec)]()[_0x5d7946(0x10a)](a269_0x52f410)[_0x5d7946(0xe7)](_0x5d7946(0x11f));});a269_0x52f410();'use strict';var __createBinding=this&&this[a269_0x411719(0x117)]||(Object[a269_0x411719(0x10f)]?function(_0x59cd73,_0x5650cc,_0x149ac7,_0x23551e){const _0x46349d=a269_0x411719;if(_0x23551e===undefined)_0x23551e=_0x149ac7;var _0x4db123=Object[_0x46349d(0x123)](_0x5650cc,_0x149ac7);(!_0x4db123||('get'in _0x4db123?!_0x5650cc[_0x46349d(0x101)]:_0x4db123[_0x46349d(0x104)]||_0x4db123[_0x46349d(0xd8)]))&&(_0x4db123={'enumerable':!![],'get':function(){return _0x5650cc[_0x149ac7];}}),Object[_0x46349d(0xdf)](_0x59cd73,_0x23551e,_0x4db123);}:function(_0x4b046c,_0x719821,_0x48e744,_0x48de0e){if(_0x48de0e===undefined)_0x48de0e=_0x48e744;_0x4b046c[_0x48de0e]=_0x719821[_0x48e744];}),__setModuleDefault=this&&this[a269_0x411719(0xf0)]||(Object[a269_0x411719(0x10f)]?function(_0x388675,_0x4f17d8){const _0x451056=a269_0x411719;Object[_0x451056(0xdf)](_0x388675,_0x451056(0xe1),{'enumerable':!![],'value':_0x4f17d8});}:function(_0x331c94,_0x217d03){const _0x529f32=a269_0x411719;_0x331c94[_0x529f32(0xe1)]=_0x217d03;}),__decorate=this&&this[a269_0x411719(0x108)]||function(_0x2f0a2e,_0x2768ef,_0x4a50ad,_0x15f625){const _0x465bb8=a269_0x411719;var _0x385796=arguments[_0x465bb8(0xda)],_0xd75a6f=_0x385796<0x3?_0x2768ef:_0x15f625===null?_0x15f625=Object[_0x465bb8(0x123)](_0x2768ef,_0x4a50ad):_0x15f625,_0x597ba0;if(typeof Reflect===_0x465bb8(0xde)&&typeof Reflect['decorate']===_0x465bb8(0xe4))_0xd75a6f=Reflect['decorate'](_0x2f0a2e,_0x2768ef,_0x4a50ad,_0x15f625);else{for(var _0x55ed04=_0x2f0a2e[_0x465bb8(0xda)]-0x1;_0x55ed04>=0x0;_0x55ed04--)if(_0x597ba0=_0x2f0a2e[_0x55ed04])_0xd75a6f=(_0x385796<0x3?_0x597ba0(_0xd75a6f):_0x385796>0x3?_0x597ba0(_0x2768ef,_0x4a50ad,_0xd75a6f):_0x597ba0(_0x2768ef,_0x4a50ad))||_0xd75a6f;}return _0x385796>0x3&&_0xd75a6f&&Object[_0x465bb8(0xdf)](_0x2768ef,_0x4a50ad,_0xd75a6f),_0xd75a6f;},__importStar=this&&this[a269_0x411719(0xf7)]||function(_0x2285c1){const _0x2b5b9a=a269_0x411719;if(_0x2285c1&&_0x2285c1[_0x2b5b9a(0x101)])return _0x2285c1;var _0x16448c={};if(_0x2285c1!=null){for(var _0x532fb3 in _0x2285c1)if(_0x532fb3!==_0x2b5b9a(0xe1)&&Object[_0x2b5b9a(0x125)][_0x2b5b9a(0xdd)][_0x2b5b9a(0xe8)](_0x2285c1,_0x532fb3))__createBinding(_0x16448c,_0x2285c1,_0x532fb3);}return __setModuleDefault(_0x16448c,_0x2285c1),_0x16448c;},__metadata=this&&this[a269_0x411719(0xc8)]||function(_0x1a2705,_0x14a8b6){const _0x4131f7=a269_0x411719;if(typeof Reflect===_0x4131f7(0xde)&&typeof Reflect[_0x4131f7(0x118)]===_0x4131f7(0xe4))return Reflect['metadata'](_0x1a2705,_0x14a8b6);},__importDefault=this&&this[a269_0x411719(0xe9)]||function(_0x3b8990){const _0xc63724=a269_0x411719;return _0x3b8990&&_0x3b8990[_0xc63724(0x101)]?_0x3b8990:{'default':_0x3b8990};},SalesforceAuthService_1;function a269_0x3ce3(_0xfedb91,_0x2a152b){const _0x4e014a=a269_0x44b1();return a269_0x3ce3=function(_0x52f410,_0x4bf893){_0x52f410=_0x52f410-0xc8;let _0x44b1e3=_0x4e014a[_0x52f410];return _0x44b1e3;},a269_0x3ce3(_0xfedb91,_0x2a152b);}Object[a269_0x411719(0xdf)](exports,a269_0x411719(0x101),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a269_0x411719(0x10e))),errors_1=require(a269_0x411719(0x112)),core_1=require(a269_0x411719(0xd0)),axios_1=__importDefault(require(a269_0x411719(0x106))),utils_1=require(a269_0x411719(0xe3)),invalid_refresh_token_error_1=require(a269_0x411719(0x102)),auth_state_enum_1=require(a269_0x411719(0xdb)),unauthorized_salesforce_error_1=require(a269_0x411719(0xf5)),constants_1=require(a269_0x411719(0x121)),providers_tokens_1=require(a269_0x411719(0xcc)),salesforce_1=require(a269_0x411719(0xcb));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x57fcb0=a269_0x411719;this[_0x57fcb0(0x100)]=0x1388,this[_0x57fcb0(0xd4)]=auth_state_enum_1[_0x57fcb0(0x107)][_0x57fcb0(0xfe)],this[_0x57fcb0(0xfd)]=new core_1[(_0x57fcb0(0x111))](SalesforceAuthService_1[_0x57fcb0(0xee)]),this[_0x57fcb0(0x10c)]();}async[a269_0x411719(0x10c)](){const _0x38dafe=a269_0x411719;this[_0x38dafe(0xfd)][_0x38dafe(0x119)](_0x38dafe(0xf4),auth_state_enum_1[_0x38dafe(0x107)][this[_0x38dafe(0xd4)]]);try{if(this['authState']===auth_state_enum_1[_0x38dafe(0x107)][_0x38dafe(0x11c)])return;if(this[_0x38dafe(0xd4)]===auth_state_enum_1[_0x38dafe(0x107)][_0x38dafe(0xfe)])await this[_0x38dafe(0xeb)]();else{const _0x454eb9=await this[_0x38dafe(0xea)](),_0x4d71f8=await axios_1[_0x38dafe(0xe1)][_0x38dafe(0xf8)](_0x38dafe(0xcd)+constants_1[_0x38dafe(0xf6)],_0x454eb9)[_0x38dafe(0x110)](()=>!![])[_0x38dafe(0x126)](()=>![]);!_0x4d71f8&&await this[_0x38dafe(0xeb)]();}}catch(_0x42450a){}}async[a269_0x411719(0xeb)](){const _0x3d67dd=a269_0x411719;var _0x2a8c87,_0xb2d23f,_0x19b92b;this[_0x3d67dd(0xfd)]['log']('Update\x20access\x20token');try{this['authState']=auth_state_enum_1[_0x3d67dd(0x107)]['Updating'];const {refreshToken:_0x43f4d6,clientId:_0x5f32b7,clientSecret:_0x1f03d9,loginUrl:_0x4bfc18}=typedi_1[_0x3d67dd(0xe1)][_0x3d67dd(0xf8)](providers_tokens_1['Tokens'][_0x3d67dd(0x11a)]),{data:_0x20e9ef}=await axios_1[_0x3d67dd(0xe1)]['post']((0x0,utils_1[_0x3d67dd(0xfc)])(_0x4bfc18,'/services/oauth2/token'),null,{'params':{'grant_type':_0x3d67dd(0x109),'refresh_token':_0x43f4d6,'client_id':_0x5f32b7,'client_secret':_0x1f03d9}});this['instanceUrl']=_0x20e9ef[_0x3d67dd(0x10d)],this['accessToken']=_0x20e9ef[_0x3d67dd(0xd7)],this['tokenType']=_0x20e9ef[_0x3d67dd(0xdc)],this['authState']=auth_state_enum_1[_0x3d67dd(0x107)]['Active'],this[_0x3d67dd(0xfd)]['log']('Access\x20token\x20updated\x20for\x20%s',this['instanceUrl']);}catch(_0xa4a604){const _0x4498dd=((_0xb2d23f=(_0x2a8c87=_0xa4a604===null||_0xa4a604===void 0x0?void 0x0:_0xa4a604[_0x3d67dd(0xd1)])===null||_0x2a8c87===void 0x0?void 0x0:_0x2a8c87[_0x3d67dd(0x115)])===null||_0xb2d23f===void 0x0?void 0x0:_0xb2d23f[_0x3d67dd(0x103)])||((_0x19b92b=_0xa4a604===null||_0xa4a604===void 0x0?void 0x0:_0xa4a604[_0x3d67dd(0xd1)])===null||_0x19b92b===void 0x0?void 0x0:_0x19b92b[_0x3d67dd(0x115)])||_0xa4a604[_0x3d67dd(0xf1)];this[_0x3d67dd(0xfd)]['error'](_0x3d67dd(0x12e),_0x4498dd),this[_0x3d67dd(0xd4)]=auth_state_enum_1[_0x3d67dd(0x107)][_0x3d67dd(0x11c)];throw new invalid_refresh_token_error_1[(_0x3d67dd(0x129))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a269_0x411719(0xfa)](){const _0xb78438=a269_0x411719;this['logger']['log'](_0xb78438(0x11d));if(this[_0xb78438(0xd4)]===auth_state_enum_1[_0xb78438(0x107)][_0xb78438(0xef)]||this[_0xb78438(0xd4)]===auth_state_enum_1[_0xb78438(0x107)][_0xb78438(0xfe)])return await(0x0,utils_1['sleep'])(this[_0xb78438(0x100)]),this[_0xb78438(0xfa)]();if(this[_0xb78438(0xd4)]===auth_state_enum_1['AuthState'][_0xb78438(0x11c)])throw new invalid_refresh_token_error_1[(_0xb78438(0x129))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0xb78438(0xeb)]();}async[a269_0x411719(0xce)](){const _0x1f97de=a269_0x411719;if(this['authState']===auth_state_enum_1[_0x1f97de(0x107)][_0x1f97de(0x11c)]){this[_0x1f97de(0xfd)]['log'](_0x1f97de(0x122));throw new unauthorized_salesforce_error_1[(_0x1f97de(0xf2))]();}if(this[_0x1f97de(0xd4)]!==auth_state_enum_1[_0x1f97de(0x107)][_0x1f97de(0x127)])return this[_0x1f97de(0xfd)][_0x1f97de(0x119)](_0x1f97de(0xe2)),await(0x0,utils_1[_0x1f97de(0xfb)])(this[_0x1f97de(0x100)]),this[_0x1f97de(0xce)]();}[a269_0x411719(0xca)](){const _0x55a9ed=a269_0x411719;return{'orgId':this[_0x55a9ed(0xf3)],'accessToken':this['accessToken'],'instanceUrl':this[_0x55a9ed(0xe5)]};}async[a269_0x411719(0xea)](_0x45372e=''){const _0x12d7a7=a269_0x411719;await this[_0x12d7a7(0xce)]();const _0x4d73a8={'baseURL':this[_0x12d7a7(0xe5)],'headers':{'accept':_0x12d7a7(0x116)}};if(salesforce_1[_0x12d7a7(0xd2)][_0x12d7a7(0xe0)](_0x45372e))_0x4d73a8[_0x12d7a7(0xd6)][_0x12d7a7(0x124)]=this[_0x12d7a7(0xcf)];else salesforce_1[_0x12d7a7(0xd2)][_0x12d7a7(0x11e)](_0x45372e)?_0x4d73a8['data']=_0x4d73a8[_0x12d7a7(0x115)][_0x12d7a7(0x12c)](/<met:sessionId>.+?<\/met:sessionId>/,_0x12d7a7(0xe6)+this['accessToken']+_0x12d7a7(0xff)):_0x4d73a8[_0x12d7a7(0xd6)]['authorization']=this[_0x12d7a7(0xd5)]+'\x20'+this[_0x12d7a7(0xcf)];return _0x4d73a8;}};function a269_0x44b1(){const _0x562810=['@flosum/salesforce','../../providers/providers.tokens','services/data/','waitAuth','accessToken','../../../../core','response','SalesforceUtils','534641jcaYaI','authState','tokenType','headers','access_token','configurable','12890977ueZrUo','length','../enums/auth-state.enum','token_type','hasOwnProperty','object','defineProperty','isBulk1Url','default','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','../../../shared/utils','function','instanceUrl','<met:sessionId>','search','call','__importDefault','requestConfig','updateAccessToken','toString','977921fnqzIi','name','Updating','__setModuleDefault','message','UnauthorizedSalesforceError','orgId','Check\x20auth:\x20current\x20state\x20-\x20%s','../errors/unauthorized-salesforce.error','SALESFORCE_API_VERSION','__importStar','get','1823024NGOcMR','forceUpdateToken','sleep','joinURL','logger','Idle','</met:sessionId>','AUTH_WAIT_TIME','__esModule','../errors/invalid-refresh-token.error','error','writable','apply','axios','AuthState','__decorate','refresh_token','constructor','80XipLku','setAuthDetails','instance_url','typedi','create','then','Logger','../../../../constants/errors','9166401IyYsBx','design:paramtypes','data','application/json','__createBinding','metadata','log','salesforce','18eHPvAc','Error','Force\x20update\x20token','isSoapUrl','(((.+)+)+)+$','10aaJrlQ','../../../../constants','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','getOwnPropertyDescriptor','X-SFDC-Session','prototype','catch','Active','SalesforceAuthService','InvalidRefreshTokenError','311210Ajvfby','Service','replace','61715UVwEqA','Update\x20access\x20token\x20failed:\x20%s','__metadata','384nqGUka','getAuthData'];a269_0x44b1=function(){return _0x562810;};return a269_0x44b1();}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a269_0x411719(0x12b)])(),__metadata(a269_0x411719(0x114),[])],SalesforceAuthService),exports[a269_0x411719(0x128)]=SalesforceAuthService;