const a180_0x3f87b3=a180_0x47ff;function a180_0xd3cc(){const _0x116e27=['../../../../constants/errors','setAuthDetails','logger','defineProperty','SalesforceAuthService','accessToken','Error','create\x20authorized\x20request\x20failed:\x20authorization\x20error','prototype','waitAuth','access_token','1047QaulOI','160375zMOFkk','toString','Updating','error','default','ERR_INVALID_SALESFORCE_TOKEN','check\x20auth:\x20current\x20state\x20-\x20%s','tokenType','../../../shared/utils','length','Tokens','SALESFORCE_API_VERSION','2066JPZZeh','__esModule','constructor','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','../../providers/providers.tokens','__importDefault','__importStar','/services/oauth2/token','Active','AUTH_WAIT_TIME','__decorate','(((.+)+)+)+$','4700017ILpUvr','Idle','../errors/unauthorized-salesforce.error','application/json','2756940iFcRqM','then','Service','call','__metadata','321200gtyJgw','UnauthorizedSalesforceError','../../../../core','post','getAuthData','../../../../constants','access\x20token\x20updated\x20for\x20%s','decorate','function','update\x20access\x20token\x20failed:\x20%s','InvalidRefreshTokenError','response','../errors/invalid-refresh-token.error','updateAccessToken','search','sleep','name','1923024FnSMhY','metadata','catch','force\x20update\x20token','requestConfig','../enums/auth-state.enum','authState','forceUpdateToken','joinURL','get','2189780mYyttl','AuthState','instanceUrl','update\x20access\x20token','services/data/','instance_url','__setModuleDefault','log','data','axios','getOwnPropertyDescriptor'];a180_0xd3cc=function(){return _0x116e27;};return a180_0xd3cc();}(function(_0x3c23ba,_0x4a2f3a){const _0x19b213=a180_0x47ff,_0x53b46a=_0x3c23ba();while(!![]){try{const _0xf7f5c0=parseInt(_0x19b213(0x133))/0x1+-parseInt(_0x19b213(0x11e))/0x2*(-parseInt(_0x19b213(0x164))/0x3)+parseInt(_0x19b213(0x14e))/0x4+parseInt(_0x19b213(0x165))/0x5+-parseInt(_0x19b213(0x12e))/0x6+-parseInt(_0x19b213(0x12a))/0x7+parseInt(_0x19b213(0x144))/0x8;if(_0xf7f5c0===_0x4a2f3a)break;else _0x53b46a['push'](_0x53b46a['shift']());}catch(_0x5bd5e3){_0x53b46a['push'](_0x53b46a['shift']());}}}(a180_0xd3cc,0x5a806));const a180_0x2ca86f=(function(){let _0x5e10fe=!![];return function(_0x166f20,_0x5ad826){const _0x1c488c=_0x5e10fe?function(){if(_0x5ad826){const _0x279d9d=_0x5ad826['apply'](_0x166f20,arguments);return _0x5ad826=null,_0x279d9d;}}:function(){};return _0x5e10fe=![],_0x1c488c;};}()),a180_0x40c3ba=a180_0x2ca86f(this,function(){const _0x1685d9=a180_0x47ff;return a180_0x40c3ba['toString']()[_0x1685d9(0x141)](_0x1685d9(0x129))[_0x1685d9(0x166)]()[_0x1685d9(0x120)](a180_0x40c3ba)['search'](_0x1685d9(0x129));});a180_0x40c3ba();'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x4a0477,_0x4f9866,_0x4b4248,_0x4c9ddd){const _0x245d54=a180_0x47ff;if(_0x4c9ddd===undefined)_0x4c9ddd=_0x4b4248;Object[_0x245d54(0x15c)](_0x4a0477,_0x4c9ddd,{'enumerable':!![],'get':function(){return _0x4f9866[_0x4b4248];}});}:function(_0x4dd8cf,_0x2663fa,_0x5f137b,_0x3c3626){if(_0x3c3626===undefined)_0x3c3626=_0x5f137b;_0x4dd8cf[_0x3c3626]=_0x2663fa[_0x5f137b];}),__setModuleDefault=this&&this[a180_0x3f87b3(0x154)]||(Object['create']?function(_0x33e061,_0x2c053c){const _0x90dc7e=a180_0x3f87b3;Object['defineProperty'](_0x33e061,_0x90dc7e(0x169),{'enumerable':!![],'value':_0x2c053c});}:function(_0x4eefaa,_0x2c640b){_0x4eefaa['default']=_0x2c640b;}),__decorate=this&&this[a180_0x3f87b3(0x128)]||function(_0x46468b,_0x30acf3,_0x57b0cf,_0x461899){const _0x4b2bf0=a180_0x3f87b3;var _0xb3e01b=arguments[_0x4b2bf0(0x11b)],_0x3beff5=_0xb3e01b<0x3?_0x30acf3:_0x461899===null?_0x461899=Object[_0x4b2bf0(0x158)](_0x30acf3,_0x57b0cf):_0x461899,_0x31b838;if(typeof Reflect==='object'&&typeof Reflect[_0x4b2bf0(0x13a)]===_0x4b2bf0(0x13b))_0x3beff5=Reflect[_0x4b2bf0(0x13a)](_0x46468b,_0x30acf3,_0x57b0cf,_0x461899);else{for(var _0x29e047=_0x46468b['length']-0x1;_0x29e047>=0x0;_0x29e047--)if(_0x31b838=_0x46468b[_0x29e047])_0x3beff5=(_0xb3e01b<0x3?_0x31b838(_0x3beff5):_0xb3e01b>0x3?_0x31b838(_0x30acf3,_0x57b0cf,_0x3beff5):_0x31b838(_0x30acf3,_0x57b0cf))||_0x3beff5;}return _0xb3e01b>0x3&&_0x3beff5&&Object['defineProperty'](_0x30acf3,_0x57b0cf,_0x3beff5),_0x3beff5;},__importStar=this&&this[a180_0x3f87b3(0x124)]||function(_0x3c094d){const _0x1e9af6=a180_0x3f87b3;if(_0x3c094d&&_0x3c094d[_0x1e9af6(0x11f)])return _0x3c094d;var _0xbae228={};if(_0x3c094d!=null){for(var _0x373846 in _0x3c094d)if(_0x373846!=='default'&&Object[_0x1e9af6(0x161)]['hasOwnProperty'][_0x1e9af6(0x131)](_0x3c094d,_0x373846))__createBinding(_0xbae228,_0x3c094d,_0x373846);}return __setModuleDefault(_0xbae228,_0x3c094d),_0xbae228;},__metadata=this&&this[a180_0x3f87b3(0x132)]||function(_0x3019b9,_0x5e7981){const _0x534a07=a180_0x3f87b3;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x534a07(0x145)](_0x3019b9,_0x5e7981);},__importDefault=this&&this[a180_0x3f87b3(0x123)]||function(_0x103cad){const _0x5c31ca=a180_0x3f87b3;return _0x103cad&&_0x103cad[_0x5c31ca(0x11f)]?_0x103cad:{'default':_0x103cad};},SalesforceAuthService_1;Object[a180_0x3f87b3(0x15c)](exports,'__esModule',{'value':!![]}),exports[a180_0x3f87b3(0x15d)]=void 0x0;const typedi_1=__importStar(require('typedi')),errors_1=require(a180_0x3f87b3(0x159)),core_1=require(a180_0x3f87b3(0x135)),axios_1=__importDefault(require(a180_0x3f87b3(0x157))),utils_1=require(a180_0x3f87b3(0x11a)),invalid_refresh_token_error_1=require(a180_0x3f87b3(0x13f)),auth_state_enum_1=require(a180_0x3f87b3(0x149)),unauthorized_salesforce_error_1=require(a180_0x3f87b3(0x12c)),constants_1=require(a180_0x3f87b3(0x138)),providers_tokens_1=require(a180_0x3f87b3(0x122));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x1195f4=a180_0x3f87b3;this['AUTH_WAIT_TIME']=0x1388,this['authState']=auth_state_enum_1['AuthState'][_0x1195f4(0x12b)],this[_0x1195f4(0x15b)]=new core_1['Logger'](SalesforceAuthService_1[_0x1195f4(0x143)]),this[_0x1195f4(0x15a)]();}async['setAuthDetails'](){const _0x21a06c=a180_0x3f87b3;this[_0x21a06c(0x15b)][_0x21a06c(0x155)](_0x21a06c(0x118),auth_state_enum_1['AuthState'][this[_0x21a06c(0x14a)]]);try{if(this[_0x21a06c(0x14a)]===auth_state_enum_1[_0x21a06c(0x14f)][_0x21a06c(0x15f)])return;if(this[_0x21a06c(0x14a)]===auth_state_enum_1[_0x21a06c(0x14f)][_0x21a06c(0x12b)])await this[_0x21a06c(0x140)]();else{const _0xc98fbd=await this[_0x21a06c(0x148)](),_0x5e33f3=await axios_1['default'][_0x21a06c(0x14d)](_0x21a06c(0x152)+constants_1[_0x21a06c(0x11d)],_0xc98fbd)[_0x21a06c(0x12f)](()=>!![])[_0x21a06c(0x146)](()=>![]);!_0x5e33f3&&await this[_0x21a06c(0x140)]();}}catch(_0x5a0dfd){}}async['updateAccessToken'](){const _0x189e04=a180_0x3f87b3;var _0x20d029,_0x306ade,_0x1b213e;this['logger'][_0x189e04(0x155)](_0x189e04(0x151));try{this['authState']=auth_state_enum_1[_0x189e04(0x14f)][_0x189e04(0x167)];const {refreshToken:_0x180875,clientId:_0x3c82b2,clientSecret:_0x5ed563,loginUrl:_0x25493a}=typedi_1[_0x189e04(0x169)]['get'](providers_tokens_1[_0x189e04(0x11c)]['salesforce']),{data:_0x597eb1}=await axios_1[_0x189e04(0x169)][_0x189e04(0x136)](utils_1[_0x189e04(0x14c)](_0x25493a,_0x189e04(0x125)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x180875,'client_id':_0x3c82b2,'client_secret':_0x5ed563}});this[_0x189e04(0x150)]=_0x597eb1[_0x189e04(0x153)],this[_0x189e04(0x15e)]=_0x597eb1[_0x189e04(0x163)],this[_0x189e04(0x119)]=_0x597eb1['token_type'],this[_0x189e04(0x14a)]=auth_state_enum_1[_0x189e04(0x14f)]['Active'],this[_0x189e04(0x15b)][_0x189e04(0x155)](_0x189e04(0x139),this[_0x189e04(0x150)]);}catch(_0x17982e){const _0x4ca5de=((_0x306ade=(_0x20d029=_0x17982e===null||_0x17982e===void 0x0?void 0x0:_0x17982e[_0x189e04(0x13e)])===null||_0x20d029===void 0x0?void 0x0:_0x20d029['data'])===null||_0x306ade===void 0x0?void 0x0:_0x306ade[_0x189e04(0x168)])||((_0x1b213e=_0x17982e===null||_0x17982e===void 0x0?void 0x0:_0x17982e[_0x189e04(0x13e)])===null||_0x1b213e===void 0x0?void 0x0:_0x1b213e[_0x189e04(0x156)])||_0x17982e['message'];this[_0x189e04(0x15b)][_0x189e04(0x168)](_0x189e04(0x13c),_0x4ca5de),this[_0x189e04(0x14a)]=auth_state_enum_1[_0x189e04(0x14f)]['Error'];throw new invalid_refresh_token_error_1[(_0x189e04(0x13d))](errors_1[_0x189e04(0x117)]);}}async['forceUpdateToken'](){const _0x32f481=a180_0x3f87b3;this[_0x32f481(0x15b)]['log'](_0x32f481(0x147));if(this[_0x32f481(0x14a)]===auth_state_enum_1[_0x32f481(0x14f)][_0x32f481(0x167)]||this[_0x32f481(0x14a)]===auth_state_enum_1['AuthState']['Idle'])return await utils_1['sleep'](this['AUTH_WAIT_TIME']),this[_0x32f481(0x14b)]();if(this['authState']===auth_state_enum_1['AuthState'][_0x32f481(0x15f)])throw new invalid_refresh_token_error_1[(_0x32f481(0x13d))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this['updateAccessToken']();}async[a180_0x3f87b3(0x162)](){const _0x456499=a180_0x3f87b3;if(this[_0x456499(0x14a)]===auth_state_enum_1[_0x456499(0x14f)][_0x456499(0x15f)]){this[_0x456499(0x15b)][_0x456499(0x155)](_0x456499(0x160));throw new unauthorized_salesforce_error_1[(_0x456499(0x134))]();}if(this[_0x456499(0x14a)]!==auth_state_enum_1[_0x456499(0x14f)][_0x456499(0x126)])return this[_0x456499(0x15b)]['log'](_0x456499(0x121)),await utils_1[_0x456499(0x142)](this[_0x456499(0x127)]),this[_0x456499(0x162)]();}[a180_0x3f87b3(0x137)](){const _0x12b073=a180_0x3f87b3;return{'orgId':this['orgId'],'accessToken':this[_0x12b073(0x15e)],'instanceUrl':this[_0x12b073(0x150)]};}async[a180_0x3f87b3(0x148)](){const _0x2d2e50=a180_0x3f87b3;return await this['waitAuth'](),{'baseURL':this[_0x2d2e50(0x150)],'headers':{'accept':_0x2d2e50(0x12d),'authorization':this[_0x2d2e50(0x119)]+'\x20'+this[_0x2d2e50(0x15e)]}};}};function a180_0x47ff(_0x5432d1,_0x48df48){const _0x4b0589=a180_0xd3cc();return a180_0x47ff=function(_0x40c3ba,_0x2ca86f){_0x40c3ba=_0x40c3ba-0x117;let _0xd3cc7e=_0x4b0589[_0x40c3ba];return _0xd3cc7e;},a180_0x47ff(_0x5432d1,_0x48df48);}SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a180_0x3f87b3(0x130)](),__metadata('design:paramtypes',[])],SalesforceAuthService),exports[a180_0x3f87b3(0x15d)]=SalesforceAuthService;