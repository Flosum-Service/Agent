const a269_0x286b7c=a269_0x2d15;function a269_0x2d15(_0x4e169f,_0x515fec){const _0x5a33f4=a269_0x25a4();return a269_0x2d15=function(_0x156154,_0x14945f){_0x156154=_0x156154-0xd3;let _0x25a42b=_0x5a33f4[_0x156154];return _0x25a42b;},a269_0x2d15(_0x4e169f,_0x515fec);}function a269_0x25a4(){const _0x18cfc3=['Logger','getAuthData','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','replace','__esModule','ERR_INVALID_SALESFORCE_TOKEN','SalesforceUtils','1xVlQFV','../../../shared/utils','SalesforceAuthService','../../../../constants/errors','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','token_type','AUTH_WAIT_TIME','__setModuleDefault','Idle','1779678aNlIWl','(((.+)+)+)+$','updateAccessToken','post','5339306FwxXOA','__importStar','orgId','forceUpdateToken','error','../../providers/providers.tokens','decorate','Updating','joinURL','tokenType','search','2121886PRAVAX','default','access_token','constructor','create','log','Error','Update\x20access\x20token','hasOwnProperty','waitAuth','109404vvoAkf','UnauthorizedSalesforceError','catch','__createBinding','</met:sessionId>','2067621MfdSMk','sleep','message','Service','isSoapUrl','AuthState','length','../../../../core','Force\x20update\x20token','X-SFDC-Session','1915356nPhAId','response','design:paramtypes','setAuthDetails','Update\x20access\x20token\x20failed:\x20%s','toString','axios','apply','application/json','headers','instance_url','../errors/unauthorized-salesforce.error','writable','__decorate','InvalidRefreshTokenError','Active','accessToken','logger','requestConfig','/services/oauth2/token','__metadata','services/data/','function','../errors/invalid-refresh-token.error','8msyqLn','instanceUrl','authState','defineProperty','20liLIpv','12404520avLcCo','salesforce','authorization','../enums/auth-state.enum','data'];a269_0x25a4=function(){return _0x18cfc3;};return a269_0x25a4();}(function(_0x32cb5f,_0x201c73){const _0x3c7b9d=a269_0x2d15,_0x28e87=_0x32cb5f();while(!![]){try{const _0x1a511b=-parseInt(_0x3c7b9d(0x112))/0x1*(-parseInt(_0x3c7b9d(0x12a))/0x2)+-parseInt(_0x3c7b9d(0xdf))/0x3+-parseInt(_0x3c7b9d(0xe9))/0x4+-parseInt(_0x3c7b9d(0x105))/0x5*(-parseInt(_0x3c7b9d(0xda))/0x6)+parseInt(_0x3c7b9d(0x11f))/0x7*(-parseInt(_0x3c7b9d(0x101))/0x8)+parseInt(_0x3c7b9d(0x11b))/0x9+parseInt(_0x3c7b9d(0x106))/0xa;if(_0x1a511b===_0x201c73)break;else _0x28e87['push'](_0x28e87['shift']());}catch(_0x4959f8){_0x28e87['push'](_0x28e87['shift']());}}}(a269_0x25a4,0x9c8f5));const a269_0x14945f=(function(){let _0x50d158=!![];return function(_0x47bfa5,_0x3b3daf){const _0x5adeb6=_0x50d158?function(){const _0x317bc6=a269_0x2d15;if(_0x3b3daf){const _0xbeac17=_0x3b3daf[_0x317bc6(0xf0)](_0x47bfa5,arguments);return _0x3b3daf=null,_0xbeac17;}}:function(){};return _0x50d158=![],_0x5adeb6;};}()),a269_0x156154=a269_0x14945f(this,function(){const _0x513ac4=a269_0x2d15;return a269_0x156154['toString']()[_0x513ac4(0x129)]('(((.+)+)+)+$')[_0x513ac4(0xee)]()[_0x513ac4(0xd3)](a269_0x156154)[_0x513ac4(0x129)](_0x513ac4(0x11c));});a269_0x156154();'use strict';var __createBinding=this&&this[a269_0x286b7c(0xdd)]||(Object['create']?function(_0x1df79f,_0x46fd3e,_0x207637,_0x4b5f8f){const _0xe2eaed=a269_0x286b7c;if(_0x4b5f8f===undefined)_0x4b5f8f=_0x207637;var _0x5cc914=Object['getOwnPropertyDescriptor'](_0x46fd3e,_0x207637);(!_0x5cc914||('get'in _0x5cc914?!_0x46fd3e[_0xe2eaed(0x10f)]:_0x5cc914[_0xe2eaed(0xf5)]||_0x5cc914['configurable']))&&(_0x5cc914={'enumerable':!![],'get':function(){return _0x46fd3e[_0x207637];}}),Object[_0xe2eaed(0x104)](_0x1df79f,_0x4b5f8f,_0x5cc914);}:function(_0x2e215d,_0x42ce81,_0x214a22,_0x3eace1){if(_0x3eace1===undefined)_0x3eace1=_0x214a22;_0x2e215d[_0x3eace1]=_0x42ce81[_0x214a22];}),__setModuleDefault=this&&this[a269_0x286b7c(0x119)]||(Object[a269_0x286b7c(0xd4)]?function(_0x3ec56b,_0x4251d9){const _0x3734c0=a269_0x286b7c;Object[_0x3734c0(0x104)](_0x3ec56b,'default',{'enumerable':!![],'value':_0x4251d9});}:function(_0x12dcaa,_0x4bf131){const _0x52d501=a269_0x286b7c;_0x12dcaa[_0x52d501(0x12b)]=_0x4bf131;}),__decorate=this&&this[a269_0x286b7c(0xf6)]||function(_0x5974b2,_0x15f98d,_0x59661c,_0x1008c7){const _0xa94509=a269_0x286b7c;var _0x3272e6=arguments[_0xa94509(0xe5)],_0x51a5cc=_0x3272e6<0x3?_0x15f98d:_0x1008c7===null?_0x1008c7=Object['getOwnPropertyDescriptor'](_0x15f98d,_0x59661c):_0x1008c7,_0x32acba;if(typeof Reflect==='object'&&typeof Reflect[_0xa94509(0x125)]===_0xa94509(0xff))_0x51a5cc=Reflect[_0xa94509(0x125)](_0x5974b2,_0x15f98d,_0x59661c,_0x1008c7);else{for(var _0x443b66=_0x5974b2[_0xa94509(0xe5)]-0x1;_0x443b66>=0x0;_0x443b66--)if(_0x32acba=_0x5974b2[_0x443b66])_0x51a5cc=(_0x3272e6<0x3?_0x32acba(_0x51a5cc):_0x3272e6>0x3?_0x32acba(_0x15f98d,_0x59661c,_0x51a5cc):_0x32acba(_0x15f98d,_0x59661c))||_0x51a5cc;}return _0x3272e6>0x3&&_0x51a5cc&&Object[_0xa94509(0x104)](_0x15f98d,_0x59661c,_0x51a5cc),_0x51a5cc;},__importStar=this&&this[a269_0x286b7c(0x120)]||function(_0x5e0eee){const _0x171212=a269_0x286b7c;if(_0x5e0eee&&_0x5e0eee[_0x171212(0x10f)])return _0x5e0eee;var _0x6812b3={};if(_0x5e0eee!=null){for(var _0x15a490 in _0x5e0eee)if(_0x15a490!=='default'&&Object['prototype'][_0x171212(0xd8)]['call'](_0x5e0eee,_0x15a490))__createBinding(_0x6812b3,_0x5e0eee,_0x15a490);}return __setModuleDefault(_0x6812b3,_0x5e0eee),_0x6812b3;},__metadata=this&&this[a269_0x286b7c(0xfd)]||function(_0x284634,_0x11ef09){const _0x52570f=a269_0x286b7c;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x52570f(0xff))return Reflect['metadata'](_0x284634,_0x11ef09);},__importDefault=this&&this['__importDefault']||function(_0x166494){return _0x166494&&_0x166494['__esModule']?_0x166494:{'default':_0x166494};},SalesforceAuthService_1;Object['defineProperty'](exports,a269_0x286b7c(0x10f),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require('typedi')),errors_1=require(a269_0x286b7c(0x115)),core_1=require(a269_0x286b7c(0xe6)),axios_1=__importDefault(require(a269_0x286b7c(0xef))),utils_1=require(a269_0x286b7c(0x113)),invalid_refresh_token_error_1=require(a269_0x286b7c(0x100)),auth_state_enum_1=require(a269_0x286b7c(0x109)),unauthorized_salesforce_error_1=require(a269_0x286b7c(0xf4)),constants_1=require('../../../../constants'),providers_tokens_1=require(a269_0x286b7c(0x124)),salesforce_1=require('@flosum/salesforce');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x31507e=a269_0x286b7c;this[_0x31507e(0x118)]=0x1388,this[_0x31507e(0x103)]=auth_state_enum_1[_0x31507e(0xe4)]['Idle'],this[_0x31507e(0xfa)]=new core_1[(_0x31507e(0x10b))](SalesforceAuthService_1['name']),this[_0x31507e(0xec)]();}async[a269_0x286b7c(0xec)](){const _0x3a33f0=a269_0x286b7c;this['logger'][_0x3a33f0(0xd5)]('Check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x3a33f0(0xe4)][this[_0x3a33f0(0x103)]]);try{if(this[_0x3a33f0(0x103)]===auth_state_enum_1[_0x3a33f0(0xe4)][_0x3a33f0(0xd6)])return;if(this[_0x3a33f0(0x103)]===auth_state_enum_1[_0x3a33f0(0xe4)][_0x3a33f0(0x11a)])await this[_0x3a33f0(0x11d)]();else{const _0x3bcbb0=await this[_0x3a33f0(0xfb)](),_0x1b73d8=await axios_1[_0x3a33f0(0x12b)]['get'](_0x3a33f0(0xfe)+constants_1['SALESFORCE_API_VERSION'],_0x3bcbb0)['then'](()=>!![])[_0x3a33f0(0xdc)](()=>![]);!_0x1b73d8&&await this['updateAccessToken']();}}catch(_0x46ec82){}}async[a269_0x286b7c(0x11d)](){const _0x3759f4=a269_0x286b7c;var _0x12eb0b,_0x417682,_0x55f859;this[_0x3759f4(0xfa)][_0x3759f4(0xd5)](_0x3759f4(0xd7));try{this['authState']=auth_state_enum_1['AuthState'][_0x3759f4(0x126)];const {refreshToken:_0x8fdafa,clientId:_0x437b15,clientSecret:_0x548bc0,loginUrl:_0x502bb9}=typedi_1[_0x3759f4(0x12b)]['get'](providers_tokens_1['Tokens'][_0x3759f4(0x107)]),{data:_0xd7612}=await axios_1['default'][_0x3759f4(0x11e)]((0x0,utils_1[_0x3759f4(0x127)])(_0x502bb9,_0x3759f4(0xfc)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x8fdafa,'client_id':_0x437b15,'client_secret':_0x548bc0}});this[_0x3759f4(0x102)]=_0xd7612[_0x3759f4(0xf3)],this[_0x3759f4(0xf9)]=_0xd7612[_0x3759f4(0x12c)],this[_0x3759f4(0x128)]=_0xd7612[_0x3759f4(0x117)],this[_0x3759f4(0x103)]=auth_state_enum_1[_0x3759f4(0xe4)][_0x3759f4(0xf8)],this['logger'][_0x3759f4(0xd5)]('Access\x20token\x20updated\x20for\x20%s',this['instanceUrl']);}catch(_0x6bdbb){const _0x2c7a14=((_0x417682=(_0x12eb0b=_0x6bdbb===null||_0x6bdbb===void 0x0?void 0x0:_0x6bdbb[_0x3759f4(0xea)])===null||_0x12eb0b===void 0x0?void 0x0:_0x12eb0b[_0x3759f4(0x10a)])===null||_0x417682===void 0x0?void 0x0:_0x417682[_0x3759f4(0x123)])||((_0x55f859=_0x6bdbb===null||_0x6bdbb===void 0x0?void 0x0:_0x6bdbb['response'])===null||_0x55f859===void 0x0?void 0x0:_0x55f859['data'])||_0x6bdbb[_0x3759f4(0xe1)];this['logger'][_0x3759f4(0x123)](_0x3759f4(0xed),_0x2c7a14),this[_0x3759f4(0x103)]=auth_state_enum_1[_0x3759f4(0xe4)]['Error'];throw new invalid_refresh_token_error_1[(_0x3759f4(0xf7))](errors_1[_0x3759f4(0x110)]);}}async[a269_0x286b7c(0x122)](){const _0x205106=a269_0x286b7c;this[_0x205106(0xfa)][_0x205106(0xd5)](_0x205106(0xe7));if(this[_0x205106(0x103)]===auth_state_enum_1[_0x205106(0xe4)][_0x205106(0x126)]||this[_0x205106(0x103)]===auth_state_enum_1['AuthState'][_0x205106(0x11a)])return await(0x0,utils_1[_0x205106(0xe0)])(this[_0x205106(0x118)]),this[_0x205106(0x122)]();if(this['authState']===auth_state_enum_1[_0x205106(0xe4)][_0x205106(0xd6)])throw new invalid_refresh_token_error_1[(_0x205106(0xf7))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x205106(0x11d)]();}async[a269_0x286b7c(0xd9)](){const _0x212485=a269_0x286b7c;if(this[_0x212485(0x103)]===auth_state_enum_1[_0x212485(0xe4)]['Error']){this[_0x212485(0xfa)]['log'](_0x212485(0x116));throw new unauthorized_salesforce_error_1[(_0x212485(0xdb))]();}if(this[_0x212485(0x103)]!==auth_state_enum_1['AuthState'][_0x212485(0xf8)])return this[_0x212485(0xfa)]['log'](_0x212485(0x10d)),await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this['waitAuth']();}[a269_0x286b7c(0x10c)](){const _0x2a9878=a269_0x286b7c;return{'orgId':this[_0x2a9878(0x121)],'accessToken':this[_0x2a9878(0xf9)],'instanceUrl':this[_0x2a9878(0x102)]};}async[a269_0x286b7c(0xfb)](_0x1a82be=''){const _0xae8be2=a269_0x286b7c;await this[_0xae8be2(0xd9)]();const _0x3bd615={'baseURL':this[_0xae8be2(0x102)],'headers':{'accept':_0xae8be2(0xf1)}};if(salesforce_1['SalesforceUtils']['isBulk1Url'](_0x1a82be))_0x3bd615[_0xae8be2(0xf2)][_0xae8be2(0xe8)]=this['accessToken'];else salesforce_1[_0xae8be2(0x111)][_0xae8be2(0xe3)](_0x1a82be)?_0x3bd615[_0xae8be2(0x10a)]=_0x3bd615['data'][_0xae8be2(0x10e)](/<met:sessionId>.+?<\/met:sessionId>/,'<met:sessionId>'+this[_0xae8be2(0xf9)]+_0xae8be2(0xde)):_0x3bd615[_0xae8be2(0xf2)][_0xae8be2(0x108)]=this[_0xae8be2(0x128)]+'\x20'+this['accessToken'];return _0x3bd615;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a269_0x286b7c(0xe2)])(),__metadata(a269_0x286b7c(0xeb),[])],SalesforceAuthService),exports[a269_0x286b7c(0x114)]=SalesforceAuthService;