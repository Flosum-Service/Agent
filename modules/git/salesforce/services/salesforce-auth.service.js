const a270_0x3c9698=a270_0x1694;(function(_0x4fdf24,_0x1f676d){const _0x121949=a270_0x1694,_0x4b54b2=_0x4fdf24();while(!![]){try{const _0x4c641f=-parseInt(_0x121949(0x17e))/0x1*(parseInt(_0x121949(0x19f))/0x2)+-parseInt(_0x121949(0x194))/0x3*(-parseInt(_0x121949(0x17a))/0x4)+-parseInt(_0x121949(0x177))/0x5+parseInt(_0x121949(0x1b3))/0x6+parseInt(_0x121949(0x187))/0x7*(-parseInt(_0x121949(0x18b))/0x8)+-parseInt(_0x121949(0x1c5))/0x9*(parseInt(_0x121949(0x1c8))/0xa)+parseInt(_0x121949(0x192))/0xb*(parseInt(_0x121949(0x1aa))/0xc);if(_0x4c641f===_0x1f676d)break;else _0x4b54b2['push'](_0x4b54b2['shift']());}catch(_0x107ed1){_0x4b54b2['push'](_0x4b54b2['shift']());}}}(a270_0x41fa,0xad1f8));function a270_0x41fa(){const _0x5eb08c=['InvalidRefreshTokenError','Update\x20access\x20token','updateAccessToken','call','SalesforceUtils','Access\x20token\x20updated\x20for\x20%s','1755798USKjMR','data','__metadata','Error','post','length','catch','object','name','../errors/unauthorized-salesforce.error','getOwnPropertyDescriptor','../../../../constants/errors','SALESFORCE_API_VERSION','decorate','prototype','Active','configurable','orgId','6346719AXWFuv','../errors/invalid-refresh-token.error','X-SFDC-Session','10NPITPJ','(((.+)+)+)+$','replace','joinURL','ERR_INVALID_SALESFORCE_TOKEN','default','function','SalesforceAuthService','AUTH_WAIT_TIME','apply','Logger','getAuthData','error','logger','1452830BHHwDu','authorization','writable','4fvULya','../../../shared/utils','services/data/','log','1MISCrH','get','Service','headers','@flosum/salesforce','AuthState','../../../../constants','isSoapUrl','__importStar','4249JMAtbX','sleep','requestConfig','salesforce','15848CXsrib','instanceUrl','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','axios','</met:sessionId>','create','../enums/auth-state.enum','6237gXCHan','application/json','3732507paXKPm','__esModule','__decorate','accessToken','defineProperty','authState','tokenType','metadata','__importDefault','waitAuth','setAuthDetails','2465126QRQPlQ','__createBinding','access_token','search','response','toString','Updating','refresh_token','UnauthorizedSalesforceError','/services/oauth2/token','Idle','55092XuxjMO','forceUpdateToken','../../providers/providers.tokens'];a270_0x41fa=function(){return _0x5eb08c;};return a270_0x41fa();}const a270_0x484f89=(function(){let _0x121d30=!![];return function(_0x42bcb5,_0x266203){const _0x3f074e=_0x121d30?function(){const _0x59783a=a270_0x1694;if(_0x266203){const _0x2987f4=_0x266203[_0x59783a(0x172)](_0x42bcb5,arguments);return _0x266203=null,_0x2987f4;}}:function(){};return _0x121d30=![],_0x3f074e;};}()),a270_0x4bb0a6=a270_0x484f89(this,function(){const _0x4f3072=a270_0x1694;return a270_0x4bb0a6[_0x4f3072(0x1a4)]()[_0x4f3072(0x1a2)](_0x4f3072(0x1c9))[_0x4f3072(0x1a4)]()['constructor'](a270_0x4bb0a6)[_0x4f3072(0x1a2)]('(((.+)+)+)+$');});a270_0x4bb0a6();'use strict';function a270_0x1694(_0x148c4b,_0x55cfaa){const _0x334be4=a270_0x41fa();return a270_0x1694=function(_0x4bb0a6,_0x484f89){_0x4bb0a6=_0x4bb0a6-0x172;let _0x41fadd=_0x334be4[_0x4bb0a6];return _0x41fadd;},a270_0x1694(_0x148c4b,_0x55cfaa);}var __createBinding=this&&this[a270_0x3c9698(0x1a0)]||(Object[a270_0x3c9698(0x190)]?function(_0x1f165c,_0x3469ce,_0x324e15,_0x50686c){const _0x28bda3=a270_0x3c9698;if(_0x50686c===undefined)_0x50686c=_0x324e15;var _0x2e7f0a=Object['getOwnPropertyDescriptor'](_0x3469ce,_0x324e15);(!_0x2e7f0a||(_0x28bda3(0x17f)in _0x2e7f0a?!_0x3469ce[_0x28bda3(0x195)]:_0x2e7f0a[_0x28bda3(0x179)]||_0x2e7f0a[_0x28bda3(0x1c3)]))&&(_0x2e7f0a={'enumerable':!![],'get':function(){return _0x3469ce[_0x324e15];}}),Object[_0x28bda3(0x198)](_0x1f165c,_0x50686c,_0x2e7f0a);}:function(_0x2739d8,_0x2e3432,_0x5ae5d3,_0x5e92b5){if(_0x5e92b5===undefined)_0x5e92b5=_0x5ae5d3;_0x2739d8[_0x5e92b5]=_0x2e3432[_0x5ae5d3];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a270_0x3c9698(0x190)]?function(_0x3e7d51,_0x315900){const _0xeafd80=a270_0x3c9698;Object[_0xeafd80(0x198)](_0x3e7d51,_0xeafd80(0x1cd),{'enumerable':!![],'value':_0x315900});}:function(_0x61d97c,_0x95d50f){const _0x5802fd=a270_0x3c9698;_0x61d97c[_0x5802fd(0x1cd)]=_0x95d50f;}),__decorate=this&&this[a270_0x3c9698(0x196)]||function(_0x111930,_0x1343ef,_0x96947e,_0x147672){const _0x49784c=a270_0x3c9698;var _0x3d6f91=arguments[_0x49784c(0x1b8)],_0x45f7e7=_0x3d6f91<0x3?_0x1343ef:_0x147672===null?_0x147672=Object[_0x49784c(0x1bd)](_0x1343ef,_0x96947e):_0x147672,_0x1ff046;if(typeof Reflect===_0x49784c(0x1ba)&&typeof Reflect['decorate']===_0x49784c(0x1ce))_0x45f7e7=Reflect[_0x49784c(0x1c0)](_0x111930,_0x1343ef,_0x96947e,_0x147672);else{for(var _0x1cf928=_0x111930['length']-0x1;_0x1cf928>=0x0;_0x1cf928--)if(_0x1ff046=_0x111930[_0x1cf928])_0x45f7e7=(_0x3d6f91<0x3?_0x1ff046(_0x45f7e7):_0x3d6f91>0x3?_0x1ff046(_0x1343ef,_0x96947e,_0x45f7e7):_0x1ff046(_0x1343ef,_0x96947e))||_0x45f7e7;}return _0x3d6f91>0x3&&_0x45f7e7&&Object['defineProperty'](_0x1343ef,_0x96947e,_0x45f7e7),_0x45f7e7;},__importStar=this&&this[a270_0x3c9698(0x186)]||function(_0x5c566f){const _0x28f22c=a270_0x3c9698;if(_0x5c566f&&_0x5c566f[_0x28f22c(0x195)])return _0x5c566f;var _0x1e3228={};if(_0x5c566f!=null){for(var _0x460ab3 in _0x5c566f)if(_0x460ab3!==_0x28f22c(0x1cd)&&Object[_0x28f22c(0x1c1)]['hasOwnProperty'][_0x28f22c(0x1b0)](_0x5c566f,_0x460ab3))__createBinding(_0x1e3228,_0x5c566f,_0x460ab3);}return __setModuleDefault(_0x1e3228,_0x5c566f),_0x1e3228;},__metadata=this&&this[a270_0x3c9698(0x1b5)]||function(_0x52edac,_0x348da4){const _0x15056b=a270_0x3c9698;if(typeof Reflect===_0x15056b(0x1ba)&&typeof Reflect[_0x15056b(0x19b)]===_0x15056b(0x1ce))return Reflect[_0x15056b(0x19b)](_0x52edac,_0x348da4);},__importDefault=this&&this[a270_0x3c9698(0x19c)]||function(_0x51b66c){return _0x51b66c&&_0x51b66c['__esModule']?_0x51b66c:{'default':_0x51b66c};},SalesforceAuthService_1;Object[a270_0x3c9698(0x198)](exports,a270_0x3c9698(0x195),{'value':!![]}),exports[a270_0x3c9698(0x1cf)]=void 0x0;const typedi_1=__importStar(require('typedi')),errors_1=require(a270_0x3c9698(0x1be)),core_1=require('../../../../core'),axios_1=__importDefault(require(a270_0x3c9698(0x18e))),utils_1=require(a270_0x3c9698(0x17b)),invalid_refresh_token_error_1=require(a270_0x3c9698(0x1c6)),auth_state_enum_1=require(a270_0x3c9698(0x191)),unauthorized_salesforce_error_1=require(a270_0x3c9698(0x1bc)),constants_1=require(a270_0x3c9698(0x184)),providers_tokens_1=require(a270_0x3c9698(0x1ac)),salesforce_1=require(a270_0x3c9698(0x182));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x4192e0=a270_0x3c9698;this[_0x4192e0(0x1d0)]=0x1388,this[_0x4192e0(0x199)]=auth_state_enum_1[_0x4192e0(0x183)][_0x4192e0(0x1a9)],this[_0x4192e0(0x176)]=new core_1[(_0x4192e0(0x173))](SalesforceAuthService_1[_0x4192e0(0x1bb)]),this[_0x4192e0(0x19e)]();}async['setAuthDetails'](){const _0x1c4db9=a270_0x3c9698;this[_0x1c4db9(0x176)]['log']('Check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x1c4db9(0x183)][this[_0x1c4db9(0x199)]]);try{if(this[_0x1c4db9(0x199)]===auth_state_enum_1[_0x1c4db9(0x183)]['Error'])return;if(this[_0x1c4db9(0x199)]===auth_state_enum_1[_0x1c4db9(0x183)][_0x1c4db9(0x1a9)])await this['updateAccessToken']();else{const _0x1eeefd=await this[_0x1c4db9(0x189)](),_0x1006bc=await axios_1['default'][_0x1c4db9(0x17f)](_0x1c4db9(0x17c)+constants_1[_0x1c4db9(0x1bf)],_0x1eeefd)['then'](()=>!![])[_0x1c4db9(0x1b9)](()=>![]);!_0x1006bc&&await this[_0x1c4db9(0x1af)]();}}catch(_0x9741fc){}}async[a270_0x3c9698(0x1af)](){const _0x52046d=a270_0x3c9698;var _0xf6d2ab,_0x592113,_0x450afe;this[_0x52046d(0x176)][_0x52046d(0x17d)](_0x52046d(0x1ae));try{this[_0x52046d(0x199)]=auth_state_enum_1[_0x52046d(0x183)][_0x52046d(0x1a5)];const {refreshToken:_0x4b8217,clientId:_0x574564,clientSecret:_0x31637d,loginUrl:_0x3f0342}=typedi_1['default'][_0x52046d(0x17f)](providers_tokens_1['Tokens'][_0x52046d(0x18a)]),{data:_0x6c71d7}=await axios_1[_0x52046d(0x1cd)][_0x52046d(0x1b7)]((0x0,utils_1[_0x52046d(0x1cb)])(_0x3f0342,_0x52046d(0x1a8)),null,{'params':{'grant_type':_0x52046d(0x1a6),'refresh_token':_0x4b8217,'client_id':_0x574564,'client_secret':_0x31637d}});this[_0x52046d(0x18c)]=_0x6c71d7['instance_url'],this['accessToken']=_0x6c71d7[_0x52046d(0x1a1)],this[_0x52046d(0x19a)]=_0x6c71d7['token_type'],this['authState']=auth_state_enum_1[_0x52046d(0x183)][_0x52046d(0x1c2)],this['logger'][_0x52046d(0x17d)](_0x52046d(0x1b2),this[_0x52046d(0x18c)]);}catch(_0x448d43){const _0x5d2703=((_0x592113=(_0xf6d2ab=_0x448d43===null||_0x448d43===void 0x0?void 0x0:_0x448d43[_0x52046d(0x1a3)])===null||_0xf6d2ab===void 0x0?void 0x0:_0xf6d2ab[_0x52046d(0x1b4)])===null||_0x592113===void 0x0?void 0x0:_0x592113[_0x52046d(0x175)])||((_0x450afe=_0x448d43===null||_0x448d43===void 0x0?void 0x0:_0x448d43['response'])===null||_0x450afe===void 0x0?void 0x0:_0x450afe[_0x52046d(0x1b4)])||_0x448d43['message'];this[_0x52046d(0x176)]['error']('Update\x20access\x20token\x20failed:\x20%s',_0x5d2703),this[_0x52046d(0x199)]=auth_state_enum_1[_0x52046d(0x183)]['Error'];throw new invalid_refresh_token_error_1[(_0x52046d(0x1ad))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a270_0x3c9698(0x1ab)](){const _0x123f1d=a270_0x3c9698;this[_0x123f1d(0x176)][_0x123f1d(0x17d)]('Force\x20update\x20token');if(this[_0x123f1d(0x199)]===auth_state_enum_1[_0x123f1d(0x183)][_0x123f1d(0x1a5)]||this[_0x123f1d(0x199)]===auth_state_enum_1[_0x123f1d(0x183)][_0x123f1d(0x1a9)])return await(0x0,utils_1[_0x123f1d(0x188)])(this[_0x123f1d(0x1d0)]),this[_0x123f1d(0x1ab)]();if(this[_0x123f1d(0x199)]===auth_state_enum_1[_0x123f1d(0x183)]['Error'])throw new invalid_refresh_token_error_1[(_0x123f1d(0x1ad))](errors_1[_0x123f1d(0x1cc)]);await this[_0x123f1d(0x1af)]();}async[a270_0x3c9698(0x19d)](){const _0x17f591=a270_0x3c9698;if(this[_0x17f591(0x199)]===auth_state_enum_1[_0x17f591(0x183)][_0x17f591(0x1b6)]){this[_0x17f591(0x176)][_0x17f591(0x17d)](_0x17f591(0x18d));throw new unauthorized_salesforce_error_1[(_0x17f591(0x1a7))]();}if(this[_0x17f591(0x199)]!==auth_state_enum_1[_0x17f591(0x183)][_0x17f591(0x1c2)])return this[_0x17f591(0x176)][_0x17f591(0x17d)]('Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x17f591(0x188)])(this[_0x17f591(0x1d0)]),this['waitAuth']();}[a270_0x3c9698(0x174)](){const _0x22b0be=a270_0x3c9698;return{'orgId':this[_0x22b0be(0x1c4)],'accessToken':this[_0x22b0be(0x197)],'instanceUrl':this['instanceUrl']};}async[a270_0x3c9698(0x189)](_0x25c04f=''){const _0x442a46=a270_0x3c9698;await this[_0x442a46(0x19d)]();const _0x7c9889={'baseURL':this['instanceUrl'],'headers':{'accept':_0x442a46(0x193)}};if(salesforce_1[_0x442a46(0x1b1)]['isBulk1Url'](_0x25c04f))_0x7c9889['headers'][_0x442a46(0x1c7)]=this['accessToken'];else salesforce_1[_0x442a46(0x1b1)][_0x442a46(0x185)](_0x25c04f)?_0x7c9889[_0x442a46(0x1b4)]=_0x7c9889[_0x442a46(0x1b4)][_0x442a46(0x1ca)](/<met:sessionId>.+?<\/met:sessionId>/,'<met:sessionId>'+this[_0x442a46(0x197)]+_0x442a46(0x18f)):_0x7c9889[_0x442a46(0x181)][_0x442a46(0x178)]=this[_0x442a46(0x19a)]+'\x20'+this[_0x442a46(0x197)];return _0x7c9889;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a270_0x3c9698(0x180)])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports[a270_0x3c9698(0x1cf)]=SalesforceAuthService;