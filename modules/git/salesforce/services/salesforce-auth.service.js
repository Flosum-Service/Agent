const a232_0x2c3835=a232_0x23d1;function a232_0x23d1(_0x41fb2c,_0x5634c2){const _0x3a3829=a232_0x4bbd();return a232_0x23d1=function(_0x14d8a7,_0x1eaef6){_0x14d8a7=_0x14d8a7-0x142;let _0x4bbd6f=_0x3a3829[_0x14d8a7];return _0x4bbd6f;},a232_0x23d1(_0x41fb2c,_0x5634c2);}(function(_0x4654b9,_0x28dc06){const _0xcf08d8=a232_0x23d1,_0x1943a9=_0x4654b9();while(!![]){try{const _0x3dbc8d=-parseInt(_0xcf08d8(0x188))/0x1*(parseInt(_0xcf08d8(0x186))/0x2)+parseInt(_0xcf08d8(0x193))/0x3*(-parseInt(_0xcf08d8(0x180))/0x4)+-parseInt(_0xcf08d8(0x18a))/0x5*(-parseInt(_0xcf08d8(0x194))/0x6)+-parseInt(_0xcf08d8(0x16a))/0x7*(-parseInt(_0xcf08d8(0x166))/0x8)+parseInt(_0xcf08d8(0x192))/0x9+-parseInt(_0xcf08d8(0x146))/0xa+-parseInt(_0xcf08d8(0x19a))/0xb*(-parseInt(_0xcf08d8(0x17b))/0xc);if(_0x3dbc8d===_0x28dc06)break;else _0x1943a9['push'](_0x1943a9['shift']());}catch(_0x21cca6){_0x1943a9['push'](_0x1943a9['shift']());}}}(a232_0x4bbd,0x96cc4));const a232_0x1eaef6=(function(){let _0x5b15bc=!![];return function(_0x5c0b0c,_0x11b78c){const _0x4bb881=_0x5b15bc?function(){const _0x38d86a=a232_0x23d1;if(_0x11b78c){const _0xd3cf35=_0x11b78c[_0x38d86a(0x17e)](_0x5c0b0c,arguments);return _0x11b78c=null,_0xd3cf35;}}:function(){};return _0x5b15bc=![],_0x4bb881;};}()),a232_0x14d8a7=a232_0x1eaef6(this,function(){const _0x562c76=a232_0x23d1;return a232_0x14d8a7[_0x562c76(0x14a)]()[_0x562c76(0x196)](_0x562c76(0x15c))[_0x562c76(0x14a)]()[_0x562c76(0x14d)](a232_0x14d8a7)[_0x562c76(0x196)](_0x562c76(0x15c));});a232_0x14d8a7();'use strict';var __createBinding=this&&this[a232_0x2c3835(0x167)]||(Object['create']?function(_0x32fc1f,_0x20050e,_0xf47389,_0x231b18){const _0x49e8c9=a232_0x2c3835;if(_0x231b18===undefined)_0x231b18=_0xf47389;var _0x8d8b9b=Object[_0x49e8c9(0x174)](_0x20050e,_0xf47389);(!_0x8d8b9b||(_0x49e8c9(0x148)in _0x8d8b9b?!_0x20050e[_0x49e8c9(0x150)]:_0x8d8b9b[_0x49e8c9(0x17d)]||_0x8d8b9b[_0x49e8c9(0x142)]))&&(_0x8d8b9b={'enumerable':!![],'get':function(){return _0x20050e[_0xf47389];}}),Object[_0x49e8c9(0x16e)](_0x32fc1f,_0x231b18,_0x8d8b9b);}:function(_0xea2c7a,_0x2a4dd6,_0x16e1e4,_0x5019ab){if(_0x5019ab===undefined)_0x5019ab=_0x16e1e4;_0xea2c7a[_0x5019ab]=_0x2a4dd6[_0x16e1e4];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a232_0x2c3835(0x158)]?function(_0x4cad06,_0xa7df41){const _0x1c76f4=a232_0x2c3835;Object[_0x1c76f4(0x16e)](_0x4cad06,_0x1c76f4(0x15d),{'enumerable':!![],'value':_0xa7df41});}:function(_0x5fdd11,_0x13ae54){_0x5fdd11['default']=_0x13ae54;}),__decorate=this&&this[a232_0x2c3835(0x157)]||function(_0x5360ae,_0x15fccf,_0x247cef,_0x112d66){const _0x2eb9a3=a232_0x2c3835;var _0x32ed95=arguments['length'],_0x2b2adb=_0x32ed95<0x3?_0x15fccf:_0x112d66===null?_0x112d66=Object[_0x2eb9a3(0x174)](_0x15fccf,_0x247cef):_0x112d66,_0x41cf6c;if(typeof Reflect===_0x2eb9a3(0x163)&&typeof Reflect[_0x2eb9a3(0x198)]===_0x2eb9a3(0x191))_0x2b2adb=Reflect[_0x2eb9a3(0x198)](_0x5360ae,_0x15fccf,_0x247cef,_0x112d66);else{for(var _0x1d94c3=_0x5360ae['length']-0x1;_0x1d94c3>=0x0;_0x1d94c3--)if(_0x41cf6c=_0x5360ae[_0x1d94c3])_0x2b2adb=(_0x32ed95<0x3?_0x41cf6c(_0x2b2adb):_0x32ed95>0x3?_0x41cf6c(_0x15fccf,_0x247cef,_0x2b2adb):_0x41cf6c(_0x15fccf,_0x247cef))||_0x2b2adb;}return _0x32ed95>0x3&&_0x2b2adb&&Object['defineProperty'](_0x15fccf,_0x247cef,_0x2b2adb),_0x2b2adb;},__importStar=this&&this['__importStar']||function(_0x419492){const _0x2cfab5=a232_0x2c3835;if(_0x419492&&_0x419492[_0x2cfab5(0x150)])return _0x419492;var _0x659fae={};if(_0x419492!=null){for(var _0x2b06c8 in _0x419492)if(_0x2b06c8!==_0x2cfab5(0x15d)&&Object[_0x2cfab5(0x195)][_0x2cfab5(0x183)]['call'](_0x419492,_0x2b06c8))__createBinding(_0x659fae,_0x419492,_0x2b06c8);}return __setModuleDefault(_0x659fae,_0x419492),_0x659fae;},__metadata=this&&this[a232_0x2c3835(0x182)]||function(_0x106db1,_0x25b02f){const _0xb550d9=a232_0x2c3835;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0xb550d9(0x191))return Reflect[_0xb550d9(0x179)](_0x106db1,_0x25b02f);},__importDefault=this&&this['__importDefault']||function(_0x4f6e7c){return _0x4f6e7c&&_0x4f6e7c['__esModule']?_0x4f6e7c:{'default':_0x4f6e7c};},SalesforceAuthService_1;Object['defineProperty'](exports,a232_0x2c3835(0x150),{'value':!![]}),exports[a232_0x2c3835(0x14b)]=void 0x0;const typedi_1=__importStar(require('typedi')),errors_1=require('../../../../constants/errors'),core_1=require(a232_0x2c3835(0x18b)),axios_1=__importDefault(require('axios')),utils_1=require(a232_0x2c3835(0x149)),invalid_refresh_token_error_1=require(a232_0x2c3835(0x155)),auth_state_enum_1=require(a232_0x2c3835(0x165)),unauthorized_salesforce_error_1=require(a232_0x2c3835(0x17a)),constants_1=require(a232_0x2c3835(0x153)),providers_tokens_1=require(a232_0x2c3835(0x169));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x277e58=a232_0x2c3835;this[_0x277e58(0x144)]=0x1388,this['authState']=auth_state_enum_1[_0x277e58(0x143)][_0x277e58(0x15b)],this[_0x277e58(0x16c)]=new core_1['Logger'](SalesforceAuthService_1[_0x277e58(0x152)]),this['setAuthDetails']();}async[a232_0x2c3835(0x199)](){const _0x42638e=a232_0x2c3835;this['logger'][_0x42638e(0x160)](_0x42638e(0x162),auth_state_enum_1['AuthState'][this[_0x42638e(0x172)]]);try{if(this[_0x42638e(0x172)]===auth_state_enum_1[_0x42638e(0x143)]['Error'])return;if(this[_0x42638e(0x172)]===auth_state_enum_1[_0x42638e(0x143)][_0x42638e(0x15b)])await this[_0x42638e(0x18e)]();else{const _0x35b674=await this['requestConfig'](),_0xb80b6=await axios_1[_0x42638e(0x15d)][_0x42638e(0x148)](_0x42638e(0x18c)+constants_1[_0x42638e(0x175)],_0x35b674)[_0x42638e(0x14c)](()=>!![])[_0x42638e(0x177)](()=>![]);!_0xb80b6&&await this[_0x42638e(0x18e)]();}}catch(_0x59132b){}}async[a232_0x2c3835(0x18e)](){const _0x5ee6d8=a232_0x2c3835;var _0x431202,_0x635e86,_0x386d83;this[_0x5ee6d8(0x16c)][_0x5ee6d8(0x160)](_0x5ee6d8(0x16d));try{this[_0x5ee6d8(0x172)]=auth_state_enum_1[_0x5ee6d8(0x143)][_0x5ee6d8(0x181)];const {refreshToken:_0x21c226,clientId:_0x43a540,clientSecret:_0x1882f3,loginUrl:_0x14808f}=typedi_1[_0x5ee6d8(0x15d)][_0x5ee6d8(0x148)](providers_tokens_1[_0x5ee6d8(0x178)][_0x5ee6d8(0x171)]),{data:_0x5aef0c}=await axios_1[_0x5ee6d8(0x15d)][_0x5ee6d8(0x15f)]((0x0,utils_1[_0x5ee6d8(0x18f)])(_0x14808f,_0x5ee6d8(0x15e)),null,{'params':{'grant_type':_0x5ee6d8(0x197),'refresh_token':_0x21c226,'client_id':_0x43a540,'client_secret':_0x1882f3}});this[_0x5ee6d8(0x154)]=_0x5aef0c['instance_url'],this[_0x5ee6d8(0x170)]=_0x5aef0c['access_token'],this[_0x5ee6d8(0x156)]=_0x5aef0c[_0x5ee6d8(0x168)],this[_0x5ee6d8(0x172)]=auth_state_enum_1[_0x5ee6d8(0x143)][_0x5ee6d8(0x147)],this['logger'][_0x5ee6d8(0x160)](_0x5ee6d8(0x159),this[_0x5ee6d8(0x154)]);}catch(_0x265d04){const _0x367db3=((_0x635e86=(_0x431202=_0x265d04===null||_0x265d04===void 0x0?void 0x0:_0x265d04[_0x5ee6d8(0x145)])===null||_0x431202===void 0x0?void 0x0:_0x431202[_0x5ee6d8(0x14f)])===null||_0x635e86===void 0x0?void 0x0:_0x635e86['error'])||((_0x386d83=_0x265d04===null||_0x265d04===void 0x0?void 0x0:_0x265d04['response'])===null||_0x386d83===void 0x0?void 0x0:_0x386d83[_0x5ee6d8(0x14f)])||_0x265d04[_0x5ee6d8(0x185)];this[_0x5ee6d8(0x16c)][_0x5ee6d8(0x161)]('update\x20access\x20token\x20failed:\x20%s',_0x367db3),this[_0x5ee6d8(0x172)]=auth_state_enum_1[_0x5ee6d8(0x143)][_0x5ee6d8(0x18d)];throw new invalid_refresh_token_error_1[(_0x5ee6d8(0x189))](errors_1[_0x5ee6d8(0x164)]);}}async[a232_0x2c3835(0x151)](){const _0x116119=a232_0x2c3835;this[_0x116119(0x16c)][_0x116119(0x160)]('force\x20update\x20token');if(this[_0x116119(0x172)]===auth_state_enum_1[_0x116119(0x143)][_0x116119(0x181)]||this[_0x116119(0x172)]===auth_state_enum_1[_0x116119(0x143)][_0x116119(0x15b)])return await(0x0,utils_1[_0x116119(0x14e)])(this['AUTH_WAIT_TIME']),this['forceUpdateToken']();if(this[_0x116119(0x172)]===auth_state_enum_1[_0x116119(0x143)][_0x116119(0x18d)])throw new invalid_refresh_token_error_1[(_0x116119(0x189))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x116119(0x18e)]();}async[a232_0x2c3835(0x17c)](){const _0x4ce1e6=a232_0x2c3835;if(this[_0x4ce1e6(0x172)]===auth_state_enum_1[_0x4ce1e6(0x143)][_0x4ce1e6(0x18d)]){this[_0x4ce1e6(0x16c)]['log'](_0x4ce1e6(0x187));throw new unauthorized_salesforce_error_1[(_0x4ce1e6(0x190))]();}if(this[_0x4ce1e6(0x172)]!==auth_state_enum_1['AuthState'][_0x4ce1e6(0x147)])return this[_0x4ce1e6(0x16c)][_0x4ce1e6(0x160)](_0x4ce1e6(0x173)),await(0x0,utils_1[_0x4ce1e6(0x14e)])(this[_0x4ce1e6(0x144)]),this['waitAuth']();}[a232_0x2c3835(0x17f)](){const _0xda6685=a232_0x2c3835;return{'orgId':this[_0xda6685(0x176)],'accessToken':this[_0xda6685(0x170)],'instanceUrl':this[_0xda6685(0x154)]};}async[a232_0x2c3835(0x184)](){const _0x34742d=a232_0x2c3835;return await this[_0x34742d(0x17c)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x34742d(0x16b),'authorization':this[_0x34742d(0x156)]+'\x20'+this[_0x34742d(0x170)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a232_0x2c3835(0x16f)])(),__metadata(a232_0x2c3835(0x15a),[])],SalesforceAuthService),exports[a232_0x2c3835(0x14b)]=SalesforceAuthService;function a232_0x4bbd(){const _0x1c4ae3=['create','access\x20token\x20updated\x20for\x20%s','design:paramtypes','Idle','(((.+)+)+)+$','default','/services/oauth2/token','post','log','error','check\x20auth:\x20current\x20state\x20-\x20%s','object','ERR_INVALID_SALESFORCE_TOKEN','../enums/auth-state.enum','8GAmgam','__createBinding','token_type','../../providers/providers.tokens','281141FEphEj','application/json','logger','update\x20access\x20token','defineProperty','Service','accessToken','salesforce','authState','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','getOwnPropertyDescriptor','SALESFORCE_API_VERSION','orgId','catch','Tokens','metadata','../errors/unauthorized-salesforce.error','276756zVbpAC','waitAuth','writable','apply','getAuthData','4GEQpGM','Updating','__metadata','hasOwnProperty','requestConfig','message','370720LRpsnS','create\x20authorized\x20request\x20failed:\x20authorization\x20error','1oYcNwL','InvalidRefreshTokenError','88885ZVbhVh','../../../../core','services/data/','Error','updateAccessToken','joinURL','UnauthorizedSalesforceError','function','2268423uNFmRv','2251122iUeDNl','366pWFKBy','prototype','search','refresh_token','decorate','setAuthDetails','88ikvrQJ','configurable','AuthState','AUTH_WAIT_TIME','response','77090iUfELP','Active','get','../../../shared/utils','toString','SalesforceAuthService','then','constructor','sleep','data','__esModule','forceUpdateToken','name','../../../../constants','instanceUrl','../errors/invalid-refresh-token.error','tokenType','__decorate'];a232_0x4bbd=function(){return _0x1c4ae3;};return a232_0x4bbd();}