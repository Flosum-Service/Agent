const a243_0x25725c=a243_0x59a4;function a243_0x59a4(_0x34fc19,_0x1c9494){const _0xfd022a=a243_0x4f87();return a243_0x59a4=function(_0x2c9270,_0x36a3d5){_0x2c9270=_0x2c9270-0x17c;let _0x4f8779=_0xfd022a[_0x2c9270];return _0x4f8779;},a243_0x59a4(_0x34fc19,_0x1c9494);}(function(_0x457577,_0x25d73b){const _0x51b194=a243_0x59a4,_0x51f7cb=_0x457577();while(!![]){try{const _0x205cbf=-parseInt(_0x51b194(0x1cc))/0x1*(-parseInt(_0x51b194(0x198))/0x2)+-parseInt(_0x51b194(0x1b4))/0x3*(parseInt(_0x51b194(0x19d))/0x4)+-parseInt(_0x51b194(0x194))/0x5+-parseInt(_0x51b194(0x1c6))/0x6+parseInt(_0x51b194(0x192))/0x7+-parseInt(_0x51b194(0x1b1))/0x8*(-parseInt(_0x51b194(0x17e))/0x9)+parseInt(_0x51b194(0x1a5))/0xa;if(_0x205cbf===_0x25d73b)break;else _0x51f7cb['push'](_0x51f7cb['shift']());}catch(_0xd56730){_0x51f7cb['push'](_0x51f7cb['shift']());}}}(a243_0x4f87,0xcc0da));const a243_0x36a3d5=(function(){let _0x182690=!![];return function(_0x250c5b,_0x4c1ab6){const _0x154d17=_0x182690?function(){const _0x2a1ad5=a243_0x59a4;if(_0x4c1ab6){const _0x4ac04b=_0x4c1ab6[_0x2a1ad5(0x1cb)](_0x250c5b,arguments);return _0x4c1ab6=null,_0x4ac04b;}}:function(){};return _0x182690=![],_0x154d17;};}()),a243_0x2c9270=a243_0x36a3d5(this,function(){const _0x4d3a72=a243_0x59a4;return a243_0x2c9270[_0x4d3a72(0x1af)]()[_0x4d3a72(0x1c1)](_0x4d3a72(0x1a7))['toString']()['constructor'](a243_0x2c9270)['search'](_0x4d3a72(0x1a7));});a243_0x2c9270();'use strict';var __createBinding=this&&this[a243_0x25725c(0x196)]||(Object[a243_0x25725c(0x1ab)]?function(_0x3e2a19,_0x399378,_0x3eae2a,_0xacc3e5){const _0x1df5bc=a243_0x25725c;if(_0xacc3e5===undefined)_0xacc3e5=_0x3eae2a;var _0x197a16=Object[_0x1df5bc(0x17c)](_0x399378,_0x3eae2a);(!_0x197a16||(_0x1df5bc(0x1cf)in _0x197a16?!_0x399378[_0x1df5bc(0x1a8)]:_0x197a16[_0x1df5bc(0x1ba)]||_0x197a16[_0x1df5bc(0x1a2)]))&&(_0x197a16={'enumerable':!![],'get':function(){return _0x399378[_0x3eae2a];}}),Object[_0x1df5bc(0x185)](_0x3e2a19,_0xacc3e5,_0x197a16);}:function(_0x2478d8,_0x3f61a2,_0x431fcb,_0x15d57c){if(_0x15d57c===undefined)_0x15d57c=_0x431fcb;_0x2478d8[_0x15d57c]=_0x3f61a2[_0x431fcb];}),__setModuleDefault=this&&this[a243_0x25725c(0x1d1)]||(Object[a243_0x25725c(0x1ab)]?function(_0x2ae284,_0x2b6416){const _0x3f3853=a243_0x25725c;Object[_0x3f3853(0x185)](_0x2ae284,_0x3f3853(0x1a0),{'enumerable':!![],'value':_0x2b6416});}:function(_0x3baea4,_0x57f7ca){_0x3baea4['default']=_0x57f7ca;}),__decorate=this&&this[a243_0x25725c(0x1b3)]||function(_0x22f59e,_0x1be01b,_0x5ebd44,_0x15678e){const _0x44eacf=a243_0x25725c;var _0xb104b3=arguments['length'],_0x1714fd=_0xb104b3<0x3?_0x1be01b:_0x15678e===null?_0x15678e=Object[_0x44eacf(0x17c)](_0x1be01b,_0x5ebd44):_0x15678e,_0x160a99;if(typeof Reflect===_0x44eacf(0x1bd)&&typeof Reflect[_0x44eacf(0x1c0)]===_0x44eacf(0x1c8))_0x1714fd=Reflect[_0x44eacf(0x1c0)](_0x22f59e,_0x1be01b,_0x5ebd44,_0x15678e);else{for(var _0x3d019e=_0x22f59e['length']-0x1;_0x3d019e>=0x0;_0x3d019e--)if(_0x160a99=_0x22f59e[_0x3d019e])_0x1714fd=(_0xb104b3<0x3?_0x160a99(_0x1714fd):_0xb104b3>0x3?_0x160a99(_0x1be01b,_0x5ebd44,_0x1714fd):_0x160a99(_0x1be01b,_0x5ebd44))||_0x1714fd;}return _0xb104b3>0x3&&_0x1714fd&&Object[_0x44eacf(0x185)](_0x1be01b,_0x5ebd44,_0x1714fd),_0x1714fd;},__importStar=this&&this[a243_0x25725c(0x1be)]||function(_0x14bde9){const _0x3519c2=a243_0x25725c;if(_0x14bde9&&_0x14bde9[_0x3519c2(0x1a8)])return _0x14bde9;var _0x4ba62a={};if(_0x14bde9!=null){for(var _0x408ec9 in _0x14bde9)if(_0x408ec9!==_0x3519c2(0x1a0)&&Object['prototype'][_0x3519c2(0x17d)]['call'](_0x14bde9,_0x408ec9))__createBinding(_0x4ba62a,_0x14bde9,_0x408ec9);}return __setModuleDefault(_0x4ba62a,_0x14bde9),_0x4ba62a;},__metadata=this&&this[a243_0x25725c(0x19e)]||function(_0x286607,_0x226a7b){const _0x28940b=a243_0x25725c;if(typeof Reflect===_0x28940b(0x1bd)&&typeof Reflect[_0x28940b(0x183)]==='function')return Reflect[_0x28940b(0x183)](_0x286607,_0x226a7b);},__importDefault=this&&this['__importDefault']||function(_0x2afd68){const _0x8e690a=a243_0x25725c;return _0x2afd68&&_0x2afd68[_0x8e690a(0x1a8)]?_0x2afd68:{'default':_0x2afd68};},SalesforceAuthService_1;Object[a243_0x25725c(0x185)](exports,a243_0x25725c(0x1a8),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a243_0x25725c(0x181))),errors_1=require('../../../../constants/errors'),core_1=require('../../../../core'),axios_1=__importDefault(require(a243_0x25725c(0x191))),utils_1=require(a243_0x25725c(0x184)),invalid_refresh_token_error_1=require(a243_0x25725c(0x17f)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a243_0x25725c(0x180)),constants_1=require(a243_0x25725c(0x1c5)),providers_tokens_1=require(a243_0x25725c(0x1bb));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x4cbac8=a243_0x25725c;this[_0x4cbac8(0x1c4)]=0x1388,this['authState']=auth_state_enum_1[_0x4cbac8(0x1b7)][_0x4cbac8(0x19c)],this[_0x4cbac8(0x188)]=new core_1[(_0x4cbac8(0x1b9))](SalesforceAuthService_1[_0x4cbac8(0x195)]),this[_0x4cbac8(0x18b)]();}async[a243_0x25725c(0x18b)](){const _0xbda7b7=a243_0x25725c;this[_0xbda7b7(0x188)]['log'](_0xbda7b7(0x1a4),auth_state_enum_1[_0xbda7b7(0x1b7)][this[_0xbda7b7(0x18e)]]);try{if(this['authState']===auth_state_enum_1[_0xbda7b7(0x1b7)]['Error'])return;if(this['authState']===auth_state_enum_1[_0xbda7b7(0x1b7)][_0xbda7b7(0x19c)])await this[_0xbda7b7(0x1d0)]();else{const _0x3b33fa=await this[_0xbda7b7(0x190)](),_0x3a7fbd=await axios_1[_0xbda7b7(0x1a0)][_0xbda7b7(0x1cf)](_0xbda7b7(0x187)+constants_1[_0xbda7b7(0x1cd)],_0x3b33fa)[_0xbda7b7(0x18a)](()=>!![])[_0xbda7b7(0x1c7)](()=>![]);!_0x3a7fbd&&await this['updateAccessToken']();}}catch(_0x2e2fae){}}async['updateAccessToken'](){const _0x5154bb=a243_0x25725c;var _0x17138a,_0x580a39,_0x21268e;this[_0x5154bb(0x188)][_0x5154bb(0x1ce)](_0x5154bb(0x19b));try{this['authState']=auth_state_enum_1[_0x5154bb(0x1b7)][_0x5154bb(0x1a3)];const {refreshToken:_0x498622,clientId:_0x226afe,clientSecret:_0x456ad8,loginUrl:_0x4bc787}=typedi_1[_0x5154bb(0x1a0)]['get'](providers_tokens_1[_0x5154bb(0x1ae)]['salesforce']),{data:_0x15d167}=await axios_1[_0x5154bb(0x1a0)][_0x5154bb(0x1a1)]((0x0,utils_1[_0x5154bb(0x1b6)])(_0x4bc787,_0x5154bb(0x193)),null,{'params':{'grant_type':_0x5154bb(0x19a),'refresh_token':_0x498622,'client_id':_0x226afe,'client_secret':_0x456ad8}});this[_0x5154bb(0x1c2)]=_0x15d167[_0x5154bb(0x1b8)],this[_0x5154bb(0x189)]=_0x15d167[_0x5154bb(0x197)],this[_0x5154bb(0x1ac)]=_0x15d167['token_type'],this['authState']=auth_state_enum_1[_0x5154bb(0x1b7)]['Active'],this['logger'][_0x5154bb(0x1ce)](_0x5154bb(0x182),this[_0x5154bb(0x1c2)]);}catch(_0x5a13ad){const _0x3c6c3a=((_0x580a39=(_0x17138a=_0x5a13ad===null||_0x5a13ad===void 0x0?void 0x0:_0x5a13ad[_0x5154bb(0x1b2)])===null||_0x17138a===void 0x0?void 0x0:_0x17138a[_0x5154bb(0x18c)])===null||_0x580a39===void 0x0?void 0x0:_0x580a39[_0x5154bb(0x1bf)])||((_0x21268e=_0x5a13ad===null||_0x5a13ad===void 0x0?void 0x0:_0x5a13ad[_0x5154bb(0x1b2)])===null||_0x21268e===void 0x0?void 0x0:_0x21268e[_0x5154bb(0x18c)])||_0x5a13ad[_0x5154bb(0x1bc)];this[_0x5154bb(0x188)]['error'](_0x5154bb(0x1c3),_0x3c6c3a),this[_0x5154bb(0x18e)]=auth_state_enum_1[_0x5154bb(0x1b7)][_0x5154bb(0x1a6)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x5154bb(0x1ca)]);}}async['forceUpdateToken'](){const _0x5e2547=a243_0x25725c;this['logger'][_0x5e2547(0x1ce)]('Force\x20update\x20token');if(this[_0x5e2547(0x18e)]===auth_state_enum_1['AuthState'][_0x5e2547(0x1a3)]||this[_0x5e2547(0x18e)]===auth_state_enum_1[_0x5e2547(0x1b7)][_0x5e2547(0x19c)])return await(0x0,utils_1[_0x5e2547(0x1b5)])(this['AUTH_WAIT_TIME']),this[_0x5e2547(0x199)]();if(this[_0x5e2547(0x18e)]===auth_state_enum_1[_0x5e2547(0x1b7)][_0x5e2547(0x1a6)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x5e2547(0x1ca)]);await this['updateAccessToken']();}async['waitAuth'](){const _0x4f9d90=a243_0x25725c;if(this[_0x4f9d90(0x18e)]===auth_state_enum_1['AuthState'][_0x4f9d90(0x1a6)]){this[_0x4f9d90(0x188)]['log'](_0x4f9d90(0x1c9));throw new unauthorized_salesforce_error_1[(_0x4f9d90(0x186))]();}if(this[_0x4f9d90(0x18e)]!==auth_state_enum_1[_0x4f9d90(0x1b7)][_0x4f9d90(0x1a9)])return this[_0x4f9d90(0x188)][_0x4f9d90(0x1ce)](_0x4f9d90(0x19f)),await(0x0,utils_1[_0x4f9d90(0x1b5)])(this['AUTH_WAIT_TIME']),this['waitAuth']();}[a243_0x25725c(0x1b0)](){const _0x53b3cc=a243_0x25725c;return{'orgId':this[_0x53b3cc(0x18f)],'accessToken':this[_0x53b3cc(0x189)],'instanceUrl':this[_0x53b3cc(0x1c2)]};}async['requestConfig'](){const _0x4fcee2=a243_0x25725c;return await this[_0x4fcee2(0x18d)](),{'baseURL':this[_0x4fcee2(0x1c2)],'headers':{'accept':'application/json','authorization':this[_0x4fcee2(0x1ac)]+'\x20'+this[_0x4fcee2(0x189)]}};}};function a243_0x4f87(){const _0x277202=['default','post','configurable','Updating','Check\x20auth:\x20current\x20state\x20-\x20%s','36834450mVZIHf','Error','(((.+)+)+)+$','__esModule','Active','design:paramtypes','create','tokenType','Service','Tokens','toString','getAuthData','2401072sXxECY','response','__decorate','12HGmCWj','sleep','joinURL','AuthState','instance_url','Logger','writable','../../providers/providers.tokens','message','object','__importStar','error','decorate','search','instanceUrl','Update\x20access\x20token\x20failed:\x20%s','AUTH_WAIT_TIME','../../../../constants','8659746emjHdA','catch','function','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','ERR_INVALID_SALESFORCE_TOKEN','apply','50849TLgkZP','SALESFORCE_API_VERSION','log','get','updateAccessToken','__setModuleDefault','getOwnPropertyDescriptor','hasOwnProperty','9QhSDtu','../errors/invalid-refresh-token.error','../errors/unauthorized-salesforce.error','typedi','Access\x20token\x20updated\x20for\x20%s','metadata','../../../shared/utils','defineProperty','UnauthorizedSalesforceError','services/data/','logger','accessToken','then','setAuthDetails','data','waitAuth','authState','orgId','requestConfig','axios','1366680fjNKnI','/services/oauth2/token','4773425XnQVaI','name','__createBinding','access_token','6kwhSet','forceUpdateToken','refresh_token','Update\x20access\x20token','Idle','1097588mKIsPi','__metadata','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'];a243_0x4f87=function(){return _0x277202;};return a243_0x4f87();}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a243_0x25725c(0x1ad)])(),__metadata(a243_0x25725c(0x1aa),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;