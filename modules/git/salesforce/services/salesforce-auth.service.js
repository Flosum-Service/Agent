const a269_0x310c8e=a269_0x641a;(function(_0x1ef253,_0x1d2ae1){const _0x43338f=a269_0x641a,_0x301022=_0x1ef253();while(!![]){try{const _0x32d865=-parseInt(_0x43338f(0x101))/0x1*(parseInt(_0x43338f(0x109))/0x2)+parseInt(_0x43338f(0xe4))/0x3+-parseInt(_0x43338f(0x10d))/0x4+-parseInt(_0x43338f(0xce))/0x5*(-parseInt(_0x43338f(0xc6))/0x6)+parseInt(_0x43338f(0x11f))/0x7*(parseInt(_0x43338f(0xeb))/0x8)+-parseInt(_0x43338f(0x112))/0x9+parseInt(_0x43338f(0xf6))/0xa*(parseInt(_0x43338f(0xea))/0xb);if(_0x32d865===_0x1d2ae1)break;else _0x301022['push'](_0x301022['shift']());}catch(_0x5d83f5){_0x301022['push'](_0x301022['shift']());}}}(a269_0xf03d,0xd76e5));function a269_0x641a(_0x49c4d3,_0x2240a6){const _0x2df104=a269_0xf03d();return a269_0x641a=function(_0x1f63c1,_0x1e7965){_0x1f63c1=_0x1f63c1-0xc3;let _0xf03dba=_0x2df104[_0x1f63c1];return _0xf03dba;},a269_0x641a(_0x49c4d3,_0x2240a6);}const a269_0x1e7965=(function(){let _0xe67c6=!![];return function(_0x4a002f,_0x9d65f){const _0x59f276=_0xe67c6?function(){const _0x3e59be=a269_0x641a;if(_0x9d65f){const _0x552ecc=_0x9d65f[_0x3e59be(0xd7)](_0x4a002f,arguments);return _0x9d65f=null,_0x552ecc;}}:function(){};return _0xe67c6=![],_0x59f276;};}()),a269_0x1f63c1=a269_0x1e7965(this,function(){const _0x2ba2ab=a269_0x641a;return a269_0x1f63c1[_0x2ba2ab(0x119)]()[_0x2ba2ab(0xcf)](_0x2ba2ab(0xfc))[_0x2ba2ab(0x119)]()[_0x2ba2ab(0xfe)](a269_0x1f63c1)[_0x2ba2ab(0xcf)](_0x2ba2ab(0xfc));});a269_0x1f63c1();'use strict';var __createBinding=this&&this[a269_0x310c8e(0xda)]||(Object['create']?function(_0x4cfb0e,_0x3f6818,_0x5080ec,_0x1488f8){const _0x24b9ba=a269_0x310c8e;if(_0x1488f8===undefined)_0x1488f8=_0x5080ec;var _0x442ec7=Object[_0x24b9ba(0x104)](_0x3f6818,_0x5080ec);(!_0x442ec7||('get'in _0x442ec7?!_0x3f6818[_0x24b9ba(0xde)]:_0x442ec7['writable']||_0x442ec7[_0x24b9ba(0xc4)]))&&(_0x442ec7={'enumerable':!![],'get':function(){return _0x3f6818[_0x5080ec];}}),Object['defineProperty'](_0x4cfb0e,_0x1488f8,_0x442ec7);}:function(_0x4393fb,_0xf08b6d,_0x36cd13,_0x48eb7d){if(_0x48eb7d===undefined)_0x48eb7d=_0x36cd13;_0x4393fb[_0x48eb7d]=_0xf08b6d[_0x36cd13];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a269_0x310c8e(0xf0)]?function(_0x11a546,_0x466ab0){const _0x4d93f3=a269_0x310c8e;Object['defineProperty'](_0x11a546,_0x4d93f3(0xcd),{'enumerable':!![],'value':_0x466ab0});}:function(_0x5bcfe3,_0x24ff88){const _0x12b6c4=a269_0x310c8e;_0x5bcfe3[_0x12b6c4(0xcd)]=_0x24ff88;}),__decorate=this&&this['__decorate']||function(_0x283b3a,_0x75d421,_0x11bb8a,_0x2e5f3b){const _0xd434a4=a269_0x310c8e;var _0x1c644c=arguments[_0xd434a4(0xd0)],_0x1ba0ee=_0x1c644c<0x3?_0x75d421:_0x2e5f3b===null?_0x2e5f3b=Object[_0xd434a4(0x104)](_0x75d421,_0x11bb8a):_0x2e5f3b,_0x2cac67;if(typeof Reflect===_0xd434a4(0xf7)&&typeof Reflect[_0xd434a4(0xd3)]==='function')_0x1ba0ee=Reflect[_0xd434a4(0xd3)](_0x283b3a,_0x75d421,_0x11bb8a,_0x2e5f3b);else{for(var _0x7728b3=_0x283b3a[_0xd434a4(0xd0)]-0x1;_0x7728b3>=0x0;_0x7728b3--)if(_0x2cac67=_0x283b3a[_0x7728b3])_0x1ba0ee=(_0x1c644c<0x3?_0x2cac67(_0x1ba0ee):_0x1c644c>0x3?_0x2cac67(_0x75d421,_0x11bb8a,_0x1ba0ee):_0x2cac67(_0x75d421,_0x11bb8a))||_0x1ba0ee;}return _0x1c644c>0x3&&_0x1ba0ee&&Object[_0xd434a4(0xc8)](_0x75d421,_0x11bb8a,_0x1ba0ee),_0x1ba0ee;},__importStar=this&&this[a269_0x310c8e(0x10e)]||function(_0xe08dc5){const _0x2a4611=a269_0x310c8e;if(_0xe08dc5&&_0xe08dc5['__esModule'])return _0xe08dc5;var _0x51d7c8={};if(_0xe08dc5!=null){for(var _0x281eff in _0xe08dc5)if(_0x281eff!==_0x2a4611(0xcd)&&Object[_0x2a4611(0xdc)][_0x2a4611(0xd2)][_0x2a4611(0xff)](_0xe08dc5,_0x281eff))__createBinding(_0x51d7c8,_0xe08dc5,_0x281eff);}return __setModuleDefault(_0x51d7c8,_0xe08dc5),_0x51d7c8;},__metadata=this&&this[a269_0x310c8e(0x10a)]||function(_0x25443c,_0x3b116b){const _0x54c5a6=a269_0x310c8e;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x54c5a6(0xe0))return Reflect[_0x54c5a6(0x107)](_0x25443c,_0x3b116b);},__importDefault=this&&this['__importDefault']||function(_0x2febdd){const _0x44f003=a269_0x310c8e;return _0x2febdd&&_0x2febdd[_0x44f003(0xde)]?_0x2febdd:{'default':_0x2febdd};},SalesforceAuthService_1;Object[a269_0x310c8e(0xc8)](exports,a269_0x310c8e(0xde),{'value':!![]}),exports[a269_0x310c8e(0x11e)]=void 0x0;const typedi_1=__importStar(require(a269_0x310c8e(0xca))),errors_1=require(a269_0x310c8e(0x116)),core_1=require(a269_0x310c8e(0x103)),axios_1=__importDefault(require(a269_0x310c8e(0xd6))),utils_1=require(a269_0x310c8e(0xdb)),invalid_refresh_token_error_1=require(a269_0x310c8e(0xe8)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a269_0x310c8e(0xfa)),constants_1=require(a269_0x310c8e(0x11c)),providers_tokens_1=require(a269_0x310c8e(0xc5)),salesforce_1=require(a269_0x310c8e(0xef));function a269_0xf03d(){const _0x49d0c5=['../../../../core','getOwnPropertyDescriptor','instanceUrl','Updating','metadata','Service','16NPoSIl','__metadata','replace','logger','7030832DLQNyM','__importStar','application/json','AuthState','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','10136016NAfoLn','/services/oauth2/token','response','accessToken','../../../../constants/errors','services/data/','X-SFDC-Session','toString','Tokens','access_token','../../../../constants','salesforce','SalesforceAuthService','7107114YHVqqO','Access\x20token\x20updated\x20for\x20%s','refresh_token','AUTH_WAIT_TIME','configurable','../../providers/providers.tokens','36JtMjLq','log','defineProperty','then','typedi','waitAuth','design:paramtypes','default','309380XVZOqp','search','length','get','hasOwnProperty','decorate','getAuthData','name','axios','apply','setAuthDetails','error','__createBinding','../../../shared/utils','prototype','Logger','__esModule','authState','function','message','SalesforceUtils','isBulk1Url','224325TBknRF','Active','SALESFORCE_API_VERSION','Idle','../errors/invalid-refresh-token.error','forceUpdateToken','11pUzZDi','8XHuLHe','Update\x20access\x20token','tokenType','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','@flosum/salesforce','create','updateAccessToken','headers','<met:sessionId>','InvalidRefreshTokenError','authorization','30356440XzyvHK','object','Error','instance_url','../errors/unauthorized-salesforce.error','sleep','(((.+)+)+)+$','joinURL','constructor','call','data','91330yNRAPK','requestConfig'];a269_0xf03d=function(){return _0x49d0c5;};return a269_0xf03d();}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x2b12f6=a269_0x310c8e;this[_0x2b12f6(0xc3)]=0x1388,this[_0x2b12f6(0xdf)]=auth_state_enum_1[_0x2b12f6(0x110)][_0x2b12f6(0xe7)],this[_0x2b12f6(0x10c)]=new core_1[(_0x2b12f6(0xdd))](SalesforceAuthService_1[_0x2b12f6(0xd5)]),this[_0x2b12f6(0xd8)]();}async[a269_0x310c8e(0xd8)](){const _0x5d7f4a=a269_0x310c8e;this['logger']['log']('Check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x5d7f4a(0x110)][this[_0x5d7f4a(0xdf)]]);try{if(this[_0x5d7f4a(0xdf)]===auth_state_enum_1[_0x5d7f4a(0x110)][_0x5d7f4a(0xf8)])return;if(this['authState']===auth_state_enum_1[_0x5d7f4a(0x110)][_0x5d7f4a(0xe7)])await this[_0x5d7f4a(0xf1)]();else{const _0x3335ff=await this[_0x5d7f4a(0x102)](),_0x4e3488=await axios_1[_0x5d7f4a(0xcd)][_0x5d7f4a(0xd1)](_0x5d7f4a(0x117)+constants_1[_0x5d7f4a(0xe6)],_0x3335ff)[_0x5d7f4a(0xc9)](()=>!![])['catch'](()=>![]);!_0x4e3488&&await this['updateAccessToken']();}}catch(_0x30eb5a){}}async['updateAccessToken'](){const _0x331930=a269_0x310c8e;var _0x5cbf44,_0x2b85e0,_0x45a899;this['logger'][_0x331930(0xc7)](_0x331930(0xec));try{this[_0x331930(0xdf)]=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x591d90,clientId:_0x124613,clientSecret:_0x24131c,loginUrl:_0x39230a}=typedi_1[_0x331930(0xcd)][_0x331930(0xd1)](providers_tokens_1[_0x331930(0x11a)][_0x331930(0x11d)]),{data:_0x4d1b0c}=await axios_1[_0x331930(0xcd)]['post']((0x0,utils_1[_0x331930(0xfd)])(_0x39230a,_0x331930(0x113)),null,{'params':{'grant_type':_0x331930(0x121),'refresh_token':_0x591d90,'client_id':_0x124613,'client_secret':_0x24131c}});this[_0x331930(0x105)]=_0x4d1b0c[_0x331930(0xf9)],this[_0x331930(0x115)]=_0x4d1b0c[_0x331930(0x11b)],this[_0x331930(0xed)]=_0x4d1b0c['token_type'],this[_0x331930(0xdf)]=auth_state_enum_1[_0x331930(0x110)][_0x331930(0xe5)],this[_0x331930(0x10c)][_0x331930(0xc7)](_0x331930(0x120),this['instanceUrl']);}catch(_0xa95f1){const _0x7215f7=((_0x2b85e0=(_0x5cbf44=_0xa95f1===null||_0xa95f1===void 0x0?void 0x0:_0xa95f1[_0x331930(0x114)])===null||_0x5cbf44===void 0x0?void 0x0:_0x5cbf44[_0x331930(0x100)])===null||_0x2b85e0===void 0x0?void 0x0:_0x2b85e0[_0x331930(0xd9)])||((_0x45a899=_0xa95f1===null||_0xa95f1===void 0x0?void 0x0:_0xa95f1[_0x331930(0x114)])===null||_0x45a899===void 0x0?void 0x0:_0x45a899['data'])||_0xa95f1[_0x331930(0xe1)];this[_0x331930(0x10c)][_0x331930(0xd9)]('Update\x20access\x20token\x20failed:\x20%s',_0x7215f7),this[_0x331930(0xdf)]=auth_state_enum_1[_0x331930(0x110)]['Error'];throw new invalid_refresh_token_error_1[(_0x331930(0xf4))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x455f08=a269_0x310c8e;this['logger'][_0x455f08(0xc7)]('Force\x20update\x20token');if(this[_0x455f08(0xdf)]===auth_state_enum_1[_0x455f08(0x110)][_0x455f08(0x106)]||this[_0x455f08(0xdf)]===auth_state_enum_1[_0x455f08(0x110)]['Idle'])return await(0x0,utils_1[_0x455f08(0xfb)])(this[_0x455f08(0xc3)]),this[_0x455f08(0xe9)]();if(this['authState']===auth_state_enum_1['AuthState'][_0x455f08(0xf8)])throw new invalid_refresh_token_error_1[(_0x455f08(0xf4))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x455f08(0xf1)]();}async[a269_0x310c8e(0xcb)](){const _0xdaacb8=a269_0x310c8e;if(this[_0xdaacb8(0xdf)]===auth_state_enum_1['AuthState'][_0xdaacb8(0xf8)]){this[_0xdaacb8(0x10c)][_0xdaacb8(0xc7)](_0xdaacb8(0xee));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this['authState']!==auth_state_enum_1[_0xdaacb8(0x110)][_0xdaacb8(0xe5)])return this[_0xdaacb8(0x10c)][_0xdaacb8(0xc7)](_0xdaacb8(0x111)),await(0x0,utils_1['sleep'])(this[_0xdaacb8(0xc3)]),this[_0xdaacb8(0xcb)]();}[a269_0x310c8e(0xd4)](){const _0x57b783=a269_0x310c8e;return{'orgId':this['orgId'],'accessToken':this[_0x57b783(0x115)],'instanceUrl':this[_0x57b783(0x105)]};}async['requestConfig'](_0x3ce6f8=''){const _0x5bf84e=a269_0x310c8e;await this['waitAuth']();const _0x4e0737={'baseURL':this[_0x5bf84e(0x105)],'headers':{'accept':_0x5bf84e(0x10f)}};if(salesforce_1[_0x5bf84e(0xe2)][_0x5bf84e(0xe3)](_0x3ce6f8))_0x4e0737['headers'][_0x5bf84e(0x118)]=this[_0x5bf84e(0x115)];else salesforce_1[_0x5bf84e(0xe2)]['isSoapUrl'](_0x3ce6f8)?_0x4e0737[_0x5bf84e(0x100)]=_0x4e0737[_0x5bf84e(0x100)][_0x5bf84e(0x10b)](/<met:sessionId>.+?<\/met:sessionId>/,_0x5bf84e(0xf3)+this[_0x5bf84e(0x115)]+'</met:sessionId>'):_0x4e0737[_0x5bf84e(0xf2)][_0x5bf84e(0xf5)]=this[_0x5bf84e(0xed)]+'\x20'+this[_0x5bf84e(0x115)];return _0x4e0737;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a269_0x310c8e(0x108)])(),__metadata(a269_0x310c8e(0xcc),[])],SalesforceAuthService),exports[a269_0x310c8e(0x11e)]=SalesforceAuthService;