const a193_0x33364e=a193_0x24dc;(function(_0x594d17,_0x137dc2){const _0x377041=a193_0x24dc,_0x2a61db=_0x594d17();while(!![]){try{const _0x3073fa=-parseInt(_0x377041(0x19c))/0x1+-parseInt(_0x377041(0x1a1))/0x2*(-parseInt(_0x377041(0x19f))/0x3)+parseInt(_0x377041(0x1c0))/0x4+-parseInt(_0x377041(0x18a))/0x5+parseInt(_0x377041(0x1b7))/0x6*(parseInt(_0x377041(0x1bd))/0x7)+-parseInt(_0x377041(0x1cb))/0x8*(parseInt(_0x377041(0x17f))/0x9)+parseInt(_0x377041(0x18f))/0xa*(parseInt(_0x377041(0x1a0))/0xb);if(_0x3073fa===_0x137dc2)break;else _0x2a61db['push'](_0x2a61db['shift']());}catch(_0x1514dc){_0x2a61db['push'](_0x2a61db['shift']());}}}(a193_0x5606,0xd5744));const a193_0x455270=(function(){let _0x37d7c1=!![];return function(_0x1deb2b,_0x2c0070){const _0x4c94f9=_0x37d7c1?function(){const _0x4c1338=a193_0x24dc;if(_0x2c0070){const _0x5652e7=_0x2c0070[_0x4c1338(0x190)](_0x1deb2b,arguments);return _0x2c0070=null,_0x5652e7;}}:function(){};return _0x37d7c1=![],_0x4c94f9;};}()),a193_0xcfeb27=a193_0x455270(this,function(){const _0x4b2aaa=a193_0x24dc;return a193_0xcfeb27[_0x4b2aaa(0x1bf)]()[_0x4b2aaa(0x198)]('(((.+)+)+)+$')[_0x4b2aaa(0x1bf)]()[_0x4b2aaa(0x1c6)](a193_0xcfeb27)[_0x4b2aaa(0x198)]('(((.+)+)+)+$');});function a193_0x5606(){const _0x35df84=['application/json','writable','hasOwnProperty','1036760zYiFBn','update\x20access\x20token\x20failed:\x20%s','default','4481301dJhlHG','7447BIDyrO','2faJZUF','AUTH_WAIT_TIME','access_token','axios','force\x20update\x20token','InvalidRefreshTokenError','token_type','length','check\x20auth:\x20current\x20state\x20-\x20%s','post','../../../../core','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','getAuthData','accessToken','/services/oauth2/token','../enums/auth-state.enum','response','log','decorate','Idle','message','Error','7538226ariovX','setAuthDetails','defineProperty','access\x20token\x20updated\x20for\x20%s','__setModuleDefault','data','7XSwBQN','instanceUrl','toString','1534988hMnPkM','refresh_token','create','AuthState','__createBinding','typedi','constructor','Service','ERR_INVALID_SALESFORCE_TOKEN','get','error','3173464xEmjFT','update\x20access\x20token','call','../errors/invalid-refresh-token.error','__importStar','updateAccessToken','joinURL','18jQVXCt','waitAuth','SalesforceAuthService','function','metadata','../../../../constants','getOwnPropertyDescriptor','Updating','prototype','name','__esModule','3565570RpwvwK','Active','then','authState','Logger','4190eNxxRy','apply','../errors/unauthorized-salesforce.error','salesforce','__metadata','logger','Tokens','tokenType','forceUpdateToken','search'];a193_0x5606=function(){return _0x35df84;};return a193_0x5606();}a193_0xcfeb27();'use strict';var __createBinding=this&&this[a193_0x33364e(0x1c4)]||(Object['create']?function(_0x23600a,_0x4a222d,_0x56426c,_0x4a39e6){const _0x30278e=a193_0x33364e;if(_0x4a39e6===undefined)_0x4a39e6=_0x56426c;var _0x149518=Object[_0x30278e(0x185)](_0x4a222d,_0x56426c);(!_0x149518||('get'in _0x149518?!_0x4a222d[_0x30278e(0x189)]:_0x149518[_0x30278e(0x19a)]||_0x149518['configurable']))&&(_0x149518={'enumerable':!![],'get':function(){return _0x4a222d[_0x56426c];}}),Object['defineProperty'](_0x23600a,_0x4a39e6,_0x149518);}:function(_0x15634b,_0x52ab9d,_0xa0b790,_0x233d26){if(_0x233d26===undefined)_0x233d26=_0xa0b790;_0x15634b[_0x233d26]=_0x52ab9d[_0xa0b790];}),__setModuleDefault=this&&this[a193_0x33364e(0x1bb)]||(Object[a193_0x33364e(0x1c2)]?function(_0x4e9c4b,_0x1c2443){const _0x137991=a193_0x33364e;Object[_0x137991(0x1b9)](_0x4e9c4b,_0x137991(0x19e),{'enumerable':!![],'value':_0x1c2443});}:function(_0x47fbc8,_0x128654){const _0x286845=a193_0x33364e;_0x47fbc8[_0x286845(0x19e)]=_0x128654;}),__decorate=this&&this['__decorate']||function(_0x19885e,_0x2e279d,_0x2df3c7,_0x3def26){const _0xcad11b=a193_0x33364e;var _0x431df4=arguments[_0xcad11b(0x1a8)],_0x2f765f=_0x431df4<0x3?_0x2e279d:_0x3def26===null?_0x3def26=Object[_0xcad11b(0x185)](_0x2e279d,_0x2df3c7):_0x3def26,_0x3596d0;if(typeof Reflect==='object'&&typeof Reflect[_0xcad11b(0x1b3)]==='function')_0x2f765f=Reflect['decorate'](_0x19885e,_0x2e279d,_0x2df3c7,_0x3def26);else{for(var _0x37abc5=_0x19885e['length']-0x1;_0x37abc5>=0x0;_0x37abc5--)if(_0x3596d0=_0x19885e[_0x37abc5])_0x2f765f=(_0x431df4<0x3?_0x3596d0(_0x2f765f):_0x431df4>0x3?_0x3596d0(_0x2e279d,_0x2df3c7,_0x2f765f):_0x3596d0(_0x2e279d,_0x2df3c7))||_0x2f765f;}return _0x431df4>0x3&&_0x2f765f&&Object[_0xcad11b(0x1b9)](_0x2e279d,_0x2df3c7,_0x2f765f),_0x2f765f;},__importStar=this&&this[a193_0x33364e(0x17c)]||function(_0x11ac3a){const _0x104a8f=a193_0x33364e;if(_0x11ac3a&&_0x11ac3a[_0x104a8f(0x189)])return _0x11ac3a;var _0x18802d={};if(_0x11ac3a!=null){for(var _0xf0f33a in _0x11ac3a)if(_0xf0f33a!==_0x104a8f(0x19e)&&Object[_0x104a8f(0x187)][_0x104a8f(0x19b)][_0x104a8f(0x1cd)](_0x11ac3a,_0xf0f33a))__createBinding(_0x18802d,_0x11ac3a,_0xf0f33a);}return __setModuleDefault(_0x18802d,_0x11ac3a),_0x18802d;},__metadata=this&&this[a193_0x33364e(0x193)]||function(_0x2c9222,_0x3a30e6){const _0x4aaa40=a193_0x33364e;if(typeof Reflect==='object'&&typeof Reflect[_0x4aaa40(0x183)]===_0x4aaa40(0x182))return Reflect[_0x4aaa40(0x183)](_0x2c9222,_0x3a30e6);},__importDefault=this&&this['__importDefault']||function(_0x3943c0){const _0x160590=a193_0x33364e;return _0x3943c0&&_0x3943c0[_0x160590(0x189)]?_0x3943c0:{'default':_0x3943c0};},SalesforceAuthService_1;Object[a193_0x33364e(0x1b9)](exports,a193_0x33364e(0x189),{'value':!![]}),exports[a193_0x33364e(0x181)]=void 0x0;const typedi_1=__importStar(require(a193_0x33364e(0x1c5))),errors_1=require('../../../../constants/errors'),core_1=require(a193_0x33364e(0x1ab)),axios_1=__importDefault(require(a193_0x33364e(0x1a4))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a193_0x33364e(0x17b)),auth_state_enum_1=require(a193_0x33364e(0x1b0)),unauthorized_salesforce_error_1=require(a193_0x33364e(0x191)),constants_1=require(a193_0x33364e(0x184)),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x1ba774=a193_0x33364e;this['AUTH_WAIT_TIME']=0x1388,this[_0x1ba774(0x18d)]=auth_state_enum_1[_0x1ba774(0x1c3)][_0x1ba774(0x1b4)],this[_0x1ba774(0x194)]=new core_1[(_0x1ba774(0x18e))](SalesforceAuthService_1[_0x1ba774(0x188)]),this['setAuthDetails']();}async[a193_0x33364e(0x1b8)](){const _0x637580=a193_0x33364e;this['logger']['log'](_0x637580(0x1a9),auth_state_enum_1['AuthState'][this[_0x637580(0x18d)]]);try{if(this['authState']===auth_state_enum_1['AuthState'][_0x637580(0x1b6)])return;if(this[_0x637580(0x18d)]===auth_state_enum_1[_0x637580(0x1c3)][_0x637580(0x1b4)])await this[_0x637580(0x17d)]();else{const _0x2b3a95=await this['requestConfig'](),_0x1616bb=await axios_1[_0x637580(0x19e)]['get']('services/data/'+constants_1['SALESFORCE_API_VERSION'],_0x2b3a95)[_0x637580(0x18c)](()=>!![])['catch'](()=>![]);!_0x1616bb&&await this['updateAccessToken']();}}catch(_0x518d4b){}}async['updateAccessToken'](){const _0x53d60a=a193_0x33364e;var _0x5a1b7d,_0x4745ec,_0x41e2aa;this[_0x53d60a(0x194)][_0x53d60a(0x1b2)](_0x53d60a(0x1cc));try{this[_0x53d60a(0x18d)]=auth_state_enum_1[_0x53d60a(0x1c3)][_0x53d60a(0x186)];const {refreshToken:_0x2d663c,clientId:_0x3d9636,clientSecret:_0x5080ee,loginUrl:_0x1794ec}=typedi_1['default'][_0x53d60a(0x1c9)](providers_tokens_1[_0x53d60a(0x195)][_0x53d60a(0x192)]),{data:_0x4a7128}=await axios_1[_0x53d60a(0x19e)][_0x53d60a(0x1aa)]((0x0,utils_1[_0x53d60a(0x17e)])(_0x1794ec,_0x53d60a(0x1af)),null,{'params':{'grant_type':_0x53d60a(0x1c1),'refresh_token':_0x2d663c,'client_id':_0x3d9636,'client_secret':_0x5080ee}});this[_0x53d60a(0x1be)]=_0x4a7128['instance_url'],this[_0x53d60a(0x1ae)]=_0x4a7128[_0x53d60a(0x1a3)],this[_0x53d60a(0x196)]=_0x4a7128[_0x53d60a(0x1a7)],this[_0x53d60a(0x18d)]=auth_state_enum_1['AuthState'][_0x53d60a(0x18b)],this['logger']['log'](_0x53d60a(0x1ba),this[_0x53d60a(0x1be)]);}catch(_0x2110da){const _0x1b5e13=((_0x4745ec=(_0x5a1b7d=_0x2110da===null||_0x2110da===void 0x0?void 0x0:_0x2110da[_0x53d60a(0x1b1)])===null||_0x5a1b7d===void 0x0?void 0x0:_0x5a1b7d[_0x53d60a(0x1bc)])===null||_0x4745ec===void 0x0?void 0x0:_0x4745ec[_0x53d60a(0x1ca)])||((_0x41e2aa=_0x2110da===null||_0x2110da===void 0x0?void 0x0:_0x2110da['response'])===null||_0x41e2aa===void 0x0?void 0x0:_0x41e2aa[_0x53d60a(0x1bc)])||_0x2110da[_0x53d60a(0x1b5)];this['logger'][_0x53d60a(0x1ca)](_0x53d60a(0x19d),_0x1b5e13),this[_0x53d60a(0x18d)]=auth_state_enum_1[_0x53d60a(0x1c3)][_0x53d60a(0x1b6)];throw new invalid_refresh_token_error_1[(_0x53d60a(0x1a6))](errors_1[_0x53d60a(0x1c8)]);}}async[a193_0x33364e(0x197)](){const _0x3b6df6=a193_0x33364e;this[_0x3b6df6(0x194)]['log'](_0x3b6df6(0x1a5));if(this[_0x3b6df6(0x18d)]===auth_state_enum_1[_0x3b6df6(0x1c3)]['Updating']||this['authState']===auth_state_enum_1[_0x3b6df6(0x1c3)][_0x3b6df6(0x1b4)])return await(0x0,utils_1['sleep'])(this[_0x3b6df6(0x1a2)]),this['forceUpdateToken']();if(this[_0x3b6df6(0x18d)]===auth_state_enum_1[_0x3b6df6(0x1c3)]['Error'])throw new invalid_refresh_token_error_1[(_0x3b6df6(0x1a6))](errors_1[_0x3b6df6(0x1c8)]);await this[_0x3b6df6(0x17d)]();}async[a193_0x33364e(0x180)](){const _0x46181a=a193_0x33364e;if(this[_0x46181a(0x18d)]===auth_state_enum_1[_0x46181a(0x1c3)][_0x46181a(0x1b6)]){this[_0x46181a(0x194)][_0x46181a(0x1b2)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x46181a(0x18d)]!==auth_state_enum_1[_0x46181a(0x1c3)][_0x46181a(0x18b)])return this[_0x46181a(0x194)][_0x46181a(0x1b2)](_0x46181a(0x1ac)),await(0x0,utils_1['sleep'])(this[_0x46181a(0x1a2)]),this[_0x46181a(0x180)]();}[a193_0x33364e(0x1ad)](){const _0x52220d=a193_0x33364e;return{'orgId':this['orgId'],'accessToken':this[_0x52220d(0x1ae)],'instanceUrl':this[_0x52220d(0x1be)]};}async['requestConfig'](){const _0x471944=a193_0x33364e;return await this[_0x471944(0x180)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x471944(0x199),'authorization':this['tokenType']+'\x20'+this['accessToken']}};}};function a193_0x24dc(_0x3e6de4,_0x2ca673){const _0x56245a=a193_0x5606();return a193_0x24dc=function(_0xcfeb27,_0x455270){_0xcfeb27=_0xcfeb27-0x17b;let _0x5606e3=_0x56245a[_0xcfeb27];return _0x5606e3;},a193_0x24dc(_0x3e6de4,_0x2ca673);}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a193_0x33364e(0x1c7)])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;