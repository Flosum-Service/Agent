const a227_0x4305a8=a227_0x505f;(function(_0xde66ff,_0x172348){const _0x468f02=a227_0x505f,_0x7bf455=_0xde66ff();while(!![]){try{const _0x45c473=-parseInt(_0x468f02(0x1f9))/0x1+-parseInt(_0x468f02(0x1e5))/0x2*(-parseInt(_0x468f02(0x211))/0x3)+parseInt(_0x468f02(0x229))/0x4*(parseInt(_0x468f02(0x20f))/0x5)+-parseInt(_0x468f02(0x1fb))/0x6*(parseInt(_0x468f02(0x1e9))/0x7)+-parseInt(_0x468f02(0x1dc))/0x8*(parseInt(_0x468f02(0x200))/0x9)+parseInt(_0x468f02(0x21d))/0xa*(parseInt(_0x468f02(0x220))/0xb)+parseInt(_0x468f02(0x218))/0xc*(-parseInt(_0x468f02(0x21b))/0xd);if(_0x45c473===_0x172348)break;else _0x7bf455['push'](_0x7bf455['shift']());}catch(_0xddd76b){_0x7bf455['push'](_0x7bf455['shift']());}}}(a227_0xf834,0xe19f0));function a227_0x505f(_0x2a5cff,_0x6382f2){const _0x3d1c86=a227_0xf834();return a227_0x505f=function(_0x1c5cc2,_0x200f4e){_0x1c5cc2=_0x1c5cc2-0x1db;let _0xf83431=_0x3d1c86[_0x1c5cc2];return _0xf83431;},a227_0x505f(_0x2a5cff,_0x6382f2);}const a227_0x200f4e=(function(){let _0x28a936=!![];return function(_0x2831fb,_0x59cb91){const _0x59a19d=_0x28a936?function(){if(_0x59cb91){const _0x5a5edf=_0x59cb91['apply'](_0x2831fb,arguments);return _0x59cb91=null,_0x5a5edf;}}:function(){};return _0x28a936=![],_0x59a19d;};}()),a227_0x1c5cc2=a227_0x200f4e(this,function(){const _0x54d171=a227_0x505f;return a227_0x1c5cc2[_0x54d171(0x204)]()[_0x54d171(0x216)](_0x54d171(0x1de))[_0x54d171(0x204)]()['constructor'](a227_0x1c5cc2)[_0x54d171(0x216)](_0x54d171(0x1de));});a227_0x1c5cc2();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a227_0x4305a8(0x217)]?function(_0x4c88fd,_0x1fcbc7,_0x2cb203,_0x24114f){const _0x2265ca=a227_0x4305a8;if(_0x24114f===undefined)_0x24114f=_0x2cb203;var _0x3de505=Object['getOwnPropertyDescriptor'](_0x1fcbc7,_0x2cb203);(!_0x3de505||('get'in _0x3de505?!_0x1fcbc7['__esModule']:_0x3de505[_0x2265ca(0x1dd)]||_0x3de505[_0x2265ca(0x203)]))&&(_0x3de505={'enumerable':!![],'get':function(){return _0x1fcbc7[_0x2cb203];}}),Object[_0x2265ca(0x224)](_0x4c88fd,_0x24114f,_0x3de505);}:function(_0x288287,_0x44e92e,_0x4bc685,_0x3f6275){if(_0x3f6275===undefined)_0x3f6275=_0x4bc685;_0x288287[_0x3f6275]=_0x44e92e[_0x4bc685];}),__setModuleDefault=this&&this[a227_0x4305a8(0x1e8)]||(Object[a227_0x4305a8(0x217)]?function(_0x2f985e,_0x30c218){const _0x31f4da=a227_0x4305a8;Object[_0x31f4da(0x224)](_0x2f985e,_0x31f4da(0x221),{'enumerable':!![],'value':_0x30c218});}:function(_0x573cc6,_0x590098){const _0x27f10c=a227_0x4305a8;_0x573cc6[_0x27f10c(0x221)]=_0x590098;}),__decorate=this&&this['__decorate']||function(_0x3ac9a8,_0x51d38b,_0x6932b2,_0x178c18){const _0x29f805=a227_0x4305a8;var _0x3b8645=arguments[_0x29f805(0x1e4)],_0x1ed27c=_0x3b8645<0x3?_0x51d38b:_0x178c18===null?_0x178c18=Object[_0x29f805(0x228)](_0x51d38b,_0x6932b2):_0x178c18,_0x37d3b8;if(typeof Reflect===_0x29f805(0x1fd)&&typeof Reflect['decorate']===_0x29f805(0x20e))_0x1ed27c=Reflect['decorate'](_0x3ac9a8,_0x51d38b,_0x6932b2,_0x178c18);else{for(var _0x91e41e=_0x3ac9a8['length']-0x1;_0x91e41e>=0x0;_0x91e41e--)if(_0x37d3b8=_0x3ac9a8[_0x91e41e])_0x1ed27c=(_0x3b8645<0x3?_0x37d3b8(_0x1ed27c):_0x3b8645>0x3?_0x37d3b8(_0x51d38b,_0x6932b2,_0x1ed27c):_0x37d3b8(_0x51d38b,_0x6932b2))||_0x1ed27c;}return _0x3b8645>0x3&&_0x1ed27c&&Object[_0x29f805(0x224)](_0x51d38b,_0x6932b2,_0x1ed27c),_0x1ed27c;},__importStar=this&&this[a227_0x4305a8(0x1e6)]||function(_0xfbf457){const _0x4f8d48=a227_0x4305a8;if(_0xfbf457&&_0xfbf457[_0x4f8d48(0x21e)])return _0xfbf457;var _0x22b662={};if(_0xfbf457!=null){for(var _0x238cbd in _0xfbf457)if(_0x238cbd!==_0x4f8d48(0x221)&&Object[_0x4f8d48(0x201)][_0x4f8d48(0x1ee)]['call'](_0xfbf457,_0x238cbd))__createBinding(_0x22b662,_0xfbf457,_0x238cbd);}return __setModuleDefault(_0x22b662,_0xfbf457),_0x22b662;},__metadata=this&&this[a227_0x4305a8(0x202)]||function(_0x349a25,_0x985a26){const _0x3adbf0=a227_0x4305a8;if(typeof Reflect===_0x3adbf0(0x1fd)&&typeof Reflect[_0x3adbf0(0x1ef)]===_0x3adbf0(0x20e))return Reflect['metadata'](_0x349a25,_0x985a26);},__importDefault=this&&this[a227_0x4305a8(0x1ea)]||function(_0x2a1a6e){const _0x58462e=a227_0x4305a8;return _0x2a1a6e&&_0x2a1a6e[_0x58462e(0x21e)]?_0x2a1a6e:{'default':_0x2a1a6e};},SalesforceAuthService_1;Object['defineProperty'](exports,a227_0x4305a8(0x21e),{'value':!![]}),exports[a227_0x4305a8(0x213)]=void 0x0;function a227_0xf834(){const _0x233e2b=['get','data','update\x20access\x20token\x20failed:\x20%s','InvalidRefreshTokenError','UnauthorizedSalesforceError','ERR_INVALID_SALESFORCE_TOKEN','token_type','860226sGMQzg','catch','671604mJKqnV','instanceUrl','object','requestConfig','logger','9nLJDjd','prototype','__metadata','configurable','toString','error','access\x20token\x20updated\x20for\x20%s','instance_url','tokenType','typedi','salesforce','Service','Updating','Logger','function','5rmKmhf','update\x20access\x20token','1116SffTBl','authState','SalesforceAuthService','../../../../constants','../../../shared/utils','search','create','2930388eGKLGX','forceUpdateToken','../../providers/providers.tokens','13BKJiYv','Active','93950LyJHaf','__esModule','name','1991iEhxOK','default','AUTH_WAIT_TIME','log','defineProperty','../errors/invalid-refresh-token.error','Error','message','getOwnPropertyDescriptor','6028372yZHzNx','getAuthData','design:paramtypes','sleep','setAuthDetails','13926216sgdPcl','writable','(((.+)+)+)+$','orgId','../enums/auth-state.enum','AuthState','updateAccessToken','accessToken','length','3622fHcsLQ','__importStar','check\x20auth:\x20current\x20state\x20-\x20%s','__setModuleDefault','7NyYQpt','__importDefault','../../../../constants/errors','services/data/','/services/oauth2/token','hasOwnProperty','metadata','Idle','response'];a227_0xf834=function(){return _0x233e2b;};return a227_0xf834();}const typedi_1=__importStar(require(a227_0x4305a8(0x209))),errors_1=require(a227_0x4305a8(0x1eb)),core_1=require('../../../../core'),axios_1=__importDefault(require('axios')),utils_1=require(a227_0x4305a8(0x215)),invalid_refresh_token_error_1=require(a227_0x4305a8(0x225)),auth_state_enum_1=require(a227_0x4305a8(0x1e0)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a227_0x4305a8(0x214)),providers_tokens_1=require(a227_0x4305a8(0x21a));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x5376ab=a227_0x4305a8;this[_0x5376ab(0x222)]=0x1388,this[_0x5376ab(0x212)]=auth_state_enum_1[_0x5376ab(0x1e1)][_0x5376ab(0x1f0)],this[_0x5376ab(0x1ff)]=new core_1[(_0x5376ab(0x20d))](SalesforceAuthService_1[_0x5376ab(0x21f)]),this[_0x5376ab(0x1db)]();}async['setAuthDetails'](){const _0x245a23=a227_0x4305a8;this[_0x245a23(0x1ff)][_0x245a23(0x223)](_0x245a23(0x1e7),auth_state_enum_1[_0x245a23(0x1e1)][this[_0x245a23(0x212)]]);try{if(this[_0x245a23(0x212)]===auth_state_enum_1[_0x245a23(0x1e1)][_0x245a23(0x226)])return;if(this['authState']===auth_state_enum_1[_0x245a23(0x1e1)][_0x245a23(0x1f0)])await this['updateAccessToken']();else{const _0x441663=await this[_0x245a23(0x1fe)](),_0x1f28aa=await axios_1[_0x245a23(0x221)][_0x245a23(0x1f2)](_0x245a23(0x1ec)+constants_1['SALESFORCE_API_VERSION'],_0x441663)['then'](()=>!![])[_0x245a23(0x1fa)](()=>![]);!_0x1f28aa&&await this[_0x245a23(0x1e2)]();}}catch(_0x555b43){}}async[a227_0x4305a8(0x1e2)](){const _0x43b0e1=a227_0x4305a8;var _0x260151,_0x1e025e,_0x512b1d;this[_0x43b0e1(0x1ff)][_0x43b0e1(0x223)](_0x43b0e1(0x210));try{this['authState']=auth_state_enum_1[_0x43b0e1(0x1e1)][_0x43b0e1(0x20c)];const {refreshToken:_0x3c324b,clientId:_0x21c08c,clientSecret:_0x2e3df4,loginUrl:_0x9dfe80}=typedi_1[_0x43b0e1(0x221)][_0x43b0e1(0x1f2)](providers_tokens_1['Tokens'][_0x43b0e1(0x20a)]),{data:_0x43050b}=await axios_1['default']['post']((0x0,utils_1['joinURL'])(_0x9dfe80,_0x43b0e1(0x1ed)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x3c324b,'client_id':_0x21c08c,'client_secret':_0x2e3df4}});this[_0x43b0e1(0x1fc)]=_0x43050b[_0x43b0e1(0x207)],this[_0x43b0e1(0x1e3)]=_0x43050b['access_token'],this[_0x43b0e1(0x208)]=_0x43050b[_0x43b0e1(0x1f8)],this[_0x43b0e1(0x212)]=auth_state_enum_1['AuthState'][_0x43b0e1(0x21c)],this[_0x43b0e1(0x1ff)]['log'](_0x43b0e1(0x206),this[_0x43b0e1(0x1fc)]);}catch(_0x57db8f){const _0x26c972=((_0x1e025e=(_0x260151=_0x57db8f===null||_0x57db8f===void 0x0?void 0x0:_0x57db8f['response'])===null||_0x260151===void 0x0?void 0x0:_0x260151[_0x43b0e1(0x1f3)])===null||_0x1e025e===void 0x0?void 0x0:_0x1e025e[_0x43b0e1(0x205)])||((_0x512b1d=_0x57db8f===null||_0x57db8f===void 0x0?void 0x0:_0x57db8f[_0x43b0e1(0x1f1)])===null||_0x512b1d===void 0x0?void 0x0:_0x512b1d[_0x43b0e1(0x1f3)])||_0x57db8f[_0x43b0e1(0x227)];this[_0x43b0e1(0x1ff)]['error'](_0x43b0e1(0x1f4),_0x26c972),this[_0x43b0e1(0x212)]=auth_state_enum_1['AuthState'][_0x43b0e1(0x226)];throw new invalid_refresh_token_error_1[(_0x43b0e1(0x1f5))](errors_1[_0x43b0e1(0x1f7)]);}}async['forceUpdateToken'](){const _0x5bd463=a227_0x4305a8;this[_0x5bd463(0x1ff)]['log']('force\x20update\x20token');if(this[_0x5bd463(0x212)]===auth_state_enum_1['AuthState'][_0x5bd463(0x20c)]||this['authState']===auth_state_enum_1[_0x5bd463(0x1e1)]['Idle'])return await(0x0,utils_1[_0x5bd463(0x22c)])(this[_0x5bd463(0x222)]),this[_0x5bd463(0x219)]();if(this[_0x5bd463(0x212)]===auth_state_enum_1[_0x5bd463(0x1e1)]['Error'])throw new invalid_refresh_token_error_1[(_0x5bd463(0x1f5))](errors_1[_0x5bd463(0x1f7)]);await this[_0x5bd463(0x1e2)]();}async['waitAuth'](){const _0x2420e6=a227_0x4305a8;if(this[_0x2420e6(0x212)]===auth_state_enum_1[_0x2420e6(0x1e1)][_0x2420e6(0x226)]){this['logger'][_0x2420e6(0x223)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x2420e6(0x1f6))]();}if(this['authState']!==auth_state_enum_1['AuthState'][_0x2420e6(0x21c)])return this[_0x2420e6(0x1ff)][_0x2420e6(0x223)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x2420e6(0x22c)])(this['AUTH_WAIT_TIME']),this['waitAuth']();}[a227_0x4305a8(0x22a)](){const _0x19fd99=a227_0x4305a8;return{'orgId':this[_0x19fd99(0x1df)],'accessToken':this[_0x19fd99(0x1e3)],'instanceUrl':this[_0x19fd99(0x1fc)]};}async['requestConfig'](){const _0x1ce4fa=a227_0x4305a8;return await this['waitAuth'](),{'baseURL':this[_0x1ce4fa(0x1fc)],'headers':{'accept':'application/json','authorization':this['tokenType']+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a227_0x4305a8(0x20b)])(),__metadata(a227_0x4305a8(0x22b),[])],SalesforceAuthService),exports[a227_0x4305a8(0x213)]=SalesforceAuthService;