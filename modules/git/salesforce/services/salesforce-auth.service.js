const a242_0x3cd7f2=a242_0x4f29;(function(_0x3012e7,_0x315160){const _0x10a252=a242_0x4f29,_0xdf826a=_0x3012e7();while(!![]){try{const _0x145b5f=parseInt(_0x10a252(0x124))/0x1*(parseInt(_0x10a252(0x119))/0x2)+-parseInt(_0x10a252(0x130))/0x3*(-parseInt(_0x10a252(0x113))/0x4)+parseInt(_0x10a252(0x13c))/0x5+parseInt(_0x10a252(0xfc))/0x6+-parseInt(_0x10a252(0x126))/0x7*(parseInt(_0x10a252(0x12d))/0x8)+-parseInt(_0x10a252(0x12a))/0x9*(-parseInt(_0x10a252(0x11c))/0xa)+-parseInt(_0x10a252(0x13f))/0xb;if(_0x145b5f===_0x315160)break;else _0xdf826a['push'](_0xdf826a['shift']());}catch(_0x230641){_0xdf826a['push'](_0xdf826a['shift']());}}}(a242_0x38d5,0x58800));const a242_0x39fca0=(function(){let _0x4d5619=!![];return function(_0x3ec6e3,_0xa7685b){const _0x23492e=_0x4d5619?function(){const _0x1dfb3e=a242_0x4f29;if(_0xa7685b){const _0x52aad6=_0xa7685b[_0x1dfb3e(0x10e)](_0x3ec6e3,arguments);return _0xa7685b=null,_0x52aad6;}}:function(){};return _0x4d5619=![],_0x23492e;};}()),a242_0x21b359=a242_0x39fca0(this,function(){const _0x3d1610=a242_0x4f29;return a242_0x21b359[_0x3d1610(0x138)]()[_0x3d1610(0x125)](_0x3d1610(0x12b))['toString']()[_0x3d1610(0x11b)](a242_0x21b359)['search'](_0x3d1610(0x12b));});a242_0x21b359();'use strict';var __createBinding=this&&this[a242_0x3cd7f2(0x107)]||(Object[a242_0x3cd7f2(0x13b)]?function(_0x42924c,_0x1320d5,_0x440db5,_0x1409d9){const _0x4a83fc=a242_0x3cd7f2;if(_0x1409d9===undefined)_0x1409d9=_0x440db5;var _0x28e52d=Object['getOwnPropertyDescriptor'](_0x1320d5,_0x440db5);(!_0x28e52d||('get'in _0x28e52d?!_0x1320d5[_0x4a83fc(0x13d)]:_0x28e52d[_0x4a83fc(0x115)]||_0x28e52d[_0x4a83fc(0xfe)]))&&(_0x28e52d={'enumerable':!![],'get':function(){return _0x1320d5[_0x440db5];}}),Object['defineProperty'](_0x42924c,_0x1409d9,_0x28e52d);}:function(_0x67f036,_0x4dcd15,_0x444e2c,_0x3db7a1){if(_0x3db7a1===undefined)_0x3db7a1=_0x444e2c;_0x67f036[_0x3db7a1]=_0x4dcd15[_0x444e2c];}),__setModuleDefault=this&&this[a242_0x3cd7f2(0x114)]||(Object[a242_0x3cd7f2(0x13b)]?function(_0xecd4c,_0xed6ed6){const _0x4c7c08=a242_0x3cd7f2;Object[_0x4c7c08(0x116)](_0xecd4c,'default',{'enumerable':!![],'value':_0xed6ed6});}:function(_0x319ff0,_0x287204){const _0xe7aa81=a242_0x3cd7f2;_0x319ff0[_0xe7aa81(0x141)]=_0x287204;}),__decorate=this&&this[a242_0x3cd7f2(0x132)]||function(_0x2b7dd8,_0x4f0ab4,_0x2a26c9,_0x1c1e92){const _0x11e57f=a242_0x3cd7f2;var _0x1395eb=arguments[_0x11e57f(0x110)],_0x4ec616=_0x1395eb<0x3?_0x4f0ab4:_0x1c1e92===null?_0x1c1e92=Object[_0x11e57f(0x108)](_0x4f0ab4,_0x2a26c9):_0x1c1e92,_0x4e3b43;if(typeof Reflect===_0x11e57f(0x10d)&&typeof Reflect[_0x11e57f(0x14a)]==='function')_0x4ec616=Reflect[_0x11e57f(0x14a)](_0x2b7dd8,_0x4f0ab4,_0x2a26c9,_0x1c1e92);else{for(var _0x2ccc5d=_0x2b7dd8[_0x11e57f(0x110)]-0x1;_0x2ccc5d>=0x0;_0x2ccc5d--)if(_0x4e3b43=_0x2b7dd8[_0x2ccc5d])_0x4ec616=(_0x1395eb<0x3?_0x4e3b43(_0x4ec616):_0x1395eb>0x3?_0x4e3b43(_0x4f0ab4,_0x2a26c9,_0x4ec616):_0x4e3b43(_0x4f0ab4,_0x2a26c9))||_0x4ec616;}return _0x1395eb>0x3&&_0x4ec616&&Object[_0x11e57f(0x116)](_0x4f0ab4,_0x2a26c9,_0x4ec616),_0x4ec616;},__importStar=this&&this['__importStar']||function(_0x55f28d){const _0xf1b9a5=a242_0x3cd7f2;if(_0x55f28d&&_0x55f28d[_0xf1b9a5(0x13d)])return _0x55f28d;var _0x48e6a6={};if(_0x55f28d!=null){for(var _0x532739 in _0x55f28d)if(_0x532739!==_0xf1b9a5(0x141)&&Object[_0xf1b9a5(0x10c)][_0xf1b9a5(0xfd)]['call'](_0x55f28d,_0x532739))__createBinding(_0x48e6a6,_0x55f28d,_0x532739);}return __setModuleDefault(_0x48e6a6,_0x55f28d),_0x48e6a6;},__metadata=this&&this['__metadata']||function(_0x318097,_0x55a457){const _0x28419a=a242_0x3cd7f2;if(typeof Reflect===_0x28419a(0x10d)&&typeof Reflect[_0x28419a(0x149)]===_0x28419a(0x145))return Reflect[_0x28419a(0x149)](_0x318097,_0x55a457);},__importDefault=this&&this[a242_0x3cd7f2(0x127)]||function(_0x18b8b5){const _0x28cece=a242_0x3cd7f2;return _0x18b8b5&&_0x18b8b5[_0x28cece(0x13d)]?_0x18b8b5:{'default':_0x18b8b5};},SalesforceAuthService_1;Object[a242_0x3cd7f2(0x116)](exports,a242_0x3cd7f2(0x13d),{'value':!![]}),exports[a242_0x3cd7f2(0x10f)]=void 0x0;function a242_0x38d5(){const _0x1ac073=['Create\x20authorized\x20request\x20failed:\x20authorization\x20error','2852344eqNryb','forceUpdateToken','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','3edhMZK','Tokens','__decorate','Force\x20update\x20token','AuthState','Error','tokenType','Updating','toString','../../providers/providers.tokens','name','create','156630yhyBJP','__esModule','message','5535354JsbXwJ','Update\x20access\x20token','default','../../../../constants/errors','application/json','design:paramtypes','function','salesforce','instanceUrl','../../../shared/utils','metadata','decorate','joinURL','logger','ERR_INVALID_SALESFORCE_TOKEN','sleep','refresh_token','3726294OXuZvB','hasOwnProperty','configurable','token_type','setAuthDetails','AUTH_WAIT_TIME','response','../errors/unauthorized-salesforce.error','updateAccessToken','/services/oauth2/token','waitAuth','__createBinding','getOwnPropertyDescriptor','Check\x20auth:\x20current\x20state\x20-\x20%s','orgId','services/data/','prototype','object','apply','SalesforceAuthService','length','accessToken','authState','1177272eZMiXV','__setModuleDefault','writable','defineProperty','Idle','Active','2nodSzC','instance_url','constructor','10uXGbbY','getAuthData','get','requestConfig','error','log','../errors/invalid-refresh-token.error','InvalidRefreshTokenError','168857fLADJP','search','7gfCpsg','__importDefault','axios','data','960327ahiKHU','(((.+)+)+)+$'];a242_0x38d5=function(){return _0x1ac073;};return a242_0x38d5();}const typedi_1=__importStar(require('typedi')),errors_1=require(a242_0x3cd7f2(0x142)),core_1=require('../../../../core'),axios_1=__importDefault(require(a242_0x3cd7f2(0x128))),utils_1=require(a242_0x3cd7f2(0x148)),invalid_refresh_token_error_1=require(a242_0x3cd7f2(0x122)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a242_0x3cd7f2(0x103)),constants_1=require('../../../../constants'),providers_tokens_1=require(a242_0x3cd7f2(0x139));function a242_0x4f29(_0x3c41f0,_0x418b54){const _0x58a16e=a242_0x38d5();return a242_0x4f29=function(_0x21b359,_0x39fca0){_0x21b359=_0x21b359-0xf9;let _0x38d577=_0x58a16e[_0x21b359];return _0x38d577;},a242_0x4f29(_0x3c41f0,_0x418b54);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0xb911ce=a242_0x3cd7f2;this[_0xb911ce(0x101)]=0x1388,this[_0xb911ce(0x112)]=auth_state_enum_1[_0xb911ce(0x134)][_0xb911ce(0x117)],this[_0xb911ce(0x14c)]=new core_1['Logger'](SalesforceAuthService_1[_0xb911ce(0x13a)]),this[_0xb911ce(0x100)]();}async[a242_0x3cd7f2(0x100)](){const _0x325d23=a242_0x3cd7f2;this[_0x325d23(0x14c)][_0x325d23(0x121)](_0x325d23(0x109),auth_state_enum_1[_0x325d23(0x134)][this['authState']]);try{if(this['authState']===auth_state_enum_1[_0x325d23(0x134)][_0x325d23(0x135)])return;if(this[_0x325d23(0x112)]===auth_state_enum_1[_0x325d23(0x134)][_0x325d23(0x117)])await this['updateAccessToken']();else{const _0x5e1fcb=await this[_0x325d23(0x11f)](),_0x20e9ee=await axios_1[_0x325d23(0x141)][_0x325d23(0x11e)](_0x325d23(0x10b)+constants_1['SALESFORCE_API_VERSION'],_0x5e1fcb)['then'](()=>!![])['catch'](()=>![]);!_0x20e9ee&&await this[_0x325d23(0x104)]();}}catch(_0x44ffb8){}}async[a242_0x3cd7f2(0x104)](){const _0x395e51=a242_0x3cd7f2;var _0x5a422f,_0x325822,_0x415139;this['logger'][_0x395e51(0x121)](_0x395e51(0x140));try{this[_0x395e51(0x112)]=auth_state_enum_1[_0x395e51(0x134)][_0x395e51(0x137)];const {refreshToken:_0xdb1580,clientId:_0x3dadb5,clientSecret:_0x4b09e8,loginUrl:_0x348535}=typedi_1[_0x395e51(0x141)][_0x395e51(0x11e)](providers_tokens_1[_0x395e51(0x131)][_0x395e51(0x146)]),{data:_0x4ae1c3}=await axios_1[_0x395e51(0x141)]['post']((0x0,utils_1[_0x395e51(0x14b)])(_0x348535,_0x395e51(0x105)),null,{'params':{'grant_type':_0x395e51(0xfb),'refresh_token':_0xdb1580,'client_id':_0x3dadb5,'client_secret':_0x4b09e8}});this[_0x395e51(0x147)]=_0x4ae1c3[_0x395e51(0x11a)],this[_0x395e51(0x111)]=_0x4ae1c3['access_token'],this[_0x395e51(0x136)]=_0x4ae1c3[_0x395e51(0xff)],this[_0x395e51(0x112)]=auth_state_enum_1[_0x395e51(0x134)][_0x395e51(0x118)],this[_0x395e51(0x14c)]['log']('Access\x20token\x20updated\x20for\x20%s',this[_0x395e51(0x147)]);}catch(_0x489e4a){const _0x221f62=((_0x325822=(_0x5a422f=_0x489e4a===null||_0x489e4a===void 0x0?void 0x0:_0x489e4a[_0x395e51(0x102)])===null||_0x5a422f===void 0x0?void 0x0:_0x5a422f['data'])===null||_0x325822===void 0x0?void 0x0:_0x325822['error'])||((_0x415139=_0x489e4a===null||_0x489e4a===void 0x0?void 0x0:_0x489e4a[_0x395e51(0x102)])===null||_0x415139===void 0x0?void 0x0:_0x415139[_0x395e51(0x129)])||_0x489e4a[_0x395e51(0x13e)];this[_0x395e51(0x14c)][_0x395e51(0x120)]('Update\x20access\x20token\x20failed:\x20%s',_0x221f62),this[_0x395e51(0x112)]=auth_state_enum_1['AuthState'][_0x395e51(0x135)];throw new invalid_refresh_token_error_1[(_0x395e51(0x123))](errors_1[_0x395e51(0xf9)]);}}async[a242_0x3cd7f2(0x12e)](){const _0xd7272f=a242_0x3cd7f2;this[_0xd7272f(0x14c)][_0xd7272f(0x121)](_0xd7272f(0x133));if(this[_0xd7272f(0x112)]===auth_state_enum_1[_0xd7272f(0x134)]['Updating']||this['authState']===auth_state_enum_1['AuthState']['Idle'])return await(0x0,utils_1[_0xd7272f(0xfa)])(this[_0xd7272f(0x101)]),this[_0xd7272f(0x12e)]();if(this['authState']===auth_state_enum_1['AuthState'][_0xd7272f(0x135)])throw new invalid_refresh_token_error_1[(_0xd7272f(0x123))](errors_1[_0xd7272f(0xf9)]);await this[_0xd7272f(0x104)]();}async[a242_0x3cd7f2(0x106)](){const _0x58901a=a242_0x3cd7f2;if(this[_0x58901a(0x112)]===auth_state_enum_1['AuthState'][_0x58901a(0x135)]){this['logger']['log'](_0x58901a(0x12c));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x58901a(0x112)]!==auth_state_enum_1[_0x58901a(0x134)][_0x58901a(0x118)])return this[_0x58901a(0x14c)][_0x58901a(0x121)](_0x58901a(0x12f)),await(0x0,utils_1[_0x58901a(0xfa)])(this[_0x58901a(0x101)]),this['waitAuth']();}[a242_0x3cd7f2(0x11d)](){const _0x2833dd=a242_0x3cd7f2;return{'orgId':this[_0x2833dd(0x10a)],'accessToken':this[_0x2833dd(0x111)],'instanceUrl':this[_0x2833dd(0x147)]};}async[a242_0x3cd7f2(0x11f)](){const _0x439bd4=a242_0x3cd7f2;return await this[_0x439bd4(0x106)](),{'baseURL':this[_0x439bd4(0x147)],'headers':{'accept':_0x439bd4(0x143),'authorization':this['tokenType']+'\x20'+this[_0x439bd4(0x111)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a242_0x3cd7f2(0x144),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;