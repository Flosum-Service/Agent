const a269_0x438e6c=a269_0x5556;(function(_0x2968f7,_0x500712){const _0x4ea514=a269_0x5556,_0x10e35d=_0x2968f7();while(!![]){try{const _0x59e680=-parseInt(_0x4ea514(0x1a5))/0x1+parseInt(_0x4ea514(0x185))/0x2+-parseInt(_0x4ea514(0x1ac))/0x3+parseInt(_0x4ea514(0x1cc))/0x4+-parseInt(_0x4ea514(0x180))/0x5*(-parseInt(_0x4ea514(0x1c6))/0x6)+parseInt(_0x4ea514(0x183))/0x7*(-parseInt(_0x4ea514(0x196))/0x8)+-parseInt(_0x4ea514(0x1ca))/0x9*(-parseInt(_0x4ea514(0x198))/0xa);if(_0x59e680===_0x500712)break;else _0x10e35d['push'](_0x10e35d['shift']());}catch(_0x5b1769){_0x10e35d['push'](_0x10e35d['shift']());}}}(a269_0x587d,0x6acb5));const a269_0x3bbec4=(function(){let _0x53c9b5=!![];return function(_0x266b26,_0x1c529d){const _0x4737ea=_0x53c9b5?function(){const _0x4ad036=a269_0x5556;if(_0x1c529d){const _0x3b3731=_0x1c529d[_0x4ad036(0x1d9)](_0x266b26,arguments);return _0x1c529d=null,_0x3b3731;}}:function(){};return _0x53c9b5=![],_0x4737ea;};}()),a269_0xf630a7=a269_0x3bbec4(this,function(){const _0x2238e3=a269_0x5556;return a269_0xf630a7[_0x2238e3(0x19c)]()[_0x2238e3(0x1a7)](_0x2238e3(0x1ae))[_0x2238e3(0x19c)]()[_0x2238e3(0x1bc)](a269_0xf630a7)[_0x2238e3(0x1a7)](_0x2238e3(0x1ae));});a269_0xf630a7();'use strict';var __createBinding=this&&this[a269_0x438e6c(0x1d7)]||(Object['create']?function(_0x1d84e8,_0xd0fbb8,_0x2c469b,_0x42df2d){const _0x1cf85f=a269_0x438e6c;if(_0x42df2d===undefined)_0x42df2d=_0x2c469b;var _0x5ee78d=Object[_0x1cf85f(0x1cb)](_0xd0fbb8,_0x2c469b);(!_0x5ee78d||('get'in _0x5ee78d?!_0xd0fbb8[_0x1cf85f(0x1d0)]:_0x5ee78d[_0x1cf85f(0x1d1)]||_0x5ee78d[_0x1cf85f(0x18b)]))&&(_0x5ee78d={'enumerable':!![],'get':function(){return _0xd0fbb8[_0x2c469b];}}),Object[_0x1cf85f(0x197)](_0x1d84e8,_0x42df2d,_0x5ee78d);}:function(_0x1e91cc,_0x324878,_0x337391,_0xee2032){if(_0xee2032===undefined)_0xee2032=_0x337391;_0x1e91cc[_0xee2032]=_0x324878[_0x337391];}),__setModuleDefault=this&&this[a269_0x438e6c(0x1cd)]||(Object[a269_0x438e6c(0x18a)]?function(_0x31614f,_0x1dbc48){const _0x372626=a269_0x438e6c;Object['defineProperty'](_0x31614f,_0x372626(0x18c),{'enumerable':!![],'value':_0x1dbc48});}:function(_0x3d678e,_0x1abf6b){_0x3d678e['default']=_0x1abf6b;}),__decorate=this&&this[a269_0x438e6c(0x1c1)]||function(_0x435e65,_0x33eb24,_0x52fc75,_0x344c69){const _0x3aef47=a269_0x438e6c;var _0x353431=arguments[_0x3aef47(0x19a)],_0x7b3506=_0x353431<0x3?_0x33eb24:_0x344c69===null?_0x344c69=Object[_0x3aef47(0x1cb)](_0x33eb24,_0x52fc75):_0x344c69,_0x584dec;if(typeof Reflect===_0x3aef47(0x1c2)&&typeof Reflect[_0x3aef47(0x1b5)]===_0x3aef47(0x1b3))_0x7b3506=Reflect['decorate'](_0x435e65,_0x33eb24,_0x52fc75,_0x344c69);else{for(var _0x1b67da=_0x435e65[_0x3aef47(0x19a)]-0x1;_0x1b67da>=0x0;_0x1b67da--)if(_0x584dec=_0x435e65[_0x1b67da])_0x7b3506=(_0x353431<0x3?_0x584dec(_0x7b3506):_0x353431>0x3?_0x584dec(_0x33eb24,_0x52fc75,_0x7b3506):_0x584dec(_0x33eb24,_0x52fc75))||_0x7b3506;}return _0x353431>0x3&&_0x7b3506&&Object['defineProperty'](_0x33eb24,_0x52fc75,_0x7b3506),_0x7b3506;},__importStar=this&&this[a269_0x438e6c(0x181)]||function(_0x2407c1){const _0x7edc04=a269_0x438e6c;if(_0x2407c1&&_0x2407c1[_0x7edc04(0x1d0)])return _0x2407c1;var _0x1d0ab7={};if(_0x2407c1!=null){for(var _0x474e96 in _0x2407c1)if(_0x474e96!=='default'&&Object['prototype'][_0x7edc04(0x1b6)][_0x7edc04(0x1b4)](_0x2407c1,_0x474e96))__createBinding(_0x1d0ab7,_0x2407c1,_0x474e96);}return __setModuleDefault(_0x1d0ab7,_0x2407c1),_0x1d0ab7;},__metadata=this&&this['__metadata']||function(_0x365f04,_0x487e47){const _0x256b27=a269_0x438e6c;if(typeof Reflect===_0x256b27(0x1c2)&&typeof Reflect[_0x256b27(0x1d6)]===_0x256b27(0x1b3))return Reflect['metadata'](_0x365f04,_0x487e47);},__importDefault=this&&this[a269_0x438e6c(0x199)]||function(_0xf491f6){const _0xd5af5d=a269_0x438e6c;return _0xf491f6&&_0xf491f6[_0xd5af5d(0x1d0)]?_0xf491f6:{'default':_0xf491f6};},SalesforceAuthService_1;Object['defineProperty'](exports,a269_0x438e6c(0x1d0),{'value':!![]}),exports[a269_0x438e6c(0x1db)]=void 0x0;function a269_0x5556(_0x4fc176,_0x59715a){const _0x2eaace=a269_0x587d();return a269_0x5556=function(_0xf630a7,_0x3bbec4){_0xf630a7=_0xf630a7-0x17c;let _0x587d7c=_0x2eaace[_0xf630a7];return _0x587d7c;},a269_0x5556(_0x4fc176,_0x59715a);}const typedi_1=__importStar(require(a269_0x438e6c(0x1a0))),errors_1=require(a269_0x438e6c(0x1ba)),core_1=require(a269_0x438e6c(0x192)),axios_1=__importDefault(require(a269_0x438e6c(0x17c))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a269_0x438e6c(0x19e)),auth_state_enum_1=require(a269_0x438e6c(0x1cf)),unauthorized_salesforce_error_1=require(a269_0x438e6c(0x1ab)),constants_1=require(a269_0x438e6c(0x1a4)),providers_tokens_1=require(a269_0x438e6c(0x18d)),salesforce_1=require(a269_0x438e6c(0x1ad));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x168835=a269_0x438e6c;this['AUTH_WAIT_TIME']=0x1388,this['authState']=auth_state_enum_1[_0x168835(0x1b1)][_0x168835(0x1c0)],this[_0x168835(0x1a2)]=new core_1[(_0x168835(0x1a1))](SalesforceAuthService_1[_0x168835(0x1c9)]),this['setAuthDetails']();}async['setAuthDetails'](){const _0x1417af=a269_0x438e6c;this[_0x1417af(0x1a2)][_0x1417af(0x187)](_0x1417af(0x1bd),auth_state_enum_1[_0x1417af(0x1b1)][this[_0x1417af(0x191)]]);try{if(this[_0x1417af(0x191)]===auth_state_enum_1['AuthState'][_0x1417af(0x1bb)])return;if(this[_0x1417af(0x191)]===auth_state_enum_1['AuthState'][_0x1417af(0x1c0)])await this[_0x1417af(0x17f)]();else{const _0x4fb594=await this[_0x1417af(0x1c7)](),_0x12a0ca=await axios_1['default'][_0x1417af(0x1d3)](_0x1417af(0x1b2)+constants_1[_0x1417af(0x190)],_0x4fb594)[_0x1417af(0x1b9)](()=>!![])[_0x1417af(0x1c4)](()=>![]);!_0x12a0ca&&await this['updateAccessToken']();}}catch(_0x501112){}}async[a269_0x438e6c(0x17f)](){const _0x389b53=a269_0x438e6c;var _0x48be1b,_0x5eda9d,_0x2c0b1b;this[_0x389b53(0x1a2)]['log'](_0x389b53(0x1c8));try{this[_0x389b53(0x191)]=auth_state_enum_1['AuthState'][_0x389b53(0x17e)];const {refreshToken:_0x43ec6e,clientId:_0x2bce8e,clientSecret:_0x7a0617,loginUrl:_0x953ee1}=typedi_1['default'][_0x389b53(0x1d3)](providers_tokens_1['Tokens'][_0x389b53(0x1bf)]),{data:_0x560c10}=await axios_1[_0x389b53(0x18c)]['post']((0x0,utils_1[_0x389b53(0x1d4)])(_0x953ee1,_0x389b53(0x1da)),null,{'params':{'grant_type':_0x389b53(0x19b),'refresh_token':_0x43ec6e,'client_id':_0x2bce8e,'client_secret':_0x7a0617}});this[_0x389b53(0x1ce)]=_0x560c10[_0x389b53(0x19f)],this[_0x389b53(0x1be)]=_0x560c10['access_token'],this[_0x389b53(0x1b8)]=_0x560c10['token_type'],this[_0x389b53(0x191)]=auth_state_enum_1['AuthState'][_0x389b53(0x189)],this['logger']['log'](_0x389b53(0x1af),this[_0x389b53(0x1ce)]);}catch(_0x22cd75){const _0x533709=((_0x5eda9d=(_0x48be1b=_0x22cd75===null||_0x22cd75===void 0x0?void 0x0:_0x22cd75[_0x389b53(0x194)])===null||_0x48be1b===void 0x0?void 0x0:_0x48be1b[_0x389b53(0x19d)])===null||_0x5eda9d===void 0x0?void 0x0:_0x5eda9d['error'])||((_0x2c0b1b=_0x22cd75===null||_0x22cd75===void 0x0?void 0x0:_0x22cd75[_0x389b53(0x194)])===null||_0x2c0b1b===void 0x0?void 0x0:_0x2c0b1b[_0x389b53(0x19d)])||_0x22cd75[_0x389b53(0x1d2)];this[_0x389b53(0x1a2)][_0x389b53(0x1a3)]('Update\x20access\x20token\x20failed:\x20%s',_0x533709),this[_0x389b53(0x191)]=auth_state_enum_1[_0x389b53(0x1b1)]['Error'];throw new invalid_refresh_token_error_1[(_0x389b53(0x1a6))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a269_0x438e6c(0x18f)](){const _0x3566bd=a269_0x438e6c;this[_0x3566bd(0x1a2)][_0x3566bd(0x187)](_0x3566bd(0x184));if(this['authState']===auth_state_enum_1[_0x3566bd(0x1b1)][_0x3566bd(0x17e)]||this[_0x3566bd(0x191)]===auth_state_enum_1[_0x3566bd(0x1b1)][_0x3566bd(0x1c0)])return await(0x0,utils_1[_0x3566bd(0x1d5)])(this['AUTH_WAIT_TIME']),this[_0x3566bd(0x18f)]();if(this[_0x3566bd(0x191)]===auth_state_enum_1['AuthState'][_0x3566bd(0x1bb)])throw new invalid_refresh_token_error_1[(_0x3566bd(0x1a6))](errors_1[_0x3566bd(0x182)]);await this[_0x3566bd(0x17f)]();}async[a269_0x438e6c(0x1a9)](){const _0x2ebe02=a269_0x438e6c;if(this[_0x2ebe02(0x191)]===auth_state_enum_1[_0x2ebe02(0x1b1)]['Error']){this['logger']['log'](_0x2ebe02(0x195));throw new unauthorized_salesforce_error_1[(_0x2ebe02(0x17d))]();}if(this[_0x2ebe02(0x191)]!==auth_state_enum_1[_0x2ebe02(0x1b1)][_0x2ebe02(0x189)])return this[_0x2ebe02(0x1a2)][_0x2ebe02(0x187)](_0x2ebe02(0x18e)),await(0x0,utils_1[_0x2ebe02(0x1d5)])(this['AUTH_WAIT_TIME']),this['waitAuth']();}[a269_0x438e6c(0x1d8)](){const _0x2ce114=a269_0x438e6c;return{'orgId':this['orgId'],'accessToken':this[_0x2ce114(0x1be)],'instanceUrl':this[_0x2ce114(0x1ce)]};}async[a269_0x438e6c(0x1c7)](_0x1edec8=''){const _0x5c6db2=a269_0x438e6c;await this[_0x5c6db2(0x1a9)]();const _0x59f12a={'baseURL':this[_0x5c6db2(0x1ce)],'headers':{'accept':'application/json'}};if(salesforce_1['SalesforceUtils'][_0x5c6db2(0x188)](_0x1edec8))_0x59f12a['headers']['X-SFDC-Session']=this['accessToken'];else salesforce_1[_0x5c6db2(0x1b0)]['isSoapUrl'](_0x1edec8)?_0x59f12a['data']=_0x59f12a[_0x5c6db2(0x19d)][_0x5c6db2(0x1c3)](/<met:sessionId>.+?<\/met:sessionId>/,_0x5c6db2(0x1b7)+this['accessToken']+_0x5c6db2(0x186)):_0x59f12a[_0x5c6db2(0x1aa)][_0x5c6db2(0x1a8)]=this[_0x5c6db2(0x1b8)]+'\x20'+this[_0x5c6db2(0x1be)];return _0x59f12a;}};function a269_0x587d(){const _0x4e85b5=['getAuthData','apply','/services/oauth2/token','SalesforceAuthService','axios','UnauthorizedSalesforceError','Updating','updateAccessToken','367825EmIQUm','__importStar','ERR_INVALID_SALESFORCE_TOKEN','5283880FKLqDh','Force\x20update\x20token','1070714bipIra','</met:sessionId>','log','isBulk1Url','Active','create','configurable','default','../../providers/providers.tokens','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','forceUpdateToken','SALESFORCE_API_VERSION','authState','../../../../core','design:paramtypes','response','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','8sOMsyM','defineProperty','130BVdgNv','__importDefault','length','refresh_token','toString','data','../errors/invalid-refresh-token.error','instance_url','typedi','Logger','logger','error','../../../../constants','629382DndxCC','InvalidRefreshTokenError','search','authorization','waitAuth','headers','../errors/unauthorized-salesforce.error','308019GJATod','@flosum/salesforce','(((.+)+)+)+$','Access\x20token\x20updated\x20for\x20%s','SalesforceUtils','AuthState','services/data/','function','call','decorate','hasOwnProperty','<met:sessionId>','tokenType','then','../../../../constants/errors','Error','constructor','Check\x20auth:\x20current\x20state\x20-\x20%s','accessToken','salesforce','Idle','__decorate','object','replace','catch','Service','30DHuFdA','requestConfig','Update\x20access\x20token','name','228996egokrI','getOwnPropertyDescriptor','2761480DAFeqE','__setModuleDefault','instanceUrl','../enums/auth-state.enum','__esModule','writable','message','get','joinURL','sleep','metadata','__createBinding'];a269_0x587d=function(){return _0x4e85b5;};return a269_0x587d();}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a269_0x438e6c(0x1c5)])(),__metadata(a269_0x438e6c(0x193),[])],SalesforceAuthService),exports[a269_0x438e6c(0x1db)]=SalesforceAuthService;