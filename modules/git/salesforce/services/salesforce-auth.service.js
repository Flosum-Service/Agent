const a232_0x5cf238=a232_0x15b0;(function(_0x3bbba9,_0xbd3958){const _0x5da31e=a232_0x15b0,_0x399f34=_0x3bbba9();while(!![]){try{const _0x129939=-parseInt(_0x5da31e(0x22c))/0x1+-parseInt(_0x5da31e(0x202))/0x2+parseInt(_0x5da31e(0x21b))/0x3*(-parseInt(_0x5da31e(0x1ea))/0x4)+-parseInt(_0x5da31e(0x21d))/0x5+parseInt(_0x5da31e(0x1e5))/0x6+-parseInt(_0x5da31e(0x204))/0x7+parseInt(_0x5da31e(0x1f7))/0x8;if(_0x129939===_0xbd3958)break;else _0x399f34['push'](_0x399f34['shift']());}catch(_0x2d9a34){_0x399f34['push'](_0x399f34['shift']());}}}(a232_0x3206,0xac234));function a232_0x3206(){const _0x5834c9=['force\x20update\x20token','services/data/','response','typedi','log','__createBinding','catch','AUTH_WAIT_TIME','apply','update\x20access\x20token\x20failed:\x20%s','object','orgId','AuthState','SalesforceAuthService','waitAuth','post','1258059sgunPu','application/json','3947540pXvSaH','authState','Active','call','logger','sleep','Tokens','message','get','../errors/invalid-refresh-token.error','create\x20authorized\x20request\x20failed:\x20authorization\x20error','__importDefault','function','length','tokenType','1091500ZibzbW','design:paramtypes','decorate','../enums/auth-state.enum','../../../../core','prototype','requestConfig','1515510xOSjtO','../../../../constants/errors','forceUpdateToken','../../providers/providers.tokens','Error','12loJIww','Idle','instanceUrl','toString','../../../shared/utils','metadata','__esModule','ERR_INVALID_SALESFORCE_TOKEN','accessToken','access\x20token\x20updated\x20for\x20%s','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','setAuthDetails','update\x20access\x20token','39811160hHEPQi','then','default','__decorate','error','Logger','access_token','UnauthorizedSalesforceError','name','defineProperty','/services/oauth2/token','1078698pIzgtB','../../../../constants','5918416QEcJjm','data','salesforce','axios','getOwnPropertyDescriptor','updateAccessToken','Updating'];a232_0x3206=function(){return _0x5834c9;};return a232_0x3206();}const a232_0x5d1362=(function(){let _0x46d63e=!![];return function(_0x3a91d4,_0x33cd95){const _0x2f0142=_0x46d63e?function(){const _0x3edd4f=a232_0x15b0;if(_0x33cd95){const _0x540591=_0x33cd95[_0x3edd4f(0x213)](_0x3a91d4,arguments);return _0x33cd95=null,_0x540591;}}:function(){};return _0x46d63e=![],_0x2f0142;};}()),a232_0x3a815f=a232_0x5d1362(this,function(){const _0x5d6d38=a232_0x15b0;return a232_0x3a815f['toString']()['search']('(((.+)+)+)+$')[_0x5d6d38(0x1ed)]()['constructor'](a232_0x3a815f)['search']('(((.+)+)+)+$');});a232_0x3a815f();'use strict';var __createBinding=this&&this[a232_0x5cf238(0x210)]||(Object['create']?function(_0x45052c,_0x35be14,_0x415066,_0x4cb06e){const _0x153d3e=a232_0x5cf238;if(_0x4cb06e===undefined)_0x4cb06e=_0x415066;var _0x4cf72f=Object[_0x153d3e(0x208)](_0x35be14,_0x415066);(!_0x4cf72f||(_0x153d3e(0x225)in _0x4cf72f?!_0x35be14[_0x153d3e(0x1f0)]:_0x4cf72f['writable']||_0x4cf72f['configurable']))&&(_0x4cf72f={'enumerable':!![],'get':function(){return _0x35be14[_0x415066];}}),Object[_0x153d3e(0x200)](_0x45052c,_0x4cb06e,_0x4cf72f);}:function(_0x75a6b9,_0xe2d563,_0x286e66,_0x4ea280){if(_0x4ea280===undefined)_0x4ea280=_0x286e66;_0x75a6b9[_0x4ea280]=_0xe2d563[_0x286e66];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x210c48,_0x158abf){const _0x7779b0=a232_0x5cf238;Object[_0x7779b0(0x200)](_0x210c48,_0x7779b0(0x1f9),{'enumerable':!![],'value':_0x158abf});}:function(_0x291d97,_0x1a4a26){const _0x30ec49=a232_0x5cf238;_0x291d97[_0x30ec49(0x1f9)]=_0x1a4a26;}),__decorate=this&&this[a232_0x5cf238(0x1fa)]||function(_0x399c0b,_0x426e55,_0x3fcbb7,_0x75d29f){const _0x56a579=a232_0x5cf238;var _0x50b1b5=arguments[_0x56a579(0x22a)],_0x6c8120=_0x50b1b5<0x3?_0x426e55:_0x75d29f===null?_0x75d29f=Object[_0x56a579(0x208)](_0x426e55,_0x3fcbb7):_0x75d29f,_0x2f4511;if(typeof Reflect===_0x56a579(0x215)&&typeof Reflect[_0x56a579(0x22e)]===_0x56a579(0x229))_0x6c8120=Reflect[_0x56a579(0x22e)](_0x399c0b,_0x426e55,_0x3fcbb7,_0x75d29f);else{for(var _0x3a3110=_0x399c0b[_0x56a579(0x22a)]-0x1;_0x3a3110>=0x0;_0x3a3110--)if(_0x2f4511=_0x399c0b[_0x3a3110])_0x6c8120=(_0x50b1b5<0x3?_0x2f4511(_0x6c8120):_0x50b1b5>0x3?_0x2f4511(_0x426e55,_0x3fcbb7,_0x6c8120):_0x2f4511(_0x426e55,_0x3fcbb7))||_0x6c8120;}return _0x50b1b5>0x3&&_0x6c8120&&Object[_0x56a579(0x200)](_0x426e55,_0x3fcbb7,_0x6c8120),_0x6c8120;},__importStar=this&&this['__importStar']||function(_0x47a35d){const _0x2361a1=a232_0x5cf238;if(_0x47a35d&&_0x47a35d[_0x2361a1(0x1f0)])return _0x47a35d;var _0x4011db={};if(_0x47a35d!=null){for(var _0x3ce487 in _0x47a35d)if(_0x3ce487!=='default'&&Object[_0x2361a1(0x231)]['hasOwnProperty'][_0x2361a1(0x220)](_0x47a35d,_0x3ce487))__createBinding(_0x4011db,_0x47a35d,_0x3ce487);}return __setModuleDefault(_0x4011db,_0x47a35d),_0x4011db;},__metadata=this&&this['__metadata']||function(_0x53e91a,_0x3eaeeb){const _0x71ae7a=a232_0x5cf238;if(typeof Reflect===_0x71ae7a(0x215)&&typeof Reflect[_0x71ae7a(0x1ef)]===_0x71ae7a(0x229))return Reflect[_0x71ae7a(0x1ef)](_0x53e91a,_0x3eaeeb);},__importDefault=this&&this[a232_0x5cf238(0x228)]||function(_0x559d8e){const _0xbce339=a232_0x5cf238;return _0x559d8e&&_0x559d8e[_0xbce339(0x1f0)]?_0x559d8e:{'default':_0x559d8e};},SalesforceAuthService_1;Object[a232_0x5cf238(0x200)](exports,a232_0x5cf238(0x1f0),{'value':!![]}),exports[a232_0x5cf238(0x218)]=void 0x0;function a232_0x15b0(_0x4a5226,_0x455bb3){const _0x4e1b4a=a232_0x3206();return a232_0x15b0=function(_0x3a815f,_0x5d1362){_0x3a815f=_0x3a815f-0x1e5;let _0x3206ad=_0x4e1b4a[_0x3a815f];return _0x3206ad;},a232_0x15b0(_0x4a5226,_0x455bb3);}const typedi_1=__importStar(require(a232_0x5cf238(0x20e))),errors_1=require(a232_0x5cf238(0x1e6)),core_1=require(a232_0x5cf238(0x230)),axios_1=__importDefault(require(a232_0x5cf238(0x207))),utils_1=require(a232_0x5cf238(0x1ee)),invalid_refresh_token_error_1=require(a232_0x5cf238(0x226)),auth_state_enum_1=require(a232_0x5cf238(0x22f)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a232_0x5cf238(0x203)),providers_tokens_1=require(a232_0x5cf238(0x1e8));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x1688c4=a232_0x5cf238;this[_0x1688c4(0x212)]=0x1388,this['authState']=auth_state_enum_1[_0x1688c4(0x217)]['Idle'],this['logger']=new core_1[(_0x1688c4(0x1fc))](SalesforceAuthService_1[_0x1688c4(0x1ff)]),this['setAuthDetails']();}async[a232_0x5cf238(0x1f5)](){const _0x5830c5=a232_0x5cf238;this['logger'][_0x5830c5(0x20f)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x5830c5(0x217)][this[_0x5830c5(0x21e)]]);try{if(this['authState']===auth_state_enum_1['AuthState'][_0x5830c5(0x1e9)])return;if(this[_0x5830c5(0x21e)]===auth_state_enum_1[_0x5830c5(0x217)]['Idle'])await this[_0x5830c5(0x209)]();else{const _0xda60b4=await this[_0x5830c5(0x232)](),_0x3e37d5=await axios_1[_0x5830c5(0x1f9)]['get'](_0x5830c5(0x20c)+constants_1['SALESFORCE_API_VERSION'],_0xda60b4)[_0x5830c5(0x1f8)](()=>!![])[_0x5830c5(0x211)](()=>![]);!_0x3e37d5&&await this[_0x5830c5(0x209)]();}}catch(_0xa911d6){}}async[a232_0x5cf238(0x209)](){const _0x21aa04=a232_0x5cf238;var _0x304ea3,_0x542632,_0x4694f3;this[_0x21aa04(0x221)]['log'](_0x21aa04(0x1f6));try{this['authState']=auth_state_enum_1[_0x21aa04(0x217)][_0x21aa04(0x20a)];const {refreshToken:_0x239baa,clientId:_0x3616ba,clientSecret:_0x329dac,loginUrl:_0x3fd66f}=typedi_1[_0x21aa04(0x1f9)][_0x21aa04(0x225)](providers_tokens_1[_0x21aa04(0x223)][_0x21aa04(0x206)]),{data:_0x364a1d}=await axios_1[_0x21aa04(0x1f9)][_0x21aa04(0x21a)]((0x0,utils_1['joinURL'])(_0x3fd66f,_0x21aa04(0x201)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x239baa,'client_id':_0x3616ba,'client_secret':_0x329dac}});this[_0x21aa04(0x1ec)]=_0x364a1d['instance_url'],this[_0x21aa04(0x1f2)]=_0x364a1d[_0x21aa04(0x1fd)],this[_0x21aa04(0x22b)]=_0x364a1d['token_type'],this[_0x21aa04(0x21e)]=auth_state_enum_1[_0x21aa04(0x217)][_0x21aa04(0x21f)],this[_0x21aa04(0x221)]['log'](_0x21aa04(0x1f3),this[_0x21aa04(0x1ec)]);}catch(_0x3b3f4c){const _0x6aafc6=((_0x542632=(_0x304ea3=_0x3b3f4c===null||_0x3b3f4c===void 0x0?void 0x0:_0x3b3f4c[_0x21aa04(0x20d)])===null||_0x304ea3===void 0x0?void 0x0:_0x304ea3[_0x21aa04(0x205)])===null||_0x542632===void 0x0?void 0x0:_0x542632[_0x21aa04(0x1fb)])||((_0x4694f3=_0x3b3f4c===null||_0x3b3f4c===void 0x0?void 0x0:_0x3b3f4c['response'])===null||_0x4694f3===void 0x0?void 0x0:_0x4694f3['data'])||_0x3b3f4c[_0x21aa04(0x224)];this[_0x21aa04(0x221)]['error'](_0x21aa04(0x214),_0x6aafc6),this['authState']=auth_state_enum_1['AuthState'][_0x21aa04(0x1e9)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x21aa04(0x1f1)]);}}async[a232_0x5cf238(0x1e7)](){const _0x12671a=a232_0x5cf238;this[_0x12671a(0x221)]['log'](_0x12671a(0x20b));if(this['authState']===auth_state_enum_1[_0x12671a(0x217)][_0x12671a(0x20a)]||this['authState']===auth_state_enum_1[_0x12671a(0x217)][_0x12671a(0x1eb)])return await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this[_0x12671a(0x1e7)]();if(this[_0x12671a(0x21e)]===auth_state_enum_1['AuthState'][_0x12671a(0x1e9)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x12671a(0x209)]();}async[a232_0x5cf238(0x219)](){const _0x4f2f53=a232_0x5cf238;if(this[_0x4f2f53(0x21e)]===auth_state_enum_1[_0x4f2f53(0x217)]['Error']){this[_0x4f2f53(0x221)][_0x4f2f53(0x20f)](_0x4f2f53(0x227));throw new unauthorized_salesforce_error_1[(_0x4f2f53(0x1fe))]();}if(this[_0x4f2f53(0x21e)]!==auth_state_enum_1[_0x4f2f53(0x217)]['Active'])return this[_0x4f2f53(0x221)][_0x4f2f53(0x20f)](_0x4f2f53(0x1f4)),await(0x0,utils_1[_0x4f2f53(0x222)])(this[_0x4f2f53(0x212)]),this[_0x4f2f53(0x219)]();}['getAuthData'](){const _0x4585eb=a232_0x5cf238;return{'orgId':this[_0x4585eb(0x216)],'accessToken':this[_0x4585eb(0x1f2)],'instanceUrl':this['instanceUrl']};}async['requestConfig'](){const _0x21b4f3=a232_0x5cf238;return await this[_0x21b4f3(0x219)](),{'baseURL':this[_0x21b4f3(0x1ec)],'headers':{'accept':_0x21b4f3(0x21c),'authorization':this[_0x21b4f3(0x22b)]+'\x20'+this[_0x21b4f3(0x1f2)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a232_0x5cf238(0x22d),[])],SalesforceAuthService),exports[a232_0x5cf238(0x218)]=SalesforceAuthService;