const a226_0x1cfddc=a226_0x2884;(function(_0x1480dc,_0x4ebd5c){const _0x5a3eb4=a226_0x2884,_0x6bea44=_0x1480dc();while(!![]){try{const _0x4bab54=-parseInt(_0x5a3eb4(0x10f))/0x1*(parseInt(_0x5a3eb4(0x13e))/0x2)+parseInt(_0x5a3eb4(0x14d))/0x3*(parseInt(_0x5a3eb4(0x133))/0x4)+-parseInt(_0x5a3eb4(0x132))/0x5*(-parseInt(_0x5a3eb4(0x161))/0x6)+parseInt(_0x5a3eb4(0x155))/0x7*(parseInt(_0x5a3eb4(0x11c))/0x8)+parseInt(_0x5a3eb4(0x126))/0x9+parseInt(_0x5a3eb4(0x15d))/0xa*(parseInt(_0x5a3eb4(0x121))/0xb)+-parseInt(_0x5a3eb4(0x15a))/0xc*(parseInt(_0x5a3eb4(0x15e))/0xd);if(_0x4bab54===_0x4ebd5c)break;else _0x6bea44['push'](_0x6bea44['shift']());}catch(_0x429544){_0x6bea44['push'](_0x6bea44['shift']());}}}(a226_0x5291,0x9a5a5));const a226_0x46a367=(function(){let _0x4c5f6b=!![];return function(_0x17027f,_0x2bacf3){const _0x34b862=_0x4c5f6b?function(){if(_0x2bacf3){const _0x4da50b=_0x2bacf3['apply'](_0x17027f,arguments);return _0x2bacf3=null,_0x4da50b;}}:function(){};return _0x4c5f6b=![],_0x34b862;};}()),a226_0xae97b7=a226_0x46a367(this,function(){const _0x343e74=a226_0x2884;return a226_0xae97b7['toString']()['search'](_0x343e74(0x114))[_0x343e74(0x12a)]()[_0x343e74(0x151)](a226_0xae97b7)[_0x343e74(0x14e)](_0x343e74(0x114));});a226_0xae97b7();function a226_0x5291(){const _0x4dfcfb=['Updating','create\x20authorized\x20request\x20failed:\x20authorization\x20error','hasOwnProperty','AuthState','update\x20access\x20token\x20failed:\x20%s','forceUpdateToken','../../../../constants','getOwnPropertyDescriptor','getAuthData','../enums/auth-state.enum','logger','data','__createBinding','ERR_INVALID_SALESFORCE_TOKEN','147723CwJUpl','search','writable','InvalidRefreshTokenError','constructor','token_type','Tokens','Error','69181fQWUOD','function','Logger','access\x20token\x20updated\x20for\x20%s','default','24JZMMDP','sleep','services/data/','47230ZPAieE','10843690TJAxMN','defineProperty','__decorate','80982RfEGCq','__setModuleDefault','configurable','updateAccessToken','899lOkfBi','typedi','design:paramtypes','setAuthDetails','length','(((.+)+)+)+$','../../../shared/utils','message','orgId','requestConfig','axios','../errors/unauthorized-salesforce.error','name','1016nWOsYf','check\x20auth:\x20current\x20state\x20-\x20%s','../errors/invalid-refresh-token.error','metadata','log','605CBrmuV','refresh_token','joinURL','object','response','6066117NRTxsq','instanceUrl','__esModule','Active','toString','create','Idle','application/json','tokenType','error','catch','Service','225RlbyoF','44oyEXXA','accessToken','authState','then','__metadata','post','AUTH_WAIT_TIME','get','access_token','waitAuth','prototype','2308gfqqNZ'];a226_0x5291=function(){return _0x4dfcfb;};return a226_0x5291();}'use strict';function a226_0x2884(_0x2a28c8,_0x2a1e66){const _0x8eb4f5=a226_0x5291();return a226_0x2884=function(_0xae97b7,_0x46a367){_0xae97b7=_0xae97b7-0x10f;let _0x529163=_0x8eb4f5[_0xae97b7];return _0x529163;},a226_0x2884(_0x2a28c8,_0x2a1e66);}var __createBinding=this&&this[a226_0x1cfddc(0x14b)]||(Object[a226_0x1cfddc(0x12b)]?function(_0x48289d,_0x39dd1b,_0x405d42,_0x22c10d){const _0x3bba87=a226_0x1cfddc;if(_0x22c10d===undefined)_0x22c10d=_0x405d42;var _0xea7051=Object['getOwnPropertyDescriptor'](_0x39dd1b,_0x405d42);(!_0xea7051||('get'in _0xea7051?!_0x39dd1b['__esModule']:_0xea7051[_0x3bba87(0x14f)]||_0xea7051[_0x3bba87(0x163)]))&&(_0xea7051={'enumerable':!![],'get':function(){return _0x39dd1b[_0x405d42];}}),Object[_0x3bba87(0x15f)](_0x48289d,_0x22c10d,_0xea7051);}:function(_0x12c928,_0x452055,_0x10dbd1,_0x4fbcd0){if(_0x4fbcd0===undefined)_0x4fbcd0=_0x10dbd1;_0x12c928[_0x4fbcd0]=_0x452055[_0x10dbd1];}),__setModuleDefault=this&&this[a226_0x1cfddc(0x162)]||(Object['create']?function(_0x13dfd2,_0x5e30a3){const _0x4f191c=a226_0x1cfddc;Object[_0x4f191c(0x15f)](_0x13dfd2,_0x4f191c(0x159),{'enumerable':!![],'value':_0x5e30a3});}:function(_0x2eaea1,_0x19039c){const _0x484072=a226_0x1cfddc;_0x2eaea1[_0x484072(0x159)]=_0x19039c;}),__decorate=this&&this[a226_0x1cfddc(0x160)]||function(_0x47ba26,_0x273d78,_0x662417,_0x2126c8){const _0x1c1674=a226_0x1cfddc;var _0x23f32f=arguments[_0x1c1674(0x113)],_0x55630e=_0x23f32f<0x3?_0x273d78:_0x2126c8===null?_0x2126c8=Object[_0x1c1674(0x146)](_0x273d78,_0x662417):_0x2126c8,_0x1a36ad;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x1c1674(0x156))_0x55630e=Reflect['decorate'](_0x47ba26,_0x273d78,_0x662417,_0x2126c8);else{for(var _0x56ba77=_0x47ba26['length']-0x1;_0x56ba77>=0x0;_0x56ba77--)if(_0x1a36ad=_0x47ba26[_0x56ba77])_0x55630e=(_0x23f32f<0x3?_0x1a36ad(_0x55630e):_0x23f32f>0x3?_0x1a36ad(_0x273d78,_0x662417,_0x55630e):_0x1a36ad(_0x273d78,_0x662417))||_0x55630e;}return _0x23f32f>0x3&&_0x55630e&&Object[_0x1c1674(0x15f)](_0x273d78,_0x662417,_0x55630e),_0x55630e;},__importStar=this&&this['__importStar']||function(_0x1fd9e4){const _0x39ea8f=a226_0x1cfddc;if(_0x1fd9e4&&_0x1fd9e4[_0x39ea8f(0x128)])return _0x1fd9e4;var _0x1b9c6d={};if(_0x1fd9e4!=null){for(var _0x5abfe2 in _0x1fd9e4)if(_0x5abfe2!==_0x39ea8f(0x159)&&Object[_0x39ea8f(0x13d)][_0x39ea8f(0x141)]['call'](_0x1fd9e4,_0x5abfe2))__createBinding(_0x1b9c6d,_0x1fd9e4,_0x5abfe2);}return __setModuleDefault(_0x1b9c6d,_0x1fd9e4),_0x1b9c6d;},__metadata=this&&this[a226_0x1cfddc(0x137)]||function(_0x139ded,_0x5da295){const _0x22520a=a226_0x1cfddc;if(typeof Reflect===_0x22520a(0x124)&&typeof Reflect[_0x22520a(0x11f)]===_0x22520a(0x156))return Reflect[_0x22520a(0x11f)](_0x139ded,_0x5da295);},__importDefault=this&&this['__importDefault']||function(_0x27795f){const _0x87b21e=a226_0x1cfddc;return _0x27795f&&_0x27795f[_0x87b21e(0x128)]?_0x27795f:{'default':_0x27795f};},SalesforceAuthService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a226_0x1cfddc(0x110))),errors_1=require('../../../../constants/errors'),core_1=require('../../../../core'),axios_1=__importDefault(require(a226_0x1cfddc(0x119))),utils_1=require(a226_0x1cfddc(0x115)),invalid_refresh_token_error_1=require(a226_0x1cfddc(0x11e)),auth_state_enum_1=require(a226_0x1cfddc(0x148)),unauthorized_salesforce_error_1=require(a226_0x1cfddc(0x11a)),constants_1=require(a226_0x1cfddc(0x145)),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x5966dc=a226_0x1cfddc;this[_0x5966dc(0x139)]=0x1388,this[_0x5966dc(0x135)]=auth_state_enum_1[_0x5966dc(0x142)]['Idle'],this[_0x5966dc(0x149)]=new core_1[(_0x5966dc(0x157))](SalesforceAuthService_1[_0x5966dc(0x11b)]),this[_0x5966dc(0x112)]();}async['setAuthDetails'](){const _0xfd7ba6=a226_0x1cfddc;this[_0xfd7ba6(0x149)][_0xfd7ba6(0x120)](_0xfd7ba6(0x11d),auth_state_enum_1['AuthState'][this[_0xfd7ba6(0x135)]]);try{if(this['authState']===auth_state_enum_1['AuthState'][_0xfd7ba6(0x154)])return;if(this[_0xfd7ba6(0x135)]===auth_state_enum_1[_0xfd7ba6(0x142)][_0xfd7ba6(0x12c)])await this['updateAccessToken']();else{const _0x49e87d=await this[_0xfd7ba6(0x118)](),_0x1dca38=await axios_1[_0xfd7ba6(0x159)][_0xfd7ba6(0x13a)](_0xfd7ba6(0x15c)+constants_1['SALESFORCE_API_VERSION'],_0x49e87d)[_0xfd7ba6(0x136)](()=>!![])[_0xfd7ba6(0x130)](()=>![]);!_0x1dca38&&await this[_0xfd7ba6(0x164)]();}}catch(_0x1f0742){}}async[a226_0x1cfddc(0x164)](){const _0x3aa3f5=a226_0x1cfddc;var _0x3618ba,_0x3eb380,_0x5ab6d9;this[_0x3aa3f5(0x149)][_0x3aa3f5(0x120)]('update\x20access\x20token');try{this[_0x3aa3f5(0x135)]=auth_state_enum_1[_0x3aa3f5(0x142)][_0x3aa3f5(0x13f)];const {refreshToken:_0x329fe0,clientId:_0x5f0232,clientSecret:_0x163ee6,loginUrl:_0x2cd419}=typedi_1['default']['get'](providers_tokens_1[_0x3aa3f5(0x153)]['salesforce']),{data:_0x23193b}=await axios_1[_0x3aa3f5(0x159)][_0x3aa3f5(0x138)]((0x0,utils_1[_0x3aa3f5(0x123)])(_0x2cd419,'/services/oauth2/token'),null,{'params':{'grant_type':_0x3aa3f5(0x122),'refresh_token':_0x329fe0,'client_id':_0x5f0232,'client_secret':_0x163ee6}});this[_0x3aa3f5(0x127)]=_0x23193b['instance_url'],this[_0x3aa3f5(0x134)]=_0x23193b[_0x3aa3f5(0x13b)],this[_0x3aa3f5(0x12e)]=_0x23193b[_0x3aa3f5(0x152)],this['authState']=auth_state_enum_1[_0x3aa3f5(0x142)][_0x3aa3f5(0x129)],this['logger'][_0x3aa3f5(0x120)](_0x3aa3f5(0x158),this[_0x3aa3f5(0x127)]);}catch(_0x5d3f26){const _0x40df00=((_0x3eb380=(_0x3618ba=_0x5d3f26===null||_0x5d3f26===void 0x0?void 0x0:_0x5d3f26[_0x3aa3f5(0x125)])===null||_0x3618ba===void 0x0?void 0x0:_0x3618ba['data'])===null||_0x3eb380===void 0x0?void 0x0:_0x3eb380[_0x3aa3f5(0x12f)])||((_0x5ab6d9=_0x5d3f26===null||_0x5d3f26===void 0x0?void 0x0:_0x5d3f26[_0x3aa3f5(0x125)])===null||_0x5ab6d9===void 0x0?void 0x0:_0x5ab6d9[_0x3aa3f5(0x14a)])||_0x5d3f26[_0x3aa3f5(0x116)];this['logger'][_0x3aa3f5(0x12f)](_0x3aa3f5(0x143),_0x40df00),this[_0x3aa3f5(0x135)]=auth_state_enum_1[_0x3aa3f5(0x142)][_0x3aa3f5(0x154)];throw new invalid_refresh_token_error_1[(_0x3aa3f5(0x150))](errors_1[_0x3aa3f5(0x14c)]);}}async[a226_0x1cfddc(0x144)](){const _0x4f0dae=a226_0x1cfddc;this[_0x4f0dae(0x149)][_0x4f0dae(0x120)]('force\x20update\x20token');if(this[_0x4f0dae(0x135)]===auth_state_enum_1['AuthState']['Updating']||this[_0x4f0dae(0x135)]===auth_state_enum_1['AuthState'][_0x4f0dae(0x12c)])return await(0x0,utils_1[_0x4f0dae(0x15b)])(this[_0x4f0dae(0x139)]),this[_0x4f0dae(0x144)]();if(this[_0x4f0dae(0x135)]===auth_state_enum_1[_0x4f0dae(0x142)][_0x4f0dae(0x154)])throw new invalid_refresh_token_error_1[(_0x4f0dae(0x150))](errors_1[_0x4f0dae(0x14c)]);await this[_0x4f0dae(0x164)]();}async['waitAuth'](){const _0x5397cf=a226_0x1cfddc;if(this['authState']===auth_state_enum_1[_0x5397cf(0x142)][_0x5397cf(0x154)]){this[_0x5397cf(0x149)]['log'](_0x5397cf(0x140));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x5397cf(0x135)]!==auth_state_enum_1[_0x5397cf(0x142)][_0x5397cf(0x129)])return this['logger'][_0x5397cf(0x120)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x5397cf(0x15b)])(this[_0x5397cf(0x139)]),this[_0x5397cf(0x13c)]();}[a226_0x1cfddc(0x147)](){const _0x578b1c=a226_0x1cfddc;return{'orgId':this[_0x578b1c(0x117)],'accessToken':this['accessToken'],'instanceUrl':this['instanceUrl']};}async[a226_0x1cfddc(0x118)](){const _0x297bd4=a226_0x1cfddc;return await this[_0x297bd4(0x13c)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x297bd4(0x12d),'authorization':this[_0x297bd4(0x12e)]+'\x20'+this[_0x297bd4(0x134)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a226_0x1cfddc(0x131)])(),__metadata(a226_0x1cfddc(0x111),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;