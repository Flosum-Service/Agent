const a227_0x2a4edf=a227_0x4cc1;(function(_0x45834d,_0x512dbf){const _0x54edd4=a227_0x4cc1,_0x46d051=_0x45834d();while(!![]){try{const _0x3d08e7=-parseInt(_0x54edd4(0x170))/0x1*(-parseInt(_0x54edd4(0x1a6))/0x2)+parseInt(_0x54edd4(0x1b3))/0x3+-parseInt(_0x54edd4(0x1a0))/0x4+parseInt(_0x54edd4(0x185))/0x5+-parseInt(_0x54edd4(0x197))/0x6+-parseInt(_0x54edd4(0x16a))/0x7*(parseInt(_0x54edd4(0x182))/0x8)+parseInt(_0x54edd4(0x17d))/0x9;if(_0x3d08e7===_0x512dbf)break;else _0x46d051['push'](_0x46d051['shift']());}catch(_0x1e0e11){_0x46d051['push'](_0x46d051['shift']());}}}(a227_0x889f,0x21107));const a227_0x53b7a7=(function(){let _0x3a3d93=!![];return function(_0x54ff12,_0x31c060){const _0x31a66b=_0x3a3d93?function(){const _0x2adf3e=a227_0x4cc1;if(_0x31c060){const _0x29cbca=_0x31c060[_0x2adf3e(0x192)](_0x54ff12,arguments);return _0x31c060=null,_0x29cbca;}}:function(){};return _0x3a3d93=![],_0x31a66b;};}()),a227_0x30670e=a227_0x53b7a7(this,function(){const _0x1c358e=a227_0x4cc1;return a227_0x30670e[_0x1c358e(0x18c)]()[_0x1c358e(0x16e)](_0x1c358e(0x1a4))[_0x1c358e(0x18c)]()[_0x1c358e(0x164)](a227_0x30670e)[_0x1c358e(0x16e)]('(((.+)+)+)+$');});a227_0x30670e();'use strict';function a227_0x4cc1(_0x2f32d5,_0x4ab91b){const _0x5ea7c8=a227_0x889f();return a227_0x4cc1=function(_0x30670e,_0x53b7a7){_0x30670e=_0x30670e-0x164;let _0x889f2c=_0x5ea7c8[_0x30670e];return _0x889f2c;},a227_0x4cc1(_0x2f32d5,_0x4ab91b);}var __createBinding=this&&this[a227_0x2a4edf(0x18d)]||(Object[a227_0x2a4edf(0x187)]?function(_0x15054e,_0x2c72ac,_0x3dc285,_0x51fddb){const _0x3383c8=a227_0x2a4edf;if(_0x51fddb===undefined)_0x51fddb=_0x3dc285;var _0x256cc8=Object[_0x3383c8(0x176)](_0x2c72ac,_0x3dc285);(!_0x256cc8||(_0x3383c8(0x174)in _0x256cc8?!_0x2c72ac['__esModule']:_0x256cc8[_0x3383c8(0x16c)]||_0x256cc8[_0x3383c8(0x19f)]))&&(_0x256cc8={'enumerable':!![],'get':function(){return _0x2c72ac[_0x3dc285];}}),Object['defineProperty'](_0x15054e,_0x51fddb,_0x256cc8);}:function(_0x29c94f,_0x42a3d0,_0x1a4287,_0x52e552){if(_0x52e552===undefined)_0x52e552=_0x1a4287;_0x29c94f[_0x52e552]=_0x42a3d0[_0x1a4287];}),__setModuleDefault=this&&this[a227_0x2a4edf(0x1ae)]||(Object[a227_0x2a4edf(0x187)]?function(_0xb892d4,_0x5539af){const _0x328ae1=a227_0x2a4edf;Object[_0x328ae1(0x199)](_0xb892d4,_0x328ae1(0x165),{'enumerable':!![],'value':_0x5539af});}:function(_0x203a7b,_0x74f00b){const _0x44ee76=a227_0x2a4edf;_0x203a7b[_0x44ee76(0x165)]=_0x74f00b;}),__decorate=this&&this['__decorate']||function(_0x5107d6,_0x385c86,_0x170ca7,_0x428d80){const _0x171bb5=a227_0x2a4edf;var _0x243c46=arguments[_0x171bb5(0x18e)],_0x35edc4=_0x243c46<0x3?_0x385c86:_0x428d80===null?_0x428d80=Object['getOwnPropertyDescriptor'](_0x385c86,_0x170ca7):_0x428d80,_0x358003;if(typeof Reflect===_0x171bb5(0x19a)&&typeof Reflect[_0x171bb5(0x166)]===_0x171bb5(0x19e))_0x35edc4=Reflect['decorate'](_0x5107d6,_0x385c86,_0x170ca7,_0x428d80);else{for(var _0x2c47ce=_0x5107d6[_0x171bb5(0x18e)]-0x1;_0x2c47ce>=0x0;_0x2c47ce--)if(_0x358003=_0x5107d6[_0x2c47ce])_0x35edc4=(_0x243c46<0x3?_0x358003(_0x35edc4):_0x243c46>0x3?_0x358003(_0x385c86,_0x170ca7,_0x35edc4):_0x358003(_0x385c86,_0x170ca7))||_0x35edc4;}return _0x243c46>0x3&&_0x35edc4&&Object[_0x171bb5(0x199)](_0x385c86,_0x170ca7,_0x35edc4),_0x35edc4;},__importStar=this&&this[a227_0x2a4edf(0x17f)]||function(_0x4ebf5b){const _0x592bca=a227_0x2a4edf;if(_0x4ebf5b&&_0x4ebf5b[_0x592bca(0x1b9)])return _0x4ebf5b;var _0x32ca16={};if(_0x4ebf5b!=null){for(var _0x24c141 in _0x4ebf5b)if(_0x24c141!=='default'&&Object['prototype']['hasOwnProperty'][_0x592bca(0x16d)](_0x4ebf5b,_0x24c141))__createBinding(_0x32ca16,_0x4ebf5b,_0x24c141);}return __setModuleDefault(_0x32ca16,_0x4ebf5b),_0x32ca16;},__metadata=this&&this[a227_0x2a4edf(0x188)]||function(_0x62f3a0,_0x202acb){const _0x352e3d=a227_0x2a4edf;if(typeof Reflect==='object'&&typeof Reflect[_0x352e3d(0x1a5)]==='function')return Reflect[_0x352e3d(0x1a5)](_0x62f3a0,_0x202acb);},__importDefault=this&&this[a227_0x2a4edf(0x194)]||function(_0x53a4bd){const _0x1833ff=a227_0x2a4edf;return _0x53a4bd&&_0x53a4bd[_0x1833ff(0x1b9)]?_0x53a4bd:{'default':_0x53a4bd};},SalesforceAuthService_1;function a227_0x889f(){const _0x516e3d=['__metadata','../../../../constants','log','instanceUrl','toString','__createBinding','length','error','sleep','tokenType','apply','Logger','__importDefault','requestConfig','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','1353612WWqWdQ','/services/oauth2/token','defineProperty','object','instance_url','InvalidRefreshTokenError','../../../../constants/errors','function','configurable','300884VwFoKx','application/json','post','check\x20auth:\x20current\x20state\x20-\x20%s','(((.+)+)+)+$','metadata','38Vbvhrt','waitAuth','services/data/','../../../shared/utils','token_type','AUTH_WAIT_TIME','force\x20update\x20token','Active','__setModuleDefault','accessToken','logger','create\x20authorized\x20request\x20failed:\x20authorization\x20error','../../providers/providers.tokens','469656ehhmDZ','updateAccessToken','AuthState','orgId','forceUpdateToken','authState','__esModule','setAuthDetails','axios','constructor','default','decorate','access\x20token\x20updated\x20for\x20%s','SalesforceAuthService','response','1247743xOLoCo','update\x20access\x20token\x20failed:\x20%s','writable','call','search','message','13655BiDBCK','design:paramtypes','data','ERR_INVALID_SALESFORCE_TOKEN','get','../enums/auth-state.enum','getOwnPropertyDescriptor','access_token','Service','../../../../core','Updating','Idle','Error','331263GTWjqS','then','__importStar','name','SALESFORCE_API_VERSION','8xBwCZF','Tokens','refresh_token','808495WvuTdv','getAuthData','create'];a227_0x889f=function(){return _0x516e3d;};return a227_0x889f();}Object[a227_0x2a4edf(0x199)](exports,'__esModule',{'value':!![]}),exports[a227_0x2a4edf(0x168)]=void 0x0;const typedi_1=__importStar(require('typedi')),errors_1=require(a227_0x2a4edf(0x19d)),core_1=require(a227_0x2a4edf(0x179)),axios_1=__importDefault(require(a227_0x2a4edf(0x1bb))),utils_1=require(a227_0x2a4edf(0x1a9)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a227_0x2a4edf(0x175)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a227_0x2a4edf(0x189)),providers_tokens_1=require(a227_0x2a4edf(0x1b2));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x5ed214=a227_0x2a4edf;this[_0x5ed214(0x1ab)]=0x1388,this[_0x5ed214(0x1b8)]=auth_state_enum_1['AuthState']['Idle'],this[_0x5ed214(0x1b0)]=new core_1[(_0x5ed214(0x193))](SalesforceAuthService_1[_0x5ed214(0x180)]),this[_0x5ed214(0x1ba)]();}async['setAuthDetails'](){const _0x224531=a227_0x2a4edf;this['logger']['log'](_0x224531(0x1a3),auth_state_enum_1[_0x224531(0x1b5)][this[_0x224531(0x1b8)]]);try{if(this[_0x224531(0x1b8)]===auth_state_enum_1[_0x224531(0x1b5)][_0x224531(0x17c)])return;if(this[_0x224531(0x1b8)]===auth_state_enum_1[_0x224531(0x1b5)]['Idle'])await this['updateAccessToken']();else{const _0x9f60f2=await this[_0x224531(0x195)](),_0x28f7ba=await axios_1[_0x224531(0x165)][_0x224531(0x174)](_0x224531(0x1a8)+constants_1[_0x224531(0x181)],_0x9f60f2)[_0x224531(0x17e)](()=>!![])['catch'](()=>![]);!_0x28f7ba&&await this['updateAccessToken']();}}catch(_0x4aa898){}}async[a227_0x2a4edf(0x1b4)](){const _0x214556=a227_0x2a4edf;var _0x17b522,_0x2a9d6b,_0x573f65;this[_0x214556(0x1b0)]['log']('update\x20access\x20token');try{this['authState']=auth_state_enum_1[_0x214556(0x1b5)][_0x214556(0x17a)];const {refreshToken:_0x2ab8b8,clientId:_0x2f5ce0,clientSecret:_0x170cbd,loginUrl:_0x1872f5}=typedi_1[_0x214556(0x165)][_0x214556(0x174)](providers_tokens_1[_0x214556(0x183)]['salesforce']),{data:_0x42ffd4}=await axios_1[_0x214556(0x165)][_0x214556(0x1a2)]((0x0,utils_1['joinURL'])(_0x1872f5,_0x214556(0x198)),null,{'params':{'grant_type':_0x214556(0x184),'refresh_token':_0x2ab8b8,'client_id':_0x2f5ce0,'client_secret':_0x170cbd}});this[_0x214556(0x18b)]=_0x42ffd4[_0x214556(0x19b)],this[_0x214556(0x1af)]=_0x42ffd4[_0x214556(0x177)],this[_0x214556(0x191)]=_0x42ffd4[_0x214556(0x1aa)],this[_0x214556(0x1b8)]=auth_state_enum_1[_0x214556(0x1b5)]['Active'],this[_0x214556(0x1b0)]['log'](_0x214556(0x167),this[_0x214556(0x18b)]);}catch(_0x484639){const _0x250562=((_0x2a9d6b=(_0x17b522=_0x484639===null||_0x484639===void 0x0?void 0x0:_0x484639[_0x214556(0x169)])===null||_0x17b522===void 0x0?void 0x0:_0x17b522[_0x214556(0x172)])===null||_0x2a9d6b===void 0x0?void 0x0:_0x2a9d6b[_0x214556(0x18f)])||((_0x573f65=_0x484639===null||_0x484639===void 0x0?void 0x0:_0x484639[_0x214556(0x169)])===null||_0x573f65===void 0x0?void 0x0:_0x573f65['data'])||_0x484639[_0x214556(0x16f)];this[_0x214556(0x1b0)][_0x214556(0x18f)](_0x214556(0x16b),_0x250562),this[_0x214556(0x1b8)]=auth_state_enum_1['AuthState']['Error'];throw new invalid_refresh_token_error_1[(_0x214556(0x19c))](errors_1[_0x214556(0x173)]);}}async[a227_0x2a4edf(0x1b7)](){const _0x1b108b=a227_0x2a4edf;this[_0x1b108b(0x1b0)][_0x1b108b(0x18a)](_0x1b108b(0x1ac));if(this[_0x1b108b(0x1b8)]===auth_state_enum_1[_0x1b108b(0x1b5)]['Updating']||this['authState']===auth_state_enum_1[_0x1b108b(0x1b5)][_0x1b108b(0x17b)])return await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this[_0x1b108b(0x1b7)]();if(this[_0x1b108b(0x1b8)]===auth_state_enum_1[_0x1b108b(0x1b5)]['Error'])throw new invalid_refresh_token_error_1[(_0x1b108b(0x19c))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x1b108b(0x1b4)]();}async['waitAuth'](){const _0x4ed265=a227_0x2a4edf;if(this[_0x4ed265(0x1b8)]===auth_state_enum_1[_0x4ed265(0x1b5)]['Error']){this[_0x4ed265(0x1b0)]['log'](_0x4ed265(0x1b1));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this['authState']!==auth_state_enum_1['AuthState'][_0x4ed265(0x1ad)])return this['logger'][_0x4ed265(0x18a)](_0x4ed265(0x196)),await(0x0,utils_1[_0x4ed265(0x190)])(this[_0x4ed265(0x1ab)]),this[_0x4ed265(0x1a7)]();}[a227_0x2a4edf(0x186)](){const _0x1e886d=a227_0x2a4edf;return{'orgId':this[_0x1e886d(0x1b6)],'accessToken':this[_0x1e886d(0x1af)],'instanceUrl':this['instanceUrl']};}async['requestConfig'](){const _0x223890=a227_0x2a4edf;return await this[_0x223890(0x1a7)](),{'baseURL':this[_0x223890(0x18b)],'headers':{'accept':_0x223890(0x1a1),'authorization':this[_0x223890(0x191)]+'\x20'+this[_0x223890(0x1af)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a227_0x2a4edf(0x178)])(),__metadata(a227_0x2a4edf(0x171),[])],SalesforceAuthService),exports[a227_0x2a4edf(0x168)]=SalesforceAuthService;