function a226_0x21c5(){const _0x5c900c=['342AoHDQB','6575814bhOWgo','Updating','constructor','SalesforceAuthService','../../providers/providers.tokens','Idle','/services/oauth2/token','requestConfig','access_token','length','__importStar','logger','Tokens','axios','6PJMGMj','update\x20access\x20token\x20failed:\x20%s','70aXlDJv','__esModule','__metadata','Service','force\x20update\x20token','error','getAuthData','Logger','call','4566054IzejcD','joinURL','then','../../../shared/utils','apply','1249030hFDXjL','Error','AUTH_WAIT_TIME','instance_url','authState','../../../../core','tokenType','name','data','__setModuleDefault','__importDefault','refresh_token','AuthState','UnauthorizedSalesforceError','function','getOwnPropertyDescriptor','configurable','create','check\x20auth:\x20current\x20state\x20-\x20%s','prototype','updateAccessToken','object','message','catch','../enums/auth-state.enum','log','5714790weNCKS','Active','typedi','search','get','forceUpdateToken','hasOwnProperty','accessToken','19211vkRnYP','token_type','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','design:paramtypes','instanceUrl','toString','orgId','5412712SINBxy','defineProperty','(((.+)+)+)+$','InvalidRefreshTokenError','setAuthDetails','waitAuth','ERR_INVALID_SALESFORCE_TOKEN','default','4455344jPkfmQ','response','../../../../constants/errors','access\x20token\x20updated\x20for\x20%s'];a226_0x21c5=function(){return _0x5c900c;};return a226_0x21c5();}const a226_0x4320e5=a226_0x425d;(function(_0x453ba5,_0x4a9c1b){const _0x5a9c1b=a226_0x425d,_0x1b6219=_0x453ba5();while(!![]){try{const _0x3de9b2=-parseInt(_0x5a9c1b(0xf4))/0x1*(parseInt(_0x5a9c1b(0x118))/0x2)+-parseInt(_0x5a9c1b(0x121))/0x3+parseInt(_0x5a9c1b(0x103))/0x4+-parseInt(_0x5a9c1b(0xec))/0x5+parseInt(_0x5a9c1b(0x116))/0x6*(-parseInt(_0x5a9c1b(0x108))/0x7)+-parseInt(_0x5a9c1b(0xfb))/0x8+parseInt(_0x5a9c1b(0x107))/0x9*(parseInt(_0x5a9c1b(0x126))/0xa);if(_0x3de9b2===_0x4a9c1b)break;else _0x1b6219['push'](_0x1b6219['shift']());}catch(_0x28768e){_0x1b6219['push'](_0x1b6219['shift']());}}}(a226_0x21c5,0xdd62e));const a226_0x5ddb94=(function(){let _0x4c15e0=!![];return function(_0xd82ead,_0x13ece6){const _0x3eda82=_0x4c15e0?function(){const _0x2ff1ac=a226_0x425d;if(_0x13ece6){const _0x31b082=_0x13ece6[_0x2ff1ac(0x125)](_0xd82ead,arguments);return _0x13ece6=null,_0x31b082;}}:function(){};return _0x4c15e0=![],_0x3eda82;};}()),a226_0xecfd53=a226_0x5ddb94(this,function(){const _0x342486=a226_0x425d;return a226_0xecfd53[_0x342486(0xf9)]()[_0x342486(0xef)](_0x342486(0xfd))['toString']()[_0x342486(0x10a)](a226_0xecfd53)[_0x342486(0xef)](_0x342486(0xfd));});a226_0xecfd53();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a226_0x4320e5(0xe3)]?function(_0x4effb3,_0x35d1ef,_0x1c98ea,_0x3cc88e){const _0x4fae16=a226_0x4320e5;if(_0x3cc88e===undefined)_0x3cc88e=_0x1c98ea;var _0x456b56=Object['getOwnPropertyDescriptor'](_0x35d1ef,_0x1c98ea);(!_0x456b56||('get'in _0x456b56?!_0x35d1ef[_0x4fae16(0x119)]:_0x456b56['writable']||_0x456b56[_0x4fae16(0xe2)]))&&(_0x456b56={'enumerable':!![],'get':function(){return _0x35d1ef[_0x1c98ea];}}),Object[_0x4fae16(0xfc)](_0x4effb3,_0x3cc88e,_0x456b56);}:function(_0x43e1d2,_0x1129df,_0x1dbaa0,_0x25acfb){if(_0x25acfb===undefined)_0x25acfb=_0x1dbaa0;_0x43e1d2[_0x25acfb]=_0x1129df[_0x1dbaa0];}),__setModuleDefault=this&&this[a226_0x4320e5(0xdb)]||(Object[a226_0x4320e5(0xe3)]?function(_0x465c52,_0x4cd4db){const _0x17b30c=a226_0x4320e5;Object[_0x17b30c(0xfc)](_0x465c52,'default',{'enumerable':!![],'value':_0x4cd4db});}:function(_0x5f3078,_0x281eab){const _0xa9370=a226_0x4320e5;_0x5f3078[_0xa9370(0x102)]=_0x281eab;}),__decorate=this&&this['__decorate']||function(_0x1e4837,_0x4fce17,_0x499d17,_0x583dea){const _0x54fdd0=a226_0x4320e5;var _0x41a64f=arguments[_0x54fdd0(0x111)],_0x38729d=_0x41a64f<0x3?_0x4fce17:_0x583dea===null?_0x583dea=Object[_0x54fdd0(0xe1)](_0x4fce17,_0x499d17):_0x583dea,_0x1419cf;if(typeof Reflect===_0x54fdd0(0xe7)&&typeof Reflect['decorate']===_0x54fdd0(0xe0))_0x38729d=Reflect['decorate'](_0x1e4837,_0x4fce17,_0x499d17,_0x583dea);else{for(var _0x5effee=_0x1e4837['length']-0x1;_0x5effee>=0x0;_0x5effee--)if(_0x1419cf=_0x1e4837[_0x5effee])_0x38729d=(_0x41a64f<0x3?_0x1419cf(_0x38729d):_0x41a64f>0x3?_0x1419cf(_0x4fce17,_0x499d17,_0x38729d):_0x1419cf(_0x4fce17,_0x499d17))||_0x38729d;}return _0x41a64f>0x3&&_0x38729d&&Object[_0x54fdd0(0xfc)](_0x4fce17,_0x499d17,_0x38729d),_0x38729d;},__importStar=this&&this[a226_0x4320e5(0x112)]||function(_0x4d835e){const _0x3adaac=a226_0x4320e5;if(_0x4d835e&&_0x4d835e[_0x3adaac(0x119)])return _0x4d835e;var _0x491e1d={};if(_0x4d835e!=null){for(var _0x7607b0 in _0x4d835e)if(_0x7607b0!==_0x3adaac(0x102)&&Object[_0x3adaac(0xe5)][_0x3adaac(0xf2)][_0x3adaac(0x120)](_0x4d835e,_0x7607b0))__createBinding(_0x491e1d,_0x4d835e,_0x7607b0);}return __setModuleDefault(_0x491e1d,_0x4d835e),_0x491e1d;},__metadata=this&&this[a226_0x4320e5(0x11a)]||function(_0x3ca5e3,_0x176cf1){const _0x4ee10e=a226_0x4320e5;if(typeof Reflect===_0x4ee10e(0xe7)&&typeof Reflect['metadata']===_0x4ee10e(0xe0))return Reflect['metadata'](_0x3ca5e3,_0x176cf1);},__importDefault=this&&this[a226_0x4320e5(0xdc)]||function(_0x4b79cf){const _0x24c794=a226_0x4320e5;return _0x4b79cf&&_0x4b79cf[_0x24c794(0x119)]?_0x4b79cf:{'default':_0x4b79cf};},SalesforceAuthService_1;Object[a226_0x4320e5(0xfc)](exports,a226_0x4320e5(0x119),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a226_0x4320e5(0xee))),errors_1=require(a226_0x4320e5(0x105)),core_1=require(a226_0x4320e5(0xd7)),axios_1=__importDefault(require(a226_0x4320e5(0x115))),utils_1=require(a226_0x4320e5(0x124)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a226_0x4320e5(0xea)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require('../../../../constants'),providers_tokens_1=require(a226_0x4320e5(0x10c));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x21d4af=a226_0x4320e5;this[_0x21d4af(0x128)]=0x1388,this[_0x21d4af(0xd6)]=auth_state_enum_1[_0x21d4af(0xde)][_0x21d4af(0x10d)],this[_0x21d4af(0x113)]=new core_1[(_0x21d4af(0x11f))](SalesforceAuthService_1[_0x21d4af(0xd9)]),this[_0x21d4af(0xff)]();}async[a226_0x4320e5(0xff)](){const _0x4d5c08=a226_0x4320e5;this[_0x4d5c08(0x113)]['log'](_0x4d5c08(0xe4),auth_state_enum_1[_0x4d5c08(0xde)][this['authState']]);try{if(this[_0x4d5c08(0xd6)]===auth_state_enum_1[_0x4d5c08(0xde)][_0x4d5c08(0x127)])return;if(this[_0x4d5c08(0xd6)]===auth_state_enum_1[_0x4d5c08(0xde)][_0x4d5c08(0x10d)])await this['updateAccessToken']();else{const _0x39a510=await this[_0x4d5c08(0x10f)](),_0x15bc72=await axios_1[_0x4d5c08(0x102)][_0x4d5c08(0xf0)]('services/data/'+constants_1['SALESFORCE_API_VERSION'],_0x39a510)[_0x4d5c08(0x123)](()=>!![])[_0x4d5c08(0xe9)](()=>![]);!_0x15bc72&&await this[_0x4d5c08(0xe6)]();}}catch(_0x3838db){}}async['updateAccessToken'](){const _0x32c87e=a226_0x4320e5;var _0x277439,_0x57f583,_0x1d9426;this[_0x32c87e(0x113)][_0x32c87e(0xeb)]('update\x20access\x20token');try{this['authState']=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x448eb2,clientId:_0x39ba0e,clientSecret:_0x427e59,loginUrl:_0x3d30ac}=typedi_1[_0x32c87e(0x102)][_0x32c87e(0xf0)](providers_tokens_1[_0x32c87e(0x114)]['salesforce']),{data:_0x38c86d}=await axios_1[_0x32c87e(0x102)]['post']((0x0,utils_1[_0x32c87e(0x122)])(_0x3d30ac,_0x32c87e(0x10e)),null,{'params':{'grant_type':_0x32c87e(0xdd),'refresh_token':_0x448eb2,'client_id':_0x39ba0e,'client_secret':_0x427e59}});this[_0x32c87e(0xf8)]=_0x38c86d[_0x32c87e(0x129)],this[_0x32c87e(0xf3)]=_0x38c86d[_0x32c87e(0x110)],this[_0x32c87e(0xd8)]=_0x38c86d[_0x32c87e(0xf5)],this['authState']=auth_state_enum_1[_0x32c87e(0xde)][_0x32c87e(0xed)],this['logger'][_0x32c87e(0xeb)](_0x32c87e(0x106),this[_0x32c87e(0xf8)]);}catch(_0x546ac2){const _0x5204b9=((_0x57f583=(_0x277439=_0x546ac2===null||_0x546ac2===void 0x0?void 0x0:_0x546ac2[_0x32c87e(0x104)])===null||_0x277439===void 0x0?void 0x0:_0x277439[_0x32c87e(0xda)])===null||_0x57f583===void 0x0?void 0x0:_0x57f583[_0x32c87e(0x11d)])||((_0x1d9426=_0x546ac2===null||_0x546ac2===void 0x0?void 0x0:_0x546ac2['response'])===null||_0x1d9426===void 0x0?void 0x0:_0x1d9426[_0x32c87e(0xda)])||_0x546ac2[_0x32c87e(0xe8)];this['logger']['error'](_0x32c87e(0x117),_0x5204b9),this['authState']=auth_state_enum_1['AuthState'][_0x32c87e(0x127)];throw new invalid_refresh_token_error_1[(_0x32c87e(0xfe))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a226_0x4320e5(0xf1)](){const _0x52cafe=a226_0x4320e5;this[_0x52cafe(0x113)][_0x52cafe(0xeb)](_0x52cafe(0x11c));if(this['authState']===auth_state_enum_1['AuthState'][_0x52cafe(0x109)]||this['authState']===auth_state_enum_1[_0x52cafe(0xde)][_0x52cafe(0x10d)])return await(0x0,utils_1['sleep'])(this[_0x52cafe(0x128)]),this[_0x52cafe(0xf1)]();if(this[_0x52cafe(0xd6)]===auth_state_enum_1['AuthState'][_0x52cafe(0x127)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x52cafe(0x101)]);await this[_0x52cafe(0xe6)]();}async[a226_0x4320e5(0x100)](){const _0x22c7b0=a226_0x4320e5;if(this[_0x22c7b0(0xd6)]===auth_state_enum_1[_0x22c7b0(0xde)]['Error']){this[_0x22c7b0(0x113)]['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x22c7b0(0xdf))]();}if(this[_0x22c7b0(0xd6)]!==auth_state_enum_1[_0x22c7b0(0xde)]['Active'])return this[_0x22c7b0(0x113)]['log'](_0x22c7b0(0xf6)),await(0x0,utils_1['sleep'])(this[_0x22c7b0(0x128)]),this[_0x22c7b0(0x100)]();}[a226_0x4320e5(0x11e)](){const _0xdd8083=a226_0x4320e5;return{'orgId':this[_0xdd8083(0xfa)],'accessToken':this[_0xdd8083(0xf3)],'instanceUrl':this['instanceUrl']};}async[a226_0x4320e5(0x10f)](){const _0xd86626=a226_0x4320e5;return await this[_0xd86626(0x100)](),{'baseURL':this[_0xd86626(0xf8)],'headers':{'accept':'application/json','authorization':this['tokenType']+'\x20'+this[_0xd86626(0xf3)]}};}};function a226_0x425d(_0x23b670,_0x435616){const _0x9a7ed1=a226_0x21c5();return a226_0x425d=function(_0xecfd53,_0x5ddb94){_0xecfd53=_0xecfd53-0xd6;let _0x21c587=_0x9a7ed1[_0xecfd53];return _0x21c587;},a226_0x425d(_0x23b670,_0x435616);}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a226_0x4320e5(0x11b)])(),__metadata(a226_0x4320e5(0xf7),[])],SalesforceAuthService),exports[a226_0x4320e5(0x10b)]=SalesforceAuthService;