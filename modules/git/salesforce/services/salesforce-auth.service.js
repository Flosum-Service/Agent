const a227_0x28fb0b=a227_0x4e83;(function(_0x482bc9,_0x114ebe){const _0xbb86b8=a227_0x4e83,_0x43ce3a=_0x482bc9();while(!![]){try{const _0x9b2bb3=-parseInt(_0xbb86b8(0x1ab))/0x1*(parseInt(_0xbb86b8(0x1b9))/0x2)+parseInt(_0xbb86b8(0x1b1))/0x3+-parseInt(_0xbb86b8(0x1b0))/0x4*(parseInt(_0xbb86b8(0x19d))/0x5)+-parseInt(_0xbb86b8(0x1b3))/0x6+parseInt(_0xbb86b8(0x1d8))/0x7*(-parseInt(_0xbb86b8(0x198))/0x8)+parseInt(_0xbb86b8(0x1a5))/0x9*(parseInt(_0xbb86b8(0x1de))/0xa)+parseInt(_0xbb86b8(0x1d4))/0xb;if(_0x9b2bb3===_0x114ebe)break;else _0x43ce3a['push'](_0x43ce3a['shift']());}catch(_0x4aa4ed){_0x43ce3a['push'](_0x43ce3a['shift']());}}}(a227_0x3adf,0xc99e4));const a227_0x5596ba=(function(){let _0x4eca21=!![];return function(_0x46390f,_0x649404){const _0x4b915a=_0x4eca21?function(){if(_0x649404){const _0x5af307=_0x649404['apply'](_0x46390f,arguments);return _0x649404=null,_0x5af307;}}:function(){};return _0x4eca21=![],_0x4b915a;};}()),a227_0x5f5179=a227_0x5596ba(this,function(){const _0x104ccc=a227_0x4e83;return a227_0x5f5179[_0x104ccc(0x1e7)]()[_0x104ccc(0x1be)](_0x104ccc(0x1b6))['toString']()[_0x104ccc(0x1b8)](a227_0x5f5179)[_0x104ccc(0x1be)]('(((.+)+)+)+$');});a227_0x5f5179();function a227_0x4e83(_0x3e717f,_0x31a355){const _0x507def=a227_0x3adf();return a227_0x4e83=function(_0x5f5179,_0x5596ba){_0x5f5179=_0x5f5179-0x191;let _0x3adfc1=_0x507def[_0x5f5179];return _0x3adfc1;},a227_0x4e83(_0x3e717f,_0x31a355);}function a227_0x3adf(){const _0x48ddbb=['../../../../constants/errors','message','logger','11053427PjWFdc','writable','Updating','waitAuth','880446fQhyLQ','prototype','updateAccessToken','get','Active','axios','10hGVTfB','SALESFORCE_API_VERSION','force\x20update\x20token','application/json','create','defineProperty','then','design:paramtypes','forceUpdateToken','toString','name','getAuthData','log','object','sleep','__importStar','../../../../constants','AUTH_WAIT_TIME','catch','8gfgXAs','Error','Idle','post','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','615VxnkPV','function','metadata','orgId','update\x20access\x20token','joinURL','setAuthDetails','getOwnPropertyDescriptor','13139505WOtSkb','AuthState','accessToken','default','response','SalesforceAuthService','2TtzIsS','typedi','call','__setModuleDefault','UnauthorizedSalesforceError','41388UVwjmb','3347286zJvEfP','../../../shared/utils','913518iofXIJ','token_type','Tokens','(((.+)+)+)+$','update\x20access\x20token\x20failed:\x20%s','constructor','1204024fdrgsX','/services/oauth2/token','__esModule','length','decorate','search','hasOwnProperty','instance_url','requestConfig','access\x20token\x20updated\x20for\x20%s','authState','__importDefault','services/data/','tokenType','../enums/auth-state.enum','error','data','../../../../core','instanceUrl','ERR_INVALID_SALESFORCE_TOKEN','../../providers/providers.tokens','../errors/invalid-refresh-token.error','salesforce','configurable'];a227_0x3adf=function(){return _0x48ddbb;};return a227_0x3adf();}'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x1c4036,_0x1e09b7,_0x26f016,_0x448cef){const _0x44a57e=a227_0x4e83;if(_0x448cef===undefined)_0x448cef=_0x26f016;var _0x5846d5=Object[_0x44a57e(0x1a4)](_0x1e09b7,_0x26f016);(!_0x5846d5||(_0x44a57e(0x1db)in _0x5846d5?!_0x1e09b7[_0x44a57e(0x1bb)]:_0x5846d5[_0x44a57e(0x1d5)]||_0x5846d5[_0x44a57e(0x1d0)]))&&(_0x5846d5={'enumerable':!![],'get':function(){return _0x1e09b7[_0x26f016];}}),Object[_0x44a57e(0x1e3)](_0x1c4036,_0x448cef,_0x5846d5);}:function(_0x2c4924,_0x132767,_0x541b9c,_0x3c590e){if(_0x3c590e===undefined)_0x3c590e=_0x541b9c;_0x2c4924[_0x3c590e]=_0x132767[_0x541b9c];}),__setModuleDefault=this&&this[a227_0x28fb0b(0x1ae)]||(Object[a227_0x28fb0b(0x1e2)]?function(_0x484ad8,_0x33b000){Object['defineProperty'](_0x484ad8,'default',{'enumerable':!![],'value':_0x33b000});}:function(_0x41c187,_0x48d3d9){const _0x5acf11=a227_0x28fb0b;_0x41c187[_0x5acf11(0x1a8)]=_0x48d3d9;}),__decorate=this&&this['__decorate']||function(_0x563573,_0x1a7758,_0x2f9f77,_0x1c719e){const _0xe87961=a227_0x28fb0b;var _0x163cc3=arguments[_0xe87961(0x1bc)],_0x18d9be=_0x163cc3<0x3?_0x1a7758:_0x1c719e===null?_0x1c719e=Object[_0xe87961(0x1a4)](_0x1a7758,_0x2f9f77):_0x1c719e,_0x5ec89e;if(typeof Reflect===_0xe87961(0x192)&&typeof Reflect[_0xe87961(0x1bd)]===_0xe87961(0x19e))_0x18d9be=Reflect[_0xe87961(0x1bd)](_0x563573,_0x1a7758,_0x2f9f77,_0x1c719e);else{for(var _0x381b26=_0x563573[_0xe87961(0x1bc)]-0x1;_0x381b26>=0x0;_0x381b26--)if(_0x5ec89e=_0x563573[_0x381b26])_0x18d9be=(_0x163cc3<0x3?_0x5ec89e(_0x18d9be):_0x163cc3>0x3?_0x5ec89e(_0x1a7758,_0x2f9f77,_0x18d9be):_0x5ec89e(_0x1a7758,_0x2f9f77))||_0x18d9be;}return _0x163cc3>0x3&&_0x18d9be&&Object[_0xe87961(0x1e3)](_0x1a7758,_0x2f9f77,_0x18d9be),_0x18d9be;},__importStar=this&&this[a227_0x28fb0b(0x194)]||function(_0x48d7ea){const _0x1dd15d=a227_0x28fb0b;if(_0x48d7ea&&_0x48d7ea[_0x1dd15d(0x1bb)])return _0x48d7ea;var _0x1d188d={};if(_0x48d7ea!=null){for(var _0x566f73 in _0x48d7ea)if(_0x566f73!==_0x1dd15d(0x1a8)&&Object[_0x1dd15d(0x1d9)][_0x1dd15d(0x1bf)][_0x1dd15d(0x1ad)](_0x48d7ea,_0x566f73))__createBinding(_0x1d188d,_0x48d7ea,_0x566f73);}return __setModuleDefault(_0x1d188d,_0x48d7ea),_0x1d188d;},__metadata=this&&this['__metadata']||function(_0x384958,_0x35e01e){const _0x8c7407=a227_0x28fb0b;if(typeof Reflect==='object'&&typeof Reflect[_0x8c7407(0x19f)]===_0x8c7407(0x19e))return Reflect['metadata'](_0x384958,_0x35e01e);},__importDefault=this&&this[a227_0x28fb0b(0x1c4)]||function(_0x1b2632){const _0x3bf0eb=a227_0x28fb0b;return _0x1b2632&&_0x1b2632[_0x3bf0eb(0x1bb)]?_0x1b2632:{'default':_0x1b2632};},SalesforceAuthService_1;Object[a227_0x28fb0b(0x1e3)](exports,a227_0x28fb0b(0x1bb),{'value':!![]}),exports[a227_0x28fb0b(0x1aa)]=void 0x0;const typedi_1=__importStar(require(a227_0x28fb0b(0x1ac))),errors_1=require(a227_0x28fb0b(0x1d1)),core_1=require(a227_0x28fb0b(0x1ca)),axios_1=__importDefault(require(a227_0x28fb0b(0x1dd))),utils_1=require(a227_0x28fb0b(0x1b2)),invalid_refresh_token_error_1=require(a227_0x28fb0b(0x1ce)),auth_state_enum_1=require(a227_0x28fb0b(0x1c7)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a227_0x28fb0b(0x195)),providers_tokens_1=require(a227_0x28fb0b(0x1cd));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x123436=a227_0x28fb0b;this[_0x123436(0x196)]=0x1388,this[_0x123436(0x1c3)]=auth_state_enum_1[_0x123436(0x1a6)]['Idle'],this['logger']=new core_1['Logger'](SalesforceAuthService_1[_0x123436(0x1e8)]),this[_0x123436(0x1a3)]();}async[a227_0x28fb0b(0x1a3)](){const _0x327f67=a227_0x28fb0b;this[_0x327f67(0x1d3)]['log']('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x327f67(0x1a6)][this[_0x327f67(0x1c3)]]);try{if(this['authState']===auth_state_enum_1[_0x327f67(0x1a6)][_0x327f67(0x199)])return;if(this[_0x327f67(0x1c3)]===auth_state_enum_1['AuthState'][_0x327f67(0x19a)])await this[_0x327f67(0x1da)]();else{const _0x3e95d8=await this['requestConfig'](),_0x11eea9=await axios_1[_0x327f67(0x1a8)][_0x327f67(0x1db)](_0x327f67(0x1c5)+constants_1[_0x327f67(0x1df)],_0x3e95d8)[_0x327f67(0x1e4)](()=>!![])[_0x327f67(0x197)](()=>![]);!_0x11eea9&&await this[_0x327f67(0x1da)]();}}catch(_0x257cdf){}}async['updateAccessToken'](){const _0x1e5ba9=a227_0x28fb0b;var _0x4fccaa,_0x2425dd,_0x12f3b2;this['logger'][_0x1e5ba9(0x191)](_0x1e5ba9(0x1a1));try{this[_0x1e5ba9(0x1c3)]=auth_state_enum_1[_0x1e5ba9(0x1a6)][_0x1e5ba9(0x1d6)];const {refreshToken:_0xd66729,clientId:_0x3103c3,clientSecret:_0x37b9c2,loginUrl:_0x55e081}=typedi_1[_0x1e5ba9(0x1a8)][_0x1e5ba9(0x1db)](providers_tokens_1[_0x1e5ba9(0x1b5)][_0x1e5ba9(0x1cf)]),{data:_0x1e5ff8}=await axios_1[_0x1e5ba9(0x1a8)][_0x1e5ba9(0x19b)]((0x0,utils_1[_0x1e5ba9(0x1a2)])(_0x55e081,_0x1e5ba9(0x1ba)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0xd66729,'client_id':_0x3103c3,'client_secret':_0x37b9c2}});this[_0x1e5ba9(0x1cb)]=_0x1e5ff8[_0x1e5ba9(0x1c0)],this[_0x1e5ba9(0x1a7)]=_0x1e5ff8['access_token'],this[_0x1e5ba9(0x1c6)]=_0x1e5ff8[_0x1e5ba9(0x1b4)],this['authState']=auth_state_enum_1[_0x1e5ba9(0x1a6)][_0x1e5ba9(0x1dc)],this['logger']['log'](_0x1e5ba9(0x1c2),this[_0x1e5ba9(0x1cb)]);}catch(_0x555caa){const _0x596a41=((_0x2425dd=(_0x4fccaa=_0x555caa===null||_0x555caa===void 0x0?void 0x0:_0x555caa[_0x1e5ba9(0x1a9)])===null||_0x4fccaa===void 0x0?void 0x0:_0x4fccaa[_0x1e5ba9(0x1c9)])===null||_0x2425dd===void 0x0?void 0x0:_0x2425dd['error'])||((_0x12f3b2=_0x555caa===null||_0x555caa===void 0x0?void 0x0:_0x555caa[_0x1e5ba9(0x1a9)])===null||_0x12f3b2===void 0x0?void 0x0:_0x12f3b2[_0x1e5ba9(0x1c9)])||_0x555caa[_0x1e5ba9(0x1d2)];this['logger'][_0x1e5ba9(0x1c8)](_0x1e5ba9(0x1b7),_0x596a41),this[_0x1e5ba9(0x1c3)]=auth_state_enum_1['AuthState']['Error'];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x1e5ba9(0x1cc)]);}}async[a227_0x28fb0b(0x1e6)](){const _0x20d3a=a227_0x28fb0b;this[_0x20d3a(0x1d3)][_0x20d3a(0x191)](_0x20d3a(0x1e0));if(this[_0x20d3a(0x1c3)]===auth_state_enum_1[_0x20d3a(0x1a6)][_0x20d3a(0x1d6)]||this[_0x20d3a(0x1c3)]===auth_state_enum_1['AuthState'][_0x20d3a(0x19a)])return await(0x0,utils_1[_0x20d3a(0x193)])(this[_0x20d3a(0x196)]),this['forceUpdateToken']();if(this[_0x20d3a(0x1c3)]===auth_state_enum_1[_0x20d3a(0x1a6)][_0x20d3a(0x199)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x20d3a(0x1cc)]);await this[_0x20d3a(0x1da)]();}async[a227_0x28fb0b(0x1d7)](){const _0x38cfcd=a227_0x28fb0b;if(this[_0x38cfcd(0x1c3)]===auth_state_enum_1[_0x38cfcd(0x1a6)][_0x38cfcd(0x199)]){this['logger'][_0x38cfcd(0x191)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x38cfcd(0x1af))]();}if(this[_0x38cfcd(0x1c3)]!==auth_state_enum_1[_0x38cfcd(0x1a6)][_0x38cfcd(0x1dc)])return this[_0x38cfcd(0x1d3)][_0x38cfcd(0x191)](_0x38cfcd(0x19c)),await(0x0,utils_1[_0x38cfcd(0x193)])(this[_0x38cfcd(0x196)]),this['waitAuth']();}[a227_0x28fb0b(0x1e9)](){const _0x5a44e3=a227_0x28fb0b;return{'orgId':this[_0x5a44e3(0x1a0)],'accessToken':this[_0x5a44e3(0x1a7)],'instanceUrl':this[_0x5a44e3(0x1cb)]};}async[a227_0x28fb0b(0x1c1)](){const _0x4c0341=a227_0x28fb0b;return await this[_0x4c0341(0x1d7)](),{'baseURL':this[_0x4c0341(0x1cb)],'headers':{'accept':_0x4c0341(0x1e1),'authorization':this[_0x4c0341(0x1c6)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a227_0x28fb0b(0x1e5),[])],SalesforceAuthService),exports[a227_0x28fb0b(0x1aa)]=SalesforceAuthService;