const a232_0x491d4e=a232_0x307a;function a232_0x307a(_0x18a15e,_0x48df30){const _0x3fc6d4=a232_0x5c05();return a232_0x307a=function(_0x4dbcc7,_0x5183a5){_0x4dbcc7=_0x4dbcc7-0x1ee;let _0x5c05bb=_0x3fc6d4[_0x4dbcc7];return _0x5c05bb;},a232_0x307a(_0x18a15e,_0x48df30);}(function(_0x3d9e42,_0x4def1c){const _0x22f2a4=a232_0x307a,_0xe8a7ef=_0x3d9e42();while(!![]){try{const _0x133a5c=-parseInt(_0x22f2a4(0x1fc))/0x1+parseInt(_0x22f2a4(0x211))/0x2+-parseInt(_0x22f2a4(0x229))/0x3*(-parseInt(_0x22f2a4(0x217))/0x4)+parseInt(_0x22f2a4(0x228))/0x5*(-parseInt(_0x22f2a4(0x204))/0x6)+parseInt(_0x22f2a4(0x223))/0x7+-parseInt(_0x22f2a4(0x22d))/0x8+parseInt(_0x22f2a4(0x20d))/0x9;if(_0x133a5c===_0x4def1c)break;else _0xe8a7ef['push'](_0xe8a7ef['shift']());}catch(_0x57612b){_0xe8a7ef['push'](_0xe8a7ef['shift']());}}}(a232_0x5c05,0x3a68a));const a232_0x5183a5=(function(){let _0x29751e=!![];return function(_0x53732c,_0x1ba01f){const _0x2e42a0=_0x29751e?function(){const _0x8e8604=a232_0x307a;if(_0x1ba01f){const _0x12d3a2=_0x1ba01f[_0x8e8604(0x22c)](_0x53732c,arguments);return _0x1ba01f=null,_0x12d3a2;}}:function(){};return _0x29751e=![],_0x2e42a0;};}()),a232_0x4dbcc7=a232_0x5183a5(this,function(){const _0x545675=a232_0x307a;return a232_0x4dbcc7[_0x545675(0x1f6)]()[_0x545675(0x235)](_0x545675(0x238))[_0x545675(0x1f6)]()[_0x545675(0x210)](a232_0x4dbcc7)['search']('(((.+)+)+)+$');});function a232_0x5c05(){const _0x5060b0=['decorate','error','Error','InvalidRefreshTokenError','86001yXTDWj','configurable','sleep','response','Idle','SalesforceAuthService','AUTH_WAIT_TIME','Active','18zGTHtk','prototype','__metadata','updateAccessToken','setAuthDetails','log','catch','call','forceUpdateToken','1160370FEhmfX','requestConfig','Logger','constructor','234014pgGiqY','function','defineProperty','metadata','length','__decorate','752IPVPbB','getOwnPropertyDescriptor','__esModule','object','waitAuth','accessToken','update\x20access\x20token\x20failed:\x20%s','instanceUrl','instance_url','__createBinding','logger','../../../shared/utils','2540447SJsDKO','Updating','getAuthData','../errors/unauthorized-salesforce.error','create\x20authorized\x20request\x20failed:\x20authorization\x20error','467430vcPJVk','2352QBgWJd','writable','ERR_INVALID_SALESFORCE_TOKEN','apply','1204392ivnPdp','authState','__setModuleDefault','refresh_token','message','AuthState','hasOwnProperty','access\x20token\x20updated\x20for\x20%s','search','__importStar','__importDefault','(((.+)+)+)+$','default','create','salesforce','get','post','UnauthorizedSalesforceError','typedi','Tokens','update\x20access\x20token','toString','../../../../constants/errors'];a232_0x5c05=function(){return _0x5060b0;};return a232_0x5c05();}a232_0x4dbcc7();'use strict';var __createBinding=this&&this[a232_0x491d4e(0x220)]||(Object[a232_0x491d4e(0x1ee)]?function(_0x44bbc9,_0x1fbd15,_0x1484c2,_0x26fd57){const _0x1d0bcf=a232_0x491d4e;if(_0x26fd57===undefined)_0x26fd57=_0x1484c2;var _0x5a8554=Object[_0x1d0bcf(0x218)](_0x1fbd15,_0x1484c2);(!_0x5a8554||(_0x1d0bcf(0x1f0)in _0x5a8554?!_0x1fbd15[_0x1d0bcf(0x219)]:_0x5a8554[_0x1d0bcf(0x22a)]||_0x5a8554[_0x1d0bcf(0x1fd)]))&&(_0x5a8554={'enumerable':!![],'get':function(){return _0x1fbd15[_0x1484c2];}}),Object[_0x1d0bcf(0x213)](_0x44bbc9,_0x26fd57,_0x5a8554);}:function(_0x374740,_0xa0a478,_0x55413d,_0xae56ee){if(_0xae56ee===undefined)_0xae56ee=_0x55413d;_0x374740[_0xae56ee]=_0xa0a478[_0x55413d];}),__setModuleDefault=this&&this[a232_0x491d4e(0x22f)]||(Object[a232_0x491d4e(0x1ee)]?function(_0x18e1cb,_0x30f318){const _0x20f222=a232_0x491d4e;Object[_0x20f222(0x213)](_0x18e1cb,'default',{'enumerable':!![],'value':_0x30f318});}:function(_0x2b7517,_0x251697){const _0x1d7976=a232_0x491d4e;_0x2b7517[_0x1d7976(0x239)]=_0x251697;}),__decorate=this&&this[a232_0x491d4e(0x216)]||function(_0x2b9a8a,_0x241499,_0x20c80f,_0x22a8d1){const _0x162aa0=a232_0x491d4e;var _0x55e6a2=arguments[_0x162aa0(0x215)],_0x28e159=_0x55e6a2<0x3?_0x241499:_0x22a8d1===null?_0x22a8d1=Object['getOwnPropertyDescriptor'](_0x241499,_0x20c80f):_0x22a8d1,_0x43e6e6;if(typeof Reflect==='object'&&typeof Reflect[_0x162aa0(0x1f8)]===_0x162aa0(0x212))_0x28e159=Reflect[_0x162aa0(0x1f8)](_0x2b9a8a,_0x241499,_0x20c80f,_0x22a8d1);else{for(var _0x1d40e0=_0x2b9a8a[_0x162aa0(0x215)]-0x1;_0x1d40e0>=0x0;_0x1d40e0--)if(_0x43e6e6=_0x2b9a8a[_0x1d40e0])_0x28e159=(_0x55e6a2<0x3?_0x43e6e6(_0x28e159):_0x55e6a2>0x3?_0x43e6e6(_0x241499,_0x20c80f,_0x28e159):_0x43e6e6(_0x241499,_0x20c80f))||_0x28e159;}return _0x55e6a2>0x3&&_0x28e159&&Object['defineProperty'](_0x241499,_0x20c80f,_0x28e159),_0x28e159;},__importStar=this&&this[a232_0x491d4e(0x236)]||function(_0x5c9de7){const _0x3c5077=a232_0x491d4e;if(_0x5c9de7&&_0x5c9de7[_0x3c5077(0x219)])return _0x5c9de7;var _0x2a50ce={};if(_0x5c9de7!=null){for(var _0x58f8aa in _0x5c9de7)if(_0x58f8aa!==_0x3c5077(0x239)&&Object[_0x3c5077(0x205)][_0x3c5077(0x233)][_0x3c5077(0x20b)](_0x5c9de7,_0x58f8aa))__createBinding(_0x2a50ce,_0x5c9de7,_0x58f8aa);}return __setModuleDefault(_0x2a50ce,_0x5c9de7),_0x2a50ce;},__metadata=this&&this[a232_0x491d4e(0x206)]||function(_0x574036,_0x52f432){const _0x453c62=a232_0x491d4e;if(typeof Reflect===_0x453c62(0x21a)&&typeof Reflect[_0x453c62(0x214)]===_0x453c62(0x212))return Reflect['metadata'](_0x574036,_0x52f432);},__importDefault=this&&this[a232_0x491d4e(0x237)]||function(_0x58c300){const _0x13d346=a232_0x491d4e;return _0x58c300&&_0x58c300[_0x13d346(0x219)]?_0x58c300:{'default':_0x58c300};},SalesforceAuthService_1;Object['defineProperty'](exports,a232_0x491d4e(0x219),{'value':!![]}),exports[a232_0x491d4e(0x201)]=void 0x0;const typedi_1=__importStar(require(a232_0x491d4e(0x1f3))),errors_1=require(a232_0x491d4e(0x1f7)),core_1=require('../../../../core'),axios_1=__importDefault(require('axios')),utils_1=require(a232_0x491d4e(0x222)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a232_0x491d4e(0x226)),constants_1=require('../../../../constants'),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x10d38c=a232_0x491d4e;this[_0x10d38c(0x202)]=0x1388,this[_0x10d38c(0x22e)]=auth_state_enum_1[_0x10d38c(0x232)][_0x10d38c(0x200)],this['logger']=new core_1[(_0x10d38c(0x20f))](SalesforceAuthService_1['name']),this[_0x10d38c(0x208)]();}async['setAuthDetails'](){const _0x34f448=a232_0x491d4e;this[_0x34f448(0x221)][_0x34f448(0x209)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x34f448(0x232)][this[_0x34f448(0x22e)]]);try{if(this[_0x34f448(0x22e)]===auth_state_enum_1['AuthState'][_0x34f448(0x1fa)])return;if(this[_0x34f448(0x22e)]===auth_state_enum_1['AuthState'][_0x34f448(0x200)])await this[_0x34f448(0x207)]();else{const _0x325ca4=await this[_0x34f448(0x20e)](),_0x2547d7=await axios_1[_0x34f448(0x239)]['get']('services/data/'+constants_1['SALESFORCE_API_VERSION'],_0x325ca4)['then'](()=>!![])[_0x34f448(0x20a)](()=>![]);!_0x2547d7&&await this[_0x34f448(0x207)]();}}catch(_0x23655a){}}async['updateAccessToken'](){const _0x2f38db=a232_0x491d4e;var _0x521608,_0xb4e9fb,_0x48908e;this[_0x2f38db(0x221)][_0x2f38db(0x209)](_0x2f38db(0x1f5));try{this[_0x2f38db(0x22e)]=auth_state_enum_1[_0x2f38db(0x232)][_0x2f38db(0x224)];const {refreshToken:_0x3819d1,clientId:_0x366c68,clientSecret:_0x50ea0a,loginUrl:_0x1b3f3f}=typedi_1[_0x2f38db(0x239)][_0x2f38db(0x1f0)](providers_tokens_1[_0x2f38db(0x1f4)][_0x2f38db(0x1ef)]),{data:_0x49db0d}=await axios_1[_0x2f38db(0x239)][_0x2f38db(0x1f1)]((0x0,utils_1['joinURL'])(_0x1b3f3f,'/services/oauth2/token'),null,{'params':{'grant_type':_0x2f38db(0x230),'refresh_token':_0x3819d1,'client_id':_0x366c68,'client_secret':_0x50ea0a}});this[_0x2f38db(0x21e)]=_0x49db0d[_0x2f38db(0x21f)],this[_0x2f38db(0x21c)]=_0x49db0d['access_token'],this['tokenType']=_0x49db0d['token_type'],this['authState']=auth_state_enum_1[_0x2f38db(0x232)][_0x2f38db(0x203)],this[_0x2f38db(0x221)][_0x2f38db(0x209)](_0x2f38db(0x234),this['instanceUrl']);}catch(_0x53cde5){const _0xbeaf73=((_0xb4e9fb=(_0x521608=_0x53cde5===null||_0x53cde5===void 0x0?void 0x0:_0x53cde5[_0x2f38db(0x1ff)])===null||_0x521608===void 0x0?void 0x0:_0x521608['data'])===null||_0xb4e9fb===void 0x0?void 0x0:_0xb4e9fb[_0x2f38db(0x1f9)])||((_0x48908e=_0x53cde5===null||_0x53cde5===void 0x0?void 0x0:_0x53cde5[_0x2f38db(0x1ff)])===null||_0x48908e===void 0x0?void 0x0:_0x48908e['data'])||_0x53cde5[_0x2f38db(0x231)];this[_0x2f38db(0x221)][_0x2f38db(0x1f9)](_0x2f38db(0x21d),_0xbeaf73),this['authState']=auth_state_enum_1[_0x2f38db(0x232)][_0x2f38db(0x1fa)];throw new invalid_refresh_token_error_1[(_0x2f38db(0x1fb))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a232_0x491d4e(0x20c)](){const _0x15ddfa=a232_0x491d4e;this[_0x15ddfa(0x221)][_0x15ddfa(0x209)]('force\x20update\x20token');if(this[_0x15ddfa(0x22e)]===auth_state_enum_1[_0x15ddfa(0x232)][_0x15ddfa(0x224)]||this[_0x15ddfa(0x22e)]===auth_state_enum_1['AuthState'][_0x15ddfa(0x200)])return await(0x0,utils_1[_0x15ddfa(0x1fe)])(this[_0x15ddfa(0x202)]),this['forceUpdateToken']();if(this[_0x15ddfa(0x22e)]===auth_state_enum_1[_0x15ddfa(0x232)][_0x15ddfa(0x1fa)])throw new invalid_refresh_token_error_1[(_0x15ddfa(0x1fb))](errors_1[_0x15ddfa(0x22b)]);await this['updateAccessToken']();}async['waitAuth'](){const _0xd70172=a232_0x491d4e;if(this[_0xd70172(0x22e)]===auth_state_enum_1[_0xd70172(0x232)][_0xd70172(0x1fa)]){this['logger'][_0xd70172(0x209)](_0xd70172(0x227));throw new unauthorized_salesforce_error_1[(_0xd70172(0x1f2))]();}if(this[_0xd70172(0x22e)]!==auth_state_enum_1['AuthState']['Active'])return this[_0xd70172(0x221)]['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0xd70172(0x1fe)])(this['AUTH_WAIT_TIME']),this['waitAuth']();}[a232_0x491d4e(0x225)](){const _0x212d56=a232_0x491d4e;return{'orgId':this['orgId'],'accessToken':this['accessToken'],'instanceUrl':this[_0x212d56(0x21e)]};}async[a232_0x491d4e(0x20e)](){const _0x55debb=a232_0x491d4e;return await this[_0x55debb(0x21b)](),{'baseURL':this[_0x55debb(0x21e)],'headers':{'accept':'application/json','authorization':this['tokenType']+'\x20'+this[_0x55debb(0x21c)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports[a232_0x491d4e(0x201)]=SalesforceAuthService;