const a227_0x954cf6=a227_0x213c;(function(_0x43724a,_0x4a7e8b){const _0x5f0dfa=a227_0x213c,_0xa46782=_0x43724a();while(!![]){try{const _0x3a6f1b=-parseInt(_0x5f0dfa(0x12e))/0x1+-parseInt(_0x5f0dfa(0x128))/0x2+-parseInt(_0x5f0dfa(0x180))/0x3+-parseInt(_0x5f0dfa(0x16a))/0x4*(parseInt(_0x5f0dfa(0x17b))/0x5)+-parseInt(_0x5f0dfa(0x150))/0x6*(-parseInt(_0x5f0dfa(0x15f))/0x7)+parseInt(_0x5f0dfa(0x12d))/0x8*(-parseInt(_0x5f0dfa(0x144))/0x9)+parseInt(_0x5f0dfa(0x132))/0xa;if(_0x3a6f1b===_0x4a7e8b)break;else _0xa46782['push'](_0xa46782['shift']());}catch(_0x47d5a6){_0xa46782['push'](_0xa46782['shift']());}}}(a227_0x46df,0x6b697));const a227_0x17c272=(function(){let _0x4ac5e7=!![];return function(_0x551cd5,_0x5689b8){const _0x2dc93e=_0x4ac5e7?function(){const _0x4b8eed=a227_0x213c;if(_0x5689b8){const _0x1ce73d=_0x5689b8[_0x4b8eed(0x167)](_0x551cd5,arguments);return _0x5689b8=null,_0x1ce73d;}}:function(){};return _0x4ac5e7=![],_0x2dc93e;};}()),a227_0xc7844e=a227_0x17c272(this,function(){const _0xff525d=a227_0x213c;return a227_0xc7844e[_0xff525d(0x159)]()[_0xff525d(0x160)]('(((.+)+)+)+$')[_0xff525d(0x159)]()[_0xff525d(0x15b)](a227_0xc7844e)[_0xff525d(0x160)](_0xff525d(0x12a));});a227_0xc7844e();function a227_0x213c(_0x4bcb8b,_0x29723e){const _0x5a0f12=a227_0x46df();return a227_0x213c=function(_0xc7844e,_0x17c272){_0xc7844e=_0xc7844e-0x126;let _0x46dfc6=_0x5a0f12[_0xc7844e];return _0x46dfc6;},a227_0x213c(_0x4bcb8b,_0x29723e);}'use strict';var __createBinding=this&&this[a227_0x954cf6(0x173)]||(Object[a227_0x954cf6(0x134)]?function(_0x7fc46c,_0x5d6c89,_0x336dab,_0x3dc1de){const _0x84e9cb=a227_0x954cf6;if(_0x3dc1de===undefined)_0x3dc1de=_0x336dab;var _0x565f31=Object[_0x84e9cb(0x174)](_0x5d6c89,_0x336dab);(!_0x565f31||('get'in _0x565f31?!_0x5d6c89['__esModule']:_0x565f31['writable']||_0x565f31[_0x84e9cb(0x178)]))&&(_0x565f31={'enumerable':!![],'get':function(){return _0x5d6c89[_0x336dab];}}),Object[_0x84e9cb(0x14b)](_0x7fc46c,_0x3dc1de,_0x565f31);}:function(_0x40a320,_0x5e1fec,_0x398ec8,_0x2923bf){if(_0x2923bf===undefined)_0x2923bf=_0x398ec8;_0x40a320[_0x2923bf]=_0x5e1fec[_0x398ec8];}),__setModuleDefault=this&&this[a227_0x954cf6(0x13b)]||(Object['create']?function(_0x8f88aa,_0x3f626d){const _0x14045a=a227_0x954cf6;Object[_0x14045a(0x14b)](_0x8f88aa,_0x14045a(0x13c),{'enumerable':!![],'value':_0x3f626d});}:function(_0x123b5d,_0x450811){const _0x486a28=a227_0x954cf6;_0x123b5d[_0x486a28(0x13c)]=_0x450811;}),__decorate=this&&this[a227_0x954cf6(0x129)]||function(_0x57cb72,_0x29dbc2,_0x36f1fe,_0x23bff4){const _0x133ec8=a227_0x954cf6;var _0x263435=arguments[_0x133ec8(0x14e)],_0x5aa0d2=_0x263435<0x3?_0x29dbc2:_0x23bff4===null?_0x23bff4=Object['getOwnPropertyDescriptor'](_0x29dbc2,_0x36f1fe):_0x23bff4,_0x55107b;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x133ec8(0x127))_0x5aa0d2=Reflect[_0x133ec8(0x146)](_0x57cb72,_0x29dbc2,_0x36f1fe,_0x23bff4);else{for(var _0x5ba7ef=_0x57cb72['length']-0x1;_0x5ba7ef>=0x0;_0x5ba7ef--)if(_0x55107b=_0x57cb72[_0x5ba7ef])_0x5aa0d2=(_0x263435<0x3?_0x55107b(_0x5aa0d2):_0x263435>0x3?_0x55107b(_0x29dbc2,_0x36f1fe,_0x5aa0d2):_0x55107b(_0x29dbc2,_0x36f1fe))||_0x5aa0d2;}return _0x263435>0x3&&_0x5aa0d2&&Object[_0x133ec8(0x14b)](_0x29dbc2,_0x36f1fe,_0x5aa0d2),_0x5aa0d2;},__importStar=this&&this['__importStar']||function(_0x3ba6b6){const _0x3cdb1=a227_0x954cf6;if(_0x3ba6b6&&_0x3ba6b6[_0x3cdb1(0x169)])return _0x3ba6b6;var _0x3a328f={};if(_0x3ba6b6!=null){for(var _0x4a98cc in _0x3ba6b6)if(_0x4a98cc!==_0x3cdb1(0x13c)&&Object[_0x3cdb1(0x14c)][_0x3cdb1(0x151)][_0x3cdb1(0x16c)](_0x3ba6b6,_0x4a98cc))__createBinding(_0x3a328f,_0x3ba6b6,_0x4a98cc);}return __setModuleDefault(_0x3a328f,_0x3ba6b6),_0x3a328f;},__metadata=this&&this[a227_0x954cf6(0x165)]||function(_0x3a65c3,_0x868b0c){const _0x571603=a227_0x954cf6;if(typeof Reflect==='object'&&typeof Reflect[_0x571603(0x143)]===_0x571603(0x127))return Reflect[_0x571603(0x143)](_0x3a65c3,_0x868b0c);},__importDefault=this&&this[a227_0x954cf6(0x130)]||function(_0x351a70){const _0x3e788a=a227_0x954cf6;return _0x351a70&&_0x351a70[_0x3e788a(0x169)]?_0x351a70:{'default':_0x351a70};},SalesforceAuthService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a227_0x954cf6(0x17d)]=void 0x0;const typedi_1=__importStar(require(a227_0x954cf6(0x17c))),errors_1=require(a227_0x954cf6(0x16d)),core_1=require(a227_0x954cf6(0x156)),axios_1=__importDefault(require('axios')),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a227_0x954cf6(0x14d)),auth_state_enum_1=require(a227_0x954cf6(0x170)),unauthorized_salesforce_error_1=require(a227_0x954cf6(0x14a)),constants_1=require(a227_0x954cf6(0x142)),providers_tokens_1=require(a227_0x954cf6(0x133));function a227_0x46df(){const _0x3e79aa=['../../providers/providers.tokens','create','Logger','access\x20token\x20updated\x20for\x20%s','requestConfig','response','log','logger','__setModuleDefault','default','authState','update\x20access\x20token\x20failed:\x20%s','refresh_token','message','error','../../../../constants','metadata','27LyuFkX','joinURL','decorate','Idle','application/json','waitAuth','../errors/unauthorized-salesforce.error','defineProperty','prototype','../errors/invalid-refresh-token.error','length','Error','18rPeBcB','hasOwnProperty','forceUpdateToken','getAuthData','Service','sleep','../../../../core','create\x20authorized\x20request\x20failed:\x20authorization\x20error','SALESFORCE_API_VERSION','toString','/services/oauth2/token','constructor','AUTH_WAIT_TIME','post','services/data/','900655AozVoR','search','setAuthDetails','token_type','Active','update\x20access\x20token','__metadata','then','apply','data','__esModule','4YQacDb','updateAccessToken','call','../../../../constants/errors','design:paramtypes','tokenType','../enums/auth-state.enum','force\x20update\x20token','ERR_INVALID_SALESFORCE_TOKEN','__createBinding','getOwnPropertyDescriptor','accessToken','instance_url','orgId','configurable','Updating','instanceUrl','800620ydMopK','typedi','SalesforceAuthService','AuthState','Tokens','432156LAFafJ','get','function','876950kDbzDi','__decorate','(((.+)+)+)+$','catch','UnauthorizedSalesforceError','2030168alEWbS','82682YznxxY','InvalidRefreshTokenError','__importDefault','check\x20auth:\x20current\x20state\x20-\x20%s','16406100SZtoxo'];a227_0x46df=function(){return _0x3e79aa;};return a227_0x46df();}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x57d608=a227_0x954cf6;this[_0x57d608(0x15c)]=0x1388,this['authState']=auth_state_enum_1[_0x57d608(0x17e)][_0x57d608(0x147)],this['logger']=new core_1[(_0x57d608(0x135))](SalesforceAuthService_1['name']),this[_0x57d608(0x161)]();}async[a227_0x954cf6(0x161)](){const _0x3e65ec=a227_0x954cf6;this[_0x3e65ec(0x13a)][_0x3e65ec(0x139)](_0x3e65ec(0x131),auth_state_enum_1[_0x3e65ec(0x17e)][this[_0x3e65ec(0x13d)]]);try{if(this[_0x3e65ec(0x13d)]===auth_state_enum_1[_0x3e65ec(0x17e)][_0x3e65ec(0x14f)])return;if(this[_0x3e65ec(0x13d)]===auth_state_enum_1[_0x3e65ec(0x17e)][_0x3e65ec(0x147)])await this[_0x3e65ec(0x16b)]();else{const _0x2d6eac=await this['requestConfig'](),_0xec31c9=await axios_1[_0x3e65ec(0x13c)]['get'](_0x3e65ec(0x15e)+constants_1[_0x3e65ec(0x158)],_0x2d6eac)[_0x3e65ec(0x166)](()=>!![])[_0x3e65ec(0x12b)](()=>![]);!_0xec31c9&&await this[_0x3e65ec(0x16b)]();}}catch(_0x49b37a){}}async['updateAccessToken'](){const _0x10e3e8=a227_0x954cf6;var _0x3eb41f,_0x578cad,_0x3ccc02;this['logger'][_0x10e3e8(0x139)](_0x10e3e8(0x164));try{this['authState']=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x35317,clientId:_0x2f4cc8,clientSecret:_0x4540b3,loginUrl:_0x307a5c}=typedi_1[_0x10e3e8(0x13c)][_0x10e3e8(0x126)](providers_tokens_1[_0x10e3e8(0x17f)]['salesforce']),{data:_0x49e992}=await axios_1[_0x10e3e8(0x13c)][_0x10e3e8(0x15d)]((0x0,utils_1[_0x10e3e8(0x145)])(_0x307a5c,_0x10e3e8(0x15a)),null,{'params':{'grant_type':_0x10e3e8(0x13f),'refresh_token':_0x35317,'client_id':_0x2f4cc8,'client_secret':_0x4540b3}});this[_0x10e3e8(0x17a)]=_0x49e992[_0x10e3e8(0x176)],this['accessToken']=_0x49e992['access_token'],this[_0x10e3e8(0x16f)]=_0x49e992[_0x10e3e8(0x162)],this['authState']=auth_state_enum_1['AuthState'][_0x10e3e8(0x163)],this[_0x10e3e8(0x13a)]['log'](_0x10e3e8(0x136),this['instanceUrl']);}catch(_0x2674f6){const _0x4940a5=((_0x578cad=(_0x3eb41f=_0x2674f6===null||_0x2674f6===void 0x0?void 0x0:_0x2674f6[_0x10e3e8(0x138)])===null||_0x3eb41f===void 0x0?void 0x0:_0x3eb41f[_0x10e3e8(0x168)])===null||_0x578cad===void 0x0?void 0x0:_0x578cad[_0x10e3e8(0x141)])||((_0x3ccc02=_0x2674f6===null||_0x2674f6===void 0x0?void 0x0:_0x2674f6[_0x10e3e8(0x138)])===null||_0x3ccc02===void 0x0?void 0x0:_0x3ccc02['data'])||_0x2674f6[_0x10e3e8(0x140)];this[_0x10e3e8(0x13a)][_0x10e3e8(0x141)](_0x10e3e8(0x13e),_0x4940a5),this[_0x10e3e8(0x13d)]=auth_state_enum_1[_0x10e3e8(0x17e)][_0x10e3e8(0x14f)];throw new invalid_refresh_token_error_1[(_0x10e3e8(0x12f))](errors_1[_0x10e3e8(0x172)]);}}async[a227_0x954cf6(0x152)](){const _0x4410a7=a227_0x954cf6;this['logger']['log'](_0x4410a7(0x171));if(this['authState']===auth_state_enum_1[_0x4410a7(0x17e)][_0x4410a7(0x179)]||this[_0x4410a7(0x13d)]===auth_state_enum_1[_0x4410a7(0x17e)][_0x4410a7(0x147)])return await(0x0,utils_1[_0x4410a7(0x155)])(this[_0x4410a7(0x15c)]),this[_0x4410a7(0x152)]();if(this[_0x4410a7(0x13d)]===auth_state_enum_1[_0x4410a7(0x17e)][_0x4410a7(0x14f)])throw new invalid_refresh_token_error_1[(_0x4410a7(0x12f))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x4410a7(0x16b)]();}async[a227_0x954cf6(0x149)](){const _0x298f8c=a227_0x954cf6;if(this[_0x298f8c(0x13d)]===auth_state_enum_1['AuthState'][_0x298f8c(0x14f)]){this[_0x298f8c(0x13a)]['log'](_0x298f8c(0x157));throw new unauthorized_salesforce_error_1[(_0x298f8c(0x12c))]();}if(this[_0x298f8c(0x13d)]!==auth_state_enum_1[_0x298f8c(0x17e)][_0x298f8c(0x163)])return this[_0x298f8c(0x13a)][_0x298f8c(0x139)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x298f8c(0x155)])(this['AUTH_WAIT_TIME']),this[_0x298f8c(0x149)]();}[a227_0x954cf6(0x153)](){const _0x3ab906=a227_0x954cf6;return{'orgId':this[_0x3ab906(0x177)],'accessToken':this[_0x3ab906(0x175)],'instanceUrl':this['instanceUrl']};}async[a227_0x954cf6(0x137)](){const _0x4100b1=a227_0x954cf6;return await this[_0x4100b1(0x149)](),{'baseURL':this[_0x4100b1(0x17a)],'headers':{'accept':_0x4100b1(0x148),'authorization':this[_0x4100b1(0x16f)]+'\x20'+this[_0x4100b1(0x175)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a227_0x954cf6(0x154)])(),__metadata(a227_0x954cf6(0x16e),[])],SalesforceAuthService),exports[a227_0x954cf6(0x17d)]=SalesforceAuthService;