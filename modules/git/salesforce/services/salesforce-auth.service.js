const a271_0x338184=a271_0x53a6;(function(_0x4607b2,_0x319c6a){const _0x4a9217=a271_0x53a6,_0x84086b=_0x4607b2();while(!![]){try{const _0x568ebc=parseInt(_0x4a9217(0xff))/0x1*(-parseInt(_0x4a9217(0x117))/0x2)+parseInt(_0x4a9217(0x10a))/0x3+parseInt(_0x4a9217(0x11a))/0x4*(parseInt(_0x4a9217(0x126))/0x5)+parseInt(_0x4a9217(0x130))/0x6+parseInt(_0x4a9217(0x14f))/0x7*(-parseInt(_0x4a9217(0x114))/0x8)+-parseInt(_0x4a9217(0x125))/0x9+parseInt(_0x4a9217(0x11f))/0xa*(parseInt(_0x4a9217(0x100))/0xb);if(_0x568ebc===_0x319c6a)break;else _0x84086b['push'](_0x84086b['shift']());}catch(_0x47f312){_0x84086b['push'](_0x84086b['shift']());}}}(a271_0x31d8,0xc3d2e));const a271_0x510177=(function(){let _0xbc248c=!![];return function(_0x5c9369,_0x146cf3){const _0x502867=_0xbc248c?function(){const _0x1921f2=a271_0x53a6;if(_0x146cf3){const _0x5dca4a=_0x146cf3[_0x1921f2(0x119)](_0x5c9369,arguments);return _0x146cf3=null,_0x5dca4a;}}:function(){};return _0xbc248c=![],_0x502867;};}()),a271_0x3f936d=a271_0x510177(this,function(){const _0x595afe=a271_0x53a6;return a271_0x3f936d[_0x595afe(0xfc)]()[_0x595afe(0x131)](_0x595afe(0x135))[_0x595afe(0xfc)]()['constructor'](a271_0x3f936d)['search'](_0x595afe(0x135));});a271_0x3f936d();function a271_0x53a6(_0x42aeeb,_0x1643af){const _0x4341d3=a271_0x31d8();return a271_0x53a6=function(_0x3f936d,_0x510177){_0x3f936d=_0x3f936d-0xf3;let _0x31d88d=_0x4341d3[_0x3f936d];return _0x31d88d;},a271_0x53a6(_0x42aeeb,_0x1643af);}'use strict';var __createBinding=this&&this[a271_0x338184(0x148)]||(Object['create']?function(_0xf18d7b,_0x362283,_0x2967b3,_0xd90c68){const _0x51606e=a271_0x338184;if(_0xd90c68===undefined)_0xd90c68=_0x2967b3;var _0x3dc310=Object[_0x51606e(0x10b)](_0x362283,_0x2967b3);(!_0x3dc310||(_0x51606e(0x10e)in _0x3dc310?!_0x362283[_0x51606e(0xf9)]:_0x3dc310[_0x51606e(0x14e)]||_0x3dc310[_0x51606e(0x150)]))&&(_0x3dc310={'enumerable':!![],'get':function(){return _0x362283[_0x2967b3];}}),Object[_0x51606e(0x133)](_0xf18d7b,_0xd90c68,_0x3dc310);}:function(_0x45efd6,_0x51d261,_0x571897,_0x56b7c0){if(_0x56b7c0===undefined)_0x56b7c0=_0x571897;_0x45efd6[_0x56b7c0]=_0x51d261[_0x571897];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a271_0x338184(0x124)]?function(_0x26bbd4,_0xe825d4){const _0xb3d19b=a271_0x338184;Object[_0xb3d19b(0x133)](_0x26bbd4,_0xb3d19b(0x14b),{'enumerable':!![],'value':_0xe825d4});}:function(_0x404f44,_0x4423c7){const _0x94803e=a271_0x338184;_0x404f44[_0x94803e(0x14b)]=_0x4423c7;}),__decorate=this&&this[a271_0x338184(0x109)]||function(_0x28c4b1,_0x55da1e,_0x2a0cd3,_0x45288f){const _0x8806f4=a271_0x338184;var _0x10ef65=arguments[_0x8806f4(0x106)],_0x36e484=_0x10ef65<0x3?_0x55da1e:_0x45288f===null?_0x45288f=Object[_0x8806f4(0x10b)](_0x55da1e,_0x2a0cd3):_0x45288f,_0x152aec;if(typeof Reflect===_0x8806f4(0x116)&&typeof Reflect[_0x8806f4(0x134)]===_0x8806f4(0xfa))_0x36e484=Reflect['decorate'](_0x28c4b1,_0x55da1e,_0x2a0cd3,_0x45288f);else{for(var _0xa18f5d=_0x28c4b1['length']-0x1;_0xa18f5d>=0x0;_0xa18f5d--)if(_0x152aec=_0x28c4b1[_0xa18f5d])_0x36e484=(_0x10ef65<0x3?_0x152aec(_0x36e484):_0x10ef65>0x3?_0x152aec(_0x55da1e,_0x2a0cd3,_0x36e484):_0x152aec(_0x55da1e,_0x2a0cd3))||_0x36e484;}return _0x10ef65>0x3&&_0x36e484&&Object['defineProperty'](_0x55da1e,_0x2a0cd3,_0x36e484),_0x36e484;},__importStar=this&&this['__importStar']||function(_0x1b788d){const _0x3d970c=a271_0x338184;if(_0x1b788d&&_0x1b788d[_0x3d970c(0xf9)])return _0x1b788d;var _0x3a3e66={};if(_0x1b788d!=null){for(var _0x275eb5 in _0x1b788d)if(_0x275eb5!==_0x3d970c(0x14b)&&Object[_0x3d970c(0x112)][_0x3d970c(0x10f)][_0x3d970c(0x14a)](_0x1b788d,_0x275eb5))__createBinding(_0x3a3e66,_0x1b788d,_0x275eb5);}return __setModuleDefault(_0x3a3e66,_0x1b788d),_0x3a3e66;},__metadata=this&&this[a271_0x338184(0x14d)]||function(_0x966432,_0x2ebc91){const _0x2049e9=a271_0x338184;if(typeof Reflect===_0x2049e9(0x116)&&typeof Reflect[_0x2049e9(0x10c)]===_0x2049e9(0xfa))return Reflect[_0x2049e9(0x10c)](_0x966432,_0x2ebc91);},__importDefault=this&&this[a271_0x338184(0x122)]||function(_0x181707){const _0x18498f=a271_0x338184;return _0x181707&&_0x181707[_0x18498f(0xf9)]?_0x181707:{'default':_0x181707};},SalesforceAuthService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a271_0x338184(0xfd)]=void 0x0;const typedi_1=__importStar(require(a271_0x338184(0x12e))),errors_1=require('../../../../constants/errors'),core_1=require('../../../../core'),axios_1=__importDefault(require(a271_0x338184(0x104))),utils_1=require(a271_0x338184(0x11b)),invalid_refresh_token_error_1=require(a271_0x338184(0x110)),auth_state_enum_1=require(a271_0x338184(0xf8)),unauthorized_salesforce_error_1=require(a271_0x338184(0x102)),constants_1=require(a271_0x338184(0x11d)),providers_tokens_1=require(a271_0x338184(0x111)),salesforce_1=require(a271_0x338184(0x142));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x35a830=a271_0x338184;this[_0x35a830(0x141)]=0x1388,this['authState']=auth_state_enum_1[_0x35a830(0x120)]['Idle'],this[_0x35a830(0x149)]=new core_1[(_0x35a830(0x107))](SalesforceAuthService_1['name']),this[_0x35a830(0xf7)]();}async[a271_0x338184(0xf7)](){const _0x2aef8a=a271_0x338184;this[_0x2aef8a(0x149)][_0x2aef8a(0x103)](_0x2aef8a(0x101),auth_state_enum_1[_0x2aef8a(0x120)][this['authState']]);try{if(this[_0x2aef8a(0x12f)]===auth_state_enum_1[_0x2aef8a(0x120)][_0x2aef8a(0x118)])return;if(this[_0x2aef8a(0x12f)]===auth_state_enum_1[_0x2aef8a(0x120)][_0x2aef8a(0x128)])await this[_0x2aef8a(0x10d)]();else{const _0x32ebfe=await this[_0x2aef8a(0x121)](),_0x2d6004=await axios_1[_0x2aef8a(0x14b)][_0x2aef8a(0x10e)](_0x2aef8a(0x151)+constants_1[_0x2aef8a(0x14c)],_0x32ebfe)[_0x2aef8a(0xfb)](()=>!![])['catch'](()=>![]);!_0x2d6004&&await this['updateAccessToken']();}}catch(_0x1c3622){}}async[a271_0x338184(0x10d)](){const _0x4de17a=a271_0x338184;var _0x521e4e,_0x2bd9b4,_0x3b0d3f;this[_0x4de17a(0x149)][_0x4de17a(0x103)](_0x4de17a(0x113));try{this['authState']=auth_state_enum_1['AuthState'][_0x4de17a(0x146)];const {refreshToken:_0x186af0,clientId:_0x2844be,clientSecret:_0x106229,loginUrl:_0x483492}=typedi_1['default'][_0x4de17a(0x10e)](providers_tokens_1[_0x4de17a(0x13d)][_0x4de17a(0x152)]),{data:_0x947218}=await axios_1[_0x4de17a(0x14b)][_0x4de17a(0x13b)]((0x0,utils_1[_0x4de17a(0x12d)])(_0x483492,_0x4de17a(0x132)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x186af0,'client_id':_0x2844be,'client_secret':_0x106229}});this[_0x4de17a(0x144)]=_0x947218[_0x4de17a(0x12c)],this[_0x4de17a(0x140)]=_0x947218[_0x4de17a(0x143)],this['tokenType']=_0x947218['token_type'],this[_0x4de17a(0x12f)]=auth_state_enum_1['AuthState'][_0x4de17a(0x11c)],this[_0x4de17a(0x149)][_0x4de17a(0x103)](_0x4de17a(0x147),this[_0x4de17a(0x144)]);}catch(_0xac0c66){const _0x34bf0a=((_0x2bd9b4=(_0x521e4e=_0xac0c66===null||_0xac0c66===void 0x0?void 0x0:_0xac0c66[_0x4de17a(0x105)])===null||_0x521e4e===void 0x0?void 0x0:_0x521e4e[_0x4de17a(0x13f)])===null||_0x2bd9b4===void 0x0?void 0x0:_0x2bd9b4[_0x4de17a(0x145)])||((_0x3b0d3f=_0xac0c66===null||_0xac0c66===void 0x0?void 0x0:_0xac0c66[_0x4de17a(0x105)])===null||_0x3b0d3f===void 0x0?void 0x0:_0x3b0d3f[_0x4de17a(0x13f)])||_0xac0c66['message'];this[_0x4de17a(0x149)]['error'](_0x4de17a(0x115),_0x34bf0a),this[_0x4de17a(0x12f)]=auth_state_enum_1[_0x4de17a(0x120)][_0x4de17a(0x118)];throw new invalid_refresh_token_error_1[(_0x4de17a(0x11e))](errors_1[_0x4de17a(0xf6)]);}}async[a271_0x338184(0x138)](){const _0x481d00=a271_0x338184;this[_0x481d00(0x149)][_0x481d00(0x103)]('Force\x20update\x20token');if(this[_0x481d00(0x12f)]===auth_state_enum_1[_0x481d00(0x120)][_0x481d00(0x146)]||this[_0x481d00(0x12f)]===auth_state_enum_1['AuthState'][_0x481d00(0x128)])return await(0x0,utils_1[_0x481d00(0xf5)])(this[_0x481d00(0x141)]),this[_0x481d00(0x138)]();if(this['authState']===auth_state_enum_1[_0x481d00(0x120)]['Error'])throw new invalid_refresh_token_error_1[(_0x481d00(0x11e))](errors_1[_0x481d00(0xf6)]);await this['updateAccessToken']();}async[a271_0x338184(0x12b)](){const _0x2dc267=a271_0x338184;if(this[_0x2dc267(0x12f)]===auth_state_enum_1[_0x2dc267(0x120)][_0x2dc267(0x118)]){this['logger']['log'](_0x2dc267(0xf4));throw new unauthorized_salesforce_error_1[(_0x2dc267(0x123))]();}if(this[_0x2dc267(0x12f)]!==auth_state_enum_1[_0x2dc267(0x120)]['Active'])return this[_0x2dc267(0x149)][_0x2dc267(0x103)](_0x2dc267(0x136)),await(0x0,utils_1[_0x2dc267(0xf5)])(this[_0x2dc267(0x141)]),this[_0x2dc267(0x12b)]();}[a271_0x338184(0x12a)](){const _0x382cd4=a271_0x338184;return{'orgId':this[_0x382cd4(0xf3)],'accessToken':this[_0x382cd4(0x140)],'instanceUrl':this[_0x382cd4(0x144)]};}async['requestConfig'](_0x51229d=''){const _0x1655a2=a271_0x338184;await this[_0x1655a2(0x12b)]();const _0x1d0db6={'baseURL':this[_0x1655a2(0x144)],'headers':{'accept':_0x1655a2(0x139)}};if(salesforce_1[_0x1655a2(0x127)][_0x1655a2(0x13e)](_0x51229d))_0x1d0db6[_0x1655a2(0x137)][_0x1655a2(0x129)]=this[_0x1655a2(0x140)];else salesforce_1[_0x1655a2(0x127)]['isSoapUrl'](_0x51229d)?_0x1d0db6['data']=_0x1d0db6[_0x1655a2(0x13f)]['replace'](/<met:sessionId>.+?<\/met:sessionId>/,_0x1655a2(0x108)+this[_0x1655a2(0x140)]+_0x1655a2(0x13a)):_0x1d0db6[_0x1655a2(0x137)][_0x1655a2(0xfe)]=this['tokenType']+'\x20'+this['accessToken'];return _0x1d0db6;}};function a271_0x31d8(){const _0x4e44e8=['application/json','</met:sessionId>','post','Service','Tokens','isBulk1Url','data','accessToken','AUTH_WAIT_TIME','@flosum/salesforce','access_token','instanceUrl','error','Updating','Access\x20token\x20updated\x20for\x20%s','__createBinding','logger','call','default','SALESFORCE_API_VERSION','__metadata','writable','3667573iGRTJs','configurable','services/data/','salesforce','orgId','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','sleep','ERR_INVALID_SALESFORCE_TOKEN','setAuthDetails','../enums/auth-state.enum','__esModule','function','then','toString','SalesforceAuthService','authorization','31kOlUnu','100892GLmTft','Check\x20auth:\x20current\x20state\x20-\x20%s','../errors/unauthorized-salesforce.error','log','axios','response','length','Logger','<met:sessionId>','__decorate','3253842ByJOnm','getOwnPropertyDescriptor','metadata','updateAccessToken','get','hasOwnProperty','../errors/invalid-refresh-token.error','../../providers/providers.tokens','prototype','Update\x20access\x20token','24mkSFpe','Update\x20access\x20token\x20failed:\x20%s','object','94254GBAqqD','Error','apply','1571932yNPvCI','../../../shared/utils','Active','../../../../constants','InvalidRefreshTokenError','2060uxxUds','AuthState','requestConfig','__importDefault','UnauthorizedSalesforceError','create','12091869lCeTwn','15yZnFpw','SalesforceUtils','Idle','X-SFDC-Session','getAuthData','waitAuth','instance_url','joinURL','typedi','authState','6152364YEltYi','search','/services/oauth2/token','defineProperty','decorate','(((.+)+)+)+$','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','headers','forceUpdateToken'];a271_0x31d8=function(){return _0x4e44e8;};return a271_0x31d8();}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a271_0x338184(0x13c)])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports[a271_0x338184(0xfd)]=SalesforceAuthService;