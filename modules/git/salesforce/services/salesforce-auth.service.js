const a271_0x4a9b94=a271_0x2d85;function a271_0x2d85(_0x2a4d86,_0x33cda6){const _0x4e796d=a271_0x27b7();return a271_0x2d85=function(_0x3ed890,_0x16979a){_0x3ed890=_0x3ed890-0x80;let _0x27b7c3=_0x4e796d[_0x3ed890];return _0x27b7c3;},a271_0x2d85(_0x2a4d86,_0x33cda6);}(function(_0x23cb8d,_0x384df2){const _0x22b910=a271_0x2d85,_0x8373ba=_0x23cb8d();while(!![]){try{const _0x36a55d=parseInt(_0x22b910(0xa5))/0x1*(parseInt(_0x22b910(0xc5))/0x2)+parseInt(_0x22b910(0xd0))/0x3*(parseInt(_0x22b910(0x9a))/0x4)+-parseInt(_0x22b910(0xe7))/0x5*(parseInt(_0x22b910(0xae))/0x6)+parseInt(_0x22b910(0xbf))/0x7*(parseInt(_0x22b910(0xd1))/0x8)+parseInt(_0x22b910(0x91))/0x9*(-parseInt(_0x22b910(0xd8))/0xa)+-parseInt(_0x22b910(0xc2))/0xb+parseInt(_0x22b910(0xab))/0xc;if(_0x36a55d===_0x384df2)break;else _0x8373ba['push'](_0x8373ba['shift']());}catch(_0x5dcc24){_0x8373ba['push'](_0x8373ba['shift']());}}}(a271_0x27b7,0x457ba));const a271_0x16979a=(function(){let _0x59f90b=!![];return function(_0x525650,_0x3fcdeb){const _0x2366ce=_0x59f90b?function(){const _0x4a85e1=a271_0x2d85;if(_0x3fcdeb){const _0x11c5fc=_0x3fcdeb[_0x4a85e1(0xa0)](_0x525650,arguments);return _0x3fcdeb=null,_0x11c5fc;}}:function(){};return _0x59f90b=![],_0x2366ce;};}()),a271_0x3ed890=a271_0x16979a(this,function(){const _0x5ac5dd=a271_0x2d85;return a271_0x3ed890[_0x5ac5dd(0xca)]()[_0x5ac5dd(0xa2)]('(((.+)+)+)+$')[_0x5ac5dd(0xca)]()[_0x5ac5dd(0xcb)](a271_0x3ed890)[_0x5ac5dd(0xa2)](_0x5ac5dd(0xe5));});a271_0x3ed890();'use strict';function a271_0x27b7(){const _0x44ac70=['getOwnPropertyDescriptor','isSoapUrl','axios','sleep','Update\x20access\x20token\x20failed:\x20%s','configurable','../../../shared/utils','Active','tokenType','create','data','catch','SalesforceUtils','services/data/','</met:sessionId>','../errors/unauthorized-salesforce.error','27207fCwezR','Access\x20token\x20updated\x20for\x20%s','../../../../core','response','instanceUrl','../../providers/providers.tokens','then','setAuthDetails','joinURL','980528Jmzftf','Updating','logger','ERR_INVALID_SALESFORCE_TOKEN','name','metadata','apply','isBulk1Url','search','__setModuleDefault','SalesforceAuthService','127cdEHlX','AUTH_WAIT_TIME','decorate','forceUpdateToken','function','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','2342172VmNWgU','../errors/invalid-refresh-token.error','@flosum/salesforce','254964UHJTHJ','../../../../constants','accessToken','Error','get','authState','../enums/auth-state.enum','design:paramtypes','replace','orgId','hasOwnProperty','log','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','__esModule','post','__importStar','refresh_token','3038rppmBJ','default','X-SFDC-Session','1515679pAVebk','authorization','instance_url','3988JwKNCA','Force\x20update\x20token','updateAccessToken','length','Tokens','toString','constructor','Check\x20auth:\x20current\x20state\x20-\x20%s','__createBinding','__metadata','UnauthorizedSalesforceError','3emrqNR','5624equgCL','error','/services/oauth2/token','../../../../constants/errors','Update\x20access\x20token','getAuthData','defineProperty','360GVWZcT','Idle','__decorate','object','waitAuth','requestConfig','headers','Logger','application/json','message','call','typedi','AuthState','(((.+)+)+)+$','prototype','55LDSrXq','writable'];a271_0x27b7=function(){return _0x44ac70;};return a271_0x27b7();}var __createBinding=this&&this[a271_0x4a9b94(0xcd)]||(Object[a271_0x4a9b94(0x8a)]?function(_0x40550c,_0x3eff3b,_0x48cdbd,_0x696270){const _0x1e018c=a271_0x4a9b94;if(_0x696270===undefined)_0x696270=_0x48cdbd;var _0xd54954=Object[_0x1e018c(0x81)](_0x3eff3b,_0x48cdbd);(!_0xd54954||(_0x1e018c(0xb2)in _0xd54954?!_0x3eff3b[_0x1e018c(0xbb)]:_0xd54954[_0x1e018c(0x80)]||_0xd54954[_0x1e018c(0x86)]))&&(_0xd54954={'enumerable':!![],'get':function(){return _0x3eff3b[_0x48cdbd];}}),Object['defineProperty'](_0x40550c,_0x696270,_0xd54954);}:function(_0x18f843,_0x1f66a2,_0x255d09,_0x21c194){if(_0x21c194===undefined)_0x21c194=_0x255d09;_0x18f843[_0x21c194]=_0x1f66a2[_0x255d09];}),__setModuleDefault=this&&this[a271_0x4a9b94(0xa3)]||(Object[a271_0x4a9b94(0x8a)]?function(_0x49b920,_0x352780){const _0x2ac6a8=a271_0x4a9b94;Object[_0x2ac6a8(0xd7)](_0x49b920,_0x2ac6a8(0xc0),{'enumerable':!![],'value':_0x352780});}:function(_0x4c7bff,_0x2f5803){_0x4c7bff['default']=_0x2f5803;}),__decorate=this&&this[a271_0x4a9b94(0xda)]||function(_0x5c97cd,_0x3e39c7,_0x173af6,_0x429cdd){const _0x512182=a271_0x4a9b94;var _0xfdd7e8=arguments[_0x512182(0xc8)],_0x3a4ba6=_0xfdd7e8<0x3?_0x3e39c7:_0x429cdd===null?_0x429cdd=Object[_0x512182(0x81)](_0x3e39c7,_0x173af6):_0x429cdd,_0x53b5e8;if(typeof Reflect===_0x512182(0xdb)&&typeof Reflect[_0x512182(0xa7)]==='function')_0x3a4ba6=Reflect[_0x512182(0xa7)](_0x5c97cd,_0x3e39c7,_0x173af6,_0x429cdd);else{for(var _0x4246be=_0x5c97cd[_0x512182(0xc8)]-0x1;_0x4246be>=0x0;_0x4246be--)if(_0x53b5e8=_0x5c97cd[_0x4246be])_0x3a4ba6=(_0xfdd7e8<0x3?_0x53b5e8(_0x3a4ba6):_0xfdd7e8>0x3?_0x53b5e8(_0x3e39c7,_0x173af6,_0x3a4ba6):_0x53b5e8(_0x3e39c7,_0x173af6))||_0x3a4ba6;}return _0xfdd7e8>0x3&&_0x3a4ba6&&Object[_0x512182(0xd7)](_0x3e39c7,_0x173af6,_0x3a4ba6),_0x3a4ba6;},__importStar=this&&this[a271_0x4a9b94(0xbd)]||function(_0x555b75){const _0x5dbc18=a271_0x4a9b94;if(_0x555b75&&_0x555b75[_0x5dbc18(0xbb)])return _0x555b75;var _0x4be766={};if(_0x555b75!=null){for(var _0x5a904c in _0x555b75)if(_0x5a904c!==_0x5dbc18(0xc0)&&Object[_0x5dbc18(0xe6)][_0x5dbc18(0xb8)][_0x5dbc18(0xe2)](_0x555b75,_0x5a904c))__createBinding(_0x4be766,_0x555b75,_0x5a904c);}return __setModuleDefault(_0x4be766,_0x555b75),_0x4be766;},__metadata=this&&this[a271_0x4a9b94(0xce)]||function(_0x200ca8,_0x2d641d){const _0x4c2918=a271_0x4a9b94;if(typeof Reflect===_0x4c2918(0xdb)&&typeof Reflect[_0x4c2918(0x9f)]===_0x4c2918(0xa9))return Reflect[_0x4c2918(0x9f)](_0x200ca8,_0x2d641d);},__importDefault=this&&this['__importDefault']||function(_0x2ae76d){return _0x2ae76d&&_0x2ae76d['__esModule']?_0x2ae76d:{'default':_0x2ae76d};},SalesforceAuthService_1;Object[a271_0x4a9b94(0xd7)](exports,'__esModule',{'value':!![]}),exports[a271_0x4a9b94(0xa4)]=void 0x0;const typedi_1=__importStar(require(a271_0x4a9b94(0xe3))),errors_1=require(a271_0x4a9b94(0xd4)),core_1=require(a271_0x4a9b94(0x93)),axios_1=__importDefault(require(a271_0x4a9b94(0x83))),utils_1=require(a271_0x4a9b94(0x87)),invalid_refresh_token_error_1=require(a271_0x4a9b94(0xac)),auth_state_enum_1=require(a271_0x4a9b94(0xb4)),unauthorized_salesforce_error_1=require(a271_0x4a9b94(0x90)),constants_1=require(a271_0x4a9b94(0xaf)),providers_tokens_1=require(a271_0x4a9b94(0x96)),salesforce_1=require(a271_0x4a9b94(0xad));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x202ff0=a271_0x4a9b94;this[_0x202ff0(0xa6)]=0x1388,this[_0x202ff0(0xb3)]=auth_state_enum_1['AuthState'][_0x202ff0(0xd9)],this[_0x202ff0(0x9c)]=new core_1[(_0x202ff0(0xdf))](SalesforceAuthService_1[_0x202ff0(0x9e)]),this[_0x202ff0(0x98)]();}async[a271_0x4a9b94(0x98)](){const _0x413fed=a271_0x4a9b94;this[_0x413fed(0x9c)][_0x413fed(0xb9)](_0x413fed(0xcc),auth_state_enum_1[_0x413fed(0xe4)][this['authState']]);try{if(this['authState']===auth_state_enum_1[_0x413fed(0xe4)][_0x413fed(0xb1)])return;if(this['authState']===auth_state_enum_1[_0x413fed(0xe4)]['Idle'])await this['updateAccessToken']();else{const _0x2174c2=await this[_0x413fed(0xdd)](),_0x2fafa3=await axios_1[_0x413fed(0xc0)][_0x413fed(0xb2)](_0x413fed(0x8e)+constants_1['SALESFORCE_API_VERSION'],_0x2174c2)[_0x413fed(0x97)](()=>!![])[_0x413fed(0x8c)](()=>![]);!_0x2fafa3&&await this[_0x413fed(0xc7)]();}}catch(_0x200a14){}}async[a271_0x4a9b94(0xc7)](){const _0x490768=a271_0x4a9b94;var _0x966f5c,_0x95a644,_0x233fbd;this['logger']['log'](_0x490768(0xd5));try{this[_0x490768(0xb3)]=auth_state_enum_1[_0x490768(0xe4)][_0x490768(0x9b)];const {refreshToken:_0xf1078f,clientId:_0x469e4f,clientSecret:_0x53207d,loginUrl:_0x13fed2}=typedi_1[_0x490768(0xc0)][_0x490768(0xb2)](providers_tokens_1[_0x490768(0xc9)]['salesforce']),{data:_0x584f1f}=await axios_1['default'][_0x490768(0xbc)]((0x0,utils_1[_0x490768(0x99)])(_0x13fed2,_0x490768(0xd3)),null,{'params':{'grant_type':_0x490768(0xbe),'refresh_token':_0xf1078f,'client_id':_0x469e4f,'client_secret':_0x53207d}});this['instanceUrl']=_0x584f1f[_0x490768(0xc4)],this[_0x490768(0xb0)]=_0x584f1f['access_token'],this[_0x490768(0x89)]=_0x584f1f['token_type'],this['authState']=auth_state_enum_1[_0x490768(0xe4)]['Active'],this[_0x490768(0x9c)][_0x490768(0xb9)](_0x490768(0x92),this[_0x490768(0x95)]);}catch(_0xa39cbe){const _0x3b7f41=((_0x95a644=(_0x966f5c=_0xa39cbe===null||_0xa39cbe===void 0x0?void 0x0:_0xa39cbe[_0x490768(0x94)])===null||_0x966f5c===void 0x0?void 0x0:_0x966f5c[_0x490768(0x8b)])===null||_0x95a644===void 0x0?void 0x0:_0x95a644[_0x490768(0xd2)])||((_0x233fbd=_0xa39cbe===null||_0xa39cbe===void 0x0?void 0x0:_0xa39cbe[_0x490768(0x94)])===null||_0x233fbd===void 0x0?void 0x0:_0x233fbd['data'])||_0xa39cbe[_0x490768(0xe1)];this['logger'][_0x490768(0xd2)](_0x490768(0x85),_0x3b7f41),this[_0x490768(0xb3)]=auth_state_enum_1[_0x490768(0xe4)][_0x490768(0xb1)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x490768(0x9d)]);}}async['forceUpdateToken'](){const _0x17b221=a271_0x4a9b94;this[_0x17b221(0x9c)][_0x17b221(0xb9)](_0x17b221(0xc6));if(this['authState']===auth_state_enum_1['AuthState'][_0x17b221(0x9b)]||this[_0x17b221(0xb3)]===auth_state_enum_1[_0x17b221(0xe4)]['Idle'])return await(0x0,utils_1[_0x17b221(0x84)])(this[_0x17b221(0xa6)]),this[_0x17b221(0xa8)]();if(this[_0x17b221(0xb3)]===auth_state_enum_1[_0x17b221(0xe4)][_0x17b221(0xb1)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x17b221(0xc7)]();}async[a271_0x4a9b94(0xdc)](){const _0x2e83f3=a271_0x4a9b94;if(this[_0x2e83f3(0xb3)]===auth_state_enum_1[_0x2e83f3(0xe4)][_0x2e83f3(0xb1)]){this[_0x2e83f3(0x9c)][_0x2e83f3(0xb9)](_0x2e83f3(0xaa));throw new unauthorized_salesforce_error_1[(_0x2e83f3(0xcf))]();}if(this[_0x2e83f3(0xb3)]!==auth_state_enum_1[_0x2e83f3(0xe4)][_0x2e83f3(0x88)])return this[_0x2e83f3(0x9c)]['log'](_0x2e83f3(0xba)),await(0x0,utils_1[_0x2e83f3(0x84)])(this[_0x2e83f3(0xa6)]),this['waitAuth']();}[a271_0x4a9b94(0xd6)](){const _0x4d40db=a271_0x4a9b94;return{'orgId':this[_0x4d40db(0xb7)],'accessToken':this[_0x4d40db(0xb0)],'instanceUrl':this[_0x4d40db(0x95)]};}async[a271_0x4a9b94(0xdd)](_0x2e4b89=''){const _0x1a9b7f=a271_0x4a9b94;await this[_0x1a9b7f(0xdc)]();const _0x10c3e3={'baseURL':this[_0x1a9b7f(0x95)],'headers':{'accept':_0x1a9b7f(0xe0)}};if(salesforce_1[_0x1a9b7f(0x8d)][_0x1a9b7f(0xa1)](_0x2e4b89))_0x10c3e3[_0x1a9b7f(0xde)][_0x1a9b7f(0xc1)]=this[_0x1a9b7f(0xb0)];else salesforce_1[_0x1a9b7f(0x8d)][_0x1a9b7f(0x82)](_0x2e4b89)?_0x10c3e3['data']=_0x10c3e3[_0x1a9b7f(0x8b)][_0x1a9b7f(0xb6)](/<met:sessionId>.+?<\/met:sessionId>/,'<met:sessionId>'+this[_0x1a9b7f(0xb0)]+_0x1a9b7f(0x8f)):_0x10c3e3['headers'][_0x1a9b7f(0xc3)]=this[_0x1a9b7f(0x89)]+'\x20'+this[_0x1a9b7f(0xb0)];return _0x10c3e3;}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a271_0x4a9b94(0xb5),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;