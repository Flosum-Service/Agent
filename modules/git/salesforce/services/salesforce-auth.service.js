const a232_0x375cc2=a232_0x1055;(function(_0x10bdc2,_0x3e0786){const _0x4218b7=a232_0x1055,_0x79a931=_0x10bdc2();while(!![]){try{const _0x6a53e2=-parseInt(_0x4218b7(0xe0))/0x1+-parseInt(_0x4218b7(0xaf))/0x2+parseInt(_0x4218b7(0xcb))/0x3+-parseInt(_0x4218b7(0xb1))/0x4*(parseInt(_0x4218b7(0xd8))/0x5)+-parseInt(_0x4218b7(0xc0))/0x6*(parseInt(_0x4218b7(0xf8))/0x7)+-parseInt(_0x4218b7(0xc3))/0x8+parseInt(_0x4218b7(0xd9))/0x9*(parseInt(_0x4218b7(0xd1))/0xa);if(_0x6a53e2===_0x3e0786)break;else _0x79a931['push'](_0x79a931['shift']());}catch(_0x3de8e3){_0x79a931['push'](_0x79a931['shift']());}}}(a232_0x5827,0x77829));function a232_0x1055(_0x3124ad,_0x2f1350){const _0x4fc4f1=a232_0x5827();return a232_0x1055=function(_0x19a9ed,_0x1124de){_0x19a9ed=_0x19a9ed-0xa7;let _0x582797=_0x4fc4f1[_0x19a9ed];return _0x582797;},a232_0x1055(_0x3124ad,_0x2f1350);}function a232_0x5827(){const _0x50be3e=['updateAccessToken','__esModule','68257oDsgYi','configurable','force\x20update\x20token','getOwnPropertyDescriptor','ERR_INVALID_SALESFORCE_TOKEN','hasOwnProperty','../errors/unauthorized-salesforce.error','InvalidRefreshTokenError','create','length','search','setAuthDetails','__decorate','update\x20access\x20token\x20failed:\x20%s','SalesforceAuthService','call','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','waitAuth','create\x20authorized\x20request\x20failed:\x20authorization\x20error','data','default','instanceUrl','/services/oauth2/token','Error','1225QVcDYY','Idle','instance_url','authState','function','../../../../constants/errors','logger','design:paramtypes','then','1211400XQGPtm','apply','4tkwsBg','name','access\x20token\x20updated\x20for\x20%s','__importStar','AuthState','response','toString','../../../../constants','writable','__metadata','SALESFORCE_API_VERSION','accessToken','update\x20access\x20token','constructor','__createBinding','30360pLurYh','(((.+)+)+)+$','metadata','7303576asNaWO','typedi','message','__importDefault','../../../../core','error','__setModuleDefault','defineProperty','2859339eGOTLj','requestConfig','salesforce','check\x20auth:\x20current\x20state\x20-\x20%s','application/json','catch','5010JUfTWz','access_token','sleep','object','log','Updating','decorate','3733480ueymNl','49500TcUcLm','forceUpdateToken','UnauthorizedSalesforceError','AUTH_WAIT_TIME','get'];a232_0x5827=function(){return _0x50be3e;};return a232_0x5827();}const a232_0x1124de=(function(){let _0x4599b6=!![];return function(_0x2eaeb1,_0x13399c){const _0x3f7ced=_0x4599b6?function(){const _0x521254=a232_0x1055;if(_0x13399c){const _0xbb96cf=_0x13399c[_0x521254(0xb0)](_0x2eaeb1,arguments);return _0x13399c=null,_0xbb96cf;}}:function(){};return _0x4599b6=![],_0x3f7ced;};}()),a232_0x19a9ed=a232_0x1124de(this,function(){const _0x5162b0=a232_0x1055;return a232_0x19a9ed[_0x5162b0(0xb7)]()[_0x5162b0(0xea)](_0x5162b0(0xc1))[_0x5162b0(0xb7)]()[_0x5162b0(0xbe)](a232_0x19a9ed)[_0x5162b0(0xea)](_0x5162b0(0xc1));});a232_0x19a9ed();'use strict';var __createBinding=this&&this[a232_0x375cc2(0xbf)]||(Object[a232_0x375cc2(0xe8)]?function(_0x1af8e2,_0x5c54f4,_0x76a30b,_0x4f62ea){const _0xd80f42=a232_0x375cc2;if(_0x4f62ea===undefined)_0x4f62ea=_0x76a30b;var _0x11fc2e=Object[_0xd80f42(0xe3)](_0x5c54f4,_0x76a30b);(!_0x11fc2e||(_0xd80f42(0xdd)in _0x11fc2e?!_0x5c54f4[_0xd80f42(0xdf)]:_0x11fc2e[_0xd80f42(0xb9)]||_0x11fc2e[_0xd80f42(0xe1)]))&&(_0x11fc2e={'enumerable':!![],'get':function(){return _0x5c54f4[_0x76a30b];}}),Object[_0xd80f42(0xca)](_0x1af8e2,_0x4f62ea,_0x11fc2e);}:function(_0x495131,_0x31d3c8,_0x1bb9d1,_0x10567d){if(_0x10567d===undefined)_0x10567d=_0x1bb9d1;_0x495131[_0x10567d]=_0x31d3c8[_0x1bb9d1];}),__setModuleDefault=this&&this[a232_0x375cc2(0xc9)]||(Object[a232_0x375cc2(0xe8)]?function(_0x53d520,_0x3cbb0e){const _0x46a170=a232_0x375cc2;Object['defineProperty'](_0x53d520,_0x46a170(0xf4),{'enumerable':!![],'value':_0x3cbb0e});}:function(_0x40c4e2,_0x732cad){const _0x259dc4=a232_0x375cc2;_0x40c4e2[_0x259dc4(0xf4)]=_0x732cad;}),__decorate=this&&this[a232_0x375cc2(0xec)]||function(_0x2719ac,_0x4d2278,_0x3442cb,_0x453054){const _0x488e2a=a232_0x375cc2;var _0x5eb805=arguments[_0x488e2a(0xe9)],_0x7fb598=_0x5eb805<0x3?_0x4d2278:_0x453054===null?_0x453054=Object[_0x488e2a(0xe3)](_0x4d2278,_0x3442cb):_0x453054,_0x3a494f;if(typeof Reflect===_0x488e2a(0xd4)&&typeof Reflect[_0x488e2a(0xd7)]==='function')_0x7fb598=Reflect[_0x488e2a(0xd7)](_0x2719ac,_0x4d2278,_0x3442cb,_0x453054);else{for(var _0x32c2cf=_0x2719ac[_0x488e2a(0xe9)]-0x1;_0x32c2cf>=0x0;_0x32c2cf--)if(_0x3a494f=_0x2719ac[_0x32c2cf])_0x7fb598=(_0x5eb805<0x3?_0x3a494f(_0x7fb598):_0x5eb805>0x3?_0x3a494f(_0x4d2278,_0x3442cb,_0x7fb598):_0x3a494f(_0x4d2278,_0x3442cb))||_0x7fb598;}return _0x5eb805>0x3&&_0x7fb598&&Object['defineProperty'](_0x4d2278,_0x3442cb,_0x7fb598),_0x7fb598;},__importStar=this&&this[a232_0x375cc2(0xb4)]||function(_0x3ebb28){const _0x97b4cc=a232_0x375cc2;if(_0x3ebb28&&_0x3ebb28[_0x97b4cc(0xdf)])return _0x3ebb28;var _0xe8f531={};if(_0x3ebb28!=null){for(var _0x375ce8 in _0x3ebb28)if(_0x375ce8!==_0x97b4cc(0xf4)&&Object['prototype'][_0x97b4cc(0xe5)][_0x97b4cc(0xef)](_0x3ebb28,_0x375ce8))__createBinding(_0xe8f531,_0x3ebb28,_0x375ce8);}return __setModuleDefault(_0xe8f531,_0x3ebb28),_0xe8f531;},__metadata=this&&this[a232_0x375cc2(0xba)]||function(_0xf332ed,_0x18053e){const _0x287757=a232_0x375cc2;if(typeof Reflect===_0x287757(0xd4)&&typeof Reflect[_0x287757(0xc2)]===_0x287757(0xaa))return Reflect[_0x287757(0xc2)](_0xf332ed,_0x18053e);},__importDefault=this&&this[a232_0x375cc2(0xc6)]||function(_0x33c3c4){const _0x474747=a232_0x375cc2;return _0x33c3c4&&_0x33c3c4[_0x474747(0xdf)]?_0x33c3c4:{'default':_0x33c3c4};},SalesforceAuthService_1;Object[a232_0x375cc2(0xca)](exports,a232_0x375cc2(0xdf),{'value':!![]}),exports[a232_0x375cc2(0xee)]=void 0x0;const typedi_1=__importStar(require(a232_0x375cc2(0xc4))),errors_1=require(a232_0x375cc2(0xab)),core_1=require(a232_0x375cc2(0xc7)),axios_1=__importDefault(require('axios')),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a232_0x375cc2(0xe6)),constants_1=require(a232_0x375cc2(0xb8)),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x1a46a1=a232_0x375cc2;this[_0x1a46a1(0xdc)]=0x1388,this['authState']=auth_state_enum_1['AuthState'][_0x1a46a1(0xa7)],this['logger']=new core_1['Logger'](SalesforceAuthService_1[_0x1a46a1(0xb2)]),this[_0x1a46a1(0xeb)]();}async[a232_0x375cc2(0xeb)](){const _0x2036be=a232_0x375cc2;this['logger'][_0x2036be(0xd5)](_0x2036be(0xce),auth_state_enum_1[_0x2036be(0xb5)][this[_0x2036be(0xa9)]]);try{if(this[_0x2036be(0xa9)]===auth_state_enum_1[_0x2036be(0xb5)][_0x2036be(0xf7)])return;if(this[_0x2036be(0xa9)]===auth_state_enum_1[_0x2036be(0xb5)][_0x2036be(0xa7)])await this[_0x2036be(0xde)]();else{const _0x4effea=await this[_0x2036be(0xcc)](),_0x281f61=await axios_1[_0x2036be(0xf4)][_0x2036be(0xdd)]('services/data/'+constants_1[_0x2036be(0xbb)],_0x4effea)[_0x2036be(0xae)](()=>!![])[_0x2036be(0xd0)](()=>![]);!_0x281f61&&await this['updateAccessToken']();}}catch(_0x11ead6){}}async[a232_0x375cc2(0xde)](){const _0x2fc566=a232_0x375cc2;var _0x4bd8d0,_0x1d47b0,_0x4c2c0b;this[_0x2fc566(0xac)]['log'](_0x2fc566(0xbd));try{this[_0x2fc566(0xa9)]=auth_state_enum_1[_0x2fc566(0xb5)][_0x2fc566(0xd6)];const {refreshToken:_0x8f1b57,clientId:_0x358693,clientSecret:_0x83ef9d,loginUrl:_0x202098}=typedi_1[_0x2fc566(0xf4)][_0x2fc566(0xdd)](providers_tokens_1['Tokens'][_0x2fc566(0xcd)]),{data:_0x3776ef}=await axios_1['default']['post']((0x0,utils_1['joinURL'])(_0x202098,_0x2fc566(0xf6)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x8f1b57,'client_id':_0x358693,'client_secret':_0x83ef9d}});this[_0x2fc566(0xf5)]=_0x3776ef[_0x2fc566(0xa8)],this[_0x2fc566(0xbc)]=_0x3776ef[_0x2fc566(0xd2)],this['tokenType']=_0x3776ef['token_type'],this[_0x2fc566(0xa9)]=auth_state_enum_1[_0x2fc566(0xb5)]['Active'],this[_0x2fc566(0xac)][_0x2fc566(0xd5)](_0x2fc566(0xb3),this['instanceUrl']);}catch(_0x4d220b){const _0x5ae083=((_0x1d47b0=(_0x4bd8d0=_0x4d220b===null||_0x4d220b===void 0x0?void 0x0:_0x4d220b[_0x2fc566(0xb6)])===null||_0x4bd8d0===void 0x0?void 0x0:_0x4bd8d0[_0x2fc566(0xf3)])===null||_0x1d47b0===void 0x0?void 0x0:_0x1d47b0['error'])||((_0x4c2c0b=_0x4d220b===null||_0x4d220b===void 0x0?void 0x0:_0x4d220b[_0x2fc566(0xb6)])===null||_0x4c2c0b===void 0x0?void 0x0:_0x4c2c0b[_0x2fc566(0xf3)])||_0x4d220b[_0x2fc566(0xc5)];this['logger'][_0x2fc566(0xc8)](_0x2fc566(0xed),_0x5ae083),this[_0x2fc566(0xa9)]=auth_state_enum_1[_0x2fc566(0xb5)]['Error'];throw new invalid_refresh_token_error_1[(_0x2fc566(0xe7))](errors_1[_0x2fc566(0xe4)]);}}async['forceUpdateToken'](){const _0x32e75e=a232_0x375cc2;this[_0x32e75e(0xac)][_0x32e75e(0xd5)](_0x32e75e(0xe2));if(this[_0x32e75e(0xa9)]===auth_state_enum_1['AuthState'][_0x32e75e(0xd6)]||this[_0x32e75e(0xa9)]===auth_state_enum_1['AuthState']['Idle'])return await(0x0,utils_1[_0x32e75e(0xd3)])(this[_0x32e75e(0xdc)]),this[_0x32e75e(0xda)]();if(this[_0x32e75e(0xa9)]===auth_state_enum_1[_0x32e75e(0xb5)][_0x32e75e(0xf7)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x32e75e(0xe4)]);await this[_0x32e75e(0xde)]();}async[a232_0x375cc2(0xf1)](){const _0x27b948=a232_0x375cc2;if(this['authState']===auth_state_enum_1['AuthState']['Error']){this[_0x27b948(0xac)][_0x27b948(0xd5)](_0x27b948(0xf2));throw new unauthorized_salesforce_error_1[(_0x27b948(0xdb))]();}if(this['authState']!==auth_state_enum_1[_0x27b948(0xb5)]['Active'])return this['logger'][_0x27b948(0xd5)](_0x27b948(0xf0)),await(0x0,utils_1['sleep'])(this[_0x27b948(0xdc)]),this[_0x27b948(0xf1)]();}['getAuthData'](){const _0xe66ee6=a232_0x375cc2;return{'orgId':this['orgId'],'accessToken':this[_0xe66ee6(0xbc)],'instanceUrl':this[_0xe66ee6(0xf5)]};}async[a232_0x375cc2(0xcc)](){const _0x13972d=a232_0x375cc2;return await this[_0x13972d(0xf1)](),{'baseURL':this[_0x13972d(0xf5)],'headers':{'accept':_0x13972d(0xcf),'authorization':this['tokenType']+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a232_0x375cc2(0xad),[])],SalesforceAuthService),exports[a232_0x375cc2(0xee)]=SalesforceAuthService;