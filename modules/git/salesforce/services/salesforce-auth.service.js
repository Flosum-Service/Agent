const a180_0x5df55f=a180_0x3788;function a180_0x20e9(){const _0x2358b8=['orgId','__setModuleDefault','getOwnPropertyDescriptor','413qEjPuF','getAuthData','apply','default','(((.+)+)+)+$','__esModule','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','constructor','20ztvsne','__metadata','update\x20access\x20token\x20failed:\x20%s','prototype','axios','then','../../providers/providers.tokens','tokenType','name','__decorate','error','Active','SalesforceAuthService','9vWaoPR','get','waitAuth','1478612ePBcvX','call','function','279831BVqLqa','authState','__importDefault','response','requestConfig','search','metadata','../errors/unauthorized-salesforce.error','22Phlsag','Error','data','access_token','173256zZKXkG','__createBinding','Idle','create','/services/oauth2/token','force\x20update\x20token','166518twuNyr','object','create\x20authorized\x20request\x20failed:\x20authorization\x20error','forceUpdateToken','decorate','check\x20auth:\x20current\x20state\x20-\x20%s','toString','Updating','12980CVLOxQ','logger','instanceUrl','instance_url','hasOwnProperty','token_type','ERR_INVALID_SALESFORCE_TOKEN','SALESFORCE_API_VERSION','setAuthDetails','../../../shared/utils','AuthState','sleep','defineProperty','7857040HCsBii','../../../../constants/errors','log','../enums/auth-state.enum','14088ZIDkly','AUTH_WAIT_TIME','344371vbJVDN','Tokens','../../../../core','salesforce','typedi','updateAccessToken','InvalidRefreshTokenError'];a180_0x20e9=function(){return _0x2358b8;};return a180_0x20e9();}(function(_0x293ca8,_0x1de1cb){const _0x2aa5da=a180_0x3788,_0x4cafc5=_0x293ca8();while(!![]){try{const _0x5e11ae=parseInt(_0x2aa5da(0x19c))/0x1+parseInt(_0x2aa5da(0x177))/0x2*(-parseInt(_0x2aa5da(0x16f))/0x3)+parseInt(_0x2aa5da(0x16c))/0x4+-parseInt(_0x2aa5da(0x1ae))/0x5*(-parseInt(_0x2aa5da(0x181))/0x6)+-parseInt(_0x2aa5da(0x1a6))/0x7*(parseInt(_0x2aa5da(0x17b))/0x8)+parseInt(_0x2aa5da(0x169))/0x9*(parseInt(_0x2aa5da(0x196))/0xa)+parseInt(_0x2aa5da(0x189))/0xb*(parseInt(_0x2aa5da(0x19a))/0xc);if(_0x5e11ae===_0x1de1cb)break;else _0x4cafc5['push'](_0x4cafc5['shift']());}catch(_0xeb8a80){_0x4cafc5['push'](_0x4cafc5['shift']());}}}(a180_0x20e9,0xa901a));const a180_0x4ca5d9=(function(){let _0xd63e0d=!![];return function(_0x384bd1,_0x16b308){const _0x516ff8=_0xd63e0d?function(){const _0x2b8a68=a180_0x3788;if(_0x16b308){const _0x40e6cd=_0x16b308[_0x2b8a68(0x1a8)](_0x384bd1,arguments);return _0x16b308=null,_0x40e6cd;}}:function(){};return _0xd63e0d=![],_0x516ff8;};}()),a180_0x3b3cd1=a180_0x4ca5d9(this,function(){const _0x4ac409=a180_0x3788;return a180_0x3b3cd1[_0x4ac409(0x187)]()['search'](_0x4ac409(0x1aa))['toString']()[_0x4ac409(0x1ad)](a180_0x3b3cd1)[_0x4ac409(0x174)]('(((.+)+)+)+$');});a180_0x3b3cd1();function a180_0x3788(_0x33c5d2,_0x5cb813){const _0x9eb498=a180_0x20e9();return a180_0x3788=function(_0x3b3cd1,_0x4ca5d9){_0x3b3cd1=_0x3b3cd1-0x166;let _0x20e9bf=_0x9eb498[_0x3b3cd1];return _0x20e9bf;},a180_0x3788(_0x33c5d2,_0x5cb813);}'use strict';var __createBinding=this&&this[a180_0x5df55f(0x17c)]||(Object['create']?function(_0x278b73,_0x107dff,_0x1420a8,_0x4e96d4){const _0x3ff781=a180_0x5df55f;if(_0x4e96d4===undefined)_0x4e96d4=_0x1420a8;Object[_0x3ff781(0x195)](_0x278b73,_0x4e96d4,{'enumerable':!![],'get':function(){return _0x107dff[_0x1420a8];}});}:function(_0x571135,_0x41b0c6,_0x3210f6,_0x8bd925){if(_0x8bd925===undefined)_0x8bd925=_0x3210f6;_0x571135[_0x8bd925]=_0x41b0c6[_0x3210f6];}),__setModuleDefault=this&&this[a180_0x5df55f(0x1a4)]||(Object[a180_0x5df55f(0x17e)]?function(_0x6557bd,_0x30ea5d){const _0x34fb41=a180_0x5df55f;Object[_0x34fb41(0x195)](_0x6557bd,'default',{'enumerable':!![],'value':_0x30ea5d});}:function(_0x465bfa,_0x56b4b6){_0x465bfa['default']=_0x56b4b6;}),__decorate=this&&this[a180_0x5df55f(0x1b7)]||function(_0x1c147a,_0x210ac3,_0x111221,_0x5bc054){const _0x31d5b3=a180_0x5df55f;var _0x1d1696=arguments['length'],_0xab6b1f=_0x1d1696<0x3?_0x210ac3:_0x5bc054===null?_0x5bc054=Object[_0x31d5b3(0x1a5)](_0x210ac3,_0x111221):_0x5bc054,_0x35cd66;if(typeof Reflect===_0x31d5b3(0x182)&&typeof Reflect[_0x31d5b3(0x185)]==='function')_0xab6b1f=Reflect['decorate'](_0x1c147a,_0x210ac3,_0x111221,_0x5bc054);else{for(var _0x2abb08=_0x1c147a['length']-0x1;_0x2abb08>=0x0;_0x2abb08--)if(_0x35cd66=_0x1c147a[_0x2abb08])_0xab6b1f=(_0x1d1696<0x3?_0x35cd66(_0xab6b1f):_0x1d1696>0x3?_0x35cd66(_0x210ac3,_0x111221,_0xab6b1f):_0x35cd66(_0x210ac3,_0x111221))||_0xab6b1f;}return _0x1d1696>0x3&&_0xab6b1f&&Object[_0x31d5b3(0x195)](_0x210ac3,_0x111221,_0xab6b1f),_0xab6b1f;},__importStar=this&&this['__importStar']||function(_0x338b49){const _0x5c1604=a180_0x5df55f;if(_0x338b49&&_0x338b49[_0x5c1604(0x1ab)])return _0x338b49;var _0x56ea15={};if(_0x338b49!=null){for(var _0x3fcc5b in _0x338b49)if(_0x3fcc5b!==_0x5c1604(0x1a9)&&Object[_0x5c1604(0x1b1)][_0x5c1604(0x18d)][_0x5c1604(0x16d)](_0x338b49,_0x3fcc5b))__createBinding(_0x56ea15,_0x338b49,_0x3fcc5b);}return __setModuleDefault(_0x56ea15,_0x338b49),_0x56ea15;},__metadata=this&&this[a180_0x5df55f(0x1af)]||function(_0x11d86e,_0x3532a7){const _0x508d85=a180_0x5df55f;if(typeof Reflect===_0x508d85(0x182)&&typeof Reflect[_0x508d85(0x175)]===_0x508d85(0x16e))return Reflect[_0x508d85(0x175)](_0x11d86e,_0x3532a7);},__importDefault=this&&this[a180_0x5df55f(0x171)]||function(_0x59283e){const _0x5362dc=a180_0x5df55f;return _0x59283e&&_0x59283e[_0x5362dc(0x1ab)]?_0x59283e:{'default':_0x59283e};},SalesforceAuthService_1;Object[a180_0x5df55f(0x195)](exports,a180_0x5df55f(0x1ab),{'value':!![]}),exports[a180_0x5df55f(0x168)]=void 0x0;const typedi_1=__importStar(require(a180_0x5df55f(0x1a0))),errors_1=require(a180_0x5df55f(0x197)),core_1=require(a180_0x5df55f(0x19e)),axios_1=__importDefault(require(a180_0x5df55f(0x1b2))),utils_1=require(a180_0x5df55f(0x192)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a180_0x5df55f(0x199)),unauthorized_salesforce_error_1=require(a180_0x5df55f(0x176)),constants_1=require('../../../../constants'),providers_tokens_1=require(a180_0x5df55f(0x1b4));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x41fc5c=a180_0x5df55f;this[_0x41fc5c(0x19b)]=0x1388,this[_0x41fc5c(0x170)]=auth_state_enum_1[_0x41fc5c(0x193)]['Idle'],this[_0x41fc5c(0x18a)]=new core_1['Logger'](SalesforceAuthService_1[_0x41fc5c(0x1b6)]),this[_0x41fc5c(0x191)]();}async[a180_0x5df55f(0x191)](){const _0xf02b7c=a180_0x5df55f;this[_0xf02b7c(0x18a)][_0xf02b7c(0x198)](_0xf02b7c(0x186),auth_state_enum_1[_0xf02b7c(0x193)][this[_0xf02b7c(0x170)]]);try{if(this[_0xf02b7c(0x170)]===auth_state_enum_1[_0xf02b7c(0x193)][_0xf02b7c(0x178)])return;if(this[_0xf02b7c(0x170)]===auth_state_enum_1[_0xf02b7c(0x193)]['Idle'])await this[_0xf02b7c(0x1a1)]();else{const _0x5650a4=await this[_0xf02b7c(0x173)](),_0x1b07c2=await axios_1[_0xf02b7c(0x1a9)][_0xf02b7c(0x16a)]('services/data/'+constants_1[_0xf02b7c(0x190)],_0x5650a4)[_0xf02b7c(0x1b3)](()=>!![])['catch'](()=>![]);!_0x1b07c2&&await this[_0xf02b7c(0x1a1)]();}}catch(_0x11933c){}}async[a180_0x5df55f(0x1a1)](){const _0x91787d=a180_0x5df55f;var _0x276ba2,_0x5253d5,_0x25ff2a;this[_0x91787d(0x18a)][_0x91787d(0x198)]('update\x20access\x20token');try{this[_0x91787d(0x170)]=auth_state_enum_1[_0x91787d(0x193)][_0x91787d(0x188)];const {refreshToken:_0x1ddaea,clientId:_0x1f3948,clientSecret:_0x202d4b,loginUrl:_0x566e30}=typedi_1[_0x91787d(0x1a9)][_0x91787d(0x16a)](providers_tokens_1[_0x91787d(0x19d)][_0x91787d(0x19f)]),{data:_0xa57a89}=await axios_1[_0x91787d(0x1a9)]['post'](utils_1['joinURL'](_0x566e30,_0x91787d(0x17f)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x1ddaea,'client_id':_0x1f3948,'client_secret':_0x202d4b}});this[_0x91787d(0x18b)]=_0xa57a89[_0x91787d(0x18c)],this['accessToken']=_0xa57a89[_0x91787d(0x17a)],this['tokenType']=_0xa57a89[_0x91787d(0x18e)],this[_0x91787d(0x170)]=auth_state_enum_1[_0x91787d(0x193)][_0x91787d(0x167)],this[_0x91787d(0x18a)][_0x91787d(0x198)]('access\x20token\x20updated\x20for\x20%s',this[_0x91787d(0x18b)]);}catch(_0x1026e1){const _0x410c8a=((_0x5253d5=(_0x276ba2=_0x1026e1===null||_0x1026e1===void 0x0?void 0x0:_0x1026e1[_0x91787d(0x172)])===null||_0x276ba2===void 0x0?void 0x0:_0x276ba2[_0x91787d(0x179)])===null||_0x5253d5===void 0x0?void 0x0:_0x5253d5['error'])||((_0x25ff2a=_0x1026e1===null||_0x1026e1===void 0x0?void 0x0:_0x1026e1[_0x91787d(0x172)])===null||_0x25ff2a===void 0x0?void 0x0:_0x25ff2a[_0x91787d(0x179)])||_0x1026e1['message'];this[_0x91787d(0x18a)][_0x91787d(0x166)](_0x91787d(0x1b0),_0x410c8a),this[_0x91787d(0x170)]=auth_state_enum_1[_0x91787d(0x193)][_0x91787d(0x178)];throw new invalid_refresh_token_error_1[(_0x91787d(0x1a2))](errors_1[_0x91787d(0x18f)]);}}async[a180_0x5df55f(0x184)](){const _0x223890=a180_0x5df55f;this[_0x223890(0x18a)][_0x223890(0x198)](_0x223890(0x180));if(this['authState']===auth_state_enum_1[_0x223890(0x193)]['Updating']||this[_0x223890(0x170)]===auth_state_enum_1[_0x223890(0x193)][_0x223890(0x17d)])return await utils_1[_0x223890(0x194)](this[_0x223890(0x19b)]),this[_0x223890(0x184)]();if(this[_0x223890(0x170)]===auth_state_enum_1[_0x223890(0x193)]['Error'])throw new invalid_refresh_token_error_1[(_0x223890(0x1a2))](errors_1[_0x223890(0x18f)]);await this['updateAccessToken']();}async[a180_0x5df55f(0x16b)](){const _0xb7d252=a180_0x5df55f;if(this[_0xb7d252(0x170)]===auth_state_enum_1[_0xb7d252(0x193)][_0xb7d252(0x178)]){this['logger']['log'](_0xb7d252(0x183));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0xb7d252(0x170)]!==auth_state_enum_1[_0xb7d252(0x193)]['Active'])return this['logger']['log'](_0xb7d252(0x1ac)),await utils_1[_0xb7d252(0x194)](this['AUTH_WAIT_TIME']),this[_0xb7d252(0x16b)]();}[a180_0x5df55f(0x1a7)](){const _0x29a36c=a180_0x5df55f;return{'orgId':this[_0x29a36c(0x1a3)],'accessToken':this['accessToken'],'instanceUrl':this[_0x29a36c(0x18b)]};}async[a180_0x5df55f(0x173)](){const _0x51d85c=a180_0x5df55f;return await this[_0x51d85c(0x16b)](),{'baseURL':this[_0x51d85c(0x18b)],'headers':{'accept':'application/json','authorization':this[_0x51d85c(0x1b5)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1['Service'](),__metadata('design:paramtypes',[])],SalesforceAuthService),exports[a180_0x5df55f(0x168)]=SalesforceAuthService;