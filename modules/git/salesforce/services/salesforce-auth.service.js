const a193_0x5f0621=a193_0x21df;(function(_0x5f24d3,_0x5a22c5){const _0xe7afaf=a193_0x21df,_0x17157a=_0x5f24d3();while(!![]){try{const _0x2b85d2=parseInt(_0xe7afaf(0x158))/0x1*(parseInt(_0xe7afaf(0x11b))/0x2)+parseInt(_0xe7afaf(0x156))/0x3+-parseInt(_0xe7afaf(0x115))/0x4*(-parseInt(_0xe7afaf(0x12b))/0x5)+-parseInt(_0xe7afaf(0x10f))/0x6+-parseInt(_0xe7afaf(0x157))/0x7+-parseInt(_0xe7afaf(0x129))/0x8+-parseInt(_0xe7afaf(0x154))/0x9*(-parseInt(_0xe7afaf(0x114))/0xa);if(_0x2b85d2===_0x5a22c5)break;else _0x17157a['push'](_0x17157a['shift']());}catch(_0x345541){_0x17157a['push'](_0x17157a['shift']());}}}(a193_0x24ab,0xbec32));const a193_0x6f90d6=(function(){let _0xd6dff1=!![];return function(_0x14c357,_0x2e1b39){const _0x332624=_0xd6dff1?function(){const _0xfe9b0e=a193_0x21df;if(_0x2e1b39){const _0x408f03=_0x2e1b39[_0xfe9b0e(0x134)](_0x14c357,arguments);return _0x2e1b39=null,_0x408f03;}}:function(){};return _0xd6dff1=![],_0x332624;};}()),a193_0x624de2=a193_0x6f90d6(this,function(){const _0x173681=a193_0x21df;return a193_0x624de2[_0x173681(0x138)]()[_0x173681(0x151)](_0x173681(0x133))['toString']()[_0x173681(0x145)](a193_0x624de2)[_0x173681(0x151)](_0x173681(0x133));});a193_0x624de2();'use strict';function a193_0x21df(_0x18180f,_0x233f53){const _0x35d435=a193_0x24ab();return a193_0x21df=function(_0x624de2,_0x6f90d6){_0x624de2=_0x624de2-0x10e;let _0x24ab76=_0x35d435[_0x624de2];return _0x24ab76;},a193_0x21df(_0x18180f,_0x233f53);}var __createBinding=this&&this[a193_0x5f0621(0x112)]||(Object[a193_0x5f0621(0x161)]?function(_0xd52b0e,_0x1a300e,_0x8c4114,_0x3dbcb1){const _0x46d317=a193_0x5f0621;if(_0x3dbcb1===undefined)_0x3dbcb1=_0x8c4114;var _0x819826=Object[_0x46d317(0x131)](_0x1a300e,_0x8c4114);(!_0x819826||(_0x46d317(0x14c)in _0x819826?!_0x1a300e[_0x46d317(0x127)]:_0x819826[_0x46d317(0x13d)]||_0x819826[_0x46d317(0x160)]))&&(_0x819826={'enumerable':!![],'get':function(){return _0x1a300e[_0x8c4114];}}),Object[_0x46d317(0x13a)](_0xd52b0e,_0x3dbcb1,_0x819826);}:function(_0x53a13f,_0x5f551d,_0x4f085d,_0x4644ad){if(_0x4644ad===undefined)_0x4644ad=_0x4f085d;_0x53a13f[_0x4644ad]=_0x5f551d[_0x4f085d];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a193_0x5f0621(0x161)]?function(_0x45c48a,_0x13c16b){const _0x5b24d5=a193_0x5f0621;Object['defineProperty'](_0x45c48a,_0x5b24d5(0x126),{'enumerable':!![],'value':_0x13c16b});}:function(_0x1dcb64,_0x104540){const _0x2e708f=a193_0x5f0621;_0x1dcb64[_0x2e708f(0x126)]=_0x104540;}),__decorate=this&&this['__decorate']||function(_0x34a8c1,_0x44b83e,_0x3b1385,_0x4cf407){const _0xd7a4bc=a193_0x5f0621;var _0x1c70ce=arguments[_0xd7a4bc(0x11f)],_0x2e408b=_0x1c70ce<0x3?_0x44b83e:_0x4cf407===null?_0x4cf407=Object[_0xd7a4bc(0x131)](_0x44b83e,_0x3b1385):_0x4cf407,_0x233384;if(typeof Reflect==='object'&&typeof Reflect[_0xd7a4bc(0x143)]==='function')_0x2e408b=Reflect[_0xd7a4bc(0x143)](_0x34a8c1,_0x44b83e,_0x3b1385,_0x4cf407);else{for(var _0x1fd03b=_0x34a8c1['length']-0x1;_0x1fd03b>=0x0;_0x1fd03b--)if(_0x233384=_0x34a8c1[_0x1fd03b])_0x2e408b=(_0x1c70ce<0x3?_0x233384(_0x2e408b):_0x1c70ce>0x3?_0x233384(_0x44b83e,_0x3b1385,_0x2e408b):_0x233384(_0x44b83e,_0x3b1385))||_0x2e408b;}return _0x1c70ce>0x3&&_0x2e408b&&Object['defineProperty'](_0x44b83e,_0x3b1385,_0x2e408b),_0x2e408b;},__importStar=this&&this[a193_0x5f0621(0x11c)]||function(_0x4ad396){const _0x36cb1a=a193_0x5f0621;if(_0x4ad396&&_0x4ad396[_0x36cb1a(0x127)])return _0x4ad396;var _0x381270={};if(_0x4ad396!=null){for(var _0x10aae1 in _0x4ad396)if(_0x10aae1!==_0x36cb1a(0x126)&&Object[_0x36cb1a(0x128)]['hasOwnProperty'][_0x36cb1a(0x118)](_0x4ad396,_0x10aae1))__createBinding(_0x381270,_0x4ad396,_0x10aae1);}return __setModuleDefault(_0x381270,_0x4ad396),_0x381270;},__metadata=this&&this[a193_0x5f0621(0x113)]||function(_0x3b9ba0,_0x59aab3){const _0x351ad8=a193_0x5f0621;if(typeof Reflect===_0x351ad8(0x140)&&typeof Reflect[_0x351ad8(0x148)]===_0x351ad8(0x11d))return Reflect[_0x351ad8(0x148)](_0x3b9ba0,_0x59aab3);},__importDefault=this&&this[a193_0x5f0621(0x116)]||function(_0x41eadc){const _0x89dd58=a193_0x5f0621;return _0x41eadc&&_0x41eadc[_0x89dd58(0x127)]?_0x41eadc:{'default':_0x41eadc};},SalesforceAuthService_1;Object[a193_0x5f0621(0x13a)](exports,a193_0x5f0621(0x127),{'value':!![]}),exports[a193_0x5f0621(0x14d)]=void 0x0;const typedi_1=__importStar(require(a193_0x5f0621(0x13b))),errors_1=require(a193_0x5f0621(0x150)),core_1=require(a193_0x5f0621(0x15a)),axios_1=__importDefault(require('axios')),utils_1=require(a193_0x5f0621(0x14e)),invalid_refresh_token_error_1=require(a193_0x5f0621(0x141)),auth_state_enum_1=require(a193_0x5f0621(0x15c)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a193_0x5f0621(0x12e)),providers_tokens_1=require(a193_0x5f0621(0x155));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x3543f0=a193_0x5f0621;this[_0x3543f0(0x14f)]=0x1388,this[_0x3543f0(0x147)]=auth_state_enum_1[_0x3543f0(0x110)][_0x3543f0(0x15e)],this[_0x3543f0(0x125)]=new core_1[(_0x3543f0(0x14b))](SalesforceAuthService_1[_0x3543f0(0x12d)]),this[_0x3543f0(0x142)]();}async[a193_0x5f0621(0x142)](){const _0xb7f9d6=a193_0x5f0621;this[_0xb7f9d6(0x125)][_0xb7f9d6(0x10e)](_0xb7f9d6(0x137),auth_state_enum_1[_0xb7f9d6(0x110)][this[_0xb7f9d6(0x147)]]);try{if(this['authState']===auth_state_enum_1['AuthState'][_0xb7f9d6(0x119)])return;if(this[_0xb7f9d6(0x147)]===auth_state_enum_1[_0xb7f9d6(0x110)][_0xb7f9d6(0x15e)])await this[_0xb7f9d6(0x111)]();else{const _0x50da16=await this['requestConfig'](),_0x9dacfe=await axios_1['default'][_0xb7f9d6(0x14c)](_0xb7f9d6(0x120)+constants_1['SALESFORCE_API_VERSION'],_0x50da16)['then'](()=>!![])[_0xb7f9d6(0x136)](()=>![]);!_0x9dacfe&&await this[_0xb7f9d6(0x111)]();}}catch(_0x34fe49){}}async['updateAccessToken'](){const _0x47912b=a193_0x5f0621;var _0x2d3bf0,_0x421f62,_0x5487df;this['logger'][_0x47912b(0x10e)](_0x47912b(0x14a));try{this['authState']=auth_state_enum_1[_0x47912b(0x110)][_0x47912b(0x144)];const {refreshToken:_0x8305c1,clientId:_0x57b553,clientSecret:_0x467a1c,loginUrl:_0x3d0ddf}=typedi_1[_0x47912b(0x126)][_0x47912b(0x14c)](providers_tokens_1[_0x47912b(0x11a)]['salesforce']),{data:_0xadcfd8}=await axios_1[_0x47912b(0x126)][_0x47912b(0x130)]((0x0,utils_1[_0x47912b(0x124)])(_0x3d0ddf,_0x47912b(0x15b)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x8305c1,'client_id':_0x57b553,'client_secret':_0x467a1c}});this[_0x47912b(0x153)]=_0xadcfd8[_0x47912b(0x121)],this[_0x47912b(0x15d)]=_0xadcfd8['access_token'],this[_0x47912b(0x159)]=_0xadcfd8[_0x47912b(0x11e)],this['authState']=auth_state_enum_1['AuthState'][_0x47912b(0x139)],this[_0x47912b(0x125)][_0x47912b(0x10e)]('access\x20token\x20updated\x20for\x20%s',this['instanceUrl']);}catch(_0x5cfa7d){const _0x22e250=((_0x421f62=(_0x2d3bf0=_0x5cfa7d===null||_0x5cfa7d===void 0x0?void 0x0:_0x5cfa7d[_0x47912b(0x149)])===null||_0x2d3bf0===void 0x0?void 0x0:_0x2d3bf0[_0x47912b(0x132)])===null||_0x421f62===void 0x0?void 0x0:_0x421f62[_0x47912b(0x146)])||((_0x5487df=_0x5cfa7d===null||_0x5cfa7d===void 0x0?void 0x0:_0x5cfa7d[_0x47912b(0x149)])===null||_0x5487df===void 0x0?void 0x0:_0x5487df[_0x47912b(0x132)])||_0x5cfa7d[_0x47912b(0x13f)];this[_0x47912b(0x125)][_0x47912b(0x146)](_0x47912b(0x117),_0x22e250),this[_0x47912b(0x147)]=auth_state_enum_1['AuthState'][_0x47912b(0x119)];throw new invalid_refresh_token_error_1[(_0x47912b(0x122))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x2b7355=a193_0x5f0621;this[_0x2b7355(0x125)][_0x2b7355(0x10e)](_0x2b7355(0x12f));if(this[_0x2b7355(0x147)]===auth_state_enum_1[_0x2b7355(0x110)][_0x2b7355(0x144)]||this[_0x2b7355(0x147)]===auth_state_enum_1[_0x2b7355(0x110)]['Idle'])return await(0x0,utils_1['sleep'])(this[_0x2b7355(0x14f)]),this[_0x2b7355(0x12c)]();if(this['authState']===auth_state_enum_1['AuthState'][_0x2b7355(0x119)])throw new invalid_refresh_token_error_1[(_0x2b7355(0x122))](errors_1[_0x2b7355(0x162)]);await this[_0x2b7355(0x111)]();}async['waitAuth'](){const _0x3e34ae=a193_0x5f0621;if(this[_0x3e34ae(0x147)]===auth_state_enum_1[_0x3e34ae(0x110)][_0x3e34ae(0x119)]){this['logger'][_0x3e34ae(0x10e)](_0x3e34ae(0x152));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x3e34ae(0x147)]!==auth_state_enum_1[_0x3e34ae(0x110)][_0x3e34ae(0x139)])return this[_0x3e34ae(0x125)][_0x3e34ae(0x10e)](_0x3e34ae(0x135)),await(0x0,utils_1['sleep'])(this['AUTH_WAIT_TIME']),this[_0x3e34ae(0x12a)]();}[a193_0x5f0621(0x13c)](){const _0x292a76=a193_0x5f0621;return{'orgId':this[_0x292a76(0x123)],'accessToken':this[_0x292a76(0x15d)],'instanceUrl':this[_0x292a76(0x153)]};}async[a193_0x5f0621(0x15f)](){const _0x2801d0=a193_0x5f0621;return await this['waitAuth'](),{'baseURL':this[_0x2801d0(0x153)],'headers':{'accept':'application/json','authorization':this[_0x2801d0(0x159)]+'\x20'+this[_0x2801d0(0x15d)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a193_0x5f0621(0x13e),[])],SalesforceAuthService),exports[a193_0x5f0621(0x14d)]=SalesforceAuthService;function a193_0x24ab(){const _0x3d368b=['design:paramtypes','message','object','../errors/invalid-refresh-token.error','setAuthDetails','decorate','Updating','constructor','error','authState','metadata','response','update\x20access\x20token','Logger','get','SalesforceAuthService','../../../shared/utils','AUTH_WAIT_TIME','../../../../constants/errors','search','create\x20authorized\x20request\x20failed:\x20authorization\x20error','instanceUrl','27ilYAfg','../../providers/providers.tokens','243078uPoEnO','314321gqfAAx','309BtkXQl','tokenType','../../../../core','/services/oauth2/token','../enums/auth-state.enum','accessToken','Idle','requestConfig','configurable','create','ERR_INVALID_SALESFORCE_TOKEN','log','4238346oFxQZh','AuthState','updateAccessToken','__createBinding','__metadata','4888030XlwqKd','15416eHZUmb','__importDefault','update\x20access\x20token\x20failed:\x20%s','call','Error','Tokens','2594ZJxeKe','__importStar','function','token_type','length','services/data/','instance_url','InvalidRefreshTokenError','orgId','joinURL','logger','default','__esModule','prototype','5852640glrzxW','waitAuth','410LaeHXB','forceUpdateToken','name','../../../../constants','force\x20update\x20token','post','getOwnPropertyDescriptor','data','(((.+)+)+)+$','apply','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','catch','check\x20auth:\x20current\x20state\x20-\x20%s','toString','Active','defineProperty','typedi','getAuthData','writable'];a193_0x24ab=function(){return _0x3d368b;};return a193_0x24ab();}