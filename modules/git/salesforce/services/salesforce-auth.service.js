const a175_0x573fd0=a175_0x27ab;function a175_0x9c8c(){const _0x43ff7e=['SALESFORCE_API_VERSION','5ShZmEG','authState','design:paramtypes','../../../../core','Idle','../errors/invalid-refresh-token.error','access_token','__importDefault','267732zdAvGX','Error','instanceUrl','apply','refresh_token','../../providers/providers.tokens','call','UnauthorizedSalesforceError','toString','create\x20authorized\x20request\x20failed:\x20authorization\x20error','logger','1435665BtvaqC','orgId','Updating','../../../../constants/errors','tokenType','/services/oauth2/token','token_type','salesforce','message','__decorate','search','log','services/data/','__esModule','Tokens','sleep','61052exJijL','../enums/auth-state.enum','object','80IMXXEp','Logger','accessToken','Active','get','../errors/unauthorized-salesforce.error','SalesforceAuthService','updateAccessToken','typedi','waitAuth','../../../../constants','default','prototype','then','decorate','function','AuthState','constructor','error','create','532628bJWPhL','length','Service','data','setAuthDetails','752964PlodVW','122187TfXNUn','getOwnPropertyDescriptor','22QXIpni','name','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','../../../shared/utils','ERR_INVALID_SALESFORCE_TOKEN','response','forceUpdateToken','metadata','axios','defineProperty','update\x20access\x20token\x20failed:\x20%s','post','8UWAqYo','requestConfig','AUTH_WAIT_TIME','2332450uZzWxe'];a175_0x9c8c=function(){return _0x43ff7e;};return a175_0x9c8c();}(function(_0x570ebe,_0x1edf6d){const _0x826e64=a175_0x27ab,_0x230470=_0x570ebe();while(!![]){try{const _0x1d0ef2=-parseInt(_0x826e64(0x1ca))/0x1*(-parseInt(_0x826e64(0x1f2))/0x2)+parseInt(_0x826e64(0x20f))/0x3+parseInt(_0x826e64(0x209))/0x4*(parseInt(_0x826e64(0x1cf))/0x5)+parseInt(_0x826e64(0x20e))/0x6+-parseInt(_0x826e64(0x1e2))/0x7+parseInt(_0x826e64(0x1f5))/0x8*(parseInt(_0x826e64(0x1d7))/0x9)+-parseInt(_0x826e64(0x1cd))/0xa*(parseInt(_0x826e64(0x211))/0xb);if(_0x1d0ef2===_0x1edf6d)break;else _0x230470['push'](_0x230470['shift']());}catch(_0x38f288){_0x230470['push'](_0x230470['shift']());}}}(a175_0x9c8c,0x2960b));const a175_0x308a84=(function(){let _0x1ad7fc=!![];return function(_0x4325d9,_0x324b1b){const _0x322ed4=_0x1ad7fc?function(){const _0x5a5dbd=a175_0x27ab;if(_0x324b1b){const _0x1bd886=_0x324b1b[_0x5a5dbd(0x1da)](_0x4325d9,arguments);return _0x324b1b=null,_0x1bd886;}}:function(){};return _0x1ad7fc=![],_0x322ed4;};}()),a175_0x57e585=a175_0x308a84(this,function(){const _0x3568e0=a175_0x27ab;return a175_0x57e585[_0x3568e0(0x1df)]()[_0x3568e0(0x1ec)]('(((.+)+)+)+$')['toString']()[_0x3568e0(0x206)](a175_0x57e585)[_0x3568e0(0x1ec)]('(((.+)+)+)+$');});a175_0x57e585();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a175_0x573fd0(0x208)]?function(_0xc65812,_0x171db2,_0x11ad8d,_0x1819d5){if(_0x1819d5===undefined)_0x1819d5=_0x11ad8d;Object['defineProperty'](_0xc65812,_0x1819d5,{'enumerable':!![],'get':function(){return _0x171db2[_0x11ad8d];}});}:function(_0x4ea6e5,_0x537349,_0x222047,_0x43b0ba){if(_0x43b0ba===undefined)_0x43b0ba=_0x222047;_0x4ea6e5[_0x43b0ba]=_0x537349[_0x222047];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a175_0x573fd0(0x208)]?function(_0x1c94af,_0x54f96f){const _0x29da35=a175_0x573fd0;Object[_0x29da35(0x1c7)](_0x1c94af,_0x29da35(0x200),{'enumerable':!![],'value':_0x54f96f});}:function(_0x2006bb,_0x2f6725){const _0x56dcd6=a175_0x573fd0;_0x2006bb[_0x56dcd6(0x200)]=_0x2f6725;}),__decorate=this&&this[a175_0x573fd0(0x1eb)]||function(_0x709cf,_0x199a5f,_0x5f5af2,_0x36bab5){const _0x546ed9=a175_0x573fd0;var _0x3dd52e=arguments[_0x546ed9(0x20a)],_0x1da4c8=_0x3dd52e<0x3?_0x199a5f:_0x36bab5===null?_0x36bab5=Object[_0x546ed9(0x210)](_0x199a5f,_0x5f5af2):_0x36bab5,_0x3941f7;if(typeof Reflect===_0x546ed9(0x1f4)&&typeof Reflect[_0x546ed9(0x203)]===_0x546ed9(0x204))_0x1da4c8=Reflect[_0x546ed9(0x203)](_0x709cf,_0x199a5f,_0x5f5af2,_0x36bab5);else{for(var _0x46ff97=_0x709cf[_0x546ed9(0x20a)]-0x1;_0x46ff97>=0x0;_0x46ff97--)if(_0x3941f7=_0x709cf[_0x46ff97])_0x1da4c8=(_0x3dd52e<0x3?_0x3941f7(_0x1da4c8):_0x3dd52e>0x3?_0x3941f7(_0x199a5f,_0x5f5af2,_0x1da4c8):_0x3941f7(_0x199a5f,_0x5f5af2))||_0x1da4c8;}return _0x3dd52e>0x3&&_0x1da4c8&&Object[_0x546ed9(0x1c7)](_0x199a5f,_0x5f5af2,_0x1da4c8),_0x1da4c8;},__importStar=this&&this['__importStar']||function(_0x49d48b){const _0x21bb71=a175_0x573fd0;if(_0x49d48b&&_0x49d48b[_0x21bb71(0x1ef)])return _0x49d48b;var _0x52b186={};if(_0x49d48b!=null){for(var _0x1106f2 in _0x49d48b)if(_0x1106f2!==_0x21bb71(0x200)&&Object[_0x21bb71(0x201)]['hasOwnProperty'][_0x21bb71(0x1dd)](_0x49d48b,_0x1106f2))__createBinding(_0x52b186,_0x49d48b,_0x1106f2);}return __setModuleDefault(_0x52b186,_0x49d48b),_0x52b186;},__metadata=this&&this['__metadata']||function(_0x3a40e5,_0x28605d){const _0x4b0119=a175_0x573fd0;if(typeof Reflect===_0x4b0119(0x1f4)&&typeof Reflect[_0x4b0119(0x1c5)]===_0x4b0119(0x204))return Reflect['metadata'](_0x3a40e5,_0x28605d);},__importDefault=this&&this[a175_0x573fd0(0x1d6)]||function(_0x4d6563){const _0xc43edd=a175_0x573fd0;return _0x4d6563&&_0x4d6563[_0xc43edd(0x1ef)]?_0x4d6563:{'default':_0x4d6563};},SalesforceAuthService_1;Object[a175_0x573fd0(0x1c7)](exports,'__esModule',{'value':!![]}),exports[a175_0x573fd0(0x1fb)]=void 0x0;function a175_0x27ab(_0x4f11db,_0x3fb05e){const _0x5563fc=a175_0x9c8c();return a175_0x27ab=function(_0x57e585,_0x308a84){_0x57e585=_0x57e585-0x1bf;let _0x9c8c65=_0x5563fc[_0x57e585];return _0x9c8c65;},a175_0x27ab(_0x4f11db,_0x3fb05e);}const typedi_1=__importStar(require(a175_0x573fd0(0x1fd))),errors_1=require(a175_0x573fd0(0x1e5)),core_1=require(a175_0x573fd0(0x1d2)),axios_1=__importDefault(require(a175_0x573fd0(0x1c6))),utils_1=require(a175_0x573fd0(0x1c1)),invalid_refresh_token_error_1=require(a175_0x573fd0(0x1d4)),auth_state_enum_1=require(a175_0x573fd0(0x1f3)),unauthorized_salesforce_error_1=require(a175_0x573fd0(0x1fa)),constants_1=require(a175_0x573fd0(0x1ff)),providers_tokens_1=require(a175_0x573fd0(0x1dc));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x4c9317=a175_0x573fd0;this[_0x4c9317(0x1cc)]=0x1388,this[_0x4c9317(0x1d0)]=auth_state_enum_1['AuthState'][_0x4c9317(0x1d3)],this[_0x4c9317(0x1e1)]=new core_1[(_0x4c9317(0x1f6))](SalesforceAuthService_1[_0x4c9317(0x1bf)]),this[_0x4c9317(0x20d)]();}async[a175_0x573fd0(0x20d)](){const _0x52dad4=a175_0x573fd0;this[_0x52dad4(0x1e1)][_0x52dad4(0x1ed)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x52dad4(0x205)][this['authState']]);try{if(this[_0x52dad4(0x1d0)]===auth_state_enum_1[_0x52dad4(0x205)]['Error'])return;if(this[_0x52dad4(0x1d0)]===auth_state_enum_1[_0x52dad4(0x205)]['Idle'])await this[_0x52dad4(0x1fc)]();else{const _0x4b1023=await this[_0x52dad4(0x1cb)](),_0x2adec5=await axios_1[_0x52dad4(0x200)][_0x52dad4(0x1f9)](_0x52dad4(0x1ee)+constants_1[_0x52dad4(0x1ce)],_0x4b1023)[_0x52dad4(0x202)](()=>!![])['catch'](()=>![]);!_0x2adec5&&await this[_0x52dad4(0x1fc)]();}}catch(_0x5294e5){}}async[a175_0x573fd0(0x1fc)](){const _0x474eff=a175_0x573fd0;var _0x567753,_0x3dcd6b,_0x303436;this[_0x474eff(0x1e1)][_0x474eff(0x1ed)]('update\x20access\x20token');try{this[_0x474eff(0x1d0)]=auth_state_enum_1[_0x474eff(0x205)][_0x474eff(0x1e4)];const {refreshToken:_0x6dda32,clientId:_0x545eca,clientSecret:_0x22edd5,loginUrl:_0x406149}=typedi_1[_0x474eff(0x200)][_0x474eff(0x1f9)](providers_tokens_1[_0x474eff(0x1f0)][_0x474eff(0x1e9)]),{data:_0xc8fcd9}=await axios_1[_0x474eff(0x200)][_0x474eff(0x1c9)](utils_1['joinURL'](_0x406149,_0x474eff(0x1e7)),null,{'params':{'grant_type':_0x474eff(0x1db),'refresh_token':_0x6dda32,'client_id':_0x545eca,'client_secret':_0x22edd5}});this[_0x474eff(0x1d9)]=_0xc8fcd9['instance_url'],this[_0x474eff(0x1f7)]=_0xc8fcd9[_0x474eff(0x1d5)],this['tokenType']=_0xc8fcd9[_0x474eff(0x1e8)],this[_0x474eff(0x1d0)]=auth_state_enum_1[_0x474eff(0x205)][_0x474eff(0x1f8)],this[_0x474eff(0x1e1)]['log']('access\x20token\x20updated\x20for\x20%s',this[_0x474eff(0x1d9)]);}catch(_0x57c321){const _0x513aaf=((_0x3dcd6b=(_0x567753=_0x57c321===null||_0x57c321===void 0x0?void 0x0:_0x57c321['response'])===null||_0x567753===void 0x0?void 0x0:_0x567753['data'])===null||_0x3dcd6b===void 0x0?void 0x0:_0x3dcd6b[_0x474eff(0x207)])||((_0x303436=_0x57c321===null||_0x57c321===void 0x0?void 0x0:_0x57c321[_0x474eff(0x1c3)])===null||_0x303436===void 0x0?void 0x0:_0x303436[_0x474eff(0x20c)])||_0x57c321[_0x474eff(0x1ea)];this[_0x474eff(0x1e1)][_0x474eff(0x207)](_0x474eff(0x1c8),_0x513aaf),this[_0x474eff(0x1d0)]=auth_state_enum_1[_0x474eff(0x205)][_0x474eff(0x1d8)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x474eff(0x1c2)]);}}async['forceUpdateToken'](){const _0x1c3c71=a175_0x573fd0;this[_0x1c3c71(0x1e1)][_0x1c3c71(0x1ed)]('force\x20update\x20token');if(this[_0x1c3c71(0x1d0)]===auth_state_enum_1[_0x1c3c71(0x205)][_0x1c3c71(0x1e4)]||this[_0x1c3c71(0x1d0)]===auth_state_enum_1[_0x1c3c71(0x205)][_0x1c3c71(0x1d3)])return await utils_1[_0x1c3c71(0x1f1)](this[_0x1c3c71(0x1cc)]),this[_0x1c3c71(0x1c4)]();if(this[_0x1c3c71(0x1d0)]===auth_state_enum_1['AuthState'][_0x1c3c71(0x1d8)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x1c3c71(0x1c2)]);await this[_0x1c3c71(0x1fc)]();}async['waitAuth'](){const _0x3c9d4a=a175_0x573fd0;if(this[_0x3c9d4a(0x1d0)]===auth_state_enum_1[_0x3c9d4a(0x205)]['Error']){this[_0x3c9d4a(0x1e1)][_0x3c9d4a(0x1ed)](_0x3c9d4a(0x1e0));throw new unauthorized_salesforce_error_1[(_0x3c9d4a(0x1de))]();}if(this[_0x3c9d4a(0x1d0)]!==auth_state_enum_1['AuthState'][_0x3c9d4a(0x1f8)])return this['logger']['log'](_0x3c9d4a(0x1c0)),await utils_1[_0x3c9d4a(0x1f1)](this['AUTH_WAIT_TIME']),this['waitAuth']();}['getAuthData'](){const _0x3f72b5=a175_0x573fd0;return{'orgId':this[_0x3f72b5(0x1e3)],'accessToken':this[_0x3f72b5(0x1f7)],'instanceUrl':this[_0x3f72b5(0x1d9)]};}async[a175_0x573fd0(0x1cb)](){const _0x126e33=a175_0x573fd0;return await this[_0x126e33(0x1fe)](),{'baseURL':this[_0x126e33(0x1d9)],'headers':{'accept':'application/json','authorization':this[_0x126e33(0x1e6)]+'\x20'+this[_0x126e33(0x1f7)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a175_0x573fd0(0x20b)](),__metadata(a175_0x573fd0(0x1d1),[])],SalesforceAuthService),exports[a175_0x573fd0(0x1fb)]=SalesforceAuthService;