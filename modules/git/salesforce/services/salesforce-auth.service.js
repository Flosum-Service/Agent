const a232_0x5c7f06=a232_0xbf14;(function(_0x20ea7e,_0x359b4b){const _0x50ee64=a232_0xbf14,_0x2588e6=_0x20ea7e();while(!![]){try{const _0x14ddd6=parseInt(_0x50ee64(0x18a))/0x1+-parseInt(_0x50ee64(0x1a3))/0x2+parseInt(_0x50ee64(0x17a))/0x3*(parseInt(_0x50ee64(0x188))/0x4)+-parseInt(_0x50ee64(0x1ae))/0x5*(parseInt(_0x50ee64(0x186))/0x6)+-parseInt(_0x50ee64(0x1b3))/0x7+parseInt(_0x50ee64(0x1b8))/0x8*(-parseInt(_0x50ee64(0x16c))/0x9)+-parseInt(_0x50ee64(0x19a))/0xa*(-parseInt(_0x50ee64(0x195))/0xb);if(_0x14ddd6===_0x359b4b)break;else _0x2588e6['push'](_0x2588e6['shift']());}catch(_0x535507){_0x2588e6['push'](_0x2588e6['shift']());}}}(a232_0x4205,0xe5f6f));function a232_0xbf14(_0x5ed7a8,_0x3e570b){const _0x564c53=a232_0x4205();return a232_0xbf14=function(_0xa04cb4,_0x2b50b1){_0xa04cb4=_0xa04cb4-0x168;let _0x420500=_0x564c53[_0xa04cb4];return _0x420500;},a232_0xbf14(_0x5ed7a8,_0x3e570b);}const a232_0x2b50b1=(function(){let _0x54c377=!![];return function(_0x2016ef,_0x5a8f62){const _0xd894f1=_0x54c377?function(){const _0x5a484b=a232_0xbf14;if(_0x5a8f62){const _0x1ba589=_0x5a8f62[_0x5a484b(0x1ac)](_0x2016ef,arguments);return _0x5a8f62=null,_0x1ba589;}}:function(){};return _0x54c377=![],_0xd894f1;};}()),a232_0xa04cb4=a232_0x2b50b1(this,function(){const _0x368dd3=a232_0xbf14;return a232_0xa04cb4['toString']()[_0x368dd3(0x171)](_0x368dd3(0x1bb))[_0x368dd3(0x1b6)]()[_0x368dd3(0x16b)](a232_0xa04cb4)['search'](_0x368dd3(0x1bb));});a232_0xa04cb4();'use strict';var __createBinding=this&&this[a232_0x5c7f06(0x19f)]||(Object['create']?function(_0xdd4a37,_0x4a3eab,_0x1e8ab6,_0x39f94d){const _0x1d0cf2=a232_0x5c7f06;if(_0x39f94d===undefined)_0x39f94d=_0x1e8ab6;var _0x1f86c1=Object[_0x1d0cf2(0x18d)](_0x4a3eab,_0x1e8ab6);(!_0x1f86c1||(_0x1d0cf2(0x17f)in _0x1f86c1?!_0x4a3eab[_0x1d0cf2(0x197)]:_0x1f86c1[_0x1d0cf2(0x179)]||_0x1f86c1['configurable']))&&(_0x1f86c1={'enumerable':!![],'get':function(){return _0x4a3eab[_0x1e8ab6];}}),Object[_0x1d0cf2(0x1b7)](_0xdd4a37,_0x39f94d,_0x1f86c1);}:function(_0x29feda,_0x3c1d98,_0x3d3cfa,_0x27a7ab){if(_0x27a7ab===undefined)_0x27a7ab=_0x3d3cfa;_0x29feda[_0x27a7ab]=_0x3c1d98[_0x3d3cfa];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a232_0x5c7f06(0x181)]?function(_0x39222c,_0x470f6e){const _0x371927=a232_0x5c7f06;Object['defineProperty'](_0x39222c,_0x371927(0x184),{'enumerable':!![],'value':_0x470f6e});}:function(_0x3b9360,_0x290410){const _0x404aa6=a232_0x5c7f06;_0x3b9360[_0x404aa6(0x184)]=_0x290410;}),__decorate=this&&this[a232_0x5c7f06(0x1bc)]||function(_0x131917,_0x40c096,_0x5df386,_0x1fc1c7){const _0x534c46=a232_0x5c7f06;var _0x2a2973=arguments[_0x534c46(0x19d)],_0xf18cb8=_0x2a2973<0x3?_0x40c096:_0x1fc1c7===null?_0x1fc1c7=Object['getOwnPropertyDescriptor'](_0x40c096,_0x5df386):_0x1fc1c7,_0x4a314f;if(typeof Reflect===_0x534c46(0x1b4)&&typeof Reflect[_0x534c46(0x1a0)]===_0x534c46(0x17d))_0xf18cb8=Reflect[_0x534c46(0x1a0)](_0x131917,_0x40c096,_0x5df386,_0x1fc1c7);else{for(var _0x4fe26b=_0x131917[_0x534c46(0x19d)]-0x1;_0x4fe26b>=0x0;_0x4fe26b--)if(_0x4a314f=_0x131917[_0x4fe26b])_0xf18cb8=(_0x2a2973<0x3?_0x4a314f(_0xf18cb8):_0x2a2973>0x3?_0x4a314f(_0x40c096,_0x5df386,_0xf18cb8):_0x4a314f(_0x40c096,_0x5df386))||_0xf18cb8;}return _0x2a2973>0x3&&_0xf18cb8&&Object[_0x534c46(0x1b7)](_0x40c096,_0x5df386,_0xf18cb8),_0xf18cb8;},__importStar=this&&this[a232_0x5c7f06(0x1a8)]||function(_0x464da6){const _0x4508e6=a232_0x5c7f06;if(_0x464da6&&_0x464da6['__esModule'])return _0x464da6;var _0x3b41f8={};if(_0x464da6!=null){for(var _0x573f0c in _0x464da6)if(_0x573f0c!=='default'&&Object[_0x4508e6(0x185)][_0x4508e6(0x1b9)]['call'](_0x464da6,_0x573f0c))__createBinding(_0x3b41f8,_0x464da6,_0x573f0c);}return __setModuleDefault(_0x3b41f8,_0x464da6),_0x3b41f8;},__metadata=this&&this[a232_0x5c7f06(0x187)]||function(_0x26373e,_0x209bee){const _0x227925=a232_0x5c7f06;if(typeof Reflect===_0x227925(0x1b4)&&typeof Reflect[_0x227925(0x190)]===_0x227925(0x17d))return Reflect[_0x227925(0x190)](_0x26373e,_0x209bee);},__importDefault=this&&this[a232_0x5c7f06(0x1a7)]||function(_0xe198ef){const _0x931134=a232_0x5c7f06;return _0xe198ef&&_0xe198ef[_0x931134(0x197)]?_0xe198ef:{'default':_0xe198ef};},SalesforceAuthService_1;Object[a232_0x5c7f06(0x1b7)](exports,a232_0x5c7f06(0x197),{'value':!![]}),exports[a232_0x5c7f06(0x18f)]=void 0x0;const typedi_1=__importStar(require('typedi')),errors_1=require(a232_0x5c7f06(0x191)),core_1=require(a232_0x5c7f06(0x19e)),axios_1=__importDefault(require(a232_0x5c7f06(0x1af))),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a232_0x5c7f06(0x180)),auth_state_enum_1=require(a232_0x5c7f06(0x16a)),unauthorized_salesforce_error_1=require(a232_0x5c7f06(0x1b5)),constants_1=require(a232_0x5c7f06(0x182)),providers_tokens_1=require('../../providers/providers.tokens');function a232_0x4205(){const _0x3a70b4=['function','catch','get','../errors/invalid-refresh-token.error','create','../../../../constants','Tokens','default','prototype','497262mLocLN','__metadata','13820tPpPAd','instanceUrl','472282aQxJsZ','Service','design:paramtypes','getOwnPropertyDescriptor','access_token','SalesforceAuthService','metadata','../../../../constants/errors','services/data/','requestConfig','Idle','11ZKFvYS','salesforce','__esModule','Active','InvalidRefreshTokenError','47555590IbzzoB','data','Logger','length','../../../../core','__createBinding','decorate','joinURL','check\x20auth:\x20current\x20state\x20-\x20%s','3583692kBTRqP','application/json','orgId','then','__importDefault','__importStar','AUTH_WAIT_TIME','Error','accessToken','apply','create\x20authorized\x20request\x20failed:\x20authorization\x20error','105gGDejZ','axios','token_type','authState','forceUpdateToken','1513127MULhot','object','../errors/unauthorized-salesforce.error','toString','defineProperty','472yrIalw','hasOwnProperty','setAuthDetails','(((.+)+)+)+$','__decorate','updateAccessToken','logger','sleep','post','../enums/auth-state.enum','constructor','256437tqWVUe','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','refresh_token','update\x20access\x20token\x20failed:\x20%s','force\x20update\x20token','search','Updating','tokenType','error','SALESFORCE_API_VERSION','AuthState','update\x20access\x20token','ERR_INVALID_SALESFORCE_TOKEN','writable','993ABdwsC','waitAuth','log'];a232_0x4205=function(){return _0x3a70b4;};return a232_0x4205();}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x124cb5=a232_0x5c7f06;this[_0x124cb5(0x1a9)]=0x1388,this[_0x124cb5(0x1b1)]=auth_state_enum_1[_0x124cb5(0x176)][_0x124cb5(0x194)],this[_0x124cb5(0x1be)]=new core_1[(_0x124cb5(0x19c))](SalesforceAuthService_1['name']),this['setAuthDetails']();}async[a232_0x5c7f06(0x1ba)](){const _0x4788e0=a232_0x5c7f06;this[_0x4788e0(0x1be)][_0x4788e0(0x17c)](_0x4788e0(0x1a2),auth_state_enum_1['AuthState'][this[_0x4788e0(0x1b1)]]);try{if(this[_0x4788e0(0x1b1)]===auth_state_enum_1[_0x4788e0(0x176)][_0x4788e0(0x1aa)])return;if(this['authState']===auth_state_enum_1['AuthState'][_0x4788e0(0x194)])await this[_0x4788e0(0x1bd)]();else{const _0x20c30a=await this[_0x4788e0(0x193)](),_0x3b821c=await axios_1[_0x4788e0(0x184)][_0x4788e0(0x17f)](_0x4788e0(0x192)+constants_1[_0x4788e0(0x175)],_0x20c30a)[_0x4788e0(0x1a6)](()=>!![])[_0x4788e0(0x17e)](()=>![]);!_0x3b821c&&await this[_0x4788e0(0x1bd)]();}}catch(_0x1d46ea){}}async[a232_0x5c7f06(0x1bd)](){const _0x8a1da=a232_0x5c7f06;var _0x4c50ff,_0xdfa642,_0x2a378e;this[_0x8a1da(0x1be)][_0x8a1da(0x17c)](_0x8a1da(0x177));try{this[_0x8a1da(0x1b1)]=auth_state_enum_1[_0x8a1da(0x176)]['Updating'];const {refreshToken:_0x4c311a,clientId:_0x34c9fb,clientSecret:_0xfc8e7d,loginUrl:_0x4e14bc}=typedi_1[_0x8a1da(0x184)]['get'](providers_tokens_1[_0x8a1da(0x183)][_0x8a1da(0x196)]),{data:_0x4227b6}=await axios_1['default'][_0x8a1da(0x169)]((0x0,utils_1[_0x8a1da(0x1a1)])(_0x4e14bc,'/services/oauth2/token'),null,{'params':{'grant_type':_0x8a1da(0x16e),'refresh_token':_0x4c311a,'client_id':_0x34c9fb,'client_secret':_0xfc8e7d}});this[_0x8a1da(0x189)]=_0x4227b6['instance_url'],this[_0x8a1da(0x1ab)]=_0x4227b6[_0x8a1da(0x18e)],this[_0x8a1da(0x173)]=_0x4227b6[_0x8a1da(0x1b0)],this[_0x8a1da(0x1b1)]=auth_state_enum_1[_0x8a1da(0x176)][_0x8a1da(0x198)],this[_0x8a1da(0x1be)][_0x8a1da(0x17c)]('access\x20token\x20updated\x20for\x20%s',this[_0x8a1da(0x189)]);}catch(_0x59a711){const _0x44bca7=((_0xdfa642=(_0x4c50ff=_0x59a711===null||_0x59a711===void 0x0?void 0x0:_0x59a711['response'])===null||_0x4c50ff===void 0x0?void 0x0:_0x4c50ff[_0x8a1da(0x19b)])===null||_0xdfa642===void 0x0?void 0x0:_0xdfa642[_0x8a1da(0x174)])||((_0x2a378e=_0x59a711===null||_0x59a711===void 0x0?void 0x0:_0x59a711['response'])===null||_0x2a378e===void 0x0?void 0x0:_0x2a378e[_0x8a1da(0x19b)])||_0x59a711['message'];this[_0x8a1da(0x1be)]['error'](_0x8a1da(0x16f),_0x44bca7),this['authState']=auth_state_enum_1[_0x8a1da(0x176)][_0x8a1da(0x1aa)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x8a1da(0x178)]);}}async['forceUpdateToken'](){const _0xc4cd4c=a232_0x5c7f06;this['logger'][_0xc4cd4c(0x17c)](_0xc4cd4c(0x170));if(this[_0xc4cd4c(0x1b1)]===auth_state_enum_1[_0xc4cd4c(0x176)][_0xc4cd4c(0x172)]||this[_0xc4cd4c(0x1b1)]===auth_state_enum_1['AuthState'][_0xc4cd4c(0x194)])return await(0x0,utils_1[_0xc4cd4c(0x168)])(this[_0xc4cd4c(0x1a9)]),this[_0xc4cd4c(0x1b2)]();if(this[_0xc4cd4c(0x1b1)]===auth_state_enum_1[_0xc4cd4c(0x176)][_0xc4cd4c(0x1aa)])throw new invalid_refresh_token_error_1[(_0xc4cd4c(0x199))](errors_1[_0xc4cd4c(0x178)]);await this['updateAccessToken']();}async['waitAuth'](){const _0x266b78=a232_0x5c7f06;if(this[_0x266b78(0x1b1)]===auth_state_enum_1['AuthState']['Error']){this['logger'][_0x266b78(0x17c)](_0x266b78(0x1ad));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x266b78(0x1b1)]!==auth_state_enum_1[_0x266b78(0x176)][_0x266b78(0x198)])return this['logger'][_0x266b78(0x17c)](_0x266b78(0x16d)),await(0x0,utils_1[_0x266b78(0x168)])(this[_0x266b78(0x1a9)]),this['waitAuth']();}['getAuthData'](){const _0x565d76=a232_0x5c7f06;return{'orgId':this[_0x565d76(0x1a5)],'accessToken':this[_0x565d76(0x1ab)],'instanceUrl':this[_0x565d76(0x189)]};}async[a232_0x5c7f06(0x193)](){const _0x5edc21=a232_0x5c7f06;return await this[_0x5edc21(0x17b)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x5edc21(0x1a4),'authorization':this[_0x5edc21(0x173)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a232_0x5c7f06(0x18b)])(),__metadata(a232_0x5c7f06(0x18c),[])],SalesforceAuthService),exports[a232_0x5c7f06(0x18f)]=SalesforceAuthService;