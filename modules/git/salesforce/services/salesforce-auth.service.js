const a194_0x1a2818=a194_0x446f;(function(_0x1dc62c,_0x20e0ae){const _0x29b883=a194_0x446f,_0x476b54=_0x1dc62c();while(!![]){try{const _0x4568e8=-parseInt(_0x29b883(0x238))/0x1+parseInt(_0x29b883(0x1f7))/0x2*(-parseInt(_0x29b883(0x242))/0x3)+-parseInt(_0x29b883(0x22d))/0x4+parseInt(_0x29b883(0x241))/0x5+-parseInt(_0x29b883(0x22a))/0x6+parseInt(_0x29b883(0x22e))/0x7*(-parseInt(_0x29b883(0x236))/0x8)+parseInt(_0x29b883(0x233))/0x9;if(_0x4568e8===_0x20e0ae)break;else _0x476b54['push'](_0x476b54['shift']());}catch(_0x468af5){_0x476b54['push'](_0x476b54['shift']());}}}(a194_0x4dbd,0xcd9c3));function a194_0x446f(_0x2a43dc,_0x540261){const _0x19ab0c=a194_0x4dbd();return a194_0x446f=function(_0x5b4b04,_0x1e964b){_0x5b4b04=_0x5b4b04-0x1f3;let _0x4dbd03=_0x19ab0c[_0x5b4b04];return _0x4dbd03;},a194_0x446f(_0x2a43dc,_0x540261);}const a194_0x1e964b=(function(){let _0x4392c2=!![];return function(_0x34d828,_0x71a4fc){const _0x38f251=_0x4392c2?function(){if(_0x71a4fc){const _0x5e2548=_0x71a4fc['apply'](_0x34d828,arguments);return _0x71a4fc=null,_0x5e2548;}}:function(){};return _0x4392c2=![],_0x38f251;};}()),a194_0x5b4b04=a194_0x1e964b(this,function(){const _0x34862e=a194_0x446f;return a194_0x5b4b04[_0x34862e(0x1f4)]()[_0x34862e(0x1ff)](_0x34862e(0x200))[_0x34862e(0x1f4)]()[_0x34862e(0x21b)](a194_0x5b4b04)['search'](_0x34862e(0x200));});a194_0x5b4b04();'use strict';var __createBinding=this&&this[a194_0x1a2818(0x204)]||(Object[a194_0x1a2818(0x1f5)]?function(_0x522642,_0x6db0a2,_0x1ef86c,_0x46261b){const _0x5ac4ef=a194_0x1a2818;if(_0x46261b===undefined)_0x46261b=_0x1ef86c;var _0x183499=Object[_0x5ac4ef(0x23b)](_0x6db0a2,_0x1ef86c);(!_0x183499||(_0x5ac4ef(0x239)in _0x183499?!_0x6db0a2[_0x5ac4ef(0x247)]:_0x183499[_0x5ac4ef(0x1f9)]||_0x183499[_0x5ac4ef(0x210)]))&&(_0x183499={'enumerable':!![],'get':function(){return _0x6db0a2[_0x1ef86c];}}),Object[_0x5ac4ef(0x1fe)](_0x522642,_0x46261b,_0x183499);}:function(_0xe12654,_0x35ec89,_0x451b5d,_0x3e7a1c){if(_0x3e7a1c===undefined)_0x3e7a1c=_0x451b5d;_0xe12654[_0x3e7a1c]=_0x35ec89[_0x451b5d];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a194_0x1a2818(0x1f5)]?function(_0x1feceb,_0x3a2dfd){const _0x2986f9=a194_0x1a2818;Object[_0x2986f9(0x1fe)](_0x1feceb,'default',{'enumerable':!![],'value':_0x3a2dfd});}:function(_0x515bc9,_0x3e128b){const _0x546675=a194_0x1a2818;_0x515bc9[_0x546675(0x24a)]=_0x3e128b;}),__decorate=this&&this[a194_0x1a2818(0x219)]||function(_0x28e8ba,_0x1a2173,_0x44eb92,_0xcc245c){const _0x82a68f=a194_0x1a2818;var _0x511858=arguments['length'],_0x543d38=_0x511858<0x3?_0x1a2173:_0xcc245c===null?_0xcc245c=Object[_0x82a68f(0x23b)](_0x1a2173,_0x44eb92):_0xcc245c,_0x5a521f;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x82a68f(0x203))_0x543d38=Reflect['decorate'](_0x28e8ba,_0x1a2173,_0x44eb92,_0xcc245c);else{for(var _0x1b29a4=_0x28e8ba['length']-0x1;_0x1b29a4>=0x0;_0x1b29a4--)if(_0x5a521f=_0x28e8ba[_0x1b29a4])_0x543d38=(_0x511858<0x3?_0x5a521f(_0x543d38):_0x511858>0x3?_0x5a521f(_0x1a2173,_0x44eb92,_0x543d38):_0x5a521f(_0x1a2173,_0x44eb92))||_0x543d38;}return _0x511858>0x3&&_0x543d38&&Object[_0x82a68f(0x1fe)](_0x1a2173,_0x44eb92,_0x543d38),_0x543d38;},__importStar=this&&this[a194_0x1a2818(0x240)]||function(_0x34325b){const _0x35c100=a194_0x1a2818;if(_0x34325b&&_0x34325b[_0x35c100(0x247)])return _0x34325b;var _0x2293cb={};if(_0x34325b!=null){for(var _0x172be0 in _0x34325b)if(_0x172be0!=='default'&&Object[_0x35c100(0x212)][_0x35c100(0x20f)][_0x35c100(0x214)](_0x34325b,_0x172be0))__createBinding(_0x2293cb,_0x34325b,_0x172be0);}return __setModuleDefault(_0x2293cb,_0x34325b),_0x2293cb;},__metadata=this&&this[a194_0x1a2818(0x221)]||function(_0x91969a,_0x1d709f){const _0x519bfb=a194_0x1a2818;if(typeof Reflect===_0x519bfb(0x224)&&typeof Reflect[_0x519bfb(0x229)]===_0x519bfb(0x203))return Reflect[_0x519bfb(0x229)](_0x91969a,_0x1d709f);},__importDefault=this&&this['__importDefault']||function(_0x24c71c){return _0x24c71c&&_0x24c71c['__esModule']?_0x24c71c:{'default':_0x24c71c};},SalesforceAuthService_1;Object[a194_0x1a2818(0x1fe)](exports,a194_0x1a2818(0x247),{'value':!![]}),exports[a194_0x1a2818(0x208)]=void 0x0;const typedi_1=__importStar(require(a194_0x1a2818(0x21e))),errors_1=require(a194_0x1a2818(0x227)),core_1=require(a194_0x1a2818(0x1f6)),axios_1=__importDefault(require(a194_0x1a2818(0x248))),utils_1=require(a194_0x1a2818(0x216)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a194_0x1a2818(0x20e)),unauthorized_salesforce_error_1=require(a194_0x1a2818(0x245)),constants_1=require(a194_0x1a2818(0x23a)),providers_tokens_1=require(a194_0x1a2818(0x228));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x339e34=a194_0x1a2818;this[_0x339e34(0x20a)]=0x1388,this[_0x339e34(0x218)]=auth_state_enum_1[_0x339e34(0x246)][_0x339e34(0x22b)],this['logger']=new core_1[(_0x339e34(0x21a))](SalesforceAuthService_1['name']),this[_0x339e34(0x23c)]();}async[a194_0x1a2818(0x23c)](){const _0x5d4398=a194_0x1a2818;this[_0x5d4398(0x1f8)][_0x5d4398(0x21d)](_0x5d4398(0x215),auth_state_enum_1[_0x5d4398(0x246)][this[_0x5d4398(0x218)]]);try{if(this[_0x5d4398(0x218)]===auth_state_enum_1[_0x5d4398(0x246)][_0x5d4398(0x20b)])return;if(this[_0x5d4398(0x218)]===auth_state_enum_1[_0x5d4398(0x246)]['Idle'])await this[_0x5d4398(0x234)]();else{const _0x2eb049=await this['requestConfig'](),_0x3e7cac=await axios_1['default']['get'](_0x5d4398(0x1fc)+constants_1[_0x5d4398(0x237)],_0x2eb049)[_0x5d4398(0x22f)](()=>!![])[_0x5d4398(0x217)](()=>![]);!_0x3e7cac&&await this['updateAccessToken']();}}catch(_0x1fab7e){}}async[a194_0x1a2818(0x234)](){const _0x30f918=a194_0x1a2818;var _0x7395b1,_0x5c2e63,_0x1c3031;this[_0x30f918(0x1f8)][_0x30f918(0x21d)](_0x30f918(0x232));try{this[_0x30f918(0x218)]=auth_state_enum_1[_0x30f918(0x246)]['Updating'];const {refreshToken:_0x3c7cc2,clientId:_0x4bcb2a,clientSecret:_0x7f8240,loginUrl:_0x483072}=typedi_1[_0x30f918(0x24a)]['get'](providers_tokens_1[_0x30f918(0x207)][_0x30f918(0x1f3)]),{data:_0x2b56e7}=await axios_1[_0x30f918(0x24a)][_0x30f918(0x23e)]((0x0,utils_1[_0x30f918(0x22c)])(_0x483072,_0x30f918(0x211)),null,{'params':{'grant_type':_0x30f918(0x235),'refresh_token':_0x3c7cc2,'client_id':_0x4bcb2a,'client_secret':_0x7f8240}});this['instanceUrl']=_0x2b56e7[_0x30f918(0x244)],this[_0x30f918(0x209)]=_0x2b56e7['access_token'],this['tokenType']=_0x2b56e7[_0x30f918(0x213)],this[_0x30f918(0x218)]=auth_state_enum_1[_0x30f918(0x246)][_0x30f918(0x230)],this[_0x30f918(0x1f8)][_0x30f918(0x21d)](_0x30f918(0x1fa),this[_0x30f918(0x231)]);}catch(_0x503413){const _0x1e0c4e=((_0x5c2e63=(_0x7395b1=_0x503413===null||_0x503413===void 0x0?void 0x0:_0x503413['response'])===null||_0x7395b1===void 0x0?void 0x0:_0x7395b1['data'])===null||_0x5c2e63===void 0x0?void 0x0:_0x5c2e63[_0x30f918(0x21c)])||((_0x1c3031=_0x503413===null||_0x503413===void 0x0?void 0x0:_0x503413['response'])===null||_0x1c3031===void 0x0?void 0x0:_0x1c3031[_0x30f918(0x1fd)])||_0x503413[_0x30f918(0x21f)];this[_0x30f918(0x1f8)][_0x30f918(0x21c)]('update\x20access\x20token\x20failed:\x20%s',_0x1e0c4e),this[_0x30f918(0x218)]=auth_state_enum_1[_0x30f918(0x246)][_0x30f918(0x20b)];throw new invalid_refresh_token_error_1[(_0x30f918(0x23d))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x44e311=a194_0x1a2818;this[_0x44e311(0x1f8)][_0x44e311(0x21d)](_0x44e311(0x225));if(this[_0x44e311(0x218)]===auth_state_enum_1[_0x44e311(0x246)][_0x44e311(0x223)]||this[_0x44e311(0x218)]===auth_state_enum_1[_0x44e311(0x246)][_0x44e311(0x22b)])return await(0x0,utils_1[_0x44e311(0x23f)])(this[_0x44e311(0x20a)]),this[_0x44e311(0x20c)]();if(this[_0x44e311(0x218)]===auth_state_enum_1[_0x44e311(0x246)][_0x44e311(0x20b)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x44e311(0x1fb)]);await this[_0x44e311(0x234)]();}async[a194_0x1a2818(0x222)](){const _0x527ae4=a194_0x1a2818;if(this['authState']===auth_state_enum_1[_0x527ae4(0x246)]['Error']){this['logger'][_0x527ae4(0x21d)](_0x527ae4(0x226));throw new unauthorized_salesforce_error_1[(_0x527ae4(0x201))]();}if(this[_0x527ae4(0x218)]!==auth_state_enum_1[_0x527ae4(0x246)]['Active'])return this[_0x527ae4(0x1f8)][_0x527ae4(0x21d)](_0x527ae4(0x206)),await(0x0,utils_1[_0x527ae4(0x23f)])(this['AUTH_WAIT_TIME']),this['waitAuth']();}['getAuthData'](){const _0x642f79=a194_0x1a2818;return{'orgId':this[_0x642f79(0x205)],'accessToken':this[_0x642f79(0x209)],'instanceUrl':this[_0x642f79(0x231)]};}async[a194_0x1a2818(0x202)](){const _0xa266ee=a194_0x1a2818;return await this[_0xa266ee(0x222)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0xa266ee(0x220),'authorization':this[_0xa266ee(0x249)]+'\x20'+this[_0xa266ee(0x209)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a194_0x1a2818(0x243)])(),__metadata(a194_0x1a2818(0x20d),[])],SalesforceAuthService),exports[a194_0x1a2818(0x208)]=SalesforceAuthService;function a194_0x4dbd(){const _0x4487a0=['toString','create','../../../../core','6dsxheV','logger','writable','access\x20token\x20updated\x20for\x20%s','ERR_INVALID_SALESFORCE_TOKEN','services/data/','data','defineProperty','search','(((.+)+)+)+$','UnauthorizedSalesforceError','requestConfig','function','__createBinding','orgId','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','Tokens','SalesforceAuthService','accessToken','AUTH_WAIT_TIME','Error','forceUpdateToken','design:paramtypes','../enums/auth-state.enum','hasOwnProperty','configurable','/services/oauth2/token','prototype','token_type','call','check\x20auth:\x20current\x20state\x20-\x20%s','../../../shared/utils','catch','authState','__decorate','Logger','constructor','error','log','typedi','message','application/json','__metadata','waitAuth','Updating','object','force\x20update\x20token','create\x20authorized\x20request\x20failed:\x20authorization\x20error','../../../../constants/errors','../../providers/providers.tokens','metadata','2443248epPQea','Idle','joinURL','5470652xzWjlu','105LqlBPN','then','Active','instanceUrl','update\x20access\x20token','38403036pjloCU','updateAccessToken','refresh_token','346072AaVJek','SALESFORCE_API_VERSION','1551094xkjzGn','get','../../../../constants','getOwnPropertyDescriptor','setAuthDetails','InvalidRefreshTokenError','post','sleep','__importStar','7155700agLhzk','881115kqJVNq','Service','instance_url','../errors/unauthorized-salesforce.error','AuthState','__esModule','axios','tokenType','default','salesforce'];a194_0x4dbd=function(){return _0x4487a0;};return a194_0x4dbd();}