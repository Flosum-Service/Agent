const a226_0x5b8353=a226_0x2925;function a226_0x4ca1(){const _0xa66911=['constructor','(((.+)+)+)+$','waitAuth','SALESFORCE_API_VERSION','prototype','25050qsfHZR','hasOwnProperty','joinURL','authState','requestConfig','updateAccessToken','call','default','453GvrHox','data','Logger','catch','create\x20authorized\x20request\x20failed:\x20authorization\x20error','../../../../constants','1517238kkNqrU','../../../../core','56Upulla','configurable','Active','4910UgyqnR','log','create','../../../shared/utils','getAuthData','__createBinding','__decorate','2946bvaKew','setAuthDetails','ERR_INVALID_SALESFORCE_TOKEN','../../../../constants/errors','metadata','__importDefault','UnauthorizedSalesforceError','__metadata','getOwnPropertyDescriptor','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','../errors/invalid-refresh-token.error','check\x20auth:\x20current\x20state\x20-\x20%s','Error','../errors/unauthorized-salesforce.error','salesforce','__esModule','function','instance_url','/services/oauth2/token','decorate','search','AuthState','access\x20token\x20updated\x20for\x20%s','Updating','object','typedi','services/data/','Idle','token_type','error','design:paramtypes','toString','7513IfeIkd','tokenType','65575wXKphh','length','4501kYMmqL','InvalidRefreshTokenError','sleep','orgId','get','AUTH_WAIT_TIME','response','forceUpdateToken','instanceUrl','defineProperty','accessToken','update\x20access\x20token','logger','1112yibPqm','application/json','2351360mAPhxc','axios'];a226_0x4ca1=function(){return _0xa66911;};return a226_0x4ca1();}function a226_0x2925(_0x25cad7,_0x20eefc){const _0x597941=a226_0x4ca1();return a226_0x2925=function(_0x460923,_0xcbea95){_0x460923=_0x460923-0x99;let _0x4ca14a=_0x597941[_0x460923];return _0x4ca14a;},a226_0x2925(_0x25cad7,_0x20eefc);}(function(_0x2ceadb,_0x1c142b){const _0x26c901=a226_0x2925,_0x48243d=_0x2ceadb();while(!![]){try{const _0x4e1db2=parseInt(_0x26c901(0xec))/0x1+-parseInt(_0x26c901(0xe3))/0x2*(parseInt(_0x26c901(0xa0))/0x3)+parseInt(_0x26c901(0xa8))/0x4*(parseInt(_0x26c901(0xd4))/0x5)+-parseInt(_0x26c901(0xb2))/0x6*(-parseInt(_0x26c901(0xd6))/0x7)+parseInt(_0x26c901(0xe5))/0x8+-parseInt(_0x26c901(0xa6))/0x9+-parseInt(_0x26c901(0xab))/0xa*(parseInt(_0x26c901(0xd2))/0xb);if(_0x4e1db2===_0x1c142b)break;else _0x48243d['push'](_0x48243d['shift']());}catch(_0x5766e9){_0x48243d['push'](_0x48243d['shift']());}}}(a226_0x4ca1,0x38402));const a226_0xcbea95=(function(){let _0xf55219=!![];return function(_0x54358f,_0x2ab1f0){const _0x219e0d=_0xf55219?function(){if(_0x2ab1f0){const _0x5804b2=_0x2ab1f0['apply'](_0x54358f,arguments);return _0x2ab1f0=null,_0x5804b2;}}:function(){};return _0xf55219=![],_0x219e0d;};}()),a226_0x460923=a226_0xcbea95(this,function(){const _0x123dfd=a226_0x2925;return a226_0x460923[_0x123dfd(0xd1)]()[_0x123dfd(0xc6)](_0x123dfd(0xe8))[_0x123dfd(0xd1)]()[_0x123dfd(0xe7)](a226_0x460923)[_0x123dfd(0xc6)](_0x123dfd(0xe8));});a226_0x460923();'use strict';var __createBinding=this&&this[a226_0x5b8353(0xb0)]||(Object[a226_0x5b8353(0xad)]?function(_0x5d2de6,_0x880f7f,_0x4dc8c5,_0x4bfb3d){const _0x19d0f2=a226_0x5b8353;if(_0x4bfb3d===undefined)_0x4bfb3d=_0x4dc8c5;var _0x2f393d=Object[_0x19d0f2(0xba)](_0x880f7f,_0x4dc8c5);(!_0x2f393d||('get'in _0x2f393d?!_0x880f7f[_0x19d0f2(0xc1)]:_0x2f393d['writable']||_0x2f393d[_0x19d0f2(0xa9)]))&&(_0x2f393d={'enumerable':!![],'get':function(){return _0x880f7f[_0x4dc8c5];}}),Object[_0x19d0f2(0xdf)](_0x5d2de6,_0x4bfb3d,_0x2f393d);}:function(_0x1ddd49,_0x4aed28,_0x2d0197,_0x559f2c){if(_0x559f2c===undefined)_0x559f2c=_0x2d0197;_0x1ddd49[_0x559f2c]=_0x4aed28[_0x2d0197];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x41004a,_0x554f45){const _0x31647d=a226_0x5b8353;Object[_0x31647d(0xdf)](_0x41004a,_0x31647d(0x9f),{'enumerable':!![],'value':_0x554f45});}:function(_0x1a6361,_0x242a69){_0x1a6361['default']=_0x242a69;}),__decorate=this&&this[a226_0x5b8353(0xb1)]||function(_0x13b29f,_0x970187,_0x23da69,_0x838b6f){const _0x6c6b40=a226_0x5b8353;var _0x59f09e=arguments[_0x6c6b40(0xd5)],_0x3e4fa1=_0x59f09e<0x3?_0x970187:_0x838b6f===null?_0x838b6f=Object[_0x6c6b40(0xba)](_0x970187,_0x23da69):_0x838b6f,_0x4b62c7;if(typeof Reflect===_0x6c6b40(0xca)&&typeof Reflect[_0x6c6b40(0xc5)]==='function')_0x3e4fa1=Reflect[_0x6c6b40(0xc5)](_0x13b29f,_0x970187,_0x23da69,_0x838b6f);else{for(var _0xf39fd1=_0x13b29f['length']-0x1;_0xf39fd1>=0x0;_0xf39fd1--)if(_0x4b62c7=_0x13b29f[_0xf39fd1])_0x3e4fa1=(_0x59f09e<0x3?_0x4b62c7(_0x3e4fa1):_0x59f09e>0x3?_0x4b62c7(_0x970187,_0x23da69,_0x3e4fa1):_0x4b62c7(_0x970187,_0x23da69))||_0x3e4fa1;}return _0x59f09e>0x3&&_0x3e4fa1&&Object[_0x6c6b40(0xdf)](_0x970187,_0x23da69,_0x3e4fa1),_0x3e4fa1;},__importStar=this&&this['__importStar']||function(_0x18d6ce){const _0x3f37f9=a226_0x5b8353;if(_0x18d6ce&&_0x18d6ce[_0x3f37f9(0xc1)])return _0x18d6ce;var _0x30f598={};if(_0x18d6ce!=null){for(var _0x4ce9ed in _0x18d6ce)if(_0x4ce9ed!==_0x3f37f9(0x9f)&&Object[_0x3f37f9(0xeb)][_0x3f37f9(0x99)][_0x3f37f9(0x9e)](_0x18d6ce,_0x4ce9ed))__createBinding(_0x30f598,_0x18d6ce,_0x4ce9ed);}return __setModuleDefault(_0x30f598,_0x18d6ce),_0x30f598;},__metadata=this&&this[a226_0x5b8353(0xb9)]||function(_0x3be755,_0x1dd7a1){const _0xd72857=a226_0x5b8353;if(typeof Reflect===_0xd72857(0xca)&&typeof Reflect[_0xd72857(0xb6)]===_0xd72857(0xc2))return Reflect[_0xd72857(0xb6)](_0x3be755,_0x1dd7a1);},__importDefault=this&&this[a226_0x5b8353(0xb7)]||function(_0x37d35c){const _0x1870f3=a226_0x5b8353;return _0x37d35c&&_0x37d35c[_0x1870f3(0xc1)]?_0x37d35c:{'default':_0x37d35c};},SalesforceAuthService_1;Object[a226_0x5b8353(0xdf)](exports,a226_0x5b8353(0xc1),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a226_0x5b8353(0xcb))),errors_1=require(a226_0x5b8353(0xb5)),core_1=require(a226_0x5b8353(0xa7)),axios_1=__importDefault(require(a226_0x5b8353(0xe6))),utils_1=require(a226_0x5b8353(0xae)),invalid_refresh_token_error_1=require(a226_0x5b8353(0xbc)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a226_0x5b8353(0xbf)),constants_1=require(a226_0x5b8353(0xa5)),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x53c856=a226_0x5b8353;this['AUTH_WAIT_TIME']=0x1388,this[_0x53c856(0x9b)]=auth_state_enum_1[_0x53c856(0xc7)][_0x53c856(0xcd)],this[_0x53c856(0xe2)]=new core_1[(_0x53c856(0xa2))](SalesforceAuthService_1['name']),this['setAuthDetails']();}async[a226_0x5b8353(0xb3)](){const _0x11cca3=a226_0x5b8353;this['logger'][_0x11cca3(0xac)](_0x11cca3(0xbd),auth_state_enum_1[_0x11cca3(0xc7)][this[_0x11cca3(0x9b)]]);try{if(this[_0x11cca3(0x9b)]===auth_state_enum_1[_0x11cca3(0xc7)][_0x11cca3(0xbe)])return;if(this['authState']===auth_state_enum_1[_0x11cca3(0xc7)][_0x11cca3(0xcd)])await this[_0x11cca3(0x9d)]();else{const _0x49dc30=await this['requestConfig'](),_0x518839=await axios_1['default'][_0x11cca3(0xda)](_0x11cca3(0xcc)+constants_1[_0x11cca3(0xea)],_0x49dc30)['then'](()=>!![])[_0x11cca3(0xa3)](()=>![]);!_0x518839&&await this[_0x11cca3(0x9d)]();}}catch(_0x1739e2){}}async[a226_0x5b8353(0x9d)](){const _0x30fa08=a226_0x5b8353;var _0x49fe53,_0x251a68,_0x3a8af4;this[_0x30fa08(0xe2)][_0x30fa08(0xac)](_0x30fa08(0xe1));try{this[_0x30fa08(0x9b)]=auth_state_enum_1[_0x30fa08(0xc7)][_0x30fa08(0xc9)];const {refreshToken:_0xe536eb,clientId:_0x95c7e,clientSecret:_0x4606ea,loginUrl:_0x5a93c2}=typedi_1[_0x30fa08(0x9f)][_0x30fa08(0xda)](providers_tokens_1['Tokens'][_0x30fa08(0xc0)]),{data:_0x40bd76}=await axios_1[_0x30fa08(0x9f)]['post']((0x0,utils_1[_0x30fa08(0x9a)])(_0x5a93c2,_0x30fa08(0xc4)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0xe536eb,'client_id':_0x95c7e,'client_secret':_0x4606ea}});this[_0x30fa08(0xde)]=_0x40bd76[_0x30fa08(0xc3)],this[_0x30fa08(0xe0)]=_0x40bd76['access_token'],this[_0x30fa08(0xd3)]=_0x40bd76[_0x30fa08(0xce)],this[_0x30fa08(0x9b)]=auth_state_enum_1[_0x30fa08(0xc7)][_0x30fa08(0xaa)],this[_0x30fa08(0xe2)]['log'](_0x30fa08(0xc8),this[_0x30fa08(0xde)]);}catch(_0x45231c){const _0x2acb76=((_0x251a68=(_0x49fe53=_0x45231c===null||_0x45231c===void 0x0?void 0x0:_0x45231c[_0x30fa08(0xdc)])===null||_0x49fe53===void 0x0?void 0x0:_0x49fe53[_0x30fa08(0xa1)])===null||_0x251a68===void 0x0?void 0x0:_0x251a68[_0x30fa08(0xcf)])||((_0x3a8af4=_0x45231c===null||_0x45231c===void 0x0?void 0x0:_0x45231c['response'])===null||_0x3a8af4===void 0x0?void 0x0:_0x3a8af4[_0x30fa08(0xa1)])||_0x45231c['message'];this[_0x30fa08(0xe2)][_0x30fa08(0xcf)]('update\x20access\x20token\x20failed:\x20%s',_0x2acb76),this[_0x30fa08(0x9b)]=auth_state_enum_1[_0x30fa08(0xc7)][_0x30fa08(0xbe)];throw new invalid_refresh_token_error_1[(_0x30fa08(0xd7))](errors_1[_0x30fa08(0xb4)]);}}async['forceUpdateToken'](){const _0x470a97=a226_0x5b8353;this['logger']['log']('force\x20update\x20token');if(this[_0x470a97(0x9b)]===auth_state_enum_1['AuthState'][_0x470a97(0xc9)]||this[_0x470a97(0x9b)]===auth_state_enum_1[_0x470a97(0xc7)][_0x470a97(0xcd)])return await(0x0,utils_1[_0x470a97(0xd8)])(this['AUTH_WAIT_TIME']),this[_0x470a97(0xdd)]();if(this[_0x470a97(0x9b)]===auth_state_enum_1[_0x470a97(0xc7)]['Error'])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x470a97(0xb4)]);await this[_0x470a97(0x9d)]();}async[a226_0x5b8353(0xe9)](){const _0x50b856=a226_0x5b8353;if(this[_0x50b856(0x9b)]===auth_state_enum_1[_0x50b856(0xc7)]['Error']){this[_0x50b856(0xe2)][_0x50b856(0xac)](_0x50b856(0xa4));throw new unauthorized_salesforce_error_1[(_0x50b856(0xb8))]();}if(this[_0x50b856(0x9b)]!==auth_state_enum_1['AuthState']['Active'])return this['logger'][_0x50b856(0xac)](_0x50b856(0xbb)),await(0x0,utils_1[_0x50b856(0xd8)])(this[_0x50b856(0xdb)]),this[_0x50b856(0xe9)]();}[a226_0x5b8353(0xaf)](){const _0x57b1bd=a226_0x5b8353;return{'orgId':this[_0x57b1bd(0xd9)],'accessToken':this[_0x57b1bd(0xe0)],'instanceUrl':this['instanceUrl']};}async[a226_0x5b8353(0x9c)](){const _0x447bea=a226_0x5b8353;return await this[_0x447bea(0xe9)](),{'baseURL':this[_0x447bea(0xde)],'headers':{'accept':_0x447bea(0xe4),'authorization':this['tokenType']+'\x20'+this[_0x447bea(0xe0)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a226_0x5b8353(0xd0),[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;