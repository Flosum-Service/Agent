const a258_0x52d28a=a258_0x287f;(function(_0x258564,_0x88b1d){const _0x23509f=a258_0x287f,_0x2dbeee=_0x258564();while(!![]){try{const _0xbc6b27=-parseInt(_0x23509f(0x1bf))/0x1*(-parseInt(_0x23509f(0x1a4))/0x2)+parseInt(_0x23509f(0x1a2))/0x3*(-parseInt(_0x23509f(0x1b0))/0x4)+-parseInt(_0x23509f(0x190))/0x5*(parseInt(_0x23509f(0x1ac))/0x6)+parseInt(_0x23509f(0x187))/0x7*(parseInt(_0x23509f(0x1a6))/0x8)+-parseInt(_0x23509f(0x198))/0x9+parseInt(_0x23509f(0x192))/0xa*(-parseInt(_0x23509f(0x1b8))/0xb)+parseInt(_0x23509f(0x1ba))/0xc*(parseInt(_0x23509f(0x1ad))/0xd);if(_0xbc6b27===_0x88b1d)break;else _0x2dbeee['push'](_0x2dbeee['shift']());}catch(_0x440d6c){_0x2dbeee['push'](_0x2dbeee['shift']());}}}(a258_0xee04,0x4c04e));const a258_0x322c01=(function(){let _0x2a421d=!![];return function(_0x3512e1,_0x40a478){const _0x3fdc37=_0x2a421d?function(){if(_0x40a478){const _0x10cb62=_0x40a478['apply'](_0x3512e1,arguments);return _0x40a478=null,_0x10cb62;}}:function(){};return _0x2a421d=![],_0x3fdc37;};}()),a258_0x83e84c=a258_0x322c01(this,function(){const _0x2d4405=a258_0x287f;return a258_0x83e84c['toString']()[_0x2d4405(0x177)](_0x2d4405(0x1af))['toString']()[_0x2d4405(0x194)](a258_0x83e84c)[_0x2d4405(0x177)](_0x2d4405(0x1af));});function a258_0xee04(){const _0x13d232=['InvalidRefreshTokenError','ERR_INVALID_SALESFORCE_TOKEN','logger','384mlNcNf','48607UFRKPc','prototype','(((.+)+)+)+$','4SDVQYW','axios','call','get','waitAuth','Error','requestConfig','../enums/auth-state.enum','35574WKwnEA','default','4488BbJDwv','design:paramtypes','updateAccessToken','Service','accessToken','313eFuwHX','Update\x20access\x20token\x20failed:\x20%s','log','metadata','object','catch','sleep','../errors/unauthorized-salesforce.error','Access\x20token\x20updated\x20for\x20%s','search','__decorate','../../../shared/utils','UnauthorizedSalesforceError','length','Force\x20update\x20token','AUTH_WAIT_TIME','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','then','typedi','tokenType','../../../../constants','data','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','response','__esModule','7hZSWMH','error','authState','../../../../constants/errors','SalesforceAuthService','create','refresh_token','__metadata','writable','39190zUbRqo','__importStar','1390wpuKWf','configurable','constructor','salesforce','decorate','function','2668347agGEbZ','Idle','defineProperty','Active','AuthState','name','Update\x20access\x20token','services/data/','instance_url','joinURL','432723xPgcBT','instanceUrl','378jYuMzv','__createBinding','1965704TQvKOe','Updating','../../providers/providers.tokens'];a258_0xee04=function(){return _0x13d232;};return a258_0xee04();}a258_0x83e84c();'use strict';function a258_0x287f(_0x3d5367,_0x509608){const _0x253ef7=a258_0xee04();return a258_0x287f=function(_0x83e84c,_0x322c01){_0x83e84c=_0x83e84c-0x174;let _0xee048a=_0x253ef7[_0x83e84c];return _0xee048a;},a258_0x287f(_0x3d5367,_0x509608);}var __createBinding=this&&this[a258_0x52d28a(0x1a5)]||(Object[a258_0x52d28a(0x18c)]?function(_0x40333f,_0x11d611,_0x214d95,_0x152289){const _0x110611=a258_0x52d28a;if(_0x152289===undefined)_0x152289=_0x214d95;var _0x131d84=Object['getOwnPropertyDescriptor'](_0x11d611,_0x214d95);(!_0x131d84||(_0x110611(0x1b3)in _0x131d84?!_0x11d611[_0x110611(0x186)]:_0x131d84[_0x110611(0x18f)]||_0x131d84[_0x110611(0x193)]))&&(_0x131d84={'enumerable':!![],'get':function(){return _0x11d611[_0x214d95];}}),Object['defineProperty'](_0x40333f,_0x152289,_0x131d84);}:function(_0x54f6c2,_0x47796a,_0x49f5b5,_0x37e0d8){if(_0x37e0d8===undefined)_0x37e0d8=_0x49f5b5;_0x54f6c2[_0x37e0d8]=_0x47796a[_0x49f5b5];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a258_0x52d28a(0x18c)]?function(_0x580455,_0x811ee2){const _0x4f806d=a258_0x52d28a;Object[_0x4f806d(0x19a)](_0x580455,_0x4f806d(0x1b9),{'enumerable':!![],'value':_0x811ee2});}:function(_0x229e22,_0x35eba9){const _0xc35099=a258_0x52d28a;_0x229e22[_0xc35099(0x1b9)]=_0x35eba9;}),__decorate=this&&this[a258_0x52d28a(0x178)]||function(_0x2979d3,_0x50a9bf,_0x124bd9,_0x46c554){const _0x40a820=a258_0x52d28a;var _0x465603=arguments[_0x40a820(0x17b)],_0x361b5d=_0x465603<0x3?_0x50a9bf:_0x46c554===null?_0x46c554=Object['getOwnPropertyDescriptor'](_0x50a9bf,_0x124bd9):_0x46c554,_0x40a9ff;if(typeof Reflect===_0x40a820(0x1c3)&&typeof Reflect[_0x40a820(0x196)]===_0x40a820(0x197))_0x361b5d=Reflect[_0x40a820(0x196)](_0x2979d3,_0x50a9bf,_0x124bd9,_0x46c554);else{for(var _0x514452=_0x2979d3['length']-0x1;_0x514452>=0x0;_0x514452--)if(_0x40a9ff=_0x2979d3[_0x514452])_0x361b5d=(_0x465603<0x3?_0x40a9ff(_0x361b5d):_0x465603>0x3?_0x40a9ff(_0x50a9bf,_0x124bd9,_0x361b5d):_0x40a9ff(_0x50a9bf,_0x124bd9))||_0x361b5d;}return _0x465603>0x3&&_0x361b5d&&Object[_0x40a820(0x19a)](_0x50a9bf,_0x124bd9,_0x361b5d),_0x361b5d;},__importStar=this&&this[a258_0x52d28a(0x191)]||function(_0x2e6970){const _0x23ccc7=a258_0x52d28a;if(_0x2e6970&&_0x2e6970[_0x23ccc7(0x186)])return _0x2e6970;var _0x275416={};if(_0x2e6970!=null){for(var _0x5a1fbd in _0x2e6970)if(_0x5a1fbd!==_0x23ccc7(0x1b9)&&Object[_0x23ccc7(0x1ae)]['hasOwnProperty'][_0x23ccc7(0x1b2)](_0x2e6970,_0x5a1fbd))__createBinding(_0x275416,_0x2e6970,_0x5a1fbd);}return __setModuleDefault(_0x275416,_0x2e6970),_0x275416;},__metadata=this&&this[a258_0x52d28a(0x18e)]||function(_0x3df7d8,_0x594565){const _0x1c02ff=a258_0x52d28a;if(typeof Reflect===_0x1c02ff(0x1c3)&&typeof Reflect[_0x1c02ff(0x1c2)]===_0x1c02ff(0x197))return Reflect[_0x1c02ff(0x1c2)](_0x3df7d8,_0x594565);},__importDefault=this&&this['__importDefault']||function(_0x8fb2d0){return _0x8fb2d0&&_0x8fb2d0['__esModule']?_0x8fb2d0:{'default':_0x8fb2d0};},SalesforceAuthService_1;Object[a258_0x52d28a(0x19a)](exports,a258_0x52d28a(0x186),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=__importStar(require(a258_0x52d28a(0x180))),errors_1=require(a258_0x52d28a(0x18a)),core_1=require('../../../../core'),axios_1=__importDefault(require(a258_0x52d28a(0x1b1))),utils_1=require(a258_0x52d28a(0x179)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a258_0x52d28a(0x1b7)),unauthorized_salesforce_error_1=require(a258_0x52d28a(0x175)),constants_1=require(a258_0x52d28a(0x182)),providers_tokens_1=require(a258_0x52d28a(0x1a8));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x11f220=a258_0x52d28a;this[_0x11f220(0x17d)]=0x1388,this[_0x11f220(0x189)]=auth_state_enum_1[_0x11f220(0x19c)][_0x11f220(0x199)],this[_0x11f220(0x1ab)]=new core_1['Logger'](SalesforceAuthService_1[_0x11f220(0x19d)]),this['setAuthDetails']();}async['setAuthDetails'](){const _0x329577=a258_0x52d28a;this[_0x329577(0x1ab)][_0x329577(0x1c1)]('Check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x329577(0x19c)][this[_0x329577(0x189)]]);try{if(this['authState']===auth_state_enum_1['AuthState'][_0x329577(0x1b5)])return;if(this[_0x329577(0x189)]===auth_state_enum_1[_0x329577(0x19c)][_0x329577(0x199)])await this['updateAccessToken']();else{const _0x34e2a2=await this[_0x329577(0x1b6)](),_0x34f9ce=await axios_1['default'][_0x329577(0x1b3)](_0x329577(0x19f)+constants_1['SALESFORCE_API_VERSION'],_0x34e2a2)[_0x329577(0x17f)](()=>!![])[_0x329577(0x1c4)](()=>![]);!_0x34f9ce&&await this[_0x329577(0x1bc)]();}}catch(_0x5b84fd){}}async[a258_0x52d28a(0x1bc)](){const _0x18eab4=a258_0x52d28a;var _0xf0fca4,_0x44ecfd,_0x1c4fd9;this[_0x18eab4(0x1ab)][_0x18eab4(0x1c1)](_0x18eab4(0x19e));try{this[_0x18eab4(0x189)]=auth_state_enum_1[_0x18eab4(0x19c)][_0x18eab4(0x1a7)];const {refreshToken:_0x552d15,clientId:_0x172856,clientSecret:_0x22c6c1,loginUrl:_0xcd5335}=typedi_1[_0x18eab4(0x1b9)]['get'](providers_tokens_1['Tokens'][_0x18eab4(0x195)]),{data:_0x4287d0}=await axios_1['default']['post']((0x0,utils_1[_0x18eab4(0x1a1)])(_0xcd5335,'/services/oauth2/token'),null,{'params':{'grant_type':_0x18eab4(0x18d),'refresh_token':_0x552d15,'client_id':_0x172856,'client_secret':_0x22c6c1}});this['instanceUrl']=_0x4287d0[_0x18eab4(0x1a0)],this[_0x18eab4(0x1be)]=_0x4287d0['access_token'],this[_0x18eab4(0x181)]=_0x4287d0['token_type'],this['authState']=auth_state_enum_1[_0x18eab4(0x19c)][_0x18eab4(0x19b)],this[_0x18eab4(0x1ab)]['log'](_0x18eab4(0x176),this['instanceUrl']);}catch(_0x5e27db){const _0x86d9f3=((_0x44ecfd=(_0xf0fca4=_0x5e27db===null||_0x5e27db===void 0x0?void 0x0:_0x5e27db[_0x18eab4(0x185)])===null||_0xf0fca4===void 0x0?void 0x0:_0xf0fca4[_0x18eab4(0x183)])===null||_0x44ecfd===void 0x0?void 0x0:_0x44ecfd[_0x18eab4(0x188)])||((_0x1c4fd9=_0x5e27db===null||_0x5e27db===void 0x0?void 0x0:_0x5e27db['response'])===null||_0x1c4fd9===void 0x0?void 0x0:_0x1c4fd9[_0x18eab4(0x183)])||_0x5e27db['message'];this[_0x18eab4(0x1ab)][_0x18eab4(0x188)](_0x18eab4(0x1c0),_0x86d9f3),this[_0x18eab4(0x189)]=auth_state_enum_1[_0x18eab4(0x19c)][_0x18eab4(0x1b5)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x18eab4(0x1aa)]);}}async['forceUpdateToken'](){const _0x2456db=a258_0x52d28a;this[_0x2456db(0x1ab)][_0x2456db(0x1c1)](_0x2456db(0x17c));if(this[_0x2456db(0x189)]===auth_state_enum_1[_0x2456db(0x19c)][_0x2456db(0x1a7)]||this[_0x2456db(0x189)]===auth_state_enum_1[_0x2456db(0x19c)]['Idle'])return await(0x0,utils_1[_0x2456db(0x174)])(this['AUTH_WAIT_TIME']),this['forceUpdateToken']();if(this[_0x2456db(0x189)]===auth_state_enum_1[_0x2456db(0x19c)][_0x2456db(0x1b5)])throw new invalid_refresh_token_error_1[(_0x2456db(0x1a9))](errors_1[_0x2456db(0x1aa)]);await this[_0x2456db(0x1bc)]();}async[a258_0x52d28a(0x1b4)](){const _0x537584=a258_0x52d28a;if(this[_0x537584(0x189)]===auth_state_enum_1[_0x537584(0x19c)][_0x537584(0x1b5)]){this[_0x537584(0x1ab)]['log'](_0x537584(0x17e));throw new unauthorized_salesforce_error_1[(_0x537584(0x17a))]();}if(this[_0x537584(0x189)]!==auth_state_enum_1[_0x537584(0x19c)]['Active'])return this[_0x537584(0x1ab)][_0x537584(0x1c1)](_0x537584(0x184)),await(0x0,utils_1[_0x537584(0x174)])(this['AUTH_WAIT_TIME']),this[_0x537584(0x1b4)]();}['getAuthData'](){const _0x29c119=a258_0x52d28a;return{'orgId':this['orgId'],'accessToken':this[_0x29c119(0x1be)],'instanceUrl':this[_0x29c119(0x1a3)]};}async[a258_0x52d28a(0x1b6)](){const _0x264b1d=a258_0x52d28a;return await this[_0x264b1d(0x1b4)](),{'baseURL':this[_0x264b1d(0x1a3)],'headers':{'accept':'application/json','authorization':this[_0x264b1d(0x181)]+'\x20'+this[_0x264b1d(0x1be)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a258_0x52d28a(0x1bd)])(),__metadata(a258_0x52d28a(0x1bb),[])],SalesforceAuthService),exports[a258_0x52d28a(0x18b)]=SalesforceAuthService;