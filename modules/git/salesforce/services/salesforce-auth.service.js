const a176_0x2adc8f=a176_0x1865;(function(_0x166684,_0x56f20f){const _0x585594=a176_0x1865,_0x153405=_0x166684();while(!![]){try{const _0x13573e=parseInt(_0x585594(0x1c7))/0x1*(parseInt(_0x585594(0x1c9))/0x2)+parseInt(_0x585594(0x1b3))/0x3*(-parseInt(_0x585594(0x1d7))/0x4)+parseInt(_0x585594(0x1bf))/0x5*(parseInt(_0x585594(0x1be))/0x6)+-parseInt(_0x585594(0x1d0))/0x7*(-parseInt(_0x585594(0x1c6))/0x8)+-parseInt(_0x585594(0x1a8))/0x9+parseInt(_0x585594(0x1cc))/0xa*(-parseInt(_0x585594(0x1df))/0xb)+-parseInt(_0x585594(0x1aa))/0xc*(-parseInt(_0x585594(0x1ba))/0xd);if(_0x13573e===_0x56f20f)break;else _0x153405['push'](_0x153405['shift']());}catch(_0x4f9cbd){_0x153405['push'](_0x153405['shift']());}}}(a176_0x593b,0xb3b45));const a176_0x5ec798=(function(){let _0x4c4ff3=!![];return function(_0x455ce2,_0x1f963c){const _0x56b848=_0x4c4ff3?function(){const _0x285a30=a176_0x1865;if(_0x1f963c){const _0xadc4a2=_0x1f963c[_0x285a30(0x1d8)](_0x455ce2,arguments);return _0x1f963c=null,_0xadc4a2;}}:function(){};return _0x4c4ff3=![],_0x56b848;};}()),a176_0x46150f=a176_0x5ec798(this,function(){const _0x248e50=a176_0x1865;return a176_0x46150f[_0x248e50(0x1c4)]()[_0x248e50(0x1bb)](_0x248e50(0x18f))[_0x248e50(0x1c4)]()[_0x248e50(0x1da)](a176_0x46150f)[_0x248e50(0x1bb)](_0x248e50(0x18f));});function a176_0x593b(){const _0x7ac738=['UnauthorizedSalesforceError','default','__esModule','function','../enums/auth-state.enum','AUTH_WAIT_TIME','SALESFORCE_API_VERSION','Tokens','accessToken','../../../../constants/errors','../../../../constants','defineProperty','object','instanceUrl','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','name','SalesforceAuthService','create\x20authorized\x20request\x20failed:\x20authorization\x20error','create','../errors/invalid-refresh-token.error','metadata','__createBinding','9011196CrhfzD','get','14609676suUyEa','/services/oauth2/token','../../../shared/utils','getAuthData','logger','instance_url','data','log','decorate','151716ugJvhJ','__importDefault','application/json','../../providers/providers.tokens','response','update\x20access\x20token','__importStar','13Hgpaed','search','requestConfig','Logger','24URzXNS','721480roHruk','updateAccessToken','../errors/unauthorized-salesforce.error','forceUpdateToken','Active','toString','__decorate','104lPcABc','11iPgVLV','error','61282hpCymf','Error','services/data/','1087610deCPXn','InvalidRefreshTokenError','then','__metadata','49119UTAZNi','sleep','post','Service','check\x20auth:\x20current\x20state\x20-\x20%s','access_token','waitAuth','4HSbDau','apply','update\x20access\x20token\x20failed:\x20%s','constructor','hasOwnProperty','orgId','length','__setModuleDefault','44bVKbfh','salesforce','ERR_INVALID_SALESFORCE_TOKEN','access\x20token\x20updated\x20for\x20%s','joinURL','authState','Updating','AuthState','prototype','setAuthDetails','(((.+)+)+)+$','Idle','../../../../core'];a176_0x593b=function(){return _0x7ac738;};return a176_0x593b();}a176_0x46150f();function a176_0x1865(_0x2545f2,_0x250578){const _0x28c5a7=a176_0x593b();return a176_0x1865=function(_0x46150f,_0x5ec798){_0x46150f=_0x46150f-0x188;let _0x593be2=_0x28c5a7[_0x46150f];return _0x593be2;},a176_0x1865(_0x2545f2,_0x250578);}'use strict';var __createBinding=this&&this[a176_0x2adc8f(0x1a7)]||(Object[a176_0x2adc8f(0x1a4)]?function(_0x5265df,_0x1f6679,_0x14ad09,_0x170e21){const _0x237ae0=a176_0x2adc8f;if(_0x170e21===undefined)_0x170e21=_0x14ad09;Object[_0x237ae0(0x19d)](_0x5265df,_0x170e21,{'enumerable':!![],'get':function(){return _0x1f6679[_0x14ad09];}});}:function(_0x4741ce,_0x475637,_0x40dc4d,_0x8b8a2b){if(_0x8b8a2b===undefined)_0x8b8a2b=_0x40dc4d;_0x4741ce[_0x8b8a2b]=_0x475637[_0x40dc4d];}),__setModuleDefault=this&&this[a176_0x2adc8f(0x1de)]||(Object[a176_0x2adc8f(0x1a4)]?function(_0x463903,_0x2f461a){const _0x488a31=a176_0x2adc8f;Object[_0x488a31(0x19d)](_0x463903,_0x488a31(0x193),{'enumerable':!![],'value':_0x2f461a});}:function(_0x5116e4,_0x142148){const _0xa2adad=a176_0x2adc8f;_0x5116e4[_0xa2adad(0x193)]=_0x142148;}),__decorate=this&&this[a176_0x2adc8f(0x1c5)]||function(_0x51b448,_0x2be4d1,_0x4c7821,_0x1c41be){const _0x4c3e91=a176_0x2adc8f;var _0x5c0dc7=arguments[_0x4c3e91(0x1dd)],_0x3d6802=_0x5c0dc7<0x3?_0x2be4d1:_0x1c41be===null?_0x1c41be=Object['getOwnPropertyDescriptor'](_0x2be4d1,_0x4c7821):_0x1c41be,_0x2b9a89;if(typeof Reflect===_0x4c3e91(0x19e)&&typeof Reflect[_0x4c3e91(0x1b2)]===_0x4c3e91(0x195))_0x3d6802=Reflect['decorate'](_0x51b448,_0x2be4d1,_0x4c7821,_0x1c41be);else{for(var _0x54cadf=_0x51b448[_0x4c3e91(0x1dd)]-0x1;_0x54cadf>=0x0;_0x54cadf--)if(_0x2b9a89=_0x51b448[_0x54cadf])_0x3d6802=(_0x5c0dc7<0x3?_0x2b9a89(_0x3d6802):_0x5c0dc7>0x3?_0x2b9a89(_0x2be4d1,_0x4c7821,_0x3d6802):_0x2b9a89(_0x2be4d1,_0x4c7821))||_0x3d6802;}return _0x5c0dc7>0x3&&_0x3d6802&&Object[_0x4c3e91(0x19d)](_0x2be4d1,_0x4c7821,_0x3d6802),_0x3d6802;},__importStar=this&&this[a176_0x2adc8f(0x1b9)]||function(_0x2f00bd){const _0x342c6c=a176_0x2adc8f;if(_0x2f00bd&&_0x2f00bd[_0x342c6c(0x194)])return _0x2f00bd;var _0x55421a={};if(_0x2f00bd!=null){for(var _0x5cf987 in _0x2f00bd)if(_0x5cf987!==_0x342c6c(0x193)&&Object[_0x342c6c(0x18d)][_0x342c6c(0x1db)]['call'](_0x2f00bd,_0x5cf987))__createBinding(_0x55421a,_0x2f00bd,_0x5cf987);}return __setModuleDefault(_0x55421a,_0x2f00bd),_0x55421a;},__metadata=this&&this[a176_0x2adc8f(0x1cf)]||function(_0x40a1d1,_0x368752){const _0x2a082b=a176_0x2adc8f;if(typeof Reflect==='object'&&typeof Reflect[_0x2a082b(0x1a6)]===_0x2a082b(0x195))return Reflect[_0x2a082b(0x1a6)](_0x40a1d1,_0x368752);},__importDefault=this&&this[a176_0x2adc8f(0x1b4)]||function(_0x40f987){const _0x1fe123=a176_0x2adc8f;return _0x40f987&&_0x40f987[_0x1fe123(0x194)]?_0x40f987:{'default':_0x40f987};},SalesforceAuthService_1;Object['defineProperty'](exports,a176_0x2adc8f(0x194),{'value':!![]}),exports[a176_0x2adc8f(0x1a2)]=void 0x0;const typedi_1=__importStar(require('typedi')),errors_1=require(a176_0x2adc8f(0x19b)),core_1=require(a176_0x2adc8f(0x191)),axios_1=__importDefault(require('axios')),utils_1=require(a176_0x2adc8f(0x1ac)),invalid_refresh_token_error_1=require(a176_0x2adc8f(0x1a5)),auth_state_enum_1=require(a176_0x2adc8f(0x196)),unauthorized_salesforce_error_1=require(a176_0x2adc8f(0x1c1)),constants_1=require(a176_0x2adc8f(0x19c)),providers_tokens_1=require(a176_0x2adc8f(0x1b6));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x3e0d58=a176_0x2adc8f;this[_0x3e0d58(0x197)]=0x1388,this[_0x3e0d58(0x18a)]=auth_state_enum_1[_0x3e0d58(0x18c)][_0x3e0d58(0x190)],this[_0x3e0d58(0x1ae)]=new core_1[(_0x3e0d58(0x1bd))](SalesforceAuthService_1[_0x3e0d58(0x1a1)]),this[_0x3e0d58(0x18e)]();}async[a176_0x2adc8f(0x18e)](){const _0x38e841=a176_0x2adc8f;this['logger']['log'](_0x38e841(0x1d4),auth_state_enum_1[_0x38e841(0x18c)][this['authState']]);try{if(this[_0x38e841(0x18a)]===auth_state_enum_1[_0x38e841(0x18c)][_0x38e841(0x1ca)])return;if(this['authState']===auth_state_enum_1[_0x38e841(0x18c)]['Idle'])await this[_0x38e841(0x1c0)]();else{const _0x4e7911=await this[_0x38e841(0x1bc)](),_0x2cf3d2=await axios_1[_0x38e841(0x193)]['get'](_0x38e841(0x1cb)+constants_1[_0x38e841(0x198)],_0x4e7911)[_0x38e841(0x1ce)](()=>!![])['catch'](()=>![]);!_0x2cf3d2&&await this[_0x38e841(0x1c0)]();}}catch(_0x4f3677){}}async[a176_0x2adc8f(0x1c0)](){const _0x4dbd19=a176_0x2adc8f;var _0x30d730,_0x51c017,_0x77244d;this['logger'][_0x4dbd19(0x1b1)](_0x4dbd19(0x1b8));try{this['authState']=auth_state_enum_1[_0x4dbd19(0x18c)][_0x4dbd19(0x18b)];const {refreshToken:_0x931299,clientId:_0x46b6c9,clientSecret:_0x2ccd19,loginUrl:_0x23acd8}=typedi_1[_0x4dbd19(0x193)][_0x4dbd19(0x1a9)](providers_tokens_1[_0x4dbd19(0x199)][_0x4dbd19(0x1e0)]),{data:_0x4a6a80}=await axios_1['default'][_0x4dbd19(0x1d2)](utils_1[_0x4dbd19(0x189)](_0x23acd8,_0x4dbd19(0x1ab)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x931299,'client_id':_0x46b6c9,'client_secret':_0x2ccd19}});this[_0x4dbd19(0x19f)]=_0x4a6a80[_0x4dbd19(0x1af)],this[_0x4dbd19(0x19a)]=_0x4a6a80[_0x4dbd19(0x1d5)],this['tokenType']=_0x4a6a80['token_type'],this[_0x4dbd19(0x18a)]=auth_state_enum_1['AuthState']['Active'],this[_0x4dbd19(0x1ae)][_0x4dbd19(0x1b1)](_0x4dbd19(0x188),this['instanceUrl']);}catch(_0x40c73c){const _0x5da126=((_0x51c017=(_0x30d730=_0x40c73c===null||_0x40c73c===void 0x0?void 0x0:_0x40c73c['response'])===null||_0x30d730===void 0x0?void 0x0:_0x30d730[_0x4dbd19(0x1b0)])===null||_0x51c017===void 0x0?void 0x0:_0x51c017[_0x4dbd19(0x1c8)])||((_0x77244d=_0x40c73c===null||_0x40c73c===void 0x0?void 0x0:_0x40c73c[_0x4dbd19(0x1b7)])===null||_0x77244d===void 0x0?void 0x0:_0x77244d[_0x4dbd19(0x1b0)])||_0x40c73c['message'];this[_0x4dbd19(0x1ae)]['error'](_0x4dbd19(0x1d9),_0x5da126),this[_0x4dbd19(0x18a)]=auth_state_enum_1[_0x4dbd19(0x18c)][_0x4dbd19(0x1ca)];throw new invalid_refresh_token_error_1[(_0x4dbd19(0x1cd))](errors_1[_0x4dbd19(0x1e1)]);}}async[a176_0x2adc8f(0x1c2)](){const _0x42b2f6=a176_0x2adc8f;this[_0x42b2f6(0x1ae)][_0x42b2f6(0x1b1)]('force\x20update\x20token');if(this[_0x42b2f6(0x18a)]===auth_state_enum_1[_0x42b2f6(0x18c)][_0x42b2f6(0x18b)]||this[_0x42b2f6(0x18a)]===auth_state_enum_1['AuthState'][_0x42b2f6(0x190)])return await utils_1[_0x42b2f6(0x1d1)](this[_0x42b2f6(0x197)]),this[_0x42b2f6(0x1c2)]();if(this[_0x42b2f6(0x18a)]===auth_state_enum_1['AuthState'][_0x42b2f6(0x1ca)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x42b2f6(0x1e1)]);await this[_0x42b2f6(0x1c0)]();}async[a176_0x2adc8f(0x1d6)](){const _0x1c6adf=a176_0x2adc8f;if(this['authState']===auth_state_enum_1['AuthState'][_0x1c6adf(0x1ca)]){this['logger']['log'](_0x1c6adf(0x1a3));throw new unauthorized_salesforce_error_1[(_0x1c6adf(0x192))]();}if(this[_0x1c6adf(0x18a)]!==auth_state_enum_1[_0x1c6adf(0x18c)][_0x1c6adf(0x1c3)])return this[_0x1c6adf(0x1ae)][_0x1c6adf(0x1b1)](_0x1c6adf(0x1a0)),await utils_1['sleep'](this[_0x1c6adf(0x197)]),this[_0x1c6adf(0x1d6)]();}[a176_0x2adc8f(0x1ad)](){const _0x2bbaf2=a176_0x2adc8f;return{'orgId':this[_0x2bbaf2(0x1dc)],'accessToken':this['accessToken'],'instanceUrl':this[_0x2bbaf2(0x19f)]};}async[a176_0x2adc8f(0x1bc)](){const _0x4d8691=a176_0x2adc8f;return await this['waitAuth'](),{'baseURL':this[_0x4d8691(0x19f)],'headers':{'accept':_0x4d8691(0x1b5),'authorization':this['tokenType']+'\x20'+this[_0x4d8691(0x19a)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a176_0x2adc8f(0x1d3)](),__metadata('design:paramtypes',[])],SalesforceAuthService),exports[a176_0x2adc8f(0x1a2)]=SalesforceAuthService;