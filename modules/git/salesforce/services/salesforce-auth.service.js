const a243_0x16eeae=a243_0x2d67;(function(_0x70e889,_0x17dac9){const _0x367701=a243_0x2d67,_0x3587fd=_0x70e889();while(!![]){try{const _0x10892e=parseInt(_0x367701(0x21e))/0x1+parseInt(_0x367701(0x1eb))/0x2*(-parseInt(_0x367701(0x238))/0x3)+parseInt(_0x367701(0x201))/0x4*(parseInt(_0x367701(0x1f0))/0x5)+parseInt(_0x367701(0x202))/0x6*(parseInt(_0x367701(0x225))/0x7)+parseInt(_0x367701(0x220))/0x8+-parseInt(_0x367701(0x239))/0x9+parseInt(_0x367701(0x236))/0xa*(-parseInt(_0x367701(0x21d))/0xb);if(_0x10892e===_0x17dac9)break;else _0x3587fd['push'](_0x3587fd['shift']());}catch(_0x2515d6){_0x3587fd['push'](_0x3587fd['shift']());}}}(a243_0xad03,0xc293d));const a243_0x241f1c=(function(){let _0x289e63=!![];return function(_0x476c02,_0x218e5d){const _0x398a02=_0x289e63?function(){if(_0x218e5d){const _0x2bd9d9=_0x218e5d['apply'](_0x476c02,arguments);return _0x218e5d=null,_0x2bd9d9;}}:function(){};return _0x289e63=![],_0x398a02;};}()),a243_0x13d549=a243_0x241f1c(this,function(){const _0x34dfec=a243_0x2d67;return a243_0x13d549['toString']()[_0x34dfec(0x221)](_0x34dfec(0x210))[_0x34dfec(0x1e7)]()[_0x34dfec(0x1f7)](a243_0x13d549)[_0x34dfec(0x221)](_0x34dfec(0x210));});a243_0x13d549();'use strict';var __createBinding=this&&this[a243_0x16eeae(0x227)]||(Object[a243_0x16eeae(0x229)]?function(_0x4f5b4a,_0x3eb83f,_0x2cf7ea,_0x9e484f){const _0x18a521=a243_0x16eeae;if(_0x9e484f===undefined)_0x9e484f=_0x2cf7ea;var _0x58196e=Object[_0x18a521(0x226)](_0x3eb83f,_0x2cf7ea);(!_0x58196e||(_0x18a521(0x213)in _0x58196e?!_0x3eb83f['__esModule']:_0x58196e[_0x18a521(0x219)]||_0x58196e[_0x18a521(0x218)]))&&(_0x58196e={'enumerable':!![],'get':function(){return _0x3eb83f[_0x2cf7ea];}}),Object[_0x18a521(0x222)](_0x4f5b4a,_0x9e484f,_0x58196e);}:function(_0x288777,_0x3138ab,_0x555811,_0x29be4c){if(_0x29be4c===undefined)_0x29be4c=_0x555811;_0x288777[_0x29be4c]=_0x3138ab[_0x555811];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a243_0x16eeae(0x229)]?function(_0x53cd3d,_0x4aca3d){const _0x14e701=a243_0x16eeae;Object['defineProperty'](_0x53cd3d,_0x14e701(0x1f8),{'enumerable':!![],'value':_0x4aca3d});}:function(_0x21288e,_0x2c2809){const _0x58b985=a243_0x16eeae;_0x21288e[_0x58b985(0x1f8)]=_0x2c2809;}),__decorate=this&&this[a243_0x16eeae(0x200)]||function(_0x45744b,_0x464de4,_0x1246ad,_0x5457be){const _0x254cfb=a243_0x16eeae;var _0x29dc8b=arguments[_0x254cfb(0x215)],_0x2880e7=_0x29dc8b<0x3?_0x464de4:_0x5457be===null?_0x5457be=Object[_0x254cfb(0x226)](_0x464de4,_0x1246ad):_0x5457be,_0x40dc82;if(typeof Reflect===_0x254cfb(0x1f4)&&typeof Reflect[_0x254cfb(0x20a)]===_0x254cfb(0x207))_0x2880e7=Reflect[_0x254cfb(0x20a)](_0x45744b,_0x464de4,_0x1246ad,_0x5457be);else{for(var _0x472f8f=_0x45744b['length']-0x1;_0x472f8f>=0x0;_0x472f8f--)if(_0x40dc82=_0x45744b[_0x472f8f])_0x2880e7=(_0x29dc8b<0x3?_0x40dc82(_0x2880e7):_0x29dc8b>0x3?_0x40dc82(_0x464de4,_0x1246ad,_0x2880e7):_0x40dc82(_0x464de4,_0x1246ad))||_0x2880e7;}return _0x29dc8b>0x3&&_0x2880e7&&Object[_0x254cfb(0x222)](_0x464de4,_0x1246ad,_0x2880e7),_0x2880e7;},__importStar=this&&this['__importStar']||function(_0x4148a0){const _0xc453e5=a243_0x16eeae;if(_0x4148a0&&_0x4148a0['__esModule'])return _0x4148a0;var _0x3f2a5f={};if(_0x4148a0!=null){for(var _0x55e245 in _0x4148a0)if(_0x55e245!==_0xc453e5(0x1f8)&&Object[_0xc453e5(0x1ec)][_0xc453e5(0x1f9)]['call'](_0x4148a0,_0x55e245))__createBinding(_0x3f2a5f,_0x4148a0,_0x55e245);}return __setModuleDefault(_0x3f2a5f,_0x4148a0),_0x3f2a5f;},__metadata=this&&this[a243_0x16eeae(0x22a)]||function(_0x14d17c,_0x174a6d){const _0x39c602=a243_0x16eeae;if(typeof Reflect===_0x39c602(0x1f4)&&typeof Reflect[_0x39c602(0x211)]==='function')return Reflect[_0x39c602(0x211)](_0x14d17c,_0x174a6d);},__importDefault=this&&this['__importDefault']||function(_0x297d84){const _0x67d596=a243_0x16eeae;return _0x297d84&&_0x297d84[_0x67d596(0x209)]?_0x297d84:{'default':_0x297d84};},SalesforceAuthService_1;function a243_0x2d67(_0x510cac,_0x57fd40){const _0x5b5de2=a243_0xad03();return a243_0x2d67=function(_0x13d549,_0x241f1c){_0x13d549=_0x13d549-0x1e7;let _0xad036b=_0x5b5de2[_0x13d549];return _0xad036b;},a243_0x2d67(_0x510cac,_0x57fd40);}Object[a243_0x16eeae(0x222)](exports,a243_0x16eeae(0x209),{'value':!![]}),exports[a243_0x16eeae(0x208)]=void 0x0;const typedi_1=__importStar(require(a243_0x16eeae(0x23a))),errors_1=require(a243_0x16eeae(0x232)),core_1=require(a243_0x16eeae(0x1ed)),axios_1=__importDefault(require('axios')),utils_1=require('../../../shared/utils'),invalid_refresh_token_error_1=require(a243_0x16eeae(0x224)),auth_state_enum_1=require(a243_0x16eeae(0x20f)),unauthorized_salesforce_error_1=require(a243_0x16eeae(0x1ef)),constants_1=require(a243_0x16eeae(0x233)),providers_tokens_1=require('../../providers/providers.tokens');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(){const _0x4d53a7=a243_0x16eeae;this['AUTH_WAIT_TIME']=0x1388,this[_0x4d53a7(0x22c)]=auth_state_enum_1[_0x4d53a7(0x1f1)][_0x4d53a7(0x20b)],this['logger']=new core_1[(_0x4d53a7(0x214))](SalesforceAuthService_1['name']),this['setAuthDetails']();}async['setAuthDetails'](){const _0x2d9fbf=a243_0x16eeae;this['logger'][_0x2d9fbf(0x1f2)]('Check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x2d9fbf(0x1f1)][this[_0x2d9fbf(0x22c)]]);try{if(this['authState']===auth_state_enum_1['AuthState'][_0x2d9fbf(0x228)])return;if(this['authState']===auth_state_enum_1[_0x2d9fbf(0x1f1)][_0x2d9fbf(0x20b)])await this[_0x2d9fbf(0x1e9)]();else{const _0x122929=await this[_0x2d9fbf(0x234)](),_0x53af82=await axios_1[_0x2d9fbf(0x1f8)][_0x2d9fbf(0x213)](_0x2d9fbf(0x1ea)+constants_1[_0x2d9fbf(0x1fe)],_0x122929)['then'](()=>!![])[_0x2d9fbf(0x1fc)](()=>![]);!_0x53af82&&await this['updateAccessToken']();}}catch(_0x12ecd1){}}async[a243_0x16eeae(0x1e9)](){const _0x38220c=a243_0x16eeae;var _0x438a9c,_0x2d7f34,_0x8d3f4c;this['logger']['log'](_0x38220c(0x21f));try{this[_0x38220c(0x22c)]=auth_state_enum_1['AuthState'][_0x38220c(0x22e)];const {refreshToken:_0x17d0c7,clientId:_0x5ef6bd,clientSecret:_0x5795c0,loginUrl:_0x3787ed}=typedi_1['default'][_0x38220c(0x213)](providers_tokens_1[_0x38220c(0x212)][_0x38220c(0x237)]),{data:_0x2ae2fe}=await axios_1[_0x38220c(0x1f8)][_0x38220c(0x20d)]((0x0,utils_1['joinURL'])(_0x3787ed,_0x38220c(0x216)),null,{'params':{'grant_type':_0x38220c(0x21a),'refresh_token':_0x17d0c7,'client_id':_0x5ef6bd,'client_secret':_0x5795c0}});this['instanceUrl']=_0x2ae2fe[_0x38220c(0x223)],this[_0x38220c(0x231)]=_0x2ae2fe[_0x38220c(0x206)],this[_0x38220c(0x1fa)]=_0x2ae2fe[_0x38220c(0x1fb)],this[_0x38220c(0x22c)]=auth_state_enum_1[_0x38220c(0x1f1)][_0x38220c(0x21b)],this['logger']['log']('Access\x20token\x20updated\x20for\x20%s',this[_0x38220c(0x204)]);}catch(_0x25ddfd){const _0x1e9d84=((_0x2d7f34=(_0x438a9c=_0x25ddfd===null||_0x25ddfd===void 0x0?void 0x0:_0x25ddfd[_0x38220c(0x1e8)])===null||_0x438a9c===void 0x0?void 0x0:_0x438a9c[_0x38220c(0x22d)])===null||_0x2d7f34===void 0x0?void 0x0:_0x2d7f34[_0x38220c(0x1ee)])||((_0x8d3f4c=_0x25ddfd===null||_0x25ddfd===void 0x0?void 0x0:_0x25ddfd[_0x38220c(0x1e8)])===null||_0x8d3f4c===void 0x0?void 0x0:_0x8d3f4c['data'])||_0x25ddfd[_0x38220c(0x1f6)];this[_0x38220c(0x1f5)][_0x38220c(0x1ee)](_0x38220c(0x22f),_0x1e9d84),this[_0x38220c(0x22c)]=auth_state_enum_1[_0x38220c(0x1f1)][_0x38220c(0x228)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x38220c(0x23b)]);}}async['forceUpdateToken'](){const _0x2fe9ee=a243_0x16eeae;this[_0x2fe9ee(0x1f5)][_0x2fe9ee(0x1f2)](_0x2fe9ee(0x1f3));if(this['authState']===auth_state_enum_1[_0x2fe9ee(0x1f1)][_0x2fe9ee(0x22e)]||this[_0x2fe9ee(0x22c)]===auth_state_enum_1[_0x2fe9ee(0x1f1)][_0x2fe9ee(0x20b)])return await(0x0,utils_1[_0x2fe9ee(0x230)])(this[_0x2fe9ee(0x203)]),this[_0x2fe9ee(0x235)]();if(this['authState']===auth_state_enum_1[_0x2fe9ee(0x1f1)][_0x2fe9ee(0x228)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x2fe9ee(0x23b)]);await this[_0x2fe9ee(0x1e9)]();}async['waitAuth'](){const _0xb7cd64=a243_0x16eeae;if(this[_0xb7cd64(0x22c)]===auth_state_enum_1[_0xb7cd64(0x1f1)][_0xb7cd64(0x228)]){this[_0xb7cd64(0x1f5)][_0xb7cd64(0x1f2)](_0xb7cd64(0x205));throw new unauthorized_salesforce_error_1[(_0xb7cd64(0x21c))]();}if(this['authState']!==auth_state_enum_1[_0xb7cd64(0x1f1)][_0xb7cd64(0x21b)])return this[_0xb7cd64(0x1f5)][_0xb7cd64(0x1f2)](_0xb7cd64(0x22b)),await(0x0,utils_1[_0xb7cd64(0x230)])(this[_0xb7cd64(0x203)]),this[_0xb7cd64(0x1fd)]();}[a243_0x16eeae(0x1ff)](){const _0x2f9ab8=a243_0x16eeae;return{'orgId':this[_0x2f9ab8(0x20e)],'accessToken':this['accessToken'],'instanceUrl':this['instanceUrl']};}async[a243_0x16eeae(0x234)](){const _0x4cc71e=a243_0x16eeae;return await this[_0x4cc71e(0x1fd)](),{'baseURL':this[_0x4cc71e(0x204)],'headers':{'accept':_0x4cc71e(0x217),'authorization':this['tokenType']+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a243_0x16eeae(0x20c)])(),__metadata('design:paramtypes',[])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;function a243_0xad03(){const _0x152d7d=['AUTH_WAIT_TIME','instanceUrl','Create\x20authorized\x20request\x20failed:\x20authorization\x20error','access_token','function','SalesforceAuthService','__esModule','decorate','Idle','Service','post','orgId','../enums/auth-state.enum','(((.+)+)+)+$','metadata','Tokens','get','Logger','length','/services/oauth2/token','application/json','configurable','writable','refresh_token','Active','UnauthorizedSalesforceError','33umFlaR','1482792YJYDKj','Update\x20access\x20token','3479216lvyIkW','search','defineProperty','instance_url','../errors/invalid-refresh-token.error','644168sHtJle','getOwnPropertyDescriptor','__createBinding','Error','create','__metadata','Create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','authState','data','Updating','Update\x20access\x20token\x20failed:\x20%s','sleep','accessToken','../../../../constants/errors','../../../../constants','requestConfig','forceUpdateToken','6190510DRDzAI','salesforce','85623YfuUxp','3307797mgVkrL','typedi','ERR_INVALID_SALESFORCE_TOKEN','toString','response','updateAccessToken','services/data/','68UvlXzn','prototype','../../../../core','error','../errors/unauthorized-salesforce.error','165aNoTPk','AuthState','log','Force\x20update\x20token','object','logger','message','constructor','default','hasOwnProperty','tokenType','token_type','catch','waitAuth','SALESFORCE_API_VERSION','getAuthData','__decorate','162204wTLgwH','48QkjVHM'];a243_0xad03=function(){return _0x152d7d;};return a243_0xad03();}