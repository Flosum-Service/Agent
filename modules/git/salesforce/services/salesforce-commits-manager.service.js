const a271_0x3600a1=a271_0x3315;(function(_0x2edcaa,_0x2ca84c){const _0x1b8f47=a271_0x3315,_0x3ce9f8=_0x2edcaa();while(!![]){try{const _0x23d0ed=parseInt(_0x1b8f47(0x1ea))/0x1+-parseInt(_0x1b8f47(0x1da))/0x2*(-parseInt(_0x1b8f47(0x1e7))/0x3)+parseInt(_0x1b8f47(0x1b4))/0x4*(-parseInt(_0x1b8f47(0x1aa))/0x5)+parseInt(_0x1b8f47(0x1a7))/0x6+parseInt(_0x1b8f47(0x1bf))/0x7*(-parseInt(_0x1b8f47(0x1b1))/0x8)+parseInt(_0x1b8f47(0x1ab))/0x9+-parseInt(_0x1b8f47(0x1cc))/0xa;if(_0x23d0ed===_0x2ca84c)break;else _0x3ce9f8['push'](_0x3ce9f8['shift']());}catch(_0x872552){_0x3ce9f8['push'](_0x3ce9f8['shift']());}}}(a271_0x5748,0xb3578));const a271_0x226e2a=(function(){let _0x3d2a7e=!![];return function(_0x49710f,_0x37d122){const _0x30966c=_0x3d2a7e?function(){const _0x46ed1e=a271_0x3315;if(_0x37d122){const _0xe95150=_0x37d122[_0x46ed1e(0x1c8)](_0x49710f,arguments);return _0x37d122=null,_0xe95150;}}:function(){};return _0x3d2a7e=![],_0x30966c;};}()),a271_0x29f6a0=a271_0x226e2a(this,function(){const _0x2ccf0b=a271_0x3315;return a271_0x29f6a0[_0x2ccf0b(0x1e4)]()[_0x2ccf0b(0x1c2)]('(((.+)+)+)+$')['toString']()[_0x2ccf0b(0x1e9)](a271_0x29f6a0)[_0x2ccf0b(0x1c2)](_0x2ccf0b(0x1d6));});a271_0x29f6a0();'use strict';function a271_0x5748(){const _0x2f0c4d=['867897bVHqfU','../../../shared/utils','proceedCommitsToRepository','proceedChunksToUpload','find','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','1955472uhDQqW','length','update','16SLiCdD','../errors/salesforce.error','delete','__esModule','sfLogger','insert','options','proceedRequests','logger','SalesforceCompositeService','proceedCommits','28YziBMo','reference','getProceededComponentsMeta','search','manifests','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','SalesforceCommitsManager','Sending\x20','SALESFORCE_MAX_REQUEST_SIZE_BYTES','apply','author','inserted','get','182490LPuESY','executeGraphs','SalesforceComponentsManager','Logger','stringify','SalesforceError','log','../utils/composite.utils','componentsToUpdate','COMPONENTS_PER_CHUNK','(((.+)+)+)+$','componentsToDelete','reduce','removed','2THmUek','extractComponentIdsFromGraphsResponse','defineProperty','name','./salesforce-composite.service','\x20requests\x20to\x20composite\x20api.','proceededComponentsMeta','default','chunkArray','componentId','toString','composite','../../../../core','1505988pbeFTK','map','constructor','1450150aeKPqx','../../../../constants','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','repositoryId','recordTypes','__importDefault','modified','push','typedi','graph','proceedCommitsToBranch','commitId','4084044kDdPQL','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','branchId','1248355AyvExC'];a271_0x5748=function(){return _0x2f0c4d;};return a271_0x5748();}function a271_0x3315(_0xd6ea51,_0x4a4039){const _0x2abe31=a271_0x5748();return a271_0x3315=function(_0x29f6a0,_0x226e2a){_0x29f6a0=_0x29f6a0-0x1a3;let _0x574897=_0x2abe31[_0x29f6a0];return _0x574897;},a271_0x3315(_0xd6ea51,_0x4a4039);}var __importDefault=this&&this[a271_0x3600a1(0x1ef)]||function(_0xb1dd40){const _0x47e026=a271_0x3600a1;return _0xb1dd40&&_0xb1dd40[_0x47e026(0x1b7)]?_0xb1dd40:{'default':_0xb1dd40};};Object[a271_0x3600a1(0x1dc)](exports,'__esModule',{'value':!![]}),exports[a271_0x3600a1(0x1c5)]=void 0x0;const core_1=require(a271_0x3600a1(0x1e6)),typedi_1=__importDefault(require(a271_0x3600a1(0x1a3))),constants_1=require(a271_0x3600a1(0x1eb)),utils_1=require(a271_0x3600a1(0x1ac)),salesforce_error_1=require(a271_0x3600a1(0x1b5)),composite_utils_1=require(a271_0x3600a1(0x1d3)),salesforce_components_manager_service_1=require('./salesforce-components-manager.service'),salesforce_composite_service_1=require(a271_0x3600a1(0x1de));class SalesforceCommitsManager{constructor(_0x4b426b){const _0x255f7f=a271_0x3600a1;this[_0x255f7f(0x1ba)]=_0x4b426b,this['COMPONENTS_PER_CHUNK']=0x3,this['logger']=new core_1[(_0x255f7f(0x1cf))](SalesforceCommitsManager[_0x255f7f(0x1dd)]),this[_0x255f7f(0x1b8)]=this[_0x255f7f(0x1ba)]['logger'],this[_0x255f7f(0x1e5)]=typedi_1[_0x255f7f(0x1e1)][_0x255f7f(0x1cb)](salesforce_composite_service_1[_0x255f7f(0x1bd)]),this['proceededComponentsMeta']=[];}async[a271_0x3600a1(0x1ae)](_0x24baf4,_0x1b2db2=![]){const _0x11b721=a271_0x3600a1,_0x3c11e9=async _0x30c487=>{const _0x171fbb=a271_0x3315;await this[_0x171fbb(0x1bc)][_0x171fbb(0x1d2)](_0x171fbb(0x1c6)+_0x30c487[_0x171fbb(0x1d8)]((_0x3fadaf,_0x350b06)=>_0x3fadaf+_0x350b06[_0x171fbb(0x1b2)],0x0)+_0x171fbb(0x1df));const _0x4e8869=_0x30c487[_0x171fbb(0x1e8)]((_0x20a987,_0x3ddf90)=>({'graphId':_0x171fbb(0x1a4)+_0x3ddf90,'compositeRequest':_0x20a987})),_0x4ae2d5=await this[_0x171fbb(0x1e5)][_0x171fbb(0x1cd)](_0x4e8869);if(_0x1b2db2){const _0x1318dc=(0x0,composite_utils_1[_0x171fbb(0x1db)])(_0x4ae2d5);for(const {id:_0x5d6f95,ref:_0x5c37b4}of _0x1318dc){const _0xd6730c=this[_0x171fbb(0x1e0)][_0x171fbb(0x1af)](_0x19feaf=>_0x19feaf[_0x171fbb(0x1c0)]===_0x5c37b4);_0xd6730c&&(_0xd6730c[_0x171fbb(0x1e3)]=_0x5d6f95);}}},_0xe626b9=0x1e8480;let _0x57d651=0x0,_0x405d2a=[];for(const _0xf06daa of _0x24baf4){const _0x199e8c=_0xf06daa[_0x11b721(0x1d8)]((_0x449ff0,_0x20bd09)=>{const _0x19e349=_0x11b721,_0x2a19b9=JSON[_0x19e349(0x1d0)](_0x20bd09)[_0x19e349(0x1b2)]*0x2;return _0x449ff0+_0x2a19b9;},0x0);if(_0x199e8c>constants_1[_0x11b721(0x1c7)])throw new salesforce_error_1[(_0x11b721(0x1d1))](_0x11b721(0x1a8)+constants_1[_0x11b721(0x1c7)]+'\x20COMPONENTS_SIZE\x20=\x20'+_0x199e8c);_0x57d651+_0x199e8c>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']-_0xe626b9&&(await _0x3c11e9(_0x405d2a),_0x405d2a=[],_0x57d651=0x0),_0x57d651+=_0x199e8c,_0x405d2a[_0x11b721(0x1f1)](_0xf06daa);}_0x405d2a[_0x11b721(0x1b2)]&&await _0x3c11e9(_0x405d2a);}async['proceedRequests'](_0x29c6ad,_0x3fe131=![]){const _0x8225ff=a271_0x3600a1,_0x30fdc1=(this[_0x8225ff(0x1d5)]+ +_0x3fe131)*0x3,_0x3c7216=(0x0,utils_1[_0x8225ff(0x1e2)])(_0x29c6ad,_0x30fdc1);try{while(_0x3c7216[_0x8225ff(0x1b2)]){const _0x84d2ee=_0x3c7216['splice'](0x0,Math['floor'](constants_1[_0x8225ff(0x1ec)]/_0x30fdc1));await this[_0x8225ff(0x1ae)](_0x84d2ee,_0x3fe131);}}catch(_0x4f7282){this[_0x8225ff(0x1bc)]['error'](_0x4f7282 instanceof salesforce_error_1[_0x8225ff(0x1d1)]?JSON[_0x8225ff(0x1d0)](_0x4f7282['toJSON'](),null,0x2):_0x4f7282),this['sfLogger']['log'](_0x4f7282 instanceof salesforce_error_1[_0x8225ff(0x1d1)]?JSON['stringify'](_0x4f7282['toJSON'](),null,0x2):_0x4f7282[_0x8225ff(0x1e4)]());throw _0x4f7282;}}async[a271_0x3600a1(0x1ad)](_0x3edbe1){const _0x5a10ce=a271_0x3600a1;for(const _0x4c14ad of _0x3edbe1){if(!_0x4c14ad[_0x5a10ce(0x1ca)][_0x5a10ce(0x1b2)]&&!_0x4c14ad['modified'][_0x5a10ce(0x1b2)]&&!_0x4c14ad[_0x5a10ce(0x1d9)]['length'])continue;const _0x150073=[],_0x38c0fe=[],_0x5bfec8=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x5a10ce(0x1ba)][_0x5a10ce(0x1ed)],this[_0x5a10ce(0x1ba)][_0x5a10ce(0x1a9)],_0x4c14ad[_0x5a10ce(0x1c9)],this[_0x5a10ce(0x1ba)][_0x5a10ce(0x1ee)],this[_0x5a10ce(0x1e0)]);_0x150073['push'](...await _0x5bfec8['insert'](_0x4c14ad[_0x5a10ce(0x1ca)],this[_0x5a10ce(0x1ba)][_0x5a10ce(0x1a6)])),_0x150073[_0x5a10ce(0x1f1)](...await _0x5bfec8[_0x5a10ce(0x1b3)](_0x4c14ad[_0x5a10ce(0x1f0)],this[_0x5a10ce(0x1ba)][_0x5a10ce(0x1a6)])),_0x38c0fe[_0x5a10ce(0x1f1)](await _0x5bfec8[_0x5a10ce(0x1b6)](_0x4c14ad[_0x5a10ce(0x1d9)],!![])),this[_0x5a10ce(0x1e0)]=_0x5bfec8[_0x5a10ce(0x1c1)](),await this['proceedRequests'](_0x150073,!![]);for(const _0x3bd40f of _0x38c0fe){_0x3bd40f[_0x5a10ce(0x1c3)][_0x5a10ce(0x1b2)]&&await this['proceedRequests'](_0x3bd40f[_0x5a10ce(0x1c3)],!![]),_0x3bd40f[_0x5a10ce(0x1d4)][_0x5a10ce(0x1b2)]&&await this[_0x5a10ce(0x1bb)](_0x3bd40f[_0x5a10ce(0x1d4)],!![]),_0x3bd40f['componentsToDelete'][_0x5a10ce(0x1b2)]&&await this[_0x5a10ce(0x1bb)](_0x3bd40f[_0x5a10ce(0x1d7)],!![]);}this[_0x5a10ce(0x1bc)][_0x5a10ce(0x1d2)](_0x5a10ce(0x1b0),_0x150073['length']);}}async['proceedCommitsToBranch'](_0x41c54e){const _0x3f2cf2=a271_0x3600a1,_0x196122=[],_0x28a1e8=[];for(const _0x34633f of _0x41c54e){if(!_0x34633f[_0x3f2cf2(0x1ca)]['length']&&!_0x34633f['modified'][_0x3f2cf2(0x1b2)]&&!_0x34633f[_0x3f2cf2(0x1d9)][_0x3f2cf2(0x1b2)])continue;const _0x46ad22=new salesforce_components_manager_service_1[(_0x3f2cf2(0x1ce))](this[_0x3f2cf2(0x1ba)]['repositoryId'],this[_0x3f2cf2(0x1ba)][_0x3f2cf2(0x1a9)],_0x34633f[_0x3f2cf2(0x1c9)],this[_0x3f2cf2(0x1ba)]['recordTypes'],[]);_0x196122[_0x3f2cf2(0x1f1)](...await _0x46ad22[_0x3f2cf2(0x1b9)](_0x34633f[_0x3f2cf2(0x1ca)])),_0x196122[_0x3f2cf2(0x1f1)](...await _0x46ad22[_0x3f2cf2(0x1b3)](_0x34633f[_0x3f2cf2(0x1f0)])),_0x28a1e8[_0x3f2cf2(0x1f1)](await _0x46ad22[_0x3f2cf2(0x1b6)](_0x34633f['removed']));}this['logger'][_0x3f2cf2(0x1d2)](_0x3f2cf2(0x1c4),_0x196122[_0x3f2cf2(0x1b2)]),await this[_0x3f2cf2(0x1bb)](_0x196122);const _0x2a74c7=_0x28a1e8[_0x3f2cf2(0x1d8)]((_0x3e9b17,_0x552190)=>({'manifests':[..._0x3e9b17[_0x3f2cf2(0x1c3)],..._0x552190[_0x3f2cf2(0x1c3)]],'componentsToDelete':[..._0x3e9b17[_0x3f2cf2(0x1d7)],..._0x552190[_0x3f2cf2(0x1d7)]],'componentsToUpdate':[..._0x3e9b17[_0x3f2cf2(0x1d4)],..._0x552190[_0x3f2cf2(0x1d4)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x2a74c7[_0x3f2cf2(0x1c3)]['length']&&await this[_0x3f2cf2(0x1bb)](_0x2a74c7[_0x3f2cf2(0x1c3)],!![]),_0x2a74c7[_0x3f2cf2(0x1d4)][_0x3f2cf2(0x1b2)]&&await this[_0x3f2cf2(0x1bb)](_0x2a74c7['componentsToUpdate'],!![]),_0x2a74c7['componentsToDelete'][_0x3f2cf2(0x1b2)]&&await this['proceedRequests'](_0x2a74c7[_0x3f2cf2(0x1d7)],!![]);}async[a271_0x3600a1(0x1be)](_0x33b0d7){const _0x4d5c1c=a271_0x3600a1;this['options']['branchId']?await this[_0x4d5c1c(0x1a5)](_0x33b0d7):await this[_0x4d5c1c(0x1ad)](_0x33b0d7);}}exports[a271_0x3600a1(0x1c5)]=SalesforceCommitsManager;