const a233_0x47fea2=a233_0x56c9;(function(_0x194bfb,_0x4da124){const _0x4582d2=a233_0x56c9,_0x3333e1=_0x194bfb();while(!![]){try{const _0x4d8349=-parseInt(_0x4582d2(0x1f5))/0x1+parseInt(_0x4582d2(0x1f6))/0x2*(parseInt(_0x4582d2(0x1e4))/0x3)+-parseInt(_0x4582d2(0x1b9))/0x4+parseInt(_0x4582d2(0x1da))/0x5*(-parseInt(_0x4582d2(0x1fd))/0x6)+parseInt(_0x4582d2(0x1c0))/0x7*(parseInt(_0x4582d2(0x1f7))/0x8)+parseInt(_0x4582d2(0x1e7))/0x9*(parseInt(_0x4582d2(0x1df))/0xa)+parseInt(_0x4582d2(0x1d6))/0xb;if(_0x4d8349===_0x4da124)break;else _0x3333e1['push'](_0x3333e1['shift']());}catch(_0x5c1d17){_0x3333e1['push'](_0x3333e1['shift']());}}}(a233_0x7959,0xe8641));const a233_0x42f2c3=(function(){let _0x51d98d=!![];return function(_0x28763f,_0x5754e7){const _0xf406f=_0x51d98d?function(){if(_0x5754e7){const _0xc2e672=_0x5754e7['apply'](_0x28763f,arguments);return _0x5754e7=null,_0xc2e672;}}:function(){};return _0x51d98d=![],_0xf406f;};}()),a233_0x4dd731=a233_0x42f2c3(this,function(){const _0x28ba07=a233_0x56c9;return a233_0x4dd731['toString']()[_0x28ba07(0x1cd)](_0x28ba07(0x1d8))[_0x28ba07(0x1c4)]()[_0x28ba07(0x1e3)](a233_0x4dd731)[_0x28ba07(0x1cd)](_0x28ba07(0x1d8));});a233_0x4dd731();'use strict';function a233_0x7959(){const _0x147776=['reduce','map','modified','proceedCommitsToBranch','2526629BlGJax','logger','proceededComponentsMeta','removed','toString','repositoryId','proceedCommitsToRepository','author','Logger','componentId','commitId','./salesforce-components-manager.service','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','search','../utils/composite.utils','splice','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','SalesforceCommitsManager','floor','length','recordTypes','inserted','9251748ruhNbZ','manifests','(((.+)+)+)+$','toJSON','430VogwpJ','COMPONENTS_PER_CHUNK','../../../shared/utils','Sending\x20','delete','15727310hAlucy','\x20COMPONENTS_SIZE\x20=\x20','typedi','\x20requests\x20to\x20composite\x20api.','constructor','81NPQkKI','graph','insert','9JYmMML','default','branchId','reference','name','error','proceedRequests','SalesforceError','__importDefault','SALESFORCE_MAX_REQUEST_SIZE_BYTES','componentsToDelete','push','get','stringify','1205117EnshKl','35286JmTkpM','24ItrMkB','update','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','chunkArray','composite','SalesforceCompositeService','40686dCcyuX','sfLogger','componentsToUpdate','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','defineProperty','__esModule','4931380XYqHoe','log','options'];a233_0x7959=function(){return _0x147776;};return a233_0x7959();}function a233_0x56c9(_0x35f63b,_0x23d46b){const _0x57c3cf=a233_0x7959();return a233_0x56c9=function(_0x4dd731,_0x42f2c3){_0x4dd731=_0x4dd731-0x1b8;let _0x79598e=_0x57c3cf[_0x4dd731];return _0x79598e;},a233_0x56c9(_0x35f63b,_0x23d46b);}var __importDefault=this&&this[a233_0x47fea2(0x1ef)]||function(_0x17e576){const _0x8862f9=a233_0x47fea2;return _0x17e576&&_0x17e576[_0x8862f9(0x1b8)]?_0x17e576:{'default':_0x17e576};};Object[a233_0x47fea2(0x201)](exports,a233_0x47fea2(0x1b8),{'value':!![]}),exports[a233_0x47fea2(0x1d1)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require(a233_0x47fea2(0x1e1))),constants_1=require('../../../../constants'),utils_1=require(a233_0x47fea2(0x1dc)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a233_0x47fea2(0x1ce)),salesforce_components_manager_service_1=require(a233_0x47fea2(0x1cb)),salesforce_composite_service_1=require('./salesforce-composite.service');class SalesforceCommitsManager{constructor(_0x459e3e){const _0x2b6417=a233_0x47fea2;this[_0x2b6417(0x1bb)]=_0x459e3e,this[_0x2b6417(0x1db)]=0x3,this[_0x2b6417(0x1c1)]=new core_1[(_0x2b6417(0x1c8))](SalesforceCommitsManager[_0x2b6417(0x1eb)]),this[_0x2b6417(0x1fe)]=this[_0x2b6417(0x1bb)][_0x2b6417(0x1c1)],this['composite']=typedi_1[_0x2b6417(0x1e8)][_0x2b6417(0x1f3)](salesforce_composite_service_1[_0x2b6417(0x1fc)]),this[_0x2b6417(0x1c2)]=[];}async['proceedChunksToUpload'](_0x95a6dc,_0x5705c6=![]){const _0x4a7b37=a233_0x47fea2,_0x44822d=async _0x397dd2=>{const _0x28a74f=a233_0x56c9;await this[_0x28a74f(0x1c1)][_0x28a74f(0x1ba)](_0x28a74f(0x1dd)+_0x397dd2[_0x28a74f(0x1bc)]((_0x1a730,_0x1b596b)=>_0x1a730+_0x1b596b[_0x28a74f(0x1d3)],0x0)+_0x28a74f(0x1e2));const _0x6e4b43=_0x397dd2[_0x28a74f(0x1bd)]((_0x320530,_0x306392)=>({'graphId':_0x28a74f(0x1e5)+_0x306392,'compositeRequest':_0x320530})),_0x32bfee=await this[_0x28a74f(0x1fb)]['executeGraphs'](_0x6e4b43);if(_0x5705c6){const _0x45fe21=(0x0,composite_utils_1['extractComponentIdsFromGraphsResponse'])(_0x32bfee);for(const {id:_0x81a44,ref:_0xea4233}of _0x45fe21){const _0x4bb740=this[_0x28a74f(0x1c2)]['find'](_0x26ba2a=>_0x26ba2a[_0x28a74f(0x1ea)]===_0xea4233);_0x4bb740&&(_0x4bb740[_0x28a74f(0x1c9)]=_0x81a44);}}},_0x58fe34=0x1e8480;let _0x51fb9d=0x0,_0x27233d=[];for(const _0x411249 of _0x95a6dc){const _0x29a5cc=_0x411249['reduce']((_0xafa14a,_0x50ae30)=>{const _0x1d3ee9=a233_0x56c9,_0x82a283=JSON['stringify'](_0x50ae30)[_0x1d3ee9(0x1d3)]*0x2;return _0xafa14a+_0x82a283;},0x0);if(_0x29a5cc>constants_1[_0x4a7b37(0x1f0)])throw new salesforce_error_1['SalesforceError'](_0x4a7b37(0x1cc)+constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']+_0x4a7b37(0x1e0)+_0x29a5cc);_0x51fb9d+_0x29a5cc>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']-_0x58fe34&&(await _0x44822d(_0x27233d),_0x27233d=[],_0x51fb9d=0x0),_0x51fb9d+=_0x29a5cc,_0x27233d[_0x4a7b37(0x1f2)](_0x411249);}_0x27233d[_0x4a7b37(0x1d3)]&&await _0x44822d(_0x27233d);}async[a233_0x47fea2(0x1ed)](_0x262c29,_0x1e0199=![]){const _0x19ab31=a233_0x47fea2,_0x119748=(this[_0x19ab31(0x1db)]+ +_0x1e0199)*0x3,_0x5a2cff=(0x0,utils_1[_0x19ab31(0x1fa)])(_0x262c29,_0x119748);try{while(_0x5a2cff[_0x19ab31(0x1d3)]){const _0xebacb=_0x5a2cff[_0x19ab31(0x1cf)](0x0,Math[_0x19ab31(0x1d2)](constants_1[_0x19ab31(0x1f9)]/_0x119748));await this['proceedChunksToUpload'](_0xebacb,_0x1e0199);}}catch(_0x2ed3a1){this[_0x19ab31(0x1c1)][_0x19ab31(0x1ec)](_0x2ed3a1 instanceof salesforce_error_1[_0x19ab31(0x1ee)]?JSON['stringify'](_0x2ed3a1[_0x19ab31(0x1d9)](),null,0x2):_0x2ed3a1),this[_0x19ab31(0x1fe)][_0x19ab31(0x1ba)](_0x2ed3a1 instanceof salesforce_error_1['SalesforceError']?JSON[_0x19ab31(0x1f4)](_0x2ed3a1[_0x19ab31(0x1d9)](),null,0x2):_0x2ed3a1[_0x19ab31(0x1c4)]());throw _0x2ed3a1;}}async[a233_0x47fea2(0x1c6)](_0x217089){const _0x251462=a233_0x47fea2;for(const _0x3fed88 of _0x217089){if(!_0x3fed88[_0x251462(0x1d5)][_0x251462(0x1d3)]&&!_0x3fed88['modified']['length']&&!_0x3fed88[_0x251462(0x1c3)][_0x251462(0x1d3)])continue;const _0x3bcaf5=[],_0x28bf18=[],_0xb67032=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x251462(0x1bb)]['repositoryId'],this[_0x251462(0x1bb)][_0x251462(0x1e9)],_0x3fed88[_0x251462(0x1c7)],this[_0x251462(0x1bb)]['recordTypes'],this[_0x251462(0x1c2)]);_0x3bcaf5['push'](...await _0xb67032[_0x251462(0x1e6)](_0x3fed88[_0x251462(0x1d5)],this[_0x251462(0x1bb)][_0x251462(0x1ca)])),_0x3bcaf5[_0x251462(0x1f2)](...await _0xb67032[_0x251462(0x1f8)](_0x3fed88['modified'],this[_0x251462(0x1bb)]['commitId'])),_0x28bf18[_0x251462(0x1f2)](await _0xb67032[_0x251462(0x1de)](_0x3fed88[_0x251462(0x1c3)],!![])),this[_0x251462(0x1c2)]=_0xb67032['getProceededComponentsMeta'](),await this[_0x251462(0x1ed)](_0x3bcaf5,!![]);for(const _0x28bad0 of _0x28bf18){_0x28bad0['manifests']['length']&&await this[_0x251462(0x1ed)](_0x28bad0[_0x251462(0x1d7)],!![]),_0x28bad0['componentsToUpdate'][_0x251462(0x1d3)]&&await this[_0x251462(0x1ed)](_0x28bad0[_0x251462(0x1ff)],!![]),_0x28bad0['componentsToDelete']['length']&&await this['proceedRequests'](_0x28bad0[_0x251462(0x1f1)],!![]);}this[_0x251462(0x1c1)]['log'](_0x251462(0x1d0),_0x3bcaf5[_0x251462(0x1d3)]);}}async[a233_0x47fea2(0x1bf)](_0x3ae83b){const _0x4dd428=a233_0x47fea2,_0x182c5e=[],_0x1ed539=[];for(const _0x258ece of _0x3ae83b){if(!_0x258ece[_0x4dd428(0x1d5)]['length']&&!_0x258ece['modified'][_0x4dd428(0x1d3)]&&!_0x258ece[_0x4dd428(0x1c3)][_0x4dd428(0x1d3)])continue;const _0x447458=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this['options'][_0x4dd428(0x1c5)],this[_0x4dd428(0x1bb)][_0x4dd428(0x1e9)],_0x258ece['author'],this[_0x4dd428(0x1bb)][_0x4dd428(0x1d4)],[]);_0x182c5e[_0x4dd428(0x1f2)](...await _0x447458[_0x4dd428(0x1e6)](_0x258ece['inserted'])),_0x182c5e['push'](...await _0x447458['update'](_0x258ece[_0x4dd428(0x1be)])),_0x1ed539[_0x4dd428(0x1f2)](await _0x447458[_0x4dd428(0x1de)](_0x258ece[_0x4dd428(0x1c3)]));}this['logger'][_0x4dd428(0x1ba)](_0x4dd428(0x200),_0x182c5e[_0x4dd428(0x1d3)]),await this[_0x4dd428(0x1ed)](_0x182c5e);const _0x235421=_0x1ed539['reduce']((_0x553d5a,_0x290421)=>({'manifests':[..._0x553d5a[_0x4dd428(0x1d7)],..._0x290421[_0x4dd428(0x1d7)]],'componentsToDelete':[..._0x553d5a[_0x4dd428(0x1f1)],..._0x290421[_0x4dd428(0x1f1)]],'componentsToUpdate':[..._0x553d5a['componentsToUpdate'],..._0x290421[_0x4dd428(0x1ff)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x235421[_0x4dd428(0x1d7)][_0x4dd428(0x1d3)]&&await this[_0x4dd428(0x1ed)](_0x235421[_0x4dd428(0x1d7)],!![]),_0x235421[_0x4dd428(0x1ff)]['length']&&await this[_0x4dd428(0x1ed)](_0x235421['componentsToUpdate'],!![]),_0x235421['componentsToDelete'][_0x4dd428(0x1d3)]&&await this[_0x4dd428(0x1ed)](_0x235421[_0x4dd428(0x1f1)],!![]);}async['proceedCommits'](_0xa96d81){const _0x351acc=a233_0x47fea2;this[_0x351acc(0x1bb)]['branchId']?await this[_0x351acc(0x1bf)](_0xa96d81):await this[_0x351acc(0x1c6)](_0xa96d81);}}exports[a233_0x47fea2(0x1d1)]=SalesforceCommitsManager;