const a233_0x42d020=a233_0x2727;(function(_0x32c085,_0x13b397){const _0x115bca=a233_0x2727,_0x35825f=_0x32c085();while(!![]){try{const _0x32dfdb=-parseInt(_0x115bca(0xa1))/0x1*(parseInt(_0x115bca(0xcb))/0x2)+-parseInt(_0x115bca(0x92))/0x3*(-parseInt(_0x115bca(0xaf))/0x4)+parseInt(_0x115bca(0xc8))/0x5+-parseInt(_0x115bca(0xd3))/0x6+-parseInt(_0x115bca(0xbb))/0x7+-parseInt(_0x115bca(0x99))/0x8*(parseInt(_0x115bca(0xa8))/0x9)+parseInt(_0x115bca(0xbf))/0xa;if(_0x32dfdb===_0x13b397)break;else _0x35825f['push'](_0x35825f['shift']());}catch(_0x519327){_0x35825f['push'](_0x35825f['shift']());}}}(a233_0x13b9,0x81857));const a233_0x4ba8b2=(function(){let _0x1e9cb1=!![];return function(_0x5df004,_0x4dc8e6){const _0x1e0b36=_0x1e9cb1?function(){if(_0x4dc8e6){const _0x4e56a3=_0x4dc8e6['apply'](_0x5df004,arguments);return _0x4dc8e6=null,_0x4e56a3;}}:function(){};return _0x1e9cb1=![],_0x1e0b36;};}()),a233_0x3f3d35=a233_0x4ba8b2(this,function(){const _0x1e5ae6=a233_0x2727;return a233_0x3f3d35['toString']()['search']('(((.+)+)+)+$')[_0x1e5ae6(0xc7)]()[_0x1e5ae6(0x9d)](a233_0x3f3d35)[_0x1e5ae6(0xb1)](_0x1e5ae6(0xb5));});a233_0x3f3d35();'use strict';function a233_0x2727(_0xfb7550,_0x5da2aa){const _0x32007f=a233_0x13b9();return a233_0x2727=function(_0x3f3d35,_0x4ba8b2){_0x3f3d35=_0x3f3d35-0x8b;let _0x13b913=_0x32007f[_0x3f3d35];return _0x13b913;},a233_0x2727(_0xfb7550,_0x5da2aa);}var __importDefault=this&&this[a233_0x42d020(0x8f)]||function(_0x273b11){return _0x273b11&&_0x273b11['__esModule']?_0x273b11:{'default':_0x273b11};};Object[a233_0x42d020(0xb4)](exports,a233_0x42d020(0xb9),{'value':!![]}),exports[a233_0x42d020(0xc5)]=void 0x0;const core_1=require(a233_0x42d020(0xcc)),typedi_1=__importDefault(require('typedi')),constants_1=require('../../../../constants'),utils_1=require('../../../shared/utils'),salesforce_error_1=require(a233_0x42d020(0xae)),composite_utils_1=require(a233_0x42d020(0xcf)),salesforce_components_manager_service_1=require(a233_0x42d020(0x98)),salesforce_composite_service_1=require('./salesforce-composite.service');function a233_0x13b9(){const _0x130456=['constructor','length','branchId','log','2053NTYqFc','author','SalesforceError','getProceededComponentsMeta','push','repositoryId','find','1494iGiWqj','default','executeGraphs','proceedCommitsToRepository','chunkArray','Sending\x20','../errors/salesforce.error','584OpkJLy','update','search','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','name','defineProperty','(((.+)+)+)+$','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','map','commitId','__esModule','\x20COMPONENTS_SIZE\x20=\x20','4100026EwfbQm','proceedRequests','stringify','SalesforceCompositeService','12217680aFYRJZ','graph','SALESFORCE_MAX_REQUEST_SIZE_BYTES','splice','extractComponentIdsFromGraphsResponse','proceedChunksToUpload','SalesforceCommitsManager','insert','toString','1167210JLJxAi','componentsToUpdate','componentId','718aporKI','../../../../core','logger','Logger','../utils/composite.utils','componentsToDelete','floor','removed','2371932hTzJCp','modified','sfLogger','proceededComponentsMeta','composite','reduce','__importDefault','toJSON','manifests','18591BZnpZj','SalesforceComponentsManager','proceedCommits','delete','inserted','recordTypes','./salesforce-components-manager.service','5368YbKIAZ','\x20requests\x20to\x20composite\x20api.','options','proceedCommitsToBranch'];a233_0x13b9=function(){return _0x130456;};return a233_0x13b9();}class SalesforceCommitsManager{constructor(_0x4818cc){const _0x28771c=a233_0x42d020;this[_0x28771c(0x9b)]=_0x4818cc,this['COMPONENTS_PER_CHUNK']=0x3,this['logger']=new core_1[(_0x28771c(0xce))](SalesforceCommitsManager[_0x28771c(0xb3)]),this[_0x28771c(0x8b)]=this[_0x28771c(0x9b)][_0x28771c(0xcd)],this[_0x28771c(0x8d)]=typedi_1[_0x28771c(0xa9)]['get'](salesforce_composite_service_1[_0x28771c(0xbe)]),this[_0x28771c(0x8c)]=[];}async[a233_0x42d020(0xc4)](_0x358625,_0x11658e=![]){const _0x3e8fe7=a233_0x42d020,_0x472389=async _0x3fe006=>{const _0x2cd74c=a233_0x2727;await this['logger'][_0x2cd74c(0xa0)](_0x2cd74c(0xad)+_0x3fe006[_0x2cd74c(0x8e)]((_0x3ff885,_0x564700)=>_0x3ff885+_0x564700[_0x2cd74c(0x9e)],0x0)+_0x2cd74c(0x9a));const _0x27efb6=_0x3fe006[_0x2cd74c(0xb7)]((_0x3f09d4,_0x456082)=>({'graphId':_0x2cd74c(0xc0)+_0x456082,'compositeRequest':_0x3f09d4})),_0x23dd51=await this[_0x2cd74c(0x8d)][_0x2cd74c(0xaa)](_0x27efb6);if(_0x11658e){const _0xffa262=(0x0,composite_utils_1[_0x2cd74c(0xc3)])(_0x23dd51);for(const {id:_0x1fe28f,ref:_0x4c0f84}of _0xffa262){const _0x44895d=this[_0x2cd74c(0x8c)][_0x2cd74c(0xa7)](_0x21c2e3=>_0x21c2e3['reference']===_0x4c0f84);_0x44895d&&(_0x44895d[_0x2cd74c(0xca)]=_0x1fe28f);}}},_0x2017b4=0x1e8480;let _0xe9e818=0x0,_0x2cf259=[];for(const _0x57ffbe of _0x358625){const _0x474b7b=_0x57ffbe[_0x3e8fe7(0x8e)]((_0x32bb8f,_0x73ab5)=>{const _0x1469f5=_0x3e8fe7,_0x35c76a=JSON['stringify'](_0x73ab5)[_0x1469f5(0x9e)]*0x2;return _0x32bb8f+_0x35c76a;},0x0);if(_0x474b7b>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES'])throw new salesforce_error_1[(_0x3e8fe7(0xa3))](_0x3e8fe7(0xb6)+constants_1[_0x3e8fe7(0xc1)]+_0x3e8fe7(0xba)+_0x474b7b);_0xe9e818+_0x474b7b>constants_1[_0x3e8fe7(0xc1)]-_0x2017b4&&(await _0x472389(_0x2cf259),_0x2cf259=[],_0xe9e818=0x0),_0xe9e818+=_0x474b7b,_0x2cf259[_0x3e8fe7(0xa5)](_0x57ffbe);}_0x2cf259['length']&&await _0x472389(_0x2cf259);}async[a233_0x42d020(0xbc)](_0x511b6a,_0x34b878=![]){const _0x2996fd=a233_0x42d020,_0x5c141e=(this['COMPONENTS_PER_CHUNK']+ +_0x34b878)*0x3,_0x115876=(0x0,utils_1[_0x2996fd(0xac)])(_0x511b6a,_0x5c141e);try{while(_0x115876[_0x2996fd(0x9e)]){const _0x493319=_0x115876[_0x2996fd(0xc2)](0x0,Math[_0x2996fd(0xd1)](constants_1[_0x2996fd(0xb2)]/_0x5c141e));await this[_0x2996fd(0xc4)](_0x493319,_0x34b878);}}catch(_0x427313){this[_0x2996fd(0xcd)]['error'](_0x427313 instanceof salesforce_error_1[_0x2996fd(0xa3)]?JSON[_0x2996fd(0xbd)](_0x427313[_0x2996fd(0x90)](),null,0x2):_0x427313),this[_0x2996fd(0x8b)][_0x2996fd(0xa0)](_0x427313 instanceof salesforce_error_1[_0x2996fd(0xa3)]?JSON[_0x2996fd(0xbd)](_0x427313[_0x2996fd(0x90)](),null,0x2):_0x427313[_0x2996fd(0xc7)]());throw _0x427313;}}async[a233_0x42d020(0xab)](_0x4120c3){const _0x1795a2=a233_0x42d020;for(const _0x3f9c8f of _0x4120c3){if(!_0x3f9c8f['inserted'][_0x1795a2(0x9e)]&&!_0x3f9c8f[_0x1795a2(0xd4)]['length']&&!_0x3f9c8f['removed'][_0x1795a2(0x9e)])continue;const _0x17d7b0=[],_0x2f1faa=[],_0xb2a253=new salesforce_components_manager_service_1[(_0x1795a2(0x93))](this[_0x1795a2(0x9b)][_0x1795a2(0xa6)],this[_0x1795a2(0x9b)][_0x1795a2(0x9f)],_0x3f9c8f[_0x1795a2(0xa2)],this[_0x1795a2(0x9b)][_0x1795a2(0x97)],this[_0x1795a2(0x8c)]);_0x17d7b0[_0x1795a2(0xa5)](...await _0xb2a253[_0x1795a2(0xc6)](_0x3f9c8f[_0x1795a2(0x96)],this[_0x1795a2(0x9b)][_0x1795a2(0xb8)])),_0x17d7b0[_0x1795a2(0xa5)](...await _0xb2a253['update'](_0x3f9c8f[_0x1795a2(0xd4)],this[_0x1795a2(0x9b)][_0x1795a2(0xb8)])),_0x2f1faa[_0x1795a2(0xa5)](await _0xb2a253[_0x1795a2(0x95)](_0x3f9c8f['removed'],!![])),this[_0x1795a2(0x8c)]=_0xb2a253[_0x1795a2(0xa4)](),await this[_0x1795a2(0xbc)](_0x17d7b0,!![]);for(const _0x5bce7c of _0x2f1faa){_0x5bce7c[_0x1795a2(0x91)][_0x1795a2(0x9e)]&&await this['proceedRequests'](_0x5bce7c['manifests'],!![]),_0x5bce7c[_0x1795a2(0xc9)][_0x1795a2(0x9e)]&&await this['proceedRequests'](_0x5bce7c[_0x1795a2(0xc9)],!![]),_0x5bce7c['componentsToDelete']['length']&&await this[_0x1795a2(0xbc)](_0x5bce7c[_0x1795a2(0xd0)],!![]);}this[_0x1795a2(0xcd)][_0x1795a2(0xa0)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x17d7b0[_0x1795a2(0x9e)]);}}async[a233_0x42d020(0x9c)](_0x5591a3){const _0x30cc55=a233_0x42d020,_0xf8559a=[],_0x25a7ff=[];for(const _0xb385d2 of _0x5591a3){if(!_0xb385d2[_0x30cc55(0x96)][_0x30cc55(0x9e)]&&!_0xb385d2[_0x30cc55(0xd4)]['length']&&!_0xb385d2['removed'][_0x30cc55(0x9e)])continue;const _0x82d783=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x30cc55(0x9b)][_0x30cc55(0xa6)],this['options'][_0x30cc55(0x9f)],_0xb385d2['author'],this[_0x30cc55(0x9b)][_0x30cc55(0x97)],[]);_0xf8559a[_0x30cc55(0xa5)](...await _0x82d783[_0x30cc55(0xc6)](_0xb385d2[_0x30cc55(0x96)])),_0xf8559a[_0x30cc55(0xa5)](...await _0x82d783[_0x30cc55(0xb0)](_0xb385d2['modified'])),_0x25a7ff[_0x30cc55(0xa5)](await _0x82d783[_0x30cc55(0x95)](_0xb385d2[_0x30cc55(0xd2)]));}this[_0x30cc55(0xcd)][_0x30cc55(0xa0)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)',_0xf8559a[_0x30cc55(0x9e)]),await this[_0x30cc55(0xbc)](_0xf8559a);const _0xe00387=_0x25a7ff[_0x30cc55(0x8e)]((_0xd775d5,_0x1c23df)=>({'manifests':[..._0xd775d5['manifests'],..._0x1c23df[_0x30cc55(0x91)]],'componentsToDelete':[..._0xd775d5[_0x30cc55(0xd0)],..._0x1c23df[_0x30cc55(0xd0)]],'componentsToUpdate':[..._0xd775d5[_0x30cc55(0xc9)],..._0x1c23df[_0x30cc55(0xc9)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0xe00387[_0x30cc55(0x91)]['length']&&await this[_0x30cc55(0xbc)](_0xe00387[_0x30cc55(0x91)],!![]),_0xe00387[_0x30cc55(0xc9)][_0x30cc55(0x9e)]&&await this[_0x30cc55(0xbc)](_0xe00387[_0x30cc55(0xc9)],!![]),_0xe00387[_0x30cc55(0xd0)][_0x30cc55(0x9e)]&&await this[_0x30cc55(0xbc)](_0xe00387[_0x30cc55(0xd0)],!![]);}async[a233_0x42d020(0x94)](_0x20a26f){const _0x53bbe7=a233_0x42d020;this[_0x53bbe7(0x9b)][_0x53bbe7(0x9f)]?await this[_0x53bbe7(0x9c)](_0x20a26f):await this[_0x53bbe7(0xab)](_0x20a26f);}}exports['SalesforceCommitsManager']=SalesforceCommitsManager;