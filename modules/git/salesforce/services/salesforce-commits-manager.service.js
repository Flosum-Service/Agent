const a271_0x2f3b14=a271_0x2149;function a271_0x2149(_0x85c031,_0x3f81b7){const _0x52cd15=a271_0x7677();return a271_0x2149=function(_0x5b3d2b,_0x277b2c){_0x5b3d2b=_0x5b3d2b-0x192;let _0x767750=_0x52cd15[_0x5b3d2b];return _0x767750;},a271_0x2149(_0x85c031,_0x3f81b7);}(function(_0x22e0f9,_0x39165a){const _0x147ce5=a271_0x2149,_0x598eea=_0x22e0f9();while(!![]){try{const _0x16998e=-parseInt(_0x147ce5(0x1c2))/0x1*(parseInt(_0x147ce5(0x1ca))/0x2)+parseInt(_0x147ce5(0x1b4))/0x3*(parseInt(_0x147ce5(0x19f))/0x4)+parseInt(_0x147ce5(0x1ad))/0x5+parseInt(_0x147ce5(0x1ac))/0x6+parseInt(_0x147ce5(0x1cf))/0x7+parseInt(_0x147ce5(0x1aa))/0x8+-parseInt(_0x147ce5(0x19b))/0x9;if(_0x16998e===_0x39165a)break;else _0x598eea['push'](_0x598eea['shift']());}catch(_0x18eb9d){_0x598eea['push'](_0x598eea['shift']());}}}(a271_0x7677,0xd9720));const a271_0x277b2c=(function(){let _0x14c308=!![];return function(_0x2c9c69,_0x1eb619){const _0x50eaca=_0x14c308?function(){const _0x4dd8d7=a271_0x2149;if(_0x1eb619){const _0x1f6472=_0x1eb619[_0x4dd8d7(0x193)](_0x2c9c69,arguments);return _0x1eb619=null,_0x1f6472;}}:function(){};return _0x14c308=![],_0x50eaca;};}()),a271_0x5b3d2b=a271_0x277b2c(this,function(){const _0x1b629a=a271_0x2149;return a271_0x5b3d2b['toString']()[_0x1b629a(0x195)]('(((.+)+)+)+$')[_0x1b629a(0x1ba)]()['constructor'](a271_0x5b3d2b)['search'](_0x1b629a(0x1a8));});function a271_0x7677(){const _0x4e6904=['proceedChunksToUpload','update','get','sfLogger','defineProperty','length','apply','proceedCommitsToBranch','search','delete','find','splice','author','componentId','28124892totWTL','componentsToDelete','SalesforceCompositeService','__importDefault','778212dYWNVN','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','proceedCommits','composite','../../../../core','graph','toJSON','\x20requests\x20to\x20composite\x20api.','manifests','(((.+)+)+)+$','__esModule','1542400nhqHAC','removed','10665156DuuMKa','283160ggiJGn','branchId','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','repositoryId','modified','push','COMPONENTS_PER_CHUNK','21qsBEmd','reduce','stringify','name','error','reference','toString','recordTypes','inserted','typedi','executeGraphs','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','../utils/composite.utils','componentsToUpdate','1448HRkphZ','SalesforceError','./salesforce-components-manager.service','proceedRequests','SALESFORCE_MAX_REQUEST_SIZE_BYTES','extractComponentIdsFromGraphsResponse','map','chunkArray','1474mJWcMB','logger','options','SalesforceComponentsManager','log','11857937fDdRMs','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','./salesforce-composite.service','proceededComponentsMeta','Logger','proceedCommitsToRepository'];a271_0x7677=function(){return _0x4e6904;};return a271_0x7677();}a271_0x5b3d2b();'use strict';var __importDefault=this&&this[a271_0x2f3b14(0x19e)]||function(_0x11b292){const _0x3fff2f=a271_0x2f3b14;return _0x11b292&&_0x11b292[_0x3fff2f(0x1a9)]?_0x11b292:{'default':_0x11b292};};Object[a271_0x2f3b14(0x1d9)](exports,a271_0x2f3b14(0x1a9),{'value':!![]}),exports['SalesforceCommitsManager']=void 0x0;const core_1=require(a271_0x2f3b14(0x1a3)),typedi_1=__importDefault(require(a271_0x2f3b14(0x1bd))),constants_1=require('../../../../constants'),utils_1=require('../../../shared/utils'),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a271_0x2f3b14(0x1c0)),salesforce_components_manager_service_1=require(a271_0x2f3b14(0x1c4)),salesforce_composite_service_1=require(a271_0x2f3b14(0x1d1));class SalesforceCommitsManager{constructor(_0x39d70e){const _0x41b574=a271_0x2f3b14;this['options']=_0x39d70e,this[_0x41b574(0x1b3)]=0x3,this['logger']=new core_1[(_0x41b574(0x1d3))](SalesforceCommitsManager[_0x41b574(0x1b7)]),this[_0x41b574(0x1d8)]=this[_0x41b574(0x1cc)][_0x41b574(0x1cb)],this[_0x41b574(0x1a2)]=typedi_1['default'][_0x41b574(0x1d7)](salesforce_composite_service_1[_0x41b574(0x19d)]),this[_0x41b574(0x1d2)]=[];}async[a271_0x2f3b14(0x1d5)](_0x5dc43f,_0x338be4=![]){const _0x3058c5=a271_0x2f3b14,_0x38e6aa=async _0x3aa671=>{const _0x19ffc4=a271_0x2149;await this[_0x19ffc4(0x1cb)][_0x19ffc4(0x1ce)]('Sending\x20'+_0x3aa671[_0x19ffc4(0x1b5)]((_0x456f61,_0x1b7dd2)=>_0x456f61+_0x1b7dd2[_0x19ffc4(0x192)],0x0)+_0x19ffc4(0x1a6));const _0x51c854=_0x3aa671[_0x19ffc4(0x1c8)]((_0x16f9ff,_0x4e6e36)=>({'graphId':_0x19ffc4(0x1a4)+_0x4e6e36,'compositeRequest':_0x16f9ff})),_0x35bbcd=await this[_0x19ffc4(0x1a2)][_0x19ffc4(0x1be)](_0x51c854);if(_0x338be4){const _0x373524=(0x0,composite_utils_1[_0x19ffc4(0x1c7)])(_0x35bbcd);for(const {id:_0x60208e,ref:_0x23fc2e}of _0x373524){const _0x41140a=this[_0x19ffc4(0x1d2)][_0x19ffc4(0x197)](_0x47f161=>_0x47f161[_0x19ffc4(0x1b9)]===_0x23fc2e);_0x41140a&&(_0x41140a[_0x19ffc4(0x19a)]=_0x60208e);}}},_0x270776=0x1e8480;let _0x11ebca=0x0,_0x3e9f15=[];for(const _0xe5891b of _0x5dc43f){const _0x509505=_0xe5891b[_0x3058c5(0x1b5)]((_0x39275c,_0x817fe3)=>{const _0x149a0c=JSON['stringify'](_0x817fe3)['length']*0x2;return _0x39275c+_0x149a0c;},0x0);if(_0x509505>constants_1[_0x3058c5(0x1c6)])throw new salesforce_error_1['SalesforceError'](_0x3058c5(0x1d0)+constants_1[_0x3058c5(0x1c6)]+'\x20COMPONENTS_SIZE\x20=\x20'+_0x509505);_0x11ebca+_0x509505>constants_1[_0x3058c5(0x1c6)]-_0x270776&&(await _0x38e6aa(_0x3e9f15),_0x3e9f15=[],_0x11ebca=0x0),_0x11ebca+=_0x509505,_0x3e9f15[_0x3058c5(0x1b2)](_0xe5891b);}_0x3e9f15['length']&&await _0x38e6aa(_0x3e9f15);}async['proceedRequests'](_0x591a36,_0x258dde=![]){const _0x489dd7=a271_0x2f3b14,_0x5eee0d=(this[_0x489dd7(0x1b3)]+ +_0x258dde)*0x3,_0x6fe799=(0x0,utils_1[_0x489dd7(0x1c9)])(_0x591a36,_0x5eee0d);try{while(_0x6fe799[_0x489dd7(0x192)]){const _0x37d0c0=_0x6fe799[_0x489dd7(0x198)](0x0,Math['floor'](constants_1[_0x489dd7(0x1a0)]/_0x5eee0d));await this[_0x489dd7(0x1d5)](_0x37d0c0,_0x258dde);}}catch(_0x465b15){this[_0x489dd7(0x1cb)][_0x489dd7(0x1b8)](_0x465b15 instanceof salesforce_error_1[_0x489dd7(0x1c3)]?JSON[_0x489dd7(0x1b6)](_0x465b15[_0x489dd7(0x1a5)](),null,0x2):_0x465b15),this[_0x489dd7(0x1d8)][_0x489dd7(0x1ce)](_0x465b15 instanceof salesforce_error_1[_0x489dd7(0x1c3)]?JSON['stringify'](_0x465b15[_0x489dd7(0x1a5)](),null,0x2):_0x465b15[_0x489dd7(0x1ba)]());throw _0x465b15;}}async[a271_0x2f3b14(0x1d4)](_0xe1f9ea){const _0x3521b5=a271_0x2f3b14;for(const _0x5c8b49 of _0xe1f9ea){if(!_0x5c8b49[_0x3521b5(0x1bc)]['length']&&!_0x5c8b49[_0x3521b5(0x1b1)][_0x3521b5(0x192)]&&!_0x5c8b49[_0x3521b5(0x1ab)]['length'])continue;const _0x392488=[],_0x273550=[],_0x56378b=new salesforce_components_manager_service_1[(_0x3521b5(0x1cd))](this[_0x3521b5(0x1cc)][_0x3521b5(0x1b0)],this[_0x3521b5(0x1cc)]['branchId'],_0x5c8b49[_0x3521b5(0x199)],this[_0x3521b5(0x1cc)]['recordTypes'],this[_0x3521b5(0x1d2)]);_0x392488[_0x3521b5(0x1b2)](...await _0x56378b['insert'](_0x5c8b49[_0x3521b5(0x1bc)],this[_0x3521b5(0x1cc)]['commitId'])),_0x392488[_0x3521b5(0x1b2)](...await _0x56378b[_0x3521b5(0x1d6)](_0x5c8b49['modified'],this[_0x3521b5(0x1cc)]['commitId'])),_0x273550[_0x3521b5(0x1b2)](await _0x56378b[_0x3521b5(0x196)](_0x5c8b49['removed'],!![])),this[_0x3521b5(0x1d2)]=_0x56378b['getProceededComponentsMeta'](),await this[_0x3521b5(0x1c5)](_0x392488,!![]);for(const _0x2a1c54 of _0x273550){_0x2a1c54[_0x3521b5(0x1a7)][_0x3521b5(0x192)]&&await this[_0x3521b5(0x1c5)](_0x2a1c54[_0x3521b5(0x1a7)],!![]),_0x2a1c54[_0x3521b5(0x1c1)]['length']&&await this['proceedRequests'](_0x2a1c54[_0x3521b5(0x1c1)],!![]),_0x2a1c54[_0x3521b5(0x19c)][_0x3521b5(0x192)]&&await this[_0x3521b5(0x1c5)](_0x2a1c54[_0x3521b5(0x19c)],!![]);}this['logger'][_0x3521b5(0x1ce)](_0x3521b5(0x1af),_0x392488[_0x3521b5(0x192)]);}}async[a271_0x2f3b14(0x194)](_0x38b0c8){const _0x586e48=a271_0x2f3b14,_0x2b80fa=[],_0x592601=[];for(const _0x116008 of _0x38b0c8){if(!_0x116008['inserted']['length']&&!_0x116008[_0x586e48(0x1b1)][_0x586e48(0x192)]&&!_0x116008[_0x586e48(0x1ab)]['length'])continue;const _0x31ee6d=new salesforce_components_manager_service_1[(_0x586e48(0x1cd))](this['options']['repositoryId'],this[_0x586e48(0x1cc)][_0x586e48(0x1ae)],_0x116008['author'],this[_0x586e48(0x1cc)][_0x586e48(0x1bb)],[]);_0x2b80fa[_0x586e48(0x1b2)](...await _0x31ee6d['insert'](_0x116008[_0x586e48(0x1bc)])),_0x2b80fa['push'](...await _0x31ee6d['update'](_0x116008[_0x586e48(0x1b1)])),_0x592601[_0x586e48(0x1b2)](await _0x31ee6d[_0x586e48(0x196)](_0x116008[_0x586e48(0x1ab)]));}this['logger'][_0x586e48(0x1ce)](_0x586e48(0x1bf),_0x2b80fa[_0x586e48(0x192)]),await this[_0x586e48(0x1c5)](_0x2b80fa);const _0x5a0130=_0x592601[_0x586e48(0x1b5)]((_0x33bca7,_0x854f5)=>({'manifests':[..._0x33bca7[_0x586e48(0x1a7)],..._0x854f5[_0x586e48(0x1a7)]],'componentsToDelete':[..._0x33bca7[_0x586e48(0x19c)],..._0x854f5[_0x586e48(0x19c)]],'componentsToUpdate':[..._0x33bca7[_0x586e48(0x1c1)],..._0x854f5[_0x586e48(0x1c1)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x5a0130[_0x586e48(0x1a7)][_0x586e48(0x192)]&&await this[_0x586e48(0x1c5)](_0x5a0130['manifests'],!![]),_0x5a0130[_0x586e48(0x1c1)]['length']&&await this['proceedRequests'](_0x5a0130['componentsToUpdate'],!![]),_0x5a0130['componentsToDelete'][_0x586e48(0x192)]&&await this['proceedRequests'](_0x5a0130['componentsToDelete'],!![]);}async[a271_0x2f3b14(0x1a1)](_0x2aff29){const _0x2fc364=a271_0x2f3b14;this[_0x2fc364(0x1cc)][_0x2fc364(0x1ae)]?await this[_0x2fc364(0x194)](_0x2aff29):await this[_0x2fc364(0x1d4)](_0x2aff29);}}exports['SalesforceCommitsManager']=SalesforceCommitsManager;