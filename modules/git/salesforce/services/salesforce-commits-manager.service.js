const a227_0x29a7c5=a227_0x328e;(function(_0x1242eb,_0x5d1e8f){const _0x2c0fda=a227_0x328e,_0x966487=_0x1242eb();while(!![]){try{const _0x1f6282=-parseInt(_0x2c0fda(0x11f))/0x1+-parseInt(_0x2c0fda(0x116))/0x2*(parseInt(_0x2c0fda(0x139))/0x3)+parseInt(_0x2c0fda(0x104))/0x4+-parseInt(_0x2c0fda(0x148))/0x5+-parseInt(_0x2c0fda(0x135))/0x6+-parseInt(_0x2c0fda(0x136))/0x7+parseInt(_0x2c0fda(0x121))/0x8;if(_0x1f6282===_0x5d1e8f)break;else _0x966487['push'](_0x966487['shift']());}catch(_0x215878){_0x966487['push'](_0x966487['shift']());}}}(a227_0x516c,0xc6a51));function a227_0x328e(_0x33a001,_0x204fad){const _0x24bf0e=a227_0x516c();return a227_0x328e=function(_0x35f31d,_0x5562c7){_0x35f31d=_0x35f31d-0x104;let _0x516cdd=_0x24bf0e[_0x35f31d];return _0x516cdd;},a227_0x328e(_0x33a001,_0x204fad);}const a227_0x5562c7=(function(){let _0x3113e8=!![];return function(_0x42c704,_0x5cb443){const _0x47036c=_0x3113e8?function(){const _0x27893f=a227_0x328e;if(_0x5cb443){const _0x43c9c9=_0x5cb443[_0x27893f(0x12e)](_0x42c704,arguments);return _0x5cb443=null,_0x43c9c9;}}:function(){};return _0x3113e8=![],_0x47036c;};}()),a227_0x35f31d=a227_0x5562c7(this,function(){const _0x10353a=a227_0x328e;return a227_0x35f31d[_0x10353a(0x11c)]()[_0x10353a(0x13f)](_0x10353a(0x149))[_0x10353a(0x11c)]()[_0x10353a(0x144)](a227_0x35f31d)['search'](_0x10353a(0x149));});function a227_0x516c(){const _0x28fb42=['commitId','author','repositoryId','proceededComponentsMeta','\x20COMPONENTS_SIZE\x20=\x20','toString','recordTypes','map','1414253gHrMvm','Logger','46594776cFEFWu','reference','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','length','componentsToUpdate','SalesforceCompositeService','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','proceedChunksToUpload','removed','stringify','../utils/composite.utils','componentsToDelete','proceedRequests','apply','proceedCommits','toJSON','SalesforceComponentsManager','floor','componentId','branchId','5589786YFCkez','8175447EvvZFF','update','__esModule','13131EHWOUe','modified','SalesforceError','SalesforceCommitsManager','manifests','graph','search','log','logger','../../../shared/utils','executeGraphs','constructor','splice','reduce','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','3110725TwKmOu','(((.+)+)+)+$','COMPONENTS_PER_CHUNK','name','2611300SIfcfI','options','SALESFORCE_MAX_REQUEST_SIZE_BYTES','getProceededComponentsMeta','inserted','insert','../errors/salesforce.error','defineProperty','get','../../../../constants','../../../../core','sfLogger','./salesforce-components-manager.service','__importDefault','push','Sending\x20','./salesforce-composite.service','proceedCommitsToRepository','698UxNGJx'];a227_0x516c=function(){return _0x28fb42;};return a227_0x516c();}a227_0x35f31d();'use strict';var __importDefault=this&&this[a227_0x29a7c5(0x111)]||function(_0x491709){const _0x55e799=a227_0x29a7c5;return _0x491709&&_0x491709[_0x55e799(0x138)]?_0x491709:{'default':_0x491709};};Object[a227_0x29a7c5(0x10b)](exports,a227_0x29a7c5(0x138),{'value':!![]}),exports['SalesforceCommitsManager']=void 0x0;const core_1=require(a227_0x29a7c5(0x10e)),typedi_1=__importDefault(require('typedi')),constants_1=require(a227_0x29a7c5(0x10d)),utils_1=require(a227_0x29a7c5(0x142)),salesforce_error_1=require(a227_0x29a7c5(0x10a)),composite_utils_1=require(a227_0x29a7c5(0x12b)),salesforce_components_manager_service_1=require(a227_0x29a7c5(0x110)),salesforce_composite_service_1=require(a227_0x29a7c5(0x114));class SalesforceCommitsManager{constructor(_0x485b5a){const _0x457440=a227_0x29a7c5;this[_0x457440(0x105)]=_0x485b5a,this['COMPONENTS_PER_CHUNK']=0x3,this['logger']=new core_1[(_0x457440(0x120))](SalesforceCommitsManager[_0x457440(0x14b)]),this[_0x457440(0x10f)]=this['options'][_0x457440(0x141)],this['composite']=typedi_1['default'][_0x457440(0x10c)](salesforce_composite_service_1[_0x457440(0x126)]),this[_0x457440(0x11a)]=[];}async[a227_0x29a7c5(0x128)](_0x538603,_0x155e9a=![]){const _0x51ca8b=a227_0x29a7c5,_0x41fa46=async _0x3b3ff8=>{const _0x52faca=a227_0x328e;await this[_0x52faca(0x141)]['log'](_0x52faca(0x113)+_0x3b3ff8[_0x52faca(0x146)]((_0x1edd0f,_0xaf9ea9)=>_0x1edd0f+_0xaf9ea9[_0x52faca(0x124)],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x4491b6=_0x3b3ff8[_0x52faca(0x11e)]((_0x1bf251,_0x3c278f)=>({'graphId':_0x52faca(0x13e)+_0x3c278f,'compositeRequest':_0x1bf251})),_0x571259=await this['composite'][_0x52faca(0x143)](_0x4491b6);if(_0x155e9a){const _0x496dd6=(0x0,composite_utils_1['extractComponentIdsFromGraphsResponse'])(_0x571259);for(const {id:_0x416bf8,ref:_0x5b0210}of _0x496dd6){const _0x3003e3=this['proceededComponentsMeta']['find'](_0x59c26d=>_0x59c26d[_0x52faca(0x122)]===_0x5b0210);_0x3003e3&&(_0x3003e3[_0x52faca(0x133)]=_0x416bf8);}}},_0x3f4d77=0x1e8480;let _0x506b80=0x0,_0x318fb7=[];for(const _0x1886b3 of _0x538603){const _0x170a8f=_0x1886b3[_0x51ca8b(0x146)]((_0x3913cb,_0x43a8b9)=>{const _0x519bc3=_0x51ca8b,_0x74eb39=JSON[_0x519bc3(0x12a)](_0x43a8b9)[_0x519bc3(0x124)]*0x2;return _0x3913cb+_0x74eb39;},0x0);if(_0x170a8f>constants_1[_0x51ca8b(0x106)])throw new salesforce_error_1[(_0x51ca8b(0x13b))](_0x51ca8b(0x123)+constants_1[_0x51ca8b(0x106)]+_0x51ca8b(0x11b)+_0x170a8f);_0x506b80+_0x170a8f>constants_1[_0x51ca8b(0x106)]-_0x3f4d77&&(await _0x41fa46(_0x318fb7),_0x318fb7=[],_0x506b80=0x0),_0x506b80+=_0x170a8f,_0x318fb7['push'](_0x1886b3);}_0x318fb7['length']&&await _0x41fa46(_0x318fb7);}async[a227_0x29a7c5(0x12d)](_0x36ed3b,_0x68638d=![]){const _0x477087=a227_0x29a7c5,_0x2b4555=(this[_0x477087(0x14a)]+ +_0x68638d)*0x3,_0x354436=(0x0,utils_1['chunkArray'])(_0x36ed3b,_0x2b4555);try{while(_0x354436[_0x477087(0x124)]){const _0x1c0682=_0x354436[_0x477087(0x145)](0x0,Math[_0x477087(0x132)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x2b4555));await this[_0x477087(0x128)](_0x1c0682,_0x68638d);}}catch(_0x21e273){this[_0x477087(0x141)]['error'](_0x21e273 instanceof salesforce_error_1[_0x477087(0x13b)]?JSON['stringify'](_0x21e273[_0x477087(0x130)](),null,0x2):_0x21e273),this[_0x477087(0x10f)][_0x477087(0x140)](_0x21e273 instanceof salesforce_error_1['SalesforceError']?JSON[_0x477087(0x12a)](_0x21e273[_0x477087(0x130)](),null,0x2):_0x21e273[_0x477087(0x11c)]());throw _0x21e273;}}async['proceedCommitsToRepository'](_0x1d86f1){const _0x35bf29=a227_0x29a7c5;for(const _0x2cb66b of _0x1d86f1){if(!_0x2cb66b['inserted']['length']&&!_0x2cb66b[_0x35bf29(0x13a)]['length']&&!_0x2cb66b[_0x35bf29(0x129)][_0x35bf29(0x124)])continue;const _0x4d0ccb=[],_0x3f3a15=[],_0x202a6a=new salesforce_components_manager_service_1[(_0x35bf29(0x131))](this[_0x35bf29(0x105)]['repositoryId'],this[_0x35bf29(0x105)][_0x35bf29(0x134)],_0x2cb66b[_0x35bf29(0x118)],this[_0x35bf29(0x105)]['recordTypes'],this[_0x35bf29(0x11a)]);_0x4d0ccb[_0x35bf29(0x112)](...await _0x202a6a[_0x35bf29(0x109)](_0x2cb66b[_0x35bf29(0x108)],this['options']['commitId'])),_0x4d0ccb['push'](...await _0x202a6a[_0x35bf29(0x137)](_0x2cb66b[_0x35bf29(0x13a)],this['options'][_0x35bf29(0x117)])),_0x3f3a15['push'](await _0x202a6a['delete'](_0x2cb66b[_0x35bf29(0x129)],!![])),this['proceededComponentsMeta']=_0x202a6a[_0x35bf29(0x107)](),await this[_0x35bf29(0x12d)](_0x4d0ccb,!![]);for(const _0x31ac6d of _0x3f3a15){_0x31ac6d[_0x35bf29(0x13d)][_0x35bf29(0x124)]&&await this[_0x35bf29(0x12d)](_0x31ac6d['manifests'],!![]),_0x31ac6d[_0x35bf29(0x125)]['length']&&await this[_0x35bf29(0x12d)](_0x31ac6d[_0x35bf29(0x125)],!![]),_0x31ac6d[_0x35bf29(0x12c)]['length']&&await this['proceedRequests'](_0x31ac6d[_0x35bf29(0x12c)],!![]);}this['logger'][_0x35bf29(0x140)](_0x35bf29(0x127),_0x4d0ccb[_0x35bf29(0x124)]);}}async['proceedCommitsToBranch'](_0xb4cefc){const _0x32b833=a227_0x29a7c5,_0x1eee40=[],_0x4ef428=[];for(const _0x318dae of _0xb4cefc){if(!_0x318dae[_0x32b833(0x108)][_0x32b833(0x124)]&&!_0x318dae['modified'][_0x32b833(0x124)]&&!_0x318dae[_0x32b833(0x129)]['length'])continue;const _0x5705ae=new salesforce_components_manager_service_1[(_0x32b833(0x131))](this[_0x32b833(0x105)][_0x32b833(0x119)],this['options']['branchId'],_0x318dae[_0x32b833(0x118)],this['options'][_0x32b833(0x11d)],[]);_0x1eee40[_0x32b833(0x112)](...await _0x5705ae[_0x32b833(0x109)](_0x318dae[_0x32b833(0x108)])),_0x1eee40[_0x32b833(0x112)](...await _0x5705ae[_0x32b833(0x137)](_0x318dae[_0x32b833(0x13a)])),_0x4ef428[_0x32b833(0x112)](await _0x5705ae['delete'](_0x318dae[_0x32b833(0x129)]));}this[_0x32b833(0x141)][_0x32b833(0x140)](_0x32b833(0x147),_0x1eee40[_0x32b833(0x124)]),await this[_0x32b833(0x12d)](_0x1eee40);const _0x55afa1=_0x4ef428[_0x32b833(0x146)]((_0x452098,_0xf464c0)=>({'manifests':[..._0x452098[_0x32b833(0x13d)],..._0xf464c0[_0x32b833(0x13d)]],'componentsToDelete':[..._0x452098[_0x32b833(0x12c)],..._0xf464c0[_0x32b833(0x12c)]],'componentsToUpdate':[..._0x452098['componentsToUpdate'],..._0xf464c0['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x55afa1[_0x32b833(0x13d)][_0x32b833(0x124)]&&await this[_0x32b833(0x12d)](_0x55afa1['manifests'],!![]),_0x55afa1[_0x32b833(0x125)][_0x32b833(0x124)]&&await this[_0x32b833(0x12d)](_0x55afa1['componentsToUpdate'],!![]),_0x55afa1['componentsToDelete']['length']&&await this['proceedRequests'](_0x55afa1[_0x32b833(0x12c)],!![]);}async[a227_0x29a7c5(0x12f)](_0x474f7c){const _0x185e19=a227_0x29a7c5;this[_0x185e19(0x105)][_0x185e19(0x134)]?await this['proceedCommitsToBranch'](_0x474f7c):await this[_0x185e19(0x115)](_0x474f7c);}}exports[a227_0x29a7c5(0x13c)]=SalesforceCommitsManager;