const a271_0x167ea8=a271_0x11ec;(function(_0x238ac1,_0xa60989){const _0x19a5d5=a271_0x11ec,_0x1ac90f=_0x238ac1();while(!![]){try{const _0x32801d=parseInt(_0x19a5d5(0x17c))/0x1+parseInt(_0x19a5d5(0x186))/0x2+parseInt(_0x19a5d5(0x19a))/0x3*(-parseInt(_0x19a5d5(0x1a4))/0x4)+parseInt(_0x19a5d5(0x1b6))/0x5*(-parseInt(_0x19a5d5(0x1b8))/0x6)+parseInt(_0x19a5d5(0x198))/0x7*(parseInt(_0x19a5d5(0x1a3))/0x8)+-parseInt(_0x19a5d5(0x1c0))/0x9*(-parseInt(_0x19a5d5(0x1a0))/0xa)+-parseInt(_0x19a5d5(0x1b3))/0xb*(-parseInt(_0x19a5d5(0x1c1))/0xc);if(_0x32801d===_0xa60989)break;else _0x1ac90f['push'](_0x1ac90f['shift']());}catch(_0x3db5a0){_0x1ac90f['push'](_0x1ac90f['shift']());}}}(a271_0x29d6,0x319d8));const a271_0xa38919=(function(){let _0x32bdf6=!![];return function(_0x29bfd3,_0x5afc88){const _0x1aa75d=_0x32bdf6?function(){const _0xdf7b4d=a271_0x11ec;if(_0x5afc88){const _0x482d61=_0x5afc88[_0xdf7b4d(0x1aa)](_0x29bfd3,arguments);return _0x5afc88=null,_0x482d61;}}:function(){};return _0x32bdf6=![],_0x1aa75d;};}()),a271_0x4d03ab=a271_0xa38919(this,function(){const _0x31d64e=a271_0x11ec;return a271_0x4d03ab['toString']()['search'](_0x31d64e(0x1ba))[_0x31d64e(0x1b0)]()[_0x31d64e(0x19f)](a271_0x4d03ab)[_0x31d64e(0x193)](_0x31d64e(0x1ba));});function a271_0x29d6(){const _0xaf0aec=['push','(((.+)+)+)+$','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','logger','proceedCommitsToBranch','author','find','1536498AXZeAJ','19428mZpJVi','./salesforce-composite.service','options','splice','removed','chunkArray','get','extractComponentIdsFromGraphsResponse','update','261208jJwYUU','branchId','proceedCommits','graph','SalesforceComponentsManager','SALESFORCE_MAX_REQUEST_SIZE_BYTES','COMPONENTS_PER_CHUNK','proceedCommitsToRepository','proceedChunksToUpload','../../../../constants','384530lEVtjx','typedi','repositoryId','error','sfLogger','reference','floor','../../../../core','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','toJSON','log','__esModule','componentsToUpdate','search','SalesforceError','proceededComponentsMeta','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','SalesforceCommitsManager','1438388BiLxZV','reduce','21tctsIA','inserted','insert','stringify','composite','constructor','10tnEgfb','componentId','manifests','8AeaeAZ','214552LzYsdT','\x20COMPONENTS_SIZE\x20=\x20','commitId','delete','\x20requests\x20to\x20composite\x20api.','recordTypes','apply','__importDefault','../../../shared/utils','name','length','Logger','toString','../utils/composite.utils','componentsToDelete','770gTIwpy','map','proceedRequests','695qcMnId','modified','15726znCDla'];a271_0x29d6=function(){return _0xaf0aec;};return a271_0x29d6();}a271_0x4d03ab();'use strict';var __importDefault=this&&this[a271_0x167ea8(0x1ab)]||function(_0x41325d){const _0x1f0277=a271_0x167ea8;return _0x41325d&&_0x41325d[_0x1f0277(0x191)]?_0x41325d:{'default':_0x41325d};};function a271_0x11ec(_0x17150c,_0x1560bf){const _0x390f3e=a271_0x29d6();return a271_0x11ec=function(_0x4d03ab,_0xa38919){_0x4d03ab=_0x4d03ab-0x175;let _0x29d6f8=_0x390f3e[_0x4d03ab];return _0x29d6f8;},a271_0x11ec(_0x17150c,_0x1560bf);}Object['defineProperty'](exports,a271_0x167ea8(0x191),{'value':!![]}),exports[a271_0x167ea8(0x197)]=void 0x0;const core_1=require(a271_0x167ea8(0x18d)),typedi_1=__importDefault(require(a271_0x167ea8(0x187))),constants_1=require(a271_0x167ea8(0x185)),utils_1=require(a271_0x167ea8(0x1ac)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a271_0x167ea8(0x1b1)),salesforce_components_manager_service_1=require('./salesforce-components-manager.service'),salesforce_composite_service_1=require(a271_0x167ea8(0x1c2));class SalesforceCommitsManager{constructor(_0x4acc1a){const _0x482dbd=a271_0x167ea8;this['options']=_0x4acc1a,this[_0x482dbd(0x182)]=0x3,this['logger']=new core_1[(_0x482dbd(0x1af))](SalesforceCommitsManager[_0x482dbd(0x1ad)]),this[_0x482dbd(0x18a)]=this[_0x482dbd(0x175)][_0x482dbd(0x1bc)],this['composite']=typedi_1['default'][_0x482dbd(0x179)](salesforce_composite_service_1['SalesforceCompositeService']),this[_0x482dbd(0x195)]=[];}async[a271_0x167ea8(0x184)](_0x37b1d8,_0x2de480=![]){const _0x497279=a271_0x167ea8,_0x47aa00=async _0x4ab276=>{const _0x478689=a271_0x11ec;await this[_0x478689(0x1bc)]['log']('Sending\x20'+_0x4ab276[_0x478689(0x199)]((_0x331a57,_0x4ff719)=>_0x331a57+_0x4ff719['length'],0x0)+_0x478689(0x1a8));const _0x13613c=_0x4ab276[_0x478689(0x1b4)]((_0x2c62d1,_0x850b3)=>({'graphId':_0x478689(0x17f)+_0x850b3,'compositeRequest':_0x2c62d1})),_0x4bdb83=await this[_0x478689(0x19e)]['executeGraphs'](_0x13613c);if(_0x2de480){const _0x4abd66=(0x0,composite_utils_1[_0x478689(0x17a)])(_0x4bdb83);for(const {id:_0x4988c2,ref:_0x2e9a05}of _0x4abd66){const _0x4dcedc=this[_0x478689(0x195)][_0x478689(0x1bf)](_0x5cf147=>_0x5cf147[_0x478689(0x18b)]===_0x2e9a05);_0x4dcedc&&(_0x4dcedc[_0x478689(0x1a1)]=_0x4988c2);}}},_0x51748f=0x1e8480;let _0x47341e=0x0,_0x52617d=[];for(const _0x4459a8 of _0x37b1d8){const _0x4dc3ad=_0x4459a8[_0x497279(0x199)]((_0x17bef0,_0xefaf7e)=>{const _0x173c8c=_0x497279,_0xa88a21=JSON[_0x173c8c(0x19d)](_0xefaf7e)[_0x173c8c(0x1ae)]*0x2;return _0x17bef0+_0xa88a21;},0x0);if(_0x4dc3ad>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES'])throw new salesforce_error_1[(_0x497279(0x194))](_0x497279(0x1bb)+constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']+_0x497279(0x1a5)+_0x4dc3ad);_0x47341e+_0x4dc3ad>constants_1[_0x497279(0x181)]-_0x51748f&&(await _0x47aa00(_0x52617d),_0x52617d=[],_0x47341e=0x0),_0x47341e+=_0x4dc3ad,_0x52617d[_0x497279(0x1b9)](_0x4459a8);}_0x52617d['length']&&await _0x47aa00(_0x52617d);}async['proceedRequests'](_0x1f98c9,_0x2a79da=![]){const _0x20ad66=a271_0x167ea8,_0x27487a=(this[_0x20ad66(0x182)]+ +_0x2a79da)*0x3,_0x48b72d=(0x0,utils_1[_0x20ad66(0x178)])(_0x1f98c9,_0x27487a);try{while(_0x48b72d['length']){const _0x4e58f6=_0x48b72d[_0x20ad66(0x176)](0x0,Math[_0x20ad66(0x18c)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x27487a));await this['proceedChunksToUpload'](_0x4e58f6,_0x2a79da);}}catch(_0x17abbc){this[_0x20ad66(0x1bc)][_0x20ad66(0x189)](_0x17abbc instanceof salesforce_error_1[_0x20ad66(0x194)]?JSON[_0x20ad66(0x19d)](_0x17abbc[_0x20ad66(0x18f)](),null,0x2):_0x17abbc),this[_0x20ad66(0x18a)][_0x20ad66(0x190)](_0x17abbc instanceof salesforce_error_1['SalesforceError']?JSON[_0x20ad66(0x19d)](_0x17abbc[_0x20ad66(0x18f)](),null,0x2):_0x17abbc['toString']());throw _0x17abbc;}}async[a271_0x167ea8(0x183)](_0x391acb){const _0x59880e=a271_0x167ea8;for(const _0x123da0 of _0x391acb){if(!_0x123da0[_0x59880e(0x19b)][_0x59880e(0x1ae)]&&!_0x123da0[_0x59880e(0x1b7)][_0x59880e(0x1ae)]&&!_0x123da0[_0x59880e(0x177)][_0x59880e(0x1ae)])continue;const _0x15fc75=[],_0x1e66cd=[],_0x5527ff=new salesforce_components_manager_service_1[(_0x59880e(0x180))](this[_0x59880e(0x175)][_0x59880e(0x188)],this[_0x59880e(0x175)][_0x59880e(0x17d)],_0x123da0['author'],this[_0x59880e(0x175)]['recordTypes'],this[_0x59880e(0x195)]);_0x15fc75[_0x59880e(0x1b9)](...await _0x5527ff['insert'](_0x123da0['inserted'],this[_0x59880e(0x175)][_0x59880e(0x1a6)])),_0x15fc75['push'](...await _0x5527ff[_0x59880e(0x17b)](_0x123da0[_0x59880e(0x1b7)],this[_0x59880e(0x175)][_0x59880e(0x1a6)])),_0x1e66cd['push'](await _0x5527ff['delete'](_0x123da0[_0x59880e(0x177)],!![])),this[_0x59880e(0x195)]=_0x5527ff['getProceededComponentsMeta'](),await this['proceedRequests'](_0x15fc75,!![]);for(const _0x1186af of _0x1e66cd){_0x1186af[_0x59880e(0x1a2)][_0x59880e(0x1ae)]&&await this[_0x59880e(0x1b5)](_0x1186af[_0x59880e(0x1a2)],!![]),_0x1186af[_0x59880e(0x192)][_0x59880e(0x1ae)]&&await this[_0x59880e(0x1b5)](_0x1186af[_0x59880e(0x192)],!![]),_0x1186af[_0x59880e(0x1b2)][_0x59880e(0x1ae)]&&await this['proceedRequests'](_0x1186af['componentsToDelete'],!![]);}this['logger'][_0x59880e(0x190)](_0x59880e(0x18e),_0x15fc75[_0x59880e(0x1ae)]);}}async['proceedCommitsToBranch'](_0x277312){const _0x1fca42=a271_0x167ea8,_0x25a034=[],_0x3fc4ac=[];for(const _0x15e8ac of _0x277312){if(!_0x15e8ac[_0x1fca42(0x19b)][_0x1fca42(0x1ae)]&&!_0x15e8ac['modified'][_0x1fca42(0x1ae)]&&!_0x15e8ac['removed'][_0x1fca42(0x1ae)])continue;const _0x5b491d=new salesforce_components_manager_service_1[(_0x1fca42(0x180))](this[_0x1fca42(0x175)][_0x1fca42(0x188)],this[_0x1fca42(0x175)]['branchId'],_0x15e8ac[_0x1fca42(0x1be)],this[_0x1fca42(0x175)][_0x1fca42(0x1a9)],[]);_0x25a034[_0x1fca42(0x1b9)](...await _0x5b491d[_0x1fca42(0x19c)](_0x15e8ac[_0x1fca42(0x19b)])),_0x25a034[_0x1fca42(0x1b9)](...await _0x5b491d[_0x1fca42(0x17b)](_0x15e8ac[_0x1fca42(0x1b7)])),_0x3fc4ac[_0x1fca42(0x1b9)](await _0x5b491d[_0x1fca42(0x1a7)](_0x15e8ac[_0x1fca42(0x177)]));}this[_0x1fca42(0x1bc)]['log'](_0x1fca42(0x196),_0x25a034[_0x1fca42(0x1ae)]),await this[_0x1fca42(0x1b5)](_0x25a034);const _0x458282=_0x3fc4ac[_0x1fca42(0x199)]((_0x592119,_0x3cce2b)=>({'manifests':[..._0x592119['manifests'],..._0x3cce2b['manifests']],'componentsToDelete':[..._0x592119[_0x1fca42(0x1b2)],..._0x3cce2b[_0x1fca42(0x1b2)]],'componentsToUpdate':[..._0x592119[_0x1fca42(0x192)],..._0x3cce2b['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x458282['manifests']['length']&&await this[_0x1fca42(0x1b5)](_0x458282[_0x1fca42(0x1a2)],!![]),_0x458282[_0x1fca42(0x192)][_0x1fca42(0x1ae)]&&await this[_0x1fca42(0x1b5)](_0x458282[_0x1fca42(0x192)],!![]),_0x458282[_0x1fca42(0x1b2)][_0x1fca42(0x1ae)]&&await this['proceedRequests'](_0x458282[_0x1fca42(0x1b2)],!![]);}async[a271_0x167ea8(0x17e)](_0x4fc04b){const _0x376dd6=a271_0x167ea8;this[_0x376dd6(0x175)][_0x376dd6(0x17d)]?await this[_0x376dd6(0x1bd)](_0x4fc04b):await this[_0x376dd6(0x183)](_0x4fc04b);}}exports[a271_0x167ea8(0x197)]=SalesforceCommitsManager;