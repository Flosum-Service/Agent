const a228_0x513bf6=a228_0x14cd;(function(_0x3606b5,_0x171bea){const _0x217a5c=a228_0x14cd,_0x3e0299=_0x3606b5();while(!![]){try{const _0x5affb4=parseInt(_0x217a5c(0x103))/0x1+parseInt(_0x217a5c(0x123))/0x2+parseInt(_0x217a5c(0x11c))/0x3+-parseInt(_0x217a5c(0x129))/0x4+-parseInt(_0x217a5c(0xf5))/0x5+-parseInt(_0x217a5c(0x118))/0x6+-parseInt(_0x217a5c(0xf4))/0x7;if(_0x5affb4===_0x171bea)break;else _0x3e0299['push'](_0x3e0299['shift']());}catch(_0x2c5d45){_0x3e0299['push'](_0x3e0299['shift']());}}}(a228_0x203a,0x75d0a));function a228_0x14cd(_0x3d26ba,_0x1187ec){const _0x3ba8e3=a228_0x203a();return a228_0x14cd=function(_0x496db3,_0x49907d){_0x496db3=_0x496db3-0xed;let _0x203ada=_0x3ba8e3[_0x496db3];return _0x203ada;},a228_0x14cd(_0x3d26ba,_0x1187ec);}const a228_0x49907d=(function(){let _0x36f9ef=!![];return function(_0x38cb1c,_0x5317a7){const _0x38bcc3=_0x36f9ef?function(){const _0x376e01=a228_0x14cd;if(_0x5317a7){const _0x32848b=_0x5317a7[_0x376e01(0x11f)](_0x38cb1c,arguments);return _0x5317a7=null,_0x32848b;}}:function(){};return _0x36f9ef=![],_0x38bcc3;};}()),a228_0x496db3=a228_0x49907d(this,function(){const _0x2b189b=a228_0x14cd;return a228_0x496db3['toString']()[_0x2b189b(0x119)]('(((.+)+)+)+$')[_0x2b189b(0x105)]()['constructor'](a228_0x496db3)[_0x2b189b(0x119)](_0x2b189b(0xef));});a228_0x496db3();function a228_0x203a(){const _0x1e4338=['896031VZUalB','./salesforce-components-manager.service','../errors/salesforce.error','apply','typedi','delete','componentsToDelete','1781372amiffs','push','default','manifests','Sending\x20','chunkArray','1762388uiUryY','COMPONENTS_PER_CHUNK','removed','SalesforceCommitsManager','composite','logger','defineProperty','error','stringify','(((.+)+)+)+$','../../../../constants','splice','proceedChunksToUpload','options','1613920NPzZAr','321375PgqmlU','branchId','modified','componentsToUpdate','proceedCommitsToBranch','reduce','./salesforce-composite.service','\x20COMPONENTS_SIZE\x20=\x20','commitId','floor','length','repositoryId','map','SalesforceComponentsManager','950854koFcXS','sfLogger','toString','extractComponentIdsFromGraphsResponse','update','author','proceededComponentsMeta','name','getProceededComponentsMeta','SalesforceCompositeService','recordTypes','inserted','log','proceedRequests','Logger','../utils/composite.utils','componentId','insert','SALESFORCE_MAX_REQUEST_SIZE_BYTES','SalesforceError','proceedCommitsToRepository','5533290NeYZPG','search','proceedCommits','toJSON'];a228_0x203a=function(){return _0x1e4338;};return a228_0x203a();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5873b2){return _0x5873b2&&_0x5873b2['__esModule']?_0x5873b2:{'default':_0x5873b2};};Object[a228_0x513bf6(0x12f)](exports,'__esModule',{'value':!![]}),exports[a228_0x513bf6(0x12c)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require(a228_0x513bf6(0x120))),constants_1=require(a228_0x513bf6(0xf0)),utils_1=require('../../../shared/utils'),salesforce_error_1=require(a228_0x513bf6(0x11e)),composite_utils_1=require(a228_0x513bf6(0x112)),salesforce_components_manager_service_1=require(a228_0x513bf6(0x11d)),salesforce_composite_service_1=require(a228_0x513bf6(0xfb));class SalesforceCommitsManager{constructor(_0x5bbf73){const _0x5d3527=a228_0x513bf6;this[_0x5d3527(0xf3)]=_0x5bbf73,this['COMPONENTS_PER_CHUNK']=0x3,this['logger']=new core_1[(_0x5d3527(0x111))](SalesforceCommitsManager[_0x5d3527(0x10a)]),this[_0x5d3527(0x104)]=this['options'][_0x5d3527(0x12e)],this[_0x5d3527(0x12d)]=typedi_1[_0x5d3527(0x125)]['get'](salesforce_composite_service_1[_0x5d3527(0x10c)]),this[_0x5d3527(0x109)]=[];}async['proceedChunksToUpload'](_0x41a94b,_0xc1aebb=![]){const _0x4ec2d8=a228_0x513bf6,_0x146b7e=async _0x43b2c7=>{const _0x464272=a228_0x14cd;await this[_0x464272(0x12e)][_0x464272(0x10f)](_0x464272(0x127)+_0x43b2c7['reduce']((_0x3b63e6,_0x461784)=>_0x3b63e6+_0x461784[_0x464272(0xff)],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x145795=_0x43b2c7[_0x464272(0x101)]((_0x30b6be,_0x2ed272)=>({'graphId':'graph'+_0x2ed272,'compositeRequest':_0x30b6be})),_0x3950a6=await this['composite']['executeGraphs'](_0x145795);if(_0xc1aebb){const _0xe4f056=(0x0,composite_utils_1[_0x464272(0x106)])(_0x3950a6);for(const {id:_0x478dc5,ref:_0x51ee1a}of _0xe4f056){const _0x3b920a=this[_0x464272(0x109)]['find'](_0x373e8d=>_0x373e8d['reference']===_0x51ee1a);_0x3b920a&&(_0x3b920a[_0x464272(0x113)]=_0x478dc5);}}},_0x15aacb=0x1e8480;let _0x4a16f6=0x0,_0x3dd404=[];for(const _0x3784e9 of _0x41a94b){const _0x23562e=_0x3784e9['reduce']((_0x5ea3e0,_0x4ef5e1)=>{const _0x3007be=a228_0x14cd,_0x2a7382=JSON['stringify'](_0x4ef5e1)[_0x3007be(0xff)]*0x2;return _0x5ea3e0+_0x2a7382;},0x0);if(_0x23562e>constants_1[_0x4ec2d8(0x115)])throw new salesforce_error_1['SalesforceError']('Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20'+constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']+_0x4ec2d8(0xfc)+_0x23562e);_0x4a16f6+_0x23562e>constants_1[_0x4ec2d8(0x115)]-_0x15aacb&&(await _0x146b7e(_0x3dd404),_0x3dd404=[],_0x4a16f6=0x0),_0x4a16f6+=_0x23562e,_0x3dd404[_0x4ec2d8(0x124)](_0x3784e9);}_0x3dd404[_0x4ec2d8(0xff)]&&await _0x146b7e(_0x3dd404);}async[a228_0x513bf6(0x110)](_0xb18d7a,_0x43aae2=![]){const _0xbdf6d9=a228_0x513bf6,_0x20eb52=(this[_0xbdf6d9(0x12a)]+ +_0x43aae2)*0x3,_0x3022bf=(0x0,utils_1[_0xbdf6d9(0x128)])(_0xb18d7a,_0x20eb52);try{while(_0x3022bf['length']){const _0x1a2111=_0x3022bf[_0xbdf6d9(0xf1)](0x0,Math[_0xbdf6d9(0xfe)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x20eb52));await this[_0xbdf6d9(0xf2)](_0x1a2111,_0x43aae2);}}catch(_0x1ad4c7){this[_0xbdf6d9(0x12e)][_0xbdf6d9(0xed)](_0x1ad4c7 instanceof salesforce_error_1[_0xbdf6d9(0x116)]?JSON[_0xbdf6d9(0xee)](_0x1ad4c7[_0xbdf6d9(0x11b)](),null,0x2):_0x1ad4c7),this[_0xbdf6d9(0x104)][_0xbdf6d9(0x10f)](_0x1ad4c7 instanceof salesforce_error_1['SalesforceError']?JSON[_0xbdf6d9(0xee)](_0x1ad4c7[_0xbdf6d9(0x11b)](),null,0x2):_0x1ad4c7[_0xbdf6d9(0x105)]());throw _0x1ad4c7;}}async['proceedCommitsToRepository'](_0x497a03){const _0x4cc5be=a228_0x513bf6;for(const _0x42a95b of _0x497a03){if(!_0x42a95b[_0x4cc5be(0x10e)][_0x4cc5be(0xff)]&&!_0x42a95b[_0x4cc5be(0xf7)][_0x4cc5be(0xff)]&&!_0x42a95b[_0x4cc5be(0x12b)]['length'])continue;const _0x5f3e60=[],_0x1f8c5a=[],_0x250e7a=new salesforce_components_manager_service_1[(_0x4cc5be(0x102))](this['options']['repositoryId'],this[_0x4cc5be(0xf3)][_0x4cc5be(0xf6)],_0x42a95b[_0x4cc5be(0x108)],this['options']['recordTypes'],this[_0x4cc5be(0x109)]);_0x5f3e60['push'](...await _0x250e7a[_0x4cc5be(0x114)](_0x42a95b[_0x4cc5be(0x10e)],this['options'][_0x4cc5be(0xfd)])),_0x5f3e60[_0x4cc5be(0x124)](...await _0x250e7a[_0x4cc5be(0x107)](_0x42a95b[_0x4cc5be(0xf7)],this[_0x4cc5be(0xf3)][_0x4cc5be(0xfd)])),_0x1f8c5a[_0x4cc5be(0x124)](await _0x250e7a['delete'](_0x42a95b[_0x4cc5be(0x12b)],!![])),this[_0x4cc5be(0x109)]=_0x250e7a[_0x4cc5be(0x10b)](),await this[_0x4cc5be(0x110)](_0x5f3e60,!![]);for(const _0x103af5 of _0x1f8c5a){_0x103af5[_0x4cc5be(0x126)][_0x4cc5be(0xff)]&&await this[_0x4cc5be(0x110)](_0x103af5[_0x4cc5be(0x126)],!![]),_0x103af5[_0x4cc5be(0xf8)]['length']&&await this[_0x4cc5be(0x110)](_0x103af5['componentsToUpdate'],!![]),_0x103af5['componentsToDelete'][_0x4cc5be(0xff)]&&await this['proceedRequests'](_0x103af5[_0x4cc5be(0x122)],!![]);}this['logger'][_0x4cc5be(0x10f)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x5f3e60[_0x4cc5be(0xff)]);}}async[a228_0x513bf6(0xf9)](_0x5b0737){const _0x43357d=a228_0x513bf6,_0x1829bc=[],_0x2de717=[];for(const _0x219fe5 of _0x5b0737){if(!_0x219fe5[_0x43357d(0x10e)][_0x43357d(0xff)]&&!_0x219fe5[_0x43357d(0xf7)][_0x43357d(0xff)]&&!_0x219fe5[_0x43357d(0x12b)][_0x43357d(0xff)])continue;const _0x5e90c4=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this['options'][_0x43357d(0x100)],this['options'][_0x43357d(0xf6)],_0x219fe5[_0x43357d(0x108)],this['options'][_0x43357d(0x10d)],[]);_0x1829bc[_0x43357d(0x124)](...await _0x5e90c4[_0x43357d(0x114)](_0x219fe5[_0x43357d(0x10e)])),_0x1829bc['push'](...await _0x5e90c4[_0x43357d(0x107)](_0x219fe5[_0x43357d(0xf7)])),_0x2de717[_0x43357d(0x124)](await _0x5e90c4[_0x43357d(0x121)](_0x219fe5[_0x43357d(0x12b)]));}this[_0x43357d(0x12e)][_0x43357d(0x10f)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)',_0x1829bc[_0x43357d(0xff)]),await this[_0x43357d(0x110)](_0x1829bc);const _0x30e001=_0x2de717[_0x43357d(0xfa)]((_0x26c86c,_0x24cc6f)=>({'manifests':[..._0x26c86c[_0x43357d(0x126)],..._0x24cc6f[_0x43357d(0x126)]],'componentsToDelete':[..._0x26c86c['componentsToDelete'],..._0x24cc6f[_0x43357d(0x122)]],'componentsToUpdate':[..._0x26c86c[_0x43357d(0xf8)],..._0x24cc6f[_0x43357d(0xf8)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x30e001[_0x43357d(0x126)][_0x43357d(0xff)]&&await this[_0x43357d(0x110)](_0x30e001[_0x43357d(0x126)],!![]),_0x30e001[_0x43357d(0xf8)][_0x43357d(0xff)]&&await this[_0x43357d(0x110)](_0x30e001[_0x43357d(0xf8)],!![]),_0x30e001[_0x43357d(0x122)][_0x43357d(0xff)]&&await this[_0x43357d(0x110)](_0x30e001[_0x43357d(0x122)],!![]);}async[a228_0x513bf6(0x11a)](_0xc399e1){const _0x4bbe12=a228_0x513bf6;this['options'][_0x4bbe12(0xf6)]?await this[_0x4bbe12(0xf9)](_0xc399e1):await this[_0x4bbe12(0x117)](_0xc399e1);}}exports[a228_0x513bf6(0x12c)]=SalesforceCommitsManager;