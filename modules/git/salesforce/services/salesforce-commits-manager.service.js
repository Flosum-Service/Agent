const a271_0x4b3540=a271_0x15e0;(function(_0x35df1c,_0xa77852){const _0xdba160=a271_0x15e0,_0x4cf6e4=_0x35df1c();while(!![]){try{const _0x5c2dc8=-parseInt(_0xdba160(0xa7))/0x1*(-parseInt(_0xdba160(0x8f))/0x2)+-parseInt(_0xdba160(0xab))/0x3+parseInt(_0xdba160(0xd2))/0x4+-parseInt(_0xdba160(0x95))/0x5*(-parseInt(_0xdba160(0xbe))/0x6)+parseInt(_0xdba160(0xc7))/0x7+-parseInt(_0xdba160(0xd5))/0x8*(-parseInt(_0xdba160(0xb8))/0x9)+parseInt(_0xdba160(0xcc))/0xa*(-parseInt(_0xdba160(0x91))/0xb);if(_0x5c2dc8===_0xa77852)break;else _0x4cf6e4['push'](_0x4cf6e4['shift']());}catch(_0x41908a){_0x4cf6e4['push'](_0x4cf6e4['shift']());}}}(a271_0x4086,0x7519d));const a271_0x4f9f14=(function(){let _0x5df1e2=!![];return function(_0x338b52,_0x51cb61){const _0x40a247=_0x5df1e2?function(){const _0x403544=a271_0x15e0;if(_0x51cb61){const _0x797be5=_0x51cb61[_0x403544(0xc5)](_0x338b52,arguments);return _0x51cb61=null,_0x797be5;}}:function(){};return _0x5df1e2=![],_0x40a247;};}()),a271_0x11a3b5=a271_0x4f9f14(this,function(){const _0x43cc23=a271_0x15e0;return a271_0x11a3b5[_0x43cc23(0xd7)]()[_0x43cc23(0xa0)]('(((.+)+)+)+$')[_0x43cc23(0xd7)]()['constructor'](a271_0x11a3b5)[_0x43cc23(0xa0)](_0x43cc23(0xc0));});a271_0x11a3b5();'use strict';var __importDefault=this&&this[a271_0x4b3540(0xd8)]||function(_0x1c0be4){const _0x530423=a271_0x4b3540;return _0x1c0be4&&_0x1c0be4[_0x530423(0x92)]?_0x1c0be4:{'default':_0x1c0be4};};function a271_0x15e0(_0x11ccbc,_0x4a7bbd){const _0xbe808c=a271_0x4086();return a271_0x15e0=function(_0x11a3b5,_0x4f9f14){_0x11a3b5=_0x11a3b5-0x8e;let _0x408699=_0xbe808c[_0x11a3b5];return _0x408699;},a271_0x15e0(_0x11ccbc,_0x4a7bbd);}Object[a271_0x4b3540(0xad)](exports,a271_0x4b3540(0x92),{'value':!![]}),exports[a271_0x4b3540(0x9a)]=void 0x0;const core_1=require(a271_0x4b3540(0xce)),typedi_1=__importDefault(require(a271_0x4b3540(0xd4))),constants_1=require(a271_0x4b3540(0xae)),utils_1=require('../../../shared/utils'),salesforce_error_1=require(a271_0x4b3540(0xd0)),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require('./salesforce-components-manager.service'),salesforce_composite_service_1=require(a271_0x4b3540(0xaf));class SalesforceCommitsManager{constructor(_0x1ae353){const _0x1c0f75=a271_0x4b3540;this[_0x1c0f75(0xc6)]=_0x1ae353,this['COMPONENTS_PER_CHUNK']=0x3,this[_0x1c0f75(0x9c)]=new core_1[(_0x1c0f75(0xd9))](SalesforceCommitsManager[_0x1c0f75(0x98)]),this[_0x1c0f75(0xb4)]=this['options'][_0x1c0f75(0x9c)],this[_0x1c0f75(0xd6)]=typedi_1[_0x1c0f75(0xcf)][_0x1c0f75(0xa4)](salesforce_composite_service_1[_0x1c0f75(0xa2)]),this['proceededComponentsMeta']=[];}async[a271_0x4b3540(0xb2)](_0x4ed7e2,_0x79930d=![]){const _0x38e8eb=a271_0x4b3540,_0x4b97f1=async _0xf1da1f=>{const _0x3b9678=a271_0x15e0;await this[_0x3b9678(0x9c)][_0x3b9678(0xba)]('Sending\x20'+_0xf1da1f['reduce']((_0x51b98c,_0x36b552)=>_0x51b98c+_0x36b552[_0x3b9678(0xaa)],0x0)+_0x3b9678(0xc9));const _0x310b3a=_0xf1da1f[_0x3b9678(0x9e)]((_0x225064,_0x5055f7)=>({'graphId':_0x3b9678(0xc1)+_0x5055f7,'compositeRequest':_0x225064})),_0x498bf8=await this[_0x3b9678(0xd6)][_0x3b9678(0xc8)](_0x310b3a);if(_0x79930d){const _0x265046=(0x0,composite_utils_1[_0x3b9678(0x90)])(_0x498bf8);for(const {id:_0x5f1da5,ref:_0x1f0a7a}of _0x265046){const _0x5175ff=this['proceededComponentsMeta']['find'](_0x2956f4=>_0x2956f4[_0x3b9678(0xbc)]===_0x1f0a7a);_0x5175ff&&(_0x5175ff[_0x3b9678(0xbf)]=_0x5f1da5);}}},_0x2660f2=0x1e8480;let _0x25ea65=0x0,_0x2567bb=[];for(const _0x3db91b of _0x4ed7e2){const _0x4ceec9=_0x3db91b['reduce']((_0x3c5f86,_0x4c463e)=>{const _0xfeee9d=a271_0x15e0,_0x4618b1=JSON[_0xfeee9d(0xa1)](_0x4c463e)[_0xfeee9d(0xaa)]*0x2;return _0x3c5f86+_0x4618b1;},0x0);if(_0x4ceec9>constants_1[_0x38e8eb(0xb0)])throw new salesforce_error_1[(_0x38e8eb(0xa9))](_0x38e8eb(0xd1)+constants_1[_0x38e8eb(0xb0)]+_0x38e8eb(0xc3)+_0x4ceec9);_0x25ea65+_0x4ceec9>constants_1[_0x38e8eb(0xb0)]-_0x2660f2&&(await _0x4b97f1(_0x2567bb),_0x2567bb=[],_0x25ea65=0x0),_0x25ea65+=_0x4ceec9,_0x2567bb['push'](_0x3db91b);}_0x2567bb[_0x38e8eb(0xaa)]&&await _0x4b97f1(_0x2567bb);}async[a271_0x4b3540(0xbd)](_0x1ad4f2,_0x343a85=![]){const _0x349850=a271_0x4b3540,_0xce76bf=(this[_0x349850(0x9d)]+ +_0x343a85)*0x3,_0x4c1dbf=(0x0,utils_1[_0x349850(0xbb)])(_0x1ad4f2,_0xce76bf);try{while(_0x4c1dbf[_0x349850(0xaa)]){const _0x4d9450=_0x4c1dbf[_0x349850(0xcd)](0x0,Math['floor'](constants_1[_0x349850(0xca)]/_0xce76bf));await this[_0x349850(0xb2)](_0x4d9450,_0x343a85);}}catch(_0x3806a5){this[_0x349850(0x9c)][_0x349850(0x9f)](_0x3806a5 instanceof salesforce_error_1[_0x349850(0xa9)]?JSON[_0x349850(0xa1)](_0x3806a5[_0x349850(0xb5)](),null,0x2):_0x3806a5),this[_0x349850(0xb4)][_0x349850(0xba)](_0x3806a5 instanceof salesforce_error_1[_0x349850(0xa9)]?JSON[_0x349850(0xa1)](_0x3806a5['toJSON'](),null,0x2):_0x3806a5['toString']());throw _0x3806a5;}}async[a271_0x4b3540(0xb3)](_0xc8892){const _0x46f9b1=a271_0x4b3540;for(const _0x10bb13 of _0xc8892){if(!_0x10bb13['inserted'][_0x46f9b1(0xaa)]&&!_0x10bb13[_0x46f9b1(0x9b)][_0x46f9b1(0xaa)]&&!_0x10bb13[_0x46f9b1(0x97)][_0x46f9b1(0xaa)])continue;const _0x31c6ff=[],_0x424bbf=[],_0xe6735=new salesforce_components_manager_service_1[(_0x46f9b1(0xa5))](this[_0x46f9b1(0xc6)][_0x46f9b1(0xa6)],this[_0x46f9b1(0xc6)][_0x46f9b1(0xac)],_0x10bb13[_0x46f9b1(0x94)],this['options']['recordTypes'],this[_0x46f9b1(0xd3)]);_0x31c6ff[_0x46f9b1(0x93)](...await _0xe6735[_0x46f9b1(0xcb)](_0x10bb13[_0x46f9b1(0xb7)],this['options'][_0x46f9b1(0xc2)])),_0x31c6ff['push'](...await _0xe6735[_0x46f9b1(0xb1)](_0x10bb13['modified'],this['options'][_0x46f9b1(0xc2)])),_0x424bbf[_0x46f9b1(0x93)](await _0xe6735['delete'](_0x10bb13[_0x46f9b1(0x97)],!![])),this[_0x46f9b1(0xd3)]=_0xe6735['getProceededComponentsMeta'](),await this['proceedRequests'](_0x31c6ff,!![]);for(const _0x5102f2 of _0x424bbf){_0x5102f2[_0x46f9b1(0x99)][_0x46f9b1(0xaa)]&&await this[_0x46f9b1(0xbd)](_0x5102f2['manifests'],!![]),_0x5102f2[_0x46f9b1(0xc4)][_0x46f9b1(0xaa)]&&await this[_0x46f9b1(0xbd)](_0x5102f2[_0x46f9b1(0xc4)],!![]),_0x5102f2[_0x46f9b1(0x96)][_0x46f9b1(0xaa)]&&await this[_0x46f9b1(0xbd)](_0x5102f2[_0x46f9b1(0x96)],!![]);}this[_0x46f9b1(0x9c)]['log'](_0x46f9b1(0x8e),_0x31c6ff[_0x46f9b1(0xaa)]);}}async['proceedCommitsToBranch'](_0x39ce2d){const _0x479eb9=a271_0x4b3540,_0x3563ff=[],_0xc19b17=[];for(const _0x270045 of _0x39ce2d){if(!_0x270045[_0x479eb9(0xb7)][_0x479eb9(0xaa)]&&!_0x270045['modified'][_0x479eb9(0xaa)]&&!_0x270045[_0x479eb9(0x97)][_0x479eb9(0xaa)])continue;const _0x4a26f3=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this['options'][_0x479eb9(0xa6)],this['options'][_0x479eb9(0xac)],_0x270045['author'],this['options']['recordTypes'],[]);_0x3563ff[_0x479eb9(0x93)](...await _0x4a26f3[_0x479eb9(0xcb)](_0x270045[_0x479eb9(0xb7)])),_0x3563ff[_0x479eb9(0x93)](...await _0x4a26f3['update'](_0x270045[_0x479eb9(0x9b)])),_0xc19b17['push'](await _0x4a26f3[_0x479eb9(0xb6)](_0x270045[_0x479eb9(0x97)]));}this[_0x479eb9(0x9c)][_0x479eb9(0xba)](_0x479eb9(0xb9),_0x3563ff[_0x479eb9(0xaa)]),await this[_0x479eb9(0xbd)](_0x3563ff);const _0x506ded=_0xc19b17[_0x479eb9(0xa3)]((_0x2263a5,_0x3c4527)=>({'manifests':[..._0x2263a5[_0x479eb9(0x99)],..._0x3c4527[_0x479eb9(0x99)]],'componentsToDelete':[..._0x2263a5[_0x479eb9(0x96)],..._0x3c4527[_0x479eb9(0x96)]],'componentsToUpdate':[..._0x2263a5['componentsToUpdate'],..._0x3c4527[_0x479eb9(0xc4)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x506ded[_0x479eb9(0x99)]['length']&&await this[_0x479eb9(0xbd)](_0x506ded[_0x479eb9(0x99)],!![]),_0x506ded[_0x479eb9(0xc4)][_0x479eb9(0xaa)]&&await this[_0x479eb9(0xbd)](_0x506ded['componentsToUpdate'],!![]),_0x506ded[_0x479eb9(0x96)][_0x479eb9(0xaa)]&&await this[_0x479eb9(0xbd)](_0x506ded[_0x479eb9(0x96)],!![]);}async[a271_0x4b3540(0xa8)](_0x19b018){const _0x237024=a271_0x4b3540;this['options'][_0x237024(0xac)]?await this['proceedCommitsToBranch'](_0x19b018):await this[_0x237024(0xb3)](_0x19b018);}}exports[a271_0x4b3540(0x9a)]=SalesforceCommitsManager;function a271_0x4086(){const _0x2cb5e1=['__importDefault','Logger','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','530jtGuVf','extractComponentIdsFromGraphsResponse','121aLxNwA','__esModule','push','author','5315mlybnM','componentsToDelete','removed','name','manifests','SalesforceCommitsManager','modified','logger','COMPONENTS_PER_CHUNK','map','error','search','stringify','SalesforceCompositeService','reduce','get','SalesforceComponentsManager','repositoryId','3413QmyJeb','proceedCommits','SalesforceError','length','2265192shlXcE','branchId','defineProperty','../../../../constants','./salesforce-composite.service','SALESFORCE_MAX_REQUEST_SIZE_BYTES','update','proceedChunksToUpload','proceedCommitsToRepository','sfLogger','toJSON','delete','inserted','9vVtNIh','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','log','chunkArray','reference','proceedRequests','1818EBNUWa','componentId','(((.+)+)+)+$','graph','commitId','\x20COMPONENTS_SIZE\x20=\x20','componentsToUpdate','apply','options','1954869Mxfoxe','executeGraphs','\x20requests\x20to\x20composite\x20api.','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','insert','908150mENZHp','splice','../../../../core','default','../errors/salesforce.error','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','2357300kxHcoe','proceededComponentsMeta','typedi','1108384FQjIGO','composite','toString'];a271_0x4086=function(){return _0x2cb5e1;};return a271_0x4086();}