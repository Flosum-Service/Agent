const a260_0x39f526=a260_0x43b1;(function(_0xa904a9,_0x40de83){const _0xfb057b=a260_0x43b1,_0x51f2ae=_0xa904a9();while(!![]){try{const _0x359a73=-parseInt(_0xfb057b(0x1e0))/0x1+parseInt(_0xfb057b(0x1f8))/0x2+parseInt(_0xfb057b(0x1d3))/0x3*(-parseInt(_0xfb057b(0x1d9))/0x4)+parseInt(_0xfb057b(0x20d))/0x5+-parseInt(_0xfb057b(0x20c))/0x6+-parseInt(_0xfb057b(0x1cc))/0x7+parseInt(_0xfb057b(0x1fa))/0x8*(parseInt(_0xfb057b(0x1e2))/0x9);if(_0x359a73===_0x40de83)break;else _0x51f2ae['push'](_0x51f2ae['shift']());}catch(_0x45dbb8){_0x51f2ae['push'](_0x51f2ae['shift']());}}}(a260_0x2c2e,0xb532c));const a260_0x1d3645=(function(){let _0x2fcc15=!![];return function(_0x34fa56,_0x4e2cea){const _0x36252f=_0x2fcc15?function(){const _0x1abf07=a260_0x43b1;if(_0x4e2cea){const _0x2524c0=_0x4e2cea[_0x1abf07(0x1dc)](_0x34fa56,arguments);return _0x4e2cea=null,_0x2524c0;}}:function(){};return _0x2fcc15=![],_0x36252f;};}()),a260_0x485fcb=a260_0x1d3645(this,function(){const _0x1be065=a260_0x43b1;return a260_0x485fcb[_0x1be065(0x1d1)]()[_0x1be065(0x1cf)](_0x1be065(0x1ec))[_0x1be065(0x1d1)]()[_0x1be065(0x1e3)](a260_0x485fcb)['search']('(((.+)+)+)+$');});a260_0x485fcb();'use strict';var __importDefault=this&&this[a260_0x39f526(0x1d4)]||function(_0x44c0bc){const _0x21ad9c=a260_0x39f526;return _0x44c0bc&&_0x44c0bc[_0x21ad9c(0x213)]?_0x44c0bc:{'default':_0x44c0bc};};function a260_0x2c2e(){const _0x1cc21d=['extractComponentIdsFromGraphsResponse','1206328rFtUSv','SalesforceCommitsManager','27khUowm','constructor','options','manifests','push','reference','graph','proceededComponentsMeta','length','insert','(((.+)+)+)+$','componentsToUpdate','commitId','sfLogger','proceedRequests','typedi','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','modified','get','SalesforceError','../errors/salesforce.error','logger','260530PjVOsM','../utils/composite.utils','9455440xdHmDC','proceedCommitsToRepository','proceedChunksToUpload','stringify','error','COMPONENTS_PER_CHUNK','\x20COMPONENTS_SIZE\x20=\x20','../../../shared/utils','branchId','../../../../core','name','default','SalesforceComponentsManager','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','proceedCommitsToBranch','inserted','./salesforce-composite.service','SALESFORCE_MAX_REQUEST_SIZE_BYTES','3801216kRrfuJ','4043550ApJsDP','floor','recordTypes','find','Logger','chunkArray','__esModule','author','update','5903982wWKchd','log','composite','search','defineProperty','toString','removed','3177861TBPGVV','__importDefault','getProceededComponentsMeta','./salesforce-components-manager.service','delete','repositoryId','4ihSFNP','Sending\x20','componentsToDelete','apply','reduce','proceedCommits'];a260_0x2c2e=function(){return _0x1cc21d;};return a260_0x2c2e();}Object[a260_0x39f526(0x1d0)](exports,'__esModule',{'value':!![]}),exports[a260_0x39f526(0x1e1)]=void 0x0;const core_1=require(a260_0x39f526(0x203)),typedi_1=__importDefault(require(a260_0x39f526(0x1f1))),constants_1=require('../../../../constants'),utils_1=require(a260_0x39f526(0x201)),salesforce_error_1=require(a260_0x39f526(0x1f6)),composite_utils_1=require(a260_0x39f526(0x1f9)),salesforce_components_manager_service_1=require(a260_0x39f526(0x1d6)),salesforce_composite_service_1=require(a260_0x39f526(0x20a));function a260_0x43b1(_0x3a20ca,_0x8530bc){const _0x4b7830=a260_0x2c2e();return a260_0x43b1=function(_0x485fcb,_0x1d3645){_0x485fcb=_0x485fcb-0x1cb;let _0x2c2e55=_0x4b7830[_0x485fcb];return _0x2c2e55;},a260_0x43b1(_0x3a20ca,_0x8530bc);}class SalesforceCommitsManager{constructor(_0x7b9b1d){const _0x2f93f8=a260_0x39f526;this['options']=_0x7b9b1d,this['COMPONENTS_PER_CHUNK']=0x3,this[_0x2f93f8(0x1f7)]=new core_1[(_0x2f93f8(0x211))](SalesforceCommitsManager[_0x2f93f8(0x204)]),this[_0x2f93f8(0x1ef)]=this[_0x2f93f8(0x1e4)][_0x2f93f8(0x1f7)],this[_0x2f93f8(0x1ce)]=typedi_1[_0x2f93f8(0x205)][_0x2f93f8(0x1f4)](salesforce_composite_service_1['SalesforceCompositeService']),this[_0x2f93f8(0x1e9)]=[];}async['proceedChunksToUpload'](_0x27c04f,_0x16e2ac=![]){const _0x2d82a4=a260_0x39f526,_0x50ed6f=async _0x221858=>{const _0x55e824=a260_0x43b1;await this[_0x55e824(0x1f7)]['log'](_0x55e824(0x1da)+_0x221858[_0x55e824(0x1dd)]((_0x43b512,_0x575a99)=>_0x43b512+_0x575a99[_0x55e824(0x1ea)],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x30dcc2=_0x221858['map']((_0xa77be0,_0x57dc73)=>({'graphId':_0x55e824(0x1e8)+_0x57dc73,'compositeRequest':_0xa77be0})),_0x4f3bcd=await this['composite']['executeGraphs'](_0x30dcc2);if(_0x16e2ac){const _0x340f66=(0x0,composite_utils_1[_0x55e824(0x1df)])(_0x4f3bcd);for(const {id:_0x40be6b,ref:_0x64f4b}of _0x340f66){const _0x400089=this[_0x55e824(0x1e9)][_0x55e824(0x210)](_0x38ae82=>_0x38ae82[_0x55e824(0x1e7)]===_0x64f4b);_0x400089&&(_0x400089['componentId']=_0x40be6b);}}},_0x1fc6ba=0x1e8480;let _0x372ae1=0x0,_0xa7dafc=[];for(const _0x504e81 of _0x27c04f){const _0x4847d3=_0x504e81[_0x2d82a4(0x1dd)]((_0x3c15c1,_0xe0c02d)=>{const _0x535f96=_0x2d82a4,_0x352bbb=JSON[_0x535f96(0x1fd)](_0xe0c02d)['length']*0x2;return _0x3c15c1+_0x352bbb;},0x0);if(_0x4847d3>constants_1[_0x2d82a4(0x20b)])throw new salesforce_error_1['SalesforceError'](_0x2d82a4(0x207)+constants_1[_0x2d82a4(0x20b)]+_0x2d82a4(0x200)+_0x4847d3);_0x372ae1+_0x4847d3>constants_1[_0x2d82a4(0x20b)]-_0x1fc6ba&&(await _0x50ed6f(_0xa7dafc),_0xa7dafc=[],_0x372ae1=0x0),_0x372ae1+=_0x4847d3,_0xa7dafc[_0x2d82a4(0x1e6)](_0x504e81);}_0xa7dafc[_0x2d82a4(0x1ea)]&&await _0x50ed6f(_0xa7dafc);}async[a260_0x39f526(0x1f0)](_0x459419,_0x2af5d6=![]){const _0x1e6e8f=a260_0x39f526,_0xe1612b=(this[_0x1e6e8f(0x1ff)]+ +_0x2af5d6)*0x3,_0x227911=(0x0,utils_1[_0x1e6e8f(0x212)])(_0x459419,_0xe1612b);try{while(_0x227911[_0x1e6e8f(0x1ea)]){const _0x48fbc4=_0x227911['splice'](0x0,Math[_0x1e6e8f(0x20e)](constants_1[_0x1e6e8f(0x1f2)]/_0xe1612b));await this[_0x1e6e8f(0x1fc)](_0x48fbc4,_0x2af5d6);}}catch(_0x23b72c){this[_0x1e6e8f(0x1f7)][_0x1e6e8f(0x1fe)](_0x23b72c instanceof salesforce_error_1[_0x1e6e8f(0x1f5)]?JSON[_0x1e6e8f(0x1fd)](_0x23b72c['toJSON'](),null,0x2):_0x23b72c),this['sfLogger'][_0x1e6e8f(0x1cd)](_0x23b72c instanceof salesforce_error_1[_0x1e6e8f(0x1f5)]?JSON[_0x1e6e8f(0x1fd)](_0x23b72c['toJSON'](),null,0x2):_0x23b72c[_0x1e6e8f(0x1d1)]());throw _0x23b72c;}}async[a260_0x39f526(0x1fb)](_0x1b2022){const _0x459bd8=a260_0x39f526;for(const _0x1f3c8c of _0x1b2022){if(!_0x1f3c8c[_0x459bd8(0x209)][_0x459bd8(0x1ea)]&&!_0x1f3c8c['modified'][_0x459bd8(0x1ea)]&&!_0x1f3c8c[_0x459bd8(0x1d2)][_0x459bd8(0x1ea)])continue;const _0x2ec330=[],_0xafb408=[],_0x541a76=new salesforce_components_manager_service_1[(_0x459bd8(0x206))](this[_0x459bd8(0x1e4)][_0x459bd8(0x1d8)],this[_0x459bd8(0x1e4)][_0x459bd8(0x202)],_0x1f3c8c['author'],this['options'][_0x459bd8(0x20f)],this[_0x459bd8(0x1e9)]);_0x2ec330[_0x459bd8(0x1e6)](...await _0x541a76[_0x459bd8(0x1eb)](_0x1f3c8c[_0x459bd8(0x209)],this[_0x459bd8(0x1e4)][_0x459bd8(0x1ee)])),_0x2ec330['push'](...await _0x541a76['update'](_0x1f3c8c[_0x459bd8(0x1f3)],this[_0x459bd8(0x1e4)][_0x459bd8(0x1ee)])),_0xafb408['push'](await _0x541a76[_0x459bd8(0x1d7)](_0x1f3c8c[_0x459bd8(0x1d2)],!![])),this[_0x459bd8(0x1e9)]=_0x541a76[_0x459bd8(0x1d5)](),await this[_0x459bd8(0x1f0)](_0x2ec330,!![]);for(const _0x5c9587 of _0xafb408){_0x5c9587[_0x459bd8(0x1e5)][_0x459bd8(0x1ea)]&&await this[_0x459bd8(0x1f0)](_0x5c9587[_0x459bd8(0x1e5)],!![]),_0x5c9587[_0x459bd8(0x1ed)][_0x459bd8(0x1ea)]&&await this['proceedRequests'](_0x5c9587[_0x459bd8(0x1ed)],!![]),_0x5c9587[_0x459bd8(0x1db)][_0x459bd8(0x1ea)]&&await this[_0x459bd8(0x1f0)](_0x5c9587[_0x459bd8(0x1db)],!![]);}this[_0x459bd8(0x1f7)][_0x459bd8(0x1cd)]('Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x2ec330[_0x459bd8(0x1ea)]);}}async['proceedCommitsToBranch'](_0x373c19){const _0x4008fa=a260_0x39f526,_0x17c8ec=[],_0x1c123e=[];for(const _0x371d95 of _0x373c19){if(!_0x371d95[_0x4008fa(0x209)][_0x4008fa(0x1ea)]&&!_0x371d95[_0x4008fa(0x1f3)][_0x4008fa(0x1ea)]&&!_0x371d95['removed'][_0x4008fa(0x1ea)])continue;const _0x53c615=new salesforce_components_manager_service_1[(_0x4008fa(0x206))](this[_0x4008fa(0x1e4)][_0x4008fa(0x1d8)],this[_0x4008fa(0x1e4)][_0x4008fa(0x202)],_0x371d95[_0x4008fa(0x214)],this['options'][_0x4008fa(0x20f)],[]);_0x17c8ec['push'](...await _0x53c615[_0x4008fa(0x1eb)](_0x371d95[_0x4008fa(0x209)])),_0x17c8ec[_0x4008fa(0x1e6)](...await _0x53c615[_0x4008fa(0x1cb)](_0x371d95['modified'])),_0x1c123e[_0x4008fa(0x1e6)](await _0x53c615[_0x4008fa(0x1d7)](_0x371d95[_0x4008fa(0x1d2)]));}this[_0x4008fa(0x1f7)]['log']('Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)',_0x17c8ec[_0x4008fa(0x1ea)]),await this['proceedRequests'](_0x17c8ec);const _0x5731ae=_0x1c123e[_0x4008fa(0x1dd)]((_0x311d91,_0x191573)=>({'manifests':[..._0x311d91[_0x4008fa(0x1e5)],..._0x191573[_0x4008fa(0x1e5)]],'componentsToDelete':[..._0x311d91[_0x4008fa(0x1db)],..._0x191573[_0x4008fa(0x1db)]],'componentsToUpdate':[..._0x311d91[_0x4008fa(0x1ed)],..._0x191573['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x5731ae[_0x4008fa(0x1e5)][_0x4008fa(0x1ea)]&&await this[_0x4008fa(0x1f0)](_0x5731ae[_0x4008fa(0x1e5)],!![]),_0x5731ae[_0x4008fa(0x1ed)][_0x4008fa(0x1ea)]&&await this[_0x4008fa(0x1f0)](_0x5731ae['componentsToUpdate'],!![]),_0x5731ae[_0x4008fa(0x1db)][_0x4008fa(0x1ea)]&&await this['proceedRequests'](_0x5731ae[_0x4008fa(0x1db)],!![]);}async[a260_0x39f526(0x1de)](_0x3347c6){const _0x4a1d2a=a260_0x39f526;this['options'][_0x4a1d2a(0x202)]?await this[_0x4a1d2a(0x208)](_0x3347c6):await this[_0x4a1d2a(0x1fb)](_0x3347c6);}}exports['SalesforceCommitsManager']=SalesforceCommitsManager;