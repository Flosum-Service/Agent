const a227_0x32da3e=a227_0x30ca;function a227_0x30ca(_0x488072,_0x264577){const _0x3f5177=a227_0x53fc();return a227_0x30ca=function(_0x2070c2,_0x1fc812){_0x2070c2=_0x2070c2-0xe8;let _0x53fc01=_0x3f5177[_0x2070c2];return _0x53fc01;},a227_0x30ca(_0x488072,_0x264577);}(function(_0x170715,_0x16e64f){const _0x1ef323=a227_0x30ca,_0x5ac766=_0x170715();while(!![]){try{const _0x4f8061=-parseInt(_0x1ef323(0xfb))/0x1+-parseInt(_0x1ef323(0x11e))/0x2+-parseInt(_0x1ef323(0x123))/0x3*(parseInt(_0x1ef323(0xee))/0x4)+parseInt(_0x1ef323(0x130))/0x5+parseInt(_0x1ef323(0x12a))/0x6*(parseInt(_0x1ef323(0x125))/0x7)+parseInt(_0x1ef323(0x100))/0x8*(parseInt(_0x1ef323(0x111))/0x9)+parseInt(_0x1ef323(0xfd))/0xa*(parseInt(_0x1ef323(0x126))/0xb);if(_0x4f8061===_0x16e64f)break;else _0x5ac766['push'](_0x5ac766['shift']());}catch(_0x463bb2){_0x5ac766['push'](_0x5ac766['shift']());}}}(a227_0x53fc,0x761ee));const a227_0x1fc812=(function(){let _0x132218=!![];return function(_0x22e18a,_0x1215bd){const _0x1d547d=_0x132218?function(){const _0x55c9d2=a227_0x30ca;if(_0x1215bd){const _0x599e32=_0x1215bd[_0x55c9d2(0x11d)](_0x22e18a,arguments);return _0x1215bd=null,_0x599e32;}}:function(){};return _0x132218=![],_0x1d547d;};}()),a227_0x2070c2=a227_0x1fc812(this,function(){const _0x45bf24=a227_0x30ca;return a227_0x2070c2['toString']()['search'](_0x45bf24(0x120))[_0x45bf24(0x107)]()[_0x45bf24(0x138)](a227_0x2070c2)[_0x45bf24(0xed)](_0x45bf24(0x120));});a227_0x2070c2();'use strict';var __importDefault=this&&this[a227_0x32da3e(0xfc)]||function(_0xf37671){const _0x5d0b5a=a227_0x32da3e;return _0xf37671&&_0xf37671[_0x5d0b5a(0x104)]?_0xf37671:{'default':_0xf37671};};Object[a227_0x32da3e(0x11b)](exports,'__esModule',{'value':!![]}),exports[a227_0x32da3e(0xef)]=void 0x0;const core_1=require(a227_0x32da3e(0x112)),typedi_1=__importDefault(require(a227_0x32da3e(0xf3))),constants_1=require('../../../../constants'),utils_1=require(a227_0x32da3e(0x10e)),salesforce_error_1=require(a227_0x32da3e(0xf4)),composite_utils_1=require(a227_0x32da3e(0x128)),salesforce_components_manager_service_1=require(a227_0x32da3e(0x108)),salesforce_composite_service_1=require(a227_0x32da3e(0x103));class SalesforceCommitsManager{constructor(_0x2efd37){const _0x53e5df=a227_0x32da3e;this[_0x53e5df(0x135)]=_0x2efd37,this[_0x53e5df(0x10c)]=0x3,this['logger']=new core_1[(_0x53e5df(0x12b))](SalesforceCommitsManager[_0x53e5df(0x10f)]),this['sfLogger']=this[_0x53e5df(0x135)]['logger'],this[_0x53e5df(0xf1)]=typedi_1[_0x53e5df(0xeb)][_0x53e5df(0x109)](salesforce_composite_service_1[_0x53e5df(0x106)]),this[_0x53e5df(0x105)]=[];}async['proceedChunksToUpload'](_0x4f8570,_0x505234=![]){const _0x2cfb15=a227_0x32da3e,_0x294f66=async _0x2bf454=>{const _0x531ec0=a227_0x30ca;await this['logger']['log']('Sending\x20'+_0x2bf454[_0x531ec0(0x116)]((_0x5e007e,_0x1fa533)=>_0x5e007e+_0x1fa533[_0x531ec0(0x136)],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x3ca14b=_0x2bf454[_0x531ec0(0x12c)]((_0x261c66,_0x5095ad)=>({'graphId':_0x531ec0(0xf8)+_0x5095ad,'compositeRequest':_0x261c66})),_0x3fc607=await this[_0x531ec0(0xf1)][_0x531ec0(0x118)](_0x3ca14b);if(_0x505234){const _0x4e710c=(0x0,composite_utils_1[_0x531ec0(0x11c)])(_0x3fc607);for(const {id:_0x3406d8,ref:_0x1d4ef1}of _0x4e710c){const _0x32e180=this[_0x531ec0(0x105)][_0x531ec0(0x10b)](_0x9b5e91=>_0x9b5e91[_0x531ec0(0x102)]===_0x1d4ef1);_0x32e180&&(_0x32e180[_0x531ec0(0xe9)]=_0x3406d8);}}},_0x5de079=0x1e8480;let _0x30a689=0x0,_0x2c2eb1=[];for(const _0x4445da of _0x4f8570){const _0x194ff4=_0x4445da[_0x2cfb15(0x116)]((_0x1da3ee,_0x50de10)=>{const _0x4dabb9=_0x2cfb15,_0x40850f=JSON[_0x4dabb9(0x12e)](_0x50de10)['length']*0x2;return _0x1da3ee+_0x40850f;},0x0);if(_0x194ff4>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES'])throw new salesforce_error_1[(_0x2cfb15(0x113))](_0x2cfb15(0x12f)+constants_1[_0x2cfb15(0x110)]+'\x20COMPONENTS_SIZE\x20=\x20'+_0x194ff4);_0x30a689+_0x194ff4>constants_1[_0x2cfb15(0x110)]-_0x5de079&&(await _0x294f66(_0x2c2eb1),_0x2c2eb1=[],_0x30a689=0x0),_0x30a689+=_0x194ff4,_0x2c2eb1[_0x2cfb15(0x10d)](_0x4445da);}_0x2c2eb1[_0x2cfb15(0x136)]&&await _0x294f66(_0x2c2eb1);}async[a227_0x32da3e(0x12d)](_0x27632d,_0x50b91a=![]){const _0x45ae54=a227_0x32da3e,_0x4180ca=(this[_0x45ae54(0x10c)]+ +_0x50b91a)*0x3,_0x37d140=(0x0,utils_1[_0x45ae54(0xea)])(_0x27632d,_0x4180ca);try{while(_0x37d140['length']){const _0x30da9f=_0x37d140[_0x45ae54(0x132)](0x0,Math[_0x45ae54(0x115)](constants_1[_0x45ae54(0xe8)]/_0x4180ca));await this[_0x45ae54(0x134)](_0x30da9f,_0x50b91a);}}catch(_0x35ea33){this[_0x45ae54(0xf5)][_0x45ae54(0x137)](_0x35ea33 instanceof salesforce_error_1[_0x45ae54(0x113)]?JSON['stringify'](_0x35ea33[_0x45ae54(0x114)](),null,0x2):_0x35ea33),this[_0x45ae54(0x124)][_0x45ae54(0x133)](_0x35ea33 instanceof salesforce_error_1['SalesforceError']?JSON['stringify'](_0x35ea33['toJSON'](),null,0x2):_0x35ea33[_0x45ae54(0x107)]());throw _0x35ea33;}}async[a227_0x32da3e(0xfa)](_0x238b72){const _0x5124b7=a227_0x32da3e;for(const _0x4de171 of _0x238b72){if(!_0x4de171['inserted'][_0x5124b7(0x136)]&&!_0x4de171['modified'][_0x5124b7(0x136)]&&!_0x4de171[_0x5124b7(0x10a)][_0x5124b7(0x136)])continue;const _0x2a3d41=[],_0x1e280f=[],_0xbce106=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x5124b7(0x135)][_0x5124b7(0x122)],this[_0x5124b7(0x135)][_0x5124b7(0xf9)],_0x4de171['author'],this['options']['recordTypes'],this['proceededComponentsMeta']);_0x2a3d41[_0x5124b7(0x10d)](...await _0xbce106[_0x5124b7(0x121)](_0x4de171[_0x5124b7(0xf0)],this['options'][_0x5124b7(0x131)])),_0x2a3d41[_0x5124b7(0x10d)](...await _0xbce106[_0x5124b7(0xec)](_0x4de171[_0x5124b7(0x11f)],this[_0x5124b7(0x135)]['commitId'])),_0x1e280f[_0x5124b7(0x10d)](await _0xbce106[_0x5124b7(0xfe)](_0x4de171['removed'],!![])),this[_0x5124b7(0x105)]=_0xbce106[_0x5124b7(0xf2)](),await this[_0x5124b7(0x12d)](_0x2a3d41,!![]);for(const _0x2e687d of _0x1e280f){_0x2e687d[_0x5124b7(0xf7)][_0x5124b7(0x136)]&&await this[_0x5124b7(0x12d)](_0x2e687d[_0x5124b7(0xf7)],!![]),_0x2e687d[_0x5124b7(0x101)][_0x5124b7(0x136)]&&await this[_0x5124b7(0x12d)](_0x2e687d['componentsToUpdate'],!![]),_0x2e687d[_0x5124b7(0x11a)]['length']&&await this[_0x5124b7(0x12d)](_0x2e687d[_0x5124b7(0x11a)],!![]);}this[_0x5124b7(0xf5)][_0x5124b7(0x133)](_0x5124b7(0x127),_0x2a3d41['length']);}}async[a227_0x32da3e(0xf6)](_0x56d9bd){const _0x15f98c=a227_0x32da3e,_0x3d8be2=[],_0x491055=[];for(const _0x146159 of _0x56d9bd){if(!_0x146159['inserted']['length']&&!_0x146159['modified']['length']&&!_0x146159[_0x15f98c(0x10a)][_0x15f98c(0x136)])continue;const _0x34e861=new salesforce_components_manager_service_1[(_0x15f98c(0x129))](this['options'][_0x15f98c(0x122)],this[_0x15f98c(0x135)][_0x15f98c(0xf9)],_0x146159[_0x15f98c(0x119)],this[_0x15f98c(0x135)]['recordTypes'],[]);_0x3d8be2[_0x15f98c(0x10d)](...await _0x34e861['insert'](_0x146159[_0x15f98c(0xf0)])),_0x3d8be2[_0x15f98c(0x10d)](...await _0x34e861[_0x15f98c(0xec)](_0x146159[_0x15f98c(0x11f)])),_0x491055[_0x15f98c(0x10d)](await _0x34e861[_0x15f98c(0xfe)](_0x146159[_0x15f98c(0x10a)]));}this[_0x15f98c(0xf5)][_0x15f98c(0x133)](_0x15f98c(0x117),_0x3d8be2['length']),await this[_0x15f98c(0x12d)](_0x3d8be2);const _0x19ba4e=_0x491055['reduce']((_0x2bb633,_0x11e432)=>({'manifests':[..._0x2bb633[_0x15f98c(0xf7)],..._0x11e432[_0x15f98c(0xf7)]],'componentsToDelete':[..._0x2bb633[_0x15f98c(0x11a)],..._0x11e432[_0x15f98c(0x11a)]],'componentsToUpdate':[..._0x2bb633[_0x15f98c(0x101)],..._0x11e432[_0x15f98c(0x101)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x19ba4e['manifests'][_0x15f98c(0x136)]&&await this['proceedRequests'](_0x19ba4e[_0x15f98c(0xf7)],!![]),_0x19ba4e[_0x15f98c(0x101)][_0x15f98c(0x136)]&&await this[_0x15f98c(0x12d)](_0x19ba4e[_0x15f98c(0x101)],!![]),_0x19ba4e[_0x15f98c(0x11a)][_0x15f98c(0x136)]&&await this[_0x15f98c(0x12d)](_0x19ba4e[_0x15f98c(0x11a)],!![]);}async[a227_0x32da3e(0xff)](_0xfa627c){const _0x37f4b2=a227_0x32da3e;this['options'][_0x37f4b2(0xf9)]?await this[_0x37f4b2(0xf6)](_0xfa627c):await this[_0x37f4b2(0xfa)](_0xfa627c);}}function a227_0x53fc(){const _0x166d59=['extractComponentIdsFromGraphsResponse','apply','742654qLxMAr','modified','(((.+)+)+)+$','insert','repositoryId','2211uSdQue','sfLogger','7BpaEcT','1900921tqXhAe','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','../utils/composite.utils','SalesforceComponentsManager','4235226gihrcZ','Logger','map','proceedRequests','stringify','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','616415tBQECQ','commitId','splice','log','proceedChunksToUpload','options','length','error','constructor','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','componentId','chunkArray','default','update','search','1372lhIIdN','SalesforceCommitsManager','inserted','composite','getProceededComponentsMeta','typedi','../errors/salesforce.error','logger','proceedCommitsToBranch','manifests','graph','branchId','proceedCommitsToRepository','923822zYvswi','__importDefault','50ZlnIfG','delete','proceedCommits','902808JYHdGb','componentsToUpdate','reference','./salesforce-composite.service','__esModule','proceededComponentsMeta','SalesforceCompositeService','toString','./salesforce-components-manager.service','get','removed','find','COMPONENTS_PER_CHUNK','push','../../../shared/utils','name','SALESFORCE_MAX_REQUEST_SIZE_BYTES','27aCwvDc','../../../../core','SalesforceError','toJSON','floor','reduce','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','executeGraphs','author','componentsToDelete','defineProperty'];a227_0x53fc=function(){return _0x166d59;};return a227_0x53fc();}exports['SalesforceCommitsManager']=SalesforceCommitsManager;