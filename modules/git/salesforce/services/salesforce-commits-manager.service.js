const a195_0x194c00=a195_0x3875;(function(_0x2d625f,_0xba4be7){const _0x3f460a=a195_0x3875,_0x59f54a=_0x2d625f();while(!![]){try{const _0x58cd56=-parseInt(_0x3f460a(0xf2))/0x1*(-parseInt(_0x3f460a(0xfa))/0x2)+parseInt(_0x3f460a(0xee))/0x3*(parseInt(_0x3f460a(0xe0))/0x4)+parseInt(_0x3f460a(0xd9))/0x5*(-parseInt(_0x3f460a(0xc3))/0x6)+parseInt(_0x3f460a(0xf4))/0x7+-parseInt(_0x3f460a(0xcb))/0x8+parseInt(_0x3f460a(0xd4))/0x9*(-parseInt(_0x3f460a(0xd1))/0xa)+-parseInt(_0x3f460a(0xbd))/0xb;if(_0x58cd56===_0xba4be7)break;else _0x59f54a['push'](_0x59f54a['shift']());}catch(_0x23ab42){_0x59f54a['push'](_0x59f54a['shift']());}}}(a195_0x478f,0x94261));function a195_0x478f(){const _0xb739c9=['componentsToDelete','extractComponentIdsFromGraphsResponse','componentId','recordTypes','2722TilxYP','modified','chunkArray','SalesforceComponentsManager','length','../../../shared/utils','proceedChunksToUpload','floor','commitId','options','executeGraphs','default','inserted','repositoryId','author','10029008lpTCCA','toJSON','../../../../core','../../../../constants','apply','logger','1830YzUQRh','./salesforce-composite.service','branchId','composite','push','delete','name','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','524552nLRaqe','SalesforceCommitsManager','proceedCommitsToRepository','./salesforce-components-manager.service','stringify','sfLogger','4758790qHttLK','COMPONENTS_PER_CHUNK','\x20requests\x20to\x20composite\x20api.','9UvgLPR','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','removed','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','graph','4015lNNgBg','get','SalesforceError','update','componentsToUpdate','SalesforceCompositeService','insert','3956UHRyId','reduce','toString','constructor','\x20COMPONENTS_SIZE\x20=\x20','proceedCommitsToBranch','log','search','getProceededComponentsMeta','proceededComponentsMeta','(((.+)+)+)+$','manifests','__importDefault','Logger','3141RGxHke','map','find','SALESFORCE_MAX_REQUEST_SIZE_BYTES','877dvApzj','error','530796DMqOFE','proceedRequests'];a195_0x478f=function(){return _0xb739c9;};return a195_0x478f();}const a195_0x525f4d=(function(){let _0x296716=!![];return function(_0xa9db0a,_0x3bb9e3){const _0x4edde5=_0x296716?function(){const _0x40b812=a195_0x3875;if(_0x3bb9e3){const _0x416920=_0x3bb9e3[_0x40b812(0xc1)](_0xa9db0a,arguments);return _0x3bb9e3=null,_0x416920;}}:function(){};return _0x296716=![],_0x4edde5;};}()),a195_0x3631d4=a195_0x525f4d(this,function(){const _0x15d4b5=a195_0x3875;return a195_0x3631d4['toString']()[_0x15d4b5(0xe7)]('(((.+)+)+)+$')[_0x15d4b5(0xe2)]()[_0x15d4b5(0xe3)](a195_0x3631d4)[_0x15d4b5(0xe7)](_0x15d4b5(0xea));});a195_0x3631d4();'use strict';var __importDefault=this&&this[a195_0x194c00(0xec)]||function(_0x6a853c){return _0x6a853c&&_0x6a853c['__esModule']?_0x6a853c:{'default':_0x6a853c};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a195_0x194c00(0xcc)]=void 0x0;const core_1=require(a195_0x194c00(0xbf)),typedi_1=__importDefault(require('typedi')),constants_1=require(a195_0x194c00(0xc0)),utils_1=require(a195_0x194c00(0xb3)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require(a195_0x194c00(0xce)),salesforce_composite_service_1=require(a195_0x194c00(0xc4));class SalesforceCommitsManager{constructor(_0x5babd1){const _0x1b749e=a195_0x194c00;this['options']=_0x5babd1,this[_0x1b749e(0xd2)]=0x3,this[_0x1b749e(0xc2)]=new core_1[(_0x1b749e(0xed))](SalesforceCommitsManager[_0x1b749e(0xc9)]),this[_0x1b749e(0xd0)]=this[_0x1b749e(0xb7)][_0x1b749e(0xc2)],this[_0x1b749e(0xc6)]=typedi_1[_0x1b749e(0xb9)][_0x1b749e(0xda)](salesforce_composite_service_1[_0x1b749e(0xde)]),this['proceededComponentsMeta']=[];}async['proceedChunksToUpload'](_0xe80121,_0x3d008a=![]){const _0x1a1f4f=a195_0x194c00,_0x20bb90=async _0x4b50fa=>{const _0xd4b101=a195_0x3875;await this[_0xd4b101(0xc2)]['log']('Sending\x20'+_0x4b50fa['reduce']((_0x18753b,_0x14cd65)=>_0x18753b+_0x14cd65[_0xd4b101(0xb2)],0x0)+_0xd4b101(0xd3));const _0x274ea0=_0x4b50fa[_0xd4b101(0xef)]((_0x3595db,_0x4b396c)=>({'graphId':_0xd4b101(0xd8)+_0x4b396c,'compositeRequest':_0x3595db})),_0x1610c4=await this[_0xd4b101(0xc6)][_0xd4b101(0xb8)](_0x274ea0);if(_0x3d008a){const _0xe2a49c=(0x0,composite_utils_1[_0xd4b101(0xf7)])(_0x1610c4);for(const {id:_0x3c5f59,ref:_0x5bc4c9}of _0xe2a49c){const _0x427e06=this['proceededComponentsMeta'][_0xd4b101(0xf0)](_0x2dc2a1=>_0x2dc2a1['reference']===_0x5bc4c9);_0x427e06&&(_0x427e06[_0xd4b101(0xf8)]=_0x3c5f59);}}},_0x39bdbb=0x1e8480;let _0x566108=0x0,_0x1d79ec=[];for(const _0x43ca9c of _0xe80121){const _0x13966d=_0x43ca9c[_0x1a1f4f(0xe1)]((_0xc4750,_0x104082)=>{const _0x51763f=_0x1a1f4f,_0x4bf4db=JSON[_0x51763f(0xcf)](_0x104082)[_0x51763f(0xb2)]*0x2;return _0xc4750+_0x4bf4db;},0x0);if(_0x13966d>constants_1[_0x1a1f4f(0xf1)])throw new salesforce_error_1[(_0x1a1f4f(0xdb))](_0x1a1f4f(0xca)+constants_1[_0x1a1f4f(0xf1)]+_0x1a1f4f(0xe4)+_0x13966d);_0x566108+_0x13966d>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']-_0x39bdbb&&(await _0x20bb90(_0x1d79ec),_0x1d79ec=[],_0x566108=0x0),_0x566108+=_0x13966d,_0x1d79ec[_0x1a1f4f(0xc7)](_0x43ca9c);}_0x1d79ec[_0x1a1f4f(0xb2)]&&await _0x20bb90(_0x1d79ec);}async[a195_0x194c00(0xf5)](_0x11d76b,_0x54cd70=![]){const _0x4da452=a195_0x194c00,_0x35d3de=(this[_0x4da452(0xd2)]+ +_0x54cd70)*0x3,_0x36d4aa=(0x0,utils_1[_0x4da452(0xfc)])(_0x11d76b,_0x35d3de);try{while(_0x36d4aa[_0x4da452(0xb2)]){const _0x5136b1=_0x36d4aa['splice'](0x0,Math[_0x4da452(0xb5)](constants_1[_0x4da452(0xd7)]/_0x35d3de));await this[_0x4da452(0xb4)](_0x5136b1,_0x54cd70);}}catch(_0x100e3e){this[_0x4da452(0xc2)][_0x4da452(0xf3)](_0x100e3e instanceof salesforce_error_1[_0x4da452(0xdb)]?JSON[_0x4da452(0xcf)](_0x100e3e['toJSON'](),null,0x2):_0x100e3e),this[_0x4da452(0xd0)][_0x4da452(0xe6)](_0x100e3e instanceof salesforce_error_1[_0x4da452(0xdb)]?JSON[_0x4da452(0xcf)](_0x100e3e[_0x4da452(0xbe)](),null,0x2):_0x100e3e[_0x4da452(0xe2)]());throw _0x100e3e;}}async['proceedCommitsToRepository'](_0x1a9a72){const _0x5af397=a195_0x194c00;for(const _0x1a126d of _0x1a9a72){if(!_0x1a126d[_0x5af397(0xba)][_0x5af397(0xb2)]&&!_0x1a126d[_0x5af397(0xfb)][_0x5af397(0xb2)]&&!_0x1a126d[_0x5af397(0xd6)][_0x5af397(0xb2)])continue;const _0x53c995=[],_0x5e8076=[],_0x46bfb8=new salesforce_components_manager_service_1[(_0x5af397(0xb1))](this[_0x5af397(0xb7)]['repositoryId'],this[_0x5af397(0xb7)]['branchId'],_0x1a126d[_0x5af397(0xbc)],this[_0x5af397(0xb7)][_0x5af397(0xf9)],this['proceededComponentsMeta']);_0x53c995[_0x5af397(0xc7)](...await _0x46bfb8[_0x5af397(0xdf)](_0x1a126d[_0x5af397(0xba)],this['options']['commitId'])),_0x53c995['push'](...await _0x46bfb8[_0x5af397(0xdc)](_0x1a126d[_0x5af397(0xfb)],this[_0x5af397(0xb7)][_0x5af397(0xb6)])),_0x5e8076['push'](await _0x46bfb8[_0x5af397(0xc8)](_0x1a126d[_0x5af397(0xd6)],!![])),this[_0x5af397(0xe9)]=_0x46bfb8[_0x5af397(0xe8)](),await this[_0x5af397(0xf5)](_0x53c995,!![]);for(const _0x2f7438 of _0x5e8076){_0x2f7438['manifests']['length']&&await this[_0x5af397(0xf5)](_0x2f7438[_0x5af397(0xeb)],!![]),_0x2f7438[_0x5af397(0xdd)]['length']&&await this['proceedRequests'](_0x2f7438[_0x5af397(0xdd)],!![]),_0x2f7438['componentsToDelete'][_0x5af397(0xb2)]&&await this[_0x5af397(0xf5)](_0x2f7438['componentsToDelete'],!![]);}this[_0x5af397(0xc2)]['log'](_0x5af397(0xd5),_0x53c995[_0x5af397(0xb2)]);}}async[a195_0x194c00(0xe5)](_0x3f13b5){const _0x3e634f=a195_0x194c00,_0x1e71ce=[],_0x2fb899=[];for(const _0x256d6d of _0x3f13b5){if(!_0x256d6d['inserted'][_0x3e634f(0xb2)]&&!_0x256d6d[_0x3e634f(0xfb)][_0x3e634f(0xb2)]&&!_0x256d6d[_0x3e634f(0xd6)]['length'])continue;const _0x235e52=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x3e634f(0xb7)][_0x3e634f(0xbb)],this[_0x3e634f(0xb7)][_0x3e634f(0xc5)],_0x256d6d[_0x3e634f(0xbc)],this[_0x3e634f(0xb7)]['recordTypes'],[]);_0x1e71ce[_0x3e634f(0xc7)](...await _0x235e52[_0x3e634f(0xdf)](_0x256d6d[_0x3e634f(0xba)])),_0x1e71ce[_0x3e634f(0xc7)](...await _0x235e52['update'](_0x256d6d[_0x3e634f(0xfb)])),_0x2fb899['push'](await _0x235e52[_0x3e634f(0xc8)](_0x256d6d[_0x3e634f(0xd6)]));}this[_0x3e634f(0xc2)][_0x3e634f(0xe6)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)',_0x1e71ce['length']),await this[_0x3e634f(0xf5)](_0x1e71ce);const _0x234aa3=_0x2fb899[_0x3e634f(0xe1)]((_0x432ae7,_0x3e6bea)=>({'manifests':[..._0x432ae7[_0x3e634f(0xeb)],..._0x3e6bea['manifests']],'componentsToDelete':[..._0x432ae7[_0x3e634f(0xf6)],..._0x3e6bea[_0x3e634f(0xf6)]],'componentsToUpdate':[..._0x432ae7[_0x3e634f(0xdd)],..._0x3e6bea['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x234aa3[_0x3e634f(0xeb)]['length']&&await this[_0x3e634f(0xf5)](_0x234aa3[_0x3e634f(0xeb)],!![]),_0x234aa3[_0x3e634f(0xdd)]['length']&&await this[_0x3e634f(0xf5)](_0x234aa3['componentsToUpdate'],!![]),_0x234aa3[_0x3e634f(0xf6)][_0x3e634f(0xb2)]&&await this[_0x3e634f(0xf5)](_0x234aa3[_0x3e634f(0xf6)],!![]);}async['proceedCommits'](_0x3918ce){const _0x2819f6=a195_0x194c00;this[_0x2819f6(0xb7)][_0x2819f6(0xc5)]?await this[_0x2819f6(0xe5)](_0x3918ce):await this[_0x2819f6(0xcd)](_0x3918ce);}}function a195_0x3875(_0x45b0f1,_0xd398a){const _0x3840df=a195_0x478f();return a195_0x3875=function(_0x3631d4,_0x525f4d){_0x3631d4=_0x3631d4-0xb1;let _0x478faf=_0x3840df[_0x3631d4];return _0x478faf;},a195_0x3875(_0x45b0f1,_0xd398a);}exports[a195_0x194c00(0xcc)]=SalesforceCommitsManager;