const a244_0x4bfaab=a244_0x5ad9;function a244_0x1eee(){const _0x39d83c=['author','commitId','inserted','defineProperty','error','recordTypes','update','chunkArray','stringify','214friOUK','proceedRequests','SALESFORCE_MAX_REQUEST_SIZE_BYTES','4CdZeDZ','modified','composite','proceededComponentsMeta','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','map','graph','removed','constructor','720903TfeXHs','reference','componentId','Sending\x20','Logger','toString','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','proceedCommitsToBranch','reduce','./salesforce-components-manager.service','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','(((.+)+)+)+$','executeGraphs','SalesforceCompositeService','options','manifests','4063810ySBHih','../errors/salesforce.error','proceedChunksToUpload','__esModule','SalesforceComponentsManager','length','../utils/composite.utils','./salesforce-composite.service','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','COMPONENTS_PER_CHUNK','push','typedi','repositoryId','17007EsYsrb','default','delete','logger','340270pMHQZs','sfLogger','SalesforceCommitsManager','1144608Fayfac','SalesforceError','apply','proceedCommitsToRepository','6646434eHWWHa','branchId','componentsToDelete','componentsToUpdate','insert','find','toJSON','floor','name','extractComponentIdsFromGraphsResponse','get','9435807BvYEqT','log','../../../shared/utils'];a244_0x1eee=function(){return _0x39d83c;};return a244_0x1eee();}(function(_0x307a8e,_0x3e005c){const _0x303be3=a244_0x5ad9,_0x5e2ee7=_0x307a8e();while(!![]){try{const _0x3e8e71=parseInt(_0x303be3(0xec))/0x1+-parseInt(_0x303be3(0xe0))/0x2*(-parseInt(_0x303be3(0x109))/0x3)+parseInt(_0x303be3(0xe3))/0x4*(-parseInt(_0x303be3(0xfc))/0x5)+parseInt(_0x303be3(0xc9))/0x6+-parseInt(_0x303be3(0xc2))/0x7+parseInt(_0x303be3(0xc5))/0x8+-parseInt(_0x303be3(0xd4))/0x9;if(_0x3e8e71===_0x3e005c)break;else _0x5e2ee7['push'](_0x5e2ee7['shift']());}catch(_0x2dffe9){_0x5e2ee7['push'](_0x5e2ee7['shift']());}}}(a244_0x1eee,0xa335a));function a244_0x5ad9(_0xc1164a,_0x5b5f93){const _0x127a68=a244_0x1eee();return a244_0x5ad9=function(_0x278865,_0x2464e1){_0x278865=_0x278865-0xc2;let _0x1eeea1=_0x127a68[_0x278865];return _0x1eeea1;},a244_0x5ad9(_0xc1164a,_0x5b5f93);}const a244_0x2464e1=(function(){let _0x2f53e4=!![];return function(_0x2b2be2,_0x2d0e90){const _0x16588d=_0x2f53e4?function(){const _0x2e04fa=a244_0x5ad9;if(_0x2d0e90){const _0x14d5ea=_0x2d0e90[_0x2e04fa(0xc7)](_0x2b2be2,arguments);return _0x2d0e90=null,_0x14d5ea;}}:function(){};return _0x2f53e4=![],_0x16588d;};}()),a244_0x278865=a244_0x2464e1(this,function(){const _0x20abda=a244_0x5ad9;return a244_0x278865[_0x20abda(0xf1)]()['search'](_0x20abda(0xf7))[_0x20abda(0xf1)]()[_0x20abda(0xeb)](a244_0x278865)['search'](_0x20abda(0xf7));});a244_0x278865();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4a38a2){const _0x50a177=a244_0x5ad9;return _0x4a38a2&&_0x4a38a2[_0x50a177(0xff)]?_0x4a38a2:{'default':_0x4a38a2};};Object[a244_0x4bfaab(0xda)](exports,'__esModule',{'value':!![]}),exports[a244_0x4bfaab(0xc4)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require(a244_0x4bfaab(0x107))),constants_1=require('../../../../constants'),utils_1=require(a244_0x4bfaab(0xd6)),salesforce_error_1=require(a244_0x4bfaab(0xfd)),composite_utils_1=require(a244_0x4bfaab(0x102)),salesforce_components_manager_service_1=require(a244_0x4bfaab(0xf5)),salesforce_composite_service_1=require(a244_0x4bfaab(0x103));class SalesforceCommitsManager{constructor(_0x282fee){const _0x499332=a244_0x4bfaab;this[_0x499332(0xfa)]=_0x282fee,this[_0x499332(0x105)]=0x3,this[_0x499332(0x10c)]=new core_1[(_0x499332(0xf0))](SalesforceCommitsManager[_0x499332(0xd1)]),this[_0x499332(0xc3)]=this[_0x499332(0xfa)][_0x499332(0x10c)],this['composite']=typedi_1[_0x499332(0x10a)][_0x499332(0xd3)](salesforce_composite_service_1[_0x499332(0xf9)]),this['proceededComponentsMeta']=[];}async[a244_0x4bfaab(0xfe)](_0x2bc945,_0x34480d=![]){const _0x4d5961=a244_0x4bfaab,_0x3e0fa5=async _0x25d1d1=>{const _0x1fe09f=a244_0x5ad9;await this[_0x1fe09f(0x10c)][_0x1fe09f(0xd5)](_0x1fe09f(0xef)+_0x25d1d1[_0x1fe09f(0xf4)]((_0x4c1501,_0x47ae39)=>_0x4c1501+_0x47ae39['length'],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x1d7e4c=_0x25d1d1[_0x1fe09f(0xe8)]((_0x1d3529,_0x34e3e8)=>({'graphId':_0x1fe09f(0xe9)+_0x34e3e8,'compositeRequest':_0x1d3529})),_0x10ab1d=await this[_0x1fe09f(0xe5)][_0x1fe09f(0xf8)](_0x1d7e4c);if(_0x34480d){const _0x1a8f78=(0x0,composite_utils_1[_0x1fe09f(0xd2)])(_0x10ab1d);for(const {id:_0x5b4906,ref:_0x161369}of _0x1a8f78){const _0x396f71=this[_0x1fe09f(0xe6)][_0x1fe09f(0xce)](_0xc69a26=>_0xc69a26[_0x1fe09f(0xed)]===_0x161369);_0x396f71&&(_0x396f71[_0x1fe09f(0xee)]=_0x5b4906);}}},_0x104a9f=0x1e8480;let _0x53a408=0x0,_0x27ff81=[];for(const _0x4b913e of _0x2bc945){const _0x483efe=_0x4b913e[_0x4d5961(0xf4)]((_0x39a88a,_0x339a5d)=>{const _0x1c9e2b=_0x4d5961,_0x56895c=JSON[_0x1c9e2b(0xdf)](_0x339a5d)[_0x1c9e2b(0x101)]*0x2;return _0x39a88a+_0x56895c;},0x0);if(_0x483efe>constants_1[_0x4d5961(0xe2)])throw new salesforce_error_1[(_0x4d5961(0xc6))](_0x4d5961(0xf2)+constants_1[_0x4d5961(0xe2)]+'\x20COMPONENTS_SIZE\x20=\x20'+_0x483efe);_0x53a408+_0x483efe>constants_1[_0x4d5961(0xe2)]-_0x104a9f&&(await _0x3e0fa5(_0x27ff81),_0x27ff81=[],_0x53a408=0x0),_0x53a408+=_0x483efe,_0x27ff81[_0x4d5961(0x106)](_0x4b913e);}_0x27ff81[_0x4d5961(0x101)]&&await _0x3e0fa5(_0x27ff81);}async[a244_0x4bfaab(0xe1)](_0x2c56e7,_0x48f55b=![]){const _0x4a6770=a244_0x4bfaab,_0x483b25=(this[_0x4a6770(0x105)]+ +_0x48f55b)*0x3,_0x3e7578=(0x0,utils_1[_0x4a6770(0xde)])(_0x2c56e7,_0x483b25);try{while(_0x3e7578[_0x4a6770(0x101)]){const _0x22e36e=_0x3e7578['splice'](0x0,Math[_0x4a6770(0xd0)](constants_1[_0x4a6770(0xf6)]/_0x483b25));await this[_0x4a6770(0xfe)](_0x22e36e,_0x48f55b);}}catch(_0x19f814){this['logger'][_0x4a6770(0xdb)](_0x19f814 instanceof salesforce_error_1[_0x4a6770(0xc6)]?JSON[_0x4a6770(0xdf)](_0x19f814[_0x4a6770(0xcf)](),null,0x2):_0x19f814),this[_0x4a6770(0xc3)][_0x4a6770(0xd5)](_0x19f814 instanceof salesforce_error_1[_0x4a6770(0xc6)]?JSON[_0x4a6770(0xdf)](_0x19f814[_0x4a6770(0xcf)](),null,0x2):_0x19f814[_0x4a6770(0xf1)]());throw _0x19f814;}}async[a244_0x4bfaab(0xc8)](_0x4d4c33){const _0x5e161b=a244_0x4bfaab;for(const _0x4ca2e2 of _0x4d4c33){if(!_0x4ca2e2[_0x5e161b(0xd9)][_0x5e161b(0x101)]&&!_0x4ca2e2[_0x5e161b(0xe4)][_0x5e161b(0x101)]&&!_0x4ca2e2[_0x5e161b(0xea)][_0x5e161b(0x101)])continue;const _0x2589d2=[],_0x5f1ce0=[],_0x3a6137=new salesforce_components_manager_service_1[(_0x5e161b(0x100))](this['options'][_0x5e161b(0x108)],this['options'][_0x5e161b(0xca)],_0x4ca2e2[_0x5e161b(0xd7)],this[_0x5e161b(0xfa)]['recordTypes'],this[_0x5e161b(0xe6)]);_0x2589d2[_0x5e161b(0x106)](...await _0x3a6137[_0x5e161b(0xcd)](_0x4ca2e2[_0x5e161b(0xd9)],this[_0x5e161b(0xfa)][_0x5e161b(0xd8)])),_0x2589d2['push'](...await _0x3a6137[_0x5e161b(0xdd)](_0x4ca2e2[_0x5e161b(0xe4)],this[_0x5e161b(0xfa)]['commitId'])),_0x5f1ce0[_0x5e161b(0x106)](await _0x3a6137[_0x5e161b(0x10b)](_0x4ca2e2[_0x5e161b(0xea)],!![])),this['proceededComponentsMeta']=_0x3a6137['getProceededComponentsMeta'](),await this[_0x5e161b(0xe1)](_0x2589d2,!![]);for(const _0x20d05b of _0x5f1ce0){_0x20d05b[_0x5e161b(0xfb)]['length']&&await this[_0x5e161b(0xe1)](_0x20d05b[_0x5e161b(0xfb)],!![]),_0x20d05b[_0x5e161b(0xcc)][_0x5e161b(0x101)]&&await this[_0x5e161b(0xe1)](_0x20d05b[_0x5e161b(0xcc)],!![]),_0x20d05b[_0x5e161b(0xcb)][_0x5e161b(0x101)]&&await this[_0x5e161b(0xe1)](_0x20d05b[_0x5e161b(0xcb)],!![]);}this[_0x5e161b(0x10c)]['log'](_0x5e161b(0xe7),_0x2589d2[_0x5e161b(0x101)]);}}async['proceedCommitsToBranch'](_0x917f68){const _0x1bedd9=a244_0x4bfaab,_0x3e126f=[],_0x29c58c=[];for(const _0x4c2646 of _0x917f68){if(!_0x4c2646['inserted'][_0x1bedd9(0x101)]&&!_0x4c2646[_0x1bedd9(0xe4)][_0x1bedd9(0x101)]&&!_0x4c2646[_0x1bedd9(0xea)][_0x1bedd9(0x101)])continue;const _0xd31c74=new salesforce_components_manager_service_1[(_0x1bedd9(0x100))](this['options'][_0x1bedd9(0x108)],this[_0x1bedd9(0xfa)]['branchId'],_0x4c2646[_0x1bedd9(0xd7)],this[_0x1bedd9(0xfa)][_0x1bedd9(0xdc)],[]);_0x3e126f[_0x1bedd9(0x106)](...await _0xd31c74[_0x1bedd9(0xcd)](_0x4c2646['inserted'])),_0x3e126f[_0x1bedd9(0x106)](...await _0xd31c74[_0x1bedd9(0xdd)](_0x4c2646['modified'])),_0x29c58c[_0x1bedd9(0x106)](await _0xd31c74[_0x1bedd9(0x10b)](_0x4c2646[_0x1bedd9(0xea)]));}this[_0x1bedd9(0x10c)][_0x1bedd9(0xd5)](_0x1bedd9(0x104),_0x3e126f['length']),await this[_0x1bedd9(0xe1)](_0x3e126f);const _0x2e8cd5=_0x29c58c[_0x1bedd9(0xf4)]((_0x3635b3,_0x196af4)=>({'manifests':[..._0x3635b3[_0x1bedd9(0xfb)],..._0x196af4[_0x1bedd9(0xfb)]],'componentsToDelete':[..._0x3635b3[_0x1bedd9(0xcb)],..._0x196af4['componentsToDelete']],'componentsToUpdate':[..._0x3635b3[_0x1bedd9(0xcc)],..._0x196af4[_0x1bedd9(0xcc)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x2e8cd5[_0x1bedd9(0xfb)][_0x1bedd9(0x101)]&&await this['proceedRequests'](_0x2e8cd5[_0x1bedd9(0xfb)],!![]),_0x2e8cd5['componentsToUpdate'][_0x1bedd9(0x101)]&&await this[_0x1bedd9(0xe1)](_0x2e8cd5[_0x1bedd9(0xcc)],!![]),_0x2e8cd5['componentsToDelete'][_0x1bedd9(0x101)]&&await this[_0x1bedd9(0xe1)](_0x2e8cd5['componentsToDelete'],!![]);}async['proceedCommits'](_0x1a9eb8){const _0xbae7ec=a244_0x4bfaab;this[_0xbae7ec(0xfa)][_0xbae7ec(0xca)]?await this[_0xbae7ec(0xf3)](_0x1a9eb8):await this[_0xbae7ec(0xc8)](_0x1a9eb8);}}exports['SalesforceCommitsManager']=SalesforceCommitsManager;