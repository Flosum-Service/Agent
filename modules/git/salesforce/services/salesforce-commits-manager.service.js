const a270_0x37f8f6=a270_0xdccb;(function(_0x39a2b9,_0x43c40f){const _0xd5919a=a270_0xdccb,_0x107dd6=_0x39a2b9();while(!![]){try{const _0x4b37a8=-parseInt(_0xd5919a(0x10b))/0x1*(-parseInt(_0xd5919a(0x127))/0x2)+-parseInt(_0xd5919a(0x142))/0x3+parseInt(_0xd5919a(0x11c))/0x4*(parseInt(_0xd5919a(0x116))/0x5)+-parseInt(_0xd5919a(0x12a))/0x6+parseInt(_0xd5919a(0x126))/0x7+-parseInt(_0xd5919a(0x136))/0x8+-parseInt(_0xd5919a(0x125))/0x9;if(_0x4b37a8===_0x43c40f)break;else _0x107dd6['push'](_0x107dd6['shift']());}catch(_0x5a0113){_0x107dd6['push'](_0x107dd6['shift']());}}}(a270_0x2ea7,0xbd6be));const a270_0xb961e4=(function(){let _0x331f77=!![];return function(_0x232e81,_0x13411b){const _0x5934d5=_0x331f77?function(){const _0x160a57=a270_0xdccb;if(_0x13411b){const _0x37f158=_0x13411b[_0x160a57(0x12b)](_0x232e81,arguments);return _0x13411b=null,_0x37f158;}}:function(){};return _0x331f77=![],_0x5934d5;};}()),a270_0x45619f=a270_0xb961e4(this,function(){const _0x11df81=a270_0xdccb;return a270_0x45619f[_0x11df81(0x124)]()[_0x11df81(0x121)](_0x11df81(0x152))[_0x11df81(0x124)]()[_0x11df81(0x14d)](a270_0x45619f)[_0x11df81(0x121)](_0x11df81(0x152));});function a270_0x2ea7(){const _0x4e8eb5=['proceedCommits','get','getProceededComponentsMeta','15HtlKUe','composite','manifests','update','repositoryId','SalesforceCommitsManager','1697788EdaEsL','stringify','../utils/composite.utils','Sending\x20','reference','search','proceedCommitsToBranch','COMPONENTS_PER_CHUNK','toString','6556167rkGDyF','5838175FNAmTW','180cLpyAG','proceedChunksToUpload','error','640500AHXGsb','apply','__importDefault','proceedRequests','chunkArray','\x20COMPONENTS_SIZE\x20=\x20','../errors/salesforce.error','SalesforceError','push','insert','log','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','5450704uQDMkN','componentsToUpdate','SalesforceCompositeService','./salesforce-composite.service','author','executeGraphs','branchId','../../../../core','../../../shared/utils','reduce','map','proceedCommitsToRepository','2988045SAfGPx','toJSON','default','componentsToDelete','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','floor','inserted','Logger','removed','length','delete','constructor','modified','commitId','./salesforce-components-manager.service','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','(((.+)+)+)+$','find','options','proceededComponentsMeta','13123VaksgK','SALESFORCE_MAX_REQUEST_SIZE_BYTES','__esModule','name','SalesforceComponentsManager','logger','typedi','sfLogger'];a270_0x2ea7=function(){return _0x4e8eb5;};return a270_0x2ea7();}a270_0x45619f();'use strict';var __importDefault=this&&this[a270_0x37f8f6(0x12c)]||function(_0xf8e82c){const _0x22c8a7=a270_0x37f8f6;return _0xf8e82c&&_0xf8e82c[_0x22c8a7(0x10d)]?_0xf8e82c:{'default':_0xf8e82c};};function a270_0xdccb(_0x2e9319,_0x3533dc){const _0x33b9fe=a270_0x2ea7();return a270_0xdccb=function(_0x45619f,_0xb961e4){_0x45619f=_0x45619f-0x10a;let _0x2ea7a5=_0x33b9fe[_0x45619f];return _0x2ea7a5;},a270_0xdccb(_0x2e9319,_0x3533dc);}Object['defineProperty'](exports,a270_0x37f8f6(0x10d),{'value':!![]}),exports[a270_0x37f8f6(0x11b)]=void 0x0;const core_1=require(a270_0x37f8f6(0x13d)),typedi_1=__importDefault(require(a270_0x37f8f6(0x111))),constants_1=require('../../../../constants'),utils_1=require(a270_0x37f8f6(0x13e)),salesforce_error_1=require(a270_0x37f8f6(0x130)),composite_utils_1=require(a270_0x37f8f6(0x11e)),salesforce_components_manager_service_1=require(a270_0x37f8f6(0x150)),salesforce_composite_service_1=require(a270_0x37f8f6(0x139));class SalesforceCommitsManager{constructor(_0x5409e9){const _0x30e7c3=a270_0x37f8f6;this['options']=_0x5409e9,this[_0x30e7c3(0x123)]=0x3,this[_0x30e7c3(0x110)]=new core_1[(_0x30e7c3(0x149))](SalesforceCommitsManager[_0x30e7c3(0x10e)]),this['sfLogger']=this['options'][_0x30e7c3(0x110)],this[_0x30e7c3(0x117)]=typedi_1[_0x30e7c3(0x144)][_0x30e7c3(0x114)](salesforce_composite_service_1[_0x30e7c3(0x138)]),this[_0x30e7c3(0x10a)]=[];}async['proceedChunksToUpload'](_0x37d242,_0x5ab183=![]){const _0x6f4540=a270_0x37f8f6,_0x56bf0e=async _0x5c201f=>{const _0x5d27d3=a270_0xdccb;await this[_0x5d27d3(0x110)][_0x5d27d3(0x134)](_0x5d27d3(0x11f)+_0x5c201f[_0x5d27d3(0x13f)]((_0x30dcdc,_0x2181cb)=>_0x30dcdc+_0x2181cb[_0x5d27d3(0x14b)],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x17a453=_0x5c201f[_0x5d27d3(0x140)]((_0xe3e81e,_0x5ad81d)=>({'graphId':'graph'+_0x5ad81d,'compositeRequest':_0xe3e81e})),_0x106562=await this[_0x5d27d3(0x117)][_0x5d27d3(0x13b)](_0x17a453);if(_0x5ab183){const _0x53f78f=(0x0,composite_utils_1['extractComponentIdsFromGraphsResponse'])(_0x106562);for(const {id:_0x1ed8f6,ref:_0x8ecf8}of _0x53f78f){const _0x1ea739=this[_0x5d27d3(0x10a)][_0x5d27d3(0x153)](_0x2359c2=>_0x2359c2[_0x5d27d3(0x120)]===_0x8ecf8);_0x1ea739&&(_0x1ea739['componentId']=_0x1ed8f6);}}},_0x4b854a=0x1e8480;let _0x1609b5=0x0,_0x29ed38=[];for(const _0x986a2e of _0x37d242){const _0x572d0c=_0x986a2e[_0x6f4540(0x13f)]((_0x32561a,_0x45ab54)=>{const _0x20fb84=_0x6f4540,_0x3498c1=JSON[_0x20fb84(0x11d)](_0x45ab54)['length']*0x2;return _0x32561a+_0x3498c1;},0x0);if(_0x572d0c>constants_1[_0x6f4540(0x10c)])throw new salesforce_error_1['SalesforceError'](_0x6f4540(0x146)+constants_1[_0x6f4540(0x10c)]+_0x6f4540(0x12f)+_0x572d0c);_0x1609b5+_0x572d0c>constants_1[_0x6f4540(0x10c)]-_0x4b854a&&(await _0x56bf0e(_0x29ed38),_0x29ed38=[],_0x1609b5=0x0),_0x1609b5+=_0x572d0c,_0x29ed38['push'](_0x986a2e);}_0x29ed38[_0x6f4540(0x14b)]&&await _0x56bf0e(_0x29ed38);}async[a270_0x37f8f6(0x12d)](_0x3f924c,_0x404041=![]){const _0xb18136=a270_0x37f8f6,_0x2bc28f=(this['COMPONENTS_PER_CHUNK']+ +_0x404041)*0x3,_0x247d74=(0x0,utils_1[_0xb18136(0x12e)])(_0x3f924c,_0x2bc28f);try{while(_0x247d74[_0xb18136(0x14b)]){const _0xf0e224=_0x247d74['splice'](0x0,Math[_0xb18136(0x147)](constants_1[_0xb18136(0x135)]/_0x2bc28f));await this[_0xb18136(0x128)](_0xf0e224,_0x404041);}}catch(_0x26d133){this[_0xb18136(0x110)][_0xb18136(0x129)](_0x26d133 instanceof salesforce_error_1['SalesforceError']?JSON[_0xb18136(0x11d)](_0x26d133[_0xb18136(0x143)](),null,0x2):_0x26d133),this[_0xb18136(0x112)]['log'](_0x26d133 instanceof salesforce_error_1[_0xb18136(0x131)]?JSON[_0xb18136(0x11d)](_0x26d133[_0xb18136(0x143)](),null,0x2):_0x26d133[_0xb18136(0x124)]());throw _0x26d133;}}async[a270_0x37f8f6(0x141)](_0x61da57){const _0x472df9=a270_0x37f8f6;for(const _0x3a6c5 of _0x61da57){if(!_0x3a6c5[_0x472df9(0x148)]['length']&&!_0x3a6c5[_0x472df9(0x14e)][_0x472df9(0x14b)]&&!_0x3a6c5['removed'][_0x472df9(0x14b)])continue;const _0x5c2447=[],_0x475ae2=[],_0x460a16=new salesforce_components_manager_service_1[(_0x472df9(0x10f))](this[_0x472df9(0x154)][_0x472df9(0x11a)],this['options'][_0x472df9(0x13c)],_0x3a6c5[_0x472df9(0x13a)],this[_0x472df9(0x154)]['recordTypes'],this[_0x472df9(0x10a)]);_0x5c2447[_0x472df9(0x132)](...await _0x460a16['insert'](_0x3a6c5['inserted'],this['options'][_0x472df9(0x14f)])),_0x5c2447[_0x472df9(0x132)](...await _0x460a16['update'](_0x3a6c5[_0x472df9(0x14e)],this['options'][_0x472df9(0x14f)])),_0x475ae2[_0x472df9(0x132)](await _0x460a16['delete'](_0x3a6c5[_0x472df9(0x14a)],!![])),this[_0x472df9(0x10a)]=_0x460a16[_0x472df9(0x115)](),await this['proceedRequests'](_0x5c2447,!![]);for(const _0x436810 of _0x475ae2){_0x436810['manifests'][_0x472df9(0x14b)]&&await this[_0x472df9(0x12d)](_0x436810[_0x472df9(0x118)],!![]),_0x436810[_0x472df9(0x137)][_0x472df9(0x14b)]&&await this[_0x472df9(0x12d)](_0x436810['componentsToUpdate'],!![]),_0x436810[_0x472df9(0x145)][_0x472df9(0x14b)]&&await this['proceedRequests'](_0x436810[_0x472df9(0x145)],!![]);}this[_0x472df9(0x110)][_0x472df9(0x134)](_0x472df9(0x151),_0x5c2447[_0x472df9(0x14b)]);}}async[a270_0x37f8f6(0x122)](_0x4d71db){const _0x33b807=a270_0x37f8f6,_0x1655af=[],_0x2f3139=[];for(const _0xa86d77 of _0x4d71db){if(!_0xa86d77[_0x33b807(0x148)][_0x33b807(0x14b)]&&!_0xa86d77[_0x33b807(0x14e)]['length']&&!_0xa86d77['removed'][_0x33b807(0x14b)])continue;const _0x399025=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x33b807(0x154)][_0x33b807(0x11a)],this[_0x33b807(0x154)][_0x33b807(0x13c)],_0xa86d77['author'],this[_0x33b807(0x154)]['recordTypes'],[]);_0x1655af[_0x33b807(0x132)](...await _0x399025[_0x33b807(0x133)](_0xa86d77[_0x33b807(0x148)])),_0x1655af[_0x33b807(0x132)](...await _0x399025[_0x33b807(0x119)](_0xa86d77[_0x33b807(0x14e)])),_0x2f3139[_0x33b807(0x132)](await _0x399025[_0x33b807(0x14c)](_0xa86d77[_0x33b807(0x14a)]));}this[_0x33b807(0x110)][_0x33b807(0x134)]('Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)',_0x1655af[_0x33b807(0x14b)]),await this[_0x33b807(0x12d)](_0x1655af);const _0xceb331=_0x2f3139[_0x33b807(0x13f)]((_0x119ddc,_0x2c0a82)=>({'manifests':[..._0x119ddc[_0x33b807(0x118)],..._0x2c0a82[_0x33b807(0x118)]],'componentsToDelete':[..._0x119ddc[_0x33b807(0x145)],..._0x2c0a82[_0x33b807(0x145)]],'componentsToUpdate':[..._0x119ddc[_0x33b807(0x137)],..._0x2c0a82[_0x33b807(0x137)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0xceb331[_0x33b807(0x118)]['length']&&await this[_0x33b807(0x12d)](_0xceb331[_0x33b807(0x118)],!![]),_0xceb331[_0x33b807(0x137)][_0x33b807(0x14b)]&&await this[_0x33b807(0x12d)](_0xceb331[_0x33b807(0x137)],!![]),_0xceb331[_0x33b807(0x145)][_0x33b807(0x14b)]&&await this[_0x33b807(0x12d)](_0xceb331[_0x33b807(0x145)],!![]);}async[a270_0x37f8f6(0x113)](_0x5e1652){const _0xbb414e=a270_0x37f8f6;this['options']['branchId']?await this[_0xbb414e(0x122)](_0x5e1652):await this[_0xbb414e(0x141)](_0x5e1652);}}exports[a270_0x37f8f6(0x11b)]=SalesforceCommitsManager;