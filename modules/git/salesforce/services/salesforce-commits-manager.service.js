const a260_0x417382=a260_0x3301;(function(_0x3f5e35,_0x221432){const _0x413be9=a260_0x3301,_0x47e040=_0x3f5e35();while(!![]){try{const _0x5bf5b8=-parseInt(_0x413be9(0xe7))/0x1*(parseInt(_0x413be9(0xbe))/0x2)+parseInt(_0x413be9(0xc4))/0x3+parseInt(_0x413be9(0xe9))/0x4*(-parseInt(_0x413be9(0xf4))/0x5)+parseInt(_0x413be9(0xbb))/0x6*(-parseInt(_0x413be9(0xd0))/0x7)+parseInt(_0x413be9(0xf1))/0x8+parseInt(_0x413be9(0xee))/0x9+parseInt(_0x413be9(0xe6))/0xa;if(_0x5bf5b8===_0x221432)break;else _0x47e040['push'](_0x47e040['shift']());}catch(_0x4a9005){_0x47e040['push'](_0x47e040['shift']());}}}(a260_0x1c06,0xbe144));const a260_0x36a207=(function(){let _0x4cb849=!![];return function(_0x11cdeb,_0x11e02f){const _0x1c5bd9=_0x4cb849?function(){if(_0x11e02f){const _0x4f499e=_0x11e02f['apply'](_0x11cdeb,arguments);return _0x11e02f=null,_0x4f499e;}}:function(){};return _0x4cb849=![],_0x1c5bd9;};}()),a260_0x1b89fd=a260_0x36a207(this,function(){const _0xb52b2d=a260_0x3301;return a260_0x1b89fd[_0xb52b2d(0xe0)]()[_0xb52b2d(0xfb)](_0xb52b2d(0xd4))[_0xb52b2d(0xe0)]()[_0xb52b2d(0xc3)](a260_0x1b89fd)[_0xb52b2d(0xfb)]('(((.+)+)+)+$');});a260_0x1b89fd();'use strict';function a260_0x3301(_0x51cb1d,_0x1ecfea){const _0x83f588=a260_0x1c06();return a260_0x3301=function(_0x1b89fd,_0x36a207){_0x1b89fd=_0x1b89fd-0xb5;let _0x1c060f=_0x83f588[_0x1b89fd];return _0x1c060f;},a260_0x3301(_0x51cb1d,_0x1ecfea);}var __importDefault=this&&this[a260_0x417382(0xc9)]||function(_0x3882e8){const _0x30d16e=a260_0x417382;return _0x3882e8&&_0x3882e8[_0x30d16e(0xbf)]?_0x3882e8:{'default':_0x3882e8};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a260_0x417382(0xec)]=void 0x0;const core_1=require(a260_0x417382(0xed)),typedi_1=__importDefault(require(a260_0x417382(0xf0))),constants_1=require('../../../../constants'),utils_1=require(a260_0x417382(0xe1)),salesforce_error_1=require(a260_0x417382(0xbc)),composite_utils_1=require(a260_0x417382(0xd6)),salesforce_components_manager_service_1=require(a260_0x417382(0xb5)),salesforce_composite_service_1=require('./salesforce-composite.service');function a260_0x1c06(){const _0x1bc0b9=['reduce','error','modified','7001598UXTqSj','../errors/salesforce.error','sfLogger','225286kQvyFv','__esModule','SalesforceComponentsManager','SalesforceError','toJSON','constructor','32370OutToq','delete','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','logger','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','__importDefault','graph','push','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','proceededComponentsMeta','proceedCommitsToRepository','proceedChunksToUpload','7hLNRXv','repositoryId','author','composite','(((.+)+)+)+$','extractComponentIdsFromGraphsResponse','../utils/composite.utils','inserted','reference','stringify','proceedCommitsToBranch','manifests','insert','log','SALESFORCE_MAX_REQUEST_SIZE_BYTES','name','toString','../../../shared/utils','options','length','executeGraphs','removed','14756690UZtHpf','1rHnOYE','branchId','4bHofdh','recordTypes','\x20requests\x20to\x20composite\x20api.','SalesforceCommitsManager','../../../../core','7035624VQdBMp','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','typedi','9046272UEjKzb','COMPONENTS_PER_CHUNK','componentId','6704195NqWLIm','componentsToUpdate','default','componentsToDelete','Logger','getProceededComponentsMeta','\x20COMPONENTS_SIZE\x20=\x20','search','proceedCommits','./salesforce-components-manager.service','update','proceedRequests'];a260_0x1c06=function(){return _0x1bc0b9;};return a260_0x1c06();}class SalesforceCommitsManager{constructor(_0x1458d3){const _0x36b4d3=a260_0x417382;this[_0x36b4d3(0xe2)]=_0x1458d3,this['COMPONENTS_PER_CHUNK']=0x3,this['logger']=new core_1[(_0x36b4d3(0xf8))](SalesforceCommitsManager[_0x36b4d3(0xdf)]),this['sfLogger']=this[_0x36b4d3(0xe2)][_0x36b4d3(0xc7)],this[_0x36b4d3(0xd3)]=typedi_1[_0x36b4d3(0xf6)]['get'](salesforce_composite_service_1['SalesforceCompositeService']),this['proceededComponentsMeta']=[];}async[a260_0x417382(0xcf)](_0x4fa1de,_0x4a1c71=![]){const _0x49213b=a260_0x417382,_0x4addce=async _0xd9e441=>{const _0x1f1f4b=a260_0x3301;await this[_0x1f1f4b(0xc7)]['log']('Sending\x20'+_0xd9e441[_0x1f1f4b(0xb8)]((_0x2cc024,_0x21af54)=>_0x2cc024+_0x21af54['length'],0x0)+_0x1f1f4b(0xeb));const _0x5a223f=_0xd9e441['map']((_0x3c8add,_0x4dbd22)=>({'graphId':_0x1f1f4b(0xca)+_0x4dbd22,'compositeRequest':_0x3c8add})),_0x372c2b=await this[_0x1f1f4b(0xd3)][_0x1f1f4b(0xe4)](_0x5a223f);if(_0x4a1c71){const _0xb22602=(0x0,composite_utils_1[_0x1f1f4b(0xd5)])(_0x372c2b);for(const {id:_0x578252,ref:_0x78b4ec}of _0xb22602){const _0x28b981=this[_0x1f1f4b(0xcd)]['find'](_0x537b00=>_0x537b00[_0x1f1f4b(0xd8)]===_0x78b4ec);_0x28b981&&(_0x28b981[_0x1f1f4b(0xf3)]=_0x578252);}}},_0x2dff3a=0x1e8480;let _0x4ac75a=0x0,_0x5fad3f=[];for(const _0x16c8c6 of _0x4fa1de){const _0x171b4d=_0x16c8c6[_0x49213b(0xb8)]((_0x484449,_0x970884)=>{const _0x235ac4=_0x49213b,_0x4ac79a=JSON[_0x235ac4(0xd9)](_0x970884)[_0x235ac4(0xe3)]*0x2;return _0x484449+_0x4ac79a;},0x0);if(_0x171b4d>constants_1[_0x49213b(0xde)])throw new salesforce_error_1[(_0x49213b(0xc1))](_0x49213b(0xcc)+constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']+_0x49213b(0xfa)+_0x171b4d);_0x4ac75a+_0x171b4d>constants_1[_0x49213b(0xde)]-_0x2dff3a&&(await _0x4addce(_0x5fad3f),_0x5fad3f=[],_0x4ac75a=0x0),_0x4ac75a+=_0x171b4d,_0x5fad3f[_0x49213b(0xcb)](_0x16c8c6);}_0x5fad3f[_0x49213b(0xe3)]&&await _0x4addce(_0x5fad3f);}async[a260_0x417382(0xb7)](_0x2daca3,_0x2740da=![]){const _0x154474=a260_0x417382,_0xc249ca=(this[_0x154474(0xf2)]+ +_0x2740da)*0x3,_0x1a9d0a=(0x0,utils_1['chunkArray'])(_0x2daca3,_0xc249ca);try{while(_0x1a9d0a[_0x154474(0xe3)]){const _0x46214b=_0x1a9d0a['splice'](0x0,Math['floor'](constants_1[_0x154474(0xc8)]/_0xc249ca));await this[_0x154474(0xcf)](_0x46214b,_0x2740da);}}catch(_0x571ac5){this[_0x154474(0xc7)][_0x154474(0xb9)](_0x571ac5 instanceof salesforce_error_1[_0x154474(0xc1)]?JSON[_0x154474(0xd9)](_0x571ac5[_0x154474(0xc2)](),null,0x2):_0x571ac5),this[_0x154474(0xbd)]['log'](_0x571ac5 instanceof salesforce_error_1[_0x154474(0xc1)]?JSON['stringify'](_0x571ac5['toJSON'](),null,0x2):_0x571ac5[_0x154474(0xe0)]());throw _0x571ac5;}}async['proceedCommitsToRepository'](_0x4dc92d){const _0x58e97f=a260_0x417382;for(const _0x41c65a of _0x4dc92d){if(!_0x41c65a['inserted'][_0x58e97f(0xe3)]&&!_0x41c65a[_0x58e97f(0xba)][_0x58e97f(0xe3)]&&!_0x41c65a[_0x58e97f(0xe5)][_0x58e97f(0xe3)])continue;const _0x2e9bb4=[],_0x11c670=[],_0xd8f02f=new salesforce_components_manager_service_1[(_0x58e97f(0xc0))](this[_0x58e97f(0xe2)][_0x58e97f(0xd1)],this[_0x58e97f(0xe2)][_0x58e97f(0xe8)],_0x41c65a[_0x58e97f(0xd2)],this[_0x58e97f(0xe2)][_0x58e97f(0xea)],this[_0x58e97f(0xcd)]);_0x2e9bb4[_0x58e97f(0xcb)](...await _0xd8f02f[_0x58e97f(0xdc)](_0x41c65a[_0x58e97f(0xd7)],this[_0x58e97f(0xe2)]['commitId'])),_0x2e9bb4[_0x58e97f(0xcb)](...await _0xd8f02f[_0x58e97f(0xb6)](_0x41c65a['modified'],this[_0x58e97f(0xe2)]['commitId'])),_0x11c670[_0x58e97f(0xcb)](await _0xd8f02f[_0x58e97f(0xc5)](_0x41c65a[_0x58e97f(0xe5)],!![])),this[_0x58e97f(0xcd)]=_0xd8f02f[_0x58e97f(0xf9)](),await this['proceedRequests'](_0x2e9bb4,!![]);for(const _0x2ca9f1 of _0x11c670){_0x2ca9f1[_0x58e97f(0xdb)]['length']&&await this['proceedRequests'](_0x2ca9f1[_0x58e97f(0xdb)],!![]),_0x2ca9f1['componentsToUpdate'][_0x58e97f(0xe3)]&&await this[_0x58e97f(0xb7)](_0x2ca9f1['componentsToUpdate'],!![]),_0x2ca9f1[_0x58e97f(0xf7)]['length']&&await this[_0x58e97f(0xb7)](_0x2ca9f1['componentsToDelete'],!![]);}this[_0x58e97f(0xc7)][_0x58e97f(0xdd)](_0x58e97f(0xc6),_0x2e9bb4['length']);}}async['proceedCommitsToBranch'](_0x36dff7){const _0xfc0310=a260_0x417382,_0x1abe2a=[],_0x381f18=[];for(const _0x2edbbe of _0x36dff7){if(!_0x2edbbe[_0xfc0310(0xd7)][_0xfc0310(0xe3)]&&!_0x2edbbe[_0xfc0310(0xba)][_0xfc0310(0xe3)]&&!_0x2edbbe[_0xfc0310(0xe5)][_0xfc0310(0xe3)])continue;const _0x3df74d=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0xfc0310(0xe2)][_0xfc0310(0xd1)],this['options'][_0xfc0310(0xe8)],_0x2edbbe[_0xfc0310(0xd2)],this[_0xfc0310(0xe2)][_0xfc0310(0xea)],[]);_0x1abe2a[_0xfc0310(0xcb)](...await _0x3df74d[_0xfc0310(0xdc)](_0x2edbbe[_0xfc0310(0xd7)])),_0x1abe2a[_0xfc0310(0xcb)](...await _0x3df74d['update'](_0x2edbbe[_0xfc0310(0xba)])),_0x381f18[_0xfc0310(0xcb)](await _0x3df74d[_0xfc0310(0xc5)](_0x2edbbe['removed']));}this['logger'][_0xfc0310(0xdd)](_0xfc0310(0xef),_0x1abe2a[_0xfc0310(0xe3)]),await this['proceedRequests'](_0x1abe2a);const _0x4d870f=_0x381f18['reduce']((_0x5c51c9,_0x2a2084)=>({'manifests':[..._0x5c51c9[_0xfc0310(0xdb)],..._0x2a2084[_0xfc0310(0xdb)]],'componentsToDelete':[..._0x5c51c9[_0xfc0310(0xf7)],..._0x2a2084[_0xfc0310(0xf7)]],'componentsToUpdate':[..._0x5c51c9['componentsToUpdate'],..._0x2a2084[_0xfc0310(0xf5)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x4d870f['manifests']['length']&&await this[_0xfc0310(0xb7)](_0x4d870f[_0xfc0310(0xdb)],!![]),_0x4d870f[_0xfc0310(0xf5)][_0xfc0310(0xe3)]&&await this[_0xfc0310(0xb7)](_0x4d870f['componentsToUpdate'],!![]),_0x4d870f[_0xfc0310(0xf7)]['length']&&await this[_0xfc0310(0xb7)](_0x4d870f[_0xfc0310(0xf7)],!![]);}async[a260_0x417382(0xfc)](_0x383dca){const _0x1bde88=a260_0x417382;this[_0x1bde88(0xe2)][_0x1bde88(0xe8)]?await this[_0x1bde88(0xda)](_0x383dca):await this[_0x1bde88(0xce)](_0x383dca);}}exports[a260_0x417382(0xec)]=SalesforceCommitsManager;