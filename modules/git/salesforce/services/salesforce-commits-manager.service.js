const a233_0x127a7c=a233_0x4787;function a233_0x4787(_0x5bbdbe,_0x53112e){const _0x5409c5=a233_0x3e45();return a233_0x4787=function(_0x1d9a12,_0x1b2b07){_0x1d9a12=_0x1d9a12-0x8e;let _0x3e45fe=_0x5409c5[_0x1d9a12];return _0x3e45fe;},a233_0x4787(_0x5bbdbe,_0x53112e);}(function(_0x40d924,_0x51daf6){const _0x35ed8c=a233_0x4787,_0xb7a419=_0x40d924();while(!![]){try{const _0x3bc081=parseInt(_0x35ed8c(0xa7))/0x1+-parseInt(_0x35ed8c(0xbd))/0x2*(-parseInt(_0x35ed8c(0xa6))/0x3)+parseInt(_0x35ed8c(0x9a))/0x4*(-parseInt(_0x35ed8c(0xc0))/0x5)+-parseInt(_0x35ed8c(0xcd))/0x6+-parseInt(_0x35ed8c(0x92))/0x7*(parseInt(_0x35ed8c(0xb1))/0x8)+-parseInt(_0x35ed8c(0xc5))/0x9+parseInt(_0x35ed8c(0xc2))/0xa*(parseInt(_0x35ed8c(0x98))/0xb);if(_0x3bc081===_0x51daf6)break;else _0xb7a419['push'](_0xb7a419['shift']());}catch(_0x39886c){_0xb7a419['push'](_0xb7a419['shift']());}}}(a233_0x3e45,0xd2809));const a233_0x1b2b07=(function(){let _0x5af387=!![];return function(_0x2a8a61,_0x3510f1){const _0x361069=_0x5af387?function(){if(_0x3510f1){const _0x2de74d=_0x3510f1['apply'](_0x2a8a61,arguments);return _0x3510f1=null,_0x2de74d;}}:function(){};return _0x5af387=![],_0x361069;};}()),a233_0x1d9a12=a233_0x1b2b07(this,function(){const _0x448b79=a233_0x4787;return a233_0x1d9a12[_0x448b79(0xcb)]()['search'](_0x448b79(0xb5))['toString']()[_0x448b79(0xb7)](a233_0x1d9a12)['search']('(((.+)+)+)+$');});a233_0x1d9a12();'use strict';var __importDefault=this&&this['__importDefault']||function(_0xadd729){const _0x4f10aa=a233_0x4787;return _0xadd729&&_0xadd729[_0x4f10aa(0xb4)]?_0xadd729:{'default':_0xadd729};};Object['defineProperty'](exports,a233_0x127a7c(0xb4),{'value':!![]}),exports[a233_0x127a7c(0xd2)]=void 0x0;function a233_0x3e45(){const _0x2136a0=['repositoryId','update','sfLogger','2019483CQtrPz','800100lVVgYj','logger','name','commitId','stringify','branchId','componentsToUpdate','composite','length','get','9208KipnJX','find','getProceededComponentsMeta','__esModule','(((.+)+)+)+$','push','constructor','Sending\x20','removed','SalesforceError','insert','delete','4aHrWVf','COMPONENTS_PER_CHUNK','options','115nYpvPg','proceedRequests','20efQHNf','\x20requests\x20to\x20composite\x20api.','author','13820121PADUfA','../utils/composite.utils','../../../../core','modified','extractComponentIdsFromGraphsResponse','SALESFORCE_MAX_REQUEST_SIZE_BYTES','toString','SalesforceComponentsManager','9911460GHHKoy','graph','../errors/salesforce.error','manifests','recordTypes','SalesforceCommitsManager','proceedCommitsToBranch','Logger','componentId','splice','reduce','componentsToDelete','log','proceededComponentsMeta','8659biiMTu','map','SalesforceCompositeService','../../../../constants','proceedChunksToUpload','typedi','22522291EcwIWS','toJSON','133548OcYUrT','\x20COMPONENTS_SIZE\x20=\x20','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','chunkArray','error','proceedCommitsToRepository','proceedCommits','inserted','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)'];a233_0x3e45=function(){return _0x2136a0;};return a233_0x3e45();}const core_1=require(a233_0x127a7c(0xc7)),typedi_1=__importDefault(require(a233_0x127a7c(0x97))),constants_1=require(a233_0x127a7c(0x95)),utils_1=require('../../../shared/utils'),salesforce_error_1=require(a233_0x127a7c(0xcf)),composite_utils_1=require(a233_0x127a7c(0xc6)),salesforce_components_manager_service_1=require('./salesforce-components-manager.service'),salesforce_composite_service_1=require('./salesforce-composite.service');class SalesforceCommitsManager{constructor(_0x12877a){const _0x7f83da=a233_0x127a7c;this[_0x7f83da(0xbf)]=_0x12877a,this['COMPONENTS_PER_CHUNK']=0x3,this[_0x7f83da(0xa8)]=new core_1[(_0x7f83da(0xd4))](SalesforceCommitsManager[_0x7f83da(0xa9)]),this['sfLogger']=this['options'][_0x7f83da(0xa8)],this[_0x7f83da(0xae)]=typedi_1['default'][_0x7f83da(0xb0)](salesforce_composite_service_1[_0x7f83da(0x94)]),this['proceededComponentsMeta']=[];}async[a233_0x127a7c(0x96)](_0x392832,_0x242895=![]){const _0x110252=a233_0x127a7c,_0x5f55ed=async _0x5126ae=>{const _0x46bbd1=a233_0x4787;await this[_0x46bbd1(0xa8)][_0x46bbd1(0x90)](_0x46bbd1(0xb8)+_0x5126ae['reduce']((_0x473405,_0x30532e)=>_0x473405+_0x30532e['length'],0x0)+_0x46bbd1(0xc3));const _0x5bf081=_0x5126ae[_0x46bbd1(0x93)]((_0x2ee53f,_0x2dfa03)=>({'graphId':_0x46bbd1(0xce)+_0x2dfa03,'compositeRequest':_0x2ee53f})),_0x1cce8a=await this[_0x46bbd1(0xae)]['executeGraphs'](_0x5bf081);if(_0x242895){const _0x25c850=(0x0,composite_utils_1[_0x46bbd1(0xc9)])(_0x1cce8a);for(const {id:_0x2e96e8,ref:_0x3f1cc0}of _0x25c850){const _0x4db449=this[_0x46bbd1(0x91)][_0x46bbd1(0xb2)](_0x59b955=>_0x59b955['reference']===_0x3f1cc0);_0x4db449&&(_0x4db449[_0x46bbd1(0xd5)]=_0x2e96e8);}}},_0xb3bec8=0x1e8480;let _0x4afde6=0x0,_0x1f8e9d=[];for(const _0x59574c of _0x392832){const _0x15e11c=_0x59574c[_0x110252(0x8e)]((_0x47b34d,_0x359a55)=>{const _0x30b2ff=_0x110252,_0x259110=JSON[_0x30b2ff(0xab)](_0x359a55)[_0x30b2ff(0xaf)]*0x2;return _0x47b34d+_0x259110;},0x0);if(_0x15e11c>constants_1[_0x110252(0xca)])throw new salesforce_error_1[(_0x110252(0xba))](_0x110252(0x9c)+constants_1[_0x110252(0xca)]+_0x110252(0x9b)+_0x15e11c);_0x4afde6+_0x15e11c>constants_1[_0x110252(0xca)]-_0xb3bec8&&(await _0x5f55ed(_0x1f8e9d),_0x1f8e9d=[],_0x4afde6=0x0),_0x4afde6+=_0x15e11c,_0x1f8e9d['push'](_0x59574c);}_0x1f8e9d[_0x110252(0xaf)]&&await _0x5f55ed(_0x1f8e9d);}async[a233_0x127a7c(0xc1)](_0x327b10,_0x4acc80=![]){const _0x1bf2f3=a233_0x127a7c,_0x1a409e=(this[_0x1bf2f3(0xbe)]+ +_0x4acc80)*0x3,_0x202c76=(0x0,utils_1[_0x1bf2f3(0x9d)])(_0x327b10,_0x1a409e);try{while(_0x202c76['length']){const _0x303abb=_0x202c76[_0x1bf2f3(0xd6)](0x0,Math['floor'](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x1a409e));await this[_0x1bf2f3(0x96)](_0x303abb,_0x4acc80);}}catch(_0x1e4b4d){this[_0x1bf2f3(0xa8)][_0x1bf2f3(0x9e)](_0x1e4b4d instanceof salesforce_error_1['SalesforceError']?JSON[_0x1bf2f3(0xab)](_0x1e4b4d['toJSON'](),null,0x2):_0x1e4b4d),this[_0x1bf2f3(0xa5)]['log'](_0x1e4b4d instanceof salesforce_error_1[_0x1bf2f3(0xba)]?JSON[_0x1bf2f3(0xab)](_0x1e4b4d[_0x1bf2f3(0x99)](),null,0x2):_0x1e4b4d[_0x1bf2f3(0xcb)]());throw _0x1e4b4d;}}async[a233_0x127a7c(0x9f)](_0x4a7717){const _0x8985f2=a233_0x127a7c;for(const _0x35ca9b of _0x4a7717){if(!_0x35ca9b['inserted'][_0x8985f2(0xaf)]&&!_0x35ca9b[_0x8985f2(0xc8)]['length']&&!_0x35ca9b['removed']['length'])continue;const _0x16c288=[],_0x85d988=[],_0x355b77=new salesforce_components_manager_service_1[(_0x8985f2(0xcc))](this[_0x8985f2(0xbf)]['repositoryId'],this[_0x8985f2(0xbf)][_0x8985f2(0xac)],_0x35ca9b[_0x8985f2(0xc4)],this[_0x8985f2(0xbf)][_0x8985f2(0xd1)],this['proceededComponentsMeta']);_0x16c288['push'](...await _0x355b77[_0x8985f2(0xbb)](_0x35ca9b['inserted'],this[_0x8985f2(0xbf)]['commitId'])),_0x16c288[_0x8985f2(0xb6)](...await _0x355b77[_0x8985f2(0xa4)](_0x35ca9b['modified'],this[_0x8985f2(0xbf)][_0x8985f2(0xaa)])),_0x85d988[_0x8985f2(0xb6)](await _0x355b77[_0x8985f2(0xbc)](_0x35ca9b[_0x8985f2(0xb9)],!![])),this[_0x8985f2(0x91)]=_0x355b77[_0x8985f2(0xb3)](),await this['proceedRequests'](_0x16c288,!![]);for(const _0x5527ad of _0x85d988){_0x5527ad[_0x8985f2(0xd0)][_0x8985f2(0xaf)]&&await this[_0x8985f2(0xc1)](_0x5527ad[_0x8985f2(0xd0)],!![]),_0x5527ad[_0x8985f2(0xad)][_0x8985f2(0xaf)]&&await this[_0x8985f2(0xc1)](_0x5527ad[_0x8985f2(0xad)],!![]),_0x5527ad['componentsToDelete'][_0x8985f2(0xaf)]&&await this[_0x8985f2(0xc1)](_0x5527ad[_0x8985f2(0x8f)],!![]);}this[_0x8985f2(0xa8)][_0x8985f2(0x90)](_0x8985f2(0xa2),_0x16c288[_0x8985f2(0xaf)]);}}async[a233_0x127a7c(0xd3)](_0xaf81fe){const _0x35c0e0=a233_0x127a7c,_0xe19c17=[],_0x1b3344=[];for(const _0x4e623b of _0xaf81fe){if(!_0x4e623b[_0x35c0e0(0xa1)]['length']&&!_0x4e623b[_0x35c0e0(0xc8)]['length']&&!_0x4e623b[_0x35c0e0(0xb9)][_0x35c0e0(0xaf)])continue;const _0x196795=new salesforce_components_manager_service_1[(_0x35c0e0(0xcc))](this[_0x35c0e0(0xbf)][_0x35c0e0(0xa3)],this[_0x35c0e0(0xbf)]['branchId'],_0x4e623b[_0x35c0e0(0xc4)],this[_0x35c0e0(0xbf)][_0x35c0e0(0xd1)],[]);_0xe19c17['push'](...await _0x196795[_0x35c0e0(0xbb)](_0x4e623b[_0x35c0e0(0xa1)])),_0xe19c17[_0x35c0e0(0xb6)](...await _0x196795[_0x35c0e0(0xa4)](_0x4e623b[_0x35c0e0(0xc8)])),_0x1b3344[_0x35c0e0(0xb6)](await _0x196795['delete'](_0x4e623b[_0x35c0e0(0xb9)]));}this[_0x35c0e0(0xa8)][_0x35c0e0(0x90)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)',_0xe19c17['length']),await this['proceedRequests'](_0xe19c17);const _0x53b048=_0x1b3344['reduce']((_0x382e84,_0x465971)=>({'manifests':[..._0x382e84[_0x35c0e0(0xd0)],..._0x465971['manifests']],'componentsToDelete':[..._0x382e84[_0x35c0e0(0x8f)],..._0x465971[_0x35c0e0(0x8f)]],'componentsToUpdate':[..._0x382e84[_0x35c0e0(0xad)],..._0x465971[_0x35c0e0(0xad)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x53b048[_0x35c0e0(0xd0)][_0x35c0e0(0xaf)]&&await this[_0x35c0e0(0xc1)](_0x53b048[_0x35c0e0(0xd0)],!![]),_0x53b048[_0x35c0e0(0xad)][_0x35c0e0(0xaf)]&&await this[_0x35c0e0(0xc1)](_0x53b048[_0x35c0e0(0xad)],!![]),_0x53b048[_0x35c0e0(0x8f)]['length']&&await this['proceedRequests'](_0x53b048[_0x35c0e0(0x8f)],!![]);}async[a233_0x127a7c(0xa0)](_0xbabe24){const _0x13dd18=a233_0x127a7c;this[_0x13dd18(0xbf)][_0x13dd18(0xac)]?await this[_0x13dd18(0xd3)](_0xbabe24):await this[_0x13dd18(0x9f)](_0xbabe24);}}exports['SalesforceCommitsManager']=SalesforceCommitsManager;