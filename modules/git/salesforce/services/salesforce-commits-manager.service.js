const a272_0x143bcf=a272_0x1f8e;(function(_0x445171,_0xece24a){const _0xd4ecfe=a272_0x1f8e,_0x1632de=_0x445171();while(!![]){try{const _0x20655f=-parseInt(_0xd4ecfe(0x146))/0x1+parseInt(_0xd4ecfe(0x159))/0x2*(-parseInt(_0xd4ecfe(0x125))/0x3)+parseInt(_0xd4ecfe(0x12c))/0x4+parseInt(_0xd4ecfe(0x148))/0x5+parseInt(_0xd4ecfe(0x144))/0x6*(parseInt(_0xd4ecfe(0x152))/0x7)+parseInt(_0xd4ecfe(0x158))/0x8+parseInt(_0xd4ecfe(0x118))/0x9;if(_0x20655f===_0xece24a)break;else _0x1632de['push'](_0x1632de['shift']());}catch(_0x4edd37){_0x1632de['push'](_0x1632de['shift']());}}}(a272_0xaa11,0x42c6b));const a272_0x1104e9=(function(){let _0x2738c1=!![];return function(_0x5a92b0,_0x532097){const _0x3430c0=_0x2738c1?function(){const _0x162d11=a272_0x1f8e;if(_0x532097){const _0x3e4cd2=_0x532097[_0x162d11(0x121)](_0x5a92b0,arguments);return _0x532097=null,_0x3e4cd2;}}:function(){};return _0x2738c1=![],_0x3430c0;};}()),a272_0x37f810=a272_0x1104e9(this,function(){const _0x4015e7=a272_0x1f8e;return a272_0x37f810[_0x4015e7(0x132)]()[_0x4015e7(0x149)](_0x4015e7(0x131))[_0x4015e7(0x132)]()[_0x4015e7(0x122)](a272_0x37f810)[_0x4015e7(0x149)](_0x4015e7(0x131));});a272_0x37f810();'use strict';var __importDefault=this&&this[a272_0x143bcf(0x13e)]||function(_0x231f04){const _0x3cf7e2=a272_0x143bcf;return _0x231f04&&_0x231f04[_0x3cf7e2(0x138)]?_0x231f04:{'default':_0x231f04};};Object['defineProperty'](exports,a272_0x143bcf(0x138),{'value':!![]}),exports[a272_0x143bcf(0x11d)]=void 0x0;function a272_0x1f8e(_0x15aafb,_0x4b101d){const _0x4c2290=a272_0xaa11();return a272_0x1f8e=function(_0x37f810,_0x1104e9){_0x37f810=_0x37f810-0x118;let _0xaa115b=_0x4c2290[_0x37f810];return _0xaa115b;},a272_0x1f8e(_0x15aafb,_0x4b101d);}const core_1=require('../../../../core'),typedi_1=__importDefault(require(a272_0x143bcf(0x14c))),constants_1=require(a272_0x143bcf(0x124)),utils_1=require(a272_0x143bcf(0x145)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a272_0x143bcf(0x155)),salesforce_components_manager_service_1=require(a272_0x143bcf(0x11c)),salesforce_composite_service_1=require('./salesforce-composite.service');function a272_0xaa11(){const _0x27ba6d=['branchId','graph','proceedCommitsToRepository','recordTypes','\x20COMPONENTS_SIZE\x20=\x20','43561dOafjI','name','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','../utils/composite.utils','COMPONENTS_PER_CHUNK','componentId','2712904zwjfhN','6652CclcaL','componentsToUpdate','Logger','chunkArray','proceedRequests','get','SalesforceError','inserted','515619otbodJ','composite','insert','reference','./salesforce-components-manager.service','SalesforceCommitsManager','toJSON','sfLogger','find','apply','constructor','options','../../../../constants','489uGRbEK','SalesforceCompositeService','floor','logger','manifests','log','push','1545060OaSoyf','proceedChunksToUpload','reduce','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','removed','(((.+)+)+)+$','toString','componentsToDelete','author','length','SALESFORCE_MAX_REQUEST_SIZE_BYTES','modified','__esModule','update','delete','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','getProceededComponentsMeta','proceedCommitsToBranch','__importDefault','repositoryId','extractComponentIdsFromGraphsResponse','error','\x20requests\x20to\x20composite\x20api.','commitId','24rSaOwF','../../../shared/utils','256813ZgzwwU','proceededComponentsMeta','1324525pXHogj','search','SalesforceComponentsManager','stringify','typedi'];a272_0xaa11=function(){return _0x27ba6d;};return a272_0xaa11();}class SalesforceCommitsManager{constructor(_0x518c7b){const _0x417ef0=a272_0x143bcf;this[_0x417ef0(0x123)]=_0x518c7b,this[_0x417ef0(0x156)]=0x3,this[_0x417ef0(0x128)]=new core_1[(_0x417ef0(0x15b))](SalesforceCommitsManager[_0x417ef0(0x153)]),this[_0x417ef0(0x11f)]=this['options'][_0x417ef0(0x128)],this['composite']=typedi_1['default'][_0x417ef0(0x15e)](salesforce_composite_service_1[_0x417ef0(0x126)]),this[_0x417ef0(0x147)]=[];}async[a272_0x143bcf(0x12d)](_0x4351ab,_0x387c48=![]){const _0x5a4fc8=a272_0x143bcf,_0x83945a=async _0x20f1a8=>{const _0x8e8213=a272_0x1f8e;await this[_0x8e8213(0x128)][_0x8e8213(0x12a)]('Sending\x20'+_0x20f1a8[_0x8e8213(0x12e)]((_0xcbbbdc,_0x369b05)=>_0xcbbbdc+_0x369b05[_0x8e8213(0x135)],0x0)+_0x8e8213(0x142));const _0x185e32=_0x20f1a8['map']((_0x1a797c,_0x2af32c)=>({'graphId':_0x8e8213(0x14e)+_0x2af32c,'compositeRequest':_0x1a797c})),_0x4a80b7=await this[_0x8e8213(0x119)]['executeGraphs'](_0x185e32);if(_0x387c48){const _0x298d14=(0x0,composite_utils_1[_0x8e8213(0x140)])(_0x4a80b7);for(const {id:_0x8c29d7,ref:_0x12bd45}of _0x298d14){const _0x3dbaa9=this['proceededComponentsMeta'][_0x8e8213(0x120)](_0x229f9b=>_0x229f9b[_0x8e8213(0x11b)]===_0x12bd45);_0x3dbaa9&&(_0x3dbaa9[_0x8e8213(0x157)]=_0x8c29d7);}}},_0x1167af=0x1e8480;let _0x1a25dd=0x0,_0x2695a9=[];for(const _0x1a88e9 of _0x4351ab){const _0x1ad6d7=_0x1a88e9[_0x5a4fc8(0x12e)]((_0x519a46,_0x5d4ca9)=>{const _0x16ed22=_0x5a4fc8,_0x4356d3=JSON[_0x16ed22(0x14b)](_0x5d4ca9)['length']*0x2;return _0x519a46+_0x4356d3;},0x0);if(_0x1ad6d7>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES'])throw new salesforce_error_1[(_0x5a4fc8(0x15f))](_0x5a4fc8(0x12f)+constants_1[_0x5a4fc8(0x136)]+_0x5a4fc8(0x151)+_0x1ad6d7);_0x1a25dd+_0x1ad6d7>constants_1[_0x5a4fc8(0x136)]-_0x1167af&&(await _0x83945a(_0x2695a9),_0x2695a9=[],_0x1a25dd=0x0),_0x1a25dd+=_0x1ad6d7,_0x2695a9[_0x5a4fc8(0x12b)](_0x1a88e9);}_0x2695a9[_0x5a4fc8(0x135)]&&await _0x83945a(_0x2695a9);}async[a272_0x143bcf(0x15d)](_0x1eadd5,_0xfe3151=![]){const _0xa06763=a272_0x143bcf,_0x16a580=(this[_0xa06763(0x156)]+ +_0xfe3151)*0x3,_0x4f76d1=(0x0,utils_1[_0xa06763(0x15c)])(_0x1eadd5,_0x16a580);try{while(_0x4f76d1['length']){const _0xbcdba=_0x4f76d1['splice'](0x0,Math[_0xa06763(0x127)](constants_1[_0xa06763(0x13b)]/_0x16a580));await this[_0xa06763(0x12d)](_0xbcdba,_0xfe3151);}}catch(_0x468534){this['logger'][_0xa06763(0x141)](_0x468534 instanceof salesforce_error_1[_0xa06763(0x15f)]?JSON[_0xa06763(0x14b)](_0x468534[_0xa06763(0x11e)](),null,0x2):_0x468534),this['sfLogger']['log'](_0x468534 instanceof salesforce_error_1[_0xa06763(0x15f)]?JSON['stringify'](_0x468534[_0xa06763(0x11e)](),null,0x2):_0x468534[_0xa06763(0x132)]());throw _0x468534;}}async['proceedCommitsToRepository'](_0x452ee7){const _0x2996c3=a272_0x143bcf;for(const _0x5d4636 of _0x452ee7){if(!_0x5d4636[_0x2996c3(0x160)][_0x2996c3(0x135)]&&!_0x5d4636[_0x2996c3(0x137)][_0x2996c3(0x135)]&&!_0x5d4636[_0x2996c3(0x130)][_0x2996c3(0x135)])continue;const _0x19ccf4=[],_0x39adc6=[],_0x3f80ca=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x2996c3(0x123)]['repositoryId'],this[_0x2996c3(0x123)]['branchId'],_0x5d4636['author'],this['options'][_0x2996c3(0x150)],this[_0x2996c3(0x147)]);_0x19ccf4[_0x2996c3(0x12b)](...await _0x3f80ca[_0x2996c3(0x11a)](_0x5d4636[_0x2996c3(0x160)],this[_0x2996c3(0x123)][_0x2996c3(0x143)])),_0x19ccf4[_0x2996c3(0x12b)](...await _0x3f80ca['update'](_0x5d4636[_0x2996c3(0x137)],this[_0x2996c3(0x123)]['commitId'])),_0x39adc6['push'](await _0x3f80ca[_0x2996c3(0x13a)](_0x5d4636[_0x2996c3(0x130)],!![])),this['proceededComponentsMeta']=_0x3f80ca[_0x2996c3(0x13c)](),await this['proceedRequests'](_0x19ccf4,!![]);for(const _0x34aabe of _0x39adc6){_0x34aabe['manifests'][_0x2996c3(0x135)]&&await this[_0x2996c3(0x15d)](_0x34aabe[_0x2996c3(0x129)],!![]),_0x34aabe['componentsToUpdate'][_0x2996c3(0x135)]&&await this['proceedRequests'](_0x34aabe[_0x2996c3(0x15a)],!![]),_0x34aabe[_0x2996c3(0x133)][_0x2996c3(0x135)]&&await this[_0x2996c3(0x15d)](_0x34aabe['componentsToDelete'],!![]);}this['logger'][_0x2996c3(0x12a)]('Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x19ccf4[_0x2996c3(0x135)]);}}async[a272_0x143bcf(0x13d)](_0x54e3b1){const _0xb49031=a272_0x143bcf,_0x38105b=[],_0x344f17=[];for(const _0x262001 of _0x54e3b1){if(!_0x262001[_0xb49031(0x160)][_0xb49031(0x135)]&&!_0x262001[_0xb49031(0x137)]['length']&&!_0x262001[_0xb49031(0x130)][_0xb49031(0x135)])continue;const _0x26f91c=new salesforce_components_manager_service_1[(_0xb49031(0x14a))](this[_0xb49031(0x123)][_0xb49031(0x13f)],this['options']['branchId'],_0x262001[_0xb49031(0x134)],this[_0xb49031(0x123)][_0xb49031(0x150)],[]);_0x38105b['push'](...await _0x26f91c[_0xb49031(0x11a)](_0x262001[_0xb49031(0x160)])),_0x38105b['push'](...await _0x26f91c[_0xb49031(0x139)](_0x262001[_0xb49031(0x137)])),_0x344f17[_0xb49031(0x12b)](await _0x26f91c[_0xb49031(0x13a)](_0x262001[_0xb49031(0x130)]));}this[_0xb49031(0x128)][_0xb49031(0x12a)](_0xb49031(0x154),_0x38105b[_0xb49031(0x135)]),await this[_0xb49031(0x15d)](_0x38105b);const _0xac66f4=_0x344f17[_0xb49031(0x12e)]((_0x1e1d15,_0x2620f7)=>({'manifests':[..._0x1e1d15['manifests'],..._0x2620f7[_0xb49031(0x129)]],'componentsToDelete':[..._0x1e1d15[_0xb49031(0x133)],..._0x2620f7[_0xb49031(0x133)]],'componentsToUpdate':[..._0x1e1d15['componentsToUpdate'],..._0x2620f7[_0xb49031(0x15a)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0xac66f4[_0xb49031(0x129)][_0xb49031(0x135)]&&await this[_0xb49031(0x15d)](_0xac66f4['manifests'],!![]),_0xac66f4[_0xb49031(0x15a)][_0xb49031(0x135)]&&await this[_0xb49031(0x15d)](_0xac66f4[_0xb49031(0x15a)],!![]),_0xac66f4[_0xb49031(0x133)][_0xb49031(0x135)]&&await this['proceedRequests'](_0xac66f4[_0xb49031(0x133)],!![]);}async['proceedCommits'](_0x327c88){const _0x28f6e7=a272_0x143bcf;this[_0x28f6e7(0x123)][_0x28f6e7(0x14d)]?await this[_0x28f6e7(0x13d)](_0x327c88):await this[_0x28f6e7(0x14f)](_0x327c88);}}exports[a272_0x143bcf(0x11d)]=SalesforceCommitsManager;