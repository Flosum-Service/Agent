const a271_0x4499be=a271_0x4013;(function(_0x243030,_0x4a2dd5){const _0x4fe5de=a271_0x4013,_0x1d61b1=_0x243030();while(!![]){try{const _0x59ebc2=parseInt(_0x4fe5de(0x188))/0x1+parseInt(_0x4fe5de(0x187))/0x2*(-parseInt(_0x4fe5de(0x18b))/0x3)+-parseInt(_0x4fe5de(0x168))/0x4+parseInt(_0x4fe5de(0x1b0))/0x5*(parseInt(_0x4fe5de(0x1ae))/0x6)+parseInt(_0x4fe5de(0x194))/0x7*(parseInt(_0x4fe5de(0x19a))/0x8)+-parseInt(_0x4fe5de(0x167))/0x9*(-parseInt(_0x4fe5de(0x191))/0xa)+parseInt(_0x4fe5de(0x17f))/0xb*(-parseInt(_0x4fe5de(0x18d))/0xc);if(_0x59ebc2===_0x4a2dd5)break;else _0x1d61b1['push'](_0x1d61b1['shift']());}catch(_0x35a672){_0x1d61b1['push'](_0x1d61b1['shift']());}}}(a271_0x479d,0xe3c49));const a271_0x28f89e=(function(){let _0x3ad97c=!![];return function(_0x2229bf,_0xc885de){const _0x9b4674=_0x3ad97c?function(){const _0x5f3426=a271_0x4013;if(_0xc885de){const _0xaab67c=_0xc885de[_0x5f3426(0x196)](_0x2229bf,arguments);return _0xc885de=null,_0xaab67c;}}:function(){};return _0x3ad97c=![],_0x9b4674;};}()),a271_0x285baf=a271_0x28f89e(this,function(){const _0x31ab5c=a271_0x4013;return a271_0x285baf[_0x31ab5c(0x19b)]()[_0x31ab5c(0x17a)]('(((.+)+)+)+$')[_0x31ab5c(0x19b)]()['constructor'](a271_0x285baf)['search']('(((.+)+)+)+$');});function a271_0x479d(){const _0xd197a9=['proceedCommitsToBranch','1667260GZHfiY','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','push','7343sfIcVJ','branchId','apply','./salesforce-components-manager.service','toJSON','proceedRequests','13704IsooWu','toString','proceedCommits','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','name','Sending\x20','default','../../../shared/utils','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','./salesforce-composite.service','update','log','proceededComponentsMeta','proceedChunksToUpload','typedi','\x20COMPONENTS_SIZE\x20=\x20','floor','reduce','SALESFORCE_MAX_REQUEST_SIZE_BYTES','modified','714jCeuqk','COMPONENTS_PER_CHUNK','53490hUCtjO','__importDefault','81bfrWby','2890752DobRLA','map','executeGraphs','author','options','../../../../core','find','SalesforceCommitsManager','SalesforceComponentsManager','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','logger','getProceededComponentsMeta','\x20requests\x20to\x20composite\x20api.','delete','SalesforceError','splice','recordTypes','removed','search','proceedCommitsToRepository','inserted','repositoryId','__esModule','843887xtjaft','componentsToUpdate','stringify','insert','length','extractComponentIdsFromGraphsResponse','manifests','Logger','6qtaWMB','51848yEVlcG','../utils/composite.utils','composite','281661iwHahC','../errors/salesforce.error','420npszdt','commitId','componentsToDelete'];a271_0x479d=function(){return _0xd197a9;};return a271_0x479d();}a271_0x285baf();'use strict';var __importDefault=this&&this[a271_0x4499be(0x166)]||function(_0x436dd2){const _0x1fc218=a271_0x4499be;return _0x436dd2&&_0x436dd2[_0x1fc218(0x17e)]?_0x436dd2:{'default':_0x436dd2};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a271_0x4499be(0x16f)]=void 0x0;const core_1=require(a271_0x4499be(0x16d)),typedi_1=__importDefault(require(a271_0x4499be(0x1a8))),constants_1=require('../../../../constants'),utils_1=require(a271_0x4499be(0x1a1)),salesforce_error_1=require(a271_0x4499be(0x18c)),composite_utils_1=require(a271_0x4499be(0x189)),salesforce_components_manager_service_1=require(a271_0x4499be(0x197)),salesforce_composite_service_1=require(a271_0x4499be(0x1a3));class SalesforceCommitsManager{constructor(_0x243572){const _0x3c6977=a271_0x4499be;this['options']=_0x243572,this[_0x3c6977(0x1af)]=0x3,this[_0x3c6977(0x172)]=new core_1[(_0x3c6977(0x186))](SalesforceCommitsManager[_0x3c6977(0x19e)]),this['sfLogger']=this[_0x3c6977(0x16c)][_0x3c6977(0x172)],this[_0x3c6977(0x18a)]=typedi_1[_0x3c6977(0x1a0)]['get'](salesforce_composite_service_1['SalesforceCompositeService']),this['proceededComponentsMeta']=[];}async[a271_0x4499be(0x1a7)](_0xb3a95c,_0x29e1b1=![]){const _0x3c5a77=a271_0x4499be,_0x5cccd5=async _0x2dea4b=>{const _0x3dd404=a271_0x4013;await this[_0x3dd404(0x172)][_0x3dd404(0x1a5)](_0x3dd404(0x19f)+_0x2dea4b[_0x3dd404(0x1ab)]((_0x5cab73,_0x3ca272)=>_0x5cab73+_0x3ca272['length'],0x0)+_0x3dd404(0x174));const _0x5caaee=_0x2dea4b[_0x3dd404(0x169)]((_0x19f818,_0xa6778f)=>({'graphId':'graph'+_0xa6778f,'compositeRequest':_0x19f818})),_0x5a94ca=await this[_0x3dd404(0x18a)][_0x3dd404(0x16a)](_0x5caaee);if(_0x29e1b1){const _0x5309f2=(0x0,composite_utils_1[_0x3dd404(0x184)])(_0x5a94ca);for(const {id:_0x2995f2,ref:_0xfe20e0}of _0x5309f2){const _0x3cf6d=this[_0x3dd404(0x1a6)][_0x3dd404(0x16e)](_0x152e28=>_0x152e28['reference']===_0xfe20e0);_0x3cf6d&&(_0x3cf6d['componentId']=_0x2995f2);}}},_0x1b5710=0x1e8480;let _0x5408d5=0x0,_0x2d8147=[];for(const _0x21970f of _0xb3a95c){const _0x59ee9b=_0x21970f[_0x3c5a77(0x1ab)]((_0x2a1e9c,_0x20df15)=>{const _0x32b043=_0x3c5a77,_0x1f7245=JSON[_0x32b043(0x181)](_0x20df15)[_0x32b043(0x183)]*0x2;return _0x2a1e9c+_0x1f7245;},0x0);if(_0x59ee9b>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES'])throw new salesforce_error_1[(_0x3c5a77(0x176))](_0x3c5a77(0x171)+constants_1[_0x3c5a77(0x1ac)]+_0x3c5a77(0x1a9)+_0x59ee9b);_0x5408d5+_0x59ee9b>constants_1[_0x3c5a77(0x1ac)]-_0x1b5710&&(await _0x5cccd5(_0x2d8147),_0x2d8147=[],_0x5408d5=0x0),_0x5408d5+=_0x59ee9b,_0x2d8147['push'](_0x21970f);}_0x2d8147['length']&&await _0x5cccd5(_0x2d8147);}async[a271_0x4499be(0x199)](_0x52d98f,_0x373abb=![]){const _0x193dfa=a271_0x4499be,_0x2518c2=(this['COMPONENTS_PER_CHUNK']+ +_0x373abb)*0x3,_0x40bf30=(0x0,utils_1['chunkArray'])(_0x52d98f,_0x2518c2);try{while(_0x40bf30[_0x193dfa(0x183)]){const _0x4488c5=_0x40bf30[_0x193dfa(0x177)](0x0,Math[_0x193dfa(0x1aa)](constants_1[_0x193dfa(0x192)]/_0x2518c2));await this[_0x193dfa(0x1a7)](_0x4488c5,_0x373abb);}}catch(_0x47cccf){this['logger']['error'](_0x47cccf instanceof salesforce_error_1[_0x193dfa(0x176)]?JSON[_0x193dfa(0x181)](_0x47cccf[_0x193dfa(0x198)](),null,0x2):_0x47cccf),this['sfLogger'][_0x193dfa(0x1a5)](_0x47cccf instanceof salesforce_error_1[_0x193dfa(0x176)]?JSON[_0x193dfa(0x181)](_0x47cccf['toJSON'](),null,0x2):_0x47cccf[_0x193dfa(0x19b)]());throw _0x47cccf;}}async[a271_0x4499be(0x17b)](_0x183d62){const _0x37f413=a271_0x4499be;for(const _0x241899 of _0x183d62){if(!_0x241899[_0x37f413(0x17c)][_0x37f413(0x183)]&&!_0x241899[_0x37f413(0x1ad)][_0x37f413(0x183)]&&!_0x241899[_0x37f413(0x179)][_0x37f413(0x183)])continue;const _0x249080=[],_0x477a74=[],_0x519db3=new salesforce_components_manager_service_1[(_0x37f413(0x170))](this['options']['repositoryId'],this[_0x37f413(0x16c)][_0x37f413(0x195)],_0x241899[_0x37f413(0x16b)],this[_0x37f413(0x16c)][_0x37f413(0x178)],this[_0x37f413(0x1a6)]);_0x249080[_0x37f413(0x193)](...await _0x519db3[_0x37f413(0x182)](_0x241899[_0x37f413(0x17c)],this['options'][_0x37f413(0x18e)])),_0x249080['push'](...await _0x519db3[_0x37f413(0x1a4)](_0x241899[_0x37f413(0x1ad)],this[_0x37f413(0x16c)]['commitId'])),_0x477a74['push'](await _0x519db3[_0x37f413(0x175)](_0x241899[_0x37f413(0x179)],!![])),this[_0x37f413(0x1a6)]=_0x519db3[_0x37f413(0x173)](),await this[_0x37f413(0x199)](_0x249080,!![]);for(const _0x51dca7 of _0x477a74){_0x51dca7[_0x37f413(0x185)][_0x37f413(0x183)]&&await this[_0x37f413(0x199)](_0x51dca7['manifests'],!![]),_0x51dca7[_0x37f413(0x180)]['length']&&await this[_0x37f413(0x199)](_0x51dca7[_0x37f413(0x180)],!![]),_0x51dca7[_0x37f413(0x18f)][_0x37f413(0x183)]&&await this[_0x37f413(0x199)](_0x51dca7[_0x37f413(0x18f)],!![]);}this[_0x37f413(0x172)]['log'](_0x37f413(0x1a2),_0x249080[_0x37f413(0x183)]);}}async[a271_0x4499be(0x190)](_0x4d59cc){const _0x16cbc6=a271_0x4499be,_0x5ec27f=[],_0x57d0f3=[];for(const _0x3b0228 of _0x4d59cc){if(!_0x3b0228[_0x16cbc6(0x17c)]['length']&&!_0x3b0228['modified']['length']&&!_0x3b0228[_0x16cbc6(0x179)][_0x16cbc6(0x183)])continue;const _0x361286=new salesforce_components_manager_service_1[(_0x16cbc6(0x170))](this['options'][_0x16cbc6(0x17d)],this[_0x16cbc6(0x16c)][_0x16cbc6(0x195)],_0x3b0228[_0x16cbc6(0x16b)],this[_0x16cbc6(0x16c)][_0x16cbc6(0x178)],[]);_0x5ec27f[_0x16cbc6(0x193)](...await _0x361286['insert'](_0x3b0228[_0x16cbc6(0x17c)])),_0x5ec27f['push'](...await _0x361286['update'](_0x3b0228['modified'])),_0x57d0f3['push'](await _0x361286[_0x16cbc6(0x175)](_0x3b0228['removed']));}this[_0x16cbc6(0x172)]['log'](_0x16cbc6(0x19d),_0x5ec27f[_0x16cbc6(0x183)]),await this['proceedRequests'](_0x5ec27f);const _0xf88801=_0x57d0f3[_0x16cbc6(0x1ab)]((_0x9606e3,_0x2452e5)=>({'manifests':[..._0x9606e3['manifests'],..._0x2452e5[_0x16cbc6(0x185)]],'componentsToDelete':[..._0x9606e3[_0x16cbc6(0x18f)],..._0x2452e5[_0x16cbc6(0x18f)]],'componentsToUpdate':[..._0x9606e3[_0x16cbc6(0x180)],..._0x2452e5[_0x16cbc6(0x180)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0xf88801['manifests'][_0x16cbc6(0x183)]&&await this[_0x16cbc6(0x199)](_0xf88801[_0x16cbc6(0x185)],!![]),_0xf88801[_0x16cbc6(0x180)][_0x16cbc6(0x183)]&&await this[_0x16cbc6(0x199)](_0xf88801['componentsToUpdate'],!![]),_0xf88801[_0x16cbc6(0x18f)][_0x16cbc6(0x183)]&&await this[_0x16cbc6(0x199)](_0xf88801[_0x16cbc6(0x18f)],!![]);}async[a271_0x4499be(0x19c)](_0x33ae83){const _0x2ecdbe=a271_0x4499be;this[_0x2ecdbe(0x16c)]['branchId']?await this['proceedCommitsToBranch'](_0x33ae83):await this['proceedCommitsToRepository'](_0x33ae83);}}function a271_0x4013(_0x163657,_0x385223){const _0x25f6b9=a271_0x479d();return a271_0x4013=function(_0x285baf,_0x28f89e){_0x285baf=_0x285baf-0x166;let _0x479d95=_0x25f6b9[_0x285baf];return _0x479d95;},a271_0x4013(_0x163657,_0x385223);}exports[a271_0x4499be(0x16f)]=SalesforceCommitsManager;