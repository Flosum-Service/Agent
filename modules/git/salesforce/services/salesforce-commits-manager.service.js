const a228_0x2d628b=a228_0x1c25;(function(_0x55e6a4,_0x5f59b7){const _0x302305=a228_0x1c25,_0x4cfc88=_0x55e6a4();while(!![]){try{const _0x3ad109=parseInt(_0x302305(0xdf))/0x1*(parseInt(_0x302305(0xed))/0x2)+-parseInt(_0x302305(0xfa))/0x3*(-parseInt(_0x302305(0xbe))/0x4)+-parseInt(_0x302305(0xc1))/0x5*(-parseInt(_0x302305(0xec))/0x6)+-parseInt(_0x302305(0xf8))/0x7*(parseInt(_0x302305(0xc5))/0x8)+-parseInt(_0x302305(0x101))/0x9+parseInt(_0x302305(0x100))/0xa+-parseInt(_0x302305(0xd8))/0xb*(parseInt(_0x302305(0xe0))/0xc);if(_0x3ad109===_0x5f59b7)break;else _0x4cfc88['push'](_0x4cfc88['shift']());}catch(_0x5f07c9){_0x4cfc88['push'](_0x4cfc88['shift']());}}}(a228_0x5809,0x88631));const a228_0x2e1a84=(function(){let _0x1534e2=!![];return function(_0x35e21b,_0x4c762){const _0x18f483=_0x1534e2?function(){const _0x3280e0=a228_0x1c25;if(_0x4c762){const _0x12baba=_0x4c762[_0x3280e0(0xbf)](_0x35e21b,arguments);return _0x4c762=null,_0x12baba;}}:function(){};return _0x1534e2=![],_0x18f483;};}()),a228_0x25163e=a228_0x2e1a84(this,function(){const _0xb867f4=a228_0x1c25;return a228_0x25163e[_0xb867f4(0xd2)]()['search'](_0xb867f4(0xfd))[_0xb867f4(0xd2)]()[_0xb867f4(0xfc)](a228_0x25163e)['search'](_0xb867f4(0xfd));});a228_0x25163e();'use strict';var __importDefault=this&&this[a228_0x2d628b(0xc3)]||function(_0x4b04df){return _0x4b04df&&_0x4b04df['__esModule']?_0x4b04df:{'default':_0x4b04df};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a228_0x2d628b(0xcb)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require('typedi')),constants_1=require(a228_0x2d628b(0xeb)),utils_1=require(a228_0x2d628b(0xe5)),salesforce_error_1=require(a228_0x2d628b(0xe8)),composite_utils_1=require(a228_0x2d628b(0xfe)),salesforce_components_manager_service_1=require(a228_0x2d628b(0xc2)),salesforce_composite_service_1=require(a228_0x2d628b(0xe2));function a228_0x1c25(_0x5a4c4b,_0x580b35){const _0x4d93ef=a228_0x5809();return a228_0x1c25=function(_0x25163e,_0x2e1a84){_0x25163e=_0x25163e-0xb8;let _0x580922=_0x4d93ef[_0x25163e];return _0x580922;},a228_0x1c25(_0x5a4c4b,_0x580b35);}function a228_0x5809(){const _0x17d26e=['name','sfLogger','inserted','\x20COMPONENTS_SIZE\x20=\x20','length','proceedChunksToUpload','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','logger','floor','modified','1736819PUCALK','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','1179768XEwpag','Logger','constructor','(((.+)+)+)+$','../utils/composite.utils','COMPONENTS_PER_CHUNK','7828220jHkoFh','1807407bUKElU','push','reference','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','default','stringify','update','componentId','insert','recordTypes','8BGSeiG','apply','map','45mIjIoo','./salesforce-components-manager.service','__importDefault','get','16pDnSZS','proceedCommits','delete','componentsToUpdate','SalesforceError','SALESFORCE_MAX_REQUEST_SIZE_BYTES','SalesforceCommitsManager','commitId','componentsToDelete','composite','proceedCommitsToRepository','removed','manifests','toString','reduce','repositoryId','proceededComponentsMeta','find','error','627hDImQA','log','proceedCommitsToBranch','SalesforceComponentsManager','graph','toJSON','splice','123098qmPVTR','318984DHDryH','author','./salesforce-composite.service','chunkArray','getProceededComponentsMeta','../../../shared/utils','options','proceedRequests','../errors/salesforce.error','branchId','SalesforceCompositeService','../../../../constants','472764qKXuIP','8zTTlgy'];a228_0x5809=function(){return _0x17d26e;};return a228_0x5809();}class SalesforceCommitsManager{constructor(_0x40df4e){const _0x277a87=a228_0x2d628b;this['options']=_0x40df4e,this['COMPONENTS_PER_CHUNK']=0x3,this[_0x277a87(0xf5)]=new core_1[(_0x277a87(0xfb))](SalesforceCommitsManager[_0x277a87(0xee)]),this[_0x277a87(0xef)]=this[_0x277a87(0xe6)][_0x277a87(0xf5)],this[_0x277a87(0xce)]=typedi_1[_0x277a87(0xb8)][_0x277a87(0xc4)](salesforce_composite_service_1[_0x277a87(0xea)]),this[_0x277a87(0xd5)]=[];}async[a228_0x2d628b(0xf3)](_0x462ebc,_0x436314=![]){const _0x360122=a228_0x2d628b,_0x344a38=async _0x12f329=>{const _0x490db0=a228_0x1c25;await this[_0x490db0(0xf5)][_0x490db0(0xd9)]('Sending\x20'+_0x12f329[_0x490db0(0xd3)]((_0xbb8d3,_0x5409c0)=>_0xbb8d3+_0x5409c0['length'],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x58505d=_0x12f329[_0x490db0(0xc0)]((_0x3b437f,_0x5a5b45)=>({'graphId':_0x490db0(0xdc)+_0x5a5b45,'compositeRequest':_0x3b437f})),_0x3a2630=await this[_0x490db0(0xce)]['executeGraphs'](_0x58505d);if(_0x436314){const _0x2d482e=(0x0,composite_utils_1['extractComponentIdsFromGraphsResponse'])(_0x3a2630);for(const {id:_0x2d2146,ref:_0x3c93df}of _0x2d482e){const _0x2cacd4=this[_0x490db0(0xd5)][_0x490db0(0xd6)](_0x113f6f=>_0x113f6f[_0x490db0(0x103)]===_0x3c93df);_0x2cacd4&&(_0x2cacd4[_0x490db0(0xbb)]=_0x2d2146);}}},_0x59e50b=0x1e8480;let _0x502bcf=0x0,_0x4d1873=[];for(const _0x530fda of _0x462ebc){const _0x341c68=_0x530fda[_0x360122(0xd3)]((_0x14b837,_0xd05c7c)=>{const _0x588ad3=_0x360122,_0x1ad706=JSON[_0x588ad3(0xb9)](_0xd05c7c)['length']*0x2;return _0x14b837+_0x1ad706;},0x0);if(_0x341c68>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES'])throw new salesforce_error_1[(_0x360122(0xc9))](_0x360122(0x104)+constants_1[_0x360122(0xca)]+_0x360122(0xf1)+_0x341c68);_0x502bcf+_0x341c68>constants_1[_0x360122(0xca)]-_0x59e50b&&(await _0x344a38(_0x4d1873),_0x4d1873=[],_0x502bcf=0x0),_0x502bcf+=_0x341c68,_0x4d1873[_0x360122(0x102)](_0x530fda);}_0x4d1873[_0x360122(0xf2)]&&await _0x344a38(_0x4d1873);}async[a228_0x2d628b(0xe7)](_0x2f0cc8,_0x288213=![]){const _0x12a375=a228_0x2d628b,_0x2ac356=(this[_0x12a375(0xff)]+ +_0x288213)*0x3,_0x12a9fb=(0x0,utils_1[_0x12a375(0xe3)])(_0x2f0cc8,_0x2ac356);try{while(_0x12a9fb[_0x12a375(0xf2)]){const _0x4bde62=_0x12a9fb[_0x12a375(0xde)](0x0,Math[_0x12a375(0xf6)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x2ac356));await this[_0x12a375(0xf3)](_0x4bde62,_0x288213);}}catch(_0x523691){this['logger'][_0x12a375(0xd7)](_0x523691 instanceof salesforce_error_1[_0x12a375(0xc9)]?JSON[_0x12a375(0xb9)](_0x523691[_0x12a375(0xdd)](),null,0x2):_0x523691),this[_0x12a375(0xef)][_0x12a375(0xd9)](_0x523691 instanceof salesforce_error_1[_0x12a375(0xc9)]?JSON[_0x12a375(0xb9)](_0x523691[_0x12a375(0xdd)](),null,0x2):_0x523691[_0x12a375(0xd2)]());throw _0x523691;}}async[a228_0x2d628b(0xcf)](_0x456a03){const _0x1f1e7b=a228_0x2d628b;for(const _0x53f77e of _0x456a03){if(!_0x53f77e[_0x1f1e7b(0xf0)]['length']&&!_0x53f77e[_0x1f1e7b(0xf7)][_0x1f1e7b(0xf2)]&&!_0x53f77e[_0x1f1e7b(0xd0)][_0x1f1e7b(0xf2)])continue;const _0x26647c=[],_0x37185d=[],_0xfaf97a=new salesforce_components_manager_service_1[(_0x1f1e7b(0xdb))](this[_0x1f1e7b(0xe6)][_0x1f1e7b(0xd4)],this[_0x1f1e7b(0xe6)][_0x1f1e7b(0xe9)],_0x53f77e[_0x1f1e7b(0xe1)],this[_0x1f1e7b(0xe6)][_0x1f1e7b(0xbd)],this[_0x1f1e7b(0xd5)]);_0x26647c[_0x1f1e7b(0x102)](...await _0xfaf97a[_0x1f1e7b(0xbc)](_0x53f77e[_0x1f1e7b(0xf0)],this[_0x1f1e7b(0xe6)][_0x1f1e7b(0xcc)])),_0x26647c[_0x1f1e7b(0x102)](...await _0xfaf97a[_0x1f1e7b(0xba)](_0x53f77e['modified'],this['options'][_0x1f1e7b(0xcc)])),_0x37185d[_0x1f1e7b(0x102)](await _0xfaf97a['delete'](_0x53f77e[_0x1f1e7b(0xd0)],!![])),this[_0x1f1e7b(0xd5)]=_0xfaf97a[_0x1f1e7b(0xe4)](),await this[_0x1f1e7b(0xe7)](_0x26647c,!![]);for(const _0xa9834 of _0x37185d){_0xa9834[_0x1f1e7b(0xd1)][_0x1f1e7b(0xf2)]&&await this[_0x1f1e7b(0xe7)](_0xa9834[_0x1f1e7b(0xd1)],!![]),_0xa9834['componentsToUpdate'][_0x1f1e7b(0xf2)]&&await this[_0x1f1e7b(0xe7)](_0xa9834[_0x1f1e7b(0xc8)],!![]),_0xa9834[_0x1f1e7b(0xcd)][_0x1f1e7b(0xf2)]&&await this[_0x1f1e7b(0xe7)](_0xa9834[_0x1f1e7b(0xcd)],!![]);}this['logger'][_0x1f1e7b(0xd9)](_0x1f1e7b(0xf9),_0x26647c['length']);}}async['proceedCommitsToBranch'](_0x13f308){const _0x49ad29=a228_0x2d628b,_0x2369bc=[],_0x2dfc87=[];for(const _0x9af91f of _0x13f308){if(!_0x9af91f['inserted'][_0x49ad29(0xf2)]&&!_0x9af91f[_0x49ad29(0xf7)]['length']&&!_0x9af91f[_0x49ad29(0xd0)]['length'])continue;const _0x3edfa2=new salesforce_components_manager_service_1[(_0x49ad29(0xdb))](this['options'][_0x49ad29(0xd4)],this[_0x49ad29(0xe6)][_0x49ad29(0xe9)],_0x9af91f[_0x49ad29(0xe1)],this['options']['recordTypes'],[]);_0x2369bc['push'](...await _0x3edfa2[_0x49ad29(0xbc)](_0x9af91f[_0x49ad29(0xf0)])),_0x2369bc['push'](...await _0x3edfa2[_0x49ad29(0xba)](_0x9af91f[_0x49ad29(0xf7)])),_0x2dfc87['push'](await _0x3edfa2[_0x49ad29(0xc7)](_0x9af91f[_0x49ad29(0xd0)]));}this[_0x49ad29(0xf5)][_0x49ad29(0xd9)](_0x49ad29(0xf4),_0x2369bc[_0x49ad29(0xf2)]),await this[_0x49ad29(0xe7)](_0x2369bc);const _0x434a10=_0x2dfc87[_0x49ad29(0xd3)]((_0x1f9eff,_0x5e3a67)=>({'manifests':[..._0x1f9eff['manifests'],..._0x5e3a67['manifests']],'componentsToDelete':[..._0x1f9eff[_0x49ad29(0xcd)],..._0x5e3a67[_0x49ad29(0xcd)]],'componentsToUpdate':[..._0x1f9eff[_0x49ad29(0xc8)],..._0x5e3a67[_0x49ad29(0xc8)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x434a10['manifests']['length']&&await this['proceedRequests'](_0x434a10[_0x49ad29(0xd1)],!![]),_0x434a10[_0x49ad29(0xc8)][_0x49ad29(0xf2)]&&await this['proceedRequests'](_0x434a10[_0x49ad29(0xc8)],!![]),_0x434a10[_0x49ad29(0xcd)][_0x49ad29(0xf2)]&&await this[_0x49ad29(0xe7)](_0x434a10[_0x49ad29(0xcd)],!![]);}async[a228_0x2d628b(0xc6)](_0x831a7){const _0x10927b=a228_0x2d628b;this[_0x10927b(0xe6)][_0x10927b(0xe9)]?await this[_0x10927b(0xda)](_0x831a7):await this[_0x10927b(0xcf)](_0x831a7);}}exports['SalesforceCommitsManager']=SalesforceCommitsManager;