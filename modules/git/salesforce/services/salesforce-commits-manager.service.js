const a228_0x2f85ba=a228_0x62f4;function a228_0x62f4(_0x49518c,_0x1938fa){const _0x43b200=a228_0x4c31();return a228_0x62f4=function(_0x5832ff,_0x54bb90){_0x5832ff=_0x5832ff-0x114;let _0x4c314b=_0x43b200[_0x5832ff];return _0x4c314b;},a228_0x62f4(_0x49518c,_0x1938fa);}(function(_0x2957bd,_0x541b85){const _0x36312c=a228_0x62f4,_0x5d5c07=_0x2957bd();while(!![]){try{const _0x329ffe=parseInt(_0x36312c(0x145))/0x1*(-parseInt(_0x36312c(0x11a))/0x2)+-parseInt(_0x36312c(0x11c))/0x3+-parseInt(_0x36312c(0x149))/0x4*(parseInt(_0x36312c(0x146))/0x5)+-parseInt(_0x36312c(0x128))/0x6*(-parseInt(_0x36312c(0x15a))/0x7)+parseInt(_0x36312c(0x14b))/0x8*(parseInt(_0x36312c(0x148))/0x9)+-parseInt(_0x36312c(0x15c))/0xa+parseInt(_0x36312c(0x13a))/0xb*(parseInt(_0x36312c(0x133))/0xc);if(_0x329ffe===_0x541b85)break;else _0x5d5c07['push'](_0x5d5c07['shift']());}catch(_0x43d95e){_0x5d5c07['push'](_0x5d5c07['shift']());}}}(a228_0x4c31,0x2d371));const a228_0x54bb90=(function(){let _0x3affa1=!![];return function(_0x1afb02,_0x4c966a){const _0x1894d4=_0x3affa1?function(){if(_0x4c966a){const _0x2b1ac4=_0x4c966a['apply'](_0x1afb02,arguments);return _0x4c966a=null,_0x2b1ac4;}}:function(){};return _0x3affa1=![],_0x1894d4;};}()),a228_0x5832ff=a228_0x54bb90(this,function(){const _0x2b5f6a=a228_0x62f4;return a228_0x5832ff['toString']()['search']('(((.+)+)+)+$')[_0x2b5f6a(0x118)]()[_0x2b5f6a(0x134)](a228_0x5832ff)['search']('(((.+)+)+)+$');});function a228_0x4c31(){const _0x2ac72f=['41148IBIZxp','constructor','inserted','componentsToDelete','manifests','push','error','1342XlSMZH','chunkArray','stringify','\x20COMPONENTS_SIZE\x20=\x20','Sending\x20','proceedCommitsToBranch','sfLogger','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','recordTypes','log','SalesforceCommitsManager','18617eIMhnH','5LhWRev','branchId','9HQAgCh','1178448wyJdZr','proceedCommitsToRepository','606552URWJOE','length','update','repositoryId','componentsToUpdate','../utils/composite.utils','__importDefault','splice','delete','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','Logger','options','__esModule','../../../../core','executeGraphs','7RrYBaC','../../../shared/utils','2721550fMYZJH','proceedRequests','map','modified','removed','toString','commitId','2vXnOOH','typedi','91749cstKon','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','name','reduce','insert','toJSON','proceedChunksToUpload','getProceededComponentsMeta','../../../../constants','COMPONENTS_PER_CHUNK','SALESFORCE_MAX_REQUEST_SIZE_BYTES','logger','1842066kmtlFi','author','SalesforceComponentsManager','graph','proceededComponentsMeta','../errors/salesforce.error','get','composite','./salesforce-components-manager.service','find','SalesforceError'];a228_0x4c31=function(){return _0x2ac72f;};return a228_0x4c31();}a228_0x5832ff();'use strict';var __importDefault=this&&this[a228_0x2f85ba(0x151)]||function(_0x43a2d8){const _0x474844=a228_0x2f85ba;return _0x43a2d8&&_0x43a2d8[_0x474844(0x157)]?_0x43a2d8:{'default':_0x43a2d8};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['SalesforceCommitsManager']=void 0x0;const core_1=require(a228_0x2f85ba(0x158)),typedi_1=__importDefault(require(a228_0x2f85ba(0x11b))),constants_1=require(a228_0x2f85ba(0x124)),utils_1=require(a228_0x2f85ba(0x15b)),salesforce_error_1=require(a228_0x2f85ba(0x12d)),composite_utils_1=require(a228_0x2f85ba(0x150)),salesforce_components_manager_service_1=require(a228_0x2f85ba(0x130)),salesforce_composite_service_1=require('./salesforce-composite.service');class SalesforceCommitsManager{constructor(_0xc75adf){const _0x54f838=a228_0x2f85ba;this[_0x54f838(0x156)]=_0xc75adf,this[_0x54f838(0x125)]=0x3,this['logger']=new core_1[(_0x54f838(0x155))](SalesforceCommitsManager[_0x54f838(0x11e)]),this[_0x54f838(0x140)]=this[_0x54f838(0x156)][_0x54f838(0x127)],this[_0x54f838(0x12f)]=typedi_1['default'][_0x54f838(0x12e)](salesforce_composite_service_1['SalesforceCompositeService']),this[_0x54f838(0x12c)]=[];}async[a228_0x2f85ba(0x122)](_0x541120,_0x1e9c87=![]){const _0x484ed1=a228_0x2f85ba,_0x1c3f7e=async _0x35fb66=>{const _0x2eadf4=a228_0x62f4;await this['logger']['log'](_0x2eadf4(0x13e)+_0x35fb66[_0x2eadf4(0x11f)]((_0x2c3990,_0x11273e)=>_0x2c3990+_0x11273e[_0x2eadf4(0x14c)],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x4dcb4f=_0x35fb66[_0x2eadf4(0x115)]((_0x7a0d0,_0x325681)=>({'graphId':_0x2eadf4(0x12b)+_0x325681,'compositeRequest':_0x7a0d0})),_0x2f827c=await this[_0x2eadf4(0x12f)][_0x2eadf4(0x159)](_0x4dcb4f);if(_0x1e9c87){const _0x90df80=(0x0,composite_utils_1['extractComponentIdsFromGraphsResponse'])(_0x2f827c);for(const {id:_0x32bdb5,ref:_0x1fa3b5}of _0x90df80){const _0x2af4be=this['proceededComponentsMeta'][_0x2eadf4(0x131)](_0x212d90=>_0x212d90['reference']===_0x1fa3b5);_0x2af4be&&(_0x2af4be['componentId']=_0x32bdb5);}}},_0x1bc354=0x1e8480;let _0x5f252c=0x0,_0x563909=[];for(const _0x352300 of _0x541120){const _0x354b72=_0x352300[_0x484ed1(0x11f)]((_0x49176a,_0x40ba66)=>{const _0x2a4dbe=_0x484ed1,_0x306ea3=JSON['stringify'](_0x40ba66)[_0x2a4dbe(0x14c)]*0x2;return _0x49176a+_0x306ea3;},0x0);if(_0x354b72>constants_1[_0x484ed1(0x126)])throw new salesforce_error_1[(_0x484ed1(0x132))](_0x484ed1(0x141)+constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']+_0x484ed1(0x13d)+_0x354b72);_0x5f252c+_0x354b72>constants_1[_0x484ed1(0x126)]-_0x1bc354&&(await _0x1c3f7e(_0x563909),_0x563909=[],_0x5f252c=0x0),_0x5f252c+=_0x354b72,_0x563909[_0x484ed1(0x138)](_0x352300);}_0x563909[_0x484ed1(0x14c)]&&await _0x1c3f7e(_0x563909);}async[a228_0x2f85ba(0x114)](_0x2a8b08,_0x588dbd=![]){const _0xbbf717=a228_0x2f85ba,_0x2395c8=(this[_0xbbf717(0x125)]+ +_0x588dbd)*0x3,_0x21cf68=(0x0,utils_1[_0xbbf717(0x13b)])(_0x2a8b08,_0x2395c8);try{while(_0x21cf68[_0xbbf717(0x14c)]){const _0x491984=_0x21cf68[_0xbbf717(0x152)](0x0,Math['floor'](constants_1[_0xbbf717(0x11d)]/_0x2395c8));await this['proceedChunksToUpload'](_0x491984,_0x588dbd);}}catch(_0x51d8ea){this[_0xbbf717(0x127)][_0xbbf717(0x139)](_0x51d8ea instanceof salesforce_error_1['SalesforceError']?JSON['stringify'](_0x51d8ea['toJSON'](),null,0x2):_0x51d8ea),this[_0xbbf717(0x140)][_0xbbf717(0x143)](_0x51d8ea instanceof salesforce_error_1['SalesforceError']?JSON[_0xbbf717(0x13c)](_0x51d8ea[_0xbbf717(0x121)](),null,0x2):_0x51d8ea[_0xbbf717(0x118)]());throw _0x51d8ea;}}async[a228_0x2f85ba(0x14a)](_0x56b94a){const _0x3ad11c=a228_0x2f85ba;for(const _0x14f839 of _0x56b94a){if(!_0x14f839[_0x3ad11c(0x135)]['length']&&!_0x14f839['modified'][_0x3ad11c(0x14c)]&&!_0x14f839[_0x3ad11c(0x117)][_0x3ad11c(0x14c)])continue;const _0x3519c1=[],_0x21d7b5=[],_0x2d6d90=new salesforce_components_manager_service_1[(_0x3ad11c(0x12a))](this[_0x3ad11c(0x156)]['repositoryId'],this[_0x3ad11c(0x156)][_0x3ad11c(0x147)],_0x14f839[_0x3ad11c(0x129)],this[_0x3ad11c(0x156)][_0x3ad11c(0x142)],this['proceededComponentsMeta']);_0x3519c1[_0x3ad11c(0x138)](...await _0x2d6d90[_0x3ad11c(0x120)](_0x14f839[_0x3ad11c(0x135)],this[_0x3ad11c(0x156)][_0x3ad11c(0x119)])),_0x3519c1[_0x3ad11c(0x138)](...await _0x2d6d90['update'](_0x14f839['modified'],this[_0x3ad11c(0x156)][_0x3ad11c(0x119)])),_0x21d7b5['push'](await _0x2d6d90[_0x3ad11c(0x153)](_0x14f839[_0x3ad11c(0x117)],!![])),this[_0x3ad11c(0x12c)]=_0x2d6d90[_0x3ad11c(0x123)](),await this[_0x3ad11c(0x114)](_0x3519c1,!![]);for(const _0x4a0ea1 of _0x21d7b5){_0x4a0ea1['manifests'][_0x3ad11c(0x14c)]&&await this[_0x3ad11c(0x114)](_0x4a0ea1['manifests'],!![]),_0x4a0ea1[_0x3ad11c(0x14f)][_0x3ad11c(0x14c)]&&await this[_0x3ad11c(0x114)](_0x4a0ea1['componentsToUpdate'],!![]),_0x4a0ea1[_0x3ad11c(0x136)][_0x3ad11c(0x14c)]&&await this[_0x3ad11c(0x114)](_0x4a0ea1[_0x3ad11c(0x136)],!![]);}this['logger'][_0x3ad11c(0x143)](_0x3ad11c(0x154),_0x3519c1[_0x3ad11c(0x14c)]);}}async[a228_0x2f85ba(0x13f)](_0x2837a8){const _0x40d9a8=a228_0x2f85ba,_0x4c7370=[],_0x5c1d49=[];for(const _0xee7f64 of _0x2837a8){if(!_0xee7f64[_0x40d9a8(0x135)][_0x40d9a8(0x14c)]&&!_0xee7f64[_0x40d9a8(0x116)][_0x40d9a8(0x14c)]&&!_0xee7f64[_0x40d9a8(0x117)][_0x40d9a8(0x14c)])continue;const _0x2b71fb=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x40d9a8(0x156)][_0x40d9a8(0x14e)],this[_0x40d9a8(0x156)][_0x40d9a8(0x147)],_0xee7f64['author'],this[_0x40d9a8(0x156)]['recordTypes'],[]);_0x4c7370[_0x40d9a8(0x138)](...await _0x2b71fb[_0x40d9a8(0x120)](_0xee7f64['inserted'])),_0x4c7370[_0x40d9a8(0x138)](...await _0x2b71fb[_0x40d9a8(0x14d)](_0xee7f64[_0x40d9a8(0x116)])),_0x5c1d49[_0x40d9a8(0x138)](await _0x2b71fb[_0x40d9a8(0x153)](_0xee7f64[_0x40d9a8(0x117)]));}this[_0x40d9a8(0x127)][_0x40d9a8(0x143)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)',_0x4c7370['length']),await this[_0x40d9a8(0x114)](_0x4c7370);const _0x5e0187=_0x5c1d49[_0x40d9a8(0x11f)]((_0x3a1b93,_0x5eefa2)=>({'manifests':[..._0x3a1b93[_0x40d9a8(0x137)],..._0x5eefa2[_0x40d9a8(0x137)]],'componentsToDelete':[..._0x3a1b93[_0x40d9a8(0x136)],..._0x5eefa2['componentsToDelete']],'componentsToUpdate':[..._0x3a1b93[_0x40d9a8(0x14f)],..._0x5eefa2[_0x40d9a8(0x14f)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x5e0187['manifests'][_0x40d9a8(0x14c)]&&await this[_0x40d9a8(0x114)](_0x5e0187[_0x40d9a8(0x137)],!![]),_0x5e0187[_0x40d9a8(0x14f)]['length']&&await this[_0x40d9a8(0x114)](_0x5e0187[_0x40d9a8(0x14f)],!![]),_0x5e0187[_0x40d9a8(0x136)][_0x40d9a8(0x14c)]&&await this[_0x40d9a8(0x114)](_0x5e0187[_0x40d9a8(0x136)],!![]);}async['proceedCommits'](_0x1c13ad){const _0x5b233e=a228_0x2f85ba;this['options'][_0x5b233e(0x147)]?await this[_0x5b233e(0x13f)](_0x1c13ad):await this[_0x5b233e(0x14a)](_0x1c13ad);}}exports[a228_0x2f85ba(0x144)]=SalesforceCommitsManager;