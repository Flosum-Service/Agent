const a270_0xebe282=a270_0x3f7c;(function(_0x1b4842,_0xae62be){const _0x4d518b=a270_0x3f7c,_0x2a8fb7=_0x1b4842();while(!![]){try{const _0x925a1f=-parseInt(_0x4d518b(0xe9))/0x1*(-parseInt(_0x4d518b(0xfe))/0x2)+parseInt(_0x4d518b(0x10f))/0x3*(-parseInt(_0x4d518b(0xe4))/0x4)+parseInt(_0x4d518b(0xce))/0x5*(-parseInt(_0x4d518b(0xec))/0x6)+-parseInt(_0x4d518b(0x113))/0x7*(-parseInt(_0x4d518b(0xd7))/0x8)+-parseInt(_0x4d518b(0x111))/0x9+parseInt(_0x4d518b(0xf5))/0xa+-parseInt(_0x4d518b(0xd2))/0xb*(-parseInt(_0x4d518b(0xd3))/0xc);if(_0x925a1f===_0xae62be)break;else _0x2a8fb7['push'](_0x2a8fb7['shift']());}catch(_0x4a292b){_0x2a8fb7['push'](_0x2a8fb7['shift']());}}}(a270_0x4275,0x9693b));const a270_0x159629=(function(){let _0x1548c2=!![];return function(_0x1f6406,_0x19024f){const _0x8f47d9=_0x1548c2?function(){const _0x4ac6b9=a270_0x3f7c;if(_0x19024f){const _0x3a50f5=_0x19024f[_0x4ac6b9(0xe1)](_0x1f6406,arguments);return _0x19024f=null,_0x3a50f5;}}:function(){};return _0x1548c2=![],_0x8f47d9;};}()),a270_0x1c58b2=a270_0x159629(this,function(){const _0x1b01ea=a270_0x3f7c;return a270_0x1c58b2['toString']()[_0x1b01ea(0x10e)]('(((.+)+)+)+$')[_0x1b01ea(0xcb)]()[_0x1b01ea(0xf7)](a270_0x1c58b2)[_0x1b01ea(0x10e)](_0x1b01ea(0xe7));});a270_0x1c58b2();'use strict';var __importDefault=this&&this[a270_0xebe282(0x104)]||function(_0x14d3af){const _0xa851a6=a270_0xebe282;return _0x14d3af&&_0x14d3af[_0xa851a6(0xd8)]?_0x14d3af:{'default':_0x14d3af};};Object[a270_0xebe282(0xe6)](exports,a270_0xebe282(0xd8),{'value':!![]}),exports['SalesforceCommitsManager']=void 0x0;const core_1=require(a270_0xebe282(0xe8)),typedi_1=__importDefault(require(a270_0xebe282(0xfc))),constants_1=require(a270_0xebe282(0xca)),utils_1=require('../../../shared/utils'),salesforce_error_1=require(a270_0xebe282(0xdd)),composite_utils_1=require(a270_0xebe282(0xdb)),salesforce_components_manager_service_1=require(a270_0xebe282(0x108)),salesforce_composite_service_1=require('./salesforce-composite.service');class SalesforceCommitsManager{constructor(_0x5e957c){const _0x39abbb=a270_0xebe282;this[_0x39abbb(0xc9)]=_0x5e957c,this[_0x39abbb(0xe3)]=0x3,this[_0x39abbb(0x10a)]=new core_1[(_0x39abbb(0x10b))](SalesforceCommitsManager[_0x39abbb(0xdc)]),this[_0x39abbb(0xf2)]=this[_0x39abbb(0xc9)][_0x39abbb(0x10a)],this[_0x39abbb(0x102)]=typedi_1[_0x39abbb(0xf8)]['get'](salesforce_composite_service_1[_0x39abbb(0xe2)]),this[_0x39abbb(0xeb)]=[];}async[a270_0xebe282(0x105)](_0x4458a1,_0x2c3315=![]){const _0x424884=a270_0xebe282,_0x346c43=async _0x17095e=>{const _0x163374=a270_0x3f7c;await this['logger']['log'](_0x163374(0xfb)+_0x17095e[_0x163374(0x114)]((_0x31ecf0,_0x244c88)=>_0x31ecf0+_0x244c88[_0x163374(0xf4)],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x339e5e=_0x17095e['map']((_0x37c6c6,_0x5c0fd3)=>({'graphId':_0x163374(0xee)+_0x5c0fd3,'compositeRequest':_0x37c6c6})),_0x612ba5=await this[_0x163374(0x102)][_0x163374(0x10c)](_0x339e5e);if(_0x2c3315){const _0x33d230=(0x0,composite_utils_1[_0x163374(0xd5)])(_0x612ba5);for(const {id:_0x362e5d,ref:_0x44d5dc}of _0x33d230){const _0x23d7de=this[_0x163374(0xeb)][_0x163374(0x112)](_0x4285f3=>_0x4285f3['reference']===_0x44d5dc);_0x23d7de&&(_0x23d7de[_0x163374(0xda)]=_0x362e5d);}}},_0x1e1717=0x1e8480;let _0x5009a4=0x0,_0x2f13fd=[];for(const _0x7e4c27 of _0x4458a1){const _0x15e25f=_0x7e4c27[_0x424884(0x114)]((_0x1bafb7,_0x3f4f5f)=>{const _0x518a5d=_0x424884,_0x1d067c=JSON[_0x518a5d(0xdf)](_0x3f4f5f)[_0x518a5d(0xf4)]*0x2;return _0x1bafb7+_0x1d067c;},0x0);if(_0x15e25f>constants_1[_0x424884(0xc8)])throw new salesforce_error_1['SalesforceError'](_0x424884(0xd1)+constants_1[_0x424884(0xc8)]+_0x424884(0xf9)+_0x15e25f);_0x5009a4+_0x15e25f>constants_1[_0x424884(0xc8)]-_0x1e1717&&(await _0x346c43(_0x2f13fd),_0x2f13fd=[],_0x5009a4=0x0),_0x5009a4+=_0x15e25f,_0x2f13fd[_0x424884(0xc7)](_0x7e4c27);}_0x2f13fd[_0x424884(0xf4)]&&await _0x346c43(_0x2f13fd);}async[a270_0xebe282(0xd9)](_0x605e65,_0x3d15f0=![]){const _0x22ac3a=a270_0xebe282,_0x42be68=(this[_0x22ac3a(0xe3)]+ +_0x3d15f0)*0x3,_0x52915a=(0x0,utils_1[_0x22ac3a(0xf6)])(_0x605e65,_0x42be68);try{while(_0x52915a[_0x22ac3a(0xf4)]){const _0x1f32ee=_0x52915a[_0x22ac3a(0x101)](0x0,Math['floor'](constants_1[_0x22ac3a(0x10d)]/_0x42be68));await this[_0x22ac3a(0x105)](_0x1f32ee,_0x3d15f0);}}catch(_0x1e9270){this[_0x22ac3a(0x10a)][_0x22ac3a(0xf3)](_0x1e9270 instanceof salesforce_error_1[_0x22ac3a(0xea)]?JSON[_0x22ac3a(0xdf)](_0x1e9270[_0x22ac3a(0xde)](),null,0x2):_0x1e9270),this[_0x22ac3a(0xf2)][_0x22ac3a(0x109)](_0x1e9270 instanceof salesforce_error_1[_0x22ac3a(0xea)]?JSON[_0x22ac3a(0xdf)](_0x1e9270[_0x22ac3a(0xde)](),null,0x2):_0x1e9270[_0x22ac3a(0xcb)]());throw _0x1e9270;}}async['proceedCommitsToRepository'](_0x4c36cd){const _0x4a1f8d=a270_0xebe282;for(const _0x3aecc6 of _0x4c36cd){if(!_0x3aecc6[_0x4a1f8d(0xff)][_0x4a1f8d(0xf4)]&&!_0x3aecc6['modified'][_0x4a1f8d(0xf4)]&&!_0x3aecc6[_0x4a1f8d(0x107)][_0x4a1f8d(0xf4)])continue;const _0x2695c0=[],_0x515801=[],_0x4275a2=new salesforce_components_manager_service_1[(_0x4a1f8d(0xe0))](this[_0x4a1f8d(0xc9)][_0x4a1f8d(0xcd)],this[_0x4a1f8d(0xc9)][_0x4a1f8d(0xe5)],_0x3aecc6[_0x4a1f8d(0xcf)],this[_0x4a1f8d(0xc9)][_0x4a1f8d(0xd6)],this[_0x4a1f8d(0xeb)]);_0x2695c0['push'](...await _0x4275a2[_0x4a1f8d(0xfa)](_0x3aecc6[_0x4a1f8d(0xff)],this[_0x4a1f8d(0xc9)]['commitId'])),_0x2695c0['push'](...await _0x4275a2['update'](_0x3aecc6[_0x4a1f8d(0xfd)],this['options'][_0x4a1f8d(0x103)])),_0x515801[_0x4a1f8d(0xc7)](await _0x4275a2[_0x4a1f8d(0x110)](_0x3aecc6[_0x4a1f8d(0x107)],!![])),this['proceededComponentsMeta']=_0x4275a2[_0x4a1f8d(0xf0)](),await this[_0x4a1f8d(0xd9)](_0x2695c0,!![]);for(const _0x59e76f of _0x515801){_0x59e76f['manifests'][_0x4a1f8d(0xf4)]&&await this[_0x4a1f8d(0xd9)](_0x59e76f['manifests'],!![]),_0x59e76f[_0x4a1f8d(0xef)][_0x4a1f8d(0xf4)]&&await this['proceedRequests'](_0x59e76f[_0x4a1f8d(0xef)],!![]),_0x59e76f[_0x4a1f8d(0xd0)]['length']&&await this[_0x4a1f8d(0xd9)](_0x59e76f[_0x4a1f8d(0xd0)],!![]);}this['logger'][_0x4a1f8d(0x109)](_0x4a1f8d(0x100),_0x2695c0[_0x4a1f8d(0xf4)]);}}async['proceedCommitsToBranch'](_0xaff3e0){const _0x107cc9=a270_0xebe282,_0x541e41=[],_0x5ba0b=[];for(const _0x291599 of _0xaff3e0){if(!_0x291599[_0x107cc9(0xff)]['length']&&!_0x291599[_0x107cc9(0xfd)][_0x107cc9(0xf4)]&&!_0x291599[_0x107cc9(0x107)][_0x107cc9(0xf4)])continue;const _0x2def3c=new salesforce_components_manager_service_1[(_0x107cc9(0xe0))](this[_0x107cc9(0xc9)][_0x107cc9(0xcd)],this['options'][_0x107cc9(0xe5)],_0x291599[_0x107cc9(0xcf)],this[_0x107cc9(0xc9)][_0x107cc9(0xd6)],[]);_0x541e41['push'](...await _0x2def3c[_0x107cc9(0xfa)](_0x291599['inserted'])),_0x541e41[_0x107cc9(0xc7)](...await _0x2def3c[_0x107cc9(0xcc)](_0x291599['modified'])),_0x5ba0b[_0x107cc9(0xc7)](await _0x2def3c[_0x107cc9(0x110)](_0x291599[_0x107cc9(0x107)]));}this[_0x107cc9(0x10a)][_0x107cc9(0x109)](_0x107cc9(0xd4),_0x541e41[_0x107cc9(0xf4)]),await this['proceedRequests'](_0x541e41);const _0x1d6039=_0x5ba0b[_0x107cc9(0x114)]((_0x45f24a,_0xb9f3bc)=>({'manifests':[..._0x45f24a[_0x107cc9(0x106)],..._0xb9f3bc[_0x107cc9(0x106)]],'componentsToDelete':[..._0x45f24a[_0x107cc9(0xd0)],..._0xb9f3bc['componentsToDelete']],'componentsToUpdate':[..._0x45f24a[_0x107cc9(0xef)],..._0xb9f3bc[_0x107cc9(0xef)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x1d6039['manifests']['length']&&await this[_0x107cc9(0xd9)](_0x1d6039[_0x107cc9(0x106)],!![]),_0x1d6039['componentsToUpdate']['length']&&await this[_0x107cc9(0xd9)](_0x1d6039[_0x107cc9(0xef)],!![]),_0x1d6039[_0x107cc9(0xd0)]['length']&&await this[_0x107cc9(0xd9)](_0x1d6039[_0x107cc9(0xd0)],!![]);}async[a270_0xebe282(0xf1)](_0x1cd4f5){const _0x36f578=a270_0xebe282;this['options'][_0x36f578(0xe5)]?await this['proceedCommitsToBranch'](_0x1cd4f5):await this['proceedCommitsToRepository'](_0x1cd4f5);}}exports[a270_0xebe282(0xed)]=SalesforceCommitsManager;function a270_0x3f7c(_0x515cf1,_0x50dc85){const _0x5163f8=a270_0x4275();return a270_0x3f7c=function(_0x1c58b2,_0x159629){_0x1c58b2=_0x1c58b2-0xc7;let _0x4275b2=_0x5163f8[_0x1c58b2];return _0x4275b2;},a270_0x3f7c(_0x515cf1,_0x50dc85);}function a270_0x4275(){const _0x2778c3=['splice','composite','commitId','__importDefault','proceedChunksToUpload','manifests','removed','./salesforce-components-manager.service','log','logger','Logger','executeGraphs','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','search','3UpDOob','delete','9152046JwFwSN','find','2065fPQPHQ','reduce','push','SALESFORCE_MAX_REQUEST_SIZE_BYTES','options','../../../../constants','toString','update','repositoryId','750940MLtwjf','author','componentsToDelete','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','1167485Ilhjsh','108HmFDMZ','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','extractComponentIdsFromGraphsResponse','recordTypes','14704QeqhXc','__esModule','proceedRequests','componentId','../utils/composite.utils','name','../errors/salesforce.error','toJSON','stringify','SalesforceComponentsManager','apply','SalesforceCompositeService','COMPONENTS_PER_CHUNK','1775076BPfKtD','branchId','defineProperty','(((.+)+)+)+$','../../../../core','1Dcjttl','SalesforceError','proceededComponentsMeta','24yjpZhO','SalesforceCommitsManager','graph','componentsToUpdate','getProceededComponentsMeta','proceedCommits','sfLogger','error','length','7358600NMSTiO','chunkArray','constructor','default','\x20COMPONENTS_SIZE\x20=\x20','insert','Sending\x20','typedi','modified','889786hXRLek','inserted','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)'];a270_0x4275=function(){return _0x2778c3;};return a270_0x4275();}