const a228_0x20be99=a228_0x1ee5;(function(_0x24c7ee,_0x40a09a){const _0x1a7e05=a228_0x1ee5,_0x4e15ae=_0x24c7ee();while(!![]){try{const _0x52531=-parseInt(_0x1a7e05(0x9c))/0x1*(parseInt(_0x1a7e05(0x8b))/0x2)+-parseInt(_0x1a7e05(0x83))/0x3+parseInt(_0x1a7e05(0xb5))/0x4+-parseInt(_0x1a7e05(0x84))/0x5+parseInt(_0x1a7e05(0xb6))/0x6+parseInt(_0x1a7e05(0xb2))/0x7+parseInt(_0x1a7e05(0x87))/0x8*(parseInt(_0x1a7e05(0x9d))/0x9);if(_0x52531===_0x40a09a)break;else _0x4e15ae['push'](_0x4e15ae['shift']());}catch(_0x45978a){_0x4e15ae['push'](_0x4e15ae['shift']());}}}(a228_0x24ba,0x7add8));const a228_0x3b017f=(function(){let _0x431e02=!![];return function(_0x30e89a,_0x54b666){const _0x7d5d61=_0x431e02?function(){if(_0x54b666){const _0x27a8b0=_0x54b666['apply'](_0x30e89a,arguments);return _0x54b666=null,_0x27a8b0;}}:function(){};return _0x431e02=![],_0x7d5d61;};}()),a228_0x4b51f0=a228_0x3b017f(this,function(){const _0x3c7837=a228_0x1ee5;return a228_0x4b51f0['toString']()['search'](_0x3c7837(0x98))[_0x3c7837(0xa3)]()[_0x3c7837(0x86)](a228_0x4b51f0)[_0x3c7837(0x96)](_0x3c7837(0x98));});function a228_0x24ba(){const _0x58e5b2=['SALESFORCE_MAX_REQUEST_SIZE_BYTES','1167117FudKZa','branchId','push','941864NzJGRe','2782308aowOqG','stringify','commitId','proceedCommits','inserted','SalesforceError','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','find','typedi','delete','name','length','../../../../constants','modified','repositoryId','log','splice','executeGraphs','./salesforce-components-manager.service','./salesforce-composite.service','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','Sending\x20','default','2633652SzfEMk','1847165ZAPoSt','SalesforceComponentsManager','constructor','832vBrQDr','author','../../../../core','logger','532828fTsAzY','proceedRequests','update','componentId','options','error','extractComponentIdsFromGraphsResponse','proceedCommitsToRepository','recordTypes','proceededComponentsMeta','\x20requests\x20to\x20composite\x20api.','search','toJSON','(((.+)+)+)+$','sfLogger','composite','COMPONENTS_PER_CHUNK','1JFGscC','99612aOWXeG','manifests','SalesforceCommitsManager','defineProperty','getProceededComponentsMeta','removed','toString','componentsToUpdate','map','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','proceedCommitsToBranch','insert','\x20COMPONENTS_SIZE\x20=\x20','get','../errors/salesforce.error','SalesforceCompositeService','componentsToDelete','reduce','__esModule','proceedChunksToUpload'];a228_0x24ba=function(){return _0x58e5b2;};return a228_0x24ba();}function a228_0x1ee5(_0x2dbad3,_0x267faa){const _0x49d6a5=a228_0x24ba();return a228_0x1ee5=function(_0x4b51f0,_0x3b017f){_0x4b51f0=_0x4b51f0-0x72;let _0x24baaa=_0x49d6a5[_0x4b51f0];return _0x24baaa;},a228_0x1ee5(_0x2dbad3,_0x267faa);}a228_0x4b51f0();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x582c9){return _0x582c9&&_0x582c9['__esModule']?_0x582c9:{'default':_0x582c9};};Object[a228_0x20be99(0xa0)](exports,a228_0x20be99(0xaf),{'value':!![]}),exports[a228_0x20be99(0x9f)]=void 0x0;const core_1=require(a228_0x20be99(0x89)),typedi_1=__importDefault(require(a228_0x20be99(0x74))),constants_1=require(a228_0x20be99(0x78)),utils_1=require('../../../shared/utils'),salesforce_error_1=require(a228_0x20be99(0xab)),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require(a228_0x20be99(0x7e)),salesforce_composite_service_1=require(a228_0x20be99(0x7f));class SalesforceCommitsManager{constructor(_0x19ee38){const _0xc38d8a=a228_0x20be99;this[_0xc38d8a(0x8f)]=_0x19ee38,this[_0xc38d8a(0x9b)]=0x3,this['logger']=new core_1['Logger'](SalesforceCommitsManager[_0xc38d8a(0x76)]),this['sfLogger']=this[_0xc38d8a(0x8f)]['logger'],this[_0xc38d8a(0x9a)]=typedi_1[_0xc38d8a(0x82)][_0xc38d8a(0xaa)](salesforce_composite_service_1[_0xc38d8a(0xac)]),this['proceededComponentsMeta']=[];}async[a228_0x20be99(0xb0)](_0x3f37c2,_0x1d45f1=![]){const _0x20b151=a228_0x20be99,_0x4c9d46=async _0x532191=>{const _0x276096=a228_0x1ee5;await this[_0x276096(0x8a)][_0x276096(0x7b)](_0x276096(0x81)+_0x532191['reduce']((_0x545a66,_0x176685)=>_0x545a66+_0x176685[_0x276096(0x77)],0x0)+_0x276096(0x95));const _0x3d524a=_0x532191[_0x276096(0xa5)]((_0x2d2424,_0x10cd7c)=>({'graphId':'graph'+_0x10cd7c,'compositeRequest':_0x2d2424})),_0x1bc54d=await this[_0x276096(0x9a)][_0x276096(0x7d)](_0x3d524a);if(_0x1d45f1){const _0x1f546=(0x0,composite_utils_1[_0x276096(0x91)])(_0x1bc54d);for(const {id:_0x4271d4,ref:_0x92912b}of _0x1f546){const _0x5322cc=this[_0x276096(0x94)][_0x276096(0x73)](_0x29db58=>_0x29db58['reference']===_0x92912b);_0x5322cc&&(_0x5322cc[_0x276096(0x8e)]=_0x4271d4);}}},_0x15bd7a=0x1e8480;let _0x204b55=0x0,_0x29f831=[];for(const _0x1fddc9 of _0x3f37c2){const _0x912c5f=_0x1fddc9[_0x20b151(0xae)]((_0x489c5b,_0x1d566e)=>{const _0x35806e=_0x20b151,_0x26f266=JSON[_0x35806e(0xb7)](_0x1d566e)[_0x35806e(0x77)]*0x2;return _0x489c5b+_0x26f266;},0x0);if(_0x912c5f>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES'])throw new salesforce_error_1[(_0x20b151(0xbb))](_0x20b151(0xa6)+constants_1[_0x20b151(0xb1)]+_0x20b151(0xa9)+_0x912c5f);_0x204b55+_0x912c5f>constants_1[_0x20b151(0xb1)]-_0x15bd7a&&(await _0x4c9d46(_0x29f831),_0x29f831=[],_0x204b55=0x0),_0x204b55+=_0x912c5f,_0x29f831['push'](_0x1fddc9);}_0x29f831[_0x20b151(0x77)]&&await _0x4c9d46(_0x29f831);}async[a228_0x20be99(0x8c)](_0x17531a,_0x1f7c15=![]){const _0x1a3ba6=a228_0x20be99,_0xc68c5b=(this[_0x1a3ba6(0x9b)]+ +_0x1f7c15)*0x3,_0x302657=(0x0,utils_1['chunkArray'])(_0x17531a,_0xc68c5b);try{while(_0x302657['length']){const _0x5ca818=_0x302657[_0x1a3ba6(0x7c)](0x0,Math['floor'](constants_1[_0x1a3ba6(0x80)]/_0xc68c5b));await this['proceedChunksToUpload'](_0x5ca818,_0x1f7c15);}}catch(_0x286d3b){this[_0x1a3ba6(0x8a)][_0x1a3ba6(0x90)](_0x286d3b instanceof salesforce_error_1['SalesforceError']?JSON['stringify'](_0x286d3b[_0x1a3ba6(0x97)](),null,0x2):_0x286d3b),this[_0x1a3ba6(0x99)][_0x1a3ba6(0x7b)](_0x286d3b instanceof salesforce_error_1[_0x1a3ba6(0xbb)]?JSON['stringify'](_0x286d3b['toJSON'](),null,0x2):_0x286d3b[_0x1a3ba6(0xa3)]());throw _0x286d3b;}}async[a228_0x20be99(0x92)](_0x5c6691){const _0x38c1dd=a228_0x20be99;for(const _0x113112 of _0x5c6691){if(!_0x113112[_0x38c1dd(0xba)][_0x38c1dd(0x77)]&&!_0x113112[_0x38c1dd(0x79)][_0x38c1dd(0x77)]&&!_0x113112[_0x38c1dd(0xa2)][_0x38c1dd(0x77)])continue;const _0x5190ce=[],_0x47b584=[],_0x19e10f=new salesforce_components_manager_service_1[(_0x38c1dd(0x85))](this[_0x38c1dd(0x8f)][_0x38c1dd(0x7a)],this[_0x38c1dd(0x8f)]['branchId'],_0x113112[_0x38c1dd(0x88)],this[_0x38c1dd(0x8f)]['recordTypes'],this['proceededComponentsMeta']);_0x5190ce[_0x38c1dd(0xb4)](...await _0x19e10f[_0x38c1dd(0xa8)](_0x113112[_0x38c1dd(0xba)],this[_0x38c1dd(0x8f)][_0x38c1dd(0xb8)])),_0x5190ce[_0x38c1dd(0xb4)](...await _0x19e10f['update'](_0x113112[_0x38c1dd(0x79)],this[_0x38c1dd(0x8f)][_0x38c1dd(0xb8)])),_0x47b584['push'](await _0x19e10f[_0x38c1dd(0x75)](_0x113112[_0x38c1dd(0xa2)],!![])),this[_0x38c1dd(0x94)]=_0x19e10f[_0x38c1dd(0xa1)](),await this['proceedRequests'](_0x5190ce,!![]);for(const _0x239216 of _0x47b584){_0x239216[_0x38c1dd(0x9e)]['length']&&await this[_0x38c1dd(0x8c)](_0x239216[_0x38c1dd(0x9e)],!![]),_0x239216[_0x38c1dd(0xa4)][_0x38c1dd(0x77)]&&await this[_0x38c1dd(0x8c)](_0x239216[_0x38c1dd(0xa4)],!![]),_0x239216['componentsToDelete'][_0x38c1dd(0x77)]&&await this[_0x38c1dd(0x8c)](_0x239216[_0x38c1dd(0xad)],!![]);}this['logger'][_0x38c1dd(0x7b)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x5190ce[_0x38c1dd(0x77)]);}}async[a228_0x20be99(0xa7)](_0x1dbd2a){const _0xd75895=a228_0x20be99,_0x3854c4=[],_0x5706db=[];for(const _0x58f9c8 of _0x1dbd2a){if(!_0x58f9c8[_0xd75895(0xba)]['length']&&!_0x58f9c8[_0xd75895(0x79)][_0xd75895(0x77)]&&!_0x58f9c8['removed'][_0xd75895(0x77)])continue;const _0x18727b=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0xd75895(0x8f)]['repositoryId'],this[_0xd75895(0x8f)][_0xd75895(0xb3)],_0x58f9c8[_0xd75895(0x88)],this[_0xd75895(0x8f)][_0xd75895(0x93)],[]);_0x3854c4['push'](...await _0x18727b[_0xd75895(0xa8)](_0x58f9c8[_0xd75895(0xba)])),_0x3854c4[_0xd75895(0xb4)](...await _0x18727b[_0xd75895(0x8d)](_0x58f9c8['modified'])),_0x5706db[_0xd75895(0xb4)](await _0x18727b[_0xd75895(0x75)](_0x58f9c8[_0xd75895(0xa2)]));}this[_0xd75895(0x8a)][_0xd75895(0x7b)](_0xd75895(0x72),_0x3854c4[_0xd75895(0x77)]),await this[_0xd75895(0x8c)](_0x3854c4);const _0x5df2cb=_0x5706db[_0xd75895(0xae)]((_0x349d06,_0x4f2b8d)=>({'manifests':[..._0x349d06[_0xd75895(0x9e)],..._0x4f2b8d[_0xd75895(0x9e)]],'componentsToDelete':[..._0x349d06[_0xd75895(0xad)],..._0x4f2b8d['componentsToDelete']],'componentsToUpdate':[..._0x349d06[_0xd75895(0xa4)],..._0x4f2b8d['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x5df2cb['manifests'][_0xd75895(0x77)]&&await this[_0xd75895(0x8c)](_0x5df2cb[_0xd75895(0x9e)],!![]),_0x5df2cb[_0xd75895(0xa4)][_0xd75895(0x77)]&&await this[_0xd75895(0x8c)](_0x5df2cb[_0xd75895(0xa4)],!![]),_0x5df2cb[_0xd75895(0xad)][_0xd75895(0x77)]&&await this[_0xd75895(0x8c)](_0x5df2cb[_0xd75895(0xad)],!![]);}async[a228_0x20be99(0xb9)](_0x201b4e){const _0x2878cd=a228_0x20be99;this[_0x2878cd(0x8f)]['branchId']?await this[_0x2878cd(0xa7)](_0x201b4e):await this[_0x2878cd(0x92)](_0x201b4e);}}exports[a228_0x20be99(0x9f)]=SalesforceCommitsManager;