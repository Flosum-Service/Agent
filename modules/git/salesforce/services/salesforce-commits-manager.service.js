const a233_0x315af5=a233_0x340b;(function(_0x5958bd,_0x4ed8d9){const _0x1d8d17=a233_0x340b,_0x205188=_0x5958bd();while(!![]){try{const _0x13d4f6=parseInt(_0x1d8d17(0xbb))/0x1+parseInt(_0x1d8d17(0x8f))/0x2+parseInt(_0x1d8d17(0xbc))/0x3*(-parseInt(_0x1d8d17(0xbd))/0x4)+parseInt(_0x1d8d17(0xb9))/0x5*(-parseInt(_0x1d8d17(0x97))/0x6)+parseInt(_0x1d8d17(0x83))/0x7*(-parseInt(_0x1d8d17(0xad))/0x8)+-parseInt(_0x1d8d17(0x92))/0x9+parseInt(_0x1d8d17(0x9c))/0xa;if(_0x13d4f6===_0x4ed8d9)break;else _0x205188['push'](_0x205188['shift']());}catch(_0x24da8b){_0x205188['push'](_0x205188['shift']());}}}(a233_0x2cae,0xb92c2));const a233_0x1ec772=(function(){let _0x1170ce=!![];return function(_0x31abca,_0x56df69){const _0x129f8f=_0x1170ce?function(){if(_0x56df69){const _0x3075c1=_0x56df69['apply'](_0x31abca,arguments);return _0x56df69=null,_0x3075c1;}}:function(){};return _0x1170ce=![],_0x129f8f;};}()),a233_0x5e3cb4=a233_0x1ec772(this,function(){const _0x3f6a75=a233_0x340b;return a233_0x5e3cb4[_0x3f6a75(0x98)]()['search'](_0x3f6a75(0xa0))[_0x3f6a75(0x98)]()['constructor'](a233_0x5e3cb4)[_0x3f6a75(0x96)](_0x3f6a75(0xa0));});function a233_0x340b(_0x139380,_0xd57a5c){const _0x48a1ae=a233_0x2cae();return a233_0x340b=function(_0x5e3cb4,_0x1ec772){_0x5e3cb4=_0x5e3cb4-0x7f;let _0x2cae23=_0x48a1ae[_0x5e3cb4];return _0x2cae23;},a233_0x340b(_0x139380,_0xd57a5c);}a233_0x5e3cb4();'use strict';var __importDefault=this&&this[a233_0x315af5(0xba)]||function(_0x2ffb5a){const _0x3a4662=a233_0x315af5;return _0x2ffb5a&&_0x2ffb5a[_0x3a4662(0x84)]?_0x2ffb5a:{'default':_0x2ffb5a};};Object[a233_0x315af5(0x86)](exports,a233_0x315af5(0x84),{'value':!![]}),exports[a233_0x315af5(0xa4)]=void 0x0;const core_1=require(a233_0x315af5(0x8c)),typedi_1=__importDefault(require('typedi')),constants_1=require('../../../../constants'),utils_1=require('../../../shared/utils'),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require('./salesforce-components-manager.service'),salesforce_composite_service_1=require('./salesforce-composite.service');function a233_0x2cae(){const _0x5c3a58=['push','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','logger','2912608RlQZxx','proceedChunksToUpload','extractComponentIdsFromGraphsResponse','find','reference','Sending\x20','stringify','executeGraphs','manifests','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','sfLogger','10KDNfup','__importDefault','1279270bJgwpn','2067vPgruo','4136NUICud','default','\x20COMPONENTS_SIZE\x20=\x20','SalesforceError','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','delete','chunkArray','proceedCommits','floor','map','toJSON','removed','componentId','COMPONENTS_PER_CHUNK','SALESFORCE_MAX_REQUEST_SIZE_BYTES','28VVdqXU','__esModule','\x20requests\x20to\x20composite\x20api.','defineProperty','proceedRequests','recordTypes','inserted','componentsToUpdate','name','../../../../core','proceedCommitsToBranch','reduce','485470cOsOls','length','update','7146090eZVvUN','insert','options','splice','search','2084154FNmWWr','toString','branchId','error','modified','28939190DouPmt','log','getProceededComponentsMeta','commitId','(((.+)+)+)+$','componentsToDelete','SalesforceComponentsManager','repositoryId','SalesforceCommitsManager','proceededComponentsMeta','Logger','composite','author','proceedCommitsToRepository'];a233_0x2cae=function(){return _0x5c3a58;};return a233_0x2cae();}class SalesforceCommitsManager{constructor(_0x50955a){const _0x238710=a233_0x315af5;this[_0x238710(0x94)]=_0x50955a,this[_0x238710(0x81)]=0x3,this['logger']=new core_1[(_0x238710(0xa6))](SalesforceCommitsManager[_0x238710(0x8b)]),this['sfLogger']=this[_0x238710(0x94)][_0x238710(0xac)],this[_0x238710(0xa7)]=typedi_1[_0x238710(0xbe)]['get'](salesforce_composite_service_1['SalesforceCompositeService']),this[_0x238710(0xa5)]=[];}async[a233_0x315af5(0xae)](_0x3109e9,_0x51076b=![]){const _0x334bb7=a233_0x315af5,_0x2219cc=async _0x1b18d8=>{const _0x199c67=a233_0x340b;await this[_0x199c67(0xac)][_0x199c67(0x9d)](_0x199c67(0xb2)+_0x1b18d8[_0x199c67(0x8e)]((_0x34b81c,_0x4f5c11)=>_0x34b81c+_0x4f5c11[_0x199c67(0x90)],0x0)+_0x199c67(0x85));const _0x491904=_0x1b18d8[_0x199c67(0xc6)]((_0x307101,_0x4e1aec)=>({'graphId':'graph'+_0x4e1aec,'compositeRequest':_0x307101})),_0x5951d8=await this[_0x199c67(0xa7)][_0x199c67(0xb4)](_0x491904);if(_0x51076b){const _0x57578f=(0x0,composite_utils_1[_0x199c67(0xaf)])(_0x5951d8);for(const {id:_0x3a350a,ref:_0x106a76}of _0x57578f){const _0x62df63=this['proceededComponentsMeta'][_0x199c67(0xb0)](_0x22a285=>_0x22a285[_0x199c67(0xb1)]===_0x106a76);_0x62df63&&(_0x62df63[_0x199c67(0x80)]=_0x3a350a);}}},_0x3d9ba6=0x1e8480;let _0x29981e=0x0,_0x396576=[];for(const _0x486e2d of _0x3109e9){const _0x3bb6d3=_0x486e2d[_0x334bb7(0x8e)]((_0x16af58,_0x3726a9)=>{const _0x44f1d0=_0x334bb7,_0xbdd3bf=JSON[_0x44f1d0(0xb3)](_0x3726a9)[_0x44f1d0(0x90)]*0x2;return _0x16af58+_0xbdd3bf;},0x0);if(_0x3bb6d3>constants_1[_0x334bb7(0x82)])throw new salesforce_error_1[(_0x334bb7(0xc0))](_0x334bb7(0xb6)+constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']+_0x334bb7(0xbf)+_0x3bb6d3);_0x29981e+_0x3bb6d3>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']-_0x3d9ba6&&(await _0x2219cc(_0x396576),_0x396576=[],_0x29981e=0x0),_0x29981e+=_0x3bb6d3,_0x396576['push'](_0x486e2d);}_0x396576['length']&&await _0x2219cc(_0x396576);}async[a233_0x315af5(0x87)](_0x39cc71,_0x1f373f=![]){const _0x315416=a233_0x315af5,_0x575960=(this[_0x315416(0x81)]+ +_0x1f373f)*0x3,_0x184b5a=(0x0,utils_1[_0x315416(0xc3)])(_0x39cc71,_0x575960);try{while(_0x184b5a[_0x315416(0x90)]){const _0x536373=_0x184b5a[_0x315416(0x95)](0x0,Math[_0x315416(0xc5)](constants_1[_0x315416(0xc1)]/_0x575960));await this[_0x315416(0xae)](_0x536373,_0x1f373f);}}catch(_0x22423c){this[_0x315416(0xac)][_0x315416(0x9a)](_0x22423c instanceof salesforce_error_1[_0x315416(0xc0)]?JSON[_0x315416(0xb3)](_0x22423c[_0x315416(0xc7)](),null,0x2):_0x22423c),this[_0x315416(0xb8)][_0x315416(0x9d)](_0x22423c instanceof salesforce_error_1['SalesforceError']?JSON[_0x315416(0xb3)](_0x22423c[_0x315416(0xc7)](),null,0x2):_0x22423c[_0x315416(0x98)]());throw _0x22423c;}}async[a233_0x315af5(0xa9)](_0x5a2dde){const _0x4bfd94=a233_0x315af5;for(const _0x127886 of _0x5a2dde){if(!_0x127886[_0x4bfd94(0x89)]['length']&&!_0x127886[_0x4bfd94(0x9b)][_0x4bfd94(0x90)]&&!_0x127886[_0x4bfd94(0x7f)][_0x4bfd94(0x90)])continue;const _0xbc29c=[],_0x28c7ef=[],_0x6343d8=new salesforce_components_manager_service_1[(_0x4bfd94(0xa2))](this['options']['repositoryId'],this[_0x4bfd94(0x94)][_0x4bfd94(0x99)],_0x127886['author'],this[_0x4bfd94(0x94)]['recordTypes'],this[_0x4bfd94(0xa5)]);_0xbc29c[_0x4bfd94(0xaa)](...await _0x6343d8[_0x4bfd94(0x93)](_0x127886['inserted'],this['options'][_0x4bfd94(0x9f)])),_0xbc29c['push'](...await _0x6343d8[_0x4bfd94(0x91)](_0x127886[_0x4bfd94(0x9b)],this[_0x4bfd94(0x94)][_0x4bfd94(0x9f)])),_0x28c7ef['push'](await _0x6343d8['delete'](_0x127886[_0x4bfd94(0x7f)],!![])),this[_0x4bfd94(0xa5)]=_0x6343d8[_0x4bfd94(0x9e)](),await this[_0x4bfd94(0x87)](_0xbc29c,!![]);for(const _0x27122d of _0x28c7ef){_0x27122d[_0x4bfd94(0xb5)][_0x4bfd94(0x90)]&&await this[_0x4bfd94(0x87)](_0x27122d[_0x4bfd94(0xb5)],!![]),_0x27122d[_0x4bfd94(0x8a)]['length']&&await this[_0x4bfd94(0x87)](_0x27122d['componentsToUpdate'],!![]),_0x27122d[_0x4bfd94(0xa1)]['length']&&await this[_0x4bfd94(0x87)](_0x27122d['componentsToDelete'],!![]);}this[_0x4bfd94(0xac)][_0x4bfd94(0x9d)](_0x4bfd94(0xb7),_0xbc29c['length']);}}async['proceedCommitsToBranch'](_0x257256){const _0x57506b=a233_0x315af5,_0xdefb96=[],_0x7a350b=[];for(const _0x3aa33a of _0x257256){if(!_0x3aa33a[_0x57506b(0x89)]['length']&&!_0x3aa33a[_0x57506b(0x9b)]['length']&&!_0x3aa33a[_0x57506b(0x7f)]['length'])continue;const _0xaf41dd=new salesforce_components_manager_service_1[(_0x57506b(0xa2))](this[_0x57506b(0x94)][_0x57506b(0xa3)],this[_0x57506b(0x94)]['branchId'],_0x3aa33a[_0x57506b(0xa8)],this['options'][_0x57506b(0x88)],[]);_0xdefb96[_0x57506b(0xaa)](...await _0xaf41dd[_0x57506b(0x93)](_0x3aa33a['inserted'])),_0xdefb96[_0x57506b(0xaa)](...await _0xaf41dd[_0x57506b(0x91)](_0x3aa33a[_0x57506b(0x9b)])),_0x7a350b[_0x57506b(0xaa)](await _0xaf41dd[_0x57506b(0xc2)](_0x3aa33a[_0x57506b(0x7f)]));}this['logger'][_0x57506b(0x9d)](_0x57506b(0xab),_0xdefb96[_0x57506b(0x90)]),await this[_0x57506b(0x87)](_0xdefb96);const _0x36b1ea=_0x7a350b[_0x57506b(0x8e)]((_0x2b20f7,_0x536394)=>({'manifests':[..._0x2b20f7[_0x57506b(0xb5)],..._0x536394[_0x57506b(0xb5)]],'componentsToDelete':[..._0x2b20f7['componentsToDelete'],..._0x536394[_0x57506b(0xa1)]],'componentsToUpdate':[..._0x2b20f7[_0x57506b(0x8a)],..._0x536394['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x36b1ea[_0x57506b(0xb5)][_0x57506b(0x90)]&&await this[_0x57506b(0x87)](_0x36b1ea['manifests'],!![]),_0x36b1ea[_0x57506b(0x8a)][_0x57506b(0x90)]&&await this[_0x57506b(0x87)](_0x36b1ea['componentsToUpdate'],!![]),_0x36b1ea[_0x57506b(0xa1)][_0x57506b(0x90)]&&await this[_0x57506b(0x87)](_0x36b1ea['componentsToDelete'],!![]);}async[a233_0x315af5(0xc4)](_0x22cbb7){const _0x4e8282=a233_0x315af5;this[_0x4e8282(0x94)]['branchId']?await this[_0x4e8282(0x8d)](_0x22cbb7):await this[_0x4e8282(0xa9)](_0x22cbb7);}}exports[a233_0x315af5(0xa4)]=SalesforceCommitsManager;