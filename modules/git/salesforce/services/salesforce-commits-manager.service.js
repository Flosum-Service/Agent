const a228_0x91c948=a228_0x5855;function a228_0x449c(){const _0x35b095=['./salesforce-components-manager.service','delete','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','reduce','push','18440548ZSVzuc','Sending\x20','branchId','proceedChunksToUpload','name','repositoryId','insert','483222BETgSM','SalesforceCommitsManager','1025840XJIEFr','toString','map','../../../../constants','default','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','extractComponentIdsFromGraphsResponse','__esModule','composite','../../../../core','sfLogger','chunkArray','search','1023976rwTBfD','update','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','SalesforceError','proceedCommits','removed','apply','recordTypes','toJSON','__importDefault','proceedCommitsToRepository','1558236ofUrfH','author','length','modified','splice','(((.+)+)+)+$','log','componentsToUpdate','commitId','../../../shared/utils','options','floor','\x20requests\x20to\x20composite\x20api.','constructor','manifests','SALESFORCE_MAX_REQUEST_SIZE_BYTES','logger','componentsToDelete','inserted','stringify','find','proceedRequests','proceededComponentsMeta','error','4253226bEXFES','COMPONENTS_PER_CHUNK','3723940twToSb'];a228_0x449c=function(){return _0x35b095;};return a228_0x449c();}(function(_0x5a2e4f,_0x1b4e64){const _0x2e202a=a228_0x5855,_0x21cc74=_0x5a2e4f();while(!![]){try{const _0x442596=-parseInt(_0x2e202a(0x182))/0x1+parseInt(_0x2e202a(0x1b5))/0x2+parseInt(_0x2e202a(0x18e))/0x3+-parseInt(_0x2e202a(0x1b7))/0x4+-parseInt(_0x2e202a(0x1a8))/0x5+-parseInt(_0x2e202a(0x1a6))/0x6+parseInt(_0x2e202a(0x1ae))/0x7;if(_0x442596===_0x1b4e64)break;else _0x21cc74['push'](_0x21cc74['shift']());}catch(_0x53a9f4){_0x21cc74['push'](_0x21cc74['shift']());}}}(a228_0x449c,0xa172c));const a228_0x5bbc1e=(function(){let _0x230ccd=!![];return function(_0x202116,_0x1b5381){const _0x1baa05=_0x230ccd?function(){const _0x55ef0d=a228_0x5855;if(_0x1b5381){const _0x4e29eb=_0x1b5381[_0x55ef0d(0x189)](_0x202116,arguments);return _0x1b5381=null,_0x4e29eb;}}:function(){};return _0x230ccd=![],_0x1baa05;};}()),a228_0x4add4f=a228_0x5bbc1e(this,function(){const _0xd2cf14=a228_0x5855;return a228_0x4add4f[_0xd2cf14(0x1b8)]()['search'](_0xd2cf14(0x193))[_0xd2cf14(0x1b8)]()[_0xd2cf14(0x19b)](a228_0x4add4f)[_0xd2cf14(0x181)]('(((.+)+)+)+$');});a228_0x4add4f();'use strict';function a228_0x5855(_0x1c4e38,_0xb39664){const _0x7ae389=a228_0x449c();return a228_0x5855=function(_0x4add4f,_0x5bbc1e){_0x4add4f=_0x4add4f-0x181;let _0x449c18=_0x7ae389[_0x4add4f];return _0x449c18;},a228_0x5855(_0x1c4e38,_0xb39664);}var __importDefault=this&&this[a228_0x91c948(0x18c)]||function(_0x4edc25){const _0x1da287=a228_0x91c948;return _0x4edc25&&_0x4edc25[_0x1da287(0x1be)]?_0x4edc25:{'default':_0x4edc25};};Object['defineProperty'](exports,a228_0x91c948(0x1be),{'value':!![]}),exports[a228_0x91c948(0x1b6)]=void 0x0;const core_1=require(a228_0x91c948(0x1c0)),typedi_1=__importDefault(require('typedi')),constants_1=require(a228_0x91c948(0x1ba)),utils_1=require(a228_0x91c948(0x197)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require(a228_0x91c948(0x1a9)),salesforce_composite_service_1=require('./salesforce-composite.service');class SalesforceCommitsManager{constructor(_0x189178){const _0x51748f=a228_0x91c948;this[_0x51748f(0x198)]=_0x189178,this[_0x51748f(0x1a7)]=0x3,this[_0x51748f(0x19e)]=new core_1['Logger'](SalesforceCommitsManager[_0x51748f(0x1b2)]),this[_0x51748f(0x1c1)]=this['options']['logger'],this[_0x51748f(0x1bf)]=typedi_1[_0x51748f(0x1bb)]['get'](salesforce_composite_service_1['SalesforceCompositeService']),this['proceededComponentsMeta']=[];}async[a228_0x91c948(0x1b1)](_0x2d72c8,_0x2d341d=![]){const _0x4fa218=a228_0x91c948,_0x4354fa=async _0x35d1e4=>{const _0x4f106d=a228_0x5855;await this['logger'][_0x4f106d(0x194)](_0x4f106d(0x1af)+_0x35d1e4['reduce']((_0x1c1da7,_0x310183)=>_0x1c1da7+_0x310183[_0x4f106d(0x190)],0x0)+_0x4f106d(0x19a));const _0x2f2c0d=_0x35d1e4[_0x4f106d(0x1b9)]((_0x59f779,_0x5a7929)=>({'graphId':'graph'+_0x5a7929,'compositeRequest':_0x59f779})),_0x15f10a=await this[_0x4f106d(0x1bf)]['executeGraphs'](_0x2f2c0d);if(_0x2d341d){const _0x905325=(0x0,composite_utils_1[_0x4f106d(0x1bd)])(_0x15f10a);for(const {id:_0x1ec883,ref:_0x4dc649}of _0x905325){const _0xc137f6=this[_0x4f106d(0x1a4)][_0x4f106d(0x1a2)](_0x4010fc=>_0x4010fc['reference']===_0x4dc649);_0xc137f6&&(_0xc137f6['componentId']=_0x1ec883);}}},_0x5dbcbf=0x1e8480;let _0x46f438=0x0,_0x325416=[];for(const _0x5cef0d of _0x2d72c8){const _0x3799e4=_0x5cef0d[_0x4fa218(0x1ac)]((_0x21d433,_0xe3266b)=>{const _0x167ab1=_0x4fa218,_0xdc3e7e=JSON['stringify'](_0xe3266b)[_0x167ab1(0x190)]*0x2;return _0x21d433+_0xdc3e7e;},0x0);if(_0x3799e4>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES'])throw new salesforce_error_1['SalesforceError'](_0x4fa218(0x1bc)+constants_1[_0x4fa218(0x19d)]+'\x20COMPONENTS_SIZE\x20=\x20'+_0x3799e4);_0x46f438+_0x3799e4>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']-_0x5dbcbf&&(await _0x4354fa(_0x325416),_0x325416=[],_0x46f438=0x0),_0x46f438+=_0x3799e4,_0x325416[_0x4fa218(0x1ad)](_0x5cef0d);}_0x325416[_0x4fa218(0x190)]&&await _0x4354fa(_0x325416);}async['proceedRequests'](_0x3bce3f,_0x2daf6e=![]){const _0x212fc1=a228_0x91c948,_0x1552f9=(this[_0x212fc1(0x1a7)]+ +_0x2daf6e)*0x3,_0x5506c7=(0x0,utils_1[_0x212fc1(0x1c2)])(_0x3bce3f,_0x1552f9);try{while(_0x5506c7[_0x212fc1(0x190)]){const _0x291b34=_0x5506c7[_0x212fc1(0x192)](0x0,Math[_0x212fc1(0x199)](constants_1[_0x212fc1(0x1ab)]/_0x1552f9));await this[_0x212fc1(0x1b1)](_0x291b34,_0x2daf6e);}}catch(_0x2f0b38){this['logger'][_0x212fc1(0x1a5)](_0x2f0b38 instanceof salesforce_error_1[_0x212fc1(0x186)]?JSON[_0x212fc1(0x1a1)](_0x2f0b38[_0x212fc1(0x18b)](),null,0x2):_0x2f0b38),this[_0x212fc1(0x1c1)][_0x212fc1(0x194)](_0x2f0b38 instanceof salesforce_error_1[_0x212fc1(0x186)]?JSON['stringify'](_0x2f0b38[_0x212fc1(0x18b)](),null,0x2):_0x2f0b38[_0x212fc1(0x1b8)]());throw _0x2f0b38;}}async[a228_0x91c948(0x18d)](_0x2f5c06){const _0x3c8da2=a228_0x91c948;for(const _0x49afb2 of _0x2f5c06){if(!_0x49afb2[_0x3c8da2(0x1a0)][_0x3c8da2(0x190)]&&!_0x49afb2['modified']['length']&&!_0x49afb2[_0x3c8da2(0x188)][_0x3c8da2(0x190)])continue;const _0x370dd2=[],_0x59e8fa=[],_0x581bb9=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x3c8da2(0x198)][_0x3c8da2(0x1b3)],this['options'][_0x3c8da2(0x1b0)],_0x49afb2[_0x3c8da2(0x18f)],this[_0x3c8da2(0x198)][_0x3c8da2(0x18a)],this[_0x3c8da2(0x1a4)]);_0x370dd2[_0x3c8da2(0x1ad)](...await _0x581bb9['insert'](_0x49afb2['inserted'],this[_0x3c8da2(0x198)]['commitId'])),_0x370dd2[_0x3c8da2(0x1ad)](...await _0x581bb9[_0x3c8da2(0x183)](_0x49afb2[_0x3c8da2(0x191)],this[_0x3c8da2(0x198)][_0x3c8da2(0x196)])),_0x59e8fa[_0x3c8da2(0x1ad)](await _0x581bb9['delete'](_0x49afb2[_0x3c8da2(0x188)],!![])),this[_0x3c8da2(0x1a4)]=_0x581bb9['getProceededComponentsMeta'](),await this['proceedRequests'](_0x370dd2,!![]);for(const _0x42b72d of _0x59e8fa){_0x42b72d['manifests']['length']&&await this[_0x3c8da2(0x1a3)](_0x42b72d[_0x3c8da2(0x19c)],!![]),_0x42b72d['componentsToUpdate'][_0x3c8da2(0x190)]&&await this['proceedRequests'](_0x42b72d[_0x3c8da2(0x195)],!![]),_0x42b72d['componentsToDelete'][_0x3c8da2(0x190)]&&await this[_0x3c8da2(0x1a3)](_0x42b72d['componentsToDelete'],!![]);}this[_0x3c8da2(0x19e)][_0x3c8da2(0x194)](_0x3c8da2(0x184),_0x370dd2[_0x3c8da2(0x190)]);}}async['proceedCommitsToBranch'](_0x379bab){const _0x22b1d9=a228_0x91c948,_0xfb0976=[],_0xf0411e=[];for(const _0xf94771 of _0x379bab){if(!_0xf94771['inserted'][_0x22b1d9(0x190)]&&!_0xf94771['modified'][_0x22b1d9(0x190)]&&!_0xf94771[_0x22b1d9(0x188)]['length'])continue;const _0x200dba=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x22b1d9(0x198)][_0x22b1d9(0x1b3)],this[_0x22b1d9(0x198)]['branchId'],_0xf94771[_0x22b1d9(0x18f)],this[_0x22b1d9(0x198)][_0x22b1d9(0x18a)],[]);_0xfb0976['push'](...await _0x200dba[_0x22b1d9(0x1b4)](_0xf94771[_0x22b1d9(0x1a0)])),_0xfb0976[_0x22b1d9(0x1ad)](...await _0x200dba[_0x22b1d9(0x183)](_0xf94771['modified'])),_0xf0411e[_0x22b1d9(0x1ad)](await _0x200dba[_0x22b1d9(0x1aa)](_0xf94771[_0x22b1d9(0x188)]));}this[_0x22b1d9(0x19e)][_0x22b1d9(0x194)](_0x22b1d9(0x185),_0xfb0976[_0x22b1d9(0x190)]),await this[_0x22b1d9(0x1a3)](_0xfb0976);const _0x453316=_0xf0411e['reduce']((_0x333e18,_0x59ebf8)=>({'manifests':[..._0x333e18['manifests'],..._0x59ebf8['manifests']],'componentsToDelete':[..._0x333e18[_0x22b1d9(0x19f)],..._0x59ebf8[_0x22b1d9(0x19f)]],'componentsToUpdate':[..._0x333e18[_0x22b1d9(0x195)],..._0x59ebf8[_0x22b1d9(0x195)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x453316[_0x22b1d9(0x19c)][_0x22b1d9(0x190)]&&await this[_0x22b1d9(0x1a3)](_0x453316[_0x22b1d9(0x19c)],!![]),_0x453316['componentsToUpdate'][_0x22b1d9(0x190)]&&await this['proceedRequests'](_0x453316[_0x22b1d9(0x195)],!![]),_0x453316[_0x22b1d9(0x19f)]['length']&&await this['proceedRequests'](_0x453316[_0x22b1d9(0x19f)],!![]);}async[a228_0x91c948(0x187)](_0x333c29){const _0x4ae703=a228_0x91c948;this[_0x4ae703(0x198)]['branchId']?await this['proceedCommitsToBranch'](_0x333c29):await this[_0x4ae703(0x18d)](_0x333c29);}}exports[a228_0x91c948(0x1b6)]=SalesforceCommitsManager;