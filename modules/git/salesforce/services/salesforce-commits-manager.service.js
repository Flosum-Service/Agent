const a270_0x16a8e2=a270_0x43ed;function a270_0x43ed(_0x23badb,_0x381bff){const _0x57553b=a270_0x9dd0();return a270_0x43ed=function(_0x2f204e,_0x519b9c){_0x2f204e=_0x2f204e-0x1a8;let _0x9dd0e9=_0x57553b[_0x2f204e];return _0x9dd0e9;},a270_0x43ed(_0x23badb,_0x381bff);}(function(_0x533fb9,_0x1a3970){const _0x5022f0=a270_0x43ed,_0x4204eb=_0x533fb9();while(!![]){try{const _0x382be8=-parseInt(_0x5022f0(0x1eb))/0x1+parseInt(_0x5022f0(0x1e3))/0x2+parseInt(_0x5022f0(0x1b5))/0x3*(parseInt(_0x5022f0(0x1ab))/0x4)+parseInt(_0x5022f0(0x1c5))/0x5+-parseInt(_0x5022f0(0x1aa))/0x6*(parseInt(_0x5022f0(0x1b1))/0x7)+-parseInt(_0x5022f0(0x1c2))/0x8+parseInt(_0x5022f0(0x1d6))/0x9;if(_0x382be8===_0x1a3970)break;else _0x4204eb['push'](_0x4204eb['shift']());}catch(_0x9c152){_0x4204eb['push'](_0x4204eb['shift']());}}}(a270_0x9dd0,0xe54cb));const a270_0x519b9c=(function(){let _0x31231a=!![];return function(_0x213e9e,_0x25539a){const _0x28bd1d=_0x31231a?function(){if(_0x25539a){const _0x5ca82f=_0x25539a['apply'](_0x213e9e,arguments);return _0x25539a=null,_0x5ca82f;}}:function(){};return _0x31231a=![],_0x28bd1d;};}()),a270_0x2f204e=a270_0x519b9c(this,function(){const _0x2503d7=a270_0x43ed;return a270_0x2f204e[_0x2503d7(0x1b9)]()[_0x2503d7(0x1c7)](_0x2503d7(0x1ef))[_0x2503d7(0x1b9)]()[_0x2503d7(0x1b7)](a270_0x2f204e)[_0x2503d7(0x1c7)](_0x2503d7(0x1ef));});a270_0x2f204e();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x215f0e){return _0x215f0e&&_0x215f0e['__esModule']?_0x215f0e:{'default':_0x215f0e};};Object[a270_0x16a8e2(0x1d7)](exports,a270_0x16a8e2(0x1d9),{'value':!![]}),exports[a270_0x16a8e2(0x1cc)]=void 0x0;function a270_0x9dd0(){const _0x322e5c=['2091Toeulr','proceedChunksToUpload','constructor','componentsToDelete','toString','SalesforceCompositeService','log','manifests','author','push','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','proceedCommitsToRepository','error','3582928IsNISe','./salesforce-composite.service','Logger','3171650TewkBS','COMPONENTS_PER_CHUNK','search','repositoryId','branchId','SalesforceComponentsManager','find','SalesforceCommitsManager','get','reduce','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','options','insert','componentsToUpdate','commitId','stringify','chunkArray','16618509JkGdKE','defineProperty','proceedCommitsToBranch','__esModule','./salesforce-components-manager.service','componentId','removed','modified','proceedRequests','name','proceededComponentsMeta','update','SALESFORCE_MAX_REQUEST_SIZE_BYTES','695818sObwjV','floor','SalesforceError','extractComponentIdsFromGraphsResponse','inserted','sfLogger','../../../../constants','composite','1020630nCYNcH','delete','map','logger','(((.+)+)+)+$','Sending\x20','../utils/composite.utils','length','5846706znSUwM','3176ohZNBS','splice','executeGraphs','../errors/salesforce.error','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','typedi','7ELhHhR','recordTypes','../../../shared/utils','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20'];a270_0x9dd0=function(){return _0x322e5c;};return a270_0x9dd0();}const core_1=require('../../../../core'),typedi_1=__importDefault(require(a270_0x16a8e2(0x1b0))),constants_1=require(a270_0x16a8e2(0x1e9)),utils_1=require(a270_0x16a8e2(0x1b3)),salesforce_error_1=require(a270_0x16a8e2(0x1ae)),composite_utils_1=require(a270_0x16a8e2(0x1a8)),salesforce_components_manager_service_1=require(a270_0x16a8e2(0x1da)),salesforce_composite_service_1=require(a270_0x16a8e2(0x1c3));class SalesforceCommitsManager{constructor(_0x1bde23){const _0x135d5b=a270_0x16a8e2;this[_0x135d5b(0x1d0)]=_0x1bde23,this['COMPONENTS_PER_CHUNK']=0x3,this[_0x135d5b(0x1ee)]=new core_1[(_0x135d5b(0x1c4))](SalesforceCommitsManager[_0x135d5b(0x1df)]),this[_0x135d5b(0x1e8)]=this[_0x135d5b(0x1d0)]['logger'],this[_0x135d5b(0x1ea)]=typedi_1['default'][_0x135d5b(0x1cd)](salesforce_composite_service_1[_0x135d5b(0x1ba)]),this[_0x135d5b(0x1e0)]=[];}async['proceedChunksToUpload'](_0x167922,_0x594a6d=![]){const _0x1a8abb=a270_0x16a8e2,_0x16b630=async _0x1765e4=>{const _0x1ad2fb=a270_0x43ed;await this[_0x1ad2fb(0x1ee)][_0x1ad2fb(0x1bb)](_0x1ad2fb(0x1f0)+_0x1765e4[_0x1ad2fb(0x1ce)]((_0x54db41,_0x31380d)=>_0x54db41+_0x31380d[_0x1ad2fb(0x1a9)],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x309118=_0x1765e4[_0x1ad2fb(0x1ed)]((_0x5551cd,_0x256568)=>({'graphId':'graph'+_0x256568,'compositeRequest':_0x5551cd})),_0x1e8f83=await this['composite'][_0x1ad2fb(0x1ad)](_0x309118);if(_0x594a6d){const _0x1670c4=(0x0,composite_utils_1[_0x1ad2fb(0x1e6)])(_0x1e8f83);for(const {id:_0x212c00,ref:_0x199528}of _0x1670c4){const _0x21e103=this[_0x1ad2fb(0x1e0)][_0x1ad2fb(0x1cb)](_0x2f89d2=>_0x2f89d2['reference']===_0x199528);_0x21e103&&(_0x21e103[_0x1ad2fb(0x1db)]=_0x212c00);}}},_0x43d17f=0x1e8480;let _0x41fc92=0x0,_0x597da9=[];for(const _0x28c0d8 of _0x167922){const _0x37d8e1=_0x28c0d8[_0x1a8abb(0x1ce)]((_0x580837,_0x1f77b2)=>{const _0x121bce=_0x1a8abb,_0x3b5821=JSON[_0x121bce(0x1d4)](_0x1f77b2)[_0x121bce(0x1a9)]*0x2;return _0x580837+_0x3b5821;},0x0);if(_0x37d8e1>constants_1[_0x1a8abb(0x1e2)])throw new salesforce_error_1[(_0x1a8abb(0x1e5))](_0x1a8abb(0x1b4)+constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']+'\x20COMPONENTS_SIZE\x20=\x20'+_0x37d8e1);_0x41fc92+_0x37d8e1>constants_1[_0x1a8abb(0x1e2)]-_0x43d17f&&(await _0x16b630(_0x597da9),_0x597da9=[],_0x41fc92=0x0),_0x41fc92+=_0x37d8e1,_0x597da9['push'](_0x28c0d8);}_0x597da9[_0x1a8abb(0x1a9)]&&await _0x16b630(_0x597da9);}async['proceedRequests'](_0xf208f7,_0x59cc5d=![]){const _0x24d3ed=a270_0x16a8e2,_0xb39b1e=(this[_0x24d3ed(0x1c6)]+ +_0x59cc5d)*0x3,_0xa71bfd=(0x0,utils_1[_0x24d3ed(0x1d5)])(_0xf208f7,_0xb39b1e);try{while(_0xa71bfd[_0x24d3ed(0x1a9)]){const _0x303d7d=_0xa71bfd[_0x24d3ed(0x1ac)](0x0,Math[_0x24d3ed(0x1e4)](constants_1[_0x24d3ed(0x1bf)]/_0xb39b1e));await this[_0x24d3ed(0x1b6)](_0x303d7d,_0x59cc5d);}}catch(_0x3a7cab){this[_0x24d3ed(0x1ee)][_0x24d3ed(0x1c1)](_0x3a7cab instanceof salesforce_error_1['SalesforceError']?JSON[_0x24d3ed(0x1d4)](_0x3a7cab['toJSON'](),null,0x2):_0x3a7cab),this[_0x24d3ed(0x1e8)]['log'](_0x3a7cab instanceof salesforce_error_1['SalesforceError']?JSON[_0x24d3ed(0x1d4)](_0x3a7cab['toJSON'](),null,0x2):_0x3a7cab[_0x24d3ed(0x1b9)]());throw _0x3a7cab;}}async[a270_0x16a8e2(0x1c0)](_0x1ee804){const _0x13d3d4=a270_0x16a8e2;for(const _0x29293c of _0x1ee804){if(!_0x29293c[_0x13d3d4(0x1e7)][_0x13d3d4(0x1a9)]&&!_0x29293c[_0x13d3d4(0x1dd)]['length']&&!_0x29293c['removed']['length'])continue;const _0x30c9ba=[],_0x575b59=[],_0x4a3bca=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x13d3d4(0x1d0)][_0x13d3d4(0x1c8)],this[_0x13d3d4(0x1d0)][_0x13d3d4(0x1c9)],_0x29293c['author'],this[_0x13d3d4(0x1d0)][_0x13d3d4(0x1b2)],this['proceededComponentsMeta']);_0x30c9ba[_0x13d3d4(0x1be)](...await _0x4a3bca[_0x13d3d4(0x1d1)](_0x29293c[_0x13d3d4(0x1e7)],this[_0x13d3d4(0x1d0)][_0x13d3d4(0x1d3)])),_0x30c9ba['push'](...await _0x4a3bca[_0x13d3d4(0x1e1)](_0x29293c[_0x13d3d4(0x1dd)],this[_0x13d3d4(0x1d0)][_0x13d3d4(0x1d3)])),_0x575b59[_0x13d3d4(0x1be)](await _0x4a3bca[_0x13d3d4(0x1ec)](_0x29293c[_0x13d3d4(0x1dc)],!![])),this['proceededComponentsMeta']=_0x4a3bca['getProceededComponentsMeta'](),await this[_0x13d3d4(0x1de)](_0x30c9ba,!![]);for(const _0x17559d of _0x575b59){_0x17559d[_0x13d3d4(0x1bc)][_0x13d3d4(0x1a9)]&&await this['proceedRequests'](_0x17559d[_0x13d3d4(0x1bc)],!![]),_0x17559d[_0x13d3d4(0x1d2)][_0x13d3d4(0x1a9)]&&await this[_0x13d3d4(0x1de)](_0x17559d[_0x13d3d4(0x1d2)],!![]),_0x17559d['componentsToDelete']['length']&&await this['proceedRequests'](_0x17559d['componentsToDelete'],!![]);}this[_0x13d3d4(0x1ee)][_0x13d3d4(0x1bb)](_0x13d3d4(0x1cf),_0x30c9ba[_0x13d3d4(0x1a9)]);}}async[a270_0x16a8e2(0x1d8)](_0x287021){const _0x4a82fd=a270_0x16a8e2,_0x1efdc7=[],_0x5bf36f=[];for(const _0x57169e of _0x287021){if(!_0x57169e[_0x4a82fd(0x1e7)]['length']&&!_0x57169e['modified'][_0x4a82fd(0x1a9)]&&!_0x57169e['removed'][_0x4a82fd(0x1a9)])continue;const _0x24c470=new salesforce_components_manager_service_1[(_0x4a82fd(0x1ca))](this[_0x4a82fd(0x1d0)][_0x4a82fd(0x1c8)],this[_0x4a82fd(0x1d0)][_0x4a82fd(0x1c9)],_0x57169e[_0x4a82fd(0x1bd)],this[_0x4a82fd(0x1d0)]['recordTypes'],[]);_0x1efdc7[_0x4a82fd(0x1be)](...await _0x24c470[_0x4a82fd(0x1d1)](_0x57169e[_0x4a82fd(0x1e7)])),_0x1efdc7['push'](...await _0x24c470['update'](_0x57169e['modified'])),_0x5bf36f[_0x4a82fd(0x1be)](await _0x24c470[_0x4a82fd(0x1ec)](_0x57169e[_0x4a82fd(0x1dc)]));}this[_0x4a82fd(0x1ee)][_0x4a82fd(0x1bb)](_0x4a82fd(0x1af),_0x1efdc7[_0x4a82fd(0x1a9)]),await this[_0x4a82fd(0x1de)](_0x1efdc7);const _0x522960=_0x5bf36f[_0x4a82fd(0x1ce)]((_0x5cadd6,_0x743f27)=>({'manifests':[..._0x5cadd6[_0x4a82fd(0x1bc)],..._0x743f27[_0x4a82fd(0x1bc)]],'componentsToDelete':[..._0x5cadd6[_0x4a82fd(0x1b8)],..._0x743f27[_0x4a82fd(0x1b8)]],'componentsToUpdate':[..._0x5cadd6[_0x4a82fd(0x1d2)],..._0x743f27[_0x4a82fd(0x1d2)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x522960['manifests'][_0x4a82fd(0x1a9)]&&await this['proceedRequests'](_0x522960[_0x4a82fd(0x1bc)],!![]),_0x522960[_0x4a82fd(0x1d2)][_0x4a82fd(0x1a9)]&&await this[_0x4a82fd(0x1de)](_0x522960[_0x4a82fd(0x1d2)],!![]),_0x522960[_0x4a82fd(0x1b8)]['length']&&await this[_0x4a82fd(0x1de)](_0x522960[_0x4a82fd(0x1b8)],!![]);}async['proceedCommits'](_0x2d5e8b){const _0x58af3f=a270_0x16a8e2;this[_0x58af3f(0x1d0)][_0x58af3f(0x1c9)]?await this[_0x58af3f(0x1d8)](_0x2d5e8b):await this[_0x58af3f(0x1c0)](_0x2d5e8b);}}exports[a270_0x16a8e2(0x1cc)]=SalesforceCommitsManager;