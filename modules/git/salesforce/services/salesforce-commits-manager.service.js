const a228_0x5be09e=a228_0x28fb;(function(_0xbcdaf2,_0x27c62e){const _0xf2aec3=a228_0x28fb,_0x5208ec=_0xbcdaf2();while(!![]){try{const _0x433b80=parseInt(_0xf2aec3(0x206))/0x1+-parseInt(_0xf2aec3(0x1e1))/0x2+parseInt(_0xf2aec3(0x1e9))/0x3*(-parseInt(_0xf2aec3(0x21b))/0x4)+-parseInt(_0xf2aec3(0x224))/0x5*(-parseInt(_0xf2aec3(0x218))/0x6)+parseInt(_0xf2aec3(0x1fe))/0x7*(-parseInt(_0xf2aec3(0x1e7))/0x8)+parseInt(_0xf2aec3(0x203))/0x9*(parseInt(_0xf2aec3(0x1fb))/0xa)+-parseInt(_0xf2aec3(0x1e4))/0xb*(-parseInt(_0xf2aec3(0x21e))/0xc);if(_0x433b80===_0x27c62e)break;else _0x5208ec['push'](_0x5208ec['shift']());}catch(_0xf6e295){_0x5208ec['push'](_0x5208ec['shift']());}}}(a228_0x2a19,0x65bca));const a228_0x39f022=(function(){let _0x107d50=!![];return function(_0x24a91a,_0xa455f1){const _0x3b51b7=_0x107d50?function(){const _0x1ee4a6=a228_0x28fb;if(_0xa455f1){const _0xd108fe=_0xa455f1[_0x1ee4a6(0x1e2)](_0x24a91a,arguments);return _0xa455f1=null,_0xd108fe;}}:function(){};return _0x107d50=![],_0x3b51b7;};}()),a228_0x2c4775=a228_0x39f022(this,function(){const _0x238774=a228_0x28fb;return a228_0x2c4775[_0x238774(0x1ea)]()['search'](_0x238774(0x20b))[_0x238774(0x1ea)]()[_0x238774(0x1ed)](a228_0x2c4775)[_0x238774(0x21c)](_0x238774(0x20b));});a228_0x2c4775();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3d8952){return _0x3d8952&&_0x3d8952['__esModule']?_0x3d8952:{'default':_0x3d8952};};function a228_0x28fb(_0x4b623,_0x5a76d3){const _0x253f96=a228_0x2a19();return a228_0x28fb=function(_0x2c4775,_0x39f022){_0x2c4775=_0x2c4775-0x1de;let _0x2a196a=_0x253f96[_0x2c4775];return _0x2a196a;},a228_0x28fb(_0x4b623,_0x5a76d3);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['SalesforceCommitsManager']=void 0x0;function a228_0x2a19(){const _0x4c33dc=['sfLogger','author','SalesforceComponentsManager','SALESFORCE_MAX_REQUEST_SIZE_BYTES','5BZgJph','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','../../../../constants','get','1285338TUukuR','apply','\x20COMPONENTS_SIZE\x20=\x20','191928Shuzbw','componentsToDelete','delete','8voRGeK','composite','3GXJZwi','toString','proceedCommitsToRepository','reduce','constructor','update','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','proceedCommitsToBranch','log','proceedChunksToUpload','../../../../core','removed','proceededComponentsMeta','\x20requests\x20to\x20composite\x20api.','stringify','SalesforceError','../utils/composite.utils','length','230OFTTyT','map','../errors/salesforce.error','610981mTjEaB','toJSON','COMPONENTS_PER_CHUNK','getProceededComponentsMeta','modified','49059zbEuJj','graph','error','416607gEipoB','commitId','insert','SalesforceCommitsManager','options','(((.+)+)+)+$','repositoryId','recordTypes','inserted','branchId','splice','extractComponentIdsFromGraphsResponse','Sending\x20','Logger','chunkArray','logger','componentsToUpdate','default','2384934PSXwhE','push','typedi','706636yVgfXL','search','manifests','264JIwHbx','proceedRequests'];a228_0x2a19=function(){return _0x4c33dc;};return a228_0x2a19();}const core_1=require(a228_0x5be09e(0x1f3)),typedi_1=__importDefault(require(a228_0x5be09e(0x21a))),constants_1=require(a228_0x5be09e(0x1df)),utils_1=require('../../../shared/utils'),salesforce_error_1=require(a228_0x5be09e(0x1fd)),composite_utils_1=require(a228_0x5be09e(0x1f9)),salesforce_components_manager_service_1=require('./salesforce-components-manager.service'),salesforce_composite_service_1=require('./salesforce-composite.service');class SalesforceCommitsManager{constructor(_0x545b2c){const _0x798134=a228_0x5be09e;this[_0x798134(0x20a)]=_0x545b2c,this[_0x798134(0x200)]=0x3,this[_0x798134(0x215)]=new core_1[(_0x798134(0x213))](SalesforceCommitsManager['name']),this[_0x798134(0x220)]=this['options']['logger'],this[_0x798134(0x1e8)]=typedi_1[_0x798134(0x217)][_0x798134(0x1e0)](salesforce_composite_service_1['SalesforceCompositeService']),this['proceededComponentsMeta']=[];}async[a228_0x5be09e(0x1f2)](_0x100c34,_0x147c9e=![]){const _0x2d42ce=a228_0x5be09e,_0x338785=async _0x28c542=>{const _0x5443de=a228_0x28fb;await this[_0x5443de(0x215)][_0x5443de(0x1f1)](_0x5443de(0x212)+_0x28c542[_0x5443de(0x1ec)]((_0x3866d6,_0x357fbc)=>_0x3866d6+_0x357fbc['length'],0x0)+_0x5443de(0x1f6));const _0x46231c=_0x28c542[_0x5443de(0x1fc)]((_0x412e0d,_0x45c165)=>({'graphId':_0x5443de(0x204)+_0x45c165,'compositeRequest':_0x412e0d})),_0x200e98=await this['composite']['executeGraphs'](_0x46231c);if(_0x147c9e){const _0x209bdb=(0x0,composite_utils_1[_0x5443de(0x211)])(_0x200e98);for(const {id:_0x5176d2,ref:_0x4d273e}of _0x209bdb){const _0x3df94d=this[_0x5443de(0x1f5)]['find'](_0x22a234=>_0x22a234['reference']===_0x4d273e);_0x3df94d&&(_0x3df94d['componentId']=_0x5176d2);}}},_0x554ded=0x1e8480;let _0x31652b=0x0,_0x480423=[];for(const _0x1eec41 of _0x100c34){const _0x34be53=_0x1eec41[_0x2d42ce(0x1ec)]((_0x11f8df,_0x40de69)=>{const _0x388cea=_0x2d42ce,_0x3c0b46=JSON[_0x388cea(0x1f7)](_0x40de69)[_0x388cea(0x1fa)]*0x2;return _0x11f8df+_0x3c0b46;},0x0);if(_0x34be53>constants_1[_0x2d42ce(0x223)])throw new salesforce_error_1[(_0x2d42ce(0x1f8))](_0x2d42ce(0x1ef)+constants_1[_0x2d42ce(0x223)]+_0x2d42ce(0x1e3)+_0x34be53);_0x31652b+_0x34be53>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']-_0x554ded&&(await _0x338785(_0x480423),_0x480423=[],_0x31652b=0x0),_0x31652b+=_0x34be53,_0x480423[_0x2d42ce(0x219)](_0x1eec41);}_0x480423[_0x2d42ce(0x1fa)]&&await _0x338785(_0x480423);}async['proceedRequests'](_0x3f34f4,_0x489a1b=![]){const _0x1ce881=a228_0x5be09e,_0x17366b=(this[_0x1ce881(0x200)]+ +_0x489a1b)*0x3,_0xe0afcb=(0x0,utils_1[_0x1ce881(0x214)])(_0x3f34f4,_0x17366b);try{while(_0xe0afcb['length']){const _0x181f63=_0xe0afcb[_0x1ce881(0x210)](0x0,Math['floor'](constants_1[_0x1ce881(0x225)]/_0x17366b));await this[_0x1ce881(0x1f2)](_0x181f63,_0x489a1b);}}catch(_0x17d8f1){this[_0x1ce881(0x215)][_0x1ce881(0x205)](_0x17d8f1 instanceof salesforce_error_1[_0x1ce881(0x1f8)]?JSON[_0x1ce881(0x1f7)](_0x17d8f1[_0x1ce881(0x1ff)](),null,0x2):_0x17d8f1),this[_0x1ce881(0x220)][_0x1ce881(0x1f1)](_0x17d8f1 instanceof salesforce_error_1[_0x1ce881(0x1f8)]?JSON[_0x1ce881(0x1f7)](_0x17d8f1[_0x1ce881(0x1ff)](),null,0x2):_0x17d8f1['toString']());throw _0x17d8f1;}}async[a228_0x5be09e(0x1eb)](_0x23cacc){const _0x5858df=a228_0x5be09e;for(const _0x55522f of _0x23cacc){if(!_0x55522f[_0x5858df(0x20e)][_0x5858df(0x1fa)]&&!_0x55522f[_0x5858df(0x202)][_0x5858df(0x1fa)]&&!_0x55522f[_0x5858df(0x1f4)][_0x5858df(0x1fa)])continue;const _0x330f16=[],_0x358c9a=[],_0x57c0dd=new salesforce_components_manager_service_1[(_0x5858df(0x222))](this[_0x5858df(0x20a)][_0x5858df(0x20c)],this[_0x5858df(0x20a)]['branchId'],_0x55522f['author'],this[_0x5858df(0x20a)][_0x5858df(0x20d)],this[_0x5858df(0x1f5)]);_0x330f16[_0x5858df(0x219)](...await _0x57c0dd['insert'](_0x55522f[_0x5858df(0x20e)],this[_0x5858df(0x20a)][_0x5858df(0x207)])),_0x330f16[_0x5858df(0x219)](...await _0x57c0dd[_0x5858df(0x1ee)](_0x55522f['modified'],this[_0x5858df(0x20a)][_0x5858df(0x207)])),_0x358c9a['push'](await _0x57c0dd['delete'](_0x55522f[_0x5858df(0x1f4)],!![])),this[_0x5858df(0x1f5)]=_0x57c0dd[_0x5858df(0x201)](),await this[_0x5858df(0x21f)](_0x330f16,!![]);for(const _0x3e0b1c of _0x358c9a){_0x3e0b1c[_0x5858df(0x21d)][_0x5858df(0x1fa)]&&await this[_0x5858df(0x21f)](_0x3e0b1c[_0x5858df(0x21d)],!![]),_0x3e0b1c[_0x5858df(0x216)][_0x5858df(0x1fa)]&&await this['proceedRequests'](_0x3e0b1c[_0x5858df(0x216)],!![]),_0x3e0b1c[_0x5858df(0x1e5)][_0x5858df(0x1fa)]&&await this[_0x5858df(0x21f)](_0x3e0b1c[_0x5858df(0x1e5)],!![]);}this[_0x5858df(0x215)][_0x5858df(0x1f1)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x330f16[_0x5858df(0x1fa)]);}}async[a228_0x5be09e(0x1f0)](_0x5dff36){const _0x3e7d07=a228_0x5be09e,_0x2f3875=[],_0x4cca00=[];for(const _0x50dd7e of _0x5dff36){if(!_0x50dd7e[_0x3e7d07(0x20e)][_0x3e7d07(0x1fa)]&&!_0x50dd7e[_0x3e7d07(0x202)][_0x3e7d07(0x1fa)]&&!_0x50dd7e[_0x3e7d07(0x1f4)][_0x3e7d07(0x1fa)])continue;const _0x5f5815=new salesforce_components_manager_service_1[(_0x3e7d07(0x222))](this[_0x3e7d07(0x20a)][_0x3e7d07(0x20c)],this[_0x3e7d07(0x20a)][_0x3e7d07(0x20f)],_0x50dd7e[_0x3e7d07(0x221)],this[_0x3e7d07(0x20a)]['recordTypes'],[]);_0x2f3875[_0x3e7d07(0x219)](...await _0x5f5815[_0x3e7d07(0x208)](_0x50dd7e[_0x3e7d07(0x20e)])),_0x2f3875[_0x3e7d07(0x219)](...await _0x5f5815[_0x3e7d07(0x1ee)](_0x50dd7e[_0x3e7d07(0x202)])),_0x4cca00[_0x3e7d07(0x219)](await _0x5f5815[_0x3e7d07(0x1e6)](_0x50dd7e[_0x3e7d07(0x1f4)]));}this['logger'][_0x3e7d07(0x1f1)](_0x3e7d07(0x1de),_0x2f3875[_0x3e7d07(0x1fa)]),await this[_0x3e7d07(0x21f)](_0x2f3875);const _0x406b5b=_0x4cca00[_0x3e7d07(0x1ec)]((_0x4e76af,_0x2c0a4a)=>({'manifests':[..._0x4e76af['manifests'],..._0x2c0a4a[_0x3e7d07(0x21d)]],'componentsToDelete':[..._0x4e76af['componentsToDelete'],..._0x2c0a4a[_0x3e7d07(0x1e5)]],'componentsToUpdate':[..._0x4e76af[_0x3e7d07(0x216)],..._0x2c0a4a['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x406b5b[_0x3e7d07(0x21d)]['length']&&await this['proceedRequests'](_0x406b5b[_0x3e7d07(0x21d)],!![]),_0x406b5b[_0x3e7d07(0x216)][_0x3e7d07(0x1fa)]&&await this[_0x3e7d07(0x21f)](_0x406b5b['componentsToUpdate'],!![]),_0x406b5b[_0x3e7d07(0x1e5)][_0x3e7d07(0x1fa)]&&await this[_0x3e7d07(0x21f)](_0x406b5b[_0x3e7d07(0x1e5)],!![]);}async['proceedCommits'](_0x5a43c){const _0x53c005=a228_0x5be09e;this[_0x53c005(0x20a)]['branchId']?await this[_0x53c005(0x1f0)](_0x5a43c):await this[_0x53c005(0x1eb)](_0x5a43c);}}exports[a228_0x5be09e(0x209)]=SalesforceCommitsManager;