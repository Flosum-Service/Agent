const a227_0x301bf6=a227_0x30d5;(function(_0x37ef0e,_0x1e1eec){const _0x17f1ce=a227_0x30d5,_0x29fc81=_0x37ef0e();while(!![]){try{const _0x4f7fc0=-parseInt(_0x17f1ce(0x200))/0x1*(parseInt(_0x17f1ce(0x201))/0x2)+-parseInt(_0x17f1ce(0x1f1))/0x3+parseInt(_0x17f1ce(0x20c))/0x4*(-parseInt(_0x17f1ce(0x20e))/0x5)+parseInt(_0x17f1ce(0x1f5))/0x6*(-parseInt(_0x17f1ce(0x1fa))/0x7)+parseInt(_0x17f1ce(0x211))/0x8*(-parseInt(_0x17f1ce(0x203))/0x9)+parseInt(_0x17f1ce(0x1fc))/0xa+parseInt(_0x17f1ce(0x1d3))/0xb;if(_0x4f7fc0===_0x1e1eec)break;else _0x29fc81['push'](_0x29fc81['shift']());}catch(_0x5c1b21){_0x29fc81['push'](_0x29fc81['shift']());}}}(a227_0x2593,0x9e041));const a227_0x28fc22=(function(){let _0x27c584=!![];return function(_0x524702,_0x32624a){const _0x486b1=_0x27c584?function(){const _0x6a0f73=a227_0x30d5;if(_0x32624a){const _0x2cdfb9=_0x32624a[_0x6a0f73(0x1e4)](_0x524702,arguments);return _0x32624a=null,_0x2cdfb9;}}:function(){};return _0x27c584=![],_0x486b1;};}()),a227_0x3ee84a=a227_0x28fc22(this,function(){const _0x360316=a227_0x30d5;return a227_0x3ee84a[_0x360316(0x1e5)]()[_0x360316(0x209)]('(((.+)+)+)+$')[_0x360316(0x1e5)]()[_0x360316(0x1d0)](a227_0x3ee84a)[_0x360316(0x209)](_0x360316(0x1f0));});function a227_0x30d5(_0x5b5b6b,_0x81f903){const _0x2c8e3e=a227_0x2593();return a227_0x30d5=function(_0x3ee84a,_0x28fc22){_0x3ee84a=_0x3ee84a-0x1cf;let _0x259336=_0x2c8e3e[_0x3ee84a];return _0x259336;},a227_0x30d5(_0x5b5b6b,_0x81f903);}a227_0x3ee84a();'use strict';function a227_0x2593(){const _0x3bbe30=['length','map','toJSON','componentId','extractComponentIdsFromGraphsResponse','delete','get','push','splice','(((.+)+)+)+$','3303711qOMmja','manifests','Sending\x20','__esModule','414VRFaYi','proceedCommitsToRepository','find','floor','proceedRequests','30170XbqLWb','proceededComponentsMeta','11765130jlfwCk','logger','recordTypes','typedi','2PvbARl','1004282sFXIJv','SalesforceError','963fzMljr','reference','commitId','COMPONENTS_PER_CHUNK','componentsToDelete','../errors/salesforce.error','search','inserted','SalesforceCommitsManager','187256VLToHu','repositoryId','25WdTYjy','default','../../../shared/utils','3280lLpfEb','update','modified','proceedCommitsToBranch','branchId','./salesforce-components-manager.service','constructor','getProceededComponentsMeta','proceedCommits','23667259xFckWT','options','\x20requests\x20to\x20composite\x20api.','removed','SALESFORCE_MAX_REQUEST_SIZE_BYTES','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','componentsToUpdate','reduce','../../../../core','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','composite','proceedChunksToUpload','stringify','log','../utils/composite.utils','sfLogger','SalesforceComponentsManager','apply','toString','error'];a227_0x2593=function(){return _0x3bbe30;};return a227_0x2593();}var __importDefault=this&&this['__importDefault']||function(_0x26cdb5){return _0x26cdb5&&_0x26cdb5['__esModule']?_0x26cdb5:{'default':_0x26cdb5};};Object['defineProperty'](exports,a227_0x301bf6(0x1f4),{'value':!![]}),exports[a227_0x301bf6(0x20b)]=void 0x0;const core_1=require(a227_0x301bf6(0x1db)),typedi_1=__importDefault(require(a227_0x301bf6(0x1ff))),constants_1=require('../../../../constants'),utils_1=require(a227_0x301bf6(0x210)),salesforce_error_1=require(a227_0x301bf6(0x208)),composite_utils_1=require(a227_0x301bf6(0x1e1)),salesforce_components_manager_service_1=require(a227_0x301bf6(0x1cf)),salesforce_composite_service_1=require('./salesforce-composite.service');class SalesforceCommitsManager{constructor(_0x41bd24){const _0x17e0da=a227_0x301bf6;this[_0x17e0da(0x1d4)]=_0x41bd24,this[_0x17e0da(0x206)]=0x3,this['logger']=new core_1['Logger'](SalesforceCommitsManager['name']),this[_0x17e0da(0x1e2)]=this[_0x17e0da(0x1d4)][_0x17e0da(0x1fd)],this[_0x17e0da(0x1dd)]=typedi_1[_0x17e0da(0x20f)][_0x17e0da(0x1ed)](salesforce_composite_service_1['SalesforceCompositeService']),this[_0x17e0da(0x1fb)]=[];}async['proceedChunksToUpload'](_0x498700,_0x4ec562=![]){const _0x178477=a227_0x301bf6,_0xcb41c4=async _0x4a8d58=>{const _0x539ad4=a227_0x30d5;await this[_0x539ad4(0x1fd)][_0x539ad4(0x1e0)](_0x539ad4(0x1f3)+_0x4a8d58[_0x539ad4(0x1da)]((_0x25b33f,_0x1f6cbb)=>_0x25b33f+_0x1f6cbb[_0x539ad4(0x1e7)],0x0)+_0x539ad4(0x1d5));const _0x246e5a=_0x4a8d58[_0x539ad4(0x1e8)]((_0x267cde,_0x2ce9e5)=>({'graphId':'graph'+_0x2ce9e5,'compositeRequest':_0x267cde})),_0x12ed8b=await this[_0x539ad4(0x1dd)]['executeGraphs'](_0x246e5a);if(_0x4ec562){const _0x50075c=(0x0,composite_utils_1[_0x539ad4(0x1eb)])(_0x12ed8b);for(const {id:_0x22a6a9,ref:_0x2e1e08}of _0x50075c){const _0x188fe7=this[_0x539ad4(0x1fb)][_0x539ad4(0x1f7)](_0x41dde0=>_0x41dde0[_0x539ad4(0x204)]===_0x2e1e08);_0x188fe7&&(_0x188fe7[_0x539ad4(0x1ea)]=_0x22a6a9);}}},_0x85ff14=0x1e8480;let _0x53115d=0x0,_0x39373a=[];for(const _0x1a6c9c of _0x498700){const _0x2b9424=_0x1a6c9c[_0x178477(0x1da)]((_0x1946c0,_0x513d01)=>{const _0x5b4961=_0x178477,_0x2bbc87=JSON[_0x5b4961(0x1df)](_0x513d01)[_0x5b4961(0x1e7)]*0x2;return _0x1946c0+_0x2bbc87;},0x0);if(_0x2b9424>constants_1[_0x178477(0x1d7)])throw new salesforce_error_1[(_0x178477(0x202))](_0x178477(0x1dc)+constants_1[_0x178477(0x1d7)]+'\x20COMPONENTS_SIZE\x20=\x20'+_0x2b9424);_0x53115d+_0x2b9424>constants_1[_0x178477(0x1d7)]-_0x85ff14&&(await _0xcb41c4(_0x39373a),_0x39373a=[],_0x53115d=0x0),_0x53115d+=_0x2b9424,_0x39373a[_0x178477(0x1ee)](_0x1a6c9c);}_0x39373a[_0x178477(0x1e7)]&&await _0xcb41c4(_0x39373a);}async['proceedRequests'](_0x4c6ee9,_0x43f9c9=![]){const _0x4f24b2=a227_0x301bf6,_0x3754d2=(this['COMPONENTS_PER_CHUNK']+ +_0x43f9c9)*0x3,_0x3066b3=(0x0,utils_1['chunkArray'])(_0x4c6ee9,_0x3754d2);try{while(_0x3066b3[_0x4f24b2(0x1e7)]){const _0x4caef3=_0x3066b3[_0x4f24b2(0x1ef)](0x0,Math[_0x4f24b2(0x1f8)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x3754d2));await this[_0x4f24b2(0x1de)](_0x4caef3,_0x43f9c9);}}catch(_0xf382f5){this[_0x4f24b2(0x1fd)][_0x4f24b2(0x1e6)](_0xf382f5 instanceof salesforce_error_1[_0x4f24b2(0x202)]?JSON['stringify'](_0xf382f5[_0x4f24b2(0x1e9)](),null,0x2):_0xf382f5),this[_0x4f24b2(0x1e2)][_0x4f24b2(0x1e0)](_0xf382f5 instanceof salesforce_error_1[_0x4f24b2(0x202)]?JSON[_0x4f24b2(0x1df)](_0xf382f5[_0x4f24b2(0x1e9)](),null,0x2):_0xf382f5[_0x4f24b2(0x1e5)]());throw _0xf382f5;}}async[a227_0x301bf6(0x1f6)](_0x20e2e2){const _0x1f5f2e=a227_0x301bf6;for(const _0x57f0e3 of _0x20e2e2){if(!_0x57f0e3['inserted'][_0x1f5f2e(0x1e7)]&&!_0x57f0e3['modified'][_0x1f5f2e(0x1e7)]&&!_0x57f0e3[_0x1f5f2e(0x1d6)][_0x1f5f2e(0x1e7)])continue;const _0x4996e5=[],_0x9b0aa6=[],_0x34dfdf=new salesforce_components_manager_service_1[(_0x1f5f2e(0x1e3))](this[_0x1f5f2e(0x1d4)][_0x1f5f2e(0x20d)],this['options'][_0x1f5f2e(0x215)],_0x57f0e3['author'],this[_0x1f5f2e(0x1d4)][_0x1f5f2e(0x1fe)],this['proceededComponentsMeta']);_0x4996e5['push'](...await _0x34dfdf['insert'](_0x57f0e3[_0x1f5f2e(0x20a)],this['options'][_0x1f5f2e(0x205)])),_0x4996e5['push'](...await _0x34dfdf['update'](_0x57f0e3[_0x1f5f2e(0x213)],this[_0x1f5f2e(0x1d4)][_0x1f5f2e(0x205)])),_0x9b0aa6[_0x1f5f2e(0x1ee)](await _0x34dfdf['delete'](_0x57f0e3['removed'],!![])),this[_0x1f5f2e(0x1fb)]=_0x34dfdf[_0x1f5f2e(0x1d1)](),await this['proceedRequests'](_0x4996e5,!![]);for(const _0xd7c334 of _0x9b0aa6){_0xd7c334[_0x1f5f2e(0x1f2)][_0x1f5f2e(0x1e7)]&&await this[_0x1f5f2e(0x1f9)](_0xd7c334[_0x1f5f2e(0x1f2)],!![]),_0xd7c334[_0x1f5f2e(0x1d9)][_0x1f5f2e(0x1e7)]&&await this[_0x1f5f2e(0x1f9)](_0xd7c334['componentsToUpdate'],!![]),_0xd7c334[_0x1f5f2e(0x207)][_0x1f5f2e(0x1e7)]&&await this['proceedRequests'](_0xd7c334['componentsToDelete'],!![]);}this[_0x1f5f2e(0x1fd)]['log']('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x4996e5[_0x1f5f2e(0x1e7)]);}}async[a227_0x301bf6(0x214)](_0x4445d0){const _0xf063ec=a227_0x301bf6,_0x3746d8=[],_0x4f1a58=[];for(const _0x159b74 of _0x4445d0){if(!_0x159b74[_0xf063ec(0x20a)]['length']&&!_0x159b74['modified']['length']&&!_0x159b74[_0xf063ec(0x1d6)]['length'])continue;const _0x7e419=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0xf063ec(0x1d4)][_0xf063ec(0x20d)],this[_0xf063ec(0x1d4)]['branchId'],_0x159b74['author'],this[_0xf063ec(0x1d4)]['recordTypes'],[]);_0x3746d8[_0xf063ec(0x1ee)](...await _0x7e419['insert'](_0x159b74[_0xf063ec(0x20a)])),_0x3746d8[_0xf063ec(0x1ee)](...await _0x7e419[_0xf063ec(0x212)](_0x159b74[_0xf063ec(0x213)])),_0x4f1a58['push'](await _0x7e419[_0xf063ec(0x1ec)](_0x159b74[_0xf063ec(0x1d6)]));}this[_0xf063ec(0x1fd)][_0xf063ec(0x1e0)](_0xf063ec(0x1d8),_0x3746d8[_0xf063ec(0x1e7)]),await this[_0xf063ec(0x1f9)](_0x3746d8);const _0x1e1b4b=_0x4f1a58['reduce']((_0x156ff2,_0x121217)=>({'manifests':[..._0x156ff2['manifests'],..._0x121217[_0xf063ec(0x1f2)]],'componentsToDelete':[..._0x156ff2['componentsToDelete'],..._0x121217['componentsToDelete']],'componentsToUpdate':[..._0x156ff2[_0xf063ec(0x1d9)],..._0x121217[_0xf063ec(0x1d9)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x1e1b4b['manifests'][_0xf063ec(0x1e7)]&&await this[_0xf063ec(0x1f9)](_0x1e1b4b[_0xf063ec(0x1f2)],!![]),_0x1e1b4b[_0xf063ec(0x1d9)]['length']&&await this['proceedRequests'](_0x1e1b4b[_0xf063ec(0x1d9)],!![]),_0x1e1b4b[_0xf063ec(0x207)]['length']&&await this['proceedRequests'](_0x1e1b4b[_0xf063ec(0x207)],!![]);}async[a227_0x301bf6(0x1d2)](_0x39699c){const _0x22af32=a227_0x301bf6;this[_0x22af32(0x1d4)][_0x22af32(0x215)]?await this[_0x22af32(0x214)](_0x39699c):await this[_0x22af32(0x1f6)](_0x39699c);}}exports[a227_0x301bf6(0x20b)]=SalesforceCommitsManager;