const a227_0x3f2b7d=a227_0x1849;(function(_0x5eedec,_0x293df3){const _0x487c00=a227_0x1849,_0x569073=_0x5eedec();while(!![]){try{const _0x32f916=parseInt(_0x487c00(0xf7))/0x1+-parseInt(_0x487c00(0xf5))/0x2+parseInt(_0x487c00(0x11e))/0x3*(parseInt(_0x487c00(0x10a))/0x4)+parseInt(_0x487c00(0xde))/0x5*(-parseInt(_0x487c00(0x10c))/0x6)+-parseInt(_0x487c00(0xed))/0x7+parseInt(_0x487c00(0xea))/0x8*(parseInt(_0x487c00(0x123))/0x9)+-parseInt(_0x487c00(0xf2))/0xa;if(_0x32f916===_0x293df3)break;else _0x569073['push'](_0x569073['shift']());}catch(_0x309166){_0x569073['push'](_0x569073['shift']());}}}(a227_0xdf5c,0xe67df));const a227_0x59c278=(function(){let _0x2ebc2d=!![];return function(_0x5f3024,_0x257682){const _0x262ba6=_0x2ebc2d?function(){const _0x26c389=a227_0x1849;if(_0x257682){const _0x162739=_0x257682[_0x26c389(0xe9)](_0x5f3024,arguments);return _0x257682=null,_0x162739;}}:function(){};return _0x2ebc2d=![],_0x262ba6;};}()),a227_0x1d7714=a227_0x59c278(this,function(){const _0xff8260=a227_0x1849;return a227_0x1d7714[_0xff8260(0x118)]()[_0xff8260(0x116)](_0xff8260(0x10b))['toString']()[_0xff8260(0x11c)](a227_0x1d7714)[_0xff8260(0x116)]('(((.+)+)+)+$');});a227_0x1d7714();'use strict';var __importDefault=this&&this[a227_0x3f2b7d(0xec)]||function(_0x2e9fd1){const _0x2c9da0=a227_0x3f2b7d;return _0x2e9fd1&&_0x2e9fd1[_0x2c9da0(0xe7)]?_0x2e9fd1:{'default':_0x2e9fd1};};Object[a227_0x3f2b7d(0xfa)](exports,a227_0x3f2b7d(0xe7),{'value':!![]}),exports[a227_0x3f2b7d(0xe5)]=void 0x0;const core_1=require(a227_0x3f2b7d(0xf6)),typedi_1=__importDefault(require(a227_0x3f2b7d(0xe0))),constants_1=require(a227_0x3f2b7d(0xe6)),utils_1=require(a227_0x3f2b7d(0x108)),salesforce_error_1=require(a227_0x3f2b7d(0xf9)),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require(a227_0x3f2b7d(0x112)),salesforce_composite_service_1=require(a227_0x3f2b7d(0x11f));class SalesforceCommitsManager{constructor(_0x167804){const _0x5e846b=a227_0x3f2b7d;this[_0x5e846b(0x114)]=_0x167804,this[_0x5e846b(0xeb)]=0x3,this[_0x5e846b(0xf0)]=new core_1[(_0x5e846b(0x10d))](SalesforceCommitsManager[_0x5e846b(0x121)]),this['sfLogger']=this[_0x5e846b(0x114)][_0x5e846b(0xf0)],this[_0x5e846b(0x117)]=typedi_1['default'][_0x5e846b(0xf3)](salesforce_composite_service_1['SalesforceCompositeService']),this['proceededComponentsMeta']=[];}async['proceedChunksToUpload'](_0x329f4f,_0x3db69e=![]){const _0x42f977=a227_0x3f2b7d,_0x3fddc6=async _0x161092=>{const _0x51fe76=a227_0x1849;await this[_0x51fe76(0xf0)]['log'](_0x51fe76(0xff)+_0x161092[_0x51fe76(0xf8)]((_0x564c29,_0x2e49ab)=>_0x564c29+_0x2e49ab['length'],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0xf8ab=_0x161092['map']((_0x3b369e,_0x19afd8)=>({'graphId':'graph'+_0x19afd8,'compositeRequest':_0x3b369e})),_0x2c838d=await this[_0x51fe76(0x117)][_0x51fe76(0x11d)](_0xf8ab);if(_0x3db69e){const _0x11a651=(0x0,composite_utils_1['extractComponentIdsFromGraphsResponse'])(_0x2c838d);for(const {id:_0x4fb272,ref:_0xd5dae0}of _0x11a651){const _0x10f102=this['proceededComponentsMeta'][_0x51fe76(0x107)](_0x52af6f=>_0x52af6f[_0x51fe76(0x10f)]===_0xd5dae0);_0x10f102&&(_0x10f102['componentId']=_0x4fb272);}}},_0x38cd27=0x1e8480;let _0x3018de=0x0,_0x41d5a1=[];for(const _0x1b4176 of _0x329f4f){const _0x1a31cb=_0x1b4176[_0x42f977(0xf8)]((_0x3d8414,_0x1dc7b9)=>{const _0x5bc1b9=_0x42f977,_0x1acfcd=JSON['stringify'](_0x1dc7b9)[_0x5bc1b9(0x104)]*0x2;return _0x3d8414+_0x1acfcd;},0x0);if(_0x1a31cb>constants_1[_0x42f977(0xfb)])throw new salesforce_error_1[(_0x42f977(0x105))](_0x42f977(0x11a)+constants_1[_0x42f977(0xfb)]+'\x20COMPONENTS_SIZE\x20=\x20'+_0x1a31cb);_0x3018de+_0x1a31cb>constants_1[_0x42f977(0xfb)]-_0x38cd27&&(await _0x3fddc6(_0x41d5a1),_0x41d5a1=[],_0x3018de=0x0),_0x3018de+=_0x1a31cb,_0x41d5a1['push'](_0x1b4176);}_0x41d5a1[_0x42f977(0x104)]&&await _0x3fddc6(_0x41d5a1);}async[a227_0x3f2b7d(0xdf)](_0xb2c455,_0xe0cfc1=![]){const _0x1f8695=a227_0x3f2b7d,_0x3c0097=(this['COMPONENTS_PER_CHUNK']+ +_0xe0cfc1)*0x3,_0x5a44ea=(0x0,utils_1[_0x1f8695(0xdd)])(_0xb2c455,_0x3c0097);try{while(_0x5a44ea[_0x1f8695(0x104)]){const _0x31c5ce=_0x5a44ea['splice'](0x0,Math['floor'](constants_1[_0x1f8695(0x109)]/_0x3c0097));await this['proceedChunksToUpload'](_0x31c5ce,_0xe0cfc1);}}catch(_0x5cf94e){this[_0x1f8695(0xf0)][_0x1f8695(0xef)](_0x5cf94e instanceof salesforce_error_1[_0x1f8695(0x105)]?JSON['stringify'](_0x5cf94e[_0x1f8695(0x106)](),null,0x2):_0x5cf94e),this[_0x1f8695(0x103)][_0x1f8695(0xe8)](_0x5cf94e instanceof salesforce_error_1[_0x1f8695(0x105)]?JSON['stringify'](_0x5cf94e[_0x1f8695(0x106)](),null,0x2):_0x5cf94e[_0x1f8695(0x118)]());throw _0x5cf94e;}}async['proceedCommitsToRepository'](_0x3e7349){const _0x53b6bf=a227_0x3f2b7d;for(const _0x5e849f of _0x3e7349){if(!_0x5e849f[_0x53b6bf(0x10e)][_0x53b6bf(0x104)]&&!_0x5e849f[_0x53b6bf(0x11b)][_0x53b6bf(0x104)]&&!_0x5e849f[_0x53b6bf(0xe1)][_0x53b6bf(0x104)])continue;const _0x21c19a=[],_0x436b47=[],_0x5e5f31=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x53b6bf(0x114)][_0x53b6bf(0x113)],this[_0x53b6bf(0x114)]['branchId'],_0x5e849f[_0x53b6bf(0xfc)],this[_0x53b6bf(0x114)]['recordTypes'],this['proceededComponentsMeta']);_0x21c19a['push'](...await _0x5e5f31['insert'](_0x5e849f[_0x53b6bf(0x10e)],this[_0x53b6bf(0x114)][_0x53b6bf(0xe4)])),_0x21c19a[_0x53b6bf(0xfd)](...await _0x5e5f31['update'](_0x5e849f[_0x53b6bf(0x11b)],this[_0x53b6bf(0x114)][_0x53b6bf(0xe4)])),_0x436b47['push'](await _0x5e5f31[_0x53b6bf(0xf1)](_0x5e849f[_0x53b6bf(0xe1)],!![])),this[_0x53b6bf(0x115)]=_0x5e5f31[_0x53b6bf(0xe3)](),await this[_0x53b6bf(0xdf)](_0x21c19a,!![]);for(const _0x257a58 of _0x436b47){_0x257a58[_0x53b6bf(0x101)][_0x53b6bf(0x104)]&&await this[_0x53b6bf(0xdf)](_0x257a58[_0x53b6bf(0x101)],!![]),_0x257a58['componentsToUpdate'][_0x53b6bf(0x104)]&&await this[_0x53b6bf(0xdf)](_0x257a58[_0x53b6bf(0xfe)],!![]),_0x257a58[_0x53b6bf(0xee)]['length']&&await this['proceedRequests'](_0x257a58[_0x53b6bf(0xee)],!![]);}this[_0x53b6bf(0xf0)]['log'](_0x53b6bf(0x122),_0x21c19a[_0x53b6bf(0x104)]);}}async[a227_0x3f2b7d(0x119)](_0x1a421a){const _0x414dc0=a227_0x3f2b7d,_0x27eb61=[],_0x356490=[];for(const _0xe61f48 of _0x1a421a){if(!_0xe61f48[_0x414dc0(0x10e)][_0x414dc0(0x104)]&&!_0xe61f48[_0x414dc0(0x11b)][_0x414dc0(0x104)]&&!_0xe61f48[_0x414dc0(0xe1)]['length'])continue;const _0x35dcf2=new salesforce_components_manager_service_1[(_0x414dc0(0x100))](this['options'][_0x414dc0(0x113)],this[_0x414dc0(0x114)][_0x414dc0(0x110)],_0xe61f48[_0x414dc0(0xfc)],this[_0x414dc0(0x114)][_0x414dc0(0x102)],[]);_0x27eb61[_0x414dc0(0xfd)](...await _0x35dcf2[_0x414dc0(0x111)](_0xe61f48[_0x414dc0(0x10e)])),_0x27eb61[_0x414dc0(0xfd)](...await _0x35dcf2['update'](_0xe61f48['modified'])),_0x356490['push'](await _0x35dcf2['delete'](_0xe61f48['removed']));}this['logger'][_0x414dc0(0xe8)](_0x414dc0(0xf4),_0x27eb61['length']),await this['proceedRequests'](_0x27eb61);const _0x5c185f=_0x356490[_0x414dc0(0xf8)]((_0x1b888d,_0x296c87)=>({'manifests':[..._0x1b888d[_0x414dc0(0x101)],..._0x296c87[_0x414dc0(0x101)]],'componentsToDelete':[..._0x1b888d[_0x414dc0(0xee)],..._0x296c87['componentsToDelete']],'componentsToUpdate':[..._0x1b888d[_0x414dc0(0xfe)],..._0x296c87['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x5c185f['manifests'][_0x414dc0(0x104)]&&await this[_0x414dc0(0xdf)](_0x5c185f[_0x414dc0(0x101)],!![]),_0x5c185f[_0x414dc0(0xfe)][_0x414dc0(0x104)]&&await this['proceedRequests'](_0x5c185f[_0x414dc0(0xfe)],!![]),_0x5c185f[_0x414dc0(0xee)][_0x414dc0(0x104)]&&await this[_0x414dc0(0xdf)](_0x5c185f['componentsToDelete'],!![]);}async[a227_0x3f2b7d(0x120)](_0x35f1b0){const _0x1f0cc0=a227_0x3f2b7d;this[_0x1f0cc0(0x114)][_0x1f0cc0(0x110)]?await this[_0x1f0cc0(0x119)](_0x35f1b0):await this[_0x1f0cc0(0xe2)](_0x35f1b0);}}function a227_0xdf5c(){const _0x5ae3fa=['length','SalesforceError','toJSON','find','../../../shared/utils','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','502988VEVxPf','(((.+)+)+)+$','1398XtoeHs','Logger','inserted','reference','branchId','insert','./salesforce-components-manager.service','repositoryId','options','proceededComponentsMeta','search','composite','toString','proceedCommitsToBranch','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','modified','constructor','executeGraphs','3rRcQVP','./salesforce-composite.service','proceedCommits','name','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','63eqPgot','chunkArray','2315EgzHAz','proceedRequests','typedi','removed','proceedCommitsToRepository','getProceededComponentsMeta','commitId','SalesforceCommitsManager','../../../../constants','__esModule','log','apply','146056cMSPzS','COMPONENTS_PER_CHUNK','__importDefault','3730048NDKKCm','componentsToDelete','error','logger','delete','659090DEgcrz','get','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','37098SLanOa','../../../../core','1415750twovyi','reduce','../errors/salesforce.error','defineProperty','SALESFORCE_MAX_REQUEST_SIZE_BYTES','author','push','componentsToUpdate','Sending\x20','SalesforceComponentsManager','manifests','recordTypes','sfLogger'];a227_0xdf5c=function(){return _0x5ae3fa;};return a227_0xdf5c();}function a227_0x1849(_0x70ed0d,_0x589ad4){const _0x389a2a=a227_0xdf5c();return a227_0x1849=function(_0x1d7714,_0x59c278){_0x1d7714=_0x1d7714-0xdd;let _0xdf5c24=_0x389a2a[_0x1d7714];return _0xdf5c24;},a227_0x1849(_0x70ed0d,_0x589ad4);}exports['SalesforceCommitsManager']=SalesforceCommitsManager;