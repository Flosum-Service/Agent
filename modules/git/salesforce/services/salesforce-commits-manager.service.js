const a260_0x4fda4e=a260_0x53c5;(function(_0x49d97a,_0x489362){const _0x25f1ed=a260_0x53c5,_0x38c029=_0x49d97a();while(!![]){try{const _0x4a40b1=-parseInt(_0x25f1ed(0x1ef))/0x1*(parseInt(_0x25f1ed(0x20d))/0x2)+-parseInt(_0x25f1ed(0x201))/0x3+-parseInt(_0x25f1ed(0x220))/0x4+parseInt(_0x25f1ed(0x221))/0x5*(parseInt(_0x25f1ed(0x1fe))/0x6)+parseInt(_0x25f1ed(0x1fa))/0x7*(-parseInt(_0x25f1ed(0x20a))/0x8)+-parseInt(_0x25f1ed(0x205))/0x9*(parseInt(_0x25f1ed(0x203))/0xa)+parseInt(_0x25f1ed(0x20b))/0xb;if(_0x4a40b1===_0x489362)break;else _0x38c029['push'](_0x38c029['shift']());}catch(_0x11b33c){_0x38c029['push'](_0x38c029['shift']());}}}(a260_0x2174,0xd9f63));const a260_0x1995f6=(function(){let _0x560d37=!![];return function(_0x4b34cb,_0x59fe94){const _0x3768ef=_0x560d37?function(){const _0x430f0b=a260_0x53c5;if(_0x59fe94){const _0x435626=_0x59fe94[_0x430f0b(0x223)](_0x4b34cb,arguments);return _0x59fe94=null,_0x435626;}}:function(){};return _0x560d37=![],_0x3768ef;};}()),a260_0x95959b=a260_0x1995f6(this,function(){const _0x25cc8a=a260_0x53c5;return a260_0x95959b['toString']()[_0x25cc8a(0x22c)](_0x25cc8a(0x217))[_0x25cc8a(0x1f7)]()['constructor'](a260_0x95959b)[_0x25cc8a(0x22c)](_0x25cc8a(0x217));});function a260_0x2174(){const _0xb61b86=['apply','COMPONENTS_PER_CHUNK','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','proceedRequests','../../../shared/utils','proceedChunksToUpload','chunkArray','SalesforceCommitsManager','SalesforceError','search','SalesforceCompositeService','removed','inserted','logger','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','componentId','SALESFORCE_MAX_REQUEST_SIZE_BYTES','insert','componentsToDelete','213055QTUBQg','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','name','update','recordTypes','../../../../core','./salesforce-composite.service','\x20requests\x20to\x20composite\x20api.','toString','SalesforceComponentsManager','reference','7jvGWlN','commitId','delete','reduce','6pJClQv','sfLogger','typedi','3941334QgjldL','extractComponentIdsFromGraphsResponse','2739790NltoLB','splice','45EoJFtZ','modified','options','manifests','proceedCommits','11251424bYqAUF','57889623AImsIf','find','4xOPNkX','composite','defineProperty','default','__esModule','length','Logger','log','branchId','push','(((.+)+)+)+$','__importDefault','../../../../constants','./salesforce-components-manager.service','graph','componentsToUpdate','proceededComponentsMeta','get','stringify','1277972qjtulu','2328910JiCsra','author'];a260_0x2174=function(){return _0xb61b86;};return a260_0x2174();}a260_0x95959b();'use strict';var __importDefault=this&&this[a260_0x4fda4e(0x218)]||function(_0x193294){const _0x5b8e44=a260_0x4fda4e;return _0x193294&&_0x193294[_0x5b8e44(0x211)]?_0x193294:{'default':_0x193294};};Object[a260_0x4fda4e(0x20f)](exports,a260_0x4fda4e(0x211),{'value':!![]}),exports[a260_0x4fda4e(0x22a)]=void 0x0;const core_1=require(a260_0x4fda4e(0x1f4)),typedi_1=__importDefault(require(a260_0x4fda4e(0x200))),constants_1=require(a260_0x4fda4e(0x219)),utils_1=require(a260_0x4fda4e(0x227)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require(a260_0x4fda4e(0x21a)),salesforce_composite_service_1=require(a260_0x4fda4e(0x1f5));class SalesforceCommitsManager{constructor(_0x43477b){const _0xe28994=a260_0x4fda4e;this['options']=_0x43477b,this[_0xe28994(0x224)]=0x3,this[_0xe28994(0x230)]=new core_1[(_0xe28994(0x213))](SalesforceCommitsManager[_0xe28994(0x1f1)]),this['sfLogger']=this['options']['logger'],this[_0xe28994(0x20e)]=typedi_1[_0xe28994(0x210)][_0xe28994(0x21e)](salesforce_composite_service_1[_0xe28994(0x22d)]),this[_0xe28994(0x21d)]=[];}async[a260_0x4fda4e(0x228)](_0x206507,_0x50d05b=![]){const _0x2a8ac0=a260_0x4fda4e,_0x1f18be=async _0x419f6e=>{const _0x37c7c7=a260_0x53c5;await this[_0x37c7c7(0x230)][_0x37c7c7(0x214)]('Sending\x20'+_0x419f6e[_0x37c7c7(0x1fd)]((_0x182207,_0x1c09f6)=>_0x182207+_0x1c09f6[_0x37c7c7(0x212)],0x0)+_0x37c7c7(0x1f6));const _0x777c33=_0x419f6e['map']((_0x817118,_0x506b6f)=>({'graphId':_0x37c7c7(0x21b)+_0x506b6f,'compositeRequest':_0x817118})),_0x344577=await this[_0x37c7c7(0x20e)]['executeGraphs'](_0x777c33);if(_0x50d05b){const _0x3b11c7=(0x0,composite_utils_1[_0x37c7c7(0x202)])(_0x344577);for(const {id:_0x4e5e7f,ref:_0x4f829f}of _0x3b11c7){const _0x2862eb=this[_0x37c7c7(0x21d)][_0x37c7c7(0x20c)](_0x24b7a0=>_0x24b7a0[_0x37c7c7(0x1f9)]===_0x4f829f);_0x2862eb&&(_0x2862eb[_0x37c7c7(0x232)]=_0x4e5e7f);}}},_0x21706f=0x1e8480;let _0x1835ae=0x0,_0x2263ed=[];for(const _0x2dcfb1 of _0x206507){const _0x5cdfb2=_0x2dcfb1[_0x2a8ac0(0x1fd)]((_0x3f7966,_0x5f26dc)=>{const _0x51a736=JSON['stringify'](_0x5f26dc)['length']*0x2;return _0x3f7966+_0x51a736;},0x0);if(_0x5cdfb2>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES'])throw new salesforce_error_1[(_0x2a8ac0(0x22b))](_0x2a8ac0(0x225)+constants_1[_0x2a8ac0(0x233)]+'\x20COMPONENTS_SIZE\x20=\x20'+_0x5cdfb2);_0x1835ae+_0x5cdfb2>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']-_0x21706f&&(await _0x1f18be(_0x2263ed),_0x2263ed=[],_0x1835ae=0x0),_0x1835ae+=_0x5cdfb2,_0x2263ed[_0x2a8ac0(0x216)](_0x2dcfb1);}_0x2263ed['length']&&await _0x1f18be(_0x2263ed);}async['proceedRequests'](_0x3bd068,_0x19f098=![]){const _0x39ac9e=a260_0x4fda4e,_0x1ac82a=(this[_0x39ac9e(0x224)]+ +_0x19f098)*0x3,_0x3760d2=(0x0,utils_1[_0x39ac9e(0x229)])(_0x3bd068,_0x1ac82a);try{while(_0x3760d2[_0x39ac9e(0x212)]){const _0x541db5=_0x3760d2[_0x39ac9e(0x204)](0x0,Math['floor'](constants_1[_0x39ac9e(0x231)]/_0x1ac82a));await this[_0x39ac9e(0x228)](_0x541db5,_0x19f098);}}catch(_0x26da50){this['logger']['error'](_0x26da50 instanceof salesforce_error_1[_0x39ac9e(0x22b)]?JSON[_0x39ac9e(0x21f)](_0x26da50['toJSON'](),null,0x2):_0x26da50),this[_0x39ac9e(0x1ff)][_0x39ac9e(0x214)](_0x26da50 instanceof salesforce_error_1[_0x39ac9e(0x22b)]?JSON[_0x39ac9e(0x21f)](_0x26da50['toJSON'](),null,0x2):_0x26da50[_0x39ac9e(0x1f7)]());throw _0x26da50;}}async['proceedCommitsToRepository'](_0x5d9d31){const _0x435cb1=a260_0x4fda4e;for(const _0x3595d9 of _0x5d9d31){if(!_0x3595d9[_0x435cb1(0x22f)][_0x435cb1(0x212)]&&!_0x3595d9[_0x435cb1(0x206)]['length']&&!_0x3595d9[_0x435cb1(0x22e)][_0x435cb1(0x212)])continue;const _0x9aed30=[],_0xeca2d9=[],_0x3081ea=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x435cb1(0x207)]['repositoryId'],this[_0x435cb1(0x207)][_0x435cb1(0x215)],_0x3595d9['author'],this[_0x435cb1(0x207)][_0x435cb1(0x1f3)],this['proceededComponentsMeta']);_0x9aed30['push'](...await _0x3081ea[_0x435cb1(0x234)](_0x3595d9['inserted'],this[_0x435cb1(0x207)]['commitId'])),_0x9aed30[_0x435cb1(0x216)](...await _0x3081ea[_0x435cb1(0x1f2)](_0x3595d9[_0x435cb1(0x206)],this[_0x435cb1(0x207)][_0x435cb1(0x1fb)])),_0xeca2d9[_0x435cb1(0x216)](await _0x3081ea[_0x435cb1(0x1fc)](_0x3595d9[_0x435cb1(0x22e)],!![])),this[_0x435cb1(0x21d)]=_0x3081ea['getProceededComponentsMeta'](),await this[_0x435cb1(0x226)](_0x9aed30,!![]);for(const _0x456128 of _0xeca2d9){_0x456128[_0x435cb1(0x208)][_0x435cb1(0x212)]&&await this[_0x435cb1(0x226)](_0x456128[_0x435cb1(0x208)],!![]),_0x456128[_0x435cb1(0x21c)][_0x435cb1(0x212)]&&await this[_0x435cb1(0x226)](_0x456128[_0x435cb1(0x21c)],!![]),_0x456128[_0x435cb1(0x235)]['length']&&await this[_0x435cb1(0x226)](_0x456128[_0x435cb1(0x235)],!![]);}this[_0x435cb1(0x230)][_0x435cb1(0x214)]('Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x9aed30[_0x435cb1(0x212)]);}}async['proceedCommitsToBranch'](_0x1fa16d){const _0x29655c=a260_0x4fda4e,_0xeed2e8=[],_0x2de0e5=[];for(const _0x472cbf of _0x1fa16d){if(!_0x472cbf[_0x29655c(0x22f)][_0x29655c(0x212)]&&!_0x472cbf['modified']['length']&&!_0x472cbf[_0x29655c(0x22e)]['length'])continue;const _0x4551df=new salesforce_components_manager_service_1[(_0x29655c(0x1f8))](this[_0x29655c(0x207)]['repositoryId'],this[_0x29655c(0x207)]['branchId'],_0x472cbf[_0x29655c(0x222)],this[_0x29655c(0x207)][_0x29655c(0x1f3)],[]);_0xeed2e8[_0x29655c(0x216)](...await _0x4551df[_0x29655c(0x234)](_0x472cbf[_0x29655c(0x22f)])),_0xeed2e8['push'](...await _0x4551df[_0x29655c(0x1f2)](_0x472cbf[_0x29655c(0x206)])),_0x2de0e5[_0x29655c(0x216)](await _0x4551df[_0x29655c(0x1fc)](_0x472cbf['removed']));}this['logger'][_0x29655c(0x214)](_0x29655c(0x1f0),_0xeed2e8[_0x29655c(0x212)]),await this[_0x29655c(0x226)](_0xeed2e8);const _0x42d446=_0x2de0e5['reduce']((_0x4189a1,_0x675349)=>({'manifests':[..._0x4189a1[_0x29655c(0x208)],..._0x675349[_0x29655c(0x208)]],'componentsToDelete':[..._0x4189a1[_0x29655c(0x235)],..._0x675349['componentsToDelete']],'componentsToUpdate':[..._0x4189a1[_0x29655c(0x21c)],..._0x675349['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x42d446[_0x29655c(0x208)][_0x29655c(0x212)]&&await this[_0x29655c(0x226)](_0x42d446[_0x29655c(0x208)],!![]),_0x42d446[_0x29655c(0x21c)][_0x29655c(0x212)]&&await this[_0x29655c(0x226)](_0x42d446['componentsToUpdate'],!![]),_0x42d446[_0x29655c(0x235)][_0x29655c(0x212)]&&await this[_0x29655c(0x226)](_0x42d446[_0x29655c(0x235)],!![]);}async[a260_0x4fda4e(0x209)](_0x339d6f){const _0x4fabfd=a260_0x4fda4e;this[_0x4fabfd(0x207)]['branchId']?await this['proceedCommitsToBranch'](_0x339d6f):await this['proceedCommitsToRepository'](_0x339d6f);}}function a260_0x53c5(_0x150f94,_0x3bb307){const _0x2f809c=a260_0x2174();return a260_0x53c5=function(_0x95959b,_0x1995f6){_0x95959b=_0x95959b-0x1ef;let _0x217414=_0x2f809c[_0x95959b];return _0x217414;},a260_0x53c5(_0x150f94,_0x3bb307);}exports[a260_0x4fda4e(0x22a)]=SalesforceCommitsManager;