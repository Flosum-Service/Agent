const a270_0x7bfe9a=a270_0x18ba;(function(_0x935959,_0x32a26d){const _0x35a9ba=a270_0x18ba,_0x708479=_0x935959();while(!![]){try{const _0x46d7d4=-parseInt(_0x35a9ba(0xc9))/0x1+parseInt(_0x35a9ba(0xba))/0x2*(-parseInt(_0x35a9ba(0xa8))/0x3)+parseInt(_0x35a9ba(0xb1))/0x4*(-parseInt(_0x35a9ba(0x99))/0x5)+parseInt(_0x35a9ba(0xb0))/0x6*(parseInt(_0x35a9ba(0xdf))/0x7)+-parseInt(_0x35a9ba(0xbf))/0x8*(parseInt(_0x35a9ba(0xb8))/0x9)+-parseInt(_0x35a9ba(0xad))/0xa+parseInt(_0x35a9ba(0xda))/0xb*(parseInt(_0x35a9ba(0xac))/0xc);if(_0x46d7d4===_0x32a26d)break;else _0x708479['push'](_0x708479['shift']());}catch(_0x5dc6e0){_0x708479['push'](_0x708479['shift']());}}}(a270_0x539e,0x20408));const a270_0x2692b7=(function(){let _0xbf1f58=!![];return function(_0x135700,_0xf74bec){const _0x370f8e=_0xbf1f58?function(){const _0x10c1bb=a270_0x18ba;if(_0xf74bec){const _0x27e5d1=_0xf74bec[_0x10c1bb(0x9a)](_0x135700,arguments);return _0xf74bec=null,_0x27e5d1;}}:function(){};return _0xbf1f58=![],_0x370f8e;};}()),a270_0x188fd5=a270_0x2692b7(this,function(){const _0x5c6b80=a270_0x18ba;return a270_0x188fd5[_0x5c6b80(0xcc)]()[_0x5c6b80(0xd2)](_0x5c6b80(0xbc))[_0x5c6b80(0xcc)]()[_0x5c6b80(0xc1)](a270_0x188fd5)['search'](_0x5c6b80(0xbc));});function a270_0x18ba(_0x36e931,_0x38fe36){const _0x10db34=a270_0x539e();return a270_0x18ba=function(_0x188fd5,_0x2692b7){_0x188fd5=_0x188fd5-0x96;let _0x539eb3=_0x10db34[_0x188fd5];return _0x539eb3;},a270_0x18ba(_0x36e931,_0x38fe36);}function a270_0x539e(){const _0x511403=['defineProperty','40912LXjrRz','floor','constructor','map','../utils/composite.utils','reference','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','SalesforceCompositeService','branchId','reduce','37834lAybfW','recordTypes','sfLogger','toString','removed','proceedCommits','modified','componentsToUpdate','insert','search','./salesforce-composite.service','length','../../../shared/utils','./salesforce-components-manager.service','options','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','splice','11FcWKPI','proceedRequests','componentsToDelete','stringify','SalesforceError','7hptRjd','delete','manifests','graph','36615aaDHcv','apply','proceedCommitsToBranch','composite','getProceededComponentsMeta','proceededComponentsMeta','logger','../../../../core','SalesforceComponentsManager','../../../../constants','SalesforceCommitsManager','__esModule','inserted','commitId','log','63423cdLNgn','author','../errors/salesforce.error','push','7018584EGLLQw','40510cHtKZG','SALESFORCE_MAX_REQUEST_SIZE_BYTES','repositoryId','203358rhDHvn','96dpACsU','toJSON','update','error','get','proceedCommitsToRepository','__importDefault','27ekHFrg','chunkArray','24jStylg','Logger','(((.+)+)+)+$','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)'];a270_0x539e=function(){return _0x511403;};return a270_0x539e();}a270_0x188fd5();'use strict';var __importDefault=this&&this[a270_0x7bfe9a(0xb7)]||function(_0x319fee){const _0x38dcaa=a270_0x7bfe9a;return _0x319fee&&_0x319fee[_0x38dcaa(0xa4)]?_0x319fee:{'default':_0x319fee};};Object[a270_0x7bfe9a(0xbe)](exports,a270_0x7bfe9a(0xa4),{'value':!![]}),exports[a270_0x7bfe9a(0xa3)]=void 0x0;const core_1=require(a270_0x7bfe9a(0xa0)),typedi_1=__importDefault(require('typedi')),constants_1=require(a270_0x7bfe9a(0xa2)),utils_1=require(a270_0x7bfe9a(0xd5)),salesforce_error_1=require(a270_0x7bfe9a(0xaa)),composite_utils_1=require(a270_0x7bfe9a(0xc3)),salesforce_components_manager_service_1=require(a270_0x7bfe9a(0xd6)),salesforce_composite_service_1=require(a270_0x7bfe9a(0xd3));class SalesforceCommitsManager{constructor(_0x12a59c){const _0x242151=a270_0x7bfe9a;this[_0x242151(0xd7)]=_0x12a59c,this['COMPONENTS_PER_CHUNK']=0x3,this[_0x242151(0x9f)]=new core_1[(_0x242151(0xbb))](SalesforceCommitsManager['name']),this[_0x242151(0xcb)]=this[_0x242151(0xd7)][_0x242151(0x9f)],this[_0x242151(0x9c)]=typedi_1['default'][_0x242151(0xb5)](salesforce_composite_service_1[_0x242151(0xc6)]),this['proceededComponentsMeta']=[];}async['proceedChunksToUpload'](_0x314ca1,_0xf05c4c=![]){const _0x5d639d=a270_0x7bfe9a,_0x51e40c=async _0xc80ee4=>{const _0x82cb57=a270_0x18ba;await this[_0x82cb57(0x9f)]['log']('Sending\x20'+_0xc80ee4[_0x82cb57(0xc8)]((_0x80c6d7,_0x1cdd76)=>_0x80c6d7+_0x1cdd76[_0x82cb57(0xd4)],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x5d2613=_0xc80ee4[_0x82cb57(0xc2)]((_0x134083,_0x3d5ec2)=>({'graphId':_0x82cb57(0x98)+_0x3d5ec2,'compositeRequest':_0x134083})),_0x3773ca=await this[_0x82cb57(0x9c)]['executeGraphs'](_0x5d2613);if(_0xf05c4c){const _0x377b23=(0x0,composite_utils_1['extractComponentIdsFromGraphsResponse'])(_0x3773ca);for(const {id:_0x18ced8,ref:_0x122401}of _0x377b23){const _0x331f47=this[_0x82cb57(0x9e)]['find'](_0xf955dc=>_0xf955dc[_0x82cb57(0xc4)]===_0x122401);_0x331f47&&(_0x331f47['componentId']=_0x18ced8);}}},_0x58dad8=0x1e8480;let _0x59f5ec=0x0,_0x38f212=[];for(const _0x585666 of _0x314ca1){const _0x74f31=_0x585666['reduce']((_0x187fed,_0x5e55be)=>{const _0x2de3f0=a270_0x18ba,_0x16e3f4=JSON['stringify'](_0x5e55be)[_0x2de3f0(0xd4)]*0x2;return _0x187fed+_0x16e3f4;},0x0);if(_0x74f31>constants_1[_0x5d639d(0xae)])throw new salesforce_error_1[(_0x5d639d(0xde))](_0x5d639d(0xc5)+constants_1[_0x5d639d(0xae)]+'\x20COMPONENTS_SIZE\x20=\x20'+_0x74f31);_0x59f5ec+_0x74f31>constants_1[_0x5d639d(0xae)]-_0x58dad8&&(await _0x51e40c(_0x38f212),_0x38f212=[],_0x59f5ec=0x0),_0x59f5ec+=_0x74f31,_0x38f212[_0x5d639d(0xab)](_0x585666);}_0x38f212[_0x5d639d(0xd4)]&&await _0x51e40c(_0x38f212);}async['proceedRequests'](_0x497cf8,_0x649847=![]){const _0x5d759c=a270_0x7bfe9a,_0x375450=(this['COMPONENTS_PER_CHUNK']+ +_0x649847)*0x3,_0x16ca69=(0x0,utils_1[_0x5d759c(0xb9)])(_0x497cf8,_0x375450);try{while(_0x16ca69[_0x5d759c(0xd4)]){const _0x466465=_0x16ca69[_0x5d759c(0xd9)](0x0,Math[_0x5d759c(0xc0)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x375450));await this['proceedChunksToUpload'](_0x466465,_0x649847);}}catch(_0x554702){this['logger'][_0x5d759c(0xb4)](_0x554702 instanceof salesforce_error_1[_0x5d759c(0xde)]?JSON[_0x5d759c(0xdd)](_0x554702[_0x5d759c(0xb2)](),null,0x2):_0x554702),this[_0x5d759c(0xcb)][_0x5d759c(0xa7)](_0x554702 instanceof salesforce_error_1[_0x5d759c(0xde)]?JSON['stringify'](_0x554702[_0x5d759c(0xb2)](),null,0x2):_0x554702[_0x5d759c(0xcc)]());throw _0x554702;}}async['proceedCommitsToRepository'](_0x4e955c){const _0xbf1c65=a270_0x7bfe9a;for(const _0x2839a4 of _0x4e955c){if(!_0x2839a4[_0xbf1c65(0xa5)][_0xbf1c65(0xd4)]&&!_0x2839a4['modified'][_0xbf1c65(0xd4)]&&!_0x2839a4[_0xbf1c65(0xcd)]['length'])continue;const _0x2251f1=[],_0x4ec719=[],_0x15582c=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0xbf1c65(0xd7)][_0xbf1c65(0xaf)],this[_0xbf1c65(0xd7)][_0xbf1c65(0xc7)],_0x2839a4['author'],this[_0xbf1c65(0xd7)][_0xbf1c65(0xca)],this[_0xbf1c65(0x9e)]);_0x2251f1[_0xbf1c65(0xab)](...await _0x15582c['insert'](_0x2839a4[_0xbf1c65(0xa5)],this[_0xbf1c65(0xd7)]['commitId'])),_0x2251f1[_0xbf1c65(0xab)](...await _0x15582c[_0xbf1c65(0xb3)](_0x2839a4['modified'],this[_0xbf1c65(0xd7)][_0xbf1c65(0xa6)])),_0x4ec719[_0xbf1c65(0xab)](await _0x15582c['delete'](_0x2839a4[_0xbf1c65(0xcd)],!![])),this[_0xbf1c65(0x9e)]=_0x15582c[_0xbf1c65(0x9d)](),await this[_0xbf1c65(0xdb)](_0x2251f1,!![]);for(const _0x5d6281 of _0x4ec719){_0x5d6281[_0xbf1c65(0x97)][_0xbf1c65(0xd4)]&&await this[_0xbf1c65(0xdb)](_0x5d6281[_0xbf1c65(0x97)],!![]),_0x5d6281[_0xbf1c65(0xd0)]['length']&&await this[_0xbf1c65(0xdb)](_0x5d6281[_0xbf1c65(0xd0)],!![]),_0x5d6281[_0xbf1c65(0xdc)][_0xbf1c65(0xd4)]&&await this[_0xbf1c65(0xdb)](_0x5d6281[_0xbf1c65(0xdc)],!![]);}this['logger'][_0xbf1c65(0xa7)](_0xbf1c65(0xd8),_0x2251f1[_0xbf1c65(0xd4)]);}}async[a270_0x7bfe9a(0x9b)](_0x26390b){const _0x12095c=a270_0x7bfe9a,_0x554101=[],_0x24e2cc=[];for(const _0x379b77 of _0x26390b){if(!_0x379b77[_0x12095c(0xa5)]['length']&&!_0x379b77[_0x12095c(0xcf)][_0x12095c(0xd4)]&&!_0x379b77[_0x12095c(0xcd)][_0x12095c(0xd4)])continue;const _0x431773=new salesforce_components_manager_service_1[(_0x12095c(0xa1))](this[_0x12095c(0xd7)]['repositoryId'],this[_0x12095c(0xd7)]['branchId'],_0x379b77[_0x12095c(0xa9)],this['options'][_0x12095c(0xca)],[]);_0x554101[_0x12095c(0xab)](...await _0x431773[_0x12095c(0xd1)](_0x379b77[_0x12095c(0xa5)])),_0x554101[_0x12095c(0xab)](...await _0x431773[_0x12095c(0xb3)](_0x379b77['modified'])),_0x24e2cc[_0x12095c(0xab)](await _0x431773[_0x12095c(0x96)](_0x379b77[_0x12095c(0xcd)]));}this['logger'][_0x12095c(0xa7)](_0x12095c(0xbd),_0x554101['length']),await this['proceedRequests'](_0x554101);const _0x1b6f75=_0x24e2cc['reduce']((_0x8b40f0,_0x53fc99)=>({'manifests':[..._0x8b40f0[_0x12095c(0x97)],..._0x53fc99[_0x12095c(0x97)]],'componentsToDelete':[..._0x8b40f0[_0x12095c(0xdc)],..._0x53fc99[_0x12095c(0xdc)]],'componentsToUpdate':[..._0x8b40f0[_0x12095c(0xd0)],..._0x53fc99[_0x12095c(0xd0)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x1b6f75[_0x12095c(0x97)][_0x12095c(0xd4)]&&await this[_0x12095c(0xdb)](_0x1b6f75[_0x12095c(0x97)],!![]),_0x1b6f75['componentsToUpdate'][_0x12095c(0xd4)]&&await this[_0x12095c(0xdb)](_0x1b6f75[_0x12095c(0xd0)],!![]),_0x1b6f75[_0x12095c(0xdc)][_0x12095c(0xd4)]&&await this[_0x12095c(0xdb)](_0x1b6f75['componentsToDelete'],!![]);}async[a270_0x7bfe9a(0xce)](_0x2f4f4a){const _0x5a0d71=a270_0x7bfe9a;this[_0x5a0d71(0xd7)][_0x5a0d71(0xc7)]?await this[_0x5a0d71(0x9b)](_0x2f4f4a):await this[_0x5a0d71(0xb6)](_0x2f4f4a);}}exports[a270_0x7bfe9a(0xa3)]=SalesforceCommitsManager;