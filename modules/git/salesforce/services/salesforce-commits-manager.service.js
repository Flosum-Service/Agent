const a181_0x52d931=a181_0x56e8;function a181_0x18af(){const _0x260d85=['graph','branchId','modified','extractComponentIdsFromGraphsResponse','recordTypes','1hdgrdm','1528464tnkcnB','error','reference','proceedRequests','delete','proceedCommitsToRepository','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','manifests','sfLogger','6116901OnOjIO','componentsToUpdate','reduce','update','proceededComponentsMeta','floor','\x20requests\x20to\x20composite\x20api.','length','Logger','6240210zRRyWy','__esModule','(((.+)+)+)+$','push','constructor','./salesforce-components-manager.service','../../../../constants','toString','defineProperty','author','search','5lMXRSr','inserted','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','4928512WxADSu','__importDefault','insert','SalesforceComponentsManager','../../../../core','logger','componentsToDelete','composite','stringify','name','map','Sending\x20','../errors/salesforce.error','componentId','2838648kjOxuK','10145763LiunDF','repositoryId','splice','toJSON','chunkArray','typedi','get','removed','log','SalesforceCompositeService','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','find','commitId','2352722LqJuET','options'];a181_0x18af=function(){return _0x260d85;};return a181_0x18af();}(function(_0x2dd144,_0x1cf968){const _0x52a0ab=a181_0x56e8,_0x2f2792=_0x2dd144();while(!![]){try{const _0x13b584=parseInt(_0x52a0ab(0xe8))/0x1*(parseInt(_0x52a0ab(0xe1))/0x2)+-parseInt(_0x52a0ab(0xe9))/0x3+parseInt(_0x52a0ab(0xd3))/0x4+parseInt(_0x52a0ab(0xc2))/0x5*(-parseInt(_0x52a0ab(0xb7))/0x6)+parseInt(_0x52a0ab(0xf2))/0x7+parseInt(_0x52a0ab(0xc5))/0x8+-parseInt(_0x52a0ab(0xd4))/0x9;if(_0x13b584===_0x1cf968)break;else _0x2f2792['push'](_0x2f2792['shift']());}catch(_0x119627){_0x2f2792['push'](_0x2f2792['shift']());}}}(a181_0x18af,0xaaadc));const a181_0x26320b=(function(){let _0x6ad81f=!![];return function(_0x35705a,_0x2fce1f){const _0x46fccd=_0x6ad81f?function(){if(_0x2fce1f){const _0x268d7b=_0x2fce1f['apply'](_0x35705a,arguments);return _0x2fce1f=null,_0x268d7b;}}:function(){};return _0x6ad81f=![],_0x46fccd;};}()),a181_0xd694b6=a181_0x26320b(this,function(){const _0x2995a1=a181_0x56e8;return a181_0xd694b6[_0x2995a1(0xbe)]()[_0x2995a1(0xc1)](_0x2995a1(0xb9))['toString']()[_0x2995a1(0xbb)](a181_0xd694b6)[_0x2995a1(0xc1)](_0x2995a1(0xb9));});a181_0xd694b6();'use strict';var __importDefault=this&&this[a181_0x52d931(0xc6)]||function(_0x30701c){const _0x472b69=a181_0x52d931;return _0x30701c&&_0x30701c[_0x472b69(0xb8)]?_0x30701c:{'default':_0x30701c};};Object[a181_0x52d931(0xbf)](exports,a181_0x52d931(0xb8),{'value':!![]}),exports['SalesforceCommitsManager']=void 0x0;function a181_0x56e8(_0x2bc4e7,_0x4a90c6){const _0x5b69e7=a181_0x18af();return a181_0x56e8=function(_0xd694b6,_0x26320b){_0xd694b6=_0xd694b6-0xb2;let _0x18af5b=_0x5b69e7[_0xd694b6];return _0x18af5b;},a181_0x56e8(_0x2bc4e7,_0x4a90c6);}const core_1=require(a181_0x52d931(0xc9)),typedi_1=__importDefault(require(a181_0x52d931(0xd9))),constants_1=require(a181_0x52d931(0xbd)),utils_1=require('../../../shared/utils'),salesforce_error_1=require(a181_0x52d931(0xd1)),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require(a181_0x52d931(0xbc)),salesforce_composite_service_1=require('./salesforce-composite.service');class SalesforceCommitsManager{constructor(_0x330052){const _0x13a080=a181_0x52d931;this[_0x13a080(0xe2)]=_0x330052,this['COMPONENTS_PER_CHUNK']=0x3,this['logger']=new core_1[(_0x13a080(0xb6))](SalesforceCommitsManager[_0x13a080(0xce)]),this[_0x13a080(0xf1)]=this[_0x13a080(0xe2)][_0x13a080(0xca)],this['composite']=typedi_1['default'][_0x13a080(0xda)](salesforce_composite_service_1[_0x13a080(0xdd)]),this[_0x13a080(0xb2)]=[];}async['proceedRequests'](_0x513a5a,_0x3e7758=![]){const _0x152d9c=a181_0x52d931,_0x289cf8=(this['COMPONENTS_PER_CHUNK']+ +_0x3e7758)*0x3,_0x1d9542=utils_1[_0x152d9c(0xd8)](_0x513a5a,_0x289cf8);try{while(_0x1d9542['length']){const _0x2f9cdb=_0x1d9542[_0x152d9c(0xd6)](0x0,Math[_0x152d9c(0xb3)](constants_1[_0x152d9c(0xde)]/_0x289cf8));await this[_0x152d9c(0xca)]['log'](_0x152d9c(0xd0)+_0x2f9cdb['length']*_0x289cf8+_0x152d9c(0xb4));const _0x48e544=_0x2f9cdb[_0x152d9c(0xcf)]((_0x4d30cf,_0x479913)=>({'graphId':_0x152d9c(0xe3)+_0x479913,'compositeRequest':_0x4d30cf})),_0x81f5ff=await this[_0x152d9c(0xcc)]['executeGraphs'](_0x48e544);if(_0x3e7758){const _0x535079=composite_utils_1[_0x152d9c(0xe6)](_0x81f5ff);for(const {id:_0x21e3e9,ref:_0x33a613}of _0x535079){const _0x475686=this[_0x152d9c(0xb2)][_0x152d9c(0xdf)](_0x11559a=>_0x11559a[_0x152d9c(0xeb)]===_0x33a613);_0x475686&&(_0x475686[_0x152d9c(0xd2)]=_0x21e3e9);}}}}catch(_0x4c4768){this[_0x152d9c(0xca)][_0x152d9c(0xea)](_0x4c4768 instanceof salesforce_error_1['SalesforceError']?JSON['stringify'](_0x4c4768[_0x152d9c(0xd7)](),null,0x2):_0x4c4768),this[_0x152d9c(0xf1)][_0x152d9c(0xdc)](_0x4c4768 instanceof salesforce_error_1['SalesforceError']?JSON[_0x152d9c(0xcd)](_0x4c4768['toJSON'](),null,0x2):_0x4c4768['toString']());throw _0x4c4768;}}async[a181_0x52d931(0xee)](_0x3d33c){const _0x3f0a9c=a181_0x52d931;for(const _0x45deb4 of _0x3d33c){if(!_0x45deb4[_0x3f0a9c(0xc3)][_0x3f0a9c(0xb5)]&&!_0x45deb4[_0x3f0a9c(0xe5)][_0x3f0a9c(0xb5)]&&!_0x45deb4[_0x3f0a9c(0xdb)][_0x3f0a9c(0xb5)])continue;const _0x2bab0d=[],_0x2c6da8=[],_0x16f979=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x3f0a9c(0xe2)][_0x3f0a9c(0xd5)],this[_0x3f0a9c(0xe2)][_0x3f0a9c(0xe4)],_0x45deb4[_0x3f0a9c(0xc0)],this[_0x3f0a9c(0xe2)][_0x3f0a9c(0xe7)],this['proceededComponentsMeta']);_0x2bab0d[_0x3f0a9c(0xba)](...await _0x16f979['insert'](_0x45deb4[_0x3f0a9c(0xc3)],this[_0x3f0a9c(0xe2)][_0x3f0a9c(0xe0)])),_0x2bab0d[_0x3f0a9c(0xba)](...await _0x16f979[_0x3f0a9c(0xf5)](_0x45deb4[_0x3f0a9c(0xe5)],this[_0x3f0a9c(0xe2)][_0x3f0a9c(0xe0)])),_0x2c6da8['push'](await _0x16f979[_0x3f0a9c(0xed)](_0x45deb4[_0x3f0a9c(0xdb)],!![])),this[_0x3f0a9c(0xb2)]=_0x16f979['getProceededComponentsMeta'](),await this[_0x3f0a9c(0xec)](_0x2bab0d,!![]);for(const _0x5174c5 of _0x2c6da8){_0x5174c5[_0x3f0a9c(0xf0)][_0x3f0a9c(0xb5)]&&await this['proceedRequests'](_0x5174c5['manifests'],!![]),_0x5174c5[_0x3f0a9c(0xf3)][_0x3f0a9c(0xb5)]&&await this[_0x3f0a9c(0xec)](_0x5174c5['componentsToUpdate'],!![]),_0x5174c5['componentsToDelete']['length']&&await this[_0x3f0a9c(0xec)](_0x5174c5[_0x3f0a9c(0xcb)],!![]);}this[_0x3f0a9c(0xca)][_0x3f0a9c(0xdc)](_0x3f0a9c(0xc4),_0x2bab0d[_0x3f0a9c(0xb5)]);}}async['proceedCommitsToBranch'](_0x232963){const _0x3c0fc5=a181_0x52d931,_0x418766=[],_0xf1f887=[];for(const _0x4a1fb7 of _0x232963){if(!_0x4a1fb7[_0x3c0fc5(0xc3)][_0x3c0fc5(0xb5)]&&!_0x4a1fb7[_0x3c0fc5(0xe5)][_0x3c0fc5(0xb5)]&&!_0x4a1fb7[_0x3c0fc5(0xdb)]['length'])continue;const _0x23a293=new salesforce_components_manager_service_1[(_0x3c0fc5(0xc8))](this['options']['repositoryId'],this['options'][_0x3c0fc5(0xe4)],_0x4a1fb7[_0x3c0fc5(0xc0)],this[_0x3c0fc5(0xe2)]['recordTypes'],[]);_0x418766[_0x3c0fc5(0xba)](...await _0x23a293[_0x3c0fc5(0xc7)](_0x4a1fb7[_0x3c0fc5(0xc3)])),_0x418766[_0x3c0fc5(0xba)](...await _0x23a293[_0x3c0fc5(0xf5)](_0x4a1fb7[_0x3c0fc5(0xe5)])),_0xf1f887[_0x3c0fc5(0xba)](await _0x23a293[_0x3c0fc5(0xed)](_0x4a1fb7[_0x3c0fc5(0xdb)]));}this['logger']['log'](_0x3c0fc5(0xef),_0x418766[_0x3c0fc5(0xb5)]),await this[_0x3c0fc5(0xec)](_0x418766);const _0x10b4e9=_0xf1f887[_0x3c0fc5(0xf4)]((_0x1c2878,_0x432eee)=>({'manifests':[..._0x1c2878['manifests'],..._0x432eee['manifests']],'componentsToDelete':[..._0x1c2878[_0x3c0fc5(0xcb)],..._0x432eee['componentsToDelete']],'componentsToUpdate':[..._0x1c2878[_0x3c0fc5(0xf3)],..._0x432eee['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x10b4e9['manifests']['length']&&await this[_0x3c0fc5(0xec)](_0x10b4e9[_0x3c0fc5(0xf0)],!![]),_0x10b4e9['componentsToUpdate'][_0x3c0fc5(0xb5)]&&await this[_0x3c0fc5(0xec)](_0x10b4e9[_0x3c0fc5(0xf3)],!![]),_0x10b4e9['componentsToDelete'][_0x3c0fc5(0xb5)]&&await this[_0x3c0fc5(0xec)](_0x10b4e9[_0x3c0fc5(0xcb)],!![]);}async['proceedCommits'](_0x98db21){const _0x1fff70=a181_0x52d931;this[_0x1fff70(0xe2)][_0x1fff70(0xe4)]?await this['proceedCommitsToBranch'](_0x98db21):await this[_0x1fff70(0xee)](_0x98db21);}}exports['SalesforceCommitsManager']=SalesforceCommitsManager;