const a243_0xb7eeab=a243_0x3b8d;(function(_0x8ca6ec,_0x382dd7){const _0x143cc4=a243_0x3b8d,_0x2968b1=_0x8ca6ec();while(!![]){try{const _0x5b4f24=parseInt(_0x143cc4(0xd3))/0x1+parseInt(_0x143cc4(0xf7))/0x2*(parseInt(_0x143cc4(0xec))/0x3)+-parseInt(_0x143cc4(0xe5))/0x4+parseInt(_0x143cc4(0xc9))/0x5+-parseInt(_0x143cc4(0xe3))/0x6+parseInt(_0x143cc4(0xc3))/0x7*(-parseInt(_0x143cc4(0xd5))/0x8)+parseInt(_0x143cc4(0xe1))/0x9;if(_0x5b4f24===_0x382dd7)break;else _0x2968b1['push'](_0x2968b1['shift']());}catch(_0x296c65){_0x2968b1['push'](_0x2968b1['shift']());}}}(a243_0x1e6f,0xbde48));const a243_0x34a4dd=(function(){let _0xcccf57=!![];return function(_0x31fd27,_0x4d9dce){const _0x35e246=_0xcccf57?function(){const _0x637a9a=a243_0x3b8d;if(_0x4d9dce){const _0x416f20=_0x4d9dce[_0x637a9a(0xda)](_0x31fd27,arguments);return _0x4d9dce=null,_0x416f20;}}:function(){};return _0xcccf57=![],_0x35e246;};}()),a243_0x4d398d=a243_0x34a4dd(this,function(){const _0x4a1e98=a243_0x3b8d;return a243_0x4d398d[_0x4a1e98(0xd4)]()['search'](_0x4a1e98(0xcb))[_0x4a1e98(0xd4)]()[_0x4a1e98(0x10c)](a243_0x4d398d)[_0x4a1e98(0xe4)](_0x4a1e98(0xcb));});a243_0x4d398d();function a243_0x3b8d(_0x5c3c62,_0x128c68){const _0x19ee72=a243_0x1e6f();return a243_0x3b8d=function(_0x4d398d,_0x34a4dd){_0x4d398d=_0x4d398d-0xc3;let _0x1e6fbf=_0x19ee72[_0x4d398d];return _0x1e6fbf;},a243_0x3b8d(_0x5c3c62,_0x128c68);}'use strict';var __importDefault=this&&this[a243_0xb7eeab(0xef)]||function(_0x25843f){const _0x57d022=a243_0xb7eeab;return _0x25843f&&_0x25843f[_0x57d022(0xdd)]?_0x25843f:{'default':_0x25843f};};function a243_0x1e6f(){const _0x1c057a=['\x20requests\x20to\x20composite\x20api.','graph','push','proceedCommitsToBranch','SalesforceComponentsManager','map','getProceededComponentsMeta','modified','commitId','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','stringify','recordTypes','../../../../constants','\x20COMPONENTS_SIZE\x20=\x20','constructor','../utils/composite.utils','delete','reduce','7CyNbam','SalesforceError','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','defineProperty','composite','../../../shared/utils','3821615athslM','floor','(((.+)+)+)+$','componentsToUpdate','branchId','proceededComponentsMeta','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','length','proceedChunksToUpload','componentsToDelete','666955bjWQHS','toString','10563104LjEJtz','../../../../core','log','proceedCommits','update','apply','default','author','__esModule','logger','options','componentId','1903842DzLJaY','extractComponentIdsFromGraphsResponse','1550058LIxUXo','search','183108GgLTdm','inserted','./salesforce-components-manager.service','SalesforceCommitsManager','proceedRequests','manifests','COMPONENTS_PER_CHUNK','27PpNMQU','insert','removed','__importDefault','../errors/salesforce.error','executeGraphs','find','toJSON','proceedCommitsToRepository','SALESFORCE_MAX_REQUEST_SIZE_BYTES','Sending\x20','168776qYivye','sfLogger','typedi','name','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','get','SalesforceCompositeService'];a243_0x1e6f=function(){return _0x1c057a;};return a243_0x1e6f();}Object[a243_0xb7eeab(0xc6)](exports,a243_0xb7eeab(0xdd),{'value':!![]}),exports[a243_0xb7eeab(0xe8)]=void 0x0;const core_1=require(a243_0xb7eeab(0xd6)),typedi_1=__importDefault(require(a243_0xb7eeab(0xf9))),constants_1=require(a243_0xb7eeab(0x10a)),utils_1=require(a243_0xb7eeab(0xc8)),salesforce_error_1=require(a243_0xb7eeab(0xf0)),composite_utils_1=require(a243_0xb7eeab(0x10d)),salesforce_components_manager_service_1=require(a243_0xb7eeab(0xe7)),salesforce_composite_service_1=require('./salesforce-composite.service');class SalesforceCommitsManager{constructor(_0x2f4ad9){const _0x144bfc=a243_0xb7eeab;this[_0x144bfc(0xdf)]=_0x2f4ad9,this[_0x144bfc(0xeb)]=0x3,this[_0x144bfc(0xde)]=new core_1['Logger'](SalesforceCommitsManager[_0x144bfc(0xfa)]),this[_0x144bfc(0xf8)]=this['options']['logger'],this[_0x144bfc(0xc7)]=typedi_1[_0x144bfc(0xdb)][_0x144bfc(0xfc)](salesforce_composite_service_1[_0x144bfc(0xfd)]),this[_0x144bfc(0xce)]=[];}async['proceedChunksToUpload'](_0x16e824,_0x3057a5=![]){const _0x10d08d=a243_0xb7eeab,_0x2ed8b5=async _0x3834ad=>{const _0x51ad47=a243_0x3b8d;await this[_0x51ad47(0xde)][_0x51ad47(0xd7)](_0x51ad47(0xf6)+_0x3834ad[_0x51ad47(0x10f)]((_0xea8d23,_0x405556)=>_0xea8d23+_0x405556[_0x51ad47(0xd0)],0x0)+_0x51ad47(0xfe));const _0x437922=_0x3834ad[_0x51ad47(0x103)]((_0x5d0e10,_0x39f84c)=>({'graphId':_0x51ad47(0xff)+_0x39f84c,'compositeRequest':_0x5d0e10})),_0x3a19e9=await this[_0x51ad47(0xc7)][_0x51ad47(0xf1)](_0x437922);if(_0x3057a5){const _0x30282c=(0x0,composite_utils_1[_0x51ad47(0xe2)])(_0x3a19e9);for(const {id:_0x58e555,ref:_0x3af7bd}of _0x30282c){const _0x293861=this['proceededComponentsMeta'][_0x51ad47(0xf2)](_0xeff92d=>_0xeff92d['reference']===_0x3af7bd);_0x293861&&(_0x293861[_0x51ad47(0xe0)]=_0x58e555);}}},_0x76a88b=0x1e8480;let _0x20871f=0x0,_0x1dbf58=[];for(const _0x297b2c of _0x16e824){const _0x11099f=_0x297b2c['reduce']((_0x19c7d3,_0x342a31)=>{const _0x4938f4=a243_0x3b8d,_0x4c5b31=JSON[_0x4938f4(0x108)](_0x342a31)[_0x4938f4(0xd0)]*0x2;return _0x19c7d3+_0x4c5b31;},0x0);if(_0x11099f>constants_1[_0x10d08d(0xf5)])throw new salesforce_error_1['SalesforceError'](_0x10d08d(0x107)+constants_1[_0x10d08d(0xf5)]+_0x10d08d(0x10b)+_0x11099f);_0x20871f+_0x11099f>constants_1[_0x10d08d(0xf5)]-_0x76a88b&&(await _0x2ed8b5(_0x1dbf58),_0x1dbf58=[],_0x20871f=0x0),_0x20871f+=_0x11099f,_0x1dbf58[_0x10d08d(0x100)](_0x297b2c);}_0x1dbf58[_0x10d08d(0xd0)]&&await _0x2ed8b5(_0x1dbf58);}async['proceedRequests'](_0x439ff9,_0x21629d=![]){const _0x23878a=a243_0xb7eeab,_0x3bc344=(this[_0x23878a(0xeb)]+ +_0x21629d)*0x3,_0xb38460=(0x0,utils_1['chunkArray'])(_0x439ff9,_0x3bc344);try{while(_0xb38460['length']){const _0x21fa5f=_0xb38460['splice'](0x0,Math[_0x23878a(0xca)](constants_1[_0x23878a(0xfb)]/_0x3bc344));await this[_0x23878a(0xd1)](_0x21fa5f,_0x21629d);}}catch(_0x14ae0f){this[_0x23878a(0xde)]['error'](_0x14ae0f instanceof salesforce_error_1[_0x23878a(0xc4)]?JSON[_0x23878a(0x108)](_0x14ae0f[_0x23878a(0xf3)](),null,0x2):_0x14ae0f),this[_0x23878a(0xf8)][_0x23878a(0xd7)](_0x14ae0f instanceof salesforce_error_1[_0x23878a(0xc4)]?JSON[_0x23878a(0x108)](_0x14ae0f[_0x23878a(0xf3)](),null,0x2):_0x14ae0f['toString']());throw _0x14ae0f;}}async[a243_0xb7eeab(0xf4)](_0x1028e7){const _0x248e1e=a243_0xb7eeab;for(const _0x278d4a of _0x1028e7){if(!_0x278d4a[_0x248e1e(0xe6)][_0x248e1e(0xd0)]&&!_0x278d4a[_0x248e1e(0x105)][_0x248e1e(0xd0)]&&!_0x278d4a[_0x248e1e(0xee)][_0x248e1e(0xd0)])continue;const _0x1ec43e=[],_0x534b43=[],_0xccfd54=new salesforce_components_manager_service_1[(_0x248e1e(0x102))](this[_0x248e1e(0xdf)]['repositoryId'],this[_0x248e1e(0xdf)][_0x248e1e(0xcd)],_0x278d4a[_0x248e1e(0xdc)],this[_0x248e1e(0xdf)]['recordTypes'],this['proceededComponentsMeta']);_0x1ec43e['push'](...await _0xccfd54['insert'](_0x278d4a[_0x248e1e(0xe6)],this[_0x248e1e(0xdf)]['commitId'])),_0x1ec43e[_0x248e1e(0x100)](...await _0xccfd54[_0x248e1e(0xd9)](_0x278d4a[_0x248e1e(0x105)],this[_0x248e1e(0xdf)][_0x248e1e(0x106)])),_0x534b43[_0x248e1e(0x100)](await _0xccfd54['delete'](_0x278d4a['removed'],!![])),this[_0x248e1e(0xce)]=_0xccfd54[_0x248e1e(0x104)](),await this[_0x248e1e(0xe9)](_0x1ec43e,!![]);for(const _0x56d82c of _0x534b43){_0x56d82c[_0x248e1e(0xea)]['length']&&await this[_0x248e1e(0xe9)](_0x56d82c['manifests'],!![]),_0x56d82c[_0x248e1e(0xcc)][_0x248e1e(0xd0)]&&await this['proceedRequests'](_0x56d82c[_0x248e1e(0xcc)],!![]),_0x56d82c[_0x248e1e(0xd2)]['length']&&await this['proceedRequests'](_0x56d82c[_0x248e1e(0xd2)],!![]);}this[_0x248e1e(0xde)][_0x248e1e(0xd7)](_0x248e1e(0xcf),_0x1ec43e[_0x248e1e(0xd0)]);}}async[a243_0xb7eeab(0x101)](_0x47c2b1){const _0x4495a4=a243_0xb7eeab,_0xc71f6b=[],_0x4cabfc=[];for(const _0x450a56 of _0x47c2b1){if(!_0x450a56[_0x4495a4(0xe6)][_0x4495a4(0xd0)]&&!_0x450a56['modified'][_0x4495a4(0xd0)]&&!_0x450a56[_0x4495a4(0xee)][_0x4495a4(0xd0)])continue;const _0x4a1609=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this['options']['repositoryId'],this[_0x4495a4(0xdf)]['branchId'],_0x450a56[_0x4495a4(0xdc)],this[_0x4495a4(0xdf)][_0x4495a4(0x109)],[]);_0xc71f6b[_0x4495a4(0x100)](...await _0x4a1609[_0x4495a4(0xed)](_0x450a56[_0x4495a4(0xe6)])),_0xc71f6b[_0x4495a4(0x100)](...await _0x4a1609[_0x4495a4(0xd9)](_0x450a56['modified'])),_0x4cabfc[_0x4495a4(0x100)](await _0x4a1609[_0x4495a4(0x10e)](_0x450a56[_0x4495a4(0xee)]));}this['logger'][_0x4495a4(0xd7)](_0x4495a4(0xc5),_0xc71f6b[_0x4495a4(0xd0)]),await this[_0x4495a4(0xe9)](_0xc71f6b);const _0x4808d2=_0x4cabfc[_0x4495a4(0x10f)]((_0x5261b8,_0x2fdf7e)=>({'manifests':[..._0x5261b8[_0x4495a4(0xea)],..._0x2fdf7e['manifests']],'componentsToDelete':[..._0x5261b8[_0x4495a4(0xd2)],..._0x2fdf7e[_0x4495a4(0xd2)]],'componentsToUpdate':[..._0x5261b8[_0x4495a4(0xcc)],..._0x2fdf7e[_0x4495a4(0xcc)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x4808d2[_0x4495a4(0xea)][_0x4495a4(0xd0)]&&await this[_0x4495a4(0xe9)](_0x4808d2['manifests'],!![]),_0x4808d2[_0x4495a4(0xcc)][_0x4495a4(0xd0)]&&await this['proceedRequests'](_0x4808d2[_0x4495a4(0xcc)],!![]),_0x4808d2[_0x4495a4(0xd2)]['length']&&await this[_0x4495a4(0xe9)](_0x4808d2[_0x4495a4(0xd2)],!![]);}async[a243_0xb7eeab(0xd8)](_0x226fec){const _0x16af34=a243_0xb7eeab;this['options'][_0x16af34(0xcd)]?await this[_0x16af34(0x101)](_0x226fec):await this['proceedCommitsToRepository'](_0x226fec);}}exports[a243_0xb7eeab(0xe8)]=SalesforceCommitsManager;