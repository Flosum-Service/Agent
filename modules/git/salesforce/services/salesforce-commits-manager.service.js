const a272_0x3d62de=a272_0xc4d8;(function(_0x1a5a1b,_0x53fd4f){const _0x403c50=a272_0xc4d8,_0x368ec5=_0x1a5a1b();while(!![]){try{const _0x54bfa3=parseInt(_0x403c50(0x14f))/0x1*(-parseInt(_0x403c50(0x153))/0x2)+-parseInt(_0x403c50(0x137))/0x3+-parseInt(_0x403c50(0x152))/0x4+parseInt(_0x403c50(0x161))/0x5+-parseInt(_0x403c50(0x145))/0x6+-parseInt(_0x403c50(0x130))/0x7+parseInt(_0x403c50(0x159))/0x8;if(_0x54bfa3===_0x53fd4f)break;else _0x368ec5['push'](_0x368ec5['shift']());}catch(_0x4b2fd3){_0x368ec5['push'](_0x368ec5['shift']());}}}(a272_0x3608,0xe7b73));const a272_0x4fe57f=(function(){let _0x1ea442=!![];return function(_0x1c5843,_0x31f103){const _0x397f3b=_0x1ea442?function(){const _0x132607=a272_0xc4d8;if(_0x31f103){const _0x59cf25=_0x31f103[_0x132607(0x173)](_0x1c5843,arguments);return _0x31f103=null,_0x59cf25;}}:function(){};return _0x1ea442=![],_0x397f3b;};}()),a272_0x21a5c0=a272_0x4fe57f(this,function(){const _0x3ad2c7=a272_0xc4d8;return a272_0x21a5c0['toString']()[_0x3ad2c7(0x13b)]('(((.+)+)+)+$')[_0x3ad2c7(0x170)]()[_0x3ad2c7(0x16b)](a272_0x21a5c0)[_0x3ad2c7(0x13b)](_0x3ad2c7(0x13f));});a272_0x21a5c0();function a272_0xc4d8(_0x124c4d,_0x30ff92){const _0x34efd5=a272_0x3608();return a272_0xc4d8=function(_0x21a5c0,_0x4fe57f){_0x21a5c0=_0x21a5c0-0x130;let _0x360844=_0x34efd5[_0x21a5c0];return _0x360844;},a272_0xc4d8(_0x124c4d,_0x30ff92);}function a272_0x3608(){const _0x12751a=['find','proceededComponentsMeta','Logger','insert','../../../shared/utils','__esModule','2865840tJKpHy','stringify','sfLogger','branchId','update','error','proceedCommitsToRepository','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','manifests','push','constructor','proceedRequests','commitId','length','options','toString','SALESFORCE_MAX_REQUEST_SIZE_BYTES','proceedCommitsToBranch','apply','\x20requests\x20to\x20composite\x20api.','SalesforceCommitsManager','composite','COMPONENTS_PER_CHUNK','7729106fgLnaF','recordTypes','log','\x20COMPONENTS_SIZE\x20=\x20','delete','SalesforceCompositeService','../../../../constants','5253309pkLPzm','graph','componentsToDelete','getProceededComponentsMeta','search','modified','inserted','logger','(((.+)+)+)+$','./salesforce-composite.service','../../../../core','reduce','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','repositoryId','8099568ZaSmCh','componentId','typedi','SalesforceComponentsManager','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','author','Sending\x20','extractComponentIdsFromGraphsResponse','componentsToUpdate','removed','3KJUPfR','toJSON','splice','4530336vAXrKp','1113872xFykLH','defineProperty','reference','executeGraphs','SalesforceError','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','59076160lOELrC','__importDefault'];a272_0x3608=function(){return _0x12751a;};return a272_0x3608();}'use strict';var __importDefault=this&&this[a272_0x3d62de(0x15a)]||function(_0x2e8e11){return _0x2e8e11&&_0x2e8e11['__esModule']?_0x2e8e11:{'default':_0x2e8e11};};Object[a272_0x3d62de(0x154)](exports,a272_0x3d62de(0x160),{'value':!![]}),exports[a272_0x3d62de(0x175)]=void 0x0;const core_1=require(a272_0x3d62de(0x141)),typedi_1=__importDefault(require(a272_0x3d62de(0x147))),constants_1=require(a272_0x3d62de(0x136)),utils_1=require(a272_0x3d62de(0x15f)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require('./salesforce-components-manager.service'),salesforce_composite_service_1=require(a272_0x3d62de(0x140));class SalesforceCommitsManager{constructor(_0x50dcb1){const _0x4e41fa=a272_0x3d62de;this['options']=_0x50dcb1,this[_0x4e41fa(0x177)]=0x3,this[_0x4e41fa(0x13e)]=new core_1[(_0x4e41fa(0x15d))](SalesforceCommitsManager['name']),this[_0x4e41fa(0x163)]=this['options']['logger'],this[_0x4e41fa(0x176)]=typedi_1['default']['get'](salesforce_composite_service_1[_0x4e41fa(0x135)]),this[_0x4e41fa(0x15c)]=[];}async['proceedChunksToUpload'](_0x467fda,_0x5e309b=![]){const _0x412fdc=a272_0x3d62de,_0x34806c=async _0x553277=>{const _0x1ef72a=a272_0xc4d8;await this[_0x1ef72a(0x13e)][_0x1ef72a(0x132)](_0x1ef72a(0x14b)+_0x553277['reduce']((_0x5e9bab,_0x13f317)=>_0x5e9bab+_0x13f317[_0x1ef72a(0x16e)],0x0)+_0x1ef72a(0x174));const _0x1aeca6=_0x553277['map']((_0x214a60,_0x3c91b4)=>({'graphId':_0x1ef72a(0x138)+_0x3c91b4,'compositeRequest':_0x214a60})),_0x3379b3=await this[_0x1ef72a(0x176)][_0x1ef72a(0x156)](_0x1aeca6);if(_0x5e309b){const _0x98d817=(0x0,composite_utils_1[_0x1ef72a(0x14c)])(_0x3379b3);for(const {id:_0x482259,ref:_0x1b1222}of _0x98d817){const _0x2ea176=this[_0x1ef72a(0x15c)][_0x1ef72a(0x15b)](_0x3393d3=>_0x3393d3[_0x1ef72a(0x155)]===_0x1b1222);_0x2ea176&&(_0x2ea176[_0x1ef72a(0x146)]=_0x482259);}}},_0x1d3a7b=0x1e8480;let _0x1e1b16=0x0,_0x315e31=[];for(const _0x5f5091 of _0x467fda){const _0x5180bd=_0x5f5091[_0x412fdc(0x142)]((_0x46ae93,_0x48d30d)=>{const _0x576c00=_0x412fdc,_0x5994b9=JSON['stringify'](_0x48d30d)[_0x576c00(0x16e)]*0x2;return _0x46ae93+_0x5994b9;},0x0);if(_0x5180bd>constants_1[_0x412fdc(0x171)])throw new salesforce_error_1['SalesforceError'](_0x412fdc(0x158)+constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']+_0x412fdc(0x133)+_0x5180bd);_0x1e1b16+_0x5180bd>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']-_0x1d3a7b&&(await _0x34806c(_0x315e31),_0x315e31=[],_0x1e1b16=0x0),_0x1e1b16+=_0x5180bd,_0x315e31[_0x412fdc(0x16a)](_0x5f5091);}_0x315e31['length']&&await _0x34806c(_0x315e31);}async['proceedRequests'](_0x52420c,_0x512471=![]){const _0xc42a2=a272_0x3d62de,_0x702741=(this[_0xc42a2(0x177)]+ +_0x512471)*0x3,_0x3a65d1=(0x0,utils_1['chunkArray'])(_0x52420c,_0x702741);try{while(_0x3a65d1['length']){const _0x2b25f4=_0x3a65d1[_0xc42a2(0x151)](0x0,Math['floor'](constants_1[_0xc42a2(0x168)]/_0x702741));await this['proceedChunksToUpload'](_0x2b25f4,_0x512471);}}catch(_0x5efb7d){this['logger'][_0xc42a2(0x166)](_0x5efb7d instanceof salesforce_error_1[_0xc42a2(0x157)]?JSON[_0xc42a2(0x162)](_0x5efb7d[_0xc42a2(0x150)](),null,0x2):_0x5efb7d),this[_0xc42a2(0x163)]['log'](_0x5efb7d instanceof salesforce_error_1[_0xc42a2(0x157)]?JSON[_0xc42a2(0x162)](_0x5efb7d[_0xc42a2(0x150)](),null,0x2):_0x5efb7d[_0xc42a2(0x170)]());throw _0x5efb7d;}}async[a272_0x3d62de(0x167)](_0x5c8d0b){const _0x2ca47a=a272_0x3d62de;for(const _0x7ae4d7 of _0x5c8d0b){if(!_0x7ae4d7[_0x2ca47a(0x13d)][_0x2ca47a(0x16e)]&&!_0x7ae4d7['modified'][_0x2ca47a(0x16e)]&&!_0x7ae4d7[_0x2ca47a(0x14e)][_0x2ca47a(0x16e)])continue;const _0x323830=[],_0x92cac=[],_0x18178c=new salesforce_components_manager_service_1[(_0x2ca47a(0x148))](this['options'][_0x2ca47a(0x144)],this['options'][_0x2ca47a(0x164)],_0x7ae4d7[_0x2ca47a(0x14a)],this[_0x2ca47a(0x16f)][_0x2ca47a(0x131)],this[_0x2ca47a(0x15c)]);_0x323830['push'](...await _0x18178c['insert'](_0x7ae4d7[_0x2ca47a(0x13d)],this['options'][_0x2ca47a(0x16d)])),_0x323830[_0x2ca47a(0x16a)](...await _0x18178c[_0x2ca47a(0x165)](_0x7ae4d7['modified'],this[_0x2ca47a(0x16f)][_0x2ca47a(0x16d)])),_0x92cac[_0x2ca47a(0x16a)](await _0x18178c['delete'](_0x7ae4d7['removed'],!![])),this['proceededComponentsMeta']=_0x18178c[_0x2ca47a(0x13a)](),await this[_0x2ca47a(0x16c)](_0x323830,!![]);for(const _0x2495ad of _0x92cac){_0x2495ad[_0x2ca47a(0x169)][_0x2ca47a(0x16e)]&&await this['proceedRequests'](_0x2495ad[_0x2ca47a(0x169)],!![]),_0x2495ad[_0x2ca47a(0x14d)]['length']&&await this[_0x2ca47a(0x16c)](_0x2495ad['componentsToUpdate'],!![]),_0x2495ad[_0x2ca47a(0x139)]['length']&&await this[_0x2ca47a(0x16c)](_0x2495ad[_0x2ca47a(0x139)],!![]);}this[_0x2ca47a(0x13e)]['log'](_0x2ca47a(0x149),_0x323830[_0x2ca47a(0x16e)]);}}async[a272_0x3d62de(0x172)](_0x100227){const _0xff0405=a272_0x3d62de,_0x22d56c=[],_0x40ebdd=[];for(const _0x5703d3 of _0x100227){if(!_0x5703d3['inserted'][_0xff0405(0x16e)]&&!_0x5703d3['modified'][_0xff0405(0x16e)]&&!_0x5703d3[_0xff0405(0x14e)][_0xff0405(0x16e)])continue;const _0x2ff0d9=new salesforce_components_manager_service_1[(_0xff0405(0x148))](this['options']['repositoryId'],this[_0xff0405(0x16f)]['branchId'],_0x5703d3[_0xff0405(0x14a)],this['options']['recordTypes'],[]);_0x22d56c[_0xff0405(0x16a)](...await _0x2ff0d9[_0xff0405(0x15e)](_0x5703d3[_0xff0405(0x13d)])),_0x22d56c['push'](...await _0x2ff0d9[_0xff0405(0x165)](_0x5703d3[_0xff0405(0x13c)])),_0x40ebdd[_0xff0405(0x16a)](await _0x2ff0d9[_0xff0405(0x134)](_0x5703d3['removed']));}this['logger'][_0xff0405(0x132)](_0xff0405(0x143),_0x22d56c[_0xff0405(0x16e)]),await this[_0xff0405(0x16c)](_0x22d56c);const _0x4943af=_0x40ebdd['reduce']((_0xdf15d6,_0x642002)=>({'manifests':[..._0xdf15d6[_0xff0405(0x169)],..._0x642002[_0xff0405(0x169)]],'componentsToDelete':[..._0xdf15d6[_0xff0405(0x139)],..._0x642002['componentsToDelete']],'componentsToUpdate':[..._0xdf15d6[_0xff0405(0x14d)],..._0x642002[_0xff0405(0x14d)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x4943af[_0xff0405(0x169)][_0xff0405(0x16e)]&&await this[_0xff0405(0x16c)](_0x4943af[_0xff0405(0x169)],!![]),_0x4943af[_0xff0405(0x14d)]['length']&&await this[_0xff0405(0x16c)](_0x4943af['componentsToUpdate'],!![]),_0x4943af['componentsToDelete'][_0xff0405(0x16e)]&&await this[_0xff0405(0x16c)](_0x4943af[_0xff0405(0x139)],!![]);}async['proceedCommits'](_0x418d22){const _0x3db139=a272_0x3d62de;this[_0x3db139(0x16f)][_0x3db139(0x164)]?await this[_0x3db139(0x172)](_0x418d22):await this[_0x3db139(0x167)](_0x418d22);}}exports[a272_0x3d62de(0x175)]=SalesforceCommitsManager;