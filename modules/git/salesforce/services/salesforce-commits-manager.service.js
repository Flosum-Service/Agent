const a271_0x41aa2f=a271_0x2de3;(function(_0x137605,_0x10dff9){const _0x2c55b0=a271_0x2de3,_0x149f0d=_0x137605();while(!![]){try{const _0x436bdb=-parseInt(_0x2c55b0(0xd3))/0x1+-parseInt(_0x2c55b0(0xd1))/0x2+parseInt(_0x2c55b0(0xca))/0x3+parseInt(_0x2c55b0(0xe3))/0x4*(-parseInt(_0x2c55b0(0xb5))/0x5)+-parseInt(_0x2c55b0(0xb3))/0x6+-parseInt(_0x2c55b0(0xe5))/0x7*(parseInt(_0x2c55b0(0xf9))/0x8)+-parseInt(_0x2c55b0(0xb0))/0x9*(-parseInt(_0x2c55b0(0xda))/0xa);if(_0x436bdb===_0x10dff9)break;else _0x149f0d['push'](_0x149f0d['shift']());}catch(_0x5f325d){_0x149f0d['push'](_0x149f0d['shift']());}}}(a271_0xb3ce,0xdfa0b));const a271_0x2b2aad=(function(){let _0x74a2da=!![];return function(_0x20cf19,_0xb52c74){const _0xb0ebaf=_0x74a2da?function(){const _0x5d8157=a271_0x2de3;if(_0xb52c74){const _0x296684=_0xb52c74[_0x5d8157(0xe2)](_0x20cf19,arguments);return _0xb52c74=null,_0x296684;}}:function(){};return _0x74a2da=![],_0xb0ebaf;};}()),a271_0x3b2d9c=a271_0x2b2aad(this,function(){const _0x30036d=a271_0x2de3;return a271_0x3b2d9c[_0x30036d(0xcf)]()['search'](_0x30036d(0xc7))[_0x30036d(0xcf)]()[_0x30036d(0xe8)](a271_0x3b2d9c)[_0x30036d(0xf6)](_0x30036d(0xc7));});a271_0x3b2d9c();'use strict';function a271_0x2de3(_0x13d173,_0x4e3b8b){const _0x428cb4=a271_0xb3ce();return a271_0x2de3=function(_0x3b2d9c,_0x2b2aad){_0x3b2d9c=_0x3b2d9c-0xaf;let _0xb3ce10=_0x428cb4[_0x3b2d9c];return _0xb3ce10;},a271_0x2de3(_0x13d173,_0x4e3b8b);}var __importDefault=this&&this[a271_0x41aa2f(0xb1)]||function(_0x5a77b2){const _0x2af1a7=a271_0x41aa2f;return _0x5a77b2&&_0x5a77b2[_0x2af1a7(0xd4)]?_0x5a77b2:{'default':_0x5a77b2};};Object['defineProperty'](exports,a271_0x41aa2f(0xd4),{'value':!![]}),exports[a271_0x41aa2f(0xbb)]=void 0x0;function a271_0xb3ce(){const _0xdaf566=['368jDNDaH','typedi','7uPuWJo','logger','push','constructor','get','default','branchId','reduce','options','name','SalesforceError','repositoryId','componentsToDelete','author','../errors/salesforce.error','insert','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','search','proceedRequests','SalesforceComponentsManager','13929864ZvxndI','inserted','removed','SalesforceCompositeService','composite','54oxyaNg','__importDefault','proceedChunksToUpload','8992602wMJIAz','commitId','69690yaLeHB','../utils/composite.utils','proceedCommits','error','chunkArray','Sending\x20','SalesforceCommitsManager','recordTypes','proceededComponentsMeta','length','COMPONENTS_PER_CHUNK','getProceededComponentsMeta','SALESFORCE_MAX_REQUEST_SIZE_BYTES','toJSON','Logger','stringify','splice','extractComponentIdsFromGraphsResponse','(((.+)+)+)+$','\x20requests\x20to\x20composite\x20api.','reference','5195574fjtCpn','modified','proceedCommitsToRepository','\x20COMPONENTS_SIZE\x20=\x20','../../../../core','toString','../../../shared/utils','3229224ZTsrrP','componentsToUpdate','952229toIoQb','__esModule','./salesforce-components-manager.service','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','sfLogger','./salesforce-composite.service','update','10455430rjgWFI','log','executeGraphs','find','delete','manifests','floor','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','apply'];a271_0xb3ce=function(){return _0xdaf566;};return a271_0xb3ce();}const core_1=require(a271_0x41aa2f(0xce)),typedi_1=__importDefault(require(a271_0x41aa2f(0xe4))),constants_1=require('../../../../constants'),utils_1=require(a271_0x41aa2f(0xd0)),salesforce_error_1=require(a271_0x41aa2f(0xf3)),composite_utils_1=require(a271_0x41aa2f(0xb6)),salesforce_components_manager_service_1=require(a271_0x41aa2f(0xd5)),salesforce_composite_service_1=require(a271_0x41aa2f(0xd8));class SalesforceCommitsManager{constructor(_0xb9f47e){const _0x89d86d=a271_0x41aa2f;this[_0x89d86d(0xed)]=_0xb9f47e,this[_0x89d86d(0xbf)]=0x3,this[_0x89d86d(0xe6)]=new core_1[(_0x89d86d(0xc3))](SalesforceCommitsManager[_0x89d86d(0xee)]),this[_0x89d86d(0xd7)]=this[_0x89d86d(0xed)]['logger'],this[_0x89d86d(0xaf)]=typedi_1[_0x89d86d(0xea)][_0x89d86d(0xe9)](salesforce_composite_service_1[_0x89d86d(0xfc)]),this['proceededComponentsMeta']=[];}async[a271_0x41aa2f(0xb2)](_0x3c19dd,_0x4a8c10=![]){const _0x7b3eef=a271_0x41aa2f,_0x3a2d2b=async _0x10f2ed=>{const _0x3d3764=a271_0x2de3;await this[_0x3d3764(0xe6)][_0x3d3764(0xdb)](_0x3d3764(0xba)+_0x10f2ed['reduce']((_0x5761cf,_0x96150a)=>_0x5761cf+_0x96150a[_0x3d3764(0xbe)],0x0)+_0x3d3764(0xc8));const _0x5f43a7=_0x10f2ed['map']((_0xe3fda,_0x369dfc)=>({'graphId':'graph'+_0x369dfc,'compositeRequest':_0xe3fda})),_0x4b4c3c=await this[_0x3d3764(0xaf)][_0x3d3764(0xdc)](_0x5f43a7);if(_0x4a8c10){const _0x5daddb=(0x0,composite_utils_1[_0x3d3764(0xc6)])(_0x4b4c3c);for(const {id:_0x5596a7,ref:_0x39047d}of _0x5daddb){const _0x245f64=this[_0x3d3764(0xbd)][_0x3d3764(0xdd)](_0x136a12=>_0x136a12[_0x3d3764(0xc9)]===_0x39047d);_0x245f64&&(_0x245f64['componentId']=_0x5596a7);}}},_0x3c2c0a=0x1e8480;let _0x151247=0x0,_0x239e5b=[];for(const _0x454c3a of _0x3c19dd){const _0x136759=_0x454c3a['reduce']((_0x4f07bc,_0x5edc4d)=>{const _0x43768b=a271_0x2de3,_0x402ecd=JSON['stringify'](_0x5edc4d)[_0x43768b(0xbe)]*0x2;return _0x4f07bc+_0x402ecd;},0x0);if(_0x136759>constants_1[_0x7b3eef(0xc1)])throw new salesforce_error_1[(_0x7b3eef(0xef))](_0x7b3eef(0xd6)+constants_1[_0x7b3eef(0xc1)]+_0x7b3eef(0xcd)+_0x136759);_0x151247+_0x136759>constants_1[_0x7b3eef(0xc1)]-_0x3c2c0a&&(await _0x3a2d2b(_0x239e5b),_0x239e5b=[],_0x151247=0x0),_0x151247+=_0x136759,_0x239e5b['push'](_0x454c3a);}_0x239e5b[_0x7b3eef(0xbe)]&&await _0x3a2d2b(_0x239e5b);}async[a271_0x41aa2f(0xf7)](_0x3939f1,_0x382f9a=![]){const _0x23a4aa=a271_0x41aa2f,_0x540758=(this[_0x23a4aa(0xbf)]+ +_0x382f9a)*0x3,_0x36c56d=(0x0,utils_1[_0x23a4aa(0xb9)])(_0x3939f1,_0x540758);try{while(_0x36c56d[_0x23a4aa(0xbe)]){const _0x160b8d=_0x36c56d[_0x23a4aa(0xc5)](0x0,Math[_0x23a4aa(0xe0)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x540758));await this[_0x23a4aa(0xb2)](_0x160b8d,_0x382f9a);}}catch(_0x33c0fe){this[_0x23a4aa(0xe6)][_0x23a4aa(0xb8)](_0x33c0fe instanceof salesforce_error_1['SalesforceError']?JSON[_0x23a4aa(0xc4)](_0x33c0fe[_0x23a4aa(0xc2)](),null,0x2):_0x33c0fe),this[_0x23a4aa(0xd7)][_0x23a4aa(0xdb)](_0x33c0fe instanceof salesforce_error_1[_0x23a4aa(0xef)]?JSON['stringify'](_0x33c0fe[_0x23a4aa(0xc2)](),null,0x2):_0x33c0fe['toString']());throw _0x33c0fe;}}async[a271_0x41aa2f(0xcc)](_0x58f7f1){const _0x195570=a271_0x41aa2f;for(const _0x1843b8 of _0x58f7f1){if(!_0x1843b8[_0x195570(0xfa)][_0x195570(0xbe)]&&!_0x1843b8[_0x195570(0xcb)][_0x195570(0xbe)]&&!_0x1843b8['removed'][_0x195570(0xbe)])continue;const _0x10c78a=[],_0x4142b4=[],_0x19aaa3=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this['options'][_0x195570(0xf0)],this['options'][_0x195570(0xeb)],_0x1843b8['author'],this['options'][_0x195570(0xbc)],this[_0x195570(0xbd)]);_0x10c78a[_0x195570(0xe7)](...await _0x19aaa3[_0x195570(0xf4)](_0x1843b8[_0x195570(0xfa)],this[_0x195570(0xed)]['commitId'])),_0x10c78a['push'](...await _0x19aaa3['update'](_0x1843b8[_0x195570(0xcb)],this[_0x195570(0xed)][_0x195570(0xb4)])),_0x4142b4[_0x195570(0xe7)](await _0x19aaa3[_0x195570(0xde)](_0x1843b8['removed'],!![])),this['proceededComponentsMeta']=_0x19aaa3[_0x195570(0xc0)](),await this[_0x195570(0xf7)](_0x10c78a,!![]);for(const _0x58ff03 of _0x4142b4){_0x58ff03[_0x195570(0xdf)]['length']&&await this[_0x195570(0xf7)](_0x58ff03['manifests'],!![]),_0x58ff03[_0x195570(0xd2)][_0x195570(0xbe)]&&await this[_0x195570(0xf7)](_0x58ff03[_0x195570(0xd2)],!![]),_0x58ff03['componentsToDelete'][_0x195570(0xbe)]&&await this[_0x195570(0xf7)](_0x58ff03['componentsToDelete'],!![]);}this[_0x195570(0xe6)]['log'](_0x195570(0xe1),_0x10c78a[_0x195570(0xbe)]);}}async['proceedCommitsToBranch'](_0x102fe9){const _0x5ba840=a271_0x41aa2f,_0x1c63b6=[],_0x4682a0=[];for(const _0x5b1310 of _0x102fe9){if(!_0x5b1310['inserted']['length']&&!_0x5b1310[_0x5ba840(0xcb)][_0x5ba840(0xbe)]&&!_0x5b1310[_0x5ba840(0xfb)][_0x5ba840(0xbe)])continue;const _0x13ec2f=new salesforce_components_manager_service_1[(_0x5ba840(0xf8))](this[_0x5ba840(0xed)]['repositoryId'],this[_0x5ba840(0xed)][_0x5ba840(0xeb)],_0x5b1310[_0x5ba840(0xf2)],this[_0x5ba840(0xed)]['recordTypes'],[]);_0x1c63b6['push'](...await _0x13ec2f[_0x5ba840(0xf4)](_0x5b1310[_0x5ba840(0xfa)])),_0x1c63b6['push'](...await _0x13ec2f[_0x5ba840(0xd9)](_0x5b1310[_0x5ba840(0xcb)])),_0x4682a0[_0x5ba840(0xe7)](await _0x13ec2f[_0x5ba840(0xde)](_0x5b1310['removed']));}this['logger'][_0x5ba840(0xdb)](_0x5ba840(0xf5),_0x1c63b6['length']),await this[_0x5ba840(0xf7)](_0x1c63b6);const _0x219a8a=_0x4682a0[_0x5ba840(0xec)]((_0x576052,_0x3993fa)=>({'manifests':[..._0x576052[_0x5ba840(0xdf)],..._0x3993fa[_0x5ba840(0xdf)]],'componentsToDelete':[..._0x576052['componentsToDelete'],..._0x3993fa[_0x5ba840(0xf1)]],'componentsToUpdate':[..._0x576052[_0x5ba840(0xd2)],..._0x3993fa[_0x5ba840(0xd2)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x219a8a[_0x5ba840(0xdf)]['length']&&await this['proceedRequests'](_0x219a8a[_0x5ba840(0xdf)],!![]),_0x219a8a['componentsToUpdate']['length']&&await this[_0x5ba840(0xf7)](_0x219a8a[_0x5ba840(0xd2)],!![]),_0x219a8a['componentsToDelete'][_0x5ba840(0xbe)]&&await this[_0x5ba840(0xf7)](_0x219a8a[_0x5ba840(0xf1)],!![]);}async[a271_0x41aa2f(0xb7)](_0x4e5a62){const _0x1561fa=a271_0x41aa2f;this[_0x1561fa(0xed)][_0x1561fa(0xeb)]?await this['proceedCommitsToBranch'](_0x4e5a62):await this[_0x1561fa(0xcc)](_0x4e5a62);}}exports['SalesforceCommitsManager']=SalesforceCommitsManager;