const a233_0x41f115=a233_0xe35d;(function(_0x67373b,_0x5d152c){const _0x3a3557=a233_0xe35d,_0x51d643=_0x67373b();while(!![]){try{const _0x18738e=parseInt(_0x3a3557(0x1f5))/0x1+-parseInt(_0x3a3557(0x1df))/0x2+parseInt(_0x3a3557(0x1bf))/0x3*(-parseInt(_0x3a3557(0x1c8))/0x4)+-parseInt(_0x3a3557(0x1da))/0x5*(parseInt(_0x3a3557(0x1c5))/0x6)+parseInt(_0x3a3557(0x1cc))/0x7+parseInt(_0x3a3557(0x1d8))/0x8+parseInt(_0x3a3557(0x1e4))/0x9*(parseInt(_0x3a3557(0x1e0))/0xa);if(_0x18738e===_0x5d152c)break;else _0x51d643['push'](_0x51d643['shift']());}catch(_0x1372ed){_0x51d643['push'](_0x51d643['shift']());}}}(a233_0x1816,0xf19d6));const a233_0x30ad84=(function(){let _0x17f871=!![];return function(_0x2e5465,_0x273ea3){const _0x1e85f8=_0x17f871?function(){const _0x45e1e3=a233_0xe35d;if(_0x273ea3){const _0x432b00=_0x273ea3[_0x45e1e3(0x1ed)](_0x2e5465,arguments);return _0x273ea3=null,_0x432b00;}}:function(){};return _0x17f871=![],_0x1e85f8;};}()),a233_0x412e8b=a233_0x30ad84(this,function(){const _0x25db3f=a233_0xe35d;return a233_0x412e8b['toString']()[_0x25db3f(0x1c1)](_0x25db3f(0x1b0))[_0x25db3f(0x1d2)]()['constructor'](a233_0x412e8b)[_0x25db3f(0x1c1)](_0x25db3f(0x1b0));});a233_0x412e8b();'use strict';var __importDefault=this&&this[a233_0x41f115(0x1cb)]||function(_0x2a01db){return _0x2a01db&&_0x2a01db['__esModule']?_0x2a01db:{'default':_0x2a01db};};Object[a233_0x41f115(0x1d9)](exports,a233_0x41f115(0x1eb),{'value':!![]}),exports['SalesforceCommitsManager']=void 0x0;const core_1=require(a233_0x41f115(0x1f9)),typedi_1=__importDefault(require('typedi')),constants_1=require(a233_0x41f115(0x1ea)),utils_1=require(a233_0x41f115(0x1d6)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a233_0x41f115(0x1cf)),salesforce_components_manager_service_1=require(a233_0x41f115(0x1ee)),salesforce_composite_service_1=require(a233_0x41f115(0x1e9));function a233_0x1816(){const _0x3813c0=['proceedCommits','default','1856MfeSnn','delete','recordTypes','__importDefault','8844052dBJmGQ','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','options','../utils/composite.utils','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','removed','toString','floor','stringify','reduce','../../../shared/utils','SalesforceError','2543264WGvafU','defineProperty','55YFmqLC','inserted','graph','componentsToDelete','find','3824914uspXPy','191030cIvSYn','getProceededComponentsMeta','proceedRequests','get','1071ibcwlc','manifests','author','composite','proceedChunksToUpload','./salesforce-composite.service','../../../../constants','__esModule','repositoryId','apply','./salesforce-components-manager.service','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','length','insert','\x20requests\x20to\x20composite\x20api.','SALESFORCE_MAX_REQUEST_SIZE_BYTES','reference','1402114uEDfRh','update','modified','Logger','../../../../core','componentId','(((.+)+)+)+$','name','proceededComponentsMeta','proceedCommitsToRepository','proceedCommitsToBranch','toJSON','log','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','SalesforceCompositeService','chunkArray','logger','extractComponentIdsFromGraphsResponse','push','branchId','executeGraphs','11895DzUSqd','SalesforceComponentsManager','search','commitId','map','componentsToUpdate','280824ufzZgv'];a233_0x1816=function(){return _0x3813c0;};return a233_0x1816();}class SalesforceCommitsManager{constructor(_0x422396){const _0x22418f=a233_0x41f115;this[_0x22418f(0x1ce)]=_0x422396,this['COMPONENTS_PER_CHUNK']=0x3,this[_0x22418f(0x1ba)]=new core_1[(_0x22418f(0x1f8))](SalesforceCommitsManager[_0x22418f(0x1b1)]),this['sfLogger']=this['options']['logger'],this[_0x22418f(0x1e7)]=typedi_1[_0x22418f(0x1c7)][_0x22418f(0x1e3)](salesforce_composite_service_1[_0x22418f(0x1b8)]),this[_0x22418f(0x1b2)]=[];}async[a233_0x41f115(0x1e8)](_0x4d51af,_0x66f334=![]){const _0x5aed13=a233_0x41f115,_0x5ca2cd=async _0x11d7ac=>{const _0x44ca41=a233_0xe35d;await this[_0x44ca41(0x1ba)][_0x44ca41(0x1b6)]('Sending\x20'+_0x11d7ac['reduce']((_0xd4f29a,_0x2999bb)=>_0xd4f29a+_0x2999bb[_0x44ca41(0x1f0)],0x0)+_0x44ca41(0x1f2));const _0x597bea=_0x11d7ac[_0x44ca41(0x1c3)]((_0x4575a2,_0x11a3bf)=>({'graphId':_0x44ca41(0x1dc)+_0x11a3bf,'compositeRequest':_0x4575a2})),_0x38d945=await this[_0x44ca41(0x1e7)][_0x44ca41(0x1be)](_0x597bea);if(_0x66f334){const _0x3afaca=(0x0,composite_utils_1[_0x44ca41(0x1bb)])(_0x38d945);for(const {id:_0x3b4b54,ref:_0x2e41df}of _0x3afaca){const _0xa22eb0=this[_0x44ca41(0x1b2)][_0x44ca41(0x1de)](_0x159675=>_0x159675[_0x44ca41(0x1f4)]===_0x2e41df);_0xa22eb0&&(_0xa22eb0[_0x44ca41(0x1af)]=_0x3b4b54);}}},_0x5bfd9d=0x1e8480;let _0x37398c=0x0,_0x277f39=[];for(const _0x51ba00 of _0x4d51af){const _0x4c5ad0=_0x51ba00[_0x5aed13(0x1d5)]((_0xa8659e,_0x5378f4)=>{const _0x1af9ee=_0x5aed13,_0x52ba2e=JSON[_0x1af9ee(0x1d4)](_0x5378f4)[_0x1af9ee(0x1f0)]*0x2;return _0xa8659e+_0x52ba2e;},0x0);if(_0x4c5ad0>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES'])throw new salesforce_error_1[(_0x5aed13(0x1d7))](_0x5aed13(0x1cd)+constants_1[_0x5aed13(0x1f3)]+'\x20COMPONENTS_SIZE\x20=\x20'+_0x4c5ad0);_0x37398c+_0x4c5ad0>constants_1[_0x5aed13(0x1f3)]-_0x5bfd9d&&(await _0x5ca2cd(_0x277f39),_0x277f39=[],_0x37398c=0x0),_0x37398c+=_0x4c5ad0,_0x277f39[_0x5aed13(0x1bc)](_0x51ba00);}_0x277f39[_0x5aed13(0x1f0)]&&await _0x5ca2cd(_0x277f39);}async[a233_0x41f115(0x1e2)](_0x2d7fa2,_0x2d2e1c=![]){const _0x2710d6=a233_0x41f115,_0x4eccbd=(this['COMPONENTS_PER_CHUNK']+ +_0x2d2e1c)*0x3,_0x383a75=(0x0,utils_1[_0x2710d6(0x1b9)])(_0x2d7fa2,_0x4eccbd);try{while(_0x383a75[_0x2710d6(0x1f0)]){const _0x94c08c=_0x383a75['splice'](0x0,Math[_0x2710d6(0x1d3)](constants_1[_0x2710d6(0x1ef)]/_0x4eccbd));await this[_0x2710d6(0x1e8)](_0x94c08c,_0x2d2e1c);}}catch(_0x3ec6d7){this[_0x2710d6(0x1ba)]['error'](_0x3ec6d7 instanceof salesforce_error_1[_0x2710d6(0x1d7)]?JSON[_0x2710d6(0x1d4)](_0x3ec6d7[_0x2710d6(0x1b5)](),null,0x2):_0x3ec6d7),this['sfLogger']['log'](_0x3ec6d7 instanceof salesforce_error_1[_0x2710d6(0x1d7)]?JSON[_0x2710d6(0x1d4)](_0x3ec6d7[_0x2710d6(0x1b5)](),null,0x2):_0x3ec6d7[_0x2710d6(0x1d2)]());throw _0x3ec6d7;}}async[a233_0x41f115(0x1b3)](_0x16e444){const _0xf6b822=a233_0x41f115;for(const _0x2a5882 of _0x16e444){if(!_0x2a5882[_0xf6b822(0x1db)][_0xf6b822(0x1f0)]&&!_0x2a5882[_0xf6b822(0x1f7)]['length']&&!_0x2a5882[_0xf6b822(0x1d1)][_0xf6b822(0x1f0)])continue;const _0x41b0c2=[],_0x1cbb70=[],_0x457bdd=new salesforce_components_manager_service_1[(_0xf6b822(0x1c0))](this[_0xf6b822(0x1ce)][_0xf6b822(0x1ec)],this['options'][_0xf6b822(0x1bd)],_0x2a5882[_0xf6b822(0x1e6)],this[_0xf6b822(0x1ce)][_0xf6b822(0x1ca)],this[_0xf6b822(0x1b2)]);_0x41b0c2['push'](...await _0x457bdd[_0xf6b822(0x1f1)](_0x2a5882[_0xf6b822(0x1db)],this[_0xf6b822(0x1ce)][_0xf6b822(0x1c2)])),_0x41b0c2[_0xf6b822(0x1bc)](...await _0x457bdd[_0xf6b822(0x1f6)](_0x2a5882[_0xf6b822(0x1f7)],this[_0xf6b822(0x1ce)][_0xf6b822(0x1c2)])),_0x1cbb70[_0xf6b822(0x1bc)](await _0x457bdd[_0xf6b822(0x1c9)](_0x2a5882[_0xf6b822(0x1d1)],!![])),this[_0xf6b822(0x1b2)]=_0x457bdd[_0xf6b822(0x1e1)](),await this[_0xf6b822(0x1e2)](_0x41b0c2,!![]);for(const _0x493785 of _0x1cbb70){_0x493785[_0xf6b822(0x1e5)][_0xf6b822(0x1f0)]&&await this[_0xf6b822(0x1e2)](_0x493785[_0xf6b822(0x1e5)],!![]),_0x493785[_0xf6b822(0x1c4)][_0xf6b822(0x1f0)]&&await this[_0xf6b822(0x1e2)](_0x493785[_0xf6b822(0x1c4)],!![]),_0x493785[_0xf6b822(0x1dd)][_0xf6b822(0x1f0)]&&await this[_0xf6b822(0x1e2)](_0x493785[_0xf6b822(0x1dd)],!![]);}this['logger']['log'](_0xf6b822(0x1b7),_0x41b0c2['length']);}}async['proceedCommitsToBranch'](_0x51f6c7){const _0x59015c=a233_0x41f115,_0x437be7=[],_0x16853f=[];for(const _0x4117be of _0x51f6c7){if(!_0x4117be[_0x59015c(0x1db)][_0x59015c(0x1f0)]&&!_0x4117be[_0x59015c(0x1f7)][_0x59015c(0x1f0)]&&!_0x4117be[_0x59015c(0x1d1)]['length'])continue;const _0x6856fe=new salesforce_components_manager_service_1[(_0x59015c(0x1c0))](this[_0x59015c(0x1ce)]['repositoryId'],this[_0x59015c(0x1ce)][_0x59015c(0x1bd)],_0x4117be['author'],this[_0x59015c(0x1ce)]['recordTypes'],[]);_0x437be7[_0x59015c(0x1bc)](...await _0x6856fe[_0x59015c(0x1f1)](_0x4117be[_0x59015c(0x1db)])),_0x437be7[_0x59015c(0x1bc)](...await _0x6856fe[_0x59015c(0x1f6)](_0x4117be[_0x59015c(0x1f7)])),_0x16853f['push'](await _0x6856fe['delete'](_0x4117be['removed']));}this[_0x59015c(0x1ba)][_0x59015c(0x1b6)](_0x59015c(0x1d0),_0x437be7['length']),await this['proceedRequests'](_0x437be7);const _0x468a47=_0x16853f[_0x59015c(0x1d5)]((_0x25f436,_0x3a40f2)=>({'manifests':[..._0x25f436['manifests'],..._0x3a40f2[_0x59015c(0x1e5)]],'componentsToDelete':[..._0x25f436['componentsToDelete'],..._0x3a40f2['componentsToDelete']],'componentsToUpdate':[..._0x25f436[_0x59015c(0x1c4)],..._0x3a40f2['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x468a47['manifests'][_0x59015c(0x1f0)]&&await this[_0x59015c(0x1e2)](_0x468a47[_0x59015c(0x1e5)],!![]),_0x468a47[_0x59015c(0x1c4)][_0x59015c(0x1f0)]&&await this[_0x59015c(0x1e2)](_0x468a47['componentsToUpdate'],!![]),_0x468a47['componentsToDelete'][_0x59015c(0x1f0)]&&await this[_0x59015c(0x1e2)](_0x468a47['componentsToDelete'],!![]);}async[a233_0x41f115(0x1c6)](_0x2aed51){const _0x490541=a233_0x41f115;this[_0x490541(0x1ce)][_0x490541(0x1bd)]?await this[_0x490541(0x1b4)](_0x2aed51):await this[_0x490541(0x1b3)](_0x2aed51);}}function a233_0xe35d(_0x2abdb6,_0x75c503){const _0x1b34a0=a233_0x1816();return a233_0xe35d=function(_0x412e8b,_0x30ad84){_0x412e8b=_0x412e8b-0x1af;let _0x18167f=_0x1b34a0[_0x412e8b];return _0x18167f;},a233_0xe35d(_0x2abdb6,_0x75c503);}exports['SalesforceCommitsManager']=SalesforceCommitsManager;