const a244_0x5373b0=a244_0x1db5;(function(_0x32f067,_0x36691f){const _0x28e6e3=a244_0x1db5,_0x563309=_0x32f067();while(!![]){try{const _0x46b7ef=parseInt(_0x28e6e3(0xa9))/0x1+-parseInt(_0x28e6e3(0xc2))/0x2+-parseInt(_0x28e6e3(0xba))/0x3*(-parseInt(_0x28e6e3(0xb6))/0x4)+-parseInt(_0x28e6e3(0xb5))/0x5*(-parseInt(_0x28e6e3(0xce))/0x6)+-parseInt(_0x28e6e3(0x99))/0x7*(parseInt(_0x28e6e3(0x9d))/0x8)+-parseInt(_0x28e6e3(0xaf))/0x9+parseInt(_0x28e6e3(0x9f))/0xa;if(_0x46b7ef===_0x36691f)break;else _0x563309['push'](_0x563309['shift']());}catch(_0x3a2961){_0x563309['push'](_0x563309['shift']());}}}(a244_0x96db,0x52117));function a244_0x1db5(_0x5da652,_0x547698){const _0x1a5854=a244_0x96db();return a244_0x1db5=function(_0x313995,_0x224a90){_0x313995=_0x313995-0x91;let _0x96db64=_0x1a5854[_0x313995];return _0x96db64;},a244_0x1db5(_0x5da652,_0x547698);}const a244_0x224a90=(function(){let _0x4be2b6=!![];return function(_0xdc5963,_0xaa58f3){const _0x154a67=_0x4be2b6?function(){const _0x2fdca9=a244_0x1db5;if(_0xaa58f3){const _0x55f527=_0xaa58f3[_0x2fdca9(0xa4)](_0xdc5963,arguments);return _0xaa58f3=null,_0x55f527;}}:function(){};return _0x4be2b6=![],_0x154a67;};}()),a244_0x313995=a244_0x224a90(this,function(){const _0x526db9=a244_0x1db5;return a244_0x313995[_0x526db9(0xcb)]()[_0x526db9(0xb9)]('(((.+)+)+)+$')['toString']()[_0x526db9(0x9e)](a244_0x313995)['search'](_0x526db9(0xb8));});function a244_0x96db(){const _0x1450aa=['modified','proceedCommitsToRepository','repositoryId','author','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','extractComponentIdsFromGraphsResponse','recordTypes','981552JbQqtU','commitId','SalesforceCommitsManager','map','executeGraphs','\x20requests\x20to\x20composite\x20api.','proceedCommits','length','SALESFORCE_MAX_REQUEST_SIZE_BYTES','toString','../errors/salesforce.error','log','661218EgeGGv','componentId','../../../../core','delete','manifests','componentsToUpdate','insert','stringify','update','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','removed','push','../utils/composite.utils','SalesforceError','branchId','defineProperty','getProceededComponentsMeta','toJSON','floor','proceededComponentsMeta','proceedRequests','Logger','3145009UZfHsw','\x20COMPONENTS_SIZE\x20=\x20','Sending\x20','logger','8QBnSyG','constructor','6301120AGtkaW','graph','proceedChunksToUpload','./salesforce-composite.service','__esModule','apply','get','chunkArray','sfLogger','options','49725PMCznI','COMPONENTS_PER_CHUNK','reference','typedi','reduce','componentsToDelete','5306832gLkKNf','../../../shared/utils','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','./salesforce-components-manager.service','inserted','find','25Myaxpm','8328TLheBa','error','(((.+)+)+)+$','search','915KQQDJY'];a244_0x96db=function(){return _0x1450aa;};return a244_0x96db();}a244_0x313995();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x635c03){return _0x635c03&&_0x635c03['__esModule']?_0x635c03:{'default':_0x635c03};};Object[a244_0x5373b0(0x92)](exports,a244_0x5373b0(0xa3),{'value':!![]}),exports[a244_0x5373b0(0xc4)]=void 0x0;const core_1=require(a244_0x5373b0(0xd0)),typedi_1=__importDefault(require(a244_0x5373b0(0xac))),constants_1=require('../../../../constants'),utils_1=require(a244_0x5373b0(0xb0)),salesforce_error_1=require(a244_0x5373b0(0xcc)),composite_utils_1=require(a244_0x5373b0(0xda)),salesforce_components_manager_service_1=require(a244_0x5373b0(0xb2)),salesforce_composite_service_1=require(a244_0x5373b0(0xa2));class SalesforceCommitsManager{constructor(_0x31071a){const _0x4346c0=a244_0x5373b0;this['options']=_0x31071a,this[_0x4346c0(0xaa)]=0x3,this[_0x4346c0(0x9c)]=new core_1[(_0x4346c0(0x98))](SalesforceCommitsManager['name']),this[_0x4346c0(0xa7)]=this[_0x4346c0(0xa8)][_0x4346c0(0x9c)],this['composite']=typedi_1['default'][_0x4346c0(0xa5)](salesforce_composite_service_1['SalesforceCompositeService']),this[_0x4346c0(0x96)]=[];}async[a244_0x5373b0(0xa1)](_0x1b8936,_0x4181df=![]){const _0x4310b2=a244_0x5373b0,_0x276517=async _0x358bbe=>{const _0x58c4c2=a244_0x1db5;await this['logger'][_0x58c4c2(0xcd)](_0x58c4c2(0x9b)+_0x358bbe[_0x58c4c2(0xad)]((_0x1d99af,_0x1ce0c7)=>_0x1d99af+_0x1ce0c7[_0x58c4c2(0xc9)],0x0)+_0x58c4c2(0xc7));const _0x578ab1=_0x358bbe[_0x58c4c2(0xc5)]((_0x4b9f8c,_0x4f84e4)=>({'graphId':_0x58c4c2(0xa0)+_0x4f84e4,'compositeRequest':_0x4b9f8c})),_0x503acb=await this['composite'][_0x58c4c2(0xc6)](_0x578ab1);if(_0x4181df){const _0x486830=(0x0,composite_utils_1[_0x58c4c2(0xc0)])(_0x503acb);for(const {id:_0x3ede51,ref:_0x51b16f}of _0x486830){const _0x1acb87=this[_0x58c4c2(0x96)][_0x58c4c2(0xb4)](_0x3c49cf=>_0x3c49cf[_0x58c4c2(0xab)]===_0x51b16f);_0x1acb87&&(_0x1acb87[_0x58c4c2(0xcf)]=_0x3ede51);}}},_0x431555=0x1e8480;let _0x2f52ca=0x0,_0x2b953e=[];for(const _0x1bbfe8 of _0x1b8936){const _0x32b313=_0x1bbfe8[_0x4310b2(0xad)]((_0x1406cb,_0x5d8c54)=>{const _0x5abf85=_0x4310b2,_0x4b7269=JSON['stringify'](_0x5d8c54)[_0x5abf85(0xc9)]*0x2;return _0x1406cb+_0x4b7269;},0x0);if(_0x32b313>constants_1[_0x4310b2(0xca)])throw new salesforce_error_1[(_0x4310b2(0xdb))](_0x4310b2(0xd7)+constants_1[_0x4310b2(0xca)]+_0x4310b2(0x9a)+_0x32b313);_0x2f52ca+_0x32b313>constants_1[_0x4310b2(0xca)]-_0x431555&&(await _0x276517(_0x2b953e),_0x2b953e=[],_0x2f52ca=0x0),_0x2f52ca+=_0x32b313,_0x2b953e[_0x4310b2(0xd9)](_0x1bbfe8);}_0x2b953e[_0x4310b2(0xc9)]&&await _0x276517(_0x2b953e);}async[a244_0x5373b0(0x97)](_0x183207,_0x49811a=![]){const _0x1f81a1=a244_0x5373b0,_0x2def80=(this[_0x1f81a1(0xaa)]+ +_0x49811a)*0x3,_0x4f7b01=(0x0,utils_1[_0x1f81a1(0xa6)])(_0x183207,_0x2def80);try{while(_0x4f7b01['length']){const _0x1aba0b=_0x4f7b01['splice'](0x0,Math[_0x1f81a1(0x95)](constants_1[_0x1f81a1(0xbf)]/_0x2def80));await this['proceedChunksToUpload'](_0x1aba0b,_0x49811a);}}catch(_0x38c940){this[_0x1f81a1(0x9c)][_0x1f81a1(0xb7)](_0x38c940 instanceof salesforce_error_1['SalesforceError']?JSON['stringify'](_0x38c940['toJSON'](),null,0x2):_0x38c940),this[_0x1f81a1(0xa7)][_0x1f81a1(0xcd)](_0x38c940 instanceof salesforce_error_1['SalesforceError']?JSON[_0x1f81a1(0xd5)](_0x38c940[_0x1f81a1(0x94)](),null,0x2):_0x38c940['toString']());throw _0x38c940;}}async['proceedCommitsToRepository'](_0x371e98){const _0x5c9b98=a244_0x5373b0;for(const _0x656848 of _0x371e98){if(!_0x656848[_0x5c9b98(0xb3)][_0x5c9b98(0xc9)]&&!_0x656848[_0x5c9b98(0xbb)][_0x5c9b98(0xc9)]&&!_0x656848[_0x5c9b98(0xd8)][_0x5c9b98(0xc9)])continue;const _0x30232e=[],_0x486d55=[],_0x3da804=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x5c9b98(0xa8)]['repositoryId'],this[_0x5c9b98(0xa8)]['branchId'],_0x656848[_0x5c9b98(0xbe)],this['options'][_0x5c9b98(0xc1)],this[_0x5c9b98(0x96)]);_0x30232e[_0x5c9b98(0xd9)](...await _0x3da804[_0x5c9b98(0xd4)](_0x656848[_0x5c9b98(0xb3)],this[_0x5c9b98(0xa8)]['commitId'])),_0x30232e[_0x5c9b98(0xd9)](...await _0x3da804[_0x5c9b98(0xd6)](_0x656848['modified'],this['options'][_0x5c9b98(0xc3)])),_0x486d55['push'](await _0x3da804[_0x5c9b98(0xd1)](_0x656848[_0x5c9b98(0xd8)],!![])),this[_0x5c9b98(0x96)]=_0x3da804[_0x5c9b98(0x93)](),await this[_0x5c9b98(0x97)](_0x30232e,!![]);for(const _0x29a565 of _0x486d55){_0x29a565[_0x5c9b98(0xd2)][_0x5c9b98(0xc9)]&&await this[_0x5c9b98(0x97)](_0x29a565[_0x5c9b98(0xd2)],!![]),_0x29a565[_0x5c9b98(0xd3)][_0x5c9b98(0xc9)]&&await this[_0x5c9b98(0x97)](_0x29a565[_0x5c9b98(0xd3)],!![]),_0x29a565['componentsToDelete']['length']&&await this['proceedRequests'](_0x29a565['componentsToDelete'],!![]);}this[_0x5c9b98(0x9c)][_0x5c9b98(0xcd)](_0x5c9b98(0xb1),_0x30232e[_0x5c9b98(0xc9)]);}}async['proceedCommitsToBranch'](_0x50ca03){const _0x269142=a244_0x5373b0,_0x45e0de=[],_0x129616=[];for(const _0x39343b of _0x50ca03){if(!_0x39343b[_0x269142(0xb3)][_0x269142(0xc9)]&&!_0x39343b['modified'][_0x269142(0xc9)]&&!_0x39343b[_0x269142(0xd8)][_0x269142(0xc9)])continue;const _0x155a52=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x269142(0xa8)][_0x269142(0xbd)],this[_0x269142(0xa8)][_0x269142(0x91)],_0x39343b[_0x269142(0xbe)],this[_0x269142(0xa8)]['recordTypes'],[]);_0x45e0de[_0x269142(0xd9)](...await _0x155a52['insert'](_0x39343b['inserted'])),_0x45e0de[_0x269142(0xd9)](...await _0x155a52[_0x269142(0xd6)](_0x39343b['modified'])),_0x129616['push'](await _0x155a52[_0x269142(0xd1)](_0x39343b['removed']));}this[_0x269142(0x9c)]['log']('Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)',_0x45e0de[_0x269142(0xc9)]),await this['proceedRequests'](_0x45e0de);const _0x429f78=_0x129616['reduce']((_0x517eb2,_0x2e4a32)=>({'manifests':[..._0x517eb2[_0x269142(0xd2)],..._0x2e4a32['manifests']],'componentsToDelete':[..._0x517eb2[_0x269142(0xae)],..._0x2e4a32[_0x269142(0xae)]],'componentsToUpdate':[..._0x517eb2['componentsToUpdate'],..._0x2e4a32[_0x269142(0xd3)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x429f78[_0x269142(0xd2)]['length']&&await this[_0x269142(0x97)](_0x429f78[_0x269142(0xd2)],!![]),_0x429f78[_0x269142(0xd3)][_0x269142(0xc9)]&&await this['proceedRequests'](_0x429f78[_0x269142(0xd3)],!![]),_0x429f78['componentsToDelete'][_0x269142(0xc9)]&&await this[_0x269142(0x97)](_0x429f78[_0x269142(0xae)],!![]);}async[a244_0x5373b0(0xc8)](_0x3d043c){const _0x23f933=a244_0x5373b0;this['options'][_0x23f933(0x91)]?await this['proceedCommitsToBranch'](_0x3d043c):await this[_0x23f933(0xbc)](_0x3d043c);}}exports[a244_0x5373b0(0xc4)]=SalesforceCommitsManager;