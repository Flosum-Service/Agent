const a271_0x26c59f=a271_0x4275;(function(_0x1f0965,_0x5e4640){const _0x599402=a271_0x4275,_0x56037e=_0x1f0965();while(!![]){try{const _0x5cccd5=parseInt(_0x599402(0x194))/0x1*(-parseInt(_0x599402(0x161))/0x2)+parseInt(_0x599402(0x1a8))/0x3*(-parseInt(_0x599402(0x1aa))/0x4)+-parseInt(_0x599402(0x164))/0x5+-parseInt(_0x599402(0x17a))/0x6+-parseInt(_0x599402(0x192))/0x7*(-parseInt(_0x599402(0x16c))/0x8)+-parseInt(_0x599402(0x190))/0x9*(-parseInt(_0x599402(0x198))/0xa)+parseInt(_0x599402(0x178))/0xb*(parseInt(_0x599402(0x182))/0xc);if(_0x5cccd5===_0x5e4640)break;else _0x56037e['push'](_0x56037e['shift']());}catch(_0x77b770){_0x56037e['push'](_0x56037e['shift']());}}}(a271_0x17b9,0x82a1d));const a271_0x463180=(function(){let _0x23c8a2=!![];return function(_0x3eca70,_0x4836e0){const _0x32a81d=_0x23c8a2?function(){const _0x39289a=a271_0x4275;if(_0x4836e0){const _0x236155=_0x4836e0[_0x39289a(0x17e)](_0x3eca70,arguments);return _0x4836e0=null,_0x236155;}}:function(){};return _0x23c8a2=![],_0x32a81d;};}()),a271_0x41a6da=a271_0x463180(this,function(){const _0x34e8b9=a271_0x4275;return a271_0x41a6da[_0x34e8b9(0x195)]()[_0x34e8b9(0x1a4)]('(((.+)+)+)+$')[_0x34e8b9(0x195)]()['constructor'](a271_0x41a6da)['search'](_0x34e8b9(0x1a2));});function a271_0x4275(_0x5370dd,_0x313a43){const _0x31c21b=a271_0x17b9();return a271_0x4275=function(_0x41a6da,_0x463180){_0x41a6da=_0x41a6da-0x15f;let _0x17b92f=_0x31c21b[_0x41a6da];return _0x17b92f;},a271_0x4275(_0x5370dd,_0x313a43);}a271_0x41a6da();'use strict';var __importDefault=this&&this[a271_0x26c59f(0x1a9)]||function(_0x471631){const _0xb2ef56=a271_0x26c59f;return _0x471631&&_0x471631[_0xb2ef56(0x16d)]?_0x471631:{'default':_0x471631};};Object[a271_0x26c59f(0x172)](exports,a271_0x26c59f(0x16d),{'value':!![]}),exports[a271_0x26c59f(0x19b)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require('typedi')),constants_1=require('../../../../constants'),utils_1=require(a271_0x26c59f(0x165)),salesforce_error_1=require(a271_0x26c59f(0x191)),composite_utils_1=require(a271_0x26c59f(0x17c)),salesforce_components_manager_service_1=require(a271_0x26c59f(0x18f)),salesforce_composite_service_1=require(a271_0x26c59f(0x16a));class SalesforceCommitsManager{constructor(_0x4b3b5a){const _0x170823=a271_0x26c59f;this[_0x170823(0x173)]=_0x4b3b5a,this[_0x170823(0x1a0)]=0x3,this['logger']=new core_1[(_0x170823(0x1a1))](SalesforceCommitsManager[_0x170823(0x181)]),this[_0x170823(0x16b)]=this[_0x170823(0x173)][_0x170823(0x183)],this[_0x170823(0x187)]=typedi_1[_0x170823(0x177)][_0x170823(0x163)](salesforce_composite_service_1[_0x170823(0x184)]),this[_0x170823(0x17d)]=[];}async['proceedChunksToUpload'](_0x2d1d8a,_0x19e60f=![]){const _0x1463df=a271_0x26c59f,_0x4ba23c=async _0x2dc8d5=>{const _0xd55f66=a271_0x4275;await this[_0xd55f66(0x183)]['log'](_0xd55f66(0x18a)+_0x2dc8d5[_0xd55f66(0x176)]((_0x405a97,_0x27d6e3)=>_0x405a97+_0x27d6e3[_0xd55f66(0x19c)],0x0)+_0xd55f66(0x162));const _0x16bc2e=_0x2dc8d5[_0xd55f66(0x189)]((_0x356592,_0x52e78c)=>({'graphId':_0xd55f66(0x175)+_0x52e78c,'compositeRequest':_0x356592})),_0x5327f0=await this[_0xd55f66(0x187)][_0xd55f66(0x19f)](_0x16bc2e);if(_0x19e60f){const _0x5bf9fa=(0x0,composite_utils_1[_0xd55f66(0x1a3)])(_0x5327f0);for(const {id:_0x48da92,ref:_0x122327}of _0x5bf9fa){const _0x767f04=this['proceededComponentsMeta']['find'](_0x4a433c=>_0x4a433c['reference']===_0x122327);_0x767f04&&(_0x767f04[_0xd55f66(0x171)]=_0x48da92);}}},_0x38553d=0x1e8480;let _0x1f6c6a=0x0,_0x2eab03=[];for(const _0x1a095f of _0x2d1d8a){const _0x586a7f=_0x1a095f[_0x1463df(0x176)]((_0x4258a6,_0xe4a507)=>{const _0x48938f=_0x1463df,_0x253b31=JSON[_0x48938f(0x199)](_0xe4a507)[_0x48938f(0x19c)]*0x2;return _0x4258a6+_0x253b31;},0x0);if(_0x586a7f>constants_1[_0x1463df(0x17b)])throw new salesforce_error_1[(_0x1463df(0x196))](_0x1463df(0x19e)+constants_1[_0x1463df(0x17b)]+_0x1463df(0x193)+_0x586a7f);_0x1f6c6a+_0x586a7f>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']-_0x38553d&&(await _0x4ba23c(_0x2eab03),_0x2eab03=[],_0x1f6c6a=0x0),_0x1f6c6a+=_0x586a7f,_0x2eab03[_0x1463df(0x19a)](_0x1a095f);}_0x2eab03['length']&&await _0x4ba23c(_0x2eab03);}async[a271_0x26c59f(0x179)](_0x446a24,_0x39555f=![]){const _0x2a46e7=a271_0x26c59f,_0x4bbc97=(this['COMPONENTS_PER_CHUNK']+ +_0x39555f)*0x3,_0x137470=(0x0,utils_1[_0x2a46e7(0x170)])(_0x446a24,_0x4bbc97);try{while(_0x137470[_0x2a46e7(0x19c)]){const _0x124b2e=_0x137470[_0x2a46e7(0x1a5)](0x0,Math[_0x2a46e7(0x186)](constants_1[_0x2a46e7(0x197)]/_0x4bbc97));await this['proceedChunksToUpload'](_0x124b2e,_0x39555f);}}catch(_0x3057d8){this[_0x2a46e7(0x183)]['error'](_0x3057d8 instanceof salesforce_error_1[_0x2a46e7(0x196)]?JSON['stringify'](_0x3057d8[_0x2a46e7(0x180)](),null,0x2):_0x3057d8),this[_0x2a46e7(0x16b)][_0x2a46e7(0x18c)](_0x3057d8 instanceof salesforce_error_1[_0x2a46e7(0x196)]?JSON[_0x2a46e7(0x199)](_0x3057d8[_0x2a46e7(0x180)](),null,0x2):_0x3057d8['toString']());throw _0x3057d8;}}async[a271_0x26c59f(0x16f)](_0x5ec16c){const _0x5d2a7a=a271_0x26c59f;for(const _0x5d64f8 of _0x5ec16c){if(!_0x5d64f8[_0x5d2a7a(0x18e)][_0x5d2a7a(0x19c)]&&!_0x5d64f8[_0x5d2a7a(0x19d)][_0x5d2a7a(0x19c)]&&!_0x5d64f8[_0x5d2a7a(0x185)][_0x5d2a7a(0x19c)])continue;const _0x25801b=[],_0x395909=[],_0x530f34=new salesforce_components_manager_service_1[(_0x5d2a7a(0x174))](this[_0x5d2a7a(0x173)][_0x5d2a7a(0x188)],this[_0x5d2a7a(0x173)][_0x5d2a7a(0x166)],_0x5d64f8[_0x5d2a7a(0x160)],this[_0x5d2a7a(0x173)][_0x5d2a7a(0x1a7)],this[_0x5d2a7a(0x17d)]);_0x25801b[_0x5d2a7a(0x19a)](...await _0x530f34[_0x5d2a7a(0x18d)](_0x5d64f8[_0x5d2a7a(0x18e)],this[_0x5d2a7a(0x173)]['commitId'])),_0x25801b[_0x5d2a7a(0x19a)](...await _0x530f34[_0x5d2a7a(0x1a6)](_0x5d64f8[_0x5d2a7a(0x19d)],this[_0x5d2a7a(0x173)][_0x5d2a7a(0x16e)])),_0x395909[_0x5d2a7a(0x19a)](await _0x530f34[_0x5d2a7a(0x17f)](_0x5d64f8[_0x5d2a7a(0x185)],!![])),this[_0x5d2a7a(0x17d)]=_0x530f34[_0x5d2a7a(0x169)](),await this[_0x5d2a7a(0x179)](_0x25801b,!![]);for(const _0x249e28 of _0x395909){_0x249e28[_0x5d2a7a(0x15f)][_0x5d2a7a(0x19c)]&&await this[_0x5d2a7a(0x179)](_0x249e28['manifests'],!![]),_0x249e28[_0x5d2a7a(0x18b)][_0x5d2a7a(0x19c)]&&await this[_0x5d2a7a(0x179)](_0x249e28[_0x5d2a7a(0x18b)],!![]),_0x249e28[_0x5d2a7a(0x168)][_0x5d2a7a(0x19c)]&&await this[_0x5d2a7a(0x179)](_0x249e28[_0x5d2a7a(0x168)],!![]);}this[_0x5d2a7a(0x183)]['log']('Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x25801b[_0x5d2a7a(0x19c)]);}}async[a271_0x26c59f(0x167)](_0x215006){const _0x308a82=a271_0x26c59f,_0x415eb2=[],_0x21bb00=[];for(const _0x965d1c of _0x215006){if(!_0x965d1c['inserted'][_0x308a82(0x19c)]&&!_0x965d1c[_0x308a82(0x19d)][_0x308a82(0x19c)]&&!_0x965d1c[_0x308a82(0x185)][_0x308a82(0x19c)])continue;const _0x3b2614=new salesforce_components_manager_service_1[(_0x308a82(0x174))](this[_0x308a82(0x173)]['repositoryId'],this['options'][_0x308a82(0x166)],_0x965d1c[_0x308a82(0x160)],this['options'][_0x308a82(0x1a7)],[]);_0x415eb2['push'](...await _0x3b2614[_0x308a82(0x18d)](_0x965d1c[_0x308a82(0x18e)])),_0x415eb2[_0x308a82(0x19a)](...await _0x3b2614[_0x308a82(0x1a6)](_0x965d1c[_0x308a82(0x19d)])),_0x21bb00['push'](await _0x3b2614[_0x308a82(0x17f)](_0x965d1c[_0x308a82(0x185)]));}this[_0x308a82(0x183)]['log']('Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)',_0x415eb2[_0x308a82(0x19c)]),await this[_0x308a82(0x179)](_0x415eb2);const _0xdd4df2=_0x21bb00[_0x308a82(0x176)]((_0x3da412,_0x22e6f0)=>({'manifests':[..._0x3da412[_0x308a82(0x15f)],..._0x22e6f0[_0x308a82(0x15f)]],'componentsToDelete':[..._0x3da412['componentsToDelete'],..._0x22e6f0[_0x308a82(0x168)]],'componentsToUpdate':[..._0x3da412[_0x308a82(0x18b)],..._0x22e6f0['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0xdd4df2['manifests']['length']&&await this[_0x308a82(0x179)](_0xdd4df2[_0x308a82(0x15f)],!![]),_0xdd4df2[_0x308a82(0x18b)][_0x308a82(0x19c)]&&await this['proceedRequests'](_0xdd4df2['componentsToUpdate'],!![]),_0xdd4df2[_0x308a82(0x168)][_0x308a82(0x19c)]&&await this[_0x308a82(0x179)](_0xdd4df2[_0x308a82(0x168)],!![]);}async['proceedCommits'](_0x5af8d3){const _0x2f8943=a271_0x26c59f;this[_0x2f8943(0x173)][_0x2f8943(0x166)]?await this[_0x2f8943(0x167)](_0x5af8d3):await this['proceedCommitsToRepository'](_0x5af8d3);}}function a271_0x17b9(){const _0x201115=['default','88YSHDsl','proceedRequests','1238460zLlIRP','SALESFORCE_MAX_REQUEST_SIZE_BYTES','../utils/composite.utils','proceededComponentsMeta','apply','delete','toJSON','name','2123988bwRHxE','logger','SalesforceCompositeService','removed','floor','composite','repositoryId','map','Sending\x20','componentsToUpdate','log','insert','inserted','./salesforce-components-manager.service','946557sotsXr','../errors/salesforce.error','191674QzHSYd','\x20COMPONENTS_SIZE\x20=\x20','2219UcmNNk','toString','SalesforceError','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','40nlcKfx','stringify','push','SalesforceCommitsManager','length','modified','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','executeGraphs','COMPONENTS_PER_CHUNK','Logger','(((.+)+)+)+$','extractComponentIdsFromGraphsResponse','search','splice','update','recordTypes','15ZzOsHb','__importDefault','380624YoYibw','manifests','author','122cbGfLb','\x20requests\x20to\x20composite\x20api.','get','2694150OLqGHC','../../../shared/utils','branchId','proceedCommitsToBranch','componentsToDelete','getProceededComponentsMeta','./salesforce-composite.service','sfLogger','16WSDwOc','__esModule','commitId','proceedCommitsToRepository','chunkArray','componentId','defineProperty','options','SalesforceComponentsManager','graph','reduce'];a271_0x17b9=function(){return _0x201115;};return a271_0x17b9();}exports['SalesforceCommitsManager']=SalesforceCommitsManager;