const a271_0x29a21e=a271_0x9db7;(function(_0x2a16f0,_0x2d9f5e){const _0x9c195c=a271_0x9db7,_0x55ceda=_0x2a16f0();while(!![]){try{const _0x33643f=-parseInt(_0x9c195c(0x91))/0x1+-parseInt(_0x9c195c(0xbe))/0x2*(-parseInt(_0x9c195c(0xae))/0x3)+-parseInt(_0x9c195c(0x9f))/0x4*(-parseInt(_0x9c195c(0xbd))/0x5)+-parseInt(_0x9c195c(0x80))/0x6*(-parseInt(_0x9c195c(0x88))/0x7)+parseInt(_0x9c195c(0x8a))/0x8+parseInt(_0x9c195c(0x83))/0x9*(parseInt(_0x9c195c(0xa1))/0xa)+-parseInt(_0x9c195c(0xc1))/0xb;if(_0x33643f===_0x2d9f5e)break;else _0x55ceda['push'](_0x55ceda['shift']());}catch(_0x431df2){_0x55ceda['push'](_0x55ceda['shift']());}}}(a271_0x2e95,0x1f734));const a271_0x18cd50=(function(){let _0x2cb9fd=!![];return function(_0x34ee3a,_0x596658){const _0x1dc920=_0x2cb9fd?function(){const _0x214f13=a271_0x9db7;if(_0x596658){const _0xa47db7=_0x596658[_0x214f13(0xab)](_0x34ee3a,arguments);return _0x596658=null,_0xa47db7;}}:function(){};return _0x2cb9fd=![],_0x1dc920;};}()),a271_0x2915b4=a271_0x18cd50(this,function(){const _0x1180f6=a271_0x9db7;return a271_0x2915b4[_0x1180f6(0x99)]()[_0x1180f6(0xb4)]('(((.+)+)+)+$')[_0x1180f6(0x99)]()[_0x1180f6(0x86)](a271_0x2915b4)['search'](_0x1180f6(0x87));});a271_0x2915b4();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3a5be8){const _0x54d177=a271_0x9db7;return _0x3a5be8&&_0x3a5be8[_0x54d177(0x9a)]?_0x3a5be8:{'default':_0x3a5be8};};Object[a271_0x29a21e(0xbb)](exports,'__esModule',{'value':!![]}),exports[a271_0x29a21e(0xb0)]=void 0x0;function a271_0x9db7(_0x924a42,_0x189dbb){const _0xbec0b2=a271_0x2e95();return a271_0x9db7=function(_0x2915b4,_0x18cd50){_0x2915b4=_0x2915b4-0x7a;let _0x2e956e=_0xbec0b2[_0x2915b4];return _0x2e956e;},a271_0x9db7(_0x924a42,_0x189dbb);}function a271_0x2e95(){const _0xdd6749=['toJSON','options','../../../../core','getProceededComponentsMeta','3258OkOfaS','SALESFORCE_MAX_REQUEST_SIZE_BYTES','manifests','10089yBJVeP','./salesforce-components-manager.service','get','constructor','(((.+)+)+)+$','1379EWlgXo','proceedCommits','2017088tyIJyl','composite','proceededComponentsMeta','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','map','delete','SalesforceComponentsManager','109495dGUmCi','proceedChunksToUpload','../utils/composite.utils','commitId','sfLogger','stringify','SalesforceError','COMPONENTS_PER_CHUNK','toString','__esModule','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','push','proceedCommitsToBranch','splice','80nByRIN','length','380hxZZiT','inserted','modified','proceedRequests','floor','recordTypes','\x20COMPONENTS_SIZE\x20=\x20','Logger','graph','name','apply','reduce','\x20requests\x20to\x20composite\x20api.','15pTanCt','componentsToDelete','SalesforceCommitsManager','insert','componentsToUpdate','typedi','search','chunkArray','proceedCommitsToRepository','branchId','error','Sending\x20','author','defineProperty','update','33280uAQcYB','25478zvohms','componentId','logger','3962255JLAFWT','removed','log','executeGraphs','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)'];a271_0x2e95=function(){return _0xdd6749;};return a271_0x2e95();}const core_1=require(a271_0x29a21e(0x7e)),typedi_1=__importDefault(require(a271_0x29a21e(0xb3))),constants_1=require('../../../../constants'),utils_1=require('../../../shared/utils'),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a271_0x29a21e(0x93)),salesforce_components_manager_service_1=require(a271_0x29a21e(0x84)),salesforce_composite_service_1=require('./salesforce-composite.service');class SalesforceCommitsManager{constructor(_0x3d87a2){const _0x1ce3de=a271_0x29a21e;this[_0x1ce3de(0x7d)]=_0x3d87a2,this[_0x1ce3de(0x98)]=0x3,this[_0x1ce3de(0xc0)]=new core_1[(_0x1ce3de(0xa8))](SalesforceCommitsManager[_0x1ce3de(0xaa)]),this['sfLogger']=this[_0x1ce3de(0x7d)][_0x1ce3de(0xc0)],this[_0x1ce3de(0x8b)]=typedi_1['default'][_0x1ce3de(0x85)](salesforce_composite_service_1['SalesforceCompositeService']),this['proceededComponentsMeta']=[];}async[a271_0x29a21e(0x92)](_0x3ef73c,_0x500d55=![]){const _0x4e6fc6=a271_0x29a21e,_0x331c0c=async _0x37a725=>{const _0xc14302=a271_0x9db7;await this[_0xc14302(0xc0)]['log'](_0xc14302(0xb9)+_0x37a725[_0xc14302(0xac)]((_0x4fbdd8,_0x52e9d5)=>_0x4fbdd8+_0x52e9d5['length'],0x0)+_0xc14302(0xad));const _0x1e933a=_0x37a725[_0xc14302(0x8e)]((_0x57fbe8,_0x41970a)=>({'graphId':_0xc14302(0xa9)+_0x41970a,'compositeRequest':_0x57fbe8})),_0x3c7e4c=await this[_0xc14302(0x8b)][_0xc14302(0x7a)](_0x1e933a);if(_0x500d55){const _0x465993=(0x0,composite_utils_1['extractComponentIdsFromGraphsResponse'])(_0x3c7e4c);for(const {id:_0x32256f,ref:_0xa7080c}of _0x465993){const _0xbdd59e=this['proceededComponentsMeta']['find'](_0x2061bf=>_0x2061bf['reference']===_0xa7080c);_0xbdd59e&&(_0xbdd59e[_0xc14302(0xbf)]=_0x32256f);}}},_0x5521d6=0x1e8480;let _0x7b2bf=0x0,_0x5e3ec4=[];for(const _0x2de0ad of _0x3ef73c){const _0x2c16db=_0x2de0ad[_0x4e6fc6(0xac)]((_0x45881a,_0x46e434)=>{const _0x166c5c=_0x4e6fc6,_0x2ceb27=JSON[_0x166c5c(0x96)](_0x46e434)['length']*0x2;return _0x45881a+_0x2ceb27;},0x0);if(_0x2c16db>constants_1[_0x4e6fc6(0x81)])throw new salesforce_error_1[(_0x4e6fc6(0x97))]('Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20'+constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']+_0x4e6fc6(0xa7)+_0x2c16db);_0x7b2bf+_0x2c16db>constants_1[_0x4e6fc6(0x81)]-_0x5521d6&&(await _0x331c0c(_0x5e3ec4),_0x5e3ec4=[],_0x7b2bf=0x0),_0x7b2bf+=_0x2c16db,_0x5e3ec4[_0x4e6fc6(0x9c)](_0x2de0ad);}_0x5e3ec4[_0x4e6fc6(0xa0)]&&await _0x331c0c(_0x5e3ec4);}async[a271_0x29a21e(0xa4)](_0xef288d,_0x1bd095=![]){const _0x135fdb=a271_0x29a21e,_0x3f612c=(this[_0x135fdb(0x98)]+ +_0x1bd095)*0x3,_0x12fa7e=(0x0,utils_1[_0x135fdb(0xb5)])(_0xef288d,_0x3f612c);try{while(_0x12fa7e['length']){const _0x1a1b24=_0x12fa7e[_0x135fdb(0x9e)](0x0,Math[_0x135fdb(0xa5)](constants_1[_0x135fdb(0x8d)]/_0x3f612c));await this[_0x135fdb(0x92)](_0x1a1b24,_0x1bd095);}}catch(_0x2bd57c){this[_0x135fdb(0xc0)][_0x135fdb(0xb8)](_0x2bd57c instanceof salesforce_error_1['SalesforceError']?JSON[_0x135fdb(0x96)](_0x2bd57c[_0x135fdb(0x7c)](),null,0x2):_0x2bd57c),this[_0x135fdb(0x95)][_0x135fdb(0xc3)](_0x2bd57c instanceof salesforce_error_1[_0x135fdb(0x97)]?JSON['stringify'](_0x2bd57c[_0x135fdb(0x7c)](),null,0x2):_0x2bd57c[_0x135fdb(0x99)]());throw _0x2bd57c;}}async[a271_0x29a21e(0xb6)](_0x27fc30){const _0x29f883=a271_0x29a21e;for(const _0x20f749 of _0x27fc30){if(!_0x20f749[_0x29f883(0xa2)][_0x29f883(0xa0)]&&!_0x20f749[_0x29f883(0xa3)][_0x29f883(0xa0)]&&!_0x20f749[_0x29f883(0xc2)][_0x29f883(0xa0)])continue;const _0x2e7686=[],_0x523a90=[],_0x53dff8=new salesforce_components_manager_service_1[(_0x29f883(0x90))](this[_0x29f883(0x7d)]['repositoryId'],this[_0x29f883(0x7d)][_0x29f883(0xb7)],_0x20f749['author'],this[_0x29f883(0x7d)][_0x29f883(0xa6)],this['proceededComponentsMeta']);_0x2e7686['push'](...await _0x53dff8[_0x29f883(0xb1)](_0x20f749[_0x29f883(0xa2)],this['options'][_0x29f883(0x94)])),_0x2e7686[_0x29f883(0x9c)](...await _0x53dff8['update'](_0x20f749[_0x29f883(0xa3)],this['options'][_0x29f883(0x94)])),_0x523a90[_0x29f883(0x9c)](await _0x53dff8[_0x29f883(0x8f)](_0x20f749[_0x29f883(0xc2)],!![])),this[_0x29f883(0x8c)]=_0x53dff8[_0x29f883(0x7f)](),await this[_0x29f883(0xa4)](_0x2e7686,!![]);for(const _0x58d89a of _0x523a90){_0x58d89a[_0x29f883(0x82)][_0x29f883(0xa0)]&&await this[_0x29f883(0xa4)](_0x58d89a[_0x29f883(0x82)],!![]),_0x58d89a[_0x29f883(0xb2)][_0x29f883(0xa0)]&&await this[_0x29f883(0xa4)](_0x58d89a[_0x29f883(0xb2)],!![]),_0x58d89a[_0x29f883(0xaf)][_0x29f883(0xa0)]&&await this['proceedRequests'](_0x58d89a[_0x29f883(0xaf)],!![]);}this['logger'][_0x29f883(0xc3)](_0x29f883(0x7b),_0x2e7686[_0x29f883(0xa0)]);}}async[a271_0x29a21e(0x9d)](_0x7bd78){const _0x2a7797=a271_0x29a21e,_0x58c813=[],_0x32c112=[];for(const _0x417177 of _0x7bd78){if(!_0x417177[_0x2a7797(0xa2)][_0x2a7797(0xa0)]&&!_0x417177['modified'][_0x2a7797(0xa0)]&&!_0x417177[_0x2a7797(0xc2)][_0x2a7797(0xa0)])continue;const _0x3fcabe=new salesforce_components_manager_service_1[(_0x2a7797(0x90))](this['options']['repositoryId'],this[_0x2a7797(0x7d)][_0x2a7797(0xb7)],_0x417177[_0x2a7797(0xba)],this[_0x2a7797(0x7d)]['recordTypes'],[]);_0x58c813[_0x2a7797(0x9c)](...await _0x3fcabe[_0x2a7797(0xb1)](_0x417177[_0x2a7797(0xa2)])),_0x58c813[_0x2a7797(0x9c)](...await _0x3fcabe[_0x2a7797(0xbc)](_0x417177[_0x2a7797(0xa3)])),_0x32c112[_0x2a7797(0x9c)](await _0x3fcabe['delete'](_0x417177[_0x2a7797(0xc2)]));}this[_0x2a7797(0xc0)][_0x2a7797(0xc3)](_0x2a7797(0x9b),_0x58c813[_0x2a7797(0xa0)]),await this['proceedRequests'](_0x58c813);const _0x1d3a3e=_0x32c112[_0x2a7797(0xac)]((_0x708dc,_0x313843)=>({'manifests':[..._0x708dc['manifests'],..._0x313843[_0x2a7797(0x82)]],'componentsToDelete':[..._0x708dc[_0x2a7797(0xaf)],..._0x313843[_0x2a7797(0xaf)]],'componentsToUpdate':[..._0x708dc[_0x2a7797(0xb2)],..._0x313843[_0x2a7797(0xb2)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x1d3a3e[_0x2a7797(0x82)][_0x2a7797(0xa0)]&&await this['proceedRequests'](_0x1d3a3e[_0x2a7797(0x82)],!![]),_0x1d3a3e[_0x2a7797(0xb2)]['length']&&await this[_0x2a7797(0xa4)](_0x1d3a3e[_0x2a7797(0xb2)],!![]),_0x1d3a3e[_0x2a7797(0xaf)][_0x2a7797(0xa0)]&&await this['proceedRequests'](_0x1d3a3e[_0x2a7797(0xaf)],!![]);}async[a271_0x29a21e(0x89)](_0x960c70){const _0x4146f0=a271_0x29a21e;this['options'][_0x4146f0(0xb7)]?await this[_0x4146f0(0x9d)](_0x960c70):await this['proceedCommitsToRepository'](_0x960c70);}}exports['SalesforceCommitsManager']=SalesforceCommitsManager;