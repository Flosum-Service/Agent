const a227_0x47f1ed=a227_0x28d9;(function(_0x39c88f,_0x332a09){const _0x2910ef=a227_0x28d9,_0x24568f=_0x39c88f();while(!![]){try{const _0x14ddb2=parseInt(_0x2910ef(0x12a))/0x1+-parseInt(_0x2910ef(0x116))/0x2*(parseInt(_0x2910ef(0x11d))/0x3)+-parseInt(_0x2910ef(0x11e))/0x4+-parseInt(_0x2910ef(0x12f))/0x5+parseInt(_0x2910ef(0x12c))/0x6+parseInt(_0x2910ef(0xfe))/0x7*(parseInt(_0x2910ef(0x10f))/0x8)+-parseInt(_0x2910ef(0x125))/0x9*(parseInt(_0x2910ef(0x12e))/0xa);if(_0x14ddb2===_0x332a09)break;else _0x24568f['push'](_0x24568f['shift']());}catch(_0x3945c7){_0x24568f['push'](_0x24568f['shift']());}}}(a227_0x352c,0x92b8f));const a227_0x29e078=(function(){let _0x20adf4=!![];return function(_0x12fe8e,_0x42f6f4){const _0x577b17=_0x20adf4?function(){const _0x59ea13=a227_0x28d9;if(_0x42f6f4){const _0x4716ff=_0x42f6f4[_0x59ea13(0x11c)](_0x12fe8e,arguments);return _0x42f6f4=null,_0x4716ff;}}:function(){};return _0x20adf4=![],_0x577b17;};}()),a227_0x522be4=a227_0x29e078(this,function(){const _0x3ac671=a227_0x28d9;return a227_0x522be4[_0x3ac671(0xf1)]()[_0x3ac671(0xef)](_0x3ac671(0x120))['toString']()[_0x3ac671(0x112)](a227_0x522be4)['search'](_0x3ac671(0x120));});function a227_0x28d9(_0x5029de,_0x160698){const _0x5a2bd2=a227_0x352c();return a227_0x28d9=function(_0x522be4,_0x29e078){_0x522be4=_0x522be4-0xec;let _0x352c4e=_0x5a2bd2[_0x522be4];return _0x352c4e;},a227_0x28d9(_0x5029de,_0x160698);}a227_0x522be4();function a227_0x352c(){const _0x541c91=['proceedRequests','commitId','proceedChunksToUpload','composite','SalesforceCommitsManager','name','componentsToUpdate','reference','error','defineProperty','extractComponentIdsFromGraphsResponse','24WdEZSo','proceededComponentsMeta','insert','constructor','push','map','./salesforce-composite.service','32FicanG','find','\x20requests\x20to\x20composite\x20api.','length','reduce','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','apply','74589JACcet','870228RKNjyU','sfLogger','(((.+)+)+)+$','recordTypes','splice','removed','getProceededComponentsMeta','2637uzVuQR','componentsToDelete','toJSON','author','SALESFORCE_MAX_REQUEST_SIZE_BYTES','65891AZZcao','\x20COMPONENTS_SIZE\x20=\x20','6940170ntglaX','manifests','9470tASmPt','920545jcdfTG','graph','get','log','../../../../constants','../../../../core','stringify','SalesforceComponentsManager','proceedCommitsToRepository','search','delete','toString','COMPONENTS_PER_CHUNK','Sending\x20','inserted','SalesforceError','options','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','__esModule','executeGraphs','logger','SalesforceCompositeService','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','modified','1062446mHEuOr','proceedCommitsToBranch','branchId','componentId','../utils/composite.utils','repositoryId'];a227_0x352c=function(){return _0x541c91;};return a227_0x352c();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x154ae6){const _0x30a03d=a227_0x28d9;return _0x154ae6&&_0x154ae6[_0x30a03d(0xf8)]?_0x154ae6:{'default':_0x154ae6};};Object[a227_0x47f1ed(0x10d)](exports,a227_0x47f1ed(0xf8),{'value':!![]}),exports[a227_0x47f1ed(0x108)]=void 0x0;const core_1=require(a227_0x47f1ed(0x134)),typedi_1=__importDefault(require('typedi')),constants_1=require(a227_0x47f1ed(0x133)),utils_1=require('../../../shared/utils'),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a227_0x47f1ed(0x102)),salesforce_components_manager_service_1=require('./salesforce-components-manager.service'),salesforce_composite_service_1=require(a227_0x47f1ed(0x115));class SalesforceCommitsManager{constructor(_0x89aff0){const _0x34d0da=a227_0x47f1ed;this[_0x34d0da(0xf6)]=_0x89aff0,this[_0x34d0da(0xf2)]=0x3,this[_0x34d0da(0xfa)]=new core_1['Logger'](SalesforceCommitsManager[_0x34d0da(0x109)]),this[_0x34d0da(0x11f)]=this['options'][_0x34d0da(0xfa)],this[_0x34d0da(0x107)]=typedi_1['default'][_0x34d0da(0x131)](salesforce_composite_service_1[_0x34d0da(0xfb)]),this['proceededComponentsMeta']=[];}async[a227_0x47f1ed(0x106)](_0x9ada4,_0x344d3e=![]){const _0x5487d7=a227_0x47f1ed,_0x481108=async _0x196f77=>{const _0x4ca06c=a227_0x28d9;await this[_0x4ca06c(0xfa)][_0x4ca06c(0x132)](_0x4ca06c(0xf3)+_0x196f77[_0x4ca06c(0x11a)]((_0xcddc61,_0x386c76)=>_0xcddc61+_0x386c76['length'],0x0)+_0x4ca06c(0x118));const _0x46b21a=_0x196f77[_0x4ca06c(0x114)]((_0x5b956e,_0x2726d1)=>({'graphId':_0x4ca06c(0x130)+_0x2726d1,'compositeRequest':_0x5b956e})),_0x468854=await this[_0x4ca06c(0x107)][_0x4ca06c(0xf9)](_0x46b21a);if(_0x344d3e){const _0x5f2a79=(0x0,composite_utils_1[_0x4ca06c(0x10e)])(_0x468854);for(const {id:_0x2eb801,ref:_0x1ee4dc}of _0x5f2a79){const _0x130513=this['proceededComponentsMeta'][_0x4ca06c(0x117)](_0x4d5b0b=>_0x4d5b0b[_0x4ca06c(0x10b)]===_0x1ee4dc);_0x130513&&(_0x130513[_0x4ca06c(0x101)]=_0x2eb801);}}},_0x1a8329=0x1e8480;let _0x4b25a6=0x0,_0x279f83=[];for(const _0x298e89 of _0x9ada4){const _0x9e787a=_0x298e89['reduce']((_0x52baf2,_0xc2938d)=>{const _0x3576b1=a227_0x28d9,_0x263cf0=JSON[_0x3576b1(0xec)](_0xc2938d)[_0x3576b1(0x119)]*0x2;return _0x52baf2+_0x263cf0;},0x0);if(_0x9e787a>constants_1[_0x5487d7(0x129)])throw new salesforce_error_1[(_0x5487d7(0xf5))](_0x5487d7(0xf7)+constants_1[_0x5487d7(0x129)]+_0x5487d7(0x12b)+_0x9e787a);_0x4b25a6+_0x9e787a>constants_1[_0x5487d7(0x129)]-_0x1a8329&&(await _0x481108(_0x279f83),_0x279f83=[],_0x4b25a6=0x0),_0x4b25a6+=_0x9e787a,_0x279f83[_0x5487d7(0x113)](_0x298e89);}_0x279f83['length']&&await _0x481108(_0x279f83);}async[a227_0x47f1ed(0x104)](_0x3936d5,_0x1dec14=![]){const _0x28ede8=a227_0x47f1ed,_0x3fc5da=(this[_0x28ede8(0xf2)]+ +_0x1dec14)*0x3,_0x3130f2=(0x0,utils_1['chunkArray'])(_0x3936d5,_0x3fc5da);try{while(_0x3130f2[_0x28ede8(0x119)]){const _0x44933a=_0x3130f2[_0x28ede8(0x122)](0x0,Math['floor'](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x3fc5da));await this[_0x28ede8(0x106)](_0x44933a,_0x1dec14);}}catch(_0x39c2e5){this['logger'][_0x28ede8(0x10c)](_0x39c2e5 instanceof salesforce_error_1['SalesforceError']?JSON[_0x28ede8(0xec)](_0x39c2e5[_0x28ede8(0x127)](),null,0x2):_0x39c2e5),this[_0x28ede8(0x11f)][_0x28ede8(0x132)](_0x39c2e5 instanceof salesforce_error_1[_0x28ede8(0xf5)]?JSON['stringify'](_0x39c2e5[_0x28ede8(0x127)](),null,0x2):_0x39c2e5[_0x28ede8(0xf1)]());throw _0x39c2e5;}}async['proceedCommitsToRepository'](_0x52c741){const _0xf76359=a227_0x47f1ed;for(const _0x32daa6 of _0x52c741){if(!_0x32daa6['inserted'][_0xf76359(0x119)]&&!_0x32daa6[_0xf76359(0xfd)][_0xf76359(0x119)]&&!_0x32daa6['removed'][_0xf76359(0x119)])continue;const _0x5d9576=[],_0xd07d9f=[],_0xa1c61=new salesforce_components_manager_service_1[(_0xf76359(0xed))](this[_0xf76359(0xf6)]['repositoryId'],this[_0xf76359(0xf6)]['branchId'],_0x32daa6[_0xf76359(0x128)],this[_0xf76359(0xf6)][_0xf76359(0x121)],this[_0xf76359(0x110)]);_0x5d9576[_0xf76359(0x113)](...await _0xa1c61[_0xf76359(0x111)](_0x32daa6['inserted'],this[_0xf76359(0xf6)]['commitId'])),_0x5d9576[_0xf76359(0x113)](...await _0xa1c61['update'](_0x32daa6['modified'],this['options'][_0xf76359(0x105)])),_0xd07d9f[_0xf76359(0x113)](await _0xa1c61['delete'](_0x32daa6['removed'],!![])),this[_0xf76359(0x110)]=_0xa1c61[_0xf76359(0x124)](),await this['proceedRequests'](_0x5d9576,!![]);for(const _0x54e6c1 of _0xd07d9f){_0x54e6c1['manifests'][_0xf76359(0x119)]&&await this[_0xf76359(0x104)](_0x54e6c1['manifests'],!![]),_0x54e6c1[_0xf76359(0x10a)][_0xf76359(0x119)]&&await this[_0xf76359(0x104)](_0x54e6c1[_0xf76359(0x10a)],!![]),_0x54e6c1[_0xf76359(0x126)][_0xf76359(0x119)]&&await this['proceedRequests'](_0x54e6c1[_0xf76359(0x126)],!![]);}this['logger'][_0xf76359(0x132)](_0xf76359(0xfc),_0x5d9576[_0xf76359(0x119)]);}}async[a227_0x47f1ed(0xff)](_0x1fc8e6){const _0x550229=a227_0x47f1ed,_0x466644=[],_0x1c8d6d=[];for(const _0x4dc983 of _0x1fc8e6){if(!_0x4dc983['inserted']['length']&&!_0x4dc983[_0x550229(0xfd)][_0x550229(0x119)]&&!_0x4dc983[_0x550229(0x123)][_0x550229(0x119)])continue;const _0x26442b=new salesforce_components_manager_service_1[(_0x550229(0xed))](this['options'][_0x550229(0x103)],this[_0x550229(0xf6)][_0x550229(0x100)],_0x4dc983[_0x550229(0x128)],this[_0x550229(0xf6)][_0x550229(0x121)],[]);_0x466644[_0x550229(0x113)](...await _0x26442b[_0x550229(0x111)](_0x4dc983[_0x550229(0xf4)])),_0x466644[_0x550229(0x113)](...await _0x26442b['update'](_0x4dc983[_0x550229(0xfd)])),_0x1c8d6d[_0x550229(0x113)](await _0x26442b[_0x550229(0xf0)](_0x4dc983['removed']));}this[_0x550229(0xfa)][_0x550229(0x132)](_0x550229(0x11b),_0x466644['length']),await this[_0x550229(0x104)](_0x466644);const _0x1a9e4c=_0x1c8d6d[_0x550229(0x11a)]((_0x12262e,_0x58f90f)=>({'manifests':[..._0x12262e['manifests'],..._0x58f90f['manifests']],'componentsToDelete':[..._0x12262e[_0x550229(0x126)],..._0x58f90f['componentsToDelete']],'componentsToUpdate':[..._0x12262e[_0x550229(0x10a)],..._0x58f90f[_0x550229(0x10a)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x1a9e4c[_0x550229(0x12d)][_0x550229(0x119)]&&await this['proceedRequests'](_0x1a9e4c[_0x550229(0x12d)],!![]),_0x1a9e4c[_0x550229(0x10a)][_0x550229(0x119)]&&await this[_0x550229(0x104)](_0x1a9e4c[_0x550229(0x10a)],!![]),_0x1a9e4c['componentsToDelete'][_0x550229(0x119)]&&await this['proceedRequests'](_0x1a9e4c[_0x550229(0x126)],!![]);}async['proceedCommits'](_0x5ceb62){const _0x2fc74b=a227_0x47f1ed;this[_0x2fc74b(0xf6)]['branchId']?await this[_0x2fc74b(0xff)](_0x5ceb62):await this[_0x2fc74b(0xee)](_0x5ceb62);}}exports[a227_0x47f1ed(0x108)]=SalesforceCommitsManager;