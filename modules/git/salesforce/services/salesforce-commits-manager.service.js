const a270_0x5bfe7b=a270_0x2398;function a270_0x2398(_0x455bc7,_0x51d027){const _0x17b954=a270_0x24f1();return a270_0x2398=function(_0xfbd8f5,_0x413366){_0xfbd8f5=_0xfbd8f5-0x125;let _0x24f1e0=_0x17b954[_0xfbd8f5];return _0x24f1e0;},a270_0x2398(_0x455bc7,_0x51d027);}(function(_0x260a2b,_0x5206a4){const _0x4f8306=a270_0x2398,_0xab2aae=_0x260a2b();while(!![]){try{const _0x43ea79=parseInt(_0x4f8306(0x14a))/0x1*(parseInt(_0x4f8306(0x13b))/0x2)+-parseInt(_0x4f8306(0x131))/0x3+parseInt(_0x4f8306(0x143))/0x4+-parseInt(_0x4f8306(0x155))/0x5*(parseInt(_0x4f8306(0x145))/0x6)+parseInt(_0x4f8306(0x148))/0x7*(-parseInt(_0x4f8306(0x15e))/0x8)+-parseInt(_0x4f8306(0x138))/0x9+parseInt(_0x4f8306(0x127))/0xa*(parseInt(_0x4f8306(0x161))/0xb);if(_0x43ea79===_0x5206a4)break;else _0xab2aae['push'](_0xab2aae['shift']());}catch(_0x373d32){_0xab2aae['push'](_0xab2aae['shift']());}}}(a270_0x24f1,0xd39d9));const a270_0x413366=(function(){let _0x594323=!![];return function(_0xfae844,_0x1f87ef){const _0x5995f0=_0x594323?function(){const _0x19f99e=a270_0x2398;if(_0x1f87ef){const _0x2b8055=_0x1f87ef[_0x19f99e(0x146)](_0xfae844,arguments);return _0x1f87ef=null,_0x2b8055;}}:function(){};return _0x594323=![],_0x5995f0;};}()),a270_0xfbd8f5=a270_0x413366(this,function(){const _0x19160b=a270_0x2398;return a270_0xfbd8f5[_0x19160b(0x166)]()[_0x19160b(0x13f)]('(((.+)+)+)+$')[_0x19160b(0x166)]()[_0x19160b(0x14c)](a270_0xfbd8f5)[_0x19160b(0x13f)]('(((.+)+)+)+$');});a270_0xfbd8f5();'use strict';var __importDefault=this&&this[a270_0x5bfe7b(0x137)]||function(_0x1a6f5e){return _0x1a6f5e&&_0x1a6f5e['__esModule']?_0x1a6f5e:{'default':_0x1a6f5e};};Object[a270_0x5bfe7b(0x135)](exports,a270_0x5bfe7b(0x163),{'value':!![]}),exports[a270_0x5bfe7b(0x12d)]=void 0x0;function a270_0x24f1(){const _0x4bfb33=['search','SALESFORCE_MAX_REQUEST_SIZE_BYTES','toJSON','stringify','4784468TwYMlI','logger','5826KlEKuK','apply','delete','18291wtafVO','splice','1uzIuSn','sfLogger','constructor','repositoryId','\x20COMPONENTS_SIZE\x20=\x20','../errors/salesforce.error','commitId','length','proceedRequests','typedi','branchId','4625WRNEOp','default','componentsToDelete','graph','proceedCommitsToRepository','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','reduce','modified','get','4056eyrwGJ','error','log','643258KPrYGx','SalesforceCompositeService','__esModule','inserted','update','toString','proceedChunksToUpload','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','composite','SalesforceComponentsManager','componentId','map','removed','../../../shared/utils','recordTypes','author','push','executeGraphs','\x20requests\x20to\x20composite\x20api.','./salesforce-components-manager.service','220fasTRR','COMPONENTS_PER_CHUNK','proceededComponentsMeta','options','SalesforceError','Sending\x20','SalesforceCommitsManager','Logger','extractComponentIdsFromGraphsResponse','proceedCommitsToBranch','829695hjmqtu','proceedCommits','reference','insert','defineProperty','chunkArray','__importDefault','3118626LOTPLJ','../../../../core','componentsToUpdate','2460378ZpwJrU','../utils/composite.utils','manifests','name'];a270_0x24f1=function(){return _0x4bfb33;};return a270_0x24f1();}const core_1=require(a270_0x5bfe7b(0x139)),typedi_1=__importDefault(require(a270_0x5bfe7b(0x153))),constants_1=require('../../../../constants'),utils_1=require(a270_0x5bfe7b(0x16e)),salesforce_error_1=require(a270_0x5bfe7b(0x14f)),composite_utils_1=require(a270_0x5bfe7b(0x13c)),salesforce_components_manager_service_1=require(a270_0x5bfe7b(0x126)),salesforce_composite_service_1=require('./salesforce-composite.service');class SalesforceCommitsManager{constructor(_0x5a32f7){const _0x30f4cc=a270_0x5bfe7b;this[_0x30f4cc(0x12a)]=_0x5a32f7,this['COMPONENTS_PER_CHUNK']=0x3,this[_0x30f4cc(0x144)]=new core_1[(_0x30f4cc(0x12e))](SalesforceCommitsManager[_0x30f4cc(0x13e)]),this[_0x30f4cc(0x14b)]=this['options']['logger'],this[_0x30f4cc(0x169)]=typedi_1[_0x30f4cc(0x156)][_0x30f4cc(0x15d)](salesforce_composite_service_1[_0x30f4cc(0x162)]),this[_0x30f4cc(0x129)]=[];}async[a270_0x5bfe7b(0x167)](_0x38ff43,_0x4e89a2=![]){const _0x4d6b0d=a270_0x5bfe7b,_0x576e0a=async _0x1b201b=>{const _0x5b92d9=a270_0x2398;await this[_0x5b92d9(0x144)][_0x5b92d9(0x160)](_0x5b92d9(0x12c)+_0x1b201b[_0x5b92d9(0x15b)]((_0x15915c,_0x8fa6da)=>_0x15915c+_0x8fa6da['length'],0x0)+_0x5b92d9(0x125));const _0x514f3b=_0x1b201b[_0x5b92d9(0x16c)]((_0x455126,_0xffcb25)=>({'graphId':_0x5b92d9(0x158)+_0xffcb25,'compositeRequest':_0x455126})),_0x21ae39=await this[_0x5b92d9(0x169)][_0x5b92d9(0x172)](_0x514f3b);if(_0x4e89a2){const _0x4d0a35=(0x0,composite_utils_1[_0x5b92d9(0x12f)])(_0x21ae39);for(const {id:_0x14ddd9,ref:_0x35b221}of _0x4d0a35){const _0x3e12be=this[_0x5b92d9(0x129)]['find'](_0x19d458=>_0x19d458[_0x5b92d9(0x133)]===_0x35b221);_0x3e12be&&(_0x3e12be[_0x5b92d9(0x16b)]=_0x14ddd9);}}},_0x102989=0x1e8480;let _0x56e3d2=0x0,_0x4c4f8a=[];for(const _0x5457e4 of _0x38ff43){const _0x414b73=_0x5457e4[_0x4d6b0d(0x15b)]((_0x5144d1,_0x2e6714)=>{const _0x3af462=_0x4d6b0d,_0x33fc86=JSON[_0x3af462(0x142)](_0x2e6714)[_0x3af462(0x151)]*0x2;return _0x5144d1+_0x33fc86;},0x0);if(_0x414b73>constants_1[_0x4d6b0d(0x140)])throw new salesforce_error_1[(_0x4d6b0d(0x12b))]('Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20'+constants_1[_0x4d6b0d(0x140)]+_0x4d6b0d(0x14e)+_0x414b73);_0x56e3d2+_0x414b73>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']-_0x102989&&(await _0x576e0a(_0x4c4f8a),_0x4c4f8a=[],_0x56e3d2=0x0),_0x56e3d2+=_0x414b73,_0x4c4f8a[_0x4d6b0d(0x171)](_0x5457e4);}_0x4c4f8a[_0x4d6b0d(0x151)]&&await _0x576e0a(_0x4c4f8a);}async[a270_0x5bfe7b(0x152)](_0x2f92b1,_0x252bc7=![]){const _0x43ecb4=a270_0x5bfe7b,_0x3dbe94=(this[_0x43ecb4(0x128)]+ +_0x252bc7)*0x3,_0x48c154=(0x0,utils_1[_0x43ecb4(0x136)])(_0x2f92b1,_0x3dbe94);try{while(_0x48c154[_0x43ecb4(0x151)]){const _0x1f0b0a=_0x48c154[_0x43ecb4(0x149)](0x0,Math['floor'](constants_1[_0x43ecb4(0x168)]/_0x3dbe94));await this[_0x43ecb4(0x167)](_0x1f0b0a,_0x252bc7);}}catch(_0x2b5a44){this[_0x43ecb4(0x144)][_0x43ecb4(0x15f)](_0x2b5a44 instanceof salesforce_error_1[_0x43ecb4(0x12b)]?JSON['stringify'](_0x2b5a44[_0x43ecb4(0x141)](),null,0x2):_0x2b5a44),this[_0x43ecb4(0x14b)]['log'](_0x2b5a44 instanceof salesforce_error_1[_0x43ecb4(0x12b)]?JSON['stringify'](_0x2b5a44[_0x43ecb4(0x141)](),null,0x2):_0x2b5a44[_0x43ecb4(0x166)]());throw _0x2b5a44;}}async[a270_0x5bfe7b(0x159)](_0x502c17){const _0x126bba=a270_0x5bfe7b;for(const _0x577b5e of _0x502c17){if(!_0x577b5e['inserted']['length']&&!_0x577b5e[_0x126bba(0x15c)][_0x126bba(0x151)]&&!_0x577b5e['removed'][_0x126bba(0x151)])continue;const _0x39afab=[],_0x3ee07b=[],_0x5dba9d=new salesforce_components_manager_service_1[(_0x126bba(0x16a))](this[_0x126bba(0x12a)][_0x126bba(0x14d)],this[_0x126bba(0x12a)][_0x126bba(0x154)],_0x577b5e[_0x126bba(0x170)],this['options'][_0x126bba(0x16f)],this['proceededComponentsMeta']);_0x39afab[_0x126bba(0x171)](...await _0x5dba9d[_0x126bba(0x134)](_0x577b5e[_0x126bba(0x164)],this[_0x126bba(0x12a)][_0x126bba(0x150)])),_0x39afab[_0x126bba(0x171)](...await _0x5dba9d[_0x126bba(0x165)](_0x577b5e[_0x126bba(0x15c)],this[_0x126bba(0x12a)][_0x126bba(0x150)])),_0x3ee07b['push'](await _0x5dba9d['delete'](_0x577b5e[_0x126bba(0x16d)],!![])),this['proceededComponentsMeta']=_0x5dba9d['getProceededComponentsMeta'](),await this[_0x126bba(0x152)](_0x39afab,!![]);for(const _0x51d517 of _0x3ee07b){_0x51d517[_0x126bba(0x13d)][_0x126bba(0x151)]&&await this['proceedRequests'](_0x51d517[_0x126bba(0x13d)],!![]),_0x51d517['componentsToUpdate'][_0x126bba(0x151)]&&await this[_0x126bba(0x152)](_0x51d517[_0x126bba(0x13a)],!![]),_0x51d517[_0x126bba(0x157)][_0x126bba(0x151)]&&await this[_0x126bba(0x152)](_0x51d517[_0x126bba(0x157)],!![]);}this[_0x126bba(0x144)][_0x126bba(0x160)]('Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x39afab[_0x126bba(0x151)]);}}async[a270_0x5bfe7b(0x130)](_0x165061){const _0x19693c=a270_0x5bfe7b,_0x3c8914=[],_0x9504c0=[];for(const _0x5b623c of _0x165061){if(!_0x5b623c[_0x19693c(0x164)]['length']&&!_0x5b623c[_0x19693c(0x15c)][_0x19693c(0x151)]&&!_0x5b623c[_0x19693c(0x16d)]['length'])continue;const _0x2472ab=new salesforce_components_manager_service_1[(_0x19693c(0x16a))](this[_0x19693c(0x12a)][_0x19693c(0x14d)],this[_0x19693c(0x12a)][_0x19693c(0x154)],_0x5b623c[_0x19693c(0x170)],this[_0x19693c(0x12a)][_0x19693c(0x16f)],[]);_0x3c8914[_0x19693c(0x171)](...await _0x2472ab[_0x19693c(0x134)](_0x5b623c['inserted'])),_0x3c8914[_0x19693c(0x171)](...await _0x2472ab[_0x19693c(0x165)](_0x5b623c[_0x19693c(0x15c)])),_0x9504c0[_0x19693c(0x171)](await _0x2472ab[_0x19693c(0x147)](_0x5b623c['removed']));}this['logger'][_0x19693c(0x160)](_0x19693c(0x15a),_0x3c8914[_0x19693c(0x151)]),await this[_0x19693c(0x152)](_0x3c8914);const _0x5a684a=_0x9504c0[_0x19693c(0x15b)]((_0x379e5a,_0x4b0758)=>({'manifests':[..._0x379e5a['manifests'],..._0x4b0758[_0x19693c(0x13d)]],'componentsToDelete':[..._0x379e5a[_0x19693c(0x157)],..._0x4b0758[_0x19693c(0x157)]],'componentsToUpdate':[..._0x379e5a['componentsToUpdate'],..._0x4b0758[_0x19693c(0x13a)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x5a684a['manifests'][_0x19693c(0x151)]&&await this['proceedRequests'](_0x5a684a[_0x19693c(0x13d)],!![]),_0x5a684a[_0x19693c(0x13a)][_0x19693c(0x151)]&&await this['proceedRequests'](_0x5a684a[_0x19693c(0x13a)],!![]),_0x5a684a['componentsToDelete'][_0x19693c(0x151)]&&await this[_0x19693c(0x152)](_0x5a684a[_0x19693c(0x157)],!![]);}async[a270_0x5bfe7b(0x132)](_0x35d9d4){const _0x4c49e3=a270_0x5bfe7b;this[_0x4c49e3(0x12a)][_0x4c49e3(0x154)]?await this[_0x4c49e3(0x130)](_0x35d9d4):await this['proceedCommitsToRepository'](_0x35d9d4);}}exports[a270_0x5bfe7b(0x12d)]=SalesforceCommitsManager;