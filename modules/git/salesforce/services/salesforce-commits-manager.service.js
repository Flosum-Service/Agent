const a233_0x1822f8=a233_0x361e;(function(_0x53e51f,_0x2112aa){const _0x3a20cf=a233_0x361e,_0x27cd78=_0x53e51f();while(!![]){try{const _0x5339b5=-parseInt(_0x3a20cf(0x200))/0x1+parseInt(_0x3a20cf(0x209))/0x2*(parseInt(_0x3a20cf(0x213))/0x3)+-parseInt(_0x3a20cf(0x217))/0x4+parseInt(_0x3a20cf(0x211))/0x5*(parseInt(_0x3a20cf(0x1e8))/0x6)+parseInt(_0x3a20cf(0x22a))/0x7+parseInt(_0x3a20cf(0x1ec))/0x8*(-parseInt(_0x3a20cf(0x224))/0x9)+-parseInt(_0x3a20cf(0x205))/0xa*(-parseInt(_0x3a20cf(0x222))/0xb);if(_0x5339b5===_0x2112aa)break;else _0x27cd78['push'](_0x27cd78['shift']());}catch(_0x29b7ed){_0x27cd78['push'](_0x27cd78['shift']());}}}(a233_0x2e8d,0x291c4));const a233_0x3a5f5c=(function(){let _0x48f50d=!![];return function(_0x3b74b1,_0x833158){const _0xcbda9a=_0x48f50d?function(){const _0x5aca95=a233_0x361e;if(_0x833158){const _0x26dce7=_0x833158[_0x5aca95(0x22b)](_0x3b74b1,arguments);return _0x833158=null,_0x26dce7;}}:function(){};return _0x48f50d=![],_0xcbda9a;};}()),a233_0x15a159=a233_0x3a5f5c(this,function(){const _0x1cd6cf=a233_0x361e;return a233_0x15a159[_0x1cd6cf(0x22d)]()[_0x1cd6cf(0x20d)]('(((.+)+)+)+$')[_0x1cd6cf(0x22d)]()[_0x1cd6cf(0x1f0)](a233_0x15a159)[_0x1cd6cf(0x20d)](_0x1cd6cf(0x21e));});a233_0x15a159();'use strict';var __importDefault=this&&this[a233_0x1822f8(0x1e5)]||function(_0x30bbe4){const _0x1b2e2=a233_0x1822f8;return _0x30bbe4&&_0x30bbe4[_0x1b2e2(0x20b)]?_0x30bbe4:{'default':_0x30bbe4};};function a233_0x2e8d(){const _0x1dac0e=['Sending\x20','toJSON','author','6293960KEPQQK','SalesforceCommitsManager','componentsToDelete','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','388086eOmtXh','reduce','__esModule','recordTypes','search','COMPONENTS_PER_CHUNK','reference','push','20mmCCEU','length','3vCuezt','removed','find','./salesforce-components-manager.service','1119068NWsBjR','splice','log','floor','name','SalesforceError','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','(((.+)+)+)+$','commitId','composite','proceedRequests','11yrUpKz','chunkArray','431667hSJXJC','\x20COMPONENTS_SIZE\x20=\x20','manifests','proceededComponentsMeta','./salesforce-composite.service','\x20requests\x20to\x20composite\x20api.','112931rFnKxu','apply','get','toString','insert','defineProperty','__importDefault','executeGraphs','SalesforceComponentsManager','99906cwHhJn','proceedCommits','repositoryId','branchId','24GmhpYK','getProceededComponentsMeta','SALESFORCE_MAX_REQUEST_SIZE_BYTES','options','constructor','componentsToUpdate','proceedCommitsToRepository','componentId','inserted','../../../../constants','extractComponentIdsFromGraphsResponse','logger','modified','graph','delete','../../../shared/utils','sfLogger','../errors/salesforce.error','default','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','314132sCKYYI','update'];a233_0x2e8d=function(){return _0x1dac0e;};return a233_0x2e8d();}function a233_0x361e(_0x22d8ee,_0x4e08b6){const _0x1302cb=a233_0x2e8d();return a233_0x361e=function(_0x15a159,_0x3a5f5c){_0x15a159=_0x15a159-0x1e5;let _0x2e8dbc=_0x1302cb[_0x15a159];return _0x2e8dbc;},a233_0x361e(_0x22d8ee,_0x4e08b6);}Object[a233_0x1822f8(0x22f)](exports,'__esModule',{'value':!![]}),exports[a233_0x1822f8(0x206)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require('typedi')),constants_1=require(a233_0x1822f8(0x1f5)),utils_1=require(a233_0x1822f8(0x1fb)),salesforce_error_1=require(a233_0x1822f8(0x1fd)),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require(a233_0x1822f8(0x216)),salesforce_composite_service_1=require(a233_0x1822f8(0x228));class SalesforceCommitsManager{constructor(_0x25bfb1){const _0x3d4719=a233_0x1822f8;this[_0x3d4719(0x1ef)]=_0x25bfb1,this[_0x3d4719(0x20e)]=0x3,this['logger']=new core_1['Logger'](SalesforceCommitsManager[_0x3d4719(0x21b)]),this['sfLogger']=this[_0x3d4719(0x1ef)][_0x3d4719(0x1f7)],this[_0x3d4719(0x220)]=typedi_1[_0x3d4719(0x1fe)][_0x3d4719(0x22c)](salesforce_composite_service_1['SalesforceCompositeService']),this['proceededComponentsMeta']=[];}async['proceedChunksToUpload'](_0x4dbd68,_0x563b5f=![]){const _0xa59590=a233_0x1822f8,_0x4c910a=async _0x27ae20=>{const _0x26929f=a233_0x361e;await this['logger'][_0x26929f(0x219)](_0x26929f(0x202)+_0x27ae20[_0x26929f(0x20a)]((_0x5b103c,_0x2a4ebf)=>_0x5b103c+_0x2a4ebf[_0x26929f(0x212)],0x0)+_0x26929f(0x229));const _0x4c727a=_0x27ae20['map']((_0x3de8c2,_0x302244)=>({'graphId':_0x26929f(0x1f9)+_0x302244,'compositeRequest':_0x3de8c2})),_0x2d1d8d=await this[_0x26929f(0x220)][_0x26929f(0x1e6)](_0x4c727a);if(_0x563b5f){const _0x16ecef=(0x0,composite_utils_1[_0x26929f(0x1f6)])(_0x2d1d8d);for(const {id:_0x1612e9,ref:_0x5d6044}of _0x16ecef){const _0x1e0bd9=this['proceededComponentsMeta'][_0x26929f(0x215)](_0x53c247=>_0x53c247[_0x26929f(0x20f)]===_0x5d6044);_0x1e0bd9&&(_0x1e0bd9[_0x26929f(0x1f3)]=_0x1612e9);}}},_0x4c0447=0x1e8480;let _0x4b6da0=0x0,_0x53e7e8=[];for(const _0x2b8278 of _0x4dbd68){const _0x16287b=_0x2b8278['reduce']((_0xfa4189,_0x2adf6b)=>{const _0xe02a4d=a233_0x361e,_0x2362bc=JSON['stringify'](_0x2adf6b)[_0xe02a4d(0x212)]*0x2;return _0xfa4189+_0x2362bc;},0x0);if(_0x16287b>constants_1[_0xa59590(0x1ee)])throw new salesforce_error_1['SalesforceError']('Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20'+constants_1[_0xa59590(0x1ee)]+_0xa59590(0x225)+_0x16287b);_0x4b6da0+_0x16287b>constants_1[_0xa59590(0x1ee)]-_0x4c0447&&(await _0x4c910a(_0x53e7e8),_0x53e7e8=[],_0x4b6da0=0x0),_0x4b6da0+=_0x16287b,_0x53e7e8[_0xa59590(0x210)](_0x2b8278);}_0x53e7e8[_0xa59590(0x212)]&&await _0x4c910a(_0x53e7e8);}async['proceedRequests'](_0xeab13e,_0x199f62=![]){const _0x5ea702=a233_0x1822f8,_0x5856ea=(this[_0x5ea702(0x20e)]+ +_0x199f62)*0x3,_0x590fd5=(0x0,utils_1[_0x5ea702(0x223)])(_0xeab13e,_0x5856ea);try{while(_0x590fd5[_0x5ea702(0x212)]){const _0x27d1d6=_0x590fd5[_0x5ea702(0x218)](0x0,Math[_0x5ea702(0x21a)](constants_1[_0x5ea702(0x1ff)]/_0x5856ea));await this['proceedChunksToUpload'](_0x27d1d6,_0x199f62);}}catch(_0xaf4020){this[_0x5ea702(0x1f7)]['error'](_0xaf4020 instanceof salesforce_error_1[_0x5ea702(0x21c)]?JSON['stringify'](_0xaf4020['toJSON'](),null,0x2):_0xaf4020),this[_0x5ea702(0x1fc)]['log'](_0xaf4020 instanceof salesforce_error_1[_0x5ea702(0x21c)]?JSON['stringify'](_0xaf4020[_0x5ea702(0x203)](),null,0x2):_0xaf4020[_0x5ea702(0x22d)]());throw _0xaf4020;}}async[a233_0x1822f8(0x1f2)](_0x3cc6e1){const _0x350f05=a233_0x1822f8;for(const _0x1f8acb of _0x3cc6e1){if(!_0x1f8acb['inserted']['length']&&!_0x1f8acb[_0x350f05(0x1f8)][_0x350f05(0x212)]&&!_0x1f8acb[_0x350f05(0x214)]['length'])continue;const _0x115ebc=[],_0x4fea76=[],_0x557f6a=new salesforce_components_manager_service_1[(_0x350f05(0x1e7))](this[_0x350f05(0x1ef)][_0x350f05(0x1ea)],this[_0x350f05(0x1ef)][_0x350f05(0x1eb)],_0x1f8acb[_0x350f05(0x204)],this[_0x350f05(0x1ef)]['recordTypes'],this[_0x350f05(0x227)]);_0x115ebc[_0x350f05(0x210)](...await _0x557f6a[_0x350f05(0x22e)](_0x1f8acb[_0x350f05(0x1f4)],this['options']['commitId'])),_0x115ebc[_0x350f05(0x210)](...await _0x557f6a[_0x350f05(0x201)](_0x1f8acb[_0x350f05(0x1f8)],this[_0x350f05(0x1ef)][_0x350f05(0x21f)])),_0x4fea76['push'](await _0x557f6a['delete'](_0x1f8acb[_0x350f05(0x214)],!![])),this['proceededComponentsMeta']=_0x557f6a[_0x350f05(0x1ed)](),await this['proceedRequests'](_0x115ebc,!![]);for(const _0x4ed98c of _0x4fea76){_0x4ed98c['manifests']['length']&&await this[_0x350f05(0x221)](_0x4ed98c['manifests'],!![]),_0x4ed98c[_0x350f05(0x1f1)][_0x350f05(0x212)]&&await this[_0x350f05(0x221)](_0x4ed98c[_0x350f05(0x1f1)],!![]),_0x4ed98c['componentsToDelete'][_0x350f05(0x212)]&&await this[_0x350f05(0x221)](_0x4ed98c[_0x350f05(0x207)],!![]);}this[_0x350f05(0x1f7)][_0x350f05(0x219)](_0x350f05(0x208),_0x115ebc['length']);}}async['proceedCommitsToBranch'](_0x50c4cb){const _0x47b02a=a233_0x1822f8,_0x43af26=[],_0x223853=[];for(const _0x2d8d65 of _0x50c4cb){if(!_0x2d8d65[_0x47b02a(0x1f4)][_0x47b02a(0x212)]&&!_0x2d8d65[_0x47b02a(0x1f8)][_0x47b02a(0x212)]&&!_0x2d8d65[_0x47b02a(0x214)][_0x47b02a(0x212)])continue;const _0x20a5d7=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this['options'][_0x47b02a(0x1ea)],this[_0x47b02a(0x1ef)][_0x47b02a(0x1eb)],_0x2d8d65[_0x47b02a(0x204)],this[_0x47b02a(0x1ef)][_0x47b02a(0x20c)],[]);_0x43af26[_0x47b02a(0x210)](...await _0x20a5d7['insert'](_0x2d8d65[_0x47b02a(0x1f4)])),_0x43af26[_0x47b02a(0x210)](...await _0x20a5d7['update'](_0x2d8d65[_0x47b02a(0x1f8)])),_0x223853[_0x47b02a(0x210)](await _0x20a5d7[_0x47b02a(0x1fa)](_0x2d8d65[_0x47b02a(0x214)]));}this[_0x47b02a(0x1f7)][_0x47b02a(0x219)](_0x47b02a(0x21d),_0x43af26[_0x47b02a(0x212)]),await this[_0x47b02a(0x221)](_0x43af26);const _0x25c876=_0x223853['reduce']((_0x367feb,_0x3e94e9)=>({'manifests':[..._0x367feb['manifests'],..._0x3e94e9[_0x47b02a(0x226)]],'componentsToDelete':[..._0x367feb[_0x47b02a(0x207)],..._0x3e94e9['componentsToDelete']],'componentsToUpdate':[..._0x367feb[_0x47b02a(0x1f1)],..._0x3e94e9[_0x47b02a(0x1f1)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x25c876[_0x47b02a(0x226)]['length']&&await this[_0x47b02a(0x221)](_0x25c876[_0x47b02a(0x226)],!![]),_0x25c876[_0x47b02a(0x1f1)][_0x47b02a(0x212)]&&await this[_0x47b02a(0x221)](_0x25c876[_0x47b02a(0x1f1)],!![]),_0x25c876['componentsToDelete'][_0x47b02a(0x212)]&&await this[_0x47b02a(0x221)](_0x25c876[_0x47b02a(0x207)],!![]);}async[a233_0x1822f8(0x1e9)](_0x2c3747){const _0x39aca7=a233_0x1822f8;this[_0x39aca7(0x1ef)][_0x39aca7(0x1eb)]?await this['proceedCommitsToBranch'](_0x2c3747):await this[_0x39aca7(0x1f2)](_0x2c3747);}}exports[a233_0x1822f8(0x206)]=SalesforceCommitsManager;