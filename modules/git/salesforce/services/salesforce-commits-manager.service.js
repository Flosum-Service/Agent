const a260_0x3fb527=a260_0x2a8d;(function(_0x5e6bde,_0x3aae9d){const _0x406c46=a260_0x2a8d,_0x17f29a=_0x5e6bde();while(!![]){try{const _0x2dd056=-parseInt(_0x406c46(0x214))/0x1*(parseInt(_0x406c46(0x1d5))/0x2)+-parseInt(_0x406c46(0x206))/0x3*(parseInt(_0x406c46(0x1e0))/0x4)+-parseInt(_0x406c46(0x1f6))/0x5*(-parseInt(_0x406c46(0x1f3))/0x6)+-parseInt(_0x406c46(0x1f2))/0x7*(-parseInt(_0x406c46(0x1fe))/0x8)+-parseInt(_0x406c46(0x1dc))/0x9*(-parseInt(_0x406c46(0x20a))/0xa)+-parseInt(_0x406c46(0x20d))/0xb+parseInt(_0x406c46(0x1d1))/0xc;if(_0x2dd056===_0x3aae9d)break;else _0x17f29a['push'](_0x17f29a['shift']());}catch(_0x4195b2){_0x17f29a['push'](_0x17f29a['shift']());}}}(a260_0x1468,0x82608));const a260_0x812e1e=(function(){let _0x2be653=!![];return function(_0x5136d5,_0x270937){const _0x9a7d5b=_0x2be653?function(){const _0x545e9f=a260_0x2a8d;if(_0x270937){const _0x29dab4=_0x270937[_0x545e9f(0x1d3)](_0x5136d5,arguments);return _0x270937=null,_0x29dab4;}}:function(){};return _0x2be653=![],_0x9a7d5b;};}()),a260_0x58f9ac=a260_0x812e1e(this,function(){const _0x5be971=a260_0x2a8d;return a260_0x58f9ac[_0x5be971(0x1ee)]()['search'](_0x5be971(0x1e3))[_0x5be971(0x1ee)]()[_0x5be971(0x1e5)](a260_0x58f9ac)[_0x5be971(0x200)](_0x5be971(0x1e3));});function a260_0x2a8d(_0x4df353,_0x26fa60){const _0x2ea759=a260_0x1468();return a260_0x2a8d=function(_0x58f9ac,_0x812e1e){_0x58f9ac=_0x58f9ac-0x1c7;let _0x1468cc=_0x2ea759[_0x58f9ac];return _0x1468cc;},a260_0x2a8d(_0x4df353,_0x26fa60);}a260_0x58f9ac();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3a5834){const _0x28ce09=a260_0x2a8d;return _0x3a5834&&_0x3a5834[_0x28ce09(0x1ff)]?_0x3a5834:{'default':_0x3a5834};};Object[a260_0x3fb527(0x20c)](exports,'__esModule',{'value':!![]}),exports[a260_0x3fb527(0x203)]=void 0x0;const core_1=require(a260_0x3fb527(0x205)),typedi_1=__importDefault(require('typedi')),constants_1=require(a260_0x3fb527(0x1c9)),utils_1=require('../../../shared/utils'),salesforce_error_1=require(a260_0x3fb527(0x20e)),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require(a260_0x3fb527(0x1d2)),salesforce_composite_service_1=require(a260_0x3fb527(0x1e7));function a260_0x1468(){const _0x22c8ae=['author','../../../../core','12fRExtd','graph','recordTypes','proceedCommitsToRepository','2440YwIpeP','get','defineProperty','3456046ljykDl','../errors/salesforce.error','name','removed','componentId','logger','SalesforceComponentsManager','11400OafXcH','reduce','repositoryId','../../../../constants','Logger','SalesforceCompositeService','default','stringify','floor','commitId','map','2933832dvvNEF','./salesforce-components-manager.service','apply','find','86QtDrXC','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','executeGraphs','branchId','splice','proceedCommits','COMPONENTS_PER_CHUNK','22023kXgWFn','extractComponentIdsFromGraphsResponse','componentsToDelete','push','664164rsyAOO','proceedCommitsToBranch','error','(((.+)+)+)+$','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','constructor','chunkArray','./salesforce-composite.service','manifests','proceedRequests','proceededComponentsMeta','update','componentsToUpdate','sfLogger','toString','Have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','delete','inserted','234458oTOqRd','3348768arRdxN','proceedChunksToUpload','insert','5jYpTkZ','toJSON','log','modified','length','options','getProceededComponentsMeta','SALESFORCE_MAX_REQUEST_SIZE_BYTES','144JTqNOg','__esModule','search','SalesforceError','Sending\x20','SalesforceCommitsManager'];a260_0x1468=function(){return _0x22c8ae;};return a260_0x1468();}class SalesforceCommitsManager{constructor(_0x11982e){const _0x12e537=a260_0x3fb527;this[_0x12e537(0x1fb)]=_0x11982e,this[_0x12e537(0x1db)]=0x3,this[_0x12e537(0x212)]=new core_1[(_0x12e537(0x1ca))](SalesforceCommitsManager[_0x12e537(0x20f)]),this['sfLogger']=this[_0x12e537(0x1fb)]['logger'],this['composite']=typedi_1[_0x12e537(0x1cc)][_0x12e537(0x20b)](salesforce_composite_service_1[_0x12e537(0x1cb)]),this[_0x12e537(0x1ea)]=[];}async[a260_0x3fb527(0x1f4)](_0x3031fb,_0x3755c9=![]){const _0x1a57e3=a260_0x3fb527,_0x32853f=async _0x5c5a38=>{const _0x2e3761=a260_0x2a8d;await this[_0x2e3761(0x212)][_0x2e3761(0x1f8)](_0x2e3761(0x202)+_0x5c5a38[_0x2e3761(0x1c7)]((_0x276e3e,_0x541010)=>_0x276e3e+_0x541010[_0x2e3761(0x1fa)],0x0)+'\x20requests\x20to\x20composite\x20api.');const _0x236c7f=_0x5c5a38[_0x2e3761(0x1d0)]((_0x28c4df,_0x129078)=>({'graphId':_0x2e3761(0x207)+_0x129078,'compositeRequest':_0x28c4df})),_0x35eece=await this['composite'][_0x2e3761(0x1d7)](_0x236c7f);if(_0x3755c9){const _0x3c5c51=(0x0,composite_utils_1[_0x2e3761(0x1dd)])(_0x35eece);for(const {id:_0x437ad3,ref:_0x3a3925}of _0x3c5c51){const _0x1e64fe=this[_0x2e3761(0x1ea)][_0x2e3761(0x1d4)](_0x27fb08=>_0x27fb08['reference']===_0x3a3925);_0x1e64fe&&(_0x1e64fe[_0x2e3761(0x211)]=_0x437ad3);}}},_0x428cdc=0x1e8480;let _0x48db0a=0x0,_0x1b28c4=[];for(const _0x1f0115 of _0x3031fb){const _0x8e4682=_0x1f0115[_0x1a57e3(0x1c7)]((_0x15744b,_0xc58028)=>{const _0x445189=_0x1a57e3,_0x4ce464=JSON[_0x445189(0x1cd)](_0xc58028)[_0x445189(0x1fa)]*0x2;return _0x15744b+_0x4ce464;},0x0);if(_0x8e4682>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES'])throw new salesforce_error_1[(_0x1a57e3(0x201))](_0x1a57e3(0x1e4)+constants_1[_0x1a57e3(0x1fd)]+'\x20COMPONENTS_SIZE\x20=\x20'+_0x8e4682);_0x48db0a+_0x8e4682>constants_1[_0x1a57e3(0x1fd)]-_0x428cdc&&(await _0x32853f(_0x1b28c4),_0x1b28c4=[],_0x48db0a=0x0),_0x48db0a+=_0x8e4682,_0x1b28c4[_0x1a57e3(0x1df)](_0x1f0115);}_0x1b28c4[_0x1a57e3(0x1fa)]&&await _0x32853f(_0x1b28c4);}async[a260_0x3fb527(0x1e9)](_0x14dff1,_0x95c77e=![]){const _0x2d611f=a260_0x3fb527,_0x2ba9e0=(this['COMPONENTS_PER_CHUNK']+ +_0x95c77e)*0x3,_0x14a541=(0x0,utils_1[_0x2d611f(0x1e6)])(_0x14dff1,_0x2ba9e0);try{while(_0x14a541[_0x2d611f(0x1fa)]){const _0x474ff3=_0x14a541[_0x2d611f(0x1d9)](0x0,Math[_0x2d611f(0x1ce)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x2ba9e0));await this[_0x2d611f(0x1f4)](_0x474ff3,_0x95c77e);}}catch(_0x1a679a){this[_0x2d611f(0x212)][_0x2d611f(0x1e2)](_0x1a679a instanceof salesforce_error_1['SalesforceError']?JSON[_0x2d611f(0x1cd)](_0x1a679a[_0x2d611f(0x1f7)](),null,0x2):_0x1a679a),this[_0x2d611f(0x1ed)][_0x2d611f(0x1f8)](_0x1a679a instanceof salesforce_error_1[_0x2d611f(0x201)]?JSON[_0x2d611f(0x1cd)](_0x1a679a[_0x2d611f(0x1f7)](),null,0x2):_0x1a679a[_0x2d611f(0x1ee)]());throw _0x1a679a;}}async[a260_0x3fb527(0x209)](_0x13568c){const _0x2b86d4=a260_0x3fb527;for(const _0x48b3d2 of _0x13568c){if(!_0x48b3d2[_0x2b86d4(0x1f1)][_0x2b86d4(0x1fa)]&&!_0x48b3d2[_0x2b86d4(0x1f9)]['length']&&!_0x48b3d2['removed'][_0x2b86d4(0x1fa)])continue;const _0x40f334=[],_0x1a1d4a=[],_0x45743d=new salesforce_components_manager_service_1[(_0x2b86d4(0x213))](this[_0x2b86d4(0x1fb)]['repositoryId'],this[_0x2b86d4(0x1fb)][_0x2b86d4(0x1d8)],_0x48b3d2[_0x2b86d4(0x204)],this[_0x2b86d4(0x1fb)][_0x2b86d4(0x208)],this[_0x2b86d4(0x1ea)]);_0x40f334[_0x2b86d4(0x1df)](...await _0x45743d[_0x2b86d4(0x1f5)](_0x48b3d2['inserted'],this[_0x2b86d4(0x1fb)][_0x2b86d4(0x1cf)])),_0x40f334[_0x2b86d4(0x1df)](...await _0x45743d['update'](_0x48b3d2[_0x2b86d4(0x1f9)],this['options']['commitId'])),_0x1a1d4a[_0x2b86d4(0x1df)](await _0x45743d[_0x2b86d4(0x1f0)](_0x48b3d2[_0x2b86d4(0x210)],!![])),this[_0x2b86d4(0x1ea)]=_0x45743d[_0x2b86d4(0x1fc)](),await this[_0x2b86d4(0x1e9)](_0x40f334,!![]);for(const _0x2fbdf4 of _0x1a1d4a){_0x2fbdf4[_0x2b86d4(0x1e8)]['length']&&await this[_0x2b86d4(0x1e9)](_0x2fbdf4['manifests'],!![]),_0x2fbdf4[_0x2b86d4(0x1ec)][_0x2b86d4(0x1fa)]&&await this[_0x2b86d4(0x1e9)](_0x2fbdf4[_0x2b86d4(0x1ec)],!![]),_0x2fbdf4[_0x2b86d4(0x1de)][_0x2b86d4(0x1fa)]&&await this[_0x2b86d4(0x1e9)](_0x2fbdf4[_0x2b86d4(0x1de)],!![]);}this[_0x2b86d4(0x212)]['log'](_0x2b86d4(0x1d6),_0x40f334[_0x2b86d4(0x1fa)]);}}async['proceedCommitsToBranch'](_0x318690){const _0x2c0b7b=a260_0x3fb527,_0x289acf=[],_0x53e0f5=[];for(const _0x373bf8 of _0x318690){if(!_0x373bf8['inserted'][_0x2c0b7b(0x1fa)]&&!_0x373bf8[_0x2c0b7b(0x1f9)][_0x2c0b7b(0x1fa)]&&!_0x373bf8[_0x2c0b7b(0x210)]['length'])continue;const _0x481654=new salesforce_components_manager_service_1[(_0x2c0b7b(0x213))](this[_0x2c0b7b(0x1fb)][_0x2c0b7b(0x1c8)],this[_0x2c0b7b(0x1fb)]['branchId'],_0x373bf8[_0x2c0b7b(0x204)],this[_0x2c0b7b(0x1fb)][_0x2c0b7b(0x208)],[]);_0x289acf['push'](...await _0x481654[_0x2c0b7b(0x1f5)](_0x373bf8[_0x2c0b7b(0x1f1)])),_0x289acf[_0x2c0b7b(0x1df)](...await _0x481654[_0x2c0b7b(0x1eb)](_0x373bf8[_0x2c0b7b(0x1f9)])),_0x53e0f5['push'](await _0x481654['delete'](_0x373bf8[_0x2c0b7b(0x210)]));}this['logger'][_0x2c0b7b(0x1f8)](_0x2c0b7b(0x1ef),_0x289acf[_0x2c0b7b(0x1fa)]),await this[_0x2c0b7b(0x1e9)](_0x289acf);const _0x40f394=_0x53e0f5[_0x2c0b7b(0x1c7)]((_0x4b40f8,_0x3a15e2)=>({'manifests':[..._0x4b40f8[_0x2c0b7b(0x1e8)],..._0x3a15e2[_0x2c0b7b(0x1e8)]],'componentsToDelete':[..._0x4b40f8[_0x2c0b7b(0x1de)],..._0x3a15e2[_0x2c0b7b(0x1de)]],'componentsToUpdate':[..._0x4b40f8[_0x2c0b7b(0x1ec)],..._0x3a15e2[_0x2c0b7b(0x1ec)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x40f394['manifests'][_0x2c0b7b(0x1fa)]&&await this[_0x2c0b7b(0x1e9)](_0x40f394[_0x2c0b7b(0x1e8)],!![]),_0x40f394[_0x2c0b7b(0x1ec)][_0x2c0b7b(0x1fa)]&&await this[_0x2c0b7b(0x1e9)](_0x40f394['componentsToUpdate'],!![]),_0x40f394[_0x2c0b7b(0x1de)][_0x2c0b7b(0x1fa)]&&await this[_0x2c0b7b(0x1e9)](_0x40f394[_0x2c0b7b(0x1de)],!![]);}async[a260_0x3fb527(0x1da)](_0x18eb5b){const _0x1861d1=a260_0x3fb527;this[_0x1861d1(0x1fb)][_0x1861d1(0x1d8)]?await this[_0x1861d1(0x1e1)](_0x18eb5b):await this[_0x1861d1(0x209)](_0x18eb5b);}}exports['SalesforceCommitsManager']=SalesforceCommitsManager;