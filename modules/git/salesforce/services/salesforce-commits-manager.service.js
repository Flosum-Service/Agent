const a181_0x586188=a181_0xbfc1;function a181_0x17df(){const _0x3d65b7=['constructor','201160RyTtDf','graph','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','componentsToUpdate','55JatCyC','insert','options','SalesforceError','(((.+)+)+)+$','../../../../constants','get','proceedCommitsToBranch','manifests','executeGraphs','__esModule','../../../shared/utils','commitId','default','length','repositoryId','SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST','\x20requests\x20to\x20composite\x20api.','branchId','proceedRequests','floor','2572JLDuRP','proceededComponentsMeta','SalesforceCompositeService','sfLogger','map','modified','push','log','search','245088FCkHyU','10YrgJKk','COMPONENTS_PER_CHUNK','SalesforceCommitsManager','componentId','componentsToDelete','2474487MwEbsR','delete','defineProperty','recordTypes','author','proceedCommitsToRepository','toString','stringify','./salesforce-components-manager.service','find','reference','logger','4507097xkoEuS','apply','820240YFPjLw','extractComponentIdsFromGraphsResponse','../../../../core','SalesforceComponentsManager','reduce','toJSON','update','./salesforce-composite.service','inserted','removed','1549134BDnPag'];a181_0x17df=function(){return _0x3d65b7;};return a181_0x17df();}(function(_0xb17cb9,_0x3e1947){const _0x6fcd5c=a181_0xbfc1,_0x736869=_0xb17cb9();while(!![]){try{const _0x49ff52=parseInt(_0x6fcd5c(0x14f))/0x1*(-parseInt(_0x6fcd5c(0x164))/0x2)+parseInt(_0x6fcd5c(0x16d))/0x3+-parseInt(_0x6fcd5c(0x14b))/0x4*(parseInt(_0x6fcd5c(0x16e))/0x5)+parseInt(_0x6fcd5c(0x149))/0x6+parseInt(_0x6fcd5c(0x13d))/0x7+-parseInt(_0x6fcd5c(0x13f))/0x8+-parseInt(_0x6fcd5c(0x131))/0x9;if(_0x49ff52===_0x3e1947)break;else _0x736869['push'](_0x736869['shift']());}catch(_0x10e3ff){_0x736869['push'](_0x736869['shift']());}}}(a181_0x17df,0x6a31d));const a181_0x4ab63b=(function(){let _0x3d79d3=!![];return function(_0x350a49,_0x1c9731){const _0x5d1980=_0x3d79d3?function(){const _0x55f2f1=a181_0xbfc1;if(_0x1c9731){const _0x1625eb=_0x1c9731[_0x55f2f1(0x13e)](_0x350a49,arguments);return _0x1c9731=null,_0x1625eb;}}:function(){};return _0x3d79d3=![],_0x5d1980;};}()),a181_0x4abf66=a181_0x4ab63b(this,function(){const _0x23e42d=a181_0xbfc1;return a181_0x4abf66[_0x23e42d(0x137)]()[_0x23e42d(0x16c)]('(((.+)+)+)+$')[_0x23e42d(0x137)]()[_0x23e42d(0x14a)](a181_0x4abf66)[_0x23e42d(0x16c)](_0x23e42d(0x153));});a181_0x4abf66();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2a6350){const _0x3cb4c2=a181_0xbfc1;return _0x2a6350&&_0x2a6350[_0x3cb4c2(0x159)]?_0x2a6350:{'default':_0x2a6350};};Object[a181_0x586188(0x133)](exports,'__esModule',{'value':!![]}),exports[a181_0x586188(0x170)]=void 0x0;function a181_0xbfc1(_0x3c5219,_0x46c19b){const _0x2ebc88=a181_0x17df();return a181_0xbfc1=function(_0x4abf66,_0x4ab63b){_0x4abf66=_0x4abf66-0x131;let _0x17df3d=_0x2ebc88[_0x4abf66];return _0x17df3d;},a181_0xbfc1(_0x3c5219,_0x46c19b);}const core_1=require(a181_0x586188(0x141)),typedi_1=__importDefault(require('typedi')),constants_1=require(a181_0x586188(0x154)),utils_1=require(a181_0x586188(0x15a)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require(a181_0x586188(0x139)),salesforce_composite_service_1=require(a181_0x586188(0x146));class SalesforceCommitsManager{constructor(_0xc1a8fd){const _0x57efc2=a181_0x586188;this[_0x57efc2(0x151)]=_0xc1a8fd,this[_0x57efc2(0x16f)]=0x3,this[_0x57efc2(0x13c)]=new core_1['Logger'](SalesforceCommitsManager['name']),this[_0x57efc2(0x167)]=this[_0x57efc2(0x151)][_0x57efc2(0x13c)],this['composite']=typedi_1[_0x57efc2(0x15c)][_0x57efc2(0x155)](salesforce_composite_service_1[_0x57efc2(0x166)]),this[_0x57efc2(0x165)]=[];}async[a181_0x586188(0x162)](_0x2ed806,_0x230eee=![]){const _0x36c8a9=a181_0x586188,_0x5f58f3=(this[_0x36c8a9(0x16f)]+ +_0x230eee)*0x3,_0x3e5bac=utils_1['chunkArray'](_0x2ed806,_0x5f58f3);try{while(_0x3e5bac[_0x36c8a9(0x15d)]){const _0x1e94a6=_0x3e5bac['splice'](0x0,Math[_0x36c8a9(0x163)](constants_1[_0x36c8a9(0x15f)]/_0x5f58f3));await this[_0x36c8a9(0x13c)]['log']('Sending\x20'+_0x1e94a6[_0x36c8a9(0x15d)]*_0x5f58f3+_0x36c8a9(0x160));const _0x5e682b=_0x1e94a6[_0x36c8a9(0x168)]((_0x1db100,_0x30d792)=>({'graphId':_0x36c8a9(0x14c)+_0x30d792,'compositeRequest':_0x1db100})),_0xe61c99=await this['composite'][_0x36c8a9(0x158)](_0x5e682b);if(_0x230eee){const _0x230371=composite_utils_1[_0x36c8a9(0x140)](_0xe61c99);for(const {id:_0x4413b0,ref:_0x47cc31}of _0x230371){const _0x219609=this[_0x36c8a9(0x165)][_0x36c8a9(0x13a)](_0x5b6efd=>_0x5b6efd[_0x36c8a9(0x13b)]===_0x47cc31);_0x219609&&(_0x219609[_0x36c8a9(0x171)]=_0x4413b0);}}}}catch(_0x5d3367){this['logger']['error'](_0x5d3367 instanceof salesforce_error_1[_0x36c8a9(0x152)]?JSON[_0x36c8a9(0x138)](_0x5d3367[_0x36c8a9(0x144)](),null,0x2):_0x5d3367),this[_0x36c8a9(0x167)][_0x36c8a9(0x16b)](_0x5d3367 instanceof salesforce_error_1[_0x36c8a9(0x152)]?JSON[_0x36c8a9(0x138)](_0x5d3367[_0x36c8a9(0x144)](),null,0x2):_0x5d3367[_0x36c8a9(0x137)]());throw _0x5d3367;}}async[a181_0x586188(0x136)](_0x307d95){const _0x32d5a0=a181_0x586188;for(const _0x28649e of _0x307d95){if(!_0x28649e['inserted']['length']&&!_0x28649e['modified'][_0x32d5a0(0x15d)]&&!_0x28649e[_0x32d5a0(0x148)][_0x32d5a0(0x15d)])continue;const _0xa147cb=[],_0x38d389=[],_0x175592=new salesforce_components_manager_service_1[(_0x32d5a0(0x142))](this['options']['repositoryId'],this['options']['branchId'],_0x28649e[_0x32d5a0(0x135)],this[_0x32d5a0(0x151)][_0x32d5a0(0x134)],this[_0x32d5a0(0x165)]);_0xa147cb['push'](...await _0x175592[_0x32d5a0(0x150)](_0x28649e[_0x32d5a0(0x147)],this[_0x32d5a0(0x151)][_0x32d5a0(0x15b)])),_0xa147cb[_0x32d5a0(0x16a)](...await _0x175592[_0x32d5a0(0x145)](_0x28649e[_0x32d5a0(0x169)],this[_0x32d5a0(0x151)]['commitId'])),_0x38d389['push'](await _0x175592[_0x32d5a0(0x132)](_0x28649e['removed'],!![])),this[_0x32d5a0(0x165)]=_0x175592['getProceededComponentsMeta'](),await this[_0x32d5a0(0x162)](_0xa147cb,!![]);for(const _0x3ed8e8 of _0x38d389){_0x3ed8e8[_0x32d5a0(0x157)]['length']&&await this[_0x32d5a0(0x162)](_0x3ed8e8['manifests'],!![]),_0x3ed8e8[_0x32d5a0(0x14e)][_0x32d5a0(0x15d)]&&await this[_0x32d5a0(0x162)](_0x3ed8e8[_0x32d5a0(0x14e)],!![]),_0x3ed8e8[_0x32d5a0(0x172)][_0x32d5a0(0x15d)]&&await this['proceedRequests'](_0x3ed8e8[_0x32d5a0(0x172)],!![]);}this[_0x32d5a0(0x13c)][_0x32d5a0(0x16b)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0xa147cb[_0x32d5a0(0x15d)]);}}async[a181_0x586188(0x156)](_0xc6eb9e){const _0x2bc84=a181_0x586188,_0x1ee9c9=[],_0xc844b8=[];for(const _0x3774a9 of _0xc6eb9e){if(!_0x3774a9[_0x2bc84(0x147)][_0x2bc84(0x15d)]&&!_0x3774a9[_0x2bc84(0x169)][_0x2bc84(0x15d)]&&!_0x3774a9[_0x2bc84(0x148)]['length'])continue;const _0x42cff2=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this['options'][_0x2bc84(0x15e)],this[_0x2bc84(0x151)][_0x2bc84(0x161)],_0x3774a9[_0x2bc84(0x135)],this['options'][_0x2bc84(0x134)],[]);_0x1ee9c9[_0x2bc84(0x16a)](...await _0x42cff2['insert'](_0x3774a9[_0x2bc84(0x147)])),_0x1ee9c9[_0x2bc84(0x16a)](...await _0x42cff2[_0x2bc84(0x145)](_0x3774a9['modified'])),_0xc844b8[_0x2bc84(0x16a)](await _0x42cff2[_0x2bc84(0x132)](_0x3774a9['removed']));}this[_0x2bc84(0x13c)]['log'](_0x2bc84(0x14d),_0x1ee9c9[_0x2bc84(0x15d)]),await this[_0x2bc84(0x162)](_0x1ee9c9);const _0x17a92b=_0xc844b8[_0x2bc84(0x143)]((_0x47fb16,_0x1c6532)=>({'manifests':[..._0x47fb16['manifests'],..._0x1c6532['manifests']],'componentsToDelete':[..._0x47fb16['componentsToDelete'],..._0x1c6532[_0x2bc84(0x172)]],'componentsToUpdate':[..._0x47fb16[_0x2bc84(0x14e)],..._0x1c6532[_0x2bc84(0x14e)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x17a92b[_0x2bc84(0x157)][_0x2bc84(0x15d)]&&await this[_0x2bc84(0x162)](_0x17a92b['manifests'],!![]),_0x17a92b[_0x2bc84(0x14e)][_0x2bc84(0x15d)]&&await this[_0x2bc84(0x162)](_0x17a92b[_0x2bc84(0x14e)],!![]),_0x17a92b['componentsToDelete'][_0x2bc84(0x15d)]&&await this['proceedRequests'](_0x17a92b[_0x2bc84(0x172)],!![]);}async['proceedCommits'](_0x56fddf){const _0x5d3adc=a181_0x586188;this[_0x5d3adc(0x151)]['branchId']?await this[_0x5d3adc(0x156)](_0x56fddf):await this[_0x5d3adc(0x136)](_0x56fddf);}}exports[a181_0x586188(0x170)]=SalesforceCommitsManager;