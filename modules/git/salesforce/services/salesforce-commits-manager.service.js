const a227_0x5d399a=a227_0x2945;(function(_0x2a9e6b,_0x37f11d){const _0x35c8fe=a227_0x2945,_0x274333=_0x2a9e6b();while(!![]){try{const _0xfd6429=-parseInt(_0x35c8fe(0xe6))/0x1*(parseInt(_0x35c8fe(0xdc))/0x2)+parseInt(_0x35c8fe(0xbd))/0x3*(-parseInt(_0x35c8fe(0xaa))/0x4)+parseInt(_0x35c8fe(0x9f))/0x5*(parseInt(_0x35c8fe(0xa8))/0x6)+-parseInt(_0x35c8fe(0xc7))/0x7*(-parseInt(_0x35c8fe(0xd0))/0x8)+parseInt(_0x35c8fe(0xe3))/0x9*(-parseInt(_0x35c8fe(0xaf))/0xa)+parseInt(_0x35c8fe(0xa3))/0xb+-parseInt(_0x35c8fe(0xd8))/0xc*(-parseInt(_0x35c8fe(0xc6))/0xd);if(_0xfd6429===_0x37f11d)break;else _0x274333['push'](_0x274333['shift']());}catch(_0x3a86ed){_0x274333['push'](_0x274333['shift']());}}}(a227_0x422f,0xe234f));const a227_0x2ff6f3=(function(){let _0x4839da=!![];return function(_0xf6e6,_0x266750){const _0x309c5b=_0x4839da?function(){const _0x3be392=a227_0x2945;if(_0x266750){const _0xd55361=_0x266750[_0x3be392(0xa7)](_0xf6e6,arguments);return _0x266750=null,_0xd55361;}}:function(){};return _0x4839da=![],_0x309c5b;};}()),a227_0x389d1=a227_0x2ff6f3(this,function(){const _0x4303d1=a227_0x2945;return a227_0x389d1[_0x4303d1(0xa9)]()[_0x4303d1(0xa5)](_0x4303d1(0xcf))[_0x4303d1(0xa9)]()[_0x4303d1(0xe8)](a227_0x389d1)[_0x4303d1(0xa5)]('(((.+)+)+)+$');});a227_0x389d1();'use strict';function a227_0x422f(){const _0x48d396=['../utils/composite.utils','787220fHZIYF','commitId','SALESFORCE_MAX_REQUEST_SIZE_BYTES','toJSON','componentsToUpdate','Sending\x20','push','modified','logger','manifests','inserted','defineProperty','__esModule','proceededComponentsMeta','5604ccVWvi','removed','__importDefault','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','update','\x20COMPONENTS_SIZE\x20=\x20','proceedCommitsToBranch','SalesforceError','reduce','1036516iKyYUZ','7hoxQnL','find','\x20requests\x20to\x20composite\x20api.','proceedRequests','executeGraphs','sfLogger','COMPONENTS_PER_CHUNK','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','(((.+)+)+)+$','6446536LkNVrq','SalesforceCommitsManager','delete','componentsToDelete','Cannot\x20upload\x20components\x20due\x20to\x20size\x20-\x20MAX_SIZE\x20=\x20','insert','SalesforceComponentsManager','floor','12accoyY','options','../../../shared/utils','map','4onIAkD','log','extractComponentIdsFromGraphsResponse','typedi','../../../../constants','author','name','9PadmDq','stringify','proceedChunksToUpload','540815IdVvZa','../errors/salesforce.error','constructor','graph','length','1580EbRuTA','chunkArray','getProceededComponentsMeta','recordTypes','17461114PTdKeE','repositoryId','search','SalesforceCompositeService','apply','7638ThGdwE','toString','1688LcCsAb','branchId','error','../../../../core'];a227_0x422f=function(){return _0x48d396;};return a227_0x422f();}var __importDefault=this&&this[a227_0x5d399a(0xbf)]||function(_0x28d1e3){const _0x5d4134=a227_0x5d399a;return _0x28d1e3&&_0x28d1e3[_0x5d4134(0xbb)]?_0x28d1e3:{'default':_0x28d1e3};};Object[a227_0x5d399a(0xba)](exports,a227_0x5d399a(0xbb),{'value':!![]}),exports[a227_0x5d399a(0xd1)]=void 0x0;const core_1=require(a227_0x5d399a(0xad)),typedi_1=__importDefault(require(a227_0x5d399a(0xdf))),constants_1=require(a227_0x5d399a(0xe0)),utils_1=require(a227_0x5d399a(0xda)),salesforce_error_1=require(a227_0x5d399a(0xe7)),composite_utils_1=require(a227_0x5d399a(0xae)),salesforce_components_manager_service_1=require('./salesforce-components-manager.service'),salesforce_composite_service_1=require('./salesforce-composite.service');function a227_0x2945(_0x3a2ab3,_0x384f6f){const _0x185a73=a227_0x422f();return a227_0x2945=function(_0x389d1,_0x2ff6f3){_0x389d1=_0x389d1-0x9e;let _0x422ffc=_0x185a73[_0x389d1];return _0x422ffc;},a227_0x2945(_0x3a2ab3,_0x384f6f);}class SalesforceCommitsManager{constructor(_0x1b4445){const _0x209a96=a227_0x5d399a;this[_0x209a96(0xd9)]=_0x1b4445,this[_0x209a96(0xcd)]=0x3,this[_0x209a96(0xb7)]=new core_1['Logger'](SalesforceCommitsManager[_0x209a96(0xe2)]),this[_0x209a96(0xcc)]=this[_0x209a96(0xd9)][_0x209a96(0xb7)],this['composite']=typedi_1['default']['get'](salesforce_composite_service_1[_0x209a96(0xa6)]),this[_0x209a96(0xbc)]=[];}async[a227_0x5d399a(0xe5)](_0x3d138d,_0x39bf55=![]){const _0x485b0c=a227_0x5d399a,_0x2e7b4c=async _0x3f2b29=>{const _0x20b458=a227_0x2945;await this['logger'][_0x20b458(0xdd)](_0x20b458(0xb4)+_0x3f2b29['reduce']((_0x350d71,_0x54ad44)=>_0x350d71+_0x54ad44[_0x20b458(0x9e)],0x0)+_0x20b458(0xc9));const _0xb5fba9=_0x3f2b29[_0x20b458(0xdb)]((_0x42a488,_0x509962)=>({'graphId':_0x20b458(0xe9)+_0x509962,'compositeRequest':_0x42a488})),_0x143841=await this['composite'][_0x20b458(0xcb)](_0xb5fba9);if(_0x39bf55){const _0x3f1cae=(0x0,composite_utils_1[_0x20b458(0xde)])(_0x143841);for(const {id:_0x7ae228,ref:_0xa2c6da}of _0x3f1cae){const _0x55cb99=this[_0x20b458(0xbc)][_0x20b458(0xc8)](_0x43936a=>_0x43936a['reference']===_0xa2c6da);_0x55cb99&&(_0x55cb99['componentId']=_0x7ae228);}}},_0x50e4b4=0x1e8480;let _0x27663d=0x0,_0x1026c4=[];for(const _0x56929b of _0x3d138d){const _0x3b79e5=_0x56929b[_0x485b0c(0xc5)]((_0x9899f8,_0x585833)=>{const _0x4f5c1e=_0x485b0c,_0x25bfe7=JSON[_0x4f5c1e(0xe4)](_0x585833)[_0x4f5c1e(0x9e)]*0x2;return _0x9899f8+_0x25bfe7;},0x0);if(_0x3b79e5>constants_1[_0x485b0c(0xb1)])throw new salesforce_error_1[(_0x485b0c(0xc4))](_0x485b0c(0xd4)+constants_1[_0x485b0c(0xb1)]+_0x485b0c(0xc2)+_0x3b79e5);_0x27663d+_0x3b79e5>constants_1[_0x485b0c(0xb1)]-_0x50e4b4&&(await _0x2e7b4c(_0x1026c4),_0x1026c4=[],_0x27663d=0x0),_0x27663d+=_0x3b79e5,_0x1026c4[_0x485b0c(0xb5)](_0x56929b);}_0x1026c4[_0x485b0c(0x9e)]&&await _0x2e7b4c(_0x1026c4);}async[a227_0x5d399a(0xca)](_0x8995e3,_0x37f8db=![]){const _0x5c53e4=a227_0x5d399a,_0x3d8f7b=(this[_0x5c53e4(0xcd)]+ +_0x37f8db)*0x3,_0x4838e0=(0x0,utils_1[_0x5c53e4(0xa0)])(_0x8995e3,_0x3d8f7b);try{while(_0x4838e0[_0x5c53e4(0x9e)]){const _0x215a8d=_0x4838e0['splice'](0x0,Math[_0x5c53e4(0xd7)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x3d8f7b));await this[_0x5c53e4(0xe5)](_0x215a8d,_0x37f8db);}}catch(_0x5f499e){this[_0x5c53e4(0xb7)][_0x5c53e4(0xac)](_0x5f499e instanceof salesforce_error_1['SalesforceError']?JSON[_0x5c53e4(0xe4)](_0x5f499e['toJSON'](),null,0x2):_0x5f499e),this['sfLogger'][_0x5c53e4(0xdd)](_0x5f499e instanceof salesforce_error_1[_0x5c53e4(0xc4)]?JSON['stringify'](_0x5f499e[_0x5c53e4(0xb2)](),null,0x2):_0x5f499e[_0x5c53e4(0xa9)]());throw _0x5f499e;}}async['proceedCommitsToRepository'](_0x460984){const _0x4b1d3e=a227_0x5d399a;for(const _0x1098ea of _0x460984){if(!_0x1098ea['inserted'][_0x4b1d3e(0x9e)]&&!_0x1098ea[_0x4b1d3e(0xb6)][_0x4b1d3e(0x9e)]&&!_0x1098ea[_0x4b1d3e(0xbe)][_0x4b1d3e(0x9e)])continue;const _0x2e373c=[],_0x1ab2dd=[],_0x51dce0=new salesforce_components_manager_service_1[(_0x4b1d3e(0xd6))](this[_0x4b1d3e(0xd9)][_0x4b1d3e(0xa4)],this[_0x4b1d3e(0xd9)][_0x4b1d3e(0xab)],_0x1098ea[_0x4b1d3e(0xe1)],this[_0x4b1d3e(0xd9)][_0x4b1d3e(0xa2)],this[_0x4b1d3e(0xbc)]);_0x2e373c[_0x4b1d3e(0xb5)](...await _0x51dce0[_0x4b1d3e(0xd5)](_0x1098ea[_0x4b1d3e(0xb9)],this[_0x4b1d3e(0xd9)][_0x4b1d3e(0xb0)])),_0x2e373c[_0x4b1d3e(0xb5)](...await _0x51dce0[_0x4b1d3e(0xc1)](_0x1098ea[_0x4b1d3e(0xb6)],this[_0x4b1d3e(0xd9)][_0x4b1d3e(0xb0)])),_0x1ab2dd[_0x4b1d3e(0xb5)](await _0x51dce0[_0x4b1d3e(0xd2)](_0x1098ea['removed'],!![])),this['proceededComponentsMeta']=_0x51dce0[_0x4b1d3e(0xa1)](),await this[_0x4b1d3e(0xca)](_0x2e373c,!![]);for(const _0x54c135 of _0x1ab2dd){_0x54c135[_0x4b1d3e(0xb8)]['length']&&await this[_0x4b1d3e(0xca)](_0x54c135[_0x4b1d3e(0xb8)],!![]),_0x54c135[_0x4b1d3e(0xb3)][_0x4b1d3e(0x9e)]&&await this[_0x4b1d3e(0xca)](_0x54c135['componentsToUpdate'],!![]),_0x54c135[_0x4b1d3e(0xd3)][_0x4b1d3e(0x9e)]&&await this[_0x4b1d3e(0xca)](_0x54c135[_0x4b1d3e(0xd3)],!![]);}this['logger'][_0x4b1d3e(0xdd)](_0x4b1d3e(0xc0),_0x2e373c['length']);}}async['proceedCommitsToBranch'](_0x45cf96){const _0x13263a=a227_0x5d399a,_0x64f8f2=[],_0x29fa52=[];for(const _0x2d6df4 of _0x45cf96){if(!_0x2d6df4[_0x13263a(0xb9)][_0x13263a(0x9e)]&&!_0x2d6df4[_0x13263a(0xb6)][_0x13263a(0x9e)]&&!_0x2d6df4[_0x13263a(0xbe)][_0x13263a(0x9e)])continue;const _0x4248bd=new salesforce_components_manager_service_1[(_0x13263a(0xd6))](this[_0x13263a(0xd9)][_0x13263a(0xa4)],this[_0x13263a(0xd9)]['branchId'],_0x2d6df4[_0x13263a(0xe1)],this['options'][_0x13263a(0xa2)],[]);_0x64f8f2[_0x13263a(0xb5)](...await _0x4248bd['insert'](_0x2d6df4[_0x13263a(0xb9)])),_0x64f8f2['push'](...await _0x4248bd[_0x13263a(0xc1)](_0x2d6df4[_0x13263a(0xb6)])),_0x29fa52[_0x13263a(0xb5)](await _0x4248bd[_0x13263a(0xd2)](_0x2d6df4[_0x13263a(0xbe)]));}this['logger'][_0x13263a(0xdd)](_0x13263a(0xce),_0x64f8f2[_0x13263a(0x9e)]),await this[_0x13263a(0xca)](_0x64f8f2);const _0xe672ed=_0x29fa52['reduce']((_0x2fe20a,_0x259bb9)=>({'manifests':[..._0x2fe20a[_0x13263a(0xb8)],..._0x259bb9[_0x13263a(0xb8)]],'componentsToDelete':[..._0x2fe20a[_0x13263a(0xd3)],..._0x259bb9['componentsToDelete']],'componentsToUpdate':[..._0x2fe20a['componentsToUpdate'],..._0x259bb9[_0x13263a(0xb3)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0xe672ed[_0x13263a(0xb8)][_0x13263a(0x9e)]&&await this[_0x13263a(0xca)](_0xe672ed['manifests'],!![]),_0xe672ed[_0x13263a(0xb3)][_0x13263a(0x9e)]&&await this[_0x13263a(0xca)](_0xe672ed['componentsToUpdate'],!![]),_0xe672ed[_0x13263a(0xd3)][_0x13263a(0x9e)]&&await this[_0x13263a(0xca)](_0xe672ed[_0x13263a(0xd3)],!![]);}async['proceedCommits'](_0x5bfb90){const _0x25c244=a227_0x5d399a;this[_0x25c244(0xd9)][_0x25c244(0xab)]?await this[_0x25c244(0xc3)](_0x5bfb90):await this['proceedCommitsToRepository'](_0x5bfb90);}}exports[a227_0x5d399a(0xd1)]=SalesforceCommitsManager;