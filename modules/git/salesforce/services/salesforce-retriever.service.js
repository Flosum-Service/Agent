const a242_0x580dab=a242_0x2216;(function(_0x55a6a4,_0x1fd283){const _0x158683=a242_0x2216,_0x2063dd=_0x55a6a4();while(!![]){try{const _0x34de33=-parseInt(_0x158683(0x1a5))/0x1*(-parseInt(_0x158683(0x1b1))/0x2)+-parseInt(_0x158683(0x1c4))/0x3+parseInt(_0x158683(0x1a7))/0x4+parseInt(_0x158683(0x1c1))/0x5*(-parseInt(_0x158683(0x1ce))/0x6)+-parseInt(_0x158683(0x1c2))/0x7*(parseInt(_0x158683(0x1a3))/0x8)+-parseInt(_0x158683(0x1b5))/0x9+parseInt(_0x158683(0x19f))/0xa*(parseInt(_0x158683(0x1a6))/0xb);if(_0x34de33===_0x1fd283)break;else _0x2063dd['push'](_0x2063dd['shift']());}catch(_0x1e758a){_0x2063dd['push'](_0x2063dd['shift']());}}}(a242_0x1d38,0xe4c98));const a242_0x2c857e=(function(){let _0x141792=!![];return function(_0x324fc5,_0x4a0d9b){const _0xcc9306=_0x141792?function(){const _0x4235d9=a242_0x2216;if(_0x4a0d9b){const _0x145fc2=_0x4a0d9b[_0x4235d9(0x1a4)](_0x324fc5,arguments);return _0x4a0d9b=null,_0x145fc2;}}:function(){};return _0x141792=![],_0xcc9306;};}()),a242_0xf64dd5=a242_0x2c857e(this,function(){const _0x455fe6=a242_0x2216;return a242_0xf64dd5[_0x455fe6(0x1c5)]()[_0x455fe6(0x1ae)](_0x455fe6(0x1d1))['toString']()[_0x455fe6(0x1c0)](a242_0xf64dd5)[_0x455fe6(0x1ae)](_0x455fe6(0x1d1));});a242_0xf64dd5();'use strict';var __importDefault=this&&this[a242_0x580dab(0x1a1)]||function(_0x45df0d){const _0x3d4675=a242_0x580dab;return _0x45df0d&&_0x45df0d[_0x3d4675(0x1c7)]?_0x45df0d:{'default':_0x45df0d};};function a242_0x2216(_0x15d6f5,_0x583495){const _0x8c0e89=a242_0x1d38();return a242_0x2216=function(_0xf64dd5,_0x2c857e){_0xf64dd5=_0xf64dd5-0x19b;let _0x1d3833=_0x8c0e89[_0xf64dd5];return _0x1d3833;},a242_0x2216(_0x15d6f5,_0x583495);}function a242_0x1d38(){const _0x2cc91c=['manually\x20retrieving\x20components\x20from\x20salesforce','retrieveAttachment','info','push','typedi','retrieveLastComponents','search','Name','./salesforce-query.service','12RBVnWE','filename','GET_COMPONENT_HISTORIES_BY_IDS','../queries','14107770jJEJvf','query','SalesforceQueryService','splice','logger','run','SalesforceRetrieverService','Logger','manually\x20retrieved\x20%d/%d\x20components','%ids%','../dto/flosum-component-history.dto','constructor','25MSdWWM','53949MbKRXL','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','4456347MgZSDy','toString','COMPONENTS_PER_QUERY','__esModule','then','retrieveComponents','ids','replace','get','components','2047686zYiYoj','fileName','fileType','(((.+)+)+)+$','%parent_ids%','all','length','defineProperty','salesforceService','retrieveComponentIdsFromHistoryIds','170BdrpuU','join','__importDefault','fromSalesforce','776trzuOz','apply','44051mqPrDt','3685891ALAMOR','1933568eJkxaM'];a242_0x1d38=function(){return _0x2cc91c;};return a242_0x1d38();}Object[a242_0x580dab(0x19c)](exports,a242_0x580dab(0x1c7),{'value':!![]}),exports[a242_0x580dab(0x1bb)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require(a242_0x580dab(0x1ac))),salesforce_query_service_1=require(a242_0x580dab(0x1b0)),queries_1=require(a242_0x580dab(0x1b4)),flosum_component_history_dto_1=require(a242_0x580dab(0x1bf));class SalesforceRetrieverService{constructor(_0x1c33c4){const _0x26a8a8=a242_0x580dab;this[_0x26a8a8(0x19d)]=_0x1c33c4,this[_0x26a8a8(0x1b9)]=new core_1[(_0x26a8a8(0x1bc))](SalesforceRetrieverService['name']),this['COMPONENTS_PER_REQUEST']=0xbb8,this[_0x26a8a8(0x1c6)]=0x1f4;}async[a242_0x580dab(0x19e)](_0x558776){const _0x43d435=a242_0x580dab;this['logger']['info'](_0x43d435(0x1c3),_0x558776['length']);const _0x520dd5=typedi_1['default'][_0x43d435(0x1cc)](salesforce_query_service_1[_0x43d435(0x1b7)]),_0x29ecaa=_0x558776['map'](_0x1f1b0c=>'\x27'+_0x1f1b0c+'\x27'),_0x257c35=[];while(_0x29ecaa[_0x43d435(0x19b)]){const _0x1d29e9=_0x29ecaa[_0x43d435(0x1b8)](0x0,this[_0x43d435(0x1c6)]),_0x249c87=_0x520dd5['query'](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x43d435(0x1cb)](_0x43d435(0x1d2),_0x1d29e9['join']())),_0x112610=_0x520dd5[_0x43d435(0x1b6)](queries_1[_0x43d435(0x1b3)][_0x43d435(0x1cb)](_0x43d435(0x1be),_0x1d29e9[_0x43d435(0x1a0)]()))[_0x43d435(0x1c8)](_0x14fc8a=>_0x14fc8a['map'](_0x516887=>flosum_component_history_dto_1['FlosumComponentHistoryDto'][_0x43d435(0x1a2)](_0x516887))),[_0x5dc6c9,_0x3cd906]=await Promise[_0x43d435(0x1d3)]([_0x249c87,_0x112610]);for(const _0x5523f5 of _0x3cd906){const _0x48095f=_0x5dc6c9['find'](_0x592713=>_0x592713['ParentId']===_0x5523f5['id']);_0x48095f&&_0x257c35[_0x43d435(0x1ab)]({'fileType':_0x48095f[_0x43d435(0x1af)],'fileName':_0x5523f5[_0x43d435(0x1b2)],'attachmentId':_0x48095f['Id']});}}return _0x257c35;}async[a242_0x580dab(0x1ad)](_0x3ad86c){const _0x215f74=a242_0x580dab,_0x30d161=await this[_0x215f74(0x19e)](_0x3ad86c);this[_0x215f74(0x1b9)][_0x215f74(0x1aa)](_0x215f74(0x1a8));const _0x35416e=[];for(const _0x28ac75 of _0x30d161){const _0x18a84d=await this[_0x215f74(0x19d)][_0x215f74(0x1a9)](_0x28ac75['attachmentId'],!![]);_0x35416e[_0x215f74(0x1ab)]({'body':_0x18a84d['toString']('base64'),'fileName':_0x28ac75[_0x215f74(0x1cf)],'fileType':_0x28ac75[_0x215f74(0x1d0)]}),this[_0x215f74(0x1b9)][_0x215f74(0x1aa)](_0x215f74(0x1bd),_0x35416e[_0x215f74(0x19b)],_0x3ad86c[_0x215f74(0x19b)]);}return _0x35416e;}async[a242_0x580dab(0x1ba)](_0x51cd81){const _0x2106f9=a242_0x580dab,_0x5a9e3a=[..._0x51cd81],_0x13bb88=[],_0x2dc5c1=[];while(_0x5a9e3a[_0x2106f9(0x19b)]){const _0x231967=_0x5a9e3a[_0x2106f9(0x1b8)](0x0,this['COMPONENTS_PER_REQUEST']),_0x256c16=await this[_0x2106f9(0x19d)][_0x2106f9(0x1c9)](_0x231967);_0x231967[_0x2106f9(0x19b)]!==_0x256c16[_0x2106f9(0x1ca)][_0x2106f9(0x19b)]?(_0x5a9e3a[_0x2106f9(0x1ab)](..._0x256c16['ids']),_0x13bb88[_0x2106f9(0x1ab)](..._0x256c16[_0x2106f9(0x1cd)])):_0x2dc5c1[_0x2106f9(0x1ab)](..._0x231967),this[_0x2106f9(0x1b9)]['log']('retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest',_0x51cd81[_0x2106f9(0x19b)]-_0x5a9e3a[_0x2106f9(0x19b)],_0x51cd81[_0x2106f9(0x19b)]);}if(_0x2dc5c1[_0x2106f9(0x19b)]){const _0x442d21=await this['retrieveLastComponents'](_0x2dc5c1);_0x13bb88[_0x2106f9(0x1ab)](..._0x442d21);}return _0x13bb88;}}exports[a242_0x580dab(0x1bb)]=SalesforceRetrieverService;