const a279_0x27953b=a279_0x312e;(function(_0x235118,_0x1188dc){const _0xeacf22=a279_0x312e,_0x1476ea=_0x235118();while(!![]){try{const _0x3fab3a=-parseInt(_0xeacf22(0xfd))/0x1*(parseInt(_0xeacf22(0x105))/0x2)+parseInt(_0xeacf22(0x10c))/0x3+-parseInt(_0xeacf22(0xf4))/0x4*(parseInt(_0xeacf22(0xf2))/0x5)+-parseInt(_0xeacf22(0xfe))/0x6+parseInt(_0xeacf22(0x10f))/0x7*(parseInt(_0xeacf22(0x11c))/0x8)+-parseInt(_0xeacf22(0x106))/0x9+parseInt(_0xeacf22(0x118))/0xa;if(_0x3fab3a===_0x1188dc)break;else _0x1476ea['push'](_0x1476ea['shift']());}catch(_0x2167c4){_0x1476ea['push'](_0x1476ea['shift']());}}}(a279_0x575e,0x2ad8d));function a279_0x575e(){const _0x3c1559=['typedi','toString','3013260SzrgWI','salesforceService','../dto/flosum-component-history.dto','SalesforceQueryService','16ZnOxLH','Logger','COMPONENTS_PER_REQUEST','map','SalesforceRetrieverService','replace','__esModule','%parent_ids%','fileName','Manually\x20retrieved\x20%d/%d\x20components','search','%ids%','85XDUIwR','base64','25292TGNrZI','length','name','find','../../../../core','splice','join','apply','retrieveAttachment','1uZJmiS','736902bxVmUB','GET_COMPONENT_HISTORIES_BY_IDS','all','FlosumComponentHistoryDto','retrieveLastComponents','run','info','413682CulAAw','664974cZbpSA','COMPONENTS_PER_QUERY','filename','Manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','Name','push','251304IvFiyE','logger','get','1055047FIwoqe','__importDefault','query','then','../queries','fromSalesforce','(((.+)+)+)+$'];a279_0x575e=function(){return _0x3c1559;};return a279_0x575e();}const a279_0x1831c7=(function(){let _0x233bdf=!![];return function(_0x5bffbb,_0x18ce15){const _0x7173ab=_0x233bdf?function(){const _0x49ba84=a279_0x312e;if(_0x18ce15){const _0x319a60=_0x18ce15[_0x49ba84(0xfb)](_0x5bffbb,arguments);return _0x18ce15=null,_0x319a60;}}:function(){};return _0x233bdf=![],_0x7173ab;};}()),a279_0x1a8e48=a279_0x1831c7(this,function(){const _0x320f5=a279_0x312e;return a279_0x1a8e48[_0x320f5(0x117)]()['search'](_0x320f5(0x115))[_0x320f5(0x117)]()['constructor'](a279_0x1a8e48)[_0x320f5(0xf0)](_0x320f5(0x115));});a279_0x1a8e48();'use strict';var __importDefault=this&&this[a279_0x27953b(0x110)]||function(_0x5d1ae8){const _0x3fe3bd=a279_0x27953b;return _0x5d1ae8&&_0x5d1ae8[_0x3fe3bd(0xec)]?_0x5d1ae8:{'default':_0x5d1ae8};};function a279_0x312e(_0x384219,_0x1d6a1a){const _0x5957dd=a279_0x575e();return a279_0x312e=function(_0x1a8e48,_0x1831c7){_0x1a8e48=_0x1a8e48-0xea;let _0x575e7e=_0x5957dd[_0x1a8e48];return _0x575e7e;},a279_0x312e(_0x384219,_0x1d6a1a);}Object['defineProperty'](exports,a279_0x27953b(0xec),{'value':!![]}),exports[a279_0x27953b(0xea)]=void 0x0;const core_1=require(a279_0x27953b(0xf8)),typedi_1=__importDefault(require(a279_0x27953b(0x116))),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a279_0x27953b(0x113)),flosum_component_history_dto_1=require(a279_0x27953b(0x11a));class SalesforceRetrieverService{constructor(_0x375ddd){const _0x1ec196=a279_0x27953b;this[_0x1ec196(0x119)]=_0x375ddd,this[_0x1ec196(0x10d)]=new core_1[(_0x1ec196(0x11d))](SalesforceRetrieverService[_0x1ec196(0xf6)]),this[_0x1ec196(0x11e)]=0xbb8,this[_0x1ec196(0x107)]=0x1f4;}async['retrieveComponentIdsFromHistoryIds'](_0x2fa307){const _0x1889d2=a279_0x27953b;this[_0x1889d2(0x10d)]['info'](_0x1889d2(0x109),_0x2fa307[_0x1889d2(0xf5)]);const _0x29ef75=typedi_1['default'][_0x1889d2(0x10e)](salesforce_query_service_1[_0x1889d2(0x11b)]),_0x402814=_0x2fa307[_0x1889d2(0x11f)](_0x2fc8b7=>'\x27'+_0x2fc8b7+'\x27'),_0x1241cd=[];while(_0x402814[_0x1889d2(0xf5)]){const _0x4400ee=_0x402814[_0x1889d2(0xf9)](0x0,this[_0x1889d2(0x107)]),_0x5a07c1=_0x29ef75[_0x1889d2(0x111)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x1889d2(0xeb)](_0x1889d2(0xed),_0x4400ee[_0x1889d2(0xfa)]())),_0x532dbc=_0x29ef75[_0x1889d2(0x111)](queries_1[_0x1889d2(0xff)][_0x1889d2(0xeb)](_0x1889d2(0xf1),_0x4400ee[_0x1889d2(0xfa)]()))[_0x1889d2(0x112)](_0x4e70f8=>_0x4e70f8['map'](_0xa3e0eb=>flosum_component_history_dto_1[_0x1889d2(0x101)][_0x1889d2(0x114)](_0xa3e0eb))),[_0x2e0f64,_0x5dd8cc]=await Promise[_0x1889d2(0x100)]([_0x5a07c1,_0x532dbc]);for(const _0x4cdf0f of _0x5dd8cc){const _0x5f9f2a=_0x2e0f64[_0x1889d2(0xf7)](_0x16008c=>_0x16008c['ParentId']===_0x4cdf0f['id']);_0x5f9f2a&&_0x1241cd[_0x1889d2(0x10b)]({'fileType':_0x5f9f2a[_0x1889d2(0x10a)],'fileName':_0x4cdf0f[_0x1889d2(0x108)],'attachmentId':_0x5f9f2a['Id']});}}return _0x1241cd;}async[a279_0x27953b(0x102)](_0x11b657){const _0x2b3ce2=a279_0x27953b,_0x4cf6ce=await this['retrieveComponentIdsFromHistoryIds'](_0x11b657);this[_0x2b3ce2(0x10d)][_0x2b3ce2(0x104)]('Manually\x20retrieving\x20components\x20from\x20salesforce');const _0xb16aba=[];for(const _0x5a0546 of _0x4cf6ce){const _0x1efdcd=await this[_0x2b3ce2(0x119)][_0x2b3ce2(0xfc)](_0x5a0546['attachmentId'],!![]);_0xb16aba[_0x2b3ce2(0x10b)]({'body':_0x1efdcd[_0x2b3ce2(0x117)](_0x2b3ce2(0xf3)),'fileName':_0x5a0546[_0x2b3ce2(0xee)],'fileType':_0x5a0546['fileType']}),this[_0x2b3ce2(0x10d)][_0x2b3ce2(0x104)](_0x2b3ce2(0xef),_0xb16aba[_0x2b3ce2(0xf5)],_0x11b657[_0x2b3ce2(0xf5)]);}return _0xb16aba;}async[a279_0x27953b(0x103)](_0x5e535c){const _0x4e90bf=a279_0x27953b;if(!_0x5e535c[_0x4e90bf(0xf5)])return[];const _0x2c3614=await this[_0x4e90bf(0x119)]['retrieveComponents'](_0x5e535c);return _0x2c3614;}}exports[a279_0x27953b(0xea)]=SalesforceRetrieverService;