const a236_0x31a926=a236_0x1cc7;(function(_0x565fc7,_0x453f0f){const _0x3bddaf=a236_0x1cc7,_0x2723f6=_0x565fc7();while(!![]){try{const _0x39c809=-parseInt(_0x3bddaf(0x9c))/0x1*(-parseInt(_0x3bddaf(0x9f))/0x2)+-parseInt(_0x3bddaf(0xb6))/0x3+parseInt(_0x3bddaf(0xc1))/0x4*(-parseInt(_0x3bddaf(0x99))/0x5)+parseInt(_0x3bddaf(0xb8))/0x6+-parseInt(_0x3bddaf(0xbe))/0x7*(-parseInt(_0x3bddaf(0x9e))/0x8)+-parseInt(_0x3bddaf(0xbf))/0x9+-parseInt(_0x3bddaf(0xc8))/0xa*(-parseInt(_0x3bddaf(0xa6))/0xb);if(_0x39c809===_0x453f0f)break;else _0x2723f6['push'](_0x2723f6['shift']());}catch(_0x4066c6){_0x2723f6['push'](_0x2723f6['shift']());}}}(a236_0x3d01,0xab941));const a236_0x12d9e1=(function(){let _0x203a34=!![];return function(_0x4c4d58,_0x493d56){const _0x3364c5=_0x203a34?function(){const _0x421860=a236_0x1cc7;if(_0x493d56){const _0x516410=_0x493d56[_0x421860(0x98)](_0x4c4d58,arguments);return _0x493d56=null,_0x516410;}}:function(){};return _0x203a34=![],_0x3364c5;};}()),a236_0x59bebf=a236_0x12d9e1(this,function(){const _0xe8c610=a236_0x1cc7;return a236_0x59bebf[_0xe8c610(0xaf)]()['search'](_0xe8c610(0xb0))[_0xe8c610(0xaf)]()['constructor'](a236_0x59bebf)['search']('(((.+)+)+)+$');});a236_0x59bebf();'use strict';var __importDefault=this&&this[a236_0x31a926(0xca)]||function(_0x362bd7){return _0x362bd7&&_0x362bd7['__esModule']?_0x362bd7:{'default':_0x362bd7};};Object['defineProperty'](exports,a236_0x31a926(0xab),{'value':!![]}),exports[a236_0x31a926(0xc4)]=void 0x0;const core_1=require(a236_0x31a926(0xb2)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a236_0x31a926(0xc3)),flosum_component_history_dto_1=require(a236_0x31a926(0xbd));function a236_0x1cc7(_0x386f2e,_0x45f881){const _0x463cf8=a236_0x3d01();return a236_0x1cc7=function(_0x59bebf,_0x12d9e1){_0x59bebf=_0x59bebf-0x98;let _0x3d01a7=_0x463cf8[_0x59bebf];return _0x3d01a7;},a236_0x1cc7(_0x386f2e,_0x45f881);}class SalesforceRetrieverService{constructor(_0x5a8729){const _0x58944d=a236_0x31a926;this[_0x58944d(0xbb)]=_0x5a8729,this['logger']=new core_1['Logger'](SalesforceRetrieverService['name']),this['COMPONENTS_PER_REQUEST']=0xbb8,this[_0x58944d(0xc5)]=0x1f4;}async['retrieveComponentIdsFromHistoryIds'](_0x441aac){const _0x1f4f36=a236_0x31a926;this[_0x1f4f36(0xb3)][_0x1f4f36(0xa9)]('manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x441aac[_0x1f4f36(0xae)]);const _0x3ab46f=typedi_1[_0x1f4f36(0xad)][_0x1f4f36(0xc7)](salesforce_query_service_1[_0x1f4f36(0xa5)]),_0x3c7220=_0x441aac[_0x1f4f36(0xa4)](_0x58e546=>'\x27'+_0x58e546+'\x27'),_0x3294a7=[];while(_0x3c7220[_0x1f4f36(0xae)]){const _0x47abc4=_0x3c7220[_0x1f4f36(0xb9)](0x0,this['COMPONENTS_PER_QUERY']),_0x436895=_0x3ab46f['query'](queries_1[_0x1f4f36(0xc6)][_0x1f4f36(0xa1)](_0x1f4f36(0x9d),_0x47abc4[_0x1f4f36(0xcc)]())),_0x2caf82=_0x3ab46f['query'](queries_1[_0x1f4f36(0xa7)]['replace'](_0x1f4f36(0xc9),_0x47abc4[_0x1f4f36(0xcc)]()))[_0x1f4f36(0x9b)](_0x37be95=>_0x37be95['map'](_0x57bc27=>flosum_component_history_dto_1[_0x1f4f36(0xa8)][_0x1f4f36(0xa0)](_0x57bc27))),[_0x3390df,_0x1d7af0]=await Promise[_0x1f4f36(0xb5)]([_0x436895,_0x2caf82]);for(const _0x3a9dab of _0x1d7af0){const _0x16c660=_0x3390df['find'](_0x568249=>_0x568249[_0x1f4f36(0xa2)]===_0x3a9dab['id']);_0x16c660&&_0x3294a7[_0x1f4f36(0x9a)]({'fileType':_0x16c660[_0x1f4f36(0xac)],'fileName':_0x3a9dab[_0x1f4f36(0xb1)],'attachmentId':_0x16c660['Id']});}}return _0x3294a7;}async[a236_0x31a926(0xc0)](_0x3bc9e6){const _0x4bd311=a236_0x31a926,_0x3f2632=await this['retrieveComponentIdsFromHistoryIds'](_0x3bc9e6);this[_0x4bd311(0xb3)][_0x4bd311(0xa9)](_0x4bd311(0xa3));const _0x5a2d10=[];for(const _0x211192 of _0x3f2632){const _0x4d9a34=await this[_0x4bd311(0xbb)]['retrieveAttachment'](_0x211192[_0x4bd311(0xbc)],!![]);_0x5a2d10['push']({'body':_0x4d9a34[_0x4bd311(0xaf)]('base64'),'fileName':_0x211192['fileName'],'fileType':_0x211192[_0x4bd311(0xb7)]}),this[_0x4bd311(0xb3)]['info'](_0x4bd311(0xcd),_0x5a2d10[_0x4bd311(0xae)],_0x3bc9e6[_0x4bd311(0xae)]);}return _0x5a2d10;}async[a236_0x31a926(0xc2)](_0x4c063b){const _0xc1a268=a236_0x31a926,_0x34f5d3=[..._0x4c063b],_0x352240=[],_0x5abfba=[];while(_0x34f5d3['length']){const _0x11cc2e=_0x34f5d3[_0xc1a268(0xb9)](0x0,this[_0xc1a268(0xba)]),_0x307d9e=await this[_0xc1a268(0xbb)][_0xc1a268(0xcb)](_0x11cc2e);_0x11cc2e['length']!==_0x307d9e['ids']['length']?(_0x34f5d3[_0xc1a268(0x9a)](..._0x307d9e[_0xc1a268(0xb4)]),_0x352240[_0xc1a268(0x9a)](..._0x307d9e['components'])):_0x5abfba['push'](..._0x11cc2e),this['logger'][_0xc1a268(0xaa)]('retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest',_0x4c063b['length']-_0x34f5d3[_0xc1a268(0xae)],_0x4c063b['length']);}if(_0x5abfba['length']){const _0x512b02=await this[_0xc1a268(0xc0)](_0x5abfba);_0x352240[_0xc1a268(0x9a)](..._0x512b02);}return _0x352240;}}exports[a236_0x31a926(0xc4)]=SalesforceRetrieverService;function a236_0x3d01(){const _0x236445=['2984088HATmrb','2RKheaI','fromSalesforce','replace','ParentId','manually\x20retrieving\x20components\x20from\x20salesforce','map','SalesforceQueryService','13975643KnBNJL','GET_COMPONENT_HISTORIES_BY_IDS','FlosumComponentHistoryDto','info','log','__esModule','Name','default','length','toString','(((.+)+)+)+$','filename','../../../../core','logger','ids','all','956475zvbZMg','fileType','2417736tfnTxP','splice','COMPONENTS_PER_REQUEST','salesforceService','attachmentId','../dto/flosum-component-history.dto','7jCpbRt','10540449otkpzX','retrieveLastComponents','4XnOShV','run','../queries','SalesforceRetrieverService','COMPONENTS_PER_QUERY','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','get','10TXIFBD','%ids%','__importDefault','retrieveComponents','join','manually\x20retrieved\x20%d/%d\x20components','apply','5610820gPBVfi','push','then','1268455saZZpW','%parent_ids%'];a236_0x3d01=function(){return _0x236445;};return a236_0x3d01();}