const a242_0x984f32=a242_0x5312;(function(_0x32d4fd,_0x2b2955){const _0x3578c1=a242_0x5312,_0x12b47e=_0x32d4fd();while(!![]){try{const _0x45def1=parseInt(_0x3578c1(0x196))/0x1*(-parseInt(_0x3578c1(0x18e))/0x2)+parseInt(_0x3578c1(0x190))/0x3+-parseInt(_0x3578c1(0x17c))/0x4+parseInt(_0x3578c1(0x18a))/0x5*(parseInt(_0x3578c1(0x19d))/0x6)+-parseInt(_0x3578c1(0x182))/0x7+-parseInt(_0x3578c1(0x185))/0x8*(-parseInt(_0x3578c1(0x19b))/0x9)+-parseInt(_0x3578c1(0x165))/0xa;if(_0x45def1===_0x2b2955)break;else _0x12b47e['push'](_0x12b47e['shift']());}catch(_0x31e0dc){_0x12b47e['push'](_0x12b47e['shift']());}}}(a242_0x1ef2,0xc2d6c));const a242_0x3841c3=(function(){let _0x5bd6fd=!![];return function(_0x4eec1b,_0x513256){const _0x50264b=_0x5bd6fd?function(){const _0x18b4d1=a242_0x5312;if(_0x513256){const _0x18c4f1=_0x513256[_0x18b4d1(0x17b)](_0x4eec1b,arguments);return _0x513256=null,_0x18c4f1;}}:function(){};return _0x5bd6fd=![],_0x50264b;};}()),a242_0x3c56a9=a242_0x3841c3(this,function(){const _0x100988=a242_0x5312;return a242_0x3c56a9[_0x100988(0x19f)]()[_0x100988(0x19c)](_0x100988(0x16b))['toString']()[_0x100988(0x171)](a242_0x3c56a9)[_0x100988(0x19c)]('(((.+)+)+)+$');});function a242_0x5312(_0x4f6dec,_0x2db67b){const _0x2f24ef=a242_0x1ef2();return a242_0x5312=function(_0x3c56a9,_0x3841c3){_0x3c56a9=_0x3c56a9-0x165;let _0x1ef269=_0x2f24ef[_0x3c56a9];return _0x1ef269;},a242_0x5312(_0x4f6dec,_0x2db67b);}function a242_0x1ef2(){const _0x1f3b56=['query','join','log','salesforceService','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','1xmoWZn','then','../queries','map','logger','27OlXyGS','search','114xxaOFA','GET_COMPONENT_HISTORIES_BY_IDS','toString','8626310nXDPdX','splice','retrieveAttachment','get','find','fileName','(((.+)+)+)+$','attachmentId','retrieveComponentIdsFromHistoryIds','%parent_ids%','push','length','constructor','__esModule','fileType','../../../../core','default','COMPONENTS_PER_QUERY','ids','fromSalesforce','typedi','ParentId','apply','1594764AvCEoQ','SalesforceRetrieverService','retrieveLastComponents','COMPONENTS_PER_REQUEST','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','defineProperty','760053xWkamV','name','all','1011512RmkqyO','../dto/flosum-component-history.dto','filename','replace','info','387635zXUIFH','manually\x20retrieving\x20components\x20from\x20salesforce','manually\x20retrieved\x20%d/%d\x20components','%ids%','2059436QVWLMl','run','4036047AsgnLo'];a242_0x1ef2=function(){return _0x1f3b56;};return a242_0x1ef2();}a242_0x3c56a9();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5ee665){const _0x342f90=a242_0x5312;return _0x5ee665&&_0x5ee665[_0x342f90(0x172)]?_0x5ee665:{'default':_0x5ee665};};Object[a242_0x984f32(0x181)](exports,'__esModule',{'value':!![]}),exports[a242_0x984f32(0x17d)]=void 0x0;const core_1=require(a242_0x984f32(0x174)),typedi_1=__importDefault(require(a242_0x984f32(0x179))),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a242_0x984f32(0x198)),flosum_component_history_dto_1=require(a242_0x984f32(0x186));class SalesforceRetrieverService{constructor(_0x15f406){const _0x22f06c=a242_0x984f32;this['salesforceService']=_0x15f406,this[_0x22f06c(0x19a)]=new core_1['Logger'](SalesforceRetrieverService[_0x22f06c(0x183)]),this[_0x22f06c(0x17f)]=0xbb8,this[_0x22f06c(0x176)]=0x1f4;}async[a242_0x984f32(0x16d)](_0x1fecda){const _0x364a5f=a242_0x984f32;this[_0x364a5f(0x19a)][_0x364a5f(0x189)]('manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x1fecda[_0x364a5f(0x170)]);const _0x547c9c=typedi_1[_0x364a5f(0x175)][_0x364a5f(0x168)](salesforce_query_service_1['SalesforceQueryService']),_0x389c8f=_0x1fecda[_0x364a5f(0x199)](_0x448bda=>'\x27'+_0x448bda+'\x27'),_0x20436d=[];while(_0x389c8f[_0x364a5f(0x170)]){const _0x3ab839=_0x389c8f[_0x364a5f(0x166)](0x0,this['COMPONENTS_PER_QUERY']),_0x3bda87=_0x547c9c['query'](queries_1[_0x364a5f(0x195)]['replace'](_0x364a5f(0x16e),_0x3ab839[_0x364a5f(0x192)]())),_0x32e9d8=_0x547c9c[_0x364a5f(0x191)](queries_1[_0x364a5f(0x19e)][_0x364a5f(0x188)](_0x364a5f(0x18d),_0x3ab839['join']()))[_0x364a5f(0x197)](_0x2c5b7f=>_0x2c5b7f[_0x364a5f(0x199)](_0x80c8ee=>flosum_component_history_dto_1['FlosumComponentHistoryDto'][_0x364a5f(0x178)](_0x80c8ee))),[_0x335b0,_0x2351e3]=await Promise[_0x364a5f(0x184)]([_0x3bda87,_0x32e9d8]);for(const _0x58bc66 of _0x2351e3){const _0x35a6c6=_0x335b0[_0x364a5f(0x169)](_0x37368a=>_0x37368a[_0x364a5f(0x17a)]===_0x58bc66['id']);_0x35a6c6&&_0x20436d['push']({'fileType':_0x35a6c6['Name'],'fileName':_0x58bc66[_0x364a5f(0x187)],'attachmentId':_0x35a6c6['Id']});}}return _0x20436d;}async[a242_0x984f32(0x17e)](_0x2d4480){const _0x1e0c3d=a242_0x984f32,_0xf26b68=await this[_0x1e0c3d(0x16d)](_0x2d4480);this[_0x1e0c3d(0x19a)][_0x1e0c3d(0x189)](_0x1e0c3d(0x18b));const _0x523e6e=[];for(const _0x17a008 of _0xf26b68){const _0x2add90=await this[_0x1e0c3d(0x194)][_0x1e0c3d(0x167)](_0x17a008[_0x1e0c3d(0x16c)],!![]);_0x523e6e[_0x1e0c3d(0x16f)]({'body':_0x2add90['toString']('base64'),'fileName':_0x17a008[_0x1e0c3d(0x16a)],'fileType':_0x17a008[_0x1e0c3d(0x173)]}),this['logger'][_0x1e0c3d(0x189)](_0x1e0c3d(0x18c),_0x523e6e[_0x1e0c3d(0x170)],_0x2d4480[_0x1e0c3d(0x170)]);}return _0x523e6e;}async[a242_0x984f32(0x18f)](_0x58c736){const _0x4117f2=a242_0x984f32,_0x417f2a=[..._0x58c736],_0x3a376d=[],_0x51f47a=[];while(_0x417f2a[_0x4117f2(0x170)]){const _0x5785a9=_0x417f2a[_0x4117f2(0x166)](0x0,this[_0x4117f2(0x17f)]),_0x5ed7b4=await this['salesforceService']['retrieveComponents'](_0x5785a9);_0x5785a9[_0x4117f2(0x170)]!==_0x5ed7b4[_0x4117f2(0x177)][_0x4117f2(0x170)]?(_0x417f2a[_0x4117f2(0x16f)](..._0x5ed7b4[_0x4117f2(0x177)]),_0x3a376d[_0x4117f2(0x16f)](..._0x5ed7b4['components'])):_0x51f47a[_0x4117f2(0x16f)](..._0x5785a9),this[_0x4117f2(0x19a)][_0x4117f2(0x193)](_0x4117f2(0x180),_0x58c736['length']-_0x417f2a['length'],_0x58c736['length']);}if(_0x51f47a[_0x4117f2(0x170)]){const _0x1bcf95=await this['retrieveLastComponents'](_0x51f47a);_0x3a376d['push'](..._0x1bcf95);}return _0x3a376d;}}exports[a242_0x984f32(0x17d)]=SalesforceRetrieverService;