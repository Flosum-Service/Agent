const a253_0x4b430c=a253_0x2ab9;(function(_0xc78d5,_0x364e0e){const _0x33c2e4=a253_0x2ab9,_0x1622b1=_0xc78d5();while(!![]){try{const _0x562398=parseInt(_0x33c2e4(0x176))/0x1+parseInt(_0x33c2e4(0x184))/0x2*(-parseInt(_0x33c2e4(0x169))/0x3)+parseInt(_0x33c2e4(0x192))/0x4+-parseInt(_0x33c2e4(0x179))/0x5+-parseInt(_0x33c2e4(0x18b))/0x6+-parseInt(_0x33c2e4(0x163))/0x7+-parseInt(_0x33c2e4(0x16d))/0x8*(-parseInt(_0x33c2e4(0x188))/0x9);if(_0x562398===_0x364e0e)break;else _0x1622b1['push'](_0x1622b1['shift']());}catch(_0x5b7145){_0x1622b1['push'](_0x1622b1['shift']());}}}(a253_0x1fc9,0x971eb));const a253_0x5ec513=(function(){let _0x533293=!![];return function(_0x36db35,_0x232251){const _0x3936b6=_0x533293?function(){const _0x576f6c=a253_0x2ab9;if(_0x232251){const _0x507fbf=_0x232251[_0x576f6c(0x180)](_0x36db35,arguments);return _0x232251=null,_0x507fbf;}}:function(){};return _0x533293=![],_0x3936b6;};}()),a253_0x6aef17=a253_0x5ec513(this,function(){const _0x1307df=a253_0x2ab9;return a253_0x6aef17[_0x1307df(0x15e)]()[_0x1307df(0x171)]('(((.+)+)+)+$')[_0x1307df(0x15e)]()[_0x1307df(0x186)](a253_0x6aef17)['search'](_0x1307df(0x191));});a253_0x6aef17();function a253_0x1fc9(){const _0x570adf=['default','Retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','%parent_ids%','components','retrieveComponentIdsFromHistoryIds','537663ZHUSIc','fromSalesforce','./salesforce-query.service','join','8xOoTXL','__importDefault','../queries','base64','search','../../../../core','COMPONENTS_PER_QUERY','__esModule','retrieveComponents','113834vyNiwl','Manually\x20retrieved\x20%d/%d\x20components','name','312870PMKcfv','query','fileType','Name','logger','ParentId','defineProperty','apply','SalesforceRetrieverService','filename','log','10WAZdWX','retrieveLastComponents','constructor','../dto/flosum-component-history.dto','23805873uzBRYy','attachmentId','then','6522282BtSyIb','info','FlosumComponentHistoryDto','push','fileName','COMPONENTS_PER_REQUEST','(((.+)+)+)+$','951400NqVYZP','GET_COMPONENT_HISTORIES_BY_IDS','ids','get','salesforceService','replace','toString','map','splice','length','Logger','2324476SfeqUl'];a253_0x1fc9=function(){return _0x570adf;};return a253_0x1fc9();}'use strict';var __importDefault=this&&this[a253_0x4b430c(0x16e)]||function(_0x49c19d){const _0x3b47a7=a253_0x4b430c;return _0x49c19d&&_0x49c19d[_0x3b47a7(0x174)]?_0x49c19d:{'default':_0x49c19d};};function a253_0x2ab9(_0x25b385,_0x2e5f3a){const _0x3b6a3d=a253_0x1fc9();return a253_0x2ab9=function(_0x6aef17,_0x5ec513){_0x6aef17=_0x6aef17-0x15b;let _0x1fc90d=_0x3b6a3d[_0x6aef17];return _0x1fc90d;},a253_0x2ab9(_0x25b385,_0x2e5f3a);}Object[a253_0x4b430c(0x17f)](exports,a253_0x4b430c(0x174),{'value':!![]}),exports[a253_0x4b430c(0x181)]=void 0x0;const core_1=require(a253_0x4b430c(0x172)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require(a253_0x4b430c(0x16b)),queries_1=require(a253_0x4b430c(0x16f)),flosum_component_history_dto_1=require(a253_0x4b430c(0x187));class SalesforceRetrieverService{constructor(_0x509e69){const _0x5d792b=a253_0x4b430c;this[_0x5d792b(0x15c)]=_0x509e69,this[_0x5d792b(0x17d)]=new core_1[(_0x5d792b(0x162))](SalesforceRetrieverService[_0x5d792b(0x178)]),this[_0x5d792b(0x190)]=0xbb8,this[_0x5d792b(0x173)]=0x1f4;}async[a253_0x4b430c(0x168)](_0x42a887){const _0xa0e530=a253_0x4b430c;this['logger']['info']('Manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x42a887['length']);const _0x4fefab=typedi_1[_0xa0e530(0x164)][_0xa0e530(0x15b)](salesforce_query_service_1['SalesforceQueryService']),_0x22102d=_0x42a887[_0xa0e530(0x15f)](_0x45fec5=>'\x27'+_0x45fec5+'\x27'),_0x137056=[];while(_0x22102d[_0xa0e530(0x161)]){const _0x14eec1=_0x22102d['splice'](0x0,this[_0xa0e530(0x173)]),_0x168310=_0x4fefab['query'](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0xa0e530(0x15d)](_0xa0e530(0x166),_0x14eec1[_0xa0e530(0x16c)]())),_0x466499=_0x4fefab[_0xa0e530(0x17a)](queries_1[_0xa0e530(0x193)][_0xa0e530(0x15d)]('%ids%',_0x14eec1['join']()))[_0xa0e530(0x18a)](_0x3bddbc=>_0x3bddbc['map'](_0x37938b=>flosum_component_history_dto_1[_0xa0e530(0x18d)][_0xa0e530(0x16a)](_0x37938b))),[_0x24a8aa,_0x46d3ea]=await Promise['all']([_0x168310,_0x466499]);for(const _0x263bc2 of _0x46d3ea){const _0x4ffbad=_0x24a8aa['find'](_0x473e41=>_0x473e41[_0xa0e530(0x17e)]===_0x263bc2['id']);_0x4ffbad&&_0x137056['push']({'fileType':_0x4ffbad[_0xa0e530(0x17c)],'fileName':_0x263bc2[_0xa0e530(0x182)],'attachmentId':_0x4ffbad['Id']});}}return _0x137056;}async[a253_0x4b430c(0x185)](_0xca71ad){const _0x488083=a253_0x4b430c,_0x3f00cc=await this['retrieveComponentIdsFromHistoryIds'](_0xca71ad);this[_0x488083(0x17d)][_0x488083(0x18c)]('Manually\x20retrieving\x20components\x20from\x20salesforce');const _0x2517c8=[];for(const _0x50faf8 of _0x3f00cc){const _0x42b3e8=await this[_0x488083(0x15c)]['retrieveAttachment'](_0x50faf8[_0x488083(0x189)],!![]);_0x2517c8[_0x488083(0x18e)]({'body':_0x42b3e8[_0x488083(0x15e)](_0x488083(0x170)),'fileName':_0x50faf8[_0x488083(0x18f)],'fileType':_0x50faf8[_0x488083(0x17b)]}),this[_0x488083(0x17d)][_0x488083(0x18c)](_0x488083(0x177),_0x2517c8['length'],_0xca71ad[_0x488083(0x161)]);}return _0x2517c8;}async['run'](_0x25bee0){const _0x6cbf92=a253_0x4b430c,_0x2777e6=[..._0x25bee0],_0x49f457=[],_0x321066=[];while(_0x2777e6[_0x6cbf92(0x161)]){const _0x3f5628=_0x2777e6[_0x6cbf92(0x160)](0x0,this[_0x6cbf92(0x190)]),_0x1c370f=await this['salesforceService'][_0x6cbf92(0x175)](_0x3f5628);_0x3f5628[_0x6cbf92(0x161)]!==_0x1c370f['ids']['length']?(_0x2777e6['push'](..._0x1c370f[_0x6cbf92(0x194)]),_0x49f457[_0x6cbf92(0x18e)](..._0x1c370f[_0x6cbf92(0x167)])):_0x321066['push'](..._0x3f5628),this[_0x6cbf92(0x17d)][_0x6cbf92(0x183)](_0x6cbf92(0x165),_0x25bee0[_0x6cbf92(0x161)]-_0x2777e6[_0x6cbf92(0x161)],_0x25bee0[_0x6cbf92(0x161)]);}if(_0x321066['length']){const _0x93e703=await this['retrieveLastComponents'](_0x321066);_0x49f457[_0x6cbf92(0x18e)](..._0x93e703);}return _0x49f457;}}exports[a253_0x4b430c(0x181)]=SalesforceRetrieverService;