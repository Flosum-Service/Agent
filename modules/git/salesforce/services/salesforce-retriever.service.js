const a237_0x3504ca=a237_0x3a1b;(function(_0x34abf8,_0x383736){const _0x400a88=a237_0x3a1b,_0x615abb=_0x34abf8();while(!![]){try{const _0x5cfd12=parseInt(_0x400a88(0x1f2))/0x1*(-parseInt(_0x400a88(0x1f8))/0x2)+parseInt(_0x400a88(0x204))/0x3+-parseInt(_0x400a88(0x1f6))/0x4+-parseInt(_0x400a88(0x203))/0x5+-parseInt(_0x400a88(0x214))/0x6+-parseInt(_0x400a88(0x206))/0x7+parseInt(_0x400a88(0x219))/0x8;if(_0x5cfd12===_0x383736)break;else _0x615abb['push'](_0x615abb['shift']());}catch(_0x3201cf){_0x615abb['push'](_0x615abb['shift']());}}}(a237_0x54af,0x2f3ee));const a237_0x3f0d0b=(function(){let _0x30296a=!![];return function(_0x3f8b7a,_0x1a0418){const _0x29e606=_0x30296a?function(){const _0x44d8c5=a237_0x3a1b;if(_0x1a0418){const _0x1c39db=_0x1a0418[_0x44d8c5(0x1fa)](_0x3f8b7a,arguments);return _0x1a0418=null,_0x1c39db;}}:function(){};return _0x30296a=![],_0x29e606;};}()),a237_0xf6abfd=a237_0x3f0d0b(this,function(){const _0x117a14=a237_0x3a1b;return a237_0xf6abfd['toString']()[_0x117a14(0x1ea)](_0x117a14(0x1fb))[_0x117a14(0x21e)]()['constructor'](a237_0xf6abfd)[_0x117a14(0x1ea)]('(((.+)+)+)+$');});a237_0xf6abfd();function a237_0x3a1b(_0x2c0623,_0x166510){const _0x4e3b1c=a237_0x54af();return a237_0x3a1b=function(_0xf6abfd,_0x3f0d0b){_0xf6abfd=_0xf6abfd-0x1e6;let _0x54afb9=_0x4e3b1c[_0xf6abfd];return _0x54afb9;},a237_0x3a1b(_0x2c0623,_0x166510);}function a237_0x54af(){const _0x520ac3=['apply','(((.+)+)+)+$','manually\x20retrieved\x20%d/%d\x20components','default','query','logger','length','COMPONENTS_PER_REQUEST','SalesforceQueryService','1678305hSJTVJ','348198tpgdoa','info','1406657siDJTI','splice','log','replace','retrieveLastComponents','Logger','join','components','push','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','run','retrieveAttachment','COMPONENTS_PER_QUERY','%ids%','1513620CdYkpu','ids','FlosumComponentHistoryDto','../../../../core','SalesforceRetrieverService','10179112dHFwVK','fileName','then','all','fromSalesforce','toString','../dto/flosum-component-history.dto','__importDefault','__esModule','salesforceService','search','Name','defineProperty','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','GET_COMPONENT_HISTORIES_BY_IDS','manually\x20retrieving\x20components\x20from\x20salesforce','retrieveComponentIdsFromHistoryIds','%parent_ids%','431qdPWMo','typedi','filename','./salesforce-query.service','782908XmNWGU','ParentId','976cHsHsR','../queries'];a237_0x54af=function(){return _0x520ac3;};return a237_0x54af();}'use strict';var __importDefault=this&&this[a237_0x3504ca(0x1e7)]||function(_0x45d477){const _0xaf16ac=a237_0x3504ca;return _0x45d477&&_0x45d477[_0xaf16ac(0x1e8)]?_0x45d477:{'default':_0x45d477};};Object[a237_0x3504ca(0x1ec)](exports,a237_0x3504ca(0x1e8),{'value':!![]}),exports[a237_0x3504ca(0x218)]=void 0x0;const core_1=require(a237_0x3504ca(0x217)),typedi_1=__importDefault(require(a237_0x3504ca(0x1f3))),salesforce_query_service_1=require(a237_0x3504ca(0x1f5)),queries_1=require(a237_0x3504ca(0x1f9)),flosum_component_history_dto_1=require(a237_0x3504ca(0x1e6));class SalesforceRetrieverService{constructor(_0x33f435){const _0x5e0d68=a237_0x3504ca;this[_0x5e0d68(0x1e9)]=_0x33f435,this['logger']=new core_1[(_0x5e0d68(0x20b))](SalesforceRetrieverService['name']),this[_0x5e0d68(0x201)]=0xbb8,this[_0x5e0d68(0x212)]=0x1f4;}async[a237_0x3504ca(0x1f0)](_0x14b9db){const _0x5737d5=a237_0x3504ca;this[_0x5737d5(0x1ff)][_0x5737d5(0x205)]('manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x14b9db[_0x5737d5(0x200)]);const _0x12e3a2=typedi_1[_0x5737d5(0x1fd)]['get'](salesforce_query_service_1[_0x5737d5(0x202)]),_0x586c70=_0x14b9db['map'](_0x3ad74e=>'\x27'+_0x3ad74e+'\x27'),_0xb4ebf1=[];while(_0x586c70[_0x5737d5(0x200)]){const _0x4ee4b9=_0x586c70[_0x5737d5(0x207)](0x0,this[_0x5737d5(0x212)]),_0x3a316c=_0x12e3a2[_0x5737d5(0x1fe)](queries_1[_0x5737d5(0x20f)]['replace'](_0x5737d5(0x1f1),_0x4ee4b9[_0x5737d5(0x20c)]())),_0x359e21=_0x12e3a2[_0x5737d5(0x1fe)](queries_1[_0x5737d5(0x1ee)][_0x5737d5(0x209)](_0x5737d5(0x213),_0x4ee4b9[_0x5737d5(0x20c)]()))[_0x5737d5(0x21b)](_0x24e41a=>_0x24e41a['map'](_0x1b8af1=>flosum_component_history_dto_1[_0x5737d5(0x216)][_0x5737d5(0x21d)](_0x1b8af1))),[_0x22af2a,_0x4ff695]=await Promise[_0x5737d5(0x21c)]([_0x3a316c,_0x359e21]);for(const _0x53db7e of _0x4ff695){const _0x48337f=_0x22af2a['find'](_0x28f927=>_0x28f927[_0x5737d5(0x1f7)]===_0x53db7e['id']);_0x48337f&&_0xb4ebf1[_0x5737d5(0x20e)]({'fileType':_0x48337f[_0x5737d5(0x1eb)],'fileName':_0x53db7e[_0x5737d5(0x1f4)],'attachmentId':_0x48337f['Id']});}}return _0xb4ebf1;}async[a237_0x3504ca(0x20a)](_0x2ef6dc){const _0xd9344f=a237_0x3504ca,_0x386534=await this['retrieveComponentIdsFromHistoryIds'](_0x2ef6dc);this[_0xd9344f(0x1ff)][_0xd9344f(0x205)](_0xd9344f(0x1ef));const _0x4aa809=[];for(const _0x4ce75b of _0x386534){const _0x2115ba=await this[_0xd9344f(0x1e9)][_0xd9344f(0x211)](_0x4ce75b['attachmentId'],!![]);_0x4aa809[_0xd9344f(0x20e)]({'body':_0x2115ba[_0xd9344f(0x21e)]('base64'),'fileName':_0x4ce75b[_0xd9344f(0x21a)],'fileType':_0x4ce75b['fileType']}),this[_0xd9344f(0x1ff)][_0xd9344f(0x205)](_0xd9344f(0x1fc),_0x4aa809[_0xd9344f(0x200)],_0x2ef6dc['length']);}return _0x4aa809;}async[a237_0x3504ca(0x210)](_0x176253){const _0x240d89=a237_0x3504ca,_0x4afdc0=[..._0x176253],_0x89c583=[],_0x32ec6f=[];while(_0x4afdc0[_0x240d89(0x200)]){const _0x470dba=_0x4afdc0[_0x240d89(0x207)](0x0,this[_0x240d89(0x201)]),_0x48fd27=await this['salesforceService']['retrieveComponents'](_0x470dba);_0x470dba[_0x240d89(0x200)]!==_0x48fd27[_0x240d89(0x215)][_0x240d89(0x200)]?(_0x4afdc0[_0x240d89(0x20e)](..._0x48fd27['ids']),_0x89c583[_0x240d89(0x20e)](..._0x48fd27[_0x240d89(0x20d)])):_0x32ec6f[_0x240d89(0x20e)](..._0x470dba),this[_0x240d89(0x1ff)][_0x240d89(0x208)](_0x240d89(0x1ed),_0x176253[_0x240d89(0x200)]-_0x4afdc0[_0x240d89(0x200)],_0x176253[_0x240d89(0x200)]);}if(_0x32ec6f[_0x240d89(0x200)]){const _0x43f887=await this['retrieveLastComponents'](_0x32ec6f);_0x89c583[_0x240d89(0x20e)](..._0x43f887);}return _0x89c583;}}exports[a237_0x3504ca(0x218)]=SalesforceRetrieverService;