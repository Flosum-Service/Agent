const a236_0xa67219=a236_0x583a;function a236_0x583a(_0x53a3ab,_0x1921a4){const _0x142e14=a236_0x5346();return a236_0x583a=function(_0x135154,_0x25412e){_0x135154=_0x135154-0xbb;let _0x5346d6=_0x142e14[_0x135154];return _0x5346d6;},a236_0x583a(_0x53a3ab,_0x1921a4);}(function(_0x3ac573,_0x2de203){const _0x477770=a236_0x583a,_0xadccde=_0x3ac573();while(!![]){try{const _0x5e9eca=-parseInt(_0x477770(0xe7))/0x1+-parseInt(_0x477770(0xc0))/0x2*(parseInt(_0x477770(0xe6))/0x3)+parseInt(_0x477770(0xd3))/0x4*(-parseInt(_0x477770(0xc8))/0x5)+parseInt(_0x477770(0xda))/0x6*(-parseInt(_0x477770(0xf4))/0x7)+parseInt(_0x477770(0xf0))/0x8*(-parseInt(_0x477770(0xbc))/0x9)+parseInt(_0x477770(0xed))/0xa*(-parseInt(_0x477770(0xc6))/0xb)+parseInt(_0x477770(0xc2))/0xc;if(_0x5e9eca===_0x2de203)break;else _0xadccde['push'](_0xadccde['shift']());}catch(_0x44a6c9){_0xadccde['push'](_0xadccde['shift']());}}}(a236_0x5346,0xeead0));const a236_0x25412e=(function(){let _0x2a0823=!![];return function(_0x55f7db,_0x118251){const _0x3f69cf=_0x2a0823?function(){const _0x35f912=a236_0x583a;if(_0x118251){const _0x3ca9a7=_0x118251[_0x35f912(0xcc)](_0x55f7db,arguments);return _0x118251=null,_0x3ca9a7;}}:function(){};return _0x2a0823=![],_0x3f69cf;};}()),a236_0x135154=a236_0x25412e(this,function(){const _0x177892=a236_0x583a;return a236_0x135154[_0x177892(0xef)]()[_0x177892(0xe0)](_0x177892(0xc5))['toString']()[_0x177892(0xf8)](a236_0x135154)[_0x177892(0xe0)](_0x177892(0xc5));});a236_0x135154();function a236_0x5346(){const _0x13a950=['fromSalesforce','FlosumComponentHistoryDto','join','Name','__esModule','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','540AlJgvI','salesforceService','default','name','base64','%ids%','%parent_ids%','6RScLvm','info','push','replace','splice','GET_COMPONENT_HISTORIES_BY_IDS','search','attachmentId','manually\x20retrieved\x20%d/%d\x20components','../dto/flosum-component-history.dto','../queries','defineProperty','237114ElWaKe','1932383kUDzTs','query','logger','find','get','map','50vCZgLB','retrieveLastComponents','toString','2352pOBrJH','retrieveComponentIdsFromHistoryIds','COMPONENTS_PER_QUERY','retrieveComponents','5117875iIQhPx','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','ParentId','length','constructor','then','19692ghDHfg','ids','all','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','30TMOyIu','SalesforceRetrieverService','87882672dvrQDX','components','filename','(((.+)+)+)+$','2415589MBCCrL','manually\x20retrieving\x20components\x20from\x20salesforce','27985WXqZdG','COMPONENTS_PER_REQUEST','Logger','fileName','apply'];a236_0x5346=function(){return _0x13a950;};return a236_0x5346();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x567ab3){const _0x100792=a236_0x583a;return _0x567ab3&&_0x567ab3[_0x100792(0xd1)]?_0x567ab3:{'default':_0x567ab3};};Object[a236_0xa67219(0xe5)](exports,a236_0xa67219(0xd1),{'value':!![]}),exports[a236_0xa67219(0xc1)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a236_0xa67219(0xe4)),flosum_component_history_dto_1=require(a236_0xa67219(0xe3));class SalesforceRetrieverService{constructor(_0x4df8a8){const _0x4d7c98=a236_0xa67219;this[_0x4d7c98(0xd4)]=_0x4df8a8,this[_0x4d7c98(0xe9)]=new core_1[(_0x4d7c98(0xca))](SalesforceRetrieverService[_0x4d7c98(0xd6)]),this[_0x4d7c98(0xc9)]=0xbb8,this[_0x4d7c98(0xf2)]=0x1f4;}async[a236_0xa67219(0xf1)](_0x33181c){const _0xecd457=a236_0xa67219;this[_0xecd457(0xe9)][_0xecd457(0xdb)](_0xecd457(0xbf),_0x33181c[_0xecd457(0xf7)]);const _0x1c39cd=typedi_1[_0xecd457(0xd5)][_0xecd457(0xeb)](salesforce_query_service_1['SalesforceQueryService']),_0xaad088=_0x33181c[_0xecd457(0xec)](_0xf7d1ec=>'\x27'+_0xf7d1ec+'\x27'),_0x170e39=[];while(_0xaad088[_0xecd457(0xf7)]){const _0x244e1f=_0xaad088[_0xecd457(0xde)](0x0,this['COMPONENTS_PER_QUERY']),_0x2e1622=_0x1c39cd[_0xecd457(0xe8)](queries_1[_0xecd457(0xf5)][_0xecd457(0xdd)](_0xecd457(0xd9),_0x244e1f['join']())),_0x5961fb=_0x1c39cd['query'](queries_1[_0xecd457(0xdf)][_0xecd457(0xdd)](_0xecd457(0xd8),_0x244e1f[_0xecd457(0xcf)]()))[_0xecd457(0xbb)](_0x8a470f=>_0x8a470f['map'](_0x2b6d1a=>flosum_component_history_dto_1[_0xecd457(0xce)][_0xecd457(0xcd)](_0x2b6d1a))),[_0x29e095,_0x22bd05]=await Promise[_0xecd457(0xbe)]([_0x2e1622,_0x5961fb]);for(const _0x3a6f76 of _0x22bd05){const _0x33e9f2=_0x29e095[_0xecd457(0xea)](_0x220667=>_0x220667[_0xecd457(0xf6)]===_0x3a6f76['id']);_0x33e9f2&&_0x170e39[_0xecd457(0xdc)]({'fileType':_0x33e9f2[_0xecd457(0xd0)],'fileName':_0x3a6f76[_0xecd457(0xc4)],'attachmentId':_0x33e9f2['Id']});}}return _0x170e39;}async[a236_0xa67219(0xee)](_0x14c2fb){const _0x5219b5=a236_0xa67219,_0x474773=await this[_0x5219b5(0xf1)](_0x14c2fb);this[_0x5219b5(0xe9)]['info'](_0x5219b5(0xc7));const _0x302be7=[];for(const _0x31ea0d of _0x474773){const _0x2c172e=await this['salesforceService']['retrieveAttachment'](_0x31ea0d[_0x5219b5(0xe1)],!![]);_0x302be7['push']({'body':_0x2c172e[_0x5219b5(0xef)](_0x5219b5(0xd7)),'fileName':_0x31ea0d[_0x5219b5(0xcb)],'fileType':_0x31ea0d['fileType']}),this[_0x5219b5(0xe9)][_0x5219b5(0xdb)](_0x5219b5(0xe2),_0x302be7['length'],_0x14c2fb[_0x5219b5(0xf7)]);}return _0x302be7;}async['run'](_0x45f98f){const _0x3103f8=a236_0xa67219,_0x9089ba=[..._0x45f98f],_0x5b078a=[],_0x4f583c=[];while(_0x9089ba[_0x3103f8(0xf7)]){const _0x3aaa3f=_0x9089ba[_0x3103f8(0xde)](0x0,this[_0x3103f8(0xc9)]),_0x525e1d=await this[_0x3103f8(0xd4)][_0x3103f8(0xf3)](_0x3aaa3f);_0x3aaa3f[_0x3103f8(0xf7)]!==_0x525e1d['ids'][_0x3103f8(0xf7)]?(_0x9089ba['push'](..._0x525e1d[_0x3103f8(0xbd)]),_0x5b078a[_0x3103f8(0xdc)](..._0x525e1d[_0x3103f8(0xc3)])):_0x4f583c['push'](..._0x3aaa3f),this[_0x3103f8(0xe9)]['log'](_0x3103f8(0xd2),_0x45f98f[_0x3103f8(0xf7)]-_0x9089ba[_0x3103f8(0xf7)],_0x45f98f['length']);}if(_0x4f583c['length']){const _0x372209=await this['retrieveLastComponents'](_0x4f583c);_0x5b078a['push'](..._0x372209);}return _0x5b078a;}}exports[a236_0xa67219(0xc1)]=SalesforceRetrieverService;