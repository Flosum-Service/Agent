const a242_0xc8ae0f=a242_0x2b9b;(function(_0x5ae2d8,_0x4a5769){const _0xd69a31=a242_0x2b9b,_0x2c68ce=_0x5ae2d8();while(!![]){try{const _0x2f1d8e=parseInt(_0xd69a31(0xea))/0x1+-parseInt(_0xd69a31(0xe4))/0x2*(-parseInt(_0xd69a31(0xe5))/0x3)+-parseInt(_0xd69a31(0x110))/0x4+parseInt(_0xd69a31(0xde))/0x5*(-parseInt(_0xd69a31(0x113))/0x6)+-parseInt(_0xd69a31(0xf2))/0x7*(parseInt(_0xd69a31(0xdf))/0x8)+-parseInt(_0xd69a31(0xfd))/0x9*(parseInt(_0xd69a31(0xf5))/0xa)+parseInt(_0xd69a31(0xff))/0xb*(parseInt(_0xd69a31(0xf0))/0xc);if(_0x2f1d8e===_0x4a5769)break;else _0x2c68ce['push'](_0x2c68ce['shift']());}catch(_0x4c2b3c){_0x2c68ce['push'](_0x2c68ce['shift']());}}}(a242_0x1896,0x4252b));const a242_0x299ee3=(function(){let _0x5e3d57=!![];return function(_0x525f70,_0x1ad1e7){const _0x3157e5=_0x5e3d57?function(){const _0x20ecfc=a242_0x2b9b;if(_0x1ad1e7){const _0x1a855b=_0x1ad1e7[_0x20ecfc(0xe2)](_0x525f70,arguments);return _0x1ad1e7=null,_0x1a855b;}}:function(){};return _0x5e3d57=![],_0x3157e5;};}()),a242_0x20b8a9=a242_0x299ee3(this,function(){const _0x4ee2ba=a242_0x2b9b;return a242_0x20b8a9['toString']()['search'](_0x4ee2ba(0xe7))['toString']()['constructor'](a242_0x20b8a9)[_0x4ee2ba(0xe8)](_0x4ee2ba(0xe7));});a242_0x20b8a9();'use strict';var __importDefault=this&&this[a242_0xc8ae0f(0xf1)]||function(_0x51c10b){return _0x51c10b&&_0x51c10b['__esModule']?_0x51c10b:{'default':_0x51c10b};};Object[a242_0xc8ae0f(0x104)](exports,a242_0xc8ae0f(0xdd),{'value':!![]}),exports[a242_0xc8ae0f(0xf9)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require(a242_0xc8ae0f(0xfc)),queries_1=require(a242_0xc8ae0f(0xec)),flosum_component_history_dto_1=require(a242_0xc8ae0f(0xf8));function a242_0x1896(){const _0xdfdcbb=['defineProperty','COMPONENTS_PER_QUERY','logger','length','run','base64','retrieveAttachment','Name','splice','attachmentId','toString','retrieveLastComponents','1049668LKpLjF','query','filename','1732218mlykWm','log','GET_COMPONENT_HISTORIES_BY_IDS','%parent_ids%','components','%ids%','fileName','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','__esModule','5FuSSjv','24984mFrKKz','retrieveComponentIdsFromHistoryIds','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','apply','info','18uBPdSD','130593AjTpnM','salesforceService','(((.+)+)+)+$','search','manually\x20retrieved\x20%d/%d\x20components','138535GBPDpz','ParentId','../queries','join','push','fromSalesforce','24MRVPYT','__importDefault','91dTxxbk','SalesforceQueryService','get','40CXeEqT','ids','name','../dto/flosum-component-history.dto','SalesforceRetrieverService','then','all','./salesforce-query.service','587178PbUvyX','Logger','3267176HJcxhh','replace','COMPONENTS_PER_REQUEST','retrieveComponents','map'];a242_0x1896=function(){return _0xdfdcbb;};return a242_0x1896();}function a242_0x2b9b(_0x52cc7c,_0x100305){const _0x327947=a242_0x1896();return a242_0x2b9b=function(_0x20b8a9,_0x299ee3){_0x20b8a9=_0x20b8a9-0xdc;let _0x189620=_0x327947[_0x20b8a9];return _0x189620;},a242_0x2b9b(_0x52cc7c,_0x100305);}class SalesforceRetrieverService{constructor(_0x1f65cd){const _0x2f3345=a242_0xc8ae0f;this[_0x2f3345(0xe6)]=_0x1f65cd,this['logger']=new core_1[(_0x2f3345(0xfe))](SalesforceRetrieverService[_0x2f3345(0xf7)]),this[_0x2f3345(0x101)]=0xbb8,this['COMPONENTS_PER_QUERY']=0x1f4;}async[a242_0xc8ae0f(0xe0)](_0x18d44f){const _0x6848b2=a242_0xc8ae0f;this[_0x6848b2(0x106)][_0x6848b2(0xe3)](_0x6848b2(0xdc),_0x18d44f[_0x6848b2(0x107)]);const _0x43fb22=typedi_1['default'][_0x6848b2(0xf4)](salesforce_query_service_1[_0x6848b2(0xf3)]),_0x2d8af3=_0x18d44f[_0x6848b2(0x103)](_0x485889=>'\x27'+_0x485889+'\x27'),_0x372e76=[];while(_0x2d8af3[_0x6848b2(0x107)]){const _0xa9b613=_0x2d8af3[_0x6848b2(0x10c)](0x0,this[_0x6848b2(0x105)]),_0x30fb44=_0x43fb22[_0x6848b2(0x111)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x6848b2(0x100)](_0x6848b2(0x116),_0xa9b613[_0x6848b2(0xed)]())),_0x461bba=_0x43fb22['query'](queries_1[_0x6848b2(0x115)]['replace'](_0x6848b2(0x118),_0xa9b613['join']()))[_0x6848b2(0xfa)](_0x55c38d=>_0x55c38d[_0x6848b2(0x103)](_0x442dce=>flosum_component_history_dto_1['FlosumComponentHistoryDto'][_0x6848b2(0xef)](_0x442dce))),[_0x2cbb61,_0xa09f4e]=await Promise[_0x6848b2(0xfb)]([_0x30fb44,_0x461bba]);for(const _0x1939d4 of _0xa09f4e){const _0x2e0b4f=_0x2cbb61['find'](_0x59985c=>_0x59985c[_0x6848b2(0xeb)]===_0x1939d4['id']);_0x2e0b4f&&_0x372e76[_0x6848b2(0xee)]({'fileType':_0x2e0b4f[_0x6848b2(0x10b)],'fileName':_0x1939d4[_0x6848b2(0x112)],'attachmentId':_0x2e0b4f['Id']});}}return _0x372e76;}async[a242_0xc8ae0f(0x10f)](_0x55a0ce){const _0x5d85c1=a242_0xc8ae0f,_0x55310a=await this[_0x5d85c1(0xe0)](_0x55a0ce);this[_0x5d85c1(0x106)][_0x5d85c1(0xe3)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x20b4d5=[];for(const _0x26eb3f of _0x55310a){const _0x49112c=await this[_0x5d85c1(0xe6)][_0x5d85c1(0x10a)](_0x26eb3f[_0x5d85c1(0x10d)],!![]);_0x20b4d5[_0x5d85c1(0xee)]({'body':_0x49112c[_0x5d85c1(0x10e)](_0x5d85c1(0x109)),'fileName':_0x26eb3f[_0x5d85c1(0x119)],'fileType':_0x26eb3f['fileType']}),this[_0x5d85c1(0x106)]['info'](_0x5d85c1(0xe9),_0x20b4d5[_0x5d85c1(0x107)],_0x55a0ce[_0x5d85c1(0x107)]);}return _0x20b4d5;}async[a242_0xc8ae0f(0x108)](_0x2e2421){const _0x55bce2=a242_0xc8ae0f,_0x20f672=[..._0x2e2421],_0x5ae0f0=[],_0x847da6=[];while(_0x20f672[_0x55bce2(0x107)]){const _0x436ad7=_0x20f672[_0x55bce2(0x10c)](0x0,this[_0x55bce2(0x101)]),_0x3918b8=await this['salesforceService'][_0x55bce2(0x102)](_0x436ad7);_0x436ad7['length']!==_0x3918b8[_0x55bce2(0xf6)]['length']?(_0x20f672['push'](..._0x3918b8[_0x55bce2(0xf6)]),_0x5ae0f0['push'](..._0x3918b8[_0x55bce2(0x117)])):_0x847da6[_0x55bce2(0xee)](..._0x436ad7),this['logger'][_0x55bce2(0x114)](_0x55bce2(0xe1),_0x2e2421[_0x55bce2(0x107)]-_0x20f672[_0x55bce2(0x107)],_0x2e2421['length']);}if(_0x847da6['length']){const _0x3703d9=await this[_0x55bce2(0x10f)](_0x847da6);_0x5ae0f0['push'](..._0x3703d9);}return _0x5ae0f0;}}exports['SalesforceRetrieverService']=SalesforceRetrieverService;