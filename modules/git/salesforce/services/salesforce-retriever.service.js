const a242_0x2a293b=a242_0x2b0b;(function(_0x5d9065,_0x35ba9e){const _0x3e397f=a242_0x2b0b,_0x3da511=_0x5d9065();while(!![]){try{const _0x187fcb=parseInt(_0x3e397f(0xe6))/0x1+parseInt(_0x3e397f(0xc2))/0x2+-parseInt(_0x3e397f(0xee))/0x3+parseInt(_0x3e397f(0xc0))/0x4+-parseInt(_0x3e397f(0xc7))/0x5*(parseInt(_0x3e397f(0xf3))/0x6)+parseInt(_0x3e397f(0xcb))/0x7*(-parseInt(_0x3e397f(0xcd))/0x8)+parseInt(_0x3e397f(0xd9))/0x9;if(_0x187fcb===_0x35ba9e)break;else _0x3da511['push'](_0x3da511['shift']());}catch(_0x33823){_0x3da511['push'](_0x3da511['shift']());}}}(a242_0x2b75,0x3c29e));const a242_0x1c861c=(function(){let _0x43a3dd=!![];return function(_0x18c497,_0x49768d){const _0x4863ee=_0x43a3dd?function(){const _0x1a2142=a242_0x2b0b;if(_0x49768d){const _0x5c31d5=_0x49768d[_0x1a2142(0xd6)](_0x18c497,arguments);return _0x49768d=null,_0x5c31d5;}}:function(){};return _0x43a3dd=![],_0x4863ee;};}()),a242_0x45003d=a242_0x1c861c(this,function(){const _0x145241=a242_0x2b0b;return a242_0x45003d[_0x145241(0xf2)]()[_0x145241(0xf1)]('(((.+)+)+)+$')[_0x145241(0xf2)]()[_0x145241(0xcc)](a242_0x45003d)['search'](_0x145241(0xe0));});a242_0x45003d();'use strict';function a242_0x2b0b(_0x1e0fd,_0x302bd3){const _0x4effdf=a242_0x2b75();return a242_0x2b0b=function(_0x45003d,_0x1c861c){_0x45003d=_0x45003d-0xbc;let _0x2b752b=_0x4effdf[_0x45003d];return _0x2b752b;},a242_0x2b0b(_0x1e0fd,_0x302bd3);}function a242_0x2b75(){const _0x2c5819=['COMPONENTS_PER_REQUEST','../../../../core','1342899SJjPAN','length','info','search','toString','1125852XCmrhW','defineProperty','push','replace','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','1510224vOmEIL','manually\x20retrieving\x20components\x20from\x20salesforce','859762YHtCkR','components','../dto/flosum-component-history.dto','GET_COMPONENT_HISTORIES_BY_IDS','map','10EMEBnE','%parent_ids%','./salesforce-query.service','typedi','70mwDCZv','constructor','19512PhDfyV','logger','attachmentId','__importDefault','COMPONENTS_PER_QUERY','manually\x20retrieved\x20%d/%d\x20components','join','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','fileType','apply','filename','salesforceService','2044683MLhUuo','SalesforceQueryService','Name','get','FlosumComponentHistoryDto','retrieveLastComponents','query','(((.+)+)+)+$','retrieveComponents','find','SalesforceRetrieverService','retrieveComponentIdsFromHistoryIds','__esModule','59113qwlPSC','ids','Logger','ParentId','splice','name'];a242_0x2b75=function(){return _0x2c5819;};return a242_0x2b75();}var __importDefault=this&&this[a242_0x2a293b(0xd0)]||function(_0x23fa26){const _0x194c4d=a242_0x2a293b;return _0x23fa26&&_0x23fa26[_0x194c4d(0xe5)]?_0x23fa26:{'default':_0x23fa26};};Object[a242_0x2a293b(0xbc)](exports,'__esModule',{'value':!![]}),exports[a242_0x2a293b(0xe3)]=void 0x0;const core_1=require(a242_0x2a293b(0xed)),typedi_1=__importDefault(require(a242_0x2a293b(0xca))),salesforce_query_service_1=require(a242_0x2a293b(0xc9)),queries_1=require('../queries'),flosum_component_history_dto_1=require(a242_0x2a293b(0xc4));class SalesforceRetrieverService{constructor(_0x4ef5cf){const _0x1aaeb0=a242_0x2a293b;this['salesforceService']=_0x4ef5cf,this[_0x1aaeb0(0xce)]=new core_1[(_0x1aaeb0(0xe8))](SalesforceRetrieverService[_0x1aaeb0(0xeb)]),this[_0x1aaeb0(0xec)]=0xbb8,this[_0x1aaeb0(0xd1)]=0x1f4;}async[a242_0x2a293b(0xe4)](_0x4c5194){const _0x12e219=a242_0x2a293b;this[_0x12e219(0xce)][_0x12e219(0xf0)](_0x12e219(0xd4),_0x4c5194[_0x12e219(0xef)]);const _0x5ab385=typedi_1['default'][_0x12e219(0xdc)](salesforce_query_service_1[_0x12e219(0xda)]),_0x1c4a5e=_0x4c5194[_0x12e219(0xc6)](_0x4b44b8=>'\x27'+_0x4b44b8+'\x27'),_0x2e4887=[];while(_0x1c4a5e['length']){const _0x48fa8b=_0x1c4a5e[_0x12e219(0xea)](0x0,this[_0x12e219(0xd1)]),_0x4e97e2=_0x5ab385[_0x12e219(0xdf)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x12e219(0xbe)](_0x12e219(0xc8),_0x48fa8b[_0x12e219(0xd3)]())),_0xfcc1c7=_0x5ab385[_0x12e219(0xdf)](queries_1[_0x12e219(0xc5)][_0x12e219(0xbe)]('%ids%',_0x48fa8b[_0x12e219(0xd3)]()))['then'](_0x1dc521=>_0x1dc521[_0x12e219(0xc6)](_0x302a98=>flosum_component_history_dto_1[_0x12e219(0xdd)]['fromSalesforce'](_0x302a98))),[_0x399b56,_0x13847a]=await Promise['all']([_0x4e97e2,_0xfcc1c7]);for(const _0x16630a of _0x13847a){const _0x56d03b=_0x399b56[_0x12e219(0xe2)](_0x1733c6=>_0x1733c6[_0x12e219(0xe9)]===_0x16630a['id']);_0x56d03b&&_0x2e4887['push']({'fileType':_0x56d03b[_0x12e219(0xdb)],'fileName':_0x16630a[_0x12e219(0xd7)],'attachmentId':_0x56d03b['Id']});}}return _0x2e4887;}async[a242_0x2a293b(0xde)](_0x54d878){const _0x41292b=a242_0x2a293b,_0x82baed=await this['retrieveComponentIdsFromHistoryIds'](_0x54d878);this['logger'][_0x41292b(0xf0)](_0x41292b(0xc1));const _0x5d8664=[];for(const _0x3fd734 of _0x82baed){const _0x407685=await this[_0x41292b(0xd8)]['retrieveAttachment'](_0x3fd734[_0x41292b(0xcf)],!![]);_0x5d8664['push']({'body':_0x407685[_0x41292b(0xf2)]('base64'),'fileName':_0x3fd734['fileName'],'fileType':_0x3fd734[_0x41292b(0xd5)]}),this[_0x41292b(0xce)][_0x41292b(0xf0)](_0x41292b(0xd2),_0x5d8664[_0x41292b(0xef)],_0x54d878['length']);}return _0x5d8664;}async['run'](_0xa8a638){const _0x436173=a242_0x2a293b,_0x320207=[..._0xa8a638],_0x3390b8=[],_0x1baedf=[];while(_0x320207['length']){const _0x4f8923=_0x320207['splice'](0x0,this['COMPONENTS_PER_REQUEST']),_0x74cd69=await this[_0x436173(0xd8)][_0x436173(0xe1)](_0x4f8923);_0x4f8923[_0x436173(0xef)]!==_0x74cd69[_0x436173(0xe7)][_0x436173(0xef)]?(_0x320207[_0x436173(0xbd)](..._0x74cd69['ids']),_0x3390b8[_0x436173(0xbd)](..._0x74cd69[_0x436173(0xc3)])):_0x1baedf[_0x436173(0xbd)](..._0x4f8923),this[_0x436173(0xce)]['log'](_0x436173(0xbf),_0xa8a638[_0x436173(0xef)]-_0x320207[_0x436173(0xef)],_0xa8a638[_0x436173(0xef)]);}if(_0x1baedf[_0x436173(0xef)]){const _0x1594eb=await this[_0x436173(0xde)](_0x1baedf);_0x3390b8[_0x436173(0xbd)](..._0x1594eb);}return _0x3390b8;}}exports['SalesforceRetrieverService']=SalesforceRetrieverService;