const a253_0x2b2ee5=a253_0x18b3;(function(_0x36658f,_0x4917cc){const _0xfdf4d3=a253_0x18b3,_0x1931ef=_0x36658f();while(!![]){try{const _0x3b42b9=parseInt(_0xfdf4d3(0x19c))/0x1*(-parseInt(_0xfdf4d3(0x18a))/0x2)+parseInt(_0xfdf4d3(0x170))/0x3*(-parseInt(_0xfdf4d3(0x17f))/0x4)+-parseInt(_0xfdf4d3(0x194))/0x5+parseInt(_0xfdf4d3(0x199))/0x6+parseInt(_0xfdf4d3(0x183))/0x7*(-parseInt(_0xfdf4d3(0x176))/0x8)+-parseInt(_0xfdf4d3(0x192))/0x9+parseInt(_0xfdf4d3(0x182))/0xa*(parseInt(_0xfdf4d3(0x1a0))/0xb);if(_0x3b42b9===_0x4917cc)break;else _0x1931ef['push'](_0x1931ef['shift']());}catch(_0x4a87f1){_0x1931ef['push'](_0x1931ef['shift']());}}}(a253_0x5bee,0x24f24));const a253_0x3fe235=(function(){let _0x52a34b=!![];return function(_0x59b917,_0x3f157f){const _0x380de1=_0x52a34b?function(){if(_0x3f157f){const _0x3bab81=_0x3f157f['apply'](_0x59b917,arguments);return _0x3f157f=null,_0x3bab81;}}:function(){};return _0x52a34b=![],_0x380de1;};}()),a253_0x1d3cc4=a253_0x3fe235(this,function(){const _0x884579=a253_0x18b3;return a253_0x1d3cc4[_0x884579(0x18b)]()[_0x884579(0x173)]('(((.+)+)+)+$')[_0x884579(0x18b)]()[_0x884579(0x179)](a253_0x1d3cc4)[_0x884579(0x173)](_0x884579(0x184));});function a253_0x5bee(){const _0x13d4cd=['replace','push','COMPONENTS_PER_QUERY','2714976iFuDwD','fromSalesforce','324715pSkpyb','run','name','components','info','1417848uqgfUq','./salesforce-query.service','retrieveComponents','224949sfeuSv','map','logger','../dto/flosum-component-history.dto','11ufpXfS','../../../../core','join','filename','fileType','COMPONENTS_PER_REQUEST','retrieveAttachment','salesforceService','all','SalesforceRetrieverService','15IqJTic','query','../queries','search','Manually\x20retrieved\x20%d/%d\x20components','Name','128ZOzBVI','get','then','constructor','length','defineProperty','retrieveLastComponents','__esModule','splice','92368bGtVVi','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','%parent_ids%','6275440mUzBoS','2408dtoHvq','(((.+)+)+)+$','GET_COMPONENT_HISTORIES_BY_IDS','fileName','Retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','Logger','ids','2cyPOHy','toString','SalesforceQueryService','default','FlosumComponentHistoryDto'];a253_0x5bee=function(){return _0x13d4cd;};return a253_0x5bee();}a253_0x1d3cc4();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x25b1fd){const _0xcf7711=a253_0x18b3;return _0x25b1fd&&_0x25b1fd[_0xcf7711(0x17d)]?_0x25b1fd:{'default':_0x25b1fd};};function a253_0x18b3(_0x13f9d9,_0x308468){const _0x388503=a253_0x5bee();return a253_0x18b3=function(_0x1d3cc4,_0x3fe235){_0x1d3cc4=_0x1d3cc4-0x169;let _0x5bee15=_0x388503[_0x1d3cc4];return _0x5bee15;},a253_0x18b3(_0x13f9d9,_0x308468);}Object[a253_0x2b2ee5(0x17b)](exports,a253_0x2b2ee5(0x17d),{'value':!![]}),exports['SalesforceRetrieverService']=void 0x0;const core_1=require(a253_0x2b2ee5(0x1a1)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require(a253_0x2b2ee5(0x19a)),queries_1=require(a253_0x2b2ee5(0x172)),flosum_component_history_dto_1=require(a253_0x2b2ee5(0x19f));class SalesforceRetrieverService{constructor(_0x55c33b){const _0x4df926=a253_0x2b2ee5;this[_0x4df926(0x16d)]=_0x55c33b,this[_0x4df926(0x19e)]=new core_1[(_0x4df926(0x188))](SalesforceRetrieverService[_0x4df926(0x196)]),this[_0x4df926(0x16b)]=0xbb8,this[_0x4df926(0x191)]=0x1f4;}async['retrieveComponentIdsFromHistoryIds'](_0x5cd90c){const _0x5dd53a=a253_0x2b2ee5;this['logger'][_0x5dd53a(0x198)]('Manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x5cd90c[_0x5dd53a(0x17a)]);const _0x254cd2=typedi_1[_0x5dd53a(0x18d)][_0x5dd53a(0x177)](salesforce_query_service_1[_0x5dd53a(0x18c)]),_0x64d8e7=_0x5cd90c[_0x5dd53a(0x19d)](_0x104f4e=>'\x27'+_0x104f4e+'\x27'),_0x46f955=[];while(_0x64d8e7[_0x5dd53a(0x17a)]){const _0x127658=_0x64d8e7['splice'](0x0,this[_0x5dd53a(0x191)]),_0x410a9a=_0x254cd2[_0x5dd53a(0x171)](queries_1[_0x5dd53a(0x180)]['replace'](_0x5dd53a(0x181),_0x127658[_0x5dd53a(0x1a2)]())),_0x263e5c=_0x254cd2[_0x5dd53a(0x171)](queries_1[_0x5dd53a(0x185)][_0x5dd53a(0x18f)]('%ids%',_0x127658[_0x5dd53a(0x1a2)]()))[_0x5dd53a(0x178)](_0x404c22=>_0x404c22[_0x5dd53a(0x19d)](_0x547462=>flosum_component_history_dto_1[_0x5dd53a(0x18e)][_0x5dd53a(0x193)](_0x547462))),[_0x4aa8cf,_0x4988a2]=await Promise[_0x5dd53a(0x16e)]([_0x410a9a,_0x263e5c]);for(const _0x402ba4 of _0x4988a2){const _0x13dc24=_0x4aa8cf['find'](_0x2844d0=>_0x2844d0['ParentId']===_0x402ba4['id']);_0x13dc24&&_0x46f955[_0x5dd53a(0x190)]({'fileType':_0x13dc24[_0x5dd53a(0x175)],'fileName':_0x402ba4[_0x5dd53a(0x169)],'attachmentId':_0x13dc24['Id']});}}return _0x46f955;}async['retrieveLastComponents'](_0x59f58d){const _0x5d1d0d=a253_0x2b2ee5,_0x4da9d5=await this['retrieveComponentIdsFromHistoryIds'](_0x59f58d);this[_0x5d1d0d(0x19e)][_0x5d1d0d(0x198)]('Manually\x20retrieving\x20components\x20from\x20salesforce');const _0x5bec66=[];for(const _0x143f12 of _0x4da9d5){const _0x5e3f5f=await this['salesforceService'][_0x5d1d0d(0x16c)](_0x143f12['attachmentId'],!![]);_0x5bec66[_0x5d1d0d(0x190)]({'body':_0x5e3f5f[_0x5d1d0d(0x18b)]('base64'),'fileName':_0x143f12[_0x5d1d0d(0x186)],'fileType':_0x143f12[_0x5d1d0d(0x16a)]}),this[_0x5d1d0d(0x19e)][_0x5d1d0d(0x198)](_0x5d1d0d(0x174),_0x5bec66[_0x5d1d0d(0x17a)],_0x59f58d[_0x5d1d0d(0x17a)]);}return _0x5bec66;}async[a253_0x2b2ee5(0x195)](_0x4f5a28){const _0x31522a=a253_0x2b2ee5,_0xba6c6=[..._0x4f5a28],_0x41c621=[],_0x57aadf=[];while(_0xba6c6[_0x31522a(0x17a)]){const _0x2f629b=_0xba6c6[_0x31522a(0x17e)](0x0,this['COMPONENTS_PER_REQUEST']),_0x48e317=await this['salesforceService'][_0x31522a(0x19b)](_0x2f629b);_0x2f629b[_0x31522a(0x17a)]!==_0x48e317[_0x31522a(0x189)][_0x31522a(0x17a)]?(_0xba6c6['push'](..._0x48e317[_0x31522a(0x189)]),_0x41c621[_0x31522a(0x190)](..._0x48e317[_0x31522a(0x197)])):_0x57aadf[_0x31522a(0x190)](..._0x2f629b),this[_0x31522a(0x19e)]['log'](_0x31522a(0x187),_0x4f5a28[_0x31522a(0x17a)]-_0xba6c6['length'],_0x4f5a28['length']);}if(_0x57aadf[_0x31522a(0x17a)]){const _0x5b8759=await this[_0x31522a(0x17c)](_0x57aadf);_0x41c621[_0x31522a(0x190)](..._0x5b8759);}return _0x41c621;}}exports[a253_0x2b2ee5(0x16f)]=SalesforceRetrieverService;