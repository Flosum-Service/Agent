const a252_0x1bdf43=a252_0x51c0;function a252_0x57fb(){const _0x4d6965=['length','4tslOPC','56168JABbmV','fromSalesforce','logger','retrieveComponents','apply','retrieveComponentIdsFromHistoryIds','(((.+)+)+)+$','COMPONENTS_PER_QUERY','search','default','base64','constructor','toString','211453vylZbt','14939280kICclj','SalesforceRetrieverService','Manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','defineProperty','%parent_ids%','splice','fileName','join','push','filename','attachmentId','salesforceService','Manually\x20retrieved\x20%d/%d\x20components','__importDefault','replace','then','retrieveAttachment','26297dnymcj','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','2416248TdUWpr','retrieveLastComponents','1365183OmKXKU','find','Retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','get','name','10wMhqpK','__esModule','./salesforce-query.service','Logger','12MvDAZN','1011702YhMKLj','all','../queries','ids','136ZXtwHK','map','../../../../core','5tUNQXX','../dto/flosum-component-history.dto','info'];a252_0x57fb=function(){return _0x4d6965;};return a252_0x57fb();}(function(_0x4af133,_0x36d54c){const _0x4ade4b=a252_0x51c0,_0x59267c=_0x4af133();while(!![]){try{const _0x118753=parseInt(_0x4ade4b(0xcd))/0x1*(-parseInt(_0x4ade4b(0xda))/0x2)+-parseInt(_0x4ade4b(0xcf))/0x3*(parseInt(_0x4ade4b(0xe6))/0x4)+parseInt(_0x4ade4b(0xe2))/0x5*(-parseInt(_0x4ade4b(0xdb))/0x6)+parseInt(_0x4ade4b(0xe7))/0x7*(parseInt(_0x4ade4b(0xdf))/0x8)+parseInt(_0x4ade4b(0xd1))/0x9*(parseInt(_0x4ade4b(0xd6))/0xa)+parseInt(_0x4ade4b(0xf4))/0xb+parseInt(_0x4ade4b(0xbc))/0xc;if(_0x118753===_0x36d54c)break;else _0x59267c['push'](_0x59267c['shift']());}catch(_0x8abd71){_0x59267c['push'](_0x59267c['shift']());}}}(a252_0x57fb,0x66a5b));const a252_0x4003b8=(function(){let _0x34fb42=!![];return function(_0x3653a2,_0x5df86b){const _0x64e66d=_0x34fb42?function(){const _0x4e71f8=a252_0x51c0;if(_0x5df86b){const _0x4629b5=_0x5df86b[_0x4e71f8(0xeb)](_0x3653a2,arguments);return _0x5df86b=null,_0x4629b5;}}:function(){};return _0x34fb42=![],_0x64e66d;};}()),a252_0x44870d=a252_0x4003b8(this,function(){const _0x476020=a252_0x51c0;return a252_0x44870d[_0x476020(0xf3)]()[_0x476020(0xef)](_0x476020(0xed))[_0x476020(0xf3)]()[_0x476020(0xf2)](a252_0x44870d)[_0x476020(0xef)](_0x476020(0xed));});a252_0x44870d();'use strict';var __importDefault=this&&this[a252_0x1bdf43(0xc9)]||function(_0x35ce8e){const _0x32e816=a252_0x1bdf43;return _0x35ce8e&&_0x35ce8e[_0x32e816(0xd7)]?_0x35ce8e:{'default':_0x35ce8e};};function a252_0x51c0(_0x39977b,_0x4040c0){const _0x52b799=a252_0x57fb();return a252_0x51c0=function(_0x44870d,_0x4003b8){_0x44870d=_0x44870d-0xbc;let _0x57fb11=_0x52b799[_0x44870d];return _0x57fb11;},a252_0x51c0(_0x39977b,_0x4040c0);}Object[a252_0x1bdf43(0xbf)](exports,a252_0x1bdf43(0xd7),{'value':!![]}),exports[a252_0x1bdf43(0xbd)]=void 0x0;const core_1=require(a252_0x1bdf43(0xe1)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require(a252_0x1bdf43(0xd8)),queries_1=require(a252_0x1bdf43(0xdd)),flosum_component_history_dto_1=require(a252_0x1bdf43(0xe3));class SalesforceRetrieverService{constructor(_0x58badd){const _0x6d2bcf=a252_0x1bdf43;this[_0x6d2bcf(0xc7)]=_0x58badd,this[_0x6d2bcf(0xe9)]=new core_1[(_0x6d2bcf(0xd9))](SalesforceRetrieverService[_0x6d2bcf(0xd5)]),this['COMPONENTS_PER_REQUEST']=0xbb8,this[_0x6d2bcf(0xee)]=0x1f4;}async[a252_0x1bdf43(0xec)](_0x41a6b7){const _0x17efdb=a252_0x1bdf43;this[_0x17efdb(0xe9)][_0x17efdb(0xe4)](_0x17efdb(0xbe),_0x41a6b7[_0x17efdb(0xe5)]);const _0x114c64=typedi_1[_0x17efdb(0xf0)][_0x17efdb(0xd4)](salesforce_query_service_1['SalesforceQueryService']),_0x535792=_0x41a6b7[_0x17efdb(0xe0)](_0x1a1dd8=>'\x27'+_0x1a1dd8+'\x27'),_0x4b528d=[];while(_0x535792[_0x17efdb(0xe5)]){const _0x41ef51=_0x535792[_0x17efdb(0xc1)](0x0,this['COMPONENTS_PER_QUERY']),_0x5deba5=_0x114c64['query'](queries_1[_0x17efdb(0xce)][_0x17efdb(0xca)](_0x17efdb(0xc0),_0x41ef51[_0x17efdb(0xc3)]())),_0x19b693=_0x114c64['query'](queries_1['GET_COMPONENT_HISTORIES_BY_IDS'][_0x17efdb(0xca)]('%ids%',_0x41ef51[_0x17efdb(0xc3)]()))[_0x17efdb(0xcb)](_0x420961=>_0x420961[_0x17efdb(0xe0)](_0x43c21d=>flosum_component_history_dto_1['FlosumComponentHistoryDto'][_0x17efdb(0xe8)](_0x43c21d))),[_0x596bb7,_0x9d36ba]=await Promise[_0x17efdb(0xdc)]([_0x5deba5,_0x19b693]);for(const _0x380c93 of _0x9d36ba){const _0x5301cc=_0x596bb7[_0x17efdb(0xd2)](_0x136d3a=>_0x136d3a['ParentId']===_0x380c93['id']);_0x5301cc&&_0x4b528d[_0x17efdb(0xc4)]({'fileType':_0x5301cc['Name'],'fileName':_0x380c93[_0x17efdb(0xc5)],'attachmentId':_0x5301cc['Id']});}}return _0x4b528d;}async[a252_0x1bdf43(0xd0)](_0x918d18){const _0x3fd984=a252_0x1bdf43,_0x4363d0=await this[_0x3fd984(0xec)](_0x918d18);this[_0x3fd984(0xe9)][_0x3fd984(0xe4)]('Manually\x20retrieving\x20components\x20from\x20salesforce');const _0x3ccce2=[];for(const _0x1dae3c of _0x4363d0){const _0x10dd02=await this['salesforceService'][_0x3fd984(0xcc)](_0x1dae3c[_0x3fd984(0xc6)],!![]);_0x3ccce2[_0x3fd984(0xc4)]({'body':_0x10dd02[_0x3fd984(0xf3)](_0x3fd984(0xf1)),'fileName':_0x1dae3c[_0x3fd984(0xc2)],'fileType':_0x1dae3c['fileType']}),this[_0x3fd984(0xe9)][_0x3fd984(0xe4)](_0x3fd984(0xc8),_0x3ccce2[_0x3fd984(0xe5)],_0x918d18['length']);}return _0x3ccce2;}async['run'](_0x3df01e){const _0x1915c3=a252_0x1bdf43,_0x44f0f0=[..._0x3df01e],_0x2e4986=[],_0x99fa9c=[];while(_0x44f0f0[_0x1915c3(0xe5)]){const _0x4041e7=_0x44f0f0[_0x1915c3(0xc1)](0x0,this['COMPONENTS_PER_REQUEST']),_0x28d8ac=await this[_0x1915c3(0xc7)][_0x1915c3(0xea)](_0x4041e7);_0x4041e7[_0x1915c3(0xe5)]!==_0x28d8ac[_0x1915c3(0xde)][_0x1915c3(0xe5)]?(_0x44f0f0['push'](..._0x28d8ac['ids']),_0x2e4986['push'](..._0x28d8ac['components'])):_0x99fa9c[_0x1915c3(0xc4)](..._0x4041e7),this[_0x1915c3(0xe9)]['log'](_0x1915c3(0xd3),_0x3df01e[_0x1915c3(0xe5)]-_0x44f0f0[_0x1915c3(0xe5)],_0x3df01e[_0x1915c3(0xe5)]);}if(_0x99fa9c[_0x1915c3(0xe5)]){const _0x1b1702=await this[_0x1915c3(0xd0)](_0x99fa9c);_0x2e4986[_0x1915c3(0xc4)](..._0x1b1702);}return _0x2e4986;}}exports[a252_0x1bdf43(0xbd)]=SalesforceRetrieverService;