const a237_0x14dccd=a237_0x20f1;(function(_0xb56ad9,_0x22b409){const _0x30afdd=a237_0x20f1,_0x41ac9c=_0xb56ad9();while(!![]){try{const _0x2e9803=-parseInt(_0x30afdd(0x1d8))/0x1*(parseInt(_0x30afdd(0x1bb))/0x2)+parseInt(_0x30afdd(0x1e4))/0x3+-parseInt(_0x30afdd(0x1bd))/0x4*(parseInt(_0x30afdd(0x1d0))/0x5)+parseInt(_0x30afdd(0x1e0))/0x6+-parseInt(_0x30afdd(0x1db))/0x7+-parseInt(_0x30afdd(0x1c3))/0x8+parseInt(_0x30afdd(0x1c6))/0x9*(parseInt(_0x30afdd(0x1d2))/0xa);if(_0x2e9803===_0x22b409)break;else _0x41ac9c['push'](_0x41ac9c['shift']());}catch(_0x5adfec){_0x41ac9c['push'](_0x41ac9c['shift']());}}}(a237_0x29bf,0xa442a));const a237_0xa1b499=(function(){let _0x1d2a34=!![];return function(_0x2bdb,_0x51a93e){const _0x4a6852=_0x1d2a34?function(){if(_0x51a93e){const _0x23302b=_0x51a93e['apply'](_0x2bdb,arguments);return _0x51a93e=null,_0x23302b;}}:function(){};return _0x1d2a34=![],_0x4a6852;};}()),a237_0x2d582a=a237_0xa1b499(this,function(){const _0x3251e3=a237_0x20f1;return a237_0x2d582a['toString']()[_0x3251e3(0x1b6)](_0x3251e3(0x1df))[_0x3251e3(0x1c1)]()['constructor'](a237_0x2d582a)['search'](_0x3251e3(0x1df));});a237_0x2d582a();'use strict';function a237_0x20f1(_0x274373,_0x2bef32){const _0x20c8d3=a237_0x29bf();return a237_0x20f1=function(_0x2d582a,_0xa1b499){_0x2d582a=_0x2d582a-0x1b5;let _0x29bf9b=_0x20c8d3[_0x2d582a];return _0x29bf9b;},a237_0x20f1(_0x274373,_0x2bef32);}var __importDefault=this&&this[a237_0x14dccd(0x1b5)]||function(_0xd23391){return _0xd23391&&_0xd23391['__esModule']?_0xd23391:{'default':_0xd23391};};Object[a237_0x14dccd(0x1e9)](exports,a237_0x14dccd(0x1c2),{'value':!![]}),exports['SalesforceRetrieverService']=void 0x0;function a237_0x29bf(){const _0x214335=['ids','3678213zUYmzY','filename','retrieveAttachment','get','(((.+)+)+)+$','5745204tVCzmE','attachmentId','find','log','3303951PxcuKq','replace','../dto/flosum-component-history.dto','COMPONENTS_PER_QUERY','SalesforceRetrieverService','defineProperty','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','GET_COMPONENT_HISTORIES_BY_IDS','__importDefault','search','Logger','COMPONENTS_PER_REQUEST','manually\x20retrieving\x20components\x20from\x20salesforce','default','178zuXEtT','fileName','3152CNpWJE','logger','manually\x20retrieved\x20%d/%d\x20components','%ids%','toString','__esModule','8721368JOrLtZ','fileType','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','9xJSiYh','../queries','SalesforceQueryService','query','retrieveLastComponents','all','info','push','fromSalesforce','run','5745YXdPVl','splice','15846290WtMIAF','map','FlosumComponentHistoryDto','%parent_ids%','length','typedi','5052IsGhVj','salesforceService'];a237_0x29bf=function(){return _0x214335;};return a237_0x29bf();}const core_1=require('../../../../core'),typedi_1=__importDefault(require(a237_0x14dccd(0x1d7))),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a237_0x14dccd(0x1c7)),flosum_component_history_dto_1=require(a237_0x14dccd(0x1e6));class SalesforceRetrieverService{constructor(_0x48b188){const _0x12e33c=a237_0x14dccd;this[_0x12e33c(0x1d9)]=_0x48b188,this['logger']=new core_1[(_0x12e33c(0x1b7))](SalesforceRetrieverService['name']),this[_0x12e33c(0x1b8)]=0xbb8,this[_0x12e33c(0x1e7)]=0x1f4;}async['retrieveComponentIdsFromHistoryIds'](_0x29ad9d){const _0x107f98=a237_0x14dccd;this[_0x107f98(0x1be)][_0x107f98(0x1cc)](_0x107f98(0x1ea),_0x29ad9d[_0x107f98(0x1d6)]);const _0xc3d922=typedi_1[_0x107f98(0x1ba)][_0x107f98(0x1de)](salesforce_query_service_1[_0x107f98(0x1c8)]),_0x394d39=_0x29ad9d[_0x107f98(0x1d3)](_0x4871e6=>'\x27'+_0x4871e6+'\x27'),_0x16be8b=[];while(_0x394d39['length']){const _0x543e63=_0x394d39['splice'](0x0,this[_0x107f98(0x1e7)]),_0x40efa0=_0xc3d922[_0x107f98(0x1c9)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x107f98(0x1e5)](_0x107f98(0x1d5),_0x543e63['join']())),_0x56842c=_0xc3d922[_0x107f98(0x1c9)](queries_1[_0x107f98(0x1eb)]['replace'](_0x107f98(0x1c0),_0x543e63['join']()))['then'](_0x26f761=>_0x26f761[_0x107f98(0x1d3)](_0x1dc258=>flosum_component_history_dto_1[_0x107f98(0x1d4)][_0x107f98(0x1ce)](_0x1dc258))),[_0xe969a6,_0x513965]=await Promise[_0x107f98(0x1cb)]([_0x40efa0,_0x56842c]);for(const _0x32d43d of _0x513965){const _0xeb70=_0xe969a6[_0x107f98(0x1e2)](_0x1ce7d0=>_0x1ce7d0['ParentId']===_0x32d43d['id']);_0xeb70&&_0x16be8b[_0x107f98(0x1cd)]({'fileType':_0xeb70['Name'],'fileName':_0x32d43d[_0x107f98(0x1dc)],'attachmentId':_0xeb70['Id']});}}return _0x16be8b;}async[a237_0x14dccd(0x1ca)](_0x1ff405){const _0x1c3250=a237_0x14dccd,_0x4f132e=await this['retrieveComponentIdsFromHistoryIds'](_0x1ff405);this['logger'][_0x1c3250(0x1cc)](_0x1c3250(0x1b9));const _0x174632=[];for(const _0x31b8fb of _0x4f132e){const _0x3b6328=await this[_0x1c3250(0x1d9)][_0x1c3250(0x1dd)](_0x31b8fb[_0x1c3250(0x1e1)],!![]);_0x174632['push']({'body':_0x3b6328[_0x1c3250(0x1c1)]('base64'),'fileName':_0x31b8fb[_0x1c3250(0x1bc)],'fileType':_0x31b8fb[_0x1c3250(0x1c4)]}),this[_0x1c3250(0x1be)]['info'](_0x1c3250(0x1bf),_0x174632[_0x1c3250(0x1d6)],_0x1ff405[_0x1c3250(0x1d6)]);}return _0x174632;}async[a237_0x14dccd(0x1cf)](_0x135691){const _0xfa9709=a237_0x14dccd,_0x36aa71=[..._0x135691],_0x4c111f=[],_0x2c9d4b=[];while(_0x36aa71['length']){const _0x159d23=_0x36aa71[_0xfa9709(0x1d1)](0x0,this[_0xfa9709(0x1b8)]),_0x3973ab=await this[_0xfa9709(0x1d9)]['retrieveComponents'](_0x159d23);_0x159d23[_0xfa9709(0x1d6)]!==_0x3973ab[_0xfa9709(0x1da)][_0xfa9709(0x1d6)]?(_0x36aa71[_0xfa9709(0x1cd)](..._0x3973ab[_0xfa9709(0x1da)]),_0x4c111f['push'](..._0x3973ab['components'])):_0x2c9d4b[_0xfa9709(0x1cd)](..._0x159d23),this[_0xfa9709(0x1be)][_0xfa9709(0x1e3)](_0xfa9709(0x1c5),_0x135691[_0xfa9709(0x1d6)]-_0x36aa71[_0xfa9709(0x1d6)],_0x135691['length']);}if(_0x2c9d4b['length']){const _0x3e34c0=await this['retrieveLastComponents'](_0x2c9d4b);_0x4c111f[_0xfa9709(0x1cd)](..._0x3e34c0);}return _0x4c111f;}}exports[a237_0x14dccd(0x1e8)]=SalesforceRetrieverService;