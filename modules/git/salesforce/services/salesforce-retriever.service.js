const a237_0x212cee=a237_0x52df;(function(_0x232d11,_0x2a2a57){const _0x4d713d=a237_0x52df,_0x372d87=_0x232d11();while(!![]){try{const _0x36dc78=parseInt(_0x4d713d(0x13a))/0x1+-parseInt(_0x4d713d(0x15f))/0x2*(parseInt(_0x4d713d(0x147))/0x3)+parseInt(_0x4d713d(0x165))/0x4*(parseInt(_0x4d713d(0x142))/0x5)+parseInt(_0x4d713d(0x152))/0x6+-parseInt(_0x4d713d(0x154))/0x7*(parseInt(_0x4d713d(0x157))/0x8)+parseInt(_0x4d713d(0x146))/0x9*(-parseInt(_0x4d713d(0x13b))/0xa)+parseInt(_0x4d713d(0x14c))/0xb*(parseInt(_0x4d713d(0x14b))/0xc);if(_0x36dc78===_0x2a2a57)break;else _0x372d87['push'](_0x372d87['shift']());}catch(_0x21bcfe){_0x372d87['push'](_0x372d87['shift']());}}}(a237_0x42fb,0xb73a7));function a237_0x52df(_0x1ebf92,_0x51c8ea){const _0x360124=a237_0x42fb();return a237_0x52df=function(_0x1efe6,_0x6c19e9){_0x1efe6=_0x1efe6-0x136;let _0x42fb75=_0x360124[_0x1efe6];return _0x42fb75;},a237_0x52df(_0x1ebf92,_0x51c8ea);}const a237_0x6c19e9=(function(){let _0x4c7a5f=!![];return function(_0x103f0f,_0x4e2755){const _0x2c7a0e=_0x4c7a5f?function(){const _0x43c3b7=a237_0x52df;if(_0x4e2755){const _0x37da10=_0x4e2755[_0x43c3b7(0x14d)](_0x103f0f,arguments);return _0x4e2755=null,_0x37da10;}}:function(){};return _0x4c7a5f=![],_0x2c7a0e;};}()),a237_0x1efe6=a237_0x6c19e9(this,function(){const _0x3f1202=a237_0x52df;return a237_0x1efe6[_0x3f1202(0x144)]()[_0x3f1202(0x140)]('(((.+)+)+)+$')[_0x3f1202(0x144)]()[_0x3f1202(0x136)](a237_0x1efe6)[_0x3f1202(0x140)]('(((.+)+)+)+$');});a237_0x1efe6();function a237_0x42fb(){const _0xc4542f=['replace','run','typedi','constructor','name','salesforceService','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','1356161MiAsqv','20vwmyJX','components','map','log','SalesforceRetrieverService','search','base64','16390KKSlNp','attachmentId','toString','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','4504869NTHEuF','21xHczEz','info','retrieveAttachment','./salesforce-query.service','12952404tDIxOR','11HJOTRb','apply','../../../../core','splice','default','Logger','4992144JXXsLF','%parent_ids%','49Vhmpku','COMPONENTS_PER_REQUEST','__esModule','1411168EbzuJu','then','../queries','retrieveComponentIdsFromHistoryIds','find','../dto/flosum-component-history.dto','filename','logger','199286KkcUFI','push','all','COMPONENTS_PER_QUERY','fileType','length','508MyZusz','%ids%','retrieveComponents','manually\x20retrieved\x20%d/%d\x20components','join','SalesforceQueryService','FlosumComponentHistoryDto','__importDefault'];a237_0x42fb=function(){return _0xc4542f;};return a237_0x42fb();}'use strict';var __importDefault=this&&this[a237_0x212cee(0x16c)]||function(_0x561fb7){const _0x508f05=a237_0x212cee;return _0x561fb7&&_0x561fb7[_0x508f05(0x156)]?_0x561fb7:{'default':_0x561fb7};};Object['defineProperty'](exports,a237_0x212cee(0x156),{'value':!![]}),exports[a237_0x212cee(0x13f)]=void 0x0;const core_1=require(a237_0x212cee(0x14e)),typedi_1=__importDefault(require(a237_0x212cee(0x16f))),salesforce_query_service_1=require(a237_0x212cee(0x14a)),queries_1=require(a237_0x212cee(0x159)),flosum_component_history_dto_1=require(a237_0x212cee(0x15c));class SalesforceRetrieverService{constructor(_0x484459){const _0x17cc73=a237_0x212cee;this[_0x17cc73(0x138)]=_0x484459,this[_0x17cc73(0x15e)]=new core_1[(_0x17cc73(0x151))](SalesforceRetrieverService[_0x17cc73(0x137)]),this['COMPONENTS_PER_REQUEST']=0xbb8,this[_0x17cc73(0x162)]=0x1f4;}async[a237_0x212cee(0x15a)](_0xf7d2bb){const _0x13a1fc=a237_0x212cee;this['logger'][_0x13a1fc(0x148)](_0x13a1fc(0x139),_0xf7d2bb['length']);const _0x4539f4=typedi_1[_0x13a1fc(0x150)]['get'](salesforce_query_service_1[_0x13a1fc(0x16a)]),_0x24d26d=_0xf7d2bb[_0x13a1fc(0x13d)](_0x4216f9=>'\x27'+_0x4216f9+'\x27'),_0x1e4fdb=[];while(_0x24d26d['length']){const _0x1e0da1=_0x24d26d[_0x13a1fc(0x14f)](0x0,this[_0x13a1fc(0x162)]),_0x25049d=_0x4539f4['query'](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x13a1fc(0x16d)](_0x13a1fc(0x153),_0x1e0da1[_0x13a1fc(0x169)]())),_0x20a12f=_0x4539f4['query'](queries_1['GET_COMPONENT_HISTORIES_BY_IDS']['replace'](_0x13a1fc(0x166),_0x1e0da1['join']()))[_0x13a1fc(0x158)](_0xbeecb2=>_0xbeecb2[_0x13a1fc(0x13d)](_0x2104fb=>flosum_component_history_dto_1[_0x13a1fc(0x16b)]['fromSalesforce'](_0x2104fb))),[_0x14d03a,_0xc4065b]=await Promise[_0x13a1fc(0x161)]([_0x25049d,_0x20a12f]);for(const _0x174b9b of _0xc4065b){const _0x105de3=_0x14d03a[_0x13a1fc(0x15b)](_0x583275=>_0x583275['ParentId']===_0x174b9b['id']);_0x105de3&&_0x1e4fdb[_0x13a1fc(0x160)]({'fileType':_0x105de3['Name'],'fileName':_0x174b9b[_0x13a1fc(0x15d)],'attachmentId':_0x105de3['Id']});}}return _0x1e4fdb;}async['retrieveLastComponents'](_0x5afdc6){const _0x106bf3=a237_0x212cee,_0x4aab2f=await this[_0x106bf3(0x15a)](_0x5afdc6);this[_0x106bf3(0x15e)][_0x106bf3(0x148)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x208aa4=[];for(const _0x126d68 of _0x4aab2f){const _0x5a8df5=await this[_0x106bf3(0x138)][_0x106bf3(0x149)](_0x126d68[_0x106bf3(0x143)],!![]);_0x208aa4[_0x106bf3(0x160)]({'body':_0x5a8df5[_0x106bf3(0x144)](_0x106bf3(0x141)),'fileName':_0x126d68['fileName'],'fileType':_0x126d68[_0x106bf3(0x163)]}),this[_0x106bf3(0x15e)][_0x106bf3(0x148)](_0x106bf3(0x168),_0x208aa4[_0x106bf3(0x164)],_0x5afdc6[_0x106bf3(0x164)]);}return _0x208aa4;}async[a237_0x212cee(0x16e)](_0x6753c6){const _0x3f9c71=a237_0x212cee,_0xa03ab9=[..._0x6753c6],_0x4ef087=[],_0xe11cbd=[];while(_0xa03ab9[_0x3f9c71(0x164)]){const _0x1ebdeb=_0xa03ab9[_0x3f9c71(0x14f)](0x0,this[_0x3f9c71(0x155)]),_0x57129c=await this[_0x3f9c71(0x138)][_0x3f9c71(0x167)](_0x1ebdeb);_0x1ebdeb[_0x3f9c71(0x164)]!==_0x57129c['ids'][_0x3f9c71(0x164)]?(_0xa03ab9[_0x3f9c71(0x160)](..._0x57129c['ids']),_0x4ef087[_0x3f9c71(0x160)](..._0x57129c[_0x3f9c71(0x13c)])):_0xe11cbd[_0x3f9c71(0x160)](..._0x1ebdeb),this[_0x3f9c71(0x15e)][_0x3f9c71(0x13e)](_0x3f9c71(0x145),_0x6753c6['length']-_0xa03ab9[_0x3f9c71(0x164)],_0x6753c6[_0x3f9c71(0x164)]);}if(_0xe11cbd['length']){const _0x59ab43=await this['retrieveLastComponents'](_0xe11cbd);_0x4ef087[_0x3f9c71(0x160)](..._0x59ab43);}return _0x4ef087;}}exports[a237_0x212cee(0x13f)]=SalesforceRetrieverService;