const a236_0x611f50=a236_0x441f;(function(_0x5892b5,_0x2d985a){const _0x31a024=a236_0x441f,_0xb71905=_0x5892b5();while(!![]){try{const _0x4d9c49=-parseInt(_0x31a024(0x17f))/0x1+parseInt(_0x31a024(0x198))/0x2*(parseInt(_0x31a024(0x187))/0x3)+-parseInt(_0x31a024(0x199))/0x4*(parseInt(_0x31a024(0x1a8))/0x5)+parseInt(_0x31a024(0x174))/0x6*(parseInt(_0x31a024(0x194))/0x7)+parseInt(_0x31a024(0x181))/0x8*(parseInt(_0x31a024(0x186))/0x9)+-parseInt(_0x31a024(0x1a0))/0xa*(-parseInt(_0x31a024(0x19a))/0xb)+-parseInt(_0x31a024(0x1a6))/0xc*(parseInt(_0x31a024(0x1a1))/0xd);if(_0x4d9c49===_0x2d985a)break;else _0xb71905['push'](_0xb71905['shift']());}catch(_0xe39634){_0xb71905['push'](_0xb71905['shift']());}}}(a236_0x1b68,0x39a29));const a236_0x352199=(function(){let _0x4d6c47=!![];return function(_0x25683e,_0x522145){const _0x3829cf=_0x4d6c47?function(){if(_0x522145){const _0x35936f=_0x522145['apply'](_0x25683e,arguments);return _0x522145=null,_0x35936f;}}:function(){};return _0x4d6c47=![],_0x3829cf;};}()),a236_0x2d8aea=a236_0x352199(this,function(){const _0x52dd4d=a236_0x441f;return a236_0x2d8aea['toString']()[_0x52dd4d(0x196)](_0x52dd4d(0x195))[_0x52dd4d(0x18f)]()['constructor'](a236_0x2d8aea)[_0x52dd4d(0x196)](_0x52dd4d(0x195));});a236_0x2d8aea();'use strict';function a236_0x1b68(){const _0x2c1dfd=['SalesforceQueryService','then','364BiAFhr','(((.+)+)+)+$','search','retrieveAttachment','486nOLxTx','188ohbwVM','4499VANJkF','GET_COMPONENT_HISTORIES_BY_IDS','join','logger','fileType','manually\x20retrieved\x20%d/%d\x20components','8290mWhmmQ','302757GFyoml','%ids%','name','../queries','attachmentId','84EPVXTU','find','225TGqeiR','query','fileName','all','push','components','COMPONENTS_PER_REQUEST','length','retrieveComponentIdsFromHistoryIds','splice','660bVEZfS','defineProperty','COMPONENTS_PER_QUERY','FlosumComponentHistoryDto','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','__importDefault','%parent_ids%','get','../../../../core','map','salesforceService','289762QUIMye','filename','2507096byZoED','fromSalesforce','manually\x20retrieving\x20components\x20from\x20salesforce','base64','__esModule','9KdxJWp','405RSeTFe','info','log','ids','ParentId','retrieveLastComponents','SalesforceRetrieverService','typedi','toString','replace','retrieveComponents'];a236_0x1b68=function(){return _0x2c1dfd;};return a236_0x1b68();}var __importDefault=this&&this[a236_0x611f50(0x179)]||function(_0x1e091e){const _0x48b213=a236_0x611f50;return _0x1e091e&&_0x1e091e[_0x48b213(0x185)]?_0x1e091e:{'default':_0x1e091e};};Object[a236_0x611f50(0x175)](exports,a236_0x611f50(0x185),{'value':!![]}),exports[a236_0x611f50(0x18d)]=void 0x0;function a236_0x441f(_0x4251e4,_0x9f6c87){const _0x1ee972=a236_0x1b68();return a236_0x441f=function(_0x2d8aea,_0x352199){_0x2d8aea=_0x2d8aea-0x16f;let _0x1b6890=_0x1ee972[_0x2d8aea];return _0x1b6890;},a236_0x441f(_0x4251e4,_0x9f6c87);}const core_1=require(a236_0x611f50(0x17c)),typedi_1=__importDefault(require(a236_0x611f50(0x18e))),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a236_0x611f50(0x1a4)),flosum_component_history_dto_1=require('../dto/flosum-component-history.dto');class SalesforceRetrieverService{constructor(_0x2a17ff){const _0x1bd1d1=a236_0x611f50;this[_0x1bd1d1(0x17e)]=_0x2a17ff,this[_0x1bd1d1(0x19d)]=new core_1['Logger'](SalesforceRetrieverService[_0x1bd1d1(0x1a3)]),this[_0x1bd1d1(0x170)]=0xbb8,this[_0x1bd1d1(0x176)]=0x1f4;}async[a236_0x611f50(0x172)](_0x3b4b22){const _0x5bc94f=a236_0x611f50;this['logger'][_0x5bc94f(0x188)]('manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x3b4b22[_0x5bc94f(0x171)]);const _0x202b6d=typedi_1['default'][_0x5bc94f(0x17b)](salesforce_query_service_1[_0x5bc94f(0x192)]),_0x1bd81b=_0x3b4b22['map'](_0x5e83e4=>'\x27'+_0x5e83e4+'\x27'),_0x2673fa=[];while(_0x1bd81b[_0x5bc94f(0x171)]){const _0x245105=_0x1bd81b[_0x5bc94f(0x173)](0x0,this[_0x5bc94f(0x176)]),_0x42b347=_0x202b6d[_0x5bc94f(0x1a9)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x5bc94f(0x190)](_0x5bc94f(0x17a),_0x245105['join']())),_0x458979=_0x202b6d[_0x5bc94f(0x1a9)](queries_1[_0x5bc94f(0x19b)][_0x5bc94f(0x190)](_0x5bc94f(0x1a2),_0x245105[_0x5bc94f(0x19c)]()))[_0x5bc94f(0x193)](_0x2905d8=>_0x2905d8[_0x5bc94f(0x17d)](_0x2ddb45=>flosum_component_history_dto_1[_0x5bc94f(0x177)][_0x5bc94f(0x182)](_0x2ddb45))),[_0x27a4aa,_0x55e499]=await Promise[_0x5bc94f(0x1ab)]([_0x42b347,_0x458979]);for(const _0x5e5b67 of _0x55e499){const _0x39afb9=_0x27a4aa[_0x5bc94f(0x1a7)](_0x4b428e=>_0x4b428e[_0x5bc94f(0x18b)]===_0x5e5b67['id']);_0x39afb9&&_0x2673fa[_0x5bc94f(0x1ac)]({'fileType':_0x39afb9['Name'],'fileName':_0x5e5b67[_0x5bc94f(0x180)],'attachmentId':_0x39afb9['Id']});}}return _0x2673fa;}async[a236_0x611f50(0x18c)](_0x317d79){const _0x23e923=a236_0x611f50,_0x10c59a=await this['retrieveComponentIdsFromHistoryIds'](_0x317d79);this[_0x23e923(0x19d)][_0x23e923(0x188)](_0x23e923(0x183));const _0x106fd7=[];for(const _0x1ceec2 of _0x10c59a){const _0x3a1fa3=await this[_0x23e923(0x17e)][_0x23e923(0x197)](_0x1ceec2[_0x23e923(0x1a5)],!![]);_0x106fd7['push']({'body':_0x3a1fa3[_0x23e923(0x18f)](_0x23e923(0x184)),'fileName':_0x1ceec2[_0x23e923(0x1aa)],'fileType':_0x1ceec2[_0x23e923(0x19e)]}),this[_0x23e923(0x19d)]['info'](_0x23e923(0x19f),_0x106fd7[_0x23e923(0x171)],_0x317d79[_0x23e923(0x171)]);}return _0x106fd7;}async['run'](_0x42d21b){const _0x5a5e8a=a236_0x611f50,_0x209cec=[..._0x42d21b],_0x19690b=[],_0x51a9a0=[];while(_0x209cec[_0x5a5e8a(0x171)]){const _0x4671a0=_0x209cec['splice'](0x0,this[_0x5a5e8a(0x170)]),_0xe1f3ec=await this['salesforceService'][_0x5a5e8a(0x191)](_0x4671a0);_0x4671a0[_0x5a5e8a(0x171)]!==_0xe1f3ec[_0x5a5e8a(0x18a)][_0x5a5e8a(0x171)]?(_0x209cec[_0x5a5e8a(0x1ac)](..._0xe1f3ec[_0x5a5e8a(0x18a)]),_0x19690b[_0x5a5e8a(0x1ac)](..._0xe1f3ec[_0x5a5e8a(0x16f)])):_0x51a9a0[_0x5a5e8a(0x1ac)](..._0x4671a0),this[_0x5a5e8a(0x19d)][_0x5a5e8a(0x189)](_0x5a5e8a(0x178),_0x42d21b[_0x5a5e8a(0x171)]-_0x209cec['length'],_0x42d21b['length']);}if(_0x51a9a0['length']){const _0x591dcb=await this[_0x5a5e8a(0x18c)](_0x51a9a0);_0x19690b['push'](..._0x591dcb);}return _0x19690b;}}exports[a236_0x611f50(0x18d)]=SalesforceRetrieverService;