const a242_0x1f4961=a242_0x37cc;(function(_0x2b5bae,_0x32fb0f){const _0x54f753=a242_0x37cc,_0x360c8c=_0x2b5bae();while(!![]){try{const _0xdaf05c=parseInt(_0x54f753(0x19d))/0x1+-parseInt(_0x54f753(0x1b4))/0x2*(-parseInt(_0x54f753(0x1b5))/0x3)+-parseInt(_0x54f753(0x190))/0x4*(-parseInt(_0x54f753(0x195))/0x5)+-parseInt(_0x54f753(0x18a))/0x6+parseInt(_0x54f753(0x18f))/0x7*(parseInt(_0x54f753(0x19c))/0x8)+parseInt(_0x54f753(0x1aa))/0x9+-parseInt(_0x54f753(0x19e))/0xa;if(_0xdaf05c===_0x32fb0f)break;else _0x360c8c['push'](_0x360c8c['shift']());}catch(_0xed0d35){_0x360c8c['push'](_0x360c8c['shift']());}}}(a242_0x15f6,0x53cce));const a242_0x4c0999=(function(){let _0x24c5e8=!![];return function(_0x1db978,_0x4a9014){const _0x576c19=_0x24c5e8?function(){const _0x448780=a242_0x37cc;if(_0x4a9014){const _0xbdeab8=_0x4a9014[_0x448780(0x1ae)](_0x1db978,arguments);return _0x4a9014=null,_0xbdeab8;}}:function(){};return _0x24c5e8=![],_0x576c19;};}()),a242_0x27f1f1=a242_0x4c0999(this,function(){const _0x14fc0d=a242_0x37cc;return a242_0x27f1f1[_0x14fc0d(0x1b0)]()[_0x14fc0d(0x18b)](_0x14fc0d(0x1a4))[_0x14fc0d(0x1b0)]()[_0x14fc0d(0x1b9)](a242_0x27f1f1)[_0x14fc0d(0x18b)]('(((.+)+)+)+$');});a242_0x27f1f1();'use strict';function a242_0x15f6(){const _0x3f566a=['fileType','retrieveComponents','apply','FlosumComponentHistoryDto','toString','defineProperty','name','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','592LNnYrc','5322EQOQbx','base64','retrieveLastComponents','run','constructor','fileName','__esModule','../dto/flosum-component-history.dto','replace','COMPONENTS_PER_QUERY','query','retrieveComponentIdsFromHistoryIds','filename','../../../../core','2139528IFhIfJ','search','ids','COMPONENTS_PER_REQUEST','logger','347627BwwUUW','5404RZkuBm','log','map','typedi','./salesforce-query.service','505lBDZme','get','splice','info','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','push','%ids%','24CPibqE','393009LxruBO','6822750XTYeyS','__importDefault','SalesforceRetrieverService','then','join','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','(((.+)+)+)+$','Logger','GET_COMPONENT_HISTORIES_BY_IDS','length','fromSalesforce','salesforceService','1607058efXjoT','default'];a242_0x15f6=function(){return _0x3f566a;};return a242_0x15f6();}var __importDefault=this&&this[a242_0x1f4961(0x19f)]||function(_0x6f1144){return _0x6f1144&&_0x6f1144['__esModule']?_0x6f1144:{'default':_0x6f1144};};Object[a242_0x1f4961(0x1b1)](exports,a242_0x1f4961(0x182),{'value':!![]}),exports[a242_0x1f4961(0x1a0)]=void 0x0;function a242_0x37cc(_0x2d4edc,_0xe0e25){const _0x19f6d7=a242_0x15f6();return a242_0x37cc=function(_0x27f1f1,_0x4c0999){_0x27f1f1=_0x27f1f1-0x182;let _0x15f6a0=_0x19f6d7[_0x27f1f1];return _0x15f6a0;},a242_0x37cc(_0x2d4edc,_0xe0e25);}const core_1=require(a242_0x1f4961(0x189)),typedi_1=__importDefault(require(a242_0x1f4961(0x193))),salesforce_query_service_1=require(a242_0x1f4961(0x194)),queries_1=require('../queries'),flosum_component_history_dto_1=require(a242_0x1f4961(0x183));class SalesforceRetrieverService{constructor(_0x4041fa){const _0xcea37f=a242_0x1f4961;this[_0xcea37f(0x1a9)]=_0x4041fa,this[_0xcea37f(0x18e)]=new core_1[(_0xcea37f(0x1a5))](SalesforceRetrieverService[_0xcea37f(0x1b2)]),this[_0xcea37f(0x18d)]=0xbb8,this[_0xcea37f(0x185)]=0x1f4;}async[a242_0x1f4961(0x187)](_0x43c585){const _0x49bc7e=a242_0x1f4961;this[_0x49bc7e(0x18e)][_0x49bc7e(0x198)](_0x49bc7e(0x199),_0x43c585[_0x49bc7e(0x1a7)]);const _0x2b8293=typedi_1[_0x49bc7e(0x1ab)][_0x49bc7e(0x196)](salesforce_query_service_1['SalesforceQueryService']),_0x14fc86=_0x43c585[_0x49bc7e(0x192)](_0x2d6635=>'\x27'+_0x2d6635+'\x27'),_0x206022=[];while(_0x14fc86['length']){const _0x139b98=_0x14fc86['splice'](0x0,this[_0x49bc7e(0x185)]),_0x4dabf9=_0x2b8293[_0x49bc7e(0x186)](queries_1[_0x49bc7e(0x1a3)]['replace']('%parent_ids%',_0x139b98[_0x49bc7e(0x1a2)]())),_0x54e476=_0x2b8293[_0x49bc7e(0x186)](queries_1[_0x49bc7e(0x1a6)][_0x49bc7e(0x184)](_0x49bc7e(0x19b),_0x139b98['join']()))[_0x49bc7e(0x1a1)](_0x51d4a6=>_0x51d4a6[_0x49bc7e(0x192)](_0x12c7f5=>flosum_component_history_dto_1[_0x49bc7e(0x1af)][_0x49bc7e(0x1a8)](_0x12c7f5))),[_0x34aac4,_0x152b2d]=await Promise['all']([_0x4dabf9,_0x54e476]);for(const _0x442264 of _0x152b2d){const _0x1e1282=_0x34aac4['find'](_0x5765de=>_0x5765de['ParentId']===_0x442264['id']);_0x1e1282&&_0x206022[_0x49bc7e(0x19a)]({'fileType':_0x1e1282['Name'],'fileName':_0x442264[_0x49bc7e(0x188)],'attachmentId':_0x1e1282['Id']});}}return _0x206022;}async[a242_0x1f4961(0x1b7)](_0x18ac83){const _0x1ad356=a242_0x1f4961,_0x185716=await this[_0x1ad356(0x187)](_0x18ac83);this['logger'][_0x1ad356(0x198)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x3231b6=[];for(const _0x42a7f9 of _0x185716){const _0x29b874=await this[_0x1ad356(0x1a9)]['retrieveAttachment'](_0x42a7f9['attachmentId'],!![]);_0x3231b6[_0x1ad356(0x19a)]({'body':_0x29b874[_0x1ad356(0x1b0)](_0x1ad356(0x1b6)),'fileName':_0x42a7f9[_0x1ad356(0x1ba)],'fileType':_0x42a7f9[_0x1ad356(0x1ac)]}),this[_0x1ad356(0x18e)][_0x1ad356(0x198)]('manually\x20retrieved\x20%d/%d\x20components',_0x3231b6[_0x1ad356(0x1a7)],_0x18ac83[_0x1ad356(0x1a7)]);}return _0x3231b6;}async[a242_0x1f4961(0x1b8)](_0x4c97db){const _0x52eda2=a242_0x1f4961,_0x16726c=[..._0x4c97db],_0x4073c6=[],_0xb6f78f=[];while(_0x16726c[_0x52eda2(0x1a7)]){const _0x513c70=_0x16726c[_0x52eda2(0x197)](0x0,this[_0x52eda2(0x18d)]),_0x56a195=await this[_0x52eda2(0x1a9)][_0x52eda2(0x1ad)](_0x513c70);_0x513c70[_0x52eda2(0x1a7)]!==_0x56a195['ids'][_0x52eda2(0x1a7)]?(_0x16726c[_0x52eda2(0x19a)](..._0x56a195[_0x52eda2(0x18c)]),_0x4073c6['push'](..._0x56a195['components'])):_0xb6f78f[_0x52eda2(0x19a)](..._0x513c70),this[_0x52eda2(0x18e)][_0x52eda2(0x191)](_0x52eda2(0x1b3),_0x4c97db[_0x52eda2(0x1a7)]-_0x16726c['length'],_0x4c97db[_0x52eda2(0x1a7)]);}if(_0xb6f78f['length']){const _0x2004dd=await this['retrieveLastComponents'](_0xb6f78f);_0x4073c6['push'](..._0x2004dd);}return _0x4073c6;}}exports[a242_0x1f4961(0x1a0)]=SalesforceRetrieverService;