const a281_0xbfee22=a281_0x322d;(function(_0x5d580a,_0x316466){const _0x11f57d=a281_0x322d,_0x23580d=_0x5d580a();while(!![]){try{const _0x41f04f=parseInt(_0x11f57d(0x198))/0x1*(parseInt(_0x11f57d(0x192))/0x2)+-parseInt(_0x11f57d(0x179))/0x3*(-parseInt(_0x11f57d(0x191))/0x4)+-parseInt(_0x11f57d(0x170))/0x5+-parseInt(_0x11f57d(0x17a))/0x6+parseInt(_0x11f57d(0x180))/0x7*(-parseInt(_0x11f57d(0x188))/0x8)+parseInt(_0x11f57d(0x174))/0x9*(parseInt(_0x11f57d(0x195))/0xa)+-parseInt(_0x11f57d(0x190))/0xb*(-parseInt(_0x11f57d(0x182))/0xc);if(_0x41f04f===_0x316466)break;else _0x23580d['push'](_0x23580d['shift']());}catch(_0x3a0b6f){_0x23580d['push'](_0x23580d['shift']());}}}(a281_0x370f,0xe0620));const a281_0x7b5a5d=(function(){let _0x245ee4=!![];return function(_0x193b52,_0x1965c4){const _0x521ed7=_0x245ee4?function(){const _0x427eff=a281_0x322d;if(_0x1965c4){const _0x5e65cf=_0x1965c4[_0x427eff(0x17b)](_0x193b52,arguments);return _0x1965c4=null,_0x5e65cf;}}:function(){};return _0x245ee4=![],_0x521ed7;};}()),a281_0x33d4b6=a281_0x7b5a5d(this,function(){const _0x1e2a8f=a281_0x322d;return a281_0x33d4b6[_0x1e2a8f(0x18a)]()[_0x1e2a8f(0x17e)](_0x1e2a8f(0x173))[_0x1e2a8f(0x18a)]()[_0x1e2a8f(0x16e)](a281_0x33d4b6)[_0x1e2a8f(0x17e)](_0x1e2a8f(0x173));});a281_0x33d4b6();'use strict';function a281_0x370f(){const _0x46c7ed=['push','../dto/flosum-component-history.dto','20HcCaEW','splice','Manually\x20retrieved\x20%d/%d\x20components','17LaVtJb','SalesforceRetrieverService','default','__esModule','retrieveComponents','then','../../../../core','constructor','replace','8832280pOtigZ','Manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','Name','(((.+)+)+)+$','6782841kNljSp','base64','__importDefault','name','retrieveComponentIdsFromHistoryIds','156399hYpNih','3738096vSsdmJ','apply','map','query','search','fileName','4491284joHnJr','get','12ADidfA','salesforceService','retrieveAttachment','Logger','join','length','8iLSjhN','%parent_ids%','toString','COMPONENTS_PER_QUERY','run','FlosumComponentHistoryDto','info','logger','7000642cTKuuz','12PgiDpd','194122hDVCra'];a281_0x370f=function(){return _0x46c7ed;};return a281_0x370f();}function a281_0x322d(_0x3d06f3,_0x1fc860){const _0x17e8eb=a281_0x370f();return a281_0x322d=function(_0x33d4b6,_0x7b5a5d){_0x33d4b6=_0x33d4b6-0x16a;let _0x370f2f=_0x17e8eb[_0x33d4b6];return _0x370f2f;},a281_0x322d(_0x3d06f3,_0x1fc860);}var __importDefault=this&&this[a281_0xbfee22(0x176)]||function(_0x4a1f1){const _0x5b60ec=a281_0xbfee22;return _0x4a1f1&&_0x4a1f1[_0x5b60ec(0x16a)]?_0x4a1f1:{'default':_0x4a1f1};};Object['defineProperty'](exports,a281_0xbfee22(0x16a),{'value':!![]}),exports[a281_0xbfee22(0x199)]=void 0x0;const core_1=require(a281_0xbfee22(0x16d)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require('../queries'),flosum_component_history_dto_1=require(a281_0xbfee22(0x194));class SalesforceRetrieverService{constructor(_0x2fcdfd){const _0x1311da=a281_0xbfee22;this['salesforceService']=_0x2fcdfd,this[_0x1311da(0x18f)]=new core_1[(_0x1311da(0x185))](SalesforceRetrieverService[_0x1311da(0x177)]),this['COMPONENTS_PER_REQUEST']=0xbb8,this[_0x1311da(0x18b)]=0x1f4;}async[a281_0xbfee22(0x178)](_0x168f38){const _0xa94d26=a281_0xbfee22;this['logger'][_0xa94d26(0x18e)](_0xa94d26(0x171),_0x168f38[_0xa94d26(0x187)]);const _0x5f9c4a=typedi_1[_0xa94d26(0x19a)][_0xa94d26(0x181)](salesforce_query_service_1['SalesforceQueryService']),_0x4609d1=_0x168f38[_0xa94d26(0x17c)](_0x5ad34a=>'\x27'+_0x5ad34a+'\x27'),_0x428f65=[];while(_0x4609d1['length']){const _0x4c4726=_0x4609d1[_0xa94d26(0x196)](0x0,this[_0xa94d26(0x18b)]),_0x563e9f=_0x5f9c4a[_0xa94d26(0x17d)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0xa94d26(0x16f)](_0xa94d26(0x189),_0x4c4726[_0xa94d26(0x186)]())),_0x12c72a=_0x5f9c4a['query'](queries_1['GET_COMPONENT_HISTORIES_BY_IDS'][_0xa94d26(0x16f)]('%ids%',_0x4c4726[_0xa94d26(0x186)]()))[_0xa94d26(0x16c)](_0x1ce04a=>_0x1ce04a['map'](_0xc9a660=>flosum_component_history_dto_1[_0xa94d26(0x18d)]['fromSalesforce'](_0xc9a660))),[_0x56118e,_0x2abf79]=await Promise['all']([_0x563e9f,_0x12c72a]);for(const _0x11cb93 of _0x2abf79){const _0x257bb4=_0x56118e['find'](_0x261358=>_0x261358['ParentId']===_0x11cb93['id']);_0x257bb4&&_0x428f65[_0xa94d26(0x193)]({'fileType':_0x257bb4[_0xa94d26(0x172)],'fileName':_0x11cb93['filename'],'attachmentId':_0x257bb4['Id']});}}return _0x428f65;}async['retrieveLastComponents'](_0x1a8525){const _0x501b8b=a281_0xbfee22,_0x204189=await this['retrieveComponentIdsFromHistoryIds'](_0x1a8525);this['logger'][_0x501b8b(0x18e)]('Manually\x20retrieving\x20components\x20from\x20salesforce');const _0x51ec4e=[];for(const _0x292f19 of _0x204189){const _0x30eabb=await this[_0x501b8b(0x183)][_0x501b8b(0x184)](_0x292f19['attachmentId'],!![]);_0x51ec4e['push']({'body':_0x30eabb['toString'](_0x501b8b(0x175)),'fileName':_0x292f19[_0x501b8b(0x17f)],'fileType':_0x292f19['fileType']}),this['logger'][_0x501b8b(0x18e)](_0x501b8b(0x197),_0x51ec4e[_0x501b8b(0x187)],_0x1a8525['length']);}return _0x51ec4e;}async[a281_0xbfee22(0x18c)](_0x359bd3){const _0x4ba298=a281_0xbfee22;if(!_0x359bd3[_0x4ba298(0x187)])return[];const _0x152d1e=await this[_0x4ba298(0x183)][_0x4ba298(0x16b)](_0x359bd3);return _0x152d1e;}}exports[a281_0xbfee22(0x199)]=SalesforceRetrieverService;