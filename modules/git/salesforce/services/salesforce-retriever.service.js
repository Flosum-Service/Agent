const a237_0x14d73e=a237_0x5bd0;(function(_0x273237,_0x100cd0){const _0x5de472=a237_0x5bd0,_0x438f33=_0x273237();while(!![]){try{const _0x5c51cf=parseInt(_0x5de472(0x1a7))/0x1+parseInt(_0x5de472(0x1bb))/0x2*(parseInt(_0x5de472(0x1b5))/0x3)+-parseInt(_0x5de472(0x1a0))/0x4*(parseInt(_0x5de472(0x1be))/0x5)+-parseInt(_0x5de472(0x1a2))/0x6*(parseInt(_0x5de472(0x198))/0x7)+-parseInt(_0x5de472(0x19b))/0x8*(parseInt(_0x5de472(0x1ac))/0x9)+-parseInt(_0x5de472(0x1c3))/0xa+parseInt(_0x5de472(0x1a1))/0xb;if(_0x5c51cf===_0x100cd0)break;else _0x438f33['push'](_0x438f33['shift']());}catch(_0x4a59ca){_0x438f33['push'](_0x438f33['shift']());}}}(a237_0x5a41,0x28142));const a237_0x2a1954=(function(){let _0x4482b1=!![];return function(_0x4263a3,_0x46e786){const _0x3ef33f=_0x4482b1?function(){const _0x397b0e=a237_0x5bd0;if(_0x46e786){const _0x2ca06a=_0x46e786[_0x397b0e(0x19d)](_0x4263a3,arguments);return _0x46e786=null,_0x2ca06a;}}:function(){};return _0x4482b1=![],_0x3ef33f;};}()),a237_0x41be80=a237_0x2a1954(this,function(){const _0xfa8762=a237_0x5bd0;return a237_0x41be80['toString']()['search'](_0xfa8762(0x192))[_0xfa8762(0x191)]()[_0xfa8762(0x1b8)](a237_0x41be80)[_0xfa8762(0x1a6)](_0xfa8762(0x192));});a237_0x41be80();'use strict';function a237_0x5bd0(_0x560d55,_0x53d95b){const _0x5c886b=a237_0x5a41();return a237_0x5bd0=function(_0x41be80,_0x2a1954){_0x41be80=_0x41be80-0x18c;let _0x5a41ce=_0x5c886b[_0x41be80];return _0x5a41ce;},a237_0x5bd0(_0x560d55,_0x53d95b);}var __importDefault=this&&this['__importDefault']||function(_0x41e559){const _0x8d1b99=a237_0x5bd0;return _0x41e559&&_0x41e559[_0x8d1b99(0x1bd)]?_0x41e559:{'default':_0x41e559};};Object[a237_0x14d73e(0x18d)](exports,a237_0x14d73e(0x1bd),{'value':!![]}),exports[a237_0x14d73e(0x1a9)]=void 0x0;function a237_0x5a41(){const _0x1d6406=['281041keQSyu','manually\x20retrieved\x20%d/%d\x20components','SalesforceRetrieverService','run','replace','117GvzFgq','info','filename','../queries','GET_COMPONENT_HISTORIES_BY_IDS','map','push','log','retrieveLastComponents','9JRRYYZ','SalesforceQueryService','query','constructor','manually\x20retrieving\x20components\x20from\x20salesforce','default','56366wHobjI','../dto/flosum-component-history.dto','__esModule','25BSpYdx','join','fileName','COMPONENTS_PER_QUERY','logger','1150260vOzILr','ids','splice','get','defineProperty','name','retrieveAttachment','COMPONENTS_PER_REQUEST','toString','(((.+)+)+)+$','Name','FlosumComponentHistoryDto','Logger','retrieveComponents','base64','2018366HFfIRa','retrieveComponentIdsFromHistoryIds','then','199016NUrANt','%ids%','apply','components','./salesforce-query.service','42100JRLRKU','6357582CUSvHo','6mOmOqk','attachmentId','salesforceService','length','search'];a237_0x5a41=function(){return _0x1d6406;};return a237_0x5a41();}const core_1=require('../../../../core'),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require(a237_0x14d73e(0x19f)),queries_1=require(a237_0x14d73e(0x1af)),flosum_component_history_dto_1=require(a237_0x14d73e(0x1bc));class SalesforceRetrieverService{constructor(_0x6c54ad){const _0x1bf6ad=a237_0x14d73e;this[_0x1bf6ad(0x1a4)]=_0x6c54ad,this['logger']=new core_1[(_0x1bf6ad(0x195))](SalesforceRetrieverService[_0x1bf6ad(0x18e)]),this[_0x1bf6ad(0x190)]=0xbb8,this[_0x1bf6ad(0x1c1)]=0x1f4;}async[a237_0x14d73e(0x199)](_0x49e44c){const _0x3d04d2=a237_0x14d73e;this[_0x3d04d2(0x1c2)][_0x3d04d2(0x1ad)]('manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x49e44c['length']);const _0x189e55=typedi_1[_0x3d04d2(0x1ba)][_0x3d04d2(0x18c)](salesforce_query_service_1[_0x3d04d2(0x1b6)]),_0xce7aa3=_0x49e44c[_0x3d04d2(0x1b1)](_0x224ccf=>'\x27'+_0x224ccf+'\x27'),_0x3d1234=[];while(_0xce7aa3[_0x3d04d2(0x1a5)]){const _0x327db0=_0xce7aa3[_0x3d04d2(0x1c5)](0x0,this[_0x3d04d2(0x1c1)]),_0x33da4a=_0x189e55[_0x3d04d2(0x1b7)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x3d04d2(0x1ab)]('%parent_ids%',_0x327db0[_0x3d04d2(0x1bf)]())),_0x4a0274=_0x189e55[_0x3d04d2(0x1b7)](queries_1[_0x3d04d2(0x1b0)][_0x3d04d2(0x1ab)](_0x3d04d2(0x19c),_0x327db0[_0x3d04d2(0x1bf)]()))[_0x3d04d2(0x19a)](_0x484e0e=>_0x484e0e[_0x3d04d2(0x1b1)](_0x267fc0=>flosum_component_history_dto_1[_0x3d04d2(0x194)]['fromSalesforce'](_0x267fc0))),[_0x4f8271,_0x1924d2]=await Promise['all']([_0x33da4a,_0x4a0274]);for(const _0x15db40 of _0x1924d2){const _0x81b451=_0x4f8271['find'](_0x4a22c6=>_0x4a22c6['ParentId']===_0x15db40['id']);_0x81b451&&_0x3d1234[_0x3d04d2(0x1b2)]({'fileType':_0x81b451[_0x3d04d2(0x193)],'fileName':_0x15db40[_0x3d04d2(0x1ae)],'attachmentId':_0x81b451['Id']});}}return _0x3d1234;}async[a237_0x14d73e(0x1b4)](_0x66f93f){const _0x5da0e8=a237_0x14d73e,_0x476ea5=await this[_0x5da0e8(0x199)](_0x66f93f);this[_0x5da0e8(0x1c2)][_0x5da0e8(0x1ad)](_0x5da0e8(0x1b9));const _0x14d1e7=[];for(const _0x4c11ff of _0x476ea5){const _0x2d828a=await this[_0x5da0e8(0x1a4)][_0x5da0e8(0x18f)](_0x4c11ff[_0x5da0e8(0x1a3)],!![]);_0x14d1e7[_0x5da0e8(0x1b2)]({'body':_0x2d828a['toString'](_0x5da0e8(0x197)),'fileName':_0x4c11ff[_0x5da0e8(0x1c0)],'fileType':_0x4c11ff['fileType']}),this[_0x5da0e8(0x1c2)][_0x5da0e8(0x1ad)](_0x5da0e8(0x1a8),_0x14d1e7[_0x5da0e8(0x1a5)],_0x66f93f[_0x5da0e8(0x1a5)]);}return _0x14d1e7;}async[a237_0x14d73e(0x1aa)](_0x25750f){const _0x45a243=a237_0x14d73e,_0x2abbae=[..._0x25750f],_0x51a09e=[],_0x42cef9=[];while(_0x2abbae['length']){const _0x430e03=_0x2abbae['splice'](0x0,this[_0x45a243(0x190)]),_0x4bb211=await this[_0x45a243(0x1a4)][_0x45a243(0x196)](_0x430e03);_0x430e03[_0x45a243(0x1a5)]!==_0x4bb211[_0x45a243(0x1c4)]['length']?(_0x2abbae['push'](..._0x4bb211[_0x45a243(0x1c4)]),_0x51a09e[_0x45a243(0x1b2)](..._0x4bb211[_0x45a243(0x19e)])):_0x42cef9[_0x45a243(0x1b2)](..._0x430e03),this[_0x45a243(0x1c2)][_0x45a243(0x1b3)]('retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest',_0x25750f['length']-_0x2abbae[_0x45a243(0x1a5)],_0x25750f['length']);}if(_0x42cef9[_0x45a243(0x1a5)]){const _0x1630a3=await this[_0x45a243(0x1b4)](_0x42cef9);_0x51a09e[_0x45a243(0x1b2)](..._0x1630a3);}return _0x51a09e;}}exports[a237_0x14d73e(0x1a9)]=SalesforceRetrieverService;