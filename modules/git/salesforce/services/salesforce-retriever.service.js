const a202_0x9f59a9=a202_0x2f7e;function a202_0x2f7e(_0x3ac929,_0xd2741b){const _0x404391=a202_0x5236();return a202_0x2f7e=function(_0x2796f9,_0x1f3744){_0x2796f9=_0x2796f9-0x1ce;let _0x523677=_0x404391[_0x2796f9];return _0x523677;},a202_0x2f7e(_0x3ac929,_0xd2741b);}(function(_0x4e53f3,_0x26de19){const _0x375ba9=a202_0x2f7e,_0xc858ac=_0x4e53f3();while(!![]){try{const _0x15d0a2=parseInt(_0x375ba9(0x1d9))/0x1+-parseInt(_0x375ba9(0x1d7))/0x2+-parseInt(_0x375ba9(0x1ea))/0x3*(parseInt(_0x375ba9(0x1f8))/0x4)+-parseInt(_0x375ba9(0x1e9))/0x5*(parseInt(_0x375ba9(0x1d1))/0x6)+parseInt(_0x375ba9(0x1ef))/0x7*(-parseInt(_0x375ba9(0x1f9))/0x8)+parseInt(_0x375ba9(0x1ec))/0x9*(-parseInt(_0x375ba9(0x1e2))/0xa)+parseInt(_0x375ba9(0x1f3))/0xb;if(_0x15d0a2===_0x26de19)break;else _0xc858ac['push'](_0xc858ac['shift']());}catch(_0x25497f){_0xc858ac['push'](_0xc858ac['shift']());}}}(a202_0x5236,0xd0b40));function a202_0x5236(){const _0x554aba=['__esModule','push','%ids%','fileName','225uYIjkB','21UVrMLP','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','1519272FOaiDk','retrieveLastComponents','SalesforceQueryService','5677eUvMye','retrieveComponentIdsFromHistoryIds','GET_COMPONENT_HISTORIES_BY_IDS','search','28562336lAoOaB','Name','COMPONENTS_PER_REQUEST','splice','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','219980dAWMCQ','72qTPzJc','default','toString','apply','SalesforceRetrieverService','typedi','map','../queries','manually\x20retrieved\x20%d/%d\x20components','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','salesforceService','ids','(((.+)+)+)+$','../dto/flosum-component-history.dto','filename','83250xAgXsJ','name','Logger','join','manually\x20retrieving\x20components\x20from\x20salesforce','logger','1979898CzDKQz','length','940092hFRPeX','then','fromSalesforce','all','base64','replace','retrieveComponents','query','COMPONENTS_PER_QUERY','40fWNydU','info','attachmentId'];a202_0x5236=function(){return _0x554aba;};return a202_0x5236();}const a202_0x1f3744=(function(){let _0x50ac8a=!![];return function(_0x2d6330,_0x236b2b){const _0x1c3a6f=_0x50ac8a?function(){const _0x2a7209=a202_0x2f7e;if(_0x236b2b){const _0x217aa3=_0x236b2b[_0x2a7209(0x1fc)](_0x2d6330,arguments);return _0x236b2b=null,_0x217aa3;}}:function(){};return _0x50ac8a=![],_0x1c3a6f;};}()),a202_0x2796f9=a202_0x1f3744(this,function(){const _0x8f52e=a202_0x2f7e;return a202_0x2796f9[_0x8f52e(0x1fb)]()[_0x8f52e(0x1f2)](_0x8f52e(0x1ce))[_0x8f52e(0x1fb)]()['constructor'](a202_0x2796f9)['search'](_0x8f52e(0x1ce));});a202_0x2796f9();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x42253f){return _0x42253f&&_0x42253f['__esModule']?_0x42253f:{'default':_0x42253f};};Object['defineProperty'](exports,a202_0x9f59a9(0x1e5),{'value':!![]}),exports['SalesforceRetrieverService']=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require(a202_0x9f59a9(0x1fe))),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a202_0x9f59a9(0x200)),flosum_component_history_dto_1=require(a202_0x9f59a9(0x1cf));class SalesforceRetrieverService{constructor(_0x504b0b){const _0x143773=a202_0x9f59a9;this[_0x143773(0x203)]=_0x504b0b,this[_0x143773(0x1d6)]=new core_1[(_0x143773(0x1d3))](SalesforceRetrieverService[_0x143773(0x1d2)]),this[_0x143773(0x1f5)]=0xbb8,this[_0x143773(0x1e1)]=0x1f4;}async[a202_0x9f59a9(0x1f0)](_0x315b77){const _0x2d9c4b=a202_0x9f59a9;this[_0x2d9c4b(0x1d6)][_0x2d9c4b(0x1e3)](_0x2d9c4b(0x1eb),_0x315b77[_0x2d9c4b(0x1d8)]);const _0x673e31=typedi_1[_0x2d9c4b(0x1fa)]['get'](salesforce_query_service_1[_0x2d9c4b(0x1ee)]),_0x4e5d87=_0x315b77[_0x2d9c4b(0x1ff)](_0x101368=>'\x27'+_0x101368+'\x27'),_0x34cfe4=[];while(_0x4e5d87[_0x2d9c4b(0x1d8)]){const _0x2a66e3=_0x4e5d87['splice'](0x0,this['COMPONENTS_PER_QUERY']),_0x44604a=_0x673e31[_0x2d9c4b(0x1e0)](queries_1[_0x2d9c4b(0x202)][_0x2d9c4b(0x1de)]('%parent_ids%',_0x2a66e3['join']())),_0x39cce1=_0x673e31[_0x2d9c4b(0x1e0)](queries_1[_0x2d9c4b(0x1f1)][_0x2d9c4b(0x1de)](_0x2d9c4b(0x1e7),_0x2a66e3[_0x2d9c4b(0x1d4)]()))[_0x2d9c4b(0x1da)](_0x3d18fe=>_0x3d18fe['map'](_0x122e32=>flosum_component_history_dto_1['FlosumComponentHistoryDto'][_0x2d9c4b(0x1db)](_0x122e32))),[_0x57dda8,_0xbef079]=await Promise[_0x2d9c4b(0x1dc)]([_0x44604a,_0x39cce1]);for(const _0x5ed0a9 of _0xbef079){const _0x46d0de=_0x57dda8['find'](_0x446245=>_0x446245['ParentId']===_0x5ed0a9['id']);_0x46d0de&&_0x34cfe4[_0x2d9c4b(0x1e6)]({'fileType':_0x46d0de[_0x2d9c4b(0x1f4)],'fileName':_0x5ed0a9[_0x2d9c4b(0x1d0)],'attachmentId':_0x46d0de['Id']});}}return _0x34cfe4;}async[a202_0x9f59a9(0x1ed)](_0x1e9f96){const _0x431a33=a202_0x9f59a9,_0x1b0236=await this[_0x431a33(0x1f0)](_0x1e9f96);this[_0x431a33(0x1d6)][_0x431a33(0x1e3)](_0x431a33(0x1d5));const _0x4b9b40=[];for(const _0x322955 of _0x1b0236){const _0x1260ca=await this['salesforceService']['retrieveAttachment'](_0x322955[_0x431a33(0x1e4)],!![]);_0x4b9b40['push']({'body':_0x1260ca['toString'](_0x431a33(0x1dd)),'fileName':_0x322955[_0x431a33(0x1e8)],'fileType':_0x322955['fileType']}),this['logger'][_0x431a33(0x1e3)](_0x431a33(0x201),_0x4b9b40[_0x431a33(0x1d8)],_0x1e9f96[_0x431a33(0x1d8)]);}return _0x4b9b40;}async['run'](_0x4403ae){const _0x4772e0=a202_0x9f59a9,_0x2de3d5=[..._0x4403ae],_0x3c7de2=[],_0x5ad18f=[];while(_0x2de3d5[_0x4772e0(0x1d8)]){const _0x23f4a3=_0x2de3d5[_0x4772e0(0x1f6)](0x0,this[_0x4772e0(0x1f5)]),_0x217d80=await this[_0x4772e0(0x203)][_0x4772e0(0x1df)](_0x23f4a3);_0x23f4a3[_0x4772e0(0x1d8)]!==_0x217d80['ids'][_0x4772e0(0x1d8)]?(_0x2de3d5[_0x4772e0(0x1e6)](..._0x217d80[_0x4772e0(0x204)]),_0x3c7de2[_0x4772e0(0x1e6)](..._0x217d80['components'])):_0x5ad18f[_0x4772e0(0x1e6)](..._0x23f4a3),this[_0x4772e0(0x1d6)]['log'](_0x4772e0(0x1f7),_0x4403ae[_0x4772e0(0x1d8)]-_0x2de3d5['length'],_0x4403ae[_0x4772e0(0x1d8)]);}if(_0x5ad18f[_0x4772e0(0x1d8)]){const _0x1ea21a=await this[_0x4772e0(0x1ed)](_0x5ad18f);_0x3c7de2[_0x4772e0(0x1e6)](..._0x1ea21a);}return _0x3c7de2;}}exports[a202_0x9f59a9(0x1fd)]=SalesforceRetrieverService;