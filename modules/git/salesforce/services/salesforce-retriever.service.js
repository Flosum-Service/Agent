const a279_0x1240df=a279_0x23b3;(function(_0x195460,_0x305cf3){const _0xd7907f=a279_0x23b3,_0x472680=_0x195460();while(!![]){try{const _0xe3e2de=-parseInt(_0xd7907f(0x17b))/0x1*(parseInt(_0xd7907f(0x176))/0x2)+-parseInt(_0xd7907f(0x162))/0x3+-parseInt(_0xd7907f(0x15b))/0x4*(parseInt(_0xd7907f(0x172))/0x5)+parseInt(_0xd7907f(0x16c))/0x6+-parseInt(_0xd7907f(0x16e))/0x7+-parseInt(_0xd7907f(0x156))/0x8+-parseInt(_0xd7907f(0x15e))/0x9*(-parseInt(_0xd7907f(0x157))/0xa);if(_0xe3e2de===_0x305cf3)break;else _0x472680['push'](_0x472680['shift']());}catch(_0x1bf614){_0x472680['push'](_0x472680['shift']());}}}(a279_0x79b4,0x652a3));const a279_0x2893a1=(function(){let _0x553ac7=!![];return function(_0x2b5453,_0x5bd093){const _0x5c3ff6=_0x553ac7?function(){const _0x238b19=a279_0x23b3;if(_0x5bd093){const _0x33eb26=_0x5bd093[_0x238b19(0x166)](_0x2b5453,arguments);return _0x5bd093=null,_0x33eb26;}}:function(){};return _0x553ac7=![],_0x5c3ff6;};}()),a279_0x2e2a36=a279_0x2893a1(this,function(){const _0x1f55ae=a279_0x23b3;return a279_0x2e2a36['toString']()[_0x1f55ae(0x159)](_0x1f55ae(0x182))[_0x1f55ae(0x184)]()[_0x1f55ae(0x173)](a279_0x2e2a36)['search']('(((.+)+)+)+$');});function a279_0x23b3(_0x10e9a6,_0x403690){const _0x38e41f=a279_0x79b4();return a279_0x23b3=function(_0x2e2a36,_0x2893a1){_0x2e2a36=_0x2e2a36-0x151;let _0x79b41e=_0x38e41f[_0x2e2a36];return _0x79b41e;},a279_0x23b3(_0x10e9a6,_0x403690);}a279_0x2e2a36();'use strict';var __importDefault=this&&this[a279_0x1240df(0x181)]||function(_0x883d8a){const _0x37bb9d=a279_0x1240df;return _0x883d8a&&_0x883d8a[_0x37bb9d(0x15c)]?_0x883d8a:{'default':_0x883d8a};};Object['defineProperty'](exports,a279_0x1240df(0x15c),{'value':!![]}),exports[a279_0x1240df(0x15a)]=void 0x0;const core_1=require(a279_0x1240df(0x151)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require(a279_0x1240df(0x168)),queries_1=require('../queries'),flosum_component_history_dto_1=require('../dto/flosum-component-history.dto');function a279_0x79b4(){const _0x122cd6=['replace','Name','62421bZaZii','base64','push','Logger','apply','FlosumComponentHistoryDto','./salesforce-query.service','filename','SalesforceQueryService','Manually\x20retrieved\x20%d/%d\x20components','2538300cxlFyG','all','245273zZuSdg','find','ParentId','fileName','3479405GmLBXr','constructor','splice','retrieveComponentIdsFromHistoryIds','90926zSBQpq','get','fileType','name','query','1gafdYB','Manually\x20retrieving\x20components\x20from\x20salesforce','join','COMPONENTS_PER_QUERY','length','logger','__importDefault','(((.+)+)+)+$','retrieveComponents','toString','../../../../core','run','salesforceService','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','default','6001888MljNVh','15190MXqqFc','map','search','SalesforceRetrieverService','4wSrXgt','__esModule','attachmentId','9117XFRain','%parent_ids%'];a279_0x79b4=function(){return _0x122cd6;};return a279_0x79b4();}class SalesforceRetrieverService{constructor(_0x5a84d0){const _0x101c8f=a279_0x1240df;this[_0x101c8f(0x153)]=_0x5a84d0,this[_0x101c8f(0x180)]=new core_1[(_0x101c8f(0x165))](SalesforceRetrieverService[_0x101c8f(0x179)]),this['COMPONENTS_PER_REQUEST']=0xbb8,this['COMPONENTS_PER_QUERY']=0x1f4;}async[a279_0x1240df(0x175)](_0x3fec0d){const _0x2887be=a279_0x1240df;this[_0x2887be(0x180)]['info']('Manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x3fec0d['length']);const _0x5aca77=typedi_1[_0x2887be(0x155)][_0x2887be(0x177)](salesforce_query_service_1[_0x2887be(0x16a)]),_0x7b5c80=_0x3fec0d['map'](_0x110f46=>'\x27'+_0x110f46+'\x27'),_0x185fe4=[];while(_0x7b5c80[_0x2887be(0x17f)]){const _0x6f5e32=_0x7b5c80[_0x2887be(0x174)](0x0,this[_0x2887be(0x17e)]),_0x15ebd2=_0x5aca77[_0x2887be(0x17a)](queries_1[_0x2887be(0x154)][_0x2887be(0x160)](_0x2887be(0x15f),_0x6f5e32['join']())),_0x12f5eb=_0x5aca77[_0x2887be(0x17a)](queries_1['GET_COMPONENT_HISTORIES_BY_IDS'][_0x2887be(0x160)]('%ids%',_0x6f5e32[_0x2887be(0x17d)]()))['then'](_0x49975b=>_0x49975b[_0x2887be(0x158)](_0x2775dc=>flosum_component_history_dto_1[_0x2887be(0x167)]['fromSalesforce'](_0x2775dc))),[_0x45f6f6,_0x47d1b6]=await Promise[_0x2887be(0x16d)]([_0x15ebd2,_0x12f5eb]);for(const _0x2efe0e of _0x47d1b6){const _0x1bfc95=_0x45f6f6[_0x2887be(0x16f)](_0x5ce2b8=>_0x5ce2b8[_0x2887be(0x170)]===_0x2efe0e['id']);_0x1bfc95&&_0x185fe4[_0x2887be(0x164)]({'fileType':_0x1bfc95[_0x2887be(0x161)],'fileName':_0x2efe0e[_0x2887be(0x169)],'attachmentId':_0x1bfc95['Id']});}}return _0x185fe4;}async['retrieveLastComponents'](_0x3ff521){const _0x4adfe1=a279_0x1240df,_0x1a361f=await this[_0x4adfe1(0x175)](_0x3ff521);this[_0x4adfe1(0x180)]['info'](_0x4adfe1(0x17c));const _0x24c325=[];for(const _0x160aad of _0x1a361f){const _0x55b31b=await this['salesforceService']['retrieveAttachment'](_0x160aad[_0x4adfe1(0x15d)],!![]);_0x24c325[_0x4adfe1(0x164)]({'body':_0x55b31b['toString'](_0x4adfe1(0x163)),'fileName':_0x160aad[_0x4adfe1(0x171)],'fileType':_0x160aad[_0x4adfe1(0x178)]}),this['logger']['info'](_0x4adfe1(0x16b),_0x24c325[_0x4adfe1(0x17f)],_0x3ff521[_0x4adfe1(0x17f)]);}return _0x24c325;}async[a279_0x1240df(0x152)](_0x1c5f98){const _0xa4647a=a279_0x1240df;if(!_0x1c5f98[_0xa4647a(0x17f)])return[];const _0x362df3=await this[_0xa4647a(0x153)][_0xa4647a(0x183)](_0x1c5f98);return _0x362df3;}}exports[a279_0x1240df(0x15a)]=SalesforceRetrieverService;