const a203_0x1e638a=a203_0x1e36;(function(_0xa89cd1,_0x20d48c){const _0x14c61e=a203_0x1e36,_0x1b6336=_0xa89cd1();while(!![]){try{const _0x34fab2=-parseInt(_0x14c61e(0x1cd))/0x1+-parseInt(_0x14c61e(0x19b))/0x2+parseInt(_0x14c61e(0x1a0))/0x3*(parseInt(_0x14c61e(0x1b9))/0x4)+-parseInt(_0x14c61e(0x1a4))/0x5*(-parseInt(_0x14c61e(0x1c1))/0x6)+-parseInt(_0x14c61e(0x1b8))/0x7+parseInt(_0x14c61e(0x1cb))/0x8*(parseInt(_0x14c61e(0x1cf))/0x9)+-parseInt(_0x14c61e(0x1bf))/0xa*(-parseInt(_0x14c61e(0x1aa))/0xb);if(_0x34fab2===_0x20d48c)break;else _0x1b6336['push'](_0x1b6336['shift']());}catch(_0x29c459){_0x1b6336['push'](_0x1b6336['shift']());}}}(a203_0x4655,0x4c68d));const a203_0x18dd05=(function(){let _0x4627d1=!![];return function(_0x522e8b,_0x1438b0){const _0x61222e=_0x4627d1?function(){const _0x37edf9=a203_0x1e36;if(_0x1438b0){const _0x5c01b7=_0x1438b0[_0x37edf9(0x1ae)](_0x522e8b,arguments);return _0x1438b0=null,_0x5c01b7;}}:function(){};return _0x4627d1=![],_0x61222e;};}()),a203_0x63aa76=a203_0x18dd05(this,function(){const _0x12e4f6=a203_0x1e36;return a203_0x63aa76[_0x12e4f6(0x1c6)]()[_0x12e4f6(0x1ce)](_0x12e4f6(0x1c0))[_0x12e4f6(0x1c6)]()[_0x12e4f6(0x1ac)](a203_0x63aa76)[_0x12e4f6(0x1ce)]('(((.+)+)+)+$');});a203_0x63aa76();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3492c3){const _0xc2f059=a203_0x1e36;return _0x3492c3&&_0x3492c3[_0xc2f059(0x1a6)]?_0x3492c3:{'default':_0x3492c3};};function a203_0x4655(){const _0x43bc2e=['all','retrieveLastComponents','find','1548969cPWSCb','default','ids','name','56535ITCxEd','base64','__esModule','retrieveComponentIdsFromHistoryIds','fileName','splice','5181fpBqlL','../queries','constructor','components','apply','salesforceService','get','typedi','COMPONENTS_PER_QUERY','./salesforce-query.service','defineProperty','info','join','attachmentId','2885113pYUEPA','4lJkoSd','push','COMPONENTS_PER_REQUEST','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','GET_COMPONENT_HISTORIES_BY_IDS','ParentId','12940zVwsLH','(((.+)+)+)+$','18hZiXPi','query','length','map','replace','toString','%parent_ids%','run','logger','fromSalesforce','50136AAuXuU','retrieveAttachment','525961SPxIgs','search','567XPIzZp','SalesforceRetrieverService','606892HvnxQq','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest'];a203_0x4655=function(){return _0x43bc2e;};return a203_0x4655();}Object[a203_0x1e638a(0x1b4)](exports,'__esModule',{'value':!![]}),exports[a203_0x1e638a(0x19a)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require(a203_0x1e638a(0x1b1))),salesforce_query_service_1=require(a203_0x1e638a(0x1b3)),queries_1=require(a203_0x1e638a(0x1ab)),flosum_component_history_dto_1=require('../dto/flosum-component-history.dto');class SalesforceRetrieverService{constructor(_0xdf5ebf){const _0x173af4=a203_0x1e638a;this['salesforceService']=_0xdf5ebf,this[_0x173af4(0x1c9)]=new core_1['Logger'](SalesforceRetrieverService[_0x173af4(0x1a3)]),this[_0x173af4(0x1bb)]=0xbb8,this[_0x173af4(0x1b2)]=0x1f4;}async[a203_0x1e638a(0x1a7)](_0x5b3021){const _0x531bca=a203_0x1e638a;this[_0x531bca(0x1c9)]['info'](_0x531bca(0x1bc),_0x5b3021['length']);const _0x662a62=typedi_1[_0x531bca(0x1a1)][_0x531bca(0x1b0)](salesforce_query_service_1['SalesforceQueryService']),_0xa6382d=_0x5b3021[_0x531bca(0x1c4)](_0x5aa37c=>'\x27'+_0x5aa37c+'\x27'),_0x5eedea=[];while(_0xa6382d[_0x531bca(0x1c3)]){const _0xca6009=_0xa6382d['splice'](0x0,this['COMPONENTS_PER_QUERY']),_0x43153a=_0x662a62[_0x531bca(0x1c2)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x531bca(0x1c5)](_0x531bca(0x1c7),_0xca6009[_0x531bca(0x1b6)]())),_0x2078af=_0x662a62['query'](queries_1[_0x531bca(0x1bd)]['replace']('%ids%',_0xca6009[_0x531bca(0x1b6)]()))['then'](_0x3d892a=>_0x3d892a[_0x531bca(0x1c4)](_0x2633fd=>flosum_component_history_dto_1['FlosumComponentHistoryDto'][_0x531bca(0x1ca)](_0x2633fd))),[_0x1515b0,_0x3b2775]=await Promise[_0x531bca(0x19d)]([_0x43153a,_0x2078af]);for(const _0x1beacc of _0x3b2775){const _0x56c47b=_0x1515b0[_0x531bca(0x19f)](_0x30909e=>_0x30909e[_0x531bca(0x1be)]===_0x1beacc['id']);_0x56c47b&&_0x5eedea[_0x531bca(0x1ba)]({'fileType':_0x56c47b['Name'],'fileName':_0x1beacc['filename'],'attachmentId':_0x56c47b['Id']});}}return _0x5eedea;}async[a203_0x1e638a(0x19e)](_0x25bb39){const _0x3efa19=a203_0x1e638a,_0x4656f7=await this[_0x3efa19(0x1a7)](_0x25bb39);this[_0x3efa19(0x1c9)][_0x3efa19(0x1b5)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x365a1e=[];for(const _0x526ef5 of _0x4656f7){const _0x3eef56=await this[_0x3efa19(0x1af)][_0x3efa19(0x1cc)](_0x526ef5[_0x3efa19(0x1b7)],!![]);_0x365a1e[_0x3efa19(0x1ba)]({'body':_0x3eef56[_0x3efa19(0x1c6)](_0x3efa19(0x1a5)),'fileName':_0x526ef5[_0x3efa19(0x1a8)],'fileType':_0x526ef5['fileType']}),this[_0x3efa19(0x1c9)][_0x3efa19(0x1b5)]('manually\x20retrieved\x20%d/%d\x20components',_0x365a1e[_0x3efa19(0x1c3)],_0x25bb39['length']);}return _0x365a1e;}async[a203_0x1e638a(0x1c8)](_0x387a01){const _0x286e3c=a203_0x1e638a,_0x2e7419=[..._0x387a01],_0x2f66d9=[],_0x451ce4=[];while(_0x2e7419['length']){const _0x576c8c=_0x2e7419[_0x286e3c(0x1a9)](0x0,this['COMPONENTS_PER_REQUEST']),_0x4433a7=await this[_0x286e3c(0x1af)]['retrieveComponents'](_0x576c8c);_0x576c8c[_0x286e3c(0x1c3)]!==_0x4433a7[_0x286e3c(0x1a2)][_0x286e3c(0x1c3)]?(_0x2e7419[_0x286e3c(0x1ba)](..._0x4433a7[_0x286e3c(0x1a2)]),_0x2f66d9[_0x286e3c(0x1ba)](..._0x4433a7[_0x286e3c(0x1ad)])):_0x451ce4[_0x286e3c(0x1ba)](..._0x576c8c),this[_0x286e3c(0x1c9)]['log'](_0x286e3c(0x19c),_0x387a01[_0x286e3c(0x1c3)]-_0x2e7419[_0x286e3c(0x1c3)],_0x387a01['length']);}if(_0x451ce4['length']){const _0x486b9d=await this['retrieveLastComponents'](_0x451ce4);_0x2f66d9[_0x286e3c(0x1ba)](..._0x486b9d);}return _0x2f66d9;}}function a203_0x1e36(_0xb36217,_0x194585){const _0x20523b=a203_0x4655();return a203_0x1e36=function(_0x63aa76,_0x18dd05){_0x63aa76=_0x63aa76-0x19a;let _0x465584=_0x20523b[_0x63aa76];return _0x465584;},a203_0x1e36(_0xb36217,_0x194585);}exports[a203_0x1e638a(0x19a)]=SalesforceRetrieverService;