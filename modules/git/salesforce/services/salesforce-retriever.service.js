const a252_0x1320f3=a252_0x2cbf;(function(_0x3fd1f8,_0x338692){const _0xecfe9c=a252_0x2cbf,_0x4b79f5=_0x3fd1f8();while(!![]){try{const _0x121f7c=-parseInt(_0xecfe9c(0x1d1))/0x1+parseInt(_0xecfe9c(0x1d5))/0x2*(parseInt(_0xecfe9c(0x1cd))/0x3)+parseInt(_0xecfe9c(0x1c1))/0x4+-parseInt(_0xecfe9c(0x1a8))/0x5+-parseInt(_0xecfe9c(0x1ba))/0x6+-parseInt(_0xecfe9c(0x1c2))/0x7*(-parseInt(_0xecfe9c(0x1ae))/0x8)+parseInt(_0xecfe9c(0x1b5))/0x9;if(_0x121f7c===_0x338692)break;else _0x4b79f5['push'](_0x4b79f5['shift']());}catch(_0x2396f1){_0x4b79f5['push'](_0x4b79f5['shift']());}}}(a252_0x1d76,0xc4684));const a252_0x5a476b=(function(){let _0xb1f609=!![];return function(_0xe6ee5a,_0xcace0b){const _0x127079=_0xb1f609?function(){if(_0xcace0b){const _0x56f0c4=_0xcace0b['apply'](_0xe6ee5a,arguments);return _0xcace0b=null,_0x56f0c4;}}:function(){};return _0xb1f609=![],_0x127079;};}()),a252_0x529d35=a252_0x5a476b(this,function(){const _0xa0ca8=a252_0x2cbf;return a252_0x529d35[_0xa0ca8(0x1ce)]()['search'](_0xa0ca8(0x19f))['toString']()[_0xa0ca8(0x1ca)](a252_0x529d35)[_0xa0ca8(0x1d6)]('(((.+)+)+)+$');});a252_0x529d35();'use strict';function a252_0x2cbf(_0x524c86,_0x41eef5){const _0x11d1a8=a252_0x1d76();return a252_0x2cbf=function(_0x529d35,_0x5a476b){_0x529d35=_0x529d35-0x19e;let _0x1d76a7=_0x11d1a8[_0x529d35];return _0x1d76a7;},a252_0x2cbf(_0x524c86,_0x41eef5);}var __importDefault=this&&this['__importDefault']||function(_0x195264){const _0x358e43=a252_0x2cbf;return _0x195264&&_0x195264[_0x358e43(0x1b0)]?_0x195264:{'default':_0x195264};};Object[a252_0x1320f3(0x19e)](exports,a252_0x1320f3(0x1b0),{'value':!![]}),exports[a252_0x1320f3(0x1b4)]=void 0x0;const core_1=require(a252_0x1320f3(0x1b1)),typedi_1=__importDefault(require(a252_0x1320f3(0x1a6))),salesforce_query_service_1=require(a252_0x1320f3(0x1cf)),queries_1=require(a252_0x1320f3(0x1ab)),flosum_component_history_dto_1=require('../dto/flosum-component-history.dto');function a252_0x1d76(){const _0x409e05=['attachmentId','SalesforceQueryService','Manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','splice','constructor','then','%ids%','441rHbFyJ','toString','./salesforce-query.service','salesforceService','685215pYDyif','filename','fileName','Manually\x20retrieving\x20components\x20from\x20salesforce','5634WiBBpf','search','defineProperty','(((.+)+)+)+$','push','all','retrieveAttachment','ids','run','COMPONENTS_PER_QUERY','typedi','logger','2813975Hgzafg','join','length','../queries','GET_COMPONENT_HISTORIES_BY_IDS','Manually\x20retrieved\x20%d/%d\x20components','3632AzUeKp','query','__esModule','../../../../core','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','%parent_ids%','SalesforceRetrieverService','2508336sZYcBE','ParentId','COMPONENTS_PER_REQUEST','Logger','Retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','7991580ySpHhR','find','components','get','default','log','retrieveLastComponents','6061228ostRyE','18137nahWcQ','replace','info','retrieveComponentIdsFromHistoryIds'];a252_0x1d76=function(){return _0x409e05;};return a252_0x1d76();}class SalesforceRetrieverService{constructor(_0x1e34d3){const _0x51adb3=a252_0x1320f3;this[_0x51adb3(0x1d0)]=_0x1e34d3,this[_0x51adb3(0x1a7)]=new core_1[(_0x51adb3(0x1b8))](SalesforceRetrieverService['name']),this[_0x51adb3(0x1b7)]=0xbb8,this[_0x51adb3(0x1a5)]=0x1f4;}async[a252_0x1320f3(0x1c5)](_0x4a26c4){const _0x58bf0c=a252_0x1320f3;this['logger']['info'](_0x58bf0c(0x1c8),_0x4a26c4[_0x58bf0c(0x1aa)]);const _0x4dc5dc=typedi_1[_0x58bf0c(0x1be)][_0x58bf0c(0x1bd)](salesforce_query_service_1[_0x58bf0c(0x1c7)]),_0x36ba41=_0x4a26c4['map'](_0xe6746d=>'\x27'+_0xe6746d+'\x27'),_0x158a3d=[];while(_0x36ba41[_0x58bf0c(0x1aa)]){const _0x5f5560=_0x36ba41[_0x58bf0c(0x1c9)](0x0,this[_0x58bf0c(0x1a5)]),_0xbe652d=_0x4dc5dc[_0x58bf0c(0x1af)](queries_1[_0x58bf0c(0x1b2)][_0x58bf0c(0x1c3)](_0x58bf0c(0x1b3),_0x5f5560[_0x58bf0c(0x1a9)]())),_0x43dd45=_0x4dc5dc['query'](queries_1[_0x58bf0c(0x1ac)]['replace'](_0x58bf0c(0x1cc),_0x5f5560[_0x58bf0c(0x1a9)]()))[_0x58bf0c(0x1cb)](_0x209fa3=>_0x209fa3['map'](_0x55d4db=>flosum_component_history_dto_1['FlosumComponentHistoryDto']['fromSalesforce'](_0x55d4db))),[_0x194b76,_0x2415fc]=await Promise[_0x58bf0c(0x1a1)]([_0xbe652d,_0x43dd45]);for(const _0xb0d8a6 of _0x2415fc){const _0x1678d5=_0x194b76[_0x58bf0c(0x1bb)](_0x23456c=>_0x23456c[_0x58bf0c(0x1b6)]===_0xb0d8a6['id']);_0x1678d5&&_0x158a3d[_0x58bf0c(0x1a0)]({'fileType':_0x1678d5['Name'],'fileName':_0xb0d8a6[_0x58bf0c(0x1d2)],'attachmentId':_0x1678d5['Id']});}}return _0x158a3d;}async['retrieveLastComponents'](_0x376bbc){const _0x1c942d=a252_0x1320f3,_0x28d0dc=await this[_0x1c942d(0x1c5)](_0x376bbc);this['logger'][_0x1c942d(0x1c4)](_0x1c942d(0x1d4));const _0x14b416=[];for(const _0x3e623e of _0x28d0dc){const _0x940f4b=await this[_0x1c942d(0x1d0)][_0x1c942d(0x1a2)](_0x3e623e[_0x1c942d(0x1c6)],!![]);_0x14b416['push']({'body':_0x940f4b[_0x1c942d(0x1ce)]('base64'),'fileName':_0x3e623e[_0x1c942d(0x1d3)],'fileType':_0x3e623e['fileType']}),this[_0x1c942d(0x1a7)][_0x1c942d(0x1c4)](_0x1c942d(0x1ad),_0x14b416[_0x1c942d(0x1aa)],_0x376bbc[_0x1c942d(0x1aa)]);}return _0x14b416;}async[a252_0x1320f3(0x1a4)](_0x315273){const _0xdd21dd=a252_0x1320f3,_0x40433b=[..._0x315273],_0x1ffd3a=[],_0xcf1a8a=[];while(_0x40433b[_0xdd21dd(0x1aa)]){const _0x4c41ad=_0x40433b[_0xdd21dd(0x1c9)](0x0,this[_0xdd21dd(0x1b7)]),_0x3681e0=await this['salesforceService']['retrieveComponents'](_0x4c41ad);_0x4c41ad[_0xdd21dd(0x1aa)]!==_0x3681e0[_0xdd21dd(0x1a3)][_0xdd21dd(0x1aa)]?(_0x40433b[_0xdd21dd(0x1a0)](..._0x3681e0[_0xdd21dd(0x1a3)]),_0x1ffd3a[_0xdd21dd(0x1a0)](..._0x3681e0[_0xdd21dd(0x1bc)])):_0xcf1a8a[_0xdd21dd(0x1a0)](..._0x4c41ad),this[_0xdd21dd(0x1a7)][_0xdd21dd(0x1bf)](_0xdd21dd(0x1b9),_0x315273[_0xdd21dd(0x1aa)]-_0x40433b[_0xdd21dd(0x1aa)],_0x315273[_0xdd21dd(0x1aa)]);}if(_0xcf1a8a['length']){const _0x3ec5d1=await this[_0xdd21dd(0x1c0)](_0xcf1a8a);_0x1ffd3a[_0xdd21dd(0x1a0)](..._0x3ec5d1);}return _0x1ffd3a;}}exports[a252_0x1320f3(0x1b4)]=SalesforceRetrieverService;