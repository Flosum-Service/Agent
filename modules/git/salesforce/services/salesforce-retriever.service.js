const a203_0x58e21b=a203_0x146a;(function(_0xd8fac5,_0x218218){const _0x2a0cd9=a203_0x146a,_0x3a7c4d=_0xd8fac5();while(!![]){try{const _0x3bf204=-parseInt(_0x2a0cd9(0xc1))/0x1+parseInt(_0x2a0cd9(0x9f))/0x2+parseInt(_0x2a0cd9(0xba))/0x3*(-parseInt(_0x2a0cd9(0x95))/0x4)+-parseInt(_0x2a0cd9(0xa4))/0x5+-parseInt(_0x2a0cd9(0xc2))/0x6*(parseInt(_0x2a0cd9(0xa3))/0x7)+parseInt(_0x2a0cd9(0xb5))/0x8*(-parseInt(_0x2a0cd9(0xa2))/0x9)+parseInt(_0x2a0cd9(0xb0))/0xa;if(_0x3bf204===_0x218218)break;else _0x3a7c4d['push'](_0x3a7c4d['shift']());}catch(_0x26cfc2){_0x3a7c4d['push'](_0x3a7c4d['shift']());}}}(a203_0x5184,0x69173));const a203_0x535054=(function(){let _0x5097f3=!![];return function(_0x523278,_0x2a1aac){const _0x47dbf0=_0x5097f3?function(){const _0x8e9f44=a203_0x146a;if(_0x2a1aac){const _0x122e78=_0x2a1aac[_0x8e9f44(0x8a)](_0x523278,arguments);return _0x2a1aac=null,_0x122e78;}}:function(){};return _0x5097f3=![],_0x47dbf0;};}()),a203_0x34cd6e=a203_0x535054(this,function(){const _0x47f731=a203_0x146a;return a203_0x34cd6e[_0x47f731(0x8d)]()[_0x47f731(0x93)](_0x47f731(0xb9))['toString']()[_0x47f731(0x90)](a203_0x34cd6e)[_0x47f731(0x93)](_0x47f731(0xb9));});a203_0x34cd6e();'use strict';var __importDefault=this&&this[a203_0x58e21b(0x8f)]||function(_0x575e58){const _0x4ff76b=a203_0x58e21b;return _0x575e58&&_0x575e58[_0x4ff76b(0x97)]?_0x575e58:{'default':_0x575e58};};Object['defineProperty'](exports,a203_0x58e21b(0x97),{'value':!![]}),exports['SalesforceRetrieverService']=void 0x0;function a203_0x146a(_0x3337b6,_0x537e3d){const _0x30ff01=a203_0x5184();return a203_0x146a=function(_0x34cd6e,_0x535054){_0x34cd6e=_0x34cd6e-0x84;let _0x51849c=_0x30ff01[_0x34cd6e];return _0x51849c;},a203_0x146a(_0x3337b6,_0x537e3d);}function a203_0x5184(){const _0x3994a5=['typedi','600320BaICiv','30522EWuGYF','info','name','base64','replace','FlosumComponentHistoryDto','fileType','apply','logger','retrieveAttachment','toString','all','__importDefault','constructor','%ids%','find','search','Logger','708vfmRLA','map','__esModule','../dto/flosum-component-history.dto','../queries','ids','manually\x20retrieving\x20components\x20from\x20salesforce','default','ParentId','query','1280040YtHuDE','COMPONENTS_PER_QUERY','length','192771BhDkmN','777rEawoV','3927695jOlKYd','SalesforceRetrieverService','./salesforce-query.service','components','fileName','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','SalesforceQueryService','GET_COMPONENT_HISTORIES_BY_IDS','run','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','COMPONENTS_PER_REQUEST','%parent_ids%','26063600hFFTXB','../../../../core','splice','then','fromSalesforce','240FWPIwT','log','Name','push','(((.+)+)+)+$','3777ERGoiq','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','salesforceService','join','retrieveLastComponents','manually\x20retrieved\x20%d/%d\x20components'];a203_0x5184=function(){return _0x3994a5;};return a203_0x5184();}const core_1=require(a203_0x58e21b(0xb1)),typedi_1=__importDefault(require(a203_0x58e21b(0xc0))),salesforce_query_service_1=require(a203_0x58e21b(0xa6)),queries_1=require(a203_0x58e21b(0x99)),flosum_component_history_dto_1=require(a203_0x58e21b(0x98));class SalesforceRetrieverService{constructor(_0x977c7b){const _0x5604dd=a203_0x58e21b;this[_0x5604dd(0xbc)]=_0x977c7b,this[_0x5604dd(0x8b)]=new core_1[(_0x5604dd(0x94))](SalesforceRetrieverService[_0x5604dd(0x85)]),this['COMPONENTS_PER_REQUEST']=0xbb8,this[_0x5604dd(0xa0)]=0x1f4;}async['retrieveComponentIdsFromHistoryIds'](_0x1884d8){const _0x4b763c=a203_0x58e21b;this[_0x4b763c(0x8b)][_0x4b763c(0x84)](_0x4b763c(0xbb),_0x1884d8[_0x4b763c(0xa1)]);const _0x5dc9dd=typedi_1[_0x4b763c(0x9c)]['get'](salesforce_query_service_1[_0x4b763c(0xaa)]),_0x5108df=_0x1884d8[_0x4b763c(0x96)](_0x4aaff5=>'\x27'+_0x4aaff5+'\x27'),_0x590677=[];while(_0x5108df['length']){const _0x39acb5=_0x5108df[_0x4b763c(0xb2)](0x0,this['COMPONENTS_PER_QUERY']),_0x57e8c6=_0x5dc9dd[_0x4b763c(0x9e)](queries_1[_0x4b763c(0xad)][_0x4b763c(0x87)](_0x4b763c(0xaf),_0x39acb5['join']())),_0x5a8a91=_0x5dc9dd[_0x4b763c(0x9e)](queries_1[_0x4b763c(0xab)][_0x4b763c(0x87)](_0x4b763c(0x91),_0x39acb5[_0x4b763c(0xbd)]()))[_0x4b763c(0xb3)](_0x50ce69=>_0x50ce69[_0x4b763c(0x96)](_0x3699f7=>flosum_component_history_dto_1[_0x4b763c(0x88)][_0x4b763c(0xb4)](_0x3699f7))),[_0x33cf2f,_0x352b15]=await Promise[_0x4b763c(0x8e)]([_0x57e8c6,_0x5a8a91]);for(const _0x266945 of _0x352b15){const _0xa6b8b6=_0x33cf2f[_0x4b763c(0x92)](_0x425ce0=>_0x425ce0[_0x4b763c(0x9d)]===_0x266945['id']);_0xa6b8b6&&_0x590677[_0x4b763c(0xb8)]({'fileType':_0xa6b8b6[_0x4b763c(0xb7)],'fileName':_0x266945['filename'],'attachmentId':_0xa6b8b6['Id']});}}return _0x590677;}async['retrieveLastComponents'](_0x355e5f){const _0x4d8300=a203_0x58e21b,_0x45c63f=await this['retrieveComponentIdsFromHistoryIds'](_0x355e5f);this[_0x4d8300(0x8b)][_0x4d8300(0x84)](_0x4d8300(0x9b));const _0x3f3551=[];for(const _0x516b56 of _0x45c63f){const _0x5a50ad=await this[_0x4d8300(0xbc)][_0x4d8300(0x8c)](_0x516b56['attachmentId'],!![]);_0x3f3551[_0x4d8300(0xb8)]({'body':_0x5a50ad[_0x4d8300(0x8d)](_0x4d8300(0x86)),'fileName':_0x516b56[_0x4d8300(0xa8)],'fileType':_0x516b56[_0x4d8300(0x89)]}),this[_0x4d8300(0x8b)][_0x4d8300(0x84)](_0x4d8300(0xbf),_0x3f3551[_0x4d8300(0xa1)],_0x355e5f[_0x4d8300(0xa1)]);}return _0x3f3551;}async[a203_0x58e21b(0xac)](_0x1a4ec9){const _0x2fbba0=a203_0x58e21b,_0x551725=[..._0x1a4ec9],_0x3bec3a=[],_0x33fd1c=[];while(_0x551725['length']){const _0x58f00f=_0x551725[_0x2fbba0(0xb2)](0x0,this[_0x2fbba0(0xae)]),_0x5c052e=await this[_0x2fbba0(0xbc)]['retrieveComponents'](_0x58f00f);_0x58f00f[_0x2fbba0(0xa1)]!==_0x5c052e[_0x2fbba0(0x9a)][_0x2fbba0(0xa1)]?(_0x551725[_0x2fbba0(0xb8)](..._0x5c052e[_0x2fbba0(0x9a)]),_0x3bec3a['push'](..._0x5c052e[_0x2fbba0(0xa7)])):_0x33fd1c['push'](..._0x58f00f),this[_0x2fbba0(0x8b)][_0x2fbba0(0xb6)](_0x2fbba0(0xa9),_0x1a4ec9[_0x2fbba0(0xa1)]-_0x551725[_0x2fbba0(0xa1)],_0x1a4ec9[_0x2fbba0(0xa1)]);}if(_0x33fd1c[_0x2fbba0(0xa1)]){const _0x700c01=await this[_0x2fbba0(0xbe)](_0x33fd1c);_0x3bec3a[_0x2fbba0(0xb8)](..._0x700c01);}return _0x3bec3a;}}exports[a203_0x58e21b(0xa5)]=SalesforceRetrieverService;