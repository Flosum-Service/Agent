const a279_0x40a1df=a279_0x5ab6;function a279_0x40d8(){const _0x2697fd=['__esModule','apply','all','fromSalesforce','splice','5035541dKhabx','info','find','logger','Name','9auaiFj','map','get','78BHGVft','run','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','retrieveAttachment','push','7060792soCMmw','length','__importDefault','GET_COMPONENT_HISTORIES_BY_IDS','ParentId','SalesforceQueryService','3TeACZF','join','238955rZXQKs','SalesforceRetrieverService','141054RXHywZ','attachmentId','toString','base64','then','625868sDskGT','typedi','constructor','70LUIoMi','344971tojiRA','COMPONENTS_PER_REQUEST','fileName','salesforceService','query','(((.+)+)+)+$','../dto/flosum-component-history.dto','Logger','%parent_ids%','COMPONENTS_PER_QUERY','4920276dlaenH','retrieveComponentIdsFromHistoryIds','search','replace','fileType','15YFvFhT','../queries'];a279_0x40d8=function(){return _0x2697fd;};return a279_0x40d8();}(function(_0x3772cd,_0x23c87b){const _0x228225=a279_0x5ab6,_0x473ac1=_0x3772cd();while(!![]){try{const _0x22f169=parseInt(_0x228225(0x175))/0x1*(parseInt(_0x228225(0x193))/0x2)+parseInt(_0x228225(0x18f))/0x3*(parseInt(_0x228225(0x162))/0x4)+-parseInt(_0x228225(0x191))/0x5*(parseInt(_0x228225(0x184))/0x6)+parseInt(_0x228225(0x17c))/0x7+-parseInt(_0x228225(0x189))/0x8*(parseInt(_0x228225(0x181))/0x9)+-parseInt(_0x228225(0x165))/0xa*(parseInt(_0x228225(0x166))/0xb)+parseInt(_0x228225(0x170))/0xc;if(_0x22f169===_0x23c87b)break;else _0x473ac1['push'](_0x473ac1['shift']());}catch(_0x3c04d2){_0x473ac1['push'](_0x473ac1['shift']());}}}(a279_0x40d8,0x9773d));const a279_0x22b843=(function(){let _0x2a8d6c=!![];return function(_0x5bb282,_0xee065b){const _0x2a0518=_0x2a8d6c?function(){const _0x1ccafb=a279_0x5ab6;if(_0xee065b){const _0x16b132=_0xee065b[_0x1ccafb(0x178)](_0x5bb282,arguments);return _0xee065b=null,_0x16b132;}}:function(){};return _0x2a8d6c=![],_0x2a0518;};}()),a279_0x52d16b=a279_0x22b843(this,function(){const _0x343ed7=a279_0x5ab6;return a279_0x52d16b[_0x343ed7(0x195)]()[_0x343ed7(0x172)](_0x343ed7(0x16b))[_0x343ed7(0x195)]()[_0x343ed7(0x164)](a279_0x52d16b)[_0x343ed7(0x172)](_0x343ed7(0x16b));});a279_0x52d16b();'use strict';function a279_0x5ab6(_0x2483f0,_0x1bd45e){const _0x52026e=a279_0x40d8();return a279_0x5ab6=function(_0x52d16b,_0x22b843){_0x52d16b=_0x52d16b-0x161;let _0x40d80e=_0x52026e[_0x52d16b];return _0x40d80e;},a279_0x5ab6(_0x2483f0,_0x1bd45e);}var __importDefault=this&&this[a279_0x40a1df(0x18b)]||function(_0x10c662){const _0x30d598=a279_0x40a1df;return _0x10c662&&_0x10c662[_0x30d598(0x177)]?_0x10c662:{'default':_0x10c662};};Object['defineProperty'](exports,a279_0x40a1df(0x177),{'value':!![]}),exports[a279_0x40a1df(0x192)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require(a279_0x40a1df(0x163))),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a279_0x40a1df(0x176)),flosum_component_history_dto_1=require(a279_0x40a1df(0x16c));class SalesforceRetrieverService{constructor(_0x31f18a){const _0x35ccd3=a279_0x40a1df;this[_0x35ccd3(0x169)]=_0x31f18a,this['logger']=new core_1[(_0x35ccd3(0x16d))](SalesforceRetrieverService['name']),this[_0x35ccd3(0x167)]=0xbb8,this['COMPONENTS_PER_QUERY']=0x1f4;}async[a279_0x40a1df(0x171)](_0x311341){const _0xbcef87=a279_0x40a1df;this['logger'][_0xbcef87(0x17d)]('Manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x311341['length']);const _0x2de279=typedi_1['default'][_0xbcef87(0x183)](salesforce_query_service_1[_0xbcef87(0x18e)]),_0x37c99d=_0x311341[_0xbcef87(0x182)](_0x4eeb70=>'\x27'+_0x4eeb70+'\x27'),_0x2cbf26=[];while(_0x37c99d['length']){const _0x5807d0=_0x37c99d[_0xbcef87(0x17b)](0x0,this[_0xbcef87(0x16f)]),_0x1c6047=_0x2de279[_0xbcef87(0x16a)](queries_1[_0xbcef87(0x186)]['replace'](_0xbcef87(0x16e),_0x5807d0[_0xbcef87(0x190)]())),_0x2e9eb9=_0x2de279['query'](queries_1[_0xbcef87(0x18c)][_0xbcef87(0x173)]('%ids%',_0x5807d0['join']()))[_0xbcef87(0x161)](_0x5ccc81=>_0x5ccc81[_0xbcef87(0x182)](_0x8fd566=>flosum_component_history_dto_1['FlosumComponentHistoryDto'][_0xbcef87(0x17a)](_0x8fd566))),[_0xd3a896,_0x23d4e6]=await Promise[_0xbcef87(0x179)]([_0x1c6047,_0x2e9eb9]);for(const _0x111cde of _0x23d4e6){const _0x4d369d=_0xd3a896[_0xbcef87(0x17e)](_0x36233f=>_0x36233f[_0xbcef87(0x18d)]===_0x111cde['id']);_0x4d369d&&_0x2cbf26[_0xbcef87(0x188)]({'fileType':_0x4d369d[_0xbcef87(0x180)],'fileName':_0x111cde['filename'],'attachmentId':_0x4d369d['Id']});}}return _0x2cbf26;}async['retrieveLastComponents'](_0x1d5e25){const _0x2633ad=a279_0x40a1df,_0x268e4e=await this[_0x2633ad(0x171)](_0x1d5e25);this[_0x2633ad(0x17f)][_0x2633ad(0x17d)]('Manually\x20retrieving\x20components\x20from\x20salesforce');const _0x1d5fc2=[];for(const _0x4f9e4e of _0x268e4e){const _0x29c402=await this[_0x2633ad(0x169)][_0x2633ad(0x187)](_0x4f9e4e[_0x2633ad(0x194)],!![]);_0x1d5fc2[_0x2633ad(0x188)]({'body':_0x29c402[_0x2633ad(0x195)](_0x2633ad(0x196)),'fileName':_0x4f9e4e[_0x2633ad(0x168)],'fileType':_0x4f9e4e[_0x2633ad(0x174)]}),this[_0x2633ad(0x17f)]['info']('Manually\x20retrieved\x20%d/%d\x20components',_0x1d5fc2[_0x2633ad(0x18a)],_0x1d5e25['length']);}return _0x1d5fc2;}async[a279_0x40a1df(0x185)](_0x4acdb6){const _0x22a2c0=a279_0x40a1df;if(!_0x4acdb6[_0x22a2c0(0x18a)])return[];const _0x1573d2=await this[_0x22a2c0(0x169)]['retrieveComponents'](_0x4acdb6);return _0x1573d2;}}exports[a279_0x40a1df(0x192)]=SalesforceRetrieverService;