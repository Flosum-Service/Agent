const a237_0x2e9b8a=a237_0x3eae;(function(_0x31c733,_0x342630){const _0x597237=a237_0x3eae,_0x49227f=_0x31c733();while(!![]){try{const _0x2f1a2c=parseInt(_0x597237(0x9c))/0x1+parseInt(_0x597237(0xb2))/0x2+parseInt(_0x597237(0x9a))/0x3+parseInt(_0x597237(0xb9))/0x4*(-parseInt(_0x597237(0xb3))/0x5)+-parseInt(_0x597237(0xbc))/0x6*(parseInt(_0x597237(0x8e))/0x7)+-parseInt(_0x597237(0x99))/0x8*(-parseInt(_0x597237(0xa6))/0x9)+-parseInt(_0x597237(0xac))/0xa*(-parseInt(_0x597237(0xba))/0xb);if(_0x2f1a2c===_0x342630)break;else _0x49227f['push'](_0x49227f['shift']());}catch(_0x19c457){_0x49227f['push'](_0x49227f['shift']());}}}(a237_0x219a,0x8ad00));const a237_0x39ea30=(function(){let _0x534ae3=!![];return function(_0x76bf73,_0x4bc7d5){const _0x4d34e1=_0x534ae3?function(){if(_0x4bc7d5){const _0x187024=_0x4bc7d5['apply'](_0x76bf73,arguments);return _0x4bc7d5=null,_0x187024;}}:function(){};return _0x534ae3=![],_0x4d34e1;};}()),a237_0x386a5f=a237_0x39ea30(this,function(){const _0x2ad1b5=a237_0x3eae;return a237_0x386a5f['toString']()[_0x2ad1b5(0x8c)](_0x2ad1b5(0xb4))['toString']()[_0x2ad1b5(0x9f)](a237_0x386a5f)[_0x2ad1b5(0x8c)](_0x2ad1b5(0xb4));});a237_0x386a5f();'use strict';var __importDefault=this&&this[a237_0x2e9b8a(0xc4)]||function(_0x493ba0){const _0x2e78fd=a237_0x2e9b8a;return _0x493ba0&&_0x493ba0[_0x2e78fd(0xc5)]?_0x493ba0:{'default':_0x493ba0};};Object[a237_0x2e9b8a(0xa5)](exports,a237_0x2e9b8a(0xc5),{'value':!![]}),exports[a237_0x2e9b8a(0x8d)]=void 0x0;function a237_0x3eae(_0x4468af,_0x7d528b){const _0x481b64=a237_0x219a();return a237_0x3eae=function(_0x386a5f,_0x39ea30){_0x386a5f=_0x386a5f-0x8c;let _0x219a63=_0x481b64[_0x386a5f];return _0x219a63;},a237_0x3eae(_0x4468af,_0x7d528b);}function a237_0x219a(){const _0x9c13c3=['base64','components','retrieveComponentIdsFromHistoryIds','find','length','defineProperty','52911JajQKt','COMPONENTS_PER_REQUEST','FlosumComponentHistoryDto','salesforceService','query','all','156730wwbdHw','../queries','attachmentId','splice','Logger','info','1371282miDVom','323585MkQwys','(((.+)+)+)+$','retrieveAttachment','%parent_ids%','get','manually\x20retrieving\x20components\x20from\x20salesforce','68ARRZad','407rUFqGa','../../../../core','4565586ucIuix','log','COMPONENTS_PER_QUERY','name','map','ids','push','manually\x20retrieved\x20%d/%d\x20components','__importDefault','__esModule','search','SalesforceRetrieverService','7rNkOYN','%ids%','GET_COMPONENT_HISTORIES_BY_IDS','replace','fromSalesforce','then','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','logger','default','retrieveLastComponents','toString','848oiyRZB','1311807kayltk','join','103711eGDxBW','fileName','fileType','constructor'];a237_0x219a=function(){return _0x9c13c3;};return a237_0x219a();}const core_1=require(a237_0x2e9b8a(0xbb)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a237_0x2e9b8a(0xad)),flosum_component_history_dto_1=require('../dto/flosum-component-history.dto');class SalesforceRetrieverService{constructor(_0x8f00b3){const _0x4171f8=a237_0x2e9b8a;this[_0x4171f8(0xa9)]=_0x8f00b3,this[_0x4171f8(0x95)]=new core_1[(_0x4171f8(0xb0))](SalesforceRetrieverService[_0x4171f8(0xbf)]),this[_0x4171f8(0xa7)]=0xbb8,this[_0x4171f8(0xbe)]=0x1f4;}async[a237_0x2e9b8a(0xa2)](_0x7ee6b3){const _0x321df6=a237_0x2e9b8a;this[_0x321df6(0x95)]['info']('manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x7ee6b3[_0x321df6(0xa4)]);const _0x3432c4=typedi_1[_0x321df6(0x96)][_0x321df6(0xb7)](salesforce_query_service_1['SalesforceQueryService']),_0x594e3c=_0x7ee6b3[_0x321df6(0xc0)](_0x29f352=>'\x27'+_0x29f352+'\x27'),_0x5e4bfb=[];while(_0x594e3c['length']){const _0x280aa4=_0x594e3c['splice'](0x0,this['COMPONENTS_PER_QUERY']),_0x129331=_0x3432c4[_0x321df6(0xaa)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY']['replace'](_0x321df6(0xb6),_0x280aa4[_0x321df6(0x9b)]())),_0x42a6a7=_0x3432c4[_0x321df6(0xaa)](queries_1[_0x321df6(0x90)][_0x321df6(0x91)](_0x321df6(0x8f),_0x280aa4['join']()))[_0x321df6(0x93)](_0x6c9c25=>_0x6c9c25[_0x321df6(0xc0)](_0x2f43c6=>flosum_component_history_dto_1[_0x321df6(0xa8)][_0x321df6(0x92)](_0x2f43c6))),[_0x2e2786,_0x300efb]=await Promise[_0x321df6(0xab)]([_0x129331,_0x42a6a7]);for(const _0x24dc89 of _0x300efb){const _0x2291eb=_0x2e2786[_0x321df6(0xa3)](_0x25a189=>_0x25a189['ParentId']===_0x24dc89['id']);_0x2291eb&&_0x5e4bfb[_0x321df6(0xc2)]({'fileType':_0x2291eb['Name'],'fileName':_0x24dc89['filename'],'attachmentId':_0x2291eb['Id']});}}return _0x5e4bfb;}async[a237_0x2e9b8a(0x97)](_0x4a66b5){const _0x70149a=a237_0x2e9b8a,_0x537a03=await this[_0x70149a(0xa2)](_0x4a66b5);this[_0x70149a(0x95)]['info'](_0x70149a(0xb8));const _0x1b0961=[];for(const _0x5353db of _0x537a03){const _0x585bd9=await this[_0x70149a(0xa9)][_0x70149a(0xb5)](_0x5353db[_0x70149a(0xae)],!![]);_0x1b0961[_0x70149a(0xc2)]({'body':_0x585bd9[_0x70149a(0x98)](_0x70149a(0xa0)),'fileName':_0x5353db[_0x70149a(0x9d)],'fileType':_0x5353db[_0x70149a(0x9e)]}),this[_0x70149a(0x95)][_0x70149a(0xb1)](_0x70149a(0xc3),_0x1b0961[_0x70149a(0xa4)],_0x4a66b5[_0x70149a(0xa4)]);}return _0x1b0961;}async['run'](_0x4526db){const _0x1d86f9=a237_0x2e9b8a,_0x5e9142=[..._0x4526db],_0x1ca1db=[],_0x45fd6b=[];while(_0x5e9142[_0x1d86f9(0xa4)]){const _0x389e82=_0x5e9142[_0x1d86f9(0xaf)](0x0,this[_0x1d86f9(0xa7)]),_0x51a050=await this[_0x1d86f9(0xa9)]['retrieveComponents'](_0x389e82);_0x389e82['length']!==_0x51a050[_0x1d86f9(0xc1)][_0x1d86f9(0xa4)]?(_0x5e9142[_0x1d86f9(0xc2)](..._0x51a050[_0x1d86f9(0xc1)]),_0x1ca1db[_0x1d86f9(0xc2)](..._0x51a050[_0x1d86f9(0xa1)])):_0x45fd6b[_0x1d86f9(0xc2)](..._0x389e82),this[_0x1d86f9(0x95)][_0x1d86f9(0xbd)](_0x1d86f9(0x94),_0x4526db[_0x1d86f9(0xa4)]-_0x5e9142[_0x1d86f9(0xa4)],_0x4526db[_0x1d86f9(0xa4)]);}if(_0x45fd6b[_0x1d86f9(0xa4)]){const _0x47262a=await this[_0x1d86f9(0x97)](_0x45fd6b);_0x1ca1db[_0x1d86f9(0xc2)](..._0x47262a);}return _0x1ca1db;}}exports[a237_0x2e9b8a(0x8d)]=SalesforceRetrieverService;