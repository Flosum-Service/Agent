const a190_0x4bf6b7=a190_0x2b3f;(function(_0x9d1cdb,_0x29c29b){const _0x431795=a190_0x2b3f,_0x2ff8d1=_0x9d1cdb();while(!![]){try{const _0x5e1486=-parseInt(_0x431795(0x149))/0x1*(-parseInt(_0x431795(0x16c))/0x2)+-parseInt(_0x431795(0x13e))/0x3+parseInt(_0x431795(0x15a))/0x4+-parseInt(_0x431795(0x169))/0x5*(parseInt(_0x431795(0x166))/0x6)+parseInt(_0x431795(0x143))/0x7+-parseInt(_0x431795(0x14b))/0x8*(parseInt(_0x431795(0x15c))/0x9)+parseInt(_0x431795(0x16a))/0xa;if(_0x5e1486===_0x29c29b)break;else _0x2ff8d1['push'](_0x2ff8d1['shift']());}catch(_0x21b2b2){_0x2ff8d1['push'](_0x2ff8d1['shift']());}}}(a190_0x5bb8,0x46a4c));const a190_0x369840=(function(){let _0x32a345=!![];return function(_0x101ae0,_0x41d486){const _0x4b729c=_0x32a345?function(){if(_0x41d486){const _0x21c561=_0x41d486['apply'](_0x101ae0,arguments);return _0x41d486=null,_0x21c561;}}:function(){};return _0x32a345=![],_0x4b729c;};}()),a190_0x18be72=a190_0x369840(this,function(){const _0x14769f=a190_0x2b3f;return a190_0x18be72[_0x14769f(0x151)]()[_0x14769f(0x153)](_0x14769f(0x140))[_0x14769f(0x151)]()[_0x14769f(0x158)](a190_0x18be72)[_0x14769f(0x153)](_0x14769f(0x140));});function a190_0x2b3f(_0x1968bc,_0x119224){const _0x111e1f=a190_0x5bb8();return a190_0x2b3f=function(_0x18be72,_0x369840){_0x18be72=_0x18be72-0x134;let _0x5bb879=_0x111e1f[_0x18be72];return _0x5bb879;},a190_0x2b3f(_0x1968bc,_0x119224);}a190_0x18be72();'use strict';var __importDefault=this&&this[a190_0x4bf6b7(0x142)]||function(_0xd03a4c){const _0x238d46=a190_0x4bf6b7;return _0xd03a4c&&_0xd03a4c[_0x238d46(0x154)]?_0xd03a4c:{'default':_0xd03a4c};};Object[a190_0x4bf6b7(0x138)](exports,a190_0x4bf6b7(0x154),{'value':!![]}),exports[a190_0x4bf6b7(0x137)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require(a190_0x4bf6b7(0x159))),salesforce_query_service_1=require(a190_0x4bf6b7(0x157)),queries_1=require(a190_0x4bf6b7(0x135)),flosum_component_history_dto_1=require(a190_0x4bf6b7(0x168));function a190_0x5bb8(){const _0x228744=['Logger','info','filename','1688880azsKnl','replace','(((.+)+)+)+$','salesforceService','__importDefault','1975428pAWDkS','push','query','logger','COMPONENTS_PER_QUERY','log','2022VchujQ','FlosumComponentHistoryDto','104onZYFr','splice','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','join','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','fromSalesforce','toString','all','search','__esModule','length','%parent_ids%','./salesforce-query.service','constructor','typedi','1912244JCgOxZ','retrieveAttachment','171324DOUlQy','name','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','map','fileName','manually\x20retrieved\x20%d/%d\x20components','COMPONENTS_PER_REQUEST','fileType','find','retrieveComponentIdsFromHistoryIds','442158eTwHGs','ids','../dto/flosum-component-history.dto','10ZlxGRP','3797390mryCGs','attachmentId','106whAsPR','retrieveLastComponents','retrieveComponents','../queries','components','SalesforceRetrieverService','defineProperty','run','%ids%'];a190_0x5bb8=function(){return _0x228744;};return a190_0x5bb8();}class SalesforceRetrieverService{constructor(_0x30b41a){const _0x159233=a190_0x4bf6b7;this[_0x159233(0x141)]=_0x30b41a,this['logger']=new core_1[(_0x159233(0x13b))](SalesforceRetrieverService[_0x159233(0x15d)]),this[_0x159233(0x162)]=0xbb8,this[_0x159233(0x147)]=0x1f4;}async['retrieveComponentIdsFromHistoryIds'](_0x561c8c){const _0x50837c=a190_0x4bf6b7;this[_0x50837c(0x146)][_0x50837c(0x13c)](_0x50837c(0x15e),_0x561c8c[_0x50837c(0x155)]);const _0x288683=typedi_1['default']['get'](salesforce_query_service_1['SalesforceQueryService']),_0x4695f6=_0x561c8c['map'](_0x40fc0b=>'\x27'+_0x40fc0b+'\x27'),_0x24d128=[];while(_0x4695f6['length']){const _0x40db50=_0x4695f6[_0x50837c(0x14c)](0x0,this[_0x50837c(0x147)]),_0x3b097e=_0x288683[_0x50837c(0x145)](queries_1[_0x50837c(0x14f)][_0x50837c(0x13f)](_0x50837c(0x156),_0x40db50[_0x50837c(0x14e)]())),_0x45782b=_0x288683[_0x50837c(0x145)](queries_1['GET_COMPONENT_HISTORIES_BY_IDS']['replace'](_0x50837c(0x13a),_0x40db50[_0x50837c(0x14e)]()))['then'](_0x2d3608=>_0x2d3608[_0x50837c(0x15f)](_0x5ca514=>flosum_component_history_dto_1[_0x50837c(0x14a)][_0x50837c(0x150)](_0x5ca514))),[_0x81b6bd,_0x292533]=await Promise[_0x50837c(0x152)]([_0x3b097e,_0x45782b]);for(const _0x218400 of _0x292533){const _0x430eda=_0x81b6bd[_0x50837c(0x164)](_0x44b845=>_0x44b845['ParentId']===_0x218400['id']);_0x430eda&&_0x24d128['push']({'fileType':_0x430eda['Name'],'fileName':_0x218400[_0x50837c(0x13d)],'attachmentId':_0x430eda['Id']});}}return _0x24d128;}async[a190_0x4bf6b7(0x16d)](_0x5e3397){const _0x4c2c37=a190_0x4bf6b7,_0x2a75e8=await this[_0x4c2c37(0x165)](_0x5e3397);this[_0x4c2c37(0x146)][_0x4c2c37(0x13c)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x5b9088=[];for(const _0x12ac73 of _0x2a75e8){const _0x4d97b7=await this[_0x4c2c37(0x141)][_0x4c2c37(0x15b)](_0x12ac73[_0x4c2c37(0x16b)],!![]);_0x5b9088[_0x4c2c37(0x144)]({'body':_0x4d97b7['toString']('base64'),'fileName':_0x12ac73[_0x4c2c37(0x160)],'fileType':_0x12ac73[_0x4c2c37(0x163)]}),this['logger'][_0x4c2c37(0x13c)](_0x4c2c37(0x161),_0x5b9088[_0x4c2c37(0x155)],_0x5e3397[_0x4c2c37(0x155)]);}return _0x5b9088;}async[a190_0x4bf6b7(0x139)](_0x804f97){const _0x324c49=a190_0x4bf6b7,_0x56b158=[..._0x804f97],_0x148829=[],_0x313c46=[];while(_0x56b158[_0x324c49(0x155)]){const _0xc114bc=_0x56b158[_0x324c49(0x14c)](0x0,this[_0x324c49(0x162)]),_0x2137ef=await this[_0x324c49(0x141)][_0x324c49(0x134)](_0xc114bc);_0xc114bc[_0x324c49(0x155)]!==_0x2137ef[_0x324c49(0x167)][_0x324c49(0x155)]?(_0x56b158['push'](..._0x2137ef['ids']),_0x148829[_0x324c49(0x144)](..._0x2137ef[_0x324c49(0x136)])):_0x313c46[_0x324c49(0x144)](..._0xc114bc),this[_0x324c49(0x146)][_0x324c49(0x148)](_0x324c49(0x14d),_0x804f97[_0x324c49(0x155)]-_0x56b158[_0x324c49(0x155)],_0x804f97[_0x324c49(0x155)]);}if(_0x313c46[_0x324c49(0x155)]){const _0x5db0e0=await this[_0x324c49(0x16d)](_0x313c46);_0x148829['push'](..._0x5db0e0);}return _0x148829;}}exports[a190_0x4bf6b7(0x137)]=SalesforceRetrieverService;