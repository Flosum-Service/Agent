const a204_0x284ce7=a204_0x1b7c;(function(_0x376e06,_0x185b2c){const _0x2a62b6=a204_0x1b7c,_0x5fc793=_0x376e06();while(!![]){try{const _0x302b87=parseInt(_0x2a62b6(0x86))/0x1+-parseInt(_0x2a62b6(0x99))/0x2+-parseInt(_0x2a62b6(0x9a))/0x3+parseInt(_0x2a62b6(0x85))/0x4*(-parseInt(_0x2a62b6(0x7b))/0x5)+-parseInt(_0x2a62b6(0x7a))/0x6*(-parseInt(_0x2a62b6(0x9f))/0x7)+parseInt(_0x2a62b6(0x80))/0x8*(-parseInt(_0x2a62b6(0x9b))/0x9)+parseInt(_0x2a62b6(0x75))/0xa;if(_0x302b87===_0x185b2c)break;else _0x5fc793['push'](_0x5fc793['shift']());}catch(_0x223412){_0x5fc793['push'](_0x5fc793['shift']());}}}(a204_0x2ded,0x35970));const a204_0xc32e4c=(function(){let _0x49b74d=!![];return function(_0x228817,_0x119ac3){const _0x303d42=_0x49b74d?function(){const _0x2f0188=a204_0x1b7c;if(_0x119ac3){const _0x3842ab=_0x119ac3[_0x2f0188(0x8d)](_0x228817,arguments);return _0x119ac3=null,_0x3842ab;}}:function(){};return _0x49b74d=![],_0x303d42;};}()),a204_0x3136db=a204_0xc32e4c(this,function(){const _0x3897b1=a204_0x1b7c;return a204_0x3136db[_0x3897b1(0x7c)]()[_0x3897b1(0x9c)](_0x3897b1(0x82))[_0x3897b1(0x7c)]()[_0x3897b1(0x79)](a204_0x3136db)[_0x3897b1(0x9c)](_0x3897b1(0x82));});a204_0x3136db();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x36170e){const _0x3405b0=a204_0x1b7c;return _0x36170e&&_0x36170e[_0x3405b0(0x9d)]?_0x36170e:{'default':_0x36170e};};function a204_0x1b7c(_0x3d8dcb,_0x4609ac){const _0x40a3aa=a204_0x2ded();return a204_0x1b7c=function(_0x3136db,_0xc32e4c){_0x3136db=_0x3136db-0x69;let _0x2dedaf=_0x40a3aa[_0x3136db];return _0x2dedaf;},a204_0x1b7c(_0x3d8dcb,_0x4609ac);}Object['defineProperty'](exports,a204_0x284ce7(0x9d),{'value':!![]}),exports[a204_0x284ce7(0x70)]=void 0x0;const core_1=require('../../../../core'),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a204_0x284ce7(0x84)),flosum_component_history_dto_1=require(a204_0x284ce7(0x8f));function a204_0x2ded(){const _0x506b1d=['8242380bBxZlV','default','retrieveComponents','SalesforceQueryService','constructor','1002LPjBqj','1364585FKoguD','toString','COMPONENTS_PER_REQUEST','replace','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','40QRusPx','query','(((.+)+)+)+$','splice','../queries','4fjOkQf','264565xCgafA','name','%parent_ids%','map','log','logger','salesforceService','apply','info','../dto/flosum-component-history.dto','manually\x20retrieved\x20%d/%d\x20components','FlosumComponentHistoryDto','base64','attachmentId','ids','retrieveComponentIdsFromHistoryIds','get','push','length','838930NVuOOZ','310809ybxIns','788175BKrRKs','search','__esModule','components','15281YaYIiE','then','find','retrieveLastComponents','manually\x20retrieving\x20components\x20from\x20salesforce','fromSalesforce','Logger','fileType','GET_COMPONENT_HISTORIES_BY_IDS','SalesforceRetrieverService','join','COMPONENTS_PER_QUERY','%ids%','GET_ATTACHMENT_BY_PARENT_IDS_QUERY'];a204_0x2ded=function(){return _0x506b1d;};return a204_0x2ded();}class SalesforceRetrieverService{constructor(_0x309861){const _0x9c399b=a204_0x284ce7;this[_0x9c399b(0x8c)]=_0x309861,this[_0x9c399b(0x8b)]=new core_1[(_0x9c399b(0x6d))](SalesforceRetrieverService[_0x9c399b(0x87)]),this[_0x9c399b(0x7d)]=0xbb8,this[_0x9c399b(0x72)]=0x1f4;}async[a204_0x284ce7(0x95)](_0x13ea9d){const _0x15f969=a204_0x284ce7;this[_0x15f969(0x8b)][_0x15f969(0x8e)](_0x15f969(0x7f),_0x13ea9d[_0x15f969(0x98)]);const _0x335d2a=typedi_1[_0x15f969(0x76)][_0x15f969(0x96)](salesforce_query_service_1[_0x15f969(0x78)]),_0x593d9b=_0x13ea9d[_0x15f969(0x89)](_0x319a02=>'\x27'+_0x319a02+'\x27'),_0x3c2d45=[];while(_0x593d9b[_0x15f969(0x98)]){const _0x5b3a91=_0x593d9b[_0x15f969(0x83)](0x0,this['COMPONENTS_PER_QUERY']),_0x36917d=_0x335d2a[_0x15f969(0x81)](queries_1[_0x15f969(0x74)][_0x15f969(0x7e)](_0x15f969(0x88),_0x5b3a91[_0x15f969(0x71)]())),_0x4fef76=_0x335d2a[_0x15f969(0x81)](queries_1[_0x15f969(0x6f)][_0x15f969(0x7e)](_0x15f969(0x73),_0x5b3a91['join']()))[_0x15f969(0xa0)](_0x2f4f6e=>_0x2f4f6e[_0x15f969(0x89)](_0x9f4bf=>flosum_component_history_dto_1[_0x15f969(0x91)][_0x15f969(0x6c)](_0x9f4bf))),[_0x3ccbbf,_0x41f6c5]=await Promise['all']([_0x36917d,_0x4fef76]);for(const _0x2e5be4 of _0x41f6c5){const _0x279366=_0x3ccbbf[_0x15f969(0x69)](_0x310987=>_0x310987['ParentId']===_0x2e5be4['id']);_0x279366&&_0x3c2d45['push']({'fileType':_0x279366['Name'],'fileName':_0x2e5be4['filename'],'attachmentId':_0x279366['Id']});}}return _0x3c2d45;}async[a204_0x284ce7(0x6a)](_0x160ffa){const _0x297870=a204_0x284ce7,_0x30358c=await this[_0x297870(0x95)](_0x160ffa);this[_0x297870(0x8b)][_0x297870(0x8e)](_0x297870(0x6b));const _0x19e42f=[];for(const _0x5e62d5 of _0x30358c){const _0x4d21e1=await this[_0x297870(0x8c)]['retrieveAttachment'](_0x5e62d5[_0x297870(0x93)],!![]);_0x19e42f[_0x297870(0x97)]({'body':_0x4d21e1[_0x297870(0x7c)](_0x297870(0x92)),'fileName':_0x5e62d5['fileName'],'fileType':_0x5e62d5[_0x297870(0x6e)]}),this[_0x297870(0x8b)]['info'](_0x297870(0x90),_0x19e42f[_0x297870(0x98)],_0x160ffa['length']);}return _0x19e42f;}async['run'](_0x1b056b){const _0x45fd6f=a204_0x284ce7,_0x6afdf8=[..._0x1b056b],_0x5cc0bb=[],_0x40eda6=[];while(_0x6afdf8[_0x45fd6f(0x98)]){const _0x15689b=_0x6afdf8['splice'](0x0,this[_0x45fd6f(0x7d)]),_0x18f4f9=await this[_0x45fd6f(0x8c)][_0x45fd6f(0x77)](_0x15689b);_0x15689b[_0x45fd6f(0x98)]!==_0x18f4f9[_0x45fd6f(0x94)]['length']?(_0x6afdf8['push'](..._0x18f4f9[_0x45fd6f(0x94)]),_0x5cc0bb['push'](..._0x18f4f9[_0x45fd6f(0x9e)])):_0x40eda6['push'](..._0x15689b),this['logger'][_0x45fd6f(0x8a)]('retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest',_0x1b056b['length']-_0x6afdf8[_0x45fd6f(0x98)],_0x1b056b[_0x45fd6f(0x98)]);}if(_0x40eda6[_0x45fd6f(0x98)]){const _0x10e22e=await this[_0x45fd6f(0x6a)](_0x40eda6);_0x5cc0bb[_0x45fd6f(0x97)](..._0x10e22e);}return _0x5cc0bb;}}exports[a204_0x284ce7(0x70)]=SalesforceRetrieverService;