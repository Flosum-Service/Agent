const a158_0x4f4d61=a158_0x3188;(function(_0x305aa4,_0xf63784){const _0x57d2d7=a158_0x3188,_0x394a33=_0x305aa4();while(!![]){try{const _0x1d2322=parseInt(_0x57d2d7(0x1e1))/0x1*(-parseInt(_0x57d2d7(0x1f9))/0x2)+-parseInt(_0x57d2d7(0x1f6))/0x3*(parseInt(_0x57d2d7(0x1f5))/0x4)+-parseInt(_0x57d2d7(0x1fb))/0x5+-parseInt(_0x57d2d7(0x202))/0x6*(parseInt(_0x57d2d7(0x20a))/0x7)+parseInt(_0x57d2d7(0x20b))/0x8+-parseInt(_0x57d2d7(0x214))/0x9+parseInt(_0x57d2d7(0x212))/0xa;if(_0x1d2322===_0xf63784)break;else _0x394a33['push'](_0x394a33['shift']());}catch(_0x5a824d){_0x394a33['push'](_0x394a33['shift']());}}}(a158_0x4a5d,0xa2362));const a158_0xab9f59=(function(){let _0x1b6b8d=!![];return function(_0x54f5dc,_0x326263){const _0x3939ca=_0x1b6b8d?function(){const _0x54d0f8=a158_0x3188;if(_0x326263){const _0x2bfcf8=_0x326263[_0x54d0f8(0x1ee)](_0x54f5dc,arguments);return _0x326263=null,_0x2bfcf8;}}:function(){};return _0x1b6b8d=![],_0x3939ca;};}()),a158_0x2930e1=a158_0xab9f59(this,function(){const _0xe0f34a=a158_0x3188;return a158_0x2930e1[_0xe0f34a(0x1de)]()[_0xe0f34a(0x211)]('(((.+)+)+)+$')['toString']()[_0xe0f34a(0x1e6)](a158_0x2930e1)[_0xe0f34a(0x211)]('(((.+)+)+)+$');});a158_0x2930e1();'use strict';var __decorate=this&&this[a158_0x4f4d61(0x1ea)]||function(_0x1b808b,_0x59fbdf,_0x5b236a,_0x1abac7){const _0xb26ec3=a158_0x4f4d61;var _0x5a8292=arguments[_0xb26ec3(0x215)],_0x1843c7=_0x5a8292<0x3?_0x59fbdf:_0x1abac7===null?_0x1abac7=Object[_0xb26ec3(0x209)](_0x59fbdf,_0x5b236a):_0x1abac7,_0x368ee5;if(typeof Reflect===_0xb26ec3(0x1e2)&&typeof Reflect[_0xb26ec3(0x1e7)]==='function')_0x1843c7=Reflect['decorate'](_0x1b808b,_0x59fbdf,_0x5b236a,_0x1abac7);else{for(var _0x159786=_0x1b808b['length']-0x1;_0x159786>=0x0;_0x159786--)if(_0x368ee5=_0x1b808b[_0x159786])_0x1843c7=(_0x5a8292<0x3?_0x368ee5(_0x1843c7):_0x5a8292>0x3?_0x368ee5(_0x59fbdf,_0x5b236a,_0x1843c7):_0x368ee5(_0x59fbdf,_0x5b236a))||_0x1843c7;}return _0x5a8292>0x3&&_0x1843c7&&Object['defineProperty'](_0x59fbdf,_0x5b236a,_0x1843c7),_0x1843c7;},__metadata=this&&this['__metadata']||function(_0x4073d9,_0x30bbca){const _0x2efa43=a158_0x4f4d61;if(typeof Reflect===_0x2efa43(0x1e2)&&typeof Reflect['metadata']===_0x2efa43(0x213))return Reflect[_0x2efa43(0x1e4)](_0x4073d9,_0x30bbca);},__param=this&&this[a158_0x4f4d61(0x208)]||function(_0x2ce1aa,_0x19ef12){return function(_0x34cd76,_0x46e5a3){_0x19ef12(_0x34cd76,_0x46e5a3,_0x2ce1aa);};},__importDefault=this&&this['__importDefault']||function(_0x23ead6){return _0x23ead6&&_0x23ead6['__esModule']?_0x23ead6:{'default':_0x23ead6};};function a158_0x3188(_0x2d3697,_0x2f9e40){const _0x5764f9=a158_0x4a5d();return a158_0x3188=function(_0x2930e1,_0xab9f59){_0x2930e1=_0x2930e1-0x1de;let _0x4a5d47=_0x5764f9[_0x2930e1];return _0x4a5d47;},a158_0x3188(_0x2d3697,_0x2f9e40);}Object['defineProperty'](exports,a158_0x4f4d61(0x1e0),{'value':!![]}),exports[a158_0x4f4d61(0x1f8)]=void 0x0;const axios_1=__importDefault(require('axios')),typedi_1=require(a158_0x4f4d61(0x210)),git_api_service_1=require(a158_0x4f4d61(0x20d)),bitbucket_credentials_dto_1=require('../credentials/dto/bitbucket-credentials.dto'),providers_tokens_1=require('../providers.tokens'),git_provider_1=require(a158_0x4f4d61(0x1f0)),url_1=require(a158_0x4f4d61(0x20c));function a158_0x4a5d(){const _0x68a2c3=['BitbucketCredentialsDto','use','checkAccessToken','__param','getOwnPropertyDescriptor','2894731LGNVLi','6460432MjKcNy','url','./git-api.service','Inject','getHeaders','typedi','search','35801900zYNJbY','function','4231998oMZHhx','length','toString','username','__esModule','1mscJFc','object','Authorization','metadata','password','constructor','decorate','isLoggedIn','now','__decorate','interceptors','URL','GitApiService','apply','default','../types/git-provider','headers','provider','setAccessToken','accessTokenExpiresAt','4817504XEoVvU','3xNFVVR','Tokens','BitbucketApiService','959830XfzMbv','https://bitbucket.org','1641070TmmEiF','getAuthorizationHeader','post','request','getCurrentUser','get','Service','18jlGHtQ','pathname','credentials'];a158_0x4a5d=function(){return _0x68a2c3;};return a158_0x4a5d();}let BitbucketApiService=class BitbucketApiService extends git_api_service_1[a158_0x4f4d61(0x1ed)]{constructor(_0x100b3d,_0x571216){super(_0x100b3d,_0x571216),this['accessTokenExpiresAt']=-0x1,this['MAX_REQUEST_PER_HOUR']=0x3e8;}['createRequest'](_0x539627){const _0x3bac60=a158_0x4f4d61,_0x22dfce=super['createRequest'](_0x539627);return _0x22dfce[_0x3bac60(0x1eb)][_0x3bac60(0x1fe)][_0x3bac60(0x206)](async _0x2aac19=>{const _0x8e883b=_0x3bac60;return await this[_0x8e883b(0x207)](),_0x2aac19[_0x8e883b(0x1f1)][_0x8e883b(0x1e3)]=this['credentials'][_0x8e883b(0x1fc)](),_0x2aac19;}),_0x22dfce;}async[a158_0x4f4d61(0x207)](){if(Date['now']()<this['accessTokenExpiresAt'])return;await this['refreshToken']();}async['refreshToken'](){const _0x27ded4=a158_0x4f4d61,{clientId:_0x451378,clientSecret:_0x1e135e}=this[_0x27ded4(0x204)],_0x512906=new url_1[(_0x27ded4(0x1ec))](_0x27ded4(0x1fa));_0x512906[_0x27ded4(0x1df)]=_0x451378,_0x512906[_0x27ded4(0x1e5)]=_0x1e135e,_0x512906[_0x27ded4(0x203)]='/site/oauth2/access_token';const {data:_0x3739e3}=await axios_1[_0x27ded4(0x1ef)][_0x27ded4(0x1fd)](_0x512906[_0x27ded4(0x1de)](),'grant_type=client_credentials'),{expires_in:_0x1a3ce5,access_token:_0x68e34a}=_0x3739e3;this[_0x27ded4(0x1f4)]=Date[_0x27ded4(0x1e9)]()+_0x1a3ce5*0x3e8,this[_0x27ded4(0x204)][_0x27ded4(0x1f3)](_0x68e34a);}[a158_0x4f4d61(0x20f)](){return{};}['getCurrentUser'](){const _0x4b3da2=a158_0x4f4d61;return this[_0x4b3da2(0x1fe)][_0x4b3da2(0x200)]('user');}async[a158_0x4f4d61(0x1e8)](){const _0x4c3f98=a158_0x4f4d61;return await this[_0x4c3f98(0x1ff)](),!![];}};BitbucketApiService=__decorate([(0x0,typedi_1[a158_0x4f4d61(0x201)])(),__param(0x0,(0x0,typedi_1[a158_0x4f4d61(0x20e)])(providers_tokens_1['Tokens'][a158_0x4f4d61(0x1f2)])),__param(0x1,(0x0,typedi_1[a158_0x4f4d61(0x20e)])(providers_tokens_1[a158_0x4f4d61(0x1f7)]['credentials'])),__metadata('design:paramtypes',[String,bitbucket_credentials_dto_1[a158_0x4f4d61(0x205)]])],BitbucketApiService),exports[a158_0x4f4d61(0x1f8)]=BitbucketApiService;