const a127_0x3eca67=a127_0x9050;function a127_0x9050(_0x2aa23b,_0x76dfbe){const _0x107b57=a127_0x560c();return a127_0x9050=function(_0xd6f31b,_0x4a17dd){_0xd6f31b=_0xd6f31b-0x1e0;let _0x560c29=_0x107b57[_0xd6f31b];return _0x560c29;},a127_0x9050(_0x2aa23b,_0x76dfbe);}(function(_0x1a2a01,_0xc8562c){const _0x4421c8=a127_0x9050,_0x27f8a4=_0x1a2a01();while(!![]){try{const _0x3ba334=-parseInt(_0x4421c8(0x1f9))/0x1+-parseInt(_0x4421c8(0x1f6))/0x2+-parseInt(_0x4421c8(0x205))/0x3+parseInt(_0x4421c8(0x1ef))/0x4+-parseInt(_0x4421c8(0x1fb))/0x5*(-parseInt(_0x4421c8(0x1f5))/0x6)+parseInt(_0x4421c8(0x1e7))/0x7*(parseInt(_0x4421c8(0x202))/0x8)+parseInt(_0x4421c8(0x228))/0x9*(parseInt(_0x4421c8(0x1f8))/0xa);if(_0x3ba334===_0xc8562c)break;else _0x27f8a4['push'](_0x27f8a4['shift']());}catch(_0x1656f0){_0x27f8a4['push'](_0x27f8a4['shift']());}}}(a127_0x560c,0x34b13));function a127_0x560c(){const _0x429c07=['chunkArray','error','proceededComponentsMeta','name','constructor','176608IzGbbU','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','../utils/composite.utils','REQUESTS_COUNT_TO_REPOSITORY','graph','update','18030QEFtoi','101668PmzTzz','delete','5362780BDlgdy','306363QkUuhu','SalesforceError','90ZXITWU','composite','toString','get','default','commitId','find','54664XIaMib','componentsToUpdate','proceedRequests','409977qjUReX','SalesforceCommitsManager','SalesforceComponentsManager','defineProperty','manifests','inserted','../../../constants','GRAPHS_PER_REQUEST','branchId','getProceededComponentsMeta','sfLogger','shift','removed','push','REQUESTS_PER_GRAPH','logger','Logger','[INFO]\x20Sending\x20composite\x20request\x20with\x20','reference','proceedCommitsToRepository','toJSON','(((.+)+)+)+$','REQUESTS_COUNT_TO_BRANCH','options','__esModule','proceedCommitsToBranch','modified','repositoryId','typedi','./salesforce-composite.service','stringify','search','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','getCompositeRequestChunks','recordTypes','9KeUyNV','log','../../shared/utils','extractComponentIdsFromGraphsResponse','componentsToDelete','length','insert','getObjectSize','77fSVhsA','reduce','map'];a127_0x560c=function(){return _0x429c07;};return a127_0x560c();}const a127_0x4a17dd=(function(){let _0x33471f=!![];return function(_0x2350e3,_0x37c197){const _0xd8cac5=_0x33471f?function(){if(_0x37c197){const _0x4e77d0=_0x37c197['apply'](_0x2350e3,arguments);return _0x37c197=null,_0x4e77d0;}}:function(){};return _0x33471f=![],_0xd8cac5;};}()),a127_0xd6f31b=a127_0x4a17dd(this,function(){const _0x164a4b=a127_0x9050;return a127_0xd6f31b['toString']()[_0x164a4b(0x224)]('(((.+)+)+)+$')[_0x164a4b(0x1fd)]()[_0x164a4b(0x1ee)](a127_0xd6f31b)[_0x164a4b(0x224)](_0x164a4b(0x21a));});a127_0xd6f31b();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1e3e4a){const _0x3111ce=a127_0x9050;return _0x1e3e4a&&_0x1e3e4a[_0x3111ce(0x21d)]?_0x1e3e4a:{'default':_0x1e3e4a};};Object[a127_0x3eca67(0x208)](exports,'__esModule',{'value':!![]}),exports[a127_0x3eca67(0x206)]=void 0x0;const core_1=require('../../../core'),typedi_1=__importDefault(require(a127_0x3eca67(0x221))),constants_1=require(a127_0x3eca67(0x20b)),utils_1=require(a127_0x3eca67(0x1e1)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a127_0x3eca67(0x1f1)),salesforce_components_manager_service_1=require('./salesforce-components-manager.service'),salesforce_composite_service_1=require(a127_0x3eca67(0x222));class SalesforceCommitsManager{constructor(_0x5dffc9){const _0x24fc22=a127_0x3eca67;this['options']=_0x5dffc9,this[_0x24fc22(0x21b)]=0x3,this[_0x24fc22(0x1f2)]=0x4,this[_0x24fc22(0x213)]=0xc,this[_0x24fc22(0x20c)]=Math['floor'](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/this[_0x24fc22(0x213)]),this[_0x24fc22(0x214)]=new core_1[(_0x24fc22(0x215))](SalesforceCommitsManager[_0x24fc22(0x1ed)]),this[_0x24fc22(0x20f)]=this[_0x24fc22(0x21c)]['logger'],this[_0x24fc22(0x1fc)]=typedi_1[_0x24fc22(0x1ff)][_0x24fc22(0x1fe)](salesforce_composite_service_1['SalesforceCompositeService']),this[_0x24fc22(0x1ec)]=[];}[a127_0x3eca67(0x226)](_0x5d50b7,_0x53f3d5=![]){const _0x41cbb4=a127_0x3eca67,_0x31a53a=utils_1[_0x41cbb4(0x1ea)](_0x5d50b7,_0x53f3d5?this[_0x41cbb4(0x1f2)]:this[_0x41cbb4(0x21b)]),_0x1f2e0b=_0x31a53a[_0x41cbb4(0x1e9)](_0xbea3b0=>({'chunk':_0xbea3b0,'size':composite_utils_1[_0x41cbb4(0x1e6)](_0xbea3b0)})),_0x223839=[];let _0x390837=[],_0x352e48=[],_0x3485ad=0x0;for(const {chunk:_0x40ab5e,size:_0x189bbe}of _0x1f2e0b){_0x3485ad+_0x189bbe>constants_1['SALESFORCE_MAX_REQUEST_SIZE_BYTES']&&(_0x352e48['length']&&_0x390837[_0x41cbb4(0x212)](_0x352e48),_0x390837[_0x41cbb4(0x1e4)]&&_0x223839['push'](_0x390837),_0x352e48=[],_0x390837=[],_0x3485ad=0x0),_0x352e48[_0x41cbb4(0x212)](..._0x40ab5e),_0x3485ad+=_0x189bbe,_0x352e48[_0x41cbb4(0x1e4)]===this[_0x41cbb4(0x213)]&&(_0x390837[_0x41cbb4(0x212)](_0x352e48),_0x352e48=[]),_0x390837[_0x41cbb4(0x1e4)]===this[_0x41cbb4(0x20c)]&&(_0x223839[_0x41cbb4(0x212)](_0x390837),_0x390837=[]);}return _0x352e48[_0x41cbb4(0x1e4)]&&_0x390837[_0x41cbb4(0x212)](_0x352e48),_0x390837[_0x41cbb4(0x1e4)]&&_0x223839[_0x41cbb4(0x212)](_0x390837),_0x223839;}async[a127_0x3eca67(0x204)](_0x1ec630,_0x20d2b9=![]){const _0x6d4d4a=a127_0x3eca67,_0x4b8088=this[_0x6d4d4a(0x226)](_0x1ec630,_0x20d2b9);try{while(_0x4b8088[_0x6d4d4a(0x1e4)]){const _0x254ed1=_0x4b8088[_0x6d4d4a(0x210)]();if(!_0x254ed1)break;const _0x4ee22c=_0x254ed1[_0x6d4d4a(0x1e4)],_0x38f3a5=_0x254ed1[_0x6d4d4a(0x1e8)]((_0x16793b,_0xbd4bee)=>_0x16793b+_0xbd4bee[_0x6d4d4a(0x1e4)],0x0);await this[_0x6d4d4a(0x20f)][_0x6d4d4a(0x1e0)](_0x6d4d4a(0x216)+_0x4ee22c+'\x20graphs\x20which\x20contains\x20'+_0x38f3a5+'\x20nodes.\x20')['send']();const _0x213ba1=await this[_0x6d4d4a(0x1fc)]['executeGraphs'](_0x254ed1[_0x6d4d4a(0x1e9)]((_0x1dc1e1,_0x550a86)=>({'graphId':_0x6d4d4a(0x1f3)+_0x550a86,'compositeRequest':_0x1dc1e1})));if(_0x20d2b9){const _0x2b12a9=composite_utils_1[_0x6d4d4a(0x1e2)](_0x213ba1);for(const {id:_0x55f3f8,ref:_0x2d239b}of _0x2b12a9){const _0x59f5ac=this['proceededComponentsMeta'][_0x6d4d4a(0x201)](_0x3d7786=>_0x3d7786[_0x6d4d4a(0x217)]===_0x2d239b);_0x59f5ac&&(_0x59f5ac['componentId']=_0x55f3f8);}}}}catch(_0x1f5d99){this[_0x6d4d4a(0x214)][_0x6d4d4a(0x1eb)](_0x1f5d99 instanceof salesforce_error_1[_0x6d4d4a(0x1fa)]?JSON['stringify'](_0x1f5d99[_0x6d4d4a(0x219)](),null,0x2):_0x1f5d99),this[_0x6d4d4a(0x20f)][_0x6d4d4a(0x1e0)](_0x1f5d99 instanceof salesforce_error_1['SalesforceError']?JSON[_0x6d4d4a(0x223)](_0x1f5d99['toJSON'](),null,0x2):_0x1f5d99[_0x6d4d4a(0x1fd)]());throw _0x1f5d99;}}async['proceedCommitsToRepository'](_0x5c33fe){const _0x207cf1=a127_0x3eca67;for(const _0x1477e2 of _0x5c33fe){if(!_0x1477e2['inserted'][_0x207cf1(0x1e4)]&&!_0x1477e2[_0x207cf1(0x21f)][_0x207cf1(0x1e4)]&&!_0x1477e2['removed'][_0x207cf1(0x1e4)])continue;const _0x919a50=[],_0x2241de=[],_0x3310a4=new salesforce_components_manager_service_1[(_0x207cf1(0x207))](this['options'][_0x207cf1(0x220)],this[_0x207cf1(0x21c)]['branchId'],_0x1477e2['author'],this[_0x207cf1(0x21c)][_0x207cf1(0x227)],this[_0x207cf1(0x1ec)]);_0x919a50[_0x207cf1(0x212)](...await _0x3310a4[_0x207cf1(0x1e5)](_0x1477e2[_0x207cf1(0x20a)],this[_0x207cf1(0x21c)][_0x207cf1(0x200)])),_0x919a50[_0x207cf1(0x212)](...await _0x3310a4['update'](_0x1477e2[_0x207cf1(0x21f)],this[_0x207cf1(0x21c)]['commitId'])),_0x2241de[_0x207cf1(0x212)](await _0x3310a4['delete'](_0x1477e2['removed'],!![])),this[_0x207cf1(0x1ec)]=_0x3310a4[_0x207cf1(0x20e)](),await this[_0x207cf1(0x204)](_0x919a50,!![]);for(const _0x1ab9ee of _0x2241de){_0x1ab9ee[_0x207cf1(0x209)]['length']&&await this['proceedRequests'](_0x1ab9ee[_0x207cf1(0x209)],!![]),_0x1ab9ee[_0x207cf1(0x203)]['length']&&await this[_0x207cf1(0x204)](_0x1ab9ee['componentsToUpdate'],!![]),_0x1ab9ee[_0x207cf1(0x1e3)][_0x207cf1(0x1e4)]&&await this[_0x207cf1(0x204)](_0x1ab9ee[_0x207cf1(0x1e3)],!![]);}this[_0x207cf1(0x214)][_0x207cf1(0x1e0)](_0x207cf1(0x225),_0x919a50[_0x207cf1(0x1e4)]);}}async[a127_0x3eca67(0x21e)](_0x4fe06d){const _0x3e1780=a127_0x3eca67,_0x27faf1=[],_0x334a0a=[];for(const _0x32d856 of _0x4fe06d){if(!_0x32d856[_0x3e1780(0x20a)][_0x3e1780(0x1e4)]&&!_0x32d856[_0x3e1780(0x21f)][_0x3e1780(0x1e4)]&&!_0x32d856[_0x3e1780(0x211)][_0x3e1780(0x1e4)])continue;const _0x1be6f0=new salesforce_components_manager_service_1[(_0x3e1780(0x207))](this[_0x3e1780(0x21c)][_0x3e1780(0x220)],this[_0x3e1780(0x21c)][_0x3e1780(0x20d)],_0x32d856['author'],this[_0x3e1780(0x21c)]['recordTypes'],[]);_0x27faf1['push'](...await _0x1be6f0['insert'](_0x32d856[_0x3e1780(0x20a)])),_0x27faf1[_0x3e1780(0x212)](...await _0x1be6f0[_0x3e1780(0x1f4)](_0x32d856[_0x3e1780(0x21f)])),_0x334a0a[_0x3e1780(0x212)](await _0x1be6f0[_0x3e1780(0x1f7)](_0x32d856[_0x3e1780(0x211)]));}this[_0x3e1780(0x214)]['log'](_0x3e1780(0x1f0),_0x27faf1['length']),await this[_0x3e1780(0x204)](_0x27faf1);const _0x598345=_0x334a0a[_0x3e1780(0x1e8)]((_0x106234,_0x125755)=>({'manifests':[..._0x106234['manifests'],..._0x125755[_0x3e1780(0x209)]],'componentsToDelete':[..._0x106234['componentsToDelete'],..._0x125755[_0x3e1780(0x1e3)]],'componentsToUpdate':[..._0x106234[_0x3e1780(0x203)],..._0x125755[_0x3e1780(0x203)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x598345[_0x3e1780(0x209)][_0x3e1780(0x1e4)]&&await this['proceedRequests'](_0x598345[_0x3e1780(0x209)],!![]),_0x598345['componentsToUpdate'][_0x3e1780(0x1e4)]&&await this[_0x3e1780(0x204)](_0x598345[_0x3e1780(0x203)],!![]),_0x598345['componentsToDelete'][_0x3e1780(0x1e4)]&&await this[_0x3e1780(0x204)](_0x598345[_0x3e1780(0x1e3)],!![]);}async['proceedCommits'](_0x1d4365){const _0x48ec88=a127_0x3eca67;this['options'][_0x48ec88(0x20d)]?await this['proceedCommitsToBranch'](_0x1d4365):await this[_0x48ec88(0x218)](_0x1d4365);}}exports[a127_0x3eca67(0x206)]=SalesforceCommitsManager;