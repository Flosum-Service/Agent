const a126_0x4c2611=a126_0x26af;(function(_0x1f44e2,_0x1cc8b9){const _0x421333=a126_0x26af,_0x202140=_0x1f44e2();while(!![]){try{const _0x4c1473=parseInt(_0x421333(0x1b1))/0x1*(parseInt(_0x421333(0x1d6))/0x2)+-parseInt(_0x421333(0x1c8))/0x3*(-parseInt(_0x421333(0x1ac))/0x4)+-parseInt(_0x421333(0x1cb))/0x5+parseInt(_0x421333(0x1c4))/0x6+parseInt(_0x421333(0x1b0))/0x7+parseInt(_0x421333(0x1b8))/0x8+-parseInt(_0x421333(0x1b7))/0x9;if(_0x4c1473===_0x1cc8b9)break;else _0x202140['push'](_0x202140['shift']());}catch(_0x47f494){_0x202140['push'](_0x202140['shift']());}}}(a126_0x3ffa,0xb1823));const a126_0x6d376c=(function(){let _0x5b6c6a=!![];return function(_0x23a2f1,_0x2e5b7a){const _0x3f3cd7=_0x5b6c6a?function(){const _0xf31d7a=a126_0x26af;if(_0x2e5b7a){const _0x4e8396=_0x2e5b7a[_0xf31d7a(0x1d1)](_0x23a2f1,arguments);return _0x2e5b7a=null,_0x4e8396;}}:function(){};return _0x5b6c6a=![],_0x3f3cd7;};}()),a126_0x81753f=a126_0x6d376c(this,function(){const _0x2d9eb1=a126_0x26af;return a126_0x81753f[_0x2d9eb1(0x1c6)]()['search'](_0x2d9eb1(0x1cf))[_0x2d9eb1(0x1c6)]()[_0x2d9eb1(0x1a3)](a126_0x81753f)[_0x2d9eb1(0x19f)]('(((.+)+)+)+$');});a126_0x81753f();function a126_0x26af(_0xb3209a,_0x36934f){const _0x716979=a126_0x3ffa();return a126_0x26af=function(_0x81753f,_0x6d376c){_0x81753f=_0x81753f-0x19e;let _0x3ffa1f=_0x716979[_0x81753f];return _0x3ffa1f;},a126_0x26af(_0xb3209a,_0x36934f);}'use strict';var __importDefault=this&&this[a126_0x4c2611(0x1ad)]||function(_0x277f8d){const _0x33195f=a126_0x4c2611;return _0x277f8d&&_0x277f8d[_0x33195f(0x1af)]?_0x277f8d:{'default':_0x277f8d};};Object[a126_0x4c2611(0x1b6)](exports,'__esModule',{'value':!![]}),exports[a126_0x4c2611(0x1d4)]=void 0x0;const core_1=require(a126_0x4c2611(0x1c5)),typedi_1=__importDefault(require('typedi')),constants_1=require(a126_0x4c2611(0x1d7)),utils_1=require('../../shared/utils'),salesforce_error_1=require(a126_0x4c2611(0x1a2)),composite_utils_1=require(a126_0x4c2611(0x1e6)),salesforce_components_manager_service_1=require(a126_0x4c2611(0x1dc)),salesforce_composite_service_1=require(a126_0x4c2611(0x1be)),salesforce_git_sync_service_1=require(a126_0x4c2611(0x1d0));function a126_0x3ffa(){const _0x5655f6=['\x20requests\x20to\x20composite\x20api.','gitSync','send','extractComponentIdsFromGraphsResponse','floor','5052456mMejGN','../../../core','toString','componentsToDelete','3TMFOIs','graph','COMPONENTS_PER_CHUNK','4149955NCxqgZ','reference','modified','[INFO]\x20Sending\x20','(((.+)+)+)+$','./salesforce-git-sync.service','apply','getProceededComponentsMeta','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','SalesforceCommitsManager','length','16IIqUBg','../../../constants','get','toJSON','author','commitId','./salesforce-components-manager.service','stringify','Logger','SalesforceGitSyncService','componentId','reduce','recordTypes','default','proceedCommitsToBranch','branchId','../utils/composite.utils','SalesforceCompositeService','insert','delete','update','options','manifests','search','componentsToUpdate','error','../errors/salesforce.error','constructor','SalesforceError','name','inserted','proceededComponentsMeta','push','repositoryId','splice','find','4157588HZCJEd','__importDefault','proceedRequests','__esModule','291123uhxEoe','112124sHUylG','SalesforceComponentsManager','chunkArray','composite','log','defineProperty','15043896tpfHLW','3268448CbTRSA','removed','executeGraphs','sfLogger','logger','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)','./salesforce-composite.service'];a126_0x3ffa=function(){return _0x5655f6;};return a126_0x3ffa();}class SalesforceCommitsManager{constructor(_0x2c82e1){const _0x1e5f75=a126_0x4c2611;this[_0x1e5f75(0x1eb)]=_0x2c82e1,this[_0x1e5f75(0x1ca)]=0x3,this['logger']=new core_1[(_0x1e5f75(0x1de))](SalesforceCommitsManager[_0x1e5f75(0x1a5)]),this[_0x1e5f75(0x1bb)]=this['options'][_0x1e5f75(0x1bc)],this[_0x1e5f75(0x1b4)]=typedi_1[_0x1e5f75(0x1e3)]['get'](salesforce_composite_service_1[_0x1e5f75(0x1e7)]),this[_0x1e5f75(0x1c0)]=typedi_1[_0x1e5f75(0x1e3)][_0x1e5f75(0x1d8)](salesforce_git_sync_service_1[_0x1e5f75(0x1df)]),this[_0x1e5f75(0x1a7)]=[];}async[a126_0x4c2611(0x1ae)](_0xe390c7,_0x52e1e3=![]){const _0x52c81e=a126_0x4c2611,_0x38a930=(this['COMPONENTS_PER_CHUNK']+ +_0x52e1e3)*0x3,_0x43e2c6=utils_1[_0x52c81e(0x1b3)](_0xe390c7,_0x38a930);try{while(_0x43e2c6[_0x52c81e(0x1d5)]){const _0x4251f1=_0x43e2c6[_0x52c81e(0x1aa)](0x0,Math[_0x52c81e(0x1c3)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x38a930));await this[_0x52c81e(0x1bb)]['log'](_0x52c81e(0x1ce)+_0x4251f1[_0x52c81e(0x1d5)]*_0x38a930+_0x52c81e(0x1bf))[_0x52c81e(0x1c1)]();const _0x5bdf20=_0x4251f1['map']((_0x1d85f2,_0x29b572)=>({'graphId':_0x52c81e(0x1c9)+_0x29b572,'compositeRequest':_0x1d85f2})),_0x32ed4b=await this[_0x52c81e(0x1b4)][_0x52c81e(0x1ba)](_0x5bdf20);if(_0x52e1e3){const _0x300bba=composite_utils_1[_0x52c81e(0x1c2)](_0x32ed4b);for(const {id:_0x248d50,ref:_0x5e511d}of _0x300bba){const _0x363b2d=this['proceededComponentsMeta'][_0x52c81e(0x1ab)](_0x3444c3=>_0x3444c3[_0x52c81e(0x1cc)]===_0x5e511d);_0x363b2d&&(_0x363b2d[_0x52c81e(0x1e0)]=_0x248d50);}}}}catch(_0x1c5183){this[_0x52c81e(0x1bc)][_0x52c81e(0x1a1)](_0x1c5183 instanceof salesforce_error_1[_0x52c81e(0x1a4)]?JSON[_0x52c81e(0x1dd)](_0x1c5183[_0x52c81e(0x1d9)](),null,0x2):_0x1c5183),this[_0x52c81e(0x1bb)][_0x52c81e(0x1b5)](_0x1c5183 instanceof salesforce_error_1[_0x52c81e(0x1a4)]?JSON[_0x52c81e(0x1dd)](_0x1c5183['toJSON'](),null,0x2):_0x1c5183['toString']());throw _0x1c5183;}}async['proceedCommitsToRepository'](_0x556c4c){const _0x5ceb40=a126_0x4c2611;for(const _0x32b4ac of _0x556c4c){if(!_0x32b4ac[_0x5ceb40(0x1a6)][_0x5ceb40(0x1d5)]&&!_0x32b4ac[_0x5ceb40(0x1cd)][_0x5ceb40(0x1d5)]&&!_0x32b4ac[_0x5ceb40(0x1b9)][_0x5ceb40(0x1d5)])continue;const _0x392d4d=[],_0x2425d7=[],_0x40d42b=new salesforce_components_manager_service_1[(_0x5ceb40(0x1b2))](this[_0x5ceb40(0x1eb)][_0x5ceb40(0x1a9)],this[_0x5ceb40(0x1eb)][_0x5ceb40(0x1e5)],_0x32b4ac['author'],this['options'][_0x5ceb40(0x1e2)],this[_0x5ceb40(0x1a7)]);_0x392d4d[_0x5ceb40(0x1a8)](...await _0x40d42b[_0x5ceb40(0x1e8)](_0x32b4ac['inserted'],this['options'][_0x5ceb40(0x1db)])),_0x392d4d[_0x5ceb40(0x1a8)](...await _0x40d42b[_0x5ceb40(0x1ea)](_0x32b4ac[_0x5ceb40(0x1cd)],this[_0x5ceb40(0x1eb)]['commitId'])),_0x2425d7['push'](await _0x40d42b[_0x5ceb40(0x1e9)](_0x32b4ac['removed'],!![])),this[_0x5ceb40(0x1a7)]=_0x40d42b[_0x5ceb40(0x1d2)](),await this[_0x5ceb40(0x1ae)](_0x392d4d,!![]);for(const _0x11337f of _0x2425d7){_0x11337f['manifests']['length']&&await this[_0x5ceb40(0x1ae)](_0x11337f[_0x5ceb40(0x19e)],!![]),_0x11337f[_0x5ceb40(0x1a0)][_0x5ceb40(0x1d5)]&&await this[_0x5ceb40(0x1ae)](_0x11337f[_0x5ceb40(0x1a0)],!![]),_0x11337f[_0x5ceb40(0x1c7)]['length']&&await this[_0x5ceb40(0x1ae)](_0x11337f[_0x5ceb40(0x1c7)],!![]);}this[_0x5ceb40(0x1bc)][_0x5ceb40(0x1b5)](_0x5ceb40(0x1bd),_0x392d4d[_0x5ceb40(0x1d5)]);}}async[a126_0x4c2611(0x1e4)](_0x18795c){const _0x103a9e=a126_0x4c2611,_0x5f17b1=[],_0x5ef043=[];for(const _0x1c2611 of _0x18795c){if(!_0x1c2611[_0x103a9e(0x1a6)][_0x103a9e(0x1d5)]&&!_0x1c2611[_0x103a9e(0x1cd)][_0x103a9e(0x1d5)]&&!_0x1c2611[_0x103a9e(0x1b9)][_0x103a9e(0x1d5)])continue;const _0x324560=new salesforce_components_manager_service_1['SalesforceComponentsManager'](this[_0x103a9e(0x1eb)][_0x103a9e(0x1a9)],this[_0x103a9e(0x1eb)][_0x103a9e(0x1e5)],_0x1c2611[_0x103a9e(0x1da)],this['options']['recordTypes'],[]);_0x5f17b1['push'](...await _0x324560[_0x103a9e(0x1e8)](_0x1c2611['inserted'])),_0x5f17b1['push'](...await _0x324560['update'](_0x1c2611[_0x103a9e(0x1cd)])),_0x5ef043[_0x103a9e(0x1a8)](await _0x324560[_0x103a9e(0x1e9)](_0x1c2611['removed']));}this[_0x103a9e(0x1bc)][_0x103a9e(0x1b5)](_0x103a9e(0x1d3),_0x5f17b1[_0x103a9e(0x1d5)]),await this['proceedRequests'](_0x5f17b1);const _0x538ca3=_0x5ef043[_0x103a9e(0x1e1)]((_0x40e797,_0x4257fa)=>({'manifests':[..._0x40e797[_0x103a9e(0x19e)],..._0x4257fa['manifests']],'componentsToDelete':[..._0x40e797[_0x103a9e(0x1c7)],..._0x4257fa[_0x103a9e(0x1c7)]],'componentsToUpdate':[..._0x40e797[_0x103a9e(0x1a0)],..._0x4257fa[_0x103a9e(0x1a0)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x538ca3[_0x103a9e(0x19e)]['length']&&await this['proceedRequests'](_0x538ca3['manifests'],!![]),_0x538ca3['componentsToUpdate'][_0x103a9e(0x1d5)]&&await this[_0x103a9e(0x1ae)](_0x538ca3[_0x103a9e(0x1a0)],!![]),_0x538ca3['componentsToDelete'][_0x103a9e(0x1d5)]&&await this[_0x103a9e(0x1ae)](_0x538ca3[_0x103a9e(0x1c7)],!![]);}async['proceedCommits'](_0x5ca35e){const _0x6e9fe8=a126_0x4c2611;this[_0x6e9fe8(0x1eb)][_0x6e9fe8(0x1e5)]?await this[_0x6e9fe8(0x1e4)](_0x5ca35e):await this['proceedCommitsToRepository'](_0x5ca35e);}}exports[a126_0x4c2611(0x1d4)]=SalesforceCommitsManager;