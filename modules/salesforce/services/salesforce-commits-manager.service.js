const a126_0x552a74=a126_0x31e6;(function(_0x38a28d,_0x2d7a0e){const _0x28f31e=a126_0x31e6,_0x91f41a=_0x38a28d();while(!![]){try{const _0x908784=-parseInt(_0x28f31e(0x14c))/0x1+-parseInt(_0x28f31e(0x138))/0x2*(-parseInt(_0x28f31e(0x129))/0x3)+parseInt(_0x28f31e(0x145))/0x4+-parseInt(_0x28f31e(0x12b))/0x5+parseInt(_0x28f31e(0x135))/0x6+-parseInt(_0x28f31e(0x148))/0x7*(-parseInt(_0x28f31e(0x131))/0x8)+-parseInt(_0x28f31e(0x14b))/0x9;if(_0x908784===_0x2d7a0e)break;else _0x91f41a['push'](_0x91f41a['shift']());}catch(_0x5f33fd){_0x91f41a['push'](_0x91f41a['shift']());}}}(a126_0x4fd9,0xc15f5));function a126_0x4fd9(){const _0x300f12=['proceedRequests','constructor','createCommit','message','SalesforceComponentsManager','logger','../../shared/utils','(((.+)+)+)+$','proceedCommitsToRepository','componentsToUpdate','./salesforce-components-manager.service','chunkArray','find','COMPONENTS_PER_CHUNK','apply','componentId','floor','gitSync','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','getProceededComponentsMeta','componentsToDelete','log','3dJAGhT','graph','660405jdvJfw','defineProperty','inserted','proceedCommits','stringify','sfLogger','8cnQseP','SalesforceCommitsManager','branchId','toString','2665878cLsUCo','toJSON','repositoryId','2243782wAUBeD','modified','executeGraphs','search','__importDefault','map','SalesforceError','push','get','typedi','Logger','reference','SalesforceGitSyncService','3368116eltqml','composite','options','2677710rtKEwd','./salesforce-git-sync.service','insert','3857481TweUoY','1438020wJSrgQ','\x20requests\x20to\x20composite\x20api.','../../../constants','recordTypes','manifests','proceedCommitsToBranch','splice','length','proceededComponentsMeta','__esModule','update','default'];a126_0x4fd9=function(){return _0x300f12;};return a126_0x4fd9();}const a126_0x3e4de0=(function(){let _0x14a3f5=!![];return function(_0x105d3c,_0x1e4203){const _0x3c41b3=_0x14a3f5?function(){const _0x19a1b6=a126_0x31e6;if(_0x1e4203){const _0x5b0260=_0x1e4203[_0x19a1b6(0x121)](_0x105d3c,arguments);return _0x1e4203=null,_0x5b0260;}}:function(){};return _0x14a3f5=![],_0x3c41b3;};}()),a126_0x18c891=a126_0x3e4de0(this,function(){const _0x90dd11=a126_0x31e6;return a126_0x18c891['toString']()[_0x90dd11(0x13b)](_0x90dd11(0x11a))[_0x90dd11(0x134)]()[_0x90dd11(0x114)](a126_0x18c891)[_0x90dd11(0x13b)](_0x90dd11(0x11a));});function a126_0x31e6(_0x53314b,_0x4c9319){const _0x46c358=a126_0x4fd9();return a126_0x31e6=function(_0x18c891,_0x3e4de0){_0x18c891=_0x18c891-0x114;let _0x4fd9bb=_0x46c358[_0x18c891];return _0x4fd9bb;},a126_0x31e6(_0x53314b,_0x4c9319);}a126_0x18c891();'use strict';var __importDefault=this&&this[a126_0x552a74(0x13c)]||function(_0x2968a5){const _0x120780=a126_0x552a74;return _0x2968a5&&_0x2968a5[_0x120780(0x155)]?_0x2968a5:{'default':_0x2968a5};};Object[a126_0x552a74(0x12c)](exports,a126_0x552a74(0x155),{'value':!![]}),exports[a126_0x552a74(0x132)]=void 0x0;const core_1=require('../../../core'),typedi_1=__importDefault(require(a126_0x552a74(0x141))),constants_1=require(a126_0x552a74(0x14e)),utils_1=require(a126_0x552a74(0x119)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require('../utils/composite.utils'),salesforce_components_manager_service_1=require(a126_0x552a74(0x11d)),salesforce_composite_service_1=require('./salesforce-composite.service'),salesforce_git_sync_service_1=require(a126_0x552a74(0x149));class SalesforceCommitsManager{constructor(_0x51cc42){const _0x25b5c6=a126_0x552a74;this['options']=_0x51cc42,this[_0x25b5c6(0x120)]=0x3,this[_0x25b5c6(0x118)]=new core_1[(_0x25b5c6(0x142))](SalesforceCommitsManager['name']),this[_0x25b5c6(0x130)]=this[_0x25b5c6(0x147)][_0x25b5c6(0x118)],this[_0x25b5c6(0x146)]=typedi_1['default']['get'](salesforce_composite_service_1['SalesforceCompositeService']),this['gitSync']=typedi_1[_0x25b5c6(0x157)][_0x25b5c6(0x140)](salesforce_git_sync_service_1[_0x25b5c6(0x144)]),this[_0x25b5c6(0x154)]=[];}async[a126_0x552a74(0x158)](_0x35840e,_0x70f5b0=![]){const _0x33631e=a126_0x552a74,_0x205a28=(this['COMPONENTS_PER_CHUNK']+ +_0x70f5b0)*0x3,_0x1cdfd6=utils_1[_0x33631e(0x11e)](_0x35840e,_0x205a28);try{while(_0x1cdfd6['length']){const _0x36ae69=_0x1cdfd6[_0x33631e(0x152)](0x0,Math[_0x33631e(0x123)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x205a28));await this['sfLogger'][_0x33631e(0x128)]('[INFO]\x20Sending\x20'+_0x36ae69['length']*_0x205a28+_0x33631e(0x14d))['send']();const _0x3937af=_0x36ae69[_0x33631e(0x13d)]((_0x259f96,_0x264078)=>({'graphId':_0x33631e(0x12a)+_0x264078,'compositeRequest':_0x259f96})),_0x3f0b72=await this[_0x33631e(0x146)][_0x33631e(0x13a)](_0x3937af);if(_0x70f5b0){const _0x22e5cd=composite_utils_1['extractComponentIdsFromGraphsResponse'](_0x3f0b72);for(const {id:_0x1acc39,ref:_0xc5af51}of _0x22e5cd){const _0xce53e4=this[_0x33631e(0x154)][_0x33631e(0x11f)](_0x375a5c=>_0x375a5c[_0x33631e(0x143)]===_0xc5af51);_0xce53e4&&(_0xce53e4[_0x33631e(0x122)]=_0x1acc39);}}}}catch(_0xd8ed17){this[_0x33631e(0x118)]['error'](_0xd8ed17 instanceof salesforce_error_1[_0x33631e(0x13e)]?JSON[_0x33631e(0x12f)](_0xd8ed17['toJSON'](),null,0x2):_0xd8ed17),this[_0x33631e(0x130)][_0x33631e(0x128)](_0xd8ed17 instanceof salesforce_error_1[_0x33631e(0x13e)]?JSON[_0x33631e(0x12f)](_0xd8ed17[_0x33631e(0x136)](),null,0x2):_0xd8ed17[_0x33631e(0x134)]());throw _0xd8ed17;}}async[a126_0x552a74(0x11b)](_0x243f08){const _0x5b8815=a126_0x552a74;for(const _0x2dc8f4 of _0x243f08){if(!_0x2dc8f4['inserted'][_0x5b8815(0x153)]&&!_0x2dc8f4[_0x5b8815(0x139)]['length']&&!_0x2dc8f4['removed'][_0x5b8815(0x153)])continue;let _0xbdf626='';(_0x2dc8f4[_0x5b8815(0x139)][_0x5b8815(0x153)]||_0x2dc8f4['inserted']['length'])&&(_0xbdf626=await this[_0x5b8815(0x124)][_0x5b8815(0x115)](_0x2dc8f4[_0x5b8815(0x116)],this[_0x5b8815(0x147)][_0x5b8815(0x137)]));const _0x31a5a2=[],_0x9d336b=[],_0x174edb=new salesforce_components_manager_service_1[(_0x5b8815(0x117))](this[_0x5b8815(0x147)][_0x5b8815(0x137)],this[_0x5b8815(0x147)]['branchId'],_0x2dc8f4['author'],this['options']['recordTypes'],this[_0x5b8815(0x154)]);_0x31a5a2[_0x5b8815(0x13f)](...await _0x174edb['insert'](_0x2dc8f4[_0x5b8815(0x12d)],_0xbdf626)),_0x31a5a2['push'](...await _0x174edb[_0x5b8815(0x156)](_0x2dc8f4['modified'],_0xbdf626)),_0x9d336b[_0x5b8815(0x13f)](await _0x174edb['delete'](_0x2dc8f4['removed'],!![])),this[_0x5b8815(0x154)]=_0x174edb[_0x5b8815(0x126)](),await this[_0x5b8815(0x158)](_0x31a5a2,!![]);for(const _0x1b8706 of _0x9d336b){_0x1b8706[_0x5b8815(0x150)]['length']&&await this['proceedRequests'](_0x1b8706['manifests'],!![]),_0x1b8706[_0x5b8815(0x11c)][_0x5b8815(0x153)]&&await this[_0x5b8815(0x158)](_0x1b8706[_0x5b8815(0x11c)],!![]),_0x1b8706['componentsToDelete'][_0x5b8815(0x153)]&&await this[_0x5b8815(0x158)](_0x1b8706[_0x5b8815(0x127)],!![]);}this[_0x5b8815(0x118)][_0x5b8815(0x128)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x31a5a2[_0x5b8815(0x153)]);}}async[a126_0x552a74(0x151)](_0x4268c1){const _0x148494=a126_0x552a74,_0xe5064=[],_0x3c55f6=[];for(const _0x2767cd of _0x4268c1){if(!_0x2767cd[_0x148494(0x12d)][_0x148494(0x153)]&&!_0x2767cd[_0x148494(0x139)][_0x148494(0x153)]&&!_0x2767cd['removed'][_0x148494(0x153)])continue;const _0x54ed49=new salesforce_components_manager_service_1[(_0x148494(0x117))](this[_0x148494(0x147)]['repositoryId'],this[_0x148494(0x147)][_0x148494(0x133)],_0x2767cd['author'],this[_0x148494(0x147)][_0x148494(0x14f)],[]);_0xe5064[_0x148494(0x13f)](...await _0x54ed49[_0x148494(0x14a)](_0x2767cd[_0x148494(0x12d)])),_0xe5064[_0x148494(0x13f)](...await _0x54ed49['update'](_0x2767cd[_0x148494(0x139)])),_0x3c55f6['push'](await _0x54ed49['delete'](_0x2767cd['removed']));}this[_0x148494(0x118)][_0x148494(0x128)](_0x148494(0x125),_0xe5064[_0x148494(0x153)]),await this[_0x148494(0x158)](_0xe5064);const _0x2ab5bc=_0x3c55f6['reduce']((_0x21436e,_0x4567d0)=>({'manifests':[..._0x21436e[_0x148494(0x150)],..._0x4567d0[_0x148494(0x150)]],'componentsToDelete':[..._0x21436e[_0x148494(0x127)],..._0x4567d0[_0x148494(0x127)]],'componentsToUpdate':[..._0x21436e[_0x148494(0x11c)],..._0x4567d0['componentsToUpdate']]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x2ab5bc['manifests'][_0x148494(0x153)]&&await this[_0x148494(0x158)](_0x2ab5bc['manifests'],!![]),_0x2ab5bc[_0x148494(0x11c)][_0x148494(0x153)]&&await this['proceedRequests'](_0x2ab5bc[_0x148494(0x11c)],!![]),_0x2ab5bc['componentsToDelete']['length']&&await this[_0x148494(0x158)](_0x2ab5bc['componentsToDelete'],!![]);}async[a126_0x552a74(0x12e)](_0x352428){const _0x49a513=a126_0x552a74;this[_0x49a513(0x147)][_0x49a513(0x133)]?await this[_0x49a513(0x151)](_0x352428):await this['proceedCommitsToRepository'](_0x352428);}}exports[a126_0x552a74(0x132)]=SalesforceCommitsManager;