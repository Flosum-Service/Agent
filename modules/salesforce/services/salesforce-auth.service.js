const a126_0x12756a=a126_0x2d80;(function(_0x5346f2,_0x4846b6){const _0x334c13=a126_0x2d80,_0x3250e5=_0x5346f2();while(!![]){try{const _0x19514a=-parseInt(_0x334c13(0x195))/0x1+-parseInt(_0x334c13(0x193))/0x2+parseInt(_0x334c13(0x15e))/0x3+parseInt(_0x334c13(0x16b))/0x4+-parseInt(_0x334c13(0x18e))/0x5+parseInt(_0x334c13(0x174))/0x6*(parseInt(_0x334c13(0x15d))/0x7)+parseInt(_0x334c13(0x155))/0x8;if(_0x19514a===_0x4846b6)break;else _0x3250e5['push'](_0x3250e5['shift']());}catch(_0x2e53b8){_0x3250e5['push'](_0x3250e5['shift']());}}}(a126_0x5096,0x518a4));function a126_0x5096(){const _0x1344f2=['updateAccessToken','apply','update\x20access\x20token\x20failed:\x20%s','Active','../../shared/utils','access_token','../../../constants','catch','SALESFORCE_API_VERSION','logger','forceUpdateToken','joinURL','name','default','3154685TROVji','salesforseSettings','Service','constructor','data','847566xVaGYW','Logger','395758ZHUukC','Updating','__metadata','message','instanceUrl','Idle','authState','check\x20auth:\x20current\x20state\x20-\x20%s','InvalidRefreshTokenError','object','toString','../enums/auth-state.enum','7513136ECSaBE','ERR_INVALID_SALESFORCE_TOKEN','function','requestConfig','loginUrl','SalesforceSettingsService','axios','then','581IixvzK','998538TkDdQV','length','application/json','accessToken','__esModule','AuthState','log','decorate','__decorate','response','tokenType','../../../core','../errors/invalid-refresh-token.error','178096SnmXvO','defineProperty','sleep','AUTH_WAIT_TIME','__importDefault','../errors/unauthorized-salesforce.error','SalesforceAuthService','UnauthorizedSalesforceError','setAuthDetails','33828EXSyfg','metadata','refresh_token','Error','orgId','design:paramtypes','getOwnPropertyDescriptor','waitAuth','error','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','settings','access\x20token\x20updated\x20for\x20%s'];a126_0x5096=function(){return _0x1344f2;};return a126_0x5096();}const a126_0x2675c6=(function(){let _0xc50f36=!![];return function(_0x272c5e,_0x2ee588){const _0x62b7d7=_0xc50f36?function(){const _0x2f66f5=a126_0x2d80;if(_0x2ee588){const _0x1c550e=_0x2ee588[_0x2f66f5(0x181)](_0x272c5e,arguments);return _0x2ee588=null,_0x1c550e;}}:function(){};return _0xc50f36=![],_0x62b7d7;};}()),a126_0x1bbb3f=a126_0x2675c6(this,function(){const _0x4dbeca=a126_0x2d80;return a126_0x1bbb3f[_0x4dbeca(0x153)]()['search']('(((.+)+)+)+$')[_0x4dbeca(0x153)]()[_0x4dbeca(0x191)](a126_0x1bbb3f)['search']('(((.+)+)+)+$');});a126_0x1bbb3f();'use strict';var __decorate=this&&this[a126_0x12756a(0x166)]||function(_0x4db89d,_0xf57631,_0xb5ca77,_0xf2c13f){const _0x383683=a126_0x12756a;var _0x2b8162=arguments[_0x383683(0x15f)],_0x2fdcac=_0x2b8162<0x3?_0xf57631:_0xf2c13f===null?_0xf2c13f=Object[_0x383683(0x17a)](_0xf57631,_0xb5ca77):_0xf2c13f,_0x4f5285;if(typeof Reflect==='object'&&typeof Reflect[_0x383683(0x165)]===_0x383683(0x157))_0x2fdcac=Reflect[_0x383683(0x165)](_0x4db89d,_0xf57631,_0xb5ca77,_0xf2c13f);else{for(var _0x4ceb38=_0x4db89d[_0x383683(0x15f)]-0x1;_0x4ceb38>=0x0;_0x4ceb38--)if(_0x4f5285=_0x4db89d[_0x4ceb38])_0x2fdcac=(_0x2b8162<0x3?_0x4f5285(_0x2fdcac):_0x2b8162>0x3?_0x4f5285(_0xf57631,_0xb5ca77,_0x2fdcac):_0x4f5285(_0xf57631,_0xb5ca77))||_0x2fdcac;}return _0x2b8162>0x3&&_0x2fdcac&&Object[_0x383683(0x16c)](_0xf57631,_0xb5ca77,_0x2fdcac),_0x2fdcac;},__metadata=this&&this[a126_0x12756a(0x14b)]||function(_0xc26e61,_0x118c89){const _0xb34465=a126_0x12756a;if(typeof Reflect===_0xb34465(0x152)&&typeof Reflect[_0xb34465(0x175)]===_0xb34465(0x157))return Reflect['metadata'](_0xc26e61,_0x118c89);},__importDefault=this&&this[a126_0x12756a(0x16f)]||function(_0x410fba){const _0x2285e4=a126_0x12756a;return _0x410fba&&_0x410fba[_0x2285e4(0x162)]?_0x410fba:{'default':_0x410fba};},SalesforceAuthService_1;function a126_0x2d80(_0x86636,_0x4726a7){const _0xf04991=a126_0x5096();return a126_0x2d80=function(_0x1bbb3f,_0x2675c6){_0x1bbb3f=_0x1bbb3f-0x14a;let _0x509653=_0xf04991[_0x1bbb3f];return _0x509653;},a126_0x2d80(_0x86636,_0x4726a7);}Object[a126_0x12756a(0x16c)](exports,a126_0x12756a(0x162),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require('typedi'),errors_1=require('../../../constants/errors'),core_1=require(a126_0x12756a(0x169)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a126_0x12756a(0x15b))),utils_1=require(a126_0x12756a(0x184)),invalid_refresh_token_error_1=require(a126_0x12756a(0x16a)),auth_state_enum_1=require(a126_0x12756a(0x154)),unauthorized_salesforce_error_1=require(a126_0x12756a(0x170)),constants_1=require(a126_0x12756a(0x186));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x408884){const _0x142d6b=a126_0x12756a;this[_0x142d6b(0x18f)]=_0x408884,this['AUTH_WAIT_TIME']=0x1388,this['authState']=auth_state_enum_1[_0x142d6b(0x163)][_0x142d6b(0x14e)],this[_0x142d6b(0x189)]=new core_1[(_0x142d6b(0x194))](SalesforceAuthService_1[_0x142d6b(0x18c)]),this['setAuthDetails']();}get[a126_0x12756a(0x17e)](){const _0x2a3c93=a126_0x12756a;return this[_0x2a3c93(0x18f)][_0x2a3c93(0x17e)];}async[a126_0x12756a(0x173)](){const _0x4cb84b=a126_0x12756a;this[_0x4cb84b(0x189)][_0x4cb84b(0x164)](_0x4cb84b(0x150),auth_state_enum_1[_0x4cb84b(0x163)][this[_0x4cb84b(0x14f)]]);try{if(this[_0x4cb84b(0x14f)]===auth_state_enum_1[_0x4cb84b(0x163)][_0x4cb84b(0x177)])return;if(this[_0x4cb84b(0x14f)]===auth_state_enum_1[_0x4cb84b(0x163)][_0x4cb84b(0x14e)])await this[_0x4cb84b(0x180)]();else{const _0x5526f0=await this['requestConfig'](),_0x4bd669=await axios_1[_0x4cb84b(0x18d)]['get']('services/data/'+constants_1[_0x4cb84b(0x188)],_0x5526f0)[_0x4cb84b(0x15c)](()=>!![])[_0x4cb84b(0x187)](()=>![]);!_0x4bd669&&await this['updateAccessToken']();}}catch(_0x5edbe9){}}async[a126_0x12756a(0x180)](){const _0x5bc5bd=a126_0x12756a;var _0x96e8e1,_0x8c1218,_0xf9a608;this[_0x5bc5bd(0x189)][_0x5bc5bd(0x164)]('update\x20access\x20token');try{this[_0x5bc5bd(0x14f)]=auth_state_enum_1[_0x5bc5bd(0x163)][_0x5bc5bd(0x14a)];const {refreshToken:_0x6693ca,clientId:_0x232db8,clientSecret:_0x161c82}=this[_0x5bc5bd(0x17e)],{data:_0x2e8d86}=await axios_1[_0x5bc5bd(0x18d)]['post'](utils_1[_0x5bc5bd(0x18b)](this[_0x5bc5bd(0x18f)][_0x5bc5bd(0x159)],'/services/oauth2/token'),null,{'params':{'grant_type':_0x5bc5bd(0x176),'refresh_token':_0x6693ca,'client_id':_0x232db8,'client_secret':_0x161c82}});this[_0x5bc5bd(0x14d)]=_0x2e8d86['instance_url'],this[_0x5bc5bd(0x161)]=_0x2e8d86[_0x5bc5bd(0x185)],this[_0x5bc5bd(0x168)]=_0x2e8d86['token_type'],this[_0x5bc5bd(0x14f)]=auth_state_enum_1[_0x5bc5bd(0x163)][_0x5bc5bd(0x183)],this[_0x5bc5bd(0x189)][_0x5bc5bd(0x164)](_0x5bc5bd(0x17f),this[_0x5bc5bd(0x14d)]);}catch(_0xb0a957){const _0x598d7c=((_0x8c1218=(_0x96e8e1=_0xb0a957===null||_0xb0a957===void 0x0?void 0x0:_0xb0a957[_0x5bc5bd(0x167)])===null||_0x96e8e1===void 0x0?void 0x0:_0x96e8e1['data'])===null||_0x8c1218===void 0x0?void 0x0:_0x8c1218[_0x5bc5bd(0x17c)])||((_0xf9a608=_0xb0a957===null||_0xb0a957===void 0x0?void 0x0:_0xb0a957['response'])===null||_0xf9a608===void 0x0?void 0x0:_0xf9a608[_0x5bc5bd(0x192)])||_0xb0a957[_0x5bc5bd(0x14c)];this['logger'][_0x5bc5bd(0x17c)](_0x5bc5bd(0x182),_0x598d7c),this[_0x5bc5bd(0x14f)]=auth_state_enum_1['AuthState'][_0x5bc5bd(0x177)];throw new invalid_refresh_token_error_1[(_0x5bc5bd(0x151))](errors_1[_0x5bc5bd(0x156)]);}}async[a126_0x12756a(0x18a)](){const _0x34a82c=a126_0x12756a;this[_0x34a82c(0x189)][_0x34a82c(0x164)]('force\x20update\x20token');if(this[_0x34a82c(0x14f)]===auth_state_enum_1[_0x34a82c(0x163)][_0x34a82c(0x14a)]||this[_0x34a82c(0x14f)]===auth_state_enum_1[_0x34a82c(0x163)][_0x34a82c(0x14e)])return await utils_1[_0x34a82c(0x16d)](this['AUTH_WAIT_TIME']),this[_0x34a82c(0x18a)]();if(this['authState']===auth_state_enum_1[_0x34a82c(0x163)][_0x34a82c(0x177)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x34a82c(0x156)]);await this['updateAccessToken']();}async[a126_0x12756a(0x17b)](){const _0x402916=a126_0x12756a;if(this['authState']===auth_state_enum_1['AuthState'][_0x402916(0x177)]){this[_0x402916(0x189)][_0x402916(0x164)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x402916(0x172))]();}if(this[_0x402916(0x14f)]!==auth_state_enum_1[_0x402916(0x163)]['Active'])return this[_0x402916(0x189)]['log'](_0x402916(0x17d)),await utils_1[_0x402916(0x16d)](this[_0x402916(0x16e)]),this[_0x402916(0x17b)]();}['getAuthData'](){const _0x2936a6=a126_0x12756a;return{'orgId':this[_0x2936a6(0x178)],'accessToken':this[_0x2936a6(0x161)],'instanceUrl':this['instanceUrl']};}async[a126_0x12756a(0x158)](){const _0x5e0f10=a126_0x12756a;return await this['waitAuth'](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x5e0f10(0x160),'authorization':this[_0x5e0f10(0x168)]+'\x20'+this[_0x5e0f10(0x161)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x12756a(0x190)](),__metadata(a126_0x12756a(0x179),[salesforce_settings_service_1[a126_0x12756a(0x15a)]])],SalesforceAuthService),exports[a126_0x12756a(0x171)]=SalesforceAuthService;