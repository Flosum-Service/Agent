const a126_0x49b0cd=a126_0x2245;(function(_0x49f130,_0x53ebce){const _0x347411=a126_0x2245,_0x40ee2e=_0x49f130();while(!![]){try{const _0x364b1b=parseInt(_0x347411(0xc3))/0x1+-parseInt(_0x347411(0xaa))/0x2*(parseInt(_0x347411(0x7f))/0x3)+parseInt(_0x347411(0xc0))/0x4*(-parseInt(_0x347411(0xa3))/0x5)+-parseInt(_0x347411(0x8a))/0x6+-parseInt(_0x347411(0x79))/0x7*(-parseInt(_0x347411(0xb2))/0x8)+parseInt(_0x347411(0xbf))/0x9*(-parseInt(_0x347411(0x7c))/0xa)+parseInt(_0x347411(0x89))/0xb*(parseInt(_0x347411(0xc2))/0xc);if(_0x364b1b===_0x53ebce)break;else _0x40ee2e['push'](_0x40ee2e['shift']());}catch(_0x591d40){_0x40ee2e['push'](_0x40ee2e['shift']());}}}(a126_0x2a84,0x951c3));const a126_0x1270d9=(function(){let _0x242cca=!![];return function(_0xa1616b,_0x336419){const _0x5499fe=_0x242cca?function(){const _0x13a68a=a126_0x2245;if(_0x336419){const _0x59a71a=_0x336419[_0x13a68a(0xb9)](_0xa1616b,arguments);return _0x336419=null,_0x59a71a;}}:function(){};return _0x242cca=![],_0x5499fe;};}()),a126_0x170934=a126_0x1270d9(this,function(){const _0xcbe1fd=a126_0x2245;return a126_0x170934[_0xcbe1fd(0xa0)]()[_0xcbe1fd(0xb0)](_0xcbe1fd(0xbd))[_0xcbe1fd(0xa0)]()['constructor'](a126_0x170934)[_0xcbe1fd(0xb0)]('(((.+)+)+)+$');});a126_0x170934();function a126_0x2a84(){const _0x5e2d26=['__decorate','default','logger','then','toString','refresh_token','Updating','80ZltMLO','../../shared/services/salesforce-settings.service','defineProperty','waitAuth','post','data','ERR_INVALID_SALESFORCE_TOKEN','6JawDHS','length','Idle','settings','application/json','access\x20token\x20updated\x20for\x20%s','search','update\x20access\x20token','22384EEtQGP','../../shared/utils','log','setAuthDetails','SalesforceAuthService','AUTH_WAIT_TIME','Logger','apply','AuthState','/services/oauth2/token','SALESFORCE_API_VERSION','(((.+)+)+)+$','salesforseSettings','72477bUvpvM','23552GJRdRk','error','174396rnVJRv','997061GbeZxl','get','services/data/','requestConfig','name','check\x20auth:\x20current\x20state\x20-\x20%s','loginUrl','force\x20update\x20token','decorate','access_token','2947wLamCd','__metadata','tokenType','530XnuLIP','create\x20authorized\x20request\x20failed:\x20authorization\x20error','forceUpdateToken','969477RyjgIE','response','message','SalesforceSettingsService','__esModule','instanceUrl','../errors/unauthorized-salesforce.error','instance_url','joinURL','accessToken','627bLkjaU','5412906vMRMvV','InvalidRefreshTokenError','Service','metadata','token_type','Error','../errors/invalid-refresh-token.error','catch','sleep','../../../core','../../../constants/errors','Active','design:paramtypes','authState','updateAccessToken','object','function','../../../constants'];a126_0x2a84=function(){return _0x5e2d26;};return a126_0x2a84();}'use strict';var __decorate=this&&this[a126_0x49b0cd(0x9c)]||function(_0x5b2523,_0x575ea6,_0x234b58,_0x33ee72){const _0x1c8373=a126_0x49b0cd;var _0x2de718=arguments[_0x1c8373(0xab)],_0x43fa34=_0x2de718<0x3?_0x575ea6:_0x33ee72===null?_0x33ee72=Object['getOwnPropertyDescriptor'](_0x575ea6,_0x234b58):_0x33ee72,_0x47bce0;if(typeof Reflect===_0x1c8373(0x99)&&typeof Reflect[_0x1c8373(0x77)]===_0x1c8373(0x9a))_0x43fa34=Reflect[_0x1c8373(0x77)](_0x5b2523,_0x575ea6,_0x234b58,_0x33ee72);else{for(var _0x4f4220=_0x5b2523[_0x1c8373(0xab)]-0x1;_0x4f4220>=0x0;_0x4f4220--)if(_0x47bce0=_0x5b2523[_0x4f4220])_0x43fa34=(_0x2de718<0x3?_0x47bce0(_0x43fa34):_0x2de718>0x3?_0x47bce0(_0x575ea6,_0x234b58,_0x43fa34):_0x47bce0(_0x575ea6,_0x234b58))||_0x43fa34;}return _0x2de718>0x3&&_0x43fa34&&Object[_0x1c8373(0xa5)](_0x575ea6,_0x234b58,_0x43fa34),_0x43fa34;},__metadata=this&&this[a126_0x49b0cd(0x7a)]||function(_0x2b8d72,_0x313570){const _0x425175=a126_0x49b0cd;if(typeof Reflect===_0x425175(0x99)&&typeof Reflect['metadata']===_0x425175(0x9a))return Reflect[_0x425175(0x8d)](_0x2b8d72,_0x313570);},__importDefault=this&&this['__importDefault']||function(_0x2565a5){const _0x1efee0=a126_0x49b0cd;return _0x2565a5&&_0x2565a5[_0x1efee0(0x83)]?_0x2565a5:{'default':_0x2565a5};},SalesforceAuthService_1;Object['defineProperty'](exports,a126_0x49b0cd(0x83),{'value':!![]}),exports[a126_0x49b0cd(0xb6)]=void 0x0;const typedi_1=require('typedi'),errors_1=require(a126_0x49b0cd(0x94)),core_1=require(a126_0x49b0cd(0x93)),salesforce_settings_service_1=require(a126_0x49b0cd(0xa4)),axios_1=__importDefault(require('axios')),utils_1=require(a126_0x49b0cd(0xb3)),invalid_refresh_token_error_1=require(a126_0x49b0cd(0x90)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a126_0x49b0cd(0x85)),constants_1=require(a126_0x49b0cd(0x9b));function a126_0x2245(_0x4b3d5b,_0x5a9f08){const _0xdd4ff=a126_0x2a84();return a126_0x2245=function(_0x170934,_0x1270d9){_0x170934=_0x170934-0x70;let _0x2a8493=_0xdd4ff[_0x170934];return _0x2a8493;},a126_0x2245(_0x4b3d5b,_0x5a9f08);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x69b793){const _0xaabecb=a126_0x49b0cd;this[_0xaabecb(0xbe)]=_0x69b793,this[_0xaabecb(0xb7)]=0x1388,this[_0xaabecb(0x97)]=auth_state_enum_1['AuthState'][_0xaabecb(0xac)],this[_0xaabecb(0x9e)]=new core_1[(_0xaabecb(0xb8))](SalesforceAuthService_1[_0xaabecb(0x73)]),this[_0xaabecb(0xb5)]();}get[a126_0x49b0cd(0xad)](){const _0x276f7c=a126_0x49b0cd;return this[_0x276f7c(0xbe)]['settings'];}async[a126_0x49b0cd(0xb5)](){const _0x4895d6=a126_0x49b0cd;this[_0x4895d6(0x9e)][_0x4895d6(0xb4)](_0x4895d6(0x74),auth_state_enum_1[_0x4895d6(0xba)][this['authState']]);try{if(this[_0x4895d6(0x97)]===auth_state_enum_1[_0x4895d6(0xba)][_0x4895d6(0x8f)])return;if(this[_0x4895d6(0x97)]===auth_state_enum_1['AuthState']['Idle'])await this[_0x4895d6(0x98)]();else{const _0x954056=await this[_0x4895d6(0x72)](),_0x285bb7=await axios_1[_0x4895d6(0x9d)][_0x4895d6(0x70)](_0x4895d6(0x71)+constants_1[_0x4895d6(0xbc)],_0x954056)[_0x4895d6(0x9f)](()=>!![])[_0x4895d6(0x91)](()=>![]);!_0x285bb7&&await this[_0x4895d6(0x98)]();}}catch(_0x486675){}}async['updateAccessToken'](){const _0x31ef8b=a126_0x49b0cd;var _0x41be21,_0x1bae93,_0xa0115f;this[_0x31ef8b(0x9e)][_0x31ef8b(0xb4)](_0x31ef8b(0xb1));try{this['authState']=auth_state_enum_1[_0x31ef8b(0xba)][_0x31ef8b(0xa2)];const {refreshToken:_0x2037ba,clientId:_0x82128a,clientSecret:_0x4262c9}=this[_0x31ef8b(0xad)],{data:_0x1b5a29}=await axios_1['default'][_0x31ef8b(0xa7)](utils_1[_0x31ef8b(0x87)](this[_0x31ef8b(0xbe)][_0x31ef8b(0x75)],_0x31ef8b(0xbb)),null,{'params':{'grant_type':_0x31ef8b(0xa1),'refresh_token':_0x2037ba,'client_id':_0x82128a,'client_secret':_0x4262c9}});this[_0x31ef8b(0x84)]=_0x1b5a29[_0x31ef8b(0x86)],this[_0x31ef8b(0x88)]=_0x1b5a29[_0x31ef8b(0x78)],this[_0x31ef8b(0x7b)]=_0x1b5a29[_0x31ef8b(0x8e)],this[_0x31ef8b(0x97)]=auth_state_enum_1[_0x31ef8b(0xba)][_0x31ef8b(0x95)],this['logger'][_0x31ef8b(0xb4)](_0x31ef8b(0xaf),this['instanceUrl']);}catch(_0x81884){const _0x1eab6e=((_0x1bae93=(_0x41be21=_0x81884===null||_0x81884===void 0x0?void 0x0:_0x81884[_0x31ef8b(0x80)])===null||_0x41be21===void 0x0?void 0x0:_0x41be21[_0x31ef8b(0xa8)])===null||_0x1bae93===void 0x0?void 0x0:_0x1bae93[_0x31ef8b(0xc1)])||((_0xa0115f=_0x81884===null||_0x81884===void 0x0?void 0x0:_0x81884[_0x31ef8b(0x80)])===null||_0xa0115f===void 0x0?void 0x0:_0xa0115f[_0x31ef8b(0xa8)])||_0x81884[_0x31ef8b(0x81)];this[_0x31ef8b(0x9e)]['error']('update\x20access\x20token\x20failed:\x20%s',_0x1eab6e),this[_0x31ef8b(0x97)]=auth_state_enum_1[_0x31ef8b(0xba)]['Error'];throw new invalid_refresh_token_error_1[(_0x31ef8b(0x8b))](errors_1[_0x31ef8b(0xa9)]);}}async[a126_0x49b0cd(0x7e)](){const _0x5cbc25=a126_0x49b0cd;this[_0x5cbc25(0x9e)][_0x5cbc25(0xb4)](_0x5cbc25(0x76));if(this['authState']===auth_state_enum_1[_0x5cbc25(0xba)][_0x5cbc25(0xa2)]||this['authState']===auth_state_enum_1['AuthState'][_0x5cbc25(0xac)])return await utils_1[_0x5cbc25(0x92)](this['AUTH_WAIT_TIME']),this[_0x5cbc25(0x7e)]();if(this['authState']===auth_state_enum_1['AuthState']['Error'])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x5cbc25(0xa9)]);await this['updateAccessToken']();}async['waitAuth'](){const _0x3c2586=a126_0x49b0cd;if(this[_0x3c2586(0x97)]===auth_state_enum_1[_0x3c2586(0xba)][_0x3c2586(0x8f)]){this[_0x3c2586(0x9e)][_0x3c2586(0xb4)](_0x3c2586(0x7d));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x3c2586(0x97)]!==auth_state_enum_1[_0x3c2586(0xba)][_0x3c2586(0x95)])return this[_0x3c2586(0x9e)][_0x3c2586(0xb4)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x3c2586(0x92)](this[_0x3c2586(0xb7)]),this[_0x3c2586(0xa6)]();}['getAuthData'](){const _0x9b3184=a126_0x49b0cd;return{'orgId':this['orgId'],'accessToken':this[_0x9b3184(0x88)],'instanceUrl':this['instanceUrl']};}async[a126_0x49b0cd(0x72)](){const _0x3ca426=a126_0x49b0cd;return await this[_0x3ca426(0xa6)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x3ca426(0xae),'authorization':this[_0x3ca426(0x7b)]+'\x20'+this[_0x3ca426(0x88)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x49b0cd(0x8c)](),__metadata(a126_0x49b0cd(0x96),[salesforce_settings_service_1[a126_0x49b0cd(0x82)]])],SalesforceAuthService),exports[a126_0x49b0cd(0xb6)]=SalesforceAuthService;