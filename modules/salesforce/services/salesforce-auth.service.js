const a126_0x5952e9=a126_0x5b71;(function(_0xe46028,_0x1f29b8){const _0x4320fb=a126_0x5b71,_0xaca70d=_0xe46028();while(!![]){try{const _0x3e72ec=parseInt(_0x4320fb(0xb0))/0x1+parseInt(_0x4320fb(0xc3))/0x2*(-parseInt(_0x4320fb(0x8f))/0x3)+parseInt(_0x4320fb(0xae))/0x4+parseInt(_0x4320fb(0xb4))/0x5+-parseInt(_0x4320fb(0xbf))/0x6*(parseInt(_0x4320fb(0xa3))/0x7)+parseInt(_0x4320fb(0xb6))/0x8*(parseInt(_0x4320fb(0xb3))/0x9)+-parseInt(_0x4320fb(0xb2))/0xa;if(_0x3e72ec===_0x1f29b8)break;else _0xaca70d['push'](_0xaca70d['shift']());}catch(_0x45fb25){_0xaca70d['push'](_0xaca70d['shift']());}}}(a126_0x3c07,0x18dc3));const a126_0x279c98=(function(){let _0x123e7b=!![];return function(_0x4a02d9,_0x27a8df){const _0x1af934=_0x123e7b?function(){if(_0x27a8df){const _0x366c25=_0x27a8df['apply'](_0x4a02d9,arguments);return _0x27a8df=null,_0x366c25;}}:function(){};return _0x123e7b=![],_0x1af934;};}()),a126_0x534457=a126_0x279c98(this,function(){const _0x41e87c=a126_0x5b71;return a126_0x534457[_0x41e87c(0x8b)]()[_0x41e87c(0xbc)](_0x41e87c(0xb5))['toString']()[_0x41e87c(0x80)](a126_0x534457)[_0x41e87c(0xbc)](_0x41e87c(0xb5));});function a126_0x5b71(_0x2d8620,_0x2f6378){const _0xdca6eb=a126_0x3c07();return a126_0x5b71=function(_0x534457,_0x279c98){_0x534457=_0x534457-0x7e;let _0x3c07f0=_0xdca6eb[_0x534457];return _0x3c07f0;},a126_0x5b71(_0x2d8620,_0x2f6378);}a126_0x534457();'use strict';var __decorate=this&&this[a126_0x5952e9(0xb1)]||function(_0xef4f53,_0x309e2a,_0x3f9eb3,_0x44e9a8){const _0xa0abd6=a126_0x5952e9;var _0x5fa948=arguments[_0xa0abd6(0xa9)],_0x44969b=_0x5fa948<0x3?_0x309e2a:_0x44e9a8===null?_0x44e9a8=Object[_0xa0abd6(0x90)](_0x309e2a,_0x3f9eb3):_0x44e9a8,_0x231c2f;if(typeof Reflect==='object'&&typeof Reflect[_0xa0abd6(0x88)]===_0xa0abd6(0x91))_0x44969b=Reflect['decorate'](_0xef4f53,_0x309e2a,_0x3f9eb3,_0x44e9a8);else{for(var _0x1f198c=_0xef4f53[_0xa0abd6(0xa9)]-0x1;_0x1f198c>=0x0;_0x1f198c--)if(_0x231c2f=_0xef4f53[_0x1f198c])_0x44969b=(_0x5fa948<0x3?_0x231c2f(_0x44969b):_0x5fa948>0x3?_0x231c2f(_0x309e2a,_0x3f9eb3,_0x44969b):_0x231c2f(_0x309e2a,_0x3f9eb3))||_0x44969b;}return _0x5fa948>0x3&&_0x44969b&&Object[_0xa0abd6(0x81)](_0x309e2a,_0x3f9eb3,_0x44969b),_0x44969b;},__metadata=this&&this['__metadata']||function(_0x1a4441,_0x17b927){const _0x1872ec=a126_0x5952e9;if(typeof Reflect==='object'&&typeof Reflect[_0x1872ec(0x9f)]===_0x1872ec(0x91))return Reflect['metadata'](_0x1a4441,_0x17b927);},__importDefault=this&&this['__importDefault']||function(_0x5e3215){const _0x5c1d6f=a126_0x5952e9;return _0x5e3215&&_0x5e3215[_0x5c1d6f(0xa6)]?_0x5e3215:{'default':_0x5e3215};},SalesforceAuthService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a126_0x5952e9(0x93)]=void 0x0;const typedi_1=require(a126_0x5952e9(0xaf)),errors_1=require('../../../constants/errors'),core_1=require(a126_0x5952e9(0xca)),salesforce_settings_service_1=require(a126_0x5952e9(0xa8)),axios_1=__importDefault(require(a126_0x5952e9(0x8d))),utils_1=require(a126_0x5952e9(0x83)),invalid_refresh_token_error_1=require(a126_0x5952e9(0xc1)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a126_0x5952e9(0xba)),constants_1=require(a126_0x5952e9(0x7e));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x3d272c){const _0x354395=a126_0x5952e9;this[_0x354395(0x85)]=_0x3d272c,this[_0x354395(0x9e)]=0x1388,this[_0x354395(0xa1)]=auth_state_enum_1[_0x354395(0x9b)]['Idle'],this[_0x354395(0xbd)]=new core_1['Logger'](SalesforceAuthService_1[_0x354395(0x8e)]),this[_0x354395(0x9d)]();}get[a126_0x5952e9(0xb9)](){const _0x1cb784=a126_0x5952e9;return this[_0x1cb784(0x85)]['settings'];}async[a126_0x5952e9(0x9d)](){const _0x4956ac=a126_0x5952e9;this[_0x4956ac(0xbd)][_0x4956ac(0xc2)](_0x4956ac(0xa4),auth_state_enum_1['AuthState'][this[_0x4956ac(0xa1)]]);try{if(this[_0x4956ac(0xa1)]===auth_state_enum_1[_0x4956ac(0x9b)][_0x4956ac(0xc6)])return;if(this[_0x4956ac(0xa1)]===auth_state_enum_1[_0x4956ac(0x9b)][_0x4956ac(0x8a)])await this[_0x4956ac(0xc7)]();else{const _0x7888aa=await this[_0x4956ac(0x96)](),_0xb32f1a=await axios_1[_0x4956ac(0xa2)]['get'](_0x4956ac(0x98)+constants_1[_0x4956ac(0xaa)],_0x7888aa)[_0x4956ac(0xc9)](()=>!![])[_0x4956ac(0xac)](()=>![]);!_0xb32f1a&&await this[_0x4956ac(0xc7)]();}}catch(_0x2cf3c7){}}async[a126_0x5952e9(0xc7)](){const _0x2a18b7=a126_0x5952e9;var _0xb60d2d,_0x33d98a,_0x167709;this[_0x2a18b7(0xbd)][_0x2a18b7(0xc2)](_0x2a18b7(0x94));try{this[_0x2a18b7(0xa1)]=auth_state_enum_1[_0x2a18b7(0x9b)][_0x2a18b7(0xa5)];const {refreshToken:_0x4bb94c,clientId:_0x4190c9,clientSecret:_0x94563f}=this[_0x2a18b7(0xb9)],{data:_0x25495c}=await axios_1[_0x2a18b7(0xa2)][_0x2a18b7(0xc0)](utils_1[_0x2a18b7(0xbe)](this[_0x2a18b7(0x85)][_0x2a18b7(0x82)],_0x2a18b7(0x95)),null,{'params':{'grant_type':_0x2a18b7(0xa0),'refresh_token':_0x4bb94c,'client_id':_0x4190c9,'client_secret':_0x94563f}});this['instanceUrl']=_0x25495c['instance_url'],this[_0x2a18b7(0xab)]=_0x25495c[_0x2a18b7(0xad)],this[_0x2a18b7(0x87)]=_0x25495c[_0x2a18b7(0xc5)],this[_0x2a18b7(0xa1)]=auth_state_enum_1['AuthState']['Active'],this[_0x2a18b7(0xbd)][_0x2a18b7(0xc2)]('access\x20token\x20updated\x20for\x20%s',this[_0x2a18b7(0xbb)]);}catch(_0x3779a3){const _0x1871a1=((_0x33d98a=(_0xb60d2d=_0x3779a3===null||_0x3779a3===void 0x0?void 0x0:_0x3779a3[_0x2a18b7(0xc8)])===null||_0xb60d2d===void 0x0?void 0x0:_0xb60d2d[_0x2a18b7(0x7f)])===null||_0x33d98a===void 0x0?void 0x0:_0x33d98a[_0x2a18b7(0x89)])||((_0x167709=_0x3779a3===null||_0x3779a3===void 0x0?void 0x0:_0x3779a3[_0x2a18b7(0xc8)])===null||_0x167709===void 0x0?void 0x0:_0x167709[_0x2a18b7(0x7f)])||_0x3779a3[_0x2a18b7(0x84)];this['logger'][_0x2a18b7(0x89)](_0x2a18b7(0x9c),_0x1871a1),this['authState']=auth_state_enum_1[_0x2a18b7(0x9b)]['Error'];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x2a18b7(0xb8)]);}}async[a126_0x5952e9(0xa7)](){const _0x35ef4e=a126_0x5952e9;this[_0x35ef4e(0xbd)][_0x35ef4e(0xc2)]('force\x20update\x20token');if(this[_0x35ef4e(0xa1)]===auth_state_enum_1[_0x35ef4e(0x9b)]['Updating']||this['authState']===auth_state_enum_1[_0x35ef4e(0x9b)]['Idle'])return await utils_1[_0x35ef4e(0xc4)](this[_0x35ef4e(0x9e)]),this['forceUpdateToken']();if(this[_0x35ef4e(0xa1)]===auth_state_enum_1[_0x35ef4e(0x9b)][_0x35ef4e(0xc6)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x35ef4e(0xb8)]);await this[_0x35ef4e(0xc7)]();}async['waitAuth'](){const _0x24c7d4=a126_0x5952e9;if(this[_0x24c7d4(0xa1)]===auth_state_enum_1[_0x24c7d4(0x9b)][_0x24c7d4(0xc6)]){this[_0x24c7d4(0xbd)]['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x24c7d4(0x8c))]();}if(this['authState']!==auth_state_enum_1[_0x24c7d4(0x9b)][_0x24c7d4(0xb7)])return this[_0x24c7d4(0xbd)][_0x24c7d4(0xc2)](_0x24c7d4(0x9a)),await utils_1[_0x24c7d4(0xc4)](this[_0x24c7d4(0x9e)]),this[_0x24c7d4(0x86)]();}['getAuthData'](){const _0x15e012=a126_0x5952e9;return{'orgId':this[_0x15e012(0x97)],'accessToken':this[_0x15e012(0xab)],'instanceUrl':this[_0x15e012(0xbb)]};}async[a126_0x5952e9(0x96)](){const _0x407203=a126_0x5952e9;return await this[_0x407203(0x86)](),{'baseURL':this[_0x407203(0xbb)],'headers':{'accept':_0x407203(0x99),'authorization':this[_0x407203(0x87)]+'\x20'+this[_0x407203(0xab)]}};}};function a126_0x3c07(){const _0x3aaa02=['tokenType','decorate','error','Idle','toString','UnauthorizedSalesforceError','axios','name','48bOwOOZ','getOwnPropertyDescriptor','function','design:paramtypes','SalesforceAuthService','update\x20access\x20token','/services/oauth2/token','requestConfig','orgId','services/data/','application/json','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','AuthState','update\x20access\x20token\x20failed:\x20%s','setAuthDetails','AUTH_WAIT_TIME','metadata','refresh_token','authState','default','703759DlFMpV','check\x20auth:\x20current\x20state\x20-\x20%s','Updating','__esModule','forceUpdateToken','../../shared/services/salesforce-settings.service','length','SALESFORCE_API_VERSION','accessToken','catch','access_token','730908bmGArm','typedi','99003walTYt','__decorate','2384460QEzbhD','1815129OZLQKb','1003600bVbPlg','(((.+)+)+)+$','8pssIHn','Active','ERR_INVALID_SALESFORCE_TOKEN','settings','../errors/unauthorized-salesforce.error','instanceUrl','search','logger','joinURL','12MhfCSF','post','../errors/invalid-refresh-token.error','log','17848VICvGK','sleep','token_type','Error','updateAccessToken','response','then','../../../core','../../../constants','data','constructor','defineProperty','loginUrl','../../shared/utils','message','salesforseSettings','waitAuth'];a126_0x3c07=function(){return _0x3aaa02;};return a126_0x3c07();}SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1['Service'](),__metadata(a126_0x5952e9(0x92),[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a126_0x5952e9(0x93)]=SalesforceAuthService;