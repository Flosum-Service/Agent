const a126_0x38f6c=a126_0x513d;(function(_0x519b4f,_0xfa9d1e){const _0x26ab04=a126_0x513d,_0x21e6a2=_0x519b4f();while(!![]){try{const _0x4aa927=-parseInt(_0x26ab04(0xba))/0x1*(parseInt(_0x26ab04(0x98))/0x2)+parseInt(_0x26ab04(0xbc))/0x3+parseInt(_0x26ab04(0xc2))/0x4+-parseInt(_0x26ab04(0xb2))/0x5+parseInt(_0x26ab04(0xc3))/0x6*(parseInt(_0x26ab04(0x90))/0x7)+-parseInt(_0x26ab04(0xb5))/0x8*(-parseInt(_0x26ab04(0x7e))/0x9)+-parseInt(_0x26ab04(0x8d))/0xa;if(_0x4aa927===_0xfa9d1e)break;else _0x21e6a2['push'](_0x21e6a2['shift']());}catch(_0x40ed6a){_0x21e6a2['push'](_0x21e6a2['shift']());}}}(a126_0x74c5,0x83b29));const a126_0x5ee769=(function(){let _0x31d422=!![];return function(_0x368d19,_0x5ab856){const _0xb44bfd=_0x31d422?function(){const _0x1b2609=a126_0x513d;if(_0x5ab856){const _0x2ff832=_0x5ab856[_0x1b2609(0x97)](_0x368d19,arguments);return _0x5ab856=null,_0x2ff832;}}:function(){};return _0x31d422=![],_0xb44bfd;};}()),a126_0x23e663=a126_0x5ee769(this,function(){const _0x506a11=a126_0x513d;return a126_0x23e663[_0x506a11(0x81)]()['search']('(((.+)+)+)+$')['toString']()[_0x506a11(0xa8)](a126_0x23e663)[_0x506a11(0xbd)](_0x506a11(0xc4));});function a126_0x74c5(){const _0x4a3a75=['1471898iGzBDr','Idle','forceUpdateToken','joinURL','defineProperty','settings','error','__importDefault','../../shared/utils','../../shared/services/salesforce-settings.service','axios','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','response','default','authState','accessToken','constructor','AUTH_WAIT_TIME','refresh_token','decorate','ERR_INVALID_SALESFORCE_TOKEN','Logger','function','access\x20token\x20updated\x20for\x20%s','__decorate','../errors/unauthorized-salesforce.error','1860880fwbSly','tokenType','salesforseSettings','8mWBHhl','data','create\x20authorized\x20request\x20failed:\x20authorization\x20error','instance_url','AuthState','1sPFKug','loginUrl','638250ywjsfQ','search','log','UnauthorizedSalesforceError','Service','force\x20update\x20token','3340228Ododgo','1393842NfNhaw','(((.+)+)+)+$','update\x20access\x20token\x20failed:\x20%s','setAuthDetails','access_token','metadata','instanceUrl','getOwnPropertyDescriptor','updateAccessToken','InvalidRefreshTokenError','7429707XIFfjp','sleep','Error','toString','waitAuth','__metadata','logger','application/json','then','length','services/data/','typedi','message','check\x20auth:\x20current\x20state\x20-\x20%s','/services/oauth2/token','6903860mDqMUn','../../../constants/errors','catch','14iFfPSA','requestConfig','../enums/auth-state.enum','object','design:paramtypes','__esModule','SalesforceAuthService','apply'];a126_0x74c5=function(){return _0x4a3a75;};return a126_0x74c5();}a126_0x23e663();'use strict';var __decorate=this&&this[a126_0x38f6c(0xb0)]||function(_0x4bf0ae,_0x5d294f,_0x4e0bc4,_0x53af26){const _0x2409c4=a126_0x38f6c;var _0x23481c=arguments[_0x2409c4(0x87)],_0x27d128=_0x23481c<0x3?_0x5d294f:_0x53af26===null?_0x53af26=Object[_0x2409c4(0x7b)](_0x5d294f,_0x4e0bc4):_0x53af26,_0x17111d;if(typeof Reflect===_0x2409c4(0x93)&&typeof Reflect['decorate']===_0x2409c4(0xae))_0x27d128=Reflect[_0x2409c4(0xab)](_0x4bf0ae,_0x5d294f,_0x4e0bc4,_0x53af26);else{for(var _0x518115=_0x4bf0ae[_0x2409c4(0x87)]-0x1;_0x518115>=0x0;_0x518115--)if(_0x17111d=_0x4bf0ae[_0x518115])_0x27d128=(_0x23481c<0x3?_0x17111d(_0x27d128):_0x23481c>0x3?_0x17111d(_0x5d294f,_0x4e0bc4,_0x27d128):_0x17111d(_0x5d294f,_0x4e0bc4))||_0x27d128;}return _0x23481c>0x3&&_0x27d128&&Object[_0x2409c4(0x9c)](_0x5d294f,_0x4e0bc4,_0x27d128),_0x27d128;},__metadata=this&&this[a126_0x38f6c(0x83)]||function(_0x532169,_0x58b12c){const _0x4a5fa5=a126_0x38f6c;if(typeof Reflect===_0x4a5fa5(0x93)&&typeof Reflect[_0x4a5fa5(0xc8)]===_0x4a5fa5(0xae))return Reflect['metadata'](_0x532169,_0x58b12c);},__importDefault=this&&this[a126_0x38f6c(0x9f)]||function(_0x5178e5){const _0x560e9c=a126_0x38f6c;return _0x5178e5&&_0x5178e5[_0x560e9c(0x95)]?_0x5178e5:{'default':_0x5178e5};},SalesforceAuthService_1;function a126_0x513d(_0x28f9bf,_0x1e4db1){const _0xe0154b=a126_0x74c5();return a126_0x513d=function(_0x23e663,_0x5ee769){_0x23e663=_0x23e663-0x7a;let _0x74c587=_0xe0154b[_0x23e663];return _0x74c587;},a126_0x513d(_0x28f9bf,_0x1e4db1);}Object['defineProperty'](exports,a126_0x38f6c(0x95),{'value':!![]}),exports[a126_0x38f6c(0x96)]=void 0x0;const typedi_1=require(a126_0x38f6c(0x89)),errors_1=require(a126_0x38f6c(0x8e)),core_1=require('../../../core'),salesforce_settings_service_1=require(a126_0x38f6c(0xa1)),axios_1=__importDefault(require(a126_0x38f6c(0xa2))),utils_1=require(a126_0x38f6c(0xa0)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a126_0x38f6c(0x92)),unauthorized_salesforce_error_1=require(a126_0x38f6c(0xb1)),constants_1=require('../../../constants');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x5665d0){const _0x13c97e=a126_0x38f6c;this[_0x13c97e(0xb4)]=_0x5665d0,this[_0x13c97e(0xa9)]=0x1388,this[_0x13c97e(0xa6)]=auth_state_enum_1[_0x13c97e(0xb9)][_0x13c97e(0x99)],this[_0x13c97e(0x84)]=new core_1[(_0x13c97e(0xad))](SalesforceAuthService_1['name']),this[_0x13c97e(0xc6)]();}get[a126_0x38f6c(0x9d)](){const _0x10c680=a126_0x38f6c;return this[_0x10c680(0xb4)][_0x10c680(0x9d)];}async[a126_0x38f6c(0xc6)](){const _0x5f9697=a126_0x38f6c;this[_0x5f9697(0x84)][_0x5f9697(0xbe)](_0x5f9697(0x8b),auth_state_enum_1[_0x5f9697(0xb9)][this[_0x5f9697(0xa6)]]);try{if(this[_0x5f9697(0xa6)]===auth_state_enum_1[_0x5f9697(0xb9)]['Error'])return;if(this[_0x5f9697(0xa6)]===auth_state_enum_1['AuthState']['Idle'])await this[_0x5f9697(0x7c)]();else{const _0x8da18c=await this[_0x5f9697(0x91)](),_0x5e69c4=await axios_1['default']['get'](_0x5f9697(0x88)+constants_1['SALESFORCE_API_VERSION'],_0x8da18c)[_0x5f9697(0x86)](()=>!![])[_0x5f9697(0x8f)](()=>![]);!_0x5e69c4&&await this[_0x5f9697(0x7c)]();}}catch(_0x4ed831){}}async[a126_0x38f6c(0x7c)](){const _0x1fb0e8=a126_0x38f6c;var _0x4b1e7e,_0x2f3795,_0x150f6c;this[_0x1fb0e8(0x84)][_0x1fb0e8(0xbe)]('update\x20access\x20token');try{this[_0x1fb0e8(0xa6)]=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x4be033,clientId:_0x3223bb,clientSecret:_0x59f28c}=this['settings'],{data:_0x1a9e3c}=await axios_1[_0x1fb0e8(0xa5)]['post'](utils_1[_0x1fb0e8(0x9b)](this['salesforseSettings'][_0x1fb0e8(0xbb)],_0x1fb0e8(0x8c)),null,{'params':{'grant_type':_0x1fb0e8(0xaa),'refresh_token':_0x4be033,'client_id':_0x3223bb,'client_secret':_0x59f28c}});this[_0x1fb0e8(0x7a)]=_0x1a9e3c[_0x1fb0e8(0xb8)],this['accessToken']=_0x1a9e3c[_0x1fb0e8(0xc7)],this[_0x1fb0e8(0xb3)]=_0x1a9e3c['token_type'],this[_0x1fb0e8(0xa6)]=auth_state_enum_1['AuthState']['Active'],this[_0x1fb0e8(0x84)][_0x1fb0e8(0xbe)](_0x1fb0e8(0xaf),this[_0x1fb0e8(0x7a)]);}catch(_0x27daf2){const _0x967c8c=((_0x2f3795=(_0x4b1e7e=_0x27daf2===null||_0x27daf2===void 0x0?void 0x0:_0x27daf2[_0x1fb0e8(0xa4)])===null||_0x4b1e7e===void 0x0?void 0x0:_0x4b1e7e[_0x1fb0e8(0xb6)])===null||_0x2f3795===void 0x0?void 0x0:_0x2f3795[_0x1fb0e8(0x9e)])||((_0x150f6c=_0x27daf2===null||_0x27daf2===void 0x0?void 0x0:_0x27daf2[_0x1fb0e8(0xa4)])===null||_0x150f6c===void 0x0?void 0x0:_0x150f6c[_0x1fb0e8(0xb6)])||_0x27daf2[_0x1fb0e8(0x8a)];this[_0x1fb0e8(0x84)][_0x1fb0e8(0x9e)](_0x1fb0e8(0xc5),_0x967c8c),this['authState']=auth_state_enum_1[_0x1fb0e8(0xb9)][_0x1fb0e8(0x80)];throw new invalid_refresh_token_error_1[(_0x1fb0e8(0x7d))](errors_1[_0x1fb0e8(0xac)]);}}async[a126_0x38f6c(0x9a)](){const _0x2d436b=a126_0x38f6c;this[_0x2d436b(0x84)][_0x2d436b(0xbe)](_0x2d436b(0xc1));if(this['authState']===auth_state_enum_1['AuthState']['Updating']||this[_0x2d436b(0xa6)]===auth_state_enum_1[_0x2d436b(0xb9)][_0x2d436b(0x99)])return await utils_1[_0x2d436b(0x7f)](this[_0x2d436b(0xa9)]),this[_0x2d436b(0x9a)]();if(this['authState']===auth_state_enum_1['AuthState'][_0x2d436b(0x80)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x2d436b(0xac)]);await this[_0x2d436b(0x7c)]();}async['waitAuth'](){const _0x4dda83=a126_0x38f6c;if(this[_0x4dda83(0xa6)]===auth_state_enum_1[_0x4dda83(0xb9)][_0x4dda83(0x80)]){this['logger'][_0x4dda83(0xbe)](_0x4dda83(0xb7));throw new unauthorized_salesforce_error_1[(_0x4dda83(0xbf))]();}if(this[_0x4dda83(0xa6)]!==auth_state_enum_1[_0x4dda83(0xb9)]['Active'])return this['logger'][_0x4dda83(0xbe)](_0x4dda83(0xa3)),await utils_1[_0x4dda83(0x7f)](this[_0x4dda83(0xa9)]),this['waitAuth']();}['getAuthData'](){const _0x12d15a=a126_0x38f6c;return{'orgId':this['orgId'],'accessToken':this[_0x12d15a(0xa7)],'instanceUrl':this['instanceUrl']};}async[a126_0x38f6c(0x91)](){const _0x38c0f3=a126_0x38f6c;return await this[_0x38c0f3(0x82)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x38c0f3(0x85),'authorization':this[_0x38c0f3(0xb3)]+'\x20'+this[_0x38c0f3(0xa7)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x38f6c(0xc0)](),__metadata(a126_0x38f6c(0x94),[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a126_0x38f6c(0x96)]=SalesforceAuthService;