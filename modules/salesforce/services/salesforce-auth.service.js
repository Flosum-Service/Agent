const a126_0x3b2fc5=a126_0x2d7a;(function(_0x5df8b5,_0x19208b){const _0x474250=a126_0x2d7a,_0x527ed3=_0x5df8b5();while(!![]){try{const _0x2e7066=parseInt(_0x474250(0x182))/0x1+parseInt(_0x474250(0x19d))/0x2+-parseInt(_0x474250(0x175))/0x3+parseInt(_0x474250(0x192))/0x4+-parseInt(_0x474250(0x185))/0x5+-parseInt(_0x474250(0x1a3))/0x6+parseInt(_0x474250(0x1a1))/0x7*(parseInt(_0x474250(0x16b))/0x8);if(_0x2e7066===_0x19208b)break;else _0x527ed3['push'](_0x527ed3['shift']());}catch(_0x49333b){_0x527ed3['push'](_0x527ed3['shift']());}}}(a126_0x161c,0x7a051));const a126_0x42fb4d=(function(){let _0x462b97=!![];return function(_0x356258,_0x2bce65){const _0x3cdec2=_0x462b97?function(){if(_0x2bce65){const _0x2d6e1d=_0x2bce65['apply'](_0x356258,arguments);return _0x2bce65=null,_0x2d6e1d;}}:function(){};return _0x462b97=![],_0x3cdec2;};}()),a126_0x2b2479=a126_0x42fb4d(this,function(){const _0x239c38=a126_0x2d7a;return a126_0x2b2479[_0x239c38(0x176)]()[_0x239c38(0x1a8)](_0x239c38(0x16c))['toString']()['constructor'](a126_0x2b2479)[_0x239c38(0x1a8)](_0x239c38(0x16c));});a126_0x2b2479();'use strict';var __decorate=this&&this[a126_0x3b2fc5(0x177)]||function(_0x148ca7,_0x918fa5,_0x22203d,_0x3d3df5){const _0x705809=a126_0x3b2fc5;var _0x443eb8=arguments[_0x705809(0x1aa)],_0xd16b35=_0x443eb8<0x3?_0x918fa5:_0x3d3df5===null?_0x3d3df5=Object[_0x705809(0x19f)](_0x918fa5,_0x22203d):_0x3d3df5,_0x27d564;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x705809(0x187))_0xd16b35=Reflect['decorate'](_0x148ca7,_0x918fa5,_0x22203d,_0x3d3df5);else{for(var _0x188013=_0x148ca7[_0x705809(0x1aa)]-0x1;_0x188013>=0x0;_0x188013--)if(_0x27d564=_0x148ca7[_0x188013])_0xd16b35=(_0x443eb8<0x3?_0x27d564(_0xd16b35):_0x443eb8>0x3?_0x27d564(_0x918fa5,_0x22203d,_0xd16b35):_0x27d564(_0x918fa5,_0x22203d))||_0xd16b35;}return _0x443eb8>0x3&&_0xd16b35&&Object[_0x705809(0x19c)](_0x918fa5,_0x22203d,_0xd16b35),_0xd16b35;},__metadata=this&&this[a126_0x3b2fc5(0x179)]||function(_0x4a7801,_0x2845de){const _0x25bfd0=a126_0x3b2fc5;if(typeof Reflect===_0x25bfd0(0x1af)&&typeof Reflect['metadata']===_0x25bfd0(0x187))return Reflect[_0x25bfd0(0x196)](_0x4a7801,_0x2845de);},__importDefault=this&&this[a126_0x3b2fc5(0x16f)]||function(_0x1d5c67){const _0x5eaeaf=a126_0x3b2fc5;return _0x1d5c67&&_0x1d5c67[_0x5eaeaf(0x1a6)]?_0x1d5c67:{'default':_0x1d5c67};},SalesforceAuthService_1;Object['defineProperty'](exports,a126_0x3b2fc5(0x1a6),{'value':!![]}),exports[a126_0x3b2fc5(0x183)]=void 0x0;function a126_0x161c(){const _0x14c5fa=['../../shared/services/salesforce-settings.service','axios','instanceUrl','post','104iWWoUJ','(((.+)+)+)+$','salesforseSettings','Error','__importDefault','../errors/unauthorized-salesforce.error','update\x20access\x20token\x20failed:\x20%s','../../../core','token_type','then','2907132xIgQGh','toString','__decorate','waitAuth','__metadata','../../../constants','response','tokenType','SALESFORCE_API_VERSION','Active','ERR_INVALID_SALESFORCE_TOKEN','instance_url','../../shared/utils','729931jevvyp','SalesforceAuthService','create\x20authorized\x20request\x20failed:\x20authorization\x20error','1881575gXXmGm','InvalidRefreshTokenError','function','updateAccessToken','authState','../enums/auth-state.enum','typedi','requestConfig','data','Updating','access_token','default','AuthState','66344hntThK','UnauthorizedSalesforceError','/services/oauth2/token','refresh_token','metadata','logger','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','Idle','catch','check\x20auth:\x20current\x20state\x20-\x20%s','defineProperty','134038qmdTyn','settings','getOwnPropertyDescriptor','SalesforceSettingsService','949053eYTMLw','getAuthData','4385466ZtWTCB','Service','message','__esModule','accessToken','search','design:paramtypes','length','../errors/invalid-refresh-token.error','AUTH_WAIT_TIME','sleep','error','object','orgId','log','access\x20token\x20updated\x20for\x20%s','forceUpdateToken'];a126_0x161c=function(){return _0x14c5fa;};return a126_0x161c();}const typedi_1=require(a126_0x3b2fc5(0x18b)),errors_1=require('../../../constants/errors'),core_1=require(a126_0x3b2fc5(0x172)),salesforce_settings_service_1=require(a126_0x3b2fc5(0x1b4)),axios_1=__importDefault(require(a126_0x3b2fc5(0x1b5))),utils_1=require(a126_0x3b2fc5(0x181)),invalid_refresh_token_error_1=require(a126_0x3b2fc5(0x1ab)),auth_state_enum_1=require(a126_0x3b2fc5(0x18a)),unauthorized_salesforce_error_1=require(a126_0x3b2fc5(0x170)),constants_1=require(a126_0x3b2fc5(0x17a));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x14979f){const _0x5e52b6=a126_0x3b2fc5;this[_0x5e52b6(0x16d)]=_0x14979f,this[_0x5e52b6(0x1ac)]=0x1388,this[_0x5e52b6(0x189)]=auth_state_enum_1[_0x5e52b6(0x191)][_0x5e52b6(0x199)],this['logger']=new core_1['Logger'](SalesforceAuthService_1['name']),this['setAuthDetails']();}get[a126_0x3b2fc5(0x19e)](){const _0x29e210=a126_0x3b2fc5;return this[_0x29e210(0x16d)]['settings'];}async['setAuthDetails'](){const _0x229c55=a126_0x3b2fc5;this[_0x229c55(0x197)]['log'](_0x229c55(0x19b),auth_state_enum_1[_0x229c55(0x191)][this[_0x229c55(0x189)]]);try{if(this[_0x229c55(0x189)]===auth_state_enum_1[_0x229c55(0x191)]['Error'])return;if(this[_0x229c55(0x189)]===auth_state_enum_1[_0x229c55(0x191)]['Idle'])await this[_0x229c55(0x188)]();else{const _0x15d001=await this[_0x229c55(0x18c)](),_0x766c4b=await axios_1['default']['get']('services/data/'+constants_1[_0x229c55(0x17d)],_0x15d001)[_0x229c55(0x174)](()=>!![])[_0x229c55(0x19a)](()=>![]);!_0x766c4b&&await this[_0x229c55(0x188)]();}}catch(_0x10e58c){}}async['updateAccessToken'](){const _0x5c9b34=a126_0x3b2fc5;var _0x577f93,_0x52e568,_0x481f9a;this[_0x5c9b34(0x197)][_0x5c9b34(0x1b1)]('update\x20access\x20token');try{this[_0x5c9b34(0x189)]=auth_state_enum_1[_0x5c9b34(0x191)][_0x5c9b34(0x18e)];const {refreshToken:_0x501fcf,clientId:_0x3dfeeb,clientSecret:_0x542c0d}=this['settings'],{data:_0x2d323d}=await axios_1[_0x5c9b34(0x190)][_0x5c9b34(0x1b7)](utils_1['joinURL'](this[_0x5c9b34(0x16d)]['loginUrl'],_0x5c9b34(0x194)),null,{'params':{'grant_type':_0x5c9b34(0x195),'refresh_token':_0x501fcf,'client_id':_0x3dfeeb,'client_secret':_0x542c0d}});this[_0x5c9b34(0x1b6)]=_0x2d323d[_0x5c9b34(0x180)],this[_0x5c9b34(0x1a7)]=_0x2d323d[_0x5c9b34(0x18f)],this[_0x5c9b34(0x17c)]=_0x2d323d[_0x5c9b34(0x173)],this['authState']=auth_state_enum_1['AuthState']['Active'],this['logger'][_0x5c9b34(0x1b1)](_0x5c9b34(0x1b2),this[_0x5c9b34(0x1b6)]);}catch(_0x44d52a){const _0x5cf3e6=((_0x52e568=(_0x577f93=_0x44d52a===null||_0x44d52a===void 0x0?void 0x0:_0x44d52a[_0x5c9b34(0x17b)])===null||_0x577f93===void 0x0?void 0x0:_0x577f93[_0x5c9b34(0x18d)])===null||_0x52e568===void 0x0?void 0x0:_0x52e568[_0x5c9b34(0x1ae)])||((_0x481f9a=_0x44d52a===null||_0x44d52a===void 0x0?void 0x0:_0x44d52a[_0x5c9b34(0x17b)])===null||_0x481f9a===void 0x0?void 0x0:_0x481f9a[_0x5c9b34(0x18d)])||_0x44d52a[_0x5c9b34(0x1a5)];this[_0x5c9b34(0x197)][_0x5c9b34(0x1ae)](_0x5c9b34(0x171),_0x5cf3e6),this[_0x5c9b34(0x189)]=auth_state_enum_1[_0x5c9b34(0x191)][_0x5c9b34(0x16e)];throw new invalid_refresh_token_error_1[(_0x5c9b34(0x186))](errors_1[_0x5c9b34(0x17f)]);}}async[a126_0x3b2fc5(0x1b3)](){const _0xe3499b=a126_0x3b2fc5;this['logger'][_0xe3499b(0x1b1)]('force\x20update\x20token');if(this['authState']===auth_state_enum_1[_0xe3499b(0x191)][_0xe3499b(0x18e)]||this[_0xe3499b(0x189)]===auth_state_enum_1[_0xe3499b(0x191)][_0xe3499b(0x199)])return await utils_1[_0xe3499b(0x1ad)](this['AUTH_WAIT_TIME']),this[_0xe3499b(0x1b3)]();if(this[_0xe3499b(0x189)]===auth_state_enum_1['AuthState'][_0xe3499b(0x16e)])throw new invalid_refresh_token_error_1[(_0xe3499b(0x186))](errors_1[_0xe3499b(0x17f)]);await this[_0xe3499b(0x188)]();}async[a126_0x3b2fc5(0x178)](){const _0x21b5d6=a126_0x3b2fc5;if(this[_0x21b5d6(0x189)]===auth_state_enum_1[_0x21b5d6(0x191)][_0x21b5d6(0x16e)]){this[_0x21b5d6(0x197)][_0x21b5d6(0x1b1)](_0x21b5d6(0x184));throw new unauthorized_salesforce_error_1[(_0x21b5d6(0x193))]();}if(this[_0x21b5d6(0x189)]!==auth_state_enum_1[_0x21b5d6(0x191)][_0x21b5d6(0x17e)])return this[_0x21b5d6(0x197)][_0x21b5d6(0x1b1)](_0x21b5d6(0x198)),await utils_1[_0x21b5d6(0x1ad)](this[_0x21b5d6(0x1ac)]),this[_0x21b5d6(0x178)]();}[a126_0x3b2fc5(0x1a2)](){const _0x860bb3=a126_0x3b2fc5;return{'orgId':this[_0x860bb3(0x1b0)],'accessToken':this[_0x860bb3(0x1a7)],'instanceUrl':this[_0x860bb3(0x1b6)]};}async[a126_0x3b2fc5(0x18c)](){const _0x256c50=a126_0x3b2fc5;return await this[_0x256c50(0x178)](),{'baseURL':this['instanceUrl'],'headers':{'accept':'application/json','authorization':this[_0x256c50(0x17c)]+'\x20'+this[_0x256c50(0x1a7)]}};}};function a126_0x2d7a(_0x18977b,_0x2974b6){const _0x25f1ae=a126_0x161c();return a126_0x2d7a=function(_0x2b2479,_0x42fb4d){_0x2b2479=_0x2b2479-0x16b;let _0x161c5a=_0x25f1ae[_0x2b2479];return _0x161c5a;},a126_0x2d7a(_0x18977b,_0x2974b6);}SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x3b2fc5(0x1a4)](),__metadata(a126_0x3b2fc5(0x1a9),[salesforce_settings_service_1[a126_0x3b2fc5(0x1a0)]])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;