const a126_0x1698d0=a126_0x383f;(function(_0x57fd07,_0x484119){const _0xc73a1e=a126_0x383f,_0xa97c30=_0x57fd07();while(!![]){try{const _0x4baf3b=parseInt(_0xc73a1e(0xd3))/0x1*(-parseInt(_0xc73a1e(0xe2))/0x2)+-parseInt(_0xc73a1e(0xda))/0x3+-parseInt(_0xc73a1e(0xb2))/0x4+parseInt(_0xc73a1e(0xf0))/0x5+parseInt(_0xc73a1e(0xd6))/0x6+parseInt(_0xc73a1e(0xc6))/0x7*(parseInt(_0xc73a1e(0xf2))/0x8)+-parseInt(_0xc73a1e(0xc8))/0x9*(-parseInt(_0xc73a1e(0xef))/0xa);if(_0x4baf3b===_0x484119)break;else _0xa97c30['push'](_0xa97c30['shift']());}catch(_0x127c41){_0xa97c30['push'](_0xa97c30['shift']());}}}(a126_0x11d4,0x855f7));const a126_0x460497=(function(){let _0x4a33ad=!![];return function(_0xda6671,_0x219691){const _0x1789a9=_0x4a33ad?function(){const _0x80a00e=a126_0x383f;if(_0x219691){const _0x22728f=_0x219691[_0x80a00e(0xd4)](_0xda6671,arguments);return _0x219691=null,_0x22728f;}}:function(){};return _0x4a33ad=![],_0x1789a9;};}()),a126_0x4f1b72=a126_0x460497(this,function(){const _0x1f6422=a126_0x383f;return a126_0x4f1b72['toString']()['search'](_0x1f6422(0xdf))[_0x1f6422(0xc3)]()['constructor'](a126_0x4f1b72)[_0x1f6422(0xc7)](_0x1f6422(0xdf));});function a126_0x383f(_0x31c7b9,_0x248004){const _0x4031e9=a126_0x11d4();return a126_0x383f=function(_0x4f1b72,_0x460497){_0x4f1b72=_0x4f1b72-0xaa;let _0x11d401=_0x4031e9[_0x4f1b72];return _0x11d401;},a126_0x383f(_0x31c7b9,_0x248004);}function a126_0x11d4(){const _0x5672bc=['name','default','../../../constants','../../shared/services/salesforce-settings.service','722096JCUcza','__esModule','access\x20token\x20updated\x20for\x20%s','metadata','loginUrl','../../shared/utils','SALESFORCE_API_VERSION','waitAuth','updateAccessToken','token_type','Idle','SalesforceAuthService','getAuthData','authState','InvalidRefreshTokenError','create\x20authorized\x20request\x20failed:\x20authorization\x20error','response','toString','../errors/unauthorized-salesforce.error','../errors/invalid-refresh-token.error','2362178FFDKHq','search','27aNnPvp','requestConfig','joinURL','SalesforceSettingsService','length','data','/services/oauth2/token','services/data/','orgId','__metadata','sleep','1oavLeS','apply','../../../constants/errors','6011688UaOaBw','setAuthDetails','accessToken','object','2931444ufwWLE','post','error','access_token','logger','(((.+)+)+)+$','tokenType','../enums/auth-state.enum','1579602oDcily','salesforseSettings','function','defineProperty','AuthState','settings','instanceUrl','UnauthorizedSalesforceError','AUTH_WAIT_TIME','check\x20auth:\x20current\x20state\x20-\x20%s','__importDefault','decorate','Error','2986890SDQckM','1291495GyxuKz','application/json','8dyrLsT','ERR_INVALID_SALESFORCE_TOKEN','log','design:paramtypes','message','Active','instance_url','catch','Service','__decorate','getOwnPropertyDescriptor'];a126_0x11d4=function(){return _0x5672bc;};return a126_0x11d4();}a126_0x4f1b72();'use strict';var __decorate=this&&this[a126_0x1698d0(0xac)]||function(_0x3e8389,_0x394ce2,_0xdb5a0e,_0x242576){const _0x56a8bc=a126_0x1698d0;var _0x14d2e2=arguments[_0x56a8bc(0xcc)],_0x52fd7d=_0x14d2e2<0x3?_0x394ce2:_0x242576===null?_0x242576=Object[_0x56a8bc(0xad)](_0x394ce2,_0xdb5a0e):_0x242576,_0x361824;if(typeof Reflect===_0x56a8bc(0xd9)&&typeof Reflect[_0x56a8bc(0xed)]===_0x56a8bc(0xe4))_0x52fd7d=Reflect['decorate'](_0x3e8389,_0x394ce2,_0xdb5a0e,_0x242576);else{for(var _0x421653=_0x3e8389[_0x56a8bc(0xcc)]-0x1;_0x421653>=0x0;_0x421653--)if(_0x361824=_0x3e8389[_0x421653])_0x52fd7d=(_0x14d2e2<0x3?_0x361824(_0x52fd7d):_0x14d2e2>0x3?_0x361824(_0x394ce2,_0xdb5a0e,_0x52fd7d):_0x361824(_0x394ce2,_0xdb5a0e))||_0x52fd7d;}return _0x14d2e2>0x3&&_0x52fd7d&&Object[_0x56a8bc(0xe5)](_0x394ce2,_0xdb5a0e,_0x52fd7d),_0x52fd7d;},__metadata=this&&this[a126_0x1698d0(0xd1)]||function(_0x214ed9,_0x4422de){const _0x45a772=a126_0x1698d0;if(typeof Reflect===_0x45a772(0xd9)&&typeof Reflect[_0x45a772(0xb5)]===_0x45a772(0xe4))return Reflect[_0x45a772(0xb5)](_0x214ed9,_0x4422de);},__importDefault=this&&this[a126_0x1698d0(0xec)]||function(_0x24eadf){const _0x18572c=a126_0x1698d0;return _0x24eadf&&_0x24eadf[_0x18572c(0xb3)]?_0x24eadf:{'default':_0x24eadf};},SalesforceAuthService_1;Object[a126_0x1698d0(0xe5)](exports,a126_0x1698d0(0xb3),{'value':!![]}),exports[a126_0x1698d0(0xbd)]=void 0x0;const typedi_1=require('typedi'),errors_1=require(a126_0x1698d0(0xd5)),core_1=require('../../../core'),salesforce_settings_service_1=require(a126_0x1698d0(0xb1)),axios_1=__importDefault(require('axios')),utils_1=require(a126_0x1698d0(0xb7)),invalid_refresh_token_error_1=require(a126_0x1698d0(0xc5)),auth_state_enum_1=require(a126_0x1698d0(0xe1)),unauthorized_salesforce_error_1=require(a126_0x1698d0(0xc4)),constants_1=require(a126_0x1698d0(0xb0));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x4a5b4e){const _0x50ee2c=a126_0x1698d0;this['salesforseSettings']=_0x4a5b4e,this[_0x50ee2c(0xea)]=0x1388,this[_0x50ee2c(0xbf)]=auth_state_enum_1[_0x50ee2c(0xe6)][_0x50ee2c(0xbc)],this[_0x50ee2c(0xde)]=new core_1['Logger'](SalesforceAuthService_1[_0x50ee2c(0xae)]),this[_0x50ee2c(0xd7)]();}get[a126_0x1698d0(0xe7)](){const _0x51703b=a126_0x1698d0;return this[_0x51703b(0xe3)]['settings'];}async['setAuthDetails'](){const _0x47c81d=a126_0x1698d0;this[_0x47c81d(0xde)][_0x47c81d(0xf4)](_0x47c81d(0xeb),auth_state_enum_1[_0x47c81d(0xe6)][this[_0x47c81d(0xbf)]]);try{if(this[_0x47c81d(0xbf)]===auth_state_enum_1[_0x47c81d(0xe6)]['Error'])return;if(this['authState']===auth_state_enum_1[_0x47c81d(0xe6)][_0x47c81d(0xbc)])await this[_0x47c81d(0xba)]();else{const _0x4652b5=await this[_0x47c81d(0xc9)](),_0x4283bf=await axios_1['default']['get'](_0x47c81d(0xcf)+constants_1[_0x47c81d(0xb8)],_0x4652b5)['then'](()=>!![])[_0x47c81d(0xaa)](()=>![]);!_0x4283bf&&await this[_0x47c81d(0xba)]();}}catch(_0x9ba7a1){}}async[a126_0x1698d0(0xba)](){const _0xc1eb42=a126_0x1698d0;var _0x24cefb,_0xb4c99,_0x206ffa;this['logger'][_0xc1eb42(0xf4)]('update\x20access\x20token');try{this[_0xc1eb42(0xbf)]=auth_state_enum_1[_0xc1eb42(0xe6)]['Updating'];const {refreshToken:_0x3c2391,clientId:_0x418337,clientSecret:_0x1af0f4}=this[_0xc1eb42(0xe7)],{data:_0x47af94}=await axios_1[_0xc1eb42(0xaf)][_0xc1eb42(0xdb)](utils_1[_0xc1eb42(0xca)](this[_0xc1eb42(0xe3)][_0xc1eb42(0xb6)],_0xc1eb42(0xce)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x3c2391,'client_id':_0x418337,'client_secret':_0x1af0f4}});this[_0xc1eb42(0xe8)]=_0x47af94[_0xc1eb42(0xf8)],this[_0xc1eb42(0xd8)]=_0x47af94[_0xc1eb42(0xdd)],this[_0xc1eb42(0xe0)]=_0x47af94[_0xc1eb42(0xbb)],this[_0xc1eb42(0xbf)]=auth_state_enum_1['AuthState'][_0xc1eb42(0xf7)],this[_0xc1eb42(0xde)][_0xc1eb42(0xf4)](_0xc1eb42(0xb4),this[_0xc1eb42(0xe8)]);}catch(_0x1fa77c){const _0x4e147a=((_0xb4c99=(_0x24cefb=_0x1fa77c===null||_0x1fa77c===void 0x0?void 0x0:_0x1fa77c[_0xc1eb42(0xc2)])===null||_0x24cefb===void 0x0?void 0x0:_0x24cefb[_0xc1eb42(0xcd)])===null||_0xb4c99===void 0x0?void 0x0:_0xb4c99[_0xc1eb42(0xdc)])||((_0x206ffa=_0x1fa77c===null||_0x1fa77c===void 0x0?void 0x0:_0x1fa77c['response'])===null||_0x206ffa===void 0x0?void 0x0:_0x206ffa[_0xc1eb42(0xcd)])||_0x1fa77c[_0xc1eb42(0xf6)];this[_0xc1eb42(0xde)]['error']('update\x20access\x20token\x20failed:\x20%s',_0x4e147a),this['authState']=auth_state_enum_1[_0xc1eb42(0xe6)]['Error'];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0xc1eb42(0xf3)]);}}async['forceUpdateToken'](){const _0x13a018=a126_0x1698d0;this[_0x13a018(0xde)][_0x13a018(0xf4)]('force\x20update\x20token');if(this[_0x13a018(0xbf)]===auth_state_enum_1[_0x13a018(0xe6)]['Updating']||this[_0x13a018(0xbf)]===auth_state_enum_1['AuthState'][_0x13a018(0xbc)])return await utils_1[_0x13a018(0xd2)](this['AUTH_WAIT_TIME']),this['forceUpdateToken']();if(this['authState']===auth_state_enum_1[_0x13a018(0xe6)][_0x13a018(0xee)])throw new invalid_refresh_token_error_1[(_0x13a018(0xc0))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this['updateAccessToken']();}async[a126_0x1698d0(0xb9)](){const _0x1efef3=a126_0x1698d0;if(this[_0x1efef3(0xbf)]===auth_state_enum_1[_0x1efef3(0xe6)]['Error']){this['logger']['log'](_0x1efef3(0xc1));throw new unauthorized_salesforce_error_1[(_0x1efef3(0xe9))]();}if(this[_0x1efef3(0xbf)]!==auth_state_enum_1['AuthState'][_0x1efef3(0xf7)])return this[_0x1efef3(0xde)][_0x1efef3(0xf4)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x1efef3(0xd2)](this[_0x1efef3(0xea)]),this[_0x1efef3(0xb9)]();}[a126_0x1698d0(0xbe)](){const _0x192aaf=a126_0x1698d0;return{'orgId':this[_0x192aaf(0xd0)],'accessToken':this[_0x192aaf(0xd8)],'instanceUrl':this[_0x192aaf(0xe8)]};}async[a126_0x1698d0(0xc9)](){const _0x2605a3=a126_0x1698d0;return await this[_0x2605a3(0xb9)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x2605a3(0xf1),'authorization':this[_0x2605a3(0xe0)]+'\x20'+this[_0x2605a3(0xd8)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x1698d0(0xab)](),__metadata(a126_0x1698d0(0xf5),[salesforce_settings_service_1[a126_0x1698d0(0xcb)]])],SalesforceAuthService),exports[a126_0x1698d0(0xbd)]=SalesforceAuthService;