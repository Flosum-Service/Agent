const a125_0x2b4fd9=a125_0x16be;(function(_0x48ad65,_0x437401){const _0x2cb1f7=a125_0x16be,_0x524d60=_0x48ad65();while(!![]){try{const _0x2e2936=-parseInt(_0x2cb1f7(0x132))/0x1*(parseInt(_0x2cb1f7(0x136))/0x2)+-parseInt(_0x2cb1f7(0x120))/0x3*(-parseInt(_0x2cb1f7(0x14d))/0x4)+parseInt(_0x2cb1f7(0x127))/0x5+-parseInt(_0x2cb1f7(0x107))/0x6*(parseInt(_0x2cb1f7(0x116))/0x7)+parseInt(_0x2cb1f7(0x140))/0x8*(-parseInt(_0x2cb1f7(0x11e))/0x9)+-parseInt(_0x2cb1f7(0x10b))/0xa*(-parseInt(_0x2cb1f7(0x14c))/0xb)+parseInt(_0x2cb1f7(0x112))/0xc;if(_0x2e2936===_0x437401)break;else _0x524d60['push'](_0x524d60['shift']());}catch(_0x102088){_0x524d60['push'](_0x524d60['shift']());}}}(a125_0x54a7,0x7652b));const a125_0x51c0e7=(function(){let _0xaa1cc9=!![];return function(_0x27c966,_0x3129b7){const _0x55e80d=_0xaa1cc9?function(){const _0x2206ed=a125_0x16be;if(_0x3129b7){const _0x5b251c=_0x3129b7[_0x2206ed(0xff)](_0x27c966,arguments);return _0x3129b7=null,_0x5b251c;}}:function(){};return _0xaa1cc9=![],_0x55e80d;};}()),a125_0x15082e=a125_0x51c0e7(this,function(){const _0x44afdf=a125_0x16be;return a125_0x15082e[_0x44afdf(0x11b)]()[_0x44afdf(0x108)]('(((.+)+)+)+$')[_0x44afdf(0x11b)]()[_0x44afdf(0x113)](a125_0x15082e)['search']('(((.+)+)+)+$');});a125_0x15082e();'use strict';var __decorate=this&&this[a125_0x2b4fd9(0x114)]||function(_0x576b6e,_0x48eee5,_0x3df546,_0x41c4a0){const _0x516adc=a125_0x2b4fd9;var _0x51a5a7=arguments[_0x516adc(0x13e)],_0x440b66=_0x51a5a7<0x3?_0x48eee5:_0x41c4a0===null?_0x41c4a0=Object[_0x516adc(0x12d)](_0x48eee5,_0x3df546):_0x41c4a0,_0x3616c;if(typeof Reflect===_0x516adc(0x118)&&typeof Reflect['decorate']==='function')_0x440b66=Reflect['decorate'](_0x576b6e,_0x48eee5,_0x3df546,_0x41c4a0);else{for(var _0x1abeee=_0x576b6e[_0x516adc(0x13e)]-0x1;_0x1abeee>=0x0;_0x1abeee--)if(_0x3616c=_0x576b6e[_0x1abeee])_0x440b66=(_0x51a5a7<0x3?_0x3616c(_0x440b66):_0x51a5a7>0x3?_0x3616c(_0x48eee5,_0x3df546,_0x440b66):_0x3616c(_0x48eee5,_0x3df546))||_0x440b66;}return _0x51a5a7>0x3&&_0x440b66&&Object['defineProperty'](_0x48eee5,_0x3df546,_0x440b66),_0x440b66;},__metadata=this&&this['__metadata']||function(_0x44a3ae,_0x4e733c){const _0x479665=a125_0x2b4fd9;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x479665(0x106))return Reflect[_0x479665(0x144)](_0x44a3ae,_0x4e733c);},__importDefault=this&&this['__importDefault']||function(_0x3ab1aa){return _0x3ab1aa&&_0x3ab1aa['__esModule']?_0x3ab1aa:{'default':_0x3ab1aa};},SalesforceAuthService_1;Object['defineProperty'](exports,a125_0x2b4fd9(0x14e),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;function a125_0x16be(_0x22c2f4,_0x235f71){const _0x176155=a125_0x54a7();return a125_0x16be=function(_0x15082e,_0x51c0e7){_0x15082e=_0x15082e-0xfe;let _0x54a7f4=_0x176155[_0x15082e];return _0x54a7f4;},a125_0x16be(_0x22c2f4,_0x235f71);}const typedi_1=require(a125_0x2b4fd9(0x14b)),errors_1=require(a125_0x2b4fd9(0x146)),core_1=require(a125_0x2b4fd9(0x124)),salesforce_settings_service_1=require(a125_0x2b4fd9(0x123)),axios_1=__importDefault(require(a125_0x2b4fd9(0x12f))),utils_1=require(a125_0x2b4fd9(0x109)),invalid_refresh_token_error_1=require(a125_0x2b4fd9(0x111)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a125_0x2b4fd9(0x145));function a125_0x54a7(){const _0x2fccdd=['../../shared/services/salesforce-settings.service','../../../core','sleep','InvalidRefreshTokenError','4319410HMqAbL','SalesforceAuthService','UnauthorizedSalesforceError','ERR_INVALID_SALESFORCE_TOKEN','error','tokenType','getOwnPropertyDescriptor','log','axios','orgId','Updating','11595LkdveG','instanceUrl','get','SalesforceSettingsService','136fXiYEs','setAuthDetails','services/data/','response','refresh_token','message','accessToken','token_type','length','post','107440pOjPTU','instance_url','access\x20token\x20updated\x20for\x20%s','update\x20access\x20token\x20failed:\x20%s','metadata','../../../constants','../../../constants/errors','force\x20update\x20token','design:paramtypes','forceUpdateToken','salesforseSettings','typedi','3531fbKPKy','1284aMAqEE','__esModule','authState','apply','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','Idle','default','joinURL','create\x20authorized\x20request\x20failed:\x20authorization\x20error','catch','function','1384974PuUMBr','search','../../shared/utils','access_token','27110DGWuoN','then','updateAccessToken','Error','waitAuth','Service','../errors/invalid-refresh-token.error','13053540yWIAzm','constructor','__decorate','getAuthData','21fEcnYG','AUTH_WAIT_TIME','object','Active','loginUrl','toString','AuthState','logger','576HordIh','application/json','30nKAkkP','settings','update\x20access\x20token'];a125_0x54a7=function(){return _0x2fccdd;};return a125_0x54a7();}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0xc4b8d6){const _0x173561=a125_0x2b4fd9;this[_0x173561(0x14a)]=_0xc4b8d6,this[_0x173561(0x117)]=0x1388,this[_0x173561(0xfe)]=auth_state_enum_1[_0x173561(0x11c)][_0x173561(0x101)],this['logger']=new core_1['Logger'](SalesforceAuthService_1['name']),this[_0x173561(0x137)]();}get[a125_0x2b4fd9(0x121)](){const _0x4593c5=a125_0x2b4fd9;return this[_0x4593c5(0x14a)]['settings'];}async[a125_0x2b4fd9(0x137)](){const _0x3aa0e0=a125_0x2b4fd9;this['logger']['log']('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this['authState']]);try{if(this[_0x3aa0e0(0xfe)]===auth_state_enum_1[_0x3aa0e0(0x11c)][_0x3aa0e0(0x10e)])return;if(this[_0x3aa0e0(0xfe)]===auth_state_enum_1[_0x3aa0e0(0x11c)]['Idle'])await this[_0x3aa0e0(0x10d)]();else{const _0x9380b1=await this['requestConfig'](),_0x1bf4c=await axios_1[_0x3aa0e0(0x102)][_0x3aa0e0(0x134)](_0x3aa0e0(0x138)+constants_1['SALESFORCE_API_VERSION'],_0x9380b1)[_0x3aa0e0(0x10c)](()=>!![])[_0x3aa0e0(0x105)](()=>![]);!_0x1bf4c&&await this[_0x3aa0e0(0x10d)]();}}catch(_0x57c31f){}}async[a125_0x2b4fd9(0x10d)](){const _0x1a2dde=a125_0x2b4fd9;var _0x3fe99f,_0x2da4d4,_0x3b1add;this['logger']['log'](_0x1a2dde(0x122));try{this['authState']=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x1c25ad,clientId:_0x2ee39d,clientSecret:_0x5d5c79}=this[_0x1a2dde(0x121)],{data:_0x3eb197}=await axios_1['default'][_0x1a2dde(0x13f)](utils_1[_0x1a2dde(0x103)](this[_0x1a2dde(0x14a)][_0x1a2dde(0x11a)],'/services/oauth2/token'),null,{'params':{'grant_type':_0x1a2dde(0x13a),'refresh_token':_0x1c25ad,'client_id':_0x2ee39d,'client_secret':_0x5d5c79}});this['instanceUrl']=_0x3eb197[_0x1a2dde(0x141)],this['accessToken']=_0x3eb197[_0x1a2dde(0x10a)],this[_0x1a2dde(0x12c)]=_0x3eb197[_0x1a2dde(0x13d)],this['authState']=auth_state_enum_1[_0x1a2dde(0x11c)]['Active'],this[_0x1a2dde(0x11d)][_0x1a2dde(0x12e)](_0x1a2dde(0x142),this[_0x1a2dde(0x133)]);}catch(_0x55a22f){const _0x3457ff=((_0x2da4d4=(_0x3fe99f=_0x55a22f===null||_0x55a22f===void 0x0?void 0x0:_0x55a22f[_0x1a2dde(0x139)])===null||_0x3fe99f===void 0x0?void 0x0:_0x3fe99f['data'])===null||_0x2da4d4===void 0x0?void 0x0:_0x2da4d4[_0x1a2dde(0x12b)])||((_0x3b1add=_0x55a22f===null||_0x55a22f===void 0x0?void 0x0:_0x55a22f['response'])===null||_0x3b1add===void 0x0?void 0x0:_0x3b1add['data'])||_0x55a22f[_0x1a2dde(0x13b)];this[_0x1a2dde(0x11d)][_0x1a2dde(0x12b)](_0x1a2dde(0x143),_0x3457ff),this[_0x1a2dde(0xfe)]=auth_state_enum_1[_0x1a2dde(0x11c)][_0x1a2dde(0x10e)];throw new invalid_refresh_token_error_1[(_0x1a2dde(0x126))](errors_1[_0x1a2dde(0x12a)]);}}async[a125_0x2b4fd9(0x149)](){const _0x1c35fb=a125_0x2b4fd9;this[_0x1c35fb(0x11d)][_0x1c35fb(0x12e)](_0x1c35fb(0x147));if(this[_0x1c35fb(0xfe)]===auth_state_enum_1[_0x1c35fb(0x11c)][_0x1c35fb(0x131)]||this[_0x1c35fb(0xfe)]===auth_state_enum_1[_0x1c35fb(0x11c)][_0x1c35fb(0x101)])return await utils_1[_0x1c35fb(0x125)](this[_0x1c35fb(0x117)]),this[_0x1c35fb(0x149)]();if(this[_0x1c35fb(0xfe)]===auth_state_enum_1[_0x1c35fb(0x11c)]['Error'])throw new invalid_refresh_token_error_1[(_0x1c35fb(0x126))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x1c35fb(0x10d)]();}async[a125_0x2b4fd9(0x10f)](){const _0x5eb1bb=a125_0x2b4fd9;if(this[_0x5eb1bb(0xfe)]===auth_state_enum_1['AuthState'][_0x5eb1bb(0x10e)]){this[_0x5eb1bb(0x11d)][_0x5eb1bb(0x12e)](_0x5eb1bb(0x104));throw new unauthorized_salesforce_error_1[(_0x5eb1bb(0x129))]();}if(this['authState']!==auth_state_enum_1[_0x5eb1bb(0x11c)][_0x5eb1bb(0x119)])return this['logger'][_0x5eb1bb(0x12e)](_0x5eb1bb(0x100)),await utils_1[_0x5eb1bb(0x125)](this[_0x5eb1bb(0x117)]),this[_0x5eb1bb(0x10f)]();}[a125_0x2b4fd9(0x115)](){const _0x3fc0b4=a125_0x2b4fd9;return{'orgId':this[_0x3fc0b4(0x130)],'accessToken':this[_0x3fc0b4(0x13c)],'instanceUrl':this['instanceUrl']};}async['requestConfig'](){const _0x1643b2=a125_0x2b4fd9;return await this['waitAuth'](),{'baseURL':this[_0x1643b2(0x133)],'headers':{'accept':_0x1643b2(0x11f),'authorization':this[_0x1643b2(0x12c)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a125_0x2b4fd9(0x110)](),__metadata(a125_0x2b4fd9(0x148),[salesforce_settings_service_1[a125_0x2b4fd9(0x135)]])],SalesforceAuthService),exports[a125_0x2b4fd9(0x128)]=SalesforceAuthService;