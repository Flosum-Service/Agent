const a126_0x2b1177=a126_0x4788;function a126_0x2532(){const _0x205a6f=['Active','requestConfig','99YCJfuR','../../../core','sleep','loginUrl','logger','toString','forceUpdateToken','1565286ksuLuf','create\x20authorized\x20request\x20failed:\x20authorization\x20error','Error','orgId','waitAuth','SalesforceAuthService','apply','object','update\x20access\x20token','__esModule','/services/oauth2/token','accessToken','log','21548LUlBoM','__metadata','getAuthData','design:paramtypes','5571ZgqqNF','getOwnPropertyDescriptor','Logger','970IJAGCY','AUTH_WAIT_TIME','function','decorate','default','../errors/unauthorized-salesforce.error','instanceUrl','setAuthDetails','data','../enums/auth-state.enum','typedi','settings','98nopjjn','axios','414930AdmdpR','response','Idle','SalesforceSettingsService','error','salesforseSettings','services/data/','SALESFORCE_API_VERSION','access\x20token\x20updated\x20for\x20%s','../../../constants','AuthState','ERR_INVALID_SALESFORCE_TOKEN','then','force\x20update\x20token','Service','constructor','1703370YQVNlR','39176184NkiGpl','name','authState','20630zRLqvb','52OOwMEO','InvalidRefreshTokenError','length','defineProperty','token_type','__decorate','UnauthorizedSalesforceError','10888IPHSvV','(((.+)+)+)+$','Updating'];a126_0x2532=function(){return _0x205a6f;};return a126_0x2532();}(function(_0x34142b,_0x410bb3){const _0x5ec783=a126_0x4788,_0x5695ae=_0x34142b();while(!![]){try{const _0x4ca440=parseInt(_0x5ec783(0x218))/0x1*(parseInt(_0x5ec783(0x219))/0x2)+-parseInt(_0x5ec783(0x22c))/0x3+-parseInt(_0x5ec783(0x1ef))/0x4*(parseInt(_0x5ec783(0x1f6))/0x5)+-parseInt(_0x5ec783(0x204))/0x6*(-parseInt(_0x5ec783(0x202))/0x7)+parseInt(_0x5ec783(0x220))/0x8*(-parseInt(_0x5ec783(0x1f3))/0x9)+parseInt(_0x5ec783(0x214))/0xa*(-parseInt(_0x5ec783(0x225))/0xb)+parseInt(_0x5ec783(0x215))/0xc;if(_0x4ca440===_0x410bb3)break;else _0x5695ae['push'](_0x5695ae['shift']());}catch(_0x76af85){_0x5695ae['push'](_0x5695ae['shift']());}}}(a126_0x2532,0xc9e14));const a126_0x2ed1a0=(function(){let _0x5d2d03=!![];return function(_0x1e1f06,_0x244dbb){const _0x52e6f3=_0x5d2d03?function(){const _0x48077a=a126_0x4788;if(_0x244dbb){const _0x17c4f0=_0x244dbb[_0x48077a(0x1e8)](_0x1e1f06,arguments);return _0x244dbb=null,_0x17c4f0;}}:function(){};return _0x5d2d03=![],_0x52e6f3;};}()),a126_0x4dc646=a126_0x2ed1a0(this,function(){const _0x3a3bf3=a126_0x4788;return a126_0x4dc646[_0x3a3bf3(0x22a)]()['search']('(((.+)+)+)+$')[_0x3a3bf3(0x22a)]()[_0x3a3bf3(0x213)](a126_0x4dc646)['search'](_0x3a3bf3(0x221));});a126_0x4dc646();'use strict';function a126_0x4788(_0x1a7dc7,_0xffdcd1){const _0x2e9dc3=a126_0x2532();return a126_0x4788=function(_0x4dc646,_0x2ed1a0){_0x4dc646=_0x4dc646-0x1e3;let _0x2532bc=_0x2e9dc3[_0x4dc646];return _0x2532bc;},a126_0x4788(_0x1a7dc7,_0xffdcd1);}var __decorate=this&&this[a126_0x2b1177(0x21e)]||function(_0x1e1ab9,_0x4600be,_0x13a2d5,_0x1d3481){const _0x5cc8b8=a126_0x2b1177;var _0xa04a12=arguments[_0x5cc8b8(0x21b)],_0x373004=_0xa04a12<0x3?_0x4600be:_0x1d3481===null?_0x1d3481=Object[_0x5cc8b8(0x1f4)](_0x4600be,_0x13a2d5):_0x1d3481,_0x460b58;if(typeof Reflect===_0x5cc8b8(0x1e9)&&typeof Reflect[_0x5cc8b8(0x1f9)]===_0x5cc8b8(0x1f8))_0x373004=Reflect['decorate'](_0x1e1ab9,_0x4600be,_0x13a2d5,_0x1d3481);else{for(var _0x3789f9=_0x1e1ab9['length']-0x1;_0x3789f9>=0x0;_0x3789f9--)if(_0x460b58=_0x1e1ab9[_0x3789f9])_0x373004=(_0xa04a12<0x3?_0x460b58(_0x373004):_0xa04a12>0x3?_0x460b58(_0x4600be,_0x13a2d5,_0x373004):_0x460b58(_0x4600be,_0x13a2d5))||_0x373004;}return _0xa04a12>0x3&&_0x373004&&Object[_0x5cc8b8(0x21c)](_0x4600be,_0x13a2d5,_0x373004),_0x373004;},__metadata=this&&this[a126_0x2b1177(0x1f0)]||function(_0x3dd8ab,_0x5d7acf){const _0xae3b32=a126_0x2b1177;if(typeof Reflect===_0xae3b32(0x1e9)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x3dd8ab,_0x5d7acf);},__importDefault=this&&this['__importDefault']||function(_0x5460ed){const _0xaad7ab=a126_0x2b1177;return _0x5460ed&&_0x5460ed[_0xaad7ab(0x1eb)]?_0x5460ed:{'default':_0x5460ed};},SalesforceAuthService_1;Object[a126_0x2b1177(0x21c)](exports,a126_0x2b1177(0x1eb),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require(a126_0x2b1177(0x200)),errors_1=require('../../../constants/errors'),core_1=require(a126_0x2b1177(0x226)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a126_0x2b1177(0x203))),utils_1=require('../../shared/utils'),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a126_0x2b1177(0x1ff)),unauthorized_salesforce_error_1=require(a126_0x2b1177(0x1fb)),constants_1=require(a126_0x2b1177(0x20d));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x426785){const _0x904bf3=a126_0x2b1177;this[_0x904bf3(0x209)]=_0x426785,this[_0x904bf3(0x1f7)]=0x1388,this[_0x904bf3(0x217)]=auth_state_enum_1[_0x904bf3(0x20e)][_0x904bf3(0x206)],this['logger']=new core_1[(_0x904bf3(0x1f5))](SalesforceAuthService_1[_0x904bf3(0x216)]),this[_0x904bf3(0x1fd)]();}get['settings'](){const _0x5d5da8=a126_0x2b1177;return this['salesforseSettings'][_0x5d5da8(0x201)];}async[a126_0x2b1177(0x1fd)](){const _0x9e02b=a126_0x2b1177;this[_0x9e02b(0x229)][_0x9e02b(0x1ee)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x9e02b(0x20e)][this[_0x9e02b(0x217)]]);try{if(this['authState']===auth_state_enum_1['AuthState'][_0x9e02b(0x1e4)])return;if(this[_0x9e02b(0x217)]===auth_state_enum_1[_0x9e02b(0x20e)][_0x9e02b(0x206)])await this['updateAccessToken']();else{const _0x3101e7=await this[_0x9e02b(0x224)](),_0x6837b5=await axios_1[_0x9e02b(0x1fa)]['get'](_0x9e02b(0x20a)+constants_1[_0x9e02b(0x20b)],_0x3101e7)[_0x9e02b(0x210)](()=>!![])['catch'](()=>![]);!_0x6837b5&&await this['updateAccessToken']();}}catch(_0x1dacc8){}}async['updateAccessToken'](){const _0x2f6f14=a126_0x2b1177;var _0x174b41,_0x33165c,_0x5455f2;this['logger'][_0x2f6f14(0x1ee)](_0x2f6f14(0x1ea));try{this[_0x2f6f14(0x217)]=auth_state_enum_1[_0x2f6f14(0x20e)][_0x2f6f14(0x222)];const {refreshToken:_0x2aa3b6,clientId:_0x223501,clientSecret:_0x1465af}=this['settings'],{data:_0x33a8e6}=await axios_1[_0x2f6f14(0x1fa)]['post'](utils_1['joinURL'](this[_0x2f6f14(0x209)][_0x2f6f14(0x228)],_0x2f6f14(0x1ec)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x2aa3b6,'client_id':_0x223501,'client_secret':_0x1465af}});this[_0x2f6f14(0x1fc)]=_0x33a8e6['instance_url'],this[_0x2f6f14(0x1ed)]=_0x33a8e6['access_token'],this['tokenType']=_0x33a8e6[_0x2f6f14(0x21d)],this[_0x2f6f14(0x217)]=auth_state_enum_1[_0x2f6f14(0x20e)]['Active'],this[_0x2f6f14(0x229)][_0x2f6f14(0x1ee)](_0x2f6f14(0x20c),this[_0x2f6f14(0x1fc)]);}catch(_0x5bdfe7){const _0x445b0d=((_0x33165c=(_0x174b41=_0x5bdfe7===null||_0x5bdfe7===void 0x0?void 0x0:_0x5bdfe7[_0x2f6f14(0x205)])===null||_0x174b41===void 0x0?void 0x0:_0x174b41[_0x2f6f14(0x1fe)])===null||_0x33165c===void 0x0?void 0x0:_0x33165c[_0x2f6f14(0x208)])||((_0x5455f2=_0x5bdfe7===null||_0x5bdfe7===void 0x0?void 0x0:_0x5bdfe7[_0x2f6f14(0x205)])===null||_0x5455f2===void 0x0?void 0x0:_0x5455f2['data'])||_0x5bdfe7['message'];this['logger'][_0x2f6f14(0x208)]('update\x20access\x20token\x20failed:\x20%s',_0x445b0d),this[_0x2f6f14(0x217)]=auth_state_enum_1[_0x2f6f14(0x20e)]['Error'];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x2f6f14(0x20f)]);}}async[a126_0x2b1177(0x22b)](){const _0x8bf5da=a126_0x2b1177;this[_0x8bf5da(0x229)][_0x8bf5da(0x1ee)](_0x8bf5da(0x211));if(this[_0x8bf5da(0x217)]===auth_state_enum_1['AuthState'][_0x8bf5da(0x222)]||this['authState']===auth_state_enum_1['AuthState'][_0x8bf5da(0x206)])return await utils_1[_0x8bf5da(0x227)](this[_0x8bf5da(0x1f7)]),this['forceUpdateToken']();if(this[_0x8bf5da(0x217)]===auth_state_enum_1[_0x8bf5da(0x20e)][_0x8bf5da(0x1e4)])throw new invalid_refresh_token_error_1[(_0x8bf5da(0x21a))](errors_1[_0x8bf5da(0x20f)]);await this['updateAccessToken']();}async[a126_0x2b1177(0x1e6)](){const _0x39979b=a126_0x2b1177;if(this['authState']===auth_state_enum_1[_0x39979b(0x20e)]['Error']){this['logger'][_0x39979b(0x1ee)](_0x39979b(0x1e3));throw new unauthorized_salesforce_error_1[(_0x39979b(0x21f))]();}if(this['authState']!==auth_state_enum_1[_0x39979b(0x20e)][_0x39979b(0x223)])return this[_0x39979b(0x229)][_0x39979b(0x1ee)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x39979b(0x227)](this[_0x39979b(0x1f7)]),this['waitAuth']();}[a126_0x2b1177(0x1f1)](){const _0x170412=a126_0x2b1177;return{'orgId':this[_0x170412(0x1e5)],'accessToken':this[_0x170412(0x1ed)],'instanceUrl':this['instanceUrl']};}async[a126_0x2b1177(0x224)](){const _0x798220=a126_0x2b1177;return await this[_0x798220(0x1e6)](),{'baseURL':this[_0x798220(0x1fc)],'headers':{'accept':'application/json','authorization':this['tokenType']+'\x20'+this[_0x798220(0x1ed)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x2b1177(0x212)](),__metadata(a126_0x2b1177(0x1f2),[salesforce_settings_service_1[a126_0x2b1177(0x207)]])],SalesforceAuthService),exports[a126_0x2b1177(0x1e7)]=SalesforceAuthService;