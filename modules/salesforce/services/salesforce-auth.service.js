const a126_0x16359f=a126_0x34d0;(function(_0x58b977,_0x2b468d){const _0x50fb03=a126_0x34d0,_0x2f75cb=_0x58b977();while(!![]){try{const _0x56534c=-parseInt(_0x50fb03(0x101))/0x1+-parseInt(_0x50fb03(0x12d))/0x2*(-parseInt(_0x50fb03(0x128))/0x3)+-parseInt(_0x50fb03(0x11c))/0x4+-parseInt(_0x50fb03(0x110))/0x5*(parseInt(_0x50fb03(0x11b))/0x6)+parseInt(_0x50fb03(0x131))/0x7+-parseInt(_0x50fb03(0x12c))/0x8*(parseInt(_0x50fb03(0x109))/0x9)+parseInt(_0x50fb03(0x116))/0xa*(parseInt(_0x50fb03(0x132))/0xb);if(_0x56534c===_0x2b468d)break;else _0x2f75cb['push'](_0x2f75cb['shift']());}catch(_0x4dcea3){_0x2f75cb['push'](_0x2f75cb['shift']());}}}(a126_0x418c,0xb2c67));function a126_0x34d0(_0x3529d6,_0x59ce1d){const _0x1475ee=a126_0x418c();return a126_0x34d0=function(_0x5b481a,_0x4069ad){_0x5b481a=_0x5b481a-0xf0;let _0x418c9f=_0x1475ee[_0x5b481a];return _0x418c9f;},a126_0x34d0(_0x3529d6,_0x59ce1d);}const a126_0x4069ad=(function(){let _0x2c174e=!![];return function(_0x31db7e,_0x60d150){const _0x211fa8=_0x2c174e?function(){const _0x5eeb24=a126_0x34d0;if(_0x60d150){const _0x28d6a0=_0x60d150[_0x5eeb24(0xf6)](_0x31db7e,arguments);return _0x60d150=null,_0x28d6a0;}}:function(){};return _0x2c174e=![],_0x211fa8;};}()),a126_0x5b481a=a126_0x4069ad(this,function(){const _0x3ed511=a126_0x34d0;return a126_0x5b481a['toString']()[_0x3ed511(0x11a)](_0x3ed511(0xfc))[_0x3ed511(0x107)]()[_0x3ed511(0xf7)](a126_0x5b481a)[_0x3ed511(0x11a)]('(((.+)+)+)+$');});a126_0x5b481a();'use strict';var __decorate=this&&this[a126_0x16359f(0x125)]||function(_0x5b3bbd,_0x3e4ecd,_0x5898e2,_0x139942){const _0xbd6345=a126_0x16359f;var _0x27a83d=arguments[_0xbd6345(0x136)],_0x529c13=_0x27a83d<0x3?_0x3e4ecd:_0x139942===null?_0x139942=Object[_0xbd6345(0x126)](_0x3e4ecd,_0x5898e2):_0x139942,_0x368616;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x529c13=Reflect[_0xbd6345(0xfd)](_0x5b3bbd,_0x3e4ecd,_0x5898e2,_0x139942);else{for(var _0x2c2c89=_0x5b3bbd['length']-0x1;_0x2c2c89>=0x0;_0x2c2c89--)if(_0x368616=_0x5b3bbd[_0x2c2c89])_0x529c13=(_0x27a83d<0x3?_0x368616(_0x529c13):_0x27a83d>0x3?_0x368616(_0x3e4ecd,_0x5898e2,_0x529c13):_0x368616(_0x3e4ecd,_0x5898e2))||_0x529c13;}return _0x27a83d>0x3&&_0x529c13&&Object[_0xbd6345(0xf4)](_0x3e4ecd,_0x5898e2,_0x529c13),_0x529c13;},__metadata=this&&this[a126_0x16359f(0x114)]||function(_0x25ecad,_0x21ee74){const _0x562ca4=a126_0x16359f;if(typeof Reflect===_0x562ca4(0x13d)&&typeof Reflect[_0x562ca4(0x102)]===_0x562ca4(0x108))return Reflect['metadata'](_0x25ecad,_0x21ee74);},__importDefault=this&&this[a126_0x16359f(0x13a)]||function(_0x42c6f3){const _0x44e47e=a126_0x16359f;return _0x42c6f3&&_0x42c6f3[_0x44e47e(0x121)]?_0x42c6f3:{'default':_0x42c6f3};},SalesforceAuthService_1;Object[a126_0x16359f(0xf4)](exports,a126_0x16359f(0x121),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require('typedi'),errors_1=require('../../../constants/errors'),core_1=require(a126_0x16359f(0xf0)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require('axios')),utils_1=require(a126_0x16359f(0x13b)),invalid_refresh_token_error_1=require(a126_0x16359f(0xf5)),auth_state_enum_1=require(a126_0x16359f(0x118)),unauthorized_salesforce_error_1=require(a126_0x16359f(0xff)),constants_1=require(a126_0x16359f(0x115));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x36f9bf){const _0x40cd9b=a126_0x16359f;this[_0x40cd9b(0x106)]=_0x36f9bf,this[_0x40cd9b(0xf9)]=0x1388,this['authState']=auth_state_enum_1[_0x40cd9b(0x120)][_0x40cd9b(0x119)],this[_0x40cd9b(0xfe)]=new core_1[(_0x40cd9b(0xfb))](SalesforceAuthService_1[_0x40cd9b(0x105)]),this[_0x40cd9b(0x129)]();}get[a126_0x16359f(0x133)](){return this['salesforseSettings']['settings'];}async[a126_0x16359f(0x129)](){const _0x47336c=a126_0x16359f;this[_0x47336c(0xfe)][_0x47336c(0xf1)](_0x47336c(0x10f),auth_state_enum_1[_0x47336c(0x120)][this[_0x47336c(0x13f)]]);try{if(this[_0x47336c(0x13f)]===auth_state_enum_1['AuthState']['Error'])return;if(this[_0x47336c(0x13f)]===auth_state_enum_1[_0x47336c(0x120)]['Idle'])await this[_0x47336c(0x138)]();else{const _0x342182=await this['requestConfig'](),_0x2999b5=await axios_1[_0x47336c(0x12f)][_0x47336c(0xf8)]('services/data/'+constants_1['SALESFORCE_API_VERSION'],_0x342182)[_0x47336c(0x124)](()=>!![])[_0x47336c(0x104)](()=>![]);!_0x2999b5&&await this['updateAccessToken']();}}catch(_0x1f39ff){}}async['updateAccessToken'](){const _0x352e71=a126_0x16359f;var _0x27ef20,_0x4ad59e,_0xb2d145;this[_0x352e71(0xfe)][_0x352e71(0xf1)](_0x352e71(0x10a));try{this['authState']=auth_state_enum_1[_0x352e71(0x120)]['Updating'];const {refreshToken:_0x3a98ce,clientId:_0x4b4e90,clientSecret:_0x13bbf6}=this['settings'],{data:_0x455d35}=await axios_1['default'][_0x352e71(0x123)](utils_1['joinURL'](this['salesforseSettings']['loginUrl'],_0x352e71(0x111)),null,{'params':{'grant_type':_0x352e71(0x113),'refresh_token':_0x3a98ce,'client_id':_0x4b4e90,'client_secret':_0x13bbf6}});this['instanceUrl']=_0x455d35[_0x352e71(0x13e)],this[_0x352e71(0x100)]=_0x455d35['access_token'],this[_0x352e71(0xfa)]=_0x455d35[_0x352e71(0x10e)],this['authState']=auth_state_enum_1[_0x352e71(0x120)][_0x352e71(0x10b)],this[_0x352e71(0xfe)][_0x352e71(0xf1)](_0x352e71(0x11f),this[_0x352e71(0x134)]);}catch(_0x15a9f6){const _0xd3657d=((_0x4ad59e=(_0x27ef20=_0x15a9f6===null||_0x15a9f6===void 0x0?void 0x0:_0x15a9f6[_0x352e71(0x117)])===null||_0x27ef20===void 0x0?void 0x0:_0x27ef20[_0x352e71(0x127)])===null||_0x4ad59e===void 0x0?void 0x0:_0x4ad59e[_0x352e71(0x12b)])||((_0xb2d145=_0x15a9f6===null||_0x15a9f6===void 0x0?void 0x0:_0x15a9f6['response'])===null||_0xb2d145===void 0x0?void 0x0:_0xb2d145[_0x352e71(0x127)])||_0x15a9f6[_0x352e71(0x140)];this[_0x352e71(0xfe)][_0x352e71(0x12b)]('update\x20access\x20token\x20failed:\x20%s',_0xd3657d),this[_0x352e71(0x13f)]=auth_state_enum_1[_0x352e71(0x120)][_0x352e71(0x10d)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x352e71(0xf2)]);}}async['forceUpdateToken'](){const _0x1f24e5=a126_0x16359f;this[_0x1f24e5(0xfe)]['log'](_0x1f24e5(0x112));if(this[_0x1f24e5(0x13f)]===auth_state_enum_1[_0x1f24e5(0x120)]['Updating']||this[_0x1f24e5(0x13f)]===auth_state_enum_1[_0x1f24e5(0x120)][_0x1f24e5(0x119)])return await utils_1[_0x1f24e5(0x11e)](this[_0x1f24e5(0xf9)]),this[_0x1f24e5(0x137)]();if(this[_0x1f24e5(0x13f)]===auth_state_enum_1[_0x1f24e5(0x120)]['Error'])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x1f24e5(0xf2)]);await this[_0x1f24e5(0x138)]();}async[a126_0x16359f(0x10c)](){const _0x4b0e2c=a126_0x16359f;if(this[_0x4b0e2c(0x13f)]===auth_state_enum_1[_0x4b0e2c(0x120)][_0x4b0e2c(0x10d)]){this[_0x4b0e2c(0xfe)][_0x4b0e2c(0xf1)](_0x4b0e2c(0x13c));throw new unauthorized_salesforce_error_1[(_0x4b0e2c(0x130))]();}if(this[_0x4b0e2c(0x13f)]!==auth_state_enum_1['AuthState'][_0x4b0e2c(0x10b)])return this[_0x4b0e2c(0xfe)][_0x4b0e2c(0xf1)](_0x4b0e2c(0x139)),await utils_1[_0x4b0e2c(0x11e)](this['AUTH_WAIT_TIME']),this[_0x4b0e2c(0x10c)]();}[a126_0x16359f(0xf3)](){const _0x4830c9=a126_0x16359f;return{'orgId':this[_0x4830c9(0x122)],'accessToken':this[_0x4830c9(0x100)],'instanceUrl':this['instanceUrl']};}async[a126_0x16359f(0x11d)](){const _0x3ef38f=a126_0x16359f;return await this['waitAuth'](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x3ef38f(0x135),'authorization':this[_0x3ef38f(0xfa)]+'\x20'+this[_0x3ef38f(0x100)]}};}};function a126_0x418c(){const _0x620228=['instanceUrl','application/json','length','forceUpdateToken','updateAccessToken','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','__importDefault','../../shared/utils','create\x20authorized\x20request\x20failed:\x20authorization\x20error','object','instance_url','authState','message','../../../core','log','ERR_INVALID_SALESFORCE_TOKEN','getAuthData','defineProperty','../errors/invalid-refresh-token.error','apply','constructor','get','AUTH_WAIT_TIME','tokenType','Logger','(((.+)+)+)+$','decorate','logger','../errors/unauthorized-salesforce.error','accessToken','342204LsOmqT','metadata','design:paramtypes','catch','name','salesforseSettings','toString','function','74223aHKgnB','update\x20access\x20token','Active','waitAuth','Error','token_type','check\x20auth:\x20current\x20state\x20-\x20%s','30EBoWIN','/services/oauth2/token','force\x20update\x20token','refresh_token','__metadata','../../../constants','11652090lUFqBf','response','../enums/auth-state.enum','Idle','search','1015218DPxtyl','1188012WPrLUH','requestConfig','sleep','access\x20token\x20updated\x20for\x20%s','AuthState','__esModule','orgId','post','then','__decorate','getOwnPropertyDescriptor','data','312699mDxAGR','setAuthDetails','SalesforceSettingsService','error','848JbJXah','2tkRrQx','Service','default','UnauthorizedSalesforceError','5783533gpHHLy','22AxEjge','settings'];a126_0x418c=function(){return _0x620228;};return a126_0x418c();}SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x16359f(0x12e)](),__metadata(a126_0x16359f(0x103),[salesforce_settings_service_1[a126_0x16359f(0x12a)]])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;