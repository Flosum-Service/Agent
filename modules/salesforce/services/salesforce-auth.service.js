const a126_0x1c3903=a126_0x5b9c;(function(_0x458468,_0x5b1e24){const _0xf21c2b=a126_0x5b9c,_0x1bdd96=_0x458468();while(!![]){try{const _0x46f329=parseInt(_0xf21c2b(0x9b))/0x1*(-parseInt(_0xf21c2b(0xcd))/0x2)+parseInt(_0xf21c2b(0x94))/0x3*(parseInt(_0xf21c2b(0xa1))/0x4)+parseInt(_0xf21c2b(0xb2))/0x5*(-parseInt(_0xf21c2b(0xa3))/0x6)+-parseInt(_0xf21c2b(0x8a))/0x7*(-parseInt(_0xf21c2b(0xc5))/0x8)+-parseInt(_0xf21c2b(0x99))/0x9+-parseInt(_0xf21c2b(0x92))/0xa*(-parseInt(_0xf21c2b(0x95))/0xb)+-parseInt(_0xf21c2b(0xc9))/0xc*(parseInt(_0xf21c2b(0xc3))/0xd);if(_0x46f329===_0x5b1e24)break;else _0x1bdd96['push'](_0x1bdd96['shift']());}catch(_0x358725){_0x1bdd96['push'](_0x1bdd96['shift']());}}}(a126_0x4d3f,0xdb732));const a126_0x21a221=(function(){let _0xa44c72=!![];return function(_0x4e6bb8,_0x2b09ed){const _0x52c152=_0xa44c72?function(){const _0x4cd525=a126_0x5b9c;if(_0x2b09ed){const _0x1f4e8f=_0x2b09ed[_0x4cd525(0xc4)](_0x4e6bb8,arguments);return _0x2b09ed=null,_0x1f4e8f;}}:function(){};return _0xa44c72=![],_0x52c152;};}()),a126_0x41c54f=a126_0x21a221(this,function(){const _0xacd59a=a126_0x5b9c;return a126_0x41c54f[_0xacd59a(0x9f)]()[_0xacd59a(0x7c)]('(((.+)+)+)+$')[_0xacd59a(0x9f)]()[_0xacd59a(0xb8)](a126_0x41c54f)['search'](_0xacd59a(0xa0));});a126_0x41c54f();function a126_0x5b9c(_0x45f675,_0x2fc8bf){const _0xb6b572=a126_0x4d3f();return a126_0x5b9c=function(_0x41c54f,_0x21a221){_0x41c54f=_0x41c54f-0x7b;let _0x4d3f40=_0xb6b572[_0x41c54f];return _0x4d3f40;},a126_0x5b9c(_0x45f675,_0x2fc8bf);}'use strict';var __decorate=this&&this[a126_0x1c3903(0xcc)]||function(_0xb12fb,_0x194717,_0x3991a2,_0x68b848){const _0x396050=a126_0x1c3903;var _0x2b405a=arguments[_0x396050(0x9e)],_0x429af9=_0x2b405a<0x3?_0x194717:_0x68b848===null?_0x68b848=Object['getOwnPropertyDescriptor'](_0x194717,_0x3991a2):_0x68b848,_0x555226;if(typeof Reflect==='object'&&typeof Reflect[_0x396050(0xc6)]===_0x396050(0xb5))_0x429af9=Reflect[_0x396050(0xc6)](_0xb12fb,_0x194717,_0x3991a2,_0x68b848);else{for(var _0x6c1901=_0xb12fb[_0x396050(0x9e)]-0x1;_0x6c1901>=0x0;_0x6c1901--)if(_0x555226=_0xb12fb[_0x6c1901])_0x429af9=(_0x2b405a<0x3?_0x555226(_0x429af9):_0x2b405a>0x3?_0x555226(_0x194717,_0x3991a2,_0x429af9):_0x555226(_0x194717,_0x3991a2))||_0x429af9;}return _0x2b405a>0x3&&_0x429af9&&Object[_0x396050(0xbd)](_0x194717,_0x3991a2,_0x429af9),_0x429af9;},__metadata=this&&this[a126_0x1c3903(0xaf)]||function(_0xeca46d,_0x2b575c){const _0x5d5d92=a126_0x1c3903;if(typeof Reflect===_0x5d5d92(0x89)&&typeof Reflect[_0x5d5d92(0xac)]==='function')return Reflect[_0x5d5d92(0xac)](_0xeca46d,_0x2b575c);},__importDefault=this&&this[a126_0x1c3903(0xaa)]||function(_0x4d325b){const _0x1109f6=a126_0x1c3903;return _0x4d325b&&_0x4d325b[_0x1109f6(0xb1)]?_0x4d325b:{'default':_0x4d325b};},SalesforceAuthService_1;Object['defineProperty'](exports,a126_0x1c3903(0xb1),{'value':!![]}),exports[a126_0x1c3903(0xa5)]=void 0x0;const typedi_1=require('typedi'),errors_1=require('../../../constants/errors'),core_1=require('../../../core'),salesforce_settings_service_1=require(a126_0x1c3903(0xb9)),axios_1=__importDefault(require(a126_0x1c3903(0x7f))),utils_1=require(a126_0x1c3903(0xbf)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a126_0x1c3903(0xcb)),unauthorized_salesforce_error_1=require(a126_0x1c3903(0xb6)),constants_1=require(a126_0x1c3903(0x8d));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x481d34){const _0x4ba27d=a126_0x1c3903;this[_0x4ba27d(0xca)]=_0x481d34,this[_0x4ba27d(0xc2)]=0x1388,this['authState']=auth_state_enum_1[_0x4ba27d(0x85)]['Idle'],this['logger']=new core_1['Logger'](SalesforceAuthService_1[_0x4ba27d(0xc7)]),this[_0x4ba27d(0x91)]();}get['settings'](){const _0x13a46f=a126_0x1c3903;return this['salesforseSettings'][_0x13a46f(0xa9)];}async[a126_0x1c3903(0x91)](){const _0x89759f=a126_0x1c3903;this['logger'][_0x89759f(0x7b)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x89759f(0x85)][this[_0x89759f(0xa6)]]);try{if(this[_0x89759f(0xa6)]===auth_state_enum_1[_0x89759f(0x85)]['Error'])return;if(this[_0x89759f(0xa6)]===auth_state_enum_1['AuthState'][_0x89759f(0x83)])await this[_0x89759f(0x8c)]();else{const _0x1a51ab=await this[_0x89759f(0x81)](),_0x122a24=await axios_1[_0x89759f(0x96)][_0x89759f(0x9d)](_0x89759f(0x8b)+constants_1[_0x89759f(0xb0)],_0x1a51ab)[_0x89759f(0xb7)](()=>!![])['catch'](()=>![]);!_0x122a24&&await this[_0x89759f(0x8c)]();}}catch(_0x19813d){}}async[a126_0x1c3903(0x8c)](){const _0x1e2df0=a126_0x1c3903;var _0x5d6a74,_0x4cd38c,_0x1d805d;this[_0x1e2df0(0xa2)][_0x1e2df0(0x7b)](_0x1e2df0(0x90));try{this[_0x1e2df0(0xa6)]=auth_state_enum_1[_0x1e2df0(0x85)][_0x1e2df0(0x86)];const {refreshToken:_0x3761b6,clientId:_0x8fa81,clientSecret:_0x45aa6f}=this[_0x1e2df0(0xa9)],{data:_0x55f0df}=await axios_1[_0x1e2df0(0x96)][_0x1e2df0(0xb3)](utils_1[_0x1e2df0(0x7d)](this[_0x1e2df0(0xca)][_0x1e2df0(0x9c)],_0x1e2df0(0xa8)),null,{'params':{'grant_type':_0x1e2df0(0x82),'refresh_token':_0x3761b6,'client_id':_0x8fa81,'client_secret':_0x45aa6f}});this[_0x1e2df0(0x88)]=_0x55f0df[_0x1e2df0(0x7e)],this[_0x1e2df0(0xc0)]=_0x55f0df[_0x1e2df0(0xbe)],this[_0x1e2df0(0x8e)]=_0x55f0df[_0x1e2df0(0xbc)],this[_0x1e2df0(0xa6)]=auth_state_enum_1['AuthState'][_0x1e2df0(0x93)],this['logger']['log'](_0x1e2df0(0xc8),this[_0x1e2df0(0x88)]);}catch(_0x2b9bed){const _0x5130a1=((_0x4cd38c=(_0x5d6a74=_0x2b9bed===null||_0x2b9bed===void 0x0?void 0x0:_0x2b9bed[_0x1e2df0(0xa4)])===null||_0x5d6a74===void 0x0?void 0x0:_0x5d6a74['data'])===null||_0x4cd38c===void 0x0?void 0x0:_0x4cd38c[_0x1e2df0(0x97)])||((_0x1d805d=_0x2b9bed===null||_0x2b9bed===void 0x0?void 0x0:_0x2b9bed[_0x1e2df0(0xa4)])===null||_0x1d805d===void 0x0?void 0x0:_0x1d805d['data'])||_0x2b9bed[_0x1e2df0(0xb4)];this[_0x1e2df0(0xa2)][_0x1e2df0(0x97)](_0x1e2df0(0x80),_0x5130a1),this[_0x1e2df0(0xa6)]=auth_state_enum_1[_0x1e2df0(0x85)]['Error'];throw new invalid_refresh_token_error_1[(_0x1e2df0(0x98))](errors_1[_0x1e2df0(0xab)]);}}async[a126_0x1c3903(0x84)](){const _0x454b43=a126_0x1c3903;this[_0x454b43(0xa2)]['log'](_0x454b43(0xae));if(this[_0x454b43(0xa6)]===auth_state_enum_1[_0x454b43(0x85)][_0x454b43(0x86)]||this['authState']===auth_state_enum_1[_0x454b43(0x85)][_0x454b43(0x83)])return await utils_1[_0x454b43(0xbb)](this['AUTH_WAIT_TIME']),this['forceUpdateToken']();if(this['authState']===auth_state_enum_1[_0x454b43(0x85)]['Error'])throw new invalid_refresh_token_error_1[(_0x454b43(0x98))](errors_1[_0x454b43(0xab)]);await this['updateAccessToken']();}async[a126_0x1c3903(0x9a)](){const _0x5d9eef=a126_0x1c3903;if(this[_0x5d9eef(0xa6)]===auth_state_enum_1['AuthState']['Error']){this[_0x5d9eef(0xa2)][_0x5d9eef(0x7b)](_0x5d9eef(0xba));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x5d9eef(0xa6)]!==auth_state_enum_1['AuthState'][_0x5d9eef(0x93)])return this[_0x5d9eef(0xa2)]['log'](_0x5d9eef(0x87)),await utils_1[_0x5d9eef(0xbb)](this[_0x5d9eef(0xc2)]),this[_0x5d9eef(0x9a)]();}[a126_0x1c3903(0xc1)](){const _0x17ef35=a126_0x1c3903;return{'orgId':this[_0x17ef35(0xa7)],'accessToken':this[_0x17ef35(0xc0)],'instanceUrl':this[_0x17ef35(0x88)]};}async[a126_0x1c3903(0x81)](){const _0x1ab46a=a126_0x1c3903;return await this['waitAuth'](),{'baseURL':this[_0x1ab46a(0x88)],'headers':{'accept':_0x1ab46a(0xad),'authorization':this[_0x1ab46a(0x8e)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1['Service'](),__metadata(a126_0x1c3903(0x8f),[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a126_0x1c3903(0xa5)]=SalesforceAuthService;function a126_0x4d3f(){const _0x3ce2bc=['Idle','forceUpdateToken','AuthState','Updating','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','instanceUrl','object','147553aRnbXF','services/data/','updateAccessToken','../../../constants','tokenType','design:paramtypes','update\x20access\x20token','setAuthDetails','12611930refgOT','Active','1983SprLUR','11rREkiP','default','error','InvalidRefreshTokenError','2880216XDwKmJ','waitAuth','182249DpFbbu','loginUrl','get','length','toString','(((.+)+)+)+$','10196xcCZIy','logger','885318EFdaRw','response','SalesforceAuthService','authState','orgId','/services/oauth2/token','settings','__importDefault','ERR_INVALID_SALESFORCE_TOKEN','metadata','application/json','force\x20update\x20token','__metadata','SALESFORCE_API_VERSION','__esModule','10kJpbjI','post','message','function','../errors/unauthorized-salesforce.error','then','constructor','../../shared/services/salesforce-settings.service','create\x20authorized\x20request\x20failed:\x20authorization\x20error','sleep','token_type','defineProperty','access_token','../../shared/utils','accessToken','getAuthData','AUTH_WAIT_TIME','24502673uSNasu','apply','656QYNYPi','decorate','name','access\x20token\x20updated\x20for\x20%s','12tmFEQk','salesforseSettings','../enums/auth-state.enum','__decorate','14uLOjVj','log','search','joinURL','instance_url','axios','update\x20access\x20token\x20failed:\x20%s','requestConfig','refresh_token'];a126_0x4d3f=function(){return _0x3ce2bc;};return a126_0x4d3f();}