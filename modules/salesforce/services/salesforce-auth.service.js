const a126_0x47e79a=a126_0x3af9;(function(_0x248ac5,_0x200894){const _0x368456=a126_0x3af9,_0x418710=_0x248ac5();while(!![]){try{const _0x21aff1=-parseInt(_0x368456(0x190))/0x1*(-parseInt(_0x368456(0x1a8))/0x2)+parseInt(_0x368456(0x178))/0x3+parseInt(_0x368456(0x18a))/0x4*(parseInt(_0x368456(0x18c))/0x5)+-parseInt(_0x368456(0x18b))/0x6*(parseInt(_0x368456(0x193))/0x7)+-parseInt(_0x368456(0x1bc))/0x8*(-parseInt(_0x368456(0x17d))/0x9)+-parseInt(_0x368456(0x1ba))/0xa+-parseInt(_0x368456(0x183))/0xb;if(_0x21aff1===_0x200894)break;else _0x418710['push'](_0x418710['shift']());}catch(_0x448af4){_0x418710['push'](_0x418710['shift']());}}}(a126_0x19fc,0xdaf71));const a126_0x2c886e=(function(){let _0x3766bd=!![];return function(_0x5bca24,_0x403b69){const _0x2ba9f9=_0x3766bd?function(){if(_0x403b69){const _0x3eb10d=_0x403b69['apply'](_0x5bca24,arguments);return _0x403b69=null,_0x3eb10d;}}:function(){};return _0x3766bd=![],_0x2ba9f9;};}()),a126_0x2e4d5b=a126_0x2c886e(this,function(){const _0x1a5cc5=a126_0x3af9;return a126_0x2e4d5b[_0x1a5cc5(0x195)]()[_0x1a5cc5(0x1a2)](_0x1a5cc5(0x194))['toString']()[_0x1a5cc5(0x1a7)](a126_0x2e4d5b)[_0x1a5cc5(0x1a2)](_0x1a5cc5(0x194));});a126_0x2e4d5b();'use strict';var __decorate=this&&this[a126_0x47e79a(0x19b)]||function(_0x3f38e3,_0x2a59c8,_0x4c8288,_0x18e300){const _0x47fa11=a126_0x47e79a;var _0x5a66fe=arguments[_0x47fa11(0x177)],_0x90de0b=_0x5a66fe<0x3?_0x2a59c8:_0x18e300===null?_0x18e300=Object[_0x47fa11(0x1a9)](_0x2a59c8,_0x4c8288):_0x18e300,_0x207e1e;if(typeof Reflect===_0x47fa11(0x19f)&&typeof Reflect[_0x47fa11(0x1c0)]===_0x47fa11(0x19e))_0x90de0b=Reflect['decorate'](_0x3f38e3,_0x2a59c8,_0x4c8288,_0x18e300);else{for(var _0x1b075b=_0x3f38e3[_0x47fa11(0x177)]-0x1;_0x1b075b>=0x0;_0x1b075b--)if(_0x207e1e=_0x3f38e3[_0x1b075b])_0x90de0b=(_0x5a66fe<0x3?_0x207e1e(_0x90de0b):_0x5a66fe>0x3?_0x207e1e(_0x2a59c8,_0x4c8288,_0x90de0b):_0x207e1e(_0x2a59c8,_0x4c8288))||_0x90de0b;}return _0x5a66fe>0x3&&_0x90de0b&&Object[_0x47fa11(0x17e)](_0x2a59c8,_0x4c8288,_0x90de0b),_0x90de0b;},__metadata=this&&this[a126_0x47e79a(0x187)]||function(_0x34fc1b,_0x424668){const _0x563eb2=a126_0x47e79a;if(typeof Reflect==='object'&&typeof Reflect[_0x563eb2(0x185)]===_0x563eb2(0x19e))return Reflect[_0x563eb2(0x185)](_0x34fc1b,_0x424668);},__importDefault=this&&this[a126_0x47e79a(0x179)]||function(_0x3d5baf){return _0x3d5baf&&_0x3d5baf['__esModule']?_0x3d5baf:{'default':_0x3d5baf};},SalesforceAuthService_1;Object[a126_0x47e79a(0x17e)](exports,a126_0x47e79a(0x198),{'value':!![]}),exports[a126_0x47e79a(0x1ad)]=void 0x0;function a126_0x3af9(_0x43044b,_0x4c1c10){const _0xe19dc=a126_0x19fc();return a126_0x3af9=function(_0x2e4d5b,_0x2c886e){_0x2e4d5b=_0x2e4d5b-0x175;let _0x19fc23=_0xe19dc[_0x2e4d5b];return _0x19fc23;},a126_0x3af9(_0x43044b,_0x4c1c10);}const typedi_1=require(a126_0x47e79a(0x1b4)),errors_1=require(a126_0x47e79a(0x175)),core_1=require(a126_0x47e79a(0x1ae)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a126_0x47e79a(0x17c))),utils_1=require('../../shared/utils'),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a126_0x47e79a(0x1c3)),unauthorized_salesforce_error_1=require(a126_0x47e79a(0x189)),constants_1=require(a126_0x47e79a(0x1af));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0xbe3206){const _0x2db8cb=a126_0x47e79a;this[_0x2db8cb(0x1b5)]=_0xbe3206,this[_0x2db8cb(0x1a5)]=0x1388,this[_0x2db8cb(0x1b1)]=auth_state_enum_1[_0x2db8cb(0x1c2)]['Idle'],this[_0x2db8cb(0x1b2)]=new core_1[(_0x2db8cb(0x180))](SalesforceAuthService_1['name']),this[_0x2db8cb(0x19c)]();}get[a126_0x47e79a(0x17a)](){const _0xb73a7b=a126_0x47e79a;return this[_0xb73a7b(0x1b5)][_0xb73a7b(0x17a)];}async[a126_0x47e79a(0x19c)](){const _0x3f902d=a126_0x47e79a;this[_0x3f902d(0x1b2)]['log'](_0x3f902d(0x191),auth_state_enum_1[_0x3f902d(0x1c2)][this[_0x3f902d(0x1b1)]]);try{if(this[_0x3f902d(0x1b1)]===auth_state_enum_1[_0x3f902d(0x1c2)][_0x3f902d(0x188)])return;if(this[_0x3f902d(0x1b1)]===auth_state_enum_1[_0x3f902d(0x1c2)][_0x3f902d(0x181)])await this[_0x3f902d(0x1be)]();else{const _0xb841a0=await this[_0x3f902d(0x18d)](),_0x3114e9=await axios_1[_0x3f902d(0x197)]['get'](_0x3f902d(0x19d)+constants_1[_0x3f902d(0x18e)],_0xb841a0)[_0x3f902d(0x1a0)](()=>!![])[_0x3f902d(0x176)](()=>![]);!_0x3114e9&&await this[_0x3f902d(0x1be)]();}}catch(_0x5304c1){}}async['updateAccessToken'](){const _0x1caafc=a126_0x47e79a;var _0x253616,_0x59d36b,_0x1a38bf;this[_0x1caafc(0x1b2)][_0x1caafc(0x1c1)](_0x1caafc(0x1b6));try{this[_0x1caafc(0x1b1)]=auth_state_enum_1[_0x1caafc(0x1c2)][_0x1caafc(0x1bb)];const {refreshToken:_0x437973,clientId:_0x336024,clientSecret:_0x398270}=this[_0x1caafc(0x17a)],{data:_0x3d78cf}=await axios_1[_0x1caafc(0x197)][_0x1caafc(0x1a4)](utils_1['joinURL'](this[_0x1caafc(0x1b5)]['loginUrl'],_0x1caafc(0x1ac)),null,{'params':{'grant_type':_0x1caafc(0x186),'refresh_token':_0x437973,'client_id':_0x336024,'client_secret':_0x398270}});this[_0x1caafc(0x1ab)]=_0x3d78cf['instance_url'],this[_0x1caafc(0x17b)]=_0x3d78cf[_0x1caafc(0x1b7)],this[_0x1caafc(0x1b0)]=_0x3d78cf[_0x1caafc(0x1b9)],this[_0x1caafc(0x1b1)]=auth_state_enum_1[_0x1caafc(0x1c2)][_0x1caafc(0x18f)],this[_0x1caafc(0x1b2)][_0x1caafc(0x1c1)]('access\x20token\x20updated\x20for\x20%s',this[_0x1caafc(0x1ab)]);}catch(_0x596ce6){const _0x2b6ee9=((_0x59d36b=(_0x253616=_0x596ce6===null||_0x596ce6===void 0x0?void 0x0:_0x596ce6[_0x1caafc(0x199)])===null||_0x253616===void 0x0?void 0x0:_0x253616[_0x1caafc(0x1b8)])===null||_0x59d36b===void 0x0?void 0x0:_0x59d36b[_0x1caafc(0x192)])||((_0x1a38bf=_0x596ce6===null||_0x596ce6===void 0x0?void 0x0:_0x596ce6[_0x1caafc(0x199)])===null||_0x1a38bf===void 0x0?void 0x0:_0x1a38bf[_0x1caafc(0x1b8)])||_0x596ce6[_0x1caafc(0x19a)];this['logger'][_0x1caafc(0x192)](_0x1caafc(0x1c4),_0x2b6ee9),this[_0x1caafc(0x1b1)]=auth_state_enum_1[_0x1caafc(0x1c2)][_0x1caafc(0x188)];throw new invalid_refresh_token_error_1[(_0x1caafc(0x1b3))](errors_1[_0x1caafc(0x1bd)]);}}async[a126_0x47e79a(0x1a3)](){const _0x4ee044=a126_0x47e79a;this[_0x4ee044(0x1b2)][_0x4ee044(0x1c1)](_0x4ee044(0x17f));if(this[_0x4ee044(0x1b1)]===auth_state_enum_1[_0x4ee044(0x1c2)][_0x4ee044(0x1bb)]||this['authState']===auth_state_enum_1[_0x4ee044(0x1c2)][_0x4ee044(0x181)])return await utils_1[_0x4ee044(0x184)](this[_0x4ee044(0x1a5)]),this[_0x4ee044(0x1a3)]();if(this['authState']===auth_state_enum_1['AuthState'][_0x4ee044(0x188)])throw new invalid_refresh_token_error_1[(_0x4ee044(0x1b3))](errors_1[_0x4ee044(0x1bd)]);await this[_0x4ee044(0x1be)]();}async[a126_0x47e79a(0x1a6)](){const _0x2f3db7=a126_0x47e79a;if(this['authState']===auth_state_enum_1['AuthState'][_0x2f3db7(0x188)]){this[_0x2f3db7(0x1b2)][_0x2f3db7(0x1c1)](_0x2f3db7(0x182));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x2f3db7(0x1b1)]!==auth_state_enum_1['AuthState']['Active'])return this['logger'][_0x2f3db7(0x1c1)](_0x2f3db7(0x1aa)),await utils_1[_0x2f3db7(0x184)](this[_0x2f3db7(0x1a5)]),this['waitAuth']();}[a126_0x47e79a(0x196)](){const _0x248fdd=a126_0x47e79a;return{'orgId':this[_0x248fdd(0x1a1)],'accessToken':this['accessToken'],'instanceUrl':this['instanceUrl']};}async[a126_0x47e79a(0x18d)](){const _0x5f3339=a126_0x47e79a;return await this[_0x5f3339(0x1a6)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x5f3339(0x1bf),'authorization':this[_0x5f3339(0x1b0)]+'\x20'+this[_0x5f3339(0x17b)]}};}};function a126_0x19fc(){const _0x39ae27=['access_token','data','token_type','11585600rolaHT','Updating','24fjlGhK','ERR_INVALID_SALESFORCE_TOKEN','updateAccessToken','application/json','decorate','log','AuthState','../enums/auth-state.enum','update\x20access\x20token\x20failed:\x20%s','../../../constants/errors','catch','length','525786kNWiWR','__importDefault','settings','accessToken','axios','3663153nmiYHE','defineProperty','force\x20update\x20token','Logger','Idle','create\x20authorized\x20request\x20failed:\x20authorization\x20error','263307UMynwv','sleep','metadata','refresh_token','__metadata','Error','../errors/unauthorized-salesforce.error','4VDgJNV','176916uNURgb','1571335kSJuRf','requestConfig','SALESFORCE_API_VERSION','Active','14578gaDKny','check\x20auth:\x20current\x20state\x20-\x20%s','error','217VCyyvg','(((.+)+)+)+$','toString','getAuthData','default','__esModule','response','message','__decorate','setAuthDetails','services/data/','function','object','then','orgId','search','forceUpdateToken','post','AUTH_WAIT_TIME','waitAuth','constructor','176sdjFot','getOwnPropertyDescriptor','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','instanceUrl','/services/oauth2/token','SalesforceAuthService','../../../core','../../../constants','tokenType','authState','logger','InvalidRefreshTokenError','typedi','salesforseSettings','update\x20access\x20token'];a126_0x19fc=function(){return _0x39ae27;};return a126_0x19fc();}SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1['Service'](),__metadata('design:paramtypes',[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a126_0x47e79a(0x1ad)]=SalesforceAuthService;