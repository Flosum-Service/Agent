const a125_0x31b3e4=a125_0x376f;(function(_0x327d74,_0x224b79){const _0x1309da=a125_0x376f,_0x3dedb0=_0x327d74();while(!![]){try{const _0x4d139b=parseInt(_0x1309da(0x13a))/0x1+parseInt(_0x1309da(0x137))/0x2*(parseInt(_0x1309da(0x140))/0x3)+parseInt(_0x1309da(0x14b))/0x4+-parseInt(_0x1309da(0x14a))/0x5+-parseInt(_0x1309da(0x16a))/0x6*(-parseInt(_0x1309da(0x160))/0x7)+parseInt(_0x1309da(0x122))/0x8+-parseInt(_0x1309da(0x120))/0x9;if(_0x4d139b===_0x224b79)break;else _0x3dedb0['push'](_0x3dedb0['shift']());}catch(_0x668a46){_0x3dedb0['push'](_0x3dedb0['shift']());}}}(a125_0x2298,0x2f71f));const a125_0x20a6e2=(function(){let _0x21e36c=!![];return function(_0x19eaf3,_0xb4624e){const _0x4f1977=_0x21e36c?function(){const _0x30c289=a125_0x376f;if(_0xb4624e){const _0x1ef0cf=_0xb4624e[_0x30c289(0x12b)](_0x19eaf3,arguments);return _0xb4624e=null,_0x1ef0cf;}}:function(){};return _0x21e36c=![],_0x4f1977;};}()),a125_0x4cf2a6=a125_0x20a6e2(this,function(){const _0x30c918=a125_0x376f;return a125_0x4cf2a6[_0x30c918(0x159)]()[_0x30c918(0x124)](_0x30c918(0x12c))[_0x30c918(0x159)]()['constructor'](a125_0x4cf2a6)[_0x30c918(0x124)](_0x30c918(0x12c));});a125_0x4cf2a6();function a125_0x376f(_0x2df377,_0x5bd395){const _0x2ed886=a125_0x2298();return a125_0x376f=function(_0x4cf2a6,_0x20a6e2){_0x4cf2a6=_0x4cf2a6-0x11b;let _0x2298fe=_0x2ed886[_0x4cf2a6];return _0x2298fe;},a125_0x376f(_0x2df377,_0x5bd395);}function a125_0x2298(){const _0x33a733=['getOwnPropertyDescriptor','token_type','Active','Service','/services/oauth2/token','logger','308535snZBeo','32964GnrYkY','length','error','axios','../../../core','SalesforceAuthService','decorate','AUTH_WAIT_TIME','../errors/invalid-refresh-token.error','access\x20token\x20updated\x20for\x20%s','name','get','../../../constants/errors','response','toString','../../../constants','waitAuth','setAuthDetails','metadata','ERR_INVALID_SALESFORCE_TOKEN','update\x20access\x20token\x20failed:\x20%s','1099vZSLrQ','updateAccessToken','data','message','Logger','Updating','__decorate','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','log','update\x20access\x20token','12834BRwWRE','__metadata','application/json','SALESFORCE_API_VERSION','requestConfig','UnauthorizedSalesforceError','5484312RvxNsz','instanceUrl','1443384BpEsLV','check\x20auth:\x20current\x20state\x20-\x20%s','search','typedi','catch','salesforseSettings','Error','orgId','force\x20update\x20token','apply','(((.+)+)+)+$','function','Idle','../../shared/utils','default','refresh_token','then','design:paramtypes','__esModule','AuthState','__importDefault','58780ObTVwp','access_token','joinURL','193973DVuWDv','settings','accessToken','object','sleep','instance_url','15AZGmjZ','authState','tokenType','InvalidRefreshTokenError'];a125_0x2298=function(){return _0x33a733;};return a125_0x2298();}'use strict';var __decorate=this&&this[a125_0x31b3e4(0x166)]||function(_0x3f1d26,_0x4b980f,_0x57ac62,_0x1f5d61){const _0x4271a9=a125_0x31b3e4;var _0x381879=arguments[_0x4271a9(0x14c)],_0x23f31d=_0x381879<0x3?_0x4b980f:_0x1f5d61===null?_0x1f5d61=Object[_0x4271a9(0x144)](_0x4b980f,_0x57ac62):_0x1f5d61,_0x2d15f8;if(typeof Reflect===_0x4271a9(0x13d)&&typeof Reflect['decorate']===_0x4271a9(0x12d))_0x23f31d=Reflect[_0x4271a9(0x151)](_0x3f1d26,_0x4b980f,_0x57ac62,_0x1f5d61);else{for(var _0x202cc6=_0x3f1d26['length']-0x1;_0x202cc6>=0x0;_0x202cc6--)if(_0x2d15f8=_0x3f1d26[_0x202cc6])_0x23f31d=(_0x381879<0x3?_0x2d15f8(_0x23f31d):_0x381879>0x3?_0x2d15f8(_0x4b980f,_0x57ac62,_0x23f31d):_0x2d15f8(_0x4b980f,_0x57ac62))||_0x23f31d;}return _0x381879>0x3&&_0x23f31d&&Object['defineProperty'](_0x4b980f,_0x57ac62,_0x23f31d),_0x23f31d;},__metadata=this&&this[a125_0x31b3e4(0x11b)]||function(_0x4586b5,_0x2a3b49){const _0x87ceaa=a125_0x31b3e4;if(typeof Reflect===_0x87ceaa(0x13d)&&typeof Reflect[_0x87ceaa(0x15d)]===_0x87ceaa(0x12d))return Reflect[_0x87ceaa(0x15d)](_0x4586b5,_0x2a3b49);},__importDefault=this&&this[a125_0x31b3e4(0x136)]||function(_0x455107){const _0x1e3af1=a125_0x31b3e4;return _0x455107&&_0x455107[_0x1e3af1(0x134)]?_0x455107:{'default':_0x455107};},SalesforceAuthService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a125_0x31b3e4(0x150)]=void 0x0;const typedi_1=require(a125_0x31b3e4(0x125)),errors_1=require(a125_0x31b3e4(0x157)),core_1=require(a125_0x31b3e4(0x14f)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a125_0x31b3e4(0x14e))),utils_1=require(a125_0x31b3e4(0x12f)),invalid_refresh_token_error_1=require(a125_0x31b3e4(0x153)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a125_0x31b3e4(0x15a));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x44f340){const _0x44f771=a125_0x31b3e4;this[_0x44f771(0x127)]=_0x44f340,this[_0x44f771(0x152)]=0x1388,this[_0x44f771(0x141)]=auth_state_enum_1[_0x44f771(0x135)]['Idle'],this[_0x44f771(0x149)]=new core_1[(_0x44f771(0x164))](SalesforceAuthService_1[_0x44f771(0x155)]),this[_0x44f771(0x15c)]();}get[a125_0x31b3e4(0x13b)](){const _0x5f16ca=a125_0x31b3e4;return this['salesforseSettings'][_0x5f16ca(0x13b)];}async[a125_0x31b3e4(0x15c)](){const _0x432b43=a125_0x31b3e4;this[_0x432b43(0x149)]['log'](_0x432b43(0x123),auth_state_enum_1['AuthState'][this[_0x432b43(0x141)]]);try{if(this[_0x432b43(0x141)]===auth_state_enum_1[_0x432b43(0x135)][_0x432b43(0x128)])return;if(this[_0x432b43(0x141)]===auth_state_enum_1[_0x432b43(0x135)][_0x432b43(0x12e)])await this[_0x432b43(0x161)]();else{const _0x463b79=await this[_0x432b43(0x11e)](),_0x4d2fe=await axios_1[_0x432b43(0x130)][_0x432b43(0x156)]('services/data/'+constants_1[_0x432b43(0x11d)],_0x463b79)[_0x432b43(0x132)](()=>!![])[_0x432b43(0x126)](()=>![]);!_0x4d2fe&&await this[_0x432b43(0x161)]();}}catch(_0x235c0f){}}async['updateAccessToken'](){const _0x5d0727=a125_0x31b3e4;var _0x3e28ba,_0x1c9e38,_0xd697b;this['logger']['log'](_0x5d0727(0x169));try{this[_0x5d0727(0x141)]=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x14a03c,clientId:_0x14e6a9,clientSecret:_0xdb1603}=this[_0x5d0727(0x13b)],{data:_0x56afd9}=await axios_1[_0x5d0727(0x130)]['post'](utils_1[_0x5d0727(0x139)](this[_0x5d0727(0x127)]['loginUrl'],_0x5d0727(0x148)),null,{'params':{'grant_type':_0x5d0727(0x131),'refresh_token':_0x14a03c,'client_id':_0x14e6a9,'client_secret':_0xdb1603}});this[_0x5d0727(0x121)]=_0x56afd9[_0x5d0727(0x13f)],this[_0x5d0727(0x13c)]=_0x56afd9[_0x5d0727(0x138)],this[_0x5d0727(0x142)]=_0x56afd9[_0x5d0727(0x145)],this[_0x5d0727(0x141)]=auth_state_enum_1[_0x5d0727(0x135)][_0x5d0727(0x146)],this[_0x5d0727(0x149)][_0x5d0727(0x168)](_0x5d0727(0x154),this['instanceUrl']);}catch(_0x31b424){const _0x17e415=((_0x1c9e38=(_0x3e28ba=_0x31b424===null||_0x31b424===void 0x0?void 0x0:_0x31b424[_0x5d0727(0x158)])===null||_0x3e28ba===void 0x0?void 0x0:_0x3e28ba[_0x5d0727(0x162)])===null||_0x1c9e38===void 0x0?void 0x0:_0x1c9e38['error'])||((_0xd697b=_0x31b424===null||_0x31b424===void 0x0?void 0x0:_0x31b424['response'])===null||_0xd697b===void 0x0?void 0x0:_0xd697b[_0x5d0727(0x162)])||_0x31b424[_0x5d0727(0x163)];this[_0x5d0727(0x149)][_0x5d0727(0x14d)](_0x5d0727(0x15f),_0x17e415),this[_0x5d0727(0x141)]=auth_state_enum_1[_0x5d0727(0x135)][_0x5d0727(0x128)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x2fd657=a125_0x31b3e4;this['logger'][_0x2fd657(0x168)](_0x2fd657(0x12a));if(this[_0x2fd657(0x141)]===auth_state_enum_1[_0x2fd657(0x135)][_0x2fd657(0x165)]||this['authState']===auth_state_enum_1[_0x2fd657(0x135)][_0x2fd657(0x12e)])return await utils_1['sleep'](this[_0x2fd657(0x152)]),this['forceUpdateToken']();if(this[_0x2fd657(0x141)]===auth_state_enum_1['AuthState']['Error'])throw new invalid_refresh_token_error_1[(_0x2fd657(0x143))](errors_1[_0x2fd657(0x15e)]);await this[_0x2fd657(0x161)]();}async[a125_0x31b3e4(0x15b)](){const _0x55e544=a125_0x31b3e4;if(this[_0x55e544(0x141)]===auth_state_enum_1['AuthState'][_0x55e544(0x128)]){this[_0x55e544(0x149)][_0x55e544(0x168)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x55e544(0x11f))]();}if(this[_0x55e544(0x141)]!==auth_state_enum_1['AuthState'][_0x55e544(0x146)])return this[_0x55e544(0x149)][_0x55e544(0x168)](_0x55e544(0x167)),await utils_1[_0x55e544(0x13e)](this[_0x55e544(0x152)]),this['waitAuth']();}['getAuthData'](){const _0x3ea892=a125_0x31b3e4;return{'orgId':this[_0x3ea892(0x129)],'accessToken':this['accessToken'],'instanceUrl':this['instanceUrl']};}async[a125_0x31b3e4(0x11e)](){const _0xcc9fe8=a125_0x31b3e4;return await this[_0xcc9fe8(0x15b)](),{'baseURL':this[_0xcc9fe8(0x121)],'headers':{'accept':_0xcc9fe8(0x11c),'authorization':this[_0xcc9fe8(0x142)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a125_0x31b3e4(0x147)](),__metadata(a125_0x31b3e4(0x133),[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a125_0x31b3e4(0x150)]=SalesforceAuthService;