const a125_0xe203a0=a125_0x4c34;(function(_0x3a1be6,_0x474168){const _0x8c5756=a125_0x4c34,_0xe5b2a7=_0x3a1be6();while(!![]){try{const _0x5b1d18=parseInt(_0x8c5756(0x90))/0x1*(-parseInt(_0x8c5756(0xa6))/0x2)+parseInt(_0x8c5756(0x93))/0x3+-parseInt(_0x8c5756(0xa0))/0x4*(-parseInt(_0x8c5756(0x85))/0x5)+parseInt(_0x8c5756(0x6c))/0x6+parseInt(_0x8c5756(0xaa))/0x7+parseInt(_0x8c5756(0xa4))/0x8*(-parseInt(_0x8c5756(0x67))/0x9)+-parseInt(_0x8c5756(0x98))/0xa*(parseInt(_0x8c5756(0x89))/0xb);if(_0x5b1d18===_0x474168)break;else _0xe5b2a7['push'](_0xe5b2a7['shift']());}catch(_0x19362c){_0xe5b2a7['push'](_0xe5b2a7['shift']());}}}(a125_0x301c,0xb58fc));function a125_0x4c34(_0x30615d,_0x801488){const _0xba1eb8=a125_0x301c();return a125_0x4c34=function(_0x209614,_0xda3c0){_0x209614=_0x209614-0x66;let _0x301c17=_0xba1eb8[_0x209614];return _0x301c17;},a125_0x4c34(_0x30615d,_0x801488);}const a125_0xda3c0=(function(){let _0x5a5aa5=!![];return function(_0x3b128c,_0x19b4e8){const _0x4fe7bb=_0x5a5aa5?function(){const _0x5c7b49=a125_0x4c34;if(_0x19b4e8){const _0x27f38d=_0x19b4e8[_0x5c7b49(0x8c)](_0x3b128c,arguments);return _0x19b4e8=null,_0x27f38d;}}:function(){};return _0x5a5aa5=![],_0x4fe7bb;};}()),a125_0x209614=a125_0xda3c0(this,function(){const _0x23f3c2=a125_0x4c34;return a125_0x209614[_0x23f3c2(0x6f)]()[_0x23f3c2(0x76)](_0x23f3c2(0xab))['toString']()[_0x23f3c2(0x95)](a125_0x209614)[_0x23f3c2(0x76)]('(((.+)+)+)+$');});function a125_0x301c(){const _0x14787f=['857bhhQwc','updateAccessToken','instance_url','3633801NrEJyg','name','constructor','refresh_token','../../shared/utils','4827820cmhewR','token_type','design:paramtypes','AuthState','create\x20authorized\x20request\x20failed:\x20authorization\x20error','../../../core','salesforseSettings','getOwnPropertyDescriptor','1406068vlerGl','SALESFORCE_API_VERSION','authState','settings','1336gKcKKp','AUTH_WAIT_TIME','806AEyQNi','error','length','update\x20access\x20token\x20failed:\x20%s','1641325CZcHfT','(((.+)+)+)+$','catch','decorate','waitAuth','accessToken','setAuthDetails','65907yWcPlW','SalesforceAuthService','Error','__decorate','ERR_INVALID_SALESFORCE_TOKEN','2554452FyTtGR','../../shared/services/salesforce-settings.service','instanceUrl','toString','SalesforceSettingsService','forceUpdateToken','__metadata','data','metadata','function','search','getAuthData','log','requestConfig','services/data/','__esModule','loginUrl','default','Active','response','force\x20update\x20token','tokenType','sleep','UnauthorizedSalesforceError','InvalidRefreshTokenError','20UatjpM','post','logger','__importDefault','22fwyGcK','Updating','object','apply','typedi','access\x20token\x20updated\x20for\x20%s','defineProperty'];a125_0x301c=function(){return _0x14787f;};return a125_0x301c();}a125_0x209614();'use strict';var __decorate=this&&this[a125_0xe203a0(0x6a)]||function(_0x32387c,_0x35eda1,_0x3a45b2,_0x1e3f1e){const _0x4df8fd=a125_0xe203a0;var _0x580ace=arguments[_0x4df8fd(0xa8)],_0x207080=_0x580ace<0x3?_0x35eda1:_0x1e3f1e===null?_0x1e3f1e=Object[_0x4df8fd(0x9f)](_0x35eda1,_0x3a45b2):_0x1e3f1e,_0xd63155;if(typeof Reflect===_0x4df8fd(0x8b)&&typeof Reflect['decorate']===_0x4df8fd(0x75))_0x207080=Reflect[_0x4df8fd(0xad)](_0x32387c,_0x35eda1,_0x3a45b2,_0x1e3f1e);else{for(var _0x18d766=_0x32387c[_0x4df8fd(0xa8)]-0x1;_0x18d766>=0x0;_0x18d766--)if(_0xd63155=_0x32387c[_0x18d766])_0x207080=(_0x580ace<0x3?_0xd63155(_0x207080):_0x580ace>0x3?_0xd63155(_0x35eda1,_0x3a45b2,_0x207080):_0xd63155(_0x35eda1,_0x3a45b2))||_0x207080;}return _0x580ace>0x3&&_0x207080&&Object[_0x4df8fd(0x8f)](_0x35eda1,_0x3a45b2,_0x207080),_0x207080;},__metadata=this&&this[a125_0xe203a0(0x72)]||function(_0x1e2c2b,_0x31fed6){const _0x27801b=a125_0xe203a0;if(typeof Reflect===_0x27801b(0x8b)&&typeof Reflect[_0x27801b(0x74)]===_0x27801b(0x75))return Reflect[_0x27801b(0x74)](_0x1e2c2b,_0x31fed6);},__importDefault=this&&this[a125_0xe203a0(0x88)]||function(_0x3b181d){const _0x53f42c=a125_0xe203a0;return _0x3b181d&&_0x3b181d[_0x53f42c(0x7b)]?_0x3b181d:{'default':_0x3b181d};},SalesforceAuthService_1;Object[a125_0xe203a0(0x8f)](exports,'__esModule',{'value':!![]}),exports[a125_0xe203a0(0x68)]=void 0x0;const typedi_1=require(a125_0xe203a0(0x8d)),errors_1=require('../../../constants/errors'),core_1=require(a125_0xe203a0(0x9d)),salesforce_settings_service_1=require(a125_0xe203a0(0x6d)),axios_1=__importDefault(require('axios')),utils_1=require(a125_0xe203a0(0x97)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require('../../../constants');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x3f52fa){const _0x42e38e=a125_0xe203a0;this[_0x42e38e(0x9e)]=_0x3f52fa,this['AUTH_WAIT_TIME']=0x1388,this[_0x42e38e(0xa2)]=auth_state_enum_1[_0x42e38e(0x9b)]['Idle'],this[_0x42e38e(0x87)]=new core_1['Logger'](SalesforceAuthService_1[_0x42e38e(0x94)]),this[_0x42e38e(0x66)]();}get['settings'](){const _0x13ab99=a125_0xe203a0;return this['salesforseSettings'][_0x13ab99(0xa3)];}async['setAuthDetails'](){const _0x2ddd39=a125_0xe203a0;this[_0x2ddd39(0x87)][_0x2ddd39(0x78)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this[_0x2ddd39(0xa2)]]);try{if(this[_0x2ddd39(0xa2)]===auth_state_enum_1[_0x2ddd39(0x9b)][_0x2ddd39(0x69)])return;if(this['authState']===auth_state_enum_1[_0x2ddd39(0x9b)]['Idle'])await this[_0x2ddd39(0x91)]();else{const _0x5a73fd=await this[_0x2ddd39(0x79)](),_0x5eff78=await axios_1[_0x2ddd39(0x7d)]['get'](_0x2ddd39(0x7a)+constants_1[_0x2ddd39(0xa1)],_0x5a73fd)['then'](()=>!![])[_0x2ddd39(0xac)](()=>![]);!_0x5eff78&&await this['updateAccessToken']();}}catch(_0x4788db){}}async[a125_0xe203a0(0x91)](){const _0x2a07bd=a125_0xe203a0;var _0x288501,_0x530f1b,_0x2f9ff9;this['logger']['log']('update\x20access\x20token');try{this[_0x2a07bd(0xa2)]=auth_state_enum_1[_0x2a07bd(0x9b)][_0x2a07bd(0x8a)];const {refreshToken:_0x133eeb,clientId:_0x4a71b7,clientSecret:_0x59e2a1}=this[_0x2a07bd(0xa3)],{data:_0x34bb38}=await axios_1[_0x2a07bd(0x7d)][_0x2a07bd(0x86)](utils_1['joinURL'](this[_0x2a07bd(0x9e)][_0x2a07bd(0x7c)],'/services/oauth2/token'),null,{'params':{'grant_type':_0x2a07bd(0x96),'refresh_token':_0x133eeb,'client_id':_0x4a71b7,'client_secret':_0x59e2a1}});this[_0x2a07bd(0x6e)]=_0x34bb38[_0x2a07bd(0x92)],this[_0x2a07bd(0xaf)]=_0x34bb38['access_token'],this['tokenType']=_0x34bb38[_0x2a07bd(0x99)],this[_0x2a07bd(0xa2)]=auth_state_enum_1['AuthState'][_0x2a07bd(0x7e)],this[_0x2a07bd(0x87)]['log'](_0x2a07bd(0x8e),this[_0x2a07bd(0x6e)]);}catch(_0x4ba23e){const _0x4353d3=((_0x530f1b=(_0x288501=_0x4ba23e===null||_0x4ba23e===void 0x0?void 0x0:_0x4ba23e[_0x2a07bd(0x7f)])===null||_0x288501===void 0x0?void 0x0:_0x288501[_0x2a07bd(0x73)])===null||_0x530f1b===void 0x0?void 0x0:_0x530f1b['error'])||((_0x2f9ff9=_0x4ba23e===null||_0x4ba23e===void 0x0?void 0x0:_0x4ba23e[_0x2a07bd(0x7f)])===null||_0x2f9ff9===void 0x0?void 0x0:_0x2f9ff9[_0x2a07bd(0x73)])||_0x4ba23e['message'];this['logger'][_0x2a07bd(0xa7)](_0x2a07bd(0xa9),_0x4353d3),this[_0x2a07bd(0xa2)]=auth_state_enum_1[_0x2a07bd(0x9b)][_0x2a07bd(0x69)];throw new invalid_refresh_token_error_1[(_0x2a07bd(0x84))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0xc0c51f=a125_0xe203a0;this['logger'][_0xc0c51f(0x78)](_0xc0c51f(0x80));if(this['authState']===auth_state_enum_1[_0xc0c51f(0x9b)][_0xc0c51f(0x8a)]||this[_0xc0c51f(0xa2)]===auth_state_enum_1[_0xc0c51f(0x9b)]['Idle'])return await utils_1[_0xc0c51f(0x82)](this[_0xc0c51f(0xa5)]),this[_0xc0c51f(0x71)]();if(this['authState']===auth_state_enum_1['AuthState'][_0xc0c51f(0x69)])throw new invalid_refresh_token_error_1[(_0xc0c51f(0x84))](errors_1[_0xc0c51f(0x6b)]);await this['updateAccessToken']();}async['waitAuth'](){const _0x5b43df=a125_0xe203a0;if(this[_0x5b43df(0xa2)]===auth_state_enum_1[_0x5b43df(0x9b)][_0x5b43df(0x69)]){this[_0x5b43df(0x87)][_0x5b43df(0x78)](_0x5b43df(0x9c));throw new unauthorized_salesforce_error_1[(_0x5b43df(0x83))]();}if(this['authState']!==auth_state_enum_1['AuthState']['Active'])return this[_0x5b43df(0x87)][_0x5b43df(0x78)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1['sleep'](this[_0x5b43df(0xa5)]),this[_0x5b43df(0xae)]();}[a125_0xe203a0(0x77)](){const _0x38f702=a125_0xe203a0;return{'orgId':this['orgId'],'accessToken':this['accessToken'],'instanceUrl':this[_0x38f702(0x6e)]};}async[a125_0xe203a0(0x79)](){const _0x2e3c03=a125_0xe203a0;return await this['waitAuth'](),{'baseURL':this[_0x2e3c03(0x6e)],'headers':{'accept':'application/json','authorization':this[_0x2e3c03(0x81)]+'\x20'+this[_0x2e3c03(0xaf)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1['Service'](),__metadata(a125_0xe203a0(0x9a),[salesforce_settings_service_1[a125_0xe203a0(0x70)]])],SalesforceAuthService),exports[a125_0xe203a0(0x68)]=SalesforceAuthService;