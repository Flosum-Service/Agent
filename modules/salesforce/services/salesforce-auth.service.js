const a125_0x45eecf=a125_0x3fc7;(function(_0x377853,_0x11ac52){const _0x4cd6d6=a125_0x3fc7,_0x581ea2=_0x377853();while(!![]){try{const _0x2df256=parseInt(_0x4cd6d6(0x135))/0x1*(-parseInt(_0x4cd6d6(0xfb))/0x2)+-parseInt(_0x4cd6d6(0x104))/0x3+-parseInt(_0x4cd6d6(0x116))/0x4*(parseInt(_0x4cd6d6(0x11a))/0x5)+parseInt(_0x4cd6d6(0x13a))/0x6*(parseInt(_0x4cd6d6(0x105))/0x7)+parseInt(_0x4cd6d6(0x13d))/0x8*(-parseInt(_0x4cd6d6(0x12d))/0x9)+parseInt(_0x4cd6d6(0x144))/0xa+-parseInt(_0x4cd6d6(0x10f))/0xb*(-parseInt(_0x4cd6d6(0x107))/0xc);if(_0x2df256===_0x11ac52)break;else _0x581ea2['push'](_0x581ea2['shift']());}catch(_0x2ce571){_0x581ea2['push'](_0x581ea2['shift']());}}}(a125_0x5d33,0x525a5));const a125_0x1072aa=(function(){let _0x5de281=!![];return function(_0x4fe646,_0x55468d){const _0x1b2765=_0x5de281?function(){const _0x4e782e=a125_0x3fc7;if(_0x55468d){const _0x2ca937=_0x55468d[_0x4e782e(0x123)](_0x4fe646,arguments);return _0x55468d=null,_0x2ca937;}}:function(){};return _0x5de281=![],_0x1b2765;};}()),a125_0x1e5c6c=a125_0x1072aa(this,function(){const _0x49d615=a125_0x3fc7;return a125_0x1e5c6c['toString']()[_0x49d615(0x130)](_0x49d615(0x113))['toString']()[_0x49d615(0x112)](a125_0x1e5c6c)[_0x49d615(0x130)](_0x49d615(0x113));});function a125_0x3fc7(_0x5d9c9c,_0xec8b1d){const _0x4f7ecc=a125_0x5d33();return a125_0x3fc7=function(_0x1e5c6c,_0x1072aa){_0x1e5c6c=_0x1e5c6c-0xf7;let _0x5d3387=_0x4f7ecc[_0x1e5c6c];return _0x5d3387;},a125_0x3fc7(_0x5d9c9c,_0xec8b1d);}a125_0x1e5c6c();function a125_0x5d33(){const _0x235173=['SalesforceSettingsService','sleep','length','../../../core','metadata','axios','authState','salesforseSettings','message','21969xXjERP','Active','../../shared/services/salesforce-settings.service','search','updateAccessToken','AuthState','then','access_token','1zuyOMp','../errors/unauthorized-salesforce.error','setAuthDetails','../../../constants/errors','tokenType','2420334vgbtEH','Idle','accessToken','1184MoFpkh','SalesforceAuthService','AUTH_WAIT_TIME','requestConfig','default','get','catch','5475080WNWpTG','../../shared/utils','ERR_INVALID_SALESFORCE_TOKEN','waitAuth','Updating','error','549268yRoYlZ','settings','__esModule','Service','create\x20authorized\x20request\x20failed:\x20authorization\x20error','/services/oauth2/token','typedi','../enums/auth-state.enum','object','1612695idgimY','7xchYio','Error','60xttOmr','application/json','post','response','refresh_token','instanceUrl','data','function','2101935VREQyq','access\x20token\x20updated\x20for\x20%s','__importDefault','constructor','(((.+)+)+)+$','token_type','../errors/invalid-refresh-token.error','3688HJMbPu','design:paramtypes','force\x20update\x20token','forceUpdateToken','2145rWXLVw','getOwnPropertyDescriptor','defineProperty','log','logger','../../../constants','decorate','orgId','instance_url','apply'];a125_0x5d33=function(){return _0x235173;};return a125_0x5d33();}'use strict';var __decorate=this&&this['__decorate']||function(_0x2be145,_0x15eb37,_0x217c3a,_0x1785ee){const _0x1441db=a125_0x3fc7;var _0x386a96=arguments[_0x1441db(0x126)],_0x197894=_0x386a96<0x3?_0x15eb37:_0x1785ee===null?_0x1785ee=Object[_0x1441db(0x11b)](_0x15eb37,_0x217c3a):_0x1785ee,_0x5f3f65;if(typeof Reflect===_0x1441db(0x103)&&typeof Reflect[_0x1441db(0x120)]===_0x1441db(0x10e))_0x197894=Reflect['decorate'](_0x2be145,_0x15eb37,_0x217c3a,_0x1785ee);else{for(var _0x478af9=_0x2be145[_0x1441db(0x126)]-0x1;_0x478af9>=0x0;_0x478af9--)if(_0x5f3f65=_0x2be145[_0x478af9])_0x197894=(_0x386a96<0x3?_0x5f3f65(_0x197894):_0x386a96>0x3?_0x5f3f65(_0x15eb37,_0x217c3a,_0x197894):_0x5f3f65(_0x15eb37,_0x217c3a))||_0x197894;}return _0x386a96>0x3&&_0x197894&&Object[_0x1441db(0x11c)](_0x15eb37,_0x217c3a,_0x197894),_0x197894;},__metadata=this&&this['__metadata']||function(_0x19489e,_0x18ca50){const _0x149136=a125_0x3fc7;if(typeof Reflect===_0x149136(0x103)&&typeof Reflect[_0x149136(0x128)]===_0x149136(0x10e))return Reflect['metadata'](_0x19489e,_0x18ca50);},__importDefault=this&&this[a125_0x45eecf(0x111)]||function(_0x1c4a11){const _0x2a8225=a125_0x45eecf;return _0x1c4a11&&_0x1c4a11[_0x2a8225(0xfd)]?_0x1c4a11:{'default':_0x1c4a11};},SalesforceAuthService_1;Object[a125_0x45eecf(0x11c)](exports,a125_0x45eecf(0xfd),{'value':!![]}),exports[a125_0x45eecf(0x13e)]=void 0x0;const typedi_1=require(a125_0x45eecf(0x101)),errors_1=require(a125_0x45eecf(0x138)),core_1=require(a125_0x45eecf(0x127)),salesforce_settings_service_1=require(a125_0x45eecf(0x12f)),axios_1=__importDefault(require(a125_0x45eecf(0x129))),utils_1=require(a125_0x45eecf(0x145)),invalid_refresh_token_error_1=require(a125_0x45eecf(0x115)),auth_state_enum_1=require(a125_0x45eecf(0x102)),unauthorized_salesforce_error_1=require(a125_0x45eecf(0x136)),constants_1=require(a125_0x45eecf(0x11f));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x35bb3b){const _0x162fc5=a125_0x45eecf;this[_0x162fc5(0x12b)]=_0x35bb3b,this[_0x162fc5(0x13f)]=0x1388,this[_0x162fc5(0x12a)]=auth_state_enum_1['AuthState'][_0x162fc5(0x13b)],this[_0x162fc5(0x11e)]=new core_1['Logger'](SalesforceAuthService_1['name']),this[_0x162fc5(0x137)]();}get[a125_0x45eecf(0xfc)](){const _0x497561=a125_0x45eecf;return this['salesforseSettings'][_0x497561(0xfc)];}async['setAuthDetails'](){const _0x41043d=a125_0x45eecf;this['logger'][_0x41043d(0x11d)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x41043d(0x132)][this[_0x41043d(0x12a)]]);try{if(this[_0x41043d(0x12a)]===auth_state_enum_1[_0x41043d(0x132)][_0x41043d(0x106)])return;if(this[_0x41043d(0x12a)]===auth_state_enum_1[_0x41043d(0x132)]['Idle'])await this['updateAccessToken']();else{const _0x1bb16d=await this['requestConfig'](),_0x3067de=await axios_1[_0x41043d(0x141)][_0x41043d(0x142)]('services/data/'+constants_1['SALESFORCE_API_VERSION'],_0x1bb16d)[_0x41043d(0x133)](()=>!![])[_0x41043d(0x143)](()=>![]);!_0x3067de&&await this['updateAccessToken']();}}catch(_0x3ff893){}}async[a125_0x45eecf(0x131)](){const _0x538473=a125_0x45eecf;var _0x3e99bd,_0x71894b,_0x44543b;this[_0x538473(0x11e)][_0x538473(0x11d)]('update\x20access\x20token');try{this[_0x538473(0x12a)]=auth_state_enum_1['AuthState'][_0x538473(0xf9)];const {refreshToken:_0x473397,clientId:_0x46d3a2,clientSecret:_0x46ce35}=this[_0x538473(0xfc)],{data:_0x4a26eb}=await axios_1[_0x538473(0x141)][_0x538473(0x109)](utils_1['joinURL'](this[_0x538473(0x12b)]['loginUrl'],_0x538473(0x100)),null,{'params':{'grant_type':_0x538473(0x10b),'refresh_token':_0x473397,'client_id':_0x46d3a2,'client_secret':_0x46ce35}});this[_0x538473(0x10c)]=_0x4a26eb[_0x538473(0x122)],this[_0x538473(0x13c)]=_0x4a26eb[_0x538473(0x134)],this[_0x538473(0x139)]=_0x4a26eb[_0x538473(0x114)],this['authState']=auth_state_enum_1[_0x538473(0x132)][_0x538473(0x12e)],this['logger'][_0x538473(0x11d)](_0x538473(0x110),this[_0x538473(0x10c)]);}catch(_0x13ab46){const _0x4df433=((_0x71894b=(_0x3e99bd=_0x13ab46===null||_0x13ab46===void 0x0?void 0x0:_0x13ab46[_0x538473(0x10a)])===null||_0x3e99bd===void 0x0?void 0x0:_0x3e99bd[_0x538473(0x10d)])===null||_0x71894b===void 0x0?void 0x0:_0x71894b[_0x538473(0xfa)])||((_0x44543b=_0x13ab46===null||_0x13ab46===void 0x0?void 0x0:_0x13ab46['response'])===null||_0x44543b===void 0x0?void 0x0:_0x44543b['data'])||_0x13ab46[_0x538473(0x12c)];this[_0x538473(0x11e)][_0x538473(0xfa)]('update\x20access\x20token\x20failed:\x20%s',_0x4df433),this[_0x538473(0x12a)]=auth_state_enum_1[_0x538473(0x132)][_0x538473(0x106)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a125_0x45eecf(0x119)](){const _0x4a7712=a125_0x45eecf;this['logger']['log'](_0x4a7712(0x118));if(this[_0x4a7712(0x12a)]===auth_state_enum_1[_0x4a7712(0x132)][_0x4a7712(0xf9)]||this[_0x4a7712(0x12a)]===auth_state_enum_1[_0x4a7712(0x132)][_0x4a7712(0x13b)])return await utils_1[_0x4a7712(0x125)](this[_0x4a7712(0x13f)]),this[_0x4a7712(0x119)]();if(this[_0x4a7712(0x12a)]===auth_state_enum_1[_0x4a7712(0x132)][_0x4a7712(0x106)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x4a7712(0xf7)]);await this[_0x4a7712(0x131)]();}async['waitAuth'](){const _0xda462e=a125_0x45eecf;if(this['authState']===auth_state_enum_1[_0xda462e(0x132)][_0xda462e(0x106)]){this[_0xda462e(0x11e)][_0xda462e(0x11d)](_0xda462e(0xff));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0xda462e(0x12a)]!==auth_state_enum_1['AuthState']['Active'])return this['logger']['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0xda462e(0x125)](this[_0xda462e(0x13f)]),this[_0xda462e(0xf8)]();}['getAuthData'](){const _0x3a379a=a125_0x45eecf;return{'orgId':this[_0x3a379a(0x121)],'accessToken':this[_0x3a379a(0x13c)],'instanceUrl':this['instanceUrl']};}async[a125_0x45eecf(0x140)](){const _0x3d555f=a125_0x45eecf;return await this['waitAuth'](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x3d555f(0x108),'authorization':this['tokenType']+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a125_0x45eecf(0xfe)](),__metadata(a125_0x45eecf(0x117),[salesforce_settings_service_1[a125_0x45eecf(0x124)]])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;