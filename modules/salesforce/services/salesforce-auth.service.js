const a126_0x3d768d=a126_0x598a;function a126_0x5ef7(){const _0x40f6f5=['decorate','(((.+)+)+)+$','817152koiRFu','token_type','../errors/unauthorized-salesforce.error','Service','__metadata','sleep','24pvuYYf','length','3085kZCiuF','3Istsgw','metadata','force\x20update\x20token','typedi','waitAuth','tokenType','apply','instance_url','constructor','AUTH_WAIT_TIME','authState','12DWlafa','UnauthorizedSalesforceError','updateAccessToken','design:paramtypes','Updating','toString','post','../enums/auth-state.enum','__esModule','requestConfig','services/data/','9ygFvOt','../../shared/utils','log','refresh_token','29847719SNqDWB','1412JKfcKa','search','catch','access_token','3831380IScPSk','Active','accessToken','ERR_INVALID_SALESFORCE_TOKEN','../../shared/services/salesforce-settings.service','4887536ZvqUph','logger','1201731UQdKiR','../../../core','SalesforceSettingsService','../../../constants','Error','update\x20access\x20token','InvalidRefreshTokenError','SALESFORCE_API_VERSION','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','joinURL','update\x20access\x20token\x20failed:\x20%s','settings','../../../constants/errors','setAuthDetails','axios','828398APnlDD','Logger','access\x20token\x20updated\x20for\x20%s','default','response','salesforseSettings','Idle','instanceUrl','AuthState','forceUpdateToken','data','../errors/invalid-refresh-token.error','object','defineProperty','function','__importDefault','getAuthData','error','check\x20auth:\x20current\x20state\x20-\x20%s'];a126_0x5ef7=function(){return _0x40f6f5;};return a126_0x5ef7();}(function(_0x476de0,_0x5803bf){const _0x3ecd5d=a126_0x598a,_0x15f450=_0x476de0();while(!![]){try{const _0x401682=parseInt(_0x3ecd5d(0x120))/0x1*(-parseInt(_0x3ecd5d(0x155))/0x2)+parseInt(_0x3ecd5d(0x146))/0x3+-parseInt(_0x3ecd5d(0x13b))/0x4*(parseInt(_0x3ecd5d(0x11f))/0x5)+-parseInt(_0x3ecd5d(0x11d))/0x6*(parseInt(_0x3ecd5d(0x16a))/0x7)+-parseInt(_0x3ecd5d(0x144))/0x8+parseInt(_0x3ecd5d(0x136))/0x9*(parseInt(_0x3ecd5d(0x13f))/0xa)+-parseInt(_0x3ecd5d(0x13a))/0xb*(-parseInt(_0x3ecd5d(0x12b))/0xc);if(_0x401682===_0x5803bf)break;else _0x15f450['push'](_0x15f450['shift']());}catch(_0x5e79eb){_0x15f450['push'](_0x15f450['shift']());}}}(a126_0x5ef7,0xea18c));const a126_0x1be998=(function(){let _0x50a093=!![];return function(_0x458132,_0x39e59e){const _0x52386f=_0x50a093?function(){const _0xb1d8d5=a126_0x598a;if(_0x39e59e){const _0x3b706a=_0x39e59e[_0xb1d8d5(0x126)](_0x458132,arguments);return _0x39e59e=null,_0x3b706a;}}:function(){};return _0x50a093=![],_0x52386f;};}()),a126_0x49eabb=a126_0x1be998(this,function(){const _0x29c01f=a126_0x598a;return a126_0x49eabb[_0x29c01f(0x130)]()['search'](_0x29c01f(0x169))[_0x29c01f(0x130)]()[_0x29c01f(0x128)](a126_0x49eabb)[_0x29c01f(0x13c)](_0x29c01f(0x169));});a126_0x49eabb();'use strict';var __decorate=this&&this['__decorate']||function(_0x22a9c4,_0x59ee16,_0x1be1b1,_0x390ca5){const _0x14296f=a126_0x598a;var _0x31061e=arguments[_0x14296f(0x11e)],_0x2ed408=_0x31061e<0x3?_0x59ee16:_0x390ca5===null?_0x390ca5=Object['getOwnPropertyDescriptor'](_0x59ee16,_0x1be1b1):_0x390ca5,_0x46bef7;if(typeof Reflect==='object'&&typeof Reflect[_0x14296f(0x168)]==='function')_0x2ed408=Reflect['decorate'](_0x22a9c4,_0x59ee16,_0x1be1b1,_0x390ca5);else{for(var _0x1e265d=_0x22a9c4[_0x14296f(0x11e)]-0x1;_0x1e265d>=0x0;_0x1e265d--)if(_0x46bef7=_0x22a9c4[_0x1e265d])_0x2ed408=(_0x31061e<0x3?_0x46bef7(_0x2ed408):_0x31061e>0x3?_0x46bef7(_0x59ee16,_0x1be1b1,_0x2ed408):_0x46bef7(_0x59ee16,_0x1be1b1))||_0x2ed408;}return _0x31061e>0x3&&_0x2ed408&&Object['defineProperty'](_0x59ee16,_0x1be1b1,_0x2ed408),_0x2ed408;},__metadata=this&&this[a126_0x3d768d(0x11b)]||function(_0x1d73a0,_0x4a46bc){const _0x53a597=a126_0x3d768d;if(typeof Reflect===_0x53a597(0x161)&&typeof Reflect['metadata']===_0x53a597(0x163))return Reflect[_0x53a597(0x121)](_0x1d73a0,_0x4a46bc);},__importDefault=this&&this[a126_0x3d768d(0x164)]||function(_0x352dc1){return _0x352dc1&&_0x352dc1['__esModule']?_0x352dc1:{'default':_0x352dc1};},SalesforceAuthService_1;Object[a126_0x3d768d(0x162)](exports,a126_0x3d768d(0x133),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require(a126_0x3d768d(0x123)),errors_1=require(a126_0x3d768d(0x152)),core_1=require(a126_0x3d768d(0x147)),salesforce_settings_service_1=require(a126_0x3d768d(0x143)),axios_1=__importDefault(require(a126_0x3d768d(0x154))),utils_1=require(a126_0x3d768d(0x137)),invalid_refresh_token_error_1=require(a126_0x3d768d(0x160)),auth_state_enum_1=require(a126_0x3d768d(0x132)),unauthorized_salesforce_error_1=require(a126_0x3d768d(0x16c)),constants_1=require(a126_0x3d768d(0x149));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x5c0f63){const _0x3d119e=a126_0x3d768d;this[_0x3d119e(0x15a)]=_0x5c0f63,this['AUTH_WAIT_TIME']=0x1388,this[_0x3d119e(0x12a)]=auth_state_enum_1[_0x3d119e(0x15d)][_0x3d119e(0x15b)],this[_0x3d119e(0x145)]=new core_1[(_0x3d119e(0x156))](SalesforceAuthService_1['name']),this[_0x3d119e(0x153)]();}get[a126_0x3d768d(0x151)](){const _0x2060c9=a126_0x3d768d;return this[_0x2060c9(0x15a)]['settings'];}async['setAuthDetails'](){const _0x3b71ec=a126_0x3d768d;this[_0x3b71ec(0x145)]['log'](_0x3b71ec(0x167),auth_state_enum_1[_0x3b71ec(0x15d)][this[_0x3b71ec(0x12a)]]);try{if(this[_0x3b71ec(0x12a)]===auth_state_enum_1[_0x3b71ec(0x15d)][_0x3b71ec(0x14a)])return;if(this[_0x3b71ec(0x12a)]===auth_state_enum_1['AuthState']['Idle'])await this['updateAccessToken']();else{const _0x3876f2=await this[_0x3b71ec(0x134)](),_0x12fcbc=await axios_1[_0x3b71ec(0x158)]['get'](_0x3b71ec(0x135)+constants_1[_0x3b71ec(0x14d)],_0x3876f2)['then'](()=>!![])[_0x3b71ec(0x13d)](()=>![]);!_0x12fcbc&&await this[_0x3b71ec(0x12d)]();}}catch(_0x32ebe4){}}async[a126_0x3d768d(0x12d)](){const _0x1399ca=a126_0x3d768d;var _0x41afa3,_0x137441,_0x1399ee;this[_0x1399ca(0x145)]['log'](_0x1399ca(0x14b));try{this[_0x1399ca(0x12a)]=auth_state_enum_1[_0x1399ca(0x15d)][_0x1399ca(0x12f)];const {refreshToken:_0x292a6b,clientId:_0x5f537c,clientSecret:_0x19f9a8}=this[_0x1399ca(0x151)],{data:_0x568473}=await axios_1[_0x1399ca(0x158)][_0x1399ca(0x131)](utils_1[_0x1399ca(0x14f)](this[_0x1399ca(0x15a)]['loginUrl'],'/services/oauth2/token'),null,{'params':{'grant_type':_0x1399ca(0x139),'refresh_token':_0x292a6b,'client_id':_0x5f537c,'client_secret':_0x19f9a8}});this[_0x1399ca(0x15c)]=_0x568473[_0x1399ca(0x127)],this[_0x1399ca(0x141)]=_0x568473[_0x1399ca(0x13e)],this[_0x1399ca(0x125)]=_0x568473[_0x1399ca(0x16b)],this[_0x1399ca(0x12a)]=auth_state_enum_1[_0x1399ca(0x15d)][_0x1399ca(0x140)],this[_0x1399ca(0x145)][_0x1399ca(0x138)](_0x1399ca(0x157),this[_0x1399ca(0x15c)]);}catch(_0x40703c){const _0x2b5f05=((_0x137441=(_0x41afa3=_0x40703c===null||_0x40703c===void 0x0?void 0x0:_0x40703c['response'])===null||_0x41afa3===void 0x0?void 0x0:_0x41afa3[_0x1399ca(0x15f)])===null||_0x137441===void 0x0?void 0x0:_0x137441[_0x1399ca(0x166)])||((_0x1399ee=_0x40703c===null||_0x40703c===void 0x0?void 0x0:_0x40703c[_0x1399ca(0x159)])===null||_0x1399ee===void 0x0?void 0x0:_0x1399ee[_0x1399ca(0x15f)])||_0x40703c['message'];this['logger'][_0x1399ca(0x166)](_0x1399ca(0x150),_0x2b5f05),this[_0x1399ca(0x12a)]=auth_state_enum_1[_0x1399ca(0x15d)]['Error'];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x1399ca(0x142)]);}}async[a126_0x3d768d(0x15e)](){const _0x515de4=a126_0x3d768d;this[_0x515de4(0x145)][_0x515de4(0x138)](_0x515de4(0x122));if(this['authState']===auth_state_enum_1[_0x515de4(0x15d)][_0x515de4(0x12f)]||this[_0x515de4(0x12a)]===auth_state_enum_1[_0x515de4(0x15d)][_0x515de4(0x15b)])return await utils_1[_0x515de4(0x11c)](this[_0x515de4(0x129)]),this[_0x515de4(0x15e)]();if(this[_0x515de4(0x12a)]===auth_state_enum_1[_0x515de4(0x15d)][_0x515de4(0x14a)])throw new invalid_refresh_token_error_1[(_0x515de4(0x14c))](errors_1[_0x515de4(0x142)]);await this['updateAccessToken']();}async[a126_0x3d768d(0x124)](){const _0x3f576f=a126_0x3d768d;if(this[_0x3f576f(0x12a)]===auth_state_enum_1[_0x3f576f(0x15d)][_0x3f576f(0x14a)]){this[_0x3f576f(0x145)][_0x3f576f(0x138)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x3f576f(0x12c))]();}if(this[_0x3f576f(0x12a)]!==auth_state_enum_1[_0x3f576f(0x15d)][_0x3f576f(0x140)])return this[_0x3f576f(0x145)][_0x3f576f(0x138)](_0x3f576f(0x14e)),await utils_1[_0x3f576f(0x11c)](this[_0x3f576f(0x129)]),this['waitAuth']();}[a126_0x3d768d(0x165)](){const _0x5ef707=a126_0x3d768d;return{'orgId':this['orgId'],'accessToken':this[_0x5ef707(0x141)],'instanceUrl':this[_0x5ef707(0x15c)]};}async[a126_0x3d768d(0x134)](){const _0x4769aa=a126_0x3d768d;return await this[_0x4769aa(0x124)](),{'baseURL':this[_0x4769aa(0x15c)],'headers':{'accept':'application/json','authorization':this['tokenType']+'\x20'+this[_0x4769aa(0x141)]}};}};function a126_0x598a(_0x190e4b,_0x4dab27){const _0x32db64=a126_0x5ef7();return a126_0x598a=function(_0x49eabb,_0x1be998){_0x49eabb=_0x49eabb-0x11a;let _0x5ef725=_0x32db64[_0x49eabb];return _0x5ef725;},a126_0x598a(_0x190e4b,_0x4dab27);}SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x3d768d(0x11a)](),__metadata(a126_0x3d768d(0x12e),[salesforce_settings_service_1[a126_0x3d768d(0x148)]])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;