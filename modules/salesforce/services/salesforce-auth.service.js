const a126_0x1aca6f=a126_0x3592;(function(_0xb5bbba,_0x5809f7){const _0x2bdd55=a126_0x3592,_0x22d926=_0xb5bbba();while(!![]){try{const _0x4cd58b=-parseInt(_0x2bdd55(0x195))/0x1+parseInt(_0x2bdd55(0x1cc))/0x2*(parseInt(_0x2bdd55(0x1d0))/0x3)+-parseInt(_0x2bdd55(0x19e))/0x4+-parseInt(_0x2bdd55(0x1be))/0x5*(parseInt(_0x2bdd55(0x1a4))/0x6)+-parseInt(_0x2bdd55(0x1cb))/0x7+parseInt(_0x2bdd55(0x1b6))/0x8*(-parseInt(_0x2bdd55(0x1c8))/0x9)+parseInt(_0x2bdd55(0x1a0))/0xa;if(_0x4cd58b===_0x5809f7)break;else _0x22d926['push'](_0x22d926['shift']());}catch(_0x4de988){_0x22d926['push'](_0x22d926['shift']());}}}(a126_0x596c,0xbc45e));const a126_0x334037=(function(){let _0x221431=!![];return function(_0x7b2048,_0x3dd6a4){const _0x46bf35=_0x221431?function(){const _0x2c1e55=a126_0x3592;if(_0x3dd6a4){const _0x277ee3=_0x3dd6a4[_0x2c1e55(0x1c1)](_0x7b2048,arguments);return _0x3dd6a4=null,_0x277ee3;}}:function(){};return _0x221431=![],_0x46bf35;};}()),a126_0x1f18cd=a126_0x334037(this,function(){const _0x2fe358=a126_0x3592;return a126_0x1f18cd['toString']()[_0x2fe358(0x1ac)](_0x2fe358(0x1bd))[_0x2fe358(0x1d8)]()[_0x2fe358(0x1a3)](a126_0x1f18cd)[_0x2fe358(0x1ac)](_0x2fe358(0x1bd));});a126_0x1f18cd();function a126_0x3592(_0x37da6c,_0x28e7b0){const _0x68446c=a126_0x596c();return a126_0x3592=function(_0x1f18cd,_0x334037){_0x1f18cd=_0x1f18cd-0x18f;let _0x596c24=_0x68446c[_0x1f18cd];return _0x596c24;},a126_0x3592(_0x37da6c,_0x28e7b0);}'use strict';var __decorate=this&&this[a126_0x1aca6f(0x1c6)]||function(_0x3e804c,_0x111967,_0x55bd58,_0x24c7fe){const _0x3c8d59=a126_0x1aca6f;var _0x1c8233=arguments['length'],_0x3ac9b7=_0x1c8233<0x3?_0x111967:_0x24c7fe===null?_0x24c7fe=Object[_0x3c8d59(0x1d9)](_0x111967,_0x55bd58):_0x24c7fe,_0x58208a;if(typeof Reflect==='object'&&typeof Reflect[_0x3c8d59(0x1c5)]===_0x3c8d59(0x1df))_0x3ac9b7=Reflect[_0x3c8d59(0x1c5)](_0x3e804c,_0x111967,_0x55bd58,_0x24c7fe);else{for(var _0xf498d7=_0x3e804c[_0x3c8d59(0x1db)]-0x1;_0xf498d7>=0x0;_0xf498d7--)if(_0x58208a=_0x3e804c[_0xf498d7])_0x3ac9b7=(_0x1c8233<0x3?_0x58208a(_0x3ac9b7):_0x1c8233>0x3?_0x58208a(_0x111967,_0x55bd58,_0x3ac9b7):_0x58208a(_0x111967,_0x55bd58))||_0x3ac9b7;}return _0x1c8233>0x3&&_0x3ac9b7&&Object[_0x3c8d59(0x192)](_0x111967,_0x55bd58,_0x3ac9b7),_0x3ac9b7;},__metadata=this&&this[a126_0x1aca6f(0x1a6)]||function(_0x20d628,_0x1002ef){const _0x478d2e=a126_0x1aca6f;if(typeof Reflect==='object'&&typeof Reflect[_0x478d2e(0x197)]===_0x478d2e(0x1df))return Reflect['metadata'](_0x20d628,_0x1002ef);},__importDefault=this&&this[a126_0x1aca6f(0x19d)]||function(_0x4ca923){const _0x3e87be=a126_0x1aca6f;return _0x4ca923&&_0x4ca923[_0x3e87be(0x1b7)]?_0x4ca923:{'default':_0x4ca923};},SalesforceAuthService_1;Object[a126_0x1aca6f(0x192)](exports,a126_0x1aca6f(0x1b7),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;function a126_0x596c(){const _0x4c2d37=['function','../../../constants','Error','services/data/','defineProperty','sleep','getAuthData','1284362gnekXH','../errors/unauthorized-salesforce.error','metadata','access\x20token\x20updated\x20for\x20%s','update\x20access\x20token','tokenType','token_type','settings','__importDefault','720264DsoOvz','logger','43332060vkapaY','catch','../../../core','constructor','6DXdDZG','name','__metadata','AuthState','authState','data','Idle','accessToken','search','design:paramtypes','response','get','Active','SalesforceSettingsService','ERR_INVALID_SALESFORCE_TOKEN','post','orgId','salesforseSettings','432uwwdno','__esModule','error','InvalidRefreshTokenError','SalesforceAuthService','forceUpdateToken','../../shared/services/salesforce-settings.service','(((.+)+)+)+$','3340740jQDbKL','Updating','waitAuth','apply','instanceUrl','../../../constants/errors','requestConfig','decorate','__decorate','force\x20update\x20token','256860XXFojb','updateAccessToken','joinURL','6650063AfZrEj','118XvDfjM','Service','SALESFORCE_API_VERSION','AUTH_WAIT_TIME','53985SCUSxb','default','setAuthDetails','instance_url','Logger','typedi','../errors/invalid-refresh-token.error','log','toString','getOwnPropertyDescriptor','update\x20access\x20token\x20failed:\x20%s','length','loginUrl','access_token','../enums/auth-state.enum'];a126_0x596c=function(){return _0x4c2d37;};return a126_0x596c();}const typedi_1=require(a126_0x1aca6f(0x1d5)),errors_1=require(a126_0x1aca6f(0x1c3)),core_1=require(a126_0x1aca6f(0x1a2)),salesforce_settings_service_1=require(a126_0x1aca6f(0x1bc)),axios_1=__importDefault(require('axios')),utils_1=require('../../shared/utils'),invalid_refresh_token_error_1=require(a126_0x1aca6f(0x1d6)),auth_state_enum_1=require(a126_0x1aca6f(0x1de)),unauthorized_salesforce_error_1=require(a126_0x1aca6f(0x196)),constants_1=require(a126_0x1aca6f(0x18f));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x37ea28){const _0x381727=a126_0x1aca6f;this[_0x381727(0x1b5)]=_0x37ea28,this[_0x381727(0x1cf)]=0x1388,this[_0x381727(0x1a8)]=auth_state_enum_1[_0x381727(0x1a7)]['Idle'],this[_0x381727(0x19f)]=new core_1[(_0x381727(0x1d4))](SalesforceAuthService_1[_0x381727(0x1a5)]),this[_0x381727(0x1d2)]();}get['settings'](){const _0x5081c5=a126_0x1aca6f;return this[_0x5081c5(0x1b5)]['settings'];}async[a126_0x1aca6f(0x1d2)](){const _0x4aae7e=a126_0x1aca6f;this['logger']['log']('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this[_0x4aae7e(0x1a8)]]);try{if(this[_0x4aae7e(0x1a8)]===auth_state_enum_1[_0x4aae7e(0x1a7)][_0x4aae7e(0x190)])return;if(this[_0x4aae7e(0x1a8)]===auth_state_enum_1[_0x4aae7e(0x1a7)]['Idle'])await this[_0x4aae7e(0x1c9)]();else{const _0xb336d=await this[_0x4aae7e(0x1c4)](),_0x38e553=await axios_1[_0x4aae7e(0x1d1)][_0x4aae7e(0x1af)](_0x4aae7e(0x191)+constants_1[_0x4aae7e(0x1ce)],_0xb336d)['then'](()=>!![])[_0x4aae7e(0x1a1)](()=>![]);!_0x38e553&&await this['updateAccessToken']();}}catch(_0x1adcdd){}}async[a126_0x1aca6f(0x1c9)](){const _0x5064ea=a126_0x1aca6f;var _0x5125fc,_0x4e4947,_0x27c037;this[_0x5064ea(0x19f)]['log'](_0x5064ea(0x199));try{this[_0x5064ea(0x1a8)]=auth_state_enum_1[_0x5064ea(0x1a7)][_0x5064ea(0x1bf)];const {refreshToken:_0x52217b,clientId:_0xcec7f5,clientSecret:_0x3fb922}=this[_0x5064ea(0x19c)],{data:_0x42bbb7}=await axios_1[_0x5064ea(0x1d1)][_0x5064ea(0x1b3)](utils_1[_0x5064ea(0x1ca)](this['salesforseSettings'][_0x5064ea(0x1dc)],'/services/oauth2/token'),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x52217b,'client_id':_0xcec7f5,'client_secret':_0x3fb922}});this[_0x5064ea(0x1c2)]=_0x42bbb7[_0x5064ea(0x1d3)],this[_0x5064ea(0x1ab)]=_0x42bbb7[_0x5064ea(0x1dd)],this[_0x5064ea(0x19a)]=_0x42bbb7[_0x5064ea(0x19b)],this[_0x5064ea(0x1a8)]=auth_state_enum_1['AuthState']['Active'],this[_0x5064ea(0x19f)]['log'](_0x5064ea(0x198),this['instanceUrl']);}catch(_0x31ddc2){const _0x12cb90=((_0x4e4947=(_0x5125fc=_0x31ddc2===null||_0x31ddc2===void 0x0?void 0x0:_0x31ddc2[_0x5064ea(0x1ae)])===null||_0x5125fc===void 0x0?void 0x0:_0x5125fc[_0x5064ea(0x1a9)])===null||_0x4e4947===void 0x0?void 0x0:_0x4e4947['error'])||((_0x27c037=_0x31ddc2===null||_0x31ddc2===void 0x0?void 0x0:_0x31ddc2['response'])===null||_0x27c037===void 0x0?void 0x0:_0x27c037['data'])||_0x31ddc2['message'];this[_0x5064ea(0x19f)][_0x5064ea(0x1b8)](_0x5064ea(0x1da),_0x12cb90),this[_0x5064ea(0x1a8)]=auth_state_enum_1['AuthState'][_0x5064ea(0x190)];throw new invalid_refresh_token_error_1[(_0x5064ea(0x1b9))](errors_1[_0x5064ea(0x1b2)]);}}async[a126_0x1aca6f(0x1bb)](){const _0x1a810a=a126_0x1aca6f;this[_0x1a810a(0x19f)][_0x1a810a(0x1d7)](_0x1a810a(0x1c7));if(this[_0x1a810a(0x1a8)]===auth_state_enum_1['AuthState'][_0x1a810a(0x1bf)]||this[_0x1a810a(0x1a8)]===auth_state_enum_1[_0x1a810a(0x1a7)][_0x1a810a(0x1aa)])return await utils_1[_0x1a810a(0x193)](this[_0x1a810a(0x1cf)]),this[_0x1a810a(0x1bb)]();if(this[_0x1a810a(0x1a8)]===auth_state_enum_1[_0x1a810a(0x1a7)][_0x1a810a(0x190)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x1a810a(0x1b2)]);await this['updateAccessToken']();}async[a126_0x1aca6f(0x1c0)](){const _0x1f8439=a126_0x1aca6f;if(this[_0x1f8439(0x1a8)]===auth_state_enum_1[_0x1f8439(0x1a7)][_0x1f8439(0x190)]){this[_0x1f8439(0x19f)][_0x1f8439(0x1d7)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x1f8439(0x1a8)]!==auth_state_enum_1[_0x1f8439(0x1a7)][_0x1f8439(0x1b0)])return this['logger'][_0x1f8439(0x1d7)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x1f8439(0x193)](this['AUTH_WAIT_TIME']),this[_0x1f8439(0x1c0)]();}[a126_0x1aca6f(0x194)](){const _0x13a254=a126_0x1aca6f;return{'orgId':this[_0x13a254(0x1b4)],'accessToken':this[_0x13a254(0x1ab)],'instanceUrl':this[_0x13a254(0x1c2)]};}async[a126_0x1aca6f(0x1c4)](){const _0x512b13=a126_0x1aca6f;return await this[_0x512b13(0x1c0)](),{'baseURL':this['instanceUrl'],'headers':{'accept':'application/json','authorization':this['tokenType']+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x1aca6f(0x1cd)](),__metadata(a126_0x1aca6f(0x1ad),[salesforce_settings_service_1[a126_0x1aca6f(0x1b1)]])],SalesforceAuthService),exports[a126_0x1aca6f(0x1ba)]=SalesforceAuthService;