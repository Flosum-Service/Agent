const a126_0x3c8998=a126_0x4643;function a126_0x17e8(){const _0x558c1e=['Service','authState','55938Dhjify','4620364ayiFcD','access\x20token\x20updated\x20for\x20%s','force\x20update\x20token','loginUrl','520DeWDfd','response','refresh_token','sleep','joinURL','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','ERR_INVALID_SALESFORCE_TOKEN','../../shared/utils','forceUpdateToken','SALESFORCE_API_VERSION','getAuthData','SalesforceAuthService','__metadata','18PGfuif','application/json','980490etRMHh','waitAuth','access_token','instanceUrl','Idle','log','UnauthorizedSalesforceError','89721VWONLK','post','4680684ayFxnk','name','InvalidRefreshTokenError','services/data/','requestConfig','search','(((.+)+)+)+$','update\x20access\x20token\x20failed:\x20%s','settings','Active','AuthState','apply','data','update\x20access\x20token','object','toString','decorate','then','design:paramtypes','../errors/invalid-refresh-token.error','../../shared/services/salesforce-settings.service','867066RDXZCg','../../../constants/errors','orgId','check\x20auth:\x20current\x20state\x20-\x20%s','axios','defineProperty','token_type','updateAccessToken','__esModule','logger','2546596pQZxqR','get','Updating','__decorate','metadata','typedi','default','setAuthDetails','AUTH_WAIT_TIME','salesforseSettings','Logger','function','length','../enums/auth-state.enum','error','accessToken','../errors/unauthorized-salesforce.error','instance_url','Error'];a126_0x17e8=function(){return _0x558c1e;};return a126_0x17e8();}(function(_0x3233f2,_0x4bf11c){const _0x36840e=a126_0x4643,_0xe6a9b4=_0x3233f2();while(!![]){try{const _0x1ac949=-parseInt(_0x36840e(0x164))/0x1*(-parseInt(_0x36840e(0x1a3))/0x2)+-parseInt(_0x36840e(0x184))/0x3+-parseInt(_0x36840e(0x18e))/0x4+parseInt(_0x36840e(0x166))/0x5+parseInt(_0x36840e(0x16f))/0x6+parseInt(_0x36840e(0x1a4))/0x7+-parseInt(_0x36840e(0x1a8))/0x8*(parseInt(_0x36840e(0x16d))/0x9);if(_0x1ac949===_0x4bf11c)break;else _0xe6a9b4['push'](_0xe6a9b4['shift']());}catch(_0x35b1fc){_0xe6a9b4['push'](_0xe6a9b4['shift']());}}}(a126_0x17e8,0x8a322));const a126_0x4d77c9=(function(){let _0x718c0c=!![];return function(_0x361ada,_0x2ac73f){const _0x388d08=_0x718c0c?function(){const _0x53de4a=a126_0x4643;if(_0x2ac73f){const _0x260e3a=_0x2ac73f[_0x53de4a(0x17a)](_0x361ada,arguments);return _0x2ac73f=null,_0x260e3a;}}:function(){};return _0x718c0c=![],_0x388d08;};}()),a126_0x5cf4e3=a126_0x4d77c9(this,function(){const _0x3c47d1=a126_0x4643;return a126_0x5cf4e3[_0x3c47d1(0x17e)]()[_0x3c47d1(0x174)](_0x3c47d1(0x175))['toString']()['constructor'](a126_0x5cf4e3)[_0x3c47d1(0x174)]('(((.+)+)+)+$');});a126_0x5cf4e3();'use strict';var __decorate=this&&this[a126_0x3c8998(0x191)]||function(_0x54fe1f,_0x5c29c2,_0x55586e,_0x8d64e9){const _0x2134c4=a126_0x3c8998;var _0x456da4=arguments['length'],_0x5a0be9=_0x456da4<0x3?_0x5c29c2:_0x8d64e9===null?_0x8d64e9=Object['getOwnPropertyDescriptor'](_0x5c29c2,_0x55586e):_0x8d64e9,_0x371b85;if(typeof Reflect===_0x2134c4(0x17d)&&typeof Reflect[_0x2134c4(0x17f)]==='function')_0x5a0be9=Reflect['decorate'](_0x54fe1f,_0x5c29c2,_0x55586e,_0x8d64e9);else{for(var _0xabdf70=_0x54fe1f[_0x2134c4(0x19a)]-0x1;_0xabdf70>=0x0;_0xabdf70--)if(_0x371b85=_0x54fe1f[_0xabdf70])_0x5a0be9=(_0x456da4<0x3?_0x371b85(_0x5a0be9):_0x456da4>0x3?_0x371b85(_0x5c29c2,_0x55586e,_0x5a0be9):_0x371b85(_0x5c29c2,_0x55586e))||_0x5a0be9;}return _0x456da4>0x3&&_0x5a0be9&&Object[_0x2134c4(0x189)](_0x5c29c2,_0x55586e,_0x5a0be9),_0x5a0be9;},__metadata=this&&this[a126_0x3c8998(0x163)]||function(_0x5e078b,_0x356edf){const _0x3673d8=a126_0x3c8998;if(typeof Reflect===_0x3673d8(0x17d)&&typeof Reflect['metadata']===_0x3673d8(0x199))return Reflect[_0x3673d8(0x192)](_0x5e078b,_0x356edf);},__importDefault=this&&this['__importDefault']||function(_0x13e9e6){const _0x581832=a126_0x3c8998;return _0x13e9e6&&_0x13e9e6[_0x581832(0x18c)]?_0x13e9e6:{'default':_0x13e9e6};},SalesforceAuthService_1;function a126_0x4643(_0x3b5110,_0x2c80b3){const _0xab9d77=a126_0x17e8();return a126_0x4643=function(_0x5cf4e3,_0x4d77c9){_0x5cf4e3=_0x5cf4e3-0x160;let _0x17e8fb=_0xab9d77[_0x5cf4e3];return _0x17e8fb;},a126_0x4643(_0x3b5110,_0x2c80b3);}Object[a126_0x3c8998(0x189)](exports,a126_0x3c8998(0x18c),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require(a126_0x3c8998(0x193)),errors_1=require(a126_0x3c8998(0x185)),core_1=require('../../../core'),salesforce_settings_service_1=require(a126_0x3c8998(0x183)),axios_1=__importDefault(require(a126_0x3c8998(0x188))),utils_1=require(a126_0x3c8998(0x1af)),invalid_refresh_token_error_1=require(a126_0x3c8998(0x182)),auth_state_enum_1=require(a126_0x3c8998(0x19b)),unauthorized_salesforce_error_1=require(a126_0x3c8998(0x19e)),constants_1=require('../../../constants');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x2c4e8c){const _0xd0c635=a126_0x3c8998;this[_0xd0c635(0x197)]=_0x2c4e8c,this[_0xd0c635(0x196)]=0x1388,this[_0xd0c635(0x1a2)]=auth_state_enum_1[_0xd0c635(0x179)]['Idle'],this[_0xd0c635(0x18d)]=new core_1[(_0xd0c635(0x198))](SalesforceAuthService_1[_0xd0c635(0x170)]),this[_0xd0c635(0x195)]();}get[a126_0x3c8998(0x177)](){const _0x38cfab=a126_0x3c8998;return this[_0x38cfab(0x197)][_0x38cfab(0x177)];}async[a126_0x3c8998(0x195)](){const _0x35e184=a126_0x3c8998;this[_0x35e184(0x18d)][_0x35e184(0x16b)](_0x35e184(0x187),auth_state_enum_1[_0x35e184(0x179)][this[_0x35e184(0x1a2)]]);try{if(this['authState']===auth_state_enum_1[_0x35e184(0x179)][_0x35e184(0x1a0)])return;if(this[_0x35e184(0x1a2)]===auth_state_enum_1[_0x35e184(0x179)]['Idle'])await this[_0x35e184(0x18b)]();else{const _0xcb0580=await this[_0x35e184(0x173)](),_0x43b2f4=await axios_1['default'][_0x35e184(0x18f)](_0x35e184(0x172)+constants_1[_0x35e184(0x160)],_0xcb0580)[_0x35e184(0x180)](()=>!![])['catch'](()=>![]);!_0x43b2f4&&await this[_0x35e184(0x18b)]();}}catch(_0x5b9076){}}async[a126_0x3c8998(0x18b)](){const _0x582832=a126_0x3c8998;var _0x2c83d8,_0x116845,_0x1afb40;this[_0x582832(0x18d)][_0x582832(0x16b)](_0x582832(0x17c));try{this[_0x582832(0x1a2)]=auth_state_enum_1['AuthState'][_0x582832(0x190)];const {refreshToken:_0x5b897b,clientId:_0x25215a,clientSecret:_0x543861}=this[_0x582832(0x177)],{data:_0xbeb8aa}=await axios_1[_0x582832(0x194)][_0x582832(0x16e)](utils_1[_0x582832(0x1ac)](this[_0x582832(0x197)][_0x582832(0x1a7)],'/services/oauth2/token'),null,{'params':{'grant_type':_0x582832(0x1aa),'refresh_token':_0x5b897b,'client_id':_0x25215a,'client_secret':_0x543861}});this['instanceUrl']=_0xbeb8aa[_0x582832(0x19f)],this['accessToken']=_0xbeb8aa[_0x582832(0x168)],this['tokenType']=_0xbeb8aa[_0x582832(0x18a)],this['authState']=auth_state_enum_1[_0x582832(0x179)][_0x582832(0x178)],this[_0x582832(0x18d)][_0x582832(0x16b)](_0x582832(0x1a5),this[_0x582832(0x169)]);}catch(_0x2b1a4e){const _0x18f0e5=((_0x116845=(_0x2c83d8=_0x2b1a4e===null||_0x2b1a4e===void 0x0?void 0x0:_0x2b1a4e[_0x582832(0x1a9)])===null||_0x2c83d8===void 0x0?void 0x0:_0x2c83d8[_0x582832(0x17b)])===null||_0x116845===void 0x0?void 0x0:_0x116845[_0x582832(0x19c)])||((_0x1afb40=_0x2b1a4e===null||_0x2b1a4e===void 0x0?void 0x0:_0x2b1a4e[_0x582832(0x1a9)])===null||_0x1afb40===void 0x0?void 0x0:_0x1afb40[_0x582832(0x17b)])||_0x2b1a4e['message'];this['logger'][_0x582832(0x19c)](_0x582832(0x176),_0x18f0e5),this['authState']=auth_state_enum_1[_0x582832(0x179)][_0x582832(0x1a0)];throw new invalid_refresh_token_error_1[(_0x582832(0x171))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a126_0x3c8998(0x1b0)](){const _0x25b885=a126_0x3c8998;this[_0x25b885(0x18d)][_0x25b885(0x16b)](_0x25b885(0x1a6));if(this[_0x25b885(0x1a2)]===auth_state_enum_1[_0x25b885(0x179)]['Updating']||this[_0x25b885(0x1a2)]===auth_state_enum_1[_0x25b885(0x179)][_0x25b885(0x16a)])return await utils_1[_0x25b885(0x1ab)](this[_0x25b885(0x196)]),this[_0x25b885(0x1b0)]();if(this[_0x25b885(0x1a2)]===auth_state_enum_1['AuthState'][_0x25b885(0x1a0)])throw new invalid_refresh_token_error_1[(_0x25b885(0x171))](errors_1[_0x25b885(0x1ae)]);await this[_0x25b885(0x18b)]();}async[a126_0x3c8998(0x167)](){const _0x2cddbf=a126_0x3c8998;if(this[_0x2cddbf(0x1a2)]===auth_state_enum_1['AuthState'][_0x2cddbf(0x1a0)]){this[_0x2cddbf(0x18d)][_0x2cddbf(0x16b)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x2cddbf(0x16c))]();}if(this[_0x2cddbf(0x1a2)]!==auth_state_enum_1['AuthState'][_0x2cddbf(0x178)])return this[_0x2cddbf(0x18d)][_0x2cddbf(0x16b)](_0x2cddbf(0x1ad)),await utils_1[_0x2cddbf(0x1ab)](this[_0x2cddbf(0x196)]),this[_0x2cddbf(0x167)]();}[a126_0x3c8998(0x161)](){const _0x33d7bc=a126_0x3c8998;return{'orgId':this[_0x33d7bc(0x186)],'accessToken':this[_0x33d7bc(0x19d)],'instanceUrl':this[_0x33d7bc(0x169)]};}async[a126_0x3c8998(0x173)](){const _0x298acc=a126_0x3c8998;return await this[_0x298acc(0x167)](),{'baseURL':this[_0x298acc(0x169)],'headers':{'accept':_0x298acc(0x165),'authorization':this['tokenType']+'\x20'+this[_0x298acc(0x19d)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x3c8998(0x1a1)](),__metadata(a126_0x3c8998(0x181),[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a126_0x3c8998(0x162)]=SalesforceAuthService;