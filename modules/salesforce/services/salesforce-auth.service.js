const a126_0x20da36=a126_0x1612;(function(_0x35372d,_0x12a2fc){const _0x18e6e4=a126_0x1612,_0x1d84b9=_0x35372d();while(!![]){try{const _0x5425bc=parseInt(_0x18e6e4(0x18e))/0x1*(parseInt(_0x18e6e4(0x163))/0x2)+-parseInt(_0x18e6e4(0x164))/0x3*(-parseInt(_0x18e6e4(0x173))/0x4)+parseInt(_0x18e6e4(0x15a))/0x5+-parseInt(_0x18e6e4(0x178))/0x6*(parseInt(_0x18e6e4(0x180))/0x7)+-parseInt(_0x18e6e4(0x161))/0x8*(parseInt(_0x18e6e4(0x183))/0x9)+-parseInt(_0x18e6e4(0x152))/0xa*(parseInt(_0x18e6e4(0x16f))/0xb)+parseInt(_0x18e6e4(0x155))/0xc;if(_0x5425bc===_0x12a2fc)break;else _0x1d84b9['push'](_0x1d84b9['shift']());}catch(_0x43eb87){_0x1d84b9['push'](_0x1d84b9['shift']());}}}(a126_0x1f8c,0x7f49b));const a126_0x1f036c=(function(){let _0x4a629f=!![];return function(_0x25e285,_0x136841){const _0xbbc858=_0x4a629f?function(){const _0x2462da=a126_0x1612;if(_0x136841){const _0x8a001e=_0x136841[_0x2462da(0x143)](_0x25e285,arguments);return _0x136841=null,_0x8a001e;}}:function(){};return _0x4a629f=![],_0xbbc858;};}()),a126_0x2449ad=a126_0x1f036c(this,function(){const _0x226f48=a126_0x1612;return a126_0x2449ad[_0x226f48(0x154)]()['search'](_0x226f48(0x14d))[_0x226f48(0x154)]()['constructor'](a126_0x2449ad)[_0x226f48(0x176)]('(((.+)+)+)+$');});a126_0x2449ad();'use strict';var __decorate=this&&this[a126_0x20da36(0x142)]||function(_0x2f171a,_0x471296,_0xe6663b,_0x340b2f){const _0x29a2e0=a126_0x20da36;var _0x1b04e8=arguments[_0x29a2e0(0x16e)],_0x2dbc28=_0x1b04e8<0x3?_0x471296:_0x340b2f===null?_0x340b2f=Object[_0x29a2e0(0x150)](_0x471296,_0xe6663b):_0x340b2f,_0x304f53;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x2dbc28=Reflect['decorate'](_0x2f171a,_0x471296,_0xe6663b,_0x340b2f);else{for(var _0x14b8a2=_0x2f171a[_0x29a2e0(0x16e)]-0x1;_0x14b8a2>=0x0;_0x14b8a2--)if(_0x304f53=_0x2f171a[_0x14b8a2])_0x2dbc28=(_0x1b04e8<0x3?_0x304f53(_0x2dbc28):_0x1b04e8>0x3?_0x304f53(_0x471296,_0xe6663b,_0x2dbc28):_0x304f53(_0x471296,_0xe6663b))||_0x2dbc28;}return _0x1b04e8>0x3&&_0x2dbc28&&Object[_0x29a2e0(0x17f)](_0x471296,_0xe6663b,_0x2dbc28),_0x2dbc28;},__metadata=this&&this[a126_0x20da36(0x162)]||function(_0x3eea41,_0x56692e){const _0x1fcc50=a126_0x20da36;if(typeof Reflect===_0x1fcc50(0x165)&&typeof Reflect[_0x1fcc50(0x185)]==='function')return Reflect[_0x1fcc50(0x185)](_0x3eea41,_0x56692e);},__importDefault=this&&this[a126_0x20da36(0x15c)]||function(_0x45550e){return _0x45550e&&_0x45550e['__esModule']?_0x45550e:{'default':_0x45550e};},SalesforceAuthService_1;function a126_0x1612(_0x526b05,_0x4279e6){const _0x5e45c2=a126_0x1f8c();return a126_0x1612=function(_0x2449ad,_0x1f036c){_0x2449ad=_0x2449ad-0x140;let _0x1f8c88=_0x5e45c2[_0x2449ad];return _0x1f8c88;},a126_0x1612(_0x526b05,_0x4279e6);}Object[a126_0x20da36(0x17f)](exports,a126_0x20da36(0x17c),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require(a126_0x20da36(0x16c)),errors_1=require(a126_0x20da36(0x187)),core_1=require('../../../core'),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a126_0x20da36(0x156))),utils_1=require(a126_0x20da36(0x151)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a126_0x20da36(0x14f)),unauthorized_salesforce_error_1=require(a126_0x20da36(0x141)),constants_1=require(a126_0x20da36(0x15d));function a126_0x1f8c(){const _0x472bc8=['27804lAxLwT','update\x20access\x20token','settings','search','check\x20auth:\x20current\x20state\x20-\x20%s','12rRZnnh','Updating','access_token','loginUrl','__esModule','create\x20authorized\x20request\x20failed:\x20authorization\x20error','catch','defineProperty','1178429SZAJIy','response','log','9QhHCpU','UnauthorizedSalesforceError','metadata','updateAccessToken','../../../constants/errors','services/data/','get','AuthState','requestConfig','InvalidRefreshTokenError','error','103185tTMhbX','logger','ERR_INVALID_SALESFORCE_TOKEN','access\x20token\x20updated\x20for\x20%s','../errors/unauthorized-salesforce.error','__decorate','apply','Error','instanceUrl','forceUpdateToken','Idle','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','update\x20access\x20token\x20failed:\x20%s','/services/oauth2/token','SALESFORCE_API_VERSION','Active','(((.+)+)+)+$','setAuthDetails','../enums/auth-state.enum','getOwnPropertyDescriptor','../../shared/utils','1664620pLuSyH','token_type','toString','3181176aVdjMc','axios','Logger','waitAuth','data','4151645bwtbqY','application/json','__importDefault','../../../constants','AUTH_WAIT_TIME','then','sleep','6927560qWsyIG','__metadata','8eCXAbO','165LLTIPx','object','salesforseSettings','refresh_token','SalesforceAuthService','default','authState','message','typedi','accessToken','length','11ZnnjNc','tokenType','post','Service'];a126_0x1f8c=function(){return _0x472bc8;};return a126_0x1f8c();}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x35d662){const _0x26c653=a126_0x20da36;this[_0x26c653(0x166)]=_0x35d662,this[_0x26c653(0x15e)]=0x1388,this['authState']=auth_state_enum_1['AuthState']['Idle'],this[_0x26c653(0x18f)]=new core_1[(_0x26c653(0x157))](SalesforceAuthService_1['name']),this['setAuthDetails']();}get[a126_0x20da36(0x175)](){const _0x39f4ca=a126_0x20da36;return this['salesforseSettings'][_0x39f4ca(0x175)];}async[a126_0x20da36(0x14e)](){const _0xdb43f4=a126_0x20da36;this[_0xdb43f4(0x18f)][_0xdb43f4(0x182)](_0xdb43f4(0x177),auth_state_enum_1['AuthState'][this[_0xdb43f4(0x16a)]]);try{if(this[_0xdb43f4(0x16a)]===auth_state_enum_1[_0xdb43f4(0x18a)][_0xdb43f4(0x144)])return;if(this[_0xdb43f4(0x16a)]===auth_state_enum_1['AuthState'][_0xdb43f4(0x147)])await this[_0xdb43f4(0x186)]();else{const _0x1138f6=await this[_0xdb43f4(0x18b)](),_0x200126=await axios_1[_0xdb43f4(0x169)][_0xdb43f4(0x189)](_0xdb43f4(0x188)+constants_1[_0xdb43f4(0x14b)],_0x1138f6)[_0xdb43f4(0x15f)](()=>!![])[_0xdb43f4(0x17e)](()=>![]);!_0x200126&&await this[_0xdb43f4(0x186)]();}}catch(_0x87bd12){}}async['updateAccessToken'](){const _0x452727=a126_0x20da36;var _0x214fc2,_0x517694,_0x221dba;this[_0x452727(0x18f)][_0x452727(0x182)](_0x452727(0x174));try{this[_0x452727(0x16a)]=auth_state_enum_1['AuthState'][_0x452727(0x179)];const {refreshToken:_0x3a16cd,clientId:_0x6ed394,clientSecret:_0x36f1e5}=this[_0x452727(0x175)],{data:_0xcaed4a}=await axios_1[_0x452727(0x169)][_0x452727(0x171)](utils_1['joinURL'](this[_0x452727(0x166)][_0x452727(0x17b)],_0x452727(0x14a)),null,{'params':{'grant_type':_0x452727(0x167),'refresh_token':_0x3a16cd,'client_id':_0x6ed394,'client_secret':_0x36f1e5}});this['instanceUrl']=_0xcaed4a['instance_url'],this[_0x452727(0x16d)]=_0xcaed4a[_0x452727(0x17a)],this[_0x452727(0x170)]=_0xcaed4a[_0x452727(0x153)],this[_0x452727(0x16a)]=auth_state_enum_1[_0x452727(0x18a)][_0x452727(0x14c)],this[_0x452727(0x18f)][_0x452727(0x182)](_0x452727(0x140),this[_0x452727(0x145)]);}catch(_0x40e070){const _0x586519=((_0x517694=(_0x214fc2=_0x40e070===null||_0x40e070===void 0x0?void 0x0:_0x40e070['response'])===null||_0x214fc2===void 0x0?void 0x0:_0x214fc2[_0x452727(0x159)])===null||_0x517694===void 0x0?void 0x0:_0x517694[_0x452727(0x18d)])||((_0x221dba=_0x40e070===null||_0x40e070===void 0x0?void 0x0:_0x40e070[_0x452727(0x181)])===null||_0x221dba===void 0x0?void 0x0:_0x221dba['data'])||_0x40e070[_0x452727(0x16b)];this[_0x452727(0x18f)][_0x452727(0x18d)](_0x452727(0x149),_0x586519),this['authState']=auth_state_enum_1[_0x452727(0x18a)]['Error'];throw new invalid_refresh_token_error_1[(_0x452727(0x18c))](errors_1[_0x452727(0x190)]);}}async['forceUpdateToken'](){const _0x289b4e=a126_0x20da36;this['logger'][_0x289b4e(0x182)]('force\x20update\x20token');if(this[_0x289b4e(0x16a)]===auth_state_enum_1[_0x289b4e(0x18a)]['Updating']||this[_0x289b4e(0x16a)]===auth_state_enum_1[_0x289b4e(0x18a)]['Idle'])return await utils_1['sleep'](this[_0x289b4e(0x15e)]),this[_0x289b4e(0x146)]();if(this[_0x289b4e(0x16a)]===auth_state_enum_1[_0x289b4e(0x18a)][_0x289b4e(0x144)])throw new invalid_refresh_token_error_1[(_0x289b4e(0x18c))](errors_1[_0x289b4e(0x190)]);await this['updateAccessToken']();}async[a126_0x20da36(0x158)](){const _0x12d7fb=a126_0x20da36;if(this[_0x12d7fb(0x16a)]===auth_state_enum_1[_0x12d7fb(0x18a)][_0x12d7fb(0x144)]){this['logger'][_0x12d7fb(0x182)](_0x12d7fb(0x17d));throw new unauthorized_salesforce_error_1[(_0x12d7fb(0x184))]();}if(this['authState']!==auth_state_enum_1[_0x12d7fb(0x18a)]['Active'])return this['logger']['log'](_0x12d7fb(0x148)),await utils_1[_0x12d7fb(0x160)](this['AUTH_WAIT_TIME']),this[_0x12d7fb(0x158)]();}['getAuthData'](){const _0x2a0c4b=a126_0x20da36;return{'orgId':this['orgId'],'accessToken':this[_0x2a0c4b(0x16d)],'instanceUrl':this[_0x2a0c4b(0x145)]};}async[a126_0x20da36(0x18b)](){const _0x4d4e51=a126_0x20da36;return await this['waitAuth'](),{'baseURL':this[_0x4d4e51(0x145)],'headers':{'accept':_0x4d4e51(0x15b),'authorization':this[_0x4d4e51(0x170)]+'\x20'+this[_0x4d4e51(0x16d)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x20da36(0x172)](),__metadata('design:paramtypes',[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a126_0x20da36(0x168)]=SalesforceAuthService;