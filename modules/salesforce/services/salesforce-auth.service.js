function a126_0x5f5d(_0x322138,_0xddb4d8){const _0x167fad=a126_0x46bc();return a126_0x5f5d=function(_0xd3d42f,_0xdc84ef){_0xd3d42f=_0xd3d42f-0x16b;let _0x46bcff=_0x167fad[_0xd3d42f];return _0x46bcff;},a126_0x5f5d(_0x322138,_0xddb4d8);}const a126_0x37d4a1=a126_0x5f5d;(function(_0x21f635,_0x45f5c7){const _0xb2bdac=a126_0x5f5d,_0x54abc6=_0x21f635();while(!![]){try{const _0x481b4e=parseInt(_0xb2bdac(0x17e))/0x1+-parseInt(_0xb2bdac(0x19a))/0x2*(parseInt(_0xb2bdac(0x17a))/0x3)+parseInt(_0xb2bdac(0x1ac))/0x4*(parseInt(_0xb2bdac(0x1bb))/0x5)+parseInt(_0xb2bdac(0x1a0))/0x6+-parseInt(_0xb2bdac(0x18f))/0x7+parseInt(_0xb2bdac(0x187))/0x8+-parseInt(_0xb2bdac(0x1a7))/0x9*(parseInt(_0xb2bdac(0x19d))/0xa);if(_0x481b4e===_0x45f5c7)break;else _0x54abc6['push'](_0x54abc6['shift']());}catch(_0x5c3b8f){_0x54abc6['push'](_0x54abc6['shift']());}}}(a126_0x46bc,0x556ac));const a126_0xdc84ef=(function(){let _0x226421=!![];return function(_0x7a74b,_0x3c7fd2){const _0x465cdc=_0x226421?function(){const _0x55b9e4=a126_0x5f5d;if(_0x3c7fd2){const _0x3b8c3=_0x3c7fd2[_0x55b9e4(0x188)](_0x7a74b,arguments);return _0x3c7fd2=null,_0x3b8c3;}}:function(){};return _0x226421=![],_0x465cdc;};}()),a126_0xd3d42f=a126_0xdc84ef(this,function(){const _0x382403=a126_0x5f5d;return a126_0xd3d42f[_0x382403(0x193)]()[_0x382403(0x18a)](_0x382403(0x19f))[_0x382403(0x193)]()[_0x382403(0x191)](a126_0xd3d42f)[_0x382403(0x18a)](_0x382403(0x19f));});a126_0xd3d42f();'use strict';var __decorate=this&&this[a126_0x37d4a1(0x197)]||function(_0x2b7f66,_0xf8af9,_0x13b454,_0x21bb9b){const _0x447181=a126_0x37d4a1;var _0x200a22=arguments[_0x447181(0x181)],_0x5cadb9=_0x200a22<0x3?_0xf8af9:_0x21bb9b===null?_0x21bb9b=Object[_0x447181(0x189)](_0xf8af9,_0x13b454):_0x21bb9b,_0x2c1e35;if(typeof Reflect===_0x447181(0x1b9)&&typeof Reflect[_0x447181(0x177)]===_0x447181(0x190))_0x5cadb9=Reflect[_0x447181(0x177)](_0x2b7f66,_0xf8af9,_0x13b454,_0x21bb9b);else{for(var _0x120dc5=_0x2b7f66[_0x447181(0x181)]-0x1;_0x120dc5>=0x0;_0x120dc5--)if(_0x2c1e35=_0x2b7f66[_0x120dc5])_0x5cadb9=(_0x200a22<0x3?_0x2c1e35(_0x5cadb9):_0x200a22>0x3?_0x2c1e35(_0xf8af9,_0x13b454,_0x5cadb9):_0x2c1e35(_0xf8af9,_0x13b454))||_0x5cadb9;}return _0x200a22>0x3&&_0x5cadb9&&Object[_0x447181(0x174)](_0xf8af9,_0x13b454,_0x5cadb9),_0x5cadb9;},__metadata=this&&this[a126_0x37d4a1(0x1a9)]||function(_0x5a7392,_0x5c1717){const _0x159425=a126_0x37d4a1;if(typeof Reflect===_0x159425(0x1b9)&&typeof Reflect[_0x159425(0x1bc)]===_0x159425(0x190))return Reflect[_0x159425(0x1bc)](_0x5a7392,_0x5c1717);},__importDefault=this&&this[a126_0x37d4a1(0x186)]||function(_0x3ca183){return _0x3ca183&&_0x3ca183['__esModule']?_0x3ca183:{'default':_0x3ca183};},SalesforceAuthService_1;function a126_0x46bc(){const _0x326c35=['Logger','Updating','error','access_token','force\x20update\x20token','updateAccessToken','AUTH_WAIT_TIME','defineProperty','create\x20authorized\x20request\x20failed:\x20authorization\x20error','message','decorate','Idle','services/data/','3xfROSJ','AuthState','SALESFORCE_API_VERSION','instanceUrl','183697inaWMD','design:paramtypes','../../../constants/errors','length','refresh_token','then','loginUrl','settings','__importDefault','5119536oUNLAB','apply','getOwnPropertyDescriptor','search','update\x20access\x20token\x20failed:\x20%s','tokenType','Service','Active','580195zpielZ','function','constructor','authState','toString','default','Error','token_type','__decorate','../../shared/services/salesforce-settings.service','logger','237610bIBOMA','__esModule','SalesforceAuthService','70iNHjgF','get','(((.+)+)+)+$','2707242jhuyFU','salesforseSettings','ERR_INVALID_SALESFORCE_TOKEN','getAuthData','update\x20access\x20token','response','waitAuth','948177qQiWtR','post','__metadata','accessToken','../../shared/utils','56732OTKNYh','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','../../../core','../enums/auth-state.enum','orgId','setAuthDetails','InvalidRefreshTokenError','log','UnauthorizedSalesforceError','data','../errors/unauthorized-salesforce.error','forceUpdateToken','requestConfig','object','instance_url','5ErOmii','metadata','SalesforceSettingsService','sleep'];a126_0x46bc=function(){return _0x326c35;};return a126_0x46bc();}Object[a126_0x37d4a1(0x174)](exports,a126_0x37d4a1(0x19b),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require('typedi'),errors_1=require(a126_0x37d4a1(0x180)),core_1=require(a126_0x37d4a1(0x1ae)),salesforce_settings_service_1=require(a126_0x37d4a1(0x198)),axios_1=__importDefault(require('axios')),utils_1=require(a126_0x37d4a1(0x1ab)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a126_0x37d4a1(0x1af)),unauthorized_salesforce_error_1=require(a126_0x37d4a1(0x1b6)),constants_1=require('../../../constants');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x25b81f){const _0x4df604=a126_0x37d4a1;this[_0x4df604(0x1a1)]=_0x25b81f,this[_0x4df604(0x173)]=0x1388,this[_0x4df604(0x192)]=auth_state_enum_1[_0x4df604(0x17b)][_0x4df604(0x178)],this[_0x4df604(0x199)]=new core_1[(_0x4df604(0x16d))](SalesforceAuthService_1['name']),this[_0x4df604(0x1b1)]();}get[a126_0x37d4a1(0x185)](){const _0x3615a2=a126_0x37d4a1;return this['salesforseSettings'][_0x3615a2(0x185)];}async[a126_0x37d4a1(0x1b1)](){const _0x4aa9cd=a126_0x37d4a1;this[_0x4aa9cd(0x199)][_0x4aa9cd(0x1b3)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x4aa9cd(0x17b)][this['authState']]);try{if(this[_0x4aa9cd(0x192)]===auth_state_enum_1[_0x4aa9cd(0x17b)][_0x4aa9cd(0x195)])return;if(this[_0x4aa9cd(0x192)]===auth_state_enum_1[_0x4aa9cd(0x17b)]['Idle'])await this[_0x4aa9cd(0x172)]();else{const _0x45860a=await this['requestConfig'](),_0x393fb9=await axios_1[_0x4aa9cd(0x194)][_0x4aa9cd(0x19e)](_0x4aa9cd(0x179)+constants_1[_0x4aa9cd(0x17c)],_0x45860a)[_0x4aa9cd(0x183)](()=>!![])['catch'](()=>![]);!_0x393fb9&&await this[_0x4aa9cd(0x172)]();}}catch(_0x400c7f){}}async[a126_0x37d4a1(0x172)](){const _0x3dce4f=a126_0x37d4a1;var _0x2e3841,_0x5b2fe3,_0x28904f;this[_0x3dce4f(0x199)]['log'](_0x3dce4f(0x1a4));try{this[_0x3dce4f(0x192)]=auth_state_enum_1[_0x3dce4f(0x17b)][_0x3dce4f(0x16e)];const {refreshToken:_0x52b62f,clientId:_0x2b5dae,clientSecret:_0x4a66a6}=this[_0x3dce4f(0x185)],{data:_0x4c5073}=await axios_1[_0x3dce4f(0x194)][_0x3dce4f(0x1a8)](utils_1['joinURL'](this['salesforseSettings'][_0x3dce4f(0x184)],'/services/oauth2/token'),null,{'params':{'grant_type':_0x3dce4f(0x182),'refresh_token':_0x52b62f,'client_id':_0x2b5dae,'client_secret':_0x4a66a6}});this[_0x3dce4f(0x17d)]=_0x4c5073[_0x3dce4f(0x1ba)],this['accessToken']=_0x4c5073[_0x3dce4f(0x170)],this[_0x3dce4f(0x18c)]=_0x4c5073[_0x3dce4f(0x196)],this[_0x3dce4f(0x192)]=auth_state_enum_1[_0x3dce4f(0x17b)]['Active'],this[_0x3dce4f(0x199)]['log']('access\x20token\x20updated\x20for\x20%s',this[_0x3dce4f(0x17d)]);}catch(_0x1d2bc9){const _0x16431f=((_0x5b2fe3=(_0x2e3841=_0x1d2bc9===null||_0x1d2bc9===void 0x0?void 0x0:_0x1d2bc9[_0x3dce4f(0x1a5)])===null||_0x2e3841===void 0x0?void 0x0:_0x2e3841[_0x3dce4f(0x1b5)])===null||_0x5b2fe3===void 0x0?void 0x0:_0x5b2fe3[_0x3dce4f(0x16f)])||((_0x28904f=_0x1d2bc9===null||_0x1d2bc9===void 0x0?void 0x0:_0x1d2bc9[_0x3dce4f(0x1a5)])===null||_0x28904f===void 0x0?void 0x0:_0x28904f[_0x3dce4f(0x1b5)])||_0x1d2bc9[_0x3dce4f(0x176)];this[_0x3dce4f(0x199)][_0x3dce4f(0x16f)](_0x3dce4f(0x18b),_0x16431f),this[_0x3dce4f(0x192)]=auth_state_enum_1['AuthState'][_0x3dce4f(0x195)];throw new invalid_refresh_token_error_1[(_0x3dce4f(0x1b2))](errors_1[_0x3dce4f(0x1a2)]);}}async[a126_0x37d4a1(0x1b7)](){const _0x5d16d8=a126_0x37d4a1;this[_0x5d16d8(0x199)]['log'](_0x5d16d8(0x171));if(this['authState']===auth_state_enum_1['AuthState'][_0x5d16d8(0x16e)]||this[_0x5d16d8(0x192)]===auth_state_enum_1['AuthState'][_0x5d16d8(0x178)])return await utils_1[_0x5d16d8(0x16c)](this['AUTH_WAIT_TIME']),this[_0x5d16d8(0x1b7)]();if(this[_0x5d16d8(0x192)]===auth_state_enum_1[_0x5d16d8(0x17b)][_0x5d16d8(0x195)])throw new invalid_refresh_token_error_1[(_0x5d16d8(0x1b2))](errors_1[_0x5d16d8(0x1a2)]);await this[_0x5d16d8(0x172)]();}async['waitAuth'](){const _0x52b2fb=a126_0x37d4a1;if(this['authState']===auth_state_enum_1[_0x52b2fb(0x17b)][_0x52b2fb(0x195)]){this[_0x52b2fb(0x199)][_0x52b2fb(0x1b3)](_0x52b2fb(0x175));throw new unauthorized_salesforce_error_1[(_0x52b2fb(0x1b4))]();}if(this[_0x52b2fb(0x192)]!==auth_state_enum_1['AuthState'][_0x52b2fb(0x18e)])return this[_0x52b2fb(0x199)]['log'](_0x52b2fb(0x1ad)),await utils_1[_0x52b2fb(0x16c)](this['AUTH_WAIT_TIME']),this[_0x52b2fb(0x1a6)]();}[a126_0x37d4a1(0x1a3)](){const _0x34581d=a126_0x37d4a1;return{'orgId':this[_0x34581d(0x1b0)],'accessToken':this['accessToken'],'instanceUrl':this[_0x34581d(0x17d)]};}async[a126_0x37d4a1(0x1b8)](){const _0x2145be=a126_0x37d4a1;return await this[_0x2145be(0x1a6)](),{'baseURL':this[_0x2145be(0x17d)],'headers':{'accept':'application/json','authorization':this[_0x2145be(0x18c)]+'\x20'+this[_0x2145be(0x1aa)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x37d4a1(0x18d)](),__metadata(a126_0x37d4a1(0x17f),[salesforce_settings_service_1[a126_0x37d4a1(0x16b)]])],SalesforceAuthService),exports[a126_0x37d4a1(0x19c)]=SalesforceAuthService;