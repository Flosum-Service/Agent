const a126_0x3b83fd=a126_0x50b2;(function(_0x370b3b,_0x3bd21c){const _0x14cf96=a126_0x50b2,_0x21c68f=_0x370b3b();while(!![]){try{const _0x578c33=parseInt(_0x14cf96(0x136))/0x1+parseInt(_0x14cf96(0x14a))/0x2+-parseInt(_0x14cf96(0x132))/0x3*(-parseInt(_0x14cf96(0x129))/0x4)+parseInt(_0x14cf96(0x11a))/0x5+-parseInt(_0x14cf96(0x118))/0x6+parseInt(_0x14cf96(0x15c))/0x7*(-parseInt(_0x14cf96(0x139))/0x8)+parseInt(_0x14cf96(0x11f))/0x9;if(_0x578c33===_0x3bd21c)break;else _0x21c68f['push'](_0x21c68f['shift']());}catch(_0x413e94){_0x21c68f['push'](_0x21c68f['shift']());}}}(a126_0x4f24,0xdbe1b));const a126_0x40795c=(function(){let _0x46d76e=!![];return function(_0x4f6e6e,_0x45dbc8){const _0x222f48=_0x46d76e?function(){if(_0x45dbc8){const _0x2c564b=_0x45dbc8['apply'](_0x4f6e6e,arguments);return _0x45dbc8=null,_0x2c564b;}}:function(){};return _0x46d76e=![],_0x222f48;};}()),a126_0x63856=a126_0x40795c(this,function(){const _0x5d068b=a126_0x50b2;return a126_0x63856[_0x5d068b(0x161)]()[_0x5d068b(0x15a)](_0x5d068b(0x13b))[_0x5d068b(0x161)]()[_0x5d068b(0x148)](a126_0x63856)['search'](_0x5d068b(0x13b));});a126_0x63856();'use strict';var __decorate=this&&this[a126_0x3b83fd(0x12c)]||function(_0xe10df6,_0xc51f97,_0x5ac7c8,_0x326713){const _0xb91ced=a126_0x3b83fd;var _0x278e5d=arguments['length'],_0x2034e3=_0x278e5d<0x3?_0xc51f97:_0x326713===null?_0x326713=Object['getOwnPropertyDescriptor'](_0xc51f97,_0x5ac7c8):_0x326713,_0xe6a49c;if(typeof Reflect===_0xb91ced(0x133)&&typeof Reflect[_0xb91ced(0x144)]===_0xb91ced(0x12e))_0x2034e3=Reflect[_0xb91ced(0x144)](_0xe10df6,_0xc51f97,_0x5ac7c8,_0x326713);else{for(var _0x196989=_0xe10df6[_0xb91ced(0x123)]-0x1;_0x196989>=0x0;_0x196989--)if(_0xe6a49c=_0xe10df6[_0x196989])_0x2034e3=(_0x278e5d<0x3?_0xe6a49c(_0x2034e3):_0x278e5d>0x3?_0xe6a49c(_0xc51f97,_0x5ac7c8,_0x2034e3):_0xe6a49c(_0xc51f97,_0x5ac7c8))||_0x2034e3;}return _0x278e5d>0x3&&_0x2034e3&&Object[_0xb91ced(0x128)](_0xc51f97,_0x5ac7c8,_0x2034e3),_0x2034e3;},__metadata=this&&this[a126_0x3b83fd(0x127)]||function(_0x54292a,_0x2c0d04){const _0xcb8c39=a126_0x3b83fd;if(typeof Reflect==='object'&&typeof Reflect[_0xcb8c39(0x135)]===_0xcb8c39(0x12e))return Reflect[_0xcb8c39(0x135)](_0x54292a,_0x2c0d04);},__importDefault=this&&this[a126_0x3b83fd(0x115)]||function(_0x3c3f73){const _0x534d30=a126_0x3b83fd;return _0x3c3f73&&_0x3c3f73[_0x534d30(0x137)]?_0x3c3f73:{'default':_0x3c3f73};},SalesforceAuthService_1;Object[a126_0x3b83fd(0x128)](exports,a126_0x3b83fd(0x137),{'value':!![]}),exports[a126_0x3b83fd(0x15b)]=void 0x0;function a126_0x4f24(){const _0x468689=['log','Service','accessToken','get','update\x20access\x20token\x20failed:\x20%s','salesforseSettings','message','SalesforceSettingsService','Logger','ERR_INVALID_SALESFORCE_TOKEN','AuthState','search','SalesforceAuthService','2156133LauKjv','../../../core','AUTH_WAIT_TIME','../../../constants','data','toString','tokenType','instanceUrl','setAuthDetails','__importDefault','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','design:paramtypes','9129438yCOswq','../../shared/services/salesforce-settings.service','689740biotBp','../enums/auth-state.enum','default','post','access_token','4493286obWGly','catch','error','axios','length','check\x20auth:\x20current\x20state\x20-\x20%s','requestConfig','getAuthData','__metadata','defineProperty','8IbbksR','loginUrl','waitAuth','__decorate','response','function','SALESFORCE_API_VERSION','Idle','../errors/invalid-refresh-token.error','843921HNozVc','object','updateAccessToken','metadata','559006EorqOl','__esModule','sleep','24XvxADo','refresh_token','(((.+)+)+)+$','UnauthorizedSalesforceError','joinURL','application/json','logger','../../../constants/errors','InvalidRefreshTokenError','settings','authState','decorate','../../shared/utils','typedi','token_type','constructor','forceUpdateToken','3174886ufitxT','../errors/unauthorized-salesforce.error','access\x20token\x20updated\x20for\x20%s','Updating','Error'];a126_0x4f24=function(){return _0x468689;};return a126_0x4f24();}function a126_0x50b2(_0x33089c,_0x21fd7d){const _0x1049ad=a126_0x4f24();return a126_0x50b2=function(_0x63856,_0x40795c){_0x63856=_0x63856-0x114;let _0x4f24e4=_0x1049ad[_0x63856];return _0x4f24e4;},a126_0x50b2(_0x33089c,_0x21fd7d);}const typedi_1=require(a126_0x3b83fd(0x146)),errors_1=require(a126_0x3b83fd(0x140)),core_1=require(a126_0x3b83fd(0x15d)),salesforce_settings_service_1=require(a126_0x3b83fd(0x119)),axios_1=__importDefault(require(a126_0x3b83fd(0x122))),utils_1=require(a126_0x3b83fd(0x145)),invalid_refresh_token_error_1=require(a126_0x3b83fd(0x131)),auth_state_enum_1=require(a126_0x3b83fd(0x11b)),unauthorized_salesforce_error_1=require(a126_0x3b83fd(0x14b)),constants_1=require(a126_0x3b83fd(0x15f));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x316c0c){const _0x974703=a126_0x3b83fd;this[_0x974703(0x154)]=_0x316c0c,this[_0x974703(0x15e)]=0x1388,this[_0x974703(0x143)]=auth_state_enum_1[_0x974703(0x159)]['Idle'],this[_0x974703(0x13f)]=new core_1[(_0x974703(0x157))](SalesforceAuthService_1['name']),this['setAuthDetails']();}get[a126_0x3b83fd(0x142)](){const _0x2ddb36=a126_0x3b83fd;return this[_0x2ddb36(0x154)][_0x2ddb36(0x142)];}async[a126_0x3b83fd(0x114)](){const _0x5043e2=a126_0x3b83fd;this[_0x5043e2(0x13f)][_0x5043e2(0x14f)](_0x5043e2(0x124),auth_state_enum_1[_0x5043e2(0x159)][this[_0x5043e2(0x143)]]);try{if(this['authState']===auth_state_enum_1[_0x5043e2(0x159)]['Error'])return;if(this[_0x5043e2(0x143)]===auth_state_enum_1[_0x5043e2(0x159)][_0x5043e2(0x130)])await this[_0x5043e2(0x134)]();else{const _0x3d3886=await this[_0x5043e2(0x125)](),_0x4bfe66=await axios_1[_0x5043e2(0x11c)][_0x5043e2(0x152)]('services/data/'+constants_1[_0x5043e2(0x12f)],_0x3d3886)['then'](()=>!![])[_0x5043e2(0x120)](()=>![]);!_0x4bfe66&&await this[_0x5043e2(0x134)]();}}catch(_0x64ce70){}}async[a126_0x3b83fd(0x134)](){const _0x59e350=a126_0x3b83fd;var _0x47b81b,_0x5b16c5,_0x289c93;this[_0x59e350(0x13f)]['log']('update\x20access\x20token');try{this[_0x59e350(0x143)]=auth_state_enum_1['AuthState'][_0x59e350(0x14d)];const {refreshToken:_0x2fb58f,clientId:_0x4e7f3a,clientSecret:_0x1940f1}=this[_0x59e350(0x142)],{data:_0x38e527}=await axios_1[_0x59e350(0x11c)][_0x59e350(0x11d)](utils_1[_0x59e350(0x13d)](this[_0x59e350(0x154)][_0x59e350(0x12a)],'/services/oauth2/token'),null,{'params':{'grant_type':_0x59e350(0x13a),'refresh_token':_0x2fb58f,'client_id':_0x4e7f3a,'client_secret':_0x1940f1}});this[_0x59e350(0x163)]=_0x38e527['instance_url'],this[_0x59e350(0x151)]=_0x38e527[_0x59e350(0x11e)],this[_0x59e350(0x162)]=_0x38e527[_0x59e350(0x147)],this['authState']=auth_state_enum_1['AuthState']['Active'],this[_0x59e350(0x13f)][_0x59e350(0x14f)](_0x59e350(0x14c),this[_0x59e350(0x163)]);}catch(_0x793ea5){const _0x25d237=((_0x5b16c5=(_0x47b81b=_0x793ea5===null||_0x793ea5===void 0x0?void 0x0:_0x793ea5[_0x59e350(0x12d)])===null||_0x47b81b===void 0x0?void 0x0:_0x47b81b[_0x59e350(0x160)])===null||_0x5b16c5===void 0x0?void 0x0:_0x5b16c5[_0x59e350(0x121)])||((_0x289c93=_0x793ea5===null||_0x793ea5===void 0x0?void 0x0:_0x793ea5[_0x59e350(0x12d)])===null||_0x289c93===void 0x0?void 0x0:_0x289c93[_0x59e350(0x160)])||_0x793ea5[_0x59e350(0x155)];this['logger'][_0x59e350(0x121)](_0x59e350(0x153),_0x25d237),this['authState']=auth_state_enum_1[_0x59e350(0x159)][_0x59e350(0x14e)];throw new invalid_refresh_token_error_1[(_0x59e350(0x141))](errors_1[_0x59e350(0x158)]);}}async[a126_0x3b83fd(0x149)](){const _0x189c08=a126_0x3b83fd;this[_0x189c08(0x13f)]['log']('force\x20update\x20token');if(this['authState']===auth_state_enum_1['AuthState']['Updating']||this[_0x189c08(0x143)]===auth_state_enum_1[_0x189c08(0x159)][_0x189c08(0x130)])return await utils_1[_0x189c08(0x138)](this[_0x189c08(0x15e)]),this[_0x189c08(0x149)]();if(this[_0x189c08(0x143)]===auth_state_enum_1['AuthState'][_0x189c08(0x14e)])throw new invalid_refresh_token_error_1[(_0x189c08(0x141))](errors_1[_0x189c08(0x158)]);await this[_0x189c08(0x134)]();}async['waitAuth'](){const _0x5e5377=a126_0x3b83fd;if(this[_0x5e5377(0x143)]===auth_state_enum_1['AuthState']['Error']){this[_0x5e5377(0x13f)][_0x5e5377(0x14f)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x5e5377(0x13c))]();}if(this[_0x5e5377(0x143)]!==auth_state_enum_1['AuthState']['Active'])return this[_0x5e5377(0x13f)][_0x5e5377(0x14f)](_0x5e5377(0x116)),await utils_1[_0x5e5377(0x138)](this[_0x5e5377(0x15e)]),this['waitAuth']();}[a126_0x3b83fd(0x126)](){const _0x878957=a126_0x3b83fd;return{'orgId':this['orgId'],'accessToken':this[_0x878957(0x151)],'instanceUrl':this[_0x878957(0x163)]};}async['requestConfig'](){const _0x16f98c=a126_0x3b83fd;return await this[_0x16f98c(0x12b)](),{'baseURL':this[_0x16f98c(0x163)],'headers':{'accept':_0x16f98c(0x13e),'authorization':this[_0x16f98c(0x162)]+'\x20'+this[_0x16f98c(0x151)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a126_0x3b83fd(0x150)](),__metadata(a126_0x3b83fd(0x117),[salesforce_settings_service_1[a126_0x3b83fd(0x156)]])],SalesforceAuthService),exports[a126_0x3b83fd(0x15b)]=SalesforceAuthService;