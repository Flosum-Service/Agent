const a136_0x1c73f5=a136_0x2862;(function(_0x28366a,_0x21e41c){const _0x1036a2=a136_0x2862,_0x24a6f2=_0x28366a();while(!![]){try{const _0x276fa=-parseInt(_0x1036a2(0x20b))/0x1*(-parseInt(_0x1036a2(0x21a))/0x2)+parseInt(_0x1036a2(0x1d5))/0x3+parseInt(_0x1036a2(0x1c5))/0x4+parseInt(_0x1036a2(0x1fb))/0x5*(parseInt(_0x1036a2(0x219))/0x6)+-parseInt(_0x1036a2(0x207))/0x7*(-parseInt(_0x1036a2(0x206))/0x8)+parseInt(_0x1036a2(0x1c7))/0x9*(parseInt(_0x1036a2(0x1d0))/0xa)+-parseInt(_0x1036a2(0x1d9))/0xb;if(_0x276fa===_0x21e41c)break;else _0x24a6f2['push'](_0x24a6f2['shift']());}catch(_0x525944){_0x24a6f2['push'](_0x24a6f2['shift']());}}}(a136_0x3c31,0x4a03e));const a136_0x304a8b=(function(){let _0x30d9cc=!![];return function(_0x230811,_0x1f7768){const _0x59d264=_0x30d9cc?function(){if(_0x1f7768){const _0x3cb959=_0x1f7768['apply'](_0x230811,arguments);return _0x1f7768=null,_0x3cb959;}}:function(){};return _0x30d9cc=![],_0x59d264;};}()),a136_0x33b4fa=a136_0x304a8b(this,function(){const _0x34680d=a136_0x2862;return a136_0x33b4fa['toString']()[_0x34680d(0x1d1)](_0x34680d(0x1da))[_0x34680d(0x1eb)]()[_0x34680d(0x1fe)](a136_0x33b4fa)['search'](_0x34680d(0x1da));});function a136_0x2862(_0x5bec9f,_0x3a8dc4){const _0x36ae0d=a136_0x3c31();return a136_0x2862=function(_0x33b4fa,_0x304a8b){_0x33b4fa=_0x33b4fa-0x1c5;let _0x3c31ba=_0x36ae0d[_0x33b4fa];return _0x3c31ba;},a136_0x2862(_0x5bec9f,_0x3a8dc4);}a136_0x33b4fa();'use strict';var __decorate=this&&this[a136_0x1c73f5(0x205)]||function(_0x3c87cc,_0x3639ed,_0xddc91e,_0x54752f){const _0x27ab84=a136_0x1c73f5;var _0x400dc0=arguments[_0x27ab84(0x1e3)],_0x35075f=_0x400dc0<0x3?_0x3639ed:_0x54752f===null?_0x54752f=Object[_0x27ab84(0x208)](_0x3639ed,_0xddc91e):_0x54752f,_0x352348;if(typeof Reflect===_0x27ab84(0x1f8)&&typeof Reflect[_0x27ab84(0x1dc)]==='function')_0x35075f=Reflect[_0x27ab84(0x1dc)](_0x3c87cc,_0x3639ed,_0xddc91e,_0x54752f);else{for(var _0x49b9d5=_0x3c87cc[_0x27ab84(0x1e3)]-0x1;_0x49b9d5>=0x0;_0x49b9d5--)if(_0x352348=_0x3c87cc[_0x49b9d5])_0x35075f=(_0x400dc0<0x3?_0x352348(_0x35075f):_0x400dc0>0x3?_0x352348(_0x3639ed,_0xddc91e,_0x35075f):_0x352348(_0x3639ed,_0xddc91e))||_0x35075f;}return _0x400dc0>0x3&&_0x35075f&&Object[_0x27ab84(0x203)](_0x3639ed,_0xddc91e,_0x35075f),_0x35075f;},__metadata=this&&this[a136_0x1c73f5(0x1cf)]||function(_0x36587a,_0x26b7b){const _0x7b63d5=a136_0x1c73f5;if(typeof Reflect===_0x7b63d5(0x1f8)&&typeof Reflect[_0x7b63d5(0x1e9)]===_0x7b63d5(0x1d7))return Reflect[_0x7b63d5(0x1e9)](_0x36587a,_0x26b7b);};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a136_0x1c73f5(0x214)]=void 0x0;function a136_0x3c31(){const _0x55fcd8=['getAttachmentId','constructor','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','../../../constants','FlosumRepositorySyncDto','../../shared/utils','defineProperty','query','__decorate','3711256hiNZJx','7OmevWZ','getOwnPropertyDescriptor','objectId','Components__r','313rcDxDk','SalesforceService','ERR_INVALID_ATTACHMENT_ID','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','getComponentsFromRepository','Branch\x20with\x20Id\x20','updateRemoteState','GET_COMPONENTS_QUERY','salesforceQuery','SalesforceSyncService','%id%','disableSync','objectType','catch','1374YBPIee','3236PqHvSz','getRemoteStateAttachmentId','design:paramtypes','897344bpXMBc','fromRepositoryRecord','117XpUppm','\x20not\x20found\x20on\x20salesforce','%name%','typedi','repositoryId','%parentId%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getBranchRecord','__metadata','338670yLlQEm','search','../dto/flosum-repository-sync.dto','replace','text/plain','1100169yltERi','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','function','encodeBase64','24268178rVWNvI','(((.+)+)+)+$','setStatus','decorate','GET_REPOSITORY_BY_NAME_QUERY','GET_REPOSITORY_QUERY','./salesforce-query.service','FLOSUM_NAMESPACE','getRepositoryRecords','createObject','length','GET_WAITING_REPOSITORIES_QUERY','salesforceService','../../../constants/errors','push','map','metadata','Repository\x20','toString','records','patchObject','\x0a\x20\x20\x20\x20\x20\x20','FLOSUM_GIT_NAMESPACE','./salesforce.service','fromBranchRecord','SYNC_ATTACHMENT_FOR_BRANCH_NAME','SalesforceQueryService','Synchronization_Status__c','GET_BRANCH_BY_NAME_QUERY','getRepositoryRecord','SalesforceNotFoundError','object','Repository\x20with\x20Id\x20','getBranchRecords','11085CgvqwK','Attachment'];a136_0x3c31=function(){return _0x55fcd8;};return a136_0x3c31();}const typedi_1=require(a136_0x1c73f5(0x1ca)),constants_1=require(a136_0x1c73f5(0x200)),errors_1=require(a136_0x1c73f5(0x1e6)),utils_1=require(a136_0x1c73f5(0x202)),flosum_repository_sync_dto_1=require(a136_0x1c73f5(0x1d2)),not_found_error_1=require('../errors/not-found.error'),queries_1=require('../queries'),salesforce_query_service_1=require(a136_0x1c73f5(0x1df)),salesforce_service_1=require(a136_0x1c73f5(0x1f0));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x437b63,_0x141dc6){this['salesforceQuery']=_0x437b63,this['salesforceService']=_0x141dc6;}async['getComponents'](_0x22812c){const _0x1ec705=a136_0x1c73f5;var _0x4e2f64;const _0x1a9395=await this['salesforceQuery'][_0x1ec705(0x204)](_0x22812c),_0x204df1=[];for(const _0x511a39 of _0x1a9395){const _0x20e847=(_0x4e2f64=_0x511a39[constants_1[_0x1ec705(0x1e0)]+_0x1ec705(0x20a)])===null||_0x4e2f64===void 0x0?void 0x0:_0x4e2f64[_0x1ec705(0x1ec)];_0x20e847&&_0x20e847[_0x1ec705(0x1e3)]&&_0x204df1[_0x1ec705(0x1e7)](_0x20e847[0x0]['Id']);}return _0x204df1;}async[a136_0x1c73f5(0x1e1)](){const _0x43afa6=a136_0x1c73f5,_0x3d87a8=await this[_0x43afa6(0x213)]['query'](queries_1[_0x43afa6(0x1e4)]);return _0x3d87a8[_0x43afa6(0x1e8)](_0x4bdf08=>flosum_repository_sync_dto_1[_0x43afa6(0x201)][_0x43afa6(0x1c6)](_0x4bdf08));}async[a136_0x1c73f5(0x1fa)](){const _0x261ac5=a136_0x1c73f5,_0xbe4479=await this[_0x261ac5(0x213)][_0x261ac5(0x204)](queries_1['GET_WAITING_BRANCHES_QUERY']);return _0xbe4479['map'](_0x128e8c=>flosum_repository_sync_dto_1[_0x261ac5(0x201)][_0x261ac5(0x1f1)](_0x128e8c));}async[a136_0x1c73f5(0x1f6)](_0x34ff18){const _0x518abb=a136_0x1c73f5,_0x184da2=await this[_0x518abb(0x213)]['query'](queries_1[_0x518abb(0x1de)]['replace'](_0x518abb(0x215),_0x34ff18));if(_0x184da2[_0x518abb(0x1e3)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x518abb(0x1f9)+_0x34ff18+_0x518abb(0x1c8));return flosum_repository_sync_dto_1[_0x518abb(0x201)][_0x518abb(0x1c6)](_0x184da2[0x0]);}async[a136_0x1c73f5(0x1ce)](_0x1d139f){const _0x32e6c6=a136_0x1c73f5,_0x3f1898=await this['salesforceQuery'][_0x32e6c6(0x204)](queries_1['GET_BRANCH_QUERY'][_0x32e6c6(0x1d3)](_0x32e6c6(0x215),_0x1d139f));if(_0x3f1898[_0x32e6c6(0x1e3)]===0x0)throw new not_found_error_1[(_0x32e6c6(0x1f7))](_0x32e6c6(0x210)+_0x1d139f+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x32e6c6(0x201)][_0x32e6c6(0x1f1)](_0x3f1898[0x0]);}async['getBranchRecordByName'](_0x362a73){const _0x2d893f=a136_0x1c73f5,_0x44e97d=await this[_0x2d893f(0x213)]['query'](queries_1[_0x2d893f(0x1f5)][_0x2d893f(0x1d3)]('%name%',_0x362a73));if(_0x44e97d[_0x2d893f(0x1e3)]===0x0)throw new not_found_error_1[(_0x2d893f(0x1f7))]('Branch\x20'+_0x362a73+_0x2d893f(0x1c8));return flosum_repository_sync_dto_1[_0x2d893f(0x201)]['fromBranchRecord'](_0x44e97d[0x0]);}async['getRepositoryRecordByName'](_0x3b57f7){const _0x42e929=a136_0x1c73f5,_0x1f47e0=await this[_0x42e929(0x213)]['query'](queries_1[_0x42e929(0x1dd)][_0x42e929(0x1d3)](_0x42e929(0x1c9),_0x3b57f7));if(_0x1f47e0[_0x42e929(0x1e3)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x42e929(0x1ea)+_0x3b57f7+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x42e929(0x1c6)](_0x1f47e0[0x0]);}async[a136_0x1c73f5(0x20f)](_0x43110b){const _0x2c1013=a136_0x1c73f5,_0x729c4b=_0x2c1013(0x1ee)+queries_1[_0x2c1013(0x212)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x43110b+'\x27';return this['getComponents'](_0x729c4b);}async['getBranchComponents'](_0x3133a2){const _0x1020a7=a136_0x1c73f5,_0x12a294=_0x1020a7(0x1cd)+queries_1['GET_COMPONENTS_QUERY']+_0x1020a7(0x1ff)+_0x3133a2+'\x27';return this['getComponents'](_0x12a294);}async['getAttachmentId'](_0x17501e){const _0x4f7ae4=a136_0x1c73f5;var _0x5f3667;const _0x5ba221=queries_1[_0x4f7ae4(0x1d6)][_0x4f7ae4(0x1d3)](_0x4f7ae4(0x1cc),_0x17501e[_0x4f7ae4(0x209)])[_0x4f7ae4(0x1d3)](_0x4f7ae4(0x1c9),_0x17501e[_0x4f7ae4(0x1cb)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x4f7ae4(0x1f2)]),_0x2ad099=await this['salesforceQuery'][_0x4f7ae4(0x204)](_0x5ba221),_0x406296=(_0x5f3667=_0x2ad099[0x0])===null||_0x5f3667===void 0x0?void 0x0:_0x5f3667['Id'];if(!_0x406296)throw new Error(errors_1[_0x4f7ae4(0x20d)]);return _0x406296;}async[a136_0x1c73f5(0x21b)](_0x128be6){const _0x12501d=a136_0x1c73f5;let _0x5a5627=await this[_0x12501d(0x1fd)](_0x128be6)[_0x12501d(0x218)](()=>null);return!_0x5a5627&&(_0x5a5627=await this[_0x12501d(0x1e5)][_0x12501d(0x1e2)](_0x12501d(0x1fc),{'Body':utils_1[_0x12501d(0x1d8)]('{}'),'ParentId':_0x128be6[_0x12501d(0x209)],'ContentType':_0x12501d(0x1d4),'Name':_0x128be6['repositoryId']?constants_1[_0x12501d(0x20e)]:constants_1[_0x12501d(0x1f2)]})),_0x5a5627;}async[a136_0x1c73f5(0x211)](_0x3ec9f1,_0x53ec30){const _0x2cdb77=a136_0x1c73f5,_0x14c3f7=await this[_0x2cdb77(0x21b)](_0x3ec9f1);await this[_0x2cdb77(0x1e5)][_0x2cdb77(0x1ed)](_0x2cdb77(0x1fc),_0x14c3f7,{'Body':utils_1[_0x2cdb77(0x1d8)](JSON['stringify'](_0x53ec30))});}async[a136_0x1c73f5(0x1db)](_0x52a339,_0x3ff13c){const _0x3f1427=a136_0x1c73f5;await this[_0x3f1427(0x1e5)]['patchObject'](_0x52a339[_0x3f1427(0x217)],_0x52a339['objectId'],{[constants_1[_0x3f1427(0x1ef)]+_0x3f1427(0x1f4)]:_0x3ff13c});}async[a136_0x1c73f5(0x216)](_0x5491d5){const _0x26398d=a136_0x1c73f5;await this[_0x26398d(0x1e5)][_0x26398d(0x1ed)](constants_1['FLOSUM_GIT_NAMESPACE']+'Git_Settings__c',_0x5491d5,{[constants_1[_0x26398d(0x1ef)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([typedi_1['Service'](),__metadata(a136_0x1c73f5(0x21c),[salesforce_query_service_1[a136_0x1c73f5(0x1f3)],salesforce_service_1[a136_0x1c73f5(0x20c)]])],SalesforceSyncService),exports[a136_0x1c73f5(0x214)]=SalesforceSyncService;