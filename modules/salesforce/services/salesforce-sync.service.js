const a136_0x57f8ba=a136_0x132c;(function(_0x53ad9a,_0x5d5854){const _0x44a14d=a136_0x132c,_0x62c983=_0x53ad9a();while(!![]){try{const _0x15c73e=-parseInt(_0x44a14d(0x208))/0x1*(-parseInt(_0x44a14d(0x1fc))/0x2)+parseInt(_0x44a14d(0x1e7))/0x3*(parseInt(_0x44a14d(0x227))/0x4)+-parseInt(_0x44a14d(0x22d))/0x5*(parseInt(_0x44a14d(0x20d))/0x6)+parseInt(_0x44a14d(0x1ef))/0x7*(parseInt(_0x44a14d(0x222))/0x8)+parseInt(_0x44a14d(0x1ec))/0x9*(parseInt(_0x44a14d(0x1ea))/0xa)+parseInt(_0x44a14d(0x1fe))/0xb+-parseInt(_0x44a14d(0x1f4))/0xc;if(_0x15c73e===_0x5d5854)break;else _0x62c983['push'](_0x62c983['shift']());}catch(_0x1a0b74){_0x62c983['push'](_0x62c983['shift']());}}}(a136_0x38db,0x34c69));function a136_0x38db(){const _0x1632d5=['createObject','function','fromRepositoryRecord','SalesforceSyncService','salesforceService','FlosumRepositorySyncDto','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','Synchronization_Status__c','Attachment','3sKvDrl','SalesforceQueryService','map','16820hCZebc','records','1368ZgWhTA','length','FLOSUM_GIT_NAMESPACE','231vBbTHr','toString','metadata','SYNC_ATTACHMENT_FOR_BRANCH_NAME','getAttachmentId','4767660BnqcMt','object','../../../constants','Service','defineProperty','getBranchComponents','SalesforceService','SalesforceNotFoundError','49834zxqJdv','%id%','3538139RqhRat','getRepositoryRecords','getComponents','../errors/not-found.error','getBranchRecords','catch','repositoryId','getComponentsFromRepository','getRepositoryRecordByName','../../../constants/errors','4xJnDzE','stringify','decorate','./salesforce-query.service','replace','219324BUeeFz','\x20not\x20found\x20on\x20salesforce','query','patchObject','objectType','../../shared/utils','design:paramtypes','objectId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getOwnPropertyDescriptor','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','ERR_INVALID_ATTACHMENT_ID','getRepositoryRecord','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','Repository\x20with\x20Id\x20','__esModule','Repository\x20','updateRemoteState','GET_WAITING_BRANCHES_QUERY','fromBranchRecord','FLOSUM_NAMESPACE','3656XJuufM','getRemoteStateAttachmentId','GET_BRANCH_QUERY','search','__decorate','270512prMmBV','GET_COMPONENTS_QUERY','encodeBase64','apply','%name%','%parentId%','20LShNgc','salesforceQuery','Branch\x20with\x20Id\x20','getBranchRecordByName'];a136_0x38db=function(){return _0x1632d5;};return a136_0x38db();}const a136_0x453264=(function(){let _0x32a66d=!![];return function(_0x48fc1d,_0x4023b3){const _0x1282d0=_0x32a66d?function(){const _0x48f0fd=a136_0x132c;if(_0x4023b3){const _0x15b988=_0x4023b3[_0x48f0fd(0x22a)](_0x48fc1d,arguments);return _0x4023b3=null,_0x15b988;}}:function(){};return _0x32a66d=![],_0x1282d0;};}()),a136_0x46b21c=a136_0x453264(this,function(){const _0x22b43b=a136_0x132c;return a136_0x46b21c[_0x22b43b(0x1f0)]()[_0x22b43b(0x225)]('(((.+)+)+)+$')[_0x22b43b(0x1f0)]()['constructor'](a136_0x46b21c)[_0x22b43b(0x225)]('(((.+)+)+)+$');});a136_0x46b21c();function a136_0x132c(_0x10de22,_0x4655fa){const _0x44041b=a136_0x38db();return a136_0x132c=function(_0x46b21c,_0x453264){_0x46b21c=_0x46b21c-0x1db;let _0x38db2d=_0x44041b[_0x46b21c];return _0x38db2d;},a136_0x132c(_0x10de22,_0x4655fa);}'use strict';var __decorate=this&&this[a136_0x57f8ba(0x226)]||function(_0x460c30,_0xa448d2,_0x19b1e6,_0x51c2f9){const _0x3f0b5e=a136_0x57f8ba;var _0x19d900=arguments[_0x3f0b5e(0x1ed)],_0x5c9cfa=_0x19d900<0x3?_0xa448d2:_0x51c2f9===null?_0x51c2f9=Object[_0x3f0b5e(0x216)](_0xa448d2,_0x19b1e6):_0x51c2f9,_0x437bc9;if(typeof Reflect===_0x3f0b5e(0x1f5)&&typeof Reflect[_0x3f0b5e(0x20a)]==='function')_0x5c9cfa=Reflect[_0x3f0b5e(0x20a)](_0x460c30,_0xa448d2,_0x19b1e6,_0x51c2f9);else{for(var _0x34284a=_0x460c30[_0x3f0b5e(0x1ed)]-0x1;_0x34284a>=0x0;_0x34284a--)if(_0x437bc9=_0x460c30[_0x34284a])_0x5c9cfa=(_0x19d900<0x3?_0x437bc9(_0x5c9cfa):_0x19d900>0x3?_0x437bc9(_0xa448d2,_0x19b1e6,_0x5c9cfa):_0x437bc9(_0xa448d2,_0x19b1e6))||_0x5c9cfa;}return _0x19d900>0x3&&_0x5c9cfa&&Object[_0x3f0b5e(0x1f8)](_0xa448d2,_0x19b1e6,_0x5c9cfa),_0x5c9cfa;},__metadata=this&&this['__metadata']||function(_0x378e07,_0x461295){const _0x1c174c=a136_0x57f8ba;if(typeof Reflect===_0x1c174c(0x1f5)&&typeof Reflect[_0x1c174c(0x1f1)]===_0x1c174c(0x1df))return Reflect[_0x1c174c(0x1f1)](_0x378e07,_0x461295);};Object[a136_0x57f8ba(0x1f8)](exports,a136_0x57f8ba(0x21c),{'value':!![]}),exports[a136_0x57f8ba(0x1e1)]=void 0x0;const typedi_1=require('typedi'),constants_1=require(a136_0x57f8ba(0x1f6)),errors_1=require(a136_0x57f8ba(0x207)),utils_1=require(a136_0x57f8ba(0x212)),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a136_0x57f8ba(0x201)),queries_1=require('../queries'),salesforce_query_service_1=require(a136_0x57f8ba(0x20b)),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0xe15cfc,_0x27a9b7){this['salesforceQuery']=_0xe15cfc,this['salesforceService']=_0x27a9b7;}async[a136_0x57f8ba(0x200)](_0x3eaf95){const _0x378874=a136_0x57f8ba;var _0x57329a;const _0x4c196e=await this[_0x378874(0x1db)][_0x378874(0x20f)](_0x3eaf95),_0x4f0ecf=[];for(const _0x223716 of _0x4c196e){const _0x5b08a9=(_0x57329a=_0x223716[constants_1[_0x378874(0x221)]+'Components__r'])===null||_0x57329a===void 0x0?void 0x0:_0x57329a[_0x378874(0x1eb)];_0x5b08a9&&_0x5b08a9[_0x378874(0x1ed)]&&_0x4f0ecf['push'](_0x5b08a9[0x0]['Id']);}return _0x4f0ecf;}async[a136_0x57f8ba(0x1ff)](){const _0x5f0ece=a136_0x57f8ba,_0x5d64a4=await this['salesforceQuery'][_0x5f0ece(0x20f)](queries_1['GET_WAITING_REPOSITORIES_QUERY']);return _0x5d64a4[_0x5f0ece(0x1e9)](_0x486043=>flosum_repository_sync_dto_1[_0x5f0ece(0x1e3)][_0x5f0ece(0x1e0)](_0x486043));}async[a136_0x57f8ba(0x202)](){const _0x1592f4=a136_0x57f8ba,_0x71c605=await this[_0x1592f4(0x1db)][_0x1592f4(0x20f)](queries_1[_0x1592f4(0x21f)]);return _0x71c605['map'](_0x6e7503=>flosum_repository_sync_dto_1[_0x1592f4(0x1e3)][_0x1592f4(0x220)](_0x6e7503));}async[a136_0x57f8ba(0x219)](_0x329155){const _0x125ec2=a136_0x57f8ba,_0x21fe75=await this[_0x125ec2(0x1db)]['query'](queries_1['GET_REPOSITORY_QUERY']['replace'](_0x125ec2(0x1fd),_0x329155));if(_0x21fe75[_0x125ec2(0x1ed)]===0x0)throw new not_found_error_1[(_0x125ec2(0x1fb))](_0x125ec2(0x21b)+_0x329155+_0x125ec2(0x20e));return flosum_repository_sync_dto_1[_0x125ec2(0x1e3)][_0x125ec2(0x1e0)](_0x21fe75[0x0]);}async['getBranchRecord'](_0xf33036){const _0x55c1b3=a136_0x57f8ba,_0x20a323=await this[_0x55c1b3(0x1db)][_0x55c1b3(0x20f)](queries_1[_0x55c1b3(0x224)]['replace'](_0x55c1b3(0x1fd),_0xf33036));if(_0x20a323[_0x55c1b3(0x1ed)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x55c1b3(0x1dc)+_0xf33036+_0x55c1b3(0x20e));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x55c1b3(0x220)](_0x20a323[0x0]);}async[a136_0x57f8ba(0x1dd)](_0x3bbaa6){const _0x4512bf=a136_0x57f8ba,_0x3f269f=await this['salesforceQuery'][_0x4512bf(0x20f)](queries_1['GET_BRANCH_BY_NAME_QUERY'][_0x4512bf(0x20c)](_0x4512bf(0x22b),_0x3bbaa6));if(_0x3f269f['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20'+_0x3bbaa6+_0x4512bf(0x20e));return flosum_repository_sync_dto_1[_0x4512bf(0x1e3)][_0x4512bf(0x220)](_0x3f269f[0x0]);}async[a136_0x57f8ba(0x206)](_0x443c51){const _0x44fbc1=a136_0x57f8ba,_0x34d25f=await this['salesforceQuery']['query'](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x44fbc1(0x20c)]('%name%',_0x443c51));if(_0x34d25f[_0x44fbc1(0x1ed)]===0x0)throw new not_found_error_1[(_0x44fbc1(0x1fb))](_0x44fbc1(0x21d)+_0x443c51+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x44fbc1(0x1e3)][_0x44fbc1(0x1e0)](_0x34d25f[0x0]);}async[a136_0x57f8ba(0x205)](_0x39c464){const _0x4ff5e3=a136_0x57f8ba,_0x18f3e0='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x4ff5e3(0x228)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x39c464+'\x27';return this[_0x4ff5e3(0x200)](_0x18f3e0);}async[a136_0x57f8ba(0x1f9)](_0x17d779){const _0x405cbf=a136_0x57f8ba,_0x9950da=_0x405cbf(0x215)+queries_1[_0x405cbf(0x228)]+_0x405cbf(0x217)+_0x17d779+'\x27';return this[_0x405cbf(0x200)](_0x9950da);}async[a136_0x57f8ba(0x1f3)](_0x18bbb7){const _0xa4016f=a136_0x57f8ba;var _0x4bda59;const _0x99bae1=queries_1[_0xa4016f(0x1e4)][_0xa4016f(0x20c)](_0xa4016f(0x22c),_0x18bbb7[_0xa4016f(0x214)])[_0xa4016f(0x20c)](_0xa4016f(0x22b),_0x18bbb7[_0xa4016f(0x204)]?constants_1[_0xa4016f(0x21a)]:constants_1[_0xa4016f(0x1f2)]),_0x5ac99b=await this['salesforceQuery'][_0xa4016f(0x20f)](_0x99bae1),_0x278824=(_0x4bda59=_0x5ac99b[0x0])===null||_0x4bda59===void 0x0?void 0x0:_0x4bda59['Id'];if(!_0x278824)throw new Error(errors_1[_0xa4016f(0x218)]);return _0x278824;}async[a136_0x57f8ba(0x223)](_0xeb2172){const _0x44d5ab=a136_0x57f8ba;let _0x20bb15=await this[_0x44d5ab(0x1f3)](_0xeb2172)[_0x44d5ab(0x203)](()=>null);return!_0x20bb15&&(_0x20bb15=await this[_0x44d5ab(0x1e2)][_0x44d5ab(0x1de)](_0x44d5ab(0x1e6),{'Body':utils_1[_0x44d5ab(0x229)]('{}'),'ParentId':_0xeb2172[_0x44d5ab(0x214)],'ContentType':'text/plain','Name':_0xeb2172[_0x44d5ab(0x204)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x20bb15;}async[a136_0x57f8ba(0x21e)](_0x217b24,_0x20e173){const _0x16a447=a136_0x57f8ba,_0x270cfb=await this[_0x16a447(0x223)](_0x217b24);await this[_0x16a447(0x1e2)]['patchObject'](_0x16a447(0x1e6),_0x270cfb,{'Body':utils_1['encodeBase64'](JSON[_0x16a447(0x209)](_0x20e173))});}async['setStatus'](_0x258374,_0x41e5ea){const _0x59d551=a136_0x57f8ba;await this['salesforceService'][_0x59d551(0x210)](_0x258374[_0x59d551(0x211)],_0x258374['objectId'],{[constants_1[_0x59d551(0x1ee)]+_0x59d551(0x1e5)]:_0x41e5ea});}async['disableSync'](_0x4aedca){const _0x3037e3=a136_0x57f8ba;await this[_0x3037e3(0x1e2)][_0x3037e3(0x210)](constants_1[_0x3037e3(0x1ee)]+'Git_Settings__c',_0x4aedca,{[constants_1[_0x3037e3(0x1ee)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([typedi_1[a136_0x57f8ba(0x1f7)](),__metadata(a136_0x57f8ba(0x213),[salesforce_query_service_1[a136_0x57f8ba(0x1e8)],salesforce_service_1[a136_0x57f8ba(0x1fa)]])],SalesforceSyncService),exports[a136_0x57f8ba(0x1e1)]=SalesforceSyncService;