const a136_0x5d186f=a136_0x45c8;(function(_0x1e84ac,_0x6335a3){const _0x436f8f=a136_0x45c8,_0x3702c1=_0x1e84ac();while(!![]){try{const _0x59a761=parseInt(_0x436f8f(0x200))/0x1+-parseInt(_0x436f8f(0x1fa))/0x2+parseInt(_0x436f8f(0x1cb))/0x3*(parseInt(_0x436f8f(0x1f3))/0x4)+parseInt(_0x436f8f(0x1da))/0x5+-parseInt(_0x436f8f(0x1fc))/0x6+-parseInt(_0x436f8f(0x1f2))/0x7*(-parseInt(_0x436f8f(0x20e))/0x8)+parseInt(_0x436f8f(0x204))/0x9;if(_0x59a761===_0x6335a3)break;else _0x3702c1['push'](_0x3702c1['shift']());}catch(_0x5de377){_0x3702c1['push'](_0x3702c1['shift']());}}}(a136_0x3aab,0x56d77));const a136_0x47ac7a=(function(){let _0xbdcf79=!![];return function(_0x127a0e,_0x27a564){const _0x4d5e86=_0xbdcf79?function(){const _0x50a0fe=a136_0x45c8;if(_0x27a564){const _0x161761=_0x27a564[_0x50a0fe(0x210)](_0x127a0e,arguments);return _0x27a564=null,_0x161761;}}:function(){};return _0xbdcf79=![],_0x4d5e86;};}()),a136_0x43716e=a136_0x47ac7a(this,function(){const _0x57aabf=a136_0x45c8;return a136_0x43716e[_0x57aabf(0x203)]()[_0x57aabf(0x1f6)](_0x57aabf(0x208))[_0x57aabf(0x203)]()[_0x57aabf(0x1cd)](a136_0x43716e)['search'](_0x57aabf(0x208));});a136_0x43716e();'use strict';var __decorate=this&&this[a136_0x5d186f(0x20d)]||function(_0x198531,_0x4b0b4c,_0x3a0c34,_0x5968fb){const _0x569627=a136_0x5d186f;var _0x40de27=arguments['length'],_0x37912f=_0x40de27<0x3?_0x4b0b4c:_0x5968fb===null?_0x5968fb=Object['getOwnPropertyDescriptor'](_0x4b0b4c,_0x3a0c34):_0x5968fb,_0x58cc5d;if(typeof Reflect==='object'&&typeof Reflect[_0x569627(0x1ec)]===_0x569627(0x1e6))_0x37912f=Reflect[_0x569627(0x1ec)](_0x198531,_0x4b0b4c,_0x3a0c34,_0x5968fb);else{for(var _0x11347a=_0x198531[_0x569627(0x1e0)]-0x1;_0x11347a>=0x0;_0x11347a--)if(_0x58cc5d=_0x198531[_0x11347a])_0x37912f=(_0x40de27<0x3?_0x58cc5d(_0x37912f):_0x40de27>0x3?_0x58cc5d(_0x4b0b4c,_0x3a0c34,_0x37912f):_0x58cc5d(_0x4b0b4c,_0x3a0c34))||_0x37912f;}return _0x40de27>0x3&&_0x37912f&&Object['defineProperty'](_0x4b0b4c,_0x3a0c34,_0x37912f),_0x37912f;},__metadata=this&&this[a136_0x5d186f(0x1c4)]||function(_0x5e1227,_0x49931b){const _0x1b21fc=a136_0x5d186f;if(typeof Reflect===_0x1b21fc(0x1f9)&&typeof Reflect[_0x1b21fc(0x209)]===_0x1b21fc(0x1e6))return Reflect[_0x1b21fc(0x209)](_0x5e1227,_0x49931b);};function a136_0x45c8(_0x234eac,_0x37e9b1){const _0x10c448=a136_0x3aab();return a136_0x45c8=function(_0x43716e,_0x47ac7a){_0x43716e=_0x43716e-0x1c0;let _0x3aabd0=_0x10c448[_0x43716e];return _0x3aabd0;},a136_0x45c8(_0x234eac,_0x37e9b1);}function a136_0x3aab(){const _0x5a4a36=['\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','Service','3kCYaKE','GET_WAITING_REPOSITORIES_QUERY','constructor','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','Branch\x20','Attachment','records','fromRepositoryRecord','objectId','updateRemoteState','map','FlosumRepositorySyncDto','Branch\x20with\x20Id\x20','FLOSUM_GIT_NAMESPACE','../../../constants/errors','277730cGSryN','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','%id%','repositoryId','\x0a\x20\x20\x20\x20\x20\x20','SalesforceSyncService','length','../dto/flosum-repository-sync.dto','Components__r','getRemoteStateAttachmentId','encodeBase64','\x20not\x20found\x20on\x20salesforce','function','ERR_INVALID_ATTACHMENT_ID','../../shared/utils','Repository\x20','%name%','GET_WAITING_BRANCHES_QUERY','decorate','patchObject','getBranchRecord','design:paramtypes','Repository\x20with\x20Id\x20','getBranchRecords','185332sJVwvw','104632IiVZuu','typedi','replace','search','GET_BRANCH_BY_NAME_QUERY','query','object','930300kujtnq','../../../constants','2576526GTgPYl','FLOSUM_NAMESPACE','SYNC_ATTACHMENT_FOR_BRANCH_NAME','createObject','702531HNzKdE','../queries','salesforceService','toString','143523PNyXpm','GET_BRANCH_QUERY','salesforceQuery','SalesforceService','(((.+)+)+)+$','metadata','catch','Synchronization_Status__c','../errors/not-found.error','__decorate','136atAzAW','getBranchComponents','apply','text/plain','stringify','getRepositoryRecords','getComponents','getAttachmentId','__metadata','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','getComponentsFromRepository','GET_COMPONENTS_QUERY','SalesforceNotFoundError'];a136_0x3aab=function(){return _0x5a4a36;};return a136_0x3aab();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a136_0x5d186f(0x1df)]=void 0x0;const typedi_1=require(a136_0x5d186f(0x1f4)),constants_1=require(a136_0x5d186f(0x1fb)),errors_1=require(a136_0x5d186f(0x1d9)),utils_1=require(a136_0x5d186f(0x1e8)),flosum_repository_sync_dto_1=require(a136_0x5d186f(0x1e1)),not_found_error_1=require(a136_0x5d186f(0x20c)),queries_1=require(a136_0x5d186f(0x201)),salesforce_query_service_1=require('./salesforce-query.service'),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0x2ea4ec,_0x14c0f3){const _0x210fc7=a136_0x5d186f;this[_0x210fc7(0x206)]=_0x2ea4ec,this[_0x210fc7(0x202)]=_0x14c0f3;}async[a136_0x5d186f(0x1c2)](_0x2ea833){const _0x3b0107=a136_0x5d186f;var _0x214b0d;const _0x581717=await this[_0x3b0107(0x206)][_0x3b0107(0x1f8)](_0x2ea833),_0x350912=[];for(const _0x594a18 of _0x581717){const _0x46ddc8=(_0x214b0d=_0x594a18[constants_1[_0x3b0107(0x1fd)]+_0x3b0107(0x1e2)])===null||_0x214b0d===void 0x0?void 0x0:_0x214b0d[_0x3b0107(0x1d1)];_0x46ddc8&&_0x46ddc8[_0x3b0107(0x1e0)]&&_0x350912['push'](_0x46ddc8[0x0]['Id']);}return _0x350912;}async[a136_0x5d186f(0x1c1)](){const _0x9cc900=a136_0x5d186f,_0x39303d=await this[_0x9cc900(0x206)][_0x9cc900(0x1f8)](queries_1[_0x9cc900(0x1cc)]);return _0x39303d[_0x9cc900(0x1d5)](_0x4594d7=>flosum_repository_sync_dto_1[_0x9cc900(0x1d6)][_0x9cc900(0x1d2)](_0x4594d7));}async[a136_0x5d186f(0x1f1)](){const _0x2ac4a3=a136_0x5d186f,_0x3537b7=await this[_0x2ac4a3(0x206)][_0x2ac4a3(0x1f8)](queries_1[_0x2ac4a3(0x1eb)]);return _0x3537b7['map'](_0x378848=>flosum_repository_sync_dto_1[_0x2ac4a3(0x1d6)]['fromBranchRecord'](_0x378848));}async['getRepositoryRecord'](_0x2cfc76){const _0x447080=a136_0x5d186f,_0x58be97=await this[_0x447080(0x206)]['query'](queries_1['GET_REPOSITORY_QUERY'][_0x447080(0x1f5)](_0x447080(0x1dc),_0x2cfc76));if(_0x58be97[_0x447080(0x1e0)]===0x0)throw new not_found_error_1[(_0x447080(0x1c8))](_0x447080(0x1f0)+_0x2cfc76+_0x447080(0x1e5));return flosum_repository_sync_dto_1[_0x447080(0x1d6)][_0x447080(0x1d2)](_0x58be97[0x0]);}async[a136_0x5d186f(0x1ee)](_0x582946){const _0x4d0fd1=a136_0x5d186f,_0x48a296=await this['salesforceQuery']['query'](queries_1[_0x4d0fd1(0x205)][_0x4d0fd1(0x1f5)](_0x4d0fd1(0x1dc),_0x582946));if(_0x48a296[_0x4d0fd1(0x1e0)]===0x0)throw new not_found_error_1[(_0x4d0fd1(0x1c8))](_0x4d0fd1(0x1d7)+_0x582946+_0x4d0fd1(0x1e5));return flosum_repository_sync_dto_1[_0x4d0fd1(0x1d6)]['fromBranchRecord'](_0x48a296[0x0]);}async['getBranchRecordByName'](_0x21653e){const _0x2b9348=a136_0x5d186f,_0x195cd0=await this[_0x2b9348(0x206)][_0x2b9348(0x1f8)](queries_1[_0x2b9348(0x1f7)][_0x2b9348(0x1f5)](_0x2b9348(0x1ea),_0x21653e));if(_0x195cd0[_0x2b9348(0x1e0)]===0x0)throw new not_found_error_1[(_0x2b9348(0x1c8))](_0x2b9348(0x1cf)+_0x21653e+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x2b9348(0x1d6)]['fromBranchRecord'](_0x195cd0[0x0]);}async['getRepositoryRecordByName'](_0x17ae3c){const _0x4a3488=a136_0x5d186f,_0x8a86cc=await this[_0x4a3488(0x206)][_0x4a3488(0x1f8)](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x4a3488(0x1f5)]('%name%',_0x17ae3c));if(_0x8a86cc[_0x4a3488(0x1e0)]===0x0)throw new not_found_error_1[(_0x4a3488(0x1c8))](_0x4a3488(0x1e9)+_0x17ae3c+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x4a3488(0x1d2)](_0x8a86cc[0x0]);}async[a136_0x5d186f(0x1c6)](_0x1dfdb3){const _0x35549e=a136_0x5d186f,_0x3d907e=_0x35549e(0x1de)+queries_1[_0x35549e(0x1c7)]+_0x35549e(0x1c9)+_0x1dfdb3+'\x27';return this[_0x35549e(0x1c2)](_0x3d907e);}async[a136_0x5d186f(0x20f)](_0x4df634){const _0x478d70=a136_0x5d186f,_0x5c177a='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x478d70(0x1c7)]+_0x478d70(0x1c5)+_0x4df634+'\x27';return this[_0x478d70(0x1c2)](_0x5c177a);}async[a136_0x5d186f(0x1c3)](_0x1669ce){const _0x77d006=a136_0x5d186f;var _0x1c35f9;const _0x4540b3=queries_1[_0x77d006(0x1ce)][_0x77d006(0x1f5)]('%parentId%',_0x1669ce[_0x77d006(0x1d3)])[_0x77d006(0x1f5)](_0x77d006(0x1ea),_0x1669ce[_0x77d006(0x1dd)]?constants_1[_0x77d006(0x1db)]:constants_1[_0x77d006(0x1fe)]),_0x41b6e3=await this[_0x77d006(0x206)][_0x77d006(0x1f8)](_0x4540b3),_0x44368e=(_0x1c35f9=_0x41b6e3[0x0])===null||_0x1c35f9===void 0x0?void 0x0:_0x1c35f9['Id'];if(!_0x44368e)throw new Error(errors_1[_0x77d006(0x1e7)]);return _0x44368e;}async[a136_0x5d186f(0x1e3)](_0x23ddbc){const _0x11c79e=a136_0x5d186f;let _0x5dd683=await this['getAttachmentId'](_0x23ddbc)[_0x11c79e(0x20a)](()=>null);return!_0x5dd683&&(_0x5dd683=await this[_0x11c79e(0x202)][_0x11c79e(0x1ff)](_0x11c79e(0x1d0),{'Body':utils_1['encodeBase64']('{}'),'ParentId':_0x23ddbc[_0x11c79e(0x1d3)],'ContentType':_0x11c79e(0x211),'Name':_0x23ddbc[_0x11c79e(0x1dd)]?constants_1[_0x11c79e(0x1db)]:constants_1[_0x11c79e(0x1fe)]})),_0x5dd683;}async[a136_0x5d186f(0x1d4)](_0x130edb,_0x19c6e7){const _0x38bba4=a136_0x5d186f,_0x42de14=await this[_0x38bba4(0x1e3)](_0x130edb);await this[_0x38bba4(0x202)][_0x38bba4(0x1ed)](_0x38bba4(0x1d0),_0x42de14,{'Body':utils_1[_0x38bba4(0x1e4)](JSON[_0x38bba4(0x1c0)](_0x19c6e7))});}async['setStatus'](_0x175f16,_0x268c47){const _0x3dc466=a136_0x5d186f;await this[_0x3dc466(0x202)][_0x3dc466(0x1ed)](_0x175f16['objectType'],_0x175f16[_0x3dc466(0x1d3)],{[constants_1[_0x3dc466(0x1d8)]+_0x3dc466(0x20b)]:_0x268c47});}async['disableSync'](_0x1fbbed){const _0x2fbf3d=a136_0x5d186f;await this[_0x2fbf3d(0x202)]['patchObject'](constants_1[_0x2fbf3d(0x1d8)]+'Git_Settings__c',_0x1fbbed,{[constants_1[_0x2fbf3d(0x1d8)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([typedi_1[a136_0x5d186f(0x1ca)](),__metadata(a136_0x5d186f(0x1ef),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a136_0x5d186f(0x207)]])],SalesforceSyncService),exports[a136_0x5d186f(0x1df)]=SalesforceSyncService;