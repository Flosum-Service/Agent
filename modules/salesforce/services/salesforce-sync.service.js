const a136_0xd8512f=a136_0x3302;(function(_0x15e1da,_0x845c22){const _0x5e9127=a136_0x3302,_0x11196a=_0x15e1da();while(!![]){try{const _0x194668=parseInt(_0x5e9127(0x128))/0x1*(-parseInt(_0x5e9127(0x150))/0x2)+parseInt(_0x5e9127(0x156))/0x3*(parseInt(_0x5e9127(0x120))/0x4)+parseInt(_0x5e9127(0x139))/0x5*(-parseInt(_0x5e9127(0x113))/0x6)+parseInt(_0x5e9127(0x131))/0x7*(-parseInt(_0x5e9127(0x118))/0x8)+parseInt(_0x5e9127(0x129))/0x9+-parseInt(_0x5e9127(0x14c))/0xa+parseInt(_0x5e9127(0x15a))/0xb;if(_0x194668===_0x845c22)break;else _0x11196a['push'](_0x11196a['shift']());}catch(_0x2ade3b){_0x11196a['push'](_0x11196a['shift']());}}}(a136_0x6efa,0xb78be));const a136_0x5a39cd=(function(){let _0x3edaac=!![];return function(_0x432684,_0x351aca){const _0x1577f2=_0x3edaac?function(){const _0x232a43=a136_0x3302;if(_0x351aca){const _0x456aae=_0x351aca[_0x232a43(0x13b)](_0x432684,arguments);return _0x351aca=null,_0x456aae;}}:function(){};return _0x3edaac=![],_0x1577f2;};}()),a136_0x88192e=a136_0x5a39cd(this,function(){const _0x21490a=a136_0x3302;return a136_0x88192e['toString']()[_0x21490a(0x148)](_0x21490a(0x142))[_0x21490a(0x13e)]()[_0x21490a(0x157)](a136_0x88192e)[_0x21490a(0x148)](_0x21490a(0x142));});function a136_0x6efa(){const _0x3cc887=['SalesforceNotFoundError','text/plain','\x20not\x20found\x20on\x20salesforce','1316856OSRnrR','design:paramtypes','length','%id%','fromRepositoryRecord','10168808AeOIKU','catch','function','__decorate','replace','GET_WAITING_REPOSITORIES_QUERY','getRemoteStateAttachmentId','FLOSUM_NAMESPACE','553928CmRHQg','encodeBase64','../../shared/utils','getOwnPropertyDescriptor','fromBranchRecord','getBranchRecordByName','getComponents','getBranchRecords','30UnBSRH','12266658RrmcOT','FlosumRepositorySyncDto','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','getRepositoryRecords','GET_COMPONENTS_QUERY','createObject','Synchronization_Status__c','defineProperty','7xVFVoF','push','GET_WAITING_BRANCHES_QUERY','updateRemoteState','__metadata','./salesforce-query.service','\x0a\x20\x20\x20\x20\x20\x20','salesforceService','25vXelNJ','GET_BRANCH_BY_NAME_QUERY','apply','object','GET_REPOSITORY_QUERY','toString','Branch\x20','ERR_INVALID_ATTACHMENT_ID','records','(((.+)+)+)+$','../dto/flosum-repository-sync.dto','repositoryId','getAttachmentId','Service','SalesforceQueryService','search','getBranchComponents','patchObject','FLOSUM_GIT_NAMESPACE','3757590IjdVfC','Git_Settings__c','Repository\x20with\x20Id\x20','../queries','53190sqYzbz','getRepositoryRecordByName','../errors/not-found.error','Sync_In_Progress__c','map','objectId','24kejQfY','constructor','decorate','disableSync','20053858DzpOUF','metadata','%name%','GET_BRANCH_QUERY','query','getBranchRecord','salesforceQuery','./salesforce.service','SalesforceSyncService'];a136_0x6efa=function(){return _0x3cc887;};return a136_0x6efa();}a136_0x88192e();'use strict';function a136_0x3302(_0x891066,_0x37702d){const _0x3dd9d2=a136_0x6efa();return a136_0x3302=function(_0x88192e,_0x5a39cd){_0x88192e=_0x88192e-0x113;let _0x6efa6=_0x3dd9d2[_0x88192e];return _0x6efa6;},a136_0x3302(_0x891066,_0x37702d);}var __decorate=this&&this[a136_0xd8512f(0x11b)]||function(_0xdd02bc,_0x28b335,_0x3cdfa7,_0x399e60){const _0x5bb4d1=a136_0xd8512f;var _0x3bce75=arguments[_0x5bb4d1(0x115)],_0xa58ec5=_0x3bce75<0x3?_0x28b335:_0x399e60===null?_0x399e60=Object[_0x5bb4d1(0x123)](_0x28b335,_0x3cdfa7):_0x399e60,_0x438651;if(typeof Reflect===_0x5bb4d1(0x13c)&&typeof Reflect[_0x5bb4d1(0x158)]===_0x5bb4d1(0x11a))_0xa58ec5=Reflect[_0x5bb4d1(0x158)](_0xdd02bc,_0x28b335,_0x3cdfa7,_0x399e60);else{for(var _0x3602e6=_0xdd02bc[_0x5bb4d1(0x115)]-0x1;_0x3602e6>=0x0;_0x3602e6--)if(_0x438651=_0xdd02bc[_0x3602e6])_0xa58ec5=(_0x3bce75<0x3?_0x438651(_0xa58ec5):_0x3bce75>0x3?_0x438651(_0x28b335,_0x3cdfa7,_0xa58ec5):_0x438651(_0x28b335,_0x3cdfa7))||_0xa58ec5;}return _0x3bce75>0x3&&_0xa58ec5&&Object[_0x5bb4d1(0x130)](_0x28b335,_0x3cdfa7,_0xa58ec5),_0xa58ec5;},__metadata=this&&this[a136_0xd8512f(0x135)]||function(_0x4ca0c3,_0x4ec8d5){const _0x32f14d=a136_0xd8512f;if(typeof Reflect===_0x32f14d(0x13c)&&typeof Reflect[_0x32f14d(0x15b)]==='function')return Reflect[_0x32f14d(0x15b)](_0x4ca0c3,_0x4ec8d5);};Object[a136_0xd8512f(0x130)](exports,'__esModule',{'value':!![]}),exports[a136_0xd8512f(0x162)]=void 0x0;const typedi_1=require('typedi'),constants_1=require('../../../constants'),errors_1=require('../../../constants/errors'),utils_1=require(a136_0xd8512f(0x122)),flosum_repository_sync_dto_1=require(a136_0xd8512f(0x143)),not_found_error_1=require(a136_0xd8512f(0x152)),queries_1=require(a136_0xd8512f(0x14f)),salesforce_query_service_1=require(a136_0xd8512f(0x136)),salesforce_service_1=require(a136_0xd8512f(0x161));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x46765f,_0x30d352){const _0x5596ed=a136_0xd8512f;this['salesforceQuery']=_0x46765f,this[_0x5596ed(0x138)]=_0x30d352;}async['getComponents'](_0x508e44){const _0x16d5e3=a136_0xd8512f;var _0x1b4912;const _0x1c0e48=await this[_0x16d5e3(0x160)][_0x16d5e3(0x15e)](_0x508e44),_0x3190dc=[];for(const _0x63c0b3 of _0x1c0e48){const _0x202570=(_0x1b4912=_0x63c0b3[constants_1[_0x16d5e3(0x11f)]+'Components__r'])===null||_0x1b4912===void 0x0?void 0x0:_0x1b4912[_0x16d5e3(0x141)];_0x202570&&_0x202570[_0x16d5e3(0x115)]&&_0x3190dc[_0x16d5e3(0x132)](_0x202570[0x0]['Id']);}return _0x3190dc;}async[a136_0xd8512f(0x12c)](){const _0x45a9f8=a136_0xd8512f,_0x160022=await this[_0x45a9f8(0x160)]['query'](queries_1[_0x45a9f8(0x11d)]);return _0x160022['map'](_0x3b0c37=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x3b0c37));}async[a136_0xd8512f(0x127)](){const _0x2edf92=a136_0xd8512f,_0x9e2b3b=await this[_0x2edf92(0x160)]['query'](queries_1[_0x2edf92(0x133)]);return _0x9e2b3b[_0x2edf92(0x154)](_0x36bf26=>flosum_repository_sync_dto_1[_0x2edf92(0x12a)][_0x2edf92(0x124)](_0x36bf26));}async['getRepositoryRecord'](_0xab29ca){const _0x28fa69=a136_0xd8512f,_0x2837eb=await this['salesforceQuery']['query'](queries_1[_0x28fa69(0x13d)][_0x28fa69(0x11c)]('%id%',_0xab29ca));if(_0x2837eb[_0x28fa69(0x115)]===0x0)throw new not_found_error_1[(_0x28fa69(0x163))](_0x28fa69(0x14e)+_0xab29ca+_0x28fa69(0x165));return flosum_repository_sync_dto_1[_0x28fa69(0x12a)]['fromRepositoryRecord'](_0x2837eb[0x0]);}async[a136_0xd8512f(0x15f)](_0x454cfa){const _0x428302=a136_0xd8512f,_0x2429e8=await this[_0x428302(0x160)][_0x428302(0x15e)](queries_1[_0x428302(0x15d)][_0x428302(0x11c)](_0x428302(0x116),_0x454cfa));if(_0x2429e8[_0x428302(0x115)]===0x0)throw new not_found_error_1[(_0x428302(0x163))]('Branch\x20with\x20Id\x20'+_0x454cfa+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x428302(0x124)](_0x2429e8[0x0]);}async[a136_0xd8512f(0x125)](_0x264428){const _0x3feb01=a136_0xd8512f,_0x1ffebc=await this[_0x3feb01(0x160)]['query'](queries_1[_0x3feb01(0x13a)]['replace'](_0x3feb01(0x15c),_0x264428));if(_0x1ffebc[_0x3feb01(0x115)]===0x0)throw new not_found_error_1[(_0x3feb01(0x163))](_0x3feb01(0x13f)+_0x264428+_0x3feb01(0x165));return flosum_repository_sync_dto_1[_0x3feb01(0x12a)][_0x3feb01(0x124)](_0x1ffebc[0x0]);}async[a136_0xd8512f(0x151)](_0x37f542){const _0x3fa886=a136_0xd8512f,_0x1681d6=await this[_0x3fa886(0x160)][_0x3fa886(0x15e)](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x3fa886(0x11c)](_0x3fa886(0x15c),_0x37f542));if(_0x1681d6['length']===0x0)throw new not_found_error_1[(_0x3fa886(0x163))]('Repository\x20'+_0x37f542+_0x3fa886(0x165));return flosum_repository_sync_dto_1[_0x3fa886(0x12a)][_0x3fa886(0x117)](_0x1681d6[0x0]);}async['getComponentsFromRepository'](_0x2add24){const _0x3555ec=a136_0xd8512f,_0x5b83c2=_0x3555ec(0x137)+queries_1[_0x3555ec(0x12d)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x2add24+'\x27';return this['getComponents'](_0x5b83c2);}async[a136_0xd8512f(0x149)](_0x3c6dfe){const _0x77db1=a136_0xd8512f,_0x2b3ea9='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1[_0x77db1(0x12d)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x3c6dfe+'\x27';return this[_0x77db1(0x126)](_0x2b3ea9);}async[a136_0xd8512f(0x145)](_0x492548){const _0x3a1a69=a136_0xd8512f;var _0x3624b3;const _0x1cd721=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x3a1a69(0x11c)]('%parentId%',_0x492548['objectId'])['replace'](_0x3a1a69(0x15c),_0x492548[_0x3a1a69(0x144)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x3531df=await this[_0x3a1a69(0x160)][_0x3a1a69(0x15e)](_0x1cd721),_0x2340a3=(_0x3624b3=_0x3531df[0x0])===null||_0x3624b3===void 0x0?void 0x0:_0x3624b3['Id'];if(!_0x2340a3)throw new Error(errors_1[_0x3a1a69(0x140)]);return _0x2340a3;}async[a136_0xd8512f(0x11e)](_0x527469){const _0x5603da=a136_0xd8512f;let _0x1b2a77=await this[_0x5603da(0x145)](_0x527469)[_0x5603da(0x119)](()=>null);return!_0x1b2a77&&(_0x1b2a77=await this[_0x5603da(0x138)][_0x5603da(0x12e)]('Attachment',{'Body':utils_1[_0x5603da(0x121)]('{}'),'ParentId':_0x527469[_0x5603da(0x155)],'ContentType':_0x5603da(0x164),'Name':_0x527469[_0x5603da(0x144)]?constants_1[_0x5603da(0x12b)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x1b2a77;}async[a136_0xd8512f(0x134)](_0x254ea8,_0x3c7200){const _0x263af4=a136_0xd8512f,_0x31389d=await this['getRemoteStateAttachmentId'](_0x254ea8);await this[_0x263af4(0x138)][_0x263af4(0x14a)]('Attachment',_0x31389d,{'Body':utils_1[_0x263af4(0x121)](JSON['stringify'](_0x3c7200))});}async['setStatus'](_0x17488b,_0x557cac){const _0x38cd50=a136_0xd8512f;await this[_0x38cd50(0x138)]['patchObject'](_0x17488b['objectType'],_0x17488b['objectId'],{[constants_1[_0x38cd50(0x14b)]+_0x38cd50(0x12f)]:_0x557cac});}async[a136_0xd8512f(0x159)](_0x5cf5cd){const _0x50ff21=a136_0xd8512f;await this[_0x50ff21(0x138)][_0x50ff21(0x14a)](constants_1['FLOSUM_GIT_NAMESPACE']+_0x50ff21(0x14d),_0x5cf5cd,{[constants_1[_0x50ff21(0x14b)]+_0x50ff21(0x153)]:![]});}};SalesforceSyncService=__decorate([typedi_1[a136_0xd8512f(0x146)](),__metadata(a136_0xd8512f(0x114),[salesforce_query_service_1[a136_0xd8512f(0x147)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports[a136_0xd8512f(0x162)]=SalesforceSyncService;