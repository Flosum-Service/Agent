const a135_0x35244e=a135_0x1c2f;(function(_0x126cc3,_0x2be540){const _0x1d5673=a135_0x1c2f,_0x296395=_0x126cc3();while(!![]){try{const _0x256b30=-parseInt(_0x1d5673(0x11f))/0x1+-parseInt(_0x1d5673(0x169))/0x2+-parseInt(_0x1d5673(0x12f))/0x3*(-parseInt(_0x1d5673(0x137))/0x4)+parseInt(_0x1d5673(0x11e))/0x5*(-parseInt(_0x1d5673(0x13a))/0x6)+-parseInt(_0x1d5673(0x15e))/0x7*(parseInt(_0x1d5673(0x122))/0x8)+parseInt(_0x1d5673(0x138))/0x9*(-parseInt(_0x1d5673(0x14f))/0xa)+parseInt(_0x1d5673(0x141))/0xb*(parseInt(_0x1d5673(0x118))/0xc);if(_0x256b30===_0x2be540)break;else _0x296395['push'](_0x296395['shift']());}catch(_0x21969e){_0x296395['push'](_0x296395['shift']());}}}(a135_0x1f3c,0xcaea8));const a135_0x26225e=(function(){let _0x3a41e3=!![];return function(_0x53db92,_0x51720e){const _0x3a830b=_0x3a41e3?function(){const _0xc82ada=a135_0x1c2f;if(_0x51720e){const _0x4d3209=_0x51720e[_0xc82ada(0x15a)](_0x53db92,arguments);return _0x51720e=null,_0x4d3209;}}:function(){};return _0x3a41e3=![],_0x3a830b;};}()),a135_0x16ad25=a135_0x26225e(this,function(){const _0x1b7573=a135_0x1c2f;return a135_0x16ad25[_0x1b7573(0x14e)]()['search']('(((.+)+)+)+$')[_0x1b7573(0x14e)]()[_0x1b7573(0x156)](a135_0x16ad25)[_0x1b7573(0x114)](_0x1b7573(0x158));});a135_0x16ad25();function a135_0x1c2f(_0xd079f0,_0x1c5736){const _0x555ac9=a135_0x1f3c();return a135_0x1c2f=function(_0x16ad25,_0x26225e){_0x16ad25=_0x16ad25-0x10d;let _0x1f3c76=_0x555ac9[_0x16ad25];return _0x1f3c76;},a135_0x1c2f(_0xd079f0,_0x1c5736);}'use strict';function a135_0x1f3c(){const _0x580cc1=['stringify','(((.+)+)+)+$','../../../constants','apply','../queries','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','salesforceService','2884749PEgOVZ','replace','repositoryId','updateRemoteState','%name%','FlosumRepositorySyncDto','FLOSUM_GIT_NAMESPACE','getOwnPropertyDescriptor','getRemoteStateAttachmentId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','GET_WAITING_BRANCHES_QUERY','2859758lyMwSx','./salesforce-query.service','SalesforceSyncService','FLOSUM_NAMESPACE','SalesforceNotFoundError','GET_WAITING_REPOSITORIES_QUERY','fromRepositoryRecord','\x20not\x20found\x20on\x20salesforce','search','getRepositoryRecord','patchObject','map','15024756fazEYr','getBranchRecords','GET_REPOSITORY_QUERY','Service','decorate','\x0a\x20\x20\x20\x20\x20\x20','25RlGWnG','1586105InCFQH','../dto/flosum-repository-sync.dto','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','24BPISOf','SYNC_ATTACHMENT_FOR_BRANCH_NAME','Repository\x20with\x20Id\x20','query','../../../constants/errors','push','__esModule','getBranchRecord','Synchronization_Status__c','__decorate','getComponents','objectId','function','15KfbBnA','%id%','getAttachmentId','Repository\x20','ERR_INVALID_ATTACHMENT_ID','../../shared/utils','salesforceQuery','fromBranchRecord','92012idCiuf','21393MbitXf','GET_REPOSITORY_BY_NAME_QUERY','29928kNrrSl','createObject','length','getComponentsFromRepository','getRepositoryRecordByName','Attachment','defineProperty','55wSOpRL','objectType','metadata','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','GET_BRANCH_QUERY','getRepositoryRecords','encodeBase64','SalesforceQueryService','disableSync','text/plain','./salesforce.service','Branch\x20','SalesforceService','toString','5330JixDOu','%parentId%','catch','GET_COMPONENTS_QUERY','object','GET_BRANCH_BY_NAME_QUERY','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','constructor'];a135_0x1f3c=function(){return _0x580cc1;};return a135_0x1f3c();}var __decorate=this&&this[a135_0x35244e(0x12b)]||function(_0x11e928,_0x2cf14b,_0x2da3df,_0x55ee4c){const _0x1f7880=a135_0x35244e;var _0x412593=arguments['length'],_0x2e0860=_0x412593<0x3?_0x2cf14b:_0x55ee4c===null?_0x55ee4c=Object[_0x1f7880(0x165)](_0x2cf14b,_0x2da3df):_0x55ee4c,_0xbd4874;if(typeof Reflect===_0x1f7880(0x153)&&typeof Reflect[_0x1f7880(0x11c)]===_0x1f7880(0x12e))_0x2e0860=Reflect[_0x1f7880(0x11c)](_0x11e928,_0x2cf14b,_0x2da3df,_0x55ee4c);else{for(var _0x58624d=_0x11e928[_0x1f7880(0x13c)]-0x1;_0x58624d>=0x0;_0x58624d--)if(_0xbd4874=_0x11e928[_0x58624d])_0x2e0860=(_0x412593<0x3?_0xbd4874(_0x2e0860):_0x412593>0x3?_0xbd4874(_0x2cf14b,_0x2da3df,_0x2e0860):_0xbd4874(_0x2cf14b,_0x2da3df))||_0x2e0860;}return _0x412593>0x3&&_0x2e0860&&Object[_0x1f7880(0x140)](_0x2cf14b,_0x2da3df,_0x2e0860),_0x2e0860;},__metadata=this&&this['__metadata']||function(_0x3eab5f,_0x2f7a81){const _0x2f9710=a135_0x35244e;if(typeof Reflect===_0x2f9710(0x153)&&typeof Reflect[_0x2f9710(0x143)]===_0x2f9710(0x12e))return Reflect[_0x2f9710(0x143)](_0x3eab5f,_0x2f7a81);};Object[a135_0x35244e(0x140)](exports,a135_0x35244e(0x128),{'value':!![]}),exports[a135_0x35244e(0x10e)]=void 0x0;const typedi_1=require('typedi'),constants_1=require(a135_0x35244e(0x159)),errors_1=require(a135_0x35244e(0x126)),utils_1=require(a135_0x35244e(0x134)),flosum_repository_sync_dto_1=require(a135_0x35244e(0x120)),not_found_error_1=require('../errors/not-found.error'),queries_1=require(a135_0x35244e(0x15b)),salesforce_query_service_1=require(a135_0x35244e(0x10d)),salesforce_service_1=require(a135_0x35244e(0x14b));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x43bd77,_0x198828){const _0x288832=a135_0x35244e;this[_0x288832(0x135)]=_0x43bd77,this[_0x288832(0x15d)]=_0x198828;}async[a135_0x35244e(0x12c)](_0x28aaff){const _0x509bca=a135_0x35244e;var _0x26d3be;const _0x3a2819=await this['salesforceQuery']['query'](_0x28aaff),_0x16599d=[];for(const _0x1380d6 of _0x3a2819){const _0xaa28d7=(_0x26d3be=_0x1380d6[constants_1[_0x509bca(0x10f)]+'Components__r'])===null||_0x26d3be===void 0x0?void 0x0:_0x26d3be['records'];_0xaa28d7&&_0xaa28d7[_0x509bca(0x13c)]&&_0x16599d[_0x509bca(0x127)](_0xaa28d7[0x0]['Id']);}return _0x16599d;}async[a135_0x35244e(0x146)](){const _0x5361db=a135_0x35244e,_0x34b7ec=await this['salesforceQuery'][_0x5361db(0x125)](queries_1[_0x5361db(0x111)]);return _0x34b7ec[_0x5361db(0x117)](_0x533451=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x5361db(0x112)](_0x533451));}async[a135_0x35244e(0x119)](){const _0x5a1da5=a135_0x35244e,_0x54f7d1=await this[_0x5a1da5(0x135)][_0x5a1da5(0x125)](queries_1[_0x5a1da5(0x168)]);return _0x54f7d1[_0x5a1da5(0x117)](_0x27bf33=>flosum_repository_sync_dto_1[_0x5a1da5(0x163)][_0x5a1da5(0x136)](_0x27bf33));}async[a135_0x35244e(0x115)](_0x121990){const _0x3572aa=a135_0x35244e,_0x3a7028=await this[_0x3572aa(0x135)]['query'](queries_1[_0x3572aa(0x11a)][_0x3572aa(0x15f)](_0x3572aa(0x130),_0x121990));if(_0x3a7028['length']===0x0)throw new not_found_error_1[(_0x3572aa(0x110))](_0x3572aa(0x124)+_0x121990+_0x3572aa(0x113));return flosum_repository_sync_dto_1[_0x3572aa(0x163)][_0x3572aa(0x112)](_0x3a7028[0x0]);}async[a135_0x35244e(0x129)](_0x43b648){const _0x2447b1=a135_0x35244e,_0x1b499e=await this[_0x2447b1(0x135)]['query'](queries_1[_0x2447b1(0x145)]['replace'](_0x2447b1(0x130),_0x43b648));if(_0x1b499e['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Branch\x20with\x20Id\x20'+_0x43b648+_0x2447b1(0x113));return flosum_repository_sync_dto_1[_0x2447b1(0x163)][_0x2447b1(0x136)](_0x1b499e[0x0]);}async['getBranchRecordByName'](_0x1db93d){const _0xe66a86=a135_0x35244e,_0x108a96=await this[_0xe66a86(0x135)]['query'](queries_1[_0xe66a86(0x154)][_0xe66a86(0x15f)]('%name%',_0x1db93d));if(_0x108a96[_0xe66a86(0x13c)]===0x0)throw new not_found_error_1[(_0xe66a86(0x110))](_0xe66a86(0x14c)+_0x1db93d+_0xe66a86(0x113));return flosum_repository_sync_dto_1[_0xe66a86(0x163)][_0xe66a86(0x136)](_0x108a96[0x0]);}async[a135_0x35244e(0x13e)](_0x1e7d66){const _0x5bb94e=a135_0x35244e,_0x39423b=await this[_0x5bb94e(0x135)][_0x5bb94e(0x125)](queries_1[_0x5bb94e(0x139)]['replace'](_0x5bb94e(0x162),_0x1e7d66));if(_0x39423b[_0x5bb94e(0x13c)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x5bb94e(0x132)+_0x1e7d66+_0x5bb94e(0x113));return flosum_repository_sync_dto_1[_0x5bb94e(0x163)]['fromRepositoryRecord'](_0x39423b[0x0]);}async[a135_0x35244e(0x13d)](_0x547abe){const _0x3f1aa3=a135_0x35244e,_0x47c049=_0x3f1aa3(0x11d)+queries_1[_0x3f1aa3(0x152)]+_0x3f1aa3(0x15c)+_0x547abe+'\x27';return this[_0x3f1aa3(0x12c)](_0x47c049);}async['getBranchComponents'](_0x540de8){const _0x48ce32=a135_0x35244e,_0x211a99=_0x48ce32(0x167)+queries_1[_0x48ce32(0x152)]+_0x48ce32(0x144)+_0x540de8+'\x27';return this[_0x48ce32(0x12c)](_0x211a99);}async[a135_0x35244e(0x131)](_0x4a8be2){const _0x4161e0=a135_0x35244e;var _0x41c0f1;const _0x29442f=queries_1[_0x4161e0(0x121)][_0x4161e0(0x15f)](_0x4161e0(0x150),_0x4a8be2[_0x4161e0(0x12d)])['replace'](_0x4161e0(0x162),_0x4a8be2['repositoryId']?constants_1[_0x4161e0(0x155)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x45e7b0=await this[_0x4161e0(0x135)][_0x4161e0(0x125)](_0x29442f),_0x4a63b1=(_0x41c0f1=_0x45e7b0[0x0])===null||_0x41c0f1===void 0x0?void 0x0:_0x41c0f1['Id'];if(!_0x4a63b1)throw new Error(errors_1[_0x4161e0(0x133)]);return _0x4a63b1;}async[a135_0x35244e(0x166)](_0x302139){const _0x23d826=a135_0x35244e;let _0x1966cd=await this[_0x23d826(0x131)](_0x302139)[_0x23d826(0x151)](()=>null);return!_0x1966cd&&(_0x1966cd=await this[_0x23d826(0x15d)][_0x23d826(0x13b)]('Attachment',{'Body':utils_1['encodeBase64']('{}'),'ParentId':_0x302139[_0x23d826(0x12d)],'ContentType':_0x23d826(0x14a),'Name':_0x302139[_0x23d826(0x160)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x23d826(0x123)]})),_0x1966cd;}async[a135_0x35244e(0x161)](_0x555728,_0x22d1fe){const _0xac847d=a135_0x35244e,_0x59606a=await this[_0xac847d(0x166)](_0x555728);await this[_0xac847d(0x15d)][_0xac847d(0x116)](_0xac847d(0x13f),_0x59606a,{'Body':utils_1[_0xac847d(0x147)](JSON[_0xac847d(0x157)](_0x22d1fe))});}async['setStatus'](_0x1ceb34,_0x593009){const _0x1d05fb=a135_0x35244e;await this[_0x1d05fb(0x15d)][_0x1d05fb(0x116)](_0x1ceb34[_0x1d05fb(0x142)],_0x1ceb34[_0x1d05fb(0x12d)],{[constants_1[_0x1d05fb(0x164)]+_0x1d05fb(0x12a)]:_0x593009});}async[a135_0x35244e(0x149)](_0x1c2299){const _0x39907f=a135_0x35244e;await this['salesforceService'][_0x39907f(0x116)](constants_1['FLOSUM_GIT_NAMESPACE']+'Git_Settings__c',_0x1c2299,{[constants_1[_0x39907f(0x164)]+'Sync_In_Progress__c']:![]});}};SalesforceSyncService=__decorate([typedi_1[a135_0x35244e(0x11b)](),__metadata('design:paramtypes',[salesforce_query_service_1[a135_0x35244e(0x148)],salesforce_service_1[a135_0x35244e(0x14d)]])],SalesforceSyncService),exports[a135_0x35244e(0x10e)]=SalesforceSyncService;