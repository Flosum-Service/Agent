const a136_0x54eb8b=a136_0x38cc;(function(_0xb9b3e3,_0x2a5623){const _0x425ac3=a136_0x38cc,_0x50caa4=_0xb9b3e3();while(!![]){try{const _0x4c1755=parseInt(_0x425ac3(0x1c9))/0x1+parseInt(_0x425ac3(0x1d6))/0x2+parseInt(_0x425ac3(0x1d7))/0x3*(-parseInt(_0x425ac3(0x1b7))/0x4)+parseInt(_0x425ac3(0x1ae))/0x5+parseInt(_0x425ac3(0x1db))/0x6*(-parseInt(_0x425ac3(0x192))/0x7)+parseInt(_0x425ac3(0x1d4))/0x8*(parseInt(_0x425ac3(0x197))/0x9)+-parseInt(_0x425ac3(0x194))/0xa*(-parseInt(_0x425ac3(0x1ca))/0xb);if(_0x4c1755===_0x2a5623)break;else _0x50caa4['push'](_0x50caa4['shift']());}catch(_0x5c50d1){_0x50caa4['push'](_0x50caa4['shift']());}}}(a136_0xb6e3,0xd8906));const a136_0x535db6=(function(){let _0x26c5fb=!![];return function(_0x1fff5b,_0x4c2fac){const _0x19ae9a=_0x26c5fb?function(){const _0x55500e=a136_0x38cc;if(_0x4c2fac){const _0x24e2dd=_0x4c2fac[_0x55500e(0x1c0)](_0x1fff5b,arguments);return _0x4c2fac=null,_0x24e2dd;}}:function(){};return _0x26c5fb=![],_0x19ae9a;};}()),a136_0x55ce34=a136_0x535db6(this,function(){const _0x4aa60b=a136_0x38cc;return a136_0x55ce34['toString']()['search'](_0x4aa60b(0x1d5))['toString']()[_0x4aa60b(0x19d)](a136_0x55ce34)[_0x4aa60b(0x1d9)](_0x4aa60b(0x1d5));});a136_0x55ce34();'use strict';var __decorate=this&&this[a136_0x54eb8b(0x1bb)]||function(_0x22e3a2,_0x469d1c,_0x198e35,_0x41cbf7){const _0x5e2126=a136_0x54eb8b;var _0x5c8d1b=arguments[_0x5e2126(0x1cc)],_0x159588=_0x5c8d1b<0x3?_0x469d1c:_0x41cbf7===null?_0x41cbf7=Object[_0x5e2126(0x1cd)](_0x469d1c,_0x198e35):_0x41cbf7,_0x346aad;if(typeof Reflect===_0x5e2126(0x1a9)&&typeof Reflect[_0x5e2126(0x1c2)]===_0x5e2126(0x1c8))_0x159588=Reflect[_0x5e2126(0x1c2)](_0x22e3a2,_0x469d1c,_0x198e35,_0x41cbf7);else{for(var _0x25e921=_0x22e3a2[_0x5e2126(0x1cc)]-0x1;_0x25e921>=0x0;_0x25e921--)if(_0x346aad=_0x22e3a2[_0x25e921])_0x159588=(_0x5c8d1b<0x3?_0x346aad(_0x159588):_0x5c8d1b>0x3?_0x346aad(_0x469d1c,_0x198e35,_0x159588):_0x346aad(_0x469d1c,_0x198e35))||_0x159588;}return _0x5c8d1b>0x3&&_0x159588&&Object[_0x5e2126(0x1c6)](_0x469d1c,_0x198e35,_0x159588),_0x159588;},__metadata=this&&this['__metadata']||function(_0x1df0f6,_0x2d702f){const _0x3226c9=a136_0x54eb8b;if(typeof Reflect===_0x3226c9(0x1a9)&&typeof Reflect[_0x3226c9(0x19f)]===_0x3226c9(0x1c8))return Reflect[_0x3226c9(0x19f)](_0x1df0f6,_0x2d702f);};function a136_0x38cc(_0x4e3fc0,_0x40e6b1){const _0x345fad=a136_0xb6e3();return a136_0x38cc=function(_0x55ce34,_0x535db6){_0x55ce34=_0x55ce34-0x18d;let _0xb6e3d9=_0x345fad[_0x55ce34];return _0xb6e3d9;},a136_0x38cc(_0x4e3fc0,_0x40e6b1);}function a136_0xb6e3(){const _0x296ae3=['getRepositoryRecord','../../../constants','10132423cLorQq','getComponentsFromRepository','1153610xRgbEP','%id%','replace','18279rmASgH','%parentId%','records','%name%','SYNC_ATTACHMENT_FOR_BRANCH_NAME','Branch\x20','constructor','GET_COMPONENTS_QUERY','metadata','../dto/flosum-repository-sync.dto','design:paramtypes','Sync_In_Progress__c','GET_WAITING_BRANCHES_QUERY','SalesforceSyncService','Git_Settings__c','./salesforce.service','query','getRepositoryRecords','object','getAttachmentId','salesforceQuery','FLOSUM_GIT_NAMESPACE','SalesforceQueryService','2877260MLHRHi','getBranchComponents','GET_WAITING_REPOSITORIES_QUERY','salesforceService','updateRemoteState','GET_REPOSITORY_BY_NAME_QUERY','GET_REPOSITORY_QUERY','SalesforceNotFoundError','FLOSUM_NAMESPACE','1357660DRBqrs','stringify','\x0a\x20\x20\x20\x20\x20\x20','createObject','__decorate','FlosumRepositorySyncDto','patchObject','./salesforce-query.service','ERR_INVALID_ATTACHMENT_ID','apply','__esModule','decorate','Synchronization_Status__c','Repository\x20','objectId','defineProperty','typedi','function','961074aamTvW','22tPtxZi','catch','length','getOwnPropertyDescriptor','\x20not\x20found\x20on\x20salesforce','getRepositoryRecordByName','encodeBase64','Branch\x20with\x20Id\x20','Attachment','map','3000zjFQbx','(((.+)+)+)+$','290154HTpXiu','3NbHGUr','disableSync','search','getBranchRecords','6FeJJBi','Repository\x20with\x20Id\x20','getComponents','Service','fromBranchRecord','fromRepositoryRecord','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','repositoryId'];a136_0xb6e3=function(){return _0x296ae3;};return a136_0xb6e3();}Object[a136_0x54eb8b(0x1c6)](exports,a136_0x54eb8b(0x1c1),{'value':!![]}),exports[a136_0x54eb8b(0x1a4)]=void 0x0;const typedi_1=require(a136_0x54eb8b(0x1c7)),constants_1=require(a136_0x54eb8b(0x191)),errors_1=require('../../../constants/errors'),utils_1=require('../../shared/utils'),flosum_repository_sync_dto_1=require(a136_0x54eb8b(0x1a0)),not_found_error_1=require('../errors/not-found.error'),queries_1=require('../queries'),salesforce_query_service_1=require(a136_0x54eb8b(0x1be)),salesforce_service_1=require(a136_0x54eb8b(0x1a6));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x257ffe,_0x3f1fc3){const _0x508116=a136_0x54eb8b;this[_0x508116(0x1ab)]=_0x257ffe,this['salesforceService']=_0x3f1fc3;}async[a136_0x54eb8b(0x1dd)](_0x36c20d){const _0x248fb2=a136_0x54eb8b;var _0x4f475e;const _0x16643=await this[_0x248fb2(0x1ab)][_0x248fb2(0x1a7)](_0x36c20d),_0x5a86ed=[];for(const _0x68b47d of _0x16643){const _0x5d1cd5=(_0x4f475e=_0x68b47d[constants_1[_0x248fb2(0x1b6)]+'Components__r'])===null||_0x4f475e===void 0x0?void 0x0:_0x4f475e[_0x248fb2(0x199)];_0x5d1cd5&&_0x5d1cd5[_0x248fb2(0x1cc)]&&_0x5a86ed['push'](_0x5d1cd5[0x0]['Id']);}return _0x5a86ed;}async[a136_0x54eb8b(0x1a8)](){const _0x5a1027=a136_0x54eb8b,_0x1e2a30=await this[_0x5a1027(0x1ab)][_0x5a1027(0x1a7)](queries_1[_0x5a1027(0x1b0)]);return _0x1e2a30[_0x5a1027(0x1d3)](_0x272baf=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x5a1027(0x1e0)](_0x272baf));}async[a136_0x54eb8b(0x1da)](){const _0x28eb13=a136_0x54eb8b,_0x20a69f=await this[_0x28eb13(0x1ab)]['query'](queries_1[_0x28eb13(0x1a3)]);return _0x20a69f['map'](_0x9f698b=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x28eb13(0x1df)](_0x9f698b));}async[a136_0x54eb8b(0x190)](_0x17a6c0){const _0x23da6d=a136_0x54eb8b,_0x5a1a15=await this[_0x23da6d(0x1ab)][_0x23da6d(0x1a7)](queries_1[_0x23da6d(0x1b4)][_0x23da6d(0x196)](_0x23da6d(0x195),_0x17a6c0));if(_0x5a1a15[_0x23da6d(0x1cc)]===0x0)throw new not_found_error_1[(_0x23da6d(0x1b5))](_0x23da6d(0x1dc)+_0x17a6c0+_0x23da6d(0x1ce));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x23da6d(0x1e0)](_0x5a1a15[0x0]);}async['getBranchRecord'](_0x4f5834){const _0x451bec=a136_0x54eb8b,_0xd78411=await this[_0x451bec(0x1ab)][_0x451bec(0x1a7)](queries_1['GET_BRANCH_QUERY'][_0x451bec(0x196)](_0x451bec(0x195),_0x4f5834));if(_0xd78411[_0x451bec(0x1cc)]===0x0)throw new not_found_error_1[(_0x451bec(0x1b5))](_0x451bec(0x1d1)+_0x4f5834+_0x451bec(0x1ce));return flosum_repository_sync_dto_1[_0x451bec(0x1bc)][_0x451bec(0x1df)](_0xd78411[0x0]);}async['getBranchRecordByName'](_0x44e4dd){const _0x107c33=a136_0x54eb8b,_0x3ca489=await this['salesforceQuery'][_0x107c33(0x1a7)](queries_1['GET_BRANCH_BY_NAME_QUERY'][_0x107c33(0x196)](_0x107c33(0x19a),_0x44e4dd));if(_0x3ca489[_0x107c33(0x1cc)]===0x0)throw new not_found_error_1[(_0x107c33(0x1b5))](_0x107c33(0x19c)+_0x44e4dd+_0x107c33(0x1ce));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x107c33(0x1df)](_0x3ca489[0x0]);}async[a136_0x54eb8b(0x1cf)](_0xfffa06){const _0x53ef26=a136_0x54eb8b,_0xfa4d18=await this[_0x53ef26(0x1ab)][_0x53ef26(0x1a7)](queries_1[_0x53ef26(0x1b3)][_0x53ef26(0x196)](_0x53ef26(0x19a),_0xfffa06));if(_0xfa4d18[_0x53ef26(0x1cc)]===0x0)throw new not_found_error_1[(_0x53ef26(0x1b5))](_0x53ef26(0x1c4)+_0xfffa06+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x53ef26(0x1e0)](_0xfa4d18[0x0]);}async[a136_0x54eb8b(0x193)](_0x721044){const _0x575a77=a136_0x54eb8b,_0x2fdaab=_0x575a77(0x1b9)+queries_1[_0x575a77(0x19e)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x721044+'\x27';return this[_0x575a77(0x1dd)](_0x2fdaab);}async[a136_0x54eb8b(0x1af)](_0x252e6f){const _0x2bcdc5=a136_0x54eb8b,_0x557d19='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1['GET_COMPONENTS_QUERY']+_0x2bcdc5(0x18e)+_0x252e6f+'\x27';return this[_0x2bcdc5(0x1dd)](_0x557d19);}async['getAttachmentId'](_0x29e6cc){const _0x207e93=a136_0x54eb8b;var _0xe7993f;const _0x1e632e=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x207e93(0x196)](_0x207e93(0x198),_0x29e6cc[_0x207e93(0x1c5)])[_0x207e93(0x196)]('%name%',_0x29e6cc[_0x207e93(0x18f)]?constants_1[_0x207e93(0x18d)]:constants_1[_0x207e93(0x19b)]),_0x2820c9=await this[_0x207e93(0x1ab)]['query'](_0x1e632e),_0x4e026b=(_0xe7993f=_0x2820c9[0x0])===null||_0xe7993f===void 0x0?void 0x0:_0xe7993f['Id'];if(!_0x4e026b)throw new Error(errors_1[_0x207e93(0x1bf)]);return _0x4e026b;}async['getRemoteStateAttachmentId'](_0x2a7a76){const _0x35f9fb=a136_0x54eb8b;let _0x5f06e0=await this[_0x35f9fb(0x1aa)](_0x2a7a76)[_0x35f9fb(0x1cb)](()=>null);return!_0x5f06e0&&(_0x5f06e0=await this[_0x35f9fb(0x1b1)][_0x35f9fb(0x1ba)](_0x35f9fb(0x1d2),{'Body':utils_1[_0x35f9fb(0x1d0)]('{}'),'ParentId':_0x2a7a76[_0x35f9fb(0x1c5)],'ContentType':'text/plain','Name':_0x2a7a76[_0x35f9fb(0x18f)]?constants_1[_0x35f9fb(0x18d)]:constants_1[_0x35f9fb(0x19b)]})),_0x5f06e0;}async[a136_0x54eb8b(0x1b2)](_0x1e8c2a,_0x55ab9f){const _0x355a09=a136_0x54eb8b,_0x3d7b67=await this['getRemoteStateAttachmentId'](_0x1e8c2a);await this[_0x355a09(0x1b1)][_0x355a09(0x1bd)](_0x355a09(0x1d2),_0x3d7b67,{'Body':utils_1['encodeBase64'](JSON[_0x355a09(0x1b8)](_0x55ab9f))});}async['setStatus'](_0x5ab937,_0x47b6aa){const _0x4933e9=a136_0x54eb8b;await this[_0x4933e9(0x1b1)]['patchObject'](_0x5ab937['objectType'],_0x5ab937[_0x4933e9(0x1c5)],{[constants_1[_0x4933e9(0x1ac)]+_0x4933e9(0x1c3)]:_0x47b6aa});}async[a136_0x54eb8b(0x1d8)](_0x183b18){const _0x552073=a136_0x54eb8b;await this[_0x552073(0x1b1)][_0x552073(0x1bd)](constants_1[_0x552073(0x1ac)]+_0x552073(0x1a5),_0x183b18,{[constants_1[_0x552073(0x1ac)]+_0x552073(0x1a2)]:![]});}};SalesforceSyncService=__decorate([typedi_1[a136_0x54eb8b(0x1de)](),__metadata(a136_0x54eb8b(0x1a1),[salesforce_query_service_1[a136_0x54eb8b(0x1ad)],salesforce_service_1['SalesforceService']])],SalesforceSyncService),exports[a136_0x54eb8b(0x1a4)]=SalesforceSyncService;