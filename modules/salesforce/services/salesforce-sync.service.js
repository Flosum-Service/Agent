const a136_0x36f816=a136_0x54b4;(function(_0x369a2f,_0x38f8a3){const _0x2693af=a136_0x54b4,_0x37b164=_0x369a2f();while(!![]){try{const _0x351b05=-parseInt(_0x2693af(0x14b))/0x1*(parseInt(_0x2693af(0x113))/0x2)+parseInt(_0x2693af(0x116))/0x3+-parseInt(_0x2693af(0x108))/0x4+-parseInt(_0x2693af(0x106))/0x5*(-parseInt(_0x2693af(0x14c))/0x6)+parseInt(_0x2693af(0x130))/0x7+-parseInt(_0x2693af(0x102))/0x8*(parseInt(_0x2693af(0x134))/0x9)+-parseInt(_0x2693af(0x145))/0xa*(-parseInt(_0x2693af(0x112))/0xb);if(_0x351b05===_0x38f8a3)break;else _0x37b164['push'](_0x37b164['shift']());}catch(_0xc9eb0c){_0x37b164['push'](_0x37b164['shift']());}}}(a136_0x3a38,0x85f8f));const a136_0x12d7cb=(function(){let _0x251814=!![];return function(_0x483032,_0x96157f){const _0x330cd3=_0x251814?function(){if(_0x96157f){const _0x218ffb=_0x96157f['apply'](_0x483032,arguments);return _0x96157f=null,_0x218ffb;}}:function(){};return _0x251814=![],_0x330cd3;};}()),a136_0x4b04af=a136_0x12d7cb(this,function(){const _0x25cf3f=a136_0x54b4;return a136_0x4b04af[_0x25cf3f(0x14d)]()['search'](_0x25cf3f(0x151))[_0x25cf3f(0x14d)]()[_0x25cf3f(0x10b)](a136_0x4b04af)[_0x25cf3f(0x144)](_0x25cf3f(0x151));});a136_0x4b04af();function a136_0x3a38(){const _0x2690c9=['(((.+)+)+)+$','design:paramtypes','SalesforceSyncService','__metadata','GET_WAITING_BRANCHES_QUERY','SalesforceNotFoundError','getBranchRecordByName','getComponents','FlosumRepositorySyncDto','getRepositoryRecordByName','fromBranchRecord','56IUyCeF','catch','getAttachmentId','GET_REPOSITORY_BY_NAME_QUERY','5vYjIoB','Repository\x20with\x20Id\x20','386508WSJHtk','./salesforce.service','createObject','constructor','repositoryId','push','Components__r','SalesforceQueryService','FLOSUM_NAMESPACE','encodeBase64','3027002dZluGa','1304126vEXTpP','fromRepositoryRecord','typedi','235344OTfkYG','../../../constants','../errors/not-found.error','Git_Settings__c','%id%','length','defineProperty','text/plain','objectId','salesforceService','salesforceQuery','GET_REPOSITORY_QUERY','FLOSUM_GIT_NAMESPACE','Sync_In_Progress__c','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','getRemoteStateAttachmentId','../../../constants/errors','GET_COMPONENTS_QUERY','SalesforceService','patchObject','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','%name%','__decorate','Repository\x20','\x0a\x20\x20\x20\x20\x20\x20','stringify','1696520kIKrGO','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','../queries','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','541197RBdXKe','Service','disableSync','query','Attachment','ERR_INVALID_ATTACHMENT_ID','updateRemoteState','function','getRepositoryRecords','GET_BRANCH_QUERY','objectType','metadata','SYNC_ATTACHMENT_FOR_BRANCH_NAME','getOwnPropertyDescriptor','setStatus','records','search','40iOUygl','replace','\x20not\x20found\x20on\x20salesforce','%parentId%','./salesforce-query.service','getBranchRecords','1wWQOhk','1781016uOitCy','toString','Branch\x20with\x20Id\x20','getBranchComponents','decorate'];a136_0x3a38=function(){return _0x2690c9;};return a136_0x3a38();}function a136_0x54b4(_0x2afc70,_0x185242){const _0x14ebf6=a136_0x3a38();return a136_0x54b4=function(_0x4b04af,_0x12d7cb){_0x4b04af=_0x4b04af-0xfe;let _0x3a380e=_0x14ebf6[_0x4b04af];return _0x3a380e;},a136_0x54b4(_0x2afc70,_0x185242);}'use strict';var __decorate=this&&this[a136_0x36f816(0x12c)]||function(_0x12f25c,_0xbc7cf0,_0x475868,_0x346c3d){const _0x482eca=a136_0x36f816;var _0x1e7735=arguments[_0x482eca(0x11b)],_0x512420=_0x1e7735<0x3?_0xbc7cf0:_0x346c3d===null?_0x346c3d=Object[_0x482eca(0x141)](_0xbc7cf0,_0x475868):_0x346c3d,_0x1a4fc9;if(typeof Reflect==='object'&&typeof Reflect[_0x482eca(0x150)]==='function')_0x512420=Reflect[_0x482eca(0x150)](_0x12f25c,_0xbc7cf0,_0x475868,_0x346c3d);else{for(var _0x222113=_0x12f25c[_0x482eca(0x11b)]-0x1;_0x222113>=0x0;_0x222113--)if(_0x1a4fc9=_0x12f25c[_0x222113])_0x512420=(_0x1e7735<0x3?_0x1a4fc9(_0x512420):_0x1e7735>0x3?_0x1a4fc9(_0xbc7cf0,_0x475868,_0x512420):_0x1a4fc9(_0xbc7cf0,_0x475868))||_0x512420;}return _0x1e7735>0x3&&_0x512420&&Object[_0x482eca(0x11c)](_0xbc7cf0,_0x475868,_0x512420),_0x512420;},__metadata=this&&this[a136_0x36f816(0x154)]||function(_0x129384,_0x456656){const _0x54bb26=a136_0x36f816;if(typeof Reflect==='object'&&typeof Reflect[_0x54bb26(0x13f)]===_0x54bb26(0x13b))return Reflect[_0x54bb26(0x13f)](_0x129384,_0x456656);};Object[a136_0x36f816(0x11c)](exports,'__esModule',{'value':!![]}),exports[a136_0x36f816(0x153)]=void 0x0;const typedi_1=require(a136_0x36f816(0x115)),constants_1=require(a136_0x36f816(0x117)),errors_1=require(a136_0x36f816(0x126)),utils_1=require('../../shared/utils'),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a136_0x36f816(0x118)),queries_1=require(a136_0x36f816(0x132)),salesforce_query_service_1=require(a136_0x36f816(0x149)),salesforce_service_1=require(a136_0x36f816(0x109));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x246222,_0x20bcc6){this['salesforceQuery']=_0x246222,this['salesforceService']=_0x20bcc6;}async[a136_0x36f816(0xfe)](_0x2545f7){const _0x45d6ee=a136_0x36f816;var _0x448814;const _0x41d7f7=await this[_0x45d6ee(0x120)][_0x45d6ee(0x137)](_0x2545f7),_0x1826ed=[];for(const _0xe0e8a9 of _0x41d7f7){const _0x52029c=(_0x448814=_0xe0e8a9[constants_1[_0x45d6ee(0x110)]+_0x45d6ee(0x10e)])===null||_0x448814===void 0x0?void 0x0:_0x448814[_0x45d6ee(0x143)];_0x52029c&&_0x52029c['length']&&_0x1826ed[_0x45d6ee(0x10d)](_0x52029c[0x0]['Id']);}return _0x1826ed;}async[a136_0x36f816(0x13c)](){const _0x28f4e2=a136_0x36f816,_0xe6342f=await this[_0x28f4e2(0x120)][_0x28f4e2(0x137)](queries_1['GET_WAITING_REPOSITORIES_QUERY']);return _0xe6342f['map'](_0xd12568=>flosum_repository_sync_dto_1[_0x28f4e2(0xff)]['fromRepositoryRecord'](_0xd12568));}async[a136_0x36f816(0x14a)](){const _0x4acf7b=a136_0x36f816,_0x3fec5d=await this[_0x4acf7b(0x120)][_0x4acf7b(0x137)](queries_1[_0x4acf7b(0x155)]);return _0x3fec5d['map'](_0x582086=>flosum_repository_sync_dto_1[_0x4acf7b(0xff)]['fromBranchRecord'](_0x582086));}async['getRepositoryRecord'](_0x5c1d8e){const _0x131242=a136_0x36f816,_0x196987=await this[_0x131242(0x120)][_0x131242(0x137)](queries_1[_0x131242(0x121)][_0x131242(0x146)](_0x131242(0x11a),_0x5c1d8e));if(_0x196987[_0x131242(0x11b)]===0x0)throw new not_found_error_1[(_0x131242(0x156))](_0x131242(0x107)+_0x5c1d8e+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x131242(0xff)][_0x131242(0x114)](_0x196987[0x0]);}async['getBranchRecord'](_0x786126){const _0x57ae3d=a136_0x36f816,_0x979ce6=await this[_0x57ae3d(0x120)][_0x57ae3d(0x137)](queries_1[_0x57ae3d(0x13d)]['replace'](_0x57ae3d(0x11a),_0x786126));if(_0x979ce6['length']===0x0)throw new not_found_error_1[(_0x57ae3d(0x156))](_0x57ae3d(0x14e)+_0x786126+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x57ae3d(0xff)][_0x57ae3d(0x101)](_0x979ce6[0x0]);}async[a136_0x36f816(0x157)](_0x254114){const _0x5be27a=a136_0x36f816,_0x14042a=await this[_0x5be27a(0x120)]['query'](queries_1['GET_BRANCH_BY_NAME_QUERY'][_0x5be27a(0x146)]('%name%',_0x254114));if(_0x14042a[_0x5be27a(0x11b)]===0x0)throw new not_found_error_1[(_0x5be27a(0x156))]('Branch\x20'+_0x254114+_0x5be27a(0x147));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x5be27a(0x101)](_0x14042a[0x0]);}async[a136_0x36f816(0x100)](_0xbf497c){const _0x132025=a136_0x36f816,_0x1bb182=await this['salesforceQuery'][_0x132025(0x137)](queries_1[_0x132025(0x105)][_0x132025(0x146)]('%name%',_0xbf497c));if(_0x1bb182[_0x132025(0x11b)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x132025(0x12d)+_0xbf497c+_0x132025(0x147));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto']['fromRepositoryRecord'](_0x1bb182[0x0]);}async['getComponentsFromRepository'](_0x4fdc7d){const _0x2258bb=a136_0x36f816,_0x3aa6b7=_0x2258bb(0x12e)+queries_1[_0x2258bb(0x127)]+_0x2258bb(0x124)+_0x4fdc7d+'\x27';return this[_0x2258bb(0xfe)](_0x3aa6b7);}async[a136_0x36f816(0x14f)](_0x44eb6a){const _0x418848=a136_0x36f816,_0x403016=_0x418848(0x131)+queries_1[_0x418848(0x127)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0x44eb6a+'\x27';return this['getComponents'](_0x403016);}async[a136_0x36f816(0x104)](_0x96bee0){const _0x532b3=a136_0x36f816;var _0x26de0a;const _0x490266=queries_1[_0x532b3(0x133)]['replace'](_0x532b3(0x148),_0x96bee0[_0x532b3(0x11e)])[_0x532b3(0x146)](_0x532b3(0x12b),_0x96bee0[_0x532b3(0x10c)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x532b3(0x140)]),_0x1c8b9f=await this[_0x532b3(0x120)][_0x532b3(0x137)](_0x490266),_0x32e83f=(_0x26de0a=_0x1c8b9f[0x0])===null||_0x26de0a===void 0x0?void 0x0:_0x26de0a['Id'];if(!_0x32e83f)throw new Error(errors_1[_0x532b3(0x139)]);return _0x32e83f;}async[a136_0x36f816(0x125)](_0x5b52e1){const _0x128ec1=a136_0x36f816;let _0x13711e=await this['getAttachmentId'](_0x5b52e1)[_0x128ec1(0x103)](()=>null);return!_0x13711e&&(_0x13711e=await this['salesforceService'][_0x128ec1(0x10a)](_0x128ec1(0x138),{'Body':utils_1[_0x128ec1(0x111)]('{}'),'ParentId':_0x5b52e1[_0x128ec1(0x11e)],'ContentType':_0x128ec1(0x11d),'Name':_0x5b52e1[_0x128ec1(0x10c)]?constants_1[_0x128ec1(0x12a)]:constants_1[_0x128ec1(0x140)]})),_0x13711e;}async[a136_0x36f816(0x13a)](_0x5a78c6,_0x12c09b){const _0x3e2752=a136_0x36f816,_0x400205=await this[_0x3e2752(0x125)](_0x5a78c6);await this[_0x3e2752(0x11f)][_0x3e2752(0x129)](_0x3e2752(0x138),_0x400205,{'Body':utils_1[_0x3e2752(0x111)](JSON[_0x3e2752(0x12f)](_0x12c09b))});}async[a136_0x36f816(0x142)](_0x4da048,_0x38ce77){const _0x1fe482=a136_0x36f816;await this[_0x1fe482(0x11f)][_0x1fe482(0x129)](_0x4da048[_0x1fe482(0x13e)],_0x4da048['objectId'],{[constants_1['FLOSUM_GIT_NAMESPACE']+'Synchronization_Status__c']:_0x38ce77});}async[a136_0x36f816(0x136)](_0x4966ea){const _0x420290=a136_0x36f816;await this[_0x420290(0x11f)][_0x420290(0x129)](constants_1['FLOSUM_GIT_NAMESPACE']+_0x420290(0x119),_0x4966ea,{[constants_1[_0x420290(0x122)]+_0x420290(0x123)]:![]});}};SalesforceSyncService=__decorate([typedi_1[a136_0x36f816(0x135)](),__metadata(a136_0x36f816(0x152),[salesforce_query_service_1[a136_0x36f816(0x10f)],salesforce_service_1[a136_0x36f816(0x128)]])],SalesforceSyncService),exports[a136_0x36f816(0x153)]=SalesforceSyncService;