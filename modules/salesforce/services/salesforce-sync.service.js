const a135_0x5e3ad9=a135_0x17d5;(function(_0x2e5f7c,_0x18143e){const _0x94645a=a135_0x17d5,_0x104dfb=_0x2e5f7c();while(!![]){try{const _0x5569c4=parseInt(_0x94645a(0xcf))/0x1+-parseInt(_0x94645a(0xc7))/0x2+-parseInt(_0x94645a(0xf6))/0x3*(parseInt(_0x94645a(0xf4))/0x4)+parseInt(_0x94645a(0xc2))/0x5+-parseInt(_0x94645a(0xe6))/0x6+parseInt(_0x94645a(0xd3))/0x7+parseInt(_0x94645a(0x104))/0x8*(parseInt(_0x94645a(0xce))/0x9);if(_0x5569c4===_0x18143e)break;else _0x104dfb['push'](_0x104dfb['shift']());}catch(_0xbf3242){_0x104dfb['push'](_0x104dfb['shift']());}}}(a135_0x337d,0x432af));function a135_0x17d5(_0x3b77d6,_0x3f0cb5){const _0x15af15=a135_0x337d();return a135_0x17d5=function(_0x4c90a9,_0x8165b8){_0x4c90a9=_0x4c90a9-0xb8;let _0x337d15=_0x15af15[_0x4c90a9];return _0x337d15;},a135_0x17d5(_0x3b77d6,_0x3f0cb5);}const a135_0x8165b8=(function(){let _0x3cb40c=!![];return function(_0x46f294,_0x231766){const _0x59c0e5=_0x3cb40c?function(){const _0xd4a0b2=a135_0x17d5;if(_0x231766){const _0x2ca7e1=_0x231766[_0xd4a0b2(0xfd)](_0x46f294,arguments);return _0x231766=null,_0x2ca7e1;}}:function(){};return _0x3cb40c=![],_0x59c0e5;};}()),a135_0x4c90a9=a135_0x8165b8(this,function(){const _0x498fc3=a135_0x17d5;return a135_0x4c90a9[_0x498fc3(0xf2)]()[_0x498fc3(0xbe)]('(((.+)+)+)+$')[_0x498fc3(0xf2)]()['constructor'](a135_0x4c90a9)['search'](_0x498fc3(0xc4));});function a135_0x337d(){const _0x27d578=['119312CGzKpa','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','../../../constants/errors','Attachment','GET_BRANCH_BY_NAME_QUERY','getBranchRecords','getRepositoryRecordByName','updateRemoteState','getOwnPropertyDescriptor','GET_WAITING_BRANCHES_QUERY','./salesforce-query.service','design:paramtypes','../../../constants','SalesforceSyncService','__esModule','defineProperty','objectId','getRemoteStateAttachmentId','../dto/flosum-repository-sync.dto','search','repositoryId','function','records','2334075rQaLoV','FLOSUM_GIT_NAMESPACE','(((.+)+)+)+$','\x20not\x20found\x20on\x20salesforce','SYNC_ATTACHMENT_FOR_BRANCH_NAME','674880EDSsSo','stringify','\x0a\x20\x20\x20\x20\x20\x20','getBranchComponents','__metadata','ERR_INVALID_ATTACHMENT_ID','getBranchRecord','144zONHxk','89181RXBKbm','fromBranchRecord','getBranchRecordByName','length','2610055xRYvNX','patchObject','Repository\x20','metadata','decorate','FlosumRepositorySyncDto','SalesforceNotFoundError','disableSync','Synchronization_Status__c','replace','./salesforce.service','SalesforceService','GET_REPOSITORY_BY_NAME_QUERY','\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27','getComponents','catch','typedi','setStatus','__decorate','1097208AJPfOh','getAttachmentId','fromRepositoryRecord','Git_Settings__c','Sync_In_Progress__c','Components__r','map','GET_BRANCH_QUERY','encodeBase64','%name%','getComponentsFromRepository','%id%','toString','../errors/not-found.error','1488232oBqwkZ','object','3vTJrYO','query','Branch\x20with\x20Id\x20','SalesforceQueryService','salesforceService','Service','Branch\x20','apply','%parentId%','salesforceQuery','../../shared/utils','GET_REPOSITORY_QUERY','objectType','GET_COMPONENTS_QUERY'];a135_0x337d=function(){return _0x27d578;};return a135_0x337d();}a135_0x4c90a9();'use strict';var __decorate=this&&this[a135_0x5e3ad9(0xe5)]||function(_0x44051d,_0x38e919,_0x18f654,_0x22d517){const _0x613201=a135_0x5e3ad9;var _0x4c9b10=arguments[_0x613201(0xd2)],_0x2c9156=_0x4c9b10<0x3?_0x38e919:_0x22d517===null?_0x22d517=Object[_0x613201(0x10c)](_0x38e919,_0x18f654):_0x22d517,_0x211523;if(typeof Reflect===_0x613201(0xf5)&&typeof Reflect[_0x613201(0xd7)]===_0x613201(0xc0))_0x2c9156=Reflect[_0x613201(0xd7)](_0x44051d,_0x38e919,_0x18f654,_0x22d517);else{for(var _0x5593ee=_0x44051d[_0x613201(0xd2)]-0x1;_0x5593ee>=0x0;_0x5593ee--)if(_0x211523=_0x44051d[_0x5593ee])_0x2c9156=(_0x4c9b10<0x3?_0x211523(_0x2c9156):_0x4c9b10>0x3?_0x211523(_0x38e919,_0x18f654,_0x2c9156):_0x211523(_0x38e919,_0x18f654))||_0x2c9156;}return _0x4c9b10>0x3&&_0x2c9156&&Object['defineProperty'](_0x38e919,_0x18f654,_0x2c9156),_0x2c9156;},__metadata=this&&this[a135_0x5e3ad9(0xcb)]||function(_0x1f16f4,_0x2f3040){const _0x15ed74=a135_0x5e3ad9;if(typeof Reflect===_0x15ed74(0xf5)&&typeof Reflect[_0x15ed74(0xd6)]==='function')return Reflect[_0x15ed74(0xd6)](_0x1f16f4,_0x2f3040);};Object[a135_0x5e3ad9(0xba)](exports,a135_0x5e3ad9(0xb9),{'value':!![]}),exports[a135_0x5e3ad9(0xb8)]=void 0x0;const typedi_1=require(a135_0x5e3ad9(0xe3)),constants_1=require(a135_0x5e3ad9(0x110)),errors_1=require(a135_0x5e3ad9(0x106)),utils_1=require(a135_0x5e3ad9(0x100)),flosum_repository_sync_dto_1=require(a135_0x5e3ad9(0xbd)),not_found_error_1=require(a135_0x5e3ad9(0xf3)),queries_1=require('../queries'),salesforce_query_service_1=require(a135_0x5e3ad9(0x10e)),salesforce_service_1=require(a135_0x5e3ad9(0xdd));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x543577,_0x30014a){const _0x19474c=a135_0x5e3ad9;this[_0x19474c(0xff)]=_0x543577,this[_0x19474c(0xfa)]=_0x30014a;}async['getComponents'](_0x468d63){const _0x11d1f6=a135_0x5e3ad9;var _0x385a6a;const _0x2b41fe=await this[_0x11d1f6(0xff)][_0x11d1f6(0xf7)](_0x468d63),_0x32edd5=[];for(const _0x13edc3 of _0x2b41fe){const _0x367dfc=(_0x385a6a=_0x13edc3[constants_1['FLOSUM_NAMESPACE']+_0x11d1f6(0xeb)])===null||_0x385a6a===void 0x0?void 0x0:_0x385a6a[_0x11d1f6(0xc1)];_0x367dfc&&_0x367dfc[_0x11d1f6(0xd2)]&&_0x32edd5['push'](_0x367dfc[0x0]['Id']);}return _0x32edd5;}async['getRepositoryRecords'](){const _0x2efc5d=a135_0x5e3ad9,_0x596110=await this[_0x2efc5d(0xff)][_0x2efc5d(0xf7)](queries_1['GET_WAITING_REPOSITORIES_QUERY']);return _0x596110['map'](_0x5c3d43=>flosum_repository_sync_dto_1[_0x2efc5d(0xd8)][_0x2efc5d(0xe8)](_0x5c3d43));}async[a135_0x5e3ad9(0x109)](){const _0x7a7658=a135_0x5e3ad9,_0x4f542c=await this['salesforceQuery'][_0x7a7658(0xf7)](queries_1[_0x7a7658(0x10d)]);return _0x4f542c[_0x7a7658(0xec)](_0x43982c=>flosum_repository_sync_dto_1[_0x7a7658(0xd8)][_0x7a7658(0xd0)](_0x43982c));}async['getRepositoryRecord'](_0x42b2d2){const _0x1ef040=a135_0x5e3ad9,_0x3cb658=await this[_0x1ef040(0xff)]['query'](queries_1[_0x1ef040(0x101)][_0x1ef040(0xdc)](_0x1ef040(0xf1),_0x42b2d2));if(_0x3cb658[_0x1ef040(0xd2)]===0x0)throw new not_found_error_1[(_0x1ef040(0xd9))]('Repository\x20with\x20Id\x20'+_0x42b2d2+_0x1ef040(0xc5));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x1ef040(0xe8)](_0x3cb658[0x0]);}async[a135_0x5e3ad9(0xcd)](_0x561ffa){const _0x8c3b16=a135_0x5e3ad9,_0x3e9f65=await this['salesforceQuery'][_0x8c3b16(0xf7)](queries_1[_0x8c3b16(0xed)][_0x8c3b16(0xdc)](_0x8c3b16(0xf1),_0x561ffa));if(_0x3e9f65[_0x8c3b16(0xd2)]===0x0)throw new not_found_error_1[(_0x8c3b16(0xd9))](_0x8c3b16(0xf8)+_0x561ffa+_0x8c3b16(0xc5));return flosum_repository_sync_dto_1[_0x8c3b16(0xd8)]['fromBranchRecord'](_0x3e9f65[0x0]);}async[a135_0x5e3ad9(0xd1)](_0x2fc6e8){const _0x48ef14=a135_0x5e3ad9,_0x4b48c4=await this[_0x48ef14(0xff)]['query'](queries_1[_0x48ef14(0x108)][_0x48ef14(0xdc)](_0x48ef14(0xef),_0x2fc6e8));if(_0x4b48c4['length']===0x0)throw new not_found_error_1[(_0x48ef14(0xd9))](_0x48ef14(0xfc)+_0x2fc6e8+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x48ef14(0xd8)][_0x48ef14(0xd0)](_0x4b48c4[0x0]);}async[a135_0x5e3ad9(0x10a)](_0x4373e3){const _0x2d9e4e=a135_0x5e3ad9,_0x24eb1f=await this['salesforceQuery']['query'](queries_1[_0x2d9e4e(0xdf)][_0x2d9e4e(0xdc)]('%name%',_0x4373e3));if(_0x24eb1f[_0x2d9e4e(0xd2)]===0x0)throw new not_found_error_1[(_0x2d9e4e(0xd9))](_0x2d9e4e(0xd5)+_0x4373e3+_0x2d9e4e(0xc5));return flosum_repository_sync_dto_1[_0x2d9e4e(0xd8)][_0x2d9e4e(0xe8)](_0x24eb1f[0x0]);}async[a135_0x5e3ad9(0xf0)](_0x5d7483){const _0xf9085=a135_0x5e3ad9,_0x17f791=_0xf9085(0xc9)+queries_1[_0xf9085(0x103)]+_0xf9085(0xe0)+_0x5d7483+'\x27';return this[_0xf9085(0xe1)](_0x17f791);}async[a135_0x5e3ad9(0xca)](_0xf6abc2){const _0x247e6c='\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+queries_1['GET_COMPONENTS_QUERY']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27'+_0xf6abc2+'\x27';return this['getComponents'](_0x247e6c);}async['getAttachmentId'](_0x244297){const _0x3b4b70=a135_0x5e3ad9;var _0x441496;const _0x16724f=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY'][_0x3b4b70(0xdc)](_0x3b4b70(0xfe),_0x244297['objectId'])[_0x3b4b70(0xdc)](_0x3b4b70(0xef),_0x244297[_0x3b4b70(0xbf)]?constants_1['SYNC_ATTACHMENT_FOR_REPOSITORY_NAME']:constants_1[_0x3b4b70(0xc6)]),_0x5bf9b8=await this[_0x3b4b70(0xff)][_0x3b4b70(0xf7)](_0x16724f),_0x29d2e8=(_0x441496=_0x5bf9b8[0x0])===null||_0x441496===void 0x0?void 0x0:_0x441496['Id'];if(!_0x29d2e8)throw new Error(errors_1[_0x3b4b70(0xcc)]);return _0x29d2e8;}async[a135_0x5e3ad9(0xbc)](_0x410881){const _0xed9d1d=a135_0x5e3ad9;let _0x369d52=await this[_0xed9d1d(0xe7)](_0x410881)[_0xed9d1d(0xe2)](()=>null);return!_0x369d52&&(_0x369d52=await this['salesforceService']['createObject']('Attachment',{'Body':utils_1['encodeBase64']('{}'),'ParentId':_0x410881[_0xed9d1d(0xbb)],'ContentType':'text/plain','Name':_0x410881['repositoryId']?constants_1[_0xed9d1d(0x105)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']})),_0x369d52;}async[a135_0x5e3ad9(0x10b)](_0xe80cb0,_0x9e70a9){const _0xd4eae=a135_0x5e3ad9,_0x6a6515=await this[_0xd4eae(0xbc)](_0xe80cb0);await this[_0xd4eae(0xfa)][_0xd4eae(0xd4)](_0xd4eae(0x107),_0x6a6515,{'Body':utils_1[_0xd4eae(0xee)](JSON[_0xd4eae(0xc8)](_0x9e70a9))});}async[a135_0x5e3ad9(0xe4)](_0x4a33ce,_0x55077d){const _0x3a26ff=a135_0x5e3ad9;await this['salesforceService'][_0x3a26ff(0xd4)](_0x4a33ce[_0x3a26ff(0x102)],_0x4a33ce[_0x3a26ff(0xbb)],{[constants_1[_0x3a26ff(0xc3)]+_0x3a26ff(0xdb)]:_0x55077d});}async[a135_0x5e3ad9(0xda)](_0x6ae9dd){const _0x19274a=a135_0x5e3ad9;await this[_0x19274a(0xfa)][_0x19274a(0xd4)](constants_1[_0x19274a(0xc3)]+_0x19274a(0xe9),_0x6ae9dd,{[constants_1[_0x19274a(0xc3)]+_0x19274a(0xea)]:![]});}};SalesforceSyncService=__decorate([typedi_1[a135_0x5e3ad9(0xfb)](),__metadata(a135_0x5e3ad9(0x10f),[salesforce_query_service_1[a135_0x5e3ad9(0xf9)],salesforce_service_1[a135_0x5e3ad9(0xde)]])],SalesforceSyncService),exports[a135_0x5e3ad9(0xb8)]=SalesforceSyncService;