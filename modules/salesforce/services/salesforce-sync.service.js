const a136_0xb24a4=a136_0x89d7;(function(_0x216db2,_0x25e111){const _0x5a555c=a136_0x89d7,_0x1a0d82=_0x216db2();while(!![]){try{const _0x330779=parseInt(_0x5a555c(0x74))/0x1*(parseInt(_0x5a555c(0x6f))/0x2)+-parseInt(_0x5a555c(0xb9))/0x3*(-parseInt(_0x5a555c(0xa8))/0x4)+-parseInt(_0x5a555c(0xaf))/0x5+parseInt(_0x5a555c(0x75))/0x6+-parseInt(_0x5a555c(0x6e))/0x7+parseInt(_0x5a555c(0x8b))/0x8*(parseInt(_0x5a555c(0x72))/0x9)+-parseInt(_0x5a555c(0x9f))/0xa*(parseInt(_0x5a555c(0xa6))/0xb);if(_0x330779===_0x25e111)break;else _0x1a0d82['push'](_0x1a0d82['shift']());}catch(_0x242b04){_0x1a0d82['push'](_0x1a0d82['shift']());}}}(a136_0x4263,0x2297b));const a136_0x278629=(function(){let _0x2429c1=!![];return function(_0x46bf14,_0x44d727){const _0xdf425=_0x2429c1?function(){const _0x5048e2=a136_0x89d7;if(_0x44d727){const _0x45d032=_0x44d727[_0x5048e2(0xac)](_0x46bf14,arguments);return _0x44d727=null,_0x45d032;}}:function(){};return _0x2429c1=![],_0xdf425;};}()),a136_0x477255=a136_0x278629(this,function(){const _0xf7245c=a136_0x89d7;return a136_0x477255[_0xf7245c(0xbb)]()[_0xf7245c(0x77)](_0xf7245c(0x8c))[_0xf7245c(0xbb)]()['constructor'](a136_0x477255)[_0xf7245c(0x77)](_0xf7245c(0x8c));});function a136_0x4263(){const _0x2d9728=['GET_REPOSITORY_QUERY','286792aZQYOR','Repository\x20with\x20Id\x20','FLOSUM_GIT_NAMESPACE','%id%','apply','../errors/not-found.error','getRepositoryRecordByName','222290rhtgyn','SYNC_ATTACHMENT_FOR_BRANCH_NAME','FlosumRepositorySyncDto','records','map','FLOSUM_NAMESPACE','getBranchRecord','SalesforceQueryService','salesforceQuery','objectType','6wvwjbz','Git_Settings__c','toString','GET_COMPONENTS_QUERY','1275876Qmnrhe','20998nIQYJb','\x20not\x20found\x20on\x20salesforce','getComponentsFromRepository','1656vsngge','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','3sTZEVA','1045428jbzmqr','decorate','search','__decorate','metadata','query','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getRepositoryRecords','objectId','fromRepositoryRecord','patchObject','GET_WAITING_REPOSITORIES_QUERY','defineProperty','getAttachmentId','repositoryId','getBranchRecordByName','catch','ERR_INVALID_ATTACHMENT_ID','__metadata','object','Branch\x20','function','6320tfwdsI','(((.+)+)+)+$','Sync_In_Progress__c','getComponents','length','./salesforce-query.service','%name%','GET_WAITING_BRANCHES_QUERY','getRepositoryRecord','SalesforceNotFoundError','replace','getBranchComponents','getRemoteStateAttachmentId','design:paramtypes','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','push','Repository\x20','getBranchRecords','GET_BRANCH_QUERY','setStatus','1260740JDTiuY','../../../constants','salesforceService','fromBranchRecord','Branch\x20with\x20Id\x20','GET_BRANCH_BY_NAME_QUERY','SalesforceService','11zpcRjb'];a136_0x4263=function(){return _0x2d9728;};return a136_0x4263();}a136_0x477255();function a136_0x89d7(_0x23cf43,_0x126851){const _0x18de9b=a136_0x4263();return a136_0x89d7=function(_0x477255,_0x278629){_0x477255=_0x477255-0x6e;let _0x426366=_0x18de9b[_0x477255];return _0x426366;},a136_0x89d7(_0x23cf43,_0x126851);}'use strict';var __decorate=this&&this[a136_0xb24a4(0x78)]||function(_0x37dd27,_0x1d1690,_0x2025ac,_0x219607){const _0x38a9a0=a136_0xb24a4;var _0x142355=arguments[_0x38a9a0(0x8f)],_0x11f489=_0x142355<0x3?_0x1d1690:_0x219607===null?_0x219607=Object['getOwnPropertyDescriptor'](_0x1d1690,_0x2025ac):_0x219607,_0x38e4e8;if(typeof Reflect==='object'&&typeof Reflect[_0x38a9a0(0x76)]==='function')_0x11f489=Reflect[_0x38a9a0(0x76)](_0x37dd27,_0x1d1690,_0x2025ac,_0x219607);else{for(var _0x7bd18d=_0x37dd27[_0x38a9a0(0x8f)]-0x1;_0x7bd18d>=0x0;_0x7bd18d--)if(_0x38e4e8=_0x37dd27[_0x7bd18d])_0x11f489=(_0x142355<0x3?_0x38e4e8(_0x11f489):_0x142355>0x3?_0x38e4e8(_0x1d1690,_0x2025ac,_0x11f489):_0x38e4e8(_0x1d1690,_0x2025ac))||_0x11f489;}return _0x142355>0x3&&_0x11f489&&Object['defineProperty'](_0x1d1690,_0x2025ac,_0x11f489),_0x11f489;},__metadata=this&&this[a136_0xb24a4(0x87)]||function(_0x3c2015,_0x242748){const _0x1b25cf=a136_0xb24a4;if(typeof Reflect===_0x1b25cf(0x88)&&typeof Reflect[_0x1b25cf(0x79)]===_0x1b25cf(0x8a))return Reflect['metadata'](_0x3c2015,_0x242748);};Object[a136_0xb24a4(0x81)](exports,'__esModule',{'value':!![]}),exports['SalesforceSyncService']=void 0x0;const typedi_1=require('typedi'),constants_1=require(a136_0xb24a4(0xa0)),errors_1=require('../../../constants/errors'),utils_1=require('../../shared/utils'),flosum_repository_sync_dto_1=require('../dto/flosum-repository-sync.dto'),not_found_error_1=require(a136_0xb24a4(0xad)),queries_1=require('../queries'),salesforce_query_service_1=require(a136_0xb24a4(0x90)),salesforce_service_1=require('./salesforce.service');let SalesforceSyncService=class SalesforceSyncService{constructor(_0x20ad01,_0x2bd560){const _0x1d2a09=a136_0xb24a4;this[_0x1d2a09(0xb7)]=_0x20ad01,this[_0x1d2a09(0xa1)]=_0x2bd560;}async[a136_0xb24a4(0x8e)](_0x55ed8d){const _0x22fca3=a136_0xb24a4;var _0x17006c;const _0x29f2e1=await this['salesforceQuery'][_0x22fca3(0x7a)](_0x55ed8d),_0x1e253b=[];for(const _0x1f50ab of _0x29f2e1){const _0x5f18fa=(_0x17006c=_0x1f50ab[constants_1[_0x22fca3(0xb4)]+'Components__r'])===null||_0x17006c===void 0x0?void 0x0:_0x17006c[_0x22fca3(0xb2)];_0x5f18fa&&_0x5f18fa['length']&&_0x1e253b[_0x22fca3(0x9a)](_0x5f18fa[0x0]['Id']);}return _0x1e253b;}async[a136_0xb24a4(0x7c)](){const _0x189c8f=a136_0xb24a4,_0xaf994=await this['salesforceQuery']['query'](queries_1[_0x189c8f(0x80)]);return _0xaf994['map'](_0x203045=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x189c8f(0x7e)](_0x203045));}async[a136_0xb24a4(0x9c)](){const _0x14f7d8=a136_0xb24a4,_0x3c2611=await this[_0x14f7d8(0xb7)][_0x14f7d8(0x7a)](queries_1[_0x14f7d8(0x92)]);return _0x3c2611[_0x14f7d8(0xb3)](_0x31aad9=>flosum_repository_sync_dto_1[_0x14f7d8(0xb1)][_0x14f7d8(0xa2)](_0x31aad9));}async[a136_0xb24a4(0x93)](_0x3f3058){const _0x1104f9=a136_0xb24a4,_0x3e1739=await this[_0x1104f9(0xb7)][_0x1104f9(0x7a)](queries_1[_0x1104f9(0xa7)]['replace'](_0x1104f9(0xab),_0x3f3058));if(_0x3e1739[_0x1104f9(0x8f)]===0x0)throw new not_found_error_1[(_0x1104f9(0x94))](_0x1104f9(0xa9)+_0x3f3058+_0x1104f9(0x70));return flosum_repository_sync_dto_1[_0x1104f9(0xb1)][_0x1104f9(0x7e)](_0x3e1739[0x0]);}async[a136_0xb24a4(0xb5)](_0x71fe04){const _0x427620=a136_0xb24a4,_0x54d780=await this[_0x427620(0xb7)][_0x427620(0x7a)](queries_1[_0x427620(0x9d)][_0x427620(0x95)](_0x427620(0xab),_0x71fe04));if(_0x54d780[_0x427620(0x8f)]===0x0)throw new not_found_error_1[(_0x427620(0x94))](_0x427620(0xa3)+_0x71fe04+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x427620(0xa2)](_0x54d780[0x0]);}async[a136_0xb24a4(0x84)](_0x27b255){const _0x4b117d=a136_0xb24a4,_0xea1d5=await this[_0x4b117d(0xb7)]['query'](queries_1[_0x4b117d(0xa4)][_0x4b117d(0x95)]('%name%',_0x27b255));if(_0xea1d5['length']===0x0)throw new not_found_error_1[(_0x4b117d(0x94))](_0x4b117d(0x89)+_0x27b255+_0x4b117d(0x70));return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x4b117d(0xa2)](_0xea1d5[0x0]);}async[a136_0xb24a4(0xae)](_0x4a5b7a){const _0x5b7022=a136_0xb24a4,_0x6777de=await this[_0x5b7022(0xb7)][_0x5b7022(0x7a)](queries_1['GET_REPOSITORY_BY_NAME_QUERY'][_0x5b7022(0x95)](_0x5b7022(0x91),_0x4a5b7a));if(_0x6777de[_0x5b7022(0x8f)]===0x0)throw new not_found_error_1['SalesforceNotFoundError'](_0x5b7022(0x9b)+_0x4a5b7a+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1[_0x5b7022(0xb1)][_0x5b7022(0x7e)](_0x6777de[0x0]);}async[a136_0xb24a4(0x71)](_0x50fa13){const _0x479683=a136_0xb24a4,_0x2775b0='\x0a\x20\x20\x20\x20\x20\x20'+queries_1[_0x479683(0xbc)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0x50fa13+'\x27';return this[_0x479683(0x8e)](_0x2775b0);}async[a136_0xb24a4(0x96)](_0xfbb784){const _0x5739db=a136_0xb24a4,_0x8c3f2f=_0x5739db(0x7b)+queries_1[_0x5739db(0xbc)]+_0x5739db(0x73)+_0xfbb784+'\x27';return this[_0x5739db(0x8e)](_0x8c3f2f);}async[a136_0xb24a4(0x82)](_0x241c7f){const _0x1f1ed5=a136_0xb24a4;var _0x2c1293;const _0x4159c5=queries_1['GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY']['replace']('%parentId%',_0x241c7f[_0x1f1ed5(0x7d)])['replace'](_0x1f1ed5(0x91),_0x241c7f[_0x1f1ed5(0x83)]?constants_1[_0x1f1ed5(0x99)]:constants_1[_0x1f1ed5(0xb0)]),_0x313397=await this['salesforceQuery'][_0x1f1ed5(0x7a)](_0x4159c5),_0x127439=(_0x2c1293=_0x313397[0x0])===null||_0x2c1293===void 0x0?void 0x0:_0x2c1293['Id'];if(!_0x127439)throw new Error(errors_1[_0x1f1ed5(0x86)]);return _0x127439;}async[a136_0xb24a4(0x97)](_0x152734){const _0x105b57=a136_0xb24a4;let _0x325eb0=await this['getAttachmentId'](_0x152734)[_0x105b57(0x85)](()=>null);return!_0x325eb0&&(_0x325eb0=await this[_0x105b57(0xa1)]['createObject']('Attachment',{'Body':utils_1['encodeBase64']('{}'),'ParentId':_0x152734[_0x105b57(0x7d)],'ContentType':'text/plain','Name':_0x152734['repositoryId']?constants_1[_0x105b57(0x99)]:constants_1[_0x105b57(0xb0)]})),_0x325eb0;}async['updateRemoteState'](_0x1c9cf5,_0x2f4818){const _0x4ecf25=a136_0xb24a4,_0x5aa0b1=await this[_0x4ecf25(0x97)](_0x1c9cf5);await this[_0x4ecf25(0xa1)][_0x4ecf25(0x7f)]('Attachment',_0x5aa0b1,{'Body':utils_1['encodeBase64'](JSON['stringify'](_0x2f4818))});}async[a136_0xb24a4(0x9e)](_0x1c31bc,_0x42f750){const _0x2e9397=a136_0xb24a4;await this['salesforceService'][_0x2e9397(0x7f)](_0x1c31bc[_0x2e9397(0xb8)],_0x1c31bc[_0x2e9397(0x7d)],{[constants_1[_0x2e9397(0xaa)]+'Synchronization_Status__c']:_0x42f750});}async['disableSync'](_0x2314e4){const _0x49838a=a136_0xb24a4;await this['salesforceService'][_0x49838a(0x7f)](constants_1['FLOSUM_GIT_NAMESPACE']+_0x49838a(0xba),_0x2314e4,{[constants_1[_0x49838a(0xaa)]+_0x49838a(0x8d)]:![]});}};SalesforceSyncService=__decorate([typedi_1['Service'](),__metadata(a136_0xb24a4(0x98),[salesforce_query_service_1[a136_0xb24a4(0xb6)],salesforce_service_1[a136_0xb24a4(0xa5)]])],SalesforceSyncService),exports['SalesforceSyncService']=SalesforceSyncService;