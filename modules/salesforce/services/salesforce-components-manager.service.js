const a128_0x2d025d=a128_0x3546;(function(_0x127b5e,_0x1d6d2d){const _0x3350a3=a128_0x3546,_0x47458c=_0x127b5e();while(!![]){try{const _0xe44a8f=-parseInt(_0x3350a3(0x136))/0x1+parseInt(_0x3350a3(0x156))/0x2+-parseInt(_0x3350a3(0x11a))/0x3*(parseInt(_0x3350a3(0x130))/0x4)+-parseInt(_0x3350a3(0x155))/0x5*(parseInt(_0x3350a3(0x13c))/0x6)+-parseInt(_0x3350a3(0x11f))/0x7*(-parseInt(_0x3350a3(0x105))/0x8)+-parseInt(_0x3350a3(0x118))/0x9*(parseInt(_0x3350a3(0xff))/0xa)+parseInt(_0x3350a3(0x119))/0xb;if(_0xe44a8f===_0x1d6d2d)break;else _0x47458c['push'](_0x47458c['shift']());}catch(_0x534ee3){_0x47458c['push'](_0x47458c['shift']());}}}(a128_0x4999,0x5c296));const a128_0x5ac4c9=(function(){let _0x50c145=!![];return function(_0x3d496c,_0x25f3b6){const _0x4d64bc=_0x50c145?function(){const _0x8b5db4=a128_0x3546;if(_0x25f3b6){const _0x227e6d=_0x25f3b6[_0x8b5db4(0x12f)](_0x3d496c,arguments);return _0x25f3b6=null,_0x227e6d;}}:function(){};return _0x50c145=![],_0x4d64bc;};}()),a128_0x2a8111=a128_0x5ac4c9(this,function(){const _0x259fca=a128_0x3546;return a128_0x2a8111['toString']()[_0x259fca(0x107)](_0x259fca(0x14e))[_0x259fca(0x144)]()[_0x259fca(0x112)](a128_0x2a8111)[_0x259fca(0x107)](_0x259fca(0x14e));});a128_0x2a8111();'use strict';var __importDefault=this&&this[a128_0x2d025d(0x125)]||function(_0x2de54a){return _0x2de54a&&_0x2de54a['__esModule']?_0x2de54a:{'default':_0x2de54a};};Object[a128_0x2d025d(0x14d)](exports,a128_0x2d025d(0x159),{'value':!![]}),exports[a128_0x2d025d(0x148)]=void 0x0;const constants_1=require(a128_0x2d025d(0x108)),core_1=require(a128_0x2d025d(0x140)),zip_1=require(a128_0x2d025d(0x111)),typedi_1=__importDefault(require(a128_0x2d025d(0x121))),salesforce_error_1=require(a128_0x2d025d(0x103)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a128_0x2d025d(0x114));function a128_0x3546(_0x2cf712,_0x2918ac){const _0x57a968=a128_0x4999();return a128_0x3546=function(_0x2a8111,_0x5ac4c9){_0x2a8111=_0x2a8111-0xfd;let _0x499996=_0x57a968[_0x2a8111];return _0x499996;},a128_0x3546(_0x2cf712,_0x2918ac);}class SalesforceComponentsManager{constructor(_0x507f8a,_0x170bfd,_0x42e22f,_0x5d4dd4,_0x59d3f0){const _0x4205d2=a128_0x2d025d;this[_0x4205d2(0x12a)]=_0x507f8a,this[_0x4205d2(0x104)]=_0x170bfd,this[_0x4205d2(0x145)]=_0x42e22f,this['recordTypes']=_0x5d4dd4,this[_0x4205d2(0x135)]=_0x59d3f0,this[_0x4205d2(0xfe)]=new core_1[(_0x4205d2(0x12d))](SalesforceComponentsManager[_0x4205d2(0x131)]),this['gitSync']=typedi_1['default']['get'](salesforce_git_sync_service_1['SalesforceGitSyncService']);}['proceedComponentMeta'](_0x4a3f55,_0x3acdb6){const _0x20f7b6=a128_0x2d025d,_0x572689=flosum_naming_utils_1['extractFieldsFromRecord'](_0x4a3f55,['Component_Type__c',_0x20f7b6(0x124),'Version__c']);this[_0x20f7b6(0x135)][_0x20f7b6(0x10b)]({'componentId':'','reference':_0x3acdb6,'version':_0x572689[_0x20f7b6(0x12c)],'componentName':_0x572689[_0x20f7b6(0x124)],'componentType':_0x572689['Component_Type__c']});}[a128_0x2d025d(0x14f)](_0x211dbc,_0x5e5755){const _0x3188a1=a128_0x2d025d,{request:_0x56ccf0}=composite_utils_1[_0x3188a1(0x14c)](constants_1[_0x3188a1(0x137)],{[constants_1[_0x3188a1(0x139)]+_0x3188a1(0x116)]:_0x211dbc,[constants_1[_0x3188a1(0x139)]+_0x3188a1(0x13b)]:_0x5e5755});return _0x56ccf0;}async['prepareComponentAttachmentRecord'](_0x5062e8,_0x2ea78c){const _0x55f82e=a128_0x2d025d,_0x3a2f71={},_0x558a83=zip_1['Zip'][_0x55f82e(0x13a)]();for(const _0x364730 of Object[_0x55f82e(0x127)](_0x5062e8[_0x55f82e(0x158)])){_0x558a83[_0x55f82e(0x101)](_0x364730,_0x5062e8[_0x55f82e(0x158)][_0x364730],{'createFolders':!![]});}return _0x3a2f71['ContentType']=_0x55f82e(0x151),_0x3a2f71['Name']=_0x5062e8['type'],_0x3a2f71['Description']=_0x5062e8[_0x55f82e(0x10d)],_0x3a2f71[_0x55f82e(0x14a)]=_0x2ea78c,_0x3a2f71[_0x55f82e(0xfd)]=await _0x558a83[_0x55f82e(0x113)]({'type':'base64','compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x3a2f71;}[a128_0x2d025d(0x100)](_0x17fd80,_0x3fbfc5,_0x3ed5a3){const _0x2efea0=a128_0x2d025d,_0xf94b06=new Date()[_0x2efea0(0x142)](),_0x291f27={};return _0x291f27[constants_1[_0x2efea0(0x139)]+'Component__c']=_0x3fbfc5,_0x291f27[constants_1[_0x2efea0(0x139)]+'CRC32__c']=_0x17fd80[_0x2efea0(0x141)],_0x291f27[constants_1['FLOSUM_NAMESPACE']+_0x2efea0(0x138)]=_0xf94b06,_0x291f27[constants_1['FLOSUM_NAMESPACE']+'Changed_By__c']=this[_0x2efea0(0x145)],_0x291f27[constants_1['FLOSUM_NAMESPACE']+_0x2efea0(0x12c)]=_0x3ed5a3?_0x3ed5a3+0x1:0x1,_0x291f27[constants_1['FLOSUM_GIT_NAMESPACE']+'Is_From_Agent__c']=!![],_0x291f27;}[a128_0x2d025d(0x106)](_0x52f590,_0xb70ded){const _0x3e2a6=a128_0x2d025d;var _0x1ef346,_0x2ecb3c;const _0x4c0cdc=new Date()[_0x3e2a6(0x142)](),_0x599bfc={};return!_0xb70ded?(this['branchId']?(_0x599bfc[constants_1[_0x3e2a6(0x139)]+_0x3e2a6(0x10a)]=this[_0x3e2a6(0x104)],_0x599bfc[constants_1['FLOSUM_NAMESPACE']+_0x3e2a6(0x13d)]=_0x3e2a6(0x14b),_0x599bfc['RecordTypeId']=(_0x1ef346=this[_0x3e2a6(0x157)]['find'](_0x37b808=>_0x37b808[_0x3e2a6(0x131)]===_0x3e2a6(0x14b)))===null||_0x1ef346===void 0x0?void 0x0:_0x1ef346['id']):(_0x599bfc[constants_1[_0x3e2a6(0x139)]+_0x3e2a6(0x122)]=this[_0x3e2a6(0x12a)],_0x599bfc[constants_1['FLOSUM_NAMESPACE']+_0x3e2a6(0x13d)]=_0x3e2a6(0x147),_0x599bfc[_0x3e2a6(0x11b)]=(_0x2ecb3c=this['recordTypes']['find'](_0x1163d7=>_0x1163d7[_0x3e2a6(0x131)]==='Repository'))===null||_0x2ecb3c===void 0x0?void 0x0:_0x2ecb3c['id']),_0x599bfc[constants_1[_0x3e2a6(0x139)]+'Version__c']=0x1):_0x599bfc[constants_1[_0x3e2a6(0x139)]+_0x3e2a6(0x12c)]=_0xb70ded[_0x3e2a6(0x11d)]+0x1,_0x599bfc[constants_1[_0x3e2a6(0x139)]+_0x3e2a6(0x153)]=_0x52f590[_0x3e2a6(0x10d)],_0x599bfc[constants_1[_0x3e2a6(0x139)]+'Component_Name__c']=_0x52f590['name'],_0x599bfc[constants_1[_0x3e2a6(0x139)]+_0x3e2a6(0x123)]=_0x52f590[_0x3e2a6(0x12b)],_0x599bfc[constants_1[_0x3e2a6(0x139)]+'Last_Updated_By__c']=this[_0x3e2a6(0x145)],_0x599bfc[constants_1[_0x3e2a6(0x139)]+_0x3e2a6(0x143)]=this['username'],_0x599bfc[constants_1['FLOSUM_NAMESPACE']+'Last_Modified_Date__c']=_0x4c0cdc,_0x599bfc[constants_1['FLOSUM_NAMESPACE']+_0x3e2a6(0x12e)]=_0x4c0cdc,_0x599bfc[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x52f590[_0x3e2a6(0x141)],_0x599bfc;}[a128_0x2d025d(0x11c)](){const _0x7ff1d0=a128_0x2d025d;return this[_0x7ff1d0(0x135)];}async['insert'](_0x2a6e3b,_0x57716c){const _0x5d2adb=a128_0x2d025d,_0x481d3f=[];for(const _0x53983d of _0x2a6e3b){const _0xd40b20=composite_utils_1['createPostRequest'](constants_1[_0x5d2adb(0x115)],this[_0x5d2adb(0x106)](_0x53983d)),_0x1798ef=composite_utils_1[_0x5d2adb(0x14c)](constants_1[_0x5d2adb(0x132)],this['prepareComponentHistoryRecord'](_0x53983d,'@{'+_0xd40b20[_0x5d2adb(0x154)]+_0x5d2adb(0x13f))),_0xf9fb26=composite_utils_1[_0x5d2adb(0x14c)](constants_1[_0x5d2adb(0x134)],await this[_0x5d2adb(0x10e)](_0x53983d,'@{'+_0x1798ef[_0x5d2adb(0x154)]+'.id}'));this[_0x5d2adb(0x13e)](_0xd40b20[_0x5d2adb(0x11e)]['body'],_0xd40b20['reference']),_0x481d3f['push'](_0xd40b20[_0x5d2adb(0x11e)],_0x1798ef[_0x5d2adb(0x11e)],_0xf9fb26[_0x5d2adb(0x11e)]),_0x57716c&&_0x481d3f[_0x5d2adb(0x10b)](this[_0x5d2adb(0x14f)](_0x57716c,'@{'+_0x1798ef[_0x5d2adb(0x154)]+_0x5d2adb(0x13f)));}return _0x481d3f;}async['update'](_0x1b14d9,_0x5c99d9=''){const _0x964a40=a128_0x2d025d,_0x24a23e=[];for(const {component:_0x4eb049,meta:_0x2ab5b3}of _0x1b14d9){if(!_0x2ab5b3['id']){const _0xb49163=this['proceededComponentsMeta'][_0x964a40(0x129)](_0x5471e6=>_0x5471e6[_0x964a40(0x120)]===_0x4eb049[_0x964a40(0x131)]&&_0x5471e6[_0x964a40(0x152)]===_0x4eb049[_0x964a40(0x10d)]);if(!_0xb49163)throw new salesforce_error_1['SalesforceError'](new Error('Could\x20not\x20proceed\x20component\x20'+_0x4eb049[_0x964a40(0x131)]+'\x20['+_0x4eb049[_0x964a40(0x10d)]+']\x20-\x20meta\x20not\x20found'));_0x2ab5b3['id']=_0xb49163['componentId'];}const _0x3f4fa5=composite_utils_1['createPatchRequest'](constants_1[_0x964a40(0x115)],_0x2ab5b3['id'],this[_0x964a40(0x106)](_0x4eb049,_0x2ab5b3)),_0x293ffd=composite_utils_1['createPostRequest'](constants_1[_0x964a40(0x132)],this[_0x964a40(0x100)](_0x4eb049,_0x2ab5b3['id'],_0x2ab5b3[_0x964a40(0x11d)])),_0x29b770=composite_utils_1['createPostRequest'](constants_1[_0x964a40(0x134)],await this[_0x964a40(0x10e)](_0x4eb049,'@{'+_0x293ffd[_0x964a40(0x154)]+_0x964a40(0x13f)));this[_0x964a40(0x13e)](_0x3f4fa5[_0x964a40(0x11e)]['body'],_0x3f4fa5[_0x964a40(0x154)]),_0x24a23e[_0x964a40(0x10b)](_0x3f4fa5[_0x964a40(0x11e)],_0x293ffd[_0x964a40(0x11e)],_0x29b770[_0x964a40(0x11e)]),_0x5c99d9&&_0x24a23e[_0x964a40(0x10b)](this[_0x964a40(0x14f)](_0x5c99d9,'@{'+_0x293ffd['reference']+_0x964a40(0x13f)));}return _0x24a23e;}async[a128_0x2d025d(0x149)](_0x449302,_0x56816c=![]){const _0x4acefa=a128_0x2d025d,_0x5a9ef5={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x54fc6a=[];for(const _0x543cf5 of _0x449302){if(_0x543cf5['id'])_0x54fc6a[_0x4acefa(0x10b)](_0x543cf5['id']);else{const _0x27667c=this['proceededComponentsMeta'][_0x4acefa(0x129)](_0x1ab6ac=>_0x1ab6ac['componentName']===_0x543cf5['name']&&_0x1ab6ac[_0x4acefa(0x152)]===_0x543cf5[_0x4acefa(0x10d)]);if(!_0x27667c||!_0x27667c['componentId'])continue;_0x54fc6a[_0x4acefa(0x10b)](_0x27667c[_0x4acefa(0x10f)]);}}if(_0x56816c){const _0x19e75e=await this[_0x4acefa(0x10c)][_0x4acefa(0x133)](_0x54fc6a);_0x5a9ef5[_0x4acefa(0x146)]=_0x19e75e[_0x4acefa(0x109)](_0x9a78ef=>composite_utils_1['createDeleteRequest'](constants_1[_0x4acefa(0x137)],_0x9a78ef)['request']);}return _0x5a9ef5[_0x4acefa(0x102)]=_0x54fc6a[_0x4acefa(0x109)](_0x502232=>composite_utils_1[_0x4acefa(0x128)](constants_1[_0x4acefa(0x115)],_0x502232,{[constants_1[_0x4acefa(0x126)]+_0x4acefa(0x117)]:!![]})[_0x4acefa(0x11e)]),_0x5a9ef5[_0x4acefa(0x150)]=_0x54fc6a[_0x4acefa(0x109)](_0x3e2950=>composite_utils_1[_0x4acefa(0x110)](constants_1[_0x4acefa(0x115)],_0x3e2950)['request']),_0x5a9ef5;}}function a128_0x4999(){const _0x22f4f0=['Last_Modified_By__c','toString','username','manifests','Repository','SalesforceComponentsManager','delete','ParentId','Branch','createPostRequest','defineProperty','(((.+)+)+)+$','prepareCommitManifest','componentsToDelete','application/zip','componentType','Component_Type__c','reference','205wErild','459608ExWaIN','recordTypes','files','__esModule','Body','logger','2181070rfcisO','prepareComponentHistoryRecord','file','componentsToUpdate','../errors/salesforce.error','branchId','8AqGAHP','prepareComponentRecord','search','../../../constants','map','Branch__c','push','gitSync','type','prepareComponentAttachmentRecord','componentId','createDeleteRequest','../../parsers/utils/zip','constructor','generateAsync','./salesforce-git-sync.service','FLOSUM_COMPONENT','Commit__c','Deletion_By_Agent__c','27swrMWU','18581530QehJrE','6rRwRnA','RecordTypeId','getProceededComponentsMeta','version','request','2384417PMuVvD','componentName','typedi','Repository__c','File_Name__c','Component_Name__c','__importDefault','FLOSUM_GIT_NAMESPACE','keys','createPatchRequest','find','repositoryId','filePath','Version__c','Logger','Committed_On__c','apply','1254764uIYrXx','name','FLOSUM_COMPONENT_HISTORY','fetchCommitManifestsByComponentIds','FLOSUM_ATTACHMENT','proceededComponentsMeta','525725rtNuPu','FLOSUM_COMMIT_MANIFEST','Changed_On__c','FLOSUM_NAMESPACE','createZip','Component_History__c','10938bUnDHc','Source__c','proceedComponentMeta','.id}','../../../core','crc','toISOString'];a128_0x4999=function(){return _0x22f4f0;};return a128_0x4999();}exports[a128_0x2d025d(0x148)]=SalesforceComponentsManager;