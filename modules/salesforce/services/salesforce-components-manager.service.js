const a127_0x2b9f75=a127_0x3438;(function(_0x499e88,_0x257338){const _0x5a6292=a127_0x3438,_0x129172=_0x499e88();while(!![]){try{const _0x3a1927=parseInt(_0x5a6292(0x1f5))/0x1*(parseInt(_0x5a6292(0x203))/0x2)+-parseInt(_0x5a6292(0x245))/0x3*(parseInt(_0x5a6292(0x223))/0x4)+-parseInt(_0x5a6292(0x230))/0x5+parseInt(_0x5a6292(0x235))/0x6+parseInt(_0x5a6292(0x221))/0x7+-parseInt(_0x5a6292(0x247))/0x8*(-parseInt(_0x5a6292(0x228))/0x9)+parseInt(_0x5a6292(0x22d))/0xa*(parseInt(_0x5a6292(0x249))/0xb);if(_0x3a1927===_0x257338)break;else _0x129172['push'](_0x129172['shift']());}catch(_0x26393a){_0x129172['push'](_0x129172['shift']());}}}(a127_0x3542,0x9b2ca));function a127_0x3542(){const _0x1599af=['Changed_By__c','FLOSUM_COMPONENT_HISTORY','keys','__esModule','fetchCommitManifestsByComponentIds','prepareComponentHistoryRecord','File_Name__c','CRC32__c','name','525651sNiqRl','prepareComponentRecord','168urNmca','manifests','Committed_On__c','createPatchRequest','createDeleteRequest','9459nLHWKc','../../parsers/utils/zip','createZip','ContentType','Changed_On__c','8150azLKEX','crc','map','925560ERWjfq','Repository','gitSync','createPostRequest','find','1259922GwSTEp','defineProperty','Component_Name__c','componentsToDelete','toISOString','Last_Modified_By__c','base64','DEFLATE','../errors/salesforce.error','FLOSUM_COMMIT_MANIFEST','../utils/flosum-naming.utils','getProceededComponentsMeta','SalesforceGitSyncService','Could\x20not\x20proceed\x20component\x20','files','push','72339wwEPkB','default','4048huShVp','Branch','5995FXaepY','proceededComponentsMeta','Source__c','Body','username','prepareCommitManifest','branchId','FLOSUM_GIT_NAMESPACE','delete','request','search','572391zLPWgD','componentId','componentsToUpdate','Component_Type__c','generateAsync','toString','Is_From_Agent__c','Version__c','repositoryId','Branch__c','prepareComponentAttachmentRecord','application/zip','ParentId','FLOSUM_COMPONENT','2QCCvUN','FLOSUM_NAMESPACE','type','proceedComponentMeta','file','RecordTypeId','filePath','componentName','reference','SalesforceComponentsManager','body','Deletion_By_Agent__c','recordTypes','(((.+)+)+)+$','extractFieldsFromRecord','componentType','FLOSUM_ATTACHMENT','version','.id}','Logger','Repository__c'];a127_0x3542=function(){return _0x1599af;};return a127_0x3542();}function a127_0x3438(_0x4e22a3,_0x2aba86){const _0x1d55dd=a127_0x3542();return a127_0x3438=function(_0xa43609,_0xf9a0af){_0xa43609=_0xa43609-0x1ef;let _0x35426d=_0x1d55dd[_0xa43609];return _0x35426d;},a127_0x3438(_0x4e22a3,_0x2aba86);}const a127_0xf9a0af=(function(){let _0x1af29f=!![];return function(_0x3d87c1,_0x41cde5){const _0x790af7=_0x1af29f?function(){if(_0x41cde5){const _0x27fe5e=_0x41cde5['apply'](_0x3d87c1,arguments);return _0x41cde5=null,_0x27fe5e;}}:function(){};return _0x1af29f=![],_0x790af7;};}()),a127_0xa43609=a127_0xf9a0af(this,function(){const _0x50c7ec=a127_0x3438;return a127_0xa43609[_0x50c7ec(0x1fa)]()[_0x50c7ec(0x1f4)](_0x50c7ec(0x210))[_0x50c7ec(0x1fa)]()['constructor'](a127_0xa43609)[_0x50c7ec(0x1f4)](_0x50c7ec(0x210));});a127_0xa43609();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x9b8f9b){const _0x4abd91=a127_0x3438;return _0x9b8f9b&&_0x9b8f9b[_0x4abd91(0x21b)]?_0x9b8f9b:{'default':_0x9b8f9b};};Object[a127_0x2b9f75(0x236)](exports,a127_0x2b9f75(0x21b),{'value':!![]}),exports[a127_0x2b9f75(0x20c)]=void 0x0;const constants_1=require('../../../constants'),core_1=require('../../../core'),zip_1=require(a127_0x2b9f75(0x229)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a127_0x2b9f75(0x23d)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a127_0x2b9f75(0x23f)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x2eff94,_0x4c1f57,_0x3dae1c,_0x3ccc68,_0x1f3ab0){const _0x5ae6d2=a127_0x2b9f75;this[_0x5ae6d2(0x1fd)]=_0x2eff94,this[_0x5ae6d2(0x1f0)]=_0x4c1f57,this[_0x5ae6d2(0x24d)]=_0x3dae1c,this[_0x5ae6d2(0x20f)]=_0x3ccc68,this[_0x5ae6d2(0x24a)]=_0x1f3ab0,this['logger']=new core_1[(_0x5ae6d2(0x216))](SalesforceComponentsManager[_0x5ae6d2(0x220)]),this['gitSync']=typedi_1[_0x5ae6d2(0x246)]['get'](salesforce_git_sync_service_1[_0x5ae6d2(0x241)]);}[a127_0x2b9f75(0x206)](_0x35e708,_0x30374d){const _0x5985ae=a127_0x2b9f75,_0x119ff8=flosum_naming_utils_1[_0x5985ae(0x211)](_0x35e708,[_0x5985ae(0x1f8),'Component_Name__c',_0x5985ae(0x1fc)]);this[_0x5985ae(0x24a)][_0x5985ae(0x244)]({'componentId':'','reference':_0x30374d,'version':_0x119ff8[_0x5985ae(0x1fc)],'componentName':_0x119ff8[_0x5985ae(0x237)],'componentType':_0x119ff8[_0x5985ae(0x1f8)]});}[a127_0x2b9f75(0x1ef)](_0x9bc4c5,_0x457258){const _0x275e14=a127_0x2b9f75,{request:_0x2b406d}=composite_utils_1['createPostRequest'](constants_1[_0x275e14(0x23e)],{[constants_1['FLOSUM_NAMESPACE']+'Commit__c']:_0x9bc4c5,[constants_1['FLOSUM_NAMESPACE']+'Component_History__c']:_0x457258});return _0x2b406d;}async[a127_0x2b9f75(0x1ff)](_0x93e885,_0x15bd43){const _0xf7b939=a127_0x2b9f75,_0x51cc75={},_0x523c5d=zip_1['Zip'][_0xf7b939(0x22a)]();for(const _0xb977a2 of Object[_0xf7b939(0x21a)](_0x93e885[_0xf7b939(0x243)])){_0x523c5d[_0xf7b939(0x207)](_0xb977a2,_0x93e885['files'][_0xb977a2],{'createFolders':!![]});}return _0x51cc75[_0xf7b939(0x22b)]=_0xf7b939(0x200),_0x51cc75['Name']=_0x93e885[_0xf7b939(0x205)],_0x51cc75['Description']=_0x93e885[_0xf7b939(0x205)],_0x51cc75[_0xf7b939(0x201)]=_0x15bd43,_0x51cc75[_0xf7b939(0x24c)]=await _0x523c5d[_0xf7b939(0x1f9)]({'type':_0xf7b939(0x23b),'compression':_0xf7b939(0x23c),'compressionOptions':{'level':0x6}}),_0x51cc75;}[a127_0x2b9f75(0x21d)](_0x1329f8,_0x8e32f4,_0x3bf892){const _0x4d1240=a127_0x2b9f75,_0xe0fa31=new Date()[_0x4d1240(0x239)](),_0x47bdc9={};return _0x47bdc9[constants_1[_0x4d1240(0x204)]+'Component__c']=_0x8e32f4,_0x47bdc9[constants_1['FLOSUM_NAMESPACE']+_0x4d1240(0x21f)]=_0x1329f8[_0x4d1240(0x22e)],_0x47bdc9[constants_1[_0x4d1240(0x204)]+_0x4d1240(0x22c)]=_0xe0fa31,_0x47bdc9[constants_1[_0x4d1240(0x204)]+_0x4d1240(0x218)]=this[_0x4d1240(0x24d)],_0x47bdc9[constants_1['FLOSUM_NAMESPACE']+_0x4d1240(0x1fc)]=_0x3bf892?_0x3bf892+0x1:0x1,_0x47bdc9[constants_1[_0x4d1240(0x1f1)]+_0x4d1240(0x1fb)]=!![],_0x47bdc9;}[a127_0x2b9f75(0x222)](_0x2ab07c,_0x32a3ef){const _0xe5bdfd=a127_0x2b9f75;var _0x908cc9,_0x985e6e;const _0x4d19ce=new Date()[_0xe5bdfd(0x239)](),_0x6a89dd={};return!_0x32a3ef?(this[_0xe5bdfd(0x1f0)]?(_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+_0xe5bdfd(0x1fe)]=this['branchId'],_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+_0xe5bdfd(0x24b)]=_0xe5bdfd(0x248),_0x6a89dd[_0xe5bdfd(0x208)]=(_0x908cc9=this[_0xe5bdfd(0x20f)]['find'](_0x2c247d=>_0x2c247d[_0xe5bdfd(0x220)]===_0xe5bdfd(0x248)))===null||_0x908cc9===void 0x0?void 0x0:_0x908cc9['id']):(_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+_0xe5bdfd(0x217)]=this['repositoryId'],_0x6a89dd[constants_1['FLOSUM_NAMESPACE']+'Source__c']=_0xe5bdfd(0x231),_0x6a89dd[_0xe5bdfd(0x208)]=(_0x985e6e=this['recordTypes']['find'](_0x27c5ef=>_0x27c5ef[_0xe5bdfd(0x220)]===_0xe5bdfd(0x231)))===null||_0x985e6e===void 0x0?void 0x0:_0x985e6e['id']),_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+_0xe5bdfd(0x1fc)]=0x1):_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+'Version__c']=_0x32a3ef[_0xe5bdfd(0x214)]+0x1,_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+_0xe5bdfd(0x1f8)]=_0x2ab07c[_0xe5bdfd(0x205)],_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+_0xe5bdfd(0x237)]=_0x2ab07c[_0xe5bdfd(0x220)],_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+_0xe5bdfd(0x21e)]=_0x2ab07c[_0xe5bdfd(0x209)],_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+'Last_Updated_By__c']=this['username'],_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+_0xe5bdfd(0x23a)]=this[_0xe5bdfd(0x24d)],_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+'Last_Modified_Date__c']=_0x4d19ce,_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+_0xe5bdfd(0x225)]=_0x4d19ce,_0x6a89dd[constants_1[_0xe5bdfd(0x204)]+_0xe5bdfd(0x21f)]=_0x2ab07c[_0xe5bdfd(0x22e)],_0x6a89dd;}[a127_0x2b9f75(0x240)](){const _0x420db4=a127_0x2b9f75;return this[_0x420db4(0x24a)];}async['insert'](_0x14679e,_0x5438e9){const _0x2b47b8=a127_0x2b9f75,_0x304235=[];for(const _0x278b4a of _0x14679e){const _0x3a2060=composite_utils_1[_0x2b47b8(0x233)](constants_1[_0x2b47b8(0x202)],this[_0x2b47b8(0x222)](_0x278b4a)),_0x25df01=composite_utils_1['createPostRequest'](constants_1['FLOSUM_COMPONENT_HISTORY'],this['prepareComponentHistoryRecord'](_0x278b4a,'@{'+_0x3a2060[_0x2b47b8(0x20b)]+'.id}')),_0x7fe252=composite_utils_1['createPostRequest'](constants_1[_0x2b47b8(0x213)],await this[_0x2b47b8(0x1ff)](_0x278b4a,'@{'+_0x25df01[_0x2b47b8(0x20b)]+_0x2b47b8(0x215)));this[_0x2b47b8(0x206)](_0x3a2060['request']['body'],_0x3a2060[_0x2b47b8(0x20b)]),_0x304235['push'](_0x3a2060[_0x2b47b8(0x1f3)],_0x25df01[_0x2b47b8(0x1f3)],_0x7fe252[_0x2b47b8(0x1f3)]),_0x5438e9&&_0x304235[_0x2b47b8(0x244)](this[_0x2b47b8(0x1ef)](_0x5438e9,'@{'+_0x25df01[_0x2b47b8(0x20b)]+_0x2b47b8(0x215)));}return _0x304235;}async['update'](_0x2601c0,_0x7f08a2=''){const _0x4138ba=a127_0x2b9f75,_0x256933=[];for(const {component:_0x11ae87,meta:_0xe38c2}of _0x2601c0){if(!_0xe38c2['id']){const _0x332ba7=this[_0x4138ba(0x24a)]['find'](_0x4a7d1b=>_0x4a7d1b[_0x4138ba(0x20a)]===_0x11ae87[_0x4138ba(0x220)]&&_0x4a7d1b[_0x4138ba(0x212)]===_0x11ae87['type']);if(!_0x332ba7)throw new salesforce_error_1['SalesforceError'](new Error(_0x4138ba(0x242)+_0x11ae87[_0x4138ba(0x220)]+'\x20['+_0x11ae87['type']+']\x20-\x20meta\x20not\x20found'));_0xe38c2['id']=_0x332ba7[_0x4138ba(0x1f6)];}const _0x3e3333=composite_utils_1[_0x4138ba(0x226)](constants_1[_0x4138ba(0x202)],_0xe38c2['id'],this[_0x4138ba(0x222)](_0x11ae87,_0xe38c2)),_0x3fd3e8=composite_utils_1[_0x4138ba(0x233)](constants_1[_0x4138ba(0x219)],this[_0x4138ba(0x21d)](_0x11ae87,_0xe38c2['id'],_0xe38c2[_0x4138ba(0x214)])),_0x45db10=composite_utils_1[_0x4138ba(0x233)](constants_1[_0x4138ba(0x213)],await this[_0x4138ba(0x1ff)](_0x11ae87,'@{'+_0x3fd3e8[_0x4138ba(0x20b)]+_0x4138ba(0x215)));this[_0x4138ba(0x206)](_0x3e3333[_0x4138ba(0x1f3)][_0x4138ba(0x20d)],_0x3e3333['reference']),_0x256933[_0x4138ba(0x244)](_0x3e3333[_0x4138ba(0x1f3)],_0x3fd3e8[_0x4138ba(0x1f3)],_0x45db10['request']),_0x7f08a2&&_0x256933[_0x4138ba(0x244)](this['prepareCommitManifest'](_0x7f08a2,'@{'+_0x3fd3e8['reference']+_0x4138ba(0x215)));}return _0x256933;}async[a127_0x2b9f75(0x1f2)](_0xf81c8c,_0x167cd0=![]){const _0x1fa873=a127_0x2b9f75,_0x3ca511={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x5faf23=[];for(const _0x21b596 of _0xf81c8c){if(_0x21b596['id'])_0x5faf23['push'](_0x21b596['id']);else{const _0x279036=this[_0x1fa873(0x24a)][_0x1fa873(0x234)](_0xd42378=>_0xd42378[_0x1fa873(0x20a)]===_0x21b596['name']&&_0xd42378[_0x1fa873(0x212)]===_0x21b596[_0x1fa873(0x205)]);if(!_0x279036||!_0x279036[_0x1fa873(0x1f6)])continue;_0x5faf23[_0x1fa873(0x244)](_0x279036[_0x1fa873(0x1f6)]);}}if(_0x167cd0){const _0xd35d2b=await this[_0x1fa873(0x232)][_0x1fa873(0x21c)](_0x5faf23);_0x3ca511[_0x1fa873(0x224)]=_0xd35d2b[_0x1fa873(0x22f)](_0x255a17=>composite_utils_1[_0x1fa873(0x227)](constants_1[_0x1fa873(0x23e)],_0x255a17)['request']);}return _0x3ca511[_0x1fa873(0x1f7)]=_0x5faf23[_0x1fa873(0x22f)](_0x3bd6e8=>composite_utils_1[_0x1fa873(0x226)](constants_1[_0x1fa873(0x202)],_0x3bd6e8,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x1fa873(0x20e)]:!![]})[_0x1fa873(0x1f3)]),_0x3ca511[_0x1fa873(0x238)]=_0x5faf23[_0x1fa873(0x22f)](_0x4ab447=>composite_utils_1[_0x1fa873(0x227)](constants_1['FLOSUM_COMPONENT'],_0x4ab447)[_0x1fa873(0x1f3)]),_0x3ca511;}}exports[a127_0x2b9f75(0x20c)]=SalesforceComponentsManager;