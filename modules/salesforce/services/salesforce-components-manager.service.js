const a128_0x38667e=a128_0x560c;(function(_0x3c30b,_0x4b7f02){const _0x2bfc46=a128_0x560c,_0x2f836c=_0x3c30b();while(!![]){try{const _0x2c4208=-parseInt(_0x2bfc46(0x194))/0x1+-parseInt(_0x2bfc46(0x173))/0x2*(-parseInt(_0x2bfc46(0x14b))/0x3)+parseInt(_0x2bfc46(0x145))/0x4*(-parseInt(_0x2bfc46(0x18d))/0x5)+parseInt(_0x2bfc46(0x147))/0x6+-parseInt(_0x2bfc46(0x17f))/0x7+-parseInt(_0x2bfc46(0x14d))/0x8+parseInt(_0x2bfc46(0x18f))/0x9;if(_0x2c4208===_0x4b7f02)break;else _0x2f836c['push'](_0x2f836c['shift']());}catch(_0xd43b91){_0x2f836c['push'](_0x2f836c['shift']());}}}(a128_0x5576,0x2e254));const a128_0x3139df=(function(){let _0x2ee935=!![];return function(_0xe40725,_0x683d1a){const _0xd9e498=_0x2ee935?function(){const _0x2d4161=a128_0x560c;if(_0x683d1a){const _0x206d5e=_0x683d1a[_0x2d4161(0x188)](_0xe40725,arguments);return _0x683d1a=null,_0x206d5e;}}:function(){};return _0x2ee935=![],_0xd9e498;};}()),a128_0x3dbc62=a128_0x3139df(this,function(){const _0x3fdbc0=a128_0x560c;return a128_0x3dbc62[_0x3fdbc0(0x16a)]()[_0x3fdbc0(0x15e)]('(((.+)+)+)+$')['toString']()[_0x3fdbc0(0x190)](a128_0x3dbc62)[_0x3fdbc0(0x15e)]('(((.+)+)+)+$');});a128_0x3dbc62();'use strict';function a128_0x5576(){const _0x2a690c=['version','componentsToUpdate','34564yPMfyK','../../parsers/utils/zip','1273806VpAJLW','Source__c',']\x20-\x20meta\x20not\x20found','prepareCommitManifest','261945oUvTZM','prepareComponentAttachmentRecord','132248knQLHX','Component_History__c','reference','RecordTypeId','../../../core','Deletion_By_Agent__c','Changed_On__c','toISOString','prepareComponentHistoryRecord','request','delete','../errors/salesforce.error','FLOSUM_COMPONENT_HISTORY','filePath','Name','Logger','keys','search','../../../constants','CRC32__c','extractFieldsFromRecord','insert','application/zip','File_Name__c','find','logger','branchId','componentId','createZip','toString','username','Version__c','gitSync','Committed_On__c','get','Zip','Is_From_Agent__c','Repository','6BmATGf','.id}','map','update','base64','Commit__c','componentsToDelete','prepareComponentRecord','SalesforceError','componentType','Component__c','proceedComponentMeta','2084488uckJRs','proceededComponentsMeta','SalesforceGitSyncService','Branch','Component_Type__c','type','body','files','FLOSUM_COMPONENT','apply','FLOSUM_NAMESPACE','repositoryId','__importDefault','name','215hfdSaA','__esModule','6882597oUbnBU','constructor','typedi','fetchCommitManifestsByComponentIds','Repository__c','364089luOfbX','createPatchRequest','default','recordTypes','ParentId','generateAsync','manifests','componentName','push','createPostRequest','FLOSUM_GIT_NAMESPACE','FLOSUM_ATTACHMENT','DEFLATE','Description','getProceededComponentsMeta','Branch__c','createDeleteRequest','Component_Name__c','SalesforceComponentsManager'];a128_0x5576=function(){return _0x2a690c;};return a128_0x5576();}var __importDefault=this&&this[a128_0x38667e(0x18b)]||function(_0x103440){const _0x4971fd=a128_0x38667e;return _0x103440&&_0x103440[_0x4971fd(0x18e)]?_0x103440:{'default':_0x103440};};Object['defineProperty'](exports,a128_0x38667e(0x18e),{'value':!![]}),exports[a128_0x38667e(0x1a6)]=void 0x0;const constants_1=require(a128_0x38667e(0x15f)),core_1=require(a128_0x38667e(0x151)),zip_1=require(a128_0x38667e(0x146)),typedi_1=__importDefault(require(a128_0x38667e(0x191))),salesforce_error_1=require(a128_0x38667e(0x158)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');function a128_0x560c(_0xd4aca1,_0x3a310b){const _0x43b59d=a128_0x5576();return a128_0x560c=function(_0x3dbc62,_0x3139df){_0x3dbc62=_0x3dbc62-0x145;let _0x557692=_0x43b59d[_0x3dbc62];return _0x557692;},a128_0x560c(_0xd4aca1,_0x3a310b);}class SalesforceComponentsManager{constructor(_0x1a08e1,_0x5377ef,_0x3f88b4,_0x3515a3,_0x1c6c93){const _0x324540=a128_0x38667e;this[_0x324540(0x18a)]=_0x1a08e1,this[_0x324540(0x167)]=_0x5377ef,this[_0x324540(0x16b)]=_0x3f88b4,this[_0x324540(0x197)]=_0x3515a3,this['proceededComponentsMeta']=_0x1c6c93,this[_0x324540(0x166)]=new core_1[(_0x324540(0x15c))](SalesforceComponentsManager[_0x324540(0x18c)]),this[_0x324540(0x16d)]=typedi_1[_0x324540(0x196)][_0x324540(0x16f)](salesforce_git_sync_service_1[_0x324540(0x181)]);}['proceedComponentMeta'](_0x4cbf10,_0xdb517e){const _0x148ef8=a128_0x38667e,_0x377e6=flosum_naming_utils_1[_0x148ef8(0x161)](_0x4cbf10,[_0x148ef8(0x183),'Component_Name__c',_0x148ef8(0x16c)]);this[_0x148ef8(0x180)][_0x148ef8(0x19c)]({'componentId':'','reference':_0xdb517e,'version':_0x377e6[_0x148ef8(0x16c)],'componentName':_0x377e6['Component_Name__c'],'componentType':_0x377e6[_0x148ef8(0x183)]});}[a128_0x38667e(0x14a)](_0x3d0839,_0x54616f){const _0x1abdae=a128_0x38667e,{request:_0x72a097}=composite_utils_1[_0x1abdae(0x19d)](constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x1abdae(0x189)]+_0x1abdae(0x178)]:_0x3d0839,[constants_1['FLOSUM_NAMESPACE']+_0x1abdae(0x14e)]:_0x54616f});return _0x72a097;}async[a128_0x38667e(0x14c)](_0x23705d,_0x1779e6){const _0x313197=a128_0x38667e,_0x4eee6a={},_0x355fc3=zip_1[_0x313197(0x170)][_0x313197(0x169)]();for(const _0x37c9f7 of Object[_0x313197(0x15d)](_0x23705d[_0x313197(0x186)])){_0x355fc3['file'](_0x37c9f7,_0x23705d[_0x313197(0x186)][_0x37c9f7],{'createFolders':!![]});}return _0x4eee6a['ContentType']=_0x313197(0x163),_0x4eee6a[_0x313197(0x15b)]=_0x23705d[_0x313197(0x184)],_0x4eee6a[_0x313197(0x1a1)]=_0x23705d['type'],_0x4eee6a[_0x313197(0x198)]=_0x1779e6,_0x4eee6a['Body']=await _0x355fc3[_0x313197(0x199)]({'type':_0x313197(0x177),'compression':_0x313197(0x1a0),'compressionOptions':{'level':0x6}}),_0x4eee6a;}[a128_0x38667e(0x155)](_0x478aa9,_0x125359,_0x24082d){const _0x310c8a=a128_0x38667e,_0x5c425c=new Date()['toISOString'](),_0x5e06fa={};return _0x5e06fa[constants_1['FLOSUM_NAMESPACE']+_0x310c8a(0x17d)]=_0x125359,_0x5e06fa[constants_1[_0x310c8a(0x189)]+_0x310c8a(0x160)]=_0x478aa9['crc'],_0x5e06fa[constants_1[_0x310c8a(0x189)]+_0x310c8a(0x153)]=_0x5c425c,_0x5e06fa[constants_1[_0x310c8a(0x189)]+'Changed_By__c']=this[_0x310c8a(0x16b)],_0x5e06fa[constants_1[_0x310c8a(0x189)]+_0x310c8a(0x16c)]=_0x24082d?_0x24082d+0x1:0x1,_0x5e06fa[constants_1[_0x310c8a(0x19e)]+_0x310c8a(0x171)]=!![],_0x5e06fa;}[a128_0x38667e(0x17a)](_0x316bd4,_0x4a3724){const _0x42d4f9=a128_0x38667e;var _0x103621,_0x2e67b2;const _0x232d9a=new Date()[_0x42d4f9(0x154)](),_0x27fbba={};return!_0x4a3724?(this[_0x42d4f9(0x167)]?(_0x27fbba[constants_1[_0x42d4f9(0x189)]+_0x42d4f9(0x1a3)]=this[_0x42d4f9(0x167)],_0x27fbba[constants_1['FLOSUM_NAMESPACE']+_0x42d4f9(0x148)]=_0x42d4f9(0x182),_0x27fbba[_0x42d4f9(0x150)]=(_0x103621=this[_0x42d4f9(0x197)][_0x42d4f9(0x165)](_0x27bae4=>_0x27bae4[_0x42d4f9(0x18c)]==='Branch'))===null||_0x103621===void 0x0?void 0x0:_0x103621['id']):(_0x27fbba[constants_1['FLOSUM_NAMESPACE']+_0x42d4f9(0x193)]=this[_0x42d4f9(0x18a)],_0x27fbba[constants_1[_0x42d4f9(0x189)]+_0x42d4f9(0x148)]=_0x42d4f9(0x172),_0x27fbba[_0x42d4f9(0x150)]=(_0x2e67b2=this['recordTypes'][_0x42d4f9(0x165)](_0x484cc0=>_0x484cc0[_0x42d4f9(0x18c)]==='Repository'))===null||_0x2e67b2===void 0x0?void 0x0:_0x2e67b2['id']),_0x27fbba[constants_1['FLOSUM_NAMESPACE']+'Version__c']=0x1):_0x27fbba[constants_1[_0x42d4f9(0x189)]+'Version__c']=_0x4a3724[_0x42d4f9(0x1a7)]+0x1,_0x27fbba[constants_1[_0x42d4f9(0x189)]+_0x42d4f9(0x183)]=_0x316bd4[_0x42d4f9(0x184)],_0x27fbba[constants_1[_0x42d4f9(0x189)]+_0x42d4f9(0x1a5)]=_0x316bd4['name'],_0x27fbba[constants_1['FLOSUM_NAMESPACE']+_0x42d4f9(0x164)]=_0x316bd4[_0x42d4f9(0x15a)],_0x27fbba[constants_1[_0x42d4f9(0x189)]+'Last_Updated_By__c']=this[_0x42d4f9(0x16b)],_0x27fbba[constants_1[_0x42d4f9(0x189)]+'Last_Modified_By__c']=this[_0x42d4f9(0x16b)],_0x27fbba[constants_1[_0x42d4f9(0x189)]+'Last_Modified_Date__c']=_0x232d9a,_0x27fbba[constants_1[_0x42d4f9(0x189)]+_0x42d4f9(0x16e)]=_0x232d9a,_0x27fbba[constants_1['FLOSUM_NAMESPACE']+_0x42d4f9(0x160)]=_0x316bd4['crc'],_0x27fbba;}[a128_0x38667e(0x1a2)](){return this['proceededComponentsMeta'];}async[a128_0x38667e(0x162)](_0x1c6170,_0x3bba63){const _0x4eab70=a128_0x38667e,_0x16a9d4=[];for(const _0x3fb322 of _0x1c6170){const _0x1f48cf=composite_utils_1[_0x4eab70(0x19d)](constants_1['FLOSUM_COMPONENT'],this[_0x4eab70(0x17a)](_0x3fb322)),_0x26fdf7=composite_utils_1['createPostRequest'](constants_1[_0x4eab70(0x159)],this[_0x4eab70(0x155)](_0x3fb322,'@{'+_0x1f48cf[_0x4eab70(0x14f)]+'.id}')),_0xde2be7=composite_utils_1[_0x4eab70(0x19d)](constants_1[_0x4eab70(0x19f)],await this[_0x4eab70(0x14c)](_0x3fb322,'@{'+_0x26fdf7[_0x4eab70(0x14f)]+'.id}'));this[_0x4eab70(0x17e)](_0x1f48cf[_0x4eab70(0x156)][_0x4eab70(0x185)],_0x1f48cf[_0x4eab70(0x14f)]),_0x16a9d4[_0x4eab70(0x19c)](_0x1f48cf['request'],_0x26fdf7['request'],_0xde2be7[_0x4eab70(0x156)]),_0x3bba63&&_0x16a9d4[_0x4eab70(0x19c)](this[_0x4eab70(0x14a)](_0x3bba63,'@{'+_0x26fdf7[_0x4eab70(0x14f)]+'.id}'));}return _0x16a9d4;}async[a128_0x38667e(0x176)](_0x347c84,_0x256108=''){const _0x32e2a1=a128_0x38667e,_0x1da3ff=[];for(const {component:_0x1436e8,meta:_0xec7af8}of _0x347c84){if(!_0xec7af8['id']){const _0x1d7b4d=this[_0x32e2a1(0x180)][_0x32e2a1(0x165)](_0x53adc4=>_0x53adc4[_0x32e2a1(0x19b)]===_0x1436e8[_0x32e2a1(0x18c)]&&_0x53adc4[_0x32e2a1(0x17c)]===_0x1436e8['type']);if(!_0x1d7b4d)throw new salesforce_error_1[(_0x32e2a1(0x17b))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x1436e8[_0x32e2a1(0x18c)]+'\x20['+_0x1436e8[_0x32e2a1(0x184)]+_0x32e2a1(0x149)));_0xec7af8['id']=_0x1d7b4d[_0x32e2a1(0x168)];}const _0x8abe1c=composite_utils_1[_0x32e2a1(0x195)](constants_1['FLOSUM_COMPONENT'],_0xec7af8['id'],this[_0x32e2a1(0x17a)](_0x1436e8,_0xec7af8)),_0x1748cf=composite_utils_1[_0x32e2a1(0x19d)](constants_1[_0x32e2a1(0x159)],this['prepareComponentHistoryRecord'](_0x1436e8,_0xec7af8['id'],_0xec7af8[_0x32e2a1(0x1a7)])),_0x1db807=composite_utils_1[_0x32e2a1(0x19d)](constants_1['FLOSUM_ATTACHMENT'],await this[_0x32e2a1(0x14c)](_0x1436e8,'@{'+_0x1748cf['reference']+_0x32e2a1(0x174)));this[_0x32e2a1(0x17e)](_0x8abe1c['request'][_0x32e2a1(0x185)],_0x8abe1c['reference']),_0x1da3ff[_0x32e2a1(0x19c)](_0x8abe1c[_0x32e2a1(0x156)],_0x1748cf['request'],_0x1db807[_0x32e2a1(0x156)]),_0x256108&&_0x1da3ff[_0x32e2a1(0x19c)](this[_0x32e2a1(0x14a)](_0x256108,'@{'+_0x1748cf[_0x32e2a1(0x14f)]+_0x32e2a1(0x174)));}return _0x1da3ff;}async[a128_0x38667e(0x157)](_0x5089f3,_0x25ee99=![]){const _0x46b288=a128_0x38667e,_0x274cdc={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x1e740f=[];for(const _0x22ebaa of _0x5089f3){if(_0x22ebaa['id'])_0x1e740f[_0x46b288(0x19c)](_0x22ebaa['id']);else{const _0x5004aa=this[_0x46b288(0x180)]['find'](_0x539450=>_0x539450[_0x46b288(0x19b)]===_0x22ebaa['name']&&_0x539450[_0x46b288(0x17c)]===_0x22ebaa[_0x46b288(0x184)]);if(!_0x5004aa||!_0x5004aa['componentId'])continue;_0x1e740f['push'](_0x5004aa[_0x46b288(0x168)]);}}if(_0x25ee99){const _0x30119b=await this[_0x46b288(0x16d)][_0x46b288(0x192)](_0x1e740f);_0x274cdc[_0x46b288(0x19a)]=_0x30119b[_0x46b288(0x175)](_0x49cc2a=>composite_utils_1[_0x46b288(0x1a4)](constants_1['FLOSUM_COMMIT_MANIFEST'],_0x49cc2a)[_0x46b288(0x156)]);}return _0x274cdc[_0x46b288(0x1a8)]=_0x1e740f[_0x46b288(0x175)](_0x1f7668=>composite_utils_1[_0x46b288(0x195)](constants_1[_0x46b288(0x187)],_0x1f7668,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x46b288(0x152)]:!![]})['request']),_0x274cdc[_0x46b288(0x179)]=_0x1e740f[_0x46b288(0x175)](_0x2e776f=>composite_utils_1[_0x46b288(0x1a4)](constants_1[_0x46b288(0x187)],_0x2e776f)['request']),_0x274cdc;}}exports[a128_0x38667e(0x1a6)]=SalesforceComponentsManager;