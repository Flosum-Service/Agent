const a128_0x33e45e=a128_0x1ca3;(function(_0x3efcb2,_0x58dd57){const _0x722bbf=a128_0x1ca3,_0xa95bff=_0x3efcb2();while(!![]){try{const _0x441012=parseInt(_0x722bbf(0xaa))/0x1+parseInt(_0x722bbf(0xe5))/0x2+-parseInt(_0x722bbf(0xb9))/0x3*(parseInt(_0x722bbf(0x95))/0x4)+-parseInt(_0x722bbf(0xdf))/0x5+parseInt(_0x722bbf(0xd8))/0x6*(-parseInt(_0x722bbf(0xa9))/0x7)+parseInt(_0x722bbf(0x8f))/0x8*(-parseInt(_0x722bbf(0xc1))/0x9)+-parseInt(_0x722bbf(0xb7))/0xa*(-parseInt(_0x722bbf(0xa3))/0xb);if(_0x441012===_0x58dd57)break;else _0xa95bff['push'](_0xa95bff['shift']());}catch(_0x52cc28){_0xa95bff['push'](_0xa95bff['shift']());}}}(a128_0x170d,0xe2ead));const a128_0xb61481=(function(){let _0x3fc35c=!![];return function(_0x263867,_0x3b42ed){const _0x40a778=_0x3fc35c?function(){const _0x47e62c=a128_0x1ca3;if(_0x3b42ed){const _0x3478f0=_0x3b42ed[_0x47e62c(0xe0)](_0x263867,arguments);return _0x3b42ed=null,_0x3478f0;}}:function(){};return _0x3fc35c=![],_0x40a778;};}()),a128_0x11cbb8=a128_0xb61481(this,function(){const _0x31427d=a128_0x1ca3;return a128_0x11cbb8[_0x31427d(0xbe)]()['search'](_0x31427d(0x98))[_0x31427d(0xbe)]()[_0x31427d(0xd6)](a128_0x11cbb8)[_0x31427d(0xcb)](_0x31427d(0x98));});a128_0x11cbb8();'use strict';function a128_0x1ca3(_0x2c2c82,_0x5dc529){const _0x1d1fa9=a128_0x170d();return a128_0x1ca3=function(_0x11cbb8,_0xb61481){_0x11cbb8=_0x11cbb8-0x8f;let _0x170d62=_0x1d1fa9[_0x11cbb8];return _0x170d62;},a128_0x1ca3(_0x2c2c82,_0x5dc529);}var __importDefault=this&&this[a128_0x33e45e(0xbd)]||function(_0x13b624){return _0x13b624&&_0x13b624['__esModule']?_0x13b624:{'default':_0x13b624};};function a128_0x170d(){const _0x509de6=['apply','version','createDeleteRequest','ParentId','SalesforceError','380896vKgaAy','branchId','map','createPatchRequest','FLOSUM_COMPONENT','proceedComponentMeta','./salesforce-git-sync.service','createZip','componentId','184OOUSqA','FLOSUM_NAMESPACE','RecordTypeId','push','Repository','request','4uWDdSy','componentType','Source__c','(((.+)+)+)+$','prepareComponentHistoryRecord','Logger','reference','proceededComponentsMeta','__esModule','Last_Modified_Date__c','../../../constants','prepareComponentRecord','Branch__c','Deletion_By_Agent__c','1127731XBeoir','FLOSUM_COMPONENT_HISTORY','body','File_Name__c','base64','../utils/composite.utils','14lBXUze','775926LsMIql','Is_From_Agent__c','Branch','get','name','toISOString','keys','type','Commit__c','ContentType','gitSync','delete','extractFieldsFromRecord','330vwTiXl','CRC32__c','1768827ThjEuu','update','Last_Modified_By__c','Version__c','__importDefault','toString','insert','Description','721737KbHmwZ','username','find','DEFLATE','FLOSUM_ATTACHMENT','prepareComponentAttachmentRecord','FLOSUM_COMMIT_MANIFEST','Changed_On__c','generateAsync','componentsToUpdate','search','Zip','crc','recordTypes','Committed_On__c','FLOSUM_GIT_NAMESPACE','.id}','SalesforceGitSyncService','createPostRequest','componentName','../../parsers/utils/zip','constructor','files','2870874NRQMTM','prepareCommitManifest','Component_Name__c','logger','SalesforceComponentsManager','Last_Updated_By__c','Component_Type__c','145540LYEpvy'];a128_0x170d=function(){return _0x509de6;};return a128_0x170d();}Object['defineProperty'](exports,a128_0x33e45e(0x9d),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a128_0x33e45e(0x9f)),core_1=require('../../../core'),zip_1=require(a128_0x33e45e(0xd5)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a128_0x33e45e(0xa8)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a128_0x33e45e(0xeb));class SalesforceComponentsManager{constructor(_0x236df9,_0x5b604e,_0x4b9d97,_0x3e2032,_0x57f16b){const _0x3d68c7=a128_0x33e45e;this['repositoryId']=_0x236df9,this[_0x3d68c7(0xe6)]=_0x5b604e,this[_0x3d68c7(0xc2)]=_0x4b9d97,this['recordTypes']=_0x3e2032,this[_0x3d68c7(0x9c)]=_0x57f16b,this[_0x3d68c7(0xdb)]=new core_1[(_0x3d68c7(0x9a))](SalesforceComponentsManager[_0x3d68c7(0xae)]),this[_0x3d68c7(0xb4)]=typedi_1['default'][_0x3d68c7(0xad)](salesforce_git_sync_service_1[_0x3d68c7(0xd2)]);}[a128_0x33e45e(0xea)](_0x57803b,_0x29728d){const _0x56e666=a128_0x33e45e,_0x2b36b2=flosum_naming_utils_1[_0x56e666(0xb6)](_0x57803b,[_0x56e666(0xde),_0x56e666(0xda),_0x56e666(0xbc)]);this[_0x56e666(0x9c)][_0x56e666(0x92)]({'componentId':'','reference':_0x29728d,'version':_0x2b36b2[_0x56e666(0xbc)],'componentName':_0x2b36b2[_0x56e666(0xda)],'componentType':_0x2b36b2['Component_Type__c']});}[a128_0x33e45e(0xd9)](_0x4c940b,_0x5a7735){const _0x4111fc=a128_0x33e45e,{request:_0x403b9d}=composite_utils_1[_0x4111fc(0xd3)](constants_1[_0x4111fc(0xc7)],{[constants_1[_0x4111fc(0x90)]+_0x4111fc(0xb2)]:_0x4c940b,[constants_1[_0x4111fc(0x90)]+'Component_History__c']:_0x5a7735});return _0x403b9d;}async[a128_0x33e45e(0xc6)](_0x485e0c,_0x26815e){const _0x2db999=a128_0x33e45e,_0x29f5b5={},_0x255276=zip_1[_0x2db999(0xcc)][_0x2db999(0xec)]();for(const _0x26aaeb of Object[_0x2db999(0xb0)](_0x485e0c[_0x2db999(0xd7)])){_0x255276['file'](_0x26aaeb,_0x485e0c[_0x2db999(0xd7)][_0x26aaeb],{'createFolders':!![]});}return _0x29f5b5[_0x2db999(0xb3)]='application/zip',_0x29f5b5['Name']=_0x485e0c['type'],_0x29f5b5[_0x2db999(0xc0)]=_0x485e0c[_0x2db999(0xb1)],_0x29f5b5[_0x2db999(0xe3)]=_0x26815e,_0x29f5b5['Body']=await _0x255276[_0x2db999(0xc9)]({'type':_0x2db999(0xa7),'compression':_0x2db999(0xc4),'compressionOptions':{'level':0x6}}),_0x29f5b5;}[a128_0x33e45e(0x99)](_0x35637f,_0x3f9a7f,_0x2917b0){const _0x32c661=a128_0x33e45e,_0x2aa0cc=new Date()[_0x32c661(0xaf)](),_0x465f13={};return _0x465f13[constants_1['FLOSUM_NAMESPACE']+'Component__c']=_0x3f9a7f,_0x465f13[constants_1[_0x32c661(0x90)]+_0x32c661(0xb8)]=_0x35637f[_0x32c661(0xcd)],_0x465f13[constants_1[_0x32c661(0x90)]+_0x32c661(0xc8)]=_0x2aa0cc,_0x465f13[constants_1[_0x32c661(0x90)]+'Changed_By__c']=this['username'],_0x465f13[constants_1[_0x32c661(0x90)]+_0x32c661(0xbc)]=_0x2917b0?_0x2917b0+0x1:0x1,_0x465f13[constants_1[_0x32c661(0xd0)]+_0x32c661(0xab)]=!![],_0x465f13;}[a128_0x33e45e(0xa0)](_0x35f22e,_0x296f71){const _0x45a08d=a128_0x33e45e;var _0x23b571,_0x14833a;const _0x42fa4e=new Date()[_0x45a08d(0xaf)](),_0x1ed958={};return!_0x296f71?(this[_0x45a08d(0xe6)]?(_0x1ed958[constants_1[_0x45a08d(0x90)]+_0x45a08d(0xa1)]=this[_0x45a08d(0xe6)],_0x1ed958[constants_1[_0x45a08d(0x90)]+_0x45a08d(0x97)]=_0x45a08d(0xac),_0x1ed958['RecordTypeId']=(_0x23b571=this[_0x45a08d(0xce)][_0x45a08d(0xc3)](_0xfeeb2f=>_0xfeeb2f[_0x45a08d(0xae)]===_0x45a08d(0xac)))===null||_0x23b571===void 0x0?void 0x0:_0x23b571['id']):(_0x1ed958[constants_1[_0x45a08d(0x90)]+'Repository__c']=this['repositoryId'],_0x1ed958[constants_1[_0x45a08d(0x90)]+_0x45a08d(0x97)]=_0x45a08d(0x93),_0x1ed958[_0x45a08d(0x91)]=(_0x14833a=this['recordTypes'][_0x45a08d(0xc3)](_0x2d907d=>_0x2d907d['name']===_0x45a08d(0x93)))===null||_0x14833a===void 0x0?void 0x0:_0x14833a['id']),_0x1ed958[constants_1[_0x45a08d(0x90)]+_0x45a08d(0xbc)]=0x1):_0x1ed958[constants_1['FLOSUM_NAMESPACE']+_0x45a08d(0xbc)]=_0x296f71[_0x45a08d(0xe1)]+0x1,_0x1ed958[constants_1[_0x45a08d(0x90)]+_0x45a08d(0xde)]=_0x35f22e[_0x45a08d(0xb1)],_0x1ed958[constants_1[_0x45a08d(0x90)]+_0x45a08d(0xda)]=_0x35f22e[_0x45a08d(0xae)],_0x1ed958[constants_1[_0x45a08d(0x90)]+_0x45a08d(0xa6)]=_0x35f22e['filePath'],_0x1ed958[constants_1['FLOSUM_NAMESPACE']+_0x45a08d(0xdd)]=this[_0x45a08d(0xc2)],_0x1ed958[constants_1['FLOSUM_NAMESPACE']+_0x45a08d(0xbb)]=this[_0x45a08d(0xc2)],_0x1ed958[constants_1['FLOSUM_NAMESPACE']+_0x45a08d(0x9e)]=_0x42fa4e,_0x1ed958[constants_1[_0x45a08d(0x90)]+_0x45a08d(0xcf)]=_0x42fa4e,_0x1ed958[constants_1[_0x45a08d(0x90)]+_0x45a08d(0xb8)]=_0x35f22e[_0x45a08d(0xcd)],_0x1ed958;}['getProceededComponentsMeta'](){const _0x118acb=a128_0x33e45e;return this[_0x118acb(0x9c)];}async[a128_0x33e45e(0xbf)](_0x4d2f8f,_0x2992bb){const _0xfe1c8e=a128_0x33e45e,_0x127650=[];for(const _0x5e6dc2 of _0x4d2f8f){const _0x1602aa=composite_utils_1[_0xfe1c8e(0xd3)](constants_1[_0xfe1c8e(0xe9)],this[_0xfe1c8e(0xa0)](_0x5e6dc2)),_0xce046a=composite_utils_1[_0xfe1c8e(0xd3)](constants_1[_0xfe1c8e(0xa4)],this[_0xfe1c8e(0x99)](_0x5e6dc2,'@{'+_0x1602aa['reference']+'.id}')),_0x42b28e=composite_utils_1[_0xfe1c8e(0xd3)](constants_1[_0xfe1c8e(0xc5)],await this[_0xfe1c8e(0xc6)](_0x5e6dc2,'@{'+_0xce046a[_0xfe1c8e(0x9b)]+_0xfe1c8e(0xd1)));this[_0xfe1c8e(0xea)](_0x1602aa['request']['body'],_0x1602aa[_0xfe1c8e(0x9b)]),_0x127650[_0xfe1c8e(0x92)](_0x1602aa[_0xfe1c8e(0x94)],_0xce046a[_0xfe1c8e(0x94)],_0x42b28e[_0xfe1c8e(0x94)]),_0x2992bb&&_0x127650[_0xfe1c8e(0x92)](this['prepareCommitManifest'](_0x2992bb,'@{'+_0xce046a['reference']+_0xfe1c8e(0xd1)));}return _0x127650;}async[a128_0x33e45e(0xba)](_0x77b639,_0x1b6d5d=''){const _0x76635e=a128_0x33e45e,_0x2f81fd=[];for(const {component:_0x3c422c,meta:_0x2e5bbd}of _0x77b639){if(!_0x2e5bbd['id']){const _0x6caab4=this[_0x76635e(0x9c)][_0x76635e(0xc3)](_0x39610a=>_0x39610a['componentName']===_0x3c422c['name']&&_0x39610a[_0x76635e(0x96)]===_0x3c422c[_0x76635e(0xb1)]);if(!_0x6caab4)throw new salesforce_error_1[(_0x76635e(0xe4))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x3c422c[_0x76635e(0xae)]+'\x20['+_0x3c422c[_0x76635e(0xb1)]+']\x20-\x20meta\x20not\x20found'));_0x2e5bbd['id']=_0x6caab4[_0x76635e(0xed)];}const _0xb29060=composite_utils_1[_0x76635e(0xe8)](constants_1[_0x76635e(0xe9)],_0x2e5bbd['id'],this[_0x76635e(0xa0)](_0x3c422c,_0x2e5bbd)),_0x4b4017=composite_utils_1[_0x76635e(0xd3)](constants_1[_0x76635e(0xa4)],this[_0x76635e(0x99)](_0x3c422c,_0x2e5bbd['id'],_0x2e5bbd[_0x76635e(0xe1)])),_0x2ad070=composite_utils_1[_0x76635e(0xd3)](constants_1[_0x76635e(0xc5)],await this[_0x76635e(0xc6)](_0x3c422c,'@{'+_0x4b4017[_0x76635e(0x9b)]+_0x76635e(0xd1)));this[_0x76635e(0xea)](_0xb29060[_0x76635e(0x94)][_0x76635e(0xa5)],_0xb29060[_0x76635e(0x9b)]),_0x2f81fd['push'](_0xb29060[_0x76635e(0x94)],_0x4b4017[_0x76635e(0x94)],_0x2ad070[_0x76635e(0x94)]),_0x1b6d5d&&_0x2f81fd[_0x76635e(0x92)](this['prepareCommitManifest'](_0x1b6d5d,'@{'+_0x4b4017[_0x76635e(0x9b)]+_0x76635e(0xd1)));}return _0x2f81fd;}async[a128_0x33e45e(0xb5)](_0x57cb28,_0x35b867=![]){const _0x3a37bc=a128_0x33e45e,_0x4d4a85={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x4b8fd8=[];for(const _0x3a966f of _0x57cb28){if(_0x3a966f['id'])_0x4b8fd8[_0x3a37bc(0x92)](_0x3a966f['id']);else{const _0x80d621=this[_0x3a37bc(0x9c)][_0x3a37bc(0xc3)](_0x4f2b51=>_0x4f2b51[_0x3a37bc(0xd4)]===_0x3a966f[_0x3a37bc(0xae)]&&_0x4f2b51[_0x3a37bc(0x96)]===_0x3a966f[_0x3a37bc(0xb1)]);if(!_0x80d621||!_0x80d621['componentId'])continue;_0x4b8fd8[_0x3a37bc(0x92)](_0x80d621[_0x3a37bc(0xed)]);}}if(_0x35b867){const _0x72576d=await this[_0x3a37bc(0xb4)]['fetchCommitManifestsByComponentIds'](_0x4b8fd8);_0x4d4a85['manifests']=_0x72576d[_0x3a37bc(0xe7)](_0x44e8db=>composite_utils_1[_0x3a37bc(0xe2)](constants_1['FLOSUM_COMMIT_MANIFEST'],_0x44e8db)[_0x3a37bc(0x94)]);}return _0x4d4a85[_0x3a37bc(0xca)]=_0x4b8fd8['map'](_0x18a52c=>composite_utils_1['createPatchRequest'](constants_1[_0x3a37bc(0xe9)],_0x18a52c,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x3a37bc(0xa2)]:!![]})[_0x3a37bc(0x94)]),_0x4d4a85['componentsToDelete']=_0x4b8fd8[_0x3a37bc(0xe7)](_0x249115=>composite_utils_1[_0x3a37bc(0xe2)](constants_1[_0x3a37bc(0xe9)],_0x249115)[_0x3a37bc(0x94)]),_0x4d4a85;}}exports[a128_0x33e45e(0xdc)]=SalesforceComponentsManager;