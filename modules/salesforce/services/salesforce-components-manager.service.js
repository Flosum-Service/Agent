const a127_0x43e6b0=a127_0x39cd;(function(_0x271f2b,_0x5483e8){const _0x1f7a7b=a127_0x39cd,_0x1b5e65=_0x271f2b();while(!![]){try{const _0x4bc3e9=-parseInt(_0x1f7a7b(0xb7))/0x1+parseInt(_0x1f7a7b(0xc0))/0x2+-parseInt(_0x1f7a7b(0x9c))/0x3+-parseInt(_0x1f7a7b(0x77))/0x4*(-parseInt(_0x1f7a7b(0x6f))/0x5)+parseInt(_0x1f7a7b(0xb6))/0x6*(parseInt(_0x1f7a7b(0x7f))/0x7)+parseInt(_0x1f7a7b(0x70))/0x8*(parseInt(_0x1f7a7b(0x72))/0x9)+-parseInt(_0x1f7a7b(0xc1))/0xa;if(_0x4bc3e9===_0x5483e8)break;else _0x1b5e65['push'](_0x1b5e65['shift']());}catch(_0x5b7ff3){_0x1b5e65['push'](_0x1b5e65['shift']());}}}(a127_0x1511,0x65e2f));const a127_0x2bbcbc=(function(){let _0x4e06c4=!![];return function(_0x46acf4,_0x11902b){const _0x2ecedc=_0x4e06c4?function(){const _0x14e025=a127_0x39cd;if(_0x11902b){const _0x4aafe2=_0x11902b[_0x14e025(0x9b)](_0x46acf4,arguments);return _0x11902b=null,_0x4aafe2;}}:function(){};return _0x4e06c4=![],_0x2ecedc;};}()),a127_0x4396c4=a127_0x2bbcbc(this,function(){const _0x188479=a127_0x39cd;return a127_0x4396c4[_0x188479(0xab)]()[_0x188479(0x71)](_0x188479(0xbe))[_0x188479(0xab)]()[_0x188479(0xc4)](a127_0x4396c4)[_0x188479(0x71)](_0x188479(0xbe));});a127_0x4396c4();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x449ab4){const _0x4da638=a127_0x39cd;return _0x449ab4&&_0x449ab4[_0x4da638(0x78)]?_0x449ab4:{'default':_0x449ab4};};Object[a127_0x43e6b0(0xa2)](exports,'__esModule',{'value':!![]}),exports[a127_0x43e6b0(0x66)]=void 0x0;function a127_0x39cd(_0x3241fe,_0x5f43ec){const _0x135f30=a127_0x1511();return a127_0x39cd=function(_0x4396c4,_0x2bbcbc){_0x4396c4=_0x4396c4-0x64;let _0x1511a9=_0x135f30[_0x4396c4];return _0x1511a9;},a127_0x39cd(_0x3241fe,_0x5f43ec);}const constants_1=require(a127_0x43e6b0(0xc5)),core_1=require(a127_0x43e6b0(0x7e)),zip_1=require(a127_0x43e6b0(0xc3)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a127_0x43e6b0(0x85)),composite_utils_1=require(a127_0x43e6b0(0xb0)),flosum_naming_utils_1=require(a127_0x43e6b0(0x6a)),salesforce_git_sync_service_1=require(a127_0x43e6b0(0x80));class SalesforceComponentsManager{constructor(_0x35ed0e,_0x2f0fc7,_0x158967,_0xe214f1,_0x215730){const _0x58ddc7=a127_0x43e6b0;this[_0x58ddc7(0x94)]=_0x35ed0e,this[_0x58ddc7(0xa4)]=_0x2f0fc7,this[_0x58ddc7(0xaa)]=_0x158967,this[_0x58ddc7(0xba)]=_0xe214f1,this[_0x58ddc7(0xac)]=_0x215730,this[_0x58ddc7(0xa3)]=new core_1[(_0x58ddc7(0xb5))](SalesforceComponentsManager[_0x58ddc7(0x91)]),this[_0x58ddc7(0x9d)]=typedi_1['default']['get'](salesforce_git_sync_service_1[_0x58ddc7(0x86)]);}['proceedComponentMeta'](_0x3364d3,_0x2ff7eb){const _0x199e87=a127_0x43e6b0,_0x459dc6=flosum_naming_utils_1[_0x199e87(0x73)](_0x3364d3,[_0x199e87(0x97),'Component_Name__c','Version__c']);this[_0x199e87(0xac)][_0x199e87(0xb3)]({'componentId':'','reference':_0x2ff7eb,'version':_0x459dc6[_0x199e87(0x8a)],'componentName':_0x459dc6[_0x199e87(0xb8)],'componentType':_0x459dc6['Component_Type__c']});}['prepareCommitManifest'](_0x2c8313,_0x2c2c9a){const _0x516377=a127_0x43e6b0,{request:_0x191a3d}=composite_utils_1[_0x516377(0xbc)](constants_1[_0x516377(0x8c)],{[constants_1[_0x516377(0xa8)]+_0x516377(0x88)]:_0x2c8313,[constants_1[_0x516377(0xa8)]+_0x516377(0x7b)]:_0x2c2c9a});return _0x191a3d;}async[a127_0x43e6b0(0x93)](_0x3415ee,_0x9b9574){const _0x159bb3=a127_0x43e6b0,_0x41d568={},_0x2ebf08=zip_1['Zip']['createZip']();for(const _0x301793 of Object[_0x159bb3(0x6b)](_0x3415ee[_0x159bb3(0x8f)])){_0x2ebf08[_0x159bb3(0xb2)](_0x301793,_0x3415ee[_0x159bb3(0x8f)][_0x301793],{'createFolders':!![]});}return _0x41d568[_0x159bb3(0x76)]='application/zip',_0x41d568[_0x159bb3(0x95)]=_0x3415ee[_0x159bb3(0xb1)],_0x41d568[_0x159bb3(0xae)]=_0x3415ee[_0x159bb3(0xb1)],_0x41d568[_0x159bb3(0xa6)]=_0x9b9574,_0x41d568[_0x159bb3(0xa1)]=await _0x2ebf08['generateAsync']({'type':_0x159bb3(0x89),'compression':_0x159bb3(0x6e),'compressionOptions':{'level':0x6}}),_0x41d568;}[a127_0x43e6b0(0x82)](_0x3fe68a,_0x4dcb59,_0x23025b){const _0x11d66f=a127_0x43e6b0,_0x51518e=new Date()[_0x11d66f(0x67)](),_0x58ea76={};return _0x58ea76[constants_1[_0x11d66f(0xa8)]+'Component__c']=_0x4dcb59,_0x58ea76[constants_1[_0x11d66f(0xa8)]+_0x11d66f(0xc2)]=_0x3fe68a[_0x11d66f(0xa9)],_0x58ea76[constants_1[_0x11d66f(0xa8)]+_0x11d66f(0x69)]=_0x51518e,_0x58ea76[constants_1[_0x11d66f(0xa8)]+'Changed_By__c']=this[_0x11d66f(0xaa)],_0x58ea76[constants_1[_0x11d66f(0xa8)]+'Version__c']=_0x23025b?_0x23025b+0x1:0x1,_0x58ea76[constants_1[_0x11d66f(0x87)]+'Is_From_Agent__c']=!![],_0x58ea76;}['prepareComponentRecord'](_0xed2693,_0x38478d){const _0x5611ce=a127_0x43e6b0;var _0x4bba70,_0x89710a;const _0x4aafa5=new Date()[_0x5611ce(0x67)](),_0x521818={};return!_0x38478d?(this[_0x5611ce(0xa4)]?(_0x521818[constants_1[_0x5611ce(0xa8)]+'Branch__c']=this['branchId'],_0x521818[constants_1[_0x5611ce(0xa8)]+_0x5611ce(0x8b)]=_0x5611ce(0x65),_0x521818[_0x5611ce(0xa5)]=(_0x4bba70=this['recordTypes']['find'](_0x1672e6=>_0x1672e6[_0x5611ce(0x91)]===_0x5611ce(0x65)))===null||_0x4bba70===void 0x0?void 0x0:_0x4bba70['id']):(_0x521818[constants_1[_0x5611ce(0xa8)]+_0x5611ce(0xb9)]=this['repositoryId'],_0x521818[constants_1[_0x5611ce(0xa8)]+_0x5611ce(0x8b)]='Repository',_0x521818[_0x5611ce(0xa5)]=(_0x89710a=this['recordTypes'][_0x5611ce(0xa0)](_0x355cbf=>_0x355cbf[_0x5611ce(0x91)]===_0x5611ce(0x75)))===null||_0x89710a===void 0x0?void 0x0:_0x89710a['id']),_0x521818[constants_1[_0x5611ce(0xa8)]+'Version__c']=0x1):_0x521818[constants_1[_0x5611ce(0xa8)]+_0x5611ce(0x8a)]=_0x38478d[_0x5611ce(0x81)]+0x1,_0x521818[constants_1['FLOSUM_NAMESPACE']+_0x5611ce(0x97)]=_0xed2693[_0x5611ce(0xb1)],_0x521818[constants_1[_0x5611ce(0xa8)]+_0x5611ce(0xb8)]=_0xed2693[_0x5611ce(0x91)],_0x521818[constants_1[_0x5611ce(0xa8)]+_0x5611ce(0x9f)]=_0xed2693[_0x5611ce(0x83)],_0x521818[constants_1[_0x5611ce(0xa8)]+_0x5611ce(0xa7)]=this[_0x5611ce(0xaa)],_0x521818[constants_1[_0x5611ce(0xa8)]+'Last_Modified_By__c']=this['username'],_0x521818[constants_1[_0x5611ce(0xa8)]+_0x5611ce(0xbd)]=_0x4aafa5,_0x521818[constants_1[_0x5611ce(0xa8)]+_0x5611ce(0xad)]=_0x4aafa5,_0x521818[constants_1[_0x5611ce(0xa8)]+_0x5611ce(0xc2)]=_0xed2693[_0x5611ce(0xa9)],_0x521818;}[a127_0x43e6b0(0x9e)](){const _0x33c6e9=a127_0x43e6b0;return this[_0x33c6e9(0xac)];}async[a127_0x43e6b0(0x8e)](_0x426132,_0x23f32a=''){const _0x5056be=a127_0x43e6b0,_0x342f0e=[];for(const _0xda1562 of _0x426132){const _0x3f49cd=composite_utils_1[_0x5056be(0xbc)](constants_1[_0x5056be(0x79)],this[_0x5056be(0x6d)](_0xda1562)),_0x32c95f=composite_utils_1[_0x5056be(0xbc)](constants_1['FLOSUM_COMPONENT_HISTORY'],this['prepareComponentHistoryRecord'](_0xda1562,'@{'+_0x3f49cd[_0x5056be(0x9a)]+_0x5056be(0x68))),_0x593d70=composite_utils_1[_0x5056be(0xbc)](constants_1[_0x5056be(0x96)],await this[_0x5056be(0x93)](_0xda1562,'@{'+_0x32c95f['reference']+'.id}'));this[_0x5056be(0x92)](_0x3f49cd[_0x5056be(0x90)]['body'],_0x3f49cd[_0x5056be(0x9a)]),_0x342f0e['push'](_0x3f49cd[_0x5056be(0x90)],_0x32c95f['request'],_0x593d70[_0x5056be(0x90)]),_0x23f32a&&_0x342f0e['push'](this[_0x5056be(0x8d)](_0x23f32a,'@{'+_0x32c95f[_0x5056be(0x9a)]+_0x5056be(0x68)));}return _0x342f0e;}async['update'](_0x3db3b8,_0x4d26c3=''){const _0x35eeef=a127_0x43e6b0,_0x2a7c89=[];for(const {component:_0x245248,meta:_0x526e65}of _0x3db3b8){if(!_0x526e65['id']){const _0x4a4889=this[_0x35eeef(0xac)]['find'](_0x18a87e=>_0x18a87e[_0x35eeef(0x98)]===_0x245248['name']&&_0x18a87e[_0x35eeef(0x7a)]===_0x245248['type']);if(!_0x4a4889)throw new salesforce_error_1[(_0x35eeef(0x84))](new Error(_0x35eeef(0x7c)+_0x245248['name']+'\x20['+_0x245248[_0x35eeef(0xb1)]+']\x20-\x20meta\x20not\x20found'));_0x526e65['id']=_0x4a4889[_0x35eeef(0xaf)];}const _0x354ef8=composite_utils_1[_0x35eeef(0x64)](constants_1[_0x35eeef(0x79)],_0x526e65['id'],this[_0x35eeef(0x6d)](_0x245248,_0x526e65)),_0x562ce5=composite_utils_1['createPostRequest'](constants_1[_0x35eeef(0xbb)],this[_0x35eeef(0x82)](_0x245248,_0x526e65['id'],_0x526e65[_0x35eeef(0x81)])),_0x152b1f=composite_utils_1['createPostRequest'](constants_1['FLOSUM_ATTACHMENT'],await this['prepareComponentAttachmentRecord'](_0x245248,'@{'+_0x562ce5[_0x35eeef(0x9a)]+_0x35eeef(0x68)));this[_0x35eeef(0x92)](_0x354ef8[_0x35eeef(0x90)][_0x35eeef(0x74)],_0x354ef8[_0x35eeef(0x9a)]),_0x2a7c89[_0x35eeef(0xb3)](_0x354ef8[_0x35eeef(0x90)],_0x562ce5[_0x35eeef(0x90)],_0x152b1f[_0x35eeef(0x90)]),_0x4d26c3&&_0x2a7c89[_0x35eeef(0xb3)](this[_0x35eeef(0x8d)](_0x4d26c3,'@{'+_0x562ce5[_0x35eeef(0x9a)]+_0x35eeef(0x68)));}return _0x2a7c89;}async[a127_0x43e6b0(0xbf)](_0xf073a0,_0x54a340=![]){const _0x25174a=a127_0x43e6b0,_0xaf8d1={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x437c73=[];for(const _0x48ab67 of _0xf073a0){if(_0x48ab67[_0x25174a(0xaf)])_0x437c73[_0x25174a(0xb3)](_0x48ab67['componentId']);else{const _0x2b8d4a=this[_0x25174a(0xac)][_0x25174a(0xa0)](_0x110af2=>_0x110af2[_0x25174a(0x98)]===_0x48ab67['componentName']&&_0x110af2[_0x25174a(0x7a)]===_0x48ab67[_0x25174a(0x7a)]);if(!_0x2b8d4a||!_0x2b8d4a[_0x25174a(0xaf)])continue;_0x437c73[_0x25174a(0xb3)](_0x2b8d4a[_0x25174a(0xaf)]);}}if(_0x54a340){const _0xbc7f85=await this[_0x25174a(0x9d)]['fetchCommitManifestsByComponentIds'](_0x437c73);_0xaf8d1[_0x25174a(0x7d)]=_0xbc7f85[_0x25174a(0x6c)](_0x2b49c9=>composite_utils_1[_0x25174a(0xb4)](constants_1[_0x25174a(0x8c)],_0x2b49c9)[_0x25174a(0x90)]);}return _0xaf8d1['componentsToUpdate']=_0x437c73[_0x25174a(0x6c)](_0xce0731=>composite_utils_1[_0x25174a(0x64)](constants_1['FLOSUM_COMPONENT'],_0xce0731,{[constants_1[_0x25174a(0x87)]+'Deletion_By_Agent__c']:!![]})[_0x25174a(0x90)]),_0xaf8d1[_0x25174a(0x99)]=_0x437c73[_0x25174a(0x6c)](_0x40d9aa=>composite_utils_1['createDeleteRequest'](constants_1[_0x25174a(0x79)],_0x40d9aa)[_0x25174a(0x90)]),_0xaf8d1;}}function a127_0x1511(){const _0x26afd2=['defineProperty','logger','branchId','RecordTypeId','ParentId','Last_Updated_By__c','FLOSUM_NAMESPACE','crc','username','toString','proceededComponentsMeta','Committed_On__c','Description','componentId','../utils/composite.utils','type','file','push','createDeleteRequest','Logger','6ngeEZF','440845Yahhhg','Component_Name__c','Repository__c','recordTypes','FLOSUM_COMPONENT_HISTORY','createPostRequest','Last_Modified_Date__c','(((.+)+)+)+$','delete','626756CfDXzg','1336680oyavyl','CRC32__c','../../parsers/utils/zip','constructor','../../../constants','createPatchRequest','Branch','SalesforceComponentsManager','toISOString','.id}','Changed_On__c','../utils/flosum-naming.utils','keys','map','prepareComponentRecord','DEFLATE','3600VcQHXn','8MqWfUP','search','423171IYwpGc','extractFieldsFromRecord','body','Repository','ContentType','928vYrSic','__esModule','FLOSUM_COMPONENT','componentType','Component_History__c','Could\x20not\x20proceed\x20component\x20','manifests','../../../core','4074833GcHzIj','./salesforce-git-sync.service','version','prepareComponentHistoryRecord','filePath','SalesforceError','../errors/salesforce.error','SalesforceGitSyncService','FLOSUM_GIT_NAMESPACE','Commit__c','base64','Version__c','Source__c','FLOSUM_COMMIT_MANIFEST','prepareCommitManifest','insert','files','request','name','proceedComponentMeta','prepareComponentAttachmentRecord','repositoryId','Name','FLOSUM_ATTACHMENT','Component_Type__c','componentName','componentsToDelete','reference','apply','353148rfbMHY','gitSync','getProceededComponentsMeta','File_Name__c','find','Body'];a127_0x1511=function(){return _0x26afd2;};return a127_0x1511();}exports[a127_0x43e6b0(0x66)]=SalesforceComponentsManager;