const a128_0x5b515a=a128_0x2ec9;(function(_0x4fce0b,_0x26961c){const _0x1069d9=a128_0x2ec9,_0x42c65c=_0x4fce0b();while(!![]){try{const _0x4c26fd=-parseInt(_0x1069d9(0x12c))/0x1*(-parseInt(_0x1069d9(0x112))/0x2)+parseInt(_0x1069d9(0x11b))/0x3+parseInt(_0x1069d9(0xd6))/0x4*(-parseInt(_0x1069d9(0xdc))/0x5)+-parseInt(_0x1069d9(0x10a))/0x6+parseInt(_0x1069d9(0xf4))/0x7+parseInt(_0x1069d9(0x100))/0x8+parseInt(_0x1069d9(0x129))/0x9;if(_0x4c26fd===_0x26961c)break;else _0x42c65c['push'](_0x42c65c['shift']());}catch(_0x51ec5c){_0x42c65c['push'](_0x42c65c['shift']());}}}(a128_0x38bc,0xbbb1f));const a128_0x283f1a=(function(){let _0x5e730b=!![];return function(_0x4338e6,_0x498871){const _0x566d21=_0x5e730b?function(){const _0x14452e=a128_0x2ec9;if(_0x498871){const _0x103095=_0x498871[_0x14452e(0x105)](_0x4338e6,arguments);return _0x498871=null,_0x103095;}}:function(){};return _0x5e730b=![],_0x566d21;};}()),a128_0x50ce18=a128_0x283f1a(this,function(){const _0x4c729a=a128_0x2ec9;return a128_0x50ce18[_0x4c729a(0xf7)]()[_0x4c729a(0xfe)](_0x4c729a(0xed))[_0x4c729a(0xf7)]()[_0x4c729a(0x10e)](a128_0x50ce18)[_0x4c729a(0xfe)]('(((.+)+)+)+$');});function a128_0x38bc(){const _0x228dda=['SalesforceComponentsManager','ContentType','find','.id}','delete','crc','request','manifests','get','68MWxyIL','componentsToDelete','componentName','RecordTypeId','toISOString','application/zip','258020DOthKQ','FLOSUM_ATTACHMENT','keys','__importDefault','Component_Name__c','File_Name__c','Commit__c','push','gitSync','version','prepareCommitManifest','componentsToUpdate','FLOSUM_GIT_NAMESPACE','Is_From_Agent__c','componentId','createPostRequest','prepareComponentAttachmentRecord','(((.+)+)+)+$','../errors/salesforce.error','createDeleteRequest','Committed_On__c','SalesforceError','getProceededComponentsMeta','Changed_By__c','9123415ZNfnyF','prepareComponentHistoryRecord','prepareComponentRecord','toString','proceededComponentsMeta','type','CRC32__c','../../../core','FLOSUM_COMMIT_MANIFEST','Logger','search','FLOSUM_NAMESPACE','5391176TLiLqC','username','FLOSUM_COMPONENT','name','proceedComponentMeta','apply','Name','typedi','../../../constants','base64','7308336jVGqwV','ParentId','FLOSUM_COMPONENT_HISTORY','filePath','constructor','map','Could\x20not\x20proceed\x20component\x20',']\x20-\x20meta\x20not\x20found','42uxgOBu','reference','__esModule','../utils/composite.utils','update','./salesforce-git-sync.service','fetchCommitManifestsByComponentIds','Version__c','branchId','1644060kytbPu','body','Component_History__c','Last_Updated_By__c','Branch__c','Branch','recordTypes','../utils/flosum-naming.utils','repositoryId','../../parsers/utils/zip','Changed_On__c','Source__c','Zip','Deletion_By_Agent__c','1097190YtBVrG','Repository','defineProperty','10331ZKocbe','Component_Type__c'];a128_0x38bc=function(){return _0x228dda;};return a128_0x38bc();}function a128_0x2ec9(_0x153e4d,_0x4f79ef){const _0x3fa470=a128_0x38bc();return a128_0x2ec9=function(_0x50ce18,_0x283f1a){_0x50ce18=_0x50ce18-0xd2;let _0x38bc1a=_0x3fa470[_0x50ce18];return _0x38bc1a;},a128_0x2ec9(_0x153e4d,_0x4f79ef);}a128_0x50ce18();'use strict';var __importDefault=this&&this[a128_0x5b515a(0xdf)]||function(_0x4b0f2e){const _0x18dc23=a128_0x5b515a;return _0x4b0f2e&&_0x4b0f2e[_0x18dc23(0x114)]?_0x4b0f2e:{'default':_0x4b0f2e};};Object[a128_0x5b515a(0x12b)](exports,a128_0x5b515a(0x114),{'value':!![]}),exports[a128_0x5b515a(0x12e)]=void 0x0;const constants_1=require(a128_0x5b515a(0x108)),core_1=require(a128_0x5b515a(0xfb)),zip_1=require(a128_0x5b515a(0x124)),typedi_1=__importDefault(require(a128_0x5b515a(0x107))),salesforce_error_1=require(a128_0x5b515a(0xee)),composite_utils_1=require(a128_0x5b515a(0x115)),flosum_naming_utils_1=require(a128_0x5b515a(0x122)),salesforce_git_sync_service_1=require(a128_0x5b515a(0x117));class SalesforceComponentsManager{constructor(_0xaee380,_0x4a23b0,_0x936ec7,_0xa4f533,_0x15517b){const _0x3e938b=a128_0x5b515a;this[_0x3e938b(0x123)]=_0xaee380,this[_0x3e938b(0x11a)]=_0x4a23b0,this[_0x3e938b(0x101)]=_0x936ec7,this[_0x3e938b(0x121)]=_0xa4f533,this['proceededComponentsMeta']=_0x15517b,this['logger']=new core_1[(_0x3e938b(0xfd))](SalesforceComponentsManager['name']),this[_0x3e938b(0xe4)]=typedi_1['default'][_0x3e938b(0xd5)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a128_0x5b515a(0x104)](_0x4844b5,_0xc11d8d){const _0x43e5e4=a128_0x5b515a,_0x2d27b8=flosum_naming_utils_1['extractFieldsFromRecord'](_0x4844b5,[_0x43e5e4(0x12d),'Component_Name__c','Version__c']);this['proceededComponentsMeta'][_0x43e5e4(0xe3)]({'componentId':'','reference':_0xc11d8d,'version':_0x2d27b8['Version__c'],'componentName':_0x2d27b8[_0x43e5e4(0xe0)],'componentType':_0x2d27b8['Component_Type__c']});}[a128_0x5b515a(0xe6)](_0x30e105,_0x5d6015){const _0x2d1a3e=a128_0x5b515a,{request:_0x30fcaa}=composite_utils_1[_0x2d1a3e(0xeb)](constants_1[_0x2d1a3e(0xfc)],{[constants_1[_0x2d1a3e(0xff)]+_0x2d1a3e(0xe2)]:_0x30e105,[constants_1[_0x2d1a3e(0xff)]+_0x2d1a3e(0x11d)]:_0x5d6015});return _0x30fcaa;}async['prepareComponentAttachmentRecord'](_0x4949d1,_0x44c82f){const _0x21b1a4=a128_0x5b515a,_0x3ab240={},_0xf442a4=zip_1[_0x21b1a4(0x127)]['createZip']();for(const _0xe4ff96 of Object[_0x21b1a4(0xde)](_0x4949d1['files'])){_0xf442a4['file'](_0xe4ff96,_0x4949d1['files'][_0xe4ff96],{'createFolders':!![]});}return _0x3ab240[_0x21b1a4(0x12f)]=_0x21b1a4(0xdb),_0x3ab240[_0x21b1a4(0x106)]=_0x4949d1['type'],_0x3ab240['Description']=_0x4949d1[_0x21b1a4(0xf9)],_0x3ab240[_0x21b1a4(0x10b)]=_0x44c82f,_0x3ab240['Body']=await _0xf442a4['generateAsync']({'type':_0x21b1a4(0x109),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x3ab240;}[a128_0x5b515a(0xf5)](_0x10a60b,_0x13e97d,_0x3c829d){const _0x1e213c=a128_0x5b515a,_0x53152f=new Date()[_0x1e213c(0xda)](),_0x4a42c4={};return _0x4a42c4[constants_1[_0x1e213c(0xff)]+'Component__c']=_0x13e97d,_0x4a42c4[constants_1[_0x1e213c(0xff)]+_0x1e213c(0xfa)]=_0x10a60b[_0x1e213c(0xd2)],_0x4a42c4[constants_1['FLOSUM_NAMESPACE']+_0x1e213c(0x125)]=_0x53152f,_0x4a42c4[constants_1[_0x1e213c(0xff)]+_0x1e213c(0xf3)]=this[_0x1e213c(0x101)],_0x4a42c4[constants_1['FLOSUM_NAMESPACE']+_0x1e213c(0x119)]=_0x3c829d?_0x3c829d+0x1:0x1,_0x4a42c4[constants_1[_0x1e213c(0xe8)]+_0x1e213c(0xe9)]=!![],_0x4a42c4;}[a128_0x5b515a(0xf6)](_0x19a95c,_0x3648d9){const _0x1fe8cf=a128_0x5b515a;var _0x529d2d,_0x8336ba;const _0x272ccf=new Date()['toISOString'](),_0x2c3af2={};return!_0x3648d9?(this[_0x1fe8cf(0x11a)]?(_0x2c3af2[constants_1['FLOSUM_NAMESPACE']+_0x1fe8cf(0x11f)]=this[_0x1fe8cf(0x11a)],_0x2c3af2[constants_1[_0x1fe8cf(0xff)]+_0x1fe8cf(0x126)]='Branch',_0x2c3af2[_0x1fe8cf(0xd9)]=(_0x529d2d=this[_0x1fe8cf(0x121)][_0x1fe8cf(0x130)](_0x483a48=>_0x483a48[_0x1fe8cf(0x103)]===_0x1fe8cf(0x120)))===null||_0x529d2d===void 0x0?void 0x0:_0x529d2d['id']):(_0x2c3af2[constants_1['FLOSUM_NAMESPACE']+'Repository__c']=this['repositoryId'],_0x2c3af2[constants_1[_0x1fe8cf(0xff)]+_0x1fe8cf(0x126)]=_0x1fe8cf(0x12a),_0x2c3af2[_0x1fe8cf(0xd9)]=(_0x8336ba=this[_0x1fe8cf(0x121)][_0x1fe8cf(0x130)](_0x4ecc41=>_0x4ecc41[_0x1fe8cf(0x103)]===_0x1fe8cf(0x12a)))===null||_0x8336ba===void 0x0?void 0x0:_0x8336ba['id']),_0x2c3af2[constants_1['FLOSUM_NAMESPACE']+_0x1fe8cf(0x119)]=0x1):_0x2c3af2[constants_1['FLOSUM_NAMESPACE']+_0x1fe8cf(0x119)]=_0x3648d9[_0x1fe8cf(0xe5)]+0x1,_0x2c3af2[constants_1[_0x1fe8cf(0xff)]+_0x1fe8cf(0x12d)]=_0x19a95c[_0x1fe8cf(0xf9)],_0x2c3af2[constants_1['FLOSUM_NAMESPACE']+_0x1fe8cf(0xe0)]=_0x19a95c[_0x1fe8cf(0x103)],_0x2c3af2[constants_1['FLOSUM_NAMESPACE']+_0x1fe8cf(0xe1)]=_0x19a95c[_0x1fe8cf(0x10d)],_0x2c3af2[constants_1[_0x1fe8cf(0xff)]+_0x1fe8cf(0x11e)]=this[_0x1fe8cf(0x101)],_0x2c3af2[constants_1[_0x1fe8cf(0xff)]+'Last_Modified_By__c']=this[_0x1fe8cf(0x101)],_0x2c3af2[constants_1[_0x1fe8cf(0xff)]+'Last_Modified_Date__c']=_0x272ccf,_0x2c3af2[constants_1['FLOSUM_NAMESPACE']+_0x1fe8cf(0xf0)]=_0x272ccf,_0x2c3af2[constants_1[_0x1fe8cf(0xff)]+_0x1fe8cf(0xfa)]=_0x19a95c['crc'],_0x2c3af2;}[a128_0x5b515a(0xf2)](){const _0x260437=a128_0x5b515a;return this[_0x260437(0xf8)];}async['insert'](_0x5101d9,_0x543994){const _0x31267c=a128_0x5b515a,_0x57e00d=[];for(const _0x2c9cbd of _0x5101d9){const _0x5dc69d=composite_utils_1[_0x31267c(0xeb)](constants_1[_0x31267c(0x102)],this['prepareComponentRecord'](_0x2c9cbd)),_0x45dd38=composite_utils_1[_0x31267c(0xeb)](constants_1[_0x31267c(0x10c)],this[_0x31267c(0xf5)](_0x2c9cbd,'@{'+_0x5dc69d[_0x31267c(0x113)]+'.id}')),_0x1bea51=composite_utils_1[_0x31267c(0xeb)](constants_1['FLOSUM_ATTACHMENT'],await this['prepareComponentAttachmentRecord'](_0x2c9cbd,'@{'+_0x45dd38['reference']+_0x31267c(0x131)));this[_0x31267c(0x104)](_0x5dc69d['request'][_0x31267c(0x11c)],_0x5dc69d['reference']),_0x57e00d['push'](_0x5dc69d['request'],_0x45dd38[_0x31267c(0xd3)],_0x1bea51['request']),_0x543994&&_0x57e00d[_0x31267c(0xe3)](this['prepareCommitManifest'](_0x543994,'@{'+_0x45dd38['reference']+_0x31267c(0x131)));}return _0x57e00d;}async[a128_0x5b515a(0x116)](_0x1344da,_0x2c2ed4=''){const _0xce9308=a128_0x5b515a,_0x366fc8=[];for(const {component:_0x2d0843,meta:_0xcf0d35}of _0x1344da){if(!_0xcf0d35['id']){const _0x134ad1=this[_0xce9308(0xf8)][_0xce9308(0x130)](_0x23d5d4=>_0x23d5d4['componentName']===_0x2d0843[_0xce9308(0x103)]&&_0x23d5d4['componentType']===_0x2d0843[_0xce9308(0xf9)]);if(!_0x134ad1)throw new salesforce_error_1[(_0xce9308(0xf1))](new Error(_0xce9308(0x110)+_0x2d0843[_0xce9308(0x103)]+'\x20['+_0x2d0843[_0xce9308(0xf9)]+_0xce9308(0x111)));_0xcf0d35['id']=_0x134ad1[_0xce9308(0xea)];}const _0x8ce98e=composite_utils_1['createPatchRequest'](constants_1[_0xce9308(0x102)],_0xcf0d35['id'],this[_0xce9308(0xf6)](_0x2d0843,_0xcf0d35)),_0x37cc18=composite_utils_1[_0xce9308(0xeb)](constants_1[_0xce9308(0x10c)],this[_0xce9308(0xf5)](_0x2d0843,_0xcf0d35['id'],_0xcf0d35[_0xce9308(0xe5)])),_0x3f3f79=composite_utils_1['createPostRequest'](constants_1[_0xce9308(0xdd)],await this[_0xce9308(0xec)](_0x2d0843,'@{'+_0x37cc18[_0xce9308(0x113)]+_0xce9308(0x131)));this[_0xce9308(0x104)](_0x8ce98e['request'][_0xce9308(0x11c)],_0x8ce98e[_0xce9308(0x113)]),_0x366fc8['push'](_0x8ce98e['request'],_0x37cc18[_0xce9308(0xd3)],_0x3f3f79['request']),_0x2c2ed4&&_0x366fc8['push'](this[_0xce9308(0xe6)](_0x2c2ed4,'@{'+_0x37cc18['reference']+'.id}'));}return _0x366fc8;}async[a128_0x5b515a(0x132)](_0x214aa3,_0x4694f6=![]){const _0x5b1fd2=a128_0x5b515a,_0x325702={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x3146b6=[];for(const _0xabf3a of _0x214aa3){if(_0xabf3a['id'])_0x3146b6[_0x5b1fd2(0xe3)](_0xabf3a['id']);else{const _0x89b37c=this[_0x5b1fd2(0xf8)][_0x5b1fd2(0x130)](_0x4a365c=>_0x4a365c[_0x5b1fd2(0xd8)]===_0xabf3a[_0x5b1fd2(0x103)]&&_0x4a365c['componentType']===_0xabf3a[_0x5b1fd2(0xf9)]);if(!_0x89b37c||!_0x89b37c[_0x5b1fd2(0xea)])continue;_0x3146b6[_0x5b1fd2(0xe3)](_0x89b37c[_0x5b1fd2(0xea)]);}}if(_0x4694f6){const _0x27f823=await this['gitSync'][_0x5b1fd2(0x118)](_0x3146b6);_0x325702[_0x5b1fd2(0xd4)]=_0x27f823['map'](_0x29e707=>composite_utils_1[_0x5b1fd2(0xef)](constants_1[_0x5b1fd2(0xfc)],_0x29e707)[_0x5b1fd2(0xd3)]);}return _0x325702[_0x5b1fd2(0xe7)]=_0x3146b6['map'](_0x4abd53=>composite_utils_1['createPatchRequest'](constants_1[_0x5b1fd2(0x102)],_0x4abd53,{[constants_1[_0x5b1fd2(0xe8)]+_0x5b1fd2(0x128)]:!![]})[_0x5b1fd2(0xd3)]),_0x325702[_0x5b1fd2(0xd7)]=_0x3146b6[_0x5b1fd2(0x10f)](_0xf81c42=>composite_utils_1[_0x5b1fd2(0xef)](constants_1[_0x5b1fd2(0x102)],_0xf81c42)[_0x5b1fd2(0xd3)]),_0x325702;}}exports[a128_0x5b515a(0x12e)]=SalesforceComponentsManager;