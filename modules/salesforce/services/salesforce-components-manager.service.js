const a128_0x2e8d5=a128_0x1af4;(function(_0xfd0345,_0x25d959){const _0x1b3019=a128_0x1af4,_0x42736e=_0xfd0345();while(!![]){try{const _0x2fb4c0=-parseInt(_0x1b3019(0xcf))/0x1+-parseInt(_0x1b3019(0x82))/0x2+-parseInt(_0x1b3019(0xbb))/0x3*(-parseInt(_0x1b3019(0xab))/0x4)+parseInt(_0x1b3019(0xd1))/0x5*(-parseInt(_0x1b3019(0x83))/0x6)+-parseInt(_0x1b3019(0x9f))/0x7*(-parseInt(_0x1b3019(0x89))/0x8)+-parseInt(_0x1b3019(0x9a))/0x9+parseInt(_0x1b3019(0xa9))/0xa*(parseInt(_0x1b3019(0xce))/0xb);if(_0x2fb4c0===_0x25d959)break;else _0x42736e['push'](_0x42736e['shift']());}catch(_0x2105f2){_0x42736e['push'](_0x42736e['shift']());}}}(a128_0x4151,0xc7e7b));const a128_0x6f1703=(function(){let _0x3ed321=!![];return function(_0x296cb6,_0x2c15bf){const _0x2b91d9=_0x3ed321?function(){const _0x14a58a=a128_0x1af4;if(_0x2c15bf){const _0x6cee7=_0x2c15bf[_0x14a58a(0xc2)](_0x296cb6,arguments);return _0x2c15bf=null,_0x6cee7;}}:function(){};return _0x3ed321=![],_0x2b91d9;};}()),a128_0x4bcdfb=a128_0x6f1703(this,function(){const _0x5e09c1=a128_0x1af4;return a128_0x4bcdfb[_0x5e09c1(0xae)]()[_0x5e09c1(0xb3)](_0x5e09c1(0xad))[_0x5e09c1(0xae)]()[_0x5e09c1(0xa7)](a128_0x4bcdfb)[_0x5e09c1(0xb3)](_0x5e09c1(0xad));});function a128_0x1af4(_0x2d27d5,_0x17a961){const _0x22318f=a128_0x4151();return a128_0x1af4=function(_0x4bcdfb,_0x6f1703){_0x4bcdfb=_0x4bcdfb-0x75;let _0x415135=_0x22318f[_0x4bcdfb];return _0x415135;},a128_0x1af4(_0x2d27d5,_0x17a961);}function a128_0x4151(){const _0x337851=['application/zip','.id}','__esModule','Last_Updated_By__c','../errors/salesforce.error','type','apply','./salesforce-git-sync.service','name','file','Component_Type__c','gitSync','toISOString','Body','map','fetchCommitManifestsByComponentIds','prepareCommitManifest','Last_Modified_Date__c','10967FDsXDk','1016712RRnpFp','DEFLATE','5410525vNbTOv','username','componentType','componentsToUpdate','logger','CRC32__c','prepareComponentHistoryRecord','Component__c','update','createPatchRequest','Description','componentsToDelete','prepareComponentAttachmentRecord','prepareComponentRecord','request','base64','get','1563072HuzAjw','6jFwICC','Branch__c','createDeleteRequest','SalesforceGitSyncService','Last_Modified_By__c','__importDefault','429736ihCpvd','Source__c','default','componentName','Component_Name__c','FLOSUM_COMPONENT_HISTORY','Changed_On__c','FLOSUM_GIT_NAMESPACE','crc','FLOSUM_NAMESPACE','ParentId','FLOSUM_COMPONENT','../../parsers/utils/zip','body','files','Version__c','Branch','4153887GVivak','find','Logger','createZip','Zip','147jmHTeK','RecordTypeId','Could\x20not\x20proceed\x20component\x20','File_Name__c','reference','push','SalesforceError','componentId','constructor','createPostRequest','23030ENUOlV','../../../core','2516wrfABL','proceedComponentMeta','(((.+)+)+)+$','toString','Is_From_Agent__c','delete','Name','SalesforceComponentsManager','search','Repository','getProceededComponentsMeta','Changed_By__c','recordTypes','proceededComponentsMeta','../utils/flosum-naming.utils','FLOSUM_ATTACHMENT','3513VfUfBO'];a128_0x4151=function(){return _0x337851;};return a128_0x4151();}a128_0x4bcdfb();'use strict';var __importDefault=this&&this[a128_0x2e8d5(0x88)]||function(_0x44a8b7){const _0x349a11=a128_0x2e8d5;return _0x44a8b7&&_0x44a8b7[_0x349a11(0xbe)]?_0x44a8b7:{'default':_0x44a8b7};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a128_0x2e8d5(0xb2)]=void 0x0;const constants_1=require('../../../constants'),core_1=require(a128_0x2e8d5(0xaa)),zip_1=require(a128_0x2e8d5(0x95)),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a128_0x2e8d5(0xc0)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a128_0x2e8d5(0xb9)),salesforce_git_sync_service_1=require(a128_0x2e8d5(0xc3));class SalesforceComponentsManager{constructor(_0x5cdf39,_0xf51a3b,_0x157df3,_0x5c3360,_0xe54a9b){const _0x2549ae=a128_0x2e8d5;this['repositoryId']=_0x5cdf39,this['branchId']=_0xf51a3b,this[_0x2549ae(0xd2)]=_0x157df3,this['recordTypes']=_0x5c3360,this[_0x2549ae(0xb8)]=_0xe54a9b,this[_0x2549ae(0x75)]=new core_1[(_0x2549ae(0x9c))](SalesforceComponentsManager[_0x2549ae(0xc4)]),this[_0x2549ae(0xc7)]=typedi_1[_0x2549ae(0x8b)][_0x2549ae(0x81)](salesforce_git_sync_service_1[_0x2549ae(0x86)]);}[a128_0x2e8d5(0xac)](_0x1eae66,_0x341a40){const _0x3ae964=a128_0x2e8d5,_0x4d0e2d=flosum_naming_utils_1['extractFieldsFromRecord'](_0x1eae66,[_0x3ae964(0xc6),_0x3ae964(0x8d),_0x3ae964(0x98)]);this[_0x3ae964(0xb8)]['push']({'componentId':'','reference':_0x341a40,'version':_0x4d0e2d[_0x3ae964(0x98)],'componentName':_0x4d0e2d[_0x3ae964(0x8d)],'componentType':_0x4d0e2d[_0x3ae964(0xc6)]});}[a128_0x2e8d5(0xcc)](_0x224bc2,_0x50c8c9){const _0x14ee6b=a128_0x2e8d5,{request:_0x470371}=composite_utils_1['createPostRequest'](constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x14ee6b(0x92)]+'Commit__c']:_0x224bc2,[constants_1['FLOSUM_NAMESPACE']+'Component_History__c']:_0x50c8c9});return _0x470371;}async[a128_0x2e8d5(0x7d)](_0x27a0cf,_0x16d950){const _0x1dea33=a128_0x2e8d5,_0x3fb60d={},_0x3857df=zip_1[_0x1dea33(0x9e)][_0x1dea33(0x9d)]();for(const _0x4b947a of Object['keys'](_0x27a0cf[_0x1dea33(0x97)])){_0x3857df[_0x1dea33(0xc5)](_0x4b947a,_0x27a0cf[_0x1dea33(0x97)][_0x4b947a],{'createFolders':!![]});}return _0x3fb60d['ContentType']=_0x1dea33(0xbc),_0x3fb60d[_0x1dea33(0xb1)]=_0x27a0cf['type'],_0x3fb60d[_0x1dea33(0x7b)]=_0x27a0cf[_0x1dea33(0xc1)],_0x3fb60d[_0x1dea33(0x93)]=_0x16d950,_0x3fb60d[_0x1dea33(0xc9)]=await _0x3857df['generateAsync']({'type':_0x1dea33(0x80),'compression':_0x1dea33(0xd0),'compressionOptions':{'level':0x6}}),_0x3fb60d;}['prepareComponentHistoryRecord'](_0x4875d0,_0x29da13,_0x507edb){const _0x31da33=a128_0x2e8d5,_0x5bcc1f=new Date()['toISOString'](),_0x1fc48e={};return _0x1fc48e[constants_1[_0x31da33(0x92)]+_0x31da33(0x78)]=_0x29da13,_0x1fc48e[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x4875d0[_0x31da33(0x91)],_0x1fc48e[constants_1[_0x31da33(0x92)]+_0x31da33(0x8f)]=_0x5bcc1f,_0x1fc48e[constants_1[_0x31da33(0x92)]+_0x31da33(0xb6)]=this[_0x31da33(0xd2)],_0x1fc48e[constants_1[_0x31da33(0x92)]+'Version__c']=_0x507edb?_0x507edb+0x1:0x1,_0x1fc48e[constants_1['FLOSUM_GIT_NAMESPACE']+_0x31da33(0xaf)]=!![],_0x1fc48e;}[a128_0x2e8d5(0x7e)](_0x274dde,_0x3cff2e){const _0x17e9d3=a128_0x2e8d5;var _0x531ad0,_0x5c7ed7;const _0x563c27=new Date()[_0x17e9d3(0xc8)](),_0x2f0676={};return!_0x3cff2e?(this['branchId']?(_0x2f0676[constants_1[_0x17e9d3(0x92)]+_0x17e9d3(0x84)]=this['branchId'],_0x2f0676[constants_1[_0x17e9d3(0x92)]+_0x17e9d3(0x8a)]='Branch',_0x2f0676[_0x17e9d3(0xa0)]=(_0x531ad0=this[_0x17e9d3(0xb7)][_0x17e9d3(0x9b)](_0x2f9452=>_0x2f9452[_0x17e9d3(0xc4)]===_0x17e9d3(0x99)))===null||_0x531ad0===void 0x0?void 0x0:_0x531ad0['id']):(_0x2f0676[constants_1['FLOSUM_NAMESPACE']+'Repository__c']=this['repositoryId'],_0x2f0676[constants_1[_0x17e9d3(0x92)]+_0x17e9d3(0x8a)]=_0x17e9d3(0xb4),_0x2f0676['RecordTypeId']=(_0x5c7ed7=this[_0x17e9d3(0xb7)][_0x17e9d3(0x9b)](_0x3e9a55=>_0x3e9a55[_0x17e9d3(0xc4)]===_0x17e9d3(0xb4)))===null||_0x5c7ed7===void 0x0?void 0x0:_0x5c7ed7['id']),_0x2f0676[constants_1[_0x17e9d3(0x92)]+_0x17e9d3(0x98)]=0x1):_0x2f0676[constants_1[_0x17e9d3(0x92)]+_0x17e9d3(0x98)]=_0x3cff2e['version']+0x1,_0x2f0676[constants_1[_0x17e9d3(0x92)]+'Component_Type__c']=_0x274dde[_0x17e9d3(0xc1)],_0x2f0676[constants_1[_0x17e9d3(0x92)]+_0x17e9d3(0x8d)]=_0x274dde[_0x17e9d3(0xc4)],_0x2f0676[constants_1[_0x17e9d3(0x92)]+_0x17e9d3(0xa2)]=_0x274dde['filePath'],_0x2f0676[constants_1[_0x17e9d3(0x92)]+_0x17e9d3(0xbf)]=this[_0x17e9d3(0xd2)],_0x2f0676[constants_1[_0x17e9d3(0x92)]+_0x17e9d3(0x87)]=this[_0x17e9d3(0xd2)],_0x2f0676[constants_1[_0x17e9d3(0x92)]+_0x17e9d3(0xcd)]=_0x563c27,_0x2f0676[constants_1['FLOSUM_NAMESPACE']+'Committed_On__c']=_0x563c27,_0x2f0676[constants_1[_0x17e9d3(0x92)]+_0x17e9d3(0x76)]=_0x274dde[_0x17e9d3(0x91)],_0x2f0676;}[a128_0x2e8d5(0xb5)](){const _0x2c4055=a128_0x2e8d5;return this[_0x2c4055(0xb8)];}async['insert'](_0x445b64,_0x49d62c){const _0x401dea=a128_0x2e8d5,_0x4dbc08=[];for(const _0xa57403 of _0x445b64){const _0x388c7b=composite_utils_1[_0x401dea(0xa8)](constants_1['FLOSUM_COMPONENT'],this[_0x401dea(0x7e)](_0xa57403)),_0x31ac22=composite_utils_1[_0x401dea(0xa8)](constants_1[_0x401dea(0x8e)],this['prepareComponentHistoryRecord'](_0xa57403,'@{'+_0x388c7b['reference']+_0x401dea(0xbd))),_0x258bdc=composite_utils_1[_0x401dea(0xa8)](constants_1['FLOSUM_ATTACHMENT'],await this[_0x401dea(0x7d)](_0xa57403,'@{'+_0x31ac22[_0x401dea(0xa3)]+'.id}'));this[_0x401dea(0xac)](_0x388c7b[_0x401dea(0x7f)]['body'],_0x388c7b[_0x401dea(0xa3)]),_0x4dbc08[_0x401dea(0xa4)](_0x388c7b[_0x401dea(0x7f)],_0x31ac22[_0x401dea(0x7f)],_0x258bdc[_0x401dea(0x7f)]),_0x49d62c&&_0x4dbc08[_0x401dea(0xa4)](this[_0x401dea(0xcc)](_0x49d62c,'@{'+_0x31ac22[_0x401dea(0xa3)]+_0x401dea(0xbd)));}return _0x4dbc08;}async[a128_0x2e8d5(0x79)](_0x5cb4f4,_0x1741b7=''){const _0x3c80fc=a128_0x2e8d5,_0x3edfd2=[];for(const {component:_0x55792d,meta:_0x3ff164}of _0x5cb4f4){if(!_0x3ff164['id']){const _0x20cb53=this[_0x3c80fc(0xb8)][_0x3c80fc(0x9b)](_0x1426f7=>_0x1426f7[_0x3c80fc(0x8c)]===_0x55792d[_0x3c80fc(0xc4)]&&_0x1426f7[_0x3c80fc(0xd3)]===_0x55792d['type']);if(!_0x20cb53)throw new salesforce_error_1[(_0x3c80fc(0xa5))](new Error(_0x3c80fc(0xa1)+_0x55792d[_0x3c80fc(0xc4)]+'\x20['+_0x55792d[_0x3c80fc(0xc1)]+']\x20-\x20meta\x20not\x20found'));_0x3ff164['id']=_0x20cb53[_0x3c80fc(0xa6)];}const _0x4789ee=composite_utils_1[_0x3c80fc(0x7a)](constants_1['FLOSUM_COMPONENT'],_0x3ff164['id'],this['prepareComponentRecord'](_0x55792d,_0x3ff164)),_0x4b0be4=composite_utils_1[_0x3c80fc(0xa8)](constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x3c80fc(0x77)](_0x55792d,_0x3ff164['id'],_0x3ff164['version'])),_0x3db51=composite_utils_1[_0x3c80fc(0xa8)](constants_1[_0x3c80fc(0xba)],await this['prepareComponentAttachmentRecord'](_0x55792d,'@{'+_0x4b0be4['reference']+_0x3c80fc(0xbd)));this[_0x3c80fc(0xac)](_0x4789ee[_0x3c80fc(0x7f)][_0x3c80fc(0x96)],_0x4789ee[_0x3c80fc(0xa3)]),_0x3edfd2[_0x3c80fc(0xa4)](_0x4789ee[_0x3c80fc(0x7f)],_0x4b0be4[_0x3c80fc(0x7f)],_0x3db51[_0x3c80fc(0x7f)]),_0x1741b7&&_0x3edfd2[_0x3c80fc(0xa4)](this[_0x3c80fc(0xcc)](_0x1741b7,'@{'+_0x4b0be4[_0x3c80fc(0xa3)]+'.id}'));}return _0x3edfd2;}async[a128_0x2e8d5(0xb0)](_0x5f423a,_0x2fe1cb=![]){const _0x4d2813=a128_0x2e8d5,_0x1f60b1={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x488e90=[];for(const _0x39a8fc of _0x5f423a){if(_0x39a8fc['id'])_0x488e90['push'](_0x39a8fc['id']);else{const _0x5ae757=this[_0x4d2813(0xb8)]['find'](_0x77d78f=>_0x77d78f[_0x4d2813(0x8c)]===_0x39a8fc[_0x4d2813(0xc4)]&&_0x77d78f[_0x4d2813(0xd3)]===_0x39a8fc[_0x4d2813(0xc1)]);if(!_0x5ae757||!_0x5ae757['componentId'])continue;_0x488e90[_0x4d2813(0xa4)](_0x5ae757[_0x4d2813(0xa6)]);}}if(_0x2fe1cb){const _0x48e7ec=await this[_0x4d2813(0xc7)][_0x4d2813(0xcb)](_0x488e90);_0x1f60b1['manifests']=_0x48e7ec[_0x4d2813(0xca)](_0x272c7e=>composite_utils_1['createDeleteRequest'](constants_1['FLOSUM_COMMIT_MANIFEST'],_0x272c7e)[_0x4d2813(0x7f)]);}return _0x1f60b1[_0x4d2813(0xd4)]=_0x488e90[_0x4d2813(0xca)](_0x358f91=>composite_utils_1[_0x4d2813(0x7a)](constants_1['FLOSUM_COMPONENT'],_0x358f91,{[constants_1[_0x4d2813(0x90)]+'Deletion_By_Agent__c']:!![]})[_0x4d2813(0x7f)]),_0x1f60b1[_0x4d2813(0x7c)]=_0x488e90[_0x4d2813(0xca)](_0x3c6cf3=>composite_utils_1[_0x4d2813(0x85)](constants_1[_0x4d2813(0x94)],_0x3c6cf3)[_0x4d2813(0x7f)]),_0x1f60b1;}}exports[a128_0x2e8d5(0xb2)]=SalesforceComponentsManager;