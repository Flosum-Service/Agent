const a128_0x52cdb9=a128_0x25a3;(function(_0x69619a,_0xefef2b){const _0x9600cf=a128_0x25a3,_0x510d38=_0x69619a();while(!![]){try{const _0x19eaf2=-parseInt(_0x9600cf(0x1ce))/0x1*(parseInt(_0x9600cf(0x1ee))/0x2)+parseInt(_0x9600cf(0x1c7))/0x3*(-parseInt(_0x9600cf(0x1d3))/0x4)+-parseInt(_0x9600cf(0x1ff))/0x5+parseInt(_0x9600cf(0x1cd))/0x6+-parseInt(_0x9600cf(0x1e2))/0x7+-parseInt(_0x9600cf(0x1ec))/0x8*(parseInt(_0x9600cf(0x21d))/0x9)+parseInt(_0x9600cf(0x1db))/0xa*(parseInt(_0x9600cf(0x1fd))/0xb);if(_0x19eaf2===_0xefef2b)break;else _0x510d38['push'](_0x510d38['shift']());}catch(_0x24403c){_0x510d38['push'](_0x510d38['shift']());}}}(a128_0x3b59,0xd2977));const a128_0x374a01=(function(){let _0x26ab73=!![];return function(_0x12038a,_0x283f68){const _0x3217e9=_0x26ab73?function(){const _0x332172=a128_0x25a3;if(_0x283f68){const _0x24a934=_0x283f68[_0x332172(0x1f2)](_0x12038a,arguments);return _0x283f68=null,_0x24a934;}}:function(){};return _0x26ab73=![],_0x3217e9;};}()),a128_0x4e99b0=a128_0x374a01(this,function(){const _0x5bbd9c=a128_0x25a3;return a128_0x4e99b0['toString']()[_0x5bbd9c(0x202)]('(((.+)+)+)+$')[_0x5bbd9c(0x1d0)]()[_0x5bbd9c(0x1fc)](a128_0x4e99b0)[_0x5bbd9c(0x202)](_0x5bbd9c(0x224));});a128_0x4e99b0();'use strict';function a128_0x25a3(_0x4e30ff,_0x5291ca){const _0xfa47ce=a128_0x3b59();return a128_0x25a3=function(_0x4e99b0,_0x374a01){_0x4e99b0=_0x4e99b0-0x1c4;let _0x3b5932=_0xfa47ce[_0x4e99b0];return _0x3b5932;},a128_0x25a3(_0x4e30ff,_0x5291ca);}var __importDefault=this&&this[a128_0x52cdb9(0x1f1)]||function(_0xc389a8){const _0x598092=a128_0x52cdb9;return _0xc389a8&&_0xc389a8[_0x598092(0x222)]?_0xc389a8:{'default':_0xc389a8};};Object[a128_0x52cdb9(0x1f4)](exports,'__esModule',{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;function a128_0x3b59(){const _0x1e264f=['application/zip','FLOSUM_ATTACHMENT','Source__c','../errors/salesforce.error','Component_Name__c','prepareComponentHistoryRecord','generateAsync','Branch','Repository__c','Last_Modified_Date__c','prepareCommitManifest','createZip','RecordTypeId','FLOSUM_NAMESPACE','Component_History__c','./salesforce-git-sync.service','createDeleteRequest','toISOString','componentName','../../parsers/utils/zip','version','Logger','request','type','21915cUbmCN','SalesforceGitSyncService','componentId','FLOSUM_COMMIT_MANIFEST','proceedComponentMeta','__esModule','Could\x20not\x20proceed\x20component\x20','(((.+)+)+)+$','prepareComponentRecord','base64','prepareComponentAttachmentRecord','crc','FLOSUM_COMPONENT','repositoryId','componentType','body','username','732951IsVKut','push','Component__c','Version__c','Repository','fetchCommitManifestsByComponentIds','4094796rutpxB','1QviQou','find','toString','Name','logger','12KmyIJy','typedi','CRC32__c','Last_Modified_By__c','Is_From_Agent__c','gitSync','reference','../utils/flosum-naming.utils','1077560VRbdaW','SalesforceComponentsManager','../../../constants','Deletion_By_Agent__c','componentsToUpdate','map','FLOSUM_GIT_NAMESPACE','11427878TYGfNu','FLOSUM_COMPONENT_HISTORY','Body','SalesforceError','default','files','Changed_On__c','componentsToDelete','file','Component_Type__c','5128tyYTWH','extractFieldsFromRecord','199428NoYDaO','createPostRequest','../../../core','__importDefault','apply','Committed_On__c','defineProperty','proceededComponentsMeta','recordTypes','Changed_By__c','name','ParentId','filePath','createPatchRequest','constructor','572muixKy','File_Name__c','6985705yybmoP','Description','.id}','search','manifests','branchId'];a128_0x3b59=function(){return _0x1e264f;};return a128_0x3b59();}const constants_1=require(a128_0x52cdb9(0x1dd)),core_1=require(a128_0x52cdb9(0x1f0)),zip_1=require(a128_0x52cdb9(0x218)),typedi_1=__importDefault(require(a128_0x52cdb9(0x1d4))),salesforce_error_1=require(a128_0x52cdb9(0x208)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a128_0x52cdb9(0x1da)),salesforce_git_sync_service_1=require(a128_0x52cdb9(0x214));class SalesforceComponentsManager{constructor(_0x47ce05,_0x203ef6,_0x13e160,_0x25b5a4,_0x39acf5){const _0x17acd0=a128_0x52cdb9;this[_0x17acd0(0x22a)]=_0x47ce05,this[_0x17acd0(0x204)]=_0x203ef6,this[_0x17acd0(0x1c6)]=_0x13e160,this[_0x17acd0(0x1f6)]=_0x25b5a4,this[_0x17acd0(0x1f5)]=_0x39acf5,this[_0x17acd0(0x1d2)]=new core_1[(_0x17acd0(0x21a))](SalesforceComponentsManager[_0x17acd0(0x1f8)]),this['gitSync']=typedi_1[_0x17acd0(0x1e6)]['get'](salesforce_git_sync_service_1[_0x17acd0(0x21e)]);}['proceedComponentMeta'](_0xe16f81,_0xbe8fc1){const _0x2eb446=a128_0x52cdb9,_0x828134=flosum_naming_utils_1[_0x2eb446(0x1ed)](_0xe16f81,[_0x2eb446(0x1eb),_0x2eb446(0x209),'Version__c']);this[_0x2eb446(0x1f5)][_0x2eb446(0x1c8)]({'componentId':'','reference':_0xbe8fc1,'version':_0x828134[_0x2eb446(0x1ca)],'componentName':_0x828134['Component_Name__c'],'componentType':_0x828134['Component_Type__c']});}[a128_0x52cdb9(0x20f)](_0xee3f45,_0x161241){const _0x344d16=a128_0x52cdb9,{request:_0x4bac8e}=composite_utils_1[_0x344d16(0x1ef)](constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x344d16(0x212)]+'Commit__c']:_0xee3f45,[constants_1[_0x344d16(0x212)]+_0x344d16(0x213)]:_0x161241});return _0x4bac8e;}async[a128_0x52cdb9(0x227)](_0x45142e,_0x32cc58){const _0x407870=a128_0x52cdb9,_0x55d242={},_0x366da9=zip_1['Zip'][_0x407870(0x210)]();for(const _0x2902b7 of Object['keys'](_0x45142e[_0x407870(0x1e7)])){_0x366da9[_0x407870(0x1ea)](_0x2902b7,_0x45142e[_0x407870(0x1e7)][_0x2902b7],{'createFolders':!![]});}return _0x55d242['ContentType']=_0x407870(0x205),_0x55d242[_0x407870(0x1d1)]=_0x45142e[_0x407870(0x21c)],_0x55d242[_0x407870(0x200)]=_0x45142e['type'],_0x55d242[_0x407870(0x1f9)]=_0x32cc58,_0x55d242[_0x407870(0x1e4)]=await _0x366da9[_0x407870(0x20b)]({'type':_0x407870(0x226),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x55d242;}['prepareComponentHistoryRecord'](_0x345fa1,_0x3b8b7a,_0x5674f5){const _0x4f3425=a128_0x52cdb9,_0x1b3513=new Date()[_0x4f3425(0x216)](),_0x20a142={};return _0x20a142[constants_1[_0x4f3425(0x212)]+_0x4f3425(0x1c9)]=_0x3b8b7a,_0x20a142[constants_1[_0x4f3425(0x212)]+'CRC32__c']=_0x345fa1[_0x4f3425(0x228)],_0x20a142[constants_1[_0x4f3425(0x212)]+_0x4f3425(0x1e8)]=_0x1b3513,_0x20a142[constants_1[_0x4f3425(0x212)]+_0x4f3425(0x1f7)]=this[_0x4f3425(0x1c6)],_0x20a142[constants_1[_0x4f3425(0x212)]+_0x4f3425(0x1ca)]=_0x5674f5?_0x5674f5+0x1:0x1,_0x20a142[constants_1[_0x4f3425(0x1e1)]+_0x4f3425(0x1d7)]=!![],_0x20a142;}['prepareComponentRecord'](_0x4d2cdc,_0x43576a){const _0x1bfe94=a128_0x52cdb9;var _0x445aa5,_0x47717b;const _0x1f4e64=new Date()[_0x1bfe94(0x216)](),_0x4d7266={};return!_0x43576a?(this[_0x1bfe94(0x204)]?(_0x4d7266[constants_1[_0x1bfe94(0x212)]+'Branch__c']=this[_0x1bfe94(0x204)],_0x4d7266[constants_1[_0x1bfe94(0x212)]+'Source__c']='Branch',_0x4d7266[_0x1bfe94(0x211)]=(_0x445aa5=this['recordTypes'][_0x1bfe94(0x1cf)](_0x2e94e9=>_0x2e94e9['name']===_0x1bfe94(0x20c)))===null||_0x445aa5===void 0x0?void 0x0:_0x445aa5['id']):(_0x4d7266[constants_1['FLOSUM_NAMESPACE']+_0x1bfe94(0x20d)]=this['repositoryId'],_0x4d7266[constants_1['FLOSUM_NAMESPACE']+_0x1bfe94(0x207)]=_0x1bfe94(0x1cb),_0x4d7266[_0x1bfe94(0x211)]=(_0x47717b=this[_0x1bfe94(0x1f6)]['find'](_0x4f729d=>_0x4f729d[_0x1bfe94(0x1f8)]===_0x1bfe94(0x1cb)))===null||_0x47717b===void 0x0?void 0x0:_0x47717b['id']),_0x4d7266[constants_1['FLOSUM_NAMESPACE']+_0x1bfe94(0x1ca)]=0x1):_0x4d7266[constants_1[_0x1bfe94(0x212)]+_0x1bfe94(0x1ca)]=_0x43576a[_0x1bfe94(0x219)]+0x1,_0x4d7266[constants_1[_0x1bfe94(0x212)]+'Component_Type__c']=_0x4d2cdc[_0x1bfe94(0x21c)],_0x4d7266[constants_1[_0x1bfe94(0x212)]+_0x1bfe94(0x209)]=_0x4d2cdc[_0x1bfe94(0x1f8)],_0x4d7266[constants_1[_0x1bfe94(0x212)]+_0x1bfe94(0x1fe)]=_0x4d2cdc[_0x1bfe94(0x1fa)],_0x4d7266[constants_1[_0x1bfe94(0x212)]+'Last_Updated_By__c']=this[_0x1bfe94(0x1c6)],_0x4d7266[constants_1['FLOSUM_NAMESPACE']+_0x1bfe94(0x1d6)]=this[_0x1bfe94(0x1c6)],_0x4d7266[constants_1[_0x1bfe94(0x212)]+_0x1bfe94(0x20e)]=_0x1f4e64,_0x4d7266[constants_1[_0x1bfe94(0x212)]+_0x1bfe94(0x1f3)]=_0x1f4e64,_0x4d7266[constants_1[_0x1bfe94(0x212)]+_0x1bfe94(0x1d5)]=_0x4d2cdc[_0x1bfe94(0x228)],_0x4d7266;}['getProceededComponentsMeta'](){const _0x153717=a128_0x52cdb9;return this[_0x153717(0x1f5)];}async['insert'](_0x3a88c4,_0x2c1639){const _0x38c51c=a128_0x52cdb9,_0x24e582=[];for(const _0x5b97d4 of _0x3a88c4){const _0x398442=composite_utils_1[_0x38c51c(0x1ef)](constants_1[_0x38c51c(0x229)],this['prepareComponentRecord'](_0x5b97d4)),_0x4bf2a5=composite_utils_1[_0x38c51c(0x1ef)](constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x38c51c(0x20a)](_0x5b97d4,'@{'+_0x398442[_0x38c51c(0x1d9)]+_0x38c51c(0x201))),_0x2728f5=composite_utils_1[_0x38c51c(0x1ef)](constants_1[_0x38c51c(0x206)],await this['prepareComponentAttachmentRecord'](_0x5b97d4,'@{'+_0x4bf2a5[_0x38c51c(0x1d9)]+_0x38c51c(0x201)));this[_0x38c51c(0x221)](_0x398442[_0x38c51c(0x21b)][_0x38c51c(0x1c5)],_0x398442['reference']),_0x24e582[_0x38c51c(0x1c8)](_0x398442[_0x38c51c(0x21b)],_0x4bf2a5[_0x38c51c(0x21b)],_0x2728f5[_0x38c51c(0x21b)]),_0x2c1639&&_0x24e582['push'](this['prepareCommitManifest'](_0x2c1639,'@{'+_0x4bf2a5['reference']+_0x38c51c(0x201)));}return _0x24e582;}async['update'](_0x2f7d51,_0x20398e=''){const _0x48fe2b=a128_0x52cdb9,_0x16c22e=[];for(const {component:_0x48202a,meta:_0x3d953a}of _0x2f7d51){if(!_0x3d953a['id']){const _0x2bd41f=this['proceededComponentsMeta']['find'](_0x5ebdc4=>_0x5ebdc4[_0x48fe2b(0x217)]===_0x48202a['name']&&_0x5ebdc4[_0x48fe2b(0x1c4)]===_0x48202a['type']);if(!_0x2bd41f)throw new salesforce_error_1[(_0x48fe2b(0x1e5))](new Error(_0x48fe2b(0x223)+_0x48202a[_0x48fe2b(0x1f8)]+'\x20['+_0x48202a[_0x48fe2b(0x21c)]+']\x20-\x20meta\x20not\x20found'));_0x3d953a['id']=_0x2bd41f[_0x48fe2b(0x21f)];}const _0x1fe9d8=composite_utils_1[_0x48fe2b(0x1fb)](constants_1[_0x48fe2b(0x229)],_0x3d953a['id'],this[_0x48fe2b(0x225)](_0x48202a,_0x3d953a)),_0x39208f=composite_utils_1['createPostRequest'](constants_1[_0x48fe2b(0x1e3)],this[_0x48fe2b(0x20a)](_0x48202a,_0x3d953a['id'],_0x3d953a[_0x48fe2b(0x219)])),_0x1451e8=composite_utils_1['createPostRequest'](constants_1[_0x48fe2b(0x206)],await this[_0x48fe2b(0x227)](_0x48202a,'@{'+_0x39208f[_0x48fe2b(0x1d9)]+_0x48fe2b(0x201)));this[_0x48fe2b(0x221)](_0x1fe9d8[_0x48fe2b(0x21b)][_0x48fe2b(0x1c5)],_0x1fe9d8[_0x48fe2b(0x1d9)]),_0x16c22e[_0x48fe2b(0x1c8)](_0x1fe9d8[_0x48fe2b(0x21b)],_0x39208f[_0x48fe2b(0x21b)],_0x1451e8[_0x48fe2b(0x21b)]),_0x20398e&&_0x16c22e['push'](this[_0x48fe2b(0x20f)](_0x20398e,'@{'+_0x39208f[_0x48fe2b(0x1d9)]+_0x48fe2b(0x201)));}return _0x16c22e;}async['delete'](_0x174d9a,_0x35e503=![]){const _0x86a7b6=a128_0x52cdb9,_0xab409e={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x5638f7=[];for(const _0x5cd798 of _0x174d9a){if(_0x5cd798['id'])_0x5638f7['push'](_0x5cd798['id']);else{const _0x456610=this[_0x86a7b6(0x1f5)][_0x86a7b6(0x1cf)](_0x4e409b=>_0x4e409b[_0x86a7b6(0x217)]===_0x5cd798[_0x86a7b6(0x1f8)]&&_0x4e409b[_0x86a7b6(0x1c4)]===_0x5cd798[_0x86a7b6(0x21c)]);if(!_0x456610||!_0x456610[_0x86a7b6(0x21f)])continue;_0x5638f7[_0x86a7b6(0x1c8)](_0x456610[_0x86a7b6(0x21f)]);}}if(_0x35e503){const _0x4a5c5d=await this[_0x86a7b6(0x1d8)][_0x86a7b6(0x1cc)](_0x5638f7);_0xab409e[_0x86a7b6(0x203)]=_0x4a5c5d[_0x86a7b6(0x1e0)](_0x3ec4a9=>composite_utils_1[_0x86a7b6(0x215)](constants_1[_0x86a7b6(0x220)],_0x3ec4a9)['request']);}return _0xab409e[_0x86a7b6(0x1df)]=_0x5638f7[_0x86a7b6(0x1e0)](_0x2e8ba6=>composite_utils_1[_0x86a7b6(0x1fb)](constants_1['FLOSUM_COMPONENT'],_0x2e8ba6,{[constants_1[_0x86a7b6(0x1e1)]+_0x86a7b6(0x1de)]:!![]})[_0x86a7b6(0x21b)]),_0xab409e[_0x86a7b6(0x1e9)]=_0x5638f7['map'](_0x559d26=>composite_utils_1[_0x86a7b6(0x215)](constants_1['FLOSUM_COMPONENT'],_0x559d26)[_0x86a7b6(0x21b)]),_0xab409e;}}exports[a128_0x52cdb9(0x1dc)]=SalesforceComponentsManager;