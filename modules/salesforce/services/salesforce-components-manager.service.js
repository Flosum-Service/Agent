const a128_0x450e57=a128_0x179b;function a128_0x51a5(){const _0x1f0819=['145464kTcegQ','.id}','../errors/salesforce.error','gitSync','245432nKBJET','search','prepareComponentRecord','prepareCommitManifest','username','../../../constants','createZip','ContentType','componentType','find','Component_History__c','Changed_By__c','proceededComponentsMeta','createDeleteRequest','recordTypes','1016262qjODsc','FLOSUM_COMMIT_MANIFEST','getProceededComponentsMeta','version','filePath','Description','14BVYMYp','FLOSUM_COMPONENT_HISTORY','60OxkxkP','componentsToDelete','logger','extractFieldsFromRecord','__esModule','Name','crc','insert','557950oBkxhy','../utils/flosum-naming.utils','Could\x20not\x20proceed\x20component\x20','constructor','FLOSUM_NAMESPACE','map','FLOSUM_GIT_NAMESPACE','Zip','application/zip','name','typedi','proceedComponentMeta','File_Name__c',']\x20-\x20meta\x20not\x20found','file','prepareComponentAttachmentRecord','componentId','createPostRequest','base64','45NwcEie','generateAsync','533910UPjVeg','RecordTypeId','Branch__c','__importDefault','Commit__c','update','fetchCommitManifestsByComponentIds','Repository','FLOSUM_COMPONENT','484oHCoiT','Version__c','../utils/composite.utils','toString','./salesforce-git-sync.service','type','push','FLOSUM_ATTACHMENT','(((.+)+)+)+$','files','ParentId','Committed_On__c','delete','Last_Modified_Date__c','SalesforceError','Component_Type__c','CRC32__c','apply','repositoryId','SalesforceGitSyncService','reference','Source__c','manifests','13430uUivFh','defineProperty','Branch','branchId','Is_From_Agent__c','toISOString','Deletion_By_Agent__c','body','SalesforceComponentsManager','request','../../parsers/utils/zip','prepareComponentHistoryRecord','Body','37839ZBmrnC','Component_Name__c','default'];a128_0x51a5=function(){return _0x1f0819;};return a128_0x51a5();}(function(_0x4db807,_0x3ace44){const _0x48416c=a128_0x179b,_0x376b13=_0x4db807();while(!![]){try{const _0x1ab86b=-parseInt(_0x48416c(0x123))/0x1+parseInt(_0x48416c(0xe1))/0x2+parseInt(_0x48416c(0xd1))/0x3+-parseInt(_0x48416c(0xff))/0x4*(parseInt(_0x48416c(0x116))/0x5)+-parseInt(_0x48416c(0xf6))/0x6*(parseInt(_0x48416c(0xd7))/0x7)+parseInt(_0x48416c(0x12a))/0x8*(parseInt(_0x48416c(0xf4))/0x9)+-parseInt(_0x48416c(0xd9))/0xa*(-parseInt(_0x48416c(0x126))/0xb);if(_0x1ab86b===_0x3ace44)break;else _0x376b13['push'](_0x376b13['shift']());}catch(_0x491bdf){_0x376b13['push'](_0x376b13['shift']());}}}(a128_0x51a5,0x4b995));const a128_0x2ec918=(function(){let _0x2178e5=!![];return function(_0x14b7f0,_0x490330){const _0x5d4c2d=_0x2178e5?function(){const _0xe500e9=a128_0x179b;if(_0x490330){const _0x953df1=_0x490330[_0xe500e9(0x110)](_0x14b7f0,arguments);return _0x490330=null,_0x953df1;}}:function(){};return _0x2178e5=![],_0x5d4c2d;};}()),a128_0x16b882=a128_0x2ec918(this,function(){const _0x5e2c5a=a128_0x179b;return a128_0x16b882['toString']()[_0x5e2c5a(0x12b)](_0x5e2c5a(0x107))[_0x5e2c5a(0x102)]()[_0x5e2c5a(0xe4)](a128_0x16b882)[_0x5e2c5a(0x12b)]('(((.+)+)+)+$');});function a128_0x179b(_0x10d8ee,_0x5d5d3e){const _0x447de0=a128_0x51a5();return a128_0x179b=function(_0x16b882,_0x2ec918){_0x16b882=_0x16b882-0xd0;let _0x51a5ea=_0x447de0[_0x16b882];return _0x51a5ea;},a128_0x179b(_0x10d8ee,_0x5d5d3e);}a128_0x16b882();'use strict';var __importDefault=this&&this[a128_0x450e57(0xf9)]||function(_0x1abeab){const _0x1f0273=a128_0x450e57;return _0x1abeab&&_0x1abeab[_0x1f0273(0xdd)]?_0x1abeab:{'default':_0x1abeab};};Object[a128_0x450e57(0x117)](exports,a128_0x450e57(0xdd),{'value':!![]}),exports[a128_0x450e57(0x11e)]=void 0x0;const constants_1=require(a128_0x450e57(0x12f)),core_1=require('../../../core'),zip_1=require(a128_0x450e57(0x120)),typedi_1=__importDefault(require(a128_0x450e57(0xeb))),salesforce_error_1=require(a128_0x450e57(0x128)),composite_utils_1=require(a128_0x450e57(0x101)),flosum_naming_utils_1=require(a128_0x450e57(0xe2)),salesforce_git_sync_service_1=require(a128_0x450e57(0x103));class SalesforceComponentsManager{constructor(_0x252788,_0x153ca4,_0x4092e8,_0x352e02,_0x1e8481){const _0x43a908=a128_0x450e57;this[_0x43a908(0x111)]=_0x252788,this[_0x43a908(0x119)]=_0x153ca4,this['username']=_0x4092e8,this['recordTypes']=_0x352e02,this['proceededComponentsMeta']=_0x1e8481,this[_0x43a908(0xdb)]=new core_1['Logger'](SalesforceComponentsManager[_0x43a908(0xea)]),this[_0x43a908(0x129)]=typedi_1[_0x43a908(0x125)]['get'](salesforce_git_sync_service_1[_0x43a908(0x112)]);}[a128_0x450e57(0xec)](_0x184a8f,_0x29cf8d){const _0x16497f=a128_0x450e57,_0x54882f=flosum_naming_utils_1[_0x16497f(0xdc)](_0x184a8f,[_0x16497f(0x10e),_0x16497f(0x124),_0x16497f(0x100)]);this[_0x16497f(0x136)][_0x16497f(0x105)]({'componentId':'','reference':_0x29cf8d,'version':_0x54882f[_0x16497f(0x100)],'componentName':_0x54882f[_0x16497f(0x124)],'componentType':_0x54882f[_0x16497f(0x10e)]});}[a128_0x450e57(0x12d)](_0x4a860f,_0x10c954){const _0x2e114f=a128_0x450e57,{request:_0x215109}=composite_utils_1['createPostRequest'](constants_1[_0x2e114f(0xd2)],{[constants_1['FLOSUM_NAMESPACE']+_0x2e114f(0xfa)]:_0x4a860f,[constants_1['FLOSUM_NAMESPACE']+_0x2e114f(0x134)]:_0x10c954});return _0x215109;}async[a128_0x450e57(0xf0)](_0x2b87c3,_0x1b5d4e){const _0x4dbc2e=a128_0x450e57,_0x2c3ecf={},_0x4715de=zip_1[_0x4dbc2e(0xe8)][_0x4dbc2e(0x130)]();for(const _0x3104a0 of Object['keys'](_0x2b87c3[_0x4dbc2e(0x108)])){_0x4715de[_0x4dbc2e(0xef)](_0x3104a0,_0x2b87c3['files'][_0x3104a0],{'createFolders':!![]});}return _0x2c3ecf[_0x4dbc2e(0x131)]=_0x4dbc2e(0xe9),_0x2c3ecf[_0x4dbc2e(0xde)]=_0x2b87c3[_0x4dbc2e(0x104)],_0x2c3ecf[_0x4dbc2e(0xd6)]=_0x2b87c3[_0x4dbc2e(0x104)],_0x2c3ecf[_0x4dbc2e(0x109)]=_0x1b5d4e,_0x2c3ecf[_0x4dbc2e(0x122)]=await _0x4715de[_0x4dbc2e(0xf5)]({'type':_0x4dbc2e(0xf3),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x2c3ecf;}['prepareComponentHistoryRecord'](_0x4f7235,_0x11424a,_0x44aef6){const _0x57f78e=a128_0x450e57,_0x543cac=new Date()[_0x57f78e(0x11b)](),_0x274189={};return _0x274189[constants_1['FLOSUM_NAMESPACE']+'Component__c']=_0x11424a,_0x274189[constants_1[_0x57f78e(0xe5)]+'CRC32__c']=_0x4f7235[_0x57f78e(0xdf)],_0x274189[constants_1['FLOSUM_NAMESPACE']+'Changed_On__c']=_0x543cac,_0x274189[constants_1[_0x57f78e(0xe5)]+_0x57f78e(0x135)]=this['username'],_0x274189[constants_1[_0x57f78e(0xe5)]+_0x57f78e(0x100)]=_0x44aef6?_0x44aef6+0x1:0x1,_0x274189[constants_1[_0x57f78e(0xe7)]+_0x57f78e(0x11a)]=!![],_0x274189;}[a128_0x450e57(0x12c)](_0x200ec9,_0x1a454c){const _0x5174ac=a128_0x450e57;var _0xa2a839,_0x47afc5;const _0x58e139=new Date()[_0x5174ac(0x11b)](),_0x1e6669={};return!_0x1a454c?(this[_0x5174ac(0x119)]?(_0x1e6669[constants_1[_0x5174ac(0xe5)]+_0x5174ac(0xf8)]=this[_0x5174ac(0x119)],_0x1e6669[constants_1[_0x5174ac(0xe5)]+'Source__c']=_0x5174ac(0x118),_0x1e6669[_0x5174ac(0xf7)]=(_0xa2a839=this[_0x5174ac(0xd0)]['find'](_0x33cb3c=>_0x33cb3c[_0x5174ac(0xea)]===_0x5174ac(0x118)))===null||_0xa2a839===void 0x0?void 0x0:_0xa2a839['id']):(_0x1e6669[constants_1[_0x5174ac(0xe5)]+'Repository__c']=this[_0x5174ac(0x111)],_0x1e6669[constants_1['FLOSUM_NAMESPACE']+_0x5174ac(0x114)]='Repository',_0x1e6669['RecordTypeId']=(_0x47afc5=this['recordTypes'][_0x5174ac(0x133)](_0x3452b7=>_0x3452b7[_0x5174ac(0xea)]===_0x5174ac(0xfd)))===null||_0x47afc5===void 0x0?void 0x0:_0x47afc5['id']),_0x1e6669[constants_1[_0x5174ac(0xe5)]+'Version__c']=0x1):_0x1e6669[constants_1[_0x5174ac(0xe5)]+_0x5174ac(0x100)]=_0x1a454c['version']+0x1,_0x1e6669[constants_1[_0x5174ac(0xe5)]+'Component_Type__c']=_0x200ec9[_0x5174ac(0x104)],_0x1e6669[constants_1[_0x5174ac(0xe5)]+_0x5174ac(0x124)]=_0x200ec9[_0x5174ac(0xea)],_0x1e6669[constants_1[_0x5174ac(0xe5)]+_0x5174ac(0xed)]=_0x200ec9[_0x5174ac(0xd5)],_0x1e6669[constants_1[_0x5174ac(0xe5)]+'Last_Updated_By__c']=this[_0x5174ac(0x12e)],_0x1e6669[constants_1[_0x5174ac(0xe5)]+'Last_Modified_By__c']=this[_0x5174ac(0x12e)],_0x1e6669[constants_1[_0x5174ac(0xe5)]+_0x5174ac(0x10c)]=_0x58e139,_0x1e6669[constants_1['FLOSUM_NAMESPACE']+_0x5174ac(0x10a)]=_0x58e139,_0x1e6669[constants_1['FLOSUM_NAMESPACE']+_0x5174ac(0x10f)]=_0x200ec9[_0x5174ac(0xdf)],_0x1e6669;}[a128_0x450e57(0xd3)](){const _0x6fd94d=a128_0x450e57;return this[_0x6fd94d(0x136)];}async[a128_0x450e57(0xe0)](_0x25c905,_0x303581){const _0x3c3d09=a128_0x450e57,_0x55dd17=[];for(const _0xc13a7d of _0x25c905){const _0x2079b5=composite_utils_1[_0x3c3d09(0xf2)](constants_1[_0x3c3d09(0xfe)],this[_0x3c3d09(0x12c)](_0xc13a7d)),_0x463de0=composite_utils_1['createPostRequest'](constants_1[_0x3c3d09(0xd8)],this[_0x3c3d09(0x121)](_0xc13a7d,'@{'+_0x2079b5['reference']+_0x3c3d09(0x127))),_0x395d7f=composite_utils_1[_0x3c3d09(0xf2)](constants_1[_0x3c3d09(0x106)],await this[_0x3c3d09(0xf0)](_0xc13a7d,'@{'+_0x463de0['reference']+_0x3c3d09(0x127)));this['proceedComponentMeta'](_0x2079b5['request'][_0x3c3d09(0x11d)],_0x2079b5[_0x3c3d09(0x113)]),_0x55dd17[_0x3c3d09(0x105)](_0x2079b5[_0x3c3d09(0x11f)],_0x463de0[_0x3c3d09(0x11f)],_0x395d7f['request']),_0x303581&&_0x55dd17[_0x3c3d09(0x105)](this[_0x3c3d09(0x12d)](_0x303581,'@{'+_0x463de0[_0x3c3d09(0x113)]+_0x3c3d09(0x127)));}return _0x55dd17;}async[a128_0x450e57(0xfb)](_0x3e381e,_0x2e3710=''){const _0x3b7279=a128_0x450e57,_0x157990=[];for(const {component:_0x5205f9,meta:_0x49b31c}of _0x3e381e){if(!_0x49b31c['id']){const _0x2a42e2=this[_0x3b7279(0x136)]['find'](_0xf794fe=>_0xf794fe['componentName']===_0x5205f9[_0x3b7279(0xea)]&&_0xf794fe[_0x3b7279(0x132)]===_0x5205f9[_0x3b7279(0x104)]);if(!_0x2a42e2)throw new salesforce_error_1[(_0x3b7279(0x10d))](new Error(_0x3b7279(0xe3)+_0x5205f9['name']+'\x20['+_0x5205f9['type']+_0x3b7279(0xee)));_0x49b31c['id']=_0x2a42e2[_0x3b7279(0xf1)];}const _0x529462=composite_utils_1['createPatchRequest'](constants_1['FLOSUM_COMPONENT'],_0x49b31c['id'],this[_0x3b7279(0x12c)](_0x5205f9,_0x49b31c)),_0x1bc39d=composite_utils_1['createPostRequest'](constants_1[_0x3b7279(0xd8)],this[_0x3b7279(0x121)](_0x5205f9,_0x49b31c['id'],_0x49b31c[_0x3b7279(0xd4)])),_0x3b9b84=composite_utils_1['createPostRequest'](constants_1['FLOSUM_ATTACHMENT'],await this[_0x3b7279(0xf0)](_0x5205f9,'@{'+_0x1bc39d[_0x3b7279(0x113)]+_0x3b7279(0x127)));this[_0x3b7279(0xec)](_0x529462[_0x3b7279(0x11f)][_0x3b7279(0x11d)],_0x529462[_0x3b7279(0x113)]),_0x157990['push'](_0x529462[_0x3b7279(0x11f)],_0x1bc39d[_0x3b7279(0x11f)],_0x3b9b84[_0x3b7279(0x11f)]),_0x2e3710&&_0x157990[_0x3b7279(0x105)](this[_0x3b7279(0x12d)](_0x2e3710,'@{'+_0x1bc39d[_0x3b7279(0x113)]+'.id}'));}return _0x157990;}async[a128_0x450e57(0x10b)](_0x170d5d,_0x56d4cc=![]){const _0x46970b=a128_0x450e57,_0x34b06c={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x44a7ec=[];for(const _0x4cbcdc of _0x170d5d){if(_0x4cbcdc['id'])_0x44a7ec[_0x46970b(0x105)](_0x4cbcdc['id']);else{const _0x2cb445=this[_0x46970b(0x136)][_0x46970b(0x133)](_0x326f09=>_0x326f09['componentName']===_0x4cbcdc[_0x46970b(0xea)]&&_0x326f09[_0x46970b(0x132)]===_0x4cbcdc['type']);if(!_0x2cb445||!_0x2cb445['componentId'])continue;_0x44a7ec[_0x46970b(0x105)](_0x2cb445['componentId']);}}if(_0x56d4cc){const _0x4ccc1a=await this[_0x46970b(0x129)][_0x46970b(0xfc)](_0x44a7ec);_0x34b06c[_0x46970b(0x115)]=_0x4ccc1a[_0x46970b(0xe6)](_0x21d8a2=>composite_utils_1[_0x46970b(0x137)](constants_1[_0x46970b(0xd2)],_0x21d8a2)[_0x46970b(0x11f)]);}return _0x34b06c['componentsToUpdate']=_0x44a7ec[_0x46970b(0xe6)](_0x4985bb=>composite_utils_1['createPatchRequest'](constants_1[_0x46970b(0xfe)],_0x4985bb,{[constants_1[_0x46970b(0xe7)]+_0x46970b(0x11c)]:!![]})[_0x46970b(0x11f)]),_0x34b06c[_0x46970b(0xda)]=_0x44a7ec[_0x46970b(0xe6)](_0x540b32=>composite_utils_1['createDeleteRequest'](constants_1[_0x46970b(0xfe)],_0x540b32)[_0x46970b(0x11f)]),_0x34b06c;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;