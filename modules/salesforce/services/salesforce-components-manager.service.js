const a128_0x14ae8d=a128_0xc3fb;(function(_0x2490e8,_0x2b9a47){const _0x1fb241=a128_0xc3fb,_0x17c943=_0x2490e8();while(!![]){try{const _0x4873ae=parseInt(_0x1fb241(0x12d))/0x1*(parseInt(_0x1fb241(0x11f))/0x2)+parseInt(_0x1fb241(0x110))/0x3*(parseInt(_0x1fb241(0x101))/0x4)+-parseInt(_0x1fb241(0x136))/0x5+parseInt(_0x1fb241(0x105))/0x6*(-parseInt(_0x1fb241(0x122))/0x7)+-parseInt(_0x1fb241(0x133))/0x8*(-parseInt(_0x1fb241(0x107))/0x9)+parseInt(_0x1fb241(0x129))/0xa*(-parseInt(_0x1fb241(0x12a))/0xb)+-parseInt(_0x1fb241(0xff))/0xc*(-parseInt(_0x1fb241(0x10b))/0xd);if(_0x4873ae===_0x2b9a47)break;else _0x17c943['push'](_0x17c943['shift']());}catch(_0x41d94d){_0x17c943['push'](_0x17c943['shift']());}}}(a128_0x2a8e,0x7cde6));const a128_0x329c3a=(function(){let _0x4be62f=!![];return function(_0x4eddcf,_0x1f2663){const _0x2b1ca6=_0x4be62f?function(){const _0x21d5ad=a128_0xc3fb;if(_0x1f2663){const _0x139727=_0x1f2663[_0x21d5ad(0x10a)](_0x4eddcf,arguments);return _0x1f2663=null,_0x139727;}}:function(){};return _0x4be62f=![],_0x2b1ca6;};}()),a128_0x12c9e8=a128_0x329c3a(this,function(){const _0x283499=a128_0xc3fb;return a128_0x12c9e8[_0x283499(0xf3)]()[_0x283499(0x131)](_0x283499(0xe7))[_0x283499(0xf3)]()[_0x283499(0xf2)](a128_0x12c9e8)[_0x283499(0x131)]('(((.+)+)+)+$');});a128_0x12c9e8();'use strict';function a128_0xc3fb(_0x359132,_0x5ec426){const _0x561d98=a128_0x2a8e();return a128_0xc3fb=function(_0x12c9e8,_0x329c3a){_0x12c9e8=_0x12c9e8-0xe5;let _0x2a8e3e=_0x561d98[_0x12c9e8];return _0x2a8e3e;},a128_0xc3fb(_0x359132,_0x5ec426);}var __importDefault=this&&this[a128_0x14ae8d(0x12e)]||function(_0x271fe3){const _0x265798=a128_0x14ae8d;return _0x271fe3&&_0x271fe3[_0x265798(0x108)]?_0x271fe3:{'default':_0x271fe3};};function a128_0x2a8e(){const _0x12ca4b=['request','proceedComponentMeta','.id}','Repository','push','recordTypes','update','files','prepareComponentRecord','ParentId','../../parsers/utils/zip','crc','SalesforceComponentsManager','Changed_On__c','694682xLMZwJ','componentName','reference','7bGsmTH','RecordTypeId','componentsToUpdate','map','prepareComponentHistoryRecord','CRC32__c','username','317290pkILky','297INBvNo','componentId','FLOSUM_ATTACHMENT','1QRycnY','__importDefault','manifests','FLOSUM_GIT_NAMESPACE','search','Last_Updated_By__c','1190872AcwHRm','insert','version','4203805XKQoEJ','branchId','Committed_On__c','Description','Version__c','../utils/composite.utils','Zip','body','FLOSUM_COMPONENT_HISTORY','Repository__c','Name','createZip','toISOString','Body','componentsToDelete','Component_Name__c','typedi','get','createPatchRequest','prepareComponentAttachmentRecord','File_Name__c','Branch__c','componentType','Branch','find','Could\x20not\x20proceed\x20component\x20','Deletion_By_Agent__c','generateAsync','repositoryId','(((.+)+)+)+$','../../../constants','createDeleteRequest','Changed_By__c','base64','createPostRequest','FLOSUM_NAMESPACE','Is_From_Agent__c','logger','application/zip','Last_Modified_Date__c','constructor','toString','SalesforceGitSyncService','../errors/salesforce.error','FLOSUM_COMMIT_MANIFEST','Source__c','name','fetchCommitManifestsByComponentIds','default',']\x20-\x20meta\x20not\x20found','Component_History__c','../utils/flosum-naming.utils','getProceededComponentsMeta','22137708aOQCZX','Commit__c','522028IXdokv','Logger','filePath','prepareCommitManifest','1575660dknNWO','gitSync','9gMnzjE','__esModule','type','apply','13SIumZv','ContentType','extractFieldsFromRecord','proceededComponentsMeta','FLOSUM_COMPONENT','3lqhpxJ'];a128_0x2a8e=function(){return _0x12ca4b;};return a128_0x2a8e();}Object['defineProperty'](exports,a128_0x14ae8d(0x108),{'value':!![]}),exports[a128_0x14ae8d(0x11d)]=void 0x0;const constants_1=require(a128_0x14ae8d(0xe8)),core_1=require('../../../core'),zip_1=require(a128_0x14ae8d(0x11b)),typedi_1=__importDefault(require(a128_0x14ae8d(0x146))),salesforce_error_1=require(a128_0x14ae8d(0xf5)),composite_utils_1=require(a128_0x14ae8d(0x13b)),flosum_naming_utils_1=require(a128_0x14ae8d(0xfd)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x3a0ba0,_0x3ef58c,_0x539c84,_0x237ee4,_0x3b17fc){const _0x56da95=a128_0x14ae8d;this[_0x56da95(0xe6)]=_0x3a0ba0,this['branchId']=_0x3ef58c,this[_0x56da95(0x128)]=_0x539c84,this['recordTypes']=_0x237ee4,this['proceededComponentsMeta']=_0x3b17fc,this[_0x56da95(0xef)]=new core_1[(_0x56da95(0x102))](SalesforceComponentsManager[_0x56da95(0xf8)]),this[_0x56da95(0x106)]=typedi_1[_0x56da95(0xfa)][_0x56da95(0x147)](salesforce_git_sync_service_1[_0x56da95(0xf4)]);}[a128_0x14ae8d(0x112)](_0x511466,_0xe58c83){const _0x46dadf=a128_0x14ae8d,_0x49bd32=flosum_naming_utils_1[_0x46dadf(0x10d)](_0x511466,['Component_Type__c',_0x46dadf(0x145),_0x46dadf(0x13a)]);this['proceededComponentsMeta'][_0x46dadf(0x115)]({'componentId':'','reference':_0xe58c83,'version':_0x49bd32[_0x46dadf(0x13a)],'componentName':_0x49bd32['Component_Name__c'],'componentType':_0x49bd32['Component_Type__c']});}[a128_0x14ae8d(0x104)](_0x862bc0,_0x30df72){const _0x18b533=a128_0x14ae8d,{request:_0x25e33c}=composite_utils_1['createPostRequest'](constants_1[_0x18b533(0xf6)],{[constants_1[_0x18b533(0xed)]+_0x18b533(0x100)]:_0x862bc0,[constants_1[_0x18b533(0xed)]+_0x18b533(0xfc)]:_0x30df72});return _0x25e33c;}async[a128_0x14ae8d(0x149)](_0x1295c3,_0x38281c){const _0x357195=a128_0x14ae8d,_0x10a9c5={},_0x5fc528=zip_1[_0x357195(0x13c)][_0x357195(0x141)]();for(const _0x562b52 of Object['keys'](_0x1295c3[_0x357195(0x118)])){_0x5fc528['file'](_0x562b52,_0x1295c3[_0x357195(0x118)][_0x562b52],{'createFolders':!![]});}return _0x10a9c5[_0x357195(0x10c)]=_0x357195(0xf0),_0x10a9c5[_0x357195(0x140)]=_0x1295c3['type'],_0x10a9c5[_0x357195(0x139)]=_0x1295c3['type'],_0x10a9c5[_0x357195(0x11a)]=_0x38281c,_0x10a9c5[_0x357195(0x143)]=await _0x5fc528[_0x357195(0xe5)]({'type':_0x357195(0xeb),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x10a9c5;}[a128_0x14ae8d(0x126)](_0x28e389,_0x13d379,_0x59b059){const _0x3f8a9f=a128_0x14ae8d,_0x3f05b6=new Date()[_0x3f8a9f(0x142)](),_0x9e6845={};return _0x9e6845[constants_1[_0x3f8a9f(0xed)]+'Component__c']=_0x13d379,_0x9e6845[constants_1[_0x3f8a9f(0xed)]+_0x3f8a9f(0x127)]=_0x28e389[_0x3f8a9f(0x11c)],_0x9e6845[constants_1['FLOSUM_NAMESPACE']+_0x3f8a9f(0x11e)]=_0x3f05b6,_0x9e6845[constants_1[_0x3f8a9f(0xed)]+_0x3f8a9f(0xea)]=this[_0x3f8a9f(0x128)],_0x9e6845[constants_1[_0x3f8a9f(0xed)]+_0x3f8a9f(0x13a)]=_0x59b059?_0x59b059+0x1:0x1,_0x9e6845[constants_1[_0x3f8a9f(0x130)]+_0x3f8a9f(0xee)]=!![],_0x9e6845;}[a128_0x14ae8d(0x119)](_0x41ca08,_0x474c52){const _0x50d480=a128_0x14ae8d;var _0x372f28,_0x4242ad;const _0x10fe62=new Date()['toISOString'](),_0x17a0aa={};return!_0x474c52?(this[_0x50d480(0x137)]?(_0x17a0aa[constants_1[_0x50d480(0xed)]+_0x50d480(0x14b)]=this['branchId'],_0x17a0aa[constants_1['FLOSUM_NAMESPACE']+_0x50d480(0xf7)]=_0x50d480(0x14d),_0x17a0aa['RecordTypeId']=(_0x372f28=this['recordTypes'][_0x50d480(0x14e)](_0x47a7b1=>_0x47a7b1[_0x50d480(0xf8)]===_0x50d480(0x14d)))===null||_0x372f28===void 0x0?void 0x0:_0x372f28['id']):(_0x17a0aa[constants_1['FLOSUM_NAMESPACE']+_0x50d480(0x13f)]=this[_0x50d480(0xe6)],_0x17a0aa[constants_1['FLOSUM_NAMESPACE']+_0x50d480(0xf7)]=_0x50d480(0x114),_0x17a0aa[_0x50d480(0x123)]=(_0x4242ad=this[_0x50d480(0x116)][_0x50d480(0x14e)](_0x4a0242=>_0x4a0242[_0x50d480(0xf8)]===_0x50d480(0x114)))===null||_0x4242ad===void 0x0?void 0x0:_0x4242ad['id']),_0x17a0aa[constants_1['FLOSUM_NAMESPACE']+_0x50d480(0x13a)]=0x1):_0x17a0aa[constants_1[_0x50d480(0xed)]+_0x50d480(0x13a)]=_0x474c52['version']+0x1,_0x17a0aa[constants_1[_0x50d480(0xed)]+'Component_Type__c']=_0x41ca08['type'],_0x17a0aa[constants_1[_0x50d480(0xed)]+'Component_Name__c']=_0x41ca08['name'],_0x17a0aa[constants_1[_0x50d480(0xed)]+_0x50d480(0x14a)]=_0x41ca08[_0x50d480(0x103)],_0x17a0aa[constants_1[_0x50d480(0xed)]+_0x50d480(0x132)]=this['username'],_0x17a0aa[constants_1['FLOSUM_NAMESPACE']+'Last_Modified_By__c']=this['username'],_0x17a0aa[constants_1[_0x50d480(0xed)]+_0x50d480(0xf1)]=_0x10fe62,_0x17a0aa[constants_1[_0x50d480(0xed)]+_0x50d480(0x138)]=_0x10fe62,_0x17a0aa[constants_1[_0x50d480(0xed)]+_0x50d480(0x127)]=_0x41ca08[_0x50d480(0x11c)],_0x17a0aa;}[a128_0x14ae8d(0xfe)](){const _0x46da93=a128_0x14ae8d;return this[_0x46da93(0x10e)];}async[a128_0x14ae8d(0x134)](_0x3321ba,_0x48860a){const _0xf1f664=a128_0x14ae8d,_0x452e3e=[];for(const _0x4d018e of _0x3321ba){const _0x3543df=composite_utils_1[_0xf1f664(0xec)](constants_1['FLOSUM_COMPONENT'],this[_0xf1f664(0x119)](_0x4d018e)),_0x29406b=composite_utils_1[_0xf1f664(0xec)](constants_1[_0xf1f664(0x13e)],this['prepareComponentHistoryRecord'](_0x4d018e,'@{'+_0x3543df[_0xf1f664(0x121)]+_0xf1f664(0x113))),_0x103734=composite_utils_1[_0xf1f664(0xec)](constants_1['FLOSUM_ATTACHMENT'],await this['prepareComponentAttachmentRecord'](_0x4d018e,'@{'+_0x29406b['reference']+'.id}'));this['proceedComponentMeta'](_0x3543df[_0xf1f664(0x111)]['body'],_0x3543df['reference']),_0x452e3e[_0xf1f664(0x115)](_0x3543df[_0xf1f664(0x111)],_0x29406b[_0xf1f664(0x111)],_0x103734[_0xf1f664(0x111)]),_0x48860a&&_0x452e3e[_0xf1f664(0x115)](this[_0xf1f664(0x104)](_0x48860a,'@{'+_0x29406b[_0xf1f664(0x121)]+_0xf1f664(0x113)));}return _0x452e3e;}async[a128_0x14ae8d(0x117)](_0x143e67,_0x38d2ef=''){const _0x7f0e1=a128_0x14ae8d,_0x55522a=[];for(const {component:_0x56c950,meta:_0x2a4c08}of _0x143e67){if(!_0x2a4c08['id']){const _0x4a8611=this[_0x7f0e1(0x10e)][_0x7f0e1(0x14e)](_0x3d2569=>_0x3d2569[_0x7f0e1(0x120)]===_0x56c950['name']&&_0x3d2569[_0x7f0e1(0x14c)]===_0x56c950[_0x7f0e1(0x109)]);if(!_0x4a8611)throw new salesforce_error_1['SalesforceError'](new Error(_0x7f0e1(0x14f)+_0x56c950[_0x7f0e1(0xf8)]+'\x20['+_0x56c950['type']+_0x7f0e1(0xfb)));_0x2a4c08['id']=_0x4a8611['componentId'];}const _0x507858=composite_utils_1['createPatchRequest'](constants_1[_0x7f0e1(0x10f)],_0x2a4c08['id'],this[_0x7f0e1(0x119)](_0x56c950,_0x2a4c08)),_0x3648cd=composite_utils_1[_0x7f0e1(0xec)](constants_1[_0x7f0e1(0x13e)],this[_0x7f0e1(0x126)](_0x56c950,_0x2a4c08['id'],_0x2a4c08[_0x7f0e1(0x135)])),_0x4d8283=composite_utils_1[_0x7f0e1(0xec)](constants_1[_0x7f0e1(0x12c)],await this[_0x7f0e1(0x149)](_0x56c950,'@{'+_0x3648cd['reference']+'.id}'));this[_0x7f0e1(0x112)](_0x507858['request'][_0x7f0e1(0x13d)],_0x507858['reference']),_0x55522a[_0x7f0e1(0x115)](_0x507858[_0x7f0e1(0x111)],_0x3648cd['request'],_0x4d8283[_0x7f0e1(0x111)]),_0x38d2ef&&_0x55522a[_0x7f0e1(0x115)](this[_0x7f0e1(0x104)](_0x38d2ef,'@{'+_0x3648cd['reference']+_0x7f0e1(0x113)));}return _0x55522a;}async['delete'](_0x23cdb7,_0x530789=![]){const _0x479d6e=a128_0x14ae8d,_0x8e7550={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x595057=[];for(const _0x51498a of _0x23cdb7){if(_0x51498a['id'])_0x595057[_0x479d6e(0x115)](_0x51498a['id']);else{const _0x5db41c=this[_0x479d6e(0x10e)][_0x479d6e(0x14e)](_0x32a816=>_0x32a816[_0x479d6e(0x120)]===_0x51498a[_0x479d6e(0xf8)]&&_0x32a816[_0x479d6e(0x14c)]===_0x51498a[_0x479d6e(0x109)]);if(!_0x5db41c||!_0x5db41c[_0x479d6e(0x12b)])continue;_0x595057['push'](_0x5db41c[_0x479d6e(0x12b)]);}}if(_0x530789){const _0x291d1d=await this[_0x479d6e(0x106)][_0x479d6e(0xf9)](_0x595057);_0x8e7550[_0x479d6e(0x12f)]=_0x291d1d[_0x479d6e(0x125)](_0x3f0f7e=>composite_utils_1[_0x479d6e(0xe9)](constants_1[_0x479d6e(0xf6)],_0x3f0f7e)[_0x479d6e(0x111)]);}return _0x8e7550[_0x479d6e(0x124)]=_0x595057[_0x479d6e(0x125)](_0x34da05=>composite_utils_1[_0x479d6e(0x148)](constants_1[_0x479d6e(0x10f)],_0x34da05,{[constants_1[_0x479d6e(0x130)]+_0x479d6e(0x150)]:!![]})[_0x479d6e(0x111)]),_0x8e7550[_0x479d6e(0x144)]=_0x595057[_0x479d6e(0x125)](_0x2b61c2=>composite_utils_1['createDeleteRequest'](constants_1[_0x479d6e(0x10f)],_0x2b61c2)[_0x479d6e(0x111)]),_0x8e7550;}}exports[a128_0x14ae8d(0x11d)]=SalesforceComponentsManager;