const a127_0xce8020=a127_0x38f5;(function(_0x397f8b,_0x3a46c1){const _0x4b1ac0=a127_0x38f5,_0x23680e=_0x397f8b();while(!![]){try{const _0x28dd84=-parseInt(_0x4b1ac0(0x101))/0x1+parseInt(_0x4b1ac0(0x118))/0x2+-parseInt(_0x4b1ac0(0x122))/0x3+parseInt(_0x4b1ac0(0x131))/0x4+parseInt(_0x4b1ac0(0x106))/0x5*(-parseInt(_0x4b1ac0(0x148))/0x6)+parseInt(_0x4b1ac0(0x14f))/0x7*(parseInt(_0x4b1ac0(0xf1))/0x8)+-parseInt(_0x4b1ac0(0xf6))/0x9*(-parseInt(_0x4b1ac0(0x10f))/0xa);if(_0x28dd84===_0x3a46c1)break;else _0x23680e['push'](_0x23680e['shift']());}catch(_0x10205c){_0x23680e['push'](_0x23680e['shift']());}}}(a127_0x2b9d,0x34367));function a127_0x38f5(_0x4eaa98,_0x4973bc){const _0x5eeaf0=a127_0x2b9d();return a127_0x38f5=function(_0x5791a1,_0x2c952e){_0x5791a1=_0x5791a1-0xf0;let _0x2b9d5b=_0x5eeaf0[_0x5791a1];return _0x2b9d5b;},a127_0x38f5(_0x4eaa98,_0x4973bc);}const a127_0x2c952e=(function(){let _0x48359b=!![];return function(_0x55e4fc,_0x2a999e){const _0x1fce96=_0x48359b?function(){const _0x5f113c=a127_0x38f5;if(_0x2a999e){const _0x517d42=_0x2a999e[_0x5f113c(0x125)](_0x55e4fc,arguments);return _0x2a999e=null,_0x517d42;}}:function(){};return _0x48359b=![],_0x1fce96;};}()),a127_0x5791a1=a127_0x2c952e(this,function(){const _0x451ca7=a127_0x38f5;return a127_0x5791a1[_0x451ca7(0x10d)]()[_0x451ca7(0x123)]('(((.+)+)+)+$')['toString']()[_0x451ca7(0x12c)](a127_0x5791a1)[_0x451ca7(0x123)](_0x451ca7(0x12d));});a127_0x5791a1();'use strict';function a127_0x2b9d(){const _0x462b2f=['crc','name','username','4805028VJeQEu','../errors/salesforce.error','file','Body','prepareCommitManifest','Commit__c','logger','update','prepareComponentAttachmentRecord','SalesforceComponentsManager','extractFieldsFromRecord','150042AaPksz','Version__c','componentsToUpdate','recordTypes','Component_Name__c','782105tktKcy','createPatchRequest','push','componentId','find','gitSync','componentName','toString','keys','10BdHFWZ','base64','../../../core','FLOSUM_COMMIT_MANIFEST','componentType','CRC32__c','prepareComponentHistoryRecord','FLOSUM_COMPONENT','Changed_On__c','710864vjKQOh','FLOSUM_NAMESPACE','fetchCommitManifestsByComponentIds','FLOSUM_COMPONENT_HISTORY','reference','../utils/flosum-naming.utils','proceededComponentsMeta','FLOSUM_ATTACHMENT','createZip','branchId','1147662ojimgY','search','RecordTypeId','apply','DEFLATE','files','map','FLOSUM_GIT_NAMESPACE','Repository','Name','constructor','(((.+)+)+)+$','.id}','Committed_On__c','body','482016fyWyxo','application/zip','version','request','generateAsync','File_Name__c','../utils/composite.utils','SalesforceError','ParentId','Description','toISOString','Deletion_By_Agent__c','Last_Updated_By__c','prepareComponentRecord','__importDefault','Branch','delete','Component_Type__c','SalesforceGitSyncService','componentsToDelete','insert','createDeleteRequest','repositoryId','12siMuTZ','getProceededComponentsMeta','Is_From_Agent__c','type','Source__c','Component_History__c','createPostRequest','38479VyOStL','../../../constants','Could\x20not\x20proceed\x20component\x20','72ysvzGj','Last_Modified_Date__c'];a127_0x2b9d=function(){return _0x462b2f;};return a127_0x2b9d();}var __importDefault=this&&this[a127_0xce8020(0x13f)]||function(_0x1cb0be){return _0x1cb0be&&_0x1cb0be['__esModule']?_0x1cb0be:{'default':_0x1cb0be};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a127_0xce8020(0xff)]=void 0x0;const constants_1=require(a127_0xce8020(0x150)),core_1=require(a127_0xce8020(0x111)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require('typedi')),salesforce_error_1=require(a127_0xce8020(0xf7)),composite_utils_1=require(a127_0xce8020(0x137)),flosum_naming_utils_1=require(a127_0xce8020(0x11d)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x363bc6,_0x2b4885,_0x1c629c,_0x454c0f,_0x290981){const _0x945714=a127_0xce8020;this[_0x945714(0x147)]=_0x363bc6,this[_0x945714(0x121)]=_0x2b4885,this[_0x945714(0xf5)]=_0x1c629c,this[_0x945714(0x104)]=_0x454c0f,this[_0x945714(0x11e)]=_0x290981,this[_0x945714(0xfc)]=new core_1['Logger'](SalesforceComponentsManager[_0x945714(0xf4)]),this['gitSync']=typedi_1['default']['get'](salesforce_git_sync_service_1[_0x945714(0x143)]);}['proceedComponentMeta'](_0x5b09e3,_0x1c9527){const _0x14c011=a127_0xce8020,_0x364003=flosum_naming_utils_1[_0x14c011(0x100)](_0x5b09e3,[_0x14c011(0x142),_0x14c011(0x105),_0x14c011(0x102)]);this[_0x14c011(0x11e)][_0x14c011(0x108)]({'componentId':'','reference':_0x1c9527,'version':_0x364003[_0x14c011(0x102)],'componentName':_0x364003['Component_Name__c'],'componentType':_0x364003[_0x14c011(0x142)]});}[a127_0xce8020(0xfa)](_0x82967,_0x16e181){const _0x41e4e9=a127_0xce8020,{request:_0x1ac21f}=composite_utils_1[_0x41e4e9(0x14e)](constants_1[_0x41e4e9(0x112)],{[constants_1[_0x41e4e9(0x119)]+_0x41e4e9(0xfb)]:_0x82967,[constants_1['FLOSUM_NAMESPACE']+_0x41e4e9(0x14d)]:_0x16e181});return _0x1ac21f;}async['prepareComponentAttachmentRecord'](_0x53d7dc,_0x548631){const _0x2f6003=a127_0xce8020,_0x6942b9={},_0x540b81=zip_1['Zip'][_0x2f6003(0x120)]();for(const _0x596f27 of Object[_0x2f6003(0x10e)](_0x53d7dc[_0x2f6003(0x127)])){_0x540b81[_0x2f6003(0xf8)](_0x596f27,_0x53d7dc[_0x2f6003(0x127)][_0x596f27],{'createFolders':!![]});}return _0x6942b9['ContentType']=_0x2f6003(0x132),_0x6942b9[_0x2f6003(0x12b)]=_0x53d7dc[_0x2f6003(0x14b)],_0x6942b9[_0x2f6003(0x13a)]=_0x53d7dc[_0x2f6003(0x14b)],_0x6942b9[_0x2f6003(0x139)]=_0x548631,_0x6942b9[_0x2f6003(0xf9)]=await _0x540b81[_0x2f6003(0x135)]({'type':_0x2f6003(0x110),'compression':_0x2f6003(0x126),'compressionOptions':{'level':0x6}}),_0x6942b9;}[a127_0xce8020(0x115)](_0x5ec77c,_0x592813,_0x5ef43b){const _0x27a97d=a127_0xce8020,_0x54c37e=new Date()['toISOString'](),_0x368c52={};return _0x368c52[constants_1[_0x27a97d(0x119)]+'Component__c']=_0x592813,_0x368c52[constants_1['FLOSUM_NAMESPACE']+_0x27a97d(0x114)]=_0x5ec77c[_0x27a97d(0xf3)],_0x368c52[constants_1[_0x27a97d(0x119)]+_0x27a97d(0x117)]=_0x54c37e,_0x368c52[constants_1['FLOSUM_NAMESPACE']+'Changed_By__c']=this[_0x27a97d(0xf5)],_0x368c52[constants_1['FLOSUM_NAMESPACE']+_0x27a97d(0x102)]=_0x5ef43b?_0x5ef43b+0x1:0x1,_0x368c52[constants_1[_0x27a97d(0x129)]+_0x27a97d(0x14a)]=!![],_0x368c52;}[a127_0xce8020(0x13e)](_0x558f21,_0x6d7cb9){const _0x2d4fa8=a127_0xce8020;var _0x51e2b8,_0x2e567c;const _0x4729bc=new Date()[_0x2d4fa8(0x13b)](),_0x183bfd={};return!_0x6d7cb9?(this[_0x2d4fa8(0x121)]?(_0x183bfd[constants_1[_0x2d4fa8(0x119)]+'Branch__c']=this[_0x2d4fa8(0x121)],_0x183bfd[constants_1['FLOSUM_NAMESPACE']+_0x2d4fa8(0x14c)]=_0x2d4fa8(0x140),_0x183bfd[_0x2d4fa8(0x124)]=(_0x51e2b8=this[_0x2d4fa8(0x104)][_0x2d4fa8(0x10a)](_0x36d1ba=>_0x36d1ba[_0x2d4fa8(0xf4)]===_0x2d4fa8(0x140)))===null||_0x51e2b8===void 0x0?void 0x0:_0x51e2b8['id']):(_0x183bfd[constants_1[_0x2d4fa8(0x119)]+'Repository__c']=this[_0x2d4fa8(0x147)],_0x183bfd[constants_1[_0x2d4fa8(0x119)]+_0x2d4fa8(0x14c)]=_0x2d4fa8(0x12a),_0x183bfd['RecordTypeId']=(_0x2e567c=this[_0x2d4fa8(0x104)]['find'](_0x3d0957=>_0x3d0957[_0x2d4fa8(0xf4)]===_0x2d4fa8(0x12a)))===null||_0x2e567c===void 0x0?void 0x0:_0x2e567c['id']),_0x183bfd[constants_1[_0x2d4fa8(0x119)]+'Version__c']=0x1):_0x183bfd[constants_1[_0x2d4fa8(0x119)]+_0x2d4fa8(0x102)]=_0x6d7cb9[_0x2d4fa8(0x133)]+0x1,_0x183bfd[constants_1['FLOSUM_NAMESPACE']+_0x2d4fa8(0x142)]=_0x558f21['type'],_0x183bfd[constants_1[_0x2d4fa8(0x119)]+_0x2d4fa8(0x105)]=_0x558f21[_0x2d4fa8(0xf4)],_0x183bfd[constants_1[_0x2d4fa8(0x119)]+_0x2d4fa8(0x136)]=_0x558f21['filePath'],_0x183bfd[constants_1[_0x2d4fa8(0x119)]+_0x2d4fa8(0x13d)]=this['username'],_0x183bfd[constants_1[_0x2d4fa8(0x119)]+'Last_Modified_By__c']=this[_0x2d4fa8(0xf5)],_0x183bfd[constants_1['FLOSUM_NAMESPACE']+_0x2d4fa8(0xf2)]=_0x4729bc,_0x183bfd[constants_1['FLOSUM_NAMESPACE']+_0x2d4fa8(0x12f)]=_0x4729bc,_0x183bfd[constants_1[_0x2d4fa8(0x119)]+_0x2d4fa8(0x114)]=_0x558f21[_0x2d4fa8(0xf3)],_0x183bfd;}[a127_0xce8020(0x149)](){const _0x4c7f20=a127_0xce8020;return this[_0x4c7f20(0x11e)];}async[a127_0xce8020(0x145)](_0x3fc2f6,_0x38b0ae){const _0x20be88=a127_0xce8020,_0x31011b=[];for(const _0x43be77 of _0x3fc2f6){const _0xbf8120=composite_utils_1[_0x20be88(0x14e)](constants_1['FLOSUM_COMPONENT'],this[_0x20be88(0x13e)](_0x43be77)),_0x575d91=composite_utils_1[_0x20be88(0x14e)](constants_1[_0x20be88(0x11b)],this[_0x20be88(0x115)](_0x43be77,'@{'+_0xbf8120[_0x20be88(0x11c)]+_0x20be88(0x12e))),_0x447c1=composite_utils_1['createPostRequest'](constants_1[_0x20be88(0x11f)],await this[_0x20be88(0xfe)](_0x43be77,'@{'+_0x575d91[_0x20be88(0x11c)]+_0x20be88(0x12e)));this['proceedComponentMeta'](_0xbf8120[_0x20be88(0x134)]['body'],_0xbf8120[_0x20be88(0x11c)]),_0x31011b[_0x20be88(0x108)](_0xbf8120[_0x20be88(0x134)],_0x575d91['request'],_0x447c1[_0x20be88(0x134)]),_0x38b0ae&&_0x31011b[_0x20be88(0x108)](this[_0x20be88(0xfa)](_0x38b0ae,'@{'+_0x575d91['reference']+'.id}'));}return _0x31011b;}async[a127_0xce8020(0xfd)](_0x232b74,_0x3aec2e=''){const _0x468cd6=a127_0xce8020,_0x3194b9=[];for(const {component:_0xfdc72e,meta:_0x45416d}of _0x232b74){if(!_0x45416d['id']){const _0x3c2fdd=this['proceededComponentsMeta'][_0x468cd6(0x10a)](_0x41b485=>_0x41b485[_0x468cd6(0x10c)]===_0xfdc72e['name']&&_0x41b485[_0x468cd6(0x113)]===_0xfdc72e['type']);if(!_0x3c2fdd)throw new salesforce_error_1[(_0x468cd6(0x138))](new Error(_0x468cd6(0xf0)+_0xfdc72e['name']+'\x20['+_0xfdc72e[_0x468cd6(0x14b)]+']\x20-\x20meta\x20not\x20found'));_0x45416d['id']=_0x3c2fdd[_0x468cd6(0x109)];}const _0x520598=composite_utils_1[_0x468cd6(0x107)](constants_1['FLOSUM_COMPONENT'],_0x45416d['id'],this[_0x468cd6(0x13e)](_0xfdc72e,_0x45416d)),_0x132d7f=composite_utils_1[_0x468cd6(0x14e)](constants_1[_0x468cd6(0x11b)],this[_0x468cd6(0x115)](_0xfdc72e,_0x45416d['id'],_0x45416d['version'])),_0x2c8b11=composite_utils_1['createPostRequest'](constants_1[_0x468cd6(0x11f)],await this[_0x468cd6(0xfe)](_0xfdc72e,'@{'+_0x132d7f['reference']+_0x468cd6(0x12e)));this['proceedComponentMeta'](_0x520598[_0x468cd6(0x134)][_0x468cd6(0x130)],_0x520598['reference']),_0x3194b9[_0x468cd6(0x108)](_0x520598['request'],_0x132d7f[_0x468cd6(0x134)],_0x2c8b11[_0x468cd6(0x134)]),_0x3aec2e&&_0x3194b9[_0x468cd6(0x108)](this[_0x468cd6(0xfa)](_0x3aec2e,'@{'+_0x132d7f[_0x468cd6(0x11c)]+_0x468cd6(0x12e)));}return _0x3194b9;}async[a127_0xce8020(0x141)](_0x4b34f1,_0x487a0f=![]){const _0x4bcf27=a127_0xce8020,_0x46d9d4={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x539018=[];for(const _0x14362d of _0x4b34f1){if(_0x14362d['id'])_0x539018[_0x4bcf27(0x108)](_0x14362d['id']);else{const _0xfd812e=this[_0x4bcf27(0x11e)]['find'](_0x32c65a=>_0x32c65a[_0x4bcf27(0x10c)]===_0x14362d[_0x4bcf27(0xf4)]&&_0x32c65a[_0x4bcf27(0x113)]===_0x14362d['type']);if(!_0xfd812e||!_0xfd812e['componentId'])continue;_0x539018[_0x4bcf27(0x108)](_0xfd812e[_0x4bcf27(0x109)]);}}if(_0x487a0f){const _0x4cacc0=await this[_0x4bcf27(0x10b)][_0x4bcf27(0x11a)](_0x539018);_0x46d9d4['manifests']=_0x4cacc0[_0x4bcf27(0x128)](_0x235909=>composite_utils_1[_0x4bcf27(0x146)](constants_1['FLOSUM_COMMIT_MANIFEST'],_0x235909)[_0x4bcf27(0x134)]);}return _0x46d9d4[_0x4bcf27(0x103)]=_0x539018[_0x4bcf27(0x128)](_0x207ed3=>composite_utils_1[_0x4bcf27(0x107)](constants_1[_0x4bcf27(0x116)],_0x207ed3,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x4bcf27(0x13c)]:!![]})[_0x4bcf27(0x134)]),_0x46d9d4[_0x4bcf27(0x144)]=_0x539018[_0x4bcf27(0x128)](_0x596299=>composite_utils_1[_0x4bcf27(0x146)](constants_1[_0x4bcf27(0x116)],_0x596299)[_0x4bcf27(0x134)]),_0x46d9d4;}}exports[a127_0xce8020(0xff)]=SalesforceComponentsManager;