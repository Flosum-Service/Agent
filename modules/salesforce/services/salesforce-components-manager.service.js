const a128_0x3d80d3=a128_0x199b;(function(_0x18822e,_0x57e106){const _0x264092=a128_0x199b,_0x10f3d7=_0x18822e();while(!![]){try{const _0x108fa2=-parseInt(_0x264092(0x11e))/0x1*(-parseInt(_0x264092(0x15f))/0x2)+-parseInt(_0x264092(0x142))/0x3+-parseInt(_0x264092(0x13e))/0x4*(-parseInt(_0x264092(0x127))/0x5)+-parseInt(_0x264092(0x136))/0x6*(-parseInt(_0x264092(0x147))/0x7)+-parseInt(_0x264092(0x12c))/0x8+-parseInt(_0x264092(0x14e))/0x9*(-parseInt(_0x264092(0x143))/0xa)+-parseInt(_0x264092(0x116))/0xb*(parseInt(_0x264092(0x16d))/0xc);if(_0x108fa2===_0x57e106)break;else _0x10f3d7['push'](_0x10f3d7['shift']());}catch(_0x24d737){_0x10f3d7['push'](_0x10f3d7['shift']());}}}(a128_0x2f0e,0x720a6));const a128_0x594e33=(function(){let _0x274c87=!![];return function(_0x112389,_0x1eb913){const _0x101778=_0x274c87?function(){const _0x3b9f31=a128_0x199b;if(_0x1eb913){const _0x31ae9f=_0x1eb913[_0x3b9f31(0x115)](_0x112389,arguments);return _0x1eb913=null,_0x31ae9f;}}:function(){};return _0x274c87=![],_0x101778;};}()),a128_0x431483=a128_0x594e33(this,function(){const _0x4f8335=a128_0x199b;return a128_0x431483[_0x4f8335(0x118)]()[_0x4f8335(0x123)]('(((.+)+)+)+$')[_0x4f8335(0x118)]()['constructor'](a128_0x431483)[_0x4f8335(0x123)](_0x4f8335(0x113));});a128_0x431483();'use strict';function a128_0x199b(_0xcf268,_0x521249){const _0x55fe92=a128_0x2f0e();return a128_0x199b=function(_0x431483,_0x594e33){_0x431483=_0x431483-0x111;let _0x2f0e5b=_0x55fe92[_0x431483];return _0x2f0e5b;},a128_0x199b(_0xcf268,_0x521249);}var __importDefault=this&&this[a128_0x3d80d3(0x122)]||function(_0x3041e5){return _0x3041e5&&_0x3041e5['__esModule']?_0x3041e5:{'default':_0x3041e5};};Object['defineProperty'](exports,a128_0x3d80d3(0x11a),{'value':!![]}),exports[a128_0x3d80d3(0x150)]=void 0x0;const constants_1=require('../../../constants'),core_1=require(a128_0x3d80d3(0x160)),zip_1=require(a128_0x3d80d3(0x158)),typedi_1=__importDefault(require(a128_0x3d80d3(0x126))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a128_0x3d80d3(0x135)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x4fe606,_0x574f84,_0x3e79b4,_0x318f04,_0x27acd8){const _0x206c2e=a128_0x3d80d3;this[_0x206c2e(0x16b)]=_0x4fe606,this[_0x206c2e(0x163)]=_0x574f84,this[_0x206c2e(0x15b)]=_0x3e79b4,this[_0x206c2e(0x149)]=_0x318f04,this[_0x206c2e(0x13b)]=_0x27acd8,this[_0x206c2e(0x16a)]=new core_1[(_0x206c2e(0x12a))](SalesforceComponentsManager['name']),this['gitSync']=typedi_1[_0x206c2e(0x168)]['get'](salesforce_git_sync_service_1[_0x206c2e(0x117)]);}[a128_0x3d80d3(0x15a)](_0x48df22,_0x29914d){const _0x153f8b=a128_0x3d80d3,_0x39f4eb=flosum_naming_utils_1['extractFieldsFromRecord'](_0x48df22,[_0x153f8b(0x131),_0x153f8b(0x132),'Version__c']);this[_0x153f8b(0x13b)][_0x153f8b(0x134)]({'componentId':'','reference':_0x29914d,'version':_0x39f4eb[_0x153f8b(0x13c)],'componentName':_0x39f4eb[_0x153f8b(0x132)],'componentType':_0x39f4eb['Component_Type__c']});}[a128_0x3d80d3(0x15d)](_0x1c7e21,_0x1911aa){const _0x5524f8=a128_0x3d80d3,{request:_0xc5f260}=composite_utils_1['createPostRequest'](constants_1[_0x5524f8(0x11c)],{[constants_1[_0x5524f8(0x124)]+_0x5524f8(0x13f)]:_0x1c7e21,[constants_1['FLOSUM_NAMESPACE']+'Component_History__c']:_0x1911aa});return _0xc5f260;}async[a128_0x3d80d3(0x167)](_0x4a93fe,_0x268aca){const _0x5d59fd=a128_0x3d80d3,_0x28cb8e={},_0x5b1fb1=zip_1[_0x5d59fd(0x12d)][_0x5d59fd(0x13a)]();for(const _0x369400 of Object[_0x5d59fd(0x125)](_0x4a93fe[_0x5d59fd(0x145)])){_0x5b1fb1[_0x5d59fd(0x112)](_0x369400,_0x4a93fe[_0x5d59fd(0x145)][_0x369400],{'createFolders':!![]});}return _0x28cb8e[_0x5d59fd(0x144)]=_0x5d59fd(0x111),_0x28cb8e[_0x5d59fd(0x141)]=_0x4a93fe['type'],_0x28cb8e[_0x5d59fd(0x12f)]=_0x4a93fe[_0x5d59fd(0x140)],_0x28cb8e['ParentId']=_0x268aca,_0x28cb8e[_0x5d59fd(0x114)]=await _0x5b1fb1['generateAsync']({'type':_0x5d59fd(0x159),'compression':_0x5d59fd(0x120),'compressionOptions':{'level':0x6}}),_0x28cb8e;}[a128_0x3d80d3(0x169)](_0x28a25d,_0x48b3b3,_0x55702e){const _0x34514b=a128_0x3d80d3,_0x4ffdf8=new Date()['toISOString'](),_0x81d7a9={};return _0x81d7a9[constants_1[_0x34514b(0x124)]+_0x34514b(0x14d)]=_0x48b3b3,_0x81d7a9[constants_1[_0x34514b(0x124)]+_0x34514b(0x14a)]=_0x28a25d[_0x34514b(0x171)],_0x81d7a9[constants_1[_0x34514b(0x124)]+_0x34514b(0x11b)]=_0x4ffdf8,_0x81d7a9[constants_1[_0x34514b(0x124)]+_0x34514b(0x151)]=this[_0x34514b(0x15b)],_0x81d7a9[constants_1['FLOSUM_NAMESPACE']+_0x34514b(0x13c)]=_0x55702e?_0x55702e+0x1:0x1,_0x81d7a9[constants_1[_0x34514b(0x155)]+_0x34514b(0x139)]=!![],_0x81d7a9;}['prepareComponentRecord'](_0x12b463,_0x6d977a){const _0x4545f9=a128_0x3d80d3;var _0x1e50de,_0x2864e8;const _0x25ab5f=new Date()[_0x4545f9(0x138)](),_0x1bf948={};return!_0x6d977a?(this['branchId']?(_0x1bf948[constants_1[_0x4545f9(0x124)]+_0x4545f9(0x152)]=this['branchId'],_0x1bf948[constants_1[_0x4545f9(0x124)]+_0x4545f9(0x128)]='Branch',_0x1bf948[_0x4545f9(0x146)]=(_0x1e50de=this[_0x4545f9(0x149)][_0x4545f9(0x11f)](_0x3df6c3=>_0x3df6c3['name']==='Branch'))===null||_0x1e50de===void 0x0?void 0x0:_0x1e50de['id']):(_0x1bf948[constants_1[_0x4545f9(0x124)]+'Repository__c']=this[_0x4545f9(0x16b)],_0x1bf948[constants_1[_0x4545f9(0x124)]+_0x4545f9(0x128)]='Repository',_0x1bf948[_0x4545f9(0x146)]=(_0x2864e8=this[_0x4545f9(0x149)][_0x4545f9(0x11f)](_0x3a9c6b=>_0x3a9c6b['name']==='Repository'))===null||_0x2864e8===void 0x0?void 0x0:_0x2864e8['id']),_0x1bf948[constants_1[_0x4545f9(0x124)]+_0x4545f9(0x13c)]=0x1):_0x1bf948[constants_1[_0x4545f9(0x124)]+_0x4545f9(0x13c)]=_0x6d977a[_0x4545f9(0x16e)]+0x1,_0x1bf948[constants_1[_0x4545f9(0x124)]+_0x4545f9(0x131)]=_0x12b463['type'],_0x1bf948[constants_1[_0x4545f9(0x124)]+_0x4545f9(0x132)]=_0x12b463[_0x4545f9(0x161)],_0x1bf948[constants_1[_0x4545f9(0x124)]+_0x4545f9(0x165)]=_0x12b463[_0x4545f9(0x162)],_0x1bf948[constants_1[_0x4545f9(0x124)]+_0x4545f9(0x12e)]=this[_0x4545f9(0x15b)],_0x1bf948[constants_1[_0x4545f9(0x124)]+_0x4545f9(0x15c)]=this['username'],_0x1bf948[constants_1[_0x4545f9(0x124)]+_0x4545f9(0x154)]=_0x25ab5f,_0x1bf948[constants_1['FLOSUM_NAMESPACE']+_0x4545f9(0x164)]=_0x25ab5f,_0x1bf948[constants_1[_0x4545f9(0x124)]+'CRC32__c']=_0x12b463['crc'],_0x1bf948;}[a128_0x3d80d3(0x14c)](){const _0x19c508=a128_0x3d80d3;return this[_0x19c508(0x13b)];}async[a128_0x3d80d3(0x12b)](_0x40036c,_0x3ed303){const _0xc7c7cb=a128_0x3d80d3,_0x2dd263=[];for(const _0x234be9 of _0x40036c){const _0x4b714b=composite_utils_1[_0xc7c7cb(0x156)](constants_1[_0xc7c7cb(0x148)],this['prepareComponentRecord'](_0x234be9)),_0x51200f=composite_utils_1[_0xc7c7cb(0x156)](constants_1[_0xc7c7cb(0x119)],this['prepareComponentHistoryRecord'](_0x234be9,'@{'+_0x4b714b[_0xc7c7cb(0x166)]+_0xc7c7cb(0x14b))),_0x215193=composite_utils_1[_0xc7c7cb(0x156)](constants_1[_0xc7c7cb(0x129)],await this[_0xc7c7cb(0x167)](_0x234be9,'@{'+_0x51200f['reference']+'.id}'));this['proceedComponentMeta'](_0x4b714b['request'][_0xc7c7cb(0x16c)],_0x4b714b[_0xc7c7cb(0x166)]),_0x2dd263[_0xc7c7cb(0x134)](_0x4b714b[_0xc7c7cb(0x15e)],_0x51200f[_0xc7c7cb(0x15e)],_0x215193[_0xc7c7cb(0x15e)]),_0x3ed303&&_0x2dd263[_0xc7c7cb(0x134)](this[_0xc7c7cb(0x15d)](_0x3ed303,'@{'+_0x51200f['reference']+_0xc7c7cb(0x14b)));}return _0x2dd263;}async['update'](_0x30650c,_0x31bb07=''){const _0x17cb3f=a128_0x3d80d3,_0x2fdd19=[];for(const {component:_0xc81beb,meta:_0x1ab82d}of _0x30650c){if(!_0x1ab82d['id']){const _0x6c92aa=this[_0x17cb3f(0x13b)]['find'](_0x526707=>_0x526707[_0x17cb3f(0x133)]===_0xc81beb[_0x17cb3f(0x161)]&&_0x526707[_0x17cb3f(0x153)]===_0xc81beb[_0x17cb3f(0x140)]);if(!_0x6c92aa)throw new salesforce_error_1['SalesforceError'](new Error('Could\x20not\x20proceed\x20component\x20'+_0xc81beb[_0x17cb3f(0x161)]+'\x20['+_0xc81beb[_0x17cb3f(0x140)]+']\x20-\x20meta\x20not\x20found'));_0x1ab82d['id']=_0x6c92aa[_0x17cb3f(0x13d)];}const _0x519120=composite_utils_1[_0x17cb3f(0x157)](constants_1[_0x17cb3f(0x148)],_0x1ab82d['id'],this['prepareComponentRecord'](_0xc81beb,_0x1ab82d)),_0x15b03d=composite_utils_1[_0x17cb3f(0x156)](constants_1[_0x17cb3f(0x119)],this[_0x17cb3f(0x169)](_0xc81beb,_0x1ab82d['id'],_0x1ab82d[_0x17cb3f(0x16e)])),_0x3642b9=composite_utils_1['createPostRequest'](constants_1['FLOSUM_ATTACHMENT'],await this[_0x17cb3f(0x167)](_0xc81beb,'@{'+_0x15b03d[_0x17cb3f(0x166)]+_0x17cb3f(0x14b)));this[_0x17cb3f(0x15a)](_0x519120[_0x17cb3f(0x15e)][_0x17cb3f(0x16c)],_0x519120['reference']),_0x2fdd19['push'](_0x519120['request'],_0x15b03d[_0x17cb3f(0x15e)],_0x3642b9[_0x17cb3f(0x15e)]),_0x31bb07&&_0x2fdd19[_0x17cb3f(0x134)](this[_0x17cb3f(0x15d)](_0x31bb07,'@{'+_0x15b03d[_0x17cb3f(0x166)]+'.id}'));}return _0x2fdd19;}async[a128_0x3d80d3(0x170)](_0x510d67,_0x48e5a4=![]){const _0x357f2f=a128_0x3d80d3,_0x40a5da={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0xfb5d94=[];for(const _0x1a3892 of _0x510d67){if(_0x1a3892['id'])_0xfb5d94[_0x357f2f(0x134)](_0x1a3892['id']);else{const _0xe94180=this['proceededComponentsMeta'][_0x357f2f(0x11f)](_0xafb6d9=>_0xafb6d9[_0x357f2f(0x133)]===_0x1a3892[_0x357f2f(0x161)]&&_0xafb6d9[_0x357f2f(0x153)]===_0x1a3892[_0x357f2f(0x140)]);if(!_0xe94180||!_0xe94180['componentId'])continue;_0xfb5d94[_0x357f2f(0x134)](_0xe94180['componentId']);}}if(_0x48e5a4){const _0x375c98=await this[_0x357f2f(0x16f)][_0x357f2f(0x130)](_0xfb5d94);_0x40a5da[_0x357f2f(0x11d)]=_0x375c98[_0x357f2f(0x137)](_0x4e4426=>composite_utils_1[_0x357f2f(0x14f)](constants_1[_0x357f2f(0x11c)],_0x4e4426)[_0x357f2f(0x15e)]);}return _0x40a5da[_0x357f2f(0x121)]=_0xfb5d94[_0x357f2f(0x137)](_0x18cd3c=>composite_utils_1[_0x357f2f(0x157)](constants_1[_0x357f2f(0x148)],_0x18cd3c,{[constants_1[_0x357f2f(0x155)]+'Deletion_By_Agent__c']:!![]})[_0x357f2f(0x15e)]),_0x40a5da['componentsToDelete']=_0xfb5d94[_0x357f2f(0x137)](_0x2bc70e=>composite_utils_1['createDeleteRequest'](constants_1['FLOSUM_COMPONENT'],_0x2bc70e)[_0x357f2f(0x15e)]),_0x40a5da;}}function a128_0x2f0e(){const _0x4fef06=['insert','4628552DgroWZ','Zip','Last_Updated_By__c','Description','fetchCommitManifestsByComponentIds','Component_Type__c','Component_Name__c','componentName','push','../utils/composite.utils','6TcKWnH','map','toISOString','Is_From_Agent__c','createZip','proceededComponentsMeta','Version__c','componentId','15348nifXbx','Commit__c','type','Name','2487930BfxkPd','10210fCtIQK','ContentType','files','RecordTypeId','284613ttwRrd','FLOSUM_COMPONENT','recordTypes','CRC32__c','.id}','getProceededComponentsMeta','Component__c','6471uGYDNX','createDeleteRequest','SalesforceComponentsManager','Changed_By__c','Branch__c','componentType','Last_Modified_Date__c','FLOSUM_GIT_NAMESPACE','createPostRequest','createPatchRequest','../../parsers/utils/zip','base64','proceedComponentMeta','username','Last_Modified_By__c','prepareCommitManifest','request','136046hbFgZl','../../../core','name','filePath','branchId','Committed_On__c','File_Name__c','reference','prepareComponentAttachmentRecord','default','prepareComponentHistoryRecord','logger','repositoryId','body','9276zClvKM','version','gitSync','delete','crc','application/zip','file','(((.+)+)+)+$','Body','apply','9977hAMZIk','SalesforceGitSyncService','toString','FLOSUM_COMPONENT_HISTORY','__esModule','Changed_On__c','FLOSUM_COMMIT_MANIFEST','manifests','13tbfDMQ','find','DEFLATE','componentsToUpdate','__importDefault','search','FLOSUM_NAMESPACE','keys','typedi','1195qfbRNa','Source__c','FLOSUM_ATTACHMENT','Logger'];a128_0x2f0e=function(){return _0x4fef06;};return a128_0x2f0e();}exports[a128_0x3d80d3(0x150)]=SalesforceComponentsManager;