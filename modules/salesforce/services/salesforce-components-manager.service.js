const a127_0x4394f8=a127_0xf1cf;function a127_0xf1cf(_0x2ded62,_0x5377fb){const _0xfa4dd9=a127_0x1d85();return a127_0xf1cf=function(_0x522225,_0xcfde65){_0x522225=_0x522225-0x116;let _0x1d8569=_0xfa4dd9[_0x522225];return _0x1d8569;},a127_0xf1cf(_0x2ded62,_0x5377fb);}(function(_0x57b20f,_0x460213){const _0x128d89=a127_0xf1cf,_0x4ec45d=_0x57b20f();while(!![]){try{const _0x2cc7eb=parseInt(_0x128d89(0x11a))/0x1+-parseInt(_0x128d89(0x16a))/0x2+parseInt(_0x128d89(0x13a))/0x3*(parseInt(_0x128d89(0x16b))/0x4)+parseInt(_0x128d89(0x13f))/0x5+-parseInt(_0x128d89(0x156))/0x6+-parseInt(_0x128d89(0x157))/0x7+parseInt(_0x128d89(0x131))/0x8;if(_0x2cc7eb===_0x460213)break;else _0x4ec45d['push'](_0x4ec45d['shift']());}catch(_0x88d2f8){_0x4ec45d['push'](_0x4ec45d['shift']());}}}(a127_0x1d85,0xc6507));const a127_0xcfde65=(function(){let _0x2f2cef=!![];return function(_0x4f1519,_0x15a6cd){const _0x5c46f8=_0x2f2cef?function(){if(_0x15a6cd){const _0x33ab72=_0x15a6cd['apply'](_0x4f1519,arguments);return _0x15a6cd=null,_0x33ab72;}}:function(){};return _0x2f2cef=![],_0x5c46f8;};}()),a127_0x522225=a127_0xcfde65(this,function(){const _0x5e8344=a127_0xf1cf;return a127_0x522225['toString']()[_0x5e8344(0x151)](_0x5e8344(0x12e))[_0x5e8344(0x167)]()[_0x5e8344(0x12f)](a127_0x522225)[_0x5e8344(0x151)](_0x5e8344(0x12e));});a127_0x522225();function a127_0x1d85(){const _0x51aee4=['3520110bWFRLg','7373884GUYiGk','createDeleteRequest','createZip','get','Commit__c','FLOSUM_COMPONENT','Name','manifests','../../parsers/utils/zip','prepareCommitManifest','push','typedi','application/zip','proceededComponentsMeta','Repository','default','toString','Component__c','prepareComponentHistoryRecord','2868080SBxeGY','6596vRtfic','SalesforceComponentsManager','Version__c','Description','../utils/composite.utils','createPostRequest','FLOSUM_COMPONENT_HISTORY','prepareComponentAttachmentRecord','FLOSUM_GIT_NAMESPACE','Last_Modified_Date__c','FLOSUM_ATTACHMENT','__esModule','ContentType','Is_From_Agent__c','componentsToDelete','231073rpMgNV','branchId','componentsToUpdate','type','getProceededComponentsMeta','proceedComponentMeta','FLOSUM_NAMESPACE','componentId','delete','Component_Name__c','name','update','toISOString','recordTypes','Committed_On__c','find','extractFieldsFromRecord','../errors/salesforce.error','.id}','Component_Type__c','(((.+)+)+)+$','constructor','crc','9731608pmDkkl','keys','base64','__importDefault','componentType','prepareComponentRecord','Branch','SalesforceError','CRC32__c','2841JDlGqu','Changed_On__c','insert','Body','ParentId','4386525qBHzSt','version','../../../core','Logger','fetchCommitManifestsByComponentIds','Last_Modified_By__c','Last_Updated_By__c','files','reference','Deletion_By_Agent__c','body','createPatchRequest','username','./salesforce-git-sync.service','RecordTypeId','Source__c','Zip','FLOSUM_COMMIT_MANIFEST','search','request','SalesforceGitSyncService','componentName','map'];a127_0x1d85=function(){return _0x51aee4;};return a127_0x1d85();}'use strict';var __importDefault=this&&this[a127_0x4394f8(0x134)]||function(_0x132f5e){return _0x132f5e&&_0x132f5e['__esModule']?_0x132f5e:{'default':_0x132f5e};};Object['defineProperty'](exports,a127_0x4394f8(0x116),{'value':!![]}),exports[a127_0x4394f8(0x16c)]=void 0x0;const constants_1=require('../../../constants'),core_1=require(a127_0x4394f8(0x141)),zip_1=require(a127_0x4394f8(0x15f)),typedi_1=__importDefault(require(a127_0x4394f8(0x162))),salesforce_error_1=require(a127_0x4394f8(0x12b)),composite_utils_1=require(a127_0x4394f8(0x16f)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a127_0x4394f8(0x14c));class SalesforceComponentsManager{constructor(_0x34376f,_0x68ccee,_0xe62657,_0xaee35c,_0x1c2f99){const _0x3ee1ed=a127_0x4394f8;this['repositoryId']=_0x34376f,this[_0x3ee1ed(0x11b)]=_0x68ccee,this[_0x3ee1ed(0x14b)]=_0xe62657,this[_0x3ee1ed(0x127)]=_0xaee35c,this[_0x3ee1ed(0x164)]=_0x1c2f99,this['logger']=new core_1[(_0x3ee1ed(0x142))](SalesforceComponentsManager['name']),this['gitSync']=typedi_1[_0x3ee1ed(0x166)][_0x3ee1ed(0x15a)](salesforce_git_sync_service_1[_0x3ee1ed(0x153)]);}[a127_0x4394f8(0x11f)](_0x574c41,_0x5d8920){const _0x61f10c=a127_0x4394f8,_0xa1b41f=flosum_naming_utils_1[_0x61f10c(0x12a)](_0x574c41,[_0x61f10c(0x12d),_0x61f10c(0x123),_0x61f10c(0x16d)]);this['proceededComponentsMeta'][_0x61f10c(0x161)]({'componentId':'','reference':_0x5d8920,'version':_0xa1b41f[_0x61f10c(0x16d)],'componentName':_0xa1b41f[_0x61f10c(0x123)],'componentType':_0xa1b41f[_0x61f10c(0x12d)]});}[a127_0x4394f8(0x160)](_0x59775c,_0x3fe52f){const _0x3ac987=a127_0x4394f8,{request:_0x1c582a}=composite_utils_1[_0x3ac987(0x170)](constants_1[_0x3ac987(0x150)],{[constants_1[_0x3ac987(0x120)]+_0x3ac987(0x15b)]:_0x59775c,[constants_1['FLOSUM_NAMESPACE']+'Component_History__c']:_0x3fe52f});return _0x1c582a;}async[a127_0x4394f8(0x172)](_0x45deb0,_0x2700d7){const _0x3b3a36=a127_0x4394f8,_0x3c0ab3={},_0x4ae19b=zip_1[_0x3b3a36(0x14f)][_0x3b3a36(0x159)]();for(const _0x4589a1 of Object[_0x3b3a36(0x132)](_0x45deb0[_0x3b3a36(0x146)])){_0x4ae19b['file'](_0x4589a1,_0x45deb0['files'][_0x4589a1],{'createFolders':!![]});}return _0x3c0ab3[_0x3b3a36(0x117)]=_0x3b3a36(0x163),_0x3c0ab3[_0x3b3a36(0x15d)]=_0x45deb0[_0x3b3a36(0x11d)],_0x3c0ab3[_0x3b3a36(0x16e)]=_0x45deb0[_0x3b3a36(0x11d)],_0x3c0ab3[_0x3b3a36(0x13e)]=_0x2700d7,_0x3c0ab3[_0x3b3a36(0x13d)]=await _0x4ae19b['generateAsync']({'type':_0x3b3a36(0x133),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x3c0ab3;}['prepareComponentHistoryRecord'](_0x3dbee9,_0x20be47,_0x4c0ed5){const _0x523e3e=a127_0x4394f8,_0x4bd6ac=new Date()[_0x523e3e(0x126)](),_0x2bbac8={};return _0x2bbac8[constants_1[_0x523e3e(0x120)]+_0x523e3e(0x168)]=_0x20be47,_0x2bbac8[constants_1[_0x523e3e(0x120)]+'CRC32__c']=_0x3dbee9[_0x523e3e(0x130)],_0x2bbac8[constants_1[_0x523e3e(0x120)]+_0x523e3e(0x13b)]=_0x4bd6ac,_0x2bbac8[constants_1[_0x523e3e(0x120)]+'Changed_By__c']=this[_0x523e3e(0x14b)],_0x2bbac8[constants_1[_0x523e3e(0x120)]+'Version__c']=_0x4c0ed5?_0x4c0ed5+0x1:0x1,_0x2bbac8[constants_1[_0x523e3e(0x173)]+_0x523e3e(0x118)]=!![],_0x2bbac8;}[a127_0x4394f8(0x136)](_0x2a49bd,_0x42ad05){const _0x107d5d=a127_0x4394f8;var _0x21d15e,_0x26ea0e;const _0x3273d9=new Date()[_0x107d5d(0x126)](),_0x141b5d={};return!_0x42ad05?(this[_0x107d5d(0x11b)]?(_0x141b5d[constants_1[_0x107d5d(0x120)]+'Branch__c']=this[_0x107d5d(0x11b)],_0x141b5d[constants_1[_0x107d5d(0x120)]+_0x107d5d(0x14e)]='Branch',_0x141b5d[_0x107d5d(0x14d)]=(_0x21d15e=this[_0x107d5d(0x127)][_0x107d5d(0x129)](_0x1ffe39=>_0x1ffe39[_0x107d5d(0x124)]===_0x107d5d(0x137)))===null||_0x21d15e===void 0x0?void 0x0:_0x21d15e['id']):(_0x141b5d[constants_1['FLOSUM_NAMESPACE']+'Repository__c']=this['repositoryId'],_0x141b5d[constants_1['FLOSUM_NAMESPACE']+_0x107d5d(0x14e)]='Repository',_0x141b5d[_0x107d5d(0x14d)]=(_0x26ea0e=this[_0x107d5d(0x127)][_0x107d5d(0x129)](_0x167b75=>_0x167b75[_0x107d5d(0x124)]===_0x107d5d(0x165)))===null||_0x26ea0e===void 0x0?void 0x0:_0x26ea0e['id']),_0x141b5d[constants_1[_0x107d5d(0x120)]+_0x107d5d(0x16d)]=0x1):_0x141b5d[constants_1[_0x107d5d(0x120)]+'Version__c']=_0x42ad05[_0x107d5d(0x140)]+0x1,_0x141b5d[constants_1[_0x107d5d(0x120)]+_0x107d5d(0x12d)]=_0x2a49bd[_0x107d5d(0x11d)],_0x141b5d[constants_1[_0x107d5d(0x120)]+_0x107d5d(0x123)]=_0x2a49bd['name'],_0x141b5d[constants_1['FLOSUM_NAMESPACE']+'File_Name__c']=_0x2a49bd['filePath'],_0x141b5d[constants_1['FLOSUM_NAMESPACE']+_0x107d5d(0x145)]=this['username'],_0x141b5d[constants_1[_0x107d5d(0x120)]+_0x107d5d(0x144)]=this[_0x107d5d(0x14b)],_0x141b5d[constants_1[_0x107d5d(0x120)]+_0x107d5d(0x174)]=_0x3273d9,_0x141b5d[constants_1['FLOSUM_NAMESPACE']+_0x107d5d(0x128)]=_0x3273d9,_0x141b5d[constants_1[_0x107d5d(0x120)]+_0x107d5d(0x139)]=_0x2a49bd[_0x107d5d(0x130)],_0x141b5d;}[a127_0x4394f8(0x11e)](){const _0x429d67=a127_0x4394f8;return this[_0x429d67(0x164)];}async[a127_0x4394f8(0x13c)](_0x3e2341,_0x1a92c8){const _0x48dc33=a127_0x4394f8,_0x1466e3=[];for(const _0x267eaf of _0x3e2341){const _0x415946=composite_utils_1['createPostRequest'](constants_1[_0x48dc33(0x15c)],this[_0x48dc33(0x136)](_0x267eaf)),_0x346553=composite_utils_1[_0x48dc33(0x170)](constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x48dc33(0x169)](_0x267eaf,'@{'+_0x415946[_0x48dc33(0x147)]+_0x48dc33(0x12c))),_0x4d42f9=composite_utils_1[_0x48dc33(0x170)](constants_1['FLOSUM_ATTACHMENT'],await this[_0x48dc33(0x172)](_0x267eaf,'@{'+_0x346553[_0x48dc33(0x147)]+_0x48dc33(0x12c)));this[_0x48dc33(0x11f)](_0x415946[_0x48dc33(0x152)][_0x48dc33(0x149)],_0x415946[_0x48dc33(0x147)]),_0x1466e3['push'](_0x415946[_0x48dc33(0x152)],_0x346553['request'],_0x4d42f9[_0x48dc33(0x152)]),_0x1a92c8&&_0x1466e3[_0x48dc33(0x161)](this[_0x48dc33(0x160)](_0x1a92c8,'@{'+_0x346553[_0x48dc33(0x147)]+_0x48dc33(0x12c)));}return _0x1466e3;}async[a127_0x4394f8(0x125)](_0x162252,_0x38c72e=''){const _0x5120d7=a127_0x4394f8,_0x561743=[];for(const {component:_0x32d15f,meta:_0x378429}of _0x162252){if(!_0x378429['id']){const _0x3985b6=this[_0x5120d7(0x164)]['find'](_0x4c2eec=>_0x4c2eec['componentName']===_0x32d15f[_0x5120d7(0x124)]&&_0x4c2eec[_0x5120d7(0x135)]===_0x32d15f[_0x5120d7(0x11d)]);if(!_0x3985b6)throw new salesforce_error_1[(_0x5120d7(0x138))](new Error('Could\x20not\x20proceed\x20component\x20'+_0x32d15f[_0x5120d7(0x124)]+'\x20['+_0x32d15f[_0x5120d7(0x11d)]+']\x20-\x20meta\x20not\x20found'));_0x378429['id']=_0x3985b6['componentId'];}const _0x40bfdd=composite_utils_1[_0x5120d7(0x14a)](constants_1[_0x5120d7(0x15c)],_0x378429['id'],this[_0x5120d7(0x136)](_0x32d15f,_0x378429)),_0x143a10=composite_utils_1['createPostRequest'](constants_1[_0x5120d7(0x171)],this[_0x5120d7(0x169)](_0x32d15f,_0x378429['id'],_0x378429[_0x5120d7(0x140)])),_0x443d7c=composite_utils_1[_0x5120d7(0x170)](constants_1[_0x5120d7(0x175)],await this[_0x5120d7(0x172)](_0x32d15f,'@{'+_0x143a10[_0x5120d7(0x147)]+_0x5120d7(0x12c)));this[_0x5120d7(0x11f)](_0x40bfdd['request'][_0x5120d7(0x149)],_0x40bfdd['reference']),_0x561743[_0x5120d7(0x161)](_0x40bfdd[_0x5120d7(0x152)],_0x143a10['request'],_0x443d7c['request']),_0x38c72e&&_0x561743['push'](this[_0x5120d7(0x160)](_0x38c72e,'@{'+_0x143a10[_0x5120d7(0x147)]+_0x5120d7(0x12c)));}return _0x561743;}async[a127_0x4394f8(0x122)](_0x1f5a94,_0x4f09dd=![]){const _0x339f4d=a127_0x4394f8,_0x4e6677={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x196852=[];for(const _0x22bf98 of _0x1f5a94){if(_0x22bf98['id'])_0x196852[_0x339f4d(0x161)](_0x22bf98['id']);else{const _0x2398ec=this[_0x339f4d(0x164)][_0x339f4d(0x129)](_0x3b1efc=>_0x3b1efc[_0x339f4d(0x154)]===_0x22bf98[_0x339f4d(0x124)]&&_0x3b1efc['componentType']===_0x22bf98['type']);if(!_0x2398ec||!_0x2398ec[_0x339f4d(0x121)])continue;_0x196852['push'](_0x2398ec[_0x339f4d(0x121)]);}}if(_0x4f09dd){const _0x274bb3=await this['gitSync'][_0x339f4d(0x143)](_0x196852);_0x4e6677[_0x339f4d(0x15e)]=_0x274bb3[_0x339f4d(0x155)](_0xe7b240=>composite_utils_1[_0x339f4d(0x158)](constants_1['FLOSUM_COMMIT_MANIFEST'],_0xe7b240)[_0x339f4d(0x152)]);}return _0x4e6677[_0x339f4d(0x11c)]=_0x196852[_0x339f4d(0x155)](_0x555ad8=>composite_utils_1[_0x339f4d(0x14a)](constants_1[_0x339f4d(0x15c)],_0x555ad8,{[constants_1[_0x339f4d(0x173)]+_0x339f4d(0x148)]:!![]})[_0x339f4d(0x152)]),_0x4e6677[_0x339f4d(0x119)]=_0x196852[_0x339f4d(0x155)](_0x1177e6=>composite_utils_1[_0x339f4d(0x158)](constants_1[_0x339f4d(0x15c)],_0x1177e6)[_0x339f4d(0x152)]),_0x4e6677;}}exports[a127_0x4394f8(0x16c)]=SalesforceComponentsManager;