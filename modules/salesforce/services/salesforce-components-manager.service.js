const a128_0xbaae83=a128_0x20a2;(function(_0x25d4a0,_0x2377e4){const _0xa69e1b=a128_0x20a2,_0x5f04f0=_0x25d4a0();while(!![]){try{const _0x5cc5ff=-parseInt(_0xa69e1b(0x17c))/0x1+-parseInt(_0xa69e1b(0x1b3))/0x2*(-parseInt(_0xa69e1b(0x17f))/0x3)+-parseInt(_0xa69e1b(0x180))/0x4+-parseInt(_0xa69e1b(0x197))/0x5+-parseInt(_0xa69e1b(0x19e))/0x6*(-parseInt(_0xa69e1b(0x184))/0x7)+parseInt(_0xa69e1b(0x192))/0x8*(parseInt(_0xa69e1b(0x191))/0x9)+parseInt(_0xa69e1b(0x16f))/0xa;if(_0x5cc5ff===_0x2377e4)break;else _0x5f04f0['push'](_0x5f04f0['shift']());}catch(_0x4f14f2){_0x5f04f0['push'](_0x5f04f0['shift']());}}}(a128_0x7c6a,0x5395e));function a128_0x7c6a(){const _0x32241=['createDeleteRequest','insert','Version__c','Repository__c','file','componentType',']\x20-\x20meta\x20not\x20found','reference','(((.+)+)+)+$','Last_Updated_By__c','576639EfuHnE','push','application/zip','3rGIOhg','964300sPkfYp','Logger','recordTypes','prepareComponentHistoryRecord','1603IABNwS','generateAsync','FLOSUM_COMPONENT','version','default','toISOString','toString','body','filePath','gitSync','FLOSUM_COMMIT_MANIFEST','branchId','base64','18nUdIhe','1231256UAqTjw','name','delete','__esModule','Deletion_By_Agent__c','646140wEkiwt','FLOSUM_COMPONENT_HISTORY','Component_Type__c','typedi','files','Name','./salesforce-git-sync.service','14946tynygL','createZip','Component__c','map','repositoryId','.id}','Description','logger','../utils/flosum-naming.utils','request','CRC32__c','search','proceededComponentsMeta','ContentType','createPostRequest','FLOSUM_GIT_NAMESPACE','__importDefault','../utils/composite.utils','Branch__c','prepareCommitManifest','createPatchRequest','218746aDbHPu','Body','componentsToUpdate','defineProperty','proceedComponentMeta','crc','FLOSUM_ATTACHMENT','fetchCommitManifestsByComponentIds','Last_Modified_Date__c','Commit__c','username','find','componentId','RecordTypeId','Component_Name__c','constructor','Component_History__c','prepareComponentAttachmentRecord','keys','prepareComponentRecord','FLOSUM_NAMESPACE','type','Is_From_Agent__c','../errors/salesforce.error','Could\x20not\x20proceed\x20component\x20','../../../constants','Repository','Source__c','Last_Modified_By__c','../../../core','3016820rwOShK','componentName','manifests'];a128_0x7c6a=function(){return _0x32241;};return a128_0x7c6a();}const a128_0x2f66d4=(function(){let _0x24a734=!![];return function(_0x44d837,_0x53d6db){const _0x2b0328=_0x24a734?function(){if(_0x53d6db){const _0xa77c3=_0x53d6db['apply'](_0x44d837,arguments);return _0x53d6db=null,_0xa77c3;}}:function(){};return _0x24a734=![],_0x2b0328;};}()),a128_0x3cfba9=a128_0x2f66d4(this,function(){const _0x24e3a3=a128_0x20a2;return a128_0x3cfba9[_0x24e3a3(0x18a)]()[_0x24e3a3(0x1a9)](_0x24e3a3(0x17a))[_0x24e3a3(0x18a)]()[_0x24e3a3(0x160)](a128_0x3cfba9)[_0x24e3a3(0x1a9)](_0x24e3a3(0x17a));});a128_0x3cfba9();'use strict';var __importDefault=this&&this[a128_0xbaae83(0x1ae)]||function(_0x4fc076){const _0x4e1806=a128_0xbaae83;return _0x4fc076&&_0x4fc076[_0x4e1806(0x195)]?_0x4fc076:{'default':_0x4fc076};};Object[a128_0xbaae83(0x1b6)](exports,a128_0xbaae83(0x195),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a128_0xbaae83(0x16a)),core_1=require(a128_0xbaae83(0x16e)),zip_1=require('../../parsers/utils/zip'),typedi_1=__importDefault(require(a128_0xbaae83(0x19a))),salesforce_error_1=require(a128_0xbaae83(0x168)),composite_utils_1=require(a128_0xbaae83(0x1af)),flosum_naming_utils_1=require(a128_0xbaae83(0x1a6)),salesforce_git_sync_service_1=require(a128_0xbaae83(0x19d));function a128_0x20a2(_0x29ca22,_0x727ae4){const _0x1d787c=a128_0x7c6a();return a128_0x20a2=function(_0x3cfba9,_0x2f66d4){_0x3cfba9=_0x3cfba9-0x15b;let _0x7c6a41=_0x1d787c[_0x3cfba9];return _0x7c6a41;},a128_0x20a2(_0x29ca22,_0x727ae4);}class SalesforceComponentsManager{constructor(_0x51df99,_0x276d75,_0x59a16e,_0x71298,_0x6e094c){const _0x28c1ae=a128_0xbaae83;this[_0x28c1ae(0x1a2)]=_0x51df99,this[_0x28c1ae(0x18f)]=_0x276d75,this[_0x28c1ae(0x15b)]=_0x59a16e,this[_0x28c1ae(0x182)]=_0x71298,this['proceededComponentsMeta']=_0x6e094c,this[_0x28c1ae(0x1a5)]=new core_1[(_0x28c1ae(0x181))](SalesforceComponentsManager[_0x28c1ae(0x193)]),this[_0x28c1ae(0x18d)]=typedi_1[_0x28c1ae(0x188)]['get'](salesforce_git_sync_service_1['SalesforceGitSyncService']);}[a128_0xbaae83(0x1b7)](_0x45af51,_0x12f7e2){const _0x37bf40=a128_0xbaae83,_0x42deff=flosum_naming_utils_1['extractFieldsFromRecord'](_0x45af51,[_0x37bf40(0x199),_0x37bf40(0x15f),_0x37bf40(0x174)]);this['proceededComponentsMeta'][_0x37bf40(0x17d)]({'componentId':'','reference':_0x12f7e2,'version':_0x42deff[_0x37bf40(0x174)],'componentName':_0x42deff[_0x37bf40(0x15f)],'componentType':_0x42deff[_0x37bf40(0x199)]});}[a128_0xbaae83(0x1b1)](_0x2cfea9,_0x421699){const _0x4dd4c9=a128_0xbaae83,{request:_0x4c539b}=composite_utils_1['createPostRequest'](constants_1[_0x4dd4c9(0x18e)],{[constants_1[_0x4dd4c9(0x165)]+_0x4dd4c9(0x1bc)]:_0x2cfea9,[constants_1[_0x4dd4c9(0x165)]+_0x4dd4c9(0x161)]:_0x421699});return _0x4c539b;}async[a128_0xbaae83(0x162)](_0x376963,_0x878017){const _0x2ac834=a128_0xbaae83,_0x598fd0={},_0x13e8b1=zip_1['Zip'][_0x2ac834(0x19f)]();for(const _0x699587 of Object[_0x2ac834(0x163)](_0x376963[_0x2ac834(0x19b)])){_0x13e8b1[_0x2ac834(0x176)](_0x699587,_0x376963[_0x2ac834(0x19b)][_0x699587],{'createFolders':!![]});}return _0x598fd0[_0x2ac834(0x1ab)]=_0x2ac834(0x17e),_0x598fd0[_0x2ac834(0x19c)]=_0x376963['type'],_0x598fd0[_0x2ac834(0x1a4)]=_0x376963[_0x2ac834(0x166)],_0x598fd0['ParentId']=_0x878017,_0x598fd0[_0x2ac834(0x1b4)]=await _0x13e8b1[_0x2ac834(0x185)]({'type':_0x2ac834(0x190),'compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x598fd0;}[a128_0xbaae83(0x183)](_0x12b39d,_0x41f3af,_0x213f83){const _0x1da948=a128_0xbaae83,_0x2bbf12=new Date()['toISOString'](),_0x1d7749={};return _0x1d7749[constants_1[_0x1da948(0x165)]+_0x1da948(0x1a0)]=_0x41f3af,_0x1d7749[constants_1[_0x1da948(0x165)]+_0x1da948(0x1a8)]=_0x12b39d[_0x1da948(0x1b8)],_0x1d7749[constants_1[_0x1da948(0x165)]+'Changed_On__c']=_0x2bbf12,_0x1d7749[constants_1[_0x1da948(0x165)]+'Changed_By__c']=this[_0x1da948(0x15b)],_0x1d7749[constants_1[_0x1da948(0x165)]+'Version__c']=_0x213f83?_0x213f83+0x1:0x1,_0x1d7749[constants_1[_0x1da948(0x1ad)]+_0x1da948(0x167)]=!![],_0x1d7749;}[a128_0xbaae83(0x164)](_0x4ce9ae,_0x4498f8){const _0xe9e90f=a128_0xbaae83;var _0x1ed343,_0x22d808;const _0x2a83c3=new Date()[_0xe9e90f(0x189)](),_0x40e698={};return!_0x4498f8?(this[_0xe9e90f(0x18f)]?(_0x40e698[constants_1[_0xe9e90f(0x165)]+_0xe9e90f(0x1b0)]=this[_0xe9e90f(0x18f)],_0x40e698[constants_1['FLOSUM_NAMESPACE']+_0xe9e90f(0x16c)]='Branch',_0x40e698['RecordTypeId']=(_0x1ed343=this['recordTypes']['find'](_0x3979de=>_0x3979de[_0xe9e90f(0x193)]==='Branch'))===null||_0x1ed343===void 0x0?void 0x0:_0x1ed343['id']):(_0x40e698[constants_1[_0xe9e90f(0x165)]+_0xe9e90f(0x175)]=this['repositoryId'],_0x40e698[constants_1[_0xe9e90f(0x165)]+'Source__c']=_0xe9e90f(0x16b),_0x40e698[_0xe9e90f(0x15e)]=(_0x22d808=this[_0xe9e90f(0x182)][_0xe9e90f(0x15c)](_0x2c66ad=>_0x2c66ad[_0xe9e90f(0x193)]===_0xe9e90f(0x16b)))===null||_0x22d808===void 0x0?void 0x0:_0x22d808['id']),_0x40e698[constants_1['FLOSUM_NAMESPACE']+'Version__c']=0x1):_0x40e698[constants_1[_0xe9e90f(0x165)]+_0xe9e90f(0x174)]=_0x4498f8[_0xe9e90f(0x187)]+0x1,_0x40e698[constants_1[_0xe9e90f(0x165)]+_0xe9e90f(0x199)]=_0x4ce9ae[_0xe9e90f(0x166)],_0x40e698[constants_1[_0xe9e90f(0x165)]+_0xe9e90f(0x15f)]=_0x4ce9ae[_0xe9e90f(0x193)],_0x40e698[constants_1['FLOSUM_NAMESPACE']+'File_Name__c']=_0x4ce9ae[_0xe9e90f(0x18c)],_0x40e698[constants_1['FLOSUM_NAMESPACE']+_0xe9e90f(0x17b)]=this[_0xe9e90f(0x15b)],_0x40e698[constants_1['FLOSUM_NAMESPACE']+_0xe9e90f(0x16d)]=this['username'],_0x40e698[constants_1['FLOSUM_NAMESPACE']+_0xe9e90f(0x1bb)]=_0x2a83c3,_0x40e698[constants_1[_0xe9e90f(0x165)]+'Committed_On__c']=_0x2a83c3,_0x40e698[constants_1[_0xe9e90f(0x165)]+'CRC32__c']=_0x4ce9ae[_0xe9e90f(0x1b8)],_0x40e698;}['getProceededComponentsMeta'](){const _0x374b51=a128_0xbaae83;return this[_0x374b51(0x1aa)];}async[a128_0xbaae83(0x173)](_0x46a205,_0x464fc5){const _0x1f239e=a128_0xbaae83,_0x472042=[];for(const _0x122693 of _0x46a205){const _0x5d62f7=composite_utils_1[_0x1f239e(0x1ac)](constants_1['FLOSUM_COMPONENT'],this[_0x1f239e(0x164)](_0x122693)),_0x5a68d6=composite_utils_1['createPostRequest'](constants_1[_0x1f239e(0x198)],this[_0x1f239e(0x183)](_0x122693,'@{'+_0x5d62f7['reference']+_0x1f239e(0x1a3))),_0x54f14f=composite_utils_1[_0x1f239e(0x1ac)](constants_1[_0x1f239e(0x1b9)],await this[_0x1f239e(0x162)](_0x122693,'@{'+_0x5a68d6[_0x1f239e(0x179)]+_0x1f239e(0x1a3)));this[_0x1f239e(0x1b7)](_0x5d62f7[_0x1f239e(0x1a7)][_0x1f239e(0x18b)],_0x5d62f7[_0x1f239e(0x179)]),_0x472042['push'](_0x5d62f7['request'],_0x5a68d6['request'],_0x54f14f['request']),_0x464fc5&&_0x472042[_0x1f239e(0x17d)](this[_0x1f239e(0x1b1)](_0x464fc5,'@{'+_0x5a68d6['reference']+_0x1f239e(0x1a3)));}return _0x472042;}async['update'](_0x579c5e,_0x48aa61=''){const _0xfd0824=a128_0xbaae83,_0x159801=[];for(const {component:_0x36238b,meta:_0x253e60}of _0x579c5e){if(!_0x253e60['id']){const _0x1e6aaf=this['proceededComponentsMeta'][_0xfd0824(0x15c)](_0x4fe396=>_0x4fe396['componentName']===_0x36238b[_0xfd0824(0x193)]&&_0x4fe396[_0xfd0824(0x177)]===_0x36238b['type']);if(!_0x1e6aaf)throw new salesforce_error_1['SalesforceError'](new Error(_0xfd0824(0x169)+_0x36238b[_0xfd0824(0x193)]+'\x20['+_0x36238b[_0xfd0824(0x166)]+_0xfd0824(0x178)));_0x253e60['id']=_0x1e6aaf[_0xfd0824(0x15d)];}const _0x2f10eb=composite_utils_1[_0xfd0824(0x1b2)](constants_1[_0xfd0824(0x186)],_0x253e60['id'],this[_0xfd0824(0x164)](_0x36238b,_0x253e60)),_0x374a71=composite_utils_1[_0xfd0824(0x1ac)](constants_1[_0xfd0824(0x198)],this[_0xfd0824(0x183)](_0x36238b,_0x253e60['id'],_0x253e60[_0xfd0824(0x187)])),_0x592a2a=composite_utils_1[_0xfd0824(0x1ac)](constants_1['FLOSUM_ATTACHMENT'],await this['prepareComponentAttachmentRecord'](_0x36238b,'@{'+_0x374a71[_0xfd0824(0x179)]+_0xfd0824(0x1a3)));this['proceedComponentMeta'](_0x2f10eb[_0xfd0824(0x1a7)]['body'],_0x2f10eb[_0xfd0824(0x179)]),_0x159801[_0xfd0824(0x17d)](_0x2f10eb[_0xfd0824(0x1a7)],_0x374a71['request'],_0x592a2a[_0xfd0824(0x1a7)]),_0x48aa61&&_0x159801[_0xfd0824(0x17d)](this[_0xfd0824(0x1b1)](_0x48aa61,'@{'+_0x374a71[_0xfd0824(0x179)]+_0xfd0824(0x1a3)));}return _0x159801;}async[a128_0xbaae83(0x194)](_0x233db5,_0x49fe4b=![]){const _0x331b0e=a128_0xbaae83,_0x11ec16={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x55f2c6=[];for(const _0x160261 of _0x233db5){if(_0x160261['id'])_0x55f2c6['push'](_0x160261['id']);else{const _0x54ef5d=this[_0x331b0e(0x1aa)][_0x331b0e(0x15c)](_0x5a7ac8=>_0x5a7ac8[_0x331b0e(0x170)]===_0x160261[_0x331b0e(0x193)]&&_0x5a7ac8['componentType']===_0x160261[_0x331b0e(0x166)]);if(!_0x54ef5d||!_0x54ef5d[_0x331b0e(0x15d)])continue;_0x55f2c6[_0x331b0e(0x17d)](_0x54ef5d['componentId']);}}if(_0x49fe4b){const _0x4e5166=await this[_0x331b0e(0x18d)][_0x331b0e(0x1ba)](_0x55f2c6);_0x11ec16[_0x331b0e(0x171)]=_0x4e5166[_0x331b0e(0x1a1)](_0x238c93=>composite_utils_1[_0x331b0e(0x172)](constants_1[_0x331b0e(0x18e)],_0x238c93)[_0x331b0e(0x1a7)]);}return _0x11ec16[_0x331b0e(0x1b5)]=_0x55f2c6[_0x331b0e(0x1a1)](_0x2c115a=>composite_utils_1['createPatchRequest'](constants_1[_0x331b0e(0x186)],_0x2c115a,{[constants_1[_0x331b0e(0x1ad)]+_0x331b0e(0x196)]:!![]})[_0x331b0e(0x1a7)]),_0x11ec16['componentsToDelete']=_0x55f2c6[_0x331b0e(0x1a1)](_0xe2a747=>composite_utils_1[_0x331b0e(0x172)](constants_1['FLOSUM_COMPONENT'],_0xe2a747)[_0x331b0e(0x1a7)]),_0x11ec16;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;