const a128_0x4a30b7=a128_0x65e3;(function(_0x5e17f8,_0x986932){const _0x402851=a128_0x65e3,_0x45b6e7=_0x5e17f8();while(!![]){try{const _0x2ad2b2=-parseInt(_0x402851(0xd5))/0x1*(parseInt(_0x402851(0xdb))/0x2)+-parseInt(_0x402851(0x109))/0x3+-parseInt(_0x402851(0x113))/0x4*(parseInt(_0x402851(0xf8))/0x5)+-parseInt(_0x402851(0x125))/0x6*(parseInt(_0x402851(0xf0))/0x7)+-parseInt(_0x402851(0xf6))/0x8+-parseInt(_0x402851(0x104))/0x9*(parseInt(_0x402851(0xe2))/0xa)+parseInt(_0x402851(0x11b))/0xb;if(_0x2ad2b2===_0x986932)break;else _0x45b6e7['push'](_0x45b6e7['shift']());}catch(_0x59f7f0){_0x45b6e7['push'](_0x45b6e7['shift']());}}}(a128_0x407a,0x4bfd8));const a128_0x581628=(function(){let _0x5c7248=!![];return function(_0x29ea44,_0x541981){const _0xdbdee0=_0x5c7248?function(){if(_0x541981){const _0x2519bc=_0x541981['apply'](_0x29ea44,arguments);return _0x541981=null,_0x2519bc;}}:function(){};return _0x5c7248=![],_0xdbdee0;};}()),a128_0x2f17df=a128_0x581628(this,function(){const _0x2f79ee=a128_0x65e3;return a128_0x2f17df['toString']()[_0x2f79ee(0xf7)]('(((.+)+)+)+$')[_0x2f79ee(0x103)]()[_0x2f79ee(0xe7)](a128_0x2f17df)[_0x2f79ee(0xf7)](_0x2f79ee(0x117));});function a128_0x407a(){const _0x5e2561=['498138uOzLJS','prepareCommitManifest','Repository__c','getProceededComponentsMeta','name','RecordTypeId','typedi','crc','prepareComponentHistoryRecord','Description','__importDefault','componentId','branchId','createPostRequest','FLOSUM_COMPONENT','FLOSUM_NAMESPACE','gitSync','Commit__c','Logger','Version__c','createPatchRequest','30821MEyRbM','logger','delete','componentName','CRC32__c','componentType','22lEXmPu','proceedComponentMeta','Is_From_Agent__c','SalesforceGitSyncService','manifests','Last_Modified_By__c','ParentId','96610EAZLLH','base64','update','DEFLATE',']\x20-\x20meta\x20not\x20found','constructor','../../parsers/utils/zip','type','../errors/salesforce.error','Last_Modified_Date__c','./salesforce-git-sync.service','File_Name__c','Zip','__esModule','7QTlZvV','componentsToDelete','.id}','find','../utils/flosum-naming.utils','files','1230296uYgkEg','search','15fnRmHT','createDeleteRequest','../../../constants','Component_Type__c','Component__c','proceededComponentsMeta','insert','Branch__c','fetchCommitManifestsByComponentIds','version','Component_Name__c','toString','288OMfZaN','body','FLOSUM_GIT_NAMESPACE','request','repositoryId','980976kpZnpu','Source__c','createZip','get','push','Changed_On__c','FLOSUM_COMPONENT_HISTORY','Committed_On__c','Repository','FLOSUM_COMMIT_MANIFEST','666392UrZeNV','SalesforceComponentsManager','username','keys','(((.+)+)+)+$','prepareComponentRecord','extractFieldsFromRecord','Branch','22253385gvYwlG','FLOSUM_ATTACHMENT','Body','Could\x20not\x20proceed\x20component\x20','Changed_By__c','generateAsync','reference','../../../core','recordTypes','map'];a128_0x407a=function(){return _0x5e2561;};return a128_0x407a();}a128_0x2f17df();'use strict';var __importDefault=this&&this[a128_0x4a30b7(0x12f)]||function(_0x465572){const _0x1c772a=a128_0x4a30b7;return _0x465572&&_0x465572[_0x1c772a(0xef)]?_0x465572:{'default':_0x465572};};Object['defineProperty'](exports,a128_0x4a30b7(0xef),{'value':!![]}),exports[a128_0x4a30b7(0x114)]=void 0x0;const constants_1=require(a128_0x4a30b7(0xfa)),core_1=require(a128_0x4a30b7(0x122)),zip_1=require(a128_0x4a30b7(0xe8)),typedi_1=__importDefault(require(a128_0x4a30b7(0x12b))),salesforce_error_1=require(a128_0x4a30b7(0xea)),composite_utils_1=require('../utils/composite.utils'),flosum_naming_utils_1=require(a128_0x4a30b7(0xf4)),salesforce_git_sync_service_1=require(a128_0x4a30b7(0xec));class SalesforceComponentsManager{constructor(_0x411741,_0x1253cd,_0x27387b,_0x3a4c48,_0x349adf){const _0x26f9fb=a128_0x4a30b7;this['repositoryId']=_0x411741,this[_0x26f9fb(0x131)]=_0x1253cd,this[_0x26f9fb(0x115)]=_0x27387b,this['recordTypes']=_0x3a4c48,this[_0x26f9fb(0xfd)]=_0x349adf,this[_0x26f9fb(0xd6)]=new core_1[(_0x26f9fb(0xd2))](SalesforceComponentsManager[_0x26f9fb(0x129)]),this[_0x26f9fb(0x135)]=typedi_1['default'][_0x26f9fb(0x10c)](salesforce_git_sync_service_1[_0x26f9fb(0xde)]);}['proceedComponentMeta'](_0x25a3d2,_0x2461de){const _0xb93f95=a128_0x4a30b7,_0x5cbb61=flosum_naming_utils_1[_0xb93f95(0x119)](_0x25a3d2,[_0xb93f95(0xfb),'Component_Name__c','Version__c']);this[_0xb93f95(0xfd)][_0xb93f95(0x10d)]({'componentId':'','reference':_0x2461de,'version':_0x5cbb61[_0xb93f95(0xd3)],'componentName':_0x5cbb61[_0xb93f95(0x102)],'componentType':_0x5cbb61[_0xb93f95(0xfb)]});}[a128_0x4a30b7(0x126)](_0x274a7c,_0x3c19e3){const _0x4881a5=a128_0x4a30b7,{request:_0x1d61d0}=composite_utils_1['createPostRequest'](constants_1[_0x4881a5(0x112)],{[constants_1[_0x4881a5(0x134)]+_0x4881a5(0x136)]:_0x274a7c,[constants_1[_0x4881a5(0x134)]+'Component_History__c']:_0x3c19e3});return _0x1d61d0;}async['prepareComponentAttachmentRecord'](_0x32c650,_0x4bf3b5){const _0xd25ab=a128_0x4a30b7,_0x52b8a5={},_0x128e0f=zip_1[_0xd25ab(0xee)][_0xd25ab(0x10b)]();for(const _0x4a241e of Object[_0xd25ab(0x116)](_0x32c650[_0xd25ab(0xf5)])){_0x128e0f['file'](_0x4a241e,_0x32c650['files'][_0x4a241e],{'createFolders':!![]});}return _0x52b8a5['ContentType']='application/zip',_0x52b8a5['Name']=_0x32c650[_0xd25ab(0xe9)],_0x52b8a5[_0xd25ab(0x12e)]=_0x32c650[_0xd25ab(0xe9)],_0x52b8a5[_0xd25ab(0xe1)]=_0x4bf3b5,_0x52b8a5[_0xd25ab(0x11d)]=await _0x128e0f[_0xd25ab(0x120)]({'type':_0xd25ab(0xe3),'compression':_0xd25ab(0xe5),'compressionOptions':{'level':0x6}}),_0x52b8a5;}[a128_0x4a30b7(0x12d)](_0xda31,_0x1172c9,_0x480bbf){const _0xb63ee0=a128_0x4a30b7,_0x26da4c=new Date()['toISOString'](),_0x12cc9b={};return _0x12cc9b[constants_1[_0xb63ee0(0x134)]+_0xb63ee0(0xfc)]=_0x1172c9,_0x12cc9b[constants_1[_0xb63ee0(0x134)]+_0xb63ee0(0xd9)]=_0xda31[_0xb63ee0(0x12c)],_0x12cc9b[constants_1[_0xb63ee0(0x134)]+_0xb63ee0(0x10e)]=_0x26da4c,_0x12cc9b[constants_1[_0xb63ee0(0x134)]+_0xb63ee0(0x11f)]=this[_0xb63ee0(0x115)],_0x12cc9b[constants_1[_0xb63ee0(0x134)]+_0xb63ee0(0xd3)]=_0x480bbf?_0x480bbf+0x1:0x1,_0x12cc9b[constants_1[_0xb63ee0(0x106)]+_0xb63ee0(0xdd)]=!![],_0x12cc9b;}['prepareComponentRecord'](_0x59ee74,_0x2e771b){const _0x5865fd=a128_0x4a30b7;var _0x17559d,_0xdc6e64;const _0x3011a0=new Date()['toISOString'](),_0x30303b={};return!_0x2e771b?(this['branchId']?(_0x30303b[constants_1['FLOSUM_NAMESPACE']+_0x5865fd(0xff)]=this['branchId'],_0x30303b[constants_1['FLOSUM_NAMESPACE']+'Source__c']=_0x5865fd(0x11a),_0x30303b['RecordTypeId']=(_0x17559d=this[_0x5865fd(0x123)][_0x5865fd(0xf3)](_0x216656=>_0x216656[_0x5865fd(0x129)]===_0x5865fd(0x11a)))===null||_0x17559d===void 0x0?void 0x0:_0x17559d['id']):(_0x30303b[constants_1['FLOSUM_NAMESPACE']+_0x5865fd(0x127)]=this[_0x5865fd(0x108)],_0x30303b[constants_1[_0x5865fd(0x134)]+_0x5865fd(0x10a)]=_0x5865fd(0x111),_0x30303b[_0x5865fd(0x12a)]=(_0xdc6e64=this['recordTypes'][_0x5865fd(0xf3)](_0x11dd2b=>_0x11dd2b[_0x5865fd(0x129)]===_0x5865fd(0x111)))===null||_0xdc6e64===void 0x0?void 0x0:_0xdc6e64['id']),_0x30303b[constants_1[_0x5865fd(0x134)]+'Version__c']=0x1):_0x30303b[constants_1[_0x5865fd(0x134)]+_0x5865fd(0xd3)]=_0x2e771b[_0x5865fd(0x101)]+0x1,_0x30303b[constants_1[_0x5865fd(0x134)]+'Component_Type__c']=_0x59ee74['type'],_0x30303b[constants_1[_0x5865fd(0x134)]+_0x5865fd(0x102)]=_0x59ee74[_0x5865fd(0x129)],_0x30303b[constants_1[_0x5865fd(0x134)]+_0x5865fd(0xed)]=_0x59ee74['filePath'],_0x30303b[constants_1[_0x5865fd(0x134)]+'Last_Updated_By__c']=this[_0x5865fd(0x115)],_0x30303b[constants_1[_0x5865fd(0x134)]+_0x5865fd(0xe0)]=this[_0x5865fd(0x115)],_0x30303b[constants_1[_0x5865fd(0x134)]+_0x5865fd(0xeb)]=_0x3011a0,_0x30303b[constants_1[_0x5865fd(0x134)]+_0x5865fd(0x110)]=_0x3011a0,_0x30303b[constants_1[_0x5865fd(0x134)]+_0x5865fd(0xd9)]=_0x59ee74[_0x5865fd(0x12c)],_0x30303b;}[a128_0x4a30b7(0x128)](){const _0x4dc2ae=a128_0x4a30b7;return this[_0x4dc2ae(0xfd)];}async[a128_0x4a30b7(0xfe)](_0x280637,_0x262a15){const _0x596a5c=a128_0x4a30b7,_0x3ffc86=[];for(const _0x1857a5 of _0x280637){const _0x2b6483=composite_utils_1['createPostRequest'](constants_1[_0x596a5c(0x133)],this[_0x596a5c(0x118)](_0x1857a5)),_0x33dc5d=composite_utils_1[_0x596a5c(0x132)](constants_1[_0x596a5c(0x10f)],this[_0x596a5c(0x12d)](_0x1857a5,'@{'+_0x2b6483[_0x596a5c(0x121)]+_0x596a5c(0xf2))),_0x5102b6=composite_utils_1[_0x596a5c(0x132)](constants_1[_0x596a5c(0x11c)],await this['prepareComponentAttachmentRecord'](_0x1857a5,'@{'+_0x33dc5d[_0x596a5c(0x121)]+_0x596a5c(0xf2)));this[_0x596a5c(0xdc)](_0x2b6483['request']['body'],_0x2b6483[_0x596a5c(0x121)]),_0x3ffc86[_0x596a5c(0x10d)](_0x2b6483['request'],_0x33dc5d[_0x596a5c(0x107)],_0x5102b6['request']),_0x262a15&&_0x3ffc86[_0x596a5c(0x10d)](this[_0x596a5c(0x126)](_0x262a15,'@{'+_0x33dc5d['reference']+'.id}'));}return _0x3ffc86;}async[a128_0x4a30b7(0xe4)](_0x541fa9,_0x1b6aa5=''){const _0x39e2af=a128_0x4a30b7,_0x17a0a3=[];for(const {component:_0x3de994,meta:_0x17c24f}of _0x541fa9){if(!_0x17c24f['id']){const _0x4ebac3=this[_0x39e2af(0xfd)]['find'](_0x3a2a35=>_0x3a2a35[_0x39e2af(0xd8)]===_0x3de994[_0x39e2af(0x129)]&&_0x3a2a35[_0x39e2af(0xda)]===_0x3de994[_0x39e2af(0xe9)]);if(!_0x4ebac3)throw new salesforce_error_1['SalesforceError'](new Error(_0x39e2af(0x11e)+_0x3de994[_0x39e2af(0x129)]+'\x20['+_0x3de994[_0x39e2af(0xe9)]+_0x39e2af(0xe6)));_0x17c24f['id']=_0x4ebac3[_0x39e2af(0x130)];}const _0xa43830=composite_utils_1[_0x39e2af(0xd4)](constants_1[_0x39e2af(0x133)],_0x17c24f['id'],this[_0x39e2af(0x118)](_0x3de994,_0x17c24f)),_0x5ec07c=composite_utils_1['createPostRequest'](constants_1[_0x39e2af(0x10f)],this[_0x39e2af(0x12d)](_0x3de994,_0x17c24f['id'],_0x17c24f[_0x39e2af(0x101)])),_0x7645cd=composite_utils_1[_0x39e2af(0x132)](constants_1[_0x39e2af(0x11c)],await this['prepareComponentAttachmentRecord'](_0x3de994,'@{'+_0x5ec07c[_0x39e2af(0x121)]+'.id}'));this[_0x39e2af(0xdc)](_0xa43830[_0x39e2af(0x107)][_0x39e2af(0x105)],_0xa43830[_0x39e2af(0x121)]),_0x17a0a3[_0x39e2af(0x10d)](_0xa43830[_0x39e2af(0x107)],_0x5ec07c['request'],_0x7645cd[_0x39e2af(0x107)]),_0x1b6aa5&&_0x17a0a3[_0x39e2af(0x10d)](this[_0x39e2af(0x126)](_0x1b6aa5,'@{'+_0x5ec07c[_0x39e2af(0x121)]+_0x39e2af(0xf2)));}return _0x17a0a3;}async[a128_0x4a30b7(0xd7)](_0x3d69e0,_0x44e65a=![]){const _0x46c6c8=a128_0x4a30b7,_0x20f9d8={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x2d9533=[];for(const _0x250ad1 of _0x3d69e0){if(_0x250ad1['id'])_0x2d9533[_0x46c6c8(0x10d)](_0x250ad1['id']);else{const _0x4ff7f6=this['proceededComponentsMeta'][_0x46c6c8(0xf3)](_0x447e06=>_0x447e06['componentName']===_0x250ad1[_0x46c6c8(0x129)]&&_0x447e06[_0x46c6c8(0xda)]===_0x250ad1['type']);if(!_0x4ff7f6||!_0x4ff7f6[_0x46c6c8(0x130)])continue;_0x2d9533[_0x46c6c8(0x10d)](_0x4ff7f6[_0x46c6c8(0x130)]);}}if(_0x44e65a){const _0x8aaa3a=await this['gitSync'][_0x46c6c8(0x100)](_0x2d9533);_0x20f9d8[_0x46c6c8(0xdf)]=_0x8aaa3a[_0x46c6c8(0x124)](_0x23599f=>composite_utils_1['createDeleteRequest'](constants_1[_0x46c6c8(0x112)],_0x23599f)[_0x46c6c8(0x107)]);}return _0x20f9d8['componentsToUpdate']=_0x2d9533['map'](_0x56aa1c=>composite_utils_1[_0x46c6c8(0xd4)](constants_1[_0x46c6c8(0x133)],_0x56aa1c,{[constants_1[_0x46c6c8(0x106)]+'Deletion_By_Agent__c']:!![]})['request']),_0x20f9d8[_0x46c6c8(0xf1)]=_0x2d9533['map'](_0xda2901=>composite_utils_1[_0x46c6c8(0xf9)](constants_1['FLOSUM_COMPONENT'],_0xda2901)[_0x46c6c8(0x107)]),_0x20f9d8;}}function a128_0x65e3(_0x383d64,_0x2eda4d){const _0x331703=a128_0x407a();return a128_0x65e3=function(_0x2f17df,_0x581628){_0x2f17df=_0x2f17df-0xd2;let _0x407af9=_0x331703[_0x2f17df];return _0x407af9;},a128_0x65e3(_0x383d64,_0x2eda4d);}exports[a128_0x4a30b7(0x114)]=SalesforceComponentsManager;