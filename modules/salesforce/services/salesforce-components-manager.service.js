const a128_0x4ecdcc=a128_0x4e4e;(function(_0x192f27,_0x1c3bb9){const _0x3c9f12=a128_0x4e4e,_0x1b513e=_0x192f27();while(!![]){try{const _0x450673=-parseInt(_0x3c9f12(0x1d9))/0x1*(-parseInt(_0x3c9f12(0x1dc))/0x2)+-parseInt(_0x3c9f12(0x1d3))/0x3+parseInt(_0x3c9f12(0x21a))/0x4*(parseInt(_0x3c9f12(0x1d2))/0x5)+parseInt(_0x3c9f12(0x209))/0x6+parseInt(_0x3c9f12(0x1f3))/0x7*(parseInt(_0x3c9f12(0x1e3))/0x8)+parseInt(_0x3c9f12(0x202))/0x9*(parseInt(_0x3c9f12(0x224))/0xa)+-parseInt(_0x3c9f12(0x205))/0xb;if(_0x450673===_0x1c3bb9)break;else _0x1b513e['push'](_0x1b513e['shift']());}catch(_0x3f53f1){_0x1b513e['push'](_0x1b513e['shift']());}}}(a128_0x2931,0xe6307));const a128_0x3d5d28=(function(){let _0x20dc38=!![];return function(_0x3be0f1,_0xa8b8f9){const _0x4dfe1d=_0x20dc38?function(){const _0x5ce960=a128_0x4e4e;if(_0xa8b8f9){const _0x5dc392=_0xa8b8f9[_0x5ce960(0x20b)](_0x3be0f1,arguments);return _0xa8b8f9=null,_0x5dc392;}}:function(){};return _0x20dc38=![],_0x4dfe1d;};}()),a128_0x56ef49=a128_0x3d5d28(this,function(){const _0x374b0a=a128_0x4e4e;return a128_0x56ef49[_0x374b0a(0x229)]()[_0x374b0a(0x200)](_0x374b0a(0x1d0))[_0x374b0a(0x229)]()[_0x374b0a(0x222)](a128_0x56ef49)[_0x374b0a(0x200)]('(((.+)+)+)+$');});function a128_0x2931(){const _0x9cd2d8=['570940ZcXQFE','4934367PCuIEf','Version__c','crc','filePath','componentName','logger','1937xFqRqb','componentType','componentsToUpdate','1058TXdchg','componentsToDelete','SalesforceError','prepareCommitManifest','find','FLOSUM_COMPONENT','../../parsers/utils/zip','16udMVjr','__importDefault','Repository','FLOSUM_NAMESPACE','Logger','recordTypes','base64','files','map','getProceededComponentsMeta','createPostRequest','reference','type','Component_History__c','Component_Name__c','proceedComponentMeta','5337017EjBjxI','.id}','prepareComponentAttachmentRecord','FLOSUM_GIT_NAMESPACE','File_Name__c','Repository__c','branchId','Changed_By__c','proceededComponentsMeta','delete','DEFLATE','default','Is_From_Agent__c','search','../../../core','24921iRrhnc','toISOString','FLOSUM_ATTACHMENT','16748006gCJSxJ','name','../errors/salesforce.error','gitSync','4679580CcgXfo','Description','apply','Branch__c','Zip','application/zip','createPatchRequest','defineProperty','RecordTypeId','Source__c','Last_Modified_By__c','__esModule','repositoryId','request','prepareComponentHistoryRecord','ContentType','SalesforceGitSyncService','16XFhhQR','keys','prepareComponentRecord','username','CRC32__c','Branch','Name','push','constructor','Changed_On__c','1170DIWwPk','FLOSUM_COMPONENT_HISTORY','insert','Commit__c','Last_Modified_Date__c','toString','Component_Type__c','createDeleteRequest','Component__c','Last_Updated_By__c','./salesforce-git-sync.service','typedi','update',']\x20-\x20meta\x20not\x20found','../../../constants','body','Could\x20not\x20proceed\x20component\x20','../utils/flosum-naming.utils','Deletion_By_Agent__c','(((.+)+)+)+$','../utils/composite.utils'];a128_0x2931=function(){return _0x9cd2d8;};return a128_0x2931();}a128_0x56ef49();function a128_0x4e4e(_0x5d8e43,_0x104424){const _0x49ee03=a128_0x2931();return a128_0x4e4e=function(_0x56ef49,_0x3d5d28){_0x56ef49=_0x56ef49-0x1d0;let _0x293109=_0x49ee03[_0x56ef49];return _0x293109;},a128_0x4e4e(_0x5d8e43,_0x104424);}'use strict';var __importDefault=this&&this[a128_0x4ecdcc(0x1e4)]||function(_0x3213a7){return _0x3213a7&&_0x3213a7['__esModule']?_0x3213a7:{'default':_0x3213a7};};Object[a128_0x4ecdcc(0x210)](exports,a128_0x4ecdcc(0x214),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a128_0x4ecdcc(0x232)),core_1=require(a128_0x4ecdcc(0x201)),zip_1=require(a128_0x4ecdcc(0x1e2)),typedi_1=__importDefault(require(a128_0x4ecdcc(0x22f))),salesforce_error_1=require(a128_0x4ecdcc(0x207)),composite_utils_1=require(a128_0x4ecdcc(0x1d1)),flosum_naming_utils_1=require(a128_0x4ecdcc(0x235)),salesforce_git_sync_service_1=require(a128_0x4ecdcc(0x22e));class SalesforceComponentsManager{constructor(_0x16f2a1,_0x8331b3,_0x454b46,_0x5cefe6,_0x5926c9){const _0x35cea0=a128_0x4ecdcc;this['repositoryId']=_0x16f2a1,this[_0x35cea0(0x1f9)]=_0x8331b3,this[_0x35cea0(0x21d)]=_0x454b46,this['recordTypes']=_0x5cefe6,this['proceededComponentsMeta']=_0x5926c9,this[_0x35cea0(0x1d8)]=new core_1[(_0x35cea0(0x1e7))](SalesforceComponentsManager[_0x35cea0(0x206)]),this[_0x35cea0(0x208)]=typedi_1[_0x35cea0(0x1fe)]['get'](salesforce_git_sync_service_1[_0x35cea0(0x219)]);}[a128_0x4ecdcc(0x1f2)](_0x592c5b,_0x610630){const _0x33c0de=a128_0x4ecdcc,_0x5aea66=flosum_naming_utils_1['extractFieldsFromRecord'](_0x592c5b,[_0x33c0de(0x22a),'Component_Name__c','Version__c']);this[_0x33c0de(0x1fb)][_0x33c0de(0x221)]({'componentId':'','reference':_0x610630,'version':_0x5aea66['Version__c'],'componentName':_0x5aea66[_0x33c0de(0x1f1)],'componentType':_0x5aea66[_0x33c0de(0x22a)]});}[a128_0x4ecdcc(0x1df)](_0x1bb88e,_0x4e4bf5){const _0x448091=a128_0x4ecdcc,{request:_0x43322f}=composite_utils_1[_0x448091(0x1ed)](constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x448091(0x1e6)]+_0x448091(0x227)]:_0x1bb88e,[constants_1[_0x448091(0x1e6)]+_0x448091(0x1f0)]:_0x4e4bf5});return _0x43322f;}async['prepareComponentAttachmentRecord'](_0x4d20a9,_0x336e92){const _0x3b6218=a128_0x4ecdcc,_0x4fec5f={},_0x6eb281=zip_1[_0x3b6218(0x20d)]['createZip']();for(const _0xaaedf2 of Object[_0x3b6218(0x21b)](_0x4d20a9['files'])){_0x6eb281['file'](_0xaaedf2,_0x4d20a9[_0x3b6218(0x1ea)][_0xaaedf2],{'createFolders':!![]});}return _0x4fec5f[_0x3b6218(0x218)]=_0x3b6218(0x20e),_0x4fec5f[_0x3b6218(0x220)]=_0x4d20a9[_0x3b6218(0x1ef)],_0x4fec5f[_0x3b6218(0x20a)]=_0x4d20a9[_0x3b6218(0x1ef)],_0x4fec5f['ParentId']=_0x336e92,_0x4fec5f['Body']=await _0x6eb281['generateAsync']({'type':_0x3b6218(0x1e9),'compression':_0x3b6218(0x1fd),'compressionOptions':{'level':0x6}}),_0x4fec5f;}[a128_0x4ecdcc(0x217)](_0x37ad31,_0x1d162e,_0x5d334e){const _0x36d8b8=a128_0x4ecdcc,_0x331c69=new Date()[_0x36d8b8(0x203)](),_0x3161d7={};return _0x3161d7[constants_1['FLOSUM_NAMESPACE']+_0x36d8b8(0x22c)]=_0x1d162e,_0x3161d7[constants_1['FLOSUM_NAMESPACE']+_0x36d8b8(0x21e)]=_0x37ad31['crc'],_0x3161d7[constants_1[_0x36d8b8(0x1e6)]+_0x36d8b8(0x223)]=_0x331c69,_0x3161d7[constants_1['FLOSUM_NAMESPACE']+_0x36d8b8(0x1fa)]=this[_0x36d8b8(0x21d)],_0x3161d7[constants_1['FLOSUM_NAMESPACE']+_0x36d8b8(0x1d4)]=_0x5d334e?_0x5d334e+0x1:0x1,_0x3161d7[constants_1[_0x36d8b8(0x1f6)]+_0x36d8b8(0x1ff)]=!![],_0x3161d7;}[a128_0x4ecdcc(0x21c)](_0x56be54,_0x217be5){const _0x1e7164=a128_0x4ecdcc;var _0x38ade8,_0x348779;const _0x36f55a=new Date()[_0x1e7164(0x203)](),_0x114c3a={};return!_0x217be5?(this[_0x1e7164(0x1f9)]?(_0x114c3a[constants_1[_0x1e7164(0x1e6)]+_0x1e7164(0x20c)]=this[_0x1e7164(0x1f9)],_0x114c3a[constants_1[_0x1e7164(0x1e6)]+_0x1e7164(0x212)]=_0x1e7164(0x21f),_0x114c3a[_0x1e7164(0x211)]=(_0x38ade8=this['recordTypes'][_0x1e7164(0x1e0)](_0x2bf27d=>_0x2bf27d[_0x1e7164(0x206)]==='Branch'))===null||_0x38ade8===void 0x0?void 0x0:_0x38ade8['id']):(_0x114c3a[constants_1['FLOSUM_NAMESPACE']+_0x1e7164(0x1f8)]=this[_0x1e7164(0x215)],_0x114c3a[constants_1[_0x1e7164(0x1e6)]+_0x1e7164(0x212)]=_0x1e7164(0x1e5),_0x114c3a[_0x1e7164(0x211)]=(_0x348779=this[_0x1e7164(0x1e8)][_0x1e7164(0x1e0)](_0x2e4cfa=>_0x2e4cfa[_0x1e7164(0x206)]==='Repository'))===null||_0x348779===void 0x0?void 0x0:_0x348779['id']),_0x114c3a[constants_1[_0x1e7164(0x1e6)]+_0x1e7164(0x1d4)]=0x1):_0x114c3a[constants_1[_0x1e7164(0x1e6)]+'Version__c']=_0x217be5['version']+0x1,_0x114c3a[constants_1[_0x1e7164(0x1e6)]+'Component_Type__c']=_0x56be54[_0x1e7164(0x1ef)],_0x114c3a[constants_1[_0x1e7164(0x1e6)]+_0x1e7164(0x1f1)]=_0x56be54[_0x1e7164(0x206)],_0x114c3a[constants_1[_0x1e7164(0x1e6)]+_0x1e7164(0x1f7)]=_0x56be54[_0x1e7164(0x1d6)],_0x114c3a[constants_1['FLOSUM_NAMESPACE']+_0x1e7164(0x22d)]=this[_0x1e7164(0x21d)],_0x114c3a[constants_1['FLOSUM_NAMESPACE']+_0x1e7164(0x213)]=this[_0x1e7164(0x21d)],_0x114c3a[constants_1[_0x1e7164(0x1e6)]+_0x1e7164(0x228)]=_0x36f55a,_0x114c3a[constants_1[_0x1e7164(0x1e6)]+'Committed_On__c']=_0x36f55a,_0x114c3a[constants_1[_0x1e7164(0x1e6)]+_0x1e7164(0x21e)]=_0x56be54[_0x1e7164(0x1d5)],_0x114c3a;}[a128_0x4ecdcc(0x1ec)](){const _0x81c23=a128_0x4ecdcc;return this[_0x81c23(0x1fb)];}async[a128_0x4ecdcc(0x226)](_0x2e8b9b,_0x30f18c){const _0x2b772f=a128_0x4ecdcc,_0x51a75f=[];for(const _0x52f353 of _0x2e8b9b){const _0xed2526=composite_utils_1[_0x2b772f(0x1ed)](constants_1[_0x2b772f(0x1e1)],this[_0x2b772f(0x21c)](_0x52f353)),_0x5970c4=composite_utils_1['createPostRequest'](constants_1[_0x2b772f(0x225)],this['prepareComponentHistoryRecord'](_0x52f353,'@{'+_0xed2526[_0x2b772f(0x1ee)]+'.id}')),_0x534e74=composite_utils_1['createPostRequest'](constants_1['FLOSUM_ATTACHMENT'],await this[_0x2b772f(0x1f5)](_0x52f353,'@{'+_0x5970c4[_0x2b772f(0x1ee)]+_0x2b772f(0x1f4)));this['proceedComponentMeta'](_0xed2526['request'][_0x2b772f(0x233)],_0xed2526['reference']),_0x51a75f['push'](_0xed2526[_0x2b772f(0x216)],_0x5970c4['request'],_0x534e74['request']),_0x30f18c&&_0x51a75f[_0x2b772f(0x221)](this[_0x2b772f(0x1df)](_0x30f18c,'@{'+_0x5970c4[_0x2b772f(0x1ee)]+_0x2b772f(0x1f4)));}return _0x51a75f;}async[a128_0x4ecdcc(0x230)](_0x242dfd,_0x224f2c=''){const _0x153203=a128_0x4ecdcc,_0x522123=[];for(const {component:_0x480120,meta:_0x2add26}of _0x242dfd){if(!_0x2add26['id']){const _0x277f7f=this[_0x153203(0x1fb)]['find'](_0x363258=>_0x363258[_0x153203(0x1d7)]===_0x480120[_0x153203(0x206)]&&_0x363258[_0x153203(0x1da)]===_0x480120[_0x153203(0x1ef)]);if(!_0x277f7f)throw new salesforce_error_1[(_0x153203(0x1de))](new Error(_0x153203(0x234)+_0x480120[_0x153203(0x206)]+'\x20['+_0x480120[_0x153203(0x1ef)]+_0x153203(0x231)));_0x2add26['id']=_0x277f7f['componentId'];}const _0x28e171=composite_utils_1['createPatchRequest'](constants_1[_0x153203(0x1e1)],_0x2add26['id'],this[_0x153203(0x21c)](_0x480120,_0x2add26)),_0x3890c6=composite_utils_1[_0x153203(0x1ed)](constants_1[_0x153203(0x225)],this[_0x153203(0x217)](_0x480120,_0x2add26['id'],_0x2add26['version'])),_0x1b1de2=composite_utils_1['createPostRequest'](constants_1[_0x153203(0x204)],await this[_0x153203(0x1f5)](_0x480120,'@{'+_0x3890c6[_0x153203(0x1ee)]+'.id}'));this['proceedComponentMeta'](_0x28e171['request'][_0x153203(0x233)],_0x28e171['reference']),_0x522123['push'](_0x28e171[_0x153203(0x216)],_0x3890c6['request'],_0x1b1de2[_0x153203(0x216)]),_0x224f2c&&_0x522123[_0x153203(0x221)](this[_0x153203(0x1df)](_0x224f2c,'@{'+_0x3890c6['reference']+_0x153203(0x1f4)));}return _0x522123;}async[a128_0x4ecdcc(0x1fc)](_0x3004df,_0x1ea7dc=![]){const _0x3244b2=a128_0x4ecdcc,_0x52f82e={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x5a110d=[];for(const _0x43c0f8 of _0x3004df){if(_0x43c0f8['id'])_0x5a110d['push'](_0x43c0f8['id']);else{const _0x15c55a=this[_0x3244b2(0x1fb)][_0x3244b2(0x1e0)](_0x2a9e18=>_0x2a9e18[_0x3244b2(0x1d7)]===_0x43c0f8[_0x3244b2(0x206)]&&_0x2a9e18[_0x3244b2(0x1da)]===_0x43c0f8[_0x3244b2(0x1ef)]);if(!_0x15c55a||!_0x15c55a['componentId'])continue;_0x5a110d[_0x3244b2(0x221)](_0x15c55a['componentId']);}}if(_0x1ea7dc){const _0x325923=await this[_0x3244b2(0x208)]['fetchCommitManifestsByComponentIds'](_0x5a110d);_0x52f82e['manifests']=_0x325923[_0x3244b2(0x1eb)](_0x490673=>composite_utils_1['createDeleteRequest'](constants_1['FLOSUM_COMMIT_MANIFEST'],_0x490673)[_0x3244b2(0x216)]);}return _0x52f82e[_0x3244b2(0x1db)]=_0x5a110d[_0x3244b2(0x1eb)](_0x4f70d0=>composite_utils_1[_0x3244b2(0x20f)](constants_1[_0x3244b2(0x1e1)],_0x4f70d0,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x3244b2(0x236)]:!![]})[_0x3244b2(0x216)]),_0x52f82e[_0x3244b2(0x1dd)]=_0x5a110d[_0x3244b2(0x1eb)](_0x3ef33f=>composite_utils_1[_0x3244b2(0x22b)](constants_1[_0x3244b2(0x1e1)],_0x3ef33f)[_0x3244b2(0x216)]),_0x52f82e;}}exports['SalesforceComponentsManager']=SalesforceComponentsManager;