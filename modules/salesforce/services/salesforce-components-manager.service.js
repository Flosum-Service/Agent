const a128_0x4dfd69=a128_0x2057;(function(_0x439217,_0x4bdfdd){const _0x201445=a128_0x2057,_0x197043=_0x439217();while(!![]){try{const _0xa055e6=parseInt(_0x201445(0x1c1))/0x1*(parseInt(_0x201445(0x1aa))/0x2)+parseInt(_0x201445(0x171))/0x3*(parseInt(_0x201445(0x1b7))/0x4)+parseInt(_0x201445(0x1b2))/0x5+-parseInt(_0x201445(0x17e))/0x6+parseInt(_0x201445(0x187))/0x7+-parseInt(_0x201445(0x1a6))/0x8+parseInt(_0x201445(0x1a7))/0x9*(-parseInt(_0x201445(0x16e))/0xa);if(_0xa055e6===_0x4bdfdd)break;else _0x197043['push'](_0x197043['shift']());}catch(_0x4d0086){_0x197043['push'](_0x197043['shift']());}}}(a128_0x3d63,0x2afdf));const a128_0x2eb7a6=(function(){let _0x46ee1e=!![];return function(_0x3690c9,_0x1b6e97){const _0x17f74a=_0x46ee1e?function(){const _0x4f9ebc=a128_0x2057;if(_0x1b6e97){const _0x457462=_0x1b6e97[_0x4f9ebc(0x185)](_0x3690c9,arguments);return _0x1b6e97=null,_0x457462;}}:function(){};return _0x46ee1e=![],_0x17f74a;};}()),a128_0x222f05=a128_0x2eb7a6(this,function(){const _0x50dde5=a128_0x2057;return a128_0x222f05[_0x50dde5(0x1a8)]()[_0x50dde5(0x1d3)]('(((.+)+)+)+$')['toString']()[_0x50dde5(0x1a4)](a128_0x222f05)['search'](_0x50dde5(0x199));});a128_0x222f05();function a128_0x2057(_0x2264b7,_0x356f43){const _0x44a3ed=a128_0x3d63();return a128_0x2057=function(_0x222f05,_0x2eb7a6){_0x222f05=_0x222f05-0x16c;let _0x3d63b9=_0x44a3ed[_0x222f05];return _0x3d63b9;},a128_0x2057(_0x2264b7,_0x356f43);}'use strict';var __importDefault=this&&this[a128_0x4dfd69(0x1c4)]||function(_0x8eac9e){const _0x1df5e6=a128_0x4dfd69;return _0x8eac9e&&_0x8eac9e[_0x1df5e6(0x1ab)]?_0x8eac9e:{'default':_0x8eac9e};};Object[a128_0x4dfd69(0x181)](exports,a128_0x4dfd69(0x1ab),{'value':!![]}),exports[a128_0x4dfd69(0x1ce)]=void 0x0;const constants_1=require('../../../constants'),core_1=require('../../../core'),zip_1=require(a128_0x4dfd69(0x1bc)),typedi_1=__importDefault(require(a128_0x4dfd69(0x19c))),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a128_0x4dfd69(0x183)),flosum_naming_utils_1=require('../utils/flosum-naming.utils'),salesforce_git_sync_service_1=require(a128_0x4dfd69(0x191));function a128_0x3d63(){const _0x94483c=['Component_Type__c','6LjaNow','prepareCommitManifest','Description','componentId','Name','RecordTypeId','type','Changed_On__c','DEFLATE','Repository__c','extractFieldsFromRecord','FLOSUM_COMPONENT_HISTORY','request','1014480NeHAWi','Could\x20not\x20proceed\x20component\x20','find','defineProperty','prepareComponentAttachmentRecord','../utils/composite.utils','prepareComponentRecord','apply','name','31164LuUTWo','Repository','Component_Name__c','version','get','proceededComponentsMeta','update','filePath','proceedComponentMeta','map','./salesforce-git-sync.service',']\x20-\x20meta\x20not\x20found','delete','componentName','componentType','reference','createZip','file','(((.+)+)+)+$','createDeleteRequest','Deletion_By_Agent__c','typedi','componentsToDelete','Version__c','FLOSUM_NAMESPACE','gitSync','Branch','File_Name__c','FLOSUM_GIT_NAMESPACE','constructor','application/zip','331936DjxcDW','18PwHEhZ','toString','Logger','14ljoVQn','__esModule','Commit__c','Last_Updated_By__c','Component__c','repositoryId','Branch__c','base64','411445FwVqTu','ParentId','manifests','FLOSUM_COMMIT_MANIFEST','prepareComponentHistoryRecord','263992MlVBlV','recordTypes','keys','push','createPostRequest','../../parsers/utils/zip','FLOSUM_COMPONENT','componentsToUpdate','FLOSUM_ATTACHMENT','Component_History__c','49138rmSQnU','toISOString','SalesforceGitSyncService','__importDefault','SalesforceError','crc','username','fetchCommitManifestsByComponentIds','branchId','logger','.id}','generateAsync','files','SalesforceComponentsManager','body','insert','Source__c','CRC32__c','search','Changed_By__c','Zip','880180UlpjRi','Body'];a128_0x3d63=function(){return _0x94483c;};return a128_0x3d63();}class SalesforceComponentsManager{constructor(_0x95f0f1,_0x256387,_0x2a5458,_0x77fd08,_0x543a2a){const _0x3cc4ad=a128_0x4dfd69;this[_0x3cc4ad(0x1af)]=_0x95f0f1,this[_0x3cc4ad(0x1c9)]=_0x256387,this[_0x3cc4ad(0x1c7)]=_0x2a5458,this['recordTypes']=_0x77fd08,this[_0x3cc4ad(0x18c)]=_0x543a2a,this[_0x3cc4ad(0x1ca)]=new core_1[(_0x3cc4ad(0x1a9))](SalesforceComponentsManager[_0x3cc4ad(0x186)]),this[_0x3cc4ad(0x1a0)]=typedi_1['default'][_0x3cc4ad(0x18b)](salesforce_git_sync_service_1[_0x3cc4ad(0x1c3)]);}[a128_0x4dfd69(0x18f)](_0x1a8583,_0x420ba5){const _0x6bf522=a128_0x4dfd69,_0x54b913=flosum_naming_utils_1[_0x6bf522(0x17b)](_0x1a8583,[_0x6bf522(0x170),_0x6bf522(0x189),'Version__c']);this[_0x6bf522(0x18c)]['push']({'componentId':'','reference':_0x420ba5,'version':_0x54b913[_0x6bf522(0x19e)],'componentName':_0x54b913[_0x6bf522(0x189)],'componentType':_0x54b913[_0x6bf522(0x170)]});}[a128_0x4dfd69(0x172)](_0xba9b97,_0xa96df0){const _0x57934d=a128_0x4dfd69,{request:_0x26c81a}=composite_utils_1[_0x57934d(0x1bb)](constants_1[_0x57934d(0x1b5)],{[constants_1[_0x57934d(0x19f)]+_0x57934d(0x1ac)]:_0xba9b97,[constants_1[_0x57934d(0x19f)]+_0x57934d(0x1c0)]:_0xa96df0});return _0x26c81a;}async[a128_0x4dfd69(0x182)](_0x40a7ad,_0x4fe36f){const _0x5edf5b=a128_0x4dfd69,_0x284a6b={},_0x2c1633=zip_1[_0x5edf5b(0x16d)][_0x5edf5b(0x197)]();for(const _0x18b010 of Object[_0x5edf5b(0x1b9)](_0x40a7ad[_0x5edf5b(0x1cd)])){_0x2c1633[_0x5edf5b(0x198)](_0x18b010,_0x40a7ad[_0x5edf5b(0x1cd)][_0x18b010],{'createFolders':!![]});}return _0x284a6b['ContentType']=_0x5edf5b(0x1a5),_0x284a6b[_0x5edf5b(0x175)]=_0x40a7ad[_0x5edf5b(0x177)],_0x284a6b[_0x5edf5b(0x173)]=_0x40a7ad['type'],_0x284a6b[_0x5edf5b(0x1b3)]=_0x4fe36f,_0x284a6b[_0x5edf5b(0x16f)]=await _0x2c1633[_0x5edf5b(0x1cc)]({'type':_0x5edf5b(0x1b1),'compression':_0x5edf5b(0x179),'compressionOptions':{'level':0x6}}),_0x284a6b;}[a128_0x4dfd69(0x1b6)](_0x42f3b8,_0x6fb859,_0x343ef0){const _0x208227=a128_0x4dfd69,_0x220cfe=new Date()[_0x208227(0x1c2)](),_0x275b89={};return _0x275b89[constants_1[_0x208227(0x19f)]+_0x208227(0x1ae)]=_0x6fb859,_0x275b89[constants_1[_0x208227(0x19f)]+'CRC32__c']=_0x42f3b8[_0x208227(0x1c6)],_0x275b89[constants_1['FLOSUM_NAMESPACE']+_0x208227(0x178)]=_0x220cfe,_0x275b89[constants_1[_0x208227(0x19f)]+_0x208227(0x16c)]=this['username'],_0x275b89[constants_1[_0x208227(0x19f)]+'Version__c']=_0x343ef0?_0x343ef0+0x1:0x1,_0x275b89[constants_1[_0x208227(0x1a3)]+'Is_From_Agent__c']=!![],_0x275b89;}[a128_0x4dfd69(0x184)](_0x41a870,_0x415b77){const _0x3d268e=a128_0x4dfd69;var _0x273177,_0x96b9eb;const _0x1927d9=new Date()[_0x3d268e(0x1c2)](),_0x5e88d0={};return!_0x415b77?(this[_0x3d268e(0x1c9)]?(_0x5e88d0[constants_1[_0x3d268e(0x19f)]+_0x3d268e(0x1b0)]=this[_0x3d268e(0x1c9)],_0x5e88d0[constants_1[_0x3d268e(0x19f)]+'Source__c']=_0x3d268e(0x1a1),_0x5e88d0['RecordTypeId']=(_0x273177=this[_0x3d268e(0x1b8)][_0x3d268e(0x180)](_0x339364=>_0x339364['name']===_0x3d268e(0x1a1)))===null||_0x273177===void 0x0?void 0x0:_0x273177['id']):(_0x5e88d0[constants_1[_0x3d268e(0x19f)]+_0x3d268e(0x17a)]=this[_0x3d268e(0x1af)],_0x5e88d0[constants_1[_0x3d268e(0x19f)]+_0x3d268e(0x1d1)]='Repository',_0x5e88d0[_0x3d268e(0x176)]=(_0x96b9eb=this[_0x3d268e(0x1b8)]['find'](_0x37dde5=>_0x37dde5[_0x3d268e(0x186)]===_0x3d268e(0x188)))===null||_0x96b9eb===void 0x0?void 0x0:_0x96b9eb['id']),_0x5e88d0[constants_1[_0x3d268e(0x19f)]+_0x3d268e(0x19e)]=0x1):_0x5e88d0[constants_1[_0x3d268e(0x19f)]+_0x3d268e(0x19e)]=_0x415b77['version']+0x1,_0x5e88d0[constants_1[_0x3d268e(0x19f)]+_0x3d268e(0x170)]=_0x41a870[_0x3d268e(0x177)],_0x5e88d0[constants_1['FLOSUM_NAMESPACE']+_0x3d268e(0x189)]=_0x41a870[_0x3d268e(0x186)],_0x5e88d0[constants_1['FLOSUM_NAMESPACE']+_0x3d268e(0x1a2)]=_0x41a870[_0x3d268e(0x18e)],_0x5e88d0[constants_1[_0x3d268e(0x19f)]+_0x3d268e(0x1ad)]=this[_0x3d268e(0x1c7)],_0x5e88d0[constants_1[_0x3d268e(0x19f)]+'Last_Modified_By__c']=this[_0x3d268e(0x1c7)],_0x5e88d0[constants_1[_0x3d268e(0x19f)]+'Last_Modified_Date__c']=_0x1927d9,_0x5e88d0[constants_1[_0x3d268e(0x19f)]+'Committed_On__c']=_0x1927d9,_0x5e88d0[constants_1['FLOSUM_NAMESPACE']+_0x3d268e(0x1d2)]=_0x41a870[_0x3d268e(0x1c6)],_0x5e88d0;}['getProceededComponentsMeta'](){const _0x51b75e=a128_0x4dfd69;return this[_0x51b75e(0x18c)];}async[a128_0x4dfd69(0x1d0)](_0x10fba6,_0x2eb6ca){const _0x359b21=a128_0x4dfd69,_0x785301=[];for(const _0x5d84ad of _0x10fba6){const _0xb32c80=composite_utils_1[_0x359b21(0x1bb)](constants_1['FLOSUM_COMPONENT'],this[_0x359b21(0x184)](_0x5d84ad)),_0x3ffb40=composite_utils_1[_0x359b21(0x1bb)](constants_1['FLOSUM_COMPONENT_HISTORY'],this['prepareComponentHistoryRecord'](_0x5d84ad,'@{'+_0xb32c80['reference']+'.id}')),_0x866424=composite_utils_1[_0x359b21(0x1bb)](constants_1[_0x359b21(0x1bf)],await this['prepareComponentAttachmentRecord'](_0x5d84ad,'@{'+_0x3ffb40[_0x359b21(0x196)]+_0x359b21(0x1cb)));this['proceedComponentMeta'](_0xb32c80['request'][_0x359b21(0x1cf)],_0xb32c80[_0x359b21(0x196)]),_0x785301['push'](_0xb32c80['request'],_0x3ffb40[_0x359b21(0x17d)],_0x866424[_0x359b21(0x17d)]),_0x2eb6ca&&_0x785301['push'](this[_0x359b21(0x172)](_0x2eb6ca,'@{'+_0x3ffb40['reference']+_0x359b21(0x1cb)));}return _0x785301;}async[a128_0x4dfd69(0x18d)](_0x1624c0,_0x22eb3b=''){const _0x108337=a128_0x4dfd69,_0x158bd9=[];for(const {component:_0x1d457e,meta:_0x3329d4}of _0x1624c0){if(!_0x3329d4['id']){const _0x53b8b0=this[_0x108337(0x18c)][_0x108337(0x180)](_0x3ee493=>_0x3ee493['componentName']===_0x1d457e[_0x108337(0x186)]&&_0x3ee493[_0x108337(0x195)]===_0x1d457e[_0x108337(0x177)]);if(!_0x53b8b0)throw new salesforce_error_1[(_0x108337(0x1c5))](new Error(_0x108337(0x17f)+_0x1d457e[_0x108337(0x186)]+'\x20['+_0x1d457e[_0x108337(0x177)]+_0x108337(0x192)));_0x3329d4['id']=_0x53b8b0[_0x108337(0x174)];}const _0x52e3f5=composite_utils_1['createPatchRequest'](constants_1[_0x108337(0x1bd)],_0x3329d4['id'],this[_0x108337(0x184)](_0x1d457e,_0x3329d4)),_0x282b12=composite_utils_1[_0x108337(0x1bb)](constants_1[_0x108337(0x17c)],this[_0x108337(0x1b6)](_0x1d457e,_0x3329d4['id'],_0x3329d4[_0x108337(0x18a)])),_0x3cbe08=composite_utils_1[_0x108337(0x1bb)](constants_1[_0x108337(0x1bf)],await this[_0x108337(0x182)](_0x1d457e,'@{'+_0x282b12[_0x108337(0x196)]+'.id}'));this[_0x108337(0x18f)](_0x52e3f5['request'][_0x108337(0x1cf)],_0x52e3f5['reference']),_0x158bd9[_0x108337(0x1ba)](_0x52e3f5[_0x108337(0x17d)],_0x282b12['request'],_0x3cbe08[_0x108337(0x17d)]),_0x22eb3b&&_0x158bd9[_0x108337(0x1ba)](this[_0x108337(0x172)](_0x22eb3b,'@{'+_0x282b12['reference']+_0x108337(0x1cb)));}return _0x158bd9;}async[a128_0x4dfd69(0x193)](_0x1389d8,_0x2de4da=![]){const _0xe997eb=a128_0x4dfd69,_0x189fdc={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x2db0a4=[];for(const _0x14eed2 of _0x1389d8){if(_0x14eed2['id'])_0x2db0a4[_0xe997eb(0x1ba)](_0x14eed2['id']);else{const _0xd77bbd=this[_0xe997eb(0x18c)][_0xe997eb(0x180)](_0x2969db=>_0x2969db[_0xe997eb(0x194)]===_0x14eed2['name']&&_0x2969db['componentType']===_0x14eed2[_0xe997eb(0x177)]);if(!_0xd77bbd||!_0xd77bbd[_0xe997eb(0x174)])continue;_0x2db0a4[_0xe997eb(0x1ba)](_0xd77bbd[_0xe997eb(0x174)]);}}if(_0x2de4da){const _0x559739=await this[_0xe997eb(0x1a0)][_0xe997eb(0x1c8)](_0x2db0a4);_0x189fdc[_0xe997eb(0x1b4)]=_0x559739[_0xe997eb(0x190)](_0x8db7e2=>composite_utils_1['createDeleteRequest'](constants_1[_0xe997eb(0x1b5)],_0x8db7e2)[_0xe997eb(0x17d)]);}return _0x189fdc[_0xe997eb(0x1be)]=_0x2db0a4['map'](_0x4e4641=>composite_utils_1['createPatchRequest'](constants_1[_0xe997eb(0x1bd)],_0x4e4641,{[constants_1[_0xe997eb(0x1a3)]+_0xe997eb(0x19b)]:!![]})[_0xe997eb(0x17d)]),_0x189fdc[_0xe997eb(0x19d)]=_0x2db0a4[_0xe997eb(0x190)](_0x442363=>composite_utils_1[_0xe997eb(0x19a)](constants_1[_0xe997eb(0x1bd)],_0x442363)[_0xe997eb(0x17d)]),_0x189fdc;}}exports[a128_0x4dfd69(0x1ce)]=SalesforceComponentsManager;