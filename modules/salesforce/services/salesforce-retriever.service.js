const a135_0x290672=a135_0x13c0;(function(_0x3a63e6,_0x2c0ca7){const _0x13e68c=a135_0x13c0,_0x38d6e9=_0x3a63e6();while(!![]){try{const _0x3f27f4=parseInt(_0x13e68c(0x1e6))/0x1+-parseInt(_0x13e68c(0x1ed))/0x2*(-parseInt(_0x13e68c(0x1e1))/0x3)+parseInt(_0x13e68c(0x1d6))/0x4*(parseInt(_0x13e68c(0x1dc))/0x5)+parseInt(_0x13e68c(0x200))/0x6*(parseInt(_0x13e68c(0x1f1))/0x7)+-parseInt(_0x13e68c(0x1c6))/0x8*(parseInt(_0x13e68c(0x1f6))/0x9)+-parseInt(_0x13e68c(0x1df))/0xa*(parseInt(_0x13e68c(0x1ec))/0xb)+-parseInt(_0x13e68c(0x1ee))/0xc*(-parseInt(_0x13e68c(0x1d5))/0xd);if(_0x3f27f4===_0x2c0ca7)break;else _0x38d6e9['push'](_0x38d6e9['shift']());}catch(_0x4b9d49){_0x38d6e9['push'](_0x38d6e9['shift']());}}}(a135_0x1605,0xc8ecd));function a135_0x13c0(_0x145782,_0x118480){const _0x2786f1=a135_0x1605();return a135_0x13c0=function(_0xe35353,_0x430b49){_0xe35353=_0xe35353-0x1c6;let _0x1605fc=_0x2786f1[_0xe35353];return _0x1605fc;},a135_0x13c0(_0x145782,_0x118480);}const a135_0x430b49=(function(){let _0x3a1d3d=!![];return function(_0x5d499c,_0x296232){const _0x1610fe=_0x3a1d3d?function(){const _0x40f59b=a135_0x13c0;if(_0x296232){const _0x53cae6=_0x296232[_0x40f59b(0x1c8)](_0x5d499c,arguments);return _0x296232=null,_0x53cae6;}}:function(){};return _0x3a1d3d=![],_0x1610fe;};}()),a135_0xe35353=a135_0x430b49(this,function(){const _0x5411e7=a135_0x13c0;return a135_0xe35353[_0x5411e7(0x1f7)]()['search'](_0x5411e7(0x1d7))['toString']()['constructor'](a135_0xe35353)['search'](_0x5411e7(0x1d7));});a135_0xe35353();'use strict';function a135_0x1605(){const _0x36ec20=['defineProperty','salesforceService','fileName','replace','splice','../dto/flosum-component-history.dto','fromSalesforce','6567366tLmGNu','311596rfsSot','(((.+)+)+)+$','then','info','COMPONENTS_PER_QUERY','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','40LmTqwX','join','filename','1078930PGZGSu','map','3153JWvsCv','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','manually\x20retrieved\x20%d/%d\x20components','components','get','1089579sQgYqa','fileType','SalesforceRetrieverService','log','typedi','query','110gvoZWK','166TNitik','12YyVUYu','all','find','175FwKrng','retrieveComponentIdsFromHistoryIds','default','logger','COMPONENTS_PER_REQUEST','9001953RlcvkJ','toString','push','Logger','../../../core','%parent_ids%','ParentId','SalesforceQueryService','name','__importDefault','143268NsLLWV','8XCEKsw','base64','apply','length','FlosumComponentHistoryDto','retrieveLastComponents','manually\x20retrieving\x20components\x20from\x20salesforce','retrieveComponents'];a135_0x1605=function(){return _0x36ec20;};return a135_0x1605();}var __importDefault=this&&this[a135_0x290672(0x1ff)]||function(_0x522120){return _0x522120&&_0x522120['__esModule']?_0x522120:{'default':_0x522120};};Object[a135_0x290672(0x1ce)](exports,'__esModule',{'value':!![]}),exports[a135_0x290672(0x1e8)]=void 0x0;const core_1=require(a135_0x290672(0x1fa)),typedi_1=__importDefault(require(a135_0x290672(0x1ea))),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require('../queries'),flosum_component_history_dto_1=require(a135_0x290672(0x1d3));class SalesforceRetrieverService{constructor(_0x185f16){const _0x258c4f=a135_0x290672;this[_0x258c4f(0x1cf)]=_0x185f16,this['logger']=new core_1[(_0x258c4f(0x1f9))](SalesforceRetrieverService[_0x258c4f(0x1fe)]),this[_0x258c4f(0x1f5)]=0xbb8,this[_0x258c4f(0x1da)]=0x1f4;}async[a135_0x290672(0x1f2)](_0x250072){const _0x123691=a135_0x290672;this['logger']['info'](_0x123691(0x1db),_0x250072[_0x123691(0x1c9)]);const _0x2599f4=typedi_1[_0x123691(0x1f3)][_0x123691(0x1e5)](salesforce_query_service_1[_0x123691(0x1fd)]),_0xfa5895=_0x250072[_0x123691(0x1e0)](_0x58a270=>'\x27'+_0x58a270+'\x27'),_0x1297da=[];while(_0xfa5895[_0x123691(0x1c9)]){const _0x3f38fb=_0xfa5895[_0x123691(0x1d2)](0x0,this[_0x123691(0x1da)]),_0x11b1b9=_0x2599f4[_0x123691(0x1eb)](queries_1[_0x123691(0x1e2)]['replace'](_0x123691(0x1fb),_0x3f38fb[_0x123691(0x1dd)]())),_0x4c1605=_0x2599f4['query'](queries_1['GET_COMPONENT_HISTORIES_BY_IDS'][_0x123691(0x1d1)]('%ids%',_0x3f38fb[_0x123691(0x1dd)]()))[_0x123691(0x1d8)](_0x290896=>_0x290896['map'](_0x31f230=>flosum_component_history_dto_1[_0x123691(0x1ca)][_0x123691(0x1d4)](_0x31f230))),[_0x34c4fe,_0x26b5e0]=await Promise[_0x123691(0x1ef)]([_0x11b1b9,_0x4c1605]);for(const _0x587e56 of _0x26b5e0){const _0x2e9ea9=_0x34c4fe[_0x123691(0x1f0)](_0x339fb0=>_0x339fb0[_0x123691(0x1fc)]===_0x587e56['id']);_0x2e9ea9&&_0x1297da['push']({'fileType':_0x2e9ea9['Name'],'fileName':_0x587e56[_0x123691(0x1de)],'attachmentId':_0x2e9ea9['Id']});}}return _0x1297da;}async[a135_0x290672(0x1cb)](_0x115f65){const _0x338b28=a135_0x290672,_0x50bd95=await this['retrieveComponentIdsFromHistoryIds'](_0x115f65);this[_0x338b28(0x1f4)]['info'](_0x338b28(0x1cc));const _0x5f2aa7=[];for(const _0x27e509 of _0x50bd95){const _0x4feb4b=await this[_0x338b28(0x1cf)]['retrieveAttachment'](_0x27e509['attachmentId'],!![]);_0x5f2aa7[_0x338b28(0x1f8)]({'body':_0x4feb4b['toString'](_0x338b28(0x1c7)),'fileName':_0x27e509[_0x338b28(0x1d0)],'fileType':_0x27e509[_0x338b28(0x1e7)]}),this[_0x338b28(0x1f4)][_0x338b28(0x1d9)](_0x338b28(0x1e3),_0x5f2aa7[_0x338b28(0x1c9)],_0x115f65[_0x338b28(0x1c9)]);}return _0x5f2aa7;}async['run'](_0x4a4ca1){const _0x51c849=a135_0x290672,_0x1cb92a=[..._0x4a4ca1],_0x65c5d4=[],_0x3b9e18=[];while(_0x1cb92a[_0x51c849(0x1c9)]){const _0x573dde=_0x1cb92a[_0x51c849(0x1d2)](0x0,this[_0x51c849(0x1f5)]),_0x4daec4=await this[_0x51c849(0x1cf)][_0x51c849(0x1cd)](_0x573dde);_0x573dde[_0x51c849(0x1c9)]!==_0x4daec4['ids']['length']?(_0x1cb92a[_0x51c849(0x1f8)](..._0x4daec4['ids']),_0x65c5d4[_0x51c849(0x1f8)](..._0x4daec4[_0x51c849(0x1e4)])):_0x3b9e18['push'](..._0x573dde),this[_0x51c849(0x1f4)][_0x51c849(0x1e9)]('retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest',_0x4a4ca1[_0x51c849(0x1c9)]-_0x1cb92a[_0x51c849(0x1c9)],_0x4a4ca1[_0x51c849(0x1c9)]);}if(_0x3b9e18['length']){const _0x3e8d85=await this[_0x51c849(0x1cb)](_0x3b9e18);_0x65c5d4['push'](..._0x3e8d85);}return _0x65c5d4;}}exports['SalesforceRetrieverService']=SalesforceRetrieverService;