const a135_0x5f5e09=a135_0x29aa;(function(_0x17a4c8,_0x1f1684){const _0x530c7f=a135_0x29aa,_0x7d74f8=_0x17a4c8();while(!![]){try{const _0x19698e=parseInt(_0x530c7f(0xc0))/0x1+parseInt(_0x530c7f(0xe1))/0x2*(-parseInt(_0x530c7f(0xe7))/0x3)+parseInt(_0x530c7f(0xf9))/0x4+-parseInt(_0x530c7f(0xca))/0x5+-parseInt(_0x530c7f(0xdd))/0x6*(parseInt(_0x530c7f(0xeb))/0x7)+-parseInt(_0x530c7f(0xd1))/0x8*(-parseInt(_0x530c7f(0xdb))/0x9)+-parseInt(_0x530c7f(0xd7))/0xa*(-parseInt(_0x530c7f(0xf3))/0xb);if(_0x19698e===_0x1f1684)break;else _0x7d74f8['push'](_0x7d74f8['shift']());}catch(_0x257189){_0x7d74f8['push'](_0x7d74f8['shift']());}}}(a135_0x4df4,0xe243f));const a135_0x1c28ef=(function(){let _0x4ab2a8=!![];return function(_0x166695,_0x2bffc3){const _0x5b81a0=_0x4ab2a8?function(){const _0x516571=a135_0x29aa;if(_0x2bffc3){const _0x29d727=_0x2bffc3[_0x516571(0xe4)](_0x166695,arguments);return _0x2bffc3=null,_0x29d727;}}:function(){};return _0x4ab2a8=![],_0x5b81a0;};}()),a135_0x64f906=a135_0x1c28ef(this,function(){const _0x3e994f=a135_0x29aa;return a135_0x64f906[_0x3e994f(0xf1)]()[_0x3e994f(0xd2)](_0x3e994f(0xec))[_0x3e994f(0xf1)]()[_0x3e994f(0xda)](a135_0x64f906)[_0x3e994f(0xd2)](_0x3e994f(0xec));});a135_0x64f906();'use strict';var __importDefault=this&&this[a135_0x5f5e09(0xe8)]||function(_0x5109fe){const _0x399e68=a135_0x5f5e09;return _0x5109fe&&_0x5109fe[_0x399e68(0xbf)]?_0x5109fe:{'default':_0x5109fe};};Object[a135_0x5f5e09(0xc5)](exports,a135_0x5f5e09(0xbf),{'value':!![]}),exports['SalesforceRetrieverService']=void 0x0;const core_1=require('../../../core'),typedi_1=__importDefault(require(a135_0x5f5e09(0xcb))),salesforce_query_service_1=require(a135_0x5f5e09(0xe9)),queries_1=require(a135_0x5f5e09(0xd5)),flosum_component_history_dto_1=require(a135_0x5f5e09(0xf0));class SalesforceRetrieverService{constructor(_0x350fb3){const _0x4cea09=a135_0x5f5e09;this[_0x4cea09(0xc9)]=_0x350fb3,this[_0x4cea09(0xd8)]=new core_1['Logger'](SalesforceRetrieverService[_0x4cea09(0xd4)]),this[_0x4cea09(0xed)]=0xbb8,this[_0x4cea09(0xef)]=0x1f4;}async[a135_0x5f5e09(0xc8)](_0x960237){const _0x5c41d5=a135_0x5f5e09;this[_0x5c41d5(0xd8)]['info'](_0x5c41d5(0xc4),_0x960237['length']);const _0x50d487=typedi_1[_0x5c41d5(0xbd)]['get'](salesforce_query_service_1[_0x5c41d5(0xdc)]),_0x21ada5=_0x960237[_0x5c41d5(0xc2)](_0x58dcc4=>'\x27'+_0x58dcc4+'\x27'),_0x4ee48b=[];while(_0x21ada5[_0x5c41d5(0xdf)]){const _0x3601ec=_0x21ada5[_0x5c41d5(0xe0)](0x0,this[_0x5c41d5(0xef)]),_0x35f487=_0x50d487[_0x5c41d5(0xc7)](queries_1[_0x5c41d5(0xc3)]['replace'](_0x5c41d5(0xcf),_0x3601ec[_0x5c41d5(0xf8)]())),_0x344789=_0x50d487[_0x5c41d5(0xc7)](queries_1[_0x5c41d5(0xf6)][_0x5c41d5(0xf5)](_0x5c41d5(0xee),_0x3601ec[_0x5c41d5(0xf8)]()))[_0x5c41d5(0xe3)](_0x12a098=>_0x12a098['map'](_0xa6dc0e=>flosum_component_history_dto_1[_0x5c41d5(0xd3)]['fromSalesforce'](_0xa6dc0e))),[_0x124dd9,_0x5647ac]=await Promise['all']([_0x35f487,_0x344789]);for(const _0x424abe of _0x5647ac){const _0x2bab6a=_0x124dd9[_0x5c41d5(0xcd)](_0x355c42=>_0x355c42[_0x5c41d5(0xe5)]===_0x424abe['id']);_0x2bab6a&&_0x4ee48b[_0x5c41d5(0xde)]({'fileType':_0x2bab6a[_0x5c41d5(0xd6)],'fileName':_0x424abe[_0x5c41d5(0xc1)],'attachmentId':_0x2bab6a['Id']});}}return _0x4ee48b;}async[a135_0x5f5e09(0xd9)](_0x55d8a2){const _0x1286a8=a135_0x5f5e09,_0x386a4f=await this['retrieveComponentIdsFromHistoryIds'](_0x55d8a2);this[_0x1286a8(0xd8)][_0x1286a8(0xcc)](_0x1286a8(0xc6));const _0x21573b=[];for(const _0x1b78b6 of _0x386a4f){const _0x417970=await this['salesforceService'][_0x1286a8(0xd0)](_0x1b78b6[_0x1286a8(0xf2)],!![]);_0x21573b[_0x1286a8(0xde)]({'body':_0x417970[_0x1286a8(0xf1)]('base64'),'fileName':_0x1b78b6['fileName'],'fileType':_0x1b78b6[_0x1286a8(0xf4)]}),this[_0x1286a8(0xd8)][_0x1286a8(0xcc)]('manually\x20retrieved\x20%d/%d\x20components',_0x21573b['length'],_0x55d8a2[_0x1286a8(0xdf)]);}return _0x21573b;}async['run'](_0x40fbf8){const _0x5a0621=a135_0x5f5e09,_0x5d22b8=[..._0x40fbf8],_0x1e2771=[],_0x177a51=[];while(_0x5d22b8['length']){const _0x192ef4=_0x5d22b8[_0x5a0621(0xe0)](0x0,this[_0x5a0621(0xed)]),_0x4ed7f3=await this['salesforceService'][_0x5a0621(0xbe)](_0x192ef4);_0x192ef4['length']!==_0x4ed7f3[_0x5a0621(0xea)][_0x5a0621(0xdf)]?(_0x5d22b8['push'](..._0x4ed7f3[_0x5a0621(0xea)]),_0x1e2771[_0x5a0621(0xde)](..._0x4ed7f3[_0x5a0621(0xf7)])):_0x177a51['push'](..._0x192ef4),this[_0x5a0621(0xd8)][_0x5a0621(0xe2)](_0x5a0621(0xe6),_0x40fbf8[_0x5a0621(0xdf)]-_0x5d22b8[_0x5a0621(0xdf)],_0x40fbf8[_0x5a0621(0xdf)]);}if(_0x177a51[_0x5a0621(0xdf)]){const _0x4d6beb=await this[_0x5a0621(0xd9)](_0x177a51);_0x1e2771[_0x5a0621(0xde)](..._0x4d6beb);}return _0x1e2771;}}function a135_0x4df4(){const _0x5dc021=['__importDefault','./salesforce-query.service','ids','413BmXvZA','(((.+)+)+)+$','COMPONENTS_PER_REQUEST','%ids%','COMPONENTS_PER_QUERY','../dto/flosum-component-history.dto','toString','attachmentId','33piiowy','fileType','replace','GET_COMPONENT_HISTORIES_BY_IDS','components','join','999432dKkKXP','default','retrieveComponents','__esModule','1545206HJCljt','filename','map','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','defineProperty','manually\x20retrieving\x20components\x20from\x20salesforce','query','retrieveComponentIdsFromHistoryIds','salesforceService','7647520SFrnXr','typedi','info','find','SalesforceRetrieverService','%parent_ids%','retrieveAttachment','152aUjuMM','search','FlosumComponentHistoryDto','name','../queries','Name','10220030KtAgeu','logger','retrieveLastComponents','constructor','21582AfEHzv','SalesforceQueryService','182202cLtlnA','push','length','splice','263478rxlmMi','log','then','apply','ParentId','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','15JbhdlW'];a135_0x4df4=function(){return _0x5dc021;};return a135_0x4df4();}function a135_0x29aa(_0x5211af,_0xc220a1){const _0x1730e1=a135_0x4df4();return a135_0x29aa=function(_0x64f906,_0x1c28ef){_0x64f906=_0x64f906-0xbd;let _0x4df435=_0x1730e1[_0x64f906];return _0x4df435;},a135_0x29aa(_0x5211af,_0xc220a1);}exports[a135_0x5f5e09(0xce)]=SalesforceRetrieverService;