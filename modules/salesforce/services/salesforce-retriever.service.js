const a135_0x2a397b=a135_0x5798;function a135_0x5798(_0x31e973,_0x1aa3b2){const _0x2a6da6=a135_0x34b0();return a135_0x5798=function(_0x41ef2b,_0x561ef9){_0x41ef2b=_0x41ef2b-0x67;let _0x34b052=_0x2a6da6[_0x41ef2b];return _0x34b052;},a135_0x5798(_0x31e973,_0x1aa3b2);}(function(_0xf12b96,_0x16e7f2){const _0x410f0a=a135_0x5798,_0x4ee195=_0xf12b96();while(!![]){try{const _0x6c16ef=-parseInt(_0x410f0a(0x7f))/0x1+parseInt(_0x410f0a(0x9d))/0x2*(-parseInt(_0x410f0a(0x90))/0x3)+parseInt(_0x410f0a(0x86))/0x4+parseInt(_0x410f0a(0xa2))/0x5+parseInt(_0x410f0a(0x75))/0x6*(parseInt(_0x410f0a(0x9b))/0x7)+parseInt(_0x410f0a(0x8e))/0x8*(-parseInt(_0x410f0a(0x97))/0x9)+parseInt(_0x410f0a(0x76))/0xa;if(_0x6c16ef===_0x16e7f2)break;else _0x4ee195['push'](_0x4ee195['shift']());}catch(_0x4d1244){_0x4ee195['push'](_0x4ee195['shift']());}}}(a135_0x34b0,0xdcbf6));const a135_0x561ef9=(function(){let _0x51cb41=!![];return function(_0x1b8a94,_0x676349){const _0x24e364=_0x51cb41?function(){if(_0x676349){const _0x2b3ac6=_0x676349['apply'](_0x1b8a94,arguments);return _0x676349=null,_0x2b3ac6;}}:function(){};return _0x51cb41=![],_0x24e364;};}()),a135_0x41ef2b=a135_0x561ef9(this,function(){const _0x1c0847=a135_0x5798;return a135_0x41ef2b[_0x1c0847(0x9f)]()[_0x1c0847(0x7e)](_0x1c0847(0x8b))[_0x1c0847(0x9f)]()[_0x1c0847(0x82)](a135_0x41ef2b)['search'](_0x1c0847(0x8b));});a135_0x41ef2b();'use strict';var __importDefault=this&&this[a135_0x2a397b(0x8d)]||function(_0x334a1d){const _0x5ebee5=a135_0x2a397b;return _0x334a1d&&_0x334a1d[_0x5ebee5(0x9e)]?_0x334a1d:{'default':_0x334a1d};};Object[a135_0x2a397b(0x7d)](exports,a135_0x2a397b(0x9e),{'value':!![]}),exports[a135_0x2a397b(0x6f)]=void 0x0;function a135_0x34b0(){const _0x44712f=['9498vrTWeU','19966910OxJgno','join','find','FlosumComponentHistoryDto','name','retrieveComponentIdsFromHistoryIds','Name','defineProperty','search','288487pkTUqk','../queries','filename','constructor','push','SalesforceQueryService','salesforceService','737260NLCcTf','GET_COMPONENT_HISTORIES_BY_IDS','length','ParentId','Logger','(((.+)+)+)+$','default','__importDefault','1576nusezW','get','3KzQDEh','retrieveLastComponents','COMPONENTS_PER_QUERY','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','attachmentId','../dto/flosum-component-history.dto','replace','48627EMpHyv','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','base64','splice','2086SeSMPX','ids','3605322zzHsht','__esModule','toString','query','info','7034905oJlkfZ','%parent_ids%','manually\x20retrieving\x20components\x20from\x20salesforce','fileName','%ids%','run','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','then','log','SalesforceRetrieverService','map','all','COMPONENTS_PER_REQUEST','logger','../../../core'];a135_0x34b0=function(){return _0x44712f;};return a135_0x34b0();}const core_1=require(a135_0x2a397b(0x74)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a135_0x2a397b(0x80)),flosum_component_history_dto_1=require(a135_0x2a397b(0x95));class SalesforceRetrieverService{constructor(_0x27ed92){const _0x45f1de=a135_0x2a397b;this['salesforceService']=_0x27ed92,this['logger']=new core_1[(_0x45f1de(0x8a))](SalesforceRetrieverService[_0x45f1de(0x7a)]),this['COMPONENTS_PER_REQUEST']=0xbb8,this[_0x45f1de(0x92)]=0x1f4;}async[a135_0x2a397b(0x7b)](_0x9526f0){const _0x51f7b7=a135_0x2a397b;this[_0x51f7b7(0x73)]['info'](_0x51f7b7(0x93),_0x9526f0[_0x51f7b7(0x88)]);const _0xc1c962=typedi_1[_0x51f7b7(0x8c)][_0x51f7b7(0x8f)](salesforce_query_service_1[_0x51f7b7(0x84)]),_0x4224fd=_0x9526f0[_0x51f7b7(0x70)](_0x2af6e9=>'\x27'+_0x2af6e9+'\x27'),_0x3911aa=[];while(_0x4224fd[_0x51f7b7(0x88)]){const _0x59910b=_0x4224fd['splice'](0x0,this[_0x51f7b7(0x92)]),_0x269993=_0xc1c962[_0x51f7b7(0xa0)](queries_1[_0x51f7b7(0x98)][_0x51f7b7(0x96)](_0x51f7b7(0x67),_0x59910b[_0x51f7b7(0x77)]())),_0x34558f=_0xc1c962[_0x51f7b7(0xa0)](queries_1[_0x51f7b7(0x87)][_0x51f7b7(0x96)](_0x51f7b7(0x6a),_0x59910b[_0x51f7b7(0x77)]()))[_0x51f7b7(0x6d)](_0x2a6daf=>_0x2a6daf[_0x51f7b7(0x70)](_0x225cf2=>flosum_component_history_dto_1[_0x51f7b7(0x79)]['fromSalesforce'](_0x225cf2))),[_0x328726,_0x15365a]=await Promise[_0x51f7b7(0x71)]([_0x269993,_0x34558f]);for(const _0x425498 of _0x15365a){const _0x3b35a6=_0x328726[_0x51f7b7(0x78)](_0x2f260b=>_0x2f260b[_0x51f7b7(0x89)]===_0x425498['id']);_0x3b35a6&&_0x3911aa[_0x51f7b7(0x83)]({'fileType':_0x3b35a6[_0x51f7b7(0x7c)],'fileName':_0x425498[_0x51f7b7(0x81)],'attachmentId':_0x3b35a6['Id']});}}return _0x3911aa;}async[a135_0x2a397b(0x91)](_0x58aca7){const _0x4d61b0=a135_0x2a397b,_0x1d3b77=await this[_0x4d61b0(0x7b)](_0x58aca7);this['logger'][_0x4d61b0(0xa1)](_0x4d61b0(0x68));const _0x2752ac=[];for(const _0x2a9349 of _0x1d3b77){const _0x41ffb3=await this[_0x4d61b0(0x85)]['retrieveAttachment'](_0x2a9349[_0x4d61b0(0x94)],!![]);_0x2752ac[_0x4d61b0(0x83)]({'body':_0x41ffb3[_0x4d61b0(0x9f)](_0x4d61b0(0x99)),'fileName':_0x2a9349[_0x4d61b0(0x69)],'fileType':_0x2a9349['fileType']}),this[_0x4d61b0(0x73)][_0x4d61b0(0xa1)]('manually\x20retrieved\x20%d/%d\x20components',_0x2752ac[_0x4d61b0(0x88)],_0x58aca7[_0x4d61b0(0x88)]);}return _0x2752ac;}async[a135_0x2a397b(0x6b)](_0x5ce6d1){const _0x25b713=a135_0x2a397b,_0x736460=[..._0x5ce6d1],_0x5d8f24=[],_0x27f170=[];while(_0x736460[_0x25b713(0x88)]){const _0x534dab=_0x736460[_0x25b713(0x9a)](0x0,this[_0x25b713(0x72)]),_0x2c168f=await this['salesforceService']['retrieveComponents'](_0x534dab);_0x534dab['length']!==_0x2c168f[_0x25b713(0x9c)][_0x25b713(0x88)]?(_0x736460['push'](..._0x2c168f[_0x25b713(0x9c)]),_0x5d8f24['push'](..._0x2c168f['components'])):_0x27f170[_0x25b713(0x83)](..._0x534dab),this[_0x25b713(0x73)][_0x25b713(0x6e)](_0x25b713(0x6c),_0x5ce6d1[_0x25b713(0x88)]-_0x736460['length'],_0x5ce6d1[_0x25b713(0x88)]);}if(_0x27f170[_0x25b713(0x88)]){const _0xe26b47=await this[_0x25b713(0x91)](_0x27f170);_0x5d8f24['push'](..._0xe26b47);}return _0x5d8f24;}}exports[a135_0x2a397b(0x6f)]=SalesforceRetrieverService;