const a134_0x13751f=a134_0x3d73;(function(_0x5b63f0,_0x46a109){const _0x37687c=a134_0x3d73,_0x2c957f=_0x5b63f0();while(!![]){try{const _0x3be73c=-parseInt(_0x37687c(0x11a))/0x1*(parseInt(_0x37687c(0x116))/0x2)+-parseInt(_0x37687c(0xf9))/0x3*(parseInt(_0x37687c(0x115))/0x4)+parseInt(_0x37687c(0x129))/0x5+parseInt(_0x37687c(0x128))/0x6+-parseInt(_0x37687c(0x11c))/0x7*(-parseInt(_0x37687c(0x109))/0x8)+-parseInt(_0x37687c(0x114))/0x9+-parseInt(_0x37687c(0x101))/0xa*(-parseInt(_0x37687c(0x130))/0xb);if(_0x3be73c===_0x46a109)break;else _0x2c957f['push'](_0x2c957f['shift']());}catch(_0xdbaf82){_0x2c957f['push'](_0x2c957f['shift']());}}}(a134_0x4c5f,0x721ab));function a134_0x3d73(_0x4f9474,_0x433ba3){const _0x4f578f=a134_0x4c5f();return a134_0x3d73=function(_0x35580c,_0x259acb){_0x35580c=_0x35580c-0xf5;let _0x4c5f45=_0x4f578f[_0x35580c];return _0x4c5f45;},a134_0x3d73(_0x4f9474,_0x433ba3);}const a134_0x259acb=(function(){let _0x278dd0=!![];return function(_0x1dd205,_0x1d0d6b){const _0x40eac2=_0x278dd0?function(){const _0x26f663=a134_0x3d73;if(_0x1d0d6b){const _0xa719b9=_0x1d0d6b[_0x26f663(0xf7)](_0x1dd205,arguments);return _0x1d0d6b=null,_0xa719b9;}}:function(){};return _0x278dd0=![],_0x40eac2;};}()),a134_0x35580c=a134_0x259acb(this,function(){const _0x1b23a7=a134_0x3d73;return a134_0x35580c['toString']()['search'](_0x1b23a7(0x12a))[_0x1b23a7(0x127)]()['constructor'](a134_0x35580c)[_0x1b23a7(0x11f)](_0x1b23a7(0x12a));});a134_0x35580c();'use strict';var __importDefault=this&&this[a134_0x13751f(0x107)]||function(_0x5ebabd){const _0x27c1fa=a134_0x13751f;return _0x5ebabd&&_0x5ebabd[_0x27c1fa(0x102)]?_0x5ebabd:{'default':_0x5ebabd};};function a134_0x4c5f(){const _0xdf77c1=['../../../core','base64','1AsRlyY','default','114065CDtSXp','logger','name','search','join','push','map','SalesforceRetrieverService','../dto/flosum-component-history.dto','get','log','toString','2578110XamVzC','2494395IIRQyt','(((.+)+)+)+$','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','COMPONENTS_PER_QUERY','all','splice','run','3773SOsKbg','manually\x20retrieved\x20%d/%d\x20components','attachmentId','apply','retrieveAttachment','54084FhnQmB','length','replace','retrieveComponents','FlosumComponentHistoryDto','COMPONENTS_PER_REQUEST','find','SalesforceQueryService','34570ZrsIYK','__esModule','./salesforce-query.service','Name','then','info','__importDefault','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','120CwKuWI','ids','query','salesforceService','manually\x20retrieving\x20components\x20from\x20salesforce','components','%parent_ids%','%ids%','ParentId','filename','typedi','4710222VCULyi','160lrJFBk','1293782DBqAwH','retrieveComponentIdsFromHistoryIds'];a134_0x4c5f=function(){return _0xdf77c1;};return a134_0x4c5f();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['SalesforceRetrieverService']=void 0x0;const core_1=require(a134_0x13751f(0x118)),typedi_1=__importDefault(require(a134_0x13751f(0x113))),salesforce_query_service_1=require(a134_0x13751f(0x103)),queries_1=require('../queries'),flosum_component_history_dto_1=require(a134_0x13751f(0x124));class SalesforceRetrieverService{constructor(_0x3f582b){const _0x2120d6=a134_0x13751f;this['salesforceService']=_0x3f582b,this['logger']=new core_1['Logger'](SalesforceRetrieverService[_0x2120d6(0x11e)]),this['COMPONENTS_PER_REQUEST']=0xbb8,this['COMPONENTS_PER_QUERY']=0x1f4;}async[a134_0x13751f(0x117)](_0x1cf33c){const _0x5ae9be=a134_0x13751f;this[_0x5ae9be(0x11d)]['info'](_0x5ae9be(0x108),_0x1cf33c[_0x5ae9be(0xfa)]);const _0x5bfa2a=typedi_1[_0x5ae9be(0x11b)][_0x5ae9be(0x125)](salesforce_query_service_1[_0x5ae9be(0x100)]),_0x262294=_0x1cf33c['map'](_0xdf2d88=>'\x27'+_0xdf2d88+'\x27'),_0x51be4b=[];while(_0x262294['length']){const _0x1a62cb=_0x262294['splice'](0x0,this[_0x5ae9be(0x12c)]),_0xe2ff63=_0x5bfa2a['query'](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY']['replace'](_0x5ae9be(0x10f),_0x1a62cb['join']())),_0x5988c8=_0x5bfa2a[_0x5ae9be(0x10b)](queries_1['GET_COMPONENT_HISTORIES_BY_IDS'][_0x5ae9be(0xfb)](_0x5ae9be(0x110),_0x1a62cb[_0x5ae9be(0x120)]()))[_0x5ae9be(0x105)](_0x2ff8c4=>_0x2ff8c4[_0x5ae9be(0x122)](_0x2eba25=>flosum_component_history_dto_1[_0x5ae9be(0xfd)]['fromSalesforce'](_0x2eba25))),[_0x35d5c3,_0x44f890]=await Promise[_0x5ae9be(0x12d)]([_0xe2ff63,_0x5988c8]);for(const _0x45bfc8 of _0x44f890){const _0x2c8f35=_0x35d5c3[_0x5ae9be(0xff)](_0xa41f6d=>_0xa41f6d[_0x5ae9be(0x111)]===_0x45bfc8['id']);_0x2c8f35&&_0x51be4b[_0x5ae9be(0x121)]({'fileType':_0x2c8f35[_0x5ae9be(0x104)],'fileName':_0x45bfc8[_0x5ae9be(0x112)],'attachmentId':_0x2c8f35['Id']});}}return _0x51be4b;}async['retrieveLastComponents'](_0x535b0d){const _0x2ea5c5=a134_0x13751f,_0x22a8de=await this[_0x2ea5c5(0x117)](_0x535b0d);this[_0x2ea5c5(0x11d)][_0x2ea5c5(0x106)](_0x2ea5c5(0x10d));const _0x59c984=[];for(const _0x4f5657 of _0x22a8de){const _0x59219f=await this['salesforceService'][_0x2ea5c5(0xf8)](_0x4f5657[_0x2ea5c5(0xf6)],!![]);_0x59c984[_0x2ea5c5(0x121)]({'body':_0x59219f[_0x2ea5c5(0x127)](_0x2ea5c5(0x119)),'fileName':_0x4f5657['fileName'],'fileType':_0x4f5657['fileType']}),this[_0x2ea5c5(0x11d)][_0x2ea5c5(0x106)](_0x2ea5c5(0xf5),_0x59c984[_0x2ea5c5(0xfa)],_0x535b0d[_0x2ea5c5(0xfa)]);}return _0x59c984;}async[a134_0x13751f(0x12f)](_0x31589a){const _0x138f19=a134_0x13751f,_0x39d317=[..._0x31589a],_0x88be4f=[],_0x5bf3d7=[];while(_0x39d317[_0x138f19(0xfa)]){const _0x423fd6=_0x39d317[_0x138f19(0x12e)](0x0,this[_0x138f19(0xfe)]),_0x16d940=await this[_0x138f19(0x10c)][_0x138f19(0xfc)](_0x423fd6);_0x423fd6['length']!==_0x16d940[_0x138f19(0x10a)][_0x138f19(0xfa)]?(_0x39d317[_0x138f19(0x121)](..._0x16d940[_0x138f19(0x10a)]),_0x88be4f[_0x138f19(0x121)](..._0x16d940[_0x138f19(0x10e)])):_0x5bf3d7[_0x138f19(0x121)](..._0x423fd6),this[_0x138f19(0x11d)][_0x138f19(0x126)](_0x138f19(0x12b),_0x31589a[_0x138f19(0xfa)]-_0x39d317['length'],_0x31589a[_0x138f19(0xfa)]);}if(_0x5bf3d7[_0x138f19(0xfa)]){const _0x411294=await this['retrieveLastComponents'](_0x5bf3d7);_0x88be4f[_0x138f19(0x121)](..._0x411294);}return _0x88be4f;}}exports[a134_0x13751f(0x123)]=SalesforceRetrieverService;