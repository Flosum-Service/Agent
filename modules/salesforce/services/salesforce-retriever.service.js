const a135_0x2111d0=a135_0x49de;(function(_0x14734f,_0x4eb239){const _0x426cdb=a135_0x49de,_0x50d6a0=_0x14734f();while(!![]){try{const _0x5c0ff3=parseInt(_0x426cdb(0x113))/0x1+-parseInt(_0x426cdb(0x121))/0x2+parseInt(_0x426cdb(0xfd))/0x3+parseInt(_0x426cdb(0x12a))/0x4*(-parseInt(_0x426cdb(0x105))/0x5)+-parseInt(_0x426cdb(0x103))/0x6+-parseInt(_0x426cdb(0x110))/0x7*(parseInt(_0x426cdb(0x124))/0x8)+parseInt(_0x426cdb(0x11e))/0x9*(parseInt(_0x426cdb(0x122))/0xa);if(_0x5c0ff3===_0x4eb239)break;else _0x50d6a0['push'](_0x50d6a0['shift']());}catch(_0x2cc6c0){_0x50d6a0['push'](_0x50d6a0['shift']());}}}(a135_0x385c,0x447ec));const a135_0x6aacaf=(function(){let _0x5ba950=!![];return function(_0x594264,_0xa93e81){const _0x20e0df=_0x5ba950?function(){if(_0xa93e81){const _0x35d2e2=_0xa93e81['apply'](_0x594264,arguments);return _0xa93e81=null,_0x35d2e2;}}:function(){};return _0x5ba950=![],_0x20e0df;};}()),a135_0xcd484f=a135_0x6aacaf(this,function(){const _0x5dbf09=a135_0x49de;return a135_0xcd484f['toString']()[_0x5dbf09(0x10f)](_0x5dbf09(0x126))[_0x5dbf09(0xff)]()['constructor'](a135_0xcd484f)[_0x5dbf09(0x10f)]('(((.+)+)+)+$');});a135_0xcd484f();'use strict';function a135_0x385c(){const _0x18df99=['../queries','join','2376EWVPQc','get','COMPONENTS_PER_REQUEST','908932ALWyhJ','56250VfThQN','FlosumComponentHistoryDto','81792YkpLBg','find','(((.+)+)+)+$','SalesforceQueryService','salesforceService','../dto/flosum-component-history.dto','11896mtvNIm','replace','map','run','COMPONENTS_PER_QUERY','__esModule','Name','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','../../../core','fromSalesforce','query','%parent_ids%','927924PcSeZB','%ids%','toString','attachmentId','defineProperty','Logger','1330602hWRvSx','base64','890QIRtAf','SalesforceRetrieverService','length','splice','fileType','info','manually\x20retrieved\x20%d/%d\x20components','push','logger','components','search','266hMwiJs','name','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','80365zlOIeU','all','typedi','retrieveLastComponents','ids','filename','fileName','retrieveComponentIdsFromHistoryIds','manually\x20retrieving\x20components\x20from\x20salesforce'];a135_0x385c=function(){return _0x18df99;};return a135_0x385c();}var __importDefault=this&&this['__importDefault']||function(_0x85892){const _0x3ce870=a135_0x49de;return _0x85892&&_0x85892[_0x3ce870(0xf6)]?_0x85892:{'default':_0x85892};};Object[a135_0x2111d0(0x101)](exports,'__esModule',{'value':!![]}),exports['SalesforceRetrieverService']=void 0x0;function a135_0x49de(_0x4257a5,_0x534950){const _0x3df5c6=a135_0x385c();return a135_0x49de=function(_0xcd484f,_0x6aacaf){_0xcd484f=_0xcd484f-0xf3;let _0x385ca1=_0x3df5c6[_0xcd484f];return _0x385ca1;},a135_0x49de(_0x4257a5,_0x534950);}const core_1=require(a135_0x2111d0(0xf9)),typedi_1=__importDefault(require(a135_0x2111d0(0x115))),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a135_0x2111d0(0x11c)),flosum_component_history_dto_1=require(a135_0x2111d0(0x129));class SalesforceRetrieverService{constructor(_0x4b65b4){const _0x8e0d8b=a135_0x2111d0;this[_0x8e0d8b(0x128)]=_0x4b65b4,this[_0x8e0d8b(0x10d)]=new core_1[(_0x8e0d8b(0x102))](SalesforceRetrieverService[_0x8e0d8b(0x111)]),this[_0x8e0d8b(0x120)]=0xbb8,this[_0x8e0d8b(0xf5)]=0x1f4;}async[a135_0x2111d0(0x11a)](_0x4ddbbf){const _0x4f0018=a135_0x2111d0;this[_0x4f0018(0x10d)][_0x4f0018(0x10a)](_0x4f0018(0xf8),_0x4ddbbf[_0x4f0018(0x107)]);const _0x523eb2=typedi_1['default'][_0x4f0018(0x11f)](salesforce_query_service_1[_0x4f0018(0x127)]),_0x1c8b1c=_0x4ddbbf[_0x4f0018(0xf3)](_0x2cccbc=>'\x27'+_0x2cccbc+'\x27'),_0x406769=[];while(_0x1c8b1c[_0x4f0018(0x107)]){const _0x3a0777=_0x1c8b1c[_0x4f0018(0x108)](0x0,this[_0x4f0018(0xf5)]),_0x5706da=_0x523eb2['query'](queries_1[_0x4f0018(0x112)]['replace'](_0x4f0018(0xfc),_0x3a0777[_0x4f0018(0x11d)]())),_0x4cf551=_0x523eb2[_0x4f0018(0xfb)](queries_1['GET_COMPONENT_HISTORIES_BY_IDS'][_0x4f0018(0x12b)](_0x4f0018(0xfe),_0x3a0777[_0x4f0018(0x11d)]()))['then'](_0x5f114f=>_0x5f114f[_0x4f0018(0xf3)](_0x5d01c2=>flosum_component_history_dto_1[_0x4f0018(0x123)][_0x4f0018(0xfa)](_0x5d01c2))),[_0x275c08,_0x4d89bc]=await Promise[_0x4f0018(0x114)]([_0x5706da,_0x4cf551]);for(const _0x28804e of _0x4d89bc){const _0x391522=_0x275c08[_0x4f0018(0x125)](_0x56cd46=>_0x56cd46['ParentId']===_0x28804e['id']);_0x391522&&_0x406769['push']({'fileType':_0x391522[_0x4f0018(0xf7)],'fileName':_0x28804e[_0x4f0018(0x118)],'attachmentId':_0x391522['Id']});}}return _0x406769;}async[a135_0x2111d0(0x116)](_0x12251d){const _0x5d34c3=a135_0x2111d0,_0x2fba39=await this['retrieveComponentIdsFromHistoryIds'](_0x12251d);this[_0x5d34c3(0x10d)][_0x5d34c3(0x10a)](_0x5d34c3(0x11b));const _0x41d800=[];for(const _0x192ee6 of _0x2fba39){const _0x38df09=await this[_0x5d34c3(0x128)]['retrieveAttachment'](_0x192ee6[_0x5d34c3(0x100)],!![]);_0x41d800['push']({'body':_0x38df09[_0x5d34c3(0xff)](_0x5d34c3(0x104)),'fileName':_0x192ee6[_0x5d34c3(0x119)],'fileType':_0x192ee6[_0x5d34c3(0x109)]}),this[_0x5d34c3(0x10d)][_0x5d34c3(0x10a)](_0x5d34c3(0x10b),_0x41d800[_0x5d34c3(0x107)],_0x12251d[_0x5d34c3(0x107)]);}return _0x41d800;}async[a135_0x2111d0(0xf4)](_0x54adfe){const _0xdbfd67=a135_0x2111d0,_0x4d2268=[..._0x54adfe],_0x2a285c=[],_0x2c51ae=[];while(_0x4d2268[_0xdbfd67(0x107)]){const _0x5af1c2=_0x4d2268[_0xdbfd67(0x108)](0x0,this['COMPONENTS_PER_REQUEST']),_0x36d757=await this[_0xdbfd67(0x128)]['retrieveComponents'](_0x5af1c2);_0x5af1c2[_0xdbfd67(0x107)]!==_0x36d757[_0xdbfd67(0x117)]['length']?(_0x4d2268[_0xdbfd67(0x10c)](..._0x36d757[_0xdbfd67(0x117)]),_0x2a285c[_0xdbfd67(0x10c)](..._0x36d757[_0xdbfd67(0x10e)])):_0x2c51ae[_0xdbfd67(0x10c)](..._0x5af1c2),this[_0xdbfd67(0x10d)]['log']('retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest',_0x54adfe[_0xdbfd67(0x107)]-_0x4d2268[_0xdbfd67(0x107)],_0x54adfe['length']);}if(_0x2c51ae['length']){const _0x350a7f=await this[_0xdbfd67(0x116)](_0x2c51ae);_0x2a285c[_0xdbfd67(0x10c)](..._0x350a7f);}return _0x2a285c;}}exports[a135_0x2111d0(0x106)]=SalesforceRetrieverService;