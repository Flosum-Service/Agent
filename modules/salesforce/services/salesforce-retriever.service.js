const a135_0xc0ef7d=a135_0x42f0;(function(_0x181be2,_0x566b86){const _0x2ee367=a135_0x42f0,_0x3bce3e=_0x181be2();while(!![]){try{const _0x468f04=parseInt(_0x2ee367(0x167))/0x1*(-parseInt(_0x2ee367(0x151))/0x2)+parseInt(_0x2ee367(0x157))/0x3*(-parseInt(_0x2ee367(0x133))/0x4)+-parseInt(_0x2ee367(0x137))/0x5*(-parseInt(_0x2ee367(0x162))/0x6)+-parseInt(_0x2ee367(0x143))/0x7+-parseInt(_0x2ee367(0x154))/0x8*(parseInt(_0x2ee367(0x152))/0x9)+-parseInt(_0x2ee367(0x161))/0xa+parseInt(_0x2ee367(0x14b))/0xb;if(_0x468f04===_0x566b86)break;else _0x3bce3e['push'](_0x3bce3e['shift']());}catch(_0x190d1e){_0x3bce3e['push'](_0x3bce3e['shift']());}}}(a135_0x4af8,0x68ada));const a135_0x7e2f41=(function(){let _0x1dd967=!![];return function(_0x17a621,_0x19a95a){const _0x55f495=_0x1dd967?function(){if(_0x19a95a){const _0x236df1=_0x19a95a['apply'](_0x17a621,arguments);return _0x19a95a=null,_0x236df1;}}:function(){};return _0x1dd967=![],_0x55f495;};}()),a135_0x436047=a135_0x7e2f41(this,function(){const _0x55b6b8=a135_0x42f0;return a135_0x436047[_0x55b6b8(0x131)]()['search'](_0x55b6b8(0x15f))[_0x55b6b8(0x131)]()['constructor'](a135_0x436047)[_0x55b6b8(0x13f)]('(((.+)+)+)+$');});a135_0x436047();function a135_0x42f0(_0x3ffa10,_0x5cc6b){const _0x36f45b=a135_0x4af8();return a135_0x42f0=function(_0x436047,_0x7e2f41){_0x436047=_0x436047-0x131;let _0x4af82f=_0x36f45b[_0x436047];return _0x4af82f;},a135_0x42f0(_0x3ffa10,_0x5cc6b);}'use strict';var __importDefault=this&&this[a135_0xc0ef7d(0x15b)]||function(_0x242907){const _0x1aec6d=a135_0xc0ef7d;return _0x242907&&_0x242907[_0x1aec6d(0x14c)]?_0x242907:{'default':_0x242907};};Object[a135_0xc0ef7d(0x166)](exports,a135_0xc0ef7d(0x14c),{'value':!![]}),exports[a135_0xc0ef7d(0x160)]=void 0x0;const core_1=require(a135_0xc0ef7d(0x169)),typedi_1=__importDefault(require(a135_0xc0ef7d(0x14a))),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a135_0xc0ef7d(0x14d)),flosum_component_history_dto_1=require('../dto/flosum-component-history.dto');function a135_0x4af8(){const _0x187a33=['5848836HczOrs','Name','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','attachmentId','replace','then','typedi','38459773EJJXWW','__esModule','../queries','log','manually\x20retrieved\x20%d/%d\x20components','manually\x20retrieving\x20components\x20from\x20salesforce','147310cXRQsu','5800716OxVLxA','push','8TnYTMI','ParentId','join','23853djzfQB','logger','COMPONENTS_PER_QUERY','%ids%','__importDefault','ids','SalesforceQueryService','splice','(((.+)+)+)+$','SalesforceRetrieverService','6904150oqnXYx','888Zuoqbg','length','components','filename','defineProperty','11NJEEpj','name','../../../core','retrieveAttachment','toString','retrieveComponentIdsFromHistoryIds','172zBLAvo','fileType','get','FlosumComponentHistoryDto','8615zQfpaw','all','info','retrieveLastComponents','salesforceService','COMPONENTS_PER_REQUEST','map','fromSalesforce','search','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','Logger','default'];a135_0x4af8=function(){return _0x187a33;};return a135_0x4af8();}class SalesforceRetrieverService{constructor(_0x594870){const _0x1692d9=a135_0xc0ef7d;this[_0x1692d9(0x13b)]=_0x594870,this['logger']=new core_1[(_0x1692d9(0x141))](SalesforceRetrieverService[_0x1692d9(0x168)]),this[_0x1692d9(0x13c)]=0xbb8,this[_0x1692d9(0x159)]=0x1f4;}async[a135_0xc0ef7d(0x132)](_0x5711a0){const _0x59c99d=a135_0xc0ef7d;this[_0x59c99d(0x158)]['info'](_0x59c99d(0x145),_0x5711a0[_0x59c99d(0x163)]);const _0x4d1a20=typedi_1[_0x59c99d(0x142)][_0x59c99d(0x135)](salesforce_query_service_1[_0x59c99d(0x15d)]),_0x173d8f=_0x5711a0[_0x59c99d(0x13d)](_0x2e18be=>'\x27'+_0x2e18be+'\x27'),_0x29eb07=[];while(_0x173d8f[_0x59c99d(0x163)]){const _0x25b870=_0x173d8f[_0x59c99d(0x15e)](0x0,this[_0x59c99d(0x159)]),_0x4a3386=_0x4d1a20['query'](queries_1[_0x59c99d(0x146)][_0x59c99d(0x148)]('%parent_ids%',_0x25b870[_0x59c99d(0x156)]())),_0x266881=_0x4d1a20['query'](queries_1['GET_COMPONENT_HISTORIES_BY_IDS'][_0x59c99d(0x148)](_0x59c99d(0x15a),_0x25b870[_0x59c99d(0x156)]()))[_0x59c99d(0x149)](_0x163417=>_0x163417[_0x59c99d(0x13d)](_0x28f05f=>flosum_component_history_dto_1[_0x59c99d(0x136)][_0x59c99d(0x13e)](_0x28f05f))),[_0x399f01,_0x2dc18c]=await Promise[_0x59c99d(0x138)]([_0x4a3386,_0x266881]);for(const _0x1e3df3 of _0x2dc18c){const _0x39aaa5=_0x399f01['find'](_0xdec84=>_0xdec84[_0x59c99d(0x155)]===_0x1e3df3['id']);_0x39aaa5&&_0x29eb07[_0x59c99d(0x153)]({'fileType':_0x39aaa5[_0x59c99d(0x144)],'fileName':_0x1e3df3[_0x59c99d(0x165)],'attachmentId':_0x39aaa5['Id']});}}return _0x29eb07;}async[a135_0xc0ef7d(0x13a)](_0x173d20){const _0x369d40=a135_0xc0ef7d,_0x3845f3=await this['retrieveComponentIdsFromHistoryIds'](_0x173d20);this[_0x369d40(0x158)]['info'](_0x369d40(0x150));const _0x5e8d53=[];for(const _0xcfe4a2 of _0x3845f3){const _0x5cc3e7=await this[_0x369d40(0x13b)][_0x369d40(0x16a)](_0xcfe4a2[_0x369d40(0x147)],!![]);_0x5e8d53['push']({'body':_0x5cc3e7['toString']('base64'),'fileName':_0xcfe4a2['fileName'],'fileType':_0xcfe4a2[_0x369d40(0x134)]}),this[_0x369d40(0x158)][_0x369d40(0x139)](_0x369d40(0x14f),_0x5e8d53[_0x369d40(0x163)],_0x173d20[_0x369d40(0x163)]);}return _0x5e8d53;}async['run'](_0x1c98cb){const _0x56f7c3=a135_0xc0ef7d,_0x30a7f8=[..._0x1c98cb],_0x1b6aaf=[],_0x341834=[];while(_0x30a7f8[_0x56f7c3(0x163)]){const _0x571dd3=_0x30a7f8[_0x56f7c3(0x15e)](0x0,this[_0x56f7c3(0x13c)]),_0x5851f=await this[_0x56f7c3(0x13b)]['retrieveComponents'](_0x571dd3);_0x571dd3[_0x56f7c3(0x163)]!==_0x5851f[_0x56f7c3(0x15c)][_0x56f7c3(0x163)]?(_0x30a7f8[_0x56f7c3(0x153)](..._0x5851f[_0x56f7c3(0x15c)]),_0x1b6aaf['push'](..._0x5851f[_0x56f7c3(0x164)])):_0x341834[_0x56f7c3(0x153)](..._0x571dd3),this['logger'][_0x56f7c3(0x14e)](_0x56f7c3(0x140),_0x1c98cb[_0x56f7c3(0x163)]-_0x30a7f8[_0x56f7c3(0x163)],_0x1c98cb[_0x56f7c3(0x163)]);}if(_0x341834[_0x56f7c3(0x163)]){const _0x127a5a=await this[_0x56f7c3(0x13a)](_0x341834);_0x1b6aaf[_0x56f7c3(0x153)](..._0x127a5a);}return _0x1b6aaf;}}exports[a135_0xc0ef7d(0x160)]=SalesforceRetrieverService;