const a134_0x3cb9ec=a134_0x5a8f;(function(_0x5127df,_0x41db68){const _0x28d549=a134_0x5a8f,_0x1b0bc8=_0x5127df();while(!![]){try{const _0x1bd0c0=parseInt(_0x28d549(0xf7))/0x1*(parseInt(_0x28d549(0x10c))/0x2)+parseInt(_0x28d549(0xf8))/0x3+-parseInt(_0x28d549(0x121))/0x4*(-parseInt(_0x28d549(0x11b))/0x5)+parseInt(_0x28d549(0xe6))/0x6+parseInt(_0x28d549(0x122))/0x7+parseInt(_0x28d549(0x104))/0x8*(-parseInt(_0x28d549(0xee))/0x9)+-parseInt(_0x28d549(0xf1))/0xa;if(_0x1bd0c0===_0x41db68)break;else _0x1b0bc8['push'](_0x1b0bc8['shift']());}catch(_0x5a831b){_0x1b0bc8['push'](_0x1b0bc8['shift']());}}}(a134_0x21ab,0x7265a));const a134_0x158def=(function(){let _0x3f88e5=!![];return function(_0x5b2d24,_0x3bdd9d){const _0x456fc1=_0x3f88e5?function(){const _0x301e08=a134_0x5a8f;if(_0x3bdd9d){const _0x1790ce=_0x3bdd9d[_0x301e08(0xe9)](_0x5b2d24,arguments);return _0x3bdd9d=null,_0x1790ce;}}:function(){};return _0x3f88e5=![],_0x456fc1;};}()),a134_0x3e7d7c=a134_0x158def(this,function(){const _0x1e9e61=a134_0x5a8f;return a134_0x3e7d7c[_0x1e9e61(0x106)]()['search'](_0x1e9e61(0x10d))['toString']()['constructor'](a134_0x3e7d7c)[_0x1e9e61(0xef)](_0x1e9e61(0x10d));});a134_0x3e7d7c();function a134_0x5a8f(_0x2a8750,_0x52fc8f){const _0x3ecd32=a134_0x21ab();return a134_0x5a8f=function(_0x3e7d7c,_0x158def){_0x3e7d7c=_0x3e7d7c-0xe5;let _0x21ab8a=_0x3ecd32[_0x3e7d7c];return _0x21ab8a;},a134_0x5a8f(_0x2a8750,_0x52fc8f);}'use strict';function a134_0x21ab(){const _0x21c06e=['250beshQq','default','./salesforce-query.service','retrieveComponents','../../../core','length','47008QEegTa','4096603OpPywM','../queries','4401792tjDshM','all','defineProperty','apply','SalesforceQueryService','%parent_ids%','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','../dto/flosum-component-history.dto','2813661zQgjYy','search','join','18280620JXpzvX','splice','fileName','fileType','info','manually\x20retrieving\x20components\x20from\x20salesforce','1bcjgqG','1494954JQXQWP','retrieveComponentIdsFromHistoryIds','retrieveLastComponents','then','typedi','retrieveAttachment','filename','logger','map','GET_COMPONENT_HISTORIES_BY_IDS','name','run','16azMwPT','COMPONENTS_PER_REQUEST','toString','get','Logger','query','base64','salesforceService','1034222ubcxrC','(((.+)+)+)+$','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','FlosumComponentHistoryDto','find','SalesforceRetrieverService','ids','__importDefault','push','%ids%','replace','log','COMPONENTS_PER_QUERY','__esModule','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)'];a134_0x21ab=function(){return _0x21c06e;};return a134_0x21ab();}var __importDefault=this&&this[a134_0x3cb9ec(0x113)]||function(_0x379004){const _0x250a38=a134_0x3cb9ec;return _0x379004&&_0x379004[_0x250a38(0x119)]?_0x379004:{'default':_0x379004};};Object[a134_0x3cb9ec(0xe8)](exports,'__esModule',{'value':!![]}),exports[a134_0x3cb9ec(0x111)]=void 0x0;const core_1=require(a134_0x3cb9ec(0x11f)),typedi_1=__importDefault(require(a134_0x3cb9ec(0xfc))),salesforce_query_service_1=require(a134_0x3cb9ec(0x11d)),queries_1=require(a134_0x3cb9ec(0xe5)),flosum_component_history_dto_1=require(a134_0x3cb9ec(0xed));class SalesforceRetrieverService{constructor(_0xcd3ff9){const _0x1c6497=a134_0x3cb9ec;this[_0x1c6497(0x10b)]=_0xcd3ff9,this[_0x1c6497(0xff)]=new core_1[(_0x1c6497(0x108))](SalesforceRetrieverService[_0x1c6497(0x102)]),this[_0x1c6497(0x105)]=0xbb8,this[_0x1c6497(0x118)]=0x1f4;}async[a134_0x3cb9ec(0xf9)](_0x3313e9){const _0x519741=a134_0x3cb9ec;this[_0x519741(0xff)][_0x519741(0xf5)](_0x519741(0x11a),_0x3313e9[_0x519741(0x120)]);const _0x11e4b0=typedi_1[_0x519741(0x11c)][_0x519741(0x107)](salesforce_query_service_1[_0x519741(0xea)]),_0x22b464=_0x3313e9[_0x519741(0x100)](_0x2dd5e3=>'\x27'+_0x2dd5e3+'\x27'),_0x4d16de=[];while(_0x22b464['length']){const _0x1a88f2=_0x22b464[_0x519741(0xf2)](0x0,this[_0x519741(0x118)]),_0x4bbc16=_0x11e4b0[_0x519741(0x109)](queries_1[_0x519741(0xec)][_0x519741(0x116)](_0x519741(0xeb),_0x1a88f2['join']())),_0x16ba90=_0x11e4b0[_0x519741(0x109)](queries_1[_0x519741(0x101)]['replace'](_0x519741(0x115),_0x1a88f2[_0x519741(0xf0)]()))[_0x519741(0xfb)](_0x162d78=>_0x162d78[_0x519741(0x100)](_0x3eb843=>flosum_component_history_dto_1[_0x519741(0x10f)]['fromSalesforce'](_0x3eb843))),[_0x2f9592,_0x3e4ed5]=await Promise[_0x519741(0xe7)]([_0x4bbc16,_0x16ba90]);for(const _0x4e5ab2 of _0x3e4ed5){const _0x165b13=_0x2f9592[_0x519741(0x110)](_0x29f621=>_0x29f621['ParentId']===_0x4e5ab2['id']);_0x165b13&&_0x4d16de[_0x519741(0x114)]({'fileType':_0x165b13['Name'],'fileName':_0x4e5ab2[_0x519741(0xfe)],'attachmentId':_0x165b13['Id']});}}return _0x4d16de;}async[a134_0x3cb9ec(0xfa)](_0x4b02f6){const _0x227d7b=a134_0x3cb9ec,_0x2e0e2b=await this['retrieveComponentIdsFromHistoryIds'](_0x4b02f6);this[_0x227d7b(0xff)]['info'](_0x227d7b(0xf6));const _0x3684ca=[];for(const _0x42e66f of _0x2e0e2b){const _0xff1991=await this[_0x227d7b(0x10b)][_0x227d7b(0xfd)](_0x42e66f['attachmentId'],!![]);_0x3684ca[_0x227d7b(0x114)]({'body':_0xff1991[_0x227d7b(0x106)](_0x227d7b(0x10a)),'fileName':_0x42e66f[_0x227d7b(0xf3)],'fileType':_0x42e66f[_0x227d7b(0xf4)]}),this[_0x227d7b(0xff)][_0x227d7b(0xf5)]('manually\x20retrieved\x20%d/%d\x20components',_0x3684ca[_0x227d7b(0x120)],_0x4b02f6['length']);}return _0x3684ca;}async[a134_0x3cb9ec(0x103)](_0x18b759){const _0x3a4d3e=a134_0x3cb9ec,_0x255724=[..._0x18b759],_0xe1c581=[],_0xee9e72=[];while(_0x255724['length']){const _0x462d41=_0x255724['splice'](0x0,this[_0x3a4d3e(0x105)]),_0x3e2351=await this[_0x3a4d3e(0x10b)][_0x3a4d3e(0x11e)](_0x462d41);_0x462d41[_0x3a4d3e(0x120)]!==_0x3e2351[_0x3a4d3e(0x112)][_0x3a4d3e(0x120)]?(_0x255724[_0x3a4d3e(0x114)](..._0x3e2351[_0x3a4d3e(0x112)]),_0xe1c581[_0x3a4d3e(0x114)](..._0x3e2351['components'])):_0xee9e72[_0x3a4d3e(0x114)](..._0x462d41),this['logger'][_0x3a4d3e(0x117)](_0x3a4d3e(0x10e),_0x18b759['length']-_0x255724[_0x3a4d3e(0x120)],_0x18b759[_0x3a4d3e(0x120)]);}if(_0xee9e72[_0x3a4d3e(0x120)]){const _0x3d6df3=await this[_0x3a4d3e(0xfa)](_0xee9e72);_0xe1c581[_0x3a4d3e(0x114)](..._0x3d6df3);}return _0xe1c581;}}exports['SalesforceRetrieverService']=SalesforceRetrieverService;